{
  "module_name": "f71882fg.c",
  "hash_id": "7500e269a3c68005c3c117bd4520d15d8700a12f067aae6808f3cc5675aeafed",
  "original_prompt": "Ingested from linux-6.6.14/drivers/hwmon/f71882fg.c",
  "human_readable_source": "\n \n\n#define pr_fmt(fmt) KBUILD_MODNAME \": \" fmt\n\n#include <linux/module.h>\n#include <linux/init.h>\n#include <linux/slab.h>\n#include <linux/jiffies.h>\n#include <linux/platform_device.h>\n#include <linux/hwmon.h>\n#include <linux/hwmon-sysfs.h>\n#include <linux/err.h>\n#include <linux/mutex.h>\n#include <linux/io.h>\n#include <linux/acpi.h>\n\n#define DRVNAME \"f71882fg\"\n\n#define SIO_F71858FG_LD_HWM\t0x02\t \n#define SIO_F71882FG_LD_HWM\t0x04\t \n#define SIO_UNLOCK_KEY\t\t0x87\t \n#define SIO_LOCK_KEY\t\t0xAA\t \n\n#define SIO_REG_LDSEL\t\t0x07\t \n#define SIO_REG_DEVID\t\t0x20\t \n#define SIO_REG_DEVREV\t\t0x22\t \n#define SIO_REG_MANID\t\t0x23\t \n#define SIO_REG_ENABLE\t\t0x30\t \n#define SIO_REG_ADDR\t\t0x60\t \n\n#define SIO_FINTEK_ID\t\t0x1934\t \n#define SIO_F71808E_ID\t\t0x0901\t \n#define SIO_F71808A_ID\t\t0x1001\t \n#define SIO_F71858_ID\t\t0x0507   \n#define SIO_F71862_ID\t\t0x0601\t \n#define SIO_F71868_ID\t\t0x1106\t \n#define SIO_F71869_ID\t\t0x0814\t \n#define SIO_F71869A_ID\t\t0x1007\t \n#define SIO_F71882_ID\t\t0x0541\t \n#define SIO_F71889_ID\t\t0x0723\t \n#define SIO_F71889E_ID\t\t0x0909\t \n#define SIO_F71889A_ID\t\t0x1005\t \n#define SIO_F8000_ID\t\t0x0581\t \n#define SIO_F81768D_ID\t\t0x1210\t \n#define SIO_F81865_ID\t\t0x0704\t \n#define SIO_F81866_ID\t\t0x1010\t \n#define SIO_F71858AD_ID\t\t0x0903\t \n#define SIO_F81966_ID\t\t0x1502\t \n\n#define REGION_LENGTH\t\t8\n#define ADDR_REG_OFFSET\t\t5\n#define DATA_REG_OFFSET\t\t6\n\n#define F71882FG_REG_IN_STATUS\t\t0x12  \n#define F71882FG_REG_IN_BEEP\t\t0x13  \n#define F71882FG_REG_IN(nr)\t\t(0x20  + (nr))\n#define F71882FG_REG_IN1_HIGH\t\t0x32  \n\n#define F81866_REG_IN_STATUS\t\t0x16  \n#define F81866_REG_IN_BEEP\t\t\t0x17  \n#define F81866_REG_IN1_HIGH\t\t0x3a  \n\n#define F71882FG_REG_FAN(nr)\t\t(0xA0 + (16 * (nr)))\n#define F71882FG_REG_FAN_TARGET(nr)\t(0xA2 + (16 * (nr)))\n#define F71882FG_REG_FAN_FULL_SPEED(nr)\t(0xA4 + (16 * (nr)))\n#define F71882FG_REG_FAN_STATUS\t\t0x92\n#define F71882FG_REG_FAN_BEEP\t\t0x93\n\n#define F71882FG_REG_TEMP(nr)\t\t(0x70 + 2 * (nr))\n#define F71882FG_REG_TEMP_OVT(nr)\t(0x80 + 2 * (nr))\n#define F71882FG_REG_TEMP_HIGH(nr)\t(0x81 + 2 * (nr))\n#define F71882FG_REG_TEMP_STATUS\t0x62\n#define F71882FG_REG_TEMP_BEEP\t\t0x63\n#define F71882FG_REG_TEMP_CONFIG\t0x69\n#define F71882FG_REG_TEMP_HYST(nr)\t(0x6C + (nr))\n#define F71882FG_REG_TEMP_TYPE\t\t0x6B\n#define F71882FG_REG_TEMP_DIODE_OPEN\t0x6F\n\n#define F71882FG_REG_PWM(nr)\t\t(0xA3 + (16 * (nr)))\n#define F71882FG_REG_PWM_TYPE\t\t0x94\n#define F71882FG_REG_PWM_ENABLE\t\t0x96\n\n#define F71882FG_REG_FAN_HYST(nr)\t(0x98 + (nr))\n\n#define F71882FG_REG_FAN_FAULT_T\t0x9F\n#define F71882FG_FAN_NEG_TEMP_EN\t0x20\n#define F71882FG_FAN_PROG_SEL\t\t0x80\n\n#define F71882FG_REG_POINT_PWM(pwm, point)\t(0xAA + (point) + (16 * (pwm)))\n#define F71882FG_REG_POINT_TEMP(pwm, point)\t(0xA6 + (point) + (16 * (pwm)))\n#define F71882FG_REG_POINT_MAPPING(nr)\t\t(0xAF + 16 * (nr))\n\n#define\tF71882FG_REG_START\t\t0x01\n\n#define F71882FG_MAX_INS\t\t11\n\n#define FAN_MIN_DETECT\t\t\t366  \n\nstatic unsigned short force_id;\nmodule_param(force_id, ushort, 0);\nMODULE_PARM_DESC(force_id, \"Override the detected device ID\");\n\nenum chips { f71808e, f71808a, f71858fg, f71862fg, f71868a, f71869, f71869a,\n\tf71882fg, f71889fg, f71889ed, f71889a, f8000, f81768d, f81865f,\n\tf81866a};\n\nstatic const char *const f71882fg_names[] = {\n\t\"f71808e\",\n\t\"f71808a\",\n\t\"f71858fg\",\n\t\"f71862fg\",\n\t\"f71868a\",\n\t\"f71869\",  \n\t\"f71869a\",\n\t\"f71882fg\",\n\t\"f71889fg\",  \n\t\"f71889ed\",\n\t\"f71889a\",\n\t\"f8000\",\n\t\"f81768d\",\n\t\"f81865f\",\n\t\"f81866a\",\n};\n\nstatic const char f71882fg_has_in[][F71882FG_MAX_INS] = {\n\t[f71808e]\t= { 1, 1, 1, 1, 1, 1, 0, 1, 1, 0, 0 },\n\t[f71808a]\t= { 1, 1, 1, 1, 0, 0, 0, 1, 1, 0, 0 },\n\t[f71858fg]\t= { 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0 },\n\t[f71862fg]\t= { 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0 },\n\t[f71868a]\t= { 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0 },\n\t[f71869]\t= { 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0 },\n\t[f71869a]\t= { 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0 },\n\t[f71882fg]\t= { 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0 },\n\t[f71889fg]\t= { 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0 },\n\t[f71889ed]\t= { 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0 },\n\t[f71889a]\t= { 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0 },\n\t[f8000]\t\t= { 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0 },\n\t[f81768d]\t= { 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1 },\n\t[f81865f]\t= { 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0 },\n\t[f81866a]\t= { 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0 },\n};\n\nstatic const char f71882fg_has_in1_alarm[] = {\n\t[f71808e]\t= 0,\n\t[f71808a]\t= 0,\n\t[f71858fg]\t= 0,\n\t[f71862fg]\t= 0,\n\t[f71868a]\t= 0,\n\t[f71869]\t= 0,\n\t[f71869a]\t= 0,\n\t[f71882fg]\t= 1,\n\t[f71889fg]\t= 1,\n\t[f71889ed]\t= 1,\n\t[f71889a]\t= 1,\n\t[f8000]\t\t= 0,\n\t[f81768d]\t= 1,\n\t[f81865f]\t= 1,\n\t[f81866a]\t= 1,\n};\n\nstatic const char f71882fg_fan_has_beep[] = {\n\t[f71808e]\t= 0,\n\t[f71808a]\t= 0,\n\t[f71858fg]\t= 0,\n\t[f71862fg]\t= 1,\n\t[f71868a]\t= 1,\n\t[f71869]\t= 1,\n\t[f71869a]\t= 1,\n\t[f71882fg]\t= 1,\n\t[f71889fg]\t= 1,\n\t[f71889ed]\t= 1,\n\t[f71889a]\t= 1,\n\t[f8000]\t\t= 0,\n\t[f81768d]\t= 1,\n\t[f81865f]\t= 1,\n\t[f81866a]\t= 1,\n};\n\nstatic const char f71882fg_nr_fans[] = {\n\t[f71808e]\t= 3,\n\t[f71808a]\t= 2,  \n\t[f71858fg]\t= 3,\n\t[f71862fg]\t= 3,\n\t[f71868a]\t= 3,\n\t[f71869]\t= 3,\n\t[f71869a]\t= 3,\n\t[f71882fg]\t= 4,\n\t[f71889fg]\t= 3,\n\t[f71889ed]\t= 3,\n\t[f71889a]\t= 3,\n\t[f8000]\t\t= 3,  \n\t[f81768d]\t= 3,\n\t[f81865f]\t= 2,\n\t[f81866a]\t= 3,\n};\n\nstatic const char f71882fg_temp_has_beep[] = {\n\t[f71808e]\t= 0,\n\t[f71808a]\t= 1,\n\t[f71858fg]\t= 0,\n\t[f71862fg]\t= 1,\n\t[f71868a]\t= 1,\n\t[f71869]\t= 1,\n\t[f71869a]\t= 1,\n\t[f71882fg]\t= 1,\n\t[f71889fg]\t= 1,\n\t[f71889ed]\t= 1,\n\t[f71889a]\t= 1,\n\t[f8000]\t\t= 0,\n\t[f81768d]\t= 1,\n\t[f81865f]\t= 1,\n\t[f81866a]\t= 1,\n};\n\nstatic const char f71882fg_nr_temps[] = {\n\t[f71808e]\t= 2,\n\t[f71808a]\t= 2,\n\t[f71858fg]\t= 3,\n\t[f71862fg]\t= 3,\n\t[f71868a]\t= 3,\n\t[f71869]\t= 3,\n\t[f71869a]\t= 3,\n\t[f71882fg]\t= 3,\n\t[f71889fg]\t= 3,\n\t[f71889ed]\t= 3,\n\t[f71889a]\t= 3,\n\t[f8000]\t\t= 3,\n\t[f81768d]\t= 3,\n\t[f81865f]\t= 2,\n\t[f81866a]\t= 3,\n};\n\nstatic struct platform_device *f71882fg_pdev;\n\nstruct f71882fg_sio_data {\n\tenum chips type;\n};\n\nstruct f71882fg_data {\n\tunsigned short addr;\n\tenum chips type;\n\tstruct device *hwmon_dev;\n\n\tstruct mutex update_lock;\n\tint temp_start;\t\t\t \n\tbool valid;\t\t\t \n\tchar auto_point_temp_signed;\n\tunsigned long last_updated;\t \n\tunsigned long last_limits;\t \n\n\t \n\tu8\tin[F71882FG_MAX_INS];\n\tu8\tin1_max;\n\tu8\tin_status;\n\tu8\tin_beep;\n\tu16\tfan[4];\n\tu16\tfan_target[4];\n\tu16\tfan_full_speed[4];\n\tu8\tfan_status;\n\tu8\tfan_beep;\n\t \n\tu16\ttemp[4];\n\tu8\ttemp_ovt[4];\n\tu8\ttemp_high[4];\n\tu8\ttemp_hyst[2];  \n\tu8\ttemp_type[4];\n\tu8\ttemp_status;\n\tu8\ttemp_beep;\n\tu8\ttemp_diode_open;\n\tu8\ttemp_config;\n\tu8\tpwm[4];\n\tu8\tpwm_enable;\n\tu8\tpwm_auto_point_hyst[2];\n\tu8\tpwm_auto_point_mapping[4];\n\tu8\tpwm_auto_point_pwm[4][5];\n\ts8\tpwm_auto_point_temp[4][4];\n};\n\nstatic u8 f71882fg_read8(struct f71882fg_data *data, u8 reg)\n{\n\tu8 val;\n\n\toutb(reg, data->addr + ADDR_REG_OFFSET);\n\tval = inb(data->addr + DATA_REG_OFFSET);\n\n\treturn val;\n}\n\nstatic u16 f71882fg_read16(struct f71882fg_data *data, u8 reg)\n{\n\tu16 val;\n\n\tval  = f71882fg_read8(data, reg) << 8;\n\tval |= f71882fg_read8(data, reg + 1);\n\n\treturn val;\n}\n\nstatic inline int fan_from_reg(u16 reg)\n{\n\treturn reg ? (1500000 / reg) : 0;\n}\n\nstatic inline u16 fan_to_reg(int fan)\n{\n\treturn fan ? (1500000 / fan) : 0;\n}\n\nstatic void f71882fg_write8(struct f71882fg_data *data, u8 reg, u8 val)\n{\n\toutb(reg, data->addr + ADDR_REG_OFFSET);\n\toutb(val, data->addr + DATA_REG_OFFSET);\n}\n\nstatic void f71882fg_write16(struct f71882fg_data *data, u8 reg, u16 val)\n{\n\tf71882fg_write8(data, reg,     val >> 8);\n\tf71882fg_write8(data, reg + 1, val & 0xff);\n}\n\nstatic u16 f71882fg_read_temp(struct f71882fg_data *data, int nr)\n{\n\tif (data->type == f71858fg)\n\t\treturn f71882fg_read16(data, F71882FG_REG_TEMP(nr));\n\telse\n\t\treturn f71882fg_read8(data, F71882FG_REG_TEMP(nr));\n}\n\nstatic struct f71882fg_data *f71882fg_update_device(struct device *dev)\n{\n\tstruct f71882fg_data *data = dev_get_drvdata(dev);\n\tint nr_fans = f71882fg_nr_fans[data->type];\n\tint nr_temps = f71882fg_nr_temps[data->type];\n\tint nr, reg, point;\n\n\tmutex_lock(&data->update_lock);\n\n\t \n\tif (time_after(jiffies, data->last_limits + 60 * HZ) ||\n\t\t\t!data->valid) {\n\t\tif (f71882fg_has_in1_alarm[data->type]) {\n\t\t\tif (data->type == f81866a) {\n\t\t\t\tdata->in1_max =\n\t\t\t\t\tf71882fg_read8(data,\n\t\t\t\t\t\t       F81866_REG_IN1_HIGH);\n\t\t\t\tdata->in_beep =\n\t\t\t\t\tf71882fg_read8(data,\n\t\t\t\t\t\t       F81866_REG_IN_BEEP);\n\t\t\t} else {\n\t\t\t\tdata->in1_max =\n\t\t\t\t\tf71882fg_read8(data,\n\t\t\t\t\t\t       F71882FG_REG_IN1_HIGH);\n\t\t\t\tdata->in_beep =\n\t\t\t\t\tf71882fg_read8(data,\n\t\t\t\t\t\t       F71882FG_REG_IN_BEEP);\n\t\t\t}\n\t\t}\n\n\t\t \n\t\tfor (nr = data->temp_start; nr < nr_temps + data->temp_start;\n\t\t\t\t\t\t\t\t\tnr++) {\n\t\t\tdata->temp_ovt[nr] = f71882fg_read8(data,\n\t\t\t\t\t\tF71882FG_REG_TEMP_OVT(nr));\n\t\t\tdata->temp_high[nr] = f71882fg_read8(data,\n\t\t\t\t\t\tF71882FG_REG_TEMP_HIGH(nr));\n\t\t}\n\n\t\tif (data->type != f8000) {\n\t\t\tdata->temp_hyst[0] = f71882fg_read8(data,\n\t\t\t\t\t\tF71882FG_REG_TEMP_HYST(0));\n\t\t\tdata->temp_hyst[1] = f71882fg_read8(data,\n\t\t\t\t\t\tF71882FG_REG_TEMP_HYST(1));\n\t\t}\n\t\t \n\t\tif ((data->type != f71858fg) && (data->type != f8000)) {\n\t\t\treg  = f71882fg_read8(data, F71882FG_REG_TEMP_TYPE);\n\t\t\tdata->temp_type[1] = (reg & 0x02) ? 2 : 4;\n\t\t\tdata->temp_type[2] = (reg & 0x04) ? 2 : 4;\n\t\t\tdata->temp_type[3] = (reg & 0x08) ? 2 : 4;\n\t\t}\n\n\t\tif (f71882fg_fan_has_beep[data->type])\n\t\t\tdata->fan_beep = f71882fg_read8(data,\n\t\t\t\t\t\tF71882FG_REG_FAN_BEEP);\n\n\t\tif (f71882fg_temp_has_beep[data->type])\n\t\t\tdata->temp_beep = f71882fg_read8(data,\n\t\t\t\t\t\tF71882FG_REG_TEMP_BEEP);\n\n\t\tdata->pwm_enable = f71882fg_read8(data,\n\t\t\t\t\t\t  F71882FG_REG_PWM_ENABLE);\n\t\tdata->pwm_auto_point_hyst[0] =\n\t\t\tf71882fg_read8(data, F71882FG_REG_FAN_HYST(0));\n\t\tdata->pwm_auto_point_hyst[1] =\n\t\t\tf71882fg_read8(data, F71882FG_REG_FAN_HYST(1));\n\n\t\tfor (nr = 0; nr < nr_fans; nr++) {\n\t\t\tdata->pwm_auto_point_mapping[nr] =\n\t\t\t    f71882fg_read8(data,\n\t\t\t\t\t   F71882FG_REG_POINT_MAPPING(nr));\n\n\t\t\tswitch (data->type) {\n\t\t\tdefault:\n\t\t\t\tfor (point = 0; point < 5; point++) {\n\t\t\t\t\tdata->pwm_auto_point_pwm[nr][point] =\n\t\t\t\t\t\tf71882fg_read8(data,\n\t\t\t\t\t\t\tF71882FG_REG_POINT_PWM\n\t\t\t\t\t\t\t(nr, point));\n\t\t\t\t}\n\t\t\t\tfor (point = 0; point < 4; point++) {\n\t\t\t\t\tdata->pwm_auto_point_temp[nr][point] =\n\t\t\t\t\t\tf71882fg_read8(data,\n\t\t\t\t\t\t\tF71882FG_REG_POINT_TEMP\n\t\t\t\t\t\t\t(nr, point));\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase f71808e:\n\t\t\tcase f71869:\n\t\t\t\tdata->pwm_auto_point_pwm[nr][0] =\n\t\t\t\t\tf71882fg_read8(data,\n\t\t\t\t\t\tF71882FG_REG_POINT_PWM(nr, 0));\n\t\t\t\tfallthrough;\n\t\t\tcase f71862fg:\n\t\t\t\tdata->pwm_auto_point_pwm[nr][1] =\n\t\t\t\t\tf71882fg_read8(data,\n\t\t\t\t\t\tF71882FG_REG_POINT_PWM\n\t\t\t\t\t\t(nr, 1));\n\t\t\t\tdata->pwm_auto_point_pwm[nr][4] =\n\t\t\t\t\tf71882fg_read8(data,\n\t\t\t\t\t\tF71882FG_REG_POINT_PWM\n\t\t\t\t\t\t(nr, 4));\n\t\t\t\tdata->pwm_auto_point_temp[nr][0] =\n\t\t\t\t\tf71882fg_read8(data,\n\t\t\t\t\t\tF71882FG_REG_POINT_TEMP\n\t\t\t\t\t\t(nr, 0));\n\t\t\t\tdata->pwm_auto_point_temp[nr][3] =\n\t\t\t\t\tf71882fg_read8(data,\n\t\t\t\t\t\tF71882FG_REG_POINT_TEMP\n\t\t\t\t\t\t(nr, 3));\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tdata->last_limits = jiffies;\n\t}\n\n\t \n\tif (time_after(jiffies, data->last_updated + HZ) || !data->valid) {\n\t\tdata->temp_status = f71882fg_read8(data,\n\t\t\t\t\t\tF71882FG_REG_TEMP_STATUS);\n\t\tdata->temp_diode_open = f71882fg_read8(data,\n\t\t\t\t\t\tF71882FG_REG_TEMP_DIODE_OPEN);\n\t\tfor (nr = data->temp_start; nr < nr_temps + data->temp_start;\n\t\t\t\t\t\t\t\t\tnr++)\n\t\t\tdata->temp[nr] = f71882fg_read_temp(data, nr);\n\n\t\tdata->fan_status = f71882fg_read8(data,\n\t\t\t\t\t\tF71882FG_REG_FAN_STATUS);\n\t\tfor (nr = 0; nr < nr_fans; nr++) {\n\t\t\tdata->fan[nr] = f71882fg_read16(data,\n\t\t\t\t\t\tF71882FG_REG_FAN(nr));\n\t\t\tdata->fan_target[nr] =\n\t\t\t    f71882fg_read16(data, F71882FG_REG_FAN_TARGET(nr));\n\t\t\tdata->fan_full_speed[nr] =\n\t\t\t    f71882fg_read16(data,\n\t\t\t\t\t    F71882FG_REG_FAN_FULL_SPEED(nr));\n\t\t\tdata->pwm[nr] =\n\t\t\t    f71882fg_read8(data, F71882FG_REG_PWM(nr));\n\t\t}\n\t\t \n\t\tif (data->type == f71808a) {\n\t\t\tdata->fan[2] = f71882fg_read16(data,\n\t\t\t\t\t\tF71882FG_REG_FAN(2));\n\t\t\tdata->pwm[2] = f71882fg_read8(data,\n\t\t\t\t\t\t\tF71882FG_REG_PWM(2));\n\t\t}\n\t\tif (data->type == f8000)\n\t\t\tdata->fan[3] = f71882fg_read16(data,\n\t\t\t\t\t\tF71882FG_REG_FAN(3));\n\n\t\tif (f71882fg_has_in1_alarm[data->type]) {\n\t\t\tif (data->type == f81866a)\n\t\t\t\tdata->in_status = f71882fg_read8(data,\n\t\t\t\t\t\tF81866_REG_IN_STATUS);\n\n\t\t\telse\n\t\t\t\tdata->in_status = f71882fg_read8(data,\n\t\t\t\t\t\tF71882FG_REG_IN_STATUS);\n\t\t}\n\n\t\tfor (nr = 0; nr < F71882FG_MAX_INS; nr++)\n\t\t\tif (f71882fg_has_in[data->type][nr])\n\t\t\t\tdata->in[nr] = f71882fg_read8(data,\n\t\t\t\t\t\t\tF71882FG_REG_IN(nr));\n\n\t\tdata->last_updated = jiffies;\n\t\tdata->valid = true;\n\t}\n\n\tmutex_unlock(&data->update_lock);\n\n\treturn data;\n}\n\nstatic ssize_t name_show(struct device *dev, struct device_attribute *devattr,\n\tchar *buf)\n{\n\tstruct f71882fg_data *data = dev_get_drvdata(dev);\n\treturn sprintf(buf, \"%s\\n\", f71882fg_names[data->type]);\n}\n\nstatic DEVICE_ATTR_RO(name);\n\nstatic ssize_t show_temp(struct device *dev, struct device_attribute *devattr,\n\tchar *buf)\n{\n\tstruct f71882fg_data *data = f71882fg_update_device(dev);\n\tint nr = to_sensor_dev_attr_2(devattr)->index;\n\tint sign, temp;\n\n\tif (data->type == f71858fg) {\n\t\t \n\t\tif (data->temp_config & 1) {\n\t\t\tsign = data->temp[nr] & 0x0001;\n\t\t\ttemp = (data->temp[nr] >> 5) & 0x7ff;\n\t\t} else {\n\t\t\tsign = data->temp[nr] & 0x8000;\n\t\t\ttemp = (data->temp[nr] >> 5) & 0x3ff;\n\t\t}\n\t\ttemp *= 125;\n\t\tif (sign)\n\t\t\ttemp -= 128000;\n\t} else {\n\t\ttemp = ((s8)data->temp[nr]) * 1000;\n\t}\n\n\treturn sprintf(buf, \"%d\\n\", temp);\n}\n\nstatic ssize_t show_temp_max(struct device *dev, struct device_attribute\n\t*devattr, char *buf)\n{\n\tstruct f71882fg_data *data = f71882fg_update_device(dev);\n\tint nr = to_sensor_dev_attr_2(devattr)->index;\n\n\treturn sprintf(buf, \"%d\\n\", data->temp_high[nr] * 1000);\n}\n\nstatic ssize_t store_temp_max(struct device *dev, struct device_attribute\n\t*devattr, const char *buf, size_t count)\n{\n\tstruct f71882fg_data *data = dev_get_drvdata(dev);\n\tint err, nr = to_sensor_dev_attr_2(devattr)->index;\n\tlong val;\n\n\terr = kstrtol(buf, 10, &val);\n\tif (err)\n\t\treturn err;\n\n\tval /= 1000;\n\tval = clamp_val(val, 0, 255);\n\n\tmutex_lock(&data->update_lock);\n\tf71882fg_write8(data, F71882FG_REG_TEMP_HIGH(nr), val);\n\tdata->temp_high[nr] = val;\n\tmutex_unlock(&data->update_lock);\n\n\treturn count;\n}\n\nstatic ssize_t show_temp_max_hyst(struct device *dev, struct device_attribute\n\t*devattr, char *buf)\n{\n\tstruct f71882fg_data *data = f71882fg_update_device(dev);\n\tint nr = to_sensor_dev_attr_2(devattr)->index;\n\tint temp_max_hyst;\n\n\tmutex_lock(&data->update_lock);\n\tif (nr & 1)\n\t\ttemp_max_hyst = data->temp_hyst[nr / 2] >> 4;\n\telse\n\t\ttemp_max_hyst = data->temp_hyst[nr / 2] & 0x0f;\n\ttemp_max_hyst = (data->temp_high[nr] - temp_max_hyst) * 1000;\n\tmutex_unlock(&data->update_lock);\n\n\treturn sprintf(buf, \"%d\\n\", temp_max_hyst);\n}\n\nstatic ssize_t store_temp_max_hyst(struct device *dev, struct device_attribute\n\t*devattr, const char *buf, size_t count)\n{\n\tstruct f71882fg_data *data = dev_get_drvdata(dev);\n\tint err, nr = to_sensor_dev_attr_2(devattr)->index;\n\tssize_t ret = count;\n\tu8 reg;\n\tlong val;\n\n\terr = kstrtol(buf, 10, &val);\n\tif (err)\n\t\treturn err;\n\n\tval /= 1000;\n\n\tmutex_lock(&data->update_lock);\n\n\t \n\tdata->temp_high[nr] = f71882fg_read8(data, F71882FG_REG_TEMP_HIGH(nr));\n\tval = clamp_val(val, data->temp_high[nr] - 15, data->temp_high[nr]);\n\tval = data->temp_high[nr] - val;\n\n\t \n\treg = f71882fg_read8(data, F71882FG_REG_TEMP_HYST(nr / 2));\n\tif (nr & 1)\n\t\treg = (reg & 0x0f) | (val << 4);\n\telse\n\t\treg = (reg & 0xf0) | val;\n\tf71882fg_write8(data, F71882FG_REG_TEMP_HYST(nr / 2), reg);\n\tdata->temp_hyst[nr / 2] = reg;\n\n\tmutex_unlock(&data->update_lock);\n\treturn ret;\n}\n\nstatic ssize_t show_temp_alarm(struct device *dev, struct device_attribute\n\t*devattr, char *buf)\n{\n\tstruct f71882fg_data *data = f71882fg_update_device(dev);\n\tint nr = to_sensor_dev_attr_2(devattr)->index;\n\n\tif (data->temp_status & (1 << nr))\n\t\treturn sprintf(buf, \"1\\n\");\n\telse\n\t\treturn sprintf(buf, \"0\\n\");\n}\n\nstatic ssize_t show_temp_crit(struct device *dev, struct device_attribute\n\t*devattr, char *buf)\n{\n\tstruct f71882fg_data *data = f71882fg_update_device(dev);\n\tint nr = to_sensor_dev_attr_2(devattr)->index;\n\n\treturn sprintf(buf, \"%d\\n\", data->temp_ovt[nr] * 1000);\n}\n\nstatic ssize_t store_temp_crit(struct device *dev, struct device_attribute\n\t*devattr, const char *buf, size_t count)\n{\n\tstruct f71882fg_data *data = dev_get_drvdata(dev);\n\tint err, nr = to_sensor_dev_attr_2(devattr)->index;\n\tlong val;\n\n\terr = kstrtol(buf, 10, &val);\n\tif (err)\n\t\treturn err;\n\n\tval /= 1000;\n\tval = clamp_val(val, 0, 255);\n\n\tmutex_lock(&data->update_lock);\n\tf71882fg_write8(data, F71882FG_REG_TEMP_OVT(nr), val);\n\tdata->temp_ovt[nr] = val;\n\tmutex_unlock(&data->update_lock);\n\n\treturn count;\n}\n\nstatic ssize_t show_temp_crit_hyst(struct device *dev, struct device_attribute\n\t*devattr, char *buf)\n{\n\tstruct f71882fg_data *data = f71882fg_update_device(dev);\n\tint nr = to_sensor_dev_attr_2(devattr)->index;\n\tint temp_crit_hyst;\n\n\tmutex_lock(&data->update_lock);\n\tif (nr & 1)\n\t\ttemp_crit_hyst = data->temp_hyst[nr / 2] >> 4;\n\telse\n\t\ttemp_crit_hyst = data->temp_hyst[nr / 2] & 0x0f;\n\ttemp_crit_hyst = (data->temp_ovt[nr] - temp_crit_hyst) * 1000;\n\tmutex_unlock(&data->update_lock);\n\n\treturn sprintf(buf, \"%d\\n\", temp_crit_hyst);\n}\n\nstatic ssize_t show_temp_fault(struct device *dev, struct device_attribute\n\t*devattr, char *buf)\n{\n\tstruct f71882fg_data *data = f71882fg_update_device(dev);\n\tint nr = to_sensor_dev_attr_2(devattr)->index;\n\n\tif (data->temp_diode_open & (1 << nr))\n\t\treturn sprintf(buf, \"1\\n\");\n\telse\n\t\treturn sprintf(buf, \"0\\n\");\n}\n\n \nstatic struct sensor_device_attribute_2 f71858fg_temp_attr[] = {\n\tSENSOR_ATTR_2(temp1_input, S_IRUGO, show_temp, NULL, 0, 0),\n\tSENSOR_ATTR_2(temp1_max, S_IRUGO|S_IWUSR, show_temp_max,\n\t\tstore_temp_max, 0, 0),\n\tSENSOR_ATTR_2(temp1_max_hyst, S_IRUGO|S_IWUSR, show_temp_max_hyst,\n\t\tstore_temp_max_hyst, 0, 0),\n\tSENSOR_ATTR_2(temp1_max_alarm, S_IRUGO, show_temp_alarm, NULL, 0, 0),\n\tSENSOR_ATTR_2(temp1_crit, S_IRUGO|S_IWUSR, show_temp_crit,\n\t\tstore_temp_crit, 0, 0),\n\tSENSOR_ATTR_2(temp1_crit_hyst, S_IRUGO, show_temp_crit_hyst, NULL,\n\t\t0, 0),\n\tSENSOR_ATTR_2(temp1_crit_alarm, S_IRUGO, show_temp_alarm, NULL, 0, 4),\n\tSENSOR_ATTR_2(temp1_fault, S_IRUGO, show_temp_fault, NULL, 0, 0),\n\tSENSOR_ATTR_2(temp2_input, S_IRUGO, show_temp, NULL, 0, 1),\n\tSENSOR_ATTR_2(temp2_max, S_IRUGO|S_IWUSR, show_temp_max,\n\t\tstore_temp_max, 0, 1),\n\tSENSOR_ATTR_2(temp2_max_hyst, S_IRUGO|S_IWUSR, show_temp_max_hyst,\n\t\tstore_temp_max_hyst, 0, 1),\n\tSENSOR_ATTR_2(temp2_max_alarm, S_IRUGO, show_temp_alarm, NULL, 0, 1),\n\tSENSOR_ATTR_2(temp2_crit, S_IRUGO|S_IWUSR, show_temp_crit,\n\t\tstore_temp_crit, 0, 1),\n\tSENSOR_ATTR_2(temp2_crit_hyst, S_IRUGO, show_temp_crit_hyst, NULL,\n\t\t0, 1),\n\tSENSOR_ATTR_2(temp2_crit_alarm, S_IRUGO, show_temp_alarm, NULL, 0, 5),\n\tSENSOR_ATTR_2(temp2_fault, S_IRUGO, show_temp_fault, NULL, 0, 1),\n\tSENSOR_ATTR_2(temp3_input, S_IRUGO, show_temp, NULL, 0, 2),\n\tSENSOR_ATTR_2(temp3_max, S_IRUGO|S_IWUSR, show_temp_max,\n\t\tstore_temp_max, 0, 2),\n\tSENSOR_ATTR_2(temp3_max_hyst, S_IRUGO|S_IWUSR, show_temp_max_hyst,\n\t\tstore_temp_max_hyst, 0, 2),\n\tSENSOR_ATTR_2(temp3_max_alarm, S_IRUGO, show_temp_alarm, NULL, 0, 2),\n\tSENSOR_ATTR_2(temp3_crit, S_IRUGO|S_IWUSR, show_temp_crit,\n\t\tstore_temp_crit, 0, 2),\n\tSENSOR_ATTR_2(temp3_crit_hyst, S_IRUGO, show_temp_crit_hyst, NULL,\n\t\t0, 2),\n\tSENSOR_ATTR_2(temp3_crit_alarm, S_IRUGO, show_temp_alarm, NULL, 0, 6),\n\tSENSOR_ATTR_2(temp3_fault, S_IRUGO, show_temp_fault, NULL, 0, 2),\n};\n\nstatic ssize_t show_temp_type(struct device *dev, struct device_attribute\n\t*devattr, char *buf)\n{\n\tstruct f71882fg_data *data = f71882fg_update_device(dev);\n\tint nr = to_sensor_dev_attr_2(devattr)->index;\n\n\treturn sprintf(buf, \"%d\\n\", data->temp_type[nr]);\n}\n\n \nstatic struct sensor_device_attribute_2 fxxxx_temp_attr[3][9] = { {\n\tSENSOR_ATTR_2(temp1_input, S_IRUGO, show_temp, NULL, 0, 1),\n\tSENSOR_ATTR_2(temp1_max, S_IRUGO|S_IWUSR, show_temp_max,\n\t\tstore_temp_max, 0, 1),\n\tSENSOR_ATTR_2(temp1_max_hyst, S_IRUGO|S_IWUSR, show_temp_max_hyst,\n\t\tstore_temp_max_hyst, 0, 1),\n\t \n\tSENSOR_ATTR_2(temp1_alarm, S_IRUGO, show_temp_alarm, NULL, 0, 1),\n\tSENSOR_ATTR_2(temp1_crit, S_IRUGO|S_IWUSR, show_temp_crit,\n\t\tstore_temp_crit, 0, 1),\n\tSENSOR_ATTR_2(temp1_crit_hyst, S_IRUGO, show_temp_crit_hyst, NULL,\n\t\t0, 1),\n\tSENSOR_ATTR_2(temp1_crit_alarm, S_IRUGO, show_temp_alarm, NULL, 0, 5),\n\tSENSOR_ATTR_2(temp1_type, S_IRUGO, show_temp_type, NULL, 0, 1),\n\tSENSOR_ATTR_2(temp1_fault, S_IRUGO, show_temp_fault, NULL, 0, 1),\n}, {\n\tSENSOR_ATTR_2(temp2_input, S_IRUGO, show_temp, NULL, 0, 2),\n\tSENSOR_ATTR_2(temp2_max, S_IRUGO|S_IWUSR, show_temp_max,\n\t\tstore_temp_max, 0, 2),\n\tSENSOR_ATTR_2(temp2_max_hyst, S_IRUGO|S_IWUSR, show_temp_max_hyst,\n\t\tstore_temp_max_hyst, 0, 2),\n\t \n\tSENSOR_ATTR_2(temp2_alarm, S_IRUGO, show_temp_alarm, NULL, 0, 2),\n\tSENSOR_ATTR_2(temp2_crit, S_IRUGO|S_IWUSR, show_temp_crit,\n\t\tstore_temp_crit, 0, 2),\n\tSENSOR_ATTR_2(temp2_crit_hyst, S_IRUGO, show_temp_crit_hyst, NULL,\n\t\t0, 2),\n\tSENSOR_ATTR_2(temp2_crit_alarm, S_IRUGO, show_temp_alarm, NULL, 0, 6),\n\tSENSOR_ATTR_2(temp2_type, S_IRUGO, show_temp_type, NULL, 0, 2),\n\tSENSOR_ATTR_2(temp2_fault, S_IRUGO, show_temp_fault, NULL, 0, 2),\n}, {\n\tSENSOR_ATTR_2(temp3_input, S_IRUGO, show_temp, NULL, 0, 3),\n\tSENSOR_ATTR_2(temp3_max, S_IRUGO|S_IWUSR, show_temp_max,\n\t\tstore_temp_max, 0, 3),\n\tSENSOR_ATTR_2(temp3_max_hyst, S_IRUGO|S_IWUSR, show_temp_max_hyst,\n\t\tstore_temp_max_hyst, 0, 3),\n\t \n\tSENSOR_ATTR_2(temp3_alarm, S_IRUGO, show_temp_alarm, NULL, 0, 3),\n\tSENSOR_ATTR_2(temp3_crit, S_IRUGO|S_IWUSR, show_temp_crit,\n\t\tstore_temp_crit, 0, 3),\n\tSENSOR_ATTR_2(temp3_crit_hyst, S_IRUGO, show_temp_crit_hyst, NULL,\n\t\t0, 3),\n\tSENSOR_ATTR_2(temp3_crit_alarm, S_IRUGO, show_temp_alarm, NULL, 0, 7),\n\tSENSOR_ATTR_2(temp3_type, S_IRUGO, show_temp_type, NULL, 0, 3),\n\tSENSOR_ATTR_2(temp3_fault, S_IRUGO, show_temp_fault, NULL, 0, 3),\n} };\n\nstatic ssize_t show_temp_beep(struct device *dev, struct device_attribute\n\t*devattr, char *buf)\n{\n\tstruct f71882fg_data *data = f71882fg_update_device(dev);\n\tint nr = to_sensor_dev_attr_2(devattr)->index;\n\n\tif (data->temp_beep & (1 << nr))\n\t\treturn sprintf(buf, \"1\\n\");\n\telse\n\t\treturn sprintf(buf, \"0\\n\");\n}\n\nstatic ssize_t store_temp_beep(struct device *dev, struct device_attribute\n\t*devattr, const char *buf, size_t count)\n{\n\tstruct f71882fg_data *data = dev_get_drvdata(dev);\n\tint err, nr = to_sensor_dev_attr_2(devattr)->index;\n\tunsigned long val;\n\n\terr = kstrtoul(buf, 10, &val);\n\tif (err)\n\t\treturn err;\n\n\tmutex_lock(&data->update_lock);\n\tdata->temp_beep = f71882fg_read8(data, F71882FG_REG_TEMP_BEEP);\n\tif (val)\n\t\tdata->temp_beep |= 1 << nr;\n\telse\n\t\tdata->temp_beep &= ~(1 << nr);\n\n\tf71882fg_write8(data, F71882FG_REG_TEMP_BEEP, data->temp_beep);\n\tmutex_unlock(&data->update_lock);\n\n\treturn count;\n}\n\n \nstatic struct sensor_device_attribute_2 fxxxx_temp_beep_attr[3][2] = { {\n\tSENSOR_ATTR_2(temp1_max_beep, S_IRUGO|S_IWUSR, show_temp_beep,\n\t\tstore_temp_beep, 0, 1),\n\tSENSOR_ATTR_2(temp1_crit_beep, S_IRUGO|S_IWUSR, show_temp_beep,\n\t\tstore_temp_beep, 0, 5),\n}, {\n\tSENSOR_ATTR_2(temp2_max_beep, S_IRUGO|S_IWUSR, show_temp_beep,\n\t\tstore_temp_beep, 0, 2),\n\tSENSOR_ATTR_2(temp2_crit_beep, S_IRUGO|S_IWUSR, show_temp_beep,\n\t\tstore_temp_beep, 0, 6),\n}, {\n\tSENSOR_ATTR_2(temp3_max_beep, S_IRUGO|S_IWUSR, show_temp_beep,\n\t\tstore_temp_beep, 0, 3),\n\tSENSOR_ATTR_2(temp3_crit_beep, S_IRUGO|S_IWUSR, show_temp_beep,\n\t\tstore_temp_beep, 0, 7),\n} };\n\nstatic struct sensor_device_attribute_2 f81866_temp_beep_attr[3][2] = { {\n\tSENSOR_ATTR_2(temp1_max_beep, S_IRUGO|S_IWUSR, show_temp_beep,\n\t\tstore_temp_beep, 0, 0),\n\tSENSOR_ATTR_2(temp1_crit_beep, S_IRUGO|S_IWUSR, show_temp_beep,\n\t\tstore_temp_beep, 0, 4),\n}, {\n\tSENSOR_ATTR_2(temp2_max_beep, S_IRUGO|S_IWUSR, show_temp_beep,\n\t\tstore_temp_beep, 0, 1),\n\tSENSOR_ATTR_2(temp2_crit_beep, S_IRUGO|S_IWUSR, show_temp_beep,\n\t\tstore_temp_beep, 0, 5),\n}, {\n\tSENSOR_ATTR_2(temp3_max_beep, S_IRUGO|S_IWUSR, show_temp_beep,\n\t\tstore_temp_beep, 0, 2),\n\tSENSOR_ATTR_2(temp3_crit_beep, S_IRUGO|S_IWUSR, show_temp_beep,\n\t\tstore_temp_beep, 0, 6),\n} };\n\n \nstatic struct sensor_device_attribute_2 f8000_temp_attr[] = {\n\tSENSOR_ATTR_2(temp1_input, S_IRUGO, show_temp, NULL, 0, 0),\n\tSENSOR_ATTR_2(temp1_max, S_IRUGO|S_IWUSR, show_temp_crit,\n\t\tstore_temp_crit, 0, 0),\n\tSENSOR_ATTR_2(temp1_max_hyst, S_IRUGO|S_IWUSR, show_temp_max,\n\t\tstore_temp_max, 0, 0),\n\tSENSOR_ATTR_2(temp1_alarm, S_IRUGO, show_temp_alarm, NULL, 0, 4),\n\tSENSOR_ATTR_2(temp1_fault, S_IRUGO, show_temp_fault, NULL, 0, 0),\n\tSENSOR_ATTR_2(temp2_input, S_IRUGO, show_temp, NULL, 0, 1),\n\tSENSOR_ATTR_2(temp2_max, S_IRUGO|S_IWUSR, show_temp_crit,\n\t\tstore_temp_crit, 0, 1),\n\tSENSOR_ATTR_2(temp2_max_hyst, S_IRUGO|S_IWUSR, show_temp_max,\n\t\tstore_temp_max, 0, 1),\n\tSENSOR_ATTR_2(temp2_alarm, S_IRUGO, show_temp_alarm, NULL, 0, 5),\n\tSENSOR_ATTR_2(temp2_fault, S_IRUGO, show_temp_fault, NULL, 0, 1),\n\tSENSOR_ATTR_2(temp3_input, S_IRUGO, show_temp, NULL, 0, 2),\n\tSENSOR_ATTR_2(temp3_max, S_IRUGO|S_IWUSR, show_temp_crit,\n\t\tstore_temp_crit, 0, 2),\n\tSENSOR_ATTR_2(temp3_max_hyst, S_IRUGO|S_IWUSR, show_temp_max,\n\t\tstore_temp_max, 0, 2),\n\tSENSOR_ATTR_2(temp3_alarm, S_IRUGO, show_temp_alarm, NULL, 0, 6),\n\tSENSOR_ATTR_2(temp3_fault, S_IRUGO, show_temp_fault, NULL, 0, 2),\n};\n\nstatic ssize_t show_in(struct device *dev, struct device_attribute *devattr,\n\tchar *buf)\n{\n\tstruct f71882fg_data *data = f71882fg_update_device(dev);\n\tint nr = to_sensor_dev_attr_2(devattr)->index;\n\n\treturn sprintf(buf, \"%d\\n\", data->in[nr] * 8);\n}\n\n \nstatic struct sensor_device_attribute_2 fxxxx_in_attr[] = {\n\tSENSOR_ATTR_2(in0_input, S_IRUGO, show_in, NULL, 0, 0),\n\tSENSOR_ATTR_2(in1_input, S_IRUGO, show_in, NULL, 0, 1),\n\tSENSOR_ATTR_2(in2_input, S_IRUGO, show_in, NULL, 0, 2),\n\tSENSOR_ATTR_2(in3_input, S_IRUGO, show_in, NULL, 0, 3),\n\tSENSOR_ATTR_2(in4_input, S_IRUGO, show_in, NULL, 0, 4),\n\tSENSOR_ATTR_2(in5_input, S_IRUGO, show_in, NULL, 0, 5),\n\tSENSOR_ATTR_2(in6_input, S_IRUGO, show_in, NULL, 0, 6),\n\tSENSOR_ATTR_2(in7_input, S_IRUGO, show_in, NULL, 0, 7),\n\tSENSOR_ATTR_2(in8_input, S_IRUGO, show_in, NULL, 0, 8),\n\tSENSOR_ATTR_2(in9_input, S_IRUGO, show_in, NULL, 0, 9),\n\tSENSOR_ATTR_2(in10_input, S_IRUGO, show_in, NULL, 0, 10),\n};\n\nstatic ssize_t show_in_max(struct device *dev, struct device_attribute\n\t*devattr, char *buf)\n{\n\tstruct f71882fg_data *data = f71882fg_update_device(dev);\n\n\treturn sprintf(buf, \"%d\\n\", data->in1_max * 8);\n}\n\nstatic ssize_t store_in_max(struct device *dev, struct device_attribute\n\t*devattr, const char *buf, size_t count)\n{\n\tstruct f71882fg_data *data = dev_get_drvdata(dev);\n\tint err;\n\tlong val;\n\n\terr = kstrtol(buf, 10, &val);\n\tif (err)\n\t\treturn err;\n\n\tval /= 8;\n\tval = clamp_val(val, 0, 255);\n\n\tmutex_lock(&data->update_lock);\n\tif (data->type == f81866a)\n\t\tf71882fg_write8(data, F81866_REG_IN1_HIGH, val);\n\telse\n\t\tf71882fg_write8(data, F71882FG_REG_IN1_HIGH, val);\n\tdata->in1_max = val;\n\tmutex_unlock(&data->update_lock);\n\n\treturn count;\n}\n\nstatic ssize_t show_in_beep(struct device *dev, struct device_attribute\n\t*devattr, char *buf)\n{\n\tstruct f71882fg_data *data = f71882fg_update_device(dev);\n\tint nr = to_sensor_dev_attr_2(devattr)->index;\n\n\tif (data->in_beep & (1 << nr))\n\t\treturn sprintf(buf, \"1\\n\");\n\telse\n\t\treturn sprintf(buf, \"0\\n\");\n}\n\nstatic ssize_t store_in_beep(struct device *dev, struct device_attribute\n\t*devattr, const char *buf, size_t count)\n{\n\tstruct f71882fg_data *data = dev_get_drvdata(dev);\n\tint err, nr = to_sensor_dev_attr_2(devattr)->index;\n\tunsigned long val;\n\n\terr = kstrtoul(buf, 10, &val);\n\tif (err)\n\t\treturn err;\n\n\tmutex_lock(&data->update_lock);\n\tif (data->type == f81866a)\n\t\tdata->in_beep = f71882fg_read8(data, F81866_REG_IN_BEEP);\n\telse\n\t\tdata->in_beep = f71882fg_read8(data, F71882FG_REG_IN_BEEP);\n\n\tif (val)\n\t\tdata->in_beep |= 1 << nr;\n\telse\n\t\tdata->in_beep &= ~(1 << nr);\n\n\tif (data->type == f81866a)\n\t\tf71882fg_write8(data, F81866_REG_IN_BEEP, data->in_beep);\n\telse\n\t\tf71882fg_write8(data, F71882FG_REG_IN_BEEP, data->in_beep);\n\tmutex_unlock(&data->update_lock);\n\n\treturn count;\n}\n\nstatic ssize_t show_in_alarm(struct device *dev, struct device_attribute\n\t*devattr, char *buf)\n{\n\tstruct f71882fg_data *data = f71882fg_update_device(dev);\n\tint nr = to_sensor_dev_attr_2(devattr)->index;\n\n\tif (data->in_status & (1 << nr))\n\t\treturn sprintf(buf, \"1\\n\");\n\telse\n\t\treturn sprintf(buf, \"0\\n\");\n}\n\n \nstatic struct sensor_device_attribute_2 fxxxx_in1_alarm_attr[] = {\n\tSENSOR_ATTR_2(in1_max, S_IRUGO|S_IWUSR, show_in_max, store_in_max,\n\t\t0, 1),\n\tSENSOR_ATTR_2(in1_beep, S_IRUGO|S_IWUSR, show_in_beep, store_in_beep,\n\t\t0, 1),\n\tSENSOR_ATTR_2(in1_alarm, S_IRUGO, show_in_alarm, NULL, 0, 1),\n};\n\nstatic ssize_t show_fan(struct device *dev, struct device_attribute *devattr,\n\tchar *buf)\n{\n\tstruct f71882fg_data *data = f71882fg_update_device(dev);\n\tint nr = to_sensor_dev_attr_2(devattr)->index;\n\tint speed = fan_from_reg(data->fan[nr]);\n\n\tif (speed == FAN_MIN_DETECT)\n\t\tspeed = 0;\n\n\treturn sprintf(buf, \"%d\\n\", speed);\n}\n\nstatic ssize_t show_fan_full_speed(struct device *dev,\n\t\t\t\t   struct device_attribute *devattr, char *buf)\n{\n\tstruct f71882fg_data *data = f71882fg_update_device(dev);\n\tint nr = to_sensor_dev_attr_2(devattr)->index;\n\tint speed = fan_from_reg(data->fan_full_speed[nr]);\n\treturn sprintf(buf, \"%d\\n\", speed);\n}\n\nstatic ssize_t store_fan_full_speed(struct device *dev,\n\t\t\t\t    struct device_attribute *devattr,\n\t\t\t\t    const char *buf, size_t count)\n{\n\tstruct f71882fg_data *data = dev_get_drvdata(dev);\n\tint err, nr = to_sensor_dev_attr_2(devattr)->index;\n\tlong val;\n\n\terr = kstrtol(buf, 10, &val);\n\tif (err)\n\t\treturn err;\n\n\tval = clamp_val(val, 23, 1500000);\n\tval = fan_to_reg(val);\n\n\tmutex_lock(&data->update_lock);\n\tf71882fg_write16(data, F71882FG_REG_FAN_FULL_SPEED(nr), val);\n\tdata->fan_full_speed[nr] = val;\n\tmutex_unlock(&data->update_lock);\n\n\treturn count;\n}\n\nstatic ssize_t show_fan_alarm(struct device *dev, struct device_attribute\n\t*devattr, char *buf)\n{\n\tstruct f71882fg_data *data = f71882fg_update_device(dev);\n\tint nr = to_sensor_dev_attr_2(devattr)->index;\n\n\tif (data->fan_status & (1 << nr))\n\t\treturn sprintf(buf, \"1\\n\");\n\telse\n\t\treturn sprintf(buf, \"0\\n\");\n}\n\nstatic ssize_t show_pwm(struct device *dev,\n\t\t\tstruct device_attribute *devattr, char *buf)\n{\n\tstruct f71882fg_data *data = f71882fg_update_device(dev);\n\tint val, nr = to_sensor_dev_attr_2(devattr)->index;\n\tmutex_lock(&data->update_lock);\n\tif (data->pwm_enable & (1 << (2 * nr)))\n\t\t \n\t\tval = data->pwm[nr];\n\telse {\n\t\t \n\t\tif (fan_from_reg(data->fan_full_speed[nr]))\n\t\t\tval = 255 * fan_from_reg(data->fan_target[nr])\n\t\t\t\t/ fan_from_reg(data->fan_full_speed[nr]);\n\t\telse\n\t\t\tval = 0;\n\t}\n\tmutex_unlock(&data->update_lock);\n\treturn sprintf(buf, \"%d\\n\", val);\n}\n\nstatic ssize_t store_pwm(struct device *dev,\n\t\t\t struct device_attribute *devattr, const char *buf,\n\t\t\t size_t count)\n{\n\tstruct f71882fg_data *data = dev_get_drvdata(dev);\n\tint err, nr = to_sensor_dev_attr_2(devattr)->index;\n\tlong val;\n\n\terr = kstrtol(buf, 10, &val);\n\tif (err)\n\t\treturn err;\n\n\tval = clamp_val(val, 0, 255);\n\n\tmutex_lock(&data->update_lock);\n\tdata->pwm_enable = f71882fg_read8(data, F71882FG_REG_PWM_ENABLE);\n\tif ((data->type == f8000 && ((data->pwm_enable >> 2 * nr) & 3) != 2) ||\n\t    (data->type != f8000 && !((data->pwm_enable >> 2 * nr) & 2))) {\n\t\tcount = -EROFS;\n\t\tgoto leave;\n\t}\n\tif (data->pwm_enable & (1 << (2 * nr))) {\n\t\t \n\t\tf71882fg_write8(data, F71882FG_REG_PWM(nr), val);\n\t\tdata->pwm[nr] = val;\n\t} else {\n\t\t \n\t\tint target, full_speed;\n\t\tfull_speed = f71882fg_read16(data,\n\t\t\t\t\t     F71882FG_REG_FAN_FULL_SPEED(nr));\n\t\ttarget = fan_to_reg(val * fan_from_reg(full_speed) / 255);\n\t\tf71882fg_write16(data, F71882FG_REG_FAN_TARGET(nr), target);\n\t\tdata->fan_target[nr] = target;\n\t\tdata->fan_full_speed[nr] = full_speed;\n\t}\nleave:\n\tmutex_unlock(&data->update_lock);\n\n\treturn count;\n}\n\nstatic ssize_t show_pwm_enable(struct device *dev,\n\t\t\t       struct device_attribute *devattr, char *buf)\n{\n\tint result = 0;\n\tstruct f71882fg_data *data = f71882fg_update_device(dev);\n\tint nr = to_sensor_dev_attr_2(devattr)->index;\n\n\tswitch ((data->pwm_enable >> 2 * nr) & 3) {\n\tcase 0:\n\tcase 1:\n\t\tresult = 2;  \n\t\tbreak;\n\tcase 2:\n\t\tresult = 1;  \n\t\tbreak;\n\tcase 3:\n\t\tif (data->type == f8000)\n\t\t\tresult = 3;  \n\t\telse\n\t\t\tresult = 1;  \n\t\tbreak;\n\t}\n\n\treturn sprintf(buf, \"%d\\n\", result);\n}\n\nstatic ssize_t store_pwm_enable(struct device *dev, struct device_attribute\n\t\t\t\t*devattr, const char *buf, size_t count)\n{\n\tstruct f71882fg_data *data = dev_get_drvdata(dev);\n\tint err, nr = to_sensor_dev_attr_2(devattr)->index;\n\tlong val;\n\n\terr = kstrtol(buf, 10, &val);\n\tif (err)\n\t\treturn err;\n\n\t \n\tif (data->type == f8000 && nr == 2 && val != 2)\n\t\treturn -EINVAL;\n\n\tmutex_lock(&data->update_lock);\n\tdata->pwm_enable = f71882fg_read8(data, F71882FG_REG_PWM_ENABLE);\n\t \n\tif (data->type == f8000 && ((data->pwm_enable >> 2 * nr) & 1)) {\n\t\tswitch (val) {\n\t\tcase 2:\n\t\t\tdata->pwm_enable &= ~(2 << (2 * nr));\n\t\t\tbreak;\t\t \n\t\tcase 3:\n\t\t\tdata->pwm_enable |= 2 << (2 * nr);\n\t\t\tbreak;\t\t \n\t\tdefault:\n\t\t\tcount = -EINVAL;\n\t\t\tgoto leave;\n\t\t}\n\t} else {\n\t\tswitch (val) {\n\t\tcase 1:\n\t\t\t \n\t\t\tif (data->type == f71858fg &&\n\t\t\t    ((data->pwm_enable >> (2 * nr)) & 1)) {\n\t\t\t\tcount = -EINVAL;\n\t\t\t\tgoto leave;\n\t\t\t}\n\t\t\tdata->pwm_enable |= 2 << (2 * nr);\n\t\t\tbreak;\t\t \n\t\tcase 2:\n\t\t\tdata->pwm_enable &= ~(2 << (2 * nr));\n\t\t\tbreak;\t\t \n\t\tdefault:\n\t\t\tcount = -EINVAL;\n\t\t\tgoto leave;\n\t\t}\n\t}\n\tf71882fg_write8(data, F71882FG_REG_PWM_ENABLE, data->pwm_enable);\nleave:\n\tmutex_unlock(&data->update_lock);\n\n\treturn count;\n}\n\nstatic ssize_t show_pwm_interpolate(struct device *dev,\n\t\t\t\t    struct device_attribute *devattr, char *buf)\n{\n\tint result;\n\tstruct f71882fg_data *data = f71882fg_update_device(dev);\n\tint nr = to_sensor_dev_attr_2(devattr)->index;\n\n\tresult = (data->pwm_auto_point_mapping[nr] >> 4) & 1;\n\n\treturn sprintf(buf, \"%d\\n\", result);\n}\n\nstatic ssize_t store_pwm_interpolate(struct device *dev,\n\t\t\t\t     struct device_attribute *devattr,\n\t\t\t\t     const char *buf, size_t count)\n{\n\tstruct f71882fg_data *data = dev_get_drvdata(dev);\n\tint err, nr = to_sensor_dev_attr_2(devattr)->index;\n\tunsigned long val;\n\n\terr = kstrtoul(buf, 10, &val);\n\tif (err)\n\t\treturn err;\n\n\tmutex_lock(&data->update_lock);\n\tdata->pwm_auto_point_mapping[nr] =\n\t\tf71882fg_read8(data, F71882FG_REG_POINT_MAPPING(nr));\n\tif (val)\n\t\tval = data->pwm_auto_point_mapping[nr] | (1 << 4);\n\telse\n\t\tval = data->pwm_auto_point_mapping[nr] & (~(1 << 4));\n\tf71882fg_write8(data, F71882FG_REG_POINT_MAPPING(nr), val);\n\tdata->pwm_auto_point_mapping[nr] = val;\n\tmutex_unlock(&data->update_lock);\n\n\treturn count;\n}\n\n \nstatic struct sensor_device_attribute_2 fxxxx_fan_attr[4][6] = { {\n\tSENSOR_ATTR_2(fan1_input, S_IRUGO, show_fan, NULL, 0, 0),\n\tSENSOR_ATTR_2(fan1_full_speed, S_IRUGO|S_IWUSR,\n\t\t      show_fan_full_speed,\n\t\t      store_fan_full_speed, 0, 0),\n\tSENSOR_ATTR_2(fan1_alarm, S_IRUGO, show_fan_alarm, NULL, 0, 0),\n\tSENSOR_ATTR_2(pwm1, S_IRUGO|S_IWUSR, show_pwm, store_pwm, 0, 0),\n\tSENSOR_ATTR_2(pwm1_enable, S_IRUGO|S_IWUSR, show_pwm_enable,\n\t\t      store_pwm_enable, 0, 0),\n\tSENSOR_ATTR_2(pwm1_interpolate, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_interpolate, store_pwm_interpolate, 0, 0),\n}, {\n\tSENSOR_ATTR_2(fan2_input, S_IRUGO, show_fan, NULL, 0, 1),\n\tSENSOR_ATTR_2(fan2_full_speed, S_IRUGO|S_IWUSR,\n\t\t      show_fan_full_speed,\n\t\t      store_fan_full_speed, 0, 1),\n\tSENSOR_ATTR_2(fan2_alarm, S_IRUGO, show_fan_alarm, NULL, 0, 1),\n\tSENSOR_ATTR_2(pwm2, S_IRUGO|S_IWUSR, show_pwm, store_pwm, 0, 1),\n\tSENSOR_ATTR_2(pwm2_enable, S_IRUGO|S_IWUSR, show_pwm_enable,\n\t\t      store_pwm_enable, 0, 1),\n\tSENSOR_ATTR_2(pwm2_interpolate, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_interpolate, store_pwm_interpolate, 0, 1),\n}, {\n\tSENSOR_ATTR_2(fan3_input, S_IRUGO, show_fan, NULL, 0, 2),\n\tSENSOR_ATTR_2(fan3_full_speed, S_IRUGO|S_IWUSR,\n\t\t      show_fan_full_speed,\n\t\t      store_fan_full_speed, 0, 2),\n\tSENSOR_ATTR_2(fan3_alarm, S_IRUGO, show_fan_alarm, NULL, 0, 2),\n\tSENSOR_ATTR_2(pwm3, S_IRUGO|S_IWUSR, show_pwm, store_pwm, 0, 2),\n\tSENSOR_ATTR_2(pwm3_enable, S_IRUGO|S_IWUSR, show_pwm_enable,\n\t\t      store_pwm_enable, 0, 2),\n\tSENSOR_ATTR_2(pwm3_interpolate, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_interpolate, store_pwm_interpolate, 0, 2),\n}, {\n\tSENSOR_ATTR_2(fan4_input, S_IRUGO, show_fan, NULL, 0, 3),\n\tSENSOR_ATTR_2(fan4_full_speed, S_IRUGO|S_IWUSR,\n\t\t      show_fan_full_speed,\n\t\t      store_fan_full_speed, 0, 3),\n\tSENSOR_ATTR_2(fan4_alarm, S_IRUGO, show_fan_alarm, NULL, 0, 3),\n\tSENSOR_ATTR_2(pwm4, S_IRUGO|S_IWUSR, show_pwm, store_pwm, 0, 3),\n\tSENSOR_ATTR_2(pwm4_enable, S_IRUGO|S_IWUSR, show_pwm_enable,\n\t\t      store_pwm_enable, 0, 3),\n\tSENSOR_ATTR_2(pwm4_interpolate, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_interpolate, store_pwm_interpolate, 0, 3),\n} };\n\nstatic ssize_t show_simple_pwm(struct device *dev,\n\t\t\t       struct device_attribute *devattr, char *buf)\n{\n\tstruct f71882fg_data *data = f71882fg_update_device(dev);\n\tint val, nr = to_sensor_dev_attr_2(devattr)->index;\n\n\tval = data->pwm[nr];\n\treturn sprintf(buf, \"%d\\n\", val);\n}\n\nstatic ssize_t store_simple_pwm(struct device *dev,\n\t\t\t\tstruct device_attribute *devattr,\n\t\t\t\tconst char *buf, size_t count)\n{\n\tstruct f71882fg_data *data = dev_get_drvdata(dev);\n\tint err, nr = to_sensor_dev_attr_2(devattr)->index;\n\tlong val;\n\n\terr = kstrtol(buf, 10, &val);\n\tif (err)\n\t\treturn err;\n\n\tval = clamp_val(val, 0, 255);\n\n\tmutex_lock(&data->update_lock);\n\tf71882fg_write8(data, F71882FG_REG_PWM(nr), val);\n\tdata->pwm[nr] = val;\n\tmutex_unlock(&data->update_lock);\n\n\treturn count;\n}\n\n \nstatic struct sensor_device_attribute_2 f71808a_fan3_attr[] = {\n\tSENSOR_ATTR_2(fan3_input, S_IRUGO, show_fan, NULL, 0, 2),\n\tSENSOR_ATTR_2(fan3_alarm, S_IRUGO, show_fan_alarm, NULL, 0, 2),\n\tSENSOR_ATTR_2(pwm3, S_IRUGO|S_IWUSR,\n\t\t      show_simple_pwm, store_simple_pwm, 0, 2),\n};\n\nstatic ssize_t show_fan_beep(struct device *dev, struct device_attribute\n\t*devattr, char *buf)\n{\n\tstruct f71882fg_data *data = f71882fg_update_device(dev);\n\tint nr = to_sensor_dev_attr_2(devattr)->index;\n\n\tif (data->fan_beep & (1 << nr))\n\t\treturn sprintf(buf, \"1\\n\");\n\telse\n\t\treturn sprintf(buf, \"0\\n\");\n}\n\nstatic ssize_t store_fan_beep(struct device *dev, struct device_attribute\n\t*devattr, const char *buf, size_t count)\n{\n\tstruct f71882fg_data *data = dev_get_drvdata(dev);\n\tint err, nr = to_sensor_dev_attr_2(devattr)->index;\n\tunsigned long val;\n\n\terr = kstrtoul(buf, 10, &val);\n\tif (err)\n\t\treturn err;\n\n\tmutex_lock(&data->update_lock);\n\tdata->fan_beep = f71882fg_read8(data, F71882FG_REG_FAN_BEEP);\n\tif (val)\n\t\tdata->fan_beep |= 1 << nr;\n\telse\n\t\tdata->fan_beep &= ~(1 << nr);\n\n\tf71882fg_write8(data, F71882FG_REG_FAN_BEEP, data->fan_beep);\n\tmutex_unlock(&data->update_lock);\n\n\treturn count;\n}\n\n \nstatic struct sensor_device_attribute_2 fxxxx_fan_beep_attr[] = {\n\tSENSOR_ATTR_2(fan1_beep, S_IRUGO|S_IWUSR, show_fan_beep,\n\t\tstore_fan_beep, 0, 0),\n\tSENSOR_ATTR_2(fan2_beep, S_IRUGO|S_IWUSR, show_fan_beep,\n\t\tstore_fan_beep, 0, 1),\n\tSENSOR_ATTR_2(fan3_beep, S_IRUGO|S_IWUSR, show_fan_beep,\n\t\tstore_fan_beep, 0, 2),\n\tSENSOR_ATTR_2(fan4_beep, S_IRUGO|S_IWUSR, show_fan_beep,\n\t\tstore_fan_beep, 0, 3),\n};\n\nstatic ssize_t show_pwm_auto_point_channel(struct device *dev,\n\t\t\t\t\t   struct device_attribute *devattr,\n\t\t\t\t\t   char *buf)\n{\n\tint result;\n\tstruct f71882fg_data *data = f71882fg_update_device(dev);\n\tint nr = to_sensor_dev_attr_2(devattr)->index;\n\n\tresult = 1 << ((data->pwm_auto_point_mapping[nr] & 3) -\n\t\t       data->temp_start);\n\n\treturn sprintf(buf, \"%d\\n\", result);\n}\n\nstatic ssize_t store_pwm_auto_point_channel(struct device *dev,\n\t\t\t\t\t    struct device_attribute *devattr,\n\t\t\t\t\t    const char *buf, size_t count)\n{\n\tstruct f71882fg_data *data = dev_get_drvdata(dev);\n\tint err, nr = to_sensor_dev_attr_2(devattr)->index;\n\tlong val;\n\n\terr = kstrtol(buf, 10, &val);\n\tif (err)\n\t\treturn err;\n\n\tswitch (val) {\n\tcase 1:\n\t\tval = 0;\n\t\tbreak;\n\tcase 2:\n\t\tval = 1;\n\t\tbreak;\n\tcase 4:\n\t\tval = 2;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\tval += data->temp_start;\n\tmutex_lock(&data->update_lock);\n\tdata->pwm_auto_point_mapping[nr] =\n\t\tf71882fg_read8(data, F71882FG_REG_POINT_MAPPING(nr));\n\tval = (data->pwm_auto_point_mapping[nr] & 0xfc) | val;\n\tf71882fg_write8(data, F71882FG_REG_POINT_MAPPING(nr), val);\n\tdata->pwm_auto_point_mapping[nr] = val;\n\tmutex_unlock(&data->update_lock);\n\n\treturn count;\n}\n\nstatic ssize_t show_pwm_auto_point_pwm(struct device *dev,\n\t\t\t\t       struct device_attribute *devattr,\n\t\t\t\t       char *buf)\n{\n\tint result;\n\tstruct f71882fg_data *data = f71882fg_update_device(dev);\n\tint pwm = to_sensor_dev_attr_2(devattr)->index;\n\tint point = to_sensor_dev_attr_2(devattr)->nr;\n\n\tmutex_lock(&data->update_lock);\n\tif (data->pwm_enable & (1 << (2 * pwm))) {\n\t\t \n\t\tresult = data->pwm_auto_point_pwm[pwm][point];\n\t} else {\n\t\t \n\t\tresult = 32 * 255 / (32 + data->pwm_auto_point_pwm[pwm][point]);\n\t}\n\tmutex_unlock(&data->update_lock);\n\n\treturn sprintf(buf, \"%d\\n\", result);\n}\n\nstatic ssize_t store_pwm_auto_point_pwm(struct device *dev,\n\t\t\t\t\tstruct device_attribute *devattr,\n\t\t\t\t\tconst char *buf, size_t count)\n{\n\tstruct f71882fg_data *data = dev_get_drvdata(dev);\n\tint err, pwm = to_sensor_dev_attr_2(devattr)->index;\n\tint point = to_sensor_dev_attr_2(devattr)->nr;\n\tlong val;\n\n\terr = kstrtol(buf, 10, &val);\n\tif (err)\n\t\treturn err;\n\n\tval = clamp_val(val, 0, 255);\n\n\tmutex_lock(&data->update_lock);\n\tdata->pwm_enable = f71882fg_read8(data, F71882FG_REG_PWM_ENABLE);\n\tif (data->pwm_enable & (1 << (2 * pwm))) {\n\t\t \n\t} else {\n\t\t \n\t\tif (val < 29)\t \n\t\t\tval = 255;\n\t\telse\n\t\t\tval = (255 - val) * 32 / val;\n\t}\n\tf71882fg_write8(data, F71882FG_REG_POINT_PWM(pwm, point), val);\n\tdata->pwm_auto_point_pwm[pwm][point] = val;\n\tmutex_unlock(&data->update_lock);\n\n\treturn count;\n}\n\nstatic ssize_t show_pwm_auto_point_temp(struct device *dev,\n\t\t\t\t\tstruct device_attribute *devattr,\n\t\t\t\t\tchar *buf)\n{\n\tint result;\n\tstruct f71882fg_data *data = f71882fg_update_device(dev);\n\tint pwm = to_sensor_dev_attr_2(devattr)->index;\n\tint point = to_sensor_dev_attr_2(devattr)->nr;\n\n\tresult = data->pwm_auto_point_temp[pwm][point];\n\treturn sprintf(buf, \"%d\\n\", 1000 * result);\n}\n\nstatic ssize_t store_pwm_auto_point_temp(struct device *dev,\n\t\t\t\t\t struct device_attribute *devattr,\n\t\t\t\t\t const char *buf, size_t count)\n{\n\tstruct f71882fg_data *data = dev_get_drvdata(dev);\n\tint err, pwm = to_sensor_dev_attr_2(devattr)->index;\n\tint point = to_sensor_dev_attr_2(devattr)->nr;\n\tlong val;\n\n\terr = kstrtol(buf, 10, &val);\n\tif (err)\n\t\treturn err;\n\n\tval /= 1000;\n\n\tif (data->auto_point_temp_signed)\n\t\tval = clamp_val(val, -128, 127);\n\telse\n\t\tval = clamp_val(val, 0, 127);\n\n\tmutex_lock(&data->update_lock);\n\tf71882fg_write8(data, F71882FG_REG_POINT_TEMP(pwm, point), val);\n\tdata->pwm_auto_point_temp[pwm][point] = val;\n\tmutex_unlock(&data->update_lock);\n\n\treturn count;\n}\n\nstatic ssize_t show_pwm_auto_point_temp_hyst(struct device *dev,\n\t\t\t\t\t     struct device_attribute *devattr,\n\t\t\t\t\t     char *buf)\n{\n\tint result = 0;\n\tstruct f71882fg_data *data = f71882fg_update_device(dev);\n\tint nr = to_sensor_dev_attr_2(devattr)->index;\n\tint point = to_sensor_dev_attr_2(devattr)->nr;\n\n\tmutex_lock(&data->update_lock);\n\tif (nr & 1)\n\t\tresult = data->pwm_auto_point_hyst[nr / 2] >> 4;\n\telse\n\t\tresult = data->pwm_auto_point_hyst[nr / 2] & 0x0f;\n\tresult = 1000 * (data->pwm_auto_point_temp[nr][point] - result);\n\tmutex_unlock(&data->update_lock);\n\n\treturn sprintf(buf, \"%d\\n\", result);\n}\n\nstatic ssize_t store_pwm_auto_point_temp_hyst(struct device *dev,\n\t\t\t\t\t      struct device_attribute *devattr,\n\t\t\t\t\t      const char *buf, size_t count)\n{\n\tstruct f71882fg_data *data = dev_get_drvdata(dev);\n\tint err, nr = to_sensor_dev_attr_2(devattr)->index;\n\tint point = to_sensor_dev_attr_2(devattr)->nr;\n\tu8 reg;\n\tlong val;\n\n\terr = kstrtol(buf, 10, &val);\n\tif (err)\n\t\treturn err;\n\n\tval /= 1000;\n\n\tmutex_lock(&data->update_lock);\n\tdata->pwm_auto_point_temp[nr][point] =\n\t\tf71882fg_read8(data, F71882FG_REG_POINT_TEMP(nr, point));\n\tval = clamp_val(val, data->pwm_auto_point_temp[nr][point] - 15,\n\t\t\tdata->pwm_auto_point_temp[nr][point]);\n\tval = data->pwm_auto_point_temp[nr][point] - val;\n\n\treg = f71882fg_read8(data, F71882FG_REG_FAN_HYST(nr / 2));\n\tif (nr & 1)\n\t\treg = (reg & 0x0f) | (val << 4);\n\telse\n\t\treg = (reg & 0xf0) | val;\n\n\tf71882fg_write8(data, F71882FG_REG_FAN_HYST(nr / 2), reg);\n\tdata->pwm_auto_point_hyst[nr / 2] = reg;\n\tmutex_unlock(&data->update_lock);\n\n\treturn count;\n}\n\n \nstatic struct sensor_device_attribute_2 f71862fg_auto_pwm_attr[3][7] = { {\n\tSENSOR_ATTR_2(pwm1_auto_channels_temp, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_channel,\n\t\t      store_pwm_auto_point_channel, 0, 0),\n\tSENSOR_ATTR_2(pwm1_auto_point1_pwm, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_pwm, store_pwm_auto_point_pwm,\n\t\t      1, 0),\n\tSENSOR_ATTR_2(pwm1_auto_point2_pwm, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_pwm, store_pwm_auto_point_pwm,\n\t\t      4, 0),\n\tSENSOR_ATTR_2(pwm1_auto_point1_temp, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_temp, store_pwm_auto_point_temp,\n\t\t      0, 0),\n\tSENSOR_ATTR_2(pwm1_auto_point2_temp, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_temp, store_pwm_auto_point_temp,\n\t\t      3, 0),\n\tSENSOR_ATTR_2(pwm1_auto_point1_temp_hyst, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_temp_hyst,\n\t\t      store_pwm_auto_point_temp_hyst,\n\t\t      0, 0),\n\tSENSOR_ATTR_2(pwm1_auto_point2_temp_hyst, S_IRUGO,\n\t\t      show_pwm_auto_point_temp_hyst, NULL, 3, 0),\n}, {\n\tSENSOR_ATTR_2(pwm2_auto_channels_temp, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_channel,\n\t\t      store_pwm_auto_point_channel, 0, 1),\n\tSENSOR_ATTR_2(pwm2_auto_point1_pwm, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_pwm, store_pwm_auto_point_pwm,\n\t\t      1, 1),\n\tSENSOR_ATTR_2(pwm2_auto_point2_pwm, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_pwm, store_pwm_auto_point_pwm,\n\t\t      4, 1),\n\tSENSOR_ATTR_2(pwm2_auto_point1_temp, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_temp, store_pwm_auto_point_temp,\n\t\t      0, 1),\n\tSENSOR_ATTR_2(pwm2_auto_point2_temp, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_temp, store_pwm_auto_point_temp,\n\t\t      3, 1),\n\tSENSOR_ATTR_2(pwm2_auto_point1_temp_hyst, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_temp_hyst,\n\t\t      store_pwm_auto_point_temp_hyst,\n\t\t      0, 1),\n\tSENSOR_ATTR_2(pwm2_auto_point2_temp_hyst, S_IRUGO,\n\t\t      show_pwm_auto_point_temp_hyst, NULL, 3, 1),\n}, {\n\tSENSOR_ATTR_2(pwm3_auto_channels_temp, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_channel,\n\t\t      store_pwm_auto_point_channel, 0, 2),\n\tSENSOR_ATTR_2(pwm3_auto_point1_pwm, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_pwm, store_pwm_auto_point_pwm,\n\t\t      1, 2),\n\tSENSOR_ATTR_2(pwm3_auto_point2_pwm, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_pwm, store_pwm_auto_point_pwm,\n\t\t      4, 2),\n\tSENSOR_ATTR_2(pwm3_auto_point1_temp, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_temp, store_pwm_auto_point_temp,\n\t\t      0, 2),\n\tSENSOR_ATTR_2(pwm3_auto_point2_temp, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_temp, store_pwm_auto_point_temp,\n\t\t      3, 2),\n\tSENSOR_ATTR_2(pwm3_auto_point1_temp_hyst, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_temp_hyst,\n\t\t      store_pwm_auto_point_temp_hyst,\n\t\t      0, 2),\n\tSENSOR_ATTR_2(pwm3_auto_point2_temp_hyst, S_IRUGO,\n\t\t      show_pwm_auto_point_temp_hyst, NULL, 3, 2),\n} };\n\n \nstatic struct sensor_device_attribute_2 f71869_auto_pwm_attr[3][8] = { {\n\tSENSOR_ATTR_2(pwm1_auto_channels_temp, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_channel,\n\t\t      store_pwm_auto_point_channel, 0, 0),\n\tSENSOR_ATTR_2(pwm1_auto_point1_pwm, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_pwm, store_pwm_auto_point_pwm,\n\t\t      0, 0),\n\tSENSOR_ATTR_2(pwm1_auto_point2_pwm, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_pwm, store_pwm_auto_point_pwm,\n\t\t      1, 0),\n\tSENSOR_ATTR_2(pwm1_auto_point3_pwm, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_pwm, store_pwm_auto_point_pwm,\n\t\t      4, 0),\n\tSENSOR_ATTR_2(pwm1_auto_point1_temp, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_temp, store_pwm_auto_point_temp,\n\t\t      0, 0),\n\tSENSOR_ATTR_2(pwm1_auto_point2_temp, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_temp, store_pwm_auto_point_temp,\n\t\t      3, 0),\n\tSENSOR_ATTR_2(pwm1_auto_point1_temp_hyst, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_temp_hyst,\n\t\t      store_pwm_auto_point_temp_hyst,\n\t\t      0, 0),\n\tSENSOR_ATTR_2(pwm1_auto_point2_temp_hyst, S_IRUGO,\n\t\t      show_pwm_auto_point_temp_hyst, NULL, 3, 0),\n}, {\n\tSENSOR_ATTR_2(pwm2_auto_channels_temp, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_channel,\n\t\t      store_pwm_auto_point_channel, 0, 1),\n\tSENSOR_ATTR_2(pwm2_auto_point1_pwm, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_pwm, store_pwm_auto_point_pwm,\n\t\t      0, 1),\n\tSENSOR_ATTR_2(pwm2_auto_point2_pwm, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_pwm, store_pwm_auto_point_pwm,\n\t\t      1, 1),\n\tSENSOR_ATTR_2(pwm2_auto_point3_pwm, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_pwm, store_pwm_auto_point_pwm,\n\t\t      4, 1),\n\tSENSOR_ATTR_2(pwm2_auto_point1_temp, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_temp, store_pwm_auto_point_temp,\n\t\t      0, 1),\n\tSENSOR_ATTR_2(pwm2_auto_point2_temp, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_temp, store_pwm_auto_point_temp,\n\t\t      3, 1),\n\tSENSOR_ATTR_2(pwm2_auto_point1_temp_hyst, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_temp_hyst,\n\t\t      store_pwm_auto_point_temp_hyst,\n\t\t      0, 1),\n\tSENSOR_ATTR_2(pwm2_auto_point2_temp_hyst, S_IRUGO,\n\t\t      show_pwm_auto_point_temp_hyst, NULL, 3, 1),\n}, {\n\tSENSOR_ATTR_2(pwm3_auto_channels_temp, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_channel,\n\t\t      store_pwm_auto_point_channel, 0, 2),\n\tSENSOR_ATTR_2(pwm3_auto_point1_pwm, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_pwm, store_pwm_auto_point_pwm,\n\t\t      0, 2),\n\tSENSOR_ATTR_2(pwm3_auto_point2_pwm, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_pwm, store_pwm_auto_point_pwm,\n\t\t      1, 2),\n\tSENSOR_ATTR_2(pwm3_auto_point3_pwm, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_pwm, store_pwm_auto_point_pwm,\n\t\t      4, 2),\n\tSENSOR_ATTR_2(pwm3_auto_point1_temp, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_temp, store_pwm_auto_point_temp,\n\t\t      0, 2),\n\tSENSOR_ATTR_2(pwm3_auto_point2_temp, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_temp, store_pwm_auto_point_temp,\n\t\t      3, 2),\n\tSENSOR_ATTR_2(pwm3_auto_point1_temp_hyst, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_temp_hyst,\n\t\t      store_pwm_auto_point_temp_hyst,\n\t\t      0, 2),\n\tSENSOR_ATTR_2(pwm3_auto_point2_temp_hyst, S_IRUGO,\n\t\t      show_pwm_auto_point_temp_hyst, NULL, 3, 2),\n} };\n\n \nstatic struct sensor_device_attribute_2 fxxxx_auto_pwm_attr[4][14] = { {\n\tSENSOR_ATTR_2(pwm1_auto_channels_temp, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_channel,\n\t\t      store_pwm_auto_point_channel, 0, 0),\n\tSENSOR_ATTR_2(pwm1_auto_point1_pwm, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_pwm, store_pwm_auto_point_pwm,\n\t\t      0, 0),\n\tSENSOR_ATTR_2(pwm1_auto_point2_pwm, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_pwm, store_pwm_auto_point_pwm,\n\t\t      1, 0),\n\tSENSOR_ATTR_2(pwm1_auto_point3_pwm, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_pwm, store_pwm_auto_point_pwm,\n\t\t      2, 0),\n\tSENSOR_ATTR_2(pwm1_auto_point4_pwm, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_pwm, store_pwm_auto_point_pwm,\n\t\t      3, 0),\n\tSENSOR_ATTR_2(pwm1_auto_point5_pwm, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_pwm, store_pwm_auto_point_pwm,\n\t\t      4, 0),\n\tSENSOR_ATTR_2(pwm1_auto_point1_temp, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_temp, store_pwm_auto_point_temp,\n\t\t      0, 0),\n\tSENSOR_ATTR_2(pwm1_auto_point2_temp, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_temp, store_pwm_auto_point_temp,\n\t\t      1, 0),\n\tSENSOR_ATTR_2(pwm1_auto_point3_temp, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_temp, store_pwm_auto_point_temp,\n\t\t      2, 0),\n\tSENSOR_ATTR_2(pwm1_auto_point4_temp, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_temp, store_pwm_auto_point_temp,\n\t\t      3, 0),\n\tSENSOR_ATTR_2(pwm1_auto_point1_temp_hyst, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_temp_hyst,\n\t\t      store_pwm_auto_point_temp_hyst,\n\t\t      0, 0),\n\tSENSOR_ATTR_2(pwm1_auto_point2_temp_hyst, S_IRUGO,\n\t\t      show_pwm_auto_point_temp_hyst, NULL, 1, 0),\n\tSENSOR_ATTR_2(pwm1_auto_point3_temp_hyst, S_IRUGO,\n\t\t      show_pwm_auto_point_temp_hyst, NULL, 2, 0),\n\tSENSOR_ATTR_2(pwm1_auto_point4_temp_hyst, S_IRUGO,\n\t\t      show_pwm_auto_point_temp_hyst, NULL, 3, 0),\n}, {\n\tSENSOR_ATTR_2(pwm2_auto_channels_temp, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_channel,\n\t\t      store_pwm_auto_point_channel, 0, 1),\n\tSENSOR_ATTR_2(pwm2_auto_point1_pwm, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_pwm, store_pwm_auto_point_pwm,\n\t\t      0, 1),\n\tSENSOR_ATTR_2(pwm2_auto_point2_pwm, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_pwm, store_pwm_auto_point_pwm,\n\t\t      1, 1),\n\tSENSOR_ATTR_2(pwm2_auto_point3_pwm, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_pwm, store_pwm_auto_point_pwm,\n\t\t      2, 1),\n\tSENSOR_ATTR_2(pwm2_auto_point4_pwm, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_pwm, store_pwm_auto_point_pwm,\n\t\t      3, 1),\n\tSENSOR_ATTR_2(pwm2_auto_point5_pwm, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_pwm, store_pwm_auto_point_pwm,\n\t\t      4, 1),\n\tSENSOR_ATTR_2(pwm2_auto_point1_temp, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_temp, store_pwm_auto_point_temp,\n\t\t      0, 1),\n\tSENSOR_ATTR_2(pwm2_auto_point2_temp, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_temp, store_pwm_auto_point_temp,\n\t\t      1, 1),\n\tSENSOR_ATTR_2(pwm2_auto_point3_temp, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_temp, store_pwm_auto_point_temp,\n\t\t      2, 1),\n\tSENSOR_ATTR_2(pwm2_auto_point4_temp, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_temp, store_pwm_auto_point_temp,\n\t\t      3, 1),\n\tSENSOR_ATTR_2(pwm2_auto_point1_temp_hyst, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_temp_hyst,\n\t\t      store_pwm_auto_point_temp_hyst,\n\t\t      0, 1),\n\tSENSOR_ATTR_2(pwm2_auto_point2_temp_hyst, S_IRUGO,\n\t\t      show_pwm_auto_point_temp_hyst, NULL, 1, 1),\n\tSENSOR_ATTR_2(pwm2_auto_point3_temp_hyst, S_IRUGO,\n\t\t      show_pwm_auto_point_temp_hyst, NULL, 2, 1),\n\tSENSOR_ATTR_2(pwm2_auto_point4_temp_hyst, S_IRUGO,\n\t\t      show_pwm_auto_point_temp_hyst, NULL, 3, 1),\n}, {\n\tSENSOR_ATTR_2(pwm3_auto_channels_temp, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_channel,\n\t\t      store_pwm_auto_point_channel, 0, 2),\n\tSENSOR_ATTR_2(pwm3_auto_point1_pwm, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_pwm, store_pwm_auto_point_pwm,\n\t\t      0, 2),\n\tSENSOR_ATTR_2(pwm3_auto_point2_pwm, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_pwm, store_pwm_auto_point_pwm,\n\t\t      1, 2),\n\tSENSOR_ATTR_2(pwm3_auto_point3_pwm, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_pwm, store_pwm_auto_point_pwm,\n\t\t      2, 2),\n\tSENSOR_ATTR_2(pwm3_auto_point4_pwm, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_pwm, store_pwm_auto_point_pwm,\n\t\t      3, 2),\n\tSENSOR_ATTR_2(pwm3_auto_point5_pwm, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_pwm, store_pwm_auto_point_pwm,\n\t\t      4, 2),\n\tSENSOR_ATTR_2(pwm3_auto_point1_temp, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_temp, store_pwm_auto_point_temp,\n\t\t      0, 2),\n\tSENSOR_ATTR_2(pwm3_auto_point2_temp, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_temp, store_pwm_auto_point_temp,\n\t\t      1, 2),\n\tSENSOR_ATTR_2(pwm3_auto_point3_temp, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_temp, store_pwm_auto_point_temp,\n\t\t      2, 2),\n\tSENSOR_ATTR_2(pwm3_auto_point4_temp, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_temp, store_pwm_auto_point_temp,\n\t\t      3, 2),\n\tSENSOR_ATTR_2(pwm3_auto_point1_temp_hyst, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_temp_hyst,\n\t\t      store_pwm_auto_point_temp_hyst,\n\t\t      0, 2),\n\tSENSOR_ATTR_2(pwm3_auto_point2_temp_hyst, S_IRUGO,\n\t\t      show_pwm_auto_point_temp_hyst, NULL, 1, 2),\n\tSENSOR_ATTR_2(pwm3_auto_point3_temp_hyst, S_IRUGO,\n\t\t      show_pwm_auto_point_temp_hyst, NULL, 2, 2),\n\tSENSOR_ATTR_2(pwm3_auto_point4_temp_hyst, S_IRUGO,\n\t\t      show_pwm_auto_point_temp_hyst, NULL, 3, 2),\n}, {\n\tSENSOR_ATTR_2(pwm4_auto_channels_temp, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_channel,\n\t\t      store_pwm_auto_point_channel, 0, 3),\n\tSENSOR_ATTR_2(pwm4_auto_point1_pwm, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_pwm, store_pwm_auto_point_pwm,\n\t\t      0, 3),\n\tSENSOR_ATTR_2(pwm4_auto_point2_pwm, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_pwm, store_pwm_auto_point_pwm,\n\t\t      1, 3),\n\tSENSOR_ATTR_2(pwm4_auto_point3_pwm, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_pwm, store_pwm_auto_point_pwm,\n\t\t      2, 3),\n\tSENSOR_ATTR_2(pwm4_auto_point4_pwm, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_pwm, store_pwm_auto_point_pwm,\n\t\t      3, 3),\n\tSENSOR_ATTR_2(pwm4_auto_point5_pwm, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_pwm, store_pwm_auto_point_pwm,\n\t\t      4, 3),\n\tSENSOR_ATTR_2(pwm4_auto_point1_temp, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_temp, store_pwm_auto_point_temp,\n\t\t      0, 3),\n\tSENSOR_ATTR_2(pwm4_auto_point2_temp, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_temp, store_pwm_auto_point_temp,\n\t\t      1, 3),\n\tSENSOR_ATTR_2(pwm4_auto_point3_temp, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_temp, store_pwm_auto_point_temp,\n\t\t      2, 3),\n\tSENSOR_ATTR_2(pwm4_auto_point4_temp, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_temp, store_pwm_auto_point_temp,\n\t\t      3, 3),\n\tSENSOR_ATTR_2(pwm4_auto_point1_temp_hyst, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_temp_hyst,\n\t\t      store_pwm_auto_point_temp_hyst,\n\t\t      0, 3),\n\tSENSOR_ATTR_2(pwm4_auto_point2_temp_hyst, S_IRUGO,\n\t\t      show_pwm_auto_point_temp_hyst, NULL, 1, 3),\n\tSENSOR_ATTR_2(pwm4_auto_point3_temp_hyst, S_IRUGO,\n\t\t      show_pwm_auto_point_temp_hyst, NULL, 2, 3),\n\tSENSOR_ATTR_2(pwm4_auto_point4_temp_hyst, S_IRUGO,\n\t\t      show_pwm_auto_point_temp_hyst, NULL, 3, 3),\n} };\n\n \nstatic struct sensor_device_attribute_2 f8000_fan_attr[] = {\n\tSENSOR_ATTR_2(fan4_input, S_IRUGO, show_fan, NULL, 0, 3),\n};\n\n \nstatic struct sensor_device_attribute_2 f8000_auto_pwm_attr[3][14] = { {\n\tSENSOR_ATTR_2(pwm1_auto_channels_temp, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_channel,\n\t\t      store_pwm_auto_point_channel, 0, 0),\n\tSENSOR_ATTR_2(temp1_auto_point1_pwm, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_pwm, store_pwm_auto_point_pwm,\n\t\t      0, 2),\n\tSENSOR_ATTR_2(temp1_auto_point2_pwm, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_pwm, store_pwm_auto_point_pwm,\n\t\t      1, 2),\n\tSENSOR_ATTR_2(temp1_auto_point3_pwm, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_pwm, store_pwm_auto_point_pwm,\n\t\t      2, 2),\n\tSENSOR_ATTR_2(temp1_auto_point4_pwm, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_pwm, store_pwm_auto_point_pwm,\n\t\t      3, 2),\n\tSENSOR_ATTR_2(temp1_auto_point5_pwm, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_pwm, store_pwm_auto_point_pwm,\n\t\t      4, 2),\n\tSENSOR_ATTR_2(temp1_auto_point1_temp, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_temp, store_pwm_auto_point_temp,\n\t\t      0, 2),\n\tSENSOR_ATTR_2(temp1_auto_point2_temp, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_temp, store_pwm_auto_point_temp,\n\t\t      1, 2),\n\tSENSOR_ATTR_2(temp1_auto_point3_temp, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_temp, store_pwm_auto_point_temp,\n\t\t      2, 2),\n\tSENSOR_ATTR_2(temp1_auto_point4_temp, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_temp, store_pwm_auto_point_temp,\n\t\t      3, 2),\n\tSENSOR_ATTR_2(temp1_auto_point1_temp_hyst, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_temp_hyst,\n\t\t      store_pwm_auto_point_temp_hyst,\n\t\t      0, 2),\n\tSENSOR_ATTR_2(temp1_auto_point2_temp_hyst, S_IRUGO,\n\t\t      show_pwm_auto_point_temp_hyst, NULL, 1, 2),\n\tSENSOR_ATTR_2(temp1_auto_point3_temp_hyst, S_IRUGO,\n\t\t      show_pwm_auto_point_temp_hyst, NULL, 2, 2),\n\tSENSOR_ATTR_2(temp1_auto_point4_temp_hyst, S_IRUGO,\n\t\t      show_pwm_auto_point_temp_hyst, NULL, 3, 2),\n}, {\n\tSENSOR_ATTR_2(pwm2_auto_channels_temp, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_channel,\n\t\t      store_pwm_auto_point_channel, 0, 1),\n\tSENSOR_ATTR_2(temp2_auto_point1_pwm, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_pwm, store_pwm_auto_point_pwm,\n\t\t      0, 0),\n\tSENSOR_ATTR_2(temp2_auto_point2_pwm, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_pwm, store_pwm_auto_point_pwm,\n\t\t      1, 0),\n\tSENSOR_ATTR_2(temp2_auto_point3_pwm, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_pwm, store_pwm_auto_point_pwm,\n\t\t      2, 0),\n\tSENSOR_ATTR_2(temp2_auto_point4_pwm, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_pwm, store_pwm_auto_point_pwm,\n\t\t      3, 0),\n\tSENSOR_ATTR_2(temp2_auto_point5_pwm, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_pwm, store_pwm_auto_point_pwm,\n\t\t      4, 0),\n\tSENSOR_ATTR_2(temp2_auto_point1_temp, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_temp, store_pwm_auto_point_temp,\n\t\t      0, 0),\n\tSENSOR_ATTR_2(temp2_auto_point2_temp, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_temp, store_pwm_auto_point_temp,\n\t\t      1, 0),\n\tSENSOR_ATTR_2(temp2_auto_point3_temp, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_temp, store_pwm_auto_point_temp,\n\t\t      2, 0),\n\tSENSOR_ATTR_2(temp2_auto_point4_temp, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_temp, store_pwm_auto_point_temp,\n\t\t      3, 0),\n\tSENSOR_ATTR_2(temp2_auto_point1_temp_hyst, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_temp_hyst,\n\t\t      store_pwm_auto_point_temp_hyst,\n\t\t      0, 0),\n\tSENSOR_ATTR_2(temp2_auto_point2_temp_hyst, S_IRUGO,\n\t\t      show_pwm_auto_point_temp_hyst, NULL, 1, 0),\n\tSENSOR_ATTR_2(temp2_auto_point3_temp_hyst, S_IRUGO,\n\t\t      show_pwm_auto_point_temp_hyst, NULL, 2, 0),\n\tSENSOR_ATTR_2(temp2_auto_point4_temp_hyst, S_IRUGO,\n\t\t      show_pwm_auto_point_temp_hyst, NULL, 3, 0),\n}, {\n\tSENSOR_ATTR_2(pwm3_auto_channels_temp, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_channel,\n\t\t      store_pwm_auto_point_channel, 0, 2),\n\tSENSOR_ATTR_2(temp3_auto_point1_pwm, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_pwm, store_pwm_auto_point_pwm,\n\t\t      0, 1),\n\tSENSOR_ATTR_2(temp3_auto_point2_pwm, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_pwm, store_pwm_auto_point_pwm,\n\t\t      1, 1),\n\tSENSOR_ATTR_2(temp3_auto_point3_pwm, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_pwm, store_pwm_auto_point_pwm,\n\t\t      2, 1),\n\tSENSOR_ATTR_2(temp3_auto_point4_pwm, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_pwm, store_pwm_auto_point_pwm,\n\t\t      3, 1),\n\tSENSOR_ATTR_2(temp3_auto_point5_pwm, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_pwm, store_pwm_auto_point_pwm,\n\t\t      4, 1),\n\tSENSOR_ATTR_2(temp3_auto_point1_temp, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_temp, store_pwm_auto_point_temp,\n\t\t      0, 1),\n\tSENSOR_ATTR_2(temp3_auto_point2_temp, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_temp, store_pwm_auto_point_temp,\n\t\t      1, 1),\n\tSENSOR_ATTR_2(temp3_auto_point3_temp, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_temp, store_pwm_auto_point_temp,\n\t\t      2, 1),\n\tSENSOR_ATTR_2(temp3_auto_point4_temp, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_temp, store_pwm_auto_point_temp,\n\t\t      3, 1),\n\tSENSOR_ATTR_2(temp3_auto_point1_temp_hyst, S_IRUGO|S_IWUSR,\n\t\t      show_pwm_auto_point_temp_hyst,\n\t\t      store_pwm_auto_point_temp_hyst,\n\t\t      0, 1),\n\tSENSOR_ATTR_2(temp3_auto_point2_temp_hyst, S_IRUGO,\n\t\t      show_pwm_auto_point_temp_hyst, NULL, 1, 1),\n\tSENSOR_ATTR_2(temp3_auto_point3_temp_hyst, S_IRUGO,\n\t\t      show_pwm_auto_point_temp_hyst, NULL, 2, 1),\n\tSENSOR_ATTR_2(temp3_auto_point4_temp_hyst, S_IRUGO,\n\t\t      show_pwm_auto_point_temp_hyst, NULL, 3, 1),\n} };\n\n \nstatic inline int superio_inb(int base, int reg)\n{\n\toutb(reg, base);\n\treturn inb(base + 1);\n}\n\nstatic int superio_inw(int base, int reg)\n{\n\tint val;\n\tval  = superio_inb(base, reg) << 8;\n\tval |= superio_inb(base, reg + 1);\n\treturn val;\n}\n\nstatic inline int superio_enter(int base)\n{\n\t \n\tif (!request_muxed_region(base, 2, DRVNAME)) {\n\t\tpr_err(\"I/O address 0x%04x already in use\\n\", base);\n\t\treturn -EBUSY;\n\t}\n\n\t \n\toutb(SIO_UNLOCK_KEY, base);\n\toutb(SIO_UNLOCK_KEY, base);\n\n\treturn 0;\n}\n\nstatic inline void superio_select(int base, int ld)\n{\n\toutb(SIO_REG_LDSEL, base);\n\toutb(ld, base + 1);\n}\n\nstatic inline void superio_exit(int base)\n{\n\toutb(SIO_LOCK_KEY, base);\n\trelease_region(base, 2);\n}\n\nstatic int f71882fg_create_sysfs_files(struct platform_device *pdev,\n\tstruct sensor_device_attribute_2 *attr, int count)\n{\n\tint err, i;\n\n\tfor (i = 0; i < count; i++) {\n\t\terr = device_create_file(&pdev->dev, &attr[i].dev_attr);\n\t\tif (err)\n\t\t\treturn err;\n\t}\n\treturn 0;\n}\n\nstatic void f71882fg_remove_sysfs_files(struct platform_device *pdev,\n\tstruct sensor_device_attribute_2 *attr, int count)\n{\n\tint i;\n\n\tfor (i = 0; i < count; i++)\n\t\tdevice_remove_file(&pdev->dev, &attr[i].dev_attr);\n}\n\nstatic int f71882fg_create_fan_sysfs_files(\n\tstruct platform_device *pdev, int idx)\n{\n\tstruct f71882fg_data *data = platform_get_drvdata(pdev);\n\tint err;\n\n\t \n\terr = 0;\n\tswitch (data->type) {\n\tcase f71858fg:\n\t\tif (((data->pwm_enable >> (idx * 2)) & 3) == 3)\n\t\t\terr = 1;\n\t\tbreak;\n\tcase f71862fg:\n\t\tif (((data->pwm_enable >> (idx * 2)) & 1) != 1)\n\t\t\terr = 1;\n\t\tbreak;\n\tcase f8000:\n\t\tif (idx == 2)\n\t\t\terr = data->pwm_enable & 0x20;\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n\tif (err) {\n\t\tdev_err(&pdev->dev,\n\t\t\t\"Invalid (reserved) pwm settings: 0x%02x, \"\n\t\t\t\"skipping fan %d\\n\",\n\t\t\t(data->pwm_enable >> (idx * 2)) & 3, idx + 1);\n\t\treturn 0;  \n\t}\n\n\terr = f71882fg_create_sysfs_files(pdev, &fxxxx_fan_attr[idx][0],\n\t\t\t\t\t  ARRAY_SIZE(fxxxx_fan_attr[0]));\n\tif (err)\n\t\treturn err;\n\n\tif (f71882fg_fan_has_beep[data->type]) {\n\t\terr = f71882fg_create_sysfs_files(pdev,\n\t\t\t\t\t\t  &fxxxx_fan_beep_attr[idx],\n\t\t\t\t\t\t  1);\n\t\tif (err)\n\t\t\treturn err;\n\t}\n\n\tdev_info(&pdev->dev, \"Fan: %d is in %s mode\\n\", idx + 1,\n\t\t (data->pwm_enable & (1 << (2 * idx))) ? \"duty-cycle\" : \"RPM\");\n\n\t \n\tswitch (data->type) {\n\tcase f71808e:\n\tcase f71808a:\n\tcase f71869:\n\tcase f71869a:\n\tcase f71889fg:\n\tcase f71889ed:\n\tcase f71889a:\n\t\tdata->pwm_auto_point_mapping[idx] =\n\t\t\tf71882fg_read8(data, F71882FG_REG_POINT_MAPPING(idx));\n\t\tif ((data->pwm_auto_point_mapping[idx] & 0x80) ||\n\t\t    (data->pwm_auto_point_mapping[idx] & 3) == 0) {\n\t\t\tdev_warn(&pdev->dev,\n\t\t\t\t \"Auto pwm controlled by raw digital \"\n\t\t\t\t \"data, disabling pwm auto_point \"\n\t\t\t\t \"sysfs attributes for fan %d\\n\", idx + 1);\n\t\t\treturn 0;  \n\t\t}\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n\n\tswitch (data->type) {\n\tcase f71862fg:\n\t\terr = f71882fg_create_sysfs_files(pdev,\n\t\t\t\t\t&f71862fg_auto_pwm_attr[idx][0],\n\t\t\t\t\tARRAY_SIZE(f71862fg_auto_pwm_attr[0]));\n\t\tbreak;\n\tcase f71808e:\n\tcase f71869:\n\t\terr = f71882fg_create_sysfs_files(pdev,\n\t\t\t\t\t&f71869_auto_pwm_attr[idx][0],\n\t\t\t\t\tARRAY_SIZE(f71869_auto_pwm_attr[0]));\n\t\tbreak;\n\tcase f8000:\n\t\terr = f71882fg_create_sysfs_files(pdev,\n\t\t\t\t\t&f8000_auto_pwm_attr[idx][0],\n\t\t\t\t\tARRAY_SIZE(f8000_auto_pwm_attr[0]));\n\t\tbreak;\n\tdefault:\n\t\terr = f71882fg_create_sysfs_files(pdev,\n\t\t\t\t\t&fxxxx_auto_pwm_attr[idx][0],\n\t\t\t\t\tARRAY_SIZE(fxxxx_auto_pwm_attr[0]));\n\t}\n\n\treturn err;\n}\n\nstatic int f71882fg_remove(struct platform_device *pdev)\n{\n\tstruct f71882fg_data *data = platform_get_drvdata(pdev);\n\tint nr_fans = f71882fg_nr_fans[data->type];\n\tint nr_temps = f71882fg_nr_temps[data->type];\n\tint i;\n\tu8 start_reg = f71882fg_read8(data, F71882FG_REG_START);\n\n\tif (data->hwmon_dev)\n\t\thwmon_device_unregister(data->hwmon_dev);\n\n\tdevice_remove_file(&pdev->dev, &dev_attr_name);\n\n\tif (start_reg & 0x01) {\n\t\tswitch (data->type) {\n\t\tcase f71858fg:\n\t\t\tif (data->temp_config & 0x10)\n\t\t\t\tf71882fg_remove_sysfs_files(pdev,\n\t\t\t\t\tf8000_temp_attr,\n\t\t\t\t\tARRAY_SIZE(f8000_temp_attr));\n\t\t\telse\n\t\t\t\tf71882fg_remove_sysfs_files(pdev,\n\t\t\t\t\tf71858fg_temp_attr,\n\t\t\t\t\tARRAY_SIZE(f71858fg_temp_attr));\n\t\t\tbreak;\n\t\tcase f8000:\n\t\t\tf71882fg_remove_sysfs_files(pdev,\n\t\t\t\t\tf8000_temp_attr,\n\t\t\t\t\tARRAY_SIZE(f8000_temp_attr));\n\t\t\tbreak;\n\t\tcase f81866a:\n\t\t\tf71882fg_remove_sysfs_files(pdev,\n\t\t\t\t\tf71858fg_temp_attr,\n\t\t\t\t\tARRAY_SIZE(f71858fg_temp_attr));\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tf71882fg_remove_sysfs_files(pdev,\n\t\t\t\t&fxxxx_temp_attr[0][0],\n\t\t\t\tARRAY_SIZE(fxxxx_temp_attr[0]) * nr_temps);\n\t\t}\n\t\tif (f71882fg_temp_has_beep[data->type]) {\n\t\t\tif (data->type == f81866a)\n\t\t\t\tf71882fg_remove_sysfs_files(pdev,\n\t\t\t\t\t&f81866_temp_beep_attr[0][0],\n\t\t\t\t\tARRAY_SIZE(f81866_temp_beep_attr[0])\n\t\t\t\t\t\t* nr_temps);\n\t\t\telse\n\t\t\t\tf71882fg_remove_sysfs_files(pdev,\n\t\t\t\t\t&fxxxx_temp_beep_attr[0][0],\n\t\t\t\t\tARRAY_SIZE(fxxxx_temp_beep_attr[0])\n\t\t\t\t\t\t* nr_temps);\n\t\t}\n\n\t\tfor (i = 0; i < F71882FG_MAX_INS; i++) {\n\t\t\tif (f71882fg_has_in[data->type][i]) {\n\t\t\t\tdevice_remove_file(&pdev->dev,\n\t\t\t\t\t\t&fxxxx_in_attr[i].dev_attr);\n\t\t\t}\n\t\t}\n\t\tif (f71882fg_has_in1_alarm[data->type]) {\n\t\t\tf71882fg_remove_sysfs_files(pdev,\n\t\t\t\t\tfxxxx_in1_alarm_attr,\n\t\t\t\t\tARRAY_SIZE(fxxxx_in1_alarm_attr));\n\t\t}\n\t}\n\n\tif (start_reg & 0x02) {\n\t\tf71882fg_remove_sysfs_files(pdev, &fxxxx_fan_attr[0][0],\n\t\t\t\tARRAY_SIZE(fxxxx_fan_attr[0]) * nr_fans);\n\n\t\tif (f71882fg_fan_has_beep[data->type]) {\n\t\t\tf71882fg_remove_sysfs_files(pdev,\n\t\t\t\t\tfxxxx_fan_beep_attr, nr_fans);\n\t\t}\n\n\t\tswitch (data->type) {\n\t\tcase f71808a:\n\t\t\tf71882fg_remove_sysfs_files(pdev,\n\t\t\t\t&fxxxx_auto_pwm_attr[0][0],\n\t\t\t\tARRAY_SIZE(fxxxx_auto_pwm_attr[0]) * nr_fans);\n\t\t\tf71882fg_remove_sysfs_files(pdev,\n\t\t\t\t\tf71808a_fan3_attr,\n\t\t\t\t\tARRAY_SIZE(f71808a_fan3_attr));\n\t\t\tbreak;\n\t\tcase f71862fg:\n\t\t\tf71882fg_remove_sysfs_files(pdev,\n\t\t\t\t&f71862fg_auto_pwm_attr[0][0],\n\t\t\t\tARRAY_SIZE(f71862fg_auto_pwm_attr[0]) *\n\t\t\t\t\tnr_fans);\n\t\t\tbreak;\n\t\tcase f71808e:\n\t\tcase f71869:\n\t\t\tf71882fg_remove_sysfs_files(pdev,\n\t\t\t\t&f71869_auto_pwm_attr[0][0],\n\t\t\t\tARRAY_SIZE(f71869_auto_pwm_attr[0]) * nr_fans);\n\t\t\tbreak;\n\t\tcase f8000:\n\t\t\tf71882fg_remove_sysfs_files(pdev,\n\t\t\t\t\tf8000_fan_attr,\n\t\t\t\t\tARRAY_SIZE(f8000_fan_attr));\n\t\t\tf71882fg_remove_sysfs_files(pdev,\n\t\t\t\t&f8000_auto_pwm_attr[0][0],\n\t\t\t\tARRAY_SIZE(f8000_auto_pwm_attr[0]) * nr_fans);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tf71882fg_remove_sysfs_files(pdev,\n\t\t\t\t&fxxxx_auto_pwm_attr[0][0],\n\t\t\t\tARRAY_SIZE(fxxxx_auto_pwm_attr[0]) * nr_fans);\n\t\t}\n\t}\n\treturn 0;\n}\n\nstatic int f71882fg_probe(struct platform_device *pdev)\n{\n\tstruct f71882fg_data *data;\n\tstruct f71882fg_sio_data *sio_data = dev_get_platdata(&pdev->dev);\n\tint nr_fans = f71882fg_nr_fans[sio_data->type];\n\tint nr_temps = f71882fg_nr_temps[sio_data->type];\n\tint err, i;\n\tint size;\n\tu8 start_reg, reg;\n\n\tdata = devm_kzalloc(&pdev->dev, sizeof(struct f71882fg_data),\n\t\t\t    GFP_KERNEL);\n\tif (!data)\n\t\treturn -ENOMEM;\n\n\tdata->addr = platform_get_resource(pdev, IORESOURCE_IO, 0)->start;\n\tdata->type = sio_data->type;\n\tdata->temp_start =\n\t    (data->type == f71858fg || data->type == f8000 ||\n\t\tdata->type == f81866a) ? 0 : 1;\n\tmutex_init(&data->update_lock);\n\tplatform_set_drvdata(pdev, data);\n\n\tstart_reg = f71882fg_read8(data, F71882FG_REG_START);\n\tif (start_reg & 0x04) {\n\t\tdev_warn(&pdev->dev, \"Hardware monitor is powered down\\n\");\n\t\treturn -ENODEV;\n\t}\n\tif (!(start_reg & 0x03)) {\n\t\tdev_warn(&pdev->dev, \"Hardware monitoring not activated\\n\");\n\t\treturn -ENODEV;\n\t}\n\n\t \n\terr = device_create_file(&pdev->dev, &dev_attr_name);\n\tif (err)\n\t\tgoto exit_unregister_sysfs;\n\n\tif (start_reg & 0x01) {\n\t\tswitch (data->type) {\n\t\tcase f71858fg:\n\t\t\tdata->temp_config =\n\t\t\t\tf71882fg_read8(data, F71882FG_REG_TEMP_CONFIG);\n\t\t\tif (data->temp_config & 0x10)\n\t\t\t\t \n\t\t\t\terr = f71882fg_create_sysfs_files(pdev,\n\t\t\t\t\tf8000_temp_attr,\n\t\t\t\t\tARRAY_SIZE(f8000_temp_attr));\n\t\t\telse\n\t\t\t\terr = f71882fg_create_sysfs_files(pdev,\n\t\t\t\t\tf71858fg_temp_attr,\n\t\t\t\t\tARRAY_SIZE(f71858fg_temp_attr));\n\t\t\tbreak;\n\t\tcase f8000:\n\t\t\terr = f71882fg_create_sysfs_files(pdev,\n\t\t\t\t\tf8000_temp_attr,\n\t\t\t\t\tARRAY_SIZE(f8000_temp_attr));\n\t\t\tbreak;\n\t\tcase f81866a:\n\t\t\terr = f71882fg_create_sysfs_files(pdev,\n\t\t\t\t\tf71858fg_temp_attr,\n\t\t\t\t\tARRAY_SIZE(f71858fg_temp_attr));\n\t\t\tbreak;\n\t\tdefault:\n\t\t\terr = f71882fg_create_sysfs_files(pdev,\n\t\t\t\t&fxxxx_temp_attr[0][0],\n\t\t\t\tARRAY_SIZE(fxxxx_temp_attr[0]) * nr_temps);\n\t\t}\n\t\tif (err)\n\t\t\tgoto exit_unregister_sysfs;\n\n\t\tif (f71882fg_temp_has_beep[data->type]) {\n\t\t\tif (data->type == f81866a) {\n\t\t\t\tsize = ARRAY_SIZE(f81866_temp_beep_attr[0]);\n\t\t\t\terr = f71882fg_create_sysfs_files(pdev,\n\t\t\t\t\t\t&f81866_temp_beep_attr[0][0],\n\t\t\t\t\t\tsize * nr_temps);\n\n\t\t\t} else {\n\t\t\t\tsize = ARRAY_SIZE(fxxxx_temp_beep_attr[0]);\n\t\t\t\terr = f71882fg_create_sysfs_files(pdev,\n\t\t\t\t\t\t&fxxxx_temp_beep_attr[0][0],\n\t\t\t\t\t\tsize * nr_temps);\n\t\t\t}\n\t\t\tif (err)\n\t\t\t\tgoto exit_unregister_sysfs;\n\t\t}\n\n\t\tfor (i = 0; i < F71882FG_MAX_INS; i++) {\n\t\t\tif (f71882fg_has_in[data->type][i]) {\n\t\t\t\terr = device_create_file(&pdev->dev,\n\t\t\t\t\t\t&fxxxx_in_attr[i].dev_attr);\n\t\t\t\tif (err)\n\t\t\t\t\tgoto exit_unregister_sysfs;\n\t\t\t}\n\t\t}\n\t\tif (f71882fg_has_in1_alarm[data->type]) {\n\t\t\terr = f71882fg_create_sysfs_files(pdev,\n\t\t\t\t\tfxxxx_in1_alarm_attr,\n\t\t\t\t\tARRAY_SIZE(fxxxx_in1_alarm_attr));\n\t\t\tif (err)\n\t\t\t\tgoto exit_unregister_sysfs;\n\t\t}\n\t}\n\n\tif (start_reg & 0x02) {\n\t\tswitch (data->type) {\n\t\tcase f71808e:\n\t\tcase f71808a:\n\t\tcase f71869:\n\t\tcase f71869a:\n\t\t\t \n\t\t\tdata->auto_point_temp_signed = 1;\n\t\t\tfallthrough;\t \n\t\tcase f71889fg:\n\t\tcase f71889ed:\n\t\tcase f71889a:\n\t\t\treg = f71882fg_read8(data, F71882FG_REG_FAN_FAULT_T);\n\t\t\tif (reg & F71882FG_FAN_NEG_TEMP_EN)\n\t\t\t\tdata->auto_point_temp_signed = 1;\n\t\t\t \n\t\t\treg &= ~F71882FG_FAN_PROG_SEL;\n\t\t\tf71882fg_write8(data, F71882FG_REG_FAN_FAULT_T, reg);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tbreak;\n\t\t}\n\n\t\tdata->pwm_enable =\n\t\t\tf71882fg_read8(data, F71882FG_REG_PWM_ENABLE);\n\n\t\tfor (i = 0; i < nr_fans; i++) {\n\t\t\terr = f71882fg_create_fan_sysfs_files(pdev, i);\n\t\t\tif (err)\n\t\t\t\tgoto exit_unregister_sysfs;\n\t\t}\n\n\t\t \n\t\tswitch (data->type) {\n\t\tcase f71808a:\n\t\t\terr = f71882fg_create_sysfs_files(pdev,\n\t\t\t\t\tf71808a_fan3_attr,\n\t\t\t\t\tARRAY_SIZE(f71808a_fan3_attr));\n\t\t\tbreak;\n\t\tcase f8000:\n\t\t\terr = f71882fg_create_sysfs_files(pdev,\n\t\t\t\t\tf8000_fan_attr,\n\t\t\t\t\tARRAY_SIZE(f8000_fan_attr));\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tbreak;\n\t\t}\n\t\tif (err)\n\t\t\tgoto exit_unregister_sysfs;\n\t}\n\n\tdata->hwmon_dev = hwmon_device_register(&pdev->dev);\n\tif (IS_ERR(data->hwmon_dev)) {\n\t\terr = PTR_ERR(data->hwmon_dev);\n\t\tdata->hwmon_dev = NULL;\n\t\tgoto exit_unregister_sysfs;\n\t}\n\n\treturn 0;\n\nexit_unregister_sysfs:\n\tf71882fg_remove(pdev);  \n\treturn err;  \n}\n\nstatic int __init f71882fg_find(int sioaddr, struct f71882fg_sio_data *sio_data)\n{\n\tu16 devid;\n\tunsigned short address;\n\tint err = superio_enter(sioaddr);\n\tif (err)\n\t\treturn err;\n\n\tdevid = superio_inw(sioaddr, SIO_REG_MANID);\n\tif (devid != SIO_FINTEK_ID) {\n\t\tpr_debug(\"Not a Fintek device\\n\");\n\t\terr = -ENODEV;\n\t\tgoto exit;\n\t}\n\n\tdevid = force_id ? force_id : superio_inw(sioaddr, SIO_REG_DEVID);\n\tswitch (devid) {\n\tcase SIO_F71808E_ID:\n\t\tsio_data->type = f71808e;\n\t\tbreak;\n\tcase SIO_F71808A_ID:\n\t\tsio_data->type = f71808a;\n\t\tbreak;\n\tcase SIO_F71858_ID:\n\tcase SIO_F71858AD_ID:\n\t\tsio_data->type = f71858fg;\n\t\tbreak;\n\tcase SIO_F71862_ID:\n\t\tsio_data->type = f71862fg;\n\t\tbreak;\n\tcase SIO_F71868_ID:\n\t\tsio_data->type = f71868a;\n\t\tbreak;\n\tcase SIO_F71869_ID:\n\t\tsio_data->type = f71869;\n\t\tbreak;\n\tcase SIO_F71869A_ID:\n\t\tsio_data->type = f71869a;\n\t\tbreak;\n\tcase SIO_F71882_ID:\n\t\tsio_data->type = f71882fg;\n\t\tbreak;\n\tcase SIO_F71889_ID:\n\t\tsio_data->type = f71889fg;\n\t\tbreak;\n\tcase SIO_F71889E_ID:\n\t\tsio_data->type = f71889ed;\n\t\tbreak;\n\tcase SIO_F71889A_ID:\n\t\tsio_data->type = f71889a;\n\t\tbreak;\n\tcase SIO_F8000_ID:\n\t\tsio_data->type = f8000;\n\t\tbreak;\n\tcase SIO_F81768D_ID:\n\t\tsio_data->type = f81768d;\n\t\tbreak;\n\tcase SIO_F81865_ID:\n\t\tsio_data->type = f81865f;\n\t\tbreak;\n\tcase SIO_F81866_ID:\n\tcase SIO_F81966_ID:\n\t\tsio_data->type = f81866a;\n\t\tbreak;\n\tdefault:\n\t\tpr_info(\"Unsupported Fintek device: %04x\\n\",\n\t\t\t(unsigned int)devid);\n\t\terr = -ENODEV;\n\t\tgoto exit;\n\t}\n\n\tif (sio_data->type == f71858fg)\n\t\tsuperio_select(sioaddr, SIO_F71858FG_LD_HWM);\n\telse\n\t\tsuperio_select(sioaddr, SIO_F71882FG_LD_HWM);\n\n\tif (!(superio_inb(sioaddr, SIO_REG_ENABLE) & 0x01)) {\n\t\tpr_warn(\"Device not activated\\n\");\n\t\terr = -ENODEV;\n\t\tgoto exit;\n\t}\n\n\taddress = superio_inw(sioaddr, SIO_REG_ADDR);\n\tif (address == 0) {\n\t\tpr_warn(\"Base address not set\\n\");\n\t\terr = -ENODEV;\n\t\tgoto exit;\n\t}\n\taddress &= ~(REGION_LENGTH - 1);\t \n\n\terr = address;\n\tpr_info(\"Found %s chip at %#x, revision %d\\n\",\n\t\tf71882fg_names[sio_data->type],\t(unsigned int)address,\n\t\t(int)superio_inb(sioaddr, SIO_REG_DEVREV));\nexit:\n\tsuperio_exit(sioaddr);\n\treturn err;\n}\n\nstatic int __init f71882fg_device_add(int address,\n\t\t\t\t      const struct f71882fg_sio_data *sio_data)\n{\n\tstruct resource res = {\n\t\t.start\t= address,\n\t\t.end\t= address + REGION_LENGTH - 1,\n\t\t.flags\t= IORESOURCE_IO,\n\t};\n\tint err;\n\n\tf71882fg_pdev = platform_device_alloc(DRVNAME, address);\n\tif (!f71882fg_pdev)\n\t\treturn -ENOMEM;\n\n\tres.name = f71882fg_pdev->name;\n\terr = acpi_check_resource_conflict(&res);\n\tif (err)\n\t\tgoto exit_device_put;\n\n\terr = platform_device_add_resources(f71882fg_pdev, &res, 1);\n\tif (err) {\n\t\tpr_err(\"Device resource addition failed\\n\");\n\t\tgoto exit_device_put;\n\t}\n\n\terr = platform_device_add_data(f71882fg_pdev, sio_data,\n\t\t\t\t       sizeof(struct f71882fg_sio_data));\n\tif (err) {\n\t\tpr_err(\"Platform data allocation failed\\n\");\n\t\tgoto exit_device_put;\n\t}\n\n\terr = platform_device_add(f71882fg_pdev);\n\tif (err) {\n\t\tpr_err(\"Device addition failed\\n\");\n\t\tgoto exit_device_put;\n\t}\n\n\treturn 0;\n\nexit_device_put:\n\tplatform_device_put(f71882fg_pdev);\n\n\treturn err;\n}\n\nstatic struct platform_driver f71882fg_driver = {\n\t.driver = {\n\t\t.name\t= DRVNAME,\n\t},\n\t.probe\t\t= f71882fg_probe,\n\t.remove\t\t= f71882fg_remove,\n};\n\nstatic int __init f71882fg_init(void)\n{\n\tint err;\n\tint address;\n\tstruct f71882fg_sio_data sio_data;\n\n\tmemset(&sio_data, 0, sizeof(sio_data));\n\n\taddress = f71882fg_find(0x2e, &sio_data);\n\tif (address < 0)\n\t\taddress = f71882fg_find(0x4e, &sio_data);\n\tif (address < 0)\n\t\treturn address;\n\n\terr = platform_driver_register(&f71882fg_driver);\n\tif (err)\n\t\treturn err;\n\n\terr = f71882fg_device_add(address, &sio_data);\n\tif (err)\n\t\tgoto exit_driver;\n\n\treturn 0;\n\nexit_driver:\n\tplatform_driver_unregister(&f71882fg_driver);\n\treturn err;\n}\n\nstatic void __exit f71882fg_exit(void)\n{\n\tplatform_device_unregister(f71882fg_pdev);\n\tplatform_driver_unregister(&f71882fg_driver);\n}\n\nMODULE_DESCRIPTION(\"F71882FG Hardware Monitoring Driver\");\nMODULE_AUTHOR(\"Hans Edgington, Hans de Goede <hdegoede@redhat.com>\");\nMODULE_LICENSE(\"GPL\");\n\nmodule_init(f71882fg_init);\nmodule_exit(f71882fg_exit);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}