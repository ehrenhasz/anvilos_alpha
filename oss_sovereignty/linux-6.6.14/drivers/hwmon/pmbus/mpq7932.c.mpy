{
  "module_name": "mpq7932.c",
  "hash_id": "bd9dd5b99abe2a23a293d2639d79de3de2978e8652cb608f72c48d4c78f3e3cb",
  "original_prompt": "Ingested from linux-6.6.14/drivers/hwmon/pmbus/mpq7932.c",
  "human_readable_source": "\n \n\n#include <linux/bits.h>\n#include <linux/err.h>\n#include <linux/i2c.h>\n#include <linux/init.h>\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/of.h>\n#include <linux/pmbus.h>\n#include \"pmbus.h\"\n\n#define MPQ7932_BUCK_UV_MIN\t\t206250\n#define MPQ7932_UV_STEP\t\t\t6250\n#define MPQ7932_N_VOLTAGES\t\t256\n#define MPQ7932_VOUT_MAX\t\t0xFF\n#define MPQ7932_NUM_PAGES\t\t6\n\n#define MPQ7932_TON_DELAY\t\t0x60\n#define MPQ7932_VOUT_STARTUP_SLEW\t0xA3\n#define MPQ7932_VOUT_SHUTDOWN_SLEW\t0xA5\n#define MPQ7932_VOUT_SLEW_MASK\t\tGENMASK(1, 0)\n#define MPQ7932_TON_DELAY_MASK\t\tGENMASK(4, 0)\n\nstruct mpq7932_data {\n\tstruct pmbus_driver_info info;\n\tstruct pmbus_platform_data pdata;\n};\n\n#if IS_ENABLED(CONFIG_SENSORS_MPQ7932_REGULATOR)\nstatic struct regulator_desc mpq7932_regulators_desc[] = {\n\tPMBUS_REGULATOR_STEP(\"buck\", 0, MPQ7932_N_VOLTAGES,\n\t\t\t     MPQ7932_UV_STEP, MPQ7932_BUCK_UV_MIN),\n\tPMBUS_REGULATOR_STEP(\"buck\", 1, MPQ7932_N_VOLTAGES,\n\t\t\t     MPQ7932_UV_STEP, MPQ7932_BUCK_UV_MIN),\n\tPMBUS_REGULATOR_STEP(\"buck\", 2, MPQ7932_N_VOLTAGES,\n\t\t\t     MPQ7932_UV_STEP, MPQ7932_BUCK_UV_MIN),\n\tPMBUS_REGULATOR_STEP(\"buck\", 3, MPQ7932_N_VOLTAGES,\n\t\t\t     MPQ7932_UV_STEP, MPQ7932_BUCK_UV_MIN),\n\tPMBUS_REGULATOR_STEP(\"buck\", 4, MPQ7932_N_VOLTAGES,\n\t\t\t     MPQ7932_UV_STEP, MPQ7932_BUCK_UV_MIN),\n\tPMBUS_REGULATOR_STEP(\"buck\", 5, MPQ7932_N_VOLTAGES,\n\t\t\t     MPQ7932_UV_STEP, MPQ7932_BUCK_UV_MIN),\n};\n#endif\n\nstatic int mpq7932_write_word_data(struct i2c_client *client, int page, int reg,\n\t\t\t\t   u16 word)\n{\n\tswitch (reg) {\n\t \n\tcase PMBUS_VOUT_COMMAND:\n\t\treturn pmbus_write_byte_data(client, page, reg, word & 0xFF);\n\n\tdefault:\n\t\treturn -ENODATA;\n\t}\n}\n\nstatic int mpq7932_read_word_data(struct i2c_client *client, int page,\n\t\t\t\t  int phase, int reg)\n{\n\tswitch (reg) {\n\t \n\tcase PMBUS_MFR_VOUT_MIN:\n\t\treturn 0;\n\n\tcase PMBUS_MFR_VOUT_MAX:\n\t\treturn MPQ7932_VOUT_MAX;\n\n\t \n\tcase PMBUS_READ_VOUT:\n\t\treturn pmbus_read_byte_data(client, page, PMBUS_VOUT_COMMAND);\n\n\tdefault:\n\t\treturn -ENODATA;\n\t}\n}\n\nstatic int mpq7932_probe(struct i2c_client *client)\n{\n\tstruct mpq7932_data *data;\n\tstruct pmbus_driver_info *info;\n\tstruct device *dev = &client->dev;\n\tint i;\n\n\tdata = devm_kzalloc(dev, sizeof(struct mpq7932_data), GFP_KERNEL);\n\tif (!data)\n\t\treturn -ENOMEM;\n\n\tinfo = &data->info;\n\tinfo->pages = MPQ7932_NUM_PAGES;\n\tinfo->format[PSC_VOLTAGE_OUT] = direct;\n\tinfo->m[PSC_VOLTAGE_OUT] = 160;\n\tinfo->b[PSC_VOLTAGE_OUT] = -33;\n\tfor (i = 0; i < info->pages; i++) {\n\t\tinfo->func[i] = PMBUS_HAVE_VOUT | PMBUS_HAVE_STATUS_VOUT\n\t\t\t\t| PMBUS_HAVE_STATUS_TEMP;\n\t}\n\n#if IS_ENABLED(CONFIG_SENSORS_MPQ7932_REGULATOR)\n\tinfo->num_regulators = ARRAY_SIZE(mpq7932_regulators_desc);\n\tinfo->reg_desc = mpq7932_regulators_desc;\n#endif\n\n\tinfo->read_word_data = mpq7932_read_word_data;\n\tinfo->write_word_data = mpq7932_write_word_data;\n\n\tdata->pdata.flags = PMBUS_NO_CAPABILITY;\n\tdev->platform_data = &data->pdata;\n\n\treturn pmbus_do_probe(client, info);\n}\n\nstatic const struct of_device_id mpq7932_of_match[] = {\n\t{ .compatible = \"mps,mpq7932\"},\n\t{},\n};\nMODULE_DEVICE_TABLE(of, mpq7932_of_match);\n\nstatic const struct i2c_device_id mpq7932_id[] = {\n\t{ \"mpq7932\", },\n\t{ },\n};\nMODULE_DEVICE_TABLE(i2c, mpq7932_id);\n\nstatic struct i2c_driver mpq7932_regulator_driver = {\n\t.driver = {\n\t\t.name = \"mpq7932\",\n\t\t.of_match_table = mpq7932_of_match,\n\t},\n\t.probe = mpq7932_probe,\n\t.id_table = mpq7932_id,\n};\nmodule_i2c_driver(mpq7932_regulator_driver);\n\nMODULE_AUTHOR(\"Saravanan Sekar <saravanan@linumiz.com>\");\nMODULE_DESCRIPTION(\"MPQ7932 PMIC regulator driver\");\nMODULE_LICENSE(\"GPL\");\nMODULE_IMPORT_NS(PMBUS);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}