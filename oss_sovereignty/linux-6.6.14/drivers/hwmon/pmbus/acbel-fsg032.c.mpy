{
  "module_name": "acbel-fsg032.c",
  "hash_id": "957c7463d369efa490c2acce3c07b772d8a1f2f2450aa4b70a60f4115c236aa4",
  "original_prompt": "Ingested from linux-6.6.14/drivers/hwmon/pmbus/acbel-fsg032.c",
  "human_readable_source": "\n \n\n#include <linux/debugfs.h>\n#include <linux/device.h>\n#include <linux/fs.h>\n#include <linux/i2c.h>\n#include <linux/minmax.h>\n#include <linux/module.h>\n#include <linux/pmbus.h>\n#include <linux/hwmon-sysfs.h>\n#include \"pmbus.h\"\n\n#define ACBEL_MFR_FW_REVISION\t0xd9\n\nstatic ssize_t acbel_fsg032_debugfs_read(struct file *file, char __user *buf, size_t count,\n\t\t\t\t\t loff_t *ppos)\n{\n\tstruct i2c_client *client = file->private_data;\n\tu8 data[I2C_SMBUS_BLOCK_MAX + 2] = { 0 };\n\tchar out[8];\n\tint rc;\n\n\trc = i2c_smbus_read_block_data(client, ACBEL_MFR_FW_REVISION, data);\n\tif (rc < 0)\n\t\treturn rc;\n\n\trc = snprintf(out, sizeof(out), \"%*phN\\n\", min(rc, 3), data);\n\treturn simple_read_from_buffer(buf, count, ppos, out, rc);\n}\n\nstatic const struct file_operations acbel_debugfs_ops = {\n\t.llseek = noop_llseek,\n\t.read = acbel_fsg032_debugfs_read,\n\t.write = NULL,\n\t.open = simple_open,\n};\n\nstatic void acbel_fsg032_init_debugfs(struct i2c_client *client)\n{\n\tstruct dentry *debugfs = pmbus_get_debugfs_dir(client);\n\n\tif (!debugfs)\n\t\treturn;\n\n\tdebugfs_create_file(\"fw_version\", 0444, debugfs, client, &acbel_debugfs_ops);\n}\n\nstatic const struct i2c_device_id acbel_fsg032_id[] = {\n\t{ \"acbel_fsg032\" },\n\t{}\n};\n\nstatic struct pmbus_driver_info acbel_fsg032_info = {\n\t.pages = 1,\n\t.func[0] = PMBUS_HAVE_VIN | PMBUS_HAVE_IIN | PMBUS_HAVE_PIN |\n\t\t   PMBUS_HAVE_VOUT | PMBUS_HAVE_IOUT | PMBUS_HAVE_POUT |\n\t\t   PMBUS_HAVE_TEMP | PMBUS_HAVE_TEMP2 | PMBUS_HAVE_TEMP3 |\n\t\t   PMBUS_HAVE_FAN12 | PMBUS_HAVE_STATUS_VOUT |\n\t\t   PMBUS_HAVE_STATUS_IOUT | PMBUS_HAVE_STATUS_TEMP |\n\t\t   PMBUS_HAVE_STATUS_INPUT | PMBUS_HAVE_STATUS_FAN12,\n};\n\nstatic int acbel_fsg032_probe(struct i2c_client *client)\n{\n\tu8 buf[I2C_SMBUS_BLOCK_MAX + 1];\n\tstruct device *dev = &client->dev;\n\tint rc;\n\n\trc = i2c_smbus_read_block_data(client, PMBUS_MFR_ID, buf);\n\tif (rc < 0) {\n\t\tdev_err(dev, \"Failed to read PMBUS_MFR_ID\\n\");\n\t\treturn rc;\n\t}\n\tif (strncmp(buf, \"ACBEL\", 5)) {\n\t\tbuf[rc] = '\\0';\n\t\tdev_err(dev, \"Manufacturer '%s' not supported\\n\", buf);\n\t\treturn -ENODEV;\n\t}\n\n\trc = i2c_smbus_read_block_data(client, PMBUS_MFR_MODEL, buf);\n\tif (rc < 0) {\n\t\tdev_err(dev, \"Failed to read PMBUS_MFR_MODEL\\n\");\n\t\treturn rc;\n\t}\n\n\tif (strncmp(buf, \"FSG032\", 6)) {\n\t\tbuf[rc] = '\\0';\n\t\tdev_err(dev, \"Model '%s' not supported\\n\", buf);\n\t\treturn -ENODEV;\n\t}\n\n\trc = pmbus_do_probe(client, &acbel_fsg032_info);\n\tif (rc)\n\t\treturn rc;\n\n\tacbel_fsg032_init_debugfs(client);\n\treturn 0;\n}\n\nstatic const struct of_device_id acbel_fsg032_of_match[] = {\n\t{ .compatible = \"acbel,fsg032\" },\n\t{}\n};\nMODULE_DEVICE_TABLE(of, acbel_fsg032_of_match);\n\nstatic struct i2c_driver acbel_fsg032_driver = {\n\t.driver = {\n\t\t.name = \"acbel-fsg032\",\n\t\t.of_match_table = acbel_fsg032_of_match,\n\t},\n\t.probe = acbel_fsg032_probe,\n\t.id_table = acbel_fsg032_id,\n};\n\nmodule_i2c_driver(acbel_fsg032_driver);\n\nMODULE_AUTHOR(\"Lakshmi Yadlapati\");\nMODULE_DESCRIPTION(\"PMBus driver for AcBel Power System power supplies\");\nMODULE_LICENSE(\"GPL\");\nMODULE_IMPORT_NS(PMBUS);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}