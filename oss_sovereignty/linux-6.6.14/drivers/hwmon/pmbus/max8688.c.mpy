{
  "module_name": "max8688.c",
  "hash_id": "e59c6f5679110c19a19eef41018ad0d7a64e49095d8ecf08bafa1219dd2c0909",
  "original_prompt": "Ingested from linux-6.6.14/drivers/hwmon/pmbus/max8688.c",
  "human_readable_source": "\n \n\n#include <linux/bitops.h>\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/init.h>\n#include <linux/err.h>\n#include <linux/i2c.h>\n#include \"pmbus.h\"\n\n#define MAX8688_MFR_VOUT_PEAK\t\t0xd4\n#define MAX8688_MFR_IOUT_PEAK\t\t0xd5\n#define MAX8688_MFR_TEMPERATURE_PEAK\t0xd6\n#define MAX8688_MFG_STATUS\t\t0xd8\n\n#define MAX8688_STATUS_OC_FAULT\t\tBIT(4)\n#define MAX8688_STATUS_OV_FAULT\t\tBIT(5)\n#define MAX8688_STATUS_OV_WARNING\tBIT(8)\n#define MAX8688_STATUS_UV_FAULT\t\tBIT(9)\n#define MAX8688_STATUS_UV_WARNING\tBIT(10)\n#define MAX8688_STATUS_UC_FAULT\t\tBIT(11)\n#define MAX8688_STATUS_OC_WARNING\tBIT(12)\n#define MAX8688_STATUS_OT_FAULT\t\tBIT(13)\n#define MAX8688_STATUS_OT_WARNING\tBIT(14)\n\nstatic int max8688_read_word_data(struct i2c_client *client, int page,\n\t\t\t\t  int phase, int reg)\n{\n\tint ret;\n\n\tif (page > 0)\n\t\treturn -ENXIO;\n\n\tswitch (reg) {\n\tcase PMBUS_VIRT_READ_VOUT_MAX:\n\t\tret = pmbus_read_word_data(client, 0, 0xff,\n\t\t\t\t\t   MAX8688_MFR_VOUT_PEAK);\n\t\tbreak;\n\tcase PMBUS_VIRT_READ_IOUT_MAX:\n\t\tret = pmbus_read_word_data(client, 0, 0xff,\n\t\t\t\t\t   MAX8688_MFR_IOUT_PEAK);\n\t\tbreak;\n\tcase PMBUS_VIRT_READ_TEMP_MAX:\n\t\tret = pmbus_read_word_data(client, 0, 0xff,\n\t\t\t\t\t   MAX8688_MFR_TEMPERATURE_PEAK);\n\t\tbreak;\n\tcase PMBUS_VIRT_RESET_VOUT_HISTORY:\n\tcase PMBUS_VIRT_RESET_IOUT_HISTORY:\n\tcase PMBUS_VIRT_RESET_TEMP_HISTORY:\n\t\tret = 0;\n\t\tbreak;\n\tdefault:\n\t\tret = -ENODATA;\n\t\tbreak;\n\t}\n\treturn ret;\n}\n\nstatic int max8688_write_word_data(struct i2c_client *client, int page, int reg,\n\t\t\t\t   u16 word)\n{\n\tint ret;\n\n\tswitch (reg) {\n\tcase PMBUS_VIRT_RESET_VOUT_HISTORY:\n\t\tret = pmbus_write_word_data(client, 0, MAX8688_MFR_VOUT_PEAK,\n\t\t\t\t\t    0);\n\t\tbreak;\n\tcase PMBUS_VIRT_RESET_IOUT_HISTORY:\n\t\tret = pmbus_write_word_data(client, 0, MAX8688_MFR_IOUT_PEAK,\n\t\t\t\t\t    0);\n\t\tbreak;\n\tcase PMBUS_VIRT_RESET_TEMP_HISTORY:\n\t\tret = pmbus_write_word_data(client, 0,\n\t\t\t\t\t    MAX8688_MFR_TEMPERATURE_PEAK,\n\t\t\t\t\t    0xffff);\n\t\tbreak;\n\tdefault:\n\t\tret = -ENODATA;\n\t\tbreak;\n\t}\n\treturn ret;\n}\n\nstatic int max8688_read_byte_data(struct i2c_client *client, int page, int reg)\n{\n\tint ret = 0;\n\tint mfg_status;\n\n\tif (page > 0)\n\t\treturn -ENXIO;\n\n\tswitch (reg) {\n\tcase PMBUS_STATUS_VOUT:\n\t\tmfg_status = pmbus_read_word_data(client, 0, 0xff,\n\t\t\t\t\t\t  MAX8688_MFG_STATUS);\n\t\tif (mfg_status < 0)\n\t\t\treturn mfg_status;\n\t\tif (mfg_status & MAX8688_STATUS_UV_WARNING)\n\t\t\tret |= PB_VOLTAGE_UV_WARNING;\n\t\tif (mfg_status & MAX8688_STATUS_UV_FAULT)\n\t\t\tret |= PB_VOLTAGE_UV_FAULT;\n\t\tif (mfg_status & MAX8688_STATUS_OV_WARNING)\n\t\t\tret |= PB_VOLTAGE_OV_WARNING;\n\t\tif (mfg_status & MAX8688_STATUS_OV_FAULT)\n\t\t\tret |= PB_VOLTAGE_OV_FAULT;\n\t\tbreak;\n\tcase PMBUS_STATUS_IOUT:\n\t\tmfg_status = pmbus_read_word_data(client, 0, 0xff,\n\t\t\t\t\t\t  MAX8688_MFG_STATUS);\n\t\tif (mfg_status < 0)\n\t\t\treturn mfg_status;\n\t\tif (mfg_status & MAX8688_STATUS_UC_FAULT)\n\t\t\tret |= PB_IOUT_UC_FAULT;\n\t\tif (mfg_status & MAX8688_STATUS_OC_WARNING)\n\t\t\tret |= PB_IOUT_OC_WARNING;\n\t\tif (mfg_status & MAX8688_STATUS_OC_FAULT)\n\t\t\tret |= PB_IOUT_OC_FAULT;\n\t\tbreak;\n\tcase PMBUS_STATUS_TEMPERATURE:\n\t\tmfg_status = pmbus_read_word_data(client, 0, 0xff,\n\t\t\t\t\t\t  MAX8688_MFG_STATUS);\n\t\tif (mfg_status < 0)\n\t\t\treturn mfg_status;\n\t\tif (mfg_status & MAX8688_STATUS_OT_WARNING)\n\t\t\tret |= PB_TEMP_OT_WARNING;\n\t\tif (mfg_status & MAX8688_STATUS_OT_FAULT)\n\t\t\tret |= PB_TEMP_OT_FAULT;\n\t\tbreak;\n\tdefault:\n\t\tret = -ENODATA;\n\t\tbreak;\n\t}\n\treturn ret;\n}\n\nstatic struct pmbus_driver_info max8688_info = {\n\t.pages = 1,\n\t.format[PSC_VOLTAGE_IN] = direct,\n\t.format[PSC_VOLTAGE_OUT] = direct,\n\t.format[PSC_TEMPERATURE] = direct,\n\t.format[PSC_CURRENT_OUT] = direct,\n\t.m[PSC_VOLTAGE_IN] = 19995,\n\t.b[PSC_VOLTAGE_IN] = 0,\n\t.R[PSC_VOLTAGE_IN] = -1,\n\t.m[PSC_VOLTAGE_OUT] = 19995,\n\t.b[PSC_VOLTAGE_OUT] = 0,\n\t.R[PSC_VOLTAGE_OUT] = -1,\n\t.m[PSC_CURRENT_OUT] = 23109,\n\t.b[PSC_CURRENT_OUT] = 0,\n\t.R[PSC_CURRENT_OUT] = -2,\n\t.m[PSC_TEMPERATURE] = -7612,\n\t.b[PSC_TEMPERATURE] = 335,\n\t.R[PSC_TEMPERATURE] = -3,\n\t.func[0] = PMBUS_HAVE_VOUT | PMBUS_HAVE_IOUT | PMBUS_HAVE_TEMP\n\t\t| PMBUS_HAVE_STATUS_VOUT | PMBUS_HAVE_STATUS_IOUT\n\t\t| PMBUS_HAVE_STATUS_TEMP,\n\t.read_byte_data = max8688_read_byte_data,\n\t.read_word_data = max8688_read_word_data,\n\t.write_word_data = max8688_write_word_data,\n};\n\nstatic int max8688_probe(struct i2c_client *client)\n{\n\treturn pmbus_do_probe(client, &max8688_info);\n}\n\nstatic const struct i2c_device_id max8688_id[] = {\n\t{\"max8688\", 0},\n\t{ }\n};\n\nMODULE_DEVICE_TABLE(i2c, max8688_id);\n\n \nstatic struct i2c_driver max8688_driver = {\n\t.driver = {\n\t\t   .name = \"max8688\",\n\t\t   },\n\t.probe = max8688_probe,\n\t.id_table = max8688_id,\n};\n\nmodule_i2c_driver(max8688_driver);\n\nMODULE_AUTHOR(\"Guenter Roeck\");\nMODULE_DESCRIPTION(\"PMBus driver for Maxim MAX8688\");\nMODULE_LICENSE(\"GPL\");\nMODULE_IMPORT_NS(PMBUS);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}