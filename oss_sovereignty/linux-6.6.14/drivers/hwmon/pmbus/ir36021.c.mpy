{
  "module_name": "ir36021.c",
  "hash_id": "9e1012b397e58ee596f6bbd73c4826ba68519e47c196ce1e3fe824ea391aa38a",
  "original_prompt": "Ingested from linux-6.6.14/drivers/hwmon/pmbus/ir36021.c",
  "human_readable_source": "\n \n#include <linux/err.h>\n#include <linux/i2c.h>\n#include <linux/init.h>\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include \"pmbus.h\"\n\nstatic struct pmbus_driver_info ir36021_info = {\n\t.pages = 1,\n\t.format[PSC_VOLTAGE_IN] = linear,\n\t.format[PSC_VOLTAGE_OUT] = linear,\n\t.format[PSC_CURRENT_IN] = linear,\n\t.format[PSC_CURRENT_OUT] = linear,\n\t.format[PSC_POWER] = linear,\n\t.format[PSC_TEMPERATURE] = linear,\n\t.func[0] = PMBUS_HAVE_VIN | PMBUS_HAVE_VOUT\n\t\t| PMBUS_HAVE_IIN | PMBUS_HAVE_IOUT\n\t\t| PMBUS_HAVE_PIN | PMBUS_HAVE_POUT\n\t\t| PMBUS_HAVE_TEMP | PMBUS_HAVE_TEMP2\n\t\t| PMBUS_HAVE_STATUS_TEMP,\n};\n\nstatic int ir36021_probe(struct i2c_client *client)\n{\n\tu8 buf[I2C_SMBUS_BLOCK_MAX];\n\tint ret;\n\n\tif (!i2c_check_functionality(client->adapter,\n\t\t\t\t     I2C_FUNC_SMBUS_READ_BYTE_DATA\n\t\t\t\t     | I2C_FUNC_SMBUS_READ_WORD_DATA\n\t\t\t\t     | I2C_FUNC_SMBUS_READ_BLOCK_DATA))\n\t\treturn -ENODEV;\n\n\tret = i2c_smbus_read_i2c_block_data(client, PMBUS_MFR_MODEL, 2, buf);\n\tif (ret < 0) {\n\t\tdev_err(&client->dev, \"Failed to read PMBUS_MFR_MODEL\\n\");\n\t\treturn ret;\n\t}\n\tif (ret != 2 || buf[0] != 0x01 || buf[1] != 0x2d) {\n\t\tdev_err(&client->dev, \"MFR_MODEL unrecognised\\n\");\n\t\treturn -ENODEV;\n\t}\n\n\treturn pmbus_do_probe(client, &ir36021_info);\n}\n\nstatic const struct i2c_device_id ir36021_id[] = {\n\t{ \"ir36021\", 0 },\n\t{},\n};\nMODULE_DEVICE_TABLE(i2c, ir36021_id);\n\nstatic const struct of_device_id __maybe_unused ir36021_of_id[] = {\n\t{ .compatible = \"infineon,ir36021\" },\n\t{},\n};\nMODULE_DEVICE_TABLE(of, ir36021_of_id);\n\nstatic struct i2c_driver ir36021_driver = {\n\t.class = I2C_CLASS_HWMON,\n\t.driver = {\n\t\t.name = \"ir36021\",\n\t\t.of_match_table = of_match_ptr(ir36021_of_id),\n\t},\n\t.probe = ir36021_probe,\n\t.id_table = ir36021_id,\n};\n\nmodule_i2c_driver(ir36021_driver);\n\nMODULE_AUTHOR(\"Chris Packham <chris.packham@alliedtelesis.co.nz>\");\nMODULE_DESCRIPTION(\"PMBus driver for Infineon IR36021\");\nMODULE_LICENSE(\"GPL\");\nMODULE_IMPORT_NS(PMBUS);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}