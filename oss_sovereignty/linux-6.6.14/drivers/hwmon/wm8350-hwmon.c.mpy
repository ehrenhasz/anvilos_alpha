{
  "module_name": "wm8350-hwmon.c",
  "hash_id": "75b5063f48e9405b827340669ee0570dd6cad34cadb644b650255110245ff1b0",
  "original_prompt": "Ingested from linux-6.6.14/drivers/hwmon/wm8350-hwmon.c",
  "human_readable_source": "\n \n\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/err.h>\n#include <linux/platform_device.h>\n#include <linux/hwmon.h>\n#include <linux/hwmon-sysfs.h>\n\n#include <linux/mfd/wm8350/core.h>\n#include <linux/mfd/wm8350/comparator.h>\n\nstatic const char * const input_names[] = {\n\t[WM8350_AUXADC_USB]  = \"USB\",\n\t[WM8350_AUXADC_LINE] = \"Line\",\n\t[WM8350_AUXADC_BATT] = \"Battery\",\n};\n\nstatic ssize_t show_voltage(struct device *dev,\n\t\t\t    struct device_attribute *attr, char *buf)\n{\n\tstruct wm8350 *wm8350 = dev_get_drvdata(dev);\n\tint channel = to_sensor_dev_attr(attr)->index;\n\tint val;\n\n\tval = wm8350_read_auxadc(wm8350, channel, 0, 0) * WM8350_AUX_COEFF;\n\tval = DIV_ROUND_CLOSEST(val, 1000);\n\n\treturn sprintf(buf, \"%d\\n\", val);\n}\n\nstatic ssize_t show_label(struct device *dev,\n\t\t\t  struct device_attribute *attr, char *buf)\n{\n\tint channel = to_sensor_dev_attr(attr)->index;\n\n\treturn sprintf(buf, \"%s\\n\", input_names[channel]);\n}\n\n#define WM8350_NAMED_VOLTAGE(id, name) \\\n\tstatic SENSOR_DEVICE_ATTR(in##id##_input, S_IRUGO, show_voltage,\\\n\t\t\t\t  NULL, name);\t\t\\\n\tstatic SENSOR_DEVICE_ATTR(in##id##_label, S_IRUGO, show_label,\t\\\n\t\t\t\t  NULL, name)\n\nWM8350_NAMED_VOLTAGE(0, WM8350_AUXADC_USB);\nWM8350_NAMED_VOLTAGE(1, WM8350_AUXADC_BATT);\nWM8350_NAMED_VOLTAGE(2, WM8350_AUXADC_LINE);\n\nstatic struct attribute *wm8350_attrs[] = {\n\t&sensor_dev_attr_in0_input.dev_attr.attr,\n\t&sensor_dev_attr_in0_label.dev_attr.attr,\n\t&sensor_dev_attr_in1_input.dev_attr.attr,\n\t&sensor_dev_attr_in1_label.dev_attr.attr,\n\t&sensor_dev_attr_in2_input.dev_attr.attr,\n\t&sensor_dev_attr_in2_label.dev_attr.attr,\n\n\tNULL,\n};\n\nATTRIBUTE_GROUPS(wm8350);\n\nstatic int wm8350_hwmon_probe(struct platform_device *pdev)\n{\n\tstruct wm8350 *wm8350 = platform_get_drvdata(pdev);\n\tstruct device *hwmon_dev;\n\n\thwmon_dev = devm_hwmon_device_register_with_groups(&pdev->dev, \"wm8350\",\n\t\t\t\t\t\t\t   wm8350,\n\t\t\t\t\t\t\t   wm8350_groups);\n\treturn PTR_ERR_OR_ZERO(hwmon_dev);\n}\n\nstatic struct platform_driver wm8350_hwmon_driver = {\n\t.probe = wm8350_hwmon_probe,\n\t.driver = {\n\t\t.name = \"wm8350-hwmon\",\n\t},\n};\n\nmodule_platform_driver(wm8350_hwmon_driver);\n\nMODULE_AUTHOR(\"Mark Brown <broonie@opensource.wolfsonmicro.com>\");\nMODULE_DESCRIPTION(\"WM8350 Hardware Monitoring\");\nMODULE_LICENSE(\"GPL\");\nMODULE_ALIAS(\"platform:wm8350-hwmon\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}