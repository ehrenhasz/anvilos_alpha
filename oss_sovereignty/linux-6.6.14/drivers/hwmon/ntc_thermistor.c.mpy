{
  "module_name": "ntc_thermistor.c",
  "hash_id": "b6dafcd2a80659edab89ceb61977e0932bd03920ec2dbe070dbd5d60789b2517",
  "original_prompt": "Ingested from linux-6.6.14/drivers/hwmon/ntc_thermistor.c",
  "human_readable_source": "\n \n\n#include <linux/slab.h>\n#include <linux/module.h>\n#include <linux/math64.h>\n#include <linux/mod_devicetable.h>\n#include <linux/platform_device.h>\n#include <linux/property.h>\n#include <linux/err.h>\n#include <linux/fixp-arith.h>\n#include <linux/iio/consumer.h>\n#include <linux/hwmon.h>\n\nenum ntc_thermistor_type {\n\tTYPE_B57330V2103,\n\tTYPE_B57891S0103,\n\tTYPE_NCPXXWB473,\n\tTYPE_NCPXXWF104,\n\tTYPE_NCPXXWL333,\n\tTYPE_NCPXXXH103,\n};\n\nstruct ntc_compensation {\n\tint\t\ttemp_c;\n\tunsigned int\tohm;\n};\n\n \nenum {\n\tNTC_B57330V2103,\n\tNTC_B57891S0103,\n\tNTC_NCP03WB473,\n\tNTC_NCP03WF104,\n\tNTC_NCP15WB473,\n\tNTC_NCP15WL333,\n\tNTC_NCP15XH103,\n\tNTC_NCP18WB473,\n\tNTC_NCP21WB473,\n\tNTC_SSG1404001221,\n\tNTC_LAST,\n};\n\nstatic const struct platform_device_id ntc_thermistor_id[] = {\n\t[NTC_B57330V2103]     = { \"b57330v2103\",     TYPE_B57330V2103 },\n\t[NTC_B57891S0103]     = { \"b57891s0103\",     TYPE_B57891S0103 },\n\t[NTC_NCP03WB473]      = { \"ncp03wb473\",      TYPE_NCPXXWB473 },\n\t[NTC_NCP03WF104]      = { \"ncp03wf104\",      TYPE_NCPXXWF104 },\n\t[NTC_NCP15WB473]      = { \"ncp15wb473\",      TYPE_NCPXXWB473 },\n\t[NTC_NCP15WL333]      = { \"ncp15wl333\",      TYPE_NCPXXWL333 },\n\t[NTC_NCP15XH103]      = { \"ncp15xh103\",      TYPE_NCPXXXH103 },\n\t[NTC_NCP18WB473]      = { \"ncp18wb473\",      TYPE_NCPXXWB473 },\n\t[NTC_NCP21WB473]      = { \"ncp21wb473\",      TYPE_NCPXXWB473 },\n\t[NTC_SSG1404001221]   = { \"ssg1404_001221\",  TYPE_NCPXXWB473 },\n\t[NTC_LAST]            = { },\n};\n\n \nstatic const struct ntc_compensation ncpXXwb473[] = {\n\t{ .temp_c\t= -40, .ohm\t= 1747920 },\n\t{ .temp_c\t= -35, .ohm\t= 1245428 },\n\t{ .temp_c\t= -30, .ohm\t= 898485 },\n\t{ .temp_c\t= -25, .ohm\t= 655802 },\n\t{ .temp_c\t= -20, .ohm\t= 483954 },\n\t{ .temp_c\t= -15, .ohm\t= 360850 },\n\t{ .temp_c\t= -10, .ohm\t= 271697 },\n\t{ .temp_c\t= -5, .ohm\t= 206463 },\n\t{ .temp_c\t= 0, .ohm\t= 158214 },\n\t{ .temp_c\t= 5, .ohm\t= 122259 },\n\t{ .temp_c\t= 10, .ohm\t= 95227 },\n\t{ .temp_c\t= 15, .ohm\t= 74730 },\n\t{ .temp_c\t= 20, .ohm\t= 59065 },\n\t{ .temp_c\t= 25, .ohm\t= 47000 },\n\t{ .temp_c\t= 30, .ohm\t= 37643 },\n\t{ .temp_c\t= 35, .ohm\t= 30334 },\n\t{ .temp_c\t= 40, .ohm\t= 24591 },\n\t{ .temp_c\t= 45, .ohm\t= 20048 },\n\t{ .temp_c\t= 50, .ohm\t= 16433 },\n\t{ .temp_c\t= 55, .ohm\t= 13539 },\n\t{ .temp_c\t= 60, .ohm\t= 11209 },\n\t{ .temp_c\t= 65, .ohm\t= 9328 },\n\t{ .temp_c\t= 70, .ohm\t= 7798 },\n\t{ .temp_c\t= 75, .ohm\t= 6544 },\n\t{ .temp_c\t= 80, .ohm\t= 5518 },\n\t{ .temp_c\t= 85, .ohm\t= 4674 },\n\t{ .temp_c\t= 90, .ohm\t= 3972 },\n\t{ .temp_c\t= 95, .ohm\t= 3388 },\n\t{ .temp_c\t= 100, .ohm\t= 2902 },\n\t{ .temp_c\t= 105, .ohm\t= 2494 },\n\t{ .temp_c\t= 110, .ohm\t= 2150 },\n\t{ .temp_c\t= 115, .ohm\t= 1860 },\n\t{ .temp_c\t= 120, .ohm\t= 1615 },\n\t{ .temp_c\t= 125, .ohm\t= 1406 },\n};\nstatic const struct ntc_compensation ncpXXwl333[] = {\n\t{ .temp_c\t= -40, .ohm\t= 1610154 },\n\t{ .temp_c\t= -35, .ohm\t= 1130850 },\n\t{ .temp_c\t= -30, .ohm\t= 802609 },\n\t{ .temp_c\t= -25, .ohm\t= 575385 },\n\t{ .temp_c\t= -20, .ohm\t= 416464 },\n\t{ .temp_c\t= -15, .ohm\t= 304219 },\n\t{ .temp_c\t= -10, .ohm\t= 224193 },\n\t{ .temp_c\t= -5, .ohm\t= 166623 },\n\t{ .temp_c\t= 0, .ohm\t= 124850 },\n\t{ .temp_c\t= 5, .ohm\t= 94287 },\n\t{ .temp_c\t= 10, .ohm\t= 71747 },\n\t{ .temp_c\t= 15, .ohm\t= 54996 },\n\t{ .temp_c\t= 20, .ohm\t= 42455 },\n\t{ .temp_c\t= 25, .ohm\t= 33000 },\n\t{ .temp_c\t= 30, .ohm\t= 25822 },\n\t{ .temp_c\t= 35, .ohm\t= 20335 },\n\t{ .temp_c\t= 40, .ohm\t= 16115 },\n\t{ .temp_c\t= 45, .ohm\t= 12849 },\n\t{ .temp_c\t= 50, .ohm\t= 10306 },\n\t{ .temp_c\t= 55, .ohm\t= 8314 },\n\t{ .temp_c\t= 60, .ohm\t= 6746 },\n\t{ .temp_c\t= 65, .ohm\t= 5503 },\n\t{ .temp_c\t= 70, .ohm\t= 4513 },\n\t{ .temp_c\t= 75, .ohm\t= 3721 },\n\t{ .temp_c\t= 80, .ohm\t= 3084 },\n\t{ .temp_c\t= 85, .ohm\t= 2569 },\n\t{ .temp_c\t= 90, .ohm\t= 2151 },\n\t{ .temp_c\t= 95, .ohm\t= 1809 },\n\t{ .temp_c\t= 100, .ohm\t= 1529 },\n\t{ .temp_c\t= 105, .ohm\t= 1299 },\n\t{ .temp_c\t= 110, .ohm\t= 1108 },\n\t{ .temp_c\t= 115, .ohm\t= 949 },\n\t{ .temp_c\t= 120, .ohm\t= 817 },\n\t{ .temp_c\t= 125, .ohm\t= 707 },\n};\n\nstatic const struct ntc_compensation ncpXXwf104[] = {\n\t{ .temp_c\t= -40, .ohm\t= 4397119 },\n\t{ .temp_c\t= -35, .ohm\t= 3088599 },\n\t{ .temp_c\t= -30, .ohm\t= 2197225 },\n\t{ .temp_c\t= -25, .ohm\t= 1581881 },\n\t{ .temp_c\t= -20, .ohm\t= 1151037 },\n\t{ .temp_c\t= -15, .ohm\t= 846579 },\n\t{ .temp_c\t= -10, .ohm\t= 628988 },\n\t{ .temp_c\t= -5, .ohm\t= 471632 },\n\t{ .temp_c\t= 0, .ohm\t= 357012 },\n\t{ .temp_c\t= 5, .ohm\t= 272500 },\n\t{ .temp_c\t= 10, .ohm\t= 209710 },\n\t{ .temp_c\t= 15, .ohm\t= 162651 },\n\t{ .temp_c\t= 20, .ohm\t= 127080 },\n\t{ .temp_c\t= 25, .ohm\t= 100000 },\n\t{ .temp_c\t= 30, .ohm\t= 79222 },\n\t{ .temp_c\t= 35, .ohm\t= 63167 },\n\t{ .temp_c\t= 40, .ohm\t= 50677 },\n\t{ .temp_c\t= 45, .ohm\t= 40904 },\n\t{ .temp_c\t= 50, .ohm\t= 33195 },\n\t{ .temp_c\t= 55, .ohm\t= 27091 },\n\t{ .temp_c\t= 60, .ohm\t= 22224 },\n\t{ .temp_c\t= 65, .ohm\t= 18323 },\n\t{ .temp_c\t= 70, .ohm\t= 15184 },\n\t{ .temp_c\t= 75, .ohm\t= 12635 },\n\t{ .temp_c\t= 80, .ohm\t= 10566 },\n\t{ .temp_c\t= 85, .ohm\t= 8873 },\n\t{ .temp_c\t= 90, .ohm\t= 7481 },\n\t{ .temp_c\t= 95, .ohm\t= 6337 },\n\t{ .temp_c\t= 100, .ohm\t= 5384 },\n\t{ .temp_c\t= 105, .ohm\t= 4594 },\n\t{ .temp_c\t= 110, .ohm\t= 3934 },\n\t{ .temp_c\t= 115, .ohm\t= 3380 },\n\t{ .temp_c\t= 120, .ohm\t= 2916 },\n\t{ .temp_c\t= 125, .ohm\t= 2522 },\n};\n\nstatic const struct ntc_compensation ncpXXxh103[] = {\n\t{ .temp_c\t= -40, .ohm\t= 247565 },\n\t{ .temp_c\t= -35, .ohm\t= 181742 },\n\t{ .temp_c\t= -30, .ohm\t= 135128 },\n\t{ .temp_c\t= -25, .ohm\t= 101678 },\n\t{ .temp_c\t= -20, .ohm\t= 77373 },\n\t{ .temp_c\t= -15, .ohm\t= 59504 },\n\t{ .temp_c\t= -10, .ohm\t= 46222 },\n\t{ .temp_c\t= -5, .ohm\t= 36244 },\n\t{ .temp_c\t= 0, .ohm\t= 28674 },\n\t{ .temp_c\t= 5, .ohm\t= 22878 },\n\t{ .temp_c\t= 10, .ohm\t= 18399 },\n\t{ .temp_c\t= 15, .ohm\t= 14910 },\n\t{ .temp_c\t= 20, .ohm\t= 12169 },\n\t{ .temp_c\t= 25, .ohm\t= 10000 },\n\t{ .temp_c\t= 30, .ohm\t= 8271 },\n\t{ .temp_c\t= 35, .ohm\t= 6883 },\n\t{ .temp_c\t= 40, .ohm\t= 5762 },\n\t{ .temp_c\t= 45, .ohm\t= 4851 },\n\t{ .temp_c\t= 50, .ohm\t= 4105 },\n\t{ .temp_c\t= 55, .ohm\t= 3492 },\n\t{ .temp_c\t= 60, .ohm\t= 2985 },\n\t{ .temp_c\t= 65, .ohm\t= 2563 },\n\t{ .temp_c\t= 70, .ohm\t= 2211 },\n\t{ .temp_c\t= 75, .ohm\t= 1915 },\n\t{ .temp_c\t= 80, .ohm\t= 1666 },\n\t{ .temp_c\t= 85, .ohm\t= 1454 },\n\t{ .temp_c\t= 90, .ohm\t= 1275 },\n\t{ .temp_c\t= 95, .ohm\t= 1121 },\n\t{ .temp_c\t= 100, .ohm\t= 990 },\n\t{ .temp_c\t= 105, .ohm\t= 876 },\n\t{ .temp_c\t= 110, .ohm\t= 779 },\n\t{ .temp_c\t= 115, .ohm\t= 694 },\n\t{ .temp_c\t= 120, .ohm\t= 620 },\n\t{ .temp_c\t= 125, .ohm\t= 556 },\n};\n\n \nstatic const struct ntc_compensation b57330v2103[] = {\n\t{ .temp_c\t= -40, .ohm\t= 190030 },\n\t{ .temp_c\t= -35, .ohm\t= 145360 },\n\t{ .temp_c\t= -30, .ohm\t= 112060 },\n\t{ .temp_c\t= -25, .ohm\t= 87041 },\n\t{ .temp_c\t= -20, .ohm\t= 68104 },\n\t{ .temp_c\t= -15, .ohm\t= 53665 },\n\t{ .temp_c\t= -10, .ohm\t= 42576 },\n\t{ .temp_c\t= -5, .ohm\t= 34001 },\n\t{ .temp_c\t= 0, .ohm\t= 27326 },\n\t{ .temp_c\t= 5, .ohm\t= 22096 },\n\t{ .temp_c\t= 10, .ohm\t= 17973 },\n\t{ .temp_c\t= 15, .ohm\t= 14703 },\n\t{ .temp_c\t= 20, .ohm\t= 12090 },\n\t{ .temp_c\t= 25, .ohm\t= 10000 },\n\t{ .temp_c\t= 30, .ohm\t= 8311 },\n\t{ .temp_c\t= 35, .ohm\t= 6941 },\n\t{ .temp_c\t= 40, .ohm\t= 5825 },\n\t{ .temp_c\t= 45, .ohm\t= 4911 },\n\t{ .temp_c\t= 50, .ohm\t= 4158 },\n\t{ .temp_c\t= 55, .ohm\t= 3536 },\n\t{ .temp_c\t= 60, .ohm\t= 3019 },\n\t{ .temp_c\t= 65, .ohm\t= 2588 },\n\t{ .temp_c\t= 70, .ohm\t= 2227 },\n\t{ .temp_c\t= 75, .ohm\t= 1924 },\n\t{ .temp_c\t= 80, .ohm\t= 1668 },\n\t{ .temp_c\t= 85, .ohm\t= 1451 },\n\t{ .temp_c\t= 90, .ohm\t= 1266 },\n\t{ .temp_c\t= 95, .ohm\t= 1108 },\n\t{ .temp_c\t= 100, .ohm\t= 973 },\n\t{ .temp_c\t= 105, .ohm\t= 857 },\n\t{ .temp_c\t= 110, .ohm\t= 757 },\n\t{ .temp_c\t= 115, .ohm\t= 671 },\n\t{ .temp_c\t= 120, .ohm\t= 596 },\n\t{ .temp_c\t= 125, .ohm\t= 531 },\n};\n\nstatic const struct ntc_compensation b57891s0103[] = {\n\t{ .temp_c\t= -55.0, .ohm\t= 878900 },\n\t{ .temp_c\t= -50.0, .ohm\t= 617590 },\n\t{ .temp_c\t= -45.0, .ohm\t= 439340 },\n\t{ .temp_c\t= -40.0, .ohm\t= 316180 },\n\t{ .temp_c\t= -35.0, .ohm\t= 230060 },\n\t{ .temp_c\t= -30.0, .ohm\t= 169150 },\n\t{ .temp_c\t= -25.0, .ohm\t= 125550 },\n\t{ .temp_c\t= -20.0, .ohm\t= 94143 },\n\t{ .temp_c\t= -15.0, .ohm\t= 71172 },\n\t{ .temp_c\t= -10.0, .ohm\t= 54308 },\n\t{ .temp_c\t= -5.0, .ohm\t= 41505 },\n\t{ .temp_c\t= 0.0, .ohm\t= 32014 },\n\t{ .temp_c\t= 5.0, .ohm\t= 25011 },\n\t{ .temp_c\t= 10.0, .ohm\t= 19691 },\n\t{ .temp_c\t= 15.0, .ohm\t= 15618 },\n\t{ .temp_c\t= 20.0, .ohm\t= 12474 },\n\t{ .temp_c\t= 25.0, .ohm\t= 10000 },\n\t{ .temp_c\t= 30.0, .ohm\t= 8080 },\n\t{ .temp_c\t= 35.0, .ohm\t= 6569 },\n\t{ .temp_c\t= 40.0, .ohm\t= 5372 },\n\t{ .temp_c\t= 45.0, .ohm\t= 4424 },\n\t{ .temp_c\t= 50.0, .ohm\t= 3661 },\n\t{ .temp_c\t= 55.0, .ohm\t= 3039 },\n\t{ .temp_c\t= 60.0, .ohm\t= 2536 },\n\t{ .temp_c\t= 65.0, .ohm\t= 2128 },\n\t{ .temp_c\t= 70.0, .ohm\t= 1794 },\n\t{ .temp_c\t= 75.0, .ohm\t= 1518 },\n\t{ .temp_c\t= 80.0, .ohm\t= 1290 },\n\t{ .temp_c\t= 85.0, .ohm\t= 1100 },\n\t{ .temp_c\t= 90.0, .ohm\t= 942 },\n\t{ .temp_c\t= 95.0, .ohm\t= 809 },\n\t{ .temp_c\t= 100.0, .ohm\t= 697 },\n\t{ .temp_c\t= 105.0, .ohm\t= 604 },\n\t{ .temp_c\t= 110.0, .ohm\t= 525 },\n\t{ .temp_c\t= 115.0, .ohm\t= 457 },\n\t{ .temp_c\t= 120.0, .ohm\t= 400 },\n\t{ .temp_c\t= 125.0, .ohm\t= 351 },\n\t{ .temp_c\t= 130.0, .ohm\t= 308 },\n\t{ .temp_c\t= 135.0, .ohm\t= 272 },\n\t{ .temp_c\t= 140.0, .ohm\t= 240 },\n\t{ .temp_c\t= 145.0, .ohm\t= 213 },\n\t{ .temp_c\t= 150.0, .ohm\t= 189 },\n\t{ .temp_c\t= 155.0, .ohm\t= 168 },\n};\n\nstruct ntc_type {\n\tconst struct ntc_compensation *comp;\n\tint n_comp;\n};\n\n#define NTC_TYPE(ntc, compensation) \\\n[(ntc)] = { .comp = (compensation), .n_comp = ARRAY_SIZE(compensation) }\n\nstatic const struct ntc_type ntc_type[] = {\n\tNTC_TYPE(TYPE_B57330V2103, b57330v2103),\n\tNTC_TYPE(TYPE_B57891S0103, b57891s0103),\n\tNTC_TYPE(TYPE_NCPXXWB473,  ncpXXwb473),\n\tNTC_TYPE(TYPE_NCPXXWF104,  ncpXXwf104),\n\tNTC_TYPE(TYPE_NCPXXWL333,  ncpXXwl333),\n\tNTC_TYPE(TYPE_NCPXXXH103,  ncpXXxh103),\n};\n\n \nstruct ntc_data {\n\tconst struct ntc_compensation *comp;\n\tint n_comp;\n\tunsigned int pullup_uv;\n\tunsigned int pullup_ohm;\n\tunsigned int pulldown_ohm;\n\tenum { NTC_CONNECTED_POSITIVE, NTC_CONNECTED_GROUND } connect;\n\tstruct iio_channel *chan;\n};\n\nstatic int ntc_adc_iio_read(struct ntc_data *data)\n{\n\tstruct iio_channel *channel = data->chan;\n\tint uv, ret;\n\n\tret = iio_read_channel_processed_scale(channel, &uv, 1000);\n\tif (ret < 0) {\n\t\tint raw;\n\n\t\t \n\t\tret = iio_read_channel_raw(channel, &raw);\n\t\tif (ret < 0) {\n\t\t\tpr_err(\"read channel() error: %d\\n\", ret);\n\t\t\treturn ret;\n\t\t}\n\t\tret = iio_convert_raw_to_processed(channel, raw, &uv, 1000);\n\t\tif (ret < 0) {\n\t\t\t \n\t\t\tuv = (data->pullup_uv * (s64)raw) >> 12;\n\t\t}\n\t}\n\n\treturn uv;\n}\n\nstatic inline u64 div64_u64_safe(u64 dividend, u64 divisor)\n{\n\tif (divisor == 0 && dividend == 0)\n\t\treturn 0;\n\tif (divisor == 0)\n\t\treturn UINT_MAX;\n\treturn div64_u64(dividend, divisor);\n}\n\nstatic int get_ohm_of_thermistor(struct ntc_data *data, unsigned int uv)\n{\n\tu32 puv = data->pullup_uv;\n\tu64 n, puo, pdo;\n\tpuo = data->pullup_ohm;\n\tpdo = data->pulldown_ohm;\n\n\tif (uv == 0)\n\t\treturn (data->connect == NTC_CONNECTED_POSITIVE) ?\n\t\t\tINT_MAX : 0;\n\tif (uv >= puv)\n\t\treturn (data->connect == NTC_CONNECTED_POSITIVE) ?\n\t\t\t0 : INT_MAX;\n\n\tif (data->connect == NTC_CONNECTED_POSITIVE && puo == 0)\n\t\tn = div_u64(pdo * (puv - uv), uv);\n\telse if (data->connect == NTC_CONNECTED_GROUND && pdo == 0)\n\t\tn = div_u64(puo * uv, puv - uv);\n\telse if (data->connect == NTC_CONNECTED_POSITIVE)\n\t\tn = div64_u64_safe(pdo * puo * (puv - uv),\n\t\t\t\tpuo * uv - pdo * (puv - uv));\n\telse\n\t\tn = div64_u64_safe(pdo * puo * uv, pdo * (puv - uv) - puo * uv);\n\n\tif (n > INT_MAX)\n\t\tn = INT_MAX;\n\treturn n;\n}\n\nstatic void lookup_comp(struct ntc_data *data, unsigned int ohm,\n\t\t\tint *i_low, int *i_high)\n{\n\tint start, end, mid;\n\n\t \n\tif (ohm >= data->comp[0].ohm) {\n\t\t*i_low = 0;\n\t\t*i_high = 0;\n\t\treturn;\n\t}\n\tif (ohm <= data->comp[data->n_comp - 1].ohm) {\n\t\t*i_low = data->n_comp - 1;\n\t\t*i_high = data->n_comp - 1;\n\t\treturn;\n\t}\n\n\t \n\tstart = 0;\n\tend = data->n_comp;\n\twhile (start < end) {\n\t\tmid = start + (end - start) / 2;\n\t\t \n\t\tif (ohm >= data->comp[mid].ohm) {\n\t\t\tend = mid;\n\t\t} else {\n\t\t\tstart = mid + 1;\n\t\t\t \n\t\t\tif (ohm >= data->comp[start].ohm)\n\t\t\t\tend = start;\n\t\t}\n\t\t \n\t}\n\t \n\t*i_low = end;\n\tif (ohm == data->comp[end].ohm)\n\t\t*i_high = end;\n\telse\n\t\t*i_high = end - 1;\n}\n\nstatic int get_temp_mc(struct ntc_data *data, unsigned int ohm)\n{\n\tint low, high;\n\tint temp;\n\n\tlookup_comp(data, ohm, &low, &high);\n\t \n\ttemp = fixp_linear_interpolate(data->comp[low].ohm,\n\t\t\t\t       data->comp[low].temp_c * 1000,\n\t\t\t\t       data->comp[high].ohm,\n\t\t\t\t       data->comp[high].temp_c * 1000,\n\t\t\t\t       ohm);\n\treturn temp;\n}\n\nstatic int ntc_thermistor_get_ohm(struct ntc_data *data)\n{\n\tint read_uv;\n\n\tread_uv = ntc_adc_iio_read(data);\n\tif (read_uv < 0)\n\t\treturn read_uv;\n\treturn get_ohm_of_thermistor(data, read_uv);\n}\n\nstatic int ntc_read(struct device *dev, enum hwmon_sensor_types type,\n\t\t    u32 attr, int channel, long *val)\n{\n\tstruct ntc_data *data = dev_get_drvdata(dev);\n\tint ohm;\n\n\tswitch (type) {\n\tcase hwmon_temp:\n\t\tswitch (attr) {\n\t\tcase hwmon_temp_input:\n\t\t\tohm = ntc_thermistor_get_ohm(data);\n\t\t\tif (ohm < 0)\n\t\t\t\treturn ohm;\n\t\t\t*val = get_temp_mc(data, ohm);\n\t\t\treturn 0;\n\t\tcase hwmon_temp_type:\n\t\t\t*val = 4;\n\t\t\treturn 0;\n\t\tdefault:\n\t\t\tbreak;\n\t\t}\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n\treturn -EINVAL;\n}\n\nstatic umode_t ntc_is_visible(const void *data, enum hwmon_sensor_types type,\n\t\t\t      u32 attr, int channel)\n{\n\tif (type == hwmon_temp) {\n\t\tswitch (attr) {\n\t\tcase hwmon_temp_input:\n\t\tcase hwmon_temp_type:\n\t\t\treturn 0444;\n\t\tdefault:\n\t\t\tbreak;\n\t\t}\n\t}\n\treturn 0;\n}\n\nstatic const struct hwmon_channel_info * const ntc_info[] = {\n\tHWMON_CHANNEL_INFO(chip, HWMON_C_REGISTER_TZ),\n\tHWMON_CHANNEL_INFO(temp, HWMON_T_INPUT | HWMON_T_TYPE),\n\tNULL\n};\n\nstatic const struct hwmon_ops ntc_hwmon_ops = {\n\t.is_visible = ntc_is_visible,\n\t.read = ntc_read,\n};\n\nstatic const struct hwmon_chip_info ntc_chip_info = {\n\t.ops = &ntc_hwmon_ops,\n\t.info = ntc_info,\n};\n\nstatic int ntc_thermistor_parse_props(struct device *dev,\n\t\t\t\t      struct ntc_data *data)\n{\n\tstruct iio_channel *chan;\n\tenum iio_chan_type type;\n\tint ret;\n\n\tchan = devm_iio_channel_get(dev, NULL);\n\tif (IS_ERR(chan))\n\t\treturn PTR_ERR(chan);\n\n\tret = iio_get_channel_type(chan, &type);\n\tif (ret < 0)\n\t\treturn ret;\n\n\tif (type != IIO_VOLTAGE)\n\t\treturn -EINVAL;\n\n\tret = device_property_read_u32(dev, \"pullup-uv\", &data->pullup_uv);\n\tif (ret)\n\t\treturn dev_err_probe(dev,  ret, \"pullup-uv not specified\\n\");\n\n\tret = device_property_read_u32(dev, \"pullup-ohm\", &data->pullup_ohm);\n\tif (ret)\n\t\treturn dev_err_probe(dev,  ret, \"pullup-ohm not specified\\n\");\n\n\tret = device_property_read_u32(dev, \"pulldown-ohm\", &data->pulldown_ohm);\n\tif (ret)\n\t\treturn dev_err_probe(dev,  ret, \"pulldown-ohm not specified\\n\");\n\n\tif (device_property_read_bool(dev, \"connected-positive\"))\n\t\tdata->connect = NTC_CONNECTED_POSITIVE;\n\telse  \n\t\tdata->connect = NTC_CONNECTED_GROUND;\n\n\tdata->chan = chan;\n\n\treturn 0;\n}\n\nstatic int ntc_thermistor_probe(struct platform_device *pdev)\n{\n\tstruct device *dev = &pdev->dev;\n\tconst struct platform_device_id *pdev_id;\n\tstruct device *hwmon_dev;\n\tstruct ntc_data *data;\n\tint ret;\n\n\tdata = devm_kzalloc(dev, sizeof(*data), GFP_KERNEL);\n\tif (!data)\n\t\treturn -ENOMEM;\n\n\tret = ntc_thermistor_parse_props(dev, data);\n\tif (ret)\n\t\treturn ret;\n\n\tif (data->pullup_uv == 0 ||\n\t    (data->pullup_ohm == 0 && data->connect ==\n\t     NTC_CONNECTED_GROUND) ||\n\t    (data->pulldown_ohm == 0 && data->connect ==\n\t     NTC_CONNECTED_POSITIVE) ||\n\t    (data->connect != NTC_CONNECTED_POSITIVE &&\n\t     data->connect != NTC_CONNECTED_GROUND)) {\n\t\tdev_err(dev, \"Required data to use NTC driver not supplied.\\n\");\n\t\treturn -EINVAL;\n\t}\n\n\tpdev_id = device_get_match_data(dev);\n\n\tif (pdev_id->driver_data >= ARRAY_SIZE(ntc_type)) {\n\t\tdev_err(dev, \"Unknown device type: %lu(%s)\\n\",\n\t\t\t\tpdev_id->driver_data, pdev_id->name);\n\t\treturn -EINVAL;\n\t}\n\n\tdata->comp   = ntc_type[pdev_id->driver_data].comp;\n\tdata->n_comp = ntc_type[pdev_id->driver_data].n_comp;\n\n\thwmon_dev = devm_hwmon_device_register_with_info(dev, pdev_id->name,\n\t\t\t\t\t\t\t data, &ntc_chip_info,\n\t\t\t\t\t\t\t NULL);\n\tif (IS_ERR(hwmon_dev)) {\n\t\tdev_err(dev, \"unable to register as hwmon device.\\n\");\n\t\treturn PTR_ERR(hwmon_dev);\n\t}\n\n\tdev_info(dev, \"Thermistor type: %s successfully probed.\\n\",\n\t\t pdev_id->name);\n\n\treturn 0;\n}\n\nstatic const struct of_device_id ntc_match[] = {\n\t{ .compatible = \"epcos,b57330v2103\",\n\t\t.data = &ntc_thermistor_id[NTC_B57330V2103]},\n\t{ .compatible = \"epcos,b57891s0103\",\n\t\t.data = &ntc_thermistor_id[NTC_B57891S0103] },\n\t{ .compatible = \"murata,ncp03wb473\",\n\t\t.data = &ntc_thermistor_id[NTC_NCP03WB473] },\n\t{ .compatible = \"murata,ncp03wf104\",\n\t\t.data = &ntc_thermistor_id[NTC_NCP03WF104] },\n\t{ .compatible = \"murata,ncp15wb473\",\n\t\t.data = &ntc_thermistor_id[NTC_NCP15WB473] },\n\t{ .compatible = \"murata,ncp15wl333\",\n\t\t.data = &ntc_thermistor_id[NTC_NCP15WL333] },\n\t{ .compatible = \"murata,ncp15xh103\",\n\t\t.data = &ntc_thermistor_id[NTC_NCP15XH103] },\n\t{ .compatible = \"murata,ncp18wb473\",\n\t\t.data = &ntc_thermistor_id[NTC_NCP18WB473] },\n\t{ .compatible = \"murata,ncp21wb473\",\n\t\t.data = &ntc_thermistor_id[NTC_NCP21WB473] },\n\t{ .compatible = \"samsung,1404-001221\",\n\t\t.data = &ntc_thermistor_id[NTC_SSG1404001221] },\n\n\t \n\t{ .compatible = \"ntc,ncp03wb473\",\n\t\t.data = &ntc_thermistor_id[NTC_NCP03WB473] },\n\t{ .compatible = \"ntc,ncp15wb473\",\n\t\t.data = &ntc_thermistor_id[NTC_NCP15WB473] },\n\t{ .compatible = \"ntc,ncp15wl333\",\n\t\t.data = &ntc_thermistor_id[NTC_NCP15WL333] },\n\t{ .compatible = \"ntc,ncp18wb473\",\n\t\t.data = &ntc_thermistor_id[NTC_NCP18WB473] },\n\t{ .compatible = \"ntc,ncp21wb473\",\n\t\t.data = &ntc_thermistor_id[NTC_NCP21WB473] },\n\t{ },\n};\nMODULE_DEVICE_TABLE(of, ntc_match);\n\nstatic struct platform_driver ntc_thermistor_driver = {\n\t.driver = {\n\t\t.name = \"ntc-thermistor\",\n\t\t.of_match_table = ntc_match,\n\t},\n\t.probe = ntc_thermistor_probe,\n\t.id_table = ntc_thermistor_id,\n};\n\nmodule_platform_driver(ntc_thermistor_driver);\n\nMODULE_DESCRIPTION(\"NTC Thermistor Driver\");\nMODULE_AUTHOR(\"MyungJoo Ham <myungjoo.ham@samsung.com>\");\nMODULE_LICENSE(\"GPL\");\nMODULE_ALIAS(\"platform:ntc-thermistor\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}