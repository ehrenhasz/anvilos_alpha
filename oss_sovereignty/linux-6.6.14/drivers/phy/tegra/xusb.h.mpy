{
  "module_name": "xusb.h",
  "hash_id": "f408e490a77f06b8fda304a00d6b0c5c14718820d8174dc453c35b6874b6affa",
  "original_prompt": "Ingested from linux-6.6.14/drivers/phy/tegra/xusb.h",
  "human_readable_source": " \n \n\n#ifndef __PHY_TEGRA_XUSB_H\n#define __PHY_TEGRA_XUSB_H\n\n#include <linux/io.h>\n#include <linux/iopoll.h>\n#include <linux/mutex.h>\n#include <linux/workqueue.h>\n\n#include <linux/usb/ch9.h>\n#include <linux/usb/otg.h>\n#include <linux/usb/role.h>\n\n \nint tegra_xusb_padctl_legacy_probe(struct platform_device *pdev);\nint tegra_xusb_padctl_legacy_remove(struct platform_device *pdev);\n\nstruct phy;\nstruct phy_provider;\nstruct platform_device;\nstruct regulator;\n\n \nstruct tegra_xusb_lane_soc {\n\tconst char *name;\n\n\tunsigned int offset;\n\tunsigned int shift;\n\tunsigned int mask;\n\n\tconst char * const *funcs;\n\tunsigned int num_funcs;\n\n\tstruct {\n\t\tunsigned int misc_ctl2;\n\t} regs;\n};\n\nstruct tegra_xusb_lane {\n\tconst struct tegra_xusb_lane_soc *soc;\n\tstruct tegra_xusb_pad *pad;\n\tstruct device_node *np;\n\tstruct list_head list;\n\tunsigned int function;\n\tunsigned int index;\n};\n\nint tegra_xusb_lane_parse_dt(struct tegra_xusb_lane *lane,\n\t\t\t     struct device_node *np);\n\nstruct tegra_xusb_usb3_lane {\n\tstruct tegra_xusb_lane base;\n};\n\nstatic inline struct tegra_xusb_usb3_lane *\nto_usb3_lane(struct tegra_xusb_lane *lane)\n{\n\treturn container_of(lane, struct tegra_xusb_usb3_lane, base);\n}\n\nstruct tegra_xusb_usb2_lane {\n\tstruct tegra_xusb_lane base;\n\n\tu32 hs_curr_level_offset;\n\tbool powered_on;\n};\n\nstatic inline struct tegra_xusb_usb2_lane *\nto_usb2_lane(struct tegra_xusb_lane *lane)\n{\n\treturn container_of(lane, struct tegra_xusb_usb2_lane, base);\n}\n\nstruct tegra_xusb_ulpi_lane {\n\tstruct tegra_xusb_lane base;\n};\n\nstatic inline struct tegra_xusb_ulpi_lane *\nto_ulpi_lane(struct tegra_xusb_lane *lane)\n{\n\treturn container_of(lane, struct tegra_xusb_ulpi_lane, base);\n}\n\nstruct tegra_xusb_hsic_lane {\n\tstruct tegra_xusb_lane base;\n\n\tu32 strobe_trim;\n\tu32 rx_strobe_trim;\n\tu32 rx_data_trim;\n\tu32 tx_rtune_n;\n\tu32 tx_rtune_p;\n\tu32 tx_rslew_n;\n\tu32 tx_rslew_p;\n\tbool auto_term;\n};\n\nstatic inline struct tegra_xusb_hsic_lane *\nto_hsic_lane(struct tegra_xusb_lane *lane)\n{\n\treturn container_of(lane, struct tegra_xusb_hsic_lane, base);\n}\n\nstruct tegra_xusb_pcie_lane {\n\tstruct tegra_xusb_lane base;\n};\n\nstatic inline struct tegra_xusb_pcie_lane *\nto_pcie_lane(struct tegra_xusb_lane *lane)\n{\n\treturn container_of(lane, struct tegra_xusb_pcie_lane, base);\n}\n\nstruct tegra_xusb_sata_lane {\n\tstruct tegra_xusb_lane base;\n};\n\nstatic inline struct tegra_xusb_sata_lane *\nto_sata_lane(struct tegra_xusb_lane *lane)\n{\n\treturn container_of(lane, struct tegra_xusb_sata_lane, base);\n}\n\nstruct tegra_xusb_lane_ops {\n\tstruct tegra_xusb_lane *(*probe)(struct tegra_xusb_pad *pad,\n\t\t\t\t\t struct device_node *np,\n\t\t\t\t\t unsigned int index);\n\tvoid (*remove)(struct tegra_xusb_lane *lane);\n\tvoid (*iddq_enable)(struct tegra_xusb_lane *lane);\n\tvoid (*iddq_disable)(struct tegra_xusb_lane *lane);\n\tint (*enable_phy_sleepwalk)(struct tegra_xusb_lane *lane, enum usb_device_speed speed);\n\tint (*disable_phy_sleepwalk)(struct tegra_xusb_lane *lane);\n\tint (*enable_phy_wake)(struct tegra_xusb_lane *lane);\n\tint (*disable_phy_wake)(struct tegra_xusb_lane *lane);\n\tbool (*remote_wake_detected)(struct tegra_xusb_lane *lane);\n};\n\nbool tegra_xusb_lane_check(struct tegra_xusb_lane *lane, const char *function);\n\n \nstruct tegra_xusb_pad_soc;\nstruct tegra_xusb_padctl;\n\nstruct tegra_xusb_pad_ops {\n\tstruct tegra_xusb_pad *(*probe)(struct tegra_xusb_padctl *padctl,\n\t\t\t\t\tconst struct tegra_xusb_pad_soc *soc,\n\t\t\t\t\tstruct device_node *np);\n\tvoid (*remove)(struct tegra_xusb_pad *pad);\n};\n\nstruct tegra_xusb_pad_soc {\n\tconst char *name;\n\n\tconst struct tegra_xusb_lane_soc *lanes;\n\tunsigned int num_lanes;\n\n\tconst struct tegra_xusb_pad_ops *ops;\n};\n\nstruct tegra_xusb_pad {\n\tconst struct tegra_xusb_pad_soc *soc;\n\tstruct tegra_xusb_padctl *padctl;\n\tstruct phy_provider *provider;\n\tstruct phy **lanes;\n\tstruct device dev;\n\n\tconst struct tegra_xusb_lane_ops *ops;\n\n\tstruct list_head list;\n};\n\nstatic inline struct tegra_xusb_pad *to_tegra_xusb_pad(struct device *dev)\n{\n\treturn container_of(dev, struct tegra_xusb_pad, dev);\n}\n\nint tegra_xusb_pad_init(struct tegra_xusb_pad *pad,\n\t\t\tstruct tegra_xusb_padctl *padctl,\n\t\t\tstruct device_node *np);\nint tegra_xusb_pad_register(struct tegra_xusb_pad *pad,\n\t\t\t    const struct phy_ops *ops);\nvoid tegra_xusb_pad_unregister(struct tegra_xusb_pad *pad);\n\nstruct tegra_xusb_usb3_pad {\n\tstruct tegra_xusb_pad base;\n\n\tunsigned int enable;\n\tstruct mutex lock;\n};\n\nstatic inline struct tegra_xusb_usb3_pad *\nto_usb3_pad(struct tegra_xusb_pad *pad)\n{\n\treturn container_of(pad, struct tegra_xusb_usb3_pad, base);\n}\n\nstruct tegra_xusb_usb2_pad {\n\tstruct tegra_xusb_pad base;\n\n\tstruct clk *clk;\n\tunsigned int enable;\n\tstruct mutex lock;\n};\n\nstatic inline struct tegra_xusb_usb2_pad *\nto_usb2_pad(struct tegra_xusb_pad *pad)\n{\n\treturn container_of(pad, struct tegra_xusb_usb2_pad, base);\n}\n\nstruct tegra_xusb_ulpi_pad {\n\tstruct tegra_xusb_pad base;\n};\n\nstatic inline struct tegra_xusb_ulpi_pad *\nto_ulpi_pad(struct tegra_xusb_pad *pad)\n{\n\treturn container_of(pad, struct tegra_xusb_ulpi_pad, base);\n}\n\nstruct tegra_xusb_hsic_pad {\n\tstruct tegra_xusb_pad base;\n\n\tstruct regulator *supply;\n\tstruct clk *clk;\n};\n\nstatic inline struct tegra_xusb_hsic_pad *\nto_hsic_pad(struct tegra_xusb_pad *pad)\n{\n\treturn container_of(pad, struct tegra_xusb_hsic_pad, base);\n}\n\nstruct tegra_xusb_pcie_pad {\n\tstruct tegra_xusb_pad base;\n\n\tstruct reset_control *rst;\n\tstruct clk *pll;\n\n\tbool enable;\n};\n\nstatic inline struct tegra_xusb_pcie_pad *\nto_pcie_pad(struct tegra_xusb_pad *pad)\n{\n\treturn container_of(pad, struct tegra_xusb_pcie_pad, base);\n}\n\nstruct tegra_xusb_sata_pad {\n\tstruct tegra_xusb_pad base;\n\n\tstruct reset_control *rst;\n\tstruct clk *pll;\n\n\tbool enable;\n};\n\nstatic inline struct tegra_xusb_sata_pad *\nto_sata_pad(struct tegra_xusb_pad *pad)\n{\n\treturn container_of(pad, struct tegra_xusb_sata_pad, base);\n}\n\n \nstruct tegra_xusb_port_ops;\n\nstruct tegra_xusb_port {\n\tstruct tegra_xusb_padctl *padctl;\n\tstruct tegra_xusb_lane *lane;\n\tunsigned int index;\n\n\tstruct list_head list;\n\tstruct device dev;\n\n\tstruct usb_role_switch *usb_role_sw;\n\tstruct work_struct usb_phy_work;\n\tstruct usb_phy usb_phy;\n\n\tconst struct tegra_xusb_port_ops *ops;\n};\n\nstatic inline struct tegra_xusb_port *to_tegra_xusb_port(struct device *dev)\n{\n\treturn container_of(dev, struct tegra_xusb_port, dev);\n}\n\nstruct tegra_xusb_lane_map {\n\tunsigned int port;\n\tconst char *type;\n\tunsigned int index;\n\tconst char *func;\n};\n\nstruct tegra_xusb_lane *\ntegra_xusb_port_find_lane(struct tegra_xusb_port *port,\n\t\t\t  const struct tegra_xusb_lane_map *map,\n\t\t\t  const char *function);\n\nstruct tegra_xusb_port *\ntegra_xusb_find_port(struct tegra_xusb_padctl *padctl, const char *type,\n\t\t     unsigned int index);\n\nstruct tegra_xusb_usb2_port {\n\tstruct tegra_xusb_port base;\n\n\tstruct regulator *supply;\n\tenum usb_dr_mode mode;\n\tbool internal;\n\tint usb3_port_fake;\n};\n\nstatic inline struct tegra_xusb_usb2_port *\nto_usb2_port(struct tegra_xusb_port *port)\n{\n\treturn container_of(port, struct tegra_xusb_usb2_port, base);\n}\n\nstruct tegra_xusb_usb2_port *\ntegra_xusb_find_usb2_port(struct tegra_xusb_padctl *padctl,\n\t\t\t  unsigned int index);\nvoid tegra_xusb_usb2_port_release(struct tegra_xusb_port *port);\nvoid tegra_xusb_usb2_port_remove(struct tegra_xusb_port *port);\n\nstruct tegra_xusb_ulpi_port {\n\tstruct tegra_xusb_port base;\n\n\tstruct regulator *supply;\n\tbool internal;\n};\n\nstatic inline struct tegra_xusb_ulpi_port *\nto_ulpi_port(struct tegra_xusb_port *port)\n{\n\treturn container_of(port, struct tegra_xusb_ulpi_port, base);\n}\n\nvoid tegra_xusb_ulpi_port_release(struct tegra_xusb_port *port);\n\nstruct tegra_xusb_hsic_port {\n\tstruct tegra_xusb_port base;\n};\n\nstatic inline struct tegra_xusb_hsic_port *\nto_hsic_port(struct tegra_xusb_port *port)\n{\n\treturn container_of(port, struct tegra_xusb_hsic_port, base);\n}\n\nvoid tegra_xusb_hsic_port_release(struct tegra_xusb_port *port);\n\nstruct tegra_xusb_usb3_port {\n\tstruct tegra_xusb_port base;\n\tbool context_saved;\n\tunsigned int port;\n\tbool internal;\n\tbool disable_gen2;\n\n\tu32 tap1;\n\tu32 amp;\n\tu32 ctle_z;\n\tu32 ctle_g;\n};\n\nstatic inline struct tegra_xusb_usb3_port *\nto_usb3_port(struct tegra_xusb_port *port)\n{\n\treturn container_of(port, struct tegra_xusb_usb3_port, base);\n}\n\nstruct tegra_xusb_usb3_port *\ntegra_xusb_find_usb3_port(struct tegra_xusb_padctl *padctl,\n\t\t\t  unsigned int index);\nvoid tegra_xusb_usb3_port_release(struct tegra_xusb_port *port);\n\nstruct tegra_xusb_port_ops {\n\tvoid (*release)(struct tegra_xusb_port *port);\n\tvoid (*remove)(struct tegra_xusb_port *port);\n\tint (*enable)(struct tegra_xusb_port *port);\n\tvoid (*disable)(struct tegra_xusb_port *port);\n\tstruct tegra_xusb_lane *(*map)(struct tegra_xusb_port *port);\n};\n\n \nstruct tegra_xusb_padctl_soc;\n\nstruct tegra_xusb_padctl_ops {\n\tstruct tegra_xusb_padctl *\n\t\t(*probe)(struct device *dev,\n\t\t\t const struct tegra_xusb_padctl_soc *soc);\n\tvoid (*remove)(struct tegra_xusb_padctl *padctl);\n\n\tint (*suspend_noirq)(struct tegra_xusb_padctl *padctl);\n\tint (*resume_noirq)(struct tegra_xusb_padctl *padctl);\n\tint (*usb3_save_context)(struct tegra_xusb_padctl *padctl,\n\t\t\t\t unsigned int index);\n\tint (*hsic_set_idle)(struct tegra_xusb_padctl *padctl,\n\t\t\t     unsigned int index, bool idle);\n\tint (*usb3_set_lfps_detect)(struct tegra_xusb_padctl *padctl,\n\t\t\t\t    unsigned int index, bool enable);\n\tint (*vbus_override)(struct tegra_xusb_padctl *padctl, bool set);\n\tint (*utmi_port_reset)(struct phy *phy);\n\tvoid (*utmi_pad_power_on)(struct phy *phy);\n\tvoid (*utmi_pad_power_down)(struct phy *phy);\n};\n\nstruct tegra_xusb_padctl_soc {\n\tconst struct tegra_xusb_pad_soc * const *pads;\n\tunsigned int num_pads;\n\n\tstruct {\n\t\tstruct {\n\t\t\tconst struct tegra_xusb_port_ops *ops;\n\t\t\tunsigned int count;\n\t\t} usb2, ulpi, hsic, usb3;\n\t} ports;\n\n\tconst struct tegra_xusb_padctl_ops *ops;\n\n\tconst char * const *supply_names;\n\tunsigned int num_supplies;\n\tbool supports_gen2;\n\tbool need_fake_usb3_port;\n\tbool poll_trk_completed;\n\tbool trk_hw_mode;\n\tbool supports_lp_cfg_en;\n};\n\nstruct tegra_xusb_padctl {\n\tstruct device *dev;\n\tvoid __iomem *regs;\n\tstruct mutex lock;\n\tstruct reset_control *rst;\n\n\tconst struct tegra_xusb_padctl_soc *soc;\n\n\tstruct tegra_xusb_pad *pcie;\n\tstruct tegra_xusb_pad *sata;\n\tstruct tegra_xusb_pad *ulpi;\n\tstruct tegra_xusb_pad *usb2;\n\tstruct tegra_xusb_pad *hsic;\n\n\tstruct list_head ports;\n\tstruct list_head lanes;\n\tstruct list_head pads;\n\n\tunsigned int enable;\n\n\tstruct clk *clk;\n\n\tstruct regulator_bulk_data *supplies;\n};\n\nstatic inline void padctl_writel(struct tegra_xusb_padctl *padctl, u32 value,\n\t\t\t\t unsigned long offset)\n{\n\tdev_dbg(padctl->dev, \"%08lx < %08x\\n\", offset, value);\n\twritel(value, padctl->regs + offset);\n}\n\nstatic inline u32 padctl_readl(struct tegra_xusb_padctl *padctl,\n\t\t\t       unsigned long offset)\n{\n\tu32 value = readl(padctl->regs + offset);\n\tdev_dbg(padctl->dev, \"%08lx > %08x\\n\", offset, value);\n\treturn value;\n}\n\nstatic inline u32 padctl_readl_poll(struct tegra_xusb_padctl *padctl,\n\t\t\t\t    unsigned long offset, u32 val, u32 mask,\n\t\t\t\t    int us)\n{\n\tu32 regval;\n\tint err;\n\n\terr = readl_poll_timeout(padctl->regs + offset, regval,\n\t\t\t\t (regval & mask) == val, 1, us);\n\tif (err) {\n\t\tdev_err(padctl->dev, \"%08lx poll timeout > %08x\\n\", offset,\n\t\t\tregval);\n\t}\n\n\treturn err;\n}\n\nstruct tegra_xusb_lane *tegra_xusb_find_lane(struct tegra_xusb_padctl *padctl,\n\t\t\t\t\t     const char *name,\n\t\t\t\t\t     unsigned int index);\n\n#if defined(CONFIG_ARCH_TEGRA_124_SOC) || defined(CONFIG_ARCH_TEGRA_132_SOC)\nextern const struct tegra_xusb_padctl_soc tegra124_xusb_padctl_soc;\n#endif\n#if defined(CONFIG_ARCH_TEGRA_210_SOC)\nextern const struct tegra_xusb_padctl_soc tegra210_xusb_padctl_soc;\n#endif\n#if defined(CONFIG_ARCH_TEGRA_186_SOC)\nextern const struct tegra_xusb_padctl_soc tegra186_xusb_padctl_soc;\n#endif\n#if defined(CONFIG_ARCH_TEGRA_194_SOC)\nextern const struct tegra_xusb_padctl_soc tegra194_xusb_padctl_soc;\n#endif\n#if defined(CONFIG_ARCH_TEGRA_234_SOC)\nextern const struct tegra_xusb_padctl_soc tegra234_xusb_padctl_soc;\n#endif\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}