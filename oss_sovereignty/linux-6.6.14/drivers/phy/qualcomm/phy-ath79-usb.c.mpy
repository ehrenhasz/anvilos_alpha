{
  "module_name": "phy-ath79-usb.c",
  "hash_id": "3218b04d2c4ad34dec3c8d89e19e26376d1c06390b3e33e06e585ba921b7dd78",
  "original_prompt": "Ingested from linux-6.6.14/drivers/phy/qualcomm/phy-ath79-usb.c",
  "human_readable_source": "\n \n\n#include <linux/mod_devicetable.h>\n#include <linux/module.h>\n#include <linux/platform_device.h>\n#include <linux/phy/phy.h>\n#include <linux/reset.h>\n\nstruct ath79_usb_phy {\n\tstruct reset_control *reset;\n\t \n\tstruct reset_control *no_suspend_override;\n};\n\nstatic int ath79_usb_phy_power_on(struct phy *phy)\n{\n\tstruct ath79_usb_phy *priv = phy_get_drvdata(phy);\n\tint err = 0;\n\n\tif (priv->no_suspend_override) {\n\t\terr = reset_control_assert(priv->no_suspend_override);\n\t\tif (err)\n\t\t\treturn err;\n\t}\n\n\terr = reset_control_deassert(priv->reset);\n\tif (err && priv->no_suspend_override)\n\t\treset_control_deassert(priv->no_suspend_override);\n\n\treturn err;\n}\n\nstatic int ath79_usb_phy_power_off(struct phy *phy)\n{\n\tstruct ath79_usb_phy *priv = phy_get_drvdata(phy);\n\tint err = 0;\n\n\terr = reset_control_assert(priv->reset);\n\tif (err)\n\t\treturn err;\n\n\tif (priv->no_suspend_override) {\n\t\terr = reset_control_deassert(priv->no_suspend_override);\n\t\tif (err)\n\t\t\treset_control_deassert(priv->reset);\n\t}\n\n\treturn err;\n}\n\nstatic const struct phy_ops ath79_usb_phy_ops = {\n\t.power_on\t= ath79_usb_phy_power_on,\n\t.power_off\t= ath79_usb_phy_power_off,\n\t.owner\t\t= THIS_MODULE,\n};\n\nstatic int ath79_usb_phy_probe(struct platform_device *pdev)\n{\n\tstruct ath79_usb_phy *priv;\n\tstruct phy *phy;\n\n\tpriv = devm_kzalloc(&pdev->dev, sizeof(*priv), GFP_KERNEL);\n\tif (!priv)\n\t\treturn -ENOMEM;\n\n\tpriv->reset = devm_reset_control_get(&pdev->dev, \"phy\");\n\tif (IS_ERR(priv->reset))\n\t\treturn PTR_ERR(priv->reset);\n\n\tpriv->no_suspend_override = devm_reset_control_get_optional(\n\t\t&pdev->dev, \"usb-suspend-override\");\n\tif (IS_ERR(priv->no_suspend_override))\n\t\treturn PTR_ERR(priv->no_suspend_override);\n\n\tphy = devm_phy_create(&pdev->dev, NULL, &ath79_usb_phy_ops);\n\tif (IS_ERR(phy))\n\t\treturn PTR_ERR(phy);\n\n\tphy_set_drvdata(phy, priv);\n\n\treturn PTR_ERR_OR_ZERO(devm_of_phy_provider_register(\n\t\t\t\t&pdev->dev, of_phy_simple_xlate));\n}\n\nstatic const struct of_device_id ath79_usb_phy_of_match[] = {\n\t{ .compatible = \"qca,ar7100-usb-phy\" },\n\t{}\n};\nMODULE_DEVICE_TABLE(of, ath79_usb_phy_of_match);\n\nstatic struct platform_driver ath79_usb_phy_driver = {\n\t.probe\t= ath79_usb_phy_probe,\n\t.driver = {\n\t\t.of_match_table\t= ath79_usb_phy_of_match,\n\t\t.name\t\t= \"ath79-usb-phy\",\n\t}\n};\nmodule_platform_driver(ath79_usb_phy_driver);\n\nMODULE_DESCRIPTION(\"ATH79 USB PHY driver\");\nMODULE_AUTHOR(\"Alban Bedel <albeu@free.fr>\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}