{
  "module_name": "phy-qcom-sgmii-eth.c",
  "hash_id": "03a10ccc830e1d9cf9086d7590167158d94291df6a49cdfd38715605d5c71229",
  "original_prompt": "Ingested from linux-6.6.14/drivers/phy/qualcomm/phy-qcom-sgmii-eth.c",
  "human_readable_source": "\n \n\n#include <linux/clk.h>\n#include <linux/ethtool.h>\n#include <linux/module.h>\n#include <linux/of.h>\n#include <linux/phy/phy.h>\n#include <linux/platform_device.h>\n#include <linux/regmap.h>\n\n#define QSERDES_QMP_PLL\t\t\t\t\t0x0\n#define QSERDES_COM_BIN_VCOCAL_CMP_CODE1_MODE0\t\t(QSERDES_QMP_PLL + 0x1ac)\n#define QSERDES_COM_BIN_VCOCAL_CMP_CODE2_MODE0\t\t(QSERDES_QMP_PLL + 0x1b0)\n#define QSERDES_COM_BIN_VCOCAL_HSCLK_SEL\t\t(QSERDES_QMP_PLL + 0x1bc)\n#define QSERDES_COM_CORE_CLK_EN\t\t\t\t(QSERDES_QMP_PLL + 0x174)\n#define QSERDES_COM_CORECLK_DIV_MODE0\t\t\t(QSERDES_QMP_PLL + 0x168)\n#define QSERDES_COM_CP_CTRL_MODE0\t\t\t(QSERDES_QMP_PLL + 0x74)\n#define QSERDES_COM_DEC_START_MODE0\t\t\t(QSERDES_QMP_PLL + 0xbc)\n#define QSERDES_COM_DIV_FRAC_START1_MODE0\t\t(QSERDES_QMP_PLL + 0xcc)\n#define QSERDES_COM_DIV_FRAC_START2_MODE0\t\t(QSERDES_QMP_PLL + 0xd0)\n#define QSERDES_COM_DIV_FRAC_START3_MODE0\t\t(QSERDES_QMP_PLL + 0xd4)\n#define QSERDES_COM_HSCLK_HS_SWITCH_SEL\t\t\t(QSERDES_QMP_PLL + 0x15c)\n#define QSERDES_COM_HSCLK_SEL\t\t\t\t(QSERDES_QMP_PLL + 0x158)\n#define QSERDES_COM_LOCK_CMP1_MODE0\t\t\t(QSERDES_QMP_PLL + 0xac)\n#define QSERDES_COM_LOCK_CMP2_MODE0\t\t\t(QSERDES_QMP_PLL + 0xb0)\n#define QSERDES_COM_PLL_CCTRL_MODE0\t\t\t(QSERDES_QMP_PLL + 0x84)\n#define QSERDES_COM_PLL_IVCO\t\t\t\t(QSERDES_QMP_PLL + 0x58)\n#define QSERDES_COM_PLL_RCTRL_MODE0\t\t\t(QSERDES_QMP_PLL + 0x7c)\n#define QSERDES_COM_SYSCLK_EN_SEL\t\t\t(QSERDES_QMP_PLL + 0x94)\n#define QSERDES_COM_VCO_TUNE1_MODE0\t\t\t(QSERDES_QMP_PLL + 0x110)\n#define QSERDES_COM_VCO_TUNE2_MODE0\t\t\t(QSERDES_QMP_PLL + 0x114)\n#define QSERDES_COM_VCO_TUNE_INITVAL2\t\t\t(QSERDES_QMP_PLL + 0x124)\n#define QSERDES_COM_C_READY_STATUS\t\t\t(QSERDES_QMP_PLL + 0x178)\n#define QSERDES_COM_CMN_STATUS\t\t\t\t(QSERDES_QMP_PLL + 0x140)\n\n#define QSERDES_RX\t\t\t\t\t0x600\n#define QSERDES_RX_UCDR_FO_GAIN\t\t\t\t(QSERDES_RX + 0x8)\n#define QSERDES_RX_UCDR_SO_GAIN\t\t\t\t(QSERDES_RX + 0x14)\n#define QSERDES_RX_UCDR_FASTLOCK_FO_GAIN\t\t(QSERDES_RX + 0x30)\n#define QSERDES_RX_UCDR_SO_SATURATION_AND_ENABLE\t(QSERDES_RX + 0x34)\n#define QSERDES_RX_UCDR_FASTLOCK_COUNT_LOW\t\t(QSERDES_RX + 0x3c)\n#define QSERDES_RX_UCDR_FASTLOCK_COUNT_HIGH\t\t(QSERDES_RX + 0x40)\n#define QSERDES_RX_UCDR_PI_CONTROLS\t\t\t(QSERDES_RX + 0x44)\n#define QSERDES_RX_UCDR_PI_CTRL2\t\t\t(QSERDES_RX + 0x48)\n#define QSERDES_RX_RX_TERM_BW\t\t\t\t(QSERDES_RX + 0x80)\n#define QSERDES_RX_VGA_CAL_CNTRL2\t\t\t(QSERDES_RX + 0xd8)\n#define QSERDES_RX_GM_CAL\t\t\t\t(QSERDES_RX + 0xdc)\n#define QSERDES_RX_RX_EQU_ADAPTOR_CNTRL1\t\t(QSERDES_RX + 0xe8)\n#define QSERDES_RX_RX_EQU_ADAPTOR_CNTRL2\t\t(QSERDES_RX + 0xec)\n#define QSERDES_RX_RX_EQU_ADAPTOR_CNTRL3\t\t(QSERDES_RX + 0xf0)\n#define QSERDES_RX_RX_EQU_ADAPTOR_CNTRL4\t\t(QSERDES_RX + 0xf4)\n#define QSERDES_RX_RX_IDAC_TSETTLE_LOW\t\t\t(QSERDES_RX + 0xf8)\n#define QSERDES_RX_RX_IDAC_TSETTLE_HIGH\t\t\t(QSERDES_RX + 0xfc)\n#define QSERDES_RX_RX_IDAC_MEASURE_TIME\t\t\t(QSERDES_RX + 0x100)\n#define QSERDES_RX_RX_EQ_OFFSET_ADAPTOR_CNTRL1\t\t(QSERDES_RX + 0x110)\n#define QSERDES_RX_RX_OFFSET_ADAPTOR_CNTRL2\t\t(QSERDES_RX + 0x114)\n#define QSERDES_RX_SIGDET_CNTRL\t\t\t\t(QSERDES_RX + 0x11c)\n#define QSERDES_RX_SIGDET_DEGLITCH_CNTRL\t\t(QSERDES_RX + 0x124)\n#define QSERDES_RX_RX_BAND\t\t\t\t(QSERDES_RX + 0x128)\n#define QSERDES_RX_RX_MODE_00_LOW\t\t\t(QSERDES_RX + 0x15c)\n#define QSERDES_RX_RX_MODE_00_HIGH\t\t\t(QSERDES_RX + 0x160)\n#define QSERDES_RX_RX_MODE_00_HIGH2\t\t\t(QSERDES_RX + 0x164)\n#define QSERDES_RX_RX_MODE_00_HIGH3\t\t\t(QSERDES_RX + 0x168)\n#define QSERDES_RX_RX_MODE_00_HIGH4\t\t\t(QSERDES_RX + 0x16c)\n#define QSERDES_RX_RX_MODE_01_LOW\t\t\t(QSERDES_RX + 0x170)\n#define QSERDES_RX_RX_MODE_01_HIGH\t\t\t(QSERDES_RX + 0x174)\n#define QSERDES_RX_RX_MODE_01_HIGH2\t\t\t(QSERDES_RX + 0x178)\n#define QSERDES_RX_RX_MODE_01_HIGH3\t\t\t(QSERDES_RX + 0x17c)\n#define QSERDES_RX_RX_MODE_01_HIGH4\t\t\t(QSERDES_RX + 0x180)\n#define QSERDES_RX_RX_MODE_10_LOW\t\t\t(QSERDES_RX + 0x184)\n#define QSERDES_RX_RX_MODE_10_HIGH\t\t\t(QSERDES_RX + 0x188)\n#define QSERDES_RX_RX_MODE_10_HIGH2\t\t\t(QSERDES_RX + 0x18c)\n#define QSERDES_RX_RX_MODE_10_HIGH3\t\t\t(QSERDES_RX + 0x190)\n#define QSERDES_RX_RX_MODE_10_HIGH4\t\t\t(QSERDES_RX + 0x194)\n#define QSERDES_RX_DCC_CTRL1\t\t\t\t(QSERDES_RX + 0x1a8)\n\n#define QSERDES_TX\t\t\t\t\t0x400\n#define QSERDES_TX_TX_BAND\t\t\t\t(QSERDES_TX + 0x24)\n#define QSERDES_TX_SLEW_CNTL\t\t\t\t(QSERDES_TX + 0x28)\n#define QSERDES_TX_RES_CODE_LANE_OFFSET_TX\t\t(QSERDES_TX + 0x3c)\n#define QSERDES_TX_RES_CODE_LANE_OFFSET_RX\t\t(QSERDES_TX + 0x40)\n#define QSERDES_TX_LANE_MODE_1\t\t\t\t(QSERDES_TX + 0x84)\n#define QSERDES_TX_LANE_MODE_3\t\t\t\t(QSERDES_TX + 0x8c)\n#define QSERDES_TX_RCV_DETECT_LVL_2\t\t\t(QSERDES_TX + 0xa4)\n#define QSERDES_TX_TRAN_DRVR_EMP_EN\t\t\t(QSERDES_TX + 0xc0)\n\n#define QSERDES_PCS\t\t\t\t\t0xC00\n#define QSERDES_PCS_PHY_START\t\t\t\t(QSERDES_PCS + 0x0)\n#define QSERDES_PCS_POWER_DOWN_CONTROL\t\t\t(QSERDES_PCS + 0x4)\n#define QSERDES_PCS_SW_RESET\t\t\t\t(QSERDES_PCS + 0x8)\n#define QSERDES_PCS_LINE_RESET_TIME\t\t\t(QSERDES_PCS + 0xc)\n#define QSERDES_PCS_TX_LARGE_AMP_DRV_LVL\t\t(QSERDES_PCS + 0x20)\n#define QSERDES_PCS_TX_SMALL_AMP_DRV_LVL\t\t(QSERDES_PCS + 0x28)\n#define QSERDES_PCS_TX_MID_TERM_CTRL1\t\t\t(QSERDES_PCS + 0xd8)\n#define QSERDES_PCS_TX_MID_TERM_CTRL2\t\t\t(QSERDES_PCS + 0xdc)\n#define QSERDES_PCS_SGMII_MISC_CTRL8\t\t\t(QSERDES_PCS + 0x118)\n#define QSERDES_PCS_PCS_READY_STATUS\t\t\t(QSERDES_PCS + 0x94)\n\n#define QSERDES_COM_C_READY\t\t\t\tBIT(0)\n#define QSERDES_PCS_READY\t\t\t\tBIT(0)\n#define QSERDES_PCS_SGMIIPHY_READY\t\t\tBIT(7)\n#define QSERDES_COM_C_PLL_LOCKED\t\t\tBIT(1)\n\nstruct qcom_dwmac_sgmii_phy_data {\n\tstruct regmap *regmap;\n\tstruct clk *refclk;\n\tint speed;\n};\n\nstatic void qcom_dwmac_sgmii_phy_init_1g(struct regmap *regmap)\n{\n\tregmap_write(regmap, QSERDES_PCS_SW_RESET, 0x01);\n\tregmap_write(regmap, QSERDES_PCS_POWER_DOWN_CONTROL, 0x01);\n\n\tregmap_write(regmap, QSERDES_COM_PLL_IVCO, 0x0F);\n\tregmap_write(regmap, QSERDES_COM_CP_CTRL_MODE0, 0x06);\n\tregmap_write(regmap, QSERDES_COM_PLL_RCTRL_MODE0, 0x16);\n\tregmap_write(regmap, QSERDES_COM_PLL_CCTRL_MODE0, 0x36);\n\tregmap_write(regmap, QSERDES_COM_SYSCLK_EN_SEL, 0x1A);\n\tregmap_write(regmap, QSERDES_COM_LOCK_CMP1_MODE0, 0x0A);\n\tregmap_write(regmap, QSERDES_COM_LOCK_CMP2_MODE0, 0x1A);\n\tregmap_write(regmap, QSERDES_COM_DEC_START_MODE0, 0x82);\n\tregmap_write(regmap, QSERDES_COM_DIV_FRAC_START1_MODE0, 0x55);\n\tregmap_write(regmap, QSERDES_COM_DIV_FRAC_START2_MODE0, 0x55);\n\tregmap_write(regmap, QSERDES_COM_DIV_FRAC_START3_MODE0, 0x03);\n\tregmap_write(regmap, QSERDES_COM_VCO_TUNE1_MODE0, 0x24);\n\n\tregmap_write(regmap, QSERDES_COM_VCO_TUNE2_MODE0, 0x02);\n\tregmap_write(regmap, QSERDES_COM_VCO_TUNE_INITVAL2, 0x00);\n\tregmap_write(regmap, QSERDES_COM_HSCLK_SEL, 0x04);\n\tregmap_write(regmap, QSERDES_COM_HSCLK_HS_SWITCH_SEL, 0x00);\n\tregmap_write(regmap, QSERDES_COM_CORECLK_DIV_MODE0, 0x0A);\n\tregmap_write(regmap, QSERDES_COM_CORE_CLK_EN, 0x00);\n\tregmap_write(regmap, QSERDES_COM_BIN_VCOCAL_CMP_CODE1_MODE0, 0xB9);\n\tregmap_write(regmap, QSERDES_COM_BIN_VCOCAL_CMP_CODE2_MODE0, 0x1E);\n\tregmap_write(regmap, QSERDES_COM_BIN_VCOCAL_HSCLK_SEL, 0x11);\n\n\tregmap_write(regmap, QSERDES_TX_TX_BAND, 0x05);\n\tregmap_write(regmap, QSERDES_TX_SLEW_CNTL, 0x0A);\n\tregmap_write(regmap, QSERDES_TX_RES_CODE_LANE_OFFSET_TX, 0x09);\n\tregmap_write(regmap, QSERDES_TX_RES_CODE_LANE_OFFSET_RX, 0x09);\n\tregmap_write(regmap, QSERDES_TX_LANE_MODE_1, 0x05);\n\tregmap_write(regmap, QSERDES_TX_LANE_MODE_3, 0x00);\n\tregmap_write(regmap, QSERDES_TX_RCV_DETECT_LVL_2, 0x12);\n\tregmap_write(regmap, QSERDES_TX_TRAN_DRVR_EMP_EN, 0x0C);\n\n\tregmap_write(regmap, QSERDES_RX_UCDR_FO_GAIN, 0x0A);\n\tregmap_write(regmap, QSERDES_RX_UCDR_SO_GAIN, 0x06);\n\tregmap_write(regmap, QSERDES_RX_UCDR_FASTLOCK_FO_GAIN, 0x0A);\n\tregmap_write(regmap, QSERDES_RX_UCDR_SO_SATURATION_AND_ENABLE, 0x7F);\n\tregmap_write(regmap, QSERDES_RX_UCDR_FASTLOCK_COUNT_LOW, 0x00);\n\tregmap_write(regmap, QSERDES_RX_UCDR_FASTLOCK_COUNT_HIGH, 0x01);\n\tregmap_write(regmap, QSERDES_RX_UCDR_PI_CONTROLS, 0x81);\n\tregmap_write(regmap, QSERDES_RX_UCDR_PI_CTRL2, 0x80);\n\tregmap_write(regmap, QSERDES_RX_RX_TERM_BW, 0x04);\n\tregmap_write(regmap, QSERDES_RX_VGA_CAL_CNTRL2, 0x08);\n\tregmap_write(regmap, QSERDES_RX_GM_CAL, 0x0F);\n\tregmap_write(regmap, QSERDES_RX_RX_EQU_ADAPTOR_CNTRL1, 0x04);\n\tregmap_write(regmap, QSERDES_RX_RX_EQU_ADAPTOR_CNTRL2, 0x00);\n\tregmap_write(regmap, QSERDES_RX_RX_EQU_ADAPTOR_CNTRL3, 0x4A);\n\tregmap_write(regmap, QSERDES_RX_RX_EQU_ADAPTOR_CNTRL4, 0x0A);\n\tregmap_write(regmap, QSERDES_RX_RX_IDAC_TSETTLE_LOW, 0x80);\n\tregmap_write(regmap, QSERDES_RX_RX_IDAC_TSETTLE_HIGH, 0x01);\n\tregmap_write(regmap, QSERDES_RX_RX_IDAC_MEASURE_TIME, 0x20);\n\tregmap_write(regmap, QSERDES_RX_RX_EQ_OFFSET_ADAPTOR_CNTRL1, 0x17);\n\tregmap_write(regmap, QSERDES_RX_RX_OFFSET_ADAPTOR_CNTRL2, 0x00);\n\tregmap_write(regmap, QSERDES_RX_SIGDET_CNTRL, 0x0F);\n\tregmap_write(regmap, QSERDES_RX_SIGDET_DEGLITCH_CNTRL, 0x1E);\n\tregmap_write(regmap, QSERDES_RX_RX_BAND, 0x05);\n\tregmap_write(regmap, QSERDES_RX_RX_MODE_00_LOW, 0xE0);\n\tregmap_write(regmap, QSERDES_RX_RX_MODE_00_HIGH, 0xC8);\n\tregmap_write(regmap, QSERDES_RX_RX_MODE_00_HIGH2, 0xC8);\n\tregmap_write(regmap, QSERDES_RX_RX_MODE_00_HIGH3, 0x09);\n\tregmap_write(regmap, QSERDES_RX_RX_MODE_00_HIGH4, 0xB1);\n\tregmap_write(regmap, QSERDES_RX_RX_MODE_01_LOW, 0xE0);\n\tregmap_write(regmap, QSERDES_RX_RX_MODE_01_HIGH, 0xC8);\n\tregmap_write(regmap, QSERDES_RX_RX_MODE_01_HIGH2, 0xC8);\n\tregmap_write(regmap, QSERDES_RX_RX_MODE_01_HIGH3, 0x09);\n\tregmap_write(regmap, QSERDES_RX_RX_MODE_01_HIGH4, 0xB1);\n\tregmap_write(regmap, QSERDES_RX_RX_MODE_10_LOW, 0xE0);\n\tregmap_write(regmap, QSERDES_RX_RX_MODE_10_HIGH, 0xC8);\n\tregmap_write(regmap, QSERDES_RX_RX_MODE_10_HIGH2, 0xC8);\n\tregmap_write(regmap, QSERDES_RX_RX_MODE_10_HIGH3, 0x3B);\n\tregmap_write(regmap, QSERDES_RX_RX_MODE_10_HIGH4, 0xB7);\n\tregmap_write(regmap, QSERDES_RX_DCC_CTRL1, 0x0C);\n\n\tregmap_write(regmap, QSERDES_PCS_LINE_RESET_TIME, 0x0C);\n\tregmap_write(regmap, QSERDES_PCS_TX_LARGE_AMP_DRV_LVL, 0x1F);\n\tregmap_write(regmap, QSERDES_PCS_TX_SMALL_AMP_DRV_LVL, 0x03);\n\tregmap_write(regmap, QSERDES_PCS_TX_MID_TERM_CTRL1, 0x83);\n\tregmap_write(regmap, QSERDES_PCS_TX_MID_TERM_CTRL2, 0x08);\n\tregmap_write(regmap, QSERDES_PCS_SGMII_MISC_CTRL8, 0x0C);\n\tregmap_write(regmap, QSERDES_PCS_SW_RESET, 0x00);\n\n\tregmap_write(regmap, QSERDES_PCS_PHY_START, 0x01);\n}\n\nstatic void qcom_dwmac_sgmii_phy_init_2p5g(struct regmap *regmap)\n{\n\tregmap_write(regmap, QSERDES_PCS_SW_RESET, 0x01);\n\tregmap_write(regmap, QSERDES_PCS_POWER_DOWN_CONTROL, 0x01);\n\n\tregmap_write(regmap, QSERDES_COM_PLL_IVCO, 0x0F);\n\tregmap_write(regmap, QSERDES_COM_CP_CTRL_MODE0, 0x06);\n\tregmap_write(regmap, QSERDES_COM_PLL_RCTRL_MODE0, 0x16);\n\tregmap_write(regmap, QSERDES_COM_PLL_CCTRL_MODE0, 0x36);\n\tregmap_write(regmap, QSERDES_COM_SYSCLK_EN_SEL, 0x1A);\n\tregmap_write(regmap, QSERDES_COM_LOCK_CMP1_MODE0, 0x1A);\n\tregmap_write(regmap, QSERDES_COM_LOCK_CMP2_MODE0, 0x41);\n\tregmap_write(regmap, QSERDES_COM_DEC_START_MODE0, 0x7A);\n\tregmap_write(regmap, QSERDES_COM_DIV_FRAC_START1_MODE0, 0x00);\n\tregmap_write(regmap, QSERDES_COM_DIV_FRAC_START2_MODE0, 0x20);\n\tregmap_write(regmap, QSERDES_COM_DIV_FRAC_START3_MODE0, 0x01);\n\tregmap_write(regmap, QSERDES_COM_VCO_TUNE1_MODE0, 0xA1);\n\n\tregmap_write(regmap, QSERDES_COM_VCO_TUNE2_MODE0, 0x02);\n\tregmap_write(regmap, QSERDES_COM_VCO_TUNE_INITVAL2, 0x00);\n\tregmap_write(regmap, QSERDES_COM_HSCLK_SEL, 0x03);\n\tregmap_write(regmap, QSERDES_COM_HSCLK_HS_SWITCH_SEL, 0x00);\n\tregmap_write(regmap, QSERDES_COM_CORECLK_DIV_MODE0, 0x05);\n\tregmap_write(regmap, QSERDES_COM_CORE_CLK_EN, 0x00);\n\tregmap_write(regmap, QSERDES_COM_BIN_VCOCAL_CMP_CODE1_MODE0, 0xCD);\n\tregmap_write(regmap, QSERDES_COM_BIN_VCOCAL_CMP_CODE2_MODE0, 0x1C);\n\tregmap_write(regmap, QSERDES_COM_BIN_VCOCAL_HSCLK_SEL, 0x11);\n\n\tregmap_write(regmap, QSERDES_TX_TX_BAND, 0x04);\n\tregmap_write(regmap, QSERDES_TX_SLEW_CNTL, 0x0A);\n\tregmap_write(regmap, QSERDES_TX_RES_CODE_LANE_OFFSET_TX, 0x09);\n\tregmap_write(regmap, QSERDES_TX_RES_CODE_LANE_OFFSET_RX, 0x02);\n\tregmap_write(regmap, QSERDES_TX_LANE_MODE_1, 0x05);\n\tregmap_write(regmap, QSERDES_TX_LANE_MODE_3, 0x00);\n\tregmap_write(regmap, QSERDES_TX_RCV_DETECT_LVL_2, 0x12);\n\tregmap_write(regmap, QSERDES_TX_TRAN_DRVR_EMP_EN, 0x0C);\n\n\tregmap_write(regmap, QSERDES_RX_UCDR_FO_GAIN, 0x0A);\n\tregmap_write(regmap, QSERDES_RX_UCDR_SO_GAIN, 0x06);\n\tregmap_write(regmap, QSERDES_RX_UCDR_FASTLOCK_FO_GAIN, 0x0A);\n\tregmap_write(regmap, QSERDES_RX_UCDR_SO_SATURATION_AND_ENABLE, 0x7F);\n\tregmap_write(regmap, QSERDES_RX_UCDR_FASTLOCK_COUNT_LOW, 0x00);\n\tregmap_write(regmap, QSERDES_RX_UCDR_FASTLOCK_COUNT_HIGH, 0x01);\n\tregmap_write(regmap, QSERDES_RX_UCDR_PI_CONTROLS, 0x81);\n\tregmap_write(regmap, QSERDES_RX_UCDR_PI_CTRL2, 0x80);\n\tregmap_write(regmap, QSERDES_RX_RX_TERM_BW, 0x00);\n\tregmap_write(regmap, QSERDES_RX_VGA_CAL_CNTRL2, 0x08);\n\tregmap_write(regmap, QSERDES_RX_GM_CAL, 0x0F);\n\tregmap_write(regmap, QSERDES_RX_RX_EQU_ADAPTOR_CNTRL1, 0x04);\n\tregmap_write(regmap, QSERDES_RX_RX_EQU_ADAPTOR_CNTRL2, 0x00);\n\tregmap_write(regmap, QSERDES_RX_RX_EQU_ADAPTOR_CNTRL3, 0x4A);\n\tregmap_write(regmap, QSERDES_RX_RX_EQU_ADAPTOR_CNTRL4, 0x0A);\n\tregmap_write(regmap, QSERDES_RX_RX_IDAC_TSETTLE_LOW, 0x80);\n\tregmap_write(regmap, QSERDES_RX_RX_IDAC_TSETTLE_HIGH, 0x01);\n\tregmap_write(regmap, QSERDES_RX_RX_IDAC_MEASURE_TIME, 0x20);\n\tregmap_write(regmap, QSERDES_RX_RX_EQ_OFFSET_ADAPTOR_CNTRL1, 0x17);\n\tregmap_write(regmap, QSERDES_RX_RX_OFFSET_ADAPTOR_CNTRL2, 0x00);\n\tregmap_write(regmap, QSERDES_RX_SIGDET_CNTRL, 0x0F);\n\tregmap_write(regmap, QSERDES_RX_SIGDET_DEGLITCH_CNTRL, 0x1E);\n\tregmap_write(regmap, QSERDES_RX_RX_BAND, 0x18);\n\tregmap_write(regmap, QSERDES_RX_RX_MODE_00_LOW, 0x18);\n\tregmap_write(regmap, QSERDES_RX_RX_MODE_00_HIGH, 0xC8);\n\tregmap_write(regmap, QSERDES_RX_RX_MODE_00_HIGH2, 0xC8);\n\tregmap_write(regmap, QSERDES_RX_RX_MODE_00_HIGH3, 0x0C);\n\tregmap_write(regmap, QSERDES_RX_RX_MODE_00_HIGH4, 0xB8);\n\tregmap_write(regmap, QSERDES_RX_RX_MODE_01_LOW, 0xE0);\n\tregmap_write(regmap, QSERDES_RX_RX_MODE_01_HIGH, 0xC8);\n\tregmap_write(regmap, QSERDES_RX_RX_MODE_01_HIGH2, 0xC8);\n\tregmap_write(regmap, QSERDES_RX_RX_MODE_01_HIGH3, 0x09);\n\tregmap_write(regmap, QSERDES_RX_RX_MODE_01_HIGH4, 0xB1);\n\tregmap_write(regmap, QSERDES_RX_RX_MODE_10_LOW, 0xE0);\n\tregmap_write(regmap, QSERDES_RX_RX_MODE_10_HIGH, 0xC8);\n\tregmap_write(regmap, QSERDES_RX_RX_MODE_10_HIGH2, 0xC8);\n\tregmap_write(regmap, QSERDES_RX_RX_MODE_10_HIGH3, 0x3B);\n\tregmap_write(regmap, QSERDES_RX_RX_MODE_10_HIGH4, 0xB7);\n\tregmap_write(regmap, QSERDES_RX_DCC_CTRL1, 0x0C);\n\n\tregmap_write(regmap, QSERDES_PCS_LINE_RESET_TIME, 0x0C);\n\tregmap_write(regmap, QSERDES_PCS_TX_LARGE_AMP_DRV_LVL, 0x1F);\n\tregmap_write(regmap, QSERDES_PCS_TX_SMALL_AMP_DRV_LVL, 0x03);\n\tregmap_write(regmap, QSERDES_PCS_TX_MID_TERM_CTRL1, 0x83);\n\tregmap_write(regmap, QSERDES_PCS_TX_MID_TERM_CTRL2, 0x08);\n\tregmap_write(regmap, QSERDES_PCS_SGMII_MISC_CTRL8, 0x8C);\n\tregmap_write(regmap, QSERDES_PCS_SW_RESET, 0x00);\n\n\tregmap_write(regmap, QSERDES_PCS_PHY_START, 0x01);\n}\n\nstatic inline int\nqcom_dwmac_sgmii_phy_poll_status(struct regmap *regmap, unsigned int reg,\n\t\t\t\t unsigned int bit)\n{\n\tunsigned int val;\n\n\treturn regmap_read_poll_timeout(regmap, reg, val,\n\t\t\t\t\tval & bit, 1500, 750000);\n}\n\nstatic int qcom_dwmac_sgmii_phy_calibrate(struct phy *phy)\n{\n\tstruct qcom_dwmac_sgmii_phy_data *data = phy_get_drvdata(phy);\n\tstruct device *dev = phy->dev.parent;\n\n\tswitch (data->speed) {\n\tcase SPEED_10:\n\tcase SPEED_100:\n\tcase SPEED_1000:\n\t\tqcom_dwmac_sgmii_phy_init_1g(data->regmap);\n\t\tbreak;\n\tcase SPEED_2500:\n\t\tqcom_dwmac_sgmii_phy_init_2p5g(data->regmap);\n\t\tbreak;\n\t}\n\n\tif (qcom_dwmac_sgmii_phy_poll_status(data->regmap,\n\t\t\t\t\t     QSERDES_COM_C_READY_STATUS,\n\t\t\t\t\t     QSERDES_COM_C_READY)) {\n\t\tdev_err(dev, \"QSERDES_COM_C_READY_STATUS timed-out\");\n\t\treturn -ETIMEDOUT;\n\t}\n\n\tif (qcom_dwmac_sgmii_phy_poll_status(data->regmap,\n\t\t\t\t\t     QSERDES_PCS_PCS_READY_STATUS,\n\t\t\t\t\t     QSERDES_PCS_READY)) {\n\t\tdev_err(dev, \"PCS_READY timed-out\");\n\t\treturn -ETIMEDOUT;\n\t}\n\n\tif (qcom_dwmac_sgmii_phy_poll_status(data->regmap,\n\t\t\t\t\t     QSERDES_PCS_PCS_READY_STATUS,\n\t\t\t\t\t     QSERDES_PCS_SGMIIPHY_READY)) {\n\t\tdev_err(dev, \"SGMIIPHY_READY timed-out\");\n\t\treturn -ETIMEDOUT;\n\t}\n\n\tif (qcom_dwmac_sgmii_phy_poll_status(data->regmap,\n\t\t\t\t\t     QSERDES_COM_CMN_STATUS,\n\t\t\t\t\t     QSERDES_COM_C_PLL_LOCKED)) {\n\t\tdev_err(dev, \"PLL Lock Status timed-out\");\n\t\treturn -ETIMEDOUT;\n\t}\n\n\treturn 0;\n}\n\nstatic int qcom_dwmac_sgmii_phy_power_on(struct phy *phy)\n{\n\tstruct qcom_dwmac_sgmii_phy_data *data = phy_get_drvdata(phy);\n\n\treturn clk_prepare_enable(data->refclk);\n}\n\nstatic int qcom_dwmac_sgmii_phy_power_off(struct phy *phy)\n{\n\tstruct qcom_dwmac_sgmii_phy_data *data = phy_get_drvdata(phy);\n\n\tregmap_write(data->regmap, QSERDES_PCS_TX_MID_TERM_CTRL2, 0x08);\n\tregmap_write(data->regmap, QSERDES_PCS_SW_RESET, 0x01);\n\tudelay(100);\n\tregmap_write(data->regmap, QSERDES_PCS_SW_RESET, 0x00);\n\tregmap_write(data->regmap, QSERDES_PCS_PHY_START, 0x01);\n\n\tclk_disable_unprepare(data->refclk);\n\n\treturn 0;\n}\n\nstatic int qcom_dwmac_sgmii_phy_set_speed(struct phy *phy, int speed)\n{\n\tstruct qcom_dwmac_sgmii_phy_data *data = phy_get_drvdata(phy);\n\n\tif (speed != data->speed)\n\t\tdata->speed = speed;\n\n\treturn qcom_dwmac_sgmii_phy_calibrate(phy);\n}\n\nstatic const struct phy_ops qcom_dwmac_sgmii_phy_ops = {\n\t.power_on\t= qcom_dwmac_sgmii_phy_power_on,\n\t.power_off\t= qcom_dwmac_sgmii_phy_power_off,\n\t.set_speed\t= qcom_dwmac_sgmii_phy_set_speed,\n\t.calibrate\t= qcom_dwmac_sgmii_phy_calibrate,\n\t.owner\t\t= THIS_MODULE,\n};\n\nstatic const struct regmap_config qcom_dwmac_sgmii_phy_regmap_cfg = {\n\t.reg_bits\t\t= 32,\n\t.val_bits\t\t= 32,\n\t.reg_stride\t\t= 4,\n\t.use_relaxed_mmio\t= true,\n\t.disable_locking\t= true,\n};\n\nstatic int qcom_dwmac_sgmii_phy_probe(struct platform_device *pdev)\n{\n\tstruct qcom_dwmac_sgmii_phy_data *data;\n\tstruct device *dev = &pdev->dev;\n\tstruct phy_provider *provider;\n\tvoid __iomem *base;\n\tstruct phy *phy;\n\n\tdata = devm_kzalloc(dev, sizeof(*data), GFP_KERNEL);\n\tif (!data)\n\t\treturn -ENOMEM;\n\n\tdata->speed = SPEED_10;\n\n\tbase = devm_platform_ioremap_resource(pdev, 0);\n\tif (IS_ERR(base))\n\t\treturn PTR_ERR(base);\n\n\tdata->regmap = devm_regmap_init_mmio(dev, base,\n\t\t\t\t\t     &qcom_dwmac_sgmii_phy_regmap_cfg);\n\tif (IS_ERR(data->regmap))\n\t\treturn PTR_ERR(data->regmap);\n\n\tphy = devm_phy_create(dev, NULL, &qcom_dwmac_sgmii_phy_ops);\n\tif (IS_ERR(phy))\n\t\treturn PTR_ERR(phy);\n\n\tdata->refclk = devm_clk_get(dev, \"sgmi_ref\");\n\tif (IS_ERR(data->refclk))\n\t\treturn PTR_ERR(data->refclk);\n\n\tprovider = devm_of_phy_provider_register(dev, of_phy_simple_xlate);\n\tif (IS_ERR(provider))\n\t\treturn PTR_ERR(provider);\n\n\tphy_set_drvdata(phy, data);\n\n\treturn 0;\n}\n\nstatic const struct of_device_id qcom_dwmac_sgmii_phy_of_match[] = {\n\t{ .compatible = \"qcom,sa8775p-dwmac-sgmii-phy\" },\n\t{ },\n};\nMODULE_DEVICE_TABLE(of, qcom_dwmac_sgmii_phy_of_match);\n\nstatic struct platform_driver qcom_dwmac_sgmii_phy_driver = {\n\t.probe\t= qcom_dwmac_sgmii_phy_probe,\n\t.driver = {\n\t\t.name\t= \"qcom-dwmac-sgmii-phy\",\n\t\t.of_match_table\t= qcom_dwmac_sgmii_phy_of_match,\n\t}\n};\n\nmodule_platform_driver(qcom_dwmac_sgmii_phy_driver);\n\nMODULE_DESCRIPTION(\"Qualcomm DWMAC SGMII PHY driver\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}