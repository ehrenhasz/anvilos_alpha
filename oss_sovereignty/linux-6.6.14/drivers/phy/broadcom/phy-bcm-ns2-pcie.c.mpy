{
  "module_name": "phy-bcm-ns2-pcie.c",
  "hash_id": "07e5e8a5b72cbd47b3061024a8e2e6dcf9051f685db9b36253dfe56f56a0362d",
  "original_prompt": "Ingested from linux-6.6.14/drivers/phy/broadcom/phy-bcm-ns2-pcie.c",
  "human_readable_source": "\n\n\n#include <linux/device.h>\n#include <linux/module.h>\n#include <linux/of_mdio.h>\n#include <linux/mdio.h>\n#include <linux/phy.h>\n#include <linux/phy/phy.h>\n\n#define BLK_ADDR_REG_OFFSET\t0x1f\n#define PLL_AFE1_100MHZ_BLK\t0x2100\n#define PLL_CLK_AMP_OFFSET\t0x03\n#define PLL_CLK_AMP_2P05V\t0x2b18\n\nstatic int ns2_pci_phy_init(struct phy *p)\n{\n\tstruct mdio_device *mdiodev = phy_get_drvdata(p);\n\tint rc;\n\n\t \n\trc = mdiodev_write(mdiodev, BLK_ADDR_REG_OFFSET, PLL_AFE1_100MHZ_BLK);\n\tif (rc)\n\t\tgoto err;\n\n\t \n\trc = mdiodev_write(mdiodev, PLL_CLK_AMP_OFFSET, PLL_CLK_AMP_2P05V);\n\tif (rc)\n\t\tgoto err;\n\n\treturn 0;\n\nerr:\n\tdev_err(&mdiodev->dev, \"Error %d writing to phy\\n\", rc);\n\treturn rc;\n}\n\nstatic const struct phy_ops ns2_pci_phy_ops = {\n\t.init = ns2_pci_phy_init,\n\t.owner = THIS_MODULE,\n};\n\nstatic int ns2_pci_phy_probe(struct mdio_device *mdiodev)\n{\n\tstruct device *dev = &mdiodev->dev;\n\tstruct phy_provider *provider;\n\tstruct phy *phy;\n\n\tphy = devm_phy_create(dev, dev->of_node, &ns2_pci_phy_ops);\n\tif (IS_ERR(phy)) {\n\t\tdev_err(dev, \"failed to create Phy\\n\");\n\t\treturn PTR_ERR(phy);\n\t}\n\n\tphy_set_drvdata(phy, mdiodev);\n\n\tprovider = devm_of_phy_provider_register(&phy->dev,\n\t\t\t\t\t\t of_phy_simple_xlate);\n\tif (IS_ERR(provider)) {\n\t\tdev_err(dev, \"failed to register Phy provider\\n\");\n\t\treturn PTR_ERR(provider);\n\t}\n\n\tdev_info(dev, \"%s PHY registered\\n\", dev_name(dev));\n\n\treturn 0;\n}\n\nstatic const struct of_device_id ns2_pci_phy_of_match[] = {\n\t{ .compatible = \"brcm,ns2-pcie-phy\", },\n\t{   },\n};\nMODULE_DEVICE_TABLE(of, ns2_pci_phy_of_match);\n\nstatic struct mdio_driver ns2_pci_phy_driver = {\n\t.mdiodrv = {\n\t\t.driver = {\n\t\t\t.name = \"phy-bcm-ns2-pci\",\n\t\t\t.of_match_table = ns2_pci_phy_of_match,\n\t\t},\n\t},\n\t.probe = ns2_pci_phy_probe,\n};\nmdio_module_driver(ns2_pci_phy_driver);\n\nMODULE_AUTHOR(\"Broadcom\");\nMODULE_DESCRIPTION(\"Broadcom Northstar2 PCI Phy driver\");\nMODULE_LICENSE(\"GPL v2\");\nMODULE_ALIAS(\"platform:phy-bcm-ns2-pci\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}