{
  "module_name": "phy-core-mipi-dphy.c",
  "hash_id": "b64f9729d485e246b01dc19e2e0248c19152b5effb38892042d233137f9c10e6",
  "original_prompt": "Ingested from linux-6.6.14/drivers/phy/phy-core-mipi-dphy.c",
  "human_readable_source": " \n \n\n#include <linux/errno.h>\n#include <linux/export.h>\n#include <linux/kernel.h>\n#include <linux/time64.h>\n\n#include <linux/phy/phy.h>\n#include <linux/phy/phy-mipi-dphy.h>\n\n \nstatic int phy_mipi_dphy_calc_config(unsigned long pixel_clock,\n\t\t\t\t     unsigned int bpp,\n\t\t\t\t     unsigned int lanes,\n\t\t\t\t     unsigned long long hs_clk_rate,\n\t\t\t\t     struct phy_configure_opts_mipi_dphy *cfg)\n{\n\tunsigned long long ui;\n\n\tif (!cfg)\n\t\treturn -EINVAL;\n\n\tif (!hs_clk_rate) {\n\t\ths_clk_rate = pixel_clock * bpp;\n\t\tdo_div(hs_clk_rate, lanes);\n\t}\n\n\tui = ALIGN(PSEC_PER_SEC, hs_clk_rate);\n\tdo_div(ui, hs_clk_rate);\n\n\tcfg->clk_miss = 0;\n\tcfg->clk_post = 60000 + 52 * ui;\n\tcfg->clk_pre = 8;\n\tcfg->clk_prepare = 38000;\n\tcfg->clk_settle = 95000;\n\tcfg->clk_term_en = 0;\n\tcfg->clk_trail = 60000;\n\tcfg->clk_zero = 262000;\n\tcfg->d_term_en = 0;\n\tcfg->eot = 0;\n\tcfg->hs_exit = 100000;\n\tcfg->hs_prepare = 40000 + 4 * ui;\n\tcfg->hs_zero = 105000 + 6 * ui;\n\tcfg->hs_settle = 85000 + 6 * ui;\n\tcfg->hs_skip = 40000;\n\n\t \n\tcfg->hs_trail = max(4 * 8 * ui, 60000 + 4 * 4 * ui);\n\n\tcfg->init = 100;\n\tcfg->lpx = 50000;\n\tcfg->ta_get = 5 * cfg->lpx;\n\tcfg->ta_go = 4 * cfg->lpx;\n\tcfg->ta_sure = cfg->lpx;\n\tcfg->wakeup = 1000;\n\n\tcfg->hs_clk_rate = hs_clk_rate;\n\tcfg->lanes = lanes;\n\n\treturn 0;\n}\n\nint phy_mipi_dphy_get_default_config(unsigned long pixel_clock,\n\t\t\t\t     unsigned int bpp,\n\t\t\t\t     unsigned int lanes,\n\t\t\t\t     struct phy_configure_opts_mipi_dphy *cfg)\n{\n\treturn phy_mipi_dphy_calc_config(pixel_clock, bpp, lanes, 0, cfg);\n\n}\nEXPORT_SYMBOL(phy_mipi_dphy_get_default_config);\n\nint phy_mipi_dphy_get_default_config_for_hsclk(unsigned long long hs_clk_rate,\n\t\t\t\t\t       unsigned int lanes,\n\t\t\t\t\t       struct phy_configure_opts_mipi_dphy *cfg)\n{\n\tif (!hs_clk_rate)\n\t\treturn -EINVAL;\n\n\treturn phy_mipi_dphy_calc_config(0, 0, lanes, hs_clk_rate, cfg);\n\n}\nEXPORT_SYMBOL(phy_mipi_dphy_get_default_config_for_hsclk);\n\n \nint phy_mipi_dphy_config_validate(struct phy_configure_opts_mipi_dphy *cfg)\n{\n\tunsigned long long ui;\n\n\tif (!cfg)\n\t\treturn -EINVAL;\n\n\tui = ALIGN(PSEC_PER_SEC, cfg->hs_clk_rate);\n\tdo_div(ui, cfg->hs_clk_rate);\n\n\tif (cfg->clk_miss > 60000)\n\t\treturn -EINVAL;\n\n\tif (cfg->clk_post < (60000 + 52 * ui))\n\t\treturn -EINVAL;\n\n\tif (cfg->clk_pre < 8)\n\t\treturn -EINVAL;\n\n\tif (cfg->clk_prepare < 38000 || cfg->clk_prepare > 95000)\n\t\treturn -EINVAL;\n\n\tif (cfg->clk_settle < 95000 || cfg->clk_settle > 300000)\n\t\treturn -EINVAL;\n\n\tif (cfg->clk_term_en > 38000)\n\t\treturn -EINVAL;\n\n\tif (cfg->clk_trail < 60000)\n\t\treturn -EINVAL;\n\n\tif ((cfg->clk_prepare + cfg->clk_zero) < 300000)\n\t\treturn -EINVAL;\n\n\tif (cfg->d_term_en > (35000 + 4 * ui))\n\t\treturn -EINVAL;\n\n\tif (cfg->eot > (105000 + 12 * ui))\n\t\treturn -EINVAL;\n\n\tif (cfg->hs_exit < 100000)\n\t\treturn -EINVAL;\n\n\tif (cfg->hs_prepare < (40000 + 4 * ui) ||\n\t    cfg->hs_prepare > (85000 + 6 * ui))\n\t\treturn -EINVAL;\n\n\tif ((cfg->hs_prepare + cfg->hs_zero) < (145000 + 10 * ui))\n\t\treturn -EINVAL;\n\n\tif ((cfg->hs_settle < (85000 + 6 * ui)) ||\n\t    (cfg->hs_settle > (145000 + 10 * ui)))\n\t\treturn -EINVAL;\n\n\tif (cfg->hs_skip < 40000 || cfg->hs_skip > (55000 + 4 * ui))\n\t\treturn -EINVAL;\n\n\tif (cfg->hs_trail < max(8 * ui, 60000 + 4 * ui))\n\t\treturn -EINVAL;\n\n\tif (cfg->init < 100)\n\t\treturn -EINVAL;\n\n\tif (cfg->lpx < 50000)\n\t\treturn -EINVAL;\n\n\tif (cfg->ta_get != (5 * cfg->lpx))\n\t\treturn -EINVAL;\n\n\tif (cfg->ta_go != (4 * cfg->lpx))\n\t\treturn -EINVAL;\n\n\tif (cfg->ta_sure < cfg->lpx || cfg->ta_sure > (2 * cfg->lpx))\n\t\treturn -EINVAL;\n\n\tif (cfg->wakeup < 1000)\n\t\treturn -EINVAL;\n\n\treturn 0;\n}\nEXPORT_SYMBOL(phy_mipi_dphy_config_validate);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}