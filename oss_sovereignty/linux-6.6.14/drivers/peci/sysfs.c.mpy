{
  "module_name": "sysfs.c",
  "hash_id": "6006c20d07afad0fc7be5be9c0866e9cbdeff47beaf6d0fa34777ca2c847f5bc",
  "original_prompt": "Ingested from linux-6.6.14/drivers/peci/sysfs.c",
  "human_readable_source": "\n\n\n#include <linux/device.h>\n#include <linux/kernel.h>\n#include <linux/peci.h>\n\n#include \"internal.h\"\n\nstatic int rescan_controller(struct device *dev, void *data)\n{\n\tif (dev->type != &peci_controller_type)\n\t\treturn 0;\n\n\treturn peci_controller_scan_devices(to_peci_controller(dev));\n}\n\nstatic ssize_t rescan_store(const struct bus_type *bus, const char *buf, size_t count)\n{\n\tbool res;\n\tint ret;\n\n\tret = kstrtobool(buf, &res);\n\tif (ret)\n\t\treturn ret;\n\n\tif (!res)\n\t\treturn count;\n\n\tret = bus_for_each_dev(&peci_bus_type, NULL, NULL, rescan_controller);\n\tif (ret)\n\t\treturn ret;\n\n\treturn count;\n}\nstatic BUS_ATTR_WO(rescan);\n\nstatic struct attribute *peci_bus_attrs[] = {\n\t&bus_attr_rescan.attr,\n\tNULL\n};\n\nstatic const struct attribute_group peci_bus_group = {\n\t.attrs = peci_bus_attrs,\n};\n\nconst struct attribute_group *peci_bus_groups[] = {\n\t&peci_bus_group,\n\tNULL\n};\n\nstatic ssize_t remove_store(struct device *dev, struct device_attribute *attr,\n\t\t\t    const char *buf, size_t count)\n{\n\tstruct peci_device *device = to_peci_device(dev);\n\tbool res;\n\tint ret;\n\n\tret = kstrtobool(buf, &res);\n\tif (ret)\n\t\treturn ret;\n\n\tif (res && device_remove_file_self(dev, attr))\n\t\tpeci_device_destroy(device);\n\n\treturn count;\n}\nstatic DEVICE_ATTR_IGNORE_LOCKDEP(remove, 0200, NULL, remove_store);\n\nstatic struct attribute *peci_device_attrs[] = {\n\t&dev_attr_remove.attr,\n\tNULL\n};\n\nstatic const struct attribute_group peci_device_group = {\n\t.attrs = peci_device_attrs,\n};\n\nconst struct attribute_group *peci_device_groups[] = {\n\t&peci_device_group,\n\tNULL\n};\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}