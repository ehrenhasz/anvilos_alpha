{
  "module_name": "mlx5_vnet.h",
  "hash_id": "9de01602d16a1ac17bb5d89b68eb09206e4c7df5b766fa5dffcf310b1555d6d5",
  "original_prompt": "Ingested from linux-6.6.14/drivers/vdpa/mlx5/net/mlx5_vnet.h",
  "human_readable_source": " \n \n\n#ifndef __MLX5_VNET_H__\n#define __MLX5_VNET_H__\n\n#include \"mlx5_vdpa.h\"\n\n#define to_mlx5_vdpa_ndev(__mvdev)                                             \\\n\tcontainer_of(__mvdev, struct mlx5_vdpa_net, mvdev)\n#define to_mvdev(__vdev) container_of((__vdev), struct mlx5_vdpa_dev, vdev)\n\nstruct mlx5_vdpa_net_resources {\n\tu32 tisn;\n\tu32 tdn;\n\tu32 tirn;\n\tu32 rqtn;\n\tbool valid;\n\tstruct dentry *tirn_dent;\n};\n\n#define MLX5V_MACVLAN_SIZE 256\n\nstatic inline u16 key2vid(u64 key)\n{\n\treturn (u16)(key >> 48) & 0xfff;\n}\n\n#define MLX5_VDPA_IRQ_NAME_LEN 32\n\nstruct mlx5_vdpa_irq_pool_entry {\n\tstruct msi_map map;\n\tbool used;\n\tchar name[MLX5_VDPA_IRQ_NAME_LEN];\n\tvoid *dev_id;\n};\n\nstruct mlx5_vdpa_irq_pool {\n\tint num_ent;\n\tstruct mlx5_vdpa_irq_pool_entry *entries;\n};\n\nstruct mlx5_vdpa_net {\n\tstruct mlx5_vdpa_dev mvdev;\n\tstruct mlx5_vdpa_net_resources res;\n\tstruct virtio_net_config config;\n\tstruct mlx5_vdpa_virtqueue *vqs;\n\tstruct vdpa_callback *event_cbs;\n\n\t \n\tstruct rw_semaphore reslock;\n\tstruct mlx5_flow_table *rxft;\n\tstruct dentry *rx_dent;\n\tstruct dentry *rx_table_dent;\n\tbool setup;\n\tu32 cur_num_vqs;\n\tu32 rqt_size;\n\tbool nb_registered;\n\tstruct notifier_block nb;\n\tstruct vdpa_callback config_cb;\n\tstruct mlx5_vdpa_wq_ent cvq_ent;\n\tstruct hlist_head macvlan_hash[MLX5V_MACVLAN_SIZE];\n\tstruct mlx5_vdpa_irq_pool irqp;\n\tstruct dentry *debugfs;\n\n\tu32 umem_1_buffer_param_a;\n\tu32 umem_1_buffer_param_b;\n\n\tu32 umem_2_buffer_param_a;\n\tu32 umem_2_buffer_param_b;\n\n\tu32 umem_3_buffer_param_a;\n\tu32 umem_3_buffer_param_b;\n};\n\nstruct mlx5_vdpa_counter {\n\tstruct mlx5_fc *counter;\n\tstruct dentry *dent;\n\tstruct mlx5_core_dev *mdev;\n};\n\nstruct macvlan_node {\n\tstruct hlist_node hlist;\n\tstruct mlx5_flow_handle *ucast_rule;\n\tstruct mlx5_flow_handle *mcast_rule;\n\tu64 macvlan;\n\tstruct mlx5_vdpa_net *ndev;\n\tbool tagged;\n#if defined(CONFIG_MLX5_VDPA_STEERING_DEBUG)\n\tstruct dentry *dent;\n\tstruct mlx5_vdpa_counter ucast_counter;\n\tstruct mlx5_vdpa_counter mcast_counter;\n#endif\n};\n\nvoid mlx5_vdpa_add_debugfs(struct mlx5_vdpa_net *ndev);\nvoid mlx5_vdpa_remove_debugfs(struct mlx5_vdpa_net *ndev);\nvoid mlx5_vdpa_add_rx_flow_table(struct mlx5_vdpa_net *ndev);\nvoid mlx5_vdpa_remove_rx_flow_table(struct mlx5_vdpa_net *ndev);\nvoid mlx5_vdpa_add_tirn(struct mlx5_vdpa_net *ndev);\nvoid mlx5_vdpa_remove_tirn(struct mlx5_vdpa_net *ndev);\n#if defined(CONFIG_MLX5_VDPA_STEERING_DEBUG)\nvoid mlx5_vdpa_add_rx_counters(struct mlx5_vdpa_net *ndev,\n\t\t\t       struct macvlan_node *node);\nvoid mlx5_vdpa_remove_rx_counters(struct mlx5_vdpa_net *ndev,\n\t\t\t\t  struct macvlan_node *node);\n#else\nstatic inline void mlx5_vdpa_add_rx_counters(struct mlx5_vdpa_net *ndev,\n\t\t\t\t\t     struct macvlan_node *node) {}\nstatic inline void mlx5_vdpa_remove_rx_counters(struct mlx5_vdpa_net *ndev,\n\t\t\t\t\t\tstruct macvlan_node *node) {}\n#endif\n\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}