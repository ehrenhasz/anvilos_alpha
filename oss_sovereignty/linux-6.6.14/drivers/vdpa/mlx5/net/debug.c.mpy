{
  "module_name": "debug.c",
  "hash_id": "864369b00e97f4b5bbc5f8944d5378732f8cc9f77c65bacbc8fa4f440d961b7b",
  "original_prompt": "Ingested from linux-6.6.14/drivers/vdpa/mlx5/net/debug.c",
  "human_readable_source": "\n \n\n#include <linux/debugfs.h>\n#include <linux/mlx5/fs.h>\n#include \"mlx5_vnet.h\"\n\nstatic int tirn_show(struct seq_file *file, void *priv)\n{\n\tstruct mlx5_vdpa_net *ndev = file->private;\n\n\tseq_printf(file, \"0x%x\\n\", ndev->res.tirn);\n\treturn 0;\n}\n\nDEFINE_SHOW_ATTRIBUTE(tirn);\n\nvoid mlx5_vdpa_remove_tirn(struct mlx5_vdpa_net *ndev)\n{\n\tif (ndev->debugfs)\n\t\tdebugfs_remove(ndev->res.tirn_dent);\n}\n\nvoid mlx5_vdpa_add_tirn(struct mlx5_vdpa_net *ndev)\n{\n\tndev->res.tirn_dent = debugfs_create_file(\"tirn\", 0444, ndev->rx_dent,\n\t\t\t\t\t\t  ndev, &tirn_fops);\n}\n\nstatic int rx_flow_table_show(struct seq_file *file, void *priv)\n{\n\tstruct mlx5_vdpa_net *ndev = file->private;\n\n\tseq_printf(file, \"0x%x\\n\", mlx5_flow_table_id(ndev->rxft));\n\treturn 0;\n}\n\nDEFINE_SHOW_ATTRIBUTE(rx_flow_table);\n\nvoid mlx5_vdpa_remove_rx_flow_table(struct mlx5_vdpa_net *ndev)\n{\n\tif (ndev->debugfs)\n\t\tdebugfs_remove(ndev->rx_table_dent);\n}\n\nvoid mlx5_vdpa_add_rx_flow_table(struct mlx5_vdpa_net *ndev)\n{\n\tndev->rx_table_dent = debugfs_create_file(\"table_id\", 0444, ndev->rx_dent,\n\t\t\t\t\t\t  ndev, &rx_flow_table_fops);\n}\n\n#if defined(CONFIG_MLX5_VDPA_STEERING_DEBUG)\nstatic int packets_show(struct seq_file *file, void *priv)\n{\n\tstruct mlx5_vdpa_counter *counter = file->private;\n\tu64 packets;\n\tu64 bytes;\n\tint err;\n\n\terr = mlx5_fc_query(counter->mdev, counter->counter, &packets, &bytes);\n\tif (err)\n\t\treturn err;\n\n\tseq_printf(file, \"0x%llx\\n\", packets);\n\treturn 0;\n}\n\nstatic int bytes_show(struct seq_file *file, void *priv)\n{\n\tstruct mlx5_vdpa_counter *counter = file->private;\n\tu64 packets;\n\tu64 bytes;\n\tint err;\n\n\terr = mlx5_fc_query(counter->mdev, counter->counter, &packets, &bytes);\n\tif (err)\n\t\treturn err;\n\n\tseq_printf(file, \"0x%llx\\n\", bytes);\n\treturn 0;\n}\n\nDEFINE_SHOW_ATTRIBUTE(packets);\nDEFINE_SHOW_ATTRIBUTE(bytes);\n\nstatic void add_counter_node(struct mlx5_vdpa_counter *counter,\n\t\t\t     struct dentry *parent)\n{\n\tdebugfs_create_file(\"packets\", 0444, parent, counter,\n\t\t\t    &packets_fops);\n\tdebugfs_create_file(\"bytes\", 0444, parent, counter,\n\t\t\t    &bytes_fops);\n}\n\nvoid mlx5_vdpa_add_rx_counters(struct mlx5_vdpa_net *ndev,\n\t\t\t       struct macvlan_node *node)\n{\n\tstatic const char *ut = \"untagged\";\n\tchar vidstr[9];\n\tu16 vid;\n\n\tnode->ucast_counter.mdev = ndev->mvdev.mdev;\n\tnode->mcast_counter.mdev = ndev->mvdev.mdev;\n\tif (node->tagged) {\n\t\tvid = key2vid(node->macvlan);\n\t\tsnprintf(vidstr, sizeof(vidstr), \"0x%x\", vid);\n\t} else {\n\t\tstrcpy(vidstr, ut);\n\t}\n\n\tnode->dent = debugfs_create_dir(vidstr, ndev->rx_dent);\n\tif (IS_ERR(node->dent)) {\n\t\tnode->dent = NULL;\n\t\treturn;\n\t}\n\n\tnode->ucast_counter.dent = debugfs_create_dir(\"ucast\", node->dent);\n\tif (IS_ERR(node->ucast_counter.dent))\n\t\treturn;\n\n\tadd_counter_node(&node->ucast_counter, node->ucast_counter.dent);\n\n\tnode->mcast_counter.dent = debugfs_create_dir(\"mcast\", node->dent);\n\tif (IS_ERR(node->mcast_counter.dent))\n\t\treturn;\n\n\tadd_counter_node(&node->mcast_counter, node->mcast_counter.dent);\n}\n\nvoid mlx5_vdpa_remove_rx_counters(struct mlx5_vdpa_net *ndev,\n\t\t\t\t  struct macvlan_node *node)\n{\n\tif (node->dent && ndev->debugfs)\n\t\tdebugfs_remove_recursive(node->dent);\n}\n#endif\n\nvoid mlx5_vdpa_add_debugfs(struct mlx5_vdpa_net *ndev)\n{\n\tstruct mlx5_core_dev *mdev;\n\n\tmdev = ndev->mvdev.mdev;\n\tndev->debugfs = debugfs_create_dir(dev_name(&ndev->mvdev.vdev.dev),\n\t\t\t\t\t   mlx5_debugfs_get_dev_root(mdev));\n\tif (!IS_ERR(ndev->debugfs))\n\t\tndev->rx_dent = debugfs_create_dir(\"rx\", ndev->debugfs);\n}\n\nvoid mlx5_vdpa_remove_debugfs(struct mlx5_vdpa_net *ndev)\n{\n\tdebugfs_remove_recursive(ndev->debugfs);\n\tndev->debugfs = NULL;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}