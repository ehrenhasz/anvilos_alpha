{
  "module_name": "mlx5_vdpa.h",
  "hash_id": "34de0f0584b61ff58d8ba2d4b19fa2cf891d9a23972835b4e56b8f3424293569",
  "original_prompt": "Ingested from linux-6.6.14/drivers/vdpa/mlx5/core/mlx5_vdpa.h",
  "human_readable_source": " \n \n\n#ifndef __MLX5_VDPA_H__\n#define __MLX5_VDPA_H__\n\n#include <linux/etherdevice.h>\n#include <linux/vringh.h>\n#include <linux/vdpa.h>\n#include <linux/mlx5/driver.h>\n\n#define MLX5V_ETH_HARD_MTU (ETH_HLEN + VLAN_HLEN + ETH_FCS_LEN)\n\nstruct mlx5_vdpa_direct_mr {\n\tu64 start;\n\tu64 end;\n\tu32 perm;\n\tu32 mr;\n\tstruct sg_table sg_head;\n\tint log_size;\n\tint nsg;\n\tint nent;\n\tstruct list_head list;\n\tu64 offset;\n};\n\nstruct mlx5_vdpa_mr {\n\tu32 mkey;\n\n\t \n\tstruct list_head head;\n\tunsigned long num_directs;\n\tunsigned long num_klms;\n\t \n\tbool initialized;\n\n\t \n\tstruct mutex mkey_mtx;\n\tbool user_mr;\n};\n\nstruct mlx5_vdpa_resources {\n\tu32 pdn;\n\tstruct mlx5_uars_page *uar;\n\tvoid __iomem *kick_addr;\n\tu64 phys_kick_addr;\n\tu16 uid;\n\tu32 null_mkey;\n\tbool valid;\n};\n\nstruct mlx5_control_vq {\n\tstruct vhost_iotlb *iotlb;\n\t \n\tspinlock_t iommu_lock;\n\tstruct vringh vring;\n\tbool ready;\n\tu64 desc_addr;\n\tu64 device_addr;\n\tu64 driver_addr;\n\tstruct vdpa_callback event_cb;\n\tstruct vringh_kiov riov;\n\tstruct vringh_kiov wiov;\n\tunsigned short head;\n\tunsigned int received_desc;\n\tunsigned int completed_desc;\n};\n\nstruct mlx5_vdpa_wq_ent {\n\tstruct work_struct work;\n\tstruct mlx5_vdpa_dev *mvdev;\n};\n\nenum {\n\tMLX5_VDPA_DATAVQ_GROUP,\n\tMLX5_VDPA_CVQ_GROUP,\n\tMLX5_VDPA_NUMVQ_GROUPS\n};\n\nenum {\n\tMLX5_VDPA_NUM_AS = MLX5_VDPA_NUMVQ_GROUPS\n};\n\nstruct mlx5_vdpa_dev {\n\tstruct vdpa_device vdev;\n\tstruct mlx5_core_dev *mdev;\n\tstruct mlx5_vdpa_resources res;\n\n\tu64 mlx_features;\n\tu64 actual_features;\n\tu8 status;\n\tu32 max_vqs;\n\tu16 max_idx;\n\tu32 generation;\n\n\tstruct mlx5_vdpa_mr mr;\n\tstruct mlx5_control_vq cvq;\n\tstruct workqueue_struct *wq;\n\tunsigned int group2asid[MLX5_VDPA_NUMVQ_GROUPS];\n\tbool suspended;\n};\n\nint mlx5_vdpa_create_tis(struct mlx5_vdpa_dev *mvdev, void *in, u32 *tisn);\nvoid mlx5_vdpa_destroy_tis(struct mlx5_vdpa_dev *mvdev, u32 tisn);\nint mlx5_vdpa_create_rqt(struct mlx5_vdpa_dev *mvdev, void *in, int inlen, u32 *rqtn);\nint mlx5_vdpa_modify_rqt(struct mlx5_vdpa_dev *mvdev, void *in, int inlen, u32 rqtn);\nvoid mlx5_vdpa_destroy_rqt(struct mlx5_vdpa_dev *mvdev, u32 rqtn);\nint mlx5_vdpa_create_tir(struct mlx5_vdpa_dev *mvdev, void *in, u32 *tirn);\nvoid mlx5_vdpa_destroy_tir(struct mlx5_vdpa_dev *mvdev, u32 tirn);\nint mlx5_vdpa_alloc_transport_domain(struct mlx5_vdpa_dev *mvdev, u32 *tdn);\nvoid mlx5_vdpa_dealloc_transport_domain(struct mlx5_vdpa_dev *mvdev, u32 tdn);\nint mlx5_vdpa_alloc_resources(struct mlx5_vdpa_dev *mvdev);\nvoid mlx5_vdpa_free_resources(struct mlx5_vdpa_dev *mvdev);\nint mlx5_vdpa_create_mkey(struct mlx5_vdpa_dev *mvdev, u32 *mkey, u32 *in,\n\t\t\t  int inlen);\nint mlx5_vdpa_destroy_mkey(struct mlx5_vdpa_dev *mvdev, u32 mkey);\nint mlx5_vdpa_handle_set_map(struct mlx5_vdpa_dev *mvdev, struct vhost_iotlb *iotlb,\n\t\t\t     bool *change_map, unsigned int asid);\nint mlx5_vdpa_create_mr(struct mlx5_vdpa_dev *mvdev, struct vhost_iotlb *iotlb,\n\t\t\tunsigned int asid);\nvoid mlx5_vdpa_destroy_mr(struct mlx5_vdpa_dev *mvdev);\nvoid mlx5_vdpa_destroy_mr_asid(struct mlx5_vdpa_dev *mvdev, unsigned int asid);\n\n#define mlx5_vdpa_warn(__dev, format, ...)                                                         \\\n\tdev_warn((__dev)->mdev->device, \"%s:%d:(pid %d) warning: \" format, __func__, __LINE__,     \\\n\t\t current->pid, ##__VA_ARGS__)\n\n#define mlx5_vdpa_info(__dev, format, ...)                                                         \\\n\tdev_info((__dev)->mdev->device, \"%s:%d:(pid %d): \" format, __func__, __LINE__,             \\\n\t\t current->pid, ##__VA_ARGS__)\n\n#define mlx5_vdpa_dbg(__dev, format, ...)                                                          \\\n\tdev_debug((__dev)->mdev->device, \"%s:%d:(pid %d): \" format, __func__, __LINE__,            \\\n\t\t  current->pid, ##__VA_ARGS__)\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}