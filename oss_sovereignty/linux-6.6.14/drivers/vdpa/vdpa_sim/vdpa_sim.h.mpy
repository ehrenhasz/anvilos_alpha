{
  "module_name": "vdpa_sim.h",
  "hash_id": "529e81aee80241b89b735d74eab5e114bdae4bb168faae9772821aa4dab32599",
  "original_prompt": "Ingested from linux-6.6.14/drivers/vdpa/vdpa_sim/vdpa_sim.h",
  "human_readable_source": " \n \n\n#ifndef _VDPA_SIM_H\n#define _VDPA_SIM_H\n\n#include <linux/iova.h>\n#include <linux/vringh.h>\n#include <linux/vdpa.h>\n#include <linux/virtio_byteorder.h>\n#include <linux/vhost_iotlb.h>\n#include <uapi/linux/virtio_config.h>\n\n#define VDPASIM_FEATURES\t((1ULL << VIRTIO_F_ANY_LAYOUT) | \\\n\t\t\t\t (1ULL << VIRTIO_F_VERSION_1)  | \\\n\t\t\t\t (1ULL << VIRTIO_F_ACCESS_PLATFORM))\n\nstruct vdpasim;\n\nstruct vdpasim_virtqueue {\n\tstruct vringh vring;\n\tstruct vringh_kiov in_iov;\n\tstruct vringh_kiov out_iov;\n\tunsigned short head;\n\tbool ready;\n\tu64 desc_addr;\n\tu64 device_addr;\n\tu64 driver_addr;\n\tu32 num;\n\tvoid *private;\n\tirqreturn_t (*cb)(void *data);\n};\n\nstruct vdpasim_dev_attr {\n\tstruct vdpa_mgmt_dev *mgmt_dev;\n\tconst char *name;\n\tu64 supported_features;\n\tsize_t alloc_size;\n\tsize_t config_size;\n\tint nvqs;\n\tu32 id;\n\tu32 ngroups;\n\tu32 nas;\n\n\tvoid (*work_fn)(struct vdpasim *vdpasim);\n\tvoid (*get_config)(struct vdpasim *vdpasim, void *config);\n\tvoid (*set_config)(struct vdpasim *vdpasim, const void *config);\n\tint (*get_stats)(struct vdpasim *vdpasim, u16 idx,\n\t\t\t struct sk_buff *msg,\n\t\t\t struct netlink_ext_ack *extack);\n\tvoid (*free)(struct vdpasim *vdpasim);\n};\n\n \nstruct vdpasim {\n\tstruct vdpa_device vdpa;\n\tstruct vdpasim_virtqueue *vqs;\n\tstruct kthread_worker *worker;\n\tstruct kthread_work work;\n\tstruct mm_struct *mm_bound;\n\tstruct vdpasim_dev_attr dev_attr;\n\t \n\tstruct mutex mutex;\n\t \n\tvoid *config;\n\tstruct vhost_iotlb *iommu;\n\tbool *iommu_pt;\n\tu32 status;\n\tu32 generation;\n\tu64 features;\n\tu32 groups;\n\tbool running;\n\tbool pending_kick;\n\t \n\tspinlock_t iommu_lock;\n};\n\nstruct vdpasim *vdpasim_create(struct vdpasim_dev_attr *attr,\n\t\t\t       const struct vdpa_dev_set_config *config);\nvoid vdpasim_schedule_work(struct vdpasim *vdpasim);\n\n \nstatic inline bool vdpasim_is_little_endian(struct vdpasim *vdpasim)\n{\n\treturn virtio_legacy_is_little_endian() ||\n\t\t(vdpasim->features & (1ULL << VIRTIO_F_VERSION_1));\n}\n\nstatic inline u16 vdpasim16_to_cpu(struct vdpasim *vdpasim, __virtio16 val)\n{\n\treturn __virtio16_to_cpu(vdpasim_is_little_endian(vdpasim), val);\n}\n\nstatic inline __virtio16 cpu_to_vdpasim16(struct vdpasim *vdpasim, u16 val)\n{\n\treturn __cpu_to_virtio16(vdpasim_is_little_endian(vdpasim), val);\n}\n\nstatic inline u32 vdpasim32_to_cpu(struct vdpasim *vdpasim, __virtio32 val)\n{\n\treturn __virtio32_to_cpu(vdpasim_is_little_endian(vdpasim), val);\n}\n\nstatic inline __virtio32 cpu_to_vdpasim32(struct vdpasim *vdpasim, u32 val)\n{\n\treturn __cpu_to_virtio32(vdpasim_is_little_endian(vdpasim), val);\n}\n\nstatic inline u64 vdpasim64_to_cpu(struct vdpasim *vdpasim, __virtio64 val)\n{\n\treturn __virtio64_to_cpu(vdpasim_is_little_endian(vdpasim), val);\n}\n\nstatic inline __virtio64 cpu_to_vdpasim64(struct vdpasim *vdpasim, u64 val)\n{\n\treturn __cpu_to_virtio64(vdpasim_is_little_endian(vdpasim), val);\n}\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}