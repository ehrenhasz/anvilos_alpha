{
  "module_name": "tpo_tj032md01bw.c",
  "hash_id": "c2e9b42c047230152347c254a563b9c3b69f09f8e46d687861924d5ed7e4b203",
  "original_prompt": "Ingested from linux-6.6.14/drivers/video/fbdev/mmp/panel/tpo_tj032md01bw.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/moduleparam.h>\n#include <linux/kernel.h>\n#include <linux/errno.h>\n#include <linux/string.h>\n#include <linux/delay.h>\n#include <linux/platform_device.h>\n#include <linux/err.h>\n#include <linux/spi/spi.h>\n#include <video/mmp_disp.h>\n\nstatic u16 init[] = {\n\t0x0801,\n\t0x0800,\n\t0x0200,\n\t0x0304,\n\t0x040e,\n\t0x0903,\n\t0x0b18,\n\t0x0c53,\n\t0x0d01,\n\t0x0ee0,\n\t0x0f01,\n\t0x1058,\n\t0x201e,\n\t0x210a,\n\t0x220a,\n\t0x231e,\n\t0x2400,\n\t0x2532,\n\t0x2600,\n\t0x27ac,\n\t0x2904,\n\t0x2aa2,\n\t0x2b45,\n\t0x2c45,\n\t0x2d15,\n\t0x2e5a,\n\t0x2fff,\n\t0x306b,\n\t0x310d,\n\t0x3248,\n\t0x3382,\n\t0x34bd,\n\t0x35e7,\n\t0x3618,\n\t0x3794,\n\t0x3801,\n\t0x395d,\n\t0x3aae,\n\t0x3bff,\n\t0x07c9,\n};\n\nstatic u16 poweroff[] = {\n\t0x07d9,\n};\n\nstruct tpohvga_plat_data {\n\tvoid (*plat_onoff)(int status);\n\tstruct spi_device *spi;\n};\n\nstatic void tpohvga_onoff(struct mmp_panel *panel, int status)\n{\n\tstruct tpohvga_plat_data *plat = panel->plat_data;\n\tint ret;\n\n\tif (status) {\n\t\tplat->plat_onoff(1);\n\n\t\tret = spi_write(plat->spi, init, sizeof(init));\n\t\tif (ret < 0)\n\t\t\tdev_warn(panel->dev, \"init cmd failed(%d)\\n\", ret);\n\t} else {\n\t\tret = spi_write(plat->spi, poweroff, sizeof(poweroff));\n\t\tif (ret < 0)\n\t\t\tdev_warn(panel->dev, \"poweroff cmd failed(%d)\\n\", ret);\n\n\t\tplat->plat_onoff(0);\n\t}\n}\n\nstatic struct mmp_mode mmp_modes_tpohvga[] = {\n\t[0] = {\n\t\t.pixclock_freq = 10394400,\n\t\t.refresh = 60,\n\t\t.xres = 320,\n\t\t.yres = 480,\n\t\t.hsync_len = 10,\n\t\t.left_margin = 15,\n\t\t.right_margin = 10,\n\t\t.vsync_len = 2,\n\t\t.upper_margin = 4,\n\t\t.lower_margin = 2,\n\t\t.invert_pixclock = 1,\n\t\t.pix_fmt_out = PIXFMT_RGB565,\n\t},\n};\n\nstatic int tpohvga_get_modelist(struct mmp_panel *panel,\n\t\tstruct mmp_mode **modelist)\n{\n\t*modelist = mmp_modes_tpohvga;\n\treturn 1;\n}\n\nstatic struct mmp_panel panel_tpohvga = {\n\t.name = \"tpohvga\",\n\t.panel_type = PANELTYPE_ACTIVE,\n\t.get_modelist = tpohvga_get_modelist,\n\t.set_onoff = tpohvga_onoff,\n};\n\nstatic int tpohvga_probe(struct spi_device *spi)\n{\n\tstruct mmp_mach_panel_info *mi;\n\tint ret;\n\tstruct tpohvga_plat_data *plat_data;\n\n\t \n\tmi = spi->dev.platform_data;\n\tif (mi == NULL) {\n\t\tdev_err(&spi->dev, \"%s: no platform data defined\\n\", __func__);\n\t\treturn -EINVAL;\n\t}\n\n\t \n\tspi->bits_per_word = 16;\n\tret = spi_setup(spi);\n\tif (ret < 0) {\n\t\tdev_err(&spi->dev, \"spi setup failed %d\", ret);\n\t\treturn ret;\n\t}\n\n\tplat_data = kzalloc(sizeof(*plat_data), GFP_KERNEL);\n\tif (plat_data == NULL)\n\t\treturn -ENOMEM;\n\n\tplat_data->spi = spi;\n\tplat_data->plat_onoff = mi->plat_set_onoff;\n\tpanel_tpohvga.plat_data = plat_data;\n\tpanel_tpohvga.plat_path_name = mi->plat_path_name;\n\tpanel_tpohvga.dev = &spi->dev;\n\n\tmmp_register_panel(&panel_tpohvga);\n\n\treturn 0;\n}\n\nstatic struct spi_driver panel_tpohvga_driver = {\n\t.driver\t\t= {\n\t\t.name\t= \"tpo-hvga\",\n\t},\n\t.probe\t\t= tpohvga_probe,\n};\nmodule_spi_driver(panel_tpohvga_driver);\n\nMODULE_AUTHOR(\"Lisa Du<cldu@marvell.com>\");\nMODULE_DESCRIPTION(\"Panel driver for tpohvga\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}