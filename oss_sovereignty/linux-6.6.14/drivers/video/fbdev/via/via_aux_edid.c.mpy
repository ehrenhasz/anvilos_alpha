{
  "module_name": "via_aux_edid.c",
  "hash_id": "8054b3c6f5457793b1c5c610d8dfd2999420aaefbc1ab24f5e8c4239984af9a5",
  "original_prompt": "Ingested from linux-6.6.14/drivers/video/fbdev/via/via_aux_edid.c",
  "human_readable_source": "\n \n \n\n#include <linux/slab.h>\n#include <linux/fb.h>\n#include \"via_aux.h\"\n#include \"../edid.h\"\n\n\nstatic const char *name = \"EDID\";\n\n\nstatic void query_edid(struct via_aux_drv *drv)\n{\n\tstruct fb_monspecs *spec = drv->data;\n\tunsigned char edid[EDID_LENGTH];\n\tbool valid = false;\n\n\tif (spec) {\n\t\tfb_destroy_modedb(spec->modedb);\n\t} else {\n\t\tspec = kmalloc(sizeof(*spec), GFP_KERNEL);\n\t\tif (!spec)\n\t\t\treturn;\n\t}\n\n\tspec->version = spec->revision = 0;\n\tif (via_aux_read(drv, 0x00, edid, EDID_LENGTH)) {\n\t\tfb_edid_to_monspecs(edid, spec);\n\t\tvalid = spec->version || spec->revision;\n\t}\n\n\tif (!valid) {\n\t\tkfree(spec);\n\t\tspec = NULL;\n\t} else\n\t\tprintk(KERN_DEBUG \"EDID: %s %s\\n\", spec->manufacturer, spec->monitor);\n\n\tdrv->data = spec;\n}\n\nstatic const struct fb_videomode *get_preferred_mode(struct via_aux_drv *drv)\n{\n\tstruct fb_monspecs *spec = drv->data;\n\tint i;\n\n\tif (!spec || !spec->modedb || !(spec->misc & FB_MISC_1ST_DETAIL))\n\t\treturn NULL;\n\n\tfor (i = 0; i < spec->modedb_len; i++) {\n\t\tif (spec->modedb[i].flag & FB_MODE_IS_FIRST &&\n\t\t\tspec->modedb[i].flag & FB_MODE_IS_DETAILED)\n\t\t\treturn &spec->modedb[i];\n\t}\n\n\treturn NULL;\n}\n\nstatic void cleanup(struct via_aux_drv *drv)\n{\n\tstruct fb_monspecs *spec = drv->data;\n\n\tif (spec)\n\t\tfb_destroy_modedb(spec->modedb);\n}\n\nvoid via_aux_edid_probe(struct via_aux_bus *bus)\n{\n\tstruct via_aux_drv drv = {\n\t\t.bus\t=\tbus,\n\t\t.addr\t=\t0x50,\n\t\t.name\t=\tname,\n\t\t.cleanup\t=\tcleanup,\n\t\t.get_preferred_mode\t=\tget_preferred_mode};\n\n\tquery_edid(&drv);\n\n\t \n\tvia_aux_add(&drv);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}