{
  "module_name": "via_utility.c",
  "hash_id": "b3b7a4859360273589b76164f880358fa83c7868939f760291f109efa71a4ada",
  "original_prompt": "Ingested from linux-6.6.14/drivers/video/fbdev/via/via_utility.c",
  "human_readable_source": "\n \n\n#include <linux/via-core.h>\n#include \"global.h\"\n\nvoid viafb_get_device_support_state(u32 *support_state)\n{\n\t*support_state = CRT_Device;\n\n\tif (viaparinfo->chip_info->tmds_chip_info.tmds_chip_name == VT1632_TMDS)\n\t\t*support_state |= DVI_Device;\n\n\tif (viaparinfo->chip_info->lvds_chip_info.lvds_chip_name == VT1631_LVDS)\n\t\t*support_state |= LCD_Device;\n}\n\nvoid viafb_get_device_connect_state(u32 *connect_state)\n{\n\tbool mobile = false;\n\n\t*connect_state = CRT_Device;\n\n\tif (viafb_dvi_sense())\n\t\t*connect_state |= DVI_Device;\n\n\tviafb_lcd_get_mobile_state(&mobile);\n\tif (mobile)\n\t\t*connect_state |= LCD_Device;\n}\n\nbool viafb_lcd_get_support_expand_state(u32 xres, u32 yres)\n{\n\tunsigned int support_state = 0;\n\n\tswitch (viafb_lcd_panel_id) {\n\tcase LCD_PANEL_ID0_640X480:\n\t\tif ((xres < 640) && (yres < 480))\n\t\t\tsupport_state = true;\n\t\tbreak;\n\n\tcase LCD_PANEL_ID1_800X600:\n\t\tif ((xres < 800) && (yres < 600))\n\t\t\tsupport_state = true;\n\t\tbreak;\n\n\tcase LCD_PANEL_ID2_1024X768:\n\t\tif ((xres < 1024) && (yres < 768))\n\t\t\tsupport_state = true;\n\t\tbreak;\n\n\tcase LCD_PANEL_ID3_1280X768:\n\t\tif ((xres < 1280) && (yres < 768))\n\t\t\tsupport_state = true;\n\t\tbreak;\n\n\tcase LCD_PANEL_ID4_1280X1024:\n\t\tif ((xres < 1280) && (yres < 1024))\n\t\t\tsupport_state = true;\n\t\tbreak;\n\n\tcase LCD_PANEL_ID5_1400X1050:\n\t\tif ((xres < 1400) && (yres < 1050))\n\t\t\tsupport_state = true;\n\t\tbreak;\n\n\tcase LCD_PANEL_ID6_1600X1200:\n\t\tif ((xres < 1600) && (yres < 1200))\n\t\t\tsupport_state = true;\n\t\tbreak;\n\n\tcase LCD_PANEL_ID7_1366X768:\n\t\tif ((xres < 1366) && (yres < 768))\n\t\t\tsupport_state = true;\n\t\tbreak;\n\n\tcase LCD_PANEL_ID8_1024X600:\n\t\tif ((xres < 1024) && (yres < 600))\n\t\t\tsupport_state = true;\n\t\tbreak;\n\n\tcase LCD_PANEL_ID9_1280X800:\n\t\tif ((xres < 1280) && (yres < 800))\n\t\t\tsupport_state = true;\n\t\tbreak;\n\n\tcase LCD_PANEL_IDA_800X480:\n\t\tif ((xres < 800) && (yres < 480))\n\t\t\tsupport_state = true;\n\t\tbreak;\n\n\tcase LCD_PANEL_IDB_1360X768:\n\t\tif ((xres < 1360) && (yres < 768))\n\t\t\tsupport_state = true;\n\t\tbreak;\n\n\tcase LCD_PANEL_IDC_480X640:\n\t\tif ((xres < 480) && (yres < 640))\n\t\t\tsupport_state = true;\n\t\tbreak;\n\n\tdefault:\n\t\tsupport_state = false;\n\t\tbreak;\n\t}\n\n\treturn support_state;\n}\n\n \n \n \n\nvoid viafb_set_gamma_table(int bpp, unsigned int *gamma_table)\n{\n\tint i, sr1a;\n\tint active_device_amount = 0;\n\tint device_status = viafb_DeviceStatus;\n\n\tfor (i = 0; i < sizeof(viafb_DeviceStatus) * 8; i++) {\n\t\tif (device_status & 1)\n\t\t\tactive_device_amount++;\n\t\tdevice_status >>= 1;\n\t}\n\n\t \n\tif (bpp == 8)\n\t\treturn ;\n\n\t \n\tswitch (viaparinfo->chip_info->gfx_chip_name) {\n\tcase UNICHROME_CLE266:\n\tcase UNICHROME_K400:\n\t\tviafb_write_reg_mask(SR16, VIASR, 0x80, BIT7);\n\t\tbreak;\n\n\tcase UNICHROME_K800:\n\tcase UNICHROME_PM800:\n\tcase UNICHROME_CN700:\n\tcase UNICHROME_CX700:\n\tcase UNICHROME_K8M890:\n\tcase UNICHROME_P4M890:\n\tcase UNICHROME_P4M900:\n\t\tviafb_write_reg_mask(CR33, VIACR, 0x80, BIT7);\n\t\tbreak;\n\t}\n\tsr1a = (unsigned int)viafb_read_reg(VIASR, SR1A);\n\tviafb_write_reg_mask(SR1A, VIASR, 0x0, BIT0);\n\n\t \n\toutb(0, LUT_INDEX_WRITE);\n\tfor (i = 0; i < 256; i++) {\n\t\toutb(gamma_table[i] >> 16, LUT_DATA);\n\t\toutb(gamma_table[i] >> 8 & 0xFF, LUT_DATA);\n\t\toutb(gamma_table[i] & 0xFF, LUT_DATA);\n\t}\n\n\t \n\t \n\tif ((active_device_amount > 1) &&\n\t\t!((viaparinfo->chip_info->gfx_chip_name ==\n\t\tUNICHROME_CLE266) &&\n\t\t(viaparinfo->chip_info->gfx_chip_revision < 15))) {\n\t\tviafb_write_reg_mask(SR1A, VIASR, 0x01, BIT0);\n\t\tviafb_write_reg_mask(CR6A, VIACR, 0x02, BIT1);\n\n\t\t \n\t\toutb(0, LUT_INDEX_WRITE);\n\t\tfor (i = 0; i < 256; i++) {\n\t\t\toutb(gamma_table[i] >> 16, LUT_DATA);\n\t\t\toutb(gamma_table[i] >> 8 & 0xFF, LUT_DATA);\n\t\t\toutb(gamma_table[i] & 0xFF, LUT_DATA);\n\t\t}\n\t}\n\tviafb_write_reg(SR1A, VIASR, sr1a);\n}\n\nvoid viafb_get_gamma_table(unsigned int *gamma_table)\n{\n\tunsigned char color_r, color_g, color_b;\n\tunsigned char sr1a = 0;\n\tint i;\n\n\t \n\tswitch (viaparinfo->chip_info->gfx_chip_name) {\n\tcase UNICHROME_CLE266:\n\tcase UNICHROME_K400:\n\t\tviafb_write_reg_mask(SR16, VIASR, 0x80, BIT7);\n\t\tbreak;\n\n\tcase UNICHROME_K800:\n\tcase UNICHROME_PM800:\n\tcase UNICHROME_CN700:\n\tcase UNICHROME_CX700:\n\tcase UNICHROME_K8M890:\n\tcase UNICHROME_P4M890:\n\tcase UNICHROME_P4M900:\n\t\tviafb_write_reg_mask(CR33, VIACR, 0x80, BIT7);\n\t\tbreak;\n\t}\n\tsr1a = viafb_read_reg(VIASR, SR1A);\n\tviafb_write_reg_mask(SR1A, VIASR, 0x0, BIT0);\n\n\t \n\toutb(0, LUT_INDEX_READ);\n\tfor (i = 0; i < 256; i++) {\n\t\tcolor_r = inb(LUT_DATA);\n\t\tcolor_g = inb(LUT_DATA);\n\t\tcolor_b = inb(LUT_DATA);\n\t\tgamma_table[i] =\n\t\t    ((((u32) color_r) << 16) |\n\t\t     (((u16) color_g) << 8)) | color_b;\n\t}\n\tviafb_write_reg(SR1A, VIASR, sr1a);\n}\n\nvoid viafb_get_gamma_support_state(int bpp, unsigned int *support_state)\n{\n\tif (bpp == 8)\n\t\t*support_state = None_Device;\n\telse\n\t\t*support_state = CRT_Device | DVI_Device | LCD_Device;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}