{
  "module_name": "savagefb.h",
  "hash_id": "ca5c171f865cac6465745580074568c565b1c3cbf511ba4ab5ab931514fb46bc",
  "original_prompt": "Ingested from linux-6.6.14/drivers/video/fbdev/savage/savagefb.h",
  "human_readable_source": " \n\n\n#ifndef __SAVAGEFB_H__\n#define __SAVAGEFB_H__\n\n#include <linux/i2c.h>\n#include <linux/i2c-algo-bit.h>\n#include <linux/mutex.h>\n#include <video/vga.h>\n#include \"../edid.h\"\n\n#ifdef SAVAGEFB_DEBUG\n# define DBG(x)\t\tprintk (KERN_DEBUG \"savagefb: %s\\n\", (x));\n#else\n# define DBG(x)\t\tno_printk(x)\n# define SavagePrintRegs(...)\n#endif\n\n\n#define PCI_CHIP_SAVAGE4      0x8a22\n#define PCI_CHIP_SAVAGE3D     0x8a20\n#define PCI_CHIP_SAVAGE3D_MV  0x8a21\n#define PCI_CHIP_SAVAGE2000   0x9102\n#define PCI_CHIP_SAVAGE_MX_MV 0x8c10\n#define PCI_CHIP_SAVAGE_MX    0x8c11\n#define PCI_CHIP_SAVAGE_IX_MV 0x8c12\n#define PCI_CHIP_SAVAGE_IX    0x8c13\n#define PCI_CHIP_PROSAVAGE_PM 0x8a25\n#define PCI_CHIP_PROSAVAGE_KM 0x8a26\n#define PCI_CHIP_S3TWISTER_P  0x8d01\n#define PCI_CHIP_S3TWISTER_K  0x8d02\n#define PCI_CHIP_PROSAVAGE_DDR          0x8d03\n#define PCI_CHIP_PROSAVAGE_DDRK         0x8d04\n#define PCI_CHIP_SUPSAV_MX128\t\t0x8c22\n#define PCI_CHIP_SUPSAV_MX64\t\t0x8c24\n#define PCI_CHIP_SUPSAV_MX64C\t\t0x8c26\n#define PCI_CHIP_SUPSAV_IX128SDR\t0x8c2a\n#define PCI_CHIP_SUPSAV_IX128DDR\t0x8c2b\n#define PCI_CHIP_SUPSAV_IX64SDR\t\t0x8c2c\n#define PCI_CHIP_SUPSAV_IX64DDR\t\t0x8c2d\n#define PCI_CHIP_SUPSAV_IXCSDR\t\t0x8c2e\n#define PCI_CHIP_SUPSAV_IXCDDR\t\t0x8c2f\n\n\n#define S3_SAVAGE_SERIES(chip)    ((chip>=S3_SAVAGE3D) && (chip<=S3_SAVAGE2000))\n\n#define S3_SAVAGE3D_SERIES(chip)  ((chip>=S3_SAVAGE3D) && (chip<=S3_SAVAGE_MX))\n\n#define S3_SAVAGE4_SERIES(chip)   ((chip>=S3_SAVAGE4) && (chip<=S3_PROSAVAGEDDR))\n\n#define S3_SAVAGE_MOBILE_SERIES(chip)  ((chip==S3_SAVAGE_MX) || (chip==S3_SUPERSAVAGE))\n\n#define S3_MOBILE_TWISTER_SERIES(chip) ((chip==S3_TWISTER) || (chip==S3_PROSAVAGEDDR))\n\n \n\ntypedef enum {\n  S3_UNKNOWN = 0,\n  S3_SAVAGE3D,\n  S3_SAVAGE_MX,\n  S3_SAVAGE4,\n  S3_PROSAVAGE,\n  S3_TWISTER,\n  S3_PROSAVAGEDDR,\n  S3_SUPERSAVAGE,\n  S3_SAVAGE2000,\n  S3_LAST\n} savage_chipset;\n\n#define BIOS_BSIZE\t\t     1024\n#define BIOS_BASE\t\t     0xc0000\n\n#define SAVAGE_NEWMMIO_REGBASE_S3    0x1000000   \n#define SAVAGE_NEWMMIO_REGBASE_S4    0x0000000\n#define SAVAGE_NEWMMIO_REGSIZE\t     0x0080000   \n#define SAVAGE_NEWMMIO_VGABASE\t     0x8000\n\n#define BASE_FREQ\t\t     14318\n#define HALF_BASE_FREQ               7159\n\n#define FIFO_CONTROL_REG\t     0x8200\n#define MIU_CONTROL_REG\t\t     0x8204\n#define STREAMS_TIMEOUT_REG\t     0x8208\n#define MISC_TIMEOUT_REG\t     0x820c\n\n#define MONO_PAT_0                   0xa4e8\n#define MONO_PAT_1                   0xa4ec\n\n#define MAXFIFO                      0x7f00\n\n#define BCI_CMD_NOP                  0x40000000\n#define BCI_CMD_SETREG               0x96000000\n#define BCI_CMD_RECT                 0x48000000\n#define BCI_CMD_RECT_XP              0x01000000\n#define BCI_CMD_RECT_YP              0x02000000\n#define BCI_CMD_SEND_COLOR           0x00008000\n#define BCI_CMD_DEST_GBD             0x00000000\n#define BCI_CMD_SRC_GBD              0x00000020\n#define BCI_CMD_SRC_SOLID            0x00000000\n#define BCI_CMD_SRC_MONO             0x00000060\n#define BCI_CMD_CLIP_NEW             0x00006000\n#define BCI_CMD_CLIP_LR              0x00004000\n\n#define BCI_CLIP_LR(l, r)            ((((r) << 16) | (l)) & 0x0FFF0FFF)\n#define BCI_CLIP_TL(t, l)            ((((t) << 16) | (l)) & 0x0FFF0FFF)\n#define BCI_CLIP_BR(b, r)            ((((b) << 16) | (r)) & 0x0FFF0FFF)\n#define BCI_W_H(w, h)                (((h) << 16) | ((w) & 0xFFF))\n#define BCI_X_Y(x, y)                (((y) << 16) | ((x) & 0xFFF))\n\n#define BCI_GBD1                     0xE0\n#define BCI_GBD2                     0xE1\n\n#define BCI_BUFFER_OFFSET            0x10000\n#define BCI_SIZE                     0x4000\n\n#define BCI_SEND(dw)                 writel(dw, par->bci_base + par->bci_ptr++)\n\n#define BCI_CMD_GET_ROP(cmd)         (((cmd) >> 16) & 0xFF)\n#define BCI_CMD_SET_ROP(cmd, rop)    ((cmd) |= ((rop & 0xFF) << 16))\n#define BCI_CMD_SEND_COLOR           0x00008000\n\n#define DISP_CRT     1\n#define DISP_LCD     2\n#define DISP_DFP     3\n\nstruct xtimings {\n\tunsigned int Clock;\n\tunsigned int HDisplay;\n\tunsigned int HSyncStart;\n\tunsigned int HSyncEnd;\n\tunsigned int HTotal;\n\tunsigned int HAdjusted;\n\tunsigned int VDisplay;\n\tunsigned int VSyncStart;\n\tunsigned int VSyncEnd;\n\tunsigned int VTotal;\n\tunsigned int sync;\n\tint\t       dblscan;\n\tint\t       interlaced;\n};\n\nstruct savage_reg {\n\tunsigned char MiscOutReg;      \n\tunsigned char CRTC[25];        \n\tunsigned char Sequencer[5];    \n\tunsigned char Graphics[9];     \n\tunsigned char Attribute[21];   \n\n\tunsigned int mode, refresh;\n\tunsigned char SR08, SR0E, SR0F;\n\tunsigned char SR10, SR11, SR12, SR13, SR15, SR18, SR29, SR30;\n\tunsigned char SR54[8];\n\tunsigned char Clock;\n\tunsigned char CR31, CR32, CR33, CR34, CR36, CR3A, CR3B, CR3C;\n\tunsigned char CR40, CR41, CR42, CR43, CR45;\n\tunsigned char CR50, CR51, CR53, CR55, CR58, CR5B, CR5D, CR5E;\n\tunsigned char CR60, CR63, CR65, CR66, CR67, CR68, CR69, CR6D, CR6F;\n\tunsigned char CR86, CR88;\n\tunsigned char CR90, CR91, CRB0;\n\tunsigned int  STREAMS[22];\t \n\tunsigned int  MMPR0, MMPR1, MMPR2, MMPR3;\n};\n \n\n#define NR_PALETTE\t256\n\n\nstruct savagefb_par;\n\nstruct savagefb_i2c_chan {\n\tstruct savagefb_par *par;\n\tstruct i2c_adapter adapter;\n\tstruct i2c_algo_bit_data algo;\n\tvolatile u8 __iomem *ioaddr;\n\tu32   reg;\n};\n\nstruct savagefb_par {\n\tstruct pci_dev *pcidev;\n\tsavage_chipset  chip;\n\tstruct savagefb_i2c_chan chan;\n\tstruct savage_reg state;\n\tstruct savage_reg save;\n\tstruct savage_reg initial;\n\tstruct vgastate vgastate;\n\tstruct mutex open_lock;\n\tu32 pseudo_palette[16];\n\tu32 open_count;\n\tint paletteEnabled;\n\tint pm_state;\n\tint display_type;\n\tint dvi;\n\tint crtonly;\n\tint dacSpeedBpp;\n\tint maxClock;\n\tint minClock;\n\tint numClocks;\n\tint clock[4];\n\tint MCLK, REFCLK, LCDclk;\n\tstruct {\n\t\tvoid   __iomem *vbase;\n\t\tu32    pbase;\n\t\tu32    len;\n\t\tint    wc_cookie;\n\t} video;\n\n\tstruct {\n\t\tvoid  __iomem *vbase;\n\t\tu32           pbase;\n\t\tu32           len;\n\t} mmio;\n\n\tvolatile u32  __iomem *bci_base;\n\tunsigned int  bci_ptr;\n\tu32           cob_offset;\n\tu32           cob_size;\n\tint           cob_index;\n\n\tvoid (*SavageWaitIdle) (struct savagefb_par *par);\n\tvoid (*SavageWaitFifo) (struct savagefb_par *par, int space);\n\n\tint HorizScaleFactor;\n\n\t \n\tint SavagePanelWidth;\n\tint SavagePanelHeight;\n\n\tstruct {\n\t\tu16 red, green, blue, transp;\n\t} palette[NR_PALETTE];\n\n\tint depth;\n\tint vwidth;\n};\n\n#define BCI_BD_BW_DISABLE            0x10000000\n#define BCI_BD_SET_BPP(bd, bpp)      ((bd) |= (((bpp) & 0xFF) << 16))\n#define BCI_BD_SET_STRIDE(bd, st)    ((bd) |= ((st) & 0xFFFF))\n\n\n \nstatic inline u8 savage_in8(u32 addr, struct savagefb_par *par)\n{\n\treturn readb(par->mmio.vbase + addr);\n}\n\nstatic inline u16 savage_in16(u32 addr, struct savagefb_par *par)\n{\n\treturn readw(par->mmio.vbase + addr);\n}\n\nstatic inline u32 savage_in32(u32 addr, struct savagefb_par *par)\n{\n\treturn readl(par->mmio.vbase + addr);\n}\n\nstatic inline void savage_out8(u32 addr, u8 val, struct savagefb_par *par)\n{\n\twriteb(val, par->mmio.vbase + addr);\n}\n\nstatic inline void savage_out16(u32 addr, u16 val, struct savagefb_par *par)\n{\n\twritew(val, par->mmio.vbase + addr);\n}\n\nstatic inline void savage_out32(u32 addr, u32 val, struct savagefb_par *par)\n{\n\twritel(val, par->mmio.vbase + addr);\n}\n\nstatic inline u8 vga_in8(int addr, struct savagefb_par *par)\n{\n\treturn savage_in8(0x8000 + addr, par);\n}\n\nstatic inline u16 vga_in16(int addr, struct savagefb_par *par)\n{\n\treturn savage_in16(0x8000 + addr, par);\n}\n\nstatic inline u8 vga_in32(int addr, struct savagefb_par *par)\n{\n\treturn savage_in32(0x8000 + addr, par);\n}\n\nstatic inline void vga_out8(int addr, u8 val, struct savagefb_par *par)\n{\n\tsavage_out8(0x8000 + addr, val, par);\n}\n\nstatic inline void vga_out16(int addr, u16 val, struct savagefb_par *par)\n{\n\tsavage_out16(0x8000 + addr, val, par);\n}\n\nstatic inline void vga_out32(int addr, u32 val, struct savagefb_par *par)\n{\n\tsavage_out32(0x8000 + addr, val, par);\n}\n\nstatic inline u8 VGArCR (u8 index, struct savagefb_par *par)\n{\n\tvga_out8(0x3d4, index,  par);\n\treturn vga_in8(0x3d5, par);\n}\n\nstatic inline u8 VGArGR (u8 index, struct savagefb_par *par)\n{\n\tvga_out8(0x3ce, index, par);\n\treturn vga_in8(0x3cf, par);\n}\n\nstatic inline u8 VGArSEQ (u8 index, struct savagefb_par *par)\n{\n\tvga_out8(0x3c4, index, par);\n\treturn vga_in8(0x3c5, par);\n}\n\nstatic inline void VGAwCR(u8 index, u8 val, struct savagefb_par *par)\n{\n\tvga_out8(0x3d4, index, par);\n\tvga_out8(0x3d5, val, par);\n}\n\nstatic inline void VGAwGR(u8 index, u8 val, struct savagefb_par *par)\n{\n\tvga_out8(0x3ce, index, par);\n\tvga_out8(0x3cf, val, par);\n}\n\nstatic inline void VGAwSEQ(u8 index, u8 val, struct savagefb_par *par)\n{\n\tvga_out8(0x3c4, index, par);\n\tvga_out8 (0x3c5, val, par);\n}\n\nstatic inline void VGAenablePalette(struct savagefb_par *par)\n{\n\tvga_in8(0x3da, par);\n\tvga_out8(0x3c0, 0x00, par);\n\tpar->paletteEnabled = 1;\n}\n\nstatic inline void VGAdisablePalette(struct savagefb_par *par)\n{\n\tvga_in8(0x3da, par);\n\tvga_out8(0x3c0, 0x20, par);\n\tpar->paletteEnabled = 0;\n}\n\nstatic inline void VGAwATTR(u8 index, u8 value, struct savagefb_par *par)\n{\n\tif (par->paletteEnabled)\n\t\tindex &= ~0x20;\n\telse\n\t\tindex |= 0x20;\n\n\tvga_in8(0x3da, par);\n\tvga_out8(0x3c0, index, par);\n\tvga_out8 (0x3c0, value, par);\n}\n\nstatic inline void VGAwMISC(u8 value, struct savagefb_par *par)\n{\n\tvga_out8(0x3c2, value, par);\n}\n\n#ifndef CONFIG_FB_SAVAGE_ACCEL\n#define savagefb_set_clip(x)\n#endif\n\nstatic inline void VerticalRetraceWait(struct savagefb_par *par)\n{\n\tvga_out8(0x3d4, 0x17, par);\n\tif (vga_in8(0x3d5, par) & 0x80) {\n\t\twhile ((vga_in8(0x3da, par) & 0x08) == 0x08);\n\t\twhile ((vga_in8(0x3da, par) & 0x08) == 0x00);\n\t}\n}\n\nextern int savagefb_probe_i2c_connector(struct fb_info *info,\n\t\t\t\t\tu8 **out_edid);\nextern void savagefb_create_i2c_busses(struct fb_info *info);\nextern void savagefb_delete_i2c_busses(struct fb_info *info);\nextern int  savagefb_sync(struct fb_info *info);\nextern void savagefb_copyarea(struct fb_info *info,\n\t\t\t      const struct fb_copyarea *region);\nextern void savagefb_fillrect(struct fb_info *info,\n\t\t\t      const struct fb_fillrect *rect);\nextern void savagefb_imageblit(struct fb_info *info,\n\t\t\t       const struct fb_image *image);\n\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}