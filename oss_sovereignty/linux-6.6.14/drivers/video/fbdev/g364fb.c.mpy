{
  "module_name": "g364fb.c",
  "hash_id": "9e413694a7ba3fb1b96526fabfd341a54e8dc2e317dac1a608c5c0bd86e6739a",
  "original_prompt": "Ingested from linux-6.6.14/drivers/video/fbdev/g364fb.c",
  "human_readable_source": " \n\n#include <linux/module.h>\n#include <linux/console.h>\n#include <linux/kernel.h>\n#include <linux/errno.h>\n#include <linux/string.h>\n#include <linux/mm.h>\n#include <linux/vmalloc.h>\n#include <linux/delay.h>\n#include <linux/interrupt.h>\n#include <linux/fb.h>\n#include <linux/init.h>\n#include <asm/io.h>\n#include <asm/jazz.h>\n\n \n#define G364_MEM_BASE   0xe4400000\n#define G364_PORT_BASE  0xe4000000\n#define ID_REG \t\t0xe4000000\t \n#define BOOT_REG \t0xe4080000\n#define TIMING_REG \t0xe4080108\t \n#define DISPLAY_REG \t0xe4080118\n#define VDISPLAY_REG \t0xe4080150\n#define MASK_REG \t0xe4080200\n#define CTLA_REG \t0xe4080300\n#define CURS_TOGGLE \t0x800000\n#define BIT_PER_PIX\t0x700000\t \n#define DELAY_SAMPLE    0x080000\n#define PORT_INTER\t0x040000\n#define PIX_PIPE_DEL\t0x030000\t \n#define PIX_PIPE_DEL2\t0x008000\t \n#define TR_CYCLE_TOG\t0x004000\n#define VRAM_ADR_INC\t0x003000\t \n#define BLANK_OFF\t0x000800\n#define FORCE_BLANK\t0x000400\n#define BLK_FUN_SWTCH\t0x000200\n#define BLANK_IO\t0x000100\n#define BLANK_LEVEL\t0x000080\n#define A_VID_FORM\t0x000040\n#define D_SYNC_FORM\t0x000020\n#define FRAME_FLY_PAT\t0x000010\n#define OP_MODE\t\t0x000008\n#define INTL_STAND\t0x000004\n#define SCRN_FORM\t0x000002\n#define ENABLE_VTG\t0x000001\n#define TOP_REG \t0xe4080400\n#define CURS_PAL_REG \t0xe4080508\t \n#define CHKSUM_REG \t0xe4080600\t \n#define CURS_POS_REG \t0xe4080638\n#define CLR_PAL_REG \t0xe4080800\t \n#define CURS_PAT_REG \t0xe4081000\t \n#define MON_ID_REG \t0xe4100000\t \n#define RESET_REG \t0xe4180000\t \n\nstatic struct fb_info fb_info;\n\nstatic struct fb_fix_screeninfo fb_fix __initdata = {\n\t.id \t\t= \"G364 8plane\",\n\t.smem_start \t= 0x40000000,\t \n\t.type \t\t= FB_TYPE_PACKED_PIXELS,\n\t.visual \t= FB_VISUAL_PSEUDOCOLOR,\n\t.ypanstep \t= 1,\n\t.accel \t\t= FB_ACCEL_NONE,\n};\n\nstatic struct fb_var_screeninfo fb_var __initdata = {\n\t.bits_per_pixel = 8,\n\t.red \t\t= { 0, 8, 0 },\n      \t.green \t\t= { 0, 8, 0 },\n      \t.blue\t\t= { 0, 8, 0 },\n      \t.activate\t= FB_ACTIVATE_NOW,\n      \t.height\t\t= -1,\n      \t.width\t\t= -1,\n      \t.pixclock\t= 39722,\n      \t.left_margin\t= 40,\n      \t.right_margin\t= 24,\n      \t.upper_margin\t= 32,\n      \t.lower_margin\t= 11,\n      \t.hsync_len \t= 96,\n      \t.vsync_len \t= 2,\n      \t.vmode\t\t= FB_VMODE_NONINTERLACED,\n};\n\n \nint g364fb_init(void);\n\nstatic int g364fb_pan_display(struct fb_var_screeninfo *var,\n\t\t\t      struct fb_info *info);\nstatic int g364fb_setcolreg(u_int regno, u_int red, u_int green,\n\t\t\t    u_int blue, u_int transp,\n\t\t\t    struct fb_info *info);\nstatic int g364fb_blank(int blank, struct fb_info *info);\n\nstatic const struct fb_ops g364fb_ops = {\n\t.owner\t\t= THIS_MODULE,\n\tFB_DEFAULT_IOMEM_OPS,\n\t.fb_setcolreg\t= g364fb_setcolreg,\n\t.fb_pan_display\t= g364fb_pan_display,\n\t.fb_blank\t= g364fb_blank,\n};\n\n \nstatic int g364fb_pan_display(struct fb_var_screeninfo *var,\n\t\t\t      struct fb_info *info)\n{\n\tif (var->xoffset ||\n\t    var->yoffset + info->var.yres > info->var.yres_virtual)\n\t\treturn -EINVAL;\n\n\t*(unsigned int *) TOP_REG = var->yoffset * info->var.xres;\n\treturn 0;\n}\n\n \nstatic int g364fb_blank(int blank, struct fb_info *info)\n{\n\tif (blank)\n\t\t*(unsigned int *) CTLA_REG |= FORCE_BLANK;\n\telse\n\t\t*(unsigned int *) CTLA_REG &= ~FORCE_BLANK;\n\treturn 0;\n}\n\n \nstatic int g364fb_setcolreg(u_int regno, u_int red, u_int green,\n\t\t\t    u_int blue, u_int transp, struct fb_info *info)\n{\n\tvolatile unsigned int *ptr = (volatile unsigned int *) CLR_PAL_REG;\n\n\tif (regno > 255)\n\t\treturn 1;\n\n\tred >>= 8;\n\tgreen >>= 8;\n\tblue >>= 8;\n\n\tptr[regno << 1] = (red << 16) | (green << 8) | blue;\n\n\treturn 0;\n}\n\n \nint __init g364fb_init(void)\n{\n\tvolatile unsigned int *curs_pal_ptr =\n\t    (volatile unsigned int *) CURS_PAL_REG;\n\tint mem, i;\n\n\tif (fb_get_options(\"g364fb\", NULL))\n\t\treturn -ENODEV;\n\n\t \n\n\t \n\t*(volatile unsigned int *) CTLA_REG &= ~ENABLE_VTG;\n\tfb_var.xres =\n\t    (*((volatile unsigned int *) DISPLAY_REG) & 0x00ffffff) * 4;\n\tfb_var.yres =\n\t    (*((volatile unsigned int *) VDISPLAY_REG) & 0x00ffffff) / 2;\n\t*(volatile unsigned int *) CTLA_REG |= ENABLE_VTG;\n\n\t \n\tcurs_pal_ptr[0] |= 0x00ffffff;\n\tcurs_pal_ptr[2] |= 0x00ffffff;\n\tcurs_pal_ptr[4] |= 0x00ffffff;\n\n\t \n\tfor (i = 0; i < 512; i++)\n\t\t*(unsigned short *) (CURS_PAT_REG + i * 8) = 0;\n\n\t \n\t*(unsigned short *) (CURS_PAT_REG + 14 * 64) = 0xffff;\n\t*(unsigned short *) (CURS_PAT_REG + 15 * 64) = 0xffff;\n\tfb_var.xres_virtual = fb_var.xres;\n\tfb_fix.line_length = fb_var.xres_virtual * fb_var.bits_per_pixel / 8;\n\tfb_fix.smem_start = 0x40000000;\t \n\t \n\tmem = (r4030_read_reg32(JAZZ_R4030_CONFIG) >> 8) & 3;\n\tfb_fix.smem_len = (1 << (mem * 2)) * 512 * 1024;\n\tfb_var.yres_virtual = fb_fix.smem_len / fb_var.xres;\n\n\tfb_info.fbops = &g364fb_ops;\n\tfb_info.screen_base = (char *) G364_MEM_BASE;\t \n\tfb_info.var = fb_var;\n\tfb_info.fix = fb_fix;\n\tfb_info.flags = FBINFO_HWACCEL_YPAN;\n\n\tfb_alloc_cmap(&fb_info.cmap, 255, 0);\n\n\tif (register_framebuffer(&fb_info) < 0)\n\t\treturn -EINVAL;\n\treturn 0;\n}\n\nmodule_init(g364fb_init);\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}