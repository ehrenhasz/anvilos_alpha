{
  "module_name": "fbcon.h",
  "hash_id": "240d69691fba3eb607c42bd9b58883c768e1f8596fe38164f00c7eeaa2d26f1a",
  "original_prompt": "Ingested from linux-6.6.14/drivers/video/fbdev/core/fbcon.h",
  "human_readable_source": " \n\n#ifndef _VIDEO_FBCON_H\n#define _VIDEO_FBCON_H\n\n#include <linux/types.h>\n#include <linux/vt_buffer.h>\n#include <linux/vt_kern.h>\n#include <linux/workqueue.h>\n\n#include <asm/io.h>\n\n    \n\nstruct fbcon_display {\n     \n    const u_char *fontdata;\n    int userfont;                    \n#ifdef CONFIG_FRAMEBUFFER_CONSOLE_LEGACY_ACCELERATION\n    u_short scrollmode;              \n#endif\n    u_short inverse;                 \n    short yscroll;                   \n    int vrows;                       \n    int cursor_shape;\n    int con_rotate;\n    u32 xres_virtual;\n    u32 yres_virtual;\n    u32 height;\n    u32 width;\n    u32 bits_per_pixel;\n    u32 grayscale;\n    u32 nonstd;\n    u32 accel_flags;\n    u32 rotate;\n    struct fb_bitfield red;\n    struct fb_bitfield green;\n    struct fb_bitfield blue;\n    struct fb_bitfield transp;\n    const struct fb_videomode *mode;\n};\n\nstruct fbcon_ops {\n\tvoid (*bmove)(struct vc_data *vc, struct fb_info *info, int sy,\n\t\t      int sx, int dy, int dx, int height, int width);\n\tvoid (*clear)(struct vc_data *vc, struct fb_info *info, int sy,\n\t\t      int sx, int height, int width);\n\tvoid (*putcs)(struct vc_data *vc, struct fb_info *info,\n\t\t      const unsigned short *s, int count, int yy, int xx,\n\t\t      int fg, int bg);\n\tvoid (*clear_margins)(struct vc_data *vc, struct fb_info *info,\n\t\t\t      int color, int bottom_only);\n\tvoid (*cursor)(struct vc_data *vc, struct fb_info *info, int mode,\n\t\t       int fg, int bg);\n\tint  (*update_start)(struct fb_info *info);\n\tint  (*rotate_font)(struct fb_info *info, struct vc_data *vc);\n\tstruct fb_var_screeninfo var;   \n\tstruct delayed_work cursor_work;  \n\tstruct fb_cursor cursor_state;\n\tstruct fbcon_display *p;\n\tstruct fb_info *info;\n        int    currcon;\t                 \n\tint    cur_blink_jiffies;\n\tint    cursor_flash;\n\tint    cursor_reset;\n\tint    blank_state;\n\tint    graphics;\n\tint    save_graphics;  \n\tbool   initialized;\n\tint    rotate;\n\tint    cur_rotate;\n\tchar  *cursor_data;\n\tu8    *fontbuffer;\n\tu8    *fontdata;\n\tu8    *cursor_src;\n\tu32    cursor_size;\n\tu32    fd_size;\n};\n     \n\n \n#define attr_fgcol(fgshift,s)    \\\n\t(((s) >> (fgshift)) & 0x0f)\n#define attr_bgcol(bgshift,s)    \\\n\t(((s) >> (bgshift)) & 0x0f)\n\n \n#define attr_bold(s) \\\n\t((s) & 0x200)\n#define attr_reverse(s) \\\n\t((s) & 0x800)\n#define attr_underline(s) \\\n\t((s) & 0x400)\n#define attr_blink(s) \\\n\t((s) & 0x8000)\n\t\n\nstatic inline int mono_col(const struct fb_info *info)\n{\n\t__u32 max_len;\n\tmax_len = max(info->var.green.length, info->var.red.length);\n\tmax_len = max(info->var.blue.length, max_len);\n\treturn (~(0xfff << max_len)) & 0xff;\n}\n\nstatic inline int attr_col_ec(int shift, struct vc_data *vc,\n\t\t\t      struct fb_info *info, int is_fg)\n{\n\tint is_mono01;\n\tint col;\n\tint fg;\n\tint bg;\n\n\tif (!vc)\n\t\treturn 0;\n\n\tif (vc->vc_can_do_color)\n\t\treturn is_fg ? attr_fgcol(shift,vc->vc_video_erase_char)\n\t\t\t: attr_bgcol(shift,vc->vc_video_erase_char);\n\n\tif (!info)\n\t\treturn 0;\n\n\tcol = mono_col(info);\n\tis_mono01 = info->fix.visual == FB_VISUAL_MONO01;\n\n\tif (attr_reverse(vc->vc_video_erase_char)) {\n\t\tfg = is_mono01 ? col : 0;\n\t\tbg = is_mono01 ? 0 : col;\n\t}\n\telse {\n\t\tfg = is_mono01 ? 0 : col;\n\t\tbg = is_mono01 ? col : 0;\n\t}\n\n\treturn is_fg ? fg : bg;\n}\n\n#define attr_bgcol_ec(bgshift, vc, info) attr_col_ec(bgshift, vc, info, 0)\n#define attr_fgcol_ec(fgshift, vc, info) attr_col_ec(fgshift, vc, info, 1)\n\n     \n\n \n\n#define SCROLL_MOVE\t   0x001\n#define SCROLL_PAN_MOVE\t   0x002\n#define SCROLL_WRAP_MOVE   0x003\n#define SCROLL_REDRAW\t   0x004\n#define SCROLL_PAN_REDRAW  0x005\n\nstatic inline u_short fb_scrollmode(struct fbcon_display *fb)\n{\n#ifdef CONFIG_FRAMEBUFFER_CONSOLE_LEGACY_ACCELERATION\n\treturn fb->scrollmode;\n#else\n\t \n\treturn SCROLL_REDRAW;\n#endif\n}\n\n\n#ifdef CONFIG_FB_TILEBLITTING\nextern void fbcon_set_tileops(struct vc_data *vc, struct fb_info *info);\n#endif\nextern void fbcon_set_bitops(struct fbcon_ops *ops);\nextern int  soft_cursor(struct fb_info *info, struct fb_cursor *cursor);\n\n#define FBCON_ATTRIBUTE_UNDERLINE 1\n#define FBCON_ATTRIBUTE_REVERSE   2\n#define FBCON_ATTRIBUTE_BOLD      4\n\nstatic inline int real_y(struct fbcon_display *p, int ypos)\n{\n\tint rows = p->vrows;\n\n\typos += p->yscroll;\n\treturn ypos < rows ? ypos : ypos - rows;\n}\n\n\nstatic inline int get_attribute(struct fb_info *info, u16 c)\n{\n\tint attribute = 0;\n\n\tif (fb_get_color_depth(&info->var, &info->fix) == 1) {\n\t\tif (attr_underline(c))\n\t\t\tattribute |= FBCON_ATTRIBUTE_UNDERLINE;\n\t\tif (attr_reverse(c))\n\t\t\tattribute |= FBCON_ATTRIBUTE_REVERSE;\n\t\tif (attr_bold(c))\n\t\t\tattribute |= FBCON_ATTRIBUTE_BOLD;\n\t}\n\n\treturn attribute;\n}\n\n#define FBCON_SWAP(i,r,v) ({ \\\n        typeof(r) _r = (r);  \\\n        typeof(v) _v = (v);  \\\n        (void) (&_r == &_v); \\\n        (i == FB_ROTATE_UR || i == FB_ROTATE_UD) ? _r : _v; })\n\n#ifdef CONFIG_FRAMEBUFFER_CONSOLE_ROTATION\nextern void fbcon_set_rotate(struct fbcon_ops *ops);\n#else\n#define fbcon_set_rotate(x) do {} while(0)\n#endif  \n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}