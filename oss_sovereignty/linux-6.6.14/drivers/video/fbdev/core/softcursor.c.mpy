{
  "module_name": "softcursor.c",
  "hash_id": "a74002ebad15028b43f0d07a0cda22457948a1ca985dd1c8ddcc09650d18d949",
  "original_prompt": "Ingested from linux-6.6.14/drivers/video/fbdev/core/softcursor.c",
  "human_readable_source": " \n\n#include <linux/module.h>\n#include <linux/string.h>\n#include <linux/fb.h>\n#include <linux/slab.h>\n\n#include <asm/io.h>\n\n#include \"fbcon.h\"\n\nint soft_cursor(struct fb_info *info, struct fb_cursor *cursor)\n{\n\tstruct fbcon_ops *ops = info->fbcon_par;\n\tunsigned int scan_align = info->pixmap.scan_align - 1;\n\tunsigned int buf_align = info->pixmap.buf_align - 1;\n\tunsigned int i, size, dsize, s_pitch, d_pitch;\n\tstruct fb_image *image;\n\tu8 *src, *dst;\n\n\tif (info->state != FBINFO_STATE_RUNNING)\n\t\treturn 0;\n\n\ts_pitch = (cursor->image.width + 7) >> 3;\n\tdsize = s_pitch * cursor->image.height;\n\n\tif (dsize + sizeof(struct fb_image) != ops->cursor_size) {\n\t\tkfree(ops->cursor_src);\n\t\tops->cursor_size = dsize + sizeof(struct fb_image);\n\n\t\tops->cursor_src = kmalloc(ops->cursor_size, GFP_ATOMIC);\n\t\tif (!ops->cursor_src) {\n\t\t\tops->cursor_size = 0;\n\t\t\treturn -ENOMEM;\n\t\t}\n\t}\n\n\tsrc = ops->cursor_src + sizeof(struct fb_image);\n\timage = (struct fb_image *)ops->cursor_src;\n\t*image = cursor->image;\n\td_pitch = (s_pitch + scan_align) & ~scan_align;\n\n\tsize = d_pitch * image->height + buf_align;\n\tsize &= ~buf_align;\n\tdst = fb_get_buffer_offset(info, &info->pixmap, size);\n\n\tif (cursor->enable) {\n\t\tswitch (cursor->rop) {\n\t\tcase ROP_XOR:\n\t\t\tfor (i = 0; i < dsize; i++)\n\t\t\t\tsrc[i] = image->data[i] ^ cursor->mask[i];\n\t\t\tbreak;\n\t\tcase ROP_COPY:\n\t\tdefault:\n\t\t\tfor (i = 0; i < dsize; i++)\n\t\t\t\tsrc[i] = image->data[i] & cursor->mask[i];\n\t\t\tbreak;\n\t\t}\n\t} else\n\t\tmemcpy(src, image->data, dsize);\n\n\tfb_pad_aligned_buffer(dst, d_pitch, src, s_pitch, image->height);\n\timage->data = dst;\n\tinfo->fbops->fb_imageblit(info, image);\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}