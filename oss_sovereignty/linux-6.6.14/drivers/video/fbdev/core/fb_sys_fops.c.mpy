{
  "module_name": "fb_sys_fops.c",
  "hash_id": "dcb832d72c1ce9538345c5d1330e92e16dc63aae899afe830e81271537c04988",
  "original_prompt": "Ingested from linux-6.6.14/drivers/video/fbdev/core/fb_sys_fops.c",
  "human_readable_source": " \n#include <linux/fb.h>\n#include <linux/module.h>\n#include <linux/uaccess.h>\n\nssize_t fb_sys_read(struct fb_info *info, char __user *buf, size_t count,\n\t\t    loff_t *ppos)\n{\n\tunsigned long p = *ppos;\n\tvoid *src;\n\tint err = 0;\n\tunsigned long total_size, c;\n\tssize_t ret;\n\n\tif (!info->screen_buffer)\n\t\treturn -ENODEV;\n\n\ttotal_size = info->screen_size;\n\n\tif (total_size == 0)\n\t\ttotal_size = info->fix.smem_len;\n\n\tif (p >= total_size)\n\t\treturn 0;\n\n\tif (count >= total_size)\n\t\tcount = total_size;\n\n\tif (count + p > total_size)\n\t\tcount = total_size - p;\n\n\tsrc = info->screen_buffer + p;\n\n\tif (info->fbops->fb_sync)\n\t\tinfo->fbops->fb_sync(info);\n\n\tc = copy_to_user(buf, src, count);\n\tif (c)\n\t\terr = -EFAULT;\n\tret = count - c;\n\n\t*ppos += ret;\n\n\treturn ret ? ret : err;\n}\nEXPORT_SYMBOL_GPL(fb_sys_read);\n\nssize_t fb_sys_write(struct fb_info *info, const char __user *buf,\n\t\t     size_t count, loff_t *ppos)\n{\n\tunsigned long p = *ppos;\n\tvoid *dst;\n\tint err = 0;\n\tunsigned long total_size, c;\n\tsize_t ret;\n\n\tif (!info->screen_buffer)\n\t\treturn -ENODEV;\n\n\ttotal_size = info->screen_size;\n\n\tif (total_size == 0)\n\t\ttotal_size = info->fix.smem_len;\n\n\tif (p > total_size)\n\t\treturn -EFBIG;\n\n\tif (count > total_size) {\n\t\terr = -EFBIG;\n\t\tcount = total_size;\n\t}\n\n\tif (count + p > total_size) {\n\t\tif (!err)\n\t\t\terr = -ENOSPC;\n\n\t\tcount = total_size - p;\n\t}\n\n\tdst = info->screen_buffer + p;\n\n\tif (info->fbops->fb_sync)\n\t\tinfo->fbops->fb_sync(info);\n\n\tc = copy_from_user(dst, buf, count);\n\tif (c)\n\t\terr = -EFAULT;\n\tret = count - c;\n\n\t*ppos += ret;\n\n\treturn ret ? ret : err;\n}\nEXPORT_SYMBOL_GPL(fb_sys_write);\n\nMODULE_AUTHOR(\"Antonino Daplas <adaplas@pol.net>\");\nMODULE_DESCRIPTION(\"Generic file read (fb in system RAM)\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}