{
  "module_name": "macmodes.c",
  "hash_id": "c2e52bf26a0b53ceca8ffa8887325bfbe4d36bcdeb8b08ab55bcaf3009cab02b",
  "original_prompt": "Ingested from linux-6.6.14/drivers/video/fbdev/macmodes.c",
  "human_readable_source": " \n\n#include <linux/errno.h>\n#include <linux/fb.h>\n#include <linux/string.h>\n#include <linux/module.h>\n\n#include \"macmodes.h\"\n\n     \n\n#define DEFAULT_MODEDB_INDEX\t0\n\nstatic const struct fb_videomode mac_modedb[] = {\n    {\n\t \n\t\"mac2\", 60, 512, 384, 63828, 80, 16, 19, 1, 32, 3,\n\t0, FB_VMODE_NONINTERLACED\n    }, {\n\t \n\t\"mac5\", 60, 640, 480, 39722, 32, 32, 33, 10, 96, 2,\n\t0, FB_VMODE_NONINTERLACED\n    }, {\n\t \n\t\"mac6\", 67, 640, 480, 33334, 80, 80, 39, 3, 64, 3,\n\t0, FB_VMODE_NONINTERLACED\n    }, {\n\t \n\t\"mac7\", 75, 640, 870, 17457, 80, 32, 42, 3, 80, 3,\n\t0, FB_VMODE_NONINTERLACED\n    }, {\n\t \n\t\"mac9\", 56, 800, 600, 27778, 112, 40, 22, 1, 72, 2,\n\tFB_SYNC_HOR_HIGH_ACT|FB_SYNC_VERT_HIGH_ACT, FB_VMODE_NONINTERLACED\n    }, {\n\t \n\t\"mac10\", 60, 800, 600, 25000, 72, 56, 23, 1, 128, 4,\n\tFB_SYNC_HOR_HIGH_ACT|FB_SYNC_VERT_HIGH_ACT, FB_VMODE_NONINTERLACED\n    }, {\n\t \n\t\"mac11\", 72, 800, 600, 20000, 48, 72, 23, 37, 120, 6,\n\tFB_SYNC_HOR_HIGH_ACT|FB_SYNC_VERT_HIGH_ACT, FB_VMODE_NONINTERLACED\n    }, {\n\t \n\t\"mac12\", 75, 800, 600, 20203, 144, 32, 21, 1, 80, 3,\n\tFB_SYNC_HOR_HIGH_ACT|FB_SYNC_VERT_HIGH_ACT, FB_VMODE_NONINTERLACED\n    }, {\n\t \n\t\"mac13\", 75, 832, 624, 17362, 208, 48, 39, 1, 64, 3,\n\t0, FB_VMODE_NONINTERLACED\n    }, {\n\t \n\t\"mac14\", 60, 1024, 768, 15385, 144, 40, 29, 3, 136, 6,\n\t0, FB_VMODE_NONINTERLACED\n    }, {\n\t \n\t\"mac15\", 72, 1024, 768, 13334, 128, 40, 29, 3, 136, 6,\n\t0, FB_VMODE_NONINTERLACED\n    }, {\n\t \n\t\"mac16\", 75, 1024, 768, 12699, 176, 16, 28, 1, 96, 3,\n\tFB_SYNC_HOR_HIGH_ACT|FB_SYNC_VERT_HIGH_ACT, FB_VMODE_NONINTERLACED\n    }, {\n\t \n\t\"mac17\", 75, 1024, 768, 12699, 160, 32, 28, 1, 96, 3,\n\tFB_SYNC_HOR_HIGH_ACT|FB_SYNC_VERT_HIGH_ACT, FB_VMODE_NONINTERLACED\n    }, {\n\t \n\t\"mac18\", 75, 1152, 870, 10000, 128, 48, 39, 3, 128, 3,\n\tFB_SYNC_HOR_HIGH_ACT|FB_SYNC_VERT_HIGH_ACT, FB_VMODE_NONINTERLACED\n    }, {\n\t \n\t\"mac19\", 75, 1280, 960, 7937, 224, 32, 36, 1, 144, 3,\n\t0, FB_VMODE_NONINTERLACED\n    }, {\n\t \n\t\"mac20\", 75, 1280, 1024, 7408, 232, 64, 38, 1, 112, 3,\n\tFB_SYNC_HOR_HIGH_ACT|FB_SYNC_VERT_HIGH_ACT, FB_VMODE_NONINTERLACED\n    }, {\n\t \n\t\"mac21\", 60, 1152, 768, 15386, 158, 26, 29, 3, 136, 6,\n\tFB_SYNC_HOR_HIGH_ACT|FB_SYNC_VERT_HIGH_ACT, FB_VMODE_NONINTERLACED\n    }, {\n\t \n\t\"mac22\", 60, 1600, 1024, 8908, 88, 104, 1, 10, 16, 1,\n\tFB_SYNC_HOR_HIGH_ACT|FB_SYNC_VERT_HIGH_ACT, FB_VMODE_NONINTERLACED\n    }\n\n#if 0\n     \n    {\n\t \n\t\"mac1\", 60, 512, 384, pixclock, left, right, upper, lower, hslen, vslen,\n\tsync, FB_VMODE_INTERLACED\n    }, {\n\t \n\t\"mac3\", 50, 640, 480, pixclock, left, right, upper, lower, hslen, vslen,\n\tsync, FB_VMODE_INTERLACED\n    }, {\n\t \n\t\"mac4\", 60, 640, 480, pixclock, left, right, upper, lower, hslen, vslen,\n\tsync, FB_VMODE_INTERLACED\n    }, {\n\t \n\t\"mac8\", 50, 768, 576, pixclock, left, right, upper, lower, hslen, vslen,\n\tsync, FB_VMODE_INTERLACED\n    },\n#endif\n};\n\n\n     \n\nstatic const struct mode_map {\n    int vmode;\n    const struct fb_videomode *mode;\n} mac_modes[] = {\n     \n    { VMODE_512_384_60, &mac_modedb[0] },\n     \n    { VMODE_640_480_60, &mac_modedb[1] },\n    { VMODE_640_480_67, &mac_modedb[2] },\n     \n    { VMODE_640_870_75P, &mac_modedb[3] },\n     \n    { VMODE_800_600_56, &mac_modedb[4] },\n    { VMODE_800_600_60, &mac_modedb[5] },\n    { VMODE_800_600_75, &mac_modedb[7] },\n    { VMODE_800_600_72, &mac_modedb[6] },\n     \n    { VMODE_832_624_75, &mac_modedb[8] },\n     \n    { VMODE_1024_768_60, &mac_modedb[9] },\n    { VMODE_1024_768_70, &mac_modedb[10] },\n    { VMODE_1024_768_75V, &mac_modedb[11] },\n    { VMODE_1024_768_75, &mac_modedb[12] },\n     \n    { VMODE_1152_768_60, &mac_modedb[16] },\n     \n    { VMODE_1152_870_75, &mac_modedb[13] },\n     \n    { VMODE_1280_960_75, &mac_modedb[14] },\n     \n    { VMODE_1280_1024_75, &mac_modedb[15] },\n     \n    { VMODE_1600_1024_60, &mac_modedb[17] },\n    { -1, NULL }\n};\n\n\n     \n\nstatic const struct monitor_map {\n    int sense;\n    int vmode;\n} mac_monitors[] = {\n    { 0x000, VMODE_1280_1024_75 },\t \n    { 0x114, VMODE_640_870_75P },\t \n    { 0x221, VMODE_512_384_60 },\t \n    { 0x331, VMODE_1280_1024_75 },\t \n    { 0x334, VMODE_1280_1024_75 },\t \n    { 0x335, VMODE_1280_1024_75 },\t \n    { 0x40A, VMODE_640_480_60I },\t \n    { 0x51E, VMODE_640_870_75P },\t \n    { 0x603, VMODE_832_624_75 },\t \n    { 0x60b, VMODE_1024_768_70 },\t \n    { 0x623, VMODE_1152_870_75 },\t \n    { 0x62b, VMODE_640_480_67 },\t \n    { 0x700, VMODE_640_480_50I },\t \n    { 0x714, VMODE_640_480_60I },\t \n    { 0x717, VMODE_800_600_75 },\t \n    { 0x72d, VMODE_832_624_75 },\t \n    { 0x730, VMODE_768_576_50I },\t \n    { 0x73a, VMODE_1152_870_75 },\t \n    { 0x73f, VMODE_640_480_67 },\t \n    { 0xBEEF, VMODE_1600_1024_60 },\t \n    { -1,    VMODE_640_480_60 },\t \n};\n\n \n\nint mac_vmode_to_var(int vmode, int cmode, struct fb_var_screeninfo *var)\n{\n    const struct fb_videomode *mode = NULL;\n    const struct mode_map *map;\n\n    for (map = mac_modes; map->vmode != -1; map++)\n\tif (map->vmode == vmode) {\n\t    mode = map->mode;\n\t    break;\n\t}\n    if (!mode)\n\treturn -EINVAL;\n\n    memset(var, 0, sizeof(struct fb_var_screeninfo));\n    switch (cmode) {\n\tcase CMODE_8:\n\t    var->bits_per_pixel = 8;\n\t    var->red.offset = 0;\n\t    var->red.length = 8;   \n\t    var->green.offset = 0;\n\t    var->green.length = 8;\n\t    var->blue.offset = 0;\n\t    var->blue.length = 8;\n\t    break;\n\n\tcase CMODE_16:\n\t    var->bits_per_pixel = 16;\n\t    var->red.offset = 10;\n\t    var->red.length = 5;\n\t    var->green.offset = 5;\n\t    var->green.length = 5;\n\t    var->blue.offset = 0;\n\t    var->blue.length = 5;\n\t    break;\n\n\tcase CMODE_32:\n\t    var->bits_per_pixel = 32;\n\t    var->red.offset = 16;\n\t    var->red.length = 8;\n\t    var->green.offset = 8;\n\t    var->green.length = 8;\n\t    var->blue.offset = 0;\n\t    var->blue.length = 8;\n\t    var->transp.offset = 24;\n\t    var->transp.length = 8;\n\t    break;\n\n\tdefault:\n\t    return -EINVAL;\n    }\n    var->xres = mode->xres;\n    var->yres = mode->yres;\n    var->xres_virtual = mode->xres;\n    var->yres_virtual = mode->yres;\n    var->height = -1;\n    var->width = -1;\n    var->pixclock = mode->pixclock;\n    var->left_margin = mode->left_margin;\n    var->right_margin = mode->right_margin;\n    var->upper_margin = mode->upper_margin;\n    var->lower_margin = mode->lower_margin;\n    var->hsync_len = mode->hsync_len;\n    var->vsync_len = mode->vsync_len;\n    var->sync = mode->sync;\n    var->vmode = mode->vmode;\n    return 0;\n}\nEXPORT_SYMBOL(mac_vmode_to_var);\n\n \n\nint mac_var_to_vmode(const struct fb_var_screeninfo *var, int *vmode,\n\t\t     int *cmode)\n{\n    const struct mode_map *map;\n\n    if (var->bits_per_pixel <= 8)\n\t*cmode = CMODE_8;\n    else if (var->bits_per_pixel <= 16)\n\t*cmode = CMODE_16;\n    else if (var->bits_per_pixel <= 32)\n\t*cmode = CMODE_32;\n    else\n\treturn -EINVAL;\n\n     \n    for (map = mac_modes; map->vmode != -1; map++) {\n\tconst struct fb_videomode *mode = map->mode;\n\n\tif (var->xres > mode->xres || var->yres > mode->yres)\n\t    continue;\n\tif (var->xres_virtual > mode->xres || var->yres_virtual > mode->yres)\n\t    continue;\n\tif (var->pixclock > mode->pixclock)\n\t    continue;\n\tif ((var->vmode & FB_VMODE_MASK) != mode->vmode)\n\t    continue;\n\t*vmode = map->vmode;\n\n\t \n\tmap++;\n\twhile (map->vmode != -1) {\n\t    const struct fb_videomode *clk_mode = map->mode;\n\n\t    if (mode->xres != clk_mode->xres || mode->yres != clk_mode->yres)\n\t\tbreak;\n\t    if (var->pixclock > mode->pixclock)\n\t        break;\n\t    if (mode->vmode != clk_mode->vmode)\n\t\tcontinue;\n\t    *vmode = map->vmode;\n\t    map++;\n\t}\n\treturn 0;\n    }\n    return -EINVAL;\n}\n\n \n\nint mac_map_monitor_sense(int sense)\n{\n    const struct monitor_map *map;\n\n    for (map = mac_monitors; map->sense != -1; map++)\n\tif (map->sense == sense)\n\t    break;\n    return map->vmode;\n}\nEXPORT_SYMBOL(mac_map_monitor_sense);\n\n \n\nint mac_find_mode(struct fb_var_screeninfo *var, struct fb_info *info,\n\t\t  const char *mode_option, unsigned int default_bpp)\n{\n    const struct fb_videomode *db = NULL;\n    unsigned int dbsize = 0;\n\n    if (mode_option && !strncmp(mode_option, \"mac\", 3)) {\n\tmode_option += 3;\n\tdb = mac_modedb;\n\tdbsize = ARRAY_SIZE(mac_modedb);\n    }\n    return fb_find_mode(var, info, mode_option, db, dbsize,\n\t\t\t&mac_modedb[DEFAULT_MODEDB_INDEX], default_bpp);\n}\nEXPORT_SYMBOL(mac_find_mode);\n\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}