{
  "module_name": "init301.c",
  "hash_id": "89b24925ecca06358b01572b7e1165e96f54c3319fe10d08c121da148cc36fc4",
  "original_prompt": "Ingested from linux-6.6.14/drivers/video/fbdev/sis/init301.c",
  "human_readable_source": " \n \n \n\n#if 1\n#define SET_EMI\t\t \n#endif\n\n#if 1\n#define SET_PWD\t\t \n#endif\n\n#define COMPAL_HACK\t \n#define COMPAQ_HACK\t \n#define ASUS_HACK\t \n\n#include \"init301.h\"\n\n#ifdef CONFIG_FB_SIS_300\n#include \"oem300.h\"\n#endif\n\n#ifdef CONFIG_FB_SIS_315\n#include \"oem310.h\"\n#endif\n\n#define SiS_I2CDELAY      1000\n#define SiS_I2CDELAYSHORT  150\n\nstatic const unsigned char SiS_YPbPrTable[3][64] = {\n  {\n    0x17,0x1d,0x03,0x09,0x05,0x06,0x0c,0x0c,\n    0x94,0x49,0x01,0x0a,0x06,0x0d,0x04,0x0a,\n    0x06,0x14,0x0d,0x04,0x0a,0x00,0x85,0x1b,\n    0x0c,0x50,0x00,0x97,0x00,0xda,0x4a,0x17,\n    0x7d,0x05,0x4b,0x00,0x00,0xe2,0x00,0x02,\n    0x03,0x0a,0x65,0x9d  ,0x08,0x92,0x8f,0x40,\n    0x60,0x80,0x14,0x90,0x8c,0x60,0x14,0x53  ,\n    0x00,0x40,0x44,0x00,0xdb,0x02,0x3b,0x00\n  },\n  {\n    0x33,0x06,0x06,0x09,0x0b,0x0c,0x0c,0x0c,\n    0x98,0x0a,0x01,0x0d,0x06,0x0d,0x04,0x0a,\n    0x06,0x14,0x0d,0x04,0x0a,0x00,0x85,0x3f,\n    0x0c,0x50,0xb2,0x9f,0x16,0x59,0x4f,0x13,\n    0xad,0x11,0xad,0x1d,0x40,0x8a,0x3d,0xb8,\n    0x51,0x5e,0x60,0x49,0x7d,0x92,0x0f,0x40,\n    0x60,0x80,0x14,0x90,0x8c,0x60,0x14,0x4e,\n    0x43,0x41,0x11,0x00,0xfc,0xff,0x32,0x00\n  },\n  {\n#if 0  \n    0x13,0x1d,0xe8,0x09,0x09,0xed,0x0c,0x0c,\n    0x98,0x0a,0x01,0x0c,0x06,0x0d,0x04,0x0a,\n    0x06,0x14,0x0d,0x04,0x0a,0x00,0x85,0x3f,\n    0xed,0x50,0x70,0x9f,0x16,0x59,0x21  ,0x13,\n    0x27,0x0b,0x27,0xfc,0x30,0x27,0x1c,0xb0,\n    0x4b,0x4b,0x65  ,0x2f,0x63,0x92,0x0f,0x40,\n    0x60,0x80,0x14,0x90,0x8c,0x60,0x14,0x27,\n    0x00,0x40,0x11,0x00,0xfc,0xff,0x32,0x00\n#endif\n#if 1  \n    0x23,0x2d,0xe8,0x09,0x09,0xed,0x0c,0x0c,\n    0x98,0x0a,0x01,0x0c,0x06,0x0d,0x04,0x0a,\n    0x06,0x14,0x0d,0x04,0x0a,0x00,0x85,0x3f,\n    0xed,0x50,0x70,0x9f,0x16,0x59,0x60,0x13,\n    0x27,0x0b,0x27,0xfc,0x30,0x27,0x1c,0xb0,\n    0x4b,0x4b,0x6f,0x2f,0x63,0x92,0x0f,0x40,\n    0x60,0x80,0x14,0x90,0x8c,0x60,0x14,0x73,\n    0x00,0x40,0x11,0x00,0xfc,0xff,0x32,0x00\n#endif\n  }\n};\n\nstatic const unsigned char SiS_TVPhase[] =\n{\n\t0x21,0xED,0xBA,0x08,\t \n\t0x2A,0x05,0xE3,0x00,\t \n\t0x21,0xE4,0x2E,0x9B,\t \n\t0x21,0xF4,0x3E,0xBA,\t \n\t0x1E,0x8B,0xA2,0xA7,\n\t0x1E,0x83,0x0A,0xE0,\t \n\t0x00,0x00,0x00,0x00,\n\t0x00,0x00,0x00,0x00,\n\t0x21,0xF0,0x7B,0xD6,\t \n\t0x2A,0x09,0x86,0xE9,\t \n\t0x21,0xE6,0xEF,0xA4,\t \n\t0x21,0xF6,0x94,0x46,\t \n\t0x1E,0x8B,0xA2,0xA7,\n\t0x1E,0x83,0x0A,0xE0,\t \n\t0x00,0x00,0x00,0x00,\n\t0x00,0x00,0x00,0x00,\n\t0x1e,0x8c,0x5c,0x7a,\t \n\t0x25,0xd4,0xfd,0x5e\t \n};\n\nstatic const unsigned char SiS_HiTVGroup3_1[] = {\n    0x00, 0x14, 0x15, 0x25, 0x55, 0x15, 0x0b, 0x13,\n    0xb1, 0x41, 0x62, 0x62, 0xff, 0xf4, 0x45, 0xa6,\n    0x25, 0x2f, 0x67, 0xf6, 0xbf, 0xff, 0x8e, 0x20,\n    0xac, 0xda, 0x60, 0xfe, 0x6a, 0x9a, 0x06, 0x10,\n    0xd1, 0x04, 0x18, 0x0a, 0xff, 0x80, 0x00, 0x80,\n    0x3b, 0x77, 0x00, 0xef, 0xe0, 0x10, 0xb0, 0xe0,\n    0x10, 0x4f, 0x0f, 0x0f, 0x05, 0x0f, 0x08, 0x6e,\n    0x1a, 0x1f, 0x25, 0x2a, 0x4c, 0xaa, 0x01\n};\n\nstatic const unsigned char SiS_HiTVGroup3_2[] = {\n    0x00, 0x14, 0x15, 0x25, 0x55, 0x15, 0x0b, 0x7a,\n    0x54, 0x41, 0xe7, 0xe7, 0xff, 0xf4, 0x45, 0xa6,\n    0x25, 0x2f, 0x67, 0xf6, 0xbf, 0xff, 0x8e, 0x20,\n    0xac, 0x6a, 0x60, 0x2b, 0x52, 0xcd, 0x61, 0x10,\n    0x51, 0x04, 0x18, 0x0a, 0x1f, 0x80, 0x00, 0x80,\n    0xff, 0xa4, 0x04, 0x2b, 0x94, 0x21, 0x72, 0x94,\n    0x26, 0x05, 0x01, 0x0f, 0xed, 0x0f, 0x0a, 0x64,\n    0x18, 0x1d, 0x23, 0x28, 0x4c, 0xaa, 0x01\n};\n\n \n\nstatic const unsigned char SiS_Part2CLVX_1[] = {\n    0x00,0x00,\n    0x00,0x20,0x00,0x00,0x7F,0x20,0x02,0x7F,0x7D,0x20,0x04,0x7F,0x7D,0x1F,0x06,0x7E,\n    0x7C,0x1D,0x09,0x7E,0x7C,0x1B,0x0B,0x7E,0x7C,0x19,0x0E,0x7D,0x7C,0x17,0x11,0x7C,\n    0x7C,0x14,0x14,0x7C,0x7C,0x11,0x17,0x7C,0x7D,0x0E,0x19,0x7C,0x7E,0x0B,0x1B,0x7C,\n    0x7E,0x09,0x1D,0x7C,0x7F,0x06,0x1F,0x7C,0x7F,0x04,0x20,0x7D,0x00,0x02,0x20,0x7E\n};\n\nstatic const unsigned char SiS_Part2CLVX_2[] = {\n    0x00,0x00,\n    0x00,0x20,0x00,0x00,0x7F,0x20,0x02,0x7F,0x7D,0x20,0x04,0x7F,0x7D,0x1F,0x06,0x7E,\n    0x7C,0x1D,0x09,0x7E,0x7C,0x1B,0x0B,0x7E,0x7C,0x19,0x0E,0x7D,0x7C,0x17,0x11,0x7C,\n    0x7C,0x14,0x14,0x7C,0x7C,0x11,0x17,0x7C,0x7D,0x0E,0x19,0x7C,0x7E,0x0B,0x1B,0x7C,\n    0x7E,0x09,0x1D,0x7C,0x7F,0x06,0x1F,0x7C,0x7F,0x04,0x20,0x7D,0x00,0x02,0x20,0x7E\n};\n\nstatic const unsigned char SiS_Part2CLVX_3[] = {   \n    0xE0,0x01,\n    0x04,0x1A,0x04,0x7E,0x03,0x1A,0x06,0x7D,0x01,0x1A,0x08,0x7D,0x00,0x19,0x0A,0x7D,\n    0x7F,0x19,0x0C,0x7C,0x7E,0x18,0x0E,0x7C,0x7E,0x17,0x10,0x7B,0x7D,0x15,0x12,0x7C,\n    0x7D,0x13,0x13,0x7D,0x7C,0x12,0x15,0x7D,0x7C,0x10,0x17,0x7D,0x7C,0x0E,0x18,0x7E,\n    0x7D,0x0C,0x19,0x7E,0x7D,0x0A,0x19,0x00,0x7D,0x08,0x1A,0x01,0x7E,0x06,0x1A,0x02,\n    0x58,0x02,\n    0x07,0x14,0x07,0x7E,0x06,0x14,0x09,0x7D,0x05,0x14,0x0A,0x7D,0x04,0x13,0x0B,0x7E,\n    0x03,0x13,0x0C,0x7E,0x02,0x12,0x0D,0x7F,0x01,0x12,0x0E,0x7F,0x01,0x11,0x0F,0x7F,\n    0x00,0x10,0x10,0x00,0x7F,0x0F,0x11,0x01,0x7F,0x0E,0x12,0x01,0x7E,0x0D,0x12,0x03,\n    0x7E,0x0C,0x13,0x03,0x7E,0x0B,0x13,0x04,0x7E,0x0A,0x14,0x04,0x7D,0x09,0x14,0x06,\n    0x00,0x03,\n    0x09,0x0F,0x09,0x7F,0x08,0x0F,0x09,0x00,0x07,0x0F,0x0A,0x00,0x06,0x0F,0x0A,0x01,\n    0x06,0x0E,0x0B,0x01,0x05,0x0E,0x0B,0x02,0x04,0x0E,0x0C,0x02,0x04,0x0D,0x0C,0x03,\n    0x03,0x0D,0x0D,0x03,0x02,0x0C,0x0D,0x05,0x02,0x0C,0x0E,0x04,0x01,0x0B,0x0E,0x06,\n    0x01,0x0B,0x0E,0x06,0x00,0x0A,0x0F,0x07,0x00,0x0A,0x0F,0x07,0x00,0x09,0x0F,0x08,\n    0xFF,0xFF\n};\n\nstatic const unsigned char SiS_Part2CLVX_4[] = {    \n    0x58,0x02,\n    0x05,0x19,0x05,0x7D,0x03,0x19,0x06,0x7E,0x02,0x19,0x08,0x7D,0x01,0x18,0x0A,0x7D,\n    0x00,0x18,0x0C,0x7C,0x7F,0x17,0x0E,0x7C,0x7E,0x16,0x0F,0x7D,0x7E,0x14,0x11,0x7D,\n    0x7D,0x13,0x13,0x7D,0x7D,0x11,0x14,0x7E,0x7D,0x0F,0x16,0x7E,0x7D,0x0E,0x17,0x7E,\n    0x7D,0x0C,0x18,0x7F,0x7D,0x0A,0x18,0x01,0x7D,0x08,0x19,0x02,0x7D,0x06,0x19,0x04,\n    0x00,0x03,\n    0x08,0x12,0x08,0x7E,0x07,0x12,0x09,0x7E,0x06,0x12,0x0A,0x7E,0x05,0x11,0x0B,0x7F,\n    0x04,0x11,0x0C,0x7F,0x03,0x11,0x0C,0x00,0x03,0x10,0x0D,0x00,0x02,0x0F,0x0E,0x01,\n    0x01,0x0F,0x0F,0x01,0x01,0x0E,0x0F,0x02,0x00,0x0D,0x10,0x03,0x7F,0x0C,0x11,0x04,\n    0x7F,0x0C,0x11,0x04,0x7F,0x0B,0x11,0x05,0x7E,0x0A,0x12,0x06,0x7E,0x09,0x12,0x07,\n    0x40,0x02,\n    0x04,0x1A,0x04,0x7E,0x02,0x1B,0x05,0x7E,0x01,0x1A,0x07,0x7E,0x00,0x1A,0x09,0x7D,\n    0x7F,0x19,0x0B,0x7D,0x7E,0x18,0x0D,0x7D,0x7D,0x17,0x10,0x7C,0x7D,0x15,0x12,0x7C,\n    0x7C,0x14,0x14,0x7C,0x7C,0x12,0x15,0x7D,0x7C,0x10,0x17,0x7D,0x7C,0x0D,0x18,0x7F,\n    0x7D,0x0B,0x19,0x7F,0x7D,0x09,0x1A,0x00,0x7D,0x07,0x1A,0x02,0x7E,0x05,0x1B,0x02,\n    0xFF,0xFF\n};\n\nstatic const unsigned char SiS_Part2CLVX_5[] = {    \n    0x00,0x03,\n    0x05,0x19,0x05,0x7D,0x03,0x19,0x06,0x7E,0x02,0x19,0x08,0x7D,0x01,0x18,0x0A,0x7D,\n    0x00,0x18,0x0C,0x7C,0x7F,0x17,0x0E,0x7C,0x7E,0x16,0x0F,0x7D,0x7E,0x14,0x11,0x7D,\n    0x7D,0x13,0x13,0x7D,0x7D,0x11,0x14,0x7E,0x7D,0x0F,0x16,0x7E,0x7D,0x0E,0x17,0x7E,\n    0x7D,0x0C,0x18,0x7F,0x7D,0x0A,0x18,0x01,0x7D,0x08,0x19,0x02,0x7D,0x06,0x19,0x04,\n    0xFF,0xFF\n};\n\nstatic const unsigned char SiS_Part2CLVX_6[] = {    \n    0x00,0x04,\n    0x04,0x1A,0x04,0x7E,0x02,0x1B,0x05,0x7E,0x01,0x1A,0x07,0x7E,0x00,0x1A,0x09,0x7D,\n    0x7F,0x19,0x0B,0x7D,0x7E,0x18,0x0D,0x7D,0x7D,0x17,0x10,0x7C,0x7D,0x15,0x12,0x7C,\n    0x7C,0x14,0x14,0x7C,0x7C,0x12,0x15,0x7D,0x7C,0x10,0x17,0x7D,0x7C,0x0D,0x18,0x7F,\n    0x7D,0x0B,0x19,0x7F,0x7D,0x09,0x1A,0x00,0x7D,0x07,0x1A,0x02,0x7E,0x05,0x1B,0x02,\n    0xFF,0xFF,\n};\n\n#ifdef CONFIG_FB_SIS_315\n \nstatic const unsigned char SiS_LCDStruct661[] = {\n     \n \n    0x02,0xC0,0x00,0x04,0x00,0x03,0x40,0x05,0x26,0x03,0x10,0x00,0x88,\n    0x00,0x02,0x00,0x06,0x00,0x41,0x5A,0x64,0x00,0x00,0x00,0x00,0x04,\n     \n     \n     \n    0x03,0xC0,0x00,0x05,0x00,0x04,0x98,0x06,0x2A,0x04,0x30,0x00,0x70,\n    0x00,0x01,0x00,0x03,0x00,0x6C,0xF8,0x2F,0x00,0x00,0x00,0x00,0x08,\n     \n    0x09,0x20,0x78,0x05,0x1A,0x04,0x98,0x06,0x2A,0x04,0x18,0x00,0x38,\n    0x00,0x01,0x00,0x03,0x00,0x6C,0xF8,0x2F,0x00,0x00,0x00,0x00,0x09,\n     \n    0x0B,0xE0,0x40,0x06,0xB0,0x04,0x70,0x08,0xE2,0x04,0x40,0x00,0xC0,\n    0x00,0x01,0x00,0x03,0x00,0xA2,0x70,0x24,0x00,0x00,0x00,0x00,0x0A,\n     \n    0x0A,0xE0,0x00,0x05,0x00,0x03,0x7C,0x06,0x26,0x03,0x30,0x00,0x70,\n    0x00,0x03,0x00,0x06,0x00,0x4D,0xC8,0x48,0x00,0x00,0x00,0x00,0x06,\n     \n    0x0E,0xE0,0x00,0x05,0xD0,0x02,0x80,0x05,0x26,0x03,0x10,0x00,0x20,\n    0x00,0x01,0x00,0x06,0x00,0x45,0x9C,0x62,0x00,0x00,0x00,0x00,0x05,\n     \n    0x0C,0xE0,0x00,0x05,0x20,0x03,0x10,0x06,0x2C,0x03,0x30,0x00,0x70,\n    0x00,0x04,0x00,0x03,0x00,0x49,0xCE,0x1E,0x00,0x00,0x00,0x00,0x09,\n     \n    0x0D,0xE0,0x90,0x06,0x1A,0x04,0x6C,0x07,0x2A,0x04,0x1A,0x00,0x4C,\n    0x00,0x03,0x00,0x06,0x00,0x79,0xBE,0x44,0x00,0x00,0x00,0x00,0x06,\n     \n    0x0C,0xE0,0x00,0x05,0x20,0x03,0xAA,0x05,0x2E,0x03,0x30,0x00,0x50,\n    0x00,0x04,0x00,0x03,0x00,0x47,0xA9,0x10,0x00,0x00,0x00,0x00,0x07,\n     \n    0x01,0xC0,0x20,0x03,0x58,0x02,0x20,0x04,0x74,0x02,0x2A,0x00,0x80,\n    0x00,0x06,0x00,0x04,0x00,0x28,0x63,0x4B,0x00,0x00,0x00,0x00,0x00,\n     \n    0x08,0xE0,0x00,0x05,0x56,0x03,0x80,0x06,0x5d,0x03,0x10,0x00,0x70,\n    0x00,0x01,0x00,0x03,0x00,0x54,0x75,0x13,0x00,0x00,0x00,0x00,0x08\n};\n#endif\n\n#ifdef CONFIG_FB_SIS_300\nstatic unsigned char SiS300_TrumpionData[14][80] = {\n  { 0x02,0x0A,0x0A,0x01,0x04,0x01,0x00,0x03,0x0D,0x00,0x0D,0x10,0x7F,0x00,0x80,0x02,\n    0x20,0x03,0x0B,0x00,0x90,0x01,0xC1,0x01,0x60,0x0C,0x30,0x10,0x00,0x00,0x04,0x23,\n    0x00,0x00,0x03,0x28,0x03,0x10,0x05,0x08,0x40,0x10,0x00,0x10,0x04,0x23,0x00,0x23,\n    0x03,0x11,0x60,0xBC,0x01,0xFF,0x03,0xFF,0x19,0x01,0x00,0x05,0x09,0x04,0x04,0x05,\n    0x04,0x0C,0x09,0x05,0x02,0xB0,0x00,0x00,0x02,0xBA,0xF0,0x5A,0x01,0xBE,0x01,0x00 },\n  { 0x02,0x0A,0x0A,0x01,0x04,0x01,0x00,0x03,0x0D,0x00,0x0D,0x10,0x27,0x00,0x80,0x02,\n    0x20,0x03,0x07,0x00,0x5E,0x01,0x0D,0x02,0x60,0x0C,0x30,0x11,0x00,0x00,0x04,0x23,\n    0x00,0x00,0x03,0x80,0x03,0x28,0x06,0x08,0x40,0x11,0x00,0x11,0x04,0x23,0x00,0x23,\n    0x03,0x11,0x60,0x90,0x01,0xFF,0x0F,0xF4,0x19,0x01,0x00,0x05,0x01,0x00,0x04,0x05,\n    0x04,0x0C,0x02,0x01,0x02,0xB0,0x00,0x00,0x02,0xBA,0xEC,0x57,0x01,0xBE,0x01,0x00 },\n  { 0x02,0x0A,0x0A,0x01,0x04,0x01,0x00,0x03,0x0D,0x00,0x0D,0x10,0x8A,0x00,0xD8,0x02,\n    0x84,0x03,0x16,0x00,0x90,0x01,0xC1,0x01,0x60,0x0C,0x30,0x1C,0x00,0x20,0x04,0x23,\n    0x00,0x01,0x03,0x53,0x03,0x28,0x06,0x08,0x40,0x1C,0x00,0x16,0x04,0x23,0x00,0x23,\n    0x03,0x11,0x60,0xD9,0x01,0xFF,0x0F,0xF4,0x18,0x07,0x05,0x05,0x13,0x04,0x04,0x05,\n    0x01,0x0B,0x13,0x0A,0x02,0xB0,0x00,0x00,0x02,0xBA,0xF0,0x59,0x01,0xBE,0x01,0x00 },\n  { 0x02,0x0A,0x0A,0x01,0x04,0x01,0x00,0x03,0x0D,0x00,0x0D,0x10,0x72,0x00,0xD8,0x02,\n    0x84,0x03,0x16,0x00,0x90,0x01,0xC1,0x01,0x60,0x0C,0x30,0x1C,0x00,0x20,0x04,0x23,\n    0x00,0x01,0x03,0x53,0x03,0x28,0x06,0x08,0x40,0x1C,0x00,0x16,0x04,0x23,0x00,0x23,\n    0x03,0x11,0x60,0xDA,0x01,0xFF,0x0F,0xF4,0x18,0x07,0x05,0x05,0x13,0x04,0x04,0x05,\n    0x01,0x0B,0x13,0x0A,0x02,0xB0,0x00,0x00,0x02,0xBA,0xF0,0x55,0x01,0xBE,0x01,0x00 },\n  { 0x02,0x0A,0x02,0x00,0x04,0x01,0x00,0x03,0x0D,0x00,0x0D,0x10,0x7F,0x00,0x80,0x02,\n    0x20,0x03,0x16,0x00,0xE0,0x01,0x0D,0x02,0x60,0x0C,0x30,0x98,0x00,0x00,0x04,0x23,\n    0x00,0x01,0x03,0x45,0x03,0x48,0x06,0x08,0x40,0x98,0x00,0x98,0x04,0x23,0x00,0x23,\n    0x03,0x11,0x60,0xF4,0x01,0xFF,0x0F,0xF4,0x18,0x01,0x00,0x05,0x01,0x00,0x05,0x05,\n    0x04,0x0C,0x08,0x05,0x02,0xB0,0x00,0x00,0x02,0xBA,0xF0,0x5B,0x01,0xBE,0x01,0x00 },\n  { 0x02,0x0A,0x02,0x01,0x04,0x01,0x00,0x03,0x0D,0x00,0x0D,0x10,0xBF,0x00,0x20,0x03,\n    0x20,0x04,0x0D,0x00,0x58,0x02,0x71,0x02,0x80,0x0C,0x30,0x9A,0x00,0xFA,0x03,0x1D,\n    0x00,0x01,0x03,0x22,0x03,0x28,0x06,0x08,0x40,0x98,0x00,0x98,0x04,0x1D,0x00,0x1D,\n    0x03,0x11,0x60,0x39,0x03,0x40,0x05,0xF4,0x18,0x07,0x02,0x06,0x04,0x01,0x06,0x0B,\n    0x02,0x0A,0x20,0x19,0x02,0xB0,0x00,0x00,0x02,0xBA,0xF0,0x5B,0x01,0xBE,0x01,0x00 },\n  { 0x02,0x0A,0x0A,0x01,0x04,0x01,0x00,0x03,0x0D,0x00,0x0D,0x10,0xEF,0x00,0x00,0x04,\n    0x40,0x05,0x13,0x00,0x00,0x03,0x26,0x03,0x88,0x0C,0x30,0x90,0x00,0x00,0x04,0x23,\n    0x00,0x01,0x03,0x24,0x03,0x28,0x06,0x08,0x40,0x90,0x00,0x90,0x04,0x23,0x00,0x23,\n    0x03,0x11,0x60,0x40,0x05,0xFF,0x0F,0xF4,0x18,0x01,0x00,0x08,0x01,0x00,0x08,0x01,\n    0x00,0x08,0x01,0x01,0x02,0xB0,0x00,0x00,0x02,0xBA,0xF0,0x5B,0x01,0xBE,0x01,0x00 },\n   \n  { 0x02,0x0A,0x0A,0x01,0x04,0x01,0x00,0x03,0x11,0x00,0x0D,0x10,0x7F,0x00,0x80,0x02,\n    0x20,0x03,0x15,0x00,0x90,0x01,0xC1,0x01,0x60,0x0C,0x30,0x18,0x00,0x00,0x04,0x23,\n    0x00,0x01,0x03,0x44,0x03,0x28,0x06,0x08,0x40,0x18,0x00,0x18,0x04,0x23,0x00,0x23,\n    0x03,0x11,0x60,0xA6,0x01,0xFF,0x03,0xFF,0x19,0x01,0x00,0x05,0x13,0x04,0x04,0x05,\n    0x04,0x0C,0x13,0x0A,0x02,0xB0,0x00,0x00,0x02,0xBA,0xF0,0x55,0x01,0xBE,0x01,0x00 },\n  { 0x02,0x0A,0x0A,0x01,0x04,0x01,0x00,0x03,0x11,0x00,0x0D,0x10,0x7F,0x00,0x80,0x02,\n    0x20,0x03,0x15,0x00,0x90,0x01,0xC1,0x01,0x60,0x0C,0x30,0x18,0x00,0x00,0x04,0x23,\n    0x00,0x01,0x03,0x44,0x03,0x28,0x06,0x08,0x40,0x18,0x00,0x18,0x04,0x23,0x00,0x23,\n    0x03,0x11,0x60,0xA6,0x01,0xFF,0x03,0xFF,0x19,0x01,0x00,0x05,0x13,0x04,0x04,0x05,\n    0x04,0x0C,0x13,0x0A,0x02,0xB0,0x00,0x00,0x02,0xBA,0xF0,0x55,0x01,0xBE,0x01,0x00 },\n  { 0x02,0x0A,0x0A,0x01,0x04,0x01,0x00,0x03,0x11,0x00,0x0D,0x10,0x8A,0x00,0xD8,0x02,\n    0x84,0x03,0x16,0x00,0x90,0x01,0xC1,0x01,0x60,0x0C,0x30,0x1C,0x00,0x20,0x04,0x23,\n    0x00,0x01,0x03,0x53,0x03,0x28,0x06,0x08,0x40,0x1C,0x00,0x16,0x04,0x23,0x00,0x23,\n    0x03,0x11,0x60,0xDA,0x01,0xFF,0x0F,0xF4,0x18,0x07,0x05,0x05,0x13,0x04,0x04,0x05,\n    0x01,0x0B,0x13,0x0A,0x02,0xB0,0x00,0x00,0x02,0xBA,0xF0,0x55,0x01,0xBE,0x01,0x00 },\n  { 0x02,0x0A,0x0A,0x01,0x04,0x01,0x00,0x03,0x11,0x00,0x0D,0x10,0x72,0x00,0xD8,0x02,\n    0x84,0x03,0x16,0x00,0x90,0x01,0xC1,0x01,0x60,0x0C,0x30,0x1C,0x00,0x20,0x04,0x23,\n    0x00,0x01,0x03,0x53,0x03,0x28,0x06,0x08,0x40,0x1C,0x00,0x16,0x04,0x23,0x00,0x23,\n    0x03,0x11,0x60,0xDA,0x01,0xFF,0x0F,0xF4,0x18,0x07,0x05,0x05,0x13,0x04,0x04,0x05,\n    0x01,0x0B,0x13,0x0A,0x02,0xB0,0x00,0x00,0x02,0xBA,0xF0,0x55,0x01,0xBE,0x01,0x00 },\n  { 0x02,0x0A,0x02,0x00,0x04,0x01,0x00,0x03,0x11,0x00,0x0D,0x10,0x7F,0x00,0x80,0x02,\n    0x20,0x03,0x16,0x00,0xE0,0x01,0x0D,0x02,0x60,0x0C,0x30,0x98,0x00,0x00,0x04,0x23,\n    0x00,0x01,0x03,0x45,0x03,0x48,0x06,0x08,0x40,0x98,0x00,0x98,0x04,0x23,0x00,0x23,\n    0x03,0x11,0x60,0xF4,0x01,0xFF,0x0F,0xF4,0x18,0x01,0x00,0x05,0x01,0x00,0x05,0x05,\n    0x04,0x0C,0x08,0x05,0x02,0xB0,0x00,0x00,0x02,0xBA,0xEA,0x58,0x01,0xBE,0x01,0x00 },\n  { 0x02,0x0A,0x02,0x01,0x04,0x01,0x00,0x03,0x11,0x00,0x0D,0x10,0xBF,0x00,0x20,0x03,\n    0x20,0x04,0x0D,0x00,0x58,0x02,0x71,0x02,0x80,0x0C,0x30,0x9A,0x00,0xFA,0x03,0x1D,\n    0x00,0x01,0x03,0x22,0x03,0x28,0x06,0x08,0x40,0x98,0x00,0x98,0x04,0x1D,0x00,0x1D,\n    0x03,0x11,0x60,0x39,0x03,0x40,0x05,0xF4,0x18,0x07,0x02,0x06,0x04,0x01,0x06,0x0B,\n    0x02,0x0A,0x20,0x19,0x02,0xB0,0x00,0x00,0x02,0xBA,0xEA,0x58,0x01,0xBE,0x01,0x00 },\n  { 0x02,0x0A,0x0A,0x01,0x04,0x01,0x00,0x03,0x11,0x00,0x0D,0x10,0xEF,0x00,0x00,0x04,\n    0x40,0x05,0x13,0x00,0x00,0x03,0x26,0x03,0x88,0x0C,0x30,0x90,0x00,0x00,0x04,0x23,\n    0x00,0x01,0x03,0x24,0x03,0x28,0x06,0x08,0x40,0x90,0x00,0x90,0x04,0x23,0x00,0x23,\n    0x03,0x11,0x60,0x40,0x05,0xFF,0x0F,0xF4,0x18,0x01,0x00,0x08,0x01,0x00,0x08,0x01,\n    0x00,0x08,0x01,0x01,0x02,0xB0,0x00,0x00,0x02,0xBA,0xEA,0x58,0x01,0xBE,0x01,0x00 }\n};\n#endif\n\n#ifdef CONFIG_FB_SIS_315\nstatic void\tSiS_Chrontel701xOn(struct SiS_Private *SiS_Pr);\nstatic void\tSiS_Chrontel701xOff(struct SiS_Private *SiS_Pr);\nstatic void\tSiS_ChrontelInitTVVSync(struct SiS_Private *SiS_Pr);\nstatic void\tSiS_ChrontelDoSomething1(struct SiS_Private *SiS_Pr);\n#endif  \n\n#ifdef CONFIG_FB_SIS_300\nstatic  bool\tSiS_SetTrumpionBlock(struct SiS_Private *SiS_Pr, unsigned char *dataptr);\n#endif\n\nstatic unsigned short\tSiS_InitDDCRegs(struct SiS_Private *SiS_Pr, unsigned int VBFlags,\n\t\t\t\tint VGAEngine, unsigned short adaptnum, unsigned short DDCdatatype,\n\t\t\t\tbool checkcr32, unsigned int VBFlags2);\nstatic unsigned short\tSiS_ProbeDDC(struct SiS_Private *SiS_Pr);\nstatic unsigned short\tSiS_ReadDDC(struct SiS_Private *SiS_Pr, unsigned short DDCdatatype,\n\t\t\t\tunsigned char *buffer);\nstatic void\t\tSiS_SetSwitchDDC2(struct SiS_Private *SiS_Pr);\nstatic unsigned short\tSiS_SetStart(struct SiS_Private *SiS_Pr);\nstatic unsigned short\tSiS_SetStop(struct SiS_Private *SiS_Pr);\nstatic unsigned short\tSiS_SetSCLKLow(struct SiS_Private *SiS_Pr);\nstatic unsigned short\tSiS_SetSCLKHigh(struct SiS_Private *SiS_Pr);\nstatic unsigned short\tSiS_ReadDDC2Data(struct SiS_Private *SiS_Pr);\nstatic unsigned short\tSiS_WriteDDC2Data(struct SiS_Private *SiS_Pr, unsigned short tempax);\nstatic unsigned short\tSiS_CheckACK(struct SiS_Private *SiS_Pr);\nstatic unsigned short\tSiS_WriteDABDDC(struct SiS_Private *SiS_Pr);\nstatic unsigned short\tSiS_PrepareReadDDC(struct SiS_Private *SiS_Pr);\nstatic unsigned short\tSiS_PrepareDDC(struct SiS_Private *SiS_Pr);\nstatic void\t\tSiS_SendACK(struct SiS_Private *SiS_Pr, unsigned short yesno);\nstatic unsigned short\tSiS_DoProbeDDC(struct SiS_Private *SiS_Pr);\n\n#ifdef CONFIG_FB_SIS_300\nstatic void\t\tSiS_OEM300Setting(struct SiS_Private *SiS_Pr,\n\t\t\t\tunsigned short ModeNo, unsigned short ModeIdIndex, unsigned short RefTabindex);\nstatic void\t\tSetOEMLCDData2(struct SiS_Private *SiS_Pr,\n\t\t\t\tunsigned short ModeNo, unsigned short ModeIdIndex,unsigned short RefTableIndex);\n#endif\n#ifdef CONFIG_FB_SIS_315\nstatic void\t\tSiS_OEM310Setting(struct SiS_Private *SiS_Pr,\n\t\t\t\tunsigned short ModeNo,unsigned short ModeIdIndex, unsigned short RRTI);\nstatic void\t\tSiS_OEM661Setting(struct SiS_Private *SiS_Pr,\n\t\t\t\tunsigned short ModeNo,unsigned short ModeIdIndex, unsigned short RRTI);\nstatic void\t\tSiS_FinalizeLCD(struct SiS_Private *, unsigned short, unsigned short);\n#endif\n\nstatic unsigned short\tSiS_GetBIOSLCDResInfo(struct SiS_Private *SiS_Pr);\nstatic void\t\tSiS_SetCH70xx(struct SiS_Private *SiS_Pr, unsigned short reg, unsigned char val);\n\n \n \n \n\nvoid\nSiS_UnLockCRT2(struct SiS_Private *SiS_Pr)\n{\n   if(SiS_Pr->ChipType == XGI_20)\n      return;\n   else if(SiS_Pr->ChipType >= SIS_315H)\n      SiS_SetRegOR(SiS_Pr->SiS_Part1Port,0x2f,0x01);\n   else\n      SiS_SetRegOR(SiS_Pr->SiS_Part1Port,0x24,0x01);\n}\n\nstatic\nvoid\nSiS_LockCRT2(struct SiS_Private *SiS_Pr)\n{\n   if(SiS_Pr->ChipType == XGI_20)\n      return;\n   else if(SiS_Pr->ChipType >= SIS_315H)\n      SiS_SetRegAND(SiS_Pr->SiS_Part1Port,0x2F,0xFE);\n   else\n      SiS_SetRegAND(SiS_Pr->SiS_Part1Port,0x24,0xFE);\n}\n\n \n \n \n\nstatic void\nSiS_SetRegSR11ANDOR(struct SiS_Private *SiS_Pr, unsigned short DataAND, unsigned short DataOR)\n{\n   if(SiS_Pr->ChipType >= SIS_661) {\n      DataAND &= 0x0f;\n      DataOR  &= 0x0f;\n   }\n   SiS_SetRegANDOR(SiS_Pr->SiS_P3c4,0x11,DataAND,DataOR);\n}\n\n \n \n \n\n#ifdef CONFIG_FB_SIS_315\nstatic unsigned char *\nGetLCDStructPtr661(struct SiS_Private *SiS_Pr)\n{\n   unsigned char  *ROMAddr = SiS_Pr->VirtualRomBase;\n   unsigned char  *myptr = NULL;\n   unsigned short romindex = 0, reg = 0, idx = 0;\n\n    \n\n   if((SiS_Pr->SiS_ROMNew) &&\n      ((SiS_Pr->SiS_VBType & VB_SISLVDS) || (!SiS_Pr->PanelSelfDetected))) {\n\n      if(SiS_Pr->ChipType < SIS_661) reg = 0x3c;\n      else                           reg = 0x7d;\n\n      idx = (SiS_GetReg(SiS_Pr->SiS_P3d4,reg) & 0x1f) * 26;\n\n      if(idx < (8*26)) {\n         myptr = (unsigned char *)&SiS_LCDStruct661[idx];\n      }\n      romindex = SISGETROMW(0x100);\n      if(romindex) {\n         romindex += idx;\n         myptr = &ROMAddr[romindex];\n      }\n   }\n   return myptr;\n}\n\nstatic unsigned short\nGetLCDStructPtr661_2(struct SiS_Private *SiS_Pr)\n{\n   unsigned char  *ROMAddr = SiS_Pr->VirtualRomBase;\n   unsigned short romptr = 0;\n\n    \n\n   if((SiS_Pr->SiS_ROMNew) &&\n      ((SiS_Pr->SiS_VBType & VB_SISLVDS) || (!SiS_Pr->PanelSelfDetected))) {\n      romptr = SISGETROMW(0x102);\n      romptr += ((SiS_GetReg(SiS_Pr->SiS_P3d4,0x36) >> 4) * SiS_Pr->SiS661LCD2TableSize);\n   }\n\n   return romptr;\n}\n#endif\n\n \n \n \n\nstatic bool\nSiS_AdjustCRT2Rate(struct SiS_Private *SiS_Pr, unsigned short ModeNo, unsigned short ModeIdIndex,\n\t\tunsigned short RRTI, unsigned short *i)\n{\n   unsigned short checkmask=0, modeid, infoflag;\n\n   modeid = SiS_Pr->SiS_RefIndex[RRTI + (*i)].ModeID;\n\n   if(SiS_Pr->SiS_VBType & VB_SISVB) {\n\n      if(SiS_Pr->SiS_VBInfo & SetCRT2ToRAMDAC) {\n\n\t checkmask |= SupportRAMDAC2;\n\t if(SiS_Pr->ChipType >= SIS_315H) {\n\t    checkmask |= SupportRAMDAC2_135;\n\t    if(SiS_Pr->SiS_VBType & VB_SIS30xBLV) {\n\t       checkmask |= SupportRAMDAC2_162;\n\t       if(SiS_Pr->SiS_VBType & VB_SISRAMDAC202) {\n\t\t  checkmask |= SupportRAMDAC2_202;\n\t       }\n\t    }\n\t }\n\n      } else if(SiS_Pr->SiS_VBInfo & (SetCRT2ToLCD | SetCRT2ToLCDA)) {\n\n\t checkmask |= SupportLCD;\n\t if(SiS_Pr->ChipType >= SIS_315H) {\n\t    if(SiS_Pr->SiS_VBType & VB_SISVB) {\n\t       if((SiS_Pr->SiS_LCDInfo & DontExpandLCD) && (SiS_Pr->SiS_LCDInfo & LCDPass11)) {\n\t          if(modeid == 0x2e) checkmask |= Support64048060Hz;\n\t       }\n\t    }\n\t }\n\n      } else if(SiS_Pr->SiS_VBInfo & SetCRT2ToHiVision) {\n\n\t checkmask |= SupportHiVision;\n\n      } else if(SiS_Pr->SiS_VBInfo & (SetCRT2ToYPbPr525750|SetCRT2ToAVIDEO|SetCRT2ToSVIDEO|SetCRT2ToSCART)) {\n\n\t checkmask |= SupportTV;\n\t if(SiS_Pr->SiS_VBType & VB_SIS30xBLV) {\n\t    checkmask |= SupportTV1024;\n\t    if(SiS_Pr->SiS_VBInfo & SetCRT2ToYPbPr525750) {\n\t       if(SiS_Pr->SiS_TVMode & TVSetYPbPr750p) {\n\t          checkmask |= SupportYPbPr750p;\n\t       }\n\t    }\n\t }\n\n      }\n\n   } else {\t \n\n      if(SiS_Pr->SiS_IF_DEF_CH70xx != 0) {\n\t if(SiS_Pr->SiS_VBInfo & SetCRT2ToTV) {\n\t    checkmask |= SupportCHTV;\n\t }\n      }\n\n      if(SiS_Pr->SiS_VBInfo & SetCRT2ToLCD) {\n\t checkmask |= SupportLCD;\n      }\n\n   }\n\n    \n   for(; SiS_Pr->SiS_RefIndex[RRTI + (*i)].ModeID == modeid; (*i)--) {\n      infoflag = SiS_Pr->SiS_RefIndex[RRTI + (*i)].Ext_InfoFlag;\n      if(infoflag & checkmask) return true;\n      if((*i) == 0) break;\n   }\n\n    \n   for((*i) = 0; ; (*i)++) {\n      if(SiS_Pr->SiS_RefIndex[RRTI + (*i)].ModeID != modeid) break;\n      infoflag = SiS_Pr->SiS_RefIndex[RRTI + (*i)].Ext_InfoFlag;\n      if(infoflag & checkmask) return true;\n   }\n   return false;\n}\n\n \n \n \n\nunsigned short\nSiS_GetRatePtr(struct SiS_Private *SiS_Pr, unsigned short ModeNo, unsigned short ModeIdIndex)\n{\n   unsigned short RRTI,i,backup_i;\n   unsigned short modeflag,index,temp,backupindex;\n   static const unsigned short LCDRefreshIndex[] = {\n\t\t0x00, 0x00, 0x01, 0x01,\n\t\t0x01, 0x01, 0x01, 0x01,\n\t\t0x01, 0x01, 0x01, 0x01,\n\t\t0x01, 0x01, 0x01, 0x01,\n\t\t0x00, 0x00, 0x00, 0x00\n   };\n\n    \n   if(ModeNo == 0xfe) return 0;\n\n   if(ModeNo <= 0x13) {\n      modeflag = SiS_Pr->SiS_SModeIDTable[ModeIdIndex].St_ModeFlag;\n   } else {\n      modeflag = SiS_Pr->SiS_EModeIDTable[ModeIdIndex].Ext_ModeFlag;\n   }\n\n   if(SiS_Pr->SiS_IF_DEF_CH70xx != 0) {\n      if(SiS_Pr->SiS_VBInfo & SetCRT2ToTV) {\n\t if(modeflag & HalfDCLK) return 0;\n      }\n   }\n\n   if(ModeNo < 0x14) return 0xFFFF;\n\n   index = (SiS_GetReg(SiS_Pr->SiS_P3d4,0x33) >> SiS_Pr->SiS_SelectCRT2Rate) & 0x0F;\n   backupindex = index;\n\n   if(index > 0) index--;\n\n   if(SiS_Pr->SiS_SetFlag & ProgrammingCRT2) {\n      if(SiS_Pr->SiS_VBType & VB_SISVB) {\n\t if(SiS_Pr->SiS_VBInfo & SetCRT2ToLCD) {\n\t    if(SiS_Pr->SiS_VBType & VB_NoLCD)\t\t index = 0;\n\t    else if(SiS_Pr->SiS_LCDInfo & DontExpandLCD) index = backupindex = 0;\n\t }\n\t if(SiS_Pr->SiS_VBInfo & (SetCRT2ToLCD | SetCRT2ToLCDA)) {\n\t    if(!(SiS_Pr->SiS_VBType & VB_NoLCD)) {\n\t       temp = LCDRefreshIndex[SiS_GetBIOSLCDResInfo(SiS_Pr)];\n\t       if(index > temp) index = temp;\n\t    }\n\t }\n      } else {\n\t if(SiS_Pr->SiS_VBInfo & (SetCRT2ToLCD | SetCRT2ToLCDA)) index = 0;\n\t if(SiS_Pr->SiS_IF_DEF_CH70xx != 0) {\n\t    if(SiS_Pr->SiS_VBInfo & SetCRT2ToTV) index = 0;\n\t }\n      }\n   }\n\n   RRTI = SiS_Pr->SiS_EModeIDTable[ModeIdIndex].REFindex;\n   ModeNo = SiS_Pr->SiS_RefIndex[RRTI].ModeID;\n\n   if(SiS_Pr->ChipType >= SIS_315H) {\n      if(!(SiS_Pr->SiS_VBInfo & DriverMode)) {\n\t if( (SiS_Pr->SiS_EModeIDTable[ModeIdIndex].Ext_VESAID == 0x105) ||\n\t     (SiS_Pr->SiS_EModeIDTable[ModeIdIndex].Ext_VESAID == 0x107) ) {\n\t    if(backupindex <= 1) RRTI++;\n\t }\n      }\n   }\n\n   i = 0;\n   do {\n      if(SiS_Pr->SiS_RefIndex[RRTI + i].ModeID != ModeNo) break;\n      temp = SiS_Pr->SiS_RefIndex[RRTI + i].Ext_InfoFlag;\n      temp &= ModeTypeMask;\n      if(temp < SiS_Pr->SiS_ModeType) break;\n      i++;\n      index--;\n   } while(index != 0xFFFF);\n\n   if(!(SiS_Pr->SiS_VBInfo & SetCRT2ToRAMDAC)) {\n      if(SiS_Pr->SiS_VBInfo & SetInSlaveMode) {\n\t temp = SiS_Pr->SiS_RefIndex[RRTI + i - 1].Ext_InfoFlag;\n\t if(temp & InterlaceMode) i++;\n      }\n   }\n\n   i--;\n\n   if((SiS_Pr->SiS_SetFlag & ProgrammingCRT2) && (!(SiS_Pr->SiS_VBInfo & DisableCRT2Display))) {\n      backup_i = i;\n      if(!(SiS_AdjustCRT2Rate(SiS_Pr, ModeNo, ModeIdIndex, RRTI, &i))) {\n\t i = backup_i;\n      }\n   }\n\n   return (RRTI + i);\n}\n\n \n \n \n\nstatic void\nSiS_SaveCRT2Info(struct SiS_Private *SiS_Pr, unsigned short ModeNo)\n{\n   unsigned short temp1, temp2;\n\n    \n   SiS_SetReg(SiS_Pr->SiS_P3d4,0x34,ModeNo);\n   temp1 = (SiS_Pr->SiS_VBInfo & SetInSlaveMode) >> 8;\n   temp2 = ~(SetInSlaveMode >> 8);\n   SiS_SetRegANDOR(SiS_Pr->SiS_P3d4,0x31,temp2,temp1);\n}\n\n \n \n \n\n#ifdef CONFIG_FB_SIS_300\nstatic bool\nSiS_CR36BIOSWord23b(struct SiS_Private *SiS_Pr)\n{\n   unsigned char  *ROMAddr = SiS_Pr->VirtualRomBase;\n   unsigned short temp,temp1;\n\n   if(SiS_Pr->SiS_UseROM) {\n      if((ROMAddr[0x233] == 0x12) && (ROMAddr[0x234] == 0x34)) {\n\t temp = 1 << ((SiS_GetReg(SiS_Pr->SiS_P3d4,0x36) >> 4) & 0x0f);\n\t temp1 = SISGETROMW(0x23b);\n\t if(temp1 & temp) return true;\n      }\n   }\n   return false;\n}\n\nstatic bool\nSiS_CR36BIOSWord23d(struct SiS_Private *SiS_Pr)\n{\n   unsigned char  *ROMAddr = SiS_Pr->VirtualRomBase;\n   unsigned short temp,temp1;\n\n   if(SiS_Pr->SiS_UseROM) {\n      if((ROMAddr[0x233] == 0x12) && (ROMAddr[0x234] == 0x34)) {\n\t temp = 1 << ((SiS_GetReg(SiS_Pr->SiS_P3d4,0x36) >> 4) & 0x0f);\n\t temp1 = SISGETROMW(0x23d);\n\t if(temp1 & temp) return true;\n      }\n   }\n   return false;\n}\n#endif\n\n \n \n \n\nvoid\nSiS_DDC2Delay(struct SiS_Private *SiS_Pr, unsigned int delaytime)\n{\n   while (delaytime-- > 0)\n      SiS_GetReg(SiS_Pr->SiS_P3c4, 0x05);\n}\n\n#if defined(CONFIG_FB_SIS_300) || defined(CONFIG_FB_SIS_315)\nstatic void\nSiS_GenericDelay(struct SiS_Private *SiS_Pr, unsigned short delay)\n{\n   SiS_DDC2Delay(SiS_Pr, delay * 36);\n}\n#endif\n\n#ifdef CONFIG_FB_SIS_315\nstatic void\nSiS_LongDelay(struct SiS_Private *SiS_Pr, unsigned short delay)\n{\n   while(delay--) {\n      SiS_GenericDelay(SiS_Pr, 6623);\n   }\n}\n#endif\n\n#if defined(CONFIG_FB_SIS_300) || defined(CONFIG_FB_SIS_315)\nstatic void\nSiS_ShortDelay(struct SiS_Private *SiS_Pr, unsigned short delay)\n{\n   while(delay--) {\n      SiS_GenericDelay(SiS_Pr, 66);\n   }\n}\n#endif\n\nstatic void\nSiS_PanelDelay(struct SiS_Private *SiS_Pr, unsigned short DelayTime)\n{\n#if defined(CONFIG_FB_SIS_300) || defined(CONFIG_FB_SIS_315)\n   unsigned char  *ROMAddr = SiS_Pr->VirtualRomBase;\n   unsigned short PanelID, DelayIndex, Delay=0;\n#endif\n\n   if(SiS_Pr->ChipType < SIS_315H) {\n\n#ifdef CONFIG_FB_SIS_300\n\n      PanelID = SiS_GetReg(SiS_Pr->SiS_P3d4,0x36);\n      if(SiS_Pr->SiS_VBType & VB_SISVB) {\n\t if(SiS_Pr->SiS_VBType & VB_SIS301) PanelID &= 0xf7;\n\t if(!(SiS_GetReg(SiS_Pr->SiS_P3c4,0x18) & 0x10)) PanelID = 0x12;\n      }\n      DelayIndex = PanelID >> 4;\n      if((DelayTime >= 2) && ((PanelID & 0x0f) == 1))  {\n\t Delay = 3;\n      } else {\n\t if(DelayTime >= 2) DelayTime -= 2;\n\t if(!(DelayTime & 0x01)) {\n\t    Delay = SiS_Pr->SiS_PanelDelayTbl[DelayIndex].timer[0];\n\t } else {\n\t    Delay = SiS_Pr->SiS_PanelDelayTbl[DelayIndex].timer[1];\n\t }\n\t if(SiS_Pr->SiS_UseROM) {\n\t    if(ROMAddr[0x220] & 0x40) {\n\t       if(!(DelayTime & 0x01)) Delay = (unsigned short)ROMAddr[0x225];\n\t       else \t    \t       Delay = (unsigned short)ROMAddr[0x226];\n\t    }\n\t }\n      }\n      SiS_ShortDelay(SiS_Pr, Delay);\n\n#endif   \n\n   } else {\n\n#ifdef CONFIG_FB_SIS_315\n\n      if((SiS_Pr->ChipType >= SIS_661)    ||\n\t (SiS_Pr->ChipType <= SIS_315PRO) ||\n\t (SiS_Pr->ChipType == SIS_330)    ||\n\t (SiS_Pr->SiS_ROMNew)) {\n\n\t if(!(DelayTime & 0x01)) {\n\t    SiS_DDC2Delay(SiS_Pr, 0x1000);\n\t } else {\n\t    SiS_DDC2Delay(SiS_Pr, 0x4000);\n\t }\n\n      } else if (SiS_Pr->SiS_IF_DEF_LVDS == 1) {\t\t\t \n\n\t if(SiS_Pr->SiS_IF_DEF_CH70xx == 0) {\n\t    PanelID = SiS_GetReg(SiS_Pr->SiS_P3d4,0x36);\n\t    if(SiS_Pr->SiS_CustomT == CUT_CLEVO1400) {\n\t       if(!(SiS_GetReg(SiS_Pr->SiS_P3c4,0x1b) & 0x10)) PanelID = 0x12;\n\t    }\n\t    if(SiS_Pr->SiS_CustomT == CUT_COMPAQ1280) {\n\t       DelayIndex = PanelID & 0x0f;\n\t    } else {\n\t       DelayIndex = PanelID >> 4;\n\t    }\n\t    if((DelayTime >= 2) && ((PanelID & 0x0f) == 1))  {\n\t       Delay = 3;\n\t    } else {\n\t       if(DelayTime >= 2) DelayTime -= 2;\n\t       if(!(DelayTime & 0x01)) {\n\t\t  Delay = SiS_Pr->SiS_PanelDelayTblLVDS[DelayIndex].timer[0];\n\t\t} else {\n\t\t  Delay = SiS_Pr->SiS_PanelDelayTblLVDS[DelayIndex].timer[1];\n\t       }\n\t       if((SiS_Pr->SiS_UseROM) && (!(SiS_Pr->SiS_ROMNew))) {\n\t\t  if(ROMAddr[0x13c] & 0x40) {\n\t\t     if(!(DelayTime & 0x01)) {\n\t\t\tDelay = (unsigned short)ROMAddr[0x17e];\n\t\t     } else {\n\t\t\tDelay = (unsigned short)ROMAddr[0x17f];\n\t\t     }\n\t\t  }\n\t       }\n\t    }\n\t    SiS_ShortDelay(SiS_Pr, Delay);\n\t }\n\n      } else if(SiS_Pr->SiS_VBType & VB_SISVB) {\t\t\t \n\n\t DelayIndex = SiS_GetReg(SiS_Pr->SiS_P3d4,0x36) >> 4;\n\t if(!(DelayTime & 0x01)) {\n\t    Delay = SiS_Pr->SiS_PanelDelayTbl[DelayIndex].timer[0];\n\t } else {\n\t    Delay = SiS_Pr->SiS_PanelDelayTbl[DelayIndex].timer[1];\n\t }\n\t Delay <<= 8;\n\t SiS_DDC2Delay(SiS_Pr, Delay);\n\n      }\n\n#endif  \n\n   }\n}\n\n#ifdef CONFIG_FB_SIS_315\nstatic void\nSiS_PanelDelayLoop(struct SiS_Private *SiS_Pr, unsigned short DelayTime, unsigned short DelayLoop)\n{\n   int i;\n   for(i = 0; i < DelayLoop; i++) {\n      SiS_PanelDelay(SiS_Pr, DelayTime);\n   }\n}\n#endif\n\n \n \n \n\nvoid\nSiS_WaitRetrace1(struct SiS_Private *SiS_Pr)\n{\n   unsigned short watchdog;\n\n   if(SiS_GetReg(SiS_Pr->SiS_P3c4,0x1f) & 0xc0) return;\n   if(!(SiS_GetReg(SiS_Pr->SiS_P3d4,0x17) & 0x80)) return;\n\n   watchdog = 65535;\n   while((SiS_GetRegByte(SiS_Pr->SiS_P3da) & 0x08) && --watchdog);\n   watchdog = 65535;\n   while((!(SiS_GetRegByte(SiS_Pr->SiS_P3da) & 0x08)) && --watchdog);\n}\n\n#if defined(CONFIG_FB_SIS_300) || defined(CONFIG_FB_SIS_315)\nstatic void\nSiS_WaitRetrace2(struct SiS_Private *SiS_Pr, unsigned short reg)\n{\n   unsigned short watchdog;\n\n   watchdog = 65535;\n   while((SiS_GetReg(SiS_Pr->SiS_Part1Port,reg) & 0x02) && --watchdog);\n   watchdog = 65535;\n   while((!(SiS_GetReg(SiS_Pr->SiS_Part1Port,reg) & 0x02)) && --watchdog);\n}\n#endif\n\nstatic void\nSiS_WaitVBRetrace(struct SiS_Private *SiS_Pr)\n{\n   if(SiS_Pr->ChipType < SIS_315H) {\n#ifdef CONFIG_FB_SIS_300\n      if(SiS_Pr->SiS_VBType & VB_SIS30xBLV) {\n\t if(!(SiS_GetReg(SiS_Pr->SiS_Part1Port,0x00) & 0x20)) return;\n      }\n      if(!(SiS_GetReg(SiS_Pr->SiS_Part1Port,0x00) & 0x80)) {\n\t SiS_WaitRetrace1(SiS_Pr);\n      } else {\n\t SiS_WaitRetrace2(SiS_Pr, 0x25);\n      }\n#endif\n   } else {\n#ifdef CONFIG_FB_SIS_315\n      if(!(SiS_GetReg(SiS_Pr->SiS_Part1Port,0x00) & 0x40)) {\n\t SiS_WaitRetrace1(SiS_Pr);\n      } else {\n\t SiS_WaitRetrace2(SiS_Pr, 0x30);\n      }\n#endif\n   }\n}\n\nstatic void\nSiS_VBWait(struct SiS_Private *SiS_Pr)\n{\n   unsigned short tempal,temp,i,j;\n\n   temp = 0;\n   for(i = 0; i < 3; i++) {\n     for(j = 0; j < 100; j++) {\n        tempal = SiS_GetRegByte(SiS_Pr->SiS_P3da);\n        if(temp & 0x01) {\n\t   if((tempal & 0x08))  continue;\n\t   else break;\n        } else {\n\t   if(!(tempal & 0x08)) continue;\n\t   else break;\n        }\n     }\n     temp ^= 0x01;\n   }\n}\n\nstatic void\nSiS_VBLongWait(struct SiS_Private *SiS_Pr)\n{\n   if(SiS_Pr->SiS_VBInfo & SetCRT2ToTV) {\n      SiS_VBWait(SiS_Pr);\n   } else {\n      SiS_WaitRetrace1(SiS_Pr);\n   }\n}\n\n \n \n \n\n#ifdef CONFIG_FB_SIS_300\nstatic bool\nSiS_Is301B(struct SiS_Private *SiS_Pr)\n{\n   if(SiS_GetReg(SiS_Pr->SiS_Part4Port,0x01) >= 0xb0) return true;\n   return false;\n}\n#endif\n\nstatic bool\nSiS_CRT2IsLCD(struct SiS_Private *SiS_Pr)\n{\n   if(SiS_Pr->ChipType == SIS_730) {\n      if(SiS_GetReg(SiS_Pr->SiS_P3c4,0x13) & 0x20) return true;\n   }\n   if(SiS_GetReg(SiS_Pr->SiS_P3d4,0x30) & 0x20) return true;\n   return false;\n}\n\nbool\nSiS_IsDualEdge(struct SiS_Private *SiS_Pr)\n{\n#ifdef CONFIG_FB_SIS_315\n   if(SiS_Pr->ChipType >= SIS_315H) {\n      if((SiS_Pr->ChipType != SIS_650) || (SiS_GetReg(SiS_Pr->SiS_P3d4,0x5f) & 0xf0)) {\n\t if(SiS_GetReg(SiS_Pr->SiS_P3d4,0x38) & EnableDualEdge) return true;\n      }\n   }\n#endif\n   return false;\n}\n\nbool\nSiS_IsVAMode(struct SiS_Private *SiS_Pr)\n{\n#ifdef CONFIG_FB_SIS_315\n   unsigned short flag;\n\n   if(SiS_Pr->ChipType >= SIS_315H) {\n      flag = SiS_GetReg(SiS_Pr->SiS_P3d4,0x38);\n      if((flag & EnableDualEdge) && (flag & SetToLCDA)) return true;\n   }\n#endif\n   return false;\n}\n\n#ifdef CONFIG_FB_SIS_315\nstatic bool\nSiS_IsVAorLCD(struct SiS_Private *SiS_Pr)\n{\n   if(SiS_IsVAMode(SiS_Pr))  return true;\n   if(SiS_CRT2IsLCD(SiS_Pr)) return true;\n   return false;\n}\n#endif\n\nstatic bool\nSiS_IsDualLink(struct SiS_Private *SiS_Pr)\n{\n#ifdef CONFIG_FB_SIS_315\n   if(SiS_Pr->ChipType >= SIS_315H) {\n      if((SiS_CRT2IsLCD(SiS_Pr)) ||\n         (SiS_IsVAMode(SiS_Pr))) {\n\t if(SiS_Pr->SiS_LCDInfo & LCDDualLink) return true;\n      }\n   }\n#endif\n   return false;\n}\n\n#ifdef CONFIG_FB_SIS_315\nstatic bool\nSiS_TVEnabled(struct SiS_Private *SiS_Pr)\n{\n   if((SiS_GetReg(SiS_Pr->SiS_Part2Port,0x00) & 0x0f) != 0x0c) return true;\n   if(SiS_Pr->SiS_VBType & VB_SISYPBPR) {\n      if(SiS_GetReg(SiS_Pr->SiS_Part2Port,0x4d) & 0x10) return true;\n   }\n   return false;\n}\n#endif\n\n#ifdef CONFIG_FB_SIS_315\nstatic bool\nSiS_LCDAEnabled(struct SiS_Private *SiS_Pr)\n{\n   if(SiS_GetReg(SiS_Pr->SiS_Part1Port,0x13) & 0x04) return true;\n   return false;\n}\n#endif\n\n#ifdef CONFIG_FB_SIS_315\nstatic bool\nSiS_WeHaveBacklightCtrl(struct SiS_Private *SiS_Pr)\n{\n   if((SiS_Pr->ChipType >= SIS_315H) && (SiS_Pr->ChipType < SIS_661)) {\n      if(SiS_GetReg(SiS_Pr->SiS_P3d4,0x79) & 0x10) return true;\n   }\n   return false;\n}\n#endif\n\n#ifdef CONFIG_FB_SIS_315\nstatic bool\nSiS_IsNotM650orLater(struct SiS_Private *SiS_Pr)\n{\n   unsigned short flag;\n\n   if(SiS_Pr->ChipType == SIS_650) {\n      flag = SiS_GetReg(SiS_Pr->SiS_P3d4,0x5f) & 0xf0;\n       \n      if((flag == 0xe0) || (flag == 0xc0) ||\n         (flag == 0xb0) || (flag == 0x90)) return false;\n   } else if(SiS_Pr->ChipType >= SIS_661) return false;\n   return true;\n}\n#endif\n\n#ifdef CONFIG_FB_SIS_315\nstatic bool\nSiS_IsYPbPr(struct SiS_Private *SiS_Pr)\n{\n   if(SiS_Pr->ChipType >= SIS_315H) {\n       \n      if(SiS_GetReg(SiS_Pr->SiS_P3d4,0x38) & EnableCHYPbPr) return true;\n   }\n   return false;\n}\n#endif\n\n#ifdef CONFIG_FB_SIS_315\nstatic bool\nSiS_IsChScart(struct SiS_Private *SiS_Pr)\n{\n   if(SiS_Pr->ChipType >= SIS_315H) {\n       \n      if(SiS_GetReg(SiS_Pr->SiS_P3d4,0x38) & EnableCHScart) return true;\n   }\n   return false;\n}\n#endif\n\n#ifdef CONFIG_FB_SIS_315\nstatic bool\nSiS_IsTVOrYPbPrOrScart(struct SiS_Private *SiS_Pr)\n{\n   unsigned short flag;\n\n   if(SiS_Pr->ChipType >= SIS_315H) {\n      flag = SiS_GetReg(SiS_Pr->SiS_P3d4,0x30);\n      if(flag & SetCRT2ToTV)        return true;\n      flag = SiS_GetReg(SiS_Pr->SiS_P3d4,0x38);\n      if(flag & EnableCHYPbPr)      return true;   \n      if(flag & EnableCHScart)      return true;   \n   } else {\n      flag = SiS_GetReg(SiS_Pr->SiS_P3d4,0x30);\n      if(flag & SetCRT2ToTV)        return true;\n   }\n   return false;\n}\n#endif\n\n#ifdef CONFIG_FB_SIS_315\nstatic bool\nSiS_IsLCDOrLCDA(struct SiS_Private *SiS_Pr)\n{\n   unsigned short flag;\n\n   if(SiS_Pr->ChipType >= SIS_315H) {\n      flag = SiS_GetReg(SiS_Pr->SiS_P3d4,0x30);\n      if(flag & SetCRT2ToLCD) return true;\n      flag = SiS_GetReg(SiS_Pr->SiS_P3d4,0x38);\n      if(flag & SetToLCDA)    return true;\n   } else {\n      flag = SiS_GetReg(SiS_Pr->SiS_P3d4,0x30);\n      if(flag & SetCRT2ToLCD) return true;\n   }\n   return false;\n}\n#endif\n\nstatic bool\nSiS_HaveBridge(struct SiS_Private *SiS_Pr)\n{\n   unsigned short flag;\n\n   if(SiS_Pr->SiS_IF_DEF_LVDS == 1) {\n      return true;\n   } else if(SiS_Pr->SiS_VBType & VB_SISVB) {\n      flag = SiS_GetReg(SiS_Pr->SiS_Part4Port,0x00);\n      if((flag == 1) || (flag == 2)) return true;\n   }\n   return false;\n}\n\nstatic bool\nSiS_BridgeIsEnabled(struct SiS_Private *SiS_Pr)\n{\n   unsigned short flag;\n\n   if(SiS_HaveBridge(SiS_Pr)) {\n      flag = SiS_GetReg(SiS_Pr->SiS_Part1Port,0x00);\n      if(SiS_Pr->ChipType < SIS_315H) {\n\tflag &= 0xa0;\n\tif((flag == 0x80) || (flag == 0x20)) return true;\n      } else {\n\tflag &= 0x50;\n\tif((flag == 0x40) || (flag == 0x10)) return true;\n      }\n   }\n   return false;\n}\n\nstatic bool\nSiS_BridgeInSlavemode(struct SiS_Private *SiS_Pr)\n{\n   unsigned short flag1;\n\n   flag1 = SiS_GetReg(SiS_Pr->SiS_P3d4,0x31);\n   if(flag1 & (SetInSlaveMode >> 8)) return true;\n   return false;\n}\n\n \n \n \n\n \n#ifdef CONFIG_FB_SIS_300\nvoid\nSiS_SetChrontelGPIO(struct SiS_Private *SiS_Pr, unsigned short myvbinfo)\n{\n   unsigned int   acpibase;\n   unsigned short temp;\n\n   if(!(SiS_Pr->SiS_ChSW)) return;\n\n   acpibase = sisfb_read_lpc_pci_dword(SiS_Pr, 0x74);\n   acpibase &= 0xFFFF;\n   if(!acpibase) return;\n   temp = SiS_GetRegShort((acpibase + 0x3c));\t \n   temp &= 0xFEFF;\n   SiS_SetRegShort((acpibase + 0x3c), temp);\n   temp = SiS_GetRegShort((acpibase + 0x3c));\n   temp = SiS_GetRegShort((acpibase + 0x3a));\t \n   temp &= 0xFEFF;\n   if(!(myvbinfo & SetCRT2ToTV)) temp |= 0x0100;\n   SiS_SetRegShort((acpibase + 0x3a), temp);\n   temp = SiS_GetRegShort((acpibase + 0x3a));\n}\n#endif\n\nvoid\nSiS_GetVBInfo(struct SiS_Private *SiS_Pr, unsigned short ModeNo,\n\t\tunsigned short ModeIdIndex, int checkcrt2mode)\n{\n   unsigned short tempax, tempbx, temp;\n   unsigned short modeflag, resinfo = 0;\n\n   SiS_Pr->SiS_SetFlag = 0;\n\n   modeflag = SiS_GetModeFlag(SiS_Pr, ModeNo, ModeIdIndex);\n\n   SiS_Pr->SiS_ModeType = modeflag & ModeTypeMask;\n\n   if((ModeNo > 0x13) && (!SiS_Pr->UseCustomMode)) {\n      resinfo = SiS_Pr->SiS_EModeIDTable[ModeIdIndex].Ext_RESINFO;\n   }\n\n   tempbx = 0;\n\n   if(SiS_HaveBridge(SiS_Pr)) {\n\n\ttemp = SiS_GetReg(SiS_Pr->SiS_P3d4,0x30);\n\ttempbx |= temp;\n\ttempax = SiS_GetReg(SiS_Pr->SiS_P3d4,0x31) << 8;\n\ttempax &= (DriverMode | LoadDACFlag | SetNotSimuMode | SetPALTV);\n\ttempbx |= tempax;\n\n#ifdef CONFIG_FB_SIS_315\n\tif(SiS_Pr->ChipType >= SIS_315H) {\n\t   if(SiS_Pr->SiS_VBType & VB_SISLCDA) {\n\t      if(ModeNo == 0x03) {\n\t\t  \n\t\t SiS_SetRegAND(SiS_Pr->SiS_P3d4,0x31,0xbf);\n\t      }\n\t      if(!(SiS_GetReg(SiS_Pr->SiS_P3d4,0x31) & (DriverMode >> 8))) {\n\t\t  \n\t\t SiS_SetRegAND(SiS_Pr->SiS_P3d4,0x38,0xfc);\n\t      }\n\t      if(IS_SIS650) {\n\t\t if(SiS_Pr->SiS_UseLCDA) {\n\t\t    if(SiS_GetReg(SiS_Pr->SiS_P3d4,0x5f) & 0xF0) {\n\t\t       if((ModeNo <= 0x13) || (!(SiS_GetReg(SiS_Pr->SiS_P3d4,0x31) & (DriverMode >> 8)))) {\n\t\t\t  SiS_SetRegOR(SiS_Pr->SiS_P3d4,0x38,(EnableDualEdge | SetToLCDA));\n\t\t       }\n\t\t    }\n\t\t }\n\t      }\n\t      temp = SiS_GetReg(SiS_Pr->SiS_P3d4,0x38);\n\t      if((temp & (EnableDualEdge | SetToLCDA)) == (EnableDualEdge | SetToLCDA)) {\n\t\t tempbx |= SetCRT2ToLCDA;\n\t      }\n\t   }\n\n\t   if(SiS_Pr->ChipType >= SIS_661) {  \n\t      tempbx &= ~(SetCRT2ToYPbPr525750 | SetCRT2ToHiVision);\n\t      if(SiS_GetReg(SiS_Pr->SiS_P3d4,0x38) & 0x04) {\n\t\t temp = SiS_GetReg(SiS_Pr->SiS_P3d4,0x35) & 0xe0;\n\t\t if(temp == 0x60) tempbx |= SetCRT2ToHiVision;\n\t\t else if(SiS_Pr->SiS_VBType & VB_SISYPBPR) {\n\t\t    tempbx |= SetCRT2ToYPbPr525750;\n\t\t }\n\t      }\n\t   }\n\n\t   if(SiS_Pr->SiS_IF_DEF_LVDS == 1) {\n\t      temp = SiS_GetReg(SiS_Pr->SiS_P3d4,0x38);\n\t      if(temp & SetToLCDA) {\n\t\t tempbx |= SetCRT2ToLCDA;\n\t      }\n\t      if(SiS_Pr->SiS_IF_DEF_CH70xx != 0) {\n\t\t if(temp & EnableCHYPbPr) {\n\t\t    tempbx |= SetCRT2ToCHYPbPr;\n\t\t }\n\t      }\n\t   }\n\t}\n\n#endif   \n\n        if(!(SiS_Pr->SiS_VBType & VB_SISVGA2)) {\n\t   tempbx &= ~(SetCRT2ToRAMDAC);\n\t}\n\n\tif(SiS_Pr->SiS_VBType & VB_SISVB) {\n\t   temp = SetCRT2ToSVIDEO   |\n\t\t  SetCRT2ToAVIDEO   |\n\t\t  SetCRT2ToSCART    |\n\t\t  SetCRT2ToLCDA     |\n\t\t  SetCRT2ToLCD      |\n\t\t  SetCRT2ToRAMDAC   |\n\t\t  SetCRT2ToHiVision |\n\t\t  SetCRT2ToYPbPr525750;\n\t} else {\n\t   if(SiS_Pr->ChipType >= SIS_315H) {\n\t      if(SiS_Pr->SiS_IF_DEF_CH70xx != 0) {\n\t\t temp = SetCRT2ToAVIDEO |\n\t\t        SetCRT2ToSVIDEO |\n\t\t        SetCRT2ToSCART  |\n\t\t        SetCRT2ToLCDA   |\n\t\t        SetCRT2ToLCD    |\n\t\t        SetCRT2ToCHYPbPr;\n\t      } else {\n\t\t temp = SetCRT2ToLCDA   |\n\t\t        SetCRT2ToLCD;\n\t      }\n\t   } else {\n\t      if(SiS_Pr->SiS_IF_DEF_CH70xx != 0) {\n\t\t temp = SetCRT2ToTV | SetCRT2ToLCD;\n\t      } else {\n\t\t temp = SetCRT2ToLCD;\n\t      }\n\t   }\n\t}\n\n\tif(!(tempbx & temp)) {\n\t   tempax = DisableCRT2Display;\n\t   tempbx = 0;\n\t}\n\n\tif(SiS_Pr->SiS_VBType & VB_SISVB) {\n\n\t   unsigned short clearmask = ( DriverMode |\n\t\t\t\tDisableCRT2Display |\n\t\t\t\tLoadDACFlag \t   |\n\t\t\t\tSetNotSimuMode \t   |\n\t\t\t\tSetInSlaveMode \t   |\n\t\t\t\tSetPALTV \t   |\n\t\t\t\tSwitchCRT2\t   |\n\t\t\t\tSetSimuScanMode );\n\n\t   if(tempbx & SetCRT2ToLCDA)        tempbx &= (clearmask | SetCRT2ToLCDA);\n\t   if(tempbx & SetCRT2ToRAMDAC)      tempbx &= (clearmask | SetCRT2ToRAMDAC);\n\t   if(tempbx & SetCRT2ToLCD)         tempbx &= (clearmask | SetCRT2ToLCD);\n\t   if(tempbx & SetCRT2ToSCART)       tempbx &= (clearmask | SetCRT2ToSCART);\n\t   if(tempbx & SetCRT2ToHiVision)    tempbx &= (clearmask | SetCRT2ToHiVision);\n\t   if(tempbx & SetCRT2ToYPbPr525750) tempbx &= (clearmask | SetCRT2ToYPbPr525750);\n\n\t} else {\n\n\t   if(SiS_Pr->ChipType >= SIS_315H) {\n\t      if(tempbx & SetCRT2ToLCDA) {\n\t\t tempbx &= (0xFF00|SwitchCRT2|SetSimuScanMode);\n\t      }\n\t   }\n\t   if(SiS_Pr->SiS_IF_DEF_CH70xx != 0) {\n\t      if(tempbx & SetCRT2ToTV) {\n\t\t tempbx &= (0xFF00|SetCRT2ToTV|SwitchCRT2|SetSimuScanMode);\n\t      }\n\t   }\n\t   if(tempbx & SetCRT2ToLCD) {\n\t      tempbx &= (0xFF00|SetCRT2ToLCD|SwitchCRT2|SetSimuScanMode);\n\t   }\n\t   if(SiS_Pr->ChipType >= SIS_315H) {\n\t      if(tempbx & SetCRT2ToLCDA) {\n\t         tempbx |= SetCRT2ToLCD;\n\t      }\n\t   }\n\n\t}\n\n\tif(tempax & DisableCRT2Display) {\n\t   if(!(tempbx & (SwitchCRT2 | SetSimuScanMode))) {\n\t      tempbx = SetSimuScanMode | DisableCRT2Display;\n\t   }\n\t}\n\n\tif(!(tempbx & DriverMode)) tempbx |= SetSimuScanMode;\n\n\t \n\tif(SiS_Pr->SiS_ModeType <= ModeVGA) {\n\t   if( (SiS_Pr->SiS_IF_DEF_LVDS == 1) ||\n\t       ((SiS_Pr->SiS_VBType & VB_NoLCD) && (tempbx & SetCRT2ToLCD)) ) {\n\t      modeflag &= (~CRT2Mode);\n\t   }\n\t}\n\n\tif(!(tempbx & SetSimuScanMode)) {\n\t   if(tempbx & SwitchCRT2) {\n\t      if((!(modeflag & CRT2Mode)) && (checkcrt2mode)) {\n\t\t if(resinfo != SIS_RI_1600x1200) {\n\t\t    tempbx |= SetSimuScanMode;\n\t\t }\n              }\n\t   } else {\n\t      if(SiS_BridgeIsEnabled(SiS_Pr)) {\n\t\t if(!(tempbx & DriverMode)) {\n\t\t    if(SiS_BridgeInSlavemode(SiS_Pr)) {\n\t\t       tempbx |= SetSimuScanMode;\n\t\t    }\n\t\t }\n\t      }\n\t   }\n\t}\n\n\tif(!(tempbx & DisableCRT2Display)) {\n\t   if(tempbx & DriverMode) {\n\t      if(tempbx & SetSimuScanMode) {\n\t\t if((!(modeflag & CRT2Mode)) && (checkcrt2mode)) {\n\t\t    if(resinfo != SIS_RI_1600x1200) {\n\t\t       tempbx |= SetInSlaveMode;\n\t\t    }\n\t\t }\n\t      }\n\t   } else {\n\t      tempbx |= SetInSlaveMode;\n\t   }\n\t}\n\n   }\n\n   SiS_Pr->SiS_VBInfo = tempbx;\n\n#ifdef CONFIG_FB_SIS_300\n   if(SiS_Pr->ChipType == SIS_630) {\n      SiS_SetChrontelGPIO(SiS_Pr, SiS_Pr->SiS_VBInfo);\n   }\n#endif\n\n#if 0\n   printk(KERN_DEBUG \"sisfb: (init301: VBInfo= 0x%04x, SetFlag=0x%04x)\\n\",\n      SiS_Pr->SiS_VBInfo, SiS_Pr->SiS_SetFlag);\n#endif\n}\n\n \n \n \n\nvoid\nSiS_SetYPbPr(struct SiS_Private *SiS_Pr)\n{\n\n   unsigned char temp;\n\n    \n\n   SiS_Pr->SiS_YPbPr = 0;\n   if(SiS_Pr->ChipType >= SIS_661) return;\n\n   if(SiS_Pr->SiS_VBType) {\n      if(SiS_Pr->SiS_VBInfo & SetCRT2ToHiVision) {\n\t SiS_Pr->SiS_YPbPr = YPbPrHiVision;\n      }\n   }\n\n   if(SiS_Pr->ChipType >= SIS_315H) {\n      if(SiS_Pr->SiS_VBType & VB_SISYPBPR) {\n\t temp = SiS_GetReg(SiS_Pr->SiS_P3d4,0x38);\n\t if(temp & 0x08) {\n\t    switch((temp >> 4)) {\n\t    case 0x00: SiS_Pr->SiS_YPbPr = YPbPr525i;     break;\n\t    case 0x01: SiS_Pr->SiS_YPbPr = YPbPr525p;     break;\n\t    case 0x02: SiS_Pr->SiS_YPbPr = YPbPr750p;     break;\n\t    case 0x03: SiS_Pr->SiS_YPbPr = YPbPrHiVision; break;\n\t    }\n\t }\n      }\n   }\n\n}\n\n \n \n \n\nvoid\nSiS_SetTVMode(struct SiS_Private *SiS_Pr, unsigned short ModeNo, unsigned short ModeIdIndex)\n{\n   unsigned char  *ROMAddr = SiS_Pr->VirtualRomBase;\n   unsigned short temp, temp1, resinfo = 0, romindex = 0;\n   unsigned char  OutputSelect = *SiS_Pr->pSiS_OutputSelect;\n\n   SiS_Pr->SiS_TVMode = 0;\n\n   if(!(SiS_Pr->SiS_VBInfo & SetCRT2ToTV)) return;\n   if(SiS_Pr->UseCustomMode) return;\n\n   if(ModeNo > 0x13) {\n      resinfo = SiS_Pr->SiS_EModeIDTable[ModeIdIndex].Ext_RESINFO;\n   }\n\n   if(SiS_Pr->ChipType < SIS_661) {\n\n      if(SiS_Pr->SiS_VBInfo & SetPALTV) SiS_Pr->SiS_TVMode |= TVSetPAL;\n\n      if(SiS_Pr->SiS_VBType & VB_SISVB) {\n\t temp = 0;\n\t if((SiS_Pr->ChipType == SIS_630) ||\n\t    (SiS_Pr->ChipType == SIS_730)) {\n\t    temp = 0x35;\n\t    romindex = 0xfe;\n\t } else if(SiS_Pr->ChipType >= SIS_315H) {\n\t    temp = 0x38;\n\t    if(SiS_Pr->ChipType < XGI_20) {\n\t       romindex = 0xf3;\n\t       if(SiS_Pr->ChipType >= SIS_330) romindex = 0x11b;\n\t    }\n\t }\n\t if(temp) {\n\t    if(romindex && SiS_Pr->SiS_UseROM && (!(SiS_Pr->SiS_ROMNew))) {\n\t       OutputSelect = ROMAddr[romindex];\n\t       if(!(OutputSelect & EnablePALMN)) {\n\t\t  SiS_SetRegAND(SiS_Pr->SiS_P3d4,temp,0x3F);\n\t       }\n\t    }\n\t    temp1 = SiS_GetReg(SiS_Pr->SiS_P3d4,temp);\n\t    if(SiS_Pr->SiS_TVMode & TVSetPAL) {\n\t       if(temp1 & EnablePALM) {\t\t \n\t\t  SiS_Pr->SiS_TVMode |= TVSetPALM;\n\t\t  SiS_Pr->SiS_TVMode &= ~TVSetPAL;\n\t       } else if(temp1 & EnablePALN) {\t \n\t\t  SiS_Pr->SiS_TVMode |= TVSetPALN;\n\t       }\n\t    } else {\n\t       if(temp1 & EnableNTSCJ) {\t \n\t\t  SiS_Pr->SiS_TVMode |= TVSetNTSCJ;\n\t       }\n\t    }\n\t }\n\t  \n\t if(SiS_Pr->SiS_VBInfo & SetCRT2ToHiVision) {\n\t    if(SiS_Pr->SiS_YPbPr == YPbPr750p)          SiS_Pr->SiS_TVMode |= TVSetYPbPr750p;\n\t    else if(SiS_Pr->SiS_YPbPr == YPbPr525p)     SiS_Pr->SiS_TVMode |= TVSetYPbPr525p;\n\t    else if(SiS_Pr->SiS_YPbPr == YPbPrHiVision) SiS_Pr->SiS_TVMode |= TVSetHiVision;\n\t    else\t\t\t\t        SiS_Pr->SiS_TVMode |= TVSetYPbPr525i;\n\t    if(SiS_Pr->SiS_TVMode & (TVSetYPbPr750p | TVSetYPbPr525p | TVSetYPbPr525i)) {\n\t       SiS_Pr->SiS_VBInfo &= ~SetCRT2ToHiVision;\n\t       SiS_Pr->SiS_VBInfo |= SetCRT2ToYPbPr525750;\n\t    } else if(SiS_Pr->SiS_TVMode & TVSetHiVision) {\n\t       SiS_Pr->SiS_TVMode |= TVSetPAL;\n\t    }\n\t }\n      } else if(SiS_Pr->SiS_IF_DEF_CH70xx != 0) {\n\t if(SiS_Pr->SiS_CHOverScan) {\n\t    if(SiS_Pr->SiS_IF_DEF_CH70xx == 1) {\n\t       temp = SiS_GetReg(SiS_Pr->SiS_P3d4,0x35);\n\t       if((temp & TVOverScan) || (SiS_Pr->SiS_CHOverScan == 1)) {\n\t\t  SiS_Pr->SiS_TVMode |= TVSetCHOverScan;\n\t       }\n\t    } else if(SiS_Pr->SiS_IF_DEF_CH70xx == 2) {\n\t       temp = SiS_GetReg(SiS_Pr->SiS_P3d4,0x79);\n\t       if((temp & 0x80) || (SiS_Pr->SiS_CHOverScan == 1)) {\n\t\t  SiS_Pr->SiS_TVMode |= TVSetCHOverScan;\n\t       }\n\t    }\n\t    if(SiS_Pr->SiS_CHSOverScan) {\n\t       SiS_Pr->SiS_TVMode |= TVSetCHOverScan;\n\t    }\n\t }\n\t if(SiS_Pr->SiS_IF_DEF_CH70xx == 2) {\n\t    temp = SiS_GetReg(SiS_Pr->SiS_P3d4,0x38);\n\t    if(SiS_Pr->SiS_TVMode & TVSetPAL) {\n\t       if(temp & EnablePALM)      SiS_Pr->SiS_TVMode |= TVSetPALM;\n\t       else if(temp & EnablePALN) SiS_Pr->SiS_TVMode |= TVSetPALN;\n\t    } else {\n\t       if(temp & EnableNTSCJ) {\n\t\t  SiS_Pr->SiS_TVMode |= TVSetNTSCJ;\n\t       }\n\t    }\n\t }\n      }\n\n   } else {   \n\n      temp1 = SiS_GetReg(SiS_Pr->SiS_P3d4,0x35);\n      if(temp1 & 0x01) {\n\t SiS_Pr->SiS_TVMode |= TVSetPAL;\n\t if(temp1 & 0x08) {\n\t    SiS_Pr->SiS_TVMode |= TVSetPALN;\n\t } else if(temp1 & 0x04) {\n\t    if(SiS_Pr->SiS_VBType & VB_SISVB) {\n\t       SiS_Pr->SiS_TVMode &= ~TVSetPAL;\n\t    }\n\t    SiS_Pr->SiS_TVMode |= TVSetPALM;\n\t }\n      } else {\n\t if(temp1 & 0x02) {\n\t    SiS_Pr->SiS_TVMode |= TVSetNTSCJ;\n\t }\n      }\n      if(SiS_Pr->SiS_IF_DEF_CH70xx == 2) {\n\t if(SiS_Pr->SiS_CHOverScan) {\n\t    if((temp1 & 0x10) || (SiS_Pr->SiS_CHOverScan == 1)) {\n\t       SiS_Pr->SiS_TVMode |= TVSetCHOverScan;\n\t    }\n\t }\n      }\n      if(SiS_Pr->SiS_VBType & VB_SISVB) {\n\t if(SiS_Pr->SiS_VBInfo & SetCRT2ToYPbPr525750) {\n\t    temp1 &= 0xe0;\n\t    if(temp1 == 0x00)      SiS_Pr->SiS_TVMode |= TVSetYPbPr525i;\n\t    else if(temp1 == 0x20) SiS_Pr->SiS_TVMode |= TVSetYPbPr525p;\n\t    else if(temp1 == 0x40) SiS_Pr->SiS_TVMode |= TVSetYPbPr750p;\n\t } else if(SiS_Pr->SiS_VBInfo & SetCRT2ToHiVision) {\n\t    SiS_Pr->SiS_TVMode |= (TVSetHiVision | TVSetPAL);\n\t }\n\t if(SiS_Pr->SiS_VBInfo & (SetCRT2ToYPbPr525750 | SetCRT2ToHiVision)) {\n\t    if(resinfo == SIS_RI_800x480 || resinfo == SIS_RI_1024x576 || resinfo == SIS_RI_1280x720) {\n\t       SiS_Pr->SiS_TVMode |= TVAspect169;\n\t    } else {\n\t       temp1 = SiS_GetReg(SiS_Pr->SiS_P3d4,0x39);\n\t       if(temp1 & 0x02) {\n\t\t  if(SiS_Pr->SiS_TVMode & (TVSetYPbPr750p | TVSetHiVision)) {\n\t\t     SiS_Pr->SiS_TVMode |= TVAspect169;\n\t\t  } else {\n\t\t     SiS_Pr->SiS_TVMode |= TVAspect43LB;\n\t\t  }\n\t       } else {\n\t\t  SiS_Pr->SiS_TVMode |= TVAspect43;\n\t       }\n\t    }\n\t }\n      }\n   }\n\n   if(SiS_Pr->SiS_VBInfo & SetCRT2ToSCART) SiS_Pr->SiS_TVMode |= TVSetPAL;\n\n   if(SiS_Pr->SiS_VBType & VB_SISVB) {\n\n      if(SiS_Pr->SiS_VBInfo & SetCRT2ToHiVision) {\n\t SiS_Pr->SiS_TVMode |= TVSetPAL;\n\t SiS_Pr->SiS_TVMode &= ~(TVSetPALM | TVSetPALN | TVSetNTSCJ);\n      } else if(SiS_Pr->SiS_VBInfo & SetCRT2ToYPbPr525750) {\n\t if(SiS_Pr->SiS_TVMode & (TVSetYPbPr525i | TVSetYPbPr525p | TVSetYPbPr750p)) {\n\t    SiS_Pr->SiS_TVMode &= ~(TVSetPAL | TVSetNTSCJ | TVSetPALM | TVSetPALN);\n\t }\n      }\n\n      if(SiS_Pr->SiS_VBInfo & SetInSlaveMode) {\n\t if(!(SiS_Pr->SiS_VBInfo & SetNotSimuMode)) {\n\t    SiS_Pr->SiS_TVMode |= TVSetTVSimuMode;\n\t }\n      }\n\n      if(!(SiS_Pr->SiS_TVMode & TVSetPAL)) {\n\t if(resinfo == SIS_RI_1024x768) {\n\t    if(SiS_Pr->SiS_TVMode & TVSetYPbPr525p) {\n\t       SiS_Pr->SiS_TVMode |= TVSet525p1024;\n\t    } else if(!(SiS_Pr->SiS_TVMode & (TVSetHiVision | TVSetYPbPr750p))) {\n\t       SiS_Pr->SiS_TVMode |= TVSetNTSC1024;\n\t    }\n\t }\n      }\n\n      SiS_Pr->SiS_TVMode |= TVRPLLDIV2XO;\n      if((SiS_Pr->SiS_VBInfo & SetCRT2ToHiVision) &&\n\t (SiS_Pr->SiS_VBInfo & SetInSlaveMode)) {\n\t SiS_Pr->SiS_TVMode &= ~TVRPLLDIV2XO;\n      } else if(SiS_Pr->SiS_TVMode & (TVSetYPbPr525p | TVSetYPbPr750p)) {\n\t SiS_Pr->SiS_TVMode &= ~TVRPLLDIV2XO;\n      } else if(!(SiS_Pr->SiS_VBType & VB_SIS30xBLV)) {\n\t if(SiS_Pr->SiS_TVMode & TVSetTVSimuMode) {\n\t    SiS_Pr->SiS_TVMode &= ~TVRPLLDIV2XO;\n\t }\n      }\n\n   }\n\n   SiS_Pr->SiS_VBInfo &= ~SetPALTV;\n}\n\n \n \n \n\nstatic unsigned short\nSiS_GetBIOSLCDResInfo(struct SiS_Private *SiS_Pr)\n{\n   unsigned short temp = SiS_Pr->SiS_LCDResInfo;\n    \n   switch(temp) {\n   case Panel_1280x768_2: temp = Panel_1280x768;    break;\n   case Panel_1280x800_2: temp = Panel_1280x800;    break;\n   case Panel_1280x854:   temp = Panel661_1280x854; break;\n   }\n   return temp;\n}\n\nstatic void\nSiS_GetLCDInfoBIOS(struct SiS_Private *SiS_Pr)\n{\n#ifdef CONFIG_FB_SIS_315\n   unsigned char  *ROMAddr;\n   unsigned short temp;\n\n   if((ROMAddr = GetLCDStructPtr661(SiS_Pr))) {\n      if((temp = SISGETROMW(6)) != SiS_Pr->PanelHT) {\n\t SiS_Pr->SiS_NeedRomModeData = true;\n\t SiS_Pr->PanelHT  = temp;\n      }\n      if((temp = SISGETROMW(8)) != SiS_Pr->PanelVT) {\n\t SiS_Pr->SiS_NeedRomModeData = true;\n\t SiS_Pr->PanelVT  = temp;\n      }\n      SiS_Pr->PanelHRS = SISGETROMW(10);\n      SiS_Pr->PanelHRE = SISGETROMW(12);\n      SiS_Pr->PanelVRS = SISGETROMW(14);\n      SiS_Pr->PanelVRE = SISGETROMW(16);\n      SiS_Pr->PanelVCLKIdx315 = VCLK_CUSTOM_315;\n      SiS_Pr->SiS_VCLKData[VCLK_CUSTOM_315].CLOCK =\n\t SiS_Pr->SiS_VBVCLKData[VCLK_CUSTOM_315].CLOCK = (unsigned short)((unsigned char)ROMAddr[18]);\n      SiS_Pr->SiS_VCLKData[VCLK_CUSTOM_315].SR2B =\n\t SiS_Pr->SiS_VBVCLKData[VCLK_CUSTOM_315].Part4_A = ROMAddr[19];\n      SiS_Pr->SiS_VCLKData[VCLK_CUSTOM_315].SR2C =\n\t SiS_Pr->SiS_VBVCLKData[VCLK_CUSTOM_315].Part4_B = ROMAddr[20];\n\n   }\n#endif\n}\n\nstatic void\nSiS_CheckScaling(struct SiS_Private *SiS_Pr, unsigned short resinfo,\n\t\t\tconst unsigned char *nonscalingmodes)\n{\n   int i = 0;\n   while(nonscalingmodes[i] != 0xff) {\n      if(nonscalingmodes[i++] == resinfo) {\n\t if((SiS_Pr->SiS_VBInfo & SetCRT2ToLCD) ||\n\t    (SiS_Pr->UsePanelScaler == -1)) {\n\t    SiS_Pr->SiS_LCDInfo |= DontExpandLCD;\n\t }\n\t break;\n      }\n   }\n}\n\nvoid\nSiS_GetLCDResInfo(struct SiS_Private *SiS_Pr, unsigned short ModeNo, unsigned short ModeIdIndex)\n{\n  unsigned short temp,modeflag,resinfo=0,modexres=0,modeyres=0;\n  bool panelcanscale = false;\n#ifdef CONFIG_FB_SIS_300\n  unsigned char *ROMAddr = SiS_Pr->VirtualRomBase;\n  static const unsigned char SiS300SeriesLCDRes[] =\n          { 0,  1,  2,  3,  7,  4,  5,  8,\n\t    0,  0, 10,  0,  0,  0,  0, 15 };\n#endif\n#ifdef CONFIG_FB_SIS_315\n  unsigned char   *myptr = NULL;\n#endif\n\n  SiS_Pr->SiS_LCDResInfo  = 0;\n  SiS_Pr->SiS_LCDTypeInfo = 0;\n  SiS_Pr->SiS_LCDInfo     = 0;\n  SiS_Pr->PanelHRS        = 999;  \n  SiS_Pr->PanelHRE        = 999;  \n  SiS_Pr->PanelVRS        = 999;  \n  SiS_Pr->PanelVRE        = 999;  \n  SiS_Pr->SiS_NeedRomModeData = false;\n\n   \n  SiS_Pr->Alternate1600x1200 = false;\n\n  if(!(SiS_Pr->SiS_VBInfo & (SetCRT2ToLCD | SetCRT2ToLCDA))) return;\n\n  modeflag = SiS_GetModeFlag(SiS_Pr, ModeNo, ModeIdIndex);\n\n  if((ModeNo > 0x13) && (!SiS_Pr->UseCustomMode)) {\n     resinfo = SiS_Pr->SiS_EModeIDTable[ModeIdIndex].Ext_RESINFO;\n     modexres = SiS_Pr->SiS_ModeResInfo[resinfo].HTotal;\n     modeyres = SiS_Pr->SiS_ModeResInfo[resinfo].VTotal;\n  }\n\n  temp = SiS_GetReg(SiS_Pr->SiS_P3d4,0x36);\n\n   \n  if(temp == 0) temp = 0x02;\n\n  if((SiS_Pr->ChipType >= SIS_661) || (SiS_Pr->SiS_ROMNew)) {\n     SiS_Pr->SiS_LCDTypeInfo = (SiS_GetReg(SiS_Pr->SiS_P3d4,0x39) & 0x7c) >> 2;\n  } else if((SiS_Pr->ChipType < SIS_315H) || (SiS_Pr->ChipType >= SIS_661)) {\n     SiS_Pr->SiS_LCDTypeInfo = temp >> 4;\n  } else {\n     SiS_Pr->SiS_LCDTypeInfo = (temp & 0x0F) - 1;\n  }\n  temp &= 0x0f;\n#ifdef CONFIG_FB_SIS_300\n  if(SiS_Pr->ChipType < SIS_315H) {\n      \n     if(SiS_Pr->SiS_VBType & VB_SIS301) {\n        if(temp < 0x0f) temp &= 0x07;\n     }\n      \n     temp = SiS300SeriesLCDRes[temp];\n  }\n#endif\n\n   \n#ifdef CONFIG_FB_SIS_315\n  if(SiS_Pr->ChipType == SIS_550) {\n     if     (temp == Panel310_1152x768)  temp = Panel_320x240_2;  \n     else if(temp == Panel310_320x240_2) temp = Panel_320x240_2;\n     else if(temp == Panel310_320x240_3) temp = Panel_320x240_3;\n  } else if(SiS_Pr->ChipType >= SIS_661) {\n     if(temp == Panel661_1280x854)       temp = Panel_1280x854;\n  }\n#endif\n\n  if(SiS_Pr->SiS_VBType & VB_SISLVDS) {\t\t \n     if(temp == Panel310_1280x768) {\n        temp = Panel_1280x768_2;\n     }\n     if(SiS_Pr->SiS_ROMNew) {\n\tif(temp == Panel661_1280x800) {\n\t   temp = Panel_1280x800_2;\n\t}\n     }\n  }\n\n  SiS_Pr->SiS_LCDResInfo = temp;\n\n#ifdef CONFIG_FB_SIS_300\n  if(SiS_Pr->SiS_IF_DEF_LVDS == 1) {\n     if(SiS_Pr->SiS_CustomT == CUT_BARCO1366) {\n\tSiS_Pr->SiS_LCDResInfo = Panel_Barco1366;\n     } else if(SiS_Pr->SiS_CustomT == CUT_PANEL848) {\n\tSiS_Pr->SiS_LCDResInfo = Panel_848x480;\n     } else if(SiS_Pr->SiS_CustomT == CUT_PANEL856) {\n\tSiS_Pr->SiS_LCDResInfo = Panel_856x480;\n     }\n  }\n#endif\n\n  if(SiS_Pr->SiS_VBType & VB_SISVB) {\n     if(SiS_Pr->SiS_LCDResInfo < SiS_Pr->SiS_PanelMin301)\n\tSiS_Pr->SiS_LCDResInfo = SiS_Pr->SiS_PanelMin301;\n  } else {\n     if(SiS_Pr->SiS_LCDResInfo < SiS_Pr->SiS_PanelMinLVDS)\n\tSiS_Pr->SiS_LCDResInfo = SiS_Pr->SiS_PanelMinLVDS;\n  }\n\n  temp = SiS_GetReg(SiS_Pr->SiS_P3d4,0x37);\n  SiS_Pr->SiS_LCDInfo = temp & ~0x000e;\n   \n\n   \n  switch(SiS_Pr->SiS_LCDResInfo) {\n  case Panel_320x240_1:\n  case Panel_320x240_2:\n  case Panel_320x240_3:\n  case Panel_1280x960:\n      SiS_Pr->SiS_LCDInfo &= ~DontExpandLCD;\n      break;\n  case Panel_640x480:\n      SiS_Pr->SiS_LCDInfo |= DontExpandLCD;\n  }\n\n  panelcanscale = (bool)(SiS_Pr->SiS_LCDInfo & DontExpandLCD);\n\n  if(!SiS_Pr->UsePanelScaler)          SiS_Pr->SiS_LCDInfo &= ~DontExpandLCD;\n  else if(SiS_Pr->UsePanelScaler == 1) SiS_Pr->SiS_LCDInfo |= DontExpandLCD;\n\n   \n#ifdef CONFIG_FB_SIS_315\n  if(SiS_Pr->ChipType >= SIS_661) {\n     if(SiS_Pr->SiS_LCDInfo & DontExpandLCD) {\n\tif(temp & 0x08) SiS_Pr->SiS_LCDInfo |= LCDPass11;\n     }\n     if(SiS_Pr->SiS_VBType & VB_SISDUALLINK) {\n\tif(SiS_Pr->SiS_ROMNew) {\n\t   if(temp & 0x02) SiS_Pr->SiS_LCDInfo |= LCDDualLink;\n\t} else if((myptr = GetLCDStructPtr661(SiS_Pr))) {\n\t   if(myptr[2] & 0x01) SiS_Pr->SiS_LCDInfo |= LCDDualLink;\n\t}\n     }\n  } else if(SiS_Pr->ChipType >= SIS_315H) {\n     if(SiS_Pr->SiS_LCDInfo & DontExpandLCD) {\n\tif(SiS_GetReg(SiS_Pr->SiS_P3d4,0x39) & 0x01) SiS_Pr->SiS_LCDInfo |= LCDPass11;\n     }\n     if((SiS_Pr->SiS_ROMNew) && (!(SiS_Pr->PanelSelfDetected))) {\n\tSiS_Pr->SiS_LCDInfo &= ~(LCDRGB18Bit);\n\ttemp = SiS_GetReg(SiS_Pr->SiS_P3d4,0x35);\n\tif(temp & 0x01) SiS_Pr->SiS_LCDInfo |= LCDRGB18Bit;\n\tif(SiS_Pr->SiS_VBType & VB_SISDUALLINK) {\n\t   if(temp & 0x02) SiS_Pr->SiS_LCDInfo |= LCDDualLink;\n\t}\n     } else if(!(SiS_Pr->SiS_ROMNew)) {\n\tif(SiS_Pr->SiS_VBType & VB_SISDUALLINK) {\n\t   if((SiS_Pr->SiS_CustomT == CUT_CLEVO1024) &&\n\t      (SiS_Pr->SiS_LCDResInfo == Panel_1024x768)) {\n\t      SiS_Pr->SiS_LCDInfo |= LCDDualLink;\n\t   }\n\t   if((SiS_Pr->SiS_LCDResInfo == Panel_1280x1024) ||\n\t      (SiS_Pr->SiS_LCDResInfo == Panel_1400x1050) ||\n\t      (SiS_Pr->SiS_LCDResInfo == Panel_1600x1200) ||\n\t      (SiS_Pr->SiS_LCDResInfo == Panel_1680x1050)) {\n\t      SiS_Pr->SiS_LCDInfo |= LCDDualLink;\n\t   }\n\t}\n     }\n  }\n#endif\n\n   \n  if((SiS_Pr->SiS_IF_DEF_LVDS == 1) || (SiS_Pr->SiS_VBType & VB_NoLCD)) {\n      \n     SiS_Pr->SiS_LCDInfo &= ~LCDPass11;\n  } else if(SiS_Pr->SiS_VBType & VB_SISVB) {\n     if(SiS_Pr->SiS_VBType & VB_SISLVDS) {\n\t \n\tSiS_Pr->SiS_LCDInfo &= ~LCDPass11;\n     } else {\n\t \n\tif(panelcanscale)             SiS_Pr->SiS_LCDInfo |= LCDPass11;\n\tif(SiS_Pr->CenterScreen == 1) SiS_Pr->SiS_LCDInfo &= ~LCDPass11;\n     }\n  }\n\n  SiS_Pr->PanelVCLKIdx300 = VCLK65_300;\n  SiS_Pr->PanelVCLKIdx315 = VCLK108_2_315;\n\n  switch(SiS_Pr->SiS_LCDResInfo) {\n     case Panel_320x240_1:\n     case Panel_320x240_2:\n     case Panel_320x240_3:  SiS_Pr->PanelXRes =  640; SiS_Pr->PanelYRes =  480;\n\t\t\t    SiS_Pr->PanelVRS  =   24; SiS_Pr->PanelVRE  =    3;\n\t\t\t    SiS_Pr->PanelVCLKIdx300 = VCLK28;\n\t\t\t    SiS_Pr->PanelVCLKIdx315 = VCLK28;\n\t\t\t    break;\n     case Panel_640x480:    SiS_Pr->PanelXRes =  640; SiS_Pr->PanelYRes =  480;\n\t\t\t\t\t\t      SiS_Pr->PanelVRE  =    3;\n\t\t\t    SiS_Pr->PanelVCLKIdx300 = VCLK28;\n\t\t\t    SiS_Pr->PanelVCLKIdx315 = VCLK28;\n\t\t\t    break;\n     case Panel_800x600:    SiS_Pr->PanelXRes =  800; SiS_Pr->PanelYRes =  600;\n     \t\t\t    SiS_Pr->PanelHT   = 1056; SiS_Pr->PanelVT   =  628;\n\t\t\t    SiS_Pr->PanelHRS  =   40; SiS_Pr->PanelHRE  =  128;\n\t\t\t    SiS_Pr->PanelVRS  =    1; SiS_Pr->PanelVRE  =    4;\n\t\t\t    SiS_Pr->PanelVCLKIdx300 = VCLK40;\n\t\t\t    SiS_Pr->PanelVCLKIdx315 = VCLK40;\n\t\t\t    break;\n     case Panel_1024x600:   SiS_Pr->PanelXRes = 1024; SiS_Pr->PanelYRes =  600;\n\t\t\t    SiS_Pr->PanelHT   = 1344; SiS_Pr->PanelVT   =  800;\n\t\t\t    SiS_Pr->PanelHRS  =   24; SiS_Pr->PanelHRE  =  136;\n\t\t\t    SiS_Pr->PanelVRS  =    2   ; SiS_Pr->PanelVRE  =    6;\n\t\t\t    SiS_Pr->PanelVCLKIdx300 = VCLK65_300;\n\t\t\t    SiS_Pr->PanelVCLKIdx315 = VCLK65_315;\n\t\t\t    break;\n     case Panel_1024x768:   SiS_Pr->PanelXRes = 1024; SiS_Pr->PanelYRes =  768;\n\t\t\t    SiS_Pr->PanelHT   = 1344; SiS_Pr->PanelVT   =  806;\n\t\t\t    SiS_Pr->PanelHRS  =   24; SiS_Pr->PanelHRE  =  136;\n\t\t\t    SiS_Pr->PanelVRS  =    3; SiS_Pr->PanelVRE  =    6;\n\t\t\t    if(SiS_Pr->ChipType < SIS_315H) {\n\t\t\t       SiS_Pr->PanelHRS = 23;\n\t\t\t\t\t\t      SiS_Pr->PanelVRE  =    5;\n\t\t\t    }\n\t\t\t    SiS_Pr->PanelVCLKIdx300 = VCLK65_300;\n\t\t\t    SiS_Pr->PanelVCLKIdx315 = VCLK65_315;\n\t\t\t    SiS_GetLCDInfoBIOS(SiS_Pr);\n\t\t\t    break;\n     case Panel_1152x768:   SiS_Pr->PanelXRes = 1152; SiS_Pr->PanelYRes =  768;\n\t\t\t    SiS_Pr->PanelHT   = 1344; SiS_Pr->PanelVT   =  806;\n\t\t\t    SiS_Pr->PanelHRS  =   24; SiS_Pr->PanelHRE  =  136;\n\t\t\t    SiS_Pr->PanelVRS  =    3; SiS_Pr->PanelVRE  =    6;\n\t\t\t    if(SiS_Pr->ChipType < SIS_315H) {\n\t\t\t       SiS_Pr->PanelHRS = 23;\n\t\t\t\t\t\t      SiS_Pr->PanelVRE  =    5;\n\t\t\t    }\n\t\t\t    SiS_Pr->PanelVCLKIdx300 = VCLK65_300;\n\t\t\t    SiS_Pr->PanelVCLKIdx315 = VCLK65_315;\n\t\t\t    break;\n     case Panel_1152x864:   SiS_Pr->PanelXRes = 1152; SiS_Pr->PanelYRes =  864;\n\t\t\t    break;\n     case Panel_1280x720:   SiS_Pr->PanelXRes = 1280; SiS_Pr->PanelYRes =  720;\n\t\t\t    SiS_Pr->PanelHT   = 1650; SiS_Pr->PanelVT   =  750;\n\t\t\t    SiS_Pr->PanelHRS  =  110; SiS_Pr->PanelHRE  =   40;\n\t\t\t    SiS_Pr->PanelVRS  =    5; SiS_Pr->PanelVRE  =    5;\n\t\t\t    SiS_Pr->PanelVCLKIdx315 = VCLK_1280x720;\n\t\t\t     \n\t\t\t    SiS_GetLCDInfoBIOS(SiS_Pr);\n\t\t\t    break;\n     case Panel_1280x768:   SiS_Pr->PanelXRes = 1280; SiS_Pr->PanelYRes =  768;\n\t\t\t    if(SiS_Pr->SiS_IF_DEF_LVDS == 1) {\n\t\t\t       SiS_Pr->PanelHT   = 1408; SiS_Pr->PanelVT   =  806;\n\t\t\t       SiS_Pr->PanelVCLKIdx300 = VCLK81_300;  \n\t\t\t       SiS_Pr->PanelVCLKIdx315 = VCLK81_315;  \n\t\t\t    } else {\n\t\t\t       SiS_Pr->PanelHT   = 1688; SiS_Pr->PanelVT   =  802;\n\t\t\t       SiS_Pr->PanelHRS  =   48; SiS_Pr->PanelHRE  =  112;\n\t\t\t       SiS_Pr->PanelVRS  =    3; SiS_Pr->PanelVRE  =    6;\n\t\t\t       SiS_Pr->PanelVCLKIdx300 = VCLK81_300;\n\t\t\t       SiS_Pr->PanelVCLKIdx315 = VCLK81_315;\n\t\t\t    }\n\t\t\t    break;\n     case Panel_1280x768_2: SiS_Pr->PanelXRes = 1280; SiS_Pr->PanelYRes =  768;\n\t\t\t    SiS_Pr->PanelHT   = 1660; SiS_Pr->PanelVT   =  806;\n\t\t\t    SiS_Pr->PanelHRS  =   48; SiS_Pr->PanelHRE  =  112;\n\t\t\t    SiS_Pr->PanelVRS  =    3; SiS_Pr->PanelVRE  =    6;\n\t\t\t    SiS_Pr->PanelVCLKIdx315 = VCLK_1280x768_2;\n\t\t\t    SiS_GetLCDInfoBIOS(SiS_Pr);\n\t\t\t    break;\n     case Panel_1280x800:   SiS_Pr->PanelXRes = 1280; SiS_Pr->PanelYRes =  800;\n\t\t\t    SiS_Pr->PanelHT   = 1408; SiS_Pr->PanelVT   =  816;\n\t\t\t    SiS_Pr->PanelHRS   =  21; SiS_Pr->PanelHRE  =   24;\n\t\t\t    SiS_Pr->PanelVRS   =   4; SiS_Pr->PanelVRE  =    3;\n\t\t\t    SiS_Pr->PanelVCLKIdx315 = VCLK_1280x800_315;\n\t\t\t    SiS_GetLCDInfoBIOS(SiS_Pr);\n\t\t\t    break;\n     case Panel_1280x800_2: SiS_Pr->PanelXRes = 1280; SiS_Pr->PanelYRes =  800;\n\t\t\t    SiS_Pr->PanelHT   = 1552; SiS_Pr->PanelVT   =  812;\n\t\t\t    SiS_Pr->PanelHRS   =  48; SiS_Pr->PanelHRE  =  112;\n\t\t\t    SiS_Pr->PanelVRS   =   4; SiS_Pr->PanelVRE  =    3;\n\t\t\t    SiS_Pr->PanelVCLKIdx315 = VCLK_1280x800_315_2;\n\t\t\t    SiS_GetLCDInfoBIOS(SiS_Pr);\n\t\t\t    break;\n     case Panel_1280x854:   SiS_Pr->PanelXRes = 1280; SiS_Pr->PanelYRes =  854;\n\t\t\t    SiS_Pr->PanelHT   = 1664; SiS_Pr->PanelVT   =  861;\n\t\t\t    SiS_Pr->PanelHRS   =  16; SiS_Pr->PanelHRE  =  112;\n\t\t\t    SiS_Pr->PanelVRS   =   1; SiS_Pr->PanelVRE  =    3;\n\t\t\t    SiS_Pr->PanelVCLKIdx315 = VCLK_1280x854;\n\t\t\t    SiS_GetLCDInfoBIOS(SiS_Pr);\n\t\t\t    break;\n     case Panel_1280x960:   SiS_Pr->PanelXRes = 1280; SiS_Pr->PanelYRes =  960;\n\t\t\t    SiS_Pr->PanelHT   = 1800; SiS_Pr->PanelVT   = 1000;\n\t\t\t    SiS_Pr->PanelVCLKIdx300 = VCLK108_3_300;\n\t\t\t    SiS_Pr->PanelVCLKIdx315 = VCLK108_3_315;\n\t\t\t    if(resinfo == SIS_RI_1280x1024) {\n\t\t\t       SiS_Pr->PanelVCLKIdx300 = VCLK100_300;\n\t\t\t       SiS_Pr->PanelVCLKIdx315 = VCLK100_315;\n\t\t\t    }\n\t\t\t    break;\n     case Panel_1280x1024:  SiS_Pr->PanelXRes = 1280; SiS_Pr->PanelYRes = 1024;\n\t\t\t    SiS_Pr->PanelHT   = 1688; SiS_Pr->PanelVT   = 1066;\n\t\t\t    SiS_Pr->PanelHRS  =   48; SiS_Pr->PanelHRE  =  112;\n\t\t\t    SiS_Pr->PanelVRS  =    1; SiS_Pr->PanelVRE  =    3;\n\t\t\t    SiS_Pr->PanelVCLKIdx300 = VCLK108_3_300;\n\t\t\t    SiS_Pr->PanelVCLKIdx315 = VCLK108_2_315;\n\t\t\t    SiS_GetLCDInfoBIOS(SiS_Pr);\n\t\t\t    break;\n     case Panel_1400x1050:  SiS_Pr->PanelXRes = 1400; SiS_Pr->PanelYRes = 1050;\n\t\t\t    SiS_Pr->PanelHT   = 1688; SiS_Pr->PanelVT   = 1066;\n\t\t\t    SiS_Pr->PanelHRS  =   48; SiS_Pr->PanelHRE  =  112;\n\t\t\t    SiS_Pr->PanelVRS  =    1; SiS_Pr->PanelVRE  =    3;\n\t\t\t    SiS_Pr->PanelVCLKIdx315 = VCLK108_2_315;\n\t\t\t    SiS_GetLCDInfoBIOS(SiS_Pr);\n\t\t\t    break;\n     case Panel_1600x1200:  SiS_Pr->PanelXRes = 1600; SiS_Pr->PanelYRes = 1200;\n\t\t\t    SiS_Pr->PanelHT   = 2160; SiS_Pr->PanelVT   = 1250;\n\t\t\t    SiS_Pr->PanelHRS  =   64; SiS_Pr->PanelHRE  =  192;\n\t\t\t    SiS_Pr->PanelVRS  =    1; SiS_Pr->PanelVRE  =    3;\n\t\t\t    SiS_Pr->PanelVCLKIdx315 = VCLK162_315;\n\t\t\t    if(SiS_Pr->SiS_VBType & VB_SISTMDSLCDA) {\n\t\t\t       if(SiS_Pr->SiS_VBInfo & SetCRT2ToLCDA) {\n\t\t\t\t  SiS_Pr->PanelHT  = 1760; SiS_Pr->PanelVT  = 1235;\n\t\t\t\t  SiS_Pr->PanelHRS =   48; SiS_Pr->PanelHRE =   32;\n\t\t\t\t  SiS_Pr->PanelVRS =    2; SiS_Pr->PanelVRE =    4;\n\t\t\t\t  SiS_Pr->PanelVCLKIdx315 = VCLK130_315;\n\t\t\t\t  SiS_Pr->Alternate1600x1200 = true;\n\t\t\t       }\n\t\t\t    } else if(SiS_Pr->SiS_IF_DEF_LVDS) {\n\t\t\t       SiS_Pr->PanelHT  = 2048; SiS_Pr->PanelVT  = 1320;\n\t\t\t       SiS_Pr->PanelHRS = SiS_Pr->PanelHRE = 999;\n\t\t\t       SiS_Pr->PanelVRS = SiS_Pr->PanelVRE = 999;\n\t\t\t    }\n\t\t\t    SiS_GetLCDInfoBIOS(SiS_Pr);\n\t\t\t    break;\n     case Panel_1680x1050:  SiS_Pr->PanelXRes = 1680; SiS_Pr->PanelYRes = 1050;\n\t\t\t    SiS_Pr->PanelHT   = 1900; SiS_Pr->PanelVT   = 1066;\n\t\t\t    SiS_Pr->PanelHRS  =   26; SiS_Pr->PanelHRE  =   76;\n\t\t\t    SiS_Pr->PanelVRS  =    3; SiS_Pr->PanelVRE  =    6;\n\t\t\t    SiS_Pr->PanelVCLKIdx315 = VCLK121_315;\n\t\t\t    SiS_GetLCDInfoBIOS(SiS_Pr);\n\t\t\t    break;\n     case Panel_Barco1366:  SiS_Pr->PanelXRes = 1360; SiS_Pr->PanelYRes = 1024;\n\t\t\t    SiS_Pr->PanelHT   = 1688; SiS_Pr->PanelVT   = 1066;\n\t\t\t    break;\n     case Panel_848x480:    SiS_Pr->PanelXRes =  848; SiS_Pr->PanelYRes =  480;\n\t\t\t    SiS_Pr->PanelHT   = 1088; SiS_Pr->PanelVT   =  525;\n\t\t\t    break;\n     case Panel_856x480:    SiS_Pr->PanelXRes =  856; SiS_Pr->PanelYRes =  480;\n\t\t\t    SiS_Pr->PanelHT   = 1088; SiS_Pr->PanelVT   =  525;\n\t\t\t    break;\n     case Panel_Custom:     SiS_Pr->PanelXRes = SiS_Pr->CP_MaxX;\n\t\t\t    SiS_Pr->PanelYRes = SiS_Pr->CP_MaxY;\n\t\t\t    SiS_Pr->PanelHT   = SiS_Pr->CHTotal;\n\t\t\t    SiS_Pr->PanelVT   = SiS_Pr->CVTotal;\n\t\t\t    if(SiS_Pr->CP_PreferredIndex != -1) {\n\t\t\t       SiS_Pr->PanelXRes = SiS_Pr->CP_HDisplay[SiS_Pr->CP_PreferredIndex];\n\t\t\t       SiS_Pr->PanelYRes = SiS_Pr->CP_VDisplay[SiS_Pr->CP_PreferredIndex];\n\t\t\t       SiS_Pr->PanelHT   = SiS_Pr->CP_HTotal[SiS_Pr->CP_PreferredIndex];\n\t\t\t       SiS_Pr->PanelVT   = SiS_Pr->CP_VTotal[SiS_Pr->CP_PreferredIndex];\n\t\t\t       SiS_Pr->PanelHRS  = SiS_Pr->CP_HSyncStart[SiS_Pr->CP_PreferredIndex];\n\t\t\t       SiS_Pr->PanelHRE  = SiS_Pr->CP_HSyncEnd[SiS_Pr->CP_PreferredIndex];\n\t\t\t       SiS_Pr->PanelVRS  = SiS_Pr->CP_VSyncStart[SiS_Pr->CP_PreferredIndex];\n\t\t\t       SiS_Pr->PanelVRE  = SiS_Pr->CP_VSyncEnd[SiS_Pr->CP_PreferredIndex];\n\t\t\t       SiS_Pr->PanelHRS -= SiS_Pr->PanelXRes;\n\t\t\t       SiS_Pr->PanelHRE -= SiS_Pr->PanelHRS;\n\t\t\t       SiS_Pr->PanelVRS -= SiS_Pr->PanelYRes;\n\t\t\t       SiS_Pr->PanelVRE -= SiS_Pr->PanelVRS;\n\t\t\t       if(SiS_Pr->CP_PrefClock) {\n\t\t\t\t  int idx;\n\t\t\t\t  SiS_Pr->PanelVCLKIdx315 = VCLK_CUSTOM_315;\n\t\t\t\t  SiS_Pr->PanelVCLKIdx300 = VCLK_CUSTOM_300;\n\t\t\t\t  if(SiS_Pr->ChipType < SIS_315H) idx = VCLK_CUSTOM_300;\n\t\t\t\t  else\t\t\t\t   idx = VCLK_CUSTOM_315;\n\t\t\t\t  SiS_Pr->SiS_VCLKData[idx].CLOCK =\n\t\t\t\t     SiS_Pr->SiS_VBVCLKData[idx].CLOCK = SiS_Pr->CP_PrefClock;\n\t\t\t\t  SiS_Pr->SiS_VCLKData[idx].SR2B =\n\t\t\t\t     SiS_Pr->SiS_VBVCLKData[idx].Part4_A = SiS_Pr->CP_PrefSR2B;\n\t\t\t\t  SiS_Pr->SiS_VCLKData[idx].SR2C =\n\t\t\t\t     SiS_Pr->SiS_VBVCLKData[idx].Part4_B = SiS_Pr->CP_PrefSR2C;\n\t\t\t       }\n\t\t\t    }\n\t\t\t    break;\n     default:\t\t    SiS_Pr->PanelXRes = 1024; SiS_Pr->PanelYRes =  768;\n\t\t\t    SiS_Pr->PanelHT   = 1344; SiS_Pr->PanelVT   =  806;\n\t\t\t    break;\n  }\n\n   \n  if( (SiS_Pr->SiS_IF_DEF_FSTN)              ||\n      (SiS_Pr->SiS_IF_DEF_DSTN)              ||\n      (SiS_Pr->SiS_CustomT == CUT_BARCO1366) ||\n      (SiS_Pr->SiS_CustomT == CUT_BARCO1024) ||\n      (SiS_Pr->SiS_CustomT == CUT_PANEL848)  ||\n      (SiS_Pr->SiS_CustomT == CUT_PANEL856) ) {\n     SiS_Pr->PanelHRS = 999;\n     SiS_Pr->PanelHRE = 999;\n  }\n\n  if( (SiS_Pr->SiS_CustomT == CUT_BARCO1366) ||\n      (SiS_Pr->SiS_CustomT == CUT_BARCO1024) ||\n      (SiS_Pr->SiS_CustomT == CUT_PANEL848)  ||\n      (SiS_Pr->SiS_CustomT == CUT_PANEL856) ) {\n     SiS_Pr->PanelVRS = 999;\n     SiS_Pr->PanelVRE = 999;\n  }\n\n   \n  if((SiS_Pr->SiS_VBType & VB_SISVB) && (!(SiS_Pr->SiS_VBType & VB_NoLCD))) {\n\n     if((SiS_Pr->SiS_VBInfo & SetCRT2ToLCD) && (modeflag & NoSupportLCDScale)) {\n\t \n\tSiS_Pr->SiS_LCDInfo |= DontExpandLCD;\n     }\n\n     switch(SiS_Pr->SiS_LCDResInfo) {\n\n     case Panel_Custom:\n     case Panel_1152x864:\n     case Panel_1280x768:\t \n\tSiS_Pr->SiS_LCDInfo |= DontExpandLCD;\n\tbreak;\n\n     case Panel_800x600: {\n\tstatic const unsigned char nonscalingmodes[] = {\n\t   SIS_RI_720x480, SIS_RI_720x576, SIS_RI_768x576, SIS_RI_800x480, 0xff\n\t};\n\tSiS_CheckScaling(SiS_Pr, resinfo, nonscalingmodes);\n\tbreak;\n     }\n     case Panel_1024x768: {\n\tstatic const unsigned char nonscalingmodes[] = {\n\t   SIS_RI_720x480, SIS_RI_720x576, SIS_RI_768x576, SIS_RI_800x480, SIS_RI_848x480,\n\t   SIS_RI_856x480, SIS_RI_960x540, SIS_RI_960x600, SIS_RI_1024x576,SIS_RI_1024x600,\n\t   0xff\n\t};\n\tSiS_CheckScaling(SiS_Pr, resinfo, nonscalingmodes);\n\tbreak;\n     }\n     case Panel_1280x720: {\n\tstatic const unsigned char nonscalingmodes[] = {\n\t   SIS_RI_720x480, SIS_RI_720x576, SIS_RI_768x576, SIS_RI_800x480, SIS_RI_848x480,\n\t   SIS_RI_856x480, SIS_RI_960x540, SIS_RI_960x600, SIS_RI_1024x576,SIS_RI_1024x600,\n\t   0xff\n\t};\n\tSiS_CheckScaling(SiS_Pr, resinfo, nonscalingmodes);\n\tif(SiS_Pr->PanelHT == 1650) {\n\t   SiS_Pr->SiS_LCDInfo |= DontExpandLCD;\n\t}\n\tbreak;\n     }\n     case Panel_1280x768_2: {   \n\tstatic const unsigned char nonscalingmodes[] = {\n\t   SIS_RI_720x480, SIS_RI_720x576, SIS_RI_768x576, SIS_RI_800x480, SIS_RI_848x480,\n\t   SIS_RI_856x480, SIS_RI_960x540, SIS_RI_960x600, SIS_RI_1024x576,SIS_RI_1024x600,\n\t   SIS_RI_1152x768,0xff\n\t};\n\tSiS_CheckScaling(SiS_Pr, resinfo, nonscalingmodes);\n\tswitch(resinfo) {\n\tcase SIS_RI_1280x720:  if(SiS_Pr->UsePanelScaler == -1) {\n\t\t\t\t  SiS_Pr->SiS_LCDInfo |= DontExpandLCD;\n\t\t\t       }\n\t\t\t       break;\n\t}\n\tbreak;\n     }\n     case Panel_1280x800: {  \t \n\tstatic const unsigned char nonscalingmodes[] = {\n\t   SIS_RI_720x480, SIS_RI_720x576, SIS_RI_768x576, SIS_RI_800x480, SIS_RI_848x480,\n\t   SIS_RI_856x480, SIS_RI_960x540, SIS_RI_960x600, SIS_RI_1024x576,SIS_RI_1024x600,\n\t   SIS_RI_1152x768,SIS_RI_1280x720,SIS_RI_1280x768,0xff\n\t};\n\tSiS_CheckScaling(SiS_Pr, resinfo, nonscalingmodes);\n\tbreak;\n     }\n     case Panel_1280x800_2:  { \t \n\tstatic const unsigned char nonscalingmodes[] = {\n\t   SIS_RI_720x480, SIS_RI_720x576, SIS_RI_768x576, SIS_RI_800x480, SIS_RI_848x480,\n\t   SIS_RI_856x480, SIS_RI_960x540, SIS_RI_960x600, SIS_RI_1024x576,SIS_RI_1024x600,\n\t   SIS_RI_1152x768,0xff\n\t};\n\tSiS_CheckScaling(SiS_Pr, resinfo, nonscalingmodes);\n\tswitch(resinfo) {\n\tcase SIS_RI_1280x720:\n\tcase SIS_RI_1280x768:  if(SiS_Pr->UsePanelScaler == -1) {\n\t\t\t\t  SiS_Pr->SiS_LCDInfo |= DontExpandLCD;\n\t\t\t       }\n\t\t\t       break;\n\t}\n\tbreak;\n     }\n     case Panel_1280x854: {  \t \n\tstatic const unsigned char nonscalingmodes[] = {\n\t   SIS_RI_720x480, SIS_RI_720x576, SIS_RI_768x576, SIS_RI_800x480, SIS_RI_848x480,\n\t   SIS_RI_856x480, SIS_RI_960x540, SIS_RI_960x600, SIS_RI_1024x576,SIS_RI_1024x600,\n\t   SIS_RI_1152x768,0xff\n\t};\n\tSiS_CheckScaling(SiS_Pr, resinfo, nonscalingmodes);\n\tswitch(resinfo) {\n\tcase SIS_RI_1280x720:\n\tcase SIS_RI_1280x768:\n\tcase SIS_RI_1280x800:  if(SiS_Pr->UsePanelScaler == -1) {\n\t\t\t\t  SiS_Pr->SiS_LCDInfo |= DontExpandLCD;\n\t\t\t       }\n\t\t\t       break;\n\t}\n\tbreak;\n     }\n     case Panel_1280x960: {\n\tstatic const unsigned char nonscalingmodes[] = {\n\t   SIS_RI_720x480, SIS_RI_720x576, SIS_RI_768x576, SIS_RI_800x480, SIS_RI_848x480,\n\t   SIS_RI_856x480, SIS_RI_960x540, SIS_RI_960x600, SIS_RI_1024x576,SIS_RI_1024x600,\n\t   SIS_RI_1152x768,SIS_RI_1152x864,SIS_RI_1280x720,SIS_RI_1280x768,SIS_RI_1280x800,\n\t   SIS_RI_1280x854,0xff\n\t};\n\tSiS_CheckScaling(SiS_Pr, resinfo, nonscalingmodes);\n\tbreak;\n     }\n     case Panel_1280x1024: {\n\tstatic const unsigned char nonscalingmodes[] = {\n\t   SIS_RI_720x480, SIS_RI_720x576, SIS_RI_768x576, SIS_RI_800x480, SIS_RI_848x480,\n\t   SIS_RI_856x480, SIS_RI_960x540, SIS_RI_960x600, SIS_RI_1024x576,SIS_RI_1024x600,\n\t   SIS_RI_1152x768,SIS_RI_1152x864,SIS_RI_1280x720,SIS_RI_1280x768,SIS_RI_1280x800,\n\t   SIS_RI_1280x854,SIS_RI_1280x960,0xff\n\t};\n\tSiS_CheckScaling(SiS_Pr, resinfo, nonscalingmodes);\n\tbreak;\n     }\n     case Panel_1400x1050: {\n\tstatic const unsigned char nonscalingmodes[] = {\n\t     SIS_RI_720x480, SIS_RI_720x576, SIS_RI_768x576, SIS_RI_800x480, SIS_RI_848x480,\n\t     SIS_RI_856x480, SIS_RI_960x540, SIS_RI_960x600, SIS_RI_1024x576,SIS_RI_1024x600,\n\t     SIS_RI_1152x768,SIS_RI_1152x864,SIS_RI_1280x768,SIS_RI_1280x800,SIS_RI_1280x854,\n\t     SIS_RI_1280x960,0xff\n\t};\n\tSiS_CheckScaling(SiS_Pr, resinfo, nonscalingmodes);\n\tswitch(resinfo) {\n\tcase SIS_RI_1280x720:  if(SiS_Pr->UsePanelScaler == -1) {\n\t\t\t\t  SiS_Pr->SiS_LCDInfo |= DontExpandLCD;\n\t\t\t       }\n\t\t\t       break;\n\tcase SIS_RI_1280x1024: SiS_Pr->SiS_LCDInfo |= DontExpandLCD;\n\t\t\t       break;\n\t}\n\tbreak;\n     }\n     case Panel_1600x1200: {\n\tstatic const unsigned char nonscalingmodes[] = {\n\t     SIS_RI_720x480, SIS_RI_720x576, SIS_RI_768x576, SIS_RI_800x480, SIS_RI_848x480,\n\t     SIS_RI_856x480, SIS_RI_960x540, SIS_RI_960x600, SIS_RI_1024x576,SIS_RI_1024x600,\n\t     SIS_RI_1152x768,SIS_RI_1152x864,SIS_RI_1280x720,SIS_RI_1280x768,SIS_RI_1280x800,\n\t     SIS_RI_1280x854,SIS_RI_1280x960,SIS_RI_1360x768,SIS_RI_1360x1024,0xff\n\t};\n\tSiS_CheckScaling(SiS_Pr, resinfo, nonscalingmodes);\n\tbreak;\n     }\n     case Panel_1680x1050: {\n\tstatic const unsigned char nonscalingmodes[] = {\n\t     SIS_RI_720x480, SIS_RI_720x576, SIS_RI_768x576, SIS_RI_800x480, SIS_RI_848x480,\n\t     SIS_RI_856x480, SIS_RI_960x540, SIS_RI_960x600, SIS_RI_1024x576,SIS_RI_1024x600,\n\t     SIS_RI_1152x768,SIS_RI_1152x864,SIS_RI_1280x854,SIS_RI_1280x960,SIS_RI_1360x768,\n\t     SIS_RI_1360x1024,0xff\n\t};\n\tSiS_CheckScaling(SiS_Pr, resinfo, nonscalingmodes);\n\tbreak;\n     }\n     }\n  }\n\n#ifdef CONFIG_FB_SIS_300\n  if(SiS_Pr->SiS_IF_DEF_LVDS == 1) {\n     if(SiS_Pr->SiS_CustomT == CUT_PANEL848 || SiS_Pr->SiS_CustomT == CUT_PANEL856) {\n\tSiS_Pr->SiS_LCDInfo = 0x80 | 0x40 | 0x20;    \n     }\n  }\n\n  if(SiS_Pr->ChipType < SIS_315H) {\n     if(SiS_Pr->SiS_IF_DEF_LVDS == 1) {\n\tif(SiS_Pr->SiS_UseROM) {\n\t   if((ROMAddr[0x233] == 0x12) && (ROMAddr[0x234] == 0x34)) {\n\t      if(!(ROMAddr[0x235] & 0x02)) {\n\t\t SiS_Pr->SiS_LCDInfo &= (~DontExpandLCD);\n\t      }\n\t   }\n\t}\n     } else if(SiS_Pr->SiS_VBType & VB_SIS30xBLV) {\n\tif((SiS_Pr->SiS_SetFlag & SetDOSMode) && ((ModeNo == 0x03) || (ModeNo == 0x10))) {\n\t   SiS_Pr->SiS_LCDInfo &= (~DontExpandLCD);\n\t}\n     }\n  }\n#endif\n\n   \n\n  if(modexres == SiS_Pr->PanelXRes && modeyres == SiS_Pr->PanelYRes) {\n     SiS_Pr->SiS_LCDInfo &= ~LCDPass11;\n  }\n\n  if(SiS_Pr->SiS_IF_DEF_TRUMPION) {\n     SiS_Pr->SiS_LCDInfo |= (DontExpandLCD | LCDPass11);\n  }\n\n  switch(SiS_Pr->SiS_LCDResInfo) {\n  case Panel_640x480:\n     SiS_Pr->SiS_LCDInfo |= (DontExpandLCD | LCDPass11);\n     break;\n  case Panel_1280x800:\n      \n     if(SiS_Pr->CenterScreen == -1) SiS_Pr->SiS_LCDInfo &= ~LCDPass11;\n     break;\n  case Panel_1280x960:\n     SiS_Pr->SiS_LCDInfo &= ~LCDPass11;\n     break;\n  case Panel_Custom:\n     if((!SiS_Pr->CP_PrefClock) ||\n        (modexres > SiS_Pr->PanelXRes) || (modeyres > SiS_Pr->PanelYRes)) {\n        SiS_Pr->SiS_LCDInfo |= LCDPass11;\n     }\n     break;\n  }\n\n  if((SiS_Pr->UseCustomMode) || (SiS_Pr->SiS_CustomT == CUT_UNKNOWNLCD)) {\n     SiS_Pr->SiS_LCDInfo |= (DontExpandLCD | LCDPass11);\n  }\n\n   \n  if(!(SiS_Pr->SiS_LCDInfo & DontExpandLCD)) {\n     SiS_Pr->SiS_LCDInfo &= ~LCDPass11;\n  }\n\n   \n  if(!((SiS_Pr->ChipType < SIS_315H) && (SiS_Pr->SiS_SetFlag & SetDOSMode))) {\n\n     if((SiS_Pr->SiS_IF_DEF_LVDS == 1) || (SiS_Pr->SiS_VBType & VB_NoLCD)) {\n\tif(SiS_Pr->SiS_IF_DEF_TRUMPION == 0) {\n\t   if(ModeNo == 0x12) {\n\t      if(SiS_Pr->SiS_LCDInfo & LCDPass11) {\n\t\t SiS_Pr->SiS_SetFlag |= EnableLVDSDDA;\n\t      }\n\t   } else if(ModeNo > 0x13) {\n\t      if(SiS_Pr->SiS_LCDResInfo == Panel_1024x600) {\n\t\t if(!(SiS_Pr->SiS_LCDInfo & DontExpandLCD)) {\n\t\t    if((resinfo == SIS_RI_800x600) || (resinfo == SIS_RI_400x300)) {\n\t\t       SiS_Pr->SiS_SetFlag |= EnableLVDSDDA;\n\t\t    }\n\t\t }\n\t      }\n\t   }\n\t}\n     }\n\n     if(modeflag & HalfDCLK) {\n\tif(SiS_Pr->SiS_IF_DEF_TRUMPION == 1) {\n\t   SiS_Pr->SiS_SetFlag |= EnableLVDSDDA;\n\t} else if(SiS_Pr->SiS_LCDInfo & DontExpandLCD) {\n\t   SiS_Pr->SiS_SetFlag |= EnableLVDSDDA;\n\t} else if(SiS_Pr->SiS_LCDResInfo == Panel_640x480) {\n\t   SiS_Pr->SiS_SetFlag |= EnableLVDSDDA;\n\t} else if(ModeNo > 0x13) {\n\t   if(SiS_Pr->SiS_LCDResInfo == Panel_1024x768) {\n\t      if(resinfo == SIS_RI_512x384) SiS_Pr->SiS_SetFlag |= EnableLVDSDDA;\n\t   } else if(SiS_Pr->SiS_LCDResInfo == Panel_800x600) {\n\t      if(resinfo == SIS_RI_400x300) SiS_Pr->SiS_SetFlag |= EnableLVDSDDA;\n\t   }\n\t}\n     }\n\n  }\n\n   \n  if(SiS_Pr->SiS_VBInfo & SetInSlaveMode) {\n     if(SiS_Pr->SiS_VBInfo & SetNotSimuMode) {\n\tSiS_Pr->SiS_SetFlag |= LCDVESATiming;\n     }\n  } else {\n     SiS_Pr->SiS_SetFlag |= LCDVESATiming;\n  }\n\n#if 0\n  printk(KERN_DEBUG \"sisfb: (LCDInfo=0x%04x LCDResInfo=0x%02x LCDTypeInfo=0x%02x)\\n\",\n\tSiS_Pr->SiS_LCDInfo, SiS_Pr->SiS_LCDResInfo, SiS_Pr->SiS_LCDTypeInfo);\n#endif\n}\n\n \n \n \n\nunsigned short\nSiS_GetVCLK2Ptr(struct SiS_Private *SiS_Pr, unsigned short ModeNo, unsigned short ModeIdIndex,\n\t\tunsigned short RefreshRateTableIndex)\n{\n  unsigned short CRT2Index, VCLKIndex = 0, VCLKIndexGEN = 0, VCLKIndexGENCRT = 0;\n  unsigned short resinfo, tempbx;\n  const unsigned char *CHTVVCLKPtr = NULL;\n\n  if(ModeNo <= 0x13) {\n     resinfo = SiS_Pr->SiS_SModeIDTable[ModeIdIndex].St_ResInfo;\n     CRT2Index = SiS_Pr->SiS_SModeIDTable[ModeIdIndex].St_CRT2CRTC;\n     VCLKIndexGEN = (SiS_GetRegByte((SiS_Pr->SiS_P3ca+0x02)) >> 2) & 0x03;\n     VCLKIndexGENCRT = VCLKIndexGEN;\n  } else {\n     resinfo = SiS_Pr->SiS_EModeIDTable[ModeIdIndex].Ext_RESINFO;\n     CRT2Index = SiS_Pr->SiS_RefIndex[RefreshRateTableIndex].Ext_CRT2CRTC;\n     VCLKIndexGEN = SiS_Pr->SiS_RefIndex[RefreshRateTableIndex].Ext_CRTVCLK;\n     VCLKIndexGENCRT = SiS_GetRefCRTVCLK(SiS_Pr, RefreshRateTableIndex,\n\t\t(SiS_Pr->SiS_SetFlag & ProgrammingCRT2) ? SiS_Pr->SiS_UseWideCRT2 : SiS_Pr->SiS_UseWide);\n  }\n\n  if(SiS_Pr->SiS_VBType & VB_SISVB) {     \n\n     if(SiS_Pr->SiS_SetFlag & ProgrammingCRT2) {\n\n\tCRT2Index >>= 6;\n\tif(SiS_Pr->SiS_VBInfo & (SetCRT2ToLCD | SetCRT2ToLCDA)) {      \t \n\n\t   if(SiS_Pr->ChipType < SIS_315H) {\n\t      VCLKIndex = SiS_Pr->PanelVCLKIdx300;\n\t      if((SiS_Pr->SiS_LCDInfo & DontExpandLCD) && (SiS_Pr->SiS_LCDInfo & LCDPass11)) {\n\t\t VCLKIndex = VCLKIndexGEN;\n\t      }\n\t   } else {\n\t      VCLKIndex = SiS_Pr->PanelVCLKIdx315;\n\t      if((SiS_Pr->SiS_LCDInfo & DontExpandLCD) && (SiS_Pr->SiS_LCDInfo & LCDPass11)) {\n\t\t switch(resinfo) {\n\t\t  \n\t\t case SIS_RI_720x480:  VCLKIndex = VCLK_720x480;  break;\n\t\t case SIS_RI_720x576:  VCLKIndex = VCLK_720x576;  break;\n\t\t case SIS_RI_768x576:  VCLKIndex = VCLK_768x576;  break;\n\t\t case SIS_RI_848x480:  VCLKIndex = VCLK_848x480;  break;\n\t\t case SIS_RI_856x480:  VCLKIndex = VCLK_856x480;  break;\n\t\t case SIS_RI_800x480:  VCLKIndex = VCLK_800x480;  break;\n\t\t case SIS_RI_1024x576: VCLKIndex = VCLK_1024x576; break;\n\t\t case SIS_RI_1152x864: VCLKIndex = VCLK_1152x864; break;\n\t\t case SIS_RI_1280x720: VCLKIndex = VCLK_1280x720; break;\n\t\t case SIS_RI_1360x768: VCLKIndex = VCLK_1360x768; break;\n\t\t default:              VCLKIndex = VCLKIndexGEN;\n\t\t }\n\n\t\t if(ModeNo <= 0x13) {\n\t\t    if(SiS_Pr->ChipType <= SIS_315PRO) {\n\t\t       if(SiS_Pr->SiS_SModeIDTable[ModeIdIndex].St_CRT2CRTC == 1) VCLKIndex = 0x42;\n\t\t    } else {\n\t\t       if(SiS_Pr->SiS_SModeIDTable[ModeIdIndex].St_CRT2CRTC == 1) VCLKIndex = 0x00;\n\t\t    }\n\t\t }\n\t\t if(SiS_Pr->ChipType <= SIS_315PRO) {\n\t\t    if(VCLKIndex == 0) VCLKIndex = 0x41;\n\t\t    if(VCLKIndex == 1) VCLKIndex = 0x43;\n\t\t    if(VCLKIndex == 4) VCLKIndex = 0x44;\n\t\t }\n\t      }\n\t   }\n\n\t} else if(SiS_Pr->SiS_VBInfo & SetCRT2ToTV) {                 \t \n\n\t   if(SiS_Pr->SiS_VBInfo & SetCRT2ToHiVision) {\n\t      if(SiS_Pr->SiS_TVMode & TVRPLLDIV2XO) \t   VCLKIndex = HiTVVCLKDIV2;\n\t      else                                  \t   VCLKIndex = HiTVVCLK;\n\t      if(SiS_Pr->SiS_TVMode & TVSetTVSimuMode)     VCLKIndex = HiTVSimuVCLK;\n\t   } else if(SiS_Pr->SiS_TVMode & TVSetYPbPr750p)  VCLKIndex = YPbPr750pVCLK;\n\t   else if(SiS_Pr->SiS_TVMode & TVSetYPbPr525p)    VCLKIndex = TVVCLKDIV2;\n\t   else if(SiS_Pr->SiS_TVMode & TVRPLLDIV2XO)      VCLKIndex = TVVCLKDIV2;\n\t   else\t\t\t\t\t\t   VCLKIndex = TVVCLK;\n\n\t   if(SiS_Pr->ChipType < SIS_315H) VCLKIndex += TVCLKBASE_300;\n\t   else\t\t\t\t   VCLKIndex += TVCLKBASE_315;\n\n\t} else {\t\t\t\t\t\t\t \n\n\t   VCLKIndex = VCLKIndexGENCRT;\n\t   if(SiS_Pr->ChipType < SIS_315H) {\n\t      if(ModeNo > 0x13) {\n\t\t if( (SiS_Pr->ChipType == SIS_630) &&\n\t\t     (SiS_Pr->ChipRevision >= 0x30)) {\n\t\t    if(VCLKIndex == 0x14) VCLKIndex = 0x34;\n\t\t }\n\t\t  \n\t\t if(VCLKIndex == 0x17) VCLKIndex = 0x45;\n\t      }\n\t   }\n\t}\n\n     } else {    \n\n\tVCLKIndex = VCLKIndexGENCRT;\n\tif(SiS_Pr->ChipType < SIS_315H) {\n\t   if(ModeNo > 0x13) {\n\t      if( (SiS_Pr->ChipType != SIS_630) &&\n\t\t  (SiS_Pr->ChipType != SIS_300) ) {\n\t\t if(VCLKIndex == 0x1b) VCLKIndex = 0x48;\n\t      }\n\t   }\n\t}\n     }\n\n  } else {        \n\n     VCLKIndex = CRT2Index;\n\n     if(SiS_Pr->SiS_SetFlag & ProgrammingCRT2) {\n\n\tif( (SiS_Pr->SiS_IF_DEF_CH70xx != 0) && (SiS_Pr->SiS_VBInfo & SetCRT2ToTV) ) {\n\n\t   VCLKIndex &= 0x1f;\n\t   tempbx = 0;\n\t   if(SiS_Pr->SiS_TVMode & TVSetCHOverScan) tempbx += 1;\n\t   if(SiS_Pr->SiS_TVMode & TVSetPAL) {\n\t      tempbx += 2;\n\t      if(SiS_Pr->SiS_ModeType > ModeVGA) {\n\t\t if(SiS_Pr->SiS_CHSOverScan) tempbx = 8;\n\t      }\n\t      if(SiS_Pr->SiS_TVMode & TVSetPALM) {\n\t\t tempbx = 4;\n\t\t if(SiS_Pr->SiS_TVMode & TVSetCHOverScan) tempbx += 1;\n\t      } else if(SiS_Pr->SiS_TVMode & TVSetPALN) {\n\t\t tempbx = 6;\n\t\t if(SiS_Pr->SiS_TVMode & TVSetCHOverScan) tempbx += 1;\n\t      }\n\t   }\n\t   switch(tempbx) {\n\t     case  0: CHTVVCLKPtr = SiS_Pr->SiS_CHTVVCLKUNTSC;  break;\n\t     case  1: CHTVVCLKPtr = SiS_Pr->SiS_CHTVVCLKONTSC;  break;\n\t     case  2: CHTVVCLKPtr = SiS_Pr->SiS_CHTVVCLKUPAL;   break;\n\t     case  3: CHTVVCLKPtr = SiS_Pr->SiS_CHTVVCLKOPAL;   break;\n\t     case  4: CHTVVCLKPtr = SiS_Pr->SiS_CHTVVCLKUPALM;  break;\n\t     case  5: CHTVVCLKPtr = SiS_Pr->SiS_CHTVVCLKOPALM;  break;\n\t     case  6: CHTVVCLKPtr = SiS_Pr->SiS_CHTVVCLKUPALN;  break;\n\t     case  7: CHTVVCLKPtr = SiS_Pr->SiS_CHTVVCLKOPALN;  break;\n\t     case  8: CHTVVCLKPtr = SiS_Pr->SiS_CHTVVCLKSOPAL;  break;\n\t     default: CHTVVCLKPtr = SiS_Pr->SiS_CHTVVCLKOPAL;   break;\n\t   }\n\t   VCLKIndex = CHTVVCLKPtr[VCLKIndex];\n\n\t} else if(SiS_Pr->SiS_VBInfo & SetCRT2ToLCD) {\n\n\t   if(SiS_Pr->ChipType < SIS_315H) {\n\t      VCLKIndex = SiS_Pr->PanelVCLKIdx300;\n\t   } else {\n\t      VCLKIndex = SiS_Pr->PanelVCLKIdx315;\n\t   }\n\n#ifdef CONFIG_FB_SIS_300\n\t    \n\t   if(SiS_Pr->SiS_CustomT == CUT_BARCO1366) VCLKIndex = 0x44;\n\n\t    \n\t   if(SiS_Pr->SiS_CustomT == CUT_PANEL848 || SiS_Pr->SiS_CustomT == CUT_PANEL856) {\n\t      if(SiS_Pr->ChipType < SIS_315H) {\n\t\t VCLKIndex = VCLK34_300;\n\t\t  \n\t      } else {\n\t\t VCLKIndex = VCLK34_315;\n\t\t  \n\t      }\n\t   }\n#endif\n\n\t} else {\n\n\t   VCLKIndex = VCLKIndexGENCRT;\n\t   if(SiS_Pr->ChipType < SIS_315H) {\n\t      if(ModeNo > 0x13) {\n\t\t if( (SiS_Pr->ChipType == SIS_630) &&\n\t\t     (SiS_Pr->ChipRevision >= 0x30) ) {\n\t\t    if(VCLKIndex == 0x14) VCLKIndex = 0x2e;\n\t\t }\n\t      }\n\t   }\n\t}\n\n     } else {   \n\n\tVCLKIndex = VCLKIndexGENCRT;\n\tif(SiS_Pr->ChipType < SIS_315H) {\n\t   if(ModeNo > 0x13) {\n\t      if( (SiS_Pr->ChipType != SIS_630) &&\n\t\t  (SiS_Pr->ChipType != SIS_300) ) {\n\t\t if(VCLKIndex == 0x1b) VCLKIndex = 0x48;\n\t      }\n#if 0\n\t      if(SiS_Pr->ChipType == SIS_730) {\n\t\t if(VCLKIndex == 0x0b) VCLKIndex = 0x40;    \n\t\t if(VCLKIndex == 0x0d) VCLKIndex = 0x41;    \n\t      }\n#endif\n\t   }\n        }\n\n     }\n\n  }\n\n  return VCLKIndex;\n}\n\n \n \n \n\nstatic void\nSiS_SetCRT2ModeRegs(struct SiS_Private *SiS_Pr, unsigned short ModeNo, unsigned short ModeIdIndex)\n{\n  unsigned short i, j, modeflag, tempah=0;\n  short tempcl;\n#if defined(CONFIG_FB_SIS_300) || defined(CONFIG_FB_SIS_315)\n  unsigned short tempbl;\n#endif\n#ifdef CONFIG_FB_SIS_315\n  unsigned char  *ROMAddr = SiS_Pr->VirtualRomBase;\n  unsigned short tempah2, tempbl2;\n#endif\n\n  modeflag = SiS_GetModeFlag(SiS_Pr, ModeNo, ModeIdIndex);\n\n  if(SiS_Pr->SiS_VBInfo & SetCRT2ToLCDA) {\n\n     SiS_SetRegANDOR(SiS_Pr->SiS_Part1Port,0x00,0xAF,0x40);\n     SiS_SetRegAND(SiS_Pr->SiS_Part1Port,0x2E,0xF7);\n\n  } else {\n\n     for(i=0,j=4; i<3; i++,j++) SiS_SetReg(SiS_Pr->SiS_Part1Port,j,0);\n     if(SiS_Pr->ChipType >= SIS_315H) {\n        SiS_SetRegAND(SiS_Pr->SiS_Part1Port,0x02,0x7F);\n     }\n\n     tempcl = SiS_Pr->SiS_ModeType;\n\n     if(SiS_Pr->ChipType < SIS_315H) {\n\n#ifdef CONFIG_FB_SIS_300     \n\n\t \n\tif(SiS_Pr->SiS_VBType & VB_NoLCD) {\n\t   tempbl = SiS_GetReg(SiS_Pr->SiS_P3c4,0x32);\n\t   tempbl &= 0xef;\n\t   tempbl |= 0x02;\n\t   if((SiS_Pr->SiS_VBInfo & SetCRT2ToTV) || (SiS_Pr->SiS_VBInfo & SetCRT2ToRAMDAC)) {\n\t      tempbl |= 0x10;\n\t      tempbl &= 0xfd;\n\t   }\n\t   SiS_SetReg(SiS_Pr->SiS_P3c4,0x32,tempbl);\n\t}\n\n\tif(ModeNo > 0x13) {\n\t   tempcl -= ModeVGA;\n\t   if(tempcl >= 0) {\n\t      tempah = ((0x10 >> tempcl) | 0x80);\n\t   }\n\t} else tempah = 0x80;\n\n\tif(SiS_Pr->SiS_VBInfo & SetInSlaveMode)  tempah ^= 0xA0;\n\n#endif   \n\n     } else {\n\n#ifdef CONFIG_FB_SIS_315     \n\n\tif(ModeNo > 0x13) {\n\t   tempcl -= ModeVGA;\n\t   if(tempcl >= 0) {\n\t      tempah = (0x08 >> tempcl);\n\t      if (tempah == 0) tempah = 1;\n\t      tempah |= 0x40;\n\t   }\n\t} else tempah = 0x40;\n\n\tif(SiS_Pr->SiS_VBInfo & SetInSlaveMode) tempah ^= 0x50;\n\n#endif   \n\n     }\n\n     if(SiS_Pr->SiS_VBInfo & DisableCRT2Display) tempah = 0;\n\n     if(SiS_Pr->ChipType < SIS_315H) {\n\tSiS_SetReg(SiS_Pr->SiS_Part1Port,0x00,tempah);\n     } else {\n#ifdef CONFIG_FB_SIS_315\n\tif(SiS_Pr->SiS_IF_DEF_LVDS == 1) {\n\t   SiS_SetRegANDOR(SiS_Pr->SiS_Part1Port,0x00,0xa0,tempah);\n\t} else if(SiS_Pr->SiS_VBType & VB_SISVB) {\n\t   if(IS_SIS740) {\n\t      SiS_SetReg(SiS_Pr->SiS_Part1Port,0x00,tempah);\n\t   } else {\n\t      SiS_SetRegANDOR(SiS_Pr->SiS_Part1Port,0x00,0xa0,tempah);\n\t   }\n\t}\n#endif\n     }\n\n     if(SiS_Pr->SiS_VBType & VB_SISVB) {\n\n\ttempah = 0x01;\n\tif(!(SiS_Pr->SiS_VBInfo & SetInSlaveMode)) {\n\t   tempah |= 0x02;\n\t}\n\tif(!(SiS_Pr->SiS_VBInfo & SetCRT2ToRAMDAC)) {\n\t   tempah ^= 0x05;\n\t   if(!(SiS_Pr->SiS_VBInfo & SetCRT2ToLCD)) {\n\t      tempah ^= 0x01;\n\t   }\n\t}\n\n\tif(SiS_Pr->ChipType < SIS_315H) {\n\n\t   if(SiS_Pr->SiS_VBInfo & DisableCRT2Display)  tempah = 0;\n\n\t   tempah = (tempah << 5) & 0xFF;\n\t   SiS_SetReg(SiS_Pr->SiS_Part1Port,0x01,tempah);\n\t   tempah = (tempah >> 5) & 0xFF;\n\n\t} else {\n\n\t   if(SiS_Pr->SiS_VBInfo & DisableCRT2Display)  tempah = 0x08;\n\t   else if(!(SiS_IsDualEdge(SiS_Pr)))           tempah |= 0x08;\n\t   SiS_SetRegANDOR(SiS_Pr->SiS_Part1Port,0x2E,0xF0,tempah);\n\t   tempah &= ~0x08;\n\n\t}\n\n\tif((SiS_Pr->SiS_ModeType == ModeVGA) && (!(SiS_Pr->SiS_VBInfo & SetInSlaveMode))) {\n\t   tempah |= 0x10;\n\t}\n\n\ttempah |= 0x80;\n\tif(SiS_Pr->SiS_VBType & VB_SIS301) {\n\t   if(SiS_Pr->PanelXRes < 1280 && SiS_Pr->PanelYRes < 960) tempah &= ~0x80;\n\t}\n\n\tif(SiS_Pr->SiS_VBInfo & SetCRT2ToTV) {\n\t   if(!(SiS_Pr->SiS_TVMode & (TVSetYPbPr750p | TVSetYPbPr525p))) {\n\t      if(SiS_Pr->SiS_VBInfo & SetInSlaveMode) {\n\t\t tempah |= 0x20;\n\t      }\n\t   }\n\t}\n\n\tSiS_SetRegANDOR(SiS_Pr->SiS_Part4Port,0x0D,0x40,tempah);\n\n\ttempah = 0x80;\n\tif(SiS_Pr->SiS_VBType & VB_SIS301) {\n\t   if(SiS_Pr->PanelXRes < 1280 && SiS_Pr->PanelYRes < 960) tempah = 0;\n\t}\n\n\tif(SiS_IsDualLink(SiS_Pr)) tempah |= 0x40;\n\n\tif(SiS_Pr->SiS_VBInfo & SetCRT2ToTV) {\n\t   if(SiS_Pr->SiS_TVMode & TVRPLLDIV2XO) {\n\t      tempah |= 0x40;\n\t   }\n\t}\n\n\tSiS_SetReg(SiS_Pr->SiS_Part4Port,0x0C,tempah);\n\n     } else {   \n\n\tif(SiS_Pr->ChipType >= SIS_315H) {\n\n#ifdef CONFIG_FB_SIS_315\n\t    \n\t   tempah = 0x80;\n\t   if((modeflag & CRT2Mode) && (SiS_Pr->SiS_ModeType > ModeVGA)) {\n\t      if(SiS_Pr->SiS_VBInfo & DriverMode) {\n\t         tempah |= 0x02;\n\t      }\n\t   }\n\n\t   if(!(SiS_Pr->SiS_VBInfo & SetInSlaveMode))  tempah |= 0x02;\n\n\t   if(SiS_Pr->SiS_VBInfo & SetCRT2ToTV)        tempah ^= 0x01;\n\n\t   if(SiS_Pr->SiS_VBInfo & DisableCRT2Display) tempah = 1;\n\n\t   SiS_SetRegANDOR(SiS_Pr->SiS_Part1Port,0x2e,0xF0,tempah);\n#endif\n\n\t} else {\n\n#ifdef CONFIG_FB_SIS_300\n\t   tempah = 0;\n\t   if( (!(SiS_Pr->SiS_VBInfo & SetInSlaveMode)) && (SiS_Pr->SiS_ModeType > ModeVGA) ) {\n\t      tempah |= 0x02;\n\t   }\n\t   tempah <<= 5;\n\n\t   if(SiS_Pr->SiS_VBInfo & DisableCRT2Display) tempah = 0;\n\n\t   SiS_SetReg(SiS_Pr->SiS_Part1Port,0x01,tempah);\n#endif\n\n\t}\n\n     }\n\n  }   \n\n  if(SiS_Pr->SiS_VBType & VB_SISVB) {\n\n     if(SiS_Pr->ChipType >= SIS_315H) {\n\n#ifdef CONFIG_FB_SIS_315\n\t \n\n\t \n\n\t \n\n\tif(!(IS_SIS740)) {\n\t   tempah = 0x04;\t\t\t\t\t\t    \n\t   tempbl = 0xfb;\n\t   if(!(SiS_Pr->SiS_VBInfo & SetCRT2ToLCDA)) {\n\t      tempah = 0x00;\n\t      if(SiS_IsDualEdge(SiS_Pr)) {\n\t         tempbl = 0xff;\n\t      }\n\t   }\n\t   SiS_SetRegANDOR(SiS_Pr->SiS_Part1Port,0x13,tempbl,tempah);\n\t}\n\n\t \n\n\tif((IS_SIS740) || (SiS_Pr->ChipType >= SIS_661) || (SiS_Pr->SiS_ROMNew)) {\n\t   tempah = 0x30;\n\t   tempbl = 0xc0;\n\t   if((SiS_Pr->SiS_VBInfo & DisableCRT2Display) ||\n\t      ((SiS_Pr->SiS_ROMNew) && (!(ROMAddr[0x5b] & 0x04)))) {\n\t      tempah = 0x00;\n\t      tempbl = 0x00;\n\t   }\n\t   SiS_SetRegANDOR(SiS_Pr->SiS_Part1Port,0x2c,0xcf,tempah);\n\t   SiS_SetRegANDOR(SiS_Pr->SiS_Part4Port,0x21,0x3f,tempbl);\n\t} else if(SiS_Pr->SiS_VBType & VB_SIS301) {\n\t    \n\t   SiS_SetRegAND(SiS_Pr->SiS_Part1Port,0x2c,0xcf);\t \n\t   SiS_SetRegAND(SiS_Pr->SiS_Part4Port,0x21,0x3f);\n\t} else if(SiS_Pr->SiS_VBType & VB_SISLVDS) {\n\t   SiS_SetRegOR(SiS_Pr->SiS_Part1Port,0x2c,0x30);\t \n\t   SiS_SetRegOR(SiS_Pr->SiS_Part4Port,0x21,0xc0);\n\t} else if(SiS_Pr->SiS_VBType & VB_NoLCD) {\t\t \n\t   tempah = 0x30; tempah2 = 0xc0;\n\t   tempbl = 0xcf; tempbl2 = 0x3f;\n\t   if(SiS_Pr->SiS_TVBlue == 0) {\n\t         tempah = tempah2 = 0x00;\n\t   } else if(SiS_Pr->SiS_TVBlue == -1) {\n\t       \n\t      if(!(IS_SIS65x))   {\n\t         tempah = tempah2 = 0x00;\n\t      }\n\t   }\n\t   SiS_SetRegANDOR(SiS_Pr->SiS_Part1Port,0x2c,tempbl,tempah);\n\t   SiS_SetRegANDOR(SiS_Pr->SiS_Part4Port,0x21,tempbl2,tempah2);\n\t} else {\n\t   tempah = 0x30; tempah2 = 0xc0;\t\t        \n\t   tempbl = 0xcf; tempbl2 = 0x3f;\n\t   if(!(SiS_Pr->SiS_VBInfo & SetCRT2ToLCDA)) {\n\t      tempah = tempah2 = 0x00;\n\t      if(SiS_IsDualEdge(SiS_Pr)) {\n\t\t tempbl = tempbl2 = 0xff;\n\t      }\n\t   }\n\t   SiS_SetRegANDOR(SiS_Pr->SiS_Part1Port,0x2c,tempbl,tempah);\n\t   SiS_SetRegANDOR(SiS_Pr->SiS_Part4Port,0x21,tempbl2,tempah2);\n\t}\n\n\tif(IS_SIS740) {\n\t   tempah = 0x80;\n\t   if(SiS_Pr->SiS_VBInfo & DisableCRT2Display) tempah = 0x00;\n\t   SiS_SetRegANDOR(SiS_Pr->SiS_Part4Port,0x23,0x7f,tempah);\n\t} else {\n\t   tempah = 0x00;\n\t   tempbl = 0x7f;\n\t   if(!(SiS_Pr->SiS_VBInfo & SetCRT2ToLCDA)) {\n\t      tempbl = 0xff;\n\t      if(!(SiS_IsDualEdge(SiS_Pr))) tempah = 0x80;\n\t   }\n\t   SiS_SetRegANDOR(SiS_Pr->SiS_Part4Port,0x23,tempbl,tempah);\n\t}\n\n#endif  \n\n     } else if(SiS_Pr->SiS_VBType & VB_SIS30xBLV) {\n\n#ifdef CONFIG_FB_SIS_300\n\tSiS_SetRegAND(SiS_Pr->SiS_Part4Port,0x21,0x3f);\n\n\tif((SiS_Pr->SiS_VBInfo & DisableCRT2Display) ||\n\t   ((SiS_Pr->SiS_VBType & VB_NoLCD) &&\n\t    (SiS_Pr->SiS_VBInfo & SetCRT2ToLCD))) {\n\t   SiS_SetRegAND(SiS_Pr->SiS_Part4Port,0x23,0x7F);\n\t} else {\n\t   SiS_SetRegOR(SiS_Pr->SiS_Part4Port,0x23,0x80);\n\t}\n#endif\n\n     }\n\n     if(SiS_Pr->SiS_VBType & VB_SIS30xBLV) {\n\tSiS_SetRegOR(SiS_Pr->SiS_Part4Port,0x0D,0x80);\n\tif(SiS_Pr->SiS_VBType & VB_SIS30xCLV) {\n\t   SiS_SetRegOR(SiS_Pr->SiS_Part4Port,0x3A,0xC0);\n        }\n     }\n\n  } else {   \n\n#ifdef CONFIG_FB_SIS_315\n     if(SiS_Pr->ChipType >= SIS_315H) {\n\n\tif(SiS_Pr->SiS_IF_DEF_CH70xx != 0) {\n\n\t   tempah = 0x04;\n\t   tempbl = 0xfb;\n\t   if(!(SiS_Pr->SiS_VBInfo & SetCRT2ToLCDA)) {\n\t      tempah = 0x00;\n\t      if(SiS_IsDualEdge(SiS_Pr)) tempbl = 0xff;\n\t   }\n\t   SiS_SetRegANDOR(SiS_Pr->SiS_Part1Port,0x13,tempbl,tempah);\n\n\t   if(SiS_Pr->SiS_VBInfo & DisableCRT2Display) {\n\t      SiS_SetRegAND(SiS_Pr->SiS_Part1Port,0x13,0xfb);\n\t   }\n\n\t   SiS_SetRegOR(SiS_Pr->SiS_Part1Port,0x2c,0x30);\n\n\t} else if(SiS_Pr->ChipType == SIS_550) {\n\n\t   SiS_SetRegAND(SiS_Pr->SiS_Part1Port,0x13,0xfb);\n\t   SiS_SetRegOR(SiS_Pr->SiS_Part1Port,0x2c,0x30);\n\n\t}\n\n     }\n#endif\n\n  }\n\n}\n\n \n \n \n\nunsigned short\nSiS_GetResInfo(struct SiS_Private *SiS_Pr, unsigned short ModeNo, unsigned short ModeIdIndex)\n{\n   if(ModeNo <= 0x13)\n      return ((unsigned short)SiS_Pr->SiS_SModeIDTable[ModeIdIndex].St_ResInfo);\n   else\n      return ((unsigned short)SiS_Pr->SiS_EModeIDTable[ModeIdIndex].Ext_RESINFO);\n}\n\nstatic void\nSiS_GetCRT2ResInfo(struct SiS_Private *SiS_Pr, unsigned short ModeNo, unsigned short ModeIdIndex)\n{\n   unsigned short xres, yres, modeflag=0, resindex;\n\n   if(SiS_Pr->UseCustomMode) {\n      xres = SiS_Pr->CHDisplay;\n      if(SiS_Pr->CModeFlag & HalfDCLK) xres <<= 1;\n      SiS_Pr->SiS_VGAHDE = SiS_Pr->SiS_HDE = xres;\n       \n      SiS_Pr->SiS_VGAVDE = SiS_Pr->SiS_VDE = SiS_Pr->CVDisplay;\n      return;\n   }\n\n   resindex = SiS_GetResInfo(SiS_Pr,ModeNo,ModeIdIndex);\n\n   if(ModeNo <= 0x13) {\n      xres = SiS_Pr->SiS_StResInfo[resindex].HTotal;\n      yres = SiS_Pr->SiS_StResInfo[resindex].VTotal;\n   } else {\n      xres = SiS_Pr->SiS_ModeResInfo[resindex].HTotal;\n      yres = SiS_Pr->SiS_ModeResInfo[resindex].VTotal;\n      modeflag = SiS_Pr->SiS_EModeIDTable[ModeIdIndex].Ext_ModeFlag;\n   }\n\n   if(!SiS_Pr->SiS_IF_DEF_DSTN && !SiS_Pr->SiS_IF_DEF_FSTN) {\n\n      if((SiS_Pr->ChipType >= SIS_315H) && (SiS_Pr->SiS_IF_DEF_LVDS == 1)) {\n\t if((ModeNo != 0x03) && (SiS_Pr->SiS_SetFlag & SetDOSMode)) {\n\t    if(yres == 350) yres = 400;\n\t }\n\t if(SiS_GetReg(SiS_Pr->SiS_P3d4,0x3a) & 0x01) {\n\t    if(ModeNo == 0x12) yres = 400;\n\t }\n      }\n\n      if(modeflag & HalfDCLK)       xres <<= 1;\n      if(modeflag & DoubleScanMode) yres <<= 1;\n\n   }\n\n   if((SiS_Pr->SiS_VBType & VB_SISVB) && (!(SiS_Pr->SiS_VBType & VB_NoLCD))) {\n\n      if(SiS_Pr->SiS_VBInfo & SetCRT2ToLCD) {\n\t switch(SiS_Pr->SiS_LCDResInfo) {\n\t   case Panel_1024x768:\n\t      if(!(SiS_Pr->SiS_SetFlag & LCDVESATiming)) {\n\t\t if(!(SiS_Pr->SiS_LCDInfo & DontExpandLCD)) {\n\t\t    if(yres == 350) yres = 357;\n\t\t    if(yres == 400) yres = 420;\n\t\t    if(yres == 480) yres = 525;\n\t\t }\n\t      }\n\t      break;\n\t   case Panel_1280x1024:\n\t      if(!(SiS_Pr->SiS_LCDInfo & DontExpandLCD)) {\n\t\t  \n\t\t if(yres == 400) yres = 405;\n\t      }\n\t      if(yres == 350) yres = 360;\n\t      if(SiS_Pr->SiS_SetFlag & LCDVESATiming) {\n\t\t if(yres == 360) yres = 375;\n\t      }\n\t      break;\n\t   case Panel_1600x1200:\n\t      if(!(SiS_Pr->SiS_SetFlag & LCDVESATiming)) {\n\t\t if(yres == 1024) yres = 1056;\n\t      }\n\t      break;\n\t }\n      }\n\n   } else {\n\n      if(SiS_Pr->SiS_VBType & VB_SISVB) {\n\t if(SiS_Pr->SiS_VBInfo & (SetCRT2ToLCD | SetCRT2ToHiVision)) {\n\t    if(xres == 720) xres = 640;\n\t }\n      } else if(xres == 720) xres = 640;\n\n      if(SiS_Pr->SiS_SetFlag & SetDOSMode) {\n\t yres = 400;\n\t if(SiS_Pr->ChipType >= SIS_315H) {\n\t    if(SiS_GetReg(SiS_Pr->SiS_P3c4,0x17) & 0x80) yres = 480;\n\t } else {\n\t    if(SiS_GetReg(SiS_Pr->SiS_P3c4,0x13) & 0x80) yres = 480;\n\t }\n\t if(SiS_Pr->SiS_IF_DEF_DSTN || SiS_Pr->SiS_IF_DEF_FSTN) yres = 480;\n      }\n\n   }\n   SiS_Pr->SiS_VGAHDE = SiS_Pr->SiS_HDE = xres;\n   SiS_Pr->SiS_VGAVDE = SiS_Pr->SiS_VDE = yres;\n}\n\n \n \n \n\nstatic void\nSiS_GetCRT2Ptr(struct SiS_Private *SiS_Pr, unsigned short ModeNo, unsigned short ModeIdIndex,\n\t       unsigned short RefreshRateTableIndex, unsigned short *CRT2Index,\n\t       unsigned short *ResIndex)\n{\n  unsigned short tempbx=0, tempal=0, resinfo=0;\n\n  if(ModeNo <= 0x13) {\n     tempal = SiS_Pr->SiS_SModeIDTable[ModeIdIndex].St_CRT2CRTC;\n  } else {\n     tempal = SiS_Pr->SiS_RefIndex[RefreshRateTableIndex].Ext_CRT2CRTC;\n     resinfo = SiS_Pr->SiS_EModeIDTable[ModeIdIndex].Ext_RESINFO;\n  }\n\n  if((SiS_Pr->SiS_VBType & VB_SISVB) && (SiS_Pr->SiS_IF_DEF_LVDS == 0)) {\n\n     if(SiS_Pr->SiS_VBInfo & SetCRT2ToLCD) {                             \n\n\ttempbx = SiS_Pr->SiS_LCDResInfo;\n\tif(!(SiS_Pr->SiS_SetFlag & LCDVESATiming)) tempbx += 32;\n\n\t \n\tif(SiS_Pr->SiS_LCDResInfo == Panel_1680x1050) {\n\t   if     (resinfo == SIS_RI_1280x800)  tempal =  9;\n\t   else if(resinfo == SIS_RI_1400x1050) tempal = 11;\n\t} else if((SiS_Pr->SiS_LCDResInfo == Panel_1280x800) ||\n\t\t  (SiS_Pr->SiS_LCDResInfo == Panel_1280x800_2) ||\n\t\t  (SiS_Pr->SiS_LCDResInfo == Panel_1280x854)) {\n\t   if     (resinfo == SIS_RI_1280x768)  tempal =  9;\n\t}\n\n\tif(SiS_Pr->SiS_LCDInfo & DontExpandLCD) {\n\t    \n\t    \n\t    \n\t   tempbx = 100;\n\t   if(ModeNo >= 0x13) {\n\t      tempal = SiS_Pr->SiS_RefIndex[RefreshRateTableIndex].Ext_CRT2CRTC_NS;\n\t   }\n\t}\n\n#ifdef CONFIG_FB_SIS_315\n\tif(SiS_Pr->SiS_CustomT == CUT_COMPAQ1280) {\n\t   if(SiS_Pr->SiS_LCDResInfo == Panel_1280x1024) {\n\t      if(!(SiS_Pr->SiS_LCDInfo & DontExpandLCD)) {\n\t\t tempbx = 200;\n\t\t if(!(SiS_Pr->SiS_SetFlag & LCDVESATiming)) tempbx++;\n\t      }\n\t   }\n\t}\n#endif\n\n     } else {\t\t\t\t\t\t  \t \n\n\tif(SiS_Pr->SiS_VBInfo & SetCRT2ToHiVision) {\n\t    \n\t   tempbx = 2;\n\t   if(SiS_Pr->SiS_VBInfo & SetInSlaveMode) {\n\t      tempbx = 13;\n\t      if(!(SiS_Pr->SiS_TVMode & TVSetTVSimuMode)) tempbx = 14;\n\t   }\n\t} else if(SiS_Pr->SiS_VBInfo & SetCRT2ToYPbPr525750) {\n\t   if(SiS_Pr->SiS_TVMode & TVSetYPbPr750p)\ttempbx = 7;\n\t   else if(SiS_Pr->SiS_TVMode & TVSetYPbPr525p)\ttempbx = 6;\n\t   else\t\t\t\t\t\ttempbx = 5;\n\t   if(SiS_Pr->SiS_TVMode & TVSetTVSimuMode)\ttempbx += 5;\n\t} else {\n\t   if(SiS_Pr->SiS_TVMode & TVSetPAL)\t\ttempbx = 3;\n\t   else\t\t\t\t\t\ttempbx = 4;\n\t   if(SiS_Pr->SiS_TVMode & TVSetTVSimuMode)\ttempbx += 5;\n\t}\n\n     }\n\n     tempal &= 0x3F;\n\n     if(ModeNo > 0x13) {\n        if(SiS_Pr->SiS_VBInfo & SetCRT2ToTVNoHiVision) {\n\t   switch(resinfo) {\n\t   case SIS_RI_720x480:\n\t      tempal = 6;\n\t      if(SiS_Pr->SiS_TVMode & (TVSetPAL | TVSetPALN))\ttempal = 9;\n\t      break;\n\t   case SIS_RI_720x576:\n\t   case SIS_RI_768x576:\n\t   case SIS_RI_1024x576:  \n\t      tempal = 6;\n\t      if(SiS_Pr->SiS_VBInfo & SetCRT2ToYPbPr525750) {\n\t\t if(SiS_Pr->SiS_TVMode & TVSetYPbPr750p)\ttempal = 8;\n\t      }\n\t      break;\n\t   case SIS_RI_800x480:\n\t      tempal = 4;\n\t      break;\n\t   case SIS_RI_512x384:\n\t   case SIS_RI_1024x768:\n\t      tempal = 7;\n\t      if(SiS_Pr->SiS_VBInfo & SetCRT2ToYPbPr525750) {\n\t\t if(SiS_Pr->SiS_TVMode & TVSetYPbPr525p)\ttempal = 8;\n\t      }\n\t      break;\n\t   case SIS_RI_1280x720:\n\t      if(SiS_Pr->SiS_VBInfo & SetCRT2ToYPbPr525750) {\n\t\t if(SiS_Pr->SiS_TVMode & TVSetYPbPr750p)\ttempal = 9;\n\t      }\n\t      break;\n\t   }\n\t}\n     }\n\n     *CRT2Index = tempbx;\n     *ResIndex = tempal;\n\n  } else {    \n\n     tempbx = 0;\n     if((SiS_Pr->SiS_IF_DEF_CH70xx) && (SiS_Pr->SiS_VBInfo & SetCRT2ToTV)) {\n\n\ttempbx = 90;\n\tif(SiS_Pr->SiS_TVMode & TVSetPAL) {\n\t   tempbx = 92;\n\t   if(SiS_Pr->SiS_ModeType > ModeVGA) {\n\t      if(SiS_Pr->SiS_CHSOverScan) tempbx = 99;\n\t   }\n\t   if(SiS_Pr->SiS_TVMode & TVSetPALM)      tempbx = 94;\n\t   else if(SiS_Pr->SiS_TVMode & TVSetPALN) tempbx = 96;\n\t}\n\tif(tempbx != 99) {\n\t   if(SiS_Pr->SiS_TVMode & TVSetCHOverScan) tempbx++;\n\t}\n\n     } else {\n\n\tswitch(SiS_Pr->SiS_LCDResInfo) {\n\tcase Panel_640x480:   tempbx = 12; break;\n\tcase Panel_320x240_1: tempbx = 10; break;\n\tcase Panel_320x240_2:\n\tcase Panel_320x240_3: tempbx = 14; break;\n\tcase Panel_800x600:   tempbx = 16; break;\n\tcase Panel_1024x600:  tempbx = 18; break;\n\tcase Panel_1152x768:\n\tcase Panel_1024x768:  tempbx = 20; break;\n\tcase Panel_1280x768:  tempbx = 22; break;\n\tcase Panel_1280x1024: tempbx = 24; break;\n\tcase Panel_1400x1050: tempbx = 26; break;\n\tcase Panel_1600x1200: tempbx = 28; break;\n#ifdef CONFIG_FB_SIS_300\n\tcase Panel_Barco1366: tempbx = 80; break;\n#endif\n\t}\n\n\tswitch(SiS_Pr->SiS_LCDResInfo) {\n\tcase Panel_320x240_1:\n\tcase Panel_320x240_2:\n\tcase Panel_320x240_3:\n\tcase Panel_640x480:\n\t   break;\n\tdefault:\n\t   if(SiS_Pr->SiS_LCDInfo & DontExpandLCD) tempbx++;\n\t}\n\n\tif(SiS_Pr->SiS_LCDInfo & LCDPass11) tempbx = 30;\n\n#ifdef CONFIG_FB_SIS_300\n\tif(SiS_Pr->SiS_CustomT == CUT_BARCO1024) {\n\t   tempbx = 82;\n\t   if(SiS_Pr->SiS_LCDInfo & DontExpandLCD) tempbx++;\n\t} else if(SiS_Pr->SiS_CustomT == CUT_PANEL848 || SiS_Pr->SiS_CustomT == CUT_PANEL856) {\n\t   tempbx = 84;\n\t   if(SiS_Pr->SiS_LCDInfo & DontExpandLCD) tempbx++;\n\t}\n#endif\n\n     }\n\n     (*CRT2Index) = tempbx;\n     (*ResIndex) = tempal & 0x1F;\n  }\n}\n\nstatic void\nSiS_GetRAMDAC2DATA(struct SiS_Private *SiS_Pr, unsigned short ModeNo, unsigned short ModeIdIndex,\n\t\tunsigned short RefreshRateTableIndex)\n{\n  unsigned short tempax=0, tempbx=0, index, dotclock;\n  unsigned short temp1=0, modeflag=0, tempcx=0;\n\n  SiS_Pr->SiS_RVBHCMAX  = 1;\n  SiS_Pr->SiS_RVBHCFACT = 1;\n\n  if(ModeNo <= 0x13) {\n\n     modeflag = SiS_Pr->SiS_SModeIDTable[ModeIdIndex].St_ModeFlag;\n     index = SiS_GetModePtr(SiS_Pr,ModeNo,ModeIdIndex);\n\n     tempax = SiS_Pr->SiS_StandTable[index].CRTC[0];\n     tempbx = SiS_Pr->SiS_StandTable[index].CRTC[6];\n     temp1 = SiS_Pr->SiS_StandTable[index].CRTC[7];\n\n     dotclock = (modeflag & Charx8Dot) ? 8 : 9;\n\n  } else {\n\n     modeflag = SiS_Pr->SiS_EModeIDTable[ModeIdIndex].Ext_ModeFlag;\n     index = SiS_GetRefCRT1CRTC(SiS_Pr, RefreshRateTableIndex, SiS_Pr->SiS_UseWideCRT2);\n\n     tempax = SiS_Pr->SiS_CRT1Table[index].CR[0];\n     tempax |= (SiS_Pr->SiS_CRT1Table[index].CR[14] << 8);\n     tempax &= 0x03FF;\n     tempbx = SiS_Pr->SiS_CRT1Table[index].CR[6];\n     tempcx = SiS_Pr->SiS_CRT1Table[index].CR[13] << 8;\n     tempcx &= 0x0100;\n     tempcx <<= 2;\n     tempbx |= tempcx;\n     temp1  = SiS_Pr->SiS_CRT1Table[index].CR[7];\n\n     dotclock = 8;\n\n  }\n\n  if(temp1 & 0x01) tempbx |= 0x0100;\n  if(temp1 & 0x20) tempbx |= 0x0200;\n\n  tempax += 5;\n  tempax *= dotclock;\n  if(modeflag & HalfDCLK) tempax <<= 1;\n\n  tempbx++;\n\n  SiS_Pr->SiS_VGAHT = SiS_Pr->SiS_HT = tempax;\n  SiS_Pr->SiS_VGAVT = SiS_Pr->SiS_VT = tempbx;\n}\n\nstatic void\nSiS_CalcPanelLinkTiming(struct SiS_Private *SiS_Pr, unsigned short ModeNo,\n\t\tunsigned short ModeIdIndex, unsigned short RefreshRateTableIndex)\n{\n   unsigned short ResIndex;\n\n   if(SiS_Pr->SiS_LCDInfo & DontExpandLCD) {\n      if(SiS_Pr->SiS_LCDInfo & LCDPass11) {\n\t if(SiS_Pr->UseCustomMode) {\n\t    ResIndex = SiS_Pr->CHTotal;\n\t    if(SiS_Pr->CModeFlag & HalfDCLK) ResIndex <<= 1;\n\t    SiS_Pr->SiS_VGAHT = SiS_Pr->SiS_HT = ResIndex;\n\t    SiS_Pr->SiS_VGAVT = SiS_Pr->SiS_VT = SiS_Pr->CVTotal;\n\t } else {\n\t    if(ModeNo < 0x13) {\n\t       ResIndex = SiS_Pr->SiS_SModeIDTable[ModeIdIndex].St_CRT2CRTC;\n\t    } else {\n\t       ResIndex = SiS_Pr->SiS_RefIndex[RefreshRateTableIndex].Ext_CRT2CRTC_NS;\n\t    }\n\t    if(ResIndex == 0x09) {\n\t       if(SiS_Pr->Alternate1600x1200)        ResIndex = 0x20;  \n\t       else if(SiS_Pr->SiS_IF_DEF_LVDS == 1) ResIndex = 0x21;  \n\t    }\n\t    SiS_Pr->SiS_VGAHT = SiS_Pr->SiS_NoScaleData[ResIndex].VGAHT;\n\t    SiS_Pr->SiS_VGAVT = SiS_Pr->SiS_NoScaleData[ResIndex].VGAVT;\n\t    SiS_Pr->SiS_HT    = SiS_Pr->SiS_NoScaleData[ResIndex].LCDHT;\n\t    SiS_Pr->SiS_VT    = SiS_Pr->SiS_NoScaleData[ResIndex].LCDVT;\n\t }\n      } else {\n\t SiS_Pr->SiS_VGAHT = SiS_Pr->SiS_HT = SiS_Pr->PanelHT;\n\t SiS_Pr->SiS_VGAVT = SiS_Pr->SiS_VT = SiS_Pr->PanelVT;\n      }\n   } else {\n       \n      SiS_Pr->SiS_HDE = SiS_Pr->PanelXRes;\n      SiS_Pr->SiS_VDE = SiS_Pr->PanelYRes;\n      SiS_Pr->SiS_HT  = SiS_Pr->PanelHT;\n      SiS_Pr->SiS_VT  = SiS_Pr->PanelVT;\n      SiS_Pr->SiS_VGAHT = SiS_Pr->PanelHT - (SiS_Pr->PanelXRes - SiS_Pr->SiS_VGAHDE);\n      SiS_Pr->SiS_VGAVT = SiS_Pr->PanelVT - (SiS_Pr->PanelYRes - SiS_Pr->SiS_VGAVDE);\n   }\n}\n\nstatic void\nSiS_GetCRT2DataLVDS(struct SiS_Private *SiS_Pr, unsigned short ModeNo, unsigned short ModeIdIndex,\n                    unsigned short RefreshRateTableIndex)\n{\n   unsigned short CRT2Index, ResIndex, backup;\n   const struct SiS_LVDSData *LVDSData = NULL;\n\n   SiS_GetCRT2ResInfo(SiS_Pr, ModeNo, ModeIdIndex);\n\n   if(SiS_Pr->SiS_VBType & VB_SISVB) {\n      SiS_Pr->SiS_RVBHCMAX  = 1;\n      SiS_Pr->SiS_RVBHCFACT = 1;\n      SiS_Pr->SiS_NewFlickerMode = 0;\n      SiS_Pr->SiS_RVBHRS = 50;\n      SiS_Pr->SiS_RY1COE = 0;\n      SiS_Pr->SiS_RY2COE = 0;\n      SiS_Pr->SiS_RY3COE = 0;\n      SiS_Pr->SiS_RY4COE = 0;\n      SiS_Pr->SiS_RVBHRS2 = 0;\n   }\n\n   if((SiS_Pr->SiS_VBType & VB_SISVB) && (SiS_Pr->SiS_VBInfo & SetCRT2ToLCDA)) {\n\n#ifdef CONFIG_FB_SIS_315\n      SiS_CalcPanelLinkTiming(SiS_Pr, ModeNo, ModeIdIndex, RefreshRateTableIndex);\n      SiS_CalcLCDACRT1Timing(SiS_Pr, ModeNo, ModeIdIndex);\n#endif\n\n   } else {\n\n       \n      backup = SiS_Pr->SiS_IF_DEF_LVDS;\n      if((SiS_Pr->SiS_VBType & VB_NoLCD) && (SiS_Pr->SiS_VBInfo & SetCRT2ToLCD)) {\n\t SiS_Pr->SiS_IF_DEF_LVDS = 1;\n      }\n\n      SiS_GetCRT2Ptr(SiS_Pr, ModeNo, ModeIdIndex, RefreshRateTableIndex,\n                     \t\t            &CRT2Index, &ResIndex);\n\n      SiS_Pr->SiS_IF_DEF_LVDS = backup;\n\n      switch(CRT2Index) {\n\t case 10: LVDSData = SiS_Pr->SiS_LVDS320x240Data_1;    break;\n\t case 14: LVDSData = SiS_Pr->SiS_LVDS320x240Data_2;    break;\n\t case 12: LVDSData = SiS_Pr->SiS_LVDS640x480Data_1;    break;\n\t case 16: LVDSData = SiS_Pr->SiS_LVDS800x600Data_1;    break;\n\t case 18: LVDSData = SiS_Pr->SiS_LVDS1024x600Data_1;   break;\n\t case 20: LVDSData = SiS_Pr->SiS_LVDS1024x768Data_1;   break;\n#ifdef CONFIG_FB_SIS_300\n\t case 80: LVDSData = SiS_Pr->SiS_LVDSBARCO1366Data_1;  break;\n\t case 81: LVDSData = SiS_Pr->SiS_LVDSBARCO1366Data_2;  break;\n\t case 82: LVDSData = SiS_Pr->SiS_LVDSBARCO1024Data_1;  break;\n\t case 84: LVDSData = SiS_Pr->SiS_LVDS848x480Data_1;    break;\n\t case 85: LVDSData = SiS_Pr->SiS_LVDS848x480Data_2;    break;\n#endif\n\t case 90: LVDSData = SiS_Pr->SiS_CHTVUNTSCData;        break;\n\t case 91: LVDSData = SiS_Pr->SiS_CHTVONTSCData;        break;\n\t case 92: LVDSData = SiS_Pr->SiS_CHTVUPALData;         break;\n\t case 93: LVDSData = SiS_Pr->SiS_CHTVOPALData;         break;\n\t case 94: LVDSData = SiS_Pr->SiS_CHTVUPALMData;        break;\n\t case 95: LVDSData = SiS_Pr->SiS_CHTVOPALMData;        break;\n\t case 96: LVDSData = SiS_Pr->SiS_CHTVUPALNData;        break;\n\t case 97: LVDSData = SiS_Pr->SiS_CHTVOPALNData;        break;\n\t case 99: LVDSData = SiS_Pr->SiS_CHTVSOPALData;\t       break;\n      }\n\n      if(LVDSData) {\n\t SiS_Pr->SiS_VGAHT = (LVDSData+ResIndex)->VGAHT;\n\t SiS_Pr->SiS_VGAVT = (LVDSData+ResIndex)->VGAVT;\n\t SiS_Pr->SiS_HT    = (LVDSData+ResIndex)->LCDHT;\n\t SiS_Pr->SiS_VT    = (LVDSData+ResIndex)->LCDVT;\n      } else {\n\t SiS_CalcPanelLinkTiming(SiS_Pr, ModeNo, ModeIdIndex, RefreshRateTableIndex);\n      }\n\n      if( (!(SiS_Pr->SiS_VBType & VB_SISVB)) &&\n\t  (SiS_Pr->SiS_VBInfo & SetCRT2ToLCD) &&\n\t  (!(SiS_Pr->SiS_LCDInfo & LCDPass11)) ) {\n\t if( (!(SiS_Pr->SiS_LCDInfo & DontExpandLCD)) ||\n\t     (SiS_Pr->SiS_SetFlag & SetDOSMode) ) {\n\t    SiS_Pr->SiS_HDE = SiS_Pr->PanelXRes;\n            SiS_Pr->SiS_VDE = SiS_Pr->PanelYRes;\n#ifdef CONFIG_FB_SIS_300\n\t    if(SiS_Pr->SiS_CustomT == CUT_BARCO1366) {\n\t       if(ResIndex < 0x08) {\n\t\t  SiS_Pr->SiS_HDE = 1280;\n\t\t  SiS_Pr->SiS_VDE = 1024;\n\t       }\n\t    }\n#endif\n         }\n      }\n   }\n}\n\nstatic void\nSiS_GetCRT2Data301(struct SiS_Private *SiS_Pr, unsigned short ModeNo, unsigned short ModeIdIndex,\n\t\tunsigned short RefreshRateTableIndex)\n{\n  unsigned char  *ROMAddr = NULL;\n  unsigned short tempax, tempbx, modeflag, romptr=0;\n  unsigned short resinfo, CRT2Index, ResIndex;\n  const struct SiS_LCDData *LCDPtr = NULL;\n  const struct SiS_TVData  *TVPtr  = NULL;\n#ifdef CONFIG_FB_SIS_315\n  short resinfo661;\n#endif\n\n  if(ModeNo <= 0x13) {\n     modeflag = SiS_Pr->SiS_SModeIDTable[ModeIdIndex].St_ModeFlag;\n     resinfo = SiS_Pr->SiS_SModeIDTable[ModeIdIndex].St_ResInfo;\n  } else if(SiS_Pr->UseCustomMode) {\n     modeflag = SiS_Pr->CModeFlag;\n     resinfo = 0;\n  } else {\n     modeflag = SiS_Pr->SiS_EModeIDTable[ModeIdIndex].Ext_ModeFlag;\n     resinfo = SiS_Pr->SiS_EModeIDTable[ModeIdIndex].Ext_RESINFO;\n#ifdef CONFIG_FB_SIS_315\n     resinfo661 = SiS_Pr->SiS_EModeIDTable[ModeIdIndex].ROMMODEIDX661;\n     if( (SiS_Pr->SiS_VBInfo & SetCRT2ToLCD)   &&\n\t (SiS_Pr->SiS_SetFlag & LCDVESATiming) &&\n\t (resinfo661 >= 0)                     &&\n\t (SiS_Pr->SiS_NeedRomModeData) ) {\n\tif((ROMAddr = GetLCDStructPtr661(SiS_Pr))) {\n\t   if((romptr = (SISGETROMW(21)))) {\n\t      romptr += (resinfo661 * 10);\n\t      ROMAddr = SiS_Pr->VirtualRomBase;\n\t   }\n\t}\n     }\n#endif\n  }\n\n  SiS_Pr->SiS_NewFlickerMode = 0;\n  SiS_Pr->SiS_RVBHRS = 50;\n  SiS_Pr->SiS_RY1COE = 0;\n  SiS_Pr->SiS_RY2COE = 0;\n  SiS_Pr->SiS_RY3COE = 0;\n  SiS_Pr->SiS_RY4COE = 0;\n  SiS_Pr->SiS_RVBHRS2 = 0;\n\n  SiS_GetCRT2ResInfo(SiS_Pr,ModeNo,ModeIdIndex);\n\n  if(SiS_Pr->SiS_VBInfo & SetCRT2ToRAMDAC) {\n\n     if(SiS_Pr->UseCustomMode) {\n\n\tSiS_Pr->SiS_RVBHCMAX  = 1;\n\tSiS_Pr->SiS_RVBHCFACT = 1;\n\tSiS_Pr->SiS_HDE       = SiS_Pr->SiS_VGAHDE;\n\tSiS_Pr->SiS_VDE       = SiS_Pr->SiS_VGAVDE;\n\n\ttempax = SiS_Pr->CHTotal;\n\tif(modeflag & HalfDCLK) tempax <<= 1;\n\tSiS_Pr->SiS_VGAHT = SiS_Pr->SiS_HT = tempax;\n\tSiS_Pr->SiS_VGAVT = SiS_Pr->SiS_VT = SiS_Pr->CVTotal;\n\n     } else {\n\n\tSiS_GetRAMDAC2DATA(SiS_Pr, ModeNo, ModeIdIndex, RefreshRateTableIndex);\n\n     }\n\n  } else if(SiS_Pr->SiS_VBInfo & SetCRT2ToTV) {\n\n     SiS_GetCRT2Ptr(SiS_Pr,ModeNo,ModeIdIndex,RefreshRateTableIndex,\n\t\t    &CRT2Index,&ResIndex);\n\n     switch(CRT2Index) {\n\tcase  2: TVPtr = SiS_Pr->SiS_ExtHiTVData;   break;\n\tcase  3: TVPtr = SiS_Pr->SiS_ExtPALData;    break;\n\tcase  4: TVPtr = SiS_Pr->SiS_ExtNTSCData;   break;\n\tcase  5: TVPtr = SiS_Pr->SiS_Ext525iData;   break;\n\tcase  6: TVPtr = SiS_Pr->SiS_Ext525pData;   break;\n\tcase  7: TVPtr = SiS_Pr->SiS_Ext750pData;   break;\n\tcase  8: TVPtr = SiS_Pr->SiS_StPALData;     break;\n\tcase  9: TVPtr = SiS_Pr->SiS_StNTSCData;    break;\n\tcase 10: TVPtr = SiS_Pr->SiS_St525iData;    break;\n\tcase 11: TVPtr = SiS_Pr->SiS_St525pData;    break;\n\tcase 12: TVPtr = SiS_Pr->SiS_St750pData;    break;\n\tcase 13: TVPtr = SiS_Pr->SiS_St1HiTVData;   break;\n\tcase 14: TVPtr = SiS_Pr->SiS_St2HiTVData;   break;\n\tdefault: TVPtr = SiS_Pr->SiS_StPALData;     break;\n     }\n\n     SiS_Pr->SiS_RVBHCMAX  = (TVPtr+ResIndex)->RVBHCMAX;\n     SiS_Pr->SiS_RVBHCFACT = (TVPtr+ResIndex)->RVBHCFACT;\n     SiS_Pr->SiS_VGAHT     = (TVPtr+ResIndex)->VGAHT;\n     SiS_Pr->SiS_VGAVT     = (TVPtr+ResIndex)->VGAVT;\n     SiS_Pr->SiS_HDE       = (TVPtr+ResIndex)->TVHDE;\n     SiS_Pr->SiS_VDE       = (TVPtr+ResIndex)->TVVDE;\n     SiS_Pr->SiS_RVBHRS2   = (TVPtr+ResIndex)->RVBHRS2 & 0x0fff;\n     if(modeflag & HalfDCLK) {\n\tSiS_Pr->SiS_RVBHRS = (TVPtr+ResIndex)->HALFRVBHRS;\n\tif(SiS_Pr->SiS_RVBHRS2) {\n\t   SiS_Pr->SiS_RVBHRS2 = ((SiS_Pr->SiS_RVBHRS2 + 3) >> 1) - 3;\n\t   tempax = ((TVPtr+ResIndex)->RVBHRS2 >> 12) & 0x07;\n\t   if((TVPtr+ResIndex)->RVBHRS2 & 0x8000) SiS_Pr->SiS_RVBHRS2 -= tempax;\n\t   else                                   SiS_Pr->SiS_RVBHRS2 += tempax;\n\t}\n     } else {\n\tSiS_Pr->SiS_RVBHRS    = (TVPtr+ResIndex)->RVBHRS;\n     }\n     SiS_Pr->SiS_NewFlickerMode = ((TVPtr+ResIndex)->FlickerMode) << 7;\n\n     if(SiS_Pr->SiS_VBInfo & SetCRT2ToHiVision) {\n\n\tif((resinfo == SIS_RI_960x600)   ||\n\t   (resinfo == SIS_RI_1024x768)  ||\n\t   (resinfo == SIS_RI_1280x1024) ||\n\t   (resinfo == SIS_RI_1280x720)) {\n\t   SiS_Pr->SiS_NewFlickerMode = 0x40;\n\t}\n\n\tif(SiS_Pr->SiS_VGAVDE == 350) SiS_Pr->SiS_TVMode |= TVSetTVSimuMode;\n\n\tSiS_Pr->SiS_HT = ExtHiTVHT;\n\tSiS_Pr->SiS_VT = ExtHiTVVT;\n\tif(SiS_Pr->SiS_VBInfo & SetInSlaveMode) {\n\t   if(SiS_Pr->SiS_TVMode & TVSetTVSimuMode) {\n\t      SiS_Pr->SiS_HT = StHiTVHT;\n\t      SiS_Pr->SiS_VT = StHiTVVT;\n\t   }\n\t}\n\n     } else if(SiS_Pr->SiS_VBInfo & SetCRT2ToYPbPr525750) {\n\n\tif(SiS_Pr->SiS_TVMode & TVSetYPbPr750p) {\n\t   SiS_Pr->SiS_HT = 1650;\n\t   SiS_Pr->SiS_VT = 750;\n\t} else if(SiS_Pr->SiS_TVMode & TVSetYPbPr525p) {\n\t   SiS_Pr->SiS_HT = NTSCHT;\n\t   if(SiS_Pr->SiS_TVMode & TVSet525p1024) SiS_Pr->SiS_HT = NTSC2HT;\n\t   SiS_Pr->SiS_VT = NTSCVT;\n\t} else {\n\t   SiS_Pr->SiS_HT = NTSCHT;\n\t   if(SiS_Pr->SiS_TVMode & TVSetNTSC1024) SiS_Pr->SiS_HT = NTSC2HT;\n\t   SiS_Pr->SiS_VT = NTSCVT;\n\t}\n\n     } else {\n\n\tSiS_Pr->SiS_RY1COE = (TVPtr+ResIndex)->RY1COE;\n\tSiS_Pr->SiS_RY2COE = (TVPtr+ResIndex)->RY2COE;\n\tSiS_Pr->SiS_RY3COE = (TVPtr+ResIndex)->RY3COE;\n\tSiS_Pr->SiS_RY4COE = (TVPtr+ResIndex)->RY4COE;\n\n\tif(modeflag & HalfDCLK) {\n\t   SiS_Pr->SiS_RY1COE = 0x00;\n\t   SiS_Pr->SiS_RY2COE = 0xf4;\n\t   SiS_Pr->SiS_RY3COE = 0x10;\n\t   SiS_Pr->SiS_RY4COE = 0x38;\n\t}\n\n\tif(!(SiS_Pr->SiS_TVMode & TVSetPAL)) {\n\t   SiS_Pr->SiS_HT = NTSCHT;\n\t   if(SiS_Pr->SiS_TVMode & TVSetNTSC1024) SiS_Pr->SiS_HT = NTSC2HT;\n\t   SiS_Pr->SiS_VT = NTSCVT;\n\t} else {\n\t   SiS_Pr->SiS_HT = PALHT;\n\t   SiS_Pr->SiS_VT = PALVT;\n\t}\n\n     }\n\n  } else if(SiS_Pr->SiS_VBInfo & SetCRT2ToLCD) {\n\n     SiS_Pr->SiS_RVBHCMAX  = 1;\n     SiS_Pr->SiS_RVBHCFACT = 1;\n\n     if(SiS_Pr->UseCustomMode) {\n\n\tSiS_Pr->SiS_HDE   = SiS_Pr->SiS_VGAHDE;\n\tSiS_Pr->SiS_VDE   = SiS_Pr->SiS_VGAVDE;\n\n\ttempax = SiS_Pr->CHTotal;\n\tif(modeflag & HalfDCLK) tempax <<= 1;\n\tSiS_Pr->SiS_VGAHT = SiS_Pr->SiS_HT = tempax;\n\tSiS_Pr->SiS_VGAVT = SiS_Pr->SiS_VT = SiS_Pr->CVTotal;\n\n     } else {\n\n\tbool gotit = false;\n\n\tif((SiS_Pr->SiS_LCDInfo & DontExpandLCD) && (!(SiS_Pr->SiS_LCDInfo & LCDPass11))) {\n\n\t   SiS_Pr->SiS_VGAHT = SiS_Pr->PanelHT;\n\t   SiS_Pr->SiS_VGAVT = SiS_Pr->PanelVT;\n\t   SiS_Pr->SiS_HT    = SiS_Pr->PanelHT;\n\t   SiS_Pr->SiS_VT    = SiS_Pr->PanelVT;\n\t   gotit = true;\n\n\t} else if( (!(SiS_Pr->SiS_LCDInfo & DontExpandLCD)) && (romptr) && (ROMAddr) ) {\n\n#ifdef CONFIG_FB_SIS_315\n\t   SiS_Pr->SiS_RVBHCMAX  = ROMAddr[romptr];\n\t   SiS_Pr->SiS_RVBHCFACT = ROMAddr[romptr+1];\n\t   SiS_Pr->SiS_VGAHT     = ROMAddr[romptr+2] | ((ROMAddr[romptr+3] & 0x0f) << 8);\n\t   SiS_Pr->SiS_VGAVT     = (ROMAddr[romptr+4] << 4) | ((ROMAddr[romptr+3] & 0xf0) >> 4);\n\t   SiS_Pr->SiS_HT        = ROMAddr[romptr+5] | ((ROMAddr[romptr+6] & 0x0f) << 8);\n\t   SiS_Pr->SiS_VT        = (ROMAddr[romptr+7] << 4) | ((ROMAddr[romptr+6] & 0xf0) >> 4);\n\t   SiS_Pr->SiS_RVBHRS2   = ROMAddr[romptr+8] | ((ROMAddr[romptr+9] & 0x0f) << 8);\n\t   if((SiS_Pr->SiS_RVBHRS2) && (modeflag & HalfDCLK)) {\n\t      SiS_Pr->SiS_RVBHRS2 = ((SiS_Pr->SiS_RVBHRS2 + 3) >> 1) - 3;\n\t      tempax = (ROMAddr[romptr+9] >> 4) & 0x07;\n\t      if(ROMAddr[romptr+9] & 0x80) SiS_Pr->SiS_RVBHRS2 -= tempax;\n\t      else                         SiS_Pr->SiS_RVBHRS2 += tempax;\n\t   }\n\t   if(SiS_Pr->SiS_VGAHT) gotit = true;\n\t   else {\n\t      SiS_Pr->SiS_LCDInfo |= DontExpandLCD;\n\t      SiS_Pr->SiS_LCDInfo &= ~LCDPass11;\n\t      SiS_Pr->SiS_RVBHCMAX  = 1;\n\t      SiS_Pr->SiS_RVBHCFACT = 1;\n\t      SiS_Pr->SiS_VGAHT   = SiS_Pr->PanelHT;\n\t      SiS_Pr->SiS_VGAVT   = SiS_Pr->PanelVT;\n\t      SiS_Pr->SiS_HT      = SiS_Pr->PanelHT;\n\t      SiS_Pr->SiS_VT      = SiS_Pr->PanelVT;\n\t      SiS_Pr->SiS_RVBHRS2 = 0;\n\t      gotit = true;\n\t   }\n#endif\n\n\t}\n\n\tif(!gotit) {\n\n\t   SiS_GetCRT2Ptr(SiS_Pr,ModeNo,ModeIdIndex,RefreshRateTableIndex,\n\t\t\t  &CRT2Index,&ResIndex);\n\n\t   switch(CRT2Index) {\n\t      case Panel_1024x768      : LCDPtr = SiS_Pr->SiS_ExtLCD1024x768Data;   break;\n\t      case Panel_1024x768  + 32: LCDPtr = SiS_Pr->SiS_St2LCD1024x768Data;   break;\n\t      case Panel_1280x720      :\n\t      case Panel_1280x720  + 32: LCDPtr = SiS_Pr->SiS_LCD1280x720Data;      break;\n\t      case Panel_1280x768_2    : LCDPtr = SiS_Pr->SiS_ExtLCD1280x768_2Data; break;\n\t      case Panel_1280x768_2+ 32: LCDPtr = SiS_Pr->SiS_StLCD1280x768_2Data;  break;\n\t      case Panel_1280x800      :\n\t      case Panel_1280x800  + 32: LCDPtr = SiS_Pr->SiS_LCD1280x800Data;      break;\n\t      case Panel_1280x800_2    :\n\t      case Panel_1280x800_2+ 32: LCDPtr = SiS_Pr->SiS_LCD1280x800_2Data;    break;\n\t      case Panel_1280x854      :\n\t      case Panel_1280x854  + 32: LCDPtr = SiS_Pr->SiS_LCD1280x854Data;      break;\n\t      case Panel_1280x960      :\n\t      case Panel_1280x960  + 32: LCDPtr = SiS_Pr->SiS_LCD1280x960Data;      break;\n\t      case Panel_1280x1024     : LCDPtr = SiS_Pr->SiS_ExtLCD1280x1024Data;  break;\n\t      case Panel_1280x1024 + 32: LCDPtr = SiS_Pr->SiS_St2LCD1280x1024Data;  break;\n\t      case Panel_1400x1050     : LCDPtr = SiS_Pr->SiS_ExtLCD1400x1050Data;  break;\n\t      case Panel_1400x1050 + 32: LCDPtr = SiS_Pr->SiS_StLCD1400x1050Data;   break;\n\t      case Panel_1600x1200     : LCDPtr = SiS_Pr->SiS_ExtLCD1600x1200Data;  break;\n\t      case Panel_1600x1200 + 32: LCDPtr = SiS_Pr->SiS_StLCD1600x1200Data;   break;\n\t      case Panel_1680x1050     :\n\t      case Panel_1680x1050 + 32: LCDPtr = SiS_Pr->SiS_LCD1680x1050Data;     break;\n\t      case 100\t\t       : LCDPtr = SiS_Pr->SiS_NoScaleData;\t    break;\n#ifdef CONFIG_FB_SIS_315\n\t      case 200                 : LCDPtr = SiS310_ExtCompaq1280x1024Data;    break;\n\t      case 201                 : LCDPtr = SiS_Pr->SiS_St2LCD1280x1024Data;  break;\n#endif\n\t      default                  : LCDPtr = SiS_Pr->SiS_ExtLCD1024x768Data;   break;\n\t   }\n\n\t   SiS_Pr->SiS_RVBHCMAX  = (LCDPtr+ResIndex)->RVBHCMAX;\n\t   SiS_Pr->SiS_RVBHCFACT = (LCDPtr+ResIndex)->RVBHCFACT;\n\t   SiS_Pr->SiS_VGAHT     = (LCDPtr+ResIndex)->VGAHT;\n\t   SiS_Pr->SiS_VGAVT     = (LCDPtr+ResIndex)->VGAVT;\n\t   SiS_Pr->SiS_HT        = (LCDPtr+ResIndex)->LCDHT;\n\t   SiS_Pr->SiS_VT        = (LCDPtr+ResIndex)->LCDVT;\n\n        }\n\n\ttempax = SiS_Pr->PanelXRes;\n\ttempbx = SiS_Pr->PanelYRes;\n\n\tswitch(SiS_Pr->SiS_LCDResInfo) {\n\tcase Panel_1024x768:\n\t   if(SiS_Pr->SiS_SetFlag & LCDVESATiming) {\n\t      if(SiS_Pr->ChipType < SIS_315H) {\n\t\t if     (SiS_Pr->SiS_VGAVDE == 350) tempbx = 560;\n\t\t else if(SiS_Pr->SiS_VGAVDE == 400) tempbx = 640;\n\t      }\n\t   } else {\n\t      if     (SiS_Pr->SiS_VGAVDE == 357) tempbx = 527;\n\t      else if(SiS_Pr->SiS_VGAVDE == 420) tempbx = 620;\n\t      else if(SiS_Pr->SiS_VGAVDE == 525) tempbx = 775;\n\t      else if(SiS_Pr->SiS_VGAVDE == 600) tempbx = 775;\n\t      else if(SiS_Pr->SiS_VGAVDE == 350) tempbx = 560;\n\t      else if(SiS_Pr->SiS_VGAVDE == 400) tempbx = 640;\n\t   }\n\t   break;\n\tcase Panel_1280x960:\n\t   if     (SiS_Pr->SiS_VGAVDE == 350)  tempbx = 700;\n\t   else if(SiS_Pr->SiS_VGAVDE == 400)  tempbx = 800;\n\t   else if(SiS_Pr->SiS_VGAVDE == 1024) tempbx = 960;\n\t   break;\n\tcase Panel_1280x1024:\n\t   if     (SiS_Pr->SiS_VGAVDE == 360) tempbx = 768;\n\t   else if(SiS_Pr->SiS_VGAVDE == 375) tempbx = 800;\n\t   else if(SiS_Pr->SiS_VGAVDE == 405) tempbx = 864;\n\t   break;\n\tcase Panel_1600x1200:\n\t   if(!(SiS_Pr->SiS_SetFlag & LCDVESATiming)) {\n\t      if     (SiS_Pr->SiS_VGAVDE == 350)  tempbx = 875;\n\t      else if(SiS_Pr->SiS_VGAVDE == 400)  tempbx = 1000;\n\t   }\n\t   break;\n\t}\n\n\tif(SiS_Pr->SiS_LCDInfo & DontExpandLCD) {\n\t   tempax = SiS_Pr->SiS_VGAHDE;\n\t   tempbx = SiS_Pr->SiS_VGAVDE;\n\t}\n\n\tSiS_Pr->SiS_HDE = tempax;\n\tSiS_Pr->SiS_VDE = tempbx;\n     }\n  }\n}\n\nstatic void\nSiS_GetCRT2Data(struct SiS_Private *SiS_Pr, unsigned short ModeNo, unsigned short ModeIdIndex,\n                unsigned short RefreshRateTableIndex)\n{\n\n   if(SiS_Pr->SiS_VBType & VB_SISVB) {\n\n      if(SiS_Pr->SiS_VBInfo & SetCRT2ToLCDA) {\n         SiS_GetCRT2DataLVDS(SiS_Pr, ModeNo, ModeIdIndex, RefreshRateTableIndex);\n      } else {\n\t if((SiS_Pr->SiS_VBType & VB_NoLCD) && (SiS_Pr->SiS_VBInfo & SetCRT2ToLCD)) {\n\t     \n\t    SiS_GetCRT2DataLVDS(SiS_Pr, ModeNo, ModeIdIndex, RefreshRateTableIndex);\n\t } else {\n\t    SiS_GetCRT2Data301(SiS_Pr, ModeNo, ModeIdIndex, RefreshRateTableIndex);\n\t }\n      }\n\n   } else {\n\n      SiS_GetCRT2DataLVDS(SiS_Pr, ModeNo, ModeIdIndex, RefreshRateTableIndex);\n\n   }\n}\n\n \n \n \n\nstatic const struct SiS_LVDSDes *\nSiS_GetLVDSDesPtr(struct SiS_Private *SiS_Pr)\n{\n   const struct SiS_LVDSDes *PanelDesPtr = NULL;\n\n#ifdef CONFIG_FB_SIS_300\n   if(SiS_Pr->SiS_VBInfo & SetCRT2ToLCD) {\n\n      if(SiS_Pr->ChipType < SIS_315H) {\n\t if(SiS_Pr->SiS_LCDTypeInfo == 4) {\n\t    if(SiS_Pr->SiS_CustomT == CUT_BARCO1366) {\n\t       PanelDesPtr = SiS_Pr->SiS_PanelType04_1a;\n\t       if(SiS_Pr->SiS_LCDInfo & DontExpandLCD) {\n\t\t  PanelDesPtr = SiS_Pr->SiS_PanelType04_2a;\n\t       }\n            } else if(SiS_Pr->SiS_CustomT == CUT_BARCO1024) {\n\t       PanelDesPtr = SiS_Pr->SiS_PanelType04_1b;\n\t       if(SiS_Pr->SiS_LCDInfo & DontExpandLCD) {\n\t\t  PanelDesPtr = SiS_Pr->SiS_PanelType04_2b;\n\t       }\n\t    }\n\t }\n      }\n   }\n#endif\n   return PanelDesPtr;\n}\n\nstatic void\nSiS_GetLVDSDesData(struct SiS_Private *SiS_Pr, unsigned short ModeNo, unsigned short ModeIdIndex,\n                   unsigned short RefreshRateTableIndex)\n{\n  unsigned short modeflag, ResIndex;\n  const struct SiS_LVDSDes *PanelDesPtr = NULL;\n\n  SiS_Pr->SiS_LCDHDES = 0;\n  SiS_Pr->SiS_LCDVDES = 0;\n\n   \n  if(SiS_Pr->SiS_VBInfo & SetCRT2ToLCD) {\n\n      \n     if(SiS_Pr->SiS_IF_DEF_TRUMPION) {\n\tif(SiS_Pr->SiS_LCDResInfo == Panel_1024x768) {\n\t   if(SiS_Pr->SiS_VGAVDE == SiS_Pr->PanelYRes) {\n\t      SiS_Pr->SiS_LCDVDES = SiS_Pr->PanelVT - 1;\n\t   }\n\t}\n\treturn;\n     }\n\n      \n     if(SiS_Pr->ChipType < SIS_315H) {\n\tif(SiS_Pr->SiS_LCDResInfo == Panel_640x480 && SiS_Pr->SiS_LCDTypeInfo == 3) {\n\t   SiS_Pr->SiS_LCDHDES = 8;\n\t   if     (SiS_Pr->SiS_VGAVDE >= 480) SiS_Pr->SiS_LCDVDES = 512;\n\t   else if(SiS_Pr->SiS_VGAVDE >= 400) SiS_Pr->SiS_LCDVDES = 436;\n\t   else if(SiS_Pr->SiS_VGAVDE >= 350) SiS_Pr->SiS_LCDVDES = 440;\n\t   return;\n\t}\n     }\n\n  }  \n\n  if( (SiS_Pr->UseCustomMode) \t\t         ||\n      (SiS_Pr->SiS_LCDResInfo == Panel_Custom)   ||\n      (SiS_Pr->SiS_CustomT == CUT_PANEL848)      ||\n      (SiS_Pr->SiS_CustomT == CUT_PANEL856)      ||\n      (SiS_Pr->SiS_LCDInfo & LCDPass11) ) {\n     return;\n  }\n\n  if(ModeNo <= 0x13) ResIndex = SiS_Pr->SiS_SModeIDTable[ModeIdIndex].St_CRT2CRTC;\n  else               ResIndex = SiS_Pr->SiS_RefIndex[RefreshRateTableIndex].Ext_CRT2CRTC;\n\n  if((SiS_Pr->SiS_VBType & VB_SIS30xBLV) && (SiS_Pr->SiS_VBInfo & SetCRT2ToLCDA)) {\n\n#ifdef CONFIG_FB_SIS_315\n     if(SiS_Pr->SiS_LCDInfo & DontExpandLCD) {\n\t \n\tif(SiS_Pr->SiS_VGAHDE != SiS_Pr->PanelXRes) {\n\t   SiS_Pr->SiS_LCDHDES = SiS_Pr->SiS_HT - ((SiS_Pr->PanelXRes - SiS_Pr->SiS_VGAHDE) / 2);\n\t}\n\tif(SiS_Pr->SiS_VGAVDE != SiS_Pr->PanelYRes) {\n\t   SiS_Pr->SiS_LCDVDES = SiS_Pr->SiS_VT - ((SiS_Pr->PanelYRes - SiS_Pr->SiS_VGAVDE) / 2);\n\t}\n     }\n     if(SiS_Pr->SiS_VGAVDE == SiS_Pr->PanelYRes) {\n\tswitch(SiS_Pr->SiS_CustomT) {\n\tcase CUT_UNIWILL1024:\n\tcase CUT_UNIWILL10242:\n\tcase CUT_CLEVO1400:\n\t   if(SiS_Pr->SiS_LCDResInfo == Panel_1024x768) {\n\t      SiS_Pr->SiS_LCDVDES = SiS_Pr->PanelVT - 1;\n\t   }\n\t   break;\n\t}\n\tswitch(SiS_Pr->SiS_LCDResInfo) {\n\tcase Panel_1280x1024:\n\t   if(SiS_Pr->SiS_CustomT != CUT_COMPAQ1280) {\n\t      SiS_Pr->SiS_LCDVDES = SiS_Pr->PanelVT - 1;\n\t   }\n\t   break;\n\tcase Panel_1280x800:\t \n\tcase Panel_1280x800_2:\t \n\tcase Panel_1280x854:     \n\t   SiS_Pr->SiS_LCDVDES = SiS_Pr->PanelVT - 1;\n\t   break;\n\t}\n     }\n#endif\n\n  } else {\n\n     if((SiS_Pr->SiS_IF_DEF_CH70xx != 0) && (SiS_Pr->SiS_VBInfo & SetCRT2ToTV)) {\n\n\tif((SiS_Pr->SiS_TVMode & TVSetPAL) && (!(SiS_Pr->SiS_TVMode & TVSetPALM))) {\n\t   if(ResIndex <= 3) SiS_Pr->SiS_LCDHDES = 256;\n\t}\n\n     } else if((PanelDesPtr = SiS_GetLVDSDesPtr(SiS_Pr))) {\n\n\tSiS_Pr->SiS_LCDHDES = (PanelDesPtr+ResIndex)->LCDHDES;\n\tSiS_Pr->SiS_LCDVDES = (PanelDesPtr+ResIndex)->LCDVDES;\n\n     } else if(SiS_Pr->SiS_LCDInfo & DontExpandLCD) {\n\n\tif(SiS_Pr->SiS_VGAHDE != SiS_Pr->PanelXRes) {\n\t   SiS_Pr->SiS_LCDHDES = SiS_Pr->SiS_HT - ((SiS_Pr->PanelXRes - SiS_Pr->SiS_VGAHDE) / 2);\n\t}\n\tif(SiS_Pr->SiS_VGAVDE != SiS_Pr->PanelYRes) {\n\t   SiS_Pr->SiS_LCDVDES = SiS_Pr->SiS_VT - ((SiS_Pr->PanelYRes - SiS_Pr->SiS_VGAVDE) / 2);\n\t} else {\n\t   if(SiS_Pr->ChipType < SIS_315H) {\n\t      SiS_Pr->SiS_LCDVDES = SiS_Pr->PanelVT - 1;\n\t   } else {\n\t      switch(SiS_Pr->SiS_LCDResInfo) {\n\t      case Panel_800x600:\n\t      case Panel_1024x768:\n\t      case Panel_1280x1024:\n\t\t SiS_Pr->SiS_LCDVDES = SiS_Pr->PanelVT;\n\t\t break;\n\t      case Panel_1400x1050:\n\t\t SiS_Pr->SiS_LCDVDES = SiS_Pr->PanelVT - 1;\n\t\t break;\n\t      }\n\t   }\n\t}\n\n     } else {\n\n        if(SiS_Pr->ChipType < SIS_315H) {\n#ifdef CONFIG_FB_SIS_300\n\t   switch(SiS_Pr->SiS_LCDResInfo) {\n\t   case Panel_800x600:\n\t      if(SiS_Pr->SiS_VGAVDE == SiS_Pr->PanelYRes) {\n\t\t SiS_Pr->SiS_LCDVDES = SiS_Pr->PanelVT - 1;\n\t      } else {\n\t\t SiS_Pr->SiS_LCDHDES = SiS_Pr->PanelHT + 3;\n\t\t SiS_Pr->SiS_LCDVDES = SiS_Pr->PanelVT;\n\t\t if(SiS_Pr->SiS_VGAVDE == 400) SiS_Pr->SiS_LCDVDES -= 2;\n\t\t else                          SiS_Pr->SiS_LCDVDES -= 4;\n\t      }\n\t      break;\n\t   case Panel_1024x768:\n\t      if(SiS_Pr->SiS_VGAVDE == SiS_Pr->PanelYRes) {\n\t\t SiS_Pr->SiS_LCDVDES = SiS_Pr->PanelVT - 1;\n\t      } else {\n\t\t SiS_Pr->SiS_LCDHDES = SiS_Pr->PanelHT - 1;\n\t\t if(SiS_Pr->SiS_VGAVDE <= 400) SiS_Pr->SiS_LCDVDES = SiS_Pr->PanelVT - 8;\n\t\t if(SiS_Pr->SiS_VGAVDE <= 350) SiS_Pr->SiS_LCDVDES = SiS_Pr->PanelVT - 12;\n\t      }\n\t      break;\n\t   case Panel_1024x600:\n\t   default:\n\t      if( (SiS_Pr->SiS_VGAHDE == SiS_Pr->PanelXRes) &&\n\t\t  (SiS_Pr->SiS_VGAVDE == SiS_Pr->PanelYRes) ) {\n\t\t SiS_Pr->SiS_LCDVDES = SiS_Pr->PanelVT - 1;\n\t      } else {\n\t\t SiS_Pr->SiS_LCDHDES = SiS_Pr->PanelHT - 1;\n\t      }\n\t      break;\n\t   }\n\n\t   switch(SiS_Pr->SiS_LCDTypeInfo) {\n\t   case 1:\n\t      SiS_Pr->SiS_LCDHDES = SiS_Pr->SiS_LCDVDES = 0;\n\t      break;\n\t   case 3:  \n\t      SiS_Pr->SiS_LCDHDES = 8;\n\t      if     (SiS_Pr->SiS_VGAVDE >= 480) SiS_Pr->SiS_LCDVDES = 512;\n\t      else if(SiS_Pr->SiS_VGAVDE >= 400) SiS_Pr->SiS_LCDVDES = 436;\n\t      else if(SiS_Pr->SiS_VGAVDE >= 350) SiS_Pr->SiS_LCDVDES = 440;\n\t      break;\n\t   }\n#endif\n        } else {\n#ifdef CONFIG_FB_SIS_315\n\t   switch(SiS_Pr->SiS_LCDResInfo) {\n\t   case Panel_1024x768:\n\t   case Panel_1280x1024:\n\t      if(SiS_Pr->SiS_VGAVDE == SiS_Pr->PanelYRes) {\n\t         SiS_Pr->SiS_LCDVDES = SiS_Pr->PanelVT - 1;\n\t      }\n\t      break;\n\t   case Panel_320x240_1:\n\t   case Panel_320x240_2:\n\t   case Panel_320x240_3:\n\t      SiS_Pr->SiS_LCDVDES = 524;\n\t      break;\n\t   }\n#endif\n\t}\n     }\n\n     if((ModeNo <= 0x13) && (SiS_Pr->SiS_LCDInfo & DontExpandLCD)) {\n\tmodeflag = SiS_Pr->SiS_SModeIDTable[ModeIdIndex].St_ModeFlag;\n\tif((SiS_Pr->SiS_VBType & VB_SIS30xBLV) && (SiS_Pr->SiS_VBInfo & SetCRT2ToLCDA)) {\n\t   if(!(modeflag & HalfDCLK)) SiS_Pr->SiS_LCDHDES = 632;\n\t} else if(!(SiS_Pr->SiS_SetFlag & SetDOSMode)) {\n\t   if(SiS_Pr->SiS_LCDResInfo != Panel_1280x1024) {\n\t      if(SiS_Pr->SiS_LCDResInfo >= Panel_1024x768) {\n\t         if(SiS_Pr->ChipType < SIS_315H) {\n\t            if(!(modeflag & HalfDCLK)) SiS_Pr->SiS_LCDHDES = 320;\n\t         } else {\n#ifdef CONFIG_FB_SIS_315\n\t\t    if(SiS_Pr->SiS_LCDResInfo == Panel_1024x768)  SiS_Pr->SiS_LCDHDES = 480;\n\t\t    if(SiS_Pr->SiS_LCDResInfo == Panel_1400x1050) SiS_Pr->SiS_LCDHDES = 804;\n\t\t    if(SiS_Pr->SiS_LCDResInfo == Panel_1600x1200) SiS_Pr->SiS_LCDHDES = 704;\n\t\t    if(!(modeflag & HalfDCLK)) {\n\t\t       SiS_Pr->SiS_LCDHDES = 320;\n\t\t       if(SiS_Pr->SiS_LCDResInfo == Panel_1400x1050) SiS_Pr->SiS_LCDHDES = 632;\n\t\t       if(SiS_Pr->SiS_LCDResInfo == Panel_1600x1200) SiS_Pr->SiS_LCDHDES = 542;\n        \t    }\n#endif\n\t\t }\n\t      }\n\t   }\n\t}\n     }\n  }\n}\n\n \n \n \n\n#ifdef CONFIG_FB_SIS_315\nstatic int\nSiS_HandlePWD(struct SiS_Private *SiS_Pr)\n{\n   int ret = 0;\n#ifdef SET_PWD\n   unsigned char *ROMAddr = SiS_Pr->VirtualRomBase;\n   unsigned short romptr = GetLCDStructPtr661_2(SiS_Pr);\n   unsigned char  drivermode = SiS_GetReg(SiS_Pr->SiS_P3d4,0x31) & 0x40;\n   unsigned short temp;\n\n   if( (SiS_Pr->SiS_VBType & VB_SISPWD) &&\n       (romptr)\t\t\t\t&&\n       (SiS_Pr->SiS_PWDOffset) ) {\n      SiS_SetReg(SiS_Pr->SiS_Part4Port,0x2b,ROMAddr[romptr + SiS_Pr->SiS_PWDOffset + 0]);\n      SiS_SetReg(SiS_Pr->SiS_Part4Port,0x2c,ROMAddr[romptr + SiS_Pr->SiS_PWDOffset + 1]);\n      SiS_SetReg(SiS_Pr->SiS_Part4Port,0x2d,ROMAddr[romptr + SiS_Pr->SiS_PWDOffset + 2]);\n      SiS_SetReg(SiS_Pr->SiS_Part4Port,0x2e,ROMAddr[romptr + SiS_Pr->SiS_PWDOffset + 3]);\n      SiS_SetReg(SiS_Pr->SiS_Part4Port,0x2f,ROMAddr[romptr + SiS_Pr->SiS_PWDOffset + 4]);\n      temp = 0x00;\n      if((ROMAddr[romptr + 2] & (0x06 << 1)) && !drivermode) {\n         temp = 0x80;\n\t ret = 1;\n      }\n      SiS_SetRegANDOR(SiS_Pr->SiS_Part4Port,0x27,0x7f,temp);\n   }\n#endif\n   return ret;\n}\n#endif\n\n \nvoid\nSiS_DisableBridge(struct SiS_Private *SiS_Pr)\n{\n#ifdef CONFIG_FB_SIS_315\n  unsigned short tempah, pushax=0, modenum;\n#endif\n  unsigned short temp=0;\n\n  if(SiS_Pr->SiS_VBType & VB_SISVB) {\n\n     if(SiS_Pr->SiS_VBType & VB_SIS30xBLV) {\t\t \n\n\tif(SiS_Pr->ChipType < SIS_315H) {\n\n#ifdef CONFIG_FB_SIS_300\t    \n\n\t   if(!(SiS_CR36BIOSWord23b(SiS_Pr))) {\n\t      if(SiS_Pr->SiS_VBType & VB_SISLVDS) {\n\t\t SiS_SetRegAND(SiS_Pr->SiS_Part4Port,0x26,0xFE);\n\t      } else {\n\t\t SiS_SetRegSR11ANDOR(SiS_Pr,0xF7,0x08);\n\t      }\n\t      SiS_PanelDelay(SiS_Pr, 3);\n\t   }\n\t   if(SiS_Is301B(SiS_Pr)) {\n\t      SiS_SetRegAND(SiS_Pr->SiS_Part4Port,0x1f,0x3f);\n\t      SiS_ShortDelay(SiS_Pr,1);\n\t   }\n\t   SiS_SetRegAND(SiS_Pr->SiS_Part2Port,0x00,0xDF);\n\t   SiS_DisplayOff(SiS_Pr);\n\t   SiS_SetRegAND(SiS_Pr->SiS_P3c4,0x32,0xDF);\n\t   SiS_SetRegAND(SiS_Pr->SiS_P3c4,0x1E,0xDF);\n\t   SiS_UnLockCRT2(SiS_Pr);\n\t   if(!(SiS_Pr->SiS_VBType & VB_SISLVDS)) {\n\t      SiS_SetRegOR(SiS_Pr->SiS_Part1Port,0x01,0x80);\n\t      SiS_SetRegOR(SiS_Pr->SiS_Part1Port,0x02,0x40);\n\t   }\n\t   if( (!(SiS_CRT2IsLCD(SiS_Pr))) ||\n\t       (!(SiS_CR36BIOSWord23d(SiS_Pr))) ) {\n\t      SiS_PanelDelay(SiS_Pr, 2);\n\t      if(SiS_Pr->SiS_VBType & VB_SISLVDS) {\n\t         SiS_SetRegAND(SiS_Pr->SiS_Part4Port,0x26,0xFD);\n\t      } else {\n\t\t SiS_SetRegSR11ANDOR(SiS_Pr,0xFB,0x04);\n\t      }\n\t   }\n\n#endif   \n\n        } else {\n\n#ifdef CONFIG_FB_SIS_315\t    \n\n\t   int didpwd = 0;\n\t   bool custom1 = (SiS_Pr->SiS_CustomT == CUT_COMPAQ1280) ||\n\t                  (SiS_Pr->SiS_CustomT == CUT_CLEVO1400);\n\n\t   modenum = SiS_GetReg(SiS_Pr->SiS_P3d4,0x34) & 0x7f;\n\n\t   if(SiS_Pr->SiS_VBType & VB_SISLVDS) {\n\n#ifdef SET_EMI\n\t      if(SiS_Pr->SiS_VBType & VB_SISEMI) {\n\t\t if(SiS_Pr->SiS_CustomT != CUT_CLEVO1400) {\n\t\t    SiS_SetRegAND(SiS_Pr->SiS_Part4Port,0x30,0x0c);\n\t\t }\n\t      }\n#endif\n\n\t      didpwd = SiS_HandlePWD(SiS_Pr);\n\n\t      if( (modenum <= 0x13)           ||\n\t\t  (SiS_IsVAMode(SiS_Pr))      ||\n\t\t  (!(SiS_IsDualEdge(SiS_Pr))) ) {\n\t\t if(!didpwd) {\n\t\t    SiS_SetRegAND(SiS_Pr->SiS_Part4Port,0x26,0xfe);\n\t\t    if(custom1) SiS_PanelDelay(SiS_Pr, 3);\n\t\t } else {\n\t\t    SiS_SetRegAND(SiS_Pr->SiS_Part4Port,0x26,0xfc);\n\t\t }\n\t      }\n\n\t      if(!custom1) {\n\t\t SiS_DDC2Delay(SiS_Pr,0xff00);\n\t\t SiS_DDC2Delay(SiS_Pr,0xe000);\n\t\t SiS_SetRegByte(SiS_Pr->SiS_P3c6,0x00);\n\t\t pushax = SiS_GetReg(SiS_Pr->SiS_P3c4,0x06);\n\t\t if(IS_SIS740) {\n\t\t    SiS_SetRegAND(SiS_Pr->SiS_P3c4,0x06,0xE3);\n\t\t }\n\t         SiS_PanelDelay(SiS_Pr, 3);\n\t      }\n\n\t   }\n\n\t   if(!(SiS_IsNotM650orLater(SiS_Pr))) {\n\t       \n\t\t tempah = 0xef;\n\t\t if(SiS_IsVAMode(SiS_Pr)) tempah = 0xf7;\n\t\t SiS_SetRegAND(SiS_Pr->SiS_Part1Port,0x4c,tempah);\n\t       \n\t   }\n\n\t   if(SiS_Pr->SiS_VBType & VB_SISLVDS) {\n\t      SiS_SetRegAND(SiS_Pr->SiS_Part4Port,0x1F,~0x10);\n\t   }\n\n\t   tempah = 0x3f;\n\t   if(SiS_IsDualEdge(SiS_Pr)) {\n\t      tempah = 0x7f;\n\t      if(!(SiS_IsVAMode(SiS_Pr))) tempah = 0xbf;\n\t   }\n\t   SiS_SetRegAND(SiS_Pr->SiS_Part4Port,0x1F,tempah);\n\n\t   if((SiS_IsVAMode(SiS_Pr)) ||\n\t      ((SiS_Pr->SiS_VBType & VB_SISLVDS) && (modenum <= 0x13))) {\n\n\t      SiS_DisplayOff(SiS_Pr);\n\t      if(SiS_Pr->SiS_VBType & VB_SISLVDS) {\n\t\t SiS_PanelDelay(SiS_Pr, 2);\n\t      }\n\t      SiS_SetRegAND(SiS_Pr->SiS_P3c4,0x32,0xDF);\n\t      SiS_SetRegAND(SiS_Pr->SiS_Part1Port,0x1E,0xDF);\n\n\t   }\n\n\t   if((!(SiS_IsVAMode(SiS_Pr))) ||\n\t      ((SiS_Pr->SiS_VBType & VB_SISLVDS) && (modenum <= 0x13))) {\n\n\t      if(!(SiS_IsDualEdge(SiS_Pr))) {\n\t\t SiS_SetRegAND(SiS_Pr->SiS_Part2Port,0x00,0xdf);\n\t\t SiS_DisplayOff(SiS_Pr);\n\t      }\n\t      SiS_SetRegOR(SiS_Pr->SiS_Part1Port,0x00,0x80);\n\n\t      if(SiS_Pr->SiS_VBType & VB_SISLVDS) {\n\t\t SiS_PanelDelay(SiS_Pr, 2);\n\t      }\n\n\t      SiS_SetRegAND(SiS_Pr->SiS_P3c4,0x32,0xDF);\n\t      temp = SiS_GetReg(SiS_Pr->SiS_Part1Port,0x00);\n\t      SiS_SetRegOR(SiS_Pr->SiS_Part1Port,0x00,0x10);\n\t      SiS_SetRegAND(SiS_Pr->SiS_P3c4,0x1E,0xDF);\n\t      SiS_SetReg(SiS_Pr->SiS_Part1Port,0x00,temp);\n\n\t   }\n\n\t   if(SiS_IsNotM650orLater(SiS_Pr)) {\n\t      SiS_SetRegAND(SiS_Pr->SiS_Part1Port,0x2e,0x7f);\n\t   }\n\n\t   if(SiS_Pr->SiS_VBType & VB_SISLVDS) {\n\n\t      if( (!(SiS_IsVAMode(SiS_Pr)))  &&\n\t\t  (!(SiS_CRT2IsLCD(SiS_Pr))) &&\n\t\t  (!(SiS_IsDualEdge(SiS_Pr))) ) {\n\n\t\t if(custom1) SiS_PanelDelay(SiS_Pr, 2);\n\t\t if(!didpwd) {\n\t\t    SiS_SetRegAND(SiS_Pr->SiS_Part4Port,0x26,0xFD);\n\t\t }\n\t\t if(custom1) SiS_PanelDelay(SiS_Pr, 4);\n\t      }\n\n\t      if(!custom1) {\n\t\t SiS_SetReg(SiS_Pr->SiS_P3c4,0x06,pushax);\n\t\t if(SiS_Pr->SiS_VBType & VB_SISEMI) {\n\t\t    if(SiS_IsVAorLCD(SiS_Pr)) {\n\t\t       SiS_PanelDelayLoop(SiS_Pr, 3, 20);\n\t\t    }\n\t\t }\n\t      }\n\n\t   }\n\n#endif  \n\n\t}\n\n     } else {      \n\n        if(SiS_Pr->ChipType < SIS_315H) {\n#ifdef CONFIG_FB_SIS_300\n\t   if(!(SiS_CR36BIOSWord23b(SiS_Pr))) {\n\t      SiS_SetRegSR11ANDOR(SiS_Pr,0xF7,0x08);\n\t      SiS_PanelDelay(SiS_Pr, 3);\n\t   }\n#endif\n\t}\n\n\tSiS_SetRegAND(SiS_Pr->SiS_Part2Port,0x00,0xDF);            \n\tSiS_DisplayOff(SiS_Pr);\n\n\tif(SiS_Pr->ChipType >= SIS_315H) {\n\t   SiS_SetRegOR(SiS_Pr->SiS_Part1Port,0x00,0x80);\n\t}\n\n\tSiS_SetRegAND(SiS_Pr->SiS_P3c4,0x32,0xDF);                 \n\n\tif(SiS_Pr->ChipType >= SIS_315H) {\n\t    temp = SiS_GetReg(SiS_Pr->SiS_Part1Port,0x00);\n\t    SiS_SetRegOR(SiS_Pr->SiS_Part1Port,0x00,0x10);\n\t    SiS_SetRegOR(SiS_Pr->SiS_P3c4,0x1E,0x20);\n\t    SiS_SetReg(SiS_Pr->SiS_Part1Port,0x00,temp);\n\t} else {\n#ifdef CONFIG_FB_SIS_300\n\t    SiS_SetRegAND(SiS_Pr->SiS_P3c4,0x1E,0xDF);             \n\t    if( (!(SiS_CRT2IsLCD(SiS_Pr))) ||\n\t\t(!(SiS_CR36BIOSWord23d(SiS_Pr))) ) {\n\t\tSiS_PanelDelay(SiS_Pr, 2);\n\t\tSiS_SetRegSR11ANDOR(SiS_Pr,0xFB,0x04);\n\t    }\n#endif\n\t}\n\n      }\n\n  } else {      \n\n    if(SiS_Pr->ChipType < SIS_315H) {\n\n#ifdef CONFIG_FB_SIS_300\t \n\n\tif(SiS_Pr->SiS_IF_DEF_CH70xx == 1) {\n\t   SiS_SetCH700x(SiS_Pr,0x0E,0x09);\n\t}\n\n\tif(SiS_Pr->ChipType == SIS_730) {\n\t   if(!(SiS_GetReg(SiS_Pr->SiS_P3c4,0x11) & 0x08)) {\n\t      SiS_WaitVBRetrace(SiS_Pr);\n\t   }\n\t   if(!(SiS_CR36BIOSWord23b(SiS_Pr))) {\n\t      SiS_SetRegSR11ANDOR(SiS_Pr,0xF7,0x08);\n\t      SiS_PanelDelay(SiS_Pr, 3);\n\t   }\n\t} else {\n\t   if(!(SiS_GetReg(SiS_Pr->SiS_P3c4,0x11) & 0x08)) {\n\t      if(!(SiS_GetReg(SiS_Pr->SiS_P3c4,0x13) & 0x40)) {\n\t\t if(!(SiS_CR36BIOSWord23b(SiS_Pr))) {\n\t\t    SiS_WaitVBRetrace(SiS_Pr);\n\t\t    if(!(SiS_GetReg(SiS_Pr->SiS_P3c4,0x06) & 0x1c)) {\n\t\t       SiS_DisplayOff(SiS_Pr);\n\t\t    }\n\t\t    SiS_SetRegSR11ANDOR(SiS_Pr,0xF7,0x08);\n\t\t    SiS_PanelDelay(SiS_Pr, 3);\n\t\t }\n\t      }\n\t   }\n\t}\n\n\tSiS_DisplayOff(SiS_Pr);\n\n\tSiS_SetRegAND(SiS_Pr->SiS_P3c4,0x32,0xDF);\n\n\tSiS_SetRegAND(SiS_Pr->SiS_P3c4,0x1E,0xDF);\n\tSiS_UnLockCRT2(SiS_Pr);\n\tSiS_SetRegOR(SiS_Pr->SiS_Part1Port,0x01,0x80);\n\tSiS_SetRegOR(SiS_Pr->SiS_Part1Port,0x02,0x40);\n\n\tif( (!(SiS_CRT2IsLCD(SiS_Pr))) ||\n\t    (!(SiS_CR36BIOSWord23d(SiS_Pr))) ) {\n\t   SiS_PanelDelay(SiS_Pr, 2);\n\t   SiS_SetRegSR11ANDOR(SiS_Pr,0xFB,0x04);\n\t}\n\n#endif   \n\n    } else {\n\n#ifdef CONFIG_FB_SIS_315\t \n\n\tif(!(SiS_IsNotM650orLater(SiS_Pr))) {\n\t      \n\t      SiS_SetRegAND(SiS_Pr->SiS_Part1Port,0x4c,~0x18);\n\t    \n\t}\n\n\tif(SiS_Pr->SiS_IF_DEF_CH70xx != 0) {\n\n\t   if(SiS_Pr->ChipType == SIS_740) {\n\t      temp = SiS_GetCH701x(SiS_Pr,0x61);\n\t      if(temp < 1) {\n\t\t SiS_SetCH701x(SiS_Pr,0x76,0xac);\n\t\t SiS_SetCH701x(SiS_Pr,0x66,0x00);\n\t      }\n\n\t      if( (!(SiS_IsDualEdge(SiS_Pr))) ||\n\t\t  (SiS_IsTVOrYPbPrOrScart(SiS_Pr)) ) {\n\t\t SiS_SetCH701x(SiS_Pr,0x49,0x3e);\n\t      }\n\t   }\n\n\t   if( (!(SiS_IsDualEdge(SiS_Pr))) ||\n\t       (SiS_IsVAMode(SiS_Pr)) ) {\n\t      SiS_Chrontel701xBLOff(SiS_Pr);\n\t      SiS_Chrontel701xOff(SiS_Pr);\n\t   }\n\n\t   if(SiS_Pr->ChipType != SIS_740) {\n\t      if( (!(SiS_IsDualEdge(SiS_Pr))) ||\n\t\t  (SiS_IsTVOrYPbPrOrScart(SiS_Pr)) ) {\n\t\t SiS_SetCH701x(SiS_Pr,0x49,0x01);\n\t      }\n\t   }\n\n\t}\n\n\tif(SiS_Pr->SiS_IF_DEF_CH70xx == 0) {\n\t   SiS_SetRegSR11ANDOR(SiS_Pr,0xF7,0x08);\n\t   SiS_PanelDelay(SiS_Pr, 3);\n\t}\n\n\tif( (SiS_Pr->SiS_IF_DEF_CH70xx == 0)   ||\n\t    (!(SiS_IsDualEdge(SiS_Pr))) ||\n\t    (!(SiS_IsTVOrYPbPrOrScart(SiS_Pr))) ) {\n\t   SiS_DisplayOff(SiS_Pr);\n\t}\n\n\tif( (SiS_Pr->SiS_IF_DEF_CH70xx == 0)   ||\n\t    (!(SiS_IsDualEdge(SiS_Pr))) ||\n\t    (!(SiS_IsVAMode(SiS_Pr))) ) {\n\t   SiS_SetRegOR(SiS_Pr->SiS_Part1Port,0x00,0x80);\n\t}\n\n\tif(SiS_Pr->ChipType == SIS_740) {\n\t   SiS_SetRegAND(SiS_Pr->SiS_Part1Port,0x2e,0x7f);\n\t}\n\n\tSiS_SetRegAND(SiS_Pr->SiS_P3c4,0x32,0xDF);\n\n\tif( (SiS_Pr->SiS_IF_DEF_CH70xx == 0)   ||\n\t    (!(SiS_IsDualEdge(SiS_Pr))) ||\n\t    (!(SiS_IsVAMode(SiS_Pr))) ) {\n\t   SiS_SetRegAND(SiS_Pr->SiS_P3c4,0x1E,0xDF);\n\t}\n\n\tif(SiS_Pr->SiS_IF_DEF_CH70xx == 0) {\n\t   if(SiS_CRT2IsLCD(SiS_Pr)) {\n\t      SiS_SetRegAND(SiS_Pr->SiS_Part1Port,0x1e,0xdf);\n\t      if(SiS_Pr->ChipType == SIS_550) {\n\t\t SiS_SetRegAND(SiS_Pr->SiS_Part1Port,0x1e,0xbf);\n\t\t SiS_SetRegAND(SiS_Pr->SiS_Part1Port,0x1e,0xef);\n\t      }\n\t   }\n\t} else {\n\t   if(SiS_Pr->ChipType == SIS_740) {\n\t      if(SiS_IsLCDOrLCDA(SiS_Pr)) {\n\t\t SiS_SetRegAND(SiS_Pr->SiS_Part1Port,0x1e,0xdf);\n\t      }\n\t   } else if(SiS_IsVAMode(SiS_Pr)) {\n\t      SiS_SetRegAND(SiS_Pr->SiS_Part1Port,0x1e,0xdf);\n\t   }\n\t}\n\n\tif(SiS_Pr->SiS_IF_DEF_CH70xx != 0) {\n\t   if(SiS_IsDualEdge(SiS_Pr)) {\n\t       \n\t   } else {\n\t      SiS_SetRegAND(SiS_Pr->SiS_Part1Port,0x13,0xfb);\n\t   }\n\t}\n\n\tSiS_UnLockCRT2(SiS_Pr);\n\n\tif(SiS_Pr->ChipType == SIS_550) {\n\t   SiS_SetRegOR(SiS_Pr->SiS_Part1Port,0x01,0x80);  \n\t   SiS_SetRegOR(SiS_Pr->SiS_Part1Port,0x02,0x40);  \n\t} else if( (SiS_Pr->SiS_IF_DEF_CH70xx == 0)   ||\n\t\t   (!(SiS_IsDualEdge(SiS_Pr))) ||\n\t\t   (!(SiS_IsVAMode(SiS_Pr))) ) {\n\t   SiS_SetRegAND(SiS_Pr->SiS_Part1Port,0x2e,0xf7);\n\t}\n\n        if(SiS_Pr->SiS_IF_DEF_CH70xx == 0) {\n\t   if(SiS_CRT2IsLCD(SiS_Pr)) {\n\t      if(!(SiS_WeHaveBacklightCtrl(SiS_Pr))) {\n\t\t SiS_PanelDelay(SiS_Pr, 2);\n\t\t SiS_SetRegSR11ANDOR(SiS_Pr,0xFB,0x04);\n\t      }\n\t   }\n        }\n\n#endif   \n\n    }   \n\n  }   \n\n}\n\n \n \n \n\n \nstatic\nvoid\nSiS_EnableBridge(struct SiS_Private *SiS_Pr)\n{\n  unsigned short temp=0, tempah;\n#ifdef CONFIG_FB_SIS_315\n  unsigned short temp1, pushax=0;\n  bool delaylong = false;\n#endif\n\n  if(SiS_Pr->SiS_VBType & VB_SISVB) {\n\n    if(SiS_Pr->SiS_VBType & VB_SIS30xBLV) {\t\t \n\n      if(SiS_Pr->ChipType < SIS_315H) {\n\n#ifdef CONFIG_FB_SIS_300      \n\n\t if(SiS_CRT2IsLCD(SiS_Pr)) {\n\t    if(SiS_Pr->SiS_VBType & VB_SISLVDS) {\n\t       SiS_SetRegOR(SiS_Pr->SiS_Part4Port,0x26,0x02);\n\t    } else if(SiS_Pr->SiS_VBType & VB_NoLCD) {\n\t       SiS_SetRegSR11ANDOR(SiS_Pr,0xFB,0x00);\n\t    }\n\t    if(SiS_Pr->SiS_VBType & (VB_SISLVDS | VB_NoLCD)) {\n\t       if(!(SiS_CR36BIOSWord23d(SiS_Pr))) {\n\t\t  SiS_PanelDelay(SiS_Pr, 0);\n\t       }\n\t    }\n\t }\n\n\t if((SiS_Pr->SiS_VBType & VB_NoLCD) &&\n\t    (SiS_CRT2IsLCD(SiS_Pr))) {\n\n\t    SiS_SetRegOR(SiS_Pr->SiS_P3c4,0x1E,0x20);   \t\t \n\t    SiS_DisplayOn(SiS_Pr);\n\t    SiS_UnLockCRT2(SiS_Pr);\n\t    SiS_SetRegAND(SiS_Pr->SiS_Part1Port,0x02,0xBF);\n\t    if(SiS_BridgeInSlavemode(SiS_Pr)) {\n\t       SiS_SetRegAND(SiS_Pr->SiS_Part1Port,0x01,0x1F);\n\t    } else {\n\t       SiS_SetRegANDOR(SiS_Pr->SiS_Part1Port,0x01,0x1F,0x40);\n\t    }\n\t    if(!(SiS_GetReg(SiS_Pr->SiS_P3c4,0x13) & 0x40)) {\n\t       if(!(SiS_GetReg(SiS_Pr->SiS_P3c4,0x16) & 0x10)) {\n\t\t  if(!(SiS_CR36BIOSWord23b(SiS_Pr))) {\n\t\t     SiS_PanelDelay(SiS_Pr, 1);\n\t\t  }\n\t\t  SiS_WaitVBRetrace(SiS_Pr);\n\t\t  SiS_SetRegSR11ANDOR(SiS_Pr,0xF7,0x00);\n\t       }\n\t    }\n\n\t } else {\n\n\t    temp = SiS_GetReg(SiS_Pr->SiS_P3c4,0x32) & 0xDF;              \n\t    if(SiS_BridgeInSlavemode(SiS_Pr)) {\n\t       tempah = SiS_GetReg(SiS_Pr->SiS_P3d4,0x30);\n\t       if(!(tempah & SetCRT2ToRAMDAC)) temp |= 0x20;\n\t    }\n\t    SiS_SetReg(SiS_Pr->SiS_P3c4,0x32,temp);\n\t    SiS_SetRegOR(SiS_Pr->SiS_P3c4,0x1E,0x20);\n\t    SiS_SetRegANDOR(SiS_Pr->SiS_Part2Port,0x00,0x1F,0x20);         \n\t    SiS_SetRegOR(SiS_Pr->SiS_Part4Port,0x1F,0xC0);\n\t    SiS_DisplayOn(SiS_Pr);\n\t    if(SiS_Pr->SiS_VBType & VB_SISLVDS) {\n\t       if(SiS_CRT2IsLCD(SiS_Pr)) {\n\t\t  if(!(SiS_GetReg(SiS_Pr->SiS_P3c4,0x16) & 0x10)) {\n\t\t     if(!(SiS_CR36BIOSWord23b(SiS_Pr))) {\n\t\t        SiS_PanelDelay(SiS_Pr, 1);\n\t\t     }\n\t\t     SiS_SetRegOR(SiS_Pr->SiS_Part4Port,0x26,0x01);\n\t\t  }\n\t       }\n\t    }\n\n\t }\n\n\n#endif  \n\n      } else {\n\n#ifdef CONFIG_FB_SIS_315     \n\n#ifdef SET_EMI\n\t unsigned char   r30=0, r31=0, r32=0, r33=0, cr36=0;\n\t int didpwd = 0;\n\t  \n#endif\n\n\t if(SiS_Pr->SiS_VBType & VB_SISLVDS) {\n\t    SiS_SetRegAND(SiS_Pr->SiS_Part4Port,0x1f,0xef);\n#ifdef SET_EMI\n\t    if(SiS_Pr->SiS_VBType & VB_SISEMI) {\n\t       SiS_SetRegAND(SiS_Pr->SiS_Part4Port,0x30,0x0c);\n\t    }\n#endif\n\t }\n\n\t if(!(SiS_IsNotM650orLater(SiS_Pr))) {\n\t     \n\t       tempah = 0x10;\n\t       if(SiS_LCDAEnabled(SiS_Pr)) {\n\t\t  if(SiS_TVEnabled(SiS_Pr)) tempah = 0x18;\n\t\t  else\t\t\t    tempah = 0x08;\n\t       }\n\t       SiS_SetReg(SiS_Pr->SiS_Part1Port,0x4c,tempah);\n\t     \n\t }\n\n\t if(SiS_Pr->SiS_VBType & VB_SISLVDS) {\n\n\t    SiS_SetRegByte(SiS_Pr->SiS_P3c6,0x00);\n\t    SiS_DisplayOff(SiS_Pr);\n\t    pushax = SiS_GetReg(SiS_Pr->SiS_P3c4,0x06);\n\t    if(IS_SIS740) {\n\t       SiS_SetRegAND(SiS_Pr->SiS_P3c4,0x06,0xE3);\n\t    }\n\n\t    didpwd = SiS_HandlePWD(SiS_Pr);\n\n\t    if(SiS_IsVAorLCD(SiS_Pr)) {\n\t       if(!didpwd) {\n\t\t  if(!(SiS_GetReg(SiS_Pr->SiS_Part4Port,0x26) & 0x02)) {\n\t\t     SiS_PanelDelayLoop(SiS_Pr, 3, 2);\n\t\t     SiS_SetRegOR(SiS_Pr->SiS_Part4Port,0x26,0x02);\n\t\t     SiS_PanelDelayLoop(SiS_Pr, 3, 2);\n\t\t     if(SiS_Pr->SiS_VBType & VB_SISEMI) {\n\t\t        SiS_GenericDelay(SiS_Pr, 17664);\n\t\t     }\n\t\t  }\n\t       } else {\n\t\t  SiS_PanelDelayLoop(SiS_Pr, 3, 2);\n\t\t  if(SiS_Pr->SiS_VBType & VB_SISEMI) {\n\t\t     SiS_GenericDelay(SiS_Pr, 17664);\n\t\t  }\n\t       }\n\t    }\n\n\t    if(!(SiS_GetReg(SiS_Pr->SiS_P3d4,0x31) & 0x40)) {\n\t       SiS_PanelDelayLoop(SiS_Pr, 3, 10);\n\t       delaylong = true;\n\t    }\n\n\t }\n\n\t if(!(SiS_IsVAMode(SiS_Pr))) {\n\n\t    temp = SiS_GetReg(SiS_Pr->SiS_P3c4,0x32) & 0xDF;\n\t    if(SiS_BridgeInSlavemode(SiS_Pr)) {\n\t       tempah = SiS_GetReg(SiS_Pr->SiS_P3d4,0x30);\n\t       if(!(tempah & SetCRT2ToRAMDAC)) {\n\t\t  if(!(SiS_LCDAEnabled(SiS_Pr))) temp |= 0x20;\n\t       }\n\t    }\n\t    SiS_SetReg(SiS_Pr->SiS_P3c4,0x32,temp);\n\n\t    SiS_SetRegOR(SiS_Pr->SiS_P3c4,0x1E,0x20);                    \n\n\t    SiS_SetRegAND(SiS_Pr->SiS_Part1Port,0x2e,0x7f);\n\t    SiS_SetRegOR(SiS_Pr->SiS_Part1Port,0x2e,0x80);\n\n\t    if(SiS_Pr->SiS_VBType & VB_SISLVDS) {\n\t       SiS_PanelDelay(SiS_Pr, 2);\n\t    }\n\n\t } else {\n\n\t    SiS_SetRegOR(SiS_Pr->SiS_Part1Port,0x1e,0x20);\n\n\t }\n\n\t SiS_SetRegANDOR(SiS_Pr->SiS_Part2Port,0x00,0x1f,0x20);\n\t SiS_SetRegOR(SiS_Pr->SiS_Part1Port,0x2e,0x80);\n\n\t if(SiS_Pr->SiS_VBType & VB_SISPOWER) {\n\t    if( (SiS_LCDAEnabled(SiS_Pr)) ||\n\t        (SiS_CRT2IsLCD(SiS_Pr)) ) {\n\t        \n\t       SiS_SetRegAND(SiS_Pr->SiS_Part4Port,0x2a,0x7f);\n\t        \n\t       SiS_SetRegAND(SiS_Pr->SiS_Part4Port,0x30,0x7f);\n\t    }\n\t }\n\n\t tempah = 0xc0;\n\t if(SiS_IsDualEdge(SiS_Pr)) {\n\t    tempah = 0x80;\n\t    if(!(SiS_IsVAMode(SiS_Pr))) tempah = 0x40;\n\t }\n\t SiS_SetRegOR(SiS_Pr->SiS_Part4Port,0x1F,tempah);\n\n\t if(SiS_Pr->SiS_VBType & VB_SISLVDS) {\n\n\t    SiS_PanelDelay(SiS_Pr, 2);\n\n\t    SiS_SetRegOR(SiS_Pr->SiS_Part4Port,0x1f,0x10);\n\t    SiS_SetRegOR(SiS_Pr->SiS_Part1Port,0x2e,0x80);\n\n\t    if(SiS_Pr->SiS_CustomT != CUT_CLEVO1400) {\n#ifdef SET_EMI\n\t       if(SiS_Pr->SiS_VBType & VB_SISEMI) {\n\t\t  SiS_SetRegAND(SiS_Pr->SiS_Part4Port,0x30,0x0c);\n\t\t  SiS_GenericDelay(SiS_Pr, 2048);\n\t       }\n#endif\n\t       SiS_SetRegOR(SiS_Pr->SiS_Part4Port,0x27,0x0c);\n\n\t       if(SiS_Pr->SiS_VBType & VB_SISEMI) {\n#ifdef SET_EMI\n\t\t  cr36 = SiS_GetReg(SiS_Pr->SiS_P3d4,0x36);\n\n\t\t  if(SiS_Pr->SiS_ROMNew) {\n\t\t     unsigned char  *ROMAddr = SiS_Pr->VirtualRomBase;\n\t\t     unsigned short romptr = GetLCDStructPtr661_2(SiS_Pr);\n\t\t     if(romptr) {\n\t\t\tSiS_SetRegOR(SiS_Pr->SiS_Part4Port,0x30,0x20);  \n\t\t\tSiS_Pr->EMI_30 = 0;\n\t\t\tSiS_Pr->EMI_31 = ROMAddr[romptr + SiS_Pr->SiS_EMIOffset + 0];\n\t\t\tSiS_Pr->EMI_32 = ROMAddr[romptr + SiS_Pr->SiS_EMIOffset + 1];\n\t\t\tSiS_Pr->EMI_33 = ROMAddr[romptr + SiS_Pr->SiS_EMIOffset + 2];\n\t\t\tif(ROMAddr[romptr + 1] & 0x10) SiS_Pr->EMI_30 = 0x40;\n\t\t\t \n\t\t\tSiS_Pr->HaveEMI = SiS_Pr->HaveEMILCD = SiS_Pr->OverruleEMI = true;\n\t\t     }\n\t\t  }\n\n\t\t   \n\t\t   \n\t\t   \n\t\t   \n\t\t   \n\t\t   \n\t\t   \n\t\t   \n\t\t   \n\t\t   \n\n\t\t  if(SiS_Pr->HaveEMI) {\n\t\t     r30 = SiS_Pr->EMI_30; r31 = SiS_Pr->EMI_31;\n\t\t     r32 = SiS_Pr->EMI_32; r33 = SiS_Pr->EMI_33;\n\t\t  } else {\n\t\t     r30 = 0;\n\t\t  }\n\n\t\t   \n\n\t\t  if((!SiS_Pr->HaveEMI) || (!SiS_Pr->HaveEMILCD)) {\n\t\t     switch((cr36 & 0x0f)) {\n\t\t     case 2:\n\t\t\tr30 |= 0x40;\n\t\t\tif(SiS_Pr->SiS_CustomT == CUT_CLEVO1024) r30 &= ~0x40;\n\t\t\tif(!SiS_Pr->HaveEMI) {\n\t\t\t   r31 = 0x05; r32 = 0x60; r33 = 0x33;\n\t\t\t   if((cr36 & 0xf0) == 0x30) {\n\t\t\t      r31 = 0x0d; r32 = 0x70; r33 = 0x40;\n\t\t\t   }\n\t\t\t}\n\t\t\tbreak;\n\t\t     case 3:   \n\t\t\tif(SiS_Pr->SiS_CustomT == CUT_COMPAQ1280) r30 |= 0x40;\n\t\t\tif(!SiS_Pr->HaveEMI) {\n\t\t\t   r31 = 0x12; r32 = 0xd0; r33 = 0x6b;\n\t\t\t   if(SiS_Pr->SiS_CustomT == CUT_COMPAQ1280) {\n\t\t\t      r31 = 0x0d; r32 = 0x70; r33 = 0x6b;\n\t\t\t   }\n\t\t\t}\n\t\t\tbreak;\n\t\t     case 9:   \n\t\t\tr30 |= 0x40;\n\t\t\tif(!SiS_Pr->HaveEMI) {\n\t\t\t   r31 = 0x05; r32 = 0x60; r33 = 0x00;\n\t\t\t   if(SiS_Pr->SiS_CustomT == CUT_COMPAL1400_2) {\n\t\t\t      r31 = 0x0d; r32 = 0x70; r33 = 0x40;   \n\t\t\t   }\n\t\t\t}\n\t\t\tbreak;\n\t\t     case 11:  \n\t\t\tr30 |= 0x40;\n\t\t\tif(!SiS_Pr->HaveEMI) {\n\t\t\t   r31 = 0x05; r32 = 0x60; r33 = 0x00;\n\t\t\t}\n\t\t     }\n                  }\n\n\t\t   \n\t\t  if(!SiS_Pr->OverruleEMI) {\n#ifdef COMPAL_HACK\n\t\t     if(SiS_Pr->SiS_CustomT == CUT_COMPAL1400_2) {\n\t\t\tif((cr36 & 0x0f) == 0x09) {\n\t\t\t   r30 = 0x60; r31 = 0x05; r32 = 0x60; r33 = 0x00;\n\t\t\t}\n \t\t     }\n#endif\n#ifdef COMPAQ_HACK\n\t\t     if(SiS_Pr->SiS_CustomT == CUT_COMPAQ1280) {\n\t\t\tif((cr36 & 0x0f) == 0x03) {\n\t\t\t   r30 = 0x20; r31 = 0x12; r32 = 0xd0; r33 = 0x6b;\n\t\t\t}\n\t\t     }\n#endif\n#ifdef ASUS_HACK\n\t\t     if(SiS_Pr->SiS_CustomT == CUT_ASUSA2H_2) {\n\t\t\tif((cr36 & 0x0f) == 0x02) {\n\t\t\t        \n\t\t\t        \n\t\t\t        \n\t\t\t        \n\t\t\t}\n\t\t     }\n#endif\n\t\t  }\n\n\t\t  if(!(SiS_Pr->OverruleEMI && (!r30) && (!r31) && (!r32) && (!r33))) {\n\t\t     SiS_SetRegOR(SiS_Pr->SiS_Part4Port,0x30,0x20);  \n\t\t     SiS_GenericDelay(SiS_Pr, 2048);\n\t\t  }\n\t\t  SiS_SetReg(SiS_Pr->SiS_Part4Port,0x31,r31);\n\t\t  SiS_SetReg(SiS_Pr->SiS_Part4Port,0x32,r32);\n\t\t  SiS_SetReg(SiS_Pr->SiS_Part4Port,0x33,r33);\n#endif\t \n\n\t\t  SiS_SetReg(SiS_Pr->SiS_Part4Port,0x34,0x10);\n\n#ifdef SET_EMI\n\t\t  if( (SiS_LCDAEnabled(SiS_Pr)) ||\n\t\t      (SiS_CRT2IsLCD(SiS_Pr)) ) {\n\t\t     if(r30 & 0x40) {\n\t\t\t \n\t\t\tSiS_PanelDelayLoop(SiS_Pr, 3, 5);\n\t\t\tif(delaylong) {\n\t\t\t   SiS_PanelDelayLoop(SiS_Pr, 3, 5);\n\t\t\t   delaylong = false;\n\t\t\t}\n\t\t\tSiS_WaitVBRetrace(SiS_Pr);\n\t\t\tSiS_WaitVBRetrace(SiS_Pr);\n\t\t\tif(SiS_Pr->SiS_CustomT == CUT_ASUSA2H_2) {\n\t\t\t   SiS_GenericDelay(SiS_Pr, 1280);\n\t\t\t}\n\t\t\tSiS_SetRegOR(SiS_Pr->SiS_Part4Port,0x30,0x40);    \n\t\t\t \n\t\t     }\n\t\t  }\n#endif\n\t       }\n\t    }\n\n\t    if(!(SiS_WeHaveBacklightCtrl(SiS_Pr))) {\n\t       if(SiS_IsVAorLCD(SiS_Pr)) {\n\t\t  SiS_PanelDelayLoop(SiS_Pr, 3, 10);\n\t\t  if(delaylong) {\n\t\t     SiS_PanelDelayLoop(SiS_Pr, 3, 10);\n\t\t  }\n\t\t  SiS_WaitVBRetrace(SiS_Pr);\n\t\t  if(SiS_Pr->SiS_VBType & VB_SISEMI) {\n\t\t     SiS_GenericDelay(SiS_Pr, 2048);\n\t\t     SiS_WaitVBRetrace(SiS_Pr);\n\t\t  }\n\t\t  if(!didpwd) {\n\t\t     SiS_SetRegOR(SiS_Pr->SiS_Part4Port,0x26,0x01);\n\t\t  } else {\n\t\t     SiS_SetRegOR(SiS_Pr->SiS_Part4Port,0x26,0x03);\n\t\t  }\n\t       }\n\t    }\n\n\t    SiS_SetReg(SiS_Pr->SiS_P3c4,0x06,pushax);\n\t    SiS_DisplayOn(SiS_Pr);\n\t    SiS_SetRegByte(SiS_Pr->SiS_P3c6,0xff);\n\n\t }\n\n\t if(!(SiS_WeHaveBacklightCtrl(SiS_Pr))) {\n\t    SiS_SetRegAND(SiS_Pr->SiS_Part1Port,0x00,0x7f);\n\t }\n\n#endif  \n\n      }\n\n    } else {\t \n\n       if(SiS_Pr->ChipType < SIS_315H) {\n\t  if(SiS_CRT2IsLCD(SiS_Pr)) {\n\t     SiS_SetRegSR11ANDOR(SiS_Pr,0xFB,0x00);\n\t     SiS_PanelDelay(SiS_Pr, 0);\n\t  }\n       }\n\n       temp = SiS_GetReg(SiS_Pr->SiS_P3c4,0x32) & 0xDF;           \n       if(SiS_BridgeInSlavemode(SiS_Pr)) {\n\t  tempah = SiS_GetReg(SiS_Pr->SiS_P3d4,0x30);\n\t  if(!(tempah & SetCRT2ToRAMDAC)) temp |= 0x20;\n       }\n       SiS_SetReg(SiS_Pr->SiS_P3c4,0x32,temp);\n\n       SiS_SetRegOR(SiS_Pr->SiS_P3c4,0x1E,0x20);                   \n\n       if(SiS_Pr->ChipType >= SIS_315H) {\n\t  temp = SiS_GetReg(SiS_Pr->SiS_Part1Port,0x2E);\n\t  if(!(temp & 0x80)) {\n\t     SiS_SetRegOR(SiS_Pr->SiS_Part1Port,0x2E,0x80);          \n\t  }\n       }\n\n       SiS_SetRegANDOR(SiS_Pr->SiS_Part2Port,0x00,0x1F,0x20);      \n\n       SiS_VBLongWait(SiS_Pr);\n       SiS_DisplayOn(SiS_Pr);\n       if(SiS_Pr->ChipType >= SIS_315H) {\n\t  SiS_SetRegAND(SiS_Pr->SiS_Part1Port,0x00,0x7f);\n       }\n       SiS_VBLongWait(SiS_Pr);\n\n       if(SiS_Pr->ChipType < SIS_315H) {\n\t  if(SiS_CRT2IsLCD(SiS_Pr)) {\n\t     SiS_PanelDelay(SiS_Pr, 1);\n\t     SiS_SetRegSR11ANDOR(SiS_Pr,0xF7,0x00);\n\t  }\n       }\n\n    }\n\n  } else {    \n\n    if(SiS_Pr->ChipType < SIS_315H) {\n\n#ifdef CONFIG_FB_SIS_300     \n\n       if(SiS_CRT2IsLCD(SiS_Pr)) {\n\t  if(SiS_Pr->ChipType == SIS_730) {\n\t     SiS_PanelDelay(SiS_Pr, 1);\n\t     SiS_PanelDelay(SiS_Pr, 1);\n\t     SiS_PanelDelay(SiS_Pr, 1);\n\t  }\n\t  SiS_SetRegSR11ANDOR(SiS_Pr,0xFB,0x00);\n\t  if(!(SiS_CR36BIOSWord23d(SiS_Pr))) {\n\t     SiS_PanelDelay(SiS_Pr, 0);\n\t  }\n       }\n\n       SiS_SetRegOR(SiS_Pr->SiS_P3c4,0x1E,0x20);\n       SiS_DisplayOn(SiS_Pr);\n       SiS_UnLockCRT2(SiS_Pr);\n       SiS_SetRegAND(SiS_Pr->SiS_Part1Port,0x02,0xBF);\n       if(SiS_BridgeInSlavemode(SiS_Pr)) {\n\t  SiS_SetRegAND(SiS_Pr->SiS_Part1Port,0x01,0x1F);\n       } else {\n\t  SiS_SetRegANDOR(SiS_Pr->SiS_Part1Port,0x01,0x1F,0x40);\n       }\n\n       if(SiS_Pr->SiS_IF_DEF_CH70xx == 1) {\n\t  if(!(SiS_CRT2IsLCD(SiS_Pr))) {\n\t     SiS_WaitVBRetrace(SiS_Pr);\n\t     SiS_SetCH700x(SiS_Pr,0x0E,0x0B);\n\t  }\n       }\n\n       if(SiS_CRT2IsLCD(SiS_Pr)) {\n\t  if(!(SiS_GetReg(SiS_Pr->SiS_P3c4,0x13) & 0x40)) {\n\t     if(!(SiS_GetReg(SiS_Pr->SiS_P3c4,0x16) & 0x10)) {\n\t\tif(!(SiS_CR36BIOSWord23b(SiS_Pr))) {\n\t\t   SiS_PanelDelay(SiS_Pr, 1);\n\t\t   SiS_PanelDelay(SiS_Pr, 1);\n\t\t}\n\t\tSiS_WaitVBRetrace(SiS_Pr);\n\t\tSiS_SetRegSR11ANDOR(SiS_Pr,0xF7,0x00);\n\t     }\n\t  }\n       }\n\n#endif   \n\n    } else {\n\n#ifdef CONFIG_FB_SIS_315     \n\n       if(!(SiS_IsNotM650orLater(SiS_Pr))) {\n\t      \n\t     SiS_SetRegOR(SiS_Pr->SiS_Part1Port,0x4c,0x18);\n\t   \n       }\n\n       if(SiS_Pr->SiS_IF_DEF_CH70xx == 0) {\n\t  if(SiS_CRT2IsLCD(SiS_Pr)) {\n\t     SiS_SetRegSR11ANDOR(SiS_Pr,0xFB,0x00);\n\t     SiS_PanelDelay(SiS_Pr, 0);\n\t  }\n       }\n\n       SiS_SetRegOR(SiS_Pr->SiS_P3c4,0x1E,0x20);\n       SiS_UnLockCRT2(SiS_Pr);\n\n       SiS_SetRegAND(SiS_Pr->SiS_Part1Port,0x2e,0xf7);\n\n       if(SiS_Pr->SiS_IF_DEF_CH70xx == 2) {\n\t  temp = SiS_GetCH701x(SiS_Pr,0x66);\n\t  temp &= 0x20;\n\t  SiS_Chrontel701xBLOff(SiS_Pr);\n       }\n\n       if(SiS_Pr->ChipType != SIS_550) {\n\t  SiS_SetRegAND(SiS_Pr->SiS_Part1Port,0x2e,0x7f);\n       }\n\n       if(SiS_Pr->ChipType == SIS_740) {\n\t  if(SiS_Pr->SiS_IF_DEF_CH70xx == 2) {\n\t     if(SiS_IsLCDOrLCDA(SiS_Pr)) {\n\t\tSiS_SetRegOR(SiS_Pr->SiS_Part1Port,0x1E,0x20);\n\t     }\n\t  }\n       }\n\n       temp1 = SiS_GetReg(SiS_Pr->SiS_Part1Port,0x2E);\n       if(!(temp1 & 0x80)) {\n\t  SiS_SetRegOR(SiS_Pr->SiS_Part1Port,0x2E,0x80);\n       }\n\n       if(SiS_Pr->SiS_IF_DEF_CH70xx == 2) {\n\t  if(temp) {\n\t     SiS_Chrontel701xBLOn(SiS_Pr);\n\t  }\n       }\n\n       if(SiS_Pr->SiS_IF_DEF_CH70xx == 0) {\n\t  if(SiS_CRT2IsLCD(SiS_Pr)) {\n\t     SiS_SetRegOR(SiS_Pr->SiS_Part1Port,0x1E,0x20);\n\t     if(SiS_Pr->ChipType == SIS_550) {\n\t\tSiS_SetRegOR(SiS_Pr->SiS_Part1Port,0x1E,0x40);\n\t\tSiS_SetRegOR(SiS_Pr->SiS_Part1Port,0x1E,0x10);\n\t     }\n\t  }\n       } else if(SiS_IsVAMode(SiS_Pr)) {\n\t  if(SiS_Pr->ChipType != SIS_740) {\n\t     SiS_SetRegOR(SiS_Pr->SiS_Part1Port,0x1E,0x20);\n\t  }\n       }\n\n       if(!(SiS_WeHaveBacklightCtrl(SiS_Pr))) {\n\t  SiS_SetRegAND(SiS_Pr->SiS_Part1Port,0x00,0x7f);\n       }\n\n       if(SiS_Pr->SiS_IF_DEF_CH70xx == 2) {\n\t  if(SiS_IsTVOrYPbPrOrScart(SiS_Pr)) {\n\t     SiS_Chrontel701xOn(SiS_Pr);\n\t  }\n\t  if( (SiS_IsVAMode(SiS_Pr)) ||\n\t      (SiS_IsLCDOrLCDA(SiS_Pr)) ) {\n\t     SiS_ChrontelDoSomething1(SiS_Pr);\n\t  }\n       }\n\n       if(SiS_Pr->SiS_IF_DEF_CH70xx == 2) {\n\t  if(!(SiS_WeHaveBacklightCtrl(SiS_Pr))) {\n\t     if( (SiS_IsVAMode(SiS_Pr)) ||\n\t\t (SiS_IsLCDOrLCDA(SiS_Pr)) ) {\n\t\tSiS_Chrontel701xBLOn(SiS_Pr);\n\t\tSiS_ChrontelInitTVVSync(SiS_Pr);\n\t     }\n\t  }\n       } else if(SiS_Pr->SiS_IF_DEF_CH70xx == 0) {\n\t  if(!(SiS_WeHaveBacklightCtrl(SiS_Pr))) {\n\t     if(SiS_CRT2IsLCD(SiS_Pr)) {\n\t\tSiS_PanelDelay(SiS_Pr, 1);\n\t\tSiS_SetRegSR11ANDOR(SiS_Pr,0xF7,0x00);\n\t     }\n\t  }\n       }\n\n#endif   \n\n    }  \n\n  }   \n\n}\n\n \n \n \n\n \nstatic void\nSiS_SetCRT2Offset(struct SiS_Private *SiS_Pr, unsigned short ModeNo, unsigned short ModeIdIndex,\n\t\tunsigned short RRTI)\n{\n   unsigned short offset;\n   unsigned char  temp;\n\n   if(SiS_Pr->SiS_VBInfo & SetInSlaveMode) return;\n\n   offset = SiS_GetOffset(SiS_Pr,ModeNo,ModeIdIndex,RRTI);\n\n   SiS_SetReg(SiS_Pr->SiS_Part1Port,0x07,(offset & 0xFF));\n   SiS_SetReg(SiS_Pr->SiS_Part1Port,0x09,(offset >> 8));\n\n   temp = (unsigned char)(((offset >> 3) & 0xFF) + 1);\n   if(offset & 0x07) temp++;\n   SiS_SetReg(SiS_Pr->SiS_Part1Port,0x03,temp);\n}\n\n \nstatic void\nSiS_SetCRT2Sync(struct SiS_Private *SiS_Pr, unsigned short ModeNo, unsigned short RefreshRateTableIndex)\n{\n   unsigned short tempah=0, tempbl, infoflag;\n\n   tempbl = 0xC0;\n\n   if(SiS_Pr->UseCustomMode) {\n      infoflag = SiS_Pr->CInfoFlag;\n   } else {\n      infoflag = SiS_Pr->SiS_RefIndex[RefreshRateTableIndex].Ext_InfoFlag;\n   }\n\n   if(SiS_Pr->SiS_IF_DEF_LVDS == 1) {\t\t\t\t\t \n\n      if(SiS_Pr->SiS_VBInfo & SetCRT2ToTV) {\n\t tempah = 0;\n      } else if((SiS_Pr->SiS_VBInfo & SetCRT2ToLCD) && (SiS_Pr->SiS_LCDInfo & LCDSync)) {\n\t tempah = SiS_Pr->SiS_LCDInfo;\n      } else tempah = infoflag >> 8;\n      tempah &= 0xC0;\n      tempah |= 0x20;\n      if(!(SiS_Pr->SiS_LCDInfo & LCDRGB18Bit)) tempah |= 0x10;\n      if(SiS_Pr->SiS_VBInfo & SetCRT2ToLCD) {\n\t if((SiS_Pr->SiS_CustomT == CUT_BARCO1366) ||\n\t    (SiS_Pr->SiS_CustomT == CUT_BARCO1024)) {\n\t    tempah |= 0xf0;\n\t }\n\t if( (SiS_Pr->SiS_IF_DEF_FSTN) ||\n\t     (SiS_Pr->SiS_IF_DEF_DSTN) ||\n\t     (SiS_Pr->SiS_IF_DEF_TRUMPION) ||\n\t     (SiS_Pr->SiS_CustomT == CUT_PANEL848) ||\n\t     (SiS_Pr->SiS_CustomT == CUT_PANEL856) ) {\n\t    tempah |= 0x30;\n\t }\n\t if( (SiS_Pr->SiS_IF_DEF_FSTN) ||\n\t     (SiS_Pr->SiS_IF_DEF_DSTN) ) {\n\t    tempah &= ~0xc0;\n\t }\n      }\n      if(SiS_Pr->SiS_VBInfo & SetCRT2ToTV) {\n\t if(SiS_Pr->ChipType >= SIS_315H) {\n\t    tempah >>= 3;\n\t    tempah &= 0x18;\n\t    SiS_SetRegANDOR(SiS_Pr->SiS_Part1Port,0x13,0xE7,tempah);\n\t     \n\t } else {\n\t    SiS_SetRegANDOR(SiS_Pr->SiS_Part1Port,0x19,0x0F,0xe0);\n\t }\n      } else {\n\t SiS_SetRegANDOR(SiS_Pr->SiS_Part1Port,0x19,0x0F,tempah);\n      }\n\n   } else if(SiS_Pr->SiS_VBType & VB_SISVB) {\n\n      if(SiS_Pr->ChipType < SIS_315H) {\n\n#ifdef CONFIG_FB_SIS_300   \n\n\t if(SiS_Pr->SiS_VBType & VB_SIS30xBLV) {\t\t\t \n\n\t    tempah = infoflag >> 8;\n\t    tempbl = 0;\n\t    if(SiS_Pr->SiS_VBInfo & SetCRT2ToLCD) {\n\t       if(SiS_Pr->SiS_LCDInfo & LCDSync) {\n\t\t  tempah = SiS_Pr->SiS_LCDInfo;\n\t\t  tempbl = (tempah >> 6) & 0x03;\n\t       }\n\t    }\n\t    tempah &= 0xC0;\n\t    tempah |= 0x20;\n\t    if(!(SiS_Pr->SiS_LCDInfo & LCDRGB18Bit)) tempah |= 0x10;\n\t    tempah |= 0xc0;\n\t    SiS_SetRegANDOR(SiS_Pr->SiS_Part1Port,0x19,0x0F,tempah);\n\t    if((SiS_Pr->SiS_VBInfo & SetCRT2ToLCD) && (!(SiS_Pr->SiS_VBType & VB_NoLCD))) {\n\t       SiS_SetRegANDOR(SiS_Pr->SiS_Part2Port,0x1a,0xf0,tempbl);\n\t    }\n\n\t } else {\t\t\t\t\t\t\t \n\n\t    tempah = ((infoflag >> 8) & 0xc0) | 0x20;\n\t    if(!(SiS_Pr->SiS_LCDInfo & LCDRGB18Bit)) tempah |= 0x10;\n\t    SiS_SetRegANDOR(SiS_Pr->SiS_Part1Port,0x19,0x0F,tempah);\n\n\t }\n\n#endif  \n\n      } else {\n\n#ifdef CONFIG_FB_SIS_315   \n\n\t if(SiS_Pr->SiS_VBType & VB_SISLVDS) {\t  \t\t \n\n\t    tempbl = 0;\n\t    if((SiS_Pr->SiS_CustomT == CUT_COMPAQ1280) &&\n\t       (SiS_Pr->SiS_LCDResInfo == Panel_1280x1024)) {\n\t       tempah = infoflag >> 8;\n\t       if(SiS_Pr->SiS_LCDInfo & LCDSync) {\n\t\t tempbl = ((SiS_Pr->SiS_LCDInfo & 0xc0) >> 6);\n\t       }\n\t    } else if((SiS_Pr->SiS_CustomT == CUT_CLEVO1400)  &&\n\t\t      (SiS_Pr->SiS_LCDResInfo == Panel_1400x1050)) {\n\t       tempah = infoflag >> 8;\n\t       tempbl = 0x03;\n\t    } else {\n\t       tempah = SiS_GetReg(SiS_Pr->SiS_P3d4,0x37);\n\t       tempbl = (tempah >> 6) & 0x03;\n\t       tempbl |= 0x08;\n\t       if(!(SiS_Pr->SiS_LCDInfo & LCDRGB18Bit)) tempbl |= 0x04;\n\t    }\n\t    tempah &= 0xC0;\n\t    tempah |= 0x20;\n\t    if(!(SiS_Pr->SiS_LCDInfo & LCDRGB18Bit)) tempah |= 0x10;\n\t    if(SiS_Pr->SiS_VBInfo & SetCRT2ToLCDA)   tempah |= 0xc0;\n\t    SiS_SetRegANDOR(SiS_Pr->SiS_Part1Port,0x19,0x0F,tempah);\n\t    if(SiS_Pr->SiS_VBType & VB_SIS30xBLV) {\n\t       if(SiS_Pr->SiS_VBInfo & SetCRT2ToLCD) {\n\t\t  SiS_SetRegANDOR(SiS_Pr->SiS_Part2Port,0x1a,0xf0,tempbl);\n\t       }\n\t    }\n\n\t } else {\t\t\t\t\t\t\t \n\n\t    tempah = tempbl = infoflag >> 8;\n\t    if(!SiS_Pr->UseCustomMode) {\n\t       tempbl = 0;\n\t       if((SiS_Pr->SiS_VBType & VB_SIS30xC) && (SiS_Pr->SiS_VBInfo & SetCRT2ToRAMDAC)) {\n\t\t  if(ModeNo <= 0x13) {\n\t\t     tempah = SiS_GetRegByte((SiS_Pr->SiS_P3ca+0x02));\n\t\t  }\n\t       }\n\t       if(SiS_Pr->SiS_VBInfo & (SetCRT2ToLCD | SetCRT2ToLCDA)) {\n\t\t  if(!(SiS_Pr->SiS_LCDInfo & LCDPass11)) {\n\t\t    if(SiS_Pr->SiS_LCDInfo & LCDSync) {\n\t\t       tempah = SiS_Pr->SiS_LCDInfo;\n\t\t       tempbl = (tempah >> 6) & 0x03;\n\t\t    }\n\t\t  }\n\t       }\n\t    }\n\t    tempah &= 0xC0;\n\t    tempah |= 0x20;\n\t    if(!(SiS_Pr->SiS_LCDInfo & LCDRGB18Bit)) tempah |= 0x10;\n\t    if(SiS_Pr->SiS_VBType & VB_NoLCD) {\n\t        \n\t       if(SiS_Pr->SiS_VBInfo & SetCRT2ToTV)  tempah |= 0xc0;\n\t    }\n\t    if((SiS_Pr->SiS_VBType & VB_SIS30xC) && (SiS_Pr->SiS_VBInfo & SetCRT2ToRAMDAC)) {\n\t       tempah >>= 3;\n\t       tempah &= 0x18;\n\t       SiS_SetRegANDOR(SiS_Pr->SiS_Part1Port,0x13,0xe7,tempah);\n\t    } else {\n\t       SiS_SetRegANDOR(SiS_Pr->SiS_Part1Port,0x19,0x0F,tempah);\n\t       if(SiS_Pr->SiS_VBType & VB_SIS30xBLV) {\n\t\t  if(SiS_Pr->SiS_VBInfo & SetCRT2ToLCD) {\n\t\t     SiS_SetRegANDOR(SiS_Pr->SiS_Part2Port,0x1a,0xf0,tempbl);\n\t\t  }\n\t       }\n\t    }\n\n         }\n#endif   \n      }\n   }\n}\n\n \n#ifdef CONFIG_FB_SIS_300\nstatic void\nSiS_SetCRT2FIFO_300(struct SiS_Private *SiS_Pr,unsigned short ModeNo)\n{\n  unsigned char  *ROMAddr  = SiS_Pr->VirtualRomBase;\n  unsigned short temp, index, modeidindex, refreshratetableindex;\n  unsigned short VCLK = 0, MCLK, colorth = 0, data2 = 0;\n  unsigned short tempbx, tempcl, CRT1ModeNo, CRT2ModeNo, SelectRate_backup;\n  unsigned int   data, pci50, pciA0;\n  static const unsigned char colortharray[] = {\n  \t1, 1, 2, 2, 3, 4\n  };\n\n  SelectRate_backup = SiS_Pr->SiS_SelectCRT2Rate;\n\n  if(!SiS_Pr->CRT1UsesCustomMode) {\n\n     CRT1ModeNo = SiS_Pr->SiS_CRT1Mode;                                  \n     SiS_SearchModeID(SiS_Pr, &CRT1ModeNo, &modeidindex);\n     SiS_Pr->SiS_SetFlag &= (~ProgrammingCRT2);\n     SiS_Pr->SiS_SelectCRT2Rate = 0;\n     refreshratetableindex = SiS_GetRatePtr(SiS_Pr, CRT1ModeNo, modeidindex);\n\n     if(CRT1ModeNo >= 0x13) {\n         \n\tindex = SiS_GetRefCRTVCLK(SiS_Pr, refreshratetableindex, SiS_Pr->SiS_UseWide);\n\tVCLK = SiS_Pr->SiS_VCLKData[index].CLOCK;\n\n\t \n\tcolorth = SiS_GetColorDepth(SiS_Pr,CRT1ModeNo,modeidindex) >> 1;\n\tif(!colorth) colorth++;\n     }\n\n  } else {\n\n     CRT1ModeNo = 0xfe;\n\n      \n     VCLK = SiS_Pr->CSRClock_CRT1;\n\n      \n     colorth = colortharray[((SiS_Pr->CModeFlag_CRT1 & ModeTypeMask) - 2)];\n\n  }\n\n  if(CRT1ModeNo >= 0x13) {\n      \n     if(SiS_Pr->ChipType == SIS_300) {\n        index = SiS_GetReg(SiS_Pr->SiS_P3c4,0x3A);\n     } else {\n        index = SiS_GetReg(SiS_Pr->SiS_P3c4,0x1A);\n     }\n     index &= 0x07;\n     MCLK = SiS_Pr->SiS_MCLKData_0[index].CLOCK;\n\n     temp = ((SiS_GetReg(SiS_Pr->SiS_P3c4,0x14) >> 6) & 0x03) << 1;\n     if(!temp) temp++;\n     temp <<= 2;\n\n     data2 = temp - ((colorth * VCLK) / MCLK);\n\n     temp = (28 * 16) % data2;\n     data2 = (28 * 16) / data2;\n     if(temp) data2++;\n\n     if(SiS_Pr->ChipType == SIS_300) {\n\n\tSiS_GetFIFOThresholdIndex300(SiS_Pr, &tempbx, &tempcl);\n\tdata = SiS_GetFIFOThresholdB300(tempbx, tempcl);\n\n     } else {\n\n\tpci50 = sisfb_read_nbridge_pci_dword(SiS_Pr, 0x50);\n\tpciA0 = sisfb_read_nbridge_pci_dword(SiS_Pr, 0xa0);\n\n        if(SiS_Pr->ChipType == SIS_730) {\n\n\t   index = (unsigned short)(((pciA0 >> 28) & 0x0f) * 3);\n\t   index += (unsigned short)(((pci50 >> 9)) & 0x03);\n\n\t    \n\t   index = 0;   \n\n\t} else {\n\n\t   pci50 >>= 24;\n\t   pciA0 >>= 24;\n\n\t   index = (pci50 >> 1) & 0x07;\n\n\t   if(pci50 & 0x01)    index += 6;\n\t   if(!(pciA0 & 0x01)) index += 24;\n\n\t   if(SiS_GetReg(SiS_Pr->SiS_P3c4,0x14) & 0x80) index += 12;\n\n\t}\n\n\tdata = SiS_GetLatencyFactor630(SiS_Pr, index) + 15;\n\tif(!(SiS_GetReg(SiS_Pr->SiS_P3c4,0x14) & 0x80)) data += 5;\n\n     }\n\n     data += data2;\t\t\t\t\t\t \n\n     SiS_Pr->SiS_SetFlag |= ProgrammingCRT2;\n     SiS_Pr->SiS_SelectCRT2Rate = SelectRate_backup;\n\n     if(!SiS_Pr->UseCustomMode) {\n\n\tCRT2ModeNo = ModeNo;\n\tSiS_SearchModeID(SiS_Pr, &CRT2ModeNo, &modeidindex);\n\n\trefreshratetableindex = SiS_GetRatePtr(SiS_Pr, CRT2ModeNo, modeidindex);\n\n\t \n\tindex = SiS_GetVCLK2Ptr(SiS_Pr, CRT2ModeNo, modeidindex, refreshratetableindex);\n\tVCLK = SiS_Pr->SiS_VCLKData[index].CLOCK;\n\n\tif((SiS_Pr->SiS_CustomT == CUT_BARCO1366) || (SiS_Pr->SiS_CustomT == CUT_BARCO1024)) {\n\t   if(SiS_Pr->SiS_UseROM) {\n\t      if(ROMAddr[0x220] & 0x01) {\n\t\t VCLK = ROMAddr[0x229] | (ROMAddr[0x22a] << 8);\n\t      }\n           }\n        }\n\n     } else {\n\n\t \n\tCRT2ModeNo = 0xfe;\n\tVCLK = SiS_Pr->CSRClock;\n\n     }\n\n      \n     colorth = SiS_GetColorDepth(SiS_Pr,CRT2ModeNo,modeidindex) >> 1;\n     if(!colorth) colorth++;\n\n     data = data * VCLK * colorth;\n     temp = data % (MCLK << 4);\n     data = data / (MCLK << 4);\n     if(temp) data++;\n\n     if(data < 6) data = 6;\n     else if(data > 0x14) data = 0x14;\n\n     if(SiS_Pr->ChipType == SIS_300) {\n        temp = 0x16;\n\tif((data <= 0x0f) || (SiS_Pr->SiS_LCDResInfo == Panel_1280x1024))\n\t   temp = 0x13;\n     } else {\n        temp = 0x16;\n\tif(( (SiS_Pr->ChipType == SIS_630) ||\n\t     (SiS_Pr->ChipType == SIS_730) )  &&\n\t   (SiS_Pr->ChipRevision >= 0x30))\n\t   temp = 0x1b;\n     }\n     SiS_SetRegANDOR(SiS_Pr->SiS_Part1Port,0x01,0xe0,temp);\n\n     if((SiS_Pr->ChipType == SIS_630) &&\n\t(SiS_Pr->ChipRevision >= 0x30)) {\n\tif(data > 0x13) data = 0x13;\n     }\n     SiS_SetRegANDOR(SiS_Pr->SiS_Part1Port,0x02,0xe0,data);\n\n  } else {   \n\n     SiS_Pr->SiS_SetFlag |= ProgrammingCRT2;\n     SiS_Pr->SiS_SelectCRT2Rate = SelectRate_backup;\n\n  }\n}\n#endif\n\n \n#ifdef CONFIG_FB_SIS_315\nstatic void\nSiS_SetCRT2FIFO_310(struct SiS_Private *SiS_Pr)\n{\n  SiS_SetReg(SiS_Pr->SiS_Part1Port,0x01,0x3B);\n  if( (SiS_Pr->ChipType == SIS_760)      &&\n      (SiS_Pr->SiS_SysFlags & SF_760LFB)  &&\n      (SiS_Pr->SiS_ModeType == Mode32Bpp) &&\n      (SiS_Pr->SiS_VGAHDE >= 1280)\t  &&\n      (SiS_Pr->SiS_VGAVDE >= 1024) ) {\n     SiS_SetReg(SiS_Pr->SiS_Part1Port,0x2f,0x03);\n     SiS_SetReg(SiS_Pr->SiS_Part1Port,0x01,0x3b);\n     SiS_SetReg(SiS_Pr->SiS_Part1Port,0x4d,0xc0);\n     SiS_SetReg(SiS_Pr->SiS_Part1Port,0x2f,0x01);\n     SiS_SetReg(SiS_Pr->SiS_Part1Port,0x4d,0xc0);\n     SiS_SetReg(SiS_Pr->SiS_Part1Port,0x02,0x6e);\n  } else {\n     SiS_SetRegANDOR(SiS_Pr->SiS_Part1Port,0x02,~0x3f,0x04);\n  }\n\n}\n#endif\n\nstatic unsigned short\nSiS_GetVGAHT2(struct SiS_Private *SiS_Pr)\n{\n  unsigned int tempax,tempbx;\n\n  tempbx = (SiS_Pr->SiS_VGAVT - SiS_Pr->SiS_VGAVDE) * SiS_Pr->SiS_RVBHCMAX;\n  tempax = (SiS_Pr->SiS_VT - SiS_Pr->SiS_VDE) * SiS_Pr->SiS_RVBHCFACT;\n  tempax = (tempax * SiS_Pr->SiS_HT) / tempbx;\n  return (unsigned short)tempax;\n}\n\n \nstatic void\nSiS_SetGroup1_301(struct SiS_Private *SiS_Pr, unsigned short ModeNo,unsigned short ModeIdIndex,\n                  unsigned short RefreshRateTableIndex)\n{\n  unsigned short temp, modeflag, i, j, xres=0, VGAVDE;\n  static const unsigned short CRTranslation[] = {\n        \n\t  0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0a,\n        \n\t  0x00, 0x0b, 0x17, 0x18, 0x19, 0x00, 0x1a, 0x00,\n        \n\t  0x0c, 0x0d, 0x0e, 0x00, 0x0f, 0x10, 0x11, 0x00\n  };\n\n  if(ModeNo <= 0x13) {\n     modeflag = SiS_Pr->SiS_SModeIDTable[ModeIdIndex].St_ModeFlag;\n  } else if(SiS_Pr->UseCustomMode) {\n     modeflag = SiS_Pr->CModeFlag;\n     xres = SiS_Pr->CHDisplay;\n  } else {\n     modeflag = SiS_Pr->SiS_EModeIDTable[ModeIdIndex].Ext_ModeFlag;\n     xres = SiS_Pr->SiS_RefIndex[RefreshRateTableIndex].XRes;\n  }\n\n   \n\n  if(SiS_Pr->ChipType >= SIS_315H) {\n     if(xres >= 1600) {   \n        SiS_SetRegOR(SiS_Pr->SiS_P3c4,0x31,0x04);\n     }\n  }\n\n  SiS_Pr->CHTotal = 8224;   \n\n  SiS_Pr->CHDisplay = SiS_Pr->SiS_VGAHDE;\n  if(modeflag & HalfDCLK) SiS_Pr->CHDisplay >>= 1;\n\n  SiS_Pr->CHBlankStart = SiS_Pr->CHDisplay;\n  if(SiS_Pr->SiS_VBInfo & SetCRT2ToTV) {\n     SiS_Pr->CHBlankStart += 16;\n  }\n\n  SiS_Pr->CHBlankEnd = 32;\n  if(SiS_Pr->SiS_VBInfo & SetCRT2ToLCD) {\n     if(xres == 1600) SiS_Pr->CHBlankEnd += 80;\n  }\n\n  temp = SiS_Pr->SiS_VGAHT - 96;\n  if(!(modeflag & HalfDCLK)) temp -= 32;\n  if(SiS_Pr->SiS_LCDInfo & LCDPass11) {\n     temp = SiS_GetReg(SiS_Pr->SiS_P3d4,0x04);\n     temp |= ((SiS_GetReg(SiS_Pr->SiS_P3c4,0x0b) & 0xc0) << 2);\n     temp -= 3;\n     temp <<= 3;\n  } else {\n     if(SiS_Pr->SiS_RVBHRS2) temp = SiS_Pr->SiS_RVBHRS2;\n  }\n  SiS_Pr->CHSyncStart = temp;\n\n  SiS_Pr->CHSyncEnd = 0xffe8; \t \n\n  SiS_Pr->CVTotal = 2049;  \t \n\n  VGAVDE = SiS_Pr->SiS_VGAVDE;\n  if     (VGAVDE ==  357) VGAVDE =  350;\n  else if(VGAVDE ==  360) VGAVDE =  350;\n  else if(VGAVDE ==  375) VGAVDE =  350;\n  else if(VGAVDE ==  405) VGAVDE =  400;\n  else if(VGAVDE ==  420) VGAVDE =  400;\n  else if(VGAVDE ==  525) VGAVDE =  480;\n  else if(VGAVDE == 1056) VGAVDE = 1024;\n  SiS_Pr->CVDisplay = VGAVDE;\n\n  SiS_Pr->CVBlankStart = SiS_Pr->CVDisplay;\n\n  SiS_Pr->CVBlankEnd = 1;\n  if(ModeNo == 0x3c) SiS_Pr->CVBlankEnd = 226;\n\n  temp = (SiS_Pr->SiS_VGAVT - VGAVDE) >> 1;\n  SiS_Pr->CVSyncStart = VGAVDE + temp;\n\n  temp >>= 3;\n  SiS_Pr->CVSyncEnd = SiS_Pr->CVSyncStart + temp;\n\n  SiS_CalcCRRegisters(SiS_Pr, 0);\n  SiS_Pr->CCRT1CRTC[16] &= ~0xE0;\n\n  for(i = 0; i <= 7; i++) {\n     SiS_SetReg(SiS_Pr->SiS_Part1Port,CRTranslation[i],SiS_Pr->CCRT1CRTC[i]);\n  }\n  for(i = 0x10, j = 8; i <= 0x12; i++, j++) {\n     SiS_SetReg(SiS_Pr->SiS_Part1Port,CRTranslation[i],SiS_Pr->CCRT1CRTC[j]);\n  }\n  for(i = 0x15, j = 11; i <= 0x16; i++, j++) {\n     SiS_SetReg(SiS_Pr->SiS_Part1Port,CRTranslation[i],SiS_Pr->CCRT1CRTC[j]);\n  }\n  for(i = 0x0a, j = 13; i <= 0x0c; i++, j++) {\n     SiS_SetReg(SiS_Pr->SiS_Part1Port,CRTranslation[i],SiS_Pr->CCRT1CRTC[j]);\n  }\n\n  temp = SiS_Pr->CCRT1CRTC[16] & 0xE0;\n  SiS_SetRegANDOR(SiS_Pr->SiS_Part1Port,CRTranslation[0x0E],0x1F,temp);\n\n  temp = (SiS_Pr->CCRT1CRTC[16] & 0x01) << 5;\n  if(modeflag & DoubleScanMode) temp |= 0x80;\n  SiS_SetRegANDOR(SiS_Pr->SiS_Part1Port,CRTranslation[0x09],0x5F,temp);\n\n  temp = 0;\n  temp |= (SiS_GetReg(SiS_Pr->SiS_P3c4,0x01) & 0x01);\n  if(modeflag & HalfDCLK) temp |= 0x08;\n  SiS_SetReg(SiS_Pr->SiS_Part1Port,0x16,temp);              \t \n\n  SiS_SetReg(SiS_Pr->SiS_Part1Port,0x0F,0x00);              \t \n  SiS_SetReg(SiS_Pr->SiS_Part1Port,0x12,0x00);              \t \n\n  temp = 0;\n  if(SiS_Pr->SiS_LCDInfo & LCDRGB18Bit) {\n     temp = (SiS_GetReg(SiS_Pr->SiS_Part1Port,0x00) & 0x01) << 7;\n  }\n  SiS_SetReg(SiS_Pr->SiS_Part1Port,0x1A,temp);                \t \n\n  temp = SiS_GetRegByte((SiS_Pr->SiS_P3ca+0x02));\n  SiS_SetReg(SiS_Pr->SiS_Part1Port,0x1b,temp);\t\t\t \n}\n\n \nstatic void\nSiS_SetGroup1_LVDS(struct SiS_Private *SiS_Pr, unsigned short ModeNo, unsigned short ModeIdIndex,\n\t\tunsigned short RefreshRateTableIndex)\n{\n  unsigned short modeflag, resinfo = 0;\n  unsigned short push2, tempax, tempbx, tempcx, temp;\n  unsigned int   tempeax = 0, tempebx, tempecx, tempvcfact = 0;\n  bool islvds = false, issis  = false, chkdclkfirst = false;\n#ifdef CONFIG_FB_SIS_300\n  unsigned short crt2crtc = 0;\n#endif\n#ifdef CONFIG_FB_SIS_315\n  unsigned short pushcx;\n#endif\n\n  if(ModeNo <= 0x13) {\n     modeflag = SiS_Pr->SiS_SModeIDTable[ModeIdIndex].St_ModeFlag;\n     resinfo = SiS_Pr->SiS_SModeIDTable[ModeIdIndex].St_ResInfo;\n#ifdef CONFIG_FB_SIS_300\n     crt2crtc = SiS_Pr->SiS_SModeIDTable[ModeIdIndex].St_CRT2CRTC;\n#endif\n  } else if(SiS_Pr->UseCustomMode) {\n     modeflag = SiS_Pr->CModeFlag;\n  } else {\n     modeflag = SiS_Pr->SiS_EModeIDTable[ModeIdIndex].Ext_ModeFlag;\n     resinfo = SiS_Pr->SiS_EModeIDTable[ModeIdIndex].Ext_RESINFO;\n#ifdef CONFIG_FB_SIS_300\n     crt2crtc = SiS_Pr->SiS_RefIndex[RefreshRateTableIndex].Ext_CRT2CRTC;\n#endif\n  }\n\n   \n  if((SiS_Pr->SiS_IF_DEF_LVDS == 1) || (SiS_Pr->SiS_VBType & VB_NoLCD)) {\n     islvds = true;\n  }\n\n   \n  if((SiS_Pr->SiS_VBType & VB_SISVB) && (!(SiS_Pr->SiS_VBType & VB_NoLCD))) {\n     issis = true;\n  }\n\n  if((SiS_Pr->ChipType >= SIS_315H) && (islvds) && (!(SiS_Pr->SiS_VBInfo & SetCRT2ToLCDA))) {\n     if((!SiS_Pr->SiS_IF_DEF_FSTN) && (!SiS_Pr->SiS_IF_DEF_DSTN)) {\n        chkdclkfirst = true;\n     }\n  }\n\n#ifdef CONFIG_FB_SIS_315\n  if((SiS_Pr->ChipType >= SIS_315H) && (SiS_Pr->SiS_VBInfo & SetCRT2ToLCDA)) {\n     if(IS_SIS330) {\n        SiS_SetRegOR(SiS_Pr->SiS_Part1Port,0x2D,0x10);\n     } else if(IS_SIS740) {\n        if(islvds) {\n           SiS_SetRegANDOR(SiS_Pr->SiS_Part1Port,0x13,0xfb,0x04);\n\t   SiS_SetRegOR(SiS_Pr->SiS_Part1Port,0x2D,0x03);\n        } else if(SiS_Pr->SiS_VBType & VB_SISVB) {\n           SiS_SetRegOR(SiS_Pr->SiS_Part1Port,0x2D,0x10);\n        }\n     } else {\n        if(islvds) {\n           SiS_SetRegANDOR(SiS_Pr->SiS_Part1Port,0x13,0xfb,0x04);\n\t   SiS_SetRegOR(SiS_Pr->SiS_Part1Port,0x2D,0x00);\n        } else if(SiS_Pr->SiS_VBType & VB_SISVB) {\n           SiS_SetRegAND(SiS_Pr->SiS_Part1Port,0x2D,0x0f);\n\t   if(SiS_Pr->SiS_VBType & VB_SIS30xC) {\n\t      if((SiS_Pr->SiS_LCDResInfo == Panel_1024x768) ||\n\t         (SiS_Pr->SiS_LCDResInfo == Panel_1280x1024)) {\n\t         SiS_SetRegOR(SiS_Pr->SiS_Part1Port,0x2D,0x20);\n\t      }\n\t   }\n        }\n     }\n  }\n#endif\n\n   \n\n  tempax = SiS_Pr->SiS_LCDHDES;\n  if(islvds) {\n     if(SiS_Pr->SiS_VBInfo & (SetCRT2ToLCD | SetCRT2ToLCDA)) {\n\tif(!SiS_Pr->SiS_IF_DEF_FSTN && !SiS_Pr->SiS_IF_DEF_DSTN) {\n\t   if((SiS_Pr->SiS_LCDResInfo == Panel_640x480) &&\n\t      (!(SiS_Pr->SiS_VBInfo & SetInSlaveMode))) {\n\t      tempax -= 8;\n\t   }\n\t}\n     }\n  }\n\n  temp = (tempax & 0x0007);\n  SiS_SetReg(SiS_Pr->SiS_Part1Port,0x1A,temp);\t\t\t \n  temp = (tempax >> 3) & 0x00FF;\n  SiS_SetReg(SiS_Pr->SiS_Part1Port,0x16,temp);\t\t\t \n\n  tempbx = SiS_Pr->SiS_HDE;\n  if(SiS_Pr->SiS_VBInfo & (SetCRT2ToLCD | SetCRT2ToLCDA)) {\n     if(!(SiS_Pr->SiS_LCDInfo & LCDPass11)) {\n        tempbx = SiS_Pr->PanelXRes;\n     }\n     if((SiS_Pr->SiS_LCDResInfo == Panel_320x240_1) ||\n        (SiS_Pr->SiS_LCDResInfo == Panel_320x240_2) ||\n        (SiS_Pr->SiS_LCDResInfo == Panel_320x240_3)) {\n        tempbx >>= 1;\n     }\n  }\n\n  tempax += tempbx;\n  if(tempax >= SiS_Pr->SiS_HT) tempax -= SiS_Pr->SiS_HT;\n\n  temp = tempax;\n  if(temp & 0x07) temp += 8;\n  temp >>= 3;\n  SiS_SetReg(SiS_Pr->SiS_Part1Port,0x17,temp);\t\t\t \n\n  tempcx = (SiS_Pr->SiS_HT - tempbx) >> 2;\n\n  if(SiS_Pr->SiS_VBInfo & (SetCRT2ToLCD | SetCRT2ToLCDA)) {\n     if(!(SiS_Pr->SiS_LCDInfo & LCDPass11)) {\n        if(SiS_Pr->PanelHRS != 999) tempcx = SiS_Pr->PanelHRS;\n     }\n  }\n\n  tempcx += tempax;\n  if(tempcx >= SiS_Pr->SiS_HT) tempcx -= SiS_Pr->SiS_HT;\n\n  temp = (tempcx >> 3) & 0x00FF;\n  if(SiS_Pr->SiS_VBInfo & (SetCRT2ToLCD | SetCRT2ToLCDA)) {\n     if(SiS_Pr->SiS_IF_DEF_TRUMPION) {\n\tif(SiS_Pr->SiS_LCDResInfo == Panel_1024x768) {\n\t   switch(ModeNo) {\n\t   case 0x04:\n\t   case 0x05:\n\t   case 0x0d: temp = 0x56; break;\n\t   case 0x10: temp = 0x60; break;\n\t   case 0x13: temp = 0x5f; break;\n\t   case 0x40:\n\t   case 0x41:\n\t   case 0x4f:\n\t   case 0x43:\n\t   case 0x44:\n\t   case 0x62:\n\t   case 0x56:\n\t   case 0x53:\n\t   case 0x5d:\n\t   case 0x5e: temp = 0x54; break;\n\t   }\n\t}\n     }\n  }\n  SiS_SetReg(SiS_Pr->SiS_Part1Port,0x14,temp);\t\t\t \n\n  if(SiS_Pr->SiS_VBInfo & (SetCRT2ToLCD | SetCRT2ToLCDA)) {\n     temp += 2;\n     if(!(SiS_Pr->SiS_LCDInfo & LCDPass11)) {\n\ttemp += 8;\n\tif(SiS_Pr->PanelHRE != 999) {\n\t   temp = tempcx + SiS_Pr->PanelHRE;\n\t   if(temp >= SiS_Pr->SiS_HT) temp -= SiS_Pr->SiS_HT;\n\t   temp >>= 3;\n\t}\n     }\n  } else {\n     temp += 10;\n  }\n\n  temp &= 0x1F;\n  temp |= ((tempcx & 0x07) << 5);\n  SiS_SetReg(SiS_Pr->SiS_Part1Port,0x15,temp);\t\t\t \n\n   \n\n  tempax = SiS_Pr->SiS_VGAVDE;\n  if(SiS_Pr->SiS_VBInfo & (SetCRT2ToLCD | SetCRT2ToLCDA)) {\n     if(!(SiS_Pr->SiS_LCDInfo & LCDPass11)) {\n\ttempax = SiS_Pr->PanelYRes;\n     }\n  }\n\n  tempbx = SiS_Pr->SiS_LCDVDES + tempax;\n  if(tempbx >= SiS_Pr->SiS_VT) tempbx -= SiS_Pr->SiS_VT;\n\n  push2 = tempbx;\n\n  tempcx = SiS_Pr->SiS_VGAVT - SiS_Pr->SiS_VGAVDE;\n  if(SiS_Pr->ChipType < SIS_315H) {\n     if(SiS_Pr->SiS_VBInfo & (SetCRT2ToLCD | SetCRT2ToLCDA)) {\n\tif(!(SiS_Pr->SiS_LCDInfo & LCDPass11)) {\n\t   tempcx = SiS_Pr->SiS_VGAVT - SiS_Pr->PanelYRes;\n\t}\n     }\n  }\n  if(islvds) tempcx >>= 1;\n  else       tempcx >>= 2;\n\n  if( (SiS_Pr->SiS_VBInfo & (SetCRT2ToLCD | SetCRT2ToLCDA)) &&\n      (!(SiS_Pr->SiS_LCDInfo & LCDPass11)) \t\t    &&\n      (SiS_Pr->PanelVRS != 999) ) {\n     tempcx = SiS_Pr->PanelVRS;\n     tempbx += tempcx;\n     if(issis) tempbx++;\n  } else {\n     tempbx += tempcx;\n     if(SiS_Pr->ChipType < SIS_315H) tempbx++;\n     else if(issis)                   tempbx++;\n  }\n\n  if(tempbx >= SiS_Pr->SiS_VT) tempbx -= SiS_Pr->SiS_VT;\n\n  temp = tempbx & 0x00FF;\n  if(SiS_Pr->SiS_IF_DEF_TRUMPION) {\n     if(SiS_Pr->SiS_LCDResInfo == Panel_1024x768) {\n\tif(ModeNo == 0x10) temp = 0xa9;\n     }\n  }\n  SiS_SetReg(SiS_Pr->SiS_Part1Port,0x18,temp);\t\t\t \n\n  tempcx >>= 3;\n  tempcx++;\n\n  if(SiS_Pr->SiS_VBInfo & (SetCRT2ToLCD | SetCRT2ToLCDA)) {\n     if(!(SiS_Pr->SiS_LCDInfo & LCDPass11)) {\n        if(SiS_Pr->PanelVRE != 999) tempcx = SiS_Pr->PanelVRE;\n     }\n  }\n\n  tempcx += tempbx;\n  temp = tempcx & 0x000F;\n  SiS_SetRegANDOR(SiS_Pr->SiS_Part1Port,0x19,0xF0,temp);\t \n\n  temp = ((tempbx >> 8) & 0x07) << 3;\n  if(SiS_Pr->SiS_IF_DEF_FSTN || SiS_Pr->SiS_IF_DEF_DSTN) {\n     if(SiS_Pr->SiS_HDE != 640) {\n        if(SiS_Pr->SiS_VGAVDE != SiS_Pr->SiS_VDE)  temp |= 0x40;\n     }\n  } else if(SiS_Pr->SiS_VGAVDE != SiS_Pr->SiS_VDE) temp |= 0x40;\n  if(SiS_Pr->SiS_SetFlag & EnableLVDSDDA)          temp |= 0x40;\n  tempbx = 0x87;\n  if((SiS_Pr->ChipType >= SIS_315H) ||\n     (SiS_Pr->ChipRevision >= 0x30)) {\n     tempbx = 0x07;\n     if((SiS_Pr->SiS_IF_DEF_CH70xx == 1) && (SiS_Pr->SiS_VBInfo & SetCRT2ToTV)) {\n\tif(SiS_GetReg(SiS_Pr->SiS_Part1Port,0x00) & 0x03)    temp |= 0x80;\n     }\n      \n     if(SiS_Pr->SiS_LCDInfo & LCDRGB18Bit) {\n\tif(SiS_Pr->SiS_VBInfo & SetCRT2ToLCDA) {\n\t   if(SiS_GetReg(SiS_Pr->SiS_P3c4,0x06) & 0x10)      temp |= 0x80;\n\t} else {\n\t   if(SiS_GetReg(SiS_Pr->SiS_Part1Port,0x00) & 0x01) temp |= 0x80;\n\t}\n     }\n  }\n  SiS_SetRegANDOR(SiS_Pr->SiS_Part1Port,0x1A,tempbx,temp);\n\n  tempbx = push2;\t\t\t\t\t\t \n\n  tempcx = SiS_Pr->SiS_LCDVDES;\t\t\t\t\t \n\n  if(SiS_Pr->SiS_VBInfo & (SetCRT2ToLCD | SetCRT2ToLCDA)) {\n     switch(SiS_Pr->SiS_LCDResInfo) {\n     case Panel_640x480:\n\ttempbx = SiS_Pr->SiS_VGAVDE - 1;\n\ttempcx = SiS_Pr->SiS_VGAVDE;\n\tbreak;\n     case Panel_800x600:\n\tif(!(SiS_Pr->SiS_VBInfo & SetInSlaveMode)) {\n\t   if(resinfo == SIS_RI_800x600) tempcx++;\n\t}\n\tbreak;\n     case Panel_1024x600:\n\tif(!(SiS_Pr->SiS_VBInfo & SetInSlaveMode)) {\n\t   if(resinfo == SIS_RI_1024x600) tempcx++;\n\t   if(SiS_Pr->SiS_LCDInfo & DontExpandLCD) {\n\t      if(resinfo == SIS_RI_800x600) tempcx++;\n\t   }\n\t}\n\tbreak;\n     case Panel_1024x768:\n\tif(SiS_Pr->ChipType < SIS_315H) {\n\t   if(!(SiS_Pr->SiS_VBInfo & SetInSlaveMode)) {\n\t      if(resinfo == SIS_RI_1024x768) tempcx++;\n\t   }\n\t}\n\tbreak;\n     }\n  }\n\n  temp = ((tempbx >> 8) & 0x07) << 3;\n  temp |= ((tempcx >> 8) & 0x07);\n  SiS_SetReg(SiS_Pr->SiS_Part1Port,0x1D,temp);\n  SiS_SetReg(SiS_Pr->SiS_Part1Port,0x1C,tempbx);\n  SiS_SetReg(SiS_Pr->SiS_Part1Port,0x1B,tempcx);\n\n   \n\n  if(SiS_Pr->ChipType < SIS_315H) {\n\n#ifdef CONFIG_FB_SIS_300       \n     tempeax = SiS_Pr->SiS_VGAVDE << 6;\n     temp = (tempeax % (unsigned int)SiS_Pr->SiS_VDE);\n     tempeax = tempeax / (unsigned int)SiS_Pr->SiS_VDE;\n     if(temp) tempeax++;\n\n     if(SiS_Pr->SiS_SetFlag & EnableLVDSDDA) tempeax = 0x3F;\n\n     temp = (unsigned short)(tempeax & 0x00FF);\n     SiS_SetReg(SiS_Pr->SiS_Part1Port,0x1E,temp);      \t \n     tempvcfact = temp;\n#endif  \n\n  } else {\n\n#ifdef CONFIG_FB_SIS_315   \n     tempeax = SiS_Pr->SiS_VGAVDE << 18;\n     tempebx = SiS_Pr->SiS_VDE;\n     temp = (tempeax % tempebx);\n     tempeax = tempeax / tempebx;\n     if(temp) tempeax++;\n     tempvcfact = tempeax;\n\n     temp = (unsigned short)(tempeax & 0x00FF);\n     SiS_SetReg(SiS_Pr->SiS_Part1Port,0x37,temp);\n     temp = (unsigned short)((tempeax & 0x00FF00) >> 8);\n     SiS_SetReg(SiS_Pr->SiS_Part1Port,0x36,temp);\n     temp = (unsigned short)((tempeax & 0x00030000) >> 16);\n     if(SiS_Pr->SiS_VDE == SiS_Pr->SiS_VGAVDE) temp |= 0x04;\n     SiS_SetReg(SiS_Pr->SiS_Part1Port,0x35,temp);\n\n     if(SiS_Pr->SiS_VBType & VB_SISPART4SCALER) {\n        temp = (unsigned short)(tempeax & 0x00FF);\n        SiS_SetReg(SiS_Pr->SiS_Part4Port,0x3c,temp);\n        temp = (unsigned short)((tempeax & 0x00FF00) >> 8);\n        SiS_SetReg(SiS_Pr->SiS_Part4Port,0x3b,temp);\n        temp = (unsigned short)(((tempeax & 0x00030000) >> 16) << 6);\n        SiS_SetRegANDOR(SiS_Pr->SiS_Part4Port,0x3a,0x3f,temp);\n        temp = 0;\n        if(SiS_Pr->SiS_VDE != SiS_Pr->SiS_VGAVDE) temp |= 0x08;\n        SiS_SetRegANDOR(SiS_Pr->SiS_Part4Port,0x30,0xf3,temp);\n     }\n#endif\n\n  }\n\n   \n\n  tempeax = SiS_Pr->SiS_VGAHDE;\t\t \n  if(chkdclkfirst) {\n     if(modeflag & HalfDCLK) tempeax >>= 1;\n  }\n  tempebx = tempeax << 16;\n  if(SiS_Pr->SiS_HDE == tempeax) {\n     tempecx = 0xFFFF;\n  } else {\n     tempecx = tempebx / SiS_Pr->SiS_HDE;\n     if(SiS_Pr->ChipType >= SIS_315H) {\n        if(tempebx % SiS_Pr->SiS_HDE) tempecx++;\n     }\n  }\n\n  if(SiS_Pr->ChipType >= SIS_315H) {\n     tempeax = (tempebx / tempecx) - 1;\n  } else {\n     tempeax = ((SiS_Pr->SiS_VGAHT << 16) / tempecx) - 1;\n  }\n  tempecx = (tempecx << 16) | (tempeax & 0xFFFF);\n  temp = (unsigned short)(tempecx & 0x00FF);\n  SiS_SetReg(SiS_Pr->SiS_Part1Port,0x1F,temp);\n\n  if(SiS_Pr->ChipType >= SIS_315H) {\n     tempeax = (SiS_Pr->SiS_VGAVDE << 18) / tempvcfact;\n     tempbx = (unsigned short)(tempeax & 0xFFFF);\n  } else {\n     tempeax = SiS_Pr->SiS_VGAVDE << 6;\n     tempbx = tempvcfact & 0x3f;\n     if(tempbx == 0) tempbx = 64;\n     tempeax /= tempbx;\n     tempbx = (unsigned short)(tempeax & 0xFFFF);\n  }\n  if(SiS_Pr->SiS_LCDResInfo == Panel_1024x768) tempbx--;\n  if(SiS_Pr->SiS_SetFlag & EnableLVDSDDA) {\n     if((!SiS_Pr->SiS_IF_DEF_FSTN) && (!SiS_Pr->SiS_IF_DEF_DSTN)) tempbx = 1;\n     else if(SiS_Pr->SiS_LCDResInfo != Panel_640x480)             tempbx = 1;\n  }\n\n  temp = ((tempbx >> 8) & 0x07) << 3;\n  temp = temp | ((tempecx >> 8) & 0x07);\n  SiS_SetReg(SiS_Pr->SiS_Part1Port,0x20,temp);\n  SiS_SetReg(SiS_Pr->SiS_Part1Port,0x21,tempbx);\n\n  tempecx >>= 16;\t\t\t\t\t\t \n  if(!chkdclkfirst) {\n     if(modeflag & HalfDCLK) tempecx >>= 1;\n  }\n  temp = (unsigned short)((tempecx & 0xFF00) >> 8);\n  SiS_SetReg(SiS_Pr->SiS_Part1Port,0x22,temp);\n  temp = (unsigned short)(tempecx & 0x00FF);\n  SiS_SetReg(SiS_Pr->SiS_Part1Port,0x23,temp);\n\n#ifdef CONFIG_FB_SIS_315\n  if(SiS_Pr->ChipType >= SIS_315H) {\n     if(SiS_Pr->SiS_VBInfo & SetCRT2ToLCDA) {\n        if((islvds) || (SiS_Pr->SiS_VBInfo & VB_SISLVDS)) {\n           SiS_SetReg(SiS_Pr->SiS_Part1Port,0x1e,0x20);\n\t}\n     } else {\n        if(islvds) {\n           if(SiS_Pr->ChipType == SIS_740) {\n              SiS_SetRegOR(SiS_Pr->SiS_Part1Port,0x1e,0x03);\n           } else {\n\t      SiS_SetReg(SiS_Pr->SiS_Part1Port,0x1e,0x23);\n           }\n        }\n     }\n  }\n#endif\n\n#ifdef CONFIG_FB_SIS_300\n  if(SiS_Pr->SiS_IF_DEF_TRUMPION) {\n     unsigned char *ROMAddr = SiS_Pr->VirtualRomBase;\n     unsigned char *trumpdata;\n     int   i, j = crt2crtc;\n     unsigned char TrumpMode13[4]   = { 0x01, 0x10, 0x2c, 0x00 };\n     unsigned char TrumpMode10_1[4] = { 0x01, 0x10, 0x27, 0x00 };\n     unsigned char TrumpMode10_2[4] = { 0x01, 0x16, 0x10, 0x00 };\n\n     if(SiS_Pr->SiS_UseROM) {\n\ttrumpdata = &ROMAddr[0x8001 + (j * 80)];\n     } else {\n\tif(SiS_Pr->SiS_LCDTypeInfo == 0x0e) j += 7;\n\ttrumpdata = &SiS300_TrumpionData[j][0];\n     }\n\n     SiS_SetRegAND(SiS_Pr->SiS_Part1Port,0x02,0xbf);\n     for(i=0; i<5; i++) {\n\tSiS_SetTrumpionBlock(SiS_Pr, trumpdata);\n     }\n     if(SiS_Pr->SiS_LCDResInfo == Panel_1024x768) {\n\tif(ModeNo == 0x13) {\n\t   for(i=0; i<4; i++) {\n\t      SiS_SetTrumpionBlock(SiS_Pr, &TrumpMode13[0]);\n\t   }\n\t} else if(ModeNo == 0x10) {\n\t   for(i=0; i<4; i++) {\n\t      SiS_SetTrumpionBlock(SiS_Pr, &TrumpMode10_1[0]);\n\t      SiS_SetTrumpionBlock(SiS_Pr, &TrumpMode10_2[0]);\n\t   }\n\t}\n     }\n     SiS_SetRegOR(SiS_Pr->SiS_Part1Port,0x02,0x40);\n  }\n#endif\n\n#ifdef CONFIG_FB_SIS_315\n  if(SiS_Pr->SiS_IF_DEF_FSTN || SiS_Pr->SiS_IF_DEF_DSTN) {\n     SiS_SetReg(SiS_Pr->SiS_Part1Port,0x25,0x00);\n     SiS_SetReg(SiS_Pr->SiS_Part1Port,0x26,0x00);\n     SiS_SetReg(SiS_Pr->SiS_Part1Port,0x27,0x00);\n     SiS_SetReg(SiS_Pr->SiS_Part1Port,0x28,0x87);\n     SiS_SetReg(SiS_Pr->SiS_Part1Port,0x29,0x5A);\n     SiS_SetReg(SiS_Pr->SiS_Part1Port,0x2A,0x4B);\n     SiS_SetRegANDOR(SiS_Pr->SiS_Part1Port,0x44,~0x07,0x03);\n     tempax = SiS_Pr->SiS_HDE;\t\t\t\t\t \n     if(SiS_Pr->SiS_LCDResInfo == Panel_320x240_1 ||\n        SiS_Pr->SiS_LCDResInfo == Panel_320x240_2 ||\n        SiS_Pr->SiS_LCDResInfo == Panel_320x240_3) tempax >>= 1;\n     tempax += 64;\n     SiS_SetReg(SiS_Pr->SiS_Part1Port,0x38,tempax & 0xff);\n     temp = (tempax >> 8) << 3;\n     SiS_SetRegANDOR(SiS_Pr->SiS_Part1Port,0x35,~0x078,temp);\n     tempax += 32;\t\t\t\t\t\t \n     SiS_SetReg(SiS_Pr->SiS_Part1Port,0x39,tempax & 0xff);\n     SiS_SetReg(SiS_Pr->SiS_Part1Port,0x3A,0x00);\t\t \n     SiS_SetRegAND(SiS_Pr->SiS_Part1Port,0x3C,~0x007);\n\n     tempax = SiS_Pr->SiS_VDE;\n     if(SiS_Pr->SiS_LCDResInfo == Panel_320x240_1 ||\n        SiS_Pr->SiS_LCDResInfo == Panel_320x240_2 ||\n        SiS_Pr->SiS_LCDResInfo == Panel_320x240_3) tempax >>= 1;\n     tempax >>= 1;\n     SiS_SetReg(SiS_Pr->SiS_Part1Port,0x3B,tempax & 0xff);\n     temp = (tempax >> 8) << 3;\n     SiS_SetRegANDOR(SiS_Pr->SiS_Part1Port,0x3C,~0x038,temp);\n\n     tempeax = SiS_Pr->SiS_HDE;\n     if(SiS_Pr->SiS_LCDResInfo == Panel_320x240_1 ||\n        SiS_Pr->SiS_LCDResInfo == Panel_320x240_2 ||\n        SiS_Pr->SiS_LCDResInfo == Panel_320x240_3) tempeax >>= 1;\n     tempeax <<= 2;\t\t\t \t\t\t \n     temp = tempeax & 0x7f;\n     tempeax >>= 7;\n     if(temp) tempeax++;\n     temp = tempeax & 0x3f;\n     SiS_SetReg(SiS_Pr->SiS_Part1Port,0x45,temp);\n     SiS_SetReg(SiS_Pr->SiS_Part1Port,0x3F,0x00);\t\t \n     SiS_SetReg(SiS_Pr->SiS_Part1Port,0x3E,0x00);\n     SiS_SetReg(SiS_Pr->SiS_Part1Port,0x3D,0x10);\n     SiS_SetRegAND(SiS_Pr->SiS_Part1Port,0x3C,~0x040);\n\n     tempax = SiS_Pr->SiS_HDE;\n     if(SiS_Pr->SiS_LCDResInfo == Panel_320x240_1 ||\n        SiS_Pr->SiS_LCDResInfo == Panel_320x240_2 ||\n        SiS_Pr->SiS_LCDResInfo == Panel_320x240_3) tempax >>= 1;\n     tempax >>= 4;\t\t\t\t\t\t \n     pushcx = tempax;\n     temp = tempax & 0x00FF;\n     SiS_SetReg(SiS_Pr->SiS_Part1Port,0x43,temp);\n     temp = ((tempax & 0xFF00) >> 8) << 3;\n     SiS_SetRegANDOR(SiS_Pr->SiS_Part1Port, 0x44, 0x07, temp);\n\n     tempax = SiS_Pr->SiS_VDE;\t\t\t\t \t \n     if(SiS_Pr->SiS_LCDResInfo == Panel_320x240_1 ||\n        SiS_Pr->SiS_LCDResInfo == Panel_320x240_2 ||\n        SiS_Pr->SiS_LCDResInfo == Panel_320x240_3) tempax >>= 1;\n     tempeax = tempax * pushcx;\n     temp = tempeax & 0xFF;\n     SiS_SetReg(SiS_Pr->SiS_Part1Port,0x42,temp);\n     temp = (tempeax & 0xFF00) >> 8;\n     SiS_SetReg(SiS_Pr->SiS_Part1Port,0x41,temp);\n     temp = ((tempeax & 0xFF0000) >> 16) | 0x10;\n     SiS_SetReg(SiS_Pr->SiS_Part1Port,0x40,temp);\n     temp = ((tempeax & 0x01000000) >> 24) << 7;\n     SiS_SetRegANDOR(SiS_Pr->SiS_Part1Port, 0x3C, 0x7F, temp);\n\n     SiS_SetReg(SiS_Pr->SiS_Part1Port,0x2F,0x03);\n     SiS_SetReg(SiS_Pr->SiS_Part1Port,0x03,0x50);\n     SiS_SetReg(SiS_Pr->SiS_Part1Port,0x04,0x00);\n     SiS_SetReg(SiS_Pr->SiS_Part1Port,0x2F,0x01);\n     SiS_SetReg(SiS_Pr->SiS_Part1Port,0x19,0x38);\n\n     if(SiS_Pr->SiS_IF_DEF_FSTN) {\n        SiS_SetReg(SiS_Pr->SiS_Part1Port,0x2b,0x02);\n        SiS_SetReg(SiS_Pr->SiS_Part1Port,0x2c,0x00);\n        SiS_SetReg(SiS_Pr->SiS_Part1Port,0x2d,0x00);\n        SiS_SetReg(SiS_Pr->SiS_Part1Port,0x35,0x0c);\n        SiS_SetReg(SiS_Pr->SiS_Part1Port,0x36,0x00);\n        SiS_SetReg(SiS_Pr->SiS_Part1Port,0x37,0x00);\n        SiS_SetReg(SiS_Pr->SiS_Part1Port,0x38,0x80);\n        SiS_SetReg(SiS_Pr->SiS_Part1Port,0x39,0xA0);\n        SiS_SetReg(SiS_Pr->SiS_Part1Port,0x3a,0x00);\n        SiS_SetReg(SiS_Pr->SiS_Part1Port,0x3b,0xf0);\n        SiS_SetReg(SiS_Pr->SiS_Part1Port,0x3c,0x00);\n        SiS_SetReg(SiS_Pr->SiS_Part1Port,0x3d,0x10);\n        SiS_SetReg(SiS_Pr->SiS_Part1Port,0x3e,0x00);\n        SiS_SetReg(SiS_Pr->SiS_Part1Port,0x3f,0x00);\n        SiS_SetReg(SiS_Pr->SiS_Part1Port,0x40,0x10);\n        SiS_SetReg(SiS_Pr->SiS_Part1Port,0x41,0x25);\n        SiS_SetReg(SiS_Pr->SiS_Part1Port,0x42,0x80);\n        SiS_SetReg(SiS_Pr->SiS_Part1Port,0x43,0x14);\n        SiS_SetReg(SiS_Pr->SiS_Part1Port,0x44,0x03);\n        SiS_SetReg(SiS_Pr->SiS_Part1Port,0x45,0x0a);\n     }\n  }\n#endif   \n}\n\n \nstatic void\nSiS_SetGroup1(struct SiS_Private *SiS_Pr, unsigned short ModeNo, unsigned short ModeIdIndex,\n\t\tunsigned short RefreshRateTableIndex)\n{\n#if defined(CONFIG_FB_SIS_300) || defined(CONFIG_FB_SIS_315)\n  unsigned char   *ROMAddr = SiS_Pr->VirtualRomBase;\n#endif\n  unsigned short  temp=0, tempax=0, tempbx=0, tempcx=0, bridgeadd=0;\n  unsigned short  pushbx=0, CRT1Index=0, modeflag, resinfo=0;\n#ifdef CONFIG_FB_SIS_315\n  unsigned short  tempbl=0;\n#endif\n\n  if(SiS_Pr->SiS_VBInfo & SetCRT2ToLCDA) {\n     SiS_SetGroup1_LVDS(SiS_Pr, ModeNo, ModeIdIndex, RefreshRateTableIndex);\n     return;\n  }\n\n  if(ModeNo <= 0x13) {\n     modeflag = SiS_Pr->SiS_SModeIDTable[ModeIdIndex].St_ModeFlag;\n  } else if(SiS_Pr->UseCustomMode) {\n     modeflag = SiS_Pr->CModeFlag;\n  } else {\n     CRT1Index = SiS_GetRefCRT1CRTC(SiS_Pr, RefreshRateTableIndex, SiS_Pr->SiS_UseWideCRT2);\n     resinfo = SiS_Pr->SiS_EModeIDTable[ModeIdIndex].Ext_RESINFO;\n     modeflag = SiS_Pr->SiS_EModeIDTable[ModeIdIndex].Ext_ModeFlag;\n  }\n\n  SiS_SetCRT2Offset(SiS_Pr, ModeNo, ModeIdIndex, RefreshRateTableIndex);\n\n  if( ! ((SiS_Pr->ChipType >= SIS_315H) &&\n         (SiS_Pr->SiS_IF_DEF_LVDS == 1) &&\n         (SiS_Pr->SiS_VBInfo & SetInSlaveMode)) ) {\n\n     if(SiS_Pr->ChipType < SIS_315H ) {\n#ifdef CONFIG_FB_SIS_300\n\tSiS_SetCRT2FIFO_300(SiS_Pr, ModeNo);\n#endif\n     } else {\n#ifdef CONFIG_FB_SIS_315\n\tSiS_SetCRT2FIFO_310(SiS_Pr);\n#endif\n     }\n\n      \n\n     if(SiS_Pr->ChipType < SIS_315H ) {\n\n#ifdef CONFIG_FB_SIS_300    \n\n\ttemp = (SiS_Pr->SiS_VGAHT - 1) & 0x0FF;   \t\t   \n\tSiS_SetReg(SiS_Pr->SiS_Part1Port,0x08,temp);               \n\n\ttemp = (((SiS_Pr->SiS_VGAHT - 1) & 0xFF00) >> 8) << 4;\n\tSiS_SetRegANDOR(SiS_Pr->SiS_Part1Port,0x09,0x0f,temp);     \n\n\ttemp = (SiS_Pr->SiS_VGAHDE + 12) & 0x0FF;                  \n\tSiS_SetReg(SiS_Pr->SiS_Part1Port,0x0A,temp);               \n\n\tpushbx = SiS_Pr->SiS_VGAHDE + 12;                          \n\ttempcx = (SiS_Pr->SiS_VGAHT - SiS_Pr->SiS_VGAHDE) >> 2;\n\ttempbx = pushbx + tempcx;\n\ttempcx <<= 1;\n\ttempcx += tempbx;\n\n\tbridgeadd = 12;\n\n#endif  \n\n     } else {\n\n#ifdef CONFIG_FB_SIS_315   \n\n\ttempcx = SiS_Pr->SiS_VGAHT;\t\t\t\t   \n\tif(modeflag & HalfDCLK) {\n\t   if(SiS_Pr->SiS_VBType & VB_SISVB) {\n\t      tempcx >>= 1;\n\t   } else {\n\t      tempax = SiS_Pr->SiS_VGAHDE >> 1;\n\t      tempcx = SiS_Pr->SiS_HT - SiS_Pr->SiS_HDE + tempax;\n\t      if(SiS_Pr->SiS_LCDInfo & DontExpandLCD) {\n\t         tempcx = SiS_Pr->SiS_HT - tempax;\n\t      }\n\t   }\n\t}\n\ttempcx--;\n\tSiS_SetReg(SiS_Pr->SiS_Part1Port,0x08,tempcx);             \n\ttemp = (tempcx >> 4) & 0xF0;\n\tSiS_SetRegANDOR(SiS_Pr->SiS_Part1Port,0x09,0x0F,temp);     \n\n\ttempcx = SiS_Pr->SiS_VGAHT;\t\t\t\t   \n\ttempbx = SiS_Pr->SiS_VGAHDE;\n\ttempcx -= tempbx;\n\ttempcx >>= 2;\n\tif(modeflag & HalfDCLK) {\n\t   tempbx >>= 1;\n\t   tempcx >>= 1;\n\t}\n\ttempbx += 16;\n\n\tSiS_SetReg(SiS_Pr->SiS_Part1Port,0x0A,tempbx);             \n\n\tpushbx = tempbx;\n\ttempcx >>= 1;\n\ttempbx += tempcx;\n\ttempcx += tempbx;\n\n\tbridgeadd = 16;\n\n\tif(SiS_Pr->SiS_VBType & VB_SISVB) {\n\t   if(SiS_Pr->ChipType >= SIS_661) {\n\t      if((SiS_Pr->SiS_LCDResInfo == Panel_1600x1200) ||\n\t\t (SiS_Pr->SiS_LCDResInfo == Panel_1280x1024)) {\n\t\t if(resinfo == SIS_RI_1280x1024) {\n\t\t    tempcx = (tempcx & 0xff00) | 0x30;\n\t\t } else if(resinfo == SIS_RI_1600x1200) {\n\t\t    tempcx = (tempcx & 0xff00) | 0xff;\n\t\t }\n\t      }\n\t   }\n        }\n\n#endif   \n\n     }   \n\n     if(SiS_Pr->SiS_VBType & VB_SISVB) {\n\n\tif(SiS_Pr->UseCustomMode) {\n\t   tempbx = SiS_Pr->CHSyncStart + bridgeadd;\n\t   tempcx = SiS_Pr->CHSyncEnd + bridgeadd;\n\t   tempax = SiS_Pr->SiS_VGAHT;\n\t   if(modeflag & HalfDCLK) tempax >>= 1;\n\t   tempax--;\n\t   if(tempcx > tempax) tempcx = tempax;\n\t}\n\n\tif(SiS_Pr->SiS_VBInfo & SetCRT2ToRAMDAC) {\n\t   unsigned char cr4, cr14, cr5, cr15;\n\t   if(SiS_Pr->UseCustomMode) {\n\t      cr4  = SiS_Pr->CCRT1CRTC[4];\n\t      cr14 = SiS_Pr->CCRT1CRTC[14];\n\t      cr5  = SiS_Pr->CCRT1CRTC[5];\n\t      cr15 = SiS_Pr->CCRT1CRTC[15];\n\t   } else {\n\t      cr4  = SiS_Pr->SiS_CRT1Table[CRT1Index].CR[4];\n\t      cr14 = SiS_Pr->SiS_CRT1Table[CRT1Index].CR[14];\n\t      cr5  = SiS_Pr->SiS_CRT1Table[CRT1Index].CR[5];\n\t      cr15 = SiS_Pr->SiS_CRT1Table[CRT1Index].CR[15];\n\t   }\n\t   tempbx = ((cr4 | ((cr14 & 0xC0) << 2)) - 3) << 3; \t\t     \n\t   tempcx = (((cr5 & 0x1f) | ((cr15 & 0x04) << (5-2))) - 3) << 3;    \n\t   tempcx &= 0x00FF;\n\t   tempcx |= (tempbx & 0xFF00);\n\t   tempbx += bridgeadd;\n\t   tempcx += bridgeadd;\n\t   tempax = SiS_Pr->SiS_VGAHT;\n\t   if(modeflag & HalfDCLK) tempax >>= 1;\n\t   tempax--;\n\t   if(tempcx > tempax) tempcx = tempax;\n\t}\n\n\tif(SiS_Pr->SiS_TVMode & (TVSetNTSC1024 | TVSet525p1024)) {\n\t   tempbx = 1040;\n\t   tempcx = 1044;    \n\t}\n\n     }\n\n     SiS_SetReg(SiS_Pr->SiS_Part1Port,0x0B,tempbx);            \t   \n\n     SiS_SetReg(SiS_Pr->SiS_Part1Port,0x0D,tempcx);                \n\n     temp = ((tempbx >> 8) & 0x0F) | ((pushbx >> 4) & 0xF0);\n     SiS_SetReg(SiS_Pr->SiS_Part1Port,0x0C,temp);\t\t   \n\n      \n\n     tempcx = SiS_Pr->SiS_VGAVT - 1;\n     temp = tempcx & 0x00FF;\n\n     if(SiS_Pr->ChipType < SIS_661) {\n        if(SiS_Pr->SiS_IF_DEF_LVDS == 1) {\n\t   if(SiS_Pr->ChipType < SIS_315H) {\n\t      if(SiS_Pr->SiS_IF_DEF_CH70xx != 0) {\n\t         if(SiS_Pr->SiS_VBInfo & (SetCRT2ToSVIDEO | SetCRT2ToAVIDEO)) {\n\t            temp--;\n\t         }\n\t      }\n\t   } else {\n\t      temp--;\n\t   }\n\t} else if(SiS_Pr->ChipType >= SIS_315H) {\n\t   temp--;\n\t}\n     }\n     SiS_SetReg(SiS_Pr->SiS_Part1Port,0x0E,temp);                  \n\n     tempbx = SiS_Pr->SiS_VGAVDE - 1;\n     SiS_SetReg(SiS_Pr->SiS_Part1Port,0x0F,tempbx);                \n\n     temp = ((tempbx >> 5) & 0x38) | ((tempcx >> 8) & 0x07);\n     SiS_SetReg(SiS_Pr->SiS_Part1Port,0x12,temp);                  \n\n     if((SiS_Pr->ChipType >= SIS_315H) && (SiS_Pr->ChipType < SIS_661)) {\n\ttempbx++;\n\ttempax = tempbx;\n\ttempcx++;\n\ttempcx -= tempax;\n\ttempcx >>= 2;\n\ttempbx += tempcx;\n\tif(tempcx < 4) tempcx = 4;\n\ttempcx >>= 2;\n\ttempcx += tempbx;\n\ttempcx++;\n     } else {\n\ttempbx = (SiS_Pr->SiS_VGAVT + SiS_Pr->SiS_VGAVDE) >> 1;                  \n\ttempcx = ((SiS_Pr->SiS_VGAVT - SiS_Pr->SiS_VGAVDE) >> 4) + tempbx + 1;   \n     }\n\n     if(SiS_Pr->SiS_VBType & VB_SISVB) {\n\tif(SiS_Pr->UseCustomMode) {\n\t   tempbx = SiS_Pr->CVSyncStart;\n\t   tempcx = SiS_Pr->CVSyncEnd;\n\t}\n\tif(SiS_Pr->SiS_VBInfo & SetCRT2ToRAMDAC) {\n\t   unsigned char cr8, cr7, cr13;\n\t   if(SiS_Pr->UseCustomMode) {\n\t      cr8    = SiS_Pr->CCRT1CRTC[8];\n\t      cr7    = SiS_Pr->CCRT1CRTC[7];\n\t      cr13   = SiS_Pr->CCRT1CRTC[13];\n\t      tempcx = SiS_Pr->CCRT1CRTC[9];\n\t   } else {\n\t      cr8    = SiS_Pr->SiS_CRT1Table[CRT1Index].CR[8];\n\t      cr7    = SiS_Pr->SiS_CRT1Table[CRT1Index].CR[7];\n\t      cr13   = SiS_Pr->SiS_CRT1Table[CRT1Index].CR[13];\n\t      tempcx = SiS_Pr->SiS_CRT1Table[CRT1Index].CR[9];\n\t   }\n\t   tempbx = cr8;\n\t   if(cr7  & 0x04) tempbx |= 0x0100;\n\t   if(cr7  & 0x80) tempbx |= 0x0200;\n\t   if(cr13 & 0x08) tempbx |= 0x0400;\n\t}\n     }\n     SiS_SetReg(SiS_Pr->SiS_Part1Port,0x10,tempbx);                \n\n     temp = ((tempbx >> 4) & 0x70) | (tempcx & 0x0F);\n     SiS_SetReg(SiS_Pr->SiS_Part1Port,0x11,temp);                  \n\n      \n\n     if(SiS_Pr->ChipType < SIS_315H) {\n\n#ifdef CONFIG_FB_SIS_300   \n\n\tif(SiS_Pr->SiS_VBType & VB_SISVB) {\n\t   temp = 0x20;\n\t   if(SiS_Pr->ChipType == SIS_300) {\n\t      temp = 0x10;\n\t      if(SiS_Pr->SiS_LCDResInfo == Panel_1024x768)  temp = 0x2c;\n\t      if(SiS_Pr->SiS_LCDResInfo == Panel_1280x1024) temp = 0x20;\n\t   }\n\t   if(SiS_Pr->SiS_VBType & VB_SIS301) {\n\t      if(SiS_Pr->SiS_LCDResInfo == Panel_1280x1024) temp = 0x20;\n\t   }\n\t   if(SiS_Pr->SiS_LCDResInfo == Panel_1280x960)     temp = 0x24;\n\t   if(SiS_Pr->SiS_LCDResInfo == Panel_Custom)       temp = 0x2c;\n\t   if(SiS_Pr->SiS_VBInfo & SetCRT2ToTV) \t    temp = 0x08;\n\t   if(SiS_Pr->SiS_VBInfo & SetCRT2ToHiVision) {\n\t      if(SiS_Pr->SiS_VBInfo & SetInSlaveMode) \t    temp = 0x2c;\n\t      else \t\t\t\t\t    temp = 0x20;\n\t   }\n\t   if(SiS_Pr->SiS_UseROM) {\n\t      if(ROMAddr[0x220] & 0x80) {\n\t\t if(SiS_Pr->SiS_VBInfo & SetCRT2ToTVNoYPbPrHiVision)\n\t\t    temp = ROMAddr[0x221];\n\t\t else if(SiS_Pr->SiS_VBInfo & SetCRT2ToHiVision)\n\t\t    temp = ROMAddr[0x222];\n\t\t else if(SiS_Pr->SiS_LCDResInfo == Panel_1280x1024)\n\t\t    temp = ROMAddr[0x223];\n\t\t else\n\t\t    temp = ROMAddr[0x224];\n\t      }\n\t   }\n\t   if(SiS_Pr->SiS_VBInfo & SetCRT2ToLCD) {\n\t      if(SiS_Pr->PDC != -1)  temp = SiS_Pr->PDC;\n\t   }\n\n\t} else {\n\t   temp = 0x20;\n\t   if(!(SiS_Pr->SiS_VBInfo & SetCRT2ToTV)) {\n\t      if(SiS_Pr->SiS_LCDResInfo == Panel_640x480) temp = 0x04;\n\t   }\n\t   if(SiS_Pr->SiS_UseROM) {\n\t      if(ROMAddr[0x220] & 0x80) {\n\t         temp = ROMAddr[0x220];\n\t      }\n\t   }\n\t   if(SiS_Pr->SiS_VBInfo & SetCRT2ToLCD) {\n\t      if(SiS_Pr->PDC != -1) temp = SiS_Pr->PDC;\n\t   }\n\t}\n\n\ttemp &= 0x3c;\n\n\tSiS_SetRegANDOR(SiS_Pr->SiS_Part1Port,0x13,~0x3C,temp);    \n\n#endif   \n\n     } else {\n\n#ifdef CONFIG_FB_SIS_315    \n\n\tif(SiS_Pr->ChipType < SIS_661) {\n\n\t   if(SiS_Pr->SiS_IF_DEF_LVDS == 1) {\n\n\t      if(SiS_Pr->ChipType == SIS_740) temp = 0x03;\n\t      else \t\t              temp = 0x00;\n\n\t      if(SiS_Pr->SiS_VBInfo & SetCRT2ToTV) temp = 0x0a;\n\t      tempbl = 0xF0;\n\t      if(SiS_Pr->ChipType == SIS_650) {\n\t\t if(SiS_Pr->SiS_IF_DEF_CH70xx != 0) {\n\t\t    if(!(SiS_Pr->SiS_VBInfo & SetCRT2ToTV)) tempbl = 0x0F;\n\t\t }\n\t      }\n\n\t      if(SiS_Pr->SiS_IF_DEF_DSTN || SiS_Pr->SiS_IF_DEF_FSTN) {\n\t\t temp = 0x08;\n\t\t tempbl = 0;\n\t\t if((SiS_Pr->SiS_UseROM) && (!(SiS_Pr->SiS_ROMNew))) {\n\t\t    if(ROMAddr[0x13c] & 0x80) tempbl = 0xf0;\n\t\t }\n\t      }\n\n\t      SiS_SetRegANDOR(SiS_Pr->SiS_Part1Port,0x2D,tempbl,temp);\t     \n\t   }\n\n\t}  \n\n\ttempax = 0;\n\tif(modeflag & DoubleScanMode) tempax |= 0x80;\n\tif(modeflag & HalfDCLK)       tempax |= 0x40;\n\tSiS_SetRegANDOR(SiS_Pr->SiS_Part1Port,0x2C,0x3f,tempax);\n\n#endif   \n\n     }\n\n  }   \n\n  if(SiS_Pr->SiS_VBType & VB_SISVB) {\n     if((SiS_Pr->SiS_VBType & VB_NoLCD) && (SiS_Pr->SiS_VBInfo & SetCRT2ToLCD)) {\n\t \n\tSiS_SetGroup1_LVDS(SiS_Pr, ModeNo, ModeIdIndex, RefreshRateTableIndex);\n     } else if(SiS_Pr->SiS_VBInfo & SetInSlaveMode) {\n\tSiS_SetGroup1_301(SiS_Pr, ModeNo, ModeIdIndex, RefreshRateTableIndex);\n     }\n  } else {\n     if(SiS_Pr->ChipType < SIS_315H) {\n\tSiS_SetGroup1_LVDS(SiS_Pr, ModeNo, ModeIdIndex, RefreshRateTableIndex);\n     } else {\n\tif(SiS_Pr->SiS_IF_DEF_CH70xx != 0) {\n\t   if((!(SiS_Pr->SiS_VBInfo & SetCRT2ToTV)) || (SiS_Pr->SiS_VBInfo & SetInSlaveMode)) {\n\t      SiS_SetGroup1_LVDS(SiS_Pr, ModeNo,ModeIdIndex,RefreshRateTableIndex);\n\t   }\n\t} else {\n\t   SiS_SetGroup1_LVDS(SiS_Pr, ModeNo,ModeIdIndex,RefreshRateTableIndex);\n\t}\n     }\n  }\n}\n\n \n \n \n\n#ifdef CONFIG_FB_SIS_315\nstatic unsigned char *\nSiS_GetGroup2CLVXPtr(struct SiS_Private *SiS_Pr, int tabletype)\n{\n   const unsigned char *tableptr = NULL;\n   unsigned short      a, b, p = 0;\n\n   a = SiS_Pr->SiS_VGAHDE;\n   b = SiS_Pr->SiS_HDE;\n   if(tabletype) {\n      a = SiS_Pr->SiS_VGAVDE;\n      b = SiS_Pr->SiS_VDE;\n   }\n\n   if(a < b) {\n      tableptr = SiS_Part2CLVX_1;\n   } else if(a == b) {\n      tableptr = SiS_Part2CLVX_2;\n   } else {\n      if(SiS_Pr->SiS_TVMode & TVSetPAL) {\n\t tableptr = SiS_Part2CLVX_4;\n      } else {\n\t tableptr = SiS_Part2CLVX_3;\n      }\n      if(SiS_Pr->SiS_VBInfo & SetCRT2ToYPbPr525750) {\n\t if(SiS_Pr->SiS_TVMode & TVSetYPbPr525i) \ttableptr = SiS_Part2CLVX_3;\n\t else if(SiS_Pr->SiS_TVMode & TVSetYPbPr525p) \ttableptr = SiS_Part2CLVX_3;\n\t else \t\t\t\t         \ttableptr = SiS_Part2CLVX_5;\n      } else if(SiS_Pr->SiS_VBInfo & SetCRT2ToHiVision) {\n\t tableptr = SiS_Part2CLVX_6;\n      }\n      do {\n\t if((tableptr[p] | tableptr[p+1] << 8) == a) break;\n\t p += 0x42;\n      } while((tableptr[p] | tableptr[p+1] << 8) != 0xffff);\n      if((tableptr[p] | tableptr[p+1] << 8) == 0xffff) p -= 0x42;\n   }\n   p += 2;\n   return ((unsigned char *)&tableptr[p]);\n}\n\nstatic void\nSiS_SetGroup2_C_ELV(struct SiS_Private *SiS_Pr, unsigned short ModeNo, unsigned short ModeIdIndex,\n\t      \t    unsigned short RefreshRateTableIndex)\n{\n   unsigned char *tableptr;\n   unsigned char temp;\n   int i, j;\n\n   if(!(SiS_Pr->SiS_VBType & VB_SISTAP4SCALER)) return;\n\n   tableptr = SiS_GetGroup2CLVXPtr(SiS_Pr, 0);\n   for(i = 0x80, j = 0; i <= 0xbf; i++, j++) {\n      SiS_SetReg(SiS_Pr->SiS_Part2Port, i, tableptr[j]);\n   }\n   if(SiS_Pr->SiS_VBInfo & SetCRT2ToTV) {\n      tableptr = SiS_GetGroup2CLVXPtr(SiS_Pr, 1);\n      for(i = 0xc0, j = 0; i <= 0xff; i++, j++) {\n         SiS_SetReg(SiS_Pr->SiS_Part2Port, i, tableptr[j]);\n      }\n   }\n   temp = 0x10;\n   if(SiS_Pr->SiS_VBInfo & SetCRT2ToTV) temp |= 0x04;\n   SiS_SetRegANDOR(SiS_Pr->SiS_Part2Port,0x4e,0xeb,temp);\n}\n\nstatic bool\nSiS_GetCRT2Part2Ptr(struct SiS_Private *SiS_Pr,unsigned short ModeNo,unsigned short ModeIdIndex,\n\t\t    unsigned short RefreshRateTableIndex,unsigned short *CRT2Index,\n\t\t    unsigned short *ResIndex)\n{\n\n  if(SiS_Pr->ChipType < SIS_315H) return false;\n\n  if(ModeNo <= 0x13)\n     (*ResIndex) = SiS_Pr->SiS_SModeIDTable[ModeIdIndex].St_CRT2CRTC;\n  else\n     (*ResIndex) = SiS_Pr->SiS_RefIndex[RefreshRateTableIndex].Ext_CRT2CRTC;\n\n  (*ResIndex) &= 0x3f;\n  (*CRT2Index) = 0;\n\n  if(SiS_Pr->SiS_LCDResInfo == Panel_1024x768) {\n     if(!(SiS_Pr->SiS_SetFlag & LCDVESATiming)) {\n        (*CRT2Index) = 200;\n     }\n  }\n\n  if(SiS_Pr->SiS_CustomT == CUT_ASUSA2H_2) {\n     if(SiS_Pr->SiS_LCDResInfo == Panel_1024x768) {\n        if(SiS_Pr->SiS_SetFlag & LCDVESATiming) (*CRT2Index) = 206;\n     }\n  }\n  return (((*CRT2Index) != 0));\n}\n#endif\n\n#ifdef CONFIG_FB_SIS_300\nstatic void\nSiS_Group2LCDSpecial(struct SiS_Private *SiS_Pr, unsigned short ModeNo, unsigned short crt2crtc)\n{\n   unsigned short tempcx;\n   static const unsigned char atable[] = {\n       0xc3,0x9e,0xc3,0x9e,0x02,0x02,0x02,\n       0xab,0x87,0xab,0x9e,0xe7,0x02,0x02\n   };\n\n   if(!SiS_Pr->UseCustomMode) {\n      if( ( ( (SiS_Pr->ChipType == SIS_630) ||\n\t      (SiS_Pr->ChipType == SIS_730) ) &&\n\t    (SiS_Pr->ChipRevision > 2) )  &&\n\t  (SiS_Pr->SiS_LCDResInfo == Panel_1024x768) &&\n\t  (!(SiS_Pr->SiS_SetFlag & LCDVESATiming))  &&\n\t  (!(SiS_Pr->SiS_LCDInfo & DontExpandLCD)) ) {\n\t if(ModeNo == 0x13) {\n\t    SiS_SetReg(SiS_Pr->SiS_Part2Port,0x04,0xB9);\n\t    SiS_SetReg(SiS_Pr->SiS_Part2Port,0x05,0xCC);\n\t    SiS_SetReg(SiS_Pr->SiS_Part2Port,0x06,0xA6);\n\t } else if((crt2crtc & 0x3F) == 4) {\n\t    SiS_SetReg(SiS_Pr->SiS_Part2Port,0x01,0x2B);\n\t    SiS_SetReg(SiS_Pr->SiS_Part2Port,0x02,0x13);\n\t    SiS_SetReg(SiS_Pr->SiS_Part2Port,0x04,0xE5);\n\t    SiS_SetReg(SiS_Pr->SiS_Part2Port,0x05,0x08);\n\t    SiS_SetReg(SiS_Pr->SiS_Part2Port,0x06,0xE2);\n\t }\n      }\n\n      if(SiS_Pr->ChipType < SIS_315H) {\n\t if(SiS_Pr->SiS_LCDTypeInfo == 0x0c) {\n\t    crt2crtc &= 0x1f;\n\t    tempcx = 0;\n\t    if(!(SiS_Pr->SiS_VBInfo & SetNotSimuMode)) {\n\t       if(SiS_Pr->SiS_VBInfo & SetInSlaveMode) {\n\t\t  tempcx += 7;\n\t       }\n\t    }\n\t    tempcx += crt2crtc;\n\t    if(crt2crtc >= 4) {\n\t       SiS_SetReg(SiS_Pr->SiS_Part2Port,0x06,0xff);\n\t    }\n\n\t    if(!(SiS_Pr->SiS_VBInfo & SetNotSimuMode)) {\n\t       if(SiS_Pr->SiS_VBInfo & SetInSlaveMode) {\n\t\t  if(crt2crtc == 4) {\n\t\t     SiS_SetReg(SiS_Pr->SiS_Part2Port,0x01,0x28);\n\t\t  }\n\t       }\n\t    }\n\t    SiS_SetReg(SiS_Pr->SiS_Part2Port,0x02,0x18);\n\t    SiS_SetReg(SiS_Pr->SiS_Part2Port,0x04,atable[tempcx]);\n\t }\n      }\n   }\n}\n\n \nstatic void\nSiS_Set300Part2Regs(struct SiS_Private *SiS_Pr, unsigned short ModeIdIndex, unsigned short RefreshRateTableIndex,\n\t\t    unsigned short ModeNo)\n{\n  const struct SiS_Part2PortTbl *CRT2Part2Ptr = NULL;\n  unsigned short crt2crtc, resindex;\n  int i, j;\n\n  if(SiS_Pr->ChipType != SIS_300) return;\n  if(!(SiS_Pr->SiS_VBType & VB_SIS30xBLV)) return;\n  if(SiS_Pr->UseCustomMode) return;\n\n  if(ModeNo <= 0x13) {\n     crt2crtc = SiS_Pr->SiS_SModeIDTable[ModeIdIndex].St_CRT2CRTC;\n  } else {\n     crt2crtc = SiS_Pr->SiS_RefIndex[RefreshRateTableIndex].Ext_CRT2CRTC;\n  }\n\n  resindex = crt2crtc & 0x3F;\n  if(SiS_Pr->SiS_SetFlag & LCDVESATiming) CRT2Part2Ptr = SiS_Pr->SiS_CRT2Part2_1024x768_1;\n  else                                    CRT2Part2Ptr = SiS_Pr->SiS_CRT2Part2_1024x768_2;\n\n   \n  if(ModeNo > 0x13) {\n     CRT2Part2Ptr = SiS_Pr->SiS_CRT2Part2_1024x768_1;\n     resindex = 4;\n  }\n\n  SiS_SetRegANDOR(SiS_Pr->SiS_Part2Port,0x01,0x80,(CRT2Part2Ptr+resindex)->CR[0]);\n  SiS_SetRegANDOR(SiS_Pr->SiS_Part2Port,0x02,0x80,(CRT2Part2Ptr+resindex)->CR[1]);\n  for(i = 2, j = 0x04; j <= 0x06; i++, j++ ) {\n     SiS_SetReg(SiS_Pr->SiS_Part2Port,j,(CRT2Part2Ptr+resindex)->CR[i]);\n  }\n  for(j = 0x1c; j <= 0x1d; i++, j++ ) {\n     SiS_SetReg(SiS_Pr->SiS_Part2Port,j,(CRT2Part2Ptr+resindex)->CR[i]);\n  }\n  for(j = 0x1f; j <= 0x21; i++, j++ ) {\n     SiS_SetReg(SiS_Pr->SiS_Part2Port,j,(CRT2Part2Ptr+resindex)->CR[i]);\n  }\n  SiS_SetReg(SiS_Pr->SiS_Part2Port,0x23,(CRT2Part2Ptr+resindex)->CR[10]);\n  SiS_SetRegANDOR(SiS_Pr->SiS_Part2Port,0x25,0x0f,(CRT2Part2Ptr+resindex)->CR[11]);\n}\n#endif\n\nstatic void\nSiS_SetTVSpecial(struct SiS_Private *SiS_Pr, unsigned short ModeNo)\n{\n  if(!(SiS_Pr->SiS_VBType & VB_SIS30xBLV)) return;\n  if(!(SiS_Pr->SiS_VBInfo & SetCRT2ToTVNoHiVision)) return;\n  if(SiS_Pr->SiS_TVMode & (TVSetYPbPr525p | TVSetYPbPr750p)) return;\n\n  if(!(SiS_Pr->SiS_TVMode & TVSetPAL)) {\n     if(SiS_Pr->SiS_TVMode & TVSetNTSC1024) {\n        static const unsigned char specialtv[] = {\n\t\t0xa7,0x07,0xf2,0x6e,0x17,0x8b,0x73,0x53,\n\t\t0x13,0x40,0x34,0xf4,0x63,0xbb,0xcc,0x7a,\n\t\t0x58,0xe4,0x73,0xda,0x13\n\t};\n\tint i, j;\n\tfor(i = 0x1c, j = 0; i <= 0x30; i++, j++) {\n\t   SiS_SetReg(SiS_Pr->SiS_Part2Port,i,specialtv[j]);\n\t}\n\tSiS_SetReg(SiS_Pr->SiS_Part2Port,0x43,0x72);\n\tif(!(SiS_Pr->SiS_VBInfo & SetCRT2ToYPbPr525750)) {\n\t   if(SiS_Pr->SiS_TVMode & TVSetPALM) {\n\t      SiS_SetReg(SiS_Pr->SiS_Part2Port,0x01,0x14);\n\t      SiS_SetReg(SiS_Pr->SiS_Part2Port,0x02,0x1b);\n\t   } else {\n\t      SiS_SetReg(SiS_Pr->SiS_Part2Port,0x01,0x14);   \n\t      SiS_SetReg(SiS_Pr->SiS_Part2Port,0x02,0x1a);   \n\t   }\n\t}\n     }\n  } else {\n     if((ModeNo == 0x38) || (ModeNo == 0x4a) || (ModeNo == 0x64) ||\n        (ModeNo == 0x52) || (ModeNo == 0x58) || (ModeNo == 0x5c)) {\n        SiS_SetReg(SiS_Pr->SiS_Part2Port,0x01,0x1b);   \n        SiS_SetReg(SiS_Pr->SiS_Part2Port,0x02,0x54);   \n     } else {\n        SiS_SetReg(SiS_Pr->SiS_Part2Port,0x01,0x1a);   \n        SiS_SetReg(SiS_Pr->SiS_Part2Port,0x02,0x53);   \n     }\n  }\n}\n\nstatic void\nSiS_SetGroup2_Tail(struct SiS_Private *SiS_Pr, unsigned short ModeNo)\n{\n  unsigned short temp;\n\n  if(!(SiS_Pr->SiS_SetFlag & LCDVESATiming)) {\n     if(SiS_Pr->SiS_VGAVDE == 525) {\n\ttemp = 0xc3;\n\tif(SiS_Pr->SiS_ModeType <= ModeVGA) {\n\t   temp++;\n\t   if(SiS_Pr->SiS_VBType & VB_SIS30xBLV) temp += 2;\n\t}\n\tSiS_SetReg(SiS_Pr->SiS_Part2Port,0x2f,temp);\n\tSiS_SetReg(SiS_Pr->SiS_Part2Port,0x30,0xb3);\n     } else if(SiS_Pr->SiS_VGAVDE == 420) {\n\ttemp = 0x4d;\n\tif(SiS_Pr->SiS_ModeType <= ModeVGA) {\n\t   temp++;\n\t   if(SiS_Pr->SiS_VBType & VB_SIS30xBLV) temp++;\n\t}\n\tSiS_SetReg(SiS_Pr->SiS_Part2Port,0x2f,temp);\n     }\n  }\n\n  if(SiS_Pr->SiS_VBInfo & SetCRT2ToLCD) {\n     if(SiS_Pr->SiS_LCDResInfo == Panel_1400x1050) {\n\tif(SiS_Pr->SiS_VBType & VB_SIS30xB) {\n\t   SiS_SetRegOR(SiS_Pr->SiS_Part2Port,0x1a,0x03);\n\t    \n\t}\n\ttemp = 1;\n\tif(ModeNo <= 0x13) temp = 3;\n\tSiS_SetReg(SiS_Pr->SiS_Part2Port,0x0b,temp);\n     }\n#if 0\n      \n     if((SiS_Pr->SiS_PanelXRes == 1280) && (SiS_Pr->SiS_PanelYRes == 768)) {\n        if(SiS_Pr->SiS_VBInfo & SetSimuScanMode) {\n\t   if(((SiS_Pr->SiS_HDE == 640) && (SiS_Pr->SiS_VDE == 480)) ||\n\t      ((SiS_Pr->SiS_HDE == 320) && (SiS_Pr->SiS_VDE == 240))) {\n\t      SiS_SetReg(SiS_Part2Port,0x01,0x2b);\n\t      SiS_SetReg(SiS_Part2Port,0x02,0x13);\n\t      SiS_SetReg(SiS_Part2Port,0x04,0xe5);\n\t      SiS_SetReg(SiS_Part2Port,0x05,0x08);\n\t      SiS_SetReg(SiS_Part2Port,0x06,0xe2);\n\t      SiS_SetReg(SiS_Part2Port,0x1c,0x21);\n\t      SiS_SetReg(SiS_Part2Port,0x1d,0x45);\n\t      SiS_SetReg(SiS_Part2Port,0x1f,0x0b);\n\t      SiS_SetReg(SiS_Part2Port,0x20,0x00);\n\t      SiS_SetReg(SiS_Part2Port,0x21,0xa9);\n\t      SiS_SetReg(SiS_Part2Port,0x23,0x0b);\n\t      SiS_SetReg(SiS_Part2Port,0x25,0x04);\n\t   }\n\t}\n     }\n#endif\n  }\n}\n\nstatic void\nSiS_SetGroup2(struct SiS_Private *SiS_Pr, unsigned short ModeNo, unsigned short ModeIdIndex,\n\t\tunsigned short RefreshRateTableIndex)\n{\n  unsigned short i, j, tempax, tempbx, tempcx, tempch, tempcl, temp;\n  unsigned short push2, modeflag, crt2crtc, bridgeoffset;\n  unsigned int   longtemp, PhaseIndex;\n  bool           newtvphase;\n  const unsigned char *TimingPoint;\n#ifdef CONFIG_FB_SIS_315\n  unsigned short resindex, CRT2Index;\n  const struct SiS_Part2PortTbl *CRT2Part2Ptr = NULL;\n\n  if(SiS_Pr->SiS_VBInfo & SetCRT2ToLCDA) return;\n#endif\n\n  if(ModeNo <= 0x13) {\n     modeflag = SiS_Pr->SiS_SModeIDTable[ModeIdIndex].St_ModeFlag;\n     crt2crtc = SiS_Pr->SiS_SModeIDTable[ModeIdIndex].St_CRT2CRTC;\n  } else if(SiS_Pr->UseCustomMode) {\n     modeflag = SiS_Pr->CModeFlag;\n     crt2crtc = 0;\n  } else {\n     modeflag = SiS_Pr->SiS_EModeIDTable[ModeIdIndex].Ext_ModeFlag;\n     crt2crtc = SiS_Pr->SiS_RefIndex[RefreshRateTableIndex].Ext_CRT2CRTC;\n  }\n\n  temp = 0;\n  if(!(SiS_Pr->SiS_VBInfo & SetCRT2ToAVIDEO)) temp |= 0x08;\n  if(!(SiS_Pr->SiS_VBInfo & SetCRT2ToSVIDEO)) temp |= 0x04;\n  if(SiS_Pr->SiS_VBInfo & SetCRT2ToSCART)     temp |= 0x02;\n  if(SiS_Pr->SiS_VBInfo & SetCRT2ToHiVision)  temp |= 0x01;\n\n  if(!(SiS_Pr->SiS_TVMode & TVSetPAL)) \t      temp |= 0x10;\n\n  SiS_SetReg(SiS_Pr->SiS_Part2Port,0x00,temp);\n\n  PhaseIndex  = 0x01;  \n  TimingPoint = SiS_Pr->SiS_PALTiming;\n\n  newtvphase = false;\n  if( (SiS_Pr->SiS_VBType & VB_SIS30xBLV) &&\n      ( (!(SiS_Pr->SiS_VBInfo & SetInSlaveMode)) ||\n\t(SiS_Pr->SiS_TVMode & TVSetTVSimuMode) ) ) {\n     newtvphase = true;\n  }\n\n  if(SiS_Pr->SiS_VBInfo & SetCRT2ToHiVision) {\n\n     TimingPoint = SiS_Pr->SiS_HiTVExtTiming;\n     if(SiS_Pr->SiS_VBInfo & SetInSlaveMode) {\n        TimingPoint = SiS_Pr->SiS_HiTVSt2Timing;\n        if(SiS_Pr->SiS_TVMode & TVSetTVSimuMode) {\n\t   TimingPoint = SiS_Pr->SiS_HiTVSt1Timing;\n        }\n     }\n\n  } else if(SiS_Pr->SiS_VBInfo & SetCRT2ToYPbPr525750) {\n\n     i = 0;\n     if(SiS_Pr->SiS_TVMode & TVSetYPbPr750p)      i = 2;\n     else if(SiS_Pr->SiS_TVMode & TVSetYPbPr525p) i = 1;\n\n     TimingPoint = &SiS_YPbPrTable[i][0];\n\n     PhaseIndex = 0x00;  \n\n  } else if(SiS_Pr->SiS_TVMode & TVSetPAL) {\n\n     if(newtvphase) PhaseIndex = 0x09;  \n\n  } else {\n\n     TimingPoint = SiS_Pr->SiS_NTSCTiming;\n     PhaseIndex  = (SiS_Pr->SiS_TVMode & TVSetNTSCJ) ? 0x01 : 0x00;\t \n     if(newtvphase) PhaseIndex += 8;\t\t\t\t\t \n\n  }\n\n  if(SiS_Pr->SiS_TVMode & (TVSetPALM | TVSetPALN)) {\n     PhaseIndex = (SiS_Pr->SiS_TVMode & TVSetPALM) ? 0x02 : 0x03;\t \n     if(newtvphase) PhaseIndex += 8;\t\t\t\t\t \n  }\n\n  if(SiS_Pr->SiS_TVMode & TVSetNTSC1024) {\n     if(SiS_Pr->SiS_TVMode & TVSetPALM) {\n        PhaseIndex = 0x05;  \n     } else if(SiS_Pr->SiS_TVMode & TVSetNTSCJ) {\n        PhaseIndex = 0x11;  \n     } else {\n        PhaseIndex = 0x10;  \n     }\n  }\n\n  for(i = 0x31, j = 0; i <= 0x34; i++, j++) {\n     SiS_SetReg(SiS_Pr->SiS_Part2Port,i,SiS_TVPhase[(PhaseIndex * 4) + j]);\n  }\n\n  for(i = 0x01, j = 0; i <= 0x2D; i++, j++) {\n     SiS_SetReg(SiS_Pr->SiS_Part2Port,i,TimingPoint[j]);\n  }\n  for(i = 0x39; i <= 0x45; i++, j++) {\n     SiS_SetReg(SiS_Pr->SiS_Part2Port,i,TimingPoint[j]);\n  }\n\n  if(SiS_Pr->SiS_VBInfo & SetCRT2ToTV) {\n     if(SiS_Pr->SiS_ModeType != ModeText) {\n        SiS_SetRegAND(SiS_Pr->SiS_Part2Port,0x3A,0x1F);\n     }\n  }\n\n  SiS_SetRegOR(SiS_Pr->SiS_Part2Port,0x0A,SiS_Pr->SiS_NewFlickerMode);\n\n  SiS_SetReg(SiS_Pr->SiS_Part2Port,0x35,SiS_Pr->SiS_RY1COE);\n  SiS_SetReg(SiS_Pr->SiS_Part2Port,0x36,SiS_Pr->SiS_RY2COE);\n  SiS_SetReg(SiS_Pr->SiS_Part2Port,0x37,SiS_Pr->SiS_RY3COE);\n  SiS_SetReg(SiS_Pr->SiS_Part2Port,0x38,SiS_Pr->SiS_RY4COE);\n\n  if(SiS_Pr->SiS_VBInfo & SetCRT2ToHiVision)\ttempax = 950;\n  else if(SiS_Pr->SiS_TVMode & TVSetYPbPr750p)  tempax = 680;\n  else if(SiS_Pr->SiS_TVMode & TVSetPAL)\ttempax = 520;\n  else\t\t\t\t\t\ttempax = 440;  \n\n  if( ((SiS_Pr->SiS_VBInfo & SetCRT2ToHiVision) && (SiS_Pr->SiS_VDE <= tempax)) ||\n      ( (SiS_Pr->SiS_VBInfo & SetCRT2ToTVNoHiVision) &&\n        ((SiS_Pr->SiS_VGAHDE == 1024) || (SiS_Pr->SiS_VDE <= tempax)) ) ) {\n\n     tempax -= SiS_Pr->SiS_VDE;\n     tempax >>= 1;\n     if(!(SiS_Pr->SiS_TVMode & (TVSetYPbPr525p | TVSetYPbPr750p))) {\n        tempax >>= 1;\n     }\n     tempax &= 0x00ff;\n\n     temp = tempax + (unsigned short)TimingPoint[0];\n     SiS_SetReg(SiS_Pr->SiS_Part2Port,0x01,temp);\n\n     temp = tempax + (unsigned short)TimingPoint[1];\n     SiS_SetReg(SiS_Pr->SiS_Part2Port,0x02,temp);\n\n     if((SiS_Pr->SiS_VBInfo & SetCRT2ToTVNoYPbPrHiVision) && (SiS_Pr->SiS_VGAHDE >= 1024)) {\n        if(SiS_Pr->SiS_TVMode & TVSetPAL) {\n           SiS_SetReg(SiS_Pr->SiS_Part2Port,0x01,0x1b);\n           SiS_SetReg(SiS_Pr->SiS_Part2Port,0x02,0x54);\n        } else {\n           SiS_SetReg(SiS_Pr->SiS_Part2Port,0x01,0x17);\n           SiS_SetReg(SiS_Pr->SiS_Part2Port,0x02,0x1d);\n        }\n     }\n\n  }\n\n  tempcx = SiS_Pr->SiS_HT;\n  if(SiS_IsDualLink(SiS_Pr)) tempcx >>= 1;\n  tempcx--;\n  if(SiS_Pr->SiS_VBType & VB_SIS30xBLV) tempcx--;\n  SiS_SetReg(SiS_Pr->SiS_Part2Port,0x1B,tempcx);\n  SiS_SetRegANDOR(SiS_Pr->SiS_Part2Port,0x1D,0xF0,((tempcx >> 8) & 0x0f));\n\n  tempcx = SiS_Pr->SiS_HT >> 1;\n  if(SiS_IsDualLink(SiS_Pr)) tempcx >>= 1;\n  tempcx += 7;\n  if(SiS_Pr->SiS_VBInfo & SetCRT2ToHiVision) tempcx -= 4;\n  SiS_SetRegANDOR(SiS_Pr->SiS_Part2Port,0x22,0x0F,((tempcx << 4) & 0xf0));\n\n  tempbx = TimingPoint[j] | (TimingPoint[j+1] << 8);\n  tempbx += tempcx;\n  SiS_SetReg(SiS_Pr->SiS_Part2Port,0x24,tempbx);\n  SiS_SetRegANDOR(SiS_Pr->SiS_Part2Port,0x25,0x0F,((tempbx >> 4) & 0xf0));\n\n  tempbx += 8;\n  if(SiS_Pr->SiS_VBInfo & SetCRT2ToHiVision) {\n     tempbx -= 4;\n     tempcx = tempbx;\n  }\n  SiS_SetRegANDOR(SiS_Pr->SiS_Part2Port,0x29,0x0F,((tempbx << 4) & 0xf0));\n\n  j += 2;\n  tempcx += (TimingPoint[j] | (TimingPoint[j+1] << 8));\n  SiS_SetReg(SiS_Pr->SiS_Part2Port,0x27,tempcx);\n  SiS_SetRegANDOR(SiS_Pr->SiS_Part2Port,0x28,0x0F,((tempcx >> 4) & 0xf0));\n\n  tempcx += 8;\n  if(SiS_Pr->SiS_VBInfo & SetCRT2ToHiVision) tempcx -= 4;\n  SiS_SetRegANDOR(SiS_Pr->SiS_Part2Port,0x2A,0x0F,((tempcx << 4) & 0xf0));\n\n  tempcx = SiS_Pr->SiS_HT >> 1;\n  if(SiS_IsDualLink(SiS_Pr)) tempcx >>= 1;\n  j += 2;\n  tempcx -= (TimingPoint[j] | ((TimingPoint[j+1]) << 8));\n  SiS_SetRegANDOR(SiS_Pr->SiS_Part2Port,0x2D,0x0F,((tempcx << 4) & 0xf0));\n\n  tempcx -= 11;\n  if(!(SiS_Pr->SiS_VBInfo & SetCRT2ToTV)) {\n     tempcx = SiS_GetVGAHT2(SiS_Pr) - 1;\n  }\n  SiS_SetReg(SiS_Pr->SiS_Part2Port,0x2E,tempcx);\n\n  tempbx = SiS_Pr->SiS_VDE;\n  if(SiS_Pr->SiS_VBInfo & SetCRT2ToLCD) {\n     if(SiS_Pr->SiS_VGAVDE == 360) tempbx = 746;\n     if(SiS_Pr->SiS_VGAVDE == 375) tempbx = 746;\n     if(SiS_Pr->SiS_VGAVDE == 405) tempbx = 853;\n  } else if( (SiS_Pr->SiS_VBInfo & SetCRT2ToTV) &&\n             (!(SiS_Pr->SiS_TVMode & (TVSetYPbPr525p|TVSetYPbPr750p))) ) {\n     tempbx >>= 1;\n     if(SiS_Pr->ChipType >= SIS_315H) {\n        if(SiS_Pr->SiS_TVMode & TVSetTVSimuMode) {\n\t   if((ModeNo <= 0x13) && (crt2crtc == 1)) tempbx++;\n\t} else if(SiS_Pr->SiS_VBInfo & SetInSlaveMode) {\n\t   if(SiS_Pr->SiS_ModeType <= ModeVGA) {\n\t      if(crt2crtc == 4) tempbx++;\n\t   }\n\t}\n     }\n     if(SiS_Pr->SiS_VBInfo & SetInSlaveMode) {\n        if(SiS_Pr->SiS_VBInfo & SetCRT2ToHiVision) {\n\t   if((ModeNo == 0x2f) || (ModeNo == 0x5d) || (ModeNo == 0x5e)) tempbx++;\n\t}\n\tif(!(SiS_Pr->SiS_TVMode & TVSetPAL)) {\n\t   if(ModeNo == 0x03) tempbx++;  \n        }\n     }\n  }\n  tempbx -= 2;\n  SiS_SetReg(SiS_Pr->SiS_Part2Port,0x2F,tempbx);\n\n  temp = (tempcx >> 8) & 0x0F;\n  temp |= ((tempbx >> 2) & 0xC0);\n  if(SiS_Pr->SiS_VBInfo & (SetCRT2ToSVIDEO | SetCRT2ToAVIDEO)) {\n     temp |= 0x10;\n     if(SiS_Pr->SiS_VBInfo & SetCRT2ToAVIDEO) temp |= 0x20;\n  }\n  SiS_SetReg(SiS_Pr->SiS_Part2Port,0x30,temp);\n\n  if(SiS_Pr->SiS_VBType & VB_SISPART4OVERFLOW) {\n     SiS_SetRegANDOR(SiS_Pr->SiS_Part4Port,0x10,0xdf,((tempbx & 0x0400) >> 5));\n  }\n\n  if(SiS_Pr->SiS_VBType & VB_SIS30xBLV) {\n     tempbx = SiS_Pr->SiS_VDE;\n     if( (SiS_Pr->SiS_VBInfo & SetCRT2ToTV) &&\n         (!(SiS_Pr->SiS_TVMode & (TVSetYPbPr525p | TVSetYPbPr750p))) ) {\n        tempbx >>= 1;\n     }\n     tempbx -= 3;\n     temp = ((tempbx >> 3) & 0x60) | 0x18;\n     SiS_SetReg(SiS_Pr->SiS_Part2Port,0x46,temp);\n     SiS_SetReg(SiS_Pr->SiS_Part2Port,0x47,tempbx);\n\n     if(SiS_Pr->SiS_VBType & VB_SISPART4OVERFLOW) {\n\tSiS_SetRegANDOR(SiS_Pr->SiS_Part4Port,0x10,0xbf,((tempbx & 0x0400) >> 4));\n     }\n  }\n\n  tempbx = 0;\n  if(!(modeflag & HalfDCLK)) {\n     if(SiS_Pr->SiS_VGAHDE >= SiS_Pr->SiS_HDE) {\n        tempax = 0;\n        tempbx |= 0x20;\n     }\n  }\n\n  tempch = tempcl = 0x01;\n  if(SiS_Pr->SiS_VBInfo & SetCRT2ToTV) {\n     if(SiS_Pr->SiS_VGAHDE >= 960) {\n        if((!(modeflag & HalfDCLK)) || (SiS_Pr->ChipType < SIS_315H)) {\n\t   tempcl = 0x20;\n\t   if(SiS_Pr->SiS_VGAHDE >= 1280) {\n              tempch = 20;\n              tempbx &= ~0x20;\n           } else {\n\t      tempch = 25;  \n\t   }\n        }\n     }\n  }\n\n  if(!(tempbx & 0x20)) {\n     if(modeflag & HalfDCLK) tempcl <<= 1;\n     longtemp = ((SiS_Pr->SiS_VGAHDE * tempch) / tempcl) << 13;\n     if(SiS_Pr->SiS_VBType & VB_SIS30xBLV) longtemp <<= 3;\n     tempax = longtemp / SiS_Pr->SiS_HDE;\n     if(longtemp % SiS_Pr->SiS_HDE) tempax++;\n     tempbx |= ((tempax >> 8) & 0x1F);\n     tempcx = tempax >> 13;\n  }\n\n  SiS_SetReg(SiS_Pr->SiS_Part2Port,0x44,tempax);\n  SiS_SetRegANDOR(SiS_Pr->SiS_Part2Port,0x45,0xC0,tempbx);\n\n  if(SiS_Pr->SiS_VBType & VB_SIS30xBLV) {\n\n     tempcx &= 0x07;\n     if(tempbx & 0x20) tempcx = 0;\n     SiS_SetRegANDOR(SiS_Pr->SiS_Part2Port,0x46,0xF8,tempcx);\n\n     if(SiS_Pr->SiS_TVMode & TVSetPAL) {\n        tempbx = 0x0382;\n        tempcx = 0x007e;\n     } else {\n        tempbx = 0x0369;\n        tempcx = 0x0061;\n     }\n     SiS_SetReg(SiS_Pr->SiS_Part2Port,0x4B,tempbx);\n     SiS_SetReg(SiS_Pr->SiS_Part2Port,0x4C,tempcx);\n     temp = (tempcx & 0x0300) >> 6;\n     temp |= ((tempbx >> 8) & 0x03);\n     if(SiS_Pr->SiS_VBInfo & SetCRT2ToYPbPr525750) {\n        temp |= 0x10;\n\tif(SiS_Pr->SiS_TVMode & TVSetYPbPr525p)      temp |= 0x20;\n\telse if(SiS_Pr->SiS_TVMode & TVSetYPbPr750p) temp |= 0x40;\n     }\n     SiS_SetReg(SiS_Pr->SiS_Part2Port,0x4D,temp);\n\n     temp = SiS_GetReg(SiS_Pr->SiS_Part2Port,0x43);\n     SiS_SetReg(SiS_Pr->SiS_Part2Port,0x43,(temp - 3));\n\n     SiS_SetTVSpecial(SiS_Pr, ModeNo);\n\n     if(SiS_Pr->SiS_VBType & VB_SIS30xCLV) {\n        temp = 0;\n        if(SiS_Pr->SiS_TVMode & TVSetPALM) temp = 8;\n        SiS_SetRegANDOR(SiS_Pr->SiS_Part2Port,0x4e,0xf7,temp);\n     }\n\n  }\n\n  if(SiS_Pr->SiS_TVMode & TVSetPALM) {\n     if(!(SiS_Pr->SiS_TVMode & TVSetNTSC1024)) {\n        temp = SiS_GetReg(SiS_Pr->SiS_Part2Port,0x01);\n        SiS_SetReg(SiS_Pr->SiS_Part2Port,0x01,(temp - 1));\n     }\n     SiS_SetRegAND(SiS_Pr->SiS_Part2Port,0x00,0xEF);\n  }\n\n  if(SiS_Pr->SiS_VBInfo & SetCRT2ToHiVision) {\n     if(!(SiS_Pr->SiS_VBInfo & SetInSlaveMode)) {\n        SiS_SetReg(SiS_Pr->SiS_Part2Port,0x0B,0x00);\n     }\n  }\n\n  if(SiS_Pr->SiS_VBInfo & SetCRT2ToTV) return;\n\n   \n\n  tempbx = SiS_Pr->SiS_HDE;\n  if(SiS_IsDualLink(SiS_Pr)) tempbx >>= 1;\n  tempbx--;\t\t\t         \t \n  SiS_SetReg(SiS_Pr->SiS_Part2Port,0x2C,tempbx);\n  SiS_SetRegANDOR(SiS_Pr->SiS_Part2Port,0x2B,0x0F,((tempbx >> 4) & 0xf0));\n\n  temp = 0x01;\n  if(SiS_Pr->SiS_LCDResInfo == Panel_1280x1024) {\n     if(SiS_Pr->SiS_ModeType == ModeEGA) {\n        if(SiS_Pr->SiS_VGAHDE >= 1024) {\n           temp = 0x02;\n           if(SiS_Pr->SiS_SetFlag & LCDVESATiming) {\n              temp = 0x01;\n\t   }\n        }\n     }\n  }\n  SiS_SetReg(SiS_Pr->SiS_Part2Port,0x0B,temp);\n\n  tempbx = SiS_Pr->SiS_VDE - 1;\n  SiS_SetReg(SiS_Pr->SiS_Part2Port,0x03,tempbx);\n  SiS_SetRegANDOR(SiS_Pr->SiS_Part2Port,0x0C,0xF8,((tempbx >> 8) & 0x07));\n\n  tempcx = SiS_Pr->SiS_VT - 1;\n  SiS_SetReg(SiS_Pr->SiS_Part2Port,0x19,tempcx);\n  temp = (tempcx >> 3) & 0xE0;\n  if(SiS_Pr->SiS_LCDInfo & LCDRGB18Bit) {\n      \n     if(SiS_GetReg(SiS_Pr->SiS_Part1Port,0x00) & 0x01) {\n        temp |= 0x10;\n     }\n  }\n  SiS_SetRegANDOR(SiS_Pr->SiS_Part2Port,0x1A,0x0f,temp);\n\n  SiS_SetRegAND(SiS_Pr->SiS_Part2Port,0x09,0xF0);\n  SiS_SetRegAND(SiS_Pr->SiS_Part2Port,0x0A,0xF0);\n\n  SiS_SetRegAND(SiS_Pr->SiS_Part2Port,0x17,0xFB);\n  SiS_SetRegAND(SiS_Pr->SiS_Part2Port,0x18,0xDF);\n\n#ifdef CONFIG_FB_SIS_315\n  if(SiS_GetCRT2Part2Ptr(SiS_Pr, ModeNo, ModeIdIndex, RefreshRateTableIndex,\n                          \t\t\t&CRT2Index, &resindex)) {\n      switch(CRT2Index) {\n        case 206: CRT2Part2Ptr = SiS310_CRT2Part2_Asus1024x768_3;    break;\n\tdefault:\n        case 200: CRT2Part2Ptr = SiS_Pr->SiS_CRT2Part2_1024x768_1;   break;\n      }\n\n      SiS_SetRegANDOR(SiS_Pr->SiS_Part2Port,0x01,0x80,(CRT2Part2Ptr+resindex)->CR[0]);\n      SiS_SetRegANDOR(SiS_Pr->SiS_Part2Port,0x02,0x80,(CRT2Part2Ptr+resindex)->CR[1]);\n      for(i = 2, j = 0x04; j <= 0x06; i++, j++ ) {\n        SiS_SetReg(SiS_Pr->SiS_Part2Port,j,(CRT2Part2Ptr+resindex)->CR[i]);\n      }\n      for(j = 0x1c; j <= 0x1d; i++, j++ ) {\n        SiS_SetReg(SiS_Pr->SiS_Part2Port,j,(CRT2Part2Ptr+resindex)->CR[i]);\n      }\n      for(j = 0x1f; j <= 0x21; i++, j++ ) {\n        SiS_SetReg(SiS_Pr->SiS_Part2Port,j,(CRT2Part2Ptr+resindex)->CR[i]);\n      }\n      SiS_SetReg(SiS_Pr->SiS_Part2Port,0x23,(CRT2Part2Ptr+resindex)->CR[10]);\n      SiS_SetRegANDOR(SiS_Pr->SiS_Part2Port,0x25,0x0f,(CRT2Part2Ptr+resindex)->CR[11]);\n\n      SiS_SetGroup2_Tail(SiS_Pr, ModeNo);\n\n  } else {\n#endif\n\n     \n     \n     \n     \n\n    if(SiS_Pr->SiS_LCDInfo & DontExpandLCD) {\n       if((SiS_Pr->SiS_LCDInfo & LCDPass11) || (SiS_Pr->PanelYRes == SiS_Pr->SiS_VDE)) {\n          tempbx = SiS_Pr->SiS_VDE - 1;\n          tempcx = SiS_Pr->SiS_VT - 1;\n       } else {\n          tempbx = SiS_Pr->SiS_VDE + ((SiS_Pr->PanelYRes - SiS_Pr->SiS_VDE) / 2);\n\t  tempcx = SiS_Pr->SiS_VT - ((SiS_Pr->PanelYRes - SiS_Pr->SiS_VDE) / 2);\n       }\n    } else {\n       tempbx = SiS_Pr->PanelYRes;\n       tempcx = SiS_Pr->SiS_VT;\n       tempax = 1;\n       if(SiS_Pr->PanelYRes != SiS_Pr->SiS_VDE) {\n          tempax = SiS_Pr->PanelYRes;\n\t      \n          if(SiS_Pr->PanelYRes < SiS_Pr->SiS_VDE) {\n             tempax = tempcx = 0;\n          } else {\n             tempax -= SiS_Pr->SiS_VDE;\n          }\n          tempax >>= 1;\n       }\n       tempcx -= tempax;  \n       tempbx -= tempax;  \n    }\n\n     \n\n    SiS_SetReg(SiS_Pr->SiS_Part2Port,0x05,tempcx);\t \n    SiS_SetReg(SiS_Pr->SiS_Part2Port,0x06,tempbx);\t \n\n    temp = (tempbx >> 5) & 0x38;\n    temp |= ((tempcx >> 8) & 0x07);\n    SiS_SetReg(SiS_Pr->SiS_Part2Port,0x02,temp);\n\n    tempax = SiS_Pr->SiS_VDE;\n    if((SiS_Pr->SiS_LCDInfo & DontExpandLCD) && (!(SiS_Pr->SiS_LCDInfo & LCDPass11))) {\n       tempax = SiS_Pr->PanelYRes;\n    }\n    tempcx = (SiS_Pr->SiS_VT - tempax) >> 4;\n    if((SiS_Pr->SiS_LCDInfo & DontExpandLCD) && (!(SiS_Pr->SiS_LCDInfo & LCDPass11))) {\n       if(SiS_Pr->PanelYRes != SiS_Pr->SiS_VDE) {\n\t  tempcx = (SiS_Pr->SiS_VT - tempax) / 10;\n       }\n    }\n\n    tempbx = ((SiS_Pr->SiS_VT + SiS_Pr->SiS_VDE) >> 1) - 1;\n    if(SiS_Pr->SiS_LCDInfo & DontExpandLCD) {\n       if(SiS_Pr->PanelYRes != SiS_Pr->SiS_VDE) {\n          if(!(SiS_Pr->SiS_LCDInfo & LCDPass11)) {  \n             tempax = SiS_Pr->SiS_VT - SiS_Pr->PanelYRes;\n\t     if(tempax % 4) { tempax >>= 2; tempax++; }\n\t     else           { tempax >>= 2;           }\n             tempbx -= (tempax - 1);\n\t  } else {\n\t     tempbx -= 10;\n\t     if(tempbx <= SiS_Pr->SiS_VDE) tempbx = SiS_Pr->SiS_VDE + 1;\n\t  }\n       }\n    }\n    if(SiS_Pr->SiS_LCDResInfo == Panel_1024x768) {\n       tempbx++;\n       if((!(SiS_Pr->SiS_LCDInfo & DontExpandLCD)) || (crt2crtc == 6)) {\n          if(SiS_Pr->SiS_SetFlag & LCDVESATiming) {\n\t     tempbx = 770;\n\t     tempcx = 3;\n\t  }\n       }\n    }\n\n     \n\n    if(SiS_Pr->UseCustomMode) {\n       tempbx = SiS_Pr->CVSyncStart;\n    }\n\n    SiS_SetReg(SiS_Pr->SiS_Part2Port,0x04,tempbx);\t     \n\n    temp = (tempbx >> 4) & 0xF0;\n    tempbx += (tempcx + 1);\n    temp |= (tempbx & 0x0F);\n\n    if(SiS_Pr->UseCustomMode) {\n       temp &= 0xf0;\n       temp |= (SiS_Pr->CVSyncEnd & 0x0f);\n    }\n\n    SiS_SetReg(SiS_Pr->SiS_Part2Port,0x01,temp);\n\n#ifdef CONFIG_FB_SIS_300\n    SiS_Group2LCDSpecial(SiS_Pr, ModeNo, crt2crtc);\n#endif\n\n    bridgeoffset = 7;\n    if(SiS_Pr->SiS_VBType & VB_SIS30xBLV)\tbridgeoffset += 2;\n    if(SiS_Pr->SiS_VBType & VB_SIS30xCLV)\tbridgeoffset += 2;  \n    if(SiS_IsDualLink(SiS_Pr))\t\t\tbridgeoffset++;\n    else if(SiS_Pr->SiS_VBType & VB_SIS302LV)\tbridgeoffset++;     \n     \n\n    temp = 0;\n    if((SiS_Pr->SiS_LCDInfo & DontExpandLCD) && (!(SiS_Pr->SiS_LCDInfo & LCDPass11))) {\n       if(SiS_Pr->PanelXRes != SiS_Pr->SiS_HDE) {\n\t  temp = SiS_Pr->SiS_HT - ((SiS_Pr->PanelXRes - SiS_Pr->SiS_HDE) / 2);\n\t  if(SiS_IsDualLink(SiS_Pr)) temp >>= 1;\n       }\n    }\n    temp += bridgeoffset;\n    SiS_SetReg(SiS_Pr->SiS_Part2Port,0x1F,temp);  \t      \n    SiS_SetRegANDOR(SiS_Pr->SiS_Part2Port,0x20,0x0F,((temp >> 4) & 0xf0));\n\n    tempcx = SiS_Pr->SiS_HT;\n    tempax = tempbx = SiS_Pr->SiS_HDE;\n    if((SiS_Pr->SiS_LCDInfo & DontExpandLCD) && (!(SiS_Pr->SiS_LCDInfo & LCDPass11))) {\n       if(SiS_Pr->PanelXRes != SiS_Pr->SiS_HDE) {\n          tempax = SiS_Pr->PanelXRes;\n          tempbx = SiS_Pr->PanelXRes - ((SiS_Pr->PanelXRes - SiS_Pr->SiS_HDE) / 2);\n       }\n    }\n    if(SiS_IsDualLink(SiS_Pr)) {\n       tempcx >>= 1;\n       tempbx >>= 1;\n       tempax >>= 1;\n    }\n\n    tempbx += bridgeoffset;\n\n    SiS_SetReg(SiS_Pr->SiS_Part2Port,0x23,tempbx);\t     \n    SiS_SetRegANDOR(SiS_Pr->SiS_Part2Port,0x25,0xF0,((tempbx >> 8) & 0x0f));\n\n    tempcx = (tempcx - tempax) >> 2;\n\n    tempbx += tempcx;\n    push2 = tempbx;\n\n    if(SiS_Pr->SiS_LCDResInfo == Panel_1280x1024) {\n       if(SiS_Pr->SiS_LCDInfo & DontExpandLCD) {\n          if(SiS_Pr->SiS_LCDInfo & LCDPass11) {\n             if(SiS_Pr->SiS_HDE == 1280) tempbx = (tempbx & 0xff00) | 0x47;\n\t  }\n       }\n    }\n\n    if(SiS_Pr->UseCustomMode) {\n       tempbx = SiS_Pr->CHSyncStart;\n       if(modeflag & HalfDCLK) tempbx <<= 1;\n       if(SiS_IsDualLink(SiS_Pr)) tempbx >>= 1;\n       tempbx += bridgeoffset;\n    }\n\n    SiS_SetReg(SiS_Pr->SiS_Part2Port,0x1C,tempbx);\t     \n    SiS_SetRegANDOR(SiS_Pr->SiS_Part2Port,0x1D,0x0F,((tempbx >> 4) & 0xf0));\n\n    tempbx = push2;\n\n    tempcx <<= 1;\n    if((SiS_Pr->SiS_LCDInfo & DontExpandLCD) && (!(SiS_Pr->SiS_LCDInfo & LCDPass11))) {\n       if(SiS_Pr->PanelXRes != SiS_Pr->SiS_HDE) tempcx >>= 2;\n    }\n    tempbx += tempcx;\n\n    if(SiS_Pr->UseCustomMode) {\n       tempbx = SiS_Pr->CHSyncEnd;\n       if(modeflag & HalfDCLK) tempbx <<= 1;\n       if(SiS_IsDualLink(SiS_Pr)) tempbx >>= 1;\n       tempbx += bridgeoffset;\n    }\n\n    SiS_SetReg(SiS_Pr->SiS_Part2Port,0x21,tempbx);\t     \n\n    SiS_SetGroup2_Tail(SiS_Pr, ModeNo);\n\n#ifdef CONFIG_FB_SIS_300\n    SiS_Set300Part2Regs(SiS_Pr, ModeIdIndex, RefreshRateTableIndex, ModeNo);\n#endif\n#ifdef CONFIG_FB_SIS_315\n  }  \n#endif\n}\n\n \n \n \n\nstatic void\nSiS_SetGroup3(struct SiS_Private *SiS_Pr, unsigned short ModeNo, unsigned short ModeIdIndex)\n{\n  unsigned short i;\n  const unsigned char *tempdi;\n\n  if(SiS_Pr->SiS_VBInfo & SetCRT2ToLCDA) return;\n\n#ifndef SIS_CP\n  SiS_SetReg(SiS_Pr->SiS_Part3Port,0x00,0x00);\n#else\n  SIS_CP_INIT301_CP\n#endif\n\n  if(SiS_Pr->SiS_TVMode & TVSetPAL) {\n     SiS_SetReg(SiS_Pr->SiS_Part3Port,0x13,0xFA);\n     SiS_SetReg(SiS_Pr->SiS_Part3Port,0x14,0xC8);\n  } else {\n     SiS_SetReg(SiS_Pr->SiS_Part3Port,0x13,0xF5);\n     SiS_SetReg(SiS_Pr->SiS_Part3Port,0x14,0xB7);\n  }\n\n  if(SiS_Pr->SiS_TVMode & TVSetPALM) {\n     SiS_SetReg(SiS_Pr->SiS_Part3Port,0x13,0xFA);\n     SiS_SetReg(SiS_Pr->SiS_Part3Port,0x14,0xC8);\n     SiS_SetReg(SiS_Pr->SiS_Part3Port,0x3D,0xA8);\n  }\n\n  tempdi = NULL;\n  if(SiS_Pr->SiS_VBInfo & SetCRT2ToHiVision) {\n     tempdi = SiS_Pr->SiS_HiTVGroup3Data;\n     if(SiS_Pr->SiS_TVMode & TVSetTVSimuMode) {\n        tempdi = SiS_Pr->SiS_HiTVGroup3Simu;\n     }\n  } else if(SiS_Pr->SiS_VBInfo & SetCRT2ToYPbPr525750) {\n     if(!(SiS_Pr->SiS_TVMode & TVSetYPbPr525i)) {\n        tempdi = SiS_HiTVGroup3_1;\n        if(SiS_Pr->SiS_TVMode & TVSetYPbPr750p) tempdi = SiS_HiTVGroup3_2;\n     }\n  }\n  if(tempdi) {\n     for(i=0; i<=0x3E; i++) {\n        SiS_SetReg(SiS_Pr->SiS_Part3Port,i,tempdi[i]);\n     }\n     if(SiS_Pr->SiS_VBType & VB_SIS30xCLV) {\n\tif(SiS_Pr->SiS_TVMode & TVSetYPbPr525p) {\n\t   SiS_SetReg(SiS_Pr->SiS_Part3Port,0x28,0x3f);\n\t}\n     }\n  }\n\n#ifdef SIS_CP\n  SIS_CP_INIT301_CP2\n#endif\n}\n\n \n \n \n\n#ifdef CONFIG_FB_SIS_315\n#if 0\nstatic void\nSiS_ShiftXPos(struct SiS_Private *SiS_Pr, int shift)\n{\n   unsigned short temp, temp1, temp2;\n\n   temp1 = SiS_GetReg(SiS_Pr->SiS_Part2Port,0x1f);\n   temp2 = SiS_GetReg(SiS_Pr->SiS_Part2Port,0x20);\n   temp = (unsigned short)((int)((temp1 | ((temp2 & 0xf0) << 4))) + shift);\n   SiS_SetReg(SiS_Pr->SiS_Part2Port,0x1f,temp);\n   SiS_SetRegANDOR(SiS_Pr->SiS_Part2Port,0x20,0x0f,((temp >> 4) & 0xf0));\n   temp = SiS_GetReg(SiS_Pr->SiS_Part2Port,0x2b) & 0x0f;\n   temp = (unsigned short)((int)(temp) + shift);\n   SiS_SetRegANDOR(SiS_Pr->SiS_Part2Port,0x2b,0xf0,(temp & 0x0f));\n   temp1 = SiS_GetReg(SiS_Pr->SiS_Part2Port,0x43);\n   temp2 = SiS_GetReg(SiS_Pr->SiS_Part2Port,0x42);\n   temp = (unsigned short)((int)((temp1 | ((temp2 & 0xf0) << 4))) + shift);\n   SiS_SetReg(SiS_Pr->SiS_Part2Port,0x43,temp);\n   SiS_SetRegANDOR(SiS_Pr->SiS_Part2Port,0x42,0x0f,((temp >> 4) & 0xf0));\n}\n#endif\n\nstatic void\nSiS_SetGroup4_C_ELV(struct SiS_Private *SiS_Pr, unsigned short ModeNo, unsigned short ModeIdIndex)\n{\n   unsigned short temp, temp1;\n   unsigned char  *ROMAddr = SiS_Pr->VirtualRomBase;\n\n   if(!(SiS_Pr->SiS_VBType & VB_SIS30xCLV)) return;\n   if(!(SiS_Pr->SiS_VBInfo & (SetCRT2ToHiVision | SetCRT2ToYPbPr525750))) return;\n\n   if(SiS_Pr->ChipType >= XGI_20) return;\n\n   if((SiS_Pr->ChipType >= SIS_661) && (SiS_Pr->SiS_ROMNew)) {\n      if(!(ROMAddr[0x61] & 0x04)) return;\n   }\n\n   SiS_SetRegOR(SiS_Pr->SiS_Part4Port,0x3a,0x08);\n   temp = SiS_GetReg(SiS_Pr->SiS_Part4Port,0x3a);\n   if(!(temp & 0x01)) {\n      SiS_SetRegAND(SiS_Pr->SiS_Part4Port,0x3a,0xdf);\n      SiS_SetRegAND(SiS_Pr->SiS_Part4Port,0x25,0xfc);\n      if((SiS_Pr->ChipType < SIS_661) && (!(SiS_Pr->SiS_ROMNew))) {\n         SiS_SetRegAND(SiS_Pr->SiS_Part4Port,0x25,0xf8);\n      }\n      SiS_SetRegAND(SiS_Pr->SiS_Part4Port,0x0f,0xfb);\n      if(SiS_Pr->SiS_TVMode & TVSetYPbPr750p)      temp = 0x0000;\n      else if(SiS_Pr->SiS_TVMode & TVSetYPbPr525p) temp = 0x0002;\n      else if(SiS_Pr->SiS_TVMode & TVSetHiVision)  temp = 0x0400;\n      else\t\t\t\t\t   temp = 0x0402;\n      if((SiS_Pr->ChipType >= SIS_661) || (SiS_Pr->SiS_ROMNew)) {\n         temp1 = 0;\n\t if(SiS_Pr->SiS_TVMode & TVAspect43) temp1 = 4;\n\t SiS_SetRegANDOR(SiS_Pr->SiS_Part4Port,0x0f,0xfb,temp1);\n\t if(SiS_Pr->SiS_TVMode & TVAspect43LB) temp |= 0x01;\n\t SiS_SetRegANDOR(SiS_Pr->SiS_Part4Port,0x26,0x7c,(temp & 0xff));\n\t SiS_SetRegANDOR(SiS_Pr->SiS_Part4Port,0x3a,0xfb,(temp >> 8));\n\t if(ModeNo > 0x13) {\n            SiS_SetRegAND(SiS_Pr->SiS_P3d4,0x39,0xfd);\n         }\n      } else {\n         temp1 = SiS_GetReg(SiS_Pr->SiS_P3d4,0x3b) & 0x03;\n\t if(temp1 == 0x01) temp |= 0x01;\n\t if(temp1 == 0x03) temp |= 0x04;   \n\t SiS_SetRegANDOR(SiS_Pr->SiS_Part4Port,0x26,0xf8,(temp & 0xff));\n\t SiS_SetRegANDOR(SiS_Pr->SiS_Part4Port,0x3a,0xfb,(temp >> 8));\n\t if(ModeNo > 0x13) {\n            SiS_SetRegAND(SiS_Pr->SiS_Part4Port,0x3b,0xfd);\n         }\n      }\n\n#if 0\n      if(SiS_Pr->ChipType >= SIS_661) { \t\t \n         if(SiS_Pr->SiS_TVMode & TVAspect43) {\n            if(SiS_Pr->SiS_TVMode & TVSetYPbPr750p) {\n\t       if(resinfo == SIS_RI_1024x768) {\n\t          SiS_ShiftXPos(SiS_Pr, 97);\n\t       } else {\n\t          SiS_ShiftXPos(SiS_Pr, 111);\n\t       }\n\t    } else if(SiS_Pr->SiS_TVMode & TVSetHiVision) {\n\t       SiS_ShiftXPos(SiS_Pr, 136);\n\t    }\n         }\n      }\n#endif\n\n   }\n\n}\n#endif\n\nstatic void\nSiS_SetCRT2VCLK(struct SiS_Private *SiS_Pr, unsigned short ModeNo, unsigned short ModeIdIndex,\n                 unsigned short RefreshRateTableIndex)\n{\n  unsigned short vclkindex, temp, reg1, reg2;\n\n  if(SiS_Pr->UseCustomMode) {\n     reg1 = SiS_Pr->CSR2B;\n     reg2 = SiS_Pr->CSR2C;\n  } else {\n     vclkindex = SiS_GetVCLK2Ptr(SiS_Pr, ModeNo, ModeIdIndex, RefreshRateTableIndex);\n     reg1 = SiS_Pr->SiS_VBVCLKData[vclkindex].Part4_A;\n     reg2 = SiS_Pr->SiS_VBVCLKData[vclkindex].Part4_B;\n  }\n\n  if(SiS_Pr->SiS_VBType & VB_SIS30xBLV) {\n     if(SiS_Pr->SiS_TVMode & (TVSetNTSC1024 | TVSet525p1024)) {\n        SiS_SetReg(SiS_Pr->SiS_Part4Port,0x0a,0x57);\n \tSiS_SetReg(SiS_Pr->SiS_Part4Port,0x0b,0x46);\n\tSiS_SetReg(SiS_Pr->SiS_Part4Port,0x1f,0xf6);\n     } else {\n        SiS_SetReg(SiS_Pr->SiS_Part4Port,0x0a,reg1);\n        SiS_SetReg(SiS_Pr->SiS_Part4Port,0x0b,reg2);\n     }\n  } else {\n     SiS_SetReg(SiS_Pr->SiS_Part4Port,0x0a,0x01);\n     SiS_SetReg(SiS_Pr->SiS_Part4Port,0x0b,reg2);\n     SiS_SetReg(SiS_Pr->SiS_Part4Port,0x0a,reg1);\n  }\n  SiS_SetReg(SiS_Pr->SiS_Part4Port,0x12,0x00);\n  temp = 0x08;\n  if(SiS_Pr->SiS_VBInfo & SetCRT2ToRAMDAC) temp |= 0x20;\n  SiS_SetRegOR(SiS_Pr->SiS_Part4Port,0x12,temp);\n}\n\nstatic void\nSiS_SetDualLinkEtc(struct SiS_Private *SiS_Pr)\n{\n  if(SiS_Pr->ChipType >= SIS_315H) {\n     if(SiS_Pr->SiS_VBType & VB_SISDUALLINK) {\n\tif((SiS_CRT2IsLCD(SiS_Pr)) ||\n\t   (SiS_IsVAMode(SiS_Pr))) {\n\t   if(SiS_Pr->SiS_LCDInfo & LCDDualLink) {\n\t      SiS_SetRegOR(SiS_Pr->SiS_Part4Port,0x27,0x2c);\n\t   } else {\n\t      SiS_SetRegAND(SiS_Pr->SiS_Part4Port,0x27,~0x20);\n\t   }\n\t}\n     }\n  }\n  if(SiS_Pr->SiS_VBType & VB_SISEMI) {\n     SiS_SetReg(SiS_Pr->SiS_Part4Port,0x2a,0x00);\n#ifdef SET_EMI\n     SiS_SetRegAND(SiS_Pr->SiS_Part4Port,0x30,0x0c);\n#endif\n     SiS_SetReg(SiS_Pr->SiS_Part4Port,0x34,0x10);\n  }\n}\n\nstatic void\nSiS_SetGroup4(struct SiS_Private *SiS_Pr, unsigned short ModeNo, unsigned short ModeIdIndex,\n\t\tunsigned short RefreshRateTableIndex)\n{\n  unsigned short tempax, tempcx, tempbx, modeflag, temp, resinfo;\n  unsigned int   tempebx, tempeax, templong;\n\n  if(ModeNo <= 0x13) {\n     modeflag = SiS_Pr->SiS_SModeIDTable[ModeIdIndex].St_ModeFlag;\n     resinfo = SiS_Pr->SiS_SModeIDTable[ModeIdIndex].St_ResInfo;\n  } else if(SiS_Pr->UseCustomMode) {\n     modeflag = SiS_Pr->CModeFlag;\n     resinfo = 0;\n  } else {\n     modeflag = SiS_Pr->SiS_EModeIDTable[ModeIdIndex].Ext_ModeFlag;\n     resinfo = SiS_Pr->SiS_EModeIDTable[ModeIdIndex].Ext_RESINFO;\n  }\n\n  if(SiS_Pr->ChipType >= SIS_315H) {\n     if(SiS_Pr->SiS_VBType & VB_SISLVDS) {\n\tif(SiS_Pr->SiS_VBInfo & SetCRT2ToLCDA) {\n\t   SiS_SetReg(SiS_Pr->SiS_Part4Port,0x24,0x0e);\n\t}\n     }\n  }\n\n  if(SiS_Pr->SiS_VBType & (VB_SIS30xCLV | VB_SIS302LV)) {\n     if(SiS_Pr->SiS_VBInfo & SetCRT2ToTV) {\n\tSiS_SetRegAND(SiS_Pr->SiS_Part4Port,0x10,0x9f);\n     }\n  }\n\n  if(SiS_Pr->ChipType >= SIS_315H) {\n     if(SiS_Pr->SiS_VBInfo & SetCRT2ToLCDA) {\n\tSiS_SetDualLinkEtc(SiS_Pr);\n\treturn;\n     }\n  }\n\n  SiS_SetReg(SiS_Pr->SiS_Part4Port,0x13,SiS_Pr->SiS_RVBHCFACT);\n\n  tempbx = SiS_Pr->SiS_RVBHCMAX;\n  SiS_SetReg(SiS_Pr->SiS_Part4Port,0x14,tempbx);\n\n  temp = (tempbx >> 1) & 0x80;\n\n  tempcx = SiS_Pr->SiS_VGAHT - 1;\n  SiS_SetReg(SiS_Pr->SiS_Part4Port,0x16,tempcx);\n\n  temp |= ((tempcx >> 5) & 0x78);\n\n  tempcx = SiS_Pr->SiS_VGAVT - 1;\n  if(!(SiS_Pr->SiS_VBInfo & SetCRT2ToTV)) tempcx -= 5;\n  SiS_SetReg(SiS_Pr->SiS_Part4Port,0x17,tempcx);\n\n  temp |= ((tempcx >> 8) & 0x07);\n  SiS_SetReg(SiS_Pr->SiS_Part4Port,0x15,temp);\n\n  tempbx = SiS_Pr->SiS_VGAHDE;\n  if(modeflag & HalfDCLK)    tempbx >>= 1;\n  if(SiS_IsDualLink(SiS_Pr)) tempbx >>= 1;\n\n  if(SiS_Pr->SiS_VBInfo & SetCRT2ToLCD) {\n     temp = 0;\n     if(tempbx > 800)        temp = 0x60;\n  } else if(SiS_Pr->SiS_VBInfo & SetCRT2ToHiVision) {\n     temp = 0;\n     if(tempbx > 1024)       temp = 0xC0;\n     else if(tempbx >= 960)  temp = 0xA0;\n  } else if(SiS_Pr->SiS_TVMode & (TVSetYPbPr525p | TVSetYPbPr750p)) {\n     temp = 0;\n     if(tempbx >= 1280)      temp = 0x40;\n     else if(tempbx >= 1024) temp = 0x20;\n  } else {\n     temp = 0x80;\n     if(tempbx >= 1024)      temp = 0xA0;\n  }\n\n  temp |= SiS_Pr->Init_P4_0E;\n\n  if(SiS_Pr->SiS_VBType & VB_SIS301) {\n     if(SiS_Pr->SiS_LCDResInfo != Panel_1280x1024) {\n        temp &= 0xf0;\n        temp |= 0x0A;\n     }\n  }\n\n  SiS_SetRegANDOR(SiS_Pr->SiS_Part4Port,0x0E,0x10,temp);\n\n  tempeax = SiS_Pr->SiS_VGAVDE;\n  tempebx = SiS_Pr->SiS_VDE;\n  if(SiS_Pr->SiS_VBInfo & SetCRT2ToHiVision) {\n     if(!(temp & 0xE0)) tempebx >>=1;\n  }\n\n  tempcx = SiS_Pr->SiS_RVBHRS;\n  SiS_SetReg(SiS_Pr->SiS_Part4Port,0x18,tempcx);\n  tempcx >>= 8;\n  tempcx |= 0x40;\n\n  if(tempeax <= tempebx) {\n     tempcx ^= 0x40;\n  } else {\n     tempeax -= tempebx;\n  }\n\n  tempeax *= (256 * 1024);\n  templong = tempeax % tempebx;\n  tempeax /= tempebx;\n  if(templong) tempeax++;\n\n  temp = (unsigned short)(tempeax & 0x000000FF);\n  SiS_SetReg(SiS_Pr->SiS_Part4Port,0x1B,temp);\n  temp = (unsigned short)((tempeax & 0x0000FF00) >> 8);\n  SiS_SetReg(SiS_Pr->SiS_Part4Port,0x1A,temp);\n  temp = (unsigned short)((tempeax >> 12) & 0x70);  \n  temp |= (tempcx & 0x4F);\n  SiS_SetReg(SiS_Pr->SiS_Part4Port,0x19,temp);\n\n  if(SiS_Pr->SiS_VBType & VB_SIS30xBLV) {\n\n     SiS_SetReg(SiS_Pr->SiS_Part4Port,0x1C,0x28);\n\n      \n     tempbx = 0;\n     if(SiS_Pr->SiS_TVMode & (TVSetHiVision | TVSetYPbPr750p)) tempbx = 0x08;\n     tempax = SiS_Pr->SiS_VGAHDE;\n     if(modeflag & HalfDCLK)    tempax >>= 1;\n     if(SiS_IsDualLink(SiS_Pr)) tempax >>= 1;\n     if(tempax > 800) {\n        if(SiS_Pr->SiS_VBInfo & SetCRT2ToLCD) {\n\t   tempax -= 800;\n\t} else {\n\t   tempbx = 0x08;\n\t   if(tempax == 960)\t   tempax *= 25;  \n           else if(tempax == 1024) tempax *= 25;\n           else\t\t\t   tempax *= 20;\n\t   temp = tempax % 32;\n\t   tempax /= 32;\n\t   if(temp) tempax++;\n\t   tempax++;\n\t   if(SiS_Pr->SiS_VBInfo & SetCRT2ToTV) {\n\t      if(resinfo == SIS_RI_1024x768 ||\n\t         resinfo == SIS_RI_1024x576 ||\n\t\t resinfo == SIS_RI_1280x1024 ||\n\t\t resinfo == SIS_RI_1280x720) {\n\t          \n\t         tempax = (tempax & 0xff00) | 0x20;\n\t      }\n\t   }\n\t}\n     }\n     tempax--;\n     temp = ((tempax >> 4) & 0x30) | tempbx;\n     SiS_SetReg(SiS_Pr->SiS_Part4Port,0x1D,tempax);\n     SiS_SetReg(SiS_Pr->SiS_Part4Port,0x1E,temp);\n\n     temp = 0x0036; tempbx = 0xD0;\n     if((SiS_Pr->ChipType >= SIS_315H) && (SiS_Pr->SiS_VBType & VB_SISLVDS)) {\n\ttemp = 0x0026; tempbx = 0xC0;  \n     }\n     if(SiS_Pr->SiS_VBInfo & SetCRT2ToTV) {\n        if(!(SiS_Pr->SiS_TVMode & (TVSetNTSC1024 | TVSetHiVision | TVSetYPbPr750p | TVSetYPbPr525p))) {\n\t   temp |= 0x01;\n\t   if(SiS_Pr->SiS_VBInfo & SetInSlaveMode) {\n\t      if(!(SiS_Pr->SiS_TVMode & TVSetTVSimuMode)) {\n  \t         temp &= ~0x01;\n\t      }\n\t   }\n\t}\n     }\n     SiS_SetRegANDOR(SiS_Pr->SiS_Part4Port,0x1F,tempbx,temp);\n\n     tempbx = SiS_Pr->SiS_HT >> 1;\n     if(SiS_IsDualLink(SiS_Pr)) tempbx >>= 1;\n     tempbx -= 2;\n     SiS_SetReg(SiS_Pr->SiS_Part4Port,0x22,tempbx);\n     temp = (tempbx >> 5) & 0x38;\n     SiS_SetRegANDOR(SiS_Pr->SiS_Part4Port,0x21,0xC0,temp);\n\n     if(SiS_Pr->SiS_VBType & VB_SISLVDS) {\n\tif(SiS_Pr->SiS_VBInfo & SetCRT2ToLCD) {\n           SiS_SetReg(SiS_Pr->SiS_Part4Port,0x24,0x0e);\n\t    \n\t}\n     }\n\n     SiS_SetDualLinkEtc(SiS_Pr);\n\n  }   \n\n  SiS_SetCRT2VCLK(SiS_Pr, ModeNo, ModeIdIndex, RefreshRateTableIndex);\n}\n\n \n \n \n\nstatic void\nSiS_SetGroup5(struct SiS_Private *SiS_Pr, unsigned short ModeNo, unsigned short ModeIdIndex)\n{\n\n  if(SiS_Pr->SiS_VBInfo & SetCRT2ToLCDA)  return;\n\n  if(SiS_Pr->SiS_ModeType == ModeVGA) {\n     if(!(SiS_Pr->SiS_VBInfo & (SetInSlaveMode | LoadDACFlag))) {\n        SiS_SetRegOR(SiS_Pr->SiS_P3c4,0x1E,0x20);\n        SiS_LoadDAC(SiS_Pr, ModeNo, ModeIdIndex);\n     }\n  }\n}\n\n \n \n \n\nstatic bool\nSiS_GetLVDSCRT1Ptr(struct SiS_Private *SiS_Pr, unsigned short ModeNo, unsigned short ModeIdIndex,\n\t\t   unsigned short RefreshRateTableIndex, unsigned short *ResIndex,\n\t\t   unsigned short *DisplayType)\n {\n  unsigned short modeflag = 0;\n  bool checkhd = true;\n\n   \n\n  if(ModeNo <= 0x13) {\n     modeflag = SiS_Pr->SiS_SModeIDTable[ModeIdIndex].St_ModeFlag;\n     (*ResIndex) = SiS_Pr->SiS_SModeIDTable[ModeIdIndex].St_CRT2CRTC;\n  } else {\n     modeflag = SiS_Pr->SiS_EModeIDTable[ModeIdIndex].Ext_ModeFlag;\n     (*ResIndex) = SiS_Pr->SiS_RefIndex[RefreshRateTableIndex].Ext_CRT2CRTC;\n  }\n\n  (*ResIndex) &= 0x3F;\n\n  if((SiS_Pr->SiS_IF_DEF_CH70xx) && (SiS_Pr->SiS_VBInfo & SetCRT2ToTV)) {\n\n     (*DisplayType) = 80;\n     if((SiS_Pr->SiS_TVMode & TVSetPAL) && (!(SiS_Pr->SiS_TVMode & TVSetPALM))) {\n      \t(*DisplayType) = 82;\n\tif(SiS_Pr->SiS_ModeType > ModeVGA) {\n\t   if(SiS_Pr->SiS_CHSOverScan) (*DisplayType) = 84;\n\t}\n     }\n     if((*DisplayType) != 84) {\n        if(SiS_Pr->SiS_TVMode & TVSetCHOverScan) (*DisplayType)++;\n     }\n\n  } else {\n\n     (*DisplayType = 0);\n     switch(SiS_Pr->SiS_LCDResInfo) {\n     case Panel_320x240_1: (*DisplayType) = 50;\n\t\t\t   checkhd = false;\n\t\t\t   break;\n     case Panel_320x240_2: (*DisplayType) = 14;\n\t\t\t   break;\n     case Panel_320x240_3: (*DisplayType) = 18;\n\t\t\t   break;\n     case Panel_640x480:   (*DisplayType) = 10;\n\t\t\t   break;\n     case Panel_1024x600:  (*DisplayType) = 26;\n\t\t\t   break;\n     default: return true;\n     }\n\n     if(checkhd) {\n        if(modeflag & HalfDCLK) (*DisplayType)++;\n     }\n\n     if(SiS_Pr->SiS_LCDResInfo == Panel_1024x600) {\n        if(SiS_Pr->SiS_LCDInfo & DontExpandLCD) (*DisplayType) += 2;\n     }\n\n  }\n\n  return true;\n}\n\nstatic void\nSiS_ModCRT1CRTC(struct SiS_Private *SiS_Pr, unsigned short ModeNo, unsigned short ModeIdIndex,\n                unsigned short RefreshRateTableIndex)\n{\n  unsigned short tempah, i, modeflag, j, ResIndex, DisplayType;\n  const struct SiS_LVDSCRT1Data *LVDSCRT1Ptr=NULL;\n  static const unsigned short CRIdx[] = {\n\t0x00, 0x02, 0x03, 0x04, 0x05, 0x06,\n\t0x07, 0x10, 0x11, 0x15, 0x16\n  };\n\n  if((SiS_Pr->SiS_CustomT == CUT_BARCO1366) ||\n     (SiS_Pr->SiS_CustomT == CUT_BARCO1024) ||\n     (SiS_Pr->SiS_CustomT == CUT_PANEL848)  ||\n     (SiS_Pr->SiS_CustomT == CUT_PANEL856) )\n     return;\n\n  if(SiS_Pr->SiS_IF_DEF_LVDS) {\n     if(!(SiS_Pr->SiS_VBInfo & SetCRT2ToLCDA)) {\n        if(!(SiS_Pr->SiS_VBInfo & SetInSlaveMode)) return;\n     }\n  } else if(SiS_Pr->SiS_VBType & VB_SISVB) {\n     if(!(SiS_Pr->SiS_VBInfo & SetInSlaveMode)) return;\n  } else return;\n\n  if(SiS_Pr->SiS_LCDInfo & LCDPass11) return;\n\n  if(SiS_Pr->ChipType < SIS_315H) {\n     if(SiS_Pr->SiS_SetFlag & SetDOSMode) return;\n  }\n\n  if(!(SiS_GetLVDSCRT1Ptr(SiS_Pr, ModeNo, ModeIdIndex, RefreshRateTableIndex,\n                          &ResIndex, &DisplayType))) {\n     return;\n  }\n\n  switch(DisplayType) {\n    case 50: LVDSCRT1Ptr = SiS_Pr->SiS_LVDSCRT1320x240_1;           break;  \n    case 14: LVDSCRT1Ptr = SiS_Pr->SiS_LVDSCRT1320x240_2;           break;  \n    case 15: LVDSCRT1Ptr = SiS_Pr->SiS_LVDSCRT1320x240_2_H;         break;  \n    case 18: LVDSCRT1Ptr = SiS_Pr->SiS_LVDSCRT1320x240_3;           break;  \n    case 19: LVDSCRT1Ptr = SiS_Pr->SiS_LVDSCRT1320x240_3_H;         break;  \n    case 10: LVDSCRT1Ptr = SiS_Pr->SiS_LVDSCRT1640x480_1;           break;\n    case 11: LVDSCRT1Ptr = SiS_Pr->SiS_LVDSCRT1640x480_1_H;         break;\n#if 0  \n    case 26: LVDSCRT1Ptr = SiS_Pr->SiS_LVDSCRT11024x600_1;          break;\n    case 27: LVDSCRT1Ptr = SiS_Pr->SiS_LVDSCRT11024x600_1_H;        break;\n    case 28: LVDSCRT1Ptr = SiS_Pr->SiS_LVDSCRT11024x600_2;          break;\n    case 29: LVDSCRT1Ptr = SiS_Pr->SiS_LVDSCRT11024x600_2_H;        break;\n#endif\n    case 80: LVDSCRT1Ptr = SiS_Pr->SiS_CHTVCRT1UNTSC;               break;\n    case 81: LVDSCRT1Ptr = SiS_Pr->SiS_CHTVCRT1ONTSC;               break;\n    case 82: LVDSCRT1Ptr = SiS_Pr->SiS_CHTVCRT1UPAL;                break;\n    case 83: LVDSCRT1Ptr = SiS_Pr->SiS_CHTVCRT1OPAL;                break;\n    case 84: LVDSCRT1Ptr = SiS_Pr->SiS_CHTVCRT1SOPAL;               break;\n  }\n\n  if(LVDSCRT1Ptr) {\n\n     SiS_SetRegAND(SiS_Pr->SiS_P3d4,0x11,0x7f);\n\n     for(i = 0; i <= 10; i++) {\n        tempah = (LVDSCRT1Ptr + ResIndex)->CR[i];\n        SiS_SetReg(SiS_Pr->SiS_P3d4,CRIdx[i],tempah);\n     }\n\n     for(i = 0x0A, j = 11; i <= 0x0C; i++, j++) {\n        tempah = (LVDSCRT1Ptr + ResIndex)->CR[j];\n        SiS_SetReg(SiS_Pr->SiS_P3c4,i,tempah);\n     }\n\n     tempah = (LVDSCRT1Ptr + ResIndex)->CR[14] & 0xE0;\n     SiS_SetRegANDOR(SiS_Pr->SiS_P3c4,0x0E,0x1f,tempah);\n\n     if(ModeNo <= 0x13) modeflag = SiS_Pr->SiS_SModeIDTable[ModeIdIndex].St_ModeFlag;\n     else               modeflag = SiS_Pr->SiS_EModeIDTable[ModeIdIndex].Ext_ModeFlag;\n\n     tempah = ((LVDSCRT1Ptr + ResIndex)->CR[14] & 0x01) << 5;\n     if(modeflag & DoubleScanMode) tempah |= 0x80;\n     SiS_SetRegANDOR(SiS_Pr->SiS_P3d4,0x09,~0x020,tempah);\n\n  } else {\n\n     SiS_CalcLCDACRT1Timing(SiS_Pr, ModeNo, ModeIdIndex);\n\n  }\n}\n\n \n \n \n\nstatic void\nSiS_SetCRT2ECLK(struct SiS_Private *SiS_Pr, unsigned short ModeNo, unsigned short ModeIdIndex,\n           unsigned short RefreshRateTableIndex)\n{\n  unsigned char  *ROMAddr = SiS_Pr->VirtualRomBase;\n  unsigned short clkbase, vclkindex = 0;\n  unsigned char  sr2b, sr2c;\n\n  if(SiS_Pr->SiS_LCDInfo & LCDPass11) {\n     SiS_Pr->SiS_SetFlag &= (~ProgrammingCRT2);\n     if(SiS_Pr->SiS_RefIndex[RefreshRateTableIndex].Ext_CRTVCLK == 2) {\n\tRefreshRateTableIndex--;\n     }\n     vclkindex = SiS_GetVCLK2Ptr(SiS_Pr, ModeNo, ModeIdIndex,\n                                    RefreshRateTableIndex);\n     SiS_Pr->SiS_SetFlag |= ProgrammingCRT2;\n  } else {\n     vclkindex = SiS_GetVCLK2Ptr(SiS_Pr, ModeNo, ModeIdIndex,\n                                    RefreshRateTableIndex);\n  }\n\n  sr2b = SiS_Pr->SiS_VCLKData[vclkindex].SR2B;\n  sr2c = SiS_Pr->SiS_VCLKData[vclkindex].SR2C;\n\n  if((SiS_Pr->SiS_CustomT == CUT_BARCO1366) || (SiS_Pr->SiS_CustomT == CUT_BARCO1024)) {\n     if(SiS_Pr->SiS_UseROM) {\n\tif(ROMAddr[0x220] & 0x01) {\n\t   sr2b = ROMAddr[0x227];\n\t   sr2c = ROMAddr[0x228];\n\t}\n     }\n  }\n\n  clkbase = 0x02B;\n  if(!(SiS_Pr->SiS_VBInfo & SetCRT2ToLCDA)) {\n     if(!(SiS_Pr->SiS_VBInfo & SetInSlaveMode)) {\n\tclkbase += 3;\n     }\n  }\n\n  SiS_SetReg(SiS_Pr->SiS_P3c4,0x31,0x20);\n  SiS_SetReg(SiS_Pr->SiS_P3c4,clkbase,sr2b);\n  SiS_SetReg(SiS_Pr->SiS_P3c4,clkbase+1,sr2c);\n  SiS_SetReg(SiS_Pr->SiS_P3c4,0x31,0x10);\n  SiS_SetReg(SiS_Pr->SiS_P3c4,clkbase,sr2b);\n  SiS_SetReg(SiS_Pr->SiS_P3c4,clkbase+1,sr2c);\n  SiS_SetReg(SiS_Pr->SiS_P3c4,0x31,0x00);\n  SiS_SetReg(SiS_Pr->SiS_P3c4,clkbase,sr2b);\n  SiS_SetReg(SiS_Pr->SiS_P3c4,clkbase+1,sr2c);\n}\n\n \n \n \n\nstatic void\nSiS_SetCHTVReg(struct SiS_Private *SiS_Pr, unsigned short ModeNo, unsigned short ModeIdIndex,\n               unsigned short RefreshRateTableIndex)\n{\n   unsigned short TVType, resindex;\n   const struct SiS_CHTVRegData *CHTVRegData = NULL;\n\n   if(ModeNo <= 0x13)\n      resindex = SiS_Pr->SiS_SModeIDTable[ModeIdIndex].St_CRT2CRTC;\n   else\n      resindex = SiS_Pr->SiS_RefIndex[RefreshRateTableIndex].Ext_CRT2CRTC;\n\n   resindex &= 0x3F;\n\n   TVType = 0;\n   if(SiS_Pr->SiS_TVMode & TVSetCHOverScan) TVType += 1;\n   if(SiS_Pr->SiS_TVMode & TVSetPAL) {\n      TVType += 2;\n      if(SiS_Pr->SiS_ModeType > ModeVGA) {\n\t if(SiS_Pr->SiS_CHSOverScan) TVType = 8;\n      }\n      if(SiS_Pr->SiS_TVMode & TVSetPALM) {\n\t TVType = 4;\n\t if(SiS_Pr->SiS_TVMode & TVSetCHOverScan) TVType += 1;\n      } else if(SiS_Pr->SiS_TVMode & TVSetPALN) {\n\t TVType = 6;\n\t if(SiS_Pr->SiS_TVMode & TVSetCHOverScan) TVType += 1;\n      }\n   }\n\n   switch(TVType) {\n      case  0: CHTVRegData = SiS_Pr->SiS_CHTVReg_UNTSC; break;\n      case  1: CHTVRegData = SiS_Pr->SiS_CHTVReg_ONTSC; break;\n      case  2: CHTVRegData = SiS_Pr->SiS_CHTVReg_UPAL;  break;\n      case  3: CHTVRegData = SiS_Pr->SiS_CHTVReg_OPAL;  break;\n      case  4: CHTVRegData = SiS_Pr->SiS_CHTVReg_UPALM; break;\n      case  5: CHTVRegData = SiS_Pr->SiS_CHTVReg_OPALM; break;\n      case  6: CHTVRegData = SiS_Pr->SiS_CHTVReg_UPALN; break;\n      case  7: CHTVRegData = SiS_Pr->SiS_CHTVReg_OPALN; break;\n      case  8: CHTVRegData = SiS_Pr->SiS_CHTVReg_SOPAL; break;\n      default: CHTVRegData = SiS_Pr->SiS_CHTVReg_OPAL;  break;\n   }\n\n\n   if(SiS_Pr->SiS_IF_DEF_CH70xx == 1) {\n\n#ifdef CONFIG_FB_SIS_300\n\n       \n\n       \n      if (resindex > 5) return;\n\n      if(SiS_Pr->SiS_TVMode & TVSetPAL) {\n\t SiS_SetCH700x(SiS_Pr,0x04,0x43);   \n\t SiS_SetCH700x(SiS_Pr,0x09,0x69);   \n      } else {\n\t SiS_SetCH700x(SiS_Pr,0x04,0x03);    \n\t SiS_SetCH700x(SiS_Pr,0x09,0x71);    \n      }\n\n      SiS_SetCH700x(SiS_Pr,0x00,CHTVRegData[resindex].Reg[0]);\t \n      SiS_SetCH700x(SiS_Pr,0x07,CHTVRegData[resindex].Reg[1]);\t \n      SiS_SetCH700x(SiS_Pr,0x08,CHTVRegData[resindex].Reg[2]);\t \n      SiS_SetCH700x(SiS_Pr,0x0a,CHTVRegData[resindex].Reg[3]);\t \n      SiS_SetCH700x(SiS_Pr,0x0b,CHTVRegData[resindex].Reg[4]);\t \n\n       \n      SiS_SetCH700x(SiS_Pr,0x01,0x28);\n\n       \n      SiS_SetCH700x(SiS_Pr,0x03,0xb1);        \n\n       \n#ifndef SIS_CP\n      SiS_SetCH70xx(SiS_Pr,0x3d,0x00);\n#endif\n\n       \n      SiS_SetCH70xxANDOR(SiS_Pr,0x10,0x00,0x1F);\n\n       \n      SiS_SetCH70xxANDOR(SiS_Pr,0x11,0x02,0xF8);\n\n       \n      SiS_SetCH70xxANDOR(SiS_Pr,0x1c,0x00,0xEF);\n\n      if(!(SiS_Pr->SiS_TVMode & TVSetPAL)) {\t\t \n         if(SiS_Pr->SiS_TVMode & TVSetCHOverScan) {\n            if(resindex == 0x04) {   \t\t\t \n      \t       SiS_SetCH70xxANDOR(SiS_Pr,0x20,0x00,0xEF);\t \n               SiS_SetCH70xxANDOR(SiS_Pr,0x21,0x01,0xFE);\t \n            } else if(resindex == 0x05) {    \t\t \n               SiS_SetCH70xxANDOR(SiS_Pr,0x18,0x01,0xF0);\t \n               SiS_SetCH70xxANDOR(SiS_Pr,0x19,0x0C,0xF0);\n               SiS_SetCH70xxANDOR(SiS_Pr,0x1a,0x00,0xF0);\n               SiS_SetCH70xxANDOR(SiS_Pr,0x1b,0x00,0xF0);\n               SiS_SetCH70xxANDOR(SiS_Pr,0x1c,0x00,0xF0);\n               SiS_SetCH70xxANDOR(SiS_Pr,0x1d,0x00,0xF0);\n               SiS_SetCH70xxANDOR(SiS_Pr,0x1e,0x00,0xF0);\n               SiS_SetCH70xxANDOR(SiS_Pr,0x1f,0x00,0xF0);\n               SiS_SetCH70xxANDOR(SiS_Pr,0x20,0x01,0xEF);\t \n               SiS_SetCH70xxANDOR(SiS_Pr,0x21,0x00,0xFE);\t \n            }\n         } else {\n            if(resindex == 0x04) {     \t\t\t \n               SiS_SetCH70xxANDOR(SiS_Pr,0x20,0x00,0xEF);\t \n               SiS_SetCH70xxANDOR(SiS_Pr,0x21,0x01,0xFE);\n            } else if(resindex == 0x05) {   \t\t \n#if 0\n               SiS_SetCH70xxANDOR(SiS_Pr,0x18,0x01,0xF0);\t \n               SiS_SetCH70xxANDOR(SiS_Pr,0x19,0x09,0xF0);\t \n               SiS_SetCH70xxANDOR(SiS_Pr,0x1a,0x08,0xF0);        \n               SiS_SetCH70xxANDOR(SiS_Pr,0x1b,0x0b,0xF0);\n               SiS_SetCH70xxANDOR(SiS_Pr,0x1c,0x04,0xF0);\n               SiS_SetCH70xxANDOR(SiS_Pr,0x1d,0x01,0xF0);\n               SiS_SetCH70xxANDOR(SiS_Pr,0x1e,0x06,0xF0);\n               SiS_SetCH70xxANDOR(SiS_Pr,0x1f,0x05,0xF0);\n               SiS_SetCH70xxANDOR(SiS_Pr,0x20,0x00,0xEF);\t \n               SiS_SetCH70xxANDOR(SiS_Pr,0x21,0x00,0xFE);\t* ACIV off, need to set FSCI */\n#endif          \n\t       SiS_SetCH70xxANDOR(SiS_Pr,0x20,0x00,0xEF);\t  \n               SiS_SetCH70xxANDOR(SiS_Pr,0x21,0x01,0xFE);\n            }\n         }\n      } else {\t\t\t\t\t\t \n\t \n\tSiS_SetCH70xxANDOR(SiS_Pr, 0x20, 0x00, 0xEF);\t \n\tSiS_SetCH70xxANDOR(SiS_Pr, 0x21, 0x01, 0xFE);\t \n      }\n\n#endif   \n\n   } else {\n\n       \n\n#ifdef CONFIG_FB_SIS_315\n\n      unsigned short temp;\n\n       \n      if (resindex > 6) return;\n\n      temp = CHTVRegData[resindex].Reg[0];\n      if(SiS_Pr->SiS_TVMode & TVSetNTSCJ) temp |= 0x10;\n      SiS_SetCH701x(SiS_Pr,0x00,temp);\n\n      SiS_SetCH701x(SiS_Pr,0x01,CHTVRegData[resindex].Reg[1]);\n      SiS_SetCH701x(SiS_Pr,0x02,CHTVRegData[resindex].Reg[2]);\n      SiS_SetCH701x(SiS_Pr,0x04,CHTVRegData[resindex].Reg[3]);\n      SiS_SetCH701x(SiS_Pr,0x03,CHTVRegData[resindex].Reg[4]);\n      SiS_SetCH701x(SiS_Pr,0x05,CHTVRegData[resindex].Reg[5]);\n      SiS_SetCH701x(SiS_Pr,0x06,CHTVRegData[resindex].Reg[6]);\n\n      temp = CHTVRegData[resindex].Reg[7];\n      if(SiS_Pr->SiS_TVMode & TVSetNTSCJ) temp = 0x66;\n      SiS_SetCH701x(SiS_Pr,0x07,temp);\n\n      SiS_SetCH701x(SiS_Pr,0x08,CHTVRegData[resindex].Reg[8]);\n      SiS_SetCH701x(SiS_Pr,0x15,CHTVRegData[resindex].Reg[9]);\n      SiS_SetCH701x(SiS_Pr,0x1f,CHTVRegData[resindex].Reg[10]);\n      SiS_SetCH701x(SiS_Pr,0x0c,CHTVRegData[resindex].Reg[11]);\n      SiS_SetCH701x(SiS_Pr,0x0d,CHTVRegData[resindex].Reg[12]);\n      SiS_SetCH701x(SiS_Pr,0x0e,CHTVRegData[resindex].Reg[13]);\n      SiS_SetCH701x(SiS_Pr,0x0f,CHTVRegData[resindex].Reg[14]);\n      SiS_SetCH701x(SiS_Pr,0x10,CHTVRegData[resindex].Reg[15]);\n\n      temp = SiS_GetCH701x(SiS_Pr,0x21) & ~0x02;\n       \n      if(SiS_Pr->SiS_TVMode & (TVSetPALN | TVSetNTSCJ)) temp |= 0x02;\n      SiS_SetCH701x(SiS_Pr,0x21,temp);\n\n#endif\t \n\n   }\n\n#ifdef SIS_CP\n   SIS_CP_INIT301_CP3\n#endif\n\n}\n\n#ifdef CONFIG_FB_SIS_315   \n\nvoid\nSiS_Chrontel701xBLOn(struct SiS_Private *SiS_Pr)\n{\n   unsigned short temp;\n\n    \n   if(SiS_Pr->SiS_IF_DEF_CH70xx == 2) {\n      if(SiS_Pr->ChipType == SIS_740) {\n\t SiS_SetCH701x(SiS_Pr,0x66,0x65);\n      } else {\n\t temp = SiS_GetCH701x(SiS_Pr,0x66);\n\t temp |= 0x20;\n\t SiS_SetCH701x(SiS_Pr,0x66,temp);\n      }\n   }\n}\n\nvoid\nSiS_Chrontel701xBLOff(struct SiS_Private *SiS_Pr)\n{\n   unsigned short temp;\n\n    \n   if(SiS_Pr->SiS_IF_DEF_CH70xx == 2) {\n      temp = SiS_GetCH701x(SiS_Pr,0x66);\n      temp &= 0xDF;\n      SiS_SetCH701x(SiS_Pr,0x66,temp);\n   }\n}\n\nstatic void\nSiS_ChrontelPowerSequencing(struct SiS_Private *SiS_Pr)\n{\n  static const unsigned char regtable[]      = { 0x67, 0x68, 0x69, 0x6a, 0x6b };\n  static const unsigned char table1024_740[] = { 0x01, 0x02, 0x01, 0x01, 0x01 };\n  static const unsigned char table1400_740[] = { 0x01, 0x6e, 0x01, 0x01, 0x01 };\n  static const unsigned char asus1024_740[]  = { 0x19, 0x6e, 0x01, 0x19, 0x09 };\n  static const unsigned char asus1400_740[]  = { 0x19, 0x6e, 0x01, 0x19, 0x09 };\n  static const unsigned char table1024_650[] = { 0x01, 0x02, 0x01, 0x01, 0x02 };\n  static const unsigned char table1400_650[] = { 0x01, 0x02, 0x01, 0x01, 0x02 };\n  const unsigned char *tableptr = NULL;\n  int i;\n\n   \n\n  if(SiS_Pr->ChipType == SIS_740) {\n     if(SiS_Pr->SiS_LCDResInfo == Panel_1024x768) {\n\tif(SiS_Pr->SiS_CustomT == CUT_ASUSL3000D) tableptr = asus1024_740;\n\telse    \t\t\t          tableptr = table1024_740;\n     } else if((SiS_Pr->SiS_LCDResInfo == Panel_1280x1024) ||\n\t       (SiS_Pr->SiS_LCDResInfo == Panel_1400x1050) ||\n\t       (SiS_Pr->SiS_LCDResInfo == Panel_1600x1200)) {\n\tif(SiS_Pr->SiS_CustomT == CUT_ASUSL3000D) tableptr = asus1400_740;\n        else\t\t\t\t\t  tableptr = table1400_740;\n     } else return;\n  } else {\n     if(SiS_Pr->SiS_LCDResInfo == Panel_1024x768) {\n\ttableptr = table1024_650;\n     } else if((SiS_Pr->SiS_LCDResInfo == Panel_1280x1024) ||\n\t       (SiS_Pr->SiS_LCDResInfo == Panel_1400x1050) ||\n\t       (SiS_Pr->SiS_LCDResInfo == Panel_1600x1200)) {\n\ttableptr = table1400_650;\n     } else return;\n  }\n\n  for(i=0; i<5; i++) {\n     SiS_SetCH701x(SiS_Pr, regtable[i], tableptr[i]);\n  }\n}\n\nstatic void\nSiS_SetCH701xForLCD(struct SiS_Private *SiS_Pr)\n{\n  const unsigned char *tableptr = NULL;\n  unsigned short tempbh;\n  int i;\n  static const unsigned char regtable[] = {\n\t\t0x1c, 0x5f, 0x64, 0x6f, 0x70, 0x71,\n\t\t0x72, 0x73, 0x74, 0x76, 0x78, 0x7d, 0x66\n  };\n  static const unsigned char table1024_740[] = {\n\t\t0x60, 0x02, 0x00, 0x07, 0x40, 0xed,\n\t\t0xa3, 0xc8, 0xc7, 0xac, 0xe0, 0x02, 0x44\n  };\n  static const unsigned char table1280_740[] = {\n\t\t0x60, 0x03, 0x11, 0x00, 0x40, 0xe3,\n\t\t0xad, 0xdb, 0xf6, 0xac, 0xe0, 0x02, 0x44\n  };\n  static const unsigned char table1400_740[] = {\n\t\t0x60, 0x03, 0x11, 0x00, 0x40, 0xe3,\n\t\t0xad, 0xdb, 0xf6, 0xac, 0xe0, 0x02, 0x44\n  };\n  static const unsigned char table1600_740[] = {\n\t\t0x60, 0x04, 0x11, 0x00, 0x40, 0xe3,\n\t\t0xad, 0xde, 0xf6, 0xac, 0x60, 0x1a, 0x44\n  };\n  static const unsigned char table1024_650[] = {\n\t\t0x60, 0x02, 0x00, 0x07, 0x40, 0xed,\n\t\t0xa3, 0xc8, 0xc7, 0xac, 0x60, 0x02\n  };\n  static const unsigned char table1280_650[] = {\n\t\t0x60, 0x03, 0x11, 0x00, 0x40, 0xe3,\n\t\t0xad, 0xdb, 0xf6, 0xac, 0xe0, 0x02\n  };\n  static const unsigned char table1400_650[] = {\n\t\t0x60, 0x03, 0x11, 0x00, 0x40, 0xef,\n\t\t0xad, 0xdb, 0xf6, 0xac, 0x60, 0x02\n  };\n  static const unsigned char table1600_650[] = {\n\t\t0x60, 0x04, 0x11, 0x00, 0x40, 0xe3,\n\t\t0xad, 0xde, 0xf6, 0xac, 0x60, 0x1a\n  };\n\n  if(SiS_Pr->ChipType == SIS_740) {\n     if(SiS_Pr->SiS_LCDResInfo == Panel_1024x768)       tableptr = table1024_740;\n     else if(SiS_Pr->SiS_LCDResInfo == Panel_1280x1024) tableptr = table1280_740;\n     else if(SiS_Pr->SiS_LCDResInfo == Panel_1400x1050) tableptr = table1400_740;\n     else if(SiS_Pr->SiS_LCDResInfo == Panel_1600x1200) tableptr = table1600_740;\n     else return;\n  } else {\n     if(SiS_Pr->SiS_LCDResInfo == Panel_1024x768)       tableptr = table1024_650;\n     else if(SiS_Pr->SiS_LCDResInfo == Panel_1280x1024) tableptr = table1280_650;\n     else if(SiS_Pr->SiS_LCDResInfo == Panel_1400x1050) tableptr = table1400_650;\n     else if(SiS_Pr->SiS_LCDResInfo == Panel_1600x1200) tableptr = table1600_650;\n     else return;\n  }\n\n  tempbh = SiS_GetCH701x(SiS_Pr,0x74);\n  if((tempbh == 0xf6) || (tempbh == 0xc7)) {\n     tempbh = SiS_GetCH701x(SiS_Pr,0x73);\n     if(tempbh == 0xc8) {\n        if(SiS_Pr->SiS_LCDResInfo == Panel_1024x768) return;\n     } else if(tempbh == 0xdb) {\n        if(SiS_Pr->SiS_LCDResInfo == Panel_1280x1024) return;\n\tif(SiS_Pr->SiS_LCDResInfo == Panel_1400x1050) return;\n     } else if(tempbh == 0xde) {\n        if(SiS_Pr->SiS_LCDResInfo == Panel_1600x1200) return;\n     }\n  }\n\n  if(SiS_Pr->ChipType == SIS_740) tempbh = 0x0d;\n  else     \t\t\t  tempbh = 0x0c;\n\n  for(i = 0; i < tempbh; i++) {\n     SiS_SetCH701x(SiS_Pr, regtable[i], tableptr[i]);\n  }\n  SiS_ChrontelPowerSequencing(SiS_Pr);\n  tempbh = SiS_GetCH701x(SiS_Pr,0x1e);\n  tempbh |= 0xc0;\n  SiS_SetCH701x(SiS_Pr,0x1e,tempbh);\n\n  if(SiS_Pr->ChipType == SIS_740) {\n     tempbh = SiS_GetCH701x(SiS_Pr,0x1c);\n     tempbh &= 0xfb;\n     SiS_SetCH701x(SiS_Pr,0x1c,tempbh);\n     SiS_SetReg(SiS_Pr->SiS_Part1Port,0x2d,0x03);\n     tempbh = SiS_GetCH701x(SiS_Pr,0x64);\n     tempbh |= 0x40;\n     SiS_SetCH701x(SiS_Pr,0x64,tempbh);\n     tempbh = SiS_GetCH701x(SiS_Pr,0x03);\n     tempbh &= 0x3f;\n     SiS_SetCH701x(SiS_Pr,0x03,tempbh);\n  }\n}\n\nstatic void\nSiS_ChrontelResetVSync(struct SiS_Private *SiS_Pr)\n{\n  unsigned char temp, temp1;\n\n  temp1 = SiS_GetCH701x(SiS_Pr,0x49);\n  SiS_SetCH701x(SiS_Pr,0x49,0x3e);\n  temp = SiS_GetCH701x(SiS_Pr,0x47);\n  temp &= 0x7f;\t \n  SiS_SetCH701x(SiS_Pr,0x47,temp);\n  SiS_LongDelay(SiS_Pr, 3);\n  temp = SiS_GetCH701x(SiS_Pr,0x47);\n  temp |= 0x80;\t \n  SiS_SetCH701x(SiS_Pr,0x47,temp);\n  SiS_SetCH701x(SiS_Pr,0x49,temp1);\n}\n\nstatic void\nSiS_Chrontel701xOn(struct SiS_Private *SiS_Pr)\n{\n  unsigned short temp;\n\n  if(SiS_Pr->SiS_IF_DEF_CH70xx == 2) {\n     if(SiS_Pr->ChipType == SIS_740) {\n        temp = SiS_GetCH701x(SiS_Pr,0x1c);\n        temp |= 0x04;\t \n        SiS_SetCH701x(SiS_Pr,0x1c,temp);\n     }\n     if(SiS_IsYPbPr(SiS_Pr)) {\n        temp = SiS_GetCH701x(SiS_Pr,0x01);\n\ttemp &= 0x3f;\n\ttemp |= 0x80;\t \n\tSiS_SetCH701x(SiS_Pr,0x01,temp);\n     }\n     if(SiS_IsChScart(SiS_Pr)) {\n        temp = SiS_GetCH701x(SiS_Pr,0x01);\n\ttemp &= 0x3f;\n\ttemp |= 0xc0;\t \n\tSiS_SetCH701x(SiS_Pr,0x01,temp);\n     }\n     if(SiS_Pr->ChipType == SIS_740) {\n        SiS_ChrontelResetVSync(SiS_Pr);\n        SiS_SetCH701x(SiS_Pr,0x49,0x20);    \n     } else {\n        SiS_SetCH701x(SiS_Pr,0x49,0x20);    \n        temp = SiS_GetCH701x(SiS_Pr,0x49);\n        if(SiS_IsYPbPr(SiS_Pr)) {\n           temp = SiS_GetCH701x(SiS_Pr,0x73);\n\t   temp |= 0x60;\n\t   SiS_SetCH701x(SiS_Pr,0x73,temp);\n        }\n        temp = SiS_GetCH701x(SiS_Pr,0x47);\n        temp &= 0x7f;\n        SiS_SetCH701x(SiS_Pr,0x47,temp);\n        SiS_LongDelay(SiS_Pr, 2);\n        temp = SiS_GetCH701x(SiS_Pr,0x47);\n        temp |= 0x80;\n        SiS_SetCH701x(SiS_Pr,0x47,temp);\n     }\n  }\n}\n\nstatic void\nSiS_Chrontel701xOff(struct SiS_Private *SiS_Pr)\n{\n  unsigned short temp;\n\n   \n  if(SiS_Pr->SiS_IF_DEF_CH70xx == 2) {\n     if(SiS_Pr->ChipType == SIS_740) {\n        SiS_LongDelay(SiS_Pr, 1);\n\tSiS_GenericDelay(SiS_Pr, 5887);\n\tSiS_SetCH701x(SiS_Pr,0x76,0xac);\n\tSiS_SetCH701x(SiS_Pr,0x66,0x00);\n     } else {\n        SiS_LongDelay(SiS_Pr, 2);\n\ttemp = SiS_GetCH701x(SiS_Pr,0x76);\n\ttemp &= 0xfc;\n\tSiS_SetCH701x(SiS_Pr,0x76,temp);\n\tSiS_SetCH701x(SiS_Pr,0x66,0x00);\n     }\n  }\n}\n\nstatic void\nSiS_ChrontelResetDB(struct SiS_Private *SiS_Pr)\n{\n     unsigned short temp;\n\n     if(SiS_Pr->ChipType == SIS_740) {\n\n        temp = SiS_GetCH701x(SiS_Pr,0x4a);   \n        temp &= 0x01;\n        if(!temp) {\n\n           if(SiS_WeHaveBacklightCtrl(SiS_Pr)) {\n\t      temp = SiS_GetCH701x(SiS_Pr,0x49);\n\t      SiS_SetCH701x(SiS_Pr,0x49,0x3e);\n\t   }\n\n\t    \n           SiS_SetCH701x(SiS_Pr,0x48,0x10);\n           SiS_LongDelay(SiS_Pr, 1);\n           SiS_SetCH701x(SiS_Pr,0x48,0x18);\n\n\t   if(SiS_WeHaveBacklightCtrl(SiS_Pr)) {\n\t      SiS_ChrontelResetVSync(SiS_Pr);\n\t      SiS_SetCH701x(SiS_Pr,0x49,temp);\n\t   }\n\n        } else {\n\n\t    \n           temp = SiS_GetCH701x(SiS_Pr,0x5c);\n\t   temp &= 0xef;\n\t   SiS_SetCH701x(SiS_Pr,0x5c,temp);\n\t   temp = SiS_GetCH701x(SiS_Pr,0x5c);\n\t   temp |= 0x10;\n\t   SiS_SetCH701x(SiS_Pr,0x5c,temp);\n\t   temp = SiS_GetCH701x(SiS_Pr,0x5c);\n\t   temp &= 0xef;\n\t   SiS_SetCH701x(SiS_Pr,0x5c,temp);\n\t   temp = SiS_GetCH701x(SiS_Pr,0x61);\n\t   if(!temp) {\n\t      SiS_SetCH701xForLCD(SiS_Pr);\n\t   }\n        }\n\n     } else {  \n         \n        SiS_SetCH701x(SiS_Pr,0x48,0x10);\n        SiS_LongDelay(SiS_Pr, 1);\n        SiS_SetCH701x(SiS_Pr,0x48,0x18);\n     }\n}\n\nstatic void\nSiS_ChrontelInitTVVSync(struct SiS_Private *SiS_Pr)\n{\n     unsigned short temp;\n\n     if(SiS_Pr->ChipType == SIS_740) {\n\n        if(SiS_WeHaveBacklightCtrl(SiS_Pr)) {\n           SiS_ChrontelResetVSync(SiS_Pr);\n        }\n\n     } else {\n\n        SiS_SetCH701x(SiS_Pr,0x76,0xaf);   \n        temp = SiS_GetCH701x(SiS_Pr,0x49);\n        temp &= 1;\n        if(temp != 1) {   \n\t   temp = SiS_GetCH701x(SiS_Pr,0x47);\n\t   temp &= 0x70;\n\t   SiS_SetCH701x(SiS_Pr,0x47,temp);   \n\t   SiS_LongDelay(SiS_Pr, 3);\n\t   temp = SiS_GetCH701x(SiS_Pr,0x47);\n\t   temp |= 0x80;\n\t   SiS_SetCH701x(SiS_Pr,0x47,temp);   \n        }\n\n     }\n}\n\nstatic void\nSiS_ChrontelDoSomething3(struct SiS_Private *SiS_Pr, unsigned short ModeNo)\n{\n     unsigned short temp,temp1;\n\n     if(SiS_Pr->ChipType == SIS_740) {\n\n        temp = SiS_GetCH701x(SiS_Pr,0x61);\n        if(temp < 1) {\n           temp++;\n\t   SiS_SetCH701x(SiS_Pr,0x61,temp);\n        }\n        SiS_SetCH701x(SiS_Pr,0x66,0x45);   \n        SiS_SetCH701x(SiS_Pr,0x76,0xaf);   \n        SiS_LongDelay(SiS_Pr, 1);\n        SiS_GenericDelay(SiS_Pr, 5887);\n\n     } else {   \n\n        temp1 = 0;\n        temp = SiS_GetCH701x(SiS_Pr,0x61);\n        if(temp < 2) {\n           temp++;\n\t   SiS_SetCH701x(SiS_Pr,0x61,temp);\n\t   temp1 = 1;\n        }\n        SiS_SetCH701x(SiS_Pr,0x76,0xac);\n        temp = SiS_GetCH701x(SiS_Pr,0x66);\n        temp |= 0x5f;\n        SiS_SetCH701x(SiS_Pr,0x66,temp);\n        if(ModeNo > 0x13) {\n           if(SiS_WeHaveBacklightCtrl(SiS_Pr)) {\n\t      SiS_GenericDelay(SiS_Pr, 1023);\n\t   } else {\n\t      SiS_GenericDelay(SiS_Pr, 767);\n\t   }\n        } else {\n           if(!temp1)\n\t      SiS_GenericDelay(SiS_Pr, 767);\n        }\n        temp = SiS_GetCH701x(SiS_Pr,0x76);\n        temp |= 0x03;\n        SiS_SetCH701x(SiS_Pr,0x76,temp);\n        temp = SiS_GetCH701x(SiS_Pr,0x66);\n        temp &= 0x7f;\n        SiS_SetCH701x(SiS_Pr,0x66,temp);\n        SiS_LongDelay(SiS_Pr, 1);\n\n     }\n}\n\nstatic void\nSiS_ChrontelDoSomething2(struct SiS_Private *SiS_Pr)\n{\n     unsigned short temp;\n\n     SiS_LongDelay(SiS_Pr, 1);\n\n     do {\n       temp = SiS_GetCH701x(SiS_Pr,0x66);\n       temp &= 0x04;   \n       if(temp == 0x04) break;\n\n       if(SiS_Pr->ChipType == SIS_740) {\n           \n          SiS_SetCH701x(SiS_Pr,0x76,0xac);\n       }\n\n       SiS_SetCH701xForLCD(SiS_Pr);\n\n       temp = SiS_GetCH701x(SiS_Pr,0x76);\n       temp &= 0xfb;   \n       SiS_SetCH701x(SiS_Pr,0x76,temp);\n       SiS_LongDelay(SiS_Pr, 2);\n       temp = SiS_GetCH701x(SiS_Pr,0x76);\n       temp |= 0x04;   \n       SiS_SetCH701x(SiS_Pr,0x76,temp);\n       if(SiS_Pr->ChipType == SIS_740) {\n          SiS_SetCH701x(SiS_Pr,0x78,0xe0);\t \n       } else {\n          SiS_SetCH701x(SiS_Pr,0x78,0x60);\n       }\n       SiS_LongDelay(SiS_Pr, 2);\n    } while(0);\n\n    SiS_SetCH701x(SiS_Pr,0x77,0x00);   \n}\n\nstatic void\nSiS_ChrontelDoSomething1(struct SiS_Private *SiS_Pr)\n{\n     unsigned short temp;\n\n     temp = SiS_GetCH701x(SiS_Pr,0x03);\n     temp |= 0x80;\t \n     temp &= 0xbf;\t \n     SiS_SetCH701x(SiS_Pr,0x03,temp);\n\n     if(SiS_Pr->ChipType == SIS_740) {\n\n        temp = SiS_GetCH701x(SiS_Pr,0x1c);\n        temp &= 0xfb;\t \n        SiS_SetCH701x(SiS_Pr,0x1c,temp);\n\n        SiS_SetReg(SiS_Pr->SiS_Part1Port,0x2d,0x03);\n\n        temp = SiS_GetCH701x(SiS_Pr,0x64);\n        temp |= 0x40;\t \n        SiS_SetCH701x(SiS_Pr,0x64,temp);\n\n        temp = SiS_GetCH701x(SiS_Pr,0x03);\n        temp &= 0x3f;\t \n        SiS_SetCH701x(SiS_Pr,0x03,temp);\n\n\tif(SiS_Pr->SiS_CustomT == CUT_ASUSL3000D) {\n\t   SiS_SetCH701x(SiS_Pr,0x63,0x40);  \n\t   SiS_LongDelay(SiS_Pr, 1);\n\t   SiS_SetCH701x(SiS_Pr,0x63,0x00);  \n\t   SiS_ChrontelResetDB(SiS_Pr);\n\t   SiS_ChrontelDoSomething2(SiS_Pr);\n\t   SiS_ChrontelDoSomething3(SiS_Pr, 0);\n\t} else {\n           temp = SiS_GetCH701x(SiS_Pr,0x66);\n           if(temp != 0x45) {\n              SiS_ChrontelResetDB(SiS_Pr);\n              SiS_ChrontelDoSomething2(SiS_Pr);\n              SiS_ChrontelDoSomething3(SiS_Pr, 0);\n           }\n\t}\n\n     } else {  \n\n        SiS_ChrontelResetDB(SiS_Pr);\n        SiS_ChrontelDoSomething2(SiS_Pr);\n        temp = SiS_GetReg(SiS_Pr->SiS_P3d4,0x34);\n        SiS_ChrontelDoSomething3(SiS_Pr,temp);\n        SiS_SetCH701x(SiS_Pr,0x76,0xaf);   \n\n     }\n\n}\n#endif   \n\n \n \n \n\nbool\nSiS_SetCRT2Group(struct SiS_Private *SiS_Pr, unsigned short ModeNo)\n{\n#ifdef CONFIG_FB_SIS_300\n   unsigned char  *ROMAddr  = SiS_Pr->VirtualRomBase;\n#endif\n   unsigned short ModeIdIndex, RefreshRateTableIndex;\n\n   SiS_Pr->SiS_SetFlag |= ProgrammingCRT2;\n\n   if(!SiS_Pr->UseCustomMode) {\n      SiS_SearchModeID(SiS_Pr, &ModeNo, &ModeIdIndex);\n   } else {\n      ModeIdIndex = 0;\n   }\n\n    \n   SiS_Pr->SiS_SelectCRT2Rate = 4;\n\n   SiS_UnLockCRT2(SiS_Pr);\n\n   RefreshRateTableIndex = SiS_GetRatePtr(SiS_Pr, ModeNo, ModeIdIndex);\n\n   SiS_SaveCRT2Info(SiS_Pr,ModeNo);\n\n   if(SiS_Pr->SiS_SetFlag & LowModeTests) {\n      SiS_DisableBridge(SiS_Pr);\n      if((SiS_Pr->SiS_IF_DEF_LVDS == 1) && (SiS_Pr->ChipType == SIS_730)) {\n         SiS_SetReg(SiS_Pr->SiS_Part1Port,0x00,0x80);\n      }\n      SiS_SetCRT2ModeRegs(SiS_Pr, ModeNo, ModeIdIndex);\n   }\n\n   if(SiS_Pr->SiS_VBInfo & DisableCRT2Display) {\n      SiS_LockCRT2(SiS_Pr);\n      SiS_DisplayOn(SiS_Pr);\n      return true;\n   }\n\n   SiS_GetCRT2Data(SiS_Pr, ModeNo, ModeIdIndex, RefreshRateTableIndex);\n\n    \n   SiS_Pr->SiS_LCDHDES = SiS_Pr->SiS_LCDVDES = 0;\n   if( (SiS_Pr->SiS_IF_DEF_LVDS == 1) ||\n       ((SiS_Pr->SiS_VBType & VB_NoLCD) && (SiS_Pr->SiS_VBInfo & SetCRT2ToLCD)) ||\n       ((SiS_Pr->ChipType >= SIS_315H) && (SiS_Pr->SiS_VBType & VB_SIS30xBLV)) ) {\n      SiS_GetLVDSDesData(SiS_Pr, ModeNo, ModeIdIndex, RefreshRateTableIndex);\n   }\n\n   if(SiS_Pr->SiS_SetFlag & LowModeTests) {\n      SiS_SetGroup1(SiS_Pr, ModeNo, ModeIdIndex, RefreshRateTableIndex);\n   }\n\n   if(SiS_Pr->SiS_VBType & VB_SISVB) {\n\n      if(SiS_Pr->SiS_SetFlag & LowModeTests) {\n\n\t SiS_SetGroup2(SiS_Pr, ModeNo, ModeIdIndex, RefreshRateTableIndex);\n#ifdef CONFIG_FB_SIS_315\n\t SiS_SetGroup2_C_ELV(SiS_Pr, ModeNo, ModeIdIndex, RefreshRateTableIndex);\n#endif\n\t SiS_SetGroup3(SiS_Pr, ModeNo, ModeIdIndex);\n\t SiS_SetGroup4(SiS_Pr, ModeNo, ModeIdIndex, RefreshRateTableIndex);\n#ifdef CONFIG_FB_SIS_315\n\t SiS_SetGroup4_C_ELV(SiS_Pr, ModeNo, ModeIdIndex);\n#endif\n\t SiS_SetGroup5(SiS_Pr, ModeNo, ModeIdIndex);\n\n\t SiS_SetCRT2Sync(SiS_Pr, ModeNo, RefreshRateTableIndex);\n\n\t  \n\t if((SiS_Pr->SiS_VBType & VB_NoLCD) && (SiS_Pr->SiS_VBInfo & SetCRT2ToLCD)) {\n\n\t    if(!((SiS_Pr->SiS_SetFlag & SetDOSMode) && ((ModeNo == 0x03) || (ModeNo == 0x10)))) {\n\t       if(SiS_Pr->SiS_VBInfo & SetInSlaveMode) {\n\t\t  SiS_ModCRT1CRTC(SiS_Pr, ModeNo, ModeIdIndex, RefreshRateTableIndex);\n\t       }\n            }\n\t    SiS_SetCRT2ECLK(SiS_Pr, ModeNo, ModeIdIndex, RefreshRateTableIndex);\n\t }\n      }\n\n   } else {\n\n      SiS_SetCRT2Sync(SiS_Pr, ModeNo, RefreshRateTableIndex);\n\n      SiS_ModCRT1CRTC(SiS_Pr,ModeNo,ModeIdIndex,RefreshRateTableIndex);\n\n      SiS_SetCRT2ECLK(SiS_Pr,ModeNo,ModeIdIndex,RefreshRateTableIndex);\n\n      if(SiS_Pr->SiS_SetFlag & LowModeTests) {\n\t if(SiS_Pr->SiS_IF_DEF_CH70xx != 0) {\n\t    if(SiS_Pr->SiS_VBInfo & (SetCRT2ToLCD | SetCRT2ToLCDA)) {\n\t       if(SiS_Pr->SiS_IF_DEF_CH70xx == 2) {\n#ifdef CONFIG_FB_SIS_315\n\t\t  SiS_SetCH701xForLCD(SiS_Pr);\n#endif\n\t       }\n\t    }\n\t    if(SiS_Pr->SiS_VBInfo & SetCRT2ToTV) {\n\t       SiS_SetCHTVReg(SiS_Pr,ModeNo,ModeIdIndex,RefreshRateTableIndex);\n\t    }\n\t }\n      }\n\n   }\n\n#ifdef CONFIG_FB_SIS_300\n   if(SiS_Pr->ChipType < SIS_315H) {\n      if(SiS_Pr->SiS_SetFlag & LowModeTests) {\n\t if(SiS_Pr->SiS_UseOEM) {\n\t    if((SiS_Pr->SiS_UseROM) && (SiS_Pr->SiS_UseOEM == -1)) {\n\t       if((ROMAddr[0x233] == 0x12) && (ROMAddr[0x234] == 0x34)) {\n\t\t  SiS_OEM300Setting(SiS_Pr, ModeNo, ModeIdIndex, RefreshRateTableIndex);\n\t       }\n\t    } else {\n\t       SiS_OEM300Setting(SiS_Pr, ModeNo, ModeIdIndex, RefreshRateTableIndex);\n\t    }\n\t }\n\t if(SiS_Pr->SiS_IF_DEF_LVDS == 1) {\n\t    if((SiS_Pr->SiS_CustomT == CUT_BARCO1366) ||\n\t       (SiS_Pr->SiS_CustomT == CUT_BARCO1024)) {\n\t       SetOEMLCDData2(SiS_Pr, ModeNo, ModeIdIndex,RefreshRateTableIndex);\n\t    }\n\t    SiS_DisplayOn(SiS_Pr);\n         }\n      }\n   }\n#endif\n\n#ifdef CONFIG_FB_SIS_315\n   if(SiS_Pr->ChipType >= SIS_315H) {\n      if(SiS_Pr->SiS_SetFlag & LowModeTests) {\n\t if(SiS_Pr->ChipType < SIS_661) {\n\t    SiS_FinalizeLCD(SiS_Pr, ModeNo, ModeIdIndex);\n\t    SiS_OEM310Setting(SiS_Pr, ModeNo, ModeIdIndex, RefreshRateTableIndex);\n\t } else {\n\t    SiS_OEM661Setting(SiS_Pr, ModeNo, ModeIdIndex, RefreshRateTableIndex);\n\t }\n\t SiS_SetRegOR(SiS_Pr->SiS_Part1Port,0x01,0x40);\n      }\n   }\n#endif\n\n   if(SiS_Pr->SiS_SetFlag & LowModeTests) {\n      SiS_EnableBridge(SiS_Pr);\n   }\n\n   SiS_DisplayOn(SiS_Pr);\n\n   if(SiS_Pr->SiS_IF_DEF_CH70xx == 1) {\n      if(SiS_Pr->SiS_VBInfo & SetCRT2ToTV) {\n\t  \n\t SiS_SetRegSR11ANDOR(SiS_Pr,0xFF,0x0C);\n      } else {\n\t  \n\t SiS_SetCH70xxANDOR(SiS_Pr,0x0e,0x01,0xf8);\n      }\n   }\n\n   if(SiS_Pr->SiS_SetFlag & LowModeTests) {\n      SiS_LockCRT2(SiS_Pr);\n   }\n\n   return true;\n}\n\n\n \n \n \n\nvoid\nSiS_SiS30xBLOn(struct SiS_Private *SiS_Pr)\n{\n   \n  SiS_DDC2Delay(SiS_Pr,0xff00);\n  if(!(SiS_GetReg(SiS_Pr->SiS_Part4Port,0x26) & 0x02)) {\n     SiS_SetRegOR(SiS_Pr->SiS_Part4Port,0x26,0x02);\n     SiS_WaitVBRetrace(SiS_Pr);\n  }\n  if(!(SiS_GetReg(SiS_Pr->SiS_Part4Port,0x26) & 0x01)) {\n     SiS_SetRegOR(SiS_Pr->SiS_Part4Port,0x26,0x01);\n  }\n}\n\nvoid\nSiS_SiS30xBLOff(struct SiS_Private *SiS_Pr)\n{\n   \n  SiS_SetRegAND(SiS_Pr->SiS_Part4Port,0x26,0xFE);\n  SiS_DDC2Delay(SiS_Pr,0xff00);\n}\n\n \n \n \n\nstatic void\nSiS_SetupDDCN(struct SiS_Private *SiS_Pr)\n{\n  SiS_Pr->SiS_DDC_NData = ~SiS_Pr->SiS_DDC_Data;\n  SiS_Pr->SiS_DDC_NClk  = ~SiS_Pr->SiS_DDC_Clk;\n  if((SiS_Pr->SiS_DDC_Index == 0x11) && (SiS_Pr->SiS_SensibleSR11)) {\n     SiS_Pr->SiS_DDC_NData &= 0x0f;\n     SiS_Pr->SiS_DDC_NClk  &= 0x0f;\n  }\n}\n\n#ifdef CONFIG_FB_SIS_300\nstatic unsigned char *\nSiS_SetTrumpBlockLoop(struct SiS_Private *SiS_Pr, unsigned char *dataptr)\n{\n  int i, j, num;\n  unsigned short tempah,temp;\n  unsigned char *mydataptr;\n\n  for(i=0; i<20; i++) {\t\t\t\t \n     mydataptr = dataptr;\n     num = *mydataptr++;\n     if(!num) return mydataptr;\n     if(i) {\n        SiS_SetStop(SiS_Pr);\n\tSiS_DDC2Delay(SiS_Pr,SiS_I2CDELAYSHORT * 2);\n     }\n     if(SiS_SetStart(SiS_Pr)) continue;\t\t \n     tempah = SiS_Pr->SiS_DDC_DeviceAddr;\n     temp = SiS_WriteDDC2Data(SiS_Pr,tempah);\t \n     if(temp) continue;\t\t\t\t \n     tempah = *mydataptr++;\n     temp = SiS_WriteDDC2Data(SiS_Pr,tempah);\t \n     if(temp) continue;\t\t\t\t \n     for(j=0; j<num; j++) {\n        tempah = *mydataptr++;\n        temp = SiS_WriteDDC2Data(SiS_Pr,tempah); \n\tif(temp) break;\n     }\n     if(temp) continue;\n     if(SiS_SetStop(SiS_Pr)) continue;\n     return mydataptr;\n  }\n  return NULL;\n}\n\nstatic bool\nSiS_SetTrumpionBlock(struct SiS_Private *SiS_Pr, unsigned char *dataptr)\n{\n  SiS_Pr->SiS_DDC_DeviceAddr = 0xF0;  \t\t \n  SiS_Pr->SiS_DDC_Index = 0x11;\t\t\t \n  SiS_Pr->SiS_DDC_Data  = 0x02;\t\t\t \n  SiS_Pr->SiS_DDC_Clk   = 0x01;\t\t\t \n  SiS_SetupDDCN(SiS_Pr);\n\n  SiS_SetSwitchDDC2(SiS_Pr);\n\n  while(*dataptr) {\n     dataptr = SiS_SetTrumpBlockLoop(SiS_Pr, dataptr);\n     if(!dataptr) return false;\n  }\n  return true;\n}\n#endif\n\n \n\nstatic bool\nSiS_SetChReg(struct SiS_Private *SiS_Pr, unsigned short reg, unsigned char val, unsigned short myor)\n{\n  unsigned short temp, i;\n\n  for(i=0; i<20; i++) {\t\t\t\t \n     if(i) {\n\tSiS_SetStop(SiS_Pr);\n\tSiS_DDC2Delay(SiS_Pr,SiS_I2CDELAYSHORT * 4);\n     }\n     if(SiS_SetStart(SiS_Pr)) continue;\t\t\t\t\t \n     temp = SiS_WriteDDC2Data(SiS_Pr, SiS_Pr->SiS_DDC_DeviceAddr);\t \n     if(temp) continue;\t\t\t\t\t\t\t \n     temp = SiS_WriteDDC2Data(SiS_Pr, (reg | myor));\t\t\t \n     if(temp) continue;\t\t\t\t\t\t\t \n     temp = SiS_WriteDDC2Data(SiS_Pr, val);\t\t\t\t \n     if(temp) continue;\t\t\t\t\t\t\t \n     if(SiS_SetStop(SiS_Pr)) continue;\t\t\t\t\t \n     SiS_Pr->SiS_ChrontelInit = 1;\n     return true;\n  }\n  return false;\n}\n\n \nvoid\nSiS_SetCH700x(struct SiS_Private *SiS_Pr, unsigned short reg, unsigned char val)\n{\n  SiS_Pr->SiS_DDC_DeviceAddr = 0xEA;  \t\t \n\n  SiS_DDC2Delay(SiS_Pr,SiS_I2CDELAYSHORT);\n\n  if(!(SiS_Pr->SiS_ChrontelInit)) {\n     SiS_Pr->SiS_DDC_Index = 0x11;\t\t \n     SiS_Pr->SiS_DDC_Data  = 0x02;\t\t \n     SiS_Pr->SiS_DDC_Clk   = 0x01;\t\t \n     SiS_SetupDDCN(SiS_Pr);\n  }\n\n  if( (!(SiS_SetChReg(SiS_Pr, reg, val, 0x80))) &&\n      (!(SiS_Pr->SiS_ChrontelInit)) ) {\n     SiS_Pr->SiS_DDC_Index = 0x0a;\n     SiS_Pr->SiS_DDC_Data  = 0x80;\n     SiS_Pr->SiS_DDC_Clk   = 0x40;\n     SiS_SetupDDCN(SiS_Pr);\n\n     SiS_SetChReg(SiS_Pr, reg, val, 0x80);\n  }\n}\n\n \n \nvoid\nSiS_SetCH701x(struct SiS_Private *SiS_Pr, unsigned short reg, unsigned char val)\n{\n  SiS_Pr->SiS_DDC_Index = 0x11;\t\t\t \n  SiS_Pr->SiS_DDC_Data  = 0x08;\t\t\t \n  SiS_Pr->SiS_DDC_Clk   = 0x04;\t\t\t \n  SiS_SetupDDCN(SiS_Pr);\n  SiS_Pr->SiS_DDC_DeviceAddr = 0xEA;\t\t \n  SiS_SetChReg(SiS_Pr, reg, val, 0);\n}\n\nstatic\nvoid\nSiS_SetCH70xx(struct SiS_Private *SiS_Pr, unsigned short reg, unsigned char val)\n{\n  if(SiS_Pr->SiS_IF_DEF_CH70xx == 1)\n     SiS_SetCH700x(SiS_Pr, reg, val);\n  else\n     SiS_SetCH701x(SiS_Pr, reg, val);\n}\n\nstatic unsigned short\nSiS_GetChReg(struct SiS_Private *SiS_Pr, unsigned short myor)\n{\n  unsigned short tempah, temp, i;\n\n  for(i=0; i<20; i++) {\t\t\t\t \n     if(i) {\n\tSiS_SetStop(SiS_Pr);\n\tSiS_DDC2Delay(SiS_Pr,SiS_I2CDELAYSHORT * 4);\n     }\n     if(SiS_SetStart(SiS_Pr)) continue;\t\t\t\t\t \n     temp = SiS_WriteDDC2Data(SiS_Pr,SiS_Pr->SiS_DDC_DeviceAddr);\t \n     if(temp) continue;\t\t\t\t\t\t\t \n     temp = SiS_WriteDDC2Data(SiS_Pr,SiS_Pr->SiS_DDC_ReadAddr | myor);\t \n     if(temp) continue;\t\t\t\t\t\t\t \n     if (SiS_SetStart(SiS_Pr)) continue;\t\t\t\t \n     temp = SiS_WriteDDC2Data(SiS_Pr,SiS_Pr->SiS_DDC_DeviceAddr | 0x01); \n     if(temp) continue;\t\t\t\t\t\t\t \n     tempah = SiS_ReadDDC2Data(SiS_Pr);\t\t\t\t\t \n     if(SiS_SetStop(SiS_Pr)) continue;\t\t\t\t\t \n     SiS_Pr->SiS_ChrontelInit = 1;\n     return tempah;\n  }\n  return 0xFFFF;\n}\n\n \n \nunsigned short\nSiS_GetCH700x(struct SiS_Private *SiS_Pr, unsigned short tempbx)\n{\n  unsigned short result;\n\n  SiS_Pr->SiS_DDC_DeviceAddr = 0xEA;\t\t \n\n  SiS_DDC2Delay(SiS_Pr,SiS_I2CDELAYSHORT);\n\n  if(!(SiS_Pr->SiS_ChrontelInit)) {\n     SiS_Pr->SiS_DDC_Index = 0x11;\t\t \n     SiS_Pr->SiS_DDC_Data  = 0x02;\t\t \n     SiS_Pr->SiS_DDC_Clk   = 0x01;\t\t \n     SiS_SetupDDCN(SiS_Pr);\n  }\n\n  SiS_Pr->SiS_DDC_ReadAddr = tempbx;\n\n  if( ((result = SiS_GetChReg(SiS_Pr,0x80)) == 0xFFFF) &&\n      (!SiS_Pr->SiS_ChrontelInit) ) {\n\n     SiS_Pr->SiS_DDC_Index = 0x0a;\n     SiS_Pr->SiS_DDC_Data  = 0x80;\n     SiS_Pr->SiS_DDC_Clk   = 0x40;\n     SiS_SetupDDCN(SiS_Pr);\n\n     result = SiS_GetChReg(SiS_Pr,0x80);\n  }\n  return result;\n}\n\n \n \nunsigned short\nSiS_GetCH701x(struct SiS_Private *SiS_Pr, unsigned short tempbx)\n{\n  SiS_Pr->SiS_DDC_Index = 0x11;\t\t\t \n  SiS_Pr->SiS_DDC_Data  = 0x08;\t\t\t \n  SiS_Pr->SiS_DDC_Clk   = 0x04;\t\t\t \n  SiS_SetupDDCN(SiS_Pr);\n  SiS_Pr->SiS_DDC_DeviceAddr = 0xEA;\t\t \n\n  SiS_Pr->SiS_DDC_ReadAddr = tempbx;\n\n  return SiS_GetChReg(SiS_Pr,0);\n}\n\n \n \nstatic\nunsigned short\nSiS_GetCH70xx(struct SiS_Private *SiS_Pr, unsigned short tempbx)\n{\n  if(SiS_Pr->SiS_IF_DEF_CH70xx == 1)\n     return SiS_GetCH700x(SiS_Pr, tempbx);\n  else\n     return SiS_GetCH701x(SiS_Pr, tempbx);\n}\n\nvoid\nSiS_SetCH70xxANDOR(struct SiS_Private *SiS_Pr, unsigned short reg,\n\t\tunsigned char myor, unsigned short myand)\n{\n  unsigned short tempbl;\n\n  tempbl = (SiS_GetCH70xx(SiS_Pr, (reg & 0xFF)) & myand) | myor;\n  SiS_SetCH70xx(SiS_Pr, reg, tempbl);\n}\n\n \nstatic\nunsigned short\nSiS_InitDDCRegs(struct SiS_Private *SiS_Pr, unsigned int VBFlags, int VGAEngine,\n                unsigned short adaptnum, unsigned short DDCdatatype, bool checkcr32,\n\t\tunsigned int VBFlags2)\n{\n     unsigned char ddcdtype[] = { 0xa0, 0xa0, 0xa0, 0xa2, 0xa6 };\n     unsigned char flag, cr32;\n     unsigned short        temp = 0, myadaptnum = adaptnum;\n\n     if(adaptnum != 0) {\n\tif(!(VBFlags2 & VB2_SISTMDSBRIDGE)) return 0xFFFF;\n\tif((VBFlags2 & VB2_30xBDH) && (adaptnum == 1)) return 0xFFFF;\n     }\n\n      \n\n     SiS_Pr->SiS_ChrontelInit = 0;    \n\n     SiS_Pr->SiS_DDC_SecAddr = 0;\n     SiS_Pr->SiS_DDC_DeviceAddr = ddcdtype[DDCdatatype];\n     SiS_Pr->SiS_DDC_Port = SiS_Pr->SiS_P3c4;\n     SiS_Pr->SiS_DDC_Index = 0x11;\n     flag = 0xff;\n\n     cr32 = SiS_GetReg(SiS_Pr->SiS_P3d4,0x32);\n\n#if 0\n     if(VBFlags2 & VB2_SISBRIDGE) {\n\tif(myadaptnum == 0) {\n\t   if(!(cr32 & 0x20)) {\n\t      myadaptnum = 2;\n\t      if(!(cr32 & 0x10)) {\n\t         myadaptnum = 1;\n\t\t if(!(cr32 & 0x08)) {\n\t\t    myadaptnum = 0;\n\t\t }\n\t      }\n\t   }\n        }\n     }\n#endif\n\n     if(VGAEngine == SIS_300_VGA) {\t\t \n\n        if(myadaptnum != 0) {\n\t   flag = 0;\n\t   if(VBFlags2 & VB2_SISBRIDGE) {\n\t      SiS_Pr->SiS_DDC_Port = SiS_Pr->SiS_Part4Port;\n              SiS_Pr->SiS_DDC_Index = 0x0f;\n\t   }\n        }\n\n\tif(!(VBFlags2 & VB2_301)) {\n\t   if((cr32 & 0x80) && (checkcr32)) {\n              if(myadaptnum >= 1) {\n\t         if(!(cr32 & 0x08)) {\n\t\t     myadaptnum = 1;\n\t\t     if(!(cr32 & 0x10)) return 0xFFFF;\n                 }\n\t      }\n\t   }\n\t}\n\n\ttemp = 4 - (myadaptnum * 2);\n\tif(flag) temp = 0;\n\n     } else {\t\t\t\t\t\t \n\n\t \n\n\tif(VBFlags2 & VB2_SISBRIDGE) {\n\t   if(myadaptnum == 2) {\n\t      myadaptnum = 1;\n\t   }\n\t}\n\n        if(myadaptnum == 1) {\n\t   flag = 0;\n\t   if(VBFlags2 & VB2_SISBRIDGE) {\n\t      SiS_Pr->SiS_DDC_Port = SiS_Pr->SiS_Part4Port;\n              SiS_Pr->SiS_DDC_Index = 0x0f;\n\t   }\n        }\n\n        if((cr32 & 0x80) && (checkcr32)) {\n           if(myadaptnum >= 1) {\n\t      if(!(cr32 & 0x08)) {\n\t         myadaptnum = 1;\n\t\t if(!(cr32 & 0x10)) return 0xFFFF;\n\t      }\n\t   }\n        }\n\n        temp = myadaptnum;\n        if(myadaptnum == 1) {\n           temp = 0;\n\t   if(VBFlags2 & VB2_LVDS) flag = 0xff;\n        }\n\n\tif(flag) temp = 0;\n    }\n\n    SiS_Pr->SiS_DDC_Data = 0x02 << temp;\n    SiS_Pr->SiS_DDC_Clk  = 0x01 << temp;\n\n    SiS_SetupDDCN(SiS_Pr);\n\n    return 0;\n}\n\nstatic unsigned short\nSiS_WriteDABDDC(struct SiS_Private *SiS_Pr)\n{\n   if(SiS_SetStart(SiS_Pr)) return 0xFFFF;\n   if(SiS_WriteDDC2Data(SiS_Pr, SiS_Pr->SiS_DDC_DeviceAddr)) {\n      return 0xFFFF;\n   }\n   if(SiS_WriteDDC2Data(SiS_Pr, SiS_Pr->SiS_DDC_SecAddr)) {\n      return 0xFFFF;\n   }\n   return 0;\n}\n\nstatic unsigned short\nSiS_PrepareReadDDC(struct SiS_Private *SiS_Pr)\n{\n   if(SiS_SetStart(SiS_Pr)) return 0xFFFF;\n   if(SiS_WriteDDC2Data(SiS_Pr, (SiS_Pr->SiS_DDC_DeviceAddr | 0x01))) {\n      return 0xFFFF;\n   }\n   return 0;\n}\n\nstatic unsigned short\nSiS_PrepareDDC(struct SiS_Private *SiS_Pr)\n{\n   if(SiS_WriteDABDDC(SiS_Pr)) SiS_WriteDABDDC(SiS_Pr);\n   if(SiS_PrepareReadDDC(SiS_Pr)) return (SiS_PrepareReadDDC(SiS_Pr));\n   return 0;\n}\n\nstatic void\nSiS_SendACK(struct SiS_Private *SiS_Pr, unsigned short yesno)\n{\n   SiS_SetSCLKLow(SiS_Pr);\n   if(yesno) {\n      SiS_SetRegANDOR(SiS_Pr->SiS_DDC_Port,\n\t\t      SiS_Pr->SiS_DDC_Index,\n\t\t      SiS_Pr->SiS_DDC_NData,\n\t\t      SiS_Pr->SiS_DDC_Data);\n   } else {\n      SiS_SetRegANDOR(SiS_Pr->SiS_DDC_Port,\n\t\t      SiS_Pr->SiS_DDC_Index,\n\t\t      SiS_Pr->SiS_DDC_NData,\n\t\t      0);\n   }\n   SiS_SetSCLKHigh(SiS_Pr);\n}\n\nstatic unsigned short\nSiS_DoProbeDDC(struct SiS_Private *SiS_Pr)\n{\n    unsigned char mask, value;\n    unsigned short  temp, ret=0;\n    bool failed = false;\n\n    SiS_SetSwitchDDC2(SiS_Pr);\n    if(SiS_PrepareDDC(SiS_Pr)) {\n         SiS_SetStop(SiS_Pr);\n         return 0xFFFF;\n    }\n    mask = 0xf0;\n    value = 0x20;\n    if(SiS_Pr->SiS_DDC_DeviceAddr == 0xa0) {\n       temp = (unsigned char)SiS_ReadDDC2Data(SiS_Pr);\n       SiS_SendACK(SiS_Pr, 0);\n       if(temp == 0) {\n           mask = 0xff;\n\t   value = 0xff;\n       } else {\n           failed = true;\n\t   ret = 0xFFFF;\n       }\n    }\n    if(!failed) {\n       temp = (unsigned char)SiS_ReadDDC2Data(SiS_Pr);\n       SiS_SendACK(SiS_Pr, 1);\n       temp &= mask;\n       if(temp == value) ret = 0;\n       else {\n          ret = 0xFFFF;\n          if(SiS_Pr->SiS_DDC_DeviceAddr == 0xa0) {\n             if(temp == 0x30) ret = 0;\n          }\n       }\n    }\n    SiS_SetStop(SiS_Pr);\n    return ret;\n}\n\nstatic\nunsigned short\nSiS_ProbeDDC(struct SiS_Private *SiS_Pr)\n{\n   unsigned short flag;\n\n   flag = 0x180;\n   SiS_Pr->SiS_DDC_DeviceAddr = 0xa0;\n   if(!(SiS_DoProbeDDC(SiS_Pr))) flag |= 0x02;\n   SiS_Pr->SiS_DDC_DeviceAddr = 0xa2;\n   if(!(SiS_DoProbeDDC(SiS_Pr))) flag |= 0x08;\n   SiS_Pr->SiS_DDC_DeviceAddr = 0xa6;\n   if(!(SiS_DoProbeDDC(SiS_Pr))) flag |= 0x10;\n   if(!(flag & 0x1a)) flag = 0;\n   return flag;\n}\n\nstatic\nunsigned short\nSiS_ReadDDC(struct SiS_Private *SiS_Pr, unsigned short DDCdatatype, unsigned char *buffer)\n{\n   unsigned short flag, length, i;\n   unsigned char chksum,gotcha;\n\n   if(DDCdatatype > 4) return 0xFFFF;\n\n   flag = 0;\n   SiS_SetSwitchDDC2(SiS_Pr);\n   if(!(SiS_PrepareDDC(SiS_Pr))) {\n      length = 127;\n      if(DDCdatatype != 1) length = 255;\n      chksum = 0;\n      gotcha = 0;\n      for(i=0; i<length; i++) {\n\t buffer[i] = (unsigned char)SiS_ReadDDC2Data(SiS_Pr);\n\t chksum += buffer[i];\n\t gotcha |= buffer[i];\n\t SiS_SendACK(SiS_Pr, 0);\n      }\n      buffer[i] = (unsigned char)SiS_ReadDDC2Data(SiS_Pr);\n      chksum += buffer[i];\n      SiS_SendACK(SiS_Pr, 1);\n      if(gotcha) flag = (unsigned short)chksum;\n      else flag = 0xFFFF;\n   } else {\n      flag = 0xFFFF;\n   }\n   SiS_SetStop(SiS_Pr);\n   return flag;\n}\n\n \nunsigned short\nSiS_HandleDDC(struct SiS_Private *SiS_Pr, unsigned int VBFlags, int VGAEngine,\n              unsigned short adaptnum, unsigned short DDCdatatype, unsigned char *buffer,\n\t      unsigned int VBFlags2)\n{\n   unsigned char  sr1f, cr17=1;\n   unsigned short result;\n\n   if(adaptnum > 2)\n      return 0xFFFF;\n\n   if(DDCdatatype > 4)\n      return 0xFFFF;\n\n   if((!(VBFlags2 & VB2_VIDEOBRIDGE)) && (adaptnum > 0))\n      return 0xFFFF;\n\n   if(SiS_InitDDCRegs(SiS_Pr, VBFlags, VGAEngine, adaptnum, DDCdatatype, false, VBFlags2) == 0xFFFF)\n      return 0xFFFF;\n\n   sr1f = SiS_GetReg(SiS_Pr->SiS_P3c4,0x1f);\n   SiS_SetRegANDOR(SiS_Pr->SiS_P3c4,0x1f,0x3f,0x04);\n   if(VGAEngine == SIS_300_VGA) {\n      cr17 = SiS_GetReg(SiS_Pr->SiS_P3d4,0x17) & 0x80;\n      if(!cr17) {\n         SiS_SetRegOR(SiS_Pr->SiS_P3d4,0x17,0x80);\n         SiS_SetReg(SiS_Pr->SiS_P3c4,0x00,0x01);\n         SiS_SetReg(SiS_Pr->SiS_P3c4,0x00,0x03);\n      }\n   }\n   if((sr1f) || (!cr17)) {\n      SiS_WaitRetrace1(SiS_Pr);\n      SiS_WaitRetrace1(SiS_Pr);\n      SiS_WaitRetrace1(SiS_Pr);\n      SiS_WaitRetrace1(SiS_Pr);\n   }\n\n   if(DDCdatatype == 0) {\n      result = SiS_ProbeDDC(SiS_Pr);\n   } else {\n      result = SiS_ReadDDC(SiS_Pr, DDCdatatype, buffer);\n      if((!result) && (DDCdatatype == 1)) {\n         if((buffer[0] == 0x00) && (buffer[1] == 0xff) &&\n\t    (buffer[2] == 0xff) && (buffer[3] == 0xff) &&\n\t    (buffer[4] == 0xff) && (buffer[5] == 0xff) &&\n\t    (buffer[6] == 0xff) && (buffer[7] == 0x00) &&\n\t    (buffer[0x12] == 1)) {\n\t    if(!SiS_Pr->DDCPortMixup) {\n\t       if(adaptnum == 1) {\n\t          if(!(buffer[0x14] & 0x80)) result = 0xFFFE;\n\t       } else {\n\t          if(buffer[0x14] & 0x80)    result = 0xFFFE;\n\t       }\n\t    }\n\t }\n      }\n   }\n   SiS_SetReg(SiS_Pr->SiS_P3c4,0x1f,sr1f);\n   if(VGAEngine == SIS_300_VGA) {\n      SiS_SetRegANDOR(SiS_Pr->SiS_P3d4,0x17,0x7f,cr17);\n   }\n   return result;\n}\n\n \n\nstatic void\nSiS_SetSwitchDDC2(struct SiS_Private *SiS_Pr)\n{\n  SiS_SetSCLKHigh(SiS_Pr);\n  SiS_WaitRetrace1(SiS_Pr);\n\n  SiS_SetSCLKLow(SiS_Pr);\n  SiS_WaitRetrace1(SiS_Pr);\n}\n\nunsigned short\nSiS_ReadDDC1Bit(struct SiS_Private *SiS_Pr)\n{\n   SiS_WaitRetrace1(SiS_Pr);\n   return ((SiS_GetReg(SiS_Pr->SiS_P3c4,0x11) & 0x02) >> 1);\n}\n\n \n \nstatic unsigned short\nSiS_SetStart(struct SiS_Private *SiS_Pr)\n{\n  if(SiS_SetSCLKLow(SiS_Pr)) return 0xFFFF;\t\t\t \n  SiS_SetRegANDOR(SiS_Pr->SiS_DDC_Port,\n\t\t  SiS_Pr->SiS_DDC_Index,\n\t\t  SiS_Pr->SiS_DDC_NData,\n\t\t  SiS_Pr->SiS_DDC_Data);        \t\t \n  if(SiS_SetSCLKHigh(SiS_Pr)) return 0xFFFF;\t\t\t \n  SiS_SetRegANDOR(SiS_Pr->SiS_DDC_Port,\n\t\t  SiS_Pr->SiS_DDC_Index,\n\t\t  SiS_Pr->SiS_DDC_NData,\n\t\t  0x00);\t\t\t\t\t \n  if(SiS_SetSCLKHigh(SiS_Pr)) return 0xFFFF;\t\t\t \n  return 0;\n}\n\n \n \nstatic unsigned short\nSiS_SetStop(struct SiS_Private *SiS_Pr)\n{\n  if(SiS_SetSCLKLow(SiS_Pr)) return 0xFFFF;\t\t\t \n  SiS_SetRegANDOR(SiS_Pr->SiS_DDC_Port,\n\t\t  SiS_Pr->SiS_DDC_Index,\n\t\t  SiS_Pr->SiS_DDC_NData,\n\t\t  0x00);\t\t\t\t\t \n  if(SiS_SetSCLKHigh(SiS_Pr)) return 0xFFFF;\t\t\t \n  SiS_SetRegANDOR(SiS_Pr->SiS_DDC_Port,\n\t\t  SiS_Pr->SiS_DDC_Index,\n\t\t  SiS_Pr->SiS_DDC_NData,\n\t\t  SiS_Pr->SiS_DDC_Data);\t\t\t \n  if(SiS_SetSCLKHigh(SiS_Pr)) return 0xFFFF;\t\t\t \n  return 0;\n}\n\n \nstatic unsigned short\nSiS_WriteDDC2Data(struct SiS_Private *SiS_Pr, unsigned short tempax)\n{\n  unsigned short i,flag,temp;\n\n  flag = 0x80;\n  for(i = 0; i < 8; i++) {\n    SiS_SetSCLKLow(SiS_Pr);\t\t\t\t\t \n    if(tempax & flag) {\n      SiS_SetRegANDOR(SiS_Pr->SiS_DDC_Port,\n\t\t      SiS_Pr->SiS_DDC_Index,\n\t\t      SiS_Pr->SiS_DDC_NData,\n\t\t      SiS_Pr->SiS_DDC_Data);\t\t\t \n    } else {\n      SiS_SetRegANDOR(SiS_Pr->SiS_DDC_Port,\n\t\t      SiS_Pr->SiS_DDC_Index,\n\t\t      SiS_Pr->SiS_DDC_NData,\n\t\t      0x00);\t\t\t\t\t \n    }\n    SiS_SetSCLKHigh(SiS_Pr);\t\t\t\t\t \n    flag >>= 1;\n  }\n  temp = SiS_CheckACK(SiS_Pr);\t\t\t\t\t \n  return temp;\n}\n\nstatic unsigned short\nSiS_ReadDDC2Data(struct SiS_Private *SiS_Pr)\n{\n  unsigned short i, temp, getdata;\n\n  getdata = 0;\n  for(i = 0; i < 8; i++) {\n    getdata <<= 1;\n    SiS_SetSCLKLow(SiS_Pr);\n    SiS_SetRegANDOR(SiS_Pr->SiS_DDC_Port,\n\t\t    SiS_Pr->SiS_DDC_Index,\n\t\t    SiS_Pr->SiS_DDC_NData,\n\t\t    SiS_Pr->SiS_DDC_Data);\n    SiS_SetSCLKHigh(SiS_Pr);\n    temp = SiS_GetReg(SiS_Pr->SiS_DDC_Port,SiS_Pr->SiS_DDC_Index);\n    if(temp & SiS_Pr->SiS_DDC_Data) getdata |= 0x01;\n  }\n  return getdata;\n}\n\nstatic unsigned short\nSiS_SetSCLKLow(struct SiS_Private *SiS_Pr)\n{\n  SiS_SetRegANDOR(SiS_Pr->SiS_DDC_Port,\n\t\t  SiS_Pr->SiS_DDC_Index,\n\t\t  SiS_Pr->SiS_DDC_NClk,\n\t\t  0x00);\t\t\t\t\t \n  SiS_DDC2Delay(SiS_Pr,SiS_I2CDELAYSHORT);\n  return 0;\n}\n\nstatic unsigned short\nSiS_SetSCLKHigh(struct SiS_Private *SiS_Pr)\n{\n  unsigned short temp, watchdog=1000;\n\n  SiS_SetRegANDOR(SiS_Pr->SiS_DDC_Port,\n\t\t  SiS_Pr->SiS_DDC_Index,\n\t\t  SiS_Pr->SiS_DDC_NClk,\n\t\t  SiS_Pr->SiS_DDC_Clk);  \t\t\t \n  do {\n    temp = SiS_GetReg(SiS_Pr->SiS_DDC_Port,SiS_Pr->SiS_DDC_Index);\n  } while((!(temp & SiS_Pr->SiS_DDC_Clk)) && --watchdog);\n  if (!watchdog) {\n  \treturn 0xFFFF;\n  }\n  SiS_DDC2Delay(SiS_Pr,SiS_I2CDELAYSHORT);\n  return 0;\n}\n\n \n \nstatic unsigned short\nSiS_CheckACK(struct SiS_Private *SiS_Pr)\n{\n  unsigned short tempah;\n\n  SiS_SetSCLKLow(SiS_Pr);\t\t\t\t            \n  SiS_SetRegANDOR(SiS_Pr->SiS_DDC_Port,\n\t\t  SiS_Pr->SiS_DDC_Index,\n\t\t  SiS_Pr->SiS_DDC_NData,\n\t\t  SiS_Pr->SiS_DDC_Data);\t\t\t    \n  SiS_SetSCLKHigh(SiS_Pr);\t\t\t\t            \n  tempah = SiS_GetReg(SiS_Pr->SiS_DDC_Port,SiS_Pr->SiS_DDC_Index);  \n  SiS_SetSCLKLow(SiS_Pr);\t\t\t\t            \n  if(tempah & SiS_Pr->SiS_DDC_Data) return 1;\t\t\t    \n  return 0;\n}\n\n \n\n\n \n\n#ifdef CONFIG_FB_SIS_315\n\nstatic unsigned short\nGetRAMDACromptr(struct SiS_Private *SiS_Pr)\n{\n  unsigned char  *ROMAddr = SiS_Pr->VirtualRomBase;\n  unsigned short romptr;\n\n  if(SiS_Pr->ChipType < SIS_330) {\n     romptr = SISGETROMW(0x128);\n     if(SiS_Pr->SiS_VBType & VB_SIS30xB)\n        romptr = SISGETROMW(0x12a);\n  } else {\n     romptr = SISGETROMW(0x1a8);\n     if(SiS_Pr->SiS_VBType & VB_SIS30xB)\n        romptr = SISGETROMW(0x1aa);\n  }\n  return romptr;\n}\n\nstatic unsigned short\nGetLCDromptr(struct SiS_Private *SiS_Pr)\n{\n  unsigned char  *ROMAddr = SiS_Pr->VirtualRomBase;\n  unsigned short romptr;\n\n  if(SiS_Pr->ChipType < SIS_330) {\n     romptr = SISGETROMW(0x120);\n     if(SiS_Pr->SiS_VBType & VB_SIS30xBLV)\n        romptr = SISGETROMW(0x122);\n  } else {\n     romptr = SISGETROMW(0x1a0);\n     if(SiS_Pr->SiS_VBType & VB_SIS30xBLV)\n        romptr = SISGETROMW(0x1a2);\n  }\n  return romptr;\n}\n\nstatic unsigned short\nGetTVromptr(struct SiS_Private *SiS_Pr)\n{\n  unsigned char  *ROMAddr = SiS_Pr->VirtualRomBase;\n  unsigned short romptr;\n\n  if(SiS_Pr->ChipType < SIS_330) {\n     romptr = SISGETROMW(0x114);\n     if(SiS_Pr->SiS_VBType & VB_SIS30xBLV)\n        romptr = SISGETROMW(0x11a);\n  } else {\n     romptr = SISGETROMW(0x194);\n     if(SiS_Pr->SiS_VBType & VB_SIS30xBLV)\n        romptr = SISGETROMW(0x19a);\n  }\n  return romptr;\n}\n\nstatic unsigned short\nGetLCDPtrIndexBIOS(struct SiS_Private *SiS_Pr)\n{\n  unsigned short index;\n\n  if((IS_SIS650) && (SiS_Pr->SiS_VBType & VB_SISLVDS)) {\n     if(!(SiS_IsNotM650orLater(SiS_Pr))) {\n        if((index = SiS_GetReg(SiS_Pr->SiS_P3d4,0x36) & 0xf0)) {\n\t   index >>= 4;\n\t   index *= 3;\n\t   if(SiS_Pr->SiS_LCDInfo & DontExpandLCD) index += 2;\n           else if(!(SiS_Pr->SiS_SetFlag & LCDVESATiming)) index++;\n           return index;\n\t}\n     }\n  }\n\n  index = SiS_GetBIOSLCDResInfo(SiS_Pr) & 0x0F;\n  if(SiS_Pr->SiS_LCDResInfo == Panel_1400x1050)      index -= 5;\n  if(SiS_Pr->SiS_VBType & VB_SIS301C) {   \n     if(SiS_Pr->SiS_LCDResInfo == Panel_1600x1200) index -= 5;\n     if(SiS_Pr->SiS_LCDResInfo == Panel_1280x768) index -= 5;\n  } else {\n     if(SiS_Pr->SiS_LCDResInfo == Panel_1600x1200) index -= 6;\n  }\n  index--;\n  index *= 3;\n  if(SiS_Pr->SiS_LCDInfo & DontExpandLCD) index += 2;\n  else if(!(SiS_Pr->SiS_SetFlag & LCDVESATiming)) index++;\n  return index;\n}\n\nstatic unsigned short\nGetLCDPtrIndex(struct SiS_Private *SiS_Pr)\n{\n  unsigned short index;\n\n  index = ((SiS_GetBIOSLCDResInfo(SiS_Pr) & 0x0F) - 1) * 3;\n  if(SiS_Pr->SiS_LCDInfo & DontExpandLCD)         index += 2;\n  else if(!(SiS_Pr->SiS_SetFlag & LCDVESATiming)) index++;\n  return index;\n}\n\nstatic unsigned short\nGetTVPtrIndex(struct SiS_Private *SiS_Pr)\n{\n  unsigned short index;\n\n  index = 0;\n  if(SiS_Pr->SiS_TVMode & TVSetPAL) index = 1;\n  if(SiS_Pr->SiS_VBInfo & SetCRT2ToHiVision) index = 2;\n\n  if(SiS_Pr->SiS_VBInfo & SetCRT2ToYPbPr525750) index = 0;\n\n  index <<= 1;\n\n  if((SiS_Pr->SiS_VBInfo & SetInSlaveMode) &&\n     (SiS_Pr->SiS_TVMode & TVSetTVSimuMode)) {\n     index++;\n  }\n\n  return index;\n}\n\nstatic unsigned int\nGetOEMTVPtr661_2_GEN(struct SiS_Private *SiS_Pr, int addme)\n{\n   unsigned short index = 0, temp = 0;\n\n   if(SiS_Pr->SiS_TVMode & TVSetPAL)   index = 1;\n   if(SiS_Pr->SiS_TVMode & TVSetPALM)  index = 2;\n   if(SiS_Pr->SiS_TVMode & TVSetPALN)  index = 3;\n   if(SiS_Pr->SiS_TVMode & TVSetNTSCJ) index = 6;\n   if(SiS_Pr->SiS_TVMode & TVSetNTSC1024) {\n      index = 4;\n      if(SiS_Pr->SiS_TVMode & TVSetPALM)  index++;\n      if(SiS_Pr->SiS_TVMode & TVSetNTSCJ) index = 7;\n   }\n\n   if(SiS_Pr->SiS_VBType & VB_SIS30xBLV) {\n      if((!(SiS_Pr->SiS_VBInfo & SetInSlaveMode)) ||\n         (SiS_Pr->SiS_TVMode & TVSetTVSimuMode)) {\n\t index += addme;\n\t temp++;\n      }\n      temp += 0x0100;\n   }\n   return (unsigned int)(index | (temp << 16));\n}\n\nstatic unsigned int\nGetOEMTVPtr661_2_OLD(struct SiS_Private *SiS_Pr)\n{\n   return (GetOEMTVPtr661_2_GEN(SiS_Pr, 8));\n}\n\n#if 0\nstatic unsigned int\nGetOEMTVPtr661_2_NEW(struct SiS_Private *SiS_Pr)\n{\n   return (GetOEMTVPtr661_2_GEN(SiS_Pr, 6));\n}\n#endif\n\nstatic int\nGetOEMTVPtr661(struct SiS_Private *SiS_Pr)\n{\n   int index = 0;\n\n   if(SiS_Pr->SiS_TVMode & TVSetPAL)          index = 2;\n   if(SiS_Pr->SiS_ROMNew) {\n      if(SiS_Pr->SiS_TVMode & TVSetYPbPr525i) index = 4;\n      if(SiS_Pr->SiS_TVMode & TVSetYPbPr525p) index = 6;\n      if(SiS_Pr->SiS_TVMode & TVSetYPbPr750p) index = 8;\n      if(SiS_Pr->SiS_TVMode & TVSetHiVision)  index = 10;\n   } else {\n      if(SiS_Pr->SiS_TVMode & TVSetHiVision)  index = 4;\n      if(SiS_Pr->SiS_TVMode & TVSetYPbPr525i) index = 6;\n      if(SiS_Pr->SiS_TVMode & TVSetYPbPr525p) index = 8;\n      if(SiS_Pr->SiS_TVMode & TVSetYPbPr750p) index = 10;\n   }\n\n   if(SiS_Pr->SiS_TVMode & TVSetTVSimuMode) index++;\n\n   return index;\n}\n\nstatic void\nSetDelayComp(struct SiS_Private *SiS_Pr, unsigned short ModeNo)\n{\n  unsigned char  *ROMAddr = SiS_Pr->VirtualRomBase;\n  unsigned short delay=0,index,myindex,temp,romptr=0;\n  bool dochiptest = true;\n\n  if(SiS_Pr->SiS_VBInfo & SetCRT2ToLCDA) {\n     SiS_SetRegAND(SiS_Pr->SiS_Part1Port,0x20,0xbf);\n  } else {\n     SiS_SetRegAND(SiS_Pr->SiS_Part1Port,0x35,0x7f);\n  }\n\n   \n\n  if(SiS_Pr->SiS_VBInfo & SetCRT2ToRAMDAC) {\t\t\t \n\n     if((SiS_Pr->SiS_UseROM) && (!(SiS_Pr->SiS_ROMNew))) {\n        romptr = GetRAMDACromptr(SiS_Pr);\n     }\n     if(romptr) delay = ROMAddr[romptr];\n     else {\n        delay = 0x04;\n        if(SiS_Pr->SiS_VBType & VB_SIS30xB) {\n\t   if(IS_SIS650) {\n\t      delay = 0x0a;\n\t   } else if(IS_SIS740) {\n\t      delay = 0x00;\n\t   } else {\n\t      delay = 0x0c;\n\t   }\n\t} else if(SiS_Pr->SiS_IF_DEF_LVDS == 1) {\n           delay = 0x00;\n\t}\n     }\n\n  } else if(SiS_Pr->SiS_VBInfo & (SetCRT2ToLCD|SetCRT2ToLCDA)) {   \n\n     bool gotitfrompci = false;\n\n      \n\n     if(SiS_Pr->SiS_VBInfo & SetCRT2ToLCD) {\n\tif(SiS_Pr->PDC != -1) {\n           SiS_SetRegANDOR(SiS_Pr->SiS_Part1Port,0x2d,0xf0,((SiS_Pr->PDC >> 1) & 0x0f));\n\t   SiS_SetRegANDOR(SiS_Pr->SiS_Part1Port,0x35,0x7f,((SiS_Pr->PDC & 0x01) << 7));\n\t   return;\n\t}\n     } else {\n\tif(SiS_Pr->PDCA != -1) {\n\t   SiS_SetRegANDOR(SiS_Pr->SiS_Part1Port,0x2d,0x0f,((SiS_Pr->PDCA << 3) & 0xf0));\n\t   SiS_SetRegANDOR(SiS_Pr->SiS_Part1Port,0x20,0xbf,((SiS_Pr->PDCA & 0x01) << 6));\n\t   return;\n\t}\n     }\n\n      \n\n     if(SiS_Pr->SiS_LCDResInfo == Panel_Custom) {\n        if(SiS_Pr->SiS_VBInfo & SetCRT2ToLCDA) {\n\t   delay = 0x00;\n\t   if((SiS_Pr->PanelXRes <= 1280) && (SiS_Pr->PanelYRes <= 1024)) {\n\t      delay = 0x20;\n\t   }\n\t   SiS_SetRegANDOR(SiS_Pr->SiS_Part1Port,0x2d,0x0f,delay);\n\t} else {\n\t   delay = 0x0c;\n\t   if(SiS_Pr->SiS_VBType & VB_SIS301C) {\n\t      delay = 0x03;\n\t      if((SiS_Pr->PanelXRes > 1280) && (SiS_Pr->PanelYRes > 1024)) {\n\t         delay = 0x00;\n\t      }\n\t   } else if(SiS_Pr->SiS_VBType & VB_SISLVDS) {\n\t      if(IS_SIS740) delay = 0x01;\n\t      else          delay = 0x03;\n\t   }\n\t   SiS_SetRegANDOR(SiS_Pr->SiS_Part1Port,0x2d,0xf0,delay);\n\t}\n        return;\n     }\n\n      \n\n     switch(SiS_Pr->SiS_CustomT) {\n     case CUT_COMPAQ1280:\n     case CUT_COMPAQ12802:\n\tif(SiS_Pr->SiS_LCDResInfo == Panel_1280x1024) {\n\t   gotitfrompci = true;\n\t   dochiptest = false;\n\t   delay = 0x03;\n\t}\n\tbreak;\n     case CUT_CLEVO1400:\n     case CUT_CLEVO14002:\n\tgotitfrompci = true;\n\tdochiptest = false;\n\tdelay = 0x02;\n\tbreak;\n     case CUT_CLEVO1024:\n     case CUT_CLEVO10242:\n        if(SiS_Pr->SiS_LCDResInfo == Panel_1024x768) {\n\t   gotitfrompci = true;\n\t   dochiptest = false;\n\t   delay = 0x33;\n\t   SiS_SetReg(SiS_Pr->SiS_Part1Port,0x2D,delay);\n\t   delay &= 0x0f;\n\t}\n\tbreak;\n     }\n\n      \n\n     if(!gotitfrompci) {\n\n        index = GetLCDPtrIndexBIOS(SiS_Pr);\n        myindex = GetLCDPtrIndex(SiS_Pr);\n\n        if(IS_SIS650 && (SiS_Pr->SiS_VBType & VB_SISLVDS)) {\n\n           if(SiS_IsNotM650orLater(SiS_Pr)) {\n\n              if((SiS_Pr->SiS_UseROM) && (!(SiS_Pr->SiS_ROMNew))) {\n\t          \n                  \n\t          \n\t          \n\t         romptr = SISGETROMW(0x122);\n\t         if(!romptr) return;\n\t         delay = ROMAddr[(romptr + index)];\n\t      } else {\n                 delay = SiS310_LCDDelayCompensation_650301LV[myindex];\n\t      }\n\n          } else {\n\n             delay = SiS310_LCDDelayCompensation_651301LV[myindex];\n\t     if(SiS_Pr->SiS_VBType & (VB_SIS302LV | VB_SIS302ELV))\n\t        delay = SiS310_LCDDelayCompensation_651302LV[myindex];\n\n          }\n\n        } else if(SiS_Pr->SiS_UseROM \t\t\t      &&\n\t\t  (!(SiS_Pr->SiS_ROMNew))\t\t      &&\n\t          (SiS_Pr->SiS_LCDResInfo != Panel_1280x1024) &&\n\t\t  (SiS_Pr->SiS_LCDResInfo != Panel_1280x768)  &&\n\t\t  (SiS_Pr->SiS_LCDResInfo != Panel_1280x960)  &&\n\t\t  (SiS_Pr->SiS_LCDResInfo != Panel_1600x1200)  &&\n\t\t  ((romptr = GetLCDromptr(SiS_Pr)))) {\n\n\t    \n\t    \n\t   delay = ROMAddr[(romptr + index)];\n\n        } else if(SiS_Pr->SiS_IF_DEF_LVDS == 1) {\n\n\t   if(IS_SIS740) delay = 0x03;\n\t   else          delay = 0x00;\n\n\t} else {\n\n           delay = SiS310_LCDDelayCompensation_301[myindex];\n\t   if(SiS_Pr->SiS_VBType & VB_SISLVDS) {\n\t      if(IS_SIS740) delay = 0x01;\n\t      else if(SiS_Pr->ChipType <= SIS_315PRO) delay = SiS310_LCDDelayCompensation_3xx301LV[myindex];\n\t      else          delay = SiS310_LCDDelayCompensation_650301LV[myindex];\n\t   } else if(SiS_Pr->SiS_VBType & VB_SIS301C) {\n\t      if(IS_SIS740) delay = 0x01;   \n\t      else          delay = 0x03;\n\t      if(SiS_Pr->SiS_LCDResInfo == Panel_1600x1200) delay = 0x00;  \n\t   } else if(SiS_Pr->SiS_VBType & VB_SIS30xB) {\n\t      if(IS_SIS740) delay = 0x01;\n\t      else          delay = SiS310_LCDDelayCompensation_3xx301B[myindex];\n\t   }\n\n        }\n\n     }   \n\n     if(SiS_Pr->SiS_VBInfo & SetCRT2ToLCDA) {\n\tSiS_SetRegANDOR(SiS_Pr->SiS_Part1Port,0x2D,0x0F,((delay << 4) & 0xf0));\n\tdochiptest = false;\n     }\n\n  } else if(SiS_Pr->SiS_VBInfo & SetCRT2ToTV) {\t\t\t \n\n     index = GetTVPtrIndex(SiS_Pr);\n\n     if(IS_SIS650 && (SiS_Pr->SiS_VBType & VB_SISLVDS)) {\n\n        if(SiS_IsNotM650orLater(SiS_Pr)) {\n\n           if((SiS_Pr->SiS_UseROM) && (!(SiS_Pr->SiS_ROMNew))) {\n\t       \n               \n               \n\t       \n\t      romptr = SISGETROMW(0x11a);\n\t      if(!romptr) return;\n\t      delay = ROMAddr[romptr + index];\n\n\t   } else {\n\n\t      delay = SiS310_TVDelayCompensation_301B[index];\n\n\t   }\n\n        } else {\n\n           switch(SiS_Pr->SiS_CustomT) {\n\t   case CUT_COMPAQ1280:\n\t   case CUT_COMPAQ12802:\n\t   case CUT_CLEVO1400:\n\t   case CUT_CLEVO14002:\n\t      delay = 0x02;\n\t      dochiptest = false;\n\t      break;\n\t   case CUT_CLEVO1024:\n\t   case CUT_CLEVO10242:\n\t      delay = 0x03;\n\t      dochiptest = false;\n   \t      break;\n\t   default:\n              delay = SiS310_TVDelayCompensation_651301LV[index];\n\t      if(SiS_Pr->SiS_VBType & VB_SIS302LV) {\n\t         delay = SiS310_TVDelayCompensation_651302LV[index];\n\t      }\n\t   }\n        }\n\n     } else if((SiS_Pr->SiS_UseROM) && (!(SiS_Pr->SiS_ROMNew))) {\n\n        romptr = GetTVromptr(SiS_Pr);\n\tif(!romptr) return;\n\tdelay = ROMAddr[romptr + index];\n\n     } else if(SiS_Pr->SiS_IF_DEF_LVDS == 1) {\n\n        delay = SiS310_TVDelayCompensation_LVDS[index];\n\n     } else {\n\n\tdelay = SiS310_TVDelayCompensation_301[index];\n        if(SiS_Pr->SiS_VBType & VB_SIS30xBLV) {\n\t   if(IS_SIS740) {\n\t      delay = SiS310_TVDelayCompensation_740301B[index];\n\t       \n\t   } else {\n              delay = SiS310_TVDelayCompensation_301B[index];\n\t      if(SiS_Pr->SiS_VBType & VB_SIS301C) delay = 0x02;\n\t   }\n\t}\n\n     }\n\n     if(SiS_LCDAEnabled(SiS_Pr)) {\n\tdelay &= 0x0f;\n\tdochiptest = false;\n     }\n\n  } else return;\n\n   \n\n  if(SiS_Pr->SiS_VBType & VB_SISVB) {\n\n     if(IS_SIS650 && (SiS_Pr->SiS_VBType & VB_SISLVDS) && dochiptest) {\n\n        temp = (SiS_GetReg(SiS_Pr->SiS_P3d4,0x36) & 0xf0) >> 4;\n        if(temp == 8) {\t\t \n\t   delay &= 0x0f;\n\t   delay |= 0xb0;\n        } else if(temp == 6) {\n           delay &= 0x0f;\n\t   delay |= 0xc0;\n        } else if(temp > 7) {\t \n\t   delay = 0x35;\n        }\n        SiS_SetReg(SiS_Pr->SiS_Part1Port,0x2D,delay);\n\n     } else {\n\n        SiS_SetRegANDOR(SiS_Pr->SiS_Part1Port,0x2D,0xF0,delay);\n\n     }\n\n  } else {   \n\n     if(SiS_Pr->SiS_VBInfo & SetCRT2ToTV) {\n        SiS_SetRegANDOR(SiS_Pr->SiS_Part1Port,0x2D,0xF0,delay);\n     } else {\n        if(IS_SIS650 && (SiS_Pr->SiS_IF_DEF_CH70xx != 0)) {\n           delay <<= 4;\n           SiS_SetRegANDOR(SiS_Pr->SiS_Part1Port,0x2D,0x0F,delay);\n        } else {\n           SiS_SetRegANDOR(SiS_Pr->SiS_Part1Port,0x2D,0xF0,delay);\n        }\n     }\n\n  }\n\n}\n\nstatic void\nSetAntiFlicker(struct SiS_Private *SiS_Pr, unsigned short ModeNo, unsigned short ModeIdIndex)\n{\n  unsigned char  *ROMAddr = SiS_Pr->VirtualRomBase;\n  unsigned short index,temp,temp1,romptr=0;\n\n  if(SiS_Pr->SiS_TVMode & (TVSetYPbPr750p|TVSetYPbPr525p)) return;\n\n  if(ModeNo<=0x13)\n     index = SiS_Pr->SiS_SModeIDTable[ModeIdIndex].VB_StTVFlickerIndex;\n  else\n     index = SiS_Pr->SiS_EModeIDTable[ModeIdIndex].VB_ExtTVFlickerIndex;\n\n  temp = GetTVPtrIndex(SiS_Pr);\n  temp >>= 1;  \t   \n  temp1 = temp;\n\n  if(SiS_Pr->SiS_UseROM && (!(SiS_Pr->SiS_ROMNew))) {\n     if(SiS_Pr->ChipType >= SIS_661) {\n        temp1 = GetOEMTVPtr661(SiS_Pr);\n        temp1 >>= 1;\n        romptr = SISGETROMW(0x260);\n        if(SiS_Pr->ChipType >= SIS_760) {\n\t   romptr = SISGETROMW(0x360);\n\t}\n     } else if(SiS_Pr->ChipType >= SIS_330) {\n        romptr = SISGETROMW(0x192);\n     } else {\n        romptr = SISGETROMW(0x112);\n     }\n  }\n\n  if(romptr) {\n     temp1 <<= 1;\n     temp = ROMAddr[romptr + temp1 + index];\n  } else {\n     temp = SiS310_TVAntiFlick1[temp][index];\n  }\n  temp <<= 4;\n\n  SiS_SetRegANDOR(SiS_Pr->SiS_Part2Port,0x0A,0x8f,temp);   \n}\n\nstatic void\nSetEdgeEnhance(struct SiS_Private *SiS_Pr, unsigned short ModeNo,unsigned short ModeIdIndex)\n{\n  unsigned char  *ROMAddr = SiS_Pr->VirtualRomBase;\n  unsigned short index,temp,temp1,romptr=0;\n\n  temp = temp1 = GetTVPtrIndex(SiS_Pr) >> 1; \t \n\n  if(ModeNo <= 0x13)\n     index = SiS_Pr->SiS_SModeIDTable[ModeIdIndex].VB_StTVEdgeIndex;\n  else\n     index = SiS_Pr->SiS_EModeIDTable[ModeIdIndex].VB_ExtTVEdgeIndex;\n\n  if(SiS_Pr->SiS_UseROM && (!(SiS_Pr->SiS_ROMNew))) {\n     if(SiS_Pr->ChipType >= SIS_661) {\n        romptr = SISGETROMW(0x26c);\n        if(SiS_Pr->ChipType >= SIS_760) {\n\t   romptr = SISGETROMW(0x36c);\n\t}\n\ttemp1 = GetOEMTVPtr661(SiS_Pr);\n        temp1 >>= 1;\n     } else if(SiS_Pr->ChipType >= SIS_330) {\n        romptr = SISGETROMW(0x1a4);\n     } else {\n        romptr = SISGETROMW(0x124);\n     }\n  }\n\n  if(romptr) {\n     temp1 <<= 1;\n     temp = ROMAddr[romptr + temp1 + index];\n  } else {\n     temp = SiS310_TVEdge1[temp][index];\n  }\n  temp <<= 5;\n  SiS_SetRegANDOR(SiS_Pr->SiS_Part2Port,0x3A,0x1F,temp);   \n}\n\nstatic void\nSetYFilter(struct SiS_Private *SiS_Pr, unsigned short ModeNo,unsigned short ModeIdIndex)\n{\n  unsigned short index, temp, i, j;\n\n  if(ModeNo <= 0x13) {\n     index = SiS_Pr->SiS_SModeIDTable[ModeIdIndex].VB_StTVYFilterIndex;\n  } else {\n     index = SiS_Pr->SiS_EModeIDTable[ModeIdIndex].VB_ExtTVYFilterIndex;\n  }\n\n  temp = GetTVPtrIndex(SiS_Pr) >> 1;   \n\n  if(SiS_Pr->SiS_TVMode & TVSetNTSCJ)\t     temp = 1;   \n  else if(SiS_Pr->SiS_TVMode & TVSetPALM)    temp = 3;   \n  else if(SiS_Pr->SiS_TVMode & TVSetPALN)    temp = 4;   \n  if(SiS_Pr->SiS_VBInfo & SetCRT2ToHiVision) temp = 1;   \n\n  if(SiS_Pr->SiS_VBType & VB_SIS30xBLV) {\n     for(i=0x35, j=0; i<=0x38; i++, j++) {\n        SiS_SetReg(SiS_Pr->SiS_Part2Port,i,SiS310_TVYFilter2[temp][index][j]);\n     }\n     for(i=0x48; i<=0x4A; i++, j++) {\n        SiS_SetReg(SiS_Pr->SiS_Part2Port,i,SiS310_TVYFilter2[temp][index][j]);\n     }\n  } else {\n     for(i=0x35, j=0; i<=0x38; i++, j++) {\n        SiS_SetReg(SiS_Pr->SiS_Part2Port,i,SiS310_TVYFilter1[temp][index][j]);\n     }\n  }\n}\n\nstatic void\nSetPhaseIncr(struct SiS_Private *SiS_Pr, unsigned short ModeNo, unsigned short ModeIdIndex)\n{\n  unsigned char  *ROMAddr = SiS_Pr->VirtualRomBase;\n  unsigned short index,temp,i,j,resinfo,romptr=0;\n  unsigned int  lindex;\n\n  if(!(SiS_Pr->SiS_VBInfo & SetCRT2ToTV)) return;\n\n   \n  if(SiS_Pr->SiS_TVMode & TVSetNTSCJ) return;\n\n  if((SiS_Pr->ChipType >= SIS_661) || SiS_Pr->SiS_ROMNew) {\n     lindex = GetOEMTVPtr661_2_OLD(SiS_Pr) & 0xffff;\n     lindex <<= 2;\n     for(j=0, i=0x31; i<=0x34; i++, j++) {\n        SiS_SetReg(SiS_Pr->SiS_Part2Port,i,SiS_TVPhase[lindex + j]);\n     }\n     return;\n  }\n\n   \n  if(SiS_Pr->SiS_TVMode & (TVSetPALM | TVSetPALN)) return;\n\n  if(ModeNo<=0x13) {\n     resinfo = SiS_Pr->SiS_SModeIDTable[ModeIdIndex].St_ResInfo;\n  } else {\n     resinfo = SiS_Pr->SiS_EModeIDTable[ModeIdIndex].Ext_RESINFO;\n  }\n\n  temp = GetTVPtrIndex(SiS_Pr);\n   \n  if(SiS_Pr->SiS_UseROM) {\n     romptr = SISGETROMW(0x116);\n     if(SiS_Pr->ChipType >= SIS_330) {\n        romptr = SISGETROMW(0x196);\n     }\n     if(SiS_Pr->SiS_VBType & VB_SIS30xBLV) {\n        romptr = SISGETROMW(0x11c);\n\tif(SiS_Pr->ChipType >= SIS_330) {\n\t   romptr = SISGETROMW(0x19c);\n\t}\n\tif((SiS_Pr->SiS_VBInfo & SetInSlaveMode) && (!(SiS_Pr->SiS_TVMode & TVSetTVSimuMode))) {\n\t   romptr = SISGETROMW(0x116);\n\t   if(SiS_Pr->ChipType >= SIS_330) {\n              romptr = SISGETROMW(0x196);\n           }\n\t}\n     }\n  }\n  if(romptr) {\n     romptr += (temp << 2);\n     for(j=0, i=0x31; i<=0x34; i++, j++) {\n        SiS_SetReg(SiS_Pr->SiS_Part2Port,i,ROMAddr[romptr + j]);\n     }\n  } else {\n     index = temp % 2;\n     temp >>= 1;           \n     for(j=0, i=0x31; i<=0x34; i++, j++) {\n        if(!(SiS_Pr->SiS_VBType & VB_SIS30xBLV))\n\t   SiS_SetReg(SiS_Pr->SiS_Part2Port,i,SiS310_TVPhaseIncr1[temp][index][j]);\n        else if((!(SiS_Pr->SiS_VBInfo & SetInSlaveMode)) || (SiS_Pr->SiS_TVMode & TVSetTVSimuMode))\n           SiS_SetReg(SiS_Pr->SiS_Part2Port,i,SiS310_TVPhaseIncr2[temp][index][j]);\n        else\n           SiS_SetReg(SiS_Pr->SiS_Part2Port,i,SiS310_TVPhaseIncr1[temp][index][j]);\n     }\n  }\n\n  if((SiS_Pr->SiS_VBType & VB_SIS30xBLV) && (!(SiS_Pr->SiS_VBInfo & SetCRT2ToHiVision))) {\n     if((!(SiS_Pr->SiS_TVMode & (TVSetPAL | TVSetYPbPr525p | TVSetYPbPr750p))) && (ModeNo > 0x13)) {\n        if((resinfo == SIS_RI_640x480) ||\n\t   (resinfo == SIS_RI_800x600)) {\n\t   SiS_SetReg(SiS_Pr->SiS_Part2Port,0x31,0x21);\n\t   SiS_SetReg(SiS_Pr->SiS_Part2Port,0x32,0xf0);\n\t   SiS_SetReg(SiS_Pr->SiS_Part2Port,0x33,0xf5);\n\t   SiS_SetReg(SiS_Pr->SiS_Part2Port,0x34,0x7f);\n\t} else if(resinfo == SIS_RI_1024x768) {\n\t   SiS_SetReg(SiS_Pr->SiS_Part2Port,0x31,0x1e);\n\t   SiS_SetReg(SiS_Pr->SiS_Part2Port,0x32,0x8b);\n\t   SiS_SetReg(SiS_Pr->SiS_Part2Port,0x33,0xfb);\n\t   SiS_SetReg(SiS_Pr->SiS_Part2Port,0x34,0x7b);\n\t}\n     }\n  }\n}\n\nstatic void\nSetDelayComp661(struct SiS_Private *SiS_Pr, unsigned short ModeNo,\n                unsigned short ModeIdIndex, unsigned short RTI)\n{\n   unsigned short delay = 0, romptr = 0, index, lcdpdcindex;\n   unsigned char  *ROMAddr = SiS_Pr->VirtualRomBase;\n\n   if(!(SiS_Pr->SiS_VBInfo & (SetCRT2ToTV | SetCRT2ToLCD | SetCRT2ToLCDA | SetCRT2ToRAMDAC)))\n      return;\n\n    \n    \n\n   if(SiS_Pr->SiS_ROMNew) {\n      if((SiS_Pr->SiS_VBInfo & SetCRT2ToRAMDAC) \t\t\t||\n         ((SiS_Pr->SiS_VBInfo & (SetCRT2ToLCD | SetCRT2ToLCDA)) &&\n\t  (SiS_Pr->SiS_LCDInfo & LCDPass11))) {\n         index = 25;\n         if(SiS_Pr->UseCustomMode) {\n\t    index = SiS_Pr->CSRClock;\n         } else if(ModeNo > 0x13) {\n            index = SiS_GetVCLK2Ptr(SiS_Pr,ModeNo,ModeIdIndex,RTI);\n            index = SiS_Pr->SiS_VCLKData[index].CLOCK;\n         }\n\t if(index < 25) index = 25;\n         index = ((index / 25) - 1) << 1;\n         if((ROMAddr[0x5b] & 0x80) || (SiS_Pr->SiS_VBInfo & (SetCRT2ToRAMDAC | SetCRT2ToLCD))) {\n\t    index++;\n\t }\n\t romptr = SISGETROMW(0x104);\n         delay = ROMAddr[romptr + index];\n         if(SiS_Pr->SiS_VBInfo & (SetCRT2ToRAMDAC | SetCRT2ToLCD)) {\n            SiS_SetRegANDOR(SiS_Pr->SiS_Part1Port,0x2d,0xf0,((delay >> 1) & 0x0f));\n            SiS_SetRegANDOR(SiS_Pr->SiS_Part1Port,0x35,0x7f,((delay & 0x01) << 7));\n         } else {\n            SiS_SetRegANDOR(SiS_Pr->SiS_Part1Port,0x2d,0x0f,((delay << 3) & 0xf0));\n\t    SiS_SetRegANDOR(SiS_Pr->SiS_Part1Port,0x20,0xbf,((delay & 0x01) << 6));\n         }\n         return;\n      }\n   }\n\n    \n\n   if(SiS_Pr->UseCustomMode) delay = 0x04;\n   else if(ModeNo <= 0x13)   delay = 0x04;\n   else                      delay = (SiS_Pr->SiS_RefIndex[RTI].Ext_PDC >> 4);\n   delay |= (delay << 8);\n\n   if(SiS_Pr->ChipType >= XGI_20) {\n\n      delay = 0x0606;\n      if(SiS_Pr->SiS_VBInfo & SetCRT2ToTV) {\n\n\t delay = 0x0404;\n         if(SiS_Pr->SiS_XGIROM) {\n\t     index = GetTVPtrIndex(SiS_Pr);\n\t     if((romptr = SISGETROMW(0x35e))) {\n\t        delay = (ROMAddr[romptr + index] & 0x0f) << 1;\n\t\tdelay |= (delay << 8);\n\t     }\n\t }\n\n\t if(SiS_Pr->SiS_VBInfo & SetCRT2ToHiVision) {\n\t    if(SiS_Pr->ChipType == XGI_40 && SiS_Pr->ChipRevision == 0x02) {\n\t       delay -= 0x0404;\n\t    }\n\t }\n      }\n\n   } else if(SiS_Pr->ChipType >= SIS_340) {\n\n      delay = 0x0606;\n      if(SiS_Pr->SiS_VBInfo & SetCRT2ToTV) {\n         delay = 0x0404;\n      }\n       \n\n   } else if(SiS_Pr->SiS_VBInfo & SetCRT2ToTV) {\n\n       \n\n      index = GetOEMTVPtr661(SiS_Pr);\n      if(SiS_Pr->SiS_ROMNew) {\n         romptr = SISGETROMW(0x106);\n\t if(SiS_Pr->SiS_VBType & VB_UMC) romptr += 12;\n         delay = ROMAddr[romptr + index];\n      } else {\n         delay = 0x04;\n\t if(index > 3) delay = 0;\n      }\n\n   } else if(SiS_Pr->SiS_VBInfo & (SetCRT2ToLCD | SetCRT2ToLCDA)) {\n\n       \n\n      if( (SiS_Pr->SiS_LCDResInfo != Panel_Custom) &&\n          ((romptr = GetLCDStructPtr661_2(SiS_Pr))) ) {\n\n\t lcdpdcindex = (SiS_Pr->SiS_VBType & VB_UMC) ? 14 : 12;\n\n\t  \n\t delay = ROMAddr[romptr + lcdpdcindex + 1];\t \n\t delay |= (ROMAddr[romptr + lcdpdcindex] << 8);\t \n\n      } else {\n\n          \n\t  \n         if(!(SiS_Pr->SiS_LCDInfo & LCDPass11)) {\n\t    switch(SiS_Pr->SiS_LCDResInfo) {\n\t    case Panel_1024x768:  delay = 0x0008; break;\n\t    case Panel_1280x720:  delay = 0x0004; break;\n\t    case Panel_1280x768:\n\t    case Panel_1280x768_2:delay = 0x0004; break;\n\t    case Panel_1280x800:\n\t    case Panel_1280x800_2:delay = 0x0004; break;  \n\t    case Panel_1280x854:  delay = 0x0004; break;  \n\t    case Panel_1280x1024: delay = 0x1e04; break;\n\t    case Panel_1400x1050: delay = 0x0004; break;\n\t    case Panel_1600x1200: delay = 0x0400; break;\n\t    case Panel_1680x1050: delay = 0x0e04; break;\n\t    default:\n               if((SiS_Pr->PanelXRes <= 1024) && (SiS_Pr->PanelYRes <= 768)) {\n\t          delay = 0x0008;\n\t       } else if((SiS_Pr->PanelXRes == 1280) && (SiS_Pr->PanelYRes == 1024)) {\n\t          delay = 0x1e04;\n               } else if((SiS_Pr->PanelXRes <= 1400) && (SiS_Pr->PanelYRes <= 1050)) {\n\t          delay = 0x0004;\n\t       } else if((SiS_Pr->PanelXRes <= 1600) && (SiS_Pr->PanelYRes <= 1200)) {\n\t          delay = 0x0400;\n               } else\n\t          delay = 0x0e04;\n\t       break;\n\t    }\n         }\n\n\t  \n\t  \n         if((SiS_Pr->SiS_VBInfo & SetCRT2ToLCD) && (SiS_Pr->PDC != -1)) {\n            delay = SiS_Pr->PDC & 0x1f;\n         }\n         if((SiS_Pr->SiS_VBInfo & SetCRT2ToLCDA) && (SiS_Pr->PDCA != -1)) {\n            delay = (SiS_Pr->PDCA & 0x1f) << 8;\n         }\n\n      }\n\n   }\n\n   if(SiS_Pr->SiS_VBInfo & SetCRT2ToLCDA) {\n      delay >>= 8;\n      SiS_SetRegANDOR(SiS_Pr->SiS_Part1Port,0x2d,0x0f,((delay << 3) & 0xf0));\n      SiS_SetRegANDOR(SiS_Pr->SiS_Part1Port,0x20,0xbf,((delay & 0x01) << 6));\n   } else {\n      SiS_SetRegANDOR(SiS_Pr->SiS_Part1Port,0x2d,0xf0,((delay >> 1) & 0x0f));\n      SiS_SetRegANDOR(SiS_Pr->SiS_Part1Port,0x35,0x7f,((delay & 0x01) << 7));\n   }\n}\n\nstatic void\nSetCRT2SyncDither661(struct SiS_Private *SiS_Pr, unsigned short ModeNo, unsigned short RTI)\n{\n   unsigned short infoflag;\n   unsigned char  temp;\n\n   if(SiS_Pr->SiS_VBInfo & (SetCRT2ToLCD | SetCRT2ToLCDA)) {\n\n      if(ModeNo <= 0x13) {\n         infoflag = SiS_GetRegByte(SiS_Pr->SiS_P3ca+2);\n      } else if(SiS_Pr->UseCustomMode) {\n         infoflag = SiS_Pr->CInfoFlag;\n      } else {\n         infoflag = SiS_Pr->SiS_RefIndex[RTI].Ext_InfoFlag;\n      }\n\n      if(!(SiS_Pr->SiS_LCDInfo & LCDPass11)) {\n         infoflag = SiS_GetReg(SiS_Pr->SiS_P3d4,0x37);  \n      }\n\n      infoflag &= 0xc0;\n\n      if(SiS_Pr->SiS_VBInfo & SetCRT2ToLCD) {\n         temp = (infoflag >> 6) | 0x0c;\n         if(SiS_Pr->SiS_LCDInfo & LCDRGB18Bit) {\n\t    temp ^= 0x04;\n\t    if(SiS_Pr->SiS_ModeType >= Mode24Bpp) temp |= 0x10;\n\t }\n         SiS_SetRegANDOR(SiS_Pr->SiS_Part2Port,0x1a,0xe0,temp);\n      } else {\n         temp = 0x30;\n         if(SiS_Pr->SiS_LCDInfo & LCDRGB18Bit) temp = 0x20;\n         temp |= infoflag;\n         SiS_SetRegANDOR(SiS_Pr->SiS_Part1Port,0x19,0x0f,temp);\n         temp = 0;\n         if(SiS_Pr->SiS_LCDInfo & LCDRGB18Bit) {\n\t    if(SiS_Pr->SiS_ModeType >= Mode24Bpp) temp |= 0x80;\n\t }\n         SiS_SetRegANDOR(SiS_Pr->SiS_Part1Port,0x1a,0x7f,temp);\n      }\n\n   }\n}\n\nstatic void\nSetPanelParms661(struct SiS_Private *SiS_Pr)\n{\n   unsigned char  *ROMAddr = SiS_Pr->VirtualRomBase;\n   unsigned short romptr, temp1, temp2;\n\n   if(SiS_Pr->SiS_VBType & (VB_SISLVDS | VB_SIS30xC)) {\n      SiS_SetRegAND(SiS_Pr->SiS_Part4Port,0x24,0x0f);\n   }\n\n   if(SiS_Pr->SiS_VBType & VB_SISLVDS) {\n      if(SiS_Pr->LVDSHL != -1) {\n         SiS_SetRegANDOR(SiS_Pr->SiS_Part4Port,0x24,0xfc,SiS_Pr->LVDSHL);\n      }\n   }\n\n   if(SiS_Pr->SiS_ROMNew) {\n\n      if((romptr = GetLCDStructPtr661_2(SiS_Pr))) {\n         if(SiS_Pr->SiS_VBType & VB_SISLVDS) {\n            temp1 = (ROMAddr[romptr] & 0x03) | 0x0c;\n\t    temp2 = 0xfc;\n\t    if(SiS_Pr->LVDSHL != -1) {\n\t      temp1 &= 0xfc;\n\t      temp2 = 0xf3;\n\t    }\n\t    SiS_SetRegANDOR(SiS_Pr->SiS_Part4Port,0x24,temp2,temp1);\n         }\n\t if(SiS_Pr->SiS_VBInfo & SetCRT2ToLCD) {\n            temp1 = (ROMAddr[romptr + 1] & 0x80) >> 1;\n            SiS_SetRegANDOR(SiS_Pr->SiS_Part4Port,0x0d,0xbf,temp1);\n\t }\n      }\n\n   }\n}\n\nstatic void\nSiS_OEM310Setting(struct SiS_Private *SiS_Pr, unsigned short ModeNo, unsigned short ModeIdIndex, unsigned short RRTI)\n{\n   if((SiS_Pr->SiS_ROMNew) && (SiS_Pr->SiS_VBType & VB_SISLVDS)) {\n      SetDelayComp661(SiS_Pr, ModeNo, ModeIdIndex, RRTI);\n      if(SiS_Pr->SiS_VBInfo & (SetCRT2ToLCD | SetCRT2ToLCDA)) {\n         SetCRT2SyncDither661(SiS_Pr, ModeNo, RRTI);\n         SetPanelParms661(SiS_Pr);\n      }\n   } else {\n      SetDelayComp(SiS_Pr,ModeNo);\n   }\n\n   if((SiS_Pr->SiS_VBType & VB_SISVB) && (SiS_Pr->SiS_VBInfo & SetCRT2ToTV)) {\n      SetAntiFlicker(SiS_Pr,ModeNo,ModeIdIndex);\n      SetPhaseIncr(SiS_Pr,ModeNo,ModeIdIndex);\n      SetYFilter(SiS_Pr,ModeNo,ModeIdIndex);\n      if(SiS_Pr->SiS_VBType & VB_SIS301) {\n         SetEdgeEnhance(SiS_Pr,ModeNo,ModeIdIndex);\n      }\n   }\n}\n\nstatic void\nSiS_OEM661Setting(struct SiS_Private *SiS_Pr, unsigned short ModeNo,\n\t\t\tunsigned short ModeIdIndex, unsigned short RRTI)\n{\n   if(SiS_Pr->SiS_VBType & VB_SISVB) {\n\n      SetDelayComp661(SiS_Pr, ModeNo, ModeIdIndex, RRTI);\n\n      if(SiS_Pr->SiS_VBInfo & (SetCRT2ToLCD | SetCRT2ToLCDA)) {\n         SetCRT2SyncDither661(SiS_Pr, ModeNo, RRTI);\n         SetPanelParms661(SiS_Pr);\n      }\n\n      if(SiS_Pr->SiS_VBInfo & SetCRT2ToTV) {\n         SetPhaseIncr(SiS_Pr, ModeNo, ModeIdIndex);\n         SetYFilter(SiS_Pr, ModeNo, ModeIdIndex);\n         SetAntiFlicker(SiS_Pr, ModeNo, ModeIdIndex);\n         if(SiS_Pr->SiS_VBType & VB_SIS301) {\n            SetEdgeEnhance(SiS_Pr, ModeNo, ModeIdIndex);\n         }\n      }\n   }\n}\n\n \nstatic void\nSiS_FinalizeLCD(struct SiS_Private *SiS_Pr, unsigned short ModeNo, unsigned short ModeIdIndex)\n{\n  unsigned short tempcl,tempch,tempbl,tempbh,tempbx,tempax,temp;\n  unsigned short resinfo,modeflag;\n\n  if(!(SiS_Pr->SiS_VBType & VB_SISLVDS)) return;\n  if(SiS_Pr->SiS_ROMNew) return;\n\n  if(SiS_Pr->SiS_VBInfo & (SetCRT2ToLCD | SetCRT2ToLCDA)) {\n     if(SiS_Pr->LVDSHL != -1) {\n        SiS_SetRegANDOR(SiS_Pr->SiS_Part4Port,0x24,0xfc,SiS_Pr->LVDSHL);\n     }\n  }\n\n  if(SiS_Pr->SiS_LCDResInfo == Panel_Custom) return;\n  if(SiS_Pr->UseCustomMode) return;\n\n  switch(SiS_Pr->SiS_CustomT) {\n  case CUT_COMPAQ1280:\n  case CUT_COMPAQ12802:\n  case CUT_CLEVO1400:\n  case CUT_CLEVO14002:\n     return;\n  }\n\n  if(ModeNo <= 0x13) {\n     resinfo = SiS_Pr->SiS_SModeIDTable[ModeIdIndex].St_ResInfo;\n     modeflag =  SiS_Pr->SiS_SModeIDTable[ModeIdIndex].St_ModeFlag;\n  } else {\n     resinfo = SiS_Pr->SiS_EModeIDTable[ModeIdIndex].Ext_RESINFO;\n     modeflag =  SiS_Pr->SiS_EModeIDTable[ModeIdIndex].Ext_ModeFlag;\n  }\n\n  if(IS_SIS650) {\n     if(!(SiS_GetReg(SiS_Pr->SiS_P3d4, 0x5f) & 0xf0)) {\n        if(SiS_Pr->SiS_CustomT == CUT_CLEVO1024) {\n\t   SiS_SetRegOR(SiS_Pr->SiS_Part1Port,0x1e,0x02);\n\t} else {\n           SiS_SetRegOR(SiS_Pr->SiS_Part1Port,0x1e,0x03);\n\t}\n     }\n  }\n\n  if(SiS_Pr->SiS_CustomT == CUT_CLEVO1024) {\n     if(SiS_Pr->SiS_LCDResInfo == Panel_1024x768) {\n         \n        if(SiS_Pr->LVDSHL == -1) {\n           SiS_SetRegANDOR(SiS_Pr->SiS_Part4Port,0x24,0xfc,0x01);\n\t}\n\treturn;\n     }\n  }\n\n  if(SiS_Pr->SiS_CustomT == CUT_CLEVO10242) {\n     if(SiS_Pr->SiS_VBInfo & (SetCRT2ToLCD | SetCRT2ToLCDA)) {\n        if(SiS_Pr->SiS_LCDResInfo == Panel_1024x768) {\n\t   if(SiS_Pr->LVDSHL == -1) {\n\t       \n              SiS_SetRegANDOR(SiS_Pr->SiS_Part4Port,0x24,0xfc,0x01);\n\t   }\n\t   if(SiS_Pr->SiS_VBInfo & SetCRT2ToLCDA) {\n\t      tempch = SiS_GetReg(SiS_Pr->SiS_P3d4,0x36) >> 4;\n\t      if(tempch == 3) {\n\t         SiS_SetReg(SiS_Pr->SiS_Part1Port,0x18,0x02);\n\t         SiS_SetReg(SiS_Pr->SiS_Part1Port,0x1b,0x25);\n\t         SiS_SetReg(SiS_Pr->SiS_Part1Port,0x1c,0x00);\n\t         SiS_SetReg(SiS_Pr->SiS_Part1Port,0x1d,0x1b);\n\t      }\n\t   }\n\t   return;\n\t}\n     }\n  }\n\n  if(SiS_Pr->SiS_VBInfo & (SetCRT2ToLCD | SetCRT2ToLCDA)) {\n     if(SiS_Pr->SiS_LCDResInfo == Panel_1024x768) {\n\tif(SiS_Pr->SiS_VBType & VB_SISEMI) {\n\t   SiS_SetReg(SiS_Pr->SiS_Part4Port,0x2a,0x00);\n#ifdef SET_EMI\n\t   SiS_SetRegAND(SiS_Pr->SiS_Part4Port,0x30,0x0c);\n#endif\n\t   SiS_SetReg(SiS_Pr->SiS_Part4Port,0x34,0x10);\n\t}\n     } else if(SiS_Pr->SiS_LCDResInfo == Panel_1280x1024) {\n        if(SiS_Pr->LVDSHL == -1) {\n            \n           SiS_SetRegANDOR(SiS_Pr->SiS_Part4Port,0x24,0xfc,0x01);\n\t}\n     }\n     tempch = SiS_GetReg(SiS_Pr->SiS_P3d4,0x36) >> 4;\n     if(SiS_Pr->SiS_VBInfo & SetCRT2ToLCDA) {\n\tif(SiS_Pr->SiS_LCDResInfo == Panel_1400x1050) {\n\t   SiS_SetReg(SiS_Pr->SiS_Part1Port,0x1f,0x76);\n\t} else if(SiS_Pr->SiS_LCDResInfo == Panel_1024x768) {\n\t   if(tempch == 0x03) {\n\t      SiS_SetReg(SiS_Pr->SiS_Part1Port,0x18,0x02);\n\t      SiS_SetReg(SiS_Pr->SiS_Part1Port,0x1b,0x25);\n\t      SiS_SetReg(SiS_Pr->SiS_Part1Port,0x1c,0x00);\n\t      SiS_SetReg(SiS_Pr->SiS_Part1Port,0x1d,0x1b);\n\t   }\n\t   if(SiS_Pr->Backup && (SiS_Pr->Backup_Mode == ModeNo)) {\n\t      SiS_SetReg(SiS_Pr->SiS_Part1Port,0x14,SiS_Pr->Backup_14);\n\t      SiS_SetReg(SiS_Pr->SiS_Part1Port,0x15,SiS_Pr->Backup_15);\n\t      SiS_SetReg(SiS_Pr->SiS_Part1Port,0x16,SiS_Pr->Backup_16);\n\t      SiS_SetReg(SiS_Pr->SiS_Part1Port,0x17,SiS_Pr->Backup_17);\n\t      SiS_SetReg(SiS_Pr->SiS_Part1Port,0x18,SiS_Pr->Backup_18);\n\t      SiS_SetReg(SiS_Pr->SiS_Part1Port,0x19,SiS_Pr->Backup_19);\n\t      SiS_SetReg(SiS_Pr->SiS_Part1Port,0x1a,SiS_Pr->Backup_1a);\n\t      SiS_SetReg(SiS_Pr->SiS_Part1Port,0x1b,SiS_Pr->Backup_1b);\n\t      SiS_SetReg(SiS_Pr->SiS_Part1Port,0x1c,SiS_Pr->Backup_1c);\n\t      SiS_SetReg(SiS_Pr->SiS_Part1Port,0x1d,SiS_Pr->Backup_1d);\n\t   } else if(!(SiS_Pr->SiS_LCDInfo & DontExpandLCD)) {\t \n\t      SiS_SetReg(SiS_Pr->SiS_Part1Port,0x14,0x90);\n\t      if(ModeNo <= 0x13) {\n\t         SiS_SetReg(SiS_Pr->SiS_Part1Port,0x18,0x11);\n\t\t if((resinfo == 0) || (resinfo == 2)) return;\n\t\t SiS_SetReg(SiS_Pr->SiS_Part1Port,0x18,0x18);\n\t\t if((resinfo == 1) || (resinfo == 3)) return;\n\t      }\n\t      SiS_SetReg(SiS_Pr->SiS_Part1Port,0x18,0x02);\n\t      if((ModeNo > 0x13) && (resinfo == SIS_RI_1024x768)) {\n\t         SiS_SetReg(SiS_Pr->SiS_Part1Port,0x18,0x02);   \n#if 0\n\t         tempbx = 806;   \t\t\t  \n\t\t tempbx--;\n\t\t temp = tempbx & 0xff;\n\t\t SiS_SetReg(SiS_Pr->SiS_Part1Port,0x1b,temp);\n\t\t temp = (tempbx >> 8) & 0x03;\n\t\t SiS_SetRegANDOR(SiS_Pr->SiS_Part1Port,0x1d,0xf8,temp);\n#endif\n\t      }\n\t   } else if(ModeNo <= 0x13) {\n\t      if(ModeNo <= 1) {\n\t\t SiS_SetReg(SiS_Pr->SiS_Part1Port,0x18,0x70);\n\t\t SiS_SetReg(SiS_Pr->SiS_Part1Port,0x19,0xff);\n\t\t SiS_SetReg(SiS_Pr->SiS_Part1Port,0x1b,0x48);\n\t\t SiS_SetReg(SiS_Pr->SiS_Part1Port,0x1d,0x12);\n\t      }\n\t      if(!(modeflag & HalfDCLK)) {\n\t\t SiS_SetReg(SiS_Pr->SiS_Part1Port,0x14,0x20);\n\t\t SiS_SetReg(SiS_Pr->SiS_Part1Port,0x15,0x1a);\n\t\t SiS_SetReg(SiS_Pr->SiS_Part1Port,0x16,0x28);\n\t\t SiS_SetReg(SiS_Pr->SiS_Part1Port,0x17,0x00);\n\t\t SiS_SetReg(SiS_Pr->SiS_Part1Port,0x18,0x4c);\n\t\t SiS_SetReg(SiS_Pr->SiS_Part1Port,0x19,0xdc);\n\t\t if(ModeNo == 0x12) {\n\t\t    switch(tempch) {\n\t\t       case 0:\n\t\t\t  SiS_SetReg(SiS_Pr->SiS_Part1Port,0x18,0x95);\n\t\t\t  SiS_SetReg(SiS_Pr->SiS_Part1Port,0x19,0xdc);\n\t\t\t  SiS_SetReg(SiS_Pr->SiS_Part1Port,0x1a,0x10);\n\t\t\t  SiS_SetReg(SiS_Pr->SiS_Part1Port,0x1b,0x95);\n\t\t\t  SiS_SetReg(SiS_Pr->SiS_Part1Port,0x1c,0x48);\n\t\t\t  SiS_SetReg(SiS_Pr->SiS_Part1Port,0x1d,0x12);\n\t\t\t  break;\n\t\t       case 2:\n\t\t\t  SiS_SetReg(SiS_Pr->SiS_Part1Port,0x18,0x95);\n\t\t\t  SiS_SetReg(SiS_Pr->SiS_Part1Port,0x1b,0x48);\n\t\t\t  break;\n\t\t       case 3:\n\t\t\t  SiS_SetReg(SiS_Pr->SiS_Part1Port,0x1b,0x95);\n\t\t\t  break;\n\t\t    }\n\t\t }\n\t      }\n\t   }\n\t}\n     } else {\n        tempcl = tempbh = SiS_GetReg(SiS_Pr->SiS_Part2Port,0x01);\n\ttempcl &= 0x0f;\n\ttempbh &= 0x70;\n\ttempbh >>= 4;\n\ttempbl = SiS_GetReg(SiS_Pr->SiS_Part2Port,0x04);\n\ttempbx = (tempbh << 8) | tempbl;\n\tif(SiS_Pr->SiS_LCDResInfo == Panel_1024x768) {\n\t   if((resinfo == SIS_RI_1024x768) || (!(SiS_Pr->SiS_LCDInfo & DontExpandLCD))) {\n\t      if(SiS_Pr->SiS_SetFlag & LCDVESATiming) {\n\t      \t tempbx = 770;\n\t      } else {\n\t         if(tempbx > 770) tempbx = 770;\n\t\t if(SiS_Pr->SiS_VGAVDE < 600) {\n\t\t    tempax = 768 - SiS_Pr->SiS_VGAVDE;\n\t\t    tempax >>= 4;  \t\t\t\t  \n\t\t    if(SiS_Pr->SiS_VGAVDE <= 480)  tempax >>= 4;  \n\t\t    tempbx -= tempax;\n\t\t }\n\t      }\n\t   } else return;\n\t}\n\ttemp = tempbx & 0xff;\n\tSiS_SetReg(SiS_Pr->SiS_Part2Port,0x04,temp);\n\ttemp = ((tempbx & 0xff00) >> 4) | tempcl;\n\tSiS_SetRegANDOR(SiS_Pr->SiS_Part2Port,0x01,0x80,temp);\n     }\n  }\n}\n\n#endif\n\n \n\n#ifdef CONFIG_FB_SIS_300\n\nstatic void\nSetOEMLCDData2(struct SiS_Private *SiS_Pr, unsigned short ModeNo,unsigned short ModeIdIndex,\n\t\tunsigned short RefTabIndex)\n{\n  unsigned short crt2crtc=0, modeflag, myindex=0;\n  unsigned char  temp;\n  int i;\n\n  if(ModeNo <= 0x13) {\n     modeflag = SiS_Pr->SiS_SModeIDTable[ModeIdIndex].St_ModeFlag;\n     crt2crtc = SiS_Pr->SiS_SModeIDTable[ModeIdIndex].St_CRT2CRTC;\n  } else {\n     modeflag = SiS_Pr->SiS_EModeIDTable[ModeIdIndex].Ext_ModeFlag;\n     crt2crtc = SiS_Pr->SiS_RefIndex[RefTabIndex].Ext_CRT2CRTC;\n  }\n\n  crt2crtc &= 0x3f;\n\n  if(SiS_Pr->SiS_CustomT == CUT_BARCO1024) {\n     SiS_SetRegAND(SiS_Pr->SiS_Part1Port,0x13,0xdf);\n  }\n\n  if(SiS_Pr->SiS_CustomT == CUT_BARCO1366) {\n     if(modeflag & HalfDCLK) myindex = 1;\n\n     if(SiS_Pr->SiS_SetFlag & LowModeTests) {\n        for(i=0; i<7; i++) {\n           if(barco_p1[myindex][crt2crtc][i][0]) {\n\t      SiS_SetRegANDOR(SiS_Pr->SiS_Part1Port,\n\t                      barco_p1[myindex][crt2crtc][i][0],\n\t   \t   \t      barco_p1[myindex][crt2crtc][i][2],\n\t\t\t      barco_p1[myindex][crt2crtc][i][1]);\n\t   }\n        }\n     }\n     temp = SiS_GetReg(SiS_Pr->SiS_Part1Port,0x00);\n     if(temp & 0x80) {\n        temp = SiS_GetReg(SiS_Pr->SiS_Part1Port,0x18);\n        temp++;\n        SiS_SetReg(SiS_Pr->SiS_Part1Port,0x18,temp);\n     }\n  }\n}\n\nstatic unsigned short\nGetOEMLCDPtr(struct SiS_Private *SiS_Pr, int Flag)\n{\n  unsigned char  *ROMAddr = SiS_Pr->VirtualRomBase;\n  unsigned short tempbx=0,romptr=0;\n  static const unsigned char customtable300[] = {\n\t0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,\n\t0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff\n  };\n  static const unsigned char customtable630[] = {\n\t0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,\n\t0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff\n  };\n\n  if(SiS_Pr->ChipType == SIS_300) {\n\n    tempbx = SiS_GetReg(SiS_Pr->SiS_P3d4,0x36) & 0x0f;\n    if(SiS_Pr->SiS_VBType & VB_SIS301) tempbx &= 0x07;\n    tempbx -= 2;\n    if(!(SiS_Pr->SiS_SetFlag & LCDVESATiming)) tempbx += 4;\n    if(SiS_Pr->SiS_LCDResInfo == Panel_1024x768) {\n       if(SiS_Pr->SiS_LCDInfo & DontExpandLCD) tempbx += 3;\n    }\n    if(SiS_Pr->SiS_UseROM) {\n       if(ROMAddr[0x235] & 0x80) {\n          tempbx = SiS_Pr->SiS_LCDTypeInfo;\n          if(Flag) {\n\t     romptr = SISGETROMW(0x255);\n\t     if(romptr) tempbx = ROMAddr[romptr + SiS_Pr->SiS_LCDTypeInfo];\n\t     else       tempbx = customtable300[SiS_Pr->SiS_LCDTypeInfo];\n             if(tempbx == 0xFF) return 0xFFFF;\n          }\n\t  tempbx <<= 1;\n\t  if(!(SiS_Pr->SiS_SetFlag & LCDVESATiming)) tempbx++;\n       }\n    }\n\n  } else {\n\n    if(Flag) {\n       if(SiS_Pr->SiS_UseROM) {\n          romptr = SISGETROMW(0x255);\n\t  if(romptr) tempbx = ROMAddr[romptr + SiS_Pr->SiS_LCDTypeInfo];\n\t  else \t     tempbx = 0xff;\n       } else {\n          tempbx = customtable630[SiS_Pr->SiS_LCDTypeInfo];\n       }\n       if(tempbx == 0xFF) return 0xFFFF;\n       tempbx <<= 2;\n       if(SiS_Pr->SiS_VBInfo & SetInSlaveMode) tempbx += 2;\n       if(SiS_Pr->SiS_LCDInfo & DontExpandLCD) tempbx++;\n       return tempbx;\n    }\n    tempbx = SiS_Pr->SiS_LCDTypeInfo << 2;\n    if(SiS_Pr->SiS_VBInfo & SetInSlaveMode) tempbx += 2;\n    if(SiS_Pr->SiS_LCDInfo & DontExpandLCD) tempbx++;\n\n  }\n\n  return tempbx;\n}\n\nstatic void\nSetOEMLCDDelay(struct SiS_Private *SiS_Pr, unsigned short ModeNo,unsigned short ModeIdIndex)\n{\n  unsigned char  *ROMAddr = SiS_Pr->VirtualRomBase;\n  unsigned short index,temp,romptr=0;\n\n  if(SiS_Pr->SiS_LCDResInfo == Panel_Custom) return;\n\n  if(SiS_Pr->SiS_UseROM) {\n     if(!(ROMAddr[0x237] & 0x01)) return;\n     if(!(ROMAddr[0x237] & 0x02)) return;\n     romptr = SISGETROMW(0x24b);\n  }\n\n   \n  if(SiS_Pr->PDC != -1) return;\n\n  temp = GetOEMLCDPtr(SiS_Pr, 0);\n\n  if(SiS_Pr->UseCustomMode)\n     index = 0;\n  else\n     index = SiS_Pr->SiS_VBModeIDTable[ModeIdIndex].VB_LCDDelayIndex;\n\n  if(SiS_Pr->ChipType != SIS_300) {\n     if(romptr) {\n\tromptr += (temp * 2);\n\tromptr = SISGETROMW(romptr);\n\tromptr += index;\n\ttemp = ROMAddr[romptr];\n     } else {\n\tif(SiS_Pr->SiS_VBType & VB_SISVB) {\n    \t   temp = SiS300_OEMLCDDelay2[temp][index];\n\t} else {\n           temp = SiS300_OEMLCDDelay3[temp][index];\n        }\n     }\n  } else {\n     if(SiS_Pr->SiS_UseROM && (ROMAddr[0x235] & 0x80)) {\n\tif(romptr) {\n\t   romptr += (temp * 2);\n\t   romptr = SISGETROMW(romptr);\n\t   romptr += index;\n\t   temp = ROMAddr[romptr];\n\t} else {\n\t   temp = SiS300_OEMLCDDelay5[temp][index];\n\t}\n     } else {\n        if(SiS_Pr->SiS_UseROM) {\n\t   romptr = ROMAddr[0x249] | (ROMAddr[0x24a] << 8);\n\t   if(romptr) {\n\t      romptr += (temp * 2);\n\t      romptr = SISGETROMW(romptr);\n\t      romptr += index;\n\t      temp = ROMAddr[romptr];\n\t   } else {\n\t      temp = SiS300_OEMLCDDelay4[temp][index];\n\t   }\n\t} else {\n\t   temp = SiS300_OEMLCDDelay4[temp][index];\n\t}\n     }\n  }\n  temp &= 0x3c;\n  SiS_SetRegANDOR(SiS_Pr->SiS_Part1Port,0x13,~0x3C,temp);   \n}\n\nstatic void\nSetOEMLCDData(struct SiS_Private *SiS_Pr, unsigned short ModeNo, unsigned short ModeIdIndex)\n{\n#if 0   \n  unsigned char  *ROMAddr = SiS_Pr->VirtualRomBase;\n  unsigned short index,temp;\n\n  if((SiS_Pr->SiS_UseROM) {\n     if(!(ROMAddr[0x237] & 0x01)) return;\n     if(!(ROMAddr[0x237] & 0x04)) return;\n      \n  }\n\n  temp = GetOEMLCDPtr(SiS_Pr, 1);\n  if(temp == 0xFFFF) return;\n\n  index = SiS_Pr->SiS_VBModeIDTable[ModeIdIndex]._VB_LCDHIndex;\n  for(i=0x14, j=0; i<=0x17; i++, j++) {\n      SiS_SetReg(SiS_Pr->SiS_Part1Port,i,SiS300_LCDHData[temp][index][j]);\n  }\n  SiS_SetRegANDOR(SiS_SiS_Part1Port,0x1a, 0xf8, (SiS300_LCDHData[temp][index][j] & 0x07));\n\n  index = SiS_Pr->SiS_VBModeIDTable[ModeIdIndex]._VB_LCDVIndex;\n  SiS_SetReg(SiS_SiS_Part1Port,0x18, SiS300_LCDVData[temp][index][0]);\n  SiS_SetRegANDOR(SiS_SiS_Part1Port,0x19, 0xF0, SiS300_LCDVData[temp][index][1]);\n  SiS_SetRegANDOR(SiS_SiS_Part1Port,0x1A, 0xC7, (SiS300_LCDVData[temp][index][2] & 0x38));\n  for(i=0x1b, j=3; i<=0x1d; i++, j++) {\n      SiS_SetReg(SiS_Pr->SiS_Part1Port,i,SiS300_LCDVData[temp][index][j]);\n  }\n#endif\n}\n\nstatic unsigned short\nGetOEMTVPtr(struct SiS_Private *SiS_Pr)\n{\n  unsigned short index;\n\n  index = 0;\n  if(!(SiS_Pr->SiS_VBInfo & SetInSlaveMode))  index += 4;\n  if(SiS_Pr->SiS_VBType & VB_SISVB) {\n     if(SiS_Pr->SiS_VBInfo & SetCRT2ToSCART)  index += 2;\n     else if(SiS_Pr->SiS_VBInfo & SetCRT2ToHiVision) index += 3;\n     else if(SiS_Pr->SiS_TVMode & TVSetPAL)   index += 1;\n  } else {\n     if(SiS_Pr->SiS_TVMode & TVSetCHOverScan) index += 2;\n     if(SiS_Pr->SiS_TVMode & TVSetPAL)        index += 1;\n  }\n  return index;\n}\n\nstatic void\nSetOEMTVDelay(struct SiS_Private *SiS_Pr, unsigned short ModeNo, unsigned short ModeIdIndex)\n{\n  unsigned char  *ROMAddr = SiS_Pr->VirtualRomBase;\n  unsigned short index,temp,romptr=0;\n\n  if(SiS_Pr->SiS_UseROM) {\n     if(!(ROMAddr[0x238] & 0x01)) return;\n     if(!(ROMAddr[0x238] & 0x02)) return;\n     romptr = SISGETROMW(0x241);\n  }\n\n  temp = GetOEMTVPtr(SiS_Pr);\n\n  index = SiS_Pr->SiS_VBModeIDTable[ModeIdIndex].VB_TVDelayIndex;\n\n  if(romptr) {\n     romptr += (temp * 2);\n     romptr = SISGETROMW(romptr);\n     romptr += index;\n     temp = ROMAddr[romptr];\n  } else {\n     if(SiS_Pr->SiS_VBType & VB_SISVB) {\n        temp = SiS300_OEMTVDelay301[temp][index];\n     } else {\n        temp = SiS300_OEMTVDelayLVDS[temp][index];\n     }\n  }\n  temp &= 0x3c;\n  SiS_SetRegANDOR(SiS_Pr->SiS_Part1Port,0x13,~0x3C,temp);\n}\n\nstatic void\nSetOEMAntiFlicker(struct SiS_Private *SiS_Pr, unsigned short ModeNo, unsigned short ModeIdIndex)\n{\n  unsigned char  *ROMAddr = SiS_Pr->VirtualRomBase;\n  unsigned short index,temp,romptr=0;\n\n  if(SiS_Pr->SiS_UseROM) {\n     if(!(ROMAddr[0x238] & 0x01)) return;\n     if(!(ROMAddr[0x238] & 0x04)) return;\n     romptr = SISGETROMW(0x243);\n  }\n\n  temp = GetOEMTVPtr(SiS_Pr);\n\n  index = SiS_Pr->SiS_VBModeIDTable[ModeIdIndex].VB_TVFlickerIndex;\n\n  if(romptr) {\n     romptr += (temp * 2);\n     romptr = SISGETROMW(romptr);\n     romptr += index;\n     temp = ROMAddr[romptr];\n  } else {\n     temp = SiS300_OEMTVFlicker[temp][index];\n  }\n  temp &= 0x70;\n  SiS_SetRegANDOR(SiS_Pr->SiS_Part2Port,0x0A,0x8F,temp);\n}\n\nstatic void\nSetOEMPhaseIncr(struct SiS_Private *SiS_Pr, unsigned short ModeNo,unsigned short ModeIdIndex)\n{\n  unsigned char  *ROMAddr = SiS_Pr->VirtualRomBase;\n  unsigned short index,i,j,temp,romptr=0;\n\n  if(SiS_Pr->SiS_VBInfo & SetCRT2ToHiVision) return;\n\n  if(SiS_Pr->SiS_TVMode & (TVSetNTSC1024 | TVSetNTSCJ | TVSetPALM | TVSetPALN)) return;\n\n  if(SiS_Pr->SiS_UseROM) {\n     if(!(ROMAddr[0x238] & 0x01)) return;\n     if(!(ROMAddr[0x238] & 0x08)) return;\n     romptr = SISGETROMW(0x245);\n  }\n\n  temp = GetOEMTVPtr(SiS_Pr);\n\n  index = SiS_Pr->SiS_VBModeIDTable[ModeIdIndex].VB_TVPhaseIndex;\n\n  if(SiS_Pr->SiS_VBType & VB_SIS30xBLV) {\n     for(i=0x31, j=0; i<=0x34; i++, j++) {\n        SiS_SetReg(SiS_Pr->SiS_Part2Port,i,SiS300_Phase2[temp][index][j]);\n     }\n  } else {\n     if(romptr) {\n        romptr += (temp * 2);\n\tromptr = SISGETROMW(romptr);\n\tromptr += (index * 4);\n        for(i=0x31, j=0; i<=0x34; i++, j++) {\n\t   SiS_SetReg(SiS_Pr->SiS_Part2Port,i,ROMAddr[romptr + j]);\n\t}\n     } else {\n        for(i=0x31, j=0; i<=0x34; i++, j++) {\n           SiS_SetReg(SiS_Pr->SiS_Part2Port,i,SiS300_Phase1[temp][index][j]);\n\t}\n     }\n  }\n}\n\nstatic void\nSetOEMYFilter(struct SiS_Private *SiS_Pr, unsigned short ModeNo, unsigned short ModeIdIndex)\n{\n  unsigned char  *ROMAddr = SiS_Pr->VirtualRomBase;\n  unsigned short index,temp,i,j,romptr=0;\n\n  if(SiS_Pr->SiS_VBInfo & (SetCRT2ToSCART | SetCRT2ToHiVision | SetCRT2ToYPbPr525750)) return;\n\n  if(SiS_Pr->SiS_UseROM) {\n     if(!(ROMAddr[0x238] & 0x01)) return;\n     if(!(ROMAddr[0x238] & 0x10)) return;\n     romptr = SISGETROMW(0x247);\n  }\n\n  temp = GetOEMTVPtr(SiS_Pr);\n\n  if(SiS_Pr->SiS_TVMode & TVSetPALM)      temp = 8;\n  else if(SiS_Pr->SiS_TVMode & TVSetPALN) temp = 9;\n   \n\n  index = SiS_Pr->SiS_VBModeIDTable[ModeIdIndex].VB_TVYFilterIndex;\n\n  if(SiS_Pr->SiS_VBType & VB_SIS30xBLV) {\n      for(i=0x35, j=0; i<=0x38; i++, j++) {\n       \tSiS_SetReg(SiS_Pr->SiS_Part2Port,i,SiS300_Filter2[temp][index][j]);\n      }\n      for(i=0x48; i<=0x4A; i++, j++) {\n     \tSiS_SetReg(SiS_Pr->SiS_Part2Port,i,SiS300_Filter2[temp][index][j]);\n      }\n  } else {\n      if((romptr) && (!(SiS_Pr->SiS_TVMode & (TVSetPALM|TVSetPALN)))) {\n         romptr += (temp * 2);\n\t romptr = SISGETROMW(romptr);\n\t romptr += (index * 4);\n\t for(i=0x35, j=0; i<=0x38; i++, j++) {\n       \t    SiS_SetReg(SiS_Pr->SiS_Part2Port,i,ROMAddr[romptr + j]);\n         }\n      } else {\n         for(i=0x35, j=0; i<=0x38; i++, j++) {\n       \t    SiS_SetReg(SiS_Pr->SiS_Part2Port,i,SiS300_Filter1[temp][index][j]);\n         }\n      }\n  }\n}\n\nstatic unsigned short\nSiS_SearchVBModeID(struct SiS_Private *SiS_Pr, unsigned short *ModeNo)\n{\n   unsigned short ModeIdIndex;\n   unsigned char  VGAINFO = SiS_Pr->SiS_VGAINFO;\n\n   if(*ModeNo <= 5) *ModeNo |= 1;\n\n   for(ModeIdIndex=0; ; ModeIdIndex++) {\n      if(SiS_Pr->SiS_VBModeIDTable[ModeIdIndex].ModeID == *ModeNo) break;\n      if(SiS_Pr->SiS_VBModeIDTable[ModeIdIndex].ModeID == 0xFF)    return 0;\n   }\n\n   if(*ModeNo != 0x07) {\n      if(*ModeNo > 0x03) return ModeIdIndex;\n      if(VGAINFO & 0x80) return ModeIdIndex;\n      ModeIdIndex++;\n   }\n\n   if(VGAINFO & 0x10) ModeIdIndex++;    \n\t                                \n   return ModeIdIndex;\n}\n\nstatic void\nSiS_OEM300Setting(struct SiS_Private *SiS_Pr, unsigned short ModeNo, unsigned short ModeIdIndex,\n\t\t  unsigned short RefTableIndex)\n{\n  unsigned short OEMModeIdIndex = 0;\n\n  if(!SiS_Pr->UseCustomMode) {\n     OEMModeIdIndex = SiS_SearchVBModeID(SiS_Pr,&ModeNo);\n     if(!(OEMModeIdIndex)) return;\n  }\n\n  if(SiS_Pr->SiS_VBInfo & SetCRT2ToLCD) {\n     SetOEMLCDDelay(SiS_Pr, ModeNo, OEMModeIdIndex);\n     if(SiS_Pr->SiS_IF_DEF_LVDS == 1) {\n        SetOEMLCDData(SiS_Pr, ModeNo, OEMModeIdIndex);\n     }\n  }\n  if(SiS_Pr->UseCustomMode) return;\n  if(SiS_Pr->SiS_VBInfo & SetCRT2ToTV) {\n     SetOEMTVDelay(SiS_Pr, ModeNo,OEMModeIdIndex);\n     if(SiS_Pr->SiS_VBType & VB_SISVB) {\n        SetOEMAntiFlicker(SiS_Pr, ModeNo, OEMModeIdIndex);\n    \tSetOEMPhaseIncr(SiS_Pr, ModeNo, OEMModeIdIndex);\n       \tSetOEMYFilter(SiS_Pr, ModeNo, OEMModeIdIndex);\n     }\n  }\n}\n#endif\n\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}