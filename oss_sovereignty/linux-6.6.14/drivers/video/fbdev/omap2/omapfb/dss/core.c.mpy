{
  "module_name": "core.c",
  "hash_id": "3e8581a3956bb801e490a011a65c4547a11422d102367e59711b0699ef9e3ef4",
  "original_prompt": "Ingested from linux-6.6.14/drivers/video/fbdev/omap2/omapfb/dss/core.c",
  "human_readable_source": "\n \n\n#define DSS_SUBSYS_NAME \"CORE\"\n\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/clk.h>\n#include <linux/err.h>\n#include <linux/platform_device.h>\n#include <linux/seq_file.h>\n#include <linux/debugfs.h>\n#include <linux/io.h>\n#include <linux/device.h>\n#include <linux/regulator/consumer.h>\n#include <linux/suspend.h>\n#include <linux/slab.h>\n\n#include <video/omapfb_dss.h>\n\n#include \"dss.h\"\n#include \"dss_features.h\"\n\nstatic struct {\n\tstruct platform_device *pdev;\n\n\tconst char *default_display_name;\n} core;\n\nstatic char *def_disp_name;\nmodule_param_named(def_disp, def_disp_name, charp, 0);\nMODULE_PARM_DESC(def_disp, \"default display name\");\n\nconst char *omapdss_get_default_display_name(void)\n{\n\treturn core.default_display_name;\n}\nEXPORT_SYMBOL(omapdss_get_default_display_name);\n\nenum omapdss_version omapdss_get_version(void)\n{\n\tstruct omap_dss_board_info *pdata = core.pdev->dev.platform_data;\n\treturn pdata->version;\n}\nEXPORT_SYMBOL(omapdss_get_version);\n\nstruct platform_device *dss_get_core_pdev(void)\n{\n\treturn core.pdev;\n}\n\nint dss_dsi_enable_pads(int dsi_id, unsigned lane_mask)\n{\n\tstruct omap_dss_board_info *board_data = core.pdev->dev.platform_data;\n\n\tif (!board_data->dsi_enable_pads)\n\t\treturn -ENOENT;\n\n\treturn board_data->dsi_enable_pads(dsi_id, lane_mask);\n}\n\nvoid dss_dsi_disable_pads(int dsi_id, unsigned lane_mask)\n{\n\tstruct omap_dss_board_info *board_data = core.pdev->dev.platform_data;\n\n\tif (!board_data->dsi_disable_pads)\n\t\treturn;\n\n\treturn board_data->dsi_disable_pads(dsi_id, lane_mask);\n}\n\nint dss_set_min_bus_tput(struct device *dev, unsigned long tput)\n{\n\tstruct omap_dss_board_info *pdata = core.pdev->dev.platform_data;\n\n\tif (pdata->set_min_bus_tput)\n\t\treturn pdata->set_min_bus_tput(dev, tput);\n\telse\n\t\treturn 0;\n}\n\n#if defined(CONFIG_FB_OMAP2_DSS_DEBUGFS)\nstatic int dss_show(struct seq_file *s, void *unused)\n{\n\tvoid (*func)(struct seq_file *) = s->private;\n\tfunc(s);\n\treturn 0;\n}\n\nDEFINE_SHOW_ATTRIBUTE(dss);\n\nstatic struct dentry *dss_debugfs_dir;\n\nstatic void dss_initialize_debugfs(void)\n{\n\tdss_debugfs_dir = debugfs_create_dir(\"omapdss\", NULL);\n\n\tdebugfs_create_file(\"clk\", S_IRUGO, dss_debugfs_dir,\n\t\t\t&dss_debug_dump_clocks, &dss_fops);\n}\n\nstatic void dss_uninitialize_debugfs(void)\n{\n\tdebugfs_remove_recursive(dss_debugfs_dir);\n}\n\nvoid dss_debugfs_create_file(const char *name, void (*write)(struct seq_file *))\n{\n\tdebugfs_create_file(name, S_IRUGO, dss_debugfs_dir, write, &dss_fops);\n}\n#else  \nstatic inline void dss_initialize_debugfs(void)\n{\n}\nstatic inline void dss_uninitialize_debugfs(void)\n{\n}\nvoid dss_debugfs_create_file(const char *name, void (*write)(struct seq_file *))\n{\n}\n#endif  \n\n \nstatic int omap_dss_pm_notif(struct notifier_block *b, unsigned long v, void *d)\n{\n\tDSSDBG(\"pm notif %lu\\n\", v);\n\n\tswitch (v) {\n\tcase PM_SUSPEND_PREPARE:\n\tcase PM_HIBERNATION_PREPARE:\n\tcase PM_RESTORE_PREPARE:\n\t\tDSSDBG(\"suspending displays\\n\");\n\t\treturn dss_suspend_all_devices();\n\n\tcase PM_POST_SUSPEND:\n\tcase PM_POST_HIBERNATION:\n\tcase PM_POST_RESTORE:\n\t\tDSSDBG(\"resuming displays\\n\");\n\t\treturn dss_resume_all_devices();\n\n\tdefault:\n\t\treturn 0;\n\t}\n}\n\nstatic struct notifier_block omap_dss_pm_notif_block = {\n\t.notifier_call = omap_dss_pm_notif,\n};\n\nstatic int __init omap_dss_probe(struct platform_device *pdev)\n{\n\tcore.pdev = pdev;\n\n\tdss_features_init(omapdss_get_version());\n\n\tdss_initialize_debugfs();\n\n\tif (def_disp_name)\n\t\tcore.default_display_name = def_disp_name;\n\n\tregister_pm_notifier(&omap_dss_pm_notif_block);\n\n\treturn 0;\n}\n\nstatic void omap_dss_remove(struct platform_device *pdev)\n{\n\tunregister_pm_notifier(&omap_dss_pm_notif_block);\n\n\tdss_uninitialize_debugfs();\n}\n\nstatic void omap_dss_shutdown(struct platform_device *pdev)\n{\n\tDSSDBG(\"shutdown\\n\");\n\tdss_disable_all_devices();\n}\n\nstatic struct platform_driver omap_dss_driver = {\n\t.remove_new     = omap_dss_remove,\n\t.shutdown\t= omap_dss_shutdown,\n\t.driver         = {\n\t\t.name   = \"omapdss\",\n\t},\n};\n\n \nstatic int (*dss_output_drv_reg_funcs[])(void) __initdata = {\n\tdss_init_platform_driver,\n\tdispc_init_platform_driver,\n#ifdef CONFIG_FB_OMAP2_DSS_DSI\n\tdsi_init_platform_driver,\n#endif\n#ifdef CONFIG_FB_OMAP2_DSS_DPI\n\tdpi_init_platform_driver,\n#endif\n#ifdef CONFIG_FB_OMAP2_DSS_SDI\n\tsdi_init_platform_driver,\n#endif\n#ifdef CONFIG_FB_OMAP2_DSS_VENC\n\tvenc_init_platform_driver,\n#endif\n#ifdef CONFIG_FB_OMAP4_DSS_HDMI\n\thdmi4_init_platform_driver,\n#endif\n#ifdef CONFIG_FB_OMAP5_DSS_HDMI\n\thdmi5_init_platform_driver,\n#endif\n};\n\nstatic void (*dss_output_drv_unreg_funcs[])(void) = {\n#ifdef CONFIG_FB_OMAP5_DSS_HDMI\n\thdmi5_uninit_platform_driver,\n#endif\n#ifdef CONFIG_FB_OMAP4_DSS_HDMI\n\thdmi4_uninit_platform_driver,\n#endif\n#ifdef CONFIG_FB_OMAP2_DSS_VENC\n\tvenc_uninit_platform_driver,\n#endif\n#ifdef CONFIG_FB_OMAP2_DSS_SDI\n\tsdi_uninit_platform_driver,\n#endif\n#ifdef CONFIG_FB_OMAP2_DSS_DPI\n\tdpi_uninit_platform_driver,\n#endif\n#ifdef CONFIG_FB_OMAP2_DSS_DSI\n\tdsi_uninit_platform_driver,\n#endif\n\tdispc_uninit_platform_driver,\n\tdss_uninit_platform_driver,\n};\n\nstatic int __init omap_dss_init(void)\n{\n\tint r;\n\tint i;\n\n\tr = platform_driver_probe(&omap_dss_driver, omap_dss_probe);\n\tif (r)\n\t\treturn r;\n\n\tfor (i = 0; i < ARRAY_SIZE(dss_output_drv_reg_funcs); ++i) {\n\t\tr = dss_output_drv_reg_funcs[i]();\n\t\tif (r)\n\t\t\tgoto err_reg;\n\t}\n\n\treturn 0;\n\nerr_reg:\n\tfor (i = ARRAY_SIZE(dss_output_drv_reg_funcs) - i;\n\t\t\ti < ARRAY_SIZE(dss_output_drv_reg_funcs);\n\t\t\t++i)\n\t\tdss_output_drv_unreg_funcs[i]();\n\n\tplatform_driver_unregister(&omap_dss_driver);\n\n\treturn r;\n}\n\nstatic void __exit omap_dss_exit(void)\n{\n\tint i;\n\n\tfor (i = 0; i < ARRAY_SIZE(dss_output_drv_unreg_funcs); ++i)\n\t\tdss_output_drv_unreg_funcs[i]();\n\n\tplatform_driver_unregister(&omap_dss_driver);\n}\n\nmodule_init(omap_dss_init);\nmodule_exit(omap_dss_exit);\n\nMODULE_AUTHOR(\"Tomi Valkeinen <tomi.valkeinen@nokia.com>\");\nMODULE_DESCRIPTION(\"OMAP2/3 Display Subsystem\");\nMODULE_LICENSE(\"GPL v2\");\n\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}