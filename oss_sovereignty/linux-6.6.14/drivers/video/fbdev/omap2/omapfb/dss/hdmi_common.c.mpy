{
  "module_name": "hdmi_common.c",
  "hash_id": "5b86ab44b1913aa30e87faa9e71f3a98328d248b006e649eeef7a9ea0fcadedf",
  "original_prompt": "Ingested from linux-6.6.14/drivers/video/fbdev/omap2/omapfb/dss/hdmi_common.c",
  "human_readable_source": "\n\n#define DSS_SUBSYS_NAME \"HDMI\"\n\n#include <linux/kernel.h>\n#include <linux/err.h>\n#include <linux/of.h>\n#include <video/omapfb_dss.h>\n\n#include \"hdmi.h\"\n\nint hdmi_parse_lanes_of(struct platform_device *pdev, struct device_node *ep,\n\tstruct hdmi_phy_data *phy)\n{\n\tstruct property *prop;\n\tint r, len;\n\n\tprop = of_find_property(ep, \"lanes\", &len);\n\tif (prop) {\n\t\tu32 lanes[8];\n\n\t\tif (len / sizeof(u32) != ARRAY_SIZE(lanes)) {\n\t\t\tdev_err(&pdev->dev, \"bad number of lanes\\n\");\n\t\t\treturn -EINVAL;\n\t\t}\n\n\t\tr = of_property_read_u32_array(ep, \"lanes\", lanes,\n\t\t\tARRAY_SIZE(lanes));\n\t\tif (r) {\n\t\t\tdev_err(&pdev->dev, \"failed to read lane data\\n\");\n\t\t\treturn r;\n\t\t}\n\n\t\tr = hdmi_phy_parse_lanes(phy, lanes);\n\t\tif (r) {\n\t\t\tdev_err(&pdev->dev, \"failed to parse lane data\\n\");\n\t\t\treturn r;\n\t\t}\n\t} else {\n\t\tstatic const u32 default_lanes[] = { 0, 1, 2, 3, 4, 5, 6, 7 };\n\n\t\tr = hdmi_phy_parse_lanes(phy, default_lanes);\n\t\tif (WARN_ON(r)) {\n\t\t\tdev_err(&pdev->dev, \"failed to parse lane data\\n\");\n\t\t\treturn r;\n\t\t}\n\t}\n\n\treturn 0;\n}\n\nint hdmi_compute_acr(u32 pclk, u32 sample_freq, u32 *n, u32 *cts)\n{\n\tu32 deep_color;\n\tbool deep_color_correct = false;\n\n\tif (n == NULL || cts == NULL)\n\t\treturn -EINVAL;\n\n\t \n\tdeep_color = 100;\n\n\t \n\tswitch (sample_freq) {\n\tcase 32000:\n\tcase 48000:\n\tcase 96000:\n\tcase 192000:\n\t\tif (deep_color == 125)\n\t\t\tif (pclk == 27027000 || pclk == 74250000)\n\t\t\t\tdeep_color_correct = true;\n\t\tif (deep_color == 150)\n\t\t\tif (pclk == 27027000)\n\t\t\t\tdeep_color_correct = true;\n\t\tbreak;\n\tcase 44100:\n\tcase 88200:\n\tcase 176400:\n\t\tif (deep_color == 125)\n\t\t\tif (pclk == 27027000)\n\t\t\t\tdeep_color_correct = true;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tif (deep_color_correct) {\n\t\tswitch (sample_freq) {\n\t\tcase 32000:\n\t\t\t*n = 8192;\n\t\t\tbreak;\n\t\tcase 44100:\n\t\t\t*n = 12544;\n\t\t\tbreak;\n\t\tcase 48000:\n\t\t\t*n = 8192;\n\t\t\tbreak;\n\t\tcase 88200:\n\t\t\t*n = 25088;\n\t\t\tbreak;\n\t\tcase 96000:\n\t\t\t*n = 16384;\n\t\t\tbreak;\n\t\tcase 176400:\n\t\t\t*n = 50176;\n\t\t\tbreak;\n\t\tcase 192000:\n\t\t\t*n = 32768;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn -EINVAL;\n\t\t}\n\t} else {\n\t\tswitch (sample_freq) {\n\t\tcase 32000:\n\t\t\t*n = 4096;\n\t\t\tbreak;\n\t\tcase 44100:\n\t\t\t*n = 6272;\n\t\t\tbreak;\n\t\tcase 48000:\n\t\t\t*n = 6144;\n\t\t\tbreak;\n\t\tcase 88200:\n\t\t\t*n = 12544;\n\t\t\tbreak;\n\t\tcase 96000:\n\t\t\t*n = 12288;\n\t\t\tbreak;\n\t\tcase 176400:\n\t\t\t*n = 25088;\n\t\t\tbreak;\n\t\tcase 192000:\n\t\t\t*n = 24576;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn -EINVAL;\n\t\t}\n\t}\n\t \n\t*cts = (pclk/1000) * (*n / 128) * deep_color / (sample_freq / 10);\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}