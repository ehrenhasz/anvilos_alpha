{
  "module_name": "omapfb.h",
  "hash_id": "c343e6548b158d999ae639a5e996076096d35518db9f32b7aef1bbbf274cc165",
  "original_prompt": "Ingested from linux-6.6.14/drivers/video/fbdev/omap2/omapfb/omapfb.h",
  "human_readable_source": " \n \n\n#ifndef __DRIVERS_VIDEO_OMAP2_OMAPFB_H__\n#define __DRIVERS_VIDEO_OMAP2_OMAPFB_H__\n\n#ifdef CONFIG_FB_OMAP2_DEBUG_SUPPORT\n#define DEBUG\n#endif\n\n#include <linux/rwsem.h>\n#include <linux/dma-mapping.h>\n\n#include <video/omapfb_dss.h>\n\n#ifdef DEBUG\nextern bool omapfb_debug;\n#define DBG(format, ...) \\\n\tdo { \\\n\t\tif (omapfb_debug) \\\n\t\t\tprintk(KERN_DEBUG \"OMAPFB: \" format, ## __VA_ARGS__); \\\n\t} while (0)\n#else\n#define DBG(format, ...) no_printk(format, ## __VA_ARGS__)\n#endif\n\n#define FB2OFB(fb_info) ((struct omapfb_info *)(fb_info->par))\n\n \n#define OMAPFB_MAX_OVL_PER_FB 3\n\nstruct omapfb2_mem_region {\n\tint             id;\n\tunsigned long\tattrs;\n\tvoid\t\t*token;\n\tdma_addr_t\tdma_handle;\n\tu32\t\tpaddr;\n\tvoid __iomem\t*vaddr;\n\tstruct vrfb\tvrfb;\n\tunsigned long\tsize;\n\tu8\t\ttype;\t\t \n\tbool\t\talloc;\t\t \n\tbool\t\tmap;\t\t \n\tatomic_t\tmap_count;\n\tstruct rw_semaphore lock;\n\tatomic_t\tlock_count;\n};\n\n \nstruct omapfb_info {\n\tint id;\n\tstruct omapfb2_mem_region *region;\n\tint num_overlays;\n\tstruct omap_overlay *overlays[OMAPFB_MAX_OVL_PER_FB];\n\tstruct omapfb2_device *fbdev;\n\tenum omap_dss_rotation_type rotation_type;\n\tu8 rotation[OMAPFB_MAX_OVL_PER_FB];\n\tbool mirror;\n};\n\nstruct omapfb_display_data {\n\tstruct omapfb2_device *fbdev;\n\tstruct omap_dss_device *dssdev;\n\tu8 bpp_override;\n\tenum omapfb_update_mode update_mode;\n\tbool auto_update_work_enabled;\n\tstruct delayed_work auto_update_work;\n};\n\nstruct omapfb2_device {\n\tstruct device *dev;\n\tstruct mutex  mtx;\n\n\tu32 pseudo_palette[17];\n\n\tint state;\n\n\tunsigned num_fbs;\n\tstruct fb_info *fbs[10];\n\tstruct omapfb2_mem_region regions[10];\n\n\tunsigned num_displays;\n\tstruct omapfb_display_data displays[10];\n\tunsigned num_overlays;\n\tstruct omap_overlay *overlays[10];\n\tunsigned num_managers;\n\tstruct omap_overlay_manager *managers[10];\n\n\tstruct workqueue_struct *auto_update_wq;\n};\n\nstruct omapfb_colormode {\n\tenum omap_color_mode dssmode;\n\tu32 bits_per_pixel;\n\tu32 nonstd;\n\tstruct fb_bitfield red;\n\tstruct fb_bitfield green;\n\tstruct fb_bitfield blue;\n\tstruct fb_bitfield transp;\n};\n\nvoid set_fb_fix(struct fb_info *fbi);\nint check_fb_var(struct fb_info *fbi, struct fb_var_screeninfo *var);\nint omapfb_realloc_fbmem(struct fb_info *fbi, unsigned long size, int type);\nint omapfb_apply_changes(struct fb_info *fbi, int init);\n\nint omapfb_create_sysfs(struct omapfb2_device *fbdev);\nvoid omapfb_remove_sysfs(struct omapfb2_device *fbdev);\n\nint omapfb_ioctl(struct fb_info *fbi, unsigned int cmd, unsigned long arg);\n\nint dss_mode_to_fb_mode(enum omap_color_mode dssmode,\n\t\t\tstruct fb_var_screeninfo *var);\n\nint omapfb_setup_overlay(struct fb_info *fbi, struct omap_overlay *ovl,\n\t\tu16 posx, u16 posy, u16 outw, u16 outh);\n\nvoid omapfb_start_auto_update(struct omapfb2_device *fbdev,\n\t\tstruct omap_dss_device *display);\nvoid omapfb_stop_auto_update(struct omapfb2_device *fbdev,\n\t\tstruct omap_dss_device *display);\nint omapfb_get_update_mode(struct fb_info *fbi, enum omapfb_update_mode *mode);\nint omapfb_set_update_mode(struct fb_info *fbi, enum omapfb_update_mode mode);\n\n \nstatic inline struct omap_dss_device *fb2display(struct fb_info *fbi)\n{\n\tstruct omapfb_info *ofbi = FB2OFB(fbi);\n\tstruct omap_overlay *ovl;\n\n\t \n\n\tif (ofbi->num_overlays == 0)\n\t\treturn NULL;\n\n\tovl = ofbi->overlays[0];\n\n\treturn ovl->get_device(ovl);\n}\n\nstatic inline struct omapfb_display_data *get_display_data(\n\t\tstruct omapfb2_device *fbdev, struct omap_dss_device *dssdev)\n{\n\tint i;\n\n\tfor (i = 0; i < fbdev->num_displays; ++i)\n\t\tif (fbdev->displays[i].dssdev == dssdev)\n\t\t\treturn &fbdev->displays[i];\n\n\t \n\tBUG();\n\treturn NULL;\n}\n\nstatic inline void omapfb_lock(struct omapfb2_device *fbdev)\n{\n\tmutex_lock(&fbdev->mtx);\n}\n\nstatic inline void omapfb_unlock(struct omapfb2_device *fbdev)\n{\n\tmutex_unlock(&fbdev->mtx);\n}\n\nstatic inline int omapfb_overlay_enable(struct omap_overlay *ovl,\n\t\tint enable)\n{\n\tif (enable)\n\t\treturn ovl->enable(ovl);\n\telse\n\t\treturn ovl->disable(ovl);\n}\n\nstatic inline struct omapfb2_mem_region *\nomapfb_get_mem_region(struct omapfb2_mem_region *rg)\n{\n\tdown_read_nested(&rg->lock, rg->id);\n\tatomic_inc(&rg->lock_count);\n\treturn rg;\n}\n\nstatic inline void omapfb_put_mem_region(struct omapfb2_mem_region *rg)\n{\n\tatomic_dec(&rg->lock_count);\n\tup_read(&rg->lock);\n}\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}