{
  "module_name": "maxinefb.c",
  "hash_id": "f678c710f5a5cfe3c711e00f39a4efb09e924cde92c6672b746f8f5e8c959682",
  "original_prompt": "Ingested from linux-6.6.14/drivers/video/fbdev/maxinefb.c",
  "human_readable_source": " \n\n \n\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/errno.h>\n#include <linux/string.h>\n#include <linux/mm.h>\n#include <linux/delay.h>\n#include <linux/init.h>\n#include <linux/fb.h>\n#include <video/maxinefb.h>\n\n \n \n#include <asm/bootinfo.h>\n\nstatic struct fb_info fb_info;\n\nstatic const struct fb_var_screeninfo maxinefb_defined = {\n\t.xres =\t\t1024,\n\t.yres =\t\t768,\n\t.xres_virtual =\t1024,\n\t.yres_virtual =\t768,\n\t.bits_per_pixel =8,\n\t.activate =\tFB_ACTIVATE_NOW,\n\t.height =\t-1,\n\t.width =\t-1,\n\t.vmode =\tFB_VMODE_NONINTERLACED,\n};\n\nstatic struct fb_fix_screeninfo maxinefb_fix __initdata = {\n\t.id =\t\t\"Maxine\",\n\t.smem_len =\t(1024*768),\n\t.type =\t\tFB_TYPE_PACKED_PIXELS,\n\t.visual =\tFB_VISUAL_PSEUDOCOLOR,\n\t.line_length =\t1024,\n};\n\n \n\nvoid maxinefb_ims332_write_register(int regno, register unsigned int val)\n{\n\tregister unsigned char *regs = (char *) MAXINEFB_IMS332_ADDRESS;\n\tunsigned char *wptr;\n\n\twptr = regs + 0xa0000 + (regno << 4);\n\t*((volatile unsigned int *) (regs)) = (val >> 8) & 0xff00;\n\t*((volatile unsigned short *) (wptr)) = val;\n}\n\nunsigned int maxinefb_ims332_read_register(int regno)\n{\n\tregister unsigned char *regs = (char *) MAXINEFB_IMS332_ADDRESS;\n\tunsigned char *rptr;\n\tregister unsigned int j, k;\n\n\trptr = regs + 0x80000 + (regno << 4);\n\tj = *((volatile unsigned short *) rptr);\n\tk = *((volatile unsigned short *) regs);\n\n\treturn (j & 0xffff) | ((k & 0xff00) << 8);\n}\n\n \nstatic int maxinefb_setcolreg(unsigned regno, unsigned red, unsigned green,\n\t\t\t      unsigned blue, unsigned transp, struct fb_info *info)\n{\n\t \n\tunsigned long hw_colorvalue = 0;\n\n\tif (regno > 255)\n\t\treturn 1;\n\n\tred   >>= 8;     \n\tgreen >>= 8;     \n\tblue  >>= 8;     \n\n\thw_colorvalue = (blue << 16) + (green << 8) + (red);\n\n\tmaxinefb_ims332_write_register(IMS332_REG_COLOR_PALETTE + regno,\n\t\t\t\t       hw_colorvalue);\n\treturn 0;\n}\n\nstatic const struct fb_ops maxinefb_ops = {\n\t.owner\t\t= THIS_MODULE,\n\tFB_DEFAULT_IOMEM_OPS,\n\t.fb_setcolreg\t= maxinefb_setcolreg,\n};\n\nint __init maxinefb_init(void)\n{\n\tunsigned long fboff;\n\tunsigned long fb_start;\n\tint i;\n\n\tif (fb_get_options(\"maxinefb\", NULL))\n\t\treturn -ENODEV;\n\n\t \n\tif (mips_machtype != MACH_DS5000_XX) {\n\t\treturn -EINVAL;\n\t}\n\n\tprintk(KERN_INFO \"Maxinefb: Personal DECstation detected\\n\");\n\tprintk(KERN_INFO \"Maxinefb: initializing onboard framebuffer\\n\");\n\n\t \n\tfb_start = DS5000_xx_ONBOARD_FBMEM_START;\n\n\t \n\tfor (fboff = fb_start; fboff < fb_start + 0x1ffff; fboff++)\n\t\t*(volatile unsigned char *)fboff = 0x0;\n\n\tmaxinefb_fix.smem_start = fb_start;\n\n\t \n\tfor (i = 0; i < 512; i++) {\n\t\tmaxinefb_ims332_write_register(IMS332_REG_CURSOR_RAM + i,\n\t\t\t\t\t       0);\n\t\t \n\t}\n\n\tfb_info.fbops = &maxinefb_ops;\n\tfb_info.screen_base = (char *)maxinefb_fix.smem_start;\n\tfb_info.var = maxinefb_defined;\n\tfb_info.fix = maxinefb_fix;\n\n\tfb_alloc_cmap(&fb_info.cmap, 256, 0);\n\n\tif (register_framebuffer(&fb_info) < 0)\n\t\treturn 1;\n\treturn 0;\n}\n\nstatic void __exit maxinefb_exit(void)\n{\n\tunregister_framebuffer(&fb_info);\n}\n\n#ifdef MODULE\nMODULE_LICENSE(\"GPL\");\n#endif\nmodule_init(maxinefb_init);\nmodule_exit(maxinefb_exit);\n\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}