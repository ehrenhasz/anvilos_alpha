{
  "module_name": "video_cs5530.c",
  "hash_id": "3beb28d41377ba20b89b90fa417f4ba55dd2728c01a95d7b723148bd4b4240be",
  "original_prompt": "Ingested from linux-6.6.14/drivers/video/fbdev/geode/video_cs5530.c",
  "human_readable_source": "\n \n#include <linux/fb.h>\n#include <linux/delay.h>\n#include <asm/io.h>\n#include <asm/delay.h>\n\n#include \"geodefb.h\"\n#include \"video_cs5530.h\"\n\n \nstruct cs5530_pll_entry {\n\tlong pixclock;  \n\tu32 pll_value;\n};\n\nstatic const struct cs5530_pll_entry cs5530_pll_table[] = {\n\t{ 39721, 0x31C45801, },  \n\t{ 35308, 0x20E36802, },  \n\t{ 31746, 0x33915801, },  \n\t{ 27777, 0x31EC4801, },  \n\t{ 26666, 0x21E22801, },  \n\t{ 25000, 0x33088801, },  \n\t{ 22271, 0x33E22801, },  \n\t{ 20202, 0x336C4801, },  \n\t{ 20000, 0x23088801, },  \n\t{ 19860, 0x23088801, },  \n\t{ 18518, 0x3708A801, },  \n\t{ 17777, 0x23E36802, },  \n\t{ 17733, 0x23E36802, },  \n\t{ 17653, 0x23E36802, },  \n\t{ 16949, 0x37C45801, },  \n\t{ 15873, 0x23EC4801, },  \n\t{ 15384, 0x37911801, },  \n\t{ 14814, 0x37963803, },  \n\t{ 14124, 0x37058803, },  \n\t{ 13888, 0x3710C805, },  \n\t{ 13333, 0x37E22801, },  \n\t{ 12698, 0x27915801, },  \n\t{ 12500, 0x37D8D802, },  \n\t{ 11135, 0x27588802, },  \n\t{ 10582, 0x27EC4802, },  \n\t{ 10101, 0x27AC6803, },  \n\t{ 10000, 0x27088801, },  \n\t{  9259, 0x2710C805, },  \n\t{  8888, 0x27E36802, },  \n\t{  7692, 0x27C58803, },  \n\t{  7407, 0x27316803, },  \n\t{  6349, 0x2F915801, },  \n\t{  6172, 0x2F08A801, },  \n\t{  5714, 0x2FB11802, },  \n\t{  5291, 0x2FEC4802, },  \n\t{  4950, 0x2F963803, },  \n\t{  4310, 0x2FB1B802, },  \n};\n\nstatic void cs5530_set_dclk_frequency(struct fb_info *info)\n{\n\tstruct geodefb_par *par = info->par;\n\tint i;\n\tu32 value;\n\tlong min, diff;\n\n\t \n\tvalue = cs5530_pll_table[0].pll_value;\n\tmin = cs5530_pll_table[0].pixclock - info->var.pixclock;\n\tif (min < 0) min = -min;\n\tfor (i = 1; i < ARRAY_SIZE(cs5530_pll_table); i++) {\n\t\tdiff = cs5530_pll_table[i].pixclock - info->var.pixclock;\n\t\tif (diff < 0L) diff = -diff;\n\t\tif (diff < min) {\n\t\t\tmin = diff;\n\t\t\tvalue = cs5530_pll_table[i].pll_value;\n\t\t}\n\t}\n\n\twritel(value, par->vid_regs + CS5530_DOT_CLK_CONFIG);\n\twritel(value | 0x80000100, par->vid_regs + CS5530_DOT_CLK_CONFIG);  \n\tudelay(500);  \n\twritel(value & 0x7FFFFFFF, par->vid_regs + CS5530_DOT_CLK_CONFIG);  \n\twritel(value & 0x7FFFFEFF, par->vid_regs + CS5530_DOT_CLK_CONFIG);  \n}\n\nstatic void cs5530_configure_display(struct fb_info *info)\n{\n\tstruct geodefb_par *par = info->par;\n\tu32 dcfg;\n\n\tdcfg = readl(par->vid_regs + CS5530_DISPLAY_CONFIG);\n\n\t \n\tdcfg &= ~(CS5530_DCFG_CRT_SYNC_SKW_MASK | CS5530_DCFG_PWR_SEQ_DLY_MASK\n\t\t  | CS5530_DCFG_CRT_HSYNC_POL   | CS5530_DCFG_CRT_VSYNC_POL\n\t\t  | CS5530_DCFG_FP_PWR_EN       | CS5530_DCFG_FP_DATA_EN\n\t\t  | CS5530_DCFG_DAC_PWR_EN      | CS5530_DCFG_VSYNC_EN\n\t\t  | CS5530_DCFG_HSYNC_EN);\n\n\t \n\tdcfg |= (CS5530_DCFG_CRT_SYNC_SKW_INIT | CS5530_DCFG_PWR_SEQ_DLY_INIT\n\t\t | CS5530_DCFG_GV_PAL_BYP);\n\n\t \n\tif (par->enable_crt) {\n\t\tdcfg |= CS5530_DCFG_DAC_PWR_EN;\n\t\tdcfg |= CS5530_DCFG_HSYNC_EN | CS5530_DCFG_VSYNC_EN;\n\t}\n\t \n\tif (par->panel_x > 0) {\n\t\tdcfg |= CS5530_DCFG_FP_PWR_EN;\n\t\tdcfg |= CS5530_DCFG_FP_DATA_EN;\n\t}\n\n\t \n\tif (info->var.sync & FB_SYNC_HOR_HIGH_ACT)\n\t\tdcfg |= CS5530_DCFG_CRT_HSYNC_POL;\n\tif (info->var.sync & FB_SYNC_VERT_HIGH_ACT)\n\t\tdcfg |= CS5530_DCFG_CRT_VSYNC_POL;\n\n\twritel(dcfg, par->vid_regs + CS5530_DISPLAY_CONFIG);\n}\n\nstatic int cs5530_blank_display(struct fb_info *info, int blank_mode)\n{\n\tstruct geodefb_par *par = info->par;\n\tu32 dcfg;\n\tint blank, hsync, vsync;\n\n\tswitch (blank_mode) {\n\tcase FB_BLANK_UNBLANK:\n\t\tblank = 0; hsync = 1; vsync = 1;\n\t\tbreak;\n\tcase FB_BLANK_NORMAL:\n\t\tblank = 1; hsync = 1; vsync = 1;\n\t\tbreak;\n\tcase FB_BLANK_VSYNC_SUSPEND:\n\t\tblank = 1; hsync = 1; vsync = 0;\n\t\tbreak;\n\tcase FB_BLANK_HSYNC_SUSPEND:\n\t\tblank = 1; hsync = 0; vsync = 1;\n\t\tbreak;\n\tcase FB_BLANK_POWERDOWN:\n\t\tblank = 1; hsync = 0; vsync = 0;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tdcfg = readl(par->vid_regs + CS5530_DISPLAY_CONFIG);\n\n\tdcfg &= ~(CS5530_DCFG_DAC_BL_EN | CS5530_DCFG_DAC_PWR_EN\n\t\t  | CS5530_DCFG_HSYNC_EN | CS5530_DCFG_VSYNC_EN\n\t\t  | CS5530_DCFG_FP_DATA_EN | CS5530_DCFG_FP_PWR_EN);\n\n\tif (par->enable_crt) {\n\t\tif (!blank)\n\t\t\tdcfg |= CS5530_DCFG_DAC_BL_EN | CS5530_DCFG_DAC_PWR_EN;\n\t\tif (hsync)\n\t\t\tdcfg |= CS5530_DCFG_HSYNC_EN;\n\t\tif (vsync)\n\t\t\tdcfg |= CS5530_DCFG_VSYNC_EN;\n\t}\n\tif (par->panel_x > 0) {\n\t\tif (!blank)\n\t\t\tdcfg |= CS5530_DCFG_FP_DATA_EN;\n\t\tif (hsync && vsync)\n\t\t\tdcfg |= CS5530_DCFG_FP_PWR_EN;\n\t}\n\n\twritel(dcfg, par->vid_regs + CS5530_DISPLAY_CONFIG);\n\n\treturn 0;\n}\n\nconst struct geode_vid_ops cs5530_vid_ops = {\n\t.set_dclk          = cs5530_set_dclk_frequency,\n\t.configure_display = cs5530_configure_display,\n\t.blank_display     = cs5530_blank_display,\n};\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}