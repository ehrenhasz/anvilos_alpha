{
  "module_name": "jornada720_bl.c",
  "hash_id": "38aa8b57e73d48410b82be2792236105841a61135ab5c499ead59ab6be219619",
  "original_prompt": "Ingested from linux-6.6.14/drivers/video/backlight/jornada720_bl.c",
  "human_readable_source": "\n \n\n#include <linux/backlight.h>\n#include <linux/device.h>\n#include <linux/fb.h>\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/platform_device.h>\n\n#include <mach/jornada720.h>\n#include <mach/hardware.h>\n\n#include <video/s1d13xxxfb.h>\n\n#define BL_MAX_BRIGHT\t255\n#define BL_DEF_BRIGHT\t25\n\nstatic int jornada_bl_get_brightness(struct backlight_device *bd)\n{\n\tint ret;\n\n\t \n\tif (!(PPSR & PPC_LDD1))\n\t\treturn 0;\n\n\tjornada_ssp_start();\n\n\t \n\tret = jornada_ssp_byte(GETBRIGHTNESS);\n\n\tif (jornada_ssp_byte(GETBRIGHTNESS) != TXDUMMY) {\n\t\tdev_err(&bd->dev, \"get brightness timeout\\n\");\n\t\tjornada_ssp_end();\n\t\treturn -ETIMEDOUT;\n\t}\n\n\t \n\tret = jornada_ssp_byte(TXDUMMY);\n\n\tjornada_ssp_end();\n\n\treturn BL_MAX_BRIGHT - ret;\n}\n\nstatic int jornada_bl_update_status(struct backlight_device *bd)\n{\n\tint ret = 0;\n\n\tjornada_ssp_start();\n\n\t \n\tif (backlight_is_blank(bd)) {\n\t\tret = jornada_ssp_byte(BRIGHTNESSOFF);\n\t\tif (ret != TXDUMMY) {\n\t\t\tdev_info(&bd->dev, \"brightness off timeout\\n\");\n\t\t\t \n\t\t\tPPSR &= ~PPC_LDD1;\n\t\t\tPPDR |= PPC_LDD1;\n\t\t\tret = -ETIMEDOUT;\n\t\t}\n\t} else   \n\t\tPPSR |= PPC_LDD1;\n\n\t \n\tif (jornada_ssp_byte(SETBRIGHTNESS) != TXDUMMY) {\n\t\tdev_info(&bd->dev, \"failed to set brightness\\n\");\n\t\tret = -ETIMEDOUT;\n\t\tgoto out;\n\t}\n\n\t \n\tif (jornada_ssp_byte(BL_MAX_BRIGHT - bd->props.brightness)\n\t\t!= TXDUMMY) {\n\t\tdev_err(&bd->dev, \"set brightness failed\\n\");\n\t\tret = -ETIMEDOUT;\n\t}\n\n\t \nout:\n\tjornada_ssp_end();\n\n\treturn ret;\n}\n\nstatic const struct backlight_ops jornada_bl_ops = {\n\t.get_brightness = jornada_bl_get_brightness,\n\t.update_status = jornada_bl_update_status,\n\t.options = BL_CORE_SUSPENDRESUME,\n};\n\nstatic int jornada_bl_probe(struct platform_device *pdev)\n{\n\tstruct backlight_properties props;\n\tint ret;\n\tstruct backlight_device *bd;\n\n\tmemset(&props, 0, sizeof(struct backlight_properties));\n\tprops.type = BACKLIGHT_RAW;\n\tprops.max_brightness = BL_MAX_BRIGHT;\n\n\tbd = devm_backlight_device_register(&pdev->dev, S1D_DEVICENAME,\n\t\t\t\t\t&pdev->dev, NULL, &jornada_bl_ops,\n\t\t\t\t\t&props);\n\tif (IS_ERR(bd)) {\n\t\tret = PTR_ERR(bd);\n\t\tdev_err(&pdev->dev, \"failed to register device, err=%x\\n\", ret);\n\t\treturn ret;\n\t}\n\n\tbd->props.power = FB_BLANK_UNBLANK;\n\tbd->props.brightness = BL_DEF_BRIGHT;\n\t \n\tjornada_bl_update_status(bd);\n\n\tplatform_set_drvdata(pdev, bd);\n\tdev_info(&pdev->dev, \"HP Jornada 700 series backlight driver\\n\");\n\n\treturn 0;\n}\n\nstatic struct platform_driver jornada_bl_driver = {\n\t.probe\t\t= jornada_bl_probe,\n\t.driver\t= {\n\t\t.name\t= \"jornada_bl\",\n\t},\n};\n\nmodule_platform_driver(jornada_bl_driver);\n\nMODULE_AUTHOR(\"Kristoffer Ericson <kristoffer.ericson>\");\nMODULE_DESCRIPTION(\"HP Jornada 710/720/728 Backlight driver\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}