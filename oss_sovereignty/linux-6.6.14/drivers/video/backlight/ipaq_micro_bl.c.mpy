{
  "module_name": "ipaq_micro_bl.c",
  "hash_id": "c5d6d701800ff711d7859c3c20579f0105bab0ae67f1b216b9fa3b4c9fe4b7ab",
  "original_prompt": "Ingested from linux-6.6.14/drivers/video/backlight/ipaq_micro_bl.c",
  "human_readable_source": "\n \n\n#include <linux/backlight.h>\n#include <linux/err.h>\n#include <linux/fb.h>\n#include <linux/init.h>\n#include <linux/mfd/ipaq-micro.h>\n#include <linux/module.h>\n#include <linux/platform_device.h>\n\nstatic int micro_bl_update_status(struct backlight_device *bd)\n{\n\tstruct ipaq_micro *micro = dev_get_drvdata(&bd->dev);\n\tint intensity = backlight_get_brightness(bd);\n\tstruct ipaq_micro_msg msg = {\n\t\t.id = MSG_BACKLIGHT,\n\t\t.tx_len = 3,\n\t};\n\n\t \n\tmsg.tx_data[0] = 0x01;\n\tmsg.tx_data[1] = intensity > 0 ? 1 : 0;\n\tmsg.tx_data[2] = intensity;\n\treturn ipaq_micro_tx_msg_sync(micro, &msg);\n}\n\nstatic const struct backlight_ops micro_bl_ops = {\n\t.options = BL_CORE_SUSPENDRESUME,\n\t.update_status  = micro_bl_update_status,\n};\n\nstatic const struct backlight_properties micro_bl_props = {\n\t.type = BACKLIGHT_RAW,\n\t.max_brightness = 255,\n\t.power = FB_BLANK_UNBLANK,\n\t.brightness = 64,\n};\n\nstatic int micro_backlight_probe(struct platform_device *pdev)\n{\n\tstruct backlight_device *bd;\n\tstruct ipaq_micro *micro = dev_get_drvdata(pdev->dev.parent);\n\n\tbd = devm_backlight_device_register(&pdev->dev, \"ipaq-micro-backlight\",\n\t\t\t\t\t    &pdev->dev, micro, &micro_bl_ops,\n\t\t\t\t\t    &micro_bl_props);\n\tif (IS_ERR(bd))\n\t\treturn PTR_ERR(bd);\n\n\tplatform_set_drvdata(pdev, bd);\n\tbacklight_update_status(bd);\n\n\treturn 0;\n}\n\nstatic struct platform_driver micro_backlight_device_driver = {\n\t.driver = {\n\t\t.name    = \"ipaq-micro-backlight\",\n\t},\n\t.probe   = micro_backlight_probe,\n};\nmodule_platform_driver(micro_backlight_device_driver);\n\nMODULE_LICENSE(\"GPL v2\");\nMODULE_DESCRIPTION(\"driver for iPAQ Atmel micro backlight\");\nMODULE_ALIAS(\"platform:ipaq-micro-backlight\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}