{
  "module_name": "rave-sp-backlight.c",
  "hash_id": "e19c8825b827678306da81606e38bcf6e3b88cfe614caeca1deef0201ccac437",
  "original_prompt": "Ingested from linux-6.6.14/drivers/video/backlight/rave-sp-backlight.c",
  "human_readable_source": "\n\n \n\n#include <linux/backlight.h>\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/mfd/rave-sp.h>\n#include <linux/platform_device.h>\n\n#define\tRAVE_SP_BACKLIGHT_LCD_EN\tBIT(7)\n\nstatic int rave_sp_backlight_update_status(struct backlight_device *bd)\n{\n\tconst struct backlight_properties *p = &bd->props;\n\tconst u8 intensity =\n\t\t(p->power == FB_BLANK_UNBLANK) ? p->brightness : 0;\n\tstruct rave_sp *sp = dev_get_drvdata(&bd->dev);\n\tu8 cmd[] = {\n\t\t[0] = RAVE_SP_CMD_SET_BACKLIGHT,\n\t\t[1] = 0,\n\t\t[2] = intensity ? RAVE_SP_BACKLIGHT_LCD_EN | intensity : 0,\n\t\t[3] = 0,\n\t\t[4] = 0,\n\t};\n\n\treturn rave_sp_exec(sp, cmd, sizeof(cmd), NULL, 0);\n}\n\nstatic const struct backlight_ops rave_sp_backlight_ops = {\n\t.options\t= BL_CORE_SUSPENDRESUME,\n\t.update_status\t= rave_sp_backlight_update_status,\n};\n\nstatic struct backlight_properties rave_sp_backlight_props = {\n\t.type\t\t= BACKLIGHT_PLATFORM,\n\t.max_brightness = 100,\n\t.brightness\t= 50,\n};\n\nstatic int rave_sp_backlight_probe(struct platform_device *pdev)\n{\n\tstruct device *dev = &pdev->dev;\n\tstruct backlight_device *bd;\n\n\tbd = devm_backlight_device_register(dev, pdev->name, dev,\n\t\t\t\t\t    dev_get_drvdata(dev->parent),\n\t\t\t\t\t    &rave_sp_backlight_ops,\n\t\t\t\t\t    &rave_sp_backlight_props);\n\tif (IS_ERR(bd))\n\t\treturn PTR_ERR(bd);\n\n\t \n\tif (!dev->of_node->phandle)\n\t\tbacklight_update_status(bd);\n\n\treturn 0;\n}\n\nstatic const struct of_device_id rave_sp_backlight_of_match[] = {\n\t{ .compatible = \"zii,rave-sp-backlight\" },\n\t{}\n};\n\nstatic struct platform_driver rave_sp_backlight_driver = {\n\t.probe = rave_sp_backlight_probe,\n\t.driver\t= {\n\t\t.name = KBUILD_MODNAME,\n\t\t.of_match_table = rave_sp_backlight_of_match,\n\t},\n};\nmodule_platform_driver(rave_sp_backlight_driver);\n\nMODULE_DEVICE_TABLE(of, rave_sp_backlight_of_match);\nMODULE_LICENSE(\"GPL\");\nMODULE_AUTHOR(\"Andrey Vostrikov <andrey.vostrikov@cogentembedded.com>\");\nMODULE_AUTHOR(\"Nikita Yushchenko <nikita.yoush@cogentembedded.com>\");\nMODULE_AUTHOR(\"Andrey Smirnov <andrew.smirnov@gmail.com>\");\nMODULE_DESCRIPTION(\"RAVE SP Backlight driver\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}