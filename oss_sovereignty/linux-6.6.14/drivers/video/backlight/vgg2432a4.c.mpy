{
  "module_name": "vgg2432a4.c",
  "hash_id": "b95a1f3a4ea4cfd342e8c379e59d5884e0ec18e6c8aaa198da050bfb98c8da83",
  "original_prompt": "Ingested from linux-6.6.14/drivers/video/backlight/vgg2432a4.c",
  "human_readable_source": "\n \n\n#include <linux/delay.h>\n#include <linux/err.h>\n#include <linux/fb.h>\n#include <linux/init.h>\n#include <linux/lcd.h>\n#include <linux/module.h>\n\n#include <linux/spi/spi.h>\n\n#include <video/ili9320.h>\n\n#include \"ili9320.h\"\n\n \n\nstatic const struct ili9320_reg vgg_init1[] = {\n\t{\n\t\t.address = ILI9320_POWER1,\n\t\t.value\t = ILI9320_POWER1_AP(0) | ILI9320_POWER1_BT(0),\n\t}, {\n\t\t.address = ILI9320_POWER2,\n\t\t.value\t = (ILI9320_POWER2_VC(7) |\n\t\t\t    ILI9320_POWER2_DC0(0) | ILI9320_POWER2_DC1(0)),\n\t}, {\n\t\t.address = ILI9320_POWER3,\n\t\t.value\t = ILI9320_POWER3_VRH(0),\n\t}, {\n\t\t.address = ILI9320_POWER4,\n\t\t.value\t = ILI9320_POWER4_VREOUT(0),\n\t},\n};\n\nstatic const struct ili9320_reg vgg_init2[] = {\n\t{\n\t\t.address = ILI9320_POWER1,\n\t\t.value   = (ILI9320_POWER1_AP(3) | ILI9320_POWER1_APE |\n\t\t\t    ILI9320_POWER1_BT(7) | ILI9320_POWER1_SAP),\n\t}, {\n\t\t.address = ILI9320_POWER2,\n\t\t.value   = ILI9320_POWER2_VC(7) | ILI9320_POWER2_DC0(3),\n\t}\n};\n\nstatic const struct ili9320_reg vgg_gamma[] = {\n\t{\n\t\t.address = ILI9320_GAMMA1,\n\t\t.value\t = 0x0000,\n\t}, {\n\t\t.address = ILI9320_GAMMA2,\n\t\t.value   = 0x0505,\n\t}, {\n\t\t.address = ILI9320_GAMMA3,\n\t\t.value\t = 0x0004,\n\t}, {\n\t\t.address = ILI9320_GAMMA4,\n\t\t.value\t = 0x0006,\n\t}, {\n\t\t.address = ILI9320_GAMMA5,\n\t\t.value\t = 0x0707,\n\t}, {\n\t\t.address = ILI9320_GAMMA6,\n\t\t.value\t = 0x0105,\n\t}, {\n\t\t.address = ILI9320_GAMMA7,\n\t\t.value\t = 0x0002,\n\t}, {\n\t\t.address = ILI9320_GAMMA8,\n\t\t.value\t = 0x0707,\n\t}, {\n\t\t.address = ILI9320_GAMMA9,\n\t\t.value\t = 0x0704,\n\t}, {\n\t\t.address = ILI9320_GAMMA10,\n\t\t.value\t = 0x807,\n\t}\n\n};\n\nstatic const struct ili9320_reg vgg_init0[] = {\n\t[0]\t= {\n\t\t \n\t\t.address = ILI9320_DRIVER,\n\t\t.value\t = ILI9320_DRIVER_SS,\n\t}, {\n\t\t.address = ILI9320_DRIVEWAVE,\n\t\t.value\t = (ILI9320_DRIVEWAVE_MUSTSET |\n\t\t\t    ILI9320_DRIVEWAVE_EOR | ILI9320_DRIVEWAVE_BC),\n\t}, {\n\t\t.address = ILI9320_ENTRYMODE,\n\t\t.value\t = ILI9320_ENTRYMODE_ID(3) | ILI9320_ENTRYMODE_BGR,\n\t}, {\n\t\t.address = ILI9320_RESIZING,\n\t\t.value\t = 0x0,\n\t},\n};\n\n\nstatic int vgg2432a4_lcd_init(struct ili9320 *lcd,\n\t\t\t      struct ili9320_platdata *cfg)\n{\n\tunsigned int addr;\n\tint ret;\n\n\t \n\tret = ili9320_write(lcd, 0x00e5, 0x8000);\n\tif (ret)\n\t\tgoto err_initial;\n\n\t \n\tret = ili9320_write(lcd, ILI9320_OSCILATION, ILI9320_OSCILATION_OSC);\n\tif (ret)\n\t\tgoto err_initial;\n\n\t \n\tmdelay(15);\n\n\tret = ili9320_write_regs(lcd, vgg_init0, ARRAY_SIZE(vgg_init0));\n\tif (ret != 0)\n\t\tgoto err_initial;\n\n\tili9320_write(lcd, ILI9320_DISPLAY2, cfg->display2);\n\tili9320_write(lcd, ILI9320_DISPLAY3, cfg->display3);\n\tili9320_write(lcd, ILI9320_DISPLAY4, cfg->display4);\n\n\tili9320_write(lcd, ILI9320_RGB_IF1, cfg->rgb_if1);\n\tili9320_write(lcd, ILI9320_FRAMEMAKER, 0x0);\n\tili9320_write(lcd, ILI9320_RGB_IF2, cfg->rgb_if2);\n\n\tret = ili9320_write_regs(lcd, vgg_init1, ARRAY_SIZE(vgg_init1));\n\tif (ret != 0)\n\t\tgoto err_vgg;\n\n\tmdelay(300);\n\n\tret = ili9320_write_regs(lcd, vgg_init2, ARRAY_SIZE(vgg_init2));\n\tif (ret != 0)\n\t\tgoto err_vgg2;\n\n\tmdelay(100);\n\n\tili9320_write(lcd, ILI9320_POWER3, 0x13c);\n\n\tmdelay(100);\n\n\tili9320_write(lcd, ILI9320_POWER4, 0x1c00);\n\tili9320_write(lcd, ILI9320_POWER7, 0x000e);\n\n\tmdelay(100);\n\n\tili9320_write(lcd, ILI9320_GRAM_HORIZ_ADDR, 0x00);\n\tili9320_write(lcd, ILI9320_GRAM_VERT_ADD, 0x00);\n\n\tret = ili9320_write_regs(lcd, vgg_gamma, ARRAY_SIZE(vgg_gamma));\n\tif (ret != 0)\n\t\tgoto err_vgg3;\n\n\tili9320_write(lcd, ILI9320_HORIZ_START, 0x0);\n\tili9320_write(lcd, ILI9320_HORIZ_END, cfg->hsize - 1);\n\tili9320_write(lcd, ILI9320_VERT_START, 0x0);\n\tili9320_write(lcd, ILI9320_VERT_END, cfg->vsize - 1);\n\n\tili9320_write(lcd, ILI9320_DRIVER2,\n\t\t      ILI9320_DRIVER2_NL(((cfg->vsize - 240) / 8) + 0x1D));\n\n\tili9320_write(lcd, ILI9320_BASE_IMAGE, 0x1);\n\tili9320_write(lcd, ILI9320_VERT_SCROLL, 0x00);\n\n\tfor (addr = ILI9320_PARTIAL1_POSITION; addr <= ILI9320_PARTIAL2_END;\n\t     addr++) {\n\t\tili9320_write(lcd, addr, 0x0);\n\t}\n\n\tili9320_write(lcd, ILI9320_INTERFACE1, 0x10);\n\tili9320_write(lcd, ILI9320_INTERFACE2, cfg->interface2);\n\tili9320_write(lcd, ILI9320_INTERFACE3, cfg->interface3);\n\tili9320_write(lcd, ILI9320_INTERFACE4, cfg->interface4);\n\tili9320_write(lcd, ILI9320_INTERFACE5, cfg->interface5);\n\tili9320_write(lcd, ILI9320_INTERFACE6, cfg->interface6);\n\n\tlcd->display1 = (ILI9320_DISPLAY1_D(3) | ILI9320_DISPLAY1_DTE |\n\t\t\t ILI9320_DISPLAY1_GON | ILI9320_DISPLAY1_BASEE |\n\t\t\t 0x40);\n\n\tili9320_write(lcd, ILI9320_DISPLAY1, lcd->display1);\n\n\treturn 0;\n\n err_vgg3:\n err_vgg2:\n err_vgg:\n err_initial:\n\treturn ret;\n}\n\n#ifdef CONFIG_PM_SLEEP\nstatic int vgg2432a4_suspend(struct device *dev)\n{\n\treturn ili9320_suspend(dev_get_drvdata(dev));\n}\nstatic int vgg2432a4_resume(struct device *dev)\n{\n\treturn ili9320_resume(dev_get_drvdata(dev));\n}\n#endif\n\nstatic struct ili9320_client vgg2432a4_client = {\n\t.name\t= \"VGG2432A4\",\n\t.init\t= vgg2432a4_lcd_init,\n};\n\n \n\nstatic int vgg2432a4_probe(struct spi_device *spi)\n{\n\tint ret;\n\n\tret = ili9320_probe_spi(spi, &vgg2432a4_client);\n\tif (ret != 0) {\n\t\tdev_err(&spi->dev, \"failed to initialise ili9320\\n\");\n\t\treturn ret;\n\t}\n\n\treturn 0;\n}\n\nstatic void vgg2432a4_remove(struct spi_device *spi)\n{\n\tili9320_remove(spi_get_drvdata(spi));\n}\n\nstatic void vgg2432a4_shutdown(struct spi_device *spi)\n{\n\tili9320_shutdown(spi_get_drvdata(spi));\n}\n\nstatic SIMPLE_DEV_PM_OPS(vgg2432a4_pm_ops, vgg2432a4_suspend, vgg2432a4_resume);\n\nstatic struct spi_driver vgg2432a4_driver = {\n\t.driver = {\n\t\t.name\t\t= \"VGG2432A4\",\n\t\t.pm\t\t= &vgg2432a4_pm_ops,\n\t},\n\t.probe\t\t= vgg2432a4_probe,\n\t.remove\t\t= vgg2432a4_remove,\n\t.shutdown\t= vgg2432a4_shutdown,\n};\n\nmodule_spi_driver(vgg2432a4_driver);\n\nMODULE_AUTHOR(\"Ben Dooks <ben-linux@fluff.org>\");\nMODULE_DESCRIPTION(\"VGG2432A4 LCD Driver\");\nMODULE_LICENSE(\"GPL v2\");\nMODULE_ALIAS(\"spi:VGG2432A4\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}