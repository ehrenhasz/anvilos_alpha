{
  "module_name": "ep93xx_bl.c",
  "hash_id": "a75df1103a3eec4069e211a80bbb7c50340df86f6395d045e6d8087399613254",
  "original_prompt": "Ingested from linux-6.6.14/drivers/video/backlight/ep93xx_bl.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/platform_device.h>\n#include <linux/io.h>\n#include <linux/fb.h>\n#include <linux/backlight.h>\n\n#define EP93XX_MAX_COUNT\t\t255\n#define EP93XX_MAX_BRIGHT\t\t255\n#define EP93XX_DEF_BRIGHT\t\t128\n\nstruct ep93xxbl {\n\tvoid __iomem *mmio;\n\tint brightness;\n};\n\nstatic int ep93xxbl_set(struct backlight_device *bl, int brightness)\n{\n\tstruct ep93xxbl *ep93xxbl = bl_get_data(bl);\n\n\twritel((brightness << 8) | EP93XX_MAX_COUNT, ep93xxbl->mmio);\n\n\tep93xxbl->brightness = brightness;\n\n\treturn 0;\n}\n\nstatic int ep93xxbl_update_status(struct backlight_device *bl)\n{\n\treturn ep93xxbl_set(bl, backlight_get_brightness(bl));\n}\n\nstatic int ep93xxbl_get_brightness(struct backlight_device *bl)\n{\n\tstruct ep93xxbl *ep93xxbl = bl_get_data(bl);\n\n\treturn ep93xxbl->brightness;\n}\n\nstatic const struct backlight_ops ep93xxbl_ops = {\n\t.update_status\t= ep93xxbl_update_status,\n\t.get_brightness\t= ep93xxbl_get_brightness,\n};\n\nstatic int ep93xxbl_probe(struct platform_device *dev)\n{\n\tstruct ep93xxbl *ep93xxbl;\n\tstruct backlight_device *bl;\n\tstruct backlight_properties props;\n\tstruct resource *res;\n\n\tep93xxbl = devm_kzalloc(&dev->dev, sizeof(*ep93xxbl), GFP_KERNEL);\n\tif (!ep93xxbl)\n\t\treturn -ENOMEM;\n\n\tres = platform_get_resource(dev, IORESOURCE_MEM, 0);\n\tif (!res)\n\t\treturn -ENXIO;\n\n\t \n\tep93xxbl->mmio = devm_ioremap(&dev->dev, res->start,\n\t\t\t\t      resource_size(res));\n\tif (!ep93xxbl->mmio)\n\t\treturn -ENXIO;\n\n\tmemset(&props, 0, sizeof(struct backlight_properties));\n\tprops.type = BACKLIGHT_RAW;\n\tprops.max_brightness = EP93XX_MAX_BRIGHT;\n\tbl = devm_backlight_device_register(&dev->dev, dev->name, &dev->dev,\n\t\t\t\t\tep93xxbl, &ep93xxbl_ops, &props);\n\tif (IS_ERR(bl))\n\t\treturn PTR_ERR(bl);\n\n\tbl->props.brightness = EP93XX_DEF_BRIGHT;\n\n\tplatform_set_drvdata(dev, bl);\n\n\tep93xxbl_update_status(bl);\n\n\treturn 0;\n}\n\n#ifdef CONFIG_PM_SLEEP\nstatic int ep93xxbl_suspend(struct device *dev)\n{\n\tstruct backlight_device *bl = dev_get_drvdata(dev);\n\n\treturn ep93xxbl_set(bl, 0);\n}\n\nstatic int ep93xxbl_resume(struct device *dev)\n{\n\tstruct backlight_device *bl = dev_get_drvdata(dev);\n\n\tbacklight_update_status(bl);\n\treturn 0;\n}\n#endif\n\nstatic SIMPLE_DEV_PM_OPS(ep93xxbl_pm_ops, ep93xxbl_suspend, ep93xxbl_resume);\n\nstatic struct platform_driver ep93xxbl_driver = {\n\t.driver\t\t= {\n\t\t.name\t= \"ep93xx-bl\",\n\t\t.pm\t= &ep93xxbl_pm_ops,\n\t},\n\t.probe\t\t= ep93xxbl_probe,\n};\n\nmodule_platform_driver(ep93xxbl_driver);\n\nMODULE_DESCRIPTION(\"EP93xx Backlight Driver\");\nMODULE_AUTHOR(\"H Hartley Sweeten <hsweeten@visionengravers.com>\");\nMODULE_LICENSE(\"GPL\");\nMODULE_ALIAS(\"platform:ep93xx-bl\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}