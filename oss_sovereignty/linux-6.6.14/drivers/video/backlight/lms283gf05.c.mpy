{
  "module_name": "lms283gf05.c",
  "hash_id": "d3e5aa938349f560abd27c973cd7f3af8d082f301858d41171b8a5b1dabdb63f",
  "original_prompt": "Ingested from linux-6.6.14/drivers/video/backlight/lms283gf05.c",
  "human_readable_source": "\n \n\n#include <linux/device.h>\n#include <linux/kernel.h>\n#include <linux/delay.h>\n#include <linux/slab.h>\n#include <linux/gpio/consumer.h>\n#include <linux/lcd.h>\n\n#include <linux/spi/spi.h>\n#include <linux/module.h>\n\nstruct lms283gf05_state {\n\tstruct spi_device\t*spi;\n\tstruct lcd_device\t*ld;\n\tstruct gpio_desc\t*reset;\n};\n\nstruct lms283gf05_seq {\n\tunsigned char\t\treg;\n\tunsigned short\t\tvalue;\n\tunsigned char\t\tdelay;\n};\n\n \nstatic const struct lms283gf05_seq disp_initseq[] = {\n\t \n\t{ 0x07, 0x0000, 0 },\n\t{ 0x13, 0x0000, 10 },\n\n\t{ 0x11, 0x3004, 0 },\n\t{ 0x14, 0x200F, 0 },\n\t{ 0x10, 0x1a20, 0 },\n\t{ 0x13, 0x0040, 50 },\n\n\t{ 0x13, 0x0060, 0 },\n\t{ 0x13, 0x0070, 200 },\n\n\t{ 0x01, 0x0127, 0 },\n\t{ 0x02,\t0x0700, 0 },\n\t{ 0x03, 0x1030, 0 },\n\t{ 0x08, 0x0208, 0 },\n\t{ 0x0B, 0x0620, 0 },\n\t{ 0x0C, 0x0110, 0 },\n\t{ 0x30, 0x0120, 0 },\n\t{ 0x31, 0x0127, 0 },\n\t{ 0x32, 0x0000, 0 },\n\t{ 0x33, 0x0503, 0 },\n\t{ 0x34, 0x0727, 0 },\n\t{ 0x35, 0x0124, 0 },\n\t{ 0x36, 0x0706, 0 },\n\t{ 0x37, 0x0701, 0 },\n\t{ 0x38, 0x0F00, 0 },\n\t{ 0x39, 0x0F00, 0 },\n\t{ 0x40, 0x0000, 0 },\n\t{ 0x41, 0x0000, 0 },\n\t{ 0x42, 0x013f, 0 },\n\t{ 0x43, 0x0000, 0 },\n\t{ 0x44, 0x013f, 0 },\n\t{ 0x45, 0x0000, 0 },\n\t{ 0x46, 0xef00, 0 },\n\t{ 0x47, 0x013f, 0 },\n\t{ 0x48, 0x0000, 0 },\n\t{ 0x07, 0x0015, 30 },\n\n\t{ 0x07, 0x0017, 0 },\n\n\t{ 0x20, 0x0000, 0 },\n\t{ 0x21, 0x0000, 0 },\n\t{ 0x22, 0x0000, 0 }\n};\n\nstatic const struct lms283gf05_seq disp_pdwnseq[] = {\n\t{ 0x07, 0x0016, 30 },\n\n\t{ 0x07, 0x0004, 0 },\n\t{ 0x10, 0x0220, 20 },\n\n\t{ 0x13, 0x0060, 50 },\n\n\t{ 0x13, 0x0040, 50 },\n\n\t{ 0x13, 0x0000, 0 },\n\t{ 0x10, 0x0000, 0 }\n};\n\n\nstatic void lms283gf05_reset(struct gpio_desc *gpiod)\n{\n\tgpiod_set_value(gpiod, 0);  \n\tmdelay(100);\n\tgpiod_set_value(gpiod, 1);  \n\tmdelay(20);\n\tgpiod_set_value(gpiod, 0);  \n\tmdelay(20);\n}\n\nstatic void lms283gf05_toggle(struct spi_device *spi,\n\t\t\t\tconst struct lms283gf05_seq *seq, int sz)\n{\n\tchar buf[3];\n\tint i;\n\n\tfor (i = 0; i < sz; i++) {\n\t\tbuf[0] = 0x74;\n\t\tbuf[1] = 0x00;\n\t\tbuf[2] = seq[i].reg;\n\t\tspi_write(spi, buf, 3);\n\n\t\tbuf[0] = 0x76;\n\t\tbuf[1] = seq[i].value >> 8;\n\t\tbuf[2] = seq[i].value & 0xff;\n\t\tspi_write(spi, buf, 3);\n\n\t\tmdelay(seq[i].delay);\n\t}\n}\n\nstatic int lms283gf05_power_set(struct lcd_device *ld, int power)\n{\n\tstruct lms283gf05_state *st = lcd_get_data(ld);\n\tstruct spi_device *spi = st->spi;\n\n\tif (power <= FB_BLANK_NORMAL) {\n\t\tif (st->reset)\n\t\t\tlms283gf05_reset(st->reset);\n\t\tlms283gf05_toggle(spi, disp_initseq, ARRAY_SIZE(disp_initseq));\n\t} else {\n\t\tlms283gf05_toggle(spi, disp_pdwnseq, ARRAY_SIZE(disp_pdwnseq));\n\t\tif (st->reset)\n\t\t\tgpiod_set_value(st->reset, 1);  \n\t}\n\n\treturn 0;\n}\n\nstatic struct lcd_ops lms_ops = {\n\t.set_power\t= lms283gf05_power_set,\n\t.get_power\t= NULL,\n};\n\nstatic int lms283gf05_probe(struct spi_device *spi)\n{\n\tstruct lms283gf05_state *st;\n\tstruct lcd_device *ld;\n\n\tst = devm_kzalloc(&spi->dev, sizeof(struct lms283gf05_state),\n\t\t\t\tGFP_KERNEL);\n\tif (st == NULL)\n\t\treturn -ENOMEM;\n\n\tst->reset = gpiod_get_optional(&spi->dev, \"reset\", GPIOD_OUT_LOW);\n\tif (IS_ERR(st->reset))\n\t\treturn PTR_ERR(st->reset);\n\tgpiod_set_consumer_name(st->reset, \"LMS283GF05 RESET\");\n\n\tld = devm_lcd_device_register(&spi->dev, \"lms283gf05\", &spi->dev, st,\n\t\t\t\t\t&lms_ops);\n\tif (IS_ERR(ld))\n\t\treturn PTR_ERR(ld);\n\n\tst->spi = spi;\n\tst->ld = ld;\n\n\tspi_set_drvdata(spi, st);\n\n\t \n\tif (st->reset)\n\t\tlms283gf05_reset(st->reset);\n\tlms283gf05_toggle(spi, disp_initseq, ARRAY_SIZE(disp_initseq));\n\n\treturn 0;\n}\n\nstatic struct spi_driver lms283gf05_driver = {\n\t.driver = {\n\t\t.name\t= \"lms283gf05\",\n\t},\n\t.probe\t\t= lms283gf05_probe,\n};\n\nmodule_spi_driver(lms283gf05_driver);\n\nMODULE_AUTHOR(\"Marek Vasut <marek.vasut@gmail.com>\");\nMODULE_DESCRIPTION(\"LCD283GF05 LCD\");\nMODULE_LICENSE(\"GPL v2\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}