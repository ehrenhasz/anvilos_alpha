{
  "module_name": "range.c",
  "hash_id": "9e2b76f8a60e018346bd066878a24191dee65174261a2b8374deefb087ea57e2",
  "original_prompt": "Ingested from linux-6.6.14/drivers/comedi/range.c",
  "human_readable_source": "\n \n\n#include <linux/uaccess.h>\n#include <linux/comedi/comedidev.h>\n#include \"comedi_internal.h\"\n\nconst struct comedi_lrange range_bipolar10 = { 1, {BIP_RANGE(10)} };\nEXPORT_SYMBOL_GPL(range_bipolar10);\nconst struct comedi_lrange range_bipolar5 = { 1, {BIP_RANGE(5)} };\nEXPORT_SYMBOL_GPL(range_bipolar5);\nconst struct comedi_lrange range_bipolar2_5 = { 1, {BIP_RANGE(2.5)} };\nEXPORT_SYMBOL_GPL(range_bipolar2_5);\nconst struct comedi_lrange range_unipolar10 = { 1, {UNI_RANGE(10)} };\nEXPORT_SYMBOL_GPL(range_unipolar10);\nconst struct comedi_lrange range_unipolar5 = { 1, {UNI_RANGE(5)} };\nEXPORT_SYMBOL_GPL(range_unipolar5);\nconst struct comedi_lrange range_unipolar2_5 = { 1, {UNI_RANGE(2.5)} };\nEXPORT_SYMBOL_GPL(range_unipolar2_5);\nconst struct comedi_lrange range_0_20mA = { 1, {RANGE_mA(0, 20)} };\nEXPORT_SYMBOL_GPL(range_0_20mA);\nconst struct comedi_lrange range_4_20mA = { 1, {RANGE_mA(4, 20)} };\nEXPORT_SYMBOL_GPL(range_4_20mA);\nconst struct comedi_lrange range_0_32mA = { 1, {RANGE_mA(0, 32)} };\nEXPORT_SYMBOL_GPL(range_0_32mA);\nconst struct comedi_lrange range_unknown = { 1, {{0, 1000000, UNIT_none} } };\nEXPORT_SYMBOL_GPL(range_unknown);\n\n \nint do_rangeinfo_ioctl(struct comedi_device *dev,\n\t\t       struct comedi_rangeinfo *it)\n{\n\tint subd, chan;\n\tconst struct comedi_lrange *lr;\n\tstruct comedi_subdevice *s;\n\n\tsubd = (it->range_type >> 24) & 0xf;\n\tchan = (it->range_type >> 16) & 0xff;\n\n\tif (!dev->attached)\n\t\treturn -EINVAL;\n\tif (subd >= dev->n_subdevices)\n\t\treturn -EINVAL;\n\ts = &dev->subdevices[subd];\n\tif (s->range_table) {\n\t\tlr = s->range_table;\n\t} else if (s->range_table_list) {\n\t\tif (chan >= s->n_chan)\n\t\t\treturn -EINVAL;\n\t\tlr = s->range_table_list[chan];\n\t} else {\n\t\treturn -EINVAL;\n\t}\n\n\tif (RANGE_LENGTH(it->range_type) != lr->length) {\n\t\tdev_dbg(dev->class_dev,\n\t\t\t\"wrong length %d should be %d (0x%08x)\\n\",\n\t\t\tRANGE_LENGTH(it->range_type),\n\t\t\tlr->length, it->range_type);\n\t\treturn -EINVAL;\n\t}\n\n\tif (copy_to_user(it->range_ptr, lr->range,\n\t\t\t sizeof(struct comedi_krange) * lr->length))\n\t\treturn -EFAULT;\n\n\treturn 0;\n}\n\n \nint comedi_check_chanlist(struct comedi_subdevice *s, int n,\n\t\t\t  unsigned int *chanlist)\n{\n\tstruct comedi_device *dev = s->device;\n\tunsigned int chanspec;\n\tint chan, range_len, i;\n\n\tfor (i = 0; i < n; i++) {\n\t\tchanspec = chanlist[i];\n\t\tchan = CR_CHAN(chanspec);\n\t\tif (s->range_table)\n\t\t\trange_len = s->range_table->length;\n\t\telse if (s->range_table_list && chan < s->n_chan)\n\t\t\trange_len = s->range_table_list[chan]->length;\n\t\telse\n\t\t\trange_len = 0;\n\t\tif (chan >= s->n_chan ||\n\t\t    CR_RANGE(chanspec) >= range_len) {\n\t\t\tdev_warn(dev->class_dev,\n\t\t\t\t \"bad chanlist[%d]=0x%08x chan=%d range length=%d\\n\",\n\t\t\t\t i, chanspec, chan, range_len);\n\t\t\treturn -EINVAL;\n\t\t}\n\t}\n\treturn 0;\n}\nEXPORT_SYMBOL_GPL(comedi_check_chanlist);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}