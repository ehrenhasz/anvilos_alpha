{
  "module_name": "pcl730.c",
  "hash_id": "404af8f8f524c80a627c329e8b1e43de07544027b90e201c38fd1cf899448810",
  "original_prompt": "Ingested from linux-6.6.14/drivers/comedi/drivers/pcl730.c",
  "human_readable_source": "\n \n\n \n\n#include <linux/module.h>\n#include <linux/comedi/comedidev.h>\n\n \n\nstruct pcl730_board {\n\tconst char *name;\n\tunsigned int io_range;\n\tunsigned is_pcl725:1;\n\tunsigned is_acl7225b:1;\n\tunsigned is_ir104:1;\n\tunsigned has_readback:1;\n\tunsigned has_ttl_io:1;\n\tint n_subdevs;\n\tint n_iso_out_chan;\n\tint n_iso_in_chan;\n\tint n_ttl_chan;\n};\n\nstatic const struct pcl730_board pcl730_boards[] = {\n\t{\n\t\t.name\t\t= \"pcl730\",\n\t\t.io_range\t= 0x04,\n\t\t.has_ttl_io\t= 1,\n\t\t.n_subdevs\t= 4,\n\t\t.n_iso_out_chan\t= 16,\n\t\t.n_iso_in_chan\t= 16,\n\t\t.n_ttl_chan\t= 16,\n\t}, {\n\t\t.name\t\t= \"iso730\",\n\t\t.io_range\t= 0x04,\n\t\t.n_subdevs\t= 4,\n\t\t.n_iso_out_chan\t= 16,\n\t\t.n_iso_in_chan\t= 16,\n\t\t.n_ttl_chan\t= 16,\n\t}, {\n\t\t.name\t\t= \"acl7130\",\n\t\t.io_range\t= 0x08,\n\t\t.has_ttl_io\t= 1,\n\t\t.n_subdevs\t= 4,\n\t\t.n_iso_out_chan\t= 16,\n\t\t.n_iso_in_chan\t= 16,\n\t\t.n_ttl_chan\t= 16,\n\t}, {\n\t\t.name\t\t= \"pcm3730\",\n\t\t.io_range\t= 0x04,\n\t\t.has_ttl_io\t= 1,\n\t\t.n_subdevs\t= 4,\n\t\t.n_iso_out_chan\t= 8,\n\t\t.n_iso_in_chan\t= 8,\n\t\t.n_ttl_chan\t= 16,\n\t}, {\n\t\t.name\t\t= \"pcl725\",\n\t\t.io_range\t= 0x02,\n\t\t.is_pcl725\t= 1,\n\t\t.n_subdevs\t= 2,\n\t\t.n_iso_out_chan\t= 8,\n\t\t.n_iso_in_chan\t= 8,\n\t}, {\n\t\t.name\t\t= \"p8r8dio\",\n\t\t.io_range\t= 0x02,\n\t\t.is_pcl725\t= 1,\n\t\t.has_readback\t= 1,\n\t\t.n_subdevs\t= 2,\n\t\t.n_iso_out_chan\t= 8,\n\t\t.n_iso_in_chan\t= 8,\n\t}, {\n\t\t.name\t\t= \"acl7225b\",\n\t\t.io_range\t= 0x08,\t\t \n\t\t.is_acl7225b\t= 1,\n\t\t.has_readback\t= 1,\n\t\t.n_subdevs\t= 2,\n\t\t.n_iso_out_chan\t= 16,\n\t\t.n_iso_in_chan\t= 16,\n\t}, {\n\t\t.name\t\t= \"p16r16dio\",\n\t\t.io_range\t= 0x04,\n\t\t.is_acl7225b\t= 1,\n\t\t.has_readback\t= 1,\n\t\t.n_subdevs\t= 2,\n\t\t.n_iso_out_chan\t= 16,\n\t\t.n_iso_in_chan\t= 16,\n\t}, {\n\t\t.name\t\t= \"pcl733\",\n\t\t.io_range\t= 0x04,\n\t\t.n_subdevs\t= 1,\n\t\t.n_iso_in_chan\t= 32,\n\t}, {\n\t\t.name\t\t= \"pcl734\",\n\t\t.io_range\t= 0x04,\n\t\t.n_subdevs\t= 1,\n\t\t.n_iso_out_chan\t= 32,\n\t}, {\n\t\t.name\t\t= \"opmm-1616-xt\",\n\t\t.io_range\t= 0x10,\n\t\t.is_acl7225b\t= 1,\n\t\t.has_readback\t= 1,\n\t\t.n_subdevs\t= 2,\n\t\t.n_iso_out_chan\t= 16,\n\t\t.n_iso_in_chan\t= 16,\n\t}, {\n\t\t.name\t\t= \"pearl-mm-p\",\n\t\t.io_range\t= 0x02,\n\t\t.n_subdevs\t= 1,\n\t\t.n_iso_out_chan\t= 16,\n\t}, {\n\t\t.name\t\t= \"ir104-pbf\",\n\t\t.io_range\t= 0x08,\n\t\t.is_ir104\t= 1,\n\t\t.has_readback\t= 1,\n\t\t.n_iso_out_chan\t= 20,\n\t\t.n_iso_in_chan\t= 20,\n\t},\n};\n\nstatic int pcl730_do_insn_bits(struct comedi_device *dev,\n\t\t\t       struct comedi_subdevice *s,\n\t\t\t       struct comedi_insn *insn,\n\t\t\t       unsigned int *data)\n{\n\tunsigned long reg = (unsigned long)s->private;\n\tunsigned int mask;\n\n\tmask = comedi_dio_update_state(s, data);\n\tif (mask) {\n\t\tif (mask & 0x00ff)\n\t\t\toutb(s->state & 0xff, dev->iobase + reg);\n\t\tif ((mask & 0xff00) && (s->n_chan > 8))\n\t\t\toutb((s->state >> 8) & 0xff, dev->iobase + reg + 1);\n\t\tif ((mask & 0xff0000) && (s->n_chan > 16))\n\t\t\toutb((s->state >> 16) & 0xff, dev->iobase + reg + 2);\n\t\tif ((mask & 0xff000000) && (s->n_chan > 24))\n\t\t\toutb((s->state >> 24) & 0xff, dev->iobase + reg + 3);\n\t}\n\n\tdata[1] = s->state;\n\n\treturn insn->n;\n}\n\nstatic unsigned int pcl730_get_bits(struct comedi_device *dev,\n\t\t\t\t    struct comedi_subdevice *s)\n{\n\tunsigned long reg = (unsigned long)s->private;\n\tunsigned int val;\n\n\tval = inb(dev->iobase + reg);\n\tif (s->n_chan > 8)\n\t\tval |= (inb(dev->iobase + reg + 1) << 8);\n\tif (s->n_chan > 16)\n\t\tval |= (inb(dev->iobase + reg + 2) << 16);\n\tif (s->n_chan > 24)\n\t\tval |= (inb(dev->iobase + reg + 3) << 24);\n\n\treturn val;\n}\n\nstatic int pcl730_di_insn_bits(struct comedi_device *dev,\n\t\t\t       struct comedi_subdevice *s,\n\t\t\t       struct comedi_insn *insn,\n\t\t\t       unsigned int *data)\n{\n\tdata[1] = pcl730_get_bits(dev, s);\n\n\treturn insn->n;\n}\n\nstatic int pcl730_attach(struct comedi_device *dev,\n\t\t\t struct comedi_devconfig *it)\n{\n\tconst struct pcl730_board *board = dev->board_ptr;\n\tstruct comedi_subdevice *s;\n\tint subdev;\n\tint ret;\n\n\tret = comedi_request_region(dev, it->options[0], board->io_range);\n\tif (ret)\n\t\treturn ret;\n\n\tret = comedi_alloc_subdevices(dev, board->n_subdevs);\n\tif (ret)\n\t\treturn ret;\n\n\tsubdev = 0;\n\n\tif (board->n_iso_out_chan) {\n\t\t \n\t\ts = &dev->subdevices[subdev++];\n\t\ts->type\t\t= COMEDI_SUBD_DO;\n\t\ts->subdev_flags\t= SDF_WRITABLE;\n\t\ts->n_chan\t= board->n_iso_out_chan;\n\t\ts->maxdata\t= 1;\n\t\ts->range_table\t= &range_digital;\n\t\ts->insn_bits\t= pcl730_do_insn_bits;\n\t\ts->private\t= (void *)0;\n\n\t\t \n\t\tif (board->has_readback)\n\t\t\ts->state = pcl730_get_bits(dev, s);\n\t}\n\n\tif (board->n_iso_in_chan) {\n\t\t \n\t\ts = &dev->subdevices[subdev++];\n\t\ts->type\t\t= COMEDI_SUBD_DI;\n\t\ts->subdev_flags\t= SDF_READABLE;\n\t\ts->n_chan\t= board->n_iso_in_chan;\n\t\ts->maxdata\t= 1;\n\t\ts->range_table\t= &range_digital;\n\t\ts->insn_bits\t= pcl730_di_insn_bits;\n\t\ts->private\t= board->is_ir104 ? (void *)4 :\n\t\t\t\t  board->is_acl7225b ? (void *)2 :\n\t\t\t\t  board->is_pcl725 ? (void *)1 : (void *)0;\n\t}\n\n\tif (board->has_ttl_io) {\n\t\t \n\t\ts = &dev->subdevices[subdev++];\n\t\ts->type\t\t= COMEDI_SUBD_DO;\n\t\ts->subdev_flags\t= SDF_WRITABLE;\n\t\ts->n_chan\t= board->n_ttl_chan;\n\t\ts->maxdata\t= 1;\n\t\ts->range_table\t= &range_digital;\n\t\ts->insn_bits\t= pcl730_do_insn_bits;\n\t\ts->private\t= (void *)2;\n\n\t\t \n\t\ts = &dev->subdevices[subdev++];\n\t\ts->type\t\t= COMEDI_SUBD_DI;\n\t\ts->subdev_flags\t= SDF_READABLE;\n\t\ts->n_chan\t= board->n_ttl_chan;\n\t\ts->maxdata\t= 1;\n\t\ts->range_table\t= &range_digital;\n\t\ts->insn_bits\t= pcl730_di_insn_bits;\n\t\ts->private\t= (void *)2;\n\t}\n\n\treturn 0;\n}\n\nstatic struct comedi_driver pcl730_driver = {\n\t.driver_name\t= \"pcl730\",\n\t.module\t\t= THIS_MODULE,\n\t.attach\t\t= pcl730_attach,\n\t.detach\t\t= comedi_legacy_detach,\n\t.board_name\t= &pcl730_boards[0].name,\n\t.num_names\t= ARRAY_SIZE(pcl730_boards),\n\t.offset\t\t= sizeof(struct pcl730_board),\n};\nmodule_comedi_driver(pcl730_driver);\n\nMODULE_AUTHOR(\"Comedi https://www.comedi.org\");\nMODULE_DESCRIPTION(\"Comedi low-level driver\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}