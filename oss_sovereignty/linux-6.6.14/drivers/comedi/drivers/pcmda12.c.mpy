{
  "module_name": "pcmda12.c",
  "hash_id": "2a1ebb2801788a7b22f3bcfe88bf1a031f1da7654a0deb7ef812db880beb73e5",
  "original_prompt": "Ingested from linux-6.6.14/drivers/comedi/drivers/pcmda12.c",
  "human_readable_source": "\n \n\n \n\n#include <linux/module.h>\n#include <linux/comedi/comedidev.h>\n\n \nstatic const struct comedi_lrange pcmda12_ranges = {\n\t3, {\n\t\tUNI_RANGE(5),\n\t\tUNI_RANGE(10),\n\t\tBIP_RANGE(5)\n\t}\n};\n\nstruct pcmda12_private {\n\tint simultaneous_xfer_mode;\n};\n\nstatic int pcmda12_ao_insn_write(struct comedi_device *dev,\n\t\t\t\t struct comedi_subdevice *s,\n\t\t\t\t struct comedi_insn *insn,\n\t\t\t\t unsigned int *data)\n{\n\tstruct pcmda12_private *devpriv = dev->private;\n\tunsigned int chan = CR_CHAN(insn->chanspec);\n\tunsigned int val = s->readback[chan];\n\tunsigned long ioreg = dev->iobase + (chan * 2);\n\tint i;\n\n\tfor (i = 0; i < insn->n; ++i) {\n\t\tval = data[i];\n\t\toutb(val & 0xff, ioreg);\n\t\toutb((val >> 8) & 0xff, ioreg + 1);\n\n\t\t \n\t\tif (!devpriv->simultaneous_xfer_mode)\n\t\t\tinb(ioreg);\n\t}\n\ts->readback[chan] = val;\n\n\treturn insn->n;\n}\n\nstatic int pcmda12_ao_insn_read(struct comedi_device *dev,\n\t\t\t\tstruct comedi_subdevice *s,\n\t\t\t\tstruct comedi_insn *insn,\n\t\t\t\tunsigned int *data)\n{\n\tstruct pcmda12_private *devpriv = dev->private;\n\n\t \n\tif (devpriv->simultaneous_xfer_mode)\n\t\tinb(dev->iobase);\n\n\treturn comedi_readback_insn_read(dev, s, insn, data);\n}\n\nstatic void pcmda12_ao_reset(struct comedi_device *dev,\n\t\t\t     struct comedi_subdevice *s)\n{\n\tint i;\n\n\tfor (i = 0; i < s->n_chan; ++i) {\n\t\toutb(0, dev->iobase + (i * 2));\n\t\toutb(0, dev->iobase + (i * 2) + 1);\n\t}\n\t \n\tinb(dev->iobase);\n}\n\nstatic int pcmda12_attach(struct comedi_device *dev,\n\t\t\t  struct comedi_devconfig *it)\n{\n\tstruct pcmda12_private *devpriv;\n\tstruct comedi_subdevice *s;\n\tint ret;\n\n\tret = comedi_request_region(dev, it->options[0], 0x10);\n\tif (ret)\n\t\treturn ret;\n\n\tdevpriv = comedi_alloc_devpriv(dev, sizeof(*devpriv));\n\tif (!devpriv)\n\t\treturn -ENOMEM;\n\n\tdevpriv->simultaneous_xfer_mode = it->options[1];\n\n\tret = comedi_alloc_subdevices(dev, 1);\n\tif (ret)\n\t\treturn ret;\n\n\ts = &dev->subdevices[0];\n\ts->type\t\t= COMEDI_SUBD_AO;\n\ts->subdev_flags\t= SDF_READABLE | SDF_WRITABLE;\n\ts->n_chan\t= 8;\n\ts->maxdata\t= 0x0fff;\n\ts->range_table\t= &pcmda12_ranges;\n\ts->insn_write\t= pcmda12_ao_insn_write;\n\ts->insn_read\t= pcmda12_ao_insn_read;\n\n\tret = comedi_alloc_subdev_readback(s);\n\tif (ret)\n\t\treturn ret;\n\n\tpcmda12_ao_reset(dev, s);\n\n\treturn 0;\n}\n\nstatic struct comedi_driver pcmda12_driver = {\n\t.driver_name\t= \"pcmda12\",\n\t.module\t\t= THIS_MODULE,\n\t.attach\t\t= pcmda12_attach,\n\t.detach\t\t= comedi_legacy_detach,\n};\nmodule_comedi_driver(pcmda12_driver);\n\nMODULE_AUTHOR(\"Comedi https://www.comedi.org\");\nMODULE_DESCRIPTION(\"Comedi low-level driver\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}