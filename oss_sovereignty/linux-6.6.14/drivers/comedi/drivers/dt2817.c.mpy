{
  "module_name": "dt2817.c",
  "hash_id": "81c1775839fb7ea7d33650701bfdc3567f329ad7826b0cc25bb17a930cc48d67",
  "original_prompt": "Ingested from linux-6.6.14/drivers/comedi/drivers/dt2817.c",
  "human_readable_source": "\n \n \n\n#include <linux/module.h>\n#include <linux/comedi/comedidev.h>\n\n#define DT2817_CR 0\n#define DT2817_DATA 1\n\nstatic int dt2817_dio_insn_config(struct comedi_device *dev,\n\t\t\t\t  struct comedi_subdevice *s,\n\t\t\t\t  struct comedi_insn *insn,\n\t\t\t\t  unsigned int *data)\n{\n\tunsigned int chan = CR_CHAN(insn->chanspec);\n\tunsigned int oe = 0;\n\tunsigned int mask;\n\tint ret;\n\n\tif (chan < 8)\n\t\tmask = 0x000000ff;\n\telse if (chan < 16)\n\t\tmask = 0x0000ff00;\n\telse if (chan < 24)\n\t\tmask = 0x00ff0000;\n\telse\n\t\tmask = 0xff000000;\n\n\tret = comedi_dio_insn_config(dev, s, insn, data, mask);\n\tif (ret)\n\t\treturn ret;\n\n\tif (s->io_bits & 0x000000ff)\n\t\toe |= 0x1;\n\tif (s->io_bits & 0x0000ff00)\n\t\toe |= 0x2;\n\tif (s->io_bits & 0x00ff0000)\n\t\toe |= 0x4;\n\tif (s->io_bits & 0xff000000)\n\t\toe |= 0x8;\n\n\toutb(oe, dev->iobase + DT2817_CR);\n\n\treturn insn->n;\n}\n\nstatic int dt2817_dio_insn_bits(struct comedi_device *dev,\n\t\t\t\tstruct comedi_subdevice *s,\n\t\t\t\tstruct comedi_insn *insn,\n\t\t\t\tunsigned int *data)\n{\n\tunsigned long iobase = dev->iobase + DT2817_DATA;\n\tunsigned int mask;\n\tunsigned int val;\n\n\tmask = comedi_dio_update_state(s, data);\n\tif (mask) {\n\t\tif (mask & 0x000000ff)\n\t\t\toutb(s->state & 0xff, iobase + 0);\n\t\tif (mask & 0x0000ff00)\n\t\t\toutb((s->state >> 8) & 0xff, iobase + 1);\n\t\tif (mask & 0x00ff0000)\n\t\t\toutb((s->state >> 16) & 0xff, iobase + 2);\n\t\tif (mask & 0xff000000)\n\t\t\toutb((s->state >> 24) & 0xff, iobase + 3);\n\t}\n\n\tval = inb(iobase + 0);\n\tval |= (inb(iobase + 1) << 8);\n\tval |= (inb(iobase + 2) << 16);\n\tval |= (inb(iobase + 3) << 24);\n\n\tdata[1] = val;\n\n\treturn insn->n;\n}\n\nstatic int dt2817_attach(struct comedi_device *dev, struct comedi_devconfig *it)\n{\n\tint ret;\n\tstruct comedi_subdevice *s;\n\n\tret = comedi_request_region(dev, it->options[0], 0x5);\n\tif (ret)\n\t\treturn ret;\n\n\tret = comedi_alloc_subdevices(dev, 1);\n\tif (ret)\n\t\treturn ret;\n\n\ts = &dev->subdevices[0];\n\n\ts->n_chan = 32;\n\ts->type = COMEDI_SUBD_DIO;\n\ts->subdev_flags = SDF_READABLE | SDF_WRITABLE;\n\ts->range_table = &range_digital;\n\ts->maxdata = 1;\n\ts->insn_bits = dt2817_dio_insn_bits;\n\ts->insn_config = dt2817_dio_insn_config;\n\n\ts->state = 0;\n\toutb(0, dev->iobase + DT2817_CR);\n\n\treturn 0;\n}\n\nstatic struct comedi_driver dt2817_driver = {\n\t.driver_name\t= \"dt2817\",\n\t.module\t\t= THIS_MODULE,\n\t.attach\t\t= dt2817_attach,\n\t.detach\t\t= comedi_legacy_detach,\n};\nmodule_comedi_driver(dt2817_driver);\n\nMODULE_AUTHOR(\"Comedi https://www.comedi.org\");\nMODULE_DESCRIPTION(\"Comedi low-level driver\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}