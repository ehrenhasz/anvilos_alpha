{
  "module_name": "rti802.c",
  "hash_id": "305b12969eb2abc3e3d0b7c07e01a6742e610f712d937aa8a0cada60eedf4cc2",
  "original_prompt": "Ingested from linux-6.6.14/drivers/comedi/drivers/rti802.c",
  "human_readable_source": "\n \n\n \n\n#include <linux/module.h>\n#include <linux/comedi/comedidev.h>\n\n \n#define RTI802_SELECT\t\t0x00\n#define RTI802_DATALOW\t\t0x01\n#define RTI802_DATAHIGH\t\t0x02\n\nstruct rti802_private {\n\tenum {\n\t\tdac_2comp, dac_straight\n\t} dac_coding[8];\n\tconst struct comedi_lrange *range_type_list[8];\n};\n\nstatic int rti802_ao_insn_write(struct comedi_device *dev,\n\t\t\t\tstruct comedi_subdevice *s,\n\t\t\t\tstruct comedi_insn *insn,\n\t\t\t\tunsigned int *data)\n{\n\tstruct rti802_private *devpriv = dev->private;\n\tunsigned int chan = CR_CHAN(insn->chanspec);\n\tint i;\n\n\toutb(chan, dev->iobase + RTI802_SELECT);\n\n\tfor (i = 0; i < insn->n; i++) {\n\t\tunsigned int val = data[i];\n\n\t\ts->readback[chan] = val;\n\n\t\t \n\t\tif (devpriv->dac_coding[chan] == dac_2comp)\n\t\t\tval = comedi_offset_munge(s, val);\n\n\t\toutb(val & 0xff, dev->iobase + RTI802_DATALOW);\n\t\toutb((val >> 8) & 0xff, dev->iobase + RTI802_DATAHIGH);\n\t}\n\n\treturn insn->n;\n}\n\nstatic int rti802_attach(struct comedi_device *dev, struct comedi_devconfig *it)\n{\n\tstruct rti802_private *devpriv;\n\tstruct comedi_subdevice *s;\n\tint i;\n\tint ret;\n\n\tret = comedi_request_region(dev, it->options[0], 0x04);\n\tif (ret)\n\t\treturn ret;\n\n\tdevpriv = comedi_alloc_devpriv(dev, sizeof(*devpriv));\n\tif (!devpriv)\n\t\treturn -ENOMEM;\n\n\tret = comedi_alloc_subdevices(dev, 1);\n\tif (ret)\n\t\treturn ret;\n\n\t \n\ts = &dev->subdevices[0];\n\ts->type\t\t= COMEDI_SUBD_AO;\n\ts->subdev_flags\t= SDF_WRITABLE;\n\ts->maxdata\t= 0xfff;\n\ts->n_chan\t= 8;\n\ts->insn_write\t= rti802_ao_insn_write;\n\n\tret = comedi_alloc_subdev_readback(s);\n\tif (ret)\n\t\treturn ret;\n\n\ts->range_table_list = devpriv->range_type_list;\n\tfor (i = 0; i < 8; i++) {\n\t\tdevpriv->dac_coding[i] = (it->options[3 + 2 * i])\n\t\t\t? (dac_straight) : (dac_2comp);\n\t\tdevpriv->range_type_list[i] = (it->options[2 + 2 * i])\n\t\t\t? &range_unipolar10 : &range_bipolar10;\n\t}\n\n\treturn 0;\n}\n\nstatic struct comedi_driver rti802_driver = {\n\t.driver_name\t= \"rti802\",\n\t.module\t\t= THIS_MODULE,\n\t.attach\t\t= rti802_attach,\n\t.detach\t\t= comedi_legacy_detach,\n};\nmodule_comedi_driver(rti802_driver);\n\nMODULE_AUTHOR(\"Comedi https://www.comedi.org\");\nMODULE_DESCRIPTION(\"Comedi driver for Analog Devices RTI-802 board\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}