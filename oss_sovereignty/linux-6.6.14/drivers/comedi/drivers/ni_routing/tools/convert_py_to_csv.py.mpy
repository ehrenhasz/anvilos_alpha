{
  "module_name": "convert_py_to_csv.py",
  "hash_id": "c72f92369291b69950cd279825ad0ba44fbb2bebd6ff9ae400c79c8f0bd8e0d8",
  "original_prompt": "Ingested from linux-6.6.14/drivers/comedi/drivers/ni_routing/tools/convert_py_to_csv.py",
  "human_readable_source": "#!/usr/bin/env python3\n# SPDX-License-Identifier: GPL-2.0+\n\nfrom os import path\nimport os, csv\nfrom itertools import chain\n\nfrom csv_collection import CSVCollection\nfrom ni_names import value_to_name\nimport ni_values\n\nCSV_DIR = 'csv'\n\ndef iter_src_values(D):\n  return D.items()\n\ndef iter_src(D):\n  for dest in D:\n    yield dest, 1\n\ndef create_csv(name, D, src_iter):\n  # have to change dest->{src:val} to src->{dest:val}\n  fieldnames = [value_to_name[i] for i in sorted(D.keys())]\n  fieldnames.insert(0, CSVCollection.source_column_name)\n\n  S = dict()\n  for dest, srcD in D.items():\n    for src,val in src_iter(srcD):\n      S.setdefault(src,{})[dest] = val\n\n  S = sorted(S.items(), key = lambda src_destD : src_destD[0])\n\n\n  csv_fname = path.join(CSV_DIR, name + '.csv')\n  with open(csv_fname, 'w') as F_csv:\n    dR = csv.DictWriter(F_csv, fieldnames, delimiter=';', quotechar='\"')\n    dR.writeheader()\n\n    # now change the json back into the csv dictionaries\n    rows = [\n      dict(chain(\n        ((CSVCollection.source_column_name,value_to_name[src]),),\n        *(((value_to_name[dest],v),) for dest,v in destD.items())\n      ))\n      for src, destD in S\n    ]\n\n    dR.writerows(rows)\n\n\ndef to_csv():\n  for d in ['route_values', 'device_routes']:\n    try:\n      os.makedirs(path.join(CSV_DIR,d))\n    except:\n      pass\n\n  for family, dst_src_map in ni_values.ni_route_values.items():\n    create_csv(path.join('route_values',family), dst_src_map, iter_src_values)\n\n  for device, dst_src_map in ni_values.ni_device_routes.items():\n    create_csv(path.join('device_routes',device), dst_src_map, iter_src)\n\n\nif __name__ == '__main__':\n  to_csv()\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}