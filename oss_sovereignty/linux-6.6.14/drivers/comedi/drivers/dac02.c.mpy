{
  "module_name": "dac02.c",
  "hash_id": "39ea8fc9730452a260bbea2e84ee08532216b641387df97569577126197fed4f",
  "original_prompt": "Ingested from linux-6.6.14/drivers/comedi/drivers/dac02.c",
  "human_readable_source": "\n \n\n \n\n#include <linux/module.h>\n#include <linux/comedi/comedidev.h>\n\n \nstatic const struct comedi_lrange das02_ao_ranges = {\n\t6, {\n\t\tUNI_RANGE(5),\n\t\tUNI_RANGE(10),\n\t\tBIP_RANGE(5),\n\t\tBIP_RANGE(10),\n\t\tRANGE_mA(4, 20),\n\t\tRANGE_ext(0, 1)\n\t}\n};\n\n \n#define DAC02_AO_LSB(x)\t\t(0x00 + ((x) * 2))\n#define DAC02_AO_MSB(x)\t\t(0x01 + ((x) * 2))\n\nstatic int dac02_ao_insn_write(struct comedi_device *dev,\n\t\t\t       struct comedi_subdevice *s,\n\t\t\t       struct comedi_insn *insn,\n\t\t\t       unsigned int *data)\n{\n\tunsigned int chan = CR_CHAN(insn->chanspec);\n\tunsigned int range = CR_RANGE(insn->chanspec);\n\tunsigned int val;\n\tint i;\n\n\tfor (i = 0; i < insn->n; i++) {\n\t\tval = data[i];\n\n\t\ts->readback[chan] = val;\n\n\t\t \n\t\tif (comedi_range_is_bipolar(s, range))\n\t\t\tval = s->maxdata - val;\n\n\t\t \n\t\toutb((val << 4) & 0xf0, dev->iobase + DAC02_AO_LSB(chan));\n\t\toutb((val >> 4) & 0xff, dev->iobase + DAC02_AO_MSB(chan));\n\t}\n\n\treturn insn->n;\n}\n\nstatic int dac02_attach(struct comedi_device *dev, struct comedi_devconfig *it)\n{\n\tstruct comedi_subdevice *s;\n\tint ret;\n\n\tret = comedi_request_region(dev, it->options[0], 0x08);\n\tif (ret)\n\t\treturn ret;\n\n\tret = comedi_alloc_subdevices(dev, 1);\n\tif (ret)\n\t\treturn ret;\n\n\t \n\ts = &dev->subdevices[0];\n\ts->type\t\t= COMEDI_SUBD_AO;\n\ts->subdev_flags\t= SDF_WRITABLE;\n\ts->n_chan\t= 2;\n\ts->maxdata\t= 0x0fff;\n\ts->range_table\t= &das02_ao_ranges;\n\ts->insn_write\t= dac02_ao_insn_write;\n\n\treturn comedi_alloc_subdev_readback(s);\n}\n\nstatic struct comedi_driver dac02_driver = {\n\t.driver_name\t= \"dac02\",\n\t.module\t\t= THIS_MODULE,\n\t.attach\t\t= dac02_attach,\n\t.detach\t\t= comedi_legacy_detach,\n};\nmodule_comedi_driver(dac02_driver);\n\nMODULE_AUTHOR(\"H Hartley Sweeten <hsweeten@visionengravers.com>\");\nMODULE_DESCRIPTION(\"Comedi driver for DAC02 compatible boards\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}