{
  "module_name": "pcl724.c",
  "hash_id": "73b214ebb600e0704afd83297a0e8503fead855777e496be74eea7bcaa5addb5",
  "original_prompt": "Ingested from linux-6.6.14/drivers/comedi/drivers/pcl724.c",
  "human_readable_source": "\n \n\n \n\n#include <linux/module.h>\n#include <linux/comedi/comedidev.h>\n#include <linux/comedi/comedi_8255.h>\n\nstruct pcl724_board {\n\tconst char *name;\n\tunsigned int io_range;\n\tunsigned int can_have96:1;\n\tunsigned int is_pet48:1;\n\tint numofports;\n};\n\nstatic const struct pcl724_board boardtypes[] = {\n\t{\n\t\t.name\t\t= \"pcl724\",\n\t\t.io_range\t= 0x04,\n\t\t.numofports\t= 1,\t \n\t}, {\n\t\t.name\t\t= \"pcl722\",\n\t\t.io_range\t= 0x20,\n\t\t.can_have96\t= 1,\n\t\t.numofports\t= 6,\t \n\t}, {\n\t\t.name\t\t= \"pcl731\",\n\t\t.io_range\t= 0x08,\n\t\t.numofports\t= 2,\t \n\t}, {\n\t\t.name\t\t= \"acl7122\",\n\t\t.io_range\t= 0x20,\n\t\t.can_have96\t= 1,\n\t\t.numofports\t= 6,\t \n\t}, {\n\t\t.name\t\t= \"acl7124\",\n\t\t.io_range\t= 0x04,\n\t\t.numofports\t= 1,\t \n\t}, {\n\t\t.name\t\t= \"pet48dio\",\n\t\t.io_range\t= 0x02,\n\t\t.is_pet48\t= 1,\n\t\t.numofports\t= 2,\t \n\t}, {\n\t\t.name\t\t= \"pcmio48\",\n\t\t.io_range\t= 0x08,\n\t\t.numofports\t= 2,\t \n\t}, {\n\t\t.name\t\t= \"onyx-mm-dio\",\n\t\t.io_range\t= 0x10,\n\t\t.numofports\t= 2,\t \n\t},\n};\n\nstatic int pcl724_8255mapped_io(struct comedi_device *dev,\n\t\t\t\tint dir, int port, int data,\n\t\t\t\tunsigned long iobase)\n{\n\tint movport = I8255_SIZE * (iobase >> 12);\n\n\tiobase &= 0x0fff;\n\n\toutb(port + movport, iobase);\n\tif (dir) {\n\t\toutb(data, iobase + 1);\n\t\treturn 0;\n\t}\n\treturn inb(iobase + 1);\n}\n\nstatic int pcl724_attach(struct comedi_device *dev,\n\t\t\t struct comedi_devconfig *it)\n{\n\tconst struct pcl724_board *board = dev->board_ptr;\n\tstruct comedi_subdevice *s;\n\tunsigned long iobase;\n\tunsigned int iorange;\n\tint n_subdevices;\n\tint ret;\n\tint i;\n\n\tiorange = board->io_range;\n\tn_subdevices = board->numofports;\n\n\t \n\tif (board->can_have96 &&\n\t    (it->options[2] == 1 || it->options[2] == 96)) {\n\t\tiorange = 0x10;\n\t\tn_subdevices = 4;\n\t}\n\n\tret = comedi_request_region(dev, it->options[0], iorange);\n\tif (ret)\n\t\treturn ret;\n\n\tret = comedi_alloc_subdevices(dev, n_subdevices);\n\tif (ret)\n\t\treturn ret;\n\n\tfor (i = 0; i < dev->n_subdevices; i++) {\n\t\ts = &dev->subdevices[i];\n\t\tif (board->is_pet48) {\n\t\t\tiobase = dev->iobase + (i * 0x1000);\n\t\t\tret = subdev_8255_init(dev, s, pcl724_8255mapped_io,\n\t\t\t\t\t       iobase);\n\t\t} else {\n\t\t\tret = subdev_8255_init(dev, s, NULL, i * I8255_SIZE);\n\t\t}\n\t\tif (ret)\n\t\t\treturn ret;\n\t}\n\n\treturn 0;\n}\n\nstatic struct comedi_driver pcl724_driver = {\n\t.driver_name\t= \"pcl724\",\n\t.module\t\t= THIS_MODULE,\n\t.attach\t\t= pcl724_attach,\n\t.detach\t\t= comedi_legacy_detach,\n\t.board_name\t= &boardtypes[0].name,\n\t.num_names\t= ARRAY_SIZE(boardtypes),\n\t.offset\t\t= sizeof(struct pcl724_board),\n};\nmodule_comedi_driver(pcl724_driver);\n\nMODULE_AUTHOR(\"Comedi https://www.comedi.org\");\nMODULE_DESCRIPTION(\"Comedi driver for 8255 based ISA and PC/104 DIO boards\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}