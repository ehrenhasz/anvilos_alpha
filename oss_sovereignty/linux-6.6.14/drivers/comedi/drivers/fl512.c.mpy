{
  "module_name": "fl512.c",
  "hash_id": "eae8a08a20d1f3d0af2c9fc3e79efe74efbb485413f79bd6d7aaca31b32a0ff3",
  "original_prompt": "Ingested from linux-6.6.14/drivers/comedi/drivers/fl512.c",
  "human_readable_source": "\n \n\n \n\n#include <linux/module.h>\n#include <linux/comedi/comedidev.h>\n#include <linux/delay.h>\n\n \n#define FL512_AI_LSB_REG\t\t0x02\n#define FL512_AI_MSB_REG\t\t0x03\n#define FL512_AI_MUX_REG\t\t0x02\n#define FL512_AI_START_CONV_REG\t\t0x03\n#define FL512_AO_DATA_REG(x)\t\t(0x04 + ((x) * 2))\n#define FL512_AO_TRIG_REG(x)\t\t(0x04 + ((x) * 2))\n\nstatic const struct comedi_lrange range_fl512 = {\n\t4, {\n\t\tBIP_RANGE(0.5),\n\t\tBIP_RANGE(1),\n\t\tBIP_RANGE(5),\n\t\tBIP_RANGE(10),\n\t\tUNI_RANGE(1),\n\t\tUNI_RANGE(5),\n\t\tUNI_RANGE(10)\n\t}\n};\n\nstatic int fl512_ai_insn_read(struct comedi_device *dev,\n\t\t\t      struct comedi_subdevice *s,\n\t\t\t      struct comedi_insn *insn,\n\t\t\t      unsigned int *data)\n{\n\tunsigned int chan = CR_CHAN(insn->chanspec);\n\tunsigned int val;\n\tint i;\n\n\toutb(chan, dev->iobase + FL512_AI_MUX_REG);\n\n\tfor (i = 0; i < insn->n; i++) {\n\t\toutb(0, dev->iobase + FL512_AI_START_CONV_REG);\n\n\t\t \n\t\tusleep_range(30, 100);\n\n\t\tval = inb(dev->iobase + FL512_AI_LSB_REG);\n\t\tval |= (inb(dev->iobase + FL512_AI_MSB_REG) << 8);\n\t\tval &= s->maxdata;\n\n\t\tdata[i] = val;\n\t}\n\n\treturn insn->n;\n}\n\nstatic int fl512_ao_insn_write(struct comedi_device *dev,\n\t\t\t       struct comedi_subdevice *s,\n\t\t\t       struct comedi_insn *insn,\n\t\t\t       unsigned int *data)\n{\n\tunsigned int chan = CR_CHAN(insn->chanspec);\n\tunsigned int val = s->readback[chan];\n\tint i;\n\n\tfor (i = 0; i < insn->n; i++) {\n\t\tval = data[i];\n\n\t\t \n\t\toutb(val & 0x0ff, dev->iobase + FL512_AO_DATA_REG(chan));\n\t\toutb((val >> 8) & 0xf, dev->iobase + FL512_AO_DATA_REG(chan));\n\t\tinb(dev->iobase + FL512_AO_TRIG_REG(chan));\n\t}\n\ts->readback[chan] = val;\n\n\treturn insn->n;\n}\n\nstatic int fl512_attach(struct comedi_device *dev, struct comedi_devconfig *it)\n{\n\tstruct comedi_subdevice *s;\n\tint ret;\n\n\tret = comedi_request_region(dev, it->options[0], 0x10);\n\tif (ret)\n\t\treturn ret;\n\n\tret = comedi_alloc_subdevices(dev, 2);\n\tif (ret)\n\t\treturn ret;\n\n\t \n\ts = &dev->subdevices[0];\n\ts->type\t\t= COMEDI_SUBD_AI;\n\ts->subdev_flags\t= SDF_READABLE | SDF_GROUND;\n\ts->n_chan\t= 16;\n\ts->maxdata\t= 0x0fff;\n\ts->range_table\t= &range_fl512;\n\ts->insn_read\t= fl512_ai_insn_read;\n\n\t \n\ts = &dev->subdevices[1];\n\ts->type\t\t= COMEDI_SUBD_AO;\n\ts->subdev_flags\t= SDF_WRITABLE;\n\ts->n_chan\t= 2;\n\ts->maxdata\t= 0x0fff;\n\ts->range_table\t= &range_fl512;\n\ts->insn_write\t= fl512_ao_insn_write;\n\n\treturn comedi_alloc_subdev_readback(s);\n}\n\nstatic struct comedi_driver fl512_driver = {\n\t.driver_name\t= \"fl512\",\n\t.module\t\t= THIS_MODULE,\n\t.attach\t\t= fl512_attach,\n\t.detach\t\t= comedi_legacy_detach,\n};\nmodule_comedi_driver(fl512_driver);\n\nMODULE_AUTHOR(\"Comedi https://www.comedi.org\");\nMODULE_DESCRIPTION(\"Comedi low-level driver\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}