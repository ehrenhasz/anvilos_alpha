{
  "module_name": "adl_pci8164.c",
  "hash_id": "15f274428ef1e0b59a177d24a1d2530273a4830f20cc727cad0ad22a33f12c5a",
  "original_prompt": "Ingested from linux-6.6.14/drivers/comedi/drivers/adl_pci8164.c",
  "human_readable_source": "\n \n\n \n\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/comedi/comedi_pci.h>\n\n#define PCI8164_AXIS(x)\t\t((x) * 0x08)\n#define PCI8164_CMD_MSTS_REG\t0x00\n#define PCI8164_OTP_SSTS_REG\t0x02\n#define PCI8164_BUF0_REG\t0x04\n#define PCI8164_BUF1_REG\t0x06\n\nstatic int adl_pci8164_insn_read(struct comedi_device *dev,\n\t\t\t\t struct comedi_subdevice *s,\n\t\t\t\t struct comedi_insn *insn,\n\t\t\t\t unsigned int *data)\n{\n\tunsigned long offset = (unsigned long)s->private;\n\tunsigned int chan = CR_CHAN(insn->chanspec);\n\tint i;\n\n\tfor (i = 0; i < insn->n; i++)\n\t\tdata[i] = inw(dev->iobase + PCI8164_AXIS(chan) + offset);\n\n\treturn insn->n;\n}\n\nstatic int adl_pci8164_insn_write(struct comedi_device *dev,\n\t\t\t\t  struct comedi_subdevice *s,\n\t\t\t\t  struct comedi_insn *insn,\n\t\t\t\t  unsigned int *data)\n{\n\tunsigned long offset = (unsigned long)s->private;\n\tunsigned int chan = CR_CHAN(insn->chanspec);\n\tint i;\n\n\tfor (i = 0; i < insn->n; i++)\n\t\toutw(data[i], dev->iobase + PCI8164_AXIS(chan) + offset);\n\n\treturn insn->n;\n}\n\nstatic int adl_pci8164_auto_attach(struct comedi_device *dev,\n\t\t\t\t   unsigned long context_unused)\n{\n\tstruct pci_dev *pcidev = comedi_to_pci_dev(dev);\n\tstruct comedi_subdevice *s;\n\tint ret;\n\n\tret = comedi_pci_enable(dev);\n\tif (ret)\n\t\treturn ret;\n\tdev->iobase = pci_resource_start(pcidev, 2);\n\n\tret = comedi_alloc_subdevices(dev, 4);\n\tif (ret)\n\t\treturn ret;\n\n\t \n\ts = &dev->subdevices[0];\n\ts->type\t\t= COMEDI_SUBD_PROC;\n\ts->subdev_flags\t= SDF_READABLE | SDF_WRITABLE;\n\ts->n_chan\t= 4;\n\ts->maxdata\t= 0xffff;\n\ts->len_chanlist\t= 4;\n\ts->insn_read\t= adl_pci8164_insn_read;\n\ts->insn_write\t= adl_pci8164_insn_write;\n\ts->private\t= (void *)PCI8164_CMD_MSTS_REG;\n\n\t \n\ts = &dev->subdevices[1];\n\ts->type\t\t= COMEDI_SUBD_PROC;\n\ts->subdev_flags\t= SDF_READABLE | SDF_WRITABLE;\n\ts->n_chan\t= 4;\n\ts->maxdata\t= 0xffff;\n\ts->len_chanlist\t= 4;\n\ts->insn_read\t= adl_pci8164_insn_read;\n\ts->insn_write\t= adl_pci8164_insn_write;\n\ts->private\t= (void *)PCI8164_OTP_SSTS_REG;\n\n\t \n\ts = &dev->subdevices[2];\n\ts->type\t\t= COMEDI_SUBD_PROC;\n\ts->subdev_flags\t= SDF_READABLE | SDF_WRITABLE;\n\ts->n_chan\t= 4;\n\ts->maxdata\t= 0xffff;\n\ts->len_chanlist\t= 4;\n\ts->insn_read\t= adl_pci8164_insn_read;\n\ts->insn_write\t= adl_pci8164_insn_write;\n\ts->private\t= (void *)PCI8164_BUF0_REG;\n\n\t \n\ts = &dev->subdevices[3];\n\ts->type\t\t= COMEDI_SUBD_PROC;\n\ts->subdev_flags\t= SDF_READABLE | SDF_WRITABLE;\n\ts->n_chan\t= 4;\n\ts->maxdata\t= 0xffff;\n\ts->len_chanlist\t= 4;\n\ts->insn_read\t= adl_pci8164_insn_read;\n\ts->insn_write\t= adl_pci8164_insn_write;\n\ts->private\t= (void *)PCI8164_BUF1_REG;\n\n\treturn 0;\n}\n\nstatic struct comedi_driver adl_pci8164_driver = {\n\t.driver_name\t= \"adl_pci8164\",\n\t.module\t\t= THIS_MODULE,\n\t.auto_attach\t= adl_pci8164_auto_attach,\n\t.detach\t\t= comedi_pci_detach,\n};\n\nstatic int adl_pci8164_pci_probe(struct pci_dev *dev,\n\t\t\t\t const struct pci_device_id *id)\n{\n\treturn comedi_pci_auto_config(dev, &adl_pci8164_driver,\n\t\t\t\t      id->driver_data);\n}\n\nstatic const struct pci_device_id adl_pci8164_pci_table[] = {\n\t{ PCI_DEVICE(PCI_VENDOR_ID_ADLINK, 0x8164) },\n\t{ 0 }\n};\nMODULE_DEVICE_TABLE(pci, adl_pci8164_pci_table);\n\nstatic struct pci_driver adl_pci8164_pci_driver = {\n\t.name\t\t= \"adl_pci8164\",\n\t.id_table\t= adl_pci8164_pci_table,\n\t.probe\t\t= adl_pci8164_pci_probe,\n\t.remove\t\t= comedi_pci_auto_unconfig,\n};\nmodule_comedi_pci_driver(adl_pci8164_driver, adl_pci8164_pci_driver);\n\nMODULE_AUTHOR(\"Comedi https://www.comedi.org\");\nMODULE_DESCRIPTION(\"Comedi low-level driver\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}