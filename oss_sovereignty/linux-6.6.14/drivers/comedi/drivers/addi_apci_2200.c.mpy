{
  "module_name": "addi_apci_2200.c",
  "hash_id": "cda6fb98f8f4ba8646d88ac26451a0a4f4c55c942af541bbbdd33d6b758ef100",
  "original_prompt": "Ingested from linux-6.6.14/drivers/comedi/drivers/addi_apci_2200.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/comedi/comedi_pci.h>\n\n#include \"addi_watchdog.h\"\n\n \n#define APCI2200_DI_REG\t\t\t0x00\n#define APCI2200_DO_REG\t\t\t0x04\n#define APCI2200_WDOG_REG\t\t0x08\n\nstatic int apci2200_di_insn_bits(struct comedi_device *dev,\n\t\t\t\t struct comedi_subdevice *s,\n\t\t\t\t struct comedi_insn *insn,\n\t\t\t\t unsigned int *data)\n{\n\tdata[1] = inw(dev->iobase + APCI2200_DI_REG);\n\n\treturn insn->n;\n}\n\nstatic int apci2200_do_insn_bits(struct comedi_device *dev,\n\t\t\t\t struct comedi_subdevice *s,\n\t\t\t\t struct comedi_insn *insn,\n\t\t\t\t unsigned int *data)\n{\n\ts->state = inw(dev->iobase + APCI2200_DO_REG);\n\n\tif (comedi_dio_update_state(s, data))\n\t\toutw(s->state, dev->iobase + APCI2200_DO_REG);\n\n\tdata[1] = s->state;\n\n\treturn insn->n;\n}\n\nstatic int apci2200_reset(struct comedi_device *dev)\n{\n\toutw(0x0, dev->iobase + APCI2200_DO_REG);\n\n\taddi_watchdog_reset(dev->iobase + APCI2200_WDOG_REG);\n\n\treturn 0;\n}\n\nstatic int apci2200_auto_attach(struct comedi_device *dev,\n\t\t\t\tunsigned long context_unused)\n{\n\tstruct pci_dev *pcidev = comedi_to_pci_dev(dev);\n\tstruct comedi_subdevice *s;\n\tint ret;\n\n\tret = comedi_pci_enable(dev);\n\tif (ret)\n\t\treturn ret;\n\n\tdev->iobase = pci_resource_start(pcidev, 1);\n\n\tret = comedi_alloc_subdevices(dev, 3);\n\tif (ret)\n\t\treturn ret;\n\n\t \n\ts = &dev->subdevices[0];\n\ts->type\t\t= COMEDI_SUBD_DI;\n\ts->subdev_flags\t= SDF_READABLE;\n\ts->n_chan\t= 8;\n\ts->maxdata\t= 1;\n\ts->range_table\t= &range_digital;\n\ts->insn_bits\t= apci2200_di_insn_bits;\n\n\t \n\ts = &dev->subdevices[1];\n\ts->type\t\t= COMEDI_SUBD_DO;\n\ts->subdev_flags\t= SDF_WRITABLE;\n\ts->n_chan\t= 16;\n\ts->maxdata\t= 1;\n\ts->range_table\t= &range_digital;\n\ts->insn_bits\t= apci2200_do_insn_bits;\n\n\t \n\ts = &dev->subdevices[2];\n\tret = addi_watchdog_init(s, dev->iobase + APCI2200_WDOG_REG);\n\tif (ret)\n\t\treturn ret;\n\n\tapci2200_reset(dev);\n\treturn 0;\n}\n\nstatic void apci2200_detach(struct comedi_device *dev)\n{\n\tif (dev->iobase)\n\t\tapci2200_reset(dev);\n\tcomedi_pci_detach(dev);\n}\n\nstatic struct comedi_driver apci2200_driver = {\n\t.driver_name\t= \"addi_apci_2200\",\n\t.module\t\t= THIS_MODULE,\n\t.auto_attach\t= apci2200_auto_attach,\n\t.detach\t\t= apci2200_detach,\n};\n\nstatic int apci2200_pci_probe(struct pci_dev *dev,\n\t\t\t      const struct pci_device_id *id)\n{\n\treturn comedi_pci_auto_config(dev, &apci2200_driver, id->driver_data);\n}\n\nstatic const struct pci_device_id apci2200_pci_table[] = {\n\t{ PCI_DEVICE(PCI_VENDOR_ID_ADDIDATA, 0x1005) },\n\t{ 0 }\n};\nMODULE_DEVICE_TABLE(pci, apci2200_pci_table);\n\nstatic struct pci_driver apci2200_pci_driver = {\n\t.name\t\t= \"addi_apci_2200\",\n\t.id_table\t= apci2200_pci_table,\n\t.probe\t\t= apci2200_pci_probe,\n\t.remove\t\t= comedi_pci_auto_unconfig,\n};\nmodule_comedi_pci_driver(apci2200_driver, apci2200_pci_driver);\n\nMODULE_DESCRIPTION(\"ADDI-DATA APCI-2200 Relay board, optically isolated\");\nMODULE_AUTHOR(\"Comedi https://www.comedi.org\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}