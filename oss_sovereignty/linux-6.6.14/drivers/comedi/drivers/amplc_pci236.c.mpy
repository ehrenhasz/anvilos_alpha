{
  "module_name": "amplc_pci236.c",
  "hash_id": "fcc2e8cac6f472238242b832e19aeb42ac5e54f6efb187dda25be76590402a25",
  "original_prompt": "Ingested from linux-6.6.14/drivers/comedi/drivers/amplc_pci236.c",
  "human_readable_source": "\n \n \n\n#include <linux/module.h>\n#include <linux/interrupt.h>\n#include <linux/comedi/comedi_pci.h>\n\n#include \"amplc_pc236.h\"\n#include \"plx9052.h\"\n\n \n#define PCI236_INTR_DISABLE\t(PLX9052_INTCSR_LI1POL |\t\\\n\t\t\t\t PLX9052_INTCSR_LI2POL |\t\\\n\t\t\t\t PLX9052_INTCSR_LI1SEL |\t\\\n\t\t\t\t PLX9052_INTCSR_LI1CLRINT)\n\n \n#define PCI236_INTR_ENABLE\t(PLX9052_INTCSR_LI1ENAB |\t\\\n\t\t\t\t PLX9052_INTCSR_LI1POL |\t\\\n\t\t\t\t PLX9052_INTCSR_LI2POL |\t\\\n\t\t\t\t PLX9052_INTCSR_PCIENAB |\t\\\n\t\t\t\t PLX9052_INTCSR_LI1SEL |\t\\\n\t\t\t\t PLX9052_INTCSR_LI1CLRINT)\n\nstatic void pci236_intr_update_cb(struct comedi_device *dev, bool enable)\n{\n\tstruct pc236_private *devpriv = dev->private;\n\n\t \n\toutl(enable ? PCI236_INTR_ENABLE : PCI236_INTR_DISABLE,\n\t     devpriv->lcr_iobase + PLX9052_INTCSR);\n}\n\nstatic bool pci236_intr_chk_clr_cb(struct comedi_device *dev)\n{\n\tstruct pc236_private *devpriv = dev->private;\n\n\t \n\tif (!(inl(devpriv->lcr_iobase + PLX9052_INTCSR) &\n\t      PLX9052_INTCSR_LI1STAT))\n\t\treturn false;\n\t \n\tpci236_intr_update_cb(dev, devpriv->enable_irq);\n\treturn true;\n}\n\nstatic const struct pc236_board pc236_pci_board = {\n\t.name = \"pci236\",\n\t.intr_update_cb = pci236_intr_update_cb,\n\t.intr_chk_clr_cb = pci236_intr_chk_clr_cb,\n};\n\nstatic int pci236_auto_attach(struct comedi_device *dev,\n\t\t\t      unsigned long context_unused)\n{\n\tstruct pci_dev *pci_dev = comedi_to_pci_dev(dev);\n\tstruct pc236_private *devpriv;\n\tunsigned long iobase;\n\tint ret;\n\n\tdev_info(dev->class_dev, \"amplc_pci236: attach pci %s\\n\",\n\t\t pci_name(pci_dev));\n\n\tdevpriv = comedi_alloc_devpriv(dev, sizeof(*devpriv));\n\tif (!devpriv)\n\t\treturn -ENOMEM;\n\n\tdev->board_ptr = &pc236_pci_board;\n\tdev->board_name = pc236_pci_board.name;\n\tret = comedi_pci_enable(dev);\n\tif (ret)\n\t\treturn ret;\n\n\tdevpriv->lcr_iobase = pci_resource_start(pci_dev, 1);\n\tiobase = pci_resource_start(pci_dev, 2);\n\treturn amplc_pc236_common_attach(dev, iobase, pci_dev->irq,\n\t\t\t\t\t IRQF_SHARED);\n}\n\nstatic struct comedi_driver amplc_pci236_driver = {\n\t.driver_name = \"amplc_pci236\",\n\t.module = THIS_MODULE,\n\t.auto_attach = pci236_auto_attach,\n\t.detach = comedi_pci_detach,\n};\n\nstatic const struct pci_device_id pci236_pci_table[] = {\n\t{ PCI_DEVICE(PCI_VENDOR_ID_AMPLICON, 0x0009) },\n\t{ 0 }\n};\n\nMODULE_DEVICE_TABLE(pci, pci236_pci_table);\n\nstatic int amplc_pci236_pci_probe(struct pci_dev *dev,\n\t\t\t\t  const struct pci_device_id *id)\n{\n\treturn comedi_pci_auto_config(dev, &amplc_pci236_driver,\n\t\t\t\t      id->driver_data);\n}\n\nstatic struct pci_driver amplc_pci236_pci_driver = {\n\t.name\t\t= \"amplc_pci236\",\n\t.id_table\t= pci236_pci_table,\n\t.probe\t\t= &amplc_pci236_pci_probe,\n\t.remove\t\t= comedi_pci_auto_unconfig,\n};\n\nmodule_comedi_pci_driver(amplc_pci236_driver, amplc_pci236_pci_driver);\n\nMODULE_AUTHOR(\"Comedi https://www.comedi.org\");\nMODULE_DESCRIPTION(\"Comedi driver for Amplicon PCI236 DIO boards\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}