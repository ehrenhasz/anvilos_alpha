{
  "module_name": "ni_labpc_pci.c",
  "hash_id": "c4f4851d2967af33e41d4dc8f4be25f10ae1bc5a6805218254ee92ea5a1348cc",
  "original_prompt": "Ingested from linux-6.6.14/drivers/comedi/drivers/ni_labpc_pci.c",
  "human_readable_source": "\n \n\n \n\n#include <linux/module.h>\n#include <linux/interrupt.h>\n#include <linux/comedi/comedi_pci.h>\n\n#include \"ni_labpc.h\"\n\nenum labpc_pci_boardid {\n\tBOARD_NI_PCI1200,\n};\n\nstatic const struct labpc_boardinfo labpc_pci_boards[] = {\n\t[BOARD_NI_PCI1200] = {\n\t\t.name\t\t\t= \"ni_pci-1200\",\n\t\t.ai_speed\t\t= 10000,\n\t\t.ai_scan_up\t\t= 1,\n\t\t.has_ao\t\t\t= 1,\n\t\t.is_labpc1200\t\t= 1,\n\t},\n};\n\n \n#define MITE_IODWBSR\t0xc0\t \n#define WENAB\t\tBIT(7)\t \n\nstatic int labpc_pci_mite_init(struct pci_dev *pcidev)\n{\n\tvoid __iomem *mite_base;\n\tu32 main_phys_addr;\n\n\t \n\tmite_base = pci_ioremap_bar(pcidev, 0);\n\tif (!mite_base)\n\t\treturn -ENOMEM;\n\n\t \n\tmain_phys_addr = pci_resource_start(pcidev, 1);\n\twritel(main_phys_addr | WENAB, mite_base + MITE_IODWBSR);\n\n\t \n\tiounmap(mite_base);\n\treturn 0;\n}\n\nstatic int labpc_pci_auto_attach(struct comedi_device *dev,\n\t\t\t\t unsigned long context)\n{\n\tstruct pci_dev *pcidev = comedi_to_pci_dev(dev);\n\tconst struct labpc_boardinfo *board = NULL;\n\tint ret;\n\n\tif (context < ARRAY_SIZE(labpc_pci_boards))\n\t\tboard = &labpc_pci_boards[context];\n\tif (!board)\n\t\treturn -ENODEV;\n\tdev->board_ptr = board;\n\tdev->board_name = board->name;\n\n\tret = comedi_pci_enable(dev);\n\tif (ret)\n\t\treturn ret;\n\n\tret = labpc_pci_mite_init(pcidev);\n\tif (ret)\n\t\treturn ret;\n\n\tdev->mmio = pci_ioremap_bar(pcidev, 1);\n\tif (!dev->mmio)\n\t\treturn -ENOMEM;\n\n\treturn labpc_common_attach(dev, pcidev->irq, IRQF_SHARED);\n}\n\nstatic void labpc_pci_detach(struct comedi_device *dev)\n{\n\tlabpc_common_detach(dev);\n\tcomedi_pci_detach(dev);\n}\n\nstatic struct comedi_driver labpc_pci_comedi_driver = {\n\t.driver_name\t= \"labpc_pci\",\n\t.module\t\t= THIS_MODULE,\n\t.auto_attach\t= labpc_pci_auto_attach,\n\t.detach\t\t= labpc_pci_detach,\n};\n\nstatic const struct pci_device_id labpc_pci_table[] = {\n\t{ PCI_VDEVICE(NI, 0x161), BOARD_NI_PCI1200 },\n\t{ 0 }\n};\nMODULE_DEVICE_TABLE(pci, labpc_pci_table);\n\nstatic int labpc_pci_probe(struct pci_dev *dev,\n\t\t\t   const struct pci_device_id *id)\n{\n\treturn comedi_pci_auto_config(dev, &labpc_pci_comedi_driver,\n\t\t\t\t      id->driver_data);\n}\n\nstatic struct pci_driver labpc_pci_driver = {\n\t.name\t\t= \"labpc_pci\",\n\t.id_table\t= labpc_pci_table,\n\t.probe\t\t= labpc_pci_probe,\n\t.remove\t\t= comedi_pci_auto_unconfig,\n};\nmodule_comedi_pci_driver(labpc_pci_comedi_driver, labpc_pci_driver);\n\nMODULE_DESCRIPTION(\"Comedi: National Instruments Lab-PC PCI-1200 driver\");\nMODULE_AUTHOR(\"Comedi https://www.comedi.org\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}