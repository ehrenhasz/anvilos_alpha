{
  "module_name": "s526.c",
  "hash_id": "fb63089487509148e17ca86ebb268b9632abd6b0d936835207f53b64249341c1",
  "original_prompt": "Ingested from linux-6.6.14/drivers/comedi/drivers/s526.c",
  "human_readable_source": "\n \n\n \n\n#include <linux/module.h>\n#include <linux/comedi/comedidev.h>\n\n \n#define S526_TIMER_REG\t\t0x00\n#define S526_TIMER_LOAD(x)\t(((x) & 0xff) << 8)\n#define S526_TIMER_MODE\t\t((x) << 1)\n#define S526_TIMER_MANUAL\tS526_TIMER_MODE(0)\n#define S526_TIMER_AUTO\t\tS526_TIMER_MODE(1)\n#define S526_TIMER_RESTART\tBIT(0)\n#define S526_WDOG_REG\t\t0x02\n#define S526_WDOG_INVERTED\tBIT(4)\n#define S526_WDOG_ENA\t\tBIT(3)\n#define S526_WDOG_INTERVAL(x)\t(((x) & 0x7) << 0)\n#define S526_AO_CTRL_REG\t0x04\n#define S526_AO_CTRL_RESET\tBIT(3)\n#define S526_AO_CTRL_CHAN(x)\t(((x) & 0x3) << 1)\n#define S526_AO_CTRL_START\tBIT(0)\n#define S526_AI_CTRL_REG\t0x06\n#define S526_AI_CTRL_DELAY\tBIT(15)\n#define S526_AI_CTRL_CONV(x)\t(1 << (5 + ((x) & 0x9)))\n#define S526_AI_CTRL_READ(x)\t(((x) & 0xf) << 1)\n#define S526_AI_CTRL_START\tBIT(0)\n#define S526_AO_REG\t\t0x08\n#define S526_AI_REG\t\t0x08\n#define S526_DIO_CTRL_REG\t0x0a\n#define S526_DIO_CTRL_DIO3_NEG\tBIT(15)\t \n#define S526_DIO_CTRL_DIO2_NEG\tBIT(14)\t \n#define S526_DIO_CTRL_DIO1_NEG\tBIT(13)\t \n#define S526_DIO_CTRL_DIO0_NEG\tBIT(12)\t \n#define S526_DIO_CTRL_GRP2_OUT\tBIT(11)\n#define S526_DIO_CTRL_GRP1_OUT\tBIT(10)\n#define S526_DIO_CTRL_GRP2_NEG\tBIT(8)\t \n#define S526_INT_ENA_REG\t0x0c\n#define S526_INT_STATUS_REG\t0x0e\n#define S526_INT_DIO(x)\t\tBIT(8 + ((x) & 0x7))\n#define S526_INT_EEPROM\t\tBIT(7)\t \n#define S526_INT_CNTR(x)\tBIT(3 + (3 - ((x) & 0x3)))\n#define S526_INT_AI\t\tBIT(2)\n#define S526_INT_AO\t\tBIT(1)\n#define S526_INT_TIMER\t\tBIT(0)\n#define S526_MISC_REG\t\t0x10\n#define S526_MISC_LED_OFF\tBIT(0)\n#define S526_GPCT_LSB_REG(x)\t(0x12 + ((x) * 8))\n#define S526_GPCT_MSB_REG(x)\t(0x14 + ((x) * 8))\n#define S526_GPCT_MODE_REG(x)\t(0x16 + ((x) * 8))\n#define S526_GPCT_MODE_COUT_SRC(x)\t((x) << 0)\n#define S526_GPCT_MODE_COUT_SRC_MASK\tS526_GPCT_MODE_COUT_SRC(0x1)\n#define S526_GPCT_MODE_COUT_SRC_RCAP\tS526_GPCT_MODE_COUT_SRC(0)\n#define S526_GPCT_MODE_COUT_SRC_RTGL\tS526_GPCT_MODE_COUT_SRC(1)\n#define S526_GPCT_MODE_COUT_POL(x)\t((x) << 1)\n#define S526_GPCT_MODE_COUT_POL_MASK\tS526_GPCT_MODE_COUT_POL(0x1)\n#define S526_GPCT_MODE_COUT_POL_NORM\tS526_GPCT_MODE_COUT_POL(0)\n#define S526_GPCT_MODE_COUT_POL_INV\tS526_GPCT_MODE_COUT_POL(1)\n#define S526_GPCT_MODE_AUTOLOAD(x)\t((x) << 2)\n#define S526_GPCT_MODE_AUTOLOAD_MASK\tS526_GPCT_MODE_AUTOLOAD(0x7)\n#define S526_GPCT_MODE_AUTOLOAD_NONE\tS526_GPCT_MODE_AUTOLOAD(0)\n \n#define S526_GPCT_MODE_AUTOLOAD_RO\tS526_GPCT_MODE_AUTOLOAD(0x1)\n#define S526_GPCT_MODE_AUTOLOAD_IXFALL\tS526_GPCT_MODE_AUTOLOAD(0x2)\n#define S526_GPCT_MODE_AUTOLOAD_IXRISE\tS526_GPCT_MODE_AUTOLOAD(0x4)\n#define S526_GPCT_MODE_HWCTEN_SRC(x)\t((x) << 5)\n#define S526_GPCT_MODE_HWCTEN_SRC_MASK\tS526_GPCT_MODE_HWCTEN_SRC(0x3)\n#define S526_GPCT_MODE_HWCTEN_SRC_CEN\tS526_GPCT_MODE_HWCTEN_SRC(0)\n#define S526_GPCT_MODE_HWCTEN_SRC_IX\tS526_GPCT_MODE_HWCTEN_SRC(1)\n#define S526_GPCT_MODE_HWCTEN_SRC_IXRF\tS526_GPCT_MODE_HWCTEN_SRC(2)\n#define S526_GPCT_MODE_HWCTEN_SRC_NRCAP\tS526_GPCT_MODE_HWCTEN_SRC(3)\n#define S526_GPCT_MODE_CTEN_CTRL(x)\t((x) << 7)\n#define S526_GPCT_MODE_CTEN_CTRL_MASK\tS526_GPCT_MODE_CTEN_CTRL(0x3)\n#define S526_GPCT_MODE_CTEN_CTRL_DIS\tS526_GPCT_MODE_CTEN_CTRL(0)\n#define S526_GPCT_MODE_CTEN_CTRL_ENA\tS526_GPCT_MODE_CTEN_CTRL(1)\n#define S526_GPCT_MODE_CTEN_CTRL_HW\tS526_GPCT_MODE_CTEN_CTRL(2)\n#define S526_GPCT_MODE_CTEN_CTRL_INVHW\tS526_GPCT_MODE_CTEN_CTRL(3)\n#define S526_GPCT_MODE_CLK_SRC(x)\t((x) << 9)\n#define S526_GPCT_MODE_CLK_SRC_MASK\tS526_GPCT_MODE_CLK_SRC(0x3)\n \n#define S526_GPCT_MODE_CLK_SRC_QUADX1\tS526_GPCT_MODE_CLK_SRC(0)\n#define S526_GPCT_MODE_CLK_SRC_QUADX2\tS526_GPCT_MODE_CLK_SRC(1)\n#define S526_GPCT_MODE_CLK_SRC_QUADX4\tS526_GPCT_MODE_CLK_SRC(2)\n#define S526_GPCT_MODE_CLK_SRC_QUADX4_\tS526_GPCT_MODE_CLK_SRC(3)\n \n#define S526_GPCT_MODE_CLK_SRC_ARISE\tS526_GPCT_MODE_CLK_SRC(0)\n#define S526_GPCT_MODE_CLK_SRC_AFALL\tS526_GPCT_MODE_CLK_SRC(1)\n#define S526_GPCT_MODE_CLK_SRC_INT\tS526_GPCT_MODE_CLK_SRC(2)\n#define S526_GPCT_MODE_CLK_SRC_INTHALF\tS526_GPCT_MODE_CLK_SRC(3)\n#define S526_GPCT_MODE_CT_DIR(x)\t((x) << 11)\n#define S526_GPCT_MODE_CT_DIR_MASK\tS526_GPCT_MODE_CT_DIR(0x1)\n \n#define S526_GPCT_MODE_CT_DIR_UP\tS526_GPCT_MODE_CT_DIR(0)\n#define S526_GPCT_MODE_CT_DIR_DOWN\tS526_GPCT_MODE_CT_DIR(1)\n#define S526_GPCT_MODE_CTDIR_CTRL(x)\t((x) << 12)\n#define S526_GPCT_MODE_CTDIR_CTRL_MASK\tS526_GPCT_MODE_CTDIR_CTRL(0x1)\n#define S526_GPCT_MODE_CTDIR_CTRL_QUAD\tS526_GPCT_MODE_CTDIR_CTRL(0)\n#define S526_GPCT_MODE_CTDIR_CTRL_SOFT\tS526_GPCT_MODE_CTDIR_CTRL(1)\n#define S526_GPCT_MODE_LATCH_CTRL(x)\t((x) << 13)\n#define S526_GPCT_MODE_LATCH_CTRL_MASK\tS526_GPCT_MODE_LATCH_CTRL(0x1)\n#define S526_GPCT_MODE_LATCH_CTRL_READ\tS526_GPCT_MODE_LATCH_CTRL(0)\n#define S526_GPCT_MODE_LATCH_CTRL_EVENT\tS526_GPCT_MODE_LATCH_CTRL(1)\n#define S526_GPCT_MODE_PR_SELECT(x)\t((x) << 14)\n#define S526_GPCT_MODE_PR_SELECT_MASK\tS526_GPCT_MODE_PR_SELECT(0x1)\n#define S526_GPCT_MODE_PR_SELECT_PR0\tS526_GPCT_MODE_PR_SELECT(0)\n#define S526_GPCT_MODE_PR_SELECT_PR1\tS526_GPCT_MODE_PR_SELECT(1)\n \n#define S526_GPCT_CTRL_REG(x)\t(0x18 + ((x) * 8))\n#define S526_GPCT_CTRL_EV_STATUS(x)\t((x) << 0)\t\t \n#define S526_GPCT_CTRL_EV_STATUS_MASK\tS526_GPCT_EV_STATUS(0xf)\n#define S526_GPCT_CTRL_EV_STATUS_NONE\tS526_GPCT_EV_STATUS(0)\n \n#define S526_GPCT_CTRL_EV_STATUS_ECAP\tS526_GPCT_EV_STATUS(0x1)\n#define S526_GPCT_CTRL_EV_STATUS_ICAPN\tS526_GPCT_EV_STATUS(0x2)\n#define S526_GPCT_CTRL_EV_STATUS_ICAPP\tS526_GPCT_EV_STATUS(0x4)\n#define S526_GPCT_CTRL_EV_STATUS_RCAP\tS526_GPCT_EV_STATUS(0x8)\n#define S526_GPCT_CTRL_COUT_STATUS\tBIT(4)\t\t\t \n#define S526_GPCT_CTRL_INDEX_STATUS\tBIT(5)\t\t\t \n#define S525_GPCT_CTRL_INTEN(x)\t\t((x) << 6)\t\t \n#define S525_GPCT_CTRL_INTEN_MASK\tS526_GPCT_CTRL_INTEN(0xf)\n#define S525_GPCT_CTRL_INTEN_NONE\tS526_GPCT_CTRL_INTEN(0)\n \n#define S525_GPCT_CTRL_INTEN_ERROR\tS526_GPCT_CTRL_INTEN(0x1)\n#define S525_GPCT_CTRL_INTEN_IXFALL\tS526_GPCT_CTRL_INTEN(0x2)\n#define S525_GPCT_CTRL_INTEN_IXRISE\tS526_GPCT_CTRL_INTEN(0x4)\n#define S525_GPCT_CTRL_INTEN_RO\t\tS526_GPCT_CTRL_INTEN(0x8)\n#define S525_GPCT_CTRL_LATCH_SEL(x)\t((x) << 10)\t\t \n#define S525_GPCT_CTRL_LATCH_SEL_MASK\tS526_GPCT_CTRL_LATCH_SEL(0x7)\n#define S525_GPCT_CTRL_LATCH_SEL_NONE\tS526_GPCT_CTRL_LATCH_SEL(0)\n \n#define S525_GPCT_CTRL_LATCH_SEL_IXFALL\tS526_GPCT_CTRL_LATCH_SEL(0x1)\n#define S525_GPCT_CTRL_LATCH_SEL_IXRISE\tS526_GPCT_CTRL_LATCH_SEL(0x2)\n#define S525_GPCT_CTRL_LATCH_SEL_ITIMER\tS526_GPCT_CTRL_LATCH_SEL(0x4)\n#define S525_GPCT_CTRL_CT_ARM\t\tBIT(13)\t\t\t \n#define S525_GPCT_CTRL_CT_LOAD\t\tBIT(14)\t\t\t \n#define S526_GPCT_CTRL_CT_RESET\t\tBIT(15)\t\t\t \n#define S526_EEPROM_DATA_REG\t0x32\n#define S526_EEPROM_CTRL_REG\t0x34\n#define S526_EEPROM_CTRL_ADDR(x) (((x) & 0x3f) << 3)\n#define S526_EEPROM_CTRL(x)\t(((x) & 0x3) << 1)\n#define S526_EEPROM_CTRL_READ\tS526_EEPROM_CTRL(2)\n#define S526_EEPROM_CTRL_START\tBIT(0)\n\nstruct s526_private {\n\tunsigned int gpct_config[4];\n\tunsigned short ai_ctrl;\n};\n\nstatic void s526_gpct_write(struct comedi_device *dev,\n\t\t\t    unsigned int chan, unsigned int val)\n{\n\t \n\toutw((val >> 16) & 0xffff, dev->iobase + S526_GPCT_MSB_REG(chan));\n\toutw(val & 0xffff, dev->iobase + S526_GPCT_LSB_REG(chan));\n}\n\nstatic unsigned int s526_gpct_read(struct comedi_device *dev,\n\t\t\t\t   unsigned int chan)\n{\n\tunsigned int val;\n\n\t \n\tval = inw(dev->iobase + S526_GPCT_LSB_REG(chan)) & 0xffff;\n\tval |= (inw(dev->iobase + S526_GPCT_MSB_REG(chan)) & 0xff) << 16;\n\n\treturn val;\n}\n\nstatic int s526_gpct_rinsn(struct comedi_device *dev,\n\t\t\t   struct comedi_subdevice *s,\n\t\t\t   struct comedi_insn *insn,\n\t\t\t   unsigned int *data)\n{\n\tunsigned int chan = CR_CHAN(insn->chanspec);\n\tint i;\n\n\tfor (i = 0; i < insn->n; i++)\n\t\tdata[i] = s526_gpct_read(dev, chan);\n\n\treturn insn->n;\n}\n\nstatic int s526_gpct_insn_config(struct comedi_device *dev,\n\t\t\t\t struct comedi_subdevice *s,\n\t\t\t\t struct comedi_insn *insn,\n\t\t\t\t unsigned int *data)\n{\n\tstruct s526_private *devpriv = dev->private;\n\tunsigned int chan = CR_CHAN(insn->chanspec);\n\tunsigned int val;\n\n\t \n\tswitch (data[0]) {\n\tcase INSN_CONFIG_GPCT_QUADRATURE_ENCODER:\n\t\t \n\t\tdevpriv->gpct_config[chan] = data[0];\n\n#if 1\n\t\t \n\t\tval = data[1] & 0xffff;\n\t\toutw(val, dev->iobase + S526_GPCT_MODE_REG(chan));\n\n\t\t \n\t\tif ((val & S526_GPCT_MODE_AUTOLOAD_MASK) ==\n\t\t    S526_GPCT_MODE_AUTOLOAD_NONE) {\n\t\t\t \n\t\t\toutw(S526_GPCT_CTRL_CT_RESET,\n\t\t\t     dev->iobase + S526_GPCT_CTRL_REG(chan));\n\t\t\t \n\t\t}\n#else\n\t\tval = S526_GPCT_MODE_CTDIR_CTRL_QUAD;\n\n\t\t \n\t\tif (data[1] == GPCT_X2)\n\t\t\tval |= S526_GPCT_MODE_CLK_SRC_QUADX2;\n\t\telse if (data[1] == GPCT_X4)\n\t\t\tval |= S526_GPCT_MODE_CLK_SRC_QUADX4;\n\t\telse\n\t\t\tval |= S526_GPCT_MODE_CLK_SRC_QUADX1;\n\n\t\t \n\t\t \n\t\t \n\t\tif (data[3] == GPCT_RESET_COUNTER_ON_INDEX) {\n\t\t\t \n\t\t\tval |= S526_GPCT_MODE_AUTOLOAD_IXRISE;\n\t\t}\n\n\t\t \n\t\tval = data[1] & 0xffff;\n\t\toutw(val, dev->iobase + S526_GPCT_MODE_REG(chan));\n\n\t\t \n\t\ts526_gpct_write(dev, chan, data[2]);\n\n\t\t \n\t\tif (data[3])\n\t\t\toutw(data[3] & 0xffff,\n\t\t\t     dev->iobase + S526_GPCT_CTRL_REG(chan));\n\n\t\t \n\t\tif ((val & S526_GPCT_MODE_AUTOLOAD_MASK) ==\n\t\t    S526_GPCT_MODE_AUTOLOAD_NONE) {\n\t\t\t \n\t\t\toutw(S526_GPCT_CTRL_CT_RESET,\n\t\t\t     dev->iobase + S526_GPCT_CTRL_REG(chan));\n\t\t\t \n\t\t\toutw(S526_GPCT_CTRL_CT_LOAD,\n\t\t\t     dev->iobase + S526_GPCT_CTRL_REG(chan));\n\t\t}\n#endif\n\t\tbreak;\n\n\tcase INSN_CONFIG_GPCT_SINGLE_PULSE_GENERATOR:\n\t\t \n\t\tdevpriv->gpct_config[chan] = data[0];\n\n\t\t \n\t\tval = data[1] & 0xffff;\n\t\t \n\t\tval &= ~S526_GPCT_MODE_PR_SELECT_MASK;\n\t\tval |= S526_GPCT_MODE_PR_SELECT_PR0;\n\t\toutw(val, dev->iobase + S526_GPCT_MODE_REG(chan));\n\n\t\t \n\t\ts526_gpct_write(dev, chan, data[2]);\n\n\t\t \n\t\tval = data[1] & 0xffff;\n\t\t \n\t\tval &= ~S526_GPCT_MODE_PR_SELECT_MASK;\n\t\tval |= S526_GPCT_MODE_PR_SELECT_PR1;\n\t\toutw(val, dev->iobase + S526_GPCT_MODE_REG(chan));\n\n\t\t \n\t\ts526_gpct_write(dev, chan, data[3]);\n\n\t\t \n\t\tif (data[4]) {\n\t\t\tval = data[4] & 0xffff;\n\t\t\toutw(val, dev->iobase + S526_GPCT_CTRL_REG(chan));\n\t\t}\n\t\tbreak;\n\n\tcase INSN_CONFIG_GPCT_PULSE_TRAIN_GENERATOR:\n\t\t \n\t\tdevpriv->gpct_config[chan] = data[0];\n\n\t\t \n\t\tval = data[1] & 0xffff;\n\t\t \n\t\tval &= ~S526_GPCT_MODE_PR_SELECT_MASK;\n\t\tval |= S526_GPCT_MODE_PR_SELECT_PR0;\n\t\toutw(val, dev->iobase + S526_GPCT_MODE_REG(chan));\n\n\t\t \n\t\ts526_gpct_write(dev, chan, data[2]);\n\n\t\t \n\t\tval = data[1] & 0xffff;\n\t\t \n\t\tval &= ~S526_GPCT_MODE_PR_SELECT_MASK;\n\t\tval |= S526_GPCT_MODE_PR_SELECT_PR1;\n\t\toutw(val, dev->iobase + S526_GPCT_MODE_REG(chan));\n\n\t\t \n\t\ts526_gpct_write(dev, chan, data[3]);\n\n\t\t \n\t\tif (data[4]) {\n\t\t\tval = data[4] & 0xffff;\n\t\t\toutw(val, dev->iobase + S526_GPCT_CTRL_REG(chan));\n\t\t}\n\t\tbreak;\n\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\treturn insn->n;\n}\n\nstatic int s526_gpct_winsn(struct comedi_device *dev,\n\t\t\t   struct comedi_subdevice *s,\n\t\t\t   struct comedi_insn *insn,\n\t\t\t   unsigned int *data)\n{\n\tstruct s526_private *devpriv = dev->private;\n\tunsigned int chan = CR_CHAN(insn->chanspec);\n\n\tinw(dev->iobase + S526_GPCT_MODE_REG(chan));\t \n\n\t \n\tswitch (devpriv->gpct_config[chan]) {\n\tcase INSN_CONFIG_GPCT_PULSE_TRAIN_GENERATOR:\n\t\t \n\t\tif ((data[1] <= data[0]) || !data[0])\n\t\t\treturn -EINVAL;\n\t\t \n\t\tfallthrough;\n\tcase INSN_CONFIG_GPCT_QUADRATURE_ENCODER:\n\tcase INSN_CONFIG_GPCT_SINGLE_PULSE_GENERATOR:\n\t\ts526_gpct_write(dev, chan, data[0]);\n\t\tbreak;\n\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\treturn insn->n;\n}\n\nstatic int s526_eoc(struct comedi_device *dev,\n\t\t    struct comedi_subdevice *s,\n\t\t    struct comedi_insn *insn,\n\t\t    unsigned long context)\n{\n\tunsigned int status;\n\n\tstatus = inw(dev->iobase + S526_INT_STATUS_REG);\n\tif (status & context) {\n\t\t \n\t\toutw(context, dev->iobase + S526_INT_STATUS_REG);\n\t\treturn 0;\n\t}\n\treturn -EBUSY;\n}\n\nstatic int s526_ai_insn_read(struct comedi_device *dev,\n\t\t\t     struct comedi_subdevice *s,\n\t\t\t     struct comedi_insn *insn,\n\t\t\t     unsigned int *data)\n{\n\tstruct s526_private *devpriv = dev->private;\n\tunsigned int chan = CR_CHAN(insn->chanspec);\n\tunsigned int ctrl;\n\tunsigned int val;\n\tint ret;\n\tint i;\n\n\tctrl = S526_AI_CTRL_CONV(chan) | S526_AI_CTRL_READ(chan) |\n\t       S526_AI_CTRL_START;\n\tif (ctrl != devpriv->ai_ctrl) {\n\t\t \n\t\tdevpriv->ai_ctrl = ctrl;\n\t\tctrl |= S526_AI_CTRL_DELAY;\n\t}\n\n\tfor (i = 0; i < insn->n; i++) {\n\t\t \n\t\toutw(ctrl, dev->iobase + S526_AI_CTRL_REG);\n\t\tctrl &= ~S526_AI_CTRL_DELAY;\n\n\t\t \n\t\tret = comedi_timeout(dev, s, insn, s526_eoc, S526_INT_AI);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tval = inw(dev->iobase + S526_AI_REG);\n\t\tdata[i] = comedi_offset_munge(s, val);\n\t}\n\n\treturn insn->n;\n}\n\nstatic int s526_ao_insn_write(struct comedi_device *dev,\n\t\t\t      struct comedi_subdevice *s,\n\t\t\t      struct comedi_insn *insn,\n\t\t\t      unsigned int *data)\n{\n\tunsigned int chan = CR_CHAN(insn->chanspec);\n\tunsigned int ctrl = S526_AO_CTRL_CHAN(chan);\n\tunsigned int val = s->readback[chan];\n\tint ret;\n\tint i;\n\n\toutw(ctrl, dev->iobase + S526_AO_CTRL_REG);\n\tctrl |= S526_AO_CTRL_START;\n\n\tfor (i = 0; i < insn->n; i++) {\n\t\tval = data[i];\n\t\toutw(val, dev->iobase + S526_AO_REG);\n\t\toutw(ctrl, dev->iobase + S526_AO_CTRL_REG);\n\n\t\t \n\t\tret = comedi_timeout(dev, s, insn, s526_eoc, S526_INT_AO);\n\t\tif (ret)\n\t\t\treturn ret;\n\t}\n\ts->readback[chan] = val;\n\n\treturn insn->n;\n}\n\nstatic int s526_dio_insn_bits(struct comedi_device *dev,\n\t\t\t      struct comedi_subdevice *s,\n\t\t\t      struct comedi_insn *insn,\n\t\t\t      unsigned int *data)\n{\n\tif (comedi_dio_update_state(s, data))\n\t\toutw(s->state, dev->iobase + S526_DIO_CTRL_REG);\n\n\tdata[1] = inw(dev->iobase + S526_DIO_CTRL_REG) & 0xff;\n\n\treturn insn->n;\n}\n\nstatic int s526_dio_insn_config(struct comedi_device *dev,\n\t\t\t\tstruct comedi_subdevice *s,\n\t\t\t\tstruct comedi_insn *insn,\n\t\t\t\tunsigned int *data)\n{\n\tunsigned int chan = CR_CHAN(insn->chanspec);\n\tunsigned int mask;\n\tint ret;\n\n\t \n\tif (chan < 4)\n\t\tmask = 0x0f;\n\telse\n\t\tmask = 0xf0;\n\n\tret = comedi_dio_insn_config(dev, s, insn, data, mask);\n\tif (ret)\n\t\treturn ret;\n\n\tif (s->io_bits & 0x0f)\n\t\ts->state |= S526_DIO_CTRL_GRP1_OUT;\n\telse\n\t\ts->state &= ~S526_DIO_CTRL_GRP1_OUT;\n\tif (s->io_bits & 0xf0)\n\t\ts->state |= S526_DIO_CTRL_GRP2_OUT;\n\telse\n\t\ts->state &= ~S526_DIO_CTRL_GRP2_OUT;\n\n\toutw(s->state, dev->iobase + S526_DIO_CTRL_REG);\n\n\treturn insn->n;\n}\n\nstatic int s526_attach(struct comedi_device *dev, struct comedi_devconfig *it)\n{\n\tstruct s526_private *devpriv;\n\tstruct comedi_subdevice *s;\n\tint ret;\n\n\tret = comedi_request_region(dev, it->options[0], 0x40);\n\tif (ret)\n\t\treturn ret;\n\n\tdevpriv = comedi_alloc_devpriv(dev, sizeof(*devpriv));\n\tif (!devpriv)\n\t\treturn -ENOMEM;\n\n\tret = comedi_alloc_subdevices(dev, 4);\n\tif (ret)\n\t\treturn ret;\n\n\t \n\ts = &dev->subdevices[0];\n\ts->type\t\t= COMEDI_SUBD_COUNTER;\n\ts->subdev_flags\t= SDF_READABLE | SDF_WRITABLE | SDF_LSAMPL;\n\ts->n_chan\t= 4;\n\ts->maxdata\t= 0x00ffffff;\n\ts->insn_read\t= s526_gpct_rinsn;\n\ts->insn_config\t= s526_gpct_insn_config;\n\ts->insn_write\t= s526_gpct_winsn;\n\n\t \n\ts = &dev->subdevices[1];\n\ts->type\t\t= COMEDI_SUBD_AI;\n\ts->subdev_flags\t= SDF_READABLE | SDF_DIFF;\n\ts->n_chan\t= 10;\n\ts->maxdata\t= 0xffff;\n\ts->range_table\t= &range_bipolar10;\n\ts->len_chanlist\t= 16;\n\ts->insn_read\t= s526_ai_insn_read;\n\n\t \n\ts = &dev->subdevices[2];\n\ts->type\t\t= COMEDI_SUBD_AO;\n\ts->subdev_flags\t= SDF_WRITABLE;\n\ts->n_chan\t= 4;\n\ts->maxdata\t= 0xffff;\n\ts->range_table\t= &range_bipolar10;\n\ts->insn_write\t= s526_ao_insn_write;\n\n\tret = comedi_alloc_subdev_readback(s);\n\tif (ret)\n\t\treturn ret;\n\n\t \n\ts = &dev->subdevices[3];\n\ts->type\t\t= COMEDI_SUBD_DIO;\n\ts->subdev_flags\t= SDF_READABLE | SDF_WRITABLE;\n\ts->n_chan\t= 8;\n\ts->maxdata\t= 1;\n\ts->range_table\t= &range_digital;\n\ts->insn_bits\t= s526_dio_insn_bits;\n\ts->insn_config\t= s526_dio_insn_config;\n\n\treturn 0;\n}\n\nstatic struct comedi_driver s526_driver = {\n\t.driver_name\t= \"s526\",\n\t.module\t\t= THIS_MODULE,\n\t.attach\t\t= s526_attach,\n\t.detach\t\t= comedi_legacy_detach,\n};\nmodule_comedi_driver(s526_driver);\n\nMODULE_AUTHOR(\"Comedi https://www.comedi.org\");\nMODULE_DESCRIPTION(\"Comedi low-level driver\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}