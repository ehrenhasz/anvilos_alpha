{
  "module_name": "addi_watchdog.c",
  "hash_id": "9f089a21aca62d5dbf42d3d2a82fbadf0858a4033004ae73fb8c671054a12bac",
  "original_prompt": "Ingested from linux-6.6.14/drivers/comedi/drivers/addi_watchdog.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/comedi/comedidev.h>\n#include \"addi_tcw.h\"\n#include \"addi_watchdog.h\"\n\nstruct addi_watchdog_private {\n\tunsigned long iobase;\n\tunsigned int wdog_ctrl;\n};\n\n \nstatic int addi_watchdog_insn_config(struct comedi_device *dev,\n\t\t\t\t     struct comedi_subdevice *s,\n\t\t\t\t     struct comedi_insn *insn,\n\t\t\t\t     unsigned int *data)\n{\n\tstruct addi_watchdog_private *spriv = s->private;\n\tunsigned int reload;\n\n\tswitch (data[0]) {\n\tcase INSN_CONFIG_ARM:\n\t\tspriv->wdog_ctrl = ADDI_TCW_CTRL_ENA;\n\t\treload = data[1] & s->maxdata;\n\t\toutl(reload, spriv->iobase + ADDI_TCW_RELOAD_REG);\n\n\t\t \n\t\tdev_info(dev->class_dev, \"watchdog enabled, timeout:%dms\\n\",\n\t\t\t 20 * reload + 20);\n\t\tbreak;\n\tcase INSN_CONFIG_DISARM:\n\t\tspriv->wdog_ctrl = 0;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\toutl(spriv->wdog_ctrl, spriv->iobase + ADDI_TCW_CTRL_REG);\n\n\treturn insn->n;\n}\n\nstatic int addi_watchdog_insn_read(struct comedi_device *dev,\n\t\t\t\t   struct comedi_subdevice *s,\n\t\t\t\t   struct comedi_insn *insn,\n\t\t\t\t   unsigned int *data)\n{\n\tstruct addi_watchdog_private *spriv = s->private;\n\tint i;\n\n\tfor (i = 0; i < insn->n; i++)\n\t\tdata[i] = inl(spriv->iobase + ADDI_TCW_STATUS_REG);\n\n\treturn insn->n;\n}\n\nstatic int addi_watchdog_insn_write(struct comedi_device *dev,\n\t\t\t\t    struct comedi_subdevice *s,\n\t\t\t\t    struct comedi_insn *insn,\n\t\t\t\t    unsigned int *data)\n{\n\tstruct addi_watchdog_private *spriv = s->private;\n\tint i;\n\n\tif (spriv->wdog_ctrl == 0) {\n\t\tdev_warn(dev->class_dev, \"watchdog is disabled\\n\");\n\t\treturn -EINVAL;\n\t}\n\n\t \n\tfor (i = 0; i < insn->n; i++) {\n\t\toutl(spriv->wdog_ctrl | ADDI_TCW_CTRL_TRIG,\n\t\t     spriv->iobase + ADDI_TCW_CTRL_REG);\n\t}\n\n\treturn insn->n;\n}\n\nvoid addi_watchdog_reset(unsigned long iobase)\n{\n\toutl(0x0, iobase + ADDI_TCW_CTRL_REG);\n\toutl(0x0, iobase + ADDI_TCW_RELOAD_REG);\n}\nEXPORT_SYMBOL_GPL(addi_watchdog_reset);\n\nint addi_watchdog_init(struct comedi_subdevice *s, unsigned long iobase)\n{\n\tstruct addi_watchdog_private *spriv;\n\n\tspriv = comedi_alloc_spriv(s, sizeof(*spriv));\n\tif (!spriv)\n\t\treturn -ENOMEM;\n\n\tspriv->iobase = iobase;\n\n\ts->type\t\t= COMEDI_SUBD_TIMER;\n\ts->subdev_flags\t= SDF_WRITABLE;\n\ts->n_chan\t= 1;\n\ts->maxdata\t= 0xff;\n\ts->insn_config\t= addi_watchdog_insn_config;\n\ts->insn_read\t= addi_watchdog_insn_read;\n\ts->insn_write\t= addi_watchdog_insn_write;\n\n\treturn 0;\n}\nEXPORT_SYMBOL_GPL(addi_watchdog_init);\n\nstatic int __init addi_watchdog_module_init(void)\n{\n\treturn 0;\n}\nmodule_init(addi_watchdog_module_init);\n\nstatic void __exit addi_watchdog_module_exit(void)\n{\n}\nmodule_exit(addi_watchdog_module_exit);\n\nMODULE_DESCRIPTION(\"ADDI-DATA Watchdog subdevice\");\nMODULE_AUTHOR(\"H Hartley Sweeten <hsweeten@visionengravers.com>\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}