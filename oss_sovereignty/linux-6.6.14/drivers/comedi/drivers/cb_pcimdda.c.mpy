{
  "module_name": "cb_pcimdda.c",
  "hash_id": "2bf824f2c9ac071ead37063b14189583af7449b82054259a80f36caf5b2a5e50",
  "original_prompt": "Ingested from linux-6.6.14/drivers/comedi/drivers/cb_pcimdda.c",
  "human_readable_source": "\n \n \n\n \n\n#include <linux/module.h>\n#include <linux/comedi/comedi_pci.h>\n#include <linux/comedi/comedi_8255.h>\n\n \n#define PCI_ID_PCIM_DDA06_16\t\t0x0053\n\n \n#define PCIMDDA_DA_CHAN(x)\t\t(0x00 + (x) * 2)\n#define PCIMDDA_8255_BASE_REG\t\t0x0c\n\nstatic int cb_pcimdda_ao_insn_write(struct comedi_device *dev,\n\t\t\t\t    struct comedi_subdevice *s,\n\t\t\t\t    struct comedi_insn *insn,\n\t\t\t\t    unsigned int *data)\n{\n\tunsigned int chan = CR_CHAN(insn->chanspec);\n\tunsigned long offset = dev->iobase + PCIMDDA_DA_CHAN(chan);\n\tunsigned int val = s->readback[chan];\n\tint i;\n\n\tfor (i = 0; i < insn->n; i++) {\n\t\tval = data[i];\n\n\t\t \n\t\toutb(val & 0x00ff, offset);\n\t\toutb((val >> 8) & 0x00ff, offset + 1);\n\t}\n\ts->readback[chan] = val;\n\n\treturn insn->n;\n}\n\nstatic int cb_pcimdda_ao_insn_read(struct comedi_device *dev,\n\t\t\t\t   struct comedi_subdevice *s,\n\t\t\t\t   struct comedi_insn *insn,\n\t\t\t\t   unsigned int *data)\n{\n\tunsigned int chan = CR_CHAN(insn->chanspec);\n\n\t \n\tinw(dev->iobase + PCIMDDA_DA_CHAN(chan));\n\n\treturn comedi_readback_insn_read(dev, s, insn, data);\n}\n\nstatic int cb_pcimdda_auto_attach(struct comedi_device *dev,\n\t\t\t\t  unsigned long context_unused)\n{\n\tstruct pci_dev *pcidev = comedi_to_pci_dev(dev);\n\tstruct comedi_subdevice *s;\n\tint ret;\n\n\tret = comedi_pci_enable(dev);\n\tif (ret)\n\t\treturn ret;\n\tdev->iobase = pci_resource_start(pcidev, 3);\n\n\tret = comedi_alloc_subdevices(dev, 2);\n\tif (ret)\n\t\treturn ret;\n\n\ts = &dev->subdevices[0];\n\t \n\ts->type\t\t= COMEDI_SUBD_AO;\n\ts->subdev_flags\t= SDF_WRITABLE | SDF_READABLE;\n\ts->n_chan\t= 6;\n\ts->maxdata\t= 0xffff;\n\ts->range_table\t= &range_bipolar5;\n\ts->insn_write\t= cb_pcimdda_ao_insn_write;\n\ts->insn_read\t= cb_pcimdda_ao_insn_read;\n\n\tret = comedi_alloc_subdev_readback(s);\n\tif (ret)\n\t\treturn ret;\n\n\ts = &dev->subdevices[1];\n\t \n\treturn subdev_8255_init(dev, s, NULL, PCIMDDA_8255_BASE_REG);\n}\n\nstatic struct comedi_driver cb_pcimdda_driver = {\n\t.driver_name\t= \"cb_pcimdda\",\n\t.module\t\t= THIS_MODULE,\n\t.auto_attach\t= cb_pcimdda_auto_attach,\n\t.detach\t\t= comedi_pci_detach,\n};\n\nstatic int cb_pcimdda_pci_probe(struct pci_dev *dev,\n\t\t\t\tconst struct pci_device_id *id)\n{\n\treturn comedi_pci_auto_config(dev, &cb_pcimdda_driver,\n\t\t\t\t      id->driver_data);\n}\n\nstatic const struct pci_device_id cb_pcimdda_pci_table[] = {\n\t{ PCI_DEVICE(PCI_VENDOR_ID_CB, PCI_ID_PCIM_DDA06_16) },\n\t{ 0 }\n};\nMODULE_DEVICE_TABLE(pci, cb_pcimdda_pci_table);\n\nstatic struct pci_driver cb_pcimdda_driver_pci_driver = {\n\t.name\t\t= \"cb_pcimdda\",\n\t.id_table\t= cb_pcimdda_pci_table,\n\t.probe\t\t= cb_pcimdda_pci_probe,\n\t.remove\t\t= comedi_pci_auto_unconfig,\n};\nmodule_comedi_pci_driver(cb_pcimdda_driver, cb_pcimdda_driver_pci_driver);\n\nMODULE_AUTHOR(\"Calin A. Culianu <calin@rtlab.org>\");\nMODULE_DESCRIPTION(\"Comedi low-level driver for the Computerboards PCIM-DDA series.  Currently only supports PCIM-DDA06-16 (which also happens to be the only board in this series. :) ) \");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}