{
  "module_name": "ni_mio_cs.c",
  "hash_id": "89b7978d1d4070339fc25dce8c978e4061e8b35a922ae33ae8c1f9294d585d3f",
  "original_prompt": "Ingested from linux-6.6.14/drivers/comedi/drivers/ni_mio_cs.c",
  "human_readable_source": "\n \n\n \n\n \n\n#include <linux/module.h>\n#include <linux/delay.h>\n#include <linux/comedi/comedi_pcmcia.h>\n#include <linux/comedi/comedi_8255.h>\n\n#include \"ni_stc.h\"\n\n \n\nstatic const struct ni_board_struct ni_boards[] = {\n\t{\n\t\t.name\t\t= \"DAQCard-ai-16xe-50\",\n\t\t.device_id\t= 0x010d,\n\t\t.n_adchan\t= 16,\n\t\t.ai_maxdata\t= 0xffff,\n\t\t.ai_fifo_depth\t= 1024,\n\t\t.gainlkup\t= ai_gain_8,\n\t\t.ai_speed\t= 5000,\n\t\t.caldac\t\t= { dac8800, dac8043 },\n\t}, {\n\t\t.name\t\t= \"DAQCard-ai-16e-4\",\n\t\t.device_id\t= 0x010c,\n\t\t.n_adchan\t= 16,\n\t\t.ai_maxdata\t= 0x0fff,\n\t\t.ai_fifo_depth\t= 1024,\n\t\t.gainlkup\t= ai_gain_16,\n\t\t.ai_speed\t= 4000,\n\t\t.caldac\t\t= { mb88341 },\t\t \n\t}, {\n\t\t.name\t\t= \"DAQCard-6062E\",\n\t\t.device_id\t= 0x02c4,\n\t\t.n_adchan\t= 16,\n\t\t.ai_maxdata\t= 0x0fff,\n\t\t.ai_fifo_depth\t= 8192,\n\t\t.gainlkup\t= ai_gain_16,\n\t\t.ai_speed\t= 2000,\n\t\t.n_aochan\t= 2,\n\t\t.ao_maxdata\t= 0x0fff,\n\t\t.ao_fifo_depth\t= 2048,\n\t\t.ao_range_table\t= &range_bipolar10,\n\t\t.ao_speed\t= 1176,\n\t\t.caldac\t\t= { ad8804_debug },\t \n\t }, {\n\t\t \n\t\t.name\t\t= \"DAQCard-6024E\",\n\t\t.device_id\t= 0x075e,\n\t\t.n_adchan\t= 16,\n\t\t.ai_maxdata\t= 0x0fff,\n\t\t.ai_fifo_depth\t= 1024,\n\t\t.gainlkup\t= ai_gain_4,\n\t\t.ai_speed\t= 5000,\n\t\t.n_aochan\t= 2,\n\t\t.ao_maxdata\t= 0x0fff,\n\t\t.ao_range_table\t= &range_bipolar10,\n\t\t.ao_speed\t= 1000000,\n\t\t.caldac\t\t= { ad8804_debug },\n\t}, {\n\t\t \n\t\t.name\t\t= \"DAQCard-6036E\",\n\t\t.device_id\t= 0x0245,\n\t\t.n_adchan\t= 16,\n\t\t.ai_maxdata\t= 0xffff,\n\t\t.ai_fifo_depth\t= 1024,\n\t\t.alwaysdither\t= 1,\n\t\t.gainlkup\t= ai_gain_4,\n\t\t.ai_speed\t= 5000,\n\t\t.n_aochan\t= 2,\n\t\t.ao_maxdata\t= 0xffff,\n\t\t.ao_range_table\t= &range_bipolar10,\n\t\t.ao_speed\t= 1000000,\n\t\t.caldac\t\t= { ad8804_debug },\n\t },\n#if 0\n\t{\n\t\t.name\t\t= \"DAQCard-6715\",\n\t\t.device_id\t= 0x0000,\t \n\t\t.n_aochan\t= 8,\n\t\t.ao_maxdata\t= 0x0fff,\n\t\t.ao_671x\t= 8192,\n\t\t.caldac\t\t= { mb88341, mb88341 },\n\t},\n#endif\n};\n\n#include \"ni_mio_common.c\"\n\nstatic const void *ni_getboardtype(struct comedi_device *dev,\n\t\t\t\t   struct pcmcia_device *link)\n{\n\tstatic const struct ni_board_struct *board;\n\tint i;\n\n\tfor (i = 0; i < ARRAY_SIZE(ni_boards); i++) {\n\t\tboard = &ni_boards[i];\n\t\tif (board->device_id == link->card_id)\n\t\t\treturn board;\n\t}\n\treturn NULL;\n}\n\nstatic int mio_pcmcia_config_loop(struct pcmcia_device *p_dev, void *priv_data)\n{\n\tint base, ret;\n\n\tp_dev->resource[0]->flags &= ~IO_DATA_PATH_WIDTH;\n\tp_dev->resource[0]->flags |= IO_DATA_PATH_WIDTH_16;\n\n\tfor (base = 0x000; base < 0x400; base += 0x20) {\n\t\tp_dev->resource[0]->start = base;\n\t\tret = pcmcia_request_io(p_dev);\n\t\tif (!ret)\n\t\t\treturn 0;\n\t}\n\treturn -ENODEV;\n}\n\nstatic int mio_cs_auto_attach(struct comedi_device *dev,\n\t\t\t      unsigned long context)\n{\n\tstruct pcmcia_device *link = comedi_to_pcmcia_dev(dev);\n\tstatic const struct ni_board_struct *board;\n\tint ret;\n\n\tboard = ni_getboardtype(dev, link);\n\tif (!board)\n\t\treturn -ENODEV;\n\tdev->board_ptr = board;\n\tdev->board_name = board->name;\n\n\tlink->config_flags |= CONF_AUTO_SET_IO | CONF_ENABLE_IRQ;\n\tret = comedi_pcmcia_enable(dev, mio_pcmcia_config_loop);\n\tif (ret)\n\t\treturn ret;\n\tdev->iobase = link->resource[0]->start;\n\n\tlink->priv = dev;\n\tret = pcmcia_request_irq(link, ni_E_interrupt);\n\tif (ret)\n\t\treturn ret;\n\tdev->irq = link->irq;\n\n\tret = ni_alloc_private(dev);\n\tif (ret)\n\t\treturn ret;\n\n\treturn ni_E_init(dev, 0, 1);\n}\n\nstatic void mio_cs_detach(struct comedi_device *dev)\n{\n\tmio_common_detach(dev);\n\tcomedi_pcmcia_disable(dev);\n}\n\nstatic struct comedi_driver driver_ni_mio_cs = {\n\t.driver_name\t= \"ni_mio_cs\",\n\t.module\t\t= THIS_MODULE,\n\t.auto_attach\t= mio_cs_auto_attach,\n\t.detach\t\t= mio_cs_detach,\n};\n\nstatic int cs_attach(struct pcmcia_device *link)\n{\n\treturn comedi_pcmcia_auto_config(link, &driver_ni_mio_cs);\n}\n\nstatic const struct pcmcia_device_id ni_mio_cs_ids[] = {\n\tPCMCIA_DEVICE_MANF_CARD(0x010b, 0x010d),\t \n\tPCMCIA_DEVICE_MANF_CARD(0x010b, 0x010c),\t \n\tPCMCIA_DEVICE_MANF_CARD(0x010b, 0x02c4),\t \n\tPCMCIA_DEVICE_MANF_CARD(0x010b, 0x075e),\t \n\tPCMCIA_DEVICE_MANF_CARD(0x010b, 0x0245),\t \n\tPCMCIA_DEVICE_NULL\n};\nMODULE_DEVICE_TABLE(pcmcia, ni_mio_cs_ids);\n\nstatic struct pcmcia_driver ni_mio_cs_driver = {\n\t.name\t\t= \"ni_mio_cs\",\n\t.owner\t\t= THIS_MODULE,\n\t.id_table\t= ni_mio_cs_ids,\n\t.probe\t\t= cs_attach,\n\t.remove\t\t= comedi_pcmcia_auto_unconfig,\n};\nmodule_comedi_pcmcia_driver(driver_ni_mio_cs, ni_mio_cs_driver);\n\nMODULE_DESCRIPTION(\"Comedi driver for National Instruments DAQCard E series\");\nMODULE_AUTHOR(\"David A. Schleef <ds@schleef.org>\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}