{
  "module_name": "cpuidle-mvebu-v7.c",
  "hash_id": "e042166fbc3bbe4ef2767aa0afc25ca18da83c4a85335e99a6ba376e19e621bf",
  "original_prompt": "Ingested from linux-6.6.14/drivers/cpuidle/cpuidle-mvebu-v7.c",
  "human_readable_source": " \n\n#include <linux/cpu_pm.h>\n#include <linux/cpuidle.h>\n#include <linux/module.h>\n#include <linux/of.h>\n#include <linux/suspend.h>\n#include <linux/platform_device.h>\n#include <asm/cpuidle.h>\n\n#define MVEBU_V7_FLAG_DEEP_IDLE\t0x10000\n\nstatic int (*mvebu_v7_cpu_suspend)(int);\n\nstatic __cpuidle int mvebu_v7_enter_idle(struct cpuidle_device *dev,\n\t\t\t\t\t struct cpuidle_driver *drv,\n\t\t\t\t\t int index)\n{\n\tint ret;\n\tbool deepidle = false;\n\tcpu_pm_enter();\n\n\tif (drv->states[index].flags & MVEBU_V7_FLAG_DEEP_IDLE)\n\t\tdeepidle = true;\n\n\tct_cpuidle_enter();\n\tret = mvebu_v7_cpu_suspend(deepidle);\n\tct_cpuidle_exit();\n\n\tcpu_pm_exit();\n\n\tif (ret)\n\t\treturn ret;\n\n\treturn index;\n}\n\nstatic struct cpuidle_driver armadaxp_idle_driver = {\n\t.name\t\t\t= \"armada_xp_idle\",\n\t.states[0]\t\t= ARM_CPUIDLE_WFI_STATE,\n\t.states[1]\t\t= {\n\t\t.enter\t\t\t= mvebu_v7_enter_idle,\n\t\t.exit_latency\t\t= 100,\n\t\t.power_usage\t\t= 50,\n\t\t.target_residency\t= 1000,\n\t\t.flags\t\t\t= CPUIDLE_FLAG_RCU_IDLE,\n\t\t.name\t\t\t= \"MV CPU IDLE\",\n\t\t.desc\t\t\t= \"CPU power down\",\n\t},\n\t.states[2]\t\t= {\n\t\t.enter\t\t\t= mvebu_v7_enter_idle,\n\t\t.exit_latency\t\t= 1000,\n\t\t.power_usage\t\t= 5,\n\t\t.target_residency\t= 10000,\n\t\t.flags\t\t\t= MVEBU_V7_FLAG_DEEP_IDLE | CPUIDLE_FLAG_RCU_IDLE,\n\t\t.name\t\t\t= \"MV CPU DEEP IDLE\",\n\t\t.desc\t\t\t= \"CPU and L2 Fabric power down\",\n\t},\n\t.state_count = 3,\n};\n\nstatic struct cpuidle_driver armada370_idle_driver = {\n\t.name\t\t\t= \"armada_370_idle\",\n\t.states[0]\t\t= ARM_CPUIDLE_WFI_STATE,\n\t.states[1]\t\t= {\n\t\t.enter\t\t\t= mvebu_v7_enter_idle,\n\t\t.exit_latency\t\t= 100,\n\t\t.power_usage\t\t= 5,\n\t\t.target_residency\t= 1000,\n\t\t.flags\t\t\t= MVEBU_V7_FLAG_DEEP_IDLE | CPUIDLE_FLAG_RCU_IDLE,\n\t\t.name\t\t\t= \"Deep Idle\",\n\t\t.desc\t\t\t= \"CPU and L2 Fabric power down\",\n\t},\n\t.state_count = 2,\n};\n\nstatic struct cpuidle_driver armada38x_idle_driver = {\n\t.name\t\t\t= \"armada_38x_idle\",\n\t.states[0]\t\t= ARM_CPUIDLE_WFI_STATE,\n\t.states[1]\t\t= {\n\t\t.enter\t\t\t= mvebu_v7_enter_idle,\n\t\t.exit_latency\t\t= 10,\n\t\t.power_usage\t\t= 5,\n\t\t.target_residency\t= 100,\n\t\t.flags\t\t\t= CPUIDLE_FLAG_RCU_IDLE,\n\t\t.name\t\t\t= \"Idle\",\n\t\t.desc\t\t\t= \"CPU and SCU power down\",\n\t},\n\t.state_count = 2,\n};\n\nstatic int mvebu_v7_cpuidle_probe(struct platform_device *pdev)\n{\n\tconst struct platform_device_id *id = pdev->id_entry;\n\n\tif (!id)\n\t\treturn -EINVAL;\n\n\tmvebu_v7_cpu_suspend = pdev->dev.platform_data;\n\n\treturn cpuidle_register((struct cpuidle_driver *)id->driver_data, NULL);\n}\n\nstatic const struct platform_device_id mvebu_cpuidle_ids[] = {\n\t{\n\t\t.name = \"cpuidle-armada-xp\",\n\t\t.driver_data = (unsigned long)&armadaxp_idle_driver,\n\t}, {\n\t\t.name = \"cpuidle-armada-370\",\n\t\t.driver_data = (unsigned long)&armada370_idle_driver,\n\t}, {\n\t\t.name = \"cpuidle-armada-38x\",\n\t\t.driver_data = (unsigned long)&armada38x_idle_driver,\n\t},\n\t{}\n};\n\nstatic struct platform_driver mvebu_cpuidle_driver = {\n\t.probe = mvebu_v7_cpuidle_probe,\n\t.driver = {\n\t\t.name = \"cpuidle-mbevu\",\n\t\t.suppress_bind_attrs = true,\n\t},\n\t.id_table = mvebu_cpuidle_ids,\n};\n\nbuiltin_platform_driver(mvebu_cpuidle_driver);\n\nMODULE_AUTHOR(\"Gregory CLEMENT <gregory.clement@free-electrons.com>\");\nMODULE_DESCRIPTION(\"Marvell EBU v7 cpuidle driver\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}