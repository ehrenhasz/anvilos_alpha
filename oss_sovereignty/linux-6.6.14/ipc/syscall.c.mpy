{
  "module_name": "syscall.c",
  "hash_id": "093da5d6506eb38adf4c76d2dae056e16e953f64d56bec64be44cd91f4af42e8",
  "original_prompt": "Ingested from linux-6.6.14/ipc/syscall.c",
  "human_readable_source": "\n \n#include <linux/unistd.h>\n#include <linux/syscalls.h>\n#include <linux/security.h>\n#include <linux/ipc_namespace.h>\n#include \"util.h\"\n\n#ifdef __ARCH_WANT_SYS_IPC\n#include <linux/errno.h>\n#include <linux/ipc.h>\n#include <linux/shm.h>\n#include <linux/uaccess.h>\n\nint ksys_ipc(unsigned int call, int first, unsigned long second,\n\tunsigned long third, void __user * ptr, long fifth)\n{\n\tint version, ret;\n\n\tversion = call >> 16;  \n\tcall &= 0xffff;\n\n\tswitch (call) {\n\tcase SEMOP:\n\t\treturn ksys_semtimedop(first, (struct sembuf __user *)ptr,\n\t\t\t\t       second, NULL);\n\tcase SEMTIMEDOP:\n\t\tif (IS_ENABLED(CONFIG_64BIT))\n\t\t\treturn ksys_semtimedop(first, ptr, second,\n\t\t\t        (const struct __kernel_timespec __user *)fifth);\n\t\telse if (IS_ENABLED(CONFIG_COMPAT_32BIT_TIME))\n\t\t\treturn compat_ksys_semtimedop(first, ptr, second,\n\t\t\t        (const struct old_timespec32 __user *)fifth);\n\t\telse\n\t\t\treturn -ENOSYS;\n\n\tcase SEMGET:\n\t\treturn ksys_semget(first, second, third);\n\tcase SEMCTL: {\n\t\tunsigned long arg;\n\t\tif (!ptr)\n\t\t\treturn -EINVAL;\n\t\tif (get_user(arg, (unsigned long __user *) ptr))\n\t\t\treturn -EFAULT;\n\t\treturn ksys_old_semctl(first, second, third, arg);\n\t}\n\n\tcase MSGSND:\n\t\treturn ksys_msgsnd(first, (struct msgbuf __user *) ptr,\n\t\t\t\t  second, third);\n\tcase MSGRCV:\n\t\tswitch (version) {\n\t\tcase 0: {\n\t\t\tstruct ipc_kludge tmp;\n\t\t\tif (!ptr)\n\t\t\t\treturn -EINVAL;\n\n\t\t\tif (copy_from_user(&tmp,\n\t\t\t\t\t   (struct ipc_kludge __user *) ptr,\n\t\t\t\t\t   sizeof(tmp)))\n\t\t\t\treturn -EFAULT;\n\t\t\treturn ksys_msgrcv(first, tmp.msgp, second,\n\t\t\t\t\t   tmp.msgtyp, third);\n\t\t}\n\t\tdefault:\n\t\t\treturn ksys_msgrcv(first,\n\t\t\t\t\t   (struct msgbuf __user *) ptr,\n\t\t\t\t\t   second, fifth, third);\n\t\t}\n\tcase MSGGET:\n\t\treturn ksys_msgget((key_t) first, second);\n\tcase MSGCTL:\n\t\treturn ksys_old_msgctl(first, second,\n\t\t\t\t   (struct msqid_ds __user *)ptr);\n\n\tcase SHMAT:\n\t\tswitch (version) {\n\t\tdefault: {\n\t\t\tunsigned long raddr;\n\t\t\tret = do_shmat(first, (char __user *)ptr,\n\t\t\t\t       second, &raddr, SHMLBA);\n\t\t\tif (ret)\n\t\t\t\treturn ret;\n\t\t\treturn put_user(raddr, (unsigned long __user *) third);\n\t\t}\n\t\tcase 1:\n\t\t\t \n\t\t\treturn -EINVAL;\n\t\t}\n\tcase SHMDT:\n\t\treturn ksys_shmdt((char __user *)ptr);\n\tcase SHMGET:\n\t\treturn ksys_shmget(first, second, third);\n\tcase SHMCTL:\n\t\treturn ksys_old_shmctl(first, second,\n\t\t\t\t   (struct shmid_ds __user *) ptr);\n\tdefault:\n\t\treturn -ENOSYS;\n\t}\n}\n\nSYSCALL_DEFINE6(ipc, unsigned int, call, int, first, unsigned long, second,\n\t\tunsigned long, third, void __user *, ptr, long, fifth)\n{\n\treturn ksys_ipc(call, first, second, third, ptr, fifth);\n}\n#endif\n\n#ifdef CONFIG_COMPAT\n#include <linux/compat.h>\n\n#ifndef COMPAT_SHMLBA\n#define COMPAT_SHMLBA\tSHMLBA\n#endif\n\nstruct compat_ipc_kludge {\n\tcompat_uptr_t msgp;\n\tcompat_long_t msgtyp;\n};\n\n#ifdef CONFIG_ARCH_WANT_OLD_COMPAT_IPC\nint compat_ksys_ipc(u32 call, int first, int second,\n\tu32 third, compat_uptr_t ptr, u32 fifth)\n{\n\tint version;\n\tu32 pad;\n\n\tversion = call >> 16;  \n\tcall &= 0xffff;\n\n\tswitch (call) {\n\tcase SEMOP:\n\t\t \n\t\treturn ksys_semtimedop(first, compat_ptr(ptr), second, NULL);\n\tcase SEMTIMEDOP:\n\t\tif (!IS_ENABLED(CONFIG_COMPAT_32BIT_TIME))\n\t\t\treturn -ENOSYS;\n\t\treturn compat_ksys_semtimedop(first, compat_ptr(ptr), second,\n\t\t\t\t\t\tcompat_ptr(fifth));\n\tcase SEMGET:\n\t\treturn ksys_semget(first, second, third);\n\tcase SEMCTL:\n\t\tif (!ptr)\n\t\t\treturn -EINVAL;\n\t\tif (get_user(pad, (u32 __user *) compat_ptr(ptr)))\n\t\t\treturn -EFAULT;\n\t\treturn compat_ksys_old_semctl(first, second, third, pad);\n\n\tcase MSGSND:\n\t\treturn compat_ksys_msgsnd(first, ptr, second, third);\n\n\tcase MSGRCV: {\n\t\tvoid __user *uptr = compat_ptr(ptr);\n\n\t\tif (first < 0 || second < 0)\n\t\t\treturn -EINVAL;\n\n\t\tif (!version) {\n\t\t\tstruct compat_ipc_kludge ipck;\n\t\t\tif (!uptr)\n\t\t\t\treturn -EINVAL;\n\t\t\tif (copy_from_user(&ipck, uptr, sizeof(ipck)))\n\t\t\t\treturn -EFAULT;\n\t\t\treturn compat_ksys_msgrcv(first, ipck.msgp, second,\n\t\t\t\t\t\t ipck.msgtyp, third);\n\t\t}\n\t\treturn compat_ksys_msgrcv(first, ptr, second, fifth, third);\n\t}\n\tcase MSGGET:\n\t\treturn ksys_msgget(first, second);\n\tcase MSGCTL:\n\t\treturn compat_ksys_old_msgctl(first, second, compat_ptr(ptr));\n\n\tcase SHMAT: {\n\t\tint err;\n\t\tunsigned long raddr;\n\n\t\tif (version == 1)\n\t\t\treturn -EINVAL;\n\t\terr = do_shmat(first, compat_ptr(ptr), second, &raddr,\n\t\t\t       COMPAT_SHMLBA);\n\t\tif (err < 0)\n\t\t\treturn err;\n\t\treturn put_user(raddr, (compat_ulong_t __user *)compat_ptr(third));\n\t}\n\tcase SHMDT:\n\t\treturn ksys_shmdt(compat_ptr(ptr));\n\tcase SHMGET:\n\t\treturn ksys_shmget(first, (unsigned int)second, third);\n\tcase SHMCTL:\n\t\treturn compat_ksys_old_shmctl(first, second, compat_ptr(ptr));\n\t}\n\n\treturn -ENOSYS;\n}\n\nCOMPAT_SYSCALL_DEFINE6(ipc, u32, call, int, first, int, second,\n\tu32, third, compat_uptr_t, ptr, u32, fifth)\n{\n\treturn compat_ksys_ipc(call, first, second, third, ptr, fifth);\n}\n#endif\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}