{
  "module_name": "atm_sysfs.c",
  "hash_id": "a42ec6b66a48a1a1d231b1e2ca4759f7637d53bb6de92646ae3ece172209c19a",
  "original_prompt": "Ingested from linux-6.6.14/net/atm/atm_sysfs.c",
  "human_readable_source": "\n \n\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/init.h>\n#include <linux/kobject.h>\n#include <linux/atmdev.h>\n#include \"common.h\"\n#include \"resources.h\"\n\n#define to_atm_dev(cldev) container_of(cldev, struct atm_dev, class_dev)\n\nstatic ssize_t type_show(struct device *cdev,\n\t\t\t struct device_attribute *attr, char *buf)\n{\n\tstruct atm_dev *adev = to_atm_dev(cdev);\n\n\treturn scnprintf(buf, PAGE_SIZE, \"%s\\n\", adev->type);\n}\n\nstatic ssize_t address_show(struct device *cdev,\n\t\t\t    struct device_attribute *attr, char *buf)\n{\n\tstruct atm_dev *adev = to_atm_dev(cdev);\n\n\treturn scnprintf(buf, PAGE_SIZE, \"%pM\\n\", adev->esi);\n}\n\nstatic ssize_t atmaddress_show(struct device *cdev,\n\t\t\t       struct device_attribute *attr, char *buf)\n{\n\tunsigned long flags;\n\tstruct atm_dev *adev = to_atm_dev(cdev);\n\tstruct atm_dev_addr *aaddr;\n\tint count = 0;\n\n\tspin_lock_irqsave(&adev->lock, flags);\n\tlist_for_each_entry(aaddr, &adev->local, entry) {\n\t\tcount += scnprintf(buf + count, PAGE_SIZE - count,\n\t\t\t\t   \"%1phN.%2phN.%10phN.%6phN.%1phN\\n\",\n\t\t\t\t   &aaddr->addr.sas_addr.prv[0],\n\t\t\t\t   &aaddr->addr.sas_addr.prv[1],\n\t\t\t\t   &aaddr->addr.sas_addr.prv[3],\n\t\t\t\t   &aaddr->addr.sas_addr.prv[13],\n\t\t\t\t   &aaddr->addr.sas_addr.prv[19]);\n\t}\n\tspin_unlock_irqrestore(&adev->lock, flags);\n\n\treturn count;\n}\n\nstatic ssize_t atmindex_show(struct device *cdev,\n\t\t\t     struct device_attribute *attr, char *buf)\n{\n\tstruct atm_dev *adev = to_atm_dev(cdev);\n\n\treturn scnprintf(buf, PAGE_SIZE, \"%d\\n\", adev->number);\n}\n\nstatic ssize_t carrier_show(struct device *cdev,\n\t\t\t    struct device_attribute *attr, char *buf)\n{\n\tstruct atm_dev *adev = to_atm_dev(cdev);\n\n\treturn scnprintf(buf, PAGE_SIZE, \"%d\\n\",\n\t\t\t adev->signal == ATM_PHY_SIG_LOST ? 0 : 1);\n}\n\nstatic ssize_t link_rate_show(struct device *cdev,\n\t\t\t      struct device_attribute *attr, char *buf)\n{\n\tstruct atm_dev *adev = to_atm_dev(cdev);\n\tint link_rate;\n\n\t \n\tswitch (adev->link_rate) {\n\tcase ATM_OC3_PCR:\n\t\tlink_rate = 155520000;\n\t\tbreak;\n\tcase ATM_OC12_PCR:\n\t\tlink_rate = 622080000;\n\t\tbreak;\n\tcase ATM_25_PCR:\n\t\tlink_rate = 25600000;\n\t\tbreak;\n\tdefault:\n\t\tlink_rate = adev->link_rate * 8 * 53;\n\t}\n\treturn scnprintf(buf, PAGE_SIZE, \"%d\\n\", link_rate);\n}\n\nstatic DEVICE_ATTR_RO(address);\nstatic DEVICE_ATTR_RO(atmaddress);\nstatic DEVICE_ATTR_RO(atmindex);\nstatic DEVICE_ATTR_RO(carrier);\nstatic DEVICE_ATTR_RO(type);\nstatic DEVICE_ATTR_RO(link_rate);\n\nstatic struct device_attribute *atm_attrs[] = {\n\t&dev_attr_atmaddress,\n\t&dev_attr_address,\n\t&dev_attr_atmindex,\n\t&dev_attr_carrier,\n\t&dev_attr_type,\n\t&dev_attr_link_rate,\n\tNULL\n};\n\n\nstatic int atm_uevent(const struct device *cdev, struct kobj_uevent_env *env)\n{\n\tconst struct atm_dev *adev;\n\n\tif (!cdev)\n\t\treturn -ENODEV;\n\n\tadev = to_atm_dev(cdev);\n\tif (!adev)\n\t\treturn -ENODEV;\n\n\tif (add_uevent_var(env, \"NAME=%s%d\", adev->type, adev->number))\n\t\treturn -ENOMEM;\n\n\treturn 0;\n}\n\nstatic void atm_release(struct device *cdev)\n{\n\tstruct atm_dev *adev = to_atm_dev(cdev);\n\n\tkfree(adev);\n}\n\nstatic struct class atm_class = {\n\t.name\t\t= \"atm\",\n\t.dev_release\t= atm_release,\n\t.dev_uevent\t\t= atm_uevent,\n};\n\nint atm_register_sysfs(struct atm_dev *adev, struct device *parent)\n{\n\tstruct device *cdev = &adev->class_dev;\n\tint i, j, err;\n\n\tcdev->class = &atm_class;\n\tcdev->parent = parent;\n\tdev_set_drvdata(cdev, adev);\n\n\tdev_set_name(cdev, \"%s%d\", adev->type, adev->number);\n\terr = device_register(cdev);\n\tif (err < 0)\n\t\treturn err;\n\n\tfor (i = 0; atm_attrs[i]; i++) {\n\t\terr = device_create_file(cdev, atm_attrs[i]);\n\t\tif (err)\n\t\t\tgoto err_out;\n\t}\n\n\treturn 0;\n\nerr_out:\n\tfor (j = 0; j < i; j++)\n\t\tdevice_remove_file(cdev, atm_attrs[j]);\n\tdevice_del(cdev);\n\treturn err;\n}\n\nvoid atm_unregister_sysfs(struct atm_dev *adev)\n{\n\tstruct device *cdev = &adev->class_dev;\n\n\tdevice_del(cdev);\n}\n\nint __init atm_sysfs_init(void)\n{\n\treturn class_register(&atm_class);\n}\n\nvoid __exit atm_sysfs_exit(void)\n{\n\tclass_unregister(&atm_class);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}