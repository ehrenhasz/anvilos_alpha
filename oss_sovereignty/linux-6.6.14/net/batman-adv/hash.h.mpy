{
  "module_name": "hash.h",
  "hash_id": "958e5bece7a309a971f30b582c6eaf46fe5f87650b81a5ffbcad7ccb98fa6c18",
  "original_prompt": "Ingested from linux-6.6.14/net/batman-adv/hash.h",
  "human_readable_source": " \n \n\n#ifndef _NET_BATMAN_ADV_HASH_H_\n#define _NET_BATMAN_ADV_HASH_H_\n\n#include \"main.h\"\n\n#include <linux/atomic.h>\n#include <linux/compiler.h>\n#include <linux/list.h>\n#include <linux/lockdep.h>\n#include <linux/rculist.h>\n#include <linux/spinlock.h>\n#include <linux/stddef.h>\n#include <linux/types.h>\n\n \ntypedef bool (*batadv_hashdata_compare_cb)(const struct hlist_node *,\n\t\t\t\t\t   const void *);\n\n \ntypedef u32 (*batadv_hashdata_choose_cb)(const void *, u32);\ntypedef void (*batadv_hashdata_free_cb)(struct hlist_node *, void *);\n\n \nstruct batadv_hashtable {\n\t \n\tstruct hlist_head *table;\n\n\t \n\tspinlock_t *list_locks;\n\n\t \n\tu32 size;\n\n\t \n\tatomic_t generation;\n};\n\n \nstruct batadv_hashtable *batadv_hash_new(u32 size);\n\n \nvoid batadv_hash_set_lock_class(struct batadv_hashtable *hash,\n\t\t\t\tstruct lock_class_key *key);\n\n \nvoid batadv_hash_destroy(struct batadv_hashtable *hash);\n\n \nstatic inline int batadv_hash_add(struct batadv_hashtable *hash,\n\t\t\t\t  batadv_hashdata_compare_cb compare,\n\t\t\t\t  batadv_hashdata_choose_cb choose,\n\t\t\t\t  const void *data,\n\t\t\t\t  struct hlist_node *data_node)\n{\n\tu32 index;\n\tint ret = -1;\n\tstruct hlist_head *head;\n\tstruct hlist_node *node;\n\tspinlock_t *list_lock;  \n\n\tif (!hash)\n\t\tgoto out;\n\n\tindex = choose(data, hash->size);\n\thead = &hash->table[index];\n\tlist_lock = &hash->list_locks[index];\n\n\tspin_lock_bh(list_lock);\n\n\thlist_for_each(node, head) {\n\t\tif (!compare(node, data))\n\t\t\tcontinue;\n\n\t\tret = 1;\n\t\tgoto unlock;\n\t}\n\n\t \n\thlist_add_head_rcu(data_node, head);\n\tatomic_inc(&hash->generation);\n\n\tret = 0;\n\nunlock:\n\tspin_unlock_bh(list_lock);\nout:\n\treturn ret;\n}\n\n \nstatic inline void *batadv_hash_remove(struct batadv_hashtable *hash,\n\t\t\t\t       batadv_hashdata_compare_cb compare,\n\t\t\t\t       batadv_hashdata_choose_cb choose,\n\t\t\t\t       void *data)\n{\n\tu32 index;\n\tstruct hlist_node *node;\n\tstruct hlist_head *head;\n\tvoid *data_save = NULL;\n\n\tindex = choose(data, hash->size);\n\thead = &hash->table[index];\n\n\tspin_lock_bh(&hash->list_locks[index]);\n\thlist_for_each(node, head) {\n\t\tif (!compare(node, data))\n\t\t\tcontinue;\n\n\t\tdata_save = node;\n\t\thlist_del_rcu(node);\n\t\tatomic_inc(&hash->generation);\n\t\tbreak;\n\t}\n\tspin_unlock_bh(&hash->list_locks[index]);\n\n\treturn data_save;\n}\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}