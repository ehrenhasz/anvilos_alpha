{
  "module_name": "bat_algo.c",
  "hash_id": "3825b4d0ffad50feb48a1a328f7471da140323e84e6f8e64ad63c2a11a4ae1f7",
  "original_prompt": "Ingested from linux-6.6.14/net/batman-adv/bat_algo.c",
  "human_readable_source": "\n \n\n#include \"main.h\"\n\n#include <linux/errno.h>\n#include <linux/list.h>\n#include <linux/moduleparam.h>\n#include <linux/netlink.h>\n#include <linux/printk.h>\n#include <linux/skbuff.h>\n#include <linux/stddef.h>\n#include <linux/string.h>\n#include <net/genetlink.h>\n#include <net/netlink.h>\n#include <uapi/linux/batman_adv.h>\n\n#include \"bat_algo.h\"\n#include \"netlink.h\"\n\nchar batadv_routing_algo[20] = \"BATMAN_IV\";\nstatic struct hlist_head batadv_algo_list;\n\n \nvoid batadv_algo_init(void)\n{\n\tINIT_HLIST_HEAD(&batadv_algo_list);\n}\n\n \nstruct batadv_algo_ops *batadv_algo_get(const char *name)\n{\n\tstruct batadv_algo_ops *bat_algo_ops = NULL, *bat_algo_ops_tmp;\n\n\thlist_for_each_entry(bat_algo_ops_tmp, &batadv_algo_list, list) {\n\t\tif (strcmp(bat_algo_ops_tmp->name, name) != 0)\n\t\t\tcontinue;\n\n\t\tbat_algo_ops = bat_algo_ops_tmp;\n\t\tbreak;\n\t}\n\n\treturn bat_algo_ops;\n}\n\n \nint batadv_algo_register(struct batadv_algo_ops *bat_algo_ops)\n{\n\tstruct batadv_algo_ops *bat_algo_ops_tmp;\n\n\tbat_algo_ops_tmp = batadv_algo_get(bat_algo_ops->name);\n\tif (bat_algo_ops_tmp) {\n\t\tpr_info(\"Trying to register already registered routing algorithm: %s\\n\",\n\t\t\tbat_algo_ops->name);\n\t\treturn -EEXIST;\n\t}\n\n\t \n\tif (!bat_algo_ops->iface.enable ||\n\t    !bat_algo_ops->iface.disable ||\n\t    !bat_algo_ops->iface.update_mac ||\n\t    !bat_algo_ops->iface.primary_set ||\n\t    !bat_algo_ops->neigh.cmp ||\n\t    !bat_algo_ops->neigh.is_similar_or_better) {\n\t\tpr_info(\"Routing algo '%s' does not implement required ops\\n\",\n\t\t\tbat_algo_ops->name);\n\t\treturn -EINVAL;\n\t}\n\n\tINIT_HLIST_NODE(&bat_algo_ops->list);\n\thlist_add_head(&bat_algo_ops->list, &batadv_algo_list);\n\n\treturn 0;\n}\n\n \nint batadv_algo_select(struct batadv_priv *bat_priv, const char *name)\n{\n\tstruct batadv_algo_ops *bat_algo_ops;\n\n\tbat_algo_ops = batadv_algo_get(name);\n\tif (!bat_algo_ops)\n\t\treturn -EINVAL;\n\n\tbat_priv->algo_ops = bat_algo_ops;\n\n\treturn 0;\n}\n\nstatic int batadv_param_set_ra(const char *val, const struct kernel_param *kp)\n{\n\tstruct batadv_algo_ops *bat_algo_ops;\n\tchar *algo_name = (char *)val;\n\tsize_t name_len = strlen(algo_name);\n\n\tif (name_len > 0 && algo_name[name_len - 1] == '\\n')\n\t\talgo_name[name_len - 1] = '\\0';\n\n\tbat_algo_ops = batadv_algo_get(algo_name);\n\tif (!bat_algo_ops) {\n\t\tpr_err(\"Routing algorithm '%s' is not supported\\n\", algo_name);\n\t\treturn -EINVAL;\n\t}\n\n\treturn param_set_copystring(algo_name, kp);\n}\n\nstatic const struct kernel_param_ops batadv_param_ops_ra = {\n\t.set = batadv_param_set_ra,\n\t.get = param_get_string,\n};\n\nstatic struct kparam_string batadv_param_string_ra = {\n\t.maxlen = sizeof(batadv_routing_algo),\n\t.string = batadv_routing_algo,\n};\n\nmodule_param_cb(routing_algo, &batadv_param_ops_ra, &batadv_param_string_ra,\n\t\t0644);\n\n \nstatic int batadv_algo_dump_entry(struct sk_buff *msg, u32 portid, u32 seq,\n\t\t\t\t  struct batadv_algo_ops *bat_algo_ops)\n{\n\tvoid *hdr;\n\n\thdr = genlmsg_put(msg, portid, seq, &batadv_netlink_family,\n\t\t\t  NLM_F_MULTI, BATADV_CMD_GET_ROUTING_ALGOS);\n\tif (!hdr)\n\t\treturn -EMSGSIZE;\n\n\tif (nla_put_string(msg, BATADV_ATTR_ALGO_NAME, bat_algo_ops->name))\n\t\tgoto nla_put_failure;\n\n\tgenlmsg_end(msg, hdr);\n\treturn 0;\n\n nla_put_failure:\n\tgenlmsg_cancel(msg, hdr);\n\treturn -EMSGSIZE;\n}\n\n \nint batadv_algo_dump(struct sk_buff *msg, struct netlink_callback *cb)\n{\n\tint portid = NETLINK_CB(cb->skb).portid;\n\tstruct batadv_algo_ops *bat_algo_ops;\n\tint skip = cb->args[0];\n\tint i = 0;\n\n\thlist_for_each_entry(bat_algo_ops, &batadv_algo_list, list) {\n\t\tif (i++ < skip)\n\t\t\tcontinue;\n\n\t\tif (batadv_algo_dump_entry(msg, portid, cb->nlh->nlmsg_seq,\n\t\t\t\t\t   bat_algo_ops)) {\n\t\t\ti--;\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tcb->args[0] = i;\n\n\treturn msg->len;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}