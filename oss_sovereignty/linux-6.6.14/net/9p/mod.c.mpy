{
  "module_name": "mod.c",
  "hash_id": "190b9e65db491f68ed117137842e4e3f4d62c0cafa54ce46d76dbe6483cf027d",
  "original_prompt": "Ingested from linux-6.6.14/net/9p/mod.c",
  "human_readable_source": "\n \n\n#define pr_fmt(fmt) KBUILD_MODNAME \": \" fmt\n\n#include <linux/module.h>\n#include <linux/kmod.h>\n#include <linux/errno.h>\n#include <linux/sched.h>\n#include <linux/moduleparam.h>\n#include <net/9p/9p.h>\n#include <linux/fs.h>\n#include <linux/parser.h>\n#include <net/9p/client.h>\n#include <net/9p/transport.h>\n#include <linux/list.h>\n#include <linux/spinlock.h>\n\n#ifdef CONFIG_NET_9P_DEBUG\nunsigned int p9_debug_level;\t \nEXPORT_SYMBOL(p9_debug_level);\nmodule_param_named(debug, p9_debug_level, uint, 0);\nMODULE_PARM_DESC(debug, \"9P debugging level\");\n\nvoid _p9_debug(enum p9_debug_flags level, const char *func,\n\t       const char *fmt, ...)\n{\n\tstruct va_format vaf;\n\tva_list args;\n\n\tif ((p9_debug_level & level) != level)\n\t\treturn;\n\n\tva_start(args, fmt);\n\n\tvaf.fmt = fmt;\n\tvaf.va = &args;\n\n\tif (level == P9_DEBUG_9P)\n\t\tpr_notice(\"(%8.8d) %pV\", task_pid_nr(current), &vaf);\n\telse\n\t\tpr_notice(\"-- %s (%d): %pV\", func, task_pid_nr(current), &vaf);\n\n\tva_end(args);\n}\nEXPORT_SYMBOL(_p9_debug);\n#endif\n\n \n\nstatic DEFINE_SPINLOCK(v9fs_trans_lock);\nstatic LIST_HEAD(v9fs_trans_list);\n\n \nvoid v9fs_register_trans(struct p9_trans_module *m)\n{\n\tspin_lock(&v9fs_trans_lock);\n\tlist_add_tail(&m->list, &v9fs_trans_list);\n\tspin_unlock(&v9fs_trans_lock);\n}\nEXPORT_SYMBOL(v9fs_register_trans);\n\n \nvoid v9fs_unregister_trans(struct p9_trans_module *m)\n{\n\tspin_lock(&v9fs_trans_lock);\n\tlist_del_init(&m->list);\n\tspin_unlock(&v9fs_trans_lock);\n}\nEXPORT_SYMBOL(v9fs_unregister_trans);\n\nstatic struct p9_trans_module *_p9_get_trans_by_name(const char *s)\n{\n\tstruct p9_trans_module *t, *found = NULL;\n\n\tspin_lock(&v9fs_trans_lock);\n\n\tlist_for_each_entry(t, &v9fs_trans_list, list)\n\t\tif (strcmp(t->name, s) == 0 &&\n\t\t    try_module_get(t->owner)) {\n\t\t\tfound = t;\n\t\t\tbreak;\n\t\t}\n\n\tspin_unlock(&v9fs_trans_lock);\n\n\treturn found;\n}\n\n \nstruct p9_trans_module *v9fs_get_trans_by_name(const char *s)\n{\n\tstruct p9_trans_module *found = NULL;\n\n\tfound = _p9_get_trans_by_name(s);\n\n#ifdef CONFIG_MODULES\n\tif (!found) {\n\t\trequest_module(\"9p-%s\", s);\n\t\tfound = _p9_get_trans_by_name(s);\n\t}\n#endif\n\n\treturn found;\n}\nEXPORT_SYMBOL(v9fs_get_trans_by_name);\n\nstatic const char * const v9fs_default_transports[] = {\n\t\"virtio\", \"tcp\", \"fd\", \"unix\", \"xen\", \"rdma\",\n};\n\n \n\nstruct p9_trans_module *v9fs_get_default_trans(void)\n{\n\tstruct p9_trans_module *t, *found = NULL;\n\tint i;\n\n\tspin_lock(&v9fs_trans_lock);\n\n\tlist_for_each_entry(t, &v9fs_trans_list, list)\n\t\tif (t->def && try_module_get(t->owner)) {\n\t\t\tfound = t;\n\t\t\tbreak;\n\t\t}\n\n\tif (!found)\n\t\tlist_for_each_entry(t, &v9fs_trans_list, list)\n\t\t\tif (try_module_get(t->owner)) {\n\t\t\t\tfound = t;\n\t\t\t\tbreak;\n\t\t\t}\n\n\tspin_unlock(&v9fs_trans_lock);\n\n\tfor (i = 0; !found && i < ARRAY_SIZE(v9fs_default_transports); i++)\n\t\tfound = v9fs_get_trans_by_name(v9fs_default_transports[i]);\n\n\treturn found;\n}\nEXPORT_SYMBOL(v9fs_get_default_trans);\n\n \nvoid v9fs_put_trans(struct p9_trans_module *m)\n{\n\tif (m)\n\t\tmodule_put(m->owner);\n}\n\n \nstatic int __init init_p9(void)\n{\n\tint ret;\n\n\tret = p9_client_init();\n\tif (ret)\n\t\treturn ret;\n\n\tp9_error_init();\n\tpr_info(\"Installing 9P2000 support\\n\");\n\n\treturn ret;\n}\n\n \n\nstatic void __exit exit_p9(void)\n{\n\tpr_info(\"Unloading 9P2000 support\\n\");\n\n\tp9_client_exit();\n}\n\nmodule_init(init_p9)\nmodule_exit(exit_p9)\n\nMODULE_AUTHOR(\"Latchesar Ionkov <lucho@ionkov.net>\");\nMODULE_AUTHOR(\"Eric Van Hensbergen <ericvh@gmail.com>\");\nMODULE_AUTHOR(\"Ron Minnich <rminnich@lanl.gov>\");\nMODULE_LICENSE(\"GPL\");\nMODULE_DESCRIPTION(\"Plan 9 Resource Sharing Support (9P2000)\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}