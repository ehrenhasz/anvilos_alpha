{
  "module_name": "sysctl_net_ipv6.c",
  "hash_id": "d1ddbfb24c08945ca49fb52ed9e035841ff1d5dc54efd0df810a1cebee0693b5",
  "original_prompt": "Ingested from linux-6.6.14/net/ipv6/sysctl_net_ipv6.c",
  "human_readable_source": "\n \n\n#include <linux/mm.h>\n#include <linux/sysctl.h>\n#include <linux/in6.h>\n#include <linux/ipv6.h>\n#include <linux/slab.h>\n#include <linux/export.h>\n#include <net/ndisc.h>\n#include <net/ipv6.h>\n#include <net/addrconf.h>\n#include <net/inet_frag.h>\n#include <net/netevent.h>\n#include <net/ip_fib.h>\n#ifdef CONFIG_NETLABEL\n#include <net/calipso.h>\n#endif\n#include <linux/ioam6.h>\n\nstatic int flowlabel_reflect_max = 0x7;\nstatic int auto_flowlabels_max = IP6_AUTO_FLOW_LABEL_MAX;\nstatic u32 rt6_multipath_hash_fields_all_mask =\n\tFIB_MULTIPATH_HASH_FIELD_ALL_MASK;\nstatic u32 ioam6_id_max = IOAM6_DEFAULT_ID;\nstatic u64 ioam6_id_wide_max = IOAM6_DEFAULT_ID_WIDE;\n\nstatic int proc_rt6_multipath_hash_policy(struct ctl_table *table, int write,\n\t\t\t\t\t  void *buffer, size_t *lenp, loff_t *ppos)\n{\n\tstruct net *net;\n\tint ret;\n\n\tnet = container_of(table->data, struct net,\n\t\t\t   ipv6.sysctl.multipath_hash_policy);\n\tret = proc_dou8vec_minmax(table, write, buffer, lenp, ppos);\n\tif (write && ret == 0)\n\t\tcall_netevent_notifiers(NETEVENT_IPV6_MPATH_HASH_UPDATE, net);\n\n\treturn ret;\n}\n\nstatic int\nproc_rt6_multipath_hash_fields(struct ctl_table *table, int write, void *buffer,\n\t\t\t       size_t *lenp, loff_t *ppos)\n{\n\tstruct net *net;\n\tint ret;\n\n\tnet = container_of(table->data, struct net,\n\t\t\t   ipv6.sysctl.multipath_hash_fields);\n\tret = proc_douintvec_minmax(table, write, buffer, lenp, ppos);\n\tif (write && ret == 0)\n\t\tcall_netevent_notifiers(NETEVENT_IPV6_MPATH_HASH_UPDATE, net);\n\n\treturn ret;\n}\n\nstatic struct ctl_table ipv6_table_template[] = {\n\t{\n\t\t.procname\t= \"bindv6only\",\n\t\t.data\t\t= &init_net.ipv6.sysctl.bindv6only,\n\t\t.maxlen\t\t= sizeof(u8),\n\t\t.mode\t\t= 0644,\n\t\t.proc_handler\t= proc_dou8vec_minmax,\n\t},\n\t{\n\t\t.procname\t= \"anycast_src_echo_reply\",\n\t\t.data\t\t= &init_net.ipv6.sysctl.anycast_src_echo_reply,\n\t\t.maxlen\t\t= sizeof(u8),\n\t\t.mode\t\t= 0644,\n\t\t.proc_handler\t= proc_dou8vec_minmax,\n\t},\n\t{\n\t\t.procname\t= \"flowlabel_consistency\",\n\t\t.data\t\t= &init_net.ipv6.sysctl.flowlabel_consistency,\n\t\t.maxlen\t\t= sizeof(u8),\n\t\t.mode\t\t= 0644,\n\t\t.proc_handler\t= proc_dou8vec_minmax,\n\t},\n\t{\n\t\t.procname\t= \"auto_flowlabels\",\n\t\t.data\t\t= &init_net.ipv6.sysctl.auto_flowlabels,\n\t\t.maxlen\t\t= sizeof(u8),\n\t\t.mode\t\t= 0644,\n\t\t.proc_handler\t= proc_dou8vec_minmax,\n\t\t.extra2\t\t= &auto_flowlabels_max\n\t},\n\t{\n\t\t.procname\t= \"fwmark_reflect\",\n\t\t.data\t\t= &init_net.ipv6.sysctl.fwmark_reflect,\n\t\t.maxlen\t\t= sizeof(u8),\n\t\t.mode\t\t= 0644,\n\t\t.proc_handler\t= proc_dou8vec_minmax,\n\t},\n\t{\n\t\t.procname\t= \"idgen_retries\",\n\t\t.data\t\t= &init_net.ipv6.sysctl.idgen_retries,\n\t\t.maxlen\t\t= sizeof(int),\n\t\t.mode\t\t= 0644,\n\t\t.proc_handler\t= proc_dointvec,\n\t},\n\t{\n\t\t.procname\t= \"idgen_delay\",\n\t\t.data\t\t= &init_net.ipv6.sysctl.idgen_delay,\n\t\t.maxlen\t\t= sizeof(int),\n\t\t.mode\t\t= 0644,\n\t\t.proc_handler\t= proc_dointvec_jiffies,\n\t},\n\t{\n\t\t.procname\t= \"flowlabel_state_ranges\",\n\t\t.data\t\t= &init_net.ipv6.sysctl.flowlabel_state_ranges,\n\t\t.maxlen\t\t= sizeof(u8),\n\t\t.mode\t\t= 0644,\n\t\t.proc_handler\t= proc_dou8vec_minmax,\n\t},\n\t{\n\t\t.procname\t= \"ip_nonlocal_bind\",\n\t\t.data\t\t= &init_net.ipv6.sysctl.ip_nonlocal_bind,\n\t\t.maxlen\t\t= sizeof(u8),\n\t\t.mode\t\t= 0644,\n\t\t.proc_handler\t= proc_dou8vec_minmax,\n\t},\n\t{\n\t\t.procname\t= \"flowlabel_reflect\",\n\t\t.data\t\t= &init_net.ipv6.sysctl.flowlabel_reflect,\n\t\t.maxlen\t\t= sizeof(int),\n\t\t.mode\t\t= 0644,\n\t\t.proc_handler\t= proc_dointvec_minmax,\n\t\t.extra1\t\t= SYSCTL_ZERO,\n\t\t.extra2\t\t= &flowlabel_reflect_max,\n\t},\n\t{\n\t\t.procname\t= \"max_dst_opts_number\",\n\t\t.data\t\t= &init_net.ipv6.sysctl.max_dst_opts_cnt,\n\t\t.maxlen\t\t= sizeof(int),\n\t\t.mode\t\t= 0644,\n\t\t.proc_handler\t= proc_dointvec\n\t},\n\t{\n\t\t.procname\t= \"max_hbh_opts_number\",\n\t\t.data\t\t= &init_net.ipv6.sysctl.max_hbh_opts_cnt,\n\t\t.maxlen\t\t= sizeof(int),\n\t\t.mode\t\t= 0644,\n\t\t.proc_handler\t= proc_dointvec\n\t},\n\t{\n\t\t.procname\t= \"max_dst_opts_length\",\n\t\t.data\t\t= &init_net.ipv6.sysctl.max_dst_opts_len,\n\t\t.maxlen\t\t= sizeof(int),\n\t\t.mode\t\t= 0644,\n\t\t.proc_handler\t= proc_dointvec\n\t},\n\t{\n\t\t.procname\t= \"max_hbh_length\",\n\t\t.data\t\t= &init_net.ipv6.sysctl.max_hbh_opts_len,\n\t\t.maxlen\t\t= sizeof(int),\n\t\t.mode\t\t= 0644,\n\t\t.proc_handler\t= proc_dointvec\n\t},\n\t{\n\t\t.procname\t= \"fib_multipath_hash_policy\",\n\t\t.data\t\t= &init_net.ipv6.sysctl.multipath_hash_policy,\n\t\t.maxlen\t\t= sizeof(u8),\n\t\t.mode\t\t= 0644,\n\t\t.proc_handler   = proc_rt6_multipath_hash_policy,\n\t\t.extra1\t\t= SYSCTL_ZERO,\n\t\t.extra2\t\t= SYSCTL_THREE,\n\t},\n\t{\n\t\t.procname\t= \"fib_multipath_hash_fields\",\n\t\t.data\t\t= &init_net.ipv6.sysctl.multipath_hash_fields,\n\t\t.maxlen\t\t= sizeof(u32),\n\t\t.mode\t\t= 0644,\n\t\t.proc_handler\t= proc_rt6_multipath_hash_fields,\n\t\t.extra1\t\t= SYSCTL_ONE,\n\t\t.extra2\t\t= &rt6_multipath_hash_fields_all_mask,\n\t},\n\t{\n\t\t.procname\t= \"seg6_flowlabel\",\n\t\t.data\t\t= &init_net.ipv6.sysctl.seg6_flowlabel,\n\t\t.maxlen\t\t= sizeof(int),\n\t\t.mode\t\t= 0644,\n\t\t.proc_handler\t= proc_dointvec\n\t},\n\t{\n\t\t.procname\t= \"fib_notify_on_flag_change\",\n\t\t.data\t\t= &init_net.ipv6.sysctl.fib_notify_on_flag_change,\n\t\t.maxlen\t\t= sizeof(u8),\n\t\t.mode\t\t= 0644,\n\t\t.proc_handler\t= proc_dou8vec_minmax,\n\t\t.extra1         = SYSCTL_ZERO,\n\t\t.extra2         = SYSCTL_TWO,\n\t},\n\t{\n\t\t.procname\t= \"ioam6_id\",\n\t\t.data\t\t= &init_net.ipv6.sysctl.ioam6_id,\n\t\t.maxlen\t\t= sizeof(u32),\n\t\t.mode\t\t= 0644,\n\t\t.proc_handler\t= proc_douintvec_minmax,\n\t\t.extra2\t\t= &ioam6_id_max,\n\t},\n\t{\n\t\t.procname\t= \"ioam6_id_wide\",\n\t\t.data\t\t= &init_net.ipv6.sysctl.ioam6_id_wide,\n\t\t.maxlen\t\t= sizeof(u64),\n\t\t.mode\t\t= 0644,\n\t\t.proc_handler\t= proc_doulongvec_minmax,\n\t\t.extra2\t\t= &ioam6_id_wide_max,\n\t},\n\t{ }\n};\n\nstatic struct ctl_table ipv6_rotable[] = {\n\t{\n\t\t.procname\t= \"mld_max_msf\",\n\t\t.data\t\t= &sysctl_mld_max_msf,\n\t\t.maxlen\t\t= sizeof(int),\n\t\t.mode\t\t= 0644,\n\t\t.proc_handler\t= proc_dointvec\n\t},\n\t{\n\t\t.procname\t= \"mld_qrv\",\n\t\t.data\t\t= &sysctl_mld_qrv,\n\t\t.maxlen\t\t= sizeof(int),\n\t\t.mode\t\t= 0644,\n\t\t.proc_handler\t= proc_dointvec_minmax,\n\t\t.extra1\t\t= SYSCTL_ONE\n\t},\n#ifdef CONFIG_NETLABEL\n\t{\n\t\t.procname\t= \"calipso_cache_enable\",\n\t\t.data\t\t= &calipso_cache_enabled,\n\t\t.maxlen\t\t= sizeof(int),\n\t\t.mode\t\t= 0644,\n\t\t.proc_handler\t= proc_dointvec,\n\t},\n\t{\n\t\t.procname\t= \"calipso_cache_bucket_size\",\n\t\t.data\t\t= &calipso_cache_bucketsize,\n\t\t.maxlen\t\t= sizeof(int),\n\t\t.mode\t\t= 0644,\n\t\t.proc_handler\t= proc_dointvec,\n\t},\n#endif  \n\t{ }\n};\n\nstatic int __net_init ipv6_sysctl_net_init(struct net *net)\n{\n\tstruct ctl_table *ipv6_table;\n\tstruct ctl_table *ipv6_route_table;\n\tstruct ctl_table *ipv6_icmp_table;\n\tint err, i;\n\n\terr = -ENOMEM;\n\tipv6_table = kmemdup(ipv6_table_template, sizeof(ipv6_table_template),\n\t\t\t     GFP_KERNEL);\n\tif (!ipv6_table)\n\t\tgoto out;\n\t \n\tfor (i = 0; i < ARRAY_SIZE(ipv6_table_template) - 1; i++)\n\t\tipv6_table[i].data += (void *)net - (void *)&init_net;\n\n\tipv6_route_table = ipv6_route_sysctl_init(net);\n\tif (!ipv6_route_table)\n\t\tgoto out_ipv6_table;\n\n\tipv6_icmp_table = ipv6_icmp_sysctl_init(net);\n\tif (!ipv6_icmp_table)\n\t\tgoto out_ipv6_route_table;\n\n\tnet->ipv6.sysctl.hdr = register_net_sysctl_sz(net, \"net/ipv6\",\n\t\t\t\t\t\t      ipv6_table,\n\t\t\t\t\t\t      ARRAY_SIZE(ipv6_table_template));\n\tif (!net->ipv6.sysctl.hdr)\n\t\tgoto out_ipv6_icmp_table;\n\n\tnet->ipv6.sysctl.route_hdr = register_net_sysctl_sz(net,\n\t\t\t\t\t\t\t    \"net/ipv6/route\",\n\t\t\t\t\t\t\t    ipv6_route_table,\n\t\t\t\t\t\t\t    ipv6_route_sysctl_table_size(net));\n\tif (!net->ipv6.sysctl.route_hdr)\n\t\tgoto out_unregister_ipv6_table;\n\n\tnet->ipv6.sysctl.icmp_hdr = register_net_sysctl_sz(net,\n\t\t\t\t\t\t\t   \"net/ipv6/icmp\",\n\t\t\t\t\t\t\t   ipv6_icmp_table,\n\t\t\t\t\t\t\t   ipv6_icmp_sysctl_table_size());\n\tif (!net->ipv6.sysctl.icmp_hdr)\n\t\tgoto out_unregister_route_table;\n\n\terr = 0;\nout:\n\treturn err;\nout_unregister_route_table:\n\tunregister_net_sysctl_table(net->ipv6.sysctl.route_hdr);\nout_unregister_ipv6_table:\n\tunregister_net_sysctl_table(net->ipv6.sysctl.hdr);\nout_ipv6_icmp_table:\n\tkfree(ipv6_icmp_table);\nout_ipv6_route_table:\n\tkfree(ipv6_route_table);\nout_ipv6_table:\n\tkfree(ipv6_table);\n\tgoto out;\n}\n\nstatic void __net_exit ipv6_sysctl_net_exit(struct net *net)\n{\n\tstruct ctl_table *ipv6_table;\n\tstruct ctl_table *ipv6_route_table;\n\tstruct ctl_table *ipv6_icmp_table;\n\n\tipv6_table = net->ipv6.sysctl.hdr->ctl_table_arg;\n\tipv6_route_table = net->ipv6.sysctl.route_hdr->ctl_table_arg;\n\tipv6_icmp_table = net->ipv6.sysctl.icmp_hdr->ctl_table_arg;\n\n\tunregister_net_sysctl_table(net->ipv6.sysctl.icmp_hdr);\n\tunregister_net_sysctl_table(net->ipv6.sysctl.route_hdr);\n\tunregister_net_sysctl_table(net->ipv6.sysctl.hdr);\n\n\tkfree(ipv6_table);\n\tkfree(ipv6_route_table);\n\tkfree(ipv6_icmp_table);\n}\n\nstatic struct pernet_operations ipv6_sysctl_net_ops = {\n\t.init = ipv6_sysctl_net_init,\n\t.exit = ipv6_sysctl_net_exit,\n};\n\nstatic struct ctl_table_header *ip6_header;\n\nint ipv6_sysctl_register(void)\n{\n\tint err = -ENOMEM;\n\n\tip6_header = register_net_sysctl(&init_net, \"net/ipv6\", ipv6_rotable);\n\tif (!ip6_header)\n\t\tgoto out;\n\n\terr = register_pernet_subsys(&ipv6_sysctl_net_ops);\n\tif (err)\n\t\tgoto err_pernet;\nout:\n\treturn err;\n\nerr_pernet:\n\tunregister_net_sysctl_table(ip6_header);\n\tgoto out;\n}\n\nvoid ipv6_sysctl_unregister(void)\n{\n\tunregister_net_sysctl_table(ip6_header);\n\tunregister_pernet_subsys(&ipv6_sysctl_net_ops);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}