{
  "module_name": "proc.c",
  "hash_id": "c94f789f118d5f2ec9285ff188386ec437f5964cfa471ca58bac804509b34733",
  "original_prompt": "Ingested from linux-6.6.14/net/ipv6/proc.c",
  "human_readable_source": "\n \n#include <linux/socket.h>\n#include <linux/net.h>\n#include <linux/ipv6.h>\n#include <linux/proc_fs.h>\n#include <linux/seq_file.h>\n#include <linux/stddef.h>\n#include <linux/export.h>\n#include <net/net_namespace.h>\n#include <net/ip.h>\n#include <net/sock.h>\n#include <net/tcp.h>\n#include <net/udp.h>\n#include <net/transp_v6.h>\n#include <net/ipv6.h>\n\n#define MAX4(a, b, c, d) \\\n\tmax_t(u32, max_t(u32, a, b), max_t(u32, c, d))\n#define SNMP_MIB_MAX MAX4(UDP_MIB_MAX, TCP_MIB_MAX, \\\n\t\t\tIPSTATS_MIB_MAX, ICMP_MIB_MAX)\n\nstatic int sockstat6_seq_show(struct seq_file *seq, void *v)\n{\n\tstruct net *net = seq->private;\n\n\tseq_printf(seq, \"TCP6: inuse %d\\n\",\n\t\t       sock_prot_inuse_get(net, &tcpv6_prot));\n\tseq_printf(seq, \"UDP6: inuse %d\\n\",\n\t\t       sock_prot_inuse_get(net, &udpv6_prot));\n\tseq_printf(seq, \"UDPLITE6: inuse %d\\n\",\n\t\t\tsock_prot_inuse_get(net, &udplitev6_prot));\n\tseq_printf(seq, \"RAW6: inuse %d\\n\",\n\t\t       sock_prot_inuse_get(net, &rawv6_prot));\n\tseq_printf(seq, \"FRAG6: inuse %u memory %lu\\n\",\n\t\t   atomic_read(&net->ipv6.fqdir->rhashtable.nelems),\n\t\t   frag_mem_limit(net->ipv6.fqdir));\n\treturn 0;\n}\n\nstatic const struct snmp_mib snmp6_ipstats_list[] = {\n \n\tSNMP_MIB_ITEM(\"Ip6InReceives\", IPSTATS_MIB_INPKTS),\n\tSNMP_MIB_ITEM(\"Ip6InHdrErrors\", IPSTATS_MIB_INHDRERRORS),\n\tSNMP_MIB_ITEM(\"Ip6InTooBigErrors\", IPSTATS_MIB_INTOOBIGERRORS),\n\tSNMP_MIB_ITEM(\"Ip6InNoRoutes\", IPSTATS_MIB_INNOROUTES),\n\tSNMP_MIB_ITEM(\"Ip6InAddrErrors\", IPSTATS_MIB_INADDRERRORS),\n\tSNMP_MIB_ITEM(\"Ip6InUnknownProtos\", IPSTATS_MIB_INUNKNOWNPROTOS),\n\tSNMP_MIB_ITEM(\"Ip6InTruncatedPkts\", IPSTATS_MIB_INTRUNCATEDPKTS),\n\tSNMP_MIB_ITEM(\"Ip6InDiscards\", IPSTATS_MIB_INDISCARDS),\n\tSNMP_MIB_ITEM(\"Ip6InDelivers\", IPSTATS_MIB_INDELIVERS),\n\tSNMP_MIB_ITEM(\"Ip6OutForwDatagrams\", IPSTATS_MIB_OUTFORWDATAGRAMS),\n\tSNMP_MIB_ITEM(\"Ip6OutRequests\", IPSTATS_MIB_OUTPKTS),\n\tSNMP_MIB_ITEM(\"Ip6OutDiscards\", IPSTATS_MIB_OUTDISCARDS),\n\tSNMP_MIB_ITEM(\"Ip6OutNoRoutes\", IPSTATS_MIB_OUTNOROUTES),\n\tSNMP_MIB_ITEM(\"Ip6ReasmTimeout\", IPSTATS_MIB_REASMTIMEOUT),\n\tSNMP_MIB_ITEM(\"Ip6ReasmReqds\", IPSTATS_MIB_REASMREQDS),\n\tSNMP_MIB_ITEM(\"Ip6ReasmOKs\", IPSTATS_MIB_REASMOKS),\n\tSNMP_MIB_ITEM(\"Ip6ReasmFails\", IPSTATS_MIB_REASMFAILS),\n\tSNMP_MIB_ITEM(\"Ip6FragOKs\", IPSTATS_MIB_FRAGOKS),\n\tSNMP_MIB_ITEM(\"Ip6FragFails\", IPSTATS_MIB_FRAGFAILS),\n\tSNMP_MIB_ITEM(\"Ip6FragCreates\", IPSTATS_MIB_FRAGCREATES),\n\tSNMP_MIB_ITEM(\"Ip6InMcastPkts\", IPSTATS_MIB_INMCASTPKTS),\n\tSNMP_MIB_ITEM(\"Ip6OutMcastPkts\", IPSTATS_MIB_OUTMCASTPKTS),\n\tSNMP_MIB_ITEM(\"Ip6InOctets\", IPSTATS_MIB_INOCTETS),\n\tSNMP_MIB_ITEM(\"Ip6OutOctets\", IPSTATS_MIB_OUTOCTETS),\n\tSNMP_MIB_ITEM(\"Ip6InMcastOctets\", IPSTATS_MIB_INMCASTOCTETS),\n\tSNMP_MIB_ITEM(\"Ip6OutMcastOctets\", IPSTATS_MIB_OUTMCASTOCTETS),\n\tSNMP_MIB_ITEM(\"Ip6InBcastOctets\", IPSTATS_MIB_INBCASTOCTETS),\n\tSNMP_MIB_ITEM(\"Ip6OutBcastOctets\", IPSTATS_MIB_OUTBCASTOCTETS),\n\t \n\tSNMP_MIB_ITEM(\"Ip6InNoECTPkts\", IPSTATS_MIB_NOECTPKTS),\n\tSNMP_MIB_ITEM(\"Ip6InECT1Pkts\", IPSTATS_MIB_ECT1PKTS),\n\tSNMP_MIB_ITEM(\"Ip6InECT0Pkts\", IPSTATS_MIB_ECT0PKTS),\n\tSNMP_MIB_ITEM(\"Ip6InCEPkts\", IPSTATS_MIB_CEPKTS),\n\tSNMP_MIB_SENTINEL\n};\n\nstatic const struct snmp_mib snmp6_icmp6_list[] = {\n \n\tSNMP_MIB_ITEM(\"Icmp6InMsgs\", ICMP6_MIB_INMSGS),\n\tSNMP_MIB_ITEM(\"Icmp6InErrors\", ICMP6_MIB_INERRORS),\n\tSNMP_MIB_ITEM(\"Icmp6OutMsgs\", ICMP6_MIB_OUTMSGS),\n\tSNMP_MIB_ITEM(\"Icmp6OutErrors\", ICMP6_MIB_OUTERRORS),\n\tSNMP_MIB_ITEM(\"Icmp6InCsumErrors\", ICMP6_MIB_CSUMERRORS),\n\tSNMP_MIB_ITEM(\"Icmp6OutRateLimitHost\", ICMP6_MIB_RATELIMITHOST),\n\tSNMP_MIB_SENTINEL\n};\n\n \nstatic const char *const icmp6type2name[256] = {\n\t[ICMPV6_DEST_UNREACH] = \"DestUnreachs\",\n\t[ICMPV6_PKT_TOOBIG] = \"PktTooBigs\",\n\t[ICMPV6_TIME_EXCEED] = \"TimeExcds\",\n\t[ICMPV6_PARAMPROB] = \"ParmProblems\",\n\t[ICMPV6_ECHO_REQUEST] = \"Echos\",\n\t[ICMPV6_ECHO_REPLY] = \"EchoReplies\",\n\t[ICMPV6_MGM_QUERY] = \"GroupMembQueries\",\n\t[ICMPV6_MGM_REPORT] = \"GroupMembResponses\",\n\t[ICMPV6_MGM_REDUCTION] = \"GroupMembReductions\",\n\t[ICMPV6_MLD2_REPORT] = \"MLDv2Reports\",\n\t[NDISC_ROUTER_ADVERTISEMENT] = \"RouterAdvertisements\",\n\t[NDISC_ROUTER_SOLICITATION] = \"RouterSolicits\",\n\t[NDISC_NEIGHBOUR_ADVERTISEMENT] = \"NeighborAdvertisements\",\n\t[NDISC_NEIGHBOUR_SOLICITATION] = \"NeighborSolicits\",\n\t[NDISC_REDIRECT] = \"Redirects\",\n};\n\n\nstatic const struct snmp_mib snmp6_udp6_list[] = {\n\tSNMP_MIB_ITEM(\"Udp6InDatagrams\", UDP_MIB_INDATAGRAMS),\n\tSNMP_MIB_ITEM(\"Udp6NoPorts\", UDP_MIB_NOPORTS),\n\tSNMP_MIB_ITEM(\"Udp6InErrors\", UDP_MIB_INERRORS),\n\tSNMP_MIB_ITEM(\"Udp6OutDatagrams\", UDP_MIB_OUTDATAGRAMS),\n\tSNMP_MIB_ITEM(\"Udp6RcvbufErrors\", UDP_MIB_RCVBUFERRORS),\n\tSNMP_MIB_ITEM(\"Udp6SndbufErrors\", UDP_MIB_SNDBUFERRORS),\n\tSNMP_MIB_ITEM(\"Udp6InCsumErrors\", UDP_MIB_CSUMERRORS),\n\tSNMP_MIB_ITEM(\"Udp6IgnoredMulti\", UDP_MIB_IGNOREDMULTI),\n\tSNMP_MIB_ITEM(\"Udp6MemErrors\", UDP_MIB_MEMERRORS),\n\tSNMP_MIB_SENTINEL\n};\n\nstatic const struct snmp_mib snmp6_udplite6_list[] = {\n\tSNMP_MIB_ITEM(\"UdpLite6InDatagrams\", UDP_MIB_INDATAGRAMS),\n\tSNMP_MIB_ITEM(\"UdpLite6NoPorts\", UDP_MIB_NOPORTS),\n\tSNMP_MIB_ITEM(\"UdpLite6InErrors\", UDP_MIB_INERRORS),\n\tSNMP_MIB_ITEM(\"UdpLite6OutDatagrams\", UDP_MIB_OUTDATAGRAMS),\n\tSNMP_MIB_ITEM(\"UdpLite6RcvbufErrors\", UDP_MIB_RCVBUFERRORS),\n\tSNMP_MIB_ITEM(\"UdpLite6SndbufErrors\", UDP_MIB_SNDBUFERRORS),\n\tSNMP_MIB_ITEM(\"UdpLite6InCsumErrors\", UDP_MIB_CSUMERRORS),\n\tSNMP_MIB_ITEM(\"UdpLite6MemErrors\", UDP_MIB_MEMERRORS),\n\tSNMP_MIB_SENTINEL\n};\n\nstatic void snmp6_seq_show_icmpv6msg(struct seq_file *seq, atomic_long_t *smib)\n{\n\tchar name[32];\n\tint i;\n\n\t \n\tfor (i = 0; i < ICMP6MSG_MIB_MAX; i++) {\n\t\tint icmptype;\n\t\tconst char *p;\n\n\t\ticmptype = i & 0xff;\n\t\tp = icmp6type2name[icmptype];\n\t\tif (!p)\t \n\t\t\tcontinue;\n\t\tsnprintf(name, sizeof(name), \"Icmp6%s%s\",\n\t\t\ti & 0x100 ? \"Out\" : \"In\", p);\n\t\tseq_printf(seq, \"%-32s\\t%lu\\n\", name,\n\t\t\t   atomic_long_read(smib + i));\n\t}\n\n\t \n\tfor (i = 0; i < ICMP6MSG_MIB_MAX; i++) {\n\t\tunsigned long val;\n\n\t\tval = atomic_long_read(smib + i);\n\t\tif (!val)\n\t\t\tcontinue;\n\t\tsnprintf(name, sizeof(name), \"Icmp6%sType%u\",\n\t\t\ti & 0x100 ?  \"Out\" : \"In\", i & 0xff);\n\t\tseq_printf(seq, \"%-32s\\t%lu\\n\", name, val);\n\t}\n}\n\n \nstatic void snmp6_seq_show_item(struct seq_file *seq, void __percpu *pcpumib,\n\t\t\t\tatomic_long_t *smib,\n\t\t\t\tconst struct snmp_mib *itemlist)\n{\n\tunsigned long buff[SNMP_MIB_MAX];\n\tint i;\n\n\tif (pcpumib) {\n\t\tmemset(buff, 0, sizeof(unsigned long) * SNMP_MIB_MAX);\n\n\t\tsnmp_get_cpu_field_batch(buff, itemlist, pcpumib);\n\t\tfor (i = 0; itemlist[i].name; i++)\n\t\t\tseq_printf(seq, \"%-32s\\t%lu\\n\",\n\t\t\t\t   itemlist[i].name, buff[i]);\n\t} else {\n\t\tfor (i = 0; itemlist[i].name; i++)\n\t\t\tseq_printf(seq, \"%-32s\\t%lu\\n\", itemlist[i].name,\n\t\t\t\t   atomic_long_read(smib + itemlist[i].entry));\n\t}\n}\n\nstatic void snmp6_seq_show_item64(struct seq_file *seq, void __percpu *mib,\n\t\t\t\t  const struct snmp_mib *itemlist, size_t syncpoff)\n{\n\tu64 buff64[SNMP_MIB_MAX];\n\tint i;\n\n\tmemset(buff64, 0, sizeof(u64) * SNMP_MIB_MAX);\n\n\tsnmp_get_cpu_field64_batch(buff64, itemlist, mib, syncpoff);\n\tfor (i = 0; itemlist[i].name; i++)\n\t\tseq_printf(seq, \"%-32s\\t%llu\\n\", itemlist[i].name, buff64[i]);\n}\n\nstatic int snmp6_seq_show(struct seq_file *seq, void *v)\n{\n\tstruct net *net = (struct net *)seq->private;\n\n\tsnmp6_seq_show_item64(seq, net->mib.ipv6_statistics,\n\t\t\t    snmp6_ipstats_list, offsetof(struct ipstats_mib, syncp));\n\tsnmp6_seq_show_item(seq, net->mib.icmpv6_statistics,\n\t\t\t    NULL, snmp6_icmp6_list);\n\tsnmp6_seq_show_icmpv6msg(seq, net->mib.icmpv6msg_statistics->mibs);\n\tsnmp6_seq_show_item(seq, net->mib.udp_stats_in6,\n\t\t\t    NULL, snmp6_udp6_list);\n\tsnmp6_seq_show_item(seq, net->mib.udplite_stats_in6,\n\t\t\t    NULL, snmp6_udplite6_list);\n\treturn 0;\n}\n\nstatic int snmp6_dev_seq_show(struct seq_file *seq, void *v)\n{\n\tstruct inet6_dev *idev = (struct inet6_dev *)seq->private;\n\n\tseq_printf(seq, \"%-32s\\t%u\\n\", \"ifIndex\", idev->dev->ifindex);\n\tsnmp6_seq_show_item64(seq, idev->stats.ipv6,\n\t\t\t    snmp6_ipstats_list, offsetof(struct ipstats_mib, syncp));\n\tsnmp6_seq_show_item(seq, NULL, idev->stats.icmpv6dev->mibs,\n\t\t\t    snmp6_icmp6_list);\n\tsnmp6_seq_show_icmpv6msg(seq, idev->stats.icmpv6msgdev->mibs);\n\treturn 0;\n}\n\nint snmp6_register_dev(struct inet6_dev *idev)\n{\n\tstruct proc_dir_entry *p;\n\tstruct net *net;\n\n\tif (!idev || !idev->dev)\n\t\treturn -EINVAL;\n\n\tnet = dev_net(idev->dev);\n\tif (!net->mib.proc_net_devsnmp6)\n\t\treturn -ENOENT;\n\n\tp = proc_create_single_data(idev->dev->name, 0444,\n\t\t\tnet->mib.proc_net_devsnmp6, snmp6_dev_seq_show, idev);\n\tif (!p)\n\t\treturn -ENOMEM;\n\n\tidev->stats.proc_dir_entry = p;\n\treturn 0;\n}\n\nint snmp6_unregister_dev(struct inet6_dev *idev)\n{\n\tstruct net *net = dev_net(idev->dev);\n\tif (!net->mib.proc_net_devsnmp6)\n\t\treturn -ENOENT;\n\tif (!idev->stats.proc_dir_entry)\n\t\treturn -EINVAL;\n\tproc_remove(idev->stats.proc_dir_entry);\n\tidev->stats.proc_dir_entry = NULL;\n\treturn 0;\n}\n\nstatic int __net_init ipv6_proc_init_net(struct net *net)\n{\n\tif (!proc_create_net_single(\"sockstat6\", 0444, net->proc_net,\n\t\t\tsockstat6_seq_show, NULL))\n\t\treturn -ENOMEM;\n\n\tif (!proc_create_net_single(\"snmp6\", 0444, net->proc_net,\n\t\t\tsnmp6_seq_show, NULL))\n\t\tgoto proc_snmp6_fail;\n\n\tnet->mib.proc_net_devsnmp6 = proc_mkdir(\"dev_snmp6\", net->proc_net);\n\tif (!net->mib.proc_net_devsnmp6)\n\t\tgoto proc_dev_snmp6_fail;\n\treturn 0;\n\nproc_dev_snmp6_fail:\n\tremove_proc_entry(\"snmp6\", net->proc_net);\nproc_snmp6_fail:\n\tremove_proc_entry(\"sockstat6\", net->proc_net);\n\treturn -ENOMEM;\n}\n\nstatic void __net_exit ipv6_proc_exit_net(struct net *net)\n{\n\tremove_proc_entry(\"sockstat6\", net->proc_net);\n\tremove_proc_entry(\"dev_snmp6\", net->proc_net);\n\tremove_proc_entry(\"snmp6\", net->proc_net);\n}\n\nstatic struct pernet_operations ipv6_proc_ops = {\n\t.init = ipv6_proc_init_net,\n\t.exit = ipv6_proc_exit_net,\n};\n\nint __init ipv6_misc_proc_init(void)\n{\n\treturn register_pernet_subsys(&ipv6_proc_ops);\n}\n\nvoid ipv6_misc_proc_exit(void)\n{\n\tunregister_pernet_subsys(&ipv6_proc_ops);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}