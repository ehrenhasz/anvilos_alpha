{
  "module_name": "ip6table_filter.c",
  "hash_id": "04d5a4827fbb492118f6034c06162ea9b94671131c38a82e3b37bfae6a2ae431",
  "original_prompt": "Ingested from linux-6.6.14/net/ipv6/netfilter/ip6table_filter.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/moduleparam.h>\n#include <linux/netfilter_ipv6/ip6_tables.h>\n#include <linux/slab.h>\n\nMODULE_LICENSE(\"GPL\");\nMODULE_AUTHOR(\"Netfilter Core Team <coreteam@netfilter.org>\");\nMODULE_DESCRIPTION(\"ip6tables filter table\");\n\n#define FILTER_VALID_HOOKS ((1 << NF_INET_LOCAL_IN) | \\\n\t\t\t    (1 << NF_INET_FORWARD) | \\\n\t\t\t    (1 << NF_INET_LOCAL_OUT))\n\nstatic const struct xt_table packet_filter = {\n\t.name\t\t= \"filter\",\n\t.valid_hooks\t= FILTER_VALID_HOOKS,\n\t.me\t\t= THIS_MODULE,\n\t.af\t\t= NFPROTO_IPV6,\n\t.priority\t= NF_IP6_PRI_FILTER,\n};\n\nstatic struct nf_hook_ops *filter_ops __read_mostly;\n\n \nstatic bool forward = true;\nmodule_param(forward, bool, 0000);\n\nstatic int ip6table_filter_table_init(struct net *net)\n{\n\tstruct ip6t_replace *repl;\n\tint err;\n\n\trepl = ip6t_alloc_initial_table(&packet_filter);\n\tif (repl == NULL)\n\t\treturn -ENOMEM;\n\t \n\t((struct ip6t_standard *)repl->entries)[1].target.verdict =\n\t\tforward ? -NF_ACCEPT - 1 : -NF_DROP - 1;\n\n\terr = ip6t_register_table(net, &packet_filter, repl, filter_ops);\n\tkfree(repl);\n\treturn err;\n}\n\nstatic int __net_init ip6table_filter_net_init(struct net *net)\n{\n\tif (!forward)\n\t\treturn ip6table_filter_table_init(net);\n\n\treturn 0;\n}\n\nstatic void __net_exit ip6table_filter_net_pre_exit(struct net *net)\n{\n\tip6t_unregister_table_pre_exit(net, \"filter\");\n}\n\nstatic void __net_exit ip6table_filter_net_exit(struct net *net)\n{\n\tip6t_unregister_table_exit(net, \"filter\");\n}\n\nstatic struct pernet_operations ip6table_filter_net_ops = {\n\t.init = ip6table_filter_net_init,\n\t.pre_exit = ip6table_filter_net_pre_exit,\n\t.exit = ip6table_filter_net_exit,\n};\n\nstatic int __init ip6table_filter_init(void)\n{\n\tint ret = xt_register_template(&packet_filter,\n\t\t\t\t\tip6table_filter_table_init);\n\n\tif (ret < 0)\n\t\treturn ret;\n\n\tfilter_ops = xt_hook_ops_alloc(&packet_filter, ip6t_do_table);\n\tif (IS_ERR(filter_ops)) {\n\t\txt_unregister_template(&packet_filter);\n\t\treturn PTR_ERR(filter_ops);\n\t}\n\n\tret = register_pernet_subsys(&ip6table_filter_net_ops);\n\tif (ret < 0) {\n\t\txt_unregister_template(&packet_filter);\n\t\tkfree(filter_ops);\n\t\treturn ret;\n\t}\n\n\treturn ret;\n}\n\nstatic void __exit ip6table_filter_fini(void)\n{\n\tunregister_pernet_subsys(&ip6table_filter_net_ops);\n\txt_unregister_template(&packet_filter);\n\tkfree(filter_ops);\n}\n\nmodule_init(ip6table_filter_init);\nmodule_exit(ip6table_filter_fini);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}