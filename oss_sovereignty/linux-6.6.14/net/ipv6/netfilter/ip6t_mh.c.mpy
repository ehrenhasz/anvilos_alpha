{
  "module_name": "ip6t_mh.c",
  "hash_id": "44ca8ce844d46ea00d9ad8b3510da1fee347a51fde25f411a09b431fedff69ec",
  "original_prompt": "Ingested from linux-6.6.14/net/ipv6/netfilter/ip6t_mh.c",
  "human_readable_source": "\n \n#define pr_fmt(fmt) KBUILD_MODNAME \": \" fmt\n#include <linux/types.h>\n#include <linux/module.h>\n#include <net/ip.h>\n#include <linux/ipv6.h>\n#include <net/ipv6.h>\n#include <net/mip6.h>\n\n#include <linux/netfilter/x_tables.h>\n#include <linux/netfilter_ipv6/ip6t_mh.h>\n\nMODULE_DESCRIPTION(\"Xtables: IPv6 Mobility Header match\");\nMODULE_LICENSE(\"GPL\");\n\n \nstatic inline bool\ntype_match(u_int8_t min, u_int8_t max, u_int8_t type, bool invert)\n{\n\treturn (type >= min && type <= max) ^ invert;\n}\n\nstatic bool mh_mt6(const struct sk_buff *skb, struct xt_action_param *par)\n{\n\tstruct ip6_mh _mh;\n\tconst struct ip6_mh *mh;\n\tconst struct ip6t_mh *mhinfo = par->matchinfo;\n\n\t \n\tif (par->fragoff != 0)\n\t\treturn false;\n\n\tmh = skb_header_pointer(skb, par->thoff, sizeof(_mh), &_mh);\n\tif (mh == NULL) {\n\t\t \n\t\tpr_debug(\"Dropping evil MH tinygram.\\n\");\n\t\tpar->hotdrop = true;\n\t\treturn false;\n\t}\n\n\tif (mh->ip6mh_proto != IPPROTO_NONE) {\n\t\tpr_debug(\"Dropping invalid MH Payload Proto: %u\\n\",\n\t\t\t mh->ip6mh_proto);\n\t\tpar->hotdrop = true;\n\t\treturn false;\n\t}\n\n\treturn type_match(mhinfo->types[0], mhinfo->types[1], mh->ip6mh_type,\n\t\t\t  !!(mhinfo->invflags & IP6T_MH_INV_TYPE));\n}\n\nstatic int mh_mt6_check(const struct xt_mtchk_param *par)\n{\n\tconst struct ip6t_mh *mhinfo = par->matchinfo;\n\n\t \n\treturn (mhinfo->invflags & ~IP6T_MH_INV_MASK) ? -EINVAL : 0;\n}\n\nstatic struct xt_match mh_mt6_reg __read_mostly = {\n\t.name\t\t= \"mh\",\n\t.family\t\t= NFPROTO_IPV6,\n\t.checkentry\t= mh_mt6_check,\n\t.match\t\t= mh_mt6,\n\t.matchsize\t= sizeof(struct ip6t_mh),\n\t.proto\t\t= IPPROTO_MH,\n\t.me\t\t= THIS_MODULE,\n};\n\nstatic int __init mh_mt6_init(void)\n{\n\treturn xt_register_match(&mh_mt6_reg);\n}\n\nstatic void __exit mh_mt6_exit(void)\n{\n\txt_unregister_match(&mh_mt6_reg);\n}\n\nmodule_init(mh_mt6_init);\nmodule_exit(mh_mt6_exit);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}