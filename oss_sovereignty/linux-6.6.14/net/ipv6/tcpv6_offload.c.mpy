{
  "module_name": "tcpv6_offload.c",
  "hash_id": "7df2ec65b946922433ec3b24b5513918c2edfa78102503546222483bd3dbea8f",
  "original_prompt": "Ingested from linux-6.6.14/net/ipv6/tcpv6_offload.c",
  "human_readable_source": "\n \n#include <linux/indirect_call_wrapper.h>\n#include <linux/skbuff.h>\n#include <net/gro.h>\n#include <net/protocol.h>\n#include <net/tcp.h>\n#include <net/ip6_checksum.h>\n#include \"ip6_offload.h\"\n\nINDIRECT_CALLABLE_SCOPE\nstruct sk_buff *tcp6_gro_receive(struct list_head *head, struct sk_buff *skb)\n{\n\t \n\tif (!NAPI_GRO_CB(skb)->flush &&\n\t    skb_gro_checksum_validate(skb, IPPROTO_TCP,\n\t\t\t\t      ip6_gro_compute_pseudo)) {\n\t\tNAPI_GRO_CB(skb)->flush = 1;\n\t\treturn NULL;\n\t}\n\n\treturn tcp_gro_receive(head, skb);\n}\n\nINDIRECT_CALLABLE_SCOPE int tcp6_gro_complete(struct sk_buff *skb, int thoff)\n{\n\tconst struct ipv6hdr *iph = ipv6_hdr(skb);\n\tstruct tcphdr *th = tcp_hdr(skb);\n\n\tth->check = ~tcp_v6_check(skb->len - thoff, &iph->saddr,\n\t\t\t\t  &iph->daddr, 0);\n\tskb_shinfo(skb)->gso_type |= SKB_GSO_TCPV6;\n\n\ttcp_gro_complete(skb);\n\treturn 0;\n}\n\nstatic struct sk_buff *tcp6_gso_segment(struct sk_buff *skb,\n\t\t\t\t\tnetdev_features_t features)\n{\n\tstruct tcphdr *th;\n\n\tif (!(skb_shinfo(skb)->gso_type & SKB_GSO_TCPV6))\n\t\treturn ERR_PTR(-EINVAL);\n\n\tif (!pskb_may_pull(skb, sizeof(*th)))\n\t\treturn ERR_PTR(-EINVAL);\n\n\tif (unlikely(skb->ip_summed != CHECKSUM_PARTIAL)) {\n\t\tconst struct ipv6hdr *ipv6h = ipv6_hdr(skb);\n\t\tstruct tcphdr *th = tcp_hdr(skb);\n\n\t\t \n\n\t\tth->check = 0;\n\t\tskb->ip_summed = CHECKSUM_PARTIAL;\n\t\t__tcp_v6_send_check(skb, &ipv6h->saddr, &ipv6h->daddr);\n\t}\n\n\treturn tcp_gso_segment(skb, features);\n}\nstatic const struct net_offload tcpv6_offload = {\n\t.callbacks = {\n\t\t.gso_segment\t=\ttcp6_gso_segment,\n\t\t.gro_receive\t=\ttcp6_gro_receive,\n\t\t.gro_complete\t=\ttcp6_gro_complete,\n\t},\n};\n\nint __init tcpv6_offload_init(void)\n{\n\treturn inet6_add_offload(&tcpv6_offload, IPPROTO_TCP);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}