{
  "module_name": "tfrc_equation.c",
  "hash_id": "23d77584885f8df3deaa790a0c8963581449c8e1f483700c4f11a08a9e627f2a",
  "original_prompt": "Ingested from linux-6.6.14/net/dccp/ccids/lib/tfrc_equation.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include \"../../dccp.h\"\n#include \"tfrc.h\"\n\n#define TFRC_CALC_X_ARRSIZE 500\n#define TFRC_CALC_X_SPLIT   50000\t \n#define TFRC_SMALLEST_P\t    (TFRC_CALC_X_SPLIT/TFRC_CALC_X_ARRSIZE)\n\n \nstatic const u32 tfrc_calc_x_lookup[TFRC_CALC_X_ARRSIZE][2] = {\n\t{     37172,   8172 },\n\t{     53499,  11567 },\n\t{     66664,  14180 },\n\t{     78298,  16388 },\n\t{     89021,  18339 },\n\t{     99147,  20108 },\n\t{    108858,  21738 },\n\t{    118273,  23260 },\n\t{    127474,  24693 },\n\t{    136520,  26052 },\n\t{    145456,  27348 },\n\t{    154316,  28589 },\n\t{    163130,  29783 },\n\t{    171919,  30935 },\n\t{    180704,  32049 },\n\t{    189502,  33130 },\n\t{    198328,  34180 },\n\t{    207194,  35202 },\n\t{    216114,  36198 },\n\t{    225097,  37172 },\n\t{    234153,  38123 },\n\t{    243294,  39055 },\n\t{    252527,  39968 },\n\t{    261861,  40864 },\n\t{    271305,  41743 },\n\t{    280866,  42607 },\n\t{    290553,  43457 },\n\t{    300372,  44293 },\n\t{    310333,  45117 },\n\t{    320441,  45929 },\n\t{    330705,  46729 },\n\t{    341131,  47518 },\n\t{    351728,  48297 },\n\t{    362501,  49066 },\n\t{    373460,  49826 },\n\t{    384609,  50577 },\n\t{    395958,  51320 },\n\t{    407513,  52054 },\n\t{    419281,  52780 },\n\t{    431270,  53499 },\n\t{    443487,  54211 },\n\t{    455940,  54916 },\n\t{    468635,  55614 },\n\t{    481581,  56306 },\n\t{    494785,  56991 },\n\t{    508254,  57671 },\n\t{    521996,  58345 },\n\t{    536019,  59014 },\n\t{    550331,  59677 },\n\t{    564939,  60335 },\n\t{    579851,  60988 },\n\t{    595075,  61636 },\n\t{    610619,  62279 },\n\t{    626491,  62918 },\n\t{    642700,  63553 },\n\t{    659253,  64183 },\n\t{    676158,  64809 },\n\t{    693424,  65431 },\n\t{    711060,  66050 },\n\t{    729073,  66664 },\n\t{    747472,  67275 },\n\t{    766266,  67882 },\n\t{    785464,  68486 },\n\t{    805073,  69087 },\n\t{    825103,  69684 },\n\t{    845562,  70278 },\n\t{    866460,  70868 },\n\t{    887805,  71456 },\n\t{    909606,  72041 },\n\t{    931873,  72623 },\n\t{    954614,  73202 },\n\t{    977839,  73778 },\n\t{   1001557,  74352 },\n\t{   1025777,  74923 },\n\t{   1050508,  75492 },\n\t{   1075761,  76058 },\n\t{   1101544,  76621 },\n\t{   1127867,  77183 },\n\t{   1154739,  77741 },\n\t{   1182172,  78298 },\n\t{   1210173,  78852 },\n\t{   1238753,  79405 },\n\t{   1267922,  79955 },\n\t{   1297689,  80503 },\n\t{   1328066,  81049 },\n\t{   1359060,  81593 },\n\t{   1390684,  82135 },\n\t{   1422947,  82675 },\n\t{   1455859,  83213 },\n\t{   1489430,  83750 },\n\t{   1523671,  84284 },\n\t{   1558593,  84817 },\n\t{   1594205,  85348 },\n\t{   1630518,  85878 },\n\t{   1667543,  86406 },\n\t{   1705290,  86932 },\n\t{   1743770,  87457 },\n\t{   1782994,  87980 },\n\t{   1822973,  88501 },\n\t{   1863717,  89021 },\n\t{   1905237,  89540 },\n\t{   1947545,  90057 },\n\t{   1990650,  90573 },\n\t{   2034566,  91087 },\n\t{   2079301,  91600 },\n\t{   2124869,  92111 },\n\t{   2171279,  92622 },\n\t{   2218543,  93131 },\n\t{   2266673,  93639 },\n\t{   2315680,  94145 },\n\t{   2365575,  94650 },\n\t{   2416371,  95154 },\n\t{   2468077,  95657 },\n\t{   2520707,  96159 },\n\t{   2574271,  96660 },\n\t{   2628782,  97159 },\n\t{   2684250,  97658 },\n\t{   2740689,  98155 },\n\t{   2798110,  98651 },\n\t{   2856524,  99147 },\n\t{   2915944,  99641 },\n\t{   2976382, 100134 },\n\t{   3037850, 100626 },\n\t{   3100360, 101117 },\n\t{   3163924, 101608 },\n\t{   3228554, 102097 },\n\t{   3294263, 102586 },\n\t{   3361063, 103073 },\n\t{   3428966, 103560 },\n\t{   3497984, 104045 },\n\t{   3568131, 104530 },\n\t{   3639419, 105014 },\n\t{   3711860, 105498 },\n\t{   3785467, 105980 },\n\t{   3860253, 106462 },\n\t{   3936229, 106942 },\n\t{   4013410, 107422 },\n\t{   4091808, 107902 },\n\t{   4171435, 108380 },\n\t{   4252306, 108858 },\n\t{   4334431, 109335 },\n\t{   4417825, 109811 },\n\t{   4502501, 110287 },\n\t{   4588472, 110762 },\n\t{   4675750, 111236 },\n\t{   4764349, 111709 },\n\t{   4854283, 112182 },\n\t{   4945564, 112654 },\n\t{   5038206, 113126 },\n\t{   5132223, 113597 },\n\t{   5227627, 114067 },\n\t{   5324432, 114537 },\n\t{   5422652, 115006 },\n\t{   5522299, 115474 },\n\t{   5623389, 115942 },\n\t{   5725934, 116409 },\n\t{   5829948, 116876 },\n\t{   5935446, 117342 },\n\t{   6042439, 117808 },\n\t{   6150943, 118273 },\n\t{   6260972, 118738 },\n\t{   6372538, 119202 },\n\t{   6485657, 119665 },\n\t{   6600342, 120128 },\n\t{   6716607, 120591 },\n\t{   6834467, 121053 },\n\t{   6953935, 121514 },\n\t{   7075025, 121976 },\n\t{   7197752, 122436 },\n\t{   7322131, 122896 },\n\t{   7448175, 123356 },\n\t{   7575898, 123815 },\n\t{   7705316, 124274 },\n\t{   7836442, 124733 },\n\t{   7969291, 125191 },\n\t{   8103877, 125648 },\n\t{   8240216, 126105 },\n\t{   8378321, 126562 },\n\t{   8518208, 127018 },\n\t{   8659890, 127474 },\n\t{   8803384, 127930 },\n\t{   8948702, 128385 },\n\t{   9095861, 128840 },\n\t{   9244875, 129294 },\n\t{   9395760, 129748 },\n\t{   9548529, 130202 },\n\t{   9703198, 130655 },\n\t{   9859782, 131108 },\n\t{  10018296, 131561 },\n\t{  10178755, 132014 },\n\t{  10341174, 132466 },\n\t{  10505569, 132917 },\n\t{  10671954, 133369 },\n\t{  10840345, 133820 },\n\t{  11010757, 134271 },\n\t{  11183206, 134721 },\n\t{  11357706, 135171 },\n\t{  11534274, 135621 },\n\t{  11712924, 136071 },\n\t{  11893673, 136520 },\n\t{  12076536, 136969 },\n\t{  12261527, 137418 },\n\t{  12448664, 137867 },\n\t{  12637961, 138315 },\n\t{  12829435, 138763 },\n\t{  13023101, 139211 },\n\t{  13218974, 139658 },\n\t{  13417071, 140106 },\n\t{  13617407, 140553 },\n\t{  13819999, 140999 },\n\t{  14024862, 141446 },\n\t{  14232012, 141892 },\n\t{  14441465, 142339 },\n\t{  14653238, 142785 },\n\t{  14867346, 143230 },\n\t{  15083805, 143676 },\n\t{  15302632, 144121 },\n\t{  15523842, 144566 },\n\t{  15747453, 145011 },\n\t{  15973479, 145456 },\n\t{  16201939, 145900 },\n\t{  16432847, 146345 },\n\t{  16666221, 146789 },\n\t{  16902076, 147233 },\n\t{  17140429, 147677 },\n\t{  17381297, 148121 },\n\t{  17624696, 148564 },\n\t{  17870643, 149007 },\n\t{  18119154, 149451 },\n\t{  18370247, 149894 },\n\t{  18623936, 150336 },\n\t{  18880241, 150779 },\n\t{  19139176, 151222 },\n\t{  19400759, 151664 },\n\t{  19665007, 152107 },\n\t{  19931936, 152549 },\n\t{  20201564, 152991 },\n\t{  20473907, 153433 },\n\t{  20748982, 153875 },\n\t{  21026807, 154316 },\n\t{  21307399, 154758 },\n\t{  21590773, 155199 },\n\t{  21876949, 155641 },\n\t{  22165941, 156082 },\n\t{  22457769, 156523 },\n\t{  22752449, 156964 },\n\t{  23049999, 157405 },\n\t{  23350435, 157846 },\n\t{  23653774, 158287 },\n\t{  23960036, 158727 },\n\t{  24269236, 159168 },\n\t{  24581392, 159608 },\n\t{  24896521, 160049 },\n\t{  25214642, 160489 },\n\t{  25535772, 160929 },\n\t{  25859927, 161370 },\n\t{  26187127, 161810 },\n\t{  26517388, 162250 },\n\t{  26850728, 162690 },\n\t{  27187165, 163130 },\n\t{  27526716, 163569 },\n\t{  27869400, 164009 },\n\t{  28215234, 164449 },\n\t{  28564236, 164889 },\n\t{  28916423, 165328 },\n\t{  29271815, 165768 },\n\t{  29630428, 166208 },\n\t{  29992281, 166647 },\n\t{  30357392, 167087 },\n\t{  30725779, 167526 },\n\t{  31097459, 167965 },\n\t{  31472452, 168405 },\n\t{  31850774, 168844 },\n\t{  32232445, 169283 },\n\t{  32617482, 169723 },\n\t{  33005904, 170162 },\n\t{  33397730, 170601 },\n\t{  33792976, 171041 },\n\t{  34191663, 171480 },\n\t{  34593807, 171919 },\n\t{  34999428, 172358 },\n\t{  35408544, 172797 },\n\t{  35821174, 173237 },\n\t{  36237335, 173676 },\n\t{  36657047, 174115 },\n\t{  37080329, 174554 },\n\t{  37507197, 174993 },\n\t{  37937673, 175433 },\n\t{  38371773, 175872 },\n\t{  38809517, 176311 },\n\t{  39250924, 176750 },\n\t{  39696012, 177190 },\n\t{  40144800, 177629 },\n\t{  40597308, 178068 },\n\t{  41053553, 178507 },\n\t{  41513554, 178947 },\n\t{  41977332, 179386 },\n\t{  42444904, 179825 },\n\t{  42916290, 180265 },\n\t{  43391509, 180704 },\n\t{  43870579, 181144 },\n\t{  44353520, 181583 },\n\t{  44840352, 182023 },\n\t{  45331092, 182462 },\n\t{  45825761, 182902 },\n\t{  46324378, 183342 },\n\t{  46826961, 183781 },\n\t{  47333531, 184221 },\n\t{  47844106, 184661 },\n\t{  48358706, 185101 },\n\t{  48877350, 185541 },\n\t{  49400058, 185981 },\n\t{  49926849, 186421 },\n\t{  50457743, 186861 },\n\t{  50992759, 187301 },\n\t{  51531916, 187741 },\n\t{  52075235, 188181 },\n\t{  52622735, 188622 },\n\t{  53174435, 189062 },\n\t{  53730355, 189502 },\n\t{  54290515, 189943 },\n\t{  54854935, 190383 },\n\t{  55423634, 190824 },\n\t{  55996633, 191265 },\n\t{  56573950, 191706 },\n\t{  57155606, 192146 },\n\t{  57741621, 192587 },\n\t{  58332014, 193028 },\n\t{  58926806, 193470 },\n\t{  59526017, 193911 },\n\t{  60129666, 194352 },\n\t{  60737774, 194793 },\n\t{  61350361, 195235 },\n\t{  61967446, 195677 },\n\t{  62589050, 196118 },\n\t{  63215194, 196560 },\n\t{  63845897, 197002 },\n\t{  64481179, 197444 },\n\t{  65121061, 197886 },\n\t{  65765563, 198328 },\n\t{  66414705, 198770 },\n\t{  67068508, 199213 },\n\t{  67726992, 199655 },\n\t{  68390177, 200098 },\n\t{  69058085, 200540 },\n\t{  69730735, 200983 },\n\t{  70408147, 201426 },\n\t{  71090343, 201869 },\n\t{  71777343, 202312 },\n\t{  72469168, 202755 },\n\t{  73165837, 203199 },\n\t{  73867373, 203642 },\n\t{  74573795, 204086 },\n\t{  75285124, 204529 },\n\t{  76001380, 204973 },\n\t{  76722586, 205417 },\n\t{  77448761, 205861 },\n\t{  78179926, 206306 },\n\t{  78916102, 206750 },\n\t{  79657310, 207194 },\n\t{  80403571, 207639 },\n\t{  81154906, 208084 },\n\t{  81911335, 208529 },\n\t{  82672880, 208974 },\n\t{  83439562, 209419 },\n\t{  84211402, 209864 },\n\t{  84988421, 210309 },\n\t{  85770640, 210755 },\n\t{  86558080, 211201 },\n\t{  87350762, 211647 },\n\t{  88148708, 212093 },\n\t{  88951938, 212539 },\n\t{  89760475, 212985 },\n\t{  90574339, 213432 },\n\t{  91393551, 213878 },\n\t{  92218133, 214325 },\n\t{  93048107, 214772 },\n\t{  93883493, 215219 },\n\t{  94724314, 215666 },\n\t{  95570590, 216114 },\n\t{  96422343, 216561 },\n\t{  97279594, 217009 },\n\t{  98142366, 217457 },\n\t{  99010679, 217905 },\n\t{  99884556, 218353 },\n\t{ 100764018, 218801 },\n\t{ 101649086, 219250 },\n\t{ 102539782, 219698 },\n\t{ 103436128, 220147 },\n\t{ 104338146, 220596 },\n\t{ 105245857, 221046 },\n\t{ 106159284, 221495 },\n\t{ 107078448, 221945 },\n\t{ 108003370, 222394 },\n\t{ 108934074, 222844 },\n\t{ 109870580, 223294 },\n\t{ 110812910, 223745 },\n\t{ 111761087, 224195 },\n\t{ 112715133, 224646 },\n\t{ 113675069, 225097 },\n\t{ 114640918, 225548 },\n\t{ 115612702, 225999 },\n\t{ 116590442, 226450 },\n\t{ 117574162, 226902 },\n\t{ 118563882, 227353 },\n\t{ 119559626, 227805 },\n\t{ 120561415, 228258 },\n\t{ 121569272, 228710 },\n\t{ 122583219, 229162 },\n\t{ 123603278, 229615 },\n\t{ 124629471, 230068 },\n\t{ 125661822, 230521 },\n\t{ 126700352, 230974 },\n\t{ 127745083, 231428 },\n\t{ 128796039, 231882 },\n\t{ 129853241, 232336 },\n\t{ 130916713, 232790 },\n\t{ 131986475, 233244 },\n\t{ 133062553, 233699 },\n\t{ 134144966, 234153 },\n\t{ 135233739, 234608 },\n\t{ 136328894, 235064 },\n\t{ 137430453, 235519 },\n\t{ 138538440, 235975 },\n\t{ 139652876, 236430 },\n\t{ 140773786, 236886 },\n\t{ 141901190, 237343 },\n\t{ 143035113, 237799 },\n\t{ 144175576, 238256 },\n\t{ 145322604, 238713 },\n\t{ 146476218, 239170 },\n\t{ 147636442, 239627 },\n\t{ 148803298, 240085 },\n\t{ 149976809, 240542 },\n\t{ 151156999, 241000 },\n\t{ 152343890, 241459 },\n\t{ 153537506, 241917 },\n\t{ 154737869, 242376 },\n\t{ 155945002, 242835 },\n\t{ 157158929, 243294 },\n\t{ 158379673, 243753 },\n\t{ 159607257, 244213 },\n\t{ 160841704, 244673 },\n\t{ 162083037, 245133 },\n\t{ 163331279, 245593 },\n\t{ 164586455, 246054 },\n\t{ 165848586, 246514 },\n\t{ 167117696, 246975 },\n\t{ 168393810, 247437 },\n\t{ 169676949, 247898 },\n\t{ 170967138, 248360 },\n\t{ 172264399, 248822 },\n\t{ 173568757, 249284 },\n\t{ 174880235, 249747 },\n\t{ 176198856, 250209 },\n\t{ 177524643, 250672 },\n\t{ 178857621, 251136 },\n\t{ 180197813, 251599 },\n\t{ 181545242, 252063 },\n\t{ 182899933, 252527 },\n\t{ 184261908, 252991 },\n\t{ 185631191, 253456 },\n\t{ 187007807, 253920 },\n\t{ 188391778, 254385 },\n\t{ 189783129, 254851 },\n\t{ 191181884, 255316 },\n\t{ 192588065, 255782 },\n\t{ 194001698, 256248 },\n\t{ 195422805, 256714 },\n\t{ 196851411, 257181 },\n\t{ 198287540, 257648 },\n\t{ 199731215, 258115 },\n\t{ 201182461, 258582 },\n\t{ 202641302, 259050 },\n\t{ 204107760, 259518 },\n\t{ 205581862, 259986 },\n\t{ 207063630, 260454 },\n\t{ 208553088, 260923 },\n\t{ 210050262, 261392 },\n\t{ 211555174, 261861 },\n\t{ 213067849, 262331 },\n\t{ 214588312, 262800 },\n\t{ 216116586, 263270 },\n\t{ 217652696, 263741 },\n\t{ 219196666, 264211 },\n\t{ 220748520, 264682 },\n\t{ 222308282, 265153 },\n\t{ 223875978, 265625 },\n\t{ 225451630, 266097 },\n\t{ 227035265, 266569 },\n\t{ 228626905, 267041 },\n\t{ 230226576, 267514 },\n\t{ 231834302, 267986 },\n\t{ 233450107, 268460 },\n\t{ 235074016, 268933 },\n\t{ 236706054, 269407 },\n\t{ 238346244, 269881 },\n\t{ 239994613, 270355 },\n\t{ 241651183, 270830 },\n\t{ 243315981, 271305 }\n};\n\n \nstatic inline u32 tfrc_binsearch(u32 fval, u8 small)\n{\n\tu32 try, low = 0, high = TFRC_CALC_X_ARRSIZE - 1;\n\n\twhile (low < high) {\n\t\ttry = (low + high) / 2;\n\t\tif (fval <= tfrc_calc_x_lookup[try][small])\n\t\t\thigh = try;\n\t\telse\n\t\t\tlow  = try + 1;\n\t}\n\treturn high;\n}\n\n \nu32 tfrc_calc_x(u16 s, u32 R, u32 p)\n{\n\tu16 index;\n\tu32 f;\n\tu64 result;\n\n\t \n\tBUG_ON(p >  1000000);\t\t \n\tBUG_ON(p == 0);\t\t\t \n\tif (R == 0) {\t\t\t \n\t\tDCCP_CRIT(\"WARNING: RTT is 0, returning maximum X_calc.\");\n\t\treturn ~0U;\n\t}\n\n\tif (p <= TFRC_CALC_X_SPLIT)\t\t{      \n\t\tif (p < TFRC_SMALLEST_P) {\t       \n\t\t\tDCCP_WARN(\"Value of p (%d) below resolution. \"\n\t\t\t\t  \"Substituting %d\\n\", p, TFRC_SMALLEST_P);\n\t\t\tindex = 0;\n\t\t} else\t\t\t\t       \n\t\t\tindex =  p/TFRC_SMALLEST_P - 1;\n\n\t\tf = tfrc_calc_x_lookup[index][1];\n\n\t} else {\t\t\t\t       \n\t\tindex = p/(1000000/TFRC_CALC_X_ARRSIZE) - 1;\n\n\t\tf = tfrc_calc_x_lookup[index][0];\n\t}\n\n\t \n\tresult = scaled_div(s, R);\n\treturn scaled_div32(result, f);\n}\n\n \nu32 tfrc_calc_x_reverse_lookup(u32 fvalue)\n{\n\tint index;\n\n\tif (fvalue == 0)\t \n\t\treturn 0;\n\n\t \n\tif (fvalue < tfrc_calc_x_lookup[0][1]) {\n\t\tDCCP_WARN(\"fvalue %u smaller than resolution\\n\", fvalue);\n\t\treturn TFRC_SMALLEST_P;\n\t}\n\tif (fvalue > tfrc_calc_x_lookup[TFRC_CALC_X_ARRSIZE - 1][0]) {\n\t\tDCCP_WARN(\"fvalue %u exceeds bounds!\\n\", fvalue);\n\t\treturn 1000000;\n\t}\n\n\tif (fvalue <= tfrc_calc_x_lookup[TFRC_CALC_X_ARRSIZE - 1][1]) {\n\t\tindex = tfrc_binsearch(fvalue, 1);\n\t\treturn (index + 1) * TFRC_CALC_X_SPLIT / TFRC_CALC_X_ARRSIZE;\n\t}\n\n\t \n\tindex = tfrc_binsearch(fvalue, 0);\n\treturn (index + 1) * 1000000 / TFRC_CALC_X_ARRSIZE;\n}\n\n \nu32 tfrc_invert_loss_event_rate(u32 loss_event_rate)\n{\n\tif (loss_event_rate == UINT_MAX)\t\t \n\t\treturn 0;\n\tif (unlikely(loss_event_rate == 0))\t\t \n\t\treturn 1000000;\n\treturn max_t(u32, scaled_div(1, loss_event_rate), TFRC_SMALLEST_P);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}