{
  "module_name": "l2tp_core.h",
  "hash_id": "5febf2e29a339168fc3b61c8716ecc8c82535da2cd6794cd6973d909379021d4",
  "original_prompt": "Ingested from linux-6.6.14/net/l2tp/l2tp_core.h",
  "human_readable_source": " \n \n#include <linux/refcount.h>\n\n#ifndef _L2TP_CORE_H_\n#define _L2TP_CORE_H_\n\n#include <net/dst.h>\n#include <net/sock.h>\n\n#ifdef CONFIG_XFRM\n#include <net/xfrm.h>\n#endif\n\n \n#define L2TP_TUNNEL_MAGIC\t0x42114DDA\n#define L2TP_SESSION_MAGIC\t0x0C04EB7D\n\n \n#define L2TP_HASH_BITS\t4\n#define L2TP_HASH_SIZE\tBIT(L2TP_HASH_BITS)\n\n \n#define L2TP_HASH_BITS_2\t8\n#define L2TP_HASH_SIZE_2\tBIT(L2TP_HASH_BITS_2)\n\nstruct sk_buff;\n\nstruct l2tp_stats {\n\tatomic_long_t\t\ttx_packets;\n\tatomic_long_t\t\ttx_bytes;\n\tatomic_long_t\t\ttx_errors;\n\tatomic_long_t\t\trx_packets;\n\tatomic_long_t\t\trx_bytes;\n\tatomic_long_t\t\trx_seq_discards;\n\tatomic_long_t\t\trx_oos_packets;\n\tatomic_long_t\t\trx_errors;\n\tatomic_long_t\t\trx_cookie_discards;\n\tatomic_long_t\t\trx_invalid;\n};\n\nstruct l2tp_tunnel;\n\n \nstruct l2tp_session_cfg {\n\tenum l2tp_pwtype\tpw_type;\n\tunsigned int\t\trecv_seq:1;\t \n\tunsigned int\t\tsend_seq:1;\t \n\tunsigned int\t\tlns_mode:1;\t \n\tu16\t\t\tl2specific_type;  \n\tu8\t\t\tcookie[8];\t \n\tint\t\t\tcookie_len;\t \n\tu8\t\t\tpeer_cookie[8];\t \n\tint\t\t\tpeer_cookie_len;  \n\tint\t\t\treorder_timeout;  \n\tchar\t\t\t*ifname;\n};\n\n \n#define L2TP_SESSION_NAME_MAX 32\nstruct l2tp_session {\n\tint\t\t\tmagic;\t\t \n\tlong\t\t\tdead;\n\n\tstruct l2tp_tunnel\t*tunnel;\t \n\tu32\t\t\tsession_id;\n\tu32\t\t\tpeer_session_id;\n\tu8\t\t\tcookie[8];\n\tint\t\t\tcookie_len;\n\tu8\t\t\tpeer_cookie[8];\n\tint\t\t\tpeer_cookie_len;\n\tu16\t\t\tl2specific_type;\n\tu16\t\t\thdr_len;\n\tu32\t\t\tnr;\t\t \n\tu32\t\t\tns;\t\t \n\tstruct sk_buff_head\treorder_q;\t \n\tu32\t\t\tnr_max;\t\t \n\tu32\t\t\tnr_window_size;\t \n\tu32\t\t\tnr_oos;\t\t \n\tint\t\t\tnr_oos_count;\t \n\tint\t\t\tnr_oos_count_max;\n\tstruct hlist_node\thlist;\t\t \n\trefcount_t\t\tref_count;\n\n\tchar\t\t\tname[L2TP_SESSION_NAME_MAX];  \n\tchar\t\t\tifname[IFNAMSIZ];\n\tunsigned int\t\trecv_seq:1;\t \n\tunsigned int\t\tsend_seq:1;\t \n\tunsigned int\t\tlns_mode:1;\t \n\tint\t\t\treorder_timeout;  \n\tint\t\t\treorder_skip;\t \n\tenum l2tp_pwtype\tpwtype;\n\tstruct l2tp_stats\tstats;\n\tstruct hlist_node\tglobal_hlist;\t \n\n\t \n\tvoid (*recv_skb)(struct l2tp_session *session, struct sk_buff *skb, int data_len);\n\n\t \n\tvoid (*session_close)(struct l2tp_session *session);\n\n\t \n\tvoid (*show)(struct seq_file *m, void *priv);\n\n\tu8\t\t\tpriv[];\t\t \n};\n\n \nstruct l2tp_tunnel_cfg {\n\tenum l2tp_encap_type\tencap;\n\n\t \n\tstruct in_addr\t\tlocal_ip;\n\tstruct in_addr\t\tpeer_ip;\n#if IS_ENABLED(CONFIG_IPV6)\n\tstruct in6_addr\t\t*local_ip6;\n\tstruct in6_addr\t\t*peer_ip6;\n#endif\n\tu16\t\t\tlocal_udp_port;\n\tu16\t\t\tpeer_udp_port;\n\tunsigned int\t\tuse_udp_checksums:1,\n\t\t\t\tudp6_zero_tx_checksums:1,\n\t\t\t\tudp6_zero_rx_checksums:1;\n};\n\n \n#define L2TP_TUNNEL_NAME_MAX 20\nstruct l2tp_tunnel {\n\tint\t\t\tmagic;\t\t \n\n\tunsigned long\t\tdead;\n\n\tstruct rcu_head rcu;\n\tspinlock_t\t\thlist_lock;\t \n\tbool\t\t\tacpt_newsess;\t \n\tstruct hlist_head\tsession_hlist[L2TP_HASH_SIZE];\n\t\t\t\t\t\t \n\tu32\t\t\ttunnel_id;\n\tu32\t\t\tpeer_tunnel_id;\n\tint\t\t\tversion;\t \n\n\tchar\t\t\tname[L2TP_TUNNEL_NAME_MAX];  \n\tenum l2tp_encap_type\tencap;\n\tstruct l2tp_stats\tstats;\n\n\tstruct list_head\tlist;\t\t \n\tstruct net\t\t*l2tp_net;\t \n\n\trefcount_t\t\tref_count;\n\tvoid (*old_sk_destruct)(struct sock *sk);\n\tstruct sock\t\t*sock;\t\t \n\tint\t\t\tfd;\t\t \n\n\tstruct work_struct\tdel_work;\n};\n\n \nstruct l2tp_nl_cmd_ops {\n\t \n\tint (*session_create)(struct net *net, struct l2tp_tunnel *tunnel,\n\t\t\t      u32 session_id, u32 peer_session_id,\n\t\t\t      struct l2tp_session_cfg *cfg);\n\n\t \n\tvoid (*session_delete)(struct l2tp_session *session);\n};\n\nstatic inline void *l2tp_session_priv(struct l2tp_session *session)\n{\n\treturn &session->priv[0];\n}\n\n \nvoid l2tp_tunnel_inc_refcount(struct l2tp_tunnel *tunnel);\nvoid l2tp_tunnel_dec_refcount(struct l2tp_tunnel *tunnel);\nvoid l2tp_session_inc_refcount(struct l2tp_session *session);\nvoid l2tp_session_dec_refcount(struct l2tp_session *session);\n\n \nstruct l2tp_tunnel *l2tp_tunnel_get(const struct net *net, u32 tunnel_id);\nstruct l2tp_tunnel *l2tp_tunnel_get_nth(const struct net *net, int nth);\nstruct l2tp_session *l2tp_tunnel_get_session(struct l2tp_tunnel *tunnel,\n\t\t\t\t\t     u32 session_id);\n\nstruct l2tp_session *l2tp_session_get(const struct net *net, u32 session_id);\nstruct l2tp_session *l2tp_session_get_nth(struct l2tp_tunnel *tunnel, int nth);\nstruct l2tp_session *l2tp_session_get_by_ifname(const struct net *net,\n\t\t\t\t\t\tconst char *ifname);\n\n \nint l2tp_tunnel_create(int fd, int version, u32 tunnel_id,\n\t\t       u32 peer_tunnel_id, struct l2tp_tunnel_cfg *cfg,\n\t\t       struct l2tp_tunnel **tunnelp);\nint l2tp_tunnel_register(struct l2tp_tunnel *tunnel, struct net *net,\n\t\t\t struct l2tp_tunnel_cfg *cfg);\nvoid l2tp_tunnel_delete(struct l2tp_tunnel *tunnel);\n\nstruct l2tp_session *l2tp_session_create(int priv_size,\n\t\t\t\t\t struct l2tp_tunnel *tunnel,\n\t\t\t\t\t u32 session_id, u32 peer_session_id,\n\t\t\t\t\t struct l2tp_session_cfg *cfg);\nint l2tp_session_register(struct l2tp_session *session,\n\t\t\t  struct l2tp_tunnel *tunnel);\nvoid l2tp_session_delete(struct l2tp_session *session);\n\n \nvoid l2tp_recv_common(struct l2tp_session *session, struct sk_buff *skb,\n\t\t      unsigned char *ptr, unsigned char *optr, u16 hdrflags,\n\t\t      int length);\nint l2tp_udp_encap_recv(struct sock *sk, struct sk_buff *skb);\n\n \nvoid l2tp_session_set_header_len(struct l2tp_session *session, int version);\nint l2tp_xmit_skb(struct l2tp_session *session, struct sk_buff *skb);\n\n \nint l2tp_nl_register_ops(enum l2tp_pwtype pw_type, const struct l2tp_nl_cmd_ops *ops);\nvoid l2tp_nl_unregister_ops(enum l2tp_pwtype pw_type);\n\n \nint l2tp_ioctl(struct sock *sk, int cmd, int *karg);\n\n \nstruct l2tp_tunnel *l2tp_sk_to_tunnel(struct sock *sk);\n\nstatic inline int l2tp_get_l2specific_len(struct l2tp_session *session)\n{\n\tswitch (session->l2specific_type) {\n\tcase L2TP_L2SPECTYPE_DEFAULT:\n\t\treturn 4;\n\tcase L2TP_L2SPECTYPE_NONE:\n\tdefault:\n\t\treturn 0;\n\t}\n}\n\nstatic inline u32 l2tp_tunnel_dst_mtu(const struct l2tp_tunnel *tunnel)\n{\n\tstruct dst_entry *dst;\n\tu32 mtu;\n\n\tdst = sk_dst_get(tunnel->sock);\n\tif (!dst)\n\t\treturn 0;\n\n\tmtu = dst_mtu(dst);\n\tdst_release(dst);\n\n\treturn mtu;\n}\n\n#ifdef CONFIG_XFRM\nstatic inline bool l2tp_tunnel_uses_xfrm(const struct l2tp_tunnel *tunnel)\n{\n\tstruct sock *sk = tunnel->sock;\n\n\treturn sk && (rcu_access_pointer(sk->sk_policy[0]) ||\n\t\t      rcu_access_pointer(sk->sk_policy[1]));\n}\n#else\nstatic inline bool l2tp_tunnel_uses_xfrm(const struct l2tp_tunnel *tunnel)\n{\n\treturn false;\n}\n#endif\n\nstatic inline int l2tp_v3_ensure_opt_in_linear(struct l2tp_session *session, struct sk_buff *skb,\n\t\t\t\t\t       unsigned char **ptr, unsigned char **optr)\n{\n\tint opt_len = session->peer_cookie_len + l2tp_get_l2specific_len(session);\n\n\tif (opt_len > 0) {\n\t\tint off = *ptr - *optr;\n\n\t\tif (!pskb_may_pull(skb, off + opt_len))\n\t\t\treturn -1;\n\n\t\tif (skb->data != *optr) {\n\t\t\t*optr = skb->data;\n\t\t\t*ptr = skb->data + off;\n\t\t}\n\t}\n\n\treturn 0;\n}\n\n#define MODULE_ALIAS_L2TP_PWTYPE(type) \\\n\tMODULE_ALIAS(\"net-l2tp-type-\" __stringify(type))\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}