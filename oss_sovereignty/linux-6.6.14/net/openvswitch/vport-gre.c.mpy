{
  "module_name": "vport-gre.c",
  "hash_id": "59d82efd878e375237ce5405ed4c4dfa72e5688fe20d29d9b04ac78a71a3230f",
  "original_prompt": "Ingested from linux-6.6.14/net/openvswitch/vport-gre.c",
  "human_readable_source": "\n \n\n#define pr_fmt(fmt) KBUILD_MODNAME \": \" fmt\n\n#include <linux/if.h>\n#include <linux/skbuff.h>\n#include <linux/ip.h>\n#include <linux/if_tunnel.h>\n#include <linux/if_vlan.h>\n#include <linux/in.h>\n#include <linux/in_route.h>\n#include <linux/inetdevice.h>\n#include <linux/jhash.h>\n#include <linux/list.h>\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/workqueue.h>\n#include <linux/rculist.h>\n#include <net/route.h>\n#include <net/xfrm.h>\n\n#include <net/icmp.h>\n#include <net/ip.h>\n#include <net/ip_tunnels.h>\n#include <net/gre.h>\n#include <net/net_namespace.h>\n#include <net/netns/generic.h>\n#include <net/protocol.h>\n\n#include \"datapath.h\"\n#include \"vport.h\"\n#include \"vport-netdev.h\"\n\nstatic struct vport_ops ovs_gre_vport_ops;\n\nstatic struct vport *gre_tnl_create(const struct vport_parms *parms)\n{\n\tstruct net *net = ovs_dp_get_net(parms->dp);\n\tstruct net_device *dev;\n\tstruct vport *vport;\n\tint err;\n\n\tvport = ovs_vport_alloc(0, &ovs_gre_vport_ops, parms);\n\tif (IS_ERR(vport))\n\t\treturn vport;\n\n\trtnl_lock();\n\tdev = gretap_fb_dev_create(net, parms->name, NET_NAME_USER);\n\tif (IS_ERR(dev)) {\n\t\trtnl_unlock();\n\t\tovs_vport_free(vport);\n\t\treturn ERR_CAST(dev);\n\t}\n\n\terr = dev_change_flags(dev, dev->flags | IFF_UP, NULL);\n\tif (err < 0) {\n\t\trtnl_delete_link(dev, 0, NULL);\n\t\trtnl_unlock();\n\t\tovs_vport_free(vport);\n\t\treturn ERR_PTR(err);\n\t}\n\n\trtnl_unlock();\n\treturn vport;\n}\n\nstatic struct vport *gre_create(const struct vport_parms *parms)\n{\n\tstruct vport *vport;\n\n\tvport = gre_tnl_create(parms);\n\tif (IS_ERR(vport))\n\t\treturn vport;\n\n\treturn ovs_netdev_link(vport, parms->name);\n}\n\nstatic struct vport_ops ovs_gre_vport_ops = {\n\t.type\t\t= OVS_VPORT_TYPE_GRE,\n\t.create\t\t= gre_create,\n\t.send\t\t= dev_queue_xmit,\n\t.destroy\t= ovs_netdev_tunnel_destroy,\n};\n\nstatic int __init ovs_gre_tnl_init(void)\n{\n\treturn ovs_vport_ops_register(&ovs_gre_vport_ops);\n}\n\nstatic void __exit ovs_gre_tnl_exit(void)\n{\n\tovs_vport_ops_unregister(&ovs_gre_vport_ops);\n}\n\nmodule_init(ovs_gre_tnl_init);\nmodule_exit(ovs_gre_tnl_exit);\n\nMODULE_DESCRIPTION(\"OVS: GRE switching port\");\nMODULE_LICENSE(\"GPL\");\nMODULE_ALIAS(\"vport-type-3\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}