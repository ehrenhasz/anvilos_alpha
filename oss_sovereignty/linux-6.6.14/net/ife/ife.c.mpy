{
  "module_name": "ife.c",
  "hash_id": "ae7066badc778d4410a3a19b2b66a2d8b16f10189d3beedaf964d2ee1641bfc4",
  "original_prompt": "Ingested from linux-6.6.14/net/ife/ife.c",
  "human_readable_source": " \n\n#include <linux/types.h>\n#include <linux/kernel.h>\n#include <linux/string.h>\n#include <linux/errno.h>\n#include <linux/skbuff.h>\n#include <linux/rtnetlink.h>\n#include <linux/module.h>\n#include <linux/init.h>\n#include <net/net_namespace.h>\n#include <net/netlink.h>\n#include <net/pkt_sched.h>\n#include <linux/etherdevice.h>\n#include <net/ife.h>\n\nstruct ifeheadr {\n\t__be16 metalen;\n\tu8 tlv_data[];\n};\n\nvoid *ife_encode(struct sk_buff *skb, u16 metalen)\n{\n\t \n\tint hdrm = metalen + IFE_METAHDRLEN;\n\tint total_push = hdrm + skb->dev->hard_header_len;\n\tstruct ifeheadr *ifehdr;\n\tstruct ethhdr *iethh;\t \n\tint skboff = 0;\n\tint err;\n\n\terr = skb_cow_head(skb, total_push);\n\tif (unlikely(err))\n\t\treturn NULL;\n\n\tiethh = (struct ethhdr *) skb->data;\n\n\t__skb_push(skb, total_push);\n\tmemcpy(skb->data, iethh, skb->dev->hard_header_len);\n\tskb_reset_mac_header(skb);\n\tskboff += skb->dev->hard_header_len;\n\n\t \n\tifehdr = (struct ifeheadr *) (skb->data + skboff);\n\tmetalen += IFE_METAHDRLEN;\n\tifehdr->metalen = htons(metalen);\n\n\treturn ifehdr->tlv_data;\n}\nEXPORT_SYMBOL_GPL(ife_encode);\n\nvoid *ife_decode(struct sk_buff *skb, u16 *metalen)\n{\n\tstruct ifeheadr *ifehdr;\n\tint total_pull;\n\tu16 ifehdrln;\n\n\tif (!pskb_may_pull(skb, skb->dev->hard_header_len + IFE_METAHDRLEN))\n\t\treturn NULL;\n\n\tifehdr = (struct ifeheadr *) (skb->data + skb->dev->hard_header_len);\n\tifehdrln = ntohs(ifehdr->metalen);\n\ttotal_pull = skb->dev->hard_header_len + ifehdrln;\n\n\tif (unlikely(ifehdrln < 2))\n\t\treturn NULL;\n\n\tif (unlikely(!pskb_may_pull(skb, total_pull)))\n\t\treturn NULL;\n\n\tifehdr = (struct ifeheadr *)(skb->data + skb->dev->hard_header_len);\n\tskb_set_mac_header(skb, total_pull);\n\t__skb_pull(skb, total_pull);\n\t*metalen = ifehdrln - IFE_METAHDRLEN;\n\n\treturn &ifehdr->tlv_data;\n}\nEXPORT_SYMBOL_GPL(ife_decode);\n\nstruct meta_tlvhdr {\n\t__be16 type;\n\t__be16 len;\n};\n\nstatic bool __ife_tlv_meta_valid(const unsigned char *skbdata,\n\t\t\t\t const unsigned char *ifehdr_end)\n{\n\tconst struct meta_tlvhdr *tlv;\n\tu16 tlvlen;\n\n\tif (unlikely(skbdata + sizeof(*tlv) > ifehdr_end))\n\t\treturn false;\n\n\ttlv = (const struct meta_tlvhdr *)skbdata;\n\ttlvlen = ntohs(tlv->len);\n\n\t \n\tif (tlvlen < NLA_HDRLEN)\n\t\treturn false;\n\n\t \n\tif (NLA_ALIGN(tlvlen) < tlvlen)\n\t\treturn false;\n\n\tif (unlikely(skbdata + NLA_ALIGN(tlvlen) > ifehdr_end))\n\t\treturn false;\n\n\treturn true;\n}\n\n \nvoid *ife_tlv_meta_decode(void *skbdata, const void *ifehdr_end, u16 *attrtype,\n\t\t\t  u16 *dlen, u16 *totlen)\n{\n\tstruct meta_tlvhdr *tlv;\n\n\tif (!__ife_tlv_meta_valid(skbdata, ifehdr_end))\n\t\treturn NULL;\n\n\ttlv = (struct meta_tlvhdr *)skbdata;\n\t*dlen = ntohs(tlv->len) - NLA_HDRLEN;\n\t*attrtype = ntohs(tlv->type);\n\n\tif (totlen)\n\t\t*totlen = nla_total_size(*dlen);\n\n\treturn skbdata + sizeof(struct meta_tlvhdr);\n}\nEXPORT_SYMBOL_GPL(ife_tlv_meta_decode);\n\nvoid *ife_tlv_meta_next(void *skbdata)\n{\n\tstruct meta_tlvhdr *tlv = (struct meta_tlvhdr *) skbdata;\n\tu16 tlvlen = ntohs(tlv->len);\n\n\ttlvlen = NLA_ALIGN(tlvlen);\n\n\treturn skbdata + tlvlen;\n}\nEXPORT_SYMBOL_GPL(ife_tlv_meta_next);\n\n \nint ife_tlv_meta_encode(void *skbdata, u16 attrtype, u16 dlen, const void *dval)\n{\n\t__be32 *tlv = (__be32 *) (skbdata);\n\tu16 totlen = nla_total_size(dlen);\t \n\tchar *dptr = (char *) tlv + NLA_HDRLEN;\n\tu32 htlv = attrtype << 16 | (dlen + NLA_HDRLEN);\n\n\t*tlv = htonl(htlv);\n\tmemset(dptr, 0, totlen - NLA_HDRLEN);\n\tmemcpy(dptr, dval, dlen);\n\n\treturn totlen;\n}\nEXPORT_SYMBOL_GPL(ife_tlv_meta_encode);\n\nMODULE_AUTHOR(\"Jamal Hadi Salim <jhs@mojatatu.com>\");\nMODULE_AUTHOR(\"Yotam Gigi <yotam.gi@gmail.com>\");\nMODULE_DESCRIPTION(\"Inter-FE LFB action\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}