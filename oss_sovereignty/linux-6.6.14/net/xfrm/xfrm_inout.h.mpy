{
  "module_name": "xfrm_inout.h",
  "hash_id": "2f2ff15afc708b1a69e35da6ce359ec73aa5b95959989d9ee756970a3a6ada57",
  "original_prompt": "Ingested from linux-6.6.14/net/xfrm/xfrm_inout.h",
  "human_readable_source": " \n#include <linux/ipv6.h>\n#include <net/dsfield.h>\n#include <net/xfrm.h>\n\n#ifndef XFRM_INOUT_H\n#define XFRM_INOUT_H 1\n\nstatic inline void xfrm4_extract_header(struct sk_buff *skb)\n{\n\tconst struct iphdr *iph = ip_hdr(skb);\n\n\tXFRM_MODE_SKB_CB(skb)->ihl = sizeof(*iph);\n\tXFRM_MODE_SKB_CB(skb)->id = iph->id;\n\tXFRM_MODE_SKB_CB(skb)->frag_off = iph->frag_off;\n\tXFRM_MODE_SKB_CB(skb)->tos = iph->tos;\n\tXFRM_MODE_SKB_CB(skb)->ttl = iph->ttl;\n\tXFRM_MODE_SKB_CB(skb)->optlen = iph->ihl * 4 - sizeof(*iph);\n\tmemset(XFRM_MODE_SKB_CB(skb)->flow_lbl, 0,\n\t       sizeof(XFRM_MODE_SKB_CB(skb)->flow_lbl));\n}\n\nstatic inline void xfrm6_extract_header(struct sk_buff *skb)\n{\n#if IS_ENABLED(CONFIG_IPV6)\n\tstruct ipv6hdr *iph = ipv6_hdr(skb);\n\n\tXFRM_MODE_SKB_CB(skb)->ihl = sizeof(*iph);\n\tXFRM_MODE_SKB_CB(skb)->id = 0;\n\tXFRM_MODE_SKB_CB(skb)->frag_off = htons(IP_DF);\n\tXFRM_MODE_SKB_CB(skb)->tos = ipv6_get_dsfield(iph);\n\tXFRM_MODE_SKB_CB(skb)->ttl = iph->hop_limit;\n\tXFRM_MODE_SKB_CB(skb)->optlen = 0;\n\tmemcpy(XFRM_MODE_SKB_CB(skb)->flow_lbl, iph->flow_lbl,\n\t       sizeof(XFRM_MODE_SKB_CB(skb)->flow_lbl));\n#else\n\tWARN_ON_ONCE(1);\n#endif\n}\n\nstatic inline void xfrm6_beet_make_header(struct sk_buff *skb)\n{\n\tstruct ipv6hdr *iph = ipv6_hdr(skb);\n\n\tiph->version = 6;\n\n\tmemcpy(iph->flow_lbl, XFRM_MODE_SKB_CB(skb)->flow_lbl,\n\t       sizeof(iph->flow_lbl));\n\tiph->nexthdr = XFRM_MODE_SKB_CB(skb)->protocol;\n\n\tipv6_change_dsfield(iph, 0, XFRM_MODE_SKB_CB(skb)->tos);\n\tiph->hop_limit = XFRM_MODE_SKB_CB(skb)->ttl;\n}\n\nstatic inline void xfrm4_beet_make_header(struct sk_buff *skb)\n{\n\tstruct iphdr *iph = ip_hdr(skb);\n\n\tiph->ihl = 5;\n\tiph->version = 4;\n\n\tiph->protocol = XFRM_MODE_SKB_CB(skb)->protocol;\n\tiph->tos = XFRM_MODE_SKB_CB(skb)->tos;\n\n\tiph->id = XFRM_MODE_SKB_CB(skb)->id;\n\tiph->frag_off = XFRM_MODE_SKB_CB(skb)->frag_off;\n\tiph->ttl = XFRM_MODE_SKB_CB(skb)->ttl;\n}\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}