{
  "module_name": "x25_proc.c",
  "hash_id": "ef2123f5cbb7625e915b0af74a85613d2f3788e52e9e10cc8478aec1cfbcab5f",
  "original_prompt": "Ingested from linux-6.6.14/net/x25/x25_proc.c",
  "human_readable_source": "\n \n\n#include <linux/init.h>\n#include <linux/proc_fs.h>\n#include <linux/seq_file.h>\n#include <linux/export.h>\n#include <net/net_namespace.h>\n#include <net/sock.h>\n#include <net/x25.h>\n\n#ifdef CONFIG_PROC_FS\n\nstatic void *x25_seq_route_start(struct seq_file *seq, loff_t *pos)\n\t__acquires(x25_route_list_lock)\n{\n\tread_lock_bh(&x25_route_list_lock);\n\treturn seq_list_start_head(&x25_route_list, *pos);\n}\n\nstatic void *x25_seq_route_next(struct seq_file *seq, void *v, loff_t *pos)\n{\n\treturn seq_list_next(v, &x25_route_list, pos);\n}\n\nstatic void x25_seq_route_stop(struct seq_file *seq, void *v)\n\t__releases(x25_route_list_lock)\n{\n\tread_unlock_bh(&x25_route_list_lock);\n}\n\nstatic int x25_seq_route_show(struct seq_file *seq, void *v)\n{\n\tstruct x25_route *rt = list_entry(v, struct x25_route, node);\n\n\tif (v == &x25_route_list) {\n\t\tseq_puts(seq, \"Address          Digits  Device\\n\");\n\t\tgoto out;\n\t}\n\n\trt = v;\n\tseq_printf(seq, \"%-15s  %-6d  %-5s\\n\",\n\t\t   rt->address.x25_addr, rt->sigdigits,\n\t\t   rt->dev ? rt->dev->name : \"???\");\nout:\n\treturn 0;\n}\n\nstatic void *x25_seq_socket_start(struct seq_file *seq, loff_t *pos)\n\t__acquires(x25_list_lock)\n{\n\tread_lock_bh(&x25_list_lock);\n\treturn seq_hlist_start_head(&x25_list, *pos);\n}\n\nstatic void *x25_seq_socket_next(struct seq_file *seq, void *v, loff_t *pos)\n{\n\treturn seq_hlist_next(v, &x25_list, pos);\n}\n\nstatic void x25_seq_socket_stop(struct seq_file *seq, void *v)\n\t__releases(x25_list_lock)\n{\n\tread_unlock_bh(&x25_list_lock);\n}\n\nstatic int x25_seq_socket_show(struct seq_file *seq, void *v)\n{\n\tstruct sock *s;\n\tstruct x25_sock *x25;\n\tconst char *devname;\n\n\tif (v == SEQ_START_TOKEN) {\n\t\tseq_printf(seq, \"dest_addr  src_addr   dev   lci st vs vr \"\n\t\t\t\t\"va   t  t2 t21 t22 t23 Snd-Q Rcv-Q inode\\n\");\n\t\tgoto out;\n\t}\n\n\ts = sk_entry(v);\n\tx25 = x25_sk(s);\n\n\tif (!x25->neighbour || !x25->neighbour->dev)\n\t\tdevname = \"???\";\n\telse\n\t\tdevname = x25->neighbour->dev->name;\n\n\tseq_printf(seq, \"%-10s %-10s %-5s %3.3X  %d  %d  %d  %d %3lu %3lu \"\n\t\t\t\"%3lu %3lu %3lu %5d %5d %ld\\n\",\n\t\t   !x25->dest_addr.x25_addr[0] ? \"*\" : x25->dest_addr.x25_addr,\n\t\t   !x25->source_addr.x25_addr[0] ? \"*\" : x25->source_addr.x25_addr,\n\t\t   devname, x25->lci & 0x0FFF, x25->state, x25->vs, x25->vr,\n\t\t   x25->va, x25_display_timer(s) / HZ, x25->t2  / HZ,\n\t\t   x25->t21 / HZ, x25->t22 / HZ, x25->t23 / HZ,\n\t\t   sk_wmem_alloc_get(s),\n\t\t   sk_rmem_alloc_get(s),\n\t\t   s->sk_socket ? SOCK_INODE(s->sk_socket)->i_ino : 0L);\nout:\n\treturn 0;\n}\n\nstatic void *x25_seq_forward_start(struct seq_file *seq, loff_t *pos)\n\t__acquires(x25_forward_list_lock)\n{\n\tread_lock_bh(&x25_forward_list_lock);\n\treturn seq_list_start_head(&x25_forward_list, *pos);\n}\n\nstatic void *x25_seq_forward_next(struct seq_file *seq, void *v, loff_t *pos)\n{\n\treturn seq_list_next(v, &x25_forward_list, pos);\n}\n\nstatic void x25_seq_forward_stop(struct seq_file *seq, void *v)\n\t__releases(x25_forward_list_lock)\n{\n\tread_unlock_bh(&x25_forward_list_lock);\n}\n\nstatic int x25_seq_forward_show(struct seq_file *seq, void *v)\n{\n\tstruct x25_forward *f = list_entry(v, struct x25_forward, node);\n\n\tif (v == &x25_forward_list) {\n\t\tseq_printf(seq, \"lci dev1       dev2\\n\");\n\t\tgoto out;\n\t}\n\n\tf = v;\n\n\tseq_printf(seq, \"%d %-10s %-10s\\n\",\n\t\t\tf->lci, f->dev1->name, f->dev2->name);\nout:\n\treturn 0;\n}\n\nstatic const struct seq_operations x25_seq_route_ops = {\n\t.start  = x25_seq_route_start,\n\t.next   = x25_seq_route_next,\n\t.stop   = x25_seq_route_stop,\n\t.show   = x25_seq_route_show,\n};\n\nstatic const struct seq_operations x25_seq_socket_ops = {\n\t.start  = x25_seq_socket_start,\n\t.next   = x25_seq_socket_next,\n\t.stop   = x25_seq_socket_stop,\n\t.show   = x25_seq_socket_show,\n};\n\nstatic const struct seq_operations x25_seq_forward_ops = {\n\t.start  = x25_seq_forward_start,\n\t.next   = x25_seq_forward_next,\n\t.stop   = x25_seq_forward_stop,\n\t.show   = x25_seq_forward_show,\n};\n\nint __init x25_proc_init(void)\n{\n\tif (!proc_mkdir(\"x25\", init_net.proc_net))\n\t\treturn -ENOMEM;\n\n\tif (!proc_create_seq(\"x25/route\", 0444, init_net.proc_net,\n\t\t\t &x25_seq_route_ops))\n\t\tgoto out;\n\n\tif (!proc_create_seq(\"x25/socket\", 0444, init_net.proc_net,\n\t\t\t &x25_seq_socket_ops))\n\t\tgoto out;\n\n\tif (!proc_create_seq(\"x25/forward\", 0444, init_net.proc_net,\n\t\t\t &x25_seq_forward_ops))\n\t\tgoto out;\n\treturn 0;\n\nout:\n\tremove_proc_subtree(\"x25\", init_net.proc_net);\n\treturn -ENOMEM;\n}\n\nvoid __exit x25_proc_exit(void)\n{\n\tremove_proc_subtree(\"x25\", init_net.proc_net);\n}\n\n#else  \n\nint __init x25_proc_init(void)\n{\n\treturn 0;\n}\n\nvoid __exit x25_proc_exit(void)\n{\n}\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}