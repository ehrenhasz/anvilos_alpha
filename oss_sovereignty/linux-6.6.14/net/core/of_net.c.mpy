{
  "module_name": "of_net.c",
  "hash_id": "c84ca8a71401cd7caa0886a2d5551961f6f8305137db3586351a5131a25ed3b4",
  "original_prompt": "Ingested from linux-6.6.14/net/core/of_net.c",
  "human_readable_source": "\n \n#include <linux/etherdevice.h>\n#include <linux/kernel.h>\n#include <linux/of_net.h>\n#include <linux/of_platform.h>\n#include <linux/platform_device.h>\n#include <linux/phy.h>\n#include <linux/export.h>\n#include <linux/device.h>\n#include <linux/nvmem-consumer.h>\n\n \nint of_get_phy_mode(struct device_node *np, phy_interface_t *interface)\n{\n\tconst char *pm;\n\tint err, i;\n\n\t*interface = PHY_INTERFACE_MODE_NA;\n\n\terr = of_property_read_string(np, \"phy-mode\", &pm);\n\tif (err < 0)\n\t\terr = of_property_read_string(np, \"phy-connection-type\", &pm);\n\tif (err < 0)\n\t\treturn err;\n\n\tfor (i = 0; i < PHY_INTERFACE_MODE_MAX; i++)\n\t\tif (!strcasecmp(pm, phy_modes(i))) {\n\t\t\t*interface = i;\n\t\t\treturn 0;\n\t\t}\n\n\treturn -ENODEV;\n}\nEXPORT_SYMBOL_GPL(of_get_phy_mode);\n\nstatic int of_get_mac_addr(struct device_node *np, const char *name, u8 *addr)\n{\n\tstruct property *pp = of_find_property(np, name, NULL);\n\n\tif (pp && pp->length == ETH_ALEN && is_valid_ether_addr(pp->value)) {\n\t\tmemcpy(addr, pp->value, ETH_ALEN);\n\t\treturn 0;\n\t}\n\treturn -ENODEV;\n}\n\nint of_get_mac_address_nvmem(struct device_node *np, u8 *addr)\n{\n\tstruct platform_device *pdev = of_find_device_by_node(np);\n\tstruct nvmem_cell *cell;\n\tconst void *mac;\n\tsize_t len;\n\tint ret;\n\n\t \n\tif (pdev) {\n\t\tret = nvmem_get_mac_address(&pdev->dev, addr);\n\t\tput_device(&pdev->dev);\n\t\treturn ret;\n\t}\n\n\tcell = of_nvmem_cell_get(np, \"mac-address\");\n\tif (IS_ERR(cell))\n\t\treturn PTR_ERR(cell);\n\n\tmac = nvmem_cell_read(cell, &len);\n\tnvmem_cell_put(cell);\n\n\tif (IS_ERR(mac))\n\t\treturn PTR_ERR(mac);\n\n\tif (len != ETH_ALEN || !is_valid_ether_addr(mac)) {\n\t\tkfree(mac);\n\t\treturn -EINVAL;\n\t}\n\n\tmemcpy(addr, mac, ETH_ALEN);\n\tkfree(mac);\n\n\treturn 0;\n}\nEXPORT_SYMBOL(of_get_mac_address_nvmem);\n\n \nint of_get_mac_address(struct device_node *np, u8 *addr)\n{\n\tint ret;\n\n\tif (!np)\n\t\treturn -ENODEV;\n\n\tret = of_get_mac_addr(np, \"mac-address\", addr);\n\tif (!ret)\n\t\treturn 0;\n\n\tret = of_get_mac_addr(np, \"local-mac-address\", addr);\n\tif (!ret)\n\t\treturn 0;\n\n\tret = of_get_mac_addr(np, \"address\", addr);\n\tif (!ret)\n\t\treturn 0;\n\n\treturn of_get_mac_address_nvmem(np, addr);\n}\nEXPORT_SYMBOL(of_get_mac_address);\n\n \nint of_get_ethdev_address(struct device_node *np, struct net_device *dev)\n{\n\tu8 addr[ETH_ALEN];\n\tint ret;\n\n\tret = of_get_mac_address(np, addr);\n\tif (!ret)\n\t\teth_hw_addr_set(dev, addr);\n\treturn ret;\n}\nEXPORT_SYMBOL(of_get_ethdev_address);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}