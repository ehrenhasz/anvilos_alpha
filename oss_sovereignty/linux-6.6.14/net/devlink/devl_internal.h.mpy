{
  "module_name": "devl_internal.h",
  "hash_id": "f695c5fa73257bb86ddda0041f004c598be7cdd9f89e11cb88d24c1f8b190f83",
  "original_prompt": "Ingested from linux-6.6.14/net/devlink/devl_internal.h",
  "human_readable_source": " \n \n\n#include <linux/etherdevice.h>\n#include <linux/mutex.h>\n#include <linux/netdevice.h>\n#include <linux/notifier.h>\n#include <linux/types.h>\n#include <linux/workqueue.h>\n#include <linux/xarray.h>\n#include <net/devlink.h>\n#include <net/net_namespace.h>\n#include <net/rtnetlink.h>\n#include <rdma/ib_verbs.h>\n\n#include \"netlink_gen.h\"\n\n#define DEVLINK_REGISTERED XA_MARK_1\n\n#define DEVLINK_RELOAD_STATS_ARRAY_SIZE \\\n\t(__DEVLINK_RELOAD_LIMIT_MAX * __DEVLINK_RELOAD_ACTION_MAX)\n\nstruct devlink_dev_stats {\n\tu32 reload_stats[DEVLINK_RELOAD_STATS_ARRAY_SIZE];\n\tu32 remote_reload_stats[DEVLINK_RELOAD_STATS_ARRAY_SIZE];\n};\n\nstruct devlink {\n\tu32 index;\n\tstruct xarray ports;\n\tstruct list_head rate_list;\n\tstruct list_head sb_list;\n\tstruct list_head dpipe_table_list;\n\tstruct list_head resource_list;\n\tstruct xarray params;\n\tstruct list_head region_list;\n\tstruct list_head reporter_list;\n\tstruct devlink_dpipe_headers *dpipe_headers;\n\tstruct list_head trap_list;\n\tstruct list_head trap_group_list;\n\tstruct list_head trap_policer_list;\n\tstruct list_head linecard_list;\n\tconst struct devlink_ops *ops;\n\tstruct xarray snapshot_ids;\n\tstruct devlink_dev_stats stats;\n\tstruct device *dev;\n\tpossible_net_t _net;\n\t \n\tstruct mutex lock;\n\tstruct lock_class_key lock_key;\n\tu8 reload_failed:1;\n\trefcount_t refcount;\n\tstruct rcu_work rwork;\n\tchar priv[] __aligned(NETDEV_ALIGN);\n};\n\nextern struct xarray devlinks;\nextern struct genl_family devlink_nl_family;\n\n \n#define ASSERT_DEVLINK_REGISTERED(d)                                           \\\n\tWARN_ON_ONCE(!xa_get_mark(&devlinks, (d)->index, DEVLINK_REGISTERED))\n#define ASSERT_DEVLINK_NOT_REGISTERED(d)                                       \\\n\tWARN_ON_ONCE(xa_get_mark(&devlinks, (d)->index, DEVLINK_REGISTERED))\n\n \n#define devlinks_xa_for_each_registered_get(net, index, devlink)\t\\\n\tfor (index = 0; (devlink = devlinks_xa_find_get(net, &index)); index++)\n\nstruct devlink *devlinks_xa_find_get(struct net *net, unsigned long *indexp);\n\nstatic inline bool devl_is_registered(struct devlink *devlink)\n{\n\tdevl_assert_locked(devlink);\n\treturn xa_get_mark(&devlinks, devlink->index, DEVLINK_REGISTERED);\n}\n\n \n#define DEVLINK_NL_FLAG_NEED_PORT\t\tBIT(0)\n#define DEVLINK_NL_FLAG_NEED_DEVLINK_OR_PORT\tBIT(1)\n\nenum devlink_multicast_groups {\n\tDEVLINK_MCGRP_CONFIG,\n};\n\n \nstruct devlink_nl_dump_state {\n\tunsigned long instance;\n\tint idx;\n\tunion {\n\t\t \n\t\tstruct {\n\t\t\tu64 start_offset;\n\t\t};\n\t\t \n\t\tstruct {\n\t\t\tu64 dump_ts;\n\t\t};\n\t};\n};\n\ntypedef int devlink_nl_dump_one_func_t(struct sk_buff *msg,\n\t\t\t\t       struct devlink *devlink,\n\t\t\t\t       struct netlink_callback *cb,\n\t\t\t\t       int flags);\n\nstruct devlink *\ndevlink_get_from_attrs_lock(struct net *net, struct nlattr **attrs);\n\nint devlink_nl_dumpit(struct sk_buff *msg, struct netlink_callback *cb,\n\t\t      devlink_nl_dump_one_func_t *dump_one);\n\nstatic inline struct devlink_nl_dump_state *\ndevlink_dump_state(struct netlink_callback *cb)\n{\n\tNL_ASSERT_DUMP_CTX_FITS(struct devlink_nl_dump_state);\n\n\treturn (struct devlink_nl_dump_state *)cb->ctx;\n}\n\nstatic inline int\ndevlink_nl_put_handle(struct sk_buff *msg, struct devlink *devlink)\n{\n\tif (nla_put_string(msg, DEVLINK_ATTR_BUS_NAME, devlink->dev->bus->name))\n\t\treturn -EMSGSIZE;\n\tif (nla_put_string(msg, DEVLINK_ATTR_DEV_NAME, dev_name(devlink->dev)))\n\t\treturn -EMSGSIZE;\n\treturn 0;\n}\n\nint devlink_nl_msg_reply_and_new(struct sk_buff **msg, struct genl_info *info);\n\n \nvoid devlink_notify_register(struct devlink *devlink);\nvoid devlink_notify_unregister(struct devlink *devlink);\nvoid devlink_ports_notify_register(struct devlink *devlink);\nvoid devlink_ports_notify_unregister(struct devlink *devlink);\nvoid devlink_params_notify_register(struct devlink *devlink);\nvoid devlink_params_notify_unregister(struct devlink *devlink);\nvoid devlink_regions_notify_register(struct devlink *devlink);\nvoid devlink_regions_notify_unregister(struct devlink *devlink);\nvoid devlink_trap_policers_notify_register(struct devlink *devlink);\nvoid devlink_trap_policers_notify_unregister(struct devlink *devlink);\nvoid devlink_trap_groups_notify_register(struct devlink *devlink);\nvoid devlink_trap_groups_notify_unregister(struct devlink *devlink);\nvoid devlink_traps_notify_register(struct devlink *devlink);\nvoid devlink_traps_notify_unregister(struct devlink *devlink);\nvoid devlink_rates_notify_register(struct devlink *devlink);\nvoid devlink_rates_notify_unregister(struct devlink *devlink);\nvoid devlink_linecards_notify_register(struct devlink *devlink);\nvoid devlink_linecards_notify_unregister(struct devlink *devlink);\n\n \n#define ASSERT_DEVLINK_PORT_INITIALIZED(devlink_port)\t\t\t\t\\\n\tWARN_ON_ONCE(!(devlink_port)->initialized)\n\nstruct devlink_port *devlink_port_get_by_index(struct devlink *devlink,\n\t\t\t\t\t       unsigned int port_index);\nint devlink_port_netdevice_event(struct notifier_block *nb,\n\t\t\t\t unsigned long event, void *ptr);\nstruct devlink_port *\ndevlink_port_get_from_info(struct devlink *devlink, struct genl_info *info);\nstruct devlink_port *devlink_port_get_from_attrs(struct devlink *devlink,\n\t\t\t\t\t\t struct nlattr **attrs);\n\n \nbool devlink_reload_actions_valid(const struct devlink_ops *ops);\nint devlink_reload(struct devlink *devlink, struct net *dest_net,\n\t\t   enum devlink_reload_action action,\n\t\t   enum devlink_reload_limit limit,\n\t\t   u32 *actions_performed, struct netlink_ext_ack *extack);\n\nstatic inline bool devlink_reload_supported(const struct devlink_ops *ops)\n{\n\treturn ops->reload_down && ops->reload_up;\n}\n\n \nvoid devlink_params_driverinit_load_new(struct devlink *devlink);\n\n \nstruct devlink_resource;\nint devlink_resources_validate(struct devlink *devlink,\n\t\t\t       struct devlink_resource *resource,\n\t\t\t       struct genl_info *info);\n\n \nint devlink_rate_nodes_check(struct devlink *devlink, u16 mode,\n\t\t\t     struct netlink_ext_ack *extack);\n\n \nstruct devlink_linecard {\n\tstruct list_head list;\n\tstruct devlink *devlink;\n\tunsigned int index;\n\tconst struct devlink_linecard_ops *ops;\n\tvoid *priv;\n\tenum devlink_linecard_state state;\n\tstruct mutex state_lock;  \n\tconst char *type;\n\tstruct devlink_linecard_type *types;\n\tunsigned int types_count;\n\tstruct devlink *nested_devlink;\n};\n\n \nint devlink_nl_cmd_reload(struct sk_buff *skb, struct genl_info *info);\nint devlink_nl_cmd_eswitch_get_doit(struct sk_buff *skb, struct genl_info *info);\nint devlink_nl_cmd_eswitch_set_doit(struct sk_buff *skb, struct genl_info *info);\nint devlink_nl_cmd_flash_update(struct sk_buff *skb, struct genl_info *info);\nint devlink_nl_cmd_selftests_run(struct sk_buff *skb, struct genl_info *info);\nint devlink_nl_cmd_port_set_doit(struct sk_buff *skb, struct genl_info *info);\nint devlink_nl_cmd_port_split_doit(struct sk_buff *skb, struct genl_info *info);\nint devlink_nl_cmd_port_unsplit_doit(struct sk_buff *skb,\n\t\t\t\t     struct genl_info *info);\nint devlink_nl_cmd_port_new_doit(struct sk_buff *skb, struct genl_info *info);\nint devlink_nl_cmd_port_del_doit(struct sk_buff *skb, struct genl_info *info);\nint devlink_nl_cmd_sb_pool_set_doit(struct sk_buff *skb, struct genl_info *info);\nint devlink_nl_cmd_sb_port_pool_set_doit(struct sk_buff *skb,\n\t\t\t\t\t struct genl_info *info);\nint devlink_nl_cmd_sb_tc_pool_bind_set_doit(struct sk_buff *skb,\n\t\t\t\t\t    struct genl_info *info);\nint devlink_nl_cmd_sb_occ_snapshot_doit(struct sk_buff *skb,\n\t\t\t\t\tstruct genl_info *info);\nint devlink_nl_cmd_sb_occ_max_clear_doit(struct sk_buff *skb,\n\t\t\t\t\t struct genl_info *info);\nint devlink_nl_cmd_dpipe_table_get(struct sk_buff *skb, struct genl_info *info);\nint devlink_nl_cmd_dpipe_entries_get(struct sk_buff *skb,\n\t\t\t\t     struct genl_info *info);\nint devlink_nl_cmd_dpipe_headers_get(struct sk_buff *skb,\n\t\t\t\t     struct genl_info *info);\nint devlink_nl_cmd_dpipe_table_counters_set(struct sk_buff *skb,\n\t\t\t\t\t    struct genl_info *info);\nint devlink_nl_cmd_resource_set(struct sk_buff *skb, struct genl_info *info);\nint devlink_nl_cmd_resource_dump(struct sk_buff *skb, struct genl_info *info);\nint devlink_nl_cmd_param_set_doit(struct sk_buff *skb, struct genl_info *info);\nint devlink_nl_cmd_port_param_get_dumpit(struct sk_buff *msg,\n\t\t\t\t\t struct netlink_callback *cb);\nint devlink_nl_cmd_port_param_get_doit(struct sk_buff *skb,\n\t\t\t\t       struct genl_info *info);\nint devlink_nl_cmd_port_param_set_doit(struct sk_buff *skb,\n\t\t\t\t       struct genl_info *info);\nint devlink_nl_cmd_region_new(struct sk_buff *skb, struct genl_info *info);\nint devlink_nl_cmd_region_del(struct sk_buff *skb, struct genl_info *info);\nint devlink_nl_cmd_region_read_dumpit(struct sk_buff *skb,\n\t\t\t\t      struct netlink_callback *cb);\nint devlink_nl_cmd_health_reporter_set_doit(struct sk_buff *skb,\n\t\t\t\t\t    struct genl_info *info);\nint devlink_nl_cmd_health_reporter_recover_doit(struct sk_buff *skb,\n\t\t\t\t\t\tstruct genl_info *info);\nint devlink_nl_cmd_health_reporter_diagnose_doit(struct sk_buff *skb,\n\t\t\t\t\t\t struct genl_info *info);\nint devlink_nl_cmd_health_reporter_dump_get_dumpit(struct sk_buff *skb,\n\t\t\t\t\t\t   struct netlink_callback *cb);\nint devlink_nl_cmd_health_reporter_dump_clear_doit(struct sk_buff *skb,\n\t\t\t\t\t\t   struct genl_info *info);\nint devlink_nl_cmd_health_reporter_test_doit(struct sk_buff *skb,\n\t\t\t\t\t     struct genl_info *info);\nint devlink_nl_cmd_trap_set_doit(struct sk_buff *skb, struct genl_info *info);\nint devlink_nl_cmd_trap_group_set_doit(struct sk_buff *skb,\n\t\t\t\t       struct genl_info *info);\nint devlink_nl_cmd_trap_policer_set_doit(struct sk_buff *skb,\n\t\t\t\t\t struct genl_info *info);\nint devlink_nl_cmd_rate_set_doit(struct sk_buff *skb, struct genl_info *info);\nint devlink_nl_cmd_rate_new_doit(struct sk_buff *skb, struct genl_info *info);\nint devlink_nl_cmd_rate_del_doit(struct sk_buff *skb, struct genl_info *info);\nint devlink_nl_cmd_linecard_set_doit(struct sk_buff *skb,\n\t\t\t\t     struct genl_info *info);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}