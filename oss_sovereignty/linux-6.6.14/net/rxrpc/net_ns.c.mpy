{
  "module_name": "net_ns.c",
  "hash_id": "692fdc9542c488e24313ff9b4a89ffea40ef880c2649e60f61c960623ea07c71",
  "original_prompt": "Ingested from linux-6.6.14/net/rxrpc/net_ns.c",
  "human_readable_source": "\n \n\n#include <linux/proc_fs.h>\n#include \"ar-internal.h\"\n\nunsigned int rxrpc_net_id;\n\nstatic void rxrpc_service_conn_reap_timeout(struct timer_list *timer)\n{\n\tstruct rxrpc_net *rxnet =\n\t\tcontainer_of(timer, struct rxrpc_net, service_conn_reap_timer);\n\n\tif (rxnet->live)\n\t\trxrpc_queue_work(&rxnet->service_conn_reaper);\n}\n\nstatic void rxrpc_peer_keepalive_timeout(struct timer_list *timer)\n{\n\tstruct rxrpc_net *rxnet =\n\t\tcontainer_of(timer, struct rxrpc_net, peer_keepalive_timer);\n\n\tif (rxnet->live)\n\t\trxrpc_queue_work(&rxnet->peer_keepalive_work);\n}\n\n \nstatic __net_init int rxrpc_init_net(struct net *net)\n{\n\tstruct rxrpc_net *rxnet = rxrpc_net(net);\n\tint ret, i;\n\n\trxnet->live = true;\n\tget_random_bytes(&rxnet->epoch, sizeof(rxnet->epoch));\n\trxnet->epoch |= RXRPC_RANDOM_EPOCH;\n\n\tINIT_LIST_HEAD(&rxnet->calls);\n\tspin_lock_init(&rxnet->call_lock);\n\tatomic_set(&rxnet->nr_calls, 1);\n\n\tatomic_set(&rxnet->nr_conns, 1);\n\tINIT_LIST_HEAD(&rxnet->conn_proc_list);\n\tINIT_LIST_HEAD(&rxnet->service_conns);\n\trwlock_init(&rxnet->conn_lock);\n\tINIT_WORK(&rxnet->service_conn_reaper,\n\t\t  rxrpc_service_connection_reaper);\n\ttimer_setup(&rxnet->service_conn_reap_timer,\n\t\t    rxrpc_service_conn_reap_timeout, 0);\n\n\tatomic_set(&rxnet->nr_client_conns, 0);\n\n\tINIT_HLIST_HEAD(&rxnet->local_endpoints);\n\tmutex_init(&rxnet->local_mutex);\n\n\thash_init(rxnet->peer_hash);\n\tspin_lock_init(&rxnet->peer_hash_lock);\n\tfor (i = 0; i < ARRAY_SIZE(rxnet->peer_keepalive); i++)\n\t\tINIT_LIST_HEAD(&rxnet->peer_keepalive[i]);\n\tINIT_LIST_HEAD(&rxnet->peer_keepalive_new);\n\ttimer_setup(&rxnet->peer_keepalive_timer,\n\t\t    rxrpc_peer_keepalive_timeout, 0);\n\tINIT_WORK(&rxnet->peer_keepalive_work, rxrpc_peer_keepalive_worker);\n\trxnet->peer_keepalive_base = ktime_get_seconds();\n\n\tret = -ENOMEM;\n\trxnet->proc_net = proc_net_mkdir(net, \"rxrpc\", net->proc_net);\n\tif (!rxnet->proc_net)\n\t\tgoto err_proc;\n\n\tproc_create_net(\"calls\", 0444, rxnet->proc_net, &rxrpc_call_seq_ops,\n\t\t\tsizeof(struct seq_net_private));\n\tproc_create_net(\"conns\", 0444, rxnet->proc_net,\n\t\t\t&rxrpc_connection_seq_ops,\n\t\t\tsizeof(struct seq_net_private));\n\tproc_create_net(\"peers\", 0444, rxnet->proc_net,\n\t\t\t&rxrpc_peer_seq_ops,\n\t\t\tsizeof(struct seq_net_private));\n\tproc_create_net(\"locals\", 0444, rxnet->proc_net,\n\t\t\t&rxrpc_local_seq_ops,\n\t\t\tsizeof(struct seq_net_private));\n\tproc_create_net_single_write(\"stats\", S_IFREG | 0644, rxnet->proc_net,\n\t\t\t\t     rxrpc_stats_show, rxrpc_stats_clear, NULL);\n\treturn 0;\n\nerr_proc:\n\trxnet->live = false;\n\treturn ret;\n}\n\n \nstatic __net_exit void rxrpc_exit_net(struct net *net)\n{\n\tstruct rxrpc_net *rxnet = rxrpc_net(net);\n\n\trxnet->live = false;\n\tdel_timer_sync(&rxnet->peer_keepalive_timer);\n\tcancel_work_sync(&rxnet->peer_keepalive_work);\n\t \n\tdel_timer_sync(&rxnet->peer_keepalive_timer);\n\trxrpc_destroy_all_calls(rxnet);\n\trxrpc_destroy_all_connections(rxnet);\n\trxrpc_destroy_all_peers(rxnet);\n\trxrpc_destroy_all_locals(rxnet);\n\tproc_remove(rxnet->proc_net);\n}\n\nstruct pernet_operations rxrpc_net_ops = {\n\t.init\t= rxrpc_init_net,\n\t.exit\t= rxrpc_exit_net,\n\t.id\t= &rxrpc_net_id,\n\t.size\t= sizeof(struct rxrpc_net),\n};\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}