{
  "module_name": "netlink.c",
  "hash_id": "b9de712b793b16dfa58678b486ac5df60feaf73245aa71c1d38bb295c362945a",
  "original_prompt": "Ingested from linux-6.6.14/net/ethtool/netlink.c",
  "human_readable_source": "\n\n#include <net/sock.h>\n#include <linux/ethtool_netlink.h>\n#include <linux/pm_runtime.h>\n#include \"netlink.h\"\n\nstatic struct genl_family ethtool_genl_family;\n\nstatic bool ethnl_ok __read_mostly;\nstatic u32 ethnl_bcast_seq;\n\n#define ETHTOOL_FLAGS_BASIC (ETHTOOL_FLAG_COMPACT_BITSETS |\t\\\n\t\t\t     ETHTOOL_FLAG_OMIT_REPLY)\n#define ETHTOOL_FLAGS_STATS (ETHTOOL_FLAGS_BASIC | ETHTOOL_FLAG_STATS)\n\nconst struct nla_policy ethnl_header_policy[] = {\n\t[ETHTOOL_A_HEADER_DEV_INDEX]\t= { .type = NLA_U32 },\n\t[ETHTOOL_A_HEADER_DEV_NAME]\t= { .type = NLA_NUL_STRING,\n\t\t\t\t\t    .len = ALTIFNAMSIZ - 1 },\n\t[ETHTOOL_A_HEADER_FLAGS]\t= NLA_POLICY_MASK(NLA_U32,\n\t\t\t\t\t\t\t  ETHTOOL_FLAGS_BASIC),\n};\n\nconst struct nla_policy ethnl_header_policy_stats[] = {\n\t[ETHTOOL_A_HEADER_DEV_INDEX]\t= { .type = NLA_U32 },\n\t[ETHTOOL_A_HEADER_DEV_NAME]\t= { .type = NLA_NUL_STRING,\n\t\t\t\t\t    .len = ALTIFNAMSIZ - 1 },\n\t[ETHTOOL_A_HEADER_FLAGS]\t= NLA_POLICY_MASK(NLA_U32,\n\t\t\t\t\t\t\t  ETHTOOL_FLAGS_STATS),\n};\n\nint ethnl_ops_begin(struct net_device *dev)\n{\n\tint ret;\n\n\tif (!dev)\n\t\treturn -ENODEV;\n\n\tif (dev->dev.parent)\n\t\tpm_runtime_get_sync(dev->dev.parent);\n\n\tif (!netif_device_present(dev) ||\n\t    dev->reg_state == NETREG_UNREGISTERING) {\n\t\tret = -ENODEV;\n\t\tgoto err;\n\t}\n\n\tif (dev->ethtool_ops->begin) {\n\t\tret = dev->ethtool_ops->begin(dev);\n\t\tif (ret)\n\t\t\tgoto err;\n\t}\n\n\treturn 0;\nerr:\n\tif (dev->dev.parent)\n\t\tpm_runtime_put(dev->dev.parent);\n\n\treturn ret;\n}\n\nvoid ethnl_ops_complete(struct net_device *dev)\n{\n\tif (dev->ethtool_ops->complete)\n\t\tdev->ethtool_ops->complete(dev);\n\n\tif (dev->dev.parent)\n\t\tpm_runtime_put(dev->dev.parent);\n}\n\n \nint ethnl_parse_header_dev_get(struct ethnl_req_info *req_info,\n\t\t\t       const struct nlattr *header, struct net *net,\n\t\t\t       struct netlink_ext_ack *extack, bool require_dev)\n{\n\tstruct nlattr *tb[ARRAY_SIZE(ethnl_header_policy)];\n\tconst struct nlattr *devname_attr;\n\tstruct net_device *dev = NULL;\n\tu32 flags = 0;\n\tint ret;\n\n\tif (!header) {\n\t\tif (!require_dev)\n\t\t\treturn 0;\n\t\tNL_SET_ERR_MSG(extack, \"request header missing\");\n\t\treturn -EINVAL;\n\t}\n\t \n\tret = nla_parse_nested(tb, ARRAY_SIZE(ethnl_header_policy) - 1, header,\n\t\t\t       NULL, extack);\n\tif (ret < 0)\n\t\treturn ret;\n\tif (tb[ETHTOOL_A_HEADER_FLAGS])\n\t\tflags = nla_get_u32(tb[ETHTOOL_A_HEADER_FLAGS]);\n\n\tdevname_attr = tb[ETHTOOL_A_HEADER_DEV_NAME];\n\tif (tb[ETHTOOL_A_HEADER_DEV_INDEX]) {\n\t\tu32 ifindex = nla_get_u32(tb[ETHTOOL_A_HEADER_DEV_INDEX]);\n\n\t\tdev = netdev_get_by_index(net, ifindex, &req_info->dev_tracker,\n\t\t\t\t\t  GFP_KERNEL);\n\t\tif (!dev) {\n\t\t\tNL_SET_ERR_MSG_ATTR(extack,\n\t\t\t\t\t    tb[ETHTOOL_A_HEADER_DEV_INDEX],\n\t\t\t\t\t    \"no device matches ifindex\");\n\t\t\treturn -ENODEV;\n\t\t}\n\t\t \n\t\tif (devname_attr &&\n\t\t    strncmp(dev->name, nla_data(devname_attr), IFNAMSIZ)) {\n\t\t\tnetdev_put(dev, &req_info->dev_tracker);\n\t\t\tNL_SET_ERR_MSG_ATTR(extack, header,\n\t\t\t\t\t    \"ifindex and name do not match\");\n\t\t\treturn -ENODEV;\n\t\t}\n\t} else if (devname_attr) {\n\t\tdev = netdev_get_by_name(net, nla_data(devname_attr),\n\t\t\t\t\t &req_info->dev_tracker, GFP_KERNEL);\n\t\tif (!dev) {\n\t\t\tNL_SET_ERR_MSG_ATTR(extack, devname_attr,\n\t\t\t\t\t    \"no device matches name\");\n\t\t\treturn -ENODEV;\n\t\t}\n\t} else if (require_dev) {\n\t\tNL_SET_ERR_MSG_ATTR(extack, header,\n\t\t\t\t    \"neither ifindex nor name specified\");\n\t\treturn -EINVAL;\n\t}\n\n\treq_info->dev = dev;\n\treq_info->flags = flags;\n\treturn 0;\n}\n\n \nint ethnl_fill_reply_header(struct sk_buff *skb, struct net_device *dev,\n\t\t\t    u16 attrtype)\n{\n\tstruct nlattr *nest;\n\n\tif (!dev)\n\t\treturn 0;\n\tnest = nla_nest_start(skb, attrtype);\n\tif (!nest)\n\t\treturn -EMSGSIZE;\n\n\tif (nla_put_u32(skb, ETHTOOL_A_HEADER_DEV_INDEX, (u32)dev->ifindex) ||\n\t    nla_put_string(skb, ETHTOOL_A_HEADER_DEV_NAME, dev->name))\n\t\tgoto nla_put_failure;\n\t \n\n\tnla_nest_end(skb, nest);\n\treturn 0;\n\nnla_put_failure:\n\tnla_nest_cancel(skb, nest);\n\treturn -EMSGSIZE;\n}\n\n \nstruct sk_buff *ethnl_reply_init(size_t payload, struct net_device *dev, u8 cmd,\n\t\t\t\t u16 hdr_attrtype, struct genl_info *info,\n\t\t\t\t void **ehdrp)\n{\n\tstruct sk_buff *skb;\n\n\tskb = genlmsg_new(payload, GFP_KERNEL);\n\tif (!skb)\n\t\tgoto err;\n\t*ehdrp = genlmsg_put_reply(skb, info, &ethtool_genl_family, 0, cmd);\n\tif (!*ehdrp)\n\t\tgoto err_free;\n\n\tif (dev) {\n\t\tint ret;\n\n\t\tret = ethnl_fill_reply_header(skb, dev, hdr_attrtype);\n\t\tif (ret < 0)\n\t\t\tgoto err_free;\n\t}\n\treturn skb;\n\nerr_free:\n\tnlmsg_free(skb);\nerr:\n\tif (info)\n\t\tGENL_SET_ERR_MSG(info, \"failed to setup reply message\");\n\treturn NULL;\n}\n\nvoid *ethnl_dump_put(struct sk_buff *skb, struct netlink_callback *cb, u8 cmd)\n{\n\treturn genlmsg_put(skb, NETLINK_CB(cb->skb).portid, cb->nlh->nlmsg_seq,\n\t\t\t   &ethtool_genl_family, 0, cmd);\n}\n\nvoid *ethnl_bcastmsg_put(struct sk_buff *skb, u8 cmd)\n{\n\treturn genlmsg_put(skb, 0, ++ethnl_bcast_seq, &ethtool_genl_family, 0,\n\t\t\t   cmd);\n}\n\nint ethnl_multicast(struct sk_buff *skb, struct net_device *dev)\n{\n\treturn genlmsg_multicast_netns(&ethtool_genl_family, dev_net(dev), skb,\n\t\t\t\t       0, ETHNL_MCGRP_MONITOR, GFP_KERNEL);\n}\n\n \n\n \nstruct ethnl_dump_ctx {\n\tconst struct ethnl_request_ops\t*ops;\n\tstruct ethnl_req_info\t\t*req_info;\n\tstruct ethnl_reply_data\t\t*reply_data;\n\tunsigned long\t\t\tpos_ifindex;\n};\n\nstatic const struct ethnl_request_ops *\nethnl_default_requests[__ETHTOOL_MSG_USER_CNT] = {\n\t[ETHTOOL_MSG_STRSET_GET]\t= &ethnl_strset_request_ops,\n\t[ETHTOOL_MSG_LINKINFO_GET]\t= &ethnl_linkinfo_request_ops,\n\t[ETHTOOL_MSG_LINKINFO_SET]\t= &ethnl_linkinfo_request_ops,\n\t[ETHTOOL_MSG_LINKMODES_GET]\t= &ethnl_linkmodes_request_ops,\n\t[ETHTOOL_MSG_LINKMODES_SET]\t= &ethnl_linkmodes_request_ops,\n\t[ETHTOOL_MSG_LINKSTATE_GET]\t= &ethnl_linkstate_request_ops,\n\t[ETHTOOL_MSG_DEBUG_GET]\t\t= &ethnl_debug_request_ops,\n\t[ETHTOOL_MSG_DEBUG_SET]\t\t= &ethnl_debug_request_ops,\n\t[ETHTOOL_MSG_WOL_GET]\t\t= &ethnl_wol_request_ops,\n\t[ETHTOOL_MSG_WOL_SET]\t\t= &ethnl_wol_request_ops,\n\t[ETHTOOL_MSG_FEATURES_GET]\t= &ethnl_features_request_ops,\n\t[ETHTOOL_MSG_PRIVFLAGS_GET]\t= &ethnl_privflags_request_ops,\n\t[ETHTOOL_MSG_PRIVFLAGS_SET]\t= &ethnl_privflags_request_ops,\n\t[ETHTOOL_MSG_RINGS_GET]\t\t= &ethnl_rings_request_ops,\n\t[ETHTOOL_MSG_RINGS_SET]\t\t= &ethnl_rings_request_ops,\n\t[ETHTOOL_MSG_CHANNELS_GET]\t= &ethnl_channels_request_ops,\n\t[ETHTOOL_MSG_CHANNELS_SET]\t= &ethnl_channels_request_ops,\n\t[ETHTOOL_MSG_COALESCE_GET]\t= &ethnl_coalesce_request_ops,\n\t[ETHTOOL_MSG_COALESCE_SET]\t= &ethnl_coalesce_request_ops,\n\t[ETHTOOL_MSG_PAUSE_GET]\t\t= &ethnl_pause_request_ops,\n\t[ETHTOOL_MSG_PAUSE_SET]\t\t= &ethnl_pause_request_ops,\n\t[ETHTOOL_MSG_EEE_GET]\t\t= &ethnl_eee_request_ops,\n\t[ETHTOOL_MSG_EEE_SET]\t\t= &ethnl_eee_request_ops,\n\t[ETHTOOL_MSG_FEC_GET]\t\t= &ethnl_fec_request_ops,\n\t[ETHTOOL_MSG_FEC_SET]\t\t= &ethnl_fec_request_ops,\n\t[ETHTOOL_MSG_TSINFO_GET]\t= &ethnl_tsinfo_request_ops,\n\t[ETHTOOL_MSG_MODULE_EEPROM_GET]\t= &ethnl_module_eeprom_request_ops,\n\t[ETHTOOL_MSG_STATS_GET]\t\t= &ethnl_stats_request_ops,\n\t[ETHTOOL_MSG_PHC_VCLOCKS_GET]\t= &ethnl_phc_vclocks_request_ops,\n\t[ETHTOOL_MSG_MODULE_GET]\t= &ethnl_module_request_ops,\n\t[ETHTOOL_MSG_MODULE_SET]\t= &ethnl_module_request_ops,\n\t[ETHTOOL_MSG_PSE_GET]\t\t= &ethnl_pse_request_ops,\n\t[ETHTOOL_MSG_PSE_SET]\t\t= &ethnl_pse_request_ops,\n\t[ETHTOOL_MSG_RSS_GET]\t\t= &ethnl_rss_request_ops,\n\t[ETHTOOL_MSG_PLCA_GET_CFG]\t= &ethnl_plca_cfg_request_ops,\n\t[ETHTOOL_MSG_PLCA_SET_CFG]\t= &ethnl_plca_cfg_request_ops,\n\t[ETHTOOL_MSG_PLCA_GET_STATUS]\t= &ethnl_plca_status_request_ops,\n\t[ETHTOOL_MSG_MM_GET]\t\t= &ethnl_mm_request_ops,\n\t[ETHTOOL_MSG_MM_SET]\t\t= &ethnl_mm_request_ops,\n};\n\nstatic struct ethnl_dump_ctx *ethnl_dump_context(struct netlink_callback *cb)\n{\n\treturn (struct ethnl_dump_ctx *)cb->ctx;\n}\n\n \nstatic int ethnl_default_parse(struct ethnl_req_info *req_info,\n\t\t\t       const struct genl_info *info,\n\t\t\t       const struct ethnl_request_ops *request_ops,\n\t\t\t       bool require_dev)\n{\n\tstruct nlattr **tb = info->attrs;\n\tint ret;\n\n\tret = ethnl_parse_header_dev_get(req_info, tb[request_ops->hdr_attr],\n\t\t\t\t\t genl_info_net(info), info->extack,\n\t\t\t\t\t require_dev);\n\tif (ret < 0)\n\t\treturn ret;\n\n\tif (request_ops->parse_request) {\n\t\tret = request_ops->parse_request(req_info, tb, info->extack);\n\t\tif (ret < 0)\n\t\t\treturn ret;\n\t}\n\n\treturn 0;\n}\n\n \nstatic void ethnl_init_reply_data(struct ethnl_reply_data *reply_data,\n\t\t\t\t  const struct ethnl_request_ops *ops,\n\t\t\t\t  struct net_device *dev)\n{\n\tmemset(reply_data, 0, ops->reply_data_size);\n\treply_data->dev = dev;\n}\n\n \nstatic int ethnl_default_doit(struct sk_buff *skb, struct genl_info *info)\n{\n\tstruct ethnl_reply_data *reply_data = NULL;\n\tstruct ethnl_req_info *req_info = NULL;\n\tconst u8 cmd = info->genlhdr->cmd;\n\tconst struct ethnl_request_ops *ops;\n\tint hdr_len, reply_len;\n\tstruct sk_buff *rskb;\n\tvoid *reply_payload;\n\tint ret;\n\n\tops = ethnl_default_requests[cmd];\n\tif (WARN_ONCE(!ops, \"cmd %u has no ethnl_request_ops\\n\", cmd))\n\t\treturn -EOPNOTSUPP;\n\tif (GENL_REQ_ATTR_CHECK(info, ops->hdr_attr))\n\t\treturn -EINVAL;\n\n\treq_info = kzalloc(ops->req_info_size, GFP_KERNEL);\n\tif (!req_info)\n\t\treturn -ENOMEM;\n\treply_data = kmalloc(ops->reply_data_size, GFP_KERNEL);\n\tif (!reply_data) {\n\t\tkfree(req_info);\n\t\treturn -ENOMEM;\n\t}\n\n\tret = ethnl_default_parse(req_info, info, ops, !ops->allow_nodev_do);\n\tif (ret < 0)\n\t\tgoto err_dev;\n\tethnl_init_reply_data(reply_data, ops, req_info->dev);\n\n\trtnl_lock();\n\tret = ops->prepare_data(req_info, reply_data, info);\n\trtnl_unlock();\n\tif (ret < 0)\n\t\tgoto err_cleanup;\n\tret = ops->reply_size(req_info, reply_data);\n\tif (ret < 0)\n\t\tgoto err_cleanup;\n\treply_len = ret;\n\tret = -ENOMEM;\n\trskb = ethnl_reply_init(reply_len + ethnl_reply_header_size(),\n\t\t\t\treq_info->dev, ops->reply_cmd,\n\t\t\t\tops->hdr_attr, info, &reply_payload);\n\tif (!rskb)\n\t\tgoto err_cleanup;\n\thdr_len = rskb->len;\n\tret = ops->fill_reply(rskb, req_info, reply_data);\n\tif (ret < 0)\n\t\tgoto err_msg;\n\tWARN_ONCE(rskb->len - hdr_len > reply_len,\n\t\t  \"ethnl cmd %d: calculated reply length %d, but consumed %d\\n\",\n\t\t  cmd, reply_len, rskb->len - hdr_len);\n\tif (ops->cleanup_data)\n\t\tops->cleanup_data(reply_data);\n\n\tgenlmsg_end(rskb, reply_payload);\n\tnetdev_put(req_info->dev, &req_info->dev_tracker);\n\tkfree(reply_data);\n\tkfree(req_info);\n\treturn genlmsg_reply(rskb, info);\n\nerr_msg:\n\tWARN_ONCE(ret == -EMSGSIZE, \"calculated message payload length (%d) not sufficient\\n\", reply_len);\n\tnlmsg_free(rskb);\nerr_cleanup:\n\tif (ops->cleanup_data)\n\t\tops->cleanup_data(reply_data);\nerr_dev:\n\tnetdev_put(req_info->dev, &req_info->dev_tracker);\n\tkfree(reply_data);\n\tkfree(req_info);\n\treturn ret;\n}\n\nstatic int ethnl_default_dump_one(struct sk_buff *skb, struct net_device *dev,\n\t\t\t\t  const struct ethnl_dump_ctx *ctx,\n\t\t\t\t  const struct genl_info *info)\n{\n\tvoid *ehdr;\n\tint ret;\n\n\tehdr = genlmsg_put(skb, info->snd_portid, info->snd_seq,\n\t\t\t   &ethtool_genl_family, NLM_F_MULTI,\n\t\t\t   ctx->ops->reply_cmd);\n\tif (!ehdr)\n\t\treturn -EMSGSIZE;\n\n\tethnl_init_reply_data(ctx->reply_data, ctx->ops, dev);\n\trtnl_lock();\n\tret = ctx->ops->prepare_data(ctx->req_info, ctx->reply_data, info);\n\trtnl_unlock();\n\tif (ret < 0)\n\t\tgoto out;\n\tret = ethnl_fill_reply_header(skb, dev, ctx->ops->hdr_attr);\n\tif (ret < 0)\n\t\tgoto out;\n\tret = ctx->ops->fill_reply(skb, ctx->req_info, ctx->reply_data);\n\nout:\n\tif (ctx->ops->cleanup_data)\n\t\tctx->ops->cleanup_data(ctx->reply_data);\n\tctx->reply_data->dev = NULL;\n\tif (ret < 0)\n\t\tgenlmsg_cancel(skb, ehdr);\n\telse\n\t\tgenlmsg_end(skb, ehdr);\n\treturn ret;\n}\n\n \nstatic int ethnl_default_dumpit(struct sk_buff *skb,\n\t\t\t\tstruct netlink_callback *cb)\n{\n\tstruct ethnl_dump_ctx *ctx = ethnl_dump_context(cb);\n\tstruct net *net = sock_net(skb->sk);\n\tstruct net_device *dev;\n\tint ret = 0;\n\n\trtnl_lock();\n\tfor_each_netdev_dump(net, dev, ctx->pos_ifindex) {\n\t\tdev_hold(dev);\n\t\trtnl_unlock();\n\n\t\tret = ethnl_default_dump_one(skb, dev, ctx, genl_info_dump(cb));\n\n\t\trtnl_lock();\n\t\tdev_put(dev);\n\n\t\tif (ret < 0 && ret != -EOPNOTSUPP) {\n\t\t\tif (likely(skb->len))\n\t\t\t\tret = skb->len;\n\t\t\tbreak;\n\t\t}\n\t\tret = 0;\n\t}\n\trtnl_unlock();\n\n\treturn ret;\n}\n\n \nstatic int ethnl_default_start(struct netlink_callback *cb)\n{\n\tconst struct genl_dumpit_info *info = genl_dumpit_info(cb);\n\tstruct ethnl_dump_ctx *ctx = ethnl_dump_context(cb);\n\tstruct ethnl_reply_data *reply_data;\n\tconst struct ethnl_request_ops *ops;\n\tstruct ethnl_req_info *req_info;\n\tstruct genlmsghdr *ghdr;\n\tint ret;\n\n\tBUILD_BUG_ON(sizeof(*ctx) > sizeof(cb->ctx));\n\n\tghdr = nlmsg_data(cb->nlh);\n\tops = ethnl_default_requests[ghdr->cmd];\n\tif (WARN_ONCE(!ops, \"cmd %u has no ethnl_request_ops\\n\", ghdr->cmd))\n\t\treturn -EOPNOTSUPP;\n\treq_info = kzalloc(ops->req_info_size, GFP_KERNEL);\n\tif (!req_info)\n\t\treturn -ENOMEM;\n\treply_data = kmalloc(ops->reply_data_size, GFP_KERNEL);\n\tif (!reply_data) {\n\t\tret = -ENOMEM;\n\t\tgoto free_req_info;\n\t}\n\n\tret = ethnl_default_parse(req_info, &info->info, ops, false);\n\tif (req_info->dev) {\n\t\t \n\t\tnetdev_put(req_info->dev, &req_info->dev_tracker);\n\t\treq_info->dev = NULL;\n\t}\n\tif (ret < 0)\n\t\tgoto free_reply_data;\n\n\tctx->ops = ops;\n\tctx->req_info = req_info;\n\tctx->reply_data = reply_data;\n\tctx->pos_ifindex = 0;\n\n\treturn 0;\n\nfree_reply_data:\n\tkfree(reply_data);\nfree_req_info:\n\tkfree(req_info);\n\n\treturn ret;\n}\n\n \nstatic int ethnl_default_done(struct netlink_callback *cb)\n{\n\tstruct ethnl_dump_ctx *ctx = ethnl_dump_context(cb);\n\n\tkfree(ctx->reply_data);\n\tkfree(ctx->req_info);\n\n\treturn 0;\n}\n\nstatic int ethnl_default_set_doit(struct sk_buff *skb, struct genl_info *info)\n{\n\tconst struct ethnl_request_ops *ops;\n\tstruct ethnl_req_info req_info = {};\n\tconst u8 cmd = info->genlhdr->cmd;\n\tint ret;\n\n\tops = ethnl_default_requests[cmd];\n\tif (WARN_ONCE(!ops, \"cmd %u has no ethnl_request_ops\\n\", cmd))\n\t\treturn -EOPNOTSUPP;\n\tif (GENL_REQ_ATTR_CHECK(info, ops->hdr_attr))\n\t\treturn -EINVAL;\n\n\tret = ethnl_parse_header_dev_get(&req_info, info->attrs[ops->hdr_attr],\n\t\t\t\t\t genl_info_net(info), info->extack,\n\t\t\t\t\t true);\n\tif (ret < 0)\n\t\treturn ret;\n\n\tif (ops->set_validate) {\n\t\tret = ops->set_validate(&req_info, info);\n\t\t \n\t\tif (ret <= 0)\n\t\t\tgoto out_dev;\n\t}\n\n\trtnl_lock();\n\tret = ethnl_ops_begin(req_info.dev);\n\tif (ret < 0)\n\t\tgoto out_rtnl;\n\n\tret = ops->set(&req_info, info);\n\tif (ret <= 0)\n\t\tgoto out_ops;\n\tethtool_notify(req_info.dev, ops->set_ntf_cmd, NULL);\n\n\tret = 0;\nout_ops:\n\tethnl_ops_complete(req_info.dev);\nout_rtnl:\n\trtnl_unlock();\nout_dev:\n\tethnl_parse_header_dev_put(&req_info);\n\treturn ret;\n}\n\nstatic const struct ethnl_request_ops *\nethnl_default_notify_ops[ETHTOOL_MSG_KERNEL_MAX + 1] = {\n\t[ETHTOOL_MSG_LINKINFO_NTF]\t= &ethnl_linkinfo_request_ops,\n\t[ETHTOOL_MSG_LINKMODES_NTF]\t= &ethnl_linkmodes_request_ops,\n\t[ETHTOOL_MSG_DEBUG_NTF]\t\t= &ethnl_debug_request_ops,\n\t[ETHTOOL_MSG_WOL_NTF]\t\t= &ethnl_wol_request_ops,\n\t[ETHTOOL_MSG_FEATURES_NTF]\t= &ethnl_features_request_ops,\n\t[ETHTOOL_MSG_PRIVFLAGS_NTF]\t= &ethnl_privflags_request_ops,\n\t[ETHTOOL_MSG_RINGS_NTF]\t\t= &ethnl_rings_request_ops,\n\t[ETHTOOL_MSG_CHANNELS_NTF]\t= &ethnl_channels_request_ops,\n\t[ETHTOOL_MSG_COALESCE_NTF]\t= &ethnl_coalesce_request_ops,\n\t[ETHTOOL_MSG_PAUSE_NTF]\t\t= &ethnl_pause_request_ops,\n\t[ETHTOOL_MSG_EEE_NTF]\t\t= &ethnl_eee_request_ops,\n\t[ETHTOOL_MSG_FEC_NTF]\t\t= &ethnl_fec_request_ops,\n\t[ETHTOOL_MSG_MODULE_NTF]\t= &ethnl_module_request_ops,\n\t[ETHTOOL_MSG_PLCA_NTF]\t\t= &ethnl_plca_cfg_request_ops,\n\t[ETHTOOL_MSG_MM_NTF]\t\t= &ethnl_mm_request_ops,\n};\n\n \nstatic void ethnl_default_notify(struct net_device *dev, unsigned int cmd,\n\t\t\t\t const void *data)\n{\n\tstruct ethnl_reply_data *reply_data;\n\tconst struct ethnl_request_ops *ops;\n\tstruct ethnl_req_info *req_info;\n\tstruct genl_info info;\n\tstruct sk_buff *skb;\n\tvoid *reply_payload;\n\tint reply_len;\n\tint ret;\n\n\tgenl_info_init_ntf(&info, &ethtool_genl_family, cmd);\n\n\tif (WARN_ONCE(cmd > ETHTOOL_MSG_KERNEL_MAX ||\n\t\t      !ethnl_default_notify_ops[cmd],\n\t\t      \"unexpected notification type %u\\n\", cmd))\n\t\treturn;\n\tops = ethnl_default_notify_ops[cmd];\n\treq_info = kzalloc(ops->req_info_size, GFP_KERNEL);\n\tif (!req_info)\n\t\treturn;\n\treply_data = kmalloc(ops->reply_data_size, GFP_KERNEL);\n\tif (!reply_data) {\n\t\tkfree(req_info);\n\t\treturn;\n\t}\n\n\treq_info->dev = dev;\n\treq_info->flags |= ETHTOOL_FLAG_COMPACT_BITSETS;\n\n\tethnl_init_reply_data(reply_data, ops, dev);\n\tret = ops->prepare_data(req_info, reply_data, &info);\n\tif (ret < 0)\n\t\tgoto err_cleanup;\n\tret = ops->reply_size(req_info, reply_data);\n\tif (ret < 0)\n\t\tgoto err_cleanup;\n\treply_len = ret + ethnl_reply_header_size();\n\tskb = genlmsg_new(reply_len, GFP_KERNEL);\n\tif (!skb)\n\t\tgoto err_cleanup;\n\treply_payload = ethnl_bcastmsg_put(skb, cmd);\n\tif (!reply_payload)\n\t\tgoto err_skb;\n\tret = ethnl_fill_reply_header(skb, dev, ops->hdr_attr);\n\tif (ret < 0)\n\t\tgoto err_msg;\n\tret = ops->fill_reply(skb, req_info, reply_data);\n\tif (ret < 0)\n\t\tgoto err_msg;\n\tif (ops->cleanup_data)\n\t\tops->cleanup_data(reply_data);\n\n\tgenlmsg_end(skb, reply_payload);\n\tkfree(reply_data);\n\tkfree(req_info);\n\tethnl_multicast(skb, dev);\n\treturn;\n\nerr_msg:\n\tWARN_ONCE(ret == -EMSGSIZE,\n\t\t  \"calculated message payload length (%d) not sufficient\\n\",\n\t\t  reply_len);\nerr_skb:\n\tnlmsg_free(skb);\nerr_cleanup:\n\tif (ops->cleanup_data)\n\t\tops->cleanup_data(reply_data);\n\tkfree(reply_data);\n\tkfree(req_info);\n\treturn;\n}\n\n \n\ntypedef void (*ethnl_notify_handler_t)(struct net_device *dev, unsigned int cmd,\n\t\t\t\t       const void *data);\n\nstatic const ethnl_notify_handler_t ethnl_notify_handlers[] = {\n\t[ETHTOOL_MSG_LINKINFO_NTF]\t= ethnl_default_notify,\n\t[ETHTOOL_MSG_LINKMODES_NTF]\t= ethnl_default_notify,\n\t[ETHTOOL_MSG_DEBUG_NTF]\t\t= ethnl_default_notify,\n\t[ETHTOOL_MSG_WOL_NTF]\t\t= ethnl_default_notify,\n\t[ETHTOOL_MSG_FEATURES_NTF]\t= ethnl_default_notify,\n\t[ETHTOOL_MSG_PRIVFLAGS_NTF]\t= ethnl_default_notify,\n\t[ETHTOOL_MSG_RINGS_NTF]\t\t= ethnl_default_notify,\n\t[ETHTOOL_MSG_CHANNELS_NTF]\t= ethnl_default_notify,\n\t[ETHTOOL_MSG_COALESCE_NTF]\t= ethnl_default_notify,\n\t[ETHTOOL_MSG_PAUSE_NTF]\t\t= ethnl_default_notify,\n\t[ETHTOOL_MSG_EEE_NTF]\t\t= ethnl_default_notify,\n\t[ETHTOOL_MSG_FEC_NTF]\t\t= ethnl_default_notify,\n\t[ETHTOOL_MSG_MODULE_NTF]\t= ethnl_default_notify,\n\t[ETHTOOL_MSG_PLCA_NTF]\t\t= ethnl_default_notify,\n\t[ETHTOOL_MSG_MM_NTF]\t\t= ethnl_default_notify,\n};\n\nvoid ethtool_notify(struct net_device *dev, unsigned int cmd, const void *data)\n{\n\tif (unlikely(!ethnl_ok))\n\t\treturn;\n\tASSERT_RTNL();\n\n\tif (likely(cmd < ARRAY_SIZE(ethnl_notify_handlers) &&\n\t\t   ethnl_notify_handlers[cmd]))\n\t\tethnl_notify_handlers[cmd](dev, cmd, data);\n\telse\n\t\tWARN_ONCE(1, \"notification %u not implemented (dev=%s)\\n\",\n\t\t\t  cmd, netdev_name(dev));\n}\nEXPORT_SYMBOL(ethtool_notify);\n\nstatic void ethnl_notify_features(struct netdev_notifier_info *info)\n{\n\tstruct net_device *dev = netdev_notifier_info_to_dev(info);\n\n\tethtool_notify(dev, ETHTOOL_MSG_FEATURES_NTF, NULL);\n}\n\nstatic int ethnl_netdev_event(struct notifier_block *this, unsigned long event,\n\t\t\t      void *ptr)\n{\n\tswitch (event) {\n\tcase NETDEV_FEAT_CHANGE:\n\t\tethnl_notify_features(ptr);\n\t\tbreak;\n\t}\n\n\treturn NOTIFY_DONE;\n}\n\nstatic struct notifier_block ethnl_netdev_notifier = {\n\t.notifier_call = ethnl_netdev_event,\n};\n\n \n\nstatic const struct genl_ops ethtool_genl_ops[] = {\n\t{\n\t\t.cmd\t= ETHTOOL_MSG_STRSET_GET,\n\t\t.doit\t= ethnl_default_doit,\n\t\t.start\t= ethnl_default_start,\n\t\t.dumpit\t= ethnl_default_dumpit,\n\t\t.done\t= ethnl_default_done,\n\t\t.policy = ethnl_strset_get_policy,\n\t\t.maxattr = ARRAY_SIZE(ethnl_strset_get_policy) - 1,\n\t},\n\t{\n\t\t.cmd\t= ETHTOOL_MSG_LINKINFO_GET,\n\t\t.doit\t= ethnl_default_doit,\n\t\t.start\t= ethnl_default_start,\n\t\t.dumpit\t= ethnl_default_dumpit,\n\t\t.done\t= ethnl_default_done,\n\t\t.policy = ethnl_linkinfo_get_policy,\n\t\t.maxattr = ARRAY_SIZE(ethnl_linkinfo_get_policy) - 1,\n\t},\n\t{\n\t\t.cmd\t= ETHTOOL_MSG_LINKINFO_SET,\n\t\t.flags\t= GENL_UNS_ADMIN_PERM,\n\t\t.doit\t= ethnl_default_set_doit,\n\t\t.policy = ethnl_linkinfo_set_policy,\n\t\t.maxattr = ARRAY_SIZE(ethnl_linkinfo_set_policy) - 1,\n\t},\n\t{\n\t\t.cmd\t= ETHTOOL_MSG_LINKMODES_GET,\n\t\t.doit\t= ethnl_default_doit,\n\t\t.start\t= ethnl_default_start,\n\t\t.dumpit\t= ethnl_default_dumpit,\n\t\t.done\t= ethnl_default_done,\n\t\t.policy = ethnl_linkmodes_get_policy,\n\t\t.maxattr = ARRAY_SIZE(ethnl_linkmodes_get_policy) - 1,\n\t},\n\t{\n\t\t.cmd\t= ETHTOOL_MSG_LINKMODES_SET,\n\t\t.flags\t= GENL_UNS_ADMIN_PERM,\n\t\t.doit\t= ethnl_default_set_doit,\n\t\t.policy = ethnl_linkmodes_set_policy,\n\t\t.maxattr = ARRAY_SIZE(ethnl_linkmodes_set_policy) - 1,\n\t},\n\t{\n\t\t.cmd\t= ETHTOOL_MSG_LINKSTATE_GET,\n\t\t.doit\t= ethnl_default_doit,\n\t\t.start\t= ethnl_default_start,\n\t\t.dumpit\t= ethnl_default_dumpit,\n\t\t.done\t= ethnl_default_done,\n\t\t.policy = ethnl_linkstate_get_policy,\n\t\t.maxattr = ARRAY_SIZE(ethnl_linkstate_get_policy) - 1,\n\t},\n\t{\n\t\t.cmd\t= ETHTOOL_MSG_DEBUG_GET,\n\t\t.doit\t= ethnl_default_doit,\n\t\t.start\t= ethnl_default_start,\n\t\t.dumpit\t= ethnl_default_dumpit,\n\t\t.done\t= ethnl_default_done,\n\t\t.policy = ethnl_debug_get_policy,\n\t\t.maxattr = ARRAY_SIZE(ethnl_debug_get_policy) - 1,\n\t},\n\t{\n\t\t.cmd\t= ETHTOOL_MSG_DEBUG_SET,\n\t\t.flags\t= GENL_UNS_ADMIN_PERM,\n\t\t.doit\t= ethnl_default_set_doit,\n\t\t.policy = ethnl_debug_set_policy,\n\t\t.maxattr = ARRAY_SIZE(ethnl_debug_set_policy) - 1,\n\t},\n\t{\n\t\t.cmd\t= ETHTOOL_MSG_WOL_GET,\n\t\t.flags\t= GENL_UNS_ADMIN_PERM,\n\t\t.doit\t= ethnl_default_doit,\n\t\t.start\t= ethnl_default_start,\n\t\t.dumpit\t= ethnl_default_dumpit,\n\t\t.done\t= ethnl_default_done,\n\t\t.policy = ethnl_wol_get_policy,\n\t\t.maxattr = ARRAY_SIZE(ethnl_wol_get_policy) - 1,\n\t},\n\t{\n\t\t.cmd\t= ETHTOOL_MSG_WOL_SET,\n\t\t.flags\t= GENL_UNS_ADMIN_PERM,\n\t\t.doit\t= ethnl_default_set_doit,\n\t\t.policy = ethnl_wol_set_policy,\n\t\t.maxattr = ARRAY_SIZE(ethnl_wol_set_policy) - 1,\n\t},\n\t{\n\t\t.cmd\t= ETHTOOL_MSG_FEATURES_GET,\n\t\t.doit\t= ethnl_default_doit,\n\t\t.start\t= ethnl_default_start,\n\t\t.dumpit\t= ethnl_default_dumpit,\n\t\t.done\t= ethnl_default_done,\n\t\t.policy = ethnl_features_get_policy,\n\t\t.maxattr = ARRAY_SIZE(ethnl_features_get_policy) - 1,\n\t},\n\t{\n\t\t.cmd\t= ETHTOOL_MSG_FEATURES_SET,\n\t\t.flags\t= GENL_UNS_ADMIN_PERM,\n\t\t.doit\t= ethnl_set_features,\n\t\t.policy = ethnl_features_set_policy,\n\t\t.maxattr = ARRAY_SIZE(ethnl_features_set_policy) - 1,\n\t},\n\t{\n\t\t.cmd\t= ETHTOOL_MSG_PRIVFLAGS_GET,\n\t\t.doit\t= ethnl_default_doit,\n\t\t.start\t= ethnl_default_start,\n\t\t.dumpit\t= ethnl_default_dumpit,\n\t\t.done\t= ethnl_default_done,\n\t\t.policy = ethnl_privflags_get_policy,\n\t\t.maxattr = ARRAY_SIZE(ethnl_privflags_get_policy) - 1,\n\t},\n\t{\n\t\t.cmd\t= ETHTOOL_MSG_PRIVFLAGS_SET,\n\t\t.flags\t= GENL_UNS_ADMIN_PERM,\n\t\t.doit\t= ethnl_default_set_doit,\n\t\t.policy = ethnl_privflags_set_policy,\n\t\t.maxattr = ARRAY_SIZE(ethnl_privflags_set_policy) - 1,\n\t},\n\t{\n\t\t.cmd\t= ETHTOOL_MSG_RINGS_GET,\n\t\t.doit\t= ethnl_default_doit,\n\t\t.start\t= ethnl_default_start,\n\t\t.dumpit\t= ethnl_default_dumpit,\n\t\t.done\t= ethnl_default_done,\n\t\t.policy = ethnl_rings_get_policy,\n\t\t.maxattr = ARRAY_SIZE(ethnl_rings_get_policy) - 1,\n\t},\n\t{\n\t\t.cmd\t= ETHTOOL_MSG_RINGS_SET,\n\t\t.flags\t= GENL_UNS_ADMIN_PERM,\n\t\t.doit\t= ethnl_default_set_doit,\n\t\t.policy = ethnl_rings_set_policy,\n\t\t.maxattr = ARRAY_SIZE(ethnl_rings_set_policy) - 1,\n\t},\n\t{\n\t\t.cmd\t= ETHTOOL_MSG_CHANNELS_GET,\n\t\t.doit\t= ethnl_default_doit,\n\t\t.start\t= ethnl_default_start,\n\t\t.dumpit\t= ethnl_default_dumpit,\n\t\t.done\t= ethnl_default_done,\n\t\t.policy = ethnl_channels_get_policy,\n\t\t.maxattr = ARRAY_SIZE(ethnl_channels_get_policy) - 1,\n\t},\n\t{\n\t\t.cmd\t= ETHTOOL_MSG_CHANNELS_SET,\n\t\t.flags\t= GENL_UNS_ADMIN_PERM,\n\t\t.doit\t= ethnl_default_set_doit,\n\t\t.policy = ethnl_channels_set_policy,\n\t\t.maxattr = ARRAY_SIZE(ethnl_channels_set_policy) - 1,\n\t},\n\t{\n\t\t.cmd\t= ETHTOOL_MSG_COALESCE_GET,\n\t\t.doit\t= ethnl_default_doit,\n\t\t.start\t= ethnl_default_start,\n\t\t.dumpit\t= ethnl_default_dumpit,\n\t\t.done\t= ethnl_default_done,\n\t\t.policy = ethnl_coalesce_get_policy,\n\t\t.maxattr = ARRAY_SIZE(ethnl_coalesce_get_policy) - 1,\n\t},\n\t{\n\t\t.cmd\t= ETHTOOL_MSG_COALESCE_SET,\n\t\t.flags\t= GENL_UNS_ADMIN_PERM,\n\t\t.doit\t= ethnl_default_set_doit,\n\t\t.policy = ethnl_coalesce_set_policy,\n\t\t.maxattr = ARRAY_SIZE(ethnl_coalesce_set_policy) - 1,\n\t},\n\t{\n\t\t.cmd\t= ETHTOOL_MSG_PAUSE_GET,\n\t\t.doit\t= ethnl_default_doit,\n\t\t.start\t= ethnl_default_start,\n\t\t.dumpit\t= ethnl_default_dumpit,\n\t\t.done\t= ethnl_default_done,\n\t\t.policy = ethnl_pause_get_policy,\n\t\t.maxattr = ARRAY_SIZE(ethnl_pause_get_policy) - 1,\n\t},\n\t{\n\t\t.cmd\t= ETHTOOL_MSG_PAUSE_SET,\n\t\t.flags\t= GENL_UNS_ADMIN_PERM,\n\t\t.doit\t= ethnl_default_set_doit,\n\t\t.policy = ethnl_pause_set_policy,\n\t\t.maxattr = ARRAY_SIZE(ethnl_pause_set_policy) - 1,\n\t},\n\t{\n\t\t.cmd\t= ETHTOOL_MSG_EEE_GET,\n\t\t.doit\t= ethnl_default_doit,\n\t\t.start\t= ethnl_default_start,\n\t\t.dumpit\t= ethnl_default_dumpit,\n\t\t.done\t= ethnl_default_done,\n\t\t.policy = ethnl_eee_get_policy,\n\t\t.maxattr = ARRAY_SIZE(ethnl_eee_get_policy) - 1,\n\t},\n\t{\n\t\t.cmd\t= ETHTOOL_MSG_EEE_SET,\n\t\t.flags\t= GENL_UNS_ADMIN_PERM,\n\t\t.doit\t= ethnl_default_set_doit,\n\t\t.policy = ethnl_eee_set_policy,\n\t\t.maxattr = ARRAY_SIZE(ethnl_eee_set_policy) - 1,\n\t},\n\t{\n\t\t.cmd\t= ETHTOOL_MSG_TSINFO_GET,\n\t\t.doit\t= ethnl_default_doit,\n\t\t.start\t= ethnl_default_start,\n\t\t.dumpit\t= ethnl_default_dumpit,\n\t\t.done\t= ethnl_default_done,\n\t\t.policy = ethnl_tsinfo_get_policy,\n\t\t.maxattr = ARRAY_SIZE(ethnl_tsinfo_get_policy) - 1,\n\t},\n\t{\n\t\t.cmd\t= ETHTOOL_MSG_CABLE_TEST_ACT,\n\t\t.flags\t= GENL_UNS_ADMIN_PERM,\n\t\t.doit\t= ethnl_act_cable_test,\n\t\t.policy = ethnl_cable_test_act_policy,\n\t\t.maxattr = ARRAY_SIZE(ethnl_cable_test_act_policy) - 1,\n\t},\n\t{\n\t\t.cmd\t= ETHTOOL_MSG_CABLE_TEST_TDR_ACT,\n\t\t.flags\t= GENL_UNS_ADMIN_PERM,\n\t\t.doit\t= ethnl_act_cable_test_tdr,\n\t\t.policy = ethnl_cable_test_tdr_act_policy,\n\t\t.maxattr = ARRAY_SIZE(ethnl_cable_test_tdr_act_policy) - 1,\n\t},\n\t{\n\t\t.cmd\t= ETHTOOL_MSG_TUNNEL_INFO_GET,\n\t\t.doit\t= ethnl_tunnel_info_doit,\n\t\t.start\t= ethnl_tunnel_info_start,\n\t\t.dumpit\t= ethnl_tunnel_info_dumpit,\n\t\t.policy = ethnl_tunnel_info_get_policy,\n\t\t.maxattr = ARRAY_SIZE(ethnl_tunnel_info_get_policy) - 1,\n\t},\n\t{\n\t\t.cmd\t= ETHTOOL_MSG_FEC_GET,\n\t\t.doit\t= ethnl_default_doit,\n\t\t.start\t= ethnl_default_start,\n\t\t.dumpit\t= ethnl_default_dumpit,\n\t\t.done\t= ethnl_default_done,\n\t\t.policy = ethnl_fec_get_policy,\n\t\t.maxattr = ARRAY_SIZE(ethnl_fec_get_policy) - 1,\n\t},\n\t{\n\t\t.cmd\t= ETHTOOL_MSG_FEC_SET,\n\t\t.flags\t= GENL_UNS_ADMIN_PERM,\n\t\t.doit\t= ethnl_default_set_doit,\n\t\t.policy = ethnl_fec_set_policy,\n\t\t.maxattr = ARRAY_SIZE(ethnl_fec_set_policy) - 1,\n\t},\n\t{\n\t\t.cmd\t= ETHTOOL_MSG_MODULE_EEPROM_GET,\n\t\t.flags  = GENL_UNS_ADMIN_PERM,\n\t\t.doit\t= ethnl_default_doit,\n\t\t.start\t= ethnl_default_start,\n\t\t.dumpit\t= ethnl_default_dumpit,\n\t\t.done\t= ethnl_default_done,\n\t\t.policy = ethnl_module_eeprom_get_policy,\n\t\t.maxattr = ARRAY_SIZE(ethnl_module_eeprom_get_policy) - 1,\n\t},\n\t{\n\t\t.cmd\t= ETHTOOL_MSG_STATS_GET,\n\t\t.doit\t= ethnl_default_doit,\n\t\t.start\t= ethnl_default_start,\n\t\t.dumpit\t= ethnl_default_dumpit,\n\t\t.done\t= ethnl_default_done,\n\t\t.policy = ethnl_stats_get_policy,\n\t\t.maxattr = ARRAY_SIZE(ethnl_stats_get_policy) - 1,\n\t},\n\t{\n\t\t.cmd\t= ETHTOOL_MSG_PHC_VCLOCKS_GET,\n\t\t.doit\t= ethnl_default_doit,\n\t\t.start\t= ethnl_default_start,\n\t\t.dumpit\t= ethnl_default_dumpit,\n\t\t.done\t= ethnl_default_done,\n\t\t.policy = ethnl_phc_vclocks_get_policy,\n\t\t.maxattr = ARRAY_SIZE(ethnl_phc_vclocks_get_policy) - 1,\n\t},\n\t{\n\t\t.cmd\t= ETHTOOL_MSG_MODULE_GET,\n\t\t.doit\t= ethnl_default_doit,\n\t\t.start\t= ethnl_default_start,\n\t\t.dumpit\t= ethnl_default_dumpit,\n\t\t.done\t= ethnl_default_done,\n\t\t.policy = ethnl_module_get_policy,\n\t\t.maxattr = ARRAY_SIZE(ethnl_module_get_policy) - 1,\n\t},\n\t{\n\t\t.cmd\t= ETHTOOL_MSG_MODULE_SET,\n\t\t.flags\t= GENL_UNS_ADMIN_PERM,\n\t\t.doit\t= ethnl_default_set_doit,\n\t\t.policy = ethnl_module_set_policy,\n\t\t.maxattr = ARRAY_SIZE(ethnl_module_set_policy) - 1,\n\t},\n\t{\n\t\t.cmd\t= ETHTOOL_MSG_PSE_GET,\n\t\t.doit\t= ethnl_default_doit,\n\t\t.start\t= ethnl_default_start,\n\t\t.dumpit\t= ethnl_default_dumpit,\n\t\t.done\t= ethnl_default_done,\n\t\t.policy = ethnl_pse_get_policy,\n\t\t.maxattr = ARRAY_SIZE(ethnl_pse_get_policy) - 1,\n\t},\n\t{\n\t\t.cmd\t= ETHTOOL_MSG_PSE_SET,\n\t\t.flags\t= GENL_UNS_ADMIN_PERM,\n\t\t.doit\t= ethnl_default_set_doit,\n\t\t.policy = ethnl_pse_set_policy,\n\t\t.maxattr = ARRAY_SIZE(ethnl_pse_set_policy) - 1,\n\t},\n\t{\n\t\t.cmd\t= ETHTOOL_MSG_RSS_GET,\n\t\t.doit\t= ethnl_default_doit,\n\t\t.policy = ethnl_rss_get_policy,\n\t\t.maxattr = ARRAY_SIZE(ethnl_rss_get_policy) - 1,\n\t},\n\t{\n\t\t.cmd\t= ETHTOOL_MSG_PLCA_GET_CFG,\n\t\t.doit\t= ethnl_default_doit,\n\t\t.start\t= ethnl_default_start,\n\t\t.dumpit\t= ethnl_default_dumpit,\n\t\t.done\t= ethnl_default_done,\n\t\t.policy = ethnl_plca_get_cfg_policy,\n\t\t.maxattr = ARRAY_SIZE(ethnl_plca_get_cfg_policy) - 1,\n\t},\n\t{\n\t\t.cmd\t= ETHTOOL_MSG_PLCA_SET_CFG,\n\t\t.flags\t= GENL_UNS_ADMIN_PERM,\n\t\t.doit\t= ethnl_default_set_doit,\n\t\t.policy = ethnl_plca_set_cfg_policy,\n\t\t.maxattr = ARRAY_SIZE(ethnl_plca_set_cfg_policy) - 1,\n\t},\n\t{\n\t\t.cmd\t= ETHTOOL_MSG_PLCA_GET_STATUS,\n\t\t.doit\t= ethnl_default_doit,\n\t\t.start\t= ethnl_default_start,\n\t\t.dumpit\t= ethnl_default_dumpit,\n\t\t.done\t= ethnl_default_done,\n\t\t.policy = ethnl_plca_get_status_policy,\n\t\t.maxattr = ARRAY_SIZE(ethnl_plca_get_status_policy) - 1,\n\t},\n\t{\n\t\t.cmd\t= ETHTOOL_MSG_MM_GET,\n\t\t.doit\t= ethnl_default_doit,\n\t\t.start\t= ethnl_default_start,\n\t\t.dumpit\t= ethnl_default_dumpit,\n\t\t.done\t= ethnl_default_done,\n\t\t.policy = ethnl_mm_get_policy,\n\t\t.maxattr = ARRAY_SIZE(ethnl_mm_get_policy) - 1,\n\t},\n\t{\n\t\t.cmd\t= ETHTOOL_MSG_MM_SET,\n\t\t.flags\t= GENL_UNS_ADMIN_PERM,\n\t\t.doit\t= ethnl_default_set_doit,\n\t\t.policy = ethnl_mm_set_policy,\n\t\t.maxattr = ARRAY_SIZE(ethnl_mm_set_policy) - 1,\n\t},\n};\n\nstatic const struct genl_multicast_group ethtool_nl_mcgrps[] = {\n\t[ETHNL_MCGRP_MONITOR] = { .name = ETHTOOL_MCGRP_MONITOR_NAME },\n};\n\nstatic struct genl_family ethtool_genl_family __ro_after_init = {\n\t.name\t\t= ETHTOOL_GENL_NAME,\n\t.version\t= ETHTOOL_GENL_VERSION,\n\t.netnsok\t= true,\n\t.parallel_ops\t= true,\n\t.ops\t\t= ethtool_genl_ops,\n\t.n_ops\t\t= ARRAY_SIZE(ethtool_genl_ops),\n\t.resv_start_op\t= ETHTOOL_MSG_MODULE_GET + 1,\n\t.mcgrps\t\t= ethtool_nl_mcgrps,\n\t.n_mcgrps\t= ARRAY_SIZE(ethtool_nl_mcgrps),\n};\n\n \n\nstatic int __init ethnl_init(void)\n{\n\tint ret;\n\n\tret = genl_register_family(&ethtool_genl_family);\n\tif (WARN(ret < 0, \"ethtool: genetlink family registration failed\"))\n\t\treturn ret;\n\tethnl_ok = true;\n\n\tret = register_netdevice_notifier(&ethnl_netdev_notifier);\n\tWARN(ret < 0, \"ethtool: net device notifier registration failed\");\n\treturn ret;\n}\n\nsubsys_initcall(ethnl_init);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}