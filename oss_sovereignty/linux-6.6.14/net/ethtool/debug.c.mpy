{
  "module_name": "debug.c",
  "hash_id": "e41aeba0f8db9e892803e2bce33bbdc08d9a9bafa66159c28653e94fa7d90e24",
  "original_prompt": "Ingested from linux-6.6.14/net/ethtool/debug.c",
  "human_readable_source": "\n\n#include \"netlink.h\"\n#include \"common.h\"\n#include \"bitset.h\"\n\nstruct debug_req_info {\n\tstruct ethnl_req_info\t\tbase;\n};\n\nstruct debug_reply_data {\n\tstruct ethnl_reply_data\t\tbase;\n\tu32\t\t\t\tmsg_mask;\n};\n\n#define DEBUG_REPDATA(__reply_base) \\\n\tcontainer_of(__reply_base, struct debug_reply_data, base)\n\nconst struct nla_policy ethnl_debug_get_policy[] = {\n\t[ETHTOOL_A_DEBUG_HEADER]\t=\n\t\tNLA_POLICY_NESTED(ethnl_header_policy),\n};\n\nstatic int debug_prepare_data(const struct ethnl_req_info *req_base,\n\t\t\t      struct ethnl_reply_data *reply_base,\n\t\t\t      const struct genl_info *info)\n{\n\tstruct debug_reply_data *data = DEBUG_REPDATA(reply_base);\n\tstruct net_device *dev = reply_base->dev;\n\tint ret;\n\n\tif (!dev->ethtool_ops->get_msglevel)\n\t\treturn -EOPNOTSUPP;\n\n\tret = ethnl_ops_begin(dev);\n\tif (ret < 0)\n\t\treturn ret;\n\tdata->msg_mask = dev->ethtool_ops->get_msglevel(dev);\n\tethnl_ops_complete(dev);\n\n\treturn 0;\n}\n\nstatic int debug_reply_size(const struct ethnl_req_info *req_base,\n\t\t\t    const struct ethnl_reply_data *reply_base)\n{\n\tconst struct debug_reply_data *data = DEBUG_REPDATA(reply_base);\n\tbool compact = req_base->flags & ETHTOOL_FLAG_COMPACT_BITSETS;\n\n\treturn ethnl_bitset32_size(&data->msg_mask, NULL, NETIF_MSG_CLASS_COUNT,\n\t\t\t\t   netif_msg_class_names, compact);\n}\n\nstatic int debug_fill_reply(struct sk_buff *skb,\n\t\t\t    const struct ethnl_req_info *req_base,\n\t\t\t    const struct ethnl_reply_data *reply_base)\n{\n\tconst struct debug_reply_data *data = DEBUG_REPDATA(reply_base);\n\tbool compact = req_base->flags & ETHTOOL_FLAG_COMPACT_BITSETS;\n\n\treturn ethnl_put_bitset32(skb, ETHTOOL_A_DEBUG_MSGMASK, &data->msg_mask,\n\t\t\t\t  NULL, NETIF_MSG_CLASS_COUNT,\n\t\t\t\t  netif_msg_class_names, compact);\n}\n\n \n\nconst struct nla_policy ethnl_debug_set_policy[] = {\n\t[ETHTOOL_A_DEBUG_HEADER]\t=\n\t\tNLA_POLICY_NESTED(ethnl_header_policy),\n\t[ETHTOOL_A_DEBUG_MSGMASK]\t= { .type = NLA_NESTED },\n};\n\nstatic int\nethnl_set_debug_validate(struct ethnl_req_info *req_info,\n\t\t\t struct genl_info *info)\n{\n\tconst struct ethtool_ops *ops = req_info->dev->ethtool_ops;\n\n\treturn ops->get_msglevel && ops->set_msglevel ? 1 : -EOPNOTSUPP;\n}\n\nstatic int\nethnl_set_debug(struct ethnl_req_info *req_info, struct genl_info *info)\n{\n\tstruct net_device *dev = req_info->dev;\n\tstruct nlattr **tb = info->attrs;\n\tbool mod = false;\n\tu32 msg_mask;\n\tint ret;\n\n\tmsg_mask = dev->ethtool_ops->get_msglevel(dev);\n\tret = ethnl_update_bitset32(&msg_mask, NETIF_MSG_CLASS_COUNT,\n\t\t\t\t    tb[ETHTOOL_A_DEBUG_MSGMASK],\n\t\t\t\t    netif_msg_class_names, info->extack, &mod);\n\tif (ret < 0 || !mod)\n\t\treturn ret;\n\n\tdev->ethtool_ops->set_msglevel(dev, msg_mask);\n\treturn 1;\n}\n\nconst struct ethnl_request_ops ethnl_debug_request_ops = {\n\t.request_cmd\t\t= ETHTOOL_MSG_DEBUG_GET,\n\t.reply_cmd\t\t= ETHTOOL_MSG_DEBUG_GET_REPLY,\n\t.hdr_attr\t\t= ETHTOOL_A_DEBUG_HEADER,\n\t.req_info_size\t\t= sizeof(struct debug_req_info),\n\t.reply_data_size\t= sizeof(struct debug_reply_data),\n\n\t.prepare_data\t\t= debug_prepare_data,\n\t.reply_size\t\t= debug_reply_size,\n\t.fill_reply\t\t= debug_fill_reply,\n\n\t.set_validate\t\t= ethnl_set_debug_validate,\n\t.set\t\t\t= ethnl_set_debug,\n\t.set_ntf_cmd\t\t= ETHTOOL_MSG_DEBUG_NTF,\n};\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}