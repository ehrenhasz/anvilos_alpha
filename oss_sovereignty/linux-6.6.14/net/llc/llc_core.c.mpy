{
  "module_name": "llc_core.c",
  "hash_id": "2ca84d8f958a1c22920e36482a9a073016f563cabb21e9266a46d71b624541ba",
  "original_prompt": "Ingested from linux-6.6.14/net/llc/llc_core.c",
  "human_readable_source": " \n\n#include <linux/module.h>\n#include <linux/interrupt.h>\n#include <linux/if_ether.h>\n#include <linux/netdevice.h>\n#include <linux/slab.h>\n#include <linux/string.h>\n#include <linux/init.h>\n#include <net/net_namespace.h>\n#include <net/llc.h>\n\nLIST_HEAD(llc_sap_list);\nstatic DEFINE_SPINLOCK(llc_sap_list_lock);\n\n \nstatic struct llc_sap *llc_sap_alloc(void)\n{\n\tstruct llc_sap *sap = kzalloc(sizeof(*sap), GFP_ATOMIC);\n\tint i;\n\n\tif (sap) {\n\t\t \n\t\tsap->state = LLC_SAP_STATE_ACTIVE;\n\t\tspin_lock_init(&sap->sk_lock);\n\t\tfor (i = 0; i < LLC_SK_LADDR_HASH_ENTRIES; i++)\n\t\t\tINIT_HLIST_NULLS_HEAD(&sap->sk_laddr_hash[i], i);\n\t\trefcount_set(&sap->refcnt, 1);\n\t}\n\treturn sap;\n}\n\nstatic struct llc_sap *__llc_sap_find(unsigned char sap_value)\n{\n\tstruct llc_sap *sap;\n\n\tlist_for_each_entry(sap, &llc_sap_list, node)\n\t\tif (sap->laddr.lsap == sap_value)\n\t\t\tgoto out;\n\tsap = NULL;\nout:\n\treturn sap;\n}\n\n \nstruct llc_sap *llc_sap_find(unsigned char sap_value)\n{\n\tstruct llc_sap *sap;\n\n\trcu_read_lock_bh();\n\tsap = __llc_sap_find(sap_value);\n\tif (!sap || !llc_sap_hold_safe(sap))\n\t\tsap = NULL;\n\trcu_read_unlock_bh();\n\treturn sap;\n}\n\n \nstruct llc_sap *llc_sap_open(unsigned char lsap,\n\t\t\t     int (*func)(struct sk_buff *skb,\n\t\t\t\t\t struct net_device *dev,\n\t\t\t\t\t struct packet_type *pt,\n\t\t\t\t\t struct net_device *orig_dev))\n{\n\tstruct llc_sap *sap = NULL;\n\n\tspin_lock_bh(&llc_sap_list_lock);\n\tif (__llc_sap_find(lsap))  \n\t\tgoto out;\n\tsap = llc_sap_alloc();\n\tif (!sap)\n\t\tgoto out;\n\tsap->laddr.lsap = lsap;\n\tsap->rcv_func\t= func;\n\tlist_add_tail_rcu(&sap->node, &llc_sap_list);\nout:\n\tspin_unlock_bh(&llc_sap_list_lock);\n\treturn sap;\n}\n\n \nvoid llc_sap_close(struct llc_sap *sap)\n{\n\tWARN_ON(sap->sk_count);\n\n\tspin_lock_bh(&llc_sap_list_lock);\n\tlist_del_rcu(&sap->node);\n\tspin_unlock_bh(&llc_sap_list_lock);\n\n\tkfree_rcu(sap, rcu);\n}\n\nstatic struct packet_type llc_packet_type __read_mostly = {\n\t.type = cpu_to_be16(ETH_P_802_2),\n\t.func = llc_rcv,\n};\n\nstatic struct packet_type llc_tr_packet_type __read_mostly = {\n\t.type = cpu_to_be16(ETH_P_TR_802_2),\n\t.func = llc_rcv,\n};\n\nstatic int __init llc_init(void)\n{\n\tdev_add_pack(&llc_packet_type);\n\tdev_add_pack(&llc_tr_packet_type);\n\treturn 0;\n}\n\nstatic void __exit llc_exit(void)\n{\n\tdev_remove_pack(&llc_packet_type);\n\tdev_remove_pack(&llc_tr_packet_type);\n}\n\nmodule_init(llc_init);\nmodule_exit(llc_exit);\n\nEXPORT_SYMBOL(llc_sap_list);\nEXPORT_SYMBOL(llc_sap_find);\nEXPORT_SYMBOL(llc_sap_open);\nEXPORT_SYMBOL(llc_sap_close);\n\nMODULE_LICENSE(\"GPL\");\nMODULE_AUTHOR(\"Procom 1997, Jay Schullist 2001, Arnaldo C. Melo 2001-2003\");\nMODULE_DESCRIPTION(\"LLC IEEE 802.2 core support\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}