{
  "module_name": "llc_pdu.c",
  "hash_id": "9ff37bcebb07d44996731e18ea837eb3e5edb93b5a5595c8f16304fb8eb5f430",
  "original_prompt": "Ingested from linux-6.6.14/net/llc/llc_pdu.c",
  "human_readable_source": " \n\n#include <linux/netdevice.h>\n#include <net/llc_pdu.h>\n\nstatic void llc_pdu_decode_pdu_type(struct sk_buff *skb, u8 *type);\nstatic u8 llc_pdu_get_pf_bit(struct llc_pdu_sn *pdu);\n\nvoid llc_pdu_set_cmd_rsp(struct sk_buff *skb, u8 pdu_type)\n{\n\tllc_pdu_un_hdr(skb)->ssap |= pdu_type;\n}\n\n \nvoid llc_pdu_set_pf_bit(struct sk_buff *skb, u8 bit_value)\n{\n\tu8 pdu_type;\n\tstruct llc_pdu_sn *pdu;\n\n\tllc_pdu_decode_pdu_type(skb, &pdu_type);\n\tpdu = llc_pdu_sn_hdr(skb);\n\n\tswitch (pdu_type) {\n\tcase LLC_PDU_TYPE_I:\n\tcase LLC_PDU_TYPE_S:\n\t\tpdu->ctrl_2 = (pdu->ctrl_2 & 0xFE) | bit_value;\n\t\tbreak;\n\tcase LLC_PDU_TYPE_U:\n\t\tpdu->ctrl_1 |= (pdu->ctrl_1 & 0xEF) | (bit_value << 4);\n\t\tbreak;\n\t}\n}\n\n \nvoid llc_pdu_decode_pf_bit(struct sk_buff *skb, u8 *pf_bit)\n{\n\tu8 pdu_type;\n\tstruct llc_pdu_sn *pdu;\n\n\tllc_pdu_decode_pdu_type(skb, &pdu_type);\n\tpdu = llc_pdu_sn_hdr(skb);\n\n\tswitch (pdu_type) {\n\tcase LLC_PDU_TYPE_I:\n\tcase LLC_PDU_TYPE_S:\n\t\t*pf_bit = pdu->ctrl_2 & LLC_S_PF_BIT_MASK;\n\t\tbreak;\n\tcase LLC_PDU_TYPE_U:\n\t\t*pf_bit = (pdu->ctrl_1 & LLC_U_PF_BIT_MASK) >> 4;\n\t\tbreak;\n\t}\n}\n\n \nvoid llc_pdu_init_as_disc_cmd(struct sk_buff *skb, u8 p_bit)\n{\n\tstruct llc_pdu_un *pdu = llc_pdu_un_hdr(skb);\n\n\tpdu->ctrl_1  = LLC_PDU_TYPE_U;\n\tpdu->ctrl_1 |= LLC_2_PDU_CMD_DISC;\n\tpdu->ctrl_1 |= ((p_bit & 1) << 4) & LLC_U_PF_BIT_MASK;\n}\n\n \nvoid llc_pdu_init_as_i_cmd(struct sk_buff *skb, u8 p_bit, u8 ns, u8 nr)\n{\n\tstruct llc_pdu_sn *pdu = llc_pdu_sn_hdr(skb);\n\n\tpdu->ctrl_1  = LLC_PDU_TYPE_I;\n\tpdu->ctrl_2  = 0;\n\tpdu->ctrl_2 |= (p_bit & LLC_I_PF_BIT_MASK);  \n\tpdu->ctrl_1 |= (ns << 1) & 0xFE;    \n\tpdu->ctrl_2 |= (nr << 1) & 0xFE;    \n}\n\n \nvoid llc_pdu_init_as_rej_cmd(struct sk_buff *skb, u8 p_bit, u8 nr)\n{\n\tstruct llc_pdu_sn *pdu = llc_pdu_sn_hdr(skb);\n\n\tpdu->ctrl_1  = LLC_PDU_TYPE_S;\n\tpdu->ctrl_1 |= LLC_2_PDU_CMD_REJ;\n\tpdu->ctrl_2  = 0;\n\tpdu->ctrl_2 |= p_bit & LLC_S_PF_BIT_MASK;\n\tpdu->ctrl_1 &= 0x0F;     \n\tpdu->ctrl_2 |= (nr << 1) & 0xFE;  \n}\n\n \nvoid llc_pdu_init_as_rnr_cmd(struct sk_buff *skb, u8 p_bit, u8 nr)\n{\n\tstruct llc_pdu_sn *pdu = llc_pdu_sn_hdr(skb);\n\n\tpdu->ctrl_1  = LLC_PDU_TYPE_S;\n\tpdu->ctrl_1 |= LLC_2_PDU_CMD_RNR;\n\tpdu->ctrl_2  = 0;\n\tpdu->ctrl_2 |= p_bit & LLC_S_PF_BIT_MASK;\n\tpdu->ctrl_1 &= 0x0F;     \n\tpdu->ctrl_2 |= (nr << 1) & 0xFE;  \n}\n\n \nvoid llc_pdu_init_as_rr_cmd(struct sk_buff *skb, u8 p_bit, u8 nr)\n{\n\tstruct llc_pdu_sn *pdu = llc_pdu_sn_hdr(skb);\n\n\tpdu->ctrl_1  = LLC_PDU_TYPE_S;\n\tpdu->ctrl_1 |= LLC_2_PDU_CMD_RR;\n\tpdu->ctrl_2  = p_bit & LLC_S_PF_BIT_MASK;\n\tpdu->ctrl_1 &= 0x0F;     \n\tpdu->ctrl_2 |= (nr << 1) & 0xFE;  \n}\n\n \nvoid llc_pdu_init_as_sabme_cmd(struct sk_buff *skb, u8 p_bit)\n{\n\tstruct llc_pdu_un *pdu = llc_pdu_un_hdr(skb);\n\n\tpdu->ctrl_1  = LLC_PDU_TYPE_U;\n\tpdu->ctrl_1 |= LLC_2_PDU_CMD_SABME;\n\tpdu->ctrl_1 |= ((p_bit & 1) << 4) & LLC_U_PF_BIT_MASK;\n}\n\n \nvoid llc_pdu_init_as_dm_rsp(struct sk_buff *skb, u8 f_bit)\n{\n\tstruct llc_pdu_un *pdu = llc_pdu_un_hdr(skb);\n\n\tpdu->ctrl_1  = LLC_PDU_TYPE_U;\n\tpdu->ctrl_1 |= LLC_2_PDU_RSP_DM;\n\tpdu->ctrl_1 |= ((f_bit & 1) << 4) & LLC_U_PF_BIT_MASK;\n}\n\n \nvoid llc_pdu_init_as_frmr_rsp(struct sk_buff *skb, struct llc_pdu_sn *prev_pdu,\n\t\t\t      u8 f_bit, u8 vs, u8 vr, u8 vzyxw)\n{\n\tstruct llc_frmr_info *frmr_info;\n\tu8 prev_pf = 0;\n\tu8 *ctrl;\n\tstruct llc_pdu_sn *pdu = llc_pdu_sn_hdr(skb);\n\n\tpdu->ctrl_1  = LLC_PDU_TYPE_U;\n\tpdu->ctrl_1 |= LLC_2_PDU_RSP_FRMR;\n\tpdu->ctrl_1 |= ((f_bit & 1) << 4) & LLC_U_PF_BIT_MASK;\n\n\tfrmr_info = (struct llc_frmr_info *)&pdu->ctrl_2;\n\tctrl = (u8 *)&prev_pdu->ctrl_1;\n\tFRMR_INFO_SET_REJ_CNTRL(frmr_info,ctrl);\n\tFRMR_INFO_SET_Vs(frmr_info, vs);\n\tFRMR_INFO_SET_Vr(frmr_info, vr);\n\tprev_pf = llc_pdu_get_pf_bit(prev_pdu);\n\tFRMR_INFO_SET_C_R_BIT(frmr_info, prev_pf);\n\tFRMR_INFO_SET_INVALID_PDU_CTRL_IND(frmr_info, vzyxw);\n\tFRMR_INFO_SET_INVALID_PDU_INFO_IND(frmr_info, vzyxw);\n\tFRMR_INFO_SET_PDU_INFO_2LONG_IND(frmr_info, vzyxw);\n\tFRMR_INFO_SET_PDU_INVALID_Nr_IND(frmr_info, vzyxw);\n\tFRMR_INFO_SET_PDU_INVALID_Ns_IND(frmr_info, vzyxw);\n\tskb_put(skb, sizeof(struct llc_frmr_info));\n}\n\n \nvoid llc_pdu_init_as_rr_rsp(struct sk_buff *skb, u8 f_bit, u8 nr)\n{\n\tstruct llc_pdu_sn *pdu = llc_pdu_sn_hdr(skb);\n\n\tpdu->ctrl_1  = LLC_PDU_TYPE_S;\n\tpdu->ctrl_1 |= LLC_2_PDU_RSP_RR;\n\tpdu->ctrl_2  = 0;\n\tpdu->ctrl_2 |= f_bit & LLC_S_PF_BIT_MASK;\n\tpdu->ctrl_1 &= 0x0F;     \n\tpdu->ctrl_2 |= (nr << 1) & 0xFE;   \n}\n\n \nvoid llc_pdu_init_as_rej_rsp(struct sk_buff *skb, u8 f_bit, u8 nr)\n{\n\tstruct llc_pdu_sn *pdu = llc_pdu_sn_hdr(skb);\n\n\tpdu->ctrl_1  = LLC_PDU_TYPE_S;\n\tpdu->ctrl_1 |= LLC_2_PDU_RSP_REJ;\n\tpdu->ctrl_2  = 0;\n\tpdu->ctrl_2 |= f_bit & LLC_S_PF_BIT_MASK;\n\tpdu->ctrl_1 &= 0x0F;     \n\tpdu->ctrl_2 |= (nr << 1) & 0xFE;   \n}\n\n \nvoid llc_pdu_init_as_rnr_rsp(struct sk_buff *skb, u8 f_bit, u8 nr)\n{\n\tstruct llc_pdu_sn *pdu = llc_pdu_sn_hdr(skb);\n\n\tpdu->ctrl_1  = LLC_PDU_TYPE_S;\n\tpdu->ctrl_1 |= LLC_2_PDU_RSP_RNR;\n\tpdu->ctrl_2  = 0;\n\tpdu->ctrl_2 |= f_bit & LLC_S_PF_BIT_MASK;\n\tpdu->ctrl_1 &= 0x0F;     \n\tpdu->ctrl_2 |= (nr << 1) & 0xFE;   \n}\n\n \nvoid llc_pdu_init_as_ua_rsp(struct sk_buff *skb, u8 f_bit)\n{\n\tstruct llc_pdu_un *pdu = llc_pdu_un_hdr(skb);\n\n\tpdu->ctrl_1  = LLC_PDU_TYPE_U;\n\tpdu->ctrl_1 |= LLC_2_PDU_RSP_UA;\n\tpdu->ctrl_1 |= ((f_bit & 1) << 4) & LLC_U_PF_BIT_MASK;\n}\n\n \nstatic void llc_pdu_decode_pdu_type(struct sk_buff *skb, u8 *type)\n{\n\tstruct llc_pdu_un *pdu = llc_pdu_un_hdr(skb);\n\n\tif (pdu->ctrl_1 & 1) {\n\t\tif ((pdu->ctrl_1 & LLC_PDU_TYPE_U) == LLC_PDU_TYPE_U)\n\t\t\t*type = LLC_PDU_TYPE_U;\n\t\telse\n\t\t\t*type = LLC_PDU_TYPE_S;\n\t} else\n\t\t*type = LLC_PDU_TYPE_I;\n}\n\n \nstatic u8 llc_pdu_get_pf_bit(struct llc_pdu_sn *pdu)\n{\n\tu8 pdu_type;\n\tu8 pf_bit = 0;\n\n\tif (pdu->ctrl_1 & 1) {\n\t\tif ((pdu->ctrl_1 & LLC_PDU_TYPE_U) == LLC_PDU_TYPE_U)\n\t\t\tpdu_type = LLC_PDU_TYPE_U;\n\t\telse\n\t\t\tpdu_type = LLC_PDU_TYPE_S;\n\t} else\n\t\tpdu_type = LLC_PDU_TYPE_I;\n\tswitch (pdu_type) {\n\tcase LLC_PDU_TYPE_I:\n\tcase LLC_PDU_TYPE_S:\n\t\tpf_bit = pdu->ctrl_2 & LLC_S_PF_BIT_MASK;\n\t\tbreak;\n\tcase LLC_PDU_TYPE_U:\n\t\tpf_bit = (pdu->ctrl_1 & LLC_U_PF_BIT_MASK) >> 4;\n\t\tbreak;\n\t}\n\treturn pf_bit;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}