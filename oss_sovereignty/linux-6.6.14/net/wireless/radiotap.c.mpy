{
  "module_name": "radiotap.c",
  "hash_id": "92ca70f8df6d7fd4fe0654f9f305c4f49946c0a1321f35af74a93dcbd1b859d1",
  "original_prompt": "Ingested from linux-6.6.14/net/wireless/radiotap.c",
  "human_readable_source": " \n\n#include <linux/kernel.h>\n#include <linux/export.h>\n#include <net/cfg80211.h>\n#include <net/ieee80211_radiotap.h>\n#include <asm/unaligned.h>\n\n \n\nstatic const struct radiotap_align_size rtap_namespace_sizes[] = {\n\t[IEEE80211_RADIOTAP_TSFT] = { .align = 8, .size = 8, },\n\t[IEEE80211_RADIOTAP_FLAGS] = { .align = 1, .size = 1, },\n\t[IEEE80211_RADIOTAP_RATE] = { .align = 1, .size = 1, },\n\t[IEEE80211_RADIOTAP_CHANNEL] = { .align = 2, .size = 4, },\n\t[IEEE80211_RADIOTAP_FHSS] = { .align = 2, .size = 2, },\n\t[IEEE80211_RADIOTAP_DBM_ANTSIGNAL] = { .align = 1, .size = 1, },\n\t[IEEE80211_RADIOTAP_DBM_ANTNOISE] = { .align = 1, .size = 1, },\n\t[IEEE80211_RADIOTAP_LOCK_QUALITY] = { .align = 2, .size = 2, },\n\t[IEEE80211_RADIOTAP_TX_ATTENUATION] = { .align = 2, .size = 2, },\n\t[IEEE80211_RADIOTAP_DB_TX_ATTENUATION] = { .align = 2, .size = 2, },\n\t[IEEE80211_RADIOTAP_DBM_TX_POWER] = { .align = 1, .size = 1, },\n\t[IEEE80211_RADIOTAP_ANTENNA] = { .align = 1, .size = 1, },\n\t[IEEE80211_RADIOTAP_DB_ANTSIGNAL] = { .align = 1, .size = 1, },\n\t[IEEE80211_RADIOTAP_DB_ANTNOISE] = { .align = 1, .size = 1, },\n\t[IEEE80211_RADIOTAP_RX_FLAGS] = { .align = 2, .size = 2, },\n\t[IEEE80211_RADIOTAP_TX_FLAGS] = { .align = 2, .size = 2, },\n\t[IEEE80211_RADIOTAP_RTS_RETRIES] = { .align = 1, .size = 1, },\n\t[IEEE80211_RADIOTAP_DATA_RETRIES] = { .align = 1, .size = 1, },\n\t[IEEE80211_RADIOTAP_MCS] = { .align = 1, .size = 3, },\n\t[IEEE80211_RADIOTAP_AMPDU_STATUS] = { .align = 4, .size = 8, },\n\t[IEEE80211_RADIOTAP_VHT] = { .align = 2, .size = 12, },\n\t \n};\n\nstatic const struct ieee80211_radiotap_namespace radiotap_ns = {\n\t.n_bits = ARRAY_SIZE(rtap_namespace_sizes),\n\t.align_size = rtap_namespace_sizes,\n};\n\n \n\nint ieee80211_radiotap_iterator_init(\n\tstruct ieee80211_radiotap_iterator *iterator,\n\tstruct ieee80211_radiotap_header *radiotap_header,\n\tint max_length, const struct ieee80211_radiotap_vendor_namespaces *vns)\n{\n\t \n\tif (max_length < sizeof(struct ieee80211_radiotap_header))\n\t\treturn -EINVAL;\n\n\t \n\tif (radiotap_header->it_version)\n\t\treturn -EINVAL;\n\n\t \n\tif (max_length < get_unaligned_le16(&radiotap_header->it_len))\n\t\treturn -EINVAL;\n\n\titerator->_rtheader = radiotap_header;\n\titerator->_max_length = get_unaligned_le16(&radiotap_header->it_len);\n\titerator->_arg_index = 0;\n\titerator->_bitmap_shifter = get_unaligned_le32(&radiotap_header->it_present);\n\titerator->_arg = (uint8_t *)radiotap_header->it_optional;\n\titerator->_reset_on_ext = 0;\n\titerator->_next_bitmap = radiotap_header->it_optional;\n\titerator->_vns = vns;\n\titerator->current_namespace = &radiotap_ns;\n\titerator->is_radiotap_ns = 1;\n\n\t \n\n\tif (iterator->_bitmap_shifter & (BIT(IEEE80211_RADIOTAP_EXT))) {\n\t\tif ((unsigned long)iterator->_arg -\n\t\t    (unsigned long)iterator->_rtheader + sizeof(uint32_t) >\n\t\t    (unsigned long)iterator->_max_length)\n\t\t\treturn -EINVAL;\n\t\twhile (get_unaligned_le32(iterator->_arg) &\n\t\t\t\t\t(BIT(IEEE80211_RADIOTAP_EXT))) {\n\t\t\titerator->_arg += sizeof(uint32_t);\n\n\t\t\t \n\n\t\t\tif ((unsigned long)iterator->_arg -\n\t\t\t    (unsigned long)iterator->_rtheader +\n\t\t\t    sizeof(uint32_t) >\n\t\t\t    (unsigned long)iterator->_max_length)\n\t\t\t\treturn -EINVAL;\n\t\t}\n\n\t\titerator->_arg += sizeof(uint32_t);\n\n\t\t \n\t}\n\n\titerator->this_arg = iterator->_arg;\n\n\t \n\n\treturn 0;\n}\nEXPORT_SYMBOL(ieee80211_radiotap_iterator_init);\n\nstatic void find_ns(struct ieee80211_radiotap_iterator *iterator,\n\t\t    uint32_t oui, uint8_t subns)\n{\n\tint i;\n\n\titerator->current_namespace = NULL;\n\n\tif (!iterator->_vns)\n\t\treturn;\n\n\tfor (i = 0; i < iterator->_vns->n_ns; i++) {\n\t\tif (iterator->_vns->ns[i].oui != oui)\n\t\t\tcontinue;\n\t\tif (iterator->_vns->ns[i].subns != subns)\n\t\t\tcontinue;\n\n\t\titerator->current_namespace = &iterator->_vns->ns[i];\n\t\tbreak;\n\t}\n}\n\n\n\n \n\nint ieee80211_radiotap_iterator_next(\n\tstruct ieee80211_radiotap_iterator *iterator)\n{\n\twhile (1) {\n\t\tint hit = 0;\n\t\tint pad, align, size, subns;\n\t\tuint32_t oui;\n\n\t\t \n\t\tif ((iterator->_arg_index % 32) == IEEE80211_RADIOTAP_EXT &&\n\t\t    !(iterator->_bitmap_shifter & 1))\n\t\t\treturn -ENOENT;\n\n\t\tif (!(iterator->_bitmap_shifter & 1))\n\t\t\tgoto next_entry;  \n\n\t\t \n\t\tswitch (iterator->_arg_index % 32) {\n\t\tcase IEEE80211_RADIOTAP_RADIOTAP_NAMESPACE:\n\t\tcase IEEE80211_RADIOTAP_EXT:\n\t\t\talign = 1;\n\t\t\tsize = 0;\n\t\t\tbreak;\n\t\tcase IEEE80211_RADIOTAP_VENDOR_NAMESPACE:\n\t\t\talign = 2;\n\t\t\tsize = 6;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tif (!iterator->current_namespace ||\n\t\t\t    iterator->_arg_index >= iterator->current_namespace->n_bits) {\n\t\t\t\tif (iterator->current_namespace == &radiotap_ns)\n\t\t\t\t\treturn -ENOENT;\n\t\t\t\talign = 0;\n\t\t\t} else {\n\t\t\t\talign = iterator->current_namespace->align_size[iterator->_arg_index].align;\n\t\t\t\tsize = iterator->current_namespace->align_size[iterator->_arg_index].size;\n\t\t\t}\n\t\t\tif (!align) {\n\t\t\t\t \n\t\t\t\titerator->_arg = iterator->_next_ns_data;\n\t\t\t\t \n\t\t\t\titerator->current_namespace = NULL;\n\t\t\t\tgoto next_entry;\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\n\t\t \n\n\t\tpad = ((unsigned long)iterator->_arg -\n\t\t       (unsigned long)iterator->_rtheader) & (align - 1);\n\n\t\tif (pad)\n\t\t\titerator->_arg += align - pad;\n\n\t\tif (iterator->_arg_index % 32 == IEEE80211_RADIOTAP_VENDOR_NAMESPACE) {\n\t\t\tint vnslen;\n\n\t\t\tif ((unsigned long)iterator->_arg + size -\n\t\t\t    (unsigned long)iterator->_rtheader >\n\t\t\t    (unsigned long)iterator->_max_length)\n\t\t\t\treturn -EINVAL;\n\n\t\t\toui = (*iterator->_arg << 16) |\n\t\t\t\t(*(iterator->_arg + 1) << 8) |\n\t\t\t\t*(iterator->_arg + 2);\n\t\t\tsubns = *(iterator->_arg + 3);\n\n\t\t\tfind_ns(iterator, oui, subns);\n\n\t\t\tvnslen = get_unaligned_le16(iterator->_arg + 4);\n\t\t\titerator->_next_ns_data = iterator->_arg + size + vnslen;\n\t\t\tif (!iterator->current_namespace)\n\t\t\t\tsize += vnslen;\n\t\t}\n\n\t\t \n\t\titerator->this_arg_index = iterator->_arg_index;\n\t\titerator->this_arg = iterator->_arg;\n\t\titerator->this_arg_size = size;\n\n\t\t \n\t\titerator->_arg += size;\n\n\t\t \n\n\t\tif ((unsigned long)iterator->_arg -\n\t\t    (unsigned long)iterator->_rtheader >\n\t\t    (unsigned long)iterator->_max_length)\n\t\t\treturn -EINVAL;\n\n\t\t \n\t\tswitch (iterator->_arg_index % 32) {\n\t\tcase IEEE80211_RADIOTAP_VENDOR_NAMESPACE:\n\t\t\titerator->_reset_on_ext = 1;\n\n\t\t\titerator->is_radiotap_ns = 0;\n\t\t\t \n\t\t\titerator->this_arg_index =\n\t\t\t\tIEEE80211_RADIOTAP_VENDOR_NAMESPACE;\n\t\t\tif (!iterator->current_namespace)\n\t\t\t\thit = 1;\n\t\t\tgoto next_entry;\n\t\tcase IEEE80211_RADIOTAP_RADIOTAP_NAMESPACE:\n\t\t\titerator->_reset_on_ext = 1;\n\t\t\titerator->current_namespace = &radiotap_ns;\n\t\t\titerator->is_radiotap_ns = 1;\n\t\t\tgoto next_entry;\n\t\tcase IEEE80211_RADIOTAP_EXT:\n\t\t\t \n\t\t\titerator->_bitmap_shifter =\n\t\t\t\tget_unaligned_le32(iterator->_next_bitmap);\n\t\t\titerator->_next_bitmap++;\n\t\t\tif (iterator->_reset_on_ext)\n\t\t\t\titerator->_arg_index = 0;\n\t\t\telse\n\t\t\t\titerator->_arg_index++;\n\t\t\titerator->_reset_on_ext = 0;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\t \n\t\t\thit = 1;\n next_entry:\n\t\t\titerator->_bitmap_shifter >>= 1;\n\t\t\titerator->_arg_index++;\n\t\t}\n\n\t\t \n\t\tif (hit)\n\t\t\treturn 0;\n\t}\n}\nEXPORT_SYMBOL(ieee80211_radiotap_iterator_next);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}