{
  "module_name": "ap.c",
  "hash_id": "67dec80ed4ddd54155960b22ac4e6602174bcd64dfeb89c7aeee271de3460b96",
  "original_prompt": "Ingested from linux-6.6.14/net/wireless/ap.c",
  "human_readable_source": "\n \n#include <linux/ieee80211.h>\n#include <linux/export.h>\n#include <net/cfg80211.h>\n#include \"nl80211.h\"\n#include \"core.h\"\n#include \"rdev-ops.h\"\n\n\nstatic int ___cfg80211_stop_ap(struct cfg80211_registered_device *rdev,\n\t\t\t       struct net_device *dev, unsigned int link_id,\n\t\t\t       bool notify)\n{\n\tstruct wireless_dev *wdev = dev->ieee80211_ptr;\n\tint err;\n\n\tASSERT_WDEV_LOCK(wdev);\n\n\tif (!rdev->ops->stop_ap)\n\t\treturn -EOPNOTSUPP;\n\n\tif (dev->ieee80211_ptr->iftype != NL80211_IFTYPE_AP &&\n\t    dev->ieee80211_ptr->iftype != NL80211_IFTYPE_P2P_GO)\n\t\treturn -EOPNOTSUPP;\n\n\tif (!wdev->links[link_id].ap.beacon_interval)\n\t\treturn -ENOENT;\n\n\terr = rdev_stop_ap(rdev, dev, link_id);\n\tif (!err) {\n\t\twdev->conn_owner_nlportid = 0;\n\t\twdev->links[link_id].ap.beacon_interval = 0;\n\t\tmemset(&wdev->links[link_id].ap.chandef, 0,\n\t\t       sizeof(wdev->links[link_id].ap.chandef));\n\t\twdev->u.ap.ssid_len = 0;\n\t\trdev_set_qos_map(rdev, dev, NULL);\n\t\tif (notify)\n\t\t\tnl80211_send_ap_stopped(wdev, link_id);\n\n\t\t \n\t\tcfg80211_sched_dfs_chan_update(rdev);\n\t}\n\n\tschedule_work(&cfg80211_disconnect_work);\n\n\treturn err;\n}\n\nint __cfg80211_stop_ap(struct cfg80211_registered_device *rdev,\n\t\t       struct net_device *dev, int link_id,\n\t\t       bool notify)\n{\n\tunsigned int link;\n\tint ret = 0;\n\n\tif (link_id >= 0)\n\t\treturn ___cfg80211_stop_ap(rdev, dev, link_id, notify);\n\n\tfor_each_valid_link(dev->ieee80211_ptr, link) {\n\t\tint ret1 = ___cfg80211_stop_ap(rdev, dev, link, notify);\n\n\t\tif (ret1)\n\t\t\tret = ret1;\n\t\t \n\t}\n\n\treturn ret;\n}\n\nint cfg80211_stop_ap(struct cfg80211_registered_device *rdev,\n\t\t     struct net_device *dev, int link_id,\n\t\t     bool notify)\n{\n\tstruct wireless_dev *wdev = dev->ieee80211_ptr;\n\tint err;\n\n\twdev_lock(wdev);\n\terr = __cfg80211_stop_ap(rdev, dev, link_id, notify);\n\twdev_unlock(wdev);\n\n\treturn err;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}