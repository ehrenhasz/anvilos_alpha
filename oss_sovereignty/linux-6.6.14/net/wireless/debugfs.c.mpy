{
  "module_name": "debugfs.c",
  "hash_id": "8eaca2e3f1d402f3d190fa4116c37d35ae47fb874012cff453bf76f4f7c5a5c1",
  "original_prompt": "Ingested from linux-6.6.14/net/wireless/debugfs.c",
  "human_readable_source": "\n \n\n#include <linux/slab.h>\n#include \"core.h\"\n#include \"debugfs.h\"\n\n#define DEBUGFS_READONLY_FILE(name, buflen, fmt, value...)\t\t\\\nstatic ssize_t name## _read(struct file *file, char __user *userbuf,\t\\\n\t\t\t    size_t count, loff_t *ppos)\t\t\t\\\n{\t\t\t\t\t\t\t\t\t\\\n\tstruct wiphy *wiphy = file->private_data;\t\t\t\\\n\tchar buf[buflen];\t\t\t\t\t\t\\\n\tint res;\t\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\tres = scnprintf(buf, buflen, fmt \"\\n\", ##value);\t\t\\\n\treturn simple_read_from_buffer(userbuf, count, ppos, buf, res);\t\\\n}\t\t\t\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\nstatic const struct file_operations name## _ops = {\t\t\t\\\n\t.read = name## _read,\t\t\t\t\t\t\\\n\t.open = simple_open,\t\t\t\t\t\t\\\n\t.llseek = generic_file_llseek,\t\t\t\t\t\\\n}\n\nDEBUGFS_READONLY_FILE(rts_threshold, 20, \"%d\",\n\t\t      wiphy->rts_threshold);\nDEBUGFS_READONLY_FILE(fragmentation_threshold, 20, \"%d\",\n\t\t      wiphy->frag_threshold);\nDEBUGFS_READONLY_FILE(short_retry_limit, 20, \"%d\",\n\t\t      wiphy->retry_short);\nDEBUGFS_READONLY_FILE(long_retry_limit, 20, \"%d\",\n\t\t      wiphy->retry_long);\n\nstatic int ht_print_chan(struct ieee80211_channel *chan,\n\t\t\t char *buf, int buf_size, int offset)\n{\n\tif (WARN_ON(offset > buf_size))\n\t\treturn 0;\n\n\tif (chan->flags & IEEE80211_CHAN_DISABLED)\n\t\treturn scnprintf(buf + offset,\n\t\t\t\t buf_size - offset,\n\t\t\t\t \"%d Disabled\\n\",\n\t\t\t\t chan->center_freq);\n\n\treturn scnprintf(buf + offset,\n\t\t\t buf_size - offset,\n\t\t\t \"%d HT40 %c%c\\n\",\n\t\t\t chan->center_freq,\n\t\t\t (chan->flags & IEEE80211_CHAN_NO_HT40MINUS) ?\n\t\t\t\t' ' : '-',\n\t\t\t (chan->flags & IEEE80211_CHAN_NO_HT40PLUS) ?\n\t\t\t\t' ' : '+');\n}\n\nstatic ssize_t ht40allow_map_read(struct file *file,\n\t\t\t\t  char __user *user_buf,\n\t\t\t\t  size_t count, loff_t *ppos)\n{\n\tstruct wiphy *wiphy = file->private_data;\n\tchar *buf;\n\tunsigned int offset = 0, buf_size = PAGE_SIZE, i;\n\tenum nl80211_band band;\n\tstruct ieee80211_supported_band *sband;\n\tssize_t r;\n\n\tbuf = kzalloc(buf_size, GFP_KERNEL);\n\tif (!buf)\n\t\treturn -ENOMEM;\n\n\tfor (band = 0; band < NUM_NL80211_BANDS; band++) {\n\t\tsband = wiphy->bands[band];\n\t\tif (!sband)\n\t\t\tcontinue;\n\t\tfor (i = 0; i < sband->n_channels; i++)\n\t\t\toffset += ht_print_chan(&sband->channels[i],\n\t\t\t\t\t\tbuf, buf_size, offset);\n\t}\n\n\tr = simple_read_from_buffer(user_buf, count, ppos, buf, offset);\n\n\tkfree(buf);\n\n\treturn r;\n}\n\nstatic const struct file_operations ht40allow_map_ops = {\n\t.read = ht40allow_map_read,\n\t.open = simple_open,\n\t.llseek = default_llseek,\n};\n\n#define DEBUGFS_ADD(name)\t\t\t\t\t\t\\\n\tdebugfs_create_file(#name, 0444, phyd, &rdev->wiphy, &name## _ops)\n\nvoid cfg80211_debugfs_rdev_add(struct cfg80211_registered_device *rdev)\n{\n\tstruct dentry *phyd = rdev->wiphy.debugfsdir;\n\n\tDEBUGFS_ADD(rts_threshold);\n\tDEBUGFS_ADD(fragmentation_threshold);\n\tDEBUGFS_ADD(short_retry_limit);\n\tDEBUGFS_ADD(long_retry_limit);\n\tDEBUGFS_ADD(ht40allow_map);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}