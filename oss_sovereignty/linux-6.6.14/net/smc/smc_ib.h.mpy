{
  "module_name": "smc_ib.h",
  "hash_id": "934e1acd9d38dc3a1f209aa77034ca5b8be6db0dfbbd404ee47bfacd3f07cb47",
  "original_prompt": "Ingested from linux-6.6.14/net/smc/smc_ib.h",
  "human_readable_source": " \n \n\n#ifndef _SMC_IB_H\n#define _SMC_IB_H\n\n#include <linux/interrupt.h>\n#include <linux/if_ether.h>\n#include <linux/mutex.h>\n#include <linux/wait.h>\n#include <rdma/ib_verbs.h>\n#include <net/smc.h>\n\n#define SMC_MAX_PORTS\t\t\t2\t \n#define SMC_GID_SIZE\t\t\tsizeof(union ib_gid)\n\n#define SMC_IB_MAX_SEND_SGE\t\t2\n\nstruct smc_ib_devices {\t\t\t \n\tstruct list_head\tlist;\n\tstruct mutex\t\tmutex;\t \n};\n\nextern struct smc_ib_devices\tsmc_ib_devices;  \nextern struct smc_lgr_list smc_lgr_list;  \n\nstruct smc_ib_device {\t\t\t\t \n\tstruct list_head\tlist;\n\tstruct ib_device\t*ibdev;\n\tstruct ib_port_attr\tpattr[SMC_MAX_PORTS];\t \n\tstruct ib_event_handler\tevent_handler;\t \n\tstruct ib_cq\t\t*roce_cq_send;\t \n\tstruct ib_cq\t\t*roce_cq_recv;\t \n\tstruct tasklet_struct\tsend_tasklet;\t \n\tstruct tasklet_struct\trecv_tasklet;\t \n\tchar\t\t\tmac[SMC_MAX_PORTS][ETH_ALEN];\n\t\t\t\t\t\t \n\tu8\t\t\tpnetid[SMC_MAX_PORTS][SMC_MAX_PNETID_LEN];\n\t\t\t\t\t\t \n\tbool\t\t\tpnetid_by_user[SMC_MAX_PORTS];\n\t\t\t\t\t\t \n\tu8\t\t\tinitialized : 1;  \n\tstruct work_struct\tport_event_work;\n\tunsigned long\t\tport_event_mask;\n\tDECLARE_BITMAP(ports_going_away, SMC_MAX_PORTS);\n\tatomic_t\t\tlnk_cnt;\t \n\twait_queue_head_t\tlnks_deleted;\t \n\tstruct mutex\t\tmutex;\t\t \n\tatomic_t\t\tlnk_cnt_by_port[SMC_MAX_PORTS];\n\t\t\t\t\t\t \n\tint\t\t\tndev_ifidx[SMC_MAX_PORTS];  \n};\n\nstatic inline __be32 smc_ib_gid_to_ipv4(u8 gid[SMC_GID_SIZE])\n{\n\tstruct in6_addr *addr6 = (struct in6_addr *)gid;\n\n\tif (ipv6_addr_v4mapped(addr6) ||\n\t    !(addr6->s6_addr32[0] | addr6->s6_addr32[1] | addr6->s6_addr32[2]))\n\t\treturn addr6->s6_addr32[3];\n\treturn cpu_to_be32(INADDR_NONE);\n}\n\nstatic inline struct net *smc_ib_net(struct smc_ib_device *smcibdev)\n{\n\tif (smcibdev && smcibdev->ibdev)\n\t\treturn read_pnet(&smcibdev->ibdev->coredev.rdma_net);\n\treturn NULL;\n}\n\nstruct smc_init_info_smcrv2;\nstruct smc_buf_desc;\nstruct smc_link;\n\nvoid smc_ib_ndev_change(struct net_device *ndev, unsigned long event);\nint smc_ib_register_client(void) __init;\nvoid smc_ib_unregister_client(void);\nbool smc_ib_port_active(struct smc_ib_device *smcibdev, u8 ibport);\nint smc_ib_buf_map_sg(struct smc_link *lnk,\n\t\t      struct smc_buf_desc *buf_slot,\n\t\t      enum dma_data_direction data_direction);\nvoid smc_ib_buf_unmap_sg(struct smc_link *lnk,\n\t\t\t struct smc_buf_desc *buf_slot,\n\t\t\t enum dma_data_direction data_direction);\nvoid smc_ib_dealloc_protection_domain(struct smc_link *lnk);\nint smc_ib_create_protection_domain(struct smc_link *lnk);\nvoid smc_ib_destroy_queue_pair(struct smc_link *lnk);\nint smc_ib_create_queue_pair(struct smc_link *lnk);\nint smc_ib_ready_link(struct smc_link *lnk);\nint smc_ib_modify_qp_rts(struct smc_link *lnk);\nint smc_ib_modify_qp_error(struct smc_link *lnk);\nlong smc_ib_setup_per_ibdev(struct smc_ib_device *smcibdev);\nint smc_ib_get_memory_region(struct ib_pd *pd, int access_flags,\n\t\t\t     struct smc_buf_desc *buf_slot, u8 link_idx);\nvoid smc_ib_put_memory_region(struct ib_mr *mr);\nbool smc_ib_is_sg_need_sync(struct smc_link *lnk,\n\t\t\t    struct smc_buf_desc *buf_slot);\nvoid smc_ib_sync_sg_for_cpu(struct smc_link *lnk,\n\t\t\t    struct smc_buf_desc *buf_slot,\n\t\t\t    enum dma_data_direction data_direction);\nvoid smc_ib_sync_sg_for_device(struct smc_link *lnk,\n\t\t\t       struct smc_buf_desc *buf_slot,\n\t\t\t       enum dma_data_direction data_direction);\nint smc_ib_determine_gid(struct smc_ib_device *smcibdev, u8 ibport,\n\t\t\t unsigned short vlan_id, u8 gid[], u8 *sgid_index,\n\t\t\t struct smc_init_info_smcrv2 *smcrv2);\nint smc_ib_find_route(struct net *net, __be32 saddr, __be32 daddr,\n\t\t      u8 nexthop_mac[], u8 *uses_gateway);\nbool smc_ib_is_valid_local_systemid(void);\nint smcr_nl_get_device(struct sk_buff *skb, struct netlink_callback *cb);\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}