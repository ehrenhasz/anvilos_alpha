{
  "module_name": "ctrl.c",
  "hash_id": "6a79162c1a101ea120b44a80edcc4423b8606f2862d81f2a96738af46c1a530d",
  "original_prompt": "Ingested from linux-6.6.14/net/mptcp/ctrl.c",
  "human_readable_source": "\n \n\n#ifdef CONFIG_SYSCTL\n#include <linux/sysctl.h>\n#endif\n\n#include <net/net_namespace.h>\n#include <net/netns/generic.h>\n\n#include \"protocol.h\"\n\n#define MPTCP_SYSCTL_PATH \"net/mptcp\"\n\nstatic int mptcp_pernet_id;\n\n#ifdef CONFIG_SYSCTL\nstatic int mptcp_pm_type_max = __MPTCP_PM_TYPE_MAX;\n#endif\n\nstruct mptcp_pernet {\n#ifdef CONFIG_SYSCTL\n\tstruct ctl_table_header *ctl_table_hdr;\n#endif\n\n\tunsigned int add_addr_timeout;\n\tunsigned int stale_loss_cnt;\n\tu8 mptcp_enabled;\n\tu8 checksum_enabled;\n\tu8 allow_join_initial_addr_port;\n\tu8 pm_type;\n\tchar scheduler[MPTCP_SCHED_NAME_MAX];\n};\n\nstatic struct mptcp_pernet *mptcp_get_pernet(const struct net *net)\n{\n\treturn net_generic(net, mptcp_pernet_id);\n}\n\nint mptcp_is_enabled(const struct net *net)\n{\n\treturn mptcp_get_pernet(net)->mptcp_enabled;\n}\n\nunsigned int mptcp_get_add_addr_timeout(const struct net *net)\n{\n\treturn mptcp_get_pernet(net)->add_addr_timeout;\n}\n\nint mptcp_is_checksum_enabled(const struct net *net)\n{\n\treturn mptcp_get_pernet(net)->checksum_enabled;\n}\n\nint mptcp_allow_join_id0(const struct net *net)\n{\n\treturn mptcp_get_pernet(net)->allow_join_initial_addr_port;\n}\n\nunsigned int mptcp_stale_loss_cnt(const struct net *net)\n{\n\treturn mptcp_get_pernet(net)->stale_loss_cnt;\n}\n\nint mptcp_get_pm_type(const struct net *net)\n{\n\treturn mptcp_get_pernet(net)->pm_type;\n}\n\nconst char *mptcp_get_scheduler(const struct net *net)\n{\n\treturn mptcp_get_pernet(net)->scheduler;\n}\n\nstatic void mptcp_pernet_set_defaults(struct mptcp_pernet *pernet)\n{\n\tpernet->mptcp_enabled = 1;\n\tpernet->add_addr_timeout = TCP_RTO_MAX;\n\tpernet->checksum_enabled = 0;\n\tpernet->allow_join_initial_addr_port = 1;\n\tpernet->stale_loss_cnt = 4;\n\tpernet->pm_type = MPTCP_PM_TYPE_KERNEL;\n\tstrcpy(pernet->scheduler, \"default\");\n}\n\n#ifdef CONFIG_SYSCTL\nstatic struct ctl_table mptcp_sysctl_table[] = {\n\t{\n\t\t.procname = \"enabled\",\n\t\t.maxlen = sizeof(u8),\n\t\t.mode = 0644,\n\t\t \n\t\t.proc_handler = proc_dou8vec_minmax,\n\t\t.extra1       = SYSCTL_ZERO,\n\t\t.extra2       = SYSCTL_ONE\n\t},\n\t{\n\t\t.procname = \"add_addr_timeout\",\n\t\t.maxlen = sizeof(unsigned int),\n\t\t.mode = 0644,\n\t\t.proc_handler = proc_dointvec_jiffies,\n\t},\n\t{\n\t\t.procname = \"checksum_enabled\",\n\t\t.maxlen = sizeof(u8),\n\t\t.mode = 0644,\n\t\t.proc_handler = proc_dou8vec_minmax,\n\t\t.extra1       = SYSCTL_ZERO,\n\t\t.extra2       = SYSCTL_ONE\n\t},\n\t{\n\t\t.procname = \"allow_join_initial_addr_port\",\n\t\t.maxlen = sizeof(u8),\n\t\t.mode = 0644,\n\t\t.proc_handler = proc_dou8vec_minmax,\n\t\t.extra1       = SYSCTL_ZERO,\n\t\t.extra2       = SYSCTL_ONE\n\t},\n\t{\n\t\t.procname = \"stale_loss_cnt\",\n\t\t.maxlen = sizeof(unsigned int),\n\t\t.mode = 0644,\n\t\t.proc_handler = proc_douintvec_minmax,\n\t},\n\t{\n\t\t.procname = \"pm_type\",\n\t\t.maxlen = sizeof(u8),\n\t\t.mode = 0644,\n\t\t.proc_handler = proc_dou8vec_minmax,\n\t\t.extra1       = SYSCTL_ZERO,\n\t\t.extra2       = &mptcp_pm_type_max\n\t},\n\t{\n\t\t.procname = \"scheduler\",\n\t\t.maxlen\t= MPTCP_SCHED_NAME_MAX,\n\t\t.mode = 0644,\n\t\t.proc_handler = proc_dostring,\n\t},\n\t{}\n};\n\nstatic int mptcp_pernet_new_table(struct net *net, struct mptcp_pernet *pernet)\n{\n\tstruct ctl_table_header *hdr;\n\tstruct ctl_table *table;\n\n\ttable = mptcp_sysctl_table;\n\tif (!net_eq(net, &init_net)) {\n\t\ttable = kmemdup(table, sizeof(mptcp_sysctl_table), GFP_KERNEL);\n\t\tif (!table)\n\t\t\tgoto err_alloc;\n\t}\n\n\ttable[0].data = &pernet->mptcp_enabled;\n\ttable[1].data = &pernet->add_addr_timeout;\n\ttable[2].data = &pernet->checksum_enabled;\n\ttable[3].data = &pernet->allow_join_initial_addr_port;\n\ttable[4].data = &pernet->stale_loss_cnt;\n\ttable[5].data = &pernet->pm_type;\n\ttable[6].data = &pernet->scheduler;\n\n\thdr = register_net_sysctl_sz(net, MPTCP_SYSCTL_PATH, table,\n\t\t\t\t     ARRAY_SIZE(mptcp_sysctl_table));\n\tif (!hdr)\n\t\tgoto err_reg;\n\n\tpernet->ctl_table_hdr = hdr;\n\n\treturn 0;\n\nerr_reg:\n\tif (!net_eq(net, &init_net))\n\t\tkfree(table);\nerr_alloc:\n\treturn -ENOMEM;\n}\n\nstatic void mptcp_pernet_del_table(struct mptcp_pernet *pernet)\n{\n\tstruct ctl_table *table = pernet->ctl_table_hdr->ctl_table_arg;\n\n\tunregister_net_sysctl_table(pernet->ctl_table_hdr);\n\n\tkfree(table);\n}\n\n#else\n\nstatic int mptcp_pernet_new_table(struct net *net, struct mptcp_pernet *pernet)\n{\n\treturn 0;\n}\n\nstatic void mptcp_pernet_del_table(struct mptcp_pernet *pernet) {}\n\n#endif  \n\nstatic int __net_init mptcp_net_init(struct net *net)\n{\n\tstruct mptcp_pernet *pernet = mptcp_get_pernet(net);\n\n\tmptcp_pernet_set_defaults(pernet);\n\n\treturn mptcp_pernet_new_table(net, pernet);\n}\n\n \nstatic void __net_exit mptcp_net_exit(struct net *net)\n{\n\tstruct mptcp_pernet *pernet = mptcp_get_pernet(net);\n\n\tmptcp_pernet_del_table(pernet);\n}\n\nstatic struct pernet_operations mptcp_pernet_ops = {\n\t.init = mptcp_net_init,\n\t.exit = mptcp_net_exit,\n\t.id = &mptcp_pernet_id,\n\t.size = sizeof(struct mptcp_pernet),\n};\n\nvoid __init mptcp_init(void)\n{\n\tmptcp_join_cookie_init();\n\tmptcp_proto_init();\n\n\tif (register_pernet_subsys(&mptcp_pernet_ops) < 0)\n\t\tpanic(\"Failed to register MPTCP pernet subsystem.\\n\");\n}\n\n#if IS_ENABLED(CONFIG_MPTCP_IPV6)\nint __init mptcpv6_init(void)\n{\n\tint err;\n\n\terr = mptcp_proto_v6_init();\n\n\treturn err;\n}\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}