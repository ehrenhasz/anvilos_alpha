{
  "module_name": "fastopen.c",
  "hash_id": "b760844d4c5755e51f6296edb8cb33e12e284758cca52b1ac418f1c184b893ce",
  "original_prompt": "Ingested from linux-6.6.14/net/mptcp/fastopen.c",
  "human_readable_source": "\n \n\n#include \"protocol.h\"\n\nvoid mptcp_fastopen_subflow_synack_set_params(struct mptcp_subflow_context *subflow,\n\t\t\t\t\t      struct request_sock *req)\n{\n\tstruct sock *sk, *ssk;\n\tstruct sk_buff *skb;\n\tstruct tcp_sock *tp;\n\n\t \n\tif (!subflow)\n\t\treturn;\n\n\tssk = subflow->tcp_sock;\n\tsk = subflow->conn;\n\ttp = tcp_sk(ssk);\n\n\tsubflow->is_mptfo = 1;\n\n\tskb = skb_peek(&ssk->sk_receive_queue);\n\tif (WARN_ON_ONCE(!skb))\n\t\treturn;\n\n\t \n\t__skb_unlink(skb, &ssk->sk_receive_queue);\n\tskb_ext_reset(skb);\n\tskb_orphan(skb);\n\n\t \n\ttp->copied_seq += skb->len;\n\tsubflow->ssn_offset += skb->len;\n\n\t \n\tMPTCP_SKB_CB(skb)->map_seq = -skb->len;\n\tMPTCP_SKB_CB(skb)->end_seq = 0;\n\tMPTCP_SKB_CB(skb)->offset = 0;\n\tMPTCP_SKB_CB(skb)->has_rxtstamp = TCP_SKB_CB(skb)->has_rxtstamp;\n\n\tmptcp_data_lock(sk);\n\n\tmptcp_set_owner_r(skb, sk);\n\t__skb_queue_tail(&sk->sk_receive_queue, skb);\n\tmptcp_sk(sk)->bytes_received += skb->len;\n\n\tsk->sk_data_ready(sk);\n\n\tmptcp_data_unlock(sk);\n}\n\nvoid mptcp_fastopen_gen_msk_ackseq(struct mptcp_sock *msk, struct mptcp_subflow_context *subflow,\n\t\t\t\t   const struct mptcp_options_received *mp_opt)\n{\n\tstruct sock *sk = (struct sock *)msk;\n\tstruct sk_buff *skb;\n\n\tmptcp_data_lock(sk);\n\tskb = skb_peek_tail(&sk->sk_receive_queue);\n\tif (skb) {\n\t\tWARN_ON_ONCE(MPTCP_SKB_CB(skb)->end_seq);\n\t\tpr_debug(\"msk %p moving seq %llx -> %llx end_seq %llx -> %llx\", sk,\n\t\t\t MPTCP_SKB_CB(skb)->map_seq, MPTCP_SKB_CB(skb)->map_seq + msk->ack_seq,\n\t\t\t MPTCP_SKB_CB(skb)->end_seq, MPTCP_SKB_CB(skb)->end_seq + msk->ack_seq);\n\t\tMPTCP_SKB_CB(skb)->map_seq += msk->ack_seq;\n\t\tMPTCP_SKB_CB(skb)->end_seq += msk->ack_seq;\n\t}\n\n\tpr_debug(\"msk=%p ack_seq=%llx\", msk, msk->ack_seq);\n\tmptcp_data_unlock(sk);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}