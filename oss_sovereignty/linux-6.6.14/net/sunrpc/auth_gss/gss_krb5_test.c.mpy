{
  "module_name": "gss_krb5_test.c",
  "hash_id": "c343a33d3a6b18c81da974a2dc33302c9dd016fd780fb48dd491ab170917fb99",
  "original_prompt": "Ingested from linux-6.6.14/net/sunrpc/auth_gss/gss_krb5_test.c",
  "human_readable_source": "\n \n\n#include <kunit/test.h>\n#include <kunit/visibility.h>\n\n#include <linux/kernel.h>\n#include <crypto/hash.h>\n\n#include <linux/sunrpc/xdr.h>\n#include <linux/sunrpc/gss_krb5.h>\n\n#include \"gss_krb5_internal.h\"\n\nMODULE_IMPORT_NS(EXPORTED_FOR_KUNIT_TESTING);\n\nstruct gss_krb5_test_param {\n\tconst char\t\t\t*desc;\n\tu32\t\t\t\tenctype;\n\tu32\t\t\t\tnfold;\n\tu32\t\t\t\tconstant;\n\tconst struct xdr_netobj\t\t*base_key;\n\tconst struct xdr_netobj\t\t*Ke;\n\tconst struct xdr_netobj\t\t*usage;\n\tconst struct xdr_netobj\t\t*plaintext;\n\tconst struct xdr_netobj\t\t*confounder;\n\tconst struct xdr_netobj\t\t*expected_result;\n\tconst struct xdr_netobj\t\t*expected_hmac;\n\tconst struct xdr_netobj\t\t*next_iv;\n};\n\nstatic inline void gss_krb5_get_desc(const struct gss_krb5_test_param *param,\n\t\t\t\t     char *desc)\n{\n\tstrscpy(desc, param->desc, KUNIT_PARAM_DESC_SIZE);\n}\n\nstatic void kdf_case(struct kunit *test)\n{\n\tconst struct gss_krb5_test_param *param = test->param_value;\n\tconst struct gss_krb5_enctype *gk5e;\n\tstruct xdr_netobj derivedkey;\n\tint err;\n\n\t \n\tgk5e = gss_krb5_lookup_enctype(param->enctype);\n\tif (!gk5e)\n\t\tkunit_skip(test, \"Encryption type is not available\");\n\n\tderivedkey.data = kunit_kzalloc(test, param->expected_result->len,\n\t\t\t\t\tGFP_KERNEL);\n\tKUNIT_ASSERT_NOT_ERR_OR_NULL(test, derivedkey.data);\n\tderivedkey.len = param->expected_result->len;\n\n\t \n\terr = gk5e->derive_key(gk5e, param->base_key, &derivedkey,\n\t\t\t       param->usage, GFP_KERNEL);\n\tKUNIT_ASSERT_EQ(test, err, 0);\n\n\t \n\tKUNIT_EXPECT_EQ_MSG(test,\n\t\t\t    memcmp(param->expected_result->data,\n\t\t\t\t   derivedkey.data, derivedkey.len), 0,\n\t\t\t    \"key mismatch\");\n}\n\nstatic void checksum_case(struct kunit *test)\n{\n\tconst struct gss_krb5_test_param *param = test->param_value;\n\tstruct xdr_buf buf = {\n\t\t.head[0].iov_len\t= param->plaintext->len,\n\t\t.len\t\t\t= param->plaintext->len,\n\t};\n\tconst struct gss_krb5_enctype *gk5e;\n\tstruct xdr_netobj Kc, checksum;\n\tstruct crypto_ahash *tfm;\n\tint err;\n\n\t \n\tgk5e = gss_krb5_lookup_enctype(param->enctype);\n\tif (!gk5e)\n\t\tkunit_skip(test, \"Encryption type is not available\");\n\n\tKc.len = gk5e->Kc_length;\n\tKc.data = kunit_kzalloc(test, Kc.len, GFP_KERNEL);\n\tKUNIT_ASSERT_NOT_ERR_OR_NULL(test, Kc.data);\n\terr = gk5e->derive_key(gk5e, param->base_key, &Kc,\n\t\t\t       param->usage, GFP_KERNEL);\n\tKUNIT_ASSERT_EQ(test, err, 0);\n\n\ttfm = crypto_alloc_ahash(gk5e->cksum_name, 0, CRYPTO_ALG_ASYNC);\n\tKUNIT_ASSERT_NOT_ERR_OR_NULL(test, tfm);\n\terr = crypto_ahash_setkey(tfm, Kc.data, Kc.len);\n\tKUNIT_ASSERT_EQ(test, err, 0);\n\n\tbuf.head[0].iov_base = kunit_kzalloc(test, buf.head[0].iov_len, GFP_KERNEL);\n\tKUNIT_ASSERT_NOT_ERR_OR_NULL(test, buf.head[0].iov_base);\n\tmemcpy(buf.head[0].iov_base, param->plaintext->data, buf.head[0].iov_len);\n\n\tchecksum.len = gk5e->cksumlength;\n\tchecksum.data = kunit_kzalloc(test, checksum.len, GFP_KERNEL);\n\tKUNIT_ASSERT_NOT_ERR_OR_NULL(test, checksum.data);\n\n\t \n\terr = gss_krb5_checksum(tfm, NULL, 0, &buf, 0, &checksum);\n\tKUNIT_ASSERT_EQ(test, err, 0);\n\n\t \n\tKUNIT_EXPECT_EQ_MSG(test,\n\t\t\t    memcmp(param->expected_result->data,\n\t\t\t\t   checksum.data, checksum.len), 0,\n\t\t\t    \"checksum mismatch\");\n\n\tcrypto_free_ahash(tfm);\n}\n\n#define DEFINE_HEX_XDR_NETOBJ(name, hex_array...)\t\t\\\n\tstatic const u8 name ## _data[] = { hex_array };\t\\\n\tstatic const struct xdr_netobj name = {\t\t\t\\\n\t\t.data\t= (u8 *)name##_data,\t\t\t\\\n\t\t.len\t= sizeof(name##_data),\t\t\t\\\n\t}\n\n#define DEFINE_STR_XDR_NETOBJ(name, string)\t\t\t\\\n\tstatic const u8 name ## _str[] = string;\t\t\\\n\tstatic const struct xdr_netobj name = {\t\t\t\\\n\t\t.data\t= (u8 *)name##_str,\t\t\t\\\n\t\t.len\t= sizeof(name##_str) - 1,\t\t\\\n\t}\n\n \n\nDEFINE_HEX_XDR_NETOBJ(nfold_test1_plaintext,\n\t\t      0x30, 0x31, 0x32, 0x33, 0x34, 0x35\n);\nDEFINE_HEX_XDR_NETOBJ(nfold_test1_expected_result,\n\t\t      0xbe, 0x07, 0x26, 0x31, 0x27, 0x6b, 0x19, 0x55\n);\n\nDEFINE_HEX_XDR_NETOBJ(nfold_test2_plaintext,\n\t\t      0x70, 0x61, 0x73, 0x73, 0x77, 0x6f, 0x72, 0x64\n);\nDEFINE_HEX_XDR_NETOBJ(nfold_test2_expected_result,\n\t\t      0x78, 0xa0, 0x7b, 0x6c, 0xaf, 0x85, 0xfa\n);\n\nDEFINE_HEX_XDR_NETOBJ(nfold_test3_plaintext,\n\t\t      0x52, 0x6f, 0x75, 0x67, 0x68, 0x20, 0x43, 0x6f,\n\t\t      0x6e, 0x73, 0x65, 0x6e, 0x73, 0x75, 0x73, 0x2c,\n\t\t      0x20, 0x61, 0x6e, 0x64, 0x20, 0x52, 0x75, 0x6e,\n\t\t      0x6e, 0x69, 0x6e, 0x67, 0x20, 0x43, 0x6f, 0x64,\n\t\t      0x65\n);\nDEFINE_HEX_XDR_NETOBJ(nfold_test3_expected_result,\n\t\t      0xbb, 0x6e, 0xd3, 0x08, 0x70, 0xb7, 0xf0, 0xe0\n);\n\nDEFINE_HEX_XDR_NETOBJ(nfold_test4_plaintext,\n\t\t      0x70, 0x61, 0x73, 0x73, 0x77, 0x6f, 0x72, 0x64\n);\nDEFINE_HEX_XDR_NETOBJ(nfold_test4_expected_result,\n\t\t      0x59, 0xe4, 0xa8, 0xca, 0x7c, 0x03, 0x85, 0xc3,\n\t\t      0xc3, 0x7b, 0x3f, 0x6d, 0x20, 0x00, 0x24, 0x7c,\n\t\t      0xb6, 0xe6, 0xbd, 0x5b, 0x3e\n);\n\nDEFINE_HEX_XDR_NETOBJ(nfold_test5_plaintext,\n\t\t      0x4d, 0x41, 0x53, 0x53, 0x41, 0x43, 0x48, 0x56,\n\t\t      0x53, 0x45, 0x54, 0x54, 0x53, 0x20, 0x49, 0x4e,\n\t\t      0x53, 0x54, 0x49, 0x54, 0x56, 0x54, 0x45, 0x20,\n\t\t      0x4f, 0x46, 0x20, 0x54, 0x45, 0x43, 0x48, 0x4e,\n\t\t      0x4f, 0x4c, 0x4f, 0x47, 0x59\n);\nDEFINE_HEX_XDR_NETOBJ(nfold_test5_expected_result,\n\t\t      0xdb, 0x3b, 0x0d, 0x8f, 0x0b, 0x06, 0x1e, 0x60,\n\t\t      0x32, 0x82, 0xb3, 0x08, 0xa5, 0x08, 0x41, 0x22,\n\t\t      0x9a, 0xd7, 0x98, 0xfa, 0xb9, 0x54, 0x0c, 0x1b\n);\n\nDEFINE_HEX_XDR_NETOBJ(nfold_test6_plaintext,\n\t\t      0x51\n);\nDEFINE_HEX_XDR_NETOBJ(nfold_test6_expected_result,\n\t\t      0x51, 0x8a, 0x54, 0xa2, 0x15, 0xa8, 0x45, 0x2a,\n\t\t      0x51, 0x8a, 0x54, 0xa2, 0x15, 0xa8, 0x45, 0x2a,\n\t\t      0x51, 0x8a, 0x54, 0xa2, 0x15\n);\n\nDEFINE_HEX_XDR_NETOBJ(nfold_test7_plaintext,\n\t\t      0x62, 0x61\n);\nDEFINE_HEX_XDR_NETOBJ(nfold_test7_expected_result,\n\t\t      0xfb, 0x25, 0xd5, 0x31, 0xae, 0x89, 0x74, 0x49,\n\t\t      0x9f, 0x52, 0xfd, 0x92, 0xea, 0x98, 0x57, 0xc4,\n\t\t      0xba, 0x24, 0xcf, 0x29, 0x7e\n);\n\nDEFINE_HEX_XDR_NETOBJ(nfold_test_kerberos,\n\t\t      0x6b, 0x65, 0x72, 0x62, 0x65, 0x72, 0x6f, 0x73\n);\nDEFINE_HEX_XDR_NETOBJ(nfold_test8_expected_result,\n\t\t      0x6b, 0x65, 0x72, 0x62, 0x65, 0x72, 0x6f, 0x73\n);\nDEFINE_HEX_XDR_NETOBJ(nfold_test9_expected_result,\n\t\t      0x6b, 0x65, 0x72, 0x62, 0x65, 0x72, 0x6f, 0x73,\n\t\t      0x7b, 0x9b, 0x5b, 0x2b, 0x93, 0x13, 0x2b, 0x93\n);\nDEFINE_HEX_XDR_NETOBJ(nfold_test10_expected_result,\n\t\t      0x83, 0x72, 0xc2, 0x36, 0x34, 0x4e, 0x5f, 0x15,\n\t\t      0x50, 0xcd, 0x07, 0x47, 0xe1, 0x5d, 0x62, 0xca,\n\t\t      0x7a, 0x5a, 0x3b, 0xce, 0xa4\n);\nDEFINE_HEX_XDR_NETOBJ(nfold_test11_expected_result,\n\t\t      0x6b, 0x65, 0x72, 0x62, 0x65, 0x72, 0x6f, 0x73,\n\t\t      0x7b, 0x9b, 0x5b, 0x2b, 0x93, 0x13, 0x2b, 0x93,\n\t\t      0x5c, 0x9b, 0xdc, 0xda, 0xd9, 0x5c, 0x98, 0x99,\n\t\t      0xc4, 0xca, 0xe4, 0xde, 0xe6, 0xd6, 0xca, 0xe4\n);\n\nstatic const struct gss_krb5_test_param rfc3961_nfold_test_params[] = {\n\t{\n\t\t.desc\t\t\t= \"64-fold(\\\"012345\\\")\",\n\t\t.nfold\t\t\t= 64,\n\t\t.plaintext\t\t= &nfold_test1_plaintext,\n\t\t.expected_result\t= &nfold_test1_expected_result,\n\t},\n\t{\n\t\t.desc\t\t\t= \"56-fold(\\\"password\\\")\",\n\t\t.nfold\t\t\t= 56,\n\t\t.plaintext\t\t= &nfold_test2_plaintext,\n\t\t.expected_result\t= &nfold_test2_expected_result,\n\t},\n\t{\n\t\t.desc\t\t\t= \"64-fold(\\\"Rough Consensus, and Running Code\\\")\",\n\t\t.nfold\t\t\t= 64,\n\t\t.plaintext\t\t= &nfold_test3_plaintext,\n\t\t.expected_result\t= &nfold_test3_expected_result,\n\t},\n\t{\n\t\t.desc\t\t\t= \"168-fold(\\\"password\\\")\",\n\t\t.nfold\t\t\t= 168,\n\t\t.plaintext\t\t= &nfold_test4_plaintext,\n\t\t.expected_result\t= &nfold_test4_expected_result,\n\t},\n\t{\n\t\t.desc\t\t\t= \"192-fold(\\\"MASSACHVSETTS INSTITVTE OF TECHNOLOGY\\\")\",\n\t\t.nfold\t\t\t= 192,\n\t\t.plaintext\t\t= &nfold_test5_plaintext,\n\t\t.expected_result\t= &nfold_test5_expected_result,\n\t},\n\t{\n\t\t.desc\t\t\t= \"168-fold(\\\"Q\\\")\",\n\t\t.nfold\t\t\t= 168,\n\t\t.plaintext\t\t= &nfold_test6_plaintext,\n\t\t.expected_result\t= &nfold_test6_expected_result,\n\t},\n\t{\n\t\t.desc\t\t\t= \"168-fold(\\\"ba\\\")\",\n\t\t.nfold\t\t\t= 168,\n\t\t.plaintext\t\t= &nfold_test7_plaintext,\n\t\t.expected_result\t= &nfold_test7_expected_result,\n\t},\n\t{\n\t\t.desc\t\t\t= \"64-fold(\\\"kerberos\\\")\",\n\t\t.nfold\t\t\t= 64,\n\t\t.plaintext\t\t= &nfold_test_kerberos,\n\t\t.expected_result\t= &nfold_test8_expected_result,\n\t},\n\t{\n\t\t.desc\t\t\t= \"128-fold(\\\"kerberos\\\")\",\n\t\t.nfold\t\t\t= 128,\n\t\t.plaintext\t\t= &nfold_test_kerberos,\n\t\t.expected_result\t= &nfold_test9_expected_result,\n\t},\n\t{\n\t\t.desc\t\t\t= \"168-fold(\\\"kerberos\\\")\",\n\t\t.nfold\t\t\t= 168,\n\t\t.plaintext\t\t= &nfold_test_kerberos,\n\t\t.expected_result\t= &nfold_test10_expected_result,\n\t},\n\t{\n\t\t.desc\t\t\t= \"256-fold(\\\"kerberos\\\")\",\n\t\t.nfold\t\t\t= 256,\n\t\t.plaintext\t\t= &nfold_test_kerberos,\n\t\t.expected_result\t= &nfold_test11_expected_result,\n\t},\n};\n\n \nKUNIT_ARRAY_PARAM(rfc3961_nfold, rfc3961_nfold_test_params, gss_krb5_get_desc);\n\nstatic void rfc3961_nfold_case(struct kunit *test)\n{\n\tconst struct gss_krb5_test_param *param = test->param_value;\n\tu8 *result;\n\n\t \n\tresult = kunit_kzalloc(test, 4096, GFP_KERNEL);\n\tKUNIT_ASSERT_NOT_ERR_OR_NULL(test, result);\n\n\t \n\tkrb5_nfold(param->plaintext->len * 8, param->plaintext->data,\n\t\t   param->expected_result->len * 8, result);\n\n\t \n\tKUNIT_EXPECT_EQ_MSG(test,\n\t\t\t    memcmp(param->expected_result->data,\n\t\t\t\t   result, param->expected_result->len), 0,\n\t\t\t    \"result mismatch\");\n}\n\nstatic struct kunit_case rfc3961_test_cases[] = {\n\t{\n\t\t.name\t\t\t= \"RFC 3961 n-fold\",\n\t\t.run_case\t\t= rfc3961_nfold_case,\n\t\t.generate_params\t= rfc3961_nfold_gen_params,\n\t},\n\t{}\n};\n\nstatic struct kunit_suite rfc3961_suite = {\n\t.name\t\t\t= \"RFC 3961 tests\",\n\t.test_cases\t\t= rfc3961_test_cases,\n};\n\n \n\nDEFINE_HEX_XDR_NETOBJ(rfc3962_encryption_key,\n\t\t      0x63, 0x68, 0x69, 0x63, 0x6b, 0x65, 0x6e, 0x20,\n\t\t      0x74, 0x65, 0x72, 0x69, 0x79, 0x61, 0x6b, 0x69\n);\n\nDEFINE_HEX_XDR_NETOBJ(rfc3962_enc_test1_plaintext,\n\t\t      0x49, 0x20, 0x77, 0x6f, 0x75, 0x6c, 0x64, 0x20,\n\t\t      0x6c, 0x69, 0x6b, 0x65, 0x20, 0x74, 0x68, 0x65,\n\t\t      0x20\n);\nDEFINE_HEX_XDR_NETOBJ(rfc3962_enc_test1_expected_result,\n\t\t      0xc6, 0x35, 0x35, 0x68, 0xf2, 0xbf, 0x8c, 0xb4,\n\t\t      0xd8, 0xa5, 0x80, 0x36, 0x2d, 0xa7, 0xff, 0x7f,\n\t\t      0x97\n);\nDEFINE_HEX_XDR_NETOBJ(rfc3962_enc_test1_next_iv,\n\t\t      0xc6, 0x35, 0x35, 0x68, 0xf2, 0xbf, 0x8c, 0xb4,\n\t\t      0xd8, 0xa5, 0x80, 0x36, 0x2d, 0xa7, 0xff, 0x7f\n);\n\nDEFINE_HEX_XDR_NETOBJ(rfc3962_enc_test2_plaintext,\n\t\t      0x49, 0x20, 0x77, 0x6f, 0x75, 0x6c, 0x64, 0x20,\n\t\t      0x6c, 0x69, 0x6b, 0x65, 0x20, 0x74, 0x68, 0x65,\n\t\t      0x20, 0x47, 0x65, 0x6e, 0x65, 0x72, 0x61, 0x6c,\n\t\t      0x20, 0x47, 0x61, 0x75, 0x27, 0x73, 0x20\n);\nDEFINE_HEX_XDR_NETOBJ(rfc3962_enc_test2_expected_result,\n\t\t      0xfc, 0x00, 0x78, 0x3e, 0x0e, 0xfd, 0xb2, 0xc1,\n\t\t      0xd4, 0x45, 0xd4, 0xc8, 0xef, 0xf7, 0xed, 0x22,\n\t\t      0x97, 0x68, 0x72, 0x68, 0xd6, 0xec, 0xcc, 0xc0,\n\t\t      0xc0, 0x7b, 0x25, 0xe2, 0x5e, 0xcf, 0xe5\n);\nDEFINE_HEX_XDR_NETOBJ(rfc3962_enc_test2_next_iv,\n\t\t      0xfc, 0x00, 0x78, 0x3e, 0x0e, 0xfd, 0xb2, 0xc1,\n\t\t      0xd4, 0x45, 0xd4, 0xc8, 0xef, 0xf7, 0xed, 0x22\n);\n\nDEFINE_HEX_XDR_NETOBJ(rfc3962_enc_test3_plaintext,\n\t\t      0x49, 0x20, 0x77, 0x6f, 0x75, 0x6c, 0x64, 0x20,\n\t\t      0x6c, 0x69, 0x6b, 0x65, 0x20, 0x74, 0x68, 0x65,\n\t\t      0x20, 0x47, 0x65, 0x6e, 0x65, 0x72, 0x61, 0x6c,\n\t\t      0x20, 0x47, 0x61, 0x75, 0x27, 0x73, 0x20, 0x43\n);\nDEFINE_HEX_XDR_NETOBJ(rfc3962_enc_test3_expected_result,\n\t\t      0x39, 0x31, 0x25, 0x23, 0xa7, 0x86, 0x62, 0xd5,\n\t\t      0xbe, 0x7f, 0xcb, 0xcc, 0x98, 0xeb, 0xf5, 0xa8,\n\t\t      0x97, 0x68, 0x72, 0x68, 0xd6, 0xec, 0xcc, 0xc0,\n\t\t      0xc0, 0x7b, 0x25, 0xe2, 0x5e, 0xcf, 0xe5, 0x84\n);\nDEFINE_HEX_XDR_NETOBJ(rfc3962_enc_test3_next_iv,\n\t\t      0x39, 0x31, 0x25, 0x23, 0xa7, 0x86, 0x62, 0xd5,\n\t\t      0xbe, 0x7f, 0xcb, 0xcc, 0x98, 0xeb, 0xf5, 0xa8\n);\n\nDEFINE_HEX_XDR_NETOBJ(rfc3962_enc_test4_plaintext,\n\t\t      0x49, 0x20, 0x77, 0x6f, 0x75, 0x6c, 0x64, 0x20,\n\t\t      0x6c, 0x69, 0x6b, 0x65, 0x20, 0x74, 0x68, 0x65,\n\t\t      0x20, 0x47, 0x65, 0x6e, 0x65, 0x72, 0x61, 0x6c,\n\t\t      0x20, 0x47, 0x61, 0x75, 0x27, 0x73, 0x20, 0x43,\n\t\t      0x68, 0x69, 0x63, 0x6b, 0x65, 0x6e, 0x2c, 0x20,\n\t\t      0x70, 0x6c, 0x65, 0x61, 0x73, 0x65, 0x2c\n);\nDEFINE_HEX_XDR_NETOBJ(rfc3962_enc_test4_expected_result,\n\t\t      0x97, 0x68, 0x72, 0x68, 0xd6, 0xec, 0xcc, 0xc0,\n\t\t      0xc0, 0x7b, 0x25, 0xe2, 0x5e, 0xcf, 0xe5, 0x84,\n\t\t      0xb3, 0xff, 0xfd, 0x94, 0x0c, 0x16, 0xa1, 0x8c,\n\t\t      0x1b, 0x55, 0x49, 0xd2, 0xf8, 0x38, 0x02, 0x9e,\n\t\t      0x39, 0x31, 0x25, 0x23, 0xa7, 0x86, 0x62, 0xd5,\n\t\t      0xbe, 0x7f, 0xcb, 0xcc, 0x98, 0xeb, 0xf5\n);\nDEFINE_HEX_XDR_NETOBJ(rfc3962_enc_test4_next_iv,\n\t\t      0xb3, 0xff, 0xfd, 0x94, 0x0c, 0x16, 0xa1, 0x8c,\n\t\t      0x1b, 0x55, 0x49, 0xd2, 0xf8, 0x38, 0x02, 0x9e\n);\n\nDEFINE_HEX_XDR_NETOBJ(rfc3962_enc_test5_plaintext,\n\t\t      0x49, 0x20, 0x77, 0x6f, 0x75, 0x6c, 0x64, 0x20,\n\t\t      0x6c, 0x69, 0x6b, 0x65, 0x20, 0x74, 0x68, 0x65,\n\t\t      0x20, 0x47, 0x65, 0x6e, 0x65, 0x72, 0x61, 0x6c,\n\t\t      0x20, 0x47, 0x61, 0x75, 0x27, 0x73, 0x20, 0x43,\n\t\t      0x68, 0x69, 0x63, 0x6b, 0x65, 0x6e, 0x2c, 0x20,\n\t\t      0x70, 0x6c, 0x65, 0x61, 0x73, 0x65, 0x2c, 0x20\n);\nDEFINE_HEX_XDR_NETOBJ(rfc3962_enc_test5_expected_result,\n\t\t      0x97, 0x68, 0x72, 0x68, 0xd6, 0xec, 0xcc, 0xc0,\n\t\t      0xc0, 0x7b, 0x25, 0xe2, 0x5e, 0xcf, 0xe5, 0x84,\n\t\t      0x9d, 0xad, 0x8b, 0xbb, 0x96, 0xc4, 0xcd, 0xc0,\n\t\t      0x3b, 0xc1, 0x03, 0xe1, 0xa1, 0x94, 0xbb, 0xd8,\n\t\t      0x39, 0x31, 0x25, 0x23, 0xa7, 0x86, 0x62, 0xd5,\n\t\t      0xbe, 0x7f, 0xcb, 0xcc, 0x98, 0xeb, 0xf5, 0xa8\n);\nDEFINE_HEX_XDR_NETOBJ(rfc3962_enc_test5_next_iv,\n\t\t      0x9d, 0xad, 0x8b, 0xbb, 0x96, 0xc4, 0xcd, 0xc0,\n\t\t      0x3b, 0xc1, 0x03, 0xe1, 0xa1, 0x94, 0xbb, 0xd8\n);\n\nDEFINE_HEX_XDR_NETOBJ(rfc3962_enc_test6_plaintext,\n\t\t      0x49, 0x20, 0x77, 0x6f, 0x75, 0x6c, 0x64, 0x20,\n\t\t      0x6c, 0x69, 0x6b, 0x65, 0x20, 0x74, 0x68, 0x65,\n\t\t      0x20, 0x47, 0x65, 0x6e, 0x65, 0x72, 0x61, 0x6c,\n\t\t      0x20, 0x47, 0x61, 0x75, 0x27, 0x73, 0x20, 0x43,\n\t\t      0x68, 0x69, 0x63, 0x6b, 0x65, 0x6e, 0x2c, 0x20,\n\t\t      0x70, 0x6c, 0x65, 0x61, 0x73, 0x65, 0x2c, 0x20,\n\t\t      0x61, 0x6e, 0x64, 0x20, 0x77, 0x6f, 0x6e, 0x74,\n\t\t      0x6f, 0x6e, 0x20, 0x73, 0x6f, 0x75, 0x70, 0x2e\n);\nDEFINE_HEX_XDR_NETOBJ(rfc3962_enc_test6_expected_result,\n\t\t      0x97, 0x68, 0x72, 0x68, 0xd6, 0xec, 0xcc, 0xc0,\n\t\t      0xc0, 0x7b, 0x25, 0xe2, 0x5e, 0xcf, 0xe5, 0x84,\n\t\t      0x39, 0x31, 0x25, 0x23, 0xa7, 0x86, 0x62, 0xd5,\n\t\t      0xbe, 0x7f, 0xcb, 0xcc, 0x98, 0xeb, 0xf5, 0xa8,\n\t\t      0x48, 0x07, 0xef, 0xe8, 0x36, 0xee, 0x89, 0xa5,\n\t\t      0x26, 0x73, 0x0d, 0xbc, 0x2f, 0x7b, 0xc8, 0x40,\n\t\t      0x9d, 0xad, 0x8b, 0xbb, 0x96, 0xc4, 0xcd, 0xc0,\n\t\t      0x3b, 0xc1, 0x03, 0xe1, 0xa1, 0x94, 0xbb, 0xd8\n);\nDEFINE_HEX_XDR_NETOBJ(rfc3962_enc_test6_next_iv,\n\t\t      0x48, 0x07, 0xef, 0xe8, 0x36, 0xee, 0x89, 0xa5,\n\t\t      0x26, 0x73, 0x0d, 0xbc, 0x2f, 0x7b, 0xc8, 0x40\n);\n\nstatic const struct gss_krb5_test_param rfc3962_encrypt_test_params[] = {\n\t{\n\t\t.desc\t\t\t= \"Encrypt with aes128-cts-hmac-sha1-96 case 1\",\n\t\t.enctype\t\t= ENCTYPE_AES128_CTS_HMAC_SHA1_96,\n\t\t.Ke\t\t\t= &rfc3962_encryption_key,\n\t\t.plaintext\t\t= &rfc3962_enc_test1_plaintext,\n\t\t.expected_result\t= &rfc3962_enc_test1_expected_result,\n\t\t.next_iv\t\t= &rfc3962_enc_test1_next_iv,\n\t},\n\t{\n\t\t.desc\t\t\t= \"Encrypt with aes128-cts-hmac-sha1-96 case 2\",\n\t\t.enctype\t\t= ENCTYPE_AES128_CTS_HMAC_SHA1_96,\n\t\t.Ke\t\t\t= &rfc3962_encryption_key,\n\t\t.plaintext\t\t= &rfc3962_enc_test2_plaintext,\n\t\t.expected_result\t= &rfc3962_enc_test2_expected_result,\n\t\t.next_iv\t\t= &rfc3962_enc_test2_next_iv,\n\t},\n\t{\n\t\t.desc\t\t\t= \"Encrypt with aes128-cts-hmac-sha1-96 case 3\",\n\t\t.enctype\t\t= ENCTYPE_AES128_CTS_HMAC_SHA1_96,\n\t\t.Ke\t\t\t= &rfc3962_encryption_key,\n\t\t.plaintext\t\t= &rfc3962_enc_test3_plaintext,\n\t\t.expected_result\t= &rfc3962_enc_test3_expected_result,\n\t\t.next_iv\t\t= &rfc3962_enc_test3_next_iv,\n\t},\n\t{\n\t\t.desc\t\t\t= \"Encrypt with aes128-cts-hmac-sha1-96 case 4\",\n\t\t.enctype\t\t= ENCTYPE_AES128_CTS_HMAC_SHA1_96,\n\t\t.Ke\t\t\t= &rfc3962_encryption_key,\n\t\t.plaintext\t\t= &rfc3962_enc_test4_plaintext,\n\t\t.expected_result\t= &rfc3962_enc_test4_expected_result,\n\t\t.next_iv\t\t= &rfc3962_enc_test4_next_iv,\n\t},\n\t{\n\t\t.desc\t\t\t= \"Encrypt with aes128-cts-hmac-sha1-96 case 5\",\n\t\t.enctype\t\t= ENCTYPE_AES128_CTS_HMAC_SHA1_96,\n\t\t.Ke\t\t\t= &rfc3962_encryption_key,\n\t\t.plaintext\t\t= &rfc3962_enc_test5_plaintext,\n\t\t.expected_result\t= &rfc3962_enc_test5_expected_result,\n\t\t.next_iv\t\t= &rfc3962_enc_test5_next_iv,\n\t},\n\t{\n\t\t.desc\t\t\t= \"Encrypt with aes128-cts-hmac-sha1-96 case 6\",\n\t\t.enctype\t\t= ENCTYPE_AES128_CTS_HMAC_SHA1_96,\n\t\t.Ke\t\t\t= &rfc3962_encryption_key,\n\t\t.plaintext\t\t= &rfc3962_enc_test6_plaintext,\n\t\t.expected_result\t= &rfc3962_enc_test6_expected_result,\n\t\t.next_iv\t\t= &rfc3962_enc_test6_next_iv,\n\t},\n};\n\n \nKUNIT_ARRAY_PARAM(rfc3962_encrypt, rfc3962_encrypt_test_params,\n\t\t  gss_krb5_get_desc);\n\n \nstatic void rfc3962_encrypt_case(struct kunit *test)\n{\n\tconst struct gss_krb5_test_param *param = test->param_value;\n\tstruct crypto_sync_skcipher *cts_tfm, *cbc_tfm;\n\tconst struct gss_krb5_enctype *gk5e;\n\tstruct xdr_buf buf;\n\tvoid *iv, *text;\n\tu32 err;\n\n\t \n\tgk5e = gss_krb5_lookup_enctype(param->enctype);\n\tif (!gk5e)\n\t\tkunit_skip(test, \"Encryption type is not available\");\n\n\tcbc_tfm = crypto_alloc_sync_skcipher(gk5e->aux_cipher, 0, 0);\n\tKUNIT_ASSERT_NOT_ERR_OR_NULL(test, cbc_tfm);\n\terr = crypto_sync_skcipher_setkey(cbc_tfm, param->Ke->data, param->Ke->len);\n\tKUNIT_ASSERT_EQ(test, err, 0);\n\n\tcts_tfm = crypto_alloc_sync_skcipher(gk5e->encrypt_name, 0, 0);\n\tKUNIT_ASSERT_NOT_ERR_OR_NULL(test, cts_tfm);\n\terr = crypto_sync_skcipher_setkey(cts_tfm, param->Ke->data, param->Ke->len);\n\tKUNIT_ASSERT_EQ(test, err, 0);\n\n\tiv = kunit_kzalloc(test, crypto_sync_skcipher_ivsize(cts_tfm), GFP_KERNEL);\n\tKUNIT_ASSERT_NOT_ERR_OR_NULL(test, iv);\n\n\ttext = kunit_kzalloc(test, param->plaintext->len, GFP_KERNEL);\n\tKUNIT_ASSERT_NOT_ERR_OR_NULL(test, text);\n\n\tmemcpy(text, param->plaintext->data, param->plaintext->len);\n\tmemset(&buf, 0, sizeof(buf));\n\tbuf.head[0].iov_base = text;\n\tbuf.head[0].iov_len = param->plaintext->len;\n\tbuf.len = buf.head[0].iov_len;\n\n\t \n\terr = krb5_cbc_cts_encrypt(cts_tfm, cbc_tfm, 0, &buf, NULL,\n\t\t\t\t   iv, crypto_sync_skcipher_ivsize(cts_tfm));\n\tKUNIT_ASSERT_EQ(test, err, 0);\n\n\t \n\tKUNIT_EXPECT_EQ_MSG(test,\n\t\t\t    param->expected_result->len, buf.len,\n\t\t\t    \"ciphertext length mismatch\");\n\tKUNIT_EXPECT_EQ_MSG(test,\n\t\t\t    memcmp(param->expected_result->data,\n\t\t\t\t   text, param->expected_result->len), 0,\n\t\t\t    \"ciphertext mismatch\");\n\tKUNIT_EXPECT_EQ_MSG(test,\n\t\t\t    memcmp(param->next_iv->data, iv,\n\t\t\t\t   param->next_iv->len), 0,\n\t\t\t    \"IV mismatch\");\n\n\tcrypto_free_sync_skcipher(cts_tfm);\n\tcrypto_free_sync_skcipher(cbc_tfm);\n}\n\nstatic struct kunit_case rfc3962_test_cases[] = {\n\t{\n\t\t.name\t\t\t= \"RFC 3962 encryption\",\n\t\t.run_case\t\t= rfc3962_encrypt_case,\n\t\t.generate_params\t= rfc3962_encrypt_gen_params,\n\t},\n\t{}\n};\n\nstatic struct kunit_suite rfc3962_suite = {\n\t.name\t\t\t= \"RFC 3962 suite\",\n\t.test_cases\t\t= rfc3962_test_cases,\n};\n\n \n\nDEFINE_HEX_XDR_NETOBJ(camellia128_cts_cmac_basekey,\n\t\t      0x57, 0xd0, 0x29, 0x72, 0x98, 0xff, 0xd9, 0xd3,\n\t\t      0x5d, 0xe5, 0xa4, 0x7f, 0xb4, 0xbd, 0xe2, 0x4b\n);\nDEFINE_HEX_XDR_NETOBJ(camellia128_cts_cmac_Kc,\n\t\t      0xd1, 0x55, 0x77, 0x5a, 0x20, 0x9d, 0x05, 0xf0,\n\t\t      0x2b, 0x38, 0xd4, 0x2a, 0x38, 0x9e, 0x5a, 0x56\n);\nDEFINE_HEX_XDR_NETOBJ(camellia128_cts_cmac_Ke,\n\t\t      0x64, 0xdf, 0x83, 0xf8, 0x5a, 0x53, 0x2f, 0x17,\n\t\t      0x57, 0x7d, 0x8c, 0x37, 0x03, 0x57, 0x96, 0xab\n);\nDEFINE_HEX_XDR_NETOBJ(camellia128_cts_cmac_Ki,\n\t\t      0x3e, 0x4f, 0xbd, 0xf3, 0x0f, 0xb8, 0x25, 0x9c,\n\t\t      0x42, 0x5c, 0xb6, 0xc9, 0x6f, 0x1f, 0x46, 0x35\n);\n\nDEFINE_HEX_XDR_NETOBJ(camellia256_cts_cmac_basekey,\n\t\t      0xb9, 0xd6, 0x82, 0x8b, 0x20, 0x56, 0xb7, 0xbe,\n\t\t      0x65, 0x6d, 0x88, 0xa1, 0x23, 0xb1, 0xfa, 0xc6,\n\t\t      0x82, 0x14, 0xac, 0x2b, 0x72, 0x7e, 0xcf, 0x5f,\n\t\t      0x69, 0xaf, 0xe0, 0xc4, 0xdf, 0x2a, 0x6d, 0x2c\n);\nDEFINE_HEX_XDR_NETOBJ(camellia256_cts_cmac_Kc,\n\t\t      0xe4, 0x67, 0xf9, 0xa9, 0x55, 0x2b, 0xc7, 0xd3,\n\t\t      0x15, 0x5a, 0x62, 0x20, 0xaf, 0x9c, 0x19, 0x22,\n\t\t      0x0e, 0xee, 0xd4, 0xff, 0x78, 0xb0, 0xd1, 0xe6,\n\t\t      0xa1, 0x54, 0x49, 0x91, 0x46, 0x1a, 0x9e, 0x50\n);\nDEFINE_HEX_XDR_NETOBJ(camellia256_cts_cmac_Ke,\n\t\t      0x41, 0x2a, 0xef, 0xc3, 0x62, 0xa7, 0x28, 0x5f,\n\t\t      0xc3, 0x96, 0x6c, 0x6a, 0x51, 0x81, 0xe7, 0x60,\n\t\t      0x5a, 0xe6, 0x75, 0x23, 0x5b, 0x6d, 0x54, 0x9f,\n\t\t      0xbf, 0xc9, 0xab, 0x66, 0x30, 0xa4, 0xc6, 0x04\n);\nDEFINE_HEX_XDR_NETOBJ(camellia256_cts_cmac_Ki,\n\t\t      0xfa, 0x62, 0x4f, 0xa0, 0xe5, 0x23, 0x99, 0x3f,\n\t\t      0xa3, 0x88, 0xae, 0xfd, 0xc6, 0x7e, 0x67, 0xeb,\n\t\t      0xcd, 0x8c, 0x08, 0xe8, 0xa0, 0x24, 0x6b, 0x1d,\n\t\t      0x73, 0xb0, 0xd1, 0xdd, 0x9f, 0xc5, 0x82, 0xb0\n);\n\nDEFINE_HEX_XDR_NETOBJ(usage_checksum,\n\t\t      0x00, 0x00, 0x00, 0x02, KEY_USAGE_SEED_CHECKSUM\n);\nDEFINE_HEX_XDR_NETOBJ(usage_encryption,\n\t\t      0x00, 0x00, 0x00, 0x02, KEY_USAGE_SEED_ENCRYPTION\n);\nDEFINE_HEX_XDR_NETOBJ(usage_integrity,\n\t\t      0x00, 0x00, 0x00, 0x02, KEY_USAGE_SEED_INTEGRITY\n);\n\nstatic const struct gss_krb5_test_param rfc6803_kdf_test_params[] = {\n\t{\n\t\t.desc\t\t\t= \"Derive Kc subkey for camellia128-cts-cmac\",\n\t\t.enctype\t\t= ENCTYPE_CAMELLIA128_CTS_CMAC,\n\t\t.base_key\t\t= &camellia128_cts_cmac_basekey,\n\t\t.usage\t\t\t= &usage_checksum,\n\t\t.expected_result\t= &camellia128_cts_cmac_Kc,\n\t},\n\t{\n\t\t.desc\t\t\t= \"Derive Ke subkey for camellia128-cts-cmac\",\n\t\t.enctype\t\t= ENCTYPE_CAMELLIA128_CTS_CMAC,\n\t\t.base_key\t\t= &camellia128_cts_cmac_basekey,\n\t\t.usage\t\t\t= &usage_encryption,\n\t\t.expected_result\t= &camellia128_cts_cmac_Ke,\n\t},\n\t{\n\t\t.desc\t\t\t= \"Derive Ki subkey for camellia128-cts-cmac\",\n\t\t.enctype\t\t= ENCTYPE_CAMELLIA128_CTS_CMAC,\n\t\t.base_key\t\t= &camellia128_cts_cmac_basekey,\n\t\t.usage\t\t\t= &usage_integrity,\n\t\t.expected_result\t= &camellia128_cts_cmac_Ki,\n\t},\n\t{\n\t\t.desc\t\t\t= \"Derive Kc subkey for camellia256-cts-cmac\",\n\t\t.enctype\t\t= ENCTYPE_CAMELLIA256_CTS_CMAC,\n\t\t.base_key\t\t= &camellia256_cts_cmac_basekey,\n\t\t.usage\t\t\t= &usage_checksum,\n\t\t.expected_result\t= &camellia256_cts_cmac_Kc,\n\t},\n\t{\n\t\t.desc\t\t\t= \"Derive Ke subkey for camellia256-cts-cmac\",\n\t\t.enctype\t\t= ENCTYPE_CAMELLIA256_CTS_CMAC,\n\t\t.base_key\t\t= &camellia256_cts_cmac_basekey,\n\t\t.usage\t\t\t= &usage_encryption,\n\t\t.expected_result\t= &camellia256_cts_cmac_Ke,\n\t},\n\t{\n\t\t.desc\t\t\t= \"Derive Ki subkey for camellia256-cts-cmac\",\n\t\t.enctype\t\t= ENCTYPE_CAMELLIA256_CTS_CMAC,\n\t\t.base_key\t\t= &camellia256_cts_cmac_basekey,\n\t\t.usage\t\t\t= &usage_integrity,\n\t\t.expected_result\t= &camellia256_cts_cmac_Ki,\n\t},\n};\n\n \nKUNIT_ARRAY_PARAM(rfc6803_kdf, rfc6803_kdf_test_params, gss_krb5_get_desc);\n\n \nDEFINE_STR_XDR_NETOBJ(rfc6803_checksum_test1_plaintext,\n\t\t      \"abcdefghijk\");\nDEFINE_HEX_XDR_NETOBJ(rfc6803_checksum_test1_basekey,\n\t\t      0x1d, 0xc4, 0x6a, 0x8d, 0x76, 0x3f, 0x4f, 0x93,\n\t\t      0x74, 0x2b, 0xcb, 0xa3, 0x38, 0x75, 0x76, 0xc3\n);\nDEFINE_HEX_XDR_NETOBJ(rfc6803_checksum_test1_usage,\n\t\t      0x00, 0x00, 0x00, 0x07, KEY_USAGE_SEED_CHECKSUM\n);\nDEFINE_HEX_XDR_NETOBJ(rfc6803_checksum_test1_expected_result,\n\t\t      0x11, 0x78, 0xe6, 0xc5, 0xc4, 0x7a, 0x8c, 0x1a,\n\t\t      0xe0, 0xc4, 0xb9, 0xc7, 0xd4, 0xeb, 0x7b, 0x6b\n);\n\nDEFINE_STR_XDR_NETOBJ(rfc6803_checksum_test2_plaintext,\n\t\t      \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\");\nDEFINE_HEX_XDR_NETOBJ(rfc6803_checksum_test2_basekey,\n\t\t      0x50, 0x27, 0xbc, 0x23, 0x1d, 0x0f, 0x3a, 0x9d,\n\t\t      0x23, 0x33, 0x3f, 0x1c, 0xa6, 0xfd, 0xbe, 0x7c\n);\nDEFINE_HEX_XDR_NETOBJ(rfc6803_checksum_test2_usage,\n\t\t      0x00, 0x00, 0x00, 0x08, KEY_USAGE_SEED_CHECKSUM\n);\nDEFINE_HEX_XDR_NETOBJ(rfc6803_checksum_test2_expected_result,\n\t\t      0xd1, 0xb3, 0x4f, 0x70, 0x04, 0xa7, 0x31, 0xf2,\n\t\t      0x3a, 0x0c, 0x00, 0xbf, 0x6c, 0x3f, 0x75, 0x3a\n);\n\nDEFINE_STR_XDR_NETOBJ(rfc6803_checksum_test3_plaintext,\n\t\t      \"123456789\");\nDEFINE_HEX_XDR_NETOBJ(rfc6803_checksum_test3_basekey,\n\t\t      0xb6, 0x1c, 0x86, 0xcc, 0x4e, 0x5d, 0x27, 0x57,\n\t\t      0x54, 0x5a, 0xd4, 0x23, 0x39, 0x9f, 0xb7, 0x03,\n\t\t      0x1e, 0xca, 0xb9, 0x13, 0xcb, 0xb9, 0x00, 0xbd,\n\t\t      0x7a, 0x3c, 0x6d, 0xd8, 0xbf, 0x92, 0x01, 0x5b\n);\nDEFINE_HEX_XDR_NETOBJ(rfc6803_checksum_test3_usage,\n\t\t      0x00, 0x00, 0x00, 0x09, KEY_USAGE_SEED_CHECKSUM\n);\nDEFINE_HEX_XDR_NETOBJ(rfc6803_checksum_test3_expected_result,\n\t\t      0x87, 0xa1, 0x2c, 0xfd, 0x2b, 0x96, 0x21, 0x48,\n\t\t      0x10, 0xf0, 0x1c, 0x82, 0x6e, 0x77, 0x44, 0xb1\n);\n\nDEFINE_STR_XDR_NETOBJ(rfc6803_checksum_test4_plaintext,\n\t\t      \"!@#$%^&*()!@#$%^&*()!@#$%^&*()\");\nDEFINE_HEX_XDR_NETOBJ(rfc6803_checksum_test4_basekey,\n\t\t      0x32, 0x16, 0x4c, 0x5b, 0x43, 0x4d, 0x1d, 0x15,\n\t\t      0x38, 0xe4, 0xcf, 0xd9, 0xbe, 0x80, 0x40, 0xfe,\n\t\t      0x8c, 0x4a, 0xc7, 0xac, 0xc4, 0xb9, 0x3d, 0x33,\n\t\t      0x14, 0xd2, 0x13, 0x36, 0x68, 0x14, 0x7a, 0x05\n);\nDEFINE_HEX_XDR_NETOBJ(rfc6803_checksum_test4_usage,\n\t\t      0x00, 0x00, 0x00, 0x0a, KEY_USAGE_SEED_CHECKSUM\n);\nDEFINE_HEX_XDR_NETOBJ(rfc6803_checksum_test4_expected_result,\n\t\t      0x3f, 0xa0, 0xb4, 0x23, 0x55, 0xe5, 0x2b, 0x18,\n\t\t      0x91, 0x87, 0x29, 0x4a, 0xa2, 0x52, 0xab, 0x64\n);\n\nstatic const struct gss_krb5_test_param rfc6803_checksum_test_params[] = {\n\t{\n\t\t.desc\t\t\t= \"camellia128-cts-cmac checksum test 1\",\n\t\t.enctype\t\t= ENCTYPE_CAMELLIA128_CTS_CMAC,\n\t\t.base_key\t\t= &rfc6803_checksum_test1_basekey,\n\t\t.usage\t\t\t= &rfc6803_checksum_test1_usage,\n\t\t.plaintext\t\t= &rfc6803_checksum_test1_plaintext,\n\t\t.expected_result\t= &rfc6803_checksum_test1_expected_result,\n\t},\n\t{\n\t\t.desc\t\t\t= \"camellia128-cts-cmac checksum test 2\",\n\t\t.enctype\t\t= ENCTYPE_CAMELLIA128_CTS_CMAC,\n\t\t.base_key\t\t= &rfc6803_checksum_test2_basekey,\n\t\t.usage\t\t\t= &rfc6803_checksum_test2_usage,\n\t\t.plaintext\t\t= &rfc6803_checksum_test2_plaintext,\n\t\t.expected_result\t= &rfc6803_checksum_test2_expected_result,\n\t},\n\t{\n\t\t.desc\t\t\t= \"camellia256-cts-cmac checksum test 3\",\n\t\t.enctype\t\t= ENCTYPE_CAMELLIA256_CTS_CMAC,\n\t\t.base_key\t\t= &rfc6803_checksum_test3_basekey,\n\t\t.usage\t\t\t= &rfc6803_checksum_test3_usage,\n\t\t.plaintext\t\t= &rfc6803_checksum_test3_plaintext,\n\t\t.expected_result\t= &rfc6803_checksum_test3_expected_result,\n\t},\n\t{\n\t\t.desc\t\t\t= \"camellia256-cts-cmac checksum test 4\",\n\t\t.enctype\t\t= ENCTYPE_CAMELLIA256_CTS_CMAC,\n\t\t.base_key\t\t= &rfc6803_checksum_test4_basekey,\n\t\t.usage\t\t\t= &rfc6803_checksum_test4_usage,\n\t\t.plaintext\t\t= &rfc6803_checksum_test4_plaintext,\n\t\t.expected_result\t= &rfc6803_checksum_test4_expected_result,\n\t},\n};\n\n \nKUNIT_ARRAY_PARAM(rfc6803_checksum, rfc6803_checksum_test_params,\n\t\t  gss_krb5_get_desc);\n\n \n\nstatic const struct xdr_netobj rfc6803_enc_empty_plaintext = {\n\t.len\t= 0,\n};\n\nDEFINE_STR_XDR_NETOBJ(rfc6803_enc_1byte_plaintext, \"1\");\nDEFINE_STR_XDR_NETOBJ(rfc6803_enc_9byte_plaintext, \"9 bytesss\");\nDEFINE_STR_XDR_NETOBJ(rfc6803_enc_13byte_plaintext, \"13 bytes byte\");\nDEFINE_STR_XDR_NETOBJ(rfc6803_enc_30byte_plaintext,\n\t\t      \"30 bytes bytes bytes bytes byt\"\n);\n\nDEFINE_HEX_XDR_NETOBJ(rfc6803_enc_test1_confounder,\n\t\t      0xb6, 0x98, 0x22, 0xa1, 0x9a, 0x6b, 0x09, 0xc0,\n\t\t      0xeb, 0xc8, 0x55, 0x7d, 0x1f, 0x1b, 0x6c, 0x0a\n);\nDEFINE_HEX_XDR_NETOBJ(rfc6803_enc_test1_basekey,\n\t\t      0x1d, 0xc4, 0x6a, 0x8d, 0x76, 0x3f, 0x4f, 0x93,\n\t\t      0x74, 0x2b, 0xcb, 0xa3, 0x38, 0x75, 0x76, 0xc3\n);\nDEFINE_HEX_XDR_NETOBJ(rfc6803_enc_test1_expected_result,\n\t\t      0xc4, 0x66, 0xf1, 0x87, 0x10, 0x69, 0x92, 0x1e,\n\t\t      0xdb, 0x7c, 0x6f, 0xde, 0x24, 0x4a, 0x52, 0xdb,\n\t\t      0x0b, 0xa1, 0x0e, 0xdc, 0x19, 0x7b, 0xdb, 0x80,\n\t\t      0x06, 0x65, 0x8c, 0xa3, 0xcc, 0xce, 0x6e, 0xb8\n);\n\nDEFINE_HEX_XDR_NETOBJ(rfc6803_enc_test2_confounder,\n\t\t      0x6f, 0x2f, 0xc3, 0xc2, 0xa1, 0x66, 0xfd, 0x88,\n\t\t      0x98, 0x96, 0x7a, 0x83, 0xde, 0x95, 0x96, 0xd9\n);\nDEFINE_HEX_XDR_NETOBJ(rfc6803_enc_test2_basekey,\n\t\t      0x50, 0x27, 0xbc, 0x23, 0x1d, 0x0f, 0x3a, 0x9d,\n\t\t      0x23, 0x33, 0x3f, 0x1c, 0xa6, 0xfd, 0xbe, 0x7c\n);\nDEFINE_HEX_XDR_NETOBJ(rfc6803_enc_test2_expected_result,\n\t\t      0x84, 0x2d, 0x21, 0xfd, 0x95, 0x03, 0x11, 0xc0,\n\t\t      0xdd, 0x46, 0x4a, 0x3f, 0x4b, 0xe8, 0xd6, 0xda,\n\t\t      0x88, 0xa5, 0x6d, 0x55, 0x9c, 0x9b, 0x47, 0xd3,\n\t\t      0xf9, 0xa8, 0x50, 0x67, 0xaf, 0x66, 0x15, 0x59,\n\t\t      0xb8\n);\n\nDEFINE_HEX_XDR_NETOBJ(rfc6803_enc_test3_confounder,\n\t\t      0xa5, 0xb4, 0xa7, 0x1e, 0x07, 0x7a, 0xee, 0xf9,\n\t\t      0x3c, 0x87, 0x63, 0xc1, 0x8f, 0xdb, 0x1f, 0x10\n);\nDEFINE_HEX_XDR_NETOBJ(rfc6803_enc_test3_basekey,\n\t\t      0xa1, 0xbb, 0x61, 0xe8, 0x05, 0xf9, 0xba, 0x6d,\n\t\t      0xde, 0x8f, 0xdb, 0xdd, 0xc0, 0x5c, 0xde, 0xa0\n);\nDEFINE_HEX_XDR_NETOBJ(rfc6803_enc_test3_expected_result,\n\t\t      0x61, 0x9f, 0xf0, 0x72, 0xe3, 0x62, 0x86, 0xff,\n\t\t      0x0a, 0x28, 0xde, 0xb3, 0xa3, 0x52, 0xec, 0x0d,\n\t\t      0x0e, 0xdf, 0x5c, 0x51, 0x60, 0xd6, 0x63, 0xc9,\n\t\t      0x01, 0x75, 0x8c, 0xcf, 0x9d, 0x1e, 0xd3, 0x3d,\n\t\t      0x71, 0xdb, 0x8f, 0x23, 0xaa, 0xbf, 0x83, 0x48,\n\t\t      0xa0\n);\n\nDEFINE_HEX_XDR_NETOBJ(rfc6803_enc_test4_confounder,\n\t\t      0x19, 0xfe, 0xe4, 0x0d, 0x81, 0x0c, 0x52, 0x4b,\n\t\t      0x5b, 0x22, 0xf0, 0x18, 0x74, 0xc6, 0x93, 0xda\n);\nDEFINE_HEX_XDR_NETOBJ(rfc6803_enc_test4_basekey,\n\t\t      0x2c, 0xa2, 0x7a, 0x5f, 0xaf, 0x55, 0x32, 0x24,\n\t\t      0x45, 0x06, 0x43, 0x4e, 0x1c, 0xef, 0x66, 0x76\n);\nDEFINE_HEX_XDR_NETOBJ(rfc6803_enc_test4_expected_result,\n\t\t      0xb8, 0xec, 0xa3, 0x16, 0x7a, 0xe6, 0x31, 0x55,\n\t\t      0x12, 0xe5, 0x9f, 0x98, 0xa7, 0xc5, 0x00, 0x20,\n\t\t      0x5e, 0x5f, 0x63, 0xff, 0x3b, 0xb3, 0x89, 0xaf,\n\t\t      0x1c, 0x41, 0xa2, 0x1d, 0x64, 0x0d, 0x86, 0x15,\n\t\t      0xc9, 0xed, 0x3f, 0xbe, 0xb0, 0x5a, 0xb6, 0xac,\n\t\t      0xb6, 0x76, 0x89, 0xb5, 0xea\n);\n\nDEFINE_HEX_XDR_NETOBJ(rfc6803_enc_test5_confounder,\n\t\t      0xca, 0x7a, 0x7a, 0xb4, 0xbe, 0x19, 0x2d, 0xab,\n\t\t      0xd6, 0x03, 0x50, 0x6d, 0xb1, 0x9c, 0x39, 0xe2\n);\nDEFINE_HEX_XDR_NETOBJ(rfc6803_enc_test5_basekey,\n\t\t      0x78, 0x24, 0xf8, 0xc1, 0x6f, 0x83, 0xff, 0x35,\n\t\t      0x4c, 0x6b, 0xf7, 0x51, 0x5b, 0x97, 0x3f, 0x43\n);\nDEFINE_HEX_XDR_NETOBJ(rfc6803_enc_test5_expected_result,\n\t\t      0xa2, 0x6a, 0x39, 0x05, 0xa4, 0xff, 0xd5, 0x81,\n\t\t      0x6b, 0x7b, 0x1e, 0x27, 0x38, 0x0d, 0x08, 0x09,\n\t\t      0x0c, 0x8e, 0xc1, 0xf3, 0x04, 0x49, 0x6e, 0x1a,\n\t\t      0xbd, 0xcd, 0x2b, 0xdc, 0xd1, 0xdf, 0xfc, 0x66,\n\t\t      0x09, 0x89, 0xe1, 0x17, 0xa7, 0x13, 0xdd, 0xbb,\n\t\t      0x57, 0xa4, 0x14, 0x6c, 0x15, 0x87, 0xcb, 0xa4,\n\t\t      0x35, 0x66, 0x65, 0x59, 0x1d, 0x22, 0x40, 0x28,\n\t\t      0x2f, 0x58, 0x42, 0xb1, 0x05, 0xa5\n);\n\nDEFINE_HEX_XDR_NETOBJ(rfc6803_enc_test6_confounder,\n\t\t      0x3c, 0xbb, 0xd2, 0xb4, 0x59, 0x17, 0x94, 0x10,\n\t\t      0x67, 0xf9, 0x65, 0x99, 0xbb, 0x98, 0x92, 0x6c\n);\nDEFINE_HEX_XDR_NETOBJ(rfc6803_enc_test6_basekey,\n\t\t      0xb6, 0x1c, 0x86, 0xcc, 0x4e, 0x5d, 0x27, 0x57,\n\t\t      0x54, 0x5a, 0xd4, 0x23, 0x39, 0x9f, 0xb7, 0x03,\n\t\t      0x1e, 0xca, 0xb9, 0x13, 0xcb, 0xb9, 0x00, 0xbd,\n\t\t      0x7a, 0x3c, 0x6d, 0xd8, 0xbf, 0x92, 0x01, 0x5b\n);\nDEFINE_HEX_XDR_NETOBJ(rfc6803_enc_test6_expected_result,\n\t\t      0x03, 0x88, 0x6d, 0x03, 0x31, 0x0b, 0x47, 0xa6,\n\t\t      0xd8, 0xf0, 0x6d, 0x7b, 0x94, 0xd1, 0xdd, 0x83,\n\t\t      0x7e, 0xcc, 0xe3, 0x15, 0xef, 0x65, 0x2a, 0xff,\n\t\t      0x62, 0x08, 0x59, 0xd9, 0x4a, 0x25, 0x92, 0x66\n);\n\nDEFINE_HEX_XDR_NETOBJ(rfc6803_enc_test7_confounder,\n\t\t      0xde, 0xf4, 0x87, 0xfc, 0xeb, 0xe6, 0xde, 0x63,\n\t\t      0x46, 0xd4, 0xda, 0x45, 0x21, 0xbb, 0xa2, 0xd2\n);\nDEFINE_HEX_XDR_NETOBJ(rfc6803_enc_test7_basekey,\n\t\t      0x1b, 0x97, 0xfe, 0x0a, 0x19, 0x0e, 0x20, 0x21,\n\t\t      0xeb, 0x30, 0x75, 0x3e, 0x1b, 0x6e, 0x1e, 0x77,\n\t\t      0xb0, 0x75, 0x4b, 0x1d, 0x68, 0x46, 0x10, 0x35,\n\t\t      0x58, 0x64, 0x10, 0x49, 0x63, 0x46, 0x38, 0x33\n);\nDEFINE_HEX_XDR_NETOBJ(rfc6803_enc_test7_expected_result,\n\t\t      0x2c, 0x9c, 0x15, 0x70, 0x13, 0x3c, 0x99, 0xbf,\n\t\t      0x6a, 0x34, 0xbc, 0x1b, 0x02, 0x12, 0x00, 0x2f,\n\t\t      0xd1, 0x94, 0x33, 0x87, 0x49, 0xdb, 0x41, 0x35,\n\t\t      0x49, 0x7a, 0x34, 0x7c, 0xfc, 0xd9, 0xd1, 0x8a,\n\t\t      0x12\n);\n\nDEFINE_HEX_XDR_NETOBJ(rfc6803_enc_test8_confounder,\n\t\t      0xad, 0x4f, 0xf9, 0x04, 0xd3, 0x4e, 0x55, 0x53,\n\t\t      0x84, 0xb1, 0x41, 0x00, 0xfc, 0x46, 0x5f, 0x88\n);\nDEFINE_HEX_XDR_NETOBJ(rfc6803_enc_test8_basekey,\n\t\t      0x32, 0x16, 0x4c, 0x5b, 0x43, 0x4d, 0x1d, 0x15,\n\t\t      0x38, 0xe4, 0xcf, 0xd9, 0xbe, 0x80, 0x40, 0xfe,\n\t\t      0x8c, 0x4a, 0xc7, 0xac, 0xc4, 0xb9, 0x3d, 0x33,\n\t\t      0x14, 0xd2, 0x13, 0x36, 0x68, 0x14, 0x7a, 0x05\n);\nDEFINE_HEX_XDR_NETOBJ(rfc6803_enc_test8_expected_result,\n\t\t      0x9c, 0x6d, 0xe7, 0x5f, 0x81, 0x2d, 0xe7, 0xed,\n\t\t      0x0d, 0x28, 0xb2, 0x96, 0x35, 0x57, 0xa1, 0x15,\n\t\t      0x64, 0x09, 0x98, 0x27, 0x5b, 0x0a, 0xf5, 0x15,\n\t\t      0x27, 0x09, 0x91, 0x3f, 0xf5, 0x2a, 0x2a, 0x9c,\n\t\t      0x8e, 0x63, 0xb8, 0x72, 0xf9, 0x2e, 0x64, 0xc8,\n\t\t      0x39\n);\n\nDEFINE_HEX_XDR_NETOBJ(rfc6803_enc_test9_confounder,\n\t\t      0xcf, 0x9b, 0xca, 0x6d, 0xf1, 0x14, 0x4e, 0x0c,\n\t\t      0x0a, 0xf9, 0xb8, 0xf3, 0x4c, 0x90, 0xd5, 0x14\n);\nDEFINE_HEX_XDR_NETOBJ(rfc6803_enc_test9_basekey,\n\t\t      0xb0, 0x38, 0xb1, 0x32, 0xcd, 0x8e, 0x06, 0x61,\n\t\t      0x22, 0x67, 0xfa, 0xb7, 0x17, 0x00, 0x66, 0xd8,\n\t\t      0x8a, 0xec, 0xcb, 0xa0, 0xb7, 0x44, 0xbf, 0xc6,\n\t\t      0x0d, 0xc8, 0x9b, 0xca, 0x18, 0x2d, 0x07, 0x15\n);\nDEFINE_HEX_XDR_NETOBJ(rfc6803_enc_test9_expected_result,\n\t\t      0xee, 0xec, 0x85, 0xa9, 0x81, 0x3c, 0xdc, 0x53,\n\t\t      0x67, 0x72, 0xab, 0x9b, 0x42, 0xde, 0xfc, 0x57,\n\t\t      0x06, 0xf7, 0x26, 0xe9, 0x75, 0xdd, 0xe0, 0x5a,\n\t\t      0x87, 0xeb, 0x54, 0x06, 0xea, 0x32, 0x4c, 0xa1,\n\t\t      0x85, 0xc9, 0x98, 0x6b, 0x42, 0xaa, 0xbe, 0x79,\n\t\t      0x4b, 0x84, 0x82, 0x1b, 0xee\n);\n\nDEFINE_HEX_XDR_NETOBJ(rfc6803_enc_test10_confounder,\n\t\t      0x64, 0x4d, 0xef, 0x38, 0xda, 0x35, 0x00, 0x72,\n\t\t      0x75, 0x87, 0x8d, 0x21, 0x68, 0x55, 0xe2, 0x28\n);\nDEFINE_HEX_XDR_NETOBJ(rfc6803_enc_test10_basekey,\n\t\t      0xcc, 0xfc, 0xd3, 0x49, 0xbf, 0x4c, 0x66, 0x77,\n\t\t      0xe8, 0x6e, 0x4b, 0x02, 0xb8, 0xea, 0xb9, 0x24,\n\t\t      0xa5, 0x46, 0xac, 0x73, 0x1c, 0xf9, 0xbf, 0x69,\n\t\t      0x89, 0xb9, 0x96, 0xe7, 0xd6, 0xbf, 0xbb, 0xa7\n);\nDEFINE_HEX_XDR_NETOBJ(rfc6803_enc_test10_expected_result,\n\t\t      0x0e, 0x44, 0x68, 0x09, 0x85, 0x85, 0x5f, 0x2d,\n\t\t      0x1f, 0x18, 0x12, 0x52, 0x9c, 0xa8, 0x3b, 0xfd,\n\t\t      0x8e, 0x34, 0x9d, 0xe6, 0xfd, 0x9a, 0xda, 0x0b,\n\t\t      0xaa, 0xa0, 0x48, 0xd6, 0x8e, 0x26, 0x5f, 0xeb,\n\t\t      0xf3, 0x4a, 0xd1, 0x25, 0x5a, 0x34, 0x49, 0x99,\n\t\t      0xad, 0x37, 0x14, 0x68, 0x87, 0xa6, 0xc6, 0x84,\n\t\t      0x57, 0x31, 0xac, 0x7f, 0x46, 0x37, 0x6a, 0x05,\n\t\t      0x04, 0xcd, 0x06, 0x57, 0x14, 0x74\n);\n\nstatic const struct gss_krb5_test_param rfc6803_encrypt_test_params[] = {\n\t{\n\t\t.desc\t\t\t= \"Encrypt empty plaintext with camellia128-cts-cmac\",\n\t\t.enctype\t\t= ENCTYPE_CAMELLIA128_CTS_CMAC,\n\t\t.constant\t\t= 0,\n\t\t.base_key\t\t= &rfc6803_enc_test1_basekey,\n\t\t.plaintext\t\t= &rfc6803_enc_empty_plaintext,\n\t\t.confounder\t\t= &rfc6803_enc_test1_confounder,\n\t\t.expected_result\t= &rfc6803_enc_test1_expected_result,\n\t},\n\t{\n\t\t.desc\t\t\t= \"Encrypt 1 byte with camellia128-cts-cmac\",\n\t\t.enctype\t\t= ENCTYPE_CAMELLIA128_CTS_CMAC,\n\t\t.constant\t\t= 1,\n\t\t.base_key\t\t= &rfc6803_enc_test2_basekey,\n\t\t.plaintext\t\t= &rfc6803_enc_1byte_plaintext,\n\t\t.confounder\t\t= &rfc6803_enc_test2_confounder,\n\t\t.expected_result\t= &rfc6803_enc_test2_expected_result,\n\t},\n\t{\n\t\t.desc\t\t\t= \"Encrypt 9 bytes with camellia128-cts-cmac\",\n\t\t.enctype\t\t= ENCTYPE_CAMELLIA128_CTS_CMAC,\n\t\t.constant\t\t= 2,\n\t\t.base_key\t\t= &rfc6803_enc_test3_basekey,\n\t\t.plaintext\t\t= &rfc6803_enc_9byte_plaintext,\n\t\t.confounder\t\t= &rfc6803_enc_test3_confounder,\n\t\t.expected_result\t= &rfc6803_enc_test3_expected_result,\n\t},\n\t{\n\t\t.desc\t\t\t= \"Encrypt 13 bytes with camellia128-cts-cmac\",\n\t\t.enctype\t\t= ENCTYPE_CAMELLIA128_CTS_CMAC,\n\t\t.constant\t\t= 3,\n\t\t.base_key\t\t= &rfc6803_enc_test4_basekey,\n\t\t.plaintext\t\t= &rfc6803_enc_13byte_plaintext,\n\t\t.confounder\t\t= &rfc6803_enc_test4_confounder,\n\t\t.expected_result\t= &rfc6803_enc_test4_expected_result,\n\t},\n\t{\n\t\t.desc\t\t\t= \"Encrypt 30 bytes with camellia128-cts-cmac\",\n\t\t.enctype\t\t= ENCTYPE_CAMELLIA128_CTS_CMAC,\n\t\t.constant\t\t= 4,\n\t\t.base_key\t\t= &rfc6803_enc_test5_basekey,\n\t\t.plaintext\t\t= &rfc6803_enc_30byte_plaintext,\n\t\t.confounder\t\t= &rfc6803_enc_test5_confounder,\n\t\t.expected_result\t= &rfc6803_enc_test5_expected_result,\n\t},\n\t{\n\t\t.desc\t\t\t= \"Encrypt empty plaintext with camellia256-cts-cmac\",\n\t\t.enctype\t\t= ENCTYPE_CAMELLIA256_CTS_CMAC,\n\t\t.constant\t\t= 0,\n\t\t.base_key\t\t= &rfc6803_enc_test6_basekey,\n\t\t.plaintext\t\t= &rfc6803_enc_empty_plaintext,\n\t\t.confounder\t\t= &rfc6803_enc_test6_confounder,\n\t\t.expected_result\t= &rfc6803_enc_test6_expected_result,\n\t},\n\t{\n\t\t.desc\t\t\t= \"Encrypt 1 byte with camellia256-cts-cmac\",\n\t\t.enctype\t\t= ENCTYPE_CAMELLIA256_CTS_CMAC,\n\t\t.constant\t\t= 1,\n\t\t.base_key\t\t= &rfc6803_enc_test7_basekey,\n\t\t.plaintext\t\t= &rfc6803_enc_1byte_plaintext,\n\t\t.confounder\t\t= &rfc6803_enc_test7_confounder,\n\t\t.expected_result\t= &rfc6803_enc_test7_expected_result,\n\t},\n\t{\n\t\t.desc\t\t\t= \"Encrypt 9 bytes with camellia256-cts-cmac\",\n\t\t.enctype\t\t= ENCTYPE_CAMELLIA256_CTS_CMAC,\n\t\t.constant\t\t= 2,\n\t\t.base_key\t\t= &rfc6803_enc_test8_basekey,\n\t\t.plaintext\t\t= &rfc6803_enc_9byte_plaintext,\n\t\t.confounder\t\t= &rfc6803_enc_test8_confounder,\n\t\t.expected_result\t= &rfc6803_enc_test8_expected_result,\n\t},\n\t{\n\t\t.desc\t\t\t= \"Encrypt 13 bytes with camellia256-cts-cmac\",\n\t\t.enctype\t\t= ENCTYPE_CAMELLIA256_CTS_CMAC,\n\t\t.constant\t\t= 3,\n\t\t.base_key\t\t= &rfc6803_enc_test9_basekey,\n\t\t.plaintext\t\t= &rfc6803_enc_13byte_plaintext,\n\t\t.confounder\t\t= &rfc6803_enc_test9_confounder,\n\t\t.expected_result\t= &rfc6803_enc_test9_expected_result,\n\t},\n\t{\n\t\t.desc\t\t\t= \"Encrypt 30 bytes with camellia256-cts-cmac\",\n\t\t.enctype\t\t= ENCTYPE_CAMELLIA256_CTS_CMAC,\n\t\t.constant\t\t= 4,\n\t\t.base_key\t\t= &rfc6803_enc_test10_basekey,\n\t\t.plaintext\t\t= &rfc6803_enc_30byte_plaintext,\n\t\t.confounder\t\t= &rfc6803_enc_test10_confounder,\n\t\t.expected_result\t= &rfc6803_enc_test10_expected_result,\n\t},\n};\n\n \nKUNIT_ARRAY_PARAM(rfc6803_encrypt, rfc6803_encrypt_test_params,\n\t\t  gss_krb5_get_desc);\n\nstatic void rfc6803_encrypt_case(struct kunit *test)\n{\n\tconst struct gss_krb5_test_param *param = test->param_value;\n\tstruct crypto_sync_skcipher *cts_tfm, *cbc_tfm;\n\tconst struct gss_krb5_enctype *gk5e;\n\tstruct xdr_netobj Ke, Ki, checksum;\n\tu8 usage_data[GSS_KRB5_K5CLENGTH];\n\tstruct xdr_netobj usage = {\n\t\t.data = usage_data,\n\t\t.len = sizeof(usage_data),\n\t};\n\tstruct crypto_ahash *ahash_tfm;\n\tunsigned int blocksize;\n\tstruct xdr_buf buf;\n\tvoid *text;\n\tsize_t len;\n\tu32 err;\n\n\t \n\tgk5e = gss_krb5_lookup_enctype(param->enctype);\n\tif (!gk5e)\n\t\tkunit_skip(test, \"Encryption type is not available\");\n\n\tmemset(usage_data, 0, sizeof(usage_data));\n\tusage.data[3] = param->constant;\n\n\tKe.len = gk5e->Ke_length;\n\tKe.data = kunit_kzalloc(test, Ke.len, GFP_KERNEL);\n\tKUNIT_ASSERT_NOT_ERR_OR_NULL(test, Ke.data);\n\tusage.data[4] = KEY_USAGE_SEED_ENCRYPTION;\n\terr = gk5e->derive_key(gk5e, param->base_key, &Ke, &usage, GFP_KERNEL);\n\tKUNIT_ASSERT_EQ(test, err, 0);\n\n\tcbc_tfm = crypto_alloc_sync_skcipher(gk5e->aux_cipher, 0, 0);\n\tKUNIT_ASSERT_NOT_ERR_OR_NULL(test, cbc_tfm);\n\terr = crypto_sync_skcipher_setkey(cbc_tfm, Ke.data, Ke.len);\n\tKUNIT_ASSERT_EQ(test, err, 0);\n\n\tcts_tfm = crypto_alloc_sync_skcipher(gk5e->encrypt_name, 0, 0);\n\tKUNIT_ASSERT_NOT_ERR_OR_NULL(test, cts_tfm);\n\terr = crypto_sync_skcipher_setkey(cts_tfm, Ke.data, Ke.len);\n\tKUNIT_ASSERT_EQ(test, err, 0);\n\tblocksize = crypto_sync_skcipher_blocksize(cts_tfm);\n\n\tlen = param->confounder->len + param->plaintext->len + blocksize;\n\ttext = kunit_kzalloc(test, len, GFP_KERNEL);\n\tKUNIT_ASSERT_NOT_ERR_OR_NULL(test, text);\n\tmemcpy(text, param->confounder->data, param->confounder->len);\n\tmemcpy(text + param->confounder->len, param->plaintext->data,\n\t       param->plaintext->len);\n\n\tmemset(&buf, 0, sizeof(buf));\n\tbuf.head[0].iov_base = text;\n\tbuf.head[0].iov_len = param->confounder->len + param->plaintext->len;\n\tbuf.len = buf.head[0].iov_len;\n\n\tchecksum.len = gk5e->cksumlength;\n\tchecksum.data = kunit_kzalloc(test, checksum.len, GFP_KERNEL);\n\tKUNIT_ASSERT_NOT_ERR_OR_NULL(test, checksum.data);\n\n\tKi.len = gk5e->Ki_length;\n\tKi.data = kunit_kzalloc(test, Ki.len, GFP_KERNEL);\n\tKUNIT_ASSERT_NOT_ERR_OR_NULL(test, Ki.data);\n\tusage.data[4] = KEY_USAGE_SEED_INTEGRITY;\n\terr = gk5e->derive_key(gk5e, param->base_key, &Ki,\n\t\t\t       &usage, GFP_KERNEL);\n\tKUNIT_ASSERT_EQ(test, err, 0);\n\tahash_tfm = crypto_alloc_ahash(gk5e->cksum_name, 0, CRYPTO_ALG_ASYNC);\n\tKUNIT_ASSERT_NOT_ERR_OR_NULL(test, ahash_tfm);\n\terr = crypto_ahash_setkey(ahash_tfm, Ki.data, Ki.len);\n\tKUNIT_ASSERT_EQ(test, err, 0);\n\n\t \n\terr = gss_krb5_checksum(ahash_tfm, NULL, 0, &buf, 0, &checksum);\n\tKUNIT_ASSERT_EQ(test, err, 0);\n\n\terr = krb5_cbc_cts_encrypt(cts_tfm, cbc_tfm, 0, &buf, NULL, NULL, 0);\n\tKUNIT_ASSERT_EQ(test, err, 0);\n\n\t \n\tKUNIT_EXPECT_EQ_MSG(test, param->expected_result->len,\n\t\t\t    buf.len + checksum.len,\n\t\t\t    \"ciphertext length mismatch\");\n\tKUNIT_EXPECT_EQ_MSG(test,\n\t\t\t    memcmp(param->expected_result->data,\n\t\t\t\t   buf.head[0].iov_base, buf.len), 0,\n\t\t\t    \"encrypted result mismatch\");\n\tKUNIT_EXPECT_EQ_MSG(test,\n\t\t\t    memcmp(param->expected_result->data +\n\t\t\t\t   (param->expected_result->len - checksum.len),\n\t\t\t\t   checksum.data, checksum.len), 0,\n\t\t\t    \"HMAC mismatch\");\n\n\tcrypto_free_ahash(ahash_tfm);\n\tcrypto_free_sync_skcipher(cts_tfm);\n\tcrypto_free_sync_skcipher(cbc_tfm);\n}\n\nstatic struct kunit_case rfc6803_test_cases[] = {\n\t{\n\t\t.name\t\t\t= \"RFC 6803 key derivation\",\n\t\t.run_case\t\t= kdf_case,\n\t\t.generate_params\t= rfc6803_kdf_gen_params,\n\t},\n\t{\n\t\t.name\t\t\t= \"RFC 6803 checksum\",\n\t\t.run_case\t\t= checksum_case,\n\t\t.generate_params\t= rfc6803_checksum_gen_params,\n\t},\n\t{\n\t\t.name\t\t\t= \"RFC 6803 encryption\",\n\t\t.run_case\t\t= rfc6803_encrypt_case,\n\t\t.generate_params\t= rfc6803_encrypt_gen_params,\n\t},\n\t{}\n};\n\nstatic struct kunit_suite rfc6803_suite = {\n\t.name\t\t\t= \"RFC 6803 suite\",\n\t.test_cases\t\t= rfc6803_test_cases,\n};\n\n \n\nDEFINE_HEX_XDR_NETOBJ(aes128_cts_hmac_sha256_128_basekey,\n\t\t      0x37, 0x05, 0xd9, 0x60, 0x80, 0xc1, 0x77, 0x28,\n\t\t      0xa0, 0xe8, 0x00, 0xea, 0xb6, 0xe0, 0xd2, 0x3c\n);\nDEFINE_HEX_XDR_NETOBJ(aes128_cts_hmac_sha256_128_Kc,\n\t\t      0xb3, 0x1a, 0x01, 0x8a, 0x48, 0xf5, 0x47, 0x76,\n\t\t      0xf4, 0x03, 0xe9, 0xa3, 0x96, 0x32, 0x5d, 0xc3\n);\nDEFINE_HEX_XDR_NETOBJ(aes128_cts_hmac_sha256_128_Ke,\n\t\t      0x9b, 0x19, 0x7d, 0xd1, 0xe8, 0xc5, 0x60, 0x9d,\n\t\t      0x6e, 0x67, 0xc3, 0xe3, 0x7c, 0x62, 0xc7, 0x2e\n);\nDEFINE_HEX_XDR_NETOBJ(aes128_cts_hmac_sha256_128_Ki,\n\t\t      0x9f, 0xda, 0x0e, 0x56, 0xab, 0x2d, 0x85, 0xe1,\n\t\t      0x56, 0x9a, 0x68, 0x86, 0x96, 0xc2, 0x6a, 0x6c\n);\n\nDEFINE_HEX_XDR_NETOBJ(aes256_cts_hmac_sha384_192_basekey,\n\t\t      0x6d, 0x40, 0x4d, 0x37, 0xfa, 0xf7, 0x9f, 0x9d,\n\t\t      0xf0, 0xd3, 0x35, 0x68, 0xd3, 0x20, 0x66, 0x98,\n\t\t      0x00, 0xeb, 0x48, 0x36, 0x47, 0x2e, 0xa8, 0xa0,\n\t\t      0x26, 0xd1, 0x6b, 0x71, 0x82, 0x46, 0x0c, 0x52\n);\nDEFINE_HEX_XDR_NETOBJ(aes256_cts_hmac_sha384_192_Kc,\n\t\t      0xef, 0x57, 0x18, 0xbe, 0x86, 0xcc, 0x84, 0x96,\n\t\t      0x3d, 0x8b, 0xbb, 0x50, 0x31, 0xe9, 0xf5, 0xc4,\n\t\t      0xba, 0x41, 0xf2, 0x8f, 0xaf, 0x69, 0xe7, 0x3d\n);\nDEFINE_HEX_XDR_NETOBJ(aes256_cts_hmac_sha384_192_Ke,\n\t\t      0x56, 0xab, 0x22, 0xbe, 0xe6, 0x3d, 0x82, 0xd7,\n\t\t      0xbc, 0x52, 0x27, 0xf6, 0x77, 0x3f, 0x8e, 0xa7,\n\t\t      0xa5, 0xeb, 0x1c, 0x82, 0x51, 0x60, 0xc3, 0x83,\n\t\t      0x12, 0x98, 0x0c, 0x44, 0x2e, 0x5c, 0x7e, 0x49\n);\nDEFINE_HEX_XDR_NETOBJ(aes256_cts_hmac_sha384_192_Ki,\n\t\t      0x69, 0xb1, 0x65, 0x14, 0xe3, 0xcd, 0x8e, 0x56,\n\t\t      0xb8, 0x20, 0x10, 0xd5, 0xc7, 0x30, 0x12, 0xb6,\n\t\t      0x22, 0xc4, 0xd0, 0x0f, 0xfc, 0x23, 0xed, 0x1f\n);\n\nstatic const struct gss_krb5_test_param rfc8009_kdf_test_params[] = {\n\t{\n\t\t.desc\t\t\t= \"Derive Kc subkey for aes128-cts-hmac-sha256-128\",\n\t\t.enctype\t\t= ENCTYPE_AES128_CTS_HMAC_SHA256_128,\n\t\t.base_key\t\t= &aes128_cts_hmac_sha256_128_basekey,\n\t\t.usage\t\t\t= &usage_checksum,\n\t\t.expected_result\t= &aes128_cts_hmac_sha256_128_Kc,\n\t},\n\t{\n\t\t.desc\t\t\t= \"Derive Ke subkey for aes128-cts-hmac-sha256-128\",\n\t\t.enctype\t\t= ENCTYPE_AES128_CTS_HMAC_SHA256_128,\n\t\t.base_key\t\t= &aes128_cts_hmac_sha256_128_basekey,\n\t\t.usage\t\t\t= &usage_encryption,\n\t\t.expected_result\t= &aes128_cts_hmac_sha256_128_Ke,\n\t},\n\t{\n\t\t.desc\t\t\t= \"Derive Ki subkey for aes128-cts-hmac-sha256-128\",\n\t\t.enctype\t\t= ENCTYPE_AES128_CTS_HMAC_SHA256_128,\n\t\t.base_key\t\t= &aes128_cts_hmac_sha256_128_basekey,\n\t\t.usage\t\t\t= &usage_integrity,\n\t\t.expected_result\t= &aes128_cts_hmac_sha256_128_Ki,\n\t},\n\t{\n\t\t.desc\t\t\t= \"Derive Kc subkey for aes256-cts-hmac-sha384-192\",\n\t\t.enctype\t\t= ENCTYPE_AES256_CTS_HMAC_SHA384_192,\n\t\t.base_key\t\t= &aes256_cts_hmac_sha384_192_basekey,\n\t\t.usage\t\t\t= &usage_checksum,\n\t\t.expected_result\t= &aes256_cts_hmac_sha384_192_Kc,\n\t},\n\t{\n\t\t.desc\t\t\t= \"Derive Ke subkey for aes256-cts-hmac-sha384-192\",\n\t\t.enctype\t\t= ENCTYPE_AES256_CTS_HMAC_SHA384_192,\n\t\t.base_key\t\t= &aes256_cts_hmac_sha384_192_basekey,\n\t\t.usage\t\t\t= &usage_encryption,\n\t\t.expected_result\t= &aes256_cts_hmac_sha384_192_Ke,\n\t},\n\t{\n\t\t.desc\t\t\t= \"Derive Ki subkey for aes256-cts-hmac-sha384-192\",\n\t\t.enctype\t\t= ENCTYPE_AES256_CTS_HMAC_SHA384_192,\n\t\t.base_key\t\t= &aes256_cts_hmac_sha384_192_basekey,\n\t\t.usage\t\t\t= &usage_integrity,\n\t\t.expected_result\t= &aes256_cts_hmac_sha384_192_Ki,\n\t},\n};\n\n \nKUNIT_ARRAY_PARAM(rfc8009_kdf, rfc8009_kdf_test_params, gss_krb5_get_desc);\n\n \n\nDEFINE_HEX_XDR_NETOBJ(rfc8009_checksum_plaintext,\n\t\t      0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07,\n\t\t      0x08, 0x09, 0x0a, 0x0b, 0x0c, 0x0d, 0x0e, 0x0f,\n\t\t      0x10, 0x11, 0x12, 0x13, 0x14\n);\nDEFINE_HEX_XDR_NETOBJ(rfc8009_checksum_test1_expected_result,\n\t\t      0xd7, 0x83, 0x67, 0x18, 0x66, 0x43, 0xd6, 0x7b,\n\t\t      0x41, 0x1c, 0xba, 0x91, 0x39, 0xfc, 0x1d, 0xee\n);\nDEFINE_HEX_XDR_NETOBJ(rfc8009_checksum_test2_expected_result,\n\t\t      0x45, 0xee, 0x79, 0x15, 0x67, 0xee, 0xfc, 0xa3,\n\t\t      0x7f, 0x4a, 0xc1, 0xe0, 0x22, 0x2d, 0xe8, 0x0d,\n\t\t      0x43, 0xc3, 0xbf, 0xa0, 0x66, 0x99, 0x67, 0x2a\n);\n\nstatic const struct gss_krb5_test_param rfc8009_checksum_test_params[] = {\n\t{\n\t\t.desc\t\t\t= \"Checksum with aes128-cts-hmac-sha256-128\",\n\t\t.enctype\t\t= ENCTYPE_AES128_CTS_HMAC_SHA256_128,\n\t\t.base_key\t\t= &aes128_cts_hmac_sha256_128_basekey,\n\t\t.usage\t\t\t= &usage_checksum,\n\t\t.plaintext\t\t= &rfc8009_checksum_plaintext,\n\t\t.expected_result\t= &rfc8009_checksum_test1_expected_result,\n\t},\n\t{\n\t\t.desc\t\t\t= \"Checksum with aes256-cts-hmac-sha384-192\",\n\t\t.enctype\t\t= ENCTYPE_AES256_CTS_HMAC_SHA384_192,\n\t\t.base_key\t\t= &aes256_cts_hmac_sha384_192_basekey,\n\t\t.usage\t\t\t= &usage_checksum,\n\t\t.plaintext\t\t= &rfc8009_checksum_plaintext,\n\t\t.expected_result\t= &rfc8009_checksum_test2_expected_result,\n\t},\n};\n\n \nKUNIT_ARRAY_PARAM(rfc8009_checksum, rfc8009_checksum_test_params,\n\t\t  gss_krb5_get_desc);\n\n \n\nstatic const struct xdr_netobj rfc8009_enc_empty_plaintext = {\n\t.len\t= 0,\n};\nDEFINE_HEX_XDR_NETOBJ(rfc8009_enc_short_plaintext,\n\t\t      0x00, 0x01, 0x02, 0x03, 0x04, 0x05\n);\nDEFINE_HEX_XDR_NETOBJ(rfc8009_enc_block_plaintext,\n\t\t      0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07,\n\t\t      0x08, 0x09, 0x0a, 0x0b, 0x0c, 0x0d, 0x0e, 0x0f\n);\nDEFINE_HEX_XDR_NETOBJ(rfc8009_enc_long_plaintext,\n\t\t      0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07,\n\t\t      0x08, 0x09, 0x0a, 0x0b, 0x0c, 0x0d, 0x0e, 0x0f,\n\t\t      0x10, 0x11, 0x12, 0x13, 0x14\n);\n\nDEFINE_HEX_XDR_NETOBJ(rfc8009_enc_test1_confounder,\n\t\t      0x7e, 0x58, 0x95, 0xea, 0xf2, 0x67, 0x24, 0x35,\n\t\t      0xba, 0xd8, 0x17, 0xf5, 0x45, 0xa3, 0x71, 0x48\n);\nDEFINE_HEX_XDR_NETOBJ(rfc8009_enc_test1_expected_result,\n\t\t      0xef, 0x85, 0xfb, 0x89, 0x0b, 0xb8, 0x47, 0x2f,\n\t\t      0x4d, 0xab, 0x20, 0x39, 0x4d, 0xca, 0x78, 0x1d\n);\nDEFINE_HEX_XDR_NETOBJ(rfc8009_enc_test1_expected_hmac,\n\t\t      0xad, 0x87, 0x7e, 0xda, 0x39, 0xd5, 0x0c, 0x87,\n\t\t      0x0c, 0x0d, 0x5a, 0x0a, 0x8e, 0x48, 0xc7, 0x18\n);\n\nDEFINE_HEX_XDR_NETOBJ(rfc8009_enc_test2_confounder,\n\t\t      0x7b, 0xca, 0x28, 0x5e, 0x2f, 0xd4, 0x13, 0x0f,\n\t\t      0xb5, 0x5b, 0x1a, 0x5c, 0x83, 0xbc, 0x5b, 0x24\n);\nDEFINE_HEX_XDR_NETOBJ(rfc8009_enc_test2_expected_result,\n\t\t      0x84, 0xd7, 0xf3, 0x07, 0x54, 0xed, 0x98, 0x7b,\n\t\t      0xab, 0x0b, 0xf3, 0x50, 0x6b, 0xeb, 0x09, 0xcf,\n\t\t      0xb5, 0x54, 0x02, 0xce, 0xf7, 0xe6\n);\nDEFINE_HEX_XDR_NETOBJ(rfc8009_enc_test2_expected_hmac,\n\t\t      0x87, 0x7c, 0xe9, 0x9e, 0x24, 0x7e, 0x52, 0xd1,\n\t\t      0x6e, 0xd4, 0x42, 0x1d, 0xfd, 0xf8, 0x97, 0x6c\n);\n\nDEFINE_HEX_XDR_NETOBJ(rfc8009_enc_test3_confounder,\n\t\t      0x56, 0xab, 0x21, 0x71, 0x3f, 0xf6, 0x2c, 0x0a,\n\t\t      0x14, 0x57, 0x20, 0x0f, 0x6f, 0xa9, 0x94, 0x8f\n);\nDEFINE_HEX_XDR_NETOBJ(rfc8009_enc_test3_expected_result,\n\t\t      0x35, 0x17, 0xd6, 0x40, 0xf5, 0x0d, 0xdc, 0x8a,\n\t\t      0xd3, 0x62, 0x87, 0x22, 0xb3, 0x56, 0x9d, 0x2a,\n\t\t      0xe0, 0x74, 0x93, 0xfa, 0x82, 0x63, 0x25, 0x40,\n\t\t      0x80, 0xea, 0x65, 0xc1, 0x00, 0x8e, 0x8f, 0xc2\n);\nDEFINE_HEX_XDR_NETOBJ(rfc8009_enc_test3_expected_hmac,\n\t\t      0x95, 0xfb, 0x48, 0x52, 0xe7, 0xd8, 0x3e, 0x1e,\n\t\t      0x7c, 0x48, 0xc3, 0x7e, 0xeb, 0xe6, 0xb0, 0xd3\n);\n\nDEFINE_HEX_XDR_NETOBJ(rfc8009_enc_test4_confounder,\n\t\t      0xa7, 0xa4, 0xe2, 0x9a, 0x47, 0x28, 0xce, 0x10,\n\t\t      0x66, 0x4f, 0xb6, 0x4e, 0x49, 0xad, 0x3f, 0xac\n);\nDEFINE_HEX_XDR_NETOBJ(rfc8009_enc_test4_expected_result,\n\t\t      0x72, 0x0f, 0x73, 0xb1, 0x8d, 0x98, 0x59, 0xcd,\n\t\t      0x6c, 0xcb, 0x43, 0x46, 0x11, 0x5c, 0xd3, 0x36,\n\t\t      0xc7, 0x0f, 0x58, 0xed, 0xc0, 0xc4, 0x43, 0x7c,\n\t\t      0x55, 0x73, 0x54, 0x4c, 0x31, 0xc8, 0x13, 0xbc,\n\t\t      0xe1, 0xe6, 0xd0, 0x72, 0xc1\n);\nDEFINE_HEX_XDR_NETOBJ(rfc8009_enc_test4_expected_hmac,\n\t\t      0x86, 0xb3, 0x9a, 0x41, 0x3c, 0x2f, 0x92, 0xca,\n\t\t      0x9b, 0x83, 0x34, 0xa2, 0x87, 0xff, 0xcb, 0xfc\n);\n\nDEFINE_HEX_XDR_NETOBJ(rfc8009_enc_test5_confounder,\n\t\t      0xf7, 0x64, 0xe9, 0xfa, 0x15, 0xc2, 0x76, 0x47,\n\t\t      0x8b, 0x2c, 0x7d, 0x0c, 0x4e, 0x5f, 0x58, 0xe4\n);\nDEFINE_HEX_XDR_NETOBJ(rfc8009_enc_test5_expected_result,\n\t\t      0x41, 0xf5, 0x3f, 0xa5, 0xbf, 0xe7, 0x02, 0x6d,\n\t\t      0x91, 0xfa, 0xf9, 0xbe, 0x95, 0x91, 0x95, 0xa0\n);\nDEFINE_HEX_XDR_NETOBJ(rfc8009_enc_test5_expected_hmac,\n\t\t      0x58, 0x70, 0x72, 0x73, 0xa9, 0x6a, 0x40, 0xf0,\n\t\t      0xa0, 0x19, 0x60, 0x62, 0x1a, 0xc6, 0x12, 0x74,\n\t\t      0x8b, 0x9b, 0xbf, 0xbe, 0x7e, 0xb4, 0xce, 0x3c\n);\n\nDEFINE_HEX_XDR_NETOBJ(rfc8009_enc_test6_confounder,\n\t\t      0xb8, 0x0d, 0x32, 0x51, 0xc1, 0xf6, 0x47, 0x14,\n\t\t      0x94, 0x25, 0x6f, 0xfe, 0x71, 0x2d, 0x0b, 0x9a\n);\nDEFINE_HEX_XDR_NETOBJ(rfc8009_enc_test6_expected_result,\n\t\t      0x4e, 0xd7, 0xb3, 0x7c, 0x2b, 0xca, 0xc8, 0xf7,\n\t\t      0x4f, 0x23, 0xc1, 0xcf, 0x07, 0xe6, 0x2b, 0xc7,\n\t\t      0xb7, 0x5f, 0xb3, 0xf6, 0x37, 0xb9\n);\nDEFINE_HEX_XDR_NETOBJ(rfc8009_enc_test6_expected_hmac,\n\t\t      0xf5, 0x59, 0xc7, 0xf6, 0x64, 0xf6, 0x9e, 0xab,\n\t\t      0x7b, 0x60, 0x92, 0x23, 0x75, 0x26, 0xea, 0x0d,\n\t\t      0x1f, 0x61, 0xcb, 0x20, 0xd6, 0x9d, 0x10, 0xf2\n);\n\nDEFINE_HEX_XDR_NETOBJ(rfc8009_enc_test7_confounder,\n\t\t      0x53, 0xbf, 0x8a, 0x0d, 0x10, 0x52, 0x65, 0xd4,\n\t\t      0xe2, 0x76, 0x42, 0x86, 0x24, 0xce, 0x5e, 0x63\n);\nDEFINE_HEX_XDR_NETOBJ(rfc8009_enc_test7_expected_result,\n\t\t      0xbc, 0x47, 0xff, 0xec, 0x79, 0x98, 0xeb, 0x91,\n\t\t      0xe8, 0x11, 0x5c, 0xf8, 0xd1, 0x9d, 0xac, 0x4b,\n\t\t      0xbb, 0xe2, 0xe1, 0x63, 0xe8, 0x7d, 0xd3, 0x7f,\n\t\t      0x49, 0xbe, 0xca, 0x92, 0x02, 0x77, 0x64, 0xf6\n);\nDEFINE_HEX_XDR_NETOBJ(rfc8009_enc_test7_expected_hmac,\n\t\t      0x8c, 0xf5, 0x1f, 0x14, 0xd7, 0x98, 0xc2, 0x27,\n\t\t      0x3f, 0x35, 0xdf, 0x57, 0x4d, 0x1f, 0x93, 0x2e,\n\t\t      0x40, 0xc4, 0xff, 0x25, 0x5b, 0x36, 0xa2, 0x66\n);\n\nDEFINE_HEX_XDR_NETOBJ(rfc8009_enc_test8_confounder,\n\t\t      0x76, 0x3e, 0x65, 0x36, 0x7e, 0x86, 0x4f, 0x02,\n\t\t      0xf5, 0x51, 0x53, 0xc7, 0xe3, 0xb5, 0x8a, 0xf1\n);\nDEFINE_HEX_XDR_NETOBJ(rfc8009_enc_test8_expected_result,\n\t\t      0x40, 0x01, 0x3e, 0x2d, 0xf5, 0x8e, 0x87, 0x51,\n\t\t      0x95, 0x7d, 0x28, 0x78, 0xbc, 0xd2, 0xd6, 0xfe,\n\t\t      0x10, 0x1c, 0xcf, 0xd5, 0x56, 0xcb, 0x1e, 0xae,\n\t\t      0x79, 0xdb, 0x3c, 0x3e, 0xe8, 0x64, 0x29, 0xf2,\n\t\t      0xb2, 0xa6, 0x02, 0xac, 0x86\n);\nDEFINE_HEX_XDR_NETOBJ(rfc8009_enc_test8_expected_hmac,\n\t\t      0xfe, 0xf6, 0xec, 0xb6, 0x47, 0xd6, 0x29, 0x5f,\n\t\t      0xae, 0x07, 0x7a, 0x1f, 0xeb, 0x51, 0x75, 0x08,\n\t\t      0xd2, 0xc1, 0x6b, 0x41, 0x92, 0xe0, 0x1f, 0x62\n);\n\nstatic const struct gss_krb5_test_param rfc8009_encrypt_test_params[] = {\n\t{\n\t\t.desc\t\t\t= \"Encrypt empty plaintext with aes128-cts-hmac-sha256-128\",\n\t\t.enctype\t\t= ENCTYPE_AES128_CTS_HMAC_SHA256_128,\n\t\t.plaintext\t\t= &rfc8009_enc_empty_plaintext,\n\t\t.confounder\t\t= &rfc8009_enc_test1_confounder,\n\t\t.base_key\t\t= &aes128_cts_hmac_sha256_128_basekey,\n\t\t.expected_result\t= &rfc8009_enc_test1_expected_result,\n\t\t.expected_hmac\t\t= &rfc8009_enc_test1_expected_hmac,\n\t},\n\t{\n\t\t.desc\t\t\t= \"Encrypt short plaintext with aes128-cts-hmac-sha256-128\",\n\t\t.enctype\t\t= ENCTYPE_AES128_CTS_HMAC_SHA256_128,\n\t\t.plaintext\t\t= &rfc8009_enc_short_plaintext,\n\t\t.confounder\t\t= &rfc8009_enc_test2_confounder,\n\t\t.base_key\t\t= &aes128_cts_hmac_sha256_128_basekey,\n\t\t.expected_result\t= &rfc8009_enc_test2_expected_result,\n\t\t.expected_hmac\t\t= &rfc8009_enc_test2_expected_hmac,\n\t},\n\t{\n\t\t.desc\t\t\t= \"Encrypt block plaintext with aes128-cts-hmac-sha256-128\",\n\t\t.enctype\t\t= ENCTYPE_AES128_CTS_HMAC_SHA256_128,\n\t\t.plaintext\t\t= &rfc8009_enc_block_plaintext,\n\t\t.confounder\t\t= &rfc8009_enc_test3_confounder,\n\t\t.base_key\t\t= &aes128_cts_hmac_sha256_128_basekey,\n\t\t.expected_result\t= &rfc8009_enc_test3_expected_result,\n\t\t.expected_hmac\t\t= &rfc8009_enc_test3_expected_hmac,\n\t},\n\t{\n\t\t.desc\t\t\t= \"Encrypt long plaintext with aes128-cts-hmac-sha256-128\",\n\t\t.enctype\t\t= ENCTYPE_AES128_CTS_HMAC_SHA256_128,\n\t\t.plaintext\t\t= &rfc8009_enc_long_plaintext,\n\t\t.confounder\t\t= &rfc8009_enc_test4_confounder,\n\t\t.base_key\t\t= &aes128_cts_hmac_sha256_128_basekey,\n\t\t.expected_result\t= &rfc8009_enc_test4_expected_result,\n\t\t.expected_hmac\t\t= &rfc8009_enc_test4_expected_hmac,\n\t},\n\t{\n\t\t.desc\t\t\t= \"Encrypt empty plaintext with aes256-cts-hmac-sha384-192\",\n\t\t.enctype\t\t= ENCTYPE_AES256_CTS_HMAC_SHA384_192,\n\t\t.plaintext\t\t= &rfc8009_enc_empty_plaintext,\n\t\t.confounder\t\t= &rfc8009_enc_test5_confounder,\n\t\t.base_key\t\t= &aes256_cts_hmac_sha384_192_basekey,\n\t\t.expected_result\t= &rfc8009_enc_test5_expected_result,\n\t\t.expected_hmac\t\t= &rfc8009_enc_test5_expected_hmac,\n\t},\n\t{\n\t\t.desc\t\t\t= \"Encrypt short plaintext with aes256-cts-hmac-sha384-192\",\n\t\t.enctype\t\t= ENCTYPE_AES256_CTS_HMAC_SHA384_192,\n\t\t.plaintext\t\t= &rfc8009_enc_short_plaintext,\n\t\t.confounder\t\t= &rfc8009_enc_test6_confounder,\n\t\t.base_key\t\t= &aes256_cts_hmac_sha384_192_basekey,\n\t\t.expected_result\t= &rfc8009_enc_test6_expected_result,\n\t\t.expected_hmac\t\t= &rfc8009_enc_test6_expected_hmac,\n\t},\n\t{\n\t\t.desc\t\t\t= \"Encrypt block plaintext with aes256-cts-hmac-sha384-192\",\n\t\t.enctype\t\t= ENCTYPE_AES256_CTS_HMAC_SHA384_192,\n\t\t.plaintext\t\t= &rfc8009_enc_block_plaintext,\n\t\t.confounder\t\t= &rfc8009_enc_test7_confounder,\n\t\t.base_key\t\t= &aes256_cts_hmac_sha384_192_basekey,\n\t\t.expected_result\t= &rfc8009_enc_test7_expected_result,\n\t\t.expected_hmac\t\t= &rfc8009_enc_test7_expected_hmac,\n\t},\n\t{\n\t\t.desc\t\t\t= \"Encrypt long plaintext with aes256-cts-hmac-sha384-192\",\n\t\t.enctype\t\t= ENCTYPE_AES256_CTS_HMAC_SHA384_192,\n\t\t.plaintext\t\t= &rfc8009_enc_long_plaintext,\n\t\t.confounder\t\t= &rfc8009_enc_test8_confounder,\n\t\t.base_key\t\t= &aes256_cts_hmac_sha384_192_basekey,\n\t\t.expected_result\t= &rfc8009_enc_test8_expected_result,\n\t\t.expected_hmac\t\t= &rfc8009_enc_test8_expected_hmac,\n\t},\n};\n\n \nKUNIT_ARRAY_PARAM(rfc8009_encrypt, rfc8009_encrypt_test_params,\n\t\t  gss_krb5_get_desc);\n\nstatic void rfc8009_encrypt_case(struct kunit *test)\n{\n\tconst struct gss_krb5_test_param *param = test->param_value;\n\tstruct crypto_sync_skcipher *cts_tfm, *cbc_tfm;\n\tconst struct gss_krb5_enctype *gk5e;\n\tstruct xdr_netobj Ke, Ki, checksum;\n\tu8 usage_data[GSS_KRB5_K5CLENGTH];\n\tstruct xdr_netobj usage = {\n\t\t.data = usage_data,\n\t\t.len = sizeof(usage_data),\n\t};\n\tstruct crypto_ahash *ahash_tfm;\n\tstruct xdr_buf buf;\n\tvoid *text;\n\tsize_t len;\n\tu32 err;\n\n\t \n\tgk5e = gss_krb5_lookup_enctype(param->enctype);\n\tif (!gk5e)\n\t\tkunit_skip(test, \"Encryption type is not available\");\n\n\t*(__be32 *)usage.data = cpu_to_be32(2);\n\n\tKe.len = gk5e->Ke_length;\n\tKe.data = kunit_kzalloc(test, Ke.len, GFP_KERNEL);\n\tKUNIT_ASSERT_NOT_ERR_OR_NULL(test, Ke.data);\n\tusage.data[4] = KEY_USAGE_SEED_ENCRYPTION;\n\terr = gk5e->derive_key(gk5e, param->base_key, &Ke,\n\t\t\t       &usage, GFP_KERNEL);\n\tKUNIT_ASSERT_EQ(test, err, 0);\n\n\tcbc_tfm = crypto_alloc_sync_skcipher(gk5e->aux_cipher, 0, 0);\n\tKUNIT_ASSERT_NOT_ERR_OR_NULL(test, cbc_tfm);\n\terr = crypto_sync_skcipher_setkey(cbc_tfm, Ke.data, Ke.len);\n\tKUNIT_ASSERT_EQ(test, err, 0);\n\n\tcts_tfm = crypto_alloc_sync_skcipher(gk5e->encrypt_name, 0, 0);\n\tKUNIT_ASSERT_NOT_ERR_OR_NULL(test, cts_tfm);\n\terr = crypto_sync_skcipher_setkey(cts_tfm, Ke.data, Ke.len);\n\tKUNIT_ASSERT_EQ(test, err, 0);\n\n\tlen = param->confounder->len + param->plaintext->len;\n\ttext = kunit_kzalloc(test, len, GFP_KERNEL);\n\tKUNIT_ASSERT_NOT_ERR_OR_NULL(test, text);\n\tmemcpy(text, param->confounder->data, param->confounder->len);\n\tmemcpy(text + param->confounder->len, param->plaintext->data,\n\t       param->plaintext->len);\n\n\tmemset(&buf, 0, sizeof(buf));\n\tbuf.head[0].iov_base = text;\n\tbuf.head[0].iov_len = param->confounder->len + param->plaintext->len;\n\tbuf.len = buf.head[0].iov_len;\n\n\tchecksum.len = gk5e->cksumlength;\n\tchecksum.data = kunit_kzalloc(test, checksum.len, GFP_KERNEL);\n\tKUNIT_ASSERT_NOT_ERR_OR_NULL(test, checksum.data);\n\n\tKi.len = gk5e->Ki_length;\n\tKi.data = kunit_kzalloc(test, Ki.len, GFP_KERNEL);\n\tKUNIT_ASSERT_NOT_ERR_OR_NULL(test, Ki.data);\n\tusage.data[4] = KEY_USAGE_SEED_INTEGRITY;\n\terr = gk5e->derive_key(gk5e, param->base_key, &Ki,\n\t\t\t       &usage, GFP_KERNEL);\n\tKUNIT_ASSERT_EQ(test, err, 0);\n\n\tahash_tfm = crypto_alloc_ahash(gk5e->cksum_name, 0, CRYPTO_ALG_ASYNC);\n\tKUNIT_ASSERT_NOT_ERR_OR_NULL(test, ahash_tfm);\n\terr = crypto_ahash_setkey(ahash_tfm, Ki.data, Ki.len);\n\tKUNIT_ASSERT_EQ(test, err, 0);\n\n\t \n\terr = krb5_cbc_cts_encrypt(cts_tfm, cbc_tfm, 0, &buf, NULL, NULL, 0);\n\tKUNIT_ASSERT_EQ(test, err, 0);\n\terr = krb5_etm_checksum(cts_tfm, ahash_tfm, &buf, 0, &checksum);\n\tKUNIT_ASSERT_EQ(test, err, 0);\n\n\t \n\tKUNIT_EXPECT_EQ_MSG(test,\n\t\t\t    param->expected_result->len, buf.len,\n\t\t\t    \"ciphertext length mismatch\");\n\tKUNIT_EXPECT_EQ_MSG(test,\n\t\t\t    memcmp(param->expected_result->data,\n\t\t\t\t   buf.head[0].iov_base,\n\t\t\t\t   param->expected_result->len), 0,\n\t\t\t    \"ciphertext mismatch\");\n\tKUNIT_EXPECT_EQ_MSG(test, memcmp(param->expected_hmac->data,\n\t\t\t\t\t checksum.data,\n\t\t\t\t\t checksum.len), 0,\n\t\t\t    \"HMAC mismatch\");\n\n\tcrypto_free_ahash(ahash_tfm);\n\tcrypto_free_sync_skcipher(cts_tfm);\n\tcrypto_free_sync_skcipher(cbc_tfm);\n}\n\nstatic struct kunit_case rfc8009_test_cases[] = {\n\t{\n\t\t.name\t\t\t= \"RFC 8009 key derivation\",\n\t\t.run_case\t\t= kdf_case,\n\t\t.generate_params\t= rfc8009_kdf_gen_params,\n\t},\n\t{\n\t\t.name\t\t\t= \"RFC 8009 checksum\",\n\t\t.run_case\t\t= checksum_case,\n\t\t.generate_params\t= rfc8009_checksum_gen_params,\n\t},\n\t{\n\t\t.name\t\t\t= \"RFC 8009 encryption\",\n\t\t.run_case\t\t= rfc8009_encrypt_case,\n\t\t.generate_params\t= rfc8009_encrypt_gen_params,\n\t},\n\t{}\n};\n\nstatic struct kunit_suite rfc8009_suite = {\n\t.name\t\t\t= \"RFC 8009 suite\",\n\t.test_cases\t\t= rfc8009_test_cases,\n};\n\n \n\nDEFINE_STR_XDR_NETOBJ(encrypt_selftest_plaintext,\n\t\t      \"This is the plaintext for the encryption self-test.\");\n\nstatic const struct gss_krb5_test_param encrypt_selftest_params[] = {\n\t{\n\t\t.desc\t\t\t= \"aes128-cts-hmac-sha1-96 encryption self-test\",\n\t\t.enctype\t\t= ENCTYPE_AES128_CTS_HMAC_SHA1_96,\n\t\t.Ke\t\t\t= &rfc3962_encryption_key,\n\t\t.plaintext\t\t= &encrypt_selftest_plaintext,\n\t},\n\t{\n\t\t.desc\t\t\t= \"aes256-cts-hmac-sha1-96 encryption self-test\",\n\t\t.enctype\t\t= ENCTYPE_AES256_CTS_HMAC_SHA1_96,\n\t\t.Ke\t\t\t= &rfc3962_encryption_key,\n\t\t.plaintext\t\t= &encrypt_selftest_plaintext,\n\t},\n\t{\n\t\t.desc\t\t\t= \"camellia128-cts-cmac encryption self-test\",\n\t\t.enctype\t\t= ENCTYPE_CAMELLIA128_CTS_CMAC,\n\t\t.Ke\t\t\t= &camellia128_cts_cmac_Ke,\n\t\t.plaintext\t\t= &encrypt_selftest_plaintext,\n\t},\n\t{\n\t\t.desc\t\t\t= \"camellia256-cts-cmac encryption self-test\",\n\t\t.enctype\t\t= ENCTYPE_CAMELLIA256_CTS_CMAC,\n\t\t.Ke\t\t\t= &camellia256_cts_cmac_Ke,\n\t\t.plaintext\t\t= &encrypt_selftest_plaintext,\n\t},\n\t{\n\t\t.desc\t\t\t= \"aes128-cts-hmac-sha256-128 encryption self-test\",\n\t\t.enctype\t\t= ENCTYPE_AES128_CTS_HMAC_SHA256_128,\n\t\t.Ke\t\t\t= &aes128_cts_hmac_sha256_128_Ke,\n\t\t.plaintext\t\t= &encrypt_selftest_plaintext,\n\t},\n\t{\n\t\t.desc\t\t\t= \"aes256-cts-hmac-sha384-192 encryption self-test\",\n\t\t.enctype\t\t= ENCTYPE_AES256_CTS_HMAC_SHA384_192,\n\t\t.Ke\t\t\t= &aes256_cts_hmac_sha384_192_Ke,\n\t\t.plaintext\t\t= &encrypt_selftest_plaintext,\n\t},\n};\n\n \nKUNIT_ARRAY_PARAM(encrypt_selftest, encrypt_selftest_params,\n\t\t  gss_krb5_get_desc);\n\n \nstatic void encrypt_selftest_case(struct kunit *test)\n{\n\tconst struct gss_krb5_test_param *param = test->param_value;\n\tstruct crypto_sync_skcipher *cts_tfm, *cbc_tfm;\n\tconst struct gss_krb5_enctype *gk5e;\n\tstruct xdr_buf buf;\n\tvoid *text;\n\tint err;\n\n\t \n\tgk5e = gss_krb5_lookup_enctype(param->enctype);\n\tif (!gk5e)\n\t\tkunit_skip(test, \"Encryption type is not available\");\n\n\tcbc_tfm = crypto_alloc_sync_skcipher(gk5e->aux_cipher, 0, 0);\n\tKUNIT_ASSERT_NOT_ERR_OR_NULL(test, cbc_tfm);\n\terr = crypto_sync_skcipher_setkey(cbc_tfm, param->Ke->data, param->Ke->len);\n\tKUNIT_ASSERT_EQ(test, err, 0);\n\n\tcts_tfm = crypto_alloc_sync_skcipher(gk5e->encrypt_name, 0, 0);\n\tKUNIT_ASSERT_NOT_ERR_OR_NULL(test, cts_tfm);\n\terr = crypto_sync_skcipher_setkey(cts_tfm, param->Ke->data, param->Ke->len);\n\tKUNIT_ASSERT_EQ(test, err, 0);\n\n\ttext = kunit_kzalloc(test, roundup(param->plaintext->len,\n\t\t\t\t\t   crypto_sync_skcipher_blocksize(cbc_tfm)),\n\t\t\t     GFP_KERNEL);\n\tKUNIT_ASSERT_NOT_ERR_OR_NULL(test, text);\n\n\tmemcpy(text, param->plaintext->data, param->plaintext->len);\n\tmemset(&buf, 0, sizeof(buf));\n\tbuf.head[0].iov_base = text;\n\tbuf.head[0].iov_len = param->plaintext->len;\n\tbuf.len = buf.head[0].iov_len;\n\n\t \n\terr = krb5_cbc_cts_encrypt(cts_tfm, cbc_tfm, 0, &buf, NULL, NULL, 0);\n\tKUNIT_ASSERT_EQ(test, err, 0);\n\terr = krb5_cbc_cts_decrypt(cts_tfm, cbc_tfm, 0, &buf);\n\tKUNIT_ASSERT_EQ(test, err, 0);\n\n\t \n\tKUNIT_EXPECT_EQ_MSG(test,\n\t\t\t    param->plaintext->len, buf.len,\n\t\t\t    \"length mismatch\");\n\tKUNIT_EXPECT_EQ_MSG(test,\n\t\t\t    memcmp(param->plaintext->data,\n\t\t\t\t   buf.head[0].iov_base, buf.len), 0,\n\t\t\t    \"plaintext mismatch\");\n\n\tcrypto_free_sync_skcipher(cts_tfm);\n\tcrypto_free_sync_skcipher(cbc_tfm);\n}\n\nstatic struct kunit_case encryption_test_cases[] = {\n\t{\n\t\t.name\t\t\t= \"Encryption self-tests\",\n\t\t.run_case\t\t= encrypt_selftest_case,\n\t\t.generate_params\t= encrypt_selftest_gen_params,\n\t},\n\t{}\n};\n\nstatic struct kunit_suite encryption_test_suite = {\n\t.name\t\t\t= \"Encryption test suite\",\n\t.test_cases\t\t= encryption_test_cases,\n};\n\nkunit_test_suites(&rfc3961_suite,\n\t\t  &rfc3962_suite,\n\t\t  &rfc6803_suite,\n\t\t  &rfc8009_suite,\n\t\t  &encryption_test_suite);\n\nMODULE_DESCRIPTION(\"Test RPCSEC GSS Kerberos 5 functions\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}