{
  "module_name": "debugfs.c",
  "hash_id": "c7b1002d5ddb250700f2bafc083334215ad7a6669f7b14d599bb552a44772b07",
  "original_prompt": "Ingested from linux-6.6.14/net/6lowpan/debugfs.c",
  "human_readable_source": "\n \n\n#include <net/6lowpan.h>\n\n#include \"6lowpan_i.h\"\n\n#define LOWPAN_DEBUGFS_CTX_PFX_NUM_ARGS\t8\n\nstatic struct dentry *lowpan_debugfs;\n\nstatic int lowpan_ctx_flag_active_set(void *data, u64 val)\n{\n\tstruct lowpan_iphc_ctx *ctx = data;\n\n\tif (val != 0 && val != 1)\n\t\treturn -EINVAL;\n\n\tif (val)\n\t\tset_bit(LOWPAN_IPHC_CTX_FLAG_ACTIVE, &ctx->flags);\n\telse\n\t\tclear_bit(LOWPAN_IPHC_CTX_FLAG_ACTIVE, &ctx->flags);\n\n\treturn 0;\n}\n\nstatic int lowpan_ctx_flag_active_get(void *data, u64 *val)\n{\n\t*val = lowpan_iphc_ctx_is_active(data);\n\treturn 0;\n}\n\nDEFINE_DEBUGFS_ATTRIBUTE(lowpan_ctx_flag_active_fops,\n\t\t\t lowpan_ctx_flag_active_get,\n\t\t\t lowpan_ctx_flag_active_set, \"%llu\\n\");\n\nstatic int lowpan_ctx_flag_c_set(void *data, u64 val)\n{\n\tstruct lowpan_iphc_ctx *ctx = data;\n\n\tif (val != 0 && val != 1)\n\t\treturn -EINVAL;\n\n\tif (val)\n\t\tset_bit(LOWPAN_IPHC_CTX_FLAG_COMPRESSION, &ctx->flags);\n\telse\n\t\tclear_bit(LOWPAN_IPHC_CTX_FLAG_COMPRESSION, &ctx->flags);\n\n\treturn 0;\n}\n\nstatic int lowpan_ctx_flag_c_get(void *data, u64 *val)\n{\n\t*val = lowpan_iphc_ctx_is_compression(data);\n\treturn 0;\n}\n\nDEFINE_DEBUGFS_ATTRIBUTE(lowpan_ctx_flag_c_fops, lowpan_ctx_flag_c_get,\n\t\t\t lowpan_ctx_flag_c_set, \"%llu\\n\");\n\nstatic int lowpan_ctx_plen_set(void *data, u64 val)\n{\n\tstruct lowpan_iphc_ctx *ctx = data;\n\tstruct lowpan_iphc_ctx_table *t =\n\t\tcontainer_of(ctx, struct lowpan_iphc_ctx_table, table[ctx->id]);\n\n\tif (val > 128)\n\t\treturn -EINVAL;\n\n\tspin_lock_bh(&t->lock);\n\tctx->plen = val;\n\tspin_unlock_bh(&t->lock);\n\n\treturn 0;\n}\n\nstatic int lowpan_ctx_plen_get(void *data, u64 *val)\n{\n\tstruct lowpan_iphc_ctx *ctx = data;\n\tstruct lowpan_iphc_ctx_table *t =\n\t\tcontainer_of(ctx, struct lowpan_iphc_ctx_table, table[ctx->id]);\n\n\tspin_lock_bh(&t->lock);\n\t*val = ctx->plen;\n\tspin_unlock_bh(&t->lock);\n\treturn 0;\n}\n\nDEFINE_DEBUGFS_ATTRIBUTE(lowpan_ctx_plen_fops, lowpan_ctx_plen_get,\n\t\t\t lowpan_ctx_plen_set, \"%llu\\n\");\n\nstatic int lowpan_ctx_pfx_show(struct seq_file *file, void *offset)\n{\n\tstruct lowpan_iphc_ctx *ctx = file->private;\n\tstruct lowpan_iphc_ctx_table *t =\n\t\tcontainer_of(ctx, struct lowpan_iphc_ctx_table, table[ctx->id]);\n\n\tspin_lock_bh(&t->lock);\n\tseq_printf(file, \"%04x:%04x:%04x:%04x:%04x:%04x:%04x:%04x\\n\",\n\t\t   be16_to_cpu(ctx->pfx.s6_addr16[0]),\n\t\t   be16_to_cpu(ctx->pfx.s6_addr16[1]),\n\t\t   be16_to_cpu(ctx->pfx.s6_addr16[2]),\n\t\t   be16_to_cpu(ctx->pfx.s6_addr16[3]),\n\t\t   be16_to_cpu(ctx->pfx.s6_addr16[4]),\n\t\t   be16_to_cpu(ctx->pfx.s6_addr16[5]),\n\t\t   be16_to_cpu(ctx->pfx.s6_addr16[6]),\n\t\t   be16_to_cpu(ctx->pfx.s6_addr16[7]));\n\tspin_unlock_bh(&t->lock);\n\n\treturn 0;\n}\n\nstatic int lowpan_ctx_pfx_open(struct inode *inode, struct file *file)\n{\n\treturn single_open(file, lowpan_ctx_pfx_show, inode->i_private);\n}\n\nstatic ssize_t lowpan_ctx_pfx_write(struct file *fp,\n\t\t\t\t    const char __user *user_buf, size_t count,\n\t\t\t\t    loff_t *ppos)\n{\n\tchar buf[128] = {};\n\tstruct seq_file *file = fp->private_data;\n\tstruct lowpan_iphc_ctx *ctx = file->private;\n\tstruct lowpan_iphc_ctx_table *t =\n\t\tcontainer_of(ctx, struct lowpan_iphc_ctx_table, table[ctx->id]);\n\tint status = count, n, i;\n\tunsigned int addr[8];\n\n\tif (copy_from_user(&buf, user_buf, min_t(size_t, sizeof(buf) - 1,\n\t\t\t\t\t\t count))) {\n\t\tstatus = -EFAULT;\n\t\tgoto out;\n\t}\n\n\tn = sscanf(buf, \"%04x:%04x:%04x:%04x:%04x:%04x:%04x:%04x\",\n\t\t   &addr[0], &addr[1], &addr[2], &addr[3], &addr[4],\n\t\t   &addr[5], &addr[6], &addr[7]);\n\tif (n != LOWPAN_DEBUGFS_CTX_PFX_NUM_ARGS) {\n\t\tstatus = -EINVAL;\n\t\tgoto out;\n\t}\n\n\tspin_lock_bh(&t->lock);\n\tfor (i = 0; i < 8; i++)\n\t\tctx->pfx.s6_addr16[i] = cpu_to_be16(addr[i] & 0xffff);\n\tspin_unlock_bh(&t->lock);\n\nout:\n\treturn status;\n}\n\nstatic const struct file_operations lowpan_ctx_pfx_fops = {\n\t.open\t\t= lowpan_ctx_pfx_open,\n\t.read\t\t= seq_read,\n\t.write\t\t= lowpan_ctx_pfx_write,\n\t.llseek\t\t= seq_lseek,\n\t.release\t= single_release,\n};\n\nstatic void lowpan_dev_debugfs_ctx_init(struct net_device *dev,\n\t\t\t\t\tstruct dentry *ctx, u8 id)\n{\n\tstruct lowpan_dev *ldev = lowpan_dev(dev);\n\tstruct dentry *root;\n\tchar buf[32];\n\n\tif (WARN_ON_ONCE(id >= LOWPAN_IPHC_CTX_TABLE_SIZE))\n\t\treturn;\n\n\tsprintf(buf, \"%d\", id);\n\n\troot = debugfs_create_dir(buf, ctx);\n\n\tdebugfs_create_file(\"active\", 0644, root, &ldev->ctx.table[id],\n\t\t\t    &lowpan_ctx_flag_active_fops);\n\n\tdebugfs_create_file(\"compression\", 0644, root, &ldev->ctx.table[id],\n\t\t\t    &lowpan_ctx_flag_c_fops);\n\n\tdebugfs_create_file(\"prefix\", 0644, root, &ldev->ctx.table[id],\n\t\t\t    &lowpan_ctx_pfx_fops);\n\n\tdebugfs_create_file(\"prefix_len\", 0644, root, &ldev->ctx.table[id],\n\t\t\t    &lowpan_ctx_plen_fops);\n}\n\nstatic int lowpan_context_show(struct seq_file *file, void *offset)\n{\n\tstruct lowpan_iphc_ctx_table *t = file->private;\n\tint i;\n\n\tseq_printf(file, \"%3s|%-43s|%c\\n\", \"cid\", \"prefix\", 'C');\n\tseq_puts(file, \"-------------------------------------------------\\n\");\n\n\tspin_lock_bh(&t->lock);\n\tfor (i = 0; i < LOWPAN_IPHC_CTX_TABLE_SIZE; i++) {\n\t\tif (!lowpan_iphc_ctx_is_active(&t->table[i]))\n\t\t\tcontinue;\n\n\t\tseq_printf(file, \"%3d|%39pI6c/%-3d|%d\\n\", t->table[i].id,\n\t\t\t   &t->table[i].pfx, t->table[i].plen,\n\t\t\t   lowpan_iphc_ctx_is_compression(&t->table[i]));\n\t}\n\tspin_unlock_bh(&t->lock);\n\n\treturn 0;\n}\nDEFINE_SHOW_ATTRIBUTE(lowpan_context);\n\nstatic int lowpan_short_addr_get(void *data, u64 *val)\n{\n\tstruct wpan_dev *wdev = data;\n\n\trtnl_lock();\n\t*val = le16_to_cpu(wdev->short_addr);\n\trtnl_unlock();\n\n\treturn 0;\n}\n\nDEFINE_DEBUGFS_ATTRIBUTE(lowpan_short_addr_fops, lowpan_short_addr_get, NULL,\n\t\t\t \"0x%04llx\\n\");\n\nstatic void lowpan_dev_debugfs_802154_init(const struct net_device *dev,\n\t\t\t\t\t  struct lowpan_dev *ldev)\n{\n\tstruct dentry *root;\n\n\tif (!lowpan_is_ll(dev, LOWPAN_LLTYPE_IEEE802154))\n\t\treturn;\n\n\troot = debugfs_create_dir(\"ieee802154\", ldev->iface_debugfs);\n\n\tdebugfs_create_file(\"short_addr\", 0444, root,\n\t\t\t    lowpan_802154_dev(dev)->wdev->ieee802154_ptr,\n\t\t\t    &lowpan_short_addr_fops);\n}\n\nvoid lowpan_dev_debugfs_init(struct net_device *dev)\n{\n\tstruct lowpan_dev *ldev = lowpan_dev(dev);\n\tstruct dentry *contexts;\n\tint i;\n\n\t \n\tldev->iface_debugfs = debugfs_create_dir(dev->name, lowpan_debugfs);\n\n\tcontexts = debugfs_create_dir(\"contexts\", ldev->iface_debugfs);\n\n\tdebugfs_create_file(\"show\", 0644, contexts, &lowpan_dev(dev)->ctx,\n\t\t\t    &lowpan_context_fops);\n\n\tfor (i = 0; i < LOWPAN_IPHC_CTX_TABLE_SIZE; i++)\n\t\tlowpan_dev_debugfs_ctx_init(dev, contexts, i);\n\n\tlowpan_dev_debugfs_802154_init(dev, ldev);\n}\n\nvoid lowpan_dev_debugfs_exit(struct net_device *dev)\n{\n\tdebugfs_remove_recursive(lowpan_dev(dev)->iface_debugfs);\n}\n\nvoid __init lowpan_debugfs_init(void)\n{\n\tlowpan_debugfs = debugfs_create_dir(\"6lowpan\", NULL);\n}\n\nvoid lowpan_debugfs_exit(void)\n{\n\tdebugfs_remove_recursive(lowpan_debugfs);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}