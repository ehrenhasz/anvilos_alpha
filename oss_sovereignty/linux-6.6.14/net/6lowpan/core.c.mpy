{
  "module_name": "core.c",
  "hash_id": "bf3ab752f6ab1968f1345f694095a484c39a47316768a682fc7d44597a7b285c",
  "original_prompt": "Ingested from linux-6.6.14/net/6lowpan/core.c",
  "human_readable_source": "\n \n\n#include <linux/if_arp.h>\n#include <linux/module.h>\n\n#include <net/6lowpan.h>\n#include <net/addrconf.h>\n\n#include \"6lowpan_i.h\"\n\nint lowpan_register_netdevice(struct net_device *dev,\n\t\t\t      enum lowpan_lltypes lltype)\n{\n\tint i, ret;\n\n\tswitch (lltype) {\n\tcase LOWPAN_LLTYPE_IEEE802154:\n\t\tdev->addr_len = EUI64_ADDR_LEN;\n\t\tbreak;\n\n\tcase LOWPAN_LLTYPE_BTLE:\n\t\tdev->addr_len = ETH_ALEN;\n\t\tbreak;\n\t}\n\n\tdev->type = ARPHRD_6LOWPAN;\n\tdev->mtu = IPV6_MIN_MTU;\n\n\tlowpan_dev(dev)->lltype = lltype;\n\n\tspin_lock_init(&lowpan_dev(dev)->ctx.lock);\n\tfor (i = 0; i < LOWPAN_IPHC_CTX_TABLE_SIZE; i++)\n\t\tlowpan_dev(dev)->ctx.table[i].id = i;\n\n\tdev->ndisc_ops = &lowpan_ndisc_ops;\n\n\tret = register_netdevice(dev);\n\tif (ret < 0)\n\t\treturn ret;\n\n\tlowpan_dev_debugfs_init(dev);\n\n\treturn ret;\n}\nEXPORT_SYMBOL(lowpan_register_netdevice);\n\nint lowpan_register_netdev(struct net_device *dev,\n\t\t\t   enum lowpan_lltypes lltype)\n{\n\tint ret;\n\n\trtnl_lock();\n\tret = lowpan_register_netdevice(dev, lltype);\n\trtnl_unlock();\n\treturn ret;\n}\nEXPORT_SYMBOL(lowpan_register_netdev);\n\nvoid lowpan_unregister_netdevice(struct net_device *dev)\n{\n\tunregister_netdevice(dev);\n\tlowpan_dev_debugfs_exit(dev);\n}\nEXPORT_SYMBOL(lowpan_unregister_netdevice);\n\nvoid lowpan_unregister_netdev(struct net_device *dev)\n{\n\trtnl_lock();\n\tlowpan_unregister_netdevice(dev);\n\trtnl_unlock();\n}\nEXPORT_SYMBOL(lowpan_unregister_netdev);\n\nint addrconf_ifid_802154_6lowpan(u8 *eui, struct net_device *dev)\n{\n\tstruct wpan_dev *wpan_dev = lowpan_802154_dev(dev)->wdev->ieee802154_ptr;\n\n\t \n\tif (!lowpan_802154_is_valid_src_short_addr(wpan_dev->short_addr))\n\t\treturn -1;\n\n\t \n\tif (wpan_dev->pan_id == cpu_to_le16(0x0000) &&\n\t    wpan_dev->short_addr == cpu_to_le16(0x0000))\n\t\treturn -1;\n\n\t \n\tif (wpan_dev->pan_id == cpu_to_le16(IEEE802154_PAN_ID_BROADCAST))\n\t\tmemset(eui, 0, 2);\n\telse\n\t\tieee802154_le16_to_be16(eui, &wpan_dev->pan_id);\n\n\t \n\teui[0] &= ~2;\n\teui[2] = 0;\n\teui[3] = 0xFF;\n\teui[4] = 0xFE;\n\teui[5] = 0;\n\tieee802154_le16_to_be16(&eui[6], &wpan_dev->short_addr);\n\treturn 0;\n}\n\nstatic int lowpan_event(struct notifier_block *unused,\n\t\t\tunsigned long event, void *ptr)\n{\n\tstruct net_device *dev = netdev_notifier_info_to_dev(ptr);\n\tstruct inet6_dev *idev;\n\tstruct in6_addr addr;\n\tint i;\n\n\tif (dev->type != ARPHRD_6LOWPAN)\n\t\treturn NOTIFY_DONE;\n\n\tidev = __in6_dev_get(dev);\n\tif (!idev)\n\t\treturn NOTIFY_DONE;\n\n\tswitch (event) {\n\tcase NETDEV_UP:\n\tcase NETDEV_CHANGE:\n\t\t \n\t\tif (lowpan_is_ll(dev, LOWPAN_LLTYPE_IEEE802154) &&\n\t\t    addrconf_ifid_802154_6lowpan(addr.s6_addr + 8, dev) == 0) {\n\t\t\t__ipv6_addr_set_half(&addr.s6_addr32[0],\n\t\t\t\t\t     htonl(0xFE800000), 0);\n\t\t\taddrconf_add_linklocal(idev, &addr, 0);\n\t\t}\n\t\tbreak;\n\tcase NETDEV_DOWN:\n\t\tfor (i = 0; i < LOWPAN_IPHC_CTX_TABLE_SIZE; i++)\n\t\t\tclear_bit(LOWPAN_IPHC_CTX_FLAG_ACTIVE,\n\t\t\t\t  &lowpan_dev(dev)->ctx.table[i].flags);\n\t\tbreak;\n\tdefault:\n\t\treturn NOTIFY_DONE;\n\t}\n\n\treturn NOTIFY_OK;\n}\n\nstatic struct notifier_block lowpan_notifier = {\n\t.notifier_call = lowpan_event,\n};\n\nstatic int __init lowpan_module_init(void)\n{\n\tint ret;\n\n\tlowpan_debugfs_init();\n\n\tret = register_netdevice_notifier(&lowpan_notifier);\n\tif (ret < 0) {\n\t\tlowpan_debugfs_exit();\n\t\treturn ret;\n\t}\n\n\trequest_module_nowait(\"nhc_dest\");\n\trequest_module_nowait(\"nhc_fragment\");\n\trequest_module_nowait(\"nhc_hop\");\n\trequest_module_nowait(\"nhc_ipv6\");\n\trequest_module_nowait(\"nhc_mobility\");\n\trequest_module_nowait(\"nhc_routing\");\n\trequest_module_nowait(\"nhc_udp\");\n\n\treturn 0;\n}\n\nstatic void __exit lowpan_module_exit(void)\n{\n\tlowpan_debugfs_exit();\n\tunregister_netdevice_notifier(&lowpan_notifier);\n}\n\nmodule_init(lowpan_module_init);\nmodule_exit(lowpan_module_exit);\n\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}