{
  "module_name": "af_nfc.c",
  "hash_id": "7689333a0fe99b6acad8395585a234c1c9639d676afd103ef2eba32d56d47485",
  "original_prompt": "Ingested from linux-6.6.14/net/nfc/af_nfc.c",
  "human_readable_source": "\n \n\n#include <linux/nfc.h>\n#include <linux/module.h>\n\n#include \"nfc.h\"\n\nstatic DEFINE_RWLOCK(proto_tab_lock);\nstatic const struct nfc_protocol *proto_tab[NFC_SOCKPROTO_MAX];\n\nstatic int nfc_sock_create(struct net *net, struct socket *sock, int proto,\n\t\t\t   int kern)\n{\n\tint rc = -EPROTONOSUPPORT;\n\n\tif (net != &init_net)\n\t\treturn -EAFNOSUPPORT;\n\n\tif (proto < 0 || proto >= NFC_SOCKPROTO_MAX)\n\t\treturn -EINVAL;\n\n\tread_lock(&proto_tab_lock);\n\tif (proto_tab[proto] &&\ttry_module_get(proto_tab[proto]->owner)) {\n\t\trc = proto_tab[proto]->create(net, sock, proto_tab[proto], kern);\n\t\tmodule_put(proto_tab[proto]->owner);\n\t}\n\tread_unlock(&proto_tab_lock);\n\n\treturn rc;\n}\n\nstatic const struct net_proto_family nfc_sock_family_ops = {\n\t.owner  = THIS_MODULE,\n\t.family = PF_NFC,\n\t.create = nfc_sock_create,\n};\n\nint nfc_proto_register(const struct nfc_protocol *nfc_proto)\n{\n\tint rc;\n\n\tif (nfc_proto->id < 0 || nfc_proto->id >= NFC_SOCKPROTO_MAX)\n\t\treturn -EINVAL;\n\n\trc = proto_register(nfc_proto->proto, 0);\n\tif (rc)\n\t\treturn rc;\n\n\twrite_lock(&proto_tab_lock);\n\tif (proto_tab[nfc_proto->id])\n\t\trc = -EBUSY;\n\telse\n\t\tproto_tab[nfc_proto->id] = nfc_proto;\n\twrite_unlock(&proto_tab_lock);\n\n\tif (rc)\n\t\tproto_unregister(nfc_proto->proto);\n\n\treturn rc;\n}\nEXPORT_SYMBOL(nfc_proto_register);\n\nvoid nfc_proto_unregister(const struct nfc_protocol *nfc_proto)\n{\n\twrite_lock(&proto_tab_lock);\n\tproto_tab[nfc_proto->id] = NULL;\n\twrite_unlock(&proto_tab_lock);\n\n\tproto_unregister(nfc_proto->proto);\n}\nEXPORT_SYMBOL(nfc_proto_unregister);\n\nint __init af_nfc_init(void)\n{\n\treturn sock_register(&nfc_sock_family_ops);\n}\n\nvoid __exit af_nfc_exit(void)\n{\n\tsock_unregister(PF_NFC);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}