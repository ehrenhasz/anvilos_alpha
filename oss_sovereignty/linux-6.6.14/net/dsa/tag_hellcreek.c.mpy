{
  "module_name": "tag_hellcreek.c",
  "hash_id": "4e142eaaeb36081e197596b1a5203eb0116d6b64915d48bf30cddb7eaf23dcfe",
  "original_prompt": "Ingested from linux-6.6.14/net/dsa/tag_hellcreek.c",
  "human_readable_source": "\n \n\n#include <linux/skbuff.h>\n#include <net/dsa.h>\n\n#include \"tag.h\"\n\n#define HELLCREEK_NAME\t\t\"hellcreek\"\n\n#define HELLCREEK_TAG_LEN\t1\n\nstatic struct sk_buff *hellcreek_xmit(struct sk_buff *skb,\n\t\t\t\t      struct net_device *dev)\n{\n\tstruct dsa_port *dp = dsa_slave_to_port(dev);\n\tu8 *tag;\n\n\t \n\tif (skb->ip_summed == CHECKSUM_PARTIAL &&\n\t    skb_checksum_help(skb))\n\t\treturn NULL;\n\n\t \n\ttag  = skb_put(skb, HELLCREEK_TAG_LEN);\n\t*tag = BIT(dp->index);\n\n\treturn skb;\n}\n\nstatic struct sk_buff *hellcreek_rcv(struct sk_buff *skb,\n\t\t\t\t     struct net_device *dev)\n{\n\t \n\tu8 *tag = skb_tail_pointer(skb) - HELLCREEK_TAG_LEN;\n\tunsigned int port = tag[0] & 0x03;\n\n\tskb->dev = dsa_master_find_slave(dev, 0, port);\n\tif (!skb->dev) {\n\t\tnetdev_warn_once(dev, \"Failed to get source port: %d\\n\", port);\n\t\treturn NULL;\n\t}\n\n\tif (pskb_trim_rcsum(skb, skb->len - HELLCREEK_TAG_LEN))\n\t\treturn NULL;\n\n\tdsa_default_offload_fwd_mark(skb);\n\n\treturn skb;\n}\n\nstatic const struct dsa_device_ops hellcreek_netdev_ops = {\n\t.name\t  = HELLCREEK_NAME,\n\t.proto\t  = DSA_TAG_PROTO_HELLCREEK,\n\t.xmit\t  = hellcreek_xmit,\n\t.rcv\t  = hellcreek_rcv,\n\t.needed_tailroom = HELLCREEK_TAG_LEN,\n};\n\nMODULE_LICENSE(\"Dual MIT/GPL\");\nMODULE_ALIAS_DSA_TAG_DRIVER(DSA_TAG_PROTO_HELLCREEK, HELLCREEK_NAME);\n\nmodule_dsa_tag_driver(hellcreek_netdev_ops);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}