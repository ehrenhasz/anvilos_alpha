{
  "module_name": "em_cmp.c",
  "hash_id": "e893094b5126956ab1a850f0d27f370e22cfd12c2a44b374e877d7936655cc3e",
  "original_prompt": "Ingested from linux-6.6.14/net/sched/em_cmp.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/types.h>\n#include <linux/kernel.h>\n#include <linux/skbuff.h>\n#include <linux/tc_ematch/tc_em_cmp.h>\n#include <asm/unaligned.h>\n#include <net/pkt_cls.h>\n\nstatic inline int cmp_needs_transformation(struct tcf_em_cmp *cmp)\n{\n\treturn unlikely(cmp->flags & TCF_EM_CMP_TRANS);\n}\n\nstatic int em_cmp_match(struct sk_buff *skb, struct tcf_ematch *em,\n\t\t\tstruct tcf_pkt_info *info)\n{\n\tstruct tcf_em_cmp *cmp = (struct tcf_em_cmp *) em->data;\n\tunsigned char *ptr = tcf_get_base_ptr(skb, cmp->layer) + cmp->off;\n\tu32 val = 0;\n\n\tif (!tcf_valid_offset(skb, ptr, cmp->align))\n\t\treturn 0;\n\n\tswitch (cmp->align) {\n\tcase TCF_EM_ALIGN_U8:\n\t\tval = *ptr;\n\t\tbreak;\n\n\tcase TCF_EM_ALIGN_U16:\n\t\tval = get_unaligned_be16(ptr);\n\n\t\tif (cmp_needs_transformation(cmp))\n\t\t\tval = be16_to_cpu(val);\n\t\tbreak;\n\n\tcase TCF_EM_ALIGN_U32:\n\t\t \n\t\tval = get_unaligned_be32(ptr);\n\n\t\tif (cmp_needs_transformation(cmp))\n\t\t\tval = be32_to_cpu(val);\n\t\tbreak;\n\n\tdefault:\n\t\treturn 0;\n\t}\n\n\tif (cmp->mask)\n\t\tval &= cmp->mask;\n\n\tswitch (cmp->opnd) {\n\tcase TCF_EM_OPND_EQ:\n\t\treturn val == cmp->val;\n\tcase TCF_EM_OPND_LT:\n\t\treturn val < cmp->val;\n\tcase TCF_EM_OPND_GT:\n\t\treturn val > cmp->val;\n\t}\n\n\treturn 0;\n}\n\nstatic struct tcf_ematch_ops em_cmp_ops = {\n\t.kind\t  = TCF_EM_CMP,\n\t.datalen  = sizeof(struct tcf_em_cmp),\n\t.match\t  = em_cmp_match,\n\t.owner\t  = THIS_MODULE,\n\t.link\t  = LIST_HEAD_INIT(em_cmp_ops.link)\n};\n\nstatic int __init init_em_cmp(void)\n{\n\treturn tcf_em_register(&em_cmp_ops);\n}\n\nstatic void __exit exit_em_cmp(void)\n{\n\ttcf_em_unregister(&em_cmp_ops);\n}\n\nMODULE_LICENSE(\"GPL\");\n\nmodule_init(init_em_cmp);\nmodule_exit(exit_em_cmp);\n\nMODULE_ALIAS_TCF_EMATCH(TCF_EM_CMP);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}