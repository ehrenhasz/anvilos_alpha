{
  "module_name": "em_nbyte.c",
  "hash_id": "1536b93356267339f399310134d65902e01b936c2b265eb646f9a46b8a62c2b7",
  "original_prompt": "Ingested from linux-6.6.14/net/sched/em_nbyte.c",
  "human_readable_source": "\n \n\n#include <linux/gfp.h>\n#include <linux/module.h>\n#include <linux/types.h>\n#include <linux/kernel.h>\n#include <linux/string.h>\n#include <linux/skbuff.h>\n#include <linux/tc_ematch/tc_em_nbyte.h>\n#include <net/pkt_cls.h>\n\nstruct nbyte_data {\n\tstruct tcf_em_nbyte\thdr;\n\tchar\t\t\tpattern[];\n};\n\nstatic int em_nbyte_change(struct net *net, void *data, int data_len,\n\t\t\t   struct tcf_ematch *em)\n{\n\tstruct tcf_em_nbyte *nbyte = data;\n\n\tif (data_len < sizeof(*nbyte) ||\n\t    data_len < (sizeof(*nbyte) + nbyte->len))\n\t\treturn -EINVAL;\n\n\tem->datalen = sizeof(*nbyte) + nbyte->len;\n\tem->data = (unsigned long)kmemdup(data, em->datalen, GFP_KERNEL);\n\tif (em->data == 0UL)\n\t\treturn -ENOMEM;\n\n\treturn 0;\n}\n\nstatic int em_nbyte_match(struct sk_buff *skb, struct tcf_ematch *em,\n\t\t\t  struct tcf_pkt_info *info)\n{\n\tstruct nbyte_data *nbyte = (struct nbyte_data *) em->data;\n\tunsigned char *ptr = tcf_get_base_ptr(skb, nbyte->hdr.layer);\n\n\tptr += nbyte->hdr.off;\n\n\tif (!tcf_valid_offset(skb, ptr, nbyte->hdr.len))\n\t\treturn 0;\n\n\treturn !memcmp(ptr, nbyte->pattern, nbyte->hdr.len);\n}\n\nstatic struct tcf_ematch_ops em_nbyte_ops = {\n\t.kind\t  = TCF_EM_NBYTE,\n\t.change\t  = em_nbyte_change,\n\t.match\t  = em_nbyte_match,\n\t.owner\t  = THIS_MODULE,\n\t.link\t  = LIST_HEAD_INIT(em_nbyte_ops.link)\n};\n\nstatic int __init init_em_nbyte(void)\n{\n\treturn tcf_em_register(&em_nbyte_ops);\n}\n\nstatic void __exit exit_em_nbyte(void)\n{\n\ttcf_em_unregister(&em_nbyte_ops);\n}\n\nMODULE_LICENSE(\"GPL\");\n\nmodule_init(init_em_nbyte);\nmodule_exit(exit_em_nbyte);\n\nMODULE_ALIAS_TCF_EMATCH(TCF_EM_NBYTE);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}