{
  "module_name": "stream_sched_rr.c",
  "hash_id": "069ceb8f84efcc2476454eb56633d0eb81e6eb2be579d03aa03415d80d7dd39b",
  "original_prompt": "Ingested from linux-6.6.14/net/sctp/stream_sched_rr.c",
  "human_readable_source": "\n \n\n#include <linux/list.h>\n#include <net/sctp/sctp.h>\n#include <net/sctp/sm.h>\n#include <net/sctp/stream_sched.h>\n\n \nstatic void sctp_sched_rr_unsched_all(struct sctp_stream *stream);\n\nstatic void sctp_sched_rr_next_stream(struct sctp_stream *stream)\n{\n\tstruct list_head *pos;\n\n\tpos = stream->rr_next->rr_list.next;\n\tif (pos == &stream->rr_list)\n\t\tpos = pos->next;\n\tstream->rr_next = list_entry(pos, struct sctp_stream_out_ext, rr_list);\n}\n\nstatic void sctp_sched_rr_unsched(struct sctp_stream *stream,\n\t\t\t\t  struct sctp_stream_out_ext *soute)\n{\n\tif (stream->rr_next == soute)\n\t\t \n\t\tsctp_sched_rr_next_stream(stream);\n\n\tlist_del_init(&soute->rr_list);\n\n\t \n\tif (list_empty(&stream->rr_list))\n\t\tstream->rr_next = NULL;\n}\n\nstatic void sctp_sched_rr_sched(struct sctp_stream *stream,\n\t\t\t\tstruct sctp_stream_out_ext *soute)\n{\n\tif (!list_empty(&soute->rr_list))\n\t\t \n\t\treturn;\n\n\t \n\tlist_add_tail(&soute->rr_list, &stream->rr_list);\n\n\tif (!stream->rr_next)\n\t\tstream->rr_next = soute;\n}\n\nstatic int sctp_sched_rr_set(struct sctp_stream *stream, __u16 sid,\n\t\t\t     __u16 prio, gfp_t gfp)\n{\n\treturn 0;\n}\n\nstatic int sctp_sched_rr_get(struct sctp_stream *stream, __u16 sid,\n\t\t\t     __u16 *value)\n{\n\treturn 0;\n}\n\nstatic int sctp_sched_rr_init(struct sctp_stream *stream)\n{\n\tINIT_LIST_HEAD(&stream->rr_list);\n\tstream->rr_next = NULL;\n\n\treturn 0;\n}\n\nstatic int sctp_sched_rr_init_sid(struct sctp_stream *stream, __u16 sid,\n\t\t\t\t  gfp_t gfp)\n{\n\tINIT_LIST_HEAD(&SCTP_SO(stream, sid)->ext->rr_list);\n\n\treturn 0;\n}\n\nstatic void sctp_sched_rr_free_sid(struct sctp_stream *stream, __u16 sid)\n{\n}\n\nstatic void sctp_sched_rr_enqueue(struct sctp_outq *q,\n\t\t\t\t  struct sctp_datamsg *msg)\n{\n\tstruct sctp_stream *stream;\n\tstruct sctp_chunk *ch;\n\t__u16 sid;\n\n\tch = list_first_entry(&msg->chunks, struct sctp_chunk, frag_list);\n\tsid = sctp_chunk_stream_no(ch);\n\tstream = &q->asoc->stream;\n\tsctp_sched_rr_sched(stream, SCTP_SO(stream, sid)->ext);\n}\n\nstatic struct sctp_chunk *sctp_sched_rr_dequeue(struct sctp_outq *q)\n{\n\tstruct sctp_stream *stream = &q->asoc->stream;\n\tstruct sctp_stream_out_ext *soute;\n\tstruct sctp_chunk *ch = NULL;\n\n\t \n\tif (list_empty(&q->out_chunk_list))\n\t\tgoto out;\n\n\t \n\tif (stream->out_curr)\n\t\tsoute = stream->out_curr->ext;\n\telse\n\t\tsoute = stream->rr_next;\n\tch = list_entry(soute->outq.next, struct sctp_chunk, stream_list);\n\n\tsctp_sched_dequeue_common(q, ch);\n\nout:\n\treturn ch;\n}\n\nstatic void sctp_sched_rr_dequeue_done(struct sctp_outq *q,\n\t\t\t\t       struct sctp_chunk *ch)\n{\n\tstruct sctp_stream_out_ext *soute;\n\t__u16 sid;\n\n\t \n\tsid = sctp_chunk_stream_no(ch);\n\tsoute = SCTP_SO(&q->asoc->stream, sid)->ext;\n\n\tsctp_sched_rr_next_stream(&q->asoc->stream);\n\n\tif (list_empty(&soute->outq))\n\t\tsctp_sched_rr_unsched(&q->asoc->stream, soute);\n}\n\nstatic void sctp_sched_rr_sched_all(struct sctp_stream *stream)\n{\n\tstruct sctp_association *asoc;\n\tstruct sctp_stream_out_ext *soute;\n\tstruct sctp_chunk *ch;\n\n\tasoc = container_of(stream, struct sctp_association, stream);\n\tlist_for_each_entry(ch, &asoc->outqueue.out_chunk_list, list) {\n\t\t__u16 sid;\n\n\t\tsid = sctp_chunk_stream_no(ch);\n\t\tsoute = SCTP_SO(stream, sid)->ext;\n\t\tif (soute)\n\t\t\tsctp_sched_rr_sched(stream, soute);\n\t}\n}\n\nstatic void sctp_sched_rr_unsched_all(struct sctp_stream *stream)\n{\n\tstruct sctp_stream_out_ext *soute, *tmp;\n\n\tlist_for_each_entry_safe(soute, tmp, &stream->rr_list, rr_list)\n\t\tsctp_sched_rr_unsched(stream, soute);\n}\n\nstatic struct sctp_sched_ops sctp_sched_rr = {\n\t.set = sctp_sched_rr_set,\n\t.get = sctp_sched_rr_get,\n\t.init = sctp_sched_rr_init,\n\t.init_sid = sctp_sched_rr_init_sid,\n\t.free_sid = sctp_sched_rr_free_sid,\n\t.enqueue = sctp_sched_rr_enqueue,\n\t.dequeue = sctp_sched_rr_dequeue,\n\t.dequeue_done = sctp_sched_rr_dequeue_done,\n\t.sched_all = sctp_sched_rr_sched_all,\n\t.unsched_all = sctp_sched_rr_unsched_all,\n};\n\nvoid sctp_sched_ops_rr_init(void)\n{\n\tsctp_sched_ops_register(SCTP_SS_RR, &sctp_sched_rr);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}