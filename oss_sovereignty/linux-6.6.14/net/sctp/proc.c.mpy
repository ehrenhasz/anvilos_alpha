{
  "module_name": "proc.c",
  "hash_id": "08a36e750d4e2b1e24483587f3584ac64042ccdf928173c49e893e224cac84a7",
  "original_prompt": "Ingested from linux-6.6.14/net/sctp/proc.c",
  "human_readable_source": "\n \n\n#include <linux/types.h>\n#include <linux/seq_file.h>\n#include <linux/init.h>\n#include <linux/export.h>\n#include <net/sctp/sctp.h>\n#include <net/ip.h>  \n\nstatic const struct snmp_mib sctp_snmp_list[] = {\n\tSNMP_MIB_ITEM(\"SctpCurrEstab\", SCTP_MIB_CURRESTAB),\n\tSNMP_MIB_ITEM(\"SctpActiveEstabs\", SCTP_MIB_ACTIVEESTABS),\n\tSNMP_MIB_ITEM(\"SctpPassiveEstabs\", SCTP_MIB_PASSIVEESTABS),\n\tSNMP_MIB_ITEM(\"SctpAborteds\", SCTP_MIB_ABORTEDS),\n\tSNMP_MIB_ITEM(\"SctpShutdowns\", SCTP_MIB_SHUTDOWNS),\n\tSNMP_MIB_ITEM(\"SctpOutOfBlues\", SCTP_MIB_OUTOFBLUES),\n\tSNMP_MIB_ITEM(\"SctpChecksumErrors\", SCTP_MIB_CHECKSUMERRORS),\n\tSNMP_MIB_ITEM(\"SctpOutCtrlChunks\", SCTP_MIB_OUTCTRLCHUNKS),\n\tSNMP_MIB_ITEM(\"SctpOutOrderChunks\", SCTP_MIB_OUTORDERCHUNKS),\n\tSNMP_MIB_ITEM(\"SctpOutUnorderChunks\", SCTP_MIB_OUTUNORDERCHUNKS),\n\tSNMP_MIB_ITEM(\"SctpInCtrlChunks\", SCTP_MIB_INCTRLCHUNKS),\n\tSNMP_MIB_ITEM(\"SctpInOrderChunks\", SCTP_MIB_INORDERCHUNKS),\n\tSNMP_MIB_ITEM(\"SctpInUnorderChunks\", SCTP_MIB_INUNORDERCHUNKS),\n\tSNMP_MIB_ITEM(\"SctpFragUsrMsgs\", SCTP_MIB_FRAGUSRMSGS),\n\tSNMP_MIB_ITEM(\"SctpReasmUsrMsgs\", SCTP_MIB_REASMUSRMSGS),\n\tSNMP_MIB_ITEM(\"SctpOutSCTPPacks\", SCTP_MIB_OUTSCTPPACKS),\n\tSNMP_MIB_ITEM(\"SctpInSCTPPacks\", SCTP_MIB_INSCTPPACKS),\n\tSNMP_MIB_ITEM(\"SctpT1InitExpireds\", SCTP_MIB_T1_INIT_EXPIREDS),\n\tSNMP_MIB_ITEM(\"SctpT1CookieExpireds\", SCTP_MIB_T1_COOKIE_EXPIREDS),\n\tSNMP_MIB_ITEM(\"SctpT2ShutdownExpireds\", SCTP_MIB_T2_SHUTDOWN_EXPIREDS),\n\tSNMP_MIB_ITEM(\"SctpT3RtxExpireds\", SCTP_MIB_T3_RTX_EXPIREDS),\n\tSNMP_MIB_ITEM(\"SctpT4RtoExpireds\", SCTP_MIB_T4_RTO_EXPIREDS),\n\tSNMP_MIB_ITEM(\"SctpT5ShutdownGuardExpireds\", SCTP_MIB_T5_SHUTDOWN_GUARD_EXPIREDS),\n\tSNMP_MIB_ITEM(\"SctpDelaySackExpireds\", SCTP_MIB_DELAY_SACK_EXPIREDS),\n\tSNMP_MIB_ITEM(\"SctpAutocloseExpireds\", SCTP_MIB_AUTOCLOSE_EXPIREDS),\n\tSNMP_MIB_ITEM(\"SctpT3Retransmits\", SCTP_MIB_T3_RETRANSMITS),\n\tSNMP_MIB_ITEM(\"SctpPmtudRetransmits\", SCTP_MIB_PMTUD_RETRANSMITS),\n\tSNMP_MIB_ITEM(\"SctpFastRetransmits\", SCTP_MIB_FAST_RETRANSMITS),\n\tSNMP_MIB_ITEM(\"SctpInPktSoftirq\", SCTP_MIB_IN_PKT_SOFTIRQ),\n\tSNMP_MIB_ITEM(\"SctpInPktBacklog\", SCTP_MIB_IN_PKT_BACKLOG),\n\tSNMP_MIB_ITEM(\"SctpInPktDiscards\", SCTP_MIB_IN_PKT_DISCARDS),\n\tSNMP_MIB_ITEM(\"SctpInDataChunkDiscards\", SCTP_MIB_IN_DATA_CHUNK_DISCARDS),\n\tSNMP_MIB_SENTINEL\n};\n\n \nstatic int sctp_snmp_seq_show(struct seq_file *seq, void *v)\n{\n\tunsigned long buff[SCTP_MIB_MAX];\n\tstruct net *net = seq->private;\n\tint i;\n\n\tmemset(buff, 0, sizeof(unsigned long) * SCTP_MIB_MAX);\n\n\tsnmp_get_cpu_field_batch(buff, sctp_snmp_list,\n\t\t\t\t net->sctp.sctp_statistics);\n\tfor (i = 0; sctp_snmp_list[i].name; i++)\n\t\tseq_printf(seq, \"%-32s\\t%ld\\n\", sctp_snmp_list[i].name,\n\t\t\t\t\t\tbuff[i]);\n\n\treturn 0;\n}\n\n \nstatic void sctp_seq_dump_local_addrs(struct seq_file *seq, struct sctp_ep_common *epb)\n{\n\tstruct sctp_association *asoc;\n\tstruct sctp_sockaddr_entry *laddr;\n\tstruct sctp_transport *peer;\n\tunion sctp_addr *addr, *primary = NULL;\n\tstruct sctp_af *af;\n\n\tif (epb->type == SCTP_EP_TYPE_ASSOCIATION) {\n\t\tasoc = sctp_assoc(epb);\n\n\t\tpeer = asoc->peer.primary_path;\n\t\tif (unlikely(peer == NULL)) {\n\t\t\tWARN(1, \"Association %p with NULL primary path!\\n\", asoc);\n\t\t\treturn;\n\t\t}\n\n\t\tprimary = &peer->saddr;\n\t}\n\n\trcu_read_lock();\n\tlist_for_each_entry_rcu(laddr, &epb->bind_addr.address_list, list) {\n\t\tif (!laddr->valid)\n\t\t\tcontinue;\n\n\t\taddr = &laddr->a;\n\t\taf = sctp_get_af_specific(addr->sa.sa_family);\n\t\tif (primary && af->cmp_addr(addr, primary)) {\n\t\t\tseq_printf(seq, \"*\");\n\t\t}\n\t\taf->seq_dump_addr(seq, addr);\n\t}\n\trcu_read_unlock();\n}\n\n \nstatic void sctp_seq_dump_remote_addrs(struct seq_file *seq, struct sctp_association *assoc)\n{\n\tstruct sctp_transport *transport;\n\tunion sctp_addr *addr, *primary;\n\tstruct sctp_af *af;\n\n\tprimary = &assoc->peer.primary_addr;\n\tlist_for_each_entry_rcu(transport, &assoc->peer.transport_addr_list,\n\t\t\ttransports) {\n\t\taddr = &transport->ipaddr;\n\n\t\taf = sctp_get_af_specific(addr->sa.sa_family);\n\t\tif (af->cmp_addr(addr, primary)) {\n\t\t\tseq_printf(seq, \"*\");\n\t\t}\n\t\taf->seq_dump_addr(seq, addr);\n\t}\n}\n\nstatic void *sctp_eps_seq_start(struct seq_file *seq, loff_t *pos)\n{\n\tif (*pos >= sctp_ep_hashsize)\n\t\treturn NULL;\n\n\tif (*pos < 0)\n\t\t*pos = 0;\n\n\tif (*pos == 0)\n\t\tseq_printf(seq, \" ENDPT     SOCK   STY SST HBKT LPORT   UID INODE LADDRS\\n\");\n\n\treturn (void *)pos;\n}\n\nstatic void sctp_eps_seq_stop(struct seq_file *seq, void *v)\n{\n}\n\n\nstatic void *sctp_eps_seq_next(struct seq_file *seq, void *v, loff_t *pos)\n{\n\tif (++*pos >= sctp_ep_hashsize)\n\t\treturn NULL;\n\n\treturn pos;\n}\n\n\n \nstatic int sctp_eps_seq_show(struct seq_file *seq, void *v)\n{\n\tstruct sctp_hashbucket *head;\n\tstruct sctp_endpoint *ep;\n\tstruct sock *sk;\n\tint    hash = *(loff_t *)v;\n\n\tif (hash >= sctp_ep_hashsize)\n\t\treturn -ENOMEM;\n\n\thead = &sctp_ep_hashtable[hash];\n\tread_lock_bh(&head->lock);\n\tsctp_for_each_hentry(ep, &head->chain) {\n\t\tsk = ep->base.sk;\n\t\tif (!net_eq(sock_net(sk), seq_file_net(seq)))\n\t\t\tcontinue;\n\t\tseq_printf(seq, \"%8pK %8pK %-3d %-3d %-4d %-5d %5u %5lu \", ep, sk,\n\t\t\t   sctp_sk(sk)->type, sk->sk_state, hash,\n\t\t\t   ep->base.bind_addr.port,\n\t\t\t   from_kuid_munged(seq_user_ns(seq), sock_i_uid(sk)),\n\t\t\t   sock_i_ino(sk));\n\n\t\tsctp_seq_dump_local_addrs(seq, &ep->base);\n\t\tseq_printf(seq, \"\\n\");\n\t}\n\tread_unlock_bh(&head->lock);\n\n\treturn 0;\n}\n\nstatic const struct seq_operations sctp_eps_ops = {\n\t.start = sctp_eps_seq_start,\n\t.next  = sctp_eps_seq_next,\n\t.stop  = sctp_eps_seq_stop,\n\t.show  = sctp_eps_seq_show,\n};\n\nstruct sctp_ht_iter {\n\tstruct seq_net_private p;\n\tstruct rhashtable_iter hti;\n};\n\nstatic void *sctp_transport_seq_start(struct seq_file *seq, loff_t *pos)\n{\n\tstruct sctp_ht_iter *iter = seq->private;\n\n\tsctp_transport_walk_start(&iter->hti);\n\n\treturn sctp_transport_get_idx(seq_file_net(seq), &iter->hti, *pos);\n}\n\nstatic void sctp_transport_seq_stop(struct seq_file *seq, void *v)\n{\n\tstruct sctp_ht_iter *iter = seq->private;\n\n\tif (v && v != SEQ_START_TOKEN) {\n\t\tstruct sctp_transport *transport = v;\n\n\t\tsctp_transport_put(transport);\n\t}\n\n\tsctp_transport_walk_stop(&iter->hti);\n}\n\nstatic void *sctp_transport_seq_next(struct seq_file *seq, void *v, loff_t *pos)\n{\n\tstruct sctp_ht_iter *iter = seq->private;\n\n\tif (v && v != SEQ_START_TOKEN) {\n\t\tstruct sctp_transport *transport = v;\n\n\t\tsctp_transport_put(transport);\n\t}\n\n\t++*pos;\n\n\treturn sctp_transport_get_next(seq_file_net(seq), &iter->hti);\n}\n\n \nstatic int sctp_assocs_seq_show(struct seq_file *seq, void *v)\n{\n\tstruct sctp_transport *transport;\n\tstruct sctp_association *assoc;\n\tstruct sctp_ep_common *epb;\n\tstruct sock *sk;\n\n\tif (v == SEQ_START_TOKEN) {\n\t\tseq_printf(seq, \" ASSOC     SOCK   STY SST ST HBKT \"\n\t\t\t\t\"ASSOC-ID TX_QUEUE RX_QUEUE UID INODE LPORT \"\n\t\t\t\t\"RPORT LADDRS <-> RADDRS \"\n\t\t\t\t\"HBINT INS OUTS MAXRT T1X T2X RTXC \"\n\t\t\t\t\"wmema wmemq sndbuf rcvbuf\\n\");\n\t\treturn 0;\n\t}\n\n\ttransport = (struct sctp_transport *)v;\n\tassoc = transport->asoc;\n\tepb = &assoc->base;\n\tsk = epb->sk;\n\n\tseq_printf(seq,\n\t\t   \"%8pK %8pK %-3d %-3d %-2d %-4d \"\n\t\t   \"%4d %8d %8d %7u %5lu %-5d %5d \",\n\t\t   assoc, sk, sctp_sk(sk)->type, sk->sk_state,\n\t\t   assoc->state, 0,\n\t\t   assoc->assoc_id,\n\t\t   assoc->sndbuf_used,\n\t\t   atomic_read(&assoc->rmem_alloc),\n\t\t   from_kuid_munged(seq_user_ns(seq), sock_i_uid(sk)),\n\t\t   sock_i_ino(sk),\n\t\t   epb->bind_addr.port,\n\t\t   assoc->peer.port);\n\tseq_printf(seq, \" \");\n\tsctp_seq_dump_local_addrs(seq, epb);\n\tseq_printf(seq, \"<-> \");\n\tsctp_seq_dump_remote_addrs(seq, assoc);\n\tseq_printf(seq, \"\\t%8lu %5d %5d %4d %4d %4d %8d \"\n\t\t   \"%8d %8d %8d %8d\",\n\t\tassoc->hbinterval, assoc->stream.incnt,\n\t\tassoc->stream.outcnt, assoc->max_retrans,\n\t\tassoc->init_retries, assoc->shutdown_retries,\n\t\tassoc->rtx_data_chunks,\n\t\trefcount_read(&sk->sk_wmem_alloc),\n\t\tREAD_ONCE(sk->sk_wmem_queued),\n\t\tsk->sk_sndbuf,\n\t\tsk->sk_rcvbuf);\n\tseq_printf(seq, \"\\n\");\n\n\treturn 0;\n}\n\nstatic const struct seq_operations sctp_assoc_ops = {\n\t.start = sctp_transport_seq_start,\n\t.next  = sctp_transport_seq_next,\n\t.stop  = sctp_transport_seq_stop,\n\t.show  = sctp_assocs_seq_show,\n};\n\nstatic int sctp_remaddr_seq_show(struct seq_file *seq, void *v)\n{\n\tstruct sctp_association *assoc;\n\tstruct sctp_transport *transport, *tsp;\n\n\tif (v == SEQ_START_TOKEN) {\n\t\tseq_printf(seq, \"ADDR ASSOC_ID HB_ACT RTO MAX_PATH_RTX \"\n\t\t\t\t\"REM_ADDR_RTX START STATE\\n\");\n\t\treturn 0;\n\t}\n\n\ttransport = (struct sctp_transport *)v;\n\tassoc = transport->asoc;\n\n\tlist_for_each_entry_rcu(tsp, &assoc->peer.transport_addr_list,\n\t\t\t\ttransports) {\n\t\t \n\t\ttsp->af_specific->seq_dump_addr(seq, &tsp->ipaddr);\n\t\tseq_printf(seq, \" \");\n\t\t \n\t\tseq_printf(seq, \"%d \", tsp->asoc->assoc_id);\n\n\t\t \n\t\tseq_printf(seq, \"%d \", timer_pending(&tsp->hb_timer));\n\n\t\t \n\t\tseq_printf(seq, \"%lu \", tsp->rto);\n\n\t\t \n\t\tseq_printf(seq, \"%d \", tsp->pathmaxrxt);\n\n\t\t \n\t\tseq_puts(seq, \"0 \");\n\n\t\t \n\t\tseq_puts(seq, \"0 \");\n\n\t\t \n\t\tseq_printf(seq, \"%d\", tsp->state);\n\n\t\tseq_printf(seq, \"\\n\");\n\t}\n\n\treturn 0;\n}\n\nstatic const struct seq_operations sctp_remaddr_ops = {\n\t.start = sctp_transport_seq_start,\n\t.next  = sctp_transport_seq_next,\n\t.stop  = sctp_transport_seq_stop,\n\t.show  = sctp_remaddr_seq_show,\n};\n\n \nint __net_init sctp_proc_init(struct net *net)\n{\n\tnet->sctp.proc_net_sctp = proc_net_mkdir(net, \"sctp\", net->proc_net);\n\tif (!net->sctp.proc_net_sctp)\n\t\treturn -ENOMEM;\n\tif (!proc_create_net_single(\"snmp\", 0444, net->sctp.proc_net_sctp,\n\t\t\t sctp_snmp_seq_show, NULL))\n\t\tgoto cleanup;\n\tif (!proc_create_net(\"eps\", 0444, net->sctp.proc_net_sctp,\n\t\t\t&sctp_eps_ops, sizeof(struct seq_net_private)))\n\t\tgoto cleanup;\n\tif (!proc_create_net(\"assocs\", 0444, net->sctp.proc_net_sctp,\n\t\t\t&sctp_assoc_ops, sizeof(struct sctp_ht_iter)))\n\t\tgoto cleanup;\n\tif (!proc_create_net(\"remaddr\", 0444, net->sctp.proc_net_sctp,\n\t\t\t&sctp_remaddr_ops, sizeof(struct sctp_ht_iter)))\n\t\tgoto cleanup;\n\treturn 0;\n\ncleanup:\n\tremove_proc_subtree(\"sctp\", net->proc_net);\n\tnet->sctp.proc_net_sctp = NULL;\n\treturn -ENOMEM;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}