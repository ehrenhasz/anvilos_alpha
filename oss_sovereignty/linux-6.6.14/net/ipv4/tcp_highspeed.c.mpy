{
  "module_name": "tcp_highspeed.c",
  "hash_id": "78bff94f66e82e4a5c7e201ffbdbc940c69d0ae812ef3779b98fe0337c424f42",
  "original_prompt": "Ingested from linux-6.6.14/net/ipv4/tcp_highspeed.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <net/tcp.h>\n\n \nstatic const struct hstcp_aimd_val {\n\tunsigned int cwnd;\n\tunsigned int md;\n} hstcp_aimd_vals[] = {\n\t{     38,  128,   },\n\t{    118,  112,   },\n\t{    221,  104,   },\n\t{    347,   98,   },\n\t{    495,   93,   },\n\t{    663,   89,   },\n\t{    851,   86,   },\n\t{   1058,   83,   },\n\t{   1284,   81,   },\n\t{   1529,   78,   },\n\t{   1793,   76,   },\n\t{   2076,   74,   },\n\t{   2378,   72,   },\n\t{   2699,   71,   },\n\t{   3039,   69,   },\n\t{   3399,   68,   },\n\t{   3778,   66,   },\n\t{   4177,   65,   },\n\t{   4596,   64,   },\n\t{   5036,   62,   },\n\t{   5497,   61,   },\n\t{   5979,   60,   },\n\t{   6483,   59,   },\n\t{   7009,   58,   },\n\t{   7558,   57,   },\n\t{   8130,   56,   },\n\t{   8726,   55,   },\n\t{   9346,   54,   },\n\t{   9991,   53,   },\n\t{  10661,   52,   },\n\t{  11358,   52,   },\n\t{  12082,   51,   },\n\t{  12834,   50,   },\n\t{  13614,   49,   },\n\t{  14424,   48,   },\n\t{  15265,   48,   },\n\t{  16137,   47,   },\n\t{  17042,   46,   },\n\t{  17981,   45,   },\n\t{  18955,   45,   },\n\t{  19965,   44,   },\n\t{  21013,   43,   },\n\t{  22101,   43,   },\n\t{  23230,   42,   },\n\t{  24402,   41,   },\n\t{  25618,   41,   },\n\t{  26881,   40,   },\n\t{  28193,   39,   },\n\t{  29557,   39,   },\n\t{  30975,   38,   },\n\t{  32450,   38,   },\n\t{  33986,   37,   },\n\t{  35586,   36,   },\n\t{  37253,   36,   },\n\t{  38992,   35,   },\n\t{  40808,   35,   },\n\t{  42707,   34,   },\n\t{  44694,   33,   },\n\t{  46776,   33,   },\n\t{  48961,   32,   },\n\t{  51258,   32,   },\n\t{  53677,   31,   },\n\t{  56230,   30,   },\n\t{  58932,   30,   },\n\t{  61799,   29,   },\n\t{  64851,   28,   },\n\t{  68113,   28,   },\n\t{  71617,   27,   },\n\t{  75401,   26,   },\n\t{  79517,   26,   },\n\t{  84035,   25,   },\n\t{  89053,   24,   },\n};\n\n#define HSTCP_AIMD_MAX\tARRAY_SIZE(hstcp_aimd_vals)\n\nstruct hstcp {\n\tu32\tai;\n};\n\nstatic void hstcp_init(struct sock *sk)\n{\n\tstruct tcp_sock *tp = tcp_sk(sk);\n\tstruct hstcp *ca = inet_csk_ca(sk);\n\n\tca->ai = 0;\n\n\t \n\ttp->snd_cwnd_clamp = min_t(u32, tp->snd_cwnd_clamp, 0xffffffff/128);\n}\n\nstatic void hstcp_cong_avoid(struct sock *sk, u32 ack, u32 acked)\n{\n\tstruct tcp_sock *tp = tcp_sk(sk);\n\tstruct hstcp *ca = inet_csk_ca(sk);\n\n\tif (!tcp_is_cwnd_limited(sk))\n\t\treturn;\n\n\tif (tcp_in_slow_start(tp))\n\t\ttcp_slow_start(tp, acked);\n\telse {\n\t\t \n\t\tif (tcp_snd_cwnd(tp) > hstcp_aimd_vals[ca->ai].cwnd) {\n\t\t\twhile (tcp_snd_cwnd(tp) > hstcp_aimd_vals[ca->ai].cwnd &&\n\t\t\t       ca->ai < HSTCP_AIMD_MAX - 1)\n\t\t\t\tca->ai++;\n\t\t} else if (ca->ai && tcp_snd_cwnd(tp) <= hstcp_aimd_vals[ca->ai-1].cwnd) {\n\t\t\twhile (ca->ai && tcp_snd_cwnd(tp) <= hstcp_aimd_vals[ca->ai-1].cwnd)\n\t\t\t\tca->ai--;\n\t\t}\n\n\t\t \n\t\tif (tcp_snd_cwnd(tp) < tp->snd_cwnd_clamp) {\n\t\t\t \n\t\t\ttp->snd_cwnd_cnt += ca->ai + 1;\n\t\t\tif (tp->snd_cwnd_cnt >= tcp_snd_cwnd(tp)) {\n\t\t\t\ttp->snd_cwnd_cnt -= tcp_snd_cwnd(tp);\n\t\t\t\ttcp_snd_cwnd_set(tp, tcp_snd_cwnd(tp) + 1);\n\t\t\t}\n\t\t}\n\t}\n}\n\nstatic u32 hstcp_ssthresh(struct sock *sk)\n{\n\tconst struct tcp_sock *tp = tcp_sk(sk);\n\tstruct hstcp *ca = inet_csk_ca(sk);\n\n\t \n\treturn max(tcp_snd_cwnd(tp) - ((tcp_snd_cwnd(tp) * hstcp_aimd_vals[ca->ai].md) >> 8), 2U);\n}\n\nstatic struct tcp_congestion_ops tcp_highspeed __read_mostly = {\n\t.init\t\t= hstcp_init,\n\t.ssthresh\t= hstcp_ssthresh,\n\t.undo_cwnd\t= tcp_reno_undo_cwnd,\n\t.cong_avoid\t= hstcp_cong_avoid,\n\n\t.owner\t\t= THIS_MODULE,\n\t.name\t\t= \"highspeed\"\n};\n\nstatic int __init hstcp_register(void)\n{\n\tBUILD_BUG_ON(sizeof(struct hstcp) > ICSK_CA_PRIV_SIZE);\n\treturn tcp_register_congestion_control(&tcp_highspeed);\n}\n\nstatic void __exit hstcp_unregister(void)\n{\n\ttcp_unregister_congestion_control(&tcp_highspeed);\n}\n\nmodule_init(hstcp_register);\nmodule_exit(hstcp_unregister);\n\nMODULE_AUTHOR(\"John Heffner\");\nMODULE_LICENSE(\"GPL\");\nMODULE_DESCRIPTION(\"High Speed TCP\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}