{
  "module_name": "sockopt.c",
  "hash_id": "bcbf1510ff6a955cc0e2e46830672954bfc47735c3c0a37b0ee2daa57a325ee1",
  "original_prompt": "Ingested from linux-6.6.14/net/ipv4/bpfilter/sockopt.c",
  "human_readable_source": "\n#include <linux/init.h>\n#include <linux/module.h>\n#include <linux/uaccess.h>\n#include <linux/bpfilter.h>\n#include <uapi/linux/bpf.h>\n#include <linux/wait.h>\n#include <linux/kmod.h>\n#include <linux/fs.h>\n#include <linux/file.h>\n\nstruct bpfilter_umh_ops bpfilter_ops;\nEXPORT_SYMBOL_GPL(bpfilter_ops);\n\nstatic int bpfilter_mbox_request(struct sock *sk, int optname, sockptr_t optval,\n\t\t\t\t unsigned int optlen, bool is_set)\n{\n\tint err;\n\tmutex_lock(&bpfilter_ops.lock);\n\tif (!bpfilter_ops.sockopt) {\n\t\tmutex_unlock(&bpfilter_ops.lock);\n\t\trequest_module(\"bpfilter\");\n\t\tmutex_lock(&bpfilter_ops.lock);\n\n\t\tif (!bpfilter_ops.sockopt) {\n\t\t\terr = -ENOPROTOOPT;\n\t\t\tgoto out;\n\t\t}\n\t}\n\tif (bpfilter_ops.info.tgid &&\n\t    thread_group_exited(bpfilter_ops.info.tgid))\n\t\tumd_cleanup_helper(&bpfilter_ops.info);\n\n\tif (!bpfilter_ops.info.tgid) {\n\t\terr = bpfilter_ops.start();\n\t\tif (err)\n\t\t\tgoto out;\n\t}\n\terr = bpfilter_ops.sockopt(sk, optname, optval, optlen, is_set);\nout:\n\tmutex_unlock(&bpfilter_ops.lock);\n\treturn err;\n}\n\nint bpfilter_ip_set_sockopt(struct sock *sk, int optname, sockptr_t optval,\n\t\t\t    unsigned int optlen)\n{\n\treturn bpfilter_mbox_request(sk, optname, optval, optlen, true);\n}\n\nint bpfilter_ip_get_sockopt(struct sock *sk, int optname, char __user *optval,\n\t\t\t    int __user *optlen)\n{\n\tint len;\n\n\tif (get_user(len, optlen))\n\t\treturn -EFAULT;\n\n\treturn bpfilter_mbox_request(sk, optname, USER_SOCKPTR(optval), len,\n\t\t\t\t     false);\n}\n\nstatic int __init bpfilter_sockopt_init(void)\n{\n\tmutex_init(&bpfilter_ops.lock);\n\tbpfilter_ops.info.tgid = NULL;\n\tbpfilter_ops.info.driver_name = \"bpfilter_umh\";\n\n\treturn 0;\n}\ndevice_initcall(bpfilter_sockopt_init);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}