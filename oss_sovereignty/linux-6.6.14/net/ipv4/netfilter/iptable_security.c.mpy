{
  "module_name": "iptable_security.c",
  "hash_id": "42bdec8e972385a92a5bb103c9f40b3682d2f1cd9764485d7c1954782e4673b4",
  "original_prompt": "Ingested from linux-6.6.14/net/ipv4/netfilter/iptable_security.c",
  "human_readable_source": "\n \n#include <linux/module.h>\n#include <linux/netfilter_ipv4/ip_tables.h>\n#include <linux/slab.h>\n#include <net/ip.h>\n\nMODULE_LICENSE(\"GPL\");\nMODULE_AUTHOR(\"James Morris <jmorris <at> redhat.com>\");\nMODULE_DESCRIPTION(\"iptables security table, for MAC rules\");\n\n#define SECURITY_VALID_HOOKS\t(1 << NF_INET_LOCAL_IN) | \\\n\t\t\t\t(1 << NF_INET_FORWARD) | \\\n\t\t\t\t(1 << NF_INET_LOCAL_OUT)\n\nstatic const struct xt_table security_table = {\n\t.name\t\t= \"security\",\n\t.valid_hooks\t= SECURITY_VALID_HOOKS,\n\t.me\t\t= THIS_MODULE,\n\t.af\t\t= NFPROTO_IPV4,\n\t.priority\t= NF_IP_PRI_SECURITY,\n};\n\nstatic struct nf_hook_ops *sectbl_ops __read_mostly;\n\nstatic int iptable_security_table_init(struct net *net)\n{\n\tstruct ipt_replace *repl;\n\tint ret;\n\n\trepl = ipt_alloc_initial_table(&security_table);\n\tif (repl == NULL)\n\t\treturn -ENOMEM;\n\tret = ipt_register_table(net, &security_table, repl, sectbl_ops);\n\tkfree(repl);\n\treturn ret;\n}\n\nstatic void __net_exit iptable_security_net_pre_exit(struct net *net)\n{\n\tipt_unregister_table_pre_exit(net, \"security\");\n}\n\nstatic void __net_exit iptable_security_net_exit(struct net *net)\n{\n\tipt_unregister_table_exit(net, \"security\");\n}\n\nstatic struct pernet_operations iptable_security_net_ops = {\n\t.pre_exit = iptable_security_net_pre_exit,\n\t.exit = iptable_security_net_exit,\n};\n\nstatic int __init iptable_security_init(void)\n{\n\tint ret = xt_register_template(&security_table,\n\t\t\t\t       iptable_security_table_init);\n\n\tif (ret < 0)\n\t\treturn ret;\n\n\tsectbl_ops = xt_hook_ops_alloc(&security_table, ipt_do_table);\n\tif (IS_ERR(sectbl_ops)) {\n\t\txt_unregister_template(&security_table);\n\t\treturn PTR_ERR(sectbl_ops);\n\t}\n\n\tret = register_pernet_subsys(&iptable_security_net_ops);\n\tif (ret < 0) {\n\t\txt_unregister_template(&security_table);\n\t\tkfree(sectbl_ops);\n\t\treturn ret;\n\t}\n\n\treturn ret;\n}\n\nstatic void __exit iptable_security_fini(void)\n{\n\tunregister_pernet_subsys(&iptable_security_net_ops);\n\tkfree(sectbl_ops);\n\txt_unregister_template(&security_table);\n}\n\nmodule_init(iptable_security_init);\nmodule_exit(iptable_security_fini);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}