{
  "module_name": "iptable_raw.c",
  "hash_id": "42fe5d620cbbec2caa1e883a03cad3e2994fafd85f5d4702f35e7b4a5905512c",
  "original_prompt": "Ingested from linux-6.6.14/net/ipv4/netfilter/iptable_raw.c",
  "human_readable_source": "\n \n#define pr_fmt(fmt) KBUILD_MODNAME \": \" fmt\n#include <linux/module.h>\n#include <linux/netfilter_ipv4/ip_tables.h>\n#include <linux/slab.h>\n#include <net/ip.h>\n\n#define RAW_VALID_HOOKS ((1 << NF_INET_PRE_ROUTING) | (1 << NF_INET_LOCAL_OUT))\n\nstatic bool raw_before_defrag __read_mostly;\nMODULE_PARM_DESC(raw_before_defrag, \"Enable raw table before defrag\");\nmodule_param(raw_before_defrag, bool, 0000);\n\nstatic const struct xt_table packet_raw = {\n\t.name = \"raw\",\n\t.valid_hooks =  RAW_VALID_HOOKS,\n\t.me = THIS_MODULE,\n\t.af = NFPROTO_IPV4,\n\t.priority = NF_IP_PRI_RAW,\n};\n\nstatic const struct xt_table packet_raw_before_defrag = {\n\t.name = \"raw\",\n\t.valid_hooks =  RAW_VALID_HOOKS,\n\t.me = THIS_MODULE,\n\t.af = NFPROTO_IPV4,\n\t.priority = NF_IP_PRI_RAW_BEFORE_DEFRAG,\n};\n\nstatic struct nf_hook_ops *rawtable_ops __read_mostly;\n\nstatic int iptable_raw_table_init(struct net *net)\n{\n\tstruct ipt_replace *repl;\n\tconst struct xt_table *table = &packet_raw;\n\tint ret;\n\n\tif (raw_before_defrag)\n\t\ttable = &packet_raw_before_defrag;\n\n\trepl = ipt_alloc_initial_table(table);\n\tif (repl == NULL)\n\t\treturn -ENOMEM;\n\tret = ipt_register_table(net, table, repl, rawtable_ops);\n\tkfree(repl);\n\treturn ret;\n}\n\nstatic void __net_exit iptable_raw_net_pre_exit(struct net *net)\n{\n\tipt_unregister_table_pre_exit(net, \"raw\");\n}\n\nstatic void __net_exit iptable_raw_net_exit(struct net *net)\n{\n\tipt_unregister_table_exit(net, \"raw\");\n}\n\nstatic struct pernet_operations iptable_raw_net_ops = {\n\t.pre_exit = iptable_raw_net_pre_exit,\n\t.exit = iptable_raw_net_exit,\n};\n\nstatic int __init iptable_raw_init(void)\n{\n\tint ret;\n\tconst struct xt_table *table = &packet_raw;\n\n\tif (raw_before_defrag) {\n\t\ttable = &packet_raw_before_defrag;\n\n\t\tpr_info(\"Enabling raw table before defrag\\n\");\n\t}\n\n\tret = xt_register_template(table,\n\t\t\t\t   iptable_raw_table_init);\n\tif (ret < 0)\n\t\treturn ret;\n\n\trawtable_ops = xt_hook_ops_alloc(table, ipt_do_table);\n\tif (IS_ERR(rawtable_ops)) {\n\t\txt_unregister_template(table);\n\t\treturn PTR_ERR(rawtable_ops);\n\t}\n\n\tret = register_pernet_subsys(&iptable_raw_net_ops);\n\tif (ret < 0) {\n\t\txt_unregister_template(table);\n\t\tkfree(rawtable_ops);\n\t\treturn ret;\n\t}\n\n\treturn ret;\n}\n\nstatic void __exit iptable_raw_fini(void)\n{\n\tunregister_pernet_subsys(&iptable_raw_net_ops);\n\tkfree(rawtable_ops);\n\txt_unregister_template(&packet_raw);\n}\n\nmodule_init(iptable_raw_init);\nmodule_exit(iptable_raw_fini);\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}