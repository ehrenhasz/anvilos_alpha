{
  "module_name": "arpt_mangle.c",
  "hash_id": "2d0818c116b5e7cde8d2bb92116e26e4688c9709cd49945982831c5a235e695d",
  "original_prompt": "Ingested from linux-6.6.14/net/ipv4/netfilter/arpt_mangle.c",
  "human_readable_source": "\n \n#include <linux/module.h>\n#include <linux/netfilter.h>\n#include <linux/netfilter_arp/arpt_mangle.h>\n#include <net/sock.h>\n\nMODULE_LICENSE(\"GPL\");\nMODULE_AUTHOR(\"Bart De Schuymer <bdschuym@pandora.be>\");\nMODULE_DESCRIPTION(\"arptables arp payload mangle target\");\n\nstatic unsigned int\ntarget(struct sk_buff *skb, const struct xt_action_param *par)\n{\n\tconst struct arpt_mangle *mangle = par->targinfo;\n\tconst struct arphdr *arp;\n\tunsigned char *arpptr;\n\tint pln, hln;\n\n\tif (skb_ensure_writable(skb, skb->len))\n\t\treturn NF_DROP;\n\n\tarp = arp_hdr(skb);\n\tarpptr = skb_network_header(skb) + sizeof(*arp);\n\tpln = arp->ar_pln;\n\thln = arp->ar_hln;\n\t \n\tif (mangle->flags & ARPT_MANGLE_SDEV) {\n\t\tif (ARPT_DEV_ADDR_LEN_MAX < hln ||\n\t\t   (arpptr + hln > skb_tail_pointer(skb)))\n\t\t\treturn NF_DROP;\n\t\tmemcpy(arpptr, mangle->src_devaddr, hln);\n\t}\n\tarpptr += hln;\n\tif (mangle->flags & ARPT_MANGLE_SIP) {\n\t\tif (ARPT_MANGLE_ADDR_LEN_MAX < pln ||\n\t\t   (arpptr + pln > skb_tail_pointer(skb)))\n\t\t\treturn NF_DROP;\n\t\tmemcpy(arpptr, &mangle->u_s.src_ip, pln);\n\t}\n\tarpptr += pln;\n\tif (mangle->flags & ARPT_MANGLE_TDEV) {\n\t\tif (ARPT_DEV_ADDR_LEN_MAX < hln ||\n\t\t   (arpptr + hln > skb_tail_pointer(skb)))\n\t\t\treturn NF_DROP;\n\t\tmemcpy(arpptr, mangle->tgt_devaddr, hln);\n\t}\n\tarpptr += hln;\n\tif (mangle->flags & ARPT_MANGLE_TIP) {\n\t\tif (ARPT_MANGLE_ADDR_LEN_MAX < pln ||\n\t\t   (arpptr + pln > skb_tail_pointer(skb)))\n\t\t\treturn NF_DROP;\n\t\tmemcpy(arpptr, &mangle->u_t.tgt_ip, pln);\n\t}\n\treturn mangle->target;\n}\n\nstatic int checkentry(const struct xt_tgchk_param *par)\n{\n\tconst struct arpt_mangle *mangle = par->targinfo;\n\n\tif (mangle->flags & ~ARPT_MANGLE_MASK ||\n\t    !(mangle->flags & ARPT_MANGLE_MASK))\n\t\treturn -EINVAL;\n\n\tif (mangle->target != NF_DROP && mangle->target != NF_ACCEPT &&\n\t   mangle->target != XT_CONTINUE)\n\t\treturn -EINVAL;\n\treturn 0;\n}\n\nstatic struct xt_target arpt_mangle_reg __read_mostly = {\n\t.name\t\t= \"mangle\",\n\t.family\t\t= NFPROTO_ARP,\n\t.target\t\t= target,\n\t.targetsize\t= sizeof(struct arpt_mangle),\n\t.checkentry\t= checkentry,\n\t.me\t\t= THIS_MODULE,\n};\n\nstatic int __init arpt_mangle_init(void)\n{\n\treturn xt_register_target(&arpt_mangle_reg);\n}\n\nstatic void __exit arpt_mangle_fini(void)\n{\n\txt_unregister_target(&arpt_mangle_reg);\n}\n\nmodule_init(arpt_mangle_init);\nmodule_exit(arpt_mangle_fini);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}