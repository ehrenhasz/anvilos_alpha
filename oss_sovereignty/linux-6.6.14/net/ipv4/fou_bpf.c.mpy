{
  "module_name": "fou_bpf.c",
  "hash_id": "1ad1d76b7dbaced0dd7930b85d02d1bdf7b17166aad47214ccea45b804840615",
  "original_prompt": "Ingested from linux-6.6.14/net/ipv4/fou_bpf.c",
  "human_readable_source": "\n \n\n#include <linux/bpf.h>\n#include <linux/btf_ids.h>\n\n#include <net/dst_metadata.h>\n#include <net/fou.h>\n\nstruct bpf_fou_encap {\n\t__be16 sport;\n\t__be16 dport;\n};\n\nenum bpf_fou_encap_type {\n\tFOU_BPF_ENCAP_FOU,\n\tFOU_BPF_ENCAP_GUE,\n};\n\n__diag_push();\n__diag_ignore_all(\"-Wmissing-prototypes\",\n\t\t  \"Global functions as their definitions will be in BTF\");\n\n \n__bpf_kfunc int bpf_skb_set_fou_encap(struct __sk_buff *skb_ctx,\n\t\t\t\t      struct bpf_fou_encap *encap, int type)\n{\n\tstruct sk_buff *skb = (struct sk_buff *)skb_ctx;\n\tstruct ip_tunnel_info *info = skb_tunnel_info(skb);\n\n\tif (unlikely(!encap))\n\t\treturn -EINVAL;\n\n\tif (unlikely(!info || !(info->mode & IP_TUNNEL_INFO_TX)))\n\t\treturn -EINVAL;\n\n\tswitch (type) {\n\tcase FOU_BPF_ENCAP_FOU:\n\t\tinfo->encap.type = TUNNEL_ENCAP_FOU;\n\t\tbreak;\n\tcase FOU_BPF_ENCAP_GUE:\n\t\tinfo->encap.type = TUNNEL_ENCAP_GUE;\n\t\tbreak;\n\tdefault:\n\t\tinfo->encap.type = TUNNEL_ENCAP_NONE;\n\t}\n\n\tif (info->key.tun_flags & TUNNEL_CSUM)\n\t\tinfo->encap.flags |= TUNNEL_ENCAP_FLAG_CSUM;\n\n\tinfo->encap.sport = encap->sport;\n\tinfo->encap.dport = encap->dport;\n\n\treturn 0;\n}\n\n \n__bpf_kfunc int bpf_skb_get_fou_encap(struct __sk_buff *skb_ctx,\n\t\t\t\t      struct bpf_fou_encap *encap)\n{\n\tstruct sk_buff *skb = (struct sk_buff *)skb_ctx;\n\tstruct ip_tunnel_info *info = skb_tunnel_info(skb);\n\n\tif (unlikely(!info))\n\t\treturn -EINVAL;\n\n\tencap->sport = info->encap.sport;\n\tencap->dport = info->encap.dport;\n\n\treturn 0;\n}\n\n__diag_pop()\n\nBTF_SET8_START(fou_kfunc_set)\nBTF_ID_FLAGS(func, bpf_skb_set_fou_encap)\nBTF_ID_FLAGS(func, bpf_skb_get_fou_encap)\nBTF_SET8_END(fou_kfunc_set)\n\nstatic const struct btf_kfunc_id_set fou_bpf_kfunc_set = {\n\t.owner = THIS_MODULE,\n\t.set   = &fou_kfunc_set,\n};\n\nint register_fou_bpf(void)\n{\n\treturn register_btf_kfunc_id_set(BPF_PROG_TYPE_SCHED_CLS,\n\t\t\t\t\t &fou_bpf_kfunc_set);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}