{
  "module_name": "sysctl.c",
  "hash_id": "f882832d1a75acbccdb11d01a7dd4f093f4e819f8e6a6328318c69020ebb8592",
  "original_prompt": "Ingested from linux-6.6.14/net/phonet/sysctl.c",
  "human_readable_source": "\n \n\n#include <linux/seqlock.h>\n#include <linux/sysctl.h>\n#include <linux/errno.h>\n#include <linux/init.h>\n\n#include <net/sock.h>\n#include <linux/phonet.h>\n#include <net/phonet/phonet.h>\n\n#define DYNAMIC_PORT_MIN\t0x40\n#define DYNAMIC_PORT_MAX\t0x7f\n\nstatic DEFINE_SEQLOCK(local_port_range_lock);\nstatic int local_port_range_min[2] = {0, 0};\nstatic int local_port_range_max[2] = {1023, 1023};\nstatic int local_port_range[2] = {DYNAMIC_PORT_MIN, DYNAMIC_PORT_MAX};\nstatic struct ctl_table_header *phonet_table_hrd;\n\nstatic void set_local_port_range(int range[2])\n{\n\twrite_seqlock(&local_port_range_lock);\n\tlocal_port_range[0] = range[0];\n\tlocal_port_range[1] = range[1];\n\twrite_sequnlock(&local_port_range_lock);\n}\n\nvoid phonet_get_local_port_range(int *min, int *max)\n{\n\tunsigned int seq;\n\n\tdo {\n\t\tseq = read_seqbegin(&local_port_range_lock);\n\t\tif (min)\n\t\t\t*min = local_port_range[0];\n\t\tif (max)\n\t\t\t*max = local_port_range[1];\n\t} while (read_seqretry(&local_port_range_lock, seq));\n}\n\nstatic int proc_local_port_range(struct ctl_table *table, int write,\n\t\t\t\t void *buffer, size_t *lenp, loff_t *ppos)\n{\n\tint ret;\n\tint range[2] = {local_port_range[0], local_port_range[1]};\n\tstruct ctl_table tmp = {\n\t\t.data = &range,\n\t\t.maxlen = sizeof(range),\n\t\t.mode = table->mode,\n\t\t.extra1 = &local_port_range_min,\n\t\t.extra2 = &local_port_range_max,\n\t};\n\n\tret = proc_dointvec_minmax(&tmp, write, buffer, lenp, ppos);\n\n\tif (write && ret == 0) {\n\t\tif (range[1] < range[0])\n\t\t\tret = -EINVAL;\n\t\telse\n\t\t\tset_local_port_range(range);\n\t}\n\n\treturn ret;\n}\n\nstatic struct ctl_table phonet_table[] = {\n\t{\n\t\t.procname\t= \"local_port_range\",\n\t\t.data\t\t= &local_port_range,\n\t\t.maxlen\t\t= sizeof(local_port_range),\n\t\t.mode\t\t= 0644,\n\t\t.proc_handler\t= proc_local_port_range,\n\t},\n\t{ }\n};\n\nint __init phonet_sysctl_init(void)\n{\n\tphonet_table_hrd = register_net_sysctl(&init_net, \"net/phonet\", phonet_table);\n\treturn phonet_table_hrd == NULL ? -ENOMEM : 0;\n}\n\nvoid phonet_sysctl_exit(void)\n{\n\tunregister_net_sysctl_table(phonet_table_hrd);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}