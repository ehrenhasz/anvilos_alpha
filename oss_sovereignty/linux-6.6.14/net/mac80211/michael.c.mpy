{
  "module_name": "michael.c",
  "hash_id": "83f56ece41cfc85a9e34121c4bf68411a5fd008217d5095b0b0dc5b6e5c536c6",
  "original_prompt": "Ingested from linux-6.6.14/net/mac80211/michael.c",
  "human_readable_source": "\n \n#include <linux/types.h>\n#include <linux/bitops.h>\n#include <linux/ieee80211.h>\n#include <asm/unaligned.h>\n\n#include \"michael.h\"\n\nstatic void michael_block(struct michael_mic_ctx *mctx, u32 val)\n{\n\tmctx->l ^= val;\n\tmctx->r ^= rol32(mctx->l, 17);\n\tmctx->l += mctx->r;\n\tmctx->r ^= ((mctx->l & 0xff00ff00) >> 8) |\n\t\t   ((mctx->l & 0x00ff00ff) << 8);\n\tmctx->l += mctx->r;\n\tmctx->r ^= rol32(mctx->l, 3);\n\tmctx->l += mctx->r;\n\tmctx->r ^= ror32(mctx->l, 2);\n\tmctx->l += mctx->r;\n}\n\nstatic void michael_mic_hdr(struct michael_mic_ctx *mctx, const u8 *key,\n\t\t\t    struct ieee80211_hdr *hdr)\n{\n\tu8 *da, *sa, tid;\n\n\tda = ieee80211_get_DA(hdr);\n\tsa = ieee80211_get_SA(hdr);\n\tif (ieee80211_is_data_qos(hdr->frame_control))\n\t\ttid = ieee80211_get_tid(hdr);\n\telse\n\t\ttid = 0;\n\n\tmctx->l = get_unaligned_le32(key);\n\tmctx->r = get_unaligned_le32(key + 4);\n\n\t \n\tmichael_block(mctx, get_unaligned_le32(da));\n\tmichael_block(mctx, get_unaligned_le16(&da[4]) |\n\t\t\t    (get_unaligned_le16(sa) << 16));\n\tmichael_block(mctx, get_unaligned_le32(&sa[2]));\n\tmichael_block(mctx, tid);\n}\n\nvoid michael_mic(const u8 *key, struct ieee80211_hdr *hdr,\n\t\t const u8 *data, size_t data_len, u8 *mic)\n{\n\tu32 val;\n\tsize_t block, blocks, left;\n\tstruct michael_mic_ctx mctx;\n\n\tmichael_mic_hdr(&mctx, key, hdr);\n\n\t \n\tblocks = data_len / 4;\n\tleft = data_len % 4;\n\n\tfor (block = 0; block < blocks; block++)\n\t\tmichael_block(&mctx, get_unaligned_le32(&data[block * 4]));\n\n\t \n\tval = 0x5a;\n\twhile (left > 0) {\n\t\tval <<= 8;\n\t\tleft--;\n\t\tval |= data[blocks * 4 + left];\n\t}\n\n\tmichael_block(&mctx, val);\n\tmichael_block(&mctx, 0);\n\n\tput_unaligned_le32(mctx.l, mic);\n\tput_unaligned_le32(mctx.r, mic + 4);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}