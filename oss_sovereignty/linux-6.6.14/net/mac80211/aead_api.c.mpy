{
  "module_name": "aead_api.c",
  "hash_id": "ff78931d098639dff01c8d8c6295b7fd0ff491b76092b5dcdc0a1e0ef391c60d",
  "original_prompt": "Ingested from linux-6.6.14/net/mac80211/aead_api.c",
  "human_readable_source": "\n \n\n#include <linux/kernel.h>\n#include <linux/types.h>\n#include <linux/err.h>\n#include <linux/scatterlist.h>\n#include <crypto/aead.h>\n\n#include \"aead_api.h\"\n\nint aead_encrypt(struct crypto_aead *tfm, u8 *b_0, u8 *aad, size_t aad_len,\n\t\t u8 *data, size_t data_len, u8 *mic)\n{\n\tsize_t mic_len = crypto_aead_authsize(tfm);\n\tstruct scatterlist sg[3];\n\tstruct aead_request *aead_req;\n\tint reqsize = sizeof(*aead_req) + crypto_aead_reqsize(tfm);\n\tu8 *__aad;\n\tint ret;\n\n\taead_req = kzalloc(reqsize + aad_len, GFP_ATOMIC);\n\tif (!aead_req)\n\t\treturn -ENOMEM;\n\n\t__aad = (u8 *)aead_req + reqsize;\n\tmemcpy(__aad, aad, aad_len);\n\n\tsg_init_table(sg, 3);\n\tsg_set_buf(&sg[0], __aad, aad_len);\n\tsg_set_buf(&sg[1], data, data_len);\n\tsg_set_buf(&sg[2], mic, mic_len);\n\n\taead_request_set_tfm(aead_req, tfm);\n\taead_request_set_crypt(aead_req, sg, sg, data_len, b_0);\n\taead_request_set_ad(aead_req, sg[0].length);\n\n\tret = crypto_aead_encrypt(aead_req);\n\tkfree_sensitive(aead_req);\n\n\treturn ret;\n}\n\nint aead_decrypt(struct crypto_aead *tfm, u8 *b_0, u8 *aad, size_t aad_len,\n\t\t u8 *data, size_t data_len, u8 *mic)\n{\n\tsize_t mic_len = crypto_aead_authsize(tfm);\n\tstruct scatterlist sg[3];\n\tstruct aead_request *aead_req;\n\tint reqsize = sizeof(*aead_req) + crypto_aead_reqsize(tfm);\n\tu8 *__aad;\n\tint err;\n\n\tif (data_len == 0)\n\t\treturn -EINVAL;\n\n\taead_req = kzalloc(reqsize + aad_len, GFP_ATOMIC);\n\tif (!aead_req)\n\t\treturn -ENOMEM;\n\n\t__aad = (u8 *)aead_req + reqsize;\n\tmemcpy(__aad, aad, aad_len);\n\n\tsg_init_table(sg, 3);\n\tsg_set_buf(&sg[0], __aad, aad_len);\n\tsg_set_buf(&sg[1], data, data_len);\n\tsg_set_buf(&sg[2], mic, mic_len);\n\n\taead_request_set_tfm(aead_req, tfm);\n\taead_request_set_crypt(aead_req, sg, sg, data_len + mic_len, b_0);\n\taead_request_set_ad(aead_req, sg[0].length);\n\n\terr = crypto_aead_decrypt(aead_req);\n\tkfree_sensitive(aead_req);\n\n\treturn err;\n}\n\nstruct crypto_aead *\naead_key_setup_encrypt(const char *alg, const u8 key[],\n\t\t       size_t key_len, size_t mic_len)\n{\n\tstruct crypto_aead *tfm;\n\tint err;\n\n\ttfm = crypto_alloc_aead(alg, 0, CRYPTO_ALG_ASYNC);\n\tif (IS_ERR(tfm))\n\t\treturn tfm;\n\n\terr = crypto_aead_setkey(tfm, key, key_len);\n\tif (err)\n\t\tgoto free_aead;\n\terr = crypto_aead_setauthsize(tfm, mic_len);\n\tif (err)\n\t\tgoto free_aead;\n\n\treturn tfm;\n\nfree_aead:\n\tcrypto_free_aead(tfm);\n\treturn ERR_PTR(err);\n}\n\nvoid aead_key_free(struct crypto_aead *tfm)\n{\n\tcrypto_free_aead(tfm);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}