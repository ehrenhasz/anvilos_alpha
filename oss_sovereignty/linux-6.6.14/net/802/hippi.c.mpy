{
  "module_name": "hippi.c",
  "hash_id": "267d03ab252888e82cab50c95751a8fcbd465a1ba0ca0a3316bbe3fea53b6ea3",
  "original_prompt": "Ingested from linux-6.6.14/net/802/hippi.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/types.h>\n#include <linux/kernel.h>\n#include <linux/string.h>\n#include <linux/mm.h>\n#include <linux/socket.h>\n#include <linux/in.h>\n#include <linux/inet.h>\n#include <linux/netdevice.h>\n#include <linux/hippidevice.h>\n#include <linux/skbuff.h>\n#include <linux/errno.h>\n#include <net/arp.h>\n#include <net/sock.h>\n#include <linux/uaccess.h>\n\n \n\nstatic int hippi_header(struct sk_buff *skb, struct net_device *dev,\n\t\t\tunsigned short type,\n\t\t\tconst void *daddr, const void *saddr, unsigned int len)\n{\n\tstruct hippi_hdr *hip = skb_push(skb, HIPPI_HLEN);\n\tstruct hippi_cb *hcb = (struct hippi_cb *) skb->cb;\n\n\tif (!len){\n\t\tlen = skb->len - HIPPI_HLEN;\n\t\tprintk(\"hippi_header(): length not supplied\\n\");\n\t}\n\n\t \n\thip->fp.fixed\t\t= htonl(0x04800018);\n\thip->fp.d2_size\t\t= htonl(len + 8);\n\thip->le.fc\t\t= 0;\n\thip->le.double_wide\t= 0;\t \n\thip->le.message_type\t= 0;\t \n\n\thip->le.dest_addr_type\t= 2;\t \n\thip->le.src_addr_type\t= 2;\t \n\n\tmemcpy(hip->le.src_switch_addr, dev->dev_addr + 3, 3);\n\tmemset_startat(&hip->le, 0, reserved);\n\n\thip->snap.dsap\t\t= HIPPI_EXTENDED_SAP;\n\thip->snap.ssap\t\t= HIPPI_EXTENDED_SAP;\n\thip->snap.ctrl\t\t= HIPPI_UI_CMD;\n\thip->snap.oui[0]\t= 0x00;\n\thip->snap.oui[1]\t= 0x00;\n\thip->snap.oui[2]\t= 0x00;\n\thip->snap.ethertype\t= htons(type);\n\n\tif (daddr)\n\t{\n\t\tmemcpy(hip->le.dest_switch_addr, daddr + 3, 3);\n\t\tmemcpy(&hcb->ifield, daddr + 2, 4);\n\t\treturn HIPPI_HLEN;\n\t}\n\thcb->ifield = 0;\n\treturn -((int)HIPPI_HLEN);\n}\n\n\n \n\n__be16 hippi_type_trans(struct sk_buff *skb, struct net_device *dev)\n{\n\tstruct hippi_hdr *hip;\n\n\t \n\tskb->dev = dev;\n\tskb_reset_mac_header(skb);\n\thip = (struct hippi_hdr *)skb_mac_header(skb);\n\tskb_pull(skb, HIPPI_HLEN);\n\n\t \n\n\treturn hip->snap.ethertype;\n}\n\nEXPORT_SYMBOL(hippi_type_trans);\n\n \nint hippi_mac_addr(struct net_device *dev, void *p)\n{\n\tstruct sockaddr *addr = p;\n\tif (netif_running(dev))\n\t\treturn -EBUSY;\n\tdev_addr_set(dev, addr->sa_data);\n\treturn 0;\n}\nEXPORT_SYMBOL(hippi_mac_addr);\n\nint hippi_neigh_setup_dev(struct net_device *dev, struct neigh_parms *p)\n{\n\t \n\tNEIGH_VAR_INIT(p, MCAST_PROBES, 0);\n\n\t \n\tif (p->tbl->family != AF_INET6)\n\t\tNEIGH_VAR_INIT(p, UCAST_PROBES, 0);\n\treturn 0;\n}\nEXPORT_SYMBOL(hippi_neigh_setup_dev);\n\nstatic const struct header_ops hippi_header_ops = {\n\t.create\t\t= hippi_header,\n};\n\n\nstatic void hippi_setup(struct net_device *dev)\n{\n\tdev->header_ops\t\t\t= &hippi_header_ops;\n\n\t \n\tdev->type\t\t= ARPHRD_HIPPI;\n\tdev->hard_header_len \t= HIPPI_HLEN;\n\tdev->mtu\t\t= 65280;\n\tdev->min_mtu\t\t= 68;\n\tdev->max_mtu\t\t= 65280;\n\tdev->addr_len\t\t= HIPPI_ALEN;\n\tdev->tx_queue_len\t= 25  ;\n\tmemset(dev->broadcast, 0xFF, HIPPI_ALEN);\n\n\n\t \n\tdev->flags = 0;\n}\n\n \n\nstruct net_device *alloc_hippi_dev(int sizeof_priv)\n{\n\treturn alloc_netdev(sizeof_priv, \"hip%d\", NET_NAME_UNKNOWN,\n\t\t\t    hippi_setup);\n}\n\nEXPORT_SYMBOL(alloc_hippi_dev);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}