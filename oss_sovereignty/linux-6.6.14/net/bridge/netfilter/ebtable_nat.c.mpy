{
  "module_name": "ebtable_nat.c",
  "hash_id": "b55f9dc39ffd05eebb0991c1589ba325c8e50cc433dca1762f86408d3295f2d4",
  "original_prompt": "Ingested from linux-6.6.14/net/bridge/netfilter/ebtable_nat.c",
  "human_readable_source": "\n \n\n#include <linux/netfilter_bridge/ebtables.h>\n#include <uapi/linux/netfilter_bridge.h>\n#include <linux/module.h>\n\n#define NAT_VALID_HOOKS ((1 << NF_BR_PRE_ROUTING) | (1 << NF_BR_LOCAL_OUT) | \\\n\t\t\t (1 << NF_BR_POST_ROUTING))\n\nstatic struct ebt_entries initial_chains[] = {\n\t{\n\t\t.name\t= \"PREROUTING\",\n\t\t.policy\t= EBT_ACCEPT,\n\t},\n\t{\n\t\t.name\t= \"OUTPUT\",\n\t\t.policy\t= EBT_ACCEPT,\n\t},\n\t{\n\t\t.name\t= \"POSTROUTING\",\n\t\t.policy\t= EBT_ACCEPT,\n\t}\n};\n\nstatic struct ebt_replace_kernel initial_table = {\n\t.name\t\t= \"nat\",\n\t.valid_hooks\t= NAT_VALID_HOOKS,\n\t.entries_size\t= 3 * sizeof(struct ebt_entries),\n\t.hook_entry\t= {\n\t\t[NF_BR_PRE_ROUTING]\t= &initial_chains[0],\n\t\t[NF_BR_LOCAL_OUT]\t= &initial_chains[1],\n\t\t[NF_BR_POST_ROUTING]\t= &initial_chains[2],\n\t},\n\t.entries\t= (char *)initial_chains,\n};\n\nstatic const struct ebt_table frame_nat = {\n\t.name\t\t= \"nat\",\n\t.table\t\t= &initial_table,\n\t.valid_hooks\t= NAT_VALID_HOOKS,\n\t.me\t\t= THIS_MODULE,\n};\n\nstatic const struct nf_hook_ops ebt_ops_nat[] = {\n\t{\n\t\t.hook\t\t= ebt_do_table,\n\t\t.pf\t\t= NFPROTO_BRIDGE,\n\t\t.hooknum\t= NF_BR_LOCAL_OUT,\n\t\t.priority\t= NF_BR_PRI_NAT_DST_OTHER,\n\t},\n\t{\n\t\t.hook\t\t= ebt_do_table,\n\t\t.pf\t\t= NFPROTO_BRIDGE,\n\t\t.hooknum\t= NF_BR_POST_ROUTING,\n\t\t.priority\t= NF_BR_PRI_NAT_SRC,\n\t},\n\t{\n\t\t.hook\t\t= ebt_do_table,\n\t\t.pf\t\t= NFPROTO_BRIDGE,\n\t\t.hooknum\t= NF_BR_PRE_ROUTING,\n\t\t.priority\t= NF_BR_PRI_NAT_DST_BRIDGED,\n\t},\n};\n\nstatic int frame_nat_table_init(struct net *net)\n{\n\treturn ebt_register_table(net, &frame_nat, ebt_ops_nat);\n}\n\nstatic void __net_exit frame_nat_net_pre_exit(struct net *net)\n{\n\tebt_unregister_table_pre_exit(net, \"nat\");\n}\n\nstatic void __net_exit frame_nat_net_exit(struct net *net)\n{\n\tebt_unregister_table(net, \"nat\");\n}\n\nstatic struct pernet_operations frame_nat_net_ops = {\n\t.exit = frame_nat_net_exit,\n\t.pre_exit = frame_nat_net_pre_exit,\n};\n\nstatic int __init ebtable_nat_init(void)\n{\n\tint ret = ebt_register_template(&frame_nat, frame_nat_table_init);\n\n\tif (ret)\n\t\treturn ret;\n\n\tret = register_pernet_subsys(&frame_nat_net_ops);\n\tif (ret) {\n\t\tebt_unregister_template(&frame_nat);\n\t\treturn ret;\n\t}\n\n\treturn ret;\n}\n\nstatic void __exit ebtable_nat_fini(void)\n{\n\tunregister_pernet_subsys(&frame_nat_net_ops);\n\tebt_unregister_template(&frame_nat);\n}\n\nmodule_init(ebtable_nat_init);\nmodule_exit(ebtable_nat_fini);\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}