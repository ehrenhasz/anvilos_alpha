{
  "module_name": "br_cfm_netlink.c",
  "hash_id": "f0394e18ba596954c72a89d0701e2d9d3a11275dc42d328da2ee3f66c8168196",
  "original_prompt": "Ingested from linux-6.6.14/net/bridge/br_cfm_netlink.c",
  "human_readable_source": "\n\n#include <net/genetlink.h>\n\n#include \"br_private.h\"\n#include \"br_private_cfm.h\"\n\nstatic const struct nla_policy\nbr_cfm_mep_create_policy[IFLA_BRIDGE_CFM_MEP_CREATE_MAX + 1] = {\n\t[IFLA_BRIDGE_CFM_MEP_CREATE_UNSPEC]\t= { .type = NLA_REJECT },\n\t[IFLA_BRIDGE_CFM_MEP_CREATE_INSTANCE]\t= { .type = NLA_U32 },\n\t[IFLA_BRIDGE_CFM_MEP_CREATE_DOMAIN]\t= { .type = NLA_U32 },\n\t[IFLA_BRIDGE_CFM_MEP_CREATE_DIRECTION]\t= { .type = NLA_U32 },\n\t[IFLA_BRIDGE_CFM_MEP_CREATE_IFINDEX]\t= { .type = NLA_U32 },\n};\n\nstatic const struct nla_policy\nbr_cfm_mep_delete_policy[IFLA_BRIDGE_CFM_MEP_DELETE_MAX + 1] = {\n\t[IFLA_BRIDGE_CFM_MEP_DELETE_UNSPEC]\t= { .type = NLA_REJECT },\n\t[IFLA_BRIDGE_CFM_MEP_DELETE_INSTANCE]\t= { .type = NLA_U32 },\n};\n\nstatic const struct nla_policy\nbr_cfm_mep_config_policy[IFLA_BRIDGE_CFM_MEP_CONFIG_MAX + 1] = {\n\t[IFLA_BRIDGE_CFM_MEP_CONFIG_UNSPEC]\t = { .type = NLA_REJECT },\n\t[IFLA_BRIDGE_CFM_MEP_CONFIG_INSTANCE]\t = { .type = NLA_U32 },\n\t[IFLA_BRIDGE_CFM_MEP_CONFIG_UNICAST_MAC] = NLA_POLICY_ETH_ADDR,\n\t[IFLA_BRIDGE_CFM_MEP_CONFIG_MDLEVEL]\t = NLA_POLICY_MAX(NLA_U32, 7),\n\t[IFLA_BRIDGE_CFM_MEP_CONFIG_MEPID]\t = NLA_POLICY_MAX(NLA_U32, 0x1FFF),\n};\n\nstatic const struct nla_policy\nbr_cfm_cc_config_policy[IFLA_BRIDGE_CFM_CC_CONFIG_MAX + 1] = {\n\t[IFLA_BRIDGE_CFM_CC_CONFIG_UNSPEC]\t = { .type = NLA_REJECT },\n\t[IFLA_BRIDGE_CFM_CC_CONFIG_INSTANCE]\t = { .type = NLA_U32 },\n\t[IFLA_BRIDGE_CFM_CC_CONFIG_ENABLE]\t = { .type = NLA_U32 },\n\t[IFLA_BRIDGE_CFM_CC_CONFIG_EXP_INTERVAL] = { .type = NLA_U32 },\n\t[IFLA_BRIDGE_CFM_CC_CONFIG_EXP_MAID]\t = {\n\t.type = NLA_BINARY, .len = CFM_MAID_LENGTH },\n};\n\nstatic const struct nla_policy\nbr_cfm_cc_peer_mep_policy[IFLA_BRIDGE_CFM_CC_PEER_MEP_MAX + 1] = {\n\t[IFLA_BRIDGE_CFM_CC_PEER_MEP_UNSPEC]\t= { .type = NLA_REJECT },\n\t[IFLA_BRIDGE_CFM_CC_PEER_MEP_INSTANCE]\t= { .type = NLA_U32 },\n\t[IFLA_BRIDGE_CFM_CC_PEER_MEPID]\t\t= NLA_POLICY_MAX(NLA_U32, 0x1FFF),\n};\n\nstatic const struct nla_policy\nbr_cfm_cc_rdi_policy[IFLA_BRIDGE_CFM_CC_RDI_MAX + 1] = {\n\t[IFLA_BRIDGE_CFM_CC_RDI_UNSPEC]\t\t= { .type = NLA_REJECT },\n\t[IFLA_BRIDGE_CFM_CC_RDI_INSTANCE]\t= { .type = NLA_U32 },\n\t[IFLA_BRIDGE_CFM_CC_RDI_RDI]\t\t= { .type = NLA_U32 },\n};\n\nstatic const struct nla_policy\nbr_cfm_cc_ccm_tx_policy[IFLA_BRIDGE_CFM_CC_CCM_TX_MAX + 1] = {\n\t[IFLA_BRIDGE_CFM_CC_CCM_TX_UNSPEC]\t   = { .type = NLA_REJECT },\n\t[IFLA_BRIDGE_CFM_CC_CCM_TX_INSTANCE]\t   = { .type = NLA_U32 },\n\t[IFLA_BRIDGE_CFM_CC_CCM_TX_DMAC]\t   = NLA_POLICY_ETH_ADDR,\n\t[IFLA_BRIDGE_CFM_CC_CCM_TX_SEQ_NO_UPDATE]  = { .type = NLA_U32 },\n\t[IFLA_BRIDGE_CFM_CC_CCM_TX_PERIOD]\t   = { .type = NLA_U32 },\n\t[IFLA_BRIDGE_CFM_CC_CCM_TX_IF_TLV]\t   = { .type = NLA_U32 },\n\t[IFLA_BRIDGE_CFM_CC_CCM_TX_IF_TLV_VALUE]   = { .type = NLA_U8 },\n\t[IFLA_BRIDGE_CFM_CC_CCM_TX_PORT_TLV]\t   = { .type = NLA_U32 },\n\t[IFLA_BRIDGE_CFM_CC_CCM_TX_PORT_TLV_VALUE] = { .type = NLA_U8 },\n};\n\nstatic const struct nla_policy\nbr_cfm_policy[IFLA_BRIDGE_CFM_MAX + 1] = {\n\t[IFLA_BRIDGE_CFM_UNSPEC]\t\t= { .type = NLA_REJECT },\n\t[IFLA_BRIDGE_CFM_MEP_CREATE]\t\t=\n\t\t\t\tNLA_POLICY_NESTED(br_cfm_mep_create_policy),\n\t[IFLA_BRIDGE_CFM_MEP_DELETE]\t\t=\n\t\t\t\tNLA_POLICY_NESTED(br_cfm_mep_delete_policy),\n\t[IFLA_BRIDGE_CFM_MEP_CONFIG]\t\t=\n\t\t\t\tNLA_POLICY_NESTED(br_cfm_mep_config_policy),\n\t[IFLA_BRIDGE_CFM_CC_CONFIG]\t\t=\n\t\t\t\tNLA_POLICY_NESTED(br_cfm_cc_config_policy),\n\t[IFLA_BRIDGE_CFM_CC_PEER_MEP_ADD]\t=\n\t\t\t\tNLA_POLICY_NESTED(br_cfm_cc_peer_mep_policy),\n\t[IFLA_BRIDGE_CFM_CC_PEER_MEP_REMOVE]\t=\n\t\t\t\tNLA_POLICY_NESTED(br_cfm_cc_peer_mep_policy),\n\t[IFLA_BRIDGE_CFM_CC_RDI]\t\t=\n\t\t\t\tNLA_POLICY_NESTED(br_cfm_cc_rdi_policy),\n\t[IFLA_BRIDGE_CFM_CC_CCM_TX]\t\t=\n\t\t\t\tNLA_POLICY_NESTED(br_cfm_cc_ccm_tx_policy),\n};\n\nstatic int br_mep_create_parse(struct net_bridge *br, struct nlattr *attr,\n\t\t\t       struct netlink_ext_ack *extack)\n{\n\tstruct nlattr *tb[IFLA_BRIDGE_CFM_MEP_CREATE_MAX + 1];\n\tstruct br_cfm_mep_create create;\n\tu32 instance;\n\tint err;\n\n\terr = nla_parse_nested(tb, IFLA_BRIDGE_CFM_MEP_CREATE_MAX, attr,\n\t\t\t       br_cfm_mep_create_policy, extack);\n\tif (err)\n\t\treturn err;\n\n\tif (!tb[IFLA_BRIDGE_CFM_MEP_CREATE_INSTANCE]) {\n\t\tNL_SET_ERR_MSG_MOD(extack, \"Missing INSTANCE attribute\");\n\t\treturn -EINVAL;\n\t}\n\tif (!tb[IFLA_BRIDGE_CFM_MEP_CREATE_DOMAIN]) {\n\t\tNL_SET_ERR_MSG_MOD(extack, \"Missing DOMAIN attribute\");\n\t\treturn -EINVAL;\n\t}\n\tif (!tb[IFLA_BRIDGE_CFM_MEP_CREATE_DIRECTION]) {\n\t\tNL_SET_ERR_MSG_MOD(extack, \"Missing DIRECTION attribute\");\n\t\treturn -EINVAL;\n\t}\n\tif (!tb[IFLA_BRIDGE_CFM_MEP_CREATE_IFINDEX]) {\n\t\tNL_SET_ERR_MSG_MOD(extack, \"Missing IFINDEX attribute\");\n\t\treturn -EINVAL;\n\t}\n\n\tmemset(&create, 0, sizeof(create));\n\n\tinstance =  nla_get_u32(tb[IFLA_BRIDGE_CFM_MEP_CREATE_INSTANCE]);\n\tcreate.domain = nla_get_u32(tb[IFLA_BRIDGE_CFM_MEP_CREATE_DOMAIN]);\n\tcreate.direction = nla_get_u32(tb[IFLA_BRIDGE_CFM_MEP_CREATE_DIRECTION]);\n\tcreate.ifindex = nla_get_u32(tb[IFLA_BRIDGE_CFM_MEP_CREATE_IFINDEX]);\n\n\treturn br_cfm_mep_create(br, instance, &create, extack);\n}\n\nstatic int br_mep_delete_parse(struct net_bridge *br, struct nlattr *attr,\n\t\t\t       struct netlink_ext_ack *extack)\n{\n\tstruct nlattr *tb[IFLA_BRIDGE_CFM_MEP_DELETE_MAX + 1];\n\tu32 instance;\n\tint err;\n\n\terr = nla_parse_nested(tb, IFLA_BRIDGE_CFM_MEP_DELETE_MAX, attr,\n\t\t\t       br_cfm_mep_delete_policy, extack);\n\tif (err)\n\t\treturn err;\n\n\tif (!tb[IFLA_BRIDGE_CFM_MEP_DELETE_INSTANCE]) {\n\t\tNL_SET_ERR_MSG_MOD(extack,\n\t\t\t\t   \"Missing INSTANCE attribute\");\n\t\treturn -EINVAL;\n\t}\n\n\tinstance =  nla_get_u32(tb[IFLA_BRIDGE_CFM_MEP_DELETE_INSTANCE]);\n\n\treturn br_cfm_mep_delete(br, instance, extack);\n}\n\nstatic int br_mep_config_parse(struct net_bridge *br, struct nlattr *attr,\n\t\t\t       struct netlink_ext_ack *extack)\n{\n\tstruct nlattr *tb[IFLA_BRIDGE_CFM_MEP_CONFIG_MAX + 1];\n\tstruct br_cfm_mep_config config;\n\tu32 instance;\n\tint err;\n\n\terr = nla_parse_nested(tb, IFLA_BRIDGE_CFM_MEP_CONFIG_MAX, attr,\n\t\t\t       br_cfm_mep_config_policy, extack);\n\tif (err)\n\t\treturn err;\n\n\tif (!tb[IFLA_BRIDGE_CFM_MEP_CONFIG_INSTANCE]) {\n\t\tNL_SET_ERR_MSG_MOD(extack, \"Missing INSTANCE attribute\");\n\t\treturn -EINVAL;\n\t}\n\tif (!tb[IFLA_BRIDGE_CFM_MEP_CONFIG_UNICAST_MAC]) {\n\t\tNL_SET_ERR_MSG_MOD(extack, \"Missing UNICAST_MAC attribute\");\n\t\treturn -EINVAL;\n\t}\n\tif (!tb[IFLA_BRIDGE_CFM_MEP_CONFIG_MDLEVEL]) {\n\t\tNL_SET_ERR_MSG_MOD(extack, \"Missing MDLEVEL attribute\");\n\t\treturn -EINVAL;\n\t}\n\tif (!tb[IFLA_BRIDGE_CFM_MEP_CONFIG_MEPID]) {\n\t\tNL_SET_ERR_MSG_MOD(extack, \"Missing MEPID attribute\");\n\t\treturn -EINVAL;\n\t}\n\n\tmemset(&config, 0, sizeof(config));\n\n\tinstance =  nla_get_u32(tb[IFLA_BRIDGE_CFM_MEP_CONFIG_INSTANCE]);\n\tnla_memcpy(&config.unicast_mac.addr,\n\t\t   tb[IFLA_BRIDGE_CFM_MEP_CONFIG_UNICAST_MAC],\n\t\t   sizeof(config.unicast_mac.addr));\n\tconfig.mdlevel = nla_get_u32(tb[IFLA_BRIDGE_CFM_MEP_CONFIG_MDLEVEL]);\n\tconfig.mepid = nla_get_u32(tb[IFLA_BRIDGE_CFM_MEP_CONFIG_MEPID]);\n\n\treturn br_cfm_mep_config_set(br, instance, &config, extack);\n}\n\nstatic int br_cc_config_parse(struct net_bridge *br, struct nlattr *attr,\n\t\t\t      struct netlink_ext_ack *extack)\n{\n\tstruct nlattr *tb[IFLA_BRIDGE_CFM_CC_CONFIG_MAX + 1];\n\tstruct br_cfm_cc_config config;\n\tu32 instance;\n\tint err;\n\n\terr = nla_parse_nested(tb, IFLA_BRIDGE_CFM_CC_CONFIG_MAX, attr,\n\t\t\t       br_cfm_cc_config_policy, extack);\n\tif (err)\n\t\treturn err;\n\n\tif (!tb[IFLA_BRIDGE_CFM_CC_CONFIG_INSTANCE]) {\n\t\tNL_SET_ERR_MSG_MOD(extack, \"Missing INSTANCE attribute\");\n\t\treturn -EINVAL;\n\t}\n\tif (!tb[IFLA_BRIDGE_CFM_CC_CONFIG_ENABLE]) {\n\t\tNL_SET_ERR_MSG_MOD(extack, \"Missing ENABLE attribute\");\n\t\treturn -EINVAL;\n\t}\n\tif (!tb[IFLA_BRIDGE_CFM_CC_CONFIG_EXP_INTERVAL]) {\n\t\tNL_SET_ERR_MSG_MOD(extack, \"Missing INTERVAL attribute\");\n\t\treturn -EINVAL;\n\t}\n\tif (!tb[IFLA_BRIDGE_CFM_CC_CONFIG_EXP_MAID]) {\n\t\tNL_SET_ERR_MSG_MOD(extack, \"Missing MAID attribute\");\n\t\treturn -EINVAL;\n\t}\n\n\tmemset(&config, 0, sizeof(config));\n\n\tinstance =  nla_get_u32(tb[IFLA_BRIDGE_CFM_CC_CONFIG_INSTANCE]);\n\tconfig.enable = nla_get_u32(tb[IFLA_BRIDGE_CFM_CC_CONFIG_ENABLE]);\n\tconfig.exp_interval = nla_get_u32(tb[IFLA_BRIDGE_CFM_CC_CONFIG_EXP_INTERVAL]);\n\tnla_memcpy(&config.exp_maid.data, tb[IFLA_BRIDGE_CFM_CC_CONFIG_EXP_MAID],\n\t\t   sizeof(config.exp_maid.data));\n\n\treturn br_cfm_cc_config_set(br, instance, &config, extack);\n}\n\nstatic int br_cc_peer_mep_add_parse(struct net_bridge *br, struct nlattr *attr,\n\t\t\t\t    struct netlink_ext_ack *extack)\n{\n\tstruct nlattr *tb[IFLA_BRIDGE_CFM_CC_PEER_MEP_MAX + 1];\n\tu32 instance, peer_mep_id;\n\tint err;\n\n\terr = nla_parse_nested(tb, IFLA_BRIDGE_CFM_CC_PEER_MEP_MAX, attr,\n\t\t\t       br_cfm_cc_peer_mep_policy, extack);\n\tif (err)\n\t\treturn err;\n\n\tif (!tb[IFLA_BRIDGE_CFM_CC_PEER_MEP_INSTANCE]) {\n\t\tNL_SET_ERR_MSG_MOD(extack, \"Missing INSTANCE attribute\");\n\t\treturn -EINVAL;\n\t}\n\tif (!tb[IFLA_BRIDGE_CFM_CC_PEER_MEPID]) {\n\t\tNL_SET_ERR_MSG_MOD(extack, \"Missing PEER_MEP_ID attribute\");\n\t\treturn -EINVAL;\n\t}\n\n\tinstance =  nla_get_u32(tb[IFLA_BRIDGE_CFM_CC_PEER_MEP_INSTANCE]);\n\tpeer_mep_id =  nla_get_u32(tb[IFLA_BRIDGE_CFM_CC_PEER_MEPID]);\n\n\treturn br_cfm_cc_peer_mep_add(br, instance, peer_mep_id, extack);\n}\n\nstatic int br_cc_peer_mep_remove_parse(struct net_bridge *br, struct nlattr *attr,\n\t\t\t\t       struct netlink_ext_ack *extack)\n{\n\tstruct nlattr *tb[IFLA_BRIDGE_CFM_CC_PEER_MEP_MAX + 1];\n\tu32 instance, peer_mep_id;\n\tint err;\n\n\terr = nla_parse_nested(tb, IFLA_BRIDGE_CFM_CC_PEER_MEP_MAX, attr,\n\t\t\t       br_cfm_cc_peer_mep_policy, extack);\n\tif (err)\n\t\treturn err;\n\n\tif (!tb[IFLA_BRIDGE_CFM_CC_PEER_MEP_INSTANCE]) {\n\t\tNL_SET_ERR_MSG_MOD(extack, \"Missing INSTANCE attribute\");\n\t\treturn -EINVAL;\n\t}\n\tif (!tb[IFLA_BRIDGE_CFM_CC_PEER_MEPID]) {\n\t\tNL_SET_ERR_MSG_MOD(extack, \"Missing PEER_MEP_ID attribute\");\n\t\treturn -EINVAL;\n\t}\n\n\tinstance =  nla_get_u32(tb[IFLA_BRIDGE_CFM_CC_PEER_MEP_INSTANCE]);\n\tpeer_mep_id =  nla_get_u32(tb[IFLA_BRIDGE_CFM_CC_PEER_MEPID]);\n\n\treturn br_cfm_cc_peer_mep_remove(br, instance, peer_mep_id, extack);\n}\n\nstatic int br_cc_rdi_parse(struct net_bridge *br, struct nlattr *attr,\n\t\t\t   struct netlink_ext_ack *extack)\n{\n\tstruct nlattr *tb[IFLA_BRIDGE_CFM_CC_RDI_MAX + 1];\n\tu32 instance, rdi;\n\tint err;\n\n\terr = nla_parse_nested(tb, IFLA_BRIDGE_CFM_CC_RDI_MAX, attr,\n\t\t\t       br_cfm_cc_rdi_policy, extack);\n\tif (err)\n\t\treturn err;\n\n\tif (!tb[IFLA_BRIDGE_CFM_CC_RDI_INSTANCE]) {\n\t\tNL_SET_ERR_MSG_MOD(extack, \"Missing INSTANCE attribute\");\n\t\treturn -EINVAL;\n\t}\n\tif (!tb[IFLA_BRIDGE_CFM_CC_RDI_RDI]) {\n\t\tNL_SET_ERR_MSG_MOD(extack, \"Missing RDI attribute\");\n\t\treturn -EINVAL;\n\t}\n\n\tinstance =  nla_get_u32(tb[IFLA_BRIDGE_CFM_CC_RDI_INSTANCE]);\n\trdi =  nla_get_u32(tb[IFLA_BRIDGE_CFM_CC_RDI_RDI]);\n\n\treturn br_cfm_cc_rdi_set(br, instance, rdi, extack);\n}\n\nstatic int br_cc_ccm_tx_parse(struct net_bridge *br, struct nlattr *attr,\n\t\t\t      struct netlink_ext_ack *extack)\n{\n\tstruct nlattr *tb[IFLA_BRIDGE_CFM_CC_CCM_TX_MAX + 1];\n\tstruct br_cfm_cc_ccm_tx_info tx_info;\n\tu32 instance;\n\tint err;\n\n\terr = nla_parse_nested(tb, IFLA_BRIDGE_CFM_CC_CCM_TX_MAX, attr,\n\t\t\t       br_cfm_cc_ccm_tx_policy, extack);\n\tif (err)\n\t\treturn err;\n\n\tif (!tb[IFLA_BRIDGE_CFM_CC_CCM_TX_INSTANCE]) {\n\t\tNL_SET_ERR_MSG_MOD(extack, \"Missing INSTANCE attribute\");\n\t\treturn -EINVAL;\n\t}\n\tif (!tb[IFLA_BRIDGE_CFM_CC_CCM_TX_DMAC]) {\n\t\tNL_SET_ERR_MSG_MOD(extack, \"Missing DMAC attribute\");\n\t\treturn -EINVAL;\n\t}\n\tif (!tb[IFLA_BRIDGE_CFM_CC_CCM_TX_SEQ_NO_UPDATE]) {\n\t\tNL_SET_ERR_MSG_MOD(extack, \"Missing SEQ_NO_UPDATE attribute\");\n\t\treturn -EINVAL;\n\t}\n\tif (!tb[IFLA_BRIDGE_CFM_CC_CCM_TX_PERIOD]) {\n\t\tNL_SET_ERR_MSG_MOD(extack, \"Missing PERIOD attribute\");\n\t\treturn -EINVAL;\n\t}\n\tif (!tb[IFLA_BRIDGE_CFM_CC_CCM_TX_IF_TLV]) {\n\t\tNL_SET_ERR_MSG_MOD(extack, \"Missing IF_TLV attribute\");\n\t\treturn -EINVAL;\n\t}\n\tif (!tb[IFLA_BRIDGE_CFM_CC_CCM_TX_IF_TLV_VALUE]) {\n\t\tNL_SET_ERR_MSG_MOD(extack, \"Missing IF_TLV_VALUE attribute\");\n\t\treturn -EINVAL;\n\t}\n\tif (!tb[IFLA_BRIDGE_CFM_CC_CCM_TX_PORT_TLV]) {\n\t\tNL_SET_ERR_MSG_MOD(extack, \"Missing PORT_TLV attribute\");\n\t\treturn -EINVAL;\n\t}\n\tif (!tb[IFLA_BRIDGE_CFM_CC_CCM_TX_PORT_TLV_VALUE]) {\n\t\tNL_SET_ERR_MSG_MOD(extack, \"Missing PORT_TLV_VALUE attribute\");\n\t\treturn -EINVAL;\n\t}\n\n\tmemset(&tx_info, 0, sizeof(tx_info));\n\n\tinstance = nla_get_u32(tb[IFLA_BRIDGE_CFM_CC_RDI_INSTANCE]);\n\tnla_memcpy(&tx_info.dmac.addr,\n\t\t   tb[IFLA_BRIDGE_CFM_CC_CCM_TX_DMAC],\n\t\t   sizeof(tx_info.dmac.addr));\n\ttx_info.seq_no_update = nla_get_u32(tb[IFLA_BRIDGE_CFM_CC_CCM_TX_SEQ_NO_UPDATE]);\n\ttx_info.period = nla_get_u32(tb[IFLA_BRIDGE_CFM_CC_CCM_TX_PERIOD]);\n\ttx_info.if_tlv = nla_get_u32(tb[IFLA_BRIDGE_CFM_CC_CCM_TX_IF_TLV]);\n\ttx_info.if_tlv_value = nla_get_u8(tb[IFLA_BRIDGE_CFM_CC_CCM_TX_IF_TLV_VALUE]);\n\ttx_info.port_tlv = nla_get_u32(tb[IFLA_BRIDGE_CFM_CC_CCM_TX_PORT_TLV]);\n\ttx_info.port_tlv_value = nla_get_u8(tb[IFLA_BRIDGE_CFM_CC_CCM_TX_PORT_TLV_VALUE]);\n\n\treturn br_cfm_cc_ccm_tx(br, instance, &tx_info, extack);\n}\n\nint br_cfm_parse(struct net_bridge *br, struct net_bridge_port *p,\n\t\t struct nlattr *attr, int cmd, struct netlink_ext_ack *extack)\n{\n\tstruct nlattr *tb[IFLA_BRIDGE_CFM_MAX + 1];\n\tint err;\n\n\t \n\tif (p)\n\t\tbr = p->br;\n\n\terr = nla_parse_nested(tb, IFLA_BRIDGE_CFM_MAX, attr,\n\t\t\t       br_cfm_policy, extack);\n\tif (err)\n\t\treturn err;\n\n\tif (tb[IFLA_BRIDGE_CFM_MEP_CREATE]) {\n\t\terr = br_mep_create_parse(br, tb[IFLA_BRIDGE_CFM_MEP_CREATE],\n\t\t\t\t\t  extack);\n\t\tif (err)\n\t\t\treturn err;\n\t}\n\n\tif (tb[IFLA_BRIDGE_CFM_MEP_DELETE]) {\n\t\terr = br_mep_delete_parse(br, tb[IFLA_BRIDGE_CFM_MEP_DELETE],\n\t\t\t\t\t  extack);\n\t\tif (err)\n\t\t\treturn err;\n\t}\n\n\tif (tb[IFLA_BRIDGE_CFM_MEP_CONFIG]) {\n\t\terr = br_mep_config_parse(br, tb[IFLA_BRIDGE_CFM_MEP_CONFIG],\n\t\t\t\t\t  extack);\n\t\tif (err)\n\t\t\treturn err;\n\t}\n\n\tif (tb[IFLA_BRIDGE_CFM_CC_CONFIG]) {\n\t\terr = br_cc_config_parse(br, tb[IFLA_BRIDGE_CFM_CC_CONFIG],\n\t\t\t\t\t extack);\n\t\tif (err)\n\t\t\treturn err;\n\t}\n\n\tif (tb[IFLA_BRIDGE_CFM_CC_PEER_MEP_ADD]) {\n\t\terr = br_cc_peer_mep_add_parse(br, tb[IFLA_BRIDGE_CFM_CC_PEER_MEP_ADD],\n\t\t\t\t\t       extack);\n\t\tif (err)\n\t\t\treturn err;\n\t}\n\n\tif (tb[IFLA_BRIDGE_CFM_CC_PEER_MEP_REMOVE]) {\n\t\terr = br_cc_peer_mep_remove_parse(br, tb[IFLA_BRIDGE_CFM_CC_PEER_MEP_REMOVE],\n\t\t\t\t\t\t  extack);\n\t\tif (err)\n\t\t\treturn err;\n\t}\n\n\tif (tb[IFLA_BRIDGE_CFM_CC_RDI]) {\n\t\terr = br_cc_rdi_parse(br, tb[IFLA_BRIDGE_CFM_CC_RDI],\n\t\t\t\t      extack);\n\t\tif (err)\n\t\t\treturn err;\n\t}\n\n\tif (tb[IFLA_BRIDGE_CFM_CC_CCM_TX]) {\n\t\terr = br_cc_ccm_tx_parse(br, tb[IFLA_BRIDGE_CFM_CC_CCM_TX],\n\t\t\t\t\t extack);\n\t\tif (err)\n\t\t\treturn err;\n\t}\n\n\treturn 0;\n}\n\nint br_cfm_config_fill_info(struct sk_buff *skb, struct net_bridge *br)\n{\n\tstruct br_cfm_peer_mep *peer_mep;\n\tstruct br_cfm_mep *mep;\n\tstruct nlattr *tb;\n\n\thlist_for_each_entry_rcu(mep, &br->mep_list, head) {\n\t\ttb = nla_nest_start(skb, IFLA_BRIDGE_CFM_MEP_CREATE_INFO);\n\t\tif (!tb)\n\t\t\tgoto nla_info_failure;\n\n\t\tif (nla_put_u32(skb, IFLA_BRIDGE_CFM_MEP_CREATE_INSTANCE,\n\t\t\t\tmep->instance))\n\t\t\tgoto nla_put_failure;\n\n\t\tif (nla_put_u32(skb, IFLA_BRIDGE_CFM_MEP_CREATE_DOMAIN,\n\t\t\t\tmep->create.domain))\n\t\t\tgoto nla_put_failure;\n\n\t\tif (nla_put_u32(skb, IFLA_BRIDGE_CFM_MEP_CREATE_DIRECTION,\n\t\t\t\tmep->create.direction))\n\t\t\tgoto nla_put_failure;\n\n\t\tif (nla_put_u32(skb, IFLA_BRIDGE_CFM_MEP_CREATE_IFINDEX,\n\t\t\t\tmep->create.ifindex))\n\t\t\tgoto nla_put_failure;\n\n\t\tnla_nest_end(skb, tb);\n\n\t\ttb = nla_nest_start(skb, IFLA_BRIDGE_CFM_MEP_CONFIG_INFO);\n\n\t\tif (!tb)\n\t\t\tgoto nla_info_failure;\n\n\t\tif (nla_put_u32(skb, IFLA_BRIDGE_CFM_MEP_CONFIG_INSTANCE,\n\t\t\t\tmep->instance))\n\t\t\tgoto nla_put_failure;\n\n\t\tif (nla_put(skb, IFLA_BRIDGE_CFM_MEP_CONFIG_UNICAST_MAC,\n\t\t\t    sizeof(mep->config.unicast_mac.addr),\n\t\t\t    mep->config.unicast_mac.addr))\n\t\t\tgoto nla_put_failure;\n\n\t\tif (nla_put_u32(skb, IFLA_BRIDGE_CFM_MEP_CONFIG_MDLEVEL,\n\t\t\t\tmep->config.mdlevel))\n\t\t\tgoto nla_put_failure;\n\n\t\tif (nla_put_u32(skb, IFLA_BRIDGE_CFM_MEP_CONFIG_MEPID,\n\t\t\t\tmep->config.mepid))\n\t\t\tgoto nla_put_failure;\n\n\t\tnla_nest_end(skb, tb);\n\n\t\ttb = nla_nest_start(skb, IFLA_BRIDGE_CFM_CC_CONFIG_INFO);\n\n\t\tif (!tb)\n\t\t\tgoto nla_info_failure;\n\n\t\tif (nla_put_u32(skb, IFLA_BRIDGE_CFM_CC_CONFIG_INSTANCE,\n\t\t\t\tmep->instance))\n\t\t\tgoto nla_put_failure;\n\n\t\tif (nla_put_u32(skb, IFLA_BRIDGE_CFM_CC_CONFIG_ENABLE,\n\t\t\t\tmep->cc_config.enable))\n\t\t\tgoto nla_put_failure;\n\n\t\tif (nla_put_u32(skb, IFLA_BRIDGE_CFM_CC_CONFIG_EXP_INTERVAL,\n\t\t\t\tmep->cc_config.exp_interval))\n\t\t\tgoto nla_put_failure;\n\n\t\tif (nla_put(skb, IFLA_BRIDGE_CFM_CC_CONFIG_EXP_MAID,\n\t\t\t    sizeof(mep->cc_config.exp_maid.data),\n\t\t\t    mep->cc_config.exp_maid.data))\n\t\t\tgoto nla_put_failure;\n\n\t\tnla_nest_end(skb, tb);\n\n\t\ttb = nla_nest_start(skb, IFLA_BRIDGE_CFM_CC_RDI_INFO);\n\n\t\tif (!tb)\n\t\t\tgoto nla_info_failure;\n\n\t\tif (nla_put_u32(skb, IFLA_BRIDGE_CFM_CC_RDI_INSTANCE,\n\t\t\t\tmep->instance))\n\t\t\tgoto nla_put_failure;\n\n\t\tif (nla_put_u32(skb, IFLA_BRIDGE_CFM_CC_RDI_RDI,\n\t\t\t\tmep->rdi))\n\t\t\tgoto nla_put_failure;\n\n\t\tnla_nest_end(skb, tb);\n\n\t\ttb = nla_nest_start(skb, IFLA_BRIDGE_CFM_CC_CCM_TX_INFO);\n\n\t\tif (!tb)\n\t\t\tgoto nla_info_failure;\n\n\t\tif (nla_put_u32(skb, IFLA_BRIDGE_CFM_CC_CCM_TX_INSTANCE,\n\t\t\t\tmep->instance))\n\t\t\tgoto nla_put_failure;\n\n\t\tif (nla_put(skb, IFLA_BRIDGE_CFM_CC_CCM_TX_DMAC,\n\t\t\t    sizeof(mep->cc_ccm_tx_info.dmac),\n\t\t\t    mep->cc_ccm_tx_info.dmac.addr))\n\t\t\tgoto nla_put_failure;\n\n\t\tif (nla_put_u32(skb, IFLA_BRIDGE_CFM_CC_CCM_TX_SEQ_NO_UPDATE,\n\t\t\t\tmep->cc_ccm_tx_info.seq_no_update))\n\t\t\tgoto nla_put_failure;\n\n\t\tif (nla_put_u32(skb, IFLA_BRIDGE_CFM_CC_CCM_TX_PERIOD,\n\t\t\t\tmep->cc_ccm_tx_info.period))\n\t\t\tgoto nla_put_failure;\n\n\t\tif (nla_put_u32(skb, IFLA_BRIDGE_CFM_CC_CCM_TX_IF_TLV,\n\t\t\t\tmep->cc_ccm_tx_info.if_tlv))\n\t\t\tgoto nla_put_failure;\n\n\t\tif (nla_put_u8(skb, IFLA_BRIDGE_CFM_CC_CCM_TX_IF_TLV_VALUE,\n\t\t\t       mep->cc_ccm_tx_info.if_tlv_value))\n\t\t\tgoto nla_put_failure;\n\n\t\tif (nla_put_u32(skb, IFLA_BRIDGE_CFM_CC_CCM_TX_PORT_TLV,\n\t\t\t\tmep->cc_ccm_tx_info.port_tlv))\n\t\t\tgoto nla_put_failure;\n\n\t\tif (nla_put_u8(skb, IFLA_BRIDGE_CFM_CC_CCM_TX_PORT_TLV_VALUE,\n\t\t\t       mep->cc_ccm_tx_info.port_tlv_value))\n\t\t\tgoto nla_put_failure;\n\n\t\tnla_nest_end(skb, tb);\n\n\t\thlist_for_each_entry_rcu(peer_mep, &mep->peer_mep_list, head) {\n\t\t\ttb = nla_nest_start(skb,\n\t\t\t\t\t    IFLA_BRIDGE_CFM_CC_PEER_MEP_INFO);\n\n\t\t\tif (!tb)\n\t\t\t\tgoto nla_info_failure;\n\n\t\t\tif (nla_put_u32(skb,\n\t\t\t\t\tIFLA_BRIDGE_CFM_CC_PEER_MEP_INSTANCE,\n\t\t\t\t\tmep->instance))\n\t\t\t\tgoto nla_put_failure;\n\n\t\t\tif (nla_put_u32(skb, IFLA_BRIDGE_CFM_CC_PEER_MEPID,\n\t\t\t\t\tpeer_mep->mepid))\n\t\t\t\tgoto nla_put_failure;\n\n\t\t\tnla_nest_end(skb, tb);\n\t\t}\n\t}\n\n\treturn 0;\n\nnla_put_failure:\n\tnla_nest_cancel(skb, tb);\n\nnla_info_failure:\n\treturn -EMSGSIZE;\n}\n\nint br_cfm_status_fill_info(struct sk_buff *skb,\n\t\t\t    struct net_bridge *br,\n\t\t\t    bool getlink)\n{\n\tstruct br_cfm_peer_mep *peer_mep;\n\tstruct br_cfm_mep *mep;\n\tstruct nlattr *tb;\n\n\thlist_for_each_entry_rcu(mep, &br->mep_list, head) {\n\t\ttb = nla_nest_start(skb, IFLA_BRIDGE_CFM_MEP_STATUS_INFO);\n\t\tif (!tb)\n\t\t\tgoto nla_info_failure;\n\n\t\tif (nla_put_u32(skb, IFLA_BRIDGE_CFM_MEP_STATUS_INSTANCE,\n\t\t\t\tmep->instance))\n\t\t\tgoto nla_put_failure;\n\n\t\tif (nla_put_u32(skb,\n\t\t\t\tIFLA_BRIDGE_CFM_MEP_STATUS_OPCODE_UNEXP_SEEN,\n\t\t\t\tmep->status.opcode_unexp_seen))\n\t\t\tgoto nla_put_failure;\n\n\t\tif (nla_put_u32(skb,\n\t\t\t\tIFLA_BRIDGE_CFM_MEP_STATUS_VERSION_UNEXP_SEEN,\n\t\t\t\tmep->status.version_unexp_seen))\n\t\t\tgoto nla_put_failure;\n\n\t\tif (nla_put_u32(skb,\n\t\t\t\tIFLA_BRIDGE_CFM_MEP_STATUS_RX_LEVEL_LOW_SEEN,\n\t\t\t\tmep->status.rx_level_low_seen))\n\t\t\tgoto nla_put_failure;\n\n\t\t \n\t\tif (getlink) {\n\t\t\t \n\t\t\tmep->status.opcode_unexp_seen = false;\n\t\t\tmep->status.version_unexp_seen = false;\n\t\t\tmep->status.rx_level_low_seen = false;\n\t\t}\n\n\t\tnla_nest_end(skb, tb);\n\n\t\thlist_for_each_entry_rcu(peer_mep, &mep->peer_mep_list, head) {\n\t\t\ttb = nla_nest_start(skb,\n\t\t\t\t\t    IFLA_BRIDGE_CFM_CC_PEER_STATUS_INFO);\n\t\t\tif (!tb)\n\t\t\t\tgoto nla_info_failure;\n\n\t\t\tif (nla_put_u32(skb,\n\t\t\t\t\tIFLA_BRIDGE_CFM_CC_PEER_STATUS_INSTANCE,\n\t\t\t\t\tmep->instance))\n\t\t\t\tgoto nla_put_failure;\n\n\t\t\tif (nla_put_u32(skb,\n\t\t\t\t\tIFLA_BRIDGE_CFM_CC_PEER_STATUS_PEER_MEPID,\n\t\t\t\t\tpeer_mep->mepid))\n\t\t\t\tgoto nla_put_failure;\n\n\t\t\tif (nla_put_u32(skb,\n\t\t\t\t\tIFLA_BRIDGE_CFM_CC_PEER_STATUS_CCM_DEFECT,\n\t\t\t\t\tpeer_mep->cc_status.ccm_defect))\n\t\t\t\tgoto nla_put_failure;\n\n\t\t\tif (nla_put_u32(skb, IFLA_BRIDGE_CFM_CC_PEER_STATUS_RDI,\n\t\t\t\t\tpeer_mep->cc_status.rdi))\n\t\t\t\tgoto nla_put_failure;\n\n\t\t\tif (nla_put_u8(skb,\n\t\t\t\t       IFLA_BRIDGE_CFM_CC_PEER_STATUS_PORT_TLV_VALUE,\n\t\t\t\t       peer_mep->cc_status.port_tlv_value))\n\t\t\t\tgoto nla_put_failure;\n\n\t\t\tif (nla_put_u8(skb,\n\t\t\t\t       IFLA_BRIDGE_CFM_CC_PEER_STATUS_IF_TLV_VALUE,\n\t\t\t\t       peer_mep->cc_status.if_tlv_value))\n\t\t\t\tgoto nla_put_failure;\n\n\t\t\tif (nla_put_u32(skb,\n\t\t\t\t\tIFLA_BRIDGE_CFM_CC_PEER_STATUS_SEEN,\n\t\t\t\t\tpeer_mep->cc_status.seen))\n\t\t\t\tgoto nla_put_failure;\n\n\t\t\tif (nla_put_u32(skb,\n\t\t\t\t\tIFLA_BRIDGE_CFM_CC_PEER_STATUS_TLV_SEEN,\n\t\t\t\t\tpeer_mep->cc_status.tlv_seen))\n\t\t\t\tgoto nla_put_failure;\n\n\t\t\tif (nla_put_u32(skb,\n\t\t\t\t\tIFLA_BRIDGE_CFM_CC_PEER_STATUS_SEQ_UNEXP_SEEN,\n\t\t\t\t\tpeer_mep->cc_status.seq_unexp_seen))\n\t\t\t\tgoto nla_put_failure;\n\n\t\t\tif (getlink) {  \n\t\t\t\t \n\t\t\t\tpeer_mep->cc_status.seen = false;\n\t\t\t\tpeer_mep->cc_status.tlv_seen = false;\n\t\t\t\tpeer_mep->cc_status.seq_unexp_seen = false;\n\t\t\t}\n\n\t\t\tnla_nest_end(skb, tb);\n\t\t}\n\t}\n\n\treturn 0;\n\nnla_put_failure:\n\tnla_nest_cancel(skb, tb);\n\nnla_info_failure:\n\treturn -EMSGSIZE;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}