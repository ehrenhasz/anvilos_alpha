{
  "module_name": "vlan.h",
  "hash_id": "cf898bc06e27a9c0f557c7b57fb87c3e441fbbde883135351cf0d86fce1d1c0b",
  "original_prompt": "Ingested from linux-6.6.14/net/8021q/vlan.h",
  "human_readable_source": " \n#ifndef __BEN_VLAN_802_1Q_INC__\n#define __BEN_VLAN_802_1Q_INC__\n\n#include <linux/if_vlan.h>\n#include <linux/u64_stats_sync.h>\n#include <linux/list.h>\n\n \n#define VLAN_GROUP_ARRAY_SPLIT_PARTS  8\n#define VLAN_GROUP_ARRAY_PART_LEN     (VLAN_N_VID/VLAN_GROUP_ARRAY_SPLIT_PARTS)\n\nenum vlan_protos {\n\tVLAN_PROTO_8021Q\t= 0,\n\tVLAN_PROTO_8021AD,\n\tVLAN_PROTO_NUM,\n};\n\nstruct vlan_group {\n\tunsigned int\t\tnr_vlan_devs;\n\tstruct hlist_node\thlist;\t \n\tstruct net_device **vlan_devices_arrays[VLAN_PROTO_NUM]\n\t\t\t\t\t       [VLAN_GROUP_ARRAY_SPLIT_PARTS];\n};\n\nstruct vlan_info {\n\tstruct net_device\t*real_dev;  \n\tstruct vlan_group\tgrp;\n\tstruct list_head\tvid_list;\n\tunsigned int\t\tnr_vids;\n\tstruct rcu_head\t\trcu;\n};\n\nstatic inline int vlan_proto_idx(__be16 proto)\n{\n\tswitch (proto) {\n\tcase htons(ETH_P_8021Q):\n\t\treturn VLAN_PROTO_8021Q;\n\tcase htons(ETH_P_8021AD):\n\t\treturn VLAN_PROTO_8021AD;\n\tdefault:\n\t\tWARN(1, \"invalid VLAN protocol: 0x%04x\\n\", ntohs(proto));\n\t\treturn -EINVAL;\n\t}\n}\n\nstatic inline struct net_device *__vlan_group_get_device(struct vlan_group *vg,\n\t\t\t\t\t\t\t unsigned int pidx,\n\t\t\t\t\t\t\t u16 vlan_id)\n{\n\tstruct net_device **array;\n\n\tarray = vg->vlan_devices_arrays[pidx]\n\t\t\t\t       [vlan_id / VLAN_GROUP_ARRAY_PART_LEN];\n\n\t \n\tsmp_rmb();\n\n\treturn array ? array[vlan_id % VLAN_GROUP_ARRAY_PART_LEN] : NULL;\n}\n\nstatic inline struct net_device *vlan_group_get_device(struct vlan_group *vg,\n\t\t\t\t\t\t       __be16 vlan_proto,\n\t\t\t\t\t\t       u16 vlan_id)\n{\n\tint pidx = vlan_proto_idx(vlan_proto);\n\n\tif (pidx < 0)\n\t\treturn NULL;\n\n\treturn __vlan_group_get_device(vg, pidx, vlan_id);\n}\n\nstatic inline void vlan_group_set_device(struct vlan_group *vg,\n\t\t\t\t\t __be16 vlan_proto, u16 vlan_id,\n\t\t\t\t\t struct net_device *dev)\n{\n\tint pidx = vlan_proto_idx(vlan_proto);\n\tstruct net_device **array;\n\n\tif (!vg || pidx < 0)\n\t\treturn;\n\tarray = vg->vlan_devices_arrays[pidx]\n\t\t\t\t       [vlan_id / VLAN_GROUP_ARRAY_PART_LEN];\n\tarray[vlan_id % VLAN_GROUP_ARRAY_PART_LEN] = dev;\n}\n\n \nstatic inline struct net_device *vlan_find_dev(struct net_device *real_dev,\n\t\t\t\t\t       __be16 vlan_proto, u16 vlan_id)\n{\n\tstruct vlan_info *vlan_info = rcu_dereference_rtnl(real_dev->vlan_info);\n\n\tif (vlan_info)\n\t\treturn vlan_group_get_device(&vlan_info->grp,\n\t\t\t\t\t     vlan_proto, vlan_id);\n\n\treturn NULL;\n}\n\nstatic inline netdev_features_t vlan_tnl_features(struct net_device *real_dev)\n{\n\tnetdev_features_t ret;\n\n\tret = real_dev->hw_enc_features &\n\t      (NETIF_F_CSUM_MASK | NETIF_F_GSO_SOFTWARE |\n\t       NETIF_F_GSO_ENCAP_ALL);\n\n\tif ((ret & NETIF_F_GSO_ENCAP_ALL) && (ret & NETIF_F_CSUM_MASK))\n\t\treturn (ret & ~NETIF_F_CSUM_MASK) | NETIF_F_HW_CSUM;\n\treturn 0;\n}\n\n#define vlan_group_for_each_dev(grp, i, dev) \\\n\tfor ((i) = 0; i < VLAN_PROTO_NUM * VLAN_N_VID; i++) \\\n\t\tif (((dev) = __vlan_group_get_device((grp), (i) / VLAN_N_VID, \\\n\t\t\t\t\t\t\t    (i) % VLAN_N_VID)))\n\nint vlan_filter_push_vids(struct vlan_info *vlan_info, __be16 proto);\nvoid vlan_filter_drop_vids(struct vlan_info *vlan_info, __be16 proto);\n\n \nvoid vlan_dev_set_ingress_priority(const struct net_device *dev,\n\t\t\t\t   u32 skb_prio, u16 vlan_prio);\nint vlan_dev_set_egress_priority(const struct net_device *dev,\n\t\t\t\t u32 skb_prio, u16 vlan_prio);\nvoid vlan_dev_free_egress_priority(const struct net_device *dev);\nint vlan_dev_change_flags(const struct net_device *dev, u32 flag, u32 mask);\nvoid vlan_dev_get_realdev_name(const struct net_device *dev, char *result,\n\t\t\t       size_t size);\n\nint vlan_check_real_dev(struct net_device *real_dev,\n\t\t\t__be16 protocol, u16 vlan_id,\n\t\t\tstruct netlink_ext_ack *extack);\nvoid vlan_setup(struct net_device *dev);\nint register_vlan_dev(struct net_device *dev, struct netlink_ext_ack *extack);\nvoid unregister_vlan_dev(struct net_device *dev, struct list_head *head);\nbool vlan_dev_inherit_address(struct net_device *dev,\n\t\t\t      struct net_device *real_dev);\n\nstatic inline u32 vlan_get_ingress_priority(struct net_device *dev,\n\t\t\t\t\t    u16 vlan_tci)\n{\n\tstruct vlan_dev_priv *vip = vlan_dev_priv(dev);\n\n\treturn vip->ingress_priority_map[(vlan_tci >> VLAN_PRIO_SHIFT) & 0x7];\n}\n\n#ifdef CONFIG_VLAN_8021Q_GVRP\nint vlan_gvrp_request_join(const struct net_device *dev);\nvoid vlan_gvrp_request_leave(const struct net_device *dev);\nint vlan_gvrp_init_applicant(struct net_device *dev);\nvoid vlan_gvrp_uninit_applicant(struct net_device *dev);\nint vlan_gvrp_init(void);\nvoid vlan_gvrp_uninit(void);\n#else\nstatic inline int vlan_gvrp_request_join(const struct net_device *dev) { return 0; }\nstatic inline void vlan_gvrp_request_leave(const struct net_device *dev) {}\nstatic inline int vlan_gvrp_init_applicant(struct net_device *dev) { return 0; }\nstatic inline void vlan_gvrp_uninit_applicant(struct net_device *dev) {}\nstatic inline int vlan_gvrp_init(void) { return 0; }\nstatic inline void vlan_gvrp_uninit(void) {}\n#endif\n\n#ifdef CONFIG_VLAN_8021Q_MVRP\nint vlan_mvrp_request_join(const struct net_device *dev);\nvoid vlan_mvrp_request_leave(const struct net_device *dev);\nint vlan_mvrp_init_applicant(struct net_device *dev);\nvoid vlan_mvrp_uninit_applicant(struct net_device *dev);\nint vlan_mvrp_init(void);\nvoid vlan_mvrp_uninit(void);\n#else\nstatic inline int vlan_mvrp_request_join(const struct net_device *dev) { return 0; }\nstatic inline void vlan_mvrp_request_leave(const struct net_device *dev) {}\nstatic inline int vlan_mvrp_init_applicant(struct net_device *dev) { return 0; }\nstatic inline void vlan_mvrp_uninit_applicant(struct net_device *dev) {}\nstatic inline int vlan_mvrp_init(void) { return 0; }\nstatic inline void vlan_mvrp_uninit(void) {}\n#endif\n\nextern const char vlan_fullname[];\nextern const char vlan_version[];\nint vlan_netlink_init(void);\nvoid vlan_netlink_fini(void);\n\nextern struct rtnl_link_ops vlan_link_ops;\n\nextern unsigned int vlan_net_id;\n\nstruct proc_dir_entry;\n\nstruct vlan_net {\n\t \n\tstruct proc_dir_entry *proc_vlan_dir;\n\t \n\tstruct proc_dir_entry *proc_vlan_conf;\n\t \n\tunsigned short name_type;\n};\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}