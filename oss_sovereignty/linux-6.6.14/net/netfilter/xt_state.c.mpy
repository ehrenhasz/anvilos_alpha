{
  "module_name": "xt_state.c",
  "hash_id": "bb8a0d2615952c2034e975eb63bc6bfdc3a1b4976539f48527d7c180218036e6",
  "original_prompt": "Ingested from linux-6.6.14/net/netfilter/xt_state.c",
  "human_readable_source": "\n \n\n \n\n#include <linux/module.h>\n#include <linux/skbuff.h>\n#include <net/netfilter/nf_conntrack.h>\n#include <linux/netfilter/x_tables.h>\n#include <linux/netfilter/xt_state.h>\n\nMODULE_LICENSE(\"GPL\");\nMODULE_AUTHOR(\"Rusty Russell <rusty@rustcorp.com.au>\");\nMODULE_DESCRIPTION(\"ip[6]_tables connection tracking state match module\");\nMODULE_ALIAS(\"ipt_state\");\nMODULE_ALIAS(\"ip6t_state\");\n\nstatic bool\nstate_mt(const struct sk_buff *skb, struct xt_action_param *par)\n{\n\tconst struct xt_state_info *sinfo = par->matchinfo;\n\tenum ip_conntrack_info ctinfo;\n\tunsigned int statebit;\n\tstruct nf_conn *ct = nf_ct_get(skb, &ctinfo);\n\n\tif (ct)\n\t\tstatebit = XT_STATE_BIT(ctinfo);\n\telse if (ctinfo == IP_CT_UNTRACKED)\n\t\tstatebit = XT_STATE_UNTRACKED;\n\telse\n\t\tstatebit = XT_STATE_INVALID;\n\n\treturn (sinfo->statemask & statebit);\n}\n\nstatic int state_mt_check(const struct xt_mtchk_param *par)\n{\n\tint ret;\n\n\tret = nf_ct_netns_get(par->net, par->family);\n\tif (ret < 0)\n\t\tpr_info_ratelimited(\"cannot load conntrack support for proto=%u\\n\",\n\t\t\t\t    par->family);\n\treturn ret;\n}\n\nstatic void state_mt_destroy(const struct xt_mtdtor_param *par)\n{\n\tnf_ct_netns_put(par->net, par->family);\n}\n\nstatic struct xt_match state_mt_reg __read_mostly = {\n\t.name       = \"state\",\n\t.family     = NFPROTO_UNSPEC,\n\t.checkentry = state_mt_check,\n\t.match      = state_mt,\n\t.destroy    = state_mt_destroy,\n\t.matchsize  = sizeof(struct xt_state_info),\n\t.me         = THIS_MODULE,\n};\n\nstatic int __init state_mt_init(void)\n{\n\treturn xt_register_match(&state_mt_reg);\n}\n\nstatic void __exit state_mt_exit(void)\n{\n\txt_unregister_match(&state_mt_reg);\n}\n\nmodule_init(state_mt_init);\nmodule_exit(state_mt_exit);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}