{
  "module_name": "xt_ipcomp.c",
  "hash_id": "a2349274787d47da8678b8bdd41b5b8864c78af75d3770d9a348fa30444e1c00",
  "original_prompt": "Ingested from linux-6.6.14/net/netfilter/xt_ipcomp.c",
  "human_readable_source": "\n \n\n#define pr_fmt(fmt) KBUILD_MODNAME \": \" fmt\n#include <linux/in.h>\n#include <linux/module.h>\n#include <linux/skbuff.h>\n#include <linux/ip.h>\n\n#include <linux/netfilter/xt_ipcomp.h>\n#include <linux/netfilter/x_tables.h>\n\nMODULE_LICENSE(\"GPL\");\nMODULE_AUTHOR(\"Fan Du <fan.du@windriver.com>\");\nMODULE_DESCRIPTION(\"Xtables: IPv4/6 IPsec-IPComp SPI match\");\nMODULE_ALIAS(\"ipt_ipcomp\");\nMODULE_ALIAS(\"ip6t_ipcomp\");\n\n \nstatic inline bool\nspi_match(u_int32_t min, u_int32_t max, u_int32_t spi, bool invert)\n{\n\tbool r;\n\tpr_debug(\"spi_match:%c 0x%x <= 0x%x <= 0x%x\\n\",\n\t\t invert ? '!' : ' ', min, spi, max);\n\tr = (spi >= min && spi <= max) ^ invert;\n\tpr_debug(\" result %s\\n\", r ? \"PASS\" : \"FAILED\");\n\treturn r;\n}\n\nstatic bool comp_mt(const struct sk_buff *skb, struct xt_action_param *par)\n{\n\tstruct ip_comp_hdr _comphdr;\n\tconst struct ip_comp_hdr *chdr;\n\tconst struct xt_ipcomp *compinfo = par->matchinfo;\n\n\t \n\tif (par->fragoff != 0)\n\t\treturn false;\n\n\tchdr = skb_header_pointer(skb, par->thoff, sizeof(_comphdr), &_comphdr);\n\tif (chdr == NULL) {\n\t\t \n\t\tpr_debug(\"Dropping evil IPComp tinygram.\\n\");\n\t\tpar->hotdrop = true;\n\t\treturn false;\n\t}\n\n\treturn spi_match(compinfo->spis[0], compinfo->spis[1],\n\t\t\t ntohs(chdr->cpi),\n\t\t\t !!(compinfo->invflags & XT_IPCOMP_INV_SPI));\n}\n\nstatic int comp_mt_check(const struct xt_mtchk_param *par)\n{\n\tconst struct xt_ipcomp *compinfo = par->matchinfo;\n\n\t \n\tif (compinfo->invflags & ~XT_IPCOMP_INV_MASK) {\n\t\tpr_info_ratelimited(\"unknown flags %X\\n\", compinfo->invflags);\n\t\treturn -EINVAL;\n\t}\n\treturn 0;\n}\n\nstatic struct xt_match comp_mt_reg[] __read_mostly = {\n\t{\n\t\t.name\t\t= \"ipcomp\",\n\t\t.family\t\t= NFPROTO_IPV4,\n\t\t.match\t\t= comp_mt,\n\t\t.matchsize\t= sizeof(struct xt_ipcomp),\n\t\t.proto\t\t= IPPROTO_COMP,\n\t\t.checkentry\t= comp_mt_check,\n\t\t.me\t\t= THIS_MODULE,\n\t},\n\t{\n\t\t.name\t\t= \"ipcomp\",\n\t\t.family\t\t= NFPROTO_IPV6,\n\t\t.match\t\t= comp_mt,\n\t\t.matchsize\t= sizeof(struct xt_ipcomp),\n\t\t.proto\t\t= IPPROTO_COMP,\n\t\t.checkentry\t= comp_mt_check,\n\t\t.me\t\t= THIS_MODULE,\n\t},\n};\n\nstatic int __init comp_mt_init(void)\n{\n\treturn xt_register_matches(comp_mt_reg, ARRAY_SIZE(comp_mt_reg));\n}\n\nstatic void __exit comp_mt_exit(void)\n{\n\txt_unregister_matches(comp_mt_reg, ARRAY_SIZE(comp_mt_reg));\n}\n\nmodule_init(comp_mt_init);\nmodule_exit(comp_mt_exit);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}