{
  "module_name": "xt_tcpmss.c",
  "hash_id": "94df71da01f9724ed38c760ddd3bff350dfea3738c6cd2ebd2cd17bc56ffb02c",
  "original_prompt": "Ingested from linux-6.6.14/net/netfilter/xt_tcpmss.c",
  "human_readable_source": "\n \n\n \n\n#include <linux/module.h>\n#include <linux/skbuff.h>\n#include <net/tcp.h>\n\n#include <linux/netfilter/xt_tcpmss.h>\n#include <linux/netfilter/x_tables.h>\n\n#include <linux/netfilter_ipv4/ip_tables.h>\n#include <linux/netfilter_ipv6/ip6_tables.h>\n\nMODULE_LICENSE(\"GPL\");\nMODULE_AUTHOR(\"Marc Boucher <marc@mbsi.ca>\");\nMODULE_DESCRIPTION(\"Xtables: TCP MSS match\");\nMODULE_ALIAS(\"ipt_tcpmss\");\nMODULE_ALIAS(\"ip6t_tcpmss\");\n\nstatic bool\ntcpmss_mt(const struct sk_buff *skb, struct xt_action_param *par)\n{\n\tconst struct xt_tcpmss_match_info *info = par->matchinfo;\n\tconst struct tcphdr *th;\n\tstruct tcphdr _tcph;\n\t \n\tconst u_int8_t *op;\n\tu8 _opt[15 * 4 - sizeof(_tcph)];\n\tunsigned int i, optlen;\n\n\t \n\tth = skb_header_pointer(skb, par->thoff, sizeof(_tcph), &_tcph);\n\tif (th == NULL)\n\t\tgoto dropit;\n\n\t \n\tif (th->doff*4 < sizeof(*th))\n\t\tgoto dropit;\n\n\toptlen = th->doff*4 - sizeof(*th);\n\tif (!optlen)\n\t\tgoto out;\n\n\t \n\top = skb_header_pointer(skb, par->thoff + sizeof(*th), optlen, _opt);\n\tif (op == NULL)\n\t\tgoto dropit;\n\n\tfor (i = 0; i < optlen; ) {\n\t\tif (op[i] == TCPOPT_MSS\n\t\t    && (optlen - i) >= TCPOLEN_MSS\n\t\t    && op[i+1] == TCPOLEN_MSS) {\n\t\t\tu_int16_t mssval;\n\n\t\t\tmssval = (op[i+2] << 8) | op[i+3];\n\n\t\t\treturn (mssval >= info->mss_min &&\n\t\t\t\tmssval <= info->mss_max) ^ info->invert;\n\t\t}\n\t\tif (op[i] < 2)\n\t\t\ti++;\n\t\telse\n\t\t\ti += op[i+1] ? : 1;\n\t}\nout:\n\treturn info->invert;\n\ndropit:\n\tpar->hotdrop = true;\n\treturn false;\n}\n\nstatic struct xt_match tcpmss_mt_reg[] __read_mostly = {\n\t{\n\t\t.name\t\t= \"tcpmss\",\n\t\t.family\t\t= NFPROTO_IPV4,\n\t\t.match\t\t= tcpmss_mt,\n\t\t.matchsize\t= sizeof(struct xt_tcpmss_match_info),\n\t\t.proto\t\t= IPPROTO_TCP,\n\t\t.me\t\t= THIS_MODULE,\n\t},\n\t{\n\t\t.name\t\t= \"tcpmss\",\n\t\t.family\t\t= NFPROTO_IPV6,\n\t\t.match\t\t= tcpmss_mt,\n\t\t.matchsize\t= sizeof(struct xt_tcpmss_match_info),\n\t\t.proto\t\t= IPPROTO_TCP,\n\t\t.me\t\t= THIS_MODULE,\n\t},\n};\n\nstatic int __init tcpmss_mt_init(void)\n{\n\treturn xt_register_matches(tcpmss_mt_reg, ARRAY_SIZE(tcpmss_mt_reg));\n}\n\nstatic void __exit tcpmss_mt_exit(void)\n{\n\txt_unregister_matches(tcpmss_mt_reg, ARRAY_SIZE(tcpmss_mt_reg));\n}\n\nmodule_init(tcpmss_mt_init);\nmodule_exit(tcpmss_mt_exit);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}