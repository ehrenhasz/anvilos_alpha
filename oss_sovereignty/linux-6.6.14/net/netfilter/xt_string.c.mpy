{
  "module_name": "xt_string.c",
  "hash_id": "14f0a6bf2668ef1067116e89ff4488f37c2080f2b5cb5e992191382123f0e2dc",
  "original_prompt": "Ingested from linux-6.6.14/net/netfilter/xt_string.c",
  "human_readable_source": "\n \n\n#include <linux/gfp.h>\n#include <linux/init.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/skbuff.h>\n#include <linux/netfilter/x_tables.h>\n#include <linux/netfilter/xt_string.h>\n#include <linux/textsearch.h>\n\nMODULE_AUTHOR(\"Pablo Neira Ayuso <pablo@eurodev.net>\");\nMODULE_DESCRIPTION(\"Xtables: string-based matching\");\nMODULE_LICENSE(\"GPL\");\nMODULE_ALIAS(\"ipt_string\");\nMODULE_ALIAS(\"ip6t_string\");\nMODULE_ALIAS(\"ebt_string\");\n\nstatic bool\nstring_mt(const struct sk_buff *skb, struct xt_action_param *par)\n{\n\tconst struct xt_string_info *conf = par->matchinfo;\n\tbool invert;\n\n\tinvert = conf->u.v1.flags & XT_STRING_FLAG_INVERT;\n\n\treturn (skb_find_text((struct sk_buff *)skb, conf->from_offset,\n\t\t\t     conf->to_offset, conf->config)\n\t\t\t     != UINT_MAX) ^ invert;\n}\n\n#define STRING_TEXT_PRIV(m) ((struct xt_string_info *)(m))\n\nstatic int string_mt_check(const struct xt_mtchk_param *par)\n{\n\tstruct xt_string_info *conf = par->matchinfo;\n\tstruct ts_config *ts_conf;\n\tint flags = TS_AUTOLOAD;\n\n\t \n\tif (conf->from_offset > conf->to_offset)\n\t\treturn -EINVAL;\n\tif (conf->algo[XT_STRING_MAX_ALGO_NAME_SIZE - 1] != '\\0')\n\t\treturn -EINVAL;\n\tif (conf->patlen > XT_STRING_MAX_PATTERN_SIZE)\n\t\treturn -EINVAL;\n\tif (conf->u.v1.flags &\n\t    ~(XT_STRING_FLAG_IGNORECASE | XT_STRING_FLAG_INVERT))\n\t\treturn -EINVAL;\n\tif (conf->u.v1.flags & XT_STRING_FLAG_IGNORECASE)\n\t\tflags |= TS_IGNORECASE;\n\tts_conf = textsearch_prepare(conf->algo, conf->pattern, conf->patlen,\n\t\t\t\t     GFP_KERNEL, flags);\n\tif (IS_ERR(ts_conf))\n\t\treturn PTR_ERR(ts_conf);\n\n\tconf->config = ts_conf;\n\treturn 0;\n}\n\nstatic void string_mt_destroy(const struct xt_mtdtor_param *par)\n{\n\ttextsearch_destroy(STRING_TEXT_PRIV(par->matchinfo)->config);\n}\n\nstatic struct xt_match xt_string_mt_reg __read_mostly = {\n\t.name       = \"string\",\n\t.revision   = 1,\n\t.family     = NFPROTO_UNSPEC,\n\t.checkentry = string_mt_check,\n\t.match      = string_mt,\n\t.destroy    = string_mt_destroy,\n\t.matchsize  = sizeof(struct xt_string_info),\n\t.usersize   = offsetof(struct xt_string_info, config),\n\t.me         = THIS_MODULE,\n};\n\nstatic int __init string_mt_init(void)\n{\n\treturn xt_register_match(&xt_string_mt_reg);\n}\n\nstatic void __exit string_mt_exit(void)\n{\n\txt_unregister_match(&xt_string_mt_reg);\n}\n\nmodule_init(string_mt_init);\nmodule_exit(string_mt_exit);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}