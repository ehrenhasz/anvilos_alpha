{
  "module_name": "nf_conntrack_broadcast.c",
  "hash_id": "4e212f46a182e6384298116af75cf093f5700a7255275573162651a8df389c03",
  "original_prompt": "Ingested from linux-6.6.14/net/netfilter/nf_conntrack_broadcast.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/ip.h>\n#include <net/route.h>\n#include <linux/inetdevice.h>\n#include <linux/skbuff.h>\n\n#include <net/netfilter/nf_conntrack.h>\n#include <net/netfilter/nf_conntrack_helper.h>\n#include <net/netfilter/nf_conntrack_expect.h>\n\nint nf_conntrack_broadcast_help(struct sk_buff *skb,\n\t\t\t\tstruct nf_conn *ct,\n\t\t\t\tenum ip_conntrack_info ctinfo,\n\t\t\t\tunsigned int timeout)\n{\n\tconst struct nf_conntrack_helper *helper;\n\tstruct nf_conntrack_expect *exp;\n\tstruct iphdr *iph = ip_hdr(skb);\n\tstruct rtable *rt = skb_rtable(skb);\n\tstruct in_device *in_dev;\n\tstruct nf_conn_help *help = nfct_help(ct);\n\t__be32 mask = 0;\n\n\t \n\tif (skb->sk == NULL || !net_eq(nf_ct_net(ct), sock_net(skb->sk)))\n\t\tgoto out;\n\tif (rt == NULL || !(rt->rt_flags & RTCF_BROADCAST))\n\t\tgoto out;\n\tif (CTINFO2DIR(ctinfo) != IP_CT_DIR_ORIGINAL)\n\t\tgoto out;\n\n\tin_dev = __in_dev_get_rcu(rt->dst.dev);\n\tif (in_dev != NULL) {\n\t\tconst struct in_ifaddr *ifa;\n\n\t\tin_dev_for_each_ifa_rcu(ifa, in_dev) {\n\t\t\tif (ifa->ifa_flags & IFA_F_SECONDARY)\n\t\t\t\tcontinue;\n\n\t\t\tif (ifa->ifa_broadcast == iph->daddr) {\n\t\t\t\tmask = ifa->ifa_mask;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tif (mask == 0)\n\t\tgoto out;\n\n\texp = nf_ct_expect_alloc(ct);\n\tif (exp == NULL)\n\t\tgoto out;\n\n\texp->tuple                = ct->tuplehash[IP_CT_DIR_REPLY].tuple;\n\n\thelper = rcu_dereference(help->helper);\n\tif (helper)\n\t\texp->tuple.src.u.udp.port = helper->tuple.src.u.udp.port;\n\n\texp->mask.src.u3.ip       = mask;\n\texp->mask.src.u.udp.port  = htons(0xFFFF);\n\n\texp->expectfn             = NULL;\n\texp->flags                = NF_CT_EXPECT_PERMANENT;\n\texp->class\t\t  = NF_CT_EXPECT_CLASS_DEFAULT;\n\texp->helper               = NULL;\n\n\tnf_ct_expect_related(exp, 0);\n\tnf_ct_expect_put(exp);\n\n\tnf_ct_refresh(ct, skb, timeout * HZ);\nout:\n\treturn NF_ACCEPT;\n}\nEXPORT_SYMBOL_GPL(nf_conntrack_broadcast_help);\n\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}