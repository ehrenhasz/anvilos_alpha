{
  "module_name": "nft_chain_nat.c",
  "hash_id": "b78ea6839506fea7a999a19e899387fc08e1cc552ec14bec2e7239f74de647a1",
  "original_prompt": "Ingested from linux-6.6.14/net/netfilter/nft_chain_nat.c",
  "human_readable_source": "\n\n#include <linux/module.h>\n#include <linux/netfilter/nf_tables.h>\n#include <net/netfilter/nf_nat.h>\n#include <net/netfilter/nf_tables.h>\n#include <net/netfilter/nf_tables_ipv4.h>\n#include <net/netfilter/nf_tables_ipv6.h>\n\nstatic unsigned int nft_nat_do_chain(void *priv, struct sk_buff *skb,\n\t\t\t\t     const struct nf_hook_state *state)\n{\n\tstruct nft_pktinfo pkt;\n\n\tnft_set_pktinfo(&pkt, skb, state);\n\n\tswitch (state->pf) {\n#ifdef CONFIG_NF_TABLES_IPV4\n\tcase NFPROTO_IPV4:\n\t\tnft_set_pktinfo_ipv4(&pkt);\n\t\tbreak;\n#endif\n#ifdef CONFIG_NF_TABLES_IPV6\n\tcase NFPROTO_IPV6:\n\t\tnft_set_pktinfo_ipv6(&pkt);\n\t\tbreak;\n#endif\n\tdefault:\n\t\tbreak;\n\t}\n\n\treturn nft_do_chain(&pkt, priv);\n}\n\n#ifdef CONFIG_NF_TABLES_IPV4\nstatic const struct nft_chain_type nft_chain_nat_ipv4 = {\n\t.name\t\t= \"nat\",\n\t.type\t\t= NFT_CHAIN_T_NAT,\n\t.family\t\t= NFPROTO_IPV4,\n\t.owner\t\t= THIS_MODULE,\n\t.hook_mask\t= (1 << NF_INET_PRE_ROUTING) |\n\t\t\t  (1 << NF_INET_POST_ROUTING) |\n\t\t\t  (1 << NF_INET_LOCAL_OUT) |\n\t\t\t  (1 << NF_INET_LOCAL_IN),\n\t.hooks\t\t= {\n\t\t[NF_INET_PRE_ROUTING]\t= nft_nat_do_chain,\n\t\t[NF_INET_POST_ROUTING]\t= nft_nat_do_chain,\n\t\t[NF_INET_LOCAL_OUT]\t= nft_nat_do_chain,\n\t\t[NF_INET_LOCAL_IN]\t= nft_nat_do_chain,\n\t},\n\t.ops_register = nf_nat_ipv4_register_fn,\n\t.ops_unregister = nf_nat_ipv4_unregister_fn,\n};\n#endif\n\n#ifdef CONFIG_NF_TABLES_IPV6\nstatic const struct nft_chain_type nft_chain_nat_ipv6 = {\n\t.name\t\t= \"nat\",\n\t.type\t\t= NFT_CHAIN_T_NAT,\n\t.family\t\t= NFPROTO_IPV6,\n\t.owner\t\t= THIS_MODULE,\n\t.hook_mask\t= (1 << NF_INET_PRE_ROUTING) |\n\t\t\t  (1 << NF_INET_POST_ROUTING) |\n\t\t\t  (1 << NF_INET_LOCAL_OUT) |\n\t\t\t  (1 << NF_INET_LOCAL_IN),\n\t.hooks\t\t= {\n\t\t[NF_INET_PRE_ROUTING]\t= nft_nat_do_chain,\n\t\t[NF_INET_POST_ROUTING]\t= nft_nat_do_chain,\n\t\t[NF_INET_LOCAL_OUT]\t= nft_nat_do_chain,\n\t\t[NF_INET_LOCAL_IN]\t= nft_nat_do_chain,\n\t},\n\t.ops_register\t\t= nf_nat_ipv6_register_fn,\n\t.ops_unregister\t\t= nf_nat_ipv6_unregister_fn,\n};\n#endif\n\n#ifdef CONFIG_NF_TABLES_INET\nstatic int nft_nat_inet_reg(struct net *net, const struct nf_hook_ops *ops)\n{\n\treturn nf_nat_inet_register_fn(net, ops);\n}\n\nstatic void nft_nat_inet_unreg(struct net *net, const struct nf_hook_ops *ops)\n{\n\tnf_nat_inet_unregister_fn(net, ops);\n}\n\nstatic const struct nft_chain_type nft_chain_nat_inet = {\n\t.name\t\t= \"nat\",\n\t.type\t\t= NFT_CHAIN_T_NAT,\n\t.family\t\t= NFPROTO_INET,\n\t.owner\t\t= THIS_MODULE,\n\t.hook_mask\t= (1 << NF_INET_PRE_ROUTING) |\n\t\t\t  (1 << NF_INET_LOCAL_IN) |\n\t\t\t  (1 << NF_INET_LOCAL_OUT) |\n\t\t\t  (1 << NF_INET_POST_ROUTING),\n\t.hooks\t\t= {\n\t\t[NF_INET_PRE_ROUTING]\t= nft_nat_do_chain,\n\t\t[NF_INET_LOCAL_IN]\t= nft_nat_do_chain,\n\t\t[NF_INET_LOCAL_OUT]\t= nft_nat_do_chain,\n\t\t[NF_INET_POST_ROUTING]\t= nft_nat_do_chain,\n\t},\n\t.ops_register\t\t= nft_nat_inet_reg,\n\t.ops_unregister\t\t= nft_nat_inet_unreg,\n};\n#endif\n\nstatic int __init nft_chain_nat_init(void)\n{\n#ifdef CONFIG_NF_TABLES_IPV6\n\tnft_register_chain_type(&nft_chain_nat_ipv6);\n#endif\n#ifdef CONFIG_NF_TABLES_IPV4\n\tnft_register_chain_type(&nft_chain_nat_ipv4);\n#endif\n#ifdef CONFIG_NF_TABLES_INET\n\tnft_register_chain_type(&nft_chain_nat_inet);\n#endif\n\n\treturn 0;\n}\n\nstatic void __exit nft_chain_nat_exit(void)\n{\n#ifdef CONFIG_NF_TABLES_IPV4\n\tnft_unregister_chain_type(&nft_chain_nat_ipv4);\n#endif\n#ifdef CONFIG_NF_TABLES_IPV6\n\tnft_unregister_chain_type(&nft_chain_nat_ipv6);\n#endif\n#ifdef CONFIG_NF_TABLES_INET\n\tnft_unregister_chain_type(&nft_chain_nat_inet);\n#endif\n}\n\nmodule_init(nft_chain_nat_init);\nmodule_exit(nft_chain_nat_exit);\n\nMODULE_LICENSE(\"GPL\");\n#ifdef CONFIG_NF_TABLES_IPV4\nMODULE_ALIAS_NFT_CHAIN(AF_INET, \"nat\");\n#endif\n#ifdef CONFIG_NF_TABLES_IPV6\nMODULE_ALIAS_NFT_CHAIN(AF_INET6, \"nat\");\n#endif\n#ifdef CONFIG_NF_TABLES_INET\nMODULE_ALIAS_NFT_CHAIN(1, \"nat\");\t \n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}