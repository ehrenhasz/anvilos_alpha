{
  "module_name": "ip_vs_proto_ah_esp.c",
  "hash_id": "1fd8e3bd89ac1093dfc8e6b38ad2448f3b1a35d9a65243e9c4da636d5ba06792",
  "original_prompt": "Ingested from linux-6.6.14/net/netfilter/ipvs/ip_vs_proto_ah_esp.c",
  "human_readable_source": "\n \n\n#define KMSG_COMPONENT \"IPVS\"\n#define pr_fmt(fmt) KMSG_COMPONENT \": \" fmt\n\n#include <linux/in.h>\n#include <linux/ip.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/netfilter.h>\n#include <linux/netfilter_ipv4.h>\n\n#include <net/ip_vs.h>\n\n\n \n\n#define PORT_ISAKMP\t500\n\nstatic void\nah_esp_conn_fill_param_proto(struct netns_ipvs *ipvs, int af,\n\t\t\t     const struct ip_vs_iphdr *iph,\n\t\t\t     struct ip_vs_conn_param *p)\n{\n\tif (likely(!ip_vs_iph_inverse(iph)))\n\t\tip_vs_conn_fill_param(ipvs, af, IPPROTO_UDP,\n\t\t\t\t      &iph->saddr, htons(PORT_ISAKMP),\n\t\t\t\t      &iph->daddr, htons(PORT_ISAKMP), p);\n\telse\n\t\tip_vs_conn_fill_param(ipvs, af, IPPROTO_UDP,\n\t\t\t\t      &iph->daddr, htons(PORT_ISAKMP),\n\t\t\t\t      &iph->saddr, htons(PORT_ISAKMP), p);\n}\n\nstatic struct ip_vs_conn *\nah_esp_conn_in_get(struct netns_ipvs *ipvs, int af, const struct sk_buff *skb,\n\t\t   const struct ip_vs_iphdr *iph)\n{\n\tstruct ip_vs_conn *cp;\n\tstruct ip_vs_conn_param p;\n\n\tah_esp_conn_fill_param_proto(ipvs, af, iph, &p);\n\tcp = ip_vs_conn_in_get(&p);\n\tif (!cp) {\n\t\t \n\t\tIP_VS_DBG_BUF(12, \"Unknown ISAKMP entry for outin packet \"\n\t\t\t      \"%s%s %s->%s\\n\",\n\t\t\t      ip_vs_iph_icmp(iph) ? \"ICMP+\" : \"\",\n\t\t\t      ip_vs_proto_get(iph->protocol)->name,\n\t\t\t      IP_VS_DBG_ADDR(af, &iph->saddr),\n\t\t\t      IP_VS_DBG_ADDR(af, &iph->daddr));\n\t}\n\n\treturn cp;\n}\n\n\nstatic struct ip_vs_conn *\nah_esp_conn_out_get(struct netns_ipvs *ipvs, int af, const struct sk_buff *skb,\n\t\t    const struct ip_vs_iphdr *iph)\n{\n\tstruct ip_vs_conn *cp;\n\tstruct ip_vs_conn_param p;\n\n\tah_esp_conn_fill_param_proto(ipvs, af, iph, &p);\n\tcp = ip_vs_conn_out_get(&p);\n\tif (!cp) {\n\t\tIP_VS_DBG_BUF(12, \"Unknown ISAKMP entry for inout packet \"\n\t\t\t      \"%s%s %s->%s\\n\",\n\t\t\t      ip_vs_iph_icmp(iph) ? \"ICMP+\" : \"\",\n\t\t\t      ip_vs_proto_get(iph->protocol)->name,\n\t\t\t      IP_VS_DBG_ADDR(af, &iph->saddr),\n\t\t\t      IP_VS_DBG_ADDR(af, &iph->daddr));\n\t}\n\n\treturn cp;\n}\n\n\nstatic int\nah_esp_conn_schedule(struct netns_ipvs *ipvs, int af, struct sk_buff *skb,\n\t\t     struct ip_vs_proto_data *pd,\n\t\t     int *verdict, struct ip_vs_conn **cpp,\n\t\t     struct ip_vs_iphdr *iph)\n{\n\t \n\t*verdict = NF_ACCEPT;\n\treturn 0;\n}\n\n#ifdef CONFIG_IP_VS_PROTO_AH\nstruct ip_vs_protocol ip_vs_protocol_ah = {\n\t.name =\t\t\t\"AH\",\n\t.protocol =\t\tIPPROTO_AH,\n\t.num_states =\t\t1,\n\t.dont_defrag =\t\t1,\n\t.init =\t\t\tNULL,\n\t.exit =\t\t\tNULL,\n\t.conn_schedule =\tah_esp_conn_schedule,\n\t.conn_in_get =\t\tah_esp_conn_in_get,\n\t.conn_out_get =\t\tah_esp_conn_out_get,\n\t.snat_handler =\t\tNULL,\n\t.dnat_handler =\t\tNULL,\n\t.state_transition =\tNULL,\n\t.register_app =\t\tNULL,\n\t.unregister_app =\tNULL,\n\t.app_conn_bind =\tNULL,\n\t.debug_packet =\t\tip_vs_tcpudp_debug_packet,\n\t.timeout_change =\tNULL,\t\t \n};\n#endif\n\n#ifdef CONFIG_IP_VS_PROTO_ESP\nstruct ip_vs_protocol ip_vs_protocol_esp = {\n\t.name =\t\t\t\"ESP\",\n\t.protocol =\t\tIPPROTO_ESP,\n\t.num_states =\t\t1,\n\t.dont_defrag =\t\t1,\n\t.init =\t\t\tNULL,\n\t.exit =\t\t\tNULL,\n\t.conn_schedule =\tah_esp_conn_schedule,\n\t.conn_in_get =\t\tah_esp_conn_in_get,\n\t.conn_out_get =\t\tah_esp_conn_out_get,\n\t.snat_handler =\t\tNULL,\n\t.dnat_handler =\t\tNULL,\n\t.state_transition =\tNULL,\n\t.register_app =\t\tNULL,\n\t.unregister_app =\tNULL,\n\t.app_conn_bind =\tNULL,\n\t.debug_packet =\t\tip_vs_tcpudp_debug_packet,\n\t.timeout_change =\tNULL,\t\t \n};\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}