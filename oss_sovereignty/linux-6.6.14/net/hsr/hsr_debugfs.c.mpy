{
  "module_name": "hsr_debugfs.c",
  "hash_id": "1ef33e70c6a96d90ff564539032e5997ab0b062bbbc77375f94c6eaf1bccd523",
  "original_prompt": "Ingested from linux-6.6.14/net/hsr/hsr_debugfs.c",
  "human_readable_source": "\n \n#include <linux/module.h>\n#include <linux/errno.h>\n#include <linux/debugfs.h>\n#include \"hsr_main.h\"\n#include \"hsr_framereg.h\"\n\nstatic struct dentry *hsr_debugfs_root_dir;\n\n \nstatic int\nhsr_node_table_show(struct seq_file *sfp, void *data)\n{\n\tstruct hsr_priv *priv = (struct hsr_priv *)sfp->private;\n\tstruct hsr_node *node;\n\n\tseq_printf(sfp, \"Node Table entries for (%s) device\\n\",\n\t\t   (priv->prot_version == PRP_V1 ? \"PRP\" : \"HSR\"));\n\tseq_puts(sfp, \"MAC-Address-A,    MAC-Address-B,    time_in[A], \");\n\tseq_puts(sfp, \"time_in[B], Address-B port, \");\n\tif (priv->prot_version == PRP_V1)\n\t\tseq_puts(sfp, \"SAN-A, SAN-B, DAN-P\\n\");\n\telse\n\t\tseq_puts(sfp, \"DAN-H\\n\");\n\n\trcu_read_lock();\n\tlist_for_each_entry_rcu(node, &priv->node_db, mac_list) {\n\t\t \n\t\tif (hsr_addr_is_self(priv, node->macaddress_A))\n\t\t\tcontinue;\n\t\tseq_printf(sfp, \"%pM \", &node->macaddress_A[0]);\n\t\tseq_printf(sfp, \"%pM \", &node->macaddress_B[0]);\n\t\tseq_printf(sfp, \"%10lx, \", node->time_in[HSR_PT_SLAVE_A]);\n\t\tseq_printf(sfp, \"%10lx, \", node->time_in[HSR_PT_SLAVE_B]);\n\t\tseq_printf(sfp, \"%14x, \", node->addr_B_port);\n\n\t\tif (priv->prot_version == PRP_V1)\n\t\t\tseq_printf(sfp, \"%5x, %5x, %5x\\n\",\n\t\t\t\t   node->san_a, node->san_b,\n\t\t\t\t   (node->san_a == 0 && node->san_b == 0));\n\t\telse\n\t\t\tseq_printf(sfp, \"%5x\\n\", 1);\n\t}\n\trcu_read_unlock();\n\treturn 0;\n}\n\nDEFINE_SHOW_ATTRIBUTE(hsr_node_table);\n\nvoid hsr_debugfs_rename(struct net_device *dev)\n{\n\tstruct hsr_priv *priv = netdev_priv(dev);\n\tstruct dentry *d;\n\n\td = debugfs_rename(hsr_debugfs_root_dir, priv->node_tbl_root,\n\t\t\t   hsr_debugfs_root_dir, dev->name);\n\tif (IS_ERR(d))\n\t\tnetdev_warn(dev, \"failed to rename\\n\");\n\telse\n\t\tpriv->node_tbl_root = d;\n}\n\n \nvoid hsr_debugfs_init(struct hsr_priv *priv, struct net_device *hsr_dev)\n{\n\tstruct dentry *de = NULL;\n\n\tde = debugfs_create_dir(hsr_dev->name, hsr_debugfs_root_dir);\n\tif (IS_ERR(de)) {\n\t\tpr_err(\"Cannot create hsr debugfs directory\\n\");\n\t\treturn;\n\t}\n\n\tpriv->node_tbl_root = de;\n\n\tde = debugfs_create_file(\"node_table\", S_IFREG | 0444,\n\t\t\t\t priv->node_tbl_root, priv,\n\t\t\t\t &hsr_node_table_fops);\n\tif (IS_ERR(de)) {\n\t\tpr_err(\"Cannot create hsr node_table file\\n\");\n\t\tdebugfs_remove(priv->node_tbl_root);\n\t\tpriv->node_tbl_root = NULL;\n\t\treturn;\n\t}\n}\n\n \nvoid\nhsr_debugfs_term(struct hsr_priv *priv)\n{\n\tdebugfs_remove_recursive(priv->node_tbl_root);\n\tpriv->node_tbl_root = NULL;\n}\n\nvoid hsr_debugfs_create_root(void)\n{\n\thsr_debugfs_root_dir = debugfs_create_dir(\"hsr\", NULL);\n\tif (IS_ERR(hsr_debugfs_root_dir)) {\n\t\tpr_err(\"Cannot create hsr debugfs root directory\\n\");\n\t\thsr_debugfs_root_dir = NULL;\n\t}\n}\n\nvoid hsr_debugfs_remove_root(void)\n{\n\t \n\tdebugfs_remove(hsr_debugfs_root_dir);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}