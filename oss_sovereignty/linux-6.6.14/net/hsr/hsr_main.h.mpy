{
  "module_name": "hsr_main.h",
  "hash_id": "e77465fa15ca164d627243ebcba86912f353165411a68ffdfbe71fcfd755153a",
  "original_prompt": "Ingested from linux-6.6.14/net/hsr/hsr_main.h",
  "human_readable_source": " \n \n\n#ifndef __HSR_PRIVATE_H\n#define __HSR_PRIVATE_H\n\n#include <linux/netdevice.h>\n#include <linux/list.h>\n#include <linux/if_vlan.h>\n#include <linux/if_hsr.h>\n\n \n#define HSR_LIFE_CHECK_INTERVAL\t\t 2000  \n#define HSR_NODE_FORGET_TIME\t\t60000  \n#define HSR_ANNOUNCE_INTERVAL\t\t  100  \n#define HSR_ENTRY_FORGET_TIME\t\t  400  \n\n \n#define MAX_SLAVE_DIFF\t\t\t 3000  \n#define HSR_SEQNR_START\t\t\t(USHRT_MAX - 1024)\n#define HSR_SUP_SEQNR_START\t\t(HSR_SEQNR_START / 2)\n\n \n#define PRUNE_PERIOD\t\t\t 3000  \n#define HSR_TLV_EOT\t\t\t\t   0   \n#define HSR_TLV_ANNOUNCE\t\t   22\n#define HSR_TLV_LIFE_CHECK\t\t   23\n \n#define PRP_TLV_LIFE_CHECK_DD\t\t   20\n \n#define PRP_TLV_LIFE_CHECK_DA\t\t   21\n \n#define PRP_TLV_REDBOX_MAC\t\t   30\n\n#define HSR_V1_SUP_LSDUSIZE\t\t52\n\n \n\nstatic inline void set_hsr_tag_path(struct hsr_tag *ht, u16 path)\n{\n\tht->path_and_LSDU_size =\n\t\thtons((ntohs(ht->path_and_LSDU_size) & 0x0FFF) | (path << 12));\n}\n\nstatic inline void set_hsr_tag_LSDU_size(struct hsr_tag *ht, u16 LSDU_size)\n{\n\tht->path_and_LSDU_size = htons((ntohs(ht->path_and_LSDU_size) &\n\t\t\t\t       0xF000) | (LSDU_size & 0x0FFF));\n}\n\nstruct hsr_ethhdr {\n\tstruct ethhdr\tethhdr;\n\tstruct hsr_tag\thsr_tag;\n} __packed;\n\nstruct hsr_vlan_ethhdr {\n\tstruct vlan_ethhdr vlanhdr;\n\tstruct hsr_tag\thsr_tag;\n} __packed;\n\nstruct hsr_sup_tlv {\n\tu8\t\tHSR_TLV_type;\n\tu8\t\tHSR_TLV_length;\n} __packed;\n\n \nstruct hsr_sup_tag {\n\t__be16\t\t\t\tpath_and_HSR_ver;\n\t__be16\t\t\t\tsequence_nr;\n\tstruct hsr_sup_tlv  tlv;\n} __packed;\n\nstruct hsr_sup_payload {\n\tunsigned char\tmacaddress_A[ETH_ALEN];\n} __packed;\n\nstatic inline void set_hsr_stag_path(struct hsr_sup_tag *hst, u16 path)\n{\n\tset_hsr_tag_path((struct hsr_tag *)hst, path);\n}\n\nstatic inline void set_hsr_stag_HSR_ver(struct hsr_sup_tag *hst, u16 HSR_ver)\n{\n\tset_hsr_tag_LSDU_size((struct hsr_tag *)hst, HSR_ver);\n}\n\nstruct hsrv0_ethhdr_sp {\n\tstruct ethhdr\t\tethhdr;\n\tstruct hsr_sup_tag\thsr_sup;\n} __packed;\n\nstruct hsrv1_ethhdr_sp {\n\tstruct ethhdr\t\tethhdr;\n\tstruct hsr_tag\t\thsr;\n\tstruct hsr_sup_tag\thsr_sup;\n} __packed;\n\nenum hsr_port_type {\n\tHSR_PT_NONE = 0,\t \n\tHSR_PT_SLAVE_A,\n\tHSR_PT_SLAVE_B,\n\tHSR_PT_INTERLINK,\n\tHSR_PT_MASTER,\n\tHSR_PT_PORTS,\t \n};\n\n \nstruct prp_rct {\n\t__be16          sequence_nr;\n\t__be16          lan_id_and_LSDU_size;\n\t__be16          PRP_suffix;\n} __packed;\n\nstatic inline u16 get_prp_LSDU_size(struct prp_rct *rct)\n{\n\treturn ntohs(rct->lan_id_and_LSDU_size) & 0x0FFF;\n}\n\nstatic inline void set_prp_lan_id(struct prp_rct *rct, u16 lan_id)\n{\n\trct->lan_id_and_LSDU_size = htons((ntohs(rct->lan_id_and_LSDU_size) &\n\t\t\t\t\t  0x0FFF) | (lan_id << 12));\n}\nstatic inline void set_prp_LSDU_size(struct prp_rct *rct, u16 LSDU_size)\n{\n\trct->lan_id_and_LSDU_size = htons((ntohs(rct->lan_id_and_LSDU_size) &\n\t\t\t\t\t  0xF000) | (LSDU_size & 0x0FFF));\n}\n\nstruct hsr_port {\n\tstruct list_head\tport_list;\n\tstruct net_device\t*dev;\n\tstruct hsr_priv\t\t*hsr;\n\tenum hsr_port_type\ttype;\n};\n\nstruct hsr_frame_info;\nstruct hsr_node;\n\nstruct hsr_proto_ops {\n\t \n\tvoid (*send_sv_frame)(struct hsr_port *port, unsigned long *interval);\n\tvoid (*handle_san_frame)(bool san, enum hsr_port_type port,\n\t\t\t\t struct hsr_node *node);\n\tbool (*drop_frame)(struct hsr_frame_info *frame, struct hsr_port *port);\n\tstruct sk_buff * (*get_untagged_frame)(struct hsr_frame_info *frame,\n\t\t\t\t\t       struct hsr_port *port);\n\tstruct sk_buff * (*create_tagged_frame)(struct hsr_frame_info *frame,\n\t\t\t\t\t\tstruct hsr_port *port);\n\tint (*fill_frame_info)(__be16 proto, struct sk_buff *skb,\n\t\t\t       struct hsr_frame_info *frame);\n\tbool (*invalid_dan_ingress_frame)(__be16 protocol);\n\tvoid (*update_san_info)(struct hsr_node *node, bool is_sup);\n};\n\nstruct hsr_self_node {\n\tunsigned char\tmacaddress_A[ETH_ALEN];\n\tunsigned char\tmacaddress_B[ETH_ALEN];\n\tstruct rcu_head\trcu_head;\n};\n\nstruct hsr_priv {\n\tstruct rcu_head\t\trcu_head;\n\tstruct list_head\tports;\n\tstruct list_head\tnode_db;\t \n\tstruct hsr_self_node\t__rcu *self_node;\t \n\tstruct timer_list\tannounce_timer;\t \n\tstruct timer_list\tprune_timer;\n\tint announce_count;\n\tu16 sequence_nr;\n\tu16 sup_sequence_nr;\t \n\tenum hsr_version prot_version;\t \n\tspinlock_t seqnr_lock;\t \n\tspinlock_t list_lock;\t \n\tstruct hsr_proto_ops\t*proto_ops;\n#define PRP_LAN_ID\t0x5      \n\tu8 net_id;\t\t \n\tbool fwd_offloaded;\t \n\tunsigned char\t\tsup_multicast_addr[ETH_ALEN] __aligned(sizeof(u16));\n\t\t\t\t \n#ifdef\tCONFIG_DEBUG_FS\n\tstruct dentry *node_tbl_root;\n#endif\n};\n\n#define hsr_for_each_port(hsr, port) \\\n\tlist_for_each_entry_rcu((port), &(hsr)->ports, port_list)\n\nstruct hsr_port *hsr_port_get_hsr(struct hsr_priv *hsr, enum hsr_port_type pt);\n\n \nstatic inline u16 hsr_get_skb_sequence_nr(struct sk_buff *skb)\n{\n\tstruct hsr_ethhdr *hsr_ethhdr;\n\n\thsr_ethhdr = (struct hsr_ethhdr *)skb_mac_header(skb);\n\treturn ntohs(hsr_ethhdr->hsr_tag.sequence_nr);\n}\n\nstatic inline struct prp_rct *skb_get_PRP_rct(struct sk_buff *skb)\n{\n\tunsigned char *tail = skb_tail_pointer(skb) - HSR_HLEN;\n\n\tstruct prp_rct *rct = (struct prp_rct *)tail;\n\n\tif (rct->PRP_suffix == htons(ETH_P_PRP))\n\t\treturn rct;\n\n\treturn NULL;\n}\n\n \nstatic inline u16 prp_get_skb_sequence_nr(struct prp_rct *rct)\n{\n\treturn ntohs(rct->sequence_nr);\n}\n\n \nstatic inline bool prp_check_lsdu_size(struct sk_buff *skb,\n\t\t\t\t       struct prp_rct *rct,\n\t\t\t\t       bool is_sup)\n{\n\tstruct ethhdr *ethhdr;\n\tint expected_lsdu_size;\n\n\tif (is_sup) {\n\t\texpected_lsdu_size = HSR_V1_SUP_LSDUSIZE;\n\t} else {\n\t\tethhdr = (struct ethhdr *)skb_mac_header(skb);\n\t\texpected_lsdu_size = skb->len - 14;\n\t\tif (ethhdr->h_proto == htons(ETH_P_8021Q))\n\t\t\texpected_lsdu_size -= 4;\n\t}\n\n\treturn (expected_lsdu_size == get_prp_LSDU_size(rct));\n}\n\n#if IS_ENABLED(CONFIG_DEBUG_FS)\nvoid hsr_debugfs_rename(struct net_device *dev);\nvoid hsr_debugfs_init(struct hsr_priv *priv, struct net_device *hsr_dev);\nvoid hsr_debugfs_term(struct hsr_priv *priv);\nvoid hsr_debugfs_create_root(void);\nvoid hsr_debugfs_remove_root(void);\n#else\nstatic inline void hsr_debugfs_rename(struct net_device *dev)\n{\n}\nstatic inline void hsr_debugfs_init(struct hsr_priv *priv,\n\t\t\t\t    struct net_device *hsr_dev)\n{}\nstatic inline void hsr_debugfs_term(struct hsr_priv *priv)\n{}\nstatic inline void hsr_debugfs_create_root(void)\n{}\nstatic inline void hsr_debugfs_remove_root(void)\n{}\n#endif\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}