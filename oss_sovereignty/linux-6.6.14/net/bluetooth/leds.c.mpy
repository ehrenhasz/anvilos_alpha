{
  "module_name": "leds.c",
  "hash_id": "2436b56719770b1a4d8bc9865950704c779b286296a7bec35e1cdab6c235032c",
  "original_prompt": "Ingested from linux-6.6.14/net/bluetooth/leds.c",
  "human_readable_source": "\n \n\n#include <net/bluetooth/bluetooth.h>\n#include <net/bluetooth/hci_core.h>\n\n#include \"leds.h\"\n\nDEFINE_LED_TRIGGER(bt_power_led_trigger);\n\nstruct hci_basic_led_trigger {\n\tstruct led_trigger\tled_trigger;\n\tstruct hci_dev\t\t*hdev;\n};\n\n#define to_hci_basic_led_trigger(arg) container_of(arg, \\\n\t\t\tstruct hci_basic_led_trigger, led_trigger)\n\nvoid hci_leds_update_powered(struct hci_dev *hdev, bool enabled)\n{\n\tif (hdev->power_led)\n\t\tled_trigger_event(hdev->power_led,\n\t\t\t\t  enabled ? LED_FULL : LED_OFF);\n\n\tif (!enabled) {\n\t\tstruct hci_dev *d;\n\n\t\tread_lock(&hci_dev_list_lock);\n\n\t\tlist_for_each_entry(d, &hci_dev_list, list) {\n\t\t\tif (test_bit(HCI_UP, &d->flags))\n\t\t\t\tenabled = true;\n\t\t}\n\n\t\tread_unlock(&hci_dev_list_lock);\n\t}\n\n\tled_trigger_event(bt_power_led_trigger, enabled ? LED_FULL : LED_OFF);\n}\n\nstatic int power_activate(struct led_classdev *led_cdev)\n{\n\tstruct hci_basic_led_trigger *htrig;\n\tbool powered;\n\n\thtrig = to_hci_basic_led_trigger(led_cdev->trigger);\n\tpowered = test_bit(HCI_UP, &htrig->hdev->flags);\n\n\tled_trigger_event(led_cdev->trigger, powered ? LED_FULL : LED_OFF);\n\n\treturn 0;\n}\n\nstatic struct led_trigger *led_allocate_basic(struct hci_dev *hdev,\n\t\t\tint (*activate)(struct led_classdev *led_cdev),\n\t\t\tconst char *name)\n{\n\tstruct hci_basic_led_trigger *htrig;\n\n\thtrig =\tdevm_kzalloc(&hdev->dev, sizeof(*htrig), GFP_KERNEL);\n\tif (!htrig)\n\t\treturn NULL;\n\n\thtrig->hdev = hdev;\n\thtrig->led_trigger.activate = activate;\n\thtrig->led_trigger.name = devm_kasprintf(&hdev->dev, GFP_KERNEL,\n\t\t\t\t\t\t \"%s-%s\", hdev->name,\n\t\t\t\t\t\t name);\n\tif (!htrig->led_trigger.name)\n\t\tgoto err_alloc;\n\n\tif (devm_led_trigger_register(&hdev->dev, &htrig->led_trigger))\n\t\tgoto err_register;\n\n\treturn &htrig->led_trigger;\n\nerr_register:\n\tdevm_kfree(&hdev->dev, (void *)htrig->led_trigger.name);\nerr_alloc:\n\tdevm_kfree(&hdev->dev, htrig);\n\treturn NULL;\n}\n\nvoid hci_leds_init(struct hci_dev *hdev)\n{\n\t \n\thdev->power_led = led_allocate_basic(hdev, power_activate, \"power\");\n}\n\nvoid bt_leds_init(void)\n{\n\tled_trigger_register_simple(\"bluetooth-power\", &bt_power_led_trigger);\n}\n\nvoid bt_leds_cleanup(void)\n{\n\tled_trigger_unregister_simple(bt_power_led_trigger);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}