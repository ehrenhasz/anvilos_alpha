{
  "module_name": "selftest.c",
  "hash_id": "7a8db9fbf0157fc3e585a75bb10f4f1bface27e75d8b7d56bdab67b9da169d00",
  "original_prompt": "Ingested from linux-6.6.14/net/bluetooth/selftest.c",
  "human_readable_source": " \n\n#include <linux/debugfs.h>\n\n#include <net/bluetooth/bluetooth.h>\n#include <net/bluetooth/hci_core.h>\n\n#include \"ecdh_helper.h\"\n#include \"smp.h\"\n#include \"selftest.h\"\n\n#if IS_ENABLED(CONFIG_BT_SELFTEST_ECDH)\n\nstatic const u8 priv_a_1[32] __initconst = {\n\t0xbd, 0x1a, 0x3c, 0xcd, 0xa6, 0xb8, 0x99, 0x58,\n\t0x99, 0xb7, 0x40, 0xeb, 0x7b, 0x60, 0xff, 0x4a,\n\t0x50, 0x3f, 0x10, 0xd2, 0xe3, 0xb3, 0xc9, 0x74,\n\t0x38, 0x5f, 0xc5, 0xa3, 0xd4, 0xf6, 0x49, 0x3f,\n};\nstatic const u8 priv_b_1[32] __initconst = {\n\t0xfd, 0xc5, 0x7f, 0xf4, 0x49, 0xdd, 0x4f, 0x6b,\n\t0xfb, 0x7c, 0x9d, 0xf1, 0xc2, 0x9a, 0xcb, 0x59,\n\t0x2a, 0xe7, 0xd4, 0xee, 0xfb, 0xfc, 0x0a, 0x90,\n\t0x9a, 0xbb, 0xf6, 0x32, 0x3d, 0x8b, 0x18, 0x55,\n};\nstatic const u8 pub_a_1[64] __initconst = {\n\t0xe6, 0x9d, 0x35, 0x0e, 0x48, 0x01, 0x03, 0xcc,\n\t0xdb, 0xfd, 0xf4, 0xac, 0x11, 0x91, 0xf4, 0xef,\n\t0xb9, 0xa5, 0xf9, 0xe9, 0xa7, 0x83, 0x2c, 0x5e,\n\t0x2c, 0xbe, 0x97, 0xf2, 0xd2, 0x03, 0xb0, 0x20,\n\n\t0x8b, 0xd2, 0x89, 0x15, 0xd0, 0x8e, 0x1c, 0x74,\n\t0x24, 0x30, 0xed, 0x8f, 0xc2, 0x45, 0x63, 0x76,\n\t0x5c, 0x15, 0x52, 0x5a, 0xbf, 0x9a, 0x32, 0x63,\n\t0x6d, 0xeb, 0x2a, 0x65, 0x49, 0x9c, 0x80, 0xdc,\n};\nstatic const u8 pub_b_1[64] __initconst = {\n\t0x90, 0xa1, 0xaa, 0x2f, 0xb2, 0x77, 0x90, 0x55,\n\t0x9f, 0xa6, 0x15, 0x86, 0xfd, 0x8a, 0xb5, 0x47,\n\t0x00, 0x4c, 0x9e, 0xf1, 0x84, 0x22, 0x59, 0x09,\n\t0x96, 0x1d, 0xaf, 0x1f, 0xf0, 0xf0, 0xa1, 0x1e,\n\n\t0x4a, 0x21, 0xb1, 0x15, 0xf9, 0xaf, 0x89, 0x5f,\n\t0x76, 0x36, 0x8e, 0xe2, 0x30, 0x11, 0x2d, 0x47,\n\t0x60, 0x51, 0xb8, 0x9a, 0x3a, 0x70, 0x56, 0x73,\n\t0x37, 0xad, 0x9d, 0x42, 0x3e, 0xf3, 0x55, 0x4c,\n};\nstatic const u8 dhkey_1[32] __initconst = {\n\t0x98, 0xa6, 0xbf, 0x73, 0xf3, 0x34, 0x8d, 0x86,\n\t0xf1, 0x66, 0xf8, 0xb4, 0x13, 0x6b, 0x79, 0x99,\n\t0x9b, 0x7d, 0x39, 0x0a, 0xa6, 0x10, 0x10, 0x34,\n\t0x05, 0xad, 0xc8, 0x57, 0xa3, 0x34, 0x02, 0xec,\n};\n\nstatic const u8 priv_a_2[32] __initconst = {\n\t0x63, 0x76, 0x45, 0xd0, 0xf7, 0x73, 0xac, 0xb7,\n\t0xff, 0xdd, 0x03, 0x72, 0xb9, 0x72, 0x85, 0xb4,\n\t0x41, 0xb6, 0x5d, 0x0c, 0x5d, 0x54, 0x84, 0x60,\n\t0x1a, 0xa3, 0x9a, 0x3c, 0x69, 0x16, 0xa5, 0x06,\n};\nstatic const u8 priv_b_2[32] __initconst = {\n\t0xba, 0x30, 0x55, 0x50, 0x19, 0xa2, 0xca, 0xa3,\n\t0xa5, 0x29, 0x08, 0xc6, 0xb5, 0x03, 0x88, 0x7e,\n\t0x03, 0x2b, 0x50, 0x73, 0xd4, 0x2e, 0x50, 0x97,\n\t0x64, 0xcd, 0x72, 0x0d, 0x67, 0xa0, 0x9a, 0x52,\n};\nstatic const u8 pub_a_2[64] __initconst = {\n\t0xdd, 0x78, 0x5c, 0x74, 0x03, 0x9b, 0x7e, 0x98,\n\t0xcb, 0x94, 0x87, 0x4a, 0xad, 0xfa, 0xf8, 0xd5,\n\t0x43, 0x3e, 0x5c, 0xaf, 0xea, 0xb5, 0x4c, 0xf4,\n\t0x9e, 0x80, 0x79, 0x57, 0x7b, 0xa4, 0x31, 0x2c,\n\n\t0x4f, 0x5d, 0x71, 0x43, 0x77, 0x43, 0xf8, 0xea,\n\t0xd4, 0x3e, 0xbd, 0x17, 0x91, 0x10, 0x21, 0xd0,\n\t0x1f, 0x87, 0x43, 0x8e, 0x40, 0xe2, 0x52, 0xcd,\n\t0xbe, 0xdf, 0x98, 0x38, 0x18, 0x12, 0x95, 0x91,\n};\nstatic const u8 pub_b_2[64] __initconst = {\n\t0xcc, 0x00, 0x65, 0xe1, 0xf5, 0x6c, 0x0d, 0xcf,\n\t0xec, 0x96, 0x47, 0x20, 0x66, 0xc9, 0xdb, 0x84,\n\t0x81, 0x75, 0xa8, 0x4d, 0xc0, 0xdf, 0xc7, 0x9d,\n\t0x1b, 0x3f, 0x3d, 0xf2, 0x3f, 0xe4, 0x65, 0xf4,\n\n\t0x79, 0xb2, 0xec, 0xd8, 0xca, 0x55, 0xa1, 0xa8,\n\t0x43, 0x4d, 0x6b, 0xca, 0x10, 0xb0, 0xc2, 0x01,\n\t0xc2, 0x33, 0x4e, 0x16, 0x24, 0xc4, 0xef, 0xee,\n\t0x99, 0xd8, 0xbb, 0xbc, 0x48, 0xd0, 0x01, 0x02,\n};\nstatic const u8 dhkey_2[32] __initconst = {\n\t0x69, 0xeb, 0x21, 0x32, 0xf2, 0xc6, 0x05, 0x41,\n\t0x60, 0x19, 0xcd, 0x5e, 0x94, 0xe1, 0xe6, 0x5f,\n\t0x33, 0x07, 0xe3, 0x38, 0x4b, 0x68, 0xe5, 0x62,\n\t0x3f, 0x88, 0x6d, 0x2f, 0x3a, 0x84, 0x85, 0xab,\n};\n\nstatic const u8 priv_a_3[32] __initconst = {\n\t0xbd, 0x1a, 0x3c, 0xcd, 0xa6, 0xb8, 0x99, 0x58,\n\t0x99, 0xb7, 0x40, 0xeb, 0x7b, 0x60, 0xff, 0x4a,\n\t0x50, 0x3f, 0x10, 0xd2, 0xe3, 0xb3, 0xc9, 0x74,\n\t0x38, 0x5f, 0xc5, 0xa3, 0xd4, 0xf6, 0x49, 0x3f,\n};\nstatic const u8 pub_a_3[64] __initconst = {\n\t0xe6, 0x9d, 0x35, 0x0e, 0x48, 0x01, 0x03, 0xcc,\n\t0xdb, 0xfd, 0xf4, 0xac, 0x11, 0x91, 0xf4, 0xef,\n\t0xb9, 0xa5, 0xf9, 0xe9, 0xa7, 0x83, 0x2c, 0x5e,\n\t0x2c, 0xbe, 0x97, 0xf2, 0xd2, 0x03, 0xb0, 0x20,\n\n\t0x8b, 0xd2, 0x89, 0x15, 0xd0, 0x8e, 0x1c, 0x74,\n\t0x24, 0x30, 0xed, 0x8f, 0xc2, 0x45, 0x63, 0x76,\n\t0x5c, 0x15, 0x52, 0x5a, 0xbf, 0x9a, 0x32, 0x63,\n\t0x6d, 0xeb, 0x2a, 0x65, 0x49, 0x9c, 0x80, 0xdc,\n};\nstatic const u8 dhkey_3[32] __initconst = {\n\t0x2d, 0xab, 0x00, 0x48, 0xcb, 0xb3, 0x7b, 0xda,\n\t0x55, 0x7b, 0x8b, 0x72, 0xa8, 0x57, 0x87, 0xc3,\n\t0x87, 0x27, 0x99, 0x32, 0xfc, 0x79, 0x5f, 0xae,\n\t0x7c, 0x1c, 0xf9, 0x49, 0xe6, 0xd7, 0xaa, 0x70,\n};\n\nstatic int __init test_ecdh_sample(struct crypto_kpp *tfm, const u8 priv_a[32],\n\t\t\t\t   const u8 priv_b[32], const u8 pub_a[64],\n\t\t\t\t   const u8 pub_b[64], const u8 dhkey[32])\n{\n\tu8 *tmp, *dhkey_a, *dhkey_b;\n\tint ret;\n\n\ttmp = kmalloc(64, GFP_KERNEL);\n\tif (!tmp)\n\t\treturn -EINVAL;\n\n\tdhkey_a = &tmp[0];\n\tdhkey_b = &tmp[32];\n\n\tret = set_ecdh_privkey(tfm, priv_a);\n\tif (ret)\n\t\tgoto out;\n\n\tret = compute_ecdh_secret(tfm, pub_b, dhkey_a);\n\tif (ret)\n\t\tgoto out;\n\n\tif (memcmp(dhkey_a, dhkey, 32)) {\n\t\tret = -EINVAL;\n\t\tgoto out;\n\t}\n\n\tret = set_ecdh_privkey(tfm, priv_b);\n\tif (ret)\n\t\tgoto out;\n\n\tret = compute_ecdh_secret(tfm, pub_a, dhkey_b);\n\tif (ret)\n\t\tgoto out;\n\n\tif (memcmp(dhkey_b, dhkey, 32))\n\t\tret = -EINVAL;\n\t \nout:\n\tkfree(tmp);\n\treturn ret;\n}\n\nstatic char test_ecdh_buffer[32];\n\nstatic ssize_t test_ecdh_read(struct file *file, char __user *user_buf,\n\t\t\t      size_t count, loff_t *ppos)\n{\n\treturn simple_read_from_buffer(user_buf, count, ppos, test_ecdh_buffer,\n\t\t\t\t       strlen(test_ecdh_buffer));\n}\n\nstatic const struct file_operations test_ecdh_fops = {\n\t.open\t\t= simple_open,\n\t.read\t\t= test_ecdh_read,\n\t.llseek\t\t= default_llseek,\n};\n\nstatic int __init test_ecdh(void)\n{\n\tstruct crypto_kpp *tfm;\n\tktime_t calltime, delta, rettime;\n\tunsigned long long duration = 0;\n\tint err;\n\n\tcalltime = ktime_get();\n\n\ttfm = crypto_alloc_kpp(\"ecdh-nist-p256\", 0, 0);\n\tif (IS_ERR(tfm)) {\n\t\tBT_ERR(\"Unable to create ECDH crypto context\");\n\t\terr = PTR_ERR(tfm);\n\t\tgoto done;\n\t}\n\n\terr = test_ecdh_sample(tfm, priv_a_1, priv_b_1, pub_a_1, pub_b_1,\n\t\t\t       dhkey_1);\n\tif (err) {\n\t\tBT_ERR(\"ECDH sample 1 failed\");\n\t\tgoto done;\n\t}\n\n\terr = test_ecdh_sample(tfm, priv_a_2, priv_b_2, pub_a_2, pub_b_2,\n\t\t\t       dhkey_2);\n\tif (err) {\n\t\tBT_ERR(\"ECDH sample 2 failed\");\n\t\tgoto done;\n\t}\n\n\terr = test_ecdh_sample(tfm, priv_a_3, priv_a_3, pub_a_3, pub_a_3,\n\t\t\t       dhkey_3);\n\tif (err) {\n\t\tBT_ERR(\"ECDH sample 3 failed\");\n\t\tgoto done;\n\t}\n\n\tcrypto_free_kpp(tfm);\n\n\trettime = ktime_get();\n\tdelta = ktime_sub(rettime, calltime);\n\tduration = (unsigned long long) ktime_to_ns(delta) >> 10;\n\n\tBT_INFO(\"ECDH test passed in %llu usecs\", duration);\n\ndone:\n\tif (!err)\n\t\tsnprintf(test_ecdh_buffer, sizeof(test_ecdh_buffer),\n\t\t\t \"PASS (%llu usecs)\\n\", duration);\n\telse\n\t\tsnprintf(test_ecdh_buffer, sizeof(test_ecdh_buffer), \"FAIL\\n\");\n\n\tdebugfs_create_file(\"selftest_ecdh\", 0444, bt_debugfs, NULL,\n\t\t\t    &test_ecdh_fops);\n\n\treturn err;\n}\n\n#else\n\nstatic inline int test_ecdh(void)\n{\n\treturn 0;\n}\n\n#endif\n\nstatic int __init run_selftest(void)\n{\n\tint err;\n\n\tBT_INFO(\"Starting self testing\");\n\n\terr = test_ecdh();\n\tif (err)\n\t\tgoto done;\n\n\terr = bt_selftest_smp();\n\ndone:\n\tBT_INFO(\"Finished self testing\");\n\n\treturn err;\n}\n\n#if IS_MODULE(CONFIG_BT)\n\n \nint __init bt_selftest(void)\n{\n\treturn run_selftest();\n}\n\n#else\n\n \nstatic int __init bt_selftest_init(void)\n{\n\treturn run_selftest();\n}\nlate_initcall(bt_selftest_init);\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}