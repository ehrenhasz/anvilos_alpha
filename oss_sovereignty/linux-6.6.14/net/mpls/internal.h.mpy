{
  "module_name": "internal.h",
  "hash_id": "b5760ac984cccb4ffc340277e74afaff7d84c0c5f2b9b347f87253091673b2d5",
  "original_prompt": "Ingested from linux-6.6.14/net/mpls/internal.h",
  "human_readable_source": " \n#ifndef MPLS_INTERNAL_H\n#define MPLS_INTERNAL_H\n#include <net/mpls.h>\n\n \n#define MAX_NEW_LABELS 30\n\nstruct mpls_entry_decoded {\n\tu32 label;\n\tu8 ttl;\n\tu8 tc;\n\tu8 bos;\n};\n\nstruct mpls_pcpu_stats {\n\tstruct mpls_link_stats\tstats;\n\tstruct u64_stats_sync\tsyncp;\n};\n\nstruct mpls_dev {\n\tint\t\t\t\tinput_enabled;\n\tstruct net_device\t\t*dev;\n\tstruct mpls_pcpu_stats __percpu\t*stats;\n\n\tstruct ctl_table_header\t\t*sysctl;\n\tstruct rcu_head\t\t\trcu;\n};\n\n#if BITS_PER_LONG == 32\n\n#define MPLS_INC_STATS_LEN(mdev, len, pkts_field, bytes_field)\t\t\\\n\tdo {\t\t\t\t\t\t\t\t\\\n\t\t__typeof__(*(mdev)->stats) *ptr =\t\t\t\\\n\t\t\traw_cpu_ptr((mdev)->stats);\t\t\t\\\n\t\tlocal_bh_disable();\t\t\t\t\t\\\n\t\tu64_stats_update_begin(&ptr->syncp);\t\t\t\\\n\t\tptr->stats.pkts_field++;\t\t\t\t\\\n\t\tptr->stats.bytes_field += (len);\t\t\t\\\n\t\tu64_stats_update_end(&ptr->syncp);\t\t\t\\\n\t\tlocal_bh_enable();\t\t\t\t\t\\\n\t} while (0)\n\n#define MPLS_INC_STATS(mdev, field)\t\t\t\t\t\\\n\tdo {\t\t\t\t\t\t\t\t\\\n\t\t__typeof__(*(mdev)->stats) *ptr =\t\t\t\\\n\t\t\traw_cpu_ptr((mdev)->stats);\t\t\t\\\n\t\tlocal_bh_disable();\t\t\t\t\t\\\n\t\tu64_stats_update_begin(&ptr->syncp);\t\t\t\\\n\t\tptr->stats.field++;\t\t\t\t\t\\\n\t\tu64_stats_update_end(&ptr->syncp);\t\t\t\\\n\t\tlocal_bh_enable();\t\t\t\t\t\\\n\t} while (0)\n\n#else\n\n#define MPLS_INC_STATS_LEN(mdev, len, pkts_field, bytes_field)\t\t\\\n\tdo {\t\t\t\t\t\t\t\t\\\n\t\tthis_cpu_inc((mdev)->stats->stats.pkts_field);\t\t\\\n\t\tthis_cpu_add((mdev)->stats->stats.bytes_field, (len));\t\\\n\t} while (0)\n\n#define MPLS_INC_STATS(mdev, field)\t\t\t\\\n\tthis_cpu_inc((mdev)->stats->stats.field)\n\n#endif\n\nstruct sk_buff;\n\n#define LABEL_NOT_SPECIFIED (1 << 20)\n\n \n#define VIA_ALEN_ALIGN sizeof(unsigned long)\n#define MAX_VIA_ALEN (ALIGN(MAX_ADDR_LEN, VIA_ALEN_ALIGN))\n\nenum mpls_payload_type {\n\tMPT_UNSPEC,  \n\tMPT_IPV4 = 4,\n\tMPT_IPV6 = 6,\n\n\t \n};\n\nstruct mpls_nh {  \n\tstruct net_device\t*nh_dev;\n\n\t \n\tunsigned int\t\tnh_flags;\n\tu8\t\t\tnh_labels;\n\tu8\t\t\tnh_via_alen;\n\tu8\t\t\tnh_via_table;\n\tu8\t\t\tnh_reserved1;\n\n\tu32\t\t\tnh_label[];\n};\n\n \n#define MPLS_NH_VIA_OFF(num_labels) \\\n\t\tALIGN(sizeof(struct mpls_nh) + (num_labels) * sizeof(u32), \\\n\t\t      VIA_ALEN_ALIGN)\n\n \n#define MPLS_NH_SIZE(num_labels, max_via_alen)\t\t\\\n\t\t(MPLS_NH_VIA_OFF((num_labels)) +\t\\\n\t\tALIGN((max_via_alen), VIA_ALEN_ALIGN))\n\nenum mpls_ttl_propagation {\n\tMPLS_TTL_PROP_DEFAULT,\n\tMPLS_TTL_PROP_ENABLED,\n\tMPLS_TTL_PROP_DISABLED,\n};\n\n \nstruct mpls_route {  \n\tstruct rcu_head\t\trt_rcu;\n\tu8\t\t\trt_protocol;\n\tu8\t\t\trt_payload_type;\n\tu8\t\t\trt_max_alen;\n\tu8\t\t\trt_ttl_propagate;\n\tu8\t\t\trt_nhn;\n\t \n\tu8\t\t\trt_nhn_alive;\n\tu8\t\t\trt_nh_size;\n\tu8\t\t\trt_via_offset;\n\tu8\t\t\trt_reserved1;\n\tstruct mpls_nh\t\trt_nh[];\n};\n\n#define for_nexthops(rt) {\t\t\t\t\t\t\\\n\tint nhsel; const struct mpls_nh *nh;\t\t\t\t\\\n\tfor (nhsel = 0, nh = (rt)->rt_nh;\t\t\t\t\\\n\t     nhsel < (rt)->rt_nhn;\t\t\t\t\t\\\n\t     nh = (void *)nh + (rt)->rt_nh_size, nhsel++)\n\n#define change_nexthops(rt) {\t\t\t\t\t\t\\\n\tint nhsel; struct mpls_nh *nh;\t\t\t\t\t\\\n\tfor (nhsel = 0, nh = (rt)->rt_nh;\t\t\t\t\\\n\t     nhsel < (rt)->rt_nhn;\t\t\t\t\t\\\n\t     nh = (void *)nh + (rt)->rt_nh_size, nhsel++)\n\n#define endfor_nexthops(rt) }\n\nstatic inline struct mpls_entry_decoded mpls_entry_decode(struct mpls_shim_hdr *hdr)\n{\n\tstruct mpls_entry_decoded result;\n\tunsigned entry = be32_to_cpu(hdr->label_stack_entry);\n\n\tresult.label = (entry & MPLS_LS_LABEL_MASK) >> MPLS_LS_LABEL_SHIFT;\n\tresult.ttl = (entry & MPLS_LS_TTL_MASK) >> MPLS_LS_TTL_SHIFT;\n\tresult.tc =  (entry & MPLS_LS_TC_MASK) >> MPLS_LS_TC_SHIFT;\n\tresult.bos = (entry & MPLS_LS_S_MASK) >> MPLS_LS_S_SHIFT;\n\n\treturn result;\n}\n\nstatic inline struct mpls_dev *mpls_dev_get(const struct net_device *dev)\n{\n\treturn rcu_dereference_rtnl(dev->mpls_ptr);\n}\n\nint nla_put_labels(struct sk_buff *skb, int attrtype,  u8 labels,\n\t\t   const u32 label[]);\nint nla_get_labels(const struct nlattr *nla, u8 max_labels, u8 *labels,\n\t\t   u32 label[], struct netlink_ext_ack *extack);\nbool mpls_output_possible(const struct net_device *dev);\nunsigned int mpls_dev_mtu(const struct net_device *dev);\nbool mpls_pkt_too_big(const struct sk_buff *skb, unsigned int mtu);\nvoid mpls_stats_inc_outucastpkts(struct net_device *dev,\n\t\t\t\t const struct sk_buff *skb);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}