{
  "module_name": "smd.c",
  "hash_id": "3cb08f3dfa7f4358d79a7cbc94d56b52c49471e5e295ec0c42fbca80103bd96e",
  "original_prompt": "Ingested from linux-6.6.14/net/qrtr/smd.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/skbuff.h>\n#include <linux/rpmsg.h>\n\n#include \"qrtr.h\"\n\nstruct qrtr_smd_dev {\n\tstruct qrtr_endpoint ep;\n\tstruct rpmsg_endpoint *channel;\n\tstruct device *dev;\n};\n\n \nstatic int qcom_smd_qrtr_callback(struct rpmsg_device *rpdev,\n\t\t\t\t  void *data, int len, void *priv, u32 addr)\n{\n\tstruct qrtr_smd_dev *qdev = dev_get_drvdata(&rpdev->dev);\n\tint rc;\n\n\tif (!qdev)\n\t\treturn -EAGAIN;\n\n\trc = qrtr_endpoint_post(&qdev->ep, data, len);\n\tif (rc == -EINVAL) {\n\t\tdev_err(qdev->dev, \"invalid ipcrouter packet\\n\");\n\t\t \n\t\trc = 0;\n\t}\n\n\treturn rc;\n}\n\n \nstatic int qcom_smd_qrtr_send(struct qrtr_endpoint *ep, struct sk_buff *skb)\n{\n\tstruct qrtr_smd_dev *qdev = container_of(ep, struct qrtr_smd_dev, ep);\n\tint rc;\n\n\trc = skb_linearize(skb);\n\tif (rc)\n\t\tgoto out;\n\n\trc = rpmsg_send(qdev->channel, skb->data, skb->len);\n\nout:\n\tif (rc)\n\t\tkfree_skb(skb);\n\telse\n\t\tconsume_skb(skb);\n\treturn rc;\n}\n\nstatic int qcom_smd_qrtr_probe(struct rpmsg_device *rpdev)\n{\n\tstruct qrtr_smd_dev *qdev;\n\tint rc;\n\n\tqdev = devm_kzalloc(&rpdev->dev, sizeof(*qdev), GFP_KERNEL);\n\tif (!qdev)\n\t\treturn -ENOMEM;\n\n\tqdev->channel = rpdev->ept;\n\tqdev->dev = &rpdev->dev;\n\tqdev->ep.xmit = qcom_smd_qrtr_send;\n\n\trc = qrtr_endpoint_register(&qdev->ep, QRTR_EP_NID_AUTO);\n\tif (rc)\n\t\treturn rc;\n\n\tdev_set_drvdata(&rpdev->dev, qdev);\n\n\tdev_dbg(&rpdev->dev, \"Qualcomm SMD QRTR driver probed\\n\");\n\n\treturn 0;\n}\n\nstatic void qcom_smd_qrtr_remove(struct rpmsg_device *rpdev)\n{\n\tstruct qrtr_smd_dev *qdev = dev_get_drvdata(&rpdev->dev);\n\n\tqrtr_endpoint_unregister(&qdev->ep);\n\n\tdev_set_drvdata(&rpdev->dev, NULL);\n}\n\nstatic const struct rpmsg_device_id qcom_smd_qrtr_smd_match[] = {\n\t{ \"IPCRTR\" },\n\t{}\n};\n\nstatic struct rpmsg_driver qcom_smd_qrtr_driver = {\n\t.probe = qcom_smd_qrtr_probe,\n\t.remove = qcom_smd_qrtr_remove,\n\t.callback = qcom_smd_qrtr_callback,\n\t.id_table = qcom_smd_qrtr_smd_match,\n\t.drv = {\n\t\t.name = \"qcom_smd_qrtr\",\n\t},\n};\n\nmodule_rpmsg_driver(qcom_smd_qrtr_driver);\n\nMODULE_ALIAS(\"rpmsg:IPCRTR\");\nMODULE_DESCRIPTION(\"Qualcomm IPC-Router SMD interface driver\");\nMODULE_LICENSE(\"GPL v2\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}