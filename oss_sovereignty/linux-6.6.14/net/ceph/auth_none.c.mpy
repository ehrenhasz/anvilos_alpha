{
  "module_name": "auth_none.c",
  "hash_id": "aa37a07457cc75efada3d0271a28d698a2fe1b4a546ab546304c8077c032c1e5",
  "original_prompt": "Ingested from linux-6.6.14/net/ceph/auth_none.c",
  "human_readable_source": "\n\n#include <linux/ceph/ceph_debug.h>\n\n#include <linux/err.h>\n#include <linux/module.h>\n#include <linux/random.h>\n#include <linux/slab.h>\n\n#include <linux/ceph/decode.h>\n#include <linux/ceph/auth.h>\n\n#include \"auth_none.h\"\n\nstatic void reset(struct ceph_auth_client *ac)\n{\n\tstruct ceph_auth_none_info *xi = ac->private;\n\n\txi->starting = true;\n}\n\nstatic void destroy(struct ceph_auth_client *ac)\n{\n\tkfree(ac->private);\n\tac->private = NULL;\n}\n\nstatic int is_authenticated(struct ceph_auth_client *ac)\n{\n\tstruct ceph_auth_none_info *xi = ac->private;\n\n\treturn !xi->starting;\n}\n\nstatic int should_authenticate(struct ceph_auth_client *ac)\n{\n\tstruct ceph_auth_none_info *xi = ac->private;\n\n\treturn xi->starting;\n}\n\nstatic int ceph_auth_none_build_authorizer(struct ceph_auth_client *ac,\n\t\t\t\t\t   struct ceph_none_authorizer *au)\n{\n\tvoid *p = au->buf;\n\tvoid *const end = p + sizeof(au->buf);\n\tint ret;\n\n\tceph_encode_8_safe(&p, end, 1, e_range);\n\tret = ceph_auth_entity_name_encode(ac->name, &p, end);\n\tif (ret < 0)\n\t\treturn ret;\n\n\tceph_encode_64_safe(&p, end, ac->global_id, e_range);\n\tau->buf_len = p - (void *)au->buf;\n\tdout(\"%s built authorizer len %d\\n\", __func__, au->buf_len);\n\treturn 0;\n\ne_range:\n\treturn -ERANGE;\n}\n\nstatic int build_request(struct ceph_auth_client *ac, void *buf, void *end)\n{\n\treturn 0;\n}\n\n \nstatic int handle_reply(struct ceph_auth_client *ac, u64 global_id,\n\t\t\tvoid *buf, void *end, u8 *session_key,\n\t\t\tint *session_key_len, u8 *con_secret,\n\t\t\tint *con_secret_len)\n{\n\tstruct ceph_auth_none_info *xi = ac->private;\n\n\txi->starting = false;\n\tceph_auth_set_global_id(ac, global_id);\n\treturn 0;\n}\n\nstatic void ceph_auth_none_destroy_authorizer(struct ceph_authorizer *a)\n{\n\tkfree(a);\n}\n\n \nstatic int ceph_auth_none_create_authorizer(\n\tstruct ceph_auth_client *ac, int peer_type,\n\tstruct ceph_auth_handshake *auth)\n{\n\tstruct ceph_none_authorizer *au;\n\tint ret;\n\n\tau = kmalloc(sizeof(*au), GFP_NOFS);\n\tif (!au)\n\t\treturn -ENOMEM;\n\n\tau->base.destroy = ceph_auth_none_destroy_authorizer;\n\n\tret = ceph_auth_none_build_authorizer(ac, au);\n\tif (ret) {\n\t\tkfree(au);\n\t\treturn ret;\n\t}\n\n\tauth->authorizer = (struct ceph_authorizer *) au;\n\tauth->authorizer_buf = au->buf;\n\tauth->authorizer_buf_len = au->buf_len;\n\tauth->authorizer_reply_buf = NULL;\n\tauth->authorizer_reply_buf_len = 0;\n\n\treturn 0;\n}\n\nstatic const struct ceph_auth_client_ops ceph_auth_none_ops = {\n\t.reset = reset,\n\t.destroy = destroy,\n\t.is_authenticated = is_authenticated,\n\t.should_authenticate = should_authenticate,\n\t.build_request = build_request,\n\t.handle_reply = handle_reply,\n\t.create_authorizer = ceph_auth_none_create_authorizer,\n};\n\nint ceph_auth_none_init(struct ceph_auth_client *ac)\n{\n\tstruct ceph_auth_none_info *xi;\n\n\tdout(\"ceph_auth_none_init %p\\n\", ac);\n\txi = kzalloc(sizeof(*xi), GFP_NOFS);\n\tif (!xi)\n\t\treturn -ENOMEM;\n\n\txi->starting = true;\n\n\tac->protocol = CEPH_AUTH_NONE;\n\tac->private = xi;\n\tac->ops = &ceph_auth_none_ops;\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}