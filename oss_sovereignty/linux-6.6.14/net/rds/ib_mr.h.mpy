{
  "module_name": "ib_mr.h",
  "hash_id": "0b1e04f4ed0a762c1dae5de78a8147f77869b76e251c9ed61515ffe36bb01bd8",
  "original_prompt": "Ingested from linux-6.6.14/net/rds/ib_mr.h",
  "human_readable_source": " \n#ifndef _RDS_IB_MR_H\n#define _RDS_IB_MR_H\n\n#include <linux/kernel.h>\n\n#include \"rds.h\"\n#include \"ib.h\"\n\n#define RDS_MR_1M_POOL_SIZE\t\t(8192 / 2)\n#define RDS_MR_1M_MSG_SIZE\t\t256\n#define RDS_MR_8K_MSG_SIZE\t\t2\n#define RDS_MR_8K_SCALE\t\t\t(256 / (RDS_MR_8K_MSG_SIZE + 1))\n#define RDS_MR_8K_POOL_SIZE\t\t(RDS_MR_8K_SCALE * (8192 / 2))\n\nenum rds_ib_fr_state {\n\tFRMR_IS_FREE,\t \n\tFRMR_IS_INUSE,\t \n\tFRMR_IS_STALE,\t \n};\n\nstruct rds_ib_frmr {\n\tstruct ib_mr\t\t*mr;\n\tenum rds_ib_fr_state\tfr_state;\n\tbool\t\t\tfr_inv;\n\twait_queue_head_t\tfr_inv_done;\n\tbool\t\t\tfr_reg;\n\twait_queue_head_t\tfr_reg_done;\n\tstruct ib_send_wr\tfr_wr;\n\tunsigned int\t\tdma_npages;\n\tunsigned int\t\tsg_byte_len;\n};\n\n \nstruct rds_ib_mr {\n\tstruct delayed_work\t\twork;\n\tstruct rds_ib_device\t\t*device;\n\tstruct rds_ib_mr_pool\t\t*pool;\n\tstruct rds_ib_connection\t*ic;\n\n\tstruct llist_node\t\tllnode;\n\n\t \n\tstruct list_head\t\tunmap_list;\n\tunsigned int\t\t\tremap_count;\n\n\tstruct scatterlist\t\t*sg;\n\tunsigned int\t\t\tsg_len;\n\tint\t\t\t\tsg_dma_len;\n\n\tu8\t\t\t\todp:1;\n\tunion {\n\t\tstruct rds_ib_frmr\tfrmr;\n\t\tstruct ib_mr\t\t*mr;\n\t} u;\n};\n\n \nstruct rds_ib_mr_pool {\n\tunsigned int            pool_type;\n\tstruct mutex\t\tflush_lock;\t \n\tstruct delayed_work\tflush_worker;\t \n\n\tatomic_t\t\titem_count;\t \n\tatomic_t\t\tdirty_count;\t \n\n\tstruct llist_head\tdrop_list;\t \n\tstruct llist_head\tfree_list;\t \n\tstruct llist_head\tclean_list;\t \n\twait_queue_head_t\tflush_wait;\n\tspinlock_t\t\tclean_lock;\t \n\n\tatomic_t\t\tfree_pinned;\t \n\tunsigned long\t\tmax_items;\n\tunsigned long\t\tmax_items_soft;\n\tunsigned long\t\tmax_free_pinned;\n\tunsigned int\t\tmax_pages;\n};\n\nextern struct workqueue_struct *rds_ib_mr_wq;\nextern bool prefer_frmr;\n\nstruct rds_ib_mr_pool *rds_ib_create_mr_pool(struct rds_ib_device *rds_dev,\n\t\t\t\t\t     int npages);\nvoid rds_ib_get_mr_info(struct rds_ib_device *rds_ibdev,\n\t\t\tstruct rds_info_rdma_connection *iinfo);\nvoid rds6_ib_get_mr_info(struct rds_ib_device *rds_ibdev,\n\t\t\t struct rds6_info_rdma_connection *iinfo6);\nvoid rds_ib_destroy_mr_pool(struct rds_ib_mr_pool *);\nvoid *rds_ib_get_mr(struct scatterlist *sg, unsigned long nents,\n\t\t    struct rds_sock *rs, u32 *key_ret,\n\t\t    struct rds_connection *conn, u64 start, u64 length,\n\t\t    int need_odp);\nvoid rds_ib_sync_mr(void *trans_private, int dir);\nvoid rds_ib_free_mr(void *trans_private, int invalidate);\nvoid rds_ib_flush_mrs(void);\nint rds_ib_mr_init(void);\nvoid rds_ib_mr_exit(void);\nu32 rds_ib_get_lkey(void *trans_private);\n\nvoid __rds_ib_teardown_mr(struct rds_ib_mr *);\nvoid rds_ib_teardown_mr(struct rds_ib_mr *);\nstruct rds_ib_mr *rds_ib_reuse_mr(struct rds_ib_mr_pool *);\nint rds_ib_flush_mr_pool(struct rds_ib_mr_pool *, int, struct rds_ib_mr **);\nstruct rds_ib_mr *rds_ib_try_reuse_ibmr(struct rds_ib_mr_pool *);\nstruct rds_ib_mr *rds_ib_reg_frmr(struct rds_ib_device *rds_ibdev,\n\t\t\t\t  struct rds_ib_connection *ic,\n\t\t\t\t  struct scatterlist *sg,\n\t\t\t\t  unsigned long nents, u32 *key);\nvoid rds_ib_unreg_frmr(struct list_head *list, unsigned int *nfreed,\n\t\t       unsigned long *unpinned, unsigned int goal);\nvoid rds_ib_free_frmr_list(struct rds_ib_mr *);\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}