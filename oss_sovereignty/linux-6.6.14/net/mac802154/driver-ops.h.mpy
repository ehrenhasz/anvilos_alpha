{
  "module_name": "driver-ops.h",
  "hash_id": "43a71ba30a3ea1debb01cbc72b01637973a6b4139e383a1e79f520c5ec36e782",
  "original_prompt": "Ingested from linux-6.6.14/net/mac802154/driver-ops.h",
  "human_readable_source": " \n#ifndef __MAC802154_DRIVER_OPS\n#define __MAC802154_DRIVER_OPS\n\n#include <linux/types.h>\n#include <linux/rtnetlink.h>\n\n#include <net/mac802154.h>\n\n#include \"ieee802154_i.h\"\n#include \"trace.h\"\n\nstatic inline int\ndrv_xmit_async(struct ieee802154_local *local, struct sk_buff *skb)\n{\n\treturn local->ops->xmit_async(&local->hw, skb);\n}\n\nstatic inline int\ndrv_xmit_sync(struct ieee802154_local *local, struct sk_buff *skb)\n{\n\tmight_sleep();\n\n\treturn local->ops->xmit_sync(&local->hw, skb);\n}\n\nstatic inline int drv_set_pan_id(struct ieee802154_local *local, __le16 pan_id)\n{\n\tstruct ieee802154_hw_addr_filt filt;\n\tint ret;\n\n\tmight_sleep();\n\n\tif (!local->ops->set_hw_addr_filt) {\n\t\tWARN_ON(1);\n\t\treturn -EOPNOTSUPP;\n\t}\n\n\tfilt.pan_id = pan_id;\n\n\ttrace_802154_drv_set_pan_id(local, pan_id);\n\tret = local->ops->set_hw_addr_filt(&local->hw, &filt,\n\t\t\t\t\t    IEEE802154_AFILT_PANID_CHANGED);\n\ttrace_802154_drv_return_int(local, ret);\n\treturn ret;\n}\n\nstatic inline int\ndrv_set_extended_addr(struct ieee802154_local *local, __le64 extended_addr)\n{\n\tstruct ieee802154_hw_addr_filt filt;\n\tint ret;\n\n\tmight_sleep();\n\n\tif (!local->ops->set_hw_addr_filt) {\n\t\tWARN_ON(1);\n\t\treturn -EOPNOTSUPP;\n\t}\n\n\tfilt.ieee_addr = extended_addr;\n\n\ttrace_802154_drv_set_extended_addr(local, extended_addr);\n\tret = local->ops->set_hw_addr_filt(&local->hw, &filt,\n\t\t\t\t\t    IEEE802154_AFILT_IEEEADDR_CHANGED);\n\ttrace_802154_drv_return_int(local, ret);\n\treturn ret;\n}\n\nstatic inline int\ndrv_set_short_addr(struct ieee802154_local *local, __le16 short_addr)\n{\n\tstruct ieee802154_hw_addr_filt filt;\n\tint ret;\n\n\tmight_sleep();\n\n\tif (!local->ops->set_hw_addr_filt) {\n\t\tWARN_ON(1);\n\t\treturn -EOPNOTSUPP;\n\t}\n\n\tfilt.short_addr = short_addr;\n\n\ttrace_802154_drv_set_short_addr(local, short_addr);\n\tret = local->ops->set_hw_addr_filt(&local->hw, &filt,\n\t\t\t\t\t    IEEE802154_AFILT_SADDR_CHANGED);\n\ttrace_802154_drv_return_int(local, ret);\n\treturn ret;\n}\n\nstatic inline int\ndrv_set_pan_coord(struct ieee802154_local *local, bool is_coord)\n{\n\tstruct ieee802154_hw_addr_filt filt;\n\tint ret;\n\n\tmight_sleep();\n\n\tif (!local->ops->set_hw_addr_filt) {\n\t\tWARN_ON(1);\n\t\treturn -EOPNOTSUPP;\n\t}\n\n\tfilt.pan_coord = is_coord;\n\n\ttrace_802154_drv_set_pan_coord(local, is_coord);\n\tret = local->ops->set_hw_addr_filt(&local->hw, &filt,\n\t\t\t\t\t    IEEE802154_AFILT_PANC_CHANGED);\n\ttrace_802154_drv_return_int(local, ret);\n\treturn ret;\n}\n\nstatic inline int\ndrv_set_promiscuous_mode(struct ieee802154_local *local, bool on)\n{\n\tint ret;\n\n\tmight_sleep();\n\n\tif (!local->ops->set_promiscuous_mode) {\n\t\tWARN_ON(1);\n\t\treturn -EOPNOTSUPP;\n\t}\n\n\ttrace_802154_drv_set_promiscuous_mode(local, on);\n\tret = local->ops->set_promiscuous_mode(&local->hw, on);\n\ttrace_802154_drv_return_int(local, ret);\n\treturn ret;\n}\n\nstatic inline int drv_start(struct ieee802154_local *local,\n\t\t\t    enum ieee802154_filtering_level level,\n\t\t\t    const struct ieee802154_hw_addr_filt *addr_filt)\n{\n\tint ret;\n\n\tmight_sleep();\n\n\t \n\tif (local->hw.flags & IEEE802154_HW_AFILT) {\n\t\tret = drv_set_pan_id(local, addr_filt->pan_id);\n\t\tif (ret < 0)\n\t\t\treturn ret;\n\n\t\tret = drv_set_short_addr(local, addr_filt->short_addr);\n\t\tif (ret < 0)\n\t\t\treturn ret;\n\n\t\tret = drv_set_extended_addr(local, addr_filt->ieee_addr);\n\t\tif (ret < 0)\n\t\t\treturn ret;\n\t}\n\n\tswitch (level) {\n\tcase IEEE802154_FILTERING_NONE:\n\t\tfallthrough;\n\tcase IEEE802154_FILTERING_1_FCS:\n\t\tfallthrough;\n\tcase IEEE802154_FILTERING_2_PROMISCUOUS:\n\t\t \n\t\tfallthrough;\n\tcase IEEE802154_FILTERING_3_SCAN:\n\t\tif (local->hw.flags & IEEE802154_HW_PROMISCUOUS) {\n\t\t\tret = drv_set_promiscuous_mode(local, true);\n\t\t\tif (ret < 0)\n\t\t\t\treturn ret;\n\t\t} else {\n\t\t\treturn -EOPNOTSUPP;\n\t\t}\n\n\t\t \n\t\tlocal->phy->filtering = IEEE802154_FILTERING_NONE;\n\t\tbreak;\n\tcase IEEE802154_FILTERING_4_FRAME_FIELDS:\n\t\t \n\t\tif (local->hw.flags & IEEE802154_HW_PROMISCUOUS) {\n\t\t\tret = drv_set_promiscuous_mode(local, false);\n\t\t\tif (ret < 0)\n\t\t\t\treturn ret;\n\t\t}\n\n\t\tlocal->phy->filtering = IEEE802154_FILTERING_4_FRAME_FIELDS;\n\t\tbreak;\n\tdefault:\n\t\tWARN_ON(1);\n\t\treturn -EINVAL;\n\t}\n\n\ttrace_802154_drv_start(local);\n\tlocal->started = true;\n\tsmp_mb();\n\tret = local->ops->start(&local->hw);\n\ttrace_802154_drv_return_int(local, ret);\n\treturn ret;\n}\n\nstatic inline void drv_stop(struct ieee802154_local *local)\n{\n\tmight_sleep();\n\n\ttrace_802154_drv_stop(local);\n\tlocal->ops->stop(&local->hw);\n\ttrace_802154_drv_return_void(local);\n\n\t \n\ttasklet_disable(&local->tasklet);\n\ttasklet_enable(&local->tasklet);\n\n\tbarrier();\n\n\tlocal->started = false;\n}\n\nstatic inline int\ndrv_set_channel(struct ieee802154_local *local, u8 page, u8 channel)\n{\n\tint ret;\n\n\tmight_sleep();\n\n\ttrace_802154_drv_set_channel(local, page, channel);\n\tret = local->ops->set_channel(&local->hw, page, channel);\n\ttrace_802154_drv_return_int(local, ret);\n\treturn ret;\n}\n\nstatic inline int drv_set_tx_power(struct ieee802154_local *local, s32 mbm)\n{\n\tint ret;\n\n\tmight_sleep();\n\n\tif (!local->ops->set_txpower) {\n\t\tWARN_ON(1);\n\t\treturn -EOPNOTSUPP;\n\t}\n\n\ttrace_802154_drv_set_tx_power(local, mbm);\n\tret = local->ops->set_txpower(&local->hw, mbm);\n\ttrace_802154_drv_return_int(local, ret);\n\treturn ret;\n}\n\nstatic inline int drv_set_cca_mode(struct ieee802154_local *local,\n\t\t\t\t   const struct wpan_phy_cca *cca)\n{\n\tint ret;\n\n\tmight_sleep();\n\n\tif (!local->ops->set_cca_mode) {\n\t\tWARN_ON(1);\n\t\treturn -EOPNOTSUPP;\n\t}\n\n\ttrace_802154_drv_set_cca_mode(local, cca);\n\tret = local->ops->set_cca_mode(&local->hw, cca);\n\ttrace_802154_drv_return_int(local, ret);\n\treturn ret;\n}\n\nstatic inline int drv_set_lbt_mode(struct ieee802154_local *local, bool mode)\n{\n\tint ret;\n\n\tmight_sleep();\n\n\tif (!local->ops->set_lbt) {\n\t\tWARN_ON(1);\n\t\treturn -EOPNOTSUPP;\n\t}\n\n\ttrace_802154_drv_set_lbt_mode(local, mode);\n\tret = local->ops->set_lbt(&local->hw, mode);\n\ttrace_802154_drv_return_int(local, ret);\n\treturn ret;\n}\n\nstatic inline int\ndrv_set_cca_ed_level(struct ieee802154_local *local, s32 mbm)\n{\n\tint ret;\n\n\tmight_sleep();\n\n\tif (!local->ops->set_cca_ed_level) {\n\t\tWARN_ON(1);\n\t\treturn -EOPNOTSUPP;\n\t}\n\n\ttrace_802154_drv_set_cca_ed_level(local, mbm);\n\tret = local->ops->set_cca_ed_level(&local->hw, mbm);\n\ttrace_802154_drv_return_int(local, ret);\n\treturn ret;\n}\n\nstatic inline int\ndrv_set_csma_params(struct ieee802154_local *local, u8 min_be, u8 max_be,\n\t\t    u8 max_csma_backoffs)\n{\n\tint ret;\n\n\tmight_sleep();\n\n\tif (!local->ops->set_csma_params) {\n\t\tWARN_ON(1);\n\t\treturn -EOPNOTSUPP;\n\t}\n\n\ttrace_802154_drv_set_csma_params(local, min_be, max_be,\n\t\t\t\t\t max_csma_backoffs);\n\tret = local->ops->set_csma_params(&local->hw, min_be, max_be,\n\t\t\t\t\t   max_csma_backoffs);\n\ttrace_802154_drv_return_int(local, ret);\n\treturn ret;\n}\n\nstatic inline int\ndrv_set_max_frame_retries(struct ieee802154_local *local, s8 max_frame_retries)\n{\n\tint ret;\n\n\tmight_sleep();\n\n\tif (!local->ops->set_frame_retries) {\n\t\tWARN_ON(1);\n\t\treturn -EOPNOTSUPP;\n\t}\n\n\ttrace_802154_drv_set_max_frame_retries(local, max_frame_retries);\n\tret = local->ops->set_frame_retries(&local->hw, max_frame_retries);\n\ttrace_802154_drv_return_int(local, ret);\n\treturn ret;\n}\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}