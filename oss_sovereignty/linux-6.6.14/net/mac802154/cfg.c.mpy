{
  "module_name": "cfg.c",
  "hash_id": "b9589147e609f703595a1e27cc1ca21308db9d94078294ddea7a47ba21b81f0e",
  "original_prompt": "Ingested from linux-6.6.14/net/mac802154/cfg.c",
  "human_readable_source": "\n \n\n#include <net/rtnetlink.h>\n#include <net/cfg802154.h>\n\n#include \"ieee802154_i.h\"\n#include \"driver-ops.h\"\n#include \"cfg.h\"\n\nstatic struct net_device *\nieee802154_add_iface_deprecated(struct wpan_phy *wpan_phy,\n\t\t\t\tconst char *name,\n\t\t\t\tunsigned char name_assign_type, int type)\n{\n\tstruct ieee802154_local *local = wpan_phy_priv(wpan_phy);\n\tstruct net_device *dev;\n\n\trtnl_lock();\n\tdev = ieee802154_if_add(local, name, name_assign_type, type,\n\t\t\t\tcpu_to_le64(0x0000000000000000ULL));\n\trtnl_unlock();\n\n\treturn dev;\n}\n\nstatic void ieee802154_del_iface_deprecated(struct wpan_phy *wpan_phy,\n\t\t\t\t\t    struct net_device *dev)\n{\n\tstruct ieee802154_sub_if_data *sdata = IEEE802154_DEV_TO_SUB_IF(dev);\n\n\tieee802154_if_remove(sdata);\n}\n\n#ifdef CONFIG_PM\nstatic int ieee802154_suspend(struct wpan_phy *wpan_phy)\n{\n\tstruct ieee802154_local *local = wpan_phy_priv(wpan_phy);\n\n\tif (!local->open_count)\n\t\tgoto suspend;\n\n\tieee802154_sync_and_hold_queue(local);\n\tsynchronize_net();\n\n\t \n\tieee802154_stop_device(local);\n\nsuspend:\n\tlocal->suspended = true;\n\treturn 0;\n}\n\nstatic int ieee802154_resume(struct wpan_phy *wpan_phy)\n{\n\tstruct ieee802154_local *local = wpan_phy_priv(wpan_phy);\n\tint ret;\n\n\t \n\tif (!local->open_count)\n\t\tgoto wake_up;\n\n\t \n\tret = drv_start(local, local->phy->filtering, &local->addr_filt);\n\tif (ret)\n\t\treturn ret;\n\nwake_up:\n\tieee802154_release_queue(local);\n\tlocal->suspended = false;\n\treturn 0;\n}\n#else\n#define ieee802154_suspend NULL\n#define ieee802154_resume NULL\n#endif\n\nstatic int\nieee802154_add_iface(struct wpan_phy *phy, const char *name,\n\t\t     unsigned char name_assign_type,\n\t\t     enum nl802154_iftype type, __le64 extended_addr)\n{\n\tstruct ieee802154_local *local = wpan_phy_priv(phy);\n\tstruct net_device *err;\n\n\terr = ieee802154_if_add(local, name, name_assign_type, type,\n\t\t\t\textended_addr);\n\treturn PTR_ERR_OR_ZERO(err);\n}\n\nstatic int\nieee802154_del_iface(struct wpan_phy *wpan_phy, struct wpan_dev *wpan_dev)\n{\n\tieee802154_if_remove(IEEE802154_WPAN_DEV_TO_SUB_IF(wpan_dev));\n\n\treturn 0;\n}\n\nstatic int\nieee802154_set_channel(struct wpan_phy *wpan_phy, u8 page, u8 channel)\n{\n\tstruct ieee802154_local *local = wpan_phy_priv(wpan_phy);\n\tint ret;\n\n\tASSERT_RTNL();\n\n\tif (wpan_phy->current_page == page &&\n\t    wpan_phy->current_channel == channel)\n\t\treturn 0;\n\n\t \n\tif (mac802154_is_scanning(local) || mac802154_is_beaconing(local))\n\t\treturn -EBUSY;\n\n\tret = drv_set_channel(local, page, channel);\n\tif (!ret) {\n\t\twpan_phy->current_page = page;\n\t\twpan_phy->current_channel = channel;\n\t\tieee802154_configure_durations(wpan_phy, page, channel);\n\t}\n\n\treturn ret;\n}\n\nstatic int\nieee802154_set_cca_mode(struct wpan_phy *wpan_phy,\n\t\t\tconst struct wpan_phy_cca *cca)\n{\n\tstruct ieee802154_local *local = wpan_phy_priv(wpan_phy);\n\tint ret;\n\n\tASSERT_RTNL();\n\n\tif (wpan_phy_cca_cmp(&wpan_phy->cca, cca))\n\t\treturn 0;\n\n\tret = drv_set_cca_mode(local, cca);\n\tif (!ret)\n\t\twpan_phy->cca = *cca;\n\n\treturn ret;\n}\n\nstatic int\nieee802154_set_cca_ed_level(struct wpan_phy *wpan_phy, s32 ed_level)\n{\n\tstruct ieee802154_local *local = wpan_phy_priv(wpan_phy);\n\tint ret;\n\n\tASSERT_RTNL();\n\n\tif (wpan_phy->cca_ed_level == ed_level)\n\t\treturn 0;\n\n\tret = drv_set_cca_ed_level(local, ed_level);\n\tif (!ret)\n\t\twpan_phy->cca_ed_level = ed_level;\n\n\treturn ret;\n}\n\nstatic int\nieee802154_set_tx_power(struct wpan_phy *wpan_phy, s32 power)\n{\n\tstruct ieee802154_local *local = wpan_phy_priv(wpan_phy);\n\tint ret;\n\n\tASSERT_RTNL();\n\n\tif (wpan_phy->transmit_power == power)\n\t\treturn 0;\n\n\tret = drv_set_tx_power(local, power);\n\tif (!ret)\n\t\twpan_phy->transmit_power = power;\n\n\treturn ret;\n}\n\nstatic int\nieee802154_set_pan_id(struct wpan_phy *wpan_phy, struct wpan_dev *wpan_dev,\n\t\t      __le16 pan_id)\n{\n\tint ret;\n\n\tASSERT_RTNL();\n\n\tif (wpan_dev->pan_id == pan_id)\n\t\treturn 0;\n\n\tret = mac802154_wpan_update_llsec(wpan_dev->netdev);\n\tif (!ret)\n\t\twpan_dev->pan_id = pan_id;\n\n\treturn ret;\n}\n\nstatic int\nieee802154_set_backoff_exponent(struct wpan_phy *wpan_phy,\n\t\t\t\tstruct wpan_dev *wpan_dev,\n\t\t\t\tu8 min_be, u8 max_be)\n{\n\tASSERT_RTNL();\n\n\twpan_dev->min_be = min_be;\n\twpan_dev->max_be = max_be;\n\treturn 0;\n}\n\nstatic int\nieee802154_set_short_addr(struct wpan_phy *wpan_phy, struct wpan_dev *wpan_dev,\n\t\t\t  __le16 short_addr)\n{\n\tASSERT_RTNL();\n\n\twpan_dev->short_addr = short_addr;\n\treturn 0;\n}\n\nstatic int\nieee802154_set_max_csma_backoffs(struct wpan_phy *wpan_phy,\n\t\t\t\t struct wpan_dev *wpan_dev,\n\t\t\t\t u8 max_csma_backoffs)\n{\n\tASSERT_RTNL();\n\n\twpan_dev->csma_retries = max_csma_backoffs;\n\treturn 0;\n}\n\nstatic int\nieee802154_set_max_frame_retries(struct wpan_phy *wpan_phy,\n\t\t\t\t struct wpan_dev *wpan_dev,\n\t\t\t\t s8 max_frame_retries)\n{\n\tASSERT_RTNL();\n\n\twpan_dev->frame_retries = max_frame_retries;\n\treturn 0;\n}\n\nstatic int\nieee802154_set_lbt_mode(struct wpan_phy *wpan_phy, struct wpan_dev *wpan_dev,\n\t\t\tbool mode)\n{\n\tASSERT_RTNL();\n\n\twpan_dev->lbt = mode;\n\treturn 0;\n}\n\nstatic int\nieee802154_set_ackreq_default(struct wpan_phy *wpan_phy,\n\t\t\t      struct wpan_dev *wpan_dev, bool ackreq)\n{\n\tASSERT_RTNL();\n\n\twpan_dev->ackreq = ackreq;\n\treturn 0;\n}\n\nstatic int mac802154_trigger_scan(struct wpan_phy *wpan_phy,\n\t\t\t\t  struct cfg802154_scan_request *request)\n{\n\tstruct ieee802154_sub_if_data *sdata;\n\n\tsdata = IEEE802154_WPAN_DEV_TO_SUB_IF(request->wpan_dev);\n\n\tASSERT_RTNL();\n\n\treturn mac802154_trigger_scan_locked(sdata, request);\n}\n\nstatic int mac802154_abort_scan(struct wpan_phy *wpan_phy,\n\t\t\t\tstruct wpan_dev *wpan_dev)\n{\n\tstruct ieee802154_local *local = wpan_phy_priv(wpan_phy);\n\tstruct ieee802154_sub_if_data *sdata;\n\n\tsdata = IEEE802154_WPAN_DEV_TO_SUB_IF(wpan_dev);\n\n\tASSERT_RTNL();\n\n\treturn mac802154_abort_scan_locked(local, sdata);\n}\n\nstatic int mac802154_send_beacons(struct wpan_phy *wpan_phy,\n\t\t\t\t  struct cfg802154_beacon_request *request)\n{\n\tstruct ieee802154_sub_if_data *sdata;\n\n\tsdata = IEEE802154_WPAN_DEV_TO_SUB_IF(request->wpan_dev);\n\n\tASSERT_RTNL();\n\n\treturn mac802154_send_beacons_locked(sdata, request);\n}\n\nstatic int mac802154_stop_beacons(struct wpan_phy *wpan_phy,\n\t\t\t\t  struct wpan_dev *wpan_dev)\n{\n\tstruct ieee802154_local *local = wpan_phy_priv(wpan_phy);\n\tstruct ieee802154_sub_if_data *sdata;\n\n\tsdata = IEEE802154_WPAN_DEV_TO_SUB_IF(wpan_dev);\n\n\tASSERT_RTNL();\n\n\treturn mac802154_stop_beacons_locked(local, sdata);\n}\n\n#ifdef CONFIG_IEEE802154_NL802154_EXPERIMENTAL\nstatic void\nieee802154_get_llsec_table(struct wpan_phy *wpan_phy,\n\t\t\t   struct wpan_dev *wpan_dev,\n\t\t\t   struct ieee802154_llsec_table **table)\n{\n\tstruct net_device *dev = wpan_dev->netdev;\n\tstruct ieee802154_sub_if_data *sdata = IEEE802154_DEV_TO_SUB_IF(dev);\n\n\t*table = &sdata->sec.table;\n}\n\nstatic void\nieee802154_lock_llsec_table(struct wpan_phy *wpan_phy,\n\t\t\t    struct wpan_dev *wpan_dev)\n{\n\tstruct net_device *dev = wpan_dev->netdev;\n\tstruct ieee802154_sub_if_data *sdata = IEEE802154_DEV_TO_SUB_IF(dev);\n\n\tmutex_lock(&sdata->sec_mtx);\n}\n\nstatic void\nieee802154_unlock_llsec_table(struct wpan_phy *wpan_phy,\n\t\t\t      struct wpan_dev *wpan_dev)\n{\n\tstruct net_device *dev = wpan_dev->netdev;\n\tstruct ieee802154_sub_if_data *sdata = IEEE802154_DEV_TO_SUB_IF(dev);\n\n\tmutex_unlock(&sdata->sec_mtx);\n}\n\nstatic int\nieee802154_set_llsec_params(struct wpan_phy *wpan_phy,\n\t\t\t    struct wpan_dev *wpan_dev,\n\t\t\t    const struct ieee802154_llsec_params *params,\n\t\t\t    int changed)\n{\n\tstruct net_device *dev = wpan_dev->netdev;\n\tstruct ieee802154_sub_if_data *sdata = IEEE802154_DEV_TO_SUB_IF(dev);\n\tint res;\n\n\tmutex_lock(&sdata->sec_mtx);\n\tres = mac802154_llsec_set_params(&sdata->sec, params, changed);\n\tmutex_unlock(&sdata->sec_mtx);\n\n\treturn res;\n}\n\nstatic int\nieee802154_get_llsec_params(struct wpan_phy *wpan_phy,\n\t\t\t    struct wpan_dev *wpan_dev,\n\t\t\t    struct ieee802154_llsec_params *params)\n{\n\tstruct net_device *dev = wpan_dev->netdev;\n\tstruct ieee802154_sub_if_data *sdata = IEEE802154_DEV_TO_SUB_IF(dev);\n\tint res;\n\n\tmutex_lock(&sdata->sec_mtx);\n\tres = mac802154_llsec_get_params(&sdata->sec, params);\n\tmutex_unlock(&sdata->sec_mtx);\n\n\treturn res;\n}\n\nstatic int\nieee802154_add_llsec_key(struct wpan_phy *wpan_phy, struct wpan_dev *wpan_dev,\n\t\t\t const struct ieee802154_llsec_key_id *id,\n\t\t\t const struct ieee802154_llsec_key *key)\n{\n\tstruct net_device *dev = wpan_dev->netdev;\n\tstruct ieee802154_sub_if_data *sdata = IEEE802154_DEV_TO_SUB_IF(dev);\n\tint res;\n\n\tmutex_lock(&sdata->sec_mtx);\n\tres = mac802154_llsec_key_add(&sdata->sec, id, key);\n\tmutex_unlock(&sdata->sec_mtx);\n\n\treturn res;\n}\n\nstatic int\nieee802154_del_llsec_key(struct wpan_phy *wpan_phy, struct wpan_dev *wpan_dev,\n\t\t\t const struct ieee802154_llsec_key_id *id)\n{\n\tstruct net_device *dev = wpan_dev->netdev;\n\tstruct ieee802154_sub_if_data *sdata = IEEE802154_DEV_TO_SUB_IF(dev);\n\tint res;\n\n\tmutex_lock(&sdata->sec_mtx);\n\tres = mac802154_llsec_key_del(&sdata->sec, id);\n\tmutex_unlock(&sdata->sec_mtx);\n\n\treturn res;\n}\n\nstatic int\nieee802154_add_seclevel(struct wpan_phy *wpan_phy, struct wpan_dev *wpan_dev,\n\t\t\tconst struct ieee802154_llsec_seclevel *sl)\n{\n\tstruct net_device *dev = wpan_dev->netdev;\n\tstruct ieee802154_sub_if_data *sdata = IEEE802154_DEV_TO_SUB_IF(dev);\n\tint res;\n\n\tmutex_lock(&sdata->sec_mtx);\n\tres = mac802154_llsec_seclevel_add(&sdata->sec, sl);\n\tmutex_unlock(&sdata->sec_mtx);\n\n\treturn res;\n}\n\nstatic int\nieee802154_del_seclevel(struct wpan_phy *wpan_phy, struct wpan_dev *wpan_dev,\n\t\t\tconst struct ieee802154_llsec_seclevel *sl)\n{\n\tstruct net_device *dev = wpan_dev->netdev;\n\tstruct ieee802154_sub_if_data *sdata = IEEE802154_DEV_TO_SUB_IF(dev);\n\tint res;\n\n\tmutex_lock(&sdata->sec_mtx);\n\tres = mac802154_llsec_seclevel_del(&sdata->sec, sl);\n\tmutex_unlock(&sdata->sec_mtx);\n\n\treturn res;\n}\n\nstatic int\nieee802154_add_device(struct wpan_phy *wpan_phy, struct wpan_dev *wpan_dev,\n\t\t      const struct ieee802154_llsec_device *dev_desc)\n{\n\tstruct net_device *dev = wpan_dev->netdev;\n\tstruct ieee802154_sub_if_data *sdata = IEEE802154_DEV_TO_SUB_IF(dev);\n\tint res;\n\n\tmutex_lock(&sdata->sec_mtx);\n\tres = mac802154_llsec_dev_add(&sdata->sec, dev_desc);\n\tmutex_unlock(&sdata->sec_mtx);\n\n\treturn res;\n}\n\nstatic int\nieee802154_del_device(struct wpan_phy *wpan_phy, struct wpan_dev *wpan_dev,\n\t\t      __le64 extended_addr)\n{\n\tstruct net_device *dev = wpan_dev->netdev;\n\tstruct ieee802154_sub_if_data *sdata = IEEE802154_DEV_TO_SUB_IF(dev);\n\tint res;\n\n\tmutex_lock(&sdata->sec_mtx);\n\tres = mac802154_llsec_dev_del(&sdata->sec, extended_addr);\n\tmutex_unlock(&sdata->sec_mtx);\n\n\treturn res;\n}\n\nstatic int\nieee802154_add_devkey(struct wpan_phy *wpan_phy, struct wpan_dev *wpan_dev,\n\t\t      __le64 extended_addr,\n\t\t      const struct ieee802154_llsec_device_key *key)\n{\n\tstruct net_device *dev = wpan_dev->netdev;\n\tstruct ieee802154_sub_if_data *sdata = IEEE802154_DEV_TO_SUB_IF(dev);\n\tint res;\n\n\tmutex_lock(&sdata->sec_mtx);\n\tres = mac802154_llsec_devkey_add(&sdata->sec, extended_addr, key);\n\tmutex_unlock(&sdata->sec_mtx);\n\n\treturn res;\n}\n\nstatic int\nieee802154_del_devkey(struct wpan_phy *wpan_phy, struct wpan_dev *wpan_dev,\n\t\t      __le64 extended_addr,\n\t\t      const struct ieee802154_llsec_device_key *key)\n{\n\tstruct net_device *dev = wpan_dev->netdev;\n\tstruct ieee802154_sub_if_data *sdata = IEEE802154_DEV_TO_SUB_IF(dev);\n\tint res;\n\n\tmutex_lock(&sdata->sec_mtx);\n\tres = mac802154_llsec_devkey_del(&sdata->sec, extended_addr, key);\n\tmutex_unlock(&sdata->sec_mtx);\n\n\treturn res;\n}\n#endif  \n\nconst struct cfg802154_ops mac802154_config_ops = {\n\t.add_virtual_intf_deprecated = ieee802154_add_iface_deprecated,\n\t.del_virtual_intf_deprecated = ieee802154_del_iface_deprecated,\n\t.suspend = ieee802154_suspend,\n\t.resume = ieee802154_resume,\n\t.add_virtual_intf = ieee802154_add_iface,\n\t.del_virtual_intf = ieee802154_del_iface,\n\t.set_channel = ieee802154_set_channel,\n\t.set_cca_mode = ieee802154_set_cca_mode,\n\t.set_cca_ed_level = ieee802154_set_cca_ed_level,\n\t.set_tx_power = ieee802154_set_tx_power,\n\t.set_pan_id = ieee802154_set_pan_id,\n\t.set_short_addr = ieee802154_set_short_addr,\n\t.set_backoff_exponent = ieee802154_set_backoff_exponent,\n\t.set_max_csma_backoffs = ieee802154_set_max_csma_backoffs,\n\t.set_max_frame_retries = ieee802154_set_max_frame_retries,\n\t.set_lbt_mode = ieee802154_set_lbt_mode,\n\t.set_ackreq_default = ieee802154_set_ackreq_default,\n\t.trigger_scan = mac802154_trigger_scan,\n\t.abort_scan = mac802154_abort_scan,\n\t.send_beacons = mac802154_send_beacons,\n\t.stop_beacons = mac802154_stop_beacons,\n#ifdef CONFIG_IEEE802154_NL802154_EXPERIMENTAL\n\t.get_llsec_table = ieee802154_get_llsec_table,\n\t.lock_llsec_table = ieee802154_lock_llsec_table,\n\t.unlock_llsec_table = ieee802154_unlock_llsec_table,\n\t \n\t.set_llsec_params = ieee802154_set_llsec_params,\n\t.get_llsec_params = ieee802154_get_llsec_params,\n\t.add_llsec_key = ieee802154_add_llsec_key,\n\t.del_llsec_key = ieee802154_del_llsec_key,\n\t.add_seclevel = ieee802154_add_seclevel,\n\t.del_seclevel = ieee802154_del_seclevel,\n\t.add_device = ieee802154_add_device,\n\t.del_device = ieee802154_del_device,\n\t.add_devkey = ieee802154_add_devkey,\n\t.del_devkey = ieee802154_del_devkey,\n#endif  \n};\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}