{
  "module_name": "core.c",
  "hash_id": "6d24e4e9adb0da6d157e8214a121ceda322641a5a204217e2774d18889ced45b",
  "original_prompt": "Ingested from linux-6.6.14/net/tipc/core.c",
  "human_readable_source": " \n\n#include \"core.h\"\n#include \"name_table.h\"\n#include \"subscr.h\"\n#include \"bearer.h\"\n#include \"net.h\"\n#include \"socket.h\"\n#include \"bcast.h\"\n#include \"node.h\"\n#include \"crypto.h\"\n\n#include <linux/module.h>\n\n \nunsigned int tipc_net_id __read_mostly;\nint sysctl_tipc_rmem[3] __read_mostly;\t \n\nstatic int __net_init tipc_init_net(struct net *net)\n{\n\tstruct tipc_net *tn = net_generic(net, tipc_net_id);\n\tint err;\n\n\ttn->net_id = 4711;\n\ttn->node_addr = 0;\n\ttn->trial_addr = 0;\n\ttn->addr_trial_end = 0;\n\ttn->capabilities = TIPC_NODE_CAPABILITIES;\n\tINIT_WORK(&tn->work, tipc_net_finalize_work);\n\tmemset(tn->node_id, 0, sizeof(tn->node_id));\n\tmemset(tn->node_id_string, 0, sizeof(tn->node_id_string));\n\ttn->mon_threshold = TIPC_DEF_MON_THRESHOLD;\n\tget_random_bytes(&tn->random, sizeof(int));\n\tINIT_LIST_HEAD(&tn->node_list);\n\tspin_lock_init(&tn->node_list_lock);\n\n#ifdef CONFIG_TIPC_CRYPTO\n\terr = tipc_crypto_start(&tn->crypto_tx, net, NULL);\n\tif (err)\n\t\tgoto out_crypto;\n#endif\n\terr = tipc_sk_rht_init(net);\n\tif (err)\n\t\tgoto out_sk_rht;\n\n\terr = tipc_nametbl_init(net);\n\tif (err)\n\t\tgoto out_nametbl;\n\n\terr = tipc_bcast_init(net);\n\tif (err)\n\t\tgoto out_bclink;\n\n\terr = tipc_attach_loopback(net);\n\tif (err)\n\t\tgoto out_bclink;\n\n\treturn 0;\n\nout_bclink:\n\ttipc_nametbl_stop(net);\nout_nametbl:\n\ttipc_sk_rht_destroy(net);\nout_sk_rht:\n\n#ifdef CONFIG_TIPC_CRYPTO\n\ttipc_crypto_stop(&tn->crypto_tx);\nout_crypto:\n#endif\n\treturn err;\n}\n\nstatic void __net_exit tipc_exit_net(struct net *net)\n{\n\tstruct tipc_net *tn = tipc_net(net);\n\n\ttipc_detach_loopback(net);\n\ttipc_net_stop(net);\n\t \n\tcancel_work_sync(&tn->work);\n\ttipc_bcast_stop(net);\n\ttipc_nametbl_stop(net);\n\ttipc_sk_rht_destroy(net);\n#ifdef CONFIG_TIPC_CRYPTO\n\ttipc_crypto_stop(&tipc_net(net)->crypto_tx);\n#endif\n\twhile (atomic_read(&tn->wq_count))\n\t\tcond_resched();\n}\n\nstatic void __net_exit tipc_pernet_pre_exit(struct net *net)\n{\n\ttipc_node_pre_cleanup_net(net);\n}\n\nstatic struct pernet_operations tipc_pernet_pre_exit_ops = {\n\t.pre_exit = tipc_pernet_pre_exit,\n};\n\nstatic struct pernet_operations tipc_net_ops = {\n\t.init = tipc_init_net,\n\t.exit = tipc_exit_net,\n\t.id   = &tipc_net_id,\n\t.size = sizeof(struct tipc_net),\n};\n\nstatic struct pernet_operations tipc_topsrv_net_ops = {\n\t.init = tipc_topsrv_init_net,\n\t.exit = tipc_topsrv_exit_net,\n};\n\nstatic int __init tipc_init(void)\n{\n\tint err;\n\n\tpr_info(\"Activated (version \" TIPC_MOD_VER \")\\n\");\n\n\tsysctl_tipc_rmem[0] = RCVBUF_MIN;\n\tsysctl_tipc_rmem[1] = RCVBUF_DEF;\n\tsysctl_tipc_rmem[2] = RCVBUF_MAX;\n\n\terr = tipc_register_sysctl();\n\tif (err)\n\t\tgoto out_sysctl;\n\n\terr = register_pernet_device(&tipc_net_ops);\n\tif (err)\n\t\tgoto out_pernet;\n\n\terr = tipc_socket_init();\n\tif (err)\n\t\tgoto out_socket;\n\n\terr = register_pernet_device(&tipc_topsrv_net_ops);\n\tif (err)\n\t\tgoto out_pernet_topsrv;\n\n\terr = register_pernet_subsys(&tipc_pernet_pre_exit_ops);\n\tif (err)\n\t\tgoto out_register_pernet_subsys;\n\n\terr = tipc_bearer_setup();\n\tif (err)\n\t\tgoto out_bearer;\n\n\terr = tipc_netlink_start();\n\tif (err)\n\t\tgoto out_netlink;\n\n\terr = tipc_netlink_compat_start();\n\tif (err)\n\t\tgoto out_netlink_compat;\n\n\tpr_info(\"Started in single node mode\\n\");\n\treturn 0;\n\nout_netlink_compat:\n\ttipc_netlink_stop();\nout_netlink:\n\ttipc_bearer_cleanup();\nout_bearer:\n\tunregister_pernet_subsys(&tipc_pernet_pre_exit_ops);\nout_register_pernet_subsys:\n\tunregister_pernet_device(&tipc_topsrv_net_ops);\nout_pernet_topsrv:\n\ttipc_socket_stop();\nout_socket:\n\tunregister_pernet_device(&tipc_net_ops);\nout_pernet:\n\ttipc_unregister_sysctl();\nout_sysctl:\n\tpr_err(\"Unable to start in single node mode\\n\");\n\treturn err;\n}\n\nstatic void __exit tipc_exit(void)\n{\n\ttipc_netlink_compat_stop();\n\ttipc_netlink_stop();\n\ttipc_bearer_cleanup();\n\tunregister_pernet_subsys(&tipc_pernet_pre_exit_ops);\n\tunregister_pernet_device(&tipc_topsrv_net_ops);\n\ttipc_socket_stop();\n\tunregister_pernet_device(&tipc_net_ops);\n\ttipc_unregister_sysctl();\n\n\tpr_info(\"Deactivated\\n\");\n}\n\nmodule_init(tipc_init);\nmodule_exit(tipc_exit);\n\nMODULE_DESCRIPTION(\"TIPC: Transparent Inter Process Communication\");\nMODULE_LICENSE(\"Dual BSD/GPL\");\nMODULE_VERSION(TIPC_MOD_VER);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}