{
  "module_name": "cfvidl.c",
  "hash_id": "c042225a23f33d8f65cee880adb459924d46ee728d953beef5d5a2a92800d140",
  "original_prompt": "Ingested from linux-6.6.14/net/caif/cfvidl.c",
  "human_readable_source": "\n \n\n#define pr_fmt(fmt) KBUILD_MODNAME \":%s(): \" fmt, __func__\n\n#include <linux/kernel.h>\n#include <linux/types.h>\n#include <linux/slab.h>\n#include <linux/errno.h>\n#include <net/caif/caif_layer.h>\n#include <net/caif/cfsrvl.h>\n#include <net/caif/cfpkt.h>\n\n#define container_obj(layr) ((struct cfsrvl *) layr)\n\nstatic int cfvidl_receive(struct cflayer *layr, struct cfpkt *pkt);\nstatic int cfvidl_transmit(struct cflayer *layr, struct cfpkt *pkt);\n\nstruct cflayer *cfvidl_create(u8 channel_id, struct dev_info *dev_info)\n{\n\tstruct cfsrvl *vid = kzalloc(sizeof(struct cfsrvl), GFP_ATOMIC);\n\tif (!vid)\n\t\treturn NULL;\n\tcaif_assert(offsetof(struct cfsrvl, layer) == 0);\n\n\tcfsrvl_init(vid, channel_id, dev_info, false);\n\tvid->layer.receive = cfvidl_receive;\n\tvid->layer.transmit = cfvidl_transmit;\n\tsnprintf(vid->layer.name, CAIF_LAYER_NAME_SZ, \"vid1\");\n\treturn &vid->layer;\n}\n\nstatic int cfvidl_receive(struct cflayer *layr, struct cfpkt *pkt)\n{\n\tu32 videoheader;\n\tif (cfpkt_extr_head(pkt, &videoheader, 4) < 0) {\n\t\tpr_err(\"Packet is erroneous!\\n\");\n\t\tcfpkt_destroy(pkt);\n\t\treturn -EPROTO;\n\t}\n\treturn layr->up->receive(layr->up, pkt);\n}\n\nstatic int cfvidl_transmit(struct cflayer *layr, struct cfpkt *pkt)\n{\n\tstruct cfsrvl *service = container_obj(layr);\n\tstruct caif_payload_info *info;\n\tu32 videoheader = 0;\n\tint ret;\n\n\tif (!cfsrvl_ready(service, &ret)) {\n\t\tcfpkt_destroy(pkt);\n\t\treturn ret;\n\t}\n\n\tcfpkt_add_head(pkt, &videoheader, 4);\n\t \n\tinfo = cfpkt_info(pkt);\n\tinfo->channel_id = service->layer.id;\n\tinfo->dev_info = &service->dev_info;\n\treturn layr->dn->transmit(layr->dn, pkt);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}