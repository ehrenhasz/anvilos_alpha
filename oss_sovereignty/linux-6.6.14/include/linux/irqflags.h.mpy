{
  "module_name": "irqflags.h",
  "hash_id": "a47ce386737414186924cf36f1e1d3ebf04ffe7e89ac4d83310dcccf7d67366b",
  "original_prompt": "Ingested from linux-6.6.14/include/linux/irqflags.h",
  "human_readable_source": " \n \n#ifndef _LINUX_TRACE_IRQFLAGS_H\n#define _LINUX_TRACE_IRQFLAGS_H\n\n#include <linux/typecheck.h>\n#include <linux/cleanup.h>\n#include <asm/irqflags.h>\n#include <asm/percpu.h>\n\n \n#ifdef CONFIG_PROVE_LOCKING\n  extern void lockdep_softirqs_on(unsigned long ip);\n  extern void lockdep_softirqs_off(unsigned long ip);\n  extern void lockdep_hardirqs_on_prepare(void);\n  extern void lockdep_hardirqs_on(unsigned long ip);\n  extern void lockdep_hardirqs_off(unsigned long ip);\n#else\n  static inline void lockdep_softirqs_on(unsigned long ip) { }\n  static inline void lockdep_softirqs_off(unsigned long ip) { }\n  static inline void lockdep_hardirqs_on_prepare(void) { }\n  static inline void lockdep_hardirqs_on(unsigned long ip) { }\n  static inline void lockdep_hardirqs_off(unsigned long ip) { }\n#endif\n\n#ifdef CONFIG_TRACE_IRQFLAGS\n\n \nstruct irqtrace_events {\n\tunsigned int\tirq_events;\n\tunsigned long\thardirq_enable_ip;\n\tunsigned long\thardirq_disable_ip;\n\tunsigned int\thardirq_enable_event;\n\tunsigned int\thardirq_disable_event;\n\tunsigned long\tsoftirq_disable_ip;\n\tunsigned long\tsoftirq_enable_ip;\n\tunsigned int\tsoftirq_disable_event;\n\tunsigned int\tsoftirq_enable_event;\n};\n\nDECLARE_PER_CPU(int, hardirqs_enabled);\nDECLARE_PER_CPU(int, hardirq_context);\n\nextern void trace_hardirqs_on_prepare(void);\nextern void trace_hardirqs_off_finish(void);\nextern void trace_hardirqs_on(void);\nextern void trace_hardirqs_off(void);\n\n# define lockdep_hardirq_context()\t(raw_cpu_read(hardirq_context))\n# define lockdep_softirq_context(p)\t((p)->softirq_context)\n# define lockdep_hardirqs_enabled()\t(this_cpu_read(hardirqs_enabled))\n# define lockdep_softirqs_enabled(p)\t((p)->softirqs_enabled)\n# define lockdep_hardirq_enter()\t\t\t\\\ndo {\t\t\t\t\t\t\t\\\n\tif (__this_cpu_inc_return(hardirq_context) == 1)\\\n\t\tcurrent->hardirq_threaded = 0;\t\t\\\n} while (0)\n# define lockdep_hardirq_threaded()\t\t\\\ndo {\t\t\t\t\t\t\\\n\tcurrent->hardirq_threaded = 1;\t\t\\\n} while (0)\n# define lockdep_hardirq_exit()\t\t\t\\\ndo {\t\t\t\t\t\t\\\n\t__this_cpu_dec(hardirq_context);\t\\\n} while (0)\n\n# define lockdep_hrtimer_enter(__hrtimer)\t\t\\\n({\t\t\t\t\t\t\t\\\n\tbool __expires_hardirq = true;\t\t\t\\\n\t\t\t\t\t\t\t\\\n\tif (!__hrtimer->is_hard) {\t\t\t\\\n\t\tcurrent->irq_config = 1;\t\t\\\n\t\t__expires_hardirq = false;\t\t\\\n\t}\t\t\t\t\t\t\\\n\t__expires_hardirq;\t\t\t\t\\\n})\n\n# define lockdep_hrtimer_exit(__expires_hardirq)\t\\\n\tdo {\t\t\t\t\t\t\\\n\t\tif (!__expires_hardirq)\t\t\t\\\n\t\t\tcurrent->irq_config = 0;\t\\\n\t} while (0)\n\n# define lockdep_posixtimer_enter()\t\t\t\t\\\n\t  do {\t\t\t\t\t\t\t\\\n\t\t  current->irq_config = 1;\t\t\t\\\n\t  } while (0)\n\n# define lockdep_posixtimer_exit()\t\t\t\t\\\n\t  do {\t\t\t\t\t\t\t\\\n\t\t  current->irq_config = 0;\t\t\t\\\n\t  } while (0)\n\n# define lockdep_irq_work_enter(_flags)\t\t\t\t\t\\\n\t  do {\t\t\t\t\t\t\t\t\\\n\t\t  if (!((_flags) & IRQ_WORK_HARD_IRQ))\t\t\t\\\n\t\t\tcurrent->irq_config = 1;\t\t\t\\\n\t  } while (0)\n# define lockdep_irq_work_exit(_flags)\t\t\t\t\t\\\n\t  do {\t\t\t\t\t\t\t\t\\\n\t\t  if (!((_flags) & IRQ_WORK_HARD_IRQ))\t\t\t\\\n\t\t\tcurrent->irq_config = 0;\t\t\t\\\n\t  } while (0)\n\n#else\n# define trace_hardirqs_on_prepare()\t\tdo { } while (0)\n# define trace_hardirqs_off_finish()\t\tdo { } while (0)\n# define trace_hardirqs_on()\t\t\tdo { } while (0)\n# define trace_hardirqs_off()\t\t\tdo { } while (0)\n# define lockdep_hardirq_context()\t\t0\n# define lockdep_softirq_context(p)\t\t0\n# define lockdep_hardirqs_enabled()\t\t0\n# define lockdep_softirqs_enabled(p)\t\t0\n# define lockdep_hardirq_enter()\t\tdo { } while (0)\n# define lockdep_hardirq_threaded()\t\tdo { } while (0)\n# define lockdep_hardirq_exit()\t\t\tdo { } while (0)\n# define lockdep_softirq_enter()\t\tdo { } while (0)\n# define lockdep_softirq_exit()\t\t\tdo { } while (0)\n# define lockdep_hrtimer_enter(__hrtimer)\tfalse\n# define lockdep_hrtimer_exit(__context)\tdo { } while (0)\n# define lockdep_posixtimer_enter()\t\tdo { } while (0)\n# define lockdep_posixtimer_exit()\t\tdo { } while (0)\n# define lockdep_irq_work_enter(__work)\t\tdo { } while (0)\n# define lockdep_irq_work_exit(__work)\t\tdo { } while (0)\n#endif\n\n#if defined(CONFIG_TRACE_IRQFLAGS) && !defined(CONFIG_PREEMPT_RT)\n# define lockdep_softirq_enter()\t\t\\\ndo {\t\t\t\t\t\t\\\n\tcurrent->softirq_context++;\t\t\\\n} while (0)\n# define lockdep_softirq_exit()\t\t\t\\\ndo {\t\t\t\t\t\t\\\n\tcurrent->softirq_context--;\t\t\\\n} while (0)\n\n#else\n# define lockdep_softirq_enter()\t\tdo { } while (0)\n# define lockdep_softirq_exit()\t\t\tdo { } while (0)\n#endif\n\n#if defined(CONFIG_IRQSOFF_TRACER) || \\\n\tdefined(CONFIG_PREEMPT_TRACER)\n extern void stop_critical_timings(void);\n extern void start_critical_timings(void);\n#else\n# define stop_critical_timings() do { } while (0)\n# define start_critical_timings() do { } while (0)\n#endif\n\n#ifdef CONFIG_DEBUG_IRQFLAGS\nextern void warn_bogus_irq_restore(void);\n#define raw_check_bogus_irq_restore()\t\t\t\\\n\tdo {\t\t\t\t\t\t\\\n\t\tif (unlikely(!arch_irqs_disabled()))\t\\\n\t\t\twarn_bogus_irq_restore();\t\\\n\t} while (0)\n#else\n#define raw_check_bogus_irq_restore() do { } while (0)\n#endif\n\n \n#define raw_local_irq_disable()\t\tarch_local_irq_disable()\n#define raw_local_irq_enable()\t\tarch_local_irq_enable()\n#define raw_local_irq_save(flags)\t\t\t\\\n\tdo {\t\t\t\t\t\t\\\n\t\ttypecheck(unsigned long, flags);\t\\\n\t\tflags = arch_local_irq_save();\t\t\\\n\t} while (0)\n#define raw_local_irq_restore(flags)\t\t\t\\\n\tdo {\t\t\t\t\t\t\\\n\t\ttypecheck(unsigned long, flags);\t\\\n\t\traw_check_bogus_irq_restore();\t\t\\\n\t\tarch_local_irq_restore(flags);\t\t\\\n\t} while (0)\n#define raw_local_save_flags(flags)\t\t\t\\\n\tdo {\t\t\t\t\t\t\\\n\t\ttypecheck(unsigned long, flags);\t\\\n\t\tflags = arch_local_save_flags();\t\\\n\t} while (0)\n#define raw_irqs_disabled_flags(flags)\t\t\t\\\n\t({\t\t\t\t\t\t\\\n\t\ttypecheck(unsigned long, flags);\t\\\n\t\tarch_irqs_disabled_flags(flags);\t\\\n\t})\n#define raw_irqs_disabled()\t\t(arch_irqs_disabled())\n#define raw_safe_halt()\t\t\tarch_safe_halt()\n\n \n#ifdef CONFIG_TRACE_IRQFLAGS\n\n#define local_irq_enable()\t\t\t\t\\\n\tdo {\t\t\t\t\t\t\\\n\t\ttrace_hardirqs_on();\t\t\t\\\n\t\traw_local_irq_enable();\t\t\t\\\n\t} while (0)\n\n#define local_irq_disable()\t\t\t\t\\\n\tdo {\t\t\t\t\t\t\\\n\t\tbool was_disabled = raw_irqs_disabled();\\\n\t\traw_local_irq_disable();\t\t\\\n\t\tif (!was_disabled)\t\t\t\\\n\t\t\ttrace_hardirqs_off();\t\t\\\n\t} while (0)\n\n#define local_irq_save(flags)\t\t\t\t\\\n\tdo {\t\t\t\t\t\t\\\n\t\traw_local_irq_save(flags);\t\t\\\n\t\tif (!raw_irqs_disabled_flags(flags))\t\\\n\t\t\ttrace_hardirqs_off();\t\t\\\n\t} while (0)\n\n#define local_irq_restore(flags)\t\t\t\\\n\tdo {\t\t\t\t\t\t\\\n\t\tif (!raw_irqs_disabled_flags(flags))\t\\\n\t\t\ttrace_hardirqs_on();\t\t\\\n\t\traw_local_irq_restore(flags);\t\t\\\n\t} while (0)\n\n#define safe_halt()\t\t\t\t\\\n\tdo {\t\t\t\t\t\\\n\t\ttrace_hardirqs_on();\t\t\\\n\t\traw_safe_halt();\t\t\\\n\t} while (0)\n\n\n#else  \n\n#define local_irq_enable()\tdo { raw_local_irq_enable(); } while (0)\n#define local_irq_disable()\tdo { raw_local_irq_disable(); } while (0)\n#define local_irq_save(flags)\tdo { raw_local_irq_save(flags); } while (0)\n#define local_irq_restore(flags) do { raw_local_irq_restore(flags); } while (0)\n#define safe_halt()\t\tdo { raw_safe_halt(); } while (0)\n\n#endif  \n\n#define local_save_flags(flags)\traw_local_save_flags(flags)\n\n \n#ifdef CONFIG_TRACE_IRQFLAGS_SUPPORT\n#define irqs_disabled()\t\t\t\t\t\\\n\t({\t\t\t\t\t\t\\\n\t\tunsigned long _flags;\t\t\t\\\n\t\traw_local_save_flags(_flags);\t\t\\\n\t\traw_irqs_disabled_flags(_flags);\t\\\n\t})\n#else  \n#define irqs_disabled()\traw_irqs_disabled()\n#endif  \n\n#define irqs_disabled_flags(flags) raw_irqs_disabled_flags(flags)\n\nDEFINE_LOCK_GUARD_0(irq, local_irq_disable(), local_irq_enable())\nDEFINE_LOCK_GUARD_0(irqsave,\n\t\t    local_irq_save(_T->flags),\n\t\t    local_irq_restore(_T->flags),\n\t\t    unsigned long flags)\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}