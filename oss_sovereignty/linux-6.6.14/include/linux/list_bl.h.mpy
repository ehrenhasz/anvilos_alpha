{
  "module_name": "list_bl.h",
  "hash_id": "ecefe28b904319862b1c1727ce033820686110ccd3ab0ab06e7d086ca7302076",
  "original_prompt": "Ingested from linux-6.6.14/include/linux/list_bl.h",
  "human_readable_source": " \n#ifndef _LINUX_LIST_BL_H\n#define _LINUX_LIST_BL_H\n\n#include <linux/list.h>\n#include <linux/bit_spinlock.h>\n\n \n\n#if defined(CONFIG_SMP) || defined(CONFIG_DEBUG_SPINLOCK)\n#define LIST_BL_LOCKMASK\t1UL\n#else\n#define LIST_BL_LOCKMASK\t0UL\n#endif\n\n#ifdef CONFIG_DEBUG_LIST\n#define LIST_BL_BUG_ON(x) BUG_ON(x)\n#else\n#define LIST_BL_BUG_ON(x)\n#endif\n\n\nstruct hlist_bl_head {\n\tstruct hlist_bl_node *first;\n};\n\nstruct hlist_bl_node {\n\tstruct hlist_bl_node *next, **pprev;\n};\n#define INIT_HLIST_BL_HEAD(ptr) \\\n\t((ptr)->first = NULL)\n\nstatic inline void INIT_HLIST_BL_NODE(struct hlist_bl_node *h)\n{\n\th->next = NULL;\n\th->pprev = NULL;\n}\n\n#define hlist_bl_entry(ptr, type, member) container_of(ptr,type,member)\n\nstatic inline bool  hlist_bl_unhashed(const struct hlist_bl_node *h)\n{\n\treturn !h->pprev;\n}\n\nstatic inline struct hlist_bl_node *hlist_bl_first(struct hlist_bl_head *h)\n{\n\treturn (struct hlist_bl_node *)\n\t\t((unsigned long)h->first & ~LIST_BL_LOCKMASK);\n}\n\nstatic inline void hlist_bl_set_first(struct hlist_bl_head *h,\n\t\t\t\t\tstruct hlist_bl_node *n)\n{\n\tLIST_BL_BUG_ON((unsigned long)n & LIST_BL_LOCKMASK);\n\tLIST_BL_BUG_ON(((unsigned long)h->first & LIST_BL_LOCKMASK) !=\n\t\t\t\t\t\t\tLIST_BL_LOCKMASK);\n\th->first = (struct hlist_bl_node *)((unsigned long)n | LIST_BL_LOCKMASK);\n}\n\nstatic inline bool hlist_bl_empty(const struct hlist_bl_head *h)\n{\n\treturn !((unsigned long)READ_ONCE(h->first) & ~LIST_BL_LOCKMASK);\n}\n\nstatic inline void hlist_bl_add_head(struct hlist_bl_node *n,\n\t\t\t\t\tstruct hlist_bl_head *h)\n{\n\tstruct hlist_bl_node *first = hlist_bl_first(h);\n\n\tn->next = first;\n\tif (first)\n\t\tfirst->pprev = &n->next;\n\tn->pprev = &h->first;\n\thlist_bl_set_first(h, n);\n}\n\nstatic inline void hlist_bl_add_before(struct hlist_bl_node *n,\n\t\t\t\t       struct hlist_bl_node *next)\n{\n\tstruct hlist_bl_node **pprev = next->pprev;\n\n\tn->pprev = pprev;\n\tn->next = next;\n\tnext->pprev = &n->next;\n\n\t \n\tWRITE_ONCE(*pprev,\n\t\t   (struct hlist_bl_node *)\n\t\t\t((uintptr_t)n | ((uintptr_t)*pprev & LIST_BL_LOCKMASK)));\n}\n\nstatic inline void hlist_bl_add_behind(struct hlist_bl_node *n,\n\t\t\t\t       struct hlist_bl_node *prev)\n{\n\tn->next = prev->next;\n\tn->pprev = &prev->next;\n\tprev->next = n;\n\n\tif (n->next)\n\t\tn->next->pprev = &n->next;\n}\n\nstatic inline void __hlist_bl_del(struct hlist_bl_node *n)\n{\n\tstruct hlist_bl_node *next = n->next;\n\tstruct hlist_bl_node **pprev = n->pprev;\n\n\tLIST_BL_BUG_ON((unsigned long)n & LIST_BL_LOCKMASK);\n\n\t \n\tWRITE_ONCE(*pprev,\n\t\t   (struct hlist_bl_node *)\n\t\t\t((unsigned long)next |\n\t\t\t ((unsigned long)*pprev & LIST_BL_LOCKMASK)));\n\tif (next)\n\t\tnext->pprev = pprev;\n}\n\nstatic inline void hlist_bl_del(struct hlist_bl_node *n)\n{\n\t__hlist_bl_del(n);\n\tn->next = LIST_POISON1;\n\tn->pprev = LIST_POISON2;\n}\n\nstatic inline void hlist_bl_del_init(struct hlist_bl_node *n)\n{\n\tif (!hlist_bl_unhashed(n)) {\n\t\t__hlist_bl_del(n);\n\t\tINIT_HLIST_BL_NODE(n);\n\t}\n}\n\nstatic inline void hlist_bl_lock(struct hlist_bl_head *b)\n{\n\tbit_spin_lock(0, (unsigned long *)b);\n}\n\nstatic inline void hlist_bl_unlock(struct hlist_bl_head *b)\n{\n\t__bit_spin_unlock(0, (unsigned long *)b);\n}\n\nstatic inline bool hlist_bl_is_locked(struct hlist_bl_head *b)\n{\n\treturn bit_spin_is_locked(0, (unsigned long *)b);\n}\n\n \n#define hlist_bl_for_each_entry(tpos, pos, head, member)\t\t\\\n\tfor (pos = hlist_bl_first(head);\t\t\t\t\\\n\t     pos &&\t\t\t\t\t\t\t\\\n\t\t({ tpos = hlist_bl_entry(pos, typeof(*tpos), member); 1;}); \\\n\t     pos = pos->next)\n\n \n#define hlist_bl_for_each_entry_safe(tpos, pos, n, head, member)\t \\\n\tfor (pos = hlist_bl_first(head);\t\t\t\t \\\n\t     pos && ({ n = pos->next; 1; }) && \t\t\t\t \\\n\t\t({ tpos = hlist_bl_entry(pos, typeof(*tpos), member); 1;}); \\\n\t     pos = n)\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}