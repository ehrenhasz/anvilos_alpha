{
  "module_name": "si476x-core.h",
  "hash_id": "5e760ae84756814a418a4c1c40fc014c9de9279651abc29365bfe0478568064a",
  "original_prompt": "Ingested from linux-6.6.14/include/linux/mfd/si476x-core.h",
  "human_readable_source": " \n \n\n#ifndef SI476X_CORE_H\n#define SI476X_CORE_H\n\n#include <linux/kfifo.h>\n#include <linux/atomic.h>\n#include <linux/i2c.h>\n#include <linux/regmap.h>\n#include <linux/mutex.h>\n#include <linux/mfd/core.h>\n#include <linux/videodev2.h>\n#include <linux/regulator/consumer.h>\n\n#include <linux/mfd/si476x-platform.h>\n#include <linux/mfd/si476x-reports.h>\n\n \n#define SI476X_DEFAULT_TIMEOUT\t100000\n#define SI476X_TIMEOUT_TUNE\t700000\n#define SI476X_TIMEOUT_POWER_UP\t330000\n#define SI476X_STATUS_POLL_US\t0\n\n \n\nenum si476x_freq_supported_chips {\n\tSI476X_CHIP_SI4761 = 1,\n\tSI476X_CHIP_SI4764,\n\tSI476X_CHIP_SI4768,\n};\n\nenum si476x_part_revisions {\n\tSI476X_REVISION_A10 = 0,\n\tSI476X_REVISION_A20 = 1,\n\tSI476X_REVISION_A30 = 2,\n};\n\nenum si476x_mfd_cells {\n\tSI476X_RADIO_CELL = 0,\n\tSI476X_CODEC_CELL,\n\tSI476X_MFD_CELLS,\n};\n\n \nenum si476x_power_state {\n\tSI476X_POWER_DOWN\t\t= 0,\n\tSI476X_POWER_UP_FULL\t\t= 1,\n\tSI476X_POWER_INCONSISTENT\t= 2,\n};\n\n \n\nstruct si476x_core {\n\tstruct i2c_client *client;\n\tstruct regmap *regmap;\n\tint chip_id;\n\tstruct mfd_cell cells[SI476X_MFD_CELLS];\n\n\tstruct mutex cmd_lock;  \n\tatomic_t users;\n\n\twait_queue_head_t  rds_read_queue;\n\tstruct kfifo       rds_fifo;\n\tstruct work_struct rds_fifo_drainer;\n\tbool               rds_drainer_is_working;\n\tstruct mutex       rds_drainer_status_lock;\n\n\twait_queue_head_t command;\n\tatomic_t          cts;\n\n\twait_queue_head_t tuning;\n\tatomic_t          stc;\n\n\tstruct si476x_power_up_args power_up_parameters;\n\n\tenum si476x_power_state power_state;\n\n\tstruct regulator_bulk_data supplies[4];\n\n\tint gpio_reset;\n\n\tstruct si476x_pinmux pinmux;\n\tenum si476x_phase_diversity_mode diversity_mode;\n\n\tatomic_t is_alive;\n\n\tstruct delayed_work status_monitor;\n#define SI476X_WORK_TO_CORE(w) container_of(to_delayed_work(w),\t\\\n\t\t\t\t\t    struct si476x_core,\t\\\n\t\t\t\t\t    status_monitor)\n\n\tint revision;\n\n\tint rds_fifo_depth;\n};\n\nstatic inline struct si476x_core *i2c_mfd_cell_to_core(struct device *dev)\n{\n\tstruct i2c_client *client = to_i2c_client(dev->parent);\n\treturn i2c_get_clientdata(client);\n}\n\n\n \nstatic inline void si476x_core_lock(struct si476x_core *core)\n{\n\tmutex_lock(&core->cmd_lock);\n}\n\n \nstatic inline void si476x_core_unlock(struct si476x_core *core)\n{\n\tmutex_unlock(&core->cmd_lock);\n}\n\n \nstatic inline u16 hz_to_si476x(struct si476x_core *core, int freq)\n{\n\tu16 result;\n\n\tswitch (core->power_up_parameters.func) {\n\tdefault:\n\tcase SI476X_FUNC_FM_RECEIVER:\n\t\tresult = freq / 10000;\n\t\tbreak;\n\tcase SI476X_FUNC_AM_RECEIVER:\n\t\tresult = freq / 1000;\n\t\tbreak;\n\t}\n\n\treturn result;\n}\n\nstatic inline int si476x_to_hz(struct si476x_core *core, u16 freq)\n{\n\tint result;\n\n\tswitch (core->power_up_parameters.func) {\n\tdefault:\n\tcase SI476X_FUNC_FM_RECEIVER:\n\t\tresult = freq * 10000;\n\t\tbreak;\n\tcase SI476X_FUNC_AM_RECEIVER:\n\t\tresult = freq * 1000;\n\t\tbreak;\n\t}\n\n\treturn result;\n}\n\n \n\nstatic inline int hz_to_v4l2(int freq)\n{\n\treturn (freq * 10) / 625;\n}\n\nstatic inline int v4l2_to_hz(int freq)\n{\n\treturn (freq * 625) / 10;\n}\n\nstatic inline u16 v4l2_to_si476x(struct si476x_core *core, int freq)\n{\n\treturn hz_to_si476x(core, v4l2_to_hz(freq));\n}\n\nstatic inline int si476x_to_v4l2(struct si476x_core *core, u16 freq)\n{\n\treturn hz_to_v4l2(si476x_to_hz(core, freq));\n}\n\n\n\n \nstruct si476x_func_info {\n\tstruct {\n\t\tu8 major, minor[2];\n\t} firmware;\n\tu16 patch_id;\n\tenum si476x_func func;\n};\n\n \nstruct si476x_power_down_args {\n\tbool xosc;\n};\n\n \nenum si476x_tunemode {\n\tSI476X_TM_VALIDATED_NORMAL_TUNE = 0,\n\tSI476X_TM_INVALIDATED_FAST_TUNE = 1,\n\tSI476X_TM_VALIDATED_AF_TUNE     = 2,\n\tSI476X_TM_VALIDATED_AF_CHECK    = 3,\n};\n\n \nenum si476x_smoothmetrics {\n\tSI476X_SM_INITIALIZE_AUDIO = 0,\n\tSI476X_SM_TRANSITION_AUDIO = 1,\n};\n\n \nstruct si476x_rds_status_report {\n\tbool rdstpptyint, rdspiint, rdssyncint, rdsfifoint;\n\tbool tpptyvalid, pivalid, rdssync, rdsfifolost;\n\tbool tp;\n\n\tu8 pty;\n\tu16 pi;\n\n\tu8 rdsfifoused;\n\tu8 ble[4];\n\n\tstruct v4l2_rds_data rds[4];\n};\n\nstruct si476x_rsq_status_args {\n\tbool primary;\n\tbool rsqack;\n\tbool attune;\n\tbool cancel;\n\tbool stcack;\n};\n\nenum si476x_injside {\n\tSI476X_INJSIDE_AUTO\t= 0,\n\tSI476X_INJSIDE_LOW\t= 1,\n\tSI476X_INJSIDE_HIGH\t= 2,\n};\n\nstruct si476x_tune_freq_args {\n\tbool zifsr;\n\tbool hd;\n\tenum si476x_injside injside;\n\tint freq;\n\tenum si476x_tunemode tunemode;\n\tenum si476x_smoothmetrics smoothmetrics;\n\tint antcap;\n};\n\nint  si476x_core_stop(struct si476x_core *, bool);\nint  si476x_core_start(struct si476x_core *, bool);\nint  si476x_core_set_power_state(struct si476x_core *, enum si476x_power_state);\nbool si476x_core_has_am(struct si476x_core *);\nbool si476x_core_has_diversity(struct si476x_core *);\nbool si476x_core_is_a_secondary_tuner(struct si476x_core *);\nbool si476x_core_is_a_primary_tuner(struct si476x_core *);\nbool si476x_core_is_in_am_receiver_mode(struct si476x_core *core);\nbool si476x_core_is_powered_up(struct si476x_core *core);\n\nenum si476x_i2c_type {\n\tSI476X_I2C_SEND,\n\tSI476X_I2C_RECV\n};\n\nint si476x_core_i2c_xfer(struct si476x_core *,\n\t\t\t enum si476x_i2c_type,\n\t\t\t char *, int);\n\n\n \n\nint si476x_core_cmd_func_info(struct si476x_core *, struct si476x_func_info *);\nint si476x_core_cmd_set_property(struct si476x_core *, u16, u16);\nint si476x_core_cmd_get_property(struct si476x_core *, u16);\nint si476x_core_cmd_dig_audio_pin_cfg(struct si476x_core *,\n\t\t\t\t      enum si476x_dclk_config,\n\t\t\t\t      enum si476x_dfs_config,\n\t\t\t\t      enum si476x_dout_config,\n\t\t\t\t      enum si476x_xout_config);\nint si476x_core_cmd_zif_pin_cfg(struct si476x_core *,\n\t\t\t\tenum si476x_iqclk_config,\n\t\t\t\tenum si476x_iqfs_config,\n\t\t\t\tenum si476x_iout_config,\n\t\t\t\tenum si476x_qout_config);\nint si476x_core_cmd_ic_link_gpo_ctl_pin_cfg(struct si476x_core *,\n\t\t\t\t\t    enum si476x_icin_config,\n\t\t\t\t\t    enum si476x_icip_config,\n\t\t\t\t\t    enum si476x_icon_config,\n\t\t\t\t\t    enum si476x_icop_config);\nint si476x_core_cmd_ana_audio_pin_cfg(struct si476x_core *,\n\t\t\t\t      enum si476x_lrout_config);\nint si476x_core_cmd_intb_pin_cfg(struct si476x_core *, enum si476x_intb_config,\n\t\t\t\t enum si476x_a1_config);\nint si476x_core_cmd_fm_seek_start(struct si476x_core *, bool, bool);\nint si476x_core_cmd_am_seek_start(struct si476x_core *, bool, bool);\nint si476x_core_cmd_fm_rds_status(struct si476x_core *, bool, bool, bool,\n\t\t\t\t  struct si476x_rds_status_report *);\nint si476x_core_cmd_fm_rds_blockcount(struct si476x_core *, bool,\n\t\t\t\t      struct si476x_rds_blockcount_report *);\nint si476x_core_cmd_fm_tune_freq(struct si476x_core *,\n\t\t\t\t struct si476x_tune_freq_args *);\nint si476x_core_cmd_am_tune_freq(struct si476x_core *,\n\t\t\t\t struct si476x_tune_freq_args *);\nint si476x_core_cmd_am_rsq_status(struct si476x_core *,\n\t\t\t\t  struct si476x_rsq_status_args *,\n\t\t\t\t  struct si476x_rsq_status_report *);\nint si476x_core_cmd_fm_rsq_status(struct si476x_core *,\n\t\t\t\t  struct si476x_rsq_status_args *,\n\t\t\t\t  struct si476x_rsq_status_report *);\nint si476x_core_cmd_power_up(struct si476x_core *,\n\t\t\t     struct si476x_power_up_args *);\nint si476x_core_cmd_power_down(struct si476x_core *,\n\t\t\t       struct si476x_power_down_args *);\nint si476x_core_cmd_fm_phase_div_status(struct si476x_core *);\nint si476x_core_cmd_fm_phase_diversity(struct si476x_core *,\n\t\t\t\t       enum si476x_phase_diversity_mode);\n\nint si476x_core_cmd_fm_acf_status(struct si476x_core *,\n\t\t\t\t  struct si476x_acf_status_report *);\nint si476x_core_cmd_am_acf_status(struct si476x_core *,\n\t\t\t\t  struct si476x_acf_status_report *);\nint si476x_core_cmd_agc_status(struct si476x_core *,\n\t\t\t       struct si476x_agc_status_report *);\n\nenum si476x_power_grid_type {\n\tSI476X_POWER_GRID_50HZ = 0,\n\tSI476X_POWER_GRID_60HZ,\n};\n\n \n\nenum si476x_interrupt_flags {\n\tSI476X_STCIEN = (1 << 0),\n\tSI476X_ACFIEN = (1 << 1),\n\tSI476X_RDSIEN = (1 << 2),\n\tSI476X_RSQIEN = (1 << 3),\n\n\tSI476X_ERRIEN = (1 << 6),\n\tSI476X_CTSIEN = (1 << 7),\n\n\tSI476X_STCREP = (1 << 8),\n\tSI476X_ACFREP = (1 << 9),\n\tSI476X_RDSREP = (1 << 10),\n\tSI476X_RSQREP = (1 << 11),\n};\n\nenum si476x_rdsint_sources {\n\tSI476X_RDSTPPTY = (1 << 4),\n\tSI476X_RDSPI    = (1 << 3),\n\tSI476X_RDSSYNC\t= (1 << 1),\n\tSI476X_RDSRECV\t= (1 << 0),\n};\n\nenum si476x_status_response_bits {\n\tSI476X_CTS\t  = (1 << 7),\n\tSI476X_ERR\t  = (1 << 6),\n\t \n\tSI476X_WB_ASQ_INT = (1 << 4),\n\tSI476X_RSQ_INT    = (1 << 3),\n\t \n\tSI476X_FM_RDS_INT = (1 << 2),\n\tSI476X_ACF_INT    = (1 << 1),\n\tSI476X_STC_INT    = (1 << 0),\n};\n\n \n\nenum si476x_common_receiver_properties {\n\tSI476X_PROP_INT_CTL_ENABLE\t\t\t= 0x0000,\n\tSI476X_PROP_DIGITAL_IO_INPUT_SAMPLE_RATE\t= 0x0200,\n\tSI476X_PROP_DIGITAL_IO_INPUT_FORMAT\t\t= 0x0201,\n\tSI476X_PROP_DIGITAL_IO_OUTPUT_SAMPLE_RATE\t= 0x0202,\n\tSI476X_PROP_DIGITAL_IO_OUTPUT_FORMAT\t\t= 0x0203,\n\n\tSI476X_PROP_SEEK_BAND_BOTTOM\t\t\t= 0x1100,\n\tSI476X_PROP_SEEK_BAND_TOP\t\t\t= 0x1101,\n\tSI476X_PROP_SEEK_FREQUENCY_SPACING\t\t= 0x1102,\n\n\tSI476X_PROP_VALID_MAX_TUNE_ERROR\t\t= 0x2000,\n\tSI476X_PROP_VALID_SNR_THRESHOLD\t\t\t= 0x2003,\n\tSI476X_PROP_VALID_RSSI_THRESHOLD\t\t= 0x2004,\n};\n\nenum si476x_am_receiver_properties {\n\tSI476X_PROP_AUDIO_PWR_LINE_FILTER\t\t= 0x0303,\n};\n\nenum si476x_fm_receiver_properties {\n\tSI476X_PROP_AUDIO_DEEMPHASIS\t\t\t= 0x0302,\n\n\tSI476X_PROP_FM_RDS_INTERRUPT_SOURCE\t\t= 0x4000,\n\tSI476X_PROP_FM_RDS_INTERRUPT_FIFO_COUNT\t\t= 0x4001,\n\tSI476X_PROP_FM_RDS_CONFIG\t\t\t= 0x4002,\n};\n\nenum si476x_prop_audio_pwr_line_filter_bits {\n\tSI476X_PROP_PWR_HARMONICS_MASK\t= 0x001f,\n\tSI476X_PROP_PWR_GRID_MASK\t= 0x0100,\n\tSI476X_PROP_PWR_ENABLE_MASK\t= 0x0200,\n\tSI476X_PROP_PWR_GRID_50HZ\t= 0x0000,\n\tSI476X_PROP_PWR_GRID_60HZ\t= 0x0100,\n};\n\nenum si476x_prop_fm_rds_config_bits {\n\tSI476X_PROP_RDSEN_MASK\t= 0x1,\n\tSI476X_PROP_RDSEN\t= 0x1,\n};\n\n\nstruct regmap *devm_regmap_init_si476x(struct si476x_core *);\n\n#endif\t \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}