{
  "module_name": "intel-m10-bmc.h",
  "hash_id": "7c5a67e6778d853151b0812a7c6c0353d35f1915863208396407b37ccb833d6c",
  "original_prompt": "Ingested from linux-6.6.14/include/linux/mfd/intel-m10-bmc.h",
  "human_readable_source": " \n \n#ifndef __MFD_INTEL_M10_BMC_H\n#define __MFD_INTEL_M10_BMC_H\n\n#include <linux/bitfield.h>\n#include <linux/bits.h>\n#include <linux/dev_printk.h>\n#include <linux/regmap.h>\n#include <linux/rwsem.h>\n\n#define M10BMC_N3000_LEGACY_BUILD_VER\t0x300468\n#define M10BMC_N3000_SYS_BASE\t\t0x300800\n#define M10BMC_N3000_SYS_END\t\t0x300fff\n#define M10BMC_N3000_FLASH_BASE\t\t0x10000000\n#define M10BMC_N3000_FLASH_END\t\t0x1fffffff\n#define M10BMC_N3000_MEM_END\t\tM10BMC_N3000_FLASH_END\n\n#define M10BMC_STAGING_BASE\t\t0x18000000\n#define M10BMC_STAGING_SIZE\t\t0x3800000\n\n \n#define NIOS2_N3000_FW_VERSION\t\t0x0\n#define M10BMC_N3000_MAC_LOW\t\t0x10\n#define M10BMC_N3000_MAC_BYTE4\t\tGENMASK(7, 0)\n#define M10BMC_N3000_MAC_BYTE3\t\tGENMASK(15, 8)\n#define M10BMC_N3000_MAC_BYTE2\t\tGENMASK(23, 16)\n#define M10BMC_N3000_MAC_BYTE1\t\tGENMASK(31, 24)\n#define M10BMC_N3000_MAC_HIGH\t\t0x14\n#define M10BMC_N3000_MAC_BYTE6\t\tGENMASK(7, 0)\n#define M10BMC_N3000_MAC_BYTE5\t\tGENMASK(15, 8)\n#define M10BMC_N3000_MAC_COUNT\t\tGENMASK(23, 16)\n#define M10BMC_N3000_TEST_REG\t\t0x3c\n#define M10BMC_N3000_BUILD_VER\t\t0x68\n#define M10BMC_N3000_VER_MAJOR_MSK\tGENMASK(23, 16)\n#define M10BMC_N3000_VER_PCB_INFO_MSK\tGENMASK(31, 24)\n#define M10BMC_N3000_VER_LEGACY_INVALID\t0xffffffff\n\n \n#define M10BMC_N3000_TELEM_START\t0x100\n#define M10BMC_N3000_TELEM_END\t\t0x250\n#define M10BMC_D5005_TELEM_END\t\t0x300\n\n \n#define M10BMC_N3000_DOORBELL\t\t0x400\n\n \n#define M10BMC_N3000_AUTH_RESULT\t\t0x404\n\n \n#define DRBL_RSU_REQUEST\t\tBIT(0)\n#define DRBL_RSU_PROGRESS\t\tGENMASK(7, 4)\n#define DRBL_HOST_STATUS\t\tGENMASK(11, 8)\n#define DRBL_RSU_STATUS\t\t\tGENMASK(23, 16)\n#define DRBL_PKVL_EEPROM_LOAD_SEC\tBIT(24)\n#define DRBL_PKVL1_POLL_EN\t\tBIT(25)\n#define DRBL_PKVL2_POLL_EN\t\tBIT(26)\n#define DRBL_CONFIG_SEL\t\t\tBIT(28)\n#define DRBL_REBOOT_REQ\t\t\tBIT(29)\n#define DRBL_REBOOT_DISABLED\t\tBIT(30)\n\n \n#define RSU_PROG_IDLE\t\t\t0x0\n#define RSU_PROG_PREPARE\t\t0x1\n#define RSU_PROG_READY\t\t\t0x3\n#define RSU_PROG_AUTHENTICATING\t\t0x4\n#define RSU_PROG_COPYING\t\t0x5\n#define RSU_PROG_UPDATE_CANCEL\t\t0x6\n#define RSU_PROG_PROGRAM_KEY_HASH\t0x7\n#define RSU_PROG_RSU_DONE\t\t0x8\n#define RSU_PROG_PKVL_PROM_DONE\t\t0x9\n\n \n#define RSU_STAT_NORMAL\t\t\t0x0\n#define RSU_STAT_TIMEOUT\t\t0x1\n#define RSU_STAT_AUTH_FAIL\t\t0x2\n#define RSU_STAT_COPY_FAIL\t\t0x3\n#define RSU_STAT_FATAL\t\t\t0x4\n#define RSU_STAT_PKVL_REJECT\t\t0x5\n#define RSU_STAT_NON_INC\t\t0x6\n#define RSU_STAT_ERASE_FAIL\t\t0x7\n#define RSU_STAT_WEAROUT\t\t0x8\n#define RSU_STAT_NIOS_OK\t\t0x80\n#define RSU_STAT_USER_OK\t\t0x81\n#define RSU_STAT_FACTORY_OK\t\t0x82\n#define RSU_STAT_USER_FAIL\t\t0x83\n#define RSU_STAT_FACTORY_FAIL\t\t0x84\n#define RSU_STAT_NIOS_FLASH_ERR\t\t0x85\n#define RSU_STAT_FPGA_FLASH_ERR\t\t0x86\n\n#define HOST_STATUS_IDLE\t\t0x0\n#define HOST_STATUS_WRITE_DONE\t\t0x1\n#define HOST_STATUS_ABORT_RSU\t\t0x2\n\n#define rsu_prog(doorbell)\tFIELD_GET(DRBL_RSU_PROGRESS, doorbell)\n\n \n#define NIOS_HANDSHAKE_INTERVAL_US\t(100 * 1000)\n#define NIOS_HANDSHAKE_TIMEOUT_US\t(5 * 1000 * 1000)\n\n \n#define RSU_PREP_INTERVAL_MS\t\t100\n#define RSU_PREP_TIMEOUT_MS\t\t(2 * 60 * 1000)\n\n \n#define RSU_COMPLETE_INTERVAL_MS\t1000\n#define RSU_COMPLETE_TIMEOUT_MS\t\t(40 * 60 * 1000)\n\n \n#define M10BMC_N3000_BMC_REH_ADDR\t0x17ffc004\n#define M10BMC_N3000_BMC_PROG_ADDR\t0x17ffc000\n#define M10BMC_N3000_BMC_PROG_MAGIC\t0x5746\n\n#define M10BMC_N3000_SR_REH_ADDR\t0x17ffd004\n#define M10BMC_N3000_SR_PROG_ADDR\t0x17ffd000\n#define M10BMC_N3000_SR_PROG_MAGIC\t0x5253\n\n#define M10BMC_N3000_PR_REH_ADDR\t0x17ffe004\n#define M10BMC_N3000_PR_PROG_ADDR\t0x17ffe000\n#define M10BMC_N3000_PR_PROG_MAGIC\t0x5250\n\n \n#define M10BMC_N3000_STAGING_FLASH_COUNT\t0x17ffb000\n\n#define M10BMC_N6000_INDIRECT_BASE\t\t0x400\n\n#define M10BMC_N6000_SYS_BASE\t\t\t0x0\n#define M10BMC_N6000_SYS_END\t\t\t0xfff\n\n#define M10BMC_N6000_DOORBELL\t\t\t0x1c0\n#define M10BMC_N6000_AUTH_RESULT\t\t0x1c4\n#define AUTH_RESULT_RSU_STATUS\t\t\tGENMASK(23, 16)\n\n#define M10BMC_N6000_BUILD_VER\t\t\t0x0\n#define NIOS2_N6000_FW_VERSION\t\t\t0x4\n#define M10BMC_N6000_MAC_LOW\t\t\t0x20\n#define M10BMC_N6000_MAC_HIGH\t\t\t(M10BMC_N6000_MAC_LOW + 4)\n\n \n#define M10BMC_N6000_BMC_REH_ADDR\t\t0x7ffc004\n#define M10BMC_N6000_BMC_PROG_ADDR\t\t0x7ffc000\n#define M10BMC_N6000_BMC_PROG_MAGIC\t\t0x5746\n\n#define M10BMC_N6000_SR_REH_ADDR\t\t0x7ffd004\n#define M10BMC_N6000_SR_PROG_ADDR\t\t0x7ffd000\n#define M10BMC_N6000_SR_PROG_MAGIC\t\t0x5253\n\n#define M10BMC_N6000_PR_REH_ADDR\t\t0x7ffe004\n#define M10BMC_N6000_PR_PROG_ADDR\t\t0x7ffe000\n#define M10BMC_N6000_PR_PROG_MAGIC\t\t0x5250\n\n#define M10BMC_N6000_STAGING_FLASH_COUNT\t0x7ff5000\n\n#define M10BMC_N6000_FLASH_MUX_CTRL\t\t0x1d0\n#define M10BMC_N6000_FLASH_MUX_SELECTION\tGENMASK(2, 0)\n#define M10BMC_N6000_FLASH_MUX_IDLE\t\t0\n#define M10BMC_N6000_FLASH_MUX_NIOS\t\t1\n#define M10BMC_N6000_FLASH_MUX_HOST\t\t2\n#define M10BMC_N6000_FLASH_MUX_PFL\t\t4\n#define get_flash_mux(mux)\t\t\tFIELD_GET(M10BMC_N6000_FLASH_MUX_SELECTION, mux)\n\n#define M10BMC_N6000_FLASH_NIOS_REQUEST\t\tBIT(4)\n#define M10BMC_N6000_FLASH_HOST_REQUEST\t\tBIT(5)\n\n#define M10BMC_N6000_FLASH_CTRL\t\t\t0x40\n#define M10BMC_N6000_FLASH_WR_MODE\t\tBIT(0)\n#define M10BMC_N6000_FLASH_RD_MODE\t\tBIT(1)\n#define M10BMC_N6000_FLASH_BUSY\t\t\tBIT(2)\n#define M10BMC_N6000_FLASH_FIFO_SPACE\t\tGENMASK(13, 4)\n#define M10BMC_N6000_FLASH_READ_COUNT\t\tGENMASK(25, 16)\n\n#define M10BMC_N6000_FLASH_ADDR\t\t\t0x44\n#define M10BMC_N6000_FLASH_FIFO\t\t\t0x800\n#define M10BMC_N6000_READ_BLOCK_SIZE\t\t0x800\n#define M10BMC_N6000_FIFO_MAX_BYTES\t\t0x800\n#define M10BMC_N6000_FIFO_WORD_SIZE\t\t4\n#define M10BMC_N6000_FIFO_MAX_WORDS\t\t(M10BMC_N6000_FIFO_MAX_BYTES / \\\n\t\t\t\t\t\t M10BMC_N6000_FIFO_WORD_SIZE)\n\n#define M10BMC_FLASH_INT_US\t\t\t1\n#define M10BMC_FLASH_TIMEOUT_US\t\t\t10000\n\n \nstruct m10bmc_csr_map {\n\tunsigned int base;\n\tunsigned int build_version;\n\tunsigned int fw_version;\n\tunsigned int mac_low;\n\tunsigned int mac_high;\n\tunsigned int doorbell;\n\tunsigned int auth_result;\n\tunsigned int bmc_prog_addr;\n\tunsigned int bmc_reh_addr;\n\tunsigned int bmc_magic;\n\tunsigned int sr_prog_addr;\n\tunsigned int sr_reh_addr;\n\tunsigned int sr_magic;\n\tunsigned int pr_prog_addr;\n\tunsigned int pr_reh_addr;\n\tunsigned int pr_magic;\n\tunsigned int rsu_update_counter;\n};\n\n \nstruct intel_m10bmc_platform_info {\n\tstruct mfd_cell *cells;\n\tint n_cells;\n\tconst struct regmap_range *handshake_sys_reg_ranges;\n\tunsigned int handshake_sys_reg_nranges;\n\tconst struct m10bmc_csr_map *csr_map;\n};\n\nstruct intel_m10bmc;\n\n \nstruct intel_m10bmc_flash_bulk_ops {\n\tint (*read)(struct intel_m10bmc *m10bmc, u8 *buf, u32 addr, u32 size);\n\tint (*write)(struct intel_m10bmc *m10bmc, const u8 *buf, u32 offset, u32 size);\n\tint (*lock_write)(struct intel_m10bmc *m10bmc);\n\tvoid (*unlock_write)(struct intel_m10bmc *m10bmc);\n};\n\nenum m10bmc_fw_state {\n\tM10BMC_FW_STATE_NORMAL,\n\tM10BMC_FW_STATE_SEC_UPDATE_PREPARE,\n\tM10BMC_FW_STATE_SEC_UPDATE_WRITE,\n\tM10BMC_FW_STATE_SEC_UPDATE_PROGRAM,\n};\n\n \nstruct intel_m10bmc {\n\tstruct device *dev;\n\tstruct regmap *regmap;\n\tconst struct intel_m10bmc_platform_info *info;\n\tconst struct intel_m10bmc_flash_bulk_ops *flash_bulk_ops;\n\tstruct rw_semaphore bmcfw_lock;\t\t \n\tenum m10bmc_fw_state bmcfw_state;\n};\n\n \nstatic inline int\nm10bmc_raw_read(struct intel_m10bmc *m10bmc, unsigned int addr,\n\t\tunsigned int *val)\n{\n\tint ret;\n\n\tret = regmap_read(m10bmc->regmap, addr, val);\n\tif (ret)\n\t\tdev_err(m10bmc->dev, \"fail to read raw reg %x: %d\\n\",\n\t\t\taddr, ret);\n\n\treturn ret;\n}\n\nint m10bmc_sys_read(struct intel_m10bmc *m10bmc, unsigned int offset, unsigned int *val);\nint m10bmc_sys_update_bits(struct intel_m10bmc *m10bmc, unsigned int offset,\n\t\t\t   unsigned int msk, unsigned int val);\n\n \nvoid m10bmc_fw_state_set(struct intel_m10bmc *m10bmc, enum m10bmc_fw_state new_state);\n\n \nint m10bmc_dev_init(struct intel_m10bmc *m10bmc, const struct intel_m10bmc_platform_info *info);\nextern const struct attribute_group *m10bmc_dev_groups[];\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}