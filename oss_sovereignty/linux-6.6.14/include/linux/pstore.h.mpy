{
  "module_name": "pstore.h",
  "hash_id": "025ba55ac2dd8dcc43786aa7f2d1071724d1896f98a76f3c0103e26c9715d02d",
  "original_prompt": "Ingested from linux-6.6.14/include/linux/pstore.h",
  "human_readable_source": " \n \n#ifndef _LINUX_PSTORE_H\n#define _LINUX_PSTORE_H\n\n#include <linux/compiler.h>\n#include <linux/errno.h>\n#include <linux/kmsg_dump.h>\n#include <linux/mutex.h>\n#include <linux/spinlock.h>\n#include <linux/time.h>\n#include <linux/types.h>\n\nstruct module;\n\n \nenum pstore_type_id {\n\t \n\tPSTORE_TYPE_DMESG\t= 0,\n\tPSTORE_TYPE_MCE\t\t= 1,\n\tPSTORE_TYPE_CONSOLE\t= 2,\n\tPSTORE_TYPE_FTRACE\t= 3,\n\n\t \n\tPSTORE_TYPE_PPC_RTAS\t= 4,\n\tPSTORE_TYPE_PPC_OF\t= 5,\n\tPSTORE_TYPE_PPC_COMMON\t= 6,\n\tPSTORE_TYPE_PMSG\t= 7,\n\tPSTORE_TYPE_PPC_OPAL\t= 8,\n\n\t \n\tPSTORE_TYPE_MAX\n};\n\nconst char *pstore_type_to_name(enum pstore_type_id type);\nenum pstore_type_id pstore_name_to_type(const char *name);\n\nstruct pstore_info;\n \nstruct pstore_record {\n\tstruct pstore_info\t*psi;\n\tenum pstore_type_id\ttype;\n\tu64\t\t\tid;\n\tstruct timespec64\ttime;\n\tchar\t\t\t*buf;\n\tssize_t\t\t\tsize;\n\tssize_t\t\t\tecc_notice_size;\n\tvoid\t\t\t*priv;\n\n\tint\t\t\tcount;\n\tenum kmsg_dump_reason\treason;\n\tunsigned int\t\tpart;\n\tbool\t\t\tcompressed;\n};\n\n \nstruct pstore_info {\n\tstruct module\t*owner;\n\tconst char\t*name;\n\n\tspinlock_t\tbuf_lock;\n\tchar\t\t*buf;\n\tsize_t\t\tbufsize;\n\n\tstruct mutex\tread_mutex;\n\n\tint\t\tflags;\n\tint\t\tmax_reason;\n\tvoid\t\t*data;\n\n\tint\t\t(*open)(struct pstore_info *psi);\n\tint\t\t(*close)(struct pstore_info *psi);\n\tssize_t\t\t(*read)(struct pstore_record *record);\n\tint\t\t(*write)(struct pstore_record *record);\n\tint\t\t(*write_user)(struct pstore_record *record,\n\t\t\t\t      const char __user *buf);\n\tint\t\t(*erase)(struct pstore_record *record);\n};\n\n \n#define PSTORE_FLAGS_DMESG\tBIT(0)\n#define PSTORE_FLAGS_CONSOLE\tBIT(1)\n#define PSTORE_FLAGS_FTRACE\tBIT(2)\n#define PSTORE_FLAGS_PMSG\tBIT(3)\n\nextern int pstore_register(struct pstore_info *);\nextern void pstore_unregister(struct pstore_info *);\n\nstruct pstore_ftrace_record {\n\tunsigned long ip;\n\tunsigned long parent_ip;\n\tu64 ts;\n};\n\n \n\n#if NR_CPUS <= 2 && defined(CONFIG_ARM_THUMB)\n#define PSTORE_CPU_IN_IP 0x1\n#elif NR_CPUS <= 4 && defined(CONFIG_ARM)\n#define PSTORE_CPU_IN_IP 0x3\n#endif\n\n#define TS_CPU_SHIFT 8\n#define TS_CPU_MASK (BIT(TS_CPU_SHIFT) - 1)\n\n \n#ifdef PSTORE_CPU_IN_IP\nstatic inline void\npstore_ftrace_encode_cpu(struct pstore_ftrace_record *rec, unsigned int cpu)\n{\n\trec->ip |= cpu;\n}\n\nstatic inline unsigned int\npstore_ftrace_decode_cpu(struct pstore_ftrace_record *rec)\n{\n\treturn rec->ip & PSTORE_CPU_IN_IP;\n}\n\nstatic inline u64\npstore_ftrace_read_timestamp(struct pstore_ftrace_record *rec)\n{\n\treturn rec->ts;\n}\n\nstatic inline void\npstore_ftrace_write_timestamp(struct pstore_ftrace_record *rec, u64 val)\n{\n\trec->ts = val;\n}\n#else\nstatic inline void\npstore_ftrace_encode_cpu(struct pstore_ftrace_record *rec, unsigned int cpu)\n{\n\trec->ts &= ~(TS_CPU_MASK);\n\trec->ts |= cpu;\n}\n\nstatic inline unsigned int\npstore_ftrace_decode_cpu(struct pstore_ftrace_record *rec)\n{\n\treturn rec->ts & TS_CPU_MASK;\n}\n\nstatic inline u64\npstore_ftrace_read_timestamp(struct pstore_ftrace_record *rec)\n{\n\treturn rec->ts >> TS_CPU_SHIFT;\n}\n\nstatic inline void\npstore_ftrace_write_timestamp(struct pstore_ftrace_record *rec, u64 val)\n{\n\trec->ts = (rec->ts & TS_CPU_MASK) | (val << TS_CPU_SHIFT);\n}\n#endif\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}