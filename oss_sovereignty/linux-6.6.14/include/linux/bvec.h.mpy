{
  "module_name": "bvec.h",
  "hash_id": "af696a70c0e24531254733ba6e4aa5a3c2de9fd746f900a243b03bcb3168f996",
  "original_prompt": "Ingested from linux-6.6.14/include/linux/bvec.h",
  "human_readable_source": " \n \n#ifndef __LINUX_BVEC_H\n#define __LINUX_BVEC_H\n\n#include <linux/highmem.h>\n#include <linux/bug.h>\n#include <linux/errno.h>\n#include <linux/limits.h>\n#include <linux/minmax.h>\n#include <linux/types.h>\n\nstruct page;\n\n \nstruct bio_vec {\n\tstruct page\t*bv_page;\n\tunsigned int\tbv_len;\n\tunsigned int\tbv_offset;\n};\n\n \nstatic inline void bvec_set_page(struct bio_vec *bv, struct page *page,\n\t\tunsigned int len, unsigned int offset)\n{\n\tbv->bv_page = page;\n\tbv->bv_len = len;\n\tbv->bv_offset = offset;\n}\n\n \nstatic inline void bvec_set_folio(struct bio_vec *bv, struct folio *folio,\n\t\tunsigned int len, unsigned int offset)\n{\n\tbvec_set_page(bv, &folio->page, len, offset);\n}\n\n \nstatic inline void bvec_set_virt(struct bio_vec *bv, void *vaddr,\n\t\tunsigned int len)\n{\n\tbvec_set_page(bv, virt_to_page(vaddr), len, offset_in_page(vaddr));\n}\n\nstruct bvec_iter {\n\tsector_t\t\tbi_sector;\t \n\tunsigned int\t\tbi_size;\t \n\n\tunsigned int\t\tbi_idx;\t\t \n\n\tunsigned int            bi_bvec_done;\t \n} __packed;\n\nstruct bvec_iter_all {\n\tstruct bio_vec\tbv;\n\tint\t\tidx;\n\tunsigned\tdone;\n};\n\n \n#define __bvec_iter_bvec(bvec, iter)\t(&(bvec)[(iter).bi_idx])\n\n \n#define mp_bvec_iter_page(bvec, iter)\t\t\t\t\\\n\t(__bvec_iter_bvec((bvec), (iter))->bv_page)\n\n#define mp_bvec_iter_len(bvec, iter)\t\t\t\t\\\n\tmin((iter).bi_size,\t\t\t\t\t\\\n\t    __bvec_iter_bvec((bvec), (iter))->bv_len - (iter).bi_bvec_done)\n\n#define mp_bvec_iter_offset(bvec, iter)\t\t\t\t\\\n\t(__bvec_iter_bvec((bvec), (iter))->bv_offset + (iter).bi_bvec_done)\n\n#define mp_bvec_iter_page_idx(bvec, iter)\t\t\t\\\n\t(mp_bvec_iter_offset((bvec), (iter)) / PAGE_SIZE)\n\n#define mp_bvec_iter_bvec(bvec, iter)\t\t\t\t\\\n((struct bio_vec) {\t\t\t\t\t\t\\\n\t.bv_page\t= mp_bvec_iter_page((bvec), (iter)),\t\\\n\t.bv_len\t\t= mp_bvec_iter_len((bvec), (iter)),\t\\\n\t.bv_offset\t= mp_bvec_iter_offset((bvec), (iter)),\t\\\n})\n\n \n #define bvec_iter_offset(bvec, iter)\t\t\t\t\\\n\t(mp_bvec_iter_offset((bvec), (iter)) % PAGE_SIZE)\n\n#define bvec_iter_len(bvec, iter)\t\t\t\t\\\n\tmin_t(unsigned, mp_bvec_iter_len((bvec), (iter)),\t\t\\\n\t      PAGE_SIZE - bvec_iter_offset((bvec), (iter)))\n\n#define bvec_iter_page(bvec, iter)\t\t\t\t\\\n\t(mp_bvec_iter_page((bvec), (iter)) +\t\t\t\\\n\t mp_bvec_iter_page_idx((bvec), (iter)))\n\n#define bvec_iter_bvec(bvec, iter)\t\t\t\t\\\n((struct bio_vec) {\t\t\t\t\t\t\\\n\t.bv_page\t= bvec_iter_page((bvec), (iter)),\t\\\n\t.bv_len\t\t= bvec_iter_len((bvec), (iter)),\t\\\n\t.bv_offset\t= bvec_iter_offset((bvec), (iter)),\t\\\n})\n\nstatic inline bool bvec_iter_advance(const struct bio_vec *bv,\n\t\tstruct bvec_iter *iter, unsigned bytes)\n{\n\tunsigned int idx = iter->bi_idx;\n\n\tif (WARN_ONCE(bytes > iter->bi_size,\n\t\t     \"Attempted to advance past end of bvec iter\\n\")) {\n\t\titer->bi_size = 0;\n\t\treturn false;\n\t}\n\n\titer->bi_size -= bytes;\n\tbytes += iter->bi_bvec_done;\n\n\twhile (bytes && bytes >= bv[idx].bv_len) {\n\t\tbytes -= bv[idx].bv_len;\n\t\tidx++;\n\t}\n\n\titer->bi_idx = idx;\n\titer->bi_bvec_done = bytes;\n\treturn true;\n}\n\n \nstatic inline void bvec_iter_advance_single(const struct bio_vec *bv,\n\t\t\t\tstruct bvec_iter *iter, unsigned int bytes)\n{\n\tunsigned int done = iter->bi_bvec_done + bytes;\n\n\tif (done == bv[iter->bi_idx].bv_len) {\n\t\tdone = 0;\n\t\titer->bi_idx++;\n\t}\n\titer->bi_bvec_done = done;\n\titer->bi_size -= bytes;\n}\n\n#define for_each_bvec(bvl, bio_vec, iter, start)\t\t\t\\\n\tfor (iter = (start);\t\t\t\t\t\t\\\n\t     (iter).bi_size &&\t\t\t\t\t\t\\\n\t\t((bvl = bvec_iter_bvec((bio_vec), (iter))), 1);\t\\\n\t     bvec_iter_advance_single((bio_vec), &(iter), (bvl).bv_len))\n\n \n#define BVEC_ITER_ALL_INIT (struct bvec_iter)\t\t\t\t\\\n{\t\t\t\t\t\t\t\t\t\\\n\t.bi_sector\t= 0,\t\t\t\t\t\t\\\n\t.bi_size\t= UINT_MAX,\t\t\t\t\t\\\n\t.bi_idx\t\t= 0,\t\t\t\t\t\t\\\n\t.bi_bvec_done\t= 0,\t\t\t\t\t\t\\\n}\n\nstatic inline struct bio_vec *bvec_init_iter_all(struct bvec_iter_all *iter_all)\n{\n\titer_all->done = 0;\n\titer_all->idx = 0;\n\n\treturn &iter_all->bv;\n}\n\nstatic inline void bvec_advance(const struct bio_vec *bvec,\n\t\t\t\tstruct bvec_iter_all *iter_all)\n{\n\tstruct bio_vec *bv = &iter_all->bv;\n\n\tif (iter_all->done) {\n\t\tbv->bv_page++;\n\t\tbv->bv_offset = 0;\n\t} else {\n\t\tbv->bv_page = bvec->bv_page + (bvec->bv_offset >> PAGE_SHIFT);\n\t\tbv->bv_offset = bvec->bv_offset & ~PAGE_MASK;\n\t}\n\tbv->bv_len = min_t(unsigned int, PAGE_SIZE - bv->bv_offset,\n\t\t\t   bvec->bv_len - iter_all->done);\n\titer_all->done += bv->bv_len;\n\n\tif (iter_all->done == bvec->bv_len) {\n\t\titer_all->idx++;\n\t\titer_all->done = 0;\n\t}\n}\n\n \nstatic inline void *bvec_kmap_local(struct bio_vec *bvec)\n{\n\treturn kmap_local_page(bvec->bv_page) + bvec->bv_offset;\n}\n\n \nstatic inline void memcpy_from_bvec(char *to, struct bio_vec *bvec)\n{\n\tmemcpy_from_page(to, bvec->bv_page, bvec->bv_offset, bvec->bv_len);\n}\n\n \nstatic inline void memcpy_to_bvec(struct bio_vec *bvec, const char *from)\n{\n\tmemcpy_to_page(bvec->bv_page, bvec->bv_offset, from, bvec->bv_len);\n}\n\n \nstatic inline void memzero_bvec(struct bio_vec *bvec)\n{\n\tmemzero_page(bvec->bv_page, bvec->bv_offset, bvec->bv_len);\n}\n\n \nstatic inline void *bvec_virt(struct bio_vec *bvec)\n{\n\tWARN_ON_ONCE(PageHighMem(bvec->bv_page));\n\treturn page_address(bvec->bv_page) + bvec->bv_offset;\n}\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}