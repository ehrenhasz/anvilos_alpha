{
  "module_name": "dev.h",
  "hash_id": "b70fec6bbe58874ef0c40e6d399aa1fd19b086506611a362d54445a9af541d93",
  "original_prompt": "Ingested from linux-6.6.14/include/linux/can/dev.h",
  "human_readable_source": " \n \n\n#ifndef _CAN_DEV_H\n#define _CAN_DEV_H\n\n#include <linux/can.h>\n#include <linux/can/bittiming.h>\n#include <linux/can/error.h>\n#include <linux/can/length.h>\n#include <linux/can/netlink.h>\n#include <linux/can/skb.h>\n#include <linux/ethtool.h>\n#include <linux/netdevice.h>\n\n \nenum can_mode {\n\tCAN_MODE_STOP = 0,\n\tCAN_MODE_START,\n\tCAN_MODE_SLEEP\n};\n\nenum can_termination_gpio {\n\tCAN_TERMINATION_GPIO_DISABLED = 0,\n\tCAN_TERMINATION_GPIO_ENABLED,\n\tCAN_TERMINATION_GPIO_MAX,\n};\n\n \nstruct can_priv {\n\tstruct net_device *dev;\n\tstruct can_device_stats can_stats;\n\n\tconst struct can_bittiming_const *bittiming_const,\n\t\t*data_bittiming_const;\n\tstruct can_bittiming bittiming, data_bittiming;\n\tconst struct can_tdc_const *tdc_const;\n\tstruct can_tdc tdc;\n\n\tunsigned int bitrate_const_cnt;\n\tconst u32 *bitrate_const;\n\tconst u32 *data_bitrate_const;\n\tunsigned int data_bitrate_const_cnt;\n\tu32 bitrate_max;\n\tstruct can_clock clock;\n\n\tunsigned int termination_const_cnt;\n\tconst u16 *termination_const;\n\tu16 termination;\n\tstruct gpio_desc *termination_gpio;\n\tu16 termination_gpio_ohms[CAN_TERMINATION_GPIO_MAX];\n\n\tunsigned int echo_skb_max;\n\tstruct sk_buff **echo_skb;\n\n\tenum can_state state;\n\n\t \n\tu32 ctrlmode;\t\t \n\tu32 ctrlmode_supported;\t \n\n\tint restart_ms;\n\tstruct delayed_work restart_work;\n\n\tint (*do_set_bittiming)(struct net_device *dev);\n\tint (*do_set_data_bittiming)(struct net_device *dev);\n\tint (*do_set_mode)(struct net_device *dev, enum can_mode mode);\n\tint (*do_set_termination)(struct net_device *dev, u16 term);\n\tint (*do_get_state)(const struct net_device *dev,\n\t\t\t    enum can_state *state);\n\tint (*do_get_berr_counter)(const struct net_device *dev,\n\t\t\t\t   struct can_berr_counter *bec);\n\tint (*do_get_auto_tdcv)(const struct net_device *dev, u32 *tdcv);\n};\n\nstatic inline bool can_tdc_is_enabled(const struct can_priv *priv)\n{\n\treturn !!(priv->ctrlmode & CAN_CTRLMODE_TDC_MASK);\n}\n\n \nstatic inline s32 can_get_relative_tdco(const struct can_priv *priv)\n{\n\tconst struct can_bittiming *dbt = &priv->data_bittiming;\n\ts32 sample_point_in_tc = (CAN_SYNC_SEG + dbt->prop_seg +\n\t\t\t\t  dbt->phase_seg1) * dbt->brp;\n\n\treturn (s32)priv->tdc.tdco - sample_point_in_tc;\n}\n\n \nstatic inline int __must_check can_set_static_ctrlmode(struct net_device *dev,\n\t\t\t\t\t\t       u32 static_mode)\n{\n\tstruct can_priv *priv = netdev_priv(dev);\n\n\t \n\tif (priv->ctrlmode_supported & static_mode) {\n\t\tnetdev_warn(dev,\n\t\t\t    \"Controller features can not be supported and static at the same time\\n\");\n\t\treturn -EINVAL;\n\t}\n\tpriv->ctrlmode = static_mode;\n\n\t \n\tif (static_mode & CAN_CTRLMODE_FD)\n\t\tdev->mtu = CANFD_MTU;\n\n\treturn 0;\n}\n\nstatic inline u32 can_get_static_ctrlmode(struct can_priv *priv)\n{\n\treturn priv->ctrlmode & ~priv->ctrlmode_supported;\n}\n\nstatic inline bool can_is_canxl_dev_mtu(unsigned int mtu)\n{\n\treturn (mtu >= CANXL_MIN_MTU && mtu <= CANXL_MAX_MTU);\n}\n\n \nstatic inline bool can_dev_dropped_skb(struct net_device *dev, struct sk_buff *skb)\n{\n\tstruct can_priv *priv = netdev_priv(dev);\n\n\tif (priv->ctrlmode & CAN_CTRLMODE_LISTENONLY) {\n\t\tnetdev_info_once(dev,\n\t\t\t\t \"interface in listen only mode, dropping skb\\n\");\n\t\tkfree_skb(skb);\n\t\tdev->stats.tx_dropped++;\n\t\treturn true;\n\t}\n\n\treturn can_dropped_invalid_skb(dev, skb);\n}\n\nvoid can_setup(struct net_device *dev);\n\nstruct net_device *alloc_candev_mqs(int sizeof_priv, unsigned int echo_skb_max,\n\t\t\t\t    unsigned int txqs, unsigned int rxqs);\n#define alloc_candev(sizeof_priv, echo_skb_max) \\\n\talloc_candev_mqs(sizeof_priv, echo_skb_max, 1, 1)\n#define alloc_candev_mq(sizeof_priv, echo_skb_max, count) \\\n\talloc_candev_mqs(sizeof_priv, echo_skb_max, count, count)\nvoid free_candev(struct net_device *dev);\n\n \nstruct can_priv *safe_candev_priv(struct net_device *dev);\n\nint open_candev(struct net_device *dev);\nvoid close_candev(struct net_device *dev);\nint can_change_mtu(struct net_device *dev, int new_mtu);\nint can_eth_ioctl_hwts(struct net_device *netdev, struct ifreq *ifr, int cmd);\nint can_ethtool_op_get_ts_info_hwts(struct net_device *dev,\n\t\t\t\t    struct ethtool_ts_info *info);\n\nint register_candev(struct net_device *dev);\nvoid unregister_candev(struct net_device *dev);\n\nint can_restart_now(struct net_device *dev);\nvoid can_bus_off(struct net_device *dev);\n\nconst char *can_get_state_str(const enum can_state state);\nvoid can_change_state(struct net_device *dev, struct can_frame *cf,\n\t\t      enum can_state tx_state, enum can_state rx_state);\n\n#ifdef CONFIG_OF\nvoid of_can_transceiver(struct net_device *dev);\n#else\nstatic inline void of_can_transceiver(struct net_device *dev) { }\n#endif\n\nextern struct rtnl_link_ops can_link_ops;\nint can_netlink_register(void);\nvoid can_netlink_unregister(void);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}