{
  "module_name": "iosys-map.h",
  "hash_id": "6619ce9614188d1de9eb59c623e07a7705436811c67b6e3d9d5becd471639d9f",
  "original_prompt": "Ingested from linux-6.6.14/include/linux/iosys-map.h",
  "human_readable_source": " \n \n\n#ifndef __IOSYS_MAP_H__\n#define __IOSYS_MAP_H__\n\n#include <linux/compiler_types.h>\n#include <linux/io.h>\n#include <linux/string.h>\n\n \n\n \nstruct iosys_map {\n\tunion {\n\t\tvoid __iomem *vaddr_iomem;\n\t\tvoid *vaddr;\n\t};\n\tbool is_iomem;\n};\n\n \n#define IOSYS_MAP_INIT_VADDR(vaddr_)\t\\\n\t{\t\t\t\t\\\n\t\t.vaddr = (vaddr_),\t\\\n\t\t.is_iomem = false,\t\\\n\t}\n\n \n#define IOSYS_MAP_INIT_VADDR_IOMEM(vaddr_iomem_)\t\\\n\t{\t\t\t\t\t\t\\\n\t\t.vaddr_iomem = (vaddr_iomem_),\t\t\\\n\t\t.is_iomem = true,\t\t\t\\\n\t}\n\n \n#define IOSYS_MAP_INIT_OFFSET(map_, offset_) ({\t\t\t\t\\\n\tstruct iosys_map copy = *map_;\t\t\t\t\t\\\n\tiosys_map_incr(&copy, offset_);\t\t\t\t\t\\\n\tcopy;\t\t\t\t\t\t\t\t\\\n})\n\n \nstatic inline void iosys_map_set_vaddr(struct iosys_map *map, void *vaddr)\n{\n\tmap->vaddr = vaddr;\n\tmap->is_iomem = false;\n}\n\n \nstatic inline void iosys_map_set_vaddr_iomem(struct iosys_map *map,\n\t\t\t\t\t     void __iomem *vaddr_iomem)\n{\n\tmap->vaddr_iomem = vaddr_iomem;\n\tmap->is_iomem = true;\n}\n\n \nstatic inline bool iosys_map_is_equal(const struct iosys_map *lhs,\n\t\t\t\t      const struct iosys_map *rhs)\n{\n\tif (lhs->is_iomem != rhs->is_iomem)\n\t\treturn false;\n\telse if (lhs->is_iomem)\n\t\treturn lhs->vaddr_iomem == rhs->vaddr_iomem;\n\telse\n\t\treturn lhs->vaddr == rhs->vaddr;\n}\n\n \nstatic inline bool iosys_map_is_null(const struct iosys_map *map)\n{\n\tif (map->is_iomem)\n\t\treturn !map->vaddr_iomem;\n\treturn !map->vaddr;\n}\n\n \nstatic inline bool iosys_map_is_set(const struct iosys_map *map)\n{\n\treturn !iosys_map_is_null(map);\n}\n\n \nstatic inline void iosys_map_clear(struct iosys_map *map)\n{\n\tif (map->is_iomem) {\n\t\tmap->vaddr_iomem = NULL;\n\t\tmap->is_iomem = false;\n\t} else {\n\t\tmap->vaddr = NULL;\n\t}\n}\n\n \nstatic inline void iosys_map_memcpy_to(struct iosys_map *dst, size_t dst_offset,\n\t\t\t\t       const void *src, size_t len)\n{\n\tif (dst->is_iomem)\n\t\tmemcpy_toio(dst->vaddr_iomem + dst_offset, src, len);\n\telse\n\t\tmemcpy(dst->vaddr + dst_offset, src, len);\n}\n\n \nstatic inline void iosys_map_memcpy_from(void *dst, const struct iosys_map *src,\n\t\t\t\t\t size_t src_offset, size_t len)\n{\n\tif (src->is_iomem)\n\t\tmemcpy_fromio(dst, src->vaddr_iomem + src_offset, len);\n\telse\n\t\tmemcpy(dst, src->vaddr + src_offset, len);\n}\n\n \nstatic inline void iosys_map_incr(struct iosys_map *map, size_t incr)\n{\n\tif (map->is_iomem)\n\t\tmap->vaddr_iomem += incr;\n\telse\n\t\tmap->vaddr += incr;\n}\n\n \nstatic inline void iosys_map_memset(struct iosys_map *dst, size_t offset,\n\t\t\t\t    int value, size_t len)\n{\n\tif (dst->is_iomem)\n\t\tmemset_io(dst->vaddr_iomem + offset, value, len);\n\telse\n\t\tmemset(dst->vaddr + offset, value, len);\n}\n\n#ifdef CONFIG_64BIT\n#define __iosys_map_rd_io_u64_case(val_, vaddr_iomem_)\t\t\t\t\\\n\tu64: val_ = readq(vaddr_iomem_)\n#define __iosys_map_wr_io_u64_case(val_, vaddr_iomem_)\t\t\t\t\\\n\tu64: writeq(val_, vaddr_iomem_)\n#else\n#define __iosys_map_rd_io_u64_case(val_, vaddr_iomem_)\t\t\t\t\\\n\tu64: memcpy_fromio(&(val_), vaddr_iomem_, sizeof(u64))\n#define __iosys_map_wr_io_u64_case(val_, vaddr_iomem_)\t\t\t\t\\\n\tu64: memcpy_toio(vaddr_iomem_, &(val_), sizeof(u64))\n#endif\n\n#define __iosys_map_rd_io(val__, vaddr_iomem__, type__) _Generic(val__,\t\t\\\n\tu8: val__ = readb(vaddr_iomem__),\t\t\t\t\t\\\n\tu16: val__ = readw(vaddr_iomem__),\t\t\t\t\t\\\n\tu32: val__ = readl(vaddr_iomem__),\t\t\t\t\t\\\n\t__iosys_map_rd_io_u64_case(val__, vaddr_iomem__))\n\n#define __iosys_map_rd_sys(val__, vaddr__, type__)\t\t\t\t\\\n\tval__ = READ_ONCE(*(type__ *)(vaddr__))\n\n#define __iosys_map_wr_io(val__, vaddr_iomem__, type__) _Generic(val__,\t\t\\\n\tu8: writeb(val__, vaddr_iomem__),\t\t\t\t\t\\\n\tu16: writew(val__, vaddr_iomem__),\t\t\t\t\t\\\n\tu32: writel(val__, vaddr_iomem__),\t\t\t\t\t\\\n\t__iosys_map_wr_io_u64_case(val__, vaddr_iomem__))\n\n#define __iosys_map_wr_sys(val__, vaddr__, type__)\t\t\t\t\\\n\tWRITE_ONCE(*(type__ *)(vaddr__), val__)\n\n \n#define iosys_map_rd(map__, offset__, type__) ({\t\t\t\t\\\n\ttype__ val;\t\t\t\t\t\t\t\t\\\n\tif ((map__)->is_iomem) {\t\t\t\t\t\t\\\n\t\t__iosys_map_rd_io(val, (map__)->vaddr_iomem + (offset__), type__);\\\n\t} else {\t\t\t\t\t\t\t\t\\\n\t\t__iosys_map_rd_sys(val, (map__)->vaddr + (offset__), type__);\t\\\n\t}\t\t\t\t\t\t\t\t\t\\\n\tval;\t\t\t\t\t\t\t\t\t\\\n})\n\n \n#define iosys_map_wr(map__, offset__, type__, val__) ({\t\t\t\t\\\n\ttype__ val = (val__);\t\t\t\t\t\t\t\\\n\tif ((map__)->is_iomem) {\t\t\t\t\t\t\\\n\t\t__iosys_map_wr_io(val, (map__)->vaddr_iomem + (offset__), type__);\\\n\t} else {\t\t\t\t\t\t\t\t\\\n\t\t__iosys_map_wr_sys(val, (map__)->vaddr + (offset__), type__);\t\\\n\t}\t\t\t\t\t\t\t\t\t\\\n})\n\n \n#define iosys_map_rd_field(map__, struct_offset__, struct_type__, field__) ({\t\\\n\tstruct_type__ *s;\t\t\t\t\t\t\t\\\n\tiosys_map_rd(map__, struct_offset__ + offsetof(struct_type__, field__),\t\\\n\t\t     typeof(s->field__));\t\t\t\t\t\\\n})\n\n \n#define iosys_map_wr_field(map__, struct_offset__, struct_type__, field__, val__) ({\t\\\n\tstruct_type__ *s;\t\t\t\t\t\t\t\t\\\n\tiosys_map_wr(map__, struct_offset__ + offsetof(struct_type__, field__),\t\t\\\n\t\t     typeof(s->field__), val__);\t\t\t\t\t\\\n})\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}