{
  "module_name": "srcu.h",
  "hash_id": "7c15bf867f1ca8fa7d23ec9645beab9613396c81ca488be34eb1b46334108d94",
  "original_prompt": "Ingested from linux-6.6.14/include/linux/srcu.h",
  "human_readable_source": " \n \n\n#ifndef _LINUX_SRCU_H\n#define _LINUX_SRCU_H\n\n#include <linux/mutex.h>\n#include <linux/rcupdate.h>\n#include <linux/workqueue.h>\n#include <linux/rcu_segcblist.h>\n\nstruct srcu_struct;\n\n#ifdef CONFIG_DEBUG_LOCK_ALLOC\n\nint __init_srcu_struct(struct srcu_struct *ssp, const char *name,\n\t\t       struct lock_class_key *key);\n\n#define init_srcu_struct(ssp) \\\n({ \\\n\tstatic struct lock_class_key __srcu_key; \\\n\t\\\n\t__init_srcu_struct((ssp), #ssp, &__srcu_key); \\\n})\n\n#define __SRCU_DEP_MAP_INIT(srcu_name)\t.dep_map = { .name = #srcu_name },\n#else  \n\nint init_srcu_struct(struct srcu_struct *ssp);\n\n#define __SRCU_DEP_MAP_INIT(srcu_name)\n#endif  \n\n#ifdef CONFIG_TINY_SRCU\n#include <linux/srcutiny.h>\n#elif defined(CONFIG_TREE_SRCU)\n#include <linux/srcutree.h>\n#else\n#error \"Unknown SRCU implementation specified to kernel configuration\"\n#endif\n\nvoid call_srcu(struct srcu_struct *ssp, struct rcu_head *head,\n\t\tvoid (*func)(struct rcu_head *head));\nvoid cleanup_srcu_struct(struct srcu_struct *ssp);\nint __srcu_read_lock(struct srcu_struct *ssp) __acquires(ssp);\nvoid __srcu_read_unlock(struct srcu_struct *ssp, int idx) __releases(ssp);\nvoid synchronize_srcu(struct srcu_struct *ssp);\nunsigned long get_state_synchronize_srcu(struct srcu_struct *ssp);\nunsigned long start_poll_synchronize_srcu(struct srcu_struct *ssp);\nbool poll_state_synchronize_srcu(struct srcu_struct *ssp, unsigned long cookie);\n\n#ifdef CONFIG_NEED_SRCU_NMI_SAFE\nint __srcu_read_lock_nmisafe(struct srcu_struct *ssp) __acquires(ssp);\nvoid __srcu_read_unlock_nmisafe(struct srcu_struct *ssp, int idx) __releases(ssp);\n#else\nstatic inline int __srcu_read_lock_nmisafe(struct srcu_struct *ssp)\n{\n\treturn __srcu_read_lock(ssp);\n}\nstatic inline void __srcu_read_unlock_nmisafe(struct srcu_struct *ssp, int idx)\n{\n\t__srcu_read_unlock(ssp, idx);\n}\n#endif  \n\nvoid srcu_init(void);\n\n#ifdef CONFIG_DEBUG_LOCK_ALLOC\n\n \nstatic inline int srcu_read_lock_held(const struct srcu_struct *ssp)\n{\n\tif (!debug_lockdep_rcu_enabled())\n\t\treturn 1;\n\treturn lock_is_held(&ssp->dep_map);\n}\n\n \n\n \nstatic inline void srcu_lock_acquire(struct lockdep_map *map)\n{\n\tlock_map_acquire_read(map);\n}\n\n \nstatic inline void srcu_lock_release(struct lockdep_map *map)\n{\n\tlock_map_release(map);\n}\n\n \nstatic inline void srcu_lock_sync(struct lockdep_map *map)\n{\n\tlock_map_sync(map);\n}\n\n#else  \n\nstatic inline int srcu_read_lock_held(const struct srcu_struct *ssp)\n{\n\treturn 1;\n}\n\n#define srcu_lock_acquire(m) do { } while (0)\n#define srcu_lock_release(m) do { } while (0)\n#define srcu_lock_sync(m) do { } while (0)\n\n#endif  \n\n#define SRCU_NMI_UNKNOWN\t0x0\n#define SRCU_NMI_UNSAFE\t\t0x1\n#define SRCU_NMI_SAFE\t\t0x2\n\n#if defined(CONFIG_PROVE_RCU) && defined(CONFIG_TREE_SRCU)\nvoid srcu_check_nmi_safety(struct srcu_struct *ssp, bool nmi_safe);\n#else\nstatic inline void srcu_check_nmi_safety(struct srcu_struct *ssp,\n\t\t\t\t\t bool nmi_safe) { }\n#endif\n\n\n \n#define srcu_dereference_check(p, ssp, c) \\\n\t__rcu_dereference_check((p), __UNIQUE_ID(rcu), \\\n\t\t\t\t(c) || srcu_read_lock_held(ssp), __rcu)\n\n \n#define srcu_dereference(p, ssp) srcu_dereference_check((p), (ssp), 0)\n\n \n#define srcu_dereference_notrace(p, ssp) srcu_dereference_check((p), (ssp), 1)\n\n \nstatic inline int srcu_read_lock(struct srcu_struct *ssp) __acquires(ssp)\n{\n\tint retval;\n\n\tsrcu_check_nmi_safety(ssp, false);\n\tretval = __srcu_read_lock(ssp);\n\tsrcu_lock_acquire(&ssp->dep_map);\n\treturn retval;\n}\n\n \nstatic inline int srcu_read_lock_nmisafe(struct srcu_struct *ssp) __acquires(ssp)\n{\n\tint retval;\n\n\tsrcu_check_nmi_safety(ssp, true);\n\tretval = __srcu_read_lock_nmisafe(ssp);\n\trcu_try_lock_acquire(&ssp->dep_map);\n\treturn retval;\n}\n\n \nstatic inline notrace int\nsrcu_read_lock_notrace(struct srcu_struct *ssp) __acquires(ssp)\n{\n\tint retval;\n\n\tsrcu_check_nmi_safety(ssp, false);\n\tretval = __srcu_read_lock(ssp);\n\treturn retval;\n}\n\n \nstatic inline int srcu_down_read(struct srcu_struct *ssp) __acquires(ssp)\n{\n\tWARN_ON_ONCE(in_nmi());\n\tsrcu_check_nmi_safety(ssp, false);\n\treturn __srcu_read_lock(ssp);\n}\n\n \nstatic inline void srcu_read_unlock(struct srcu_struct *ssp, int idx)\n\t__releases(ssp)\n{\n\tWARN_ON_ONCE(idx & ~0x1);\n\tsrcu_check_nmi_safety(ssp, false);\n\tsrcu_lock_release(&ssp->dep_map);\n\t__srcu_read_unlock(ssp, idx);\n}\n\n \nstatic inline void srcu_read_unlock_nmisafe(struct srcu_struct *ssp, int idx)\n\t__releases(ssp)\n{\n\tWARN_ON_ONCE(idx & ~0x1);\n\tsrcu_check_nmi_safety(ssp, true);\n\trcu_lock_release(&ssp->dep_map);\n\t__srcu_read_unlock_nmisafe(ssp, idx);\n}\n\n \nstatic inline notrace void\nsrcu_read_unlock_notrace(struct srcu_struct *ssp, int idx) __releases(ssp)\n{\n\tsrcu_check_nmi_safety(ssp, false);\n\t__srcu_read_unlock(ssp, idx);\n}\n\n \nstatic inline void srcu_up_read(struct srcu_struct *ssp, int idx)\n\t__releases(ssp)\n{\n\tWARN_ON_ONCE(idx & ~0x1);\n\tWARN_ON_ONCE(in_nmi());\n\tsrcu_check_nmi_safety(ssp, false);\n\t__srcu_read_unlock(ssp, idx);\n}\n\n \nstatic inline void smp_mb__after_srcu_read_unlock(void)\n{\n\t \n}\n\nDEFINE_LOCK_GUARD_1(srcu, struct srcu_struct,\n\t\t    _T->idx = srcu_read_lock(_T->lock),\n\t\t    srcu_read_unlock(_T->lock, _T->idx),\n\t\t    int idx)\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}