{
  "module_name": "pm_domain.h",
  "hash_id": "67ae5e43a278e47d7ed27ccbbbf3450f90fe7567092216ceac172ab8f1c595a8",
  "original_prompt": "Ingested from linux-6.6.14/include/linux/pm_domain.h",
  "human_readable_source": " \n \n\n#ifndef _LINUX_PM_DOMAIN_H\n#define _LINUX_PM_DOMAIN_H\n\n#include <linux/device.h>\n#include <linux/ktime.h>\n#include <linux/mutex.h>\n#include <linux/pm.h>\n#include <linux/err.h>\n#include <linux/of.h>\n#include <linux/notifier.h>\n#include <linux/spinlock.h>\n#include <linux/cpumask.h>\n#include <linux/time64.h>\n\n \n#define GENPD_FLAG_PM_CLK\t (1U << 0)\n#define GENPD_FLAG_IRQ_SAFE\t (1U << 1)\n#define GENPD_FLAG_ALWAYS_ON\t (1U << 2)\n#define GENPD_FLAG_ACTIVE_WAKEUP (1U << 3)\n#define GENPD_FLAG_CPU_DOMAIN\t (1U << 4)\n#define GENPD_FLAG_RPM_ALWAYS_ON (1U << 5)\n#define GENPD_FLAG_MIN_RESIDENCY (1U << 6)\n\nenum gpd_status {\n\tGENPD_STATE_ON = 0,\t \n\tGENPD_STATE_OFF,\t \n};\n\nenum genpd_notication {\n\tGENPD_NOTIFY_PRE_OFF = 0,\n\tGENPD_NOTIFY_OFF,\n\tGENPD_NOTIFY_PRE_ON,\n\tGENPD_NOTIFY_ON,\n};\n\nstruct dev_power_governor {\n\tbool (*power_down_ok)(struct dev_pm_domain *domain);\n\tbool (*suspend_ok)(struct device *dev);\n};\n\nstruct gpd_dev_ops {\n\tint (*start)(struct device *dev);\n\tint (*stop)(struct device *dev);\n};\n\nstruct genpd_governor_data {\n\ts64 max_off_time_ns;\n\tbool max_off_time_changed;\n\tktime_t next_wakeup;\n\tktime_t next_hrtimer;\n\tbool cached_power_down_ok;\n\tbool cached_power_down_state_idx;\n};\n\nstruct genpd_power_state {\n\ts64 power_off_latency_ns;\n\ts64 power_on_latency_ns;\n\ts64 residency_ns;\n\tu64 usage;\n\tu64 rejected;\n\tstruct fwnode_handle *fwnode;\n\tu64 idle_time;\n\tvoid *data;\n};\n\nstruct genpd_lock_ops;\nstruct dev_pm_opp;\nstruct opp_table;\n\nstruct generic_pm_domain {\n\tstruct device dev;\n\tstruct dev_pm_domain domain;\t \n\tstruct list_head gpd_list_node;\t \n\tstruct list_head parent_links;\t \n\tstruct list_head child_links;\t \n\tstruct list_head dev_list;\t \n\tstruct dev_power_governor *gov;\n\tstruct genpd_governor_data *gd;\t \n\tstruct work_struct power_off_work;\n\tstruct fwnode_handle *provider;\t \n\tbool has_provider;\n\tconst char *name;\n\tatomic_t sd_count;\t \n\tenum gpd_status status;\t \n\tunsigned int device_count;\t \n\tunsigned int suspended_count;\t \n\tunsigned int prepared_count;\t \n\tunsigned int performance_state;\t \n\tcpumask_var_t cpus;\t\t \n\tbool synced_poweroff;\t\t \n\tint (*power_off)(struct generic_pm_domain *domain);\n\tint (*power_on)(struct generic_pm_domain *domain);\n\tstruct raw_notifier_head power_notifiers;  \n\tstruct opp_table *opp_table;\t \n\tunsigned int (*opp_to_performance_state)(struct generic_pm_domain *genpd,\n\t\t\t\t\t\t struct dev_pm_opp *opp);\n\tint (*set_performance_state)(struct generic_pm_domain *genpd,\n\t\t\t\t     unsigned int state);\n\tstruct gpd_dev_ops dev_ops;\n\tint (*attach_dev)(struct generic_pm_domain *domain,\n\t\t\t  struct device *dev);\n\tvoid (*detach_dev)(struct generic_pm_domain *domain,\n\t\t\t   struct device *dev);\n\tunsigned int flags;\t\t \n\tstruct genpd_power_state *states;\n\tvoid (*free_states)(struct genpd_power_state *states,\n\t\t\t    unsigned int state_count);\n\tunsigned int state_count;  \n\tunsigned int state_idx;  \n\tu64 on_time;\n\tu64 accounting_time;\n\tconst struct genpd_lock_ops *lock_ops;\n\tunion {\n\t\tstruct mutex mlock;\n\t\tstruct {\n\t\t\tspinlock_t slock;\n\t\t\tunsigned long lock_flags;\n\t\t};\n\t};\n\n};\n\nstatic inline struct generic_pm_domain *pd_to_genpd(struct dev_pm_domain *pd)\n{\n\treturn container_of(pd, struct generic_pm_domain, domain);\n}\n\nstruct gpd_link {\n\tstruct generic_pm_domain *parent;\n\tstruct list_head parent_node;\n\tstruct generic_pm_domain *child;\n\tstruct list_head child_node;\n\n\t \n\tunsigned int performance_state;\n\tunsigned int prev_performance_state;\n};\n\nstruct gpd_timing_data {\n\ts64 suspend_latency_ns;\n\ts64 resume_latency_ns;\n\ts64 effective_constraint_ns;\n\tktime_t\tnext_wakeup;\n\tbool constraint_changed;\n\tbool cached_suspend_ok;\n};\n\nstruct pm_domain_data {\n\tstruct list_head list_node;\n\tstruct device *dev;\n};\n\nstruct generic_pm_domain_data {\n\tstruct pm_domain_data base;\n\tstruct gpd_timing_data *td;\n\tstruct notifier_block nb;\n\tstruct notifier_block *power_nb;\n\tint cpu;\n\tunsigned int performance_state;\n\tunsigned int default_pstate;\n\tunsigned int rpm_pstate;\n\tvoid *data;\n};\n\n#ifdef CONFIG_PM_GENERIC_DOMAINS\nstatic inline struct generic_pm_domain_data *to_gpd_data(struct pm_domain_data *pdd)\n{\n\treturn container_of(pdd, struct generic_pm_domain_data, base);\n}\n\nstatic inline struct generic_pm_domain_data *dev_gpd_data(struct device *dev)\n{\n\treturn to_gpd_data(dev->power.subsys_data->domain_data);\n}\n\nint pm_genpd_add_device(struct generic_pm_domain *genpd, struct device *dev);\nint pm_genpd_remove_device(struct device *dev);\nint pm_genpd_add_subdomain(struct generic_pm_domain *genpd,\n\t\t\t   struct generic_pm_domain *subdomain);\nint pm_genpd_remove_subdomain(struct generic_pm_domain *genpd,\n\t\t\t      struct generic_pm_domain *subdomain);\nint pm_genpd_init(struct generic_pm_domain *genpd,\n\t\t  struct dev_power_governor *gov, bool is_off);\nint pm_genpd_remove(struct generic_pm_domain *genpd);\nint dev_pm_genpd_set_performance_state(struct device *dev, unsigned int state);\nint dev_pm_genpd_add_notifier(struct device *dev, struct notifier_block *nb);\nint dev_pm_genpd_remove_notifier(struct device *dev);\nvoid dev_pm_genpd_set_next_wakeup(struct device *dev, ktime_t next);\nktime_t dev_pm_genpd_get_next_hrtimer(struct device *dev);\nvoid dev_pm_genpd_synced_poweroff(struct device *dev);\n\nextern struct dev_power_governor simple_qos_governor;\nextern struct dev_power_governor pm_domain_always_on_gov;\n#ifdef CONFIG_CPU_IDLE\nextern struct dev_power_governor pm_domain_cpu_gov;\n#endif\n#else\n\nstatic inline struct generic_pm_domain_data *dev_gpd_data(struct device *dev)\n{\n\treturn ERR_PTR(-ENOSYS);\n}\nstatic inline int pm_genpd_add_device(struct generic_pm_domain *genpd,\n\t\t\t\t      struct device *dev)\n{\n\treturn -ENOSYS;\n}\nstatic inline int pm_genpd_remove_device(struct device *dev)\n{\n\treturn -ENOSYS;\n}\nstatic inline int pm_genpd_add_subdomain(struct generic_pm_domain *genpd,\n\t\t\t\t\t struct generic_pm_domain *subdomain)\n{\n\treturn -ENOSYS;\n}\nstatic inline int pm_genpd_remove_subdomain(struct generic_pm_domain *genpd,\n\t\t\t\t\t    struct generic_pm_domain *subdomain)\n{\n\treturn -ENOSYS;\n}\nstatic inline int pm_genpd_init(struct generic_pm_domain *genpd,\n\t\t\t\tstruct dev_power_governor *gov, bool is_off)\n{\n\treturn -ENOSYS;\n}\nstatic inline int pm_genpd_remove(struct generic_pm_domain *genpd)\n{\n\treturn -EOPNOTSUPP;\n}\n\nstatic inline int dev_pm_genpd_set_performance_state(struct device *dev,\n\t\t\t\t\t\t     unsigned int state)\n{\n\treturn -EOPNOTSUPP;\n}\n\nstatic inline int dev_pm_genpd_add_notifier(struct device *dev,\n\t\t\t\t\t    struct notifier_block *nb)\n{\n\treturn -EOPNOTSUPP;\n}\n\nstatic inline int dev_pm_genpd_remove_notifier(struct device *dev)\n{\n\treturn -EOPNOTSUPP;\n}\n\nstatic inline void dev_pm_genpd_set_next_wakeup(struct device *dev, ktime_t next)\n{ }\n\nstatic inline ktime_t dev_pm_genpd_get_next_hrtimer(struct device *dev)\n{\n\treturn KTIME_MAX;\n}\nstatic inline void dev_pm_genpd_synced_poweroff(struct device *dev)\n{ }\n\n#define simple_qos_governor\t\t(*(struct dev_power_governor *)(NULL))\n#define pm_domain_always_on_gov\t\t(*(struct dev_power_governor *)(NULL))\n#endif\n\n#ifdef CONFIG_PM_GENERIC_DOMAINS_SLEEP\nvoid dev_pm_genpd_suspend(struct device *dev);\nvoid dev_pm_genpd_resume(struct device *dev);\n#else\nstatic inline void dev_pm_genpd_suspend(struct device *dev) {}\nstatic inline void dev_pm_genpd_resume(struct device *dev) {}\n#endif\n\n \nstruct of_device_id;\n\ntypedef struct generic_pm_domain *(*genpd_xlate_t)(struct of_phandle_args *args,\n\t\t\t\t\t\t   void *data);\n\nstruct genpd_onecell_data {\n\tstruct generic_pm_domain **domains;\n\tunsigned int num_domains;\n\tgenpd_xlate_t xlate;\n};\n\n#ifdef CONFIG_PM_GENERIC_DOMAINS_OF\nint of_genpd_add_provider_simple(struct device_node *np,\n\t\t\t\t struct generic_pm_domain *genpd);\nint of_genpd_add_provider_onecell(struct device_node *np,\n\t\t\t\t  struct genpd_onecell_data *data);\nvoid of_genpd_del_provider(struct device_node *np);\nint of_genpd_add_device(struct of_phandle_args *args, struct device *dev);\nint of_genpd_add_subdomain(struct of_phandle_args *parent_spec,\n\t\t\t   struct of_phandle_args *subdomain_spec);\nint of_genpd_remove_subdomain(struct of_phandle_args *parent_spec,\n\t\t\t      struct of_phandle_args *subdomain_spec);\nstruct generic_pm_domain *of_genpd_remove_last(struct device_node *np);\nint of_genpd_parse_idle_states(struct device_node *dn,\n\t\t\t       struct genpd_power_state **states, int *n);\nunsigned int pm_genpd_opp_to_performance_state(struct device *genpd_dev,\n\t\t\t\t\t       struct dev_pm_opp *opp);\n\nint genpd_dev_pm_attach(struct device *dev);\nstruct device *genpd_dev_pm_attach_by_id(struct device *dev,\n\t\t\t\t\t unsigned int index);\nstruct device *genpd_dev_pm_attach_by_name(struct device *dev,\n\t\t\t\t\t   const char *name);\n#else  \nstatic inline int of_genpd_add_provider_simple(struct device_node *np,\n\t\t\t\t\tstruct generic_pm_domain *genpd)\n{\n\treturn -EOPNOTSUPP;\n}\n\nstatic inline int of_genpd_add_provider_onecell(struct device_node *np,\n\t\t\t\t\tstruct genpd_onecell_data *data)\n{\n\treturn -EOPNOTSUPP;\n}\n\nstatic inline void of_genpd_del_provider(struct device_node *np) {}\n\nstatic inline int of_genpd_add_device(struct of_phandle_args *args,\n\t\t\t\t      struct device *dev)\n{\n\treturn -ENODEV;\n}\n\nstatic inline int of_genpd_add_subdomain(struct of_phandle_args *parent_spec,\n\t\t\t\t\t struct of_phandle_args *subdomain_spec)\n{\n\treturn -ENODEV;\n}\n\nstatic inline int of_genpd_remove_subdomain(struct of_phandle_args *parent_spec,\n\t\t\t\t\tstruct of_phandle_args *subdomain_spec)\n{\n\treturn -ENODEV;\n}\n\nstatic inline int of_genpd_parse_idle_states(struct device_node *dn,\n\t\t\tstruct genpd_power_state **states, int *n)\n{\n\treturn -ENODEV;\n}\n\nstatic inline unsigned int\npm_genpd_opp_to_performance_state(struct device *genpd_dev,\n\t\t\t\t  struct dev_pm_opp *opp)\n{\n\treturn 0;\n}\n\nstatic inline int genpd_dev_pm_attach(struct device *dev)\n{\n\treturn 0;\n}\n\nstatic inline struct device *genpd_dev_pm_attach_by_id(struct device *dev,\n\t\t\t\t\t\t       unsigned int index)\n{\n\treturn NULL;\n}\n\nstatic inline struct device *genpd_dev_pm_attach_by_name(struct device *dev,\n\t\t\t\t\t\t\t const char *name)\n{\n\treturn NULL;\n}\n\nstatic inline\nstruct generic_pm_domain *of_genpd_remove_last(struct device_node *np)\n{\n\treturn ERR_PTR(-EOPNOTSUPP);\n}\n#endif  \n\n#ifdef CONFIG_PM\nint dev_pm_domain_attach(struct device *dev, bool power_on);\nstruct device *dev_pm_domain_attach_by_id(struct device *dev,\n\t\t\t\t\t  unsigned int index);\nstruct device *dev_pm_domain_attach_by_name(struct device *dev,\n\t\t\t\t\t    const char *name);\nvoid dev_pm_domain_detach(struct device *dev, bool power_off);\nint dev_pm_domain_start(struct device *dev);\nvoid dev_pm_domain_set(struct device *dev, struct dev_pm_domain *pd);\n#else\nstatic inline int dev_pm_domain_attach(struct device *dev, bool power_on)\n{\n\treturn 0;\n}\nstatic inline struct device *dev_pm_domain_attach_by_id(struct device *dev,\n\t\t\t\t\t\t\tunsigned int index)\n{\n\treturn NULL;\n}\nstatic inline struct device *dev_pm_domain_attach_by_name(struct device *dev,\n\t\t\t\t\t\t\t  const char *name)\n{\n\treturn NULL;\n}\nstatic inline void dev_pm_domain_detach(struct device *dev, bool power_off) {}\nstatic inline int dev_pm_domain_start(struct device *dev)\n{\n\treturn 0;\n}\nstatic inline void dev_pm_domain_set(struct device *dev,\n\t\t\t\t     struct dev_pm_domain *pd) {}\n#endif\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}