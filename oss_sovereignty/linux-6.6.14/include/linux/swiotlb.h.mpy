{
  "module_name": "swiotlb.h",
  "hash_id": "3ae38e6c05c908ce9154ccdef7831ab12618e26e4162c06239be49ffabb830e5",
  "original_prompt": "Ingested from linux-6.6.14/include/linux/swiotlb.h",
  "human_readable_source": " \n#ifndef __LINUX_SWIOTLB_H\n#define __LINUX_SWIOTLB_H\n\n#include <linux/device.h>\n#include <linux/dma-direction.h>\n#include <linux/init.h>\n#include <linux/types.h>\n#include <linux/limits.h>\n#include <linux/spinlock.h>\n#include <linux/workqueue.h>\n\nstruct device;\nstruct page;\nstruct scatterlist;\n\n#define SWIOTLB_VERBOSE\t(1 << 0)  \n#define SWIOTLB_FORCE\t(1 << 1)  \n#define SWIOTLB_ANY\t(1 << 2)  \n\n \n#define IO_TLB_SEGSIZE\t128\n\n \n#define IO_TLB_SHIFT 11\n#define IO_TLB_SIZE (1 << IO_TLB_SHIFT)\n\n \n#define IO_TLB_DEFAULT_SIZE (64UL<<20)\n\nunsigned long swiotlb_size_or_default(void);\nvoid __init swiotlb_init_remap(bool addressing_limit, unsigned int flags,\n\tint (*remap)(void *tlb, unsigned long nslabs));\nint swiotlb_init_late(size_t size, gfp_t gfp_mask,\n\tint (*remap)(void *tlb, unsigned long nslabs));\nextern void __init swiotlb_update_mem_attributes(void);\n\nphys_addr_t swiotlb_tbl_map_single(struct device *hwdev, phys_addr_t phys,\n\t\tsize_t mapping_size, size_t alloc_size,\n\t\tunsigned int alloc_aligned_mask, enum dma_data_direction dir,\n\t\tunsigned long attrs);\n\nextern void swiotlb_tbl_unmap_single(struct device *hwdev,\n\t\t\t\t     phys_addr_t tlb_addr,\n\t\t\t\t     size_t mapping_size,\n\t\t\t\t     enum dma_data_direction dir,\n\t\t\t\t     unsigned long attrs);\n\nvoid swiotlb_sync_single_for_device(struct device *dev, phys_addr_t tlb_addr,\n\t\tsize_t size, enum dma_data_direction dir);\nvoid swiotlb_sync_single_for_cpu(struct device *dev, phys_addr_t tlb_addr,\n\t\tsize_t size, enum dma_data_direction dir);\ndma_addr_t swiotlb_map(struct device *dev, phys_addr_t phys,\n\t\tsize_t size, enum dma_data_direction dir, unsigned long attrs);\n\n#ifdef CONFIG_SWIOTLB\n\n \nstruct io_tlb_pool {\n\tphys_addr_t start;\n\tphys_addr_t end;\n\tvoid *vaddr;\n\tunsigned long nslabs;\n\tbool late_alloc;\n\tunsigned int nareas;\n\tunsigned int area_nslabs;\n\tstruct io_tlb_area *areas;\n\tstruct io_tlb_slot *slots;\n#ifdef CONFIG_SWIOTLB_DYNAMIC\n\tstruct list_head node;\n\tstruct rcu_head rcu;\n\tbool transient;\n#endif\n};\n\n \nstruct io_tlb_mem {\n\tstruct io_tlb_pool defpool;\n\tunsigned long nslabs;\n\tstruct dentry *debugfs;\n\tbool force_bounce;\n\tbool for_alloc;\n#ifdef CONFIG_SWIOTLB_DYNAMIC\n\tbool can_grow;\n\tu64 phys_limit;\n\tspinlock_t lock;\n\tstruct list_head pools;\n\tstruct work_struct dyn_alloc;\n#endif\n#ifdef CONFIG_DEBUG_FS\n\tatomic_long_t total_used;\n\tatomic_long_t used_hiwater;\n#endif\n};\n\n#ifdef CONFIG_SWIOTLB_DYNAMIC\n\nstruct io_tlb_pool *swiotlb_find_pool(struct device *dev, phys_addr_t paddr);\n\n#else\n\nstatic inline struct io_tlb_pool *swiotlb_find_pool(struct device *dev,\n\t\t\t\t\t\t    phys_addr_t paddr)\n{\n\treturn &dev->dma_io_tlb_mem->defpool;\n}\n\n#endif\n\n \nstatic inline bool is_swiotlb_buffer(struct device *dev, phys_addr_t paddr)\n{\n\tstruct io_tlb_mem *mem = dev->dma_io_tlb_mem;\n\n\tif (!mem)\n\t\treturn false;\n\n#ifdef CONFIG_SWIOTLB_DYNAMIC\n\t \n\tsmp_rmb();\n\treturn READ_ONCE(dev->dma_uses_io_tlb) &&\n\t\tswiotlb_find_pool(dev, paddr);\n#else\n\treturn paddr >= mem->defpool.start && paddr < mem->defpool.end;\n#endif\n}\n\nstatic inline bool is_swiotlb_force_bounce(struct device *dev)\n{\n\tstruct io_tlb_mem *mem = dev->dma_io_tlb_mem;\n\n\treturn mem && mem->force_bounce;\n}\n\nvoid swiotlb_init(bool addressing_limited, unsigned int flags);\nvoid __init swiotlb_exit(void);\nvoid swiotlb_dev_init(struct device *dev);\nsize_t swiotlb_max_mapping_size(struct device *dev);\nbool is_swiotlb_allocated(void);\nbool is_swiotlb_active(struct device *dev);\nvoid __init swiotlb_adjust_size(unsigned long size);\nphys_addr_t default_swiotlb_base(void);\nphys_addr_t default_swiotlb_limit(void);\n#else\nstatic inline void swiotlb_init(bool addressing_limited, unsigned int flags)\n{\n}\n\nstatic inline void swiotlb_dev_init(struct device *dev)\n{\n}\n\nstatic inline bool is_swiotlb_buffer(struct device *dev, phys_addr_t paddr)\n{\n\treturn false;\n}\nstatic inline bool is_swiotlb_force_bounce(struct device *dev)\n{\n\treturn false;\n}\nstatic inline void swiotlb_exit(void)\n{\n}\nstatic inline size_t swiotlb_max_mapping_size(struct device *dev)\n{\n\treturn SIZE_MAX;\n}\n\nstatic inline bool is_swiotlb_allocated(void)\n{\n\treturn false;\n}\n\nstatic inline bool is_swiotlb_active(struct device *dev)\n{\n\treturn false;\n}\n\nstatic inline void swiotlb_adjust_size(unsigned long size)\n{\n}\n\nstatic inline phys_addr_t default_swiotlb_base(void)\n{\n\treturn 0;\n}\n\nstatic inline phys_addr_t default_swiotlb_limit(void)\n{\n\treturn 0;\n}\n#endif  \n\nextern void swiotlb_print_info(void);\n\n#ifdef CONFIG_DMA_RESTRICTED_POOL\nstruct page *swiotlb_alloc(struct device *dev, size_t size);\nbool swiotlb_free(struct device *dev, struct page *page, size_t size);\n\nstatic inline bool is_swiotlb_for_alloc(struct device *dev)\n{\n\treturn dev->dma_io_tlb_mem->for_alloc;\n}\n#else\nstatic inline struct page *swiotlb_alloc(struct device *dev, size_t size)\n{\n\treturn NULL;\n}\nstatic inline bool swiotlb_free(struct device *dev, struct page *page,\n\t\t\t\tsize_t size)\n{\n\treturn false;\n}\nstatic inline bool is_swiotlb_for_alloc(struct device *dev)\n{\n\treturn false;\n}\n#endif  \n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}