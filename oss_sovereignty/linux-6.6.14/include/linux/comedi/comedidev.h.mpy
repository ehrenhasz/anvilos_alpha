{
  "module_name": "comedidev.h",
  "hash_id": "7ebfcd9d1f1c046b9cf34f77f1b578537e07ca4232860398cd508114fa43a8d6",
  "original_prompt": "Ingested from linux-6.6.14/include/linux/comedi/comedidev.h",
  "human_readable_source": " \n \n\n#ifndef _COMEDIDEV_H\n#define _COMEDIDEV_H\n\n#include <linux/dma-mapping.h>\n#include <linux/mutex.h>\n#include <linux/spinlock_types.h>\n#include <linux/rwsem.h>\n#include <linux/kref.h>\n#include <linux/comedi.h>\n\n#define COMEDI_VERSION(a, b, c) (((a) << 16) + ((b) << 8) + (c))\n#define COMEDI_VERSION_CODE COMEDI_VERSION(COMEDI_MAJORVERSION, \\\n\tCOMEDI_MINORVERSION, COMEDI_MICROVERSION)\n#define COMEDI_RELEASE VERSION\n\n#define COMEDI_NUM_BOARD_MINORS 0x30\n\n \nstruct comedi_subdevice {\n\tstruct comedi_device *device;\n\tint index;\n\tint type;\n\tint n_chan;\n\tint subdev_flags;\n\tint len_chanlist;\t \n\n\tvoid *private;\n\n\tstruct comedi_async *async;\n\n\tvoid *lock;\n\tvoid *busy;\n\tunsigned int runflags;\n\tspinlock_t spin_lock;\t \n\n\tunsigned int io_bits;\n\n\tunsigned int maxdata;\t \n\tconst unsigned int *maxdata_list;\t \n\n\tconst struct comedi_lrange *range_table;\n\tconst struct comedi_lrange *const *range_table_list;\n\n\tunsigned int *chanlist;\t \n\n\tint (*insn_read)(struct comedi_device *dev, struct comedi_subdevice *s,\n\t\t\t struct comedi_insn *insn, unsigned int *data);\n\tint (*insn_write)(struct comedi_device *dev, struct comedi_subdevice *s,\n\t\t\t  struct comedi_insn *insn, unsigned int *data);\n\tint (*insn_bits)(struct comedi_device *dev, struct comedi_subdevice *s,\n\t\t\t struct comedi_insn *insn, unsigned int *data);\n\tint (*insn_config)(struct comedi_device *dev,\n\t\t\t   struct comedi_subdevice *s,\n\t\t\t   struct comedi_insn *insn,\n\t\t\t   unsigned int *data);\n\n\tint (*do_cmd)(struct comedi_device *dev, struct comedi_subdevice *s);\n\tint (*do_cmdtest)(struct comedi_device *dev,\n\t\t\t  struct comedi_subdevice *s,\n\t\t\t  struct comedi_cmd *cmd);\n\tint (*poll)(struct comedi_device *dev, struct comedi_subdevice *s);\n\tint (*cancel)(struct comedi_device *dev, struct comedi_subdevice *s);\n\n\t \n\tint (*buf_change)(struct comedi_device *dev,\n\t\t\t  struct comedi_subdevice *s);\n\n\tvoid (*munge)(struct comedi_device *dev, struct comedi_subdevice *s,\n\t\t      void *data, unsigned int num_bytes,\n\t\t      unsigned int start_chan_index);\n\tenum dma_data_direction async_dma_dir;\n\n\tunsigned int state;\n\n\tstruct device *class_dev;\n\tint minor;\n\n\tunsigned int *readback;\n};\n\n \nstruct comedi_buf_page {\n\tvoid *virt_addr;\n\tdma_addr_t dma_addr;\n};\n\n \nstruct comedi_buf_map {\n\tstruct device *dma_hw_dev;\n\tstruct comedi_buf_page *page_list;\n\tunsigned int n_pages;\n\tenum dma_data_direction dma_dir;\n\tstruct kref refcount;\n};\n\n \nstruct comedi_async {\n\tvoid *prealloc_buf;\n\tunsigned int prealloc_bufsz;\n\tstruct comedi_buf_map *buf_map;\n\tunsigned int max_bufsize;\n\tunsigned int buf_write_count;\n\tunsigned int buf_write_alloc_count;\n\tunsigned int buf_read_count;\n\tunsigned int buf_read_alloc_count;\n\tunsigned int buf_write_ptr;\n\tunsigned int buf_read_ptr;\n\tunsigned int cur_chan;\n\tunsigned int scans_done;\n\tunsigned int scan_progress;\n\tunsigned int munge_chan;\n\tunsigned int munge_count;\n\tunsigned int munge_ptr;\n\tunsigned int events;\n\tstruct comedi_cmd cmd;\n\twait_queue_head_t wait_head;\n\tunsigned int cb_mask;\n\tint (*inttrig)(struct comedi_device *dev, struct comedi_subdevice *s,\n\t\t       unsigned int x);\n};\n\n \nenum comedi_cb {\n\tCOMEDI_CB_EOS\t\t= BIT(0),\n\tCOMEDI_CB_EOA\t\t= BIT(1),\n\tCOMEDI_CB_BLOCK\t\t= BIT(2),\n\tCOMEDI_CB_EOBUF\t\t= BIT(3),\n\tCOMEDI_CB_ERROR\t\t= BIT(4),\n\tCOMEDI_CB_OVERFLOW\t= BIT(5),\n\t \n\tCOMEDI_CB_ERROR_MASK\t= (COMEDI_CB_ERROR | COMEDI_CB_OVERFLOW),\n\tCOMEDI_CB_CANCEL_MASK\t= (COMEDI_CB_EOA | COMEDI_CB_ERROR_MASK)\n};\n\n \nstruct comedi_driver {\n\t \n\tstruct comedi_driver *next;\t \n\t \n\tconst char *driver_name;\n\tstruct module *module;\n\tint (*attach)(struct comedi_device *dev, struct comedi_devconfig *it);\n\tvoid (*detach)(struct comedi_device *dev);\n\tint (*auto_attach)(struct comedi_device *dev, unsigned long context);\n\tunsigned int num_names;\n\tconst char *const *board_name;\n\tint offset;\n};\n\n \nstruct comedi_device {\n\tint use_count;\n\tstruct comedi_driver *driver;\n\tstruct comedi_8254 *pacer;\n\tvoid *private;\n\n\tstruct device *class_dev;\n\tint minor;\n\tunsigned int detach_count;\n\tstruct device *hw_dev;\n\n\tconst char *board_name;\n\tconst void *board_ptr;\n\tunsigned int attached:1;\n\tunsigned int ioenabled:1;\n\tspinlock_t spinlock;\t \n\tstruct mutex mutex;\t \n\tstruct rw_semaphore attach_lock;\n\tstruct kref refcount;\n\n\tint n_subdevices;\n\tstruct comedi_subdevice *subdevices;\n\n\t \n\tvoid __iomem *mmio;\n\tunsigned long iobase;\n\tunsigned long iolen;\n\tunsigned int irq;\n\n\tstruct comedi_subdevice *read_subdev;\n\tstruct comedi_subdevice *write_subdev;\n\n\tstruct fasync_struct *async_queue;\n\n\tint (*open)(struct comedi_device *dev);\n\tvoid (*close)(struct comedi_device *dev);\n\tint (*insn_device_config)(struct comedi_device *dev,\n\t\t\t\t  struct comedi_insn *insn, unsigned int *data);\n\tunsigned int (*get_valid_routes)(struct comedi_device *dev,\n\t\t\t\t\t unsigned int n_pairs,\n\t\t\t\t\t unsigned int *pair_data);\n};\n\n \n\nvoid comedi_event(struct comedi_device *dev, struct comedi_subdevice *s);\n\nstruct comedi_device *comedi_dev_get_from_minor(unsigned int minor);\nint comedi_dev_put(struct comedi_device *dev);\n\nbool comedi_is_subdevice_running(struct comedi_subdevice *s);\n\nvoid *comedi_alloc_spriv(struct comedi_subdevice *s, size_t size);\nvoid comedi_set_spriv_auto_free(struct comedi_subdevice *s);\n\nint comedi_check_chanlist(struct comedi_subdevice *s,\n\t\t\t  int n,\n\t\t\t  unsigned int *chanlist);\n\n \n\n#define RANGE(a, b)\t\t{(a) * 1e6, (b) * 1e6, 0}\n#define RANGE_ext(a, b)\t\t{(a) * 1e6, (b) * 1e6, RF_EXTERNAL}\n#define RANGE_mA(a, b)\t\t{(a) * 1e6, (b) * 1e6, UNIT_mA}\n#define RANGE_unitless(a, b)\t{(a) * 1e6, (b) * 1e6, 0}\n#define BIP_RANGE(a)\t\t{-(a) * 1e6, (a) * 1e6, 0}\n#define UNI_RANGE(a)\t\t{0, (a) * 1e6, 0}\n\nextern const struct comedi_lrange range_bipolar10;\nextern const struct comedi_lrange range_bipolar5;\nextern const struct comedi_lrange range_bipolar2_5;\nextern const struct comedi_lrange range_unipolar10;\nextern const struct comedi_lrange range_unipolar5;\nextern const struct comedi_lrange range_unipolar2_5;\nextern const struct comedi_lrange range_0_20mA;\nextern const struct comedi_lrange range_4_20mA;\nextern const struct comedi_lrange range_0_32mA;\nextern const struct comedi_lrange range_unknown;\n\n#define range_digital\t\trange_unipolar5\n\n \nstruct comedi_lrange {\n\tint length;\n\tstruct comedi_krange range[];\n};\n\n \nstatic inline bool comedi_range_is_bipolar(struct comedi_subdevice *s,\n\t\t\t\t\t   unsigned int range)\n{\n\treturn s->range_table->range[range].min < 0;\n}\n\n \nstatic inline bool comedi_range_is_unipolar(struct comedi_subdevice *s,\n\t\t\t\t\t    unsigned int range)\n{\n\treturn s->range_table->range[range].min >= 0;\n}\n\n \nstatic inline bool comedi_range_is_external(struct comedi_subdevice *s,\n\t\t\t\t\t    unsigned int range)\n{\n\treturn !!(s->range_table->range[range].flags & RF_EXTERNAL);\n}\n\n \nstatic inline bool comedi_chan_range_is_bipolar(struct comedi_subdevice *s,\n\t\t\t\t\t\tunsigned int chan,\n\t\t\t\t\t\tunsigned int range)\n{\n\treturn s->range_table_list[chan]->range[range].min < 0;\n}\n\n \nstatic inline bool comedi_chan_range_is_unipolar(struct comedi_subdevice *s,\n\t\t\t\t\t\t unsigned int chan,\n\t\t\t\t\t\t unsigned int range)\n{\n\treturn s->range_table_list[chan]->range[range].min >= 0;\n}\n\n \nstatic inline bool comedi_chan_range_is_external(struct comedi_subdevice *s,\n\t\t\t\t\t\t unsigned int chan,\n\t\t\t\t\t\t unsigned int range)\n{\n\treturn !!(s->range_table_list[chan]->range[range].flags & RF_EXTERNAL);\n}\n\n \nstatic inline unsigned int comedi_offset_munge(struct comedi_subdevice *s,\n\t\t\t\t\t       unsigned int val)\n{\n\treturn val ^ s->maxdata ^ (s->maxdata >> 1);\n}\n\n \nstatic inline unsigned int comedi_bytes_per_sample(struct comedi_subdevice *s)\n{\n\treturn s->subdev_flags & SDF_LSAMPL ? sizeof(int) : sizeof(short);\n}\n\n \nstatic inline unsigned int comedi_sample_shift(struct comedi_subdevice *s)\n{\n\treturn s->subdev_flags & SDF_LSAMPL ? 2 : 1;\n}\n\n \nstatic inline unsigned int comedi_bytes_to_samples(struct comedi_subdevice *s,\n\t\t\t\t\t\t   unsigned int nbytes)\n{\n\treturn nbytes >> comedi_sample_shift(s);\n}\n\n \nstatic inline unsigned int comedi_samples_to_bytes(struct comedi_subdevice *s,\n\t\t\t\t\t\t   unsigned int nsamples)\n{\n\treturn nsamples << comedi_sample_shift(s);\n}\n\n \nstatic inline int comedi_check_trigger_src(unsigned int *src,\n\t\t\t\t\t   unsigned int flags)\n{\n\tunsigned int orig_src = *src;\n\n\t*src = orig_src & flags;\n\tif (*src == TRIG_INVALID || *src != orig_src)\n\t\treturn -EINVAL;\n\treturn 0;\n}\n\n \nstatic inline int comedi_check_trigger_is_unique(unsigned int src)\n{\n\t \n\tif ((src & (src - 1)) != 0)\n\t\treturn -EINVAL;\n\treturn 0;\n}\n\n \nstatic inline int comedi_check_trigger_arg_is(unsigned int *arg,\n\t\t\t\t\t      unsigned int val)\n{\n\tif (*arg != val) {\n\t\t*arg = val;\n\t\treturn -EINVAL;\n\t}\n\treturn 0;\n}\n\n \nstatic inline int comedi_check_trigger_arg_min(unsigned int *arg,\n\t\t\t\t\t       unsigned int val)\n{\n\tif (*arg < val) {\n\t\t*arg = val;\n\t\treturn -EINVAL;\n\t}\n\treturn 0;\n}\n\n \nstatic inline int comedi_check_trigger_arg_max(unsigned int *arg,\n\t\t\t\t\t       unsigned int val)\n{\n\tif (*arg > val) {\n\t\t*arg = val;\n\t\treturn -EINVAL;\n\t}\n\treturn 0;\n}\n\n \nint comedi_set_hw_dev(struct comedi_device *dev, struct device *hw_dev);\n\n \nstatic inline unsigned int comedi_buf_n_bytes_ready(struct comedi_subdevice *s)\n{\n\treturn s->async->buf_write_count - s->async->buf_read_count;\n}\n\nunsigned int comedi_buf_write_alloc(struct comedi_subdevice *s, unsigned int n);\nunsigned int comedi_buf_write_free(struct comedi_subdevice *s, unsigned int n);\n\nunsigned int comedi_buf_read_n_available(struct comedi_subdevice *s);\nunsigned int comedi_buf_read_alloc(struct comedi_subdevice *s, unsigned int n);\nunsigned int comedi_buf_read_free(struct comedi_subdevice *s, unsigned int n);\n\nunsigned int comedi_buf_write_samples(struct comedi_subdevice *s,\n\t\t\t\t      const void *data, unsigned int nsamples);\nunsigned int comedi_buf_read_samples(struct comedi_subdevice *s,\n\t\t\t\t     void *data, unsigned int nsamples);\n\n \n\n#define COMEDI_TIMEOUT_MS\t1000\n\nint comedi_timeout(struct comedi_device *dev, struct comedi_subdevice *s,\n\t\t   struct comedi_insn *insn,\n\t\t   int (*cb)(struct comedi_device *dev,\n\t\t\t     struct comedi_subdevice *s,\n\t\t\t     struct comedi_insn *insn, unsigned long context),\n\t\t   unsigned long context);\n\nunsigned int comedi_handle_events(struct comedi_device *dev,\n\t\t\t\t  struct comedi_subdevice *s);\n\nint comedi_dio_insn_config(struct comedi_device *dev,\n\t\t\t   struct comedi_subdevice *s,\n\t\t\t   struct comedi_insn *insn, unsigned int *data,\n\t\t\t   unsigned int mask);\nunsigned int comedi_dio_update_state(struct comedi_subdevice *s,\n\t\t\t\t     unsigned int *data);\nunsigned int comedi_bytes_per_scan_cmd(struct comedi_subdevice *s,\n\t\t\t\t       struct comedi_cmd *cmd);\nunsigned int comedi_bytes_per_scan(struct comedi_subdevice *s);\nunsigned int comedi_nscans_left(struct comedi_subdevice *s,\n\t\t\t\tunsigned int nscans);\nunsigned int comedi_nsamples_left(struct comedi_subdevice *s,\n\t\t\t\t  unsigned int nsamples);\nvoid comedi_inc_scan_progress(struct comedi_subdevice *s,\n\t\t\t      unsigned int num_bytes);\n\nvoid *comedi_alloc_devpriv(struct comedi_device *dev, size_t size);\nint comedi_alloc_subdevices(struct comedi_device *dev, int num_subdevices);\nint comedi_alloc_subdev_readback(struct comedi_subdevice *s);\n\nint comedi_readback_insn_read(struct comedi_device *dev,\n\t\t\t      struct comedi_subdevice *s,\n\t\t\t      struct comedi_insn *insn, unsigned int *data);\n\nint comedi_load_firmware(struct comedi_device *dev, struct device *hw_dev,\n\t\t\t const char *name,\n\t\t\t int (*cb)(struct comedi_device *dev,\n\t\t\t\t   const u8 *data, size_t size,\n\t\t\t\t   unsigned long context),\n\t\t\t unsigned long context);\n\nint __comedi_request_region(struct comedi_device *dev,\n\t\t\t    unsigned long start, unsigned long len);\nint comedi_request_region(struct comedi_device *dev,\n\t\t\t  unsigned long start, unsigned long len);\nvoid comedi_legacy_detach(struct comedi_device *dev);\n\nint comedi_auto_config(struct device *hardware_device,\n\t\t       struct comedi_driver *driver, unsigned long context);\nvoid comedi_auto_unconfig(struct device *hardware_device);\n\nint comedi_driver_register(struct comedi_driver *driver);\nvoid comedi_driver_unregister(struct comedi_driver *driver);\n\n \n#define module_comedi_driver(__comedi_driver) \\\n\tmodule_driver(__comedi_driver, comedi_driver_register, \\\n\t\t\tcomedi_driver_unregister)\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}