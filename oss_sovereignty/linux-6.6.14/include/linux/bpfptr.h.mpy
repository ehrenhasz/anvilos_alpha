{
  "module_name": "bpfptr.h",
  "hash_id": "6b87ab74d5eb7eebda91e81a21ddfd4aa5402b4ca401231ccdc0525af96a3355",
  "original_prompt": "Ingested from linux-6.6.14/include/linux/bpfptr.h",
  "human_readable_source": " \n \n#ifndef _LINUX_BPFPTR_H\n#define _LINUX_BPFPTR_H\n\n#include <linux/mm.h>\n#include <linux/sockptr.h>\n\ntypedef sockptr_t bpfptr_t;\n\nstatic inline bool bpfptr_is_kernel(bpfptr_t bpfptr)\n{\n\treturn bpfptr.is_kernel;\n}\n\nstatic inline bpfptr_t KERNEL_BPFPTR(void *p)\n{\n\treturn (bpfptr_t) { .kernel = p, .is_kernel = true };\n}\n\nstatic inline bpfptr_t USER_BPFPTR(void __user *p)\n{\n\treturn (bpfptr_t) { .user = p };\n}\n\nstatic inline bpfptr_t make_bpfptr(u64 addr, bool is_kernel)\n{\n\tif (is_kernel)\n\t\treturn KERNEL_BPFPTR((void*) (uintptr_t) addr);\n\telse\n\t\treturn USER_BPFPTR(u64_to_user_ptr(addr));\n}\n\nstatic inline bool bpfptr_is_null(bpfptr_t bpfptr)\n{\n\tif (bpfptr_is_kernel(bpfptr))\n\t\treturn !bpfptr.kernel;\n\treturn !bpfptr.user;\n}\n\nstatic inline void bpfptr_add(bpfptr_t *bpfptr, size_t val)\n{\n\tif (bpfptr_is_kernel(*bpfptr))\n\t\tbpfptr->kernel += val;\n\telse\n\t\tbpfptr->user += val;\n}\n\nstatic inline int copy_from_bpfptr_offset(void *dst, bpfptr_t src,\n\t\t\t\t\t  size_t offset, size_t size)\n{\n\tif (!bpfptr_is_kernel(src))\n\t\treturn copy_from_user(dst, src.user + offset, size);\n\treturn copy_from_kernel_nofault(dst, src.kernel + offset, size);\n}\n\nstatic inline int copy_from_bpfptr(void *dst, bpfptr_t src, size_t size)\n{\n\treturn copy_from_bpfptr_offset(dst, src, 0, size);\n}\n\nstatic inline int copy_to_bpfptr_offset(bpfptr_t dst, size_t offset,\n\t\t\t\t\tconst void *src, size_t size)\n{\n\treturn copy_to_sockptr_offset((sockptr_t) dst, offset, src, size);\n}\n\nstatic inline void *kvmemdup_bpfptr(bpfptr_t src, size_t len)\n{\n\tvoid *p = kvmalloc(len, GFP_USER | __GFP_NOWARN);\n\n\tif (!p)\n\t\treturn ERR_PTR(-ENOMEM);\n\tif (copy_from_bpfptr(p, src, len)) {\n\t\tkvfree(p);\n\t\treturn ERR_PTR(-EFAULT);\n\t}\n\treturn p;\n}\n\nstatic inline long strncpy_from_bpfptr(char *dst, bpfptr_t src, size_t count)\n{\n\tif (bpfptr_is_kernel(src))\n\t\treturn strncpy_from_kernel_nofault(dst, src.kernel, count);\n\treturn strncpy_from_user(dst, src.user, count);\n}\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}