{
  "module_name": "iova.h",
  "hash_id": "ef209cae38abf07058e52bae48f5094826f5796a256757d98d6fd0f5081890c7",
  "original_prompt": "Ingested from linux-6.6.14/include/linux/iova.h",
  "human_readable_source": " \n \n\n#ifndef _IOVA_H_\n#define _IOVA_H_\n\n#include <linux/types.h>\n#include <linux/kernel.h>\n#include <linux/rbtree.h>\n#include <linux/dma-mapping.h>\n\n \nstruct iova {\n\tstruct rb_node\tnode;\n\tunsigned long\tpfn_hi;  \n\tunsigned long\tpfn_lo;  \n};\n\n\nstruct iova_rcache;\n\n \nstruct iova_domain {\n\tspinlock_t\tiova_rbtree_lock;  \n\tstruct rb_root\trbroot;\t\t \n\tstruct rb_node\t*cached_node;\t \n\tstruct rb_node\t*cached32_node;  \n\tunsigned long\tgranule;\t \n\tunsigned long\tstart_pfn;\t \n\tunsigned long\tdma_32bit_pfn;\n\tunsigned long\tmax32_alloc_size;  \n\tstruct iova\tanchor;\t\t \n\n\tstruct iova_rcache\t*rcaches;\n\tstruct hlist_node\tcpuhp_dead;\n};\n\nstatic inline unsigned long iova_size(struct iova *iova)\n{\n\treturn iova->pfn_hi - iova->pfn_lo + 1;\n}\n\nstatic inline unsigned long iova_shift(struct iova_domain *iovad)\n{\n\treturn __ffs(iovad->granule);\n}\n\nstatic inline unsigned long iova_mask(struct iova_domain *iovad)\n{\n\treturn iovad->granule - 1;\n}\n\nstatic inline size_t iova_offset(struct iova_domain *iovad, dma_addr_t iova)\n{\n\treturn iova & iova_mask(iovad);\n}\n\nstatic inline size_t iova_align(struct iova_domain *iovad, size_t size)\n{\n\treturn ALIGN(size, iovad->granule);\n}\n\nstatic inline dma_addr_t iova_dma_addr(struct iova_domain *iovad, struct iova *iova)\n{\n\treturn (dma_addr_t)iova->pfn_lo << iova_shift(iovad);\n}\n\nstatic inline unsigned long iova_pfn(struct iova_domain *iovad, dma_addr_t iova)\n{\n\treturn iova >> iova_shift(iovad);\n}\n\n#if IS_REACHABLE(CONFIG_IOMMU_IOVA)\nint iova_cache_get(void);\nvoid iova_cache_put(void);\n\nunsigned long iova_rcache_range(void);\n\nvoid free_iova(struct iova_domain *iovad, unsigned long pfn);\nvoid __free_iova(struct iova_domain *iovad, struct iova *iova);\nstruct iova *alloc_iova(struct iova_domain *iovad, unsigned long size,\n\tunsigned long limit_pfn,\n\tbool size_aligned);\nvoid free_iova_fast(struct iova_domain *iovad, unsigned long pfn,\n\t\t    unsigned long size);\nunsigned long alloc_iova_fast(struct iova_domain *iovad, unsigned long size,\n\t\t\t      unsigned long limit_pfn, bool flush_rcache);\nstruct iova *reserve_iova(struct iova_domain *iovad, unsigned long pfn_lo,\n\tunsigned long pfn_hi);\nvoid init_iova_domain(struct iova_domain *iovad, unsigned long granule,\n\tunsigned long start_pfn);\nint iova_domain_init_rcaches(struct iova_domain *iovad);\nstruct iova *find_iova(struct iova_domain *iovad, unsigned long pfn);\nvoid put_iova_domain(struct iova_domain *iovad);\n#else\nstatic inline int iova_cache_get(void)\n{\n\treturn -ENOTSUPP;\n}\n\nstatic inline void iova_cache_put(void)\n{\n}\n\nstatic inline void free_iova(struct iova_domain *iovad, unsigned long pfn)\n{\n}\n\nstatic inline void __free_iova(struct iova_domain *iovad, struct iova *iova)\n{\n}\n\nstatic inline struct iova *alloc_iova(struct iova_domain *iovad,\n\t\t\t\t      unsigned long size,\n\t\t\t\t      unsigned long limit_pfn,\n\t\t\t\t      bool size_aligned)\n{\n\treturn NULL;\n}\n\nstatic inline void free_iova_fast(struct iova_domain *iovad,\n\t\t\t\t  unsigned long pfn,\n\t\t\t\t  unsigned long size)\n{\n}\n\nstatic inline unsigned long alloc_iova_fast(struct iova_domain *iovad,\n\t\t\t\t\t    unsigned long size,\n\t\t\t\t\t    unsigned long limit_pfn,\n\t\t\t\t\t    bool flush_rcache)\n{\n\treturn 0;\n}\n\nstatic inline struct iova *reserve_iova(struct iova_domain *iovad,\n\t\t\t\t\tunsigned long pfn_lo,\n\t\t\t\t\tunsigned long pfn_hi)\n{\n\treturn NULL;\n}\n\nstatic inline void init_iova_domain(struct iova_domain *iovad,\n\t\t\t\t    unsigned long granule,\n\t\t\t\t    unsigned long start_pfn)\n{\n}\n\nstatic inline struct iova *find_iova(struct iova_domain *iovad,\n\t\t\t\t     unsigned long pfn)\n{\n\treturn NULL;\n}\n\nstatic inline void put_iova_domain(struct iova_domain *iovad)\n{\n}\n\n#endif\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}