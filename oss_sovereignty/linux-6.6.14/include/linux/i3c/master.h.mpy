{
  "module_name": "master.h",
  "hash_id": "8e6c3c59feca95d6d6e91b35b8ccaaacb67356f2dbdb1ad8c2f184f4b4b85c8e",
  "original_prompt": "Ingested from linux-6.6.14/include/linux/i3c/master.h",
  "human_readable_source": " \n \n\n#ifndef I3C_MASTER_H\n#define I3C_MASTER_H\n\n#include <asm/bitsperlong.h>\n\n#include <linux/bitops.h>\n#include <linux/i2c.h>\n#include <linux/i3c/ccc.h>\n#include <linux/i3c/device.h>\n#include <linux/rwsem.h>\n#include <linux/spinlock.h>\n#include <linux/workqueue.h>\n\n#define I3C_HOT_JOIN_ADDR\t\t0x2\n#define I3C_BROADCAST_ADDR\t\t0x7e\n#define I3C_MAX_ADDR\t\t\tGENMASK(6, 0)\n\nstruct i2c_client;\n\nstruct i3c_master_controller;\nstruct i3c_bus;\nstruct i3c_device;\n\n \nstruct i3c_i2c_dev_desc {\n\tstruct list_head node;\n\tstruct i3c_master_controller *master;\n\tvoid *master_priv;\n};\n\n#define I3C_LVR_I2C_INDEX_MASK\t\tGENMASK(7, 5)\n#define I3C_LVR_I2C_INDEX(x)\t\t((x) << 5)\n#define I3C_LVR_I2C_FM_MODE\t\tBIT(4)\n\n#define I2C_MAX_ADDR\t\t\tGENMASK(6, 0)\n\n \nstruct i2c_dev_boardinfo {\n\tstruct list_head node;\n\tstruct i2c_board_info base;\n\tu8 lvr;\n};\n\n \nstruct i2c_dev_desc {\n\tstruct i3c_i2c_dev_desc common;\n\tstruct i2c_client *dev;\n\tu16 addr;\n\tu8 lvr;\n};\n\n \nstruct i3c_ibi_slot {\n\tstruct work_struct work;\n\tstruct i3c_dev_desc *dev;\n\tunsigned int len;\n\tvoid *data;\n};\n\n \nstruct i3c_device_ibi_info {\n\tstruct completion all_ibis_handled;\n\tatomic_t pending_ibis;\n\tunsigned int max_payload_len;\n\tunsigned int num_slots;\n\tunsigned int enabled;\n\tvoid (*handler)(struct i3c_device *dev,\n\t\t\tconst struct i3c_ibi_payload *payload);\n};\n\n \nstruct i3c_dev_boardinfo {\n\tstruct list_head node;\n\tu8 init_dyn_addr;\n\tu8 static_addr;\n\tu64 pid;\n\tstruct device_node *of_node;\n};\n\n \nstruct i3c_dev_desc {\n\tstruct i3c_i2c_dev_desc common;\n\tstruct i3c_device_info info;\n\tstruct mutex ibi_lock;\n\tstruct i3c_device_ibi_info *ibi;\n\tstruct i3c_device *dev;\n\tconst struct i3c_dev_boardinfo *boardinfo;\n};\n\n \nstruct i3c_device {\n\tstruct device dev;\n\tstruct i3c_dev_desc *desc;\n\tstruct i3c_bus *bus;\n};\n\n \n#define I3C_BUS_MAX_DEVS\t\t11\n\n#define I3C_BUS_MAX_I3C_SCL_RATE\t12900000\n#define I3C_BUS_TYP_I3C_SCL_RATE\t12500000\n#define I3C_BUS_I2C_FM_PLUS_SCL_RATE\t1000000\n#define I3C_BUS_I2C_FM_SCL_RATE\t\t400000\n#define I3C_BUS_TLOW_OD_MIN_NS\t\t200\n\n \nenum i3c_bus_mode {\n\tI3C_BUS_MODE_PURE,\n\tI3C_BUS_MODE_MIXED_FAST,\n\tI3C_BUS_MODE_MIXED_LIMITED,\n\tI3C_BUS_MODE_MIXED_SLOW,\n};\n\n \nenum i3c_addr_slot_status {\n\tI3C_ADDR_SLOT_FREE,\n\tI3C_ADDR_SLOT_RSVD,\n\tI3C_ADDR_SLOT_I2C_DEV,\n\tI3C_ADDR_SLOT_I3C_DEV,\n\tI3C_ADDR_SLOT_STATUS_MASK = 3,\n};\n\n \nstruct i3c_bus {\n\tstruct i3c_dev_desc *cur_master;\n\tint id;\n\tunsigned long addrslots[((I2C_MAX_ADDR + 1) * 2) / BITS_PER_LONG];\n\tenum i3c_bus_mode mode;\n\tstruct {\n\t\tunsigned long i3c;\n\t\tunsigned long i2c;\n\t} scl_rate;\n\tstruct {\n\t\tstruct list_head i3c;\n\t\tstruct list_head i2c;\n\t} devs;\n\tstruct rw_semaphore lock;\n};\n\n \nstruct i3c_master_controller_ops {\n\tint (*bus_init)(struct i3c_master_controller *master);\n\tvoid (*bus_cleanup)(struct i3c_master_controller *master);\n\tint (*attach_i3c_dev)(struct i3c_dev_desc *dev);\n\tint (*reattach_i3c_dev)(struct i3c_dev_desc *dev, u8 old_dyn_addr);\n\tvoid (*detach_i3c_dev)(struct i3c_dev_desc *dev);\n\tint (*do_daa)(struct i3c_master_controller *master);\n\tbool (*supports_ccc_cmd)(struct i3c_master_controller *master,\n\t\t\t\t const struct i3c_ccc_cmd *cmd);\n\tint (*send_ccc_cmd)(struct i3c_master_controller *master,\n\t\t\t    struct i3c_ccc_cmd *cmd);\n\tint (*priv_xfers)(struct i3c_dev_desc *dev,\n\t\t\t  struct i3c_priv_xfer *xfers,\n\t\t\t  int nxfers);\n\tint (*attach_i2c_dev)(struct i2c_dev_desc *dev);\n\tvoid (*detach_i2c_dev)(struct i2c_dev_desc *dev);\n\tint (*i2c_xfers)(struct i2c_dev_desc *dev,\n\t\t\t const struct i2c_msg *xfers, int nxfers);\n\tint (*request_ibi)(struct i3c_dev_desc *dev,\n\t\t\t   const struct i3c_ibi_setup *req);\n\tvoid (*free_ibi)(struct i3c_dev_desc *dev);\n\tint (*enable_ibi)(struct i3c_dev_desc *dev);\n\tint (*disable_ibi)(struct i3c_dev_desc *dev);\n\tvoid (*recycle_ibi_slot)(struct i3c_dev_desc *dev,\n\t\t\t\t struct i3c_ibi_slot *slot);\n};\n\n \nstruct i3c_master_controller {\n\tstruct device dev;\n\tstruct i3c_dev_desc *this;\n\tstruct i2c_adapter i2c;\n\tconst struct i3c_master_controller_ops *ops;\n\tunsigned int secondary : 1;\n\tunsigned int init_done : 1;\n\tstruct {\n\t\tstruct list_head i3c;\n\t\tstruct list_head i2c;\n\t} boardinfo;\n\tstruct i3c_bus bus;\n\tstruct workqueue_struct *wq;\n};\n\n \n#define i3c_bus_for_each_i2cdev(bus, dev)\t\t\t\t\\\n\tlist_for_each_entry(dev, &(bus)->devs.i2c, common.node)\n\n \n#define i3c_bus_for_each_i3cdev(bus, dev)\t\t\t\t\\\n\tlist_for_each_entry(dev, &(bus)->devs.i3c, common.node)\n\nint i3c_master_do_i2c_xfers(struct i3c_master_controller *master,\n\t\t\t    const struct i2c_msg *xfers,\n\t\t\t    int nxfers);\n\nint i3c_master_disec_locked(struct i3c_master_controller *master, u8 addr,\n\t\t\t    u8 evts);\nint i3c_master_enec_locked(struct i3c_master_controller *master, u8 addr,\n\t\t\t   u8 evts);\nint i3c_master_entdaa_locked(struct i3c_master_controller *master);\nint i3c_master_defslvs_locked(struct i3c_master_controller *master);\n\nint i3c_master_get_free_addr(struct i3c_master_controller *master,\n\t\t\t     u8 start_addr);\n\nint i3c_master_add_i3c_dev_locked(struct i3c_master_controller *master,\n\t\t\t\t  u8 addr);\nint i3c_master_do_daa(struct i3c_master_controller *master);\n\nint i3c_master_set_info(struct i3c_master_controller *master,\n\t\t\tconst struct i3c_device_info *info);\n\nint i3c_master_register(struct i3c_master_controller *master,\n\t\t\tstruct device *parent,\n\t\t\tconst struct i3c_master_controller_ops *ops,\n\t\t\tbool secondary);\nvoid i3c_master_unregister(struct i3c_master_controller *master);\n\n \nstatic inline void *i3c_dev_get_master_data(const struct i3c_dev_desc *dev)\n{\n\treturn dev->common.master_priv;\n}\n\n \nstatic inline void i3c_dev_set_master_data(struct i3c_dev_desc *dev,\n\t\t\t\t\t   void *data)\n{\n\tdev->common.master_priv = data;\n}\n\n \nstatic inline void *i2c_dev_get_master_data(const struct i2c_dev_desc *dev)\n{\n\treturn dev->common.master_priv;\n}\n\n \nstatic inline void i2c_dev_set_master_data(struct i2c_dev_desc *dev,\n\t\t\t\t\t   void *data)\n{\n\tdev->common.master_priv = data;\n}\n\n \nstatic inline struct i3c_master_controller *\ni3c_dev_get_master(struct i3c_dev_desc *dev)\n{\n\treturn dev->common.master;\n}\n\n \nstatic inline struct i3c_master_controller *\ni2c_dev_get_master(struct i2c_dev_desc *dev)\n{\n\treturn dev->common.master;\n}\n\n \nstatic inline struct i3c_bus *\ni3c_master_get_bus(struct i3c_master_controller *master)\n{\n\treturn &master->bus;\n}\n\nstruct i3c_generic_ibi_pool;\n\nstruct i3c_generic_ibi_pool *\ni3c_generic_ibi_alloc_pool(struct i3c_dev_desc *dev,\n\t\t\t   const struct i3c_ibi_setup *req);\nvoid i3c_generic_ibi_free_pool(struct i3c_generic_ibi_pool *pool);\n\nstruct i3c_ibi_slot *\ni3c_generic_ibi_get_free_slot(struct i3c_generic_ibi_pool *pool);\nvoid i3c_generic_ibi_recycle_slot(struct i3c_generic_ibi_pool *pool,\n\t\t\t\t  struct i3c_ibi_slot *slot);\n\nvoid i3c_master_queue_ibi(struct i3c_dev_desc *dev, struct i3c_ibi_slot *slot);\n\nstruct i3c_ibi_slot *i3c_master_get_free_ibi_slot(struct i3c_dev_desc *dev);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}