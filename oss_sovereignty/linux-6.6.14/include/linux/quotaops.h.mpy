{
  "module_name": "quotaops.h",
  "hash_id": "b0d2f621da4cfb3a46bbd04cdc9376ce80893ea666a89bda5eb98c38f5c6c15a",
  "original_prompt": "Ingested from linux-6.6.14/include/linux/quotaops.h",
  "human_readable_source": " \n \n#ifndef _LINUX_QUOTAOPS_\n#define _LINUX_QUOTAOPS_\n\n#include <linux/fs.h>\n\n#define DQUOT_SPACE_WARN\t0x1\n#define DQUOT_SPACE_RESERVE\t0x2\n#define DQUOT_SPACE_NOFAIL\t0x4\n\nstatic inline struct quota_info *sb_dqopt(struct super_block *sb)\n{\n\treturn &sb->s_dquot;\n}\n\n \nstatic inline bool is_quota_modification(struct mnt_idmap *idmap,\n\t\t\t\t\t struct inode *inode, struct iattr *ia)\n{\n\treturn ((ia->ia_valid & ATTR_SIZE) ||\n\t\ti_uid_needs_update(idmap, ia, inode) ||\n\t\ti_gid_needs_update(idmap, ia, inode));\n}\n\n#if defined(CONFIG_QUOTA)\n\n#define quota_error(sb, fmt, args...) \\\n\t__quota_error((sb), __func__, fmt , ## args)\n\nextern __printf(3, 4)\nvoid __quota_error(struct super_block *sb, const char *func,\n\t\t   const char *fmt, ...);\n\n \nint dquot_initialize(struct inode *inode);\nbool dquot_initialize_needed(struct inode *inode);\nvoid dquot_drop(struct inode *inode);\nstruct dquot *dqget(struct super_block *sb, struct kqid qid);\nstatic inline struct dquot *dqgrab(struct dquot *dquot)\n{\n\t \n\tWARN_ON_ONCE(!atomic_read(&dquot->dq_count));\n\tWARN_ON_ONCE(!test_bit(DQ_ACTIVE_B, &dquot->dq_flags));\n\tatomic_inc(&dquot->dq_count);\n\treturn dquot;\n}\n\nstatic inline bool dquot_is_busy(struct dquot *dquot)\n{\n\tif (test_bit(DQ_MOD_B, &dquot->dq_flags))\n\t\treturn true;\n\tif (atomic_read(&dquot->dq_count) > 0)\n\t\treturn true;\n\treturn false;\n}\n\nvoid dqput(struct dquot *dquot);\nint dquot_scan_active(struct super_block *sb,\n\t\t      int (*fn)(struct dquot *dquot, unsigned long priv),\n\t\t      unsigned long priv);\nstruct dquot *dquot_alloc(struct super_block *sb, int type);\nvoid dquot_destroy(struct dquot *dquot);\n\nint __dquot_alloc_space(struct inode *inode, qsize_t number, int flags);\nvoid __dquot_free_space(struct inode *inode, qsize_t number, int flags);\n\nint dquot_alloc_inode(struct inode *inode);\n\nint dquot_claim_space_nodirty(struct inode *inode, qsize_t number);\nvoid dquot_free_inode(struct inode *inode);\nvoid dquot_reclaim_space_nodirty(struct inode *inode, qsize_t number);\n\nint dquot_disable(struct super_block *sb, int type, unsigned int flags);\n \nstatic inline int dquot_suspend(struct super_block *sb, int type)\n{\n\treturn dquot_disable(sb, type, DQUOT_SUSPENDED);\n}\nint dquot_resume(struct super_block *sb, int type);\n\nint dquot_commit(struct dquot *dquot);\nint dquot_acquire(struct dquot *dquot);\nint dquot_release(struct dquot *dquot);\nint dquot_commit_info(struct super_block *sb, int type);\nint dquot_get_next_id(struct super_block *sb, struct kqid *qid);\nint dquot_mark_dquot_dirty(struct dquot *dquot);\n\nint dquot_file_open(struct inode *inode, struct file *file);\n\nint dquot_load_quota_sb(struct super_block *sb, int type, int format_id,\n\tunsigned int flags);\nint dquot_load_quota_inode(struct inode *inode, int type, int format_id,\n\tunsigned int flags);\nint dquot_quota_on(struct super_block *sb, int type, int format_id,\n\tconst struct path *path);\nint dquot_quota_on_mount(struct super_block *sb, char *qf_name,\n \tint format_id, int type);\nint dquot_quota_off(struct super_block *sb, int type);\nint dquot_writeback_dquots(struct super_block *sb, int type);\nint dquot_quota_sync(struct super_block *sb, int type);\nint dquot_get_state(struct super_block *sb, struct qc_state *state);\nint dquot_set_dqinfo(struct super_block *sb, int type, struct qc_info *ii);\nint dquot_get_dqblk(struct super_block *sb, struct kqid id,\n\t\tstruct qc_dqblk *di);\nint dquot_get_next_dqblk(struct super_block *sb, struct kqid *id,\n\t\tstruct qc_dqblk *di);\nint dquot_set_dqblk(struct super_block *sb, struct kqid id,\n\t\tstruct qc_dqblk *di);\n\nint __dquot_transfer(struct inode *inode, struct dquot **transfer_to);\nint dquot_transfer(struct mnt_idmap *idmap, struct inode *inode,\n\t\t   struct iattr *iattr);\n\nstatic inline struct mem_dqinfo *sb_dqinfo(struct super_block *sb, int type)\n{\n\treturn sb_dqopt(sb)->info + type;\n}\n\n \n\nstatic inline bool sb_has_quota_usage_enabled(struct super_block *sb, int type)\n{\n\treturn sb_dqopt(sb)->flags &\n\t\t\t\tdquot_state_flag(DQUOT_USAGE_ENABLED, type);\n}\n\nstatic inline bool sb_has_quota_limits_enabled(struct super_block *sb, int type)\n{\n\treturn sb_dqopt(sb)->flags &\n\t\t\t\tdquot_state_flag(DQUOT_LIMITS_ENABLED, type);\n}\n\nstatic inline bool sb_has_quota_suspended(struct super_block *sb, int type)\n{\n\treturn sb_dqopt(sb)->flags &\n\t\t\t\tdquot_state_flag(DQUOT_SUSPENDED, type);\n}\n\nstatic inline unsigned sb_any_quota_suspended(struct super_block *sb)\n{\n\treturn dquot_state_types(sb_dqopt(sb)->flags, DQUOT_SUSPENDED);\n}\n\n \nstatic inline bool sb_has_quota_loaded(struct super_block *sb, int type)\n{\n\t \n\treturn sb_has_quota_usage_enabled(sb, type);\n}\n\nstatic inline unsigned sb_any_quota_loaded(struct super_block *sb)\n{\n\treturn dquot_state_types(sb_dqopt(sb)->flags, DQUOT_USAGE_ENABLED);\n}\n\nstatic inline bool sb_has_quota_active(struct super_block *sb, int type)\n{\n\treturn sb_has_quota_loaded(sb, type) &&\n\t       !sb_has_quota_suspended(sb, type);\n}\n\n \nextern const struct dquot_operations dquot_operations;\nextern const struct quotactl_ops dquot_quotactl_sysfile_ops;\n\n#else\n\nstatic inline int sb_has_quota_usage_enabled(struct super_block *sb, int type)\n{\n\treturn 0;\n}\n\nstatic inline int sb_has_quota_limits_enabled(struct super_block *sb, int type)\n{\n\treturn 0;\n}\n\nstatic inline int sb_has_quota_suspended(struct super_block *sb, int type)\n{\n\treturn 0;\n}\n\nstatic inline int sb_any_quota_suspended(struct super_block *sb)\n{\n\treturn 0;\n}\n\n \nstatic inline int sb_has_quota_loaded(struct super_block *sb, int type)\n{\n\treturn 0;\n}\n\nstatic inline int sb_any_quota_loaded(struct super_block *sb)\n{\n\treturn 0;\n}\n\nstatic inline int sb_has_quota_active(struct super_block *sb, int type)\n{\n\treturn 0;\n}\n\nstatic inline int dquot_initialize(struct inode *inode)\n{\n\treturn 0;\n}\n\nstatic inline bool dquot_initialize_needed(struct inode *inode)\n{\n\treturn false;\n}\n\nstatic inline void dquot_drop(struct inode *inode)\n{\n}\n\nstatic inline int dquot_alloc_inode(struct inode *inode)\n{\n\treturn 0;\n}\n\nstatic inline void dquot_free_inode(struct inode *inode)\n{\n}\n\nstatic inline int dquot_transfer(struct mnt_idmap *idmap,\n\t\t\t\t struct inode *inode, struct iattr *iattr)\n{\n\treturn 0;\n}\n\nstatic inline int __dquot_alloc_space(struct inode *inode, qsize_t number,\n\t\tint flags)\n{\n\tif (!(flags & DQUOT_SPACE_RESERVE))\n\t\tinode_add_bytes(inode, number);\n\treturn 0;\n}\n\nstatic inline void __dquot_free_space(struct inode *inode, qsize_t number,\n\t\tint flags)\n{\n\tif (!(flags & DQUOT_SPACE_RESERVE))\n\t\tinode_sub_bytes(inode, number);\n}\n\nstatic inline int dquot_claim_space_nodirty(struct inode *inode, qsize_t number)\n{\n\tinode_add_bytes(inode, number);\n\treturn 0;\n}\n\nstatic inline int dquot_reclaim_space_nodirty(struct inode *inode,\n\t\t\t\t\t      qsize_t number)\n{\n\tinode_sub_bytes(inode, number);\n\treturn 0;\n}\n\nstatic inline int dquot_disable(struct super_block *sb, int type,\n\t\tunsigned int flags)\n{\n\treturn 0;\n}\n\nstatic inline int dquot_suspend(struct super_block *sb, int type)\n{\n\treturn 0;\n}\n\nstatic inline int dquot_resume(struct super_block *sb, int type)\n{\n\treturn 0;\n}\n\n#define dquot_file_open\t\tgeneric_file_open\n\nstatic inline int dquot_writeback_dquots(struct super_block *sb, int type)\n{\n\treturn 0;\n}\n\n#endif  \n\nstatic inline int dquot_alloc_space_nodirty(struct inode *inode, qsize_t nr)\n{\n\treturn __dquot_alloc_space(inode, nr, DQUOT_SPACE_WARN);\n}\n\nstatic inline void dquot_alloc_space_nofail(struct inode *inode, qsize_t nr)\n{\n\t__dquot_alloc_space(inode, nr, DQUOT_SPACE_WARN|DQUOT_SPACE_NOFAIL);\n\tmark_inode_dirty_sync(inode);\n}\n\nstatic inline int dquot_alloc_space(struct inode *inode, qsize_t nr)\n{\n\tint ret;\n\n\tret = dquot_alloc_space_nodirty(inode, nr);\n\tif (!ret) {\n\t\t \n\t\tmark_inode_dirty(inode);\n\t}\n\treturn ret;\n}\n\nstatic inline int dquot_alloc_block_nodirty(struct inode *inode, qsize_t nr)\n{\n\treturn dquot_alloc_space_nodirty(inode, nr << inode->i_blkbits);\n}\n\nstatic inline void dquot_alloc_block_nofail(struct inode *inode, qsize_t nr)\n{\n\tdquot_alloc_space_nofail(inode, nr << inode->i_blkbits);\n}\n\nstatic inline int dquot_alloc_block(struct inode *inode, qsize_t nr)\n{\n\treturn dquot_alloc_space(inode, nr << inode->i_blkbits);\n}\n\nstatic inline int dquot_prealloc_block_nodirty(struct inode *inode, qsize_t nr)\n{\n\treturn __dquot_alloc_space(inode, nr << inode->i_blkbits, 0);\n}\n\nstatic inline int dquot_prealloc_block(struct inode *inode, qsize_t nr)\n{\n\tint ret;\n\n\tret = dquot_prealloc_block_nodirty(inode, nr);\n\tif (!ret)\n\t\tmark_inode_dirty_sync(inode);\n\treturn ret;\n}\n\nstatic inline int dquot_reserve_block(struct inode *inode, qsize_t nr)\n{\n\treturn __dquot_alloc_space(inode, nr << inode->i_blkbits,\n\t\t\t\tDQUOT_SPACE_WARN|DQUOT_SPACE_RESERVE);\n}\n\nstatic inline int dquot_claim_block(struct inode *inode, qsize_t nr)\n{\n\tint ret;\n\n\tret = dquot_claim_space_nodirty(inode, nr << inode->i_blkbits);\n\tif (!ret)\n\t\tmark_inode_dirty_sync(inode);\n\treturn ret;\n}\n\nstatic inline void dquot_reclaim_block(struct inode *inode, qsize_t nr)\n{\n\tdquot_reclaim_space_nodirty(inode, nr << inode->i_blkbits);\n\tmark_inode_dirty_sync(inode);\n}\n\nstatic inline void dquot_free_space_nodirty(struct inode *inode, qsize_t nr)\n{\n\t__dquot_free_space(inode, nr, 0);\n}\n\nstatic inline void dquot_free_space(struct inode *inode, qsize_t nr)\n{\n\tdquot_free_space_nodirty(inode, nr);\n\tmark_inode_dirty_sync(inode);\n}\n\nstatic inline void dquot_free_block_nodirty(struct inode *inode, qsize_t nr)\n{\n\tdquot_free_space_nodirty(inode, nr << inode->i_blkbits);\n}\n\nstatic inline void dquot_free_block(struct inode *inode, qsize_t nr)\n{\n\tdquot_free_space(inode, nr << inode->i_blkbits);\n}\n\nstatic inline void dquot_release_reservation_block(struct inode *inode,\n\t\tqsize_t nr)\n{\n\t__dquot_free_space(inode, nr << inode->i_blkbits, DQUOT_SPACE_RESERVE);\n}\n\nunsigned int qtype_enforce_flag(int type);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}