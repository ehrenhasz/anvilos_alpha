{
  "module_name": "io_uring_types.h",
  "hash_id": "3622fe869894f8f9d70f11aba13fc803e52bd388e475ddd46c4f0a1274ec3c93",
  "original_prompt": "Ingested from linux-6.6.14/include/linux/io_uring_types.h",
  "human_readable_source": "#ifndef IO_URING_TYPES_H\n#define IO_URING_TYPES_H\n\n#include <linux/blkdev.h>\n#include <linux/task_work.h>\n#include <linux/bitmap.h>\n#include <linux/llist.h>\n#include <uapi/linux/io_uring.h>\n\nstruct io_wq_work_node {\n\tstruct io_wq_work_node *next;\n};\n\nstruct io_wq_work_list {\n\tstruct io_wq_work_node *first;\n\tstruct io_wq_work_node *last;\n};\n\nstruct io_wq_work {\n\tstruct io_wq_work_node list;\n\tunsigned flags;\n\t \n\tint cancel_seq;\n};\n\nstruct io_fixed_file {\n\t \n\tunsigned long file_ptr;\n};\n\nstruct io_file_table {\n\tstruct io_fixed_file *files;\n\tunsigned long *bitmap;\n\tunsigned int alloc_hint;\n};\n\nstruct io_hash_bucket {\n\tspinlock_t\t\tlock;\n\tstruct hlist_head\tlist;\n} ____cacheline_aligned_in_smp;\n\nstruct io_hash_table {\n\tstruct io_hash_bucket\t*hbs;\n\tunsigned\t\thash_bits;\n};\n\n \n#define IO_RINGFD_REG_MAX 16\n\nstruct io_uring_task {\n\t \n\tint\t\t\t\tcached_refs;\n\tconst struct io_ring_ctx \t*last;\n\tstruct io_wq\t\t\t*io_wq;\n\tstruct file\t\t\t*registered_rings[IO_RINGFD_REG_MAX];\n\n\tstruct xarray\t\t\txa;\n\tstruct wait_queue_head\t\twait;\n\tatomic_t\t\t\tin_cancel;\n\tatomic_t\t\t\tinflight_tracked;\n\tstruct percpu_counter\t\tinflight;\n\n\tstruct {  \n\t\tstruct llist_head\ttask_list;\n\t\tstruct callback_head\ttask_work;\n\t} ____cacheline_aligned_in_smp;\n};\n\nstruct io_uring {\n\tu32 head;\n\tu32 tail;\n};\n\n \nstruct io_rings {\n\t \n\tstruct io_uring\t\tsq, cq;\n\t \n\tu32\t\t\tsq_ring_mask, cq_ring_mask;\n\t \n\tu32\t\t\tsq_ring_entries, cq_ring_entries;\n\t \n\tu32\t\t\tsq_dropped;\n\t \n\tatomic_t\t\tsq_flags;\n\t \n\tu32\t\t\tcq_flags;\n\t \n\tu32\t\t\tcq_overflow;\n\t \n\tstruct io_uring_cqe\tcqes[] ____cacheline_aligned_in_smp;\n};\n\nstruct io_restriction {\n\tDECLARE_BITMAP(register_op, IORING_REGISTER_LAST);\n\tDECLARE_BITMAP(sqe_op, IORING_OP_LAST);\n\tu8 sqe_flags_allowed;\n\tu8 sqe_flags_required;\n\tbool registered;\n};\n\nstruct io_submit_link {\n\tstruct io_kiocb\t\t*head;\n\tstruct io_kiocb\t\t*last;\n};\n\nstruct io_submit_state {\n\t \n\tstruct io_wq_work_node\tfree_list;\n\t \n\tstruct io_wq_work_list\tcompl_reqs;\n\tstruct io_submit_link\tlink;\n\n\tbool\t\t\tplug_started;\n\tbool\t\t\tneed_plug;\n\tunsigned short\t\tsubmit_nr;\n\tunsigned int\t\tcqes_count;\n\tstruct blk_plug\t\tplug;\n};\n\nstruct io_ev_fd {\n\tstruct eventfd_ctx\t*cq_ev_fd;\n\tunsigned int\t\teventfd_async: 1;\n\tstruct rcu_head\t\trcu;\n\tatomic_t\t\trefs;\n\tatomic_t\t\tops;\n};\n\nstruct io_alloc_cache {\n\tstruct io_wq_work_node\tlist;\n\tunsigned int\t\tnr_cached;\n\tunsigned int\t\tmax_cached;\n\tsize_t\t\t\telem_size;\n};\n\nstruct io_ring_ctx {\n\t \n\tstruct {\n\t\tunsigned int\t\tflags;\n\t\tunsigned int\t\tdrain_next: 1;\n\t\tunsigned int\t\trestricted: 1;\n\t\tunsigned int\t\toff_timeout_used: 1;\n\t\tunsigned int\t\tdrain_active: 1;\n\t\tunsigned int\t\thas_evfd: 1;\n\t\t \n\t\tunsigned int\t\ttask_complete: 1;\n\t\tunsigned int\t\tlockless_cq: 1;\n\t\tunsigned int\t\tsyscall_iopoll: 1;\n\t\tunsigned int\t\tpoll_activated: 1;\n\t\tunsigned int\t\tdrain_disabled: 1;\n\t\tunsigned int\t\tcompat: 1;\n\n\t\tstruct task_struct\t*submitter_task;\n\t\tstruct io_rings\t\t*rings;\n\t\tstruct percpu_ref\trefs;\n\n\t\tenum task_work_notify_mode\tnotify_method;\n\t} ____cacheline_aligned_in_smp;\n\n\t \n\tstruct {\n\t\tstruct mutex\t\turing_lock;\n\n\t\t \n\t\tu32\t\t\t*sq_array;\n\t\tstruct io_uring_sqe\t*sq_sqes;\n\t\tunsigned\t\tcached_sq_head;\n\t\tunsigned\t\tsq_entries;\n\n\t\t \n\t\tstruct io_rsrc_node\t*rsrc_node;\n\t\tatomic_t\t\tcancel_seq;\n\t\tstruct io_file_table\tfile_table;\n\t\tunsigned\t\tnr_user_files;\n\t\tunsigned\t\tnr_user_bufs;\n\t\tstruct io_mapped_ubuf\t**user_bufs;\n\n\t\tstruct io_submit_state\tsubmit_state;\n\n\t\tstruct io_buffer_list\t*io_bl;\n\t\tstruct xarray\t\tio_bl_xa;\n\n\t\tstruct io_hash_table\tcancel_table_locked;\n\t\tstruct io_alloc_cache\tapoll_cache;\n\t\tstruct io_alloc_cache\tnetmsg_cache;\n\n\t\t \n\t\tstruct io_wq_work_list\tiopoll_list;\n\t\tbool\t\t\tpoll_multi_queue;\n\t} ____cacheline_aligned_in_smp;\n\n\tstruct {\n\t\t \n\t\tstruct io_uring_cqe\t*cqe_cached;\n\t\tstruct io_uring_cqe\t*cqe_sentinel;\n\n\t\tunsigned\t\tcached_cq_tail;\n\t\tunsigned\t\tcq_entries;\n\t\tstruct io_ev_fd\t__rcu\t*io_ev_fd;\n\t\tunsigned\t\tcq_extra;\n\t} ____cacheline_aligned_in_smp;\n\n\t \n\tstruct {\n\t\tstruct llist_head\twork_llist;\n\t\tunsigned long\t\tcheck_cq;\n\t\tatomic_t\t\tcq_wait_nr;\n\t\tatomic_t\t\tcq_timeouts;\n\t\tstruct wait_queue_head\tcq_wait;\n\t} ____cacheline_aligned_in_smp;\n\n\t \n\tstruct {\n\t\tspinlock_t\t\ttimeout_lock;\n\t\tstruct list_head\ttimeout_list;\n\t\tstruct list_head\tltimeout_list;\n\t\tunsigned\t\tcq_last_tm_flush;\n\t} ____cacheline_aligned_in_smp;\n\n\tstruct io_uring_cqe\tcompletion_cqes[16];\n\n\tspinlock_t\t\tcompletion_lock;\n\n\t \n\tstruct io_wq_work_list\tlocked_free_list;\n\tunsigned int\t\tlocked_free_nr;\n\n\tstruct list_head\tio_buffers_comp;\n\tstruct list_head\tcq_overflow_list;\n\tstruct io_hash_table\tcancel_table;\n\n\tconst struct cred\t*sq_creds;\t \n\tstruct io_sq_data\t*sq_data;\t \n\n\tstruct wait_queue_head\tsqo_sq_wait;\n\tstruct list_head\tsqd_list;\n\n\tunsigned int\t\tfile_alloc_start;\n\tunsigned int\t\tfile_alloc_end;\n\n\tstruct xarray\t\tpersonalities;\n\tu32\t\t\tpers_next;\n\n\tstruct list_head\tio_buffers_cache;\n\n\t \n\tstruct hlist_head\tio_buf_list;\n\n\t \n\tstruct wait_queue_head\t\tpoll_wq;\n\tstruct io_restriction\t\trestrictions;\n\n\t \n\tstruct io_mapped_ubuf\t\t*dummy_ubuf;\n\tstruct io_rsrc_data\t\t*file_data;\n\tstruct io_rsrc_data\t\t*buf_data;\n\n\t \n\tstruct list_head\t\trsrc_ref_list;\n\tstruct io_alloc_cache\t\trsrc_node_cache;\n\tstruct wait_queue_head\t\trsrc_quiesce_wq;\n\tunsigned\t\t\trsrc_quiesce;\n\n\tstruct list_head\t\tio_buffers_pages;\n\n\t#if defined(CONFIG_UNIX)\n\t\tstruct socket\t\t*ring_sock;\n\t#endif\n\t \n\tstruct io_wq_hash\t\t*hash_map;\n\n\t \n\tstruct user_struct\t\t*user;\n\tstruct mm_struct\t\t*mm_account;\n\n\t \n\tstruct llist_head\t\tfallback_llist;\n\tstruct delayed_work\t\tfallback_work;\n\tstruct work_struct\t\texit_work;\n\tstruct list_head\t\ttctx_list;\n\tstruct completion\t\tref_comp;\n\n\t \n\tu32\t\t\t\tiowq_limits[2];\n\tbool\t\t\t\tiowq_limits_set;\n\n\tstruct callback_head\t\tpoll_wq_task_work;\n\tstruct list_head\t\tdefer_list;\n\tunsigned\t\t\tsq_thread_idle;\n\t \n\tunsigned\t\t\tevfd_last_cq_tail;\n\n\t \n\tunsigned short\t\t\tn_ring_pages;\n\tunsigned short\t\t\tn_sqe_pages;\n\tstruct page\t\t\t**ring_pages;\n\tstruct page\t\t\t**sqe_pages;\n};\n\nstruct io_tw_state {\n\t \n\tbool locked;\n};\n\nenum {\n\tREQ_F_FIXED_FILE_BIT\t= IOSQE_FIXED_FILE_BIT,\n\tREQ_F_IO_DRAIN_BIT\t= IOSQE_IO_DRAIN_BIT,\n\tREQ_F_LINK_BIT\t\t= IOSQE_IO_LINK_BIT,\n\tREQ_F_HARDLINK_BIT\t= IOSQE_IO_HARDLINK_BIT,\n\tREQ_F_FORCE_ASYNC_BIT\t= IOSQE_ASYNC_BIT,\n\tREQ_F_BUFFER_SELECT_BIT\t= IOSQE_BUFFER_SELECT_BIT,\n\tREQ_F_CQE_SKIP_BIT\t= IOSQE_CQE_SKIP_SUCCESS_BIT,\n\n\t \n\tREQ_F_FAIL_BIT\t\t= 8,\n\tREQ_F_INFLIGHT_BIT,\n\tREQ_F_CUR_POS_BIT,\n\tREQ_F_NOWAIT_BIT,\n\tREQ_F_LINK_TIMEOUT_BIT,\n\tREQ_F_NEED_CLEANUP_BIT,\n\tREQ_F_POLLED_BIT,\n\tREQ_F_BUFFER_SELECTED_BIT,\n\tREQ_F_BUFFER_RING_BIT,\n\tREQ_F_REISSUE_BIT,\n\tREQ_F_CREDS_BIT,\n\tREQ_F_REFCOUNT_BIT,\n\tREQ_F_ARM_LTIMEOUT_BIT,\n\tREQ_F_ASYNC_DATA_BIT,\n\tREQ_F_SKIP_LINK_CQES_BIT,\n\tREQ_F_SINGLE_POLL_BIT,\n\tREQ_F_DOUBLE_POLL_BIT,\n\tREQ_F_PARTIAL_IO_BIT,\n\tREQ_F_APOLL_MULTISHOT_BIT,\n\tREQ_F_CLEAR_POLLIN_BIT,\n\tREQ_F_HASH_LOCKED_BIT,\n\t \n\tREQ_F_SUPPORT_NOWAIT_BIT,\n\tREQ_F_ISREG_BIT,\n\n\t \n\t__REQ_F_LAST_BIT,\n};\n\nenum {\n\t \n\tREQ_F_FIXED_FILE\t= BIT(REQ_F_FIXED_FILE_BIT),\n\t \n\tREQ_F_IO_DRAIN\t\t= BIT(REQ_F_IO_DRAIN_BIT),\n\t \n\tREQ_F_LINK\t\t= BIT(REQ_F_LINK_BIT),\n\t \n\tREQ_F_HARDLINK\t\t= BIT(REQ_F_HARDLINK_BIT),\n\t \n\tREQ_F_FORCE_ASYNC\t= BIT(REQ_F_FORCE_ASYNC_BIT),\n\t \n\tREQ_F_BUFFER_SELECT\t= BIT(REQ_F_BUFFER_SELECT_BIT),\n\t \n\tREQ_F_CQE_SKIP\t\t= BIT(REQ_F_CQE_SKIP_BIT),\n\n\t \n\tREQ_F_FAIL\t\t= BIT(REQ_F_FAIL_BIT),\n\t \n\tREQ_F_INFLIGHT\t\t= BIT(REQ_F_INFLIGHT_BIT),\n\t \n\tREQ_F_CUR_POS\t\t= BIT(REQ_F_CUR_POS_BIT),\n\t \n\tREQ_F_NOWAIT\t\t= BIT(REQ_F_NOWAIT_BIT),\n\t \n\tREQ_F_LINK_TIMEOUT\t= BIT(REQ_F_LINK_TIMEOUT_BIT),\n\t \n\tREQ_F_NEED_CLEANUP\t= BIT(REQ_F_NEED_CLEANUP_BIT),\n\t \n\tREQ_F_POLLED\t\t= BIT(REQ_F_POLLED_BIT),\n\t \n\tREQ_F_BUFFER_SELECTED\t= BIT(REQ_F_BUFFER_SELECTED_BIT),\n\t \n\tREQ_F_BUFFER_RING\t= BIT(REQ_F_BUFFER_RING_BIT),\n\t \n\tREQ_F_REISSUE\t\t= BIT(REQ_F_REISSUE_BIT),\n\t \n\tREQ_F_SUPPORT_NOWAIT\t= BIT(REQ_F_SUPPORT_NOWAIT_BIT),\n\t \n\tREQ_F_ISREG\t\t= BIT(REQ_F_ISREG_BIT),\n\t \n\tREQ_F_CREDS\t\t= BIT(REQ_F_CREDS_BIT),\n\t \n\tREQ_F_REFCOUNT\t\t= BIT(REQ_F_REFCOUNT_BIT),\n\t \n\tREQ_F_ARM_LTIMEOUT\t= BIT(REQ_F_ARM_LTIMEOUT_BIT),\n\t \n\tREQ_F_ASYNC_DATA\t= BIT(REQ_F_ASYNC_DATA_BIT),\n\t \n\tREQ_F_SKIP_LINK_CQES\t= BIT(REQ_F_SKIP_LINK_CQES_BIT),\n\t \n\tREQ_F_SINGLE_POLL\t= BIT(REQ_F_SINGLE_POLL_BIT),\n\t \n\tREQ_F_DOUBLE_POLL\t= BIT(REQ_F_DOUBLE_POLL_BIT),\n\t \n\tREQ_F_PARTIAL_IO\t= BIT(REQ_F_PARTIAL_IO_BIT),\n\t \n\tREQ_F_APOLL_MULTISHOT\t= BIT(REQ_F_APOLL_MULTISHOT_BIT),\n\t \n\tREQ_F_CLEAR_POLLIN\t= BIT(REQ_F_CLEAR_POLLIN_BIT),\n\t \n\tREQ_F_HASH_LOCKED\t= BIT(REQ_F_HASH_LOCKED_BIT),\n};\n\ntypedef void (*io_req_tw_func_t)(struct io_kiocb *req, struct io_tw_state *ts);\n\nstruct io_task_work {\n\tstruct llist_node\t\tnode;\n\tio_req_tw_func_t\t\tfunc;\n};\n\nstruct io_cqe {\n\t__u64\tuser_data;\n\t__s32\tres;\n\t \n\tunion {\n\t\t__u32\tflags;\n\t\tint\tfd;\n\t};\n};\n\n \nstruct io_cmd_data {\n\tstruct file\t\t*file;\n\t \n\t__u8\t\t\tdata[56];\n};\n\nstatic inline void io_kiocb_cmd_sz_check(size_t cmd_sz)\n{\n\tBUILD_BUG_ON(cmd_sz > sizeof(struct io_cmd_data));\n}\n#define io_kiocb_to_cmd(req, cmd_type) ( \\\n\tio_kiocb_cmd_sz_check(sizeof(cmd_type)) , \\\n\t((cmd_type *)&(req)->cmd) \\\n)\n#define cmd_to_io_kiocb(ptr)\t((struct io_kiocb *) ptr)\n\nstruct io_kiocb {\n\tunion {\n\t\t \n\t\tstruct file\t\t*file;\n\t\tstruct io_cmd_data\tcmd;\n\t};\n\n\tu8\t\t\t\topcode;\n\t \n\tu8\t\t\t\tiopoll_completed;\n\t \n\tu16\t\t\t\tbuf_index;\n\tunsigned int\t\t\tflags;\n\n\tstruct io_cqe\t\t\tcqe;\n\n\tstruct io_ring_ctx\t\t*ctx;\n\tstruct task_struct\t\t*task;\n\n\tstruct io_rsrc_node\t\t*rsrc_node;\n\n\tunion {\n\t\t \n\t\tstruct io_mapped_ubuf\t*imu;\n\n\t\t \n\t\tstruct io_buffer\t*kbuf;\n\n\t\t \n\t\tstruct io_buffer_list\t*buf_list;\n\t};\n\n\tunion {\n\t\t \n\t\tstruct io_wq_work_node\tcomp_list;\n\t\t \n\t\t__poll_t apoll_events;\n\t};\n\tatomic_t\t\t\trefs;\n\tatomic_t\t\t\tpoll_refs;\n\tstruct io_task_work\t\tio_task_work;\n\tunsigned\t\t\tnr_tw;\n\t \n\tstruct hlist_node\t\thash_node;\n\t \n\tstruct async_poll\t\t*apoll;\n\t \n\tvoid\t\t\t\t*async_data;\n\t \n\tstruct io_kiocb\t\t\t*link;\n\t \n\tconst struct cred\t\t*creds;\n\tstruct io_wq_work\t\twork;\n\n\tstruct {\n\t\tu64\t\t\textra1;\n\t\tu64\t\t\textra2;\n\t} big_cqe;\n};\n\nstruct io_overflow_cqe {\n\tstruct list_head list;\n\tstruct io_uring_cqe cqe;\n};\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}