{
  "module_name": "hid_bpf.h",
  "hash_id": "dc041407f0bd87aa3a9c3cd461e33fb1fcbb88d87a7653673f8184c1b597befb",
  "original_prompt": "Ingested from linux-6.6.14/include/linux/hid_bpf.h",
  "human_readable_source": " \n\n#ifndef __HID_BPF_H\n#define __HID_BPF_H\n\n#include <linux/bpf.h>\n#include <linux/spinlock.h>\n#include <uapi/linux/hid.h>\n\nstruct hid_device;\n\n \n\n \nstruct hid_bpf_ctx {\n\t__u32 index;\n\tconst struct hid_device *hid;\n\t__u32 allocated_size;\n\tenum hid_report_type report_type;\n\tunion {\n\t\t__s32 retval;\n\t\t__s32 size;\n\t};\n};\n\n \nenum hid_bpf_attach_flags {\n\tHID_BPF_FLAG_NONE = 0,\n\tHID_BPF_FLAG_INSERT_HEAD = _BITUL(0),\n\tHID_BPF_FLAG_MAX,\n};\n\n \nint hid_bpf_device_event(struct hid_bpf_ctx *ctx);\nint hid_bpf_rdesc_fixup(struct hid_bpf_ctx *ctx);\n\n \n \n__u8 *hid_bpf_get_data(struct hid_bpf_ctx *ctx, unsigned int offset, const size_t __sz);\n\n \nint hid_bpf_attach_prog(unsigned int hid_id, int prog_fd, __u32 flags);\nint hid_bpf_hw_request(struct hid_bpf_ctx *ctx, __u8 *buf, size_t buf__sz,\n\t\t       enum hid_report_type rtype, enum hid_class_request reqtype);\nstruct hid_bpf_ctx *hid_bpf_allocate_context(unsigned int hid_id);\nvoid hid_bpf_release_context(struct hid_bpf_ctx *ctx);\n\n \n\n \nint __hid_bpf_tail_call(struct hid_bpf_ctx *ctx);\n\n#define HID_BPF_MAX_PROGS_PER_DEV 64\n#define HID_BPF_FLAG_MASK (((HID_BPF_FLAG_MAX - 1) << 1) - 1)\n\n \nenum hid_bpf_prog_type {\n\tHID_BPF_PROG_TYPE_UNDEF = -1,\n\tHID_BPF_PROG_TYPE_DEVICE_EVENT,\t\t\t \n\tHID_BPF_PROG_TYPE_RDESC_FIXUP,\n\tHID_BPF_PROG_TYPE_MAX,\n};\n\nstruct hid_report_enum;\n\nstruct hid_bpf_ops {\n\tstruct hid_report *(*hid_get_report)(struct hid_report_enum *report_enum, const u8 *data);\n\tint (*hid_hw_raw_request)(struct hid_device *hdev,\n\t\t\t\t  unsigned char reportnum, __u8 *buf,\n\t\t\t\t  size_t len, enum hid_report_type rtype,\n\t\t\t\t  enum hid_class_request reqtype);\n\tstruct module *owner;\n\tstruct bus_type *bus_type;\n};\n\nextern struct hid_bpf_ops *hid_bpf_ops;\n\nstruct hid_bpf_prog_list {\n\tu16 prog_idx[HID_BPF_MAX_PROGS_PER_DEV];\n\tu8 prog_cnt;\n};\n\n \nstruct hid_bpf {\n\tu8 *device_data;\t\t \n\tu32 allocated_data;\n\n\tstruct hid_bpf_prog_list __rcu *progs[HID_BPF_PROG_TYPE_MAX];\t \n\tbool destroyed;\t\t\t \n\n\tspinlock_t progs_lock;\t\t \n};\n\n \nstruct hid_bpf_link {\n\tstruct bpf_link link;\n\tint hid_table_index;\n};\n\n#ifdef CONFIG_HID_BPF\nu8 *dispatch_hid_bpf_device_event(struct hid_device *hid, enum hid_report_type type, u8 *data,\n\t\t\t\t  u32 *size, int interrupt);\nint hid_bpf_connect_device(struct hid_device *hdev);\nvoid hid_bpf_disconnect_device(struct hid_device *hdev);\nvoid hid_bpf_destroy_device(struct hid_device *hid);\nvoid hid_bpf_device_init(struct hid_device *hid);\nu8 *call_hid_bpf_rdesc_fixup(struct hid_device *hdev, u8 *rdesc, unsigned int *size);\n#else  \nstatic inline u8 *dispatch_hid_bpf_device_event(struct hid_device *hid, enum hid_report_type type,\n\t\t\t\t\t\tu8 *data, u32 *size, int interrupt) { return data; }\nstatic inline int hid_bpf_connect_device(struct hid_device *hdev) { return 0; }\nstatic inline void hid_bpf_disconnect_device(struct hid_device *hdev) {}\nstatic inline void hid_bpf_destroy_device(struct hid_device *hid) {}\nstatic inline void hid_bpf_device_init(struct hid_device *hid) {}\nstatic inline u8 *call_hid_bpf_rdesc_fixup(struct hid_device *hdev, u8 *rdesc, unsigned int *size)\n{\n\treturn kmemdup(rdesc, *size, GFP_KERNEL);\n}\n\n#endif  \n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}