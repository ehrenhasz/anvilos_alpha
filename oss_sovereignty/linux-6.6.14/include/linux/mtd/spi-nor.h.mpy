{
  "module_name": "spi-nor.h",
  "hash_id": "28f0546d43e9ced276bb16b8bd865f3beac2a1d9f5cce5583641fa1712485db1",
  "original_prompt": "Ingested from linux-6.6.14/include/linux/mtd/spi-nor.h",
  "human_readable_source": " \n \n\n#ifndef __LINUX_MTD_SPI_NOR_H\n#define __LINUX_MTD_SPI_NOR_H\n\n#include <linux/bitops.h>\n#include <linux/mtd/mtd.h>\n#include <linux/spi/spi-mem.h>\n\n \n\n \n#define SPINOR_OP_WRDI\t\t0x04\t \n#define SPINOR_OP_WREN\t\t0x06\t \n#define SPINOR_OP_RDSR\t\t0x05\t \n#define SPINOR_OP_WRSR\t\t0x01\t \n#define SPINOR_OP_RDSR2\t\t0x3f\t \n#define SPINOR_OP_WRSR2\t\t0x3e\t \n#define SPINOR_OP_READ\t\t0x03\t \n#define SPINOR_OP_READ_FAST\t0x0b\t \n#define SPINOR_OP_READ_1_1_2\t0x3b\t \n#define SPINOR_OP_READ_1_2_2\t0xbb\t \n#define SPINOR_OP_READ_1_1_4\t0x6b\t \n#define SPINOR_OP_READ_1_4_4\t0xeb\t \n#define SPINOR_OP_READ_1_1_8\t0x8b\t \n#define SPINOR_OP_READ_1_8_8\t0xcb\t \n#define SPINOR_OP_PP\t\t0x02\t \n#define SPINOR_OP_PP_1_1_4\t0x32\t \n#define SPINOR_OP_PP_1_4_4\t0x38\t \n#define SPINOR_OP_PP_1_1_8\t0x82\t \n#define SPINOR_OP_PP_1_8_8\t0xc2\t \n#define SPINOR_OP_BE_4K\t\t0x20\t \n#define SPINOR_OP_BE_4K_PMC\t0xd7\t \n#define SPINOR_OP_BE_32K\t0x52\t \n#define SPINOR_OP_CHIP_ERASE\t0xc7\t \n#define SPINOR_OP_SE\t\t0xd8\t \n#define SPINOR_OP_RDID\t\t0x9f\t \n#define SPINOR_OP_RDSFDP\t0x5a\t \n#define SPINOR_OP_RDCR\t\t0x35\t \n#define SPINOR_OP_SRSTEN\t0x66\t \n#define SPINOR_OP_SRST\t\t0x99\t \n#define SPINOR_OP_GBULK\t\t0x98     \n\n \n#define SPINOR_OP_READ_4B\t0x13\t \n#define SPINOR_OP_READ_FAST_4B\t0x0c\t \n#define SPINOR_OP_READ_1_1_2_4B\t0x3c\t \n#define SPINOR_OP_READ_1_2_2_4B\t0xbc\t \n#define SPINOR_OP_READ_1_1_4_4B\t0x6c\t \n#define SPINOR_OP_READ_1_4_4_4B\t0xec\t \n#define SPINOR_OP_READ_1_1_8_4B\t0x7c\t \n#define SPINOR_OP_READ_1_8_8_4B\t0xcc\t \n#define SPINOR_OP_PP_4B\t\t0x12\t \n#define SPINOR_OP_PP_1_1_4_4B\t0x34\t \n#define SPINOR_OP_PP_1_4_4_4B\t0x3e\t \n#define SPINOR_OP_PP_1_1_8_4B\t0x84\t \n#define SPINOR_OP_PP_1_8_8_4B\t0x8e\t \n#define SPINOR_OP_BE_4K_4B\t0x21\t \n#define SPINOR_OP_BE_32K_4B\t0x5c\t \n#define SPINOR_OP_SE_4B\t\t0xdc\t \n\n \n#define SPINOR_OP_READ_1_1_1_DTR\t0x0d\n#define SPINOR_OP_READ_1_2_2_DTR\t0xbd\n#define SPINOR_OP_READ_1_4_4_DTR\t0xed\n\n#define SPINOR_OP_READ_1_1_1_DTR_4B\t0x0e\n#define SPINOR_OP_READ_1_2_2_DTR_4B\t0xbe\n#define SPINOR_OP_READ_1_4_4_DTR_4B\t0xee\n\n \n#define SPINOR_OP_BP\t\t0x02\t \n#define SPINOR_OP_AAI_WP\t0xad\t \n\n \n#define SPINOR_OP_EN4B\t\t0xb7\t \n#define SPINOR_OP_EX4B\t\t0xe9\t \n\n \n#define SPINOR_OP_BRWR\t\t0x17\t \n\n \n#define SPINOR_OP_RD_EVCR      0x65     \n#define SPINOR_OP_WD_EVCR      0x61     \n\n \n#define SPINOR_OP_ESECR\t\t0x44\t \n#define SPINOR_OP_PSECR\t\t0x42\t \n#define SPINOR_OP_RSECR\t\t0x48\t \n\n \n#define SR_WIP\t\t\tBIT(0)\t \n#define SR_WEL\t\t\tBIT(1)\t \n \n#define SR_BP0\t\t\tBIT(2)\t \n#define SR_BP1\t\t\tBIT(3)\t \n#define SR_BP2\t\t\tBIT(4)\t \n#define SR_BP3\t\t\tBIT(5)\t \n#define SR_TB_BIT5\t\tBIT(5)\t \n#define SR_BP3_BIT6\t\tBIT(6)\t \n#define SR_TB_BIT6\t\tBIT(6)\t \n#define SR_SRWD\t\t\tBIT(7)\t \n \n#define SR_E_ERR\t\tBIT(5)\n#define SR_P_ERR\t\tBIT(6)\n\n#define SR1_QUAD_EN_BIT6\tBIT(6)\n\n#define SR_BP_SHIFT\t\t2\n\n \n#define EVCR_QUAD_EN_MICRON\tBIT(7)\t \n\n \n#define SR2_QUAD_EN_BIT1\tBIT(1)\n#define SR2_LB1\t\t\tBIT(3)\t \n#define SR2_LB2\t\t\tBIT(4)\t \n#define SR2_LB3\t\t\tBIT(5)\t \n#define SR2_QUAD_EN_BIT7\tBIT(7)\n\n \n#define SNOR_PROTO_INST_MASK\tGENMASK(23, 16)\n#define SNOR_PROTO_INST_SHIFT\t16\n#define SNOR_PROTO_INST(_nbits)\t\\\n\t((((unsigned long)(_nbits)) << SNOR_PROTO_INST_SHIFT) & \\\n\t SNOR_PROTO_INST_MASK)\n\n#define SNOR_PROTO_ADDR_MASK\tGENMASK(15, 8)\n#define SNOR_PROTO_ADDR_SHIFT\t8\n#define SNOR_PROTO_ADDR(_nbits)\t\\\n\t((((unsigned long)(_nbits)) << SNOR_PROTO_ADDR_SHIFT) & \\\n\t SNOR_PROTO_ADDR_MASK)\n\n#define SNOR_PROTO_DATA_MASK\tGENMASK(7, 0)\n#define SNOR_PROTO_DATA_SHIFT\t0\n#define SNOR_PROTO_DATA(_nbits)\t\\\n\t((((unsigned long)(_nbits)) << SNOR_PROTO_DATA_SHIFT) & \\\n\t SNOR_PROTO_DATA_MASK)\n\n#define SNOR_PROTO_IS_DTR\tBIT(24)\t \n\n#define SNOR_PROTO_STR(_inst_nbits, _addr_nbits, _data_nbits)\t\\\n\t(SNOR_PROTO_INST(_inst_nbits) |\t\t\t\t\\\n\t SNOR_PROTO_ADDR(_addr_nbits) |\t\t\t\t\\\n\t SNOR_PROTO_DATA(_data_nbits))\n#define SNOR_PROTO_DTR(_inst_nbits, _addr_nbits, _data_nbits)\t\\\n\t(SNOR_PROTO_IS_DTR |\t\t\t\t\t\\\n\t SNOR_PROTO_STR(_inst_nbits, _addr_nbits, _data_nbits))\n\nenum spi_nor_protocol {\n\tSNOR_PROTO_1_1_1 = SNOR_PROTO_STR(1, 1, 1),\n\tSNOR_PROTO_1_1_2 = SNOR_PROTO_STR(1, 1, 2),\n\tSNOR_PROTO_1_1_4 = SNOR_PROTO_STR(1, 1, 4),\n\tSNOR_PROTO_1_1_8 = SNOR_PROTO_STR(1, 1, 8),\n\tSNOR_PROTO_1_2_2 = SNOR_PROTO_STR(1, 2, 2),\n\tSNOR_PROTO_1_4_4 = SNOR_PROTO_STR(1, 4, 4),\n\tSNOR_PROTO_1_8_8 = SNOR_PROTO_STR(1, 8, 8),\n\tSNOR_PROTO_2_2_2 = SNOR_PROTO_STR(2, 2, 2),\n\tSNOR_PROTO_4_4_4 = SNOR_PROTO_STR(4, 4, 4),\n\tSNOR_PROTO_8_8_8 = SNOR_PROTO_STR(8, 8, 8),\n\n\tSNOR_PROTO_1_1_1_DTR = SNOR_PROTO_DTR(1, 1, 1),\n\tSNOR_PROTO_1_2_2_DTR = SNOR_PROTO_DTR(1, 2, 2),\n\tSNOR_PROTO_1_4_4_DTR = SNOR_PROTO_DTR(1, 4, 4),\n\tSNOR_PROTO_1_8_8_DTR = SNOR_PROTO_DTR(1, 8, 8),\n\tSNOR_PROTO_8_8_8_DTR = SNOR_PROTO_DTR(8, 8, 8),\n};\n\nstatic inline bool spi_nor_protocol_is_dtr(enum spi_nor_protocol proto)\n{\n\treturn !!(proto & SNOR_PROTO_IS_DTR);\n}\n\nstatic inline u8 spi_nor_get_protocol_inst_nbits(enum spi_nor_protocol proto)\n{\n\treturn ((unsigned long)(proto & SNOR_PROTO_INST_MASK)) >>\n\t\tSNOR_PROTO_INST_SHIFT;\n}\n\nstatic inline u8 spi_nor_get_protocol_addr_nbits(enum spi_nor_protocol proto)\n{\n\treturn ((unsigned long)(proto & SNOR_PROTO_ADDR_MASK)) >>\n\t\tSNOR_PROTO_ADDR_SHIFT;\n}\n\nstatic inline u8 spi_nor_get_protocol_data_nbits(enum spi_nor_protocol proto)\n{\n\treturn ((unsigned long)(proto & SNOR_PROTO_DATA_MASK)) >>\n\t\tSNOR_PROTO_DATA_SHIFT;\n}\n\nstatic inline u8 spi_nor_get_protocol_width(enum spi_nor_protocol proto)\n{\n\treturn spi_nor_get_protocol_data_nbits(proto);\n}\n\n \nstruct spi_nor_hwcaps {\n\tu32\tmask;\n};\n\n \n#define SNOR_HWCAPS_READ_MASK\t\tGENMASK(15, 0)\n#define SNOR_HWCAPS_READ\t\tBIT(0)\n#define SNOR_HWCAPS_READ_FAST\t\tBIT(1)\n#define SNOR_HWCAPS_READ_1_1_1_DTR\tBIT(2)\n\n#define SNOR_HWCAPS_READ_DUAL\t\tGENMASK(6, 3)\n#define SNOR_HWCAPS_READ_1_1_2\t\tBIT(3)\n#define SNOR_HWCAPS_READ_1_2_2\t\tBIT(4)\n#define SNOR_HWCAPS_READ_2_2_2\t\tBIT(5)\n#define SNOR_HWCAPS_READ_1_2_2_DTR\tBIT(6)\n\n#define SNOR_HWCAPS_READ_QUAD\t\tGENMASK(10, 7)\n#define SNOR_HWCAPS_READ_1_1_4\t\tBIT(7)\n#define SNOR_HWCAPS_READ_1_4_4\t\tBIT(8)\n#define SNOR_HWCAPS_READ_4_4_4\t\tBIT(9)\n#define SNOR_HWCAPS_READ_1_4_4_DTR\tBIT(10)\n\n#define SNOR_HWCAPS_READ_OCTAL\t\tGENMASK(15, 11)\n#define SNOR_HWCAPS_READ_1_1_8\t\tBIT(11)\n#define SNOR_HWCAPS_READ_1_8_8\t\tBIT(12)\n#define SNOR_HWCAPS_READ_8_8_8\t\tBIT(13)\n#define SNOR_HWCAPS_READ_1_8_8_DTR\tBIT(14)\n#define SNOR_HWCAPS_READ_8_8_8_DTR\tBIT(15)\n\n \n#define SNOR_HWCAPS_PP_MASK\t\tGENMASK(23, 16)\n#define SNOR_HWCAPS_PP\t\t\tBIT(16)\n\n#define SNOR_HWCAPS_PP_QUAD\t\tGENMASK(19, 17)\n#define SNOR_HWCAPS_PP_1_1_4\t\tBIT(17)\n#define SNOR_HWCAPS_PP_1_4_4\t\tBIT(18)\n#define SNOR_HWCAPS_PP_4_4_4\t\tBIT(19)\n\n#define SNOR_HWCAPS_PP_OCTAL\t\tGENMASK(23, 20)\n#define SNOR_HWCAPS_PP_1_1_8\t\tBIT(20)\n#define SNOR_HWCAPS_PP_1_8_8\t\tBIT(21)\n#define SNOR_HWCAPS_PP_8_8_8\t\tBIT(22)\n#define SNOR_HWCAPS_PP_8_8_8_DTR\tBIT(23)\n\n#define SNOR_HWCAPS_X_X_X\t(SNOR_HWCAPS_READ_2_2_2 |\t\\\n\t\t\t\t SNOR_HWCAPS_READ_4_4_4 |\t\\\n\t\t\t\t SNOR_HWCAPS_READ_8_8_8 |\t\\\n\t\t\t\t SNOR_HWCAPS_PP_4_4_4 |\t\t\\\n\t\t\t\t SNOR_HWCAPS_PP_8_8_8)\n\n#define SNOR_HWCAPS_X_X_X_DTR\t(SNOR_HWCAPS_READ_8_8_8_DTR |\t\\\n\t\t\t\t SNOR_HWCAPS_PP_8_8_8_DTR)\n\n#define SNOR_HWCAPS_DTR\t\t(SNOR_HWCAPS_READ_1_1_1_DTR |\t\\\n\t\t\t\t SNOR_HWCAPS_READ_1_2_2_DTR |\t\\\n\t\t\t\t SNOR_HWCAPS_READ_1_4_4_DTR |\t\\\n\t\t\t\t SNOR_HWCAPS_READ_1_8_8_DTR |\t\\\n\t\t\t\t SNOR_HWCAPS_READ_8_8_8_DTR)\n\n#define SNOR_HWCAPS_ALL\t\t(SNOR_HWCAPS_READ_MASK |\t\\\n\t\t\t\t SNOR_HWCAPS_PP_MASK)\n\n \nstruct spi_nor;\n\n \nstruct spi_nor_controller_ops {\n\tint (*prepare)(struct spi_nor *nor);\n\tvoid (*unprepare)(struct spi_nor *nor);\n\tint (*read_reg)(struct spi_nor *nor, u8 opcode, u8 *buf, size_t len);\n\tint (*write_reg)(struct spi_nor *nor, u8 opcode, const u8 *buf,\n\t\t\t size_t len);\n\n\tssize_t (*read)(struct spi_nor *nor, loff_t from, size_t len, u8 *buf);\n\tssize_t (*write)(struct spi_nor *nor, loff_t to, size_t len,\n\t\t\t const u8 *buf);\n\tint (*erase)(struct spi_nor *nor, loff_t offs);\n};\n\n \nenum spi_nor_cmd_ext {\n\tSPI_NOR_EXT_NONE = 0,\n\tSPI_NOR_EXT_REPEAT,\n\tSPI_NOR_EXT_INVERT,\n\tSPI_NOR_EXT_HEX,\n};\n\n \nstruct flash_info;\nstruct spi_nor_manufacturer;\nstruct spi_nor_flash_parameter;\n\n \nstruct spi_nor {\n\tstruct mtd_info\t\tmtd;\n\tstruct mutex\t\tlock;\n\tstruct spi_nor_rww {\n\t\twait_queue_head_t wait;\n\t\tbool\t\tongoing_io;\n\t\tbool\t\tongoing_rd;\n\t\tbool\t\tongoing_pe;\n\t\tunsigned int\tused_banks;\n\t} rww;\n\tstruct device\t\t*dev;\n\tstruct spi_mem\t\t*spimem;\n\tu8\t\t\t*bouncebuf;\n\tsize_t\t\t\tbouncebuf_size;\n\tu8\t\t\t*id;\n\tconst struct flash_info\t*info;\n\tconst struct spi_nor_manufacturer *manufacturer;\n\tu8\t\t\taddr_nbytes;\n\tu8\t\t\terase_opcode;\n\tu8\t\t\tread_opcode;\n\tu8\t\t\tread_dummy;\n\tu8\t\t\tprogram_opcode;\n\tenum spi_nor_protocol\tread_proto;\n\tenum spi_nor_protocol\twrite_proto;\n\tenum spi_nor_protocol\treg_proto;\n\tbool\t\t\tsst_write_second;\n\tu32\t\t\tflags;\n\tenum spi_nor_cmd_ext\tcmd_ext_type;\n\tstruct sfdp\t\t*sfdp;\n\tstruct dentry\t\t*debugfs_root;\n\n\tconst struct spi_nor_controller_ops *controller_ops;\n\n\tstruct spi_nor_flash_parameter *params;\n\n\tstruct {\n\t\tstruct spi_mem_dirmap_desc *rdesc;\n\t\tstruct spi_mem_dirmap_desc *wdesc;\n\t} dirmap;\n\n\tvoid *priv;\n};\n\nstatic inline void spi_nor_set_flash_node(struct spi_nor *nor,\n\t\t\t\t\t  struct device_node *np)\n{\n\tmtd_set_of_node(&nor->mtd, np);\n}\n\nstatic inline struct device_node *spi_nor_get_flash_node(struct spi_nor *nor)\n{\n\treturn mtd_get_of_node(&nor->mtd);\n}\n\n \nint spi_nor_scan(struct spi_nor *nor, const char *name,\n\t\t const struct spi_nor_hwcaps *hwcaps);\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}