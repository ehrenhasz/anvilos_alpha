{
  "module_name": "livepatch.h",
  "hash_id": "d1f76c2c34c91e2eba022a378ba9b70ffb1f9ad1116f2c32e4162875bf8cf4bc",
  "original_prompt": "Ingested from linux-6.6.14/include/linux/livepatch.h",
  "human_readable_source": " \n \n\n#ifndef _LINUX_LIVEPATCH_H_\n#define _LINUX_LIVEPATCH_H_\n\n#include <linux/module.h>\n#include <linux/ftrace.h>\n#include <linux/completion.h>\n#include <linux/list.h>\n#include <linux/livepatch_sched.h>\n\n#if IS_ENABLED(CONFIG_LIVEPATCH)\n\n \n#define KLP_UNDEFINED\t-1\n#define KLP_UNPATCHED\t 0\n#define KLP_PATCHED\t 1\n\n \nstruct klp_func {\n\t \n\tconst char *old_name;\n\tvoid *new_func;\n\t \n\tunsigned long old_sympos;\n\n\t \n\tvoid *old_func;\n\tstruct kobject kobj;\n\tstruct list_head node;\n\tstruct list_head stack_node;\n\tunsigned long old_size, new_size;\n\tbool nop;\n\tbool patched;\n\tbool transition;\n};\n\nstruct klp_object;\n\n \nstruct klp_callbacks {\n\tint (*pre_patch)(struct klp_object *obj);\n\tvoid (*post_patch)(struct klp_object *obj);\n\tvoid (*pre_unpatch)(struct klp_object *obj);\n\tvoid (*post_unpatch)(struct klp_object *obj);\n\tbool post_unpatch_enabled;\n};\n\n \nstruct klp_object {\n\t \n\tconst char *name;\n\tstruct klp_func *funcs;\n\tstruct klp_callbacks callbacks;\n\n\t \n\tstruct kobject kobj;\n\tstruct list_head func_list;\n\tstruct list_head node;\n\tstruct module *mod;\n\tbool dynamic;\n\tbool patched;\n};\n\n \nstruct klp_state {\n\tunsigned long id;\n\tunsigned int version;\n\tvoid *data;\n};\n\n \nstruct klp_patch {\n\t \n\tstruct module *mod;\n\tstruct klp_object *objs;\n\tstruct klp_state *states;\n\tbool replace;\n\n\t \n\tstruct list_head list;\n\tstruct kobject kobj;\n\tstruct list_head obj_list;\n\tbool enabled;\n\tbool forced;\n\tstruct work_struct free_work;\n\tstruct completion finish;\n};\n\n#define klp_for_each_object_static(patch, obj) \\\n\tfor (obj = patch->objs; obj->funcs || obj->name; obj++)\n\n#define klp_for_each_object_safe(patch, obj, tmp_obj)\t\t\\\n\tlist_for_each_entry_safe(obj, tmp_obj, &patch->obj_list, node)\n\n#define klp_for_each_object(patch, obj)\t\\\n\tlist_for_each_entry(obj, &patch->obj_list, node)\n\n#define klp_for_each_func_static(obj, func) \\\n\tfor (func = obj->funcs; \\\n\t     func->old_name || func->new_func || func->old_sympos; \\\n\t     func++)\n\n#define klp_for_each_func_safe(obj, func, tmp_func)\t\t\t\\\n\tlist_for_each_entry_safe(func, tmp_func, &obj->func_list, node)\n\n#define klp_for_each_func(obj, func)\t\\\n\tlist_for_each_entry(func, &obj->func_list, node)\n\nint klp_enable_patch(struct klp_patch *);\n\n \nint klp_module_coming(struct module *mod);\nvoid klp_module_going(struct module *mod);\n\nvoid klp_copy_process(struct task_struct *child);\nvoid klp_update_patch_state(struct task_struct *task);\n\nstatic inline bool klp_patch_pending(struct task_struct *task)\n{\n\treturn test_tsk_thread_flag(task, TIF_PATCH_PENDING);\n}\n\nstatic inline bool klp_have_reliable_stack(void)\n{\n\treturn IS_ENABLED(CONFIG_STACKTRACE) &&\n\t       IS_ENABLED(CONFIG_HAVE_RELIABLE_STACKTRACE);\n}\n\ntypedef int (*klp_shadow_ctor_t)(void *obj,\n\t\t\t\t void *shadow_data,\n\t\t\t\t void *ctor_data);\ntypedef void (*klp_shadow_dtor_t)(void *obj, void *shadow_data);\n\nvoid *klp_shadow_get(void *obj, unsigned long id);\nvoid *klp_shadow_alloc(void *obj, unsigned long id,\n\t\t       size_t size, gfp_t gfp_flags,\n\t\t       klp_shadow_ctor_t ctor, void *ctor_data);\nvoid *klp_shadow_get_or_alloc(void *obj, unsigned long id,\n\t\t\t      size_t size, gfp_t gfp_flags,\n\t\t\t      klp_shadow_ctor_t ctor, void *ctor_data);\nvoid klp_shadow_free(void *obj, unsigned long id, klp_shadow_dtor_t dtor);\nvoid klp_shadow_free_all(unsigned long id, klp_shadow_dtor_t dtor);\n\nstruct klp_state *klp_get_state(struct klp_patch *patch, unsigned long id);\nstruct klp_state *klp_get_prev_state(unsigned long id);\n\nint klp_apply_section_relocs(struct module *pmod, Elf_Shdr *sechdrs,\n\t\t\t     const char *shstrtab, const char *strtab,\n\t\t\t     unsigned int symindex, unsigned int secindex,\n\t\t\t     const char *objname);\n\n#else  \n\nstatic inline int klp_module_coming(struct module *mod) { return 0; }\nstatic inline void klp_module_going(struct module *mod) {}\nstatic inline bool klp_patch_pending(struct task_struct *task) { return false; }\nstatic inline void klp_update_patch_state(struct task_struct *task) {}\nstatic inline void klp_copy_process(struct task_struct *child) {}\n\nstatic inline\nint klp_apply_section_relocs(struct module *pmod, Elf_Shdr *sechdrs,\n\t\t\t     const char *shstrtab, const char *strtab,\n\t\t\t     unsigned int symindex, unsigned int secindex,\n\t\t\t     const char *objname)\n{\n\treturn 0;\n}\n\n#endif  \n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}