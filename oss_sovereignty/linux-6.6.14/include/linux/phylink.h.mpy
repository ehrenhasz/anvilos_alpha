{
  "module_name": "phylink.h",
  "hash_id": "995a536d24549d508e98d6eadb5e35e076e5d54beb6d826e585aac7cb18a7320",
  "original_prompt": "Ingested from linux-6.6.14/include/linux/phylink.h",
  "human_readable_source": "#ifndef NETDEV_PCS_H\n#define NETDEV_PCS_H\n\n#include <linux/phy.h>\n#include <linux/spinlock.h>\n#include <linux/workqueue.h>\n\nstruct device_node;\nstruct ethtool_cmd;\nstruct fwnode_handle;\nstruct net_device;\nstruct phylink;\n\nenum {\n\tMLO_PAUSE_NONE,\n\tMLO_PAUSE_RX = BIT(0),\n\tMLO_PAUSE_TX = BIT(1),\n\tMLO_PAUSE_TXRX_MASK = MLO_PAUSE_TX | MLO_PAUSE_RX,\n\tMLO_PAUSE_AN = BIT(2),\n\n\tMLO_AN_PHY = 0,\t \n\tMLO_AN_FIXED,\t \n\tMLO_AN_INBAND,\t \n\n\t \n\tPHYLINK_PCS_NEG_NONE = 0,\n\tPHYLINK_PCS_NEG_ENABLED = BIT(4),\n\tPHYLINK_PCS_NEG_OUTBAND = BIT(5),\n\tPHYLINK_PCS_NEG_INBAND = BIT(6),\n\tPHYLINK_PCS_NEG_INBAND_DISABLED = PHYLINK_PCS_NEG_INBAND,\n\tPHYLINK_PCS_NEG_INBAND_ENABLED = PHYLINK_PCS_NEG_INBAND |\n\t\t\t\t\t PHYLINK_PCS_NEG_ENABLED,\n\n\t \n\tMAC_SYM_PAUSE\t= BIT(0),\n\tMAC_ASYM_PAUSE\t= BIT(1),\n\tMAC_10HD\t= BIT(2),\n\tMAC_10FD\t= BIT(3),\n\tMAC_10\t\t= MAC_10HD | MAC_10FD,\n\tMAC_100HD\t= BIT(4),\n\tMAC_100FD\t= BIT(5),\n\tMAC_100\t\t= MAC_100HD | MAC_100FD,\n\tMAC_1000HD\t= BIT(6),\n\tMAC_1000FD\t= BIT(7),\n\tMAC_1000\t= MAC_1000HD | MAC_1000FD,\n\tMAC_2500FD\t= BIT(8),\n\tMAC_5000FD\t= BIT(9),\n\tMAC_10000FD\t= BIT(10),\n\tMAC_20000FD\t= BIT(11),\n\tMAC_25000FD\t= BIT(12),\n\tMAC_40000FD\t= BIT(13),\n\tMAC_50000FD\t= BIT(14),\n\tMAC_56000FD\t= BIT(15),\n\tMAC_100000FD\t= BIT(16),\n\tMAC_200000FD\t= BIT(17),\n\tMAC_400000FD\t= BIT(18),\n};\n\nstatic inline bool phylink_autoneg_inband(unsigned int mode)\n{\n\treturn mode == MLO_AN_INBAND;\n}\n\n \nstatic inline unsigned int phylink_pcs_neg_mode(unsigned int mode,\n\t\t\t\t\t\tphy_interface_t interface,\n\t\t\t\t\t\tconst unsigned long *advertising)\n{\n\tunsigned int neg_mode;\n\n\tswitch (interface) {\n\tcase PHY_INTERFACE_MODE_SGMII:\n\tcase PHY_INTERFACE_MODE_QSGMII:\n\tcase PHY_INTERFACE_MODE_QUSGMII:\n\tcase PHY_INTERFACE_MODE_USXGMII:\n\t\t \n\t\tif (!phylink_autoneg_inband(mode))\n\t\t\tneg_mode = PHYLINK_PCS_NEG_OUTBAND;\n\t\telse\n\t\t\tneg_mode = PHYLINK_PCS_NEG_INBAND_ENABLED;\n\t\tbreak;\n\n\tcase PHY_INTERFACE_MODE_1000BASEX:\n\tcase PHY_INTERFACE_MODE_2500BASEX:\n\t\t \n\t\tif (!phylink_autoneg_inband(mode))\n\t\t\tneg_mode = PHYLINK_PCS_NEG_OUTBAND;\n\t\telse if (linkmode_test_bit(ETHTOOL_LINK_MODE_Autoneg_BIT,\n\t\t\t\t\t   advertising))\n\t\t\tneg_mode = PHYLINK_PCS_NEG_INBAND_ENABLED;\n\t\telse\n\t\t\tneg_mode = PHYLINK_PCS_NEG_INBAND_DISABLED;\n\t\tbreak;\n\n\tdefault:\n\t\tneg_mode = PHYLINK_PCS_NEG_NONE;\n\t\tbreak;\n\t}\n\n\treturn neg_mode;\n}\n\n \nstruct phylink_link_state {\n\t__ETHTOOL_DECLARE_LINK_MODE_MASK(advertising);\n\t__ETHTOOL_DECLARE_LINK_MODE_MASK(lp_advertising);\n\tphy_interface_t interface;\n\tint speed;\n\tint duplex;\n\tint pause;\n\tint rate_matching;\n\tunsigned int link:1;\n\tunsigned int an_complete:1;\n};\n\nenum phylink_op_type {\n\tPHYLINK_NETDEV = 0,\n\tPHYLINK_DEV,\n};\n\n \nstruct phylink_config {\n\tstruct device *dev;\n\tenum phylink_op_type type;\n\tbool poll_fixed_state;\n\tbool mac_managed_pm;\n\tbool ovr_an_inband;\n\tvoid (*get_fixed_state)(struct phylink_config *config,\n\t\t\t\tstruct phylink_link_state *state);\n\tDECLARE_PHY_INTERFACE_MASK(supported_interfaces);\n\tunsigned long mac_capabilities;\n};\n\nvoid phylink_limit_mac_speed(struct phylink_config *config, u32 max_speed);\n\n \nstruct phylink_mac_ops {\n\tvoid (*validate)(struct phylink_config *config,\n\t\t\t unsigned long *supported,\n\t\t\t struct phylink_link_state *state);\n\tstruct phylink_pcs *(*mac_select_pcs)(struct phylink_config *config,\n\t\t\t\t\t      phy_interface_t interface);\n\tint (*mac_prepare)(struct phylink_config *config, unsigned int mode,\n\t\t\t   phy_interface_t iface);\n\tvoid (*mac_config)(struct phylink_config *config, unsigned int mode,\n\t\t\t   const struct phylink_link_state *state);\n\tint (*mac_finish)(struct phylink_config *config, unsigned int mode,\n\t\t\t  phy_interface_t iface);\n\tvoid (*mac_link_down)(struct phylink_config *config, unsigned int mode,\n\t\t\t      phy_interface_t interface);\n\tvoid (*mac_link_up)(struct phylink_config *config,\n\t\t\t    struct phy_device *phy, unsigned int mode,\n\t\t\t    phy_interface_t interface, int speed, int duplex,\n\t\t\t    bool tx_pause, bool rx_pause);\n};\n\n#if 0  \n \nvoid validate(struct phylink_config *config, unsigned long *supported,\n\t      struct phylink_link_state *state);\n \nstruct phylink_pcs *mac_select_pcs(struct phylink_config *config,\n\t\t\t\t   phy_interface_t interface);\n\n \nint mac_prepare(struct phylink_config *config, unsigned int mode,\n\t\tphy_interface_t iface);\n\n \nvoid mac_config(struct phylink_config *config, unsigned int mode,\n\t\tconst struct phylink_link_state *state);\n\n \nint mac_finish(struct phylink_config *config, unsigned int mode,\n\t\tphy_interface_t iface);\n\n \nvoid mac_link_down(struct phylink_config *config, unsigned int mode,\n\t\t   phy_interface_t interface);\n\n \nvoid mac_link_up(struct phylink_config *config, struct phy_device *phy,\n\t\t unsigned int mode, phy_interface_t interface,\n\t\t int speed, int duplex, bool tx_pause, bool rx_pause);\n#endif\n\nstruct phylink_pcs_ops;\n\n \nstruct phylink_pcs {\n\tconst struct phylink_pcs_ops *ops;\n\tstruct phylink *phylink;\n\tbool neg_mode;\n\tbool poll;\n};\n\n \nstruct phylink_pcs_ops {\n\tint (*pcs_validate)(struct phylink_pcs *pcs, unsigned long *supported,\n\t\t\t    const struct phylink_link_state *state);\n\tint (*pcs_enable)(struct phylink_pcs *pcs);\n\tvoid (*pcs_disable)(struct phylink_pcs *pcs);\n\tvoid (*pcs_pre_config)(struct phylink_pcs *pcs,\n\t\t\t       phy_interface_t interface);\n\tint (*pcs_post_config)(struct phylink_pcs *pcs,\n\t\t\t       phy_interface_t interface);\n\tvoid (*pcs_get_state)(struct phylink_pcs *pcs,\n\t\t\t      struct phylink_link_state *state);\n\tint (*pcs_config)(struct phylink_pcs *pcs, unsigned int neg_mode,\n\t\t\t  phy_interface_t interface,\n\t\t\t  const unsigned long *advertising,\n\t\t\t  bool permit_pause_to_mac);\n\tvoid (*pcs_an_restart)(struct phylink_pcs *pcs);\n\tvoid (*pcs_link_up)(struct phylink_pcs *pcs, unsigned int neg_mode,\n\t\t\t    phy_interface_t interface, int speed, int duplex);\n};\n\n#if 0  \n \nint pcs_validate(struct phylink_pcs *pcs, unsigned long *supported,\n\t\t const struct phylink_link_state *state);\n\n \nint pcs_enable(struct phylink_pcs *pcs);\n\n \nvoid pcs_disable(struct phylink_pcs *pcs);\n\n \nvoid pcs_get_state(struct phylink_pcs *pcs,\n\t\t   struct phylink_link_state *state);\n\n \nint pcs_config(struct phylink_pcs *pcs, unsigned int neg_mode,\n\t       phy_interface_t interface, const unsigned long *advertising,\n\t       bool permit_pause_to_mac);\n\n \nvoid pcs_an_restart(struct phylink_pcs *pcs);\n\n \nvoid pcs_link_up(struct phylink_pcs *pcs, unsigned int neg_mode,\n\t\t phy_interface_t interface, int speed, int duplex);\n#endif\n\nvoid phylink_caps_to_linkmodes(unsigned long *linkmodes, unsigned long caps);\nunsigned long phylink_get_capabilities(phy_interface_t interface,\n\t\t\t\t       unsigned long mac_capabilities,\n\t\t\t\t       int rate_matching);\nvoid phylink_validate_mask_caps(unsigned long *supported,\n\t\t\t\tstruct phylink_link_state *state,\n\t\t\t\tunsigned long caps);\nvoid phylink_generic_validate(struct phylink_config *config,\n\t\t\t      unsigned long *supported,\n\t\t\t      struct phylink_link_state *state);\n\nstruct phylink *phylink_create(struct phylink_config *,\n\t\t\t       const struct fwnode_handle *,\n\t\t\t       phy_interface_t,\n\t\t\t       const struct phylink_mac_ops *);\nvoid phylink_destroy(struct phylink *);\nbool phylink_expects_phy(struct phylink *pl);\n\nint phylink_connect_phy(struct phylink *, struct phy_device *);\nint phylink_of_phy_connect(struct phylink *, struct device_node *, u32 flags);\nint phylink_fwnode_phy_connect(struct phylink *pl,\n\t\t\t       const struct fwnode_handle *fwnode,\n\t\t\t       u32 flags);\nvoid phylink_disconnect_phy(struct phylink *);\n\nvoid phylink_mac_change(struct phylink *, bool up);\nvoid phylink_pcs_change(struct phylink_pcs *, bool up);\n\nvoid phylink_start(struct phylink *);\nvoid phylink_stop(struct phylink *);\n\nvoid phylink_suspend(struct phylink *pl, bool mac_wol);\nvoid phylink_resume(struct phylink *pl);\n\nvoid phylink_ethtool_get_wol(struct phylink *, struct ethtool_wolinfo *);\nint phylink_ethtool_set_wol(struct phylink *, struct ethtool_wolinfo *);\n\nint phylink_ethtool_ksettings_get(struct phylink *,\n\t\t\t\t  struct ethtool_link_ksettings *);\nint phylink_ethtool_ksettings_set(struct phylink *,\n\t\t\t\t  const struct ethtool_link_ksettings *);\nint phylink_ethtool_nway_reset(struct phylink *);\nvoid phylink_ethtool_get_pauseparam(struct phylink *,\n\t\t\t\t    struct ethtool_pauseparam *);\nint phylink_ethtool_set_pauseparam(struct phylink *,\n\t\t\t\t   struct ethtool_pauseparam *);\nint phylink_get_eee_err(struct phylink *);\nint phylink_init_eee(struct phylink *, bool);\nint phylink_ethtool_get_eee(struct phylink *, struct ethtool_eee *);\nint phylink_ethtool_set_eee(struct phylink *, struct ethtool_eee *);\nint phylink_mii_ioctl(struct phylink *, struct ifreq *, int);\nint phylink_speed_down(struct phylink *pl, bool sync);\nint phylink_speed_up(struct phylink *pl);\n\n#define phylink_zero(bm) \\\n\tbitmap_zero(bm, __ETHTOOL_LINK_MODE_MASK_NBITS)\n#define __phylink_do_bit(op, bm, mode) \\\n\top(ETHTOOL_LINK_MODE_ ## mode ## _BIT, bm)\n\n#define phylink_set(bm, mode)\t__phylink_do_bit(__set_bit, bm, mode)\n#define phylink_clear(bm, mode)\t__phylink_do_bit(__clear_bit, bm, mode)\n#define phylink_test(bm, mode)\t__phylink_do_bit(test_bit, bm, mode)\n\nvoid phylink_set_port_modes(unsigned long *bits);\n\n \nstatic inline int phylink_get_link_timer_ns(phy_interface_t interface)\n{\n\tswitch (interface) {\n\tcase PHY_INTERFACE_MODE_SGMII:\n\tcase PHY_INTERFACE_MODE_QSGMII:\n\tcase PHY_INTERFACE_MODE_USXGMII:\n\t\treturn 1600000;\n\n\tcase PHY_INTERFACE_MODE_1000BASEX:\n\tcase PHY_INTERFACE_MODE_2500BASEX:\n\t\treturn 10000000;\n\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n}\n\nvoid phylink_mii_c22_pcs_decode_state(struct phylink_link_state *state,\n\t\t\t\t      u16 bmsr, u16 lpa);\nvoid phylink_mii_c22_pcs_get_state(struct mdio_device *pcs,\n\t\t\t\t   struct phylink_link_state *state);\nint phylink_mii_c22_pcs_encode_advertisement(phy_interface_t interface,\n\t\t\t\t\t     const unsigned long *advertising);\nint phylink_mii_c22_pcs_config(struct mdio_device *pcs,\n\t\t\t       phy_interface_t interface,\n\t\t\t       const unsigned long *advertising,\n\t\t\t       unsigned int neg_mode);\nvoid phylink_mii_c22_pcs_an_restart(struct mdio_device *pcs);\n\nvoid phylink_resolve_c73(struct phylink_link_state *state);\n\nvoid phylink_mii_c45_pcs_get_state(struct mdio_device *pcs,\n\t\t\t\t   struct phylink_link_state *state);\n\nvoid phylink_decode_usxgmii_word(struct phylink_link_state *state,\n\t\t\t\t uint16_t lpa);\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}