{
  "module_name": "mhi_ep.h",
  "hash_id": "d015b6dc86c6345013d896f1e9281344a2c0f48771afb1d59cbb025d9e7cfa0e",
  "original_prompt": "Ingested from linux-6.6.14/include/linux/mhi_ep.h",
  "human_readable_source": " \n \n#ifndef _MHI_EP_H_\n#define _MHI_EP_H_\n\n#include <linux/dma-direction.h>\n#include <linux/mhi.h>\n\n#define MHI_EP_DEFAULT_MTU 0x8000\n\n \nstruct mhi_ep_channel_config {\n\tchar *name;\n\tu32 num;\n\tu32 num_elements;\n\tenum dma_data_direction dir;\n};\n\n \nstruct mhi_ep_cntrl_config {\n\tu32 mhi_version;\n\tu32 max_channels;\n\tu32 num_channels;\n\tconst struct mhi_ep_channel_config *ch_cfg;\n};\n\n \nstruct mhi_ep_db_info {\n\tu32 mask;\n\tu32 status;\n};\n\n \nstruct mhi_ep_buf_info {\n\tvoid *dev_addr;\n\tu64 host_addr;\n\tsize_t size;\n};\n\n \nstruct mhi_ep_cntrl {\n\tstruct device *cntrl_dev;\n\tstruct mhi_ep_device *mhi_dev;\n\tvoid __iomem *mmio;\n\n\tstruct mhi_ep_chan *mhi_chan;\n\tstruct mhi_ep_event *mhi_event;\n\tstruct mhi_ep_cmd *mhi_cmd;\n\tstruct mhi_ep_sm *sm;\n\n\tstruct mhi_chan_ctxt *ch_ctx_cache;\n\tstruct mhi_event_ctxt *ev_ctx_cache;\n\tstruct mhi_cmd_ctxt *cmd_ctx_cache;\n\tu64 ch_ctx_host_pa;\n\tu64 ev_ctx_host_pa;\n\tu64 cmd_ctx_host_pa;\n\tphys_addr_t ch_ctx_cache_phys;\n\tphys_addr_t ev_ctx_cache_phys;\n\tphys_addr_t cmd_ctx_cache_phys;\n\n\tstruct mhi_ep_db_info chdb[4];\n\tstruct mutex event_lock;\n\tstruct mutex state_lock;\n\tspinlock_t list_lock;\n\n\tstruct list_head st_transition_list;\n\tstruct list_head ch_db_list;\n\n\tstruct workqueue_struct *wq;\n\tstruct work_struct state_work;\n\tstruct work_struct reset_work;\n\tstruct work_struct cmd_ring_work;\n\tstruct work_struct ch_ring_work;\n\tstruct kmem_cache *ring_item_cache;\n\tstruct kmem_cache *ev_ring_el_cache;\n\tstruct kmem_cache *tre_buf_cache;\n\n\tvoid (*raise_irq)(struct mhi_ep_cntrl *mhi_cntrl, u32 vector);\n\tint (*alloc_map)(struct mhi_ep_cntrl *mhi_cntrl, u64 pci_addr, phys_addr_t *phys_ptr,\n\t\t\t void __iomem **virt, size_t size);\n\tvoid (*unmap_free)(struct mhi_ep_cntrl *mhi_cntrl, u64 pci_addr, phys_addr_t phys,\n\t\t\t   void __iomem *virt, size_t size);\n\tint (*read_from_host)(struct mhi_ep_cntrl *mhi_cntrl, struct mhi_ep_buf_info *buf_info);\n\tint (*write_to_host)(struct mhi_ep_cntrl *mhi_cntrl, struct mhi_ep_buf_info *buf_info);\n\n\tenum mhi_state mhi_state;\n\n\tu32 max_chan;\n\tu32 mru;\n\tu32 event_rings;\n\tu32 hw_event_rings;\n\tu32 chdb_offset;\n\tu32 erdb_offset;\n\tu32 index;\n\tint irq;\n\tbool enabled;\n};\n\n \nstruct mhi_ep_device {\n\tstruct device dev;\n\tstruct mhi_ep_cntrl *mhi_cntrl;\n\tconst struct mhi_device_id *id;\n\tconst char *name;\n\tstruct mhi_ep_chan *ul_chan;\n\tstruct mhi_ep_chan *dl_chan;\n\tenum mhi_device_type dev_type;\n};\n\n \nstruct mhi_ep_driver {\n\tconst struct mhi_device_id *id_table;\n\tstruct device_driver driver;\n\tint (*probe)(struct mhi_ep_device *mhi_ep,\n\t\t     const struct mhi_device_id *id);\n\tvoid (*remove)(struct mhi_ep_device *mhi_ep);\n\tvoid (*ul_xfer_cb)(struct mhi_ep_device *mhi_dev,\n\t\t\t   struct mhi_result *result);\n\tvoid (*dl_xfer_cb)(struct mhi_ep_device *mhi_dev,\n\t\t\t   struct mhi_result *result);\n};\n\n#define to_mhi_ep_device(dev) container_of(dev, struct mhi_ep_device, dev)\n#define to_mhi_ep_driver(drv) container_of(drv, struct mhi_ep_driver, driver)\n\n \n#define module_mhi_ep_driver(mhi_drv) \\\n\tmodule_driver(mhi_drv, mhi_ep_driver_register, \\\n\t\t      mhi_ep_driver_unregister)\n\n \n#define mhi_ep_driver_register(mhi_drv) \\\n\t__mhi_ep_driver_register(mhi_drv, THIS_MODULE)\n\n \nint __mhi_ep_driver_register(struct mhi_ep_driver *mhi_drv, struct module *owner);\n\n \nvoid mhi_ep_driver_unregister(struct mhi_ep_driver *mhi_drv);\n\n \nint mhi_ep_register_controller(struct mhi_ep_cntrl *mhi_cntrl,\n\t\t\t       const struct mhi_ep_cntrl_config *config);\n\n \nvoid mhi_ep_unregister_controller(struct mhi_ep_cntrl *mhi_cntrl);\n\n \nint mhi_ep_power_up(struct mhi_ep_cntrl *mhi_cntrl);\n\n \nvoid mhi_ep_power_down(struct mhi_ep_cntrl *mhi_cntrl);\n\n \nbool mhi_ep_queue_is_empty(struct mhi_ep_device *mhi_dev, enum dma_data_direction dir);\n\n \nint mhi_ep_queue_skb(struct mhi_ep_device *mhi_dev, struct sk_buff *skb);\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}