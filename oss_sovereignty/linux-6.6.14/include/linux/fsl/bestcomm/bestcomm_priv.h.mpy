{
  "module_name": "bestcomm_priv.h",
  "hash_id": "3047effd62a0faa5b05383559b5c09f7e2de3728cfd7b0f8f679806cecf1449f",
  "original_prompt": "Ingested from linux-6.6.14/include/linux/fsl/bestcomm/bestcomm_priv.h",
  "human_readable_source": " \n\n#ifndef __BESTCOMM_PRIV_H__\n#define __BESTCOMM_PRIV_H__\n\n#include <linux/spinlock.h>\n#include <linux/of.h>\n#include <asm/io.h>\n#include <asm/mpc52xx.h>\n\n#include \"sram.h\"\n\n\n \n \n \n\n \n#define BCOM_MAX_TASKS\t\t16\n#define BCOM_MAX_VAR\t\t24\n#define BCOM_MAX_INC\t\t8\n#define BCOM_MAX_FDT\t\t64\n#define BCOM_MAX_CTX\t\t20\n#define BCOM_CTX_SIZE\t\t(BCOM_MAX_CTX * sizeof(u32))\n#define BCOM_CTX_ALIGN\t\t0x100\n#define BCOM_VAR_SIZE\t\t(BCOM_MAX_VAR * sizeof(u32))\n#define BCOM_INC_SIZE\t\t(BCOM_MAX_INC * sizeof(u32))\n#define BCOM_VAR_ALIGN\t\t0x80\n#define BCOM_FDT_SIZE\t\t(BCOM_MAX_FDT * sizeof(u32))\n#define BCOM_FDT_ALIGN\t\t0x100\n\n \nstruct bcom_tdt {\n\tu32 start;\n\tu32 stop;\n\tu32 var;\n\tu32 fdt;\n\tu32 exec_status;\t \n\tu32 mvtp;\t\t \n\tu32 context;\n\tu32 litbase;\n};\n\n \nstruct bcom_engine {\n\tstruct device_node\t\t*ofnode;\n\tstruct mpc52xx_sdma __iomem     *regs;\n\tphys_addr_t                      regs_base;\n\n\tstruct bcom_tdt\t\t\t*tdt;\n\tu32\t\t\t\t*ctx;\n\tu32\t\t\t\t*var;\n\tu32\t\t\t\t*fdt;\n\n\tspinlock_t\t\t\tlock;\n};\n\nextern struct bcom_engine *bcom_eng;\n\n\n \n \n \n\n \n#define BCOM_TASK_MAGIC\t\t0x4243544B\t \n\nstruct bcom_task_header {\n\tu32\tmagic;\n\tu8\tdesc_size;\t \n\tu8\tvar_size;\t \n\tu8\tinc_size;\t \n\tu8\tfirst_var;\n\tu8\treserved[8];\n};\n\n \n#define BCOM_DESC_NOP\t\t0x000001f8\n#define BCOM_LCD_MASK\t\t0x80000000\n#define BCOM_DRD_EXTENDED\t0x40000000\n#define BCOM_DRD_INITIATOR_SHIFT\t21\n\n \n#define BCOM_PRAGMA_BIT_RSV\t\t7\t \n#define BCOM_PRAGMA_BIT_PRECISE_INC\t6\t \n\t\t\t\t\t\t \n#define BCOM_PRAGMA_BIT_RST_ERROR_NO\t5\t \n\t\t\t\t\t\t \n#define BCOM_PRAGMA_BIT_PACK\t\t4\t \n#define BCOM_PRAGMA_BIT_INTEGER\t\t3\t \n\t\t\t\t\t\t \n#define BCOM_PRAGMA_BIT_SPECREAD\t2\t \n#define BCOM_PRAGMA_BIT_CW\t\t1\t \n#define BCOM_PRAGMA_BIT_RL\t\t0\t \n\n\t \n#define BCOM_STD_PRAGMA\t\t((0 << BCOM_PRAGMA_BIT_RSV)\t\t| \\\n\t\t\t\t (0 << BCOM_PRAGMA_BIT_PRECISE_INC)\t| \\\n\t\t\t\t (0 << BCOM_PRAGMA_BIT_RST_ERROR_NO)\t| \\\n\t\t\t\t (0 << BCOM_PRAGMA_BIT_PACK)\t\t| \\\n\t\t\t\t (0 << BCOM_PRAGMA_BIT_INTEGER)\t\t| \\\n\t\t\t\t (0 << BCOM_PRAGMA_BIT_SPECREAD)\t| \\\n\t\t\t\t (1 << BCOM_PRAGMA_BIT_CW)\t\t| \\\n\t\t\t\t (1 << BCOM_PRAGMA_BIT_RL))\n\n#define BCOM_PCI_PRAGMA\t\t((0 << BCOM_PRAGMA_BIT_RSV)\t\t| \\\n\t\t\t\t (0 << BCOM_PRAGMA_BIT_PRECISE_INC)\t| \\\n\t\t\t\t (0 << BCOM_PRAGMA_BIT_RST_ERROR_NO)\t| \\\n\t\t\t\t (0 << BCOM_PRAGMA_BIT_PACK)\t\t| \\\n\t\t\t\t (1 << BCOM_PRAGMA_BIT_INTEGER)\t\t| \\\n\t\t\t\t (0 << BCOM_PRAGMA_BIT_SPECREAD)\t| \\\n\t\t\t\t (1 << BCOM_PRAGMA_BIT_CW)\t\t| \\\n\t\t\t\t (1 << BCOM_PRAGMA_BIT_RL))\n\n#define BCOM_ATA_PRAGMA\t\tBCOM_STD_PRAGMA\n#define BCOM_CRC16_DP_0_PRAGMA\tBCOM_STD_PRAGMA\n#define BCOM_CRC16_DP_1_PRAGMA\tBCOM_STD_PRAGMA\n#define BCOM_FEC_RX_BD_PRAGMA\tBCOM_STD_PRAGMA\n#define BCOM_FEC_TX_BD_PRAGMA\tBCOM_STD_PRAGMA\n#define BCOM_GEN_DP_0_PRAGMA\tBCOM_STD_PRAGMA\n#define BCOM_GEN_DP_1_PRAGMA\tBCOM_STD_PRAGMA\n#define BCOM_GEN_DP_2_PRAGMA\tBCOM_STD_PRAGMA\n#define BCOM_GEN_DP_3_PRAGMA\tBCOM_STD_PRAGMA\n#define BCOM_GEN_DP_BD_0_PRAGMA\tBCOM_STD_PRAGMA\n#define BCOM_GEN_DP_BD_1_PRAGMA\tBCOM_STD_PRAGMA\n#define BCOM_GEN_RX_BD_PRAGMA\tBCOM_STD_PRAGMA\n#define BCOM_GEN_TX_BD_PRAGMA\tBCOM_STD_PRAGMA\n#define BCOM_GEN_LPC_PRAGMA\tBCOM_STD_PRAGMA\n#define BCOM_PCI_RX_PRAGMA\tBCOM_PCI_PRAGMA\n#define BCOM_PCI_TX_PRAGMA\tBCOM_PCI_PRAGMA\n\n \n#define BCOM_INITIATOR_ALWAYS\t 0\n#define BCOM_INITIATOR_SCTMR_0\t 1\n#define BCOM_INITIATOR_SCTMR_1\t 2\n#define BCOM_INITIATOR_FEC_RX\t 3\n#define BCOM_INITIATOR_FEC_TX\t 4\n#define BCOM_INITIATOR_ATA_RX\t 5\n#define BCOM_INITIATOR_ATA_TX\t 6\n#define BCOM_INITIATOR_SCPCI_RX\t 7\n#define BCOM_INITIATOR_SCPCI_TX\t 8\n#define BCOM_INITIATOR_PSC3_RX\t 9\n#define BCOM_INITIATOR_PSC3_TX\t10\n#define BCOM_INITIATOR_PSC2_RX\t11\n#define BCOM_INITIATOR_PSC2_TX\t12\n#define BCOM_INITIATOR_PSC1_RX\t13\n#define BCOM_INITIATOR_PSC1_TX\t14\n#define BCOM_INITIATOR_SCTMR_2\t15\n#define BCOM_INITIATOR_SCLPC\t16\n#define BCOM_INITIATOR_PSC5_RX\t17\n#define BCOM_INITIATOR_PSC5_TX\t18\n#define BCOM_INITIATOR_PSC4_RX\t19\n#define BCOM_INITIATOR_PSC4_TX\t20\n#define BCOM_INITIATOR_I2C2_RX\t21\n#define BCOM_INITIATOR_I2C2_TX\t22\n#define BCOM_INITIATOR_I2C1_RX\t23\n#define BCOM_INITIATOR_I2C1_TX\t24\n#define BCOM_INITIATOR_PSC6_RX\t25\n#define BCOM_INITIATOR_PSC6_TX\t26\n#define BCOM_INITIATOR_IRDA_RX\t25\n#define BCOM_INITIATOR_IRDA_TX\t26\n#define BCOM_INITIATOR_SCTMR_3\t27\n#define BCOM_INITIATOR_SCTMR_4\t28\n#define BCOM_INITIATOR_SCTMR_5\t29\n#define BCOM_INITIATOR_SCTMR_6\t30\n#define BCOM_INITIATOR_SCTMR_7\t31\n\n \n#define BCOM_IPR_ALWAYS\t\t7\n#define BCOM_IPR_SCTMR_0\t2\n#define BCOM_IPR_SCTMR_1\t2\n#define BCOM_IPR_FEC_RX\t\t6\n#define BCOM_IPR_FEC_TX\t\t5\n#define BCOM_IPR_ATA_RX\t\t7\n#define BCOM_IPR_ATA_TX\t\t7\n#define BCOM_IPR_SCPCI_RX\t2\n#define BCOM_IPR_SCPCI_TX\t2\n#define BCOM_IPR_PSC3_RX\t2\n#define BCOM_IPR_PSC3_TX\t2\n#define BCOM_IPR_PSC2_RX\t2\n#define BCOM_IPR_PSC2_TX\t2\n#define BCOM_IPR_PSC1_RX\t2\n#define BCOM_IPR_PSC1_TX\t2\n#define BCOM_IPR_SCTMR_2\t2\n#define BCOM_IPR_SCLPC\t\t2\n#define BCOM_IPR_PSC5_RX\t2\n#define BCOM_IPR_PSC5_TX\t2\n#define BCOM_IPR_PSC4_RX\t2\n#define BCOM_IPR_PSC4_TX\t2\n#define BCOM_IPR_I2C2_RX\t2\n#define BCOM_IPR_I2C2_TX\t2\n#define BCOM_IPR_I2C1_RX\t2\n#define BCOM_IPR_I2C1_TX\t2\n#define BCOM_IPR_PSC6_RX\t2\n#define BCOM_IPR_PSC6_TX\t2\n#define BCOM_IPR_IRDA_RX\t2\n#define BCOM_IPR_IRDA_TX\t2\n#define BCOM_IPR_SCTMR_3\t2\n#define BCOM_IPR_SCTMR_4\t2\n#define BCOM_IPR_SCTMR_5\t2\n#define BCOM_IPR_SCTMR_6\t2\n#define BCOM_IPR_SCTMR_7\t2\n\n\n \n \n \n\nextern struct bcom_task *bcom_task_alloc(int bd_count, int bd_size, int priv_size);\nextern void bcom_task_free(struct bcom_task *tsk);\nextern int bcom_load_image(int task, u32 *task_image);\nextern void bcom_set_initiator(int task, int initiator);\n\n\n#define TASK_ENABLE             0x8000\n\n \nstatic inline void bcom_disable_prefetch(void)\n{\n\tu16 regval;\n\n\tregval = in_be16(&bcom_eng->regs->PtdCntrl);\n\tout_be16(&bcom_eng->regs->PtdCntrl, regval | 1);\n};\n\nstatic inline void\nbcom_enable_task(int task)\n{\n        u16 reg;\n        reg = in_be16(&bcom_eng->regs->tcr[task]);\n        out_be16(&bcom_eng->regs->tcr[task],  reg | TASK_ENABLE);\n}\n\nstatic inline void\nbcom_disable_task(int task)\n{\n        u16 reg = in_be16(&bcom_eng->regs->tcr[task]);\n        out_be16(&bcom_eng->regs->tcr[task], reg & ~TASK_ENABLE);\n}\n\n\nstatic inline u32 *\nbcom_task_desc(int task)\n{\n\treturn bcom_sram_pa2va(bcom_eng->tdt[task].start);\n}\n\nstatic inline int\nbcom_task_num_descs(int task)\n{\n\treturn (bcom_eng->tdt[task].stop - bcom_eng->tdt[task].start)/sizeof(u32) + 1;\n}\n\nstatic inline u32 *\nbcom_task_var(int task)\n{\n\treturn bcom_sram_pa2va(bcom_eng->tdt[task].var);\n}\n\nstatic inline u32 *\nbcom_task_inc(int task)\n{\n\treturn &bcom_task_var(task)[BCOM_MAX_VAR];\n}\n\n\nstatic inline int\nbcom_drd_is_extended(u32 desc)\n{\n\treturn (desc) & BCOM_DRD_EXTENDED;\n}\n\nstatic inline int\nbcom_desc_is_drd(u32 desc)\n{\n\treturn !(desc & BCOM_LCD_MASK) && desc != BCOM_DESC_NOP;\n}\n\nstatic inline int\nbcom_desc_initiator(u32 desc)\n{\n\treturn (desc >> BCOM_DRD_INITIATOR_SHIFT) & 0x1f;\n}\n\nstatic inline void\nbcom_set_desc_initiator(u32 *desc, int initiator)\n{\n\t*desc = (*desc & ~(0x1f << BCOM_DRD_INITIATOR_SHIFT)) |\n\t\t\t((initiator & 0x1f) << BCOM_DRD_INITIATOR_SHIFT);\n}\n\n\nstatic inline void\nbcom_set_task_pragma(int task, int pragma)\n{\n\tu32 *fdt = &bcom_eng->tdt[task].fdt;\n\t*fdt = (*fdt & ~0xff) | pragma;\n}\n\nstatic inline void\nbcom_set_task_auto_start(int task, int next_task)\n{\n\tu16 __iomem *tcr = &bcom_eng->regs->tcr[task];\n\tout_be16(tcr, (in_be16(tcr) & ~0xff) | 0x00c0 | next_task);\n}\n\nstatic inline void\nbcom_set_tcr_initiator(int task, int initiator)\n{\n\tu16 __iomem *tcr = &bcom_eng->regs->tcr[task];\n\tout_be16(tcr, (in_be16(tcr) & ~0x1f00) | ((initiator & 0x1f) << 8));\n}\n\n\n#endif  \n\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}