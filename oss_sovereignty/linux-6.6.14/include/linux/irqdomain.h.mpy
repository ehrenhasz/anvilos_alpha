{
  "module_name": "irqdomain.h",
  "hash_id": "5f838d8d4e6bec1a0617808edb0c090024ff017885d5d6498279890e8ef14213",
  "original_prompt": "Ingested from linux-6.6.14/include/linux/irqdomain.h",
  "human_readable_source": " \n \n\n#ifndef _LINUX_IRQDOMAIN_H\n#define _LINUX_IRQDOMAIN_H\n\n#include <linux/types.h>\n#include <linux/irqdomain_defs.h>\n#include <linux/irqhandler.h>\n#include <linux/of.h>\n#include <linux/mutex.h>\n#include <linux/radix-tree.h>\n\nstruct device_node;\nstruct fwnode_handle;\nstruct irq_domain;\nstruct irq_chip;\nstruct irq_data;\nstruct irq_desc;\nstruct cpumask;\nstruct seq_file;\nstruct irq_affinity_desc;\nstruct msi_parent_ops;\n\n#define IRQ_DOMAIN_IRQ_SPEC_PARAMS 16\n\n \nstruct irq_fwspec {\n\tstruct fwnode_handle *fwnode;\n\tint param_count;\n\tu32 param[IRQ_DOMAIN_IRQ_SPEC_PARAMS];\n};\n\n \nvoid of_phandle_args_to_fwspec(struct device_node *np, const u32 *args,\n\t\t\t       unsigned int count, struct irq_fwspec *fwspec);\n\n \nstruct irq_domain_ops {\n\tint (*match)(struct irq_domain *d, struct device_node *node,\n\t\t     enum irq_domain_bus_token bus_token);\n\tint (*select)(struct irq_domain *d, struct irq_fwspec *fwspec,\n\t\t      enum irq_domain_bus_token bus_token);\n\tint (*map)(struct irq_domain *d, unsigned int virq, irq_hw_number_t hw);\n\tvoid (*unmap)(struct irq_domain *d, unsigned int virq);\n\tint (*xlate)(struct irq_domain *d, struct device_node *node,\n\t\t     const u32 *intspec, unsigned int intsize,\n\t\t     unsigned long *out_hwirq, unsigned int *out_type);\n#ifdef\tCONFIG_IRQ_DOMAIN_HIERARCHY\n\t \n\tint (*alloc)(struct irq_domain *d, unsigned int virq,\n\t\t     unsigned int nr_irqs, void *arg);\n\tvoid (*free)(struct irq_domain *d, unsigned int virq,\n\t\t     unsigned int nr_irqs);\n\tint (*activate)(struct irq_domain *d, struct irq_data *irqd, bool reserve);\n\tvoid (*deactivate)(struct irq_domain *d, struct irq_data *irq_data);\n\tint (*translate)(struct irq_domain *d, struct irq_fwspec *fwspec,\n\t\t\t unsigned long *out_hwirq, unsigned int *out_type);\n#endif\n#ifdef CONFIG_GENERIC_IRQ_DEBUGFS\n\tvoid (*debug_show)(struct seq_file *m, struct irq_domain *d,\n\t\t\t   struct irq_data *irqd, int ind);\n#endif\n};\n\nextern const struct irq_domain_ops irq_generic_chip_ops;\n\nstruct irq_domain_chip_generic;\n\n \nstruct irq_domain {\n\tstruct list_head\t\tlink;\n\tconst char\t\t\t*name;\n\tconst struct irq_domain_ops\t*ops;\n\tvoid\t\t\t\t*host_data;\n\tunsigned int\t\t\tflags;\n\tunsigned int\t\t\tmapcount;\n\tstruct mutex\t\t\tmutex;\n\tstruct irq_domain\t\t*root;\n\n\t \n\tstruct fwnode_handle\t\t*fwnode;\n\tenum irq_domain_bus_token\tbus_token;\n\tstruct irq_domain_chip_generic\t*gc;\n\tstruct device\t\t\t*dev;\n\tstruct device\t\t\t*pm_dev;\n#ifdef\tCONFIG_IRQ_DOMAIN_HIERARCHY\n\tstruct irq_domain\t\t*parent;\n#endif\n#ifdef CONFIG_GENERIC_MSI_IRQ\n\tconst struct msi_parent_ops\t*msi_parent_ops;\n#endif\n\n\t \n\tirq_hw_number_t\t\t\thwirq_max;\n\tunsigned int\t\t\trevmap_size;\n\tstruct radix_tree_root\t\trevmap_tree;\n\tstruct irq_data __rcu\t\t*revmap[];\n};\n\n \nenum {\n\t \n\tIRQ_DOMAIN_FLAG_HIERARCHY\t= (1 << 0),\n\n\t \n\tIRQ_DOMAIN_NAME_ALLOCATED\t= (1 << 1),\n\n\t \n\tIRQ_DOMAIN_FLAG_IPI_PER_CPU\t= (1 << 2),\n\n\t \n\tIRQ_DOMAIN_FLAG_IPI_SINGLE\t= (1 << 3),\n\n\t \n\tIRQ_DOMAIN_FLAG_MSI\t\t= (1 << 4),\n\n\t \n\tIRQ_DOMAIN_FLAG_ISOLATED_MSI\t= (1 << 5),\n\n\t \n\tIRQ_DOMAIN_FLAG_NO_MAP\t\t= (1 << 6),\n\n\t \n\tIRQ_DOMAIN_FLAG_MSI_PARENT\t= (1 << 8),\n\n\t \n\tIRQ_DOMAIN_FLAG_MSI_DEVICE\t= (1 << 9),\n\n\t \n\tIRQ_DOMAIN_FLAG_NONCORE\t\t= (1 << 16),\n};\n\nstatic inline struct device_node *irq_domain_get_of_node(struct irq_domain *d)\n{\n\treturn to_of_node(d->fwnode);\n}\n\nstatic inline void irq_domain_set_pm_device(struct irq_domain *d,\n\t\t\t\t\t    struct device *dev)\n{\n\tif (d)\n\t\td->pm_dev = dev;\n}\n\n#ifdef CONFIG_IRQ_DOMAIN\nstruct fwnode_handle *__irq_domain_alloc_fwnode(unsigned int type, int id,\n\t\t\t\t\t\tconst char *name, phys_addr_t *pa);\n\nenum {\n\tIRQCHIP_FWNODE_REAL,\n\tIRQCHIP_FWNODE_NAMED,\n\tIRQCHIP_FWNODE_NAMED_ID,\n};\n\nstatic inline\nstruct fwnode_handle *irq_domain_alloc_named_fwnode(const char *name)\n{\n\treturn __irq_domain_alloc_fwnode(IRQCHIP_FWNODE_NAMED, 0, name, NULL);\n}\n\nstatic inline\nstruct fwnode_handle *irq_domain_alloc_named_id_fwnode(const char *name, int id)\n{\n\treturn __irq_domain_alloc_fwnode(IRQCHIP_FWNODE_NAMED_ID, id, name,\n\t\t\t\t\t NULL);\n}\n\nstatic inline struct fwnode_handle *irq_domain_alloc_fwnode(phys_addr_t *pa)\n{\n\treturn __irq_domain_alloc_fwnode(IRQCHIP_FWNODE_REAL, 0, NULL, pa);\n}\n\nvoid irq_domain_free_fwnode(struct fwnode_handle *fwnode);\nstruct irq_domain *__irq_domain_add(struct fwnode_handle *fwnode, unsigned int size,\n\t\t\t\t    irq_hw_number_t hwirq_max, int direct_max,\n\t\t\t\t    const struct irq_domain_ops *ops,\n\t\t\t\t    void *host_data);\nstruct irq_domain *irq_domain_create_simple(struct fwnode_handle *fwnode,\n\t\t\t\t\t    unsigned int size,\n\t\t\t\t\t    unsigned int first_irq,\n\t\t\t\t\t    const struct irq_domain_ops *ops,\n\t\t\t\t\t    void *host_data);\nstruct irq_domain *irq_domain_add_legacy(struct device_node *of_node,\n\t\t\t\t\t unsigned int size,\n\t\t\t\t\t unsigned int first_irq,\n\t\t\t\t\t irq_hw_number_t first_hwirq,\n\t\t\t\t\t const struct irq_domain_ops *ops,\n\t\t\t\t\t void *host_data);\nstruct irq_domain *irq_domain_create_legacy(struct fwnode_handle *fwnode,\n\t\t\t\t\t    unsigned int size,\n\t\t\t\t\t    unsigned int first_irq,\n\t\t\t\t\t    irq_hw_number_t first_hwirq,\n\t\t\t\t\t    const struct irq_domain_ops *ops,\n\t\t\t\t\t    void *host_data);\nextern struct irq_domain *irq_find_matching_fwspec(struct irq_fwspec *fwspec,\n\t\t\t\t\t\t   enum irq_domain_bus_token bus_token);\nextern void irq_set_default_host(struct irq_domain *host);\nextern struct irq_domain *irq_get_default_host(void);\nextern int irq_domain_alloc_descs(int virq, unsigned int nr_irqs,\n\t\t\t\t  irq_hw_number_t hwirq, int node,\n\t\t\t\t  const struct irq_affinity_desc *affinity);\n\nstatic inline struct fwnode_handle *of_node_to_fwnode(struct device_node *node)\n{\n\treturn node ? &node->fwnode : NULL;\n}\n\nextern const struct fwnode_operations irqchip_fwnode_ops;\n\nstatic inline bool is_fwnode_irqchip(struct fwnode_handle *fwnode)\n{\n\treturn fwnode && fwnode->ops == &irqchip_fwnode_ops;\n}\n\nextern void irq_domain_update_bus_token(struct irq_domain *domain,\n\t\t\t\t\tenum irq_domain_bus_token bus_token);\n\nstatic inline\nstruct irq_domain *irq_find_matching_fwnode(struct fwnode_handle *fwnode,\n\t\t\t\t\t    enum irq_domain_bus_token bus_token)\n{\n\tstruct irq_fwspec fwspec = {\n\t\t.fwnode = fwnode,\n\t};\n\n\treturn irq_find_matching_fwspec(&fwspec, bus_token);\n}\n\nstatic inline struct irq_domain *irq_find_matching_host(struct device_node *node,\n\t\t\t\t\t\t\tenum irq_domain_bus_token bus_token)\n{\n\treturn irq_find_matching_fwnode(of_node_to_fwnode(node), bus_token);\n}\n\nstatic inline struct irq_domain *irq_find_host(struct device_node *node)\n{\n\tstruct irq_domain *d;\n\n\td = irq_find_matching_host(node, DOMAIN_BUS_WIRED);\n\tif (!d)\n\t\td = irq_find_matching_host(node, DOMAIN_BUS_ANY);\n\n\treturn d;\n}\n\nstatic inline struct irq_domain *irq_domain_add_simple(struct device_node *of_node,\n\t\t\t\t\t\t       unsigned int size,\n\t\t\t\t\t\t       unsigned int first_irq,\n\t\t\t\t\t\t       const struct irq_domain_ops *ops,\n\t\t\t\t\t\t       void *host_data)\n{\n\treturn irq_domain_create_simple(of_node_to_fwnode(of_node), size, first_irq, ops, host_data);\n}\n\n \nstatic inline struct irq_domain *irq_domain_add_linear(struct device_node *of_node,\n\t\t\t\t\t unsigned int size,\n\t\t\t\t\t const struct irq_domain_ops *ops,\n\t\t\t\t\t void *host_data)\n{\n\treturn __irq_domain_add(of_node_to_fwnode(of_node), size, size, 0, ops, host_data);\n}\n\n#ifdef CONFIG_IRQ_DOMAIN_NOMAP\nstatic inline struct irq_domain *irq_domain_add_nomap(struct device_node *of_node,\n\t\t\t\t\t unsigned int max_irq,\n\t\t\t\t\t const struct irq_domain_ops *ops,\n\t\t\t\t\t void *host_data)\n{\n\treturn __irq_domain_add(of_node_to_fwnode(of_node), 0, max_irq, max_irq, ops, host_data);\n}\n\nextern unsigned int irq_create_direct_mapping(struct irq_domain *host);\n#endif\n\nstatic inline struct irq_domain *irq_domain_add_tree(struct device_node *of_node,\n\t\t\t\t\t const struct irq_domain_ops *ops,\n\t\t\t\t\t void *host_data)\n{\n\treturn __irq_domain_add(of_node_to_fwnode(of_node), 0, ~0, 0, ops, host_data);\n}\n\nstatic inline struct irq_domain *irq_domain_create_linear(struct fwnode_handle *fwnode,\n\t\t\t\t\t unsigned int size,\n\t\t\t\t\t const struct irq_domain_ops *ops,\n\t\t\t\t\t void *host_data)\n{\n\treturn __irq_domain_add(fwnode, size, size, 0, ops, host_data);\n}\n\nstatic inline struct irq_domain *irq_domain_create_tree(struct fwnode_handle *fwnode,\n\t\t\t\t\t const struct irq_domain_ops *ops,\n\t\t\t\t\t void *host_data)\n{\n\treturn __irq_domain_add(fwnode, 0, ~0, 0, ops, host_data);\n}\n\nextern void irq_domain_remove(struct irq_domain *host);\n\nextern int irq_domain_associate(struct irq_domain *domain, unsigned int irq,\n\t\t\t\t\tirq_hw_number_t hwirq);\nextern void irq_domain_associate_many(struct irq_domain *domain,\n\t\t\t\t      unsigned int irq_base,\n\t\t\t\t      irq_hw_number_t hwirq_base, int count);\n\nextern unsigned int irq_create_mapping_affinity(struct irq_domain *host,\n\t\t\t\t      irq_hw_number_t hwirq,\n\t\t\t\t      const struct irq_affinity_desc *affinity);\nextern unsigned int irq_create_fwspec_mapping(struct irq_fwspec *fwspec);\nextern void irq_dispose_mapping(unsigned int virq);\n\nstatic inline unsigned int irq_create_mapping(struct irq_domain *host,\n\t\t\t\t\t      irq_hw_number_t hwirq)\n{\n\treturn irq_create_mapping_affinity(host, hwirq, NULL);\n}\n\nextern struct irq_desc *__irq_resolve_mapping(struct irq_domain *domain,\n\t\t\t\t\t      irq_hw_number_t hwirq,\n\t\t\t\t\t      unsigned int *irq);\n\nstatic inline struct irq_desc *irq_resolve_mapping(struct irq_domain *domain,\n\t\t\t\t\t\t   irq_hw_number_t hwirq)\n{\n\treturn __irq_resolve_mapping(domain, hwirq, NULL);\n}\n\n \nstatic inline unsigned int irq_find_mapping(struct irq_domain *domain,\n\t\t\t\t\t    irq_hw_number_t hwirq)\n{\n\tunsigned int irq;\n\n\tif (__irq_resolve_mapping(domain, hwirq, &irq))\n\t\treturn irq;\n\n\treturn 0;\n}\n\nstatic inline unsigned int irq_linear_revmap(struct irq_domain *domain,\n\t\t\t\t\t     irq_hw_number_t hwirq)\n{\n\treturn irq_find_mapping(domain, hwirq);\n}\n\nextern const struct irq_domain_ops irq_domain_simple_ops;\n\n \nint irq_domain_xlate_onecell(struct irq_domain *d, struct device_node *ctrlr,\n\t\t\tconst u32 *intspec, unsigned int intsize,\n\t\t\tirq_hw_number_t *out_hwirq, unsigned int *out_type);\nint irq_domain_xlate_twocell(struct irq_domain *d, struct device_node *ctrlr,\n\t\t\tconst u32 *intspec, unsigned int intsize,\n\t\t\tirq_hw_number_t *out_hwirq, unsigned int *out_type);\nint irq_domain_xlate_onetwocell(struct irq_domain *d, struct device_node *ctrlr,\n\t\t\tconst u32 *intspec, unsigned int intsize,\n\t\t\tirq_hw_number_t *out_hwirq, unsigned int *out_type);\n\nint irq_domain_translate_twocell(struct irq_domain *d,\n\t\t\t\t struct irq_fwspec *fwspec,\n\t\t\t\t unsigned long *out_hwirq,\n\t\t\t\t unsigned int *out_type);\n\nint irq_domain_translate_onecell(struct irq_domain *d,\n\t\t\t\t struct irq_fwspec *fwspec,\n\t\t\t\t unsigned long *out_hwirq,\n\t\t\t\t unsigned int *out_type);\n\n \nint irq_reserve_ipi(struct irq_domain *domain, const struct cpumask *dest);\nint irq_destroy_ipi(unsigned int irq, const struct cpumask *dest);\n\n \nextern struct irq_data *irq_domain_get_irq_data(struct irq_domain *domain,\n\t\t\t\t\t\tunsigned int virq);\nextern void irq_domain_set_info(struct irq_domain *domain, unsigned int virq,\n\t\t\t\tirq_hw_number_t hwirq,\n\t\t\t\tconst struct irq_chip *chip,\n\t\t\t\tvoid *chip_data, irq_flow_handler_t handler,\n\t\t\t\tvoid *handler_data, const char *handler_name);\nextern void irq_domain_reset_irq_data(struct irq_data *irq_data);\n#ifdef\tCONFIG_IRQ_DOMAIN_HIERARCHY\nextern struct irq_domain *irq_domain_create_hierarchy(struct irq_domain *parent,\n\t\t\tunsigned int flags, unsigned int size,\n\t\t\tstruct fwnode_handle *fwnode,\n\t\t\tconst struct irq_domain_ops *ops, void *host_data);\n\nstatic inline struct irq_domain *irq_domain_add_hierarchy(struct irq_domain *parent,\n\t\t\t\t\t    unsigned int flags,\n\t\t\t\t\t    unsigned int size,\n\t\t\t\t\t    struct device_node *node,\n\t\t\t\t\t    const struct irq_domain_ops *ops,\n\t\t\t\t\t    void *host_data)\n{\n\treturn irq_domain_create_hierarchy(parent, flags, size,\n\t\t\t\t\t   of_node_to_fwnode(node),\n\t\t\t\t\t   ops, host_data);\n}\n\nextern int __irq_domain_alloc_irqs(struct irq_domain *domain, int irq_base,\n\t\t\t\t   unsigned int nr_irqs, int node, void *arg,\n\t\t\t\t   bool realloc,\n\t\t\t\t   const struct irq_affinity_desc *affinity);\nextern void irq_domain_free_irqs(unsigned int virq, unsigned int nr_irqs);\nextern int irq_domain_activate_irq(struct irq_data *irq_data, bool early);\nextern void irq_domain_deactivate_irq(struct irq_data *irq_data);\n\nstatic inline int irq_domain_alloc_irqs(struct irq_domain *domain,\n\t\t\tunsigned int nr_irqs, int node, void *arg)\n{\n\treturn __irq_domain_alloc_irqs(domain, -1, nr_irqs, node, arg, false,\n\t\t\t\t       NULL);\n}\n\nextern int irq_domain_alloc_irqs_hierarchy(struct irq_domain *domain,\n\t\t\t\t\t   unsigned int irq_base,\n\t\t\t\t\t   unsigned int nr_irqs, void *arg);\nextern int irq_domain_set_hwirq_and_chip(struct irq_domain *domain,\n\t\t\t\t\t unsigned int virq,\n\t\t\t\t\t irq_hw_number_t hwirq,\n\t\t\t\t\t const struct irq_chip *chip,\n\t\t\t\t\t void *chip_data);\nextern void irq_domain_free_irqs_common(struct irq_domain *domain,\n\t\t\t\t\tunsigned int virq,\n\t\t\t\t\tunsigned int nr_irqs);\nextern void irq_domain_free_irqs_top(struct irq_domain *domain,\n\t\t\t\t     unsigned int virq, unsigned int nr_irqs);\n\nextern int irq_domain_push_irq(struct irq_domain *domain, int virq, void *arg);\nextern int irq_domain_pop_irq(struct irq_domain *domain, int virq);\n\nextern int irq_domain_alloc_irqs_parent(struct irq_domain *domain,\n\t\t\t\t\tunsigned int irq_base,\n\t\t\t\t\tunsigned int nr_irqs, void *arg);\n\nextern void irq_domain_free_irqs_parent(struct irq_domain *domain,\n\t\t\t\t\tunsigned int irq_base,\n\t\t\t\t\tunsigned int nr_irqs);\n\nextern int irq_domain_disconnect_hierarchy(struct irq_domain *domain,\n\t\t\t\t\t   unsigned int virq);\n\nstatic inline bool irq_domain_is_hierarchy(struct irq_domain *domain)\n{\n\treturn domain->flags & IRQ_DOMAIN_FLAG_HIERARCHY;\n}\n\nstatic inline bool irq_domain_is_ipi(struct irq_domain *domain)\n{\n\treturn domain->flags &\n\t\t(IRQ_DOMAIN_FLAG_IPI_PER_CPU | IRQ_DOMAIN_FLAG_IPI_SINGLE);\n}\n\nstatic inline bool irq_domain_is_ipi_per_cpu(struct irq_domain *domain)\n{\n\treturn domain->flags & IRQ_DOMAIN_FLAG_IPI_PER_CPU;\n}\n\nstatic inline bool irq_domain_is_ipi_single(struct irq_domain *domain)\n{\n\treturn domain->flags & IRQ_DOMAIN_FLAG_IPI_SINGLE;\n}\n\nstatic inline bool irq_domain_is_msi(struct irq_domain *domain)\n{\n\treturn domain->flags & IRQ_DOMAIN_FLAG_MSI;\n}\n\nstatic inline bool irq_domain_is_msi_parent(struct irq_domain *domain)\n{\n\treturn domain->flags & IRQ_DOMAIN_FLAG_MSI_PARENT;\n}\n\nstatic inline bool irq_domain_is_msi_device(struct irq_domain *domain)\n{\n\treturn domain->flags & IRQ_DOMAIN_FLAG_MSI_DEVICE;\n}\n\n#else\t \nstatic inline int irq_domain_alloc_irqs(struct irq_domain *domain,\n\t\t\tunsigned int nr_irqs, int node, void *arg)\n{\n\treturn -1;\n}\n\nstatic inline void irq_domain_free_irqs(unsigned int virq,\n\t\t\t\t\tunsigned int nr_irqs) { }\n\nstatic inline bool irq_domain_is_hierarchy(struct irq_domain *domain)\n{\n\treturn false;\n}\n\nstatic inline bool irq_domain_is_ipi(struct irq_domain *domain)\n{\n\treturn false;\n}\n\nstatic inline bool irq_domain_is_ipi_per_cpu(struct irq_domain *domain)\n{\n\treturn false;\n}\n\nstatic inline bool irq_domain_is_ipi_single(struct irq_domain *domain)\n{\n\treturn false;\n}\n\nstatic inline bool irq_domain_is_msi(struct irq_domain *domain)\n{\n\treturn false;\n}\n\nstatic inline bool irq_domain_is_msi_parent(struct irq_domain *domain)\n{\n\treturn false;\n}\n\nstatic inline bool irq_domain_is_msi_device(struct irq_domain *domain)\n{\n\treturn false;\n}\n\n#endif\t \n\n#else  \nstatic inline void irq_dispose_mapping(unsigned int virq) { }\nstatic inline struct irq_domain *irq_find_matching_fwnode(\n\tstruct fwnode_handle *fwnode, enum irq_domain_bus_token bus_token)\n{\n\treturn NULL;\n}\n#endif  \n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}