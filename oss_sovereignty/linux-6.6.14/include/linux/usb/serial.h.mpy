{
  "module_name": "serial.h",
  "hash_id": "f295a08466fd21905cb3a3a50f98e60eb2104d2fda1f22d29d825d91d0ddda06",
  "original_prompt": "Ingested from linux-6.6.14/include/linux/usb/serial.h",
  "human_readable_source": "\n \n\n#ifndef __LINUX_USB_SERIAL_H\n#define __LINUX_USB_SERIAL_H\n\n#include <linux/kref.h>\n#include <linux/mutex.h>\n#include <linux/serial.h>\n#include <linux/kfifo.h>\n\n \n#define MAX_NUM_PORTS\t\t16\n\n \n#define USB_SERIAL_WRITE_BUSY\t0\n#define USB_SERIAL_THROTTLED\t1\n\n \nstruct usb_serial_port {\n\tstruct usb_serial\t*serial;\n\tstruct tty_port\t\tport;\n\tspinlock_t\t\tlock;\n\tu32\t\t\tminor;\n\tu8\t\t\tport_number;\n\n\tunsigned char\t\t*interrupt_in_buffer;\n\tstruct urb\t\t*interrupt_in_urb;\n\t__u8\t\t\tinterrupt_in_endpointAddress;\n\n\tunsigned char\t\t*interrupt_out_buffer;\n\tint\t\t\tinterrupt_out_size;\n\tstruct urb\t\t*interrupt_out_urb;\n\t__u8\t\t\tinterrupt_out_endpointAddress;\n\n\tunsigned char\t\t*bulk_in_buffer;\n\tint\t\t\tbulk_in_size;\n\tstruct urb\t\t*read_urb;\n\t__u8\t\t\tbulk_in_endpointAddress;\n\n\tunsigned char\t\t*bulk_in_buffers[2];\n\tstruct urb\t\t*read_urbs[2];\n\tunsigned long\t\tread_urbs_free;\n\n\tunsigned char\t\t*bulk_out_buffer;\n\tint\t\t\tbulk_out_size;\n\tstruct urb\t\t*write_urb;\n\tstruct kfifo\t\twrite_fifo;\n\n\tunsigned char\t\t*bulk_out_buffers[2];\n\tstruct urb\t\t*write_urbs[2];\n\tunsigned long\t\twrite_urbs_free;\n\t__u8\t\t\tbulk_out_endpointAddress;\n\n\tstruct async_icount\ticount;\n\tint\t\t\ttx_bytes;\n\n\tunsigned long\t\tflags;\n\tstruct work_struct\twork;\n\tunsigned long\t\tsysrq;  \n\tstruct device\t\tdev;\n};\n#define to_usb_serial_port(d) container_of(d, struct usb_serial_port, dev)\n\n \nstatic inline void *usb_get_serial_port_data(struct usb_serial_port *port)\n{\n\treturn dev_get_drvdata(&port->dev);\n}\n\nstatic inline void usb_set_serial_port_data(struct usb_serial_port *port,\n\t\t\t\t\t    void *data)\n{\n\tdev_set_drvdata(&port->dev, data);\n}\n\n \nstruct usb_serial {\n\tstruct usb_device\t\t*dev;\n\tstruct usb_serial_driver\t*type;\n\tstruct usb_interface\t\t*interface;\n\tstruct usb_interface\t\t*sibling;\n\tunsigned int\t\t\tsuspend_count;\n\tunsigned char\t\t\tdisconnected:1;\n\tunsigned char\t\t\tattached:1;\n\tunsigned char\t\t\tminors_reserved:1;\n\tunsigned char\t\t\tnum_ports;\n\tunsigned char\t\t\tnum_port_pointers;\n\tunsigned char\t\t\tnum_interrupt_in;\n\tunsigned char\t\t\tnum_interrupt_out;\n\tunsigned char\t\t\tnum_bulk_in;\n\tunsigned char\t\t\tnum_bulk_out;\n\tstruct usb_serial_port\t\t*port[MAX_NUM_PORTS];\n\tstruct kref\t\t\tkref;\n\tstruct mutex\t\t\tdisc_mutex;\n\tvoid\t\t\t\t*private;\n};\n#define to_usb_serial(d) container_of(d, struct usb_serial, kref)\n\n \nstatic inline void *usb_get_serial_data(struct usb_serial *serial)\n{\n\treturn serial->private;\n}\n\nstatic inline void usb_set_serial_data(struct usb_serial *serial, void *data)\n{\n\tserial->private = data;\n}\n\nstruct usb_serial_endpoints {\n\tunsigned char num_bulk_in;\n\tunsigned char num_bulk_out;\n\tunsigned char num_interrupt_in;\n\tunsigned char num_interrupt_out;\n\tstruct usb_endpoint_descriptor *bulk_in[MAX_NUM_PORTS];\n\tstruct usb_endpoint_descriptor *bulk_out[MAX_NUM_PORTS];\n\tstruct usb_endpoint_descriptor *interrupt_in[MAX_NUM_PORTS];\n\tstruct usb_endpoint_descriptor *interrupt_out[MAX_NUM_PORTS];\n};\n\n \nstruct usb_serial_driver {\n\tconst char *description;\n\tconst struct usb_device_id *id_table;\n\n\tstruct list_head\tdriver_list;\n\tstruct device_driver\tdriver;\n\tstruct usb_driver\t*usb_driver;\n\tstruct usb_dynids\tdynids;\n\n\tunsigned char\t\tnum_ports;\n\n\tunsigned char\t\tnum_bulk_in;\n\tunsigned char\t\tnum_bulk_out;\n\tunsigned char\t\tnum_interrupt_in;\n\tunsigned char\t\tnum_interrupt_out;\n\n\tsize_t\t\t\tbulk_in_size;\n\tsize_t\t\t\tbulk_out_size;\n\n\tint (*probe)(struct usb_serial *serial, const struct usb_device_id *id);\n\tint (*attach)(struct usb_serial *serial);\n\tint (*calc_num_ports)(struct usb_serial *serial,\n\t\t\tstruct usb_serial_endpoints *epds);\n\n\tvoid (*disconnect)(struct usb_serial *serial);\n\tvoid (*release)(struct usb_serial *serial);\n\n\tint (*port_probe)(struct usb_serial_port *port);\n\tvoid (*port_remove)(struct usb_serial_port *port);\n\n\tint (*suspend)(struct usb_serial *serial, pm_message_t message);\n\tint (*resume)(struct usb_serial *serial);\n\tint (*reset_resume)(struct usb_serial *serial);\n\n\t \n\t \n\tint  (*open)(struct tty_struct *tty, struct usb_serial_port *port);\n\tvoid (*close)(struct usb_serial_port *port);\n\tint  (*write)(struct tty_struct *tty, struct usb_serial_port *port,\n\t\t\tconst unsigned char *buf, int count);\n\t \n\tunsigned int (*write_room)(struct tty_struct *tty);\n\tint  (*ioctl)(struct tty_struct *tty,\n\t\t      unsigned int cmd, unsigned long arg);\n\tvoid (*get_serial)(struct tty_struct *tty, struct serial_struct *ss);\n\tint  (*set_serial)(struct tty_struct *tty, struct serial_struct *ss);\n\tvoid (*set_termios)(struct tty_struct *tty, struct usb_serial_port *port,\n\t\t\t    const struct ktermios *old);\n\tint (*break_ctl)(struct tty_struct *tty, int break_state);\n\tunsigned int (*chars_in_buffer)(struct tty_struct *tty);\n\tvoid (*wait_until_sent)(struct tty_struct *tty, long timeout);\n\tbool (*tx_empty)(struct usb_serial_port *port);\n\tvoid (*throttle)(struct tty_struct *tty);\n\tvoid (*unthrottle)(struct tty_struct *tty);\n\tint  (*tiocmget)(struct tty_struct *tty);\n\tint  (*tiocmset)(struct tty_struct *tty,\n\t\t\t unsigned int set, unsigned int clear);\n\tint  (*tiocmiwait)(struct tty_struct *tty, unsigned long arg);\n\tint  (*get_icount)(struct tty_struct *tty,\n\t\t\tstruct serial_icounter_struct *icount);\n\t \n\tvoid (*dtr_rts)(struct usb_serial_port *port, int on);\n\tint  (*carrier_raised)(struct usb_serial_port *port);\n\t \n\tvoid (*init_termios)(struct tty_struct *tty);\n\t \n\tvoid (*read_int_callback)(struct urb *urb);\n\tvoid (*write_int_callback)(struct urb *urb);\n\tvoid (*read_bulk_callback)(struct urb *urb);\n\tvoid (*write_bulk_callback)(struct urb *urb);\n\t \n\tvoid (*process_read_urb)(struct urb *urb);\n\t \n\tint (*prepare_write_buffer)(struct usb_serial_port *port,\n\t\t\t\t\t\tvoid *dest, size_t size);\n};\n#define to_usb_serial_driver(d) \\\n\tcontainer_of(d, struct usb_serial_driver, driver)\n\nint usb_serial_register_drivers(struct usb_serial_driver *const serial_drivers[],\n\t\tconst char *name, const struct usb_device_id *id_table);\nvoid usb_serial_deregister_drivers(struct usb_serial_driver *const serial_drivers[]);\nvoid usb_serial_port_softint(struct usb_serial_port *port);\n\nint usb_serial_suspend(struct usb_interface *intf, pm_message_t message);\nint usb_serial_resume(struct usb_interface *intf);\n\n \n#ifdef CONFIG_USB_SERIAL_CONSOLE\nvoid usb_serial_console_init(int minor);\nvoid usb_serial_console_exit(void);\nvoid usb_serial_console_disconnect(struct usb_serial *serial);\n#else\nstatic inline void usb_serial_console_init(int minor) { }\nstatic inline void usb_serial_console_exit(void) { }\nstatic inline void usb_serial_console_disconnect(struct usb_serial *serial) {}\n#endif\n\n \nstruct usb_serial_port *usb_serial_port_get_by_minor(unsigned int minor);\nvoid usb_serial_put(struct usb_serial *serial);\n\nint usb_serial_claim_interface(struct usb_serial *serial, struct usb_interface *intf);\n\nint usb_serial_generic_open(struct tty_struct *tty, struct usb_serial_port *port);\nint usb_serial_generic_write_start(struct usb_serial_port *port, gfp_t mem_flags);\nint usb_serial_generic_write(struct tty_struct *tty, struct usb_serial_port *port,\n\t\tconst unsigned char *buf, int count);\nvoid usb_serial_generic_close(struct usb_serial_port *port);\nint usb_serial_generic_resume(struct usb_serial *serial);\nunsigned int usb_serial_generic_write_room(struct tty_struct *tty);\nunsigned int usb_serial_generic_chars_in_buffer(struct tty_struct *tty);\nvoid usb_serial_generic_wait_until_sent(struct tty_struct *tty, long timeout);\nvoid usb_serial_generic_read_bulk_callback(struct urb *urb);\nvoid usb_serial_generic_write_bulk_callback(struct urb *urb);\nvoid usb_serial_generic_throttle(struct tty_struct *tty);\nvoid usb_serial_generic_unthrottle(struct tty_struct *tty);\nint usb_serial_generic_tiocmiwait(struct tty_struct *tty, unsigned long arg);\nint usb_serial_generic_get_icount(struct tty_struct *tty, struct serial_icounter_struct *icount);\nint usb_serial_generic_register(void);\nvoid usb_serial_generic_deregister(void);\nint usb_serial_generic_submit_read_urbs(struct usb_serial_port *port, gfp_t mem_flags);\nvoid usb_serial_generic_process_read_urb(struct urb *urb);\nint usb_serial_generic_prepare_write_buffer(struct usb_serial_port *port, void *dest, size_t size);\n\n#if defined(CONFIG_USB_SERIAL_CONSOLE) && defined(CONFIG_MAGIC_SYSRQ)\nint usb_serial_handle_sysrq_char(struct usb_serial_port *port, unsigned int ch);\nint usb_serial_handle_break(struct usb_serial_port *port);\n#else\nstatic inline int usb_serial_handle_sysrq_char(struct usb_serial_port *port, unsigned int ch)\n{\n\treturn 0;\n}\nstatic inline int usb_serial_handle_break(struct usb_serial_port *port)\n{\n\treturn 0;\n}\n#endif\n\nvoid usb_serial_handle_dcd_change(struct usb_serial_port *usb_port,\n\t\tstruct tty_struct *tty, unsigned int status);\n\n\nint usb_serial_bus_register(struct usb_serial_driver *device);\nvoid usb_serial_bus_deregister(struct usb_serial_driver *device);\n\nextern const struct bus_type usb_serial_bus_type;\nextern struct tty_driver *usb_serial_tty_driver;\n\nstatic inline void usb_serial_debug_data(struct device *dev,\n\t\t\t\t\t const char *function, int size,\n\t\t\t\t\t const unsigned char *data)\n{\n\tdev_dbg(dev, \"%s - length = %d, data = %*ph\\n\",\n\t\tfunction, size, size, data);\n}\n\n \n#define dev_err_console(usport, fmt, ...)\t\t\t\t\\\ndo {\t\t\t\t\t\t\t\t\t\\\n\tstatic bool __print_once;\t\t\t\t\t\\\n\tstruct usb_serial_port *__port = (usport);\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\tif (!__port->port.console || !__print_once) {\t\t\t\\\n\t\t__print_once = true;\t\t\t\t\t\\\n\t\tdev_err(&__port->dev, fmt, ##__VA_ARGS__);\t\t\\\n\t}\t\t\t\t\t\t\t\t\\\n} while (0)\n\n \n#define usb_serial_module_driver(__name, __serial_drivers, __ids)\t\\\nstatic int __init usb_serial_module_init(void)\t\t\t\t\\\n{\t\t\t\t\t\t\t\t\t\\\n\treturn usb_serial_register_drivers(__serial_drivers,\t\t\\\n\t\t\t\t\t   __name, __ids);\t\t\\\n}\t\t\t\t\t\t\t\t\t\\\nmodule_init(usb_serial_module_init);\t\t\t\t\t\\\nstatic void __exit usb_serial_module_exit(void)\t\t\t\t\\\n{\t\t\t\t\t\t\t\t\t\\\n\tusb_serial_deregister_drivers(__serial_drivers);\t\t\\\n}\t\t\t\t\t\t\t\t\t\\\nmodule_exit(usb_serial_module_exit);\n\n#define module_usb_serial_driver(__serial_drivers, __ids)\t\t\\\n\tusb_serial_module_driver(KBUILD_MODNAME, __serial_drivers, __ids)\n\n#endif  \n\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}