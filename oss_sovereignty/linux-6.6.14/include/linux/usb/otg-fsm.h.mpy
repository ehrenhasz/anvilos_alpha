{
  "module_name": "otg-fsm.h",
  "hash_id": "dfc4454e1295372fe7284f034a1f7073e483f926f0a009ed243ba1eb52d72ac4",
  "original_prompt": "Ingested from linux-6.6.14/include/linux/usb/otg-fsm.h",
  "human_readable_source": "\n \n\n#ifndef __LINUX_USB_OTG_FSM_H\n#define __LINUX_USB_OTG_FSM_H\n\n#include <linux/mutex.h>\n#include <linux/errno.h>\n\n#define PROTO_UNDEF\t(0)\n#define PROTO_HOST\t(1)\n#define PROTO_GADGET\t(2)\n\n#define OTG_STS_SELECTOR\t0xF000\t \n\n#define HOST_REQUEST_FLAG\t1\t \n\n#define T_HOST_REQ_POLL\t\t(1500)\t \n\nenum otg_fsm_timer {\n\t \n\tA_WAIT_VRISE,\n\tA_WAIT_VFALL,\n\tA_WAIT_BCON,\n\tA_AIDL_BDIS,\n\tB_ASE0_BRST,\n\tA_BIDL_ADIS,\n\tB_AIDL_BDIS,\n\n\t \n\tB_SE0_SRP,\n\tB_SRP_FAIL,\n\tA_WAIT_ENUM,\n\tB_DATA_PLS,\n\tB_SSEND_SRP,\n\n\tNUM_OTG_FSM_TIMERS,\n};\n\n \nstruct otg_fsm {\n\t \n\tint id;\n\tint adp_change;\n\tint power_up;\n\tint a_srp_det;\n\tint a_vbus_vld;\n\tint b_conn;\n\tint a_bus_resume;\n\tint a_bus_suspend;\n\tint a_conn;\n\tint b_se0_srp;\n\tint b_ssend_srp;\n\tint b_sess_vld;\n\tint test_device;\n\tint a_bus_drop;\n\tint a_bus_req;\n\tint b_bus_req;\n\n\t \n\tint a_sess_vld;\n\tint b_bus_resume;\n\tint b_bus_suspend;\n\n\t \n\tint drv_vbus;\n\tint loc_conn;\n\tint loc_sof;\n\tint adp_prb;\n\tint adp_sns;\n\tint data_pulse;\n\n\t \n\tint a_set_b_hnp_en;\n\tint b_srp_done;\n\tint b_hnp_enable;\n\tint a_clr_err;\n\n\t \n\tint a_bus_drop_inf;\n\tint a_bus_req_inf;\n\tint a_clr_err_inf;\n\tint b_bus_req_inf;\n\t \n\tint a_suspend_req_inf;\n\n\t \n\tint a_wait_vrise_tmout;\n\tint a_wait_vfall_tmout;\n\tint a_wait_bcon_tmout;\n\tint a_aidl_bdis_tmout;\n\tint b_ase0_brst_tmout;\n\tint a_bidl_adis_tmout;\n\n\tstruct otg_fsm_ops *ops;\n\tstruct usb_otg *otg;\n\n\t \n\tint protocol;\n\tstruct mutex lock;\n\tu8 *host_req_flag;\n\tstruct delayed_work hnp_polling_work;\n\tbool hnp_work_inited;\n\tbool state_changed;\n};\n\nstruct otg_fsm_ops {\n\tvoid\t(*chrg_vbus)(struct otg_fsm *fsm, int on);\n\tvoid\t(*drv_vbus)(struct otg_fsm *fsm, int on);\n\tvoid\t(*loc_conn)(struct otg_fsm *fsm, int on);\n\tvoid\t(*loc_sof)(struct otg_fsm *fsm, int on);\n\tvoid\t(*start_pulse)(struct otg_fsm *fsm);\n\tvoid\t(*start_adp_prb)(struct otg_fsm *fsm);\n\tvoid\t(*start_adp_sns)(struct otg_fsm *fsm);\n\tvoid\t(*add_timer)(struct otg_fsm *fsm, enum otg_fsm_timer timer);\n\tvoid\t(*del_timer)(struct otg_fsm *fsm, enum otg_fsm_timer timer);\n\tint\t(*start_host)(struct otg_fsm *fsm, int on);\n\tint\t(*start_gadget)(struct otg_fsm *fsm, int on);\n};\n\n\nstatic inline int otg_chrg_vbus(struct otg_fsm *fsm, int on)\n{\n\tif (!fsm->ops->chrg_vbus)\n\t\treturn -EOPNOTSUPP;\n\tfsm->ops->chrg_vbus(fsm, on);\n\treturn 0;\n}\n\nstatic inline int otg_drv_vbus(struct otg_fsm *fsm, int on)\n{\n\tif (!fsm->ops->drv_vbus)\n\t\treturn -EOPNOTSUPP;\n\tif (fsm->drv_vbus != on) {\n\t\tfsm->drv_vbus = on;\n\t\tfsm->ops->drv_vbus(fsm, on);\n\t}\n\treturn 0;\n}\n\nstatic inline int otg_loc_conn(struct otg_fsm *fsm, int on)\n{\n\tif (!fsm->ops->loc_conn)\n\t\treturn -EOPNOTSUPP;\n\tif (fsm->loc_conn != on) {\n\t\tfsm->loc_conn = on;\n\t\tfsm->ops->loc_conn(fsm, on);\n\t}\n\treturn 0;\n}\n\nstatic inline int otg_loc_sof(struct otg_fsm *fsm, int on)\n{\n\tif (!fsm->ops->loc_sof)\n\t\treturn -EOPNOTSUPP;\n\tif (fsm->loc_sof != on) {\n\t\tfsm->loc_sof = on;\n\t\tfsm->ops->loc_sof(fsm, on);\n\t}\n\treturn 0;\n}\n\nstatic inline int otg_start_pulse(struct otg_fsm *fsm)\n{\n\tif (!fsm->ops->start_pulse)\n\t\treturn -EOPNOTSUPP;\n\tif (!fsm->data_pulse) {\n\t\tfsm->data_pulse = 1;\n\t\tfsm->ops->start_pulse(fsm);\n\t}\n\treturn 0;\n}\n\nstatic inline int otg_start_adp_prb(struct otg_fsm *fsm)\n{\n\tif (!fsm->ops->start_adp_prb)\n\t\treturn -EOPNOTSUPP;\n\tif (!fsm->adp_prb) {\n\t\tfsm->adp_sns = 0;\n\t\tfsm->adp_prb = 1;\n\t\tfsm->ops->start_adp_prb(fsm);\n\t}\n\treturn 0;\n}\n\nstatic inline int otg_start_adp_sns(struct otg_fsm *fsm)\n{\n\tif (!fsm->ops->start_adp_sns)\n\t\treturn -EOPNOTSUPP;\n\tif (!fsm->adp_sns) {\n\t\tfsm->adp_sns = 1;\n\t\tfsm->ops->start_adp_sns(fsm);\n\t}\n\treturn 0;\n}\n\nstatic inline int otg_add_timer(struct otg_fsm *fsm, enum otg_fsm_timer timer)\n{\n\tif (!fsm->ops->add_timer)\n\t\treturn -EOPNOTSUPP;\n\tfsm->ops->add_timer(fsm, timer);\n\treturn 0;\n}\n\nstatic inline int otg_del_timer(struct otg_fsm *fsm, enum otg_fsm_timer timer)\n{\n\tif (!fsm->ops->del_timer)\n\t\treturn -EOPNOTSUPP;\n\tfsm->ops->del_timer(fsm, timer);\n\treturn 0;\n}\n\nstatic inline int otg_start_host(struct otg_fsm *fsm, int on)\n{\n\tif (!fsm->ops->start_host)\n\t\treturn -EOPNOTSUPP;\n\treturn fsm->ops->start_host(fsm, on);\n}\n\nstatic inline int otg_start_gadget(struct otg_fsm *fsm, int on)\n{\n\tif (!fsm->ops->start_gadget)\n\t\treturn -EOPNOTSUPP;\n\treturn fsm->ops->start_gadget(fsm, on);\n}\n\nint otg_statemachine(struct otg_fsm *fsm);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}