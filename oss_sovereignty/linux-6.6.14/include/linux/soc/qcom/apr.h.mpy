{
  "module_name": "apr.h",
  "hash_id": "39606318573393a7d474c4348bee6b58dbc5d0da9d8609461b97cace0f2ecf6f",
  "original_prompt": "Ingested from linux-6.6.14/include/linux/soc/qcom/apr.h",
  "human_readable_source": " \n\n#ifndef __QCOM_APR_H_\n#define __QCOM_APR_H_\n\n#include <linux/spinlock.h>\n#include <linux/device.h>\n#include <linux/mod_devicetable.h>\n#include <dt-bindings/soc/qcom,apr.h>\n#include <dt-bindings/soc/qcom,gpr.h>\n\nextern struct bus_type aprbus;\n\n#define APR_HDR_LEN(hdr_len) ((hdr_len)/4)\n\n \n#define APR_HDR_FIELD(msg_type, hdr_len, ver)\\\n\t(((msg_type & 0x3) << 8) | ((hdr_len & 0xF) << 4) | (ver & 0xF))\n\n#define APR_HDR_SIZE sizeof(struct apr_hdr)\n#define APR_SEQ_CMD_HDR_FIELD APR_HDR_FIELD(APR_MSG_TYPE_SEQ_CMD, \\\n\t\t\t\t\t    APR_HDR_LEN(APR_HDR_SIZE), \\\n\t\t\t\t\t    APR_PKT_VER)\n \n#define APR_PKT_VER\t\t0x0\n\n \n#define APR_MSG_TYPE_EVENT\t0x0\n#define APR_MSG_TYPE_CMD_RSP\t0x1\n#define APR_MSG_TYPE_SEQ_CMD\t0x2\n#define APR_MSG_TYPE_NSEQ_CMD\t0x3\n#define APR_MSG_TYPE_MAX\t0x04\n\n \n#define APR_BASIC_RSP_RESULT 0x000110E8\n#define APR_RSP_ACCEPTED     0x000100BE\n\nstruct aprv2_ibasic_rsp_result_t {\n\tuint32_t opcode;\n\tuint32_t status;\n};\n\n \n#define APR_HDR_FIELD_VER(h)\t\t(h & 0x000F)\n#define APR_HDR_FIELD_SIZE(h)\t\t((h & 0x00F0) >> 4)\n#define APR_HDR_FIELD_SIZE_BYTES(h)\t(((h & 0x00F0) >> 4) * 4)\n#define APR_HDR_FIELD_MT(h)\t\t((h & 0x0300) >> 8)\n\nstruct apr_hdr {\n\tuint16_t hdr_field;\n\tuint16_t pkt_size;\n\tuint8_t src_svc;\n\tuint8_t src_domain;\n\tuint16_t src_port;\n\tuint8_t dest_svc;\n\tuint8_t dest_domain;\n\tuint16_t dest_port;\n\tuint32_t token;\n\tuint32_t opcode;\n} __packed;\n\nstruct apr_pkt {\n\tstruct apr_hdr hdr;\n\tuint8_t payload[];\n};\n\nstruct apr_resp_pkt {\n\tstruct apr_hdr hdr;\n\tvoid *payload;\n\tint payload_size;\n};\n\nstruct gpr_hdr {\n\tuint32_t version:4;\n\tuint32_t hdr_size:4;\n\tuint32_t pkt_size:24;\n\tuint32_t dest_domain:8;\n\tuint32_t src_domain:8;\n\tuint32_t reserved:16;\n\tuint32_t src_port;\n\tuint32_t dest_port;\n\tuint32_t token;\n\tuint32_t opcode;\n} __packed;\n\nstruct gpr_pkt {\n\tstruct gpr_hdr hdr;\n\tuint32_t payload[];\n};\n\nstruct gpr_resp_pkt {\n\tstruct gpr_hdr hdr;\n\tvoid *payload;\n\tint payload_size;\n};\n\n#define GPR_HDR_SIZE\t\t\tsizeof(struct gpr_hdr)\n#define GPR_PKT_VER\t\t\t0x0\n#define GPR_PKT_HEADER_WORD_SIZE\t((sizeof(struct gpr_pkt) + 3) >> 2)\n#define GPR_PKT_HEADER_BYTE_SIZE\t(GPR_PKT_HEADER_WORD_SIZE << 2)\n\n#define GPR_BASIC_RSP_RESULT\t\t0x02001005\n\nstruct gpr_ibasic_rsp_result_t {\n\tuint32_t opcode;\n\tuint32_t status;\n};\n\n#define GPR_BASIC_EVT_ACCEPTED\t\t0x02001006\n\nstruct gpr_ibasic_rsp_accepted_t {\n\tuint32_t opcode;\n};\n\n \n#define APR_SVC_MAJOR_VERSION(v)\t((v >> 16) & 0xFF)\n#define APR_SVC_MINOR_VERSION(v)\t(v & 0xFF)\n\ntypedef int (*gpr_port_cb) (struct gpr_resp_pkt *d, void *priv, int op);\nstruct packet_router;\nstruct pkt_router_svc {\n\tstruct device *dev;\n\tgpr_port_cb callback;\n\tstruct packet_router *pr;\n\tspinlock_t lock;\n\tint id;\n\tvoid *priv;\n};\n\ntypedef struct pkt_router_svc gpr_port_t;\n\nstruct apr_device {\n\tstruct device\tdev;\n\tuint16_t\tsvc_id;\n\tuint16_t\tdomain_id;\n\tuint32_t\tversion;\n\tchar name[APR_NAME_SIZE];\n\tconst char *service_path;\n\tstruct pkt_router_svc svc;\n\tstruct list_head node;\n};\n\ntypedef struct apr_device gpr_device_t;\n\n#define to_apr_device(d) container_of(d, struct apr_device, dev)\n#define svc_to_apr_device(d) container_of(d, struct apr_device, svc)\n\nstruct apr_driver {\n\tint\t(*probe)(struct apr_device *sl);\n\tvoid\t(*remove)(struct apr_device *sl);\n\tint\t(*callback)(struct apr_device *a,\n\t\t\t    struct apr_resp_pkt *d);\n\tint\t(*gpr_callback)(struct gpr_resp_pkt *d, void *data, int op);\n\tstruct device_driver\t\tdriver;\n\tconst struct apr_device_id\t*id_table;\n};\n\ntypedef struct apr_driver gpr_driver_t;\n#define to_apr_driver(d) container_of(d, struct apr_driver, driver)\n\n \n#define apr_driver_register(drv) __apr_driver_register(drv, THIS_MODULE)\n\nint __apr_driver_register(struct apr_driver *drv, struct module *owner);\nvoid apr_driver_unregister(struct apr_driver *drv);\n\n \n#define module_apr_driver(__apr_driver) \\\n\tmodule_driver(__apr_driver, apr_driver_register, \\\n\t\t\tapr_driver_unregister)\n#define module_gpr_driver(__gpr_driver) module_apr_driver(__gpr_driver)\n\nint apr_send_pkt(struct apr_device *adev, struct apr_pkt *pkt);\n\ngpr_port_t *gpr_alloc_port(gpr_device_t *gdev, struct device *dev,\n\t\t\t\tgpr_port_cb cb, void *priv);\nvoid gpr_free_port(gpr_port_t *port);\nint gpr_send_port_pkt(gpr_port_t *port, struct gpr_pkt *pkt);\nint gpr_send_pkt(gpr_device_t *gdev, struct gpr_pkt *pkt);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}