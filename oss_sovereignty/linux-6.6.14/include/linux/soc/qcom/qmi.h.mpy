{
  "module_name": "qmi.h",
  "hash_id": "fcd35eecba885a276b3715010e9484f1c5e5dca40c30f02abcf95cd7134c4797",
  "original_prompt": "Ingested from linux-6.6.14/include/linux/soc/qcom/qmi.h",
  "human_readable_source": "\n \n#ifndef __QMI_HELPERS_H__\n#define __QMI_HELPERS_H__\n\n#include <linux/completion.h>\n#include <linux/idr.h>\n#include <linux/list.h>\n#include <linux/qrtr.h>\n#include <linux/types.h>\n#include <linux/workqueue.h>\n\nstruct socket;\n\n \nstruct qmi_header {\n\tu8 type;\n\tu16 txn_id;\n\tu16 msg_id;\n\tu16 msg_len;\n} __packed;\n\n#define QMI_REQUEST\t0\n#define QMI_RESPONSE\t2\n#define QMI_INDICATION\t4\n\n#define QMI_COMMON_TLV_TYPE 0\n\nenum qmi_elem_type {\n\tQMI_EOTI,\n\tQMI_OPT_FLAG,\n\tQMI_DATA_LEN,\n\tQMI_UNSIGNED_1_BYTE,\n\tQMI_UNSIGNED_2_BYTE,\n\tQMI_UNSIGNED_4_BYTE,\n\tQMI_UNSIGNED_8_BYTE,\n\tQMI_SIGNED_2_BYTE_ENUM,\n\tQMI_SIGNED_4_BYTE_ENUM,\n\tQMI_STRUCT,\n\tQMI_STRING,\n};\n\nenum qmi_array_type {\n\tNO_ARRAY,\n\tSTATIC_ARRAY,\n\tVAR_LEN_ARRAY,\n};\n\n \nstruct qmi_elem_info {\n\tenum qmi_elem_type data_type;\n\tu32 elem_len;\n\tu32 elem_size;\n\tenum qmi_array_type array_type;\n\tu8 tlv_type;\n\tu32 offset;\n\tconst struct qmi_elem_info *ei_array;\n};\n\n#define QMI_RESULT_SUCCESS_V01\t\t\t0\n#define QMI_RESULT_FAILURE_V01\t\t\t1\n\n#define QMI_ERR_NONE_V01\t\t\t0\n#define QMI_ERR_MALFORMED_MSG_V01\t\t1\n#define QMI_ERR_NO_MEMORY_V01\t\t\t2\n#define QMI_ERR_INTERNAL_V01\t\t\t3\n#define QMI_ERR_CLIENT_IDS_EXHAUSTED_V01\t5\n#define QMI_ERR_INVALID_ID_V01\t\t\t41\n#define QMI_ERR_ENCODING_V01\t\t\t58\n#define QMI_ERR_DISABLED_V01                    69\n#define QMI_ERR_INCOMPATIBLE_STATE_V01\t\t90\n#define QMI_ERR_NOT_SUPPORTED_V01\t\t94\n\n \nstruct qmi_response_type_v01 {\n\tu16 result;\n\tu16 error;\n};\n\nextern const struct qmi_elem_info qmi_response_type_v01_ei[];\n\n \nstruct qmi_service {\n\tunsigned int service;\n\tunsigned int version;\n\tunsigned int instance;\n\n\tunsigned int node;\n\tunsigned int port;\n\n\tvoid *priv;\n\tstruct list_head list_node;\n};\n\nstruct qmi_handle;\n\n \nstruct qmi_ops {\n\tint (*new_server)(struct qmi_handle *qmi, struct qmi_service *svc);\n\tvoid (*del_server)(struct qmi_handle *qmi, struct qmi_service *svc);\n\tvoid (*net_reset)(struct qmi_handle *qmi);\n\tvoid (*msg_handler)(struct qmi_handle *qmi, struct sockaddr_qrtr *sq,\n\t\t\t    const void *data, size_t count);\n\tvoid (*bye)(struct qmi_handle *qmi, unsigned int node);\n\tvoid (*del_client)(struct qmi_handle *qmi,\n\t\t\t   unsigned int node, unsigned int port);\n};\n\n \nstruct qmi_txn {\n\tstruct qmi_handle *qmi;\n\n\tu16 id;\n\n\tstruct mutex lock;\n\tstruct completion completion;\n\tint result;\n\n\tconst struct qmi_elem_info *ei;\n\tvoid *dest;\n};\n\n \nstruct qmi_msg_handler {\n\tunsigned int type;\n\tunsigned int msg_id;\n\n\tconst struct qmi_elem_info *ei;\n\n\tsize_t decoded_size;\n\tvoid (*fn)(struct qmi_handle *qmi, struct sockaddr_qrtr *sq,\n\t\t   struct qmi_txn *txn, const void *decoded);\n};\n\n \nstruct qmi_handle {\n\tstruct socket *sock;\n\tstruct mutex sock_lock;\n\n\tstruct sockaddr_qrtr sq;\n\n\tstruct work_struct work;\n\tstruct workqueue_struct *wq;\n\n\tvoid *recv_buf;\n\tsize_t recv_buf_size;\n\n\tstruct list_head lookups;\n\tstruct list_head lookup_results;\n\tstruct list_head services;\n\n\tstruct qmi_ops ops;\n\n\tstruct idr txns;\n\tstruct mutex txn_lock;\n\n\tconst struct qmi_msg_handler *handlers;\n};\n\nint qmi_add_lookup(struct qmi_handle *qmi, unsigned int service,\n\t\t   unsigned int version, unsigned int instance);\nint qmi_add_server(struct qmi_handle *qmi, unsigned int service,\n\t\t   unsigned int version, unsigned int instance);\n\nint qmi_handle_init(struct qmi_handle *qmi, size_t max_msg_len,\n\t\t    const struct qmi_ops *ops,\n\t\t    const struct qmi_msg_handler *handlers);\nvoid qmi_handle_release(struct qmi_handle *qmi);\n\nssize_t qmi_send_request(struct qmi_handle *qmi, struct sockaddr_qrtr *sq,\n\t\t\t struct qmi_txn *txn, int msg_id, size_t len,\n\t\t\t const struct qmi_elem_info *ei, const void *c_struct);\nssize_t qmi_send_response(struct qmi_handle *qmi, struct sockaddr_qrtr *sq,\n\t\t\t  struct qmi_txn *txn, int msg_id, size_t len,\n\t\t\t  const struct qmi_elem_info *ei, const void *c_struct);\nssize_t qmi_send_indication(struct qmi_handle *qmi, struct sockaddr_qrtr *sq,\n\t\t\t    int msg_id, size_t len, const struct qmi_elem_info *ei,\n\t\t\t    const void *c_struct);\n\nvoid *qmi_encode_message(int type, unsigned int msg_id, size_t *len,\n\t\t\t unsigned int txn_id, const struct qmi_elem_info *ei,\n\t\t\t const void *c_struct);\n\nint qmi_decode_message(const void *buf, size_t len,\n\t\t       const struct qmi_elem_info *ei, void *c_struct);\n\nint qmi_txn_init(struct qmi_handle *qmi, struct qmi_txn *txn,\n\t\t const struct qmi_elem_info *ei, void *c_struct);\nint qmi_txn_wait(struct qmi_txn *txn, unsigned long timeout);\nvoid qmi_txn_cancel(struct qmi_txn *txn);\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}