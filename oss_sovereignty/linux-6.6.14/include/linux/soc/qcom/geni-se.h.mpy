{
  "module_name": "geni-se.h",
  "hash_id": "f09648fa733e16b1e95150a6af67bad7c55fec2aaeed406abb9d953199867020",
  "original_prompt": "Ingested from linux-6.6.14/include/linux/soc/qcom/geni-se.h",
  "human_readable_source": " \n \n\n#ifndef _LINUX_QCOM_GENI_SE\n#define _LINUX_QCOM_GENI_SE\n\n#include <linux/interconnect.h>\n\n \n\nenum geni_se_xfer_mode {\n\tGENI_SE_INVALID,\n\tGENI_SE_FIFO,\n\tGENI_SE_DMA,\n\tGENI_GPI_DMA,\n};\n\n \nenum geni_se_protocol_type {\n\tGENI_SE_NONE,\n\tGENI_SE_SPI,\n\tGENI_SE_UART,\n\tGENI_SE_I2C,\n\tGENI_SE_I3C,\n\tGENI_SE_SPI_SLAVE,\n};\n\nstruct geni_wrapper;\nstruct clk;\n\nenum geni_icc_path_index {\n\tGENI_TO_CORE,\n\tCPU_TO_GENI,\n\tGENI_TO_DDR\n};\n\nstruct geni_icc_path {\n\tstruct icc_path *path;\n\tunsigned int avg_bw;\n};\n\n \nstruct geni_se {\n\tvoid __iomem *base;\n\tstruct device *dev;\n\tstruct geni_wrapper *wrapper;\n\tstruct clk *clk;\n\tunsigned int num_clk_levels;\n\tunsigned long *clk_perf_tbl;\n\tstruct geni_icc_path icc_paths[3];\n};\n\n \n#define GENI_FORCE_DEFAULT_REG\t\t0x20\n#define GENI_OUTPUT_CTRL\t\t0x24\n#define SE_GENI_STATUS\t\t\t0x40\n#define GENI_SER_M_CLK_CFG\t\t0x48\n#define GENI_SER_S_CLK_CFG\t\t0x4c\n#define GENI_IF_DISABLE_RO\t\t0x64\n#define GENI_FW_REVISION_RO\t\t0x68\n#define SE_GENI_CLK_SEL\t\t\t0x7c\n#define SE_GENI_CFG_SEQ_START\t\t0x84\n#define SE_GENI_DMA_MODE_EN\t\t0x258\n#define SE_GENI_M_CMD0\t\t\t0x600\n#define SE_GENI_M_CMD_CTRL_REG\t\t0x604\n#define SE_GENI_M_IRQ_STATUS\t\t0x610\n#define SE_GENI_M_IRQ_EN\t\t0x614\n#define SE_GENI_M_IRQ_CLEAR\t\t0x618\n#define SE_GENI_S_CMD0\t\t\t0x630\n#define SE_GENI_S_CMD_CTRL_REG\t\t0x634\n#define SE_GENI_S_IRQ_STATUS\t\t0x640\n#define SE_GENI_S_IRQ_EN\t\t0x644\n#define SE_GENI_S_IRQ_CLEAR\t\t0x648\n#define SE_GENI_TX_FIFOn\t\t0x700\n#define SE_GENI_RX_FIFOn\t\t0x780\n#define SE_GENI_TX_FIFO_STATUS\t\t0x800\n#define SE_GENI_RX_FIFO_STATUS\t\t0x804\n#define SE_GENI_TX_WATERMARK_REG\t0x80c\n#define SE_GENI_RX_WATERMARK_REG\t0x810\n#define SE_GENI_RX_RFR_WATERMARK_REG\t0x814\n#define SE_GENI_IOS\t\t\t0x908\n#define SE_DMA_TX_IRQ_STAT\t\t0xc40\n#define SE_DMA_TX_IRQ_CLR\t\t0xc44\n#define SE_DMA_TX_FSM_RST\t\t0xc58\n#define SE_DMA_RX_IRQ_STAT\t\t0xd40\n#define SE_DMA_RX_IRQ_CLR\t\t0xd44\n#define SE_DMA_RX_LEN_IN\t\t0xd54\n#define SE_DMA_RX_FSM_RST\t\t0xd58\n#define SE_HW_PARAM_0\t\t\t0xe24\n#define SE_HW_PARAM_1\t\t\t0xe28\n\n \n#define FORCE_DEFAULT\tBIT(0)\n\n \n#define GENI_IO_MUX_0_EN\t\tBIT(0)\n\n \n#define M_GENI_CMD_ACTIVE\t\tBIT(0)\n#define S_GENI_CMD_ACTIVE\t\tBIT(12)\n\n \n#define SER_CLK_EN\t\t\tBIT(0)\n#define CLK_DIV_MSK\t\t\tGENMASK(15, 4)\n#define CLK_DIV_SHFT\t\t\t4\n\n \n#define FIFO_IF_DISABLE\t\t\t(BIT(0))\n\n \n#define FW_REV_PROTOCOL_MSK\t\tGENMASK(15, 8)\n#define FW_REV_PROTOCOL_SHFT\t\t8\n\n \n#define CLK_SEL_MSK\t\t\tGENMASK(2, 0)\n\n \n#define START_TRIGGER\t\t\tBIT(0)\n\n \n#define GENI_DMA_MODE_EN\t\tBIT(0)\n\n \n#define M_OPCODE_MSK\t\t\tGENMASK(31, 27)\n#define M_OPCODE_SHFT\t\t\t27\n#define M_PARAMS_MSK\t\t\tGENMASK(26, 0)\n\n \n#define M_GENI_CMD_CANCEL\t\tBIT(2)\n#define M_GENI_CMD_ABORT\t\tBIT(1)\n#define M_GENI_DISABLE\t\t\tBIT(0)\n\n \n#define S_OPCODE_MSK\t\t\tGENMASK(31, 27)\n#define S_OPCODE_SHFT\t\t\t27\n#define S_PARAMS_MSK\t\t\tGENMASK(26, 0)\n\n \n#define S_GENI_CMD_CANCEL\t\tBIT(2)\n#define S_GENI_CMD_ABORT\t\tBIT(1)\n#define S_GENI_DISABLE\t\t\tBIT(0)\n\n \n#define M_CMD_DONE_EN\t\t\tBIT(0)\n#define M_CMD_OVERRUN_EN\t\tBIT(1)\n#define M_ILLEGAL_CMD_EN\t\tBIT(2)\n#define M_CMD_FAILURE_EN\t\tBIT(3)\n#define M_CMD_CANCEL_EN\t\t\tBIT(4)\n#define M_CMD_ABORT_EN\t\t\tBIT(5)\n#define M_TIMESTAMP_EN\t\t\tBIT(6)\n#define M_RX_IRQ_EN\t\t\tBIT(7)\n#define M_GP_SYNC_IRQ_0_EN\t\tBIT(8)\n#define M_GP_IRQ_0_EN\t\t\tBIT(9)\n#define M_GP_IRQ_1_EN\t\t\tBIT(10)\n#define M_GP_IRQ_2_EN\t\t\tBIT(11)\n#define M_GP_IRQ_3_EN\t\t\tBIT(12)\n#define M_GP_IRQ_4_EN\t\t\tBIT(13)\n#define M_GP_IRQ_5_EN\t\t\tBIT(14)\n#define M_IO_DATA_DEASSERT_EN\t\tBIT(22)\n#define M_IO_DATA_ASSERT_EN\t\tBIT(23)\n#define M_RX_FIFO_RD_ERR_EN\t\tBIT(24)\n#define M_RX_FIFO_WR_ERR_EN\t\tBIT(25)\n#define M_RX_FIFO_WATERMARK_EN\t\tBIT(26)\n#define M_RX_FIFO_LAST_EN\t\tBIT(27)\n#define M_TX_FIFO_RD_ERR_EN\t\tBIT(28)\n#define M_TX_FIFO_WR_ERR_EN\t\tBIT(29)\n#define M_TX_FIFO_WATERMARK_EN\t\tBIT(30)\n#define M_SEC_IRQ_EN\t\t\tBIT(31)\n#define M_COMMON_GENI_M_IRQ_EN\t(GENMASK(6, 1) | \\\n\t\t\t\tM_IO_DATA_DEASSERT_EN | \\\n\t\t\t\tM_IO_DATA_ASSERT_EN | M_RX_FIFO_RD_ERR_EN | \\\n\t\t\t\tM_RX_FIFO_WR_ERR_EN | M_TX_FIFO_RD_ERR_EN | \\\n\t\t\t\tM_TX_FIFO_WR_ERR_EN)\n\n \n#define S_CMD_DONE_EN\t\t\tBIT(0)\n#define S_CMD_OVERRUN_EN\t\tBIT(1)\n#define S_ILLEGAL_CMD_EN\t\tBIT(2)\n#define S_CMD_FAILURE_EN\t\tBIT(3)\n#define S_CMD_CANCEL_EN\t\t\tBIT(4)\n#define S_CMD_ABORT_EN\t\t\tBIT(5)\n#define S_GP_SYNC_IRQ_0_EN\t\tBIT(8)\n#define S_GP_IRQ_0_EN\t\t\tBIT(9)\n#define S_GP_IRQ_1_EN\t\t\tBIT(10)\n#define S_GP_IRQ_2_EN\t\t\tBIT(11)\n#define S_GP_IRQ_3_EN\t\t\tBIT(12)\n#define S_GP_IRQ_4_EN\t\t\tBIT(13)\n#define S_GP_IRQ_5_EN\t\t\tBIT(14)\n#define S_IO_DATA_DEASSERT_EN\t\tBIT(22)\n#define S_IO_DATA_ASSERT_EN\t\tBIT(23)\n#define S_RX_FIFO_RD_ERR_EN\t\tBIT(24)\n#define S_RX_FIFO_WR_ERR_EN\t\tBIT(25)\n#define S_RX_FIFO_WATERMARK_EN\t\tBIT(26)\n#define S_RX_FIFO_LAST_EN\t\tBIT(27)\n#define S_COMMON_GENI_S_IRQ_EN\t(GENMASK(5, 1) | GENMASK(13, 9) | \\\n\t\t\t\t S_RX_FIFO_RD_ERR_EN | S_RX_FIFO_WR_ERR_EN)\n\n \n#define WATERMARK_MSK\t\t\tGENMASK(5, 0)\n\n \n#define TX_FIFO_WC\t\t\tGENMASK(27, 0)\n\n \n#define RX_LAST\t\t\t\tBIT(31)\n#define RX_LAST_BYTE_VALID_MSK\t\tGENMASK(30, 28)\n#define RX_LAST_BYTE_VALID_SHFT\t\t28\n#define RX_FIFO_WC_MSK\t\t\tGENMASK(24, 0)\n\n \n#define IO2_DATA_IN\t\t\tBIT(1)\n#define RX_DATA_IN\t\t\tBIT(0)\n\n \n#define TX_DMA_DONE\t\t\tBIT(0)\n#define TX_EOT\t\t\t\tBIT(1)\n#define TX_SBE\t\t\t\tBIT(2)\n#define TX_RESET_DONE\t\t\tBIT(3)\n\n \n#define RX_DMA_DONE\t\t\tBIT(0)\n#define RX_EOT\t\t\t\tBIT(1)\n#define RX_SBE\t\t\t\tBIT(2)\n#define RX_RESET_DONE\t\t\tBIT(3)\n#define RX_FLUSH_DONE\t\t\tBIT(4)\n#define RX_DMA_PARITY_ERR\t\tBIT(5)\n#define RX_DMA_BREAK\t\t\tGENMASK(8, 7)\n#define RX_GENI_GP_IRQ\t\t\tGENMASK(10, 5)\n#define RX_GENI_CANCEL_IRQ\t\tBIT(11)\n#define RX_GENI_GP_IRQ_EXT\t\tGENMASK(13, 12)\n\n \n#define TX_FIFO_WIDTH_MSK\t\tGENMASK(29, 24)\n#define TX_FIFO_WIDTH_SHFT\t\t24\n \n#define TX_FIFO_DEPTH_MSK_256_BYTES\tGENMASK(23, 16)\n#define TX_FIFO_DEPTH_MSK\t\tGENMASK(21, 16)\n#define TX_FIFO_DEPTH_SHFT\t\t16\n\n \n#define RX_FIFO_WIDTH_MSK\t\tGENMASK(29, 24)\n#define RX_FIFO_WIDTH_SHFT\t\t24\n \n#define RX_FIFO_DEPTH_MSK_256_BYTES\tGENMASK(23, 16)\n#define RX_FIFO_DEPTH_MSK\t\tGENMASK(21, 16)\n#define RX_FIFO_DEPTH_SHFT\t\t16\n\n#define HW_VER_MAJOR_MASK\t\tGENMASK(31, 28)\n#define HW_VER_MAJOR_SHFT\t\t28\n#define HW_VER_MINOR_MASK\t\tGENMASK(27, 16)\n#define HW_VER_MINOR_SHFT\t\t16\n#define HW_VER_STEP_MASK\t\tGENMASK(15, 0)\n\n#define GENI_SE_VERSION_MAJOR(ver) ((ver & HW_VER_MAJOR_MASK) >> HW_VER_MAJOR_SHFT)\n#define GENI_SE_VERSION_MINOR(ver) ((ver & HW_VER_MINOR_MASK) >> HW_VER_MINOR_SHFT)\n#define GENI_SE_VERSION_STEP(ver) (ver & HW_VER_STEP_MASK)\n\n \n#define QUP_SE_VERSION_2_5                  0x20050000\n\n \n#define CORE_2X_19_2_MHZ\t\t960\n#define CORE_2X_50_MHZ\t\t\t2500\n#define CORE_2X_100_MHZ\t\t\t5000\n#define CORE_2X_150_MHZ\t\t\t7500\n#define CORE_2X_200_MHZ\t\t\t10000\n#define CORE_2X_236_MHZ\t\t\t16383\n\n#define GENI_DEFAULT_BW\t\t\tBps_to_icc(1000)\n\n#if IS_ENABLED(CONFIG_QCOM_GENI_SE)\n\nu32 geni_se_get_qup_hw_version(struct geni_se *se);\n\n \nstatic inline u32 geni_se_read_proto(struct geni_se *se)\n{\n\tu32 val;\n\n\tval = readl_relaxed(se->base + GENI_FW_REVISION_RO);\n\n\treturn (val & FW_REV_PROTOCOL_MSK) >> FW_REV_PROTOCOL_SHFT;\n}\n\n \nstatic inline void geni_se_setup_m_cmd(struct geni_se *se, u32 cmd, u32 params)\n{\n\tu32 m_cmd;\n\n\tm_cmd = (cmd << M_OPCODE_SHFT) | (params & M_PARAMS_MSK);\n\twritel(m_cmd, se->base + SE_GENI_M_CMD0);\n}\n\n \nstatic inline void geni_se_setup_s_cmd(struct geni_se *se, u32 cmd, u32 params)\n{\n\tu32 s_cmd;\n\n\ts_cmd = readl_relaxed(se->base + SE_GENI_S_CMD0);\n\ts_cmd &= ~(S_OPCODE_MSK | S_PARAMS_MSK);\n\ts_cmd |= (cmd << S_OPCODE_SHFT);\n\ts_cmd |= (params & S_PARAMS_MSK);\n\twritel(s_cmd, se->base + SE_GENI_S_CMD0);\n}\n\n \nstatic inline void geni_se_cancel_m_cmd(struct geni_se *se)\n{\n\twritel_relaxed(M_GENI_CMD_CANCEL, se->base + SE_GENI_M_CMD_CTRL_REG);\n}\n\n \nstatic inline void geni_se_cancel_s_cmd(struct geni_se *se)\n{\n\twritel_relaxed(S_GENI_CMD_CANCEL, se->base + SE_GENI_S_CMD_CTRL_REG);\n}\n\n \nstatic inline void geni_se_abort_m_cmd(struct geni_se *se)\n{\n\twritel_relaxed(M_GENI_CMD_ABORT, se->base + SE_GENI_M_CMD_CTRL_REG);\n}\n\n \nstatic inline void geni_se_abort_s_cmd(struct geni_se *se)\n{\n\twritel_relaxed(S_GENI_CMD_ABORT, se->base + SE_GENI_S_CMD_CTRL_REG);\n}\n\n \nstatic inline u32 geni_se_get_tx_fifo_depth(struct geni_se *se)\n{\n\tu32 val, hw_version, hw_major, hw_minor, tx_fifo_depth_mask;\n\n\thw_version = geni_se_get_qup_hw_version(se);\n\thw_major = GENI_SE_VERSION_MAJOR(hw_version);\n\thw_minor = GENI_SE_VERSION_MINOR(hw_version);\n\n\tif ((hw_major == 3 && hw_minor >= 10) || hw_major > 3)\n\t\ttx_fifo_depth_mask = TX_FIFO_DEPTH_MSK_256_BYTES;\n\telse\n\t\ttx_fifo_depth_mask = TX_FIFO_DEPTH_MSK;\n\n\tval = readl_relaxed(se->base + SE_HW_PARAM_0);\n\n\treturn (val & tx_fifo_depth_mask) >> TX_FIFO_DEPTH_SHFT;\n}\n\n \nstatic inline u32 geni_se_get_tx_fifo_width(struct geni_se *se)\n{\n\tu32 val;\n\n\tval = readl_relaxed(se->base + SE_HW_PARAM_0);\n\n\treturn (val & TX_FIFO_WIDTH_MSK) >> TX_FIFO_WIDTH_SHFT;\n}\n\n \nstatic inline u32 geni_se_get_rx_fifo_depth(struct geni_se *se)\n{\n\tu32 val, hw_version, hw_major, hw_minor, rx_fifo_depth_mask;\n\n\thw_version = geni_se_get_qup_hw_version(se);\n\thw_major = GENI_SE_VERSION_MAJOR(hw_version);\n\thw_minor = GENI_SE_VERSION_MINOR(hw_version);\n\n\tif ((hw_major == 3 && hw_minor >= 10) || hw_major > 3)\n\t\trx_fifo_depth_mask = RX_FIFO_DEPTH_MSK_256_BYTES;\n\telse\n\t\trx_fifo_depth_mask = RX_FIFO_DEPTH_MSK;\n\n\tval = readl_relaxed(se->base + SE_HW_PARAM_1);\n\n\treturn (val & rx_fifo_depth_mask) >> RX_FIFO_DEPTH_SHFT;\n}\n\nvoid geni_se_init(struct geni_se *se, u32 rx_wm, u32 rx_rfr);\n\nvoid geni_se_select_mode(struct geni_se *se, enum geni_se_xfer_mode mode);\n\nvoid geni_se_config_packing(struct geni_se *se, int bpw, int pack_words,\n\t\t\t    bool msb_to_lsb, bool tx_cfg, bool rx_cfg);\n\nint geni_se_resources_off(struct geni_se *se);\n\nint geni_se_resources_on(struct geni_se *se);\n\nint geni_se_clk_tbl_get(struct geni_se *se, unsigned long **tbl);\n\nint geni_se_clk_freq_match(struct geni_se *se, unsigned long req_freq,\n\t\t\t   unsigned int *index, unsigned long *res_freq,\n\t\t\t   bool exact);\n\nvoid geni_se_tx_init_dma(struct geni_se *se, dma_addr_t iova, size_t len);\n\nint geni_se_tx_dma_prep(struct geni_se *se, void *buf, size_t len,\n\t\t\tdma_addr_t *iova);\n\nvoid geni_se_rx_init_dma(struct geni_se *se, dma_addr_t iova, size_t len);\n\nint geni_se_rx_dma_prep(struct geni_se *se, void *buf, size_t len,\n\t\t\tdma_addr_t *iova);\n\nvoid geni_se_tx_dma_unprep(struct geni_se *se, dma_addr_t iova, size_t len);\n\nvoid geni_se_rx_dma_unprep(struct geni_se *se, dma_addr_t iova, size_t len);\n\nint geni_icc_get(struct geni_se *se, const char *icc_ddr);\n\nint geni_icc_set_bw(struct geni_se *se);\nvoid geni_icc_set_tag(struct geni_se *se, u32 tag);\n\nint geni_icc_enable(struct geni_se *se);\n\nint geni_icc_disable(struct geni_se *se);\n#endif\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}