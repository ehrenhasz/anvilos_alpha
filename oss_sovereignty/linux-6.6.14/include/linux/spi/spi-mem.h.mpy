{
  "module_name": "spi-mem.h",
  "hash_id": "19d78de4afb9187664081db87219bd14786f45432de5336d7e7026075071eeea",
  "original_prompt": "Ingested from linux-6.6.14/include/linux/spi/spi-mem.h",
  "human_readable_source": " \n \n\n#ifndef __LINUX_SPI_MEM_H\n#define __LINUX_SPI_MEM_H\n\n#include <linux/spi/spi.h>\n\n#define SPI_MEM_OP_CMD(__opcode, __buswidth)\t\t\t\\\n\t{\t\t\t\t\t\t\t\\\n\t\t.buswidth = __buswidth,\t\t\t\t\\\n\t\t.opcode = __opcode,\t\t\t\t\\\n\t\t.nbytes = 1,\t\t\t\t\t\\\n\t}\n\n#define SPI_MEM_OP_ADDR(__nbytes, __val, __buswidth)\t\t\\\n\t{\t\t\t\t\t\t\t\\\n\t\t.nbytes = __nbytes,\t\t\t\t\\\n\t\t.val = __val,\t\t\t\t\t\\\n\t\t.buswidth = __buswidth,\t\t\t\t\\\n\t}\n\n#define SPI_MEM_OP_NO_ADDR\t{ }\n\n#define SPI_MEM_OP_DUMMY(__nbytes, __buswidth)\t\t\t\\\n\t{\t\t\t\t\t\t\t\\\n\t\t.nbytes = __nbytes,\t\t\t\t\\\n\t\t.buswidth = __buswidth,\t\t\t\t\\\n\t}\n\n#define SPI_MEM_OP_NO_DUMMY\t{ }\n\n#define SPI_MEM_OP_DATA_IN(__nbytes, __buf, __buswidth)\t\t\\\n\t{\t\t\t\t\t\t\t\\\n\t\t.dir = SPI_MEM_DATA_IN,\t\t\t\t\\\n\t\t.nbytes = __nbytes,\t\t\t\t\\\n\t\t.buf.in = __buf,\t\t\t\t\\\n\t\t.buswidth = __buswidth,\t\t\t\t\\\n\t}\n\n#define SPI_MEM_OP_DATA_OUT(__nbytes, __buf, __buswidth)\t\\\n\t{\t\t\t\t\t\t\t\\\n\t\t.dir = SPI_MEM_DATA_OUT,\t\t\t\\\n\t\t.nbytes = __nbytes,\t\t\t\t\\\n\t\t.buf.out = __buf,\t\t\t\t\\\n\t\t.buswidth = __buswidth,\t\t\t\t\\\n\t}\n\n#define SPI_MEM_OP_NO_DATA\t{ }\n\n \nenum spi_mem_data_dir {\n\tSPI_MEM_NO_DATA,\n\tSPI_MEM_DATA_IN,\n\tSPI_MEM_DATA_OUT,\n};\n\n \nstruct spi_mem_op {\n\tstruct {\n\t\tu8 nbytes;\n\t\tu8 buswidth;\n\t\tu8 dtr : 1;\n\t\tu8 __pad : 7;\n\t\tu16 opcode;\n\t} cmd;\n\n\tstruct {\n\t\tu8 nbytes;\n\t\tu8 buswidth;\n\t\tu8 dtr : 1;\n\t\tu8 __pad : 7;\n\t\tu64 val;\n\t} addr;\n\n\tstruct {\n\t\tu8 nbytes;\n\t\tu8 buswidth;\n\t\tu8 dtr : 1;\n\t\tu8 __pad : 7;\n\t} dummy;\n\n\tstruct {\n\t\tu8 buswidth;\n\t\tu8 dtr : 1;\n\t\tu8 ecc : 1;\n\t\tu8 __pad : 6;\n\t\tenum spi_mem_data_dir dir;\n\t\tunsigned int nbytes;\n\t\tunion {\n\t\t\tvoid *in;\n\t\t\tconst void *out;\n\t\t} buf;\n\t} data;\n};\n\n#define SPI_MEM_OP(__cmd, __addr, __dummy, __data)\t\t\\\n\t{\t\t\t\t\t\t\t\\\n\t\t.cmd = __cmd,\t\t\t\t\t\\\n\t\t.addr = __addr,\t\t\t\t\t\\\n\t\t.dummy = __dummy,\t\t\t\t\\\n\t\t.data = __data,\t\t\t\t\t\\\n\t}\n\n \nstruct spi_mem_dirmap_info {\n\tstruct spi_mem_op op_tmpl;\n\tu64 offset;\n\tu64 length;\n};\n\n \nstruct spi_mem_dirmap_desc {\n\tstruct spi_mem *mem;\n\tstruct spi_mem_dirmap_info info;\n\tunsigned int nodirmap;\n\tvoid *priv;\n};\n\n \nstruct spi_mem {\n\tstruct spi_device *spi;\n\tvoid *drvpriv;\n\tconst char *name;\n};\n\n \nstatic inline void spi_mem_set_drvdata(struct spi_mem *mem, void *data)\n{\n\tmem->drvpriv = data;\n}\n\n \nstatic inline void *spi_mem_get_drvdata(struct spi_mem *mem)\n{\n\treturn mem->drvpriv;\n}\n\n \nstruct spi_controller_mem_ops {\n\tint (*adjust_op_size)(struct spi_mem *mem, struct spi_mem_op *op);\n\tbool (*supports_op)(struct spi_mem *mem,\n\t\t\t    const struct spi_mem_op *op);\n\tint (*exec_op)(struct spi_mem *mem,\n\t\t       const struct spi_mem_op *op);\n\tconst char *(*get_name)(struct spi_mem *mem);\n\tint (*dirmap_create)(struct spi_mem_dirmap_desc *desc);\n\tvoid (*dirmap_destroy)(struct spi_mem_dirmap_desc *desc);\n\tssize_t (*dirmap_read)(struct spi_mem_dirmap_desc *desc,\n\t\t\t       u64 offs, size_t len, void *buf);\n\tssize_t (*dirmap_write)(struct spi_mem_dirmap_desc *desc,\n\t\t\t\tu64 offs, size_t len, const void *buf);\n\tint (*poll_status)(struct spi_mem *mem,\n\t\t\t   const struct spi_mem_op *op,\n\t\t\t   u16 mask, u16 match,\n\t\t\t   unsigned long initial_delay_us,\n\t\t\t   unsigned long polling_rate_us,\n\t\t\t   unsigned long timeout_ms);\n};\n\n \nstruct spi_controller_mem_caps {\n\tbool dtr;\n\tbool ecc;\n};\n\n#define spi_mem_controller_is_capable(ctlr, cap)\t\\\n\t((ctlr)->mem_caps && (ctlr)->mem_caps->cap)\n\n \nstruct spi_mem_driver {\n\tstruct spi_driver spidrv;\n\tint (*probe)(struct spi_mem *mem);\n\tint (*remove)(struct spi_mem *mem);\n\tvoid (*shutdown)(struct spi_mem *mem);\n};\n\n#if IS_ENABLED(CONFIG_SPI_MEM)\nint spi_controller_dma_map_mem_op_data(struct spi_controller *ctlr,\n\t\t\t\t       const struct spi_mem_op *op,\n\t\t\t\t       struct sg_table *sg);\n\nvoid spi_controller_dma_unmap_mem_op_data(struct spi_controller *ctlr,\n\t\t\t\t\t  const struct spi_mem_op *op,\n\t\t\t\t\t  struct sg_table *sg);\n\nbool spi_mem_default_supports_op(struct spi_mem *mem,\n\t\t\t\t const struct spi_mem_op *op);\n#else\nstatic inline int\nspi_controller_dma_map_mem_op_data(struct spi_controller *ctlr,\n\t\t\t\t   const struct spi_mem_op *op,\n\t\t\t\t   struct sg_table *sg)\n{\n\treturn -ENOTSUPP;\n}\n\nstatic inline void\nspi_controller_dma_unmap_mem_op_data(struct spi_controller *ctlr,\n\t\t\t\t     const struct spi_mem_op *op,\n\t\t\t\t     struct sg_table *sg)\n{\n}\n\nstatic inline\nbool spi_mem_default_supports_op(struct spi_mem *mem,\n\t\t\t\t const struct spi_mem_op *op)\n{\n\treturn false;\n}\n#endif  \n\nint spi_mem_adjust_op_size(struct spi_mem *mem, struct spi_mem_op *op);\n\nbool spi_mem_supports_op(struct spi_mem *mem,\n\t\t\t const struct spi_mem_op *op);\n\nint spi_mem_exec_op(struct spi_mem *mem,\n\t\t    const struct spi_mem_op *op);\n\nconst char *spi_mem_get_name(struct spi_mem *mem);\n\nstruct spi_mem_dirmap_desc *\nspi_mem_dirmap_create(struct spi_mem *mem,\n\t\t      const struct spi_mem_dirmap_info *info);\nvoid spi_mem_dirmap_destroy(struct spi_mem_dirmap_desc *desc);\nssize_t spi_mem_dirmap_read(struct spi_mem_dirmap_desc *desc,\n\t\t\t    u64 offs, size_t len, void *buf);\nssize_t spi_mem_dirmap_write(struct spi_mem_dirmap_desc *desc,\n\t\t\t     u64 offs, size_t len, const void *buf);\nstruct spi_mem_dirmap_desc *\ndevm_spi_mem_dirmap_create(struct device *dev, struct spi_mem *mem,\n\t\t\t   const struct spi_mem_dirmap_info *info);\nvoid devm_spi_mem_dirmap_destroy(struct device *dev,\n\t\t\t\t struct spi_mem_dirmap_desc *desc);\n\nint spi_mem_poll_status(struct spi_mem *mem,\n\t\t\tconst struct spi_mem_op *op,\n\t\t\tu16 mask, u16 match,\n\t\t\tunsigned long initial_delay_us,\n\t\t\tunsigned long polling_delay_us,\n\t\t\tu16 timeout_ms);\n\nint spi_mem_driver_register_with_owner(struct spi_mem_driver *drv,\n\t\t\t\t       struct module *owner);\n\nvoid spi_mem_driver_unregister(struct spi_mem_driver *drv);\n\n#define spi_mem_driver_register(__drv)                                  \\\n\tspi_mem_driver_register_with_owner(__drv, THIS_MODULE)\n\n#define module_spi_mem_driver(__drv)                                    \\\n\tmodule_driver(__drv, spi_mem_driver_register,                   \\\n\t\t      spi_mem_driver_unregister)\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}