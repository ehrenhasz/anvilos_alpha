{
  "module_name": "operation.h",
  "hash_id": "4fbed0ba60aae21d134f2be0a2f22e3babeec71c9c41f4174bebf3073f93a251",
  "original_prompt": "Ingested from linux-6.6.14/include/linux/greybus/operation.h",
  "human_readable_source": " \n \n\n#ifndef __OPERATION_H\n#define __OPERATION_H\n\n#include <linux/completion.h>\n#include <linux/kref.h>\n#include <linux/timer.h>\n#include <linux/types.h>\n#include <linux/workqueue.h>\n\nstruct gb_host_device;\nstruct gb_operation;\n\n \n#define GB_OPERATION_TIMEOUT_DEFAULT\t1000\t \n\n \n#define GB_MESSAGE_TYPE_RESPONSE\t((u8)0x80)\n\nenum gb_operation_result {\n\tGB_OP_SUCCESS\t\t= 0x00,\n\tGB_OP_INTERRUPTED\t= 0x01,\n\tGB_OP_TIMEOUT\t\t= 0x02,\n\tGB_OP_NO_MEMORY\t\t= 0x03,\n\tGB_OP_PROTOCOL_BAD\t= 0x04,\n\tGB_OP_OVERFLOW\t\t= 0x05,\n\tGB_OP_INVALID\t\t= 0x06,\n\tGB_OP_RETRY\t\t= 0x07,\n\tGB_OP_NONEXISTENT\t= 0x08,\n\tGB_OP_UNKNOWN_ERROR\t= 0xfe,\n\tGB_OP_MALFUNCTION\t= 0xff,\n};\n\n#define GB_OPERATION_MESSAGE_SIZE_MIN\tsizeof(struct gb_operation_msg_hdr)\n#define GB_OPERATION_MESSAGE_SIZE_MAX\tU16_MAX\n\n \nstruct gb_message {\n\tstruct gb_operation\t\t*operation;\n\tstruct gb_operation_msg_hdr\t*header;\n\n\tvoid\t\t\t\t*payload;\n\tsize_t\t\t\t\tpayload_size;\n\n\tvoid\t\t\t\t*buffer;\n\n\tvoid\t\t\t\t*hcpriv;\n};\n\n#define GB_OPERATION_FLAG_INCOMING\t\tBIT(0)\n#define GB_OPERATION_FLAG_UNIDIRECTIONAL\tBIT(1)\n#define GB_OPERATION_FLAG_SHORT_RESPONSE\tBIT(2)\n#define GB_OPERATION_FLAG_CORE\t\t\tBIT(3)\n\n#define GB_OPERATION_FLAG_USER_MASK\t(GB_OPERATION_FLAG_SHORT_RESPONSE | \\\n\t\t\t\t\t GB_OPERATION_FLAG_UNIDIRECTIONAL)\n\n \ntypedef void (*gb_operation_callback)(struct gb_operation *);\nstruct gb_operation {\n\tstruct gb_connection\t*connection;\n\tstruct gb_message\t*request;\n\tstruct gb_message\t*response;\n\n\tunsigned long\t\tflags;\n\tu8\t\t\ttype;\n\tu16\t\t\tid;\n\tint\t\t\terrno;\t\t \n\n\tstruct work_struct\twork;\n\tgb_operation_callback\tcallback;\n\tstruct completion\tcompletion;\n\tstruct timer_list\ttimer;\n\n\tstruct kref\t\tkref;\n\tatomic_t\t\twaiters;\n\n\tint\t\t\tactive;\n\tstruct list_head\tlinks;\t\t \n\n\tvoid\t\t\t*private;\n};\n\nstatic inline bool\ngb_operation_is_incoming(struct gb_operation *operation)\n{\n\treturn operation->flags & GB_OPERATION_FLAG_INCOMING;\n}\n\nstatic inline bool\ngb_operation_is_unidirectional(struct gb_operation *operation)\n{\n\treturn operation->flags & GB_OPERATION_FLAG_UNIDIRECTIONAL;\n}\n\nstatic inline bool\ngb_operation_short_response_allowed(struct gb_operation *operation)\n{\n\treturn operation->flags & GB_OPERATION_FLAG_SHORT_RESPONSE;\n}\n\nstatic inline bool gb_operation_is_core(struct gb_operation *operation)\n{\n\treturn operation->flags & GB_OPERATION_FLAG_CORE;\n}\n\nvoid gb_connection_recv(struct gb_connection *connection,\n\t\t\t\t\tvoid *data, size_t size);\n\nint gb_operation_result(struct gb_operation *operation);\n\nsize_t gb_operation_get_payload_size_max(struct gb_connection *connection);\nstruct gb_operation *\ngb_operation_create_flags(struct gb_connection *connection,\n\t\t\t\tu8 type, size_t request_size,\n\t\t\t\tsize_t response_size, unsigned long flags,\n\t\t\t\tgfp_t gfp);\n\nstatic inline struct gb_operation *\ngb_operation_create(struct gb_connection *connection,\n\t\t\t\tu8 type, size_t request_size,\n\t\t\t\tsize_t response_size, gfp_t gfp)\n{\n\treturn gb_operation_create_flags(connection, type, request_size,\n\t\t\t\t\t\tresponse_size, 0, gfp);\n}\n\nstruct gb_operation *\ngb_operation_create_core(struct gb_connection *connection,\n\t\t\t\tu8 type, size_t request_size,\n\t\t\t\tsize_t response_size, unsigned long flags,\n\t\t\t\tgfp_t gfp);\n\nvoid gb_operation_get(struct gb_operation *operation);\nvoid gb_operation_put(struct gb_operation *operation);\n\nbool gb_operation_response_alloc(struct gb_operation *operation,\n\t\t\t\t\tsize_t response_size, gfp_t gfp);\n\nint gb_operation_request_send(struct gb_operation *operation,\n\t\t\t\tgb_operation_callback callback,\n\t\t\t\tunsigned int timeout,\n\t\t\t\tgfp_t gfp);\nint gb_operation_request_send_sync_timeout(struct gb_operation *operation,\n\t\t\t\t\t\tunsigned int timeout);\nstatic inline int\ngb_operation_request_send_sync(struct gb_operation *operation)\n{\n\treturn gb_operation_request_send_sync_timeout(operation,\n\t\t\tGB_OPERATION_TIMEOUT_DEFAULT);\n}\n\nvoid gb_operation_cancel(struct gb_operation *operation, int errno);\nvoid gb_operation_cancel_incoming(struct gb_operation *operation, int errno);\n\nvoid greybus_message_sent(struct gb_host_device *hd,\n\t\t\t\tstruct gb_message *message, int status);\n\nint gb_operation_sync_timeout(struct gb_connection *connection, int type,\n\t\t\t\tvoid *request, int request_size,\n\t\t\t\tvoid *response, int response_size,\n\t\t\t\tunsigned int timeout);\nint gb_operation_unidirectional_timeout(struct gb_connection *connection,\n\t\t\t\tint type, void *request, int request_size,\n\t\t\t\tunsigned int timeout);\n\nstatic inline int gb_operation_sync(struct gb_connection *connection, int type,\n\t\t      void *request, int request_size,\n\t\t      void *response, int response_size)\n{\n\treturn gb_operation_sync_timeout(connection, type,\n\t\t\trequest, request_size, response, response_size,\n\t\t\tGB_OPERATION_TIMEOUT_DEFAULT);\n}\n\nstatic inline int gb_operation_unidirectional(struct gb_connection *connection,\n\t\t\t\tint type, void *request, int request_size)\n{\n\treturn gb_operation_unidirectional_timeout(connection, type,\n\t\t\trequest, request_size, GB_OPERATION_TIMEOUT_DEFAULT);\n}\n\nstatic inline void *gb_operation_get_data(struct gb_operation *operation)\n{\n\treturn operation->private;\n}\n\nstatic inline void gb_operation_set_data(struct gb_operation *operation,\n\t\t\t\t\t void *data)\n{\n\toperation->private = data;\n}\n\nint gb_operation_init(void);\nvoid gb_operation_exit(void);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}