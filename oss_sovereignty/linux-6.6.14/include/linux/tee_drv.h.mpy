{
  "module_name": "tee_drv.h",
  "hash_id": "c97906d618cabb00302195accb7290db76f4a7e5ca4ebeed3cc11d02aa9c219e",
  "original_prompt": "Ingested from linux-6.6.14/include/linux/tee_drv.h",
  "human_readable_source": " \n \n\n#ifndef __TEE_DRV_H\n#define __TEE_DRV_H\n\n#include <linux/device.h>\n#include <linux/idr.h>\n#include <linux/kref.h>\n#include <linux/list.h>\n#include <linux/mod_devicetable.h>\n#include <linux/tee.h>\n#include <linux/types.h>\n#include <linux/uuid.h>\n\n \n\n#define TEE_SHM_DYNAMIC\t\tBIT(0)   \n\t\t\t\t\t \n#define TEE_SHM_USER_MAPPED\tBIT(1)   \n#define TEE_SHM_POOL\t\tBIT(2)   \n#define TEE_SHM_PRIV\t\tBIT(3)   \n\nstruct device;\nstruct tee_device;\nstruct tee_shm;\nstruct tee_shm_pool;\n\n \nstruct tee_context {\n\tstruct tee_device *teedev;\n\tvoid *data;\n\tstruct kref refcount;\n\tbool releasing;\n\tbool supp_nowait;\n\tbool cap_memref_null;\n};\n\nstruct tee_param_memref {\n\tsize_t shm_offs;\n\tsize_t size;\n\tstruct tee_shm *shm;\n};\n\nstruct tee_param_value {\n\tu64 a;\n\tu64 b;\n\tu64 c;\n};\n\nstruct tee_param {\n\tu64 attr;\n\tunion {\n\t\tstruct tee_param_memref memref;\n\t\tstruct tee_param_value value;\n\t} u;\n};\n\n \nstruct tee_driver_ops {\n\tvoid (*get_version)(struct tee_device *teedev,\n\t\t\t    struct tee_ioctl_version_data *vers);\n\tint (*open)(struct tee_context *ctx);\n\tvoid (*release)(struct tee_context *ctx);\n\tint (*open_session)(struct tee_context *ctx,\n\t\t\t    struct tee_ioctl_open_session_arg *arg,\n\t\t\t    struct tee_param *param);\n\tint (*close_session)(struct tee_context *ctx, u32 session);\n\tint (*invoke_func)(struct tee_context *ctx,\n\t\t\t   struct tee_ioctl_invoke_arg *arg,\n\t\t\t   struct tee_param *param);\n\tint (*cancel_req)(struct tee_context *ctx, u32 cancel_id, u32 session);\n\tint (*supp_recv)(struct tee_context *ctx, u32 *func, u32 *num_params,\n\t\t\t struct tee_param *param);\n\tint (*supp_send)(struct tee_context *ctx, u32 ret, u32 num_params,\n\t\t\t struct tee_param *param);\n\tint (*shm_register)(struct tee_context *ctx, struct tee_shm *shm,\n\t\t\t    struct page **pages, size_t num_pages,\n\t\t\t    unsigned long start);\n\tint (*shm_unregister)(struct tee_context *ctx, struct tee_shm *shm);\n};\n\n \n#define TEE_DESC_PRIVILEGED\t0x1\nstruct tee_desc {\n\tconst char *name;\n\tconst struct tee_driver_ops *ops;\n\tstruct module *owner;\n\tu32 flags;\n};\n\n \nstruct tee_device *tee_device_alloc(const struct tee_desc *teedesc,\n\t\t\t\t    struct device *dev,\n\t\t\t\t    struct tee_shm_pool *pool,\n\t\t\t\t    void *driver_data);\n\n \nint tee_device_register(struct tee_device *teedev);\n\n \nvoid tee_device_unregister(struct tee_device *teedev);\n\n \nint tee_session_calc_client_uuid(uuid_t *uuid, u32 connection_method,\n\t\t\t\t const u8 connection_data[TEE_IOCTL_UUID_LEN]);\n\n \nstruct tee_shm {\n\tstruct tee_context *ctx;\n\tphys_addr_t paddr;\n\tvoid *kaddr;\n\tsize_t size;\n\tunsigned int offset;\n\tstruct page **pages;\n\tsize_t num_pages;\n\trefcount_t refcount;\n\tu32 flags;\n\tint id;\n\tu64 sec_world_id;\n};\n\n \nstruct tee_shm_pool {\n\tconst struct tee_shm_pool_ops *ops;\n\tvoid *private_data;\n};\n\n \nstruct tee_shm_pool_ops {\n\tint (*alloc)(struct tee_shm_pool *pool, struct tee_shm *shm,\n\t\t     size_t size, size_t align);\n\tvoid (*free)(struct tee_shm_pool *pool, struct tee_shm *shm);\n\tvoid (*destroy_pool)(struct tee_shm_pool *pool);\n};\n\n \nstruct tee_shm_pool *tee_shm_pool_alloc_res_mem(unsigned long vaddr,\n\t\t\t\t\t\tphys_addr_t paddr, size_t size,\n\t\t\t\t\t\tint min_alloc_order);\n\n \nstatic inline void tee_shm_pool_free(struct tee_shm_pool *pool)\n{\n\tpool->ops->destroy_pool(pool);\n}\n\n \nvoid *tee_get_drvdata(struct tee_device *teedev);\n\nstruct tee_shm *tee_shm_alloc_priv_buf(struct tee_context *ctx, size_t size);\nstruct tee_shm *tee_shm_alloc_kernel_buf(struct tee_context *ctx, size_t size);\n\nstruct tee_shm *tee_shm_register_kernel_buf(struct tee_context *ctx,\n\t\t\t\t\t    void *addr, size_t length);\n\n \nstatic inline bool tee_shm_is_dynamic(struct tee_shm *shm)\n{\n\treturn shm && (shm->flags & TEE_SHM_DYNAMIC);\n}\n\n \nvoid tee_shm_free(struct tee_shm *shm);\n\n \nvoid tee_shm_put(struct tee_shm *shm);\n\n \nvoid *tee_shm_get_va(struct tee_shm *shm, size_t offs);\n\n \nint tee_shm_get_pa(struct tee_shm *shm, size_t offs, phys_addr_t *pa);\n\n \nstatic inline size_t tee_shm_get_size(struct tee_shm *shm)\n{\n\treturn shm->size;\n}\n\n \nstatic inline struct page **tee_shm_get_pages(struct tee_shm *shm,\n\t\t\t\t\t      size_t *num_pages)\n{\n\t*num_pages = shm->num_pages;\n\treturn shm->pages;\n}\n\n \nstatic inline size_t tee_shm_get_page_offset(struct tee_shm *shm)\n{\n\treturn shm->offset;\n}\n\n \nstatic inline int tee_shm_get_id(struct tee_shm *shm)\n{\n\treturn shm->id;\n}\n\n \nstruct tee_shm *tee_shm_get_from_id(struct tee_context *ctx, int id);\n\n \nstruct tee_context *\ntee_client_open_context(struct tee_context *start,\n\t\t\tint (*match)(struct tee_ioctl_version_data *,\n\t\t\t\t     const void *),\n\t\t\tconst void *data, struct tee_ioctl_version_data *vers);\n\n \nvoid tee_client_close_context(struct tee_context *ctx);\n\n \nvoid tee_client_get_version(struct tee_context *ctx,\n\t\t\t    struct tee_ioctl_version_data *vers);\n\n \nint tee_client_open_session(struct tee_context *ctx,\n\t\t\t    struct tee_ioctl_open_session_arg *arg,\n\t\t\t    struct tee_param *param);\n\n \nint tee_client_close_session(struct tee_context *ctx, u32 session);\n\n \nint tee_client_invoke_func(struct tee_context *ctx,\n\t\t\t   struct tee_ioctl_invoke_arg *arg,\n\t\t\t   struct tee_param *param);\n\n \nint tee_client_cancel_req(struct tee_context *ctx,\n\t\t\t  struct tee_ioctl_cancel_arg *arg);\n\nstatic inline bool tee_param_is_memref(struct tee_param *param)\n{\n\tswitch (param->attr & TEE_IOCTL_PARAM_ATTR_TYPE_MASK) {\n\tcase TEE_IOCTL_PARAM_ATTR_TYPE_MEMREF_INPUT:\n\tcase TEE_IOCTL_PARAM_ATTR_TYPE_MEMREF_OUTPUT:\n\tcase TEE_IOCTL_PARAM_ATTR_TYPE_MEMREF_INOUT:\n\t\treturn true;\n\tdefault:\n\t\treturn false;\n\t}\n}\n\nextern struct bus_type tee_bus_type;\n\n \nstruct tee_client_device {\n\tstruct tee_client_device_id id;\n\tstruct device dev;\n};\n\n#define to_tee_client_device(d) container_of(d, struct tee_client_device, dev)\n\n \nstruct tee_client_driver {\n\tconst struct tee_client_device_id *id_table;\n\tstruct device_driver driver;\n};\n\n#define to_tee_client_driver(d) \\\n\t\tcontainer_of(d, struct tee_client_driver, driver)\n\n \nstruct tee_context *teedev_open(struct tee_device *teedev);\n\n \nvoid teedev_close_context(struct tee_context *ctx);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}