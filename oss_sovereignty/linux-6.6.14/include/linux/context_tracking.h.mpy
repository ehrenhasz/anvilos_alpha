{
  "module_name": "context_tracking.h",
  "hash_id": "d2bae95a2047bf416234cc56459c50e9fbbe671209ea9ddb8c10f65c14ac98c8",
  "original_prompt": "Ingested from linux-6.6.14/include/linux/context_tracking.h",
  "human_readable_source": " \n#ifndef _LINUX_CONTEXT_TRACKING_H\n#define _LINUX_CONTEXT_TRACKING_H\n\n#include <linux/sched.h>\n#include <linux/vtime.h>\n#include <linux/context_tracking_state.h>\n#include <linux/instrumentation.h>\n\n#include <asm/ptrace.h>\n\n\n#ifdef CONFIG_CONTEXT_TRACKING_USER\nextern void ct_cpu_track_user(int cpu);\n\n \nextern void __ct_user_enter(enum ctx_state state);\nextern void __ct_user_exit(enum ctx_state state);\n\nextern void ct_user_enter(enum ctx_state state);\nextern void ct_user_exit(enum ctx_state state);\n\nextern void user_enter_callable(void);\nextern void user_exit_callable(void);\n\nstatic inline void user_enter(void)\n{\n\tif (context_tracking_enabled())\n\t\tct_user_enter(CONTEXT_USER);\n\n}\nstatic inline void user_exit(void)\n{\n\tif (context_tracking_enabled())\n\t\tct_user_exit(CONTEXT_USER);\n}\n\n \nstatic __always_inline void user_enter_irqoff(void)\n{\n\tif (context_tracking_enabled())\n\t\t__ct_user_enter(CONTEXT_USER);\n\n}\nstatic __always_inline void user_exit_irqoff(void)\n{\n\tif (context_tracking_enabled())\n\t\t__ct_user_exit(CONTEXT_USER);\n}\n\nstatic inline enum ctx_state exception_enter(void)\n{\n\tenum ctx_state prev_ctx;\n\n\tif (IS_ENABLED(CONFIG_HAVE_CONTEXT_TRACKING_USER_OFFSTACK) ||\n\t    !context_tracking_enabled())\n\t\treturn 0;\n\n\tprev_ctx = __ct_state();\n\tif (prev_ctx != CONTEXT_KERNEL)\n\t\tct_user_exit(prev_ctx);\n\n\treturn prev_ctx;\n}\n\nstatic inline void exception_exit(enum ctx_state prev_ctx)\n{\n\tif (!IS_ENABLED(CONFIG_HAVE_CONTEXT_TRACKING_USER_OFFSTACK) &&\n\t    context_tracking_enabled()) {\n\t\tif (prev_ctx != CONTEXT_KERNEL)\n\t\t\tct_user_enter(prev_ctx);\n\t}\n}\n\nstatic __always_inline bool context_tracking_guest_enter(void)\n{\n\tif (context_tracking_enabled())\n\t\t__ct_user_enter(CONTEXT_GUEST);\n\n\treturn context_tracking_enabled_this_cpu();\n}\n\nstatic __always_inline void context_tracking_guest_exit(void)\n{\n\tif (context_tracking_enabled())\n\t\t__ct_user_exit(CONTEXT_GUEST);\n}\n\n#define CT_WARN_ON(cond) WARN_ON(context_tracking_enabled() && (cond))\n\n#else\nstatic inline void user_enter(void) { }\nstatic inline void user_exit(void) { }\nstatic inline void user_enter_irqoff(void) { }\nstatic inline void user_exit_irqoff(void) { }\nstatic inline int exception_enter(void) { return 0; }\nstatic inline void exception_exit(enum ctx_state prev_ctx) { }\nstatic inline int ct_state(void) { return -1; }\nstatic inline int __ct_state(void) { return -1; }\nstatic __always_inline bool context_tracking_guest_enter(void) { return false; }\nstatic __always_inline void context_tracking_guest_exit(void) { }\n#define CT_WARN_ON(cond) do { } while (0)\n#endif  \n\n#ifdef CONFIG_CONTEXT_TRACKING_USER_FORCE\nextern void context_tracking_init(void);\n#else\nstatic inline void context_tracking_init(void) { }\n#endif  \n\n#ifdef CONFIG_CONTEXT_TRACKING_IDLE\nextern void ct_idle_enter(void);\nextern void ct_idle_exit(void);\n\n \nstatic __always_inline bool rcu_dynticks_curr_cpu_in_eqs(void)\n{\n\treturn !(raw_atomic_read(this_cpu_ptr(&context_tracking.state)) & RCU_DYNTICKS_IDX);\n}\n\n \nstatic __always_inline unsigned long ct_state_inc(int incby)\n{\n\treturn raw_atomic_add_return(incby, this_cpu_ptr(&context_tracking.state));\n}\n\nstatic __always_inline bool warn_rcu_enter(void)\n{\n\tbool ret = false;\n\n\t \n\tpreempt_disable_notrace();\n\tif (rcu_dynticks_curr_cpu_in_eqs()) {\n\t\tret = true;\n\t\tct_state_inc(RCU_DYNTICKS_IDX);\n\t}\n\n\treturn ret;\n}\n\nstatic __always_inline void warn_rcu_exit(bool rcu)\n{\n\tif (rcu)\n\t\tct_state_inc(RCU_DYNTICKS_IDX);\n\tpreempt_enable_notrace();\n}\n\n#else\nstatic inline void ct_idle_enter(void) { }\nstatic inline void ct_idle_exit(void) { }\n\nstatic __always_inline bool warn_rcu_enter(void) { return false; }\nstatic __always_inline void warn_rcu_exit(bool rcu) { }\n#endif  \n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}