{
  "module_name": "qp.h",
  "hash_id": "fb64cdaa511060937002b8b40075a705ce8d9331155b4486481a86a7ee0b2f68",
  "original_prompt": "Ingested from linux-6.6.14/include/linux/mlx4/qp.h",
  "human_readable_source": " \n\n#ifndef MLX4_QP_H\n#define MLX4_QP_H\n\n#include <linux/types.h>\n#include <linux/if_ether.h>\n\n#include <linux/mlx4/device.h>\n\n#define MLX4_INVALID_LKEY\t0x100\n\nenum mlx4_qp_optpar {\n\tMLX4_QP_OPTPAR_ALT_ADDR_PATH\t\t= 1 << 0,\n\tMLX4_QP_OPTPAR_RRE\t\t\t= 1 << 1,\n\tMLX4_QP_OPTPAR_RAE\t\t\t= 1 << 2,\n\tMLX4_QP_OPTPAR_RWE\t\t\t= 1 << 3,\n\tMLX4_QP_OPTPAR_PKEY_INDEX\t\t= 1 << 4,\n\tMLX4_QP_OPTPAR_Q_KEY\t\t\t= 1 << 5,\n\tMLX4_QP_OPTPAR_RNR_TIMEOUT\t\t= 1 << 6,\n\tMLX4_QP_OPTPAR_PRIMARY_ADDR_PATH\t= 1 << 7,\n\tMLX4_QP_OPTPAR_SRA_MAX\t\t\t= 1 << 8,\n\tMLX4_QP_OPTPAR_RRA_MAX\t\t\t= 1 << 9,\n\tMLX4_QP_OPTPAR_PM_STATE\t\t\t= 1 << 10,\n\tMLX4_QP_OPTPAR_RETRY_COUNT\t\t= 1 << 12,\n\tMLX4_QP_OPTPAR_RNR_RETRY\t\t= 1 << 13,\n\tMLX4_QP_OPTPAR_ACK_TIMEOUT\t\t= 1 << 14,\n\tMLX4_QP_OPTPAR_SCHED_QUEUE\t\t= 1 << 16,\n\tMLX4_QP_OPTPAR_COUNTER_INDEX\t\t= 1 << 20,\n\tMLX4_QP_OPTPAR_VLAN_STRIPPING\t\t= 1 << 21,\n};\n\nenum mlx4_qp_state {\n\tMLX4_QP_STATE_RST\t\t\t= 0,\n\tMLX4_QP_STATE_INIT\t\t\t= 1,\n\tMLX4_QP_STATE_RTR\t\t\t= 2,\n\tMLX4_QP_STATE_RTS\t\t\t= 3,\n\tMLX4_QP_STATE_SQER\t\t\t= 4,\n\tMLX4_QP_STATE_SQD\t\t\t= 5,\n\tMLX4_QP_STATE_ERR\t\t\t= 6,\n\tMLX4_QP_STATE_SQ_DRAINING\t\t= 7,\n\tMLX4_QP_NUM_STATE\n};\n\nenum {\n\tMLX4_QP_ST_RC\t\t\t\t= 0x0,\n\tMLX4_QP_ST_UC\t\t\t\t= 0x1,\n\tMLX4_QP_ST_RD\t\t\t\t= 0x2,\n\tMLX4_QP_ST_UD\t\t\t\t= 0x3,\n\tMLX4_QP_ST_XRC\t\t\t\t= 0x6,\n\tMLX4_QP_ST_MLX\t\t\t\t= 0x7\n};\n\nenum {\n\tMLX4_QP_PM_MIGRATED\t\t\t= 0x3,\n\tMLX4_QP_PM_ARMED\t\t\t= 0x0,\n\tMLX4_QP_PM_REARM\t\t\t= 0x1\n};\n\nenum {\n\t \n\tMLX4_QP_BIT_SRE\t\t\t\t= 1 << 15,\n\tMLX4_QP_BIT_SWE\t\t\t\t= 1 << 14,\n\tMLX4_QP_BIT_SAE\t\t\t\t= 1 << 13,\n\t \n\tMLX4_QP_BIT_RRE\t\t\t\t= 1 << 15,\n\tMLX4_QP_BIT_RWE\t\t\t\t= 1 << 14,\n\tMLX4_QP_BIT_RAE\t\t\t\t= 1 << 13,\n\tMLX4_QP_BIT_FPP\t\t\t\t= 1 <<\t3,\n\tMLX4_QP_BIT_RIC\t\t\t\t= 1 <<\t4,\n};\n\nenum {\n\tMLX4_RSS_HASH_XOR\t\t\t= 0,\n\tMLX4_RSS_HASH_TOP\t\t\t= 1,\n\n\tMLX4_RSS_UDP_IPV6\t\t\t= 1 << 0,\n\tMLX4_RSS_UDP_IPV4\t\t\t= 1 << 1,\n\tMLX4_RSS_TCP_IPV6\t\t\t= 1 << 2,\n\tMLX4_RSS_IPV6\t\t\t\t= 1 << 3,\n\tMLX4_RSS_TCP_IPV4\t\t\t= 1 << 4,\n\tMLX4_RSS_IPV4\t\t\t\t= 1 << 5,\n\n\tMLX4_RSS_BY_OUTER_HEADERS\t\t= 0 << 6,\n\tMLX4_RSS_BY_INNER_HEADERS\t\t= 2 << 6,\n\tMLX4_RSS_BY_INNER_HEADERS_IPONLY\t= 3 << 6,\n\n\t \n\tMLX4_RSS_OFFSET_IN_QPC_PRI_PATH\t\t= 0x24,\n\t \n\tMLX4_RSS_QPC_FLAG_OFFSET\t\t= 13,\n};\n\n#define MLX4_EN_RSS_KEY_SIZE 40\n\nstruct mlx4_rss_context {\n\t__be32\t\t\tbase_qpn;\n\t__be32\t\t\tdefault_qpn;\n\tu16\t\t\treserved;\n\tu8\t\t\thash_fn;\n\tu8\t\t\tflags;\n\t__be32\t\t\trss_key[MLX4_EN_RSS_KEY_SIZE / sizeof(__be32)];\n\t__be32\t\t\tbase_qpn_udp;\n};\n\nstruct mlx4_qp_path {\n\tu8\t\t\tfl;\n\tunion {\n\t\tu8\t\t\tvlan_control;\n\t\tu8\t\t\tcontrol;\n\t};\n\tu8\t\t\tdisable_pkey_check;\n\tu8\t\t\tpkey_index;\n\tu8\t\t\tcounter_index;\n\tu8\t\t\tgrh_mylmc;\n\t__be16\t\t\trlid;\n\tu8\t\t\tackto;\n\tu8\t\t\tmgid_index;\n\tu8\t\t\tstatic_rate;\n\tu8\t\t\thop_limit;\n\t__be32\t\t\ttclass_flowlabel;\n\tu8\t\t\trgid[16];\n\tu8\t\t\tsched_queue;\n\tu8\t\t\tvlan_index;\n\tu8\t\t\tfeup;\n\tu8\t\t\tfvl_rx;\n\tu8\t\t\treserved4[2];\n\tu8\t\t\tdmac[ETH_ALEN];\n};\n\nenum {  \n\tMLX4_FL_CV\t= 1 << 6,\n\tMLX4_FL_SV\t= 1 << 5,\n\tMLX4_FL_ETH_HIDE_CQE_VLAN\t= 1 << 2,\n\tMLX4_FL_ETH_SRC_CHECK_MC_LB\t= 1 << 1,\n\tMLX4_FL_ETH_SRC_CHECK_UC_LB\t= 1 << 0,\n};\n\nenum {  \n\tMLX4_CTRL_ETH_SRC_CHECK_IF_COUNTER\t= 1 << 7,\n};\n\nenum {  \n\tMLX4_VLAN_CTRL_ETH_TX_BLOCK_TAGGED\t= 1 << 6,\n\tMLX4_VLAN_CTRL_ETH_TX_BLOCK_PRIO_TAGGED\t= 1 << 5,  \n\tMLX4_VLAN_CTRL_ETH_TX_BLOCK_UNTAGGED\t= 1 << 4,\n\tMLX4_VLAN_CTRL_ETH_RX_BLOCK_TAGGED\t= 1 << 2,\n\tMLX4_VLAN_CTRL_ETH_RX_BLOCK_PRIO_TAGGED\t= 1 << 1,  \n\tMLX4_VLAN_CTRL_ETH_RX_BLOCK_UNTAGGED\t= 1 << 0\n};\n\nenum {  \n\tMLX4_FEUP_FORCE_ETH_UP          = 1 << 6,  \n\tMLX4_FSM_FORCE_ETH_SRC_MAC      = 1 << 5,  \n\tMLX4_FVL_FORCE_ETH_VLAN         = 1 << 3   \n};\n\nenum {  \n\tMLX4_FVL_RX_FORCE_ETH_VLAN      = 1 << 0  \n};\n\nstruct mlx4_qp_context {\n\t__be32\t\t\tflags;\n\t__be32\t\t\tpd;\n\tu8\t\t\tmtu_msgmax;\n\tu8\t\t\trq_size_stride;\n\tu8\t\t\tsq_size_stride;\n\tu8\t\t\trlkey_roce_mode;\n\t__be32\t\t\tusr_page;\n\t__be32\t\t\tlocal_qpn;\n\t__be32\t\t\tremote_qpn;\n\tstruct\t\t\tmlx4_qp_path pri_path;\n\tstruct\t\t\tmlx4_qp_path alt_path;\n\t__be32\t\t\tparams1;\n\tu32\t\t\treserved1;\n\t__be32\t\t\tnext_send_psn;\n\t__be32\t\t\tcqn_send;\n\t__be16                  roce_entropy;\n\t__be16                  reserved2[3];\n\t__be32\t\t\tlast_acked_psn;\n\t__be32\t\t\tssn;\n\t__be32\t\t\tparams2;\n\t__be32\t\t\trnr_nextrecvpsn;\n\t__be32\t\t\txrcd;\n\t__be32\t\t\tcqn_recv;\n\t__be64\t\t\tdb_rec_addr;\n\t__be32\t\t\tqkey;\n\t__be32\t\t\tsrqn;\n\t__be32\t\t\tmsn;\n\t__be16\t\t\trq_wqe_counter;\n\t__be16\t\t\tsq_wqe_counter;\n\tu32\t\t\treserved3;\n\t__be16\t\t\trate_limit_params;\n\tu8\t\t\treserved4;\n\tu8\t\t\tqos_vport;\n\t__be32\t\t\tparam3;\n\t__be32\t\t\tnummmcpeers_basemkey;\n\tu8\t\t\tlog_page_size;\n\tu8\t\t\treserved5[2];\n\tu8\t\t\tmtt_base_addr_h;\n\t__be32\t\t\tmtt_base_addr_l;\n\tu32\t\t\treserved6[10];\n};\n\nstruct mlx4_update_qp_context {\n\t__be64\t\t\tqp_mask;\n\t__be64\t\t\tprimary_addr_path_mask;\n\t__be64\t\t\tsecondary_addr_path_mask;\n\tu64\t\t\treserved1;\n\tstruct mlx4_qp_context\tqp_context;\n\tu64\t\t\treserved2[58];\n};\n\nenum {\n\tMLX4_UPD_QP_MASK_PM_STATE\t= 32,\n\tMLX4_UPD_QP_MASK_VSD\t\t= 33,\n\tMLX4_UPD_QP_MASK_QOS_VPP\t= 34,\n\tMLX4_UPD_QP_MASK_RATE_LIMIT\t= 35,\n};\n\nenum {\n\tMLX4_UPD_QP_PATH_MASK_PKEY_INDEX\t\t= 0 + 32,\n\tMLX4_UPD_QP_PATH_MASK_FSM\t\t\t= 1 + 32,\n\tMLX4_UPD_QP_PATH_MASK_MAC_INDEX\t\t\t= 2 + 32,\n\tMLX4_UPD_QP_PATH_MASK_FVL\t\t\t= 3 + 32,\n\tMLX4_UPD_QP_PATH_MASK_CV\t\t\t= 4 + 32,\n\tMLX4_UPD_QP_PATH_MASK_VLAN_INDEX\t\t= 5 + 32,\n\tMLX4_UPD_QP_PATH_MASK_ETH_HIDE_CQE_VLAN\t\t= 6 + 32,\n\tMLX4_UPD_QP_PATH_MASK_ETH_TX_BLOCK_UNTAGGED\t= 7 + 32,\n\tMLX4_UPD_QP_PATH_MASK_ETH_TX_BLOCK_1P\t\t= 8 + 32,\n\tMLX4_UPD_QP_PATH_MASK_ETH_TX_BLOCK_TAGGED\t= 9 + 32,\n\tMLX4_UPD_QP_PATH_MASK_ETH_RX_BLOCK_UNTAGGED\t= 10 + 32,\n\tMLX4_UPD_QP_PATH_MASK_ETH_RX_BLOCK_1P\t\t= 11 + 32,\n\tMLX4_UPD_QP_PATH_MASK_ETH_RX_BLOCK_TAGGED\t= 12 + 32,\n\tMLX4_UPD_QP_PATH_MASK_FEUP\t\t\t= 13 + 32,\n\tMLX4_UPD_QP_PATH_MASK_SCHED_QUEUE\t\t= 14 + 32,\n\tMLX4_UPD_QP_PATH_MASK_IF_COUNTER_INDEX\t\t= 15 + 32,\n\tMLX4_UPD_QP_PATH_MASK_FVL_RX\t\t\t= 16 + 32,\n\tMLX4_UPD_QP_PATH_MASK_ETH_SRC_CHECK_UC_LB\t= 18 + 32,\n\tMLX4_UPD_QP_PATH_MASK_ETH_SRC_CHECK_MC_LB\t= 19 + 32,\n\tMLX4_UPD_QP_PATH_MASK_SV\t\t\t= 22 + 32,\n};\n\nenum {  \n\tMLX4_STRIP_VLAN = 1 << 30\n};\n\n \n#define MLX4_FW_VER_WQE_CTRL_NEC mlx4_fw_ver(2, 2, 232)\n\nenum {\n\tMLX4_WQE_CTRL_NEC\t\t= 1 << 29,\n\tMLX4_WQE_CTRL_IIP\t\t= 1 << 28,\n\tMLX4_WQE_CTRL_ILP\t\t= 1 << 27,\n\tMLX4_WQE_CTRL_FENCE\t\t= 1 << 6,\n\tMLX4_WQE_CTRL_CQ_UPDATE\t\t= 3 << 2,\n\tMLX4_WQE_CTRL_SOLICITED\t\t= 1 << 1,\n\tMLX4_WQE_CTRL_IP_CSUM\t\t= 1 << 4,\n\tMLX4_WQE_CTRL_TCP_UDP_CSUM\t= 1 << 5,\n\tMLX4_WQE_CTRL_INS_CVLAN\t\t= 1 << 6,\n\tMLX4_WQE_CTRL_INS_SVLAN\t\t= 1 << 7,\n\tMLX4_WQE_CTRL_STRONG_ORDER\t= 1 << 7,\n\tMLX4_WQE_CTRL_FORCE_LOOPBACK\t= 1 << 0,\n};\n\nunion mlx4_wqe_qpn_vlan {\n\tstruct {\n\t\t__be16\tvlan_tag;\n\t\tu8\tins_vlan;\n\t\tu8\tfence_size;\n\t};\n\t__be32\t\tbf_qpn;\n};\n\nstruct mlx4_wqe_ctrl_seg {\n\t__be32\t\t\towner_opcode;\n\tunion mlx4_wqe_qpn_vlan\tqpn_vlan;\n\t \n\tunion {\n\t\t__be32\t\t\tsrcrb_flags;\n\t\t__be16\t\t\tsrcrb_flags16[2];\n\t};\n\t \n\t__be32\t\t\timm;\n};\n\nenum {\n\tMLX4_WQE_MLX_VL15\t= 1 << 17,\n\tMLX4_WQE_MLX_SLR\t= 1 << 16\n};\n\nstruct mlx4_wqe_mlx_seg {\n\tu8\t\t\towner;\n\tu8\t\t\treserved1[2];\n\tu8\t\t\topcode;\n\t__be16\t\t\tsched_prio;\n\tu8\t\t\treserved2;\n\tu8\t\t\tsize;\n\t \n\t__be32\t\t\tflags;\n\t__be16\t\t\trlid;\n\tu16\t\t\treserved3;\n};\n\nstruct mlx4_wqe_datagram_seg {\n\t__be32\t\t\tav[8];\n\t__be32\t\t\tdqpn;\n\t__be32\t\t\tqkey;\n\t__be16\t\t\tvlan;\n\tu8\t\t\tmac[ETH_ALEN];\n};\n\nstruct mlx4_wqe_lso_seg {\n\t__be32\t\t\tmss_hdr_size;\n\t__be32\t\t\theader[];\n};\n\nenum mlx4_wqe_bind_seg_flags2 {\n\tMLX4_WQE_BIND_ZERO_BASED = (1 << 30),\n\tMLX4_WQE_BIND_TYPE_2     = (1 << 31),\n};\n\nstruct mlx4_wqe_bind_seg {\n\t__be32\t\t\tflags1;\n\t__be32\t\t\tflags2;\n\t__be32\t\t\tnew_rkey;\n\t__be32\t\t\tlkey;\n\t__be64\t\t\taddr;\n\t__be64\t\t\tlength;\n};\n\nenum {\n\tMLX4_WQE_FMR_PERM_LOCAL_READ\t= 1 << 27,\n\tMLX4_WQE_FMR_PERM_LOCAL_WRITE\t= 1 << 28,\n\tMLX4_WQE_FMR_AND_BIND_PERM_REMOTE_READ\t= 1 << 29,\n\tMLX4_WQE_FMR_AND_BIND_PERM_REMOTE_WRITE\t= 1 << 30,\n\tMLX4_WQE_FMR_AND_BIND_PERM_ATOMIC\t= 1 << 31\n};\n\nstruct mlx4_wqe_fmr_seg {\n\t__be32\t\t\tflags;\n\t__be32\t\t\tmem_key;\n\t__be64\t\t\tbuf_list;\n\t__be64\t\t\tstart_addr;\n\t__be64\t\t\treg_len;\n\t__be32\t\t\toffset;\n\t__be32\t\t\tpage_size;\n\tu32\t\t\treserved[2];\n};\n\nstruct mlx4_wqe_fmr_ext_seg {\n\tu8\t\t\tflags;\n\tu8\t\t\treserved;\n\t__be16\t\t\tapp_mask;\n\t__be16\t\t\twire_app_tag;\n\t__be16\t\t\tmem_app_tag;\n\t__be32\t\t\twire_ref_tag_base;\n\t__be32\t\t\tmem_ref_tag_base;\n};\n\nstruct mlx4_wqe_local_inval_seg {\n\tu64\t\t\treserved1;\n\t__be32\t\t\tmem_key;\n\tu32\t\t\treserved2;\n\tu64\t\t\treserved3[2];\n};\n\nstruct mlx4_wqe_raddr_seg {\n\t__be64\t\t\traddr;\n\t__be32\t\t\trkey;\n\tu32\t\t\treserved;\n};\n\nstruct mlx4_wqe_atomic_seg {\n\t__be64\t\t\tswap_add;\n\t__be64\t\t\tcompare;\n};\n\nstruct mlx4_wqe_masked_atomic_seg {\n\t__be64\t\t\tswap_add;\n\t__be64\t\t\tcompare;\n\t__be64\t\t\tswap_add_mask;\n\t__be64\t\t\tcompare_mask;\n};\n\nstruct mlx4_wqe_data_seg {\n\t__be32\t\t\tbyte_count;\n\t__be32\t\t\tlkey;\n\t__be64\t\t\taddr;\n};\n\nenum {\n\tMLX4_INLINE_ALIGN\t= 64,\n\tMLX4_INLINE_SEG\t\t= 1 << 31,\n};\n\nstruct mlx4_wqe_inline_seg {\n\t__be32\t\t\tbyte_count;\n\t__u8\t\t\tdata[];\n};\n\nenum mlx4_update_qp_attr {\n\tMLX4_UPDATE_QP_SMAC\t\t= 1 << 0,\n\tMLX4_UPDATE_QP_VSD\t\t= 1 << 1,\n\tMLX4_UPDATE_QP_RATE_LIMIT\t= 1 << 2,\n\tMLX4_UPDATE_QP_QOS_VPORT\t= 1 << 3,\n\tMLX4_UPDATE_QP_ETH_SRC_CHECK_MC_LB      = 1 << 4,\n\tMLX4_UPDATE_QP_SUPPORTED_ATTRS\t= (1 << 5) - 1\n};\n\nenum mlx4_update_qp_params_flags {\n\tMLX4_UPDATE_QP_PARAMS_FLAGS_ETH_CHECK_MC_LB     = 1 << 0,\n\tMLX4_UPDATE_QP_PARAMS_FLAGS_VSD_ENABLE\t\t= 1 << 1,\n};\n\nstruct mlx4_update_qp_params {\n\tu8\tsmac_index;\n\tu8\tqos_vport;\n\tu32\tflags;\n\tu16\trate_unit;\n\tu16\trate_val;\n};\n\nstruct mlx4_qp *mlx4_qp_lookup(struct mlx4_dev *dev, u32 qpn);\nint mlx4_update_qp(struct mlx4_dev *dev, u32 qpn,\n\t\t   enum mlx4_update_qp_attr attr,\n\t\t   struct mlx4_update_qp_params *params);\nint mlx4_qp_modify(struct mlx4_dev *dev, struct mlx4_mtt *mtt,\n\t\t   enum mlx4_qp_state cur_state, enum mlx4_qp_state new_state,\n\t\t   struct mlx4_qp_context *context, enum mlx4_qp_optpar optpar,\n\t\t   int sqd_event, struct mlx4_qp *qp);\n\nint mlx4_qp_query(struct mlx4_dev *dev, struct mlx4_qp *qp,\n\t\t  struct mlx4_qp_context *context);\n\nint mlx4_qp_to_ready(struct mlx4_dev *dev, struct mlx4_mtt *mtt,\n\t\t     struct mlx4_qp_context *context,\n\t\t     struct mlx4_qp *qp, enum mlx4_qp_state *qp_state);\n\nstatic inline struct mlx4_qp *__mlx4_qp_lookup(struct mlx4_dev *dev, u32 qpn)\n{\n\treturn radix_tree_lookup(&dev->qp_table_tree, qpn & (dev->caps.num_qps - 1));\n}\n\nvoid mlx4_qp_remove(struct mlx4_dev *dev, struct mlx4_qp *qp);\n\nstatic inline u16 folded_qp(u32 q)\n{\n\tu16 res;\n\n\tres = ((q & 0xff) ^ ((q & 0xff0000) >> 16)) | (q & 0xff00);\n\treturn res;\n}\n\nu16 mlx4_qp_roce_entropy(struct mlx4_dev *dev, u32 qpn);\n\nvoid mlx4_put_qp(struct mlx4_qp *qp);\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}