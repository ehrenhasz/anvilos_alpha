{
  "module_name": "energy_model.h",
  "hash_id": "aa9823dd7470b843266907d2384cec8d432b528ca547a61486cd15f396e834e1",
  "original_prompt": "Ingested from linux-6.6.14/include/linux/energy_model.h",
  "human_readable_source": " \n#ifndef _LINUX_ENERGY_MODEL_H\n#define _LINUX_ENERGY_MODEL_H\n#include <linux/cpumask.h>\n#include <linux/device.h>\n#include <linux/jump_label.h>\n#include <linux/kobject.h>\n#include <linux/rcupdate.h>\n#include <linux/sched/cpufreq.h>\n#include <linux/sched/topology.h>\n#include <linux/types.h>\n\n \nstruct em_perf_state {\n\tunsigned long frequency;\n\tunsigned long power;\n\tunsigned long cost;\n\tunsigned long flags;\n};\n\n \n#define EM_PERF_STATE_INEFFICIENT BIT(0)\n\n \nstruct em_perf_domain {\n\tstruct em_perf_state *table;\n\tint nr_perf_states;\n\tunsigned long flags;\n\tunsigned long cpus[];\n};\n\n \n#define EM_PERF_DOMAIN_MICROWATTS BIT(0)\n#define EM_PERF_DOMAIN_SKIP_INEFFICIENCIES BIT(1)\n#define EM_PERF_DOMAIN_ARTIFICIAL BIT(2)\n\n#define em_span_cpus(em) (to_cpumask((em)->cpus))\n#define em_is_artificial(em) ((em)->flags & EM_PERF_DOMAIN_ARTIFICIAL)\n\n#ifdef CONFIG_ENERGY_MODEL\n \n#define EM_MAX_POWER (64000000)  \n\n \n#ifdef CONFIG_64BIT\n#define EM_MAX_NUM_CPUS 4096\n#else\n#define EM_MAX_NUM_CPUS 16\n#endif\n\n \n#ifdef CONFIG_64BIT\n#define em_estimate_energy(cost, sum_util, scale_cpu) \\\n\t(((cost) * (sum_util)) / (scale_cpu))\n#else\n#define em_estimate_energy(cost, sum_util, scale_cpu) \\\n\t(((cost) / (scale_cpu)) * (sum_util))\n#endif\n\nstruct em_data_callback {\n\t \n\tint (*active_power)(struct device *dev, unsigned long *power,\n\t\t\t    unsigned long *freq);\n\n\t \n\tint (*get_cost)(struct device *dev, unsigned long freq,\n\t\t\tunsigned long *cost);\n};\n#define EM_SET_ACTIVE_POWER_CB(em_cb, cb) ((em_cb).active_power = cb)\n#define EM_ADV_DATA_CB(_active_power_cb, _cost_cb)\t\\\n\t{ .active_power = _active_power_cb,\t\t\\\n\t  .get_cost = _cost_cb }\n#define EM_DATA_CB(_active_power_cb)\t\t\t\\\n\t\tEM_ADV_DATA_CB(_active_power_cb, NULL)\n\nstruct em_perf_domain *em_cpu_get(int cpu);\nstruct em_perf_domain *em_pd_get(struct device *dev);\nint em_dev_register_perf_domain(struct device *dev, unsigned int nr_states,\n\t\t\t\tstruct em_data_callback *cb, cpumask_t *span,\n\t\t\t\tbool microwatts);\nvoid em_dev_unregister_perf_domain(struct device *dev);\n\n \nstatic inline\nstruct em_perf_state *em_pd_get_efficient_state(struct em_perf_domain *pd,\n\t\t\t\t\t\tunsigned long freq)\n{\n\tstruct em_perf_state *ps;\n\tint i;\n\n\tfor (i = 0; i < pd->nr_perf_states; i++) {\n\t\tps = &pd->table[i];\n\t\tif (ps->frequency >= freq) {\n\t\t\tif (pd->flags & EM_PERF_DOMAIN_SKIP_INEFFICIENCIES &&\n\t\t\t    ps->flags & EM_PERF_STATE_INEFFICIENT)\n\t\t\t\tcontinue;\n\t\t\tbreak;\n\t\t}\n\t}\n\n\treturn ps;\n}\n\n \nstatic inline unsigned long em_cpu_energy(struct em_perf_domain *pd,\n\t\t\t\tunsigned long max_util, unsigned long sum_util,\n\t\t\t\tunsigned long allowed_cpu_cap)\n{\n\tunsigned long freq, scale_cpu;\n\tstruct em_perf_state *ps;\n\tint cpu;\n\n\tif (!sum_util)\n\t\treturn 0;\n\n\t \n\tcpu = cpumask_first(to_cpumask(pd->cpus));\n\tscale_cpu = arch_scale_cpu_capacity(cpu);\n\tps = &pd->table[pd->nr_perf_states - 1];\n\n\tmax_util = map_util_perf(max_util);\n\tmax_util = min(max_util, allowed_cpu_cap);\n\tfreq = map_util_freq(max_util, ps->frequency, scale_cpu);\n\n\t \n\tps = em_pd_get_efficient_state(pd, freq);\n\n\t \n\treturn em_estimate_energy(ps->cost, sum_util, scale_cpu);\n}\n\n \nstatic inline int em_pd_nr_perf_states(struct em_perf_domain *pd)\n{\n\treturn pd->nr_perf_states;\n}\n\n#else\nstruct em_data_callback {};\n#define EM_ADV_DATA_CB(_active_power_cb, _cost_cb) { }\n#define EM_DATA_CB(_active_power_cb) { }\n#define EM_SET_ACTIVE_POWER_CB(em_cb, cb) do { } while (0)\n\nstatic inline\nint em_dev_register_perf_domain(struct device *dev, unsigned int nr_states,\n\t\t\t\tstruct em_data_callback *cb, cpumask_t *span,\n\t\t\t\tbool microwatts)\n{\n\treturn -EINVAL;\n}\nstatic inline void em_dev_unregister_perf_domain(struct device *dev)\n{\n}\nstatic inline struct em_perf_domain *em_cpu_get(int cpu)\n{\n\treturn NULL;\n}\nstatic inline struct em_perf_domain *em_pd_get(struct device *dev)\n{\n\treturn NULL;\n}\nstatic inline unsigned long em_cpu_energy(struct em_perf_domain *pd,\n\t\t\tunsigned long max_util, unsigned long sum_util,\n\t\t\tunsigned long allowed_cpu_cap)\n{\n\treturn 0;\n}\nstatic inline int em_pd_nr_perf_states(struct em_perf_domain *pd)\n{\n\treturn 0;\n}\n#endif\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}