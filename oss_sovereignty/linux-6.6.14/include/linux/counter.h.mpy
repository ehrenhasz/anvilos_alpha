{
  "module_name": "counter.h",
  "hash_id": "b13603af39297d86253c637a1529d938eef251439f39c47f5e57c11eedeb859b",
  "original_prompt": "Ingested from linux-6.6.14/include/linux/counter.h",
  "human_readable_source": " \n \n#ifndef _COUNTER_H_\n#define _COUNTER_H_\n\n#include <linux/cdev.h>\n#include <linux/device.h>\n#include <linux/kernel.h>\n#include <linux/kfifo.h>\n#include <linux/mutex.h>\n#include <linux/spinlock_types.h>\n#include <linux/types.h>\n#include <linux/wait.h>\n#include <uapi/linux/counter.h>\n\nstruct counter_device;\nstruct counter_count;\nstruct counter_synapse;\nstruct counter_signal;\n\nenum counter_comp_type {\n\tCOUNTER_COMP_U8,\n\tCOUNTER_COMP_U64,\n\tCOUNTER_COMP_BOOL,\n\tCOUNTER_COMP_SIGNAL_LEVEL,\n\tCOUNTER_COMP_FUNCTION,\n\tCOUNTER_COMP_SYNAPSE_ACTION,\n\tCOUNTER_COMP_ENUM,\n\tCOUNTER_COMP_COUNT_DIRECTION,\n\tCOUNTER_COMP_COUNT_MODE,\n\tCOUNTER_COMP_SIGNAL_POLARITY,\n\tCOUNTER_COMP_ARRAY,\n};\n\n \nstruct counter_comp {\n\tenum counter_comp_type type;\n\tconst char *name;\n\tvoid *priv;\n\tunion {\n\t\tint (*action_read)(struct counter_device *counter,\n\t\t\t\t   struct counter_count *count,\n\t\t\t\t   struct counter_synapse *synapse,\n\t\t\t\t   enum counter_synapse_action *action);\n\t\tint (*device_u8_read)(struct counter_device *counter, u8 *val);\n\t\tint (*count_u8_read)(struct counter_device *counter,\n\t\t\t\t     struct counter_count *count, u8 *val);\n\t\tint (*signal_u8_read)(struct counter_device *counter,\n\t\t\t\t      struct counter_signal *signal, u8 *val);\n\t\tint (*device_u32_read)(struct counter_device *counter,\n\t\t\t\t       u32 *val);\n\t\tint (*count_u32_read)(struct counter_device *counter,\n\t\t\t\t      struct counter_count *count, u32 *val);\n\t\tint (*signal_u32_read)(struct counter_device *counter,\n\t\t\t\t       struct counter_signal *signal, u32 *val);\n\t\tint (*device_u64_read)(struct counter_device *counter,\n\t\t\t\t       u64 *val);\n\t\tint (*count_u64_read)(struct counter_device *counter,\n\t\t\t\t      struct counter_count *count, u64 *val);\n\t\tint (*signal_u64_read)(struct counter_device *counter,\n\t\t\t\t       struct counter_signal *signal, u64 *val);\n\t\tint (*signal_array_u32_read)(struct counter_device *counter,\n\t\t\t\t\t     struct counter_signal *signal,\n\t\t\t\t\t     size_t idx, u32 *val);\n\t\tint (*device_array_u64_read)(struct counter_device *counter,\n\t\t\t\t\t     size_t idx, u64 *val);\n\t\tint (*count_array_u64_read)(struct counter_device *counter,\n\t\t\t\t\t    struct counter_count *count,\n\t\t\t\t\t    size_t idx, u64 *val);\n\t\tint (*signal_array_u64_read)(struct counter_device *counter,\n\t\t\t\t\t     struct counter_signal *signal,\n\t\t\t\t\t     size_t idx, u64 *val);\n\t};\n\tunion {\n\t\tint (*action_write)(struct counter_device *counter,\n\t\t\t\t    struct counter_count *count,\n\t\t\t\t    struct counter_synapse *synapse,\n\t\t\t\t    enum counter_synapse_action action);\n\t\tint (*device_u8_write)(struct counter_device *counter, u8 val);\n\t\tint (*count_u8_write)(struct counter_device *counter,\n\t\t\t\t      struct counter_count *count, u8 val);\n\t\tint (*signal_u8_write)(struct counter_device *counter,\n\t\t\t\t       struct counter_signal *signal, u8 val);\n\t\tint (*device_u32_write)(struct counter_device *counter,\n\t\t\t\t\tu32 val);\n\t\tint (*count_u32_write)(struct counter_device *counter,\n\t\t\t\t       struct counter_count *count, u32 val);\n\t\tint (*signal_u32_write)(struct counter_device *counter,\n\t\t\t\t\tstruct counter_signal *signal, u32 val);\n\t\tint (*device_u64_write)(struct counter_device *counter,\n\t\t\t\t\tu64 val);\n\t\tint (*count_u64_write)(struct counter_device *counter,\n\t\t\t\t       struct counter_count *count, u64 val);\n\t\tint (*signal_u64_write)(struct counter_device *counter,\n\t\t\t\t\tstruct counter_signal *signal, u64 val);\n\t\tint (*signal_array_u32_write)(struct counter_device *counter,\n\t\t\t\t\t      struct counter_signal *signal,\n\t\t\t\t\t      size_t idx, u32 val);\n\t\tint (*device_array_u64_write)(struct counter_device *counter,\n\t\t\t\t\t      size_t idx, u64 val);\n\t\tint (*count_array_u64_write)(struct counter_device *counter,\n\t\t\t\t\t     struct counter_count *count,\n\t\t\t\t\t     size_t idx, u64 val);\n\t\tint (*signal_array_u64_write)(struct counter_device *counter,\n\t\t\t\t\t      struct counter_signal *signal,\n\t\t\t\t\t      size_t idx, u64 val);\n\t};\n};\n\n \nstruct counter_signal {\n\tint id;\n\tconst char *name;\n\n\tstruct counter_comp *ext;\n\tsize_t num_ext;\n};\n\n \nstruct counter_synapse {\n\tconst enum counter_synapse_action *actions_list;\n\tsize_t num_actions;\n\n\tstruct counter_signal *signal;\n};\n\n \nstruct counter_count {\n\tint id;\n\tconst char *name;\n\n\tconst enum counter_function *functions_list;\n\tsize_t num_functions;\n\n\tstruct counter_synapse *synapses;\n\tsize_t num_synapses;\n\n\tstruct counter_comp *ext;\n\tsize_t num_ext;\n};\n\n \nstruct counter_event_node {\n\tstruct list_head l;\n\tu8 event;\n\tu8 channel;\n\tstruct list_head comp_list;\n};\n\n \nstruct counter_ops {\n\tint (*signal_read)(struct counter_device *counter,\n\t\t\t   struct counter_signal *signal,\n\t\t\t   enum counter_signal_level *level);\n\tint (*count_read)(struct counter_device *counter,\n\t\t\t  struct counter_count *count, u64 *value);\n\tint (*count_write)(struct counter_device *counter,\n\t\t\t   struct counter_count *count, u64 value);\n\tint (*function_read)(struct counter_device *counter,\n\t\t\t     struct counter_count *count,\n\t\t\t     enum counter_function *function);\n\tint (*function_write)(struct counter_device *counter,\n\t\t\t      struct counter_count *count,\n\t\t\t      enum counter_function function);\n\tint (*action_read)(struct counter_device *counter,\n\t\t\t   struct counter_count *count,\n\t\t\t   struct counter_synapse *synapse,\n\t\t\t   enum counter_synapse_action *action);\n\tint (*action_write)(struct counter_device *counter,\n\t\t\t    struct counter_count *count,\n\t\t\t    struct counter_synapse *synapse,\n\t\t\t    enum counter_synapse_action action);\n\tint (*events_configure)(struct counter_device *counter);\n\tint (*watch_validate)(struct counter_device *counter,\n\t\t\t      const struct counter_watch *watch);\n};\n\n \nstruct counter_device {\n\tconst char *name;\n\tstruct device *parent;\n\n\tconst struct counter_ops *ops;\n\n\tstruct counter_signal *signals;\n\tsize_t num_signals;\n\tstruct counter_count *counts;\n\tsize_t num_counts;\n\n\tstruct counter_comp *ext;\n\tsize_t num_ext;\n\n\tstruct device dev;\n\tstruct cdev chrdev;\n\tstruct list_head events_list;\n\tspinlock_t events_list_lock;\n\tstruct list_head next_events_list;\n\tstruct mutex n_events_list_lock;\n\tDECLARE_KFIFO_PTR(events, struct counter_event);\n\twait_queue_head_t events_wait;\n\tspinlock_t events_in_lock;\n\tstruct mutex events_out_lock;\n\tstruct mutex ops_exist_lock;\n};\n\nvoid *counter_priv(const struct counter_device *const counter) __attribute_const__;\n\nstruct counter_device *counter_alloc(size_t sizeof_priv);\nvoid counter_put(struct counter_device *const counter);\nint counter_add(struct counter_device *const counter);\n\nvoid counter_unregister(struct counter_device *const counter);\nstruct counter_device *devm_counter_alloc(struct device *dev,\n\t\t\t\t\t  size_t sizeof_priv);\nint devm_counter_add(struct device *dev,\n\t\t     struct counter_device *const counter);\nvoid counter_push_event(struct counter_device *const counter, const u8 event,\n\t\t\tconst u8 channel);\n\n#define COUNTER_COMP_DEVICE_U8(_name, _read, _write) \\\n{ \\\n\t.type = COUNTER_COMP_U8, \\\n\t.name = (_name), \\\n\t.device_u8_read = (_read), \\\n\t.device_u8_write = (_write), \\\n}\n#define COUNTER_COMP_COUNT_U8(_name, _read, _write) \\\n{ \\\n\t.type = COUNTER_COMP_U8, \\\n\t.name = (_name), \\\n\t.count_u8_read = (_read), \\\n\t.count_u8_write = (_write), \\\n}\n#define COUNTER_COMP_SIGNAL_U8(_name, _read, _write) \\\n{ \\\n\t.type = COUNTER_COMP_U8, \\\n\t.name = (_name), \\\n\t.signal_u8_read = (_read), \\\n\t.signal_u8_write = (_write), \\\n}\n\n#define COUNTER_COMP_DEVICE_U64(_name, _read, _write) \\\n{ \\\n\t.type = COUNTER_COMP_U64, \\\n\t.name = (_name), \\\n\t.device_u64_read = (_read), \\\n\t.device_u64_write = (_write), \\\n}\n#define COUNTER_COMP_COUNT_U64(_name, _read, _write) \\\n{ \\\n\t.type = COUNTER_COMP_U64, \\\n\t.name = (_name), \\\n\t.count_u64_read = (_read), \\\n\t.count_u64_write = (_write), \\\n}\n#define COUNTER_COMP_SIGNAL_U64(_name, _read, _write) \\\n{ \\\n\t.type = COUNTER_COMP_U64, \\\n\t.name = (_name), \\\n\t.signal_u64_read = (_read), \\\n\t.signal_u64_write = (_write), \\\n}\n\n#define COUNTER_COMP_DEVICE_BOOL(_name, _read, _write) \\\n{ \\\n\t.type = COUNTER_COMP_BOOL, \\\n\t.name = (_name), \\\n\t.device_u8_read = (_read), \\\n\t.device_u8_write = (_write), \\\n}\n#define COUNTER_COMP_COUNT_BOOL(_name, _read, _write) \\\n{ \\\n\t.type = COUNTER_COMP_BOOL, \\\n\t.name = (_name), \\\n\t.count_u8_read = (_read), \\\n\t.count_u8_write = (_write), \\\n}\n#define COUNTER_COMP_SIGNAL_BOOL(_name, _read, _write) \\\n{ \\\n\t.type = COUNTER_COMP_BOOL, \\\n\t.name = (_name), \\\n\t.signal_u8_read = (_read), \\\n\t.signal_u8_write = (_write), \\\n}\n\nstruct counter_available {\n\tunion {\n\t\tconst u32 *enums;\n\t\tconst char *const *strs;\n\t};\n\tsize_t num_items;\n};\n\n#define DEFINE_COUNTER_AVAILABLE(_name, _enums) \\\n\tstruct counter_available _name = { \\\n\t\t.enums = (_enums), \\\n\t\t.num_items = ARRAY_SIZE(_enums), \\\n\t}\n\n#define DEFINE_COUNTER_ENUM(_name, _strs) \\\n\tstruct counter_available _name = { \\\n\t\t.strs = (_strs), \\\n\t\t.num_items = ARRAY_SIZE(_strs), \\\n\t}\n\n#define COUNTER_COMP_DEVICE_ENUM(_name, _get, _set, _available) \\\n{ \\\n\t.type = COUNTER_COMP_ENUM, \\\n\t.name = (_name), \\\n\t.device_u32_read = (_get), \\\n\t.device_u32_write = (_set), \\\n\t.priv = &(_available), \\\n}\n#define COUNTER_COMP_COUNT_ENUM(_name, _get, _set, _available) \\\n{ \\\n\t.type = COUNTER_COMP_ENUM, \\\n\t.name = (_name), \\\n\t.count_u32_read = (_get), \\\n\t.count_u32_write = (_set), \\\n\t.priv = &(_available), \\\n}\n#define COUNTER_COMP_SIGNAL_ENUM(_name, _get, _set, _available) \\\n{ \\\n\t.type = COUNTER_COMP_ENUM, \\\n\t.name = (_name), \\\n\t.signal_u32_read = (_get), \\\n\t.signal_u32_write = (_set), \\\n\t.priv = &(_available), \\\n}\n\nstruct counter_array {\n\tenum counter_comp_type type;\n\tconst struct counter_available *avail;\n\tunion {\n\t\tsize_t length;\n\t\tsize_t idx;\n\t};\n};\n\n#define DEFINE_COUNTER_ARRAY_U64(_name, _length) \\\n\tstruct counter_array _name = { \\\n\t\t.type = COUNTER_COMP_U64, \\\n\t\t.length = (_length), \\\n\t}\n\n#define DEFINE_COUNTER_ARRAY_CAPTURE(_name, _length) \\\n\tDEFINE_COUNTER_ARRAY_U64(_name, _length)\n\n#define DEFINE_COUNTER_ARRAY_POLARITY(_name, _available, _length) \\\n\tstruct counter_array _name = { \\\n\t\t.type = COUNTER_COMP_SIGNAL_POLARITY, \\\n\t\t.avail = &(_available), \\\n\t\t.length = (_length), \\\n\t}\n\n#define COUNTER_COMP_DEVICE_ARRAY_U64(_name, _read, _write, _array) \\\n{ \\\n\t.type = COUNTER_COMP_ARRAY, \\\n\t.name = (_name), \\\n\t.device_array_u64_read = (_read), \\\n\t.device_array_u64_write = (_write), \\\n\t.priv = &(_array), \\\n}\n#define COUNTER_COMP_COUNT_ARRAY_U64(_name, _read, _write, _array) \\\n{ \\\n\t.type = COUNTER_COMP_ARRAY, \\\n\t.name = (_name), \\\n\t.count_array_u64_read = (_read), \\\n\t.count_array_u64_write = (_write), \\\n\t.priv = &(_array), \\\n}\n#define COUNTER_COMP_SIGNAL_ARRAY_U64(_name, _read, _write, _array) \\\n{ \\\n\t.type = COUNTER_COMP_ARRAY, \\\n\t.name = (_name), \\\n\t.signal_array_u64_read = (_read), \\\n\t.signal_array_u64_write = (_write), \\\n\t.priv = &(_array), \\\n}\n\n#define COUNTER_COMP_CAPTURE(_read, _write) \\\n\tCOUNTER_COMP_COUNT_U64(\"capture\", _read, _write)\n\n#define COUNTER_COMP_CEILING(_read, _write) \\\n\tCOUNTER_COMP_COUNT_U64(\"ceiling\", _read, _write)\n\n#define COUNTER_COMP_COUNT_MODE(_read, _write, _available) \\\n{ \\\n\t.type = COUNTER_COMP_COUNT_MODE, \\\n\t.name = \"count_mode\", \\\n\t.count_u32_read = (_read), \\\n\t.count_u32_write = (_write), \\\n\t.priv = &(_available), \\\n}\n\n#define COUNTER_COMP_DIRECTION(_read) \\\n{ \\\n\t.type = COUNTER_COMP_COUNT_DIRECTION, \\\n\t.name = \"direction\", \\\n\t.count_u32_read = (_read), \\\n}\n\n#define COUNTER_COMP_ENABLE(_read, _write) \\\n\tCOUNTER_COMP_COUNT_BOOL(\"enable\", _read, _write)\n\n#define COUNTER_COMP_FLOOR(_read, _write) \\\n\tCOUNTER_COMP_COUNT_U64(\"floor\", _read, _write)\n\n#define COUNTER_COMP_POLARITY(_read, _write, _available) \\\n{ \\\n\t.type = COUNTER_COMP_SIGNAL_POLARITY, \\\n\t.name = \"polarity\", \\\n\t.signal_u32_read = (_read), \\\n\t.signal_u32_write = (_write), \\\n\t.priv = &(_available), \\\n}\n\n#define COUNTER_COMP_PRESET(_read, _write) \\\n\tCOUNTER_COMP_COUNT_U64(\"preset\", _read, _write)\n\n#define COUNTER_COMP_PRESET_ENABLE(_read, _write) \\\n\tCOUNTER_COMP_COUNT_BOOL(\"preset_enable\", _read, _write)\n\n#define COUNTER_COMP_ARRAY_CAPTURE(_read, _write, _array) \\\n\tCOUNTER_COMP_COUNT_ARRAY_U64(\"capture\", _read, _write, _array)\n\n#define COUNTER_COMP_ARRAY_POLARITY(_read, _write, _array) \\\n{ \\\n\t.type = COUNTER_COMP_ARRAY, \\\n\t.name = \"polarity\", \\\n\t.signal_array_u32_read = (_read), \\\n\t.signal_array_u32_write = (_write), \\\n\t.priv = &(_array), \\\n}\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}