{
  "module_name": "remoteproc.h",
  "hash_id": "4d2cff8264e98082545f0825a2093d1bac655b099060b18ad5cadba6e508db2b",
  "original_prompt": "Ingested from linux-6.6.14/include/linux/remoteproc.h",
  "human_readable_source": " \n\n#ifndef REMOTEPROC_H\n#define REMOTEPROC_H\n\n#include <linux/types.h>\n#include <linux/mutex.h>\n#include <linux/virtio.h>\n#include <linux/cdev.h>\n#include <linux/completion.h>\n#include <linux/idr.h>\n#include <linux/of.h>\n\n \nstruct resource_table {\n\tu32 ver;\n\tu32 num;\n\tu32 reserved[2];\n\tu32 offset[];\n} __packed;\n\n \nstruct fw_rsc_hdr {\n\tu32 type;\n\tu8 data[];\n} __packed;\n\n \nenum fw_resource_type {\n\tRSC_CARVEOUT\t\t= 0,\n\tRSC_DEVMEM\t\t= 1,\n\tRSC_TRACE\t\t= 2,\n\tRSC_VDEV\t\t= 3,\n\tRSC_LAST\t\t= 4,\n\tRSC_VENDOR_START\t= 128,\n\tRSC_VENDOR_END\t\t= 512,\n};\n\n#define FW_RSC_ADDR_ANY (-1)\n\n \nstruct fw_rsc_carveout {\n\tu32 da;\n\tu32 pa;\n\tu32 len;\n\tu32 flags;\n\tu32 reserved;\n\tu8 name[32];\n} __packed;\n\n \nstruct fw_rsc_devmem {\n\tu32 da;\n\tu32 pa;\n\tu32 len;\n\tu32 flags;\n\tu32 reserved;\n\tu8 name[32];\n} __packed;\n\n \nstruct fw_rsc_trace {\n\tu32 da;\n\tu32 len;\n\tu32 reserved;\n\tu8 name[32];\n} __packed;\n\n \nstruct fw_rsc_vdev_vring {\n\tu32 da;\n\tu32 align;\n\tu32 num;\n\tu32 notifyid;\n\tu32 pa;\n} __packed;\n\n \nstruct fw_rsc_vdev {\n\tu32 id;\n\tu32 notifyid;\n\tu32 dfeatures;\n\tu32 gfeatures;\n\tu32 config_len;\n\tu8 status;\n\tu8 num_of_vrings;\n\tu8 reserved[2];\n\tstruct fw_rsc_vdev_vring vring[];\n} __packed;\n\nstruct rproc;\n\n \nstruct rproc_mem_entry {\n\tvoid *va;\n\tbool is_iomem;\n\tdma_addr_t dma;\n\tsize_t len;\n\tu32 da;\n\tvoid *priv;\n\tchar name[32];\n\tstruct list_head node;\n\tu32 rsc_offset;\n\tu32 flags;\n\tu32 of_resm_idx;\n\tint (*alloc)(struct rproc *rproc, struct rproc_mem_entry *mem);\n\tint (*release)(struct rproc *rproc, struct rproc_mem_entry *mem);\n};\n\nstruct firmware;\n\n \nenum rsc_handling_status {\n\tRSC_HANDLED\t= 0,\n\tRSC_IGNORED\t= 1,\n};\n\n \nstruct rproc_ops {\n\tint (*prepare)(struct rproc *rproc);\n\tint (*unprepare)(struct rproc *rproc);\n\tint (*start)(struct rproc *rproc);\n\tint (*stop)(struct rproc *rproc);\n\tint (*attach)(struct rproc *rproc);\n\tint (*detach)(struct rproc *rproc);\n\tvoid (*kick)(struct rproc *rproc, int vqid);\n\tvoid * (*da_to_va)(struct rproc *rproc, u64 da, size_t len, bool *is_iomem);\n\tint (*parse_fw)(struct rproc *rproc, const struct firmware *fw);\n\tint (*handle_rsc)(struct rproc *rproc, u32 rsc_type, void *rsc,\n\t\t\t  int offset, int avail);\n\tstruct resource_table *(*find_loaded_rsc_table)(\n\t\t\t\tstruct rproc *rproc, const struct firmware *fw);\n\tstruct resource_table *(*get_loaded_rsc_table)(\n\t\t\t\tstruct rproc *rproc, size_t *size);\n\tint (*load)(struct rproc *rproc, const struct firmware *fw);\n\tint (*sanity_check)(struct rproc *rproc, const struct firmware *fw);\n\tu64 (*get_boot_addr)(struct rproc *rproc, const struct firmware *fw);\n\tunsigned long (*panic)(struct rproc *rproc);\n\tvoid (*coredump)(struct rproc *rproc);\n};\n\n \nenum rproc_state {\n\tRPROC_OFFLINE\t= 0,\n\tRPROC_SUSPENDED\t= 1,\n\tRPROC_RUNNING\t= 2,\n\tRPROC_CRASHED\t= 3,\n\tRPROC_DELETED\t= 4,\n\tRPROC_ATTACHED\t= 5,\n\tRPROC_DETACHED\t= 6,\n\tRPROC_LAST\t= 7,\n};\n\n \nenum rproc_crash_type {\n\tRPROC_MMUFAULT,\n\tRPROC_WATCHDOG,\n\tRPROC_FATAL_ERROR,\n};\n\n \nenum rproc_dump_mechanism {\n\tRPROC_COREDUMP_DISABLED,\n\tRPROC_COREDUMP_ENABLED,\n\tRPROC_COREDUMP_INLINE,\n};\n\n \nstruct rproc_dump_segment {\n\tstruct list_head node;\n\n\tdma_addr_t da;\n\tsize_t size;\n\n\tvoid *priv;\n\tvoid (*dump)(struct rproc *rproc, struct rproc_dump_segment *segment,\n\t\t     void *dest, size_t offset, size_t size);\n\tloff_t offset;\n};\n\n \n\nenum rproc_features {\n\tRPROC_FEAT_ATTACH_ON_RECOVERY,\n\tRPROC_MAX_FEATURES,\n};\n\n \nstruct rproc {\n\tstruct list_head node;\n\tstruct iommu_domain *domain;\n\tconst char *name;\n\tconst char *firmware;\n\tvoid *priv;\n\tstruct rproc_ops *ops;\n\tstruct device dev;\n\tatomic_t power;\n\tunsigned int state;\n\tenum rproc_dump_mechanism dump_conf;\n\tstruct mutex lock;\n\tstruct dentry *dbg_dir;\n\tstruct list_head traces;\n\tint num_traces;\n\tstruct list_head carveouts;\n\tstruct list_head mappings;\n\tu64 bootaddr;\n\tstruct list_head rvdevs;\n\tstruct list_head subdevs;\n\tstruct idr notifyids;\n\tint index;\n\tstruct work_struct crash_handler;\n\tunsigned int crash_cnt;\n\tbool recovery_disabled;\n\tint max_notifyid;\n\tstruct resource_table *table_ptr;\n\tstruct resource_table *clean_table;\n\tstruct resource_table *cached_table;\n\tsize_t table_sz;\n\tbool has_iommu;\n\tbool auto_boot;\n\tbool sysfs_read_only;\n\tstruct list_head dump_segments;\n\tint nb_vdev;\n\tu8 elf_class;\n\tu16 elf_machine;\n\tstruct cdev cdev;\n\tbool cdev_put_on_release;\n\tDECLARE_BITMAP(features, RPROC_MAX_FEATURES);\n};\n\n \nstruct rproc_subdev {\n\tstruct list_head node;\n\n\tint (*prepare)(struct rproc_subdev *subdev);\n\tint (*start)(struct rproc_subdev *subdev);\n\tvoid (*stop)(struct rproc_subdev *subdev, bool crashed);\n\tvoid (*unprepare)(struct rproc_subdev *subdev);\n};\n\n \n\n#define RVDEV_NUM_VRINGS 2\n\n \nstruct rproc_vring {\n\tvoid *va;\n\tint num;\n\tu32 da;\n\tu32 align;\n\tint notifyid;\n\tstruct rproc_vdev *rvdev;\n\tstruct virtqueue *vq;\n};\n\n \nstruct rproc_vdev {\n\n\tstruct rproc_subdev subdev;\n\tstruct platform_device *pdev;\n\n\tunsigned int id;\n\tstruct list_head node;\n\tstruct rproc *rproc;\n\tstruct rproc_vring vring[RVDEV_NUM_VRINGS];\n\tu32 rsc_offset;\n\tu32 index;\n};\n\nstruct rproc *rproc_get_by_phandle(phandle phandle);\nstruct rproc *rproc_get_by_child(struct device *dev);\n\nstruct rproc *rproc_alloc(struct device *dev, const char *name,\n\t\t\t  const struct rproc_ops *ops,\n\t\t\t  const char *firmware, int len);\nvoid rproc_put(struct rproc *rproc);\nint rproc_add(struct rproc *rproc);\nint rproc_del(struct rproc *rproc);\nvoid rproc_free(struct rproc *rproc);\nvoid rproc_resource_cleanup(struct rproc *rproc);\n\nstruct rproc *devm_rproc_alloc(struct device *dev, const char *name,\n\t\t\t       const struct rproc_ops *ops,\n\t\t\t       const char *firmware, int len);\nint devm_rproc_add(struct device *dev, struct rproc *rproc);\n\nvoid rproc_add_carveout(struct rproc *rproc, struct rproc_mem_entry *mem);\n\nstruct rproc_mem_entry *\nrproc_mem_entry_init(struct device *dev,\n\t\t     void *va, dma_addr_t dma, size_t len, u32 da,\n\t\t     int (*alloc)(struct rproc *, struct rproc_mem_entry *),\n\t\t     int (*release)(struct rproc *, struct rproc_mem_entry *),\n\t\t     const char *name, ...);\n\nstruct rproc_mem_entry *\nrproc_of_resm_mem_entry_init(struct device *dev, u32 of_resm_idx, size_t len,\n\t\t\t     u32 da, const char *name, ...);\n\nint rproc_boot(struct rproc *rproc);\nint rproc_shutdown(struct rproc *rproc);\nint rproc_detach(struct rproc *rproc);\nint rproc_set_firmware(struct rproc *rproc, const char *fw_name);\nvoid rproc_report_crash(struct rproc *rproc, enum rproc_crash_type type);\nvoid *rproc_da_to_va(struct rproc *rproc, u64 da, size_t len, bool *is_iomem);\n\n \nvoid rproc_coredump_cleanup(struct rproc *rproc);\nvoid rproc_coredump(struct rproc *rproc);\nvoid rproc_coredump_using_sections(struct rproc *rproc);\nint rproc_coredump_add_segment(struct rproc *rproc, dma_addr_t da, size_t size);\nint rproc_coredump_add_custom_segment(struct rproc *rproc,\n\t\t\t\t      dma_addr_t da, size_t size,\n\t\t\t\t      void (*dumpfn)(struct rproc *rproc,\n\t\t\t\t\t\t     struct rproc_dump_segment *segment,\n\t\t\t\t\t\t     void *dest, size_t offset,\n\t\t\t\t\t\t     size_t size),\n\t\t\t\t      void *priv);\nint rproc_coredump_set_elf_info(struct rproc *rproc, u8 class, u16 machine);\n\nvoid rproc_add_subdev(struct rproc *rproc, struct rproc_subdev *subdev);\n\nvoid rproc_remove_subdev(struct rproc *rproc, struct rproc_subdev *subdev);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}