{
  "module_name": "switchtec.h",
  "hash_id": "ba6552ba825ba2715392eaf3627dbe8baceb4ee23eea5e0a09657b1e821a3b2a",
  "original_prompt": "Ingested from linux-6.6.14/include/linux/switchtec.h",
  "human_readable_source": " \n \n\n#ifndef _SWITCHTEC_H\n#define _SWITCHTEC_H\n\n#include <linux/pci.h>\n#include <linux/cdev.h>\n\n#define SWITCHTEC_MRPC_PAYLOAD_SIZE 1024\n#define SWITCHTEC_MAX_PFF_CSR 255\n\n#define SWITCHTEC_EVENT_OCCURRED BIT(0)\n#define SWITCHTEC_EVENT_CLEAR    BIT(0)\n#define SWITCHTEC_EVENT_EN_LOG   BIT(1)\n#define SWITCHTEC_EVENT_EN_CLI   BIT(2)\n#define SWITCHTEC_EVENT_EN_IRQ   BIT(3)\n#define SWITCHTEC_EVENT_FATAL    BIT(4)\n#define SWITCHTEC_EVENT_NOT_SUPP BIT(31)\n\n#define SWITCHTEC_DMA_MRPC_EN\tBIT(0)\n\n#define MRPC_GAS_READ\t\t0x29\n#define MRPC_GAS_WRITE\t\t0x87\n#define MRPC_CMD_ID(x)\t\t((x) & 0xffff)\n\nenum {\n\tSWITCHTEC_GAS_MRPC_OFFSET       = 0x0000,\n\tSWITCHTEC_GAS_TOP_CFG_OFFSET    = 0x1000,\n\tSWITCHTEC_GAS_SW_EVENT_OFFSET   = 0x1800,\n\tSWITCHTEC_GAS_SYS_INFO_OFFSET   = 0x2000,\n\tSWITCHTEC_GAS_FLASH_INFO_OFFSET = 0x2200,\n\tSWITCHTEC_GAS_PART_CFG_OFFSET   = 0x4000,\n\tSWITCHTEC_GAS_NTB_OFFSET        = 0x10000,\n\tSWITCHTEC_GAS_PFF_CSR_OFFSET    = 0x134000,\n};\n\nenum switchtec_gen {\n\tSWITCHTEC_GEN3,\n\tSWITCHTEC_GEN4,\n\tSWITCHTEC_GEN5,\n};\n\nstruct mrpc_regs {\n\tu8 input_data[SWITCHTEC_MRPC_PAYLOAD_SIZE];\n\tu8 output_data[SWITCHTEC_MRPC_PAYLOAD_SIZE];\n\tu32 cmd;\n\tu32 status;\n\tu32 ret_value;\n\tu32 dma_en;\n\tu64 dma_addr;\n\tu32 dma_vector;\n\tu32 dma_ver;\n} __packed;\n\nenum mrpc_status {\n\tSWITCHTEC_MRPC_STATUS_INPROGRESS = 1,\n\tSWITCHTEC_MRPC_STATUS_DONE = 2,\n\tSWITCHTEC_MRPC_STATUS_ERROR = 0xFF,\n\tSWITCHTEC_MRPC_STATUS_INTERRUPTED = 0x100,\n};\n\nstruct sw_event_regs {\n\tu64 event_report_ctrl;\n\tu64 reserved1;\n\tu64 part_event_bitmap;\n\tu64 reserved2;\n\tu32 global_summary;\n\tu32 reserved3[3];\n\tu32 stack_error_event_hdr;\n\tu32 stack_error_event_data;\n\tu32 reserved4[4];\n\tu32 ppu_error_event_hdr;\n\tu32 ppu_error_event_data;\n\tu32 reserved5[4];\n\tu32 isp_error_event_hdr;\n\tu32 isp_error_event_data;\n\tu32 reserved6[4];\n\tu32 sys_reset_event_hdr;\n\tu32 reserved7[5];\n\tu32 fw_exception_hdr;\n\tu32 reserved8[5];\n\tu32 fw_nmi_hdr;\n\tu32 reserved9[5];\n\tu32 fw_non_fatal_hdr;\n\tu32 reserved10[5];\n\tu32 fw_fatal_hdr;\n\tu32 reserved11[5];\n\tu32 twi_mrpc_comp_hdr;\n\tu32 twi_mrpc_comp_data;\n\tu32 reserved12[4];\n\tu32 twi_mrpc_comp_async_hdr;\n\tu32 twi_mrpc_comp_async_data;\n\tu32 reserved13[4];\n\tu32 cli_mrpc_comp_hdr;\n\tu32 cli_mrpc_comp_data;\n\tu32 reserved14[4];\n\tu32 cli_mrpc_comp_async_hdr;\n\tu32 cli_mrpc_comp_async_data;\n\tu32 reserved15[4];\n\tu32 gpio_interrupt_hdr;\n\tu32 gpio_interrupt_data;\n\tu32 reserved16[4];\n\tu32 gfms_event_hdr;\n\tu32 gfms_event_data;\n\tu32 reserved17[4];\n} __packed;\n\nenum {\n\tSWITCHTEC_GEN3_CFG0_RUNNING = 0x04,\n\tSWITCHTEC_GEN3_CFG1_RUNNING = 0x05,\n\tSWITCHTEC_GEN3_IMG0_RUNNING = 0x03,\n\tSWITCHTEC_GEN3_IMG1_RUNNING = 0x07,\n};\n\nenum {\n\tSWITCHTEC_GEN4_MAP0_RUNNING = 0x00,\n\tSWITCHTEC_GEN4_MAP1_RUNNING = 0x01,\n\tSWITCHTEC_GEN4_KEY0_RUNNING = 0x02,\n\tSWITCHTEC_GEN4_KEY1_RUNNING = 0x03,\n\tSWITCHTEC_GEN4_BL2_0_RUNNING = 0x04,\n\tSWITCHTEC_GEN4_BL2_1_RUNNING = 0x05,\n\tSWITCHTEC_GEN4_CFG0_RUNNING = 0x06,\n\tSWITCHTEC_GEN4_CFG1_RUNNING = 0x07,\n\tSWITCHTEC_GEN4_IMG0_RUNNING = 0x08,\n\tSWITCHTEC_GEN4_IMG1_RUNNING = 0x09,\n};\n\nenum {\n\tSWITCHTEC_GEN4_KEY0_ACTIVE = 0,\n\tSWITCHTEC_GEN4_KEY1_ACTIVE = 1,\n\tSWITCHTEC_GEN4_BL2_0_ACTIVE = 0,\n\tSWITCHTEC_GEN4_BL2_1_ACTIVE = 1,\n\tSWITCHTEC_GEN4_CFG0_ACTIVE = 0,\n\tSWITCHTEC_GEN4_CFG1_ACTIVE = 1,\n\tSWITCHTEC_GEN4_IMG0_ACTIVE = 0,\n\tSWITCHTEC_GEN4_IMG1_ACTIVE = 1,\n};\n\nstruct sys_info_regs_gen3 {\n\tu32 reserved1;\n\tu32 vendor_table_revision;\n\tu32 table_format_version;\n\tu32 partition_id;\n\tu32 cfg_file_fmt_version;\n\tu16 cfg_running;\n\tu16 img_running;\n\tu32 reserved2[57];\n\tchar vendor_id[8];\n\tchar product_id[16];\n\tchar product_revision[4];\n\tchar component_vendor[8];\n\tu16 component_id;\n\tu8 component_revision;\n} __packed;\n\nstruct sys_info_regs_gen4 {\n\tu16 gas_layout_ver;\n\tu8 evlist_ver;\n\tu8 reserved1;\n\tu16 mgmt_cmd_set_ver;\n\tu16 fabric_cmd_set_ver;\n\tu32 reserved2[2];\n\tu8 mrpc_uart_ver;\n\tu8 mrpc_twi_ver;\n\tu8 mrpc_eth_ver;\n\tu8 mrpc_inband_ver;\n\tu32 reserved3[7];\n\tu32 fw_update_tmo;\n\tu32 xml_version_cfg;\n\tu32 xml_version_img;\n\tu32 partition_id;\n\tu16 bl2_running;\n\tu16 cfg_running;\n\tu16 img_running;\n\tu16 key_running;\n\tu32 reserved4[43];\n\tu32 vendor_seeprom_twi;\n\tu32 vendor_table_revision;\n\tu32 vendor_specific_info[2];\n\tu16 p2p_vendor_id;\n\tu16 p2p_device_id;\n\tu8 p2p_revision_id;\n\tu8 reserved5[3];\n\tu32 p2p_class_id;\n\tu16 subsystem_vendor_id;\n\tu16 subsystem_id;\n\tu32 p2p_serial_number[2];\n\tu8 mac_addr[6];\n\tu8 reserved6[2];\n\tu32 reserved7[3];\n\tchar vendor_id[8];\n\tchar product_id[24];\n\tchar  product_revision[2];\n\tu16 reserved8;\n} __packed;\n\nstruct sys_info_regs {\n\tu32 device_id;\n\tu32 device_version;\n\tu32 firmware_version;\n\tunion {\n\t\tstruct sys_info_regs_gen3 gen3;\n\t\tstruct sys_info_regs_gen4 gen4;\n\t};\n} __packed;\n\nstruct partition_info {\n\tu32 address;\n\tu32 length;\n};\n\nstruct flash_info_regs_gen3 {\n\tu32 flash_part_map_upd_idx;\n\n\tstruct active_partition_info_gen3 {\n\t\tu32 address;\n\t\tu32 build_version;\n\t\tu32 build_string;\n\t} active_img;\n\n\tstruct active_partition_info_gen3 active_cfg;\n\tstruct active_partition_info_gen3 inactive_img;\n\tstruct active_partition_info_gen3 inactive_cfg;\n\n\tu32 flash_length;\n\n\tstruct partition_info cfg0;\n\tstruct partition_info cfg1;\n\tstruct partition_info img0;\n\tstruct partition_info img1;\n\tstruct partition_info nvlog;\n\tstruct partition_info vendor[8];\n};\n\nstruct flash_info_regs_gen4 {\n\tu32 flash_address;\n\tu32 flash_length;\n\n\tstruct active_partition_info_gen4 {\n\t\tunsigned char bl2;\n\t\tunsigned char cfg;\n\t\tunsigned char img;\n\t\tunsigned char key;\n\t} active_flag;\n\n\tu32 reserved[3];\n\n\tstruct partition_info map0;\n\tstruct partition_info map1;\n\tstruct partition_info key0;\n\tstruct partition_info key1;\n\tstruct partition_info bl2_0;\n\tstruct partition_info bl2_1;\n\tstruct partition_info cfg0;\n\tstruct partition_info cfg1;\n\tstruct partition_info img0;\n\tstruct partition_info img1;\n\tstruct partition_info nvlog;\n\tstruct partition_info vendor[8];\n};\n\nstruct flash_info_regs {\n\tunion {\n\t\tstruct flash_info_regs_gen3 gen3;\n\t\tstruct flash_info_regs_gen4 gen4;\n\t};\n};\n\nenum {\n\tSWITCHTEC_NTB_REG_INFO_OFFSET   = 0x0000,\n\tSWITCHTEC_NTB_REG_CTRL_OFFSET   = 0x4000,\n\tSWITCHTEC_NTB_REG_DBMSG_OFFSET  = 0x64000,\n};\n\nstruct ntb_info_regs {\n\tu8  partition_count;\n\tu8  partition_id;\n\tu16 reserved1;\n\tu64 ep_map;\n\tu16 requester_id;\n\tu16 reserved2;\n\tu32 reserved3[4];\n\tstruct nt_partition_info {\n\t\tu32 xlink_enabled;\n\t\tu32 target_part_low;\n\t\tu32 target_part_high;\n\t\tu32 reserved;\n\t} ntp_info[48];\n} __packed;\n\nstruct part_cfg_regs {\n\tu32 status;\n\tu32 state;\n\tu32 port_cnt;\n\tu32 usp_port_mode;\n\tu32 usp_pff_inst_id;\n\tu32 vep_pff_inst_id;\n\tu32 dsp_pff_inst_id[47];\n\tu32 reserved1[11];\n\tu16 vep_vector_number;\n\tu16 usp_vector_number;\n\tu32 port_event_bitmap;\n\tu32 reserved2[3];\n\tu32 part_event_summary;\n\tu32 reserved3[3];\n\tu32 part_reset_hdr;\n\tu32 part_reset_data[5];\n\tu32 mrpc_comp_hdr;\n\tu32 mrpc_comp_data[5];\n\tu32 mrpc_comp_async_hdr;\n\tu32 mrpc_comp_async_data[5];\n\tu32 dyn_binding_hdr;\n\tu32 dyn_binding_data[5];\n\tu32 intercomm_notify_hdr;\n\tu32 intercomm_notify_data[5];\n\tu32 reserved4[153];\n} __packed;\n\nenum {\n\tNTB_CTRL_PART_OP_LOCK = 0x1,\n\tNTB_CTRL_PART_OP_CFG = 0x2,\n\tNTB_CTRL_PART_OP_RESET = 0x3,\n\n\tNTB_CTRL_PART_STATUS_NORMAL = 0x1,\n\tNTB_CTRL_PART_STATUS_LOCKED = 0x2,\n\tNTB_CTRL_PART_STATUS_LOCKING = 0x3,\n\tNTB_CTRL_PART_STATUS_CONFIGURING = 0x4,\n\tNTB_CTRL_PART_STATUS_RESETTING = 0x5,\n\n\tNTB_CTRL_BAR_VALID = 1 << 0,\n\tNTB_CTRL_BAR_DIR_WIN_EN = 1 << 4,\n\tNTB_CTRL_BAR_LUT_WIN_EN = 1 << 5,\n\n\tNTB_CTRL_REQ_ID_EN = 1 << 0,\n\n\tNTB_CTRL_LUT_EN = 1 << 0,\n};\n\nstruct ntb_ctrl_regs {\n\tu32 partition_status;\n\tu32 partition_op;\n\tu32 partition_ctrl;\n\tu32 bar_setup;\n\tu32 bar_error;\n\tu16 lut_table_entries;\n\tu16 lut_table_offset;\n\tu32 lut_error;\n\tu16 req_id_table_size;\n\tu16 req_id_table_offset;\n\tu32 req_id_error;\n\tu32 reserved1[7];\n\tstruct {\n\t\tu32 ctl;\n\t\tu32 win_size;\n\t\tu64 xlate_addr;\n\t} bar_entry[6];\n\tstruct {\n\t\tu32 win_size;\n\t\tu32 reserved[3];\n\t} bar_ext_entry[6];\n\tu32 reserved2[192];\n\tu32 req_id_table[512];\n\tu32 reserved3[256];\n\tu64 lut_entry[512];\n} __packed;\n\n#define NTB_DBMSG_IMSG_STATUS BIT_ULL(32)\n#define NTB_DBMSG_IMSG_MASK   BIT_ULL(40)\n\nstruct ntb_dbmsg_regs {\n\tu32 reserved1[1024];\n\tu64 odb;\n\tu64 odb_mask;\n\tu64 idb;\n\tu64 idb_mask;\n\tu8  idb_vec_map[64];\n\tu32 msg_map;\n\tu32 reserved2;\n\tstruct {\n\t\tu32 msg;\n\t\tu32 status;\n\t} omsg[4];\n\n\tstruct {\n\t\tu32 msg;\n\t\tu8  status;\n\t\tu8  mask;\n\t\tu8  src;\n\t\tu8  reserved;\n\t} imsg[4];\n\n\tu8 reserved3[3928];\n\tu8 msix_table[1024];\n\tu8 reserved4[3072];\n\tu8 pba[24];\n\tu8 reserved5[4072];\n} __packed;\n\nenum {\n\tSWITCHTEC_PART_CFG_EVENT_RESET = 1 << 0,\n\tSWITCHTEC_PART_CFG_EVENT_MRPC_CMP = 1 << 1,\n\tSWITCHTEC_PART_CFG_EVENT_MRPC_ASYNC_CMP = 1 << 2,\n\tSWITCHTEC_PART_CFG_EVENT_DYN_PART_CMP = 1 << 3,\n};\n\nstruct pff_csr_regs {\n\tu16 vendor_id;\n\tu16 device_id;\n\tu16 pcicmd;\n\tu16 pcists;\n\tu32 pci_class;\n\tu32 pci_opts;\n\tunion {\n\t\tu32 pci_bar[6];\n\t\tu64 pci_bar64[3];\n\t};\n\tu32 pci_cardbus;\n\tu32 pci_subsystem_id;\n\tu32 pci_expansion_rom;\n\tu32 pci_cap_ptr;\n\tu32 reserved1;\n\tu32 pci_irq;\n\tu32 pci_cap_region[48];\n\tu32 pcie_cap_region[448];\n\tu32 indirect_gas_window[128];\n\tu32 indirect_gas_window_off;\n\tu32 reserved[127];\n\tu32 pff_event_summary;\n\tu32 reserved2[3];\n\tu32 aer_in_p2p_hdr;\n\tu32 aer_in_p2p_data[5];\n\tu32 aer_in_vep_hdr;\n\tu32 aer_in_vep_data[5];\n\tu32 dpc_hdr;\n\tu32 dpc_data[5];\n\tu32 cts_hdr;\n\tu32 cts_data[5];\n\tu32 uec_hdr;\n\tu32 uec_data[5];\n\tu32 hotplug_hdr;\n\tu32 hotplug_data[5];\n\tu32 ier_hdr;\n\tu32 ier_data[5];\n\tu32 threshold_hdr;\n\tu32 threshold_data[5];\n\tu32 power_mgmt_hdr;\n\tu32 power_mgmt_data[5];\n\tu32 tlp_throttling_hdr;\n\tu32 tlp_throttling_data[5];\n\tu32 force_speed_hdr;\n\tu32 force_speed_data[5];\n\tu32 credit_timeout_hdr;\n\tu32 credit_timeout_data[5];\n\tu32 link_state_hdr;\n\tu32 link_state_data[5];\n\tu32 reserved4[174];\n} __packed;\n\nstruct switchtec_ntb;\n\nstruct dma_mrpc_output {\n\tu32 status;\n\tu32 cmd_id;\n\tu32 rtn_code;\n\tu32 output_size;\n\tu8 data[SWITCHTEC_MRPC_PAYLOAD_SIZE];\n};\n\nstruct switchtec_dev {\n\tstruct pci_dev *pdev;\n\tstruct device dev;\n\tstruct cdev cdev;\n\n\tenum switchtec_gen gen;\n\n\tint partition;\n\tint partition_count;\n\tint pff_csr_count;\n\tchar pff_local[SWITCHTEC_MAX_PFF_CSR];\n\n\tvoid __iomem *mmio;\n\tstruct mrpc_regs __iomem *mmio_mrpc;\n\tstruct sw_event_regs __iomem *mmio_sw_event;\n\tstruct sys_info_regs __iomem *mmio_sys_info;\n\tstruct flash_info_regs __iomem *mmio_flash_info;\n\tstruct ntb_info_regs __iomem *mmio_ntb;\n\tstruct part_cfg_regs __iomem *mmio_part_cfg;\n\tstruct part_cfg_regs __iomem *mmio_part_cfg_all;\n\tstruct pff_csr_regs __iomem *mmio_pff_csr;\n\n\t \n\tstruct mutex mrpc_mutex;\n\tstruct list_head mrpc_queue;\n\tint mrpc_busy;\n\tstruct work_struct mrpc_work;\n\tstruct delayed_work mrpc_timeout;\n\tbool alive;\n\n\twait_queue_head_t event_wq;\n\tatomic_t event_cnt;\n\n\tstruct work_struct link_event_work;\n\tvoid (*link_notifier)(struct switchtec_dev *stdev);\n\tu8 link_event_count[SWITCHTEC_MAX_PFF_CSR];\n\n\tstruct switchtec_ntb *sndev;\n\n\tstruct dma_mrpc_output *dma_mrpc;\n\tdma_addr_t dma_mrpc_dma_addr;\n};\n\nstatic inline struct switchtec_dev *to_stdev(struct device *dev)\n{\n\treturn container_of(dev, struct switchtec_dev, dev);\n}\n\nextern struct class *switchtec_class;\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}