{
  "module_name": "rio.h",
  "hash_id": "f9ebe1f7094c2cf08a691d2decc4826d974be44e2da3f0fa21fb7d18259dfce0",
  "original_prompt": "Ingested from linux-6.6.14/include/linux/rio.h",
  "human_readable_source": " \n \n\n#ifndef LINUX_RIO_H\n#define LINUX_RIO_H\n\n#include <linux/types.h>\n#include <linux/ioport.h>\n#include <linux/list.h>\n#include <linux/errno.h>\n#include <linux/device.h>\n#include <linux/rio_regs.h>\n#include <linux/mod_devicetable.h>\n#ifdef CONFIG_RAPIDIO_DMA_ENGINE\n#include <linux/dmaengine.h>\n#endif\n\n#define RIO_NO_HOPCOUNT\t\t-1\n#define RIO_INVALID_DESTID\t0xffff\n\n#define RIO_MAX_MPORTS\t\t8\n#define RIO_MAX_MPORT_RESOURCES\t16\n#define RIO_MAX_DEV_RESOURCES\t16\n#define RIO_MAX_MPORT_NAME\t40\n\n#define RIO_GLOBAL_TABLE\t0xff\t \n\n#define RIO_INVALID_ROUTE\t0xff\t \n\n#define RIO_MAX_ROUTE_ENTRIES(size)\t(size ? (1 << 16) : (1 << 8))\n#define RIO_ANY_DESTID(size)\t\t(size ? 0xffff : 0xff)\n\n#define RIO_MAX_MBOX\t\t4\n#define RIO_MAX_MSG_SIZE\t0x1000\n\n \n#define RIO_SUCCESSFUL\t\t\t0x00\n#define RIO_BAD_SIZE\t\t\t0x81\n\n \n#define RIO_DOORBELL_RESOURCE\t0\n#define RIO_INB_MBOX_RESOURCE\t1\n#define RIO_OUTB_MBOX_RESOURCE\t2\n\n#define RIO_PW_MSG_SIZE\t\t64\n\n \n#define RIO_CTAG_RESRVD\t0xfffe0000  \n#define RIO_CTAG_UDEVID\t0x0001ffff  \n\nextern struct bus_type rio_bus_type;\nextern struct class rio_mport_class;\n\nstruct rio_mport;\nstruct rio_dev;\nunion rio_pw_msg;\n\n \nstruct rio_switch {\n\tstruct list_head node;\n\tu8 *route_table;\n\tu32 port_ok;\n\tstruct rio_switch_ops *ops;\n\tspinlock_t lock;\n\tstruct rio_dev *nextdev[];\n};\n\n \nstruct rio_switch_ops {\n\tstruct module *owner;\n\tint (*add_entry) (struct rio_mport *mport, u16 destid, u8 hopcount,\n\t\t\t  u16 table, u16 route_destid, u8 route_port);\n\tint (*get_entry) (struct rio_mport *mport, u16 destid, u8 hopcount,\n\t\t\t  u16 table, u16 route_destid, u8 *route_port);\n\tint (*clr_table) (struct rio_mport *mport, u16 destid, u8 hopcount,\n\t\t\t  u16 table);\n\tint (*set_domain) (struct rio_mport *mport, u16 destid, u8 hopcount,\n\t\t\t   u8 sw_domain);\n\tint (*get_domain) (struct rio_mport *mport, u16 destid, u8 hopcount,\n\t\t\t   u8 *sw_domain);\n\tint (*em_init) (struct rio_dev *dev);\n\tint (*em_handle) (struct rio_dev *dev, u8 swport);\n};\n\nenum rio_device_state {\n\tRIO_DEVICE_INITIALIZING,\n\tRIO_DEVICE_RUNNING,\n\tRIO_DEVICE_GONE,\n\tRIO_DEVICE_SHUTDOWN,\n};\n\n \nstruct rio_dev {\n\tstruct list_head global_list;\t \n\tstruct list_head net_list;\t \n\tstruct rio_net *net;\t \n\tbool do_enum;\n\tu16 did;\n\tu16 vid;\n\tu32 device_rev;\n\tu16 asm_did;\n\tu16 asm_vid;\n\tu16 asm_rev;\n\tu16 efptr;\n\tu32 pef;\n\tu32 swpinfo;\n\tu32 src_ops;\n\tu32 dst_ops;\n\tu32 comp_tag;\n\tu32 phys_efptr;\n\tu32 phys_rmap;\n\tu32 em_efptr;\n\tu64 dma_mask;\n\tstruct rio_driver *driver;\t \n\tstruct device dev;\t \n\tstruct resource riores[RIO_MAX_DEV_RESOURCES];\n\tint (*pwcback) (struct rio_dev *rdev, union rio_pw_msg *msg, int step);\n\tu16 destid;\n\tu8 hopcount;\n\tstruct rio_dev *prev;\n\tatomic_t state;\n\tstruct rio_switch rswitch[];\t \n};\n\n#define rio_dev_g(n) list_entry(n, struct rio_dev, global_list)\n#define rio_dev_f(n) list_entry(n, struct rio_dev, net_list)\n#define\tto_rio_dev(n) container_of(n, struct rio_dev, dev)\n#define sw_to_rio_dev(n) container_of(n, struct rio_dev, rswitch[0])\n#define\tto_rio_mport(n) container_of(n, struct rio_mport, dev)\n#define\tto_rio_net(n) container_of(n, struct rio_net, dev)\n\n \nstruct rio_msg {\n\tstruct resource *res;\n\tvoid (*mcback) (struct rio_mport * mport, void *dev_id, int mbox, int slot);\n};\n\n \nstruct rio_dbell {\n\tstruct list_head node;\n\tstruct resource *res;\n\tvoid (*dinb) (struct rio_mport *mport, void *dev_id, u16 src, u16 dst, u16 info);\n\tvoid *dev_id;\n};\n\n \nstruct rio_mport {\n\tstruct list_head dbells;\t \n\tstruct list_head pwrites;\t \n\tstruct list_head node;\t \n\tstruct list_head nnode;\t \n\tstruct rio_net *net;\t \n\tstruct mutex lock;\n\tstruct resource iores;\n\tstruct resource riores[RIO_MAX_MPORT_RESOURCES];\n\tstruct rio_msg inb_msg[RIO_MAX_MBOX];\n\tstruct rio_msg outb_msg[RIO_MAX_MBOX];\n\tint host_deviceid;\t \n\tstruct rio_ops *ops;\t \n\tunsigned char id;\t \n\tunsigned char index;\t \n\tunsigned int sys_size;\t \n\tu32 phys_efptr;\n\tu32 phys_rmap;\n\tunsigned char name[RIO_MAX_MPORT_NAME];\n\tstruct device dev;\n\tvoid *priv;\t\t \n#ifdef CONFIG_RAPIDIO_DMA_ENGINE\n\tstruct dma_device\tdma;\n#endif\n\tstruct rio_scan *nscan;\n\tatomic_t state;\n\tunsigned int pwe_refcnt;\n};\n\nstatic inline int rio_mport_is_running(struct rio_mport *mport)\n{\n\treturn atomic_read(&mport->state) == RIO_DEVICE_RUNNING;\n}\n\n \n#define RIO_SCAN_ENUM_NO_WAIT\t0x00000001  \n\n \nstruct rio_net {\n\tstruct list_head node;\t \n\tstruct list_head devices;\t \n\tstruct list_head switches;\t \n\tstruct list_head mports;\t \n\tstruct rio_mport *hport;\t \n\tunsigned char id;\t \n\tstruct device dev;\n\tvoid *enum_data;\t \n\tvoid (*release)(struct rio_net *net);\n};\n\nenum rio_link_speed {\n\tRIO_LINK_DOWN = 0,  \n\tRIO_LINK_125 = 1,  \n\tRIO_LINK_250 = 2,  \n\tRIO_LINK_312 = 3,  \n\tRIO_LINK_500 = 4,  \n\tRIO_LINK_625 = 5   \n};\n\nenum rio_link_width {\n\tRIO_LINK_1X  = 0,\n\tRIO_LINK_1XR = 1,\n\tRIO_LINK_2X  = 3,\n\tRIO_LINK_4X  = 2,\n\tRIO_LINK_8X  = 4,\n\tRIO_LINK_16X = 5\n};\n\nenum rio_mport_flags {\n\tRIO_MPORT_DMA\t = (1 << 0),  \n\tRIO_MPORT_DMA_SG = (1 << 1),  \n\tRIO_MPORT_IBSG\t = (1 << 2),  \n};\n\n \nstruct rio_mport_attr {\n\tint flags;\n\tint link_speed;\n\tint link_width;\n\n\t \n\tint dma_max_sge;\n\tint dma_max_size;\n\tint dma_align;\n};\n\n \n\n \nstruct rio_ops {\n\tint (*lcread) (struct rio_mport *mport, int index, u32 offset, int len,\n\t\t\tu32 *data);\n\tint (*lcwrite) (struct rio_mport *mport, int index, u32 offset, int len,\n\t\t\tu32 data);\n\tint (*cread) (struct rio_mport *mport, int index, u16 destid,\n\t\t\tu8 hopcount, u32 offset, int len, u32 *data);\n\tint (*cwrite) (struct rio_mport *mport, int index, u16 destid,\n\t\t\tu8 hopcount, u32 offset, int len, u32 data);\n\tint (*dsend) (struct rio_mport *mport, int index, u16 destid, u16 data);\n\tint (*pwenable) (struct rio_mport *mport, int enable);\n\tint (*open_outb_mbox)(struct rio_mport *mport, void *dev_id,\n\t\t\t      int mbox, int entries);\n\tvoid (*close_outb_mbox)(struct rio_mport *mport, int mbox);\n\tint  (*open_inb_mbox)(struct rio_mport *mport, void *dev_id,\n\t\t\t     int mbox, int entries);\n\tvoid (*close_inb_mbox)(struct rio_mport *mport, int mbox);\n\tint  (*add_outb_message)(struct rio_mport *mport, struct rio_dev *rdev,\n\t\t\t\t int mbox, void *buffer, size_t len);\n\tint (*add_inb_buffer)(struct rio_mport *mport, int mbox, void *buf);\n\tvoid *(*get_inb_message)(struct rio_mport *mport, int mbox);\n\tint (*map_inb)(struct rio_mport *mport, dma_addr_t lstart,\n\t\t\tu64 rstart, u64 size, u32 flags);\n\tvoid (*unmap_inb)(struct rio_mport *mport, dma_addr_t lstart);\n\tint (*query_mport)(struct rio_mport *mport,\n\t\t\t   struct rio_mport_attr *attr);\n\tint (*map_outb)(struct rio_mport *mport, u16 destid, u64 rstart,\n\t\t\tu32 size, u32 flags, dma_addr_t *laddr);\n\tvoid (*unmap_outb)(struct rio_mport *mport, u16 destid, u64 rstart);\n};\n\n#define RIO_RESOURCE_MEM\t0x00000100\n#define RIO_RESOURCE_DOORBELL\t0x00000200\n#define RIO_RESOURCE_MAILBOX\t0x00000400\n\n#define RIO_RESOURCE_CACHEABLE\t0x00010000\n#define RIO_RESOURCE_PCI\t0x00020000\n\n#define RIO_RESOURCE_BUSY\t0x80000000\n\n \nstruct rio_driver {\n\tstruct list_head node;\n\tchar *name;\n\tconst struct rio_device_id *id_table;\n\tint (*probe) (struct rio_dev * dev, const struct rio_device_id * id);\n\tvoid (*remove) (struct rio_dev * dev);\n\tvoid (*shutdown)(struct rio_dev *dev);\n\tint (*suspend) (struct rio_dev * dev, u32 state);\n\tint (*resume) (struct rio_dev * dev);\n\tint (*enable_wake) (struct rio_dev * dev, u32 state, int enable);\n\tstruct device_driver driver;\n};\n\n#define\tto_rio_driver(drv) container_of(drv,struct rio_driver, driver)\n\nunion rio_pw_msg {\n\tstruct {\n\t\tu32 comptag;\t \n\t\tu32 errdetect;\t \n\t\tu32 is_port;\t \n\t\tu32 ltlerrdet;\t \n\t\tu32 padding[12];\n\t} em;\n\tu32 raw[RIO_PW_MSG_SIZE/sizeof(u32)];\n};\n\n#ifdef CONFIG_RAPIDIO_DMA_ENGINE\n\n \nenum rio_write_type {\n\tRDW_DEFAULT,\t\t \n\tRDW_ALL_NWRITE,\t\t \n\tRDW_ALL_NWRITE_R,\t \n\tRDW_LAST_NWRITE_R,\t \n};\n\nstruct rio_dma_ext {\n\tu16 destid;\n\tu64 rio_addr;\t \n\tu8  rio_addr_u;   \n\tenum rio_write_type wr_type;  \n};\n\nstruct rio_dma_data {\n\t \n\tstruct scatterlist\t*sg;\t \n\tunsigned int\t\tsg_len;\t \n\t \n\tu64 rio_addr;\t \n\tu8  rio_addr_u;   \n\tenum rio_write_type wr_type;  \n};\n\nstatic inline struct rio_mport *dma_to_mport(struct dma_device *ddev)\n{\n\treturn container_of(ddev, struct rio_mport, dma);\n}\n#endif  \n\n \nstruct rio_scan {\n\tstruct module *owner;\n\tint (*enumerate)(struct rio_mport *mport, u32 flags);\n\tint (*discover)(struct rio_mport *mport, u32 flags);\n};\n\n \nstruct rio_scan_node {\n\tint mport_id;\n\tstruct list_head node;\n\tstruct rio_scan *ops;\n};\n\n \nextern int rio_mport_initialize(struct rio_mport *);\nextern int rio_register_mport(struct rio_mport *);\nextern int rio_unregister_mport(struct rio_mport *);\nextern int rio_open_inb_mbox(struct rio_mport *, void *, int, int);\nextern void rio_close_inb_mbox(struct rio_mport *, int);\nextern int rio_open_outb_mbox(struct rio_mport *, void *, int, int);\nextern void rio_close_outb_mbox(struct rio_mport *, int);\nextern int rio_query_mport(struct rio_mport *port,\n\t\t\t   struct rio_mport_attr *mport_attr);\n\n#endif\t\t\t\t \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}