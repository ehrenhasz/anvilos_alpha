{
  "module_name": "ocelot.h",
  "hash_id": "41f68d218d7d71f24a1e1217ddb9b6b0f8466a1876fc4fa906d5e3197e9e6ad1",
  "original_prompt": "Ingested from linux-6.6.14/include/linux/dsa/ocelot.h",
  "human_readable_source": " \n\n#ifndef _NET_DSA_TAG_OCELOT_H\n#define _NET_DSA_TAG_OCELOT_H\n\n#include <linux/kthread.h>\n#include <linux/packing.h>\n#include <linux/skbuff.h>\n#include <net/dsa.h>\n\nstruct ocelot_skb_cb {\n\tstruct sk_buff *clone;\n\tunsigned int ptp_class;  \n\tu32 tstamp_lo;\n\tu8 ptp_cmd;\n\tu8 ts_id;\n};\n\n#define OCELOT_SKB_CB(skb) \\\n\t((struct ocelot_skb_cb *)((skb)->cb))\n\n#define IFH_TAG_TYPE_C\t\t\t0\n#define IFH_TAG_TYPE_S\t\t\t1\n\n#define IFH_REW_OP_NOOP\t\t\t0x0\n#define IFH_REW_OP_DSCP\t\t\t0x1\n#define IFH_REW_OP_ONE_STEP_PTP\t\t0x2\n#define IFH_REW_OP_TWO_STEP_PTP\t\t0x3\n#define IFH_REW_OP_ORIGIN_PTP\t\t0x5\n\n#define OCELOT_TAG_LEN\t\t\t16\n#define OCELOT_SHORT_PREFIX_LEN\t\t4\n#define OCELOT_LONG_PREFIX_LEN\t\t16\n#define OCELOT_TOTAL_TAG_LEN\t(OCELOT_SHORT_PREFIX_LEN + OCELOT_TAG_LEN)\n\n \n\nstruct felix_deferred_xmit_work {\n\tstruct dsa_port *dp;\n\tstruct sk_buff *skb;\n\tstruct kthread_work work;\n};\n\nstruct ocelot_8021q_tagger_data {\n\tvoid (*xmit_work_fn)(struct kthread_work *work);\n};\n\nstatic inline struct ocelot_8021q_tagger_data *\nocelot_8021q_tagger_data(struct dsa_switch *ds)\n{\n\tBUG_ON(ds->dst->tag_ops->proto != DSA_TAG_PROTO_OCELOT_8021Q);\n\n\treturn ds->tagger_data;\n}\n\nstatic inline void ocelot_xfh_get_rew_val(void *extraction, u64 *rew_val)\n{\n\tpacking(extraction, rew_val, 116, 85, OCELOT_TAG_LEN, UNPACK, 0);\n}\n\nstatic inline void ocelot_xfh_get_len(void *extraction, u64 *len)\n{\n\tu64 llen, wlen;\n\n\tpacking(extraction, &llen, 84, 79, OCELOT_TAG_LEN, UNPACK, 0);\n\tpacking(extraction, &wlen, 78, 71, OCELOT_TAG_LEN, UNPACK, 0);\n\n\t*len = 60 * wlen + llen - 80;\n}\n\nstatic inline void ocelot_xfh_get_src_port(void *extraction, u64 *src_port)\n{\n\tpacking(extraction, src_port, 46, 43, OCELOT_TAG_LEN, UNPACK, 0);\n}\n\nstatic inline void ocelot_xfh_get_qos_class(void *extraction, u64 *qos_class)\n{\n\tpacking(extraction, qos_class, 19, 17, OCELOT_TAG_LEN, UNPACK, 0);\n}\n\nstatic inline void ocelot_xfh_get_tag_type(void *extraction, u64 *tag_type)\n{\n\tpacking(extraction, tag_type, 16, 16, OCELOT_TAG_LEN, UNPACK, 0);\n}\n\nstatic inline void ocelot_xfh_get_vlan_tci(void *extraction, u64 *vlan_tci)\n{\n\tpacking(extraction, vlan_tci, 15, 0, OCELOT_TAG_LEN, UNPACK, 0);\n}\n\nstatic inline void ocelot_ifh_set_bypass(void *injection, u64 bypass)\n{\n\tpacking(injection, &bypass, 127, 127, OCELOT_TAG_LEN, PACK, 0);\n}\n\nstatic inline void ocelot_ifh_set_rew_op(void *injection, u64 rew_op)\n{\n\tpacking(injection, &rew_op, 125, 117, OCELOT_TAG_LEN, PACK, 0);\n}\n\nstatic inline void ocelot_ifh_set_dest(void *injection, u64 dest)\n{\n\tpacking(injection, &dest, 67, 56, OCELOT_TAG_LEN, PACK, 0);\n}\n\nstatic inline void ocelot_ifh_set_qos_class(void *injection, u64 qos_class)\n{\n\tpacking(injection, &qos_class, 19, 17, OCELOT_TAG_LEN, PACK, 0);\n}\n\nstatic inline void seville_ifh_set_dest(void *injection, u64 dest)\n{\n\tpacking(injection, &dest, 67, 57, OCELOT_TAG_LEN, PACK, 0);\n}\n\nstatic inline void ocelot_ifh_set_src(void *injection, u64 src)\n{\n\tpacking(injection, &src, 46, 43, OCELOT_TAG_LEN, PACK, 0);\n}\n\nstatic inline void ocelot_ifh_set_tag_type(void *injection, u64 tag_type)\n{\n\tpacking(injection, &tag_type, 16, 16, OCELOT_TAG_LEN, PACK, 0);\n}\n\nstatic inline void ocelot_ifh_set_vlan_tci(void *injection, u64 vlan_tci)\n{\n\tpacking(injection, &vlan_tci, 15, 0, OCELOT_TAG_LEN, PACK, 0);\n}\n\n \nstatic inline u32 ocelot_ptp_rew_op(struct sk_buff *skb)\n{\n\tstruct sk_buff *clone = OCELOT_SKB_CB(skb)->clone;\n\tu8 ptp_cmd = OCELOT_SKB_CB(skb)->ptp_cmd;\n\tu32 rew_op = 0;\n\n\tif (ptp_cmd == IFH_REW_OP_TWO_STEP_PTP && clone) {\n\t\trew_op = ptp_cmd;\n\t\trew_op |= OCELOT_SKB_CB(clone)->ts_id << 3;\n\t} else if (ptp_cmd == IFH_REW_OP_ORIGIN_PTP) {\n\t\trew_op = ptp_cmd;\n\t}\n\n\treturn rew_op;\n}\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}