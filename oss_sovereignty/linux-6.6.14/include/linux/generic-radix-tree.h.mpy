{
  "module_name": "generic-radix-tree.h",
  "hash_id": "1144046e239797c68e56727f52779489c9d7cc16746c4c37d8b3c6a168eac423",
  "original_prompt": "Ingested from linux-6.6.14/include/linux/generic-radix-tree.h",
  "human_readable_source": "#ifndef _LINUX_GENERIC_RADIX_TREE_H\n#define _LINUX_GENERIC_RADIX_TREE_H\n\n \n\n#include <asm/page.h>\n#include <linux/bug.h>\n#include <linux/limits.h>\n#include <linux/log2.h>\n#include <linux/math.h>\n#include <linux/types.h>\n\nstruct genradix_root;\n\nstruct __genradix {\n\tstruct genradix_root\t\t*root;\n};\n\n \n\n#define __GENRADIX_INITIALIZER\t\t\t\t\t\\\n\t{\t\t\t\t\t\t\t\\\n\t\t.tree = {\t\t\t\t\t\\\n\t\t\t.root = NULL,\t\t\t\t\\\n\t\t}\t\t\t\t\t\t\\\n\t}\n\n \n\n#define GENRADIX(_type)\t\t\t\t\t\t\\\nstruct {\t\t\t\t\t\t\t\\\n\tstruct __genradix\ttree;\t\t\t\t\\\n\t_type\t\t\ttype[0] __aligned(1);\t\t\\\n}\n\n#define DEFINE_GENRADIX(_name, _type)\t\t\t\t\\\n\tGENRADIX(_type) _name = __GENRADIX_INITIALIZER\n\n \n#define genradix_init(_radix)\t\t\t\t\t\\\ndo {\t\t\t\t\t\t\t\t\\\n\t*(_radix) = (typeof(*_radix)) __GENRADIX_INITIALIZER;\t\\\n} while (0)\n\nvoid __genradix_free(struct __genradix *);\n\n \n#define genradix_free(_radix)\t__genradix_free(&(_radix)->tree)\n\nstatic inline size_t __idx_to_offset(size_t idx, size_t obj_size)\n{\n\tif (__builtin_constant_p(obj_size))\n\t\tBUILD_BUG_ON(obj_size > PAGE_SIZE);\n\telse\n\t\tBUG_ON(obj_size > PAGE_SIZE);\n\n\tif (!is_power_of_2(obj_size)) {\n\t\tsize_t objs_per_page = PAGE_SIZE / obj_size;\n\n\t\treturn (idx / objs_per_page) * PAGE_SIZE +\n\t\t\t(idx % objs_per_page) * obj_size;\n\t} else {\n\t\treturn idx * obj_size;\n\t}\n}\n\n#define __genradix_cast(_radix)\t\t(typeof((_radix)->type[0]) *)\n#define __genradix_obj_size(_radix)\tsizeof((_radix)->type[0])\n#define __genradix_idx_to_offset(_radix, _idx)\t\t\t\\\n\t__idx_to_offset(_idx, __genradix_obj_size(_radix))\n\nvoid *__genradix_ptr(struct __genradix *, size_t);\n\n \n#define genradix_ptr(_radix, _idx)\t\t\t\t\\\n\t(__genradix_cast(_radix)\t\t\t\t\\\n\t __genradix_ptr(&(_radix)->tree,\t\t\t\\\n\t\t\t__genradix_idx_to_offset(_radix, _idx)))\n\nvoid *__genradix_ptr_alloc(struct __genradix *, size_t, gfp_t);\n\n \n#define genradix_ptr_alloc(_radix, _idx, _gfp)\t\t\t\\\n\t(__genradix_cast(_radix)\t\t\t\t\\\n\t __genradix_ptr_alloc(&(_radix)->tree,\t\t\t\\\n\t\t\t__genradix_idx_to_offset(_radix, _idx),\t\\\n\t\t\t_gfp))\n\nstruct genradix_iter {\n\tsize_t\t\t\toffset;\n\tsize_t\t\t\tpos;\n};\n\n \n#define genradix_iter_init(_radix, _idx)\t\t\t\\\n\t((struct genradix_iter) {\t\t\t\t\\\n\t\t.pos\t= (_idx),\t\t\t\t\\\n\t\t.offset\t= __genradix_idx_to_offset((_radix), (_idx)),\\\n\t})\n\nvoid *__genradix_iter_peek(struct genradix_iter *, struct __genradix *, size_t);\n\n \n#define genradix_iter_peek(_iter, _radix)\t\t\t\\\n\t(__genradix_cast(_radix)\t\t\t\t\\\n\t __genradix_iter_peek(_iter, &(_radix)->tree,\t\t\\\n\t\t\t      PAGE_SIZE / __genradix_obj_size(_radix)))\n\nstatic inline void __genradix_iter_advance(struct genradix_iter *iter,\n\t\t\t\t\t   size_t obj_size)\n{\n\tif (iter->offset + obj_size < iter->offset) {\n\t\titer->offset\t= SIZE_MAX;\n\t\titer->pos\t= SIZE_MAX;\n\t\treturn;\n\t}\n\n\titer->offset += obj_size;\n\n\tif (!is_power_of_2(obj_size) &&\n\t    (iter->offset & (PAGE_SIZE - 1)) + obj_size > PAGE_SIZE)\n\t\titer->offset = round_up(iter->offset, PAGE_SIZE);\n\n\titer->pos++;\n}\n\n#define genradix_iter_advance(_iter, _radix)\t\t\t\\\n\t__genradix_iter_advance(_iter, __genradix_obj_size(_radix))\n\n#define genradix_for_each_from(_radix, _iter, _p, _start)\t\\\n\tfor (_iter = genradix_iter_init(_radix, _start);\t\\\n\t     (_p = genradix_iter_peek(&_iter, _radix)) != NULL;\t\\\n\t     genradix_iter_advance(&_iter, _radix))\n\n \n#define genradix_for_each(_radix, _iter, _p)\t\t\t\\\n\tgenradix_for_each_from(_radix, _iter, _p, 0)\n\nint __genradix_prealloc(struct __genradix *, size_t, gfp_t);\n\n \n#define genradix_prealloc(_radix, _nr, _gfp)\t\t\t\\\n\t __genradix_prealloc(&(_radix)->tree,\t\t\t\\\n\t\t\t__genradix_idx_to_offset(_radix, _nr + 1),\\\n\t\t\t_gfp)\n\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}