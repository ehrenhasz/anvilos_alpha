{
  "module_name": "cs_dsp.h",
  "hash_id": "79d65fb8972802e6e93c94abecda52577e24ae7af934de3b6610e194464255bf",
  "original_prompt": "Ingested from linux-6.6.14/include/linux/firmware/cirrus/cs_dsp.h",
  "human_readable_source": " \n \n#ifndef __CS_DSP_H\n#define __CS_DSP_H\n\n#include <linux/bits.h>\n#include <linux/device.h>\n#include <linux/firmware.h>\n#include <linux/list.h>\n#include <linux/regmap.h>\n\n#define CS_ADSP2_REGION_0 BIT(0)\n#define CS_ADSP2_REGION_1 BIT(1)\n#define CS_ADSP2_REGION_2 BIT(2)\n#define CS_ADSP2_REGION_3 BIT(3)\n#define CS_ADSP2_REGION_4 BIT(4)\n#define CS_ADSP2_REGION_5 BIT(5)\n#define CS_ADSP2_REGION_6 BIT(6)\n#define CS_ADSP2_REGION_7 BIT(7)\n#define CS_ADSP2_REGION_8 BIT(8)\n#define CS_ADSP2_REGION_9 BIT(9)\n#define CS_ADSP2_REGION_1_9 (CS_ADSP2_REGION_1 | \\\n\t\tCS_ADSP2_REGION_2 | CS_ADSP2_REGION_3 | \\\n\t\tCS_ADSP2_REGION_4 | CS_ADSP2_REGION_5 | \\\n\t\tCS_ADSP2_REGION_6 | CS_ADSP2_REGION_7 | \\\n\t\tCS_ADSP2_REGION_8 | CS_ADSP2_REGION_9)\n#define CS_ADSP2_REGION_ALL (CS_ADSP2_REGION_0 | CS_ADSP2_REGION_1_9)\n\n#define CS_DSP_DATA_WORD_SIZE                3\n#define CS_DSP_DATA_WORD_BITS                (3 * BITS_PER_BYTE)\n\n#define CS_DSP_ACKED_CTL_TIMEOUT_MS          100\n#define CS_DSP_ACKED_CTL_N_QUICKPOLLS        10\n#define CS_DSP_ACKED_CTL_MIN_VALUE           0\n#define CS_DSP_ACKED_CTL_MAX_VALUE           0xFFFFFF\n\n \nstruct cs_dsp_region {\n\tint type;\n\tunsigned int base;\n};\n\n \nstruct cs_dsp_alg_region {\n\tstruct list_head list;\n\tunsigned int alg;\n\tunsigned int ver;\n\tint type;\n\tunsigned int base;\n};\n\n \nstruct cs_dsp_coeff_ctl {\n\tstruct list_head list;\n\tstruct cs_dsp *dsp;\n\tvoid *cache;\n\tconst char *fw_name;\n\t \n\tconst char *subname;\n\tunsigned int subname_len;\n\tunsigned int offset;\n\tsize_t len;\n\tunsigned int type;\n\tunsigned int flags;\n\tunsigned int set:1;\n\tunsigned int enabled:1;\n\tstruct cs_dsp_alg_region alg_region;\n\n\tvoid *priv;\n};\n\nstruct cs_dsp_ops;\nstruct cs_dsp_client_ops;\n\n \nstruct cs_dsp {\n\tconst char *name;\n\tint rev;\n\tint num;\n\tint type;\n\tstruct device *dev;\n\tstruct regmap *regmap;\n\n\tconst struct cs_dsp_ops *ops;\n\tconst struct cs_dsp_client_ops *client_ops;\n\n\tunsigned int base;\n\tunsigned int base_sysinfo;\n\tunsigned int sysclk_reg;\n\tunsigned int sysclk_mask;\n\tunsigned int sysclk_shift;\n\tbool no_core_startstop;\n\n\tstruct list_head alg_regions;\n\n\tconst char *fw_name;\n\tunsigned int fw_id;\n\tunsigned int fw_id_version;\n\tunsigned int fw_vendor_id;\n\n\tconst struct cs_dsp_region *mem;\n\tint num_mems;\n\n\tint fw_ver;\n\n\tbool booted;\n\tbool running;\n\n\tstruct list_head ctl_list;\n\n\tstruct mutex pwr_lock;\n\n\tunsigned int lock_regions;\n\n#ifdef CONFIG_DEBUG_FS\n\tstruct dentry *debugfs_root;\n\tchar *wmfw_file_name;\n\tchar *bin_file_name;\n#endif\n};\n\n \nstruct cs_dsp_client_ops {\n\tint (*control_add)(struct cs_dsp_coeff_ctl *ctl);\n\tvoid (*control_remove)(struct cs_dsp_coeff_ctl *ctl);\n\tint (*pre_run)(struct cs_dsp *dsp);\n\tint (*post_run)(struct cs_dsp *dsp);\n\tvoid (*pre_stop)(struct cs_dsp *dsp);\n\tvoid (*post_stop)(struct cs_dsp *dsp);\n\tvoid (*watchdog_expired)(struct cs_dsp *dsp);\n};\n\nint cs_dsp_adsp1_init(struct cs_dsp *dsp);\nint cs_dsp_adsp2_init(struct cs_dsp *dsp);\nint cs_dsp_halo_init(struct cs_dsp *dsp);\n\nint cs_dsp_adsp1_power_up(struct cs_dsp *dsp,\n\t\t\t  const struct firmware *wmfw_firmware, char *wmfw_filename,\n\t\t\t  const struct firmware *coeff_firmware, char *coeff_filename,\n\t\t\t  const char *fw_name);\nvoid cs_dsp_adsp1_power_down(struct cs_dsp *dsp);\nint cs_dsp_power_up(struct cs_dsp *dsp,\n\t\t    const struct firmware *wmfw_firmware, char *wmfw_filename,\n\t\t    const struct firmware *coeff_firmware, char *coeff_filename,\n\t\t    const char *fw_name);\nvoid cs_dsp_power_down(struct cs_dsp *dsp);\nint cs_dsp_run(struct cs_dsp *dsp);\nvoid cs_dsp_stop(struct cs_dsp *dsp);\n\nvoid cs_dsp_remove(struct cs_dsp *dsp);\n\nint cs_dsp_set_dspclk(struct cs_dsp *dsp, unsigned int freq);\nvoid cs_dsp_adsp2_bus_error(struct cs_dsp *dsp);\nvoid cs_dsp_halo_bus_error(struct cs_dsp *dsp);\nvoid cs_dsp_halo_wdt_expire(struct cs_dsp *dsp);\n\nvoid cs_dsp_init_debugfs(struct cs_dsp *dsp, struct dentry *debugfs_root);\nvoid cs_dsp_cleanup_debugfs(struct cs_dsp *dsp);\n\nint cs_dsp_coeff_write_acked_control(struct cs_dsp_coeff_ctl *ctl, unsigned int event_id);\nint cs_dsp_coeff_write_ctrl(struct cs_dsp_coeff_ctl *ctl, unsigned int off,\n\t\t\t    const void *buf, size_t len);\nint cs_dsp_coeff_read_ctrl(struct cs_dsp_coeff_ctl *ctl, unsigned int off,\n\t\t\t   void *buf, size_t len);\nstruct cs_dsp_coeff_ctl *cs_dsp_get_ctl(struct cs_dsp *dsp, const char *name, int type,\n\t\t\t\t\tunsigned int alg);\n\nint cs_dsp_read_raw_data_block(struct cs_dsp *dsp, int mem_type, unsigned int mem_addr,\n\t\t\t       unsigned int num_words, __be32 *data);\nint cs_dsp_read_data_word(struct cs_dsp *dsp, int mem_type, unsigned int mem_addr, u32 *data);\nint cs_dsp_write_data_word(struct cs_dsp *dsp, int mem_type, unsigned int mem_addr, u32 data);\nvoid cs_dsp_remove_padding(u32 *buf, int nwords);\n\nstruct cs_dsp_alg_region *cs_dsp_find_alg_region(struct cs_dsp *dsp,\n\t\t\t\t\t\t int type, unsigned int id);\n\nconst char *cs_dsp_mem_region_name(unsigned int type);\n\n \nstruct cs_dsp_chunk {\n\tu8 *data;\n\tu8 *max;\n\tint bytes;\n\n\tu32 cache;\n\tint cachebits;\n};\n\n \nstatic inline struct cs_dsp_chunk cs_dsp_chunk(void *data, int size)\n{\n\tstruct cs_dsp_chunk ch = {\n\t\t.data = data,\n\t\t.max = data + size,\n\t};\n\n\treturn ch;\n}\n\n \nstatic inline bool cs_dsp_chunk_end(struct cs_dsp_chunk *ch)\n{\n\treturn ch->data == ch->max;\n}\n\n \nstatic inline int cs_dsp_chunk_bytes(struct cs_dsp_chunk *ch)\n{\n\treturn ch->bytes;\n}\n\n \nstatic inline bool cs_dsp_chunk_valid_addr(struct cs_dsp_chunk *ch, void *addr)\n{\n\treturn (u8 *)addr >= ch->data && (u8 *)addr < ch->max;\n}\n\nint cs_dsp_chunk_write(struct cs_dsp_chunk *ch, int nbits, u32 val);\nint cs_dsp_chunk_flush(struct cs_dsp_chunk *ch);\nint cs_dsp_chunk_read(struct cs_dsp_chunk *ch, int nbits);\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}