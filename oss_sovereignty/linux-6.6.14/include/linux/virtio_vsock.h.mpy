{
  "module_name": "virtio_vsock.h",
  "hash_id": "2848cf776e172ae562ec07d8216849c6cf68176ff2baa739b9de2e907dad75dd",
  "original_prompt": "Ingested from linux-6.6.14/include/linux/virtio_vsock.h",
  "human_readable_source": " \n#ifndef _LINUX_VIRTIO_VSOCK_H\n#define _LINUX_VIRTIO_VSOCK_H\n\n#include <uapi/linux/virtio_vsock.h>\n#include <linux/socket.h>\n#include <net/sock.h>\n#include <net/af_vsock.h>\n\n#define VIRTIO_VSOCK_SKB_HEADROOM (sizeof(struct virtio_vsock_hdr))\n\nstruct virtio_vsock_skb_cb {\n\tbool reply;\n\tbool tap_delivered;\n};\n\n#define VIRTIO_VSOCK_SKB_CB(skb) ((struct virtio_vsock_skb_cb *)((skb)->cb))\n\nstatic inline struct virtio_vsock_hdr *virtio_vsock_hdr(struct sk_buff *skb)\n{\n\treturn (struct virtio_vsock_hdr *)skb->head;\n}\n\nstatic inline bool virtio_vsock_skb_reply(struct sk_buff *skb)\n{\n\treturn VIRTIO_VSOCK_SKB_CB(skb)->reply;\n}\n\nstatic inline void virtio_vsock_skb_set_reply(struct sk_buff *skb)\n{\n\tVIRTIO_VSOCK_SKB_CB(skb)->reply = true;\n}\n\nstatic inline bool virtio_vsock_skb_tap_delivered(struct sk_buff *skb)\n{\n\treturn VIRTIO_VSOCK_SKB_CB(skb)->tap_delivered;\n}\n\nstatic inline void virtio_vsock_skb_set_tap_delivered(struct sk_buff *skb)\n{\n\tVIRTIO_VSOCK_SKB_CB(skb)->tap_delivered = true;\n}\n\nstatic inline void virtio_vsock_skb_clear_tap_delivered(struct sk_buff *skb)\n{\n\tVIRTIO_VSOCK_SKB_CB(skb)->tap_delivered = false;\n}\n\nstatic inline void virtio_vsock_skb_rx_put(struct sk_buff *skb)\n{\n\tu32 len;\n\n\tlen = le32_to_cpu(virtio_vsock_hdr(skb)->len);\n\n\tif (len > 0)\n\t\tskb_put(skb, len);\n}\n\nstatic inline struct sk_buff *virtio_vsock_alloc_skb(unsigned int size, gfp_t mask)\n{\n\tstruct sk_buff *skb;\n\n\tif (size < VIRTIO_VSOCK_SKB_HEADROOM)\n\t\treturn NULL;\n\n\tskb = alloc_skb(size, mask);\n\tif (!skb)\n\t\treturn NULL;\n\n\tskb_reserve(skb, VIRTIO_VSOCK_SKB_HEADROOM);\n\treturn skb;\n}\n\nstatic inline void\nvirtio_vsock_skb_queue_head(struct sk_buff_head *list, struct sk_buff *skb)\n{\n\tspin_lock_bh(&list->lock);\n\t__skb_queue_head(list, skb);\n\tspin_unlock_bh(&list->lock);\n}\n\nstatic inline void\nvirtio_vsock_skb_queue_tail(struct sk_buff_head *list, struct sk_buff *skb)\n{\n\tspin_lock_bh(&list->lock);\n\t__skb_queue_tail(list, skb);\n\tspin_unlock_bh(&list->lock);\n}\n\nstatic inline struct sk_buff *virtio_vsock_skb_dequeue(struct sk_buff_head *list)\n{\n\tstruct sk_buff *skb;\n\n\tspin_lock_bh(&list->lock);\n\tskb = __skb_dequeue(list);\n\tspin_unlock_bh(&list->lock);\n\n\treturn skb;\n}\n\nstatic inline void virtio_vsock_skb_queue_purge(struct sk_buff_head *list)\n{\n\tspin_lock_bh(&list->lock);\n\t__skb_queue_purge(list);\n\tspin_unlock_bh(&list->lock);\n}\n\nstatic inline size_t virtio_vsock_skb_len(struct sk_buff *skb)\n{\n\treturn (size_t)(skb_end_pointer(skb) - skb->head);\n}\n\n#define VIRTIO_VSOCK_DEFAULT_RX_BUF_SIZE\t(1024 * 4)\n#define VIRTIO_VSOCK_MAX_BUF_SIZE\t\t0xFFFFFFFFUL\n#define VIRTIO_VSOCK_MAX_PKT_BUF_SIZE\t\t(1024 * 64)\n\nenum {\n\tVSOCK_VQ_RX     = 0,  \n\tVSOCK_VQ_TX     = 1,  \n\tVSOCK_VQ_EVENT  = 2,\n\tVSOCK_VQ_MAX    = 3,\n};\n\n \nstruct virtio_vsock_sock {\n\tstruct vsock_sock *vsk;\n\n\tspinlock_t tx_lock;\n\tspinlock_t rx_lock;\n\n\t \n\tu32 tx_cnt;\n\tu32 peer_fwd_cnt;\n\tu32 peer_buf_alloc;\n\n\t \n\tu32 fwd_cnt;\n\tu32 last_fwd_cnt;\n\tu32 rx_bytes;\n\tu32 buf_alloc;\n\tstruct sk_buff_head rx_queue;\n\tu32 msg_count;\n};\n\nstruct virtio_vsock_pkt_info {\n\tu32 remote_cid, remote_port;\n\tstruct vsock_sock *vsk;\n\tstruct msghdr *msg;\n\tu32 pkt_len;\n\tu16 type;\n\tu16 op;\n\tu32 flags;\n\tbool reply;\n};\n\nstruct virtio_transport {\n\t \n\tstruct vsock_transport transport;\n\n\t \n\tint (*send_pkt)(struct sk_buff *skb);\n};\n\nssize_t\nvirtio_transport_stream_dequeue(struct vsock_sock *vsk,\n\t\t\t\tstruct msghdr *msg,\n\t\t\t\tsize_t len,\n\t\t\t\tint type);\nint\nvirtio_transport_dgram_dequeue(struct vsock_sock *vsk,\n\t\t\t       struct msghdr *msg,\n\t\t\t       size_t len, int flags);\n\nint\nvirtio_transport_seqpacket_enqueue(struct vsock_sock *vsk,\n\t\t\t\t   struct msghdr *msg,\n\t\t\t\t   size_t len);\nssize_t\nvirtio_transport_seqpacket_dequeue(struct vsock_sock *vsk,\n\t\t\t\t   struct msghdr *msg,\n\t\t\t\t   int flags);\ns64 virtio_transport_stream_has_data(struct vsock_sock *vsk);\ns64 virtio_transport_stream_has_space(struct vsock_sock *vsk);\nu32 virtio_transport_seqpacket_has_data(struct vsock_sock *vsk);\n\nint virtio_transport_do_socket_init(struct vsock_sock *vsk,\n\t\t\t\t struct vsock_sock *psk);\nint\nvirtio_transport_notify_poll_in(struct vsock_sock *vsk,\n\t\t\t\tsize_t target,\n\t\t\t\tbool *data_ready_now);\nint\nvirtio_transport_notify_poll_out(struct vsock_sock *vsk,\n\t\t\t\t size_t target,\n\t\t\t\t bool *space_available_now);\n\nint virtio_transport_notify_recv_init(struct vsock_sock *vsk,\n\tsize_t target, struct vsock_transport_recv_notify_data *data);\nint virtio_transport_notify_recv_pre_block(struct vsock_sock *vsk,\n\tsize_t target, struct vsock_transport_recv_notify_data *data);\nint virtio_transport_notify_recv_pre_dequeue(struct vsock_sock *vsk,\n\tsize_t target, struct vsock_transport_recv_notify_data *data);\nint virtio_transport_notify_recv_post_dequeue(struct vsock_sock *vsk,\n\tsize_t target, ssize_t copied, bool data_read,\n\tstruct vsock_transport_recv_notify_data *data);\nint virtio_transport_notify_send_init(struct vsock_sock *vsk,\n\tstruct vsock_transport_send_notify_data *data);\nint virtio_transport_notify_send_pre_block(struct vsock_sock *vsk,\n\tstruct vsock_transport_send_notify_data *data);\nint virtio_transport_notify_send_pre_enqueue(struct vsock_sock *vsk,\n\tstruct vsock_transport_send_notify_data *data);\nint virtio_transport_notify_send_post_enqueue(struct vsock_sock *vsk,\n\tssize_t written, struct vsock_transport_send_notify_data *data);\nvoid virtio_transport_notify_buffer_size(struct vsock_sock *vsk, u64 *val);\n\nu64 virtio_transport_stream_rcvhiwat(struct vsock_sock *vsk);\nbool virtio_transport_stream_is_active(struct vsock_sock *vsk);\nbool virtio_transport_stream_allow(u32 cid, u32 port);\nint virtio_transport_dgram_bind(struct vsock_sock *vsk,\n\t\t\t\tstruct sockaddr_vm *addr);\nbool virtio_transport_dgram_allow(u32 cid, u32 port);\n\nint virtio_transport_connect(struct vsock_sock *vsk);\n\nint virtio_transport_shutdown(struct vsock_sock *vsk, int mode);\n\nvoid virtio_transport_release(struct vsock_sock *vsk);\n\nssize_t\nvirtio_transport_stream_enqueue(struct vsock_sock *vsk,\n\t\t\t\tstruct msghdr *msg,\n\t\t\t\tsize_t len);\nint\nvirtio_transport_dgram_enqueue(struct vsock_sock *vsk,\n\t\t\t       struct sockaddr_vm *remote_addr,\n\t\t\t       struct msghdr *msg,\n\t\t\t       size_t len);\n\nvoid virtio_transport_destruct(struct vsock_sock *vsk);\n\nvoid virtio_transport_recv_pkt(struct virtio_transport *t,\n\t\t\t       struct sk_buff *skb);\nvoid virtio_transport_inc_tx_pkt(struct virtio_vsock_sock *vvs, struct sk_buff *skb);\nu32 virtio_transport_get_credit(struct virtio_vsock_sock *vvs, u32 wanted);\nvoid virtio_transport_put_credit(struct virtio_vsock_sock *vvs, u32 credit);\nvoid virtio_transport_deliver_tap_pkt(struct sk_buff *skb);\nint virtio_transport_purge_skbs(void *vsk, struct sk_buff_head *list);\nint virtio_transport_read_skb(struct vsock_sock *vsk, skb_read_actor_t read_actor);\nint virtio_transport_notify_set_rcvlowat(struct vsock_sock *vsk, int val);\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}