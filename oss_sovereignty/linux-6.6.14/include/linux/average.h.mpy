{
  "module_name": "average.h",
  "hash_id": "982ec7c922a5e9b424c095e39d79136114f6044d28868b7d4467056cf158aa03",
  "original_prompt": "Ingested from linux-6.6.14/include/linux/average.h",
  "human_readable_source": " \n#ifndef _LINUX_AVERAGE_H\n#define _LINUX_AVERAGE_H\n\n#include <linux/bug.h>\n#include <linux/compiler.h>\n#include <linux/log2.h>\n\n \n\n#define DECLARE_EWMA(name, _precision, _weight_rcp)\t\t\t\\\n\tstruct ewma_##name {\t\t\t\t\t\t\\\n\t\tunsigned long internal;\t\t\t\t\t\\\n\t};\t\t\t\t\t\t\t\t\\\n\tstatic inline void ewma_##name##_init(struct ewma_##name *e)\t\\\n\t{\t\t\t\t\t\t\t\t\\\n\t\tBUILD_BUG_ON(!__builtin_constant_p(_precision));\t\\\n\t\tBUILD_BUG_ON(!__builtin_constant_p(_weight_rcp));\t\\\n\t\t \t\t\t\t\t\t\t\\\n\t\tBUILD_BUG_ON((_precision) > 30);\t\t\t\\\n\t\tBUILD_BUG_ON_NOT_POWER_OF_2(_weight_rcp);\t\t\\\n\t\te->internal = 0;\t\t\t\t\t\\\n\t}\t\t\t\t\t\t\t\t\\\n\tstatic inline unsigned long\t\t\t\t\t\\\n\tewma_##name##_read(struct ewma_##name *e)\t\t\t\\\n\t{\t\t\t\t\t\t\t\t\\\n\t\tBUILD_BUG_ON(!__builtin_constant_p(_precision));\t\\\n\t\tBUILD_BUG_ON(!__builtin_constant_p(_weight_rcp));\t\\\n\t\tBUILD_BUG_ON((_precision) > 30);\t\t\t\\\n\t\tBUILD_BUG_ON_NOT_POWER_OF_2(_weight_rcp);\t\t\\\n\t\treturn e->internal >> (_precision);\t\t\t\\\n\t}\t\t\t\t\t\t\t\t\\\n\tstatic inline void ewma_##name##_add(struct ewma_##name *e,\t\\\n\t\t\t\t\t     unsigned long val)\t\t\\\n\t{\t\t\t\t\t\t\t\t\\\n\t\tunsigned long internal = READ_ONCE(e->internal);\t\\\n\t\tunsigned long weight_rcp = ilog2(_weight_rcp);\t\t\\\n\t\tunsigned long precision = _precision;\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\t\tBUILD_BUG_ON(!__builtin_constant_p(_precision));\t\\\n\t\tBUILD_BUG_ON(!__builtin_constant_p(_weight_rcp));\t\\\n\t\tBUILD_BUG_ON((_precision) > 30);\t\t\t\\\n\t\tBUILD_BUG_ON_NOT_POWER_OF_2(_weight_rcp);\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\t\tWRITE_ONCE(e->internal, internal ?\t\t\t\\\n\t\t\t(((internal << weight_rcp) - internal) +\t\\\n\t\t\t\t(val << precision)) >> weight_rcp :\t\\\n\t\t\t(val << precision));\t\t\t\t\\\n\t}\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}