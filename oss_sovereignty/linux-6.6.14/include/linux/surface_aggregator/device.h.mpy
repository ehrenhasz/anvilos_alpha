{
  "module_name": "device.h",
  "hash_id": "0c069d47c3de254f3eb0fcd798ed059e5e3654ff8d62a588e4b2c778facc397b",
  "original_prompt": "Ingested from linux-6.6.14/include/linux/surface_aggregator/device.h",
  "human_readable_source": " \n \n\n#ifndef _LINUX_SURFACE_AGGREGATOR_DEVICE_H\n#define _LINUX_SURFACE_AGGREGATOR_DEVICE_H\n\n#include <linux/device.h>\n#include <linux/mod_devicetable.h>\n#include <linux/property.h>\n#include <linux/types.h>\n\n#include <linux/surface_aggregator/controller.h>\n\n\n \n\n \nenum ssam_device_domain {\n\tSSAM_DOMAIN_VIRTUAL   = 0x00,\n\tSSAM_DOMAIN_SERIALHUB = 0x01,\n};\n\n \nenum ssam_virtual_tc {\n\tSSAM_VIRTUAL_TC_HUB = 0x00,\n};\n\n \nstruct ssam_device_uid {\n\tu8 domain;\n\tu8 category;\n\tu8 target;\n\tu8 instance;\n\tu8 function;\n};\n\n \n#define SSAM_SSH_TID_ANY\t0xffff\n#define SSAM_SSH_IID_ANY\t0xffff\n#define SSAM_SSH_FUN_ANY\t0xffff\n\n \n#define SSAM_DEVICE(d, cat, tid, iid, fun)\t\t\t\t\t\\\n\t.match_flags = (((tid) != SSAM_SSH_TID_ANY) ? SSAM_MATCH_TARGET : 0)\t\\\n\t\t     | (((iid) != SSAM_SSH_IID_ANY) ? SSAM_MATCH_INSTANCE : 0)\t\\\n\t\t     | (((fun) != SSAM_SSH_FUN_ANY) ? SSAM_MATCH_FUNCTION : 0),\t\\\n\t.domain   = d,\t\t\t\t\t\t\t\t\\\n\t.category = cat,\t\t\t\t\t\t\t\\\n\t.target   = __builtin_choose_expr((tid) != SSAM_SSH_TID_ANY, (tid), 0),\t\\\n\t.instance = __builtin_choose_expr((iid) != SSAM_SSH_IID_ANY, (iid), 0),\t\\\n\t.function = __builtin_choose_expr((fun) != SSAM_SSH_FUN_ANY, (fun), 0)\n\n \n#define SSAM_VDEV(cat, tid, iid, fun) \\\n\tSSAM_DEVICE(SSAM_DOMAIN_VIRTUAL, SSAM_VIRTUAL_TC_##cat, SSAM_SSH_TID_##tid, iid, fun)\n\n \n#define SSAM_SDEV(cat, tid, iid, fun) \\\n\tSSAM_DEVICE(SSAM_DOMAIN_SERIALHUB, SSAM_SSH_TC_##cat, SSAM_SSH_TID_##tid, iid, fun)\n\n \nenum ssam_device_flags {\n\tSSAM_DEVICE_HOT_REMOVED_BIT = 0,\n};\n\n \nstruct ssam_device {\n\tstruct device dev;\n\tstruct ssam_controller *ctrl;\n\n\tstruct ssam_device_uid uid;\n\n\tunsigned long flags;\n};\n\n \nstruct ssam_device_driver {\n\tstruct device_driver driver;\n\n\tconst struct ssam_device_id *match_table;\n\n\tint  (*probe)(struct ssam_device *sdev);\n\tvoid (*remove)(struct ssam_device *sdev);\n};\n\n#ifdef CONFIG_SURFACE_AGGREGATOR_BUS\n\nextern struct bus_type ssam_bus_type;\nextern const struct device_type ssam_device_type;\n\n \nstatic inline bool is_ssam_device(struct device *d)\n{\n\treturn d->type == &ssam_device_type;\n}\n\n#else  \n\nstatic inline bool is_ssam_device(struct device *d)\n{\n\treturn false;\n}\n\n#endif  \n\n \n#define to_ssam_device(d)\tcontainer_of_const(d, struct ssam_device, dev)\n\n \n#define to_ssam_device_driver(d)\tcontainer_of_const(d, struct ssam_device_driver, driver)\n\nconst struct ssam_device_id *ssam_device_id_match(const struct ssam_device_id *table,\n\t\t\t\t\t\t  const struct ssam_device_uid uid);\n\nconst struct ssam_device_id *ssam_device_get_match(const struct ssam_device *dev);\n\nconst void *ssam_device_get_match_data(const struct ssam_device *dev);\n\nstruct ssam_device *ssam_device_alloc(struct ssam_controller *ctrl,\n\t\t\t\t      struct ssam_device_uid uid);\n\nint ssam_device_add(struct ssam_device *sdev);\nvoid ssam_device_remove(struct ssam_device *sdev);\n\n \nstatic inline void ssam_device_mark_hot_removed(struct ssam_device *sdev)\n{\n\tdev_dbg(&sdev->dev, \"marking device as hot-removed\\n\");\n\tset_bit(SSAM_DEVICE_HOT_REMOVED_BIT, &sdev->flags);\n}\n\n \nstatic inline bool ssam_device_is_hot_removed(struct ssam_device *sdev)\n{\n\treturn test_bit(SSAM_DEVICE_HOT_REMOVED_BIT, &sdev->flags);\n}\n\n \nstatic inline struct ssam_device *ssam_device_get(struct ssam_device *sdev)\n{\n\treturn sdev ? to_ssam_device(get_device(&sdev->dev)) : NULL;\n}\n\n \nstatic inline void ssam_device_put(struct ssam_device *sdev)\n{\n\tif (sdev)\n\t\tput_device(&sdev->dev);\n}\n\n \nstatic inline void *ssam_device_get_drvdata(struct ssam_device *sdev)\n{\n\treturn dev_get_drvdata(&sdev->dev);\n}\n\n \nstatic inline void ssam_device_set_drvdata(struct ssam_device *sdev, void *data)\n{\n\tdev_set_drvdata(&sdev->dev, data);\n}\n\nint __ssam_device_driver_register(struct ssam_device_driver *d, struct module *o);\nvoid ssam_device_driver_unregister(struct ssam_device_driver *d);\n\n \n#define ssam_device_driver_register(drv) \\\n\t__ssam_device_driver_register(drv, THIS_MODULE)\n\n \n#define module_ssam_device_driver(drv)\t\t\t\\\n\tmodule_driver(drv, ssam_device_driver_register,\t\\\n\t\t      ssam_device_driver_unregister)\n\n\n \n\n#ifdef CONFIG_SURFACE_AGGREGATOR_BUS\n\nint __ssam_register_clients(struct device *parent, struct ssam_controller *ctrl,\n\t\t\t    struct fwnode_handle *node);\nvoid ssam_remove_clients(struct device *dev);\n\n#else  \n\nstatic inline int __ssam_register_clients(struct device *parent, struct ssam_controller *ctrl,\n\t\t\t\t\t  struct fwnode_handle *node)\n{\n\treturn 0;\n}\n\nstatic inline void ssam_remove_clients(struct device *dev) {}\n\n#endif  \n\n \nstatic inline int ssam_register_clients(struct device *dev, struct ssam_controller *ctrl)\n{\n\treturn __ssam_register_clients(dev, ctrl, dev_fwnode(dev));\n}\n\n \nstatic inline int ssam_device_register_clients(struct ssam_device *sdev)\n{\n\treturn ssam_register_clients(&sdev->dev, sdev->ctrl);\n}\n\n\n \n\n \n#define SSAM_DEFINE_SYNC_REQUEST_CL_N(name, spec...)\t\t\t\\\n\tSSAM_DEFINE_SYNC_REQUEST_MD_N(__raw_##name, spec)\t\t\\\n\tstatic int name(struct ssam_device *sdev)\t\t\t\\\n\t{\t\t\t\t\t\t\t\t\\\n\t\treturn __raw_##name(sdev->ctrl, sdev->uid.target,\t\\\n\t\t\t\t    sdev->uid.instance);\t\t\\\n\t}\n\n \n#define SSAM_DEFINE_SYNC_REQUEST_CL_W(name, atype, spec...)\t\t\\\n\tSSAM_DEFINE_SYNC_REQUEST_MD_W(__raw_##name, atype, spec)\t\\\n\tstatic int name(struct ssam_device *sdev, const atype *arg)\t\\\n\t{\t\t\t\t\t\t\t\t\\\n\t\treturn __raw_##name(sdev->ctrl, sdev->uid.target,\t\\\n\t\t\t\t    sdev->uid.instance, arg);\t\t\\\n\t}\n\n \n#define SSAM_DEFINE_SYNC_REQUEST_CL_R(name, rtype, spec...)\t\t\\\n\tSSAM_DEFINE_SYNC_REQUEST_MD_R(__raw_##name, rtype, spec)\t\\\n\tstatic int name(struct ssam_device *sdev, rtype *ret)\t\t\\\n\t{\t\t\t\t\t\t\t\t\\\n\t\treturn __raw_##name(sdev->ctrl, sdev->uid.target,\t\\\n\t\t\t\t    sdev->uid.instance, ret);\t\t\\\n\t}\n\n \n#define SSAM_DEFINE_SYNC_REQUEST_CL_WR(name, atype, rtype, spec...)\t\t\\\n\tSSAM_DEFINE_SYNC_REQUEST_MD_WR(__raw_##name, atype, rtype, spec)\t\\\n\tstatic int name(struct ssam_device *sdev, const atype *arg, rtype *ret)\t\\\n\t{\t\t\t\t\t\t\t\t\t\\\n\t\treturn __raw_##name(sdev->ctrl, sdev->uid.target,\t\t\\\n\t\t\t\t    sdev->uid.instance, arg, ret);\t\t\\\n\t}\n\n\n \n\n \nstatic inline int ssam_device_notifier_register(struct ssam_device *sdev,\n\t\t\t\t\t\tstruct ssam_event_notifier *n)\n{\n\t \n\tif (ssam_device_is_hot_removed(sdev))\n\t\treturn -ENODEV;\n\n\treturn ssam_notifier_register(sdev->ctrl, n);\n}\n\n \nstatic inline int ssam_device_notifier_unregister(struct ssam_device *sdev,\n\t\t\t\t\t\t  struct ssam_event_notifier *n)\n{\n\treturn __ssam_notifier_unregister(sdev->ctrl, n,\n\t\t\t\t\t  !ssam_device_is_hot_removed(sdev));\n}\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}