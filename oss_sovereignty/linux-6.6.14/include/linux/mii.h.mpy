{
  "module_name": "mii.h",
  "hash_id": "a64331bc3cf73fff6841deb319cac2e322e70f4a4db2d13718817501823a6f9f",
  "original_prompt": "Ingested from linux-6.6.14/include/linux/mii.h",
  "human_readable_source": " \n \n#ifndef __LINUX_MII_H__\n#define __LINUX_MII_H__\n\n\n#include <linux/if.h>\n#include <linux/linkmode.h>\n#include <uapi/linux/mii.h>\n\nstruct ethtool_cmd;\n\nstruct mii_if_info {\n\tint phy_id;\n\tint advertising;\n\tint phy_id_mask;\n\tint reg_num_mask;\n\n\tunsigned int full_duplex : 1;\t \n\tunsigned int force_media : 1;\t \n\tunsigned int supports_gmii : 1;  \n\n\tstruct net_device *dev;\n\tint (*mdio_read) (struct net_device *dev, int phy_id, int location);\n\tvoid (*mdio_write) (struct net_device *dev, int phy_id, int location, int val);\n};\n\nextern int mii_link_ok (struct mii_if_info *mii);\nextern int mii_nway_restart (struct mii_if_info *mii);\nextern void mii_ethtool_gset(struct mii_if_info *mii, struct ethtool_cmd *ecmd);\nextern void mii_ethtool_get_link_ksettings(\n\tstruct mii_if_info *mii, struct ethtool_link_ksettings *cmd);\nextern int mii_ethtool_sset(struct mii_if_info *mii, struct ethtool_cmd *ecmd);\nextern int mii_ethtool_set_link_ksettings(\n\tstruct mii_if_info *mii, const struct ethtool_link_ksettings *cmd);\nextern int mii_check_gmii_support(struct mii_if_info *mii);\nextern void mii_check_link (struct mii_if_info *mii);\nextern unsigned int mii_check_media (struct mii_if_info *mii,\n\t\t\t\t     unsigned int ok_to_print,\n\t\t\t\t     unsigned int init_media);\nextern int generic_mii_ioctl(struct mii_if_info *mii_if,\n\t\t\t     struct mii_ioctl_data *mii_data, int cmd,\n\t\t\t     unsigned int *duplex_changed);\n\n\nstatic inline struct mii_ioctl_data *if_mii(struct ifreq *rq)\n{\n\treturn (struct mii_ioctl_data *) &rq->ifr_ifru;\n}\n\n \nstatic inline unsigned int mii_nway_result (unsigned int negotiated)\n{\n\tunsigned int ret;\n\n\tif (negotiated & LPA_100FULL)\n\t\tret = LPA_100FULL;\n\telse if (negotiated & LPA_100BASE4)\n\t\tret = LPA_100BASE4;\n\telse if (negotiated & LPA_100HALF)\n\t\tret = LPA_100HALF;\n\telse if (negotiated & LPA_10FULL)\n\t\tret = LPA_10FULL;\n\telse\n\t\tret = LPA_10HALF;\n\n\treturn ret;\n}\n\n \nstatic inline unsigned int mii_duplex (unsigned int duplex_lock,\n\t\t\t\t       unsigned int negotiated)\n{\n\tif (duplex_lock)\n\t\treturn 1;\n\tif (mii_nway_result(negotiated) & LPA_DUPLEX)\n\t\treturn 1;\n\treturn 0;\n}\n\n \nstatic inline u32 ethtool_adv_to_mii_adv_t(u32 ethadv)\n{\n\tu32 result = 0;\n\n\tif (ethadv & ADVERTISED_10baseT_Half)\n\t\tresult |= ADVERTISE_10HALF;\n\tif (ethadv & ADVERTISED_10baseT_Full)\n\t\tresult |= ADVERTISE_10FULL;\n\tif (ethadv & ADVERTISED_100baseT_Half)\n\t\tresult |= ADVERTISE_100HALF;\n\tif (ethadv & ADVERTISED_100baseT_Full)\n\t\tresult |= ADVERTISE_100FULL;\n\tif (ethadv & ADVERTISED_Pause)\n\t\tresult |= ADVERTISE_PAUSE_CAP;\n\tif (ethadv & ADVERTISED_Asym_Pause)\n\t\tresult |= ADVERTISE_PAUSE_ASYM;\n\n\treturn result;\n}\n\n \nstatic inline u32 linkmode_adv_to_mii_adv_t(unsigned long *advertising)\n{\n\tu32 result = 0;\n\n\tif (linkmode_test_bit(ETHTOOL_LINK_MODE_10baseT_Half_BIT, advertising))\n\t\tresult |= ADVERTISE_10HALF;\n\tif (linkmode_test_bit(ETHTOOL_LINK_MODE_10baseT_Full_BIT, advertising))\n\t\tresult |= ADVERTISE_10FULL;\n\tif (linkmode_test_bit(ETHTOOL_LINK_MODE_100baseT_Half_BIT, advertising))\n\t\tresult |= ADVERTISE_100HALF;\n\tif (linkmode_test_bit(ETHTOOL_LINK_MODE_100baseT_Full_BIT, advertising))\n\t\tresult |= ADVERTISE_100FULL;\n\tif (linkmode_test_bit(ETHTOOL_LINK_MODE_Pause_BIT, advertising))\n\t\tresult |= ADVERTISE_PAUSE_CAP;\n\tif (linkmode_test_bit(ETHTOOL_LINK_MODE_Asym_Pause_BIT, advertising))\n\t\tresult |= ADVERTISE_PAUSE_ASYM;\n\n\treturn result;\n}\n\n \nstatic inline u32 mii_adv_to_ethtool_adv_t(u32 adv)\n{\n\tu32 result = 0;\n\n\tif (adv & ADVERTISE_10HALF)\n\t\tresult |= ADVERTISED_10baseT_Half;\n\tif (adv & ADVERTISE_10FULL)\n\t\tresult |= ADVERTISED_10baseT_Full;\n\tif (adv & ADVERTISE_100HALF)\n\t\tresult |= ADVERTISED_100baseT_Half;\n\tif (adv & ADVERTISE_100FULL)\n\t\tresult |= ADVERTISED_100baseT_Full;\n\tif (adv & ADVERTISE_PAUSE_CAP)\n\t\tresult |= ADVERTISED_Pause;\n\tif (adv & ADVERTISE_PAUSE_ASYM)\n\t\tresult |= ADVERTISED_Asym_Pause;\n\n\treturn result;\n}\n\n \nstatic inline u32 ethtool_adv_to_mii_ctrl1000_t(u32 ethadv)\n{\n\tu32 result = 0;\n\n\tif (ethadv & ADVERTISED_1000baseT_Half)\n\t\tresult |= ADVERTISE_1000HALF;\n\tif (ethadv & ADVERTISED_1000baseT_Full)\n\t\tresult |= ADVERTISE_1000FULL;\n\n\treturn result;\n}\n\n \nstatic inline u32 linkmode_adv_to_mii_ctrl1000_t(unsigned long *advertising)\n{\n\tu32 result = 0;\n\n\tif (linkmode_test_bit(ETHTOOL_LINK_MODE_1000baseT_Half_BIT,\n\t\t\t      advertising))\n\t\tresult |= ADVERTISE_1000HALF;\n\tif (linkmode_test_bit(ETHTOOL_LINK_MODE_1000baseT_Full_BIT,\n\t\t\t      advertising))\n\t\tresult |= ADVERTISE_1000FULL;\n\n\treturn result;\n}\n\n \nstatic inline u32 mii_ctrl1000_to_ethtool_adv_t(u32 adv)\n{\n\tu32 result = 0;\n\n\tif (adv & ADVERTISE_1000HALF)\n\t\tresult |= ADVERTISED_1000baseT_Half;\n\tif (adv & ADVERTISE_1000FULL)\n\t\tresult |= ADVERTISED_1000baseT_Full;\n\n\treturn result;\n}\n\n \nstatic inline u32 mii_lpa_to_ethtool_lpa_t(u32 lpa)\n{\n\tu32 result = 0;\n\n\tif (lpa & LPA_LPACK)\n\t\tresult |= ADVERTISED_Autoneg;\n\n\treturn result | mii_adv_to_ethtool_adv_t(lpa);\n}\n\n \nstatic inline u32 mii_stat1000_to_ethtool_lpa_t(u32 lpa)\n{\n\tu32 result = 0;\n\n\tif (lpa & LPA_1000HALF)\n\t\tresult |= ADVERTISED_1000baseT_Half;\n\tif (lpa & LPA_1000FULL)\n\t\tresult |= ADVERTISED_1000baseT_Full;\n\n\treturn result;\n}\n\n \nstatic inline void mii_stat1000_mod_linkmode_lpa_t(unsigned long *advertising,\n\t\t\t\t\t\t   u32 lpa)\n{\n\tlinkmode_mod_bit(ETHTOOL_LINK_MODE_1000baseT_Half_BIT,\n\t\t\t advertising, lpa & LPA_1000HALF);\n\n\tlinkmode_mod_bit(ETHTOOL_LINK_MODE_1000baseT_Full_BIT,\n\t\t\t advertising, lpa & LPA_1000FULL);\n}\n\n \nstatic inline u32 ethtool_adv_to_mii_adv_x(u32 ethadv)\n{\n\tu32 result = 0;\n\n\tif (ethadv & ADVERTISED_1000baseT_Half)\n\t\tresult |= ADVERTISE_1000XHALF;\n\tif (ethadv & ADVERTISED_1000baseT_Full)\n\t\tresult |= ADVERTISE_1000XFULL;\n\tif (ethadv & ADVERTISED_Pause)\n\t\tresult |= ADVERTISE_1000XPAUSE;\n\tif (ethadv & ADVERTISED_Asym_Pause)\n\t\tresult |= ADVERTISE_1000XPSE_ASYM;\n\n\treturn result;\n}\n\n \nstatic inline u32 mii_adv_to_ethtool_adv_x(u32 adv)\n{\n\tu32 result = 0;\n\n\tif (adv & ADVERTISE_1000XHALF)\n\t\tresult |= ADVERTISED_1000baseT_Half;\n\tif (adv & ADVERTISE_1000XFULL)\n\t\tresult |= ADVERTISED_1000baseT_Full;\n\tif (adv & ADVERTISE_1000XPAUSE)\n\t\tresult |= ADVERTISED_Pause;\n\tif (adv & ADVERTISE_1000XPSE_ASYM)\n\t\tresult |= ADVERTISED_Asym_Pause;\n\n\treturn result;\n}\n\n \nstatic inline void mii_adv_mod_linkmode_adv_t(unsigned long *advertising,\n\t\t\t\t\t      u32 adv)\n{\n\tlinkmode_mod_bit(ETHTOOL_LINK_MODE_10baseT_Half_BIT,\n\t\t\t advertising, adv & ADVERTISE_10HALF);\n\n\tlinkmode_mod_bit(ETHTOOL_LINK_MODE_10baseT_Full_BIT,\n\t\t\t advertising, adv & ADVERTISE_10FULL);\n\n\tlinkmode_mod_bit(ETHTOOL_LINK_MODE_100baseT_Half_BIT,\n\t\t\t advertising, adv & ADVERTISE_100HALF);\n\n\tlinkmode_mod_bit(ETHTOOL_LINK_MODE_100baseT_Full_BIT,\n\t\t\t advertising, adv & ADVERTISE_100FULL);\n\n\tlinkmode_mod_bit(ETHTOOL_LINK_MODE_Pause_BIT, advertising,\n\t\t\t adv & ADVERTISE_PAUSE_CAP);\n\n\tlinkmode_mod_bit(ETHTOOL_LINK_MODE_Asym_Pause_BIT,\n\t\t\t advertising, adv & ADVERTISE_PAUSE_ASYM);\n}\n\n \nstatic inline void mii_adv_to_linkmode_adv_t(unsigned long *advertising,\n\t\t\t\t\t     u32 adv)\n{\n\tlinkmode_zero(advertising);\n\n\tmii_adv_mod_linkmode_adv_t(advertising, adv);\n}\n\n \nstatic inline void mii_lpa_to_linkmode_lpa_t(unsigned long *lp_advertising,\n\t\t\t\t\t     u32 lpa)\n{\n\tmii_adv_to_linkmode_adv_t(lp_advertising, lpa);\n\n\tif (lpa & LPA_LPACK)\n\t\tlinkmode_set_bit(ETHTOOL_LINK_MODE_Autoneg_BIT,\n\t\t\t\t lp_advertising);\n\n}\n\n \nstatic inline void mii_lpa_mod_linkmode_lpa_t(unsigned long *lp_advertising,\n\t\t\t\t\t      u32 lpa)\n{\n\tmii_adv_mod_linkmode_adv_t(lp_advertising, lpa);\n\n\tlinkmode_mod_bit(ETHTOOL_LINK_MODE_Autoneg_BIT,\n\t\t\t lp_advertising, lpa & LPA_LPACK);\n}\n\nstatic inline void mii_ctrl1000_mod_linkmode_adv_t(unsigned long *advertising,\n\t\t\t\t\t\t   u32 ctrl1000)\n{\n\tlinkmode_mod_bit(ETHTOOL_LINK_MODE_1000baseT_Half_BIT, advertising,\n\t\t\t ctrl1000 & ADVERTISE_1000HALF);\n\tlinkmode_mod_bit(ETHTOOL_LINK_MODE_1000baseT_Full_BIT, advertising,\n\t\t\t ctrl1000 & ADVERTISE_1000FULL);\n}\n\n \nstatic inline u32 linkmode_adv_to_lcl_adv_t(unsigned long *advertising)\n{\n\tu32 lcl_adv = 0;\n\n\tif (linkmode_test_bit(ETHTOOL_LINK_MODE_Pause_BIT,\n\t\t\t      advertising))\n\t\tlcl_adv |= ADVERTISE_PAUSE_CAP;\n\tif (linkmode_test_bit(ETHTOOL_LINK_MODE_Asym_Pause_BIT,\n\t\t\t      advertising))\n\t\tlcl_adv |= ADVERTISE_PAUSE_ASYM;\n\n\treturn lcl_adv;\n}\n\n \nstatic inline void mii_lpa_mod_linkmode_x(unsigned long *linkmodes, u16 lpa,\n\t\t\t\t\t int fd_bit)\n{\n\tlinkmode_mod_bit(ETHTOOL_LINK_MODE_Autoneg_BIT, linkmodes,\n\t\t\t lpa & LPA_LPACK);\n\tlinkmode_mod_bit(ETHTOOL_LINK_MODE_Pause_BIT, linkmodes,\n\t\t\t lpa & LPA_1000XPAUSE);\n\tlinkmode_mod_bit(ETHTOOL_LINK_MODE_Asym_Pause_BIT, linkmodes,\n\t\t\t lpa & LPA_1000XPAUSE_ASYM);\n\tlinkmode_mod_bit(fd_bit, linkmodes,\n\t\t\t lpa & LPA_1000XFULL);\n}\n\n \nstatic inline u16 linkmode_adv_to_mii_adv_x(const unsigned long *linkmodes,\n\t\t\t\t\t    int fd_bit)\n{\n\tu16 adv = 0;\n\n\tif (linkmode_test_bit(fd_bit, linkmodes))\n\t\tadv |= ADVERTISE_1000XFULL;\n\tif (linkmode_test_bit(ETHTOOL_LINK_MODE_Pause_BIT, linkmodes))\n\t\tadv |= ADVERTISE_1000XPAUSE;\n\tif (linkmode_test_bit(ETHTOOL_LINK_MODE_Asym_Pause_BIT, linkmodes))\n\t\tadv |= ADVERTISE_1000XPSE_ASYM;\n\n\treturn adv;\n}\n\n \nstatic inline u16 mii_advertise_flowctrl(int cap)\n{\n\tu16 adv = 0;\n\n\tif (cap & FLOW_CTRL_RX)\n\t\tadv = ADVERTISE_PAUSE_CAP | ADVERTISE_PAUSE_ASYM;\n\tif (cap & FLOW_CTRL_TX)\n\t\tadv ^= ADVERTISE_PAUSE_ASYM;\n\n\treturn adv;\n}\n\n \nstatic inline u8 mii_resolve_flowctrl_fdx(u16 lcladv, u16 rmtadv)\n{\n\tu8 cap = 0;\n\n\tif (lcladv & rmtadv & ADVERTISE_PAUSE_CAP) {\n\t\tcap = FLOW_CTRL_TX | FLOW_CTRL_RX;\n\t} else if (lcladv & rmtadv & ADVERTISE_PAUSE_ASYM) {\n\t\tif (lcladv & ADVERTISE_PAUSE_CAP)\n\t\t\tcap = FLOW_CTRL_RX;\n\t\telse if (rmtadv & ADVERTISE_PAUSE_CAP)\n\t\t\tcap = FLOW_CTRL_TX;\n\t}\n\n\treturn cap;\n}\n\n \nstatic inline u16 mii_bmcr_encode_fixed(int speed, int duplex)\n{\n\tu16 bmcr;\n\n\tswitch (speed) {\n\tcase SPEED_2500:\n\tcase SPEED_1000:\n\t\tbmcr = BMCR_SPEED1000;\n\t\tbreak;\n\n\tcase SPEED_100:\n\t\tbmcr = BMCR_SPEED100;\n\t\tbreak;\n\n\tcase SPEED_10:\n\tdefault:\n\t\tbmcr = BMCR_SPEED10;\n\t\tbreak;\n\t}\n\n\tif (duplex == DUPLEX_FULL)\n\t\tbmcr |= BMCR_FULLDPLX;\n\n\treturn bmcr;\n}\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}