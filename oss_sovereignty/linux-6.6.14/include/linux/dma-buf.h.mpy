{
  "module_name": "dma-buf.h",
  "hash_id": "e8cb089b2679c9ba2a540fed252e66f5e599cea388304d6f612eafd77ad25374",
  "original_prompt": "Ingested from linux-6.6.14/include/linux/dma-buf.h",
  "human_readable_source": " \n \n#ifndef __DMA_BUF_H__\n#define __DMA_BUF_H__\n\n#include <linux/iosys-map.h>\n#include <linux/file.h>\n#include <linux/err.h>\n#include <linux/scatterlist.h>\n#include <linux/list.h>\n#include <linux/dma-mapping.h>\n#include <linux/fs.h>\n#include <linux/dma-fence.h>\n#include <linux/wait.h>\n\nstruct device;\nstruct dma_buf;\nstruct dma_buf_attachment;\n\n \nstruct dma_buf_ops {\n\t \n\tbool cache_sgt_mapping;\n\n\t \n\tint (*attach)(struct dma_buf *, struct dma_buf_attachment *);\n\n\t \n\tvoid (*detach)(struct dma_buf *, struct dma_buf_attachment *);\n\n\t \n\tint (*pin)(struct dma_buf_attachment *attach);\n\n\t \n\tvoid (*unpin)(struct dma_buf_attachment *attach);\n\n\t \n\tstruct sg_table * (*map_dma_buf)(struct dma_buf_attachment *,\n\t\t\t\t\t enum dma_data_direction);\n\t \n\tvoid (*unmap_dma_buf)(struct dma_buf_attachment *,\n\t\t\t      struct sg_table *,\n\t\t\t      enum dma_data_direction);\n\n\t \n\n\t \n\tvoid (*release)(struct dma_buf *);\n\n\t \n\tint (*begin_cpu_access)(struct dma_buf *, enum dma_data_direction);\n\n\t \n\tint (*end_cpu_access)(struct dma_buf *, enum dma_data_direction);\n\n\t \n\tint (*mmap)(struct dma_buf *, struct vm_area_struct *vma);\n\n\tint (*vmap)(struct dma_buf *dmabuf, struct iosys_map *map);\n\tvoid (*vunmap)(struct dma_buf *dmabuf, struct iosys_map *map);\n};\n\n \nstruct dma_buf {\n\t \n\tsize_t size;\n\n\t \n\tstruct file *file;\n\n\t \n\tstruct list_head attachments;\n\n\t \n\tconst struct dma_buf_ops *ops;\n\n\t \n\tunsigned vmapping_counter;\n\n\t \n\tstruct iosys_map vmap_ptr;\n\n\t \n\tconst char *exp_name;\n\n\t \n\tconst char *name;\n\n\t \n\tspinlock_t name_lock;\n\n\t \n\tstruct module *owner;\n\n\t \n\tstruct list_head list_node;\n\n\t \n\tvoid *priv;\n\n\t \n\tstruct dma_resv *resv;\n\n\t \n\twait_queue_head_t poll;\n\n\t \n\t \n\tstruct dma_buf_poll_cb_t {\n\t\tstruct dma_fence_cb cb;\n\t\twait_queue_head_t *poll;\n\n\t\t__poll_t active;\n\t} cb_in, cb_out;\n#ifdef CONFIG_DMABUF_SYSFS_STATS\n\t \n\tstruct dma_buf_sysfs_entry {\n\t\tstruct kobject kobj;\n\t\tstruct dma_buf *dmabuf;\n\t} *sysfs_entry;\n#endif\n};\n\n \nstruct dma_buf_attach_ops {\n\t \n\tbool allow_peer2peer;\n\n\t \n\tvoid (*move_notify)(struct dma_buf_attachment *attach);\n};\n\n \nstruct dma_buf_attachment {\n\tstruct dma_buf *dmabuf;\n\tstruct device *dev;\n\tstruct list_head node;\n\tstruct sg_table *sgt;\n\tenum dma_data_direction dir;\n\tbool peer2peer;\n\tconst struct dma_buf_attach_ops *importer_ops;\n\tvoid *importer_priv;\n\tvoid *priv;\n};\n\n \nstruct dma_buf_export_info {\n\tconst char *exp_name;\n\tstruct module *owner;\n\tconst struct dma_buf_ops *ops;\n\tsize_t size;\n\tint flags;\n\tstruct dma_resv *resv;\n\tvoid *priv;\n};\n\n \n#define DEFINE_DMA_BUF_EXPORT_INFO(name)\t\\\n\tstruct dma_buf_export_info name = { .exp_name = KBUILD_MODNAME, \\\n\t\t\t\t\t .owner = THIS_MODULE }\n\n \nstatic inline void get_dma_buf(struct dma_buf *dmabuf)\n{\n\tget_file(dmabuf->file);\n}\n\n \nstatic inline bool dma_buf_is_dynamic(struct dma_buf *dmabuf)\n{\n\treturn !!dmabuf->ops->pin;\n}\n\n \nstatic inline bool\ndma_buf_attachment_is_dynamic(struct dma_buf_attachment *attach)\n{\n\treturn !!attach->importer_ops;\n}\n\nstruct dma_buf_attachment *dma_buf_attach(struct dma_buf *dmabuf,\n\t\t\t\t\t  struct device *dev);\nstruct dma_buf_attachment *\ndma_buf_dynamic_attach(struct dma_buf *dmabuf, struct device *dev,\n\t\t       const struct dma_buf_attach_ops *importer_ops,\n\t\t       void *importer_priv);\nvoid dma_buf_detach(struct dma_buf *dmabuf,\n\t\t    struct dma_buf_attachment *attach);\nint dma_buf_pin(struct dma_buf_attachment *attach);\nvoid dma_buf_unpin(struct dma_buf_attachment *attach);\n\nstruct dma_buf *dma_buf_export(const struct dma_buf_export_info *exp_info);\n\nint dma_buf_fd(struct dma_buf *dmabuf, int flags);\nstruct dma_buf *dma_buf_get(int fd);\nvoid dma_buf_put(struct dma_buf *dmabuf);\n\nstruct sg_table *dma_buf_map_attachment(struct dma_buf_attachment *,\n\t\t\t\t\tenum dma_data_direction);\nvoid dma_buf_unmap_attachment(struct dma_buf_attachment *, struct sg_table *,\n\t\t\t\tenum dma_data_direction);\nvoid dma_buf_move_notify(struct dma_buf *dma_buf);\nint dma_buf_begin_cpu_access(struct dma_buf *dma_buf,\n\t\t\t     enum dma_data_direction dir);\nint dma_buf_end_cpu_access(struct dma_buf *dma_buf,\n\t\t\t   enum dma_data_direction dir);\nstruct sg_table *\ndma_buf_map_attachment_unlocked(struct dma_buf_attachment *attach,\n\t\t\t\tenum dma_data_direction direction);\nvoid dma_buf_unmap_attachment_unlocked(struct dma_buf_attachment *attach,\n\t\t\t\t       struct sg_table *sg_table,\n\t\t\t\t       enum dma_data_direction direction);\n\nint dma_buf_mmap(struct dma_buf *, struct vm_area_struct *,\n\t\t unsigned long);\nint dma_buf_vmap(struct dma_buf *dmabuf, struct iosys_map *map);\nvoid dma_buf_vunmap(struct dma_buf *dmabuf, struct iosys_map *map);\nint dma_buf_vmap_unlocked(struct dma_buf *dmabuf, struct iosys_map *map);\nvoid dma_buf_vunmap_unlocked(struct dma_buf *dmabuf, struct iosys_map *map);\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}