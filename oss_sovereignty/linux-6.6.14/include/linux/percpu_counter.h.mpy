{
  "module_name": "percpu_counter.h",
  "hash_id": "16e342d055879aeb04db5ec9fc6bd34d4a8ff7334822bac8221f40d1fec4285d",
  "original_prompt": "Ingested from linux-6.6.14/include/linux/percpu_counter.h",
  "human_readable_source": " \n#ifndef _LINUX_PERCPU_COUNTER_H\n#define _LINUX_PERCPU_COUNTER_H\n \n\n#include <linux/spinlock.h>\n#include <linux/smp.h>\n#include <linux/list.h>\n#include <linux/threads.h>\n#include <linux/percpu.h>\n#include <linux/types.h>\n\n \n#define PERCPU_COUNTER_LOCAL_BATCH\tINT_MAX\n\n#ifdef CONFIG_SMP\n\nstruct percpu_counter {\n\traw_spinlock_t lock;\n\ts64 count;\n#ifdef CONFIG_HOTPLUG_CPU\n\tstruct list_head list;\t \n#endif\n\ts32 __percpu *counters;\n};\n\nextern int percpu_counter_batch;\n\nint __percpu_counter_init_many(struct percpu_counter *fbc, s64 amount,\n\t\t\t       gfp_t gfp, u32 nr_counters,\n\t\t\t       struct lock_class_key *key);\n\n#define percpu_counter_init_many(fbc, value, gfp, nr_counters)\t\t\\\n\t({\t\t\t\t\t\t\t\t\\\n\t\tstatic struct lock_class_key __key;\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\t\t__percpu_counter_init_many(fbc, value, gfp, nr_counters,\\\n\t\t\t\t\t   &__key);\t\t\t\\\n\t})\n\n\n#define percpu_counter_init(fbc, value, gfp)\t\t\t\t\\\n\tpercpu_counter_init_many(fbc, value, gfp, 1)\n\nvoid percpu_counter_destroy_many(struct percpu_counter *fbc, u32 nr_counters);\nstatic inline void percpu_counter_destroy(struct percpu_counter *fbc)\n{\n\tpercpu_counter_destroy_many(fbc, 1);\n}\n\nvoid percpu_counter_set(struct percpu_counter *fbc, s64 amount);\nvoid percpu_counter_add_batch(struct percpu_counter *fbc, s64 amount,\n\t\t\t      s32 batch);\ns64 __percpu_counter_sum(struct percpu_counter *fbc);\nint __percpu_counter_compare(struct percpu_counter *fbc, s64 rhs, s32 batch);\nvoid percpu_counter_sync(struct percpu_counter *fbc);\n\nstatic inline int percpu_counter_compare(struct percpu_counter *fbc, s64 rhs)\n{\n\treturn __percpu_counter_compare(fbc, rhs, percpu_counter_batch);\n}\n\nstatic inline void percpu_counter_add(struct percpu_counter *fbc, s64 amount)\n{\n\tpercpu_counter_add_batch(fbc, amount, percpu_counter_batch);\n}\n\n \nstatic inline void\npercpu_counter_add_local(struct percpu_counter *fbc, s64 amount)\n{\n\tpercpu_counter_add_batch(fbc, amount, PERCPU_COUNTER_LOCAL_BATCH);\n}\n\nstatic inline s64 percpu_counter_sum_positive(struct percpu_counter *fbc)\n{\n\ts64 ret = __percpu_counter_sum(fbc);\n\treturn ret < 0 ? 0 : ret;\n}\n\nstatic inline s64 percpu_counter_sum(struct percpu_counter *fbc)\n{\n\treturn __percpu_counter_sum(fbc);\n}\n\nstatic inline s64 percpu_counter_read(struct percpu_counter *fbc)\n{\n\treturn fbc->count;\n}\n\n \nstatic inline s64 percpu_counter_read_positive(struct percpu_counter *fbc)\n{\n\t \n\ts64 ret = READ_ONCE(fbc->count);\n\n\tif (ret >= 0)\n\t\treturn ret;\n\treturn 0;\n}\n\nstatic inline bool percpu_counter_initialized(struct percpu_counter *fbc)\n{\n\treturn (fbc->counters != NULL);\n}\n\n#else  \n\nstruct percpu_counter {\n\ts64 count;\n};\n\nstatic inline int percpu_counter_init_many(struct percpu_counter *fbc,\n\t\t\t\t\t   s64 amount, gfp_t gfp,\n\t\t\t\t\t   u32 nr_counters)\n{\n\tu32 i;\n\n\tfor (i = 0; i < nr_counters; i++)\n\t\tfbc[i].count = amount;\n\n\treturn 0;\n}\n\nstatic inline int percpu_counter_init(struct percpu_counter *fbc, s64 amount,\n\t\t\t\t      gfp_t gfp)\n{\n\treturn percpu_counter_init_many(fbc, amount, gfp, 1);\n}\n\nstatic inline void percpu_counter_destroy_many(struct percpu_counter *fbc,\n\t\t\t\t\t       u32 nr_counters)\n{\n}\n\nstatic inline void percpu_counter_destroy(struct percpu_counter *fbc)\n{\n}\n\nstatic inline void percpu_counter_set(struct percpu_counter *fbc, s64 amount)\n{\n\tfbc->count = amount;\n}\n\nstatic inline int percpu_counter_compare(struct percpu_counter *fbc, s64 rhs)\n{\n\tif (fbc->count > rhs)\n\t\treturn 1;\n\telse if (fbc->count < rhs)\n\t\treturn -1;\n\telse\n\t\treturn 0;\n}\n\nstatic inline int\n__percpu_counter_compare(struct percpu_counter *fbc, s64 rhs, s32 batch)\n{\n\treturn percpu_counter_compare(fbc, rhs);\n}\n\nstatic inline void\npercpu_counter_add(struct percpu_counter *fbc, s64 amount)\n{\n\tunsigned long flags;\n\n\tlocal_irq_save(flags);\n\tfbc->count += amount;\n\tlocal_irq_restore(flags);\n}\n\n \nstatic inline void\npercpu_counter_add_local(struct percpu_counter *fbc, s64 amount)\n{\n\tpercpu_counter_add(fbc, amount);\n}\n\nstatic inline void\npercpu_counter_add_batch(struct percpu_counter *fbc, s64 amount, s32 batch)\n{\n\tpercpu_counter_add(fbc, amount);\n}\n\nstatic inline s64 percpu_counter_read(struct percpu_counter *fbc)\n{\n\treturn fbc->count;\n}\n\n \nstatic inline s64 percpu_counter_read_positive(struct percpu_counter *fbc)\n{\n\treturn fbc->count;\n}\n\nstatic inline s64 percpu_counter_sum_positive(struct percpu_counter *fbc)\n{\n\treturn percpu_counter_read_positive(fbc);\n}\n\nstatic inline s64 percpu_counter_sum(struct percpu_counter *fbc)\n{\n\treturn percpu_counter_read(fbc);\n}\n\nstatic inline bool percpu_counter_initialized(struct percpu_counter *fbc)\n{\n\treturn true;\n}\n\nstatic inline void percpu_counter_sync(struct percpu_counter *fbc)\n{\n}\n#endif\t \n\nstatic inline void percpu_counter_inc(struct percpu_counter *fbc)\n{\n\tpercpu_counter_add(fbc, 1);\n}\n\nstatic inline void percpu_counter_dec(struct percpu_counter *fbc)\n{\n\tpercpu_counter_add(fbc, -1);\n}\n\nstatic inline void percpu_counter_sub(struct percpu_counter *fbc, s64 amount)\n{\n\tpercpu_counter_add(fbc, -amount);\n}\n\nstatic inline void\npercpu_counter_sub_local(struct percpu_counter *fbc, s64 amount)\n{\n\tpercpu_counter_add_local(fbc, -amount);\n}\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}