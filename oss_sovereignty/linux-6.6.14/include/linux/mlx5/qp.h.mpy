{
  "module_name": "qp.h",
  "hash_id": "687d7f27268d583fefeb3e55df6c315242890782a453d624e15aa665a54642ea",
  "original_prompt": "Ingested from linux-6.6.14/include/linux/mlx5/qp.h",
  "human_readable_source": " \n\n#ifndef MLX5_QP_H\n#define MLX5_QP_H\n\n#include <linux/mlx5/device.h>\n#include <linux/mlx5/driver.h>\n\n#define MLX5_TERMINATE_SCATTER_LIST_LKEY cpu_to_be32(0x100)\n \n#define MLX5_SIG_WQE_SIZE\t(MLX5_SEND_WQE_BB * 8)\n#define MLX5_DIF_SIZE\t\t8\n#define MLX5_STRIDE_BLOCK_OP\t0x400\n#define MLX5_CPY_GRD_MASK\t0xc0\n#define MLX5_CPY_APP_MASK\t0x30\n#define MLX5_CPY_REF_MASK\t0x0f\n#define MLX5_BSF_INC_REFTAG\t(1 << 6)\n#define MLX5_BSF_INL_VALID\t(1 << 15)\n#define MLX5_BSF_REFRESH_DIF\t(1 << 14)\n#define MLX5_BSF_REPEAT_BLOCK\t(1 << 7)\n#define MLX5_BSF_APPTAG_ESCAPE\t0x1\n#define MLX5_BSF_APPREF_ESCAPE\t0x2\n\nenum mlx5_qp_optpar {\n\tMLX5_QP_OPTPAR_ALT_ADDR_PATH\t\t= 1 << 0,\n\tMLX5_QP_OPTPAR_RRE\t\t\t= 1 << 1,\n\tMLX5_QP_OPTPAR_RAE\t\t\t= 1 << 2,\n\tMLX5_QP_OPTPAR_RWE\t\t\t= 1 << 3,\n\tMLX5_QP_OPTPAR_PKEY_INDEX\t\t= 1 << 4,\n\tMLX5_QP_OPTPAR_Q_KEY\t\t\t= 1 << 5,\n\tMLX5_QP_OPTPAR_RNR_TIMEOUT\t\t= 1 << 6,\n\tMLX5_QP_OPTPAR_PRIMARY_ADDR_PATH\t= 1 << 7,\n\tMLX5_QP_OPTPAR_SRA_MAX\t\t\t= 1 << 8,\n\tMLX5_QP_OPTPAR_RRA_MAX\t\t\t= 1 << 9,\n\tMLX5_QP_OPTPAR_PM_STATE\t\t\t= 1 << 10,\n\tMLX5_QP_OPTPAR_RETRY_COUNT\t\t= 1 << 12,\n\tMLX5_QP_OPTPAR_RNR_RETRY\t\t= 1 << 13,\n\tMLX5_QP_OPTPAR_ACK_TIMEOUT\t\t= 1 << 14,\n\tMLX5_QP_OPTPAR_LAG_TX_AFF\t\t= 1 << 15,\n\tMLX5_QP_OPTPAR_PRI_PORT\t\t\t= 1 << 16,\n\tMLX5_QP_OPTPAR_SRQN\t\t\t= 1 << 18,\n\tMLX5_QP_OPTPAR_CQN_RCV\t\t\t= 1 << 19,\n\tMLX5_QP_OPTPAR_DC_HS\t\t\t= 1 << 20,\n\tMLX5_QP_OPTPAR_DC_KEY\t\t\t= 1 << 21,\n\tMLX5_QP_OPTPAR_COUNTER_SET_ID\t\t= 1 << 25,\n};\n\nenum mlx5_qp_state {\n\tMLX5_QP_STATE_RST\t\t\t= 0,\n\tMLX5_QP_STATE_INIT\t\t\t= 1,\n\tMLX5_QP_STATE_RTR\t\t\t= 2,\n\tMLX5_QP_STATE_RTS\t\t\t= 3,\n\tMLX5_QP_STATE_SQER\t\t\t= 4,\n\tMLX5_QP_STATE_SQD\t\t\t= 5,\n\tMLX5_QP_STATE_ERR\t\t\t= 6,\n\tMLX5_QP_STATE_SQ_DRAINING\t\t= 7,\n\tMLX5_QP_STATE_SUSPENDED\t\t\t= 9,\n\tMLX5_QP_NUM_STATE,\n\tMLX5_QP_STATE,\n\tMLX5_QP_STATE_BAD,\n};\n\nenum {\n\tMLX5_SQ_STATE_NA\t= MLX5_SQC_STATE_ERR + 1,\n\tMLX5_SQ_NUM_STATE\t= MLX5_SQ_STATE_NA + 1,\n\tMLX5_RQ_STATE_NA\t= MLX5_RQC_STATE_ERR + 1,\n\tMLX5_RQ_NUM_STATE\t= MLX5_RQ_STATE_NA + 1,\n};\n\nenum {\n\tMLX5_QP_ST_RC\t\t\t\t= 0x0,\n\tMLX5_QP_ST_UC\t\t\t\t= 0x1,\n\tMLX5_QP_ST_UD\t\t\t\t= 0x2,\n\tMLX5_QP_ST_XRC\t\t\t\t= 0x3,\n\tMLX5_QP_ST_MLX\t\t\t\t= 0x4,\n\tMLX5_QP_ST_DCI\t\t\t\t= 0x5,\n\tMLX5_QP_ST_DCT\t\t\t\t= 0x6,\n\tMLX5_QP_ST_QP0\t\t\t\t= 0x7,\n\tMLX5_QP_ST_QP1\t\t\t\t= 0x8,\n\tMLX5_QP_ST_RAW_ETHERTYPE\t\t= 0x9,\n\tMLX5_QP_ST_RAW_IPV6\t\t\t= 0xa,\n\tMLX5_QP_ST_SNIFFER\t\t\t= 0xb,\n\tMLX5_QP_ST_SYNC_UMR\t\t\t= 0xe,\n\tMLX5_QP_ST_PTP_1588\t\t\t= 0xd,\n\tMLX5_QP_ST_REG_UMR\t\t\t= 0xc,\n\tMLX5_QP_ST_MAX\n};\n\nenum {\n\tMLX5_QP_PM_MIGRATED\t\t\t= 0x3,\n\tMLX5_QP_PM_ARMED\t\t\t= 0x0,\n\tMLX5_QP_PM_REARM\t\t\t= 0x1\n};\n\nenum {\n\tMLX5_NON_ZERO_RQ\t= 0x0,\n\tMLX5_SRQ_RQ\t\t= 0x1,\n\tMLX5_CRQ_RQ\t\t= 0x2,\n\tMLX5_ZERO_LEN_RQ\t= 0x3\n};\n\n \nenum {\n\t \n\tMLX5_QP_BIT_SRE\t\t\t\t= 1 << 15,\n\tMLX5_QP_BIT_SWE\t\t\t\t= 1 << 14,\n\tMLX5_QP_BIT_SAE\t\t\t\t= 1 << 13,\n\t \n\tMLX5_QP_BIT_RRE\t\t\t\t= 1 << 15,\n\tMLX5_QP_BIT_RWE\t\t\t\t= 1 << 14,\n\tMLX5_QP_BIT_RAE\t\t\t\t= 1 << 13,\n\tMLX5_QP_BIT_RIC\t\t\t\t= 1 <<\t4,\n\tMLX5_QP_BIT_CC_SLAVE_RECV\t\t= 1 <<  2,\n\tMLX5_QP_BIT_CC_SLAVE_SEND\t\t= 1 <<  1,\n\tMLX5_QP_BIT_CC_MASTER\t\t\t= 1 <<  0\n};\n\nenum {\n\tMLX5_WQE_CTRL_CQ_UPDATE\t\t= 2 << 2,\n\tMLX5_WQE_CTRL_CQ_UPDATE_AND_EQE\t= 3 << 2,\n\tMLX5_WQE_CTRL_SOLICITED\t\t= 1 << 1,\n};\n\nenum {\n\tMLX5_SEND_WQE_DS\t= 16,\n\tMLX5_SEND_WQE_BB\t= 64,\n};\n\n#define MLX5_SEND_WQEBB_NUM_DS\t(MLX5_SEND_WQE_BB / MLX5_SEND_WQE_DS)\n\nenum {\n\tMLX5_SEND_WQE_MAX_WQEBBS\t= 16,\n};\n\n#define MLX5_SEND_WQE_MAX_SIZE (MLX5_SEND_WQE_MAX_WQEBBS * MLX5_SEND_WQE_BB)\n\nenum {\n\tMLX5_WQE_FMR_PERM_LOCAL_READ\t= 1 << 27,\n\tMLX5_WQE_FMR_PERM_LOCAL_WRITE\t= 1 << 28,\n\tMLX5_WQE_FMR_PERM_REMOTE_READ\t= 1 << 29,\n\tMLX5_WQE_FMR_PERM_REMOTE_WRITE\t= 1 << 30,\n\tMLX5_WQE_FMR_PERM_ATOMIC\t= 1 << 31\n};\n\nenum {\n\tMLX5_FENCE_MODE_NONE\t\t\t= 0 << 5,\n\tMLX5_FENCE_MODE_INITIATOR_SMALL\t\t= 1 << 5,\n\tMLX5_FENCE_MODE_FENCE\t\t\t= 2 << 5,\n\tMLX5_FENCE_MODE_STRONG_ORDERING\t\t= 3 << 5,\n\tMLX5_FENCE_MODE_SMALL_AND_FENCE\t\t= 4 << 5,\n};\n\nenum {\n\tMLX5_RCV_DBR\t= 0,\n\tMLX5_SND_DBR\t= 1,\n};\n\nenum {\n\tMLX5_FLAGS_INLINE\t= 1<<7,\n\tMLX5_FLAGS_CHECK_FREE   = 1<<5,\n};\n\nstruct mlx5_wqe_fmr_seg {\n\t__be32\t\t\tflags;\n\t__be32\t\t\tmem_key;\n\t__be64\t\t\tbuf_list;\n\t__be64\t\t\tstart_addr;\n\t__be64\t\t\treg_len;\n\t__be32\t\t\toffset;\n\t__be32\t\t\tpage_size;\n\tu32\t\t\treserved[2];\n};\n\nstruct mlx5_wqe_ctrl_seg {\n\t__be32\t\t\topmod_idx_opcode;\n\t__be32\t\t\tqpn_ds;\n\n\tstruct_group(trailer,\n\n\tu8\t\t\tsignature;\n\tu8\t\t\trsvd[2];\n\tu8\t\t\tfm_ce_se;\n\tunion {\n\t\t__be32\t\tgeneral_id;\n\t\t__be32\t\timm;\n\t\t__be32\t\tumr_mkey;\n\t\t__be32\t\ttis_tir_num;\n\t};\n\n\t);  \n};\n\n#define MLX5_WQE_CTRL_DS_MASK 0x3f\n#define MLX5_WQE_CTRL_QPN_MASK 0xffffff00\n#define MLX5_WQE_CTRL_QPN_SHIFT 8\n#define MLX5_WQE_DS_UNITS 16\n#define MLX5_WQE_CTRL_OPCODE_MASK 0xff\n#define MLX5_WQE_CTRL_WQE_INDEX_MASK 0x00ffff00\n#define MLX5_WQE_CTRL_WQE_INDEX_SHIFT 8\n\nenum {\n\tMLX5_ETH_WQE_L3_INNER_CSUM      = 1 << 4,\n\tMLX5_ETH_WQE_L4_INNER_CSUM      = 1 << 5,\n\tMLX5_ETH_WQE_L3_CSUM            = 1 << 6,\n\tMLX5_ETH_WQE_L4_CSUM            = 1 << 7,\n};\n\nenum {\n\tMLX5_ETH_WQE_SVLAN              = 1 << 0,\n\tMLX5_ETH_WQE_TRAILER_HDR_OUTER_IP_ASSOC = 1 << 26,\n\tMLX5_ETH_WQE_TRAILER_HDR_OUTER_L4_ASSOC = 1 << 27,\n\tMLX5_ETH_WQE_TRAILER_HDR_INNER_IP_ASSOC = 3 << 26,\n\tMLX5_ETH_WQE_TRAILER_HDR_INNER_L4_ASSOC = 1 << 28,\n\tMLX5_ETH_WQE_INSERT_TRAILER     = 1 << 30,\n\tMLX5_ETH_WQE_INSERT_VLAN        = 1 << 15,\n};\n\nenum {\n\tMLX5_ETH_WQE_SWP_INNER_L3_IPV6  = 1 << 0,\n\tMLX5_ETH_WQE_SWP_INNER_L4_UDP   = 1 << 1,\n\tMLX5_ETH_WQE_SWP_OUTER_L3_IPV6  = 1 << 4,\n\tMLX5_ETH_WQE_SWP_OUTER_L4_UDP   = 1 << 5,\n};\n\nenum {\n\tMLX5_ETH_WQE_FT_META_IPSEC = BIT(0),\n\tMLX5_ETH_WQE_FT_META_MACSEC = BIT(1),\n};\n\nstruct mlx5_wqe_eth_seg {\n\tu8              swp_outer_l4_offset;\n\tu8              swp_outer_l3_offset;\n\tu8              swp_inner_l4_offset;\n\tu8              swp_inner_l3_offset;\n\tu8              cs_flags;\n\tu8              swp_flags;\n\t__be16          mss;\n\t__be32          flow_table_metadata;\n\tunion {\n\t\tstruct {\n\t\t\t__be16 sz;\n\t\t\tu8     start[2];\n\t\t} inline_hdr;\n\t\tstruct {\n\t\t\t__be16 type;\n\t\t\t__be16 vlan_tci;\n\t\t} insert;\n\t\t__be32 trailer;\n\t};\n};\n\nstruct mlx5_wqe_xrc_seg {\n\t__be32\t\t\txrc_srqn;\n\tu8\t\t\trsvd[12];\n};\n\nstruct mlx5_wqe_masked_atomic_seg {\n\t__be64\t\t\tswap_add;\n\t__be64\t\t\tcompare;\n\t__be64\t\t\tswap_add_mask;\n\t__be64\t\t\tcompare_mask;\n};\n\nstruct mlx5_base_av {\n\tunion {\n\t\tstruct {\n\t\t\t__be32\tqkey;\n\t\t\t__be32\treserved;\n\t\t} qkey;\n\t\t__be64\tdc_key;\n\t} key;\n\t__be32\tdqp_dct;\n\tu8\tstat_rate_sl;\n\tu8\tfl_mlid;\n\tunion {\n\t\t__be16\trlid;\n\t\t__be16  udp_sport;\n\t};\n};\n\nstruct mlx5_av {\n\tunion {\n\t\tstruct {\n\t\t\t__be32\tqkey;\n\t\t\t__be32\treserved;\n\t\t} qkey;\n\t\t__be64\tdc_key;\n\t} key;\n\t__be32\tdqp_dct;\n\tu8\tstat_rate_sl;\n\tu8\tfl_mlid;\n\tunion {\n\t\t__be16\trlid;\n\t\t__be16  udp_sport;\n\t};\n\tu8\treserved0[4];\n\tu8\trmac[6];\n\tu8\ttclass;\n\tu8\thop_limit;\n\t__be32\tgrh_gid_fl;\n\tu8\trgid[16];\n};\n\nstruct mlx5_ib_ah {\n\tstruct ib_ah\t\tibah;\n\tstruct mlx5_av\t\tav;\n\tu8\t\t\txmit_port;\n};\n\nstatic inline struct mlx5_ib_ah *to_mah(struct ib_ah *ibah)\n{\n\treturn container_of(ibah, struct mlx5_ib_ah, ibah);\n}\n\nstruct mlx5_wqe_datagram_seg {\n\tstruct mlx5_av\tav;\n};\n\nstruct mlx5_wqe_raddr_seg {\n\t__be64\t\t\traddr;\n\t__be32\t\t\trkey;\n\tu32\t\t\treserved;\n};\n\nstruct mlx5_wqe_atomic_seg {\n\t__be64\t\t\tswap_add;\n\t__be64\t\t\tcompare;\n};\n\nstruct mlx5_wqe_data_seg {\n\t__be32\t\t\tbyte_count;\n\t__be32\t\t\tlkey;\n\t__be64\t\t\taddr;\n};\n\nstruct mlx5_wqe_umr_ctrl_seg {\n\tu8\t\tflags;\n\tu8\t\trsvd0[3];\n\t__be16\t\txlt_octowords;\n\tunion {\n\t\t__be16\txlt_offset;\n\t\t__be16\tbsf_octowords;\n\t};\n\t__be64\t\tmkey_mask;\n\t__be32\t\txlt_offset_47_16;\n\tu8\t\trsvd1[28];\n};\n\nstruct mlx5_seg_set_psv {\n\t__be32\t\tpsv_num;\n\t__be16\t\tsyndrome;\n\t__be16\t\tstatus;\n\t__be32\t\ttransient_sig;\n\t__be32\t\tref_tag;\n};\n\nstruct mlx5_seg_get_psv {\n\tu8\t\trsvd[19];\n\tu8\t\tnum_psv;\n\t__be32\t\tl_key;\n\t__be64\t\tva;\n\t__be32\t\tpsv_index[4];\n};\n\nstruct mlx5_seg_check_psv {\n\tu8\t\trsvd0[2];\n\t__be16\t\terr_coalescing_op;\n\tu8\t\trsvd1[2];\n\t__be16\t\txport_err_op;\n\tu8\t\trsvd2[2];\n\t__be16\t\txport_err_mask;\n\tu8\t\trsvd3[7];\n\tu8\t\tnum_psv;\n\t__be32\t\tl_key;\n\t__be64\t\tva;\n\t__be32\t\tpsv_index[4];\n};\n\nstruct mlx5_rwqe_sig {\n\tu8\trsvd0[4];\n\tu8\tsignature;\n\tu8\trsvd1[11];\n};\n\nstruct mlx5_wqe_signature_seg {\n\tu8\trsvd0[4];\n\tu8\tsignature;\n\tu8\trsvd1[11];\n};\n\n#define MLX5_WQE_INLINE_SEG_BYTE_COUNT_MASK 0x3ff\n\nstruct mlx5_wqe_inline_seg {\n\t__be32\tbyte_count;\n\t__be32\tdata[];\n};\n\nenum mlx5_sig_type {\n\tMLX5_DIF_CRC = 0x1,\n\tMLX5_DIF_IPCS = 0x2,\n};\n\nstruct mlx5_bsf_inl {\n\t__be16\t\tvld_refresh;\n\t__be16\t\tdif_apptag;\n\t__be32\t\tdif_reftag;\n\tu8\t\tsig_type;\n\tu8\t\trp_inv_seed;\n\tu8\t\trsvd[3];\n\tu8\t\tdif_inc_ref_guard_check;\n\t__be16\t\tdif_app_bitmask_check;\n};\n\nstruct mlx5_bsf {\n\tstruct mlx5_bsf_basic {\n\t\tu8\t\tbsf_size_sbs;\n\t\tu8\t\tcheck_byte_mask;\n\t\tunion {\n\t\t\tu8\tcopy_byte_mask;\n\t\t\tu8\tbs_selector;\n\t\t\tu8\trsvd_wflags;\n\t\t} wire;\n\t\tunion {\n\t\t\tu8\tbs_selector;\n\t\t\tu8\trsvd_mflags;\n\t\t} mem;\n\t\t__be32\t\traw_data_size;\n\t\t__be32\t\tw_bfs_psv;\n\t\t__be32\t\tm_bfs_psv;\n\t} basic;\n\tstruct mlx5_bsf_ext {\n\t\t__be32\t\tt_init_gen_pro_size;\n\t\t__be32\t\trsvd_epi_size;\n\t\t__be32\t\tw_tfs_psv;\n\t\t__be32\t\tm_tfs_psv;\n\t} ext;\n\tstruct mlx5_bsf_inl\tw_inl;\n\tstruct mlx5_bsf_inl\tm_inl;\n};\n\nstruct mlx5_mtt {\n\t__be64\t\tptag;\n};\n\nstruct mlx5_klm {\n\t__be32\t\tbcount;\n\t__be32\t\tkey;\n\t__be64\t\tva;\n};\n\nstruct mlx5_ksm {\n\t__be32\t\treserved;\n\t__be32\t\tkey;\n\t__be64\t\tva;\n};\n\nstruct mlx5_stride_block_entry {\n\t__be16\t\tstride;\n\t__be16\t\tbcount;\n\t__be32\t\tkey;\n\t__be64\t\tva;\n};\n\nstruct mlx5_stride_block_ctrl_seg {\n\t__be32\t\tbcount_per_cycle;\n\t__be32\t\top;\n\t__be32\t\trepeat_count;\n\tu16\t\trsvd;\n\t__be16\t\tnum_entries;\n};\n\nstruct mlx5_wqe_flow_update_ctrl_seg {\n\t__be32\t\tflow_idx_update;\n\t__be32\t\tdest_handle;\n\tu8\t\treserved0[40];\n};\n\nstruct mlx5_wqe_header_modify_argument_update_seg {\n\tu8\t\targument_list[64];\n};\n\nstruct mlx5_core_qp {\n\tstruct mlx5_core_rsc_common\tcommon;  \n\tvoid (*event)\t\t(struct mlx5_core_qp *, int);\n\tint\t\t\tqpn;\n\tstruct mlx5_rsc_debug\t*dbg;\n\tint\t\t\tpid;\n\tu16\t\t\tuid;\n};\n\nstruct mlx5_core_dct {\n\tstruct mlx5_core_qp\tmqp;\n\tstruct completion\tdrained;\n};\n\nint mlx5_debug_qp_add(struct mlx5_core_dev *dev, struct mlx5_core_qp *qp);\nvoid mlx5_debug_qp_remove(struct mlx5_core_dev *dev, struct mlx5_core_qp *qp);\n\nstatic inline const char *mlx5_qp_type_str(int type)\n{\n\tswitch (type) {\n\tcase MLX5_QP_ST_RC: return \"RC\";\n\tcase MLX5_QP_ST_UC: return \"C\";\n\tcase MLX5_QP_ST_UD: return \"UD\";\n\tcase MLX5_QP_ST_XRC: return \"XRC\";\n\tcase MLX5_QP_ST_MLX: return \"MLX\";\n\tcase MLX5_QP_ST_QP0: return \"QP0\";\n\tcase MLX5_QP_ST_QP1: return \"QP1\";\n\tcase MLX5_QP_ST_RAW_ETHERTYPE: return \"RAW_ETHERTYPE\";\n\tcase MLX5_QP_ST_RAW_IPV6: return \"RAW_IPV6\";\n\tcase MLX5_QP_ST_SNIFFER: return \"SNIFFER\";\n\tcase MLX5_QP_ST_SYNC_UMR: return \"SYNC_UMR\";\n\tcase MLX5_QP_ST_PTP_1588: return \"PTP_1588\";\n\tcase MLX5_QP_ST_REG_UMR: return \"REG_UMR\";\n\tdefault: return \"Invalid transport type\";\n\t}\n}\n\nstatic inline const char *mlx5_qp_state_str(int state)\n{\n\tswitch (state) {\n\tcase MLX5_QP_STATE_RST:\n\treturn \"RST\";\n\tcase MLX5_QP_STATE_INIT:\n\treturn \"INIT\";\n\tcase MLX5_QP_STATE_RTR:\n\treturn \"RTR\";\n\tcase MLX5_QP_STATE_RTS:\n\treturn \"RTS\";\n\tcase MLX5_QP_STATE_SQER:\n\treturn \"SQER\";\n\tcase MLX5_QP_STATE_SQD:\n\treturn \"SQD\";\n\tcase MLX5_QP_STATE_ERR:\n\treturn \"ERR\";\n\tcase MLX5_QP_STATE_SQ_DRAINING:\n\treturn \"SQ_DRAINING\";\n\tcase MLX5_QP_STATE_SUSPENDED:\n\treturn \"SUSPENDED\";\n\tdefault: return \"Invalid QP state\";\n\t}\n}\n\nstatic inline int mlx5_get_qp_default_ts(struct mlx5_core_dev *dev)\n{\n\treturn !MLX5_CAP_ROCE(dev, qp_ts_format) ?\n\t\t       MLX5_TIMESTAMP_FORMAT_FREE_RUNNING :\n\t\t       MLX5_TIMESTAMP_FORMAT_DEFAULT;\n}\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}