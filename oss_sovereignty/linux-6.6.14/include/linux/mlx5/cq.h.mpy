{
  "module_name": "cq.h",
  "hash_id": "223b08bf7459cf4870127921e26862093ffd3243158b85f3ac26af66a48fc861",
  "original_prompt": "Ingested from linux-6.6.14/include/linux/mlx5/cq.h",
  "human_readable_source": " \n\n#ifndef MLX5_CORE_CQ_H\n#define MLX5_CORE_CQ_H\n\n#include <linux/mlx5/driver.h>\n#include <linux/refcount.h>\n\nstruct mlx5_core_cq {\n\tu32\t\t\tcqn;\n\tint\t\t\tcqe_sz;\n\t__be32\t\t       *set_ci_db;\n\t__be32\t\t       *arm_db;\n\tstruct mlx5_uars_page  *uar;\n\trefcount_t\t\trefcount;\n\tstruct completion\tfree;\n\tunsigned\t\tvector;\n\tunsigned int\t\tirqn;\n\tvoid (*comp)(struct mlx5_core_cq *cq, struct mlx5_eqe *eqe);\n\tvoid (*event)\t\t(struct mlx5_core_cq *, enum mlx5_event);\n\tu32\t\t\tcons_index;\n\tunsigned\t\tarm_sn;\n\tstruct mlx5_rsc_debug\t*dbg;\n\tint\t\t\tpid;\n\tstruct {\n\t\tstruct list_head list;\n\t\tvoid (*comp)(struct mlx5_core_cq *cq, struct mlx5_eqe *eqe);\n\t\tvoid\t\t*priv;\n\t} tasklet_ctx;\n\tint\t\t\treset_notify_added;\n\tstruct list_head\treset_notify;\n\tstruct mlx5_eq_comp\t*eq;\n\tu16 uid;\n};\n\n\nenum {\n\tMLX5_CQE_SYNDROME_LOCAL_LENGTH_ERR\t\t= 0x01,\n\tMLX5_CQE_SYNDROME_LOCAL_QP_OP_ERR\t\t= 0x02,\n\tMLX5_CQE_SYNDROME_LOCAL_PROT_ERR\t\t= 0x04,\n\tMLX5_CQE_SYNDROME_WR_FLUSH_ERR\t\t\t= 0x05,\n\tMLX5_CQE_SYNDROME_MW_BIND_ERR\t\t\t= 0x06,\n\tMLX5_CQE_SYNDROME_BAD_RESP_ERR\t\t\t= 0x10,\n\tMLX5_CQE_SYNDROME_LOCAL_ACCESS_ERR\t\t= 0x11,\n\tMLX5_CQE_SYNDROME_REMOTE_INVAL_REQ_ERR\t\t= 0x12,\n\tMLX5_CQE_SYNDROME_REMOTE_ACCESS_ERR\t\t= 0x13,\n\tMLX5_CQE_SYNDROME_REMOTE_OP_ERR\t\t\t= 0x14,\n\tMLX5_CQE_SYNDROME_TRANSPORT_RETRY_EXC_ERR\t= 0x15,\n\tMLX5_CQE_SYNDROME_RNR_RETRY_EXC_ERR\t\t= 0x16,\n\tMLX5_CQE_SYNDROME_REMOTE_ABORTED_ERR\t\t= 0x22,\n};\n\nenum {\n\tMLX5_CQE_OWNER_MASK\t= 1,\n\tMLX5_CQE_REQ\t\t= 0,\n\tMLX5_CQE_RESP_WR_IMM\t= 1,\n\tMLX5_CQE_RESP_SEND\t= 2,\n\tMLX5_CQE_RESP_SEND_IMM\t= 3,\n\tMLX5_CQE_RESP_SEND_INV\t= 4,\n\tMLX5_CQE_RESIZE_CQ\t= 5,\n\tMLX5_CQE_SIG_ERR\t= 12,\n\tMLX5_CQE_REQ_ERR\t= 13,\n\tMLX5_CQE_RESP_ERR\t= 14,\n\tMLX5_CQE_INVALID\t= 15,\n};\n\nenum {\n\tMLX5_CQ_MODIFY_PERIOD\t= 1 << 0,\n\tMLX5_CQ_MODIFY_COUNT\t= 1 << 1,\n\tMLX5_CQ_MODIFY_OVERRUN\t= 1 << 2,\n};\n\nenum {\n\tMLX5_CQ_OPMOD_RESIZE\t\t= 1,\n\tMLX5_MODIFY_CQ_MASK_LOG_SIZE\t= 1 << 0,\n\tMLX5_MODIFY_CQ_MASK_PG_OFFSET\t= 1 << 1,\n\tMLX5_MODIFY_CQ_MASK_PG_SIZE\t= 1 << 2,\n};\n\nstruct mlx5_cq_modify_params {\n\tint\ttype;\n\tunion {\n\t\tstruct {\n\t\t\tu32\tpage_offset;\n\t\t\tu8\tlog_cq_size;\n\t\t} resize;\n\n\t\tstruct {\n\t\t} moder;\n\n\t\tstruct {\n\t\t} mapping;\n\t} params;\n};\n\nenum {\n\tCQE_STRIDE_64 = 0,\n\tCQE_STRIDE_128 = 1,\n\tCQE_STRIDE_128_PAD = 2,\n};\n\n#define MLX5_MAX_CQ_PERIOD (BIT(__mlx5_bit_sz(cqc, cq_period)) - 1)\n#define MLX5_MAX_CQ_COUNT (BIT(__mlx5_bit_sz(cqc, cq_max_count)) - 1)\n\nstatic inline int cqe_sz_to_mlx_sz(u8 size, int padding_128_en)\n{\n\treturn padding_128_en ? CQE_STRIDE_128_PAD :\n\t\t\t\tsize == 64 ? CQE_STRIDE_64 : CQE_STRIDE_128;\n}\n\nstatic inline void mlx5_cq_set_ci(struct mlx5_core_cq *cq)\n{\n\t*cq->set_ci_db = cpu_to_be32(cq->cons_index & 0xffffff);\n}\n\nenum {\n\tMLX5_CQ_DB_REQ_NOT_SOL\t\t= 1 << 24,\n\tMLX5_CQ_DB_REQ_NOT\t\t= 0 << 24\n};\n\nstatic inline void mlx5_cq_arm(struct mlx5_core_cq *cq, u32 cmd,\n\t\t\t       void __iomem *uar_page,\n\t\t\t       u32 cons_index)\n{\n\t__be32 doorbell[2];\n\tu32 sn;\n\tu32 ci;\n\n\tsn = cq->arm_sn & 3;\n\tci = cons_index & 0xffffff;\n\n\t*cq->arm_db = cpu_to_be32(sn << 28 | cmd | ci);\n\n\t \n\twmb();\n\n\tdoorbell[0] = cpu_to_be32(sn << 28 | cmd | ci);\n\tdoorbell[1] = cpu_to_be32(cq->cqn);\n\n\tmlx5_write64(doorbell, uar_page + MLX5_CQ_DOORBELL);\n}\n\nstatic inline void mlx5_cq_hold(struct mlx5_core_cq *cq)\n{\n\trefcount_inc(&cq->refcount);\n}\n\nstatic inline void mlx5_cq_put(struct mlx5_core_cq *cq)\n{\n\tif (refcount_dec_and_test(&cq->refcount))\n\t\tcomplete(&cq->free);\n}\n\nint mlx5_create_cq(struct mlx5_core_dev *dev, struct mlx5_core_cq *cq,\n\t\t   u32 *in, int inlen, u32 *out, int outlen);\nint mlx5_core_create_cq(struct mlx5_core_dev *dev, struct mlx5_core_cq *cq,\n\t\t\tu32 *in, int inlen, u32 *out, int outlen);\nint mlx5_core_destroy_cq(struct mlx5_core_dev *dev, struct mlx5_core_cq *cq);\nint mlx5_core_query_cq(struct mlx5_core_dev *dev, struct mlx5_core_cq *cq,\n\t\t       u32 *out);\nint mlx5_core_modify_cq(struct mlx5_core_dev *dev, struct mlx5_core_cq *cq,\n\t\t\tu32 *in, int inlen);\nint mlx5_core_modify_cq_moderation(struct mlx5_core_dev *dev,\n\t\t\t\t   struct mlx5_core_cq *cq, u16 cq_period,\n\t\t\t\t   u16 cq_max_count);\nstatic inline void mlx5_dump_err_cqe(struct mlx5_core_dev *dev,\n\t\t\t\t     struct mlx5_err_cqe *err_cqe)\n{\n\tprint_hex_dump(KERN_WARNING, \"\", DUMP_PREFIX_OFFSET, 16, 1, err_cqe,\n\t\t       sizeof(*err_cqe), false);\n}\nint mlx5_debug_cq_add(struct mlx5_core_dev *dev, struct mlx5_core_cq *cq);\nvoid mlx5_debug_cq_remove(struct mlx5_core_dev *dev, struct mlx5_core_cq *cq);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}