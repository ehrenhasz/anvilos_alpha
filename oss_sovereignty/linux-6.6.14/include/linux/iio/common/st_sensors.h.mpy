{
  "module_name": "st_sensors.h",
  "hash_id": "46ce8ac64827422666f4bc36c6ed5279d8fa64f05e47b0af9661bdcc02db271a",
  "original_prompt": "Ingested from linux-6.6.14/include/linux/iio/common/st_sensors.h",
  "human_readable_source": " \n \n\n#ifndef ST_SENSORS_H\n#define ST_SENSORS_H\n\n#include <linux/i2c.h>\n#include <linux/spi/spi.h>\n#include <linux/irqreturn.h>\n#include <linux/iio/iio.h>\n#include <linux/iio/trigger.h>\n#include <linux/bitops.h>\n#include <linux/regulator/consumer.h>\n#include <linux/regmap.h>\n\n#include <linux/platform_data/st_sensors_pdata.h>\n\n#define LSM9DS0_IMU_DEV_NAME\t\t\"lsm9ds0\"\n#define LSM303D_IMU_DEV_NAME\t\t\"lsm303d\"\n\n \n#define ST_SENSORS_MAX_BUFFER_SIZE\t\t(ALIGN(2 * 3, sizeof(s64)) + \\\n\t\t\t\t\t\t sizeof(s64))\n\n#define ST_SENSORS_ODR_LIST_MAX\t\t\t10\n#define ST_SENSORS_FULLSCALE_AVL_MAX\t\t10\n\n#define ST_SENSORS_NUMBER_ALL_CHANNELS\t\t4\n#define ST_SENSORS_ENABLE_ALL_AXIS\t\t0x07\n#define ST_SENSORS_SCAN_X\t\t\t0\n#define ST_SENSORS_SCAN_Y\t\t\t1\n#define ST_SENSORS_SCAN_Z\t\t\t2\n#define ST_SENSORS_DEFAULT_POWER_ON_VALUE\t0x01\n#define ST_SENSORS_DEFAULT_POWER_OFF_VALUE\t0x00\n#define ST_SENSORS_DEFAULT_WAI_ADDRESS\t\t0x0f\n#define ST_SENSORS_DEFAULT_AXIS_ADDR\t\t0x20\n#define ST_SENSORS_DEFAULT_AXIS_MASK\t\t0x07\n#define ST_SENSORS_DEFAULT_AXIS_N_BIT\t\t3\n#define ST_SENSORS_DEFAULT_STAT_ADDR\t\t0x27\n\n#define ST_SENSORS_MAX_NAME\t\t\t17\n#define ST_SENSORS_MAX_4WAI\t\t\t8\n\n#define ST_SENSORS_LSM_CHANNELS_EXT(device_type, mask, index, mod, \\\n\t\t\t\t    ch2, s, endian, rbits, sbits, addr, ext) \\\n{ \\\n\t.type = device_type, \\\n\t.modified = mod, \\\n\t.info_mask_separate = mask, \\\n\t.info_mask_shared_by_all = BIT(IIO_CHAN_INFO_SAMP_FREQ), \\\n\t.scan_index = index, \\\n\t.channel2 = ch2, \\\n\t.address = addr, \\\n\t.scan_type = { \\\n\t\t.sign = s, \\\n\t\t.realbits = rbits, \\\n\t\t.shift = sbits - rbits, \\\n\t\t.storagebits = sbits, \\\n\t\t.endianness = endian, \\\n\t}, \\\n\t.ext_info = ext, \\\n}\n\n#define ST_SENSORS_LSM_CHANNELS(device_type, mask, index, mod, \\\n\t\t\t\tch2, s, endian, rbits, sbits, addr)\t\\\n\tST_SENSORS_LSM_CHANNELS_EXT(device_type, mask, index, mod,\t\\\n\t\t\t\t    ch2, s, endian, rbits, sbits, addr, NULL)\n\n#define ST_SENSORS_DEV_ATTR_SAMP_FREQ_AVAIL() \\\n\t\tIIO_DEV_ATTR_SAMP_FREQ_AVAIL( \\\n\t\t\tst_sensors_sysfs_sampling_frequency_avail)\n\n#define ST_SENSORS_DEV_ATTR_SCALE_AVAIL(name) \\\n\t\tIIO_DEVICE_ATTR(name, S_IRUGO, \\\n\t\t\tst_sensors_sysfs_scale_avail, NULL , 0);\n\nstruct st_sensor_odr_avl {\n\tunsigned int hz;\n\tu8 value;\n};\n\nstruct st_sensor_odr {\n\tu8 addr;\n\tu8 mask;\n\tstruct st_sensor_odr_avl odr_avl[ST_SENSORS_ODR_LIST_MAX];\n};\n\nstruct st_sensor_power {\n\tu8 addr;\n\tu8 mask;\n\tu8 value_off;\n\tu8 value_on;\n};\n\nstruct st_sensor_axis {\n\tu8 addr;\n\tu8 mask;\n};\n\nstruct st_sensor_fullscale_avl {\n\tunsigned int num;\n\tu8 value;\n\tunsigned int gain;\n\tunsigned int gain2;\n};\n\nstruct st_sensor_fullscale {\n\tu8 addr;\n\tu8 mask;\n\tstruct st_sensor_fullscale_avl fs_avl[ST_SENSORS_FULLSCALE_AVL_MAX];\n};\n\nstruct st_sensor_sim {\n\tu8 addr;\n\tu8 value;\n};\n\n \nstruct st_sensor_bdu {\n\tu8 addr;\n\tu8 mask;\n};\n\n \nstruct st_sensor_das {\n\tu8 addr;\n\tu8 mask;\n};\n\n \nstruct st_sensor_int_drdy {\n\tu8 addr;\n\tu8 mask;\n\tu8 addr_od;\n\tu8 mask_od;\n};\n\n \nstruct st_sensor_data_ready_irq {\n\tstruct st_sensor_int_drdy int1;\n\tstruct st_sensor_int_drdy int2;\n\tu8 addr_ihl;\n\tu8 mask_ihl;\n\tstruct {\n\t\tu8 addr;\n\t\tu8 mask;\n\t} stat_drdy;\n\tstruct {\n\t\tu8 en_addr;\n\t\tu8 en_mask;\n\t} ig1;\n};\n\n \nstruct st_sensor_settings {\n\tu8 wai;\n\tu8 wai_addr;\n\tchar sensors_supported[ST_SENSORS_MAX_4WAI][ST_SENSORS_MAX_NAME];\n\tstruct iio_chan_spec *ch;\n\tint num_ch;\n\tstruct st_sensor_odr odr;\n\tstruct st_sensor_power pw;\n\tstruct st_sensor_axis enable_axis;\n\tstruct st_sensor_fullscale fs;\n\tstruct st_sensor_bdu bdu;\n\tstruct st_sensor_das das;\n\tstruct st_sensor_data_ready_irq drdy_irq;\n\tstruct st_sensor_sim sim;\n\tbool multi_read_bit;\n\tunsigned int bootime;\n};\n\n \nstruct st_sensor_data {\n\tstruct iio_trigger *trig;\n\tstruct iio_mount_matrix mount_matrix;\n\tstruct st_sensor_settings *sensor_settings;\n\tstruct st_sensor_fullscale_avl *current_fullscale;\n\tstruct regmap *regmap;\n\n\tbool enabled;\n\n\tunsigned int odr;\n\tunsigned int num_data_channels;\n\n\tu8 drdy_int_pin;\n\tbool int_pin_open_drain;\n\tint irq;\n\n\tbool edge_irq;\n\tbool hw_irq_trigger;\n\ts64 hw_timestamp;\n\n\tchar buffer_data[ST_SENSORS_MAX_BUFFER_SIZE] ____cacheline_aligned;\n\n\tstruct mutex odr_lock;\n};\n\n#ifdef CONFIG_IIO_BUFFER\nirqreturn_t st_sensors_trigger_handler(int irq, void *p);\n#endif\n\n#ifdef CONFIG_IIO_TRIGGER\nint st_sensors_allocate_trigger(struct iio_dev *indio_dev,\n\t\t\t\tconst struct iio_trigger_ops *trigger_ops);\n\nint st_sensors_validate_device(struct iio_trigger *trig,\n\t\t\t       struct iio_dev *indio_dev);\n#else\nstatic inline int st_sensors_allocate_trigger(struct iio_dev *indio_dev,\n\t\t\t\tconst struct iio_trigger_ops *trigger_ops)\n{\n\treturn 0;\n}\n#define st_sensors_validate_device NULL\n#endif\n\nint st_sensors_init_sensor(struct iio_dev *indio_dev,\n\t\t\t\t\tstruct st_sensors_platform_data *pdata);\n\nint st_sensors_set_enable(struct iio_dev *indio_dev, bool enable);\n\nint st_sensors_set_axis_enable(struct iio_dev *indio_dev, u8 axis_enable);\n\nint st_sensors_power_enable(struct iio_dev *indio_dev);\n\nint st_sensors_debugfs_reg_access(struct iio_dev *indio_dev,\n\t\t\t\t  unsigned reg, unsigned writeval,\n\t\t\t\t  unsigned *readval);\n\nint st_sensors_set_odr(struct iio_dev *indio_dev, unsigned int odr);\n\nint st_sensors_set_dataready_irq(struct iio_dev *indio_dev, bool enable);\n\nint st_sensors_set_fullscale_by_gain(struct iio_dev *indio_dev, int scale);\n\nint st_sensors_read_info_raw(struct iio_dev *indio_dev,\n\t\t\t\tstruct iio_chan_spec const *ch, int *val);\n\nint st_sensors_get_settings_index(const char *name,\n\t\t\t\t  const struct st_sensor_settings *list,\n\t\t\t\t  const int list_length);\n\nint st_sensors_verify_id(struct iio_dev *indio_dev);\n\nssize_t st_sensors_sysfs_sampling_frequency_avail(struct device *dev,\n\t\t\t\tstruct device_attribute *attr, char *buf);\n\nssize_t st_sensors_sysfs_scale_avail(struct device *dev,\n\t\t\t\tstruct device_attribute *attr, char *buf);\n\nvoid st_sensors_dev_name_probe(struct device *dev, char *name, int len);\n\n \nconst struct st_sensor_settings *st_accel_get_settings(const char *name);\nint st_accel_common_probe(struct iio_dev *indio_dev);\n\n \nconst struct st_sensor_settings *st_gyro_get_settings(const char *name);\nint st_gyro_common_probe(struct iio_dev *indio_dev);\n\n \nconst struct st_sensor_settings *st_magn_get_settings(const char *name);\nint st_magn_common_probe(struct iio_dev *indio_dev);\n\n \nconst struct st_sensor_settings *st_press_get_settings(const char *name);\nint st_press_common_probe(struct iio_dev *indio_dev);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}