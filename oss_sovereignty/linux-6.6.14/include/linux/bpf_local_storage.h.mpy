{
  "module_name": "bpf_local_storage.h",
  "hash_id": "f0462f20850637b8cf09439ef46a955804a6f38703bec9da9ef24f4c95aca774",
  "original_prompt": "Ingested from linux-6.6.14/include/linux/bpf_local_storage.h",
  "human_readable_source": " \n \n\n#ifndef _BPF_LOCAL_STORAGE_H\n#define _BPF_LOCAL_STORAGE_H\n\n#include <linux/bpf.h>\n#include <linux/filter.h>\n#include <linux/rculist.h>\n#include <linux/list.h>\n#include <linux/hash.h>\n#include <linux/types.h>\n#include <linux/bpf_mem_alloc.h>\n#include <uapi/linux/btf.h>\n\n#define BPF_LOCAL_STORAGE_CACHE_SIZE\t16\n\n#define bpf_rcu_lock_held()                                                    \\\n\t(rcu_read_lock_held() || rcu_read_lock_trace_held() ||                 \\\n\t rcu_read_lock_bh_held())\nstruct bpf_local_storage_map_bucket {\n\tstruct hlist_head list;\n\traw_spinlock_t lock;\n};\n\n \nstruct bpf_local_storage_map {\n\tstruct bpf_map map;\n\t \n\tstruct bpf_local_storage_map_bucket *buckets;\n\tu32 bucket_log;\n\tu16 elem_size;\n\tu16 cache_idx;\n\tstruct bpf_mem_alloc selem_ma;\n\tstruct bpf_mem_alloc storage_ma;\n\tbool bpf_ma;\n};\n\nstruct bpf_local_storage_data {\n\t \n\tstruct bpf_local_storage_map __rcu *smap;\n\tu8 data[] __aligned(8);\n};\n\n \nstruct bpf_local_storage_elem {\n\tstruct hlist_node map_node;\t \n\tstruct hlist_node snode;\t \n\tstruct bpf_local_storage __rcu *local_storage;\n\tstruct rcu_head rcu;\n\t \n\t \n\tstruct bpf_local_storage_data sdata ____cacheline_aligned;\n};\n\nstruct bpf_local_storage {\n\tstruct bpf_local_storage_data __rcu *cache[BPF_LOCAL_STORAGE_CACHE_SIZE];\n\tstruct bpf_local_storage_map __rcu *smap;\n\tstruct hlist_head list;  \n\tvoid *owner;\t\t \n\tstruct rcu_head rcu;\n\traw_spinlock_t lock;\t \n};\n\n \n#define BPF_LOCAL_STORAGE_MAX_VALUE_SIZE\t\t\t\t       \\\n\tmin_t(u32,                                                             \\\n\t      (KMALLOC_MAX_SIZE - MAX_BPF_STACK -                              \\\n\t       sizeof(struct bpf_local_storage_elem)),                         \\\n\t      (U16_MAX - sizeof(struct bpf_local_storage_elem)))\n\n#define SELEM(_SDATA)                                                          \\\n\tcontainer_of((_SDATA), struct bpf_local_storage_elem, sdata)\n#define SDATA(_SELEM) (&(_SELEM)->sdata)\n\n#define BPF_LOCAL_STORAGE_CACHE_SIZE\t16\n\nstruct bpf_local_storage_cache {\n\tspinlock_t idx_lock;\n\tu64 idx_usage_counts[BPF_LOCAL_STORAGE_CACHE_SIZE];\n};\n\n#define DEFINE_BPF_STORAGE_CACHE(name)\t\t\t\t\\\nstatic struct bpf_local_storage_cache name = {\t\t\t\\\n\t.idx_lock = __SPIN_LOCK_UNLOCKED(name.idx_lock),\t\\\n}\n\n \nint bpf_local_storage_map_alloc_check(union bpf_attr *attr);\n\nstruct bpf_map *\nbpf_local_storage_map_alloc(union bpf_attr *attr,\n\t\t\t    struct bpf_local_storage_cache *cache,\n\t\t\t    bool bpf_ma);\n\nstruct bpf_local_storage_data *\nbpf_local_storage_lookup(struct bpf_local_storage *local_storage,\n\t\t\t struct bpf_local_storage_map *smap,\n\t\t\t bool cacheit_lockit);\n\nvoid bpf_local_storage_destroy(struct bpf_local_storage *local_storage);\n\nvoid bpf_local_storage_map_free(struct bpf_map *map,\n\t\t\t\tstruct bpf_local_storage_cache *cache,\n\t\t\t\tint __percpu *busy_counter);\n\nint bpf_local_storage_map_check_btf(const struct bpf_map *map,\n\t\t\t\t    const struct btf *btf,\n\t\t\t\t    const struct btf_type *key_type,\n\t\t\t\t    const struct btf_type *value_type);\n\nvoid bpf_selem_link_storage_nolock(struct bpf_local_storage *local_storage,\n\t\t\t\t   struct bpf_local_storage_elem *selem);\n\nvoid bpf_selem_unlink(struct bpf_local_storage_elem *selem, bool reuse_now);\n\nvoid bpf_selem_link_map(struct bpf_local_storage_map *smap,\n\t\t\tstruct bpf_local_storage_elem *selem);\n\nstruct bpf_local_storage_elem *\nbpf_selem_alloc(struct bpf_local_storage_map *smap, void *owner, void *value,\n\t\tbool charge_mem, gfp_t gfp_flags);\n\nvoid bpf_selem_free(struct bpf_local_storage_elem *selem,\n\t\t    struct bpf_local_storage_map *smap,\n\t\t    bool reuse_now);\n\nint\nbpf_local_storage_alloc(void *owner,\n\t\t\tstruct bpf_local_storage_map *smap,\n\t\t\tstruct bpf_local_storage_elem *first_selem,\n\t\t\tgfp_t gfp_flags);\n\nstruct bpf_local_storage_data *\nbpf_local_storage_update(void *owner, struct bpf_local_storage_map *smap,\n\t\t\t void *value, u64 map_flags, gfp_t gfp_flags);\n\nu64 bpf_local_storage_map_mem_usage(const struct bpf_map *map);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}