{
  "module_name": "mnt_idmapping.h",
  "hash_id": "8eb6fb0ed779a2dff519ee49543b1192b45ec93d9583808116bf1ef7c046dedf",
  "original_prompt": "Ingested from linux-6.6.14/include/linux/mnt_idmapping.h",
  "human_readable_source": " \n#ifndef _LINUX_MNT_IDMAPPING_H\n#define _LINUX_MNT_IDMAPPING_H\n\n#include <linux/types.h>\n#include <linux/uidgid.h>\n\nstruct mnt_idmap;\nstruct user_namespace;\n\nextern struct mnt_idmap nop_mnt_idmap;\nextern struct user_namespace init_user_ns;\n\ntypedef struct {\n\tuid_t val;\n} vfsuid_t;\n\ntypedef struct {\n\tgid_t val;\n} vfsgid_t;\n\nstatic_assert(sizeof(vfsuid_t) == sizeof(kuid_t));\nstatic_assert(sizeof(vfsgid_t) == sizeof(kgid_t));\nstatic_assert(offsetof(vfsuid_t, val) == offsetof(kuid_t, val));\nstatic_assert(offsetof(vfsgid_t, val) == offsetof(kgid_t, val));\n\n#ifdef CONFIG_MULTIUSER\nstatic inline uid_t __vfsuid_val(vfsuid_t uid)\n{\n\treturn uid.val;\n}\n\nstatic inline gid_t __vfsgid_val(vfsgid_t gid)\n{\n\treturn gid.val;\n}\n#else\nstatic inline uid_t __vfsuid_val(vfsuid_t uid)\n{\n\treturn 0;\n}\n\nstatic inline gid_t __vfsgid_val(vfsgid_t gid)\n{\n\treturn 0;\n}\n#endif\n\nstatic inline bool vfsuid_valid(vfsuid_t uid)\n{\n\treturn __vfsuid_val(uid) != (uid_t)-1;\n}\n\nstatic inline bool vfsgid_valid(vfsgid_t gid)\n{\n\treturn __vfsgid_val(gid) != (gid_t)-1;\n}\n\nstatic inline bool vfsuid_eq(vfsuid_t left, vfsuid_t right)\n{\n\treturn vfsuid_valid(left) && __vfsuid_val(left) == __vfsuid_val(right);\n}\n\nstatic inline bool vfsgid_eq(vfsgid_t left, vfsgid_t right)\n{\n\treturn vfsgid_valid(left) && __vfsgid_val(left) == __vfsgid_val(right);\n}\n\n \nstatic inline bool vfsuid_eq_kuid(vfsuid_t vfsuid, kuid_t kuid)\n{\n\treturn vfsuid_valid(vfsuid) && __vfsuid_val(vfsuid) == __kuid_val(kuid);\n}\n\n \nstatic inline bool vfsgid_eq_kgid(vfsgid_t vfsgid, kgid_t kgid)\n{\n\treturn vfsgid_valid(vfsgid) && __vfsgid_val(vfsgid) == __kgid_val(kgid);\n}\n\n \n#define VFSUIDT_INIT(val) (vfsuid_t){ __kuid_val(val) }\n#define VFSGIDT_INIT(val) (vfsgid_t){ __kgid_val(val) }\n\n#define INVALID_VFSUID VFSUIDT_INIT(INVALID_UID)\n#define INVALID_VFSGID VFSGIDT_INIT(INVALID_GID)\n\n \n#define AS_KUIDT(val) (kuid_t){ __vfsuid_val(val) }\n#define AS_KGIDT(val) (kgid_t){ __vfsgid_val(val) }\n\nint vfsgid_in_group_p(vfsgid_t vfsgid);\n\nvfsuid_t make_vfsuid(struct mnt_idmap *idmap,\n\t\t     struct user_namespace *fs_userns, kuid_t kuid);\n\nvfsgid_t make_vfsgid(struct mnt_idmap *idmap,\n\t\t     struct user_namespace *fs_userns, kgid_t kgid);\n\nkuid_t from_vfsuid(struct mnt_idmap *idmap,\n\t\t   struct user_namespace *fs_userns, vfsuid_t vfsuid);\n\nkgid_t from_vfsgid(struct mnt_idmap *idmap,\n\t\t   struct user_namespace *fs_userns, vfsgid_t vfsgid);\n\n \nstatic inline bool vfsuid_has_fsmapping(struct mnt_idmap *idmap,\n\t\t\t\t\tstruct user_namespace *fs_userns,\n\t\t\t\t\tvfsuid_t vfsuid)\n{\n\treturn uid_valid(from_vfsuid(idmap, fs_userns, vfsuid));\n}\n\nstatic inline bool vfsuid_has_mapping(struct user_namespace *userns,\n\t\t\t\t      vfsuid_t vfsuid)\n{\n\treturn from_kuid(userns, AS_KUIDT(vfsuid)) != (uid_t)-1;\n}\n\n \nstatic inline kuid_t vfsuid_into_kuid(vfsuid_t vfsuid)\n{\n\treturn AS_KUIDT(vfsuid);\n}\n\n \nstatic inline bool vfsgid_has_fsmapping(struct mnt_idmap *idmap,\n\t\t\t\t\tstruct user_namespace *fs_userns,\n\t\t\t\t\tvfsgid_t vfsgid)\n{\n\treturn gid_valid(from_vfsgid(idmap, fs_userns, vfsgid));\n}\n\nstatic inline bool vfsgid_has_mapping(struct user_namespace *userns,\n\t\t\t\t      vfsgid_t vfsgid)\n{\n\treturn from_kgid(userns, AS_KGIDT(vfsgid)) != (gid_t)-1;\n}\n\n \nstatic inline kgid_t vfsgid_into_kgid(vfsgid_t vfsgid)\n{\n\treturn AS_KGIDT(vfsgid);\n}\n\n \nstatic inline kuid_t mapped_fsuid(struct mnt_idmap *idmap,\n\t\t\t\t  struct user_namespace *fs_userns)\n{\n\treturn from_vfsuid(idmap, fs_userns, VFSUIDT_INIT(current_fsuid()));\n}\n\n \nstatic inline kgid_t mapped_fsgid(struct mnt_idmap *idmap,\n\t\t\t\t  struct user_namespace *fs_userns)\n{\n\treturn from_vfsgid(idmap, fs_userns, VFSGIDT_INIT(current_fsgid()));\n}\n\nbool check_fsmapping(const struct mnt_idmap *idmap,\n\t\t     const struct super_block *sb);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}