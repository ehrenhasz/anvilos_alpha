{
  "module_name": "vdpa.h",
  "hash_id": "5a650c91105e58033b4b7aa202a9098878695b0d25b702de8a630223b18774f5",
  "original_prompt": "Ingested from linux-6.6.14/include/linux/vdpa.h",
  "human_readable_source": " \n#ifndef _LINUX_VDPA_H\n#define _LINUX_VDPA_H\n\n#include <linux/kernel.h>\n#include <linux/device.h>\n#include <linux/interrupt.h>\n#include <linux/vhost_iotlb.h>\n#include <linux/virtio_net.h>\n#include <linux/if_ether.h>\n\n \nstruct vdpa_callback {\n\tirqreturn_t (*callback)(void *data);\n\tvoid *private;\n\tstruct eventfd_ctx *trigger;\n};\n\n \nstruct vdpa_notification_area {\n\tresource_size_t addr;\n\tresource_size_t size;\n};\n\n \nstruct vdpa_vq_state_split {\n\tu16\tavail_index;\n};\n\n \nstruct vdpa_vq_state_packed {\n\tu16\tlast_avail_counter:1;\n\tu16\tlast_avail_idx:15;\n\tu16\tlast_used_counter:1;\n\tu16\tlast_used_idx:15;\n};\n\nstruct vdpa_vq_state {\n\tunion {\n\t\tstruct vdpa_vq_state_split split;\n\t\tstruct vdpa_vq_state_packed packed;\n\t};\n};\n\nstruct vdpa_mgmt_dev;\n\n \nstruct vdpa_device {\n\tstruct device dev;\n\tstruct device *dma_dev;\n\tconst char *driver_override;\n\tconst struct vdpa_config_ops *config;\n\tstruct rw_semaphore cf_lock;  \n\tunsigned int index;\n\tbool features_valid;\n\tbool use_va;\n\tu32 nvqs;\n\tstruct vdpa_mgmt_dev *mdev;\n\tunsigned int ngroups;\n\tunsigned int nas;\n};\n\n \nstruct vdpa_iova_range {\n\tu64 first;\n\tu64 last;\n};\n\nstruct vdpa_dev_set_config {\n\tu64 device_features;\n\tstruct {\n\t\tu8 mac[ETH_ALEN];\n\t\tu16 mtu;\n\t\tu16 max_vq_pairs;\n\t} net;\n\tu64 mask;\n};\n\n \nstruct vdpa_map_file {\n\tstruct file *file;\n\tu64 offset;\n};\n\n \nstruct vdpa_config_ops {\n\t \n\tint (*set_vq_address)(struct vdpa_device *vdev,\n\t\t\t      u16 idx, u64 desc_area, u64 driver_area,\n\t\t\t      u64 device_area);\n\tvoid (*set_vq_num)(struct vdpa_device *vdev, u16 idx, u32 num);\n\tvoid (*kick_vq)(struct vdpa_device *vdev, u16 idx);\n\tvoid (*kick_vq_with_data)(struct vdpa_device *vdev, u32 data);\n\tvoid (*set_vq_cb)(struct vdpa_device *vdev, u16 idx,\n\t\t\t  struct vdpa_callback *cb);\n\tvoid (*set_vq_ready)(struct vdpa_device *vdev, u16 idx, bool ready);\n\tbool (*get_vq_ready)(struct vdpa_device *vdev, u16 idx);\n\tint (*set_vq_state)(struct vdpa_device *vdev, u16 idx,\n\t\t\t    const struct vdpa_vq_state *state);\n\tint (*get_vq_state)(struct vdpa_device *vdev, u16 idx,\n\t\t\t    struct vdpa_vq_state *state);\n\tint (*get_vendor_vq_stats)(struct vdpa_device *vdev, u16 idx,\n\t\t\t\t   struct sk_buff *msg,\n\t\t\t\t   struct netlink_ext_ack *extack);\n\tstruct vdpa_notification_area\n\t(*get_vq_notification)(struct vdpa_device *vdev, u16 idx);\n\t \n\tint (*get_vq_irq)(struct vdpa_device *vdev, u16 idx);\n\n\t \n\tu32 (*get_vq_align)(struct vdpa_device *vdev);\n\tu32 (*get_vq_group)(struct vdpa_device *vdev, u16 idx);\n\tu64 (*get_device_features)(struct vdpa_device *vdev);\n\tu64 (*get_backend_features)(const struct vdpa_device *vdev);\n\tint (*set_driver_features)(struct vdpa_device *vdev, u64 features);\n\tu64 (*get_driver_features)(struct vdpa_device *vdev);\n\tvoid (*set_config_cb)(struct vdpa_device *vdev,\n\t\t\t      struct vdpa_callback *cb);\n\tu16 (*get_vq_num_max)(struct vdpa_device *vdev);\n\tu16 (*get_vq_num_min)(struct vdpa_device *vdev);\n\tu32 (*get_device_id)(struct vdpa_device *vdev);\n\tu32 (*get_vendor_id)(struct vdpa_device *vdev);\n\tu8 (*get_status)(struct vdpa_device *vdev);\n\tvoid (*set_status)(struct vdpa_device *vdev, u8 status);\n\tint (*reset)(struct vdpa_device *vdev);\n\tint (*suspend)(struct vdpa_device *vdev);\n\tint (*resume)(struct vdpa_device *vdev);\n\tsize_t (*get_config_size)(struct vdpa_device *vdev);\n\tvoid (*get_config)(struct vdpa_device *vdev, unsigned int offset,\n\t\t\t   void *buf, unsigned int len);\n\tvoid (*set_config)(struct vdpa_device *vdev, unsigned int offset,\n\t\t\t   const void *buf, unsigned int len);\n\tu32 (*get_generation)(struct vdpa_device *vdev);\n\tstruct vdpa_iova_range (*get_iova_range)(struct vdpa_device *vdev);\n\tint (*set_vq_affinity)(struct vdpa_device *vdev, u16 idx,\n\t\t\t       const struct cpumask *cpu_mask);\n\tconst struct cpumask *(*get_vq_affinity)(struct vdpa_device *vdev,\n\t\t\t\t\t\t u16 idx);\n\n\t \n\tint (*set_map)(struct vdpa_device *vdev, unsigned int asid,\n\t\t       struct vhost_iotlb *iotlb);\n\tint (*dma_map)(struct vdpa_device *vdev, unsigned int asid,\n\t\t       u64 iova, u64 size, u64 pa, u32 perm, void *opaque);\n\tint (*dma_unmap)(struct vdpa_device *vdev, unsigned int asid,\n\t\t\t u64 iova, u64 size);\n\tint (*set_group_asid)(struct vdpa_device *vdev, unsigned int group,\n\t\t\t      unsigned int asid);\n\tstruct device *(*get_vq_dma_dev)(struct vdpa_device *vdev, u16 idx);\n\tint (*bind_mm)(struct vdpa_device *vdev, struct mm_struct *mm);\n\tvoid (*unbind_mm)(struct vdpa_device *vdev);\n\n\t \n\tvoid (*free)(struct vdpa_device *vdev);\n};\n\nstruct vdpa_device *__vdpa_alloc_device(struct device *parent,\n\t\t\t\t\tconst struct vdpa_config_ops *config,\n\t\t\t\t\tunsigned int ngroups, unsigned int nas,\n\t\t\t\t\tsize_t size, const char *name,\n\t\t\t\t\tbool use_va);\n\n \n#define vdpa_alloc_device(dev_struct, member, parent, config, ngroups, nas, \\\n\t\t\t  name, use_va) \\\n\t\t\t  container_of((__vdpa_alloc_device( \\\n\t\t\t\t       parent, config, ngroups, nas, \\\n\t\t\t\t       (sizeof(dev_struct) + \\\n\t\t\t\t       BUILD_BUG_ON_ZERO(offsetof( \\\n\t\t\t\t       dev_struct, member))), name, use_va)), \\\n\t\t\t\t       dev_struct, member)\n\nint vdpa_register_device(struct vdpa_device *vdev, u32 nvqs);\nvoid vdpa_unregister_device(struct vdpa_device *vdev);\n\nint _vdpa_register_device(struct vdpa_device *vdev, u32 nvqs);\nvoid _vdpa_unregister_device(struct vdpa_device *vdev);\n\n \nstruct vdpa_driver {\n\tstruct device_driver driver;\n\tint (*probe)(struct vdpa_device *vdev);\n\tvoid (*remove)(struct vdpa_device *vdev);\n};\n\n#define vdpa_register_driver(drv) \\\n\t__vdpa_register_driver(drv, THIS_MODULE)\nint __vdpa_register_driver(struct vdpa_driver *drv, struct module *owner);\nvoid vdpa_unregister_driver(struct vdpa_driver *drv);\n\n#define module_vdpa_driver(__vdpa_driver) \\\n\tmodule_driver(__vdpa_driver, vdpa_register_driver,\t\\\n\t\t      vdpa_unregister_driver)\n\nstatic inline struct vdpa_driver *drv_to_vdpa(struct device_driver *driver)\n{\n\treturn container_of(driver, struct vdpa_driver, driver);\n}\n\nstatic inline struct vdpa_device *dev_to_vdpa(struct device *_dev)\n{\n\treturn container_of(_dev, struct vdpa_device, dev);\n}\n\nstatic inline void *vdpa_get_drvdata(const struct vdpa_device *vdev)\n{\n\treturn dev_get_drvdata(&vdev->dev);\n}\n\nstatic inline void vdpa_set_drvdata(struct vdpa_device *vdev, void *data)\n{\n\tdev_set_drvdata(&vdev->dev, data);\n}\n\nstatic inline struct device *vdpa_get_dma_dev(struct vdpa_device *vdev)\n{\n\treturn vdev->dma_dev;\n}\n\nstatic inline int vdpa_reset(struct vdpa_device *vdev)\n{\n\tconst struct vdpa_config_ops *ops = vdev->config;\n\tint ret;\n\n\tdown_write(&vdev->cf_lock);\n\tvdev->features_valid = false;\n\tret = ops->reset(vdev);\n\tup_write(&vdev->cf_lock);\n\treturn ret;\n}\n\nstatic inline int vdpa_set_features_unlocked(struct vdpa_device *vdev, u64 features)\n{\n\tconst struct vdpa_config_ops *ops = vdev->config;\n\tint ret;\n\n\tvdev->features_valid = true;\n\tret = ops->set_driver_features(vdev, features);\n\n\treturn ret;\n}\n\nstatic inline int vdpa_set_features(struct vdpa_device *vdev, u64 features)\n{\n\tint ret;\n\n\tdown_write(&vdev->cf_lock);\n\tret = vdpa_set_features_unlocked(vdev, features);\n\tup_write(&vdev->cf_lock);\n\n\treturn ret;\n}\n\nvoid vdpa_get_config(struct vdpa_device *vdev, unsigned int offset,\n\t\t     void *buf, unsigned int len);\nvoid vdpa_set_config(struct vdpa_device *dev, unsigned int offset,\n\t\t     const void *buf, unsigned int length);\nvoid vdpa_set_status(struct vdpa_device *vdev, u8 status);\n\n \nstruct vdpa_mgmtdev_ops {\n\tint (*dev_add)(struct vdpa_mgmt_dev *mdev, const char *name,\n\t\t       const struct vdpa_dev_set_config *config);\n\tvoid (*dev_del)(struct vdpa_mgmt_dev *mdev, struct vdpa_device *dev);\n};\n\n \nstruct vdpa_mgmt_dev {\n\tstruct device *device;\n\tconst struct vdpa_mgmtdev_ops *ops;\n\tstruct virtio_device_id *id_table;\n\tu64 config_attr_mask;\n\tstruct list_head list;\n\tu64 supported_features;\n\tu32 max_supported_vqs;\n};\n\nint vdpa_mgmtdev_register(struct vdpa_mgmt_dev *mdev);\nvoid vdpa_mgmtdev_unregister(struct vdpa_mgmt_dev *mdev);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}