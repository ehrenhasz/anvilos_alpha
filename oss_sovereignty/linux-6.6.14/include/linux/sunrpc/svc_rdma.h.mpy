{
  "module_name": "svc_rdma.h",
  "hash_id": "ca7daf8d16f9636629681b086702a24a403f1a444271b6c1c44d0520a721689d",
  "original_prompt": "Ingested from linux-6.6.14/include/linux/sunrpc/svc_rdma.h",
  "human_readable_source": " \n \n\n#ifndef SVC_RDMA_H\n#define SVC_RDMA_H\n#include <linux/llist.h>\n#include <linux/sunrpc/xdr.h>\n#include <linux/sunrpc/svcsock.h>\n#include <linux/sunrpc/rpc_rdma.h>\n#include <linux/sunrpc/rpc_rdma_cid.h>\n#include <linux/sunrpc/svc_rdma_pcl.h>\n\n#include <linux/percpu_counter.h>\n#include <rdma/ib_verbs.h>\n#include <rdma/rdma_cm.h>\n\n \nenum {\n\tRPCRDMA_PULLUP_THRESH = RPCRDMA_V1_DEF_INLINE_SIZE >> 1,\n\tRPCRDMA_DEF_INLINE_THRESH = 4096,\n\tRPCRDMA_MAX_INLINE_THRESH = 65536\n};\n\n \nextern unsigned int svcrdma_ord;\nextern unsigned int svcrdma_max_requests;\nextern unsigned int svcrdma_max_bc_requests;\nextern unsigned int svcrdma_max_req_size;\n\nextern struct percpu_counter svcrdma_stat_read;\nextern struct percpu_counter svcrdma_stat_recv;\nextern struct percpu_counter svcrdma_stat_sq_starve;\nextern struct percpu_counter svcrdma_stat_write;\n\nstruct svcxprt_rdma {\n\tstruct svc_xprt      sc_xprt;\t\t \n\tstruct rdma_cm_id    *sc_cm_id;\t\t \n\tstruct list_head     sc_accept_q;\t \n\tint\t\t     sc_ord;\t\t \n\tint                  sc_max_send_sges;\n\tbool\t\t     sc_snd_w_inv;\t \n\n\tatomic_t             sc_sq_avail;\t \n\tunsigned int\t     sc_sq_depth;\t \n\t__be32\t\t     sc_fc_credits;\t \n\tu32\t\t     sc_max_requests;\t \n\tu32\t\t     sc_max_bc_requests; \n\tint                  sc_max_req_size;\t \n\tu8\t\t     sc_port_num;\n\n\tstruct ib_pd         *sc_pd;\n\n\tspinlock_t\t     sc_send_lock;\n\tstruct llist_head    sc_send_ctxts;\n\tspinlock_t\t     sc_rw_ctxt_lock;\n\tstruct llist_head    sc_rw_ctxts;\n\n\tu32\t\t     sc_pending_recvs;\n\tu32\t\t     sc_recv_batch;\n\tstruct list_head     sc_rq_dto_q;\n\tspinlock_t\t     sc_rq_dto_lock;\n\tstruct ib_qp         *sc_qp;\n\tstruct ib_cq         *sc_rq_cq;\n\tstruct ib_cq         *sc_sq_cq;\n\n\tspinlock_t\t     sc_lock;\t\t \n\n\twait_queue_head_t    sc_send_wait;\t \n\tunsigned long\t     sc_flags;\n\tstruct work_struct   sc_work;\n\n\tstruct llist_head    sc_recv_ctxts;\n\n\tatomic_t\t     sc_completion_ids;\n};\n \n#define RDMAXPRT_CONN_PENDING\t3\n\n \nenum {\n\tRPCRDMA_LISTEN_BACKLOG\t= 10,\n\tRPCRDMA_MAX_REQUESTS\t= 64,\n\tRPCRDMA_MAX_BC_REQUESTS\t= 2,\n};\n\n#define RPCSVC_MAXPAYLOAD_RDMA\tRPCSVC_MAXPAYLOAD\n\nstruct svc_rdma_recv_ctxt {\n\tstruct llist_node\trc_node;\n\tstruct list_head\trc_list;\n\tstruct ib_recv_wr\trc_recv_wr;\n\tstruct ib_cqe\t\trc_cqe;\n\tstruct rpc_rdma_cid\trc_cid;\n\tstruct ib_sge\t\trc_recv_sge;\n\tvoid\t\t\t*rc_recv_buf;\n\tstruct xdr_stream\trc_stream;\n\tu32\t\t\trc_byte_len;\n\tunsigned int\t\trc_page_count;\n\tu32\t\t\trc_inv_rkey;\n\t__be32\t\t\trc_msgtype;\n\n\tstruct svc_rdma_pcl\trc_call_pcl;\n\n\tstruct svc_rdma_pcl\trc_read_pcl;\n\tstruct svc_rdma_chunk\t*rc_cur_result_payload;\n\tstruct svc_rdma_pcl\trc_write_pcl;\n\tstruct svc_rdma_pcl\trc_reply_pcl;\n};\n\nstruct svc_rdma_send_ctxt {\n\tstruct llist_node\tsc_node;\n\tstruct rpc_rdma_cid\tsc_cid;\n\n\tstruct ib_send_wr\tsc_send_wr;\n\tstruct ib_cqe\t\tsc_cqe;\n\tstruct xdr_buf\t\tsc_hdrbuf;\n\tstruct xdr_stream\tsc_stream;\n\tvoid\t\t\t*sc_xprt_buf;\n\tint\t\t\tsc_page_count;\n\tint\t\t\tsc_cur_sge_no;\n\tstruct page\t\t*sc_pages[RPCSVC_MAXPAGES];\n\tstruct ib_sge\t\tsc_sges[];\n};\n\n \nextern void svc_rdma_handle_bc_reply(struct svc_rqst *rqstp,\n\t\t\t\t     struct svc_rdma_recv_ctxt *rctxt);\n\n \nextern void svc_rdma_recv_ctxts_destroy(struct svcxprt_rdma *rdma);\nextern bool svc_rdma_post_recvs(struct svcxprt_rdma *rdma);\nextern struct svc_rdma_recv_ctxt *\n\t\tsvc_rdma_recv_ctxt_get(struct svcxprt_rdma *rdma);\nextern void svc_rdma_recv_ctxt_put(struct svcxprt_rdma *rdma,\n\t\t\t\t   struct svc_rdma_recv_ctxt *ctxt);\nextern void svc_rdma_flush_recv_queues(struct svcxprt_rdma *rdma);\nextern void svc_rdma_release_ctxt(struct svc_xprt *xprt, void *ctxt);\nextern int svc_rdma_recvfrom(struct svc_rqst *);\n\n \nextern void svc_rdma_destroy_rw_ctxts(struct svcxprt_rdma *rdma);\nextern int svc_rdma_send_write_chunk(struct svcxprt_rdma *rdma,\n\t\t\t\t     const struct svc_rdma_chunk *chunk,\n\t\t\t\t     const struct xdr_buf *xdr);\nextern int svc_rdma_send_reply_chunk(struct svcxprt_rdma *rdma,\n\t\t\t\t     const struct svc_rdma_recv_ctxt *rctxt,\n\t\t\t\t     const struct xdr_buf *xdr);\nextern int svc_rdma_process_read_list(struct svcxprt_rdma *rdma,\n\t\t\t\t      struct svc_rqst *rqstp,\n\t\t\t\t      struct svc_rdma_recv_ctxt *head);\n\n \nextern void svc_rdma_send_ctxts_destroy(struct svcxprt_rdma *rdma);\nextern struct svc_rdma_send_ctxt *\n\t\tsvc_rdma_send_ctxt_get(struct svcxprt_rdma *rdma);\nextern void svc_rdma_send_ctxt_put(struct svcxprt_rdma *rdma,\n\t\t\t\t   struct svc_rdma_send_ctxt *ctxt);\nextern int svc_rdma_send(struct svcxprt_rdma *rdma,\n\t\t\t struct svc_rdma_send_ctxt *ctxt);\nextern int svc_rdma_map_reply_msg(struct svcxprt_rdma *rdma,\n\t\t\t\t  struct svc_rdma_send_ctxt *sctxt,\n\t\t\t\t  const struct svc_rdma_recv_ctxt *rctxt,\n\t\t\t\t  const struct xdr_buf *xdr);\nextern void svc_rdma_send_error_msg(struct svcxprt_rdma *rdma,\n\t\t\t\t    struct svc_rdma_send_ctxt *sctxt,\n\t\t\t\t    struct svc_rdma_recv_ctxt *rctxt,\n\t\t\t\t    int status);\nextern void svc_rdma_wake_send_waiters(struct svcxprt_rdma *rdma, int avail);\nextern int svc_rdma_sendto(struct svc_rqst *);\nextern int svc_rdma_result_payload(struct svc_rqst *rqstp, unsigned int offset,\n\t\t\t\t   unsigned int length);\n\n \nextern struct svc_xprt_class svc_rdma_class;\n#ifdef CONFIG_SUNRPC_BACKCHANNEL\nextern struct svc_xprt_class svc_rdma_bc_class;\n#endif\n\n \nextern int svc_rdma_init(void);\nextern void svc_rdma_cleanup(void);\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}