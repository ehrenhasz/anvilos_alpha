{
  "module_name": "svc_xprt.h",
  "hash_id": "32cbe7242a74206f2192f87ab8ec61e7c027dcb1133e821649a12b6a5d0a2387",
  "original_prompt": "Ingested from linux-6.6.14/include/linux/sunrpc/svc_xprt.h",
  "human_readable_source": " \n \n\n#ifndef SUNRPC_SVC_XPRT_H\n#define SUNRPC_SVC_XPRT_H\n\n#include <linux/sunrpc/svc.h>\n\nstruct module;\n\nstruct svc_xprt_ops {\n\tstruct svc_xprt\t*(*xpo_create)(struct svc_serv *,\n\t\t\t\t       struct net *net,\n\t\t\t\t       struct sockaddr *, int,\n\t\t\t\t       int);\n\tstruct svc_xprt\t*(*xpo_accept)(struct svc_xprt *);\n\tint\t\t(*xpo_has_wspace)(struct svc_xprt *);\n\tint\t\t(*xpo_recvfrom)(struct svc_rqst *);\n\tint\t\t(*xpo_sendto)(struct svc_rqst *);\n\tint\t\t(*xpo_result_payload)(struct svc_rqst *, unsigned int,\n\t\t\t\t\t      unsigned int);\n\tvoid\t\t(*xpo_release_ctxt)(struct svc_xprt *xprt, void *ctxt);\n\tvoid\t\t(*xpo_detach)(struct svc_xprt *);\n\tvoid\t\t(*xpo_free)(struct svc_xprt *);\n\tvoid\t\t(*xpo_kill_temp_xprt)(struct svc_xprt *);\n\tvoid\t\t(*xpo_handshake)(struct svc_xprt *xprt);\n};\n\nstruct svc_xprt_class {\n\tconst char\t\t*xcl_name;\n\tstruct module\t\t*xcl_owner;\n\tconst struct svc_xprt_ops *xcl_ops;\n\tstruct list_head\txcl_list;\n\tu32\t\t\txcl_max_payload;\n\tint\t\t\txcl_ident;\n};\n\n \nstruct svc_xpt_user {\n\tstruct list_head list;\n\tvoid (*callback)(struct svc_xpt_user *);\n};\n\nstruct svc_xprt {\n\tstruct svc_xprt_class\t*xpt_class;\n\tconst struct svc_xprt_ops *xpt_ops;\n\tstruct kref\t\txpt_ref;\n\tstruct list_head\txpt_list;\n\tstruct list_head\txpt_ready;\n\tunsigned long\t\txpt_flags;\n\n\tstruct svc_serv\t\t*xpt_server;\t \n\tatomic_t    \t    \txpt_reserved;\t \n\tatomic_t\t\txpt_nr_rqsts;\t \n\tstruct mutex\t\txpt_mutex;\t \n\tspinlock_t\t\txpt_lock;\t \n\tvoid\t\t\t*xpt_auth_cache; \n\tstruct list_head\txpt_deferred;\t \n\tstruct sockaddr_storage\txpt_local;\t \n\tsize_t\t\t\txpt_locallen;\t \n\tstruct sockaddr_storage\txpt_remote;\t \n\tsize_t\t\t\txpt_remotelen;\t \n\tchar\t\t\txpt_remotebuf[INET6_ADDRSTRLEN + 10];\n\tstruct list_head\txpt_users;\t \n\n\tstruct net\t\t*xpt_net;\n\tnetns_tracker\t\tns_tracker;\n\tconst struct cred\t*xpt_cred;\n\tstruct rpc_xprt\t\t*xpt_bc_xprt;\t \n\tstruct rpc_xprt_switch\t*xpt_bc_xps;\t \n};\n\n \nenum {\n\tXPT_BUSY,\t\t \n\tXPT_CONN,\t\t \n\tXPT_CLOSE,\t\t \n\tXPT_DATA,\t\t \n\tXPT_TEMP,\t\t \n\tXPT_DEAD,\t\t \n\tXPT_CHNGBUF,\t\t \n\tXPT_DEFERRED,\t\t \n\tXPT_OLD,\t\t \n\tXPT_LISTENER,\t\t \n\tXPT_CACHE_AUTH,\t\t \n\tXPT_LOCAL,\t\t \n\tXPT_KILL_TEMP,\t\t \n\tXPT_CONG_CTRL,\t\t \n\tXPT_HANDSHAKE,\t\t \n\tXPT_TLS_SESSION,\t \n\tXPT_PEER_AUTH,\t\t \n};\n\nstatic inline void unregister_xpt_user(struct svc_xprt *xpt, struct svc_xpt_user *u)\n{\n\tspin_lock(&xpt->xpt_lock);\n\tlist_del_init(&u->list);\n\tspin_unlock(&xpt->xpt_lock);\n}\n\nstatic inline int register_xpt_user(struct svc_xprt *xpt, struct svc_xpt_user *u)\n{\n\tspin_lock(&xpt->xpt_lock);\n\tif (test_bit(XPT_CLOSE, &xpt->xpt_flags)) {\n\t\t \n\t\tspin_unlock(&xpt->xpt_lock);\n\t\treturn -ENOTCONN;\n\t}\n\tlist_add(&u->list, &xpt->xpt_users);\n\tspin_unlock(&xpt->xpt_lock);\n\treturn 0;\n}\n\nstatic inline bool svc_xprt_is_dead(const struct svc_xprt *xprt)\n{\n\treturn (test_bit(XPT_DEAD, &xprt->xpt_flags) != 0) ||\n\t\t(test_bit(XPT_CLOSE, &xprt->xpt_flags) != 0);\n}\n\nint\tsvc_reg_xprt_class(struct svc_xprt_class *);\nvoid\tsvc_unreg_xprt_class(struct svc_xprt_class *);\nvoid\tsvc_xprt_init(struct net *, struct svc_xprt_class *, struct svc_xprt *,\n\t\t      struct svc_serv *);\nint\tsvc_xprt_create(struct svc_serv *serv, const char *xprt_name,\n\t\t\tstruct net *net, const int family,\n\t\t\tconst unsigned short port, int flags,\n\t\t\tconst struct cred *cred);\nvoid\tsvc_xprt_destroy_all(struct svc_serv *serv, struct net *net);\nvoid\tsvc_xprt_received(struct svc_xprt *xprt);\nvoid\tsvc_xprt_enqueue(struct svc_xprt *xprt);\nvoid\tsvc_xprt_put(struct svc_xprt *xprt);\nvoid\tsvc_xprt_copy_addrs(struct svc_rqst *rqstp, struct svc_xprt *xprt);\nvoid\tsvc_xprt_close(struct svc_xprt *xprt);\nint\tsvc_port_is_privileged(struct sockaddr *sin);\nint\tsvc_print_xprts(char *buf, int maxlen);\nstruct\tsvc_xprt *svc_find_xprt(struct svc_serv *serv, const char *xcl_name,\n\t\t\tstruct net *net, const sa_family_t af,\n\t\t\tconst unsigned short port);\nint\tsvc_xprt_names(struct svc_serv *serv, char *buf, const int buflen);\nvoid\tsvc_add_new_perm_xprt(struct svc_serv *serv, struct svc_xprt *xprt);\nvoid\tsvc_age_temp_xprts_now(struct svc_serv *, struct sockaddr *);\nvoid\tsvc_xprt_deferred_close(struct svc_xprt *xprt);\n\nstatic inline void svc_xprt_get(struct svc_xprt *xprt)\n{\n\tkref_get(&xprt->xpt_ref);\n}\nstatic inline void svc_xprt_set_local(struct svc_xprt *xprt,\n\t\t\t\t      const struct sockaddr *sa,\n\t\t\t\t      const size_t salen)\n{\n\tmemcpy(&xprt->xpt_local, sa, salen);\n\txprt->xpt_locallen = salen;\n}\nstatic inline void svc_xprt_set_remote(struct svc_xprt *xprt,\n\t\t\t\t       const struct sockaddr *sa,\n\t\t\t\t       const size_t salen)\n{\n\tmemcpy(&xprt->xpt_remote, sa, salen);\n\txprt->xpt_remotelen = salen;\n\tsnprintf(xprt->xpt_remotebuf, sizeof(xprt->xpt_remotebuf) - 1,\n\t\t \"%pISpc\", sa);\n}\n\nstatic inline unsigned short svc_addr_port(const struct sockaddr *sa)\n{\n\tconst struct sockaddr_in *sin = (const struct sockaddr_in *)sa;\n\tconst struct sockaddr_in6 *sin6 = (const struct sockaddr_in6 *)sa;\n\n\tswitch (sa->sa_family) {\n\tcase AF_INET:\n\t\treturn ntohs(sin->sin_port);\n\tcase AF_INET6:\n\t\treturn ntohs(sin6->sin6_port);\n\t}\n\n\treturn 0;\n}\n\nstatic inline size_t svc_addr_len(const struct sockaddr *sa)\n{\n\tswitch (sa->sa_family) {\n\tcase AF_INET:\n\t\treturn sizeof(struct sockaddr_in);\n\tcase AF_INET6:\n\t\treturn sizeof(struct sockaddr_in6);\n\t}\n\tBUG();\n}\n\nstatic inline unsigned short svc_xprt_local_port(const struct svc_xprt *xprt)\n{\n\treturn svc_addr_port((const struct sockaddr *)&xprt->xpt_local);\n}\n\nstatic inline unsigned short svc_xprt_remote_port(const struct svc_xprt *xprt)\n{\n\treturn svc_addr_port((const struct sockaddr *)&xprt->xpt_remote);\n}\n\nstatic inline char *__svc_print_addr(const struct sockaddr *addr,\n\t\t\t\t     char *buf, const size_t len)\n{\n\tconst struct sockaddr_in *sin = (const struct sockaddr_in *)addr;\n\tconst struct sockaddr_in6 *sin6 = (const struct sockaddr_in6 *)addr;\n\n\tswitch (addr->sa_family) {\n\tcase AF_INET:\n\t\tsnprintf(buf, len, \"%pI4, port=%u\", &sin->sin_addr,\n\t\t\tntohs(sin->sin_port));\n\t\tbreak;\n\n\tcase AF_INET6:\n\t\tsnprintf(buf, len, \"%pI6, port=%u\",\n\t\t\t &sin6->sin6_addr,\n\t\t\tntohs(sin6->sin6_port));\n\t\tbreak;\n\n\tdefault:\n\t\tsnprintf(buf, len, \"unknown address type: %d\", addr->sa_family);\n\t\tbreak;\n\t}\n\n\treturn buf;\n}\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}