{
  "module_name": "blk-integrity.h",
  "hash_id": "bd25d7bc7f83c12fbf6655b091e79a0a136a812428df8210a8c10a12b8da9c93",
  "original_prompt": "Ingested from linux-6.6.14/include/linux/blk-integrity.h",
  "human_readable_source": " \n#ifndef _LINUX_BLK_INTEGRITY_H\n#define _LINUX_BLK_INTEGRITY_H\n\n#include <linux/blk-mq.h>\n\nstruct request;\n\nenum blk_integrity_flags {\n\tBLK_INTEGRITY_VERIFY\t\t= 1 << 0,\n\tBLK_INTEGRITY_GENERATE\t\t= 1 << 1,\n\tBLK_INTEGRITY_DEVICE_CAPABLE\t= 1 << 2,\n\tBLK_INTEGRITY_IP_CHECKSUM\t= 1 << 3,\n};\n\nstruct blk_integrity_iter {\n\tvoid\t\t\t*prot_buf;\n\tvoid\t\t\t*data_buf;\n\tsector_t\t\tseed;\n\tunsigned int\t\tdata_size;\n\tunsigned short\t\tinterval;\n\tunsigned char\t\ttuple_size;\n\tconst char\t\t*disk_name;\n};\n\ntypedef blk_status_t (integrity_processing_fn) (struct blk_integrity_iter *);\ntypedef void (integrity_prepare_fn) (struct request *);\ntypedef void (integrity_complete_fn) (struct request *, unsigned int);\n\nstruct blk_integrity_profile {\n\tintegrity_processing_fn\t\t*generate_fn;\n\tintegrity_processing_fn\t\t*verify_fn;\n\tintegrity_prepare_fn\t\t*prepare_fn;\n\tintegrity_complete_fn\t\t*complete_fn;\n\tconst char\t\t\t*name;\n};\n\n#ifdef CONFIG_BLK_DEV_INTEGRITY\nvoid blk_integrity_register(struct gendisk *, struct blk_integrity *);\nvoid blk_integrity_unregister(struct gendisk *);\nint blk_integrity_compare(struct gendisk *, struct gendisk *);\nint blk_rq_map_integrity_sg(struct request_queue *, struct bio *,\n\t\t\t\t   struct scatterlist *);\nint blk_rq_count_integrity_sg(struct request_queue *, struct bio *);\n\nstatic inline struct blk_integrity *blk_get_integrity(struct gendisk *disk)\n{\n\tstruct blk_integrity *bi = &disk->queue->integrity;\n\n\tif (!bi->profile)\n\t\treturn NULL;\n\n\treturn bi;\n}\n\nstatic inline struct blk_integrity *\nbdev_get_integrity(struct block_device *bdev)\n{\n\treturn blk_get_integrity(bdev->bd_disk);\n}\n\nstatic inline bool\nblk_integrity_queue_supports_integrity(struct request_queue *q)\n{\n\treturn q->integrity.profile;\n}\n\nstatic inline void blk_queue_max_integrity_segments(struct request_queue *q,\n\t\t\t\t\t\t    unsigned int segs)\n{\n\tq->limits.max_integrity_segments = segs;\n}\n\nstatic inline unsigned short\nqueue_max_integrity_segments(const struct request_queue *q)\n{\n\treturn q->limits.max_integrity_segments;\n}\n\n \nstatic inline unsigned int bio_integrity_intervals(struct blk_integrity *bi,\n\t\t\t\t\t\t   unsigned int sectors)\n{\n\treturn sectors >> (bi->interval_exp - 9);\n}\n\nstatic inline unsigned int bio_integrity_bytes(struct blk_integrity *bi,\n\t\t\t\t\t       unsigned int sectors)\n{\n\treturn bio_integrity_intervals(bi, sectors) * bi->tuple_size;\n}\n\nstatic inline bool blk_integrity_rq(struct request *rq)\n{\n\treturn rq->cmd_flags & REQ_INTEGRITY;\n}\n\n \nstatic inline struct bio_vec *rq_integrity_vec(struct request *rq)\n{\n\tif (WARN_ON_ONCE(queue_max_integrity_segments(rq->q) > 1))\n\t\treturn NULL;\n\treturn rq->bio->bi_integrity->bip_vec;\n}\n#else  \nstatic inline int blk_rq_count_integrity_sg(struct request_queue *q,\n\t\t\t\t\t    struct bio *b)\n{\n\treturn 0;\n}\nstatic inline int blk_rq_map_integrity_sg(struct request_queue *q,\n\t\t\t\t\t  struct bio *b,\n\t\t\t\t\t  struct scatterlist *s)\n{\n\treturn 0;\n}\nstatic inline struct blk_integrity *bdev_get_integrity(struct block_device *b)\n{\n\treturn NULL;\n}\nstatic inline struct blk_integrity *blk_get_integrity(struct gendisk *disk)\n{\n\treturn NULL;\n}\nstatic inline bool\nblk_integrity_queue_supports_integrity(struct request_queue *q)\n{\n\treturn false;\n}\nstatic inline int blk_integrity_compare(struct gendisk *a, struct gendisk *b)\n{\n\treturn 0;\n}\nstatic inline void blk_integrity_register(struct gendisk *d,\n\t\t\t\t\t struct blk_integrity *b)\n{\n}\nstatic inline void blk_integrity_unregister(struct gendisk *d)\n{\n}\nstatic inline void blk_queue_max_integrity_segments(struct request_queue *q,\n\t\t\t\t\t\t    unsigned int segs)\n{\n}\nstatic inline unsigned short\nqueue_max_integrity_segments(const struct request_queue *q)\n{\n\treturn 0;\n}\n\nstatic inline unsigned int bio_integrity_intervals(struct blk_integrity *bi,\n\t\t\t\t\t\t   unsigned int sectors)\n{\n\treturn 0;\n}\n\nstatic inline unsigned int bio_integrity_bytes(struct blk_integrity *bi,\n\t\t\t\t\t       unsigned int sectors)\n{\n\treturn 0;\n}\nstatic inline int blk_integrity_rq(struct request *rq)\n{\n\treturn 0;\n}\n\nstatic inline struct bio_vec *rq_integrity_vec(struct request *rq)\n{\n\treturn NULL;\n}\n#endif  \n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}