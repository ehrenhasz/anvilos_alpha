{
  "module_name": "memstick.h",
  "hash_id": "3ca1965e778801253d1a0eee536f69f5b8e161344c207ba2c67c3c930a39a1f7",
  "original_prompt": "Ingested from linux-6.6.14/include/linux/memstick.h",
  "human_readable_source": " \n \n\n#ifndef _MEMSTICK_H\n#define _MEMSTICK_H\n\n#include <linux/workqueue.h>\n#include <linux/scatterlist.h>\n#include <linux/device.h>\n\n \n\nstruct ms_status_register {\n\tunsigned char reserved;\n\tunsigned char interrupt;\n#define MEMSTICK_INT_CMDNAK 0x01\n#define MEMSTICK_INT_IOREQ  0x08\n#define MEMSTICK_INT_IOBREQ 0x10\n#define MEMSTICK_INT_BREQ   0x20\n#define MEMSTICK_INT_ERR    0x40\n#define MEMSTICK_INT_CED    0x80\n\n\tunsigned char status0;\n#define MEMSTICK_STATUS0_WP  0x01\n#define MEMSTICK_STATUS0_SL  0x02\n#define MEMSTICK_STATUS0_BF  0x10\n#define MEMSTICK_STATUS0_BE  0x20\n#define MEMSTICK_STATUS0_FB0 0x40\n#define MEMSTICK_STATUS0_MB  0x80\n\n\tunsigned char status1;\n#define MEMSTICK_STATUS1_UCFG 0x01\n#define MEMSTICK_STATUS1_FGER 0x02\n#define MEMSTICK_STATUS1_UCEX 0x04\n#define MEMSTICK_STATUS1_EXER 0x08\n#define MEMSTICK_STATUS1_UCDT 0x10\n#define MEMSTICK_STATUS1_DTER 0x20\n#define MEMSTICK_STATUS1_FB1  0x40\n#define MEMSTICK_STATUS1_MB   0x80\n} __attribute__((packed));\n\nstruct ms_id_register {\n\tunsigned char type;\n\tunsigned char if_mode;\n\tunsigned char category;\n\tunsigned char class;\n} __attribute__((packed));\n\nstruct ms_param_register {\n\tunsigned char system;\n#define MEMSTICK_SYS_PAM  0x08\n#define MEMSTICK_SYS_BAMD 0x80\n\n\tunsigned char block_address_msb;\n\tunsigned short block_address;\n\tunsigned char cp;\n#define MEMSTICK_CP_BLOCK     0x00\n#define MEMSTICK_CP_PAGE      0x20\n#define MEMSTICK_CP_EXTRA     0x40\n#define MEMSTICK_CP_OVERWRITE 0x80\n\n\tunsigned char page_address;\n} __attribute__((packed));\n\nstruct ms_extra_data_register {\n\tunsigned char  overwrite_flag;\n#define MEMSTICK_OVERWRITE_UDST  0x10\n#define MEMSTICK_OVERWRITE_PGST1 0x20\n#define MEMSTICK_OVERWRITE_PGST0 0x40\n#define MEMSTICK_OVERWRITE_BKST  0x80\n\n\tunsigned char  management_flag;\n#define MEMSTICK_MANAGEMENT_SYSFLG 0x04\n#define MEMSTICK_MANAGEMENT_ATFLG  0x08\n#define MEMSTICK_MANAGEMENT_SCMS1  0x10\n#define MEMSTICK_MANAGEMENT_SCMS0  0x20\n\n\tunsigned short logical_address;\n} __attribute__((packed));\n\nstruct ms_register {\n\tstruct ms_status_register     status;\n\tstruct ms_id_register         id;\n\tunsigned char                 reserved[8];\n\tstruct ms_param_register      param;\n\tstruct ms_extra_data_register extra_data;\n} __attribute__((packed));\n\nstruct mspro_param_register {\n\tunsigned char  system;\n#define MEMSTICK_SYS_PAR4   0x00\n#define MEMSTICK_SYS_PAR8   0x40\n#define MEMSTICK_SYS_SERIAL 0x80\n\n\t__be16 data_count;\n\t__be32 data_address;\n\tunsigned char  tpc_param;\n} __attribute__((packed));\n\nstruct mspro_io_info_register {\n\tunsigned char version;\n\tunsigned char io_category;\n\tunsigned char current_req;\n\tunsigned char card_opt_info;\n\tunsigned char rdy_wait_time;\n} __attribute__((packed));\n\nstruct mspro_io_func_register {\n\tunsigned char func_enable;\n\tunsigned char func_select;\n\tunsigned char func_intmask;\n\tunsigned char transfer_mode;\n} __attribute__((packed));\n\nstruct mspro_io_cmd_register {\n\tunsigned short tpc_param;\n\tunsigned short data_count;\n\tunsigned int   data_address;\n} __attribute__((packed));\n\nstruct mspro_register {\n\tstruct ms_status_register     status;\n\tstruct ms_id_register         id;\n\tunsigned char                 reserved0[8];\n\tstruct mspro_param_register   param;\n\tunsigned char                 reserved1[8];\n\tstruct mspro_io_info_register io_info;\n\tstruct mspro_io_func_register io_func;\n\tunsigned char                 reserved2[7];\n\tstruct mspro_io_cmd_register  io_cmd;\n\tunsigned char                 io_int;\n\tunsigned char                 io_int_func;\n} __attribute__((packed));\n\nstruct ms_register_addr {\n\tunsigned char r_offset;\n\tunsigned char r_length;\n\tunsigned char w_offset;\n\tunsigned char w_length;\n} __attribute__((packed));\n\nenum memstick_tpc {\n\tMS_TPC_READ_MG_STATUS   = 0x01,\n\tMS_TPC_READ_LONG_DATA   = 0x02,\n\tMS_TPC_READ_SHORT_DATA  = 0x03,\n\tMS_TPC_READ_MG_DATA     = 0x03,\n\tMS_TPC_READ_REG         = 0x04,\n\tMS_TPC_READ_QUAD_DATA   = 0x05,\n\tMS_TPC_READ_IO_DATA     = 0x05,\n\tMS_TPC_GET_INT          = 0x07,\n\tMS_TPC_SET_RW_REG_ADRS  = 0x08,\n\tMS_TPC_EX_SET_CMD       = 0x09,\n\tMS_TPC_WRITE_QUAD_DATA  = 0x0a,\n\tMS_TPC_WRITE_IO_DATA    = 0x0a,\n\tMS_TPC_WRITE_REG        = 0x0b,\n\tMS_TPC_WRITE_SHORT_DATA = 0x0c,\n\tMS_TPC_WRITE_MG_DATA    = 0x0c,\n\tMS_TPC_WRITE_LONG_DATA  = 0x0d,\n\tMS_TPC_SET_CMD          = 0x0e\n};\n\nenum memstick_command {\n\tMS_CMD_BLOCK_END       = 0x33,\n\tMS_CMD_RESET           = 0x3c,\n\tMS_CMD_BLOCK_WRITE     = 0x55,\n\tMS_CMD_SLEEP           = 0x5a,\n\tMS_CMD_BLOCK_ERASE     = 0x99,\n\tMS_CMD_BLOCK_READ      = 0xaa,\n\tMS_CMD_CLEAR_BUF       = 0xc3,\n\tMS_CMD_FLASH_STOP      = 0xcc,\n\tMS_CMD_LOAD_ID         = 0x60,\n\tMS_CMD_CMP_ICV         = 0x7f,\n\tMSPRO_CMD_FORMAT       = 0x10,\n\tMSPRO_CMD_SLEEP        = 0x11,\n\tMSPRO_CMD_WAKEUP       = 0x12,\n\tMSPRO_CMD_READ_DATA    = 0x20,\n\tMSPRO_CMD_WRITE_DATA   = 0x21,\n\tMSPRO_CMD_READ_ATRB    = 0x24,\n\tMSPRO_CMD_STOP         = 0x25,\n\tMSPRO_CMD_ERASE        = 0x26,\n\tMSPRO_CMD_READ_QUAD    = 0x27,\n\tMSPRO_CMD_WRITE_QUAD   = 0x28,\n\tMSPRO_CMD_SET_IBD      = 0x46,\n\tMSPRO_CMD_GET_IBD      = 0x47,\n\tMSPRO_CMD_IN_IO_DATA   = 0xb0,\n\tMSPRO_CMD_OUT_IO_DATA  = 0xb1,\n\tMSPRO_CMD_READ_IO_ATRB = 0xb2,\n\tMSPRO_CMD_IN_IO_FIFO   = 0xb3,\n\tMSPRO_CMD_OUT_IO_FIFO  = 0xb4,\n\tMSPRO_CMD_IN_IOM       = 0xb5,\n\tMSPRO_CMD_OUT_IOM      = 0xb6,\n};\n\n \n\nenum memstick_param { MEMSTICK_POWER = 1, MEMSTICK_INTERFACE };\n\n#define MEMSTICK_POWER_OFF 0\n#define MEMSTICK_POWER_ON  1\n\n#define MEMSTICK_SERIAL   0\n#define MEMSTICK_PAR4     1\n#define MEMSTICK_PAR8     2\n\nstruct memstick_host;\nstruct memstick_driver;\n\nstruct memstick_device_id {\n\tunsigned char match_flags;\n#define MEMSTICK_MATCH_ALL            0x01\n\n\tunsigned char type;\n#define MEMSTICK_TYPE_LEGACY          0xff\n#define MEMSTICK_TYPE_DUO             0x00\n#define MEMSTICK_TYPE_PRO             0x01\n\n\tunsigned char category;\n#define MEMSTICK_CATEGORY_STORAGE     0xff\n#define MEMSTICK_CATEGORY_STORAGE_DUO 0x00\n#define MEMSTICK_CATEGORY_IO          0x01\n#define MEMSTICK_CATEGORY_IO_PRO      0x10\n\n\tunsigned char class;\n#define MEMSTICK_CLASS_FLASH          0xff\n#define MEMSTICK_CLASS_DUO            0x00\n#define MEMSTICK_CLASS_ROM            0x01\n#define MEMSTICK_CLASS_RO             0x02\n#define MEMSTICK_CLASS_WP             0x03\n};\n\nstruct memstick_request {\n\tunsigned char tpc;\n\tunsigned char data_dir:1,\n\t\t      need_card_int:1,\n\t\t      long_data:1;\n\tunsigned char int_reg;\n\tint           error;\n\tunion {\n\t\tstruct scatterlist sg;\n\t\tstruct {\n\t\t\tunsigned char data_len;\n\t\t\tunsigned char data[15];\n\t\t};\n\t};\n};\n\nstruct memstick_dev {\n\tstruct memstick_device_id id;\n\tstruct memstick_host     *host;\n\tstruct ms_register_addr  reg_addr;\n\tstruct completion        mrq_complete;\n\tstruct memstick_request  current_mrq;\n\n\t \n\tint                      (*check)(struct memstick_dev *card);\n\t \n\tint                      (*next_request)(struct memstick_dev *card,\n\t\t\t\t\t\t struct memstick_request **mrq);\n\t \n\tvoid                     (*stop)(struct memstick_dev *card);\n\t \n\tvoid                     (*start)(struct memstick_dev *card);\n\n\tstruct device            dev;\n};\n\nstruct memstick_host {\n\tstruct mutex        lock;\n\tunsigned int        id;\n\tunsigned int        caps;\n#define MEMSTICK_CAP_AUTO_GET_INT  1\n#define MEMSTICK_CAP_PAR4          2\n#define MEMSTICK_CAP_PAR8          4\n\n\tstruct work_struct  media_checker;\n\tstruct device       dev;\n\n\tstruct memstick_dev *card;\n\tunsigned int        retries;\n\tbool removing;\n\n\t \n\tvoid                (*request)(struct memstick_host *host);\n\t \n\tint                 (*set_param)(struct memstick_host *host,\n\t\t\t\t\t enum memstick_param param,\n\t\t\t\t\t int value);\n\tunsigned long       private[] ____cacheline_aligned;\n};\n\nstruct memstick_driver {\n\tstruct memstick_device_id *id_table;\n\tint                       (*probe)(struct memstick_dev *card);\n\tvoid                      (*remove)(struct memstick_dev *card);\n\tint                       (*suspend)(struct memstick_dev *card,\n\t\t\t\t\t     pm_message_t state);\n\tint                       (*resume)(struct memstick_dev *card);\n\n\tstruct device_driver      driver;\n};\n\nint memstick_register_driver(struct memstick_driver *drv);\nvoid memstick_unregister_driver(struct memstick_driver *drv);\n\nstruct memstick_host *memstick_alloc_host(unsigned int extra,\n\t\t\t\t\t  struct device *dev);\n\nint memstick_add_host(struct memstick_host *host);\nvoid memstick_remove_host(struct memstick_host *host);\nvoid memstick_free_host(struct memstick_host *host);\nvoid memstick_detect_change(struct memstick_host *host);\nvoid memstick_suspend_host(struct memstick_host *host);\nvoid memstick_resume_host(struct memstick_host *host);\n\nvoid memstick_init_req_sg(struct memstick_request *mrq, unsigned char tpc,\n\t\t\t  const struct scatterlist *sg);\nvoid memstick_init_req(struct memstick_request *mrq, unsigned char tpc,\n\t\t       const void *buf, size_t length);\nint memstick_next_req(struct memstick_host *host,\n\t\t      struct memstick_request **mrq);\nvoid memstick_new_req(struct memstick_host *host);\n\nint memstick_set_rw_addr(struct memstick_dev *card);\n\nstatic inline void *memstick_priv(struct memstick_host *host)\n{\n\treturn (void *)host->private;\n}\n\nstatic inline void *memstick_get_drvdata(struct memstick_dev *card)\n{\n\treturn dev_get_drvdata(&card->dev);\n}\n\nstatic inline void memstick_set_drvdata(struct memstick_dev *card, void *data)\n{\n\tdev_set_drvdata(&card->dev, data);\n}\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}