{
  "module_name": "io-pgtable.h",
  "hash_id": "391b035b110c66ea606002ddc35695e655058707cc4ad02b106c1b5e41eac543",
  "original_prompt": "Ingested from linux-6.6.14/include/linux/io-pgtable.h",
  "human_readable_source": " \n#ifndef __IO_PGTABLE_H\n#define __IO_PGTABLE_H\n\n#include <linux/bitops.h>\n#include <linux/iommu.h>\n\n \nenum io_pgtable_fmt {\n\tARM_32_LPAE_S1,\n\tARM_32_LPAE_S2,\n\tARM_64_LPAE_S1,\n\tARM_64_LPAE_S2,\n\tARM_V7S,\n\tARM_MALI_LPAE,\n\tAMD_IOMMU_V1,\n\tAMD_IOMMU_V2,\n\tAPPLE_DART,\n\tAPPLE_DART2,\n\tIO_PGTABLE_NUM_FMTS,\n};\n\n \nstruct iommu_flush_ops {\n\tvoid (*tlb_flush_all)(void *cookie);\n\tvoid (*tlb_flush_walk)(unsigned long iova, size_t size, size_t granule,\n\t\t\t       void *cookie);\n\tvoid (*tlb_add_page)(struct iommu_iotlb_gather *gather,\n\t\t\t     unsigned long iova, size_t granule, void *cookie);\n};\n\n \nstruct io_pgtable_cfg {\n\t \n\t#define IO_PGTABLE_QUIRK_ARM_NS\t\t\tBIT(0)\n\t#define IO_PGTABLE_QUIRK_NO_PERMS\t\tBIT(1)\n\t#define IO_PGTABLE_QUIRK_ARM_MTK_EXT\t\tBIT(3)\n\t#define IO_PGTABLE_QUIRK_ARM_MTK_TTBR_EXT\tBIT(4)\n\t#define IO_PGTABLE_QUIRK_ARM_TTBR1\t\tBIT(5)\n\t#define IO_PGTABLE_QUIRK_ARM_OUTER_WBWA\t\tBIT(6)\n\tunsigned long\t\t\tquirks;\n\tunsigned long\t\t\tpgsize_bitmap;\n\tunsigned int\t\t\tias;\n\tunsigned int\t\t\toas;\n\tbool\t\t\t\tcoherent_walk;\n\tconst struct iommu_flush_ops\t*tlb;\n\tstruct device\t\t\t*iommu_dev;\n\n\t \n\tunion {\n\t\tstruct {\n\t\t\tu64\tttbr;\n\t\t\tstruct {\n\t\t\t\tu32\tips:3;\n\t\t\t\tu32\ttg:2;\n\t\t\t\tu32\tsh:2;\n\t\t\t\tu32\torgn:2;\n\t\t\t\tu32\tirgn:2;\n\t\t\t\tu32\ttsz:6;\n\t\t\t}\ttcr;\n\t\t\tu64\tmair;\n\t\t} arm_lpae_s1_cfg;\n\n\t\tstruct {\n\t\t\tu64\tvttbr;\n\t\t\tstruct {\n\t\t\t\tu32\tps:3;\n\t\t\t\tu32\ttg:2;\n\t\t\t\tu32\tsh:2;\n\t\t\t\tu32\torgn:2;\n\t\t\t\tu32\tirgn:2;\n\t\t\t\tu32\tsl:2;\n\t\t\t\tu32\ttsz:6;\n\t\t\t}\tvtcr;\n\t\t} arm_lpae_s2_cfg;\n\n\t\tstruct {\n\t\t\tu32\tttbr;\n\t\t\tu32\ttcr;\n\t\t\tu32\tnmrr;\n\t\t\tu32\tprrr;\n\t\t} arm_v7s_cfg;\n\n\t\tstruct {\n\t\t\tu64\ttranstab;\n\t\t\tu64\tmemattr;\n\t\t} arm_mali_lpae_cfg;\n\n\t\tstruct {\n\t\t\tu64 ttbr[4];\n\t\t\tu32 n_ttbrs;\n\t\t} apple_dart_cfg;\n\t};\n};\n\n \nstruct io_pgtable_ops {\n\tint (*map_pages)(struct io_pgtable_ops *ops, unsigned long iova,\n\t\t\t phys_addr_t paddr, size_t pgsize, size_t pgcount,\n\t\t\t int prot, gfp_t gfp, size_t *mapped);\n\tsize_t (*unmap_pages)(struct io_pgtable_ops *ops, unsigned long iova,\n\t\t\t      size_t pgsize, size_t pgcount,\n\t\t\t      struct iommu_iotlb_gather *gather);\n\tphys_addr_t (*iova_to_phys)(struct io_pgtable_ops *ops,\n\t\t\t\t    unsigned long iova);\n};\n\n \nstruct io_pgtable_ops *alloc_io_pgtable_ops(enum io_pgtable_fmt fmt,\n\t\t\t\t\t    struct io_pgtable_cfg *cfg,\n\t\t\t\t\t    void *cookie);\n\n \nvoid free_io_pgtable_ops(struct io_pgtable_ops *ops);\n\n\n \n\n \nstruct io_pgtable {\n\tenum io_pgtable_fmt\tfmt;\n\tvoid\t\t\t*cookie;\n\tstruct io_pgtable_cfg\tcfg;\n\tstruct io_pgtable_ops\tops;\n};\n\n#define io_pgtable_ops_to_pgtable(x) container_of((x), struct io_pgtable, ops)\n\nstatic inline void io_pgtable_tlb_flush_all(struct io_pgtable *iop)\n{\n\tif (iop->cfg.tlb && iop->cfg.tlb->tlb_flush_all)\n\t\tiop->cfg.tlb->tlb_flush_all(iop->cookie);\n}\n\nstatic inline void\nio_pgtable_tlb_flush_walk(struct io_pgtable *iop, unsigned long iova,\n\t\t\t  size_t size, size_t granule)\n{\n\tif (iop->cfg.tlb && iop->cfg.tlb->tlb_flush_walk)\n\t\tiop->cfg.tlb->tlb_flush_walk(iova, size, granule, iop->cookie);\n}\n\nstatic inline void\nio_pgtable_tlb_add_page(struct io_pgtable *iop,\n\t\t\tstruct iommu_iotlb_gather * gather, unsigned long iova,\n\t\t\tsize_t granule)\n{\n\tif (iop->cfg.tlb && iop->cfg.tlb->tlb_add_page)\n\t\tiop->cfg.tlb->tlb_add_page(gather, iova, granule, iop->cookie);\n}\n\n \nstruct io_pgtable_init_fns {\n\tstruct io_pgtable *(*alloc)(struct io_pgtable_cfg *cfg, void *cookie);\n\tvoid (*free)(struct io_pgtable *iop);\n};\n\nextern struct io_pgtable_init_fns io_pgtable_arm_32_lpae_s1_init_fns;\nextern struct io_pgtable_init_fns io_pgtable_arm_32_lpae_s2_init_fns;\nextern struct io_pgtable_init_fns io_pgtable_arm_64_lpae_s1_init_fns;\nextern struct io_pgtable_init_fns io_pgtable_arm_64_lpae_s2_init_fns;\nextern struct io_pgtable_init_fns io_pgtable_arm_v7s_init_fns;\nextern struct io_pgtable_init_fns io_pgtable_arm_mali_lpae_init_fns;\nextern struct io_pgtable_init_fns io_pgtable_amd_iommu_v1_init_fns;\nextern struct io_pgtable_init_fns io_pgtable_amd_iommu_v2_init_fns;\nextern struct io_pgtable_init_fns io_pgtable_apple_dart_init_fns;\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}