{
  "module_name": "v4l2-device.h",
  "hash_id": "44384d3335e1be38340f1b0dae9ea75d6f1aa1b99d1379ca7b1411317264754e",
  "original_prompt": "Ingested from linux-6.6.14/include/media/v4l2-device.h",
  "human_readable_source": " \n \n\n#ifndef _V4L2_DEVICE_H\n#define _V4L2_DEVICE_H\n\n#include <media/media-device.h>\n#include <media/v4l2-subdev.h>\n#include <media/v4l2-dev.h>\n\n#define V4L2_DEVICE_NAME_SIZE (20 + 16)\n\nstruct v4l2_ctrl_handler;\n\n \nstruct v4l2_device {\n\tstruct device *dev;\n\tstruct media_device *mdev;\n\tstruct list_head subdevs;\n\tspinlock_t lock;\n\tchar name[V4L2_DEVICE_NAME_SIZE];\n\tvoid (*notify)(struct v4l2_subdev *sd,\n\t\t\tunsigned int notification, void *arg);\n\tstruct v4l2_ctrl_handler *ctrl_handler;\n\tstruct v4l2_prio_state prio;\n\tstruct kref ref;\n\tvoid (*release)(struct v4l2_device *v4l2_dev);\n};\n\n \nstatic inline void v4l2_device_get(struct v4l2_device *v4l2_dev)\n{\n\tkref_get(&v4l2_dev->ref);\n}\n\n \nint v4l2_device_put(struct v4l2_device *v4l2_dev);\n\n \nint __must_check v4l2_device_register(struct device *dev,\n\t\t\t\t      struct v4l2_device *v4l2_dev);\n\n \nint v4l2_device_set_name(struct v4l2_device *v4l2_dev, const char *basename,\n\t\t\t atomic_t *instance);\n\n \nvoid v4l2_device_disconnect(struct v4l2_device *v4l2_dev);\n\n \nvoid v4l2_device_unregister(struct v4l2_device *v4l2_dev);\n\n \nint __must_check v4l2_device_register_subdev(struct v4l2_device *v4l2_dev,\n\t\t\t\t\t     struct v4l2_subdev *sd);\n\n \nvoid v4l2_device_unregister_subdev(struct v4l2_subdev *sd);\n\n \nint __must_check\n__v4l2_device_register_subdev_nodes(struct v4l2_device *v4l2_dev,\n\t\t\t\t    bool read_only);\n\n \nstatic inline int __must_check\nv4l2_device_register_subdev_nodes(struct v4l2_device *v4l2_dev)\n{\n#if defined(CONFIG_VIDEO_V4L2_SUBDEV_API)\n\treturn __v4l2_device_register_subdev_nodes(v4l2_dev, false);\n#else\n\treturn 0;\n#endif\n}\n\n \nstatic inline int __must_check\nv4l2_device_register_ro_subdev_nodes(struct v4l2_device *v4l2_dev)\n{\n#if defined(CONFIG_VIDEO_V4L2_SUBDEV_API)\n\treturn __v4l2_device_register_subdev_nodes(v4l2_dev, true);\n#else\n\treturn 0;\n#endif\n}\n\n \nstatic inline void v4l2_subdev_notify(struct v4l2_subdev *sd,\n\t\t\t\t      unsigned int notification, void *arg)\n{\n\tif (sd && sd->v4l2_dev && sd->v4l2_dev->notify)\n\t\tsd->v4l2_dev->notify(sd, notification, arg);\n}\n\n \nstatic inline bool v4l2_device_supports_requests(struct v4l2_device *v4l2_dev)\n{\n\treturn v4l2_dev->mdev && v4l2_dev->mdev->ops &&\n\t       v4l2_dev->mdev->ops->req_queue;\n}\n\n \n\n \n#define v4l2_device_for_each_subdev(sd, v4l2_dev)\t\t\t\\\n\tlist_for_each_entry(sd, &(v4l2_dev)->subdevs, list)\n\n \n#define __v4l2_device_call_subdevs_p(v4l2_dev, sd, cond, o, f, args...)\t\\\n\tdo {\t\t\t\t\t\t\t\t\\\n\t\tlist_for_each_entry((sd), &(v4l2_dev)->subdevs, list)\t\\\n\t\t\tif ((cond) && (sd)->ops->o && (sd)->ops->o->f)\t\\\n\t\t\t\t(sd)->ops->o->f((sd) , ##args);\t\t\\\n\t} while (0)\n\n \n#define __v4l2_device_call_subdevs(v4l2_dev, cond, o, f, args...)\t\\\n\tdo {\t\t\t\t\t\t\t\t\\\n\t\tstruct v4l2_subdev *__sd;\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\t\t__v4l2_device_call_subdevs_p(v4l2_dev, __sd, cond, o,\t\\\n\t\t\t\t\t\tf , ##args);\t\t\\\n\t} while (0)\n\n \n#define __v4l2_device_call_subdevs_until_err_p(v4l2_dev, sd, cond, o, f, args...) \\\n({\t\t\t\t\t\t\t\t\t\\\n\tlong __err = 0;\t\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\tlist_for_each_entry((sd), &(v4l2_dev)->subdevs, list) {\t\t\\\n\t\tif ((cond) && (sd)->ops->o && (sd)->ops->o->f)\t\t\\\n\t\t\t__err = (sd)->ops->o->f((sd) , ##args);\t\t\\\n\t\tif (__err && __err != -ENOIOCTLCMD)\t\t\t\\\n\t\t\tbreak;\t\t\t\t\t\t\\\n\t}\t\t\t\t\t\t\t\t\\\n\t(__err == -ENOIOCTLCMD) ? 0 : __err;\t\t\t\t\\\n})\n\n \n#define __v4l2_device_call_subdevs_until_err(v4l2_dev, cond, o, f, args...) \\\n({\t\t\t\t\t\t\t\t\t\\\n\tstruct v4l2_subdev *__sd;\t\t\t\t\t\\\n\t__v4l2_device_call_subdevs_until_err_p(v4l2_dev, __sd, cond, o,\t\\\n\t\t\t\t\t\tf , ##args);\t\t\\\n})\n\n \n#define v4l2_device_call_all(v4l2_dev, grpid, o, f, args...)\t\t\\\n\tdo {\t\t\t\t\t\t\t\t\\\n\t\tstruct v4l2_subdev *__sd;\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\t\t__v4l2_device_call_subdevs_p(v4l2_dev, __sd,\t\t\\\n\t\t\t(grpid) == 0 || __sd->grp_id == (grpid), o, f ,\t\\\n\t\t\t##args);\t\t\t\t\t\\\n\t} while (0)\n\n \n#define v4l2_device_call_until_err(v4l2_dev, grpid, o, f, args...)\t\\\n({\t\t\t\t\t\t\t\t\t\\\n\tstruct v4l2_subdev *__sd;\t\t\t\t\t\\\n\t__v4l2_device_call_subdevs_until_err_p(v4l2_dev, __sd,\t\t\\\n\t\t\t(grpid) == 0 || __sd->grp_id == (grpid), o, f ,\t\\\n\t\t\t##args);\t\t\t\t\t\\\n})\n\n \n#define v4l2_device_mask_call_all(v4l2_dev, grpmsk, o, f, args...)\t\\\n\tdo {\t\t\t\t\t\t\t\t\\\n\t\tstruct v4l2_subdev *__sd;\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\t\t__v4l2_device_call_subdevs_p(v4l2_dev, __sd,\t\t\\\n\t\t\t(grpmsk) == 0 || (__sd->grp_id & (grpmsk)), o,\t\\\n\t\t\tf , ##args);\t\t\t\t\t\\\n\t} while (0)\n\n \n#define v4l2_device_mask_call_until_err(v4l2_dev, grpmsk, o, f, args...) \\\n({\t\t\t\t\t\t\t\t\t\\\n\tstruct v4l2_subdev *__sd;\t\t\t\t\t\\\n\t__v4l2_device_call_subdevs_until_err_p(v4l2_dev, __sd,\t\t\\\n\t\t\t(grpmsk) == 0 || (__sd->grp_id & (grpmsk)), o,\t\\\n\t\t\tf , ##args);\t\t\t\t\t\\\n})\n\n\n \n#define v4l2_device_has_op(v4l2_dev, grpid, o, f)\t\t\t\\\n({\t\t\t\t\t\t\t\t\t\\\n\tstruct v4l2_subdev *__sd;\t\t\t\t\t\\\n\tbool __result = false;\t\t\t\t\t\t\\\n\tlist_for_each_entry(__sd, &(v4l2_dev)->subdevs, list) {\t\t\\\n\t\tif ((grpid) && __sd->grp_id != (grpid))\t\t\t\\\n\t\t\tcontinue;\t\t\t\t\t\\\n\t\tif (v4l2_subdev_has_op(__sd, o, f)) {\t\t\t\\\n\t\t\t__result = true;\t\t\t\t\\\n\t\t\tbreak;\t\t\t\t\t\t\\\n\t\t}\t\t\t\t\t\t\t\\\n\t}\t\t\t\t\t\t\t\t\\\n\t__result;\t\t\t\t\t\t\t\\\n})\n\n \n#define v4l2_device_mask_has_op(v4l2_dev, grpmsk, o, f)\t\t\t\\\n({\t\t\t\t\t\t\t\t\t\\\n\tstruct v4l2_subdev *__sd;\t\t\t\t\t\\\n\tbool __result = false;\t\t\t\t\t\t\\\n\tlist_for_each_entry(__sd, &(v4l2_dev)->subdevs, list) {\t\t\\\n\t\tif ((grpmsk) && !(__sd->grp_id & (grpmsk)))\t\t\\\n\t\t\tcontinue;\t\t\t\t\t\\\n\t\tif (v4l2_subdev_has_op(__sd, o, f)) {\t\t\t\\\n\t\t\t__result = true;\t\t\t\t\\\n\t\t\tbreak;\t\t\t\t\t\t\\\n\t\t}\t\t\t\t\t\t\t\\\n\t}\t\t\t\t\t\t\t\t\\\n\t__result;\t\t\t\t\t\t\t\\\n})\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}