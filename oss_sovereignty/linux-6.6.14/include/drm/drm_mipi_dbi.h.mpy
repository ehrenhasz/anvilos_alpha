{
  "module_name": "drm_mipi_dbi.h",
  "hash_id": "7ea486aea08b3ad8f83fa7a3b95c3074c57671496a82d8a57cec1c02739e3523",
  "original_prompt": "Ingested from linux-6.6.14/include/drm/drm_mipi_dbi.h",
  "human_readable_source": " \n \n\n#ifndef __LINUX_MIPI_DBI_H\n#define __LINUX_MIPI_DBI_H\n\n#include <linux/mutex.h>\n#include <drm/drm_device.h>\n#include <drm/drm_simple_kms_helper.h>\n\nstruct drm_rect;\nstruct gpio_desc;\nstruct iosys_map;\nstruct regulator;\nstruct spi_device;\n\n \nstruct mipi_dbi {\n\t \n\tstruct mutex cmdlock;\n\n\t \n\tint (*command)(struct mipi_dbi *dbi, u8 *cmd, u8 *param, size_t num);\n\n\t \n\tconst u8 *read_commands;\n\n\t \n\tbool swap_bytes;\n\n\t \n\tstruct gpio_desc *reset;\n\n\t \n\n\t \n\tstruct spi_device *spi;\n\n\t \n\tstruct gpio_desc *dc;\n\n\t \n\tvoid *tx_buf9;\n\n\t \n\tsize_t tx_buf9_len;\n};\n\n \nstruct mipi_dbi_dev {\n\t \n\tstruct drm_device drm;\n\n\t \n\tstruct drm_simple_display_pipe pipe;\n\n\t \n\tstruct drm_connector connector;\n\n\t \n\tstruct drm_display_mode mode;\n\n\t \n\tu16 *tx_buf;\n\n\t \n\tunsigned int rotation;\n\n\t \n\tunsigned int left_offset;\n\n\t \n\tunsigned int top_offset;\n\n\t \n\tstruct backlight_device *backlight;\n\n\t \n\tstruct regulator *regulator;\n\n\t \n\tstruct regulator *io_regulator;\n\n\t \n\tstruct mipi_dbi dbi;\n\n\t \n\tvoid *driver_private;\n};\n\nstatic inline struct mipi_dbi_dev *drm_to_mipi_dbi_dev(struct drm_device *drm)\n{\n\treturn container_of(drm, struct mipi_dbi_dev, drm);\n}\n\nint mipi_dbi_spi_init(struct spi_device *spi, struct mipi_dbi *dbi,\n\t\t      struct gpio_desc *dc);\nint mipi_dbi_dev_init_with_formats(struct mipi_dbi_dev *dbidev,\n\t\t\t\t   const struct drm_simple_display_pipe_funcs *funcs,\n\t\t\t\t   const uint32_t *formats, unsigned int format_count,\n\t\t\t\t   const struct drm_display_mode *mode,\n\t\t\t\t   unsigned int rotation, size_t tx_buf_size);\nint mipi_dbi_dev_init(struct mipi_dbi_dev *dbidev,\n\t\t      const struct drm_simple_display_pipe_funcs *funcs,\n\t\t      const struct drm_display_mode *mode, unsigned int rotation);\nenum drm_mode_status mipi_dbi_pipe_mode_valid(struct drm_simple_display_pipe *pipe,\n\t\t\t\t\t      const struct drm_display_mode *mode);\nvoid mipi_dbi_pipe_update(struct drm_simple_display_pipe *pipe,\n\t\t\t  struct drm_plane_state *old_state);\nvoid mipi_dbi_enable_flush(struct mipi_dbi_dev *dbidev,\n\t\t\t   struct drm_crtc_state *crtc_state,\n\t\t\t   struct drm_plane_state *plan_state);\nvoid mipi_dbi_pipe_disable(struct drm_simple_display_pipe *pipe);\nint mipi_dbi_pipe_begin_fb_access(struct drm_simple_display_pipe *pipe,\n\t\t\t\t  struct drm_plane_state *plane_state);\nvoid mipi_dbi_pipe_end_fb_access(struct drm_simple_display_pipe *pipe,\n\t\t\t\t struct drm_plane_state *plane_state);\nvoid mipi_dbi_pipe_reset_plane(struct drm_simple_display_pipe *pipe);\nstruct drm_plane_state *mipi_dbi_pipe_duplicate_plane_state(struct drm_simple_display_pipe *pipe);\nvoid mipi_dbi_pipe_destroy_plane_state(struct drm_simple_display_pipe *pipe,\n\t\t\t\t       struct drm_plane_state *plane_state);\n\nvoid mipi_dbi_hw_reset(struct mipi_dbi *dbi);\nbool mipi_dbi_display_is_on(struct mipi_dbi *dbi);\nint mipi_dbi_poweron_reset(struct mipi_dbi_dev *dbidev);\nint mipi_dbi_poweron_conditional_reset(struct mipi_dbi_dev *dbidev);\n\nu32 mipi_dbi_spi_cmd_max_speed(struct spi_device *spi, size_t len);\nint mipi_dbi_spi_transfer(struct spi_device *spi, u32 speed_hz,\n\t\t\t  u8 bpw, const void *buf, size_t len);\n\nint mipi_dbi_command_read(struct mipi_dbi *dbi, u8 cmd, u8 *val);\nint mipi_dbi_command_buf(struct mipi_dbi *dbi, u8 cmd, u8 *data, size_t len);\nint mipi_dbi_command_stackbuf(struct mipi_dbi *dbi, u8 cmd, const u8 *data,\n\t\t\t      size_t len);\nint mipi_dbi_buf_copy(void *dst, struct iosys_map *src, struct drm_framebuffer *fb,\n\t\t      struct drm_rect *clip, bool swap);\n\n \n#define mipi_dbi_command(dbi, cmd, seq...) \\\n({ \\\n\tconst u8 d[] = { seq }; \\\n\tstruct device *dev = &(dbi)->spi->dev;\t\\\n\tint ret; \\\n\tret = mipi_dbi_command_stackbuf(dbi, cmd, d, ARRAY_SIZE(d)); \\\n\tif (ret) \\\n\t\tdev_err_ratelimited(dev, \"error %d when sending command %#02x\\n\", ret, cmd); \\\n\tret; \\\n})\n\n#ifdef CONFIG_DEBUG_FS\nvoid mipi_dbi_debugfs_init(struct drm_minor *minor);\n#else\nstatic inline void mipi_dbi_debugfs_init(struct drm_minor *minor) {}\n#endif\n\n \n#define DRM_MIPI_DBI_SIMPLE_DISPLAY_PIPE_FUNCS(enable_) \\\n\t.mode_valid = mipi_dbi_pipe_mode_valid, \\\n\t.enable = (enable_), \\\n\t.disable = mipi_dbi_pipe_disable, \\\n\t.update = mipi_dbi_pipe_update, \\\n\t.begin_fb_access = mipi_dbi_pipe_begin_fb_access, \\\n\t.end_fb_access = mipi_dbi_pipe_end_fb_access, \\\n\t.reset_plane = mipi_dbi_pipe_reset_plane, \\\n\t.duplicate_plane_state = mipi_dbi_pipe_duplicate_plane_state, \\\n\t.destroy_plane_state = mipi_dbi_pipe_destroy_plane_state\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}