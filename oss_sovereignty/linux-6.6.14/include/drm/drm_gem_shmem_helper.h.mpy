{
  "module_name": "drm_gem_shmem_helper.h",
  "hash_id": "15e363cb2f0ad687c73eb0081bb78eb98b82350848d4ef795754d1ff0b4b52fc",
  "original_prompt": "Ingested from linux-6.6.14/include/drm/drm_gem_shmem_helper.h",
  "human_readable_source": " \n\n#ifndef __DRM_GEM_SHMEM_HELPER_H__\n#define __DRM_GEM_SHMEM_HELPER_H__\n\n#include <linux/fs.h>\n#include <linux/mm.h>\n#include <linux/mutex.h>\n\n#include <drm/drm_file.h>\n#include <drm/drm_gem.h>\n#include <drm/drm_ioctl.h>\n#include <drm/drm_prime.h>\n\nstruct dma_buf_attachment;\nstruct drm_mode_create_dumb;\nstruct drm_printer;\nstruct sg_table;\n\n \nstruct drm_gem_shmem_object {\n\t \n\tstruct drm_gem_object base;\n\n\t \n\tstruct page **pages;\n\n\t \n\tunsigned int pages_use_count;\n\n\t \n\tint madv;\n\n\t \n\tstruct list_head madv_list;\n\n\t \n\tstruct sg_table *sgt;\n\n\t \n\tvoid *vaddr;\n\n\t \n\tunsigned int vmap_use_count;\n\n\t \n\tbool pages_mark_dirty_on_put : 1;\n\n\t \n\tbool pages_mark_accessed_on_put : 1;\n\n\t \n\tbool map_wc : 1;\n};\n\n#define to_drm_gem_shmem_obj(obj) \\\n\tcontainer_of(obj, struct drm_gem_shmem_object, base)\n\nstruct drm_gem_shmem_object *drm_gem_shmem_create(struct drm_device *dev, size_t size);\nvoid drm_gem_shmem_free(struct drm_gem_shmem_object *shmem);\n\nvoid drm_gem_shmem_put_pages(struct drm_gem_shmem_object *shmem);\nint drm_gem_shmem_pin(struct drm_gem_shmem_object *shmem);\nvoid drm_gem_shmem_unpin(struct drm_gem_shmem_object *shmem);\nint drm_gem_shmem_vmap(struct drm_gem_shmem_object *shmem,\n\t\t       struct iosys_map *map);\nvoid drm_gem_shmem_vunmap(struct drm_gem_shmem_object *shmem,\n\t\t\t  struct iosys_map *map);\nint drm_gem_shmem_mmap(struct drm_gem_shmem_object *shmem, struct vm_area_struct *vma);\n\nint drm_gem_shmem_madvise(struct drm_gem_shmem_object *shmem, int madv);\n\nstatic inline bool drm_gem_shmem_is_purgeable(struct drm_gem_shmem_object *shmem)\n{\n\treturn (shmem->madv > 0) &&\n\t\t!shmem->vmap_use_count && shmem->sgt &&\n\t\t!shmem->base.dma_buf && !shmem->base.import_attach;\n}\n\nvoid drm_gem_shmem_purge(struct drm_gem_shmem_object *shmem);\n\nstruct sg_table *drm_gem_shmem_get_sg_table(struct drm_gem_shmem_object *shmem);\nstruct sg_table *drm_gem_shmem_get_pages_sgt(struct drm_gem_shmem_object *shmem);\n\nvoid drm_gem_shmem_print_info(const struct drm_gem_shmem_object *shmem,\n\t\t\t      struct drm_printer *p, unsigned int indent);\n\nextern const struct vm_operations_struct drm_gem_shmem_vm_ops;\n\n \n\n \nstatic inline void drm_gem_shmem_object_free(struct drm_gem_object *obj)\n{\n\tstruct drm_gem_shmem_object *shmem = to_drm_gem_shmem_obj(obj);\n\n\tdrm_gem_shmem_free(shmem);\n}\n\n \nstatic inline void drm_gem_shmem_object_print_info(struct drm_printer *p, unsigned int indent,\n\t\t\t\t\t\t   const struct drm_gem_object *obj)\n{\n\tconst struct drm_gem_shmem_object *shmem = to_drm_gem_shmem_obj(obj);\n\n\tdrm_gem_shmem_print_info(shmem, p, indent);\n}\n\n \nstatic inline int drm_gem_shmem_object_pin(struct drm_gem_object *obj)\n{\n\tstruct drm_gem_shmem_object *shmem = to_drm_gem_shmem_obj(obj);\n\n\treturn drm_gem_shmem_pin(shmem);\n}\n\n \nstatic inline void drm_gem_shmem_object_unpin(struct drm_gem_object *obj)\n{\n\tstruct drm_gem_shmem_object *shmem = to_drm_gem_shmem_obj(obj);\n\n\tdrm_gem_shmem_unpin(shmem);\n}\n\n \nstatic inline struct sg_table *drm_gem_shmem_object_get_sg_table(struct drm_gem_object *obj)\n{\n\tstruct drm_gem_shmem_object *shmem = to_drm_gem_shmem_obj(obj);\n\n\treturn drm_gem_shmem_get_sg_table(shmem);\n}\n\n \nstatic inline int drm_gem_shmem_object_vmap(struct drm_gem_object *obj,\n\t\t\t\t\t    struct iosys_map *map)\n{\n\tstruct drm_gem_shmem_object *shmem = to_drm_gem_shmem_obj(obj);\n\n\treturn drm_gem_shmem_vmap(shmem, map);\n}\n\n \nstatic inline void drm_gem_shmem_object_vunmap(struct drm_gem_object *obj,\n\t\t\t\t\t       struct iosys_map *map)\n{\n\tstruct drm_gem_shmem_object *shmem = to_drm_gem_shmem_obj(obj);\n\n\tdrm_gem_shmem_vunmap(shmem, map);\n}\n\n \nstatic inline int drm_gem_shmem_object_mmap(struct drm_gem_object *obj, struct vm_area_struct *vma)\n{\n\tstruct drm_gem_shmem_object *shmem = to_drm_gem_shmem_obj(obj);\n\n\treturn drm_gem_shmem_mmap(shmem, vma);\n}\n\n \n\nstruct drm_gem_object *\ndrm_gem_shmem_prime_import_sg_table(struct drm_device *dev,\n\t\t\t\t    struct dma_buf_attachment *attach,\n\t\t\t\t    struct sg_table *sgt);\nint drm_gem_shmem_dumb_create(struct drm_file *file, struct drm_device *dev,\n\t\t\t      struct drm_mode_create_dumb *args);\n\n \n#define DRM_GEM_SHMEM_DRIVER_OPS \\\n\t.gem_prime_import_sg_table = drm_gem_shmem_prime_import_sg_table, \\\n\t.dumb_create\t\t   = drm_gem_shmem_dumb_create\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}