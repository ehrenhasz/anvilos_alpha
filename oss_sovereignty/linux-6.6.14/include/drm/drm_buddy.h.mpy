{
  "module_name": "drm_buddy.h",
  "hash_id": "75b839e9e8d6f66746c0a71fdc3d0f15f19e4c7fdef95c248ff595adca9ec84e",
  "original_prompt": "Ingested from linux-6.6.14/include/drm/drm_buddy.h",
  "human_readable_source": " \n \n\n#ifndef __DRM_BUDDY_H__\n#define __DRM_BUDDY_H__\n\n#include <linux/bitops.h>\n#include <linux/list.h>\n#include <linux/slab.h>\n#include <linux/sched.h>\n\n#include <drm/drm_print.h>\n\n#define range_overflows(start, size, max) ({ \\\n\ttypeof(start) start__ = (start); \\\n\ttypeof(size) size__ = (size); \\\n\ttypeof(max) max__ = (max); \\\n\t(void)(&start__ == &size__); \\\n\t(void)(&start__ == &max__); \\\n\tstart__ >= max__ || size__ > max__ - start__; \\\n})\n\n#define DRM_BUDDY_RANGE_ALLOCATION (1 << 0)\n#define DRM_BUDDY_TOPDOWN_ALLOCATION (1 << 1)\n\nstruct drm_buddy_block {\n#define DRM_BUDDY_HEADER_OFFSET GENMASK_ULL(63, 12)\n#define DRM_BUDDY_HEADER_STATE  GENMASK_ULL(11, 10)\n#define   DRM_BUDDY_ALLOCATED\t   (1 << 10)\n#define   DRM_BUDDY_FREE\t   (2 << 10)\n#define   DRM_BUDDY_SPLIT\t   (3 << 10)\n \n#define DRM_BUDDY_HEADER_UNUSED GENMASK_ULL(9, 6)\n#define DRM_BUDDY_HEADER_ORDER  GENMASK_ULL(5, 0)\n\tu64 header;\n\n\tstruct drm_buddy_block *left;\n\tstruct drm_buddy_block *right;\n\tstruct drm_buddy_block *parent;\n\n\tvoid *private;  \n\n\t \n\tstruct list_head link;\n\tstruct list_head tmp_link;\n};\n\n \n#define DRM_BUDDY_MAX_ORDER (63 - PAGE_SHIFT)\n\n \nstruct drm_buddy {\n\t \n\tstruct list_head *free_list;\n\n\t \n\tstruct drm_buddy_block **roots;\n\n\t \n\tunsigned int n_roots;\n\tunsigned int max_order;\n\n\t \n\tu64 chunk_size;\n\tu64 size;\n\tu64 avail;\n};\n\nstatic inline u64\ndrm_buddy_block_offset(struct drm_buddy_block *block)\n{\n\treturn block->header & DRM_BUDDY_HEADER_OFFSET;\n}\n\nstatic inline unsigned int\ndrm_buddy_block_order(struct drm_buddy_block *block)\n{\n\treturn block->header & DRM_BUDDY_HEADER_ORDER;\n}\n\nstatic inline unsigned int\ndrm_buddy_block_state(struct drm_buddy_block *block)\n{\n\treturn block->header & DRM_BUDDY_HEADER_STATE;\n}\n\nstatic inline bool\ndrm_buddy_block_is_allocated(struct drm_buddy_block *block)\n{\n\treturn drm_buddy_block_state(block) == DRM_BUDDY_ALLOCATED;\n}\n\nstatic inline bool\ndrm_buddy_block_is_free(struct drm_buddy_block *block)\n{\n\treturn drm_buddy_block_state(block) == DRM_BUDDY_FREE;\n}\n\nstatic inline bool\ndrm_buddy_block_is_split(struct drm_buddy_block *block)\n{\n\treturn drm_buddy_block_state(block) == DRM_BUDDY_SPLIT;\n}\n\nstatic inline u64\ndrm_buddy_block_size(struct drm_buddy *mm,\n\t\t     struct drm_buddy_block *block)\n{\n\treturn mm->chunk_size << drm_buddy_block_order(block);\n}\n\nint drm_buddy_init(struct drm_buddy *mm, u64 size, u64 chunk_size);\n\nvoid drm_buddy_fini(struct drm_buddy *mm);\n\nstruct drm_buddy_block *\ndrm_get_buddy(struct drm_buddy_block *block);\n\nint drm_buddy_alloc_blocks(struct drm_buddy *mm,\n\t\t\t   u64 start, u64 end, u64 size,\n\t\t\t   u64 min_page_size,\n\t\t\t   struct list_head *blocks,\n\t\t\t   unsigned long flags);\n\nint drm_buddy_block_trim(struct drm_buddy *mm,\n\t\t\t u64 new_size,\n\t\t\t struct list_head *blocks);\n\nvoid drm_buddy_free_block(struct drm_buddy *mm, struct drm_buddy_block *block);\n\nvoid drm_buddy_free_list(struct drm_buddy *mm, struct list_head *objects);\n\nvoid drm_buddy_print(struct drm_buddy *mm, struct drm_printer *p);\nvoid drm_buddy_block_print(struct drm_buddy *mm,\n\t\t\t   struct drm_buddy_block *block,\n\t\t\t   struct drm_printer *p);\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}