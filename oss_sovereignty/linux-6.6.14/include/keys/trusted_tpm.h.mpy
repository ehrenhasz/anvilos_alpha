{
  "module_name": "trusted_tpm.h",
  "hash_id": "5a8b33b86e003d7a5b1d93e734d59601d581086a8c6083dc3ab6afa134beb850",
  "original_prompt": "Ingested from linux-6.6.14/include/keys/trusted_tpm.h",
  "human_readable_source": " \n#ifndef __TRUSTED_TPM_H\n#define __TRUSTED_TPM_H\n\n#include <keys/trusted-type.h>\n#include <linux/tpm_command.h>\n\n \n#define MAX_BUF_SIZE\t\t\t1024\n#define TPM_GETRANDOM_SIZE\t\t14\n#define TPM_SIZE_OFFSET\t\t\t2\n#define TPM_RETURN_OFFSET\t\t6\n#define TPM_DATA_OFFSET\t\t\t10\n\n#define LOAD32(buffer, offset)\t(ntohl(*(uint32_t *)&buffer[offset]))\n#define LOAD32N(buffer, offset)\t(*(uint32_t *)&buffer[offset])\n#define LOAD16(buffer, offset)\t(ntohs(*(uint16_t *)&buffer[offset]))\n\nextern struct trusted_key_ops trusted_key_tpm_ops;\n\nstruct osapsess {\n\tuint32_t handle;\n\tunsigned char secret[SHA1_DIGEST_SIZE];\n\tunsigned char enonce[TPM_NONCE_SIZE];\n};\n\n \nenum {\n\tSEAL_keytype = 1,\n\tSRK_keytype = 4\n};\n\nint TSS_authhmac(unsigned char *digest, const unsigned char *key,\n\t\t\tunsigned int keylen, unsigned char *h1,\n\t\t\tunsigned char *h2, unsigned int h3, ...);\nint TSS_checkhmac1(unsigned char *buffer,\n\t\t\t  const uint32_t command,\n\t\t\t  const unsigned char *ononce,\n\t\t\t  const unsigned char *key,\n\t\t\t  unsigned int keylen, ...);\n\nint trusted_tpm_send(unsigned char *cmd, size_t buflen);\nint oiap(struct tpm_buf *tb, uint32_t *handle, unsigned char *nonce);\n\nint tpm2_seal_trusted(struct tpm_chip *chip,\n\t\t      struct trusted_key_payload *payload,\n\t\t      struct trusted_key_options *options);\nint tpm2_unseal_trusted(struct tpm_chip *chip,\n\t\t\tstruct trusted_key_payload *payload,\n\t\t\tstruct trusted_key_options *options);\n\n#define TPM_DEBUG 0\n\n#if TPM_DEBUG\nstatic inline void dump_options(struct trusted_key_options *o)\n{\n\tpr_info(\"sealing key type %d\\n\", o->keytype);\n\tpr_info(\"sealing key handle %0X\\n\", o->keyhandle);\n\tpr_info(\"pcrlock %d\\n\", o->pcrlock);\n\tpr_info(\"pcrinfo %d\\n\", o->pcrinfo_len);\n\tprint_hex_dump(KERN_INFO, \"pcrinfo \", DUMP_PREFIX_NONE,\n\t\t       16, 1, o->pcrinfo, o->pcrinfo_len, 0);\n}\n\nstatic inline void dump_sess(struct osapsess *s)\n{\n\tprint_hex_dump(KERN_INFO, \"trusted-key: handle \", DUMP_PREFIX_NONE,\n\t\t       16, 1, &s->handle, 4, 0);\n\tpr_info(\"secret:\\n\");\n\tprint_hex_dump(KERN_INFO, \"\", DUMP_PREFIX_NONE,\n\t\t       16, 1, &s->secret, SHA1_DIGEST_SIZE, 0);\n\tpr_info(\"trusted-key: enonce:\\n\");\n\tprint_hex_dump(KERN_INFO, \"\", DUMP_PREFIX_NONE,\n\t\t       16, 1, &s->enonce, SHA1_DIGEST_SIZE, 0);\n}\n\nstatic inline void dump_tpm_buf(unsigned char *buf)\n{\n\tint len;\n\n\tpr_info(\"\\ntpm buffer\\n\");\n\tlen = LOAD32(buf, TPM_SIZE_OFFSET);\n\tprint_hex_dump(KERN_INFO, \"\", DUMP_PREFIX_NONE, 16, 1, buf, len, 0);\n}\n#else\nstatic inline void dump_options(struct trusted_key_options *o)\n{\n}\n\nstatic inline void dump_sess(struct osapsess *s)\n{\n}\n\nstatic inline void dump_tpm_buf(unsigned char *buf)\n{\n}\n#endif\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}