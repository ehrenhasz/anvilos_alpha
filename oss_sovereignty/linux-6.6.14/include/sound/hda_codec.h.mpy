{
  "module_name": "hda_codec.h",
  "hash_id": "cfd53937648909c8864b37f86fc5ee2bc34024444451924fbd9e49716cbc6be5",
  "original_prompt": "Ingested from linux-6.6.14/include/sound/hda_codec.h",
  "human_readable_source": " \n \n\n#ifndef __SOUND_HDA_CODEC_H\n#define __SOUND_HDA_CODEC_H\n\n#include <linux/refcount.h>\n#include <linux/mod_devicetable.h>\n#include <sound/info.h>\n#include <sound/control.h>\n#include <sound/pcm.h>\n#include <sound/hwdep.h>\n#include <sound/hdaudio.h>\n#include <sound/hda_verbs.h>\n#include <sound/hda_regmap.h>\n\n \n\nstruct hda_bus;\nstruct hda_beep;\nstruct hda_codec;\nstruct hda_pcm;\nstruct hda_pcm_stream;\n\n \nstruct hda_bus {\n\tstruct hdac_bus core;\n\n\tstruct snd_card *card;\n\n\tstruct pci_dev *pci;\n\tconst char *modelname;\n\n\tstruct mutex prepare_mutex;\n\n\t \n\tDECLARE_BITMAP(pcm_dev_bits, SNDRV_PCM_DEVICES);\n\n\t \n\tunsigned int allow_bus_reset:1;\t \n\t \n\tunsigned int shutdown :1;\t \n\tunsigned int response_reset:1;\t \n\tunsigned int in_reset:1;\t \n\tunsigned int no_response_fallback:1;  \n\tunsigned int bus_probing :1;\t \n\tunsigned int keep_power:1;\t \n\tunsigned int jackpoll_in_suspend:1;  \n\n\tint primary_dig_out_type;\t \n\tunsigned int mixer_assigned;\t \n};\n\n \n#define to_hda_bus(bus)\t\tcontainer_of(bus, struct hda_bus, core)\n\n \ntypedef int (*hda_codec_patch_t)(struct hda_codec *);\n\t\n#define HDA_CODEC_ID_SKIP_PROBE\t\t0x00000001\n#define HDA_CODEC_ID_GENERIC_HDMI\t0x00000101\n#define HDA_CODEC_ID_GENERIC\t\t0x00000201\n\n#define HDA_CODEC_REV_ENTRY(_vid, _rev, _name, _patch) \\\n\t{ .vendor_id = (_vid), .rev_id = (_rev), .name = (_name), \\\n\t  .api_version = HDA_DEV_LEGACY, \\\n\t  .driver_data = (unsigned long)(_patch) }\n#define HDA_CODEC_ENTRY(_vid, _name, _patch) \\\n\tHDA_CODEC_REV_ENTRY(_vid, 0, _name, _patch)\n\nstruct hda_codec_driver {\n\tstruct hdac_driver core;\n\tconst struct hda_device_id *id;\n};\n\nint __hda_codec_driver_register(struct hda_codec_driver *drv, const char *name,\n\t\t\t       struct module *owner);\n#define hda_codec_driver_register(drv) \\\n\t__hda_codec_driver_register(drv, KBUILD_MODNAME, THIS_MODULE)\nvoid hda_codec_driver_unregister(struct hda_codec_driver *drv);\n#define module_hda_codec_driver(drv) \\\n\tmodule_driver(drv, hda_codec_driver_register, \\\n\t\t      hda_codec_driver_unregister)\n\n \nstruct hda_codec_ops {\n\tint (*build_controls)(struct hda_codec *codec);\n\tint (*build_pcms)(struct hda_codec *codec);\n\tint (*init)(struct hda_codec *codec);\n\tvoid (*free)(struct hda_codec *codec);\n\tvoid (*unsol_event)(struct hda_codec *codec, unsigned int res);\n\tvoid (*set_power_state)(struct hda_codec *codec, hda_nid_t fg,\n\t\t\t\tunsigned int power_state);\n#ifdef CONFIG_PM\n\tint (*suspend)(struct hda_codec *codec);\n\tint (*resume)(struct hda_codec *codec);\n\tint (*check_power_status)(struct hda_codec *codec, hda_nid_t nid);\n#endif\n\tvoid (*stream_pm)(struct hda_codec *codec, hda_nid_t nid, bool on);\n};\n\n \nstruct hda_pcm_ops {\n\tint (*open)(struct hda_pcm_stream *info, struct hda_codec *codec,\n\t\t    struct snd_pcm_substream *substream);\n\tint (*close)(struct hda_pcm_stream *info, struct hda_codec *codec,\n\t\t     struct snd_pcm_substream *substream);\n\tint (*prepare)(struct hda_pcm_stream *info, struct hda_codec *codec,\n\t\t       unsigned int stream_tag, unsigned int format,\n\t\t       struct snd_pcm_substream *substream);\n\tint (*cleanup)(struct hda_pcm_stream *info, struct hda_codec *codec,\n\t\t       struct snd_pcm_substream *substream);\n\tunsigned int (*get_delay)(struct hda_pcm_stream *info,\n\t\t\t\t  struct hda_codec *codec,\n\t\t\t\t  struct snd_pcm_substream *substream);\n};\n\n \nstruct hda_pcm_stream {\n\tunsigned int substreams;\t \n\tunsigned int channels_min;\t \n\tunsigned int channels_max;\t \n\thda_nid_t nid;\t \n\tu32 rates;\t \n\tu64 formats;\t \n\tunsigned int maxbps;\t \n\tconst struct snd_pcm_chmap_elem *chmap;  \n\tstruct hda_pcm_ops ops;\n};\n\n \nenum {\n\tHDA_PCM_TYPE_AUDIO,\n\tHDA_PCM_TYPE_SPDIF,\n\tHDA_PCM_TYPE_HDMI,\n\tHDA_PCM_TYPE_MODEM,\n\tHDA_PCM_NTYPES\n};\n\n#define SNDRV_PCM_INVALID_DEVICE\t(-1)\n \nstruct hda_pcm {\n\tchar *name;\n\tstruct hda_pcm_stream stream[2];\n\tunsigned int pcm_type;\t \n\tint device;\t\t \n\tstruct snd_pcm *pcm;\t \n\tbool own_chmap;\t\t \n\t \n\tstruct hda_codec *codec;\n\tstruct list_head list;\n\tunsigned int disconnected:1;\n};\n\n \nstruct hda_codec {\n\tstruct hdac_device core;\n\tstruct hda_bus *bus;\n\tstruct snd_card *card;\n\tunsigned int addr;\t \n\tu32 probe_id;  \n\n\t \n\tconst struct hda_device_id *preset;\n\tconst char *modelname;\t \n\n\t \n\tstruct hda_codec_ops patch_ops;\n\n\t \n\tstruct list_head pcm_list_head;\n\trefcount_t pcm_ref;\n\twait_queue_head_t remove_sleep;\n\n\t \n\tvoid *spec;\n\n\t \n\tstruct hda_beep *beep;\n\tunsigned int beep_mode;\n\n\t \n\tu32 *wcaps;\n\n\tstruct snd_array mixers;\t \n\tstruct snd_array nids;\t\t \n\n\tstruct list_head conn_list;\t \n\n\tstruct mutex spdif_mutex;\n\tstruct mutex control_mutex;\n\tstruct snd_array spdif_out;\n\tunsigned int spdif_in_enable;\t \n\tconst hda_nid_t *follower_dig_outs;  \n\tstruct snd_array init_pins;\t \n\tstruct snd_array driver_pins;\t \n\tstruct snd_array cvt_setups;\t \n\n\tstruct mutex user_mutex;\n#ifdef CONFIG_SND_HDA_RECONFIG\n\tstruct snd_array init_verbs;\t \n\tstruct snd_array hints;\t\t \n\tstruct snd_array user_pins;\t \n#endif\n\n#ifdef CONFIG_SND_HDA_HWDEP\n\tstruct snd_hwdep *hwdep;\t \n#endif\n\n\t \n\tunsigned int configured:1;  \n\tunsigned int in_freeing:1;  \n\tunsigned int display_power_control:1;  \n\tunsigned int spdif_status_reset :1;  \n\tunsigned int pin_amp_workaround:1;  \n\tunsigned int single_adc_amp:1;  \n\tunsigned int no_sticky_stream:1;  \n\tunsigned int pins_shutup:1;\t \n\tunsigned int no_trigger_sense:1;  \n\tunsigned int no_jack_detect:1;\t \n\tunsigned int inv_eapd:1;  \n\tunsigned int inv_jack_detect:1;\t \n\tunsigned int pcm_format_first:1;  \n\tunsigned int cached_write:1;\t \n\tunsigned int dp_mst:1;  \n\tunsigned int dump_coef:1;  \n\tunsigned int power_save_node:1;  \n\tunsigned int auto_runtime_pm:1;  \n\tunsigned int force_pin_prefix:1;  \n\tunsigned int link_down_at_suspend:1;  \n\tunsigned int relaxed_resume:1;\t \n\tunsigned int forced_resume:1;  \n\tunsigned int no_stream_clean_at_suspend:1;  \n\tunsigned int ctl_dev_id:1;  \n\n#ifdef CONFIG_PM\n\tunsigned long power_on_acct;\n\tunsigned long power_off_acct;\n\tunsigned long power_jiffies;\n#endif\n\n\t \n\tunsigned int (*power_filter)(struct hda_codec *codec, hda_nid_t nid,\n\t\t\t\t     unsigned int power_state);\n\n\t \n\tvoid (*proc_widget_hook)(struct snd_info_buffer *buffer,\n\t\t\t\t struct hda_codec *codec, hda_nid_t nid);\n\n\t \n\tstruct snd_array jacktbl;\n\tunsigned long jackpoll_interval;  \n\tstruct delayed_work jackpoll_work;\n\n\tint depop_delay;  \n\n\t \n\tint fixup_id;\n\tconst struct hda_fixup *fixup_list;\n\tconst char *fixup_name;\n\n\t \n\tstruct snd_array verbs;\n};\n\n#define dev_to_hda_codec(_dev)\tcontainer_of(_dev, struct hda_codec, core.dev)\n#define hda_codec_dev(_dev)\t(&(_dev)->core.dev)\n\n#define hdac_to_hda_codec(_hdac) container_of(_hdac, struct hda_codec, core)\n\n#define list_for_each_codec(c, bus) \\\n\tlist_for_each_entry(c, &(bus)->core.codec_list, core.list)\n#define list_for_each_codec_safe(c, n, bus)\t\t\t\t\\\n\tlist_for_each_entry_safe(c, n, &(bus)->core.codec_list, core.list)\n\n \n#define HDA_RW_NO_RESPONSE_FALLBACK\t(1 << 0)\n\n \n__printf(3, 4) struct hda_codec *\nsnd_hda_codec_device_init(struct hda_bus *bus, unsigned int codec_addr,\n\t\t\t  const char *fmt, ...);\nint snd_hda_codec_new(struct hda_bus *bus, struct snd_card *card,\n\t\t      unsigned int codec_addr, struct hda_codec **codecp);\nint snd_hda_codec_device_new(struct hda_bus *bus, struct snd_card *card,\n\t\t      unsigned int codec_addr, struct hda_codec *codec,\n\t\t      bool snddev_managed);\nint snd_hda_codec_configure(struct hda_codec *codec);\nint snd_hda_codec_update_widgets(struct hda_codec *codec);\nvoid snd_hda_codec_register(struct hda_codec *codec);\nvoid snd_hda_codec_unregister(struct hda_codec *codec);\nvoid snd_hda_codec_cleanup_for_unbind(struct hda_codec *codec);\n\n \nstatic inline unsigned int\nsnd_hda_codec_read(struct hda_codec *codec, hda_nid_t nid,\n\t\t\t\tint flags,\n\t\t\t\tunsigned int verb, unsigned int parm)\n{\n\treturn snd_hdac_codec_read(&codec->core, nid, flags, verb, parm);\n}\n\nstatic inline int\nsnd_hda_codec_write(struct hda_codec *codec, hda_nid_t nid, int flags,\n\t\t\tunsigned int verb, unsigned int parm)\n{\n\treturn snd_hdac_codec_write(&codec->core, nid, flags, verb, parm);\n}\n\n#define snd_hda_param_read(codec, nid, param) \\\n\tsnd_hdac_read_parm(&(codec)->core, nid, param)\n#define snd_hda_get_sub_nodes(codec, nid, start_nid) \\\n\tsnd_hdac_get_sub_nodes(&(codec)->core, nid, start_nid)\nint snd_hda_get_connections(struct hda_codec *codec, hda_nid_t nid,\n\t\t\t    hda_nid_t *conn_list, int max_conns);\nstatic inline int\nsnd_hda_get_num_conns(struct hda_codec *codec, hda_nid_t nid)\n{\n\treturn snd_hda_get_connections(codec, nid, NULL, 0);\n}\n\n#define snd_hda_get_raw_connections(codec, nid, list, max_conns) \\\n\tsnd_hdac_get_connections(&(codec)->core, nid, list, max_conns)\n#define snd_hda_get_num_raw_conns(codec, nid) \\\n\tsnd_hdac_get_connections(&(codec)->core, nid, NULL, 0)\n\nint snd_hda_get_conn_list(struct hda_codec *codec, hda_nid_t nid,\n\t\t\t  const hda_nid_t **listp);\nint snd_hda_override_conn_list(struct hda_codec *codec, hda_nid_t nid, int nums,\n\t\t\t  const hda_nid_t *list);\nint snd_hda_get_conn_index(struct hda_codec *codec, hda_nid_t mux,\n\t\t\t   hda_nid_t nid, int recursive);\nunsigned int snd_hda_get_num_devices(struct hda_codec *codec, hda_nid_t nid);\nint snd_hda_get_devices(struct hda_codec *codec, hda_nid_t nid,\n\t\t\tu8 *dev_list, int max_devices);\nint snd_hda_get_dev_select(struct hda_codec *codec, hda_nid_t nid);\nint snd_hda_set_dev_select(struct hda_codec *codec, hda_nid_t nid, int dev_id);\n\nstruct hda_verb {\n\thda_nid_t nid;\n\tu32 verb;\n\tu32 param;\n};\n\nvoid snd_hda_sequence_write(struct hda_codec *codec,\n\t\t\t    const struct hda_verb *seq);\n\n \nstatic inline int\nsnd_hda_codec_write_cache(struct hda_codec *codec, hda_nid_t nid,\n\t\t\t  int flags, unsigned int verb, unsigned int parm)\n{\n\treturn snd_hdac_regmap_write(&codec->core, nid, verb, parm);\n}\n\n \nstruct hda_pincfg {\n\thda_nid_t nid;\n\tunsigned char ctrl;\t \n\tunsigned char target;\t \n\tunsigned int cfg;\t \n};\n\nunsigned int snd_hda_codec_get_pincfg(struct hda_codec *codec, hda_nid_t nid);\nint snd_hda_codec_set_pincfg(struct hda_codec *codec, hda_nid_t nid,\n\t\t\t     unsigned int cfg);\nint snd_hda_add_pincfg(struct hda_codec *codec, struct snd_array *list,\n\t\t       hda_nid_t nid, unsigned int cfg);  \nvoid snd_hda_shutup_pins(struct hda_codec *codec);\n\n \nstruct hda_spdif_out {\n\thda_nid_t nid;\t\t \n\tunsigned int status;\t \n\tunsigned short ctls;\t \n};\nstruct hda_spdif_out *snd_hda_spdif_out_of_nid(struct hda_codec *codec,\n\t\t\t\t\t       hda_nid_t nid);\nvoid snd_hda_spdif_ctls_unassign(struct hda_codec *codec, int idx);\nvoid snd_hda_spdif_ctls_assign(struct hda_codec *codec, int idx, hda_nid_t nid);\n\n \nint snd_hda_codec_build_controls(struct hda_codec *codec);\n\n \nint snd_hda_codec_parse_pcms(struct hda_codec *codec);\nint snd_hda_codec_build_pcms(struct hda_codec *codec);\n\n__printf(2, 3)\nstruct hda_pcm *snd_hda_codec_pcm_new(struct hda_codec *codec,\n\t\t\t\t      const char *fmt, ...);\n\nvoid snd_hda_codec_cleanup_for_unbind(struct hda_codec *codec);\n\nstatic inline void snd_hda_codec_pcm_get(struct hda_pcm *pcm)\n{\n\trefcount_inc(&pcm->codec->pcm_ref);\n}\nvoid snd_hda_codec_pcm_put(struct hda_pcm *pcm);\n\nint snd_hda_codec_prepare(struct hda_codec *codec,\n\t\t\t  struct hda_pcm_stream *hinfo,\n\t\t\t  unsigned int stream,\n\t\t\t  unsigned int format,\n\t\t\t  struct snd_pcm_substream *substream);\nvoid snd_hda_codec_cleanup(struct hda_codec *codec,\n\t\t\t   struct hda_pcm_stream *hinfo,\n\t\t\t   struct snd_pcm_substream *substream);\n\nvoid snd_hda_codec_setup_stream(struct hda_codec *codec, hda_nid_t nid,\n\t\t\t\tu32 stream_tag,\n\t\t\t\tint channel_id, int format);\nvoid __snd_hda_codec_cleanup_stream(struct hda_codec *codec, hda_nid_t nid,\n\t\t\t\t    int do_now);\n#define snd_hda_codec_cleanup_stream(codec, nid) \\\n\t__snd_hda_codec_cleanup_stream(codec, nid, 0)\n\n#define snd_hda_query_supported_pcm(codec, nid, ratesp, fmtsp, bpsp) \\\n\tsnd_hdac_query_supported_pcm(&(codec)->core, nid, ratesp, fmtsp, bpsp)\n#define snd_hda_is_supported_format(codec, nid, fmt) \\\n\tsnd_hdac_is_supported_format(&(codec)->core, nid, fmt)\n\nextern const struct snd_pcm_chmap_elem snd_pcm_2_1_chmaps[];\n\nint snd_hda_attach_pcm_stream(struct hda_bus *_bus, struct hda_codec *codec,\n\t\t\t      struct hda_pcm *cpcm);\n\n \nvoid snd_hda_get_codec_name(struct hda_codec *codec, char *name, int namelen);\nvoid snd_hda_codec_set_power_to_all(struct hda_codec *codec, hda_nid_t fg,\n\t\t\t\t    unsigned int power_state);\n\nint snd_hda_lock_devices(struct hda_bus *bus);\nvoid snd_hda_unlock_devices(struct hda_bus *bus);\nvoid snd_hda_bus_reset(struct hda_bus *bus);\nvoid snd_hda_bus_reset_codecs(struct hda_bus *bus);\n\nint snd_hda_codec_set_name(struct hda_codec *codec, const char *name);\n\n \nextern const struct dev_pm_ops hda_codec_driver_pm;\n\nstatic inline\nint hda_call_check_power_status(struct hda_codec *codec, hda_nid_t nid)\n{\n#ifdef CONFIG_PM\n\tif (codec->patch_ops.check_power_status)\n\t\treturn codec->patch_ops.check_power_status(codec, nid);\n#endif\n\treturn 0;\n}\n\n \n#define snd_hda_power_up(codec)\t\tsnd_hdac_power_up(&(codec)->core)\n#define snd_hda_power_up_pm(codec)\tsnd_hdac_power_up_pm(&(codec)->core)\n#define snd_hda_power_down(codec)\tsnd_hdac_power_down(&(codec)->core)\n#define snd_hda_power_down_pm(codec)\tsnd_hdac_power_down_pm(&(codec)->core)\n#ifdef CONFIG_PM\nvoid snd_hda_codec_set_power_save(struct hda_codec *codec, int delay);\nvoid snd_hda_set_power_save(struct hda_bus *bus, int delay);\nvoid snd_hda_update_power_acct(struct hda_codec *codec);\n#else\nstatic inline void snd_hda_codec_set_power_save(struct hda_codec *codec, int delay) {}\nstatic inline void snd_hda_set_power_save(struct hda_bus *bus, int delay) {}\n#endif\n\nstatic inline bool hda_codec_need_resume(struct hda_codec *codec)\n{\n\treturn !codec->relaxed_resume && codec->jacktbl.used;\n}\n\n#ifdef CONFIG_SND_HDA_PATCH_LOADER\n \nint snd_hda_load_patch(struct hda_bus *bus, size_t size, const void *buf);\n#endif\n\n#ifdef CONFIG_SND_HDA_DSP_LOADER\nint snd_hda_codec_load_dsp_prepare(struct hda_codec *codec, unsigned int format,\n\t\t\t\t   unsigned int size,\n\t\t\t\t   struct snd_dma_buffer *bufp);\nvoid snd_hda_codec_load_dsp_trigger(struct hda_codec *codec, bool start);\nvoid snd_hda_codec_load_dsp_cleanup(struct hda_codec *codec,\n\t\t\t\t    struct snd_dma_buffer *dmab);\n#else\nstatic inline int\nsnd_hda_codec_load_dsp_prepare(struct hda_codec *codec, unsigned int format,\n\t\t\t\tunsigned int size,\n\t\t\t\tstruct snd_dma_buffer *bufp)\n{\n\treturn -ENOSYS;\n}\nstatic inline void\nsnd_hda_codec_load_dsp_trigger(struct hda_codec *codec, bool start) {}\nstatic inline void\nsnd_hda_codec_load_dsp_cleanup(struct hda_codec *codec,\n\t\t\t\tstruct snd_dma_buffer *dmab) {}\n#endif\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}