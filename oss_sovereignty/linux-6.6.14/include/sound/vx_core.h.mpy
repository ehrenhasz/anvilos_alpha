{
  "module_name": "vx_core.h",
  "hash_id": "1080681877c32062203e2a48a33149a0f5d4c84d7f4f993b4c95b3008e5b4cc1",
  "original_prompt": "Ingested from linux-6.6.14/include/sound/vx_core.h",
  "human_readable_source": " \n \n\n#ifndef __SOUND_VX_COMMON_H\n#define __SOUND_VX_COMMON_H\n\n#include <sound/pcm.h>\n#include <sound/hwdep.h>\n#include <linux/interrupt.h>\n\nstruct firmware;\nstruct device;\n\n#define VX_DRIVER_VERSION\t0x010000\t \n\n \n#define SIZE_MAX_CMD    0x10\n#define SIZE_MAX_STATUS 0x10\n\nstruct vx_rmh {\n\tu16\tLgCmd;\t\t \n\tu16\tLgStat;\t\t \n\tu32\tCmd[SIZE_MAX_CMD];\n\tu32\tStat[SIZE_MAX_STATUS];\n\tu16\tDspStat;\t \n};\n\t\ntypedef u64 pcx_time_t;\n\n#define VX_MAX_PIPES\t16\n#define VX_MAX_PERIODS\t32\n#define VX_MAX_CODECS\t2\n\nstruct vx_ibl_info {\n\tint size;\t \n\tint max_size;\t \n\tint min_size;\t \n\tint granularity;\t \n};\n\nstruct vx_pipe {\n\tint number;\n\tunsigned int is_capture: 1;\n\tunsigned int data_mode: 1;\n\tunsigned int running: 1;\n\tunsigned int prepared: 1;\n\tint channels;\n\tunsigned int differed_type;\n\tpcx_time_t pcx_time;\n\tstruct snd_pcm_substream *substream;\n\n\tint hbuf_size;\t\t \n\tint buffer_bytes;\t \n\tint period_bytes;\t \n\tint hw_ptr;\t\t \n\tint position;\t\t \n\tint transferred;\t \n\tint align;\t\t \n\tu64 cur_count;\t\t \n\n\tunsigned int references;      \n\tstruct vx_pipe *monitoring_pipe;   \n};\n\nstruct vx_core;\n\nstruct snd_vx_ops {\n\t \n\tunsigned char (*in8)(struct vx_core *chip, int reg);\n\tunsigned int (*in32)(struct vx_core *chip, int reg);\n\tvoid (*out8)(struct vx_core *chip, int reg, unsigned char val);\n\tvoid (*out32)(struct vx_core *chip, int reg, unsigned int val);\n\t \n\tint (*test_and_ack)(struct vx_core *chip);\n\tvoid (*validate_irq)(struct vx_core *chip, int enable);\n\t \n\tvoid (*write_codec)(struct vx_core *chip, int codec, unsigned int data);\n\tvoid (*akm_write)(struct vx_core *chip, int reg, unsigned int data);\n\tvoid (*reset_codec)(struct vx_core *chip);\n\tvoid (*change_audio_source)(struct vx_core *chip, int src);\n\tvoid (*set_clock_source)(struct vx_core *chp, int src);\n\t \n\tint (*load_dsp)(struct vx_core *chip, int idx, const struct firmware *fw);\n\tvoid (*reset_dsp)(struct vx_core *chip);\n\tvoid (*reset_board)(struct vx_core *chip, int cold_reset);\n\tint (*add_controls)(struct vx_core *chip);\n\t \n\tvoid (*dma_write)(struct vx_core *chip, struct snd_pcm_runtime *runtime,\n\t\t\t  struct vx_pipe *pipe, int count);\n\tvoid (*dma_read)(struct vx_core *chip, struct snd_pcm_runtime *runtime,\n\t\t\t  struct vx_pipe *pipe, int count);\n};\n\nstruct snd_vx_hardware {\n\tconst char *name;\n\tint type;\t \n\n\t \n\tunsigned int num_codecs;\n\tunsigned int num_ins;\n\tunsigned int num_outs;\n\tunsigned int output_level_max;\n\tconst unsigned int *output_level_db_scale;\n};\n\n \n#define SND_VX_HWDEP_ID\t\t\"VX Loader\"\n\n \nenum {\n\t \n\tVX_TYPE_BOARD,\t\t \n\tVX_TYPE_V2,\t\t \n\tVX_TYPE_MIC,\t\t \n\t \n\tVX_TYPE_VXPOCKET,\t \n\tVX_TYPE_VXP440,\t\t \n\tVX_TYPE_NUMS\n};\n\n \nenum {\n\tVX_STAT_XILINX_LOADED\t= (1 << 0),\t \n\tVX_STAT_DEVICE_INIT\t= (1 << 1),\t \n\tVX_STAT_CHIP_INIT\t= (1 << 2),\t \n\tVX_STAT_IN_SUSPEND\t= (1 << 10),\t \n\tVX_STAT_IS_STALE\t= (1 << 15)\t \n};\n\n \n#define VX_ANALOG_OUT_LEVEL_MAX\t\t0xe3\n\nstruct vx_core {\n\t \n\tstruct snd_card *card;\n\tstruct snd_pcm *pcm[VX_MAX_CODECS];\n\tint type;\t \n\n\tint irq;\n\t \n\n\t \n\tconst struct snd_vx_hardware *hw;\n\tconst struct snd_vx_ops *ops;\n\n\tstruct mutex lock;\n\n\tunsigned int chip_status;\n\tunsigned int pcm_running;\n\n\tstruct device *dev;\n\tstruct snd_hwdep *hwdep;\n\n\tstruct vx_rmh irq_rmh;\t \n\n\tunsigned int audio_info;  \n\tunsigned int audio_ins;\n\tunsigned int audio_outs;\n\tstruct vx_pipe **playback_pipes;\n\tstruct vx_pipe **capture_pipes;\n\n\t \n\tunsigned int audio_source;\t \n\tunsigned int audio_source_target;\n\tunsigned int clock_mode;\t \n\tunsigned int clock_source;\t \n\tunsigned int freq;\t\t \n\tunsigned int freq_detected;\t \n\tunsigned int uer_detected;\t \n\tunsigned int uer_bits;\t \n\tstruct vx_ibl_info ibl;\t \n\n\t \n\tint output_level[VX_MAX_CODECS][2];\t \n\tint audio_gain[2][4];\t\t\t \n\tunsigned char audio_active[4];\t\t \n\tint audio_monitor[4];\t\t\t \n\tunsigned char audio_monitor_active[4];\t \n\n\tstruct mutex mixer_mutex;\n\n\tconst struct firmware *firmware[4];  \n};\n\n\n \nstruct vx_core *snd_vx_create(struct snd_card *card,\n\t\t\t      const struct snd_vx_hardware *hw,\n\t\t\t      const struct snd_vx_ops *ops, int extra_size);\nint snd_vx_setup_firmware(struct vx_core *chip);\nint snd_vx_load_boot_image(struct vx_core *chip, const struct firmware *dsp);\nint snd_vx_dsp_boot(struct vx_core *chip, const struct firmware *dsp);\nint snd_vx_dsp_load(struct vx_core *chip, const struct firmware *dsp);\n\nvoid snd_vx_free_firmware(struct vx_core *chip);\n\n \nirqreturn_t snd_vx_irq_handler(int irq, void *dev);\nirqreturn_t snd_vx_threaded_irq_handler(int irq, void *dev);\n\n \nstatic inline int vx_test_and_ack(struct vx_core *chip)\n{\n\treturn chip->ops->test_and_ack(chip);\n}\n\nstatic inline void vx_validate_irq(struct vx_core *chip, int enable)\n{\n\tchip->ops->validate_irq(chip, enable);\n}\n\nstatic inline unsigned char snd_vx_inb(struct vx_core *chip, int reg)\n{\n\treturn chip->ops->in8(chip, reg);\n}\n\nstatic inline unsigned int snd_vx_inl(struct vx_core *chip, int reg)\n{\n\treturn chip->ops->in32(chip, reg);\n}\n\nstatic inline void snd_vx_outb(struct vx_core *chip, int reg, unsigned char val)\n{\n\tchip->ops->out8(chip, reg, val);\n}\n\nstatic inline void snd_vx_outl(struct vx_core *chip, int reg, unsigned int val)\n{\n\tchip->ops->out32(chip, reg, val);\n}\n\n#define vx_inb(chip,reg)\tsnd_vx_inb(chip, VX_##reg)\n#define vx_outb(chip,reg,val)\tsnd_vx_outb(chip, VX_##reg,val)\n#define vx_inl(chip,reg)\tsnd_vx_inl(chip, VX_##reg)\n#define vx_outl(chip,reg,val)\tsnd_vx_outl(chip, VX_##reg,val)\n\nstatic inline void vx_reset_dsp(struct vx_core *chip)\n{\n\tchip->ops->reset_dsp(chip);\n}\n\nint vx_send_msg(struct vx_core *chip, struct vx_rmh *rmh);\nint vx_send_msg_nolock(struct vx_core *chip, struct vx_rmh *rmh);\nint vx_send_rih(struct vx_core *chip, int cmd);\nint vx_send_rih_nolock(struct vx_core *chip, int cmd);\n\nvoid vx_reset_codec(struct vx_core *chip, int cold_reset);\n\n \nint snd_vx_check_reg_bit(struct vx_core *chip, int reg, int mask, int bit, int time);\n#define vx_check_isr(chip,mask,bit,time) snd_vx_check_reg_bit(chip, VX_ISR, mask, bit, time)\n#define vx_wait_isr_bit(chip,bit) vx_check_isr(chip, bit, bit, 200)\n#define vx_wait_for_rx_full(chip) vx_wait_isr_bit(chip, ISR_RX_FULL)\n\n\n \nstatic inline void vx_pseudo_dma_write(struct vx_core *chip, struct snd_pcm_runtime *runtime,\n\t\t\t\t       struct vx_pipe *pipe, int count)\n{\n\tchip->ops->dma_write(chip, runtime, pipe, count);\n}\n\nstatic inline void vx_pseudo_dma_read(struct vx_core *chip, struct snd_pcm_runtime *runtime,\n\t\t\t\t      struct vx_pipe *pipe, int count)\n{\n\tchip->ops->dma_read(chip, runtime, pipe, count);\n}\n\n\n\n \n#define VX_ERR_MASK\t0x1000000\n#define vx_get_error(err)\t(-(err) & ~VX_ERR_MASK)\n\n\n \nint snd_vx_pcm_new(struct vx_core *chip);\nvoid vx_pcm_update_intr(struct vx_core *chip, unsigned int events);\n\n \nint snd_vx_mixer_new(struct vx_core *chip);\nvoid vx_toggle_dac_mute(struct vx_core *chip, int mute);\nint vx_sync_audio_source(struct vx_core *chip);\nint vx_set_monitor_level(struct vx_core *chip, int audio, int level, int active);\n\n \nvoid vx_set_iec958_status(struct vx_core *chip, unsigned int bits);\nint vx_set_clock(struct vx_core *chip, unsigned int freq);\nvoid vx_set_internal_clock(struct vx_core *chip, unsigned int freq);\nint vx_change_frequency(struct vx_core *chip);\n\n\n \nint snd_vx_suspend(struct vx_core *card);\nint snd_vx_resume(struct vx_core *card);\n\n \n\n#define vx_has_new_dsp(chip)\t((chip)->type != VX_TYPE_BOARD)\n#define vx_is_pcmcia(chip)\t((chip)->type >= VX_TYPE_VXPOCKET)\n\n \nenum {\n\tVX_AUDIO_SRC_DIGITAL,\n\tVX_AUDIO_SRC_LINE,\n\tVX_AUDIO_SRC_MIC\n};\n\n \nenum {\n\tINTERNAL_QUARTZ,\n\tUER_SYNC\n};\n\n \nenum {\n\tVX_CLOCK_MODE_AUTO,\t \n\tVX_CLOCK_MODE_INTERNAL,\t \n\tVX_CLOCK_MODE_EXTERNAL\t \n};\n\n \nenum {\n\tVX_UER_MODE_CONSUMER,\n\tVX_UER_MODE_PROFESSIONAL,\n\tVX_UER_MODE_NOT_PRESENT,\n};\n\n \nenum {\n\tVX_ICR,\n\tVX_CVR,\n\tVX_ISR,\n\tVX_IVR,\n\tVX_RXH,\n\tVX_TXH = VX_RXH,\n\tVX_RXM,\n\tVX_TXM = VX_RXM,\n\tVX_RXL,\n\tVX_TXL = VX_RXL,\n\tVX_DMA,\n\tVX_CDSP,\n\tVX_RFREQ,\n\tVX_RUER_V2,\n\tVX_GAIN,\n\tVX_DATA = VX_GAIN,\n\tVX_MEMIRQ,\n\tVX_ACQ,\n\tVX_BIT0,\n\tVX_BIT1,\n\tVX_MIC0,\n\tVX_MIC1,\n\tVX_MIC2,\n\tVX_MIC3,\n\tVX_PLX0,\n\tVX_PLX1,\n\tVX_PLX2,\n\n\tVX_LOFREQ,  \n\tVX_HIFREQ,  \n\tVX_CSUER,   \n\tVX_RUER,    \n\n\tVX_REG_MAX,\n\n\t \n\tVX_RESET_DMA = VX_ISR,\n\tVX_CFG = VX_RFREQ,\n\tVX_STATUS = VX_MEMIRQ,\n\tVX_SELMIC = VX_MIC0,\n\tVX_COMPOT = VX_MIC1,\n\tVX_SCOMPR = VX_MIC2,\n\tVX_GLIMIT = VX_MIC3,\n\tVX_INTCSR = VX_PLX0,\n\tVX_CNTRL = VX_PLX1,\n\tVX_GPIOC = VX_PLX2,\n\n\t \n\tVX_MICRO = VX_MEMIRQ,\n\tVX_CODEC2 = VX_MEMIRQ,\n\tVX_DIALOG = VX_ACQ,\n\n};\n\n \nenum {\n\tRMH_SSIZE_FIXED = 0,\t \n\tRMH_SSIZE_ARG = 1,\t \n\tRMH_SSIZE_MASK = 2,\t \n};\n\n\n \n#define ICR_HF1\t\t0x10\n#define ICR_HF0\t\t0x08\n#define ICR_TREQ\t0x02\t \n#define ICR_RREQ\t0x01\t \n\n \n#define CVR_HC\t\t0x80\n\n \n#define ISR_HF3\t\t0x10\n#define ISR_HF2\t\t0x08\n#define ISR_CHK\t\t0x10\n#define ISR_ERR\t\t0x08\n#define ISR_TX_READY\t0x04\n#define ISR_TX_EMPTY\t0x02\n#define ISR_RX_FULL\t0x01\n\n \n#define VX_DATA_CODEC_MASK\t0x80\n#define VX_DATA_XICOR_MASK\t0x80\n\n \n#define VX_SUER_FREQ_MASK\t\t0x0c\n#define VX_SUER_FREQ_32KHz_MASK\t\t0x0c\n#define VX_SUER_FREQ_44KHz_MASK\t\t0x00\n#define VX_SUER_FREQ_48KHz_MASK\t\t0x04\n#define VX_SUER_DATA_PRESENT_MASK\t0x02\n#define VX_SUER_CLOCK_PRESENT_MASK\t0x01\n\n#define VX_CUER_HH_BITC_SEL_MASK\t0x08\n#define VX_CUER_MH_BITC_SEL_MASK\t0x04\n#define VX_CUER_ML_BITC_SEL_MASK\t0x02\n#define VX_CUER_LL_BITC_SEL_MASK\t0x01\n\n#define XX_UER_CBITS_OFFSET_MASK\t0x1f\n\n\n \n#define VX_AUDIO_INFO_REAL_TIME\t(1<<0)\t \n#define VX_AUDIO_INFO_OFFLINE\t(1<<1)\t \n#define VX_AUDIO_INFO_MPEG1\t(1<<5)\n#define VX_AUDIO_INFO_MPEG2\t(1<<6)\n#define VX_AUDIO_INFO_LINEAR_8\t(1<<7)\n#define VX_AUDIO_INFO_LINEAR_16\t(1<<8)\n#define VX_AUDIO_INFO_LINEAR_24\t(1<<9)\n\n \n#define VXP_IRQ_OFFSET\t\t0x40  \n \n#define IRQ_MESS_WRITE_END          0x30\n#define IRQ_MESS_WRITE_NEXT         0x32\n#define IRQ_MESS_READ_NEXT          0x34\n#define IRQ_MESS_READ_END           0x36\n#define IRQ_MESSAGE                 0x38\n#define IRQ_RESET_CHK               0x3A\n#define IRQ_CONNECT_STREAM_NEXT     0x26\n#define IRQ_CONNECT_STREAM_END      0x28\n#define IRQ_PAUSE_START_CONNECT     0x2A\n#define IRQ_END_CONNECTION          0x2C\n\n \n#define ASYNC_EVENTS_PENDING            0x008000\n#define HBUFFER_EVENTS_PENDING          0x004000   \n#define NOTIF_EVENTS_PENDING            0x002000\n#define TIME_CODE_EVENT_PENDING         0x001000\n#define FREQUENCY_CHANGE_EVENT_PENDING  0x000800\n#define END_OF_BUFFER_EVENTS_PENDING    0x000400\n#define FATAL_DSP_ERROR                 0xff0000\n\n  \n#define HEADER_FMT_BASE\t\t\t0xFED00000\n#define HEADER_FMT_MONO\t\t\t0x000000C0\n#define HEADER_FMT_INTEL\t\t0x00008000\n#define HEADER_FMT_16BITS\t\t0x00002000\n#define HEADER_FMT_24BITS\t\t0x00004000\n#define HEADER_FMT_UPTO11\t\t0x00000200\t \n#define HEADER_FMT_UPTO32\t\t0x00000100\t \n\n \n#define XX_CODEC_SELECTOR               0x20\n \n#define XX_CODEC_ADC_CONTROL_REGISTER   0x01\n#define XX_CODEC_DAC_CONTROL_REGISTER   0x02\n#define XX_CODEC_LEVEL_LEFT_REGISTER    0x03\n#define XX_CODEC_LEVEL_RIGHT_REGISTER   0x04\n#define XX_CODEC_PORT_MODE_REGISTER     0x05\n#define XX_CODEC_STATUS_REPORT_REGISTER 0x06\n#define XX_CODEC_CLOCK_CONTROL_REGISTER 0x07\n\n \n#define CVAL_M110DB\t\t0x000\t \n#define CVAL_M99DB\t\t0x02C\n#define CVAL_M21DB\t\t0x163\n#define CVAL_M18DB\t\t0x16F\n#define CVAL_M10DB\t\t0x18F\n#define CVAL_0DB\t\t0x1B7\n#define CVAL_18DB\t\t0x1FF\t \n#define CVAL_MAX\t\t0x1FF\n\n#define AUDIO_IO_HAS_MUTE_LEVEL\t\t\t0x400000\n#define AUDIO_IO_HAS_MUTE_MONITORING_1\t\t0x200000\n#define AUDIO_IO_HAS_MUTE_MONITORING_2\t\t0x100000\n#define VALID_AUDIO_IO_DIGITAL_LEVEL\t\t0x01\n#define VALID_AUDIO_IO_MONITORING_LEVEL\t\t0x02\n#define VALID_AUDIO_IO_MUTE_LEVEL\t\t0x04\n#define VALID_AUDIO_IO_MUTE_MONITORING_1\t0x08\n#define VALID_AUDIO_IO_MUTE_MONITORING_2\t0x10\n\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}