{
  "module_name": "scsi_device.h",
  "hash_id": "585700d337d830915700bf5f65dd3107521c0e6687b4a6c5304ffc7ba5fb2a1b",
  "original_prompt": "Ingested from linux-6.6.14/include/scsi/scsi_device.h",
  "human_readable_source": " \n#ifndef _SCSI_SCSI_DEVICE_H\n#define _SCSI_SCSI_DEVICE_H\n\n#include <linux/list.h>\n#include <linux/spinlock.h>\n#include <linux/workqueue.h>\n#include <linux/blk-mq.h>\n#include <scsi/scsi.h>\n#include <linux/atomic.h>\n#include <linux/sbitmap.h>\n\nstruct bsg_device;\nstruct device;\nstruct request_queue;\nstruct scsi_cmnd;\nstruct scsi_lun;\nstruct scsi_sense_hdr;\n\ntypedef __u64 __bitwise blist_flags_t;\n\n#define SCSI_SENSE_BUFFERSIZE\t96\n\nstruct scsi_mode_data {\n\t__u32\tlength;\n\t__u16\tblock_descriptor_length;\n\t__u8\tmedium_type;\n\t__u8\tdevice_specific;\n\t__u8\theader_length;\n\t__u8\tlonglba:1;\n};\n\n \nenum scsi_device_state {\n\tSDEV_CREATED = 1,\t \n\tSDEV_RUNNING,\t\t \n\tSDEV_CANCEL,\t\t \n\tSDEV_DEL,\t\t \n\tSDEV_QUIESCE,\t\t \n\tSDEV_OFFLINE,\t\t \n\tSDEV_TRANSPORT_OFFLINE,\t \n\tSDEV_BLOCK,\t\t \n\tSDEV_CREATED_BLOCK,\t \n};\n\nenum scsi_scan_mode {\n\tSCSI_SCAN_INITIAL = 0,\n\tSCSI_SCAN_RESCAN,\n\tSCSI_SCAN_MANUAL,\n};\n\nenum scsi_device_event {\n\tSDEV_EVT_MEDIA_CHANGE\t= 1,\t \n\tSDEV_EVT_INQUIRY_CHANGE_REPORTED,\t\t \n\tSDEV_EVT_CAPACITY_CHANGE_REPORTED,\t\t \n\tSDEV_EVT_SOFT_THRESHOLD_REACHED_REPORTED,\t \n\tSDEV_EVT_MODE_PARAMETER_CHANGE_REPORTED,\t \n\tSDEV_EVT_LUN_CHANGE_REPORTED,\t\t\t \n\tSDEV_EVT_ALUA_STATE_CHANGE_REPORTED,\t\t \n\tSDEV_EVT_POWER_ON_RESET_OCCURRED,\t\t \n\n\tSDEV_EVT_FIRST\t\t= SDEV_EVT_MEDIA_CHANGE,\n\tSDEV_EVT_LAST\t\t= SDEV_EVT_POWER_ON_RESET_OCCURRED,\n\n\tSDEV_EVT_MAXBITS\t= SDEV_EVT_LAST + 1\n};\n\nstruct scsi_event {\n\tenum scsi_device_event\tevt_type;\n\tstruct list_head\tnode;\n\n\t \n};\n\n \nstruct scsi_vpd {\n\tstruct rcu_head\trcu;\n\tint\t\tlen;\n\tunsigned char\tdata[];\n};\n\nenum scsi_vpd_parameters {\n\tSCSI_VPD_HEADER_SIZE = 4,\n};\n\nstruct scsi_device {\n\tstruct Scsi_Host *host;\n\tstruct request_queue *request_queue;\n\n\t \n\tstruct list_head    siblings;    \n\tstruct list_head    same_target_siblings;  \n\n\tstruct sbitmap budget_map;\n\tatomic_t device_blocked;\t \n\n\tatomic_t restarts;\n\tspinlock_t list_lock;\n\tstruct list_head starved_entry;\n\tunsigned short queue_depth;\t \n\tunsigned short max_queue_depth;\t \n\tunsigned short last_queue_full_depth;  \n\tunsigned short last_queue_full_count;  \n\tunsigned long last_queue_full_time;\t \n\tunsigned long queue_ramp_up_period;\t \n#define SCSI_DEFAULT_RAMP_UP_PERIOD\t(120 * HZ)\n\n\tunsigned long last_queue_ramp_up;\t \n\n\tunsigned int id, channel;\n\tu64 lun;\n\tunsigned int manufacturer;\t \n\tunsigned sector_size;\t \n\n\tvoid *hostdata;\t\t \n\tunsigned char type;\n\tchar scsi_level;\n\tchar inq_periph_qual;\t \t\n\tstruct mutex inquiry_mutex;\n\tunsigned char inquiry_len;\t \n\tunsigned char * inquiry;\t \n\tconst char * vendor;\t\t \n\tconst char * model;\t\t \n\tconst char * rev;\t\t \n\n#define SCSI_DEFAULT_VPD_LEN\t255\t \n\tstruct scsi_vpd __rcu *vpd_pg0;\n\tstruct scsi_vpd __rcu *vpd_pg83;\n\tstruct scsi_vpd __rcu *vpd_pg80;\n\tstruct scsi_vpd __rcu *vpd_pg89;\n\tstruct scsi_vpd __rcu *vpd_pgb0;\n\tstruct scsi_vpd __rcu *vpd_pgb1;\n\tstruct scsi_vpd __rcu *vpd_pgb2;\n\n\tstruct scsi_target      *sdev_target;\n\n\tblist_flags_t\t\tsdev_bflags;  \n\tunsigned int eh_timeout;  \n\n\t \n\tunsigned manage_system_start_stop:1;\n\n\t \n\tunsigned manage_runtime_start_stop:1;\n\n\t \n\tunsigned manage_shutdown:1;\n\n\t \n\tunsigned force_runtime_start_on_system_start:1;\n\n\tunsigned removable:1;\n\tunsigned changed:1;\t \n\tunsigned busy:1;\t \n\tunsigned lockable:1;\t \n\tunsigned locked:1;       \n\tunsigned borken:1;\t \n\tunsigned disconnect:1;\t \n\tunsigned soft_reset:1;\t \n\tunsigned sdtr:1;\t \n\tunsigned wdtr:1;\t \n\tunsigned ppr:1;\t\t \n\tunsigned tagged_supported:1;\t \n\tunsigned simple_tags:1;\t \n\tunsigned was_reset:1;\t \n\tunsigned expecting_cc_ua:1;  \n\tunsigned use_10_for_rw:1;  \n\tunsigned use_10_for_ms:1;  \n\tunsigned set_dbd_for_ms:1;  \n\tunsigned no_report_opcodes:1;\t \n\tunsigned no_write_same:1;\t \n\tunsigned use_16_for_rw:1;  \n\tunsigned use_16_for_sync:1;\t \n\tunsigned skip_ms_page_8:1;\t \n\tunsigned skip_ms_page_3f:1;\t \n\tunsigned skip_vpd_pages:1;\t \n\tunsigned try_vpd_pages:1;\t \n\tunsigned use_192_bytes_for_3f:1;  \n\tunsigned no_start_on_add:1;\t \n\tunsigned allow_restart:1;  \n\tunsigned no_start_on_resume:1;  \n\tunsigned start_stop_pwr_cond:1;\t \n\tunsigned no_uld_attach:1;  \n\tunsigned select_no_atn:1;\n\tunsigned fix_capacity:1;\t \n\tunsigned guess_capacity:1;\t \n\tunsigned retry_hwerror:1;\t \n\tunsigned last_sector_bug:1;\t \n\tunsigned no_read_disc_info:1;\t \n\tunsigned no_read_capacity_16:1;  \n\tunsigned try_rc_10_first:1;\t \n\tunsigned security_supported:1;\t \n\tunsigned is_visible:1;\t \n\tunsigned wce_default_on:1;\t \n\tunsigned no_dif:1;\t \n\tunsigned broken_fua:1;\t\t \n\tunsigned lun_in_cdb:1;\t\t \n\tunsigned unmap_limit_for_ws:1;\t \n\tunsigned rpm_autosuspend:1;\t \n\tunsigned ignore_media_change:1;  \n\tunsigned silence_suspend:1;\t \n\tunsigned no_vpd_size:1;\t\t \n\n\tunsigned cdl_supported:1;\t \n\tunsigned cdl_enable:1;\t\t \n\n\tunsigned int queue_stopped;\t \n\tbool offline_already;\t\t \n\n\tatomic_t disk_events_disable_depth;  \n\n\tDECLARE_BITMAP(supported_events, SDEV_EVT_MAXBITS);  \n\tDECLARE_BITMAP(pending_events, SDEV_EVT_MAXBITS);  \n\tstruct list_head event_list;\t \n\tstruct work_struct event_work;\n\n\tunsigned int max_device_blocked;  \n#define SCSI_DEFAULT_DEVICE_BLOCKED\t3\n\n\tatomic_t iorequest_cnt;\n\tatomic_t iodone_cnt;\n\tatomic_t ioerr_cnt;\n\tatomic_t iotmo_cnt;\n\n\tstruct device\t\tsdev_gendev,\n\t\t\t\tsdev_dev;\n\n\tstruct work_struct\trequeue_work;\n\n\tstruct scsi_device_handler *handler;\n\tvoid\t\t\t*handler_data;\n\n\tsize_t\t\t\tdma_drain_len;\n\tvoid\t\t\t*dma_drain_buf;\n\n\tunsigned int\t\tsg_timeout;\n\tunsigned int\t\tsg_reserved_size;\n\n\tstruct bsg_device\t*bsg_dev;\n\tunsigned char\t\taccess_state;\n\tstruct mutex\t\tstate_mutex;\n\tenum scsi_device_state sdev_state;\n\tstruct task_struct\t*quiesced_by;\n\tunsigned long\t\tsdev_data[];\n} __attribute__((aligned(sizeof(unsigned long))));\n\n#define\tto_scsi_device(d)\t\\\n\tcontainer_of(d, struct scsi_device, sdev_gendev)\n#define\tclass_to_sdev(d)\t\\\n\tcontainer_of(d, struct scsi_device, sdev_dev)\n#define transport_class_to_sdev(class_dev) \\\n\tto_scsi_device(class_dev->parent)\n\n#define sdev_dbg(sdev, fmt, a...) \\\n\tdev_dbg(&(sdev)->sdev_gendev, fmt, ##a)\n\n \n__printf(4, 5) void\nsdev_prefix_printk(const char *, const struct scsi_device *, const char *,\n\t\tconst char *, ...);\n\n#define sdev_printk(l, sdev, fmt, a...)\t\t\t\t\\\n\tsdev_prefix_printk(l, sdev, NULL, fmt, ##a)\n\n__printf(3, 4) void\nscmd_printk(const char *, const struct scsi_cmnd *, const char *, ...);\n\n#define scmd_dbg(scmd, fmt, a...)\t\t\t\t\t\\\n\tdo {\t\t\t\t\t\t\t\t\\\n\t\tstruct request *__rq = scsi_cmd_to_rq((scmd));\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\t\tif (__rq->q->disk)\t\t\t\t\t\\\n\t\t\tsdev_dbg((scmd)->device, \"[%s] \" fmt,\t\t\\\n\t\t\t\t __rq->q->disk->disk_name, ##a);\t\\\n\t\telse\t\t\t\t\t\t\t\\\n\t\t\tsdev_dbg((scmd)->device, fmt, ##a);\t\t\\\n\t} while (0)\n\nenum scsi_target_state {\n\tSTARGET_CREATED = 1,\n\tSTARGET_RUNNING,\n\tSTARGET_REMOVE,\n\tSTARGET_CREATED_REMOVE,\n\tSTARGET_DEL,\n};\n\n \nstruct scsi_target {\n\tstruct scsi_device\t*starget_sdev_user;\n\tstruct list_head\tsiblings;\n\tstruct list_head\tdevices;\n\tstruct device\t\tdev;\n\tstruct kref\t\treap_ref;  \n\tunsigned int\t\tchannel;\n\tunsigned int\t\tid;  \n\tunsigned int\t\tcreate:1;  \n\tunsigned int\t\tsingle_lun:1;\t \n\tunsigned int\t\tpdt_1f_for_no_lun:1;\t \n\tunsigned int\t\tno_report_luns:1;\t \n\tunsigned int\t\texpecting_lun_change:1;\t \n\t \n\tatomic_t\t\ttarget_busy;\n\tatomic_t\t\ttarget_blocked;\n\n\t \n\tunsigned int\t\tcan_queue;\n\tunsigned int\t\tmax_target_blocked;\n#define SCSI_DEFAULT_TARGET_BLOCKED\t3\n\n\tchar\t\t\tscsi_level;\n\tenum scsi_target_state\tstate;\n\tvoid \t\t\t*hostdata;  \n\tunsigned long\t\tstarget_data[];  \n\t \n} __attribute__((aligned(sizeof(unsigned long))));\n\n#define to_scsi_target(d)\tcontainer_of(d, struct scsi_target, dev)\nstatic inline struct scsi_target *scsi_target(struct scsi_device *sdev)\n{\n\treturn to_scsi_target(sdev->sdev_gendev.parent);\n}\n#define transport_class_to_starget(class_dev) \\\n\tto_scsi_target(class_dev->parent)\n\n#define starget_printk(prefix, starget, fmt, a...)\t\\\n\tdev_printk(prefix, &(starget)->dev, fmt, ##a)\n\nextern struct scsi_device *__scsi_add_device(struct Scsi_Host *,\n\t\tuint, uint, u64, void *hostdata);\nextern int scsi_add_device(struct Scsi_Host *host, uint channel,\n\t\t\t   uint target, u64 lun);\nextern int scsi_register_device_handler(struct scsi_device_handler *scsi_dh);\nextern void scsi_remove_device(struct scsi_device *);\nextern int scsi_unregister_device_handler(struct scsi_device_handler *scsi_dh);\nvoid scsi_attach_vpd(struct scsi_device *sdev);\nvoid scsi_cdl_check(struct scsi_device *sdev);\nint scsi_cdl_enable(struct scsi_device *sdev, bool enable);\n\nextern struct scsi_device *scsi_device_from_queue(struct request_queue *q);\nextern int __must_check scsi_device_get(struct scsi_device *);\nextern void scsi_device_put(struct scsi_device *);\nextern struct scsi_device *scsi_device_lookup(struct Scsi_Host *,\n\t\t\t\t\t      uint, uint, u64);\nextern struct scsi_device *__scsi_device_lookup(struct Scsi_Host *,\n\t\t\t\t\t\tuint, uint, u64);\nextern struct scsi_device *scsi_device_lookup_by_target(struct scsi_target *,\n\t\t\t\t\t\t\tu64);\nextern struct scsi_device *__scsi_device_lookup_by_target(struct scsi_target *,\n\t\t\t\t\t\t\t  u64);\nextern void starget_for_each_device(struct scsi_target *, void *,\n\t\t     void (*fn)(struct scsi_device *, void *));\nextern void __starget_for_each_device(struct scsi_target *, void *,\n\t\t\t\t      void (*fn)(struct scsi_device *,\n\t\t\t\t\t\t void *));\n\n \nextern struct scsi_device *__scsi_iterate_devices(struct Scsi_Host *,\n\t\t\t\t\t\t  struct scsi_device *);\n\n \n#define shost_for_each_device(sdev, shost) \\\n\tfor ((sdev) = __scsi_iterate_devices((shost), NULL); \\\n\t     (sdev); \\\n\t     (sdev) = __scsi_iterate_devices((shost), (sdev)))\n\n \n#define __shost_for_each_device(sdev, shost) \\\n\tlist_for_each_entry((sdev), &((shost)->__devices), siblings)\n\nextern int scsi_change_queue_depth(struct scsi_device *, int);\nextern int scsi_track_queue_full(struct scsi_device *, int);\n\nextern int scsi_set_medium_removal(struct scsi_device *, char);\n\nint scsi_mode_sense(struct scsi_device *sdev, int dbd, int modepage,\n\t\t    int subpage, unsigned char *buffer, int len, int timeout,\n\t\t    int retries, struct scsi_mode_data *data,\n\t\t    struct scsi_sense_hdr *);\nextern int scsi_mode_select(struct scsi_device *sdev, int pf, int sp,\n\t\t\t    unsigned char *buffer, int len, int timeout,\n\t\t\t    int retries, struct scsi_mode_data *data,\n\t\t\t    struct scsi_sense_hdr *);\nextern int scsi_test_unit_ready(struct scsi_device *sdev, int timeout,\n\t\t\t\tint retries, struct scsi_sense_hdr *sshdr);\nextern int scsi_get_vpd_page(struct scsi_device *, u8 page, unsigned char *buf,\n\t\t\t     int buf_len);\nint scsi_report_opcode(struct scsi_device *sdev, unsigned char *buffer,\n\t\t       unsigned int len, unsigned char opcode,\n\t\t       unsigned short sa);\nextern int scsi_device_set_state(struct scsi_device *sdev,\n\t\t\t\t enum scsi_device_state state);\nextern struct scsi_event *sdev_evt_alloc(enum scsi_device_event evt_type,\n\t\t\t\t\t  gfp_t gfpflags);\nextern void sdev_evt_send(struct scsi_device *sdev, struct scsi_event *evt);\nextern void sdev_evt_send_simple(struct scsi_device *sdev,\n\t\t\t  enum scsi_device_event evt_type, gfp_t gfpflags);\nextern int scsi_device_quiesce(struct scsi_device *sdev);\nextern void scsi_device_resume(struct scsi_device *sdev);\nextern void scsi_target_quiesce(struct scsi_target *);\nextern void scsi_target_resume(struct scsi_target *);\nextern void scsi_scan_target(struct device *parent, unsigned int channel,\n\t\t\t     unsigned int id, u64 lun,\n\t\t\t     enum scsi_scan_mode rescan);\nextern void scsi_target_reap(struct scsi_target *);\nvoid scsi_block_targets(struct Scsi_Host *shost, struct device *dev);\nextern void scsi_target_unblock(struct device *, enum scsi_device_state);\nextern void scsi_remove_target(struct device *);\nextern const char *scsi_device_state_name(enum scsi_device_state);\nextern int scsi_is_sdev_device(const struct device *);\nextern int scsi_is_target_device(const struct device *);\nextern void scsi_sanitize_inquiry_string(unsigned char *s, int len);\n\n \nstruct scsi_exec_args {\n\tunsigned char *sense;\t\t \n\tunsigned int sense_len;\t\t \n\tstruct scsi_sense_hdr *sshdr;\t \n\tblk_mq_req_flags_t req_flags;\t \n\tint scmd_flags;\t\t\t \n\tint *resid;\t\t\t \n};\n\nint scsi_execute_cmd(struct scsi_device *sdev, const unsigned char *cmd,\n\t\t     blk_opf_t opf, void *buffer, unsigned int bufflen,\n\t\t     int timeout, int retries,\n\t\t     const struct scsi_exec_args *args);\n\nextern void sdev_disable_disk_events(struct scsi_device *sdev);\nextern void sdev_enable_disk_events(struct scsi_device *sdev);\nextern int scsi_vpd_lun_id(struct scsi_device *, char *, size_t);\nextern int scsi_vpd_tpg_id(struct scsi_device *, int *);\n\n#ifdef CONFIG_PM\nextern int scsi_autopm_get_device(struct scsi_device *);\nextern void scsi_autopm_put_device(struct scsi_device *);\n#else\nstatic inline int scsi_autopm_get_device(struct scsi_device *d) { return 0; }\nstatic inline void scsi_autopm_put_device(struct scsi_device *d) {}\n#endif  \n\nstatic inline int __must_check scsi_device_reprobe(struct scsi_device *sdev)\n{\n\treturn device_reprobe(&sdev->sdev_gendev);\n}\n\nstatic inline unsigned int sdev_channel(struct scsi_device *sdev)\n{\n\treturn sdev->channel;\n}\n\nstatic inline unsigned int sdev_id(struct scsi_device *sdev)\n{\n\treturn sdev->id;\n}\n\n#define scmd_id(scmd) sdev_id((scmd)->device)\n#define scmd_channel(scmd) sdev_channel((scmd)->device)\n\n \nstatic inline int scsi_device_online(struct scsi_device *sdev)\n{\n\treturn (sdev->sdev_state != SDEV_OFFLINE &&\n\t\tsdev->sdev_state != SDEV_TRANSPORT_OFFLINE &&\n\t\tsdev->sdev_state != SDEV_DEL);\n}\nstatic inline int scsi_device_blocked(struct scsi_device *sdev)\n{\n\treturn sdev->sdev_state == SDEV_BLOCK ||\n\t\tsdev->sdev_state == SDEV_CREATED_BLOCK;\n}\nstatic inline int scsi_device_created(struct scsi_device *sdev)\n{\n\treturn sdev->sdev_state == SDEV_CREATED ||\n\t\tsdev->sdev_state == SDEV_CREATED_BLOCK;\n}\n\nint scsi_internal_device_block_nowait(struct scsi_device *sdev);\nint scsi_internal_device_unblock_nowait(struct scsi_device *sdev,\n\t\t\t\t\tenum scsi_device_state new_state);\n\n \nstatic inline int scsi_device_sync(struct scsi_device *sdev)\n{\n\treturn sdev->sdtr;\n}\nstatic inline int scsi_device_wide(struct scsi_device *sdev)\n{\n\treturn sdev->wdtr;\n}\nstatic inline int scsi_device_dt(struct scsi_device *sdev)\n{\n\treturn sdev->ppr;\n}\nstatic inline int scsi_device_dt_only(struct scsi_device *sdev)\n{\n\tif (sdev->inquiry_len < 57)\n\t\treturn 0;\n\treturn (sdev->inquiry[56] & 0x0c) == 0x04;\n}\nstatic inline int scsi_device_ius(struct scsi_device *sdev)\n{\n\tif (sdev->inquiry_len < 57)\n\t\treturn 0;\n\treturn sdev->inquiry[56] & 0x01;\n}\nstatic inline int scsi_device_qas(struct scsi_device *sdev)\n{\n\tif (sdev->inquiry_len < 57)\n\t\treturn 0;\n\treturn sdev->inquiry[56] & 0x02;\n}\nstatic inline int scsi_device_enclosure(struct scsi_device *sdev)\n{\n\treturn sdev->inquiry ? (sdev->inquiry[6] & (1<<6)) : 1;\n}\n\nstatic inline int scsi_device_protection(struct scsi_device *sdev)\n{\n\tif (sdev->no_dif)\n\t\treturn 0;\n\n\treturn sdev->scsi_level > SCSI_2 && sdev->inquiry[5] & (1<<0);\n}\n\nstatic inline int scsi_device_tpgs(struct scsi_device *sdev)\n{\n\treturn sdev->inquiry ? (sdev->inquiry[5] >> 4) & 0x3 : 0;\n}\n\n \nstatic inline int scsi_device_supports_vpd(struct scsi_device *sdev)\n{\n\t \n\tif (sdev->try_vpd_pages)\n\t\treturn 1;\n\t \n\tif (sdev->scsi_level >= SCSI_SPC_2 && !sdev->skip_vpd_pages)\n\t\treturn 1;\n\treturn 0;\n}\n\nstatic inline int scsi_device_busy(struct scsi_device *sdev)\n{\n\treturn sbitmap_weight(&sdev->budget_map);\n}\n\n#define MODULE_ALIAS_SCSI_DEVICE(type) \\\n\tMODULE_ALIAS(\"scsi:t-\" __stringify(type) \"*\")\n#define SCSI_DEVICE_MODALIAS_FMT \"scsi:t-0x%02x\"\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}