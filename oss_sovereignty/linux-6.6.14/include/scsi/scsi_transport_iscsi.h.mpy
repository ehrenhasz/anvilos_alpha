{
  "module_name": "scsi_transport_iscsi.h",
  "hash_id": "0b70f53ec5b04440151af34290a283cd54c5b7914ea3c6021d844f7783de9d6b",
  "original_prompt": "Ingested from linux-6.6.14/include/scsi/scsi_transport_iscsi.h",
  "human_readable_source": " \n \n#ifndef SCSI_TRANSPORT_ISCSI_H\n#define SCSI_TRANSPORT_ISCSI_H\n\n#include <linux/device.h>\n#include <linux/list.h>\n#include <linux/mutex.h>\n#include <scsi/iscsi_if.h>\n\nstruct scsi_transport_template;\nstruct iscsi_transport;\nstruct iscsi_endpoint;\nstruct Scsi_Host;\nstruct scsi_cmnd;\nstruct iscsi_cls_conn;\nstruct iscsi_conn;\nstruct iscsi_task;\nstruct sockaddr;\nstruct iscsi_iface;\nstruct bsg_job;\nstruct iscsi_bus_flash_session;\nstruct iscsi_bus_flash_conn;\n\n \nstruct iscsi_transport {\n\tstruct module *owner;\n\tchar *name;\n\tunsigned int caps;\n\n\tstruct iscsi_cls_session *(*create_session) (struct iscsi_endpoint *ep,\n\t\t\t\t\tuint16_t cmds_max, uint16_t qdepth,\n\t\t\t\t\tuint32_t sn);\n\tvoid (*destroy_session) (struct iscsi_cls_session *session);\n\tstruct iscsi_cls_conn *(*create_conn) (struct iscsi_cls_session *sess,\n\t\t\t\tuint32_t cid);\n\tvoid (*unbind_conn) (struct iscsi_cls_conn *conn, bool is_active);\n\tint (*bind_conn) (struct iscsi_cls_session *session,\n\t\t\t  struct iscsi_cls_conn *cls_conn,\n\t\t\t  uint64_t transport_eph, int is_leading);\n\tint (*start_conn) (struct iscsi_cls_conn *conn);\n\tvoid (*stop_conn) (struct iscsi_cls_conn *conn, int flag);\n\tvoid (*destroy_conn) (struct iscsi_cls_conn *conn);\n\tint (*set_param) (struct iscsi_cls_conn *conn, enum iscsi_param param,\n\t\t\t  char *buf, int buflen);\n\tint (*get_ep_param) (struct iscsi_endpoint *ep, enum iscsi_param param,\n\t\t\t     char *buf);\n\tint (*get_conn_param) (struct iscsi_cls_conn *conn,\n\t\t\t       enum iscsi_param param, char *buf);\n\tint (*get_session_param) (struct iscsi_cls_session *session,\n\t\t\t\t  enum iscsi_param param, char *buf);\n\tint (*get_host_param) (struct Scsi_Host *shost,\n\t\t\t\tenum iscsi_host_param param, char *buf);\n\tint (*set_host_param) (struct Scsi_Host *shost,\n\t\t\t       enum iscsi_host_param param, char *buf,\n\t\t\t       int buflen);\n\tint (*send_pdu) (struct iscsi_cls_conn *conn, struct iscsi_hdr *hdr,\n\t\t\t char *data, uint32_t data_size);\n\tvoid (*get_stats) (struct iscsi_cls_conn *conn,\n\t\t\t   struct iscsi_stats *stats);\n\n\tint (*init_task) (struct iscsi_task *task);\n\tint (*xmit_task) (struct iscsi_task *task);\n\tvoid (*cleanup_task) (struct iscsi_task *task);\n\n\tint (*alloc_pdu) (struct iscsi_task *task, uint8_t opcode);\n\tint (*xmit_pdu) (struct iscsi_task *task);\n\tint (*init_pdu) (struct iscsi_task *task, unsigned int offset,\n\t\t\t unsigned int count);\n\tvoid (*parse_pdu_itt) (struct iscsi_conn *conn, itt_t itt,\n\t\t\t       int *index, int *age);\n\n\tvoid (*session_recovery_timedout) (struct iscsi_cls_session *session);\n\tstruct iscsi_endpoint *(*ep_connect) (struct Scsi_Host *shost,\n\t\t\t\t\t      struct sockaddr *dst_addr,\n\t\t\t\t\t      int non_blocking);\n\tint (*ep_poll) (struct iscsi_endpoint *ep, int timeout_ms);\n\tvoid (*ep_disconnect) (struct iscsi_endpoint *ep);\n\tint (*tgt_dscvr) (struct Scsi_Host *shost, enum iscsi_tgt_dscvr type,\n\t\t\t  uint32_t enable, struct sockaddr *dst_addr);\n\tint (*set_path) (struct Scsi_Host *shost, struct iscsi_path *params);\n\tint (*set_iface_param) (struct Scsi_Host *shost, void *data,\n\t\t\t\tuint32_t len);\n\tint (*get_iface_param) (struct iscsi_iface *iface,\n\t\t\t\tenum iscsi_param_type param_type,\n\t\t\t\tint param, char *buf);\n\tumode_t (*attr_is_visible)(int param_type, int param);\n\tint (*bsg_request)(struct bsg_job *job);\n\tint (*send_ping) (struct Scsi_Host *shost, uint32_t iface_num,\n\t\t\t  uint32_t iface_type, uint32_t payload_size,\n\t\t\t  uint32_t pid, struct sockaddr *dst_addr);\n\tint (*get_chap) (struct Scsi_Host *shost, uint16_t chap_tbl_idx,\n\t\t\t uint32_t *num_entries, char *buf);\n\tint (*delete_chap) (struct Scsi_Host *shost, uint16_t chap_tbl_idx);\n\tint (*set_chap) (struct Scsi_Host *shost, void *data, int len);\n\tint (*get_flashnode_param) (struct iscsi_bus_flash_session *fnode_sess,\n\t\t\t\t    int param, char *buf);\n\tint (*set_flashnode_param) (struct iscsi_bus_flash_session *fnode_sess,\n\t\t\t\t    struct iscsi_bus_flash_conn *fnode_conn,\n\t\t\t\t    void *data, int len);\n\tint (*new_flashnode) (struct Scsi_Host *shost, const char *buf,\n\t\t\t      int len);\n\tint (*del_flashnode) (struct iscsi_bus_flash_session *fnode_sess);\n\tint (*login_flashnode) (struct iscsi_bus_flash_session *fnode_sess,\n\t\t\t\tstruct iscsi_bus_flash_conn *fnode_conn);\n\tint (*logout_flashnode) (struct iscsi_bus_flash_session *fnode_sess,\n\t\t\t\t struct iscsi_bus_flash_conn *fnode_conn);\n\tint (*logout_flashnode_sid) (struct iscsi_cls_session *cls_sess);\n\tint (*get_host_stats) (struct Scsi_Host *shost, char *buf, int len);\n\tu8 (*check_protection)(struct iscsi_task *task, sector_t *sector);\n};\n\n \nextern struct scsi_transport_template *iscsi_register_transport(struct iscsi_transport *tt);\nextern void iscsi_unregister_transport(struct iscsi_transport *tt);\n\n \nextern void iscsi_conn_error_event(struct iscsi_cls_conn *conn,\n\t\t\t\t   enum iscsi_err error);\nextern void iscsi_conn_login_event(struct iscsi_cls_conn *conn,\n\t\t\t\t   enum iscsi_conn_state state);\nextern int iscsi_recv_pdu(struct iscsi_cls_conn *conn, struct iscsi_hdr *hdr,\n\t\t\t  char *data, uint32_t data_size);\n\nextern int iscsi_offload_mesg(struct Scsi_Host *shost,\n\t\t\t      struct iscsi_transport *transport, uint32_t type,\n\t\t\t      char *data, uint16_t data_size);\n\nextern void iscsi_post_host_event(uint32_t host_no,\n\t\t\t\t  struct iscsi_transport *transport,\n\t\t\t\t  enum iscsi_host_event_code code,\n\t\t\t\t  uint32_t data_size,\n\t\t\t\t  uint8_t *data);\n\nextern void iscsi_ping_comp_event(uint32_t host_no,\n\t\t\t\t  struct iscsi_transport *transport,\n\t\t\t\t  uint32_t status, uint32_t pid,\n\t\t\t\t  uint32_t data_size, uint8_t *data);\n\n \nenum iscsi_connection_state {\n\tISCSI_CONN_UP = 0,\n\tISCSI_CONN_DOWN,\n\tISCSI_CONN_FAILED,\n\tISCSI_CONN_BOUND,\n};\n\n#define ISCSI_CLS_CONN_BIT_CLEANUP\t1\n\nstruct iscsi_cls_conn {\n\tstruct list_head conn_list;\t \n\tvoid *dd_data;\t\t\t \n\tstruct iscsi_transport *transport;\n\tuint32_t cid;\t\t\t \n\t \n\tstruct mutex ep_mutex;\n\tstruct iscsi_endpoint *ep;\n\n\t \n\tspinlock_t lock;\n\tunsigned long flags;\n\tstruct work_struct cleanup_work;\n\n\tstruct device dev;\t\t \n\tenum iscsi_connection_state state;\n};\n\n#define iscsi_dev_to_conn(_dev) \\\n\tcontainer_of(_dev, struct iscsi_cls_conn, dev)\n\n#define transport_class_to_conn(_cdev) \\\n\tiscsi_dev_to_conn(_cdev->parent)\n\n#define iscsi_conn_to_session(_conn) \\\n\tiscsi_dev_to_session(_conn->dev.parent)\n\n \nenum {\n\tISCSI_SESSION_LOGGED_IN,\n\tISCSI_SESSION_FAILED,\n\tISCSI_SESSION_FREE,\n};\n\nenum {\n\tISCSI_SESSION_TARGET_UNBOUND,\n\tISCSI_SESSION_TARGET_ALLOCATED,\n\tISCSI_SESSION_TARGET_SCANNED,\n\tISCSI_SESSION_TARGET_UNBINDING,\n\tISCSI_SESSION_TARGET_MAX,\n};\n\n#define ISCSI_MAX_TARGET -1\n\nstruct iscsi_cls_session {\n\tstruct list_head sess_list;\t\t \n\tstruct iscsi_transport *transport;\n\tspinlock_t lock;\n\tstruct work_struct block_work;\n\tstruct work_struct unblock_work;\n\tstruct work_struct scan_work;\n\tstruct work_struct unbind_work;\n\tstruct work_struct destroy_work;\n\n\t \n\tint recovery_tmo;\n\tbool recovery_tmo_sysfs_override;\n\tstruct delayed_work recovery_work;\n\n\tstruct workqueue_struct *workq;\n\n\tunsigned int target_id;\n\tbool ida_used;\n\n\t \n\tpid_t creator;\n\tint state;\n\tint target_state;\t\t\t \n\tint sid;\t\t\t\t \n\tvoid *dd_data;\t\t\t\t \n\tstruct device dev;\t \n};\n\n#define iscsi_dev_to_session(_dev) \\\n\tcontainer_of(_dev, struct iscsi_cls_session, dev)\n\n#define transport_class_to_session(_cdev) \\\n\tiscsi_dev_to_session(_cdev->parent)\n\n#define iscsi_session_to_shost(_session) \\\n\tdev_to_shost(_session->dev.parent)\n\n#define starget_to_session(_stgt) \\\n\tiscsi_dev_to_session(_stgt->dev.parent)\n\nstruct iscsi_cls_host {\n\tstruct mutex mutex;\n\tstruct request_queue *bsg_q;\n\tuint32_t port_speed;\n\tuint32_t port_state;\n};\n\n#define iscsi_job_to_shost(_job) \\\n        dev_to_shost(_job->dev)\n\nextern void iscsi_host_for_each_session(struct Scsi_Host *shost,\n\t\t\t\tvoid (*fn)(struct iscsi_cls_session *));\n\nstruct iscsi_endpoint {\n\tvoid *dd_data;\t\t\t \n\tstruct device dev;\n\tint id;\n\tstruct iscsi_cls_conn *conn;\n};\n\nstruct iscsi_iface {\n\tstruct device dev;\n\tstruct iscsi_transport *transport;\n\tuint32_t iface_type;\t \n\tuint32_t iface_num;\t \n\tvoid *dd_data;\t\t \n};\n\n#define iscsi_dev_to_iface(_dev) \\\n\tcontainer_of(_dev, struct iscsi_iface, dev)\n\n#define iscsi_iface_to_shost(_iface) \\\n\tdev_to_shost(_iface->dev.parent)\n\n\nstruct iscsi_bus_flash_conn {\n\tstruct list_head conn_list;\t \n\tvoid *dd_data;\t\t\t \n\tstruct iscsi_transport *transport;\n\tstruct device dev;\t\t \n\t \n\tuint32_t\t\texp_statsn;\n\tuint32_t\t\tstatsn;\n\tunsigned\t\tmax_recv_dlength;  \n\tunsigned\t\tmax_xmit_dlength;  \n\tunsigned\t\tmax_segment_size;\n\tunsigned\t\ttcp_xmit_wsf;\n\tunsigned\t\ttcp_recv_wsf;\n\tint\t\t\thdrdgst_en;\n\tint\t\t\tdatadgst_en;\n\tint\t\t\tport;\n\tchar\t\t\t*ipaddress;\n\tchar\t\t\t*link_local_ipv6_addr;\n\tchar\t\t\t*redirect_ipaddr;\n\tuint16_t\t\tkeepalive_timeout;\n\tuint16_t\t\tlocal_port;\n\tuint8_t\t\t\tsnack_req_en;\n\t \n\tuint8_t\t\t\ttcp_timestamp_stat;\n\tuint8_t\t\t\ttcp_nagle_disable;\n\t \n\tuint8_t\t\t\ttcp_wsf_disable;\n\tuint8_t\t\t\ttcp_timer_scale;\n\tuint8_t\t\t\ttcp_timestamp_en;\n\tuint8_t\t\t\tipv4_tos;\n\tuint8_t\t\t\tipv6_traffic_class;\n\tuint8_t\t\t\tipv6_flow_label;\n\tuint8_t\t\t\tfragment_disable;\n\t \n\tuint8_t\t\t\tis_fw_assigned_ipv6;\n};\n\n#define iscsi_dev_to_flash_conn(_dev) \\\n\tcontainer_of(_dev, struct iscsi_bus_flash_conn, dev)\n\n#define iscsi_flash_conn_to_flash_session(_conn) \\\n\tiscsi_dev_to_flash_session(_conn->dev.parent)\n\n#define ISID_SIZE 6\n\nstruct iscsi_bus_flash_session {\n\tstruct list_head sess_list;\t\t \n\tstruct iscsi_transport *transport;\n\tunsigned int target_id;\n\tint flash_state;\t \n\tvoid *dd_data;\t\t\t\t \n\tstruct device dev;\t \n\t \n\tunsigned\t\tfirst_burst;\n\tunsigned\t\tmax_burst;\n\tunsigned short\t\tmax_r2t;\n\tint\t\t\tdefault_taskmgmt_timeout;\n\tint\t\t\tinitial_r2t_en;\n\tint\t\t\timm_data_en;\n\tint\t\t\ttime2wait;\n\tint\t\t\ttime2retain;\n\tint\t\t\tpdu_inorder_en;\n\tint\t\t\tdataseq_inorder_en;\n\tint\t\t\terl;\n\tint\t\t\ttpgt;\n\tchar\t\t\t*username;\n\tchar\t\t\t*username_in;\n\tchar\t\t\t*password;\n\tchar\t\t\t*password_in;\n\tchar\t\t\t*targetname;\n\tchar\t\t\t*targetalias;\n\tchar\t\t\t*portal_type;\n\tuint16_t\t\ttsid;\n\tuint16_t\t\tchap_in_idx;\n\tuint16_t\t\tchap_out_idx;\n\t \n\tuint16_t\t\tdiscovery_parent_idx;\n\t \n\tuint16_t\t\tdiscovery_parent_type;\n\t \n\tuint8_t\t\t\tauto_snd_tgt_disable;\n\tuint8_t\t\t\tdiscovery_sess;\n\t \n\tuint8_t\t\t\tentry_state;\n\tuint8_t\t\t\tchap_auth_en;\n\t \n\tuint8_t\t\t\tdiscovery_logout_en;\n\tuint8_t\t\t\tbidi_chap_en;\n\t \n\tuint8_t\t\t\tdiscovery_auth_optional;\n\tuint8_t\t\t\tisid[ISID_SIZE];\n\tuint8_t\t\t\tis_boot_target;\n};\n\n#define iscsi_dev_to_flash_session(_dev) \\\n\tcontainer_of(_dev, struct iscsi_bus_flash_session, dev)\n\n#define iscsi_flash_session_to_shost(_session) \\\n\tdev_to_shost(_session->dev.parent)\n\n \n#define iscsi_cls_session_printk(prefix, _cls_session, fmt, a...) \\\n\tdev_printk(prefix, &(_cls_session)->dev, fmt, ##a)\n\n#define iscsi_cls_conn_printk(prefix, _cls_conn, fmt, a...) \\\n\tdev_printk(prefix, &(_cls_conn)->dev, fmt, ##a)\n\nextern int iscsi_session_chkready(struct iscsi_cls_session *session);\nextern int iscsi_is_session_online(struct iscsi_cls_session *session);\nextern struct iscsi_cls_session *iscsi_alloc_session(struct Scsi_Host *shost,\n\t\t\t\tstruct iscsi_transport *transport, int dd_size);\nextern int iscsi_add_session(struct iscsi_cls_session *session,\n\t\t\t     unsigned int target_id);\nextern int iscsi_session_event(struct iscsi_cls_session *session,\n\t\t\t       enum iscsi_uevent_e event);\nextern struct iscsi_cls_session *iscsi_create_session(struct Scsi_Host *shost,\n\t\t\t\t\t\tstruct iscsi_transport *t,\n\t\t\t\t\t\tint dd_size,\n\t\t\t\t\t\tunsigned int target_id);\nextern void iscsi_force_destroy_session(struct iscsi_cls_session *session);\nextern void iscsi_remove_session(struct iscsi_cls_session *session);\nextern void iscsi_free_session(struct iscsi_cls_session *session);\nextern struct iscsi_cls_conn *iscsi_alloc_conn(struct iscsi_cls_session *sess,\n\t\t\t\t\t\tint dd_size, uint32_t cid);\nextern int iscsi_add_conn(struct iscsi_cls_conn *conn);\nextern void iscsi_remove_conn(struct iscsi_cls_conn *conn);\nextern void iscsi_put_conn(struct iscsi_cls_conn *conn);\nextern void iscsi_get_conn(struct iscsi_cls_conn *conn);\nextern void iscsi_unblock_session(struct iscsi_cls_session *session);\nextern void iscsi_block_session(struct iscsi_cls_session *session);\nextern struct iscsi_endpoint *iscsi_create_endpoint(int dd_size);\nextern void iscsi_destroy_endpoint(struct iscsi_endpoint *ep);\nextern struct iscsi_endpoint *iscsi_lookup_endpoint(u64 handle);\nextern void iscsi_put_endpoint(struct iscsi_endpoint *ep);\nextern int iscsi_block_scsi_eh(struct scsi_cmnd *cmd);\nextern struct iscsi_iface *iscsi_create_iface(struct Scsi_Host *shost,\n\t\t\t\t\t      struct iscsi_transport *t,\n\t\t\t\t\t      uint32_t iface_type,\n\t\t\t\t\t      uint32_t iface_num, int dd_size);\nextern void iscsi_destroy_iface(struct iscsi_iface *iface);\nextern char *iscsi_get_port_speed_name(struct Scsi_Host *shost);\nextern char *iscsi_get_port_state_name(struct Scsi_Host *shost);\nextern int iscsi_is_session_dev(const struct device *dev);\n\nextern char *iscsi_get_discovery_parent_name(int parent_type);\nextern struct device *\niscsi_find_flashnode(struct Scsi_Host *shost, void *data,\n\t\t     int (*fn)(struct device *dev, void *data));\n\nextern struct iscsi_bus_flash_session *\niscsi_create_flashnode_sess(struct Scsi_Host *shost, int index,\n\t\t\t    struct iscsi_transport *transport, int dd_size);\n\nextern struct iscsi_bus_flash_conn *\niscsi_create_flashnode_conn(struct Scsi_Host *shost,\n\t\t\t    struct iscsi_bus_flash_session *fnode_sess,\n\t\t\t    struct iscsi_transport *transport, int dd_size);\n\nextern void\niscsi_destroy_flashnode_sess(struct iscsi_bus_flash_session *fnode_sess);\n\nextern void iscsi_destroy_all_flashnode(struct Scsi_Host *shost);\nextern int iscsi_flashnode_bus_match(struct device *dev,\n\t\t\t\t     struct device_driver *drv);\nextern struct device *\niscsi_find_flashnode_sess(struct Scsi_Host *shost, void *data,\n\t\t\t  int (*fn)(struct device *dev, void *data));\nextern struct device *\niscsi_find_flashnode_conn(struct iscsi_bus_flash_session *fnode_sess);\n\nextern char *\niscsi_get_ipaddress_state_name(enum iscsi_ipaddress_state port_state);\nextern char *iscsi_get_router_state_name(enum iscsi_router_state router_state);\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}