{
  "module_name": "hyperv_timer.h",
  "hash_id": "2938bd362129d93ded85d6b3919578c9255c0f9e2921883f2e18a90e7b8c1ddb",
  "original_prompt": "Ingested from linux-6.6.14/include/clocksource/hyperv_timer.h",
  "human_readable_source": " \n\n \n\n#ifndef __CLKSOURCE_HYPERV_TIMER_H\n#define __CLKSOURCE_HYPERV_TIMER_H\n\n#include <linux/clocksource.h>\n#include <linux/math64.h>\n#include <asm/hyperv-tlfs.h>\n\n#define HV_MAX_MAX_DELTA_TICKS 0xffffffff\n#define HV_MIN_DELTA_TICKS 1\n\n#ifdef CONFIG_HYPERV_TIMER\n\n#include <asm/hyperv_timer.h>\n\n \nextern int hv_stimer_alloc(bool have_percpu_irqs);\nextern int hv_stimer_cleanup(unsigned int cpu);\nextern void hv_stimer_legacy_init(unsigned int cpu, int sint);\nextern void hv_stimer_legacy_cleanup(unsigned int cpu);\nextern void hv_stimer_global_cleanup(void);\nextern void hv_stimer0_isr(void);\n\nextern void hv_init_clocksource(void);\nextern void hv_remap_tsc_clocksource(void);\n\nextern unsigned long hv_get_tsc_pfn(void);\nextern struct ms_hyperv_tsc_page *hv_get_tsc_page(void);\n\nstatic __always_inline bool\nhv_read_tsc_page_tsc(const struct ms_hyperv_tsc_page *tsc_pg,\n\t\t     u64 *cur_tsc, u64 *time)\n{\n\tu64 scale, offset;\n\tu32 sequence;\n\n\t \n\tdo {\n\t\tsequence = READ_ONCE(tsc_pg->tsc_sequence);\n\t\tif (!sequence)\n\t\t\treturn false;\n\t\t \n\t\tsmp_rmb();\n\n\t\tscale = READ_ONCE(tsc_pg->tsc_scale);\n\t\toffset = READ_ONCE(tsc_pg->tsc_offset);\n\t\t*cur_tsc = hv_get_raw_timer();\n\n\t\t \n\t\tsmp_rmb();\n\n\t} while (READ_ONCE(tsc_pg->tsc_sequence) != sequence);\n\n\t*time = mul_u64_u64_shr(*cur_tsc, scale, 64) + offset;\n\treturn true;\n}\n\n#else  \nstatic inline unsigned long hv_get_tsc_pfn(void)\n{\n\treturn 0;\n}\n\nstatic inline struct ms_hyperv_tsc_page *hv_get_tsc_page(void)\n{\n\treturn NULL;\n}\n\nstatic __always_inline bool\nhv_read_tsc_page_tsc(const struct ms_hyperv_tsc_page *tsc_pg, u64 *cur_tsc, u64 *time)\n{\n\treturn false;\n}\n\nstatic inline int hv_stimer_cleanup(unsigned int cpu) { return 0; }\nstatic inline void hv_stimer_legacy_init(unsigned int cpu, int sint) {}\nstatic inline void hv_stimer_legacy_cleanup(unsigned int cpu) {}\nstatic inline void hv_stimer_global_cleanup(void) {}\nstatic inline void hv_stimer0_isr(void) {}\n\n#endif  \n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}