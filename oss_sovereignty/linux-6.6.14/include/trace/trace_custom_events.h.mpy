{
  "module_name": "trace_custom_events.h",
  "hash_id": "f4b0df30a8bef3e1b3357219629c402700aa4bad2cdb27c29b0fc0ccf4d41e47",
  "original_prompt": "Ingested from linux-6.6.14/include/trace/trace_custom_events.h",
  "human_readable_source": " \n \n\n#include <linux/trace_events.h>\n\n \n#undef TRACE_SYSTEM\n#define TRACE_SYSTEM custom\n\n#ifndef TRACE_SYSTEM_VAR\n#define TRACE_SYSTEM_VAR TRACE_SYSTEM\n#endif\n\n \n\n#include \"stages/init.h\"\n\n#undef TRACE_CUSTOM_EVENT\n#define TRACE_CUSTOM_EVENT(name, proto, args, tstruct, assign, print) \\\n\tDECLARE_CUSTOM_EVENT_CLASS(name,\t\t\t      \\\n\t\t\t     PARAMS(proto),\t\t       \\\n\t\t\t     PARAMS(args),\t\t       \\\n\t\t\t     PARAMS(tstruct),\t\t       \\\n\t\t\t     PARAMS(assign),\t\t       \\\n\t\t\t     PARAMS(print));\t\t       \\\n\tDEFINE_CUSTOM_EVENT(name, name, PARAMS(proto), PARAMS(args));\n\n \n\n#include \"stages/stage1_struct_define.h\"\n\n#undef DECLARE_CUSTOM_EVENT_CLASS\n#define DECLARE_CUSTOM_EVENT_CLASS(name, proto, args, tstruct, assign, print) \\\n\tstruct trace_custom_event_raw_##name {\t\t\t\t\\\n\t\tstruct trace_entry\tent;\t\t\t\t\\\n\t\ttstruct\t\t\t\t\t\t\t\\\n\t\tchar\t\t\t__data[];\t\t\t\\\n\t};\t\t\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\tstatic struct trace_event_class custom_event_class_##name;\n\n#undef DEFINE_CUSTOM_EVENT\n#define DEFINE_CUSTOM_EVENT(template, name, proto, args)\t\\\n\tstatic struct trace_event_call\t__used\t\t\t\\\n\t__attribute__((__aligned__(4))) custom_event_##name\n\n#include TRACE_INCLUDE(TRACE_INCLUDE_FILE)\n\n \n\n#include \"stages/stage2_data_offsets.h\"\n\n#undef DECLARE_CUSTOM_EVENT_CLASS\n#define DECLARE_CUSTOM_EVENT_CLASS(call, proto, args, tstruct, assign, print)\t\\\n\tstruct trace_custom_event_data_offsets_##call {\t\t\t\\\n\t\ttstruct;\t\t\t\t\t\t\\\n\t};\n\n#undef DEFINE_CUSTOM_EVENT\n#define DEFINE_CUSTOM_EVENT(template, name, proto, args)\n\n#include TRACE_INCLUDE(TRACE_INCLUDE_FILE)\n\n \n\n#include \"stages/stage3_trace_output.h\"\n\n#undef DECLARE_CUSTOM_EVENT_CLASS\n#define DECLARE_CUSTOM_EVENT_CLASS(call, proto, args, tstruct, assign, print) \\\nstatic notrace enum print_line_t\t\t\t\t\t\\\ntrace_custom_raw_output_##call(struct trace_iterator *iter, int flags,\t\\\n\t\t\tstruct trace_event *trace_event)\t\t\\\n{\t\t\t\t\t\t\t\t\t\\\n\tstruct trace_seq *s = &iter->seq;\t\t\t\t\\\n\tstruct trace_seq __maybe_unused *p = &iter->tmp_seq;\t\t\\\n\tstruct trace_custom_event_raw_##call *field;\t\t\t\\\n\tint ret;\t\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\tfield = (typeof(field))iter->ent;\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\tret = trace_raw_output_prep(iter, trace_event);\t\t\t\\\n\tif (ret != TRACE_TYPE_HANDLED)\t\t\t\t\t\\\n\t\treturn ret;\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\ttrace_event_printf(iter, print);\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\treturn trace_handle_return(s);\t\t\t\t\t\\\n}\t\t\t\t\t\t\t\t\t\\\nstatic struct trace_event_functions trace_custom_event_type_funcs_##call = { \\\n\t.trace\t\t\t= trace_custom_raw_output_##call,\t\\\n};\n\n#include TRACE_INCLUDE(TRACE_INCLUDE_FILE)\n\n \n\n#include \"stages/stage4_event_fields.h\"\n\n#undef DECLARE_CUSTOM_EVENT_CLASS\n#define DECLARE_CUSTOM_EVENT_CLASS(call, proto, args, tstruct, func, print)\t\\\nstatic struct trace_event_fields trace_custom_event_fields_##call[] = {\t\\\n\ttstruct\t\t\t\t\t\t\t\t\\\n\t{} };\n\n#include TRACE_INCLUDE(TRACE_INCLUDE_FILE)\n\n \n\n#include \"stages/stage5_get_offsets.h\"\n\n#undef DECLARE_CUSTOM_EVENT_CLASS\n#define DECLARE_CUSTOM_EVENT_CLASS(call, proto, args, tstruct, assign, print) \\\nstatic inline notrace int trace_custom_event_get_offsets_##call(\t\\\n\tstruct trace_custom_event_data_offsets_##call *__data_offsets, proto) \\\n{\t\t\t\t\t\t\t\t\t\\\n\tint __data_size = 0;\t\t\t\t\t\t\\\n\tint __maybe_unused __item_length;\t\t\t\t\\\n\tstruct trace_custom_event_raw_##call __maybe_unused *entry;\t\\\n\t\t\t\t\t\t\t\t\t\\\n\ttstruct;\t\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\treturn __data_size;\t\t\t\t\t\t\\\n}\n\n#include TRACE_INCLUDE(TRACE_INCLUDE_FILE)\n\n \n\n#include \"stages/stage6_event_callback.h\"\n\n#undef DECLARE_CUSTOM_EVENT_CLASS\n#define DECLARE_CUSTOM_EVENT_CLASS(call, proto, args, tstruct, assign, print) \\\n\t\t\t\t\t\t\t\t\t\\\nstatic notrace void\t\t\t\t\t\t\t\\\ntrace_custom_event_raw_event_##call(void *__data, proto)\t\t\\\n{\t\t\t\t\t\t\t\t\t\\\n\tstruct trace_event_file *trace_file = __data;\t\t\t\\\n\tstruct trace_custom_event_data_offsets_##call __maybe_unused __data_offsets; \\\n\tstruct trace_event_buffer fbuffer;\t\t\t\t\\\n\tstruct trace_custom_event_raw_##call *entry;\t\t\t\\\n\tint __data_size;\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\tif (trace_trigger_soft_disabled(trace_file))\t\t\t\\\n\t\treturn;\t\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\t__data_size = trace_custom_event_get_offsets_##call(&__data_offsets, args); \\\n\t\t\t\t\t\t\t\t\t\\\n\tentry = trace_event_buffer_reserve(&fbuffer, trace_file,\t\\\n\t\t\t\t sizeof(*entry) + __data_size);\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\tif (!entry)\t\t\t\t\t\t\t\\\n\t\treturn;\t\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\ttstruct\t\t\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\t{ assign; }\t\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\ttrace_event_buffer_commit(&fbuffer);\t\t\t\t\\\n}\n \n\n#undef DEFINE_CUSTOM_EVENT\n#define DEFINE_CUSTOM_EVENT(template, call, proto, args)\t\t\\\nstatic inline void ftrace_test_custom_probe_##call(void)\t\t\\\n{\t\t\t\t\t\t\t\t\t\\\n\tcheck_trace_callback_type_##call(trace_custom_event_raw_event_##template); \\\n}\n\n#include TRACE_INCLUDE(TRACE_INCLUDE_FILE)\n\n \n\n#include \"stages/stage7_class_define.h\"\n\n#undef DECLARE_CUSTOM_EVENT_CLASS\n#define DECLARE_CUSTOM_EVENT_CLASS(call, proto, args, tstruct, assign, print) \\\nstatic char custom_print_fmt_##call[] = print;\t\t\t\t\t\\\nstatic struct trace_event_class __used __refdata custom_event_class_##call = { \\\n\t.system\t\t\t= TRACE_SYSTEM_STRING,\t\t\t\\\n\t.fields_array\t\t= trace_custom_event_fields_##call,\t\t\\\n\t.fields\t\t\t= LIST_HEAD_INIT(custom_event_class_##call.fields),\\\n\t.raw_init\t\t= trace_event_raw_init,\t\t\t\\\n\t.probe\t\t\t= trace_custom_event_raw_event_##call,\t\\\n\t.reg\t\t\t= trace_event_reg,\t\t\t\\\n};\n\n#undef DEFINE_CUSTOM_EVENT\n#define DEFINE_CUSTOM_EVENT(template, call, proto, args)\t\t\\\n\t\t\t\t\t\t\t\t\t\\\nstatic struct trace_event_call __used custom_event_##call = {\t\t\\\n\t.name\t\t\t= #call,\t\t\t\t\\\n\t.class\t\t\t= &custom_event_class_##template,\t\\\n\t.event.funcs\t\t= &trace_custom_event_type_funcs_##template, \\\n\t.print_fmt\t\t= custom_print_fmt_##template,\t\t\\\n\t.flags\t\t\t= TRACE_EVENT_FL_CUSTOM,\t\t\\\n};\t\t\t\t\t\t\t\t\t\\\nstatic inline int trace_custom_event_##call##_update(struct tracepoint *tp) \\\n{\t\t\t\t\t\t\t\t\t\\\n\tif (tp->name && strcmp(tp->name, #call) == 0) {\t\t\t\\\n\t\tcustom_event_##call.tp = tp;\t\t\t\t\\\n\t\tcustom_event_##call.flags = TRACE_EVENT_FL_TRACEPOINT;\t\\\n\t\treturn 1;\t\t\t\t\t\t\\\n\t}\t\t\t\t\t\t\t\t\\\n\treturn 0;\t\t\t\t\t\t\t\\\n}\t\t\t\t\t\t\t\t\t\\\nstatic struct trace_event_call __used\t\t\t\t\t\\\n__section(\"_ftrace_events\") *__custom_event_##call = &custom_event_##call\n\n#include TRACE_INCLUDE(TRACE_INCLUDE_FILE)\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}