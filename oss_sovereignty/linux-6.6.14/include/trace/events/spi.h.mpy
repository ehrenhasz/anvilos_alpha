{
  "module_name": "spi.h",
  "hash_id": "880a6398c88fbd32a63bb3a59e25606b67d4e49536e42decfed9b366e0bb125a",
  "original_prompt": "Ingested from linux-6.6.14/include/trace/events/spi.h",
  "human_readable_source": " \n#undef TRACE_SYSTEM\n#define TRACE_SYSTEM spi\n\n#if !defined(_TRACE_SPI_H) || defined(TRACE_HEADER_MULTI_READ)\n#define _TRACE_SPI_H\n\n#include <linux/ktime.h>\n#include <linux/tracepoint.h>\n\nDECLARE_EVENT_CLASS(spi_controller,\n\n\tTP_PROTO(struct spi_controller *controller),\n\n\tTP_ARGS(controller),\n\n\tTP_STRUCT__entry(\n\t\t__field(        int,           bus_num             )\n\t),\n\n\tTP_fast_assign(\n\t\t__entry->bus_num = controller->bus_num;\n\t),\n\n\tTP_printk(\"spi%d\", (int)__entry->bus_num)\n\n);\n\nDEFINE_EVENT(spi_controller, spi_controller_idle,\n\n\tTP_PROTO(struct spi_controller *controller),\n\n\tTP_ARGS(controller)\n\n);\n\nDEFINE_EVENT(spi_controller, spi_controller_busy,\n\n\tTP_PROTO(struct spi_controller *controller),\n\n\tTP_ARGS(controller)\n\n);\n\nTRACE_EVENT(spi_setup,\n\tTP_PROTO(struct spi_device *spi, int status),\n\tTP_ARGS(spi, status),\n\n\tTP_STRUCT__entry(\n\t\t__field(int, bus_num)\n\t\t__field(int, chip_select)\n\t\t__field(unsigned long, mode)\n\t\t__field(unsigned int, bits_per_word)\n\t\t__field(unsigned int, max_speed_hz)\n\t\t__field(int, status)\n\t),\n\n\tTP_fast_assign(\n\t\t__entry->bus_num = spi->controller->bus_num;\n\t\t__entry->chip_select =  spi_get_chipselect(spi, 0);\n\t\t__entry->mode = spi->mode;\n\t\t__entry->bits_per_word = spi->bits_per_word;\n\t\t__entry->max_speed_hz = spi->max_speed_hz;\n\t\t__entry->status = status;\n\t),\n\n\tTP_printk(\"spi%d.%d setup mode %lu, %s%s%s%s%u bits/w, %u Hz max --> %d\",\n\t\t  __entry->bus_num, __entry->chip_select,\n\t\t  (__entry->mode & SPI_MODE_X_MASK),\n\t\t  (__entry->mode & SPI_CS_HIGH) ? \"cs_high, \" : \"\",\n\t\t  (__entry->mode & SPI_LSB_FIRST) ? \"lsb, \" : \"\",\n\t\t  (__entry->mode & SPI_3WIRE) ? \"3wire, \" : \"\",\n\t\t  (__entry->mode & SPI_LOOP) ? \"loopback, \" : \"\",\n\t\t  __entry->bits_per_word, __entry->max_speed_hz,\n\t\t  __entry->status)\n);\n\nTRACE_EVENT(spi_set_cs,\n\tTP_PROTO(struct spi_device *spi, bool enable),\n\tTP_ARGS(spi, enable),\n\n\tTP_STRUCT__entry(\n\t\t__field(int, bus_num)\n\t\t__field(int, chip_select)\n\t\t__field(unsigned long, mode)\n\t\t__field(bool, enable)\n\t),\n\n\tTP_fast_assign(\n\t\t__entry->bus_num = spi->controller->bus_num;\n\t\t__entry->chip_select = spi_get_chipselect(spi, 0);\n\t\t__entry->mode = spi->mode;\n\t\t__entry->enable = enable;\n\t),\n\n\tTP_printk(\"spi%d.%d %s%s\",\n\t\t  __entry->bus_num, __entry->chip_select,\n\t\t  __entry->enable ? \"activate\" : \"deactivate\",\n\t\t  (__entry->mode & SPI_CS_HIGH) ? \", cs_high\" : \"\")\n);\n\nDECLARE_EVENT_CLASS(spi_message,\n\n\tTP_PROTO(struct spi_message *msg),\n\n\tTP_ARGS(msg),\n\n\tTP_STRUCT__entry(\n\t\t__field(        int,            bus_num         )\n\t\t__field(        int,            chip_select     )\n\t\t__field(        struct spi_message *,   msg     )\n\t),\n\n\tTP_fast_assign(\n\t\t__entry->bus_num = msg->spi->controller->bus_num;\n\t\t__entry->chip_select = spi_get_chipselect(msg->spi, 0);\n\t\t__entry->msg = msg;\n\t),\n\n        TP_printk(\"spi%d.%d %p\", (int)__entry->bus_num,\n\t\t  (int)__entry->chip_select,\n\t\t  (struct spi_message *)__entry->msg)\n);\n\nDEFINE_EVENT(spi_message, spi_message_submit,\n\n\tTP_PROTO(struct spi_message *msg),\n\n\tTP_ARGS(msg)\n\n);\n\nDEFINE_EVENT(spi_message, spi_message_start,\n\n\tTP_PROTO(struct spi_message *msg),\n\n\tTP_ARGS(msg)\n\n);\n\nTRACE_EVENT(spi_message_done,\n\n\tTP_PROTO(struct spi_message *msg),\n\n\tTP_ARGS(msg),\n\n\tTP_STRUCT__entry(\n\t\t__field(        int,            bus_num         )\n\t\t__field(        int,            chip_select     )\n\t\t__field(        struct spi_message *,   msg     )\n\t\t__field(        unsigned,       frame           )\n\t\t__field(        unsigned,       actual          )\n\t),\n\n\tTP_fast_assign(\n\t\t__entry->bus_num = msg->spi->controller->bus_num;\n\t\t__entry->chip_select = spi_get_chipselect(msg->spi, 0);\n\t\t__entry->msg = msg;\n\t\t__entry->frame = msg->frame_length;\n\t\t__entry->actual = msg->actual_length;\n\t),\n\n        TP_printk(\"spi%d.%d %p len=%u/%u\", (int)__entry->bus_num,\n\t\t  (int)__entry->chip_select,\n\t\t  (struct spi_message *)__entry->msg,\n                  (unsigned)__entry->actual, (unsigned)__entry->frame)\n);\n\n \n#define spi_valid_txbuf(msg, xfer) \\\n\t(xfer->tx_buf && xfer->tx_buf != msg->spi->controller->dummy_tx)\n#define spi_valid_rxbuf(msg, xfer) \\\n\t(xfer->rx_buf && xfer->rx_buf != msg->spi->controller->dummy_rx)\n\nDECLARE_EVENT_CLASS(spi_transfer,\n\n\tTP_PROTO(struct spi_message *msg, struct spi_transfer *xfer),\n\n\tTP_ARGS(msg, xfer),\n\n\tTP_STRUCT__entry(\n\t\t__field(        int,            bus_num         )\n\t\t__field(        int,            chip_select     )\n\t\t__field(        struct spi_transfer *,   xfer   )\n\t\t__field(        int,            len             )\n\t\t__dynamic_array(u8, rx_buf,\n\t\t\t\tspi_valid_rxbuf(msg, xfer) ?\n\t\t\t\t\t(xfer->len < 64 ? xfer->len : 64) : 0)\n\t\t__dynamic_array(u8, tx_buf,\n\t\t\t\tspi_valid_txbuf(msg, xfer) ?\n\t\t\t\t\t(xfer->len < 64 ? xfer->len : 64) : 0)\n\t),\n\n\tTP_fast_assign(\n\t\t__entry->bus_num = msg->spi->controller->bus_num;\n\t\t__entry->chip_select = spi_get_chipselect(msg->spi, 0);\n\t\t__entry->xfer = xfer;\n\t\t__entry->len = xfer->len;\n\n\t\tif (spi_valid_txbuf(msg, xfer))\n\t\t\tmemcpy(__get_dynamic_array(tx_buf),\n\t\t\t       xfer->tx_buf, __get_dynamic_array_len(tx_buf));\n\n\t\tif (spi_valid_rxbuf(msg, xfer))\n\t\t\tmemcpy(__get_dynamic_array(rx_buf),\n\t\t\t       xfer->rx_buf, __get_dynamic_array_len(rx_buf));\n\t),\n\n\tTP_printk(\"spi%d.%d %p len=%d tx=[%*phD] rx=[%*phD]\",\n\t\t  __entry->bus_num, __entry->chip_select,\n\t\t  __entry->xfer, __entry->len,\n\t\t  __get_dynamic_array_len(tx_buf), __get_dynamic_array(tx_buf),\n\t\t  __get_dynamic_array_len(rx_buf), __get_dynamic_array(rx_buf))\n);\n\nDEFINE_EVENT(spi_transfer, spi_transfer_start,\n\n\tTP_PROTO(struct spi_message *msg, struct spi_transfer *xfer),\n\n\tTP_ARGS(msg, xfer)\n\n);\n\nDEFINE_EVENT(spi_transfer, spi_transfer_stop,\n\n\tTP_PROTO(struct spi_message *msg, struct spi_transfer *xfer),\n\n\tTP_ARGS(msg, xfer)\n\n);\n\n#endif  \n\n \n#include <trace/define_trace.h>\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}