{
  "module_name": "tcp.h",
  "hash_id": "7b2a265c8d426f3cafedfab30f6b95eab4a54aa7a9f6befc7c739f0b333c11bc",
  "original_prompt": "Ingested from linux-6.6.14/include/trace/events/tcp.h",
  "human_readable_source": " \n#undef TRACE_SYSTEM\n#define TRACE_SYSTEM tcp\n\n#if !defined(_TRACE_TCP_H) || defined(TRACE_HEADER_MULTI_READ)\n#define _TRACE_TCP_H\n\n#include <linux/ipv6.h>\n#include <linux/tcp.h>\n#include <linux/tracepoint.h>\n#include <net/ipv6.h>\n#include <net/tcp.h>\n#include <linux/sock_diag.h>\n\n#define TP_STORE_V4MAPPED(__entry, saddr, daddr)\t\t\\\n\tdo {\t\t\t\t\t\t\t\\\n\t\tstruct in6_addr *pin6;\t\t\t\t\\\n\t\t\t\t\t\t\t\t\\\n\t\tpin6 = (struct in6_addr *)__entry->saddr_v6;\t\\\n\t\tipv6_addr_set_v4mapped(saddr, pin6);\t\t\\\n\t\tpin6 = (struct in6_addr *)__entry->daddr_v6;\t\\\n\t\tipv6_addr_set_v4mapped(daddr, pin6);\t\t\\\n\t} while (0)\n\n#if IS_ENABLED(CONFIG_IPV6)\n#define TP_STORE_ADDRS(__entry, saddr, daddr, saddr6, daddr6)\t\t\\\n\tdo {\t\t\t\t\t\t\t\t\\\n\t\tif (sk->sk_family == AF_INET6) {\t\t\t\\\n\t\t\tstruct in6_addr *pin6;\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\t\t\tpin6 = (struct in6_addr *)__entry->saddr_v6;\t\\\n\t\t\t*pin6 = saddr6;\t\t\t\t\t\\\n\t\t\tpin6 = (struct in6_addr *)__entry->daddr_v6;\t\\\n\t\t\t*pin6 = daddr6;\t\t\t\t\t\\\n\t\t} else {\t\t\t\t\t\t\\\n\t\t\tTP_STORE_V4MAPPED(__entry, saddr, daddr);\t\\\n\t\t}\t\t\t\t\t\t\t\\\n\t} while (0)\n#else\n#define TP_STORE_ADDRS(__entry, saddr, daddr, saddr6, daddr6)\t\\\n\tTP_STORE_V4MAPPED(__entry, saddr, daddr)\n#endif\n\n \nDECLARE_EVENT_CLASS(tcp_event_sk_skb,\n\n\tTP_PROTO(const struct sock *sk, const struct sk_buff *skb),\n\n\tTP_ARGS(sk, skb),\n\n\tTP_STRUCT__entry(\n\t\t__field(const void *, skbaddr)\n\t\t__field(const void *, skaddr)\n\t\t__field(int, state)\n\t\t__field(__u16, sport)\n\t\t__field(__u16, dport)\n\t\t__field(__u16, family)\n\t\t__array(__u8, saddr, 4)\n\t\t__array(__u8, daddr, 4)\n\t\t__array(__u8, saddr_v6, 16)\n\t\t__array(__u8, daddr_v6, 16)\n\t),\n\n\tTP_fast_assign(\n\t\tconst struct inet_sock *inet = inet_sk(sk);\n\t\t__be32 *p32;\n\n\t\t__entry->skbaddr = skb;\n\t\t__entry->skaddr = sk;\n\t\t__entry->state = sk->sk_state;\n\n\t\t__entry->sport = ntohs(inet->inet_sport);\n\t\t__entry->dport = ntohs(inet->inet_dport);\n\t\t__entry->family = sk->sk_family;\n\n\t\tp32 = (__be32 *) __entry->saddr;\n\t\t*p32 = inet->inet_saddr;\n\n\t\tp32 = (__be32 *) __entry->daddr;\n\t\t*p32 =  inet->inet_daddr;\n\n\t\tTP_STORE_ADDRS(__entry, inet->inet_saddr, inet->inet_daddr,\n\t\t\t      sk->sk_v6_rcv_saddr, sk->sk_v6_daddr);\n\t),\n\n\tTP_printk(\"family=%s sport=%hu dport=%hu saddr=%pI4 daddr=%pI4 saddrv6=%pI6c daddrv6=%pI6c state=%s\",\n\t\t  show_family_name(__entry->family),\n\t\t  __entry->sport, __entry->dport, __entry->saddr, __entry->daddr,\n\t\t  __entry->saddr_v6, __entry->daddr_v6,\n\t\t  show_tcp_state_name(__entry->state))\n);\n\nDEFINE_EVENT(tcp_event_sk_skb, tcp_retransmit_skb,\n\n\tTP_PROTO(const struct sock *sk, const struct sk_buff *skb),\n\n\tTP_ARGS(sk, skb)\n);\n\n \nDEFINE_EVENT(tcp_event_sk_skb, tcp_send_reset,\n\n\tTP_PROTO(const struct sock *sk, const struct sk_buff *skb),\n\n\tTP_ARGS(sk, skb)\n);\n\n \nDECLARE_EVENT_CLASS(tcp_event_sk,\n\n\tTP_PROTO(struct sock *sk),\n\n\tTP_ARGS(sk),\n\n\tTP_STRUCT__entry(\n\t\t__field(const void *, skaddr)\n\t\t__field(__u16, sport)\n\t\t__field(__u16, dport)\n\t\t__field(__u16, family)\n\t\t__array(__u8, saddr, 4)\n\t\t__array(__u8, daddr, 4)\n\t\t__array(__u8, saddr_v6, 16)\n\t\t__array(__u8, daddr_v6, 16)\n\t\t__field(__u64, sock_cookie)\n\t),\n\n\tTP_fast_assign(\n\t\tstruct inet_sock *inet = inet_sk(sk);\n\t\t__be32 *p32;\n\n\t\t__entry->skaddr = sk;\n\n\t\t__entry->sport = ntohs(inet->inet_sport);\n\t\t__entry->dport = ntohs(inet->inet_dport);\n\t\t__entry->family = sk->sk_family;\n\n\t\tp32 = (__be32 *) __entry->saddr;\n\t\t*p32 = inet->inet_saddr;\n\n\t\tp32 = (__be32 *) __entry->daddr;\n\t\t*p32 =  inet->inet_daddr;\n\n\t\tTP_STORE_ADDRS(__entry, inet->inet_saddr, inet->inet_daddr,\n\t\t\t       sk->sk_v6_rcv_saddr, sk->sk_v6_daddr);\n\n\t\t__entry->sock_cookie = sock_gen_cookie(sk);\n\t),\n\n\tTP_printk(\"family=%s sport=%hu dport=%hu saddr=%pI4 daddr=%pI4 saddrv6=%pI6c daddrv6=%pI6c sock_cookie=%llx\",\n\t\t  show_family_name(__entry->family),\n\t\t  __entry->sport, __entry->dport,\n\t\t  __entry->saddr, __entry->daddr,\n\t\t  __entry->saddr_v6, __entry->daddr_v6,\n\t\t  __entry->sock_cookie)\n);\n\nDEFINE_EVENT(tcp_event_sk, tcp_receive_reset,\n\n\tTP_PROTO(struct sock *sk),\n\n\tTP_ARGS(sk)\n);\n\nDEFINE_EVENT(tcp_event_sk, tcp_destroy_sock,\n\n\tTP_PROTO(struct sock *sk),\n\n\tTP_ARGS(sk)\n);\n\nDEFINE_EVENT(tcp_event_sk, tcp_rcv_space_adjust,\n\n\tTP_PROTO(struct sock *sk),\n\n\tTP_ARGS(sk)\n);\n\nTRACE_EVENT(tcp_retransmit_synack,\n\n\tTP_PROTO(const struct sock *sk, const struct request_sock *req),\n\n\tTP_ARGS(sk, req),\n\n\tTP_STRUCT__entry(\n\t\t__field(const void *, skaddr)\n\t\t__field(const void *, req)\n\t\t__field(__u16, sport)\n\t\t__field(__u16, dport)\n\t\t__field(__u16, family)\n\t\t__array(__u8, saddr, 4)\n\t\t__array(__u8, daddr, 4)\n\t\t__array(__u8, saddr_v6, 16)\n\t\t__array(__u8, daddr_v6, 16)\n\t),\n\n\tTP_fast_assign(\n\t\tstruct inet_request_sock *ireq = inet_rsk(req);\n\t\t__be32 *p32;\n\n\t\t__entry->skaddr = sk;\n\t\t__entry->req = req;\n\n\t\t__entry->sport = ireq->ir_num;\n\t\t__entry->dport = ntohs(ireq->ir_rmt_port);\n\t\t__entry->family = sk->sk_family;\n\n\t\tp32 = (__be32 *) __entry->saddr;\n\t\t*p32 = ireq->ir_loc_addr;\n\n\t\tp32 = (__be32 *) __entry->daddr;\n\t\t*p32 = ireq->ir_rmt_addr;\n\n\t\tTP_STORE_ADDRS(__entry, ireq->ir_loc_addr, ireq->ir_rmt_addr,\n\t\t\t      ireq->ir_v6_loc_addr, ireq->ir_v6_rmt_addr);\n\t),\n\n\tTP_printk(\"family=%s sport=%hu dport=%hu saddr=%pI4 daddr=%pI4 saddrv6=%pI6c daddrv6=%pI6c\",\n\t\t  show_family_name(__entry->family),\n\t\t  __entry->sport, __entry->dport,\n\t\t  __entry->saddr, __entry->daddr,\n\t\t  __entry->saddr_v6, __entry->daddr_v6)\n);\n\n#include <trace/events/net_probe_common.h>\n\nTRACE_EVENT(tcp_probe,\n\n\tTP_PROTO(struct sock *sk, struct sk_buff *skb),\n\n\tTP_ARGS(sk, skb),\n\n\tTP_STRUCT__entry(\n\t\t \n\t\t__array(__u8, saddr, sizeof(struct sockaddr_in6))\n\t\t__array(__u8, daddr, sizeof(struct sockaddr_in6))\n\t\t__field(__u16, sport)\n\t\t__field(__u16, dport)\n\t\t__field(__u16, family)\n\t\t__field(__u32, mark)\n\t\t__field(__u16, data_len)\n\t\t__field(__u32, snd_nxt)\n\t\t__field(__u32, snd_una)\n\t\t__field(__u32, snd_cwnd)\n\t\t__field(__u32, ssthresh)\n\t\t__field(__u32, snd_wnd)\n\t\t__field(__u32, srtt)\n\t\t__field(__u32, rcv_wnd)\n\t\t__field(__u64, sock_cookie)\n\t),\n\n\tTP_fast_assign(\n\t\tconst struct tcphdr *th = (const struct tcphdr *)skb->data;\n\t\tconst struct inet_sock *inet = inet_sk(sk);\n\t\tconst struct tcp_sock *tp = tcp_sk(sk);\n\n\t\tmemset(__entry->saddr, 0, sizeof(struct sockaddr_in6));\n\t\tmemset(__entry->daddr, 0, sizeof(struct sockaddr_in6));\n\n\t\tTP_STORE_ADDR_PORTS(__entry, inet, sk);\n\n\t\t \n\t\t__entry->sport = ntohs(inet->inet_sport);\n\t\t__entry->dport = ntohs(inet->inet_dport);\n\t\t__entry->mark = skb->mark;\n\t\t__entry->family = sk->sk_family;\n\n\t\t__entry->data_len = skb->len - __tcp_hdrlen(th);\n\t\t__entry->snd_nxt = tp->snd_nxt;\n\t\t__entry->snd_una = tp->snd_una;\n\t\t__entry->snd_cwnd = tcp_snd_cwnd(tp);\n\t\t__entry->snd_wnd = tp->snd_wnd;\n\t\t__entry->rcv_wnd = tp->rcv_wnd;\n\t\t__entry->ssthresh = tcp_current_ssthresh(sk);\n\t\t__entry->srtt = tp->srtt_us >> 3;\n\t\t__entry->sock_cookie = sock_gen_cookie(sk);\n\t),\n\n\tTP_printk(\"family=%s src=%pISpc dest=%pISpc mark=%#x data_len=%d snd_nxt=%#x snd_una=%#x snd_cwnd=%u ssthresh=%u snd_wnd=%u srtt=%u rcv_wnd=%u sock_cookie=%llx\",\n\t\t  show_family_name(__entry->family),\n\t\t  __entry->saddr, __entry->daddr, __entry->mark,\n\t\t  __entry->data_len, __entry->snd_nxt, __entry->snd_una,\n\t\t  __entry->snd_cwnd, __entry->ssthresh, __entry->snd_wnd,\n\t\t  __entry->srtt, __entry->rcv_wnd, __entry->sock_cookie)\n);\n\n#define TP_STORE_ADDR_PORTS_SKB_V4(__entry, skb)\t\t\t\\\n\tdo {\t\t\t\t\t\t\t\t\\\n\t\tconst struct tcphdr *th = (const struct tcphdr *)skb->data; \\\n\t\tstruct sockaddr_in *v4 = (void *)__entry->saddr;\t\\\n\t\t\t\t\t\t\t\t\t\\\n\t\tv4->sin_family = AF_INET;\t\t\t\t\\\n\t\tv4->sin_port = th->source;\t\t\t\t\\\n\t\tv4->sin_addr.s_addr = ip_hdr(skb)->saddr;\t\t\\\n\t\tv4 = (void *)__entry->daddr;\t\t\t\t\\\n\t\tv4->sin_family = AF_INET;\t\t\t\t\\\n\t\tv4->sin_port = th->dest;\t\t\t\t\\\n\t\tv4->sin_addr.s_addr = ip_hdr(skb)->daddr;\t\t\\\n\t} while (0)\n\n#if IS_ENABLED(CONFIG_IPV6)\n\n#define TP_STORE_ADDR_PORTS_SKB(__entry, skb)\t\t\t\t\\\n\tdo {\t\t\t\t\t\t\t\t\\\n\t\tconst struct iphdr *iph = ip_hdr(skb);\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\t\tif (iph->version == 6) {\t\t\t\t\\\n\t\t\tconst struct tcphdr *th = (const struct tcphdr *)skb->data; \\\n\t\t\tstruct sockaddr_in6 *v6 = (void *)__entry->saddr; \\\n\t\t\t\t\t\t\t\t\t\\\n\t\t\tv6->sin6_family = AF_INET6;\t\t\t\\\n\t\t\tv6->sin6_port = th->source;\t\t\t\\\n\t\t\tv6->sin6_addr = ipv6_hdr(skb)->saddr;\t\t\\\n\t\t\tv6 = (void *)__entry->daddr;\t\t\t\\\n\t\t\tv6->sin6_family = AF_INET6;\t\t\t\\\n\t\t\tv6->sin6_port = th->dest;\t\t\t\\\n\t\t\tv6->sin6_addr = ipv6_hdr(skb)->daddr;\t\t\\\n\t\t} else\t\t\t\t\t\t\t\\\n\t\t\tTP_STORE_ADDR_PORTS_SKB_V4(__entry, skb);\t\\\n\t} while (0)\n\n#else\n\n#define TP_STORE_ADDR_PORTS_SKB(__entry, skb)\t\t\\\n\tTP_STORE_ADDR_PORTS_SKB_V4(__entry, skb)\n\n#endif\n\n \nDECLARE_EVENT_CLASS(tcp_event_skb,\n\n\tTP_PROTO(const struct sk_buff *skb),\n\n\tTP_ARGS(skb),\n\n\tTP_STRUCT__entry(\n\t\t__field(const void *, skbaddr)\n\t\t__array(__u8, saddr, sizeof(struct sockaddr_in6))\n\t\t__array(__u8, daddr, sizeof(struct sockaddr_in6))\n\t),\n\n\tTP_fast_assign(\n\t\t__entry->skbaddr = skb;\n\n\t\tmemset(__entry->saddr, 0, sizeof(struct sockaddr_in6));\n\t\tmemset(__entry->daddr, 0, sizeof(struct sockaddr_in6));\n\n\t\tTP_STORE_ADDR_PORTS_SKB(__entry, skb);\n\t),\n\n\tTP_printk(\"src=%pISpc dest=%pISpc\", __entry->saddr, __entry->daddr)\n);\n\nDEFINE_EVENT(tcp_event_skb, tcp_bad_csum,\n\n\tTP_PROTO(const struct sk_buff *skb),\n\n\tTP_ARGS(skb)\n);\n\nTRACE_EVENT(tcp_cong_state_set,\n\n\tTP_PROTO(struct sock *sk, const u8 ca_state),\n\n\tTP_ARGS(sk, ca_state),\n\n\tTP_STRUCT__entry(\n\t\t__field(const void *, skaddr)\n\t\t__field(__u16, sport)\n\t\t__field(__u16, dport)\n\t\t__field(__u16, family)\n\t\t__array(__u8, saddr, 4)\n\t\t__array(__u8, daddr, 4)\n\t\t__array(__u8, saddr_v6, 16)\n\t\t__array(__u8, daddr_v6, 16)\n\t\t__field(__u8, cong_state)\n\t),\n\n\tTP_fast_assign(\n\t\tstruct inet_sock *inet = inet_sk(sk);\n\t\t__be32 *p32;\n\n\t\t__entry->skaddr = sk;\n\n\t\t__entry->sport = ntohs(inet->inet_sport);\n\t\t__entry->dport = ntohs(inet->inet_dport);\n\t\t__entry->family = sk->sk_family;\n\n\t\tp32 = (__be32 *) __entry->saddr;\n\t\t*p32 = inet->inet_saddr;\n\n\t\tp32 = (__be32 *) __entry->daddr;\n\t\t*p32 =  inet->inet_daddr;\n\n\t\tTP_STORE_ADDRS(__entry, inet->inet_saddr, inet->inet_daddr,\n\t\t\t   sk->sk_v6_rcv_saddr, sk->sk_v6_daddr);\n\n\t\t__entry->cong_state = ca_state;\n\t),\n\n\tTP_printk(\"family=%s sport=%hu dport=%hu saddr=%pI4 daddr=%pI4 saddrv6=%pI6c daddrv6=%pI6c cong_state=%u\",\n\t\t  show_family_name(__entry->family),\n\t\t  __entry->sport, __entry->dport,\n\t\t  __entry->saddr, __entry->daddr,\n\t\t  __entry->saddr_v6, __entry->daddr_v6,\n\t\t  __entry->cong_state)\n);\n\n#endif  \n\n \n#include <trace/define_trace.h>\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}