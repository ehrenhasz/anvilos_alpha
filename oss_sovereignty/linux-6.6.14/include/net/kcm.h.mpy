{
  "module_name": "kcm.h",
  "hash_id": "d9899ae83c442340191a5e9d0125db14e94bebfb4ed57e800188503fc30a249f",
  "original_prompt": "Ingested from linux-6.6.14/include/net/kcm.h",
  "human_readable_source": " \n \n\n#ifndef __NET_KCM_H_\n#define __NET_KCM_H_\n\n#include <linux/skbuff.h>\n#include <net/sock.h>\n#include <net/strparser.h>\n#include <uapi/linux/kcm.h>\n\nextern unsigned int kcm_net_id;\n\n#define KCM_STATS_ADD(stat, count) ((stat) += (count))\n#define KCM_STATS_INCR(stat) ((stat)++)\n\nstruct kcm_psock_stats {\n\tunsigned long long tx_msgs;\n\tunsigned long long tx_bytes;\n\tunsigned long long reserved;\n\tunsigned long long unreserved;\n\tunsigned int tx_aborts;\n};\n\nstruct kcm_mux_stats {\n\tunsigned long long rx_msgs;\n\tunsigned long long rx_bytes;\n\tunsigned long long tx_msgs;\n\tunsigned long long tx_bytes;\n\tunsigned int rx_ready_drops;\n\tunsigned int tx_retries;\n\tunsigned int psock_attach;\n\tunsigned int psock_unattach_rsvd;\n\tunsigned int psock_unattach;\n};\n\nstruct kcm_stats {\n\tunsigned long long rx_msgs;\n\tunsigned long long rx_bytes;\n\tunsigned long long tx_msgs;\n\tunsigned long long tx_bytes;\n};\n\nstruct kcm_tx_msg {\n\tunsigned int sent;\n\tunsigned int frag_offset;\n\tunsigned int msg_flags;\n\tbool started_tx;\n\tstruct sk_buff *frag_skb;\n\tstruct sk_buff *last_skb;\n};\n\n \nstruct kcm_sock {\n\tstruct sock sk;\n\tstruct kcm_mux *mux;\n\tstruct list_head kcm_sock_list;\n\tint index;\n\tu32 done : 1;\n\tstruct work_struct done_work;\n\n\tstruct kcm_stats stats;\n\n\t \n\tstruct kcm_psock *tx_psock;\n\tstruct work_struct tx_work;\n\tstruct list_head wait_psock_list;\n\tstruct sk_buff *seq_skb;\n\tu32 tx_stopped : 1;\n\n\t \n\tbool tx_wait;\n\tbool tx_wait_more;\n\n\t \n\tstruct kcm_psock *rx_psock;\n\tstruct list_head wait_rx_list;  \n\tbool rx_wait;\n\tu32 rx_disabled : 1;\n};\n\nstruct bpf_prog;\n\n \nstruct kcm_psock {\n\tstruct sock *sk;\n\tstruct strparser strp;\n\tstruct kcm_mux *mux;\n\tint index;\n\n\tu32 tx_stopped : 1;\n\tu32 done : 1;\n\tu32 unattaching : 1;\n\n\tvoid (*save_state_change)(struct sock *sk);\n\tvoid (*save_data_ready)(struct sock *sk);\n\tvoid (*save_write_space)(struct sock *sk);\n\n\tstruct list_head psock_list;\n\n\tstruct kcm_psock_stats stats;\n\n\t \n\tstruct list_head psock_ready_list;\n\tstruct bpf_prog *bpf_prog;\n\tstruct kcm_sock *rx_kcm;\n\tunsigned long long saved_rx_bytes;\n\tunsigned long long saved_rx_msgs;\n\tstruct sk_buff *ready_rx_msg;\n\n\t \n\tstruct kcm_sock *tx_kcm;\n\tstruct list_head psock_avail_list;\n\tunsigned long long saved_tx_bytes;\n\tunsigned long long saved_tx_msgs;\n};\n\n \nstruct kcm_net {\n\tstruct mutex mutex;\n\tstruct kcm_psock_stats aggregate_psock_stats;\n\tstruct kcm_mux_stats aggregate_mux_stats;\n\tstruct strp_aggr_stats aggregate_strp_stats;\n\tstruct list_head mux_list;\n\tint count;\n};\n\n \nstruct kcm_mux {\n\tstruct list_head kcm_mux_list;\n\tstruct rcu_head rcu;\n\tstruct kcm_net *knet;\n\n\tstruct list_head kcm_socks;\t \n\tint kcm_socks_cnt;\t\t \n\tstruct list_head psocks;\t \n\tint psocks_cnt;\t\t \n\n\tstruct kcm_mux_stats stats;\n\tstruct kcm_psock_stats aggregate_psock_stats;\n\tstruct strp_aggr_stats aggregate_strp_stats;\n\n\t \n\tspinlock_t rx_lock ____cacheline_aligned_in_smp;\n\tstruct list_head kcm_rx_waiters;  \n\tstruct list_head psocks_ready;\t \n\tstruct sk_buff_head rx_hold_queue;\n\n\t \n\tspinlock_t  lock ____cacheline_aligned_in_smp;\t \n\tstruct list_head psocks_avail;\t \n\tstruct list_head kcm_tx_waiters;  \n};\n\n#ifdef CONFIG_PROC_FS\nint kcm_proc_init(void);\nvoid kcm_proc_exit(void);\n#else\nstatic inline int kcm_proc_init(void) { return 0; }\nstatic inline void kcm_proc_exit(void) { }\n#endif\n\nstatic inline void aggregate_psock_stats(struct kcm_psock_stats *stats,\n\t\t\t\t\t struct kcm_psock_stats *agg_stats)\n{\n\t \n\n#define SAVE_PSOCK_STATS(_stat) (agg_stats->_stat += stats->_stat)\n\tSAVE_PSOCK_STATS(tx_msgs);\n\tSAVE_PSOCK_STATS(tx_bytes);\n\tSAVE_PSOCK_STATS(reserved);\n\tSAVE_PSOCK_STATS(unreserved);\n\tSAVE_PSOCK_STATS(tx_aborts);\n#undef SAVE_PSOCK_STATS\n}\n\nstatic inline void aggregate_mux_stats(struct kcm_mux_stats *stats,\n\t\t\t\t       struct kcm_mux_stats *agg_stats)\n{\n\t \n\n#define SAVE_MUX_STATS(_stat) (agg_stats->_stat += stats->_stat)\n\tSAVE_MUX_STATS(rx_msgs);\n\tSAVE_MUX_STATS(rx_bytes);\n\tSAVE_MUX_STATS(tx_msgs);\n\tSAVE_MUX_STATS(tx_bytes);\n\tSAVE_MUX_STATS(rx_ready_drops);\n\tSAVE_MUX_STATS(psock_attach);\n\tSAVE_MUX_STATS(psock_unattach_rsvd);\n\tSAVE_MUX_STATS(psock_unattach);\n#undef SAVE_MUX_STATS\n}\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}