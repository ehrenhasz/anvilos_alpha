{
  "module_name": "tc_police.h",
  "hash_id": "d59abecae49dfd0d4dd9c53940ae92904bff0a84c68483f18a5a139ab8f700aa",
  "original_prompt": "Ingested from linux-6.6.14/include/net/tc_act/tc_police.h",
  "human_readable_source": " \n#ifndef __NET_TC_POLICE_H\n#define __NET_TC_POLICE_H\n\n#include <net/act_api.h>\n\nstruct tcf_police_params {\n\tint\t\t\ttcfp_result;\n\tu32\t\t\ttcfp_ewma_rate;\n\ts64\t\t\ttcfp_burst;\n\tu32\t\t\ttcfp_mtu;\n\ts64\t\t\ttcfp_mtu_ptoks;\n\ts64\t\t\ttcfp_pkt_burst;\n\tstruct psched_ratecfg\trate;\n\tbool\t\t\trate_present;\n\tstruct psched_ratecfg\tpeak;\n\tbool\t\t\tpeak_present;\n\tstruct psched_pktrate\tppsrate;\n\tbool\t\t\tpps_present;\n\tstruct rcu_head rcu;\n};\n\nstruct tcf_police {\n\tstruct tc_action\tcommon;\n\tstruct tcf_police_params __rcu *params;\n\n\tspinlock_t\t\ttcfp_lock ____cacheline_aligned_in_smp;\n\ts64\t\t\ttcfp_toks;\n\ts64\t\t\ttcfp_ptoks;\n\ts64\t\t\ttcfp_pkttoks;\n\ts64\t\t\ttcfp_t_c;\n};\n\n#define to_police(pc) ((struct tcf_police *)pc)\n\n \nstruct tc_police_compat {\n\tu32\t\t\tindex;\n\tint\t\t\taction;\n\tu32\t\t\tlimit;\n\tu32\t\t\tburst;\n\tu32\t\t\tmtu;\n\tstruct tc_ratespec\trate;\n\tstruct tc_ratespec\tpeakrate;\n};\n\nstatic inline bool is_tcf_police(const struct tc_action *act)\n{\n#ifdef CONFIG_NET_CLS_ACT\n\tif (act->ops && act->ops->id == TCA_ID_POLICE)\n\t\treturn true;\n#endif\n\treturn false;\n}\n\nstatic inline u64 tcf_police_rate_bytes_ps(const struct tc_action *act)\n{\n\tstruct tcf_police *police = to_police(act);\n\tstruct tcf_police_params *params;\n\n\tparams = rcu_dereference_protected(police->params,\n\t\t\t\t\t   lockdep_is_held(&police->tcf_lock));\n\treturn params->rate.rate_bytes_ps;\n}\n\nstatic inline u32 tcf_police_burst(const struct tc_action *act)\n{\n\tstruct tcf_police *police = to_police(act);\n\tstruct tcf_police_params *params;\n\tu32 burst;\n\n\tparams = rcu_dereference_protected(police->params,\n\t\t\t\t\t   lockdep_is_held(&police->tcf_lock));\n\n\t \n\tburst = div_u64(params->tcfp_burst * params->rate.rate_bytes_ps,\n\t\t\tNSEC_PER_SEC);\n\n\treturn burst;\n}\n\nstatic inline u64 tcf_police_rate_pkt_ps(const struct tc_action *act)\n{\n\tstruct tcf_police *police = to_police(act);\n\tstruct tcf_police_params *params;\n\n\tparams = rcu_dereference_protected(police->params,\n\t\t\t\t\t   lockdep_is_held(&police->tcf_lock));\n\treturn params->ppsrate.rate_pkts_ps;\n}\n\nstatic inline u32 tcf_police_burst_pkt(const struct tc_action *act)\n{\n\tstruct tcf_police *police = to_police(act);\n\tstruct tcf_police_params *params;\n\tu32 burst;\n\n\tparams = rcu_dereference_protected(police->params,\n\t\t\t\t\t   lockdep_is_held(&police->tcf_lock));\n\n\t \n\tburst = div_u64(params->tcfp_pkt_burst * params->ppsrate.rate_pkts_ps,\n\t\t\tNSEC_PER_SEC);\n\n\treturn burst;\n}\n\nstatic inline u32 tcf_police_tcfp_mtu(const struct tc_action *act)\n{\n\tstruct tcf_police *police = to_police(act);\n\tstruct tcf_police_params *params;\n\n\tparams = rcu_dereference_protected(police->params,\n\t\t\t\t\t   lockdep_is_held(&police->tcf_lock));\n\treturn params->tcfp_mtu;\n}\n\nstatic inline u64 tcf_police_peakrate_bytes_ps(const struct tc_action *act)\n{\n\tstruct tcf_police *police = to_police(act);\n\tstruct tcf_police_params *params;\n\n\tparams = rcu_dereference_protected(police->params,\n\t\t\t\t\t   lockdep_is_held(&police->tcf_lock));\n\treturn params->peak.rate_bytes_ps;\n}\n\nstatic inline u32 tcf_police_tcfp_ewma_rate(const struct tc_action *act)\n{\n\tstruct tcf_police *police = to_police(act);\n\tstruct tcf_police_params *params;\n\n\tparams = rcu_dereference_protected(police->params,\n\t\t\t\t\t   lockdep_is_held(&police->tcf_lock));\n\treturn params->tcfp_ewma_rate;\n}\n\nstatic inline u16 tcf_police_rate_overhead(const struct tc_action *act)\n{\n\tstruct tcf_police *police = to_police(act);\n\tstruct tcf_police_params *params;\n\n\tparams = rcu_dereference_protected(police->params,\n\t\t\t\t\t   lockdep_is_held(&police->tcf_lock));\n\treturn params->rate.overhead;\n}\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}