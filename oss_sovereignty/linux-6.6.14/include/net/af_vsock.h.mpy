{
  "module_name": "af_vsock.h",
  "hash_id": "f11c8902ab265433443ab8bd1e133a1cb4d372e80a045b6bde1c9978f83e9619",
  "original_prompt": "Ingested from linux-6.6.14/include/net/af_vsock.h",
  "human_readable_source": " \n \n\n#ifndef __AF_VSOCK_H__\n#define __AF_VSOCK_H__\n\n#include <linux/kernel.h>\n#include <linux/workqueue.h>\n#include <net/sock.h>\n#include <uapi/linux/vm_sockets.h>\n\n#include \"vsock_addr.h\"\n\n#define LAST_RESERVED_PORT 1023\n\n#define VSOCK_HASH_SIZE         251\nextern struct list_head vsock_bind_table[VSOCK_HASH_SIZE + 1];\nextern struct list_head vsock_connected_table[VSOCK_HASH_SIZE];\nextern spinlock_t vsock_table_lock;\n\n#define vsock_sk(__sk)    ((struct vsock_sock *)__sk)\n#define sk_vsock(__vsk)   (&(__vsk)->sk)\n\nstruct vsock_sock {\n\t \n\tstruct sock sk;\n\tconst struct vsock_transport *transport;\n\tstruct sockaddr_vm local_addr;\n\tstruct sockaddr_vm remote_addr;\n\t \n\tstruct list_head bound_table;\n\tstruct list_head connected_table;\n\t \n\tbool trusted;\n\tbool cached_peer_allow_dgram;\t \n\tu32 cached_peer;   \n\tconst struct cred *owner;\n\t \n\tlong connect_timeout;\n\t \n\tstruct sock *listener;\n\t \n\tstruct list_head pending_links;\n\tstruct list_head accept_queue;\n\tbool rejected;\n\tstruct delayed_work connect_work;\n\tstruct delayed_work pending_work;\n\tstruct delayed_work close_work;\n\tbool close_work_scheduled;\n\tu32 peer_shutdown;\n\tbool sent_request;\n\tbool ignore_connecting_rst;\n\n\t \n\tu64 buffer_size;\n\tu64 buffer_min_size;\n\tu64 buffer_max_size;\n\n\t \n\tvoid *trans;\n};\n\ns64 vsock_connectible_has_data(struct vsock_sock *vsk);\ns64 vsock_stream_has_data(struct vsock_sock *vsk);\ns64 vsock_stream_has_space(struct vsock_sock *vsk);\nstruct sock *vsock_create_connected(struct sock *parent);\nvoid vsock_data_ready(struct sock *sk);\n\n \n\nstruct vsock_transport_recv_notify_data {\n\tu64 data1;  \n\tu64 data2;  \n\tbool notify_on_block;\n};\n\nstruct vsock_transport_send_notify_data {\n\tu64 data1;  \n\tu64 data2;  \n};\n\n \n \n#define VSOCK_TRANSPORT_F_H2G\t\t0x00000001\n \n#define VSOCK_TRANSPORT_F_G2H\t\t0x00000002\n \n#define VSOCK_TRANSPORT_F_DGRAM\t\t0x00000004\n \n#define VSOCK_TRANSPORT_F_LOCAL\t\t0x00000008\n\nstruct vsock_transport {\n\tstruct module *module;\n\n\t \n\tint (*init)(struct vsock_sock *, struct vsock_sock *);\n\tvoid (*destruct)(struct vsock_sock *);\n\tvoid (*release)(struct vsock_sock *);\n\n\t \n\tint (*cancel_pkt)(struct vsock_sock *vsk);\n\n\t \n\tint (*connect)(struct vsock_sock *);\n\n\t \n\tint (*dgram_bind)(struct vsock_sock *, struct sockaddr_vm *);\n\tint (*dgram_dequeue)(struct vsock_sock *vsk, struct msghdr *msg,\n\t\t\t     size_t len, int flags);\n\tint (*dgram_enqueue)(struct vsock_sock *, struct sockaddr_vm *,\n\t\t\t     struct msghdr *, size_t len);\n\tbool (*dgram_allow)(u32 cid, u32 port);\n\n\t \n\t \n\tssize_t (*stream_dequeue)(struct vsock_sock *, struct msghdr *,\n\t\t\t\t  size_t len, int flags);\n\tssize_t (*stream_enqueue)(struct vsock_sock *, struct msghdr *,\n\t\t\t\t  size_t len);\n\ts64 (*stream_has_data)(struct vsock_sock *);\n\ts64 (*stream_has_space)(struct vsock_sock *);\n\tu64 (*stream_rcvhiwat)(struct vsock_sock *);\n\tbool (*stream_is_active)(struct vsock_sock *);\n\tbool (*stream_allow)(u32 cid, u32 port);\n\n\t \n\tssize_t (*seqpacket_dequeue)(struct vsock_sock *vsk, struct msghdr *msg,\n\t\t\t\t     int flags);\n\tint (*seqpacket_enqueue)(struct vsock_sock *vsk, struct msghdr *msg,\n\t\t\t\t size_t len);\n\tbool (*seqpacket_allow)(u32 remote_cid);\n\tu32 (*seqpacket_has_data)(struct vsock_sock *vsk);\n\n\t \n\tint (*notify_poll_in)(struct vsock_sock *, size_t, bool *);\n\tint (*notify_poll_out)(struct vsock_sock *, size_t, bool *);\n\tint (*notify_recv_init)(struct vsock_sock *, size_t,\n\t\tstruct vsock_transport_recv_notify_data *);\n\tint (*notify_recv_pre_block)(struct vsock_sock *, size_t,\n\t\tstruct vsock_transport_recv_notify_data *);\n\tint (*notify_recv_pre_dequeue)(struct vsock_sock *, size_t,\n\t\tstruct vsock_transport_recv_notify_data *);\n\tint (*notify_recv_post_dequeue)(struct vsock_sock *, size_t,\n\t\tssize_t, bool, struct vsock_transport_recv_notify_data *);\n\tint (*notify_send_init)(struct vsock_sock *,\n\t\tstruct vsock_transport_send_notify_data *);\n\tint (*notify_send_pre_block)(struct vsock_sock *,\n\t\tstruct vsock_transport_send_notify_data *);\n\tint (*notify_send_pre_enqueue)(struct vsock_sock *,\n\t\tstruct vsock_transport_send_notify_data *);\n\tint (*notify_send_post_enqueue)(struct vsock_sock *, ssize_t,\n\t\tstruct vsock_transport_send_notify_data *);\n\t \n\tvoid (*notify_buffer_size)(struct vsock_sock *, u64 *);\n\tint (*notify_set_rcvlowat)(struct vsock_sock *vsk, int val);\n\n\t \n\tint (*shutdown)(struct vsock_sock *, int);\n\n\t \n\tu32 (*get_local_cid)(void);\n\n\t \n\tint (*read_skb)(struct vsock_sock *, skb_read_actor_t);\n};\n\n \n\nint vsock_core_register(const struct vsock_transport *t, int features);\nvoid vsock_core_unregister(const struct vsock_transport *t);\n\n \nconst struct vsock_transport *vsock_core_get_transport(struct vsock_sock *vsk);\n\n \n\n \nstatic inline bool __vsock_in_bound_table(struct vsock_sock *vsk)\n{\n\treturn !list_empty(&vsk->bound_table);\n}\n\n \nstatic inline bool __vsock_in_connected_table(struct vsock_sock *vsk)\n{\n\treturn !list_empty(&vsk->connected_table);\n}\n\nvoid vsock_add_pending(struct sock *listener, struct sock *pending);\nvoid vsock_remove_pending(struct sock *listener, struct sock *pending);\nvoid vsock_enqueue_accept(struct sock *listener, struct sock *connected);\nvoid vsock_insert_connected(struct vsock_sock *vsk);\nvoid vsock_remove_bound(struct vsock_sock *vsk);\nvoid vsock_remove_connected(struct vsock_sock *vsk);\nstruct sock *vsock_find_bound_socket(struct sockaddr_vm *addr);\nstruct sock *vsock_find_connected_socket(struct sockaddr_vm *src,\n\t\t\t\t\t struct sockaddr_vm *dst);\nvoid vsock_remove_sock(struct vsock_sock *vsk);\nvoid vsock_for_each_connected_socket(struct vsock_transport *transport,\n\t\t\t\t     void (*fn)(struct sock *sk));\nint vsock_assign_transport(struct vsock_sock *vsk, struct vsock_sock *psk);\nbool vsock_find_cid(unsigned int cid);\n\n \n\nstruct vsock_tap {\n\tstruct net_device *dev;\n\tstruct module *module;\n\tstruct list_head list;\n};\n\nint vsock_add_tap(struct vsock_tap *vt);\nint vsock_remove_tap(struct vsock_tap *vt);\nvoid vsock_deliver_tap(struct sk_buff *build_skb(void *opaque), void *opaque);\nint vsock_connectible_recvmsg(struct socket *sock, struct msghdr *msg, size_t len,\n\t\t\t      int flags);\nint vsock_dgram_recvmsg(struct socket *sock, struct msghdr *msg,\n\t\t\tsize_t len, int flags);\n\n#ifdef CONFIG_BPF_SYSCALL\nextern struct proto vsock_proto;\nint vsock_bpf_update_proto(struct sock *sk, struct sk_psock *psock, bool restore);\nvoid __init vsock_bpf_build_proto(void);\n#else\nstatic inline void __init vsock_bpf_build_proto(void)\n{}\n#endif\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}