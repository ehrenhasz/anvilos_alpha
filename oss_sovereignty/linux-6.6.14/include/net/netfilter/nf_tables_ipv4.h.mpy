{
  "module_name": "nf_tables_ipv4.h",
  "hash_id": "67113f568a98b4016c2cc20276d4662c05e2754e09065d63cd4877467a78c4f6",
  "original_prompt": "Ingested from linux-6.6.14/include/net/netfilter/nf_tables_ipv4.h",
  "human_readable_source": " \n#ifndef _NF_TABLES_IPV4_H_\n#define _NF_TABLES_IPV4_H_\n\n#include <net/netfilter/nf_tables.h>\n#include <net/ip.h>\n\nstatic inline void nft_set_pktinfo_ipv4(struct nft_pktinfo *pkt)\n{\n\tstruct iphdr *ip;\n\n\tip = ip_hdr(pkt->skb);\n\tpkt->flags = NFT_PKTINFO_L4PROTO;\n\tpkt->tprot = ip->protocol;\n\tpkt->thoff = ip_hdrlen(pkt->skb);\n\tpkt->fragoff = ntohs(ip->frag_off) & IP_OFFSET;\n}\n\nstatic inline int __nft_set_pktinfo_ipv4_validate(struct nft_pktinfo *pkt)\n{\n\tstruct iphdr *iph, _iph;\n\tu32 len, thoff;\n\n\tiph = skb_header_pointer(pkt->skb, skb_network_offset(pkt->skb),\n\t\t\t\t sizeof(*iph), &_iph);\n\tif (!iph)\n\t\treturn -1;\n\n\tif (iph->ihl < 5 || iph->version != 4)\n\t\treturn -1;\n\n\tlen = iph_totlen(pkt->skb, iph);\n\tthoff = skb_network_offset(pkt->skb) + (iph->ihl * 4);\n\tif (pkt->skb->len < len)\n\t\treturn -1;\n\telse if (len < thoff)\n\t\treturn -1;\n\telse if (thoff < sizeof(*iph))\n\t\treturn -1;\n\n\tpkt->flags = NFT_PKTINFO_L4PROTO;\n\tpkt->tprot = iph->protocol;\n\tpkt->thoff = thoff;\n\tpkt->fragoff = ntohs(iph->frag_off) & IP_OFFSET;\n\n\treturn 0;\n}\n\nstatic inline void nft_set_pktinfo_ipv4_validate(struct nft_pktinfo *pkt)\n{\n\tif (__nft_set_pktinfo_ipv4_validate(pkt) < 0)\n\t\tnft_set_pktinfo_unspec(pkt);\n}\n\nstatic inline int nft_set_pktinfo_ipv4_ingress(struct nft_pktinfo *pkt)\n{\n\tstruct iphdr *iph;\n\tu32 len, thoff;\n\n\tif (!pskb_may_pull(pkt->skb, sizeof(*iph)))\n\t\treturn -1;\n\n\tiph = ip_hdr(pkt->skb);\n\tif (iph->ihl < 5 || iph->version != 4)\n\t\tgoto inhdr_error;\n\n\tlen = iph_totlen(pkt->skb, iph);\n\tthoff = iph->ihl * 4;\n\tif (pkt->skb->len < len) {\n\t\t__IP_INC_STATS(nft_net(pkt), IPSTATS_MIB_INTRUNCATEDPKTS);\n\t\treturn -1;\n\t} else if (len < thoff) {\n\t\tgoto inhdr_error;\n\t} else if (thoff < sizeof(*iph)) {\n\t\treturn -1;\n\t}\n\n\tpkt->flags = NFT_PKTINFO_L4PROTO;\n\tpkt->tprot = iph->protocol;\n\tpkt->thoff = thoff;\n\tpkt->fragoff = ntohs(iph->frag_off) & IP_OFFSET;\n\n\treturn 0;\n\ninhdr_error:\n\t__IP_INC_STATS(nft_net(pkt), IPSTATS_MIB_INHDRERRORS);\n\treturn -1;\n}\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}