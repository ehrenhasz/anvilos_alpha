{
  "module_name": "l2cap.h",
  "hash_id": "0690cf50efa38398058f84994fbcd7b03a6841fc855584f6ec69c91aefc84fdb",
  "original_prompt": "Ingested from linux-6.6.14/include/net/bluetooth/l2cap.h",
  "human_readable_source": " \n\n#ifndef __L2CAP_H\n#define __L2CAP_H\n\n#include <asm/unaligned.h>\n#include <linux/atomic.h>\n\n \n#define L2CAP_DEFAULT_MTU\t\t672\n#define L2CAP_DEFAULT_MIN_MTU\t\t48\n#define L2CAP_DEFAULT_FLUSH_TO\t\t0xFFFF\n#define L2CAP_EFS_DEFAULT_FLUSH_TO\t0xFFFFFFFF\n#define L2CAP_DEFAULT_TX_WINDOW\t\t63\n#define L2CAP_DEFAULT_EXT_WINDOW\t0x3FFF\n#define L2CAP_DEFAULT_MAX_TX\t\t3\n#define L2CAP_DEFAULT_RETRANS_TO\t2000     \n#define L2CAP_DEFAULT_MONITOR_TO\t12000    \n#define L2CAP_DEFAULT_MAX_PDU_SIZE\t1492     \n#define L2CAP_DEFAULT_ACK_TO\t\t200\n#define L2CAP_DEFAULT_MAX_SDU_SIZE\t0xFFFF\n#define L2CAP_DEFAULT_SDU_ITIME\t\t0xFFFFFFFF\n#define L2CAP_DEFAULT_ACC_LAT\t\t0xFFFFFFFF\n#define L2CAP_BREDR_MAX_PAYLOAD\t\t1019     \n#define L2CAP_LE_MIN_MTU\t\t23\n#define L2CAP_ECRED_CONN_SCID_MAX\t5\n\n#define L2CAP_DISC_TIMEOUT\t\tmsecs_to_jiffies(100)\n#define L2CAP_DISC_REJ_TIMEOUT\t\tmsecs_to_jiffies(5000)\n#define L2CAP_ENC_TIMEOUT\t\tmsecs_to_jiffies(5000)\n#define L2CAP_CONN_TIMEOUT\t\tmsecs_to_jiffies(40000)\n#define L2CAP_INFO_TIMEOUT\t\tmsecs_to_jiffies(4000)\n#define L2CAP_MOVE_TIMEOUT\t\tmsecs_to_jiffies(4000)\n#define L2CAP_MOVE_ERTX_TIMEOUT\t\tmsecs_to_jiffies(60000)\n#define L2CAP_WAIT_ACK_POLL_PERIOD\tmsecs_to_jiffies(200)\n#define L2CAP_WAIT_ACK_TIMEOUT\t\tmsecs_to_jiffies(10000)\n\n#define L2CAP_A2MP_DEFAULT_MTU\t\t670\n\n \nstruct sockaddr_l2 {\n\tsa_family_t\tl2_family;\n\t__le16\t\tl2_psm;\n\tbdaddr_t\tl2_bdaddr;\n\t__le16\t\tl2_cid;\n\t__u8\t\tl2_bdaddr_type;\n};\n\n \n#define L2CAP_OPTIONS\t0x01\nstruct l2cap_options {\n\t__u16 omtu;\n\t__u16 imtu;\n\t__u16 flush_to;\n\t__u8  mode;\n\t__u8  fcs;\n\t__u8  max_tx;\n\t__u16 txwin_size;\n};\n\n#define L2CAP_CONNINFO\t0x02\nstruct l2cap_conninfo {\n\t__u16 hci_handle;\n\t__u8  dev_class[3];\n};\n\n#define L2CAP_LM\t0x03\n#define L2CAP_LM_MASTER\t\t0x0001\n#define L2CAP_LM_AUTH\t\t0x0002\n#define L2CAP_LM_ENCRYPT\t0x0004\n#define L2CAP_LM_TRUSTED\t0x0008\n#define L2CAP_LM_RELIABLE\t0x0010\n#define L2CAP_LM_SECURE\t\t0x0020\n#define L2CAP_LM_FIPS\t\t0x0040\n\n \n#define L2CAP_COMMAND_REJ\t0x01\n#define L2CAP_CONN_REQ\t\t0x02\n#define L2CAP_CONN_RSP\t\t0x03\n#define L2CAP_CONF_REQ\t\t0x04\n#define L2CAP_CONF_RSP\t\t0x05\n#define L2CAP_DISCONN_REQ\t0x06\n#define L2CAP_DISCONN_RSP\t0x07\n#define L2CAP_ECHO_REQ\t\t0x08\n#define L2CAP_ECHO_RSP\t\t0x09\n#define L2CAP_INFO_REQ\t\t0x0a\n#define L2CAP_INFO_RSP\t\t0x0b\n#define L2CAP_CREATE_CHAN_REQ\t0x0c\n#define L2CAP_CREATE_CHAN_RSP\t0x0d\n#define L2CAP_MOVE_CHAN_REQ\t0x0e\n#define L2CAP_MOVE_CHAN_RSP\t0x0f\n#define L2CAP_MOVE_CHAN_CFM\t0x10\n#define L2CAP_MOVE_CHAN_CFM_RSP\t0x11\n#define L2CAP_CONN_PARAM_UPDATE_REQ\t0x12\n#define L2CAP_CONN_PARAM_UPDATE_RSP\t0x13\n#define L2CAP_LE_CONN_REQ\t0x14\n#define L2CAP_LE_CONN_RSP\t0x15\n#define L2CAP_LE_CREDITS\t0x16\n#define L2CAP_ECRED_CONN_REQ\t0x17\n#define L2CAP_ECRED_CONN_RSP\t0x18\n#define L2CAP_ECRED_RECONF_REQ\t0x19\n#define L2CAP_ECRED_RECONF_RSP\t0x1a\n\n \n#define L2CAP_FEAT_FLOWCTL\t0x00000001\n#define L2CAP_FEAT_RETRANS\t0x00000002\n#define L2CAP_FEAT_BIDIR_QOS\t0x00000004\n#define L2CAP_FEAT_ERTM\t\t0x00000008\n#define L2CAP_FEAT_STREAMING\t0x00000010\n#define L2CAP_FEAT_FCS\t\t0x00000020\n#define L2CAP_FEAT_EXT_FLOW\t0x00000040\n#define L2CAP_FEAT_FIXED_CHAN\t0x00000080\n#define L2CAP_FEAT_EXT_WINDOW\t0x00000100\n#define L2CAP_FEAT_UCD\t\t0x00000200\n\n \n#define L2CAP_FCS_NONE\t\t0x00\n#define L2CAP_FCS_CRC16\t\t0x01\n\n \n#define L2CAP_FC_SIG_BREDR\t0x02\n#define L2CAP_FC_CONNLESS\t0x04\n#define L2CAP_FC_A2MP\t\t0x08\n#define L2CAP_FC_ATT\t\t0x10\n#define L2CAP_FC_SIG_LE\t\t0x20\n#define L2CAP_FC_SMP_LE\t\t0x40\n#define L2CAP_FC_SMP_BREDR\t0x80\n\n \n#define L2CAP_CTRL_SAR\t\t\t0xC000\n#define L2CAP_CTRL_REQSEQ\t\t0x3F00\n#define L2CAP_CTRL_TXSEQ\t\t0x007E\n#define L2CAP_CTRL_SUPERVISE\t\t0x000C\n\n#define L2CAP_CTRL_RETRANS\t\t0x0080\n#define L2CAP_CTRL_FINAL\t\t0x0080\n#define L2CAP_CTRL_POLL\t\t\t0x0010\n#define L2CAP_CTRL_FRAME_TYPE\t\t0x0001  \n\n#define L2CAP_CTRL_TXSEQ_SHIFT\t\t1\n#define L2CAP_CTRL_SUPER_SHIFT\t\t2\n#define L2CAP_CTRL_POLL_SHIFT\t\t4\n#define L2CAP_CTRL_FINAL_SHIFT\t\t7\n#define L2CAP_CTRL_REQSEQ_SHIFT\t\t8\n#define L2CAP_CTRL_SAR_SHIFT\t\t14\n\n \n#define L2CAP_EXT_CTRL_TXSEQ\t\t0xFFFC0000\n#define L2CAP_EXT_CTRL_SAR\t\t0x00030000\n#define L2CAP_EXT_CTRL_SUPERVISE\t0x00030000\n#define L2CAP_EXT_CTRL_REQSEQ\t\t0x0000FFFC\n\n#define L2CAP_EXT_CTRL_POLL\t\t0x00040000\n#define L2CAP_EXT_CTRL_FINAL\t\t0x00000002\n#define L2CAP_EXT_CTRL_FRAME_TYPE\t0x00000001  \n\n#define L2CAP_EXT_CTRL_FINAL_SHIFT\t1\n#define L2CAP_EXT_CTRL_REQSEQ_SHIFT\t2\n#define L2CAP_EXT_CTRL_SAR_SHIFT\t16\n#define L2CAP_EXT_CTRL_SUPER_SHIFT\t16\n#define L2CAP_EXT_CTRL_POLL_SHIFT\t18\n#define L2CAP_EXT_CTRL_TXSEQ_SHIFT\t18\n\n \n#define L2CAP_SUPER_RR\t\t0x00\n#define L2CAP_SUPER_REJ\t\t0x01\n#define L2CAP_SUPER_RNR\t\t0x02\n#define L2CAP_SUPER_SREJ\t0x03\n\n \n#define L2CAP_SAR_UNSEGMENTED\t0x00\n#define L2CAP_SAR_START\t\t0x01\n#define L2CAP_SAR_END\t\t0x02\n#define L2CAP_SAR_CONTINUE\t0x03\n\n \n#define L2CAP_REJ_NOT_UNDERSTOOD\t0x0000\n#define L2CAP_REJ_MTU_EXCEEDED\t\t0x0001\n#define L2CAP_REJ_INVALID_CID\t\t0x0002\n\n \nstruct l2cap_hdr {\n\t__le16     len;\n\t__le16     cid;\n} __packed;\n#define L2CAP_LEN_SIZE\t\t2\n#define L2CAP_HDR_SIZE\t\t4\n#define L2CAP_ENH_HDR_SIZE\t6\n#define L2CAP_EXT_HDR_SIZE\t8\n\n#define L2CAP_FCS_SIZE\t\t2\n#define L2CAP_SDULEN_SIZE\t2\n#define L2CAP_PSMLEN_SIZE\t2\n#define L2CAP_ENH_CTRL_SIZE\t2\n#define L2CAP_EXT_CTRL_SIZE\t4\n\nstruct l2cap_cmd_hdr {\n\t__u8       code;\n\t__u8       ident;\n\t__le16     len;\n} __packed;\n#define L2CAP_CMD_HDR_SIZE\t4\n\nstruct l2cap_cmd_rej_unk {\n\t__le16     reason;\n} __packed;\n\nstruct l2cap_cmd_rej_mtu {\n\t__le16     reason;\n\t__le16     max_mtu;\n} __packed;\n\nstruct l2cap_cmd_rej_cid {\n\t__le16     reason;\n\t__le16     scid;\n\t__le16     dcid;\n} __packed;\n\nstruct l2cap_conn_req {\n\t__le16     psm;\n\t__le16     scid;\n} __packed;\n\nstruct l2cap_conn_rsp {\n\t__le16     dcid;\n\t__le16     scid;\n\t__le16     result;\n\t__le16     status;\n} __packed;\n\n \n#define L2CAP_PSM_SDP\t\t0x0001\n#define L2CAP_PSM_RFCOMM\t0x0003\n#define L2CAP_PSM_3DSP\t\t0x0021\n#define L2CAP_PSM_IPSP\t\t0x0023  \n\n#define L2CAP_PSM_DYN_START\t0x1001\n#define L2CAP_PSM_DYN_END\t0xffff\n#define L2CAP_PSM_AUTO_END\t0x10ff\n#define L2CAP_PSM_LE_DYN_START  0x0080\n#define L2CAP_PSM_LE_DYN_END\t0x00ff\n\n \n#define L2CAP_CID_SIGNALING\t0x0001\n#define L2CAP_CID_CONN_LESS\t0x0002\n#define L2CAP_CID_A2MP\t\t0x0003\n#define L2CAP_CID_ATT\t\t0x0004\n#define L2CAP_CID_LE_SIGNALING\t0x0005\n#define L2CAP_CID_SMP\t\t0x0006\n#define L2CAP_CID_SMP_BREDR\t0x0007\n#define L2CAP_CID_DYN_START\t0x0040\n#define L2CAP_CID_DYN_END\t0xffff\n#define L2CAP_CID_LE_DYN_END\t0x007f\n\n \n#define L2CAP_CR_SUCCESS\t0x0000\n#define L2CAP_CR_PEND\t\t0x0001\n#define L2CAP_CR_BAD_PSM\t0x0002\n#define L2CAP_CR_SEC_BLOCK\t0x0003\n#define L2CAP_CR_NO_MEM\t\t0x0004\n#define L2CAP_CR_BAD_AMP\t0x0005\n#define L2CAP_CR_INVALID_SCID\t0x0006\n#define L2CAP_CR_SCID_IN_USE\t0x0007\n\n \n#define L2CAP_CR_LE_SUCCESS\t\t0x0000\n#define L2CAP_CR_LE_BAD_PSM\t\t0x0002\n#define L2CAP_CR_LE_NO_MEM\t\t0x0004\n#define L2CAP_CR_LE_AUTHENTICATION\t0x0005\n#define L2CAP_CR_LE_AUTHORIZATION\t0x0006\n#define L2CAP_CR_LE_BAD_KEY_SIZE\t0x0007\n#define L2CAP_CR_LE_ENCRYPTION\t\t0x0008\n#define L2CAP_CR_LE_INVALID_SCID\t0x0009\n#define L2CAP_CR_LE_SCID_IN_USE\t\t0X000A\n#define L2CAP_CR_LE_UNACCEPT_PARAMS\t0X000B\n#define L2CAP_CR_LE_INVALID_PARAMS\t0X000C\n\n \n#define L2CAP_CS_NO_INFO\t0x0000\n#define L2CAP_CS_AUTHEN_PEND\t0x0001\n#define L2CAP_CS_AUTHOR_PEND\t0x0002\n\nstruct l2cap_conf_req {\n\t__le16     dcid;\n\t__le16     flags;\n\t__u8       data[];\n} __packed;\n\nstruct l2cap_conf_rsp {\n\t__le16     scid;\n\t__le16     flags;\n\t__le16     result;\n\t__u8       data[];\n} __packed;\n\n#define L2CAP_CONF_SUCCESS\t0x0000\n#define L2CAP_CONF_UNACCEPT\t0x0001\n#define L2CAP_CONF_REJECT\t0x0002\n#define L2CAP_CONF_UNKNOWN\t0x0003\n#define L2CAP_CONF_PENDING\t0x0004\n#define L2CAP_CONF_EFS_REJECT\t0x0005\n\n \n#define L2CAP_CONF_FLAG_CONTINUATION\t0x0001\n\nstruct l2cap_conf_opt {\n\t__u8       type;\n\t__u8       len;\n\t__u8       val[];\n} __packed;\n#define L2CAP_CONF_OPT_SIZE\t2\n\n#define L2CAP_CONF_HINT\t\t0x80\n#define L2CAP_CONF_MASK\t\t0x7f\n\n#define L2CAP_CONF_MTU\t\t0x01\n#define L2CAP_CONF_FLUSH_TO\t0x02\n#define L2CAP_CONF_QOS\t\t0x03\n#define L2CAP_CONF_RFC\t\t0x04\n#define L2CAP_CONF_FCS\t\t0x05\n#define L2CAP_CONF_EFS\t\t0x06\n#define L2CAP_CONF_EWS\t\t0x07\n\n#define L2CAP_CONF_MAX_SIZE\t22\n\nstruct l2cap_conf_rfc {\n\t__u8       mode;\n\t__u8       txwin_size;\n\t__u8       max_transmit;\n\t__le16     retrans_timeout;\n\t__le16     monitor_timeout;\n\t__le16     max_pdu_size;\n} __packed;\n\n#define L2CAP_MODE_BASIC\t0x00\n#define L2CAP_MODE_RETRANS\t0x01\n#define L2CAP_MODE_FLOWCTL\t0x02\n#define L2CAP_MODE_ERTM\t\t0x03\n#define L2CAP_MODE_STREAMING\t0x04\n\n \n#define L2CAP_MODE_LE_FLOWCTL\t0x80\n#define L2CAP_MODE_EXT_FLOWCTL\t0x81\n\nstruct l2cap_conf_efs {\n\t__u8\tid;\n\t__u8\tstype;\n\t__le16\tmsdu;\n\t__le32\tsdu_itime;\n\t__le32\tacc_lat;\n\t__le32\tflush_to;\n} __packed;\n\n#define L2CAP_SERV_NOTRAFIC\t0x00\n#define L2CAP_SERV_BESTEFFORT\t0x01\n#define L2CAP_SERV_GUARANTEED\t0x02\n\n#define L2CAP_BESTEFFORT_ID\t0x01\n\nstruct l2cap_disconn_req {\n\t__le16     dcid;\n\t__le16     scid;\n} __packed;\n\nstruct l2cap_disconn_rsp {\n\t__le16     dcid;\n\t__le16     scid;\n} __packed;\n\nstruct l2cap_info_req {\n\t__le16      type;\n} __packed;\n\nstruct l2cap_info_rsp {\n\t__le16      type;\n\t__le16      result;\n\t__u8        data[];\n} __packed;\n\nstruct l2cap_create_chan_req {\n\t__le16      psm;\n\t__le16      scid;\n\t__u8        amp_id;\n} __packed;\n\nstruct l2cap_create_chan_rsp {\n\t__le16      dcid;\n\t__le16      scid;\n\t__le16      result;\n\t__le16      status;\n} __packed;\n\nstruct l2cap_move_chan_req {\n\t__le16      icid;\n\t__u8        dest_amp_id;\n} __packed;\n\nstruct l2cap_move_chan_rsp {\n\t__le16      icid;\n\t__le16      result;\n} __packed;\n\n#define L2CAP_MR_SUCCESS\t0x0000\n#define L2CAP_MR_PEND\t\t0x0001\n#define L2CAP_MR_BAD_ID\t\t0x0002\n#define L2CAP_MR_SAME_ID\t0x0003\n#define L2CAP_MR_NOT_SUPP\t0x0004\n#define L2CAP_MR_COLLISION\t0x0005\n#define L2CAP_MR_NOT_ALLOWED\t0x0006\n\nstruct l2cap_move_chan_cfm {\n\t__le16      icid;\n\t__le16      result;\n} __packed;\n\n#define L2CAP_MC_CONFIRMED\t0x0000\n#define L2CAP_MC_UNCONFIRMED\t0x0001\n\nstruct l2cap_move_chan_cfm_rsp {\n\t__le16      icid;\n} __packed;\n\n \n#define L2CAP_IT_CL_MTU\t\t0x0001\n#define L2CAP_IT_FEAT_MASK\t0x0002\n#define L2CAP_IT_FIXED_CHAN\t0x0003\n\n \n#define L2CAP_IR_SUCCESS\t0x0000\n#define L2CAP_IR_NOTSUPP\t0x0001\n\nstruct l2cap_conn_param_update_req {\n\t__le16      min;\n\t__le16      max;\n\t__le16      latency;\n\t__le16      to_multiplier;\n} __packed;\n\nstruct l2cap_conn_param_update_rsp {\n\t__le16      result;\n} __packed;\n\n \n#define L2CAP_CONN_PARAM_ACCEPTED\t0x0000\n#define L2CAP_CONN_PARAM_REJECTED\t0x0001\n\nstruct l2cap_le_conn_req {\n\t__le16     psm;\n\t__le16     scid;\n\t__le16     mtu;\n\t__le16     mps;\n\t__le16     credits;\n} __packed;\n\nstruct l2cap_le_conn_rsp {\n\t__le16     dcid;\n\t__le16     mtu;\n\t__le16     mps;\n\t__le16     credits;\n\t__le16     result;\n} __packed;\n\nstruct l2cap_le_credits {\n\t__le16     cid;\n\t__le16     credits;\n} __packed;\n\n#define L2CAP_ECRED_MIN_MTU\t\t64\n#define L2CAP_ECRED_MIN_MPS\t\t64\n#define L2CAP_ECRED_MAX_CID\t\t5\n\nstruct l2cap_ecred_conn_req {\n\t__le16 psm;\n\t__le16 mtu;\n\t__le16 mps;\n\t__le16 credits;\n\t__le16 scid[];\n} __packed;\n\nstruct l2cap_ecred_conn_rsp {\n\t__le16 mtu;\n\t__le16 mps;\n\t__le16 credits;\n\t__le16 result;\n\t__le16 dcid[];\n};\n\nstruct l2cap_ecred_reconf_req {\n\t__le16 mtu;\n\t__le16 mps;\n\t__le16 scid[];\n} __packed;\n\n#define L2CAP_RECONF_SUCCESS\t\t0x0000\n#define L2CAP_RECONF_INVALID_MTU\t0x0001\n#define L2CAP_RECONF_INVALID_MPS\t0x0002\n\nstruct l2cap_ecred_reconf_rsp {\n\t__le16 result;\n} __packed;\n\n \nstruct l2cap_seq_list {\n\t__u16\thead;\n\t__u16\ttail;\n\t__u16\tmask;\n\t__u16\t*list;\n};\n\n#define L2CAP_SEQ_LIST_CLEAR\t0xFFFF\n#define L2CAP_SEQ_LIST_TAIL\t0x8000\n\nstruct l2cap_chan {\n\tstruct l2cap_conn\t*conn;\n\tstruct hci_conn\t\t*hs_hcon;\n\tstruct hci_chan\t\t*hs_hchan;\n\tstruct kref\tkref;\n\tatomic_t\tnesting;\n\n\t__u8\t\tstate;\n\n\tbdaddr_t\tdst;\n\t__u8\t\tdst_type;\n\tbdaddr_t\tsrc;\n\t__u8\t\tsrc_type;\n\t__le16\t\tpsm;\n\t__le16\t\tsport;\n\t__u16\t\tdcid;\n\t__u16\t\tscid;\n\n\t__u16\t\timtu;\n\t__u16\t\tomtu;\n\t__u16\t\tflush_to;\n\t__u8\t\tmode;\n\t__u8\t\tchan_type;\n\t__u8\t\tchan_policy;\n\n\t__u8\t\tsec_level;\n\n\t__u8\t\tident;\n\n\t__u8\t\tconf_req[64];\n\t__u8\t\tconf_len;\n\t__u8\t\tnum_conf_req;\n\t__u8\t\tnum_conf_rsp;\n\n\t__u8\t\tfcs;\n\n\t__u16\t\ttx_win;\n\t__u16\t\ttx_win_max;\n\t__u16\t\tack_win;\n\t__u8\t\tmax_tx;\n\t__u16\t\tretrans_timeout;\n\t__u16\t\tmonitor_timeout;\n\t__u16\t\tmps;\n\n\t__u16\t\ttx_credits;\n\t__u16\t\trx_credits;\n\n\t__u8\t\ttx_state;\n\t__u8\t\trx_state;\n\n\tunsigned long\tconf_state;\n\tunsigned long\tconn_state;\n\tunsigned long\tflags;\n\n\t__u8\t\tremote_amp_id;\n\t__u8\t\tlocal_amp_id;\n\t__u8\t\tmove_id;\n\t__u8\t\tmove_state;\n\t__u8\t\tmove_role;\n\n\t__u16\t\tnext_tx_seq;\n\t__u16\t\texpected_ack_seq;\n\t__u16\t\texpected_tx_seq;\n\t__u16\t\tbuffer_seq;\n\t__u16\t\tsrej_save_reqseq;\n\t__u16\t\tlast_acked_seq;\n\t__u16\t\tframes_sent;\n\t__u16\t\tunacked_frames;\n\t__u8\t\tretry_count;\n\t__u16\t\tsdu_len;\n\tstruct sk_buff\t*sdu;\n\tstruct sk_buff\t*sdu_last_frag;\n\n\t__u16\t\tremote_tx_win;\n\t__u8\t\tremote_max_tx;\n\t__u16\t\tremote_mps;\n\n\t__u8\t\tlocal_id;\n\t__u8\t\tlocal_stype;\n\t__u16\t\tlocal_msdu;\n\t__u32\t\tlocal_sdu_itime;\n\t__u32\t\tlocal_acc_lat;\n\t__u32\t\tlocal_flush_to;\n\n\t__u8\t\tremote_id;\n\t__u8\t\tremote_stype;\n\t__u16\t\tremote_msdu;\n\t__u32\t\tremote_sdu_itime;\n\t__u32\t\tremote_acc_lat;\n\t__u32\t\tremote_flush_to;\n\n\tstruct delayed_work\tchan_timer;\n\tstruct delayed_work\tretrans_timer;\n\tstruct delayed_work\tmonitor_timer;\n\tstruct delayed_work\tack_timer;\n\n\tstruct sk_buff\t\t*tx_send_head;\n\tstruct sk_buff_head\ttx_q;\n\tstruct sk_buff_head\tsrej_q;\n\tstruct l2cap_seq_list\tsrej_list;\n\tstruct l2cap_seq_list\tretrans_list;\n\n\tstruct list_head\tlist;\n\tstruct list_head\tglobal_l;\n\n\tvoid\t\t\t*data;\n\tconst struct l2cap_ops\t*ops;\n\tstruct mutex\t\tlock;\n};\n\nstruct l2cap_ops {\n\tchar\t\t\t*name;\n\n\tstruct l2cap_chan\t*(*new_connection) (struct l2cap_chan *chan);\n\tint\t\t\t(*recv) (struct l2cap_chan * chan,\n\t\t\t\t\t struct sk_buff *skb);\n\tvoid\t\t\t(*teardown) (struct l2cap_chan *chan, int err);\n\tvoid\t\t\t(*close) (struct l2cap_chan *chan);\n\tvoid\t\t\t(*state_change) (struct l2cap_chan *chan,\n\t\t\t\t\t\t int state, int err);\n\tvoid\t\t\t(*ready) (struct l2cap_chan *chan);\n\tvoid\t\t\t(*defer) (struct l2cap_chan *chan);\n\tvoid\t\t\t(*resume) (struct l2cap_chan *chan);\n\tvoid\t\t\t(*suspend) (struct l2cap_chan *chan);\n\tvoid\t\t\t(*set_shutdown) (struct l2cap_chan *chan);\n\tlong\t\t\t(*get_sndtimeo) (struct l2cap_chan *chan);\n\tstruct pid\t\t*(*get_peer_pid) (struct l2cap_chan *chan);\n\tstruct sk_buff\t\t*(*alloc_skb) (struct l2cap_chan *chan,\n\t\t\t\t\t       unsigned long hdr_len,\n\t\t\t\t\t       unsigned long len, int nb);\n\tint\t\t\t(*filter) (struct l2cap_chan * chan,\n\t\t\t\t\t   struct sk_buff *skb);\n};\n\nstruct l2cap_conn {\n\tstruct hci_conn\t\t*hcon;\n\tstruct hci_chan\t\t*hchan;\n\n\tunsigned int\t\tmtu;\n\n\t__u32\t\t\tfeat_mask;\n\t__u8\t\t\tremote_fixed_chan;\n\t__u8\t\t\tlocal_fixed_chan;\n\n\t__u8\t\t\tinfo_state;\n\t__u8\t\t\tinfo_ident;\n\n\tstruct delayed_work\tinfo_timer;\n\n\tstruct sk_buff\t\t*rx_skb;\n\t__u32\t\t\trx_len;\n\t__u8\t\t\ttx_ident;\n\tstruct mutex\t\tident_lock;\n\n\tstruct sk_buff_head\tpending_rx;\n\tstruct work_struct\tpending_rx_work;\n\n\tstruct delayed_work\tid_addr_timer;\n\n\t__u8\t\t\tdisc_reason;\n\n\tstruct l2cap_chan\t*smp;\n\n\tstruct list_head\tchan_l;\n\tstruct mutex\t\tchan_lock;\n\tstruct kref\t\tref;\n\tstruct list_head\tusers;\n};\n\nstruct l2cap_user {\n\tstruct list_head list;\n\tint (*probe) (struct l2cap_conn *conn, struct l2cap_user *user);\n\tvoid (*remove) (struct l2cap_conn *conn, struct l2cap_user *user);\n};\n\n#define L2CAP_INFO_CL_MTU_REQ_SENT\t0x01\n#define L2CAP_INFO_FEAT_MASK_REQ_SENT\t0x04\n#define L2CAP_INFO_FEAT_MASK_REQ_DONE\t0x08\n\n#define L2CAP_CHAN_RAW\t\t\t1\n#define L2CAP_CHAN_CONN_LESS\t\t2\n#define L2CAP_CHAN_CONN_ORIENTED\t3\n#define L2CAP_CHAN_FIXED\t\t4\n\n \n#define l2cap_pi(sk) ((struct l2cap_pinfo *) sk)\n\nstruct l2cap_pinfo {\n\tstruct bt_sock\t\tbt;\n\tstruct l2cap_chan\t*chan;\n\tstruct sk_buff\t\t*rx_busy_skb;\n};\n\nenum {\n\tCONF_REQ_SENT,\n\tCONF_INPUT_DONE,\n\tCONF_OUTPUT_DONE,\n\tCONF_MTU_DONE,\n\tCONF_MODE_DONE,\n\tCONF_CONNECT_PEND,\n\tCONF_RECV_NO_FCS,\n\tCONF_STATE2_DEVICE,\n\tCONF_EWS_RECV,\n\tCONF_LOC_CONF_PEND,\n\tCONF_REM_CONF_PEND,\n\tCONF_NOT_COMPLETE,\n};\n\n#define L2CAP_CONF_MAX_CONF_REQ 2\n#define L2CAP_CONF_MAX_CONF_RSP 2\n\nenum {\n\tCONN_SREJ_SENT,\n\tCONN_WAIT_F,\n\tCONN_SREJ_ACT,\n\tCONN_SEND_PBIT,\n\tCONN_REMOTE_BUSY,\n\tCONN_LOCAL_BUSY,\n\tCONN_REJ_ACT,\n\tCONN_SEND_FBIT,\n\tCONN_RNR_SENT,\n};\n\n \nenum {\n\tFLAG_ROLE_SWITCH,\n\tFLAG_FORCE_ACTIVE,\n\tFLAG_FORCE_RELIABLE,\n\tFLAG_FLUSHABLE,\n\tFLAG_EXT_CTRL,\n\tFLAG_EFS_ENABLE,\n\tFLAG_DEFER_SETUP,\n\tFLAG_LE_CONN_REQ_SENT,\n\tFLAG_ECRED_CONN_REQ_SENT,\n\tFLAG_PENDING_SECURITY,\n\tFLAG_HOLD_HCI_CONN,\n};\n\n \nenum {\n\tL2CAP_NESTING_SMP,\n\tL2CAP_NESTING_NORMAL,\n\tL2CAP_NESTING_PARENT,\n};\n\nenum {\n\tL2CAP_TX_STATE_XMIT,\n\tL2CAP_TX_STATE_WAIT_F,\n};\n\nenum {\n\tL2CAP_RX_STATE_RECV,\n\tL2CAP_RX_STATE_SREJ_SENT,\n\tL2CAP_RX_STATE_MOVE,\n\tL2CAP_RX_STATE_WAIT_P,\n\tL2CAP_RX_STATE_WAIT_F,\n};\n\nenum {\n\tL2CAP_TXSEQ_EXPECTED,\n\tL2CAP_TXSEQ_EXPECTED_SREJ,\n\tL2CAP_TXSEQ_UNEXPECTED,\n\tL2CAP_TXSEQ_UNEXPECTED_SREJ,\n\tL2CAP_TXSEQ_DUPLICATE,\n\tL2CAP_TXSEQ_DUPLICATE_SREJ,\n\tL2CAP_TXSEQ_INVALID,\n\tL2CAP_TXSEQ_INVALID_IGNORE,\n};\n\nenum {\n\tL2CAP_EV_DATA_REQUEST,\n\tL2CAP_EV_LOCAL_BUSY_DETECTED,\n\tL2CAP_EV_LOCAL_BUSY_CLEAR,\n\tL2CAP_EV_RECV_REQSEQ_AND_FBIT,\n\tL2CAP_EV_RECV_FBIT,\n\tL2CAP_EV_RETRANS_TO,\n\tL2CAP_EV_MONITOR_TO,\n\tL2CAP_EV_EXPLICIT_POLL,\n\tL2CAP_EV_RECV_IFRAME,\n\tL2CAP_EV_RECV_RR,\n\tL2CAP_EV_RECV_REJ,\n\tL2CAP_EV_RECV_RNR,\n\tL2CAP_EV_RECV_SREJ,\n\tL2CAP_EV_RECV_FRAME,\n};\n\nenum {\n\tL2CAP_MOVE_ROLE_NONE,\n\tL2CAP_MOVE_ROLE_INITIATOR,\n\tL2CAP_MOVE_ROLE_RESPONDER,\n};\n\nenum {\n\tL2CAP_MOVE_STABLE,\n\tL2CAP_MOVE_WAIT_REQ,\n\tL2CAP_MOVE_WAIT_RSP,\n\tL2CAP_MOVE_WAIT_RSP_SUCCESS,\n\tL2CAP_MOVE_WAIT_CONFIRM,\n\tL2CAP_MOVE_WAIT_CONFIRM_RSP,\n\tL2CAP_MOVE_WAIT_LOGICAL_COMP,\n\tL2CAP_MOVE_WAIT_LOGICAL_CFM,\n\tL2CAP_MOVE_WAIT_LOCAL_BUSY,\n\tL2CAP_MOVE_WAIT_PREPARE,\n};\n\nvoid l2cap_chan_hold(struct l2cap_chan *c);\nstruct l2cap_chan *l2cap_chan_hold_unless_zero(struct l2cap_chan *c);\nvoid l2cap_chan_put(struct l2cap_chan *c);\n\nstatic inline void l2cap_chan_lock(struct l2cap_chan *chan)\n{\n\tmutex_lock_nested(&chan->lock, atomic_read(&chan->nesting));\n}\n\nstatic inline void l2cap_chan_unlock(struct l2cap_chan *chan)\n{\n\tmutex_unlock(&chan->lock);\n}\n\nstatic inline void l2cap_set_timer(struct l2cap_chan *chan,\n\t\t\t\t   struct delayed_work *work, long timeout)\n{\n\tBT_DBG(\"chan %p state %s timeout %ld\", chan,\n\t       state_to_string(chan->state), timeout);\n\n\t \n\tif (!cancel_delayed_work(work))\n\t\tl2cap_chan_hold(chan);\n\n\tschedule_delayed_work(work, timeout);\n}\n\nstatic inline bool l2cap_clear_timer(struct l2cap_chan *chan,\n\t\t\t\t     struct delayed_work *work)\n{\n\tbool ret;\n\n\t \n\tret = cancel_delayed_work(work);\n\tif (ret)\n\t\tl2cap_chan_put(chan);\n\n\treturn ret;\n}\n\n#define __set_chan_timer(c, t) l2cap_set_timer(c, &c->chan_timer, (t))\n#define __clear_chan_timer(c) l2cap_clear_timer(c, &c->chan_timer)\n#define __clear_retrans_timer(c) l2cap_clear_timer(c, &c->retrans_timer)\n#define __clear_monitor_timer(c) l2cap_clear_timer(c, &c->monitor_timer)\n#define __set_ack_timer(c) l2cap_set_timer(c, &chan->ack_timer, \\\n\t\tmsecs_to_jiffies(L2CAP_DEFAULT_ACK_TO));\n#define __clear_ack_timer(c) l2cap_clear_timer(c, &c->ack_timer)\n\nstatic inline int __seq_offset(struct l2cap_chan *chan, __u16 seq1, __u16 seq2)\n{\n\tif (seq1 >= seq2)\n\t\treturn seq1 - seq2;\n\telse\n\t\treturn chan->tx_win_max + 1 - seq2 + seq1;\n}\n\nstatic inline __u16 __next_seq(struct l2cap_chan *chan, __u16 seq)\n{\n\treturn (seq + 1) % (chan->tx_win_max + 1);\n}\n\nstatic inline struct l2cap_chan *l2cap_chan_no_new_connection(struct l2cap_chan *chan)\n{\n\treturn NULL;\n}\n\nstatic inline int l2cap_chan_no_recv(struct l2cap_chan *chan, struct sk_buff *skb)\n{\n\treturn -ENOSYS;\n}\n\nstatic inline struct sk_buff *l2cap_chan_no_alloc_skb(struct l2cap_chan *chan,\n\t\t\t\t\t\t      unsigned long hdr_len,\n\t\t\t\t\t\t      unsigned long len, int nb)\n{\n\treturn ERR_PTR(-ENOSYS);\n}\n\nstatic inline void l2cap_chan_no_teardown(struct l2cap_chan *chan, int err)\n{\n}\n\nstatic inline void l2cap_chan_no_close(struct l2cap_chan *chan)\n{\n}\n\nstatic inline void l2cap_chan_no_ready(struct l2cap_chan *chan)\n{\n}\n\nstatic inline void l2cap_chan_no_state_change(struct l2cap_chan *chan,\n\t\t\t\t\t      int state, int err)\n{\n}\n\nstatic inline void l2cap_chan_no_defer(struct l2cap_chan *chan)\n{\n}\n\nstatic inline void l2cap_chan_no_suspend(struct l2cap_chan *chan)\n{\n}\n\nstatic inline void l2cap_chan_no_resume(struct l2cap_chan *chan)\n{\n}\n\nstatic inline void l2cap_chan_no_set_shutdown(struct l2cap_chan *chan)\n{\n}\n\nstatic inline long l2cap_chan_no_get_sndtimeo(struct l2cap_chan *chan)\n{\n\treturn 0;\n}\n\nextern bool disable_ertm;\nextern bool enable_ecred;\n\nint l2cap_init_sockets(void);\nvoid l2cap_cleanup_sockets(void);\nbool l2cap_is_socket(struct socket *sock);\n\nvoid __l2cap_le_connect_rsp_defer(struct l2cap_chan *chan);\nvoid __l2cap_ecred_conn_rsp_defer(struct l2cap_chan *chan);\nvoid __l2cap_connect_rsp_defer(struct l2cap_chan *chan);\n\nint l2cap_add_psm(struct l2cap_chan *chan, bdaddr_t *src, __le16 psm);\nint l2cap_add_scid(struct l2cap_chan *chan,  __u16 scid);\n\nstruct l2cap_chan *l2cap_chan_create(void);\nvoid l2cap_chan_close(struct l2cap_chan *chan, int reason);\nint l2cap_chan_connect(struct l2cap_chan *chan, __le16 psm, u16 cid,\n\t\t       bdaddr_t *dst, u8 dst_type);\nint l2cap_chan_reconfigure(struct l2cap_chan *chan, __u16 mtu);\nint l2cap_chan_send(struct l2cap_chan *chan, struct msghdr *msg, size_t len);\nvoid l2cap_chan_busy(struct l2cap_chan *chan, int busy);\nint l2cap_chan_check_security(struct l2cap_chan *chan, bool initiator);\nvoid l2cap_chan_set_defaults(struct l2cap_chan *chan);\nint l2cap_ertm_init(struct l2cap_chan *chan);\nvoid l2cap_chan_add(struct l2cap_conn *conn, struct l2cap_chan *chan);\nvoid __l2cap_chan_add(struct l2cap_conn *conn, struct l2cap_chan *chan);\ntypedef void (*l2cap_chan_func_t)(struct l2cap_chan *chan, void *data);\nvoid l2cap_chan_list(struct l2cap_conn *conn, l2cap_chan_func_t func,\n\t\t     void *data);\nvoid l2cap_chan_del(struct l2cap_chan *chan, int err);\nvoid l2cap_send_conn_req(struct l2cap_chan *chan);\nvoid l2cap_move_start(struct l2cap_chan *chan);\nvoid l2cap_logical_cfm(struct l2cap_chan *chan, struct hci_chan *hchan,\n\t\t       u8 status);\nvoid __l2cap_physical_cfm(struct l2cap_chan *chan, int result);\n\nstruct l2cap_conn *l2cap_conn_get(struct l2cap_conn *conn);\nvoid l2cap_conn_put(struct l2cap_conn *conn);\n\nint l2cap_register_user(struct l2cap_conn *conn, struct l2cap_user *user);\nvoid l2cap_unregister_user(struct l2cap_conn *conn, struct l2cap_user *user);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}