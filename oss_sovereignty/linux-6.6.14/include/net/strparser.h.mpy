{
  "module_name": "strparser.h",
  "hash_id": "1eaefab959939cdb8bbbd3512e782126eb1b908f3858eed62b563631dc6fd05d",
  "original_prompt": "Ingested from linux-6.6.14/include/net/strparser.h",
  "human_readable_source": " \n \n\n#ifndef __NET_STRPARSER_H_\n#define __NET_STRPARSER_H_\n\n#include <linux/skbuff.h>\n#include <net/sock.h>\n\n#define STRP_STATS_ADD(stat, count) ((stat) += (count))\n#define STRP_STATS_INCR(stat) ((stat)++)\n\nstruct strp_stats {\n\tunsigned long long msgs;\n\tunsigned long long bytes;\n\tunsigned int mem_fail;\n\tunsigned int need_more_hdr;\n\tunsigned int msg_too_big;\n\tunsigned int msg_timeouts;\n\tunsigned int bad_hdr_len;\n};\n\nstruct strp_aggr_stats {\n\tunsigned long long msgs;\n\tunsigned long long bytes;\n\tunsigned int mem_fail;\n\tunsigned int need_more_hdr;\n\tunsigned int msg_too_big;\n\tunsigned int msg_timeouts;\n\tunsigned int bad_hdr_len;\n\tunsigned int aborts;\n\tunsigned int interrupted;\n\tunsigned int unrecov_intr;\n};\n\nstruct strparser;\n\n \nstruct strp_callbacks {\n\tint (*parse_msg)(struct strparser *strp, struct sk_buff *skb);\n\tvoid (*rcv_msg)(struct strparser *strp, struct sk_buff *skb);\n\tint (*read_sock_done)(struct strparser *strp, int err);\n\tvoid (*abort_parser)(struct strparser *strp, int err);\n\tvoid (*lock)(struct strparser *strp);\n\tvoid (*unlock)(struct strparser *strp);\n};\n\nstruct strp_msg {\n\tint full_len;\n\tint offset;\n};\n\nstruct _strp_msg {\n\t \n\tstruct strp_msg strp;\n\tint accum_len;\n};\n\nstruct sk_skb_cb {\n#define SK_SKB_CB_PRIV_LEN 20\n\tunsigned char data[SK_SKB_CB_PRIV_LEN];\n\t \n\tunsigned char pad[4];\n\tstruct _strp_msg strp;\n\n\t \n\tstruct tls_msg {\n\t\tu8 control;\n\t} tls;\n\t \n\tu64 temp_reg;\n};\n\nstatic inline struct strp_msg *strp_msg(struct sk_buff *skb)\n{\n\treturn (struct strp_msg *)((void *)skb->cb +\n\t\toffsetof(struct sk_skb_cb, strp));\n}\n\n \nstruct strparser {\n\tstruct sock *sk;\n\n\tu32 stopped : 1;\n\tu32 paused : 1;\n\tu32 aborted : 1;\n\tu32 interrupted : 1;\n\tu32 unrecov_intr : 1;\n\n\tstruct sk_buff **skb_nextp;\n\tstruct sk_buff *skb_head;\n\tunsigned int need_bytes;\n\tstruct delayed_work msg_timer_work;\n\tstruct work_struct work;\n\tstruct strp_stats stats;\n\tstruct strp_callbacks cb;\n};\n\n \nstatic inline void strp_pause(struct strparser *strp)\n{\n\tstrp->paused = 1;\n}\n\n \nvoid strp_unpause(struct strparser *strp);\n \nvoid __strp_unpause(struct strparser *strp);\n\nstatic inline void save_strp_stats(struct strparser *strp,\n\t\t\t\t   struct strp_aggr_stats *agg_stats)\n{\n\t \n\n#define SAVE_PSOCK_STATS(_stat) (agg_stats->_stat +=\t\t\\\n\t\t\t\t strp->stats._stat)\n\tSAVE_PSOCK_STATS(msgs);\n\tSAVE_PSOCK_STATS(bytes);\n\tSAVE_PSOCK_STATS(mem_fail);\n\tSAVE_PSOCK_STATS(need_more_hdr);\n\tSAVE_PSOCK_STATS(msg_too_big);\n\tSAVE_PSOCK_STATS(msg_timeouts);\n\tSAVE_PSOCK_STATS(bad_hdr_len);\n#undef SAVE_PSOCK_STATS\n\n\tif (strp->aborted)\n\t\tagg_stats->aborts++;\n\tif (strp->interrupted)\n\t\tagg_stats->interrupted++;\n\tif (strp->unrecov_intr)\n\t\tagg_stats->unrecov_intr++;\n}\n\nstatic inline void aggregate_strp_stats(struct strp_aggr_stats *stats,\n\t\t\t\t\tstruct strp_aggr_stats *agg_stats)\n{\n#define SAVE_PSOCK_STATS(_stat) (agg_stats->_stat += stats->_stat)\n\tSAVE_PSOCK_STATS(msgs);\n\tSAVE_PSOCK_STATS(bytes);\n\tSAVE_PSOCK_STATS(mem_fail);\n\tSAVE_PSOCK_STATS(need_more_hdr);\n\tSAVE_PSOCK_STATS(msg_too_big);\n\tSAVE_PSOCK_STATS(msg_timeouts);\n\tSAVE_PSOCK_STATS(bad_hdr_len);\n\tSAVE_PSOCK_STATS(aborts);\n\tSAVE_PSOCK_STATS(interrupted);\n\tSAVE_PSOCK_STATS(unrecov_intr);\n#undef SAVE_PSOCK_STATS\n\n}\n\nvoid strp_done(struct strparser *strp);\nvoid strp_stop(struct strparser *strp);\nvoid strp_check_rcv(struct strparser *strp);\nint strp_init(struct strparser *strp, struct sock *sk,\n\t      const struct strp_callbacks *cb);\nvoid strp_data_ready(struct strparser *strp);\nint strp_process(struct strparser *strp, struct sk_buff *orig_skb,\n\t\t unsigned int orig_offset, size_t orig_len,\n\t\t size_t max_msg_size, long timeo);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}