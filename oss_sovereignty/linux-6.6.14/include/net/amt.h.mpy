{
  "module_name": "amt.h",
  "hash_id": "184cba05c17fa6d766d29e22849d46bdde0c8dfb35bfd30fbce754a0b19fbc3d",
  "original_prompt": "Ingested from linux-6.6.14/include/net/amt.h",
  "human_readable_source": " \n \n#ifndef _NET_AMT_H_\n#define _NET_AMT_H_\n\n#include <linux/siphash.h>\n#include <linux/jhash.h>\n#include <linux/netdevice.h>\n#include <net/gro_cells.h>\n#include <net/rtnetlink.h>\n\nenum amt_msg_type {\n\tAMT_MSG_DISCOVERY = 1,\n\tAMT_MSG_ADVERTISEMENT,\n\tAMT_MSG_REQUEST,\n\tAMT_MSG_MEMBERSHIP_QUERY,\n\tAMT_MSG_MEMBERSHIP_UPDATE,\n\tAMT_MSG_MULTICAST_DATA,\n\tAMT_MSG_TEARDOWN,\n\t__AMT_MSG_MAX,\n};\n\n#define AMT_MSG_MAX (__AMT_MSG_MAX - 1)\n\nenum amt_ops {\n\t \n\tAMT_OPS_INT,\n\t \n\tAMT_OPS_UNI,\n\t \n\tAMT_OPS_SUB,\n\t \n\tAMT_OPS_SUB_REV,\n\t__AMT_OPS_MAX,\n};\n\n#define AMT_OPS_MAX (__AMT_OPS_MAX - 1)\n\nenum amt_filter {\n\tAMT_FILTER_FWD,\n\tAMT_FILTER_D_FWD,\n\tAMT_FILTER_FWD_NEW,\n\tAMT_FILTER_D_FWD_NEW,\n\tAMT_FILTER_ALL,\n\tAMT_FILTER_NONE_NEW,\n\tAMT_FILTER_BOTH,\n\tAMT_FILTER_BOTH_NEW,\n\t__AMT_FILTER_MAX,\n};\n\n#define AMT_FILTER_MAX (__AMT_FILTER_MAX - 1)\n\nenum amt_act {\n\tAMT_ACT_GMI,\n\tAMT_ACT_GMI_ZERO,\n\tAMT_ACT_GT,\n\tAMT_ACT_STATUS_FWD_NEW,\n\tAMT_ACT_STATUS_D_FWD_NEW,\n\tAMT_ACT_STATUS_NONE_NEW,\n\t__AMT_ACT_MAX,\n};\n\n#define AMT_ACT_MAX (__AMT_ACT_MAX - 1)\n\nenum amt_status {\n\tAMT_STATUS_INIT,\n\tAMT_STATUS_SENT_DISCOVERY,\n\tAMT_STATUS_RECEIVED_DISCOVERY,\n\tAMT_STATUS_SENT_ADVERTISEMENT,\n\tAMT_STATUS_RECEIVED_ADVERTISEMENT,\n\tAMT_STATUS_SENT_REQUEST,\n\tAMT_STATUS_RECEIVED_REQUEST,\n\tAMT_STATUS_SENT_QUERY,\n\tAMT_STATUS_RECEIVED_QUERY,\n\tAMT_STATUS_SENT_UPDATE,\n\tAMT_STATUS_RECEIVED_UPDATE,\n\t__AMT_STATUS_MAX,\n};\n\n#define AMT_STATUS_MAX (__AMT_STATUS_MAX - 1)\n\n \nenum amt_event {\n\tAMT_EVENT_NONE,\n\tAMT_EVENT_RECEIVE,\n\tAMT_EVENT_SEND_DISCOVERY,\n\tAMT_EVENT_SEND_REQUEST,\n\t__AMT_EVENT_MAX,\n};\n\nstruct amt_header {\n#if defined(__LITTLE_ENDIAN_BITFIELD)\n\tu8 type:4,\n\t   version:4;\n#elif defined(__BIG_ENDIAN_BITFIELD)\n\tu8 version:4,\n\t   type:4;\n#else\n#error  \"Please fix <asm/byteorder.h>\"\n#endif\n} __packed;\n\nstruct amt_header_discovery {\n#if defined(__LITTLE_ENDIAN_BITFIELD)\n\tu32\ttype:4,\n\t\tversion:4,\n\t\treserved:24;\n#elif defined(__BIG_ENDIAN_BITFIELD)\n\tu32\tversion:4,\n\t\ttype:4,\n\t\treserved:24;\n#else\n#error  \"Please fix <asm/byteorder.h>\"\n#endif\n\t__be32\tnonce;\n} __packed;\n\nstruct amt_header_advertisement {\n#if defined(__LITTLE_ENDIAN_BITFIELD)\n\tu32\ttype:4,\n\t\tversion:4,\n\t\treserved:24;\n#elif defined(__BIG_ENDIAN_BITFIELD)\n\tu32\tversion:4,\n\t\ttype:4,\n\t\treserved:24;\n#else\n#error  \"Please fix <asm/byteorder.h>\"\n#endif\n\t__be32\tnonce;\n\t__be32\tip4;\n} __packed;\n\nstruct amt_header_request {\n#if defined(__LITTLE_ENDIAN_BITFIELD)\n\tu32\ttype:4,\n\t\tversion:4,\n\t\treserved1:7,\n\t\tp:1,\n\t\treserved2:16;\n#elif defined(__BIG_ENDIAN_BITFIELD)\n\tu32\tversion:4,\n\t\ttype:4,\n\t\tp:1,\n\t\treserved1:7,\n\t\treserved2:16;\n#else\n#error  \"Please fix <asm/byteorder.h>\"\n#endif\n\t__be32\tnonce;\n} __packed;\n\nstruct amt_header_membership_query {\n#if defined(__LITTLE_ENDIAN_BITFIELD)\n\tu64\ttype:4,\n\t\tversion:4,\n\t\treserved:6,\n\t\tl:1,\n\t\tg:1,\n\t\tresponse_mac:48;\n#elif defined(__BIG_ENDIAN_BITFIELD)\n\tu64\tversion:4,\n\t\ttype:4,\n\t\tg:1,\n\t\tl:1,\n\t\treserved:6,\n\t\tresponse_mac:48;\n#else\n#error  \"Please fix <asm/byteorder.h>\"\n#endif\n\t__be32\tnonce;\n} __packed;\n\nstruct amt_header_membership_update {\n#if defined(__LITTLE_ENDIAN_BITFIELD)\n\tu64\ttype:4,\n\t\tversion:4,\n\t\treserved:8,\n\t\tresponse_mac:48;\n#elif defined(__BIG_ENDIAN_BITFIELD)\n\tu64\tversion:4,\n\t\ttype:4,\n\t\treserved:8,\n\t\tresponse_mac:48;\n#else\n#error  \"Please fix <asm/byteorder.h>\"\n#endif\n\t__be32\tnonce;\n} __packed;\n\nstruct amt_header_mcast_data {\n#if defined(__LITTLE_ENDIAN_BITFIELD)\n\tu16\ttype:4,\n\t\tversion:4,\n\t\treserved:8;\n#elif defined(__BIG_ENDIAN_BITFIELD)\n\tu16\tversion:4,\n\t\ttype:4,\n\t\treserved:8;\n#else\n#error  \"Please fix <asm/byteorder.h>\"\n#endif\n} __packed;\n\nstruct amt_headers {\n\tunion {\n\t\tstruct amt_header_discovery discovery;\n\t\tstruct amt_header_advertisement advertisement;\n\t\tstruct amt_header_request request;\n\t\tstruct amt_header_membership_query query;\n\t\tstruct amt_header_membership_update update;\n\t\tstruct amt_header_mcast_data data;\n\t};\n} __packed;\n\nstruct amt_gw_headers {\n\tunion {\n\t\tstruct amt_header_discovery discovery;\n\t\tstruct amt_header_request request;\n\t\tstruct amt_header_membership_update update;\n\t};\n} __packed;\n\nstruct amt_relay_headers {\n\tunion {\n\t\tstruct amt_header_advertisement advertisement;\n\t\tstruct amt_header_membership_query query;\n\t\tstruct amt_header_mcast_data data;\n\t};\n} __packed;\n\nstruct amt_skb_cb {\n\tstruct amt_tunnel_list *tunnel;\n};\n\nstruct amt_tunnel_list {\n\tstruct list_head\tlist;\n\t \n\tspinlock_t\t\tlock;\n\tstruct amt_dev\t\t*amt;\n\tu32\t\t\tnr_groups;\n\tu32\t\t\tnr_sources;\n\tenum amt_status\t\tstatus;\n\tstruct delayed_work\tgc_wq;\n\t__be16\t\t\tsource_port;\n\t__be32\t\t\tip4;\n\t__be32\t\t\tnonce;\n\tsiphash_key_t\t\tkey;\n\tu64\t\t\tmac:48,\n\t\t\t\treserved:16;\n\tstruct rcu_head\t\trcu;\n\tstruct hlist_head\tgroups[];\n};\n\nunion amt_addr {\n\t__be32\t\t\tip4;\n#if IS_ENABLED(CONFIG_IPV6)\n\tstruct in6_addr\t\tip6;\n#endif\n};\n\n \nenum amt_source_status {\n\tAMT_SOURCE_STATUS_NONE,\n\t \n\tAMT_SOURCE_STATUS_FWD,\n\t \n\tAMT_SOURCE_STATUS_D_FWD,\n};\n\n \nstruct amt_source_node {\n\tstruct hlist_node\tnode;\n\tstruct amt_group_node\t*gnode;\n\tstruct delayed_work     source_timer;\n\tunion amt_addr\t\tsource_addr;\n\tenum amt_source_status\tstatus;\n#define AMT_SOURCE_OLD\t0\n#define AMT_SOURCE_NEW\t1\n\tu8\t\t\tflags;\n\tstruct rcu_head\t\trcu;\n};\n\n \nstruct amt_group_node {\n\tstruct amt_dev\t\t*amt;\n\tunion amt_addr\t\tgroup_addr;\n\tunion amt_addr\t\thost_addr;\n\tbool\t\t\tv6;\n\tu8\t\t\tfilter_mode;\n\tu32\t\t\tnr_sources;\n\tstruct amt_tunnel_list\t*tunnel_list;\n\tstruct hlist_node\tnode;\n\tstruct delayed_work     group_timer;\n\tstruct rcu_head\t\trcu;\n\tstruct hlist_head\tsources[];\n};\n\n#define AMT_MAX_EVENTS\t16\nstruct amt_events {\n\tenum amt_event event;\n\tstruct sk_buff *skb;\n};\n\nstruct amt_dev {\n\tstruct net_device       *dev;\n\tstruct net_device       *stream_dev;\n\tstruct net\t\t*net;\n\t \n\tspinlock_t\t\tlock;\n\t \n\tstruct list_head        tunnel_list;\n\tstruct gro_cells\tgro_cells;\n\n\t \n\tstruct delayed_work     discovery_wq;\n\t \n\tstruct delayed_work     req_wq;\n\t \n\tstruct delayed_work     secret_wq;\n\tstruct work_struct\tevent_wq;\n\t \n\tenum amt_status\t\tstatus;\n\t \n\tsiphash_key_t\t\tkey;\n\tstruct socket\t  __rcu *sock;\n\tu32\t\t\tmax_groups;\n\tu32\t\t\tmax_sources;\n\tu32\t\t\thash_buckets;\n\tu32\t\t\thash_seed;\n\t \n\tu32                     max_tunnels;\n\t \n\tu32                     nr_tunnels;\n\t \n\tu32                     mode;\n\t \n\t__be16\t\t\trelay_port;\n\t \n\t__be16\t\t\tgw_port;\n\t \n\t__be32\t\t\tlocal_ip;\n\t \n\t__be32\t\t\tremote_ip;\n\t \n\t__be32\t\t\tdiscovery_ip;\n\t \n\t__be32\t\t\tnonce;\n\t \n\tbool\t\t\tready4;\n\tbool\t\t\tready6;\n\tu8\t\t\treq_cnt;\n\tu8\t\t\tqi;\n\tu64\t\t\tqrv;\n\tu64\t\t\tqri;\n\t \n\tu64\t\t\tmac:48,\n\t\t\t\treserved:16;\n\t \n\tstruct amt_events\tevents[AMT_MAX_EVENTS];\n\tu8\t\t\tevent_idx;\n\tu8\t\t\tnr_events;\n};\n\n#define AMT_TOS\t\t\t0xc0\n#define AMT_IPHDR_OPTS\t\t4\n#define AMT_IP6HDR_OPTS\t\t8\n#define AMT_GC_INTERVAL\t\t(30 * 1000)\n#define AMT_MAX_GROUP\t\t32\n#define AMT_MAX_SOURCE\t\t128\n#define AMT_HSIZE_SHIFT\t\t8\n#define AMT_HSIZE\t\t(1 << AMT_HSIZE_SHIFT)\n\n#define AMT_DISCOVERY_TIMEOUT\t5000\n#define AMT_INIT_REQ_TIMEOUT\t1\n#define AMT_INIT_QUERY_INTERVAL\t125\n#define AMT_MAX_REQ_TIMEOUT\t120\n#define AMT_MAX_REQ_COUNT\t3\n#define AMT_SECRET_TIMEOUT\t60000\n#define IANA_AMT_UDP_PORT\t2268\n#define AMT_MAX_TUNNELS         128\n#define AMT_MAX_REQS\t\t128\n#define AMT_GW_HLEN (sizeof(struct iphdr) + \\\n\t\t     sizeof(struct udphdr) + \\\n\t\t     sizeof(struct amt_gw_headers))\n#define AMT_RELAY_HLEN (sizeof(struct iphdr) + \\\n\t\t     sizeof(struct udphdr) + \\\n\t\t     sizeof(struct amt_relay_headers))\n\nstatic inline bool netif_is_amt(const struct net_device *dev)\n{\n\treturn dev->rtnl_link_ops && !strcmp(dev->rtnl_link_ops->kind, \"amt\");\n}\n\nstatic inline u64 amt_gmi(const struct amt_dev *amt)\n{\n\treturn ((amt->qrv * amt->qi) + amt->qri) * 1000;\n}\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}