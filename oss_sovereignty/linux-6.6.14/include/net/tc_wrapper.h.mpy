{
  "module_name": "tc_wrapper.h",
  "hash_id": "d73c8b07d7f5c04f04ce4f7e49e6ac7e6f25f7cbc28b9a76ccd19e31258d56ea",
  "original_prompt": "Ingested from linux-6.6.14/include/net/tc_wrapper.h",
  "human_readable_source": " \n#ifndef __NET_TC_WRAPPER_H\n#define __NET_TC_WRAPPER_H\n\n#include <net/pkt_cls.h>\n\n#if IS_ENABLED(CONFIG_RETPOLINE)\n\n#include <linux/cpufeature.h>\n#include <linux/static_key.h>\n#include <linux/indirect_call_wrapper.h>\n\n#define TC_INDIRECT_SCOPE\n\nextern struct static_key_false tc_skip_wrapper;\n\n \n#ifdef CONFIG_NET_CLS_ACT\n\n#define TC_INDIRECT_ACTION_DECLARE(fname)                              \\\n\tINDIRECT_CALLABLE_DECLARE(int fname(struct sk_buff *skb,       \\\n\t\t\t\t\t    const struct tc_action *a, \\\n\t\t\t\t\t    struct tcf_result *res))\n\nTC_INDIRECT_ACTION_DECLARE(tcf_bpf_act);\nTC_INDIRECT_ACTION_DECLARE(tcf_connmark_act);\nTC_INDIRECT_ACTION_DECLARE(tcf_csum_act);\nTC_INDIRECT_ACTION_DECLARE(tcf_ct_act);\nTC_INDIRECT_ACTION_DECLARE(tcf_ctinfo_act);\nTC_INDIRECT_ACTION_DECLARE(tcf_gact_act);\nTC_INDIRECT_ACTION_DECLARE(tcf_gate_act);\nTC_INDIRECT_ACTION_DECLARE(tcf_ife_act);\nTC_INDIRECT_ACTION_DECLARE(tcf_ipt_act);\nTC_INDIRECT_ACTION_DECLARE(tcf_mirred_act);\nTC_INDIRECT_ACTION_DECLARE(tcf_mpls_act);\nTC_INDIRECT_ACTION_DECLARE(tcf_nat_act);\nTC_INDIRECT_ACTION_DECLARE(tcf_pedit_act);\nTC_INDIRECT_ACTION_DECLARE(tcf_police_act);\nTC_INDIRECT_ACTION_DECLARE(tcf_sample_act);\nTC_INDIRECT_ACTION_DECLARE(tcf_simp_act);\nTC_INDIRECT_ACTION_DECLARE(tcf_skbedit_act);\nTC_INDIRECT_ACTION_DECLARE(tcf_skbmod_act);\nTC_INDIRECT_ACTION_DECLARE(tcf_vlan_act);\nTC_INDIRECT_ACTION_DECLARE(tunnel_key_act);\n\nstatic inline int tc_act(struct sk_buff *skb, const struct tc_action *a,\n\t\t\t   struct tcf_result *res)\n{\n\tif (static_branch_likely(&tc_skip_wrapper))\n\t\tgoto skip;\n\n#if IS_BUILTIN(CONFIG_NET_ACT_GACT)\n\tif (a->ops->act == tcf_gact_act)\n\t\treturn tcf_gact_act(skb, a, res);\n#endif\n#if IS_BUILTIN(CONFIG_NET_ACT_MIRRED)\n\tif (a->ops->act == tcf_mirred_act)\n\t\treturn tcf_mirred_act(skb, a, res);\n#endif\n#if IS_BUILTIN(CONFIG_NET_ACT_PEDIT)\n\tif (a->ops->act == tcf_pedit_act)\n\t\treturn tcf_pedit_act(skb, a, res);\n#endif\n#if IS_BUILTIN(CONFIG_NET_ACT_SKBEDIT)\n\tif (a->ops->act == tcf_skbedit_act)\n\t\treturn tcf_skbedit_act(skb, a, res);\n#endif\n#if IS_BUILTIN(CONFIG_NET_ACT_SKBMOD)\n\tif (a->ops->act == tcf_skbmod_act)\n\t\treturn tcf_skbmod_act(skb, a, res);\n#endif\n#if IS_BUILTIN(CONFIG_NET_ACT_POLICE)\n\tif (a->ops->act == tcf_police_act)\n\t\treturn tcf_police_act(skb, a, res);\n#endif\n#if IS_BUILTIN(CONFIG_NET_ACT_BPF)\n\tif (a->ops->act == tcf_bpf_act)\n\t\treturn tcf_bpf_act(skb, a, res);\n#endif\n#if IS_BUILTIN(CONFIG_NET_ACT_CONNMARK)\n\tif (a->ops->act == tcf_connmark_act)\n\t\treturn tcf_connmark_act(skb, a, res);\n#endif\n#if IS_BUILTIN(CONFIG_NET_ACT_CSUM)\n\tif (a->ops->act == tcf_csum_act)\n\t\treturn tcf_csum_act(skb, a, res);\n#endif\n#if IS_BUILTIN(CONFIG_NET_ACT_CT)\n\tif (a->ops->act == tcf_ct_act)\n\t\treturn tcf_ct_act(skb, a, res);\n#endif\n#if IS_BUILTIN(CONFIG_NET_ACT_CTINFO)\n\tif (a->ops->act == tcf_ctinfo_act)\n\t\treturn tcf_ctinfo_act(skb, a, res);\n#endif\n#if IS_BUILTIN(CONFIG_NET_ACT_GATE)\n\tif (a->ops->act == tcf_gate_act)\n\t\treturn tcf_gate_act(skb, a, res);\n#endif\n#if IS_BUILTIN(CONFIG_NET_ACT_MPLS)\n\tif (a->ops->act == tcf_mpls_act)\n\t\treturn tcf_mpls_act(skb, a, res);\n#endif\n#if IS_BUILTIN(CONFIG_NET_ACT_NAT)\n\tif (a->ops->act == tcf_nat_act)\n\t\treturn tcf_nat_act(skb, a, res);\n#endif\n#if IS_BUILTIN(CONFIG_NET_ACT_TUNNEL_KEY)\n\tif (a->ops->act == tunnel_key_act)\n\t\treturn tunnel_key_act(skb, a, res);\n#endif\n#if IS_BUILTIN(CONFIG_NET_ACT_VLAN)\n\tif (a->ops->act == tcf_vlan_act)\n\t\treturn tcf_vlan_act(skb, a, res);\n#endif\n#if IS_BUILTIN(CONFIG_NET_ACT_IFE)\n\tif (a->ops->act == tcf_ife_act)\n\t\treturn tcf_ife_act(skb, a, res);\n#endif\n#if IS_BUILTIN(CONFIG_NET_ACT_IPT)\n\tif (a->ops->act == tcf_ipt_act)\n\t\treturn tcf_ipt_act(skb, a, res);\n#endif\n#if IS_BUILTIN(CONFIG_NET_ACT_SIMP)\n\tif (a->ops->act == tcf_simp_act)\n\t\treturn tcf_simp_act(skb, a, res);\n#endif\n#if IS_BUILTIN(CONFIG_NET_ACT_SAMPLE)\n\tif (a->ops->act == tcf_sample_act)\n\t\treturn tcf_sample_act(skb, a, res);\n#endif\n\nskip:\n\treturn a->ops->act(skb, a, res);\n}\n\n#endif  \n\n \n#ifdef CONFIG_NET_CLS\n\n#define TC_INDIRECT_FILTER_DECLARE(fname)                               \\\n\tINDIRECT_CALLABLE_DECLARE(int fname(struct sk_buff *skb,        \\\n\t\t\t\t\t    const struct tcf_proto *tp, \\\n\t\t\t\t\t    struct tcf_result *res))\n\nTC_INDIRECT_FILTER_DECLARE(basic_classify);\nTC_INDIRECT_FILTER_DECLARE(cls_bpf_classify);\nTC_INDIRECT_FILTER_DECLARE(cls_cgroup_classify);\nTC_INDIRECT_FILTER_DECLARE(fl_classify);\nTC_INDIRECT_FILTER_DECLARE(flow_classify);\nTC_INDIRECT_FILTER_DECLARE(fw_classify);\nTC_INDIRECT_FILTER_DECLARE(mall_classify);\nTC_INDIRECT_FILTER_DECLARE(route4_classify);\nTC_INDIRECT_FILTER_DECLARE(u32_classify);\n\nstatic inline int tc_classify(struct sk_buff *skb, const struct tcf_proto *tp,\n\t\t\t\tstruct tcf_result *res)\n{\n\tif (static_branch_likely(&tc_skip_wrapper))\n\t\tgoto skip;\n\n#if IS_BUILTIN(CONFIG_NET_CLS_BPF)\n\tif (tp->classify == cls_bpf_classify)\n\t\treturn cls_bpf_classify(skb, tp, res);\n#endif\n#if IS_BUILTIN(CONFIG_NET_CLS_U32)\n\tif (tp->classify == u32_classify)\n\t\treturn u32_classify(skb, tp, res);\n#endif\n#if IS_BUILTIN(CONFIG_NET_CLS_FLOWER)\n\tif (tp->classify == fl_classify)\n\t\treturn fl_classify(skb, tp, res);\n#endif\n#if IS_BUILTIN(CONFIG_NET_CLS_FW)\n\tif (tp->classify == fw_classify)\n\t\treturn fw_classify(skb, tp, res);\n#endif\n#if IS_BUILTIN(CONFIG_NET_CLS_MATCHALL)\n\tif (tp->classify == mall_classify)\n\t\treturn mall_classify(skb, tp, res);\n#endif\n#if IS_BUILTIN(CONFIG_NET_CLS_BASIC)\n\tif (tp->classify == basic_classify)\n\t\treturn basic_classify(skb, tp, res);\n#endif\n#if IS_BUILTIN(CONFIG_NET_CLS_CGROUP)\n\tif (tp->classify == cls_cgroup_classify)\n\t\treturn cls_cgroup_classify(skb, tp, res);\n#endif\n#if IS_BUILTIN(CONFIG_NET_CLS_FLOW)\n\tif (tp->classify == flow_classify)\n\t\treturn flow_classify(skb, tp, res);\n#endif\n#if IS_BUILTIN(CONFIG_NET_CLS_ROUTE4)\n\tif (tp->classify == route4_classify)\n\t\treturn route4_classify(skb, tp, res);\n#endif\n\nskip:\n\treturn tp->classify(skb, tp, res);\n}\n\n#endif  \n\nstatic inline void tc_wrapper_init(void)\n{\n#ifdef CONFIG_X86\n\tif (!cpu_feature_enabled(X86_FEATURE_RETPOLINE))\n\t\tstatic_branch_enable(&tc_skip_wrapper);\n#endif\n}\n\n#else\n\n#define TC_INDIRECT_SCOPE static\n\nstatic inline int tc_act(struct sk_buff *skb, const struct tc_action *a,\n\t\t\t   struct tcf_result *res)\n{\n\treturn a->ops->act(skb, a, res);\n}\n\nstatic inline int tc_classify(struct sk_buff *skb, const struct tcf_proto *tp,\n\t\t\t\tstruct tcf_result *res)\n{\n\treturn tp->classify(skb, tp, res);\n}\n\nstatic inline void tc_wrapper_init(void)\n{\n}\n\n#endif\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}