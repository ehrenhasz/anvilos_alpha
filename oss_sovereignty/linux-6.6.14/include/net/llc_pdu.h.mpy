{
  "module_name": "llc_pdu.h",
  "hash_id": "8fb02300731bdc4a369259a350fe9cf1b851f449d72ebff7a2c8437a839bd139",
  "original_prompt": "Ingested from linux-6.6.14/include/net/llc_pdu.h",
  "human_readable_source": "#ifndef LLC_PDU_H\n#define LLC_PDU_H\n \n\n#include <linux/if_ether.h>\n\n \n#define LLC_PDU_LEN_I\t\t4        \n#define LLC_PDU_LEN_S\t\t4\n#define LLC_PDU_LEN_U\t\t3        \n \n#define LLC_PDU_LEN_U_XID\t(LLC_PDU_LEN_U + sizeof(struct llc_xid_info))\n \n#define LLC_GLOBAL_SAP\t0xFF\n#define LLC_NULL_SAP\t0x00\t \n#define LLC_MGMT_INDIV\t0x02\t \n#define LLC_MGMT_GRP\t0x03\t \n#define LLC_RDE_SAP\t0xA6\t \n\n \n#define LLC_ISO_RESERVED_SAP\t0x02\n#define LLC_SAP_GROUP_DSAP\t0x01\n#define LLC_SAP_RESP_SSAP\t0x01\n\n \n#define LLC_PDU_GROUP_DSAP_MASK    0x01\n#define LLC_PDU_IS_GROUP_DSAP(pdu)      \\\n\t((pdu->dsap & LLC_PDU_GROUP_DSAP_MASK) ? 0 : 1)\n#define LLC_PDU_IS_INDIV_DSAP(pdu)      \\\n\t(!(pdu->dsap & LLC_PDU_GROUP_DSAP_MASK) ? 0 : 1)\n\n \n#define LLC_PDU_CMD_RSP_MASK\t0x01\n#define LLC_PDU_CMD\t\t0\n#define LLC_PDU_RSP\t\t1\n#define LLC_PDU_IS_CMD(pdu)    ((pdu->ssap & LLC_PDU_RSP) ? 0 : 1)\n#define LLC_PDU_IS_RSP(pdu)    ((pdu->ssap & LLC_PDU_RSP) ? 1 : 0)\n\n \n#define LLC_PDU_TYPE_I_MASK    0x01\t \n#define LLC_PDU_TYPE_S_MASK    0x03\n#define LLC_PDU_TYPE_U_MASK    0x03\t \n#define LLC_PDU_TYPE_MASK      0x03\n\n#define LLC_PDU_TYPE_I\t\t0\t \n#define LLC_PDU_TYPE_S\t\t1\t \n#define LLC_PDU_TYPE_U\t\t3\t \n#define LLC_PDU_TYPE_U_XID\t4\t \n\n#define LLC_PDU_TYPE_IS_I(pdu) \\\n\t((!(pdu->ctrl_1 & LLC_PDU_TYPE_I_MASK)) ? 1 : 0)\n\n#define LLC_PDU_TYPE_IS_U(pdu) \\\n\t(((pdu->ctrl_1 & LLC_PDU_TYPE_U_MASK) == LLC_PDU_TYPE_U) ? 1 : 0)\n\n#define LLC_PDU_TYPE_IS_S(pdu) \\\n\t(((pdu->ctrl_1 & LLC_PDU_TYPE_S_MASK) == LLC_PDU_TYPE_S) ? 1 : 0)\n\n \n#define LLC_U_PF_BIT_MASK      0x10\t \n#define LLC_U_PF_IS_1(pdu)     ((pdu->ctrl_1 & LLC_U_PF_BIT_MASK) ? 1 : 0)\n#define LLC_U_PF_IS_0(pdu)     ((!(pdu->ctrl_1 & LLC_U_PF_BIT_MASK)) ? 1 : 0)\n\n#define LLC_U_PDU_CMD_MASK     0xEC\t \n#define LLC_U_PDU_CMD(pdu)     (pdu->ctrl_1 & LLC_U_PDU_CMD_MASK)\n#define LLC_U_PDU_RSP(pdu)     (pdu->ctrl_1 & LLC_U_PDU_CMD_MASK)\n\n#define LLC_1_PDU_CMD_UI       0x00\t \n#define LLC_1_PDU_CMD_XID      0xAC\n#define LLC_1_PDU_CMD_TEST     0xE0\n\n#define LLC_2_PDU_CMD_SABME    0x6C\t \n#define LLC_2_PDU_CMD_DISC     0x40\n#define LLC_2_PDU_RSP_UA       0x60\n#define LLC_2_PDU_RSP_DM       0x0C\n#define LLC_2_PDU_RSP_FRMR     0x84\n\n \n\n \n\n \n#define LLC_XID_FMT_ID\t\t0x81\t \n\n \n#define LLC_XID_CLASS_ZEROS_MASK\t0xE0\t \n#define LLC_XID_CLASS_MASK\t\t0x1F\t \n\n#define LLC_XID_NULL_CLASS_1\t0x01\t \n#define LLC_XID_NULL_CLASS_2\t0x03\n#define LLC_XID_NULL_CLASS_3\t0x05\n#define LLC_XID_NULL_CLASS_4\t0x07\n\n#define LLC_XID_NNULL_TYPE_1\t0x01\t \n#define LLC_XID_NNULL_TYPE_2\t0x02\n#define LLC_XID_NNULL_TYPE_3\t0x04\n#define LLC_XID_NNULL_TYPE_1_2\t0x03\n#define LLC_XID_NNULL_TYPE_1_3\t0x05\n#define LLC_XID_NNULL_TYPE_2_3\t0x06\n#define LLC_XID_NNULL_ALL\t\t0x07\n\n \n#define LLC_XID_RW_MASK\t0xFE\t \n\n#define LLC_XID_MIN_RW\t0x02\t \n\n \n\n#define LLC_2_SEQ_NBR_MODULO   ((u8) 128)\n\n \n#define LLC_I_GET_NS(pdu)     (u8)((pdu->ctrl_1 & 0xFE) >> 1)\n#define LLC_I_GET_NR(pdu)     (u8)((pdu->ctrl_2 & 0xFE) >> 1)\n\n#define LLC_I_PF_BIT_MASK      0x01\n\n#define LLC_I_PF_IS_0(pdu)     ((!(pdu->ctrl_2 & LLC_I_PF_BIT_MASK)) ? 1 : 0)\n#define LLC_I_PF_IS_1(pdu)     ((pdu->ctrl_2 & LLC_I_PF_BIT_MASK) ? 1 : 0)\n\n \n\n#define LLC_S_PDU_CMD_MASK     0x0C\n#define LLC_S_PDU_CMD(pdu)     (pdu->ctrl_1 & LLC_S_PDU_CMD_MASK)\n#define LLC_S_PDU_RSP(pdu)     (pdu->ctrl_1 & LLC_S_PDU_CMD_MASK)\n\n#define LLC_2_PDU_CMD_RR       0x00\t \n#define LLC_2_PDU_RSP_RR       0x00\t \n#define LLC_2_PDU_CMD_REJ      0x08\t \n#define LLC_2_PDU_RSP_REJ      0x08\t \n#define LLC_2_PDU_CMD_RNR      0x04\t \n#define LLC_2_PDU_RSP_RNR      0x04\t \n\n#define LLC_S_PF_BIT_MASK      0x01\n#define LLC_S_PF_IS_0(pdu)     ((!(pdu->ctrl_2 & LLC_S_PF_BIT_MASK)) ? 1 : 0)\n#define LLC_S_PF_IS_1(pdu)     ((pdu->ctrl_2 & LLC_S_PF_BIT_MASK) ? 1 : 0)\n\n#define PDU_SUPV_GET_Nr(pdu)   ((pdu->ctrl_2 & 0xFE) >> 1)\n#define PDU_GET_NEXT_Vr(sn)    (((sn) + 1) & ~LLC_2_SEQ_NBR_MODULO)\n\n \n\n#define FRMR_INFO_LENGTH       5\t \n\n \n#define FRMR_INFO_SET_REJ_CNTRL(info,rej_ctrl) \\\n\tinfo->rej_pdu_ctrl = ((*((u8 *) rej_ctrl) & \\\n\t\t\t\tLLC_PDU_TYPE_U) != LLC_PDU_TYPE_U ? \\\n\t\t\t\t(u16)*((u16 *) rej_ctrl) : \\\n\t\t\t\t(((u16) *((u8 *) rej_ctrl)) & 0x00FF))\n\n \n#define FRMR_INFO_SET_Vs(info,vs) (info->curr_ssv = (((u8) vs) << 1))\n#define FRMR_INFO_SET_Vr(info,vr) (info->curr_rsv = (((u8) vr) << 1))\n\n \n#define FRMR_INFO_SET_C_R_BIT(info, cr)  (info->curr_rsv |= (((u8) cr) & 0x01))\n\n \n#define FRMR_INFO_SET_INVALID_PDU_CTRL_IND(info, ind) \\\n       (info->ind_bits = ((info->ind_bits & 0xFE) | (((u8) ind) & 0x01)))\n\n#define FRMR_INFO_SET_INVALID_PDU_INFO_IND(info, ind) \\\n       (info->ind_bits = ( (info->ind_bits & 0xFD) | (((u8) ind) & 0x02)))\n\n#define FRMR_INFO_SET_PDU_INFO_2LONG_IND(info, ind) \\\n       (info->ind_bits = ( (info->ind_bits & 0xFB) | (((u8) ind) & 0x04)))\n\n#define FRMR_INFO_SET_PDU_INVALID_Nr_IND(info, ind) \\\n       (info->ind_bits = ( (info->ind_bits & 0xF7) | (((u8) ind) & 0x08)))\n\n#define FRMR_INFO_SET_PDU_INVALID_Ns_IND(info, ind) \\\n       (info->ind_bits = ( (info->ind_bits & 0xEF) | (((u8) ind) & 0x10)))\n\n \nstruct llc_pdu_sn {\n\tu8 dsap;\n\tu8 ssap;\n\tu8 ctrl_1;\n\tu8 ctrl_2;\n} __packed;\n\nstatic inline struct llc_pdu_sn *llc_pdu_sn_hdr(struct sk_buff *skb)\n{\n\treturn (struct llc_pdu_sn *)skb_network_header(skb);\n}\n\n \nstruct llc_pdu_un {\n\tu8 dsap;\n\tu8 ssap;\n\tu8 ctrl_1;\n} __packed;\n\nstatic inline struct llc_pdu_un *llc_pdu_un_hdr(struct sk_buff *skb)\n{\n\treturn (struct llc_pdu_un *)skb_network_header(skb);\n}\n\n \nstatic inline void llc_pdu_header_init(struct sk_buff *skb, u8 type,\n\t\t\t\t       u8 ssap, u8 dsap, u8 cr)\n{\n\tint hlen = 4;  \n\tstruct llc_pdu_un *pdu;\n\n\tswitch (type) {\n\tcase LLC_PDU_TYPE_U:\n\t\thlen = 3;\n\t\tbreak;\n\tcase LLC_PDU_TYPE_U_XID:\n\t\thlen = 6;\n\t\tbreak;\n\t}\n\n\tskb_push(skb, hlen);\n\tskb_reset_network_header(skb);\n\tpdu = llc_pdu_un_hdr(skb);\n\tpdu->dsap = dsap;\n\tpdu->ssap = ssap;\n\tpdu->ssap |= cr;\n}\n\n \nstatic inline void llc_pdu_decode_sa(struct sk_buff *skb, u8 *sa)\n{\n\tif (skb->protocol == htons(ETH_P_802_2))\n\t\tmemcpy(sa, eth_hdr(skb)->h_source, ETH_ALEN);\n}\n\n \nstatic inline void llc_pdu_decode_da(struct sk_buff *skb, u8 *da)\n{\n\tif (skb->protocol == htons(ETH_P_802_2))\n\t\tmemcpy(da, eth_hdr(skb)->h_dest, ETH_ALEN);\n}\n\n \nstatic inline void llc_pdu_decode_ssap(struct sk_buff *skb, u8 *ssap)\n{\n\t*ssap = llc_pdu_un_hdr(skb)->ssap & 0xFE;\n}\n\n \nstatic inline void llc_pdu_decode_dsap(struct sk_buff *skb, u8 *dsap)\n{\n\t*dsap = llc_pdu_un_hdr(skb)->dsap & 0xFE;\n}\n\n \nstatic inline void llc_pdu_init_as_ui_cmd(struct sk_buff *skb)\n{\n\tstruct llc_pdu_un *pdu = llc_pdu_un_hdr(skb);\n\n\tpdu->ctrl_1  = LLC_PDU_TYPE_U;\n\tpdu->ctrl_1 |= LLC_1_PDU_CMD_UI;\n}\n\n \nstatic inline void llc_pdu_init_as_test_cmd(struct sk_buff *skb)\n{\n\tstruct llc_pdu_un *pdu = llc_pdu_un_hdr(skb);\n\n\tpdu->ctrl_1  = LLC_PDU_TYPE_U;\n\tpdu->ctrl_1 |= LLC_1_PDU_CMD_TEST;\n\tpdu->ctrl_1 |= LLC_U_PF_BIT_MASK;\n}\n\n \nstatic inline void llc_pdu_init_as_test_rsp(struct sk_buff *skb,\n\t\t\t\t\t    struct sk_buff *ev_skb)\n{\n\tstruct llc_pdu_un *pdu = llc_pdu_un_hdr(skb);\n\n\tpdu->ctrl_1  = LLC_PDU_TYPE_U;\n\tpdu->ctrl_1 |= LLC_1_PDU_CMD_TEST;\n\tpdu->ctrl_1 |= LLC_U_PF_BIT_MASK;\n\tif (ev_skb->protocol == htons(ETH_P_802_2)) {\n\t\tstruct llc_pdu_un *ev_pdu = llc_pdu_un_hdr(ev_skb);\n\t\tint dsize;\n\n\t\tdsize = ntohs(eth_hdr(ev_skb)->h_proto) - 3;\n\t\tmemcpy(((u8 *)pdu) + 3, ((u8 *)ev_pdu) + 3, dsize);\n\t\tskb_put(skb, dsize);\n\t}\n}\n\n \nstruct llc_xid_info {\n\tu8 fmt_id;\t \n\tu8 type;\t \n\tu8 rw;\t\t \n} __packed;\n\n \nstatic inline void llc_pdu_init_as_xid_cmd(struct sk_buff *skb,\n\t\t\t\t\t   u8 svcs_supported, u8 rx_window)\n{\n\tstruct llc_xid_info *xid_info;\n\tstruct llc_pdu_un *pdu = llc_pdu_un_hdr(skb);\n\n\tpdu->ctrl_1\t = LLC_PDU_TYPE_U;\n\tpdu->ctrl_1\t|= LLC_1_PDU_CMD_XID;\n\tpdu->ctrl_1\t|= LLC_U_PF_BIT_MASK;\n\txid_info\t = (struct llc_xid_info *)(((u8 *)&pdu->ctrl_1) + 1);\n\txid_info->fmt_id = LLC_XID_FMT_ID;\t \n\txid_info->type\t = svcs_supported;\n\txid_info->rw\t = rx_window << 1;\t \n\n\t \n}\n\n \nstatic inline void llc_pdu_init_as_xid_rsp(struct sk_buff *skb,\n\t\t\t\t\t   u8 svcs_supported, u8 rx_window)\n{\n\tstruct llc_xid_info *xid_info;\n\tstruct llc_pdu_un *pdu = llc_pdu_un_hdr(skb);\n\n\tpdu->ctrl_1\t = LLC_PDU_TYPE_U;\n\tpdu->ctrl_1\t|= LLC_1_PDU_CMD_XID;\n\tpdu->ctrl_1\t|= LLC_U_PF_BIT_MASK;\n\n\txid_info\t = (struct llc_xid_info *)(((u8 *)&pdu->ctrl_1) + 1);\n\txid_info->fmt_id = LLC_XID_FMT_ID;\n\txid_info->type\t = svcs_supported;\n\txid_info->rw\t = rx_window << 1;\n\tskb_put(skb, sizeof(struct llc_xid_info));\n}\n\n \nstruct llc_frmr_info {\n\tu16 rej_pdu_ctrl;\t \n\tu8  curr_ssv;\t\t \n\tu8  curr_rsv;\t\t \n\tu8  ind_bits;\t\t \n} __packed;\n\nvoid llc_pdu_set_cmd_rsp(struct sk_buff *skb, u8 type);\nvoid llc_pdu_set_pf_bit(struct sk_buff *skb, u8 bit_value);\nvoid llc_pdu_decode_pf_bit(struct sk_buff *skb, u8 *pf_bit);\nvoid llc_pdu_init_as_disc_cmd(struct sk_buff *skb, u8 p_bit);\nvoid llc_pdu_init_as_i_cmd(struct sk_buff *skb, u8 p_bit, u8 ns, u8 nr);\nvoid llc_pdu_init_as_rej_cmd(struct sk_buff *skb, u8 p_bit, u8 nr);\nvoid llc_pdu_init_as_rnr_cmd(struct sk_buff *skb, u8 p_bit, u8 nr);\nvoid llc_pdu_init_as_rr_cmd(struct sk_buff *skb, u8 p_bit, u8 nr);\nvoid llc_pdu_init_as_sabme_cmd(struct sk_buff *skb, u8 p_bit);\nvoid llc_pdu_init_as_dm_rsp(struct sk_buff *skb, u8 f_bit);\nvoid llc_pdu_init_as_frmr_rsp(struct sk_buff *skb, struct llc_pdu_sn *prev_pdu,\n\t\t\t      u8 f_bit, u8 vs, u8 vr, u8 vzyxw);\nvoid llc_pdu_init_as_rr_rsp(struct sk_buff *skb, u8 f_bit, u8 nr);\nvoid llc_pdu_init_as_rej_rsp(struct sk_buff *skb, u8 f_bit, u8 nr);\nvoid llc_pdu_init_as_rnr_rsp(struct sk_buff *skb, u8 f_bit, u8 nr);\nvoid llc_pdu_init_as_ua_rsp(struct sk_buff *skb, u8 f_bit);\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}