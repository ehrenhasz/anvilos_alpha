{
  "module_name": "nci_core.h",
  "hash_id": "19cf188487f1824081bb3f3f5893abafac4be06007e03ddb281f4fe86074d2dc",
  "original_prompt": "Ingested from linux-6.6.14/include/net/nfc/nci_core.h",
  "human_readable_source": " \n \n\n#ifndef __NCI_CORE_H\n#define __NCI_CORE_H\n\n#include <linux/interrupt.h>\n#include <linux/skbuff.h>\n#include <linux/tty.h>\n\n#include <net/nfc/nfc.h>\n#include <net/nfc/nci.h>\n\n \nenum nci_flag {\n\tNCI_INIT,\n\tNCI_UP,\n\tNCI_DATA_EXCHANGE,\n\tNCI_DATA_EXCHANGE_TO,\n\tNCI_UNREG,\n};\n\n \nenum nci_state {\n\tNCI_IDLE,\n\tNCI_DISCOVERY,\n\tNCI_W4_ALL_DISCOVERIES,\n\tNCI_W4_HOST_SELECT,\n\tNCI_POLL_ACTIVE,\n\tNCI_LISTEN_ACTIVE,\n\tNCI_LISTEN_SLEEP,\n};\n\n \n#define NCI_RESET_TIMEOUT\t\t\t5000\n#define NCI_INIT_TIMEOUT\t\t\t5000\n#define NCI_SET_CONFIG_TIMEOUT\t\t\t5000\n#define NCI_RF_DISC_TIMEOUT\t\t\t5000\n#define NCI_RF_DISC_SELECT_TIMEOUT\t\t5000\n#define NCI_RF_DEACTIVATE_TIMEOUT\t\t30000\n#define NCI_CMD_TIMEOUT\t\t\t\t5000\n#define NCI_DATA_TIMEOUT\t\t\t700\n\nstruct nci_dev;\n\nstruct nci_driver_ops {\n\t__u16 opcode;\n\tint (*rsp)(struct nci_dev *dev, struct sk_buff *skb);\n\tint (*ntf)(struct nci_dev *dev, struct sk_buff *skb);\n};\n\nstruct nci_ops {\n\tint   (*init)(struct nci_dev *ndev);\n\tint   (*open)(struct nci_dev *ndev);\n\tint   (*close)(struct nci_dev *ndev);\n\tint   (*send)(struct nci_dev *ndev, struct sk_buff *skb);\n\tint   (*setup)(struct nci_dev *ndev);\n\tint   (*post_setup)(struct nci_dev *ndev);\n\tint   (*fw_download)(struct nci_dev *ndev, const char *firmware_name);\n\t__u32 (*get_rfprotocol)(struct nci_dev *ndev, __u8 rf_protocol);\n\tint   (*discover_se)(struct nci_dev *ndev);\n\tint   (*disable_se)(struct nci_dev *ndev, u32 se_idx);\n\tint   (*enable_se)(struct nci_dev *ndev, u32 se_idx);\n\tint   (*se_io)(struct nci_dev *ndev, u32 se_idx,\n\t\t\t\tu8 *apdu, size_t apdu_length,\n\t\t\t\tse_io_cb_t cb, void *cb_context);\n\tint   (*hci_load_session)(struct nci_dev *ndev);\n\tvoid  (*hci_event_received)(struct nci_dev *ndev, u8 pipe, u8 event,\n\t\t\t\t    struct sk_buff *skb);\n\tvoid  (*hci_cmd_received)(struct nci_dev *ndev, u8 pipe, u8 cmd,\n\t\t\t\t  struct sk_buff *skb);\n\n\tconst struct nci_driver_ops *prop_ops;\n\tsize_t n_prop_ops;\n\n\tconst struct nci_driver_ops *core_ops;\n\tsize_t n_core_ops;\n};\n\n#define NCI_MAX_SUPPORTED_RF_INTERFACES\t\t4\n#define NCI_MAX_DISCOVERED_TARGETS\t\t10\n#define NCI_MAX_NUM_NFCEE   255\n#define NCI_MAX_CONN_ID\t\t7\n#define NCI_MAX_PROPRIETARY_CMD 64\n\nstruct nci_conn_info {\n\tstruct list_head list;\n\t \n\tstruct dest_spec_params *dest_params;\n\t__u8\tdest_type;\n\t__u8\tconn_id;\n\t__u8\tmax_pkt_payload_len;\n\n\tatomic_t credits_cnt;\n\t__u8\t initial_num_credits;\n\n\tdata_exchange_cb_t\tdata_exchange_cb;\n\tvoid *data_exchange_cb_context;\n\n\tstruct sk_buff *rx_skb;\n};\n\n#define NCI_INVALID_CONN_ID 0x80\n\n#define NCI_HCI_ANY_OPEN_PIPE      0x03\n\n \n#define NCI_HCI_ADMIN_GATE         0x00\n#define NCI_HCI_LOOPBACK_GATE\t   0x04\n#define NCI_HCI_IDENTITY_MGMT_GATE 0x05\n#define NCI_HCI_LINK_MGMT_GATE     0x06\n\n \n#define NCI_HCI_LINK_MGMT_PIPE             0x00\n#define NCI_HCI_ADMIN_PIPE                 0x01\n\n \n#define NCI_HCI_ANY_OK                     0x00\n#define NCI_HCI_ANY_E_NOT_CONNECTED        0x01\n#define NCI_HCI_ANY_E_CMD_PAR_UNKNOWN      0x02\n#define NCI_HCI_ANY_E_NOK                  0x03\n#define NCI_HCI_ANY_E_PIPES_FULL           0x04\n#define NCI_HCI_ANY_E_REG_PAR_UNKNOWN      0x05\n#define NCI_HCI_ANY_E_PIPE_NOT_OPENED      0x06\n#define NCI_HCI_ANY_E_CMD_NOT_SUPPORTED    0x07\n#define NCI_HCI_ANY_E_INHIBITED            0x08\n#define NCI_HCI_ANY_E_TIMEOUT              0x09\n#define NCI_HCI_ANY_E_REG_ACCESS_DENIED    0x0a\n#define NCI_HCI_ANY_E_PIPE_ACCESS_DENIED   0x0b\n\n#define NCI_HCI_DO_NOT_OPEN_PIPE           0x81\n#define NCI_HCI_INVALID_PIPE               0x80\n#define NCI_HCI_INVALID_GATE               0xFF\n#define NCI_HCI_INVALID_HOST               0x80\n\n#define NCI_HCI_MAX_CUSTOM_GATES   50\n \n#define NCI_HCI_MAX_PIPES          128\n\nstruct nci_hci_gate {\n\tu8 gate;\n\tu8 pipe;\n\tu8 dest_host;\n} __packed;\n\nstruct nci_hci_pipe {\n\tu8 gate;\n\tu8 host;\n} __packed;\n\nstruct nci_hci_init_data {\n\tu8 gate_count;\n\tstruct nci_hci_gate gates[NCI_HCI_MAX_CUSTOM_GATES];\n\tchar session_id[9];\n};\n\n#define NCI_HCI_MAX_GATES          256\n\nstruct nci_hci_dev {\n\tu8 nfcee_id;\n\tstruct nci_dev *ndev;\n\tstruct nci_conn_info *conn_info;\n\n\tstruct nci_hci_init_data init_data;\n\tstruct nci_hci_pipe pipes[NCI_HCI_MAX_PIPES];\n\tu8 gate2pipe[NCI_HCI_MAX_GATES];\n\tint expected_pipes;\n\tint count_pipes;\n\n\tstruct sk_buff_head rx_hcp_frags;\n\tstruct work_struct msg_rx_work;\n\tstruct sk_buff_head msg_rx_queue;\n};\n\n \nstruct nci_dev {\n\tstruct nfc_dev\t\t*nfc_dev;\n\tconst struct nci_ops\t*ops;\n\tstruct nci_hci_dev\t*hci_dev;\n\n\tint\t\t\ttx_headroom;\n\tint\t\t\ttx_tailroom;\n\n\tatomic_t\t\tstate;\n\tunsigned long\t\tflags;\n\n\tatomic_t\t\tcmd_cnt;\n\t__u8\t\t\tcur_conn_id;\n\n\tstruct list_head\tconn_info_list;\n\tstruct nci_conn_info\t*rf_conn_info;\n\n\tstruct timer_list\tcmd_timer;\n\tstruct timer_list\tdata_timer;\n\n\tstruct workqueue_struct\t*cmd_wq;\n\tstruct work_struct\tcmd_work;\n\n\tstruct workqueue_struct\t*rx_wq;\n\tstruct work_struct\trx_work;\n\n\tstruct workqueue_struct\t*tx_wq;\n\tstruct work_struct\ttx_work;\n\n\tstruct sk_buff_head\tcmd_q;\n\tstruct sk_buff_head\trx_q;\n\tstruct sk_buff_head\ttx_q;\n\n\tstruct mutex\t\treq_lock;\n\tstruct completion\treq_completion;\n\t__u32\t\t\treq_status;\n\t__u32\t\t\treq_result;\n\n\tvoid\t\t\t*driver_data;\n\n\t__u32\t\t\tpoll_prots;\n\t__u32\t\t\ttarget_active_prot;\n\n\tstruct nfc_target\ttargets[NCI_MAX_DISCOVERED_TARGETS];\n\tint\t\t\tn_targets;\n\n\t \n\t__u8\t\t\tnci_ver;\n\n\t \n\t__u32\t\t\tnfcc_features;\n\t__u8\t\t\tnum_supported_rf_interfaces;\n\t__u8\t\t\tsupported_rf_interfaces\n\t\t\t\t[NCI_MAX_SUPPORTED_RF_INTERFACES];\n\t__u8\t\t\tmax_logical_connections;\n\t__u16\t\t\tmax_routing_table_size;\n\t__u8\t\t\tmax_ctrl_pkt_payload_len;\n\t__u16\t\t\tmax_size_for_large_params;\n\t__u8\t\t\tmanufact_id;\n\t__u32\t\t\tmanufact_specific_info;\n\n\t \n\tstruct dest_spec_params cur_params;\n\t \n\t__u8\t\t\tcur_dest_type;\n\n\t \n\tstruct sk_buff\t\t*rx_data_reassembly;\n\n\t \n\t__u8 remote_gb[NFC_MAX_GT_LEN];\n\t__u8 remote_gb_len;\n};\n\n \nstruct nci_dev *nci_allocate_device(const struct nci_ops *ops,\n\t\t\t\t    __u32 supported_protocols,\n\t\t\t\t    int tx_headroom,\n\t\t\t\t    int tx_tailroom);\nvoid nci_free_device(struct nci_dev *ndev);\nint nci_register_device(struct nci_dev *ndev);\nvoid nci_unregister_device(struct nci_dev *ndev);\nint nci_request(struct nci_dev *ndev,\n\t\tvoid (*req)(struct nci_dev *ndev,\n\t\t\t    const void *opt),\n\t\tconst void *opt, __u32 timeout);\nint nci_prop_cmd(struct nci_dev *ndev, __u8 oid, size_t len,\n\t\t const __u8 *payload);\nint nci_core_cmd(struct nci_dev *ndev, __u16 opcode, size_t len,\n\t\t const __u8 *payload);\nint nci_core_reset(struct nci_dev *ndev);\nint nci_core_init(struct nci_dev *ndev);\n\nint nci_recv_frame(struct nci_dev *ndev, struct sk_buff *skb);\nint nci_send_frame(struct nci_dev *ndev, struct sk_buff *skb);\nint nci_set_config(struct nci_dev *ndev, __u8 id, size_t len, const __u8 *val);\n\nint nci_nfcee_discover(struct nci_dev *ndev, u8 action);\nint nci_nfcee_mode_set(struct nci_dev *ndev, u8 nfcee_id, u8 nfcee_mode);\nint nci_core_conn_create(struct nci_dev *ndev, u8 destination_type,\n\t\t\t u8 number_destination_params,\n\t\t\t size_t params_len,\n\t\t\t const struct core_conn_create_dest_spec_params *params);\nint nci_core_conn_close(struct nci_dev *ndev, u8 conn_id);\nint nci_nfcc_loopback(struct nci_dev *ndev, const void *data, size_t data_len,\n\t\t      struct sk_buff **resp);\n\nstruct nci_hci_dev *nci_hci_allocate(struct nci_dev *ndev);\nvoid nci_hci_deallocate(struct nci_dev *ndev);\nint nci_hci_send_event(struct nci_dev *ndev, u8 gate, u8 event,\n\t\t       const u8 *param, size_t param_len);\nint nci_hci_send_cmd(struct nci_dev *ndev, u8 gate,\n\t\t     u8 cmd, const u8 *param, size_t param_len,\n\t\t     struct sk_buff **skb);\nint nci_hci_open_pipe(struct nci_dev *ndev, u8 pipe);\nint nci_hci_connect_gate(struct nci_dev *ndev, u8 dest_host,\n\t\t\t u8 dest_gate, u8 pipe);\nint nci_hci_set_param(struct nci_dev *ndev, u8 gate, u8 idx,\n\t\t      const u8 *param, size_t param_len);\nint nci_hci_get_param(struct nci_dev *ndev, u8 gate, u8 idx,\n\t\t      struct sk_buff **skb);\nint nci_hci_clear_all_pipes(struct nci_dev *ndev);\nint nci_hci_dev_session_init(struct nci_dev *ndev);\n\nstatic inline struct sk_buff *nci_skb_alloc(struct nci_dev *ndev,\n\t\t\t\t\t    unsigned int len,\n\t\t\t\t\t    gfp_t how)\n{\n\tstruct sk_buff *skb;\n\n\tskb = alloc_skb(len + ndev->tx_headroom + ndev->tx_tailroom, how);\n\tif (skb)\n\t\tskb_reserve(skb, ndev->tx_headroom);\n\n\treturn skb;\n}\n\nstatic inline void nci_set_parent_dev(struct nci_dev *ndev, struct device *dev)\n{\n\tnfc_set_parent_dev(ndev->nfc_dev, dev);\n}\n\nstatic inline void nci_set_drvdata(struct nci_dev *ndev, void *data)\n{\n\tndev->driver_data = data;\n}\n\nstatic inline void *nci_get_drvdata(struct nci_dev *ndev)\n{\n\treturn ndev->driver_data;\n}\n\nstatic inline int nci_set_vendor_cmds(struct nci_dev *ndev,\n\t\t\t\t      const struct nfc_vendor_cmd *cmds,\n\t\t\t\t      int n_cmds)\n{\n\treturn nfc_set_vendor_cmds(ndev->nfc_dev, cmds, n_cmds);\n}\n\nvoid nci_rsp_packet(struct nci_dev *ndev, struct sk_buff *skb);\nvoid nci_ntf_packet(struct nci_dev *ndev, struct sk_buff *skb);\nint nci_prop_rsp_packet(struct nci_dev *ndev, __u16 opcode,\n\t\t\tstruct sk_buff *skb);\nint nci_prop_ntf_packet(struct nci_dev *ndev, __u16 opcode,\n\t\t\tstruct sk_buff *skb);\nint nci_core_rsp_packet(struct nci_dev *ndev, __u16 opcode,\n\t\t\tstruct sk_buff *skb);\nint nci_core_ntf_packet(struct nci_dev *ndev, __u16 opcode,\n\t\t\tstruct sk_buff *skb);\nvoid nci_rx_data_packet(struct nci_dev *ndev, struct sk_buff *skb);\nint nci_send_cmd(struct nci_dev *ndev, __u16 opcode, __u8 plen, const void *payload);\nint nci_send_data(struct nci_dev *ndev, __u8 conn_id, struct sk_buff *skb);\nint nci_conn_max_data_pkt_payload_size(struct nci_dev *ndev, __u8 conn_id);\nvoid nci_data_exchange_complete(struct nci_dev *ndev, struct sk_buff *skb,\n\t\t\t\t__u8 conn_id, int err);\nvoid nci_hci_data_received_cb(void *context, struct sk_buff *skb, int err);\n\nvoid nci_clear_target_list(struct nci_dev *ndev);\n\n \n#define NCI_REQ_DONE\t\t0\n#define NCI_REQ_PEND\t\t1\n#define NCI_REQ_CANCELED\t2\n\nvoid nci_req_complete(struct nci_dev *ndev, int result);\nstruct nci_conn_info *nci_get_conn_info_by_conn_id(struct nci_dev *ndev,\n\t\t\t\t\t\t   int conn_id);\nint nci_get_conn_info_by_dest_type_params(struct nci_dev *ndev, u8 dest_type,\n\t\t\t\t\t  const struct dest_spec_params *params);\n\n \nint nci_to_errno(__u8 code);\n\n \n#define NCI_SPI_CRC_DISABLED\t0x00\n#define NCI_SPI_CRC_ENABLED\t0x01\n\n \nstruct nci_spi {\n\tstruct nci_dev\t\t*ndev;\n\tstruct spi_device\t*spi;\n\n\tunsigned int\t\txfer_udelay;\t \n\n\tunsigned int\t\txfer_speed_hz;  \n\n\tu8\t\t\tacknowledge_mode;\n\n\tstruct completion\treq_completion;\n\tu8\t\t\treq_result;\n};\n\n \nstruct nci_spi *nci_spi_allocate_spi(struct spi_device *spi,\n\t\t\t\t     u8 acknowledge_mode, unsigned int delay,\n\t\t\t\t     struct nci_dev *ndev);\nint nci_spi_send(struct nci_spi *nspi,\n\t\t struct completion *write_handshake_completion,\n\t\t struct sk_buff *skb);\nstruct sk_buff *nci_spi_read(struct nci_spi *nspi);\n\n \n\n \n#define NCIUARTSETDRIVER\t_IOW('U', 0, char *)\n\nenum nci_uart_driver {\n\tNCI_UART_DRIVER_MARVELL = 0,\n\tNCI_UART_DRIVER_MAX\n};\n\nstruct nci_uart;\n\nstruct nci_uart_ops {\n\tint (*open)(struct nci_uart *nci_uart);\n\tvoid (*close)(struct nci_uart *nci_uart);\n\tint (*recv)(struct nci_uart *nci_uart, struct sk_buff *skb);\n\tint (*send)(struct nci_uart *nci_uart, struct sk_buff *skb);\n\tvoid (*tx_start)(struct nci_uart *nci_uart);\n\tvoid (*tx_done)(struct nci_uart *nci_uart);\n};\n\nstruct nci_uart {\n\tstruct module\t\t*owner;\n\tstruct nci_uart_ops\tops;\n\tconst char\t\t*name;\n\tenum nci_uart_driver\tdriver;\n\n\t \n\tstruct nci_dev\t\t*ndev;\n\tspinlock_t\t\trx_lock;\n\tstruct work_struct\twrite_work;\n\tstruct tty_struct\t*tty;\n\tunsigned long\t\ttx_state;\n\tstruct sk_buff_head\ttx_q;\n\tstruct sk_buff\t\t*tx_skb;\n\tstruct sk_buff\t\t*rx_skb;\n\tint\t\t\trx_packet_len;\n\tvoid\t\t\t*drv_data;\n};\n\nint nci_uart_register(struct nci_uart *nu);\nvoid nci_uart_unregister(struct nci_uart *nu);\nvoid nci_uart_set_config(struct nci_uart *nu, int baudrate, int flow_ctrl);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}