{
  "module_name": "test-statx.c",
  "hash_id": "5804e53f00cb2c70265642693132d2f3b7c1a9f4348f90a82da2061252658b39",
  "original_prompt": "Ingested from linux-6.6.14/samples/vfs/test-statx.c",
  "human_readable_source": "\n \n\n#define _GNU_SOURCE\n#define _ATFILE_SOURCE\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <errno.h>\n#include <time.h>\n#include <sys/syscall.h>\n#include <sys/types.h>\n#include <linux/stat.h>\n#include <linux/fcntl.h>\n#define statx foo\n#define statx_timestamp foo_timestamp\nstruct statx;\nstruct statx_timestamp;\n#include <sys/stat.h>\n#undef statx\n#undef statx_timestamp\n\n#define AT_STATX_SYNC_TYPE\t0x6000\n#define AT_STATX_SYNC_AS_STAT\t0x0000\n#define AT_STATX_FORCE_SYNC\t0x2000\n#define AT_STATX_DONT_SYNC\t0x4000\n\n#ifndef __NR_statx\n#define __NR_statx -1\n#endif\n\nstatic __attribute__((unused))\nssize_t statx(int dfd, const char *filename, unsigned flags,\n\t      unsigned int mask, struct statx *buffer)\n{\n\treturn syscall(__NR_statx, dfd, filename, flags, mask, buffer);\n}\n\nstatic void print_time(const char *field, struct statx_timestamp *ts)\n{\n\tstruct tm tm;\n\ttime_t tim;\n\tchar buffer[100];\n\tint len;\n\n\ttim = ts->tv_sec;\n\tif (!localtime_r(&tim, &tm)) {\n\t\tperror(\"localtime_r\");\n\t\texit(1);\n\t}\n\tlen = strftime(buffer, 100, \"%F %T\", &tm);\n\tif (len == 0) {\n\t\tperror(\"strftime\");\n\t\texit(1);\n\t}\n\tprintf(\"%s\", field);\n\tfwrite(buffer, 1, len, stdout);\n\tprintf(\".%09u\", ts->tv_nsec);\n\tlen = strftime(buffer, 100, \"%z\", &tm);\n\tif (len == 0) {\n\t\tperror(\"strftime2\");\n\t\texit(1);\n\t}\n\tfwrite(buffer, 1, len, stdout);\n\tprintf(\"\\n\");\n}\n\nstatic void dump_statx(struct statx *stx)\n{\n\tchar buffer[256], ft = '?';\n\n\tprintf(\"results=%x\\n\", stx->stx_mask);\n\n\tprintf(\" \");\n\tif (stx->stx_mask & STATX_SIZE)\n\t\tprintf(\" Size: %-15llu\", (unsigned long long)stx->stx_size);\n\tif (stx->stx_mask & STATX_BLOCKS)\n\t\tprintf(\" Blocks: %-10llu\", (unsigned long long)stx->stx_blocks);\n\tprintf(\" IO Block: %-6llu\", (unsigned long long)stx->stx_blksize);\n\tif (stx->stx_mask & STATX_TYPE) {\n\t\tswitch (stx->stx_mode & S_IFMT) {\n\t\tcase S_IFIFO:\tprintf(\"  FIFO\\n\");\t\t\tft = 'p'; break;\n\t\tcase S_IFCHR:\tprintf(\"  character special file\\n\");\tft = 'c'; break;\n\t\tcase S_IFDIR:\tprintf(\"  directory\\n\");\t\tft = 'd'; break;\n\t\tcase S_IFBLK:\tprintf(\"  block special file\\n\");\tft = 'b'; break;\n\t\tcase S_IFREG:\tprintf(\"  regular file\\n\");\t\tft = '-'; break;\n\t\tcase S_IFLNK:\tprintf(\"  symbolic link\\n\");\t\tft = 'l'; break;\n\t\tcase S_IFSOCK:\tprintf(\"  socket\\n\");\t\t\tft = 's'; break;\n\t\tdefault:\n\t\t\tprintf(\" unknown type (%o)\\n\", stx->stx_mode & S_IFMT);\n\t\t\tbreak;\n\t\t}\n\t} else {\n\t\tprintf(\" no type\\n\");\n\t}\n\n\tsprintf(buffer, \"%02x:%02x\", stx->stx_dev_major, stx->stx_dev_minor);\n\tprintf(\"Device: %-15s\", buffer);\n\tif (stx->stx_mask & STATX_INO)\n\t\tprintf(\" Inode: %-11llu\", (unsigned long long) stx->stx_ino);\n\tif (stx->stx_mask & STATX_NLINK)\n\t\tprintf(\" Links: %-5u\", stx->stx_nlink);\n\tif (stx->stx_mask & STATX_TYPE) {\n\t\tswitch (stx->stx_mode & S_IFMT) {\n\t\tcase S_IFBLK:\n\t\tcase S_IFCHR:\n\t\t\tprintf(\" Device type: %u,%u\",\n\t\t\t       stx->stx_rdev_major, stx->stx_rdev_minor);\n\t\t\tbreak;\n\t\t}\n\t}\n\tprintf(\"\\n\");\n\n\tif (stx->stx_mask & STATX_MODE)\n\t\tprintf(\"Access: (%04o/%c%c%c%c%c%c%c%c%c%c)  \",\n\t\t       stx->stx_mode & 07777,\n\t\t       ft,\n\t\t       stx->stx_mode & S_IRUSR ? 'r' : '-',\n\t\t       stx->stx_mode & S_IWUSR ? 'w' : '-',\n\t\t       stx->stx_mode & S_IXUSR ? 'x' : '-',\n\t\t       stx->stx_mode & S_IRGRP ? 'r' : '-',\n\t\t       stx->stx_mode & S_IWGRP ? 'w' : '-',\n\t\t       stx->stx_mode & S_IXGRP ? 'x' : '-',\n\t\t       stx->stx_mode & S_IROTH ? 'r' : '-',\n\t\t       stx->stx_mode & S_IWOTH ? 'w' : '-',\n\t\t       stx->stx_mode & S_IXOTH ? 'x' : '-');\n\tif (stx->stx_mask & STATX_UID)\n\t\tprintf(\"Uid: %5d   \", stx->stx_uid);\n\tif (stx->stx_mask & STATX_GID)\n\t\tprintf(\"Gid: %5d\\n\", stx->stx_gid);\n\n\tif (stx->stx_mask & STATX_ATIME)\n\t\tprint_time(\"Access: \", &stx->stx_atime);\n\tif (stx->stx_mask & STATX_MTIME)\n\t\tprint_time(\"Modify: \", &stx->stx_mtime);\n\tif (stx->stx_mask & STATX_CTIME)\n\t\tprint_time(\"Change: \", &stx->stx_ctime);\n\tif (stx->stx_mask & STATX_BTIME)\n\t\tprint_time(\" Birth: \", &stx->stx_btime);\n\n\tif (stx->stx_attributes_mask) {\n\t\tunsigned char bits, mbits;\n\t\tint loop, byte;\n\n\t\tstatic char attr_representation[64 + 1] =\n\t\t\t \n\t\t\t\"????????\"\t \n\t\t\t\"????????\"\t \n\t\t\t\"????????\"\t \n\t\t\t\"????????\"\t \n\t\t\t\"????????\"\t \n\t\t\t\"????????\"\t \n\t\t\t\"???me???\"\t \n\t\t\t\"?dai?c??\"\t \n\t\t\t;\n\n\t\tprintf(\"Attributes: %016llx (\",\n\t\t       (unsigned long long)stx->stx_attributes);\n\t\tfor (byte = 64 - 8; byte >= 0; byte -= 8) {\n\t\t\tbits = stx->stx_attributes >> byte;\n\t\t\tmbits = stx->stx_attributes_mask >> byte;\n\t\t\tfor (loop = 7; loop >= 0; loop--) {\n\t\t\t\tint bit = byte + loop;\n\n\t\t\t\tif (!(mbits & 0x80))\n\t\t\t\t\tputchar('.');\t \n\t\t\t\telse if (bits & 0x80)\n\t\t\t\t\tputchar(attr_representation[63 - bit]);\n\t\t\t\telse\n\t\t\t\t\tputchar('-');\t \n\t\t\t\tbits <<= 1;\n\t\t\t\tmbits <<= 1;\n\t\t\t}\n\t\t\tif (byte)\n\t\t\t\tputchar(' ');\n\t\t}\n\t\tprintf(\")\\n\");\n\t}\n}\n\nstatic void dump_hex(unsigned long long *data, int from, int to)\n{\n\tunsigned offset, print_offset = 1, col = 0;\n\n\tfrom /= 8;\n\tto = (to + 7) / 8;\n\n\tfor (offset = from; offset < to; offset++) {\n\t\tif (print_offset) {\n\t\t\tprintf(\"%04x: \", offset * 8);\n\t\t\tprint_offset = 0;\n\t\t}\n\t\tprintf(\"%016llx\", data[offset]);\n\t\tcol++;\n\t\tif ((col & 3) == 0) {\n\t\t\tprintf(\"\\n\");\n\t\t\tprint_offset = 1;\n\t\t} else {\n\t\t\tprintf(\" \");\n\t\t}\n\t}\n\n\tif (!print_offset)\n\t\tprintf(\"\\n\");\n}\n\nint main(int argc, char **argv)\n{\n\tstruct statx stx;\n\tint ret, raw = 0, atflag = AT_SYMLINK_NOFOLLOW;\n\n\tunsigned int mask = STATX_BASIC_STATS | STATX_BTIME;\n\n\tfor (argv++; *argv; argv++) {\n\t\tif (strcmp(*argv, \"-F\") == 0) {\n\t\t\tatflag &= ~AT_STATX_SYNC_TYPE;\n\t\t\tatflag |= AT_STATX_FORCE_SYNC;\n\t\t\tcontinue;\n\t\t}\n\t\tif (strcmp(*argv, \"-D\") == 0) {\n\t\t\tatflag &= ~AT_STATX_SYNC_TYPE;\n\t\t\tatflag |= AT_STATX_DONT_SYNC;\n\t\t\tcontinue;\n\t\t}\n\t\tif (strcmp(*argv, \"-L\") == 0) {\n\t\t\tatflag &= ~AT_SYMLINK_NOFOLLOW;\n\t\t\tcontinue;\n\t\t}\n\t\tif (strcmp(*argv, \"-O\") == 0) {\n\t\t\tmask &= ~STATX_BASIC_STATS;\n\t\t\tcontinue;\n\t\t}\n\t\tif (strcmp(*argv, \"-A\") == 0) {\n\t\t\tatflag |= AT_NO_AUTOMOUNT;\n\t\t\tcontinue;\n\t\t}\n\t\tif (strcmp(*argv, \"-R\") == 0) {\n\t\t\traw = 1;\n\t\t\tcontinue;\n\t\t}\n\n\t\tmemset(&stx, 0xbf, sizeof(stx));\n\t\tret = statx(AT_FDCWD, *argv, atflag, mask, &stx);\n\t\tprintf(\"statx(%s) = %d\\n\", *argv, ret);\n\t\tif (ret < 0) {\n\t\t\tperror(*argv);\n\t\t\texit(1);\n\t\t}\n\n\t\tif (raw)\n\t\t\tdump_hex((unsigned long long *)&stx, 0, sizeof(stx));\n\n\t\tdump_statx(&stx);\n\t}\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}