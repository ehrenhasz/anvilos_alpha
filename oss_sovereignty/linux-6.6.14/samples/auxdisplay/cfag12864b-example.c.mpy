{
  "module_name": "cfag12864b-example.c",
  "hash_id": "12f87dc06e6975021ef563149622e1f3ac140144ffe42c54580200650eb4b200",
  "original_prompt": "Ingested from linux-6.6.14/samples/auxdisplay/cfag12864b-example.c",
  "human_readable_source": "\n \n\n \n\n#include <string.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/mman.h>\n\n#define CFAG12864B_WIDTH\t\t(128)\n#define CFAG12864B_HEIGHT\t\t(64)\n#define CFAG12864B_SIZE\t\t\t(128 * 64 / 8)\n#define CFAG12864B_BPB\t\t\t(8)\n#define CFAG12864B_ADDRESS(x, y)\t((y) * CFAG12864B_WIDTH / \\\n\t\t\t\t\tCFAG12864B_BPB + (x) / CFAG12864B_BPB)\n#define CFAG12864B_BIT(n)\t\t(((unsigned char) 1) << (n))\n\n#undef CFAG12864B_DOCHECK\n#ifdef CFAG12864B_DOCHECK\n\t#define CFAG12864B_CHECK(x, y)\t\t((x) < CFAG12864B_WIDTH && \\\n\t\t\t\t\t\t(y) < CFAG12864B_HEIGHT)\n#else\n\t#define CFAG12864B_CHECK(x, y)\t\t(1)\n#endif\n\nint cfag12864b_fd;\nunsigned char * cfag12864b_mem;\nunsigned char cfag12864b_buffer[CFAG12864B_SIZE];\n\n \nstatic int cfag12864b_init(char *path)\n{\n\tcfag12864b_fd = open(path, O_RDWR);\n\tif (cfag12864b_fd == -1)\n\t\treturn -1;\n\n\tcfag12864b_mem = mmap(0, CFAG12864B_SIZE, PROT_READ | PROT_WRITE,\n\t\tMAP_SHARED, cfag12864b_fd, 0);\n\tif (cfag12864b_mem == MAP_FAILED) {\n\t\tclose(cfag12864b_fd);\n\t\treturn -2;\n\t}\n\n\treturn 0;\n}\n\n \nstatic void cfag12864b_exit(void)\n{\n\tmunmap(cfag12864b_mem, CFAG12864B_SIZE);\n\tclose(cfag12864b_fd);\n}\n\n \nstatic void cfag12864b_set(unsigned char x, unsigned char y)\n{\n\tif (CFAG12864B_CHECK(x, y))\n\t\tcfag12864b_buffer[CFAG12864B_ADDRESS(x, y)] |=\n\t\t\tCFAG12864B_BIT(x % CFAG12864B_BPB);\n}\n\n \nstatic void cfag12864b_unset(unsigned char x, unsigned char y)\n{\n\tif (CFAG12864B_CHECK(x, y))\n\t\tcfag12864b_buffer[CFAG12864B_ADDRESS(x, y)] &=\n\t\t\t~CFAG12864B_BIT(x % CFAG12864B_BPB);\n}\n\n \nstatic unsigned char cfag12864b_isset(unsigned char x, unsigned char y)\n{\n\tif (CFAG12864B_CHECK(x, y))\n\t\tif (cfag12864b_buffer[CFAG12864B_ADDRESS(x, y)] &\n\t\t\tCFAG12864B_BIT(x % CFAG12864B_BPB))\n\t\t\treturn 1;\n\n\treturn 0;\n}\n\n \nstatic void cfag12864b_not(unsigned char x, unsigned char y)\n{\n\tif (cfag12864b_isset(x, y))\n\t\tcfag12864b_unset(x, y);\n\telse\n\t\tcfag12864b_set(x, y);\n}\n\n \nstatic void cfag12864b_fill(void)\n{\n\tunsigned short i;\n\n\tfor (i = 0; i < CFAG12864B_SIZE; i++)\n\t\tcfag12864b_buffer[i] = 0xFF;\n}\n\n \nstatic void cfag12864b_clear(void)\n{\n\tunsigned short i;\n\n\tfor (i = 0; i < CFAG12864B_SIZE; i++)\n\t\tcfag12864b_buffer[i] = 0;\n}\n\n \nstatic void cfag12864b_format(unsigned char * matrix)\n{\n\tunsigned char i, j, n;\n\n\tfor (i = 0; i < CFAG12864B_HEIGHT; i++)\n\tfor (j = 0; j < CFAG12864B_WIDTH / CFAG12864B_BPB; j++) {\n\t\tcfag12864b_buffer[i * CFAG12864B_WIDTH / CFAG12864B_BPB +\n\t\t\tj] = 0;\n\t\tfor (n = 0; n < CFAG12864B_BPB; n++)\n\t\t\tif (matrix[i * CFAG12864B_WIDTH +\n\t\t\t\tj * CFAG12864B_BPB + n])\n\t\t\t\tcfag12864b_buffer[i * CFAG12864B_WIDTH /\n\t\t\t\t\tCFAG12864B_BPB + j] |=\n\t\t\t\t\tCFAG12864B_BIT(n);\n\t}\n}\n\n \nstatic void cfag12864b_blit(void)\n{\n\tmemcpy(cfag12864b_mem, cfag12864b_buffer, CFAG12864B_SIZE);\n}\n\n \n\n#include <stdio.h>\n\n#define EXAMPLES\t6\n\nstatic void example(unsigned char n)\n{\n\tunsigned short i, j;\n\tunsigned char matrix[CFAG12864B_WIDTH * CFAG12864B_HEIGHT];\n\n\tif (n > EXAMPLES)\n\t\treturn;\n\n\tprintf(\"Example %i/%i - \", n, EXAMPLES);\n\n\tswitch (n) {\n\tcase 1:\n\t\tprintf(\"Draw points setting bits\");\n\t\tcfag12864b_clear();\n\t\tfor (i = 0; i < CFAG12864B_WIDTH; i += 2)\n\t\t\tfor (j = 0; j < CFAG12864B_HEIGHT; j += 2)\n\t\t\t\tcfag12864b_set(i, j);\n\t\tbreak;\n\n\tcase 2:\n\t\tprintf(\"Clear the LCD\");\n\t\tcfag12864b_clear();\n\t\tbreak;\n\n\tcase 3:\n\t\tprintf(\"Draw rows formatting a [128*64] matrix\");\n\t\tmemset(matrix, 0, CFAG12864B_WIDTH * CFAG12864B_HEIGHT);\n\t\tfor (i = 0; i < CFAG12864B_WIDTH; i++)\n\t\t\tfor (j = 0; j < CFAG12864B_HEIGHT; j += 2)\n\t\t\t\tmatrix[j * CFAG12864B_WIDTH + i] = 1;\n\t\tcfag12864b_format(matrix);\n\t\tbreak;\n\n\tcase 4:\n\t\tprintf(\"Fill the lcd\");\n\t\tcfag12864b_fill();\n\t\tbreak;\n\n\tcase 5:\n\t\tprintf(\"Draw columns unsetting bits\");\n\t\tfor (i = 0; i < CFAG12864B_WIDTH; i += 2)\n\t\t\tfor (j = 0; j < CFAG12864B_HEIGHT; j++)\n\t\t\t\tcfag12864b_unset(i, j);\n\t\tbreak;\n\n\tcase 6:\n\t\tprintf(\"Do negative not-ing all bits\");\n\t\tfor (i = 0; i < CFAG12864B_WIDTH; i++)\n\t\t\tfor (j = 0; j < CFAG12864B_HEIGHT; j ++)\n\t\t\t\tcfag12864b_not(i, j);\n\t\tbreak;\n\t}\n\n\tputs(\" - [Press Enter]\");\n}\n\nint main(int argc, char *argv[])\n{\n\tunsigned char n;\n\n\tif (argc != 2) {\n\t\tprintf(\n\t\t\t\"Syntax:  %s fbdev\\n\"\n\t\t\t\"Usually: /dev/fb0, /dev/fb1...\\n\", argv[0]);\n\t\treturn -1;\n\t}\n\n\tif (cfag12864b_init(argv[1])) {\n\t\tprintf(\"Can't init %s fbdev\\n\", argv[1]);\n\t\treturn -2;\n\t}\n\n\tfor (n = 1; n <= EXAMPLES; n++) {\n\t\texample(n);\n\t\tcfag12864b_blit();\n\t\twhile (getchar() != '\\n');\n\t}\n\n\tcfag12864b_exit();\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}