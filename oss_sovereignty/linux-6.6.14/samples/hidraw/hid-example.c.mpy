{
  "module_name": "hid-example.c",
  "hash_id": "0424af32ed3b695ce53d32c9950745d207443390298ac3f4aeac91ab4782fbc5",
  "original_prompt": "Ingested from linux-6.6.14/samples/hidraw/hid-example.c",
  "human_readable_source": "\n \n\n \n#include <linux/types.h>\n#include <linux/input.h>\n#include <linux/hidraw.h>\n\n \n#ifndef HIDIOCSFEATURE\n#warning Please have your distro update the userspace kernel headers\n#define HIDIOCSFEATURE(len)    _IOC(_IOC_WRITE|_IOC_READ, 'H', 0x06, len)\n#define HIDIOCGFEATURE(len)    _IOC(_IOC_WRITE|_IOC_READ, 'H', 0x07, len)\n#endif\n\n \n#include <sys/ioctl.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <unistd.h>\n\n \n#include <stdio.h>\n#include <string.h>\n#include <stdlib.h>\n#include <errno.h>\n\nconst char *bus_str(int bus);\n\nint main(int argc, char **argv)\n{\n\tint fd;\n\tint i, res, desc_size = 0;\n\tchar buf[256];\n\tstruct hidraw_report_descriptor rpt_desc;\n\tstruct hidraw_devinfo info;\n\tchar *device = \"/dev/hidraw0\";\n\n\tif (argc > 1)\n\t\tdevice = argv[1];\n\n\t \n\tfd = open(device, O_RDWR|O_NONBLOCK);\n\n\tif (fd < 0) {\n\t\tperror(\"Unable to open device\");\n\t\treturn 1;\n\t}\n\n\tmemset(&rpt_desc, 0x0, sizeof(rpt_desc));\n\tmemset(&info, 0x0, sizeof(info));\n\tmemset(buf, 0x0, sizeof(buf));\n\n\t \n\tres = ioctl(fd, HIDIOCGRDESCSIZE, &desc_size);\n\tif (res < 0)\n\t\tperror(\"HIDIOCGRDESCSIZE\");\n\telse\n\t\tprintf(\"Report Descriptor Size: %d\\n\", desc_size);\n\n\t \n\trpt_desc.size = desc_size;\n\tres = ioctl(fd, HIDIOCGRDESC, &rpt_desc);\n\tif (res < 0) {\n\t\tperror(\"HIDIOCGRDESC\");\n\t} else {\n\t\tprintf(\"Report Descriptor:\\n\");\n\t\tfor (i = 0; i < rpt_desc.size; i++)\n\t\t\tprintf(\"%hhx \", rpt_desc.value[i]);\n\t\tputs(\"\\n\");\n\t}\n\n\t \n\tres = ioctl(fd, HIDIOCGRAWNAME(256), buf);\n\tif (res < 0)\n\t\tperror(\"HIDIOCGRAWNAME\");\n\telse\n\t\tprintf(\"Raw Name: %s\\n\", buf);\n\n\t \n\tres = ioctl(fd, HIDIOCGRAWPHYS(256), buf);\n\tif (res < 0)\n\t\tperror(\"HIDIOCGRAWPHYS\");\n\telse\n\t\tprintf(\"Raw Phys: %s\\n\", buf);\n\n\t \n\tres = ioctl(fd, HIDIOCGRAWINFO, &info);\n\tif (res < 0) {\n\t\tperror(\"HIDIOCGRAWINFO\");\n\t} else {\n\t\tprintf(\"Raw Info:\\n\");\n\t\tprintf(\"\\tbustype: %d (%s)\\n\",\n\t\t\tinfo.bustype, bus_str(info.bustype));\n\t\tprintf(\"\\tvendor: 0x%04hx\\n\", info.vendor);\n\t\tprintf(\"\\tproduct: 0x%04hx\\n\", info.product);\n\t}\n\n\t \n\tbuf[0] = 0x9;  \n\tbuf[1] = 0xff;\n\tbuf[2] = 0xff;\n\tbuf[3] = 0xff;\n\tres = ioctl(fd, HIDIOCSFEATURE(4), buf);\n\tif (res < 0)\n\t\tperror(\"HIDIOCSFEATURE\");\n\telse\n\t\tprintf(\"ioctl HIDIOCSFEATURE returned: %d\\n\", res);\n\n\t \n\tbuf[0] = 0x9;  \n\tres = ioctl(fd, HIDIOCGFEATURE(256), buf);\n\tif (res < 0) {\n\t\tperror(\"HIDIOCGFEATURE\");\n\t} else {\n\t\tprintf(\"ioctl HIDIOCGFEATURE returned: %d\\n\", res);\n\t\tprintf(\"Report data:\\n\\t\");\n\t\tfor (i = 0; i < res; i++)\n\t\t\tprintf(\"%hhx \", buf[i]);\n\t\tputs(\"\\n\");\n\t}\n\n\t \n\tbuf[0] = 0x1;  \n\tbuf[1] = 0x77;\n\tres = write(fd, buf, 2);\n\tif (res < 0) {\n\t\tprintf(\"Error: %d\\n\", errno);\n\t\tperror(\"write\");\n\t} else {\n\t\tprintf(\"write() wrote %d bytes\\n\", res);\n\t}\n\n\t \n\tres = read(fd, buf, 16);\n\tif (res < 0) {\n\t\tperror(\"read\");\n\t} else {\n\t\tprintf(\"read() read %d bytes:\\n\\t\", res);\n\t\tfor (i = 0; i < res; i++)\n\t\t\tprintf(\"%hhx \", buf[i]);\n\t\tputs(\"\\n\");\n\t}\n\tclose(fd);\n\treturn 0;\n}\n\nconst char *\nbus_str(int bus)\n{\n\tswitch (bus) {\n\tcase BUS_USB:\n\t\treturn \"USB\";\n\t\tbreak;\n\tcase BUS_HIL:\n\t\treturn \"HIL\";\n\t\tbreak;\n\tcase BUS_BLUETOOTH:\n\t\treturn \"Bluetooth\";\n\t\tbreak;\n\tcase BUS_VIRTUAL:\n\t\treturn \"Virtual\";\n\t\tbreak;\n\tdefault:\n\t\treturn \"Other\";\n\t\tbreak;\n\t}\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}