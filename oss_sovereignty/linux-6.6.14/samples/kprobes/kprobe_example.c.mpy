{
  "module_name": "kprobe_example.c",
  "hash_id": "d8fe2f752412e90bd07282fcb64221c028eaaeee6c1a44c1f0988361bbd467ea",
  "original_prompt": "Ingested from linux-6.6.14/samples/kprobes/kprobe_example.c",
  "human_readable_source": "\n \n\n#define pr_fmt(fmt) \"%s: \" fmt, __func__\n\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/kprobes.h>\n\nstatic char symbol[KSYM_NAME_LEN] = \"kernel_clone\";\nmodule_param_string(symbol, symbol, KSYM_NAME_LEN, 0644);\n\n \nstatic struct kprobe kp = {\n\t.symbol_name\t= symbol,\n};\n\n \nstatic int __kprobes handler_pre(struct kprobe *p, struct pt_regs *regs)\n{\n#ifdef CONFIG_X86\n\tpr_info(\"<%s> p->addr = 0x%p, ip = %lx, flags = 0x%lx\\n\",\n\t\tp->symbol_name, p->addr, regs->ip, regs->flags);\n#endif\n#ifdef CONFIG_PPC\n\tpr_info(\"<%s> p->addr = 0x%p, nip = 0x%lx, msr = 0x%lx\\n\",\n\t\tp->symbol_name, p->addr, regs->nip, regs->msr);\n#endif\n#ifdef CONFIG_MIPS\n\tpr_info(\"<%s> p->addr = 0x%p, epc = 0x%lx, status = 0x%lx\\n\",\n\t\tp->symbol_name, p->addr, regs->cp0_epc, regs->cp0_status);\n#endif\n#ifdef CONFIG_ARM64\n\tpr_info(\"<%s> p->addr = 0x%p, pc = 0x%lx, pstate = 0x%lx\\n\",\n\t\tp->symbol_name, p->addr, (long)regs->pc, (long)regs->pstate);\n#endif\n#ifdef CONFIG_ARM\n\tpr_info(\"<%s> p->addr = 0x%p, pc = 0x%lx, cpsr = 0x%lx\\n\",\n\t\tp->symbol_name, p->addr, (long)regs->ARM_pc, (long)regs->ARM_cpsr);\n#endif\n#ifdef CONFIG_RISCV\n\tpr_info(\"<%s> p->addr = 0x%p, pc = 0x%lx, status = 0x%lx\\n\",\n\t\tp->symbol_name, p->addr, regs->epc, regs->status);\n#endif\n#ifdef CONFIG_S390\n\tpr_info(\"<%s> p->addr, 0x%p, ip = 0x%lx, flags = 0x%lx\\n\",\n\t\tp->symbol_name, p->addr, regs->psw.addr, regs->flags);\n#endif\n#ifdef CONFIG_LOONGARCH\n\tpr_info(\"<%s> p->addr = 0x%p, era = 0x%lx, estat = 0x%lx\\n\",\n\t\tp->symbol_name, p->addr, regs->csr_era, regs->csr_estat);\n#endif\n\n\t \n\treturn 0;\n}\n\n \nstatic void __kprobes handler_post(struct kprobe *p, struct pt_regs *regs,\n\t\t\t\tunsigned long flags)\n{\n#ifdef CONFIG_X86\n\tpr_info(\"<%s> p->addr = 0x%p, flags = 0x%lx\\n\",\n\t\tp->symbol_name, p->addr, regs->flags);\n#endif\n#ifdef CONFIG_PPC\n\tpr_info(\"<%s> p->addr = 0x%p, msr = 0x%lx\\n\",\n\t\tp->symbol_name, p->addr, regs->msr);\n#endif\n#ifdef CONFIG_MIPS\n\tpr_info(\"<%s> p->addr = 0x%p, status = 0x%lx\\n\",\n\t\tp->symbol_name, p->addr, regs->cp0_status);\n#endif\n#ifdef CONFIG_ARM64\n\tpr_info(\"<%s> p->addr = 0x%p, pstate = 0x%lx\\n\",\n\t\tp->symbol_name, p->addr, (long)regs->pstate);\n#endif\n#ifdef CONFIG_ARM\n\tpr_info(\"<%s> p->addr = 0x%p, cpsr = 0x%lx\\n\",\n\t\tp->symbol_name, p->addr, (long)regs->ARM_cpsr);\n#endif\n#ifdef CONFIG_RISCV\n\tpr_info(\"<%s> p->addr = 0x%p, status = 0x%lx\\n\",\n\t\tp->symbol_name, p->addr, regs->status);\n#endif\n#ifdef CONFIG_S390\n\tpr_info(\"<%s> p->addr, 0x%p, flags = 0x%lx\\n\",\n\t\tp->symbol_name, p->addr, regs->flags);\n#endif\n#ifdef CONFIG_LOONGARCH\n\tpr_info(\"<%s> p->addr = 0x%p, estat = 0x%lx\\n\",\n\t\tp->symbol_name, p->addr, regs->csr_estat);\n#endif\n}\n\nstatic int __init kprobe_init(void)\n{\n\tint ret;\n\tkp.pre_handler = handler_pre;\n\tkp.post_handler = handler_post;\n\n\tret = register_kprobe(&kp);\n\tif (ret < 0) {\n\t\tpr_err(\"register_kprobe failed, returned %d\\n\", ret);\n\t\treturn ret;\n\t}\n\tpr_info(\"Planted kprobe at %p\\n\", kp.addr);\n\treturn 0;\n}\n\nstatic void __exit kprobe_exit(void)\n{\n\tunregister_kprobe(&kp);\n\tpr_info(\"kprobe at %p unregistered\\n\", kp.addr);\n}\n\nmodule_init(kprobe_init)\nmodule_exit(kprobe_exit)\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}