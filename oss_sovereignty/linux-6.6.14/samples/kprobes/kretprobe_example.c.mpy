{
  "module_name": "kretprobe_example.c",
  "hash_id": "7bcd589813a35e4ba61274a653519e3ea83708f2dd7214db8c56fdd2cdfa7043",
  "original_prompt": "Ingested from linux-6.6.14/samples/kprobes/kretprobe_example.c",
  "human_readable_source": "\n \n\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/kprobes.h>\n#include <linux/ktime.h>\n#include <linux/sched.h>\n\nstatic char func_name[KSYM_NAME_LEN] = \"kernel_clone\";\nmodule_param_string(func, func_name, KSYM_NAME_LEN, 0644);\nMODULE_PARM_DESC(func, \"Function to kretprobe; this module will report the\"\n\t\t\t\" function's execution time\");\n\n \nstruct my_data {\n\tktime_t entry_stamp;\n};\n\n \nstatic int entry_handler(struct kretprobe_instance *ri, struct pt_regs *regs)\n{\n\tstruct my_data *data;\n\n\tif (!current->mm)\n\t\treturn 1;\t \n\n\tdata = (struct my_data *)ri->data;\n\tdata->entry_stamp = ktime_get();\n\treturn 0;\n}\nNOKPROBE_SYMBOL(entry_handler);\n\n \nstatic int ret_handler(struct kretprobe_instance *ri, struct pt_regs *regs)\n{\n\tunsigned long retval = regs_return_value(regs);\n\tstruct my_data *data = (struct my_data *)ri->data;\n\ts64 delta;\n\tktime_t now;\n\n\tnow = ktime_get();\n\tdelta = ktime_to_ns(ktime_sub(now, data->entry_stamp));\n\tpr_info(\"%s returned %lu and took %lld ns to execute\\n\",\n\t\t\tfunc_name, retval, (long long)delta);\n\treturn 0;\n}\nNOKPROBE_SYMBOL(ret_handler);\n\nstatic struct kretprobe my_kretprobe = {\n\t.handler\t\t= ret_handler,\n\t.entry_handler\t\t= entry_handler,\n\t.data_size\t\t= sizeof(struct my_data),\n\t \n\t.maxactive\t\t= 20,\n};\n\nstatic int __init kretprobe_init(void)\n{\n\tint ret;\n\n\tmy_kretprobe.kp.symbol_name = func_name;\n\tret = register_kretprobe(&my_kretprobe);\n\tif (ret < 0) {\n\t\tpr_err(\"register_kretprobe failed, returned %d\\n\", ret);\n\t\treturn ret;\n\t}\n\tpr_info(\"Planted return probe at %s: %p\\n\",\n\t\t\tmy_kretprobe.kp.symbol_name, my_kretprobe.kp.addr);\n\treturn 0;\n}\n\nstatic void __exit kretprobe_exit(void)\n{\n\tunregister_kretprobe(&my_kretprobe);\n\tpr_info(\"kretprobe at %p unregistered\\n\", my_kretprobe.kp.addr);\n\n\t \n\tpr_info(\"Missed probing %d instances of %s\\n\",\n\t\tmy_kretprobe.nmissed, my_kretprobe.kp.symbol_name);\n}\n\nmodule_init(kretprobe_init)\nmodule_exit(kretprobe_exit)\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}