{
  "module_name": "livepatch-callbacks-demo.c",
  "hash_id": "6e107c630d5220d592ca7edc0b93de3d9363a77899e3e711620c7551ceaa7e88",
  "original_prompt": "Ingested from linux-6.6.14/samples/livepatch/livepatch-callbacks-demo.c",
  "human_readable_source": "\n \n\n \n\n#define pr_fmt(fmt) KBUILD_MODNAME \": \" fmt\n\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/livepatch.h>\n\nstatic int pre_patch_ret;\nmodule_param(pre_patch_ret, int, 0644);\nMODULE_PARM_DESC(pre_patch_ret, \"pre_patch_ret (default=0)\");\n\nstatic const char *const module_state[] = {\n\t[MODULE_STATE_LIVE]\t= \"[MODULE_STATE_LIVE] Normal state\",\n\t[MODULE_STATE_COMING]\t= \"[MODULE_STATE_COMING] Full formed, running module_init\",\n\t[MODULE_STATE_GOING]\t= \"[MODULE_STATE_GOING] Going away\",\n\t[MODULE_STATE_UNFORMED]\t= \"[MODULE_STATE_UNFORMED] Still setting it up\",\n};\n\nstatic void callback_info(const char *callback, struct klp_object *obj)\n{\n\tif (obj->mod)\n\t\tpr_info(\"%s: %s -> %s\\n\", callback, obj->mod->name,\n\t\t\tmodule_state[obj->mod->state]);\n\telse\n\t\tpr_info(\"%s: vmlinux\\n\", callback);\n}\n\n \nstatic int pre_patch_callback(struct klp_object *obj)\n{\n\tcallback_info(__func__, obj);\n\treturn pre_patch_ret;\n}\n\n \nstatic void post_patch_callback(struct klp_object *obj)\n{\n\tcallback_info(__func__, obj);\n}\n\n \nstatic void pre_unpatch_callback(struct klp_object *obj)\n{\n\tcallback_info(__func__, obj);\n}\n\n \nstatic void post_unpatch_callback(struct klp_object *obj)\n{\n\tcallback_info(__func__, obj);\n}\n\nstatic void patched_work_func(struct work_struct *work)\n{\n\tpr_info(\"%s\\n\", __func__);\n}\n\nstatic struct klp_func no_funcs[] = {\n\t{ }\n};\n\nstatic struct klp_func busymod_funcs[] = {\n\t{\n\t\t.old_name = \"busymod_work_func\",\n\t\t.new_func = patched_work_func,\n\t}, { }\n};\n\nstatic struct klp_object objs[] = {\n\t{\n\t\t.name = NULL,\t \n\t\t.funcs = no_funcs,\n\t\t.callbacks = {\n\t\t\t.pre_patch = pre_patch_callback,\n\t\t\t.post_patch = post_patch_callback,\n\t\t\t.pre_unpatch = pre_unpatch_callback,\n\t\t\t.post_unpatch = post_unpatch_callback,\n\t\t},\n\t},\t{\n\t\t.name = \"livepatch_callbacks_mod\",\n\t\t.funcs = no_funcs,\n\t\t.callbacks = {\n\t\t\t.pre_patch = pre_patch_callback,\n\t\t\t.post_patch = post_patch_callback,\n\t\t\t.pre_unpatch = pre_unpatch_callback,\n\t\t\t.post_unpatch = post_unpatch_callback,\n\t\t},\n\t},\t{\n\t\t.name = \"livepatch_callbacks_busymod\",\n\t\t.funcs = busymod_funcs,\n\t\t.callbacks = {\n\t\t\t.pre_patch = pre_patch_callback,\n\t\t\t.post_patch = post_patch_callback,\n\t\t\t.pre_unpatch = pre_unpatch_callback,\n\t\t\t.post_unpatch = post_unpatch_callback,\n\t\t},\n\t}, { }\n};\n\nstatic struct klp_patch patch = {\n\t.mod = THIS_MODULE,\n\t.objs = objs,\n};\n\nstatic int livepatch_callbacks_demo_init(void)\n{\n\treturn klp_enable_patch(&patch);\n}\n\nstatic void livepatch_callbacks_demo_exit(void)\n{\n}\n\nmodule_init(livepatch_callbacks_demo_init);\nmodule_exit(livepatch_callbacks_demo_exit);\nMODULE_LICENSE(\"GPL\");\nMODULE_INFO(livepatch, \"Y\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}