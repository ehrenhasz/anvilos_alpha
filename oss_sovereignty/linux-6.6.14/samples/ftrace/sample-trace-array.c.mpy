{
  "module_name": "sample-trace-array.c",
  "hash_id": "45b56c70e6250fd955ac5254847673342de02d180e312f0def834f46169b9635",
  "original_prompt": "Ingested from linux-6.6.14/samples/ftrace/sample-trace-array.c",
  "human_readable_source": "\n#include <linux/module.h>\n#include <linux/kthread.h>\n#include <linux/trace.h>\n#include <linux/trace_events.h>\n#include <linux/timer.h>\n#include <linux/err.h>\n#include <linux/jiffies.h>\n#include <linux/workqueue.h>\n\n \n#define CREATE_TRACE_POINTS\n#include \"sample-trace-array.h\"\n\nstruct trace_array *tr;\nstatic void mytimer_handler(struct timer_list *unused);\nstatic struct task_struct *simple_tsk;\n\nstatic void trace_work_fn(struct work_struct *work)\n{\n\t \n\ttrace_array_set_clr_event(tr, \"sample-subsystem\", \"sample_event\",\n\t\t\tfalse);\n}\nstatic DECLARE_WORK(trace_work, trace_work_fn);\n\n \nstatic DEFINE_TIMER(mytimer, mytimer_handler);\n\nstatic void mytimer_handler(struct timer_list *unused)\n{\n\tschedule_work(&trace_work);\n}\n\nstatic void simple_thread_func(int count)\n{\n\tset_current_state(TASK_INTERRUPTIBLE);\n\tschedule_timeout(HZ);\n\n\t \n\ttrace_array_printk(tr, _THIS_IP_, \"trace_array_printk: count=%d\\n\",\n\t\t\tcount);\n\t \n\ttrace_sample_event(count, jiffies);\n}\n\nstatic int simple_thread(void *arg)\n{\n\tint count = 0;\n\tunsigned long delay = msecs_to_jiffies(5000);\n\n\t \n\ttrace_array_set_clr_event(tr, \"sample-subsystem\", \"sample_event\", true);\n\n\t \n\tadd_timer(&mytimer);\n\tmod_timer(&mytimer, jiffies+delay);\n\n\twhile (!kthread_should_stop())\n\t\tsimple_thread_func(count++);\n\n\tdel_timer(&mytimer);\n\tcancel_work_sync(&trace_work);\n\n\t \n\ttrace_array_put(tr);\n\n\treturn 0;\n}\n\nstatic int __init sample_trace_array_init(void)\n{\n\t \n\ttr = trace_array_get_by_name(\"sample-instance\");\n\n\tif (!tr)\n\t\treturn -1;\n\t \n\ttrace_printk_init_buffers();\n\n\tsimple_tsk = kthread_run(simple_thread, NULL, \"sample-instance\");\n\tif (IS_ERR(simple_tsk)) {\n\t\ttrace_array_put(tr);\n\t\ttrace_array_destroy(tr);\n\t\treturn -1;\n\t}\n\n\treturn 0;\n}\n\nstatic void __exit sample_trace_array_exit(void)\n{\n\tkthread_stop(simple_tsk);\n\n\t \n\ttrace_array_destroy(tr);\n}\n\nmodule_init(sample_trace_array_init);\nmodule_exit(sample_trace_array_exit);\n\nMODULE_AUTHOR(\"Divya Indi\");\nMODULE_DESCRIPTION(\"Sample module for kernel access to Ftrace instances\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}