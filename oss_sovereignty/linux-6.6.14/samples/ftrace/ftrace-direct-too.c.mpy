{
  "module_name": "ftrace-direct-too.c",
  "hash_id": "4d3911f8eba27637a09d2081539dce06d98c8812b4658654520cb38db35b28c7",
  "original_prompt": "Ingested from linux-6.6.14/samples/ftrace/ftrace-direct-too.c",
  "human_readable_source": "\n#include <linux/module.h>\n\n#include <linux/mm.h>  \n#include <linux/ftrace.h>\n#ifndef CONFIG_ARM64\n#include <asm/asm-offsets.h>\n#endif\n\nextern void my_direct_func(struct vm_area_struct *vma, unsigned long address,\n\t\t\t   unsigned int flags, struct pt_regs *regs);\n\nvoid my_direct_func(struct vm_area_struct *vma, unsigned long address,\n\t\t    unsigned int flags, struct pt_regs *regs)\n{\n\ttrace_printk(\"handle mm fault vma=%p address=%lx flags=%x regs=%p\\n\",\n\t\t     vma, address, flags, regs);\n}\n\nextern void my_tramp(void *);\n\n#ifdef CONFIG_X86_64\n\n#include <asm/ibt.h>\n#include <asm/nospec-branch.h>\n\nasm (\n\"\t.pushsection    .text, \\\"ax\\\", @progbits\\n\"\n\"\t.type\t\tmy_tramp, @function\\n\"\n\"\t.globl\t\tmy_tramp\\n\"\n\"   my_tramp:\"\n\tASM_ENDBR\n\"\tpushq %rbp\\n\"\n\"\tmovq %rsp, %rbp\\n\"\n\tCALL_DEPTH_ACCOUNT\n\"\tpushq %rdi\\n\"\n\"\tpushq %rsi\\n\"\n\"\tpushq %rdx\\n\"\n\"\tpushq %rcx\\n\"\n\"\tcall my_direct_func\\n\"\n\"\tpopq %rcx\\n\"\n\"\tpopq %rdx\\n\"\n\"\tpopq %rsi\\n\"\n\"\tpopq %rdi\\n\"\n\"\tleave\\n\"\n\tASM_RET\n\"\t.size\t\tmy_tramp, .-my_tramp\\n\"\n\"\t.popsection\\n\"\n);\n\n#endif  \n\n#ifdef CONFIG_S390\n\nasm (\n\"\t.pushsection\t.text, \\\"ax\\\", @progbits\\n\"\n\"\t.type\t\tmy_tramp, @function\\n\"\n\"\t.globl\t\tmy_tramp\\n\"\n\"   my_tramp:\"\n\"\tlgr\t\t%r1,%r15\\n\"\n\"\tstmg\t\t%r0,%r5,\"__stringify(__SF_GPRS)\"(%r15)\\n\"\n\"\tstg\t\t%r14,\"__stringify(__SF_GPRS+8*8)\"(%r15)\\n\"\n\"\taghi\t\t%r15,\"__stringify(-STACK_FRAME_OVERHEAD)\"\\n\"\n\"\tstg\t\t%r1,\"__stringify(__SF_BACKCHAIN)\"(%r15)\\n\"\n\"\tbrasl\t\t%r14,my_direct_func\\n\"\n\"\taghi\t\t%r15,\"__stringify(STACK_FRAME_OVERHEAD)\"\\n\"\n\"\tlmg\t\t%r0,%r5,\"__stringify(__SF_GPRS)\"(%r15)\\n\"\n\"\tlg\t\t%r14,\"__stringify(__SF_GPRS+8*8)\"(%r15)\\n\"\n\"\tlgr\t\t%r1,%r0\\n\"\n\"\tbr\t\t%r1\\n\"\n\"\t.size\t\tmy_tramp, .-my_tramp\\n\"\n\"\t.popsection\\n\"\n);\n\n#endif  \n\n#ifdef CONFIG_ARM64\n\nasm (\n\"\t.pushsection\t.text, \\\"ax\\\", @progbits\\n\"\n\"\t.type\t\tmy_tramp, @function\\n\"\n\"\t.globl\t\tmy_tramp\\n\"\n\"   my_tramp:\"\n\"\thint\t34\\n\" \n\"\tsub\tsp, sp, #48\\n\"\n\"\tstp\tx9, x30, [sp]\\n\"\n\"\tstp\tx0, x1, [sp, #16]\\n\"\n\"\tstp\tx2, x3, [sp, #32]\\n\"\n\"\tbl\tmy_direct_func\\n\"\n\"\tldp\tx30, x9, [sp]\\n\"\n\"\tldp\tx0, x1, [sp, #16]\\n\"\n\"\tldp\tx2, x3, [sp, #32]\\n\"\n\"\tadd\tsp, sp, #48\\n\"\n\"\tret\tx9\\n\"\n\"\t.size\t\tmy_tramp, .-my_tramp\\n\"\n\"\t.popsection\\n\"\n);\n\n#endif  \n\n#ifdef CONFIG_LOONGARCH\n\nasm (\n\"\t.pushsection\t.text, \\\"ax\\\", @progbits\\n\"\n\"\t.type\t\tmy_tramp, @function\\n\"\n\"\t.globl\t\tmy_tramp\\n\"\n\"   my_tramp:\\n\"\n\"\taddi.d\t$sp, $sp, -48\\n\"\n\"\tst.d\t$a0, $sp, 0\\n\"\n\"\tst.d\t$a1, $sp, 8\\n\"\n\"\tst.d\t$a2, $sp, 16\\n\"\n\"\tst.d\t$t0, $sp, 24\\n\"\n\"\tst.d\t$ra, $sp, 32\\n\"\n\"\tbl\tmy_direct_func\\n\"\n\"\tld.d\t$a0, $sp, 0\\n\"\n\"\tld.d\t$a1, $sp, 8\\n\"\n\"\tld.d\t$a2, $sp, 16\\n\"\n\"\tld.d\t$t0, $sp, 24\\n\"\n\"\tld.d\t$ra, $sp, 32\\n\"\n\"\taddi.d\t$sp, $sp, 48\\n\"\n\"\tjr\t$t0\\n\"\n\"\t.size\t\tmy_tramp, .-my_tramp\\n\"\n\"\t.popsection\\n\"\n);\n\n#endif  \n\nstatic struct ftrace_ops direct;\n\nstatic int __init ftrace_direct_init(void)\n{\n\tftrace_set_filter_ip(&direct, (unsigned long) handle_mm_fault, 0, 0);\n\n\treturn register_ftrace_direct(&direct, (unsigned long) my_tramp);\n}\n\nstatic void __exit ftrace_direct_exit(void)\n{\n\tunregister_ftrace_direct(&direct, (unsigned long)my_tramp, true);\n}\n\nmodule_init(ftrace_direct_init);\nmodule_exit(ftrace_direct_exit);\n\nMODULE_AUTHOR(\"Steven Rostedt\");\nMODULE_DESCRIPTION(\"Another example use case of using register_ftrace_direct()\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}