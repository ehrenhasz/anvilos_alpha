{
  "module_name": "dma-example.c",
  "hash_id": "516e53100632762d5b8f5ba0f2a759ca19592f02842d67410ac77485e82fad5d",
  "original_prompt": "Ingested from linux-6.6.14/samples/kfifo/dma-example.c",
  "human_readable_source": "\n \n\n#include <linux/init.h>\n#include <linux/module.h>\n#include <linux/kfifo.h>\n\n \n\n \n#define FIFO_SIZE\t32\n\nstatic struct kfifo fifo;\n\nstatic int __init example_init(void)\n{\n\tint\t\t\ti;\n\tunsigned int\t\tret;\n\tunsigned int\t\tnents;\n\tstruct scatterlist\tsg[10];\n\n\tprintk(KERN_INFO \"DMA fifo test start\\n\");\n\n\tif (kfifo_alloc(&fifo, FIFO_SIZE, GFP_KERNEL)) {\n\t\tprintk(KERN_WARNING \"error kfifo_alloc\\n\");\n\t\treturn -ENOMEM;\n\t}\n\n\tprintk(KERN_INFO \"queue size: %u\\n\", kfifo_size(&fifo));\n\n\tkfifo_in(&fifo, \"test\", 4);\n\n\tfor (i = 0; i != 9; i++)\n\t\tkfifo_put(&fifo, i);\n\n\t \n\tkfifo_skip(&fifo);\n\n\tprintk(KERN_INFO \"queue len: %u\\n\", kfifo_len(&fifo));\n\n\t \n\tsg_init_table(sg, ARRAY_SIZE(sg));\n\tnents = kfifo_dma_in_prepare(&fifo, sg, ARRAY_SIZE(sg), FIFO_SIZE);\n\tprintk(KERN_INFO \"DMA sgl entries: %d\\n\", nents);\n\tif (!nents) {\n\t\t \n\t\tprintk(KERN_WARNING \"error kfifo_dma_in_prepare\\n\");\n\t\treturn -EIO;\n\t}\n\n\t \n\tprintk(KERN_INFO \"scatterlist for receive:\\n\");\n\tfor (i = 0; i < nents; i++) {\n\t\tprintk(KERN_INFO\n\t\t\"sg[%d] -> \"\n\t\t\"page %p offset 0x%.8x length 0x%.8x\\n\",\n\t\t\ti, sg_page(&sg[i]), sg[i].offset, sg[i].length);\n\n\t\tif (sg_is_last(&sg[i]))\n\t\t\tbreak;\n\t}\n\n\t \n\t \n\n\t \n\tret = 0;\n\n\t \n\tkfifo_dma_in_finish(&fifo, ret);\n\n\t \n\tnents = kfifo_dma_out_prepare(&fifo, sg, ARRAY_SIZE(sg), 8);\n\tprintk(KERN_INFO \"DMA sgl entries: %d\\n\", nents);\n\tif (!nents) {\n\t\t \n\t\tprintk(KERN_WARNING \"error kfifo_dma_out_prepare\\n\");\n\t\treturn -EIO;\n\t}\n\n\tprintk(KERN_INFO \"scatterlist for transmit:\\n\");\n\tfor (i = 0; i < nents; i++) {\n\t\tprintk(KERN_INFO\n\t\t\"sg[%d] -> \"\n\t\t\"page %p offset 0x%.8x length 0x%.8x\\n\",\n\t\t\ti, sg_page(&sg[i]), sg[i].offset, sg[i].length);\n\n\t\tif (sg_is_last(&sg[i]))\n\t\t\tbreak;\n\t}\n\n\t \n\t \n\n\t \n\tret = 5;\n\n\t \n\tkfifo_dma_out_finish(&fifo, ret);\n\n\tret = kfifo_len(&fifo);\n\tprintk(KERN_INFO \"queue len: %u\\n\", kfifo_len(&fifo));\n\n\tif (ret != 7) {\n\t\tprintk(KERN_WARNING \"size mismatch: test failed\");\n\t\treturn -EIO;\n\t}\n\tprintk(KERN_INFO \"test passed\\n\");\n\n\treturn 0;\n}\n\nstatic void __exit example_exit(void)\n{\n\tkfifo_free(&fifo);\n}\n\nmodule_init(example_init);\nmodule_exit(example_exit);\nMODULE_LICENSE(\"GPL\");\nMODULE_AUTHOR(\"Stefani Seibold <stefani@seibold.net>\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}