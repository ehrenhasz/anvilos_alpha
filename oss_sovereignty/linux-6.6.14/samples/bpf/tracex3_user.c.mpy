{
  "module_name": "tracex3_user.c",
  "hash_id": "1babf2a1536a744fbbaff1443c6d30b1cc96d99ea001d96778a54d4615ef26dc",
  "original_prompt": "Ingested from linux-6.6.14/samples/bpf/tracex3_user.c",
  "human_readable_source": "\n \n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <unistd.h>\n#include <stdbool.h>\n#include <string.h>\n\n#include <bpf/bpf.h>\n#include <bpf/libbpf.h>\n#include \"bpf_util.h\"\n\n#define SLOTS 100\n\nstatic void clear_stats(int fd)\n{\n\tunsigned int nr_cpus = bpf_num_possible_cpus();\n\t__u64 values[nr_cpus];\n\t__u32 key;\n\n\tmemset(values, 0, sizeof(values));\n\tfor (key = 0; key < SLOTS; key++)\n\t\tbpf_map_update_elem(fd, &key, values, BPF_ANY);\n}\n\nconst char *color[] = {\n\t\"\\033[48;5;255m\",\n\t\"\\033[48;5;252m\",\n\t\"\\033[48;5;250m\",\n\t\"\\033[48;5;248m\",\n\t\"\\033[48;5;246m\",\n\t\"\\033[48;5;244m\",\n\t\"\\033[48;5;242m\",\n\t\"\\033[48;5;240m\",\n\t\"\\033[48;5;238m\",\n\t\"\\033[48;5;236m\",\n\t\"\\033[48;5;234m\",\n\t\"\\033[48;5;232m\",\n};\nconst int num_colors = ARRAY_SIZE(color);\n\nconst char nocolor[] = \"\\033[00m\";\n\nconst char *sym[] = {\n\t\" \",\n\t\" \",\n\t\".\",\n\t\".\",\n\t\"*\",\n\t\"*\",\n\t\"o\",\n\t\"o\",\n\t\"O\",\n\t\"O\",\n\t\"#\",\n\t\"#\",\n};\n\nbool full_range = false;\nbool text_only = false;\n\nstatic void print_banner(void)\n{\n\tif (full_range)\n\t\tprintf(\"|1ns     |10ns     |100ns    |1us      |10us     |100us\"\n\t\t       \"    |1ms      |10ms     |100ms    |1s       |10s\\n\");\n\telse\n\t\tprintf(\"|1us      |10us     |100us    |1ms      |10ms     \"\n\t\t       \"|100ms    |1s       |10s\\n\");\n}\n\nstatic void print_hist(int fd)\n{\n\tunsigned int nr_cpus = bpf_num_possible_cpus();\n\t__u64 total_events = 0;\n\tlong values[nr_cpus];\n\t__u64 max_cnt = 0;\n\t__u64 cnt[SLOTS];\n\t__u64 value;\n\t__u32 key;\n\tint i;\n\n\tfor (key = 0; key < SLOTS; key++) {\n\t\tbpf_map_lookup_elem(fd, &key, values);\n\t\tvalue = 0;\n\t\tfor (i = 0; i < nr_cpus; i++)\n\t\t\tvalue += values[i];\n\t\tcnt[key] = value;\n\t\ttotal_events += value;\n\t\tif (value > max_cnt)\n\t\t\tmax_cnt = value;\n\t}\n\tclear_stats(fd);\n\tfor (key = full_range ? 0 : 29; key < SLOTS; key++) {\n\t\tint c = num_colors * cnt[key] / (max_cnt + 1);\n\n\t\tif (text_only)\n\t\t\tprintf(\"%s\", sym[c]);\n\t\telse\n\t\t\tprintf(\"%s %s\", color[c], nocolor);\n\t}\n\tprintf(\" # %lld\\n\", total_events);\n}\n\nint main(int ac, char **argv)\n{\n\tstruct bpf_link *links[2];\n\tstruct bpf_program *prog;\n\tstruct bpf_object *obj;\n\tchar filename[256];\n\tint map_fd, i, j = 0;\n\n\tfor (i = 1; i < ac; i++) {\n\t\tif (strcmp(argv[i], \"-a\") == 0) {\n\t\t\tfull_range = true;\n\t\t} else if (strcmp(argv[i], \"-t\") == 0) {\n\t\t\ttext_only = true;\n\t\t} else if (strcmp(argv[i], \"-h\") == 0) {\n\t\t\tprintf(\"Usage:\\n\"\n\t\t\t       \"  -a display wider latency range\\n\"\n\t\t\t       \"  -t text only\\n\");\n\t\t\treturn 1;\n\t\t}\n\t}\n\n\tsnprintf(filename, sizeof(filename), \"%s.bpf.o\", argv[0]);\n\tobj = bpf_object__open_file(filename, NULL);\n\tif (libbpf_get_error(obj)) {\n\t\tfprintf(stderr, \"ERROR: opening BPF object file failed\\n\");\n\t\treturn 0;\n\t}\n\n\t \n\tif (bpf_object__load(obj)) {\n\t\tfprintf(stderr, \"ERROR: loading BPF object file failed\\n\");\n\t\tgoto cleanup;\n\t}\n\n\tmap_fd = bpf_object__find_map_fd_by_name(obj, \"lat_map\");\n\tif (map_fd < 0) {\n\t\tfprintf(stderr, \"ERROR: finding a map in obj file failed\\n\");\n\t\tgoto cleanup;\n\t}\n\n\tbpf_object__for_each_program(prog, obj) {\n\t\tlinks[j] = bpf_program__attach(prog);\n\t\tif (libbpf_get_error(links[j])) {\n\t\t\tfprintf(stderr, \"ERROR: bpf_program__attach failed\\n\");\n\t\t\tlinks[j] = NULL;\n\t\t\tgoto cleanup;\n\t\t}\n\t\tj++;\n\t}\n\n\tprintf(\"  heatmap of IO latency\\n\");\n\tif (text_only)\n\t\tprintf(\"  %s\", sym[num_colors - 1]);\n\telse\n\t\tprintf(\"  %s %s\", color[num_colors - 1], nocolor);\n\tprintf(\" - many events with this latency\\n\");\n\n\tif (text_only)\n\t\tprintf(\"  %s\", sym[0]);\n\telse\n\t\tprintf(\"  %s %s\", color[0], nocolor);\n\tprintf(\" - few events\\n\");\n\n\tfor (i = 0; ; i++) {\n\t\tif (i % 20 == 0)\n\t\t\tprint_banner();\n\t\tprint_hist(map_fd);\n\t\tsleep(2);\n\t}\n\ncleanup:\n\tfor (j--; j >= 0; j--)\n\t\tbpf_link__destroy(links[j]);\n\n\tbpf_object__close(obj);\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}