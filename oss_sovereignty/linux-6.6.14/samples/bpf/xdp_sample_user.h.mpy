{
  "module_name": "xdp_sample_user.h",
  "hash_id": "82e6b3b897619260bb8b2fc5a5feeab6be204a707f7eb1ac6084fe3c951e2767",
  "original_prompt": "Ingested from linux-6.6.14/samples/bpf/xdp_sample_user.h",
  "human_readable_source": "\n#ifndef XDP_SAMPLE_USER_H\n#define XDP_SAMPLE_USER_H\n\n#include <bpf/libbpf.h>\n#include <linux/compiler.h>\n\n#include \"xdp_sample_shared.h\"\n\nenum stats_mask {\n\t_SAMPLE_REDIRECT_MAP         = 1U << 0,\n\tSAMPLE_RX_CNT                = 1U << 1,\n\tSAMPLE_REDIRECT_ERR_CNT      = 1U << 2,\n\tSAMPLE_CPUMAP_ENQUEUE_CNT    = 1U << 3,\n\tSAMPLE_CPUMAP_KTHREAD_CNT    = 1U << 4,\n\tSAMPLE_EXCEPTION_CNT         = 1U << 5,\n\tSAMPLE_DEVMAP_XMIT_CNT       = 1U << 6,\n\tSAMPLE_REDIRECT_CNT          = 1U << 7,\n\tSAMPLE_REDIRECT_MAP_CNT      = SAMPLE_REDIRECT_CNT | _SAMPLE_REDIRECT_MAP,\n\tSAMPLE_REDIRECT_ERR_MAP_CNT  = SAMPLE_REDIRECT_ERR_CNT | _SAMPLE_REDIRECT_MAP,\n\tSAMPLE_DEVMAP_XMIT_CNT_MULTI = 1U << 8,\n\tSAMPLE_SKIP_HEADING\t     = 1U << 9,\n};\n\n \n#define EXIT_OK\t\t\t0\n#define EXIT_FAIL\t\t1\n#define EXIT_FAIL_OPTION\t2\n#define EXIT_FAIL_XDP\t\t3\n#define EXIT_FAIL_BPF\t\t4\n#define EXIT_FAIL_MEM\t\t5\n\nint sample_setup_maps(struct bpf_map **maps);\nint __sample_init(int mask);\nvoid sample_exit(int status);\nint sample_run(int interval, void (*post_cb)(void *), void *ctx);\n\nvoid sample_switch_mode(void);\nint sample_install_xdp(struct bpf_program *xdp_prog, int ifindex, bool generic,\n\t\t       bool force);\nvoid sample_usage(char *argv[], const struct option *long_options,\n\t\t  const char *doc, int mask, bool error);\n\nconst char *get_driver_name(int ifindex);\nint get_mac_addr(int ifindex, void *mac_addr);\n\n#pragma GCC diagnostic push\n#ifndef __clang__\n#pragma GCC diagnostic ignored \"-Wstringop-truncation\"\n#endif\n__attribute__((unused))\nstatic inline char *safe_strncpy(char *dst, const char *src, size_t size)\n{\n\tif (!size)\n\t\treturn dst;\n\tstrncpy(dst, src, size - 1);\n\tdst[size - 1] = '\\0';\n\treturn dst;\n}\n#pragma GCC diagnostic pop\n\n#define __attach_tp(name)                                                      \\\n\t({                                                                     \\\n\t\tif (bpf_program__type(skel->progs.name) != BPF_PROG_TYPE_TRACING)\\\n\t\t\treturn -EINVAL;                                        \\\n\t\tskel->links.name = bpf_program__attach(skel->progs.name);      \\\n\t\tif (!skel->links.name)                                         \\\n\t\t\treturn -errno;                                         \\\n\t})\n\n#define sample_init_pre_load(skel)                                             \\\n\t({                                                                     \\\n\t\tskel->rodata->nr_cpus = libbpf_num_possible_cpus();            \\\n\t\tsample_setup_maps((struct bpf_map *[]){                        \\\n\t\t\tskel->maps.rx_cnt, skel->maps.redir_err_cnt,           \\\n\t\t\tskel->maps.cpumap_enqueue_cnt,                         \\\n\t\t\tskel->maps.cpumap_kthread_cnt,                         \\\n\t\t\tskel->maps.exception_cnt, skel->maps.devmap_xmit_cnt,  \\\n\t\t\tskel->maps.devmap_xmit_cnt_multi });                   \\\n\t})\n\n#define DEFINE_SAMPLE_INIT(name)                                               \\\n\tstatic int sample_init(struct name *skel, int mask)                    \\\n\t{                                                                      \\\n\t\tint ret;                                                       \\\n\t\tret = __sample_init(mask);                                     \\\n\t\tif (ret < 0)                                                   \\\n\t\t\treturn ret;                                            \\\n\t\tif (mask & SAMPLE_REDIRECT_MAP_CNT)                            \\\n\t\t\t__attach_tp(tp_xdp_redirect_map);                      \\\n\t\tif (mask & SAMPLE_REDIRECT_CNT)                                \\\n\t\t\t__attach_tp(tp_xdp_redirect);                          \\\n\t\tif (mask & SAMPLE_REDIRECT_ERR_MAP_CNT)                        \\\n\t\t\t__attach_tp(tp_xdp_redirect_map_err);                  \\\n\t\tif (mask & SAMPLE_REDIRECT_ERR_CNT)                            \\\n\t\t\t__attach_tp(tp_xdp_redirect_err);                      \\\n\t\tif (mask & SAMPLE_CPUMAP_ENQUEUE_CNT)                          \\\n\t\t\t__attach_tp(tp_xdp_cpumap_enqueue);                    \\\n\t\tif (mask & SAMPLE_CPUMAP_KTHREAD_CNT)                          \\\n\t\t\t__attach_tp(tp_xdp_cpumap_kthread);                    \\\n\t\tif (mask & SAMPLE_EXCEPTION_CNT)                               \\\n\t\t\t__attach_tp(tp_xdp_exception);                         \\\n\t\tif (mask & SAMPLE_DEVMAP_XMIT_CNT)                             \\\n\t\t\t__attach_tp(tp_xdp_devmap_xmit);                       \\\n\t\tif (mask & SAMPLE_DEVMAP_XMIT_CNT_MULTI)                       \\\n\t\t\t__attach_tp(tp_xdp_devmap_xmit_multi);                 \\\n\t\treturn 0;                                                      \\\n\t}\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}