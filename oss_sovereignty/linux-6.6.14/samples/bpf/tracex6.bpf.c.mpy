{
  "module_name": "tracex6.bpf.c",
  "hash_id": "9c1fc8e7d70191c375a925e9de48376a136950628e9bab81b68fc42a8d394702",
  "original_prompt": "Ingested from linux-6.6.14/samples/bpf/tracex6.bpf.c",
  "human_readable_source": "#include \"vmlinux.h\"\n#include <linux/version.h>\n#include <bpf/bpf_helpers.h>\n#include <bpf/bpf_tracing.h>\n#include <bpf/bpf_core_read.h>\n\nstruct {\n\t__uint(type, BPF_MAP_TYPE_PERF_EVENT_ARRAY);\n\t__uint(key_size, sizeof(int));\n\t__uint(value_size, sizeof(u32));\n\t__uint(max_entries, 64);\n} counters SEC(\".maps\");\n\nstruct {\n\t__uint(type, BPF_MAP_TYPE_HASH);\n\t__type(key, int);\n\t__type(value, u64);\n\t__uint(max_entries, 64);\n} values SEC(\".maps\");\n\nstruct {\n\t__uint(type, BPF_MAP_TYPE_HASH);\n\t__type(key, int);\n\t__type(value, struct bpf_perf_event_value);\n\t__uint(max_entries, 64);\n} values2 SEC(\".maps\");\n\nSEC(\"kprobe/htab_map_get_next_key\")\nint bpf_prog1(struct pt_regs *ctx)\n{\n\tu32 key = bpf_get_smp_processor_id();\n\tu64 count, *val;\n\ts64 error;\n\n\tcount = bpf_perf_event_read(&counters, key);\n\terror = (s64)count;\n\tif (error <= -2 && error >= -22)\n\t\treturn 0;\n\n\tval = bpf_map_lookup_elem(&values, &key);\n\tif (val)\n\t\t*val = count;\n\telse\n\t\tbpf_map_update_elem(&values, &key, &count, BPF_NOEXIST);\n\n\treturn 0;\n}\n\n \nSEC(\"kprobe/bpf_map_copy_value\")\nint BPF_KPROBE(bpf_prog2, struct bpf_map *map)\n{\n\tu32 key = bpf_get_smp_processor_id();\n\tstruct bpf_perf_event_value *val, buf;\n\tenum bpf_map_type type;\n\tint error;\n\n\ttype = BPF_CORE_READ(map, map_type);\n\tif (type != BPF_MAP_TYPE_HASH)\n\t\treturn 0;\n\n\terror = bpf_perf_event_read_value(&counters, key, &buf, sizeof(buf));\n\tif (error)\n\t\treturn 0;\n\n\tval = bpf_map_lookup_elem(&values2, &key);\n\tif (val)\n\t\t*val = buf;\n\telse\n\t\tbpf_map_update_elem(&values2, &key, &buf, BPF_NOEXIST);\n\n\treturn 0;\n}\n\nchar _license[] SEC(\"license\") = \"GPL\";\nu32 _version SEC(\"version\") = LINUX_VERSION_CODE;\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}