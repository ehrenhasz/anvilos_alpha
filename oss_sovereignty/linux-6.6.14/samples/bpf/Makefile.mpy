{
  "module_name": "Makefile",
  "hash_id": "0462b21b08456a9f24939665e424a3a6ca392158a5331fd385963cdb3136156a",
  "original_prompt": "Ingested from linux-6.6.14/samples/bpf/Makefile",
  "human_readable_source": "# SPDX-License-Identifier: GPL-2.0\n\nBPF_SAMPLES_PATH ?= $(abspath $(srctree)/$(src))\nTOOLS_PATH := $(BPF_SAMPLES_PATH)/../../tools\n\npound := \\#\n\n# List of programs to build\ntprogs-y := test_lru_dist\ntprogs-y += sock_example\ntprogs-y += fds_example\ntprogs-y += sockex1\ntprogs-y += sockex2\ntprogs-y += sockex3\ntprogs-y += tracex1\ntprogs-y += tracex2\ntprogs-y += tracex3\ntprogs-y += tracex4\ntprogs-y += tracex5\ntprogs-y += tracex6\ntprogs-y += tracex7\ntprogs-y += test_probe_write_user\ntprogs-y += trace_output\ntprogs-y += lathist\ntprogs-y += offwaketime\ntprogs-y += spintest\ntprogs-y += map_perf_test\ntprogs-y += test_overhead\ntprogs-y += test_cgrp2_array_pin\ntprogs-y += test_cgrp2_attach\ntprogs-y += test_cgrp2_sock\ntprogs-y += test_cgrp2_sock2\ntprogs-y += xdp_router_ipv4\ntprogs-y += test_current_task_under_cgroup\ntprogs-y += trace_event\ntprogs-y += sampleip\ntprogs-y += tc_l2_redirect\ntprogs-y += lwt_len_hist\ntprogs-y += xdp_tx_iptunnel\ntprogs-y += test_map_in_map\ntprogs-y += per_socket_stats_example\ntprogs-y += syscall_tp\ntprogs-y += cpustat\ntprogs-y += xdp_adjust_tail\ntprogs-y += xdp_fwd\ntprogs-y += task_fd_query\ntprogs-y += ibumad\ntprogs-y += hbm\n\n# Libbpf dependencies\nLIBBPF_SRC = $(TOOLS_PATH)/lib/bpf\nLIBBPF_OUTPUT = $(abspath $(BPF_SAMPLES_PATH))/libbpf\nLIBBPF_DESTDIR = $(LIBBPF_OUTPUT)\nLIBBPF_INCLUDE = $(LIBBPF_DESTDIR)/include\nLIBBPF = $(LIBBPF_OUTPUT)/libbpf.a\n\nCGROUP_HELPERS := ../../tools/testing/selftests/bpf/cgroup_helpers.o\nTRACE_HELPERS := ../../tools/testing/selftests/bpf/trace_helpers.o\nXDP_SAMPLE := xdp_sample_user.o\n\nfds_example-objs := fds_example.o\nsockex1-objs := sockex1_user.o\nsockex2-objs := sockex2_user.o\nsockex3-objs := sockex3_user.o\ntracex1-objs := tracex1_user.o $(TRACE_HELPERS)\ntracex2-objs := tracex2_user.o\ntracex3-objs := tracex3_user.o\ntracex4-objs := tracex4_user.o\ntracex5-objs := tracex5_user.o $(TRACE_HELPERS)\ntracex6-objs := tracex6_user.o\ntracex7-objs := tracex7_user.o\ntest_probe_write_user-objs := test_probe_write_user_user.o\ntrace_output-objs := trace_output_user.o\nlathist-objs := lathist_user.o\noffwaketime-objs := offwaketime_user.o $(TRACE_HELPERS)\nspintest-objs := spintest_user.o $(TRACE_HELPERS)\nmap_perf_test-objs := map_perf_test_user.o\ntest_overhead-objs := test_overhead_user.o\ntest_cgrp2_array_pin-objs := test_cgrp2_array_pin.o\ntest_cgrp2_attach-objs := test_cgrp2_attach.o\ntest_cgrp2_sock-objs := test_cgrp2_sock.o\ntest_cgrp2_sock2-objs := test_cgrp2_sock2.o\ntest_current_task_under_cgroup-objs := $(CGROUP_HELPERS) \\\n\t\t\t\t       test_current_task_under_cgroup_user.o\ntrace_event-objs := trace_event_user.o $(TRACE_HELPERS)\nsampleip-objs := sampleip_user.o $(TRACE_HELPERS)\ntc_l2_redirect-objs := tc_l2_redirect_user.o\nlwt_len_hist-objs := lwt_len_hist_user.o\nxdp_tx_iptunnel-objs := xdp_tx_iptunnel_user.o\ntest_map_in_map-objs := test_map_in_map_user.o\nper_socket_stats_example-objs := cookie_uid_helper_example.o\nsyscall_tp-objs := syscall_tp_user.o\ncpustat-objs := cpustat_user.o\nxdp_adjust_tail-objs := xdp_adjust_tail_user.o\nxdp_fwd-objs := xdp_fwd_user.o\ntask_fd_query-objs := task_fd_query_user.o $(TRACE_HELPERS)\nibumad-objs := ibumad_user.o\nhbm-objs := hbm.o $(CGROUP_HELPERS)\n\nxdp_router_ipv4-objs := xdp_router_ipv4_user.o $(XDP_SAMPLE)\n\n# Tell kbuild to always build the programs\nalways-y := $(tprogs-y)\nalways-y += sockex1_kern.o\nalways-y += sockex2_kern.o\nalways-y += sockex3_kern.o\nalways-y += tracex1.bpf.o\nalways-y += tracex2.bpf.o\nalways-y += tracex3.bpf.o\nalways-y += tracex4.bpf.o\nalways-y += tracex5.bpf.o\nalways-y += tracex6.bpf.o\nalways-y += tracex7.bpf.o\nalways-y += sock_flags.bpf.o\nalways-y += test_probe_write_user.bpf.o\nalways-y += trace_output.bpf.o\nalways-y += tcbpf1_kern.o\nalways-y += tc_l2_redirect_kern.o\nalways-y += lathist_kern.o\nalways-y += offwaketime.bpf.o\nalways-y += spintest.bpf.o\nalways-y += map_perf_test.bpf.o\nalways-y += test_overhead_tp.bpf.o\nalways-y += test_overhead_raw_tp.bpf.o\nalways-y += test_overhead_kprobe.bpf.o\nalways-y += parse_varlen.o parse_simple.o parse_ldabs.o\nalways-y += test_cgrp2_tc.bpf.o\nalways-y += test_current_task_under_cgroup.bpf.o\nalways-y += trace_event_kern.o\nalways-y += sampleip_kern.o\nalways-y += lwt_len_hist.bpf.o\nalways-y += xdp_tx_iptunnel_kern.o\nalways-y += test_map_in_map.bpf.o\nalways-y += tcp_synrto_kern.o\nalways-y += tcp_rwnd_kern.o\nalways-y += tcp_bufs_kern.o\nalways-y += tcp_cong_kern.o\nalways-y += tcp_iw_kern.o\nalways-y += tcp_clamp_kern.o\nalways-y += tcp_basertt_kern.o\nalways-y += tcp_tos_reflect_kern.o\nalways-y += tcp_dumpstats_kern.o\nalways-y += xdp2skb_meta_kern.o\nalways-y += syscall_tp_kern.o\nalways-y += cpustat_kern.o\nalways-y += xdp_adjust_tail_kern.o\nalways-y += xdp_fwd_kern.o\nalways-y += task_fd_query_kern.o\nalways-y += ibumad_kern.o\nalways-y += hbm_out_kern.o\nalways-y += hbm_edt_kern.o\n\nifeq ($(ARCH), arm)\n# Strip all except -D__LINUX_ARM_ARCH__ option needed to handle linux\n# headers when arm instruction set identification is requested.\nARM_ARCH_SELECTOR := $(filter -D__LINUX_ARM_ARCH__%, $(KBUILD_CFLAGS))\nBPF_EXTRA_CFLAGS := $(ARM_ARCH_SELECTOR)\nTPROGS_CFLAGS += $(ARM_ARCH_SELECTOR)\nendif\n\nifeq ($(ARCH), mips)\nTPROGS_CFLAGS += -D__SANE_USERSPACE_TYPES__\nifdef CONFIG_MACH_LOONGSON64\nBPF_EXTRA_CFLAGS += -I$(srctree)/arch/mips/include/asm/mach-loongson64\nBPF_EXTRA_CFLAGS += -I$(srctree)/arch/mips/include/asm/mach-generic\nendif\nendif\n\nTPROGS_CFLAGS += -Wall -O2\nTPROGS_CFLAGS += -Wmissing-prototypes\nTPROGS_CFLAGS += -Wstrict-prototypes\n\nTPROGS_CFLAGS += -I$(objtree)/usr/include\nTPROGS_CFLAGS += -I$(srctree)/tools/testing/selftests/bpf/\nTPROGS_CFLAGS += -I$(LIBBPF_INCLUDE)\nTPROGS_CFLAGS += -I$(srctree)/tools/include\nTPROGS_CFLAGS += -I$(srctree)/tools/perf\nTPROGS_CFLAGS += -DHAVE_ATTR_TEST=0\n\nifdef SYSROOT\nTPROGS_CFLAGS += --sysroot=$(SYSROOT)\nTPROGS_LDFLAGS := -L$(SYSROOT)/usr/lib\nendif\n\nTPROGS_LDLIBS\t\t\t+= $(LIBBPF) -lelf -lz\nTPROGLDLIBS_xdp_router_ipv4\t+= -lm -pthread\nTPROGLDLIBS_tracex4\t\t+= -lrt\nTPROGLDLIBS_trace_output\t+= -lrt\nTPROGLDLIBS_map_perf_test\t+= -lrt\nTPROGLDLIBS_test_overhead\t+= -lrt\n\n# Allows pointing LLC/CLANG to a LLVM backend with bpf support, redefine on cmdline:\n# make M=samples/bpf LLC=~/git/llvm-project/llvm/build/bin/llc CLANG=~/git/llvm-project/llvm/build/bin/clang\nLLC ?= llc\nCLANG ?= clang\nOPT ?= opt\nLLVM_DIS ?= llvm-dis\nLLVM_OBJCOPY ?= llvm-objcopy\nLLVM_READELF ?= llvm-readelf\nBTF_PAHOLE ?= pahole\n\n# Detect that we're cross compiling and use the cross compiler\nifdef CROSS_COMPILE\nCLANG_ARCH_ARGS = --target=$(notdir $(CROSS_COMPILE:%-=%))\nendif\n\n# Don't evaluate probes and warnings if we need to run make recursively\nifneq ($(src),)\nHDR_PROBE := $(shell printf \"$(pound)include <linux/types.h>\\n struct list_head { int a; }; int main() { return 0; }\" | \\\n\t$(CC) $(TPROGS_CFLAGS) $(TPROGS_LDFLAGS) -x c - \\\n\t-o /dev/null 2>/dev/null && echo okay)\n\nifeq ($(HDR_PROBE),)\n$(warning WARNING: Detected possible issues with include path.)\n$(warning WARNING: Please install kernel headers locally (make headers_install).)\nendif\n\nBTF_LLC_PROBE := $(shell $(LLC) -march=bpf -mattr=help 2>&1 | grep dwarfris)\nBTF_PAHOLE_PROBE := $(shell $(BTF_PAHOLE) --help 2>&1 | grep BTF)\nBTF_OBJCOPY_PROBE := $(shell $(LLVM_OBJCOPY) --help 2>&1 | grep -i 'usage.*llvm')\nBTF_LLVM_PROBE := $(shell echo \"int main() { return 0; }\" | \\\n\t\t\t  $(CLANG) --target=bpf -O2 -g -c -x c - -o ./llvm_btf_verify.o; \\\n\t\t\t  $(LLVM_READELF) -S ./llvm_btf_verify.o | grep BTF; \\\n\t\t\t  /bin/rm -f ./llvm_btf_verify.o)\n\nBPF_EXTRA_CFLAGS += -fno-stack-protector\nifneq ($(BTF_LLVM_PROBE),)\n\tBPF_EXTRA_CFLAGS += -g\nelse\nifneq ($(and $(BTF_LLC_PROBE),$(BTF_PAHOLE_PROBE),$(BTF_OBJCOPY_PROBE)),)\n\tBPF_EXTRA_CFLAGS += -g\n\tLLC_FLAGS += -mattr=dwarfris\n\tDWARF2BTF = y\nendif\nendif\nendif\n\n# Trick to allow make to be run from this directory\nall:\n\t$(MAKE) -C ../../ M=$(CURDIR) BPF_SAMPLES_PATH=$(CURDIR)\n\nclean:\n\t$(MAKE) -C ../../ M=$(CURDIR) clean\n\t@find $(CURDIR) -type f -name '*~' -delete\n\t@$(RM) -r $(CURDIR)/libbpf $(CURDIR)/bpftool\n\n$(LIBBPF): $(wildcard $(LIBBPF_SRC)/*.[ch] $(LIBBPF_SRC)/Makefile) | $(LIBBPF_OUTPUT)\n# Fix up variables inherited from Kbuild that tools/ build system won't like\n\t$(MAKE) -C $(LIBBPF_SRC) RM='rm -rf' EXTRA_CFLAGS=\"$(TPROGS_CFLAGS)\" \\\n\t\tLDFLAGS=$(TPROGS_LDFLAGS) srctree=$(BPF_SAMPLES_PATH)/../../ \\\n\t\tO= OUTPUT=$(LIBBPF_OUTPUT)/ DESTDIR=$(LIBBPF_DESTDIR) prefix= \\\n\t\t$@ install_headers\n\nBPFTOOLDIR := $(TOOLS_PATH)/bpf/bpftool\nBPFTOOL_OUTPUT := $(abspath $(BPF_SAMPLES_PATH))/bpftool\nBPFTOOL := $(BPFTOOL_OUTPUT)/bootstrap/bpftool\n$(BPFTOOL): $(wildcard $(BPFTOOLDIR)/*.[ch] $(BPFTOOLDIR)/Makefile) | $(BPFTOOL_OUTPUT)\n\t$(MAKE) -C $(BPFTOOLDIR) srctree=$(BPF_SAMPLES_PATH)/../../ \t\t\\\n\t\tOUTPUT=$(BPFTOOL_OUTPUT)/ bootstrap\n\n$(LIBBPF_OUTPUT) $(BPFTOOL_OUTPUT):\n\t$(call msg,MKDIR,$@)\n\t$(Q)mkdir -p $@\n\n$(obj)/syscall_nrs.h:\t$(obj)/syscall_nrs.s FORCE\n\t$(call filechk,offsets,__SYSCALL_NRS_H__)\n\ntargets += syscall_nrs.s\nclean-files += syscall_nrs.h\n\nFORCE:\n\n\n# Verify LLVM compiler tools are available and bpf target is supported by llc\n.PHONY: verify_cmds verify_target_bpf $(CLANG) $(LLC)\n\nverify_cmds: $(CLANG) $(LLC)\n\t@for TOOL in $^ ; do \\\n\t\tif ! (which -- \"$${TOOL}\" > /dev/null 2>&1); then \\\n\t\t\techo \"*** ERROR: Cannot find LLVM tool $${TOOL}\" ;\\\n\t\t\texit 1; \\\n\t\telse true; fi; \\\n\tdone\n\nverify_target_bpf: verify_cmds\n\t@if ! (${LLC} -march=bpf -mattr=help > /dev/null 2>&1); then \\\n\t\techo \"*** ERROR: LLVM (${LLC}) does not support 'bpf' target\" ;\\\n\t\techo \"   NOTICE: LLVM version >= 3.7.1 required\" ;\\\n\t\texit 2; \\\n\telse true; fi\n\n$(BPF_SAMPLES_PATH)/*.c: verify_target_bpf $(LIBBPF)\n$(src)/*.c: verify_target_bpf $(LIBBPF)\n\nlibbpf_hdrs: $(LIBBPF)\n$(obj)/$(TRACE_HELPERS) $(obj)/$(CGROUP_HELPERS) $(obj)/$(XDP_SAMPLE): | libbpf_hdrs\n\n.PHONY: libbpf_hdrs\n\n$(obj)/xdp_router_ipv4_user.o: $(obj)/xdp_router_ipv4.skel.h\n\n$(obj)/tracex5.bpf.o: $(obj)/syscall_nrs.h\n$(obj)/hbm_out_kern.o: $(src)/hbm.h $(src)/hbm_kern.h\n$(obj)/hbm.o: $(src)/hbm.h\n$(obj)/hbm_edt_kern.o: $(src)/hbm.h $(src)/hbm_kern.h\n\n# Override includes for xdp_sample_user.o because $(srctree)/usr/include in\n# TPROGS_CFLAGS causes conflicts\nXDP_SAMPLE_CFLAGS += -Wall -O2 \\\n\t\t     -I$(src)/../../tools/include \\\n\t\t     -I$(src)/../../tools/include/uapi \\\n\t\t     -I$(LIBBPF_INCLUDE) \\\n\t\t     -I$(src)/../../tools/testing/selftests/bpf\n\n$(obj)/$(XDP_SAMPLE): TPROGS_CFLAGS = $(XDP_SAMPLE_CFLAGS)\n$(obj)/$(XDP_SAMPLE): $(src)/xdp_sample_user.h $(src)/xdp_sample_shared.h\n\n-include $(BPF_SAMPLES_PATH)/Makefile.target\n\nVMLINUX_BTF_PATHS ?= $(abspath $(if $(O),$(O)/vmlinux))\t\t\t\t\\\n\t\t     $(abspath $(if $(KBUILD_OUTPUT),$(KBUILD_OUTPUT)/vmlinux))\t\\\n\t\t     $(abspath ./vmlinux)\nVMLINUX_BTF ?= $(abspath $(firstword $(wildcard $(VMLINUX_BTF_PATHS))))\n\n$(obj)/vmlinux.h: $(VMLINUX_BTF) $(BPFTOOL)\nifeq ($(VMLINUX_H),)\nifeq ($(VMLINUX_BTF),)\n\t$(error Cannot find a vmlinux for VMLINUX_BTF at any of \"$(VMLINUX_BTF_PATHS)\",\\\n\t\tbuild the kernel or set VMLINUX_BTF or VMLINUX_H variable)\nendif\n\t$(Q)$(BPFTOOL) btf dump file $(VMLINUX_BTF) format c > $@\nelse\n\t$(Q)cp \"$(VMLINUX_H)\" $@\nendif\n\nclean-files += vmlinux.h\n\n# Get Clang's default includes on this system, as opposed to those seen by\n# '--target=bpf'. This fixes \"missing\" files on some architectures/distros,\n# such as asm/byteorder.h, asm/socket.h, asm/sockios.h, sys/cdefs.h etc.\n#\n# Use '-idirafter': Don't interfere with include mechanics except where the\n# build would have failed anyways.\ndefine get_sys_includes\n$(shell $(1) -v -E - </dev/null 2>&1 \\\n        | sed -n '/<...> search starts here:/,/End of search list./{ s| \\(/.*\\)|-idirafter \\1|p }') \\\n$(shell $(1) -dM -E - </dev/null | grep '#define __riscv_xlen ' | sed 's/#define /-D/' | sed 's/ /=/')\nendef\n\nCLANG_SYS_INCLUDES = $(call get_sys_includes,$(CLANG))\n\n$(obj)/xdp_router_ipv4.bpf.o: $(obj)/xdp_sample.bpf.o\n\n$(obj)/%.bpf.o: $(src)/%.bpf.c $(obj)/vmlinux.h $(src)/xdp_sample.bpf.h $(src)/xdp_sample_shared.h\n\t@echo \"  CLANG-BPF \" $@\n\t$(Q)$(CLANG) -g -O2 --target=bpf -D__TARGET_ARCH_$(SRCARCH) \\\n\t\t-Wno-compare-distinct-pointer-types -I$(srctree)/include \\\n\t\t-I$(srctree)/samples/bpf -I$(srctree)/tools/include \\\n\t\t-I$(LIBBPF_INCLUDE) $(CLANG_SYS_INCLUDES) \\\n\t\t-c $(filter %.bpf.c,$^) -o $@\n\nLINKED_SKELS := xdp_router_ipv4.skel.h\nclean-files += $(LINKED_SKELS)\n\nxdp_router_ipv4.skel.h-deps := xdp_router_ipv4.bpf.o xdp_sample.bpf.o\n\nLINKED_BPF_SRCS := $(patsubst %.bpf.o,%.bpf.c,$(foreach skel,$(LINKED_SKELS),$($(skel)-deps)))\n\nBPF_SRCS_LINKED := $(notdir $(wildcard $(src)/*.bpf.c))\nBPF_OBJS_LINKED := $(patsubst %.bpf.c,$(obj)/%.bpf.o, $(BPF_SRCS_LINKED))\nBPF_SKELS_LINKED := $(addprefix $(obj)/,$(LINKED_SKELS))\n\n$(BPF_SKELS_LINKED): $(BPF_OBJS_LINKED) $(BPFTOOL)\n\t@echo \"  BPF GEN-OBJ \" $(@:.skel.h=)\n\t$(Q)$(BPFTOOL) gen object $(@:.skel.h=.lbpf.o) $(addprefix $(obj)/,$($(@F)-deps))\n\t@echo \"  BPF GEN-SKEL\" $(@:.skel.h=)\n\t$(Q)$(BPFTOOL) gen skeleton $(@:.skel.h=.lbpf.o) name $(notdir $(@:.skel.h=)) > $@\n\n# asm/sysreg.h - inline assembly used by it is incompatible with llvm.\n# But, there is no easy way to fix it, so just exclude it since it is\n# useless for BPF samples.\n# below we use long chain of commands, clang | opt | llvm-dis | llc,\n# to generate final object file. 'clang' compiles the source into IR\n# with native target, e.g., x64, arm64, etc. 'opt' does bpf CORE IR builtin\n# processing (llvm12) and IR optimizations. 'llvm-dis' converts\n# 'opt' output to IR, and finally 'llc' generates bpf byte code.\n$(obj)/%.o: $(src)/%.c\n\t@echo \"  CLANG-bpf \" $@\n\t$(Q)$(CLANG) $(NOSTDINC_FLAGS) $(LINUXINCLUDE) $(BPF_EXTRA_CFLAGS) \\\n\t\t-I$(obj) -I$(srctree)/tools/testing/selftests/bpf/ \\\n\t\t-I$(LIBBPF_INCLUDE) \\\n\t\t-D__KERNEL__ -D__BPF_TRACING__ -Wno-unused-value -Wno-pointer-sign \\\n\t\t-D__TARGET_ARCH_$(SRCARCH) -Wno-compare-distinct-pointer-types \\\n\t\t-Wno-gnu-variable-sized-type-not-at-end \\\n\t\t-Wno-address-of-packed-member -Wno-tautological-compare \\\n\t\t-Wno-unknown-warning-option $(CLANG_ARCH_ARGS) \\\n\t\t-fno-asynchronous-unwind-tables -fcf-protection \\\n\t\t-I$(srctree)/samples/bpf/ -include asm_goto_workaround.h \\\n\t\t-O2 -emit-llvm -Xclang -disable-llvm-passes -c $< -o - | \\\n\t\t$(OPT) -O2 -mtriple=bpf-pc-linux | $(LLVM_DIS) | \\\n\t\t$(LLC) -march=bpf $(LLC_FLAGS) -filetype=obj -o $@\nifeq ($(DWARF2BTF),y)\n\t$(BTF_PAHOLE) -J $@\nendif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}