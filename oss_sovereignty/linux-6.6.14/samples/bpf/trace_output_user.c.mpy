{
  "module_name": "trace_output_user.c",
  "hash_id": "2633001bacb3d5bb2f86f50ec0679bb50951777bb7fa33a769a810ca82e4b28e",
  "original_prompt": "Ingested from linux-6.6.14/samples/bpf/trace_output_user.c",
  "human_readable_source": "\n#include <stdio.h>\n#include <fcntl.h>\n#include <poll.h>\n#include <time.h>\n#include <signal.h>\n#include <bpf/libbpf.h>\n\nstatic __u64 time_get_ns(void)\n{\n\tstruct timespec ts;\n\n\tclock_gettime(CLOCK_MONOTONIC, &ts);\n\treturn ts.tv_sec * 1000000000ull + ts.tv_nsec;\n}\n\nstatic __u64 start_time;\nstatic __u64 cnt;\n\n#define MAX_CNT 100000ll\n\nstatic void print_bpf_output(void *ctx, int cpu, void *data, __u32 size)\n{\n\tstruct {\n\t\t__u64 pid;\n\t\t__u64 cookie;\n\t} *e = data;\n\n\tif (e->cookie != 0x12345678) {\n\t\tprintf(\"BUG pid %llx cookie %llx sized %d\\n\",\n\t\t       e->pid, e->cookie, size);\n\t\treturn;\n\t}\n\n\tcnt++;\n\n\tif (cnt == MAX_CNT) {\n\t\tprintf(\"recv %lld events per sec\\n\",\n\t\t       MAX_CNT * 1000000000ll / (time_get_ns() - start_time));\n\t\treturn;\n\t}\n}\n\nint main(int argc, char **argv)\n{\n\tstruct bpf_link *link = NULL;\n\tstruct bpf_program *prog;\n\tstruct perf_buffer *pb;\n\tstruct bpf_object *obj;\n\tint map_fd, ret = 0;\n\tchar filename[256];\n\tFILE *f;\n\n\tsnprintf(filename, sizeof(filename), \"%s.bpf.o\", argv[0]);\n\tobj = bpf_object__open_file(filename, NULL);\n\tif (libbpf_get_error(obj)) {\n\t\tfprintf(stderr, \"ERROR: opening BPF object file failed\\n\");\n\t\treturn 0;\n\t}\n\n\t \n\tif (bpf_object__load(obj)) {\n\t\tfprintf(stderr, \"ERROR: loading BPF object file failed\\n\");\n\t\tgoto cleanup;\n\t}\n\n\tmap_fd = bpf_object__find_map_fd_by_name(obj, \"my_map\");\n\tif (map_fd < 0) {\n\t\tfprintf(stderr, \"ERROR: finding a map in obj file failed\\n\");\n\t\tgoto cleanup;\n\t}\n\n\tprog = bpf_object__find_program_by_name(obj, \"bpf_prog1\");\n\tif (libbpf_get_error(prog)) {\n\t\tfprintf(stderr, \"ERROR: finding a prog in obj file failed\\n\");\n\t\tgoto cleanup;\n\t}\n\n\tlink = bpf_program__attach(prog);\n\tif (libbpf_get_error(link)) {\n\t\tfprintf(stderr, \"ERROR: bpf_program__attach failed\\n\");\n\t\tlink = NULL;\n\t\tgoto cleanup;\n\t}\n\n\tpb = perf_buffer__new(map_fd, 8, print_bpf_output, NULL, NULL, NULL);\n\tret = libbpf_get_error(pb);\n\tif (ret) {\n\t\tprintf(\"failed to setup perf_buffer: %d\\n\", ret);\n\t\treturn 1;\n\t}\n\n\tf = popen(\"taskset 1 dd if=/dev/zero of=/dev/null\", \"r\");\n\t(void) f;\n\n\tstart_time = time_get_ns();\n\twhile ((ret = perf_buffer__poll(pb, 1000)) >= 0 && cnt < MAX_CNT) {\n\t}\n\tkill(0, SIGINT);\n\ncleanup:\n\tbpf_link__destroy(link);\n\tbpf_object__close(obj);\n\treturn ret;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}