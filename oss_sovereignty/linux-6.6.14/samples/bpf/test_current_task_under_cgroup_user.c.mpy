{
  "module_name": "test_current_task_under_cgroup_user.c",
  "hash_id": "bd1bff745f113db08a86a119a92902e397654f74a57879ddfc7a9ffd06e904ff",
  "original_prompt": "Ingested from linux-6.6.14/samples/bpf/test_current_task_under_cgroup_user.c",
  "human_readable_source": "\n \n\n#define _GNU_SOURCE\n#include <stdio.h>\n#include <unistd.h>\n#include <bpf/bpf.h>\n#include <bpf/libbpf.h>\n#include \"cgroup_helpers.h\"\n\n#define CGROUP_PATH\t\t\"/my-cgroup\"\n\nint main(int argc, char **argv)\n{\n\tpid_t remote_pid, local_pid = getpid();\n\tint cg2 = -1, idx = 0, rc = 1;\n\tstruct bpf_link *link = NULL;\n\tstruct bpf_program *prog;\n\tstruct bpf_object *obj;\n\tchar filename[256];\n\tint map_fd[2];\n\n\tsnprintf(filename, sizeof(filename), \"%s.bpf.o\", argv[0]);\n\tobj = bpf_object__open_file(filename, NULL);\n\tif (libbpf_get_error(obj)) {\n\t\tfprintf(stderr, \"ERROR: opening BPF object file failed\\n\");\n\t\treturn 0;\n\t}\n\n\tprog = bpf_object__find_program_by_name(obj, \"bpf_prog1\");\n\tif (!prog) {\n\t\tprintf(\"finding a prog in obj file failed\\n\");\n\t\tgoto cleanup;\n\t}\n\n\t \n\tif (bpf_object__load(obj)) {\n\t\tfprintf(stderr, \"ERROR: loading BPF object file failed\\n\");\n\t\tgoto cleanup;\n\t}\n\n\tmap_fd[0] = bpf_object__find_map_fd_by_name(obj, \"cgroup_map\");\n\tmap_fd[1] = bpf_object__find_map_fd_by_name(obj, \"perf_map\");\n\tif (map_fd[0] < 0 || map_fd[1] < 0) {\n\t\tfprintf(stderr, \"ERROR: finding a map in obj file failed\\n\");\n\t\tgoto cleanup;\n\t}\n\n\tlink = bpf_program__attach(prog);\n\tif (libbpf_get_error(link)) {\n\t\tfprintf(stderr, \"ERROR: bpf_program__attach failed\\n\");\n\t\tlink = NULL;\n\t\tgoto cleanup;\n\t}\n\n\tif (setup_cgroup_environment())\n\t\tgoto err;\n\n\tcg2 = create_and_get_cgroup(CGROUP_PATH);\n\n\tif (cg2 < 0)\n\t\tgoto err;\n\n\tif (bpf_map_update_elem(map_fd[0], &idx, &cg2, BPF_ANY)) {\n\t\tlog_err(\"Adding target cgroup to map\");\n\t\tgoto err;\n\t}\n\n\tif (join_cgroup(CGROUP_PATH))\n\t\tgoto err;\n\n\t \n\n\tsync();\n\tbpf_map_lookup_elem(map_fd[1], &idx, &remote_pid);\n\n\tif (local_pid != remote_pid) {\n\t\tfprintf(stderr,\n\t\t\t\"BPF Helper didn't write correct PID to map, but: %d\\n\",\n\t\t\tremote_pid);\n\t\tgoto err;\n\t}\n\n\t \n\tif (join_cgroup(\"/\"))\n\t\tgoto err;\n\n\tremote_pid = 0;\n\tbpf_map_update_elem(map_fd[1], &idx, &remote_pid, BPF_ANY);\n\n\tsync();\n\tbpf_map_lookup_elem(map_fd[1], &idx, &remote_pid);\n\n\tif (local_pid == remote_pid) {\n\t\tfprintf(stderr, \"BPF cgroup negative test did not work\\n\");\n\t\tgoto err;\n\t}\n\n\trc = 0;\n\nerr:\n\tif (cg2 != -1)\n\t\tclose(cg2);\n\n\tcleanup_cgroup_environment();\n\ncleanup:\n\tbpf_link__destroy(link);\n\tbpf_object__close(obj);\n\treturn rc;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}