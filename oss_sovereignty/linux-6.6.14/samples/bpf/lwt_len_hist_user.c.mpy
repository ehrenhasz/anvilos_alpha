{
  "module_name": "lwt_len_hist_user.c",
  "hash_id": "7b90962663546b9f8877e8410f2a99b0066c2a5c55a5e6ecc33ecaf2e3b13618",
  "original_prompt": "Ingested from linux-6.6.14/samples/bpf/lwt_len_hist_user.c",
  "human_readable_source": "\n#include <linux/unistd.h>\n#include <linux/bpf.h>\n\n#include <stdlib.h>\n#include <stdio.h>\n#include <unistd.h>\n#include <string.h>\n#include <errno.h>\n#include <arpa/inet.h>\n\n#include <bpf/bpf.h>\n#include \"bpf_util.h\"\n\n#define MAX_INDEX 64\n#define MAX_STARS 38\n\nstatic void stars(char *str, long val, long max, int width)\n{\n\tint i;\n\n\tfor (i = 0; i < (width * val / max) - 1 && i < width - 1; i++)\n\t\tstr[i] = '*';\n\tif (val > max)\n\t\tstr[i - 1] = '+';\n\tstr[i] = '\\0';\n}\n\nint main(int argc, char **argv)\n{\n\tunsigned int nr_cpus = bpf_num_possible_cpus();\n\tconst char *map_filename = \"/sys/fs/bpf/tc/globals/lwt_len_hist_map\";\n\tuint64_t values[nr_cpus], sum, max_value = 0, data[MAX_INDEX] = {};\n\tuint64_t key = 0, next_key, max_key = 0;\n\tchar starstr[MAX_STARS];\n\tint i, map_fd;\n\n\tmap_fd = bpf_obj_get(map_filename);\n\tif (map_fd < 0) {\n\t\tfprintf(stderr, \"bpf_obj_get(%s): %s(%d)\\n\",\n\t\t\tmap_filename, strerror(errno), errno);\n\t\treturn -1;\n\t}\n\n\twhile (bpf_map_get_next_key(map_fd, &key, &next_key) == 0) {\n\t\tif (next_key >= MAX_INDEX) {\n\t\t\tfprintf(stderr, \"Key %lu out of bounds\\n\", next_key);\n\t\t\tcontinue;\n\t\t}\n\n\t\tbpf_map_lookup_elem(map_fd, &next_key, values);\n\n\t\tsum = 0;\n\t\tfor (i = 0; i < nr_cpus; i++)\n\t\t\tsum += values[i];\n\n\t\tdata[next_key] = sum;\n\t\tif (sum && next_key > max_key)\n\t\t\tmax_key = next_key;\n\n\t\tif (sum > max_value)\n\t\t\tmax_value = sum;\n\n\t\tkey = next_key;\n\t}\n\n\tfor (i = 1; i <= max_key + 1; i++) {\n\t\tstars(starstr, data[i - 1], max_value, MAX_STARS);\n\t\tprintf(\"%8ld -> %-8ld : %-8ld |%-*s|\\n\",\n\t\t       (1l << i) >> 1, (1l << i) - 1, data[i - 1],\n\t\t       MAX_STARS, starstr);\n\t}\n\n\tclose(map_fd);\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}