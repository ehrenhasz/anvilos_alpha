{
  "module_name": "test_probe_write_user_user.c",
  "hash_id": "5ce39aa7e62ba6e66cdc8b4401e6704b2432b275290a7f876933c94a7bfe4ea5",
  "original_prompt": "Ingested from linux-6.6.14/samples/bpf/test_probe_write_user_user.c",
  "human_readable_source": "\n#include <stdio.h>\n#include <assert.h>\n#include <unistd.h>\n#include <bpf/bpf.h>\n#include <bpf/libbpf.h>\n#include <sys/socket.h>\n#include <netinet/in.h>\n#include <arpa/inet.h>\n\nint main(int ac, char **argv)\n{\n\tstruct sockaddr_in *serv_addr_in, *mapped_addr_in, *tmp_addr_in;\n\tstruct sockaddr serv_addr, mapped_addr, tmp_addr;\n\tint serverfd, serverconnfd, clientfd, map_fd;\n\tstruct bpf_link *link = NULL;\n\tstruct bpf_program *prog;\n\tstruct bpf_object *obj;\n\tsocklen_t sockaddr_len;\n\tchar filename[256];\n\tchar *ip;\n\n\tserv_addr_in = (struct sockaddr_in *)&serv_addr;\n\tmapped_addr_in = (struct sockaddr_in *)&mapped_addr;\n\ttmp_addr_in = (struct sockaddr_in *)&tmp_addr;\n\n\tsnprintf(filename, sizeof(filename), \"%s.bpf.o\", argv[0]);\n\tobj = bpf_object__open_file(filename, NULL);\n\tif (libbpf_get_error(obj)) {\n\t\tfprintf(stderr, \"ERROR: opening BPF object file failed\\n\");\n\t\treturn 0;\n\t}\n\n\tprog = bpf_object__find_program_by_name(obj, \"bpf_prog1\");\n\tif (libbpf_get_error(prog)) {\n\t\tfprintf(stderr, \"ERROR: finding a prog in obj file failed\\n\");\n\t\tgoto cleanup;\n\t}\n\n\t \n\tif (bpf_object__load(obj)) {\n\t\tfprintf(stderr, \"ERROR: loading BPF object file failed\\n\");\n\t\tgoto cleanup;\n\t}\n\n\tmap_fd = bpf_object__find_map_fd_by_name(obj, \"dnat_map\");\n\tif (map_fd < 0) {\n\t\tfprintf(stderr, \"ERROR: finding a map in obj file failed\\n\");\n\t\tgoto cleanup;\n\t}\n\n\tlink = bpf_program__attach(prog);\n\tif (libbpf_get_error(link)) {\n\t\tfprintf(stderr, \"ERROR: bpf_program__attach failed\\n\");\n\t\tlink = NULL;\n\t\tgoto cleanup;\n\t}\n\n\tassert((serverfd = socket(AF_INET, SOCK_STREAM, 0)) > 0);\n\tassert((clientfd = socket(AF_INET, SOCK_STREAM, 0)) > 0);\n\n\t \n\tmemset(&serv_addr, 0, sizeof(serv_addr));\n\tserv_addr_in->sin_family = AF_INET;\n\tserv_addr_in->sin_port = 0;\n\tserv_addr_in->sin_addr.s_addr = htonl(INADDR_LOOPBACK);\n\n\tassert(bind(serverfd, &serv_addr, sizeof(serv_addr)) == 0);\n\n\tsockaddr_len = sizeof(serv_addr);\n\tassert(getsockname(serverfd, &serv_addr, &sockaddr_len) == 0);\n\tip = inet_ntoa(serv_addr_in->sin_addr);\n\tprintf(\"Server bound to: %s:%d\\n\", ip, ntohs(serv_addr_in->sin_port));\n\n\tmemset(&mapped_addr, 0, sizeof(mapped_addr));\n\tmapped_addr_in->sin_family = AF_INET;\n\tmapped_addr_in->sin_port = htons(5555);\n\tmapped_addr_in->sin_addr.s_addr = inet_addr(\"255.255.255.255\");\n\n\tassert(!bpf_map_update_elem(map_fd, &mapped_addr, &serv_addr, BPF_ANY));\n\n\tassert(listen(serverfd, 5) == 0);\n\n\tip = inet_ntoa(mapped_addr_in->sin_addr);\n\tprintf(\"Client connecting to: %s:%d\\n\",\n\t       ip, ntohs(mapped_addr_in->sin_port));\n\tassert(connect(clientfd, &mapped_addr, sizeof(mapped_addr)) == 0);\n\n\tsockaddr_len = sizeof(tmp_addr);\n\tip = inet_ntoa(tmp_addr_in->sin_addr);\n\tassert((serverconnfd = accept(serverfd, &tmp_addr, &sockaddr_len)) > 0);\n\tprintf(\"Server received connection from: %s:%d\\n\",\n\t       ip, ntohs(tmp_addr_in->sin_port));\n\n\tsockaddr_len = sizeof(tmp_addr);\n\tassert(getpeername(clientfd, &tmp_addr, &sockaddr_len) == 0);\n\tip = inet_ntoa(tmp_addr_in->sin_addr);\n\tprintf(\"Client's peer address: %s:%d\\n\",\n\t       ip, ntohs(tmp_addr_in->sin_port));\n\n\t \n\tassert(memcmp(&serv_addr, &tmp_addr, sizeof(struct sockaddr_in)) == 0);\n\ncleanup:\n\tbpf_link__destroy(link);\n\tbpf_object__close(obj);\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}