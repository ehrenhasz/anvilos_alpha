{
  "module_name": "ibumad_kern.c",
  "hash_id": "f7e3c5e48ea261777c35c9d21cff2445cf6b4ce9c3b32fd01b05ae716e753758",
  "original_prompt": "Ingested from linux-6.6.14/samples/bpf/ibumad_kern.c",
  "human_readable_source": "\n\n \n\n#define KBUILD_MODNAME \"ibumad_count_pkts_by_class\"\n#include <uapi/linux/bpf.h>\n\n#include <bpf/bpf_helpers.h>\n\n\nstruct {\n\t__uint(type, BPF_MAP_TYPE_ARRAY);\n\t__type(key, u32);  \n\t__type(value, u64);  \n\t__uint(max_entries, 256);  \n} read_count SEC(\".maps\");\n\nstruct {\n\t__uint(type, BPF_MAP_TYPE_ARRAY);\n\t__type(key, u32);  \n\t__type(value, u64);  \n\t__uint(max_entries, 256);  \n} write_count SEC(\".maps\");\n\n#undef DEBUG\n#ifndef DEBUG\n#undef bpf_printk\n#define bpf_printk(fmt, ...)\n#endif\n\n \nstruct ib_umad_rw_args {\n\tu64 pad;\n\tu8 port_num;\n\tu8 sl;\n\tu8 path_bits;\n\tu8 grh_present;\n\tu32 id;\n\tu32 status;\n\tu32 timeout_ms;\n\tu32 retires;\n\tu32 length;\n\tu32 qpn;\n\tu32 qkey;\n\tu8 gid_index;\n\tu8 hop_limit;\n\tu16 lid;\n\tu16 attr_id;\n\tu16 pkey_index;\n\tu8 base_version;\n\tu8 mgmt_class;\n\tu8 class_version;\n\tu8 method;\n\tu32 flow_label;\n\tu16 mad_status;\n\tu16 class_specific;\n\tu32 attr_mod;\n\tu64 tid;\n\tu8 gid[16];\n\tu32 dev_index;\n\tu8 traffic_class;\n};\n\nSEC(\"tracepoint/ib_umad/ib_umad_read_recv\")\nint on_ib_umad_read_recv(struct ib_umad_rw_args *ctx)\n{\n\tu64 zero = 0, *val;\n\tu8 class = ctx->mgmt_class;\n\n\tbpf_printk(\"ib_umad read recv : class 0x%x\\n\", class);\n\n\tval = bpf_map_lookup_elem(&read_count, &class);\n\tif (!val) {\n\t\tbpf_map_update_elem(&read_count, &class, &zero, BPF_NOEXIST);\n\t\tval = bpf_map_lookup_elem(&read_count, &class);\n\t\tif (!val)\n\t\t\treturn 0;\n\t}\n\n\t(*val) += 1;\n\n\treturn 0;\n}\nSEC(\"tracepoint/ib_umad/ib_umad_read_send\")\nint on_ib_umad_read_send(struct ib_umad_rw_args *ctx)\n{\n\tu64 zero = 0, *val;\n\tu8 class = ctx->mgmt_class;\n\n\tbpf_printk(\"ib_umad read send : class 0x%x\\n\", class);\n\n\tval = bpf_map_lookup_elem(&read_count, &class);\n\tif (!val) {\n\t\tbpf_map_update_elem(&read_count, &class, &zero, BPF_NOEXIST);\n\t\tval = bpf_map_lookup_elem(&read_count, &class);\n\t\tif (!val)\n\t\t\treturn 0;\n\t}\n\n\t(*val) += 1;\n\n\treturn 0;\n}\nSEC(\"tracepoint/ib_umad/ib_umad_write\")\nint on_ib_umad_write(struct ib_umad_rw_args *ctx)\n{\n\tu64 zero = 0, *val;\n\tu8 class = ctx->mgmt_class;\n\n\tbpf_printk(\"ib_umad write : class 0x%x\\n\", class);\n\n\tval = bpf_map_lookup_elem(&write_count, &class);\n\tif (!val) {\n\t\tbpf_map_update_elem(&write_count, &class, &zero, BPF_NOEXIST);\n\t\tval = bpf_map_lookup_elem(&write_count, &class);\n\t\tif (!val)\n\t\t\treturn 0;\n\t}\n\n\t(*val) += 1;\n\n\treturn 0;\n}\n\nchar _license[] SEC(\"license\") = \"GPL\";\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}