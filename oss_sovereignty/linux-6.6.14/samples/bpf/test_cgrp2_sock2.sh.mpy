{
  "module_name": "test_cgrp2_sock2.sh",
  "hash_id": "8a932b3a053e8485f7924e2a6c4768b252acbe78af8a976de0cf4b40f69c9452",
  "original_prompt": "Ingested from linux-6.6.14/samples/bpf/test_cgrp2_sock2.sh",
  "human_readable_source": "#!/bin/bash\n# SPDX-License-Identifier: GPL-2.0\n\nBPFFS=/sys/fs/bpf\nMY_DIR=$(dirname $0)\nTEST=$MY_DIR/test_cgrp2_sock2\nLINK_PIN=$BPFFS/test_cgrp2_sock2\nBPF_PROG=$MY_DIR/sock_flags.bpf.o\n\nfunction config_device {\n\tip netns add at_ns0\n\tip link add veth0 type veth peer name veth0b\n\tip link set veth0 netns at_ns0\n\tip netns exec at_ns0 sysctl -q net.ipv6.conf.veth0.disable_ipv6=0\n\tip netns exec at_ns0 ip addr add 172.16.1.100/24 dev veth0\n\tip netns exec at_ns0 ip addr add 2401:db00::1/64 dev veth0 nodad\n\tip netns exec at_ns0 ip link set dev veth0 up\n\tsysctl -q net.ipv6.conf.veth0b.disable_ipv6=0\n\tip addr add 172.16.1.101/24 dev veth0b\n\tip addr add 2401:db00::2/64 dev veth0b nodad\n\tip link set veth0b up\n}\n\nfunction config_cgroup {\n\trm -rf /tmp/cgroupv2\n\tmkdir -p /tmp/cgroupv2\n\tmount -t cgroup2 none /tmp/cgroupv2\n\tmkdir -p /tmp/cgroupv2/foo\n\techo $$ >> /tmp/cgroupv2/foo/cgroup.procs\n}\n\nfunction config_bpffs {\n\tif mount | grep $BPFFS > /dev/null; then\n\t\techo \"bpffs already mounted\"\n\telse\n\t\techo \"bpffs not mounted. Mounting...\"\n\t\tmount -t bpf none $BPFFS\n\tfi\n}\n\nfunction attach_bpf {\n\t$TEST /tmp/cgroupv2/foo $BPF_PROG $1\n\t[ $? -ne 0 ] && exit 1\n}\n\nfunction cleanup {\n\trm -rf $LINK_PIN\n\tip link del veth0b\n\tip netns delete at_ns0\n\tumount /tmp/cgroupv2\n\trm -rf /tmp/cgroupv2\n}\n\ncleanup 2>/dev/null\n\nset -e\nconfig_device\nconfig_cgroup\nconfig_bpffs\nset +e\n\n#\n# Test 1 - fail ping6\n#\nattach_bpf 0\nping -c1 -w1 172.16.1.100\nif [ $? -ne 0 ]; then\n\techo \"ping failed when it should succeed\"\n\tcleanup\n\texit 1\nfi\n\nping6 -c1 -w1 2401:db00::1\nif [ $? -eq 0 ]; then\n\techo \"ping6 succeeded when it should not\"\n\tcleanup\n\texit 1\nfi\n\nrm -rf $LINK_PIN\nsleep 1                 # Wait for link detach\n\n#\n# Test 2 - fail ping\n#\nattach_bpf 1\nping6 -c1 -w1 2401:db00::1\nif [ $? -ne 0 ]; then\n\techo \"ping6 failed when it should succeed\"\n\tcleanup\n\texit 1\nfi\n\nping -c1 -w1 172.16.1.100\nif [ $? -eq 0 ]; then\n\techo \"ping succeeded when it should not\"\n\tcleanup\n\texit 1\nfi\n\ncleanup\necho\necho \"*** PASS ***\"\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}