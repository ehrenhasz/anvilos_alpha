{
  "module_name": "tracex5.bpf.c",
  "hash_id": "fdd309f04d8e8add929fdd546987c865ca506b0bc53852ba62860bf6af6df644",
  "original_prompt": "Ingested from linux-6.6.14/samples/bpf/tracex5.bpf.c",
  "human_readable_source": " \n#include \"vmlinux.h\"\n#include \"syscall_nrs.h\"\n#include <linux/version.h>\n#include <uapi/linux/unistd.h>\n#include <bpf/bpf_helpers.h>\n#include <bpf/bpf_tracing.h>\n#include <bpf/bpf_core_read.h>\n\n#define __stringify(x) #x\n#define PROG(F) SEC(\"kprobe/\"__stringify(F)) int bpf_func_##F\n\nstruct {\n\t__uint(type, BPF_MAP_TYPE_PROG_ARRAY);\n\t__uint(key_size, sizeof(u32));\n\t__uint(value_size, sizeof(u32));\n#ifdef __mips__\n\t__uint(max_entries, 6000);  \n#else\n\t__uint(max_entries, 1024);\n#endif\n} progs SEC(\".maps\");\n\nSEC(\"kprobe/__seccomp_filter\")\nint bpf_prog1(struct pt_regs *ctx)\n{\n\tint sc_nr = (int)PT_REGS_PARM1(ctx);\n\n\t \n\tbpf_tail_call(ctx, &progs, sc_nr);\n\n\t \n\tif (sc_nr >= __NR_getuid && sc_nr <= __NR_getsid) {\n\t\tchar fmt[] = \"syscall=%d (one of get/set uid/pid/gid)\\n\";\n\t\tbpf_trace_printk(fmt, sizeof(fmt), sc_nr);\n\t}\n\treturn 0;\n}\n\n \nPROG(SYS__NR_write)(struct pt_regs *ctx)\n{\n\tstruct seccomp_data sd;\n\n\tbpf_core_read(&sd, sizeof(sd), (void *)PT_REGS_PARM2(ctx));\n\tif (sd.args[2] == 512) {\n\t\tchar fmt[] = \"write(fd=%d, buf=%p, size=%d)\\n\";\n\t\tbpf_trace_printk(fmt, sizeof(fmt),\n\t\t\t\t sd.args[0], sd.args[1], sd.args[2]);\n\t}\n\treturn 0;\n}\n\nPROG(SYS__NR_read)(struct pt_regs *ctx)\n{\n\tstruct seccomp_data sd;\n\n\tbpf_core_read(&sd, sizeof(sd), (void *)PT_REGS_PARM2(ctx));\n\tif (sd.args[2] > 128 && sd.args[2] <= 1024) {\n\t\tchar fmt[] = \"read(fd=%d, buf=%p, size=%d)\\n\";\n\t\tbpf_trace_printk(fmt, sizeof(fmt),\n\t\t\t\t sd.args[0], sd.args[1], sd.args[2]);\n\t}\n\treturn 0;\n}\n\n#ifdef __NR_mmap2\nPROG(SYS__NR_mmap2)(struct pt_regs *ctx)\n{\n\tchar fmt[] = \"mmap2\\n\";\n\n\tbpf_trace_printk(fmt, sizeof(fmt));\n\treturn 0;\n}\n#endif\n\n#ifdef __NR_mmap\nPROG(SYS__NR_mmap)(struct pt_regs *ctx)\n{\n\tchar fmt[] = \"mmap\\n\";\n\n\tbpf_trace_printk(fmt, sizeof(fmt));\n\treturn 0;\n}\n#endif\n\nchar _license[] SEC(\"license\") = \"GPL\";\nu32 _version SEC(\"version\") = LINUX_VERSION_CODE;\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}