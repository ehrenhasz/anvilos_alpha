{
  "module_name": "tcp_clamp_kern.c",
  "hash_id": "58c41daf31b3d20da86c1dfa64d1555ad5a053ccd8e4a7bde6f38817a87aa798",
  "original_prompt": "Ingested from linux-6.6.14/samples/bpf/tcp_clamp_kern.c",
  "human_readable_source": " \n\n#include <uapi/linux/bpf.h>\n#include <uapi/linux/if_ether.h>\n#include <uapi/linux/if_packet.h>\n#include <uapi/linux/ip.h>\n#include <linux/socket.h>\n#include <bpf/bpf_helpers.h>\n#include <bpf/bpf_endian.h>\n\n#define DEBUG 1\n\nSEC(\"sockops\")\nint bpf_clamp(struct bpf_sock_ops *skops)\n{\n\tint bufsize = 150000;\n\tint to_init = 10;\n\tint clamp = 100;\n\tint rv = 0;\n\tint op;\n\n\t \n\tif (bpf_ntohl(skops->remote_port) != 55601 && skops->local_port != 55601) {\n\t\tskops->reply = -1;\n\t\treturn 0;\n\t}\n\n\top = (int) skops->op;\n\n#ifdef DEBUG\n\tbpf_printk(\"BPF command: %d\\n\", op);\n#endif\n\n\t \n\tif (skops->family == AF_INET6 &&\n\t    skops->local_ip6[0] == skops->remote_ip6[0] &&\n\t    (bpf_ntohl(skops->local_ip6[1]) & 0xfff00000) ==\n\t    (bpf_ntohl(skops->remote_ip6[1]) & 0xfff00000)) {\n\t\tswitch (op) {\n\t\tcase BPF_SOCK_OPS_TIMEOUT_INIT:\n\t\t\trv = to_init;\n\t\t\tbreak;\n\t\tcase BPF_SOCK_OPS_TCP_CONNECT_CB:\n\t\t\t \n\t\t\trv = bpf_setsockopt(skops, SOL_SOCKET, SO_SNDBUF,\n\t\t\t\t\t    &bufsize, sizeof(bufsize));\n\t\t\trv += bpf_setsockopt(skops, SOL_SOCKET,\n\t\t\t\t\t     SO_RCVBUF, &bufsize,\n\t\t\t\t\t     sizeof(bufsize));\n\t\t\tbreak;\n\t\tcase BPF_SOCK_OPS_ACTIVE_ESTABLISHED_CB:\n\t\t\trv = bpf_setsockopt(skops, SOL_TCP,\n\t\t\t\t\t    TCP_BPF_SNDCWND_CLAMP,\n\t\t\t\t\t    &clamp, sizeof(clamp));\n\t\t\tbreak;\n\t\tcase BPF_SOCK_OPS_PASSIVE_ESTABLISHED_CB:\n\t\t\t \n\t\t\trv = bpf_setsockopt(skops, SOL_TCP,\n\t\t\t\t\t    TCP_BPF_SNDCWND_CLAMP,\n\t\t\t\t\t    &clamp, sizeof(clamp));\n\t\t\trv += bpf_setsockopt(skops, SOL_SOCKET,\n\t\t\t\t\t     SO_SNDBUF, &bufsize,\n\t\t\t\t\t     sizeof(bufsize));\n\t\t\trv += bpf_setsockopt(skops, SOL_SOCKET,\n\t\t\t\t\t     SO_RCVBUF, &bufsize,\n\t\t\t\t\t     sizeof(bufsize));\n\t\t\tbreak;\n\t\tdefault:\n\t\t\trv = -1;\n\t\t}\n\t} else {\n\t\trv = -1;\n\t}\n#ifdef DEBUG\n\tbpf_printk(\"Returning %d\\n\", rv);\n#endif\n\tskops->reply = rv;\n\treturn 1;\n}\nchar _license[] SEC(\"license\") = \"GPL\";\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}