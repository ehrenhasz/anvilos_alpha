{
  "module_name": "hid_surface_dial.bpf.c",
  "hash_id": "be62bb0973b6c233d86d6e90ebb35452e1cc695ae24bc9660183ef1f3a72ca60",
  "original_prompt": "Ingested from linux-6.6.14/samples/hid/hid_surface_dial.bpf.c",
  "human_readable_source": "\n \n\n#include \"vmlinux.h\"\n#include <bpf/bpf_helpers.h>\n#include <bpf/bpf_tracing.h>\n#include \"hid_bpf_helpers.h\"\n\n#define HID_UP_BUTTON\t\t0x0009\n#define HID_GD_WHEEL\t\t0x0038\n\nSEC(\"fmod_ret/hid_bpf_device_event\")\nint BPF_PROG(hid_event, struct hid_bpf_ctx *hctx)\n{\n\t__u8 *data = hid_bpf_get_data(hctx, 0  , 9  );\n\n\tif (!data)\n\t\treturn 0;  \n\n\t \n\tdata[1] &= 0xfd;\n\n\t \n\tdata[4] = 0;\n\tdata[5] = 0;\n\n\t \n\tdata[6] = 0;\n\tdata[7] = 0;\n\n\treturn 0;\n}\n\n \nint resolution = 72;\nint physical = 5;\n\nstruct haptic_syscall_args {\n\tunsigned int hid;\n\tint retval;\n};\n\nstatic __u8 haptic_data[8];\n\nSEC(\"syscall\")\nint set_haptic(struct haptic_syscall_args *args)\n{\n\tstruct hid_bpf_ctx *ctx;\n\tconst size_t size = sizeof(haptic_data);\n\tu16 *res;\n\tint ret;\n\n\tif (size > sizeof(haptic_data))\n\t\treturn -7;  \n\n\tctx = hid_bpf_allocate_context(args->hid);\n\tif (!ctx)\n\t\treturn -1;  \n\n\thaptic_data[0] = 1;   \n\n\tret = hid_bpf_hw_request(ctx, haptic_data, size, HID_FEATURE_REPORT, HID_REQ_GET_REPORT);\n\n\tbpf_printk(\"probed/remove event ret value: %d\", ret);\n\tbpf_printk(\"buf: %02x %02x %02x\",\n\t\t   haptic_data[0],\n\t\t   haptic_data[1],\n\t\t   haptic_data[2]);\n\tbpf_printk(\"     %02x %02x %02x\",\n\t\t   haptic_data[3],\n\t\t   haptic_data[4],\n\t\t   haptic_data[5]);\n\tbpf_printk(\"     %02x %02x\",\n\t\t   haptic_data[6],\n\t\t   haptic_data[7]);\n\n\t \n\tres = (u16 *)&haptic_data[1];\n\tif (*res != 3600) {\n\n\n\n\t\thaptic_data[4] = 3;   \n\n\n\n\t} else {\n\t\thaptic_data[4] = 0;\n\t}\n\n\tret = hid_bpf_hw_request(ctx, haptic_data, size, HID_FEATURE_REPORT, HID_REQ_SET_REPORT);\n\n\tbpf_printk(\"set haptic ret value: %d -> %d\", ret, haptic_data[4]);\n\n\targs->retval = ret;\n\n\thid_bpf_release_context(ctx);\n\n\treturn 0;\n}\n\n \nSEC(\"fmod_ret/hid_bpf_rdesc_fixup\")\nint BPF_PROG(hid_rdesc_fixup, struct hid_bpf_ctx *hctx)\n{\n\t__u8 *data = hid_bpf_get_data(hctx, 0  , 4096  );\n\t__u16 *res, *phys;\n\n\tif (!data)\n\t\treturn 0;  \n\n\t \n\tdata[31] = HID_UP_BUTTON;\n\tdata[33] = 2;\n\n\t \n\tdata[45] = HID_GD_WHEEL;\n\n\t \n\tphys = (__u16 *)&data[61];\n\t*phys = physical;\n\tres = (__u16 *)&data[66];\n\t*res = resolution;\n\n\t \n\tdata[88] = 0x06;\n\tdata[98] = 0x06;\n\n\treturn 0;\n}\n\nchar _license[] SEC(\"license\") = \"GPL\";\nu32 _version SEC(\"version\") = 1;\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}