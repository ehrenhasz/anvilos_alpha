{
  "module_name": "bpf-fancy.c",
  "hash_id": "6f4707f8c8e55afcefa53ba12aebce8cd1871708546c438b838a9da8768160db",
  "original_prompt": "Ingested from linux-6.6.14/samples/seccomp/bpf-fancy.c",
  "human_readable_source": "\n \n\n#include <linux/filter.h>\n#include <linux/seccomp.h>\n#include <linux/unistd.h>\n#include <stdio.h>\n#include <string.h>\n#include <sys/prctl.h>\n#include <unistd.h>\n\n#include \"bpf-helper.h\"\n\n#ifndef PR_SET_NO_NEW_PRIVS\n#define PR_SET_NO_NEW_PRIVS 38\n#endif\n\nint main(int argc, char **argv)\n{\n\tstruct bpf_labels l = {\n\t\t.count = 0,\n\t};\n\tstatic const char msg1[] = \"Please type something: \";\n\tstatic const char msg2[] = \"You typed: \";\n\tchar buf[256];\n\tstruct sock_filter filter[] = {\n\t\t \n\t\tLOAD_SYSCALL_NR,\n\t\tSYSCALL(__NR_exit, ALLOW),\n\t\tSYSCALL(__NR_exit_group, ALLOW),\n\t\tSYSCALL(__NR_write, JUMP(&l, write_fd)),\n\t\tSYSCALL(__NR_read, JUMP(&l, read)),\n\t\tDENY,   \n\n\t\tLABEL(&l, read),\n\t\tARG(0),\n\t\tJNE(STDIN_FILENO, DENY),\n\t\tARG(1),\n\t\tJNE((unsigned long)buf, DENY),\n\t\tARG(2),\n\t\tJGE(sizeof(buf), DENY),\n\t\tALLOW,\n\n\t\tLABEL(&l, write_fd),\n\t\tARG(0),\n\t\tJEQ(STDOUT_FILENO, JUMP(&l, write_buf)),\n\t\tJEQ(STDERR_FILENO, JUMP(&l, write_buf)),\n\t\tDENY,\n\n\t\tLABEL(&l, write_buf),\n\t\tARG(1),\n\t\tJEQ((unsigned long)msg1, JUMP(&l, msg1_len)),\n\t\tJEQ((unsigned long)msg2, JUMP(&l, msg2_len)),\n\t\tJEQ((unsigned long)buf, JUMP(&l, buf_len)),\n\t\tDENY,\n\n\t\tLABEL(&l, msg1_len),\n\t\tARG(2),\n\t\tJLT(sizeof(msg1), ALLOW),\n\t\tDENY,\n\n\t\tLABEL(&l, msg2_len),\n\t\tARG(2),\n\t\tJLT(sizeof(msg2), ALLOW),\n\t\tDENY,\n\n\t\tLABEL(&l, buf_len),\n\t\tARG(2),\n\t\tJLT(sizeof(buf), ALLOW),\n\t\tDENY,\n\t};\n\tstruct sock_fprog prog = {\n\t\t.filter = filter,\n\t\t.len = (unsigned short)(sizeof(filter)/sizeof(filter[0])),\n\t};\n\tssize_t bytes;\n\tbpf_resolve_jumps(&l, filter, sizeof(filter)/sizeof(*filter));\n\n\tif (prctl(PR_SET_NO_NEW_PRIVS, 1, 0, 0, 0)) {\n\t\tperror(\"prctl(NO_NEW_PRIVS)\");\n\t\treturn 1;\n\t}\n\n\tif (prctl(PR_SET_SECCOMP, SECCOMP_MODE_FILTER, &prog)) {\n\t\tperror(\"prctl(SECCOMP)\");\n\t\treturn 1;\n\t}\n\tsyscall(__NR_write, STDOUT_FILENO, msg1, strlen(msg1));\n\tbytes = syscall(__NR_read, STDIN_FILENO, buf, sizeof(buf)-1);\n\tbytes = (bytes > 0 ? bytes : 0);\n\tsyscall(__NR_write, STDERR_FILENO, msg2, strlen(msg2));\n\tsyscall(__NR_write, STDERR_FILENO, buf, bytes);\n\t \n\tsyscall(__NR_write, STDERR_FILENO, msg2, strlen(msg2)+2);\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}