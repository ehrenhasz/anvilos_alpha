{
  "module_name": "dropper.c",
  "hash_id": "eff27118814d33cfa72951a3ae82a25e2494ba26bf01555528bc5205e822e009",
  "original_prompt": "Ingested from linux-6.6.14/samples/seccomp/dropper.c",
  "human_readable_source": "\n \n\n#include <errno.h>\n#include <linux/audit.h>\n#include <linux/filter.h>\n#include <linux/seccomp.h>\n#include <linux/unistd.h>\n#include <stdio.h>\n#include <stddef.h>\n#include <stdlib.h>\n#include <sys/prctl.h>\n#include <unistd.h>\n\nstatic int install_filter(int arch, int nr, int error)\n{\n\tstruct sock_filter filter[] = {\n\t\tBPF_STMT(BPF_LD+BPF_W+BPF_ABS,\n\t\t\t (offsetof(struct seccomp_data, arch))),\n\t\tBPF_JUMP(BPF_JMP+BPF_JEQ+BPF_K, arch, 0, 3),\n\t\tBPF_STMT(BPF_LD+BPF_W+BPF_ABS,\n\t\t\t (offsetof(struct seccomp_data, nr))),\n\t\tBPF_JUMP(BPF_JMP+BPF_JEQ+BPF_K, nr, 0, 1),\n\t\tBPF_STMT(BPF_RET+BPF_K,\n\t\t\t SECCOMP_RET_ERRNO|(error & SECCOMP_RET_DATA)),\n\t\tBPF_STMT(BPF_RET+BPF_K, SECCOMP_RET_ALLOW),\n\t};\n\tstruct sock_fprog prog = {\n\t\t.len = (unsigned short)(sizeof(filter)/sizeof(filter[0])),\n\t\t.filter = filter,\n\t};\n\tif (error == -1) {\n\t\tstruct sock_filter kill = BPF_STMT(BPF_RET+BPF_K, SECCOMP_RET_KILL);\n\t\tfilter[4] = kill;\n\t}\n\tif (prctl(PR_SET_NO_NEW_PRIVS, 1, 0, 0, 0)) {\n\t\tperror(\"prctl(NO_NEW_PRIVS)\");\n\t\treturn 1;\n\t}\n\tif (prctl(PR_SET_SECCOMP, 2, &prog)) {\n\t\tperror(\"prctl(PR_SET_SECCOMP)\");\n\t\treturn 1;\n\t}\n\treturn 0;\n}\n\nint main(int argc, char **argv)\n{\n\tif (argc < 5) {\n\t\tfprintf(stderr, \"Usage:\\n\"\n\t\t\t\"dropper <arch> <syscall_nr> <errno> <prog> [<args>]\\n\"\n\t\t\t\"Hint:\tAUDIT_ARCH_I386: 0x%X\\n\"\n\t\t\t\"\tAUDIT_ARCH_X86_64: 0x%X\\n\"\n\t\t\t\"\terrno == -1 means SECCOMP_RET_KILL\\n\"\n\t\t\t\"\\n\", AUDIT_ARCH_I386, AUDIT_ARCH_X86_64);\n\t\treturn 1;\n\t}\n\tif (install_filter(strtol(argv[1], NULL, 0), strtol(argv[2], NULL, 0),\n\t\t\t   strtol(argv[3], NULL, 0)))\n\t\treturn 1;\n\texecv(argv[4], &argv[4]);\n\tprintf(\"Failed to execv\\n\");\n\treturn 255;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}