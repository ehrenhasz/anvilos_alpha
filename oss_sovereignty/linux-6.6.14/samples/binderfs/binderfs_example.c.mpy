{
  "module_name": "binderfs_example.c",
  "hash_id": "81c0d87d175faf0e5b6d3ff55b1678572c7d0ec7747e5a9216b5086416542478",
  "original_prompt": "Ingested from linux-6.6.14/samples/binderfs/binderfs_example.c",
  "human_readable_source": "\n\n#define _GNU_SOURCE\n#include <errno.h>\n#include <fcntl.h>\n#include <sched.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <sys/ioctl.h>\n#include <sys/mount.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <unistd.h>\n#include <linux/android/binder.h>\n#include <linux/android/binderfs.h>\n\nint main(int argc, char *argv[])\n{\n\tint fd, ret, saved_errno;\n\tstruct binderfs_device device = { 0 };\n\n\tret = unshare(CLONE_NEWNS);\n\tif (ret < 0) {\n\t\tfprintf(stderr, \"%s - Failed to unshare mount namespace\\n\",\n\t\t\tstrerror(errno));\n\t\texit(EXIT_FAILURE);\n\t}\n\n\tret = mount(NULL, \"/\", NULL, MS_REC | MS_PRIVATE, 0);\n\tif (ret < 0) {\n\t\tfprintf(stderr, \"%s - Failed to mount / as private\\n\",\n\t\t\tstrerror(errno));\n\t\texit(EXIT_FAILURE);\n\t}\n\n\tret = mkdir(\"/dev/binderfs\", 0755);\n\tif (ret < 0 && errno != EEXIST) {\n\t\tfprintf(stderr, \"%s - Failed to create binderfs mountpoint\\n\",\n\t\t\tstrerror(errno));\n\t\texit(EXIT_FAILURE);\n\t}\n\n\tret = mount(NULL, \"/dev/binderfs\", \"binder\", 0, 0);\n\tif (ret < 0) {\n\t\tfprintf(stderr, \"%s - Failed to mount binderfs\\n\",\n\t\t\tstrerror(errno));\n\t\texit(EXIT_FAILURE);\n\t}\n\n\tmemcpy(device.name, \"my-binder\", strlen(\"my-binder\"));\n\n\tfd = open(\"/dev/binderfs/binder-control\", O_RDONLY | O_CLOEXEC);\n\tif (fd < 0) {\n\t\tfprintf(stderr, \"%s - Failed to open binder-control device\\n\",\n\t\t\tstrerror(errno));\n\t\texit(EXIT_FAILURE);\n\t}\n\n\tret = ioctl(fd, BINDER_CTL_ADD, &device);\n\tsaved_errno = errno;\n\tclose(fd);\n\terrno = saved_errno;\n\tif (ret < 0) {\n\t\tfprintf(stderr, \"%s - Failed to allocate new binder device\\n\",\n\t\t\tstrerror(errno));\n\t\texit(EXIT_FAILURE);\n\t}\n\n\tprintf(\"Allocated new binder device with major %d, minor %d, and name %s\\n\",\n\t       device.major, device.minor, device.name);\n\n\tret = unlink(\"/dev/binderfs/my-binder\");\n\tif (ret < 0) {\n\t\tfprintf(stderr, \"%s - Failed to delete binder device\\n\",\n\t\t\tstrerror(errno));\n\t\texit(EXIT_FAILURE);\n\t}\n\n\t \n\texit(EXIT_SUCCESS);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}