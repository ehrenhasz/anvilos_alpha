{
  "module_name": "trace-events-sample.c",
  "hash_id": "3cdc9a94f3c5bae288c39224ca2744f315b53bc9b83970592c15e48a010c0b41",
  "original_prompt": "Ingested from linux-6.6.14/samples/trace_events/trace-events-sample.c",
  "human_readable_source": "\n#include <linux/module.h>\n#include <linux/kthread.h>\n\n \n#define CREATE_TRACE_POINTS\n#include \"trace-events-sample.h\"\n\nstatic const char *random_strings[] = {\n\t\"Mother Goose\",\n\t\"Snoopy\",\n\t\"Gandalf\",\n\t\"Frodo\",\n\t\"One ring to rule them all\"\n};\n\nstatic void do_simple_thread_func(int cnt, const char *fmt, ...)\n{\n\tunsigned long bitmask[1] = {0xdeadbeefUL};\n\tva_list va;\n\tint array[6];\n\tint len = cnt % 5;\n\tint i;\n\n\tset_current_state(TASK_INTERRUPTIBLE);\n\tschedule_timeout(HZ);\n\n\tfor (i = 0; i < len; i++)\n\t\tarray[i] = i + 1;\n\tarray[i] = 0;\n\n\tva_start(va, fmt);\n\n\t \n\ttrace_foo_bar(\"hello\", cnt, array, random_strings[len],\n\t\t      current->cpus_ptr, fmt, &va);\n\n\tva_end(va);\n\n\ttrace_foo_with_template_simple(\"HELLO\", cnt);\n\n\ttrace_foo_bar_with_cond(\"Some times print\", cnt);\n\n\ttrace_foo_with_template_cond(\"prints other times\", cnt);\n\n\ttrace_foo_with_template_print(\"I have to be different\", cnt);\n\n\ttrace_foo_rel_loc(\"Hello __rel_loc\", cnt, bitmask, current->cpus_ptr);\n}\n\nstatic void simple_thread_func(int cnt)\n{\n\tdo_simple_thread_func(cnt, \"iter=%d\", cnt);\n}\n\nstatic int simple_thread(void *arg)\n{\n\tint cnt = 0;\n\n\twhile (!kthread_should_stop())\n\t\tsimple_thread_func(cnt++);\n\n\treturn 0;\n}\n\nstatic struct task_struct *simple_tsk;\nstatic struct task_struct *simple_tsk_fn;\n\nstatic void simple_thread_func_fn(int cnt)\n{\n\tset_current_state(TASK_INTERRUPTIBLE);\n\tschedule_timeout(HZ);\n\n\t \n\ttrace_foo_bar_with_fn(\"Look at me\", cnt);\n\ttrace_foo_with_template_fn(\"Look at me too\", cnt);\n}\n\nstatic int simple_thread_fn(void *arg)\n{\n\tint cnt = 0;\n\n\twhile (!kthread_should_stop())\n\t\tsimple_thread_func_fn(cnt++);\n\n\treturn 0;\n}\n\nstatic DEFINE_MUTEX(thread_mutex);\nstatic int simple_thread_cnt;\n\nint foo_bar_reg(void)\n{\n\tmutex_lock(&thread_mutex);\n\tif (simple_thread_cnt++)\n\t\tgoto out;\n\n\tpr_info(\"Starting thread for foo_bar_fn\\n\");\n\t \n\tsimple_tsk_fn = kthread_run(simple_thread_fn, NULL, \"event-sample-fn\");\n out:\n\tmutex_unlock(&thread_mutex);\n\treturn 0;\n}\n\nvoid foo_bar_unreg(void)\n{\n\tmutex_lock(&thread_mutex);\n\tif (--simple_thread_cnt)\n\t\tgoto out;\n\n\tpr_info(\"Killing thread for foo_bar_fn\\n\");\n\tif (simple_tsk_fn)\n\t\tkthread_stop(simple_tsk_fn);\n\tsimple_tsk_fn = NULL;\n out:\n\tmutex_unlock(&thread_mutex);\n}\n\nstatic int __init trace_event_init(void)\n{\n\tsimple_tsk = kthread_run(simple_thread, NULL, \"event-sample\");\n\tif (IS_ERR(simple_tsk))\n\t\treturn -1;\n\n\treturn 0;\n}\n\nstatic void __exit trace_event_exit(void)\n{\n\tkthread_stop(simple_tsk);\n\tmutex_lock(&thread_mutex);\n\tif (simple_tsk_fn)\n\t\tkthread_stop(simple_tsk_fn);\n\tsimple_tsk_fn = NULL;\n\tmutex_unlock(&thread_mutex);\n}\n\nmodule_init(trace_event_init);\nmodule_exit(trace_event_exit);\n\nMODULE_AUTHOR(\"Steven Rostedt\");\nMODULE_DESCRIPTION(\"trace-events-sample\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}