{
  "module_name": "joliet.c",
  "hash_id": "c09722b04f45fc1e5329df3598760096ee0c2e556404814b904bd1702c336a62",
  "original_prompt": "Ingested from linux-6.6.14/fs/isofs/joliet.c",
  "human_readable_source": "\n \n\n#include <linux/types.h>\n#include <linux/nls.h>\n#include \"isofs.h\"\n\n \nstatic int\nuni16_to_x8(unsigned char *ascii, __be16 *uni, int len, struct nls_table *nls)\n{\n\t__be16 *ip, ch;\n\tunsigned char *op;\n\n\tip = uni;\n\top = ascii;\n\n\twhile ((ch = get_unaligned(ip)) && len) {\n\t\tint llen;\n\t\tllen = nls->uni2char(be16_to_cpu(ch), op, NLS_MAX_CHARSET_SIZE);\n\t\tif (llen > 0)\n\t\t\top += llen;\n\t\telse\n\t\t\t*op++ = '?';\n\t\tip++;\n\n\t\tlen--;\n\t}\n\t*op = 0;\n\treturn (op - ascii);\n}\n\nint\nget_joliet_filename(struct iso_directory_record * de, unsigned char *outname, struct inode * inode)\n{\n\tstruct nls_table *nls;\n\tunsigned char len = 0;\n\n\tnls = ISOFS_SB(inode->i_sb)->s_nls_iocharset;\n\n\tif (!nls) {\n\t\tlen = utf16s_to_utf8s((const wchar_t *) de->name,\n\t\t\t\tde->name_len[0] >> 1, UTF16_BIG_ENDIAN,\n\t\t\t\toutname, PAGE_SIZE);\n\t} else {\n\t\tlen = uni16_to_x8(outname, (__be16 *) de->name,\n\t\t\t\tde->name_len[0] >> 1, nls);\n\t}\n\tif ((len > 2) && (outname[len-2] == ';') && (outname[len-1] == '1'))\n\t\tlen -= 2;\n\n\t \n\twhile (len >= 2 && (outname[len-1] == '.'))\n\t\tlen--;\n\n\treturn len;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}