{
  "module_name": "dcache.c",
  "hash_id": "16c4d536a51daf935dc9674793c849d3a20d52714753722030a453caea348dd0",
  "original_prompt": "Ingested from linux-6.6.14/fs/orangefs/dcache.c",
  "human_readable_source": "\n \n\n \n\n#include \"protocol.h\"\n#include \"orangefs-kernel.h\"\n\n \nstatic int orangefs_revalidate_lookup(struct dentry *dentry)\n{\n\tstruct dentry *parent_dentry = dget_parent(dentry);\n\tstruct inode *parent_inode = parent_dentry->d_inode;\n\tstruct orangefs_inode_s *parent = ORANGEFS_I(parent_inode);\n\tstruct inode *inode = dentry->d_inode;\n\tstruct orangefs_kernel_op_s *new_op;\n\tint ret = 0;\n\tint err = 0;\n\n\tgossip_debug(GOSSIP_DCACHE_DEBUG, \"%s: attempting lookup.\\n\", __func__);\n\n\tnew_op = op_alloc(ORANGEFS_VFS_OP_LOOKUP);\n\tif (!new_op) {\n\t\tret = -ENOMEM;\n\t\tgoto out_put_parent;\n\t}\n\n\tnew_op->upcall.req.lookup.sym_follow = ORANGEFS_LOOKUP_LINK_NO_FOLLOW;\n\tnew_op->upcall.req.lookup.parent_refn = parent->refn;\n\tstrncpy(new_op->upcall.req.lookup.d_name,\n\t\tdentry->d_name.name,\n\t\tORANGEFS_NAME_MAX - 1);\n\n\tgossip_debug(GOSSIP_DCACHE_DEBUG,\n\t\t     \"%s:%s:%d interrupt flag [%d]\\n\",\n\t\t     __FILE__,\n\t\t     __func__,\n\t\t     __LINE__,\n\t\t     get_interruptible_flag(parent_inode));\n\n\terr = service_operation(new_op, \"orangefs_lookup\",\n\t\t\tget_interruptible_flag(parent_inode));\n\n\t \n\tif (inode) {\n\t\tif (err) {\n\t\t\tgossip_debug(GOSSIP_DCACHE_DEBUG,\n\t\t\t    \"%s:%s:%d lookup failure.\\n\",\n\t\t\t    __FILE__, __func__, __LINE__);\n\t\t\tgoto out_drop;\n\t\t}\n\t\tif (!match_handle(new_op->downcall.resp.lookup.refn.khandle,\n\t\t    inode)) {\n\t\t\tgossip_debug(GOSSIP_DCACHE_DEBUG,\n\t\t\t    \"%s:%s:%d no match.\\n\",\n\t\t\t    __FILE__, __func__, __LINE__);\n\t\t\tgoto out_drop;\n\t\t}\n\n\t \n\t} else {\n\t\tgossip_debug(GOSSIP_DCACHE_DEBUG, \"%s: negative dentry.\\n\",\n\t\t    __func__);\n\t\tif (!err || err != -ENOENT) {\n\t\t\tif (new_op->downcall.status != 0)\n\t\t\t\tgossip_debug(GOSSIP_DCACHE_DEBUG,\n\t\t\t\t    \"%s:%s:%d lookup failure.\\n\",\n\t\t\t\t    __FILE__, __func__, __LINE__);\n\t\t\tgoto out_drop;\n\t\t}\n\t}\n\n\torangefs_set_timeout(dentry);\n\tret = 1;\nout_release_op:\n\top_release(new_op);\nout_put_parent:\n\tdput(parent_dentry);\n\treturn ret;\nout_drop:\n\tgossip_debug(GOSSIP_DCACHE_DEBUG, \"%s:%s:%d revalidate failed\\n\",\n\t    __FILE__, __func__, __LINE__);\n\tgoto out_release_op;\n}\n\n \nstatic int orangefs_d_revalidate(struct dentry *dentry, unsigned int flags)\n{\n\tint ret;\n\tunsigned long time = (unsigned long) dentry->d_fsdata;\n\n\tif (time_before(jiffies, time))\n\t\treturn 1;\n\n\tif (flags & LOOKUP_RCU)\n\t\treturn -ECHILD;\n\n\tgossip_debug(GOSSIP_DCACHE_DEBUG, \"%s: called on dentry %p.\\n\",\n\t\t     __func__, dentry);\n\n\t \n\tif (dentry->d_inode && is_root_handle(dentry->d_inode))\n\t\treturn 1;\n\n\t \n\tif (!orangefs_revalidate_lookup(dentry))\n\t\treturn 0;\n\n\t \n\tif (!dentry->d_inode) {\n\t\tgossip_debug(GOSSIP_DCACHE_DEBUG,\n\t\t    \"%s: negative dentry or positive dentry and inode valid.\\n\",\n\t\t    __func__);\n\t\treturn 1;\n\t}\n\n\t \n\n\tret = orangefs_inode_check_changed(dentry->d_inode);\n\tif (ret < 0) {\n\t\tgossip_debug(GOSSIP_DCACHE_DEBUG, \"%s:%s:%d getattr failure.\\n\",\n\t\t    __FILE__, __func__, __LINE__);\n\t\treturn 0;\n\t}\n\treturn !ret;\n}\n\nconst struct dentry_operations orangefs_dentry_operations = {\n\t.d_revalidate = orangefs_d_revalidate,\n};\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}