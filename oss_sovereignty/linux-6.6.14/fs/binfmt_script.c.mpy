{
  "module_name": "binfmt_script.c",
  "hash_id": "096d975214b7b5ebcc024598d814447f0682c226ae484e2093d76d0ba06b2459",
  "original_prompt": "Ingested from linux-6.6.14/fs/binfmt_script.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/string.h>\n#include <linux/stat.h>\n#include <linux/binfmts.h>\n#include <linux/init.h>\n#include <linux/file.h>\n#include <linux/err.h>\n#include <linux/fs.h>\n\nstatic inline bool spacetab(char c) { return c == ' ' || c == '\\t'; }\nstatic inline const char *next_non_spacetab(const char *first, const char *last)\n{\n\tfor (; first <= last; first++)\n\t\tif (!spacetab(*first))\n\t\t\treturn first;\n\treturn NULL;\n}\nstatic inline const char *next_terminator(const char *first, const char *last)\n{\n\tfor (; first <= last; first++)\n\t\tif (spacetab(*first) || !*first)\n\t\t\treturn first;\n\treturn NULL;\n}\n\nstatic int load_script(struct linux_binprm *bprm)\n{\n\tconst char *i_name, *i_sep, *i_arg, *i_end, *buf_end;\n\tstruct file *file;\n\tint retval;\n\n\t \n\tif ((bprm->buf[0] != '#') || (bprm->buf[1] != '!'))\n\t\treturn -ENOEXEC;\n\n\t \n\tbuf_end = bprm->buf + sizeof(bprm->buf) - 1;\n\ti_end = strnchr(bprm->buf, sizeof(bprm->buf), '\\n');\n\tif (!i_end) {\n\t\ti_end = next_non_spacetab(bprm->buf + 2, buf_end);\n\t\tif (!i_end)\n\t\t\treturn -ENOEXEC;  \n\t\t \n\t\tif (!next_terminator(i_end, buf_end))\n\t\t\treturn -ENOEXEC;\n\t\ti_end = buf_end;\n\t}\n\t \n\twhile (spacetab(i_end[-1]))\n\t\ti_end--;\n\n\t \n\ti_name = next_non_spacetab(bprm->buf+2, i_end);\n\tif (!i_name || (i_name == i_end))\n\t\treturn -ENOEXEC;  \n\n\t \n\ti_arg = NULL;\n\ti_sep = next_terminator(i_name, i_end);\n\tif (i_sep && (*i_sep != '\\0'))\n\t\ti_arg = next_non_spacetab(i_sep, i_end);\n\n\t \n\tif (bprm->interp_flags & BINPRM_FLAGS_PATH_INACCESSIBLE)\n\t\treturn -ENOENT;\n\n\t \n\tretval = remove_arg_zero(bprm);\n\tif (retval)\n\t\treturn retval;\n\tretval = copy_string_kernel(bprm->interp, bprm);\n\tif (retval < 0)\n\t\treturn retval;\n\tbprm->argc++;\n\t*((char *)i_end) = '\\0';\n\tif (i_arg) {\n\t\t*((char *)i_sep) = '\\0';\n\t\tretval = copy_string_kernel(i_arg, bprm);\n\t\tif (retval < 0)\n\t\t\treturn retval;\n\t\tbprm->argc++;\n\t}\n\tretval = copy_string_kernel(i_name, bprm);\n\tif (retval)\n\t\treturn retval;\n\tbprm->argc++;\n\tretval = bprm_change_interp(i_name, bprm);\n\tif (retval < 0)\n\t\treturn retval;\n\n\t \n\tfile = open_exec(i_name);\n\tif (IS_ERR(file))\n\t\treturn PTR_ERR(file);\n\n\tbprm->interpreter = file;\n\treturn 0;\n}\n\nstatic struct linux_binfmt script_format = {\n\t.module\t\t= THIS_MODULE,\n\t.load_binary\t= load_script,\n};\n\nstatic int __init init_script_binfmt(void)\n{\n\tregister_binfmt(&script_format);\n\treturn 0;\n}\n\nstatic void __exit exit_script_binfmt(void)\n{\n\tunregister_binfmt(&script_format);\n}\n\ncore_initcall(init_script_binfmt);\nmodule_exit(exit_script_binfmt);\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}