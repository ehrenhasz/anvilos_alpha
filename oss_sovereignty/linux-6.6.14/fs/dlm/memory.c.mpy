{
  "module_name": "memory.c",
  "hash_id": "25134f179180712f026bad030db9c8fc9f6bd3eb4cfe7691aa163d8f5be0a830",
  "original_prompt": "Ingested from linux-6.6.14/fs/dlm/memory.c",
  "human_readable_source": "\n \n\n#include \"dlm_internal.h\"\n#include \"midcomms.h\"\n#include \"lowcomms.h\"\n#include \"config.h\"\n#include \"memory.h\"\n#include \"ast.h\"\n\nstatic struct kmem_cache *writequeue_cache;\nstatic struct kmem_cache *mhandle_cache;\nstatic struct kmem_cache *msg_cache;\nstatic struct kmem_cache *lkb_cache;\nstatic struct kmem_cache *rsb_cache;\nstatic struct kmem_cache *cb_cache;\n\n\nint __init dlm_memory_init(void)\n{\n\twritequeue_cache = dlm_lowcomms_writequeue_cache_create();\n\tif (!writequeue_cache)\n\t\tgoto out;\n\n\tmhandle_cache = dlm_midcomms_cache_create();\n\tif (!mhandle_cache)\n\t\tgoto mhandle;\n\n\tlkb_cache = kmem_cache_create(\"dlm_lkb\", sizeof(struct dlm_lkb),\n\t\t\t\t__alignof__(struct dlm_lkb), 0, NULL);\n\tif (!lkb_cache)\n\t\tgoto lkb;\n\n\tmsg_cache = dlm_lowcomms_msg_cache_create();\n\tif (!msg_cache)\n\t\tgoto msg;\n\n\trsb_cache = kmem_cache_create(\"dlm_rsb\", sizeof(struct dlm_rsb),\n\t\t\t\t__alignof__(struct dlm_rsb), 0, NULL);\n\tif (!rsb_cache)\n\t\tgoto rsb;\n\n\tcb_cache = kmem_cache_create(\"dlm_cb\", sizeof(struct dlm_callback),\n\t\t\t\t     __alignof__(struct dlm_callback), 0,\n\t\t\t\t     NULL);\n\tif (!cb_cache)\n\t\tgoto cb;\n\n\treturn 0;\n\ncb:\n\tkmem_cache_destroy(rsb_cache);\nrsb:\n\tkmem_cache_destroy(msg_cache);\nmsg:\n\tkmem_cache_destroy(lkb_cache);\nlkb:\n\tkmem_cache_destroy(mhandle_cache);\nmhandle:\n\tkmem_cache_destroy(writequeue_cache);\nout:\n\treturn -ENOMEM;\n}\n\nvoid dlm_memory_exit(void)\n{\n\tkmem_cache_destroy(writequeue_cache);\n\tkmem_cache_destroy(mhandle_cache);\n\tkmem_cache_destroy(msg_cache);\n\tkmem_cache_destroy(lkb_cache);\n\tkmem_cache_destroy(rsb_cache);\n\tkmem_cache_destroy(cb_cache);\n}\n\nchar *dlm_allocate_lvb(struct dlm_ls *ls)\n{\n\tchar *p;\n\n\tp = kzalloc(ls->ls_lvblen, GFP_NOFS);\n\treturn p;\n}\n\nvoid dlm_free_lvb(char *p)\n{\n\tkfree(p);\n}\n\nstruct dlm_rsb *dlm_allocate_rsb(struct dlm_ls *ls)\n{\n\tstruct dlm_rsb *r;\n\n\tr = kmem_cache_zalloc(rsb_cache, GFP_NOFS);\n\treturn r;\n}\n\nvoid dlm_free_rsb(struct dlm_rsb *r)\n{\n\tif (r->res_lvbptr)\n\t\tdlm_free_lvb(r->res_lvbptr);\n\tkmem_cache_free(rsb_cache, r);\n}\n\nstruct dlm_lkb *dlm_allocate_lkb(struct dlm_ls *ls)\n{\n\tstruct dlm_lkb *lkb;\n\n\tlkb = kmem_cache_zalloc(lkb_cache, GFP_NOFS);\n\treturn lkb;\n}\n\nvoid dlm_free_lkb(struct dlm_lkb *lkb)\n{\n\tif (test_bit(DLM_DFL_USER_BIT, &lkb->lkb_dflags)) {\n\t\tstruct dlm_user_args *ua;\n\t\tua = lkb->lkb_ua;\n\t\tif (ua) {\n\t\t\tkfree(ua->lksb.sb_lvbptr);\n\t\t\tkfree(ua);\n\t\t}\n\t}\n\n\t \n\tdlm_callback_set_last_ptr(&lkb->lkb_last_cast, NULL);\n\tdlm_callback_set_last_ptr(&lkb->lkb_last_cb, NULL);\n\n\tkmem_cache_free(lkb_cache, lkb);\n}\n\nstruct dlm_mhandle *dlm_allocate_mhandle(gfp_t allocation)\n{\n\treturn kmem_cache_alloc(mhandle_cache, allocation);\n}\n\nvoid dlm_free_mhandle(struct dlm_mhandle *mhandle)\n{\n\tkmem_cache_free(mhandle_cache, mhandle);\n}\n\nstruct writequeue_entry *dlm_allocate_writequeue(void)\n{\n\treturn kmem_cache_alloc(writequeue_cache, GFP_ATOMIC);\n}\n\nvoid dlm_free_writequeue(struct writequeue_entry *writequeue)\n{\n\tkmem_cache_free(writequeue_cache, writequeue);\n}\n\nstruct dlm_msg *dlm_allocate_msg(gfp_t allocation)\n{\n\treturn kmem_cache_alloc(msg_cache, allocation);\n}\n\nvoid dlm_free_msg(struct dlm_msg *msg)\n{\n\tkmem_cache_free(msg_cache, msg);\n}\n\nstruct dlm_callback *dlm_allocate_cb(void)\n{\n\treturn kmem_cache_alloc(cb_cache, GFP_ATOMIC);\n}\n\nvoid dlm_free_cb(struct dlm_callback *cb)\n{\n\tkmem_cache_free(cb_cache, cb);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}