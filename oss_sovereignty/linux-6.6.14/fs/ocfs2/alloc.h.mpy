{
  "module_name": "alloc.h",
  "hash_id": "c1488bb4658b378271a8a9af8384be90d051d4f89f5d64a6172389ce23056cb0",
  "original_prompt": "Ingested from linux-6.6.14/fs/ocfs2/alloc.h",
  "human_readable_source": " \n \n\n#ifndef OCFS2_ALLOC_H\n#define OCFS2_ALLOC_H\n\n\n \n#define OCFS2_MAX_XATTR_TREE_LEAF_SIZE 65536\n\n \nstruct ocfs2_extent_tree_operations;\nstruct ocfs2_extent_tree {\n\tconst struct ocfs2_extent_tree_operations *et_ops;\n\tstruct buffer_head\t\t\t*et_root_bh;\n\tstruct ocfs2_extent_list\t\t*et_root_el;\n\tstruct ocfs2_caching_info\t\t*et_ci;\n\tocfs2_journal_access_func\t\tet_root_journal_access;\n\tvoid\t\t\t\t\t*et_object;\n\tunsigned int\t\t\t\tet_max_leaf_clusters;\n\tstruct ocfs2_cached_dealloc_ctxt\t*et_dealloc;\n};\n\n \nvoid ocfs2_init_dinode_extent_tree(struct ocfs2_extent_tree *et,\n\t\t\t\t   struct ocfs2_caching_info *ci,\n\t\t\t\t   struct buffer_head *bh);\nvoid ocfs2_init_xattr_tree_extent_tree(struct ocfs2_extent_tree *et,\n\t\t\t\t       struct ocfs2_caching_info *ci,\n\t\t\t\t       struct buffer_head *bh);\nstruct ocfs2_xattr_value_buf;\nvoid ocfs2_init_xattr_value_extent_tree(struct ocfs2_extent_tree *et,\n\t\t\t\t\tstruct ocfs2_caching_info *ci,\n\t\t\t\t\tstruct ocfs2_xattr_value_buf *vb);\nvoid ocfs2_init_dx_root_extent_tree(struct ocfs2_extent_tree *et,\n\t\t\t\t    struct ocfs2_caching_info *ci,\n\t\t\t\t    struct buffer_head *bh);\nvoid ocfs2_init_refcount_extent_tree(struct ocfs2_extent_tree *et,\n\t\t\t\t     struct ocfs2_caching_info *ci,\n\t\t\t\t     struct buffer_head *bh);\n\n \nint ocfs2_read_extent_block(struct ocfs2_caching_info *ci, u64 eb_blkno,\n\t\t\t    struct buffer_head **bh);\n\nstruct ocfs2_alloc_context;\nint ocfs2_insert_extent(handle_t *handle,\n\t\t\tstruct ocfs2_extent_tree *et,\n\t\t\tu32 cpos,\n\t\t\tu64 start_blk,\n\t\t\tu32 new_clusters,\n\t\t\tu8 flags,\n\t\t\tstruct ocfs2_alloc_context *meta_ac);\n\nenum ocfs2_alloc_restarted {\n\tRESTART_NONE = 0,\n\tRESTART_TRANS,\n\tRESTART_META\n};\nint ocfs2_add_clusters_in_btree(handle_t *handle,\n\t\t\t\tstruct ocfs2_extent_tree *et,\n\t\t\t\tu32 *logical_offset,\n\t\t\t\tu32 clusters_to_add,\n\t\t\t\tint mark_unwritten,\n\t\t\t\tstruct ocfs2_alloc_context *data_ac,\n\t\t\t\tstruct ocfs2_alloc_context *meta_ac,\n\t\t\t\tenum ocfs2_alloc_restarted *reason_ret);\nstruct ocfs2_cached_dealloc_ctxt;\nstruct ocfs2_path;\nint ocfs2_split_extent(handle_t *handle,\n\t\t       struct ocfs2_extent_tree *et,\n\t\t       struct ocfs2_path *path,\n\t\t       int split_index,\n\t\t       struct ocfs2_extent_rec *split_rec,\n\t\t       struct ocfs2_alloc_context *meta_ac,\n\t\t       struct ocfs2_cached_dealloc_ctxt *dealloc);\nint ocfs2_mark_extent_written(struct inode *inode,\n\t\t\t      struct ocfs2_extent_tree *et,\n\t\t\t      handle_t *handle, u32 cpos, u32 len, u32 phys,\n\t\t\t      struct ocfs2_alloc_context *meta_ac,\n\t\t\t      struct ocfs2_cached_dealloc_ctxt *dealloc);\nint ocfs2_change_extent_flag(handle_t *handle,\n\t\t\t     struct ocfs2_extent_tree *et,\n\t\t\t     u32 cpos, u32 len, u32 phys,\n\t\t\t     struct ocfs2_alloc_context *meta_ac,\n\t\t\t     struct ocfs2_cached_dealloc_ctxt *dealloc,\n\t\t\t     int new_flags, int clear_flags);\nint ocfs2_remove_extent(handle_t *handle, struct ocfs2_extent_tree *et,\n\t\t\tu32 cpos, u32 len,\n\t\t\tstruct ocfs2_alloc_context *meta_ac,\n\t\t\tstruct ocfs2_cached_dealloc_ctxt *dealloc);\nint ocfs2_remove_btree_range(struct inode *inode,\n\t\t\t     struct ocfs2_extent_tree *et,\n\t\t\t     u32 cpos, u32 phys_cpos, u32 len, int flags,\n\t\t\t     struct ocfs2_cached_dealloc_ctxt *dealloc,\n\t\t\t     u64 refcount_loc, bool refcount_tree_locked);\n\nint ocfs2_num_free_extents(struct ocfs2_extent_tree *et);\n\n \nstatic inline int ocfs2_extend_meta_needed(struct ocfs2_extent_list *root_el)\n{\n\t \n\treturn le16_to_cpu(root_el->l_tree_depth) + 2;\n}\n\nvoid ocfs2_dinode_new_extent_list(struct inode *inode, struct ocfs2_dinode *di);\nvoid ocfs2_set_inode_data_inline(struct inode *inode, struct ocfs2_dinode *di);\nint ocfs2_convert_inline_data_to_extents(struct inode *inode,\n\t\t\t\t\t struct buffer_head *di_bh);\n\nint ocfs2_truncate_log_init(struct ocfs2_super *osb);\nvoid ocfs2_truncate_log_shutdown(struct ocfs2_super *osb);\nvoid ocfs2_schedule_truncate_log_flush(struct ocfs2_super *osb,\n\t\t\t\t       int cancel);\nint ocfs2_flush_truncate_log(struct ocfs2_super *osb);\nint ocfs2_begin_truncate_log_recovery(struct ocfs2_super *osb,\n\t\t\t\t      int slot_num,\n\t\t\t\t      struct ocfs2_dinode **tl_copy);\nint ocfs2_complete_truncate_log_recovery(struct ocfs2_super *osb,\n\t\t\t\t\t struct ocfs2_dinode *tl_copy);\nint ocfs2_truncate_log_needs_flush(struct ocfs2_super *osb);\nint ocfs2_truncate_log_append(struct ocfs2_super *osb,\n\t\t\t      handle_t *handle,\n\t\t\t      u64 start_blk,\n\t\t\t      unsigned int num_clusters);\nint __ocfs2_flush_truncate_log(struct ocfs2_super *osb);\nint ocfs2_try_to_free_truncate_log(struct ocfs2_super *osb,\n\t\t\t\t   unsigned int needed);\n\n \nstruct ocfs2_cached_dealloc_ctxt {\n\tstruct ocfs2_per_slot_free_list\t\t*c_first_suballocator;\n\tstruct ocfs2_cached_block_free \t\t*c_global_allocator;\n};\nstatic inline void ocfs2_init_dealloc_ctxt(struct ocfs2_cached_dealloc_ctxt *c)\n{\n\tc->c_first_suballocator = NULL;\n\tc->c_global_allocator = NULL;\n}\nint ocfs2_cache_cluster_dealloc(struct ocfs2_cached_dealloc_ctxt *ctxt,\n\t\t\t\tu64 blkno, unsigned int bit);\nint ocfs2_cache_block_dealloc(struct ocfs2_cached_dealloc_ctxt *ctxt,\n\t\t\t      int type, int slot, u64 suballoc, u64 blkno,\n\t\t\t      unsigned int bit);\nstatic inline int ocfs2_dealloc_has_cluster(struct ocfs2_cached_dealloc_ctxt *c)\n{\n\treturn c->c_global_allocator != NULL;\n}\nint ocfs2_run_deallocs(struct ocfs2_super *osb,\n\t\t       struct ocfs2_cached_dealloc_ctxt *ctxt);\n\nstruct ocfs2_truncate_context {\n\tstruct ocfs2_cached_dealloc_ctxt tc_dealloc;\n\tint tc_ext_alloc_locked;  \n\t \n\tstruct buffer_head *tc_last_eb_bh;\n};\n\nint ocfs2_zero_range_for_truncate(struct inode *inode, handle_t *handle,\n\t\t\t\t  u64 range_start, u64 range_end);\nint ocfs2_commit_truncate(struct ocfs2_super *osb,\n\t\t\t  struct inode *inode,\n\t\t\t  struct buffer_head *di_bh);\nint ocfs2_truncate_inline(struct inode *inode, struct buffer_head *di_bh,\n\t\t\t  unsigned int start, unsigned int end, int trunc);\n\nint ocfs2_find_leaf(struct ocfs2_caching_info *ci,\n\t\t    struct ocfs2_extent_list *root_el, u32 cpos,\n\t\t    struct buffer_head **leaf_bh);\nint ocfs2_search_extent_list(struct ocfs2_extent_list *el, u32 v_cluster);\n\nint ocfs2_trim_fs(struct super_block *sb, struct fstrim_range *range);\n \nstatic inline unsigned int ocfs2_rec_clusters(struct ocfs2_extent_list *el,\n\t\t\t\t\t      struct ocfs2_extent_rec *rec)\n{\n\t \n\tif (el->l_tree_depth)\n\t\treturn le32_to_cpu(rec->e_int_clusters);\n\telse\n\t\treturn le16_to_cpu(rec->e_leaf_clusters);\n}\n\n \nstatic inline int ocfs2_is_empty_extent(struct ocfs2_extent_rec *rec)\n{\n\treturn !rec->e_leaf_clusters;\n}\n\nint ocfs2_grab_pages(struct inode *inode, loff_t start, loff_t end,\n\t\t     struct page **pages, int *num);\nvoid ocfs2_map_and_dirty_page(struct inode *inode, handle_t *handle,\n\t\t\t      unsigned int from, unsigned int to,\n\t\t\t      struct page *page, int zero, u64 *phys);\n \nstruct ocfs2_path_item {\n\tstruct buffer_head\t\t*bh;\n\tstruct ocfs2_extent_list\t*el;\n};\n\n#define OCFS2_MAX_PATH_DEPTH\t5\n\nstruct ocfs2_path {\n\tint\t\t\t\tp_tree_depth;\n\tocfs2_journal_access_func\tp_root_access;\n\tstruct ocfs2_path_item\t\tp_node[OCFS2_MAX_PATH_DEPTH];\n};\n\n#define path_root_bh(_path) ((_path)->p_node[0].bh)\n#define path_root_el(_path) ((_path)->p_node[0].el)\n#define path_root_access(_path)((_path)->p_root_access)\n#define path_leaf_bh(_path) ((_path)->p_node[(_path)->p_tree_depth].bh)\n#define path_leaf_el(_path) ((_path)->p_node[(_path)->p_tree_depth].el)\n#define path_num_items(_path) ((_path)->p_tree_depth + 1)\n\nvoid ocfs2_reinit_path(struct ocfs2_path *path, int keep_root);\nvoid ocfs2_free_path(struct ocfs2_path *path);\nint ocfs2_find_path(struct ocfs2_caching_info *ci,\n\t\t    struct ocfs2_path *path,\n\t\t    u32 cpos);\nstruct ocfs2_path *ocfs2_new_path_from_path(struct ocfs2_path *path);\nstruct ocfs2_path *ocfs2_new_path_from_et(struct ocfs2_extent_tree *et);\nint ocfs2_path_bh_journal_access(handle_t *handle,\n\t\t\t\t struct ocfs2_caching_info *ci,\n\t\t\t\t struct ocfs2_path *path,\n\t\t\t\t int idx);\nint ocfs2_journal_access_path(struct ocfs2_caching_info *ci,\n\t\t\t      handle_t *handle,\n\t\t\t      struct ocfs2_path *path);\nint ocfs2_find_cpos_for_right_leaf(struct super_block *sb,\n\t\t\t\t   struct ocfs2_path *path, u32 *cpos);\nint ocfs2_find_cpos_for_left_leaf(struct super_block *sb,\n\t\t\t\t  struct ocfs2_path *path, u32 *cpos);\nint ocfs2_find_subtree_root(struct ocfs2_extent_tree *et,\n\t\t\t    struct ocfs2_path *left,\n\t\t\t    struct ocfs2_path *right);\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}