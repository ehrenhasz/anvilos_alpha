{
  "module_name": "heartbeat.c",
  "hash_id": "b486b64d85751a02d5ba15e6e8a39792300e1ab5ddab7733fd70398948fb96ab",
  "original_prompt": "Ingested from linux-6.6.14/fs/ocfs2/heartbeat.c",
  "human_readable_source": "\n \n\n#include <linux/bitmap.h>\n#include <linux/fs.h>\n#include <linux/types.h>\n#include <linux/highmem.h>\n\n#include <cluster/masklog.h>\n\n#include \"ocfs2.h\"\n\n#include \"alloc.h\"\n#include \"heartbeat.h\"\n#include \"inode.h\"\n#include \"journal.h\"\n#include \"ocfs2_trace.h\"\n\n#include \"buffer_head_io.h\"\n\n \nstatic void ocfs2_node_map_init(struct ocfs2_node_map *map)\n{\n\tmap->num_nodes = OCFS2_NODE_MAP_MAX_NODES;\n\tbitmap_zero(map->map, OCFS2_NODE_MAP_MAX_NODES);\n}\n\nvoid ocfs2_init_node_maps(struct ocfs2_super *osb)\n{\n\tspin_lock_init(&osb->node_map_lock);\n\tocfs2_node_map_init(&osb->osb_recovering_orphan_dirs);\n}\n\nvoid ocfs2_do_node_down(int node_num, void *data)\n{\n\tstruct ocfs2_super *osb = data;\n\n\tBUG_ON(osb->node_num == node_num);\n\n\ttrace_ocfs2_do_node_down(node_num);\n\n\tif (!osb->cconn) {\n\t\t \n\t\treturn;\n\t}\n\n\tocfs2_recovery_thread(osb, node_num);\n}\n\nvoid ocfs2_node_map_set_bit(struct ocfs2_super *osb,\n\t\t\t    struct ocfs2_node_map *map,\n\t\t\t    int bit)\n{\n\tif (bit==-1)\n\t\treturn;\n\tBUG_ON(bit >= map->num_nodes);\n\tspin_lock(&osb->node_map_lock);\n\tset_bit(bit, map->map);\n\tspin_unlock(&osb->node_map_lock);\n}\n\nvoid ocfs2_node_map_clear_bit(struct ocfs2_super *osb,\n\t\t\t      struct ocfs2_node_map *map,\n\t\t\t      int bit)\n{\n\tif (bit==-1)\n\t\treturn;\n\tBUG_ON(bit >= map->num_nodes);\n\tspin_lock(&osb->node_map_lock);\n\tclear_bit(bit, map->map);\n\tspin_unlock(&osb->node_map_lock);\n}\n\nint ocfs2_node_map_test_bit(struct ocfs2_super *osb,\n\t\t\t    struct ocfs2_node_map *map,\n\t\t\t    int bit)\n{\n\tint ret;\n\tif (bit >= map->num_nodes) {\n\t\tmlog(ML_ERROR, \"bit=%d map->num_nodes=%d\\n\", bit, map->num_nodes);\n\t\tBUG();\n\t}\n\tspin_lock(&osb->node_map_lock);\n\tret = test_bit(bit, map->map);\n\tspin_unlock(&osb->node_map_lock);\n\treturn ret;\n}\n\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}