{
  "module_name": "suballoc.h",
  "hash_id": "4b5f13b4db375677786d902b7021c0b955043669bd250ec7043cd05556cb355e",
  "original_prompt": "Ingested from linux-6.6.14/fs/ocfs2/suballoc.h",
  "human_readable_source": " \n \n\n#ifndef _CHAINALLOC_H_\n#define _CHAINALLOC_H_\n\nstruct ocfs2_suballoc_result;\ntypedef int (group_search_t)(struct inode *,\n\t\t\t     struct buffer_head *,\n\t\t\t     u32,\t\t\t \n\t\t\t     u32,\t\t\t \n\t\t\t     u64,\t\t\t \n\t\t\t     struct ocfs2_suballoc_result *);\n\t\t\t\t\t\t\t \n\nstruct ocfs2_alloc_context {\n\tstruct inode *ac_inode;     \n\tstruct buffer_head *ac_bh;  \n\tu32    ac_alloc_slot;    \n\tu32    ac_bits_wanted;\n\tu32    ac_bits_given;\n#define OCFS2_AC_USE_LOCAL 1\n#define OCFS2_AC_USE_MAIN  2\n#define OCFS2_AC_USE_INODE 3\n#define OCFS2_AC_USE_META  4\n\tu32    ac_which;\n\n\t \n\tu16    ac_chain;\n\tint    ac_disable_chain_relink;\n\tgroup_search_t *ac_group_search;\n\n\tu64    ac_last_group;\n\tu64    ac_max_block;   \n\n\tint    ac_find_loc_only;   \n\tstruct ocfs2_suballoc_result *ac_find_loc_priv;  \n\n\tstruct ocfs2_alloc_reservation\t*ac_resv;\n};\n\nvoid ocfs2_init_steal_slots(struct ocfs2_super *osb);\nvoid ocfs2_free_alloc_context(struct ocfs2_alloc_context *ac);\nstatic inline int ocfs2_alloc_context_bits_left(struct ocfs2_alloc_context *ac)\n{\n\treturn ac->ac_bits_wanted - ac->ac_bits_given;\n}\n\n \nint ocfs2_reserve_new_metadata(struct ocfs2_super *osb,\n\t\t\t       struct ocfs2_extent_list *root_el,\n\t\t\t       struct ocfs2_alloc_context **ac);\nint ocfs2_reserve_new_metadata_blocks(struct ocfs2_super *osb,\n\t\t\t\t      int blocks,\n\t\t\t\t      struct ocfs2_alloc_context **ac);\nint ocfs2_reserve_new_inode(struct ocfs2_super *osb,\n\t\t\t    struct ocfs2_alloc_context **ac);\nint ocfs2_reserve_clusters(struct ocfs2_super *osb,\n\t\t\t   u32 bits_wanted,\n\t\t\t   struct ocfs2_alloc_context **ac);\n\nint ocfs2_alloc_dinode_update_counts(struct inode *inode,\n\t\t\t handle_t *handle,\n\t\t\t struct buffer_head *di_bh,\n\t\t\t u32 num_bits,\n\t\t\t u16 chain);\nvoid ocfs2_rollback_alloc_dinode_counts(struct inode *inode,\n\t\t\t struct buffer_head *di_bh,\n\t\t\t u32 num_bits,\n\t\t\t u16 chain);\nint ocfs2_block_group_set_bits(handle_t *handle,\n\t\t\t struct inode *alloc_inode,\n\t\t\t struct ocfs2_group_desc *bg,\n\t\t\t struct buffer_head *group_bh,\n\t\t\t unsigned int bit_off,\n\t\t\t unsigned int num_bits);\n\nint ocfs2_claim_metadata(handle_t *handle,\n\t\t\t struct ocfs2_alloc_context *ac,\n\t\t\t u32 bits_wanted,\n\t\t\t u64 *suballoc_loc,\n\t\t\t u16 *suballoc_bit_start,\n\t\t\t u32 *num_bits,\n\t\t\t u64 *blkno_start);\nint ocfs2_claim_new_inode(handle_t *handle,\n\t\t\t  struct inode *dir,\n\t\t\t  struct buffer_head *parent_fe_bh,\n\t\t\t  struct ocfs2_alloc_context *ac,\n\t\t\t  u64 *suballoc_loc,\n\t\t\t  u16 *suballoc_bit,\n\t\t\t  u64 *fe_blkno);\nint ocfs2_claim_clusters(handle_t *handle,\n\t\t\t struct ocfs2_alloc_context *ac,\n\t\t\t u32 min_clusters,\n\t\t\t u32 *cluster_start,\n\t\t\t u32 *num_clusters);\n \nint __ocfs2_claim_clusters(handle_t *handle,\n\t\t\t   struct ocfs2_alloc_context *ac,\n\t\t\t   u32 min_clusters,\n\t\t\t   u32 max_clusters,\n\t\t\t   u32 *cluster_start,\n\t\t\t   u32 *num_clusters);\n\nint ocfs2_free_suballoc_bits(handle_t *handle,\n\t\t\t     struct inode *alloc_inode,\n\t\t\t     struct buffer_head *alloc_bh,\n\t\t\t     unsigned int start_bit,\n\t\t\t     u64 bg_blkno,\n\t\t\t     unsigned int count);\nint ocfs2_free_dinode(handle_t *handle,\n\t\t      struct inode *inode_alloc_inode,\n\t\t      struct buffer_head *inode_alloc_bh,\n\t\t      struct ocfs2_dinode *di);\nint ocfs2_free_clusters(handle_t *handle,\n\t\t\tstruct inode *bitmap_inode,\n\t\t\tstruct buffer_head *bitmap_bh,\n\t\t\tu64 start_blk,\n\t\t\tunsigned int num_clusters);\nint ocfs2_release_clusters(handle_t *handle,\n\t\t\t   struct inode *bitmap_inode,\n\t\t\t   struct buffer_head *bitmap_bh,\n\t\t\t   u64 start_blk,\n\t\t\t   unsigned int num_clusters);\n\nstatic inline u64 ocfs2_which_suballoc_group(u64 block, unsigned int bit)\n{\n\tu64 group = block - (u64) bit;\n\n\treturn group;\n}\n\nstatic inline u32 ocfs2_cluster_from_desc(struct ocfs2_super *osb,\n\t\t\t\t\t  u64 bg_blkno)\n{\n\t \n\n\tif (bg_blkno == osb->first_cluster_group_blkno)\n\t\treturn 0;\n\n\t \n\treturn ocfs2_blocks_to_clusters(osb->sb, bg_blkno);\n}\n\nstatic inline int ocfs2_is_cluster_bitmap(struct inode *inode)\n{\n\tstruct ocfs2_super *osb = OCFS2_SB(inode->i_sb);\n\treturn osb->bitmap_blkno == OCFS2_I(inode)->ip_blkno;\n}\n\n \nint ocfs2_reserve_cluster_bitmap_bits(struct ocfs2_super *osb,\n\t\t\t\t      struct ocfs2_alloc_context *ac);\nvoid ocfs2_free_ac_resource(struct ocfs2_alloc_context *ac);\n\n \nu64 ocfs2_which_cluster_group(struct inode *inode, u32 cluster);\n\n \nint ocfs2_check_group_descriptor(struct super_block *sb,\n\t\t\t\t struct ocfs2_dinode *di,\n\t\t\t\t struct buffer_head *bh);\n \nint ocfs2_read_group_descriptor(struct inode *inode, struct ocfs2_dinode *di,\n\t\t\t\tu64 gd_blkno, struct buffer_head **bh);\n\nint ocfs2_lock_allocators(struct inode *inode, struct ocfs2_extent_tree *et,\n\t\t\t  u32 clusters_to_add, u32 extents_to_split,\n\t\t\t  struct ocfs2_alloc_context **data_ac,\n\t\t\t  struct ocfs2_alloc_context **meta_ac);\n\nint ocfs2_test_inode_bit(struct ocfs2_super *osb, u64 blkno, int *res);\n\n\n\n \nint ocfs2_find_new_inode_loc(struct inode *dir,\n\t\t\t     struct buffer_head *parent_fe_bh,\n\t\t\t     struct ocfs2_alloc_context *ac,\n\t\t\t     u64 *fe_blkno);\n\nint ocfs2_claim_new_inode_at_loc(handle_t *handle,\n\t\t\t\t struct inode *dir,\n\t\t\t\t struct ocfs2_alloc_context *ac,\n\t\t\t\t u64 *suballoc_loc,\n\t\t\t\t u16 *suballoc_bit,\n\t\t\t\t u64 di_blkno);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}