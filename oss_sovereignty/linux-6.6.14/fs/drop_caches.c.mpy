{
  "module_name": "drop_caches.c",
  "hash_id": "6c20d29cccfca5d727b20a5e874c55c1d5b9dc003adfea2b16676b58f811ddbc",
  "original_prompt": "Ingested from linux-6.6.14/fs/drop_caches.c",
  "human_readable_source": "\n \n\n#include <linux/pagemap.h>\n#include <linux/kernel.h>\n#include <linux/mm.h>\n#include <linux/fs.h>\n#include <linux/writeback.h>\n#include <linux/sysctl.h>\n#include <linux/gfp.h>\n#include <linux/swap.h>\n#include \"internal.h\"\n\n \nint sysctl_drop_caches;\n\nstatic void drop_pagecache_sb(struct super_block *sb, void *unused)\n{\n\tstruct inode *inode, *toput_inode = NULL;\n\n\tspin_lock(&sb->s_inode_list_lock);\n\tlist_for_each_entry(inode, &sb->s_inodes, i_sb_list) {\n\t\tspin_lock(&inode->i_lock);\n\t\t \n\t\tif ((inode->i_state & (I_FREEING|I_WILL_FREE|I_NEW)) ||\n\t\t    (mapping_empty(inode->i_mapping) && !need_resched())) {\n\t\t\tspin_unlock(&inode->i_lock);\n\t\t\tcontinue;\n\t\t}\n\t\t__iget(inode);\n\t\tspin_unlock(&inode->i_lock);\n\t\tspin_unlock(&sb->s_inode_list_lock);\n\n\t\tinvalidate_mapping_pages(inode->i_mapping, 0, -1);\n\t\tiput(toput_inode);\n\t\ttoput_inode = inode;\n\n\t\tcond_resched();\n\t\tspin_lock(&sb->s_inode_list_lock);\n\t}\n\tspin_unlock(&sb->s_inode_list_lock);\n\tiput(toput_inode);\n}\n\nint drop_caches_sysctl_handler(struct ctl_table *table, int write,\n\t\tvoid *buffer, size_t *length, loff_t *ppos)\n{\n\tint ret;\n\n\tret = proc_dointvec_minmax(table, write, buffer, length, ppos);\n\tif (ret)\n\t\treturn ret;\n\tif (write) {\n\t\tstatic int stfu;\n\n\t\tif (sysctl_drop_caches & 1) {\n\t\t\tlru_add_drain_all();\n\t\t\titerate_supers(drop_pagecache_sb, NULL);\n\t\t\tcount_vm_event(DROP_PAGECACHE);\n\t\t}\n\t\tif (sysctl_drop_caches & 2) {\n\t\t\tdrop_slab();\n\t\t\tcount_vm_event(DROP_SLAB);\n\t\t}\n\t\tif (!stfu) {\n\t\t\tpr_info(\"%s (%d): drop_caches: %d\\n\",\n\t\t\t\tcurrent->comm, task_pid_nr(current),\n\t\t\t\tsysctl_drop_caches);\n\t\t}\n\t\tstfu |= sysctl_drop_caches & 4;\n\t}\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}