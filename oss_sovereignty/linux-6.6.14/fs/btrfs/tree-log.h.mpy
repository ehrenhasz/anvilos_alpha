{
  "module_name": "tree-log.h",
  "hash_id": "7b8e0f930b1dbaec5454ab79423277ee48b2e08d2d902376032fdfd2171a65da",
  "original_prompt": "Ingested from linux-6.6.14/fs/btrfs/tree-log.h",
  "human_readable_source": " \n \n\n#ifndef BTRFS_TREE_LOG_H\n#define BTRFS_TREE_LOG_H\n\n#include \"messages.h\"\n#include \"ctree.h\"\n#include \"transaction.h\"\n\n \n#define BTRFS_NO_LOG_SYNC 256\n\n \n#define BTRFS_LOG_FORCE_COMMIT\t\t\t\t(-(MAX_ERRNO + 1))\n\nstruct btrfs_log_ctx {\n\tint log_ret;\n\tint log_transid;\n\tbool log_new_dentries;\n\tbool logging_new_name;\n\tbool logging_new_delayed_dentries;\n\t \n\tbool logged_before;\n\tstruct inode *inode;\n\tstruct list_head list;\n\t \n\tstruct list_head ordered_extents;\n\tstruct list_head conflict_inodes;\n\tint num_conflict_inodes;\n\tbool logging_conflict_inodes;\n};\n\nstatic inline void btrfs_init_log_ctx(struct btrfs_log_ctx *ctx,\n\t\t\t\t      struct inode *inode)\n{\n\tctx->log_ret = 0;\n\tctx->log_transid = 0;\n\tctx->log_new_dentries = false;\n\tctx->logging_new_name = false;\n\tctx->logging_new_delayed_dentries = false;\n\tctx->logged_before = false;\n\tctx->inode = inode;\n\tINIT_LIST_HEAD(&ctx->list);\n\tINIT_LIST_HEAD(&ctx->ordered_extents);\n\tINIT_LIST_HEAD(&ctx->conflict_inodes);\n\tctx->num_conflict_inodes = 0;\n\tctx->logging_conflict_inodes = false;\n}\n\nstatic inline void btrfs_release_log_ctx_extents(struct btrfs_log_ctx *ctx)\n{\n\tstruct btrfs_ordered_extent *ordered;\n\tstruct btrfs_ordered_extent *tmp;\n\n\tASSERT(inode_is_locked(ctx->inode));\n\n\tlist_for_each_entry_safe(ordered, tmp, &ctx->ordered_extents, log_list) {\n\t\tlist_del_init(&ordered->log_list);\n\t\tbtrfs_put_ordered_extent(ordered);\n\t}\n}\n\nstatic inline void btrfs_set_log_full_commit(struct btrfs_trans_handle *trans)\n{\n\tWRITE_ONCE(trans->fs_info->last_trans_log_full_commit, trans->transid);\n}\n\nstatic inline int btrfs_need_log_full_commit(struct btrfs_trans_handle *trans)\n{\n\treturn READ_ONCE(trans->fs_info->last_trans_log_full_commit) ==\n\t\ttrans->transid;\n}\n\nint btrfs_sync_log(struct btrfs_trans_handle *trans,\n\t\t   struct btrfs_root *root, struct btrfs_log_ctx *ctx);\nint btrfs_free_log(struct btrfs_trans_handle *trans, struct btrfs_root *root);\nint btrfs_free_log_root_tree(struct btrfs_trans_handle *trans,\n\t\t\t     struct btrfs_fs_info *fs_info);\nint btrfs_recover_log_trees(struct btrfs_root *tree_root);\nint btrfs_log_dentry_safe(struct btrfs_trans_handle *trans,\n\t\t\t  struct dentry *dentry,\n\t\t\t  struct btrfs_log_ctx *ctx);\nvoid btrfs_del_dir_entries_in_log(struct btrfs_trans_handle *trans,\n\t\t\t\t  struct btrfs_root *root,\n\t\t\t\t  const struct fscrypt_str *name,\n\t\t\t\t  struct btrfs_inode *dir, u64 index);\nvoid btrfs_del_inode_ref_in_log(struct btrfs_trans_handle *trans,\n\t\t\t\tstruct btrfs_root *root,\n\t\t\t\tconst struct fscrypt_str *name,\n\t\t\t\tstruct btrfs_inode *inode, u64 dirid);\nvoid btrfs_end_log_trans(struct btrfs_root *root);\nvoid btrfs_pin_log_trans(struct btrfs_root *root);\nvoid btrfs_record_unlink_dir(struct btrfs_trans_handle *trans,\n\t\t\t     struct btrfs_inode *dir, struct btrfs_inode *inode,\n\t\t\t     bool for_rename);\nvoid btrfs_record_snapshot_destroy(struct btrfs_trans_handle *trans,\n\t\t\t\t   struct btrfs_inode *dir);\nvoid btrfs_log_new_name(struct btrfs_trans_handle *trans,\n\t\t\tstruct dentry *old_dentry, struct btrfs_inode *old_dir,\n\t\t\tu64 old_dir_index, struct dentry *parent);\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}