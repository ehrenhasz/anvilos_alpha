{
  "module_name": "block-group.h",
  "hash_id": "0f49e05021d97394d55e8d5882e101bb6321ac7c72b963d845eb5e62dc509305",
  "original_prompt": "Ingested from linux-6.6.14/fs/btrfs/block-group.h",
  "human_readable_source": " \n\n#ifndef BTRFS_BLOCK_GROUP_H\n#define BTRFS_BLOCK_GROUP_H\n\n#include \"free-space-cache.h\"\n\nenum btrfs_disk_cache_state {\n\tBTRFS_DC_WRITTEN,\n\tBTRFS_DC_ERROR,\n\tBTRFS_DC_CLEAR,\n\tBTRFS_DC_SETUP,\n};\n\nenum btrfs_block_group_size_class {\n\t \n\tBTRFS_BG_SZ_NONE,\n\t \n\tBTRFS_BG_SZ_SMALL,\n\t \n\tBTRFS_BG_SZ_MEDIUM,\n\t \n\tBTRFS_BG_SZ_LARGE,\n};\n\n \nenum btrfs_discard_state {\n\tBTRFS_DISCARD_EXTENTS,\n\tBTRFS_DISCARD_BITMAPS,\n\tBTRFS_DISCARD_RESET_CURSOR,\n};\n\n \nenum btrfs_chunk_alloc_enum {\n\tCHUNK_ALLOC_NO_FORCE,\n\tCHUNK_ALLOC_LIMITED,\n\tCHUNK_ALLOC_FORCE,\n\tCHUNK_ALLOC_FORCE_FOR_EXTENT,\n};\n\n \nenum btrfs_block_group_flags {\n\tBLOCK_GROUP_FLAG_IREF,\n\tBLOCK_GROUP_FLAG_REMOVED,\n\tBLOCK_GROUP_FLAG_TO_COPY,\n\tBLOCK_GROUP_FLAG_RELOCATING_REPAIR,\n\tBLOCK_GROUP_FLAG_CHUNK_ITEM_INSERTED,\n\tBLOCK_GROUP_FLAG_ZONE_IS_ACTIVE,\n\tBLOCK_GROUP_FLAG_ZONED_DATA_RELOC,\n\t \n\tBLOCK_GROUP_FLAG_NEEDS_FREE_SPACE,\n\t \n\tBLOCK_GROUP_FLAG_SEQUENTIAL_ZONE,\n\t \n\tBLOCK_GROUP_FLAG_NEW,\n};\n\nenum btrfs_caching_type {\n\tBTRFS_CACHE_NO,\n\tBTRFS_CACHE_STARTED,\n\tBTRFS_CACHE_FINISHED,\n\tBTRFS_CACHE_ERROR,\n};\n\nstruct btrfs_caching_control {\n\tstruct list_head list;\n\tstruct mutex mutex;\n\twait_queue_head_t wait;\n\tstruct btrfs_work work;\n\tstruct btrfs_block_group *block_group;\n\t \n\tatomic_t progress;\n\trefcount_t count;\n};\n\n \n#define CACHING_CTL_WAKE_UP SZ_2M\n\nstruct btrfs_block_group {\n\tstruct btrfs_fs_info *fs_info;\n\tstruct inode *inode;\n\tspinlock_t lock;\n\tu64 start;\n\tu64 length;\n\tu64 pinned;\n\tu64 reserved;\n\tu64 used;\n\tu64 delalloc_bytes;\n\tu64 bytes_super;\n\tu64 flags;\n\tu64 cache_generation;\n\tu64 global_root_id;\n\n\t \n\tu64 commit_used;\n\t \n\tu32 bitmap_high_thresh;\n\n\t \n\tu32 bitmap_low_thresh;\n\n\t \n\tstruct rw_semaphore data_rwsem;\n\n\t \n\tunsigned long full_stripe_len;\n\tunsigned long runtime_flags;\n\n\tunsigned int ro;\n\n\tint disk_cache_state;\n\n\t \n\tint cached;\n\tstruct btrfs_caching_control *caching_ctl;\n\n\tstruct btrfs_space_info *space_info;\n\n\t \n\tstruct btrfs_free_space_ctl *free_space_ctl;\n\n\t \n\tstruct rb_node cache_node;\n\n\t \n\tstruct list_head list;\n\n\trefcount_t refs;\n\n\t \n\tstruct list_head cluster_list;\n\n\t \n\tstruct list_head bg_list;\n\n\t \n\tstruct list_head ro_list;\n\n\t \n\tatomic_t frozen;\n\n\t \n\tstruct list_head discard_list;\n\tint discard_index;\n\tu64 discard_eligible_time;\n\tu64 discard_cursor;\n\tenum btrfs_discard_state discard_state;\n\n\t \n\tstruct list_head dirty_list;\n\tstruct list_head io_list;\n\n\tstruct btrfs_io_ctl io_ctl;\n\n\t \n\tatomic_t reservations;\n\n\t \n\tatomic_t nocow_writers;\n\n\t \n\tstruct mutex free_space_lock;\n\n\t \n\tint swap_extents;\n\n\t \n\tu64 alloc_offset;\n\tu64 zone_unusable;\n\tu64 zone_capacity;\n\tu64 meta_write_pointer;\n\tstruct map_lookup *physical_map;\n\tstruct list_head active_bg_list;\n\tstruct work_struct zone_finish_work;\n\tstruct extent_buffer *last_eb;\n\tenum btrfs_block_group_size_class size_class;\n};\n\nstatic inline u64 btrfs_block_group_end(struct btrfs_block_group *block_group)\n{\n\treturn (block_group->start + block_group->length);\n}\n\nstatic inline bool btrfs_is_block_group_data_only(\n\t\t\t\t\tstruct btrfs_block_group *block_group)\n{\n\t \n\treturn (block_group->flags & BTRFS_BLOCK_GROUP_DATA) &&\n\t       !(block_group->flags & BTRFS_BLOCK_GROUP_METADATA);\n}\n\n#ifdef CONFIG_BTRFS_DEBUG\nint btrfs_should_fragment_free_space(struct btrfs_block_group *block_group);\n#endif\n\nstruct btrfs_block_group *btrfs_lookup_first_block_group(\n\t\tstruct btrfs_fs_info *info, u64 bytenr);\nstruct btrfs_block_group *btrfs_lookup_block_group(\n\t\tstruct btrfs_fs_info *info, u64 bytenr);\nstruct btrfs_block_group *btrfs_next_block_group(\n\t\tstruct btrfs_block_group *cache);\nvoid btrfs_get_block_group(struct btrfs_block_group *cache);\nvoid btrfs_put_block_group(struct btrfs_block_group *cache);\nvoid btrfs_dec_block_group_reservations(struct btrfs_fs_info *fs_info,\n\t\t\t\t\tconst u64 start);\nvoid btrfs_wait_block_group_reservations(struct btrfs_block_group *bg);\nstruct btrfs_block_group *btrfs_inc_nocow_writers(struct btrfs_fs_info *fs_info,\n\t\t\t\t\t\t  u64 bytenr);\nvoid btrfs_dec_nocow_writers(struct btrfs_block_group *bg);\nvoid btrfs_wait_nocow_writers(struct btrfs_block_group *bg);\nvoid btrfs_wait_block_group_cache_progress(struct btrfs_block_group *cache,\n\t\t\t\t           u64 num_bytes);\nint btrfs_cache_block_group(struct btrfs_block_group *cache, bool wait);\nvoid btrfs_put_caching_control(struct btrfs_caching_control *ctl);\nstruct btrfs_caching_control *btrfs_get_caching_control(\n\t\tstruct btrfs_block_group *cache);\nint btrfs_add_new_free_space(struct btrfs_block_group *block_group,\n\t\t\t     u64 start, u64 end, u64 *total_added_ret);\nstruct btrfs_trans_handle *btrfs_start_trans_remove_block_group(\n\t\t\t\tstruct btrfs_fs_info *fs_info,\n\t\t\t\tconst u64 chunk_offset);\nint btrfs_remove_block_group(struct btrfs_trans_handle *trans,\n\t\t\t     u64 group_start, struct extent_map *em);\nvoid btrfs_delete_unused_bgs(struct btrfs_fs_info *fs_info);\nvoid btrfs_mark_bg_unused(struct btrfs_block_group *bg);\nvoid btrfs_reclaim_bgs_work(struct work_struct *work);\nvoid btrfs_reclaim_bgs(struct btrfs_fs_info *fs_info);\nvoid btrfs_mark_bg_to_reclaim(struct btrfs_block_group *bg);\nint btrfs_read_block_groups(struct btrfs_fs_info *info);\nstruct btrfs_block_group *btrfs_make_block_group(struct btrfs_trans_handle *trans,\n\t\t\t\t\t\t u64 type,\n\t\t\t\t\t\t u64 chunk_offset, u64 size);\nvoid btrfs_create_pending_block_groups(struct btrfs_trans_handle *trans);\nint btrfs_inc_block_group_ro(struct btrfs_block_group *cache,\n\t\t\t     bool do_chunk_alloc);\nvoid btrfs_dec_block_group_ro(struct btrfs_block_group *cache);\nint btrfs_start_dirty_block_groups(struct btrfs_trans_handle *trans);\nint btrfs_write_dirty_block_groups(struct btrfs_trans_handle *trans);\nint btrfs_setup_space_cache(struct btrfs_trans_handle *trans);\nint btrfs_update_block_group(struct btrfs_trans_handle *trans,\n\t\t\t     u64 bytenr, u64 num_bytes, bool alloc);\nint btrfs_add_reserved_bytes(struct btrfs_block_group *cache,\n\t\t\t     u64 ram_bytes, u64 num_bytes, int delalloc,\n\t\t\t     bool force_wrong_size_class);\nvoid btrfs_free_reserved_bytes(struct btrfs_block_group *cache,\n\t\t\t       u64 num_bytes, int delalloc);\nint btrfs_chunk_alloc(struct btrfs_trans_handle *trans, u64 flags,\n\t\t      enum btrfs_chunk_alloc_enum force);\nint btrfs_force_chunk_alloc(struct btrfs_trans_handle *trans, u64 type);\nvoid check_system_chunk(struct btrfs_trans_handle *trans, const u64 type);\nvoid btrfs_reserve_chunk_metadata(struct btrfs_trans_handle *trans,\n\t\t\t\t  bool is_item_insertion);\nu64 btrfs_get_alloc_profile(struct btrfs_fs_info *fs_info, u64 orig_flags);\nvoid btrfs_put_block_group_cache(struct btrfs_fs_info *info);\nint btrfs_free_block_groups(struct btrfs_fs_info *info);\nint btrfs_rmap_block(struct btrfs_fs_info *fs_info, u64 chunk_start,\n\t\t     u64 physical, u64 **logical, int *naddrs, int *stripe_len);\n\nstatic inline u64 btrfs_data_alloc_profile(struct btrfs_fs_info *fs_info)\n{\n\treturn btrfs_get_alloc_profile(fs_info, BTRFS_BLOCK_GROUP_DATA);\n}\n\nstatic inline u64 btrfs_metadata_alloc_profile(struct btrfs_fs_info *fs_info)\n{\n\treturn btrfs_get_alloc_profile(fs_info, BTRFS_BLOCK_GROUP_METADATA);\n}\n\nstatic inline u64 btrfs_system_alloc_profile(struct btrfs_fs_info *fs_info)\n{\n\treturn btrfs_get_alloc_profile(fs_info, BTRFS_BLOCK_GROUP_SYSTEM);\n}\n\nstatic inline int btrfs_block_group_done(struct btrfs_block_group *cache)\n{\n\tsmp_mb();\n\treturn cache->cached == BTRFS_CACHE_FINISHED ||\n\t\tcache->cached == BTRFS_CACHE_ERROR;\n}\n\nvoid btrfs_freeze_block_group(struct btrfs_block_group *cache);\nvoid btrfs_unfreeze_block_group(struct btrfs_block_group *cache);\n\nbool btrfs_inc_block_group_swap_extents(struct btrfs_block_group *bg);\nvoid btrfs_dec_block_group_swap_extents(struct btrfs_block_group *bg, int amount);\n\nenum btrfs_block_group_size_class btrfs_calc_block_group_size_class(u64 size);\nint btrfs_use_block_group_size_class(struct btrfs_block_group *bg,\n\t\t\t\t     enum btrfs_block_group_size_class size_class,\n\t\t\t\t     bool force_wrong_size_class);\nbool btrfs_block_group_should_use_size_class(struct btrfs_block_group *bg);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}