{
  "module_name": "fs.c",
  "hash_id": "e72b806ba966789c8bfb2dd3d31943dc0978e5c1b43bcc6cda498197756373f2",
  "original_prompt": "Ingested from linux-6.6.14/fs/btrfs/fs.c",
  "human_readable_source": "\n\n#include \"messages.h\"\n#include \"ctree.h\"\n#include \"fs.h\"\n#include \"accessors.h\"\n\nvoid __btrfs_set_fs_incompat(struct btrfs_fs_info *fs_info, u64 flag,\n\t\t\t     const char *name)\n{\n\tstruct btrfs_super_block *disk_super;\n\tu64 features;\n\n\tdisk_super = fs_info->super_copy;\n\tfeatures = btrfs_super_incompat_flags(disk_super);\n\tif (!(features & flag)) {\n\t\tspin_lock(&fs_info->super_lock);\n\t\tfeatures = btrfs_super_incompat_flags(disk_super);\n\t\tif (!(features & flag)) {\n\t\t\tfeatures |= flag;\n\t\t\tbtrfs_set_super_incompat_flags(disk_super, features);\n\t\t\tbtrfs_info(fs_info,\n\t\t\t\t\"setting incompat feature flag for %s (0x%llx)\",\n\t\t\t\tname, flag);\n\t\t}\n\t\tspin_unlock(&fs_info->super_lock);\n\t\tset_bit(BTRFS_FS_FEATURE_CHANGED, &fs_info->flags);\n\t}\n}\n\nvoid __btrfs_clear_fs_incompat(struct btrfs_fs_info *fs_info, u64 flag,\n\t\t\t       const char *name)\n{\n\tstruct btrfs_super_block *disk_super;\n\tu64 features;\n\n\tdisk_super = fs_info->super_copy;\n\tfeatures = btrfs_super_incompat_flags(disk_super);\n\tif (features & flag) {\n\t\tspin_lock(&fs_info->super_lock);\n\t\tfeatures = btrfs_super_incompat_flags(disk_super);\n\t\tif (features & flag) {\n\t\t\tfeatures &= ~flag;\n\t\t\tbtrfs_set_super_incompat_flags(disk_super, features);\n\t\t\tbtrfs_info(fs_info,\n\t\t\t\t\"clearing incompat feature flag for %s (0x%llx)\",\n\t\t\t\tname, flag);\n\t\t}\n\t\tspin_unlock(&fs_info->super_lock);\n\t\tset_bit(BTRFS_FS_FEATURE_CHANGED, &fs_info->flags);\n\t}\n}\n\nvoid __btrfs_set_fs_compat_ro(struct btrfs_fs_info *fs_info, u64 flag,\n\t\t\t      const char *name)\n{\n\tstruct btrfs_super_block *disk_super;\n\tu64 features;\n\n\tdisk_super = fs_info->super_copy;\n\tfeatures = btrfs_super_compat_ro_flags(disk_super);\n\tif (!(features & flag)) {\n\t\tspin_lock(&fs_info->super_lock);\n\t\tfeatures = btrfs_super_compat_ro_flags(disk_super);\n\t\tif (!(features & flag)) {\n\t\t\tfeatures |= flag;\n\t\t\tbtrfs_set_super_compat_ro_flags(disk_super, features);\n\t\t\tbtrfs_info(fs_info,\n\t\t\t\t\"setting compat-ro feature flag for %s (0x%llx)\",\n\t\t\t\tname, flag);\n\t\t}\n\t\tspin_unlock(&fs_info->super_lock);\n\t\tset_bit(BTRFS_FS_FEATURE_CHANGED, &fs_info->flags);\n\t}\n}\n\nvoid __btrfs_clear_fs_compat_ro(struct btrfs_fs_info *fs_info, u64 flag,\n\t\t\t\tconst char *name)\n{\n\tstruct btrfs_super_block *disk_super;\n\tu64 features;\n\n\tdisk_super = fs_info->super_copy;\n\tfeatures = btrfs_super_compat_ro_flags(disk_super);\n\tif (features & flag) {\n\t\tspin_lock(&fs_info->super_lock);\n\t\tfeatures = btrfs_super_compat_ro_flags(disk_super);\n\t\tif (features & flag) {\n\t\t\tfeatures &= ~flag;\n\t\t\tbtrfs_set_super_compat_ro_flags(disk_super, features);\n\t\t\tbtrfs_info(fs_info,\n\t\t\t\t\"clearing compat-ro feature flag for %s (0x%llx)\",\n\t\t\t\tname, flag);\n\t\t}\n\t\tspin_unlock(&fs_info->super_lock);\n\t\tset_bit(BTRFS_FS_FEATURE_CHANGED, &fs_info->flags);\n\t}\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}