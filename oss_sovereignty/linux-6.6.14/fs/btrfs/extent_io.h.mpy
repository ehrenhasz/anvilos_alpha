{
  "module_name": "extent_io.h",
  "hash_id": "29f4d0c26fafd4a67c673f53cfb87affe76c557ba029fc2cbae802da153bf6a1",
  "original_prompt": "Ingested from linux-6.6.14/fs/btrfs/extent_io.h",
  "human_readable_source": " \n\n#ifndef BTRFS_EXTENT_IO_H\n#define BTRFS_EXTENT_IO_H\n\n#include <linux/rbtree.h>\n#include <linux/refcount.h>\n#include <linux/fiemap.h>\n#include <linux/btrfs_tree.h>\n#include \"compression.h\"\n#include \"ulist.h\"\n#include \"misc.h\"\n\nstruct btrfs_trans_handle;\n\nenum {\n\tEXTENT_BUFFER_UPTODATE,\n\tEXTENT_BUFFER_DIRTY,\n\tEXTENT_BUFFER_CORRUPT,\n\t \n\tEXTENT_BUFFER_READAHEAD,\n\tEXTENT_BUFFER_TREE_REF,\n\tEXTENT_BUFFER_STALE,\n\tEXTENT_BUFFER_WRITEBACK,\n\t \n\tEXTENT_BUFFER_READ_ERR,\n\tEXTENT_BUFFER_UNMAPPED,\n\tEXTENT_BUFFER_IN_TREE,\n\t \n\tEXTENT_BUFFER_WRITE_ERR,\n\tEXTENT_BUFFER_NO_CHECK,\n\t \n\tEXTENT_BUFFER_READING,\n};\n\n \nenum {\n\tENUM_BIT(PAGE_UNLOCK),\n\t \n\tENUM_BIT(PAGE_START_WRITEBACK),\n\tENUM_BIT(PAGE_END_WRITEBACK),\n\tENUM_BIT(PAGE_SET_ORDERED),\n};\n\n \n#define EXTENT_PAGE_PRIVATE 1\n\n \n#define BIT_BYTE(nr) ((nr) / BITS_PER_BYTE)\n#define BYTE_MASK ((1 << BITS_PER_BYTE) - 1)\n#define BITMAP_FIRST_BYTE_MASK(start) \\\n\t((BYTE_MASK << ((start) & (BITS_PER_BYTE - 1))) & BYTE_MASK)\n#define BITMAP_LAST_BYTE_MASK(nbits) \\\n\t(BYTE_MASK >> (-(nbits) & (BITS_PER_BYTE - 1)))\n\nstruct btrfs_root;\nstruct btrfs_inode;\nstruct btrfs_fs_info;\nstruct extent_io_tree;\nstruct btrfs_tree_parent_check;\n\nint __init extent_buffer_init_cachep(void);\nvoid __cold extent_buffer_free_cachep(void);\n\n#define INLINE_EXTENT_BUFFER_PAGES     (BTRFS_MAX_METADATA_BLOCKSIZE / PAGE_SIZE)\nstruct extent_buffer {\n\tu64 start;\n\tunsigned long len;\n\tunsigned long bflags;\n\tstruct btrfs_fs_info *fs_info;\n\tspinlock_t refs_lock;\n\tatomic_t refs;\n\tint read_mirror;\n\tstruct rcu_head rcu_head;\n\tpid_t lock_owner;\n\t \n\ts8 log_index;\n\n\tstruct rw_semaphore lock;\n\n\tstruct page *pages[INLINE_EXTENT_BUFFER_PAGES];\n#ifdef CONFIG_BTRFS_DEBUG\n\tstruct list_head leak_list;\n#endif\n};\n\nstruct btrfs_eb_write_context {\n\tstruct writeback_control *wbc;\n\tstruct extent_buffer *eb;\n\t \n\tstruct btrfs_block_group *zoned_bg;\n};\n\n \nstatic inline size_t get_eb_offset_in_page(const struct extent_buffer *eb,\n\t\t\t\t\t   unsigned long offset)\n{\n\t \n\treturn offset_in_page(offset + eb->start);\n}\n\nstatic inline unsigned long get_eb_page_index(unsigned long offset)\n{\n\t \n\treturn offset >> PAGE_SHIFT;\n}\n\n \nstruct extent_changeset {\n\t \n\tu64 bytes_changed;\n\n\t \n\tstruct ulist range_changed;\n};\n\nstatic inline void extent_changeset_init(struct extent_changeset *changeset)\n{\n\tchangeset->bytes_changed = 0;\n\tulist_init(&changeset->range_changed);\n}\n\nstatic inline struct extent_changeset *extent_changeset_alloc(void)\n{\n\tstruct extent_changeset *ret;\n\n\tret = kmalloc(sizeof(*ret), GFP_KERNEL);\n\tif (!ret)\n\t\treturn NULL;\n\n\textent_changeset_init(ret);\n\treturn ret;\n}\n\nstatic inline void extent_changeset_release(struct extent_changeset *changeset)\n{\n\tif (!changeset)\n\t\treturn;\n\tchangeset->bytes_changed = 0;\n\tulist_release(&changeset->range_changed);\n}\n\nstatic inline void extent_changeset_free(struct extent_changeset *changeset)\n{\n\tif (!changeset)\n\t\treturn;\n\textent_changeset_release(changeset);\n\tkfree(changeset);\n}\n\nstruct extent_map_tree;\n\nint try_release_extent_mapping(struct page *page, gfp_t mask);\nint try_release_extent_buffer(struct page *page);\n\nint btrfs_read_folio(struct file *file, struct folio *folio);\nvoid extent_write_locked_range(struct inode *inode, struct page *locked_page,\n\t\t\t       u64 start, u64 end, struct writeback_control *wbc,\n\t\t\t       bool pages_dirty);\nint extent_writepages(struct address_space *mapping,\n\t\t      struct writeback_control *wbc);\nint btree_write_cache_pages(struct address_space *mapping,\n\t\t\t    struct writeback_control *wbc);\nvoid extent_readahead(struct readahead_control *rac);\nint extent_fiemap(struct btrfs_inode *inode, struct fiemap_extent_info *fieinfo,\n\t\t  u64 start, u64 len);\nint set_page_extent_mapped(struct page *page);\nvoid clear_page_extent_mapped(struct page *page);\n\nstruct extent_buffer *alloc_extent_buffer(struct btrfs_fs_info *fs_info,\n\t\t\t\t\t  u64 start, u64 owner_root, int level);\nstruct extent_buffer *__alloc_dummy_extent_buffer(struct btrfs_fs_info *fs_info,\n\t\t\t\t\t\t  u64 start, unsigned long len);\nstruct extent_buffer *alloc_dummy_extent_buffer(struct btrfs_fs_info *fs_info,\n\t\t\t\t\t\tu64 start);\nstruct extent_buffer *btrfs_clone_extent_buffer(const struct extent_buffer *src);\nstruct extent_buffer *find_extent_buffer(struct btrfs_fs_info *fs_info,\n\t\t\t\t\t u64 start);\nvoid free_extent_buffer(struct extent_buffer *eb);\nvoid free_extent_buffer_stale(struct extent_buffer *eb);\n#define WAIT_NONE\t0\n#define WAIT_COMPLETE\t1\n#define WAIT_PAGE_LOCK\t2\nint read_extent_buffer_pages(struct extent_buffer *eb, int wait, int mirror_num,\n\t\t\t     struct btrfs_tree_parent_check *parent_check);\nvoid wait_on_extent_buffer_writeback(struct extent_buffer *eb);\nvoid btrfs_readahead_tree_block(struct btrfs_fs_info *fs_info,\n\t\t\t\tu64 bytenr, u64 owner_root, u64 gen, int level);\nvoid btrfs_readahead_node_child(struct extent_buffer *node, int slot);\n\nstatic inline int num_extent_pages(const struct extent_buffer *eb)\n{\n\t \n\treturn (eb->len >> PAGE_SHIFT) ?: 1;\n}\n\nstatic inline int extent_buffer_uptodate(const struct extent_buffer *eb)\n{\n\treturn test_bit(EXTENT_BUFFER_UPTODATE, &eb->bflags);\n}\n\nint memcmp_extent_buffer(const struct extent_buffer *eb, const void *ptrv,\n\t\t\t unsigned long start, unsigned long len);\nvoid read_extent_buffer(const struct extent_buffer *eb, void *dst,\n\t\t\tunsigned long start,\n\t\t\tunsigned long len);\nint read_extent_buffer_to_user_nofault(const struct extent_buffer *eb,\n\t\t\t\t       void __user *dst, unsigned long start,\n\t\t\t\t       unsigned long len);\nvoid write_extent_buffer(const struct extent_buffer *eb, const void *src,\n\t\t\t unsigned long start, unsigned long len);\n\nstatic inline void write_extent_buffer_chunk_tree_uuid(\n\t\tconst struct extent_buffer *eb, const void *chunk_tree_uuid)\n{\n\twrite_extent_buffer(eb, chunk_tree_uuid,\n\t\t\t    offsetof(struct btrfs_header, chunk_tree_uuid),\n\t\t\t    BTRFS_FSID_SIZE);\n}\n\nstatic inline void write_extent_buffer_fsid(const struct extent_buffer *eb,\n\t\t\t\t\t    const void *fsid)\n{\n\twrite_extent_buffer(eb, fsid, offsetof(struct btrfs_header, fsid),\n\t\t\t    BTRFS_FSID_SIZE);\n}\n\nvoid copy_extent_buffer_full(const struct extent_buffer *dst,\n\t\t\t     const struct extent_buffer *src);\nvoid copy_extent_buffer(const struct extent_buffer *dst,\n\t\t\tconst struct extent_buffer *src,\n\t\t\tunsigned long dst_offset, unsigned long src_offset,\n\t\t\tunsigned long len);\nvoid memcpy_extent_buffer(const struct extent_buffer *dst,\n\t\t\t  unsigned long dst_offset, unsigned long src_offset,\n\t\t\t  unsigned long len);\nvoid memmove_extent_buffer(const struct extent_buffer *dst,\n\t\t\t   unsigned long dst_offset, unsigned long src_offset,\n\t\t\t   unsigned long len);\nvoid memzero_extent_buffer(const struct extent_buffer *eb, unsigned long start,\n\t\t\t   unsigned long len);\nint extent_buffer_test_bit(const struct extent_buffer *eb, unsigned long start,\n\t\t\t   unsigned long pos);\nvoid extent_buffer_bitmap_set(const struct extent_buffer *eb, unsigned long start,\n\t\t\t      unsigned long pos, unsigned long len);\nvoid extent_buffer_bitmap_clear(const struct extent_buffer *eb,\n\t\t\t\tunsigned long start, unsigned long pos,\n\t\t\t\tunsigned long len);\nvoid set_extent_buffer_dirty(struct extent_buffer *eb);\nvoid set_extent_buffer_uptodate(struct extent_buffer *eb);\nvoid clear_extent_buffer_uptodate(struct extent_buffer *eb);\nvoid extent_range_clear_dirty_for_io(struct inode *inode, u64 start, u64 end);\nvoid extent_clear_unlock_delalloc(struct btrfs_inode *inode, u64 start, u64 end,\n\t\t\t\t  struct page *locked_page,\n\t\t\t\t  u32 bits_to_clear, unsigned long page_ops);\nint extent_invalidate_folio(struct extent_io_tree *tree,\n\t\t\t    struct folio *folio, size_t offset);\nvoid btrfs_clear_buffer_dirty(struct btrfs_trans_handle *trans,\n\t\t\t      struct extent_buffer *buf);\n\nint btrfs_alloc_page_array(unsigned int nr_pages, struct page **page_array);\n\n#ifdef CONFIG_BTRFS_FS_RUN_SANITY_TESTS\nbool find_lock_delalloc_range(struct inode *inode,\n\t\t\t     struct page *locked_page, u64 *start,\n\t\t\t     u64 *end);\n#endif\nstruct extent_buffer *alloc_test_extent_buffer(struct btrfs_fs_info *fs_info,\n\t\t\t\t\t       u64 start);\n\n#ifdef CONFIG_BTRFS_DEBUG\nvoid btrfs_extent_buffer_leak_debug_check(struct btrfs_fs_info *fs_info);\n#else\n#define btrfs_extent_buffer_leak_debug_check(fs_info)\tdo {} while (0)\n#endif\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}