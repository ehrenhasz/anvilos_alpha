{
  "module_name": "delayed-inode.h",
  "hash_id": "ebb25094d1e0445659657b8a010588828c7a3b5ca2fe2892bf43a877bb805711",
  "original_prompt": "Ingested from linux-6.6.14/fs/btrfs/delayed-inode.h",
  "human_readable_source": " \n \n\n#ifndef BTRFS_DELAYED_INODE_H\n#define BTRFS_DELAYED_INODE_H\n\n#include <linux/rbtree.h>\n#include <linux/spinlock.h>\n#include <linux/mutex.h>\n#include <linux/list.h>\n#include <linux/wait.h>\n#include <linux/atomic.h>\n#include <linux/refcount.h>\n#include \"ctree.h\"\n\nenum btrfs_delayed_item_type {\n\tBTRFS_DELAYED_INSERTION_ITEM,\n\tBTRFS_DELAYED_DELETION_ITEM\n};\n\nstruct btrfs_delayed_root {\n\tspinlock_t lock;\n\tstruct list_head node_list;\n\t \n\tstruct list_head prepare_list;\n\tatomic_t items;\t\t \n\tatomic_t items_seq;\t \n\tint nodes;\t\t \n\twait_queue_head_t wait;\n};\n\n#define BTRFS_DELAYED_NODE_IN_LIST\t0\n#define BTRFS_DELAYED_NODE_INODE_DIRTY\t1\n#define BTRFS_DELAYED_NODE_DEL_IREF\t2\n\nstruct btrfs_delayed_node {\n\tu64 inode_id;\n\tu64 bytes_reserved;\n\tstruct btrfs_root *root;\n\t \n\tstruct list_head n_list;\n\t \n\tstruct list_head p_list;\n\tstruct rb_root_cached ins_root;\n\tstruct rb_root_cached del_root;\n\tstruct mutex mutex;\n\tstruct btrfs_inode_item inode_item;\n\trefcount_t refs;\n\tu64 index_cnt;\n\tunsigned long flags;\n\tint count;\n\t \n\tu32 curr_index_batch_size;\n\t \n\tu32 index_item_leaves;\n};\n\nstruct btrfs_delayed_item {\n\tstruct rb_node rb_node;\n\t \n\tu64 index;\n\tstruct list_head tree_list;\t \n\tstruct list_head readdir_list;\t \n\t \n\tstruct list_head log_list;\n\tu64 bytes_reserved;\n\tstruct btrfs_delayed_node *delayed_node;\n\trefcount_t refs;\n\tenum btrfs_delayed_item_type type:8;\n\t \n\tbool logged;\n\t \n\tu16 data_len;\n\tchar data[] __counted_by(data_len);\n};\n\nstatic inline void btrfs_init_delayed_root(\n\t\t\t\tstruct btrfs_delayed_root *delayed_root)\n{\n\tatomic_set(&delayed_root->items, 0);\n\tatomic_set(&delayed_root->items_seq, 0);\n\tdelayed_root->nodes = 0;\n\tspin_lock_init(&delayed_root->lock);\n\tinit_waitqueue_head(&delayed_root->wait);\n\tINIT_LIST_HEAD(&delayed_root->node_list);\n\tINIT_LIST_HEAD(&delayed_root->prepare_list);\n}\n\nint btrfs_insert_delayed_dir_index(struct btrfs_trans_handle *trans,\n\t\t\t\t   const char *name, int name_len,\n\t\t\t\t   struct btrfs_inode *dir,\n\t\t\t\t   struct btrfs_disk_key *disk_key, u8 flags,\n\t\t\t\t   u64 index);\n\nint btrfs_delete_delayed_dir_index(struct btrfs_trans_handle *trans,\n\t\t\t\t   struct btrfs_inode *dir, u64 index);\n\nint btrfs_inode_delayed_dir_index_count(struct btrfs_inode *inode);\n\nint btrfs_run_delayed_items(struct btrfs_trans_handle *trans);\nint btrfs_run_delayed_items_nr(struct btrfs_trans_handle *trans, int nr);\n\nvoid btrfs_balance_delayed_items(struct btrfs_fs_info *fs_info);\n\nint btrfs_commit_inode_delayed_items(struct btrfs_trans_handle *trans,\n\t\t\t\t     struct btrfs_inode *inode);\n \nvoid btrfs_remove_delayed_node(struct btrfs_inode *inode);\nvoid btrfs_kill_delayed_inode_items(struct btrfs_inode *inode);\nint btrfs_commit_inode_delayed_inode(struct btrfs_inode *inode);\n\n\nint btrfs_delayed_update_inode(struct btrfs_trans_handle *trans,\n\t\t\t       struct btrfs_root *root,\n\t\t\t       struct btrfs_inode *inode);\nint btrfs_fill_inode(struct inode *inode, u32 *rdev);\nint btrfs_delayed_delete_inode_ref(struct btrfs_inode *inode);\n\n \nvoid btrfs_kill_all_delayed_nodes(struct btrfs_root *root);\n\n \nvoid btrfs_destroy_delayed_inodes(struct btrfs_fs_info *fs_info);\n\n \nbool btrfs_readdir_get_delayed_items(struct inode *inode,\n\t\t\t\t     u64 last_index,\n\t\t\t\t     struct list_head *ins_list,\n\t\t\t\t     struct list_head *del_list);\nvoid btrfs_readdir_put_delayed_items(struct inode *inode,\n\t\t\t\t     struct list_head *ins_list,\n\t\t\t\t     struct list_head *del_list);\nint btrfs_should_delete_dir_index(struct list_head *del_list,\n\t\t\t\t  u64 index);\nint btrfs_readdir_delayed_dir_index(struct dir_context *ctx,\n\t\t\t\t    struct list_head *ins_list);\n\n \nvoid btrfs_log_get_delayed_items(struct btrfs_inode *inode,\n\t\t\t\t struct list_head *ins_list,\n\t\t\t\t struct list_head *del_list);\nvoid btrfs_log_put_delayed_items(struct btrfs_inode *inode,\n\t\t\t\t struct list_head *ins_list,\n\t\t\t\t struct list_head *del_list);\n\n \nint __init btrfs_delayed_inode_init(void);\nvoid __cold btrfs_delayed_inode_exit(void);\n\n \nvoid btrfs_assert_delayed_root_empty(struct btrfs_fs_info *fs_info);\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}