{
  "module_name": "compression.h",
  "hash_id": "7a0329835228f7e1b2d09acaf1abed6ec8707fae903be7ee7032bff9213b510d",
  "original_prompt": "Ingested from linux-6.6.14/fs/btrfs/compression.h",
  "human_readable_source": " \n \n\n#ifndef BTRFS_COMPRESSION_H\n#define BTRFS_COMPRESSION_H\n\n#include <linux/sizes.h>\n#include \"bio.h\"\n\nstruct btrfs_inode;\nstruct btrfs_ordered_extent;\n\n \n\n \n#define BTRFS_MAX_COMPRESSED\t\t(SZ_128K)\n#define BTRFS_MAX_COMPRESSED_PAGES\t(BTRFS_MAX_COMPRESSED / PAGE_SIZE)\nstatic_assert((BTRFS_MAX_COMPRESSED % PAGE_SIZE) == 0);\n\n \n#define BTRFS_MAX_UNCOMPRESSED\t\t(SZ_128K)\n\n#define\tBTRFS_ZLIB_DEFAULT_LEVEL\t\t3\n\nstruct compressed_bio {\n\t \n\tunsigned int nr_pages;\n\n\t \n\tstruct page **compressed_pages;\n\n\t \n\tu64 start;\n\n\t \n\tunsigned int len;\n\n\t \n\tunsigned int compressed_len;\n\n\t \n\tu8 compress_type;\n\n\t \n\tbool writeback;\n\n\tunion {\n\t\t \n\t\tstruct btrfs_bio *orig_bbio;\n\t\tstruct work_struct write_end_work;\n\t};\n\n\t \n\tstruct btrfs_bio bbio;\n};\n\nstatic inline unsigned int btrfs_compress_type(unsigned int type_level)\n{\n\treturn (type_level & 0xF);\n}\n\nstatic inline unsigned int btrfs_compress_level(unsigned int type_level)\n{\n\treturn ((type_level & 0xF0) >> 4);\n}\n\nint __init btrfs_init_compress(void);\nvoid __cold btrfs_exit_compress(void);\n\nint btrfs_compress_pages(unsigned int type_level, struct address_space *mapping,\n\t\t\t u64 start, struct page **pages,\n\t\t\t unsigned long *out_pages,\n\t\t\t unsigned long *total_in,\n\t\t\t unsigned long *total_out);\nint btrfs_decompress(int type, const u8 *data_in, struct page *dest_page,\n\t\t     unsigned long start_byte, size_t srclen, size_t destlen);\nint btrfs_decompress_buf2page(const char *buf, u32 buf_len,\n\t\t\t      struct compressed_bio *cb, u32 decompressed);\n\nvoid btrfs_submit_compressed_write(struct btrfs_ordered_extent *ordered,\n\t\t\t\t  struct page **compressed_pages,\n\t\t\t\t  unsigned int nr_pages,\n\t\t\t\t  blk_opf_t write_flags,\n\t\t\t\t  bool writeback);\nvoid btrfs_submit_compressed_read(struct btrfs_bio *bbio);\n\nunsigned int btrfs_compress_str2level(unsigned int type, const char *str);\n\nenum btrfs_compression_type {\n\tBTRFS_COMPRESS_NONE  = 0,\n\tBTRFS_COMPRESS_ZLIB  = 1,\n\tBTRFS_COMPRESS_LZO   = 2,\n\tBTRFS_COMPRESS_ZSTD  = 3,\n\tBTRFS_NR_COMPRESS_TYPES = 4,\n};\n\nstruct workspace_manager {\n\tstruct list_head idle_ws;\n\tspinlock_t ws_lock;\n\t \n\tint free_ws;\n\t \n\tatomic_t total_ws;\n\t \n\twait_queue_head_t ws_wait;\n};\n\nstruct list_head *btrfs_get_workspace(int type, unsigned int level);\nvoid btrfs_put_workspace(int type, struct list_head *ws);\n\nstruct btrfs_compress_op {\n\tstruct workspace_manager *workspace_manager;\n\t \n\tunsigned int max_level;\n\tunsigned int default_level;\n};\n\n \n#define BTRFS_NR_WORKSPACE_MANAGERS\tBTRFS_NR_COMPRESS_TYPES\n\nextern const struct btrfs_compress_op btrfs_heuristic_compress;\nextern const struct btrfs_compress_op btrfs_zlib_compress;\nextern const struct btrfs_compress_op btrfs_lzo_compress;\nextern const struct btrfs_compress_op btrfs_zstd_compress;\n\nconst char* btrfs_compress_type2str(enum btrfs_compression_type type);\nbool btrfs_compress_is_valid_type(const char *str, size_t len);\n\nint btrfs_compress_heuristic(struct inode *inode, u64 start, u64 end);\n\nint zlib_compress_pages(struct list_head *ws, struct address_space *mapping,\n\t\tu64 start, struct page **pages, unsigned long *out_pages,\n\t\tunsigned long *total_in, unsigned long *total_out);\nint zlib_decompress_bio(struct list_head *ws, struct compressed_bio *cb);\nint zlib_decompress(struct list_head *ws, const u8 *data_in,\n\t\tstruct page *dest_page, unsigned long start_byte, size_t srclen,\n\t\tsize_t destlen);\nstruct list_head *zlib_alloc_workspace(unsigned int level);\nvoid zlib_free_workspace(struct list_head *ws);\nstruct list_head *zlib_get_workspace(unsigned int level);\n\nint lzo_compress_pages(struct list_head *ws, struct address_space *mapping,\n\t\tu64 start, struct page **pages, unsigned long *out_pages,\n\t\tunsigned long *total_in, unsigned long *total_out);\nint lzo_decompress_bio(struct list_head *ws, struct compressed_bio *cb);\nint lzo_decompress(struct list_head *ws, const u8 *data_in,\n\t\tstruct page *dest_page, unsigned long start_byte, size_t srclen,\n\t\tsize_t destlen);\nstruct list_head *lzo_alloc_workspace(unsigned int level);\nvoid lzo_free_workspace(struct list_head *ws);\n\nint zstd_compress_pages(struct list_head *ws, struct address_space *mapping,\n\t\tu64 start, struct page **pages, unsigned long *out_pages,\n\t\tunsigned long *total_in, unsigned long *total_out);\nint zstd_decompress_bio(struct list_head *ws, struct compressed_bio *cb);\nint zstd_decompress(struct list_head *ws, const u8 *data_in,\n\t\tstruct page *dest_page, unsigned long start_byte, size_t srclen,\n\t\tsize_t destlen);\nvoid zstd_init_workspace_manager(void);\nvoid zstd_cleanup_workspace_manager(void);\nstruct list_head *zstd_alloc_workspace(unsigned int level);\nvoid zstd_free_workspace(struct list_head *ws);\nstruct list_head *zstd_get_workspace(unsigned int level);\nvoid zstd_put_workspace(struct list_head *ws);\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}