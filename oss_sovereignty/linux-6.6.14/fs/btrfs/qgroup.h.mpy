{
  "module_name": "qgroup.h",
  "hash_id": "1461aff72ec2e290df64ad21f98d09ec10691625cc8e9b0b9eccca7531f04c25",
  "original_prompt": "Ingested from linux-6.6.14/fs/btrfs/qgroup.h",
  "human_readable_source": " \n \n\n#ifndef BTRFS_QGROUP_H\n#define BTRFS_QGROUP_H\n\n#include <linux/spinlock.h>\n#include <linux/rbtree.h>\n#include <linux/kobject.h>\n#include \"ulist.h\"\n#include \"delayed-ref.h\"\n#include \"misc.h\"\n\n \n\n \n\n#define BTRFS_QGROUP_RUNTIME_FLAG_CANCEL_RESCAN\t\t(1UL << 3)\n#define BTRFS_QGROUP_RUNTIME_FLAG_NO_ACCOUNTING\t\t(1UL << 4)\n\n \nstruct btrfs_qgroup_extent_record {\n\tstruct rb_node node;\n\tu64 bytenr;\n\tu64 num_bytes;\n\n\t \n\tu32 data_rsv;\t\t \n\tu64 data_rsv_refroot;\t \n\tstruct ulist *old_roots;\n};\n\nstruct btrfs_qgroup_swapped_block {\n\tstruct rb_node node;\n\n\tint level;\n\tbool trace_leaf;\n\n\t \n\tu64 subvol_bytenr;\n\tu64 subvol_generation;\n\n\t \n\tu64 reloc_bytenr;\n\tu64 reloc_generation;\n\n\tu64 last_snapshot;\n\tstruct btrfs_key first_key;\n};\n\n \nenum btrfs_qgroup_rsv_type {\n\tBTRFS_QGROUP_RSV_DATA,\n\tBTRFS_QGROUP_RSV_META_PERTRANS,\n\tBTRFS_QGROUP_RSV_META_PREALLOC,\n\tBTRFS_QGROUP_RSV_LAST,\n};\n\n \nstruct btrfs_qgroup_rsv {\n\tu64 values[BTRFS_QGROUP_RSV_LAST];\n};\n\n \nstruct btrfs_qgroup {\n\tu64 qgroupid;\n\n\t \n\tu64 rfer;\t \n\tu64 rfer_cmpr;\t \n\tu64 excl;\t \n\tu64 excl_cmpr;\t \n\n\t \n\tu64 lim_flags;\t \n\tu64 max_rfer;\n\tu64 max_excl;\n\tu64 rsv_rfer;\n\tu64 rsv_excl;\n\n\t \n\tstruct btrfs_qgroup_rsv rsv;\n\n\t \n\tstruct list_head groups;   \n\tstruct list_head members;  \n\tstruct list_head dirty;    \n\n\t \n\tstruct list_head iterator;\n\tstruct rb_node node;\t   \n\n\t \n\tu64 old_refcnt;\n\tu64 new_refcnt;\n\n\t \n\tstruct kobject kobj;\n};\n\nstatic inline u64 btrfs_qgroup_subvolid(u64 qgroupid)\n{\n\treturn (qgroupid & ((1ULL << BTRFS_QGROUP_LEVEL_SHIFT) - 1));\n}\n\n \nenum {\n\tENUM_BIT(QGROUP_RESERVE),\n\tENUM_BIT(QGROUP_RELEASE),\n\tENUM_BIT(QGROUP_FREE),\n};\n\nint btrfs_quota_enable(struct btrfs_fs_info *fs_info);\nint btrfs_quota_disable(struct btrfs_fs_info *fs_info);\nint btrfs_qgroup_rescan(struct btrfs_fs_info *fs_info);\nvoid btrfs_qgroup_rescan_resume(struct btrfs_fs_info *fs_info);\nint btrfs_qgroup_wait_for_completion(struct btrfs_fs_info *fs_info,\n\t\t\t\t     bool interruptible);\nint btrfs_add_qgroup_relation(struct btrfs_trans_handle *trans, u64 src,\n\t\t\t      u64 dst);\nint btrfs_del_qgroup_relation(struct btrfs_trans_handle *trans, u64 src,\n\t\t\t      u64 dst);\nint btrfs_create_qgroup(struct btrfs_trans_handle *trans, u64 qgroupid);\nint btrfs_remove_qgroup(struct btrfs_trans_handle *trans, u64 qgroupid);\nint btrfs_limit_qgroup(struct btrfs_trans_handle *trans, u64 qgroupid,\n\t\t       struct btrfs_qgroup_limit *limit);\nint btrfs_read_qgroup_config(struct btrfs_fs_info *fs_info);\nvoid btrfs_free_qgroup_config(struct btrfs_fs_info *fs_info);\nstruct btrfs_delayed_extent_op;\n\n \nint btrfs_qgroup_trace_extent_nolock(\n\t\tstruct btrfs_fs_info *fs_info,\n\t\tstruct btrfs_delayed_ref_root *delayed_refs,\n\t\tstruct btrfs_qgroup_extent_record *record);\n\n \nint btrfs_qgroup_trace_extent_post(struct btrfs_trans_handle *trans,\n\t\t\t\t   struct btrfs_qgroup_extent_record *qrecord);\n\n \nint btrfs_qgroup_trace_extent(struct btrfs_trans_handle *trans, u64 bytenr,\n\t\t\t      u64 num_bytes);\n\n \nint btrfs_qgroup_trace_leaf_items(struct btrfs_trans_handle *trans,\n\t\t\t\t  struct extent_buffer *eb);\n \nint btrfs_qgroup_trace_subtree(struct btrfs_trans_handle *trans,\n\t\t\t       struct extent_buffer *root_eb,\n\t\t\t       u64 root_gen, int root_level);\nint btrfs_qgroup_account_extent(struct btrfs_trans_handle *trans, u64 bytenr,\n\t\t\t\tu64 num_bytes, struct ulist *old_roots,\n\t\t\t\tstruct ulist *new_roots);\nint btrfs_qgroup_account_extents(struct btrfs_trans_handle *trans);\nint btrfs_run_qgroups(struct btrfs_trans_handle *trans);\nint btrfs_qgroup_inherit(struct btrfs_trans_handle *trans, u64 srcid,\n\t\t\t u64 objectid, struct btrfs_qgroup_inherit *inherit);\nvoid btrfs_qgroup_free_refroot(struct btrfs_fs_info *fs_info,\n\t\t\t       u64 ref_root, u64 num_bytes,\n\t\t\t       enum btrfs_qgroup_rsv_type type);\n\n#ifdef CONFIG_BTRFS_FS_RUN_SANITY_TESTS\nint btrfs_verify_qgroup_counts(struct btrfs_fs_info *fs_info, u64 qgroupid,\n\t\t\t       u64 rfer, u64 excl);\n#endif\n\n \nint btrfs_qgroup_reserve_data(struct btrfs_inode *inode,\n\t\t\tstruct extent_changeset **reserved, u64 start, u64 len);\nint btrfs_qgroup_release_data(struct btrfs_inode *inode, u64 start, u64 len, u64 *released);\nint btrfs_qgroup_free_data(struct btrfs_inode *inode,\n\t\t\t   struct extent_changeset *reserved, u64 start,\n\t\t\t   u64 len, u64 *freed);\nint btrfs_qgroup_reserve_meta(struct btrfs_root *root, int num_bytes,\n\t\t\t      enum btrfs_qgroup_rsv_type type, bool enforce);\nint __btrfs_qgroup_reserve_meta(struct btrfs_root *root, int num_bytes,\n\t\t\t\tenum btrfs_qgroup_rsv_type type, bool enforce,\n\t\t\t\tbool noflush);\n \nstatic inline int btrfs_qgroup_reserve_meta_pertrans(struct btrfs_root *root,\n\t\t\t\tint num_bytes, bool enforce)\n{\n\treturn __btrfs_qgroup_reserve_meta(root, num_bytes,\n\t\t\t\t\t   BTRFS_QGROUP_RSV_META_PERTRANS,\n\t\t\t\t\t   enforce, false);\n}\nstatic inline int btrfs_qgroup_reserve_meta_prealloc(struct btrfs_root *root,\n\t\t\t\t\t\t     int num_bytes, bool enforce,\n\t\t\t\t\t\t     bool noflush)\n{\n\treturn __btrfs_qgroup_reserve_meta(root, num_bytes,\n\t\t\t\t\t   BTRFS_QGROUP_RSV_META_PREALLOC,\n\t\t\t\t\t   enforce, noflush);\n}\n\nvoid __btrfs_qgroup_free_meta(struct btrfs_root *root, int num_bytes,\n\t\t\t     enum btrfs_qgroup_rsv_type type);\n\n \nstatic inline void btrfs_qgroup_free_meta_pertrans(struct btrfs_root *root,\n\t\t\t\t\t\t   int num_bytes)\n{\n\t__btrfs_qgroup_free_meta(root, num_bytes,\n\t\t\tBTRFS_QGROUP_RSV_META_PERTRANS);\n}\n\n \nstatic inline void btrfs_qgroup_free_meta_prealloc(struct btrfs_root *root,\n\t\t\t\t\t\t   int num_bytes)\n{\n\t__btrfs_qgroup_free_meta(root, num_bytes,\n\t\t\tBTRFS_QGROUP_RSV_META_PREALLOC);\n}\n\n \nvoid btrfs_qgroup_free_meta_all_pertrans(struct btrfs_root *root);\n\n \nvoid btrfs_qgroup_convert_reserved_meta(struct btrfs_root *root, int num_bytes);\n\nvoid btrfs_qgroup_check_reserved_leak(struct btrfs_inode *inode);\n\n \nvoid btrfs_qgroup_init_swapped_blocks(\n\tstruct btrfs_qgroup_swapped_blocks *swapped_blocks);\n\nvoid btrfs_qgroup_clean_swapped_blocks(struct btrfs_root *root);\nint btrfs_qgroup_add_swapped_blocks(struct btrfs_trans_handle *trans,\n\t\tstruct btrfs_root *subvol_root,\n\t\tstruct btrfs_block_group *bg,\n\t\tstruct extent_buffer *subvol_parent, int subvol_slot,\n\t\tstruct extent_buffer *reloc_parent, int reloc_slot,\n\t\tu64 last_snapshot);\nint btrfs_qgroup_trace_subtree_after_cow(struct btrfs_trans_handle *trans,\n\t\tstruct btrfs_root *root, struct extent_buffer *eb);\nvoid btrfs_qgroup_destroy_extent_records(struct btrfs_transaction *trans);\nbool btrfs_check_quota_leak(struct btrfs_fs_info *fs_info);\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}