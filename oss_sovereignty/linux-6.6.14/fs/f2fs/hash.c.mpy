{
  "module_name": "hash.c",
  "hash_id": "394fee990cbb279e30043d024069eb0d2183a9411b8c64d7ea3182b72e8676e0",
  "original_prompt": "Ingested from linux-6.6.14/fs/f2fs/hash.c",
  "human_readable_source": "\n \n#include <linux/types.h>\n#include <linux/fs.h>\n#include <linux/f2fs_fs.h>\n#include <linux/pagemap.h>\n#include <linux/unicode.h>\n\n#include \"f2fs.h\"\n\n \n#define DELTA 0x9E3779B9\n\nstatic void TEA_transform(unsigned int buf[4], unsigned int const in[])\n{\n\t__u32 sum = 0;\n\t__u32 b0 = buf[0], b1 = buf[1];\n\t__u32 a = in[0], b = in[1], c = in[2], d = in[3];\n\tint n = 16;\n\n\tdo {\n\t\tsum += DELTA;\n\t\tb0 += ((b1 << 4)+a) ^ (b1+sum) ^ ((b1 >> 5)+b);\n\t\tb1 += ((b0 << 4)+c) ^ (b0+sum) ^ ((b0 >> 5)+d);\n\t} while (--n);\n\n\tbuf[0] += b0;\n\tbuf[1] += b1;\n}\n\nstatic void str2hashbuf(const unsigned char *msg, size_t len,\n\t\t\t\tunsigned int *buf, int num)\n{\n\tunsigned pad, val;\n\tint i;\n\n\tpad = (__u32)len | ((__u32)len << 8);\n\tpad |= pad << 16;\n\n\tval = pad;\n\tif (len > num * 4)\n\t\tlen = num * 4;\n\tfor (i = 0; i < len; i++) {\n\t\tif ((i % 4) == 0)\n\t\t\tval = pad;\n\t\tval = msg[i] + (val << 8);\n\t\tif ((i % 4) == 3) {\n\t\t\t*buf++ = val;\n\t\t\tval = pad;\n\t\t\tnum--;\n\t\t}\n\t}\n\tif (--num >= 0)\n\t\t*buf++ = val;\n\twhile (--num >= 0)\n\t\t*buf++ = pad;\n}\n\nstatic u32 TEA_hash_name(const u8 *p, size_t len)\n{\n\t__u32 in[8], buf[4];\n\n\t \n\tbuf[0] = 0x67452301;\n\tbuf[1] = 0xefcdab89;\n\tbuf[2] = 0x98badcfe;\n\tbuf[3] = 0x10325476;\n\n\twhile (1) {\n\t\tstr2hashbuf(p, len, in, 4);\n\t\tTEA_transform(buf, in);\n\t\tp += 16;\n\t\tif (len <= 16)\n\t\t\tbreak;\n\t\tlen -= 16;\n\t}\n\treturn buf[0] & ~F2FS_HASH_COL_BIT;\n}\n\n \nvoid f2fs_hash_filename(const struct inode *dir, struct f2fs_filename *fname)\n{\n\tconst u8 *name = fname->disk_name.name;\n\tsize_t len = fname->disk_name.len;\n\n\tWARN_ON_ONCE(!name);\n\n\tif (is_dot_dotdot(name, len)) {\n\t\tfname->hash = 0;\n\t\treturn;\n\t}\n\n#if IS_ENABLED(CONFIG_UNICODE)\n\tif (IS_CASEFOLDED(dir)) {\n\t\t \n\t\tWARN_ON_ONCE(!fname->usr_fname->name);\n\t\tif (fname->cf_name.name) {\n\t\t\tname = fname->cf_name.name;\n\t\t\tlen = fname->cf_name.len;\n\t\t} else {\n\t\t\tname = fname->usr_fname->name;\n\t\t\tlen = fname->usr_fname->len;\n\t\t}\n\t\tif (IS_ENCRYPTED(dir)) {\n\t\t\tstruct qstr tmp = QSTR_INIT(name, len);\n\n\t\t\tfname->hash =\n\t\t\t\tcpu_to_le32(fscrypt_fname_siphash(dir, &tmp));\n\t\t\treturn;\n\t\t}\n\t}\n#endif\n\tfname->hash = cpu_to_le32(TEA_hash_name(name, len));\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}