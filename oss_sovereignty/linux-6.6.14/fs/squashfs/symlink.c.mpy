{
  "module_name": "symlink.c",
  "hash_id": "2773afc881d3564c3a8869ea1296c77eeacd4e1a0f9e3501ee332891386b1ab7",
  "original_prompt": "Ingested from linux-6.6.14/fs/squashfs/symlink.c",
  "human_readable_source": "\n \n\n \n\n#include <linux/fs.h>\n#include <linux/vfs.h>\n#include <linux/kernel.h>\n#include <linux/string.h>\n#include <linux/pagemap.h>\n#include <linux/xattr.h>\n\n#include \"squashfs_fs.h\"\n#include \"squashfs_fs_sb.h\"\n#include \"squashfs_fs_i.h\"\n#include \"squashfs.h\"\n#include \"xattr.h\"\n\nstatic int squashfs_symlink_read_folio(struct file *file, struct folio *folio)\n{\n\tstruct page *page = &folio->page;\n\tstruct inode *inode = page->mapping->host;\n\tstruct super_block *sb = inode->i_sb;\n\tstruct squashfs_sb_info *msblk = sb->s_fs_info;\n\tint index = page->index << PAGE_SHIFT;\n\tu64 block = squashfs_i(inode)->start;\n\tint offset = squashfs_i(inode)->offset;\n\tint length = min_t(int, i_size_read(inode) - index, PAGE_SIZE);\n\tint bytes, copied;\n\tvoid *pageaddr;\n\tstruct squashfs_cache_entry *entry;\n\n\tTRACE(\"Entered squashfs_symlink_readpage, page index %ld, start block \"\n\t\t\t\"%llx, offset %x\\n\", page->index, block, offset);\n\n\t \n\tif (index) {\n\t\tbytes = squashfs_read_metadata(sb, NULL, &block, &offset,\n\t\t\t\t\t\t\t\tindex);\n\t\tif (bytes < 0) {\n\t\t\tERROR(\"Unable to read symlink [%llx:%x]\\n\",\n\t\t\t\tsquashfs_i(inode)->start,\n\t\t\t\tsquashfs_i(inode)->offset);\n\t\t\tgoto error_out;\n\t\t}\n\t}\n\n\t \n\tfor (bytes = 0; bytes < length; offset = 0, bytes += copied) {\n\t\tentry = squashfs_cache_get(sb, msblk->block_cache, block, 0);\n\t\tif (entry->error) {\n\t\t\tERROR(\"Unable to read symlink [%llx:%x]\\n\",\n\t\t\t\tsquashfs_i(inode)->start,\n\t\t\t\tsquashfs_i(inode)->offset);\n\t\t\tsquashfs_cache_put(entry);\n\t\t\tgoto error_out;\n\t\t}\n\n\t\tpageaddr = kmap_atomic(page);\n\t\tcopied = squashfs_copy_data(pageaddr + bytes, entry, offset,\n\t\t\t\t\t\t\t\tlength - bytes);\n\t\tif (copied == length - bytes)\n\t\t\tmemset(pageaddr + length, 0, PAGE_SIZE - length);\n\t\telse\n\t\t\tblock = entry->next_index;\n\t\tkunmap_atomic(pageaddr);\n\t\tsquashfs_cache_put(entry);\n\t}\n\n\tflush_dcache_page(page);\n\tSetPageUptodate(page);\n\tunlock_page(page);\n\treturn 0;\n\nerror_out:\n\tSetPageError(page);\n\tunlock_page(page);\n\treturn 0;\n}\n\n\nconst struct address_space_operations squashfs_symlink_aops = {\n\t.read_folio = squashfs_symlink_read_folio\n};\n\nconst struct inode_operations squashfs_symlink_inode_ops = {\n\t.get_link = page_get_link,\n\t.listxattr = squashfs_listxattr\n};\n\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}