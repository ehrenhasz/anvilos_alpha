{
  "module_name": "decompressor_single.c",
  "hash_id": "4b2451f2decbeecc63a7ad43aafa10696a38f8da03cb2c86eee70b01e3bb57fa",
  "original_prompt": "Ingested from linux-6.6.14/fs/squashfs/decompressor_single.c",
  "human_readable_source": "\n \n\n#include <linux/types.h>\n#include <linux/mutex.h>\n#include <linux/slab.h>\n#include <linux/bio.h>\n\n#include \"squashfs_fs.h\"\n#include \"squashfs_fs_sb.h\"\n#include \"decompressor.h\"\n#include \"squashfs.h\"\n\n \n\nstruct squashfs_stream {\n\tvoid\t\t*stream;\n\tstruct mutex\tmutex;\n};\n\nstatic void *squashfs_decompressor_create(struct squashfs_sb_info *msblk,\n\t\t\t\t\t\tvoid *comp_opts)\n{\n\tstruct squashfs_stream *stream;\n\tint err = -ENOMEM;\n\n\tstream = kmalloc(sizeof(*stream), GFP_KERNEL);\n\tif (stream == NULL)\n\t\tgoto out;\n\n\tstream->stream = msblk->decompressor->init(msblk, comp_opts);\n\tif (IS_ERR(stream->stream)) {\n\t\terr = PTR_ERR(stream->stream);\n\t\tgoto out;\n\t}\n\n\tkfree(comp_opts);\n\tmutex_init(&stream->mutex);\n\treturn stream;\n\nout:\n\tkfree(stream);\n\treturn ERR_PTR(err);\n}\n\nstatic void squashfs_decompressor_destroy(struct squashfs_sb_info *msblk)\n{\n\tstruct squashfs_stream *stream = msblk->stream;\n\n\tif (stream) {\n\t\tmsblk->decompressor->free(stream->stream);\n\t\tkfree(stream);\n\t}\n}\n\nstatic int squashfs_decompress(struct squashfs_sb_info *msblk, struct bio *bio,\n\t\t\tint offset, int length,\n\t\t\tstruct squashfs_page_actor *output)\n{\n\tint res;\n\tstruct squashfs_stream *stream = msblk->stream;\n\n\tmutex_lock(&stream->mutex);\n\tres = msblk->decompressor->decompress(msblk, stream->stream, bio,\n\t\toffset, length, output);\n\tmutex_unlock(&stream->mutex);\n\n\tif (res < 0)\n\t\tERROR(\"%s decompression failed, data probably corrupt\\n\",\n\t\t\tmsblk->decompressor->name);\n\n\treturn res;\n}\n\nstatic int squashfs_max_decompressors(void)\n{\n\treturn 1;\n}\n\nconst struct squashfs_decompressor_thread_ops squashfs_decompressor_single = {\n\t.create = squashfs_decompressor_create,\n\t.destroy = squashfs_decompressor_destroy,\n\t.decompress = squashfs_decompress,\n\t.max_decompressors = squashfs_max_decompressors,\n};\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}