{
  "module_name": "decompressor.c",
  "hash_id": "9c4089e90bbabd1e35c562cf135118aed424d819edfd66ceac33d5256981165d",
  "original_prompt": "Ingested from linux-6.6.14/fs/squashfs/decompressor.c",
  "human_readable_source": "\n \n\n#include <linux/types.h>\n#include <linux/mutex.h>\n#include <linux/slab.h>\n\n#include \"squashfs_fs.h\"\n#include \"squashfs_fs_sb.h\"\n#include \"decompressor.h\"\n#include \"squashfs.h\"\n#include \"page_actor.h\"\n\n \n\nstatic const struct squashfs_decompressor squashfs_lzma_unsupported_comp_ops = {\n\tNULL, NULL, NULL, NULL, LZMA_COMPRESSION, \"lzma\", 0\n};\n\n#ifndef CONFIG_SQUASHFS_LZ4\nstatic const struct squashfs_decompressor squashfs_lz4_comp_ops = {\n\tNULL, NULL, NULL, NULL, LZ4_COMPRESSION, \"lz4\", 0\n};\n#endif\n\n#ifndef CONFIG_SQUASHFS_LZO\nstatic const struct squashfs_decompressor squashfs_lzo_comp_ops = {\n\tNULL, NULL, NULL, NULL, LZO_COMPRESSION, \"lzo\", 0\n};\n#endif\n\n#ifndef CONFIG_SQUASHFS_XZ\nstatic const struct squashfs_decompressor squashfs_xz_comp_ops = {\n\tNULL, NULL, NULL, NULL, XZ_COMPRESSION, \"xz\", 0\n};\n#endif\n\n#ifndef CONFIG_SQUASHFS_ZLIB\nstatic const struct squashfs_decompressor squashfs_zlib_comp_ops = {\n\tNULL, NULL, NULL, NULL, ZLIB_COMPRESSION, \"zlib\", 0\n};\n#endif\n\n#ifndef CONFIG_SQUASHFS_ZSTD\nstatic const struct squashfs_decompressor squashfs_zstd_comp_ops = {\n\tNULL, NULL, NULL, NULL, ZSTD_COMPRESSION, \"zstd\", 0\n};\n#endif\n\nstatic const struct squashfs_decompressor squashfs_unknown_comp_ops = {\n\tNULL, NULL, NULL, NULL, 0, \"unknown\", 0\n};\n\nstatic const struct squashfs_decompressor *decompressor[] = {\n\t&squashfs_zlib_comp_ops,\n\t&squashfs_lz4_comp_ops,\n\t&squashfs_lzo_comp_ops,\n\t&squashfs_xz_comp_ops,\n\t&squashfs_lzma_unsupported_comp_ops,\n\t&squashfs_zstd_comp_ops,\n\t&squashfs_unknown_comp_ops\n};\n\n\nconst struct squashfs_decompressor *squashfs_lookup_decompressor(int id)\n{\n\tint i;\n\n\tfor (i = 0; decompressor[i]->id; i++)\n\t\tif (id == decompressor[i]->id)\n\t\t\tbreak;\n\n\treturn decompressor[i];\n}\n\n\nstatic void *get_comp_opts(struct super_block *sb, unsigned short flags)\n{\n\tstruct squashfs_sb_info *msblk = sb->s_fs_info;\n\tvoid *buffer = NULL, *comp_opts;\n\tstruct squashfs_page_actor *actor = NULL;\n\tint length = 0;\n\n\t \n\tif (SQUASHFS_COMP_OPTS(flags)) {\n\t\tbuffer = kmalloc(PAGE_SIZE, GFP_KERNEL);\n\t\tif (buffer == NULL) {\n\t\t\tcomp_opts = ERR_PTR(-ENOMEM);\n\t\t\tgoto out;\n\t\t}\n\n\t\tactor = squashfs_page_actor_init(&buffer, 1, 0);\n\t\tif (actor == NULL) {\n\t\t\tcomp_opts = ERR_PTR(-ENOMEM);\n\t\t\tgoto out;\n\t\t}\n\n\t\tlength = squashfs_read_data(sb,\n\t\t\tsizeof(struct squashfs_super_block), 0, NULL, actor);\n\n\t\tif (length < 0) {\n\t\t\tcomp_opts = ERR_PTR(length);\n\t\t\tgoto out;\n\t\t}\n\t}\n\n\tcomp_opts = squashfs_comp_opts(msblk, buffer, length);\n\nout:\n\tkfree(actor);\n\tkfree(buffer);\n\treturn comp_opts;\n}\n\n\nvoid *squashfs_decompressor_setup(struct super_block *sb, unsigned short flags)\n{\n\tstruct squashfs_sb_info *msblk = sb->s_fs_info;\n\tvoid *stream, *comp_opts = get_comp_opts(sb, flags);\n\n\tif (IS_ERR(comp_opts))\n\t\treturn comp_opts;\n\n\tstream = msblk->thread_ops->create(msblk, comp_opts);\n\tif (IS_ERR(stream))\n\t\tkfree(comp_opts);\n\n\treturn stream;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}