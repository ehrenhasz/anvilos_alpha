{
  "module_name": "xattr_id.c",
  "hash_id": "3c099e70c8b171d205fb94d369fede963e926466509ffd2661a11d323c181caf",
  "original_prompt": "Ingested from linux-6.6.14/fs/squashfs/xattr_id.c",
  "human_readable_source": "\n \n\n \n\n#include <linux/fs.h>\n#include <linux/vfs.h>\n#include <linux/slab.h>\n\n#include \"squashfs_fs.h\"\n#include \"squashfs_fs_sb.h\"\n#include \"squashfs.h\"\n#include \"xattr.h\"\n\n \nint squashfs_xattr_lookup(struct super_block *sb, unsigned int index,\n\t\tint *count, unsigned int *size, unsigned long long *xattr)\n{\n\tstruct squashfs_sb_info *msblk = sb->s_fs_info;\n\tint block = SQUASHFS_XATTR_BLOCK(index);\n\tint offset = SQUASHFS_XATTR_BLOCK_OFFSET(index);\n\tu64 start_block;\n\tstruct squashfs_xattr_id id;\n\tint err;\n\n\tif (index >= msblk->xattr_ids)\n\t\treturn -EINVAL;\n\n\tstart_block = le64_to_cpu(msblk->xattr_id_table[block]);\n\n\terr = squashfs_read_metadata(sb, &id, &start_block, &offset,\n\t\t\t\t\t\t\tsizeof(id));\n\tif (err < 0)\n\t\treturn err;\n\n\t*xattr = le64_to_cpu(id.xattr);\n\t*size = le32_to_cpu(id.size);\n\t*count = le32_to_cpu(id.count);\n\treturn 0;\n}\n\n\n \n__le64 *squashfs_read_xattr_id_table(struct super_block *sb, u64 table_start,\n\t\tu64 *xattr_table_start, unsigned int *xattr_ids)\n{\n\tstruct squashfs_sb_info *msblk = sb->s_fs_info;\n\tunsigned int len, indexes;\n\tstruct squashfs_xattr_id_table *id_table;\n\t__le64 *table;\n\tu64 start, end;\n\tint n;\n\n\tid_table = squashfs_read_table(sb, table_start, sizeof(*id_table));\n\tif (IS_ERR(id_table))\n\t\treturn (__le64 *) id_table;\n\n\t*xattr_table_start = le64_to_cpu(id_table->xattr_table_start);\n\t*xattr_ids = le32_to_cpu(id_table->xattr_ids);\n\tkfree(id_table);\n\n\t \n\n\t \n\tif (*xattr_ids == 0)\n\t\treturn ERR_PTR(-EINVAL);\n\n\tlen = SQUASHFS_XATTR_BLOCK_BYTES(*xattr_ids);\n\tindexes = SQUASHFS_XATTR_BLOCKS(*xattr_ids);\n\n\t \n\tstart = table_start + sizeof(*id_table);\n\tend = msblk->bytes_used;\n\n\tif (len != (end - start))\n\t\treturn ERR_PTR(-EINVAL);\n\n\ttable = squashfs_read_table(sb, start, len);\n\tif (IS_ERR(table))\n\t\treturn table;\n\n\t \n\tfor (n = 0; n < (indexes - 1); n++) {\n\t\tstart = le64_to_cpu(table[n]);\n\t\tend = le64_to_cpu(table[n + 1]);\n\n\t\tif (start >= end || (end - start) >\n\t\t\t\t(SQUASHFS_METADATA_SIZE + SQUASHFS_BLOCK_OFFSET)) {\n\t\t\tkfree(table);\n\t\t\treturn ERR_PTR(-EINVAL);\n\t\t}\n\t}\n\n\tstart = le64_to_cpu(table[indexes - 1]);\n\tif (start >= table_start || (table_start - start) >\n\t\t\t\t(SQUASHFS_METADATA_SIZE + SQUASHFS_BLOCK_OFFSET)) {\n\t\tkfree(table);\n\t\treturn ERR_PTR(-EINVAL);\n\t}\n\n\tif (*xattr_table_start >= le64_to_cpu(table[0])) {\n\t\tkfree(table);\n\t\treturn ERR_PTR(-EINVAL);\n\t}\n\n\treturn table;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}