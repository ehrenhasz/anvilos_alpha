{
  "module_name": "fragment.c",
  "hash_id": "3b6a1ddaa010f4e6d18e5b20537ea44b5ee738768342aef8ce458638a6b9ad48",
  "original_prompt": "Ingested from linux-6.6.14/fs/squashfs/fragment.c",
  "human_readable_source": "\n \n\n \n\n#include <linux/fs.h>\n#include <linux/vfs.h>\n#include <linux/slab.h>\n\n#include \"squashfs_fs.h\"\n#include \"squashfs_fs_sb.h\"\n#include \"squashfs.h\"\n\n \nint squashfs_frag_lookup(struct super_block *sb, unsigned int fragment,\n\t\t\t\tu64 *fragment_block)\n{\n\tstruct squashfs_sb_info *msblk = sb->s_fs_info;\n\tint block, offset, size;\n\tstruct squashfs_fragment_entry fragment_entry;\n\tu64 start_block;\n\n\tif (fragment >= msblk->fragments)\n\t\treturn -EIO;\n\tblock = SQUASHFS_FRAGMENT_INDEX(fragment);\n\toffset = SQUASHFS_FRAGMENT_INDEX_OFFSET(fragment);\n\n\tstart_block = le64_to_cpu(msblk->fragment_index[block]);\n\n\tsize = squashfs_read_metadata(sb, &fragment_entry, &start_block,\n\t\t\t\t\t&offset, sizeof(fragment_entry));\n\tif (size < 0)\n\t\treturn size;\n\n\t*fragment_block = le64_to_cpu(fragment_entry.start_block);\n\treturn squashfs_block_size(fragment_entry.size);\n}\n\n\n \n__le64 *squashfs_read_fragment_index_table(struct super_block *sb,\n\tu64 fragment_table_start, u64 next_table, unsigned int fragments)\n{\n\tunsigned int length = SQUASHFS_FRAGMENT_INDEX_BYTES(fragments);\n\t__le64 *table;\n\n\t \n\tif (fragment_table_start + length > next_table)\n\t\treturn ERR_PTR(-EINVAL);\n\n\ttable = squashfs_read_table(sb, fragment_table_start, length);\n\n\t \n\tif (!IS_ERR(table) && le64_to_cpu(table[0]) >= fragment_table_start) {\n\t\tkfree(table);\n\t\treturn ERR_PTR(-EINVAL);\n\t}\n\n\treturn table;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}