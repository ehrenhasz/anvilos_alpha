{
  "module_name": "compr_rtime.c",
  "hash_id": "cfa323b35a5f74729ee1c9a885cac704019ae3cb8a966c20290a474f8185e58b",
  "original_prompt": "Ingested from linux-6.6.14/fs/jffs2/compr_rtime.c",
  "human_readable_source": " \n\n#include <linux/kernel.h>\n#include <linux/types.h>\n#include <linux/errno.h>\n#include <linux/string.h>\n#include <linux/jffs2.h>\n#include \"compr.h\"\n\n \nstatic int jffs2_rtime_compress(unsigned char *data_in,\n\t\t\t\tunsigned char *cpage_out,\n\t\t\t\tuint32_t *sourcelen, uint32_t *dstlen)\n{\n\tunsigned short positions[256];\n\tint outpos = 0;\n\tint pos=0;\n\n\tif (*dstlen <= 3)\n\t\treturn -1;\n\n\tmemset(positions,0,sizeof(positions));\n\n\twhile (pos < (*sourcelen) && outpos <= (*dstlen)-2) {\n\t\tint backpos, runlen=0;\n\t\tunsigned char value;\n\n\t\tvalue = data_in[pos];\n\n\t\tcpage_out[outpos++] = data_in[pos++];\n\n\t\tbackpos = positions[value];\n\t\tpositions[value]=pos;\n\n\t\twhile ((backpos < pos) && (pos < (*sourcelen)) &&\n\t\t       (data_in[pos]==data_in[backpos++]) && (runlen<255)) {\n\t\t\tpos++;\n\t\t\trunlen++;\n\t\t}\n\t\tcpage_out[outpos++] = runlen;\n\t}\n\n\tif (outpos >= pos) {\n\t\t \n\t\treturn -1;\n\t}\n\n\t \n\t*sourcelen = pos;\n\t*dstlen = outpos;\n\treturn 0;\n}\n\n\nstatic int jffs2_rtime_decompress(unsigned char *data_in,\n\t\t\t\t  unsigned char *cpage_out,\n\t\t\t\t  uint32_t srclen, uint32_t destlen)\n{\n\tunsigned short positions[256];\n\tint outpos = 0;\n\tint pos=0;\n\n\tmemset(positions,0,sizeof(positions));\n\n\twhile (outpos<destlen) {\n\t\tunsigned char value;\n\t\tint backoffs;\n\t\tint repeat;\n\n\t\tvalue = data_in[pos++];\n\t\tcpage_out[outpos++] = value;  \n\t\trepeat = data_in[pos++];\n\t\tbackoffs = positions[value];\n\n\t\tpositions[value]=outpos;\n\t\tif (repeat) {\n\t\t\tif (backoffs + repeat >= outpos) {\n\t\t\t\twhile(repeat) {\n\t\t\t\t\tcpage_out[outpos++] = cpage_out[backoffs++];\n\t\t\t\t\trepeat--;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tmemcpy(&cpage_out[outpos],&cpage_out[backoffs],repeat);\n\t\t\t\toutpos+=repeat;\n\t\t\t}\n\t\t}\n\t}\n\treturn 0;\n}\n\nstatic struct jffs2_compressor jffs2_rtime_comp = {\n    .priority = JFFS2_RTIME_PRIORITY,\n    .name = \"rtime\",\n    .compr = JFFS2_COMPR_RTIME,\n    .compress = &jffs2_rtime_compress,\n    .decompress = &jffs2_rtime_decompress,\n#ifdef JFFS2_RTIME_DISABLED\n    .disabled = 1,\n#else\n    .disabled = 0,\n#endif\n};\n\nint jffs2_rtime_init(void)\n{\n    return jffs2_register_compressor(&jffs2_rtime_comp);\n}\n\nvoid jffs2_rtime_exit(void)\n{\n    jffs2_unregister_compressor(&jffs2_rtime_comp);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}