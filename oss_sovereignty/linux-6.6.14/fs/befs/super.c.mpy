{
  "module_name": "super.c",
  "hash_id": "770765a5a3d4dbea5147b1908b2e0afdd89808addd67d6a51d3a8f34eea3e84a",
  "original_prompt": "Ingested from linux-6.6.14/fs/befs/super.c",
  "human_readable_source": " \n\n#include <linux/fs.h>\n#include <asm/page.h>  \n\n#include \"befs.h\"\n#include \"super.h\"\n\n \nint\nbefs_load_sb(struct super_block *sb, befs_super_block *disk_sb)\n{\n\tstruct befs_sb_info *befs_sb = BEFS_SB(sb);\n\n\t \n\tif (disk_sb->fs_byte_order == BEFS_BYTEORDER_NATIVE_LE)\n\t\tbefs_sb->byte_order = BEFS_BYTESEX_LE;\n\telse if (disk_sb->fs_byte_order == BEFS_BYTEORDER_NATIVE_BE)\n\t\tbefs_sb->byte_order = BEFS_BYTESEX_BE;\n\n\tbefs_sb->magic1 = fs32_to_cpu(sb, disk_sb->magic1);\n\tbefs_sb->magic2 = fs32_to_cpu(sb, disk_sb->magic2);\n\tbefs_sb->magic3 = fs32_to_cpu(sb, disk_sb->magic3);\n\tbefs_sb->block_size = fs32_to_cpu(sb, disk_sb->block_size);\n\tbefs_sb->block_shift = fs32_to_cpu(sb, disk_sb->block_shift);\n\tbefs_sb->num_blocks = fs64_to_cpu(sb, disk_sb->num_blocks);\n\tbefs_sb->used_blocks = fs64_to_cpu(sb, disk_sb->used_blocks);\n\tbefs_sb->inode_size = fs32_to_cpu(sb, disk_sb->inode_size);\n\n\tbefs_sb->blocks_per_ag = fs32_to_cpu(sb, disk_sb->blocks_per_ag);\n\tbefs_sb->ag_shift = fs32_to_cpu(sb, disk_sb->ag_shift);\n\tbefs_sb->num_ags = fs32_to_cpu(sb, disk_sb->num_ags);\n\n\tbefs_sb->flags = fs32_to_cpu(sb, disk_sb->flags);\n\n\tbefs_sb->log_blocks = fsrun_to_cpu(sb, disk_sb->log_blocks);\n\tbefs_sb->log_start = fs64_to_cpu(sb, disk_sb->log_start);\n\tbefs_sb->log_end = fs64_to_cpu(sb, disk_sb->log_end);\n\n\tbefs_sb->root_dir = fsrun_to_cpu(sb, disk_sb->root_dir);\n\tbefs_sb->indices = fsrun_to_cpu(sb, disk_sb->indices);\n\tbefs_sb->nls = NULL;\n\n\treturn BEFS_OK;\n}\n\nint\nbefs_check_sb(struct super_block *sb)\n{\n\tstruct befs_sb_info *befs_sb = BEFS_SB(sb);\n\n\t \n\tif ((befs_sb->magic1 != BEFS_SUPER_MAGIC1)\n\t    || (befs_sb->magic2 != BEFS_SUPER_MAGIC2)\n\t    || (befs_sb->magic3 != BEFS_SUPER_MAGIC3)) {\n\t\tbefs_error(sb, \"invalid magic header\");\n\t\treturn BEFS_ERR;\n\t}\n\n\t \n\n\tif ((befs_sb->block_size != 1024)\n\t    && (befs_sb->block_size != 2048)\n\t    && (befs_sb->block_size != 4096)\n\t    && (befs_sb->block_size != 8192)) {\n\t\tbefs_error(sb, \"invalid blocksize: %u\", befs_sb->block_size);\n\t\treturn BEFS_ERR;\n\t}\n\n\tif (befs_sb->block_size > PAGE_SIZE) {\n\t\tbefs_error(sb, \"blocksize(%u) cannot be larger \"\n\t\t\t   \"than system pagesize(%lu)\", befs_sb->block_size,\n\t\t\t   PAGE_SIZE);\n\t\treturn BEFS_ERR;\n\t}\n\n\t \n\n\tif ((1 << befs_sb->block_shift) != befs_sb->block_size) {\n\t\tbefs_error(sb, \"block_shift disagrees with block_size. \"\n\t\t\t   \"Corruption likely.\");\n\t\treturn BEFS_ERR;\n\t}\n\n\n\t \n\tif ((1 << befs_sb->ag_shift) != befs_sb->blocks_per_ag)\n\t\tbefs_error(sb, \"ag_shift disagrees with blocks_per_ag.\");\n\n\tif (befs_sb->log_start != befs_sb->log_end ||\n\t    befs_sb->flags == BEFS_DIRTY) {\n\t\tbefs_error(sb, \"Filesystem not clean! There are blocks in the \"\n\t\t\t   \"journal. You must boot into BeOS and mount this \"\n\t\t\t   \"volume to make it clean.\");\n\t\treturn BEFS_ERR;\n\t}\n\n\treturn BEFS_OK;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}