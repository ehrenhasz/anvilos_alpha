{
  "module_name": "bitmap.c",
  "hash_id": "1e918a1806048bcca4a0a8ad0e210753d21394e21ee054011a2b6b198f970778",
  "original_prompt": "Ingested from linux-6.6.14/fs/ext4/bitmap.c",
  "human_readable_source": "\n \n\n#include <linux/buffer_head.h>\n#include \"ext4.h\"\n\nunsigned int ext4_count_free(char *bitmap, unsigned int numchars)\n{\n\treturn numchars * BITS_PER_BYTE - memweight(bitmap, numchars);\n}\n\nint ext4_inode_bitmap_csum_verify(struct super_block *sb,\n\t\t\t\t  struct ext4_group_desc *gdp,\n\t\t\t\t  struct buffer_head *bh, int sz)\n{\n\t__u32 hi;\n\t__u32 provided, calculated;\n\tstruct ext4_sb_info *sbi = EXT4_SB(sb);\n\n\tif (!ext4_has_metadata_csum(sb))\n\t\treturn 1;\n\n\tprovided = le16_to_cpu(gdp->bg_inode_bitmap_csum_lo);\n\tcalculated = ext4_chksum(sbi, sbi->s_csum_seed, (__u8 *)bh->b_data, sz);\n\tif (sbi->s_desc_size >= EXT4_BG_INODE_BITMAP_CSUM_HI_END) {\n\t\thi = le16_to_cpu(gdp->bg_inode_bitmap_csum_hi);\n\t\tprovided |= (hi << 16);\n\t} else\n\t\tcalculated &= 0xFFFF;\n\n\treturn provided == calculated;\n}\n\nvoid ext4_inode_bitmap_csum_set(struct super_block *sb,\n\t\t\t\tstruct ext4_group_desc *gdp,\n\t\t\t\tstruct buffer_head *bh, int sz)\n{\n\t__u32 csum;\n\tstruct ext4_sb_info *sbi = EXT4_SB(sb);\n\n\tif (!ext4_has_metadata_csum(sb))\n\t\treturn;\n\n\tcsum = ext4_chksum(sbi, sbi->s_csum_seed, (__u8 *)bh->b_data, sz);\n\tgdp->bg_inode_bitmap_csum_lo = cpu_to_le16(csum & 0xFFFF);\n\tif (sbi->s_desc_size >= EXT4_BG_INODE_BITMAP_CSUM_HI_END)\n\t\tgdp->bg_inode_bitmap_csum_hi = cpu_to_le16(csum >> 16);\n}\n\nint ext4_block_bitmap_csum_verify(struct super_block *sb,\n\t\t\t\t  struct ext4_group_desc *gdp,\n\t\t\t\t  struct buffer_head *bh)\n{\n\t__u32 hi;\n\t__u32 provided, calculated;\n\tstruct ext4_sb_info *sbi = EXT4_SB(sb);\n\tint sz = EXT4_CLUSTERS_PER_GROUP(sb) / 8;\n\n\tif (!ext4_has_metadata_csum(sb))\n\t\treturn 1;\n\n\tprovided = le16_to_cpu(gdp->bg_block_bitmap_csum_lo);\n\tcalculated = ext4_chksum(sbi, sbi->s_csum_seed, (__u8 *)bh->b_data, sz);\n\tif (sbi->s_desc_size >= EXT4_BG_BLOCK_BITMAP_CSUM_HI_END) {\n\t\thi = le16_to_cpu(gdp->bg_block_bitmap_csum_hi);\n\t\tprovided |= (hi << 16);\n\t} else\n\t\tcalculated &= 0xFFFF;\n\n\treturn provided == calculated;\n}\n\nvoid ext4_block_bitmap_csum_set(struct super_block *sb,\n\t\t\t\tstruct ext4_group_desc *gdp,\n\t\t\t\tstruct buffer_head *bh)\n{\n\tint sz = EXT4_CLUSTERS_PER_GROUP(sb) / 8;\n\t__u32 csum;\n\tstruct ext4_sb_info *sbi = EXT4_SB(sb);\n\n\tif (!ext4_has_metadata_csum(sb))\n\t\treturn;\n\n\tcsum = ext4_chksum(sbi, sbi->s_csum_seed, (__u8 *)bh->b_data, sz);\n\tgdp->bg_block_bitmap_csum_lo = cpu_to_le16(csum & 0xFFFF);\n\tif (sbi->s_desc_size >= EXT4_BG_BLOCK_BITMAP_CSUM_HI_END)\n\t\tgdp->bg_block_bitmap_csum_hi = cpu_to_le16(csum >> 16);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}