{
  "module_name": "inode-test.c",
  "hash_id": "357ba9ebef386ad8aa0b9b51197bb7d43749c9fe10fa6f90f60bfc9a3498f2be",
  "original_prompt": "Ingested from linux-6.6.14/fs/ext4/inode-test.c",
  "human_readable_source": "\n \n\n#include <kunit/test.h>\n#include <linux/kernel.h>\n#include <linux/time64.h>\n\n#include \"ext4.h\"\n\n \n#define LOWER_MSB_0 0L\n \n#define UPPER_MSB_0 0x7fffffffL\n \n#define LOWER_MSB_1 (-(UPPER_MSB_0) - 1L)   \n \n#define UPPER_MSB_1 (-1L)\n \n#define MAX_NANOSECONDS ((1L << 30) - 1)\n\n#define CASE_NAME_FORMAT \"%s: msb:%x lower_bound:%x extra_bits: %x\"\n\n#define LOWER_BOUND_NEG_NO_EXTRA_BITS_CASE\\\n\t\"1901-12-13 Lower bound of 32bit < 0 timestamp, no extra bits\"\n#define UPPER_BOUND_NEG_NO_EXTRA_BITS_CASE\\\n\t\"1969-12-31 Upper bound of 32bit < 0 timestamp, no extra bits\"\n#define LOWER_BOUND_NONNEG_NO_EXTRA_BITS_CASE\\\n\t\"1970-01-01 Lower bound of 32bit >=0 timestamp, no extra bits\"\n#define UPPER_BOUND_NONNEG_NO_EXTRA_BITS_CASE\\\n\t\"2038-01-19 Upper bound of 32bit >=0 timestamp, no extra bits\"\n#define LOWER_BOUND_NEG_LO_1_CASE\\\n\t\"2038-01-19 Lower bound of 32bit <0 timestamp, lo extra sec bit on\"\n#define UPPER_BOUND_NEG_LO_1_CASE\\\n\t\"2106-02-07 Upper bound of 32bit <0 timestamp, lo extra sec bit on\"\n#define LOWER_BOUND_NONNEG_LO_1_CASE\\\n\t\"2106-02-07 Lower bound of 32bit >=0 timestamp, lo extra sec bit on\"\n#define UPPER_BOUND_NONNEG_LO_1_CASE\\\n\t\"2174-02-25 Upper bound of 32bit >=0 timestamp, lo extra sec bit on\"\n#define LOWER_BOUND_NEG_HI_1_CASE\\\n\t\"2174-02-25 Lower bound of 32bit <0 timestamp, hi extra sec bit on\"\n#define UPPER_BOUND_NEG_HI_1_CASE\\\n\t\"2242-03-16 Upper bound of 32bit <0 timestamp, hi extra sec bit on\"\n#define LOWER_BOUND_NONNEG_HI_1_CASE\\\n\t\"2242-03-16 Lower bound of 32bit >=0 timestamp, hi extra sec bit on\"\n#define UPPER_BOUND_NONNEG_HI_1_CASE\\\n\t\"2310-04-04 Upper bound of 32bit >=0 timestamp, hi extra sec bit on\"\n#define UPPER_BOUND_NONNEG_HI_1_NS_1_CASE\\\n\t\"2310-04-04 Upper bound of 32bit>=0 timestamp, hi extra sec bit 1. 1 ns\"\n#define LOWER_BOUND_NONNEG_HI_1_NS_MAX_CASE\\\n\t\"2378-04-22 Lower bound of 32bit>= timestamp. Extra sec bits 1. Max ns\"\n#define LOWER_BOUND_NONNEG_EXTRA_BITS_1_CASE\\\n\t\"2378-04-22 Lower bound of 32bit >=0 timestamp. All extra sec bits on\"\n#define UPPER_BOUND_NONNEG_EXTRA_BITS_1_CASE\\\n\t\"2446-05-10 Upper bound of 32bit >=0 timestamp. All extra sec bits on\"\n\nstruct timestamp_expectation {\n\tconst char *test_case_name;\n\tstruct timespec64 expected;\n\tu32 extra_bits;\n\tbool msb_set;\n\tbool lower_bound;\n};\n\nstatic const struct timestamp_expectation test_data[] = {\n\t{\n\t\t.test_case_name = LOWER_BOUND_NEG_NO_EXTRA_BITS_CASE,\n\t\t.msb_set = true,\n\t\t.lower_bound = true,\n\t\t.extra_bits = 0,\n\t\t.expected = {.tv_sec = -0x80000000LL, .tv_nsec = 0L},\n\t},\n\n\t{\n\t\t.test_case_name = UPPER_BOUND_NEG_NO_EXTRA_BITS_CASE,\n\t\t.msb_set = true,\n\t\t.lower_bound = false,\n\t\t.extra_bits = 0,\n\t\t.expected = {.tv_sec = -1LL, .tv_nsec = 0L},\n\t},\n\n\t{\n\t\t.test_case_name = LOWER_BOUND_NONNEG_NO_EXTRA_BITS_CASE,\n\t\t.msb_set = false,\n\t\t.lower_bound = true,\n\t\t.extra_bits = 0,\n\t\t.expected = {0LL, 0L},\n\t},\n\n\t{\n\t\t.test_case_name = UPPER_BOUND_NONNEG_NO_EXTRA_BITS_CASE,\n\t\t.msb_set = false,\n\t\t.lower_bound = false,\n\t\t.extra_bits = 0,\n\t\t.expected = {.tv_sec = 0x7fffffffLL, .tv_nsec = 0L},\n\t},\n\n\t{\n\t\t.test_case_name = LOWER_BOUND_NEG_LO_1_CASE,\n\t\t.msb_set = true,\n\t\t.lower_bound = true,\n\t\t.extra_bits = 1,\n\t\t.expected = {.tv_sec = 0x80000000LL, .tv_nsec = 0L},\n\t},\n\n\t{\n\t\t.test_case_name = UPPER_BOUND_NEG_LO_1_CASE,\n\t\t.msb_set = true,\n\t\t.lower_bound = false,\n\t\t.extra_bits = 1,\n\t\t.expected = {.tv_sec = 0xffffffffLL, .tv_nsec = 0L},\n\t},\n\n\t{\n\t\t.test_case_name = LOWER_BOUND_NONNEG_LO_1_CASE,\n\t\t.msb_set = false,\n\t\t.lower_bound = true,\n\t\t.extra_bits = 1,\n\t\t.expected = {.tv_sec = 0x100000000LL, .tv_nsec = 0L},\n\t},\n\n\t{\n\t\t.test_case_name = UPPER_BOUND_NONNEG_LO_1_CASE,\n\t\t.msb_set = false,\n\t\t.lower_bound = false,\n\t\t.extra_bits = 1,\n\t\t.expected = {.tv_sec = 0x17fffffffLL, .tv_nsec = 0L},\n\t},\n\n\t{\n\t\t.test_case_name = LOWER_BOUND_NEG_HI_1_CASE,\n\t\t.msb_set = true,\n\t\t.lower_bound = true,\n\t\t.extra_bits =  2,\n\t\t.expected = {.tv_sec = 0x180000000LL, .tv_nsec = 0L},\n\t},\n\n\t{\n\t\t.test_case_name = UPPER_BOUND_NEG_HI_1_CASE,\n\t\t.msb_set = true,\n\t\t.lower_bound = false,\n\t\t.extra_bits = 2,\n\t\t.expected = {.tv_sec = 0x1ffffffffLL, .tv_nsec = 0L},\n\t},\n\n\t{\n\t\t.test_case_name = LOWER_BOUND_NONNEG_HI_1_CASE,\n\t\t.msb_set = false,\n\t\t.lower_bound = true,\n\t\t.extra_bits = 2,\n\t\t.expected = {.tv_sec = 0x200000000LL, .tv_nsec = 0L},\n\t},\n\n\t{\n\t\t.test_case_name = UPPER_BOUND_NONNEG_HI_1_CASE,\n\t\t.msb_set = false,\n\t\t.lower_bound = false,\n\t\t.extra_bits = 2,\n\t\t.expected = {.tv_sec = 0x27fffffffLL, .tv_nsec = 0L},\n\t},\n\n\t{\n\t\t.test_case_name = UPPER_BOUND_NONNEG_HI_1_NS_1_CASE,\n\t\t.msb_set = false,\n\t\t.lower_bound = false,\n\t\t.extra_bits = 6,\n\t\t.expected = {.tv_sec = 0x27fffffffLL, .tv_nsec = 1L},\n\t},\n\n\t{\n\t\t.test_case_name = LOWER_BOUND_NONNEG_HI_1_NS_MAX_CASE,\n\t\t.msb_set = false,\n\t\t.lower_bound = true,\n\t\t.extra_bits = 0xFFFFFFFF,\n\t\t.expected = {.tv_sec = 0x300000000LL,\n\t\t\t     .tv_nsec = MAX_NANOSECONDS},\n\t},\n\n\t{\n\t\t.test_case_name = LOWER_BOUND_NONNEG_EXTRA_BITS_1_CASE,\n\t\t.msb_set = false,\n\t\t.lower_bound = true,\n\t\t.extra_bits = 3,\n\t\t.expected = {.tv_sec = 0x300000000LL, .tv_nsec = 0L},\n\t},\n\n\t{\n\t\t.test_case_name = UPPER_BOUND_NONNEG_EXTRA_BITS_1_CASE,\n\t\t.msb_set = false,\n\t\t.lower_bound = false,\n\t\t.extra_bits = 3,\n\t\t.expected = {.tv_sec = 0x37fffffffLL, .tv_nsec = 0L},\n\t}\n};\n\nstatic void timestamp_expectation_to_desc(const struct timestamp_expectation *t,\n\t\t\t\t\t  char *desc)\n{\n\tstrscpy(desc, t->test_case_name, KUNIT_PARAM_DESC_SIZE);\n}\n\nKUNIT_ARRAY_PARAM(ext4_inode, test_data, timestamp_expectation_to_desc);\n\nstatic time64_t get_32bit_time(const struct timestamp_expectation * const test)\n{\n\tif (test->msb_set) {\n\t\tif (test->lower_bound)\n\t\t\treturn LOWER_MSB_1;\n\n\t\treturn UPPER_MSB_1;\n\t}\n\n\tif (test->lower_bound)\n\t\treturn LOWER_MSB_0;\n\treturn UPPER_MSB_0;\n}\n\n\n \nstatic void inode_test_xtimestamp_decoding(struct kunit *test)\n{\n\tstruct timespec64 timestamp;\n\n\tstruct timestamp_expectation *test_param =\n\t\t\t(struct timestamp_expectation *)(test->param_value);\n\n\ttimestamp = ext4_decode_extra_time(\n\t\t\t\tcpu_to_le32(get_32bit_time(test_param)),\n\t\t\t\tcpu_to_le32(test_param->extra_bits));\n\n\tKUNIT_EXPECT_EQ_MSG(test,\n\t\t\t    test_param->expected.tv_sec,\n\t\t\t    timestamp.tv_sec,\n\t\t\t    CASE_NAME_FORMAT,\n\t\t\t    test_param->test_case_name,\n\t\t\t    test_param->msb_set,\n\t\t\t    test_param->lower_bound,\n\t\t\t    test_param->extra_bits);\n\tKUNIT_EXPECT_EQ_MSG(test,\n\t\t\t    test_param->expected.tv_nsec,\n\t\t\t    timestamp.tv_nsec,\n\t\t\t    CASE_NAME_FORMAT,\n\t\t\t    test_param->test_case_name,\n\t\t\t    test_param->msb_set,\n\t\t\t    test_param->lower_bound,\n\t\t\t    test_param->extra_bits);\n}\n\nstatic struct kunit_case ext4_inode_test_cases[] = {\n\tKUNIT_CASE_PARAM(inode_test_xtimestamp_decoding, ext4_inode_gen_params),\n\t{}\n};\n\nstatic struct kunit_suite ext4_inode_test_suite = {\n\t.name = \"ext4_inode_test\",\n\t.test_cases = ext4_inode_test_cases,\n};\n\nkunit_test_suites(&ext4_inode_test_suite);\n\nMODULE_LICENSE(\"GPL v2\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}