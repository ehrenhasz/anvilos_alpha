{
  "module_name": "mballoc.h",
  "hash_id": "92e1b08530bc91a5f6790c1fed5d8dcc60e7b94001455a6058be5586bf806c19",
  "original_prompt": "Ingested from linux-6.6.14/fs/ext4/mballoc.h",
  "human_readable_source": "\n \n#ifndef _EXT4_MBALLOC_H\n#define _EXT4_MBALLOC_H\n\n#include <linux/time.h>\n#include <linux/fs.h>\n#include <linux/namei.h>\n#include <linux/quotaops.h>\n#include <linux/buffer_head.h>\n#include <linux/module.h>\n#include <linux/swap.h>\n#include <linux/proc_fs.h>\n#include <linux/pagemap.h>\n#include <linux/seq_file.h>\n#include <linux/blkdev.h>\n#include <linux/mutex.h>\n#include \"ext4_jbd2.h\"\n#include \"ext4.h\"\n\n \n#ifdef CONFIG_EXT4_DEBUG\n#define mb_debug(sb, fmt, ...)\t\t\t\t\t\t\\\n\tpr_debug(\"[%s/%d] EXT4-fs (%s): (%s, %d): %s: \" fmt,\t\t\\\n\t\tcurrent->comm, task_pid_nr(current), sb->s_id,\t\t\\\n\t       __FILE__, __LINE__, __func__, ##__VA_ARGS__)\n#else\n#define mb_debug(sb, fmt, ...)\tno_printk(fmt, ##__VA_ARGS__)\n#endif\n\n#define EXT4_MB_HISTORY_ALLOC\t\t1\t \n#define EXT4_MB_HISTORY_PREALLOC\t2\t \n\n \n#define MB_DEFAULT_MAX_TO_SCAN\t\t200\n\n \n#define MB_DEFAULT_MIN_TO_SCAN\t\t10\n\n \n#define MB_DEFAULT_STATS\t\t0\n\n \n#define MB_DEFAULT_STREAM_THRESHOLD\t16\t \n\n \n#define MB_DEFAULT_ORDER2_REQS\t\t2\n\n \n#define MB_DEFAULT_GROUP_PREALLOC\t512\n\n \n#define MB_DEFAULT_LINEAR_LIMIT\t\t4\n\n \n#define MB_DEFAULT_LINEAR_SCAN_THRESHOLD\t16\n\n \n#define MB_DEFAULT_BEST_AVAIL_TRIM_ORDER\t3\n\n \n#define MB_NUM_ORDERS(sb)\t\t((sb)->s_blocksize_bits + 2)\n\nstruct ext4_free_data {\n\t \n\tstruct list_head\t\tefd_list;\n\n\t \n\tstruct rb_node\t\t\tefd_node;\n\n\t \n\text4_group_t\t\t\tefd_group;\n\n\t \n\text4_grpblk_t\t\t\tefd_start_cluster;\n\text4_grpblk_t\t\t\tefd_count;\n\n\t \n\ttid_t\t\t\t\tefd_tid;\n};\n\nstruct ext4_prealloc_space {\n\tunion {\n\t\tstruct rb_node\tinode_node;\t\t \n\t\tstruct list_head\tlg_list;\t \n\t} pa_node;\n\tstruct list_head\tpa_group_list;\n\tunion {\n\t\tstruct list_head pa_tmp_list;\n\t\tstruct rcu_head\tpa_rcu;\n\t} u;\n\tspinlock_t\t\tpa_lock;\n\tatomic_t\t\tpa_count;\n\tunsigned\t\tpa_deleted;\n\text4_fsblk_t\t\tpa_pstart;\t \n\text4_lblk_t\t\tpa_lstart;\t \n\text4_grpblk_t\t\tpa_len;\t\t \n\text4_grpblk_t\t\tpa_free;\t \n\tunsigned short\t\tpa_type;\t \n\tunion {\n\t\trwlock_t\t\t*inode_lock;\t \n\t\tspinlock_t\t\t*lg_lock;\t \n\t} pa_node_lock;\n\tstruct inode\t\t*pa_inode;\t \n};\n\nenum {\n\tMB_INODE_PA = 0,\n\tMB_GROUP_PA = 1\n};\n\nstruct ext4_free_extent {\n\text4_lblk_t fe_logical;\n\text4_grpblk_t fe_start;\t \n\text4_group_t fe_group;\n\text4_grpblk_t fe_len;\t \n};\n\n \n#define PREALLOC_TB_SIZE 10\nstruct ext4_locality_group {\n\t \n\t \n\tstruct mutex\t\tlg_mutex;\n\t \n\tstruct list_head\tlg_prealloc_list[PREALLOC_TB_SIZE];\n\tspinlock_t\t\tlg_prealloc_lock;\n};\n\nstruct ext4_allocation_context {\n\tstruct inode *ac_inode;\n\tstruct super_block *ac_sb;\n\n\t \n\tstruct ext4_free_extent ac_o_ex;\n\n\t \n\tstruct ext4_free_extent ac_g_ex;\n\n\t \n\tstruct ext4_free_extent ac_b_ex;\n\n\t \n\tstruct ext4_free_extent ac_f_ex;\n\n\t \n\text4_grpblk_t\tac_orig_goal_len;\n\n\t__u32 ac_groups_considered;\n\t__u32 ac_flags;\t\t \n\t__u16 ac_groups_scanned;\n\t__u16 ac_groups_linear_remaining;\n\t__u16 ac_found;\n\t__u16 ac_cX_found[EXT4_MB_NUM_CRS];\n\t__u16 ac_tail;\n\t__u16 ac_buddy;\n\t__u8 ac_status;\n\t__u8 ac_criteria;\n\t__u8 ac_2order;\t\t \n\t__u8 ac_op;\t\t \n\tstruct page *ac_bitmap_page;\n\tstruct page *ac_buddy_page;\n\tstruct ext4_prealloc_space *ac_pa;\n\tstruct ext4_locality_group *ac_lg;\n};\n\n#define AC_STATUS_CONTINUE\t1\n#define AC_STATUS_FOUND\t\t2\n#define AC_STATUS_BREAK\t\t3\n\nstruct ext4_buddy {\n\tstruct page *bd_buddy_page;\n\tvoid *bd_buddy;\n\tstruct page *bd_bitmap_page;\n\tvoid *bd_bitmap;\n\tstruct ext4_group_info *bd_info;\n\tstruct super_block *bd_sb;\n\t__u16 bd_blkbits;\n\text4_group_t bd_group;\n};\n\nstatic inline ext4_fsblk_t ext4_grp_offs_to_block(struct super_block *sb,\n\t\t\t\t\tstruct ext4_free_extent *fex)\n{\n\treturn ext4_group_first_block_no(sb, fex->fe_group) +\n\t\t(fex->fe_start << EXT4_SB(sb)->s_cluster_bits);\n}\n\nstatic inline loff_t extent_logical_end(struct ext4_sb_info *sbi,\n\t\t\t\t\tstruct ext4_free_extent *fex)\n{\n\t \n\treturn (loff_t)fex->fe_logical + EXT4_C2B(sbi, fex->fe_len);\n}\n\nstatic inline loff_t pa_logical_end(struct ext4_sb_info *sbi,\n\t\t\t\t    struct ext4_prealloc_space *pa)\n{\n\t \n\treturn (loff_t)pa->pa_lstart + EXT4_C2B(sbi, pa->pa_len);\n}\n\ntypedef int (*ext4_mballoc_query_range_fn)(\n\tstruct super_block\t\t*sb,\n\text4_group_t\t\t\tagno,\n\text4_grpblk_t\t\t\tstart,\n\text4_grpblk_t\t\t\tlen,\n\tvoid\t\t\t\t*priv);\n\nint\next4_mballoc_query_range(\n\tstruct super_block\t\t*sb,\n\text4_group_t\t\t\tagno,\n\text4_grpblk_t\t\t\tstart,\n\text4_grpblk_t\t\t\tend,\n\text4_mballoc_query_range_fn\tformatter,\n\tvoid\t\t\t\t*priv);\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}