{
  "module_name": "extents_status.h",
  "hash_id": "4321cc280fa4cbc21b2b54a73bb6f8486b43a9dcae5db49410ce9c4632ed19dc",
  "original_prompt": "Ingested from linux-6.6.14/fs/ext4/extents_status.h",
  "human_readable_source": "\n \n\n#ifndef _EXT4_EXTENTS_STATUS_H\n#define _EXT4_EXTENTS_STATUS_H\n\n \n#ifdef ES_DEBUG__\n#define es_debug(fmt, ...)\tprintk(fmt, ##__VA_ARGS__)\n#else\n#define es_debug(fmt, ...)\tno_printk(fmt, ##__VA_ARGS__)\n#endif\n\n \n#define ES_AGGRESSIVE_TEST__\n\n \nenum {\n\tES_WRITTEN_B,\n\tES_UNWRITTEN_B,\n\tES_DELAYED_B,\n\tES_HOLE_B,\n\tES_REFERENCED_B,\n\tES_FLAGS\n};\n\n#define ES_SHIFT (sizeof(ext4_fsblk_t)*8 - ES_FLAGS)\n#define ES_MASK (~((ext4_fsblk_t)0) << ES_SHIFT)\n\n#define EXTENT_STATUS_WRITTEN\t(1 << ES_WRITTEN_B)\n#define EXTENT_STATUS_UNWRITTEN (1 << ES_UNWRITTEN_B)\n#define EXTENT_STATUS_DELAYED\t(1 << ES_DELAYED_B)\n#define EXTENT_STATUS_HOLE\t(1 << ES_HOLE_B)\n#define EXTENT_STATUS_REFERENCED\t(1 << ES_REFERENCED_B)\n\n#define ES_TYPE_MASK\t((ext4_fsblk_t)(EXTENT_STATUS_WRITTEN | \\\n\t\t\t  EXTENT_STATUS_UNWRITTEN | \\\n\t\t\t  EXTENT_STATUS_DELAYED | \\\n\t\t\t  EXTENT_STATUS_HOLE) << ES_SHIFT)\n\nstruct ext4_sb_info;\nstruct ext4_extent;\n\nstruct extent_status {\n\tstruct rb_node rb_node;\n\text4_lblk_t es_lblk;\t \n\text4_lblk_t es_len;\t \n\text4_fsblk_t es_pblk;\t \n};\n\nstruct ext4_es_tree {\n\tstruct rb_root root;\n\tstruct extent_status *cache_es;\t \n};\n\nstruct ext4_es_stats {\n\tunsigned long es_stats_shrunk;\n\tstruct percpu_counter es_stats_cache_hits;\n\tstruct percpu_counter es_stats_cache_misses;\n\tu64 es_stats_scan_time;\n\tu64 es_stats_max_scan_time;\n\tstruct percpu_counter es_stats_all_cnt;\n\tstruct percpu_counter es_stats_shk_cnt;\n};\n\n \n\nstruct pending_reservation {\n\tstruct rb_node rb_node;\n\text4_lblk_t lclu;\n};\n\nstruct ext4_pending_tree {\n\tstruct rb_root root;\n};\n\nextern int __init ext4_init_es(void);\nextern void ext4_exit_es(void);\nextern void ext4_es_init_tree(struct ext4_es_tree *tree);\n\nextern void ext4_es_insert_extent(struct inode *inode, ext4_lblk_t lblk,\n\t\t\t\t  ext4_lblk_t len, ext4_fsblk_t pblk,\n\t\t\t\t  unsigned int status);\nextern void ext4_es_cache_extent(struct inode *inode, ext4_lblk_t lblk,\n\t\t\t\t ext4_lblk_t len, ext4_fsblk_t pblk,\n\t\t\t\t unsigned int status);\nextern void ext4_es_remove_extent(struct inode *inode, ext4_lblk_t lblk,\n\t\t\t\t  ext4_lblk_t len);\nextern void ext4_es_find_extent_range(struct inode *inode,\n\t\t\t\t      int (*match_fn)(struct extent_status *es),\n\t\t\t\t      ext4_lblk_t lblk, ext4_lblk_t end,\n\t\t\t\t      struct extent_status *es);\nextern int ext4_es_lookup_extent(struct inode *inode, ext4_lblk_t lblk,\n\t\t\t\t ext4_lblk_t *next_lblk,\n\t\t\t\t struct extent_status *es);\nextern bool ext4_es_scan_range(struct inode *inode,\n\t\t\t       int (*matching_fn)(struct extent_status *es),\n\t\t\t       ext4_lblk_t lblk, ext4_lblk_t end);\nextern bool ext4_es_scan_clu(struct inode *inode,\n\t\t\t     int (*matching_fn)(struct extent_status *es),\n\t\t\t     ext4_lblk_t lblk);\n\nstatic inline unsigned int ext4_es_status(struct extent_status *es)\n{\n\treturn es->es_pblk >> ES_SHIFT;\n}\n\nstatic inline unsigned int ext4_es_type(struct extent_status *es)\n{\n\treturn (es->es_pblk & ES_TYPE_MASK) >> ES_SHIFT;\n}\n\nstatic inline int ext4_es_is_written(struct extent_status *es)\n{\n\treturn (ext4_es_type(es) & EXTENT_STATUS_WRITTEN) != 0;\n}\n\nstatic inline int ext4_es_is_unwritten(struct extent_status *es)\n{\n\treturn (ext4_es_type(es) & EXTENT_STATUS_UNWRITTEN) != 0;\n}\n\nstatic inline int ext4_es_is_delayed(struct extent_status *es)\n{\n\treturn (ext4_es_type(es) & EXTENT_STATUS_DELAYED) != 0;\n}\n\nstatic inline int ext4_es_is_hole(struct extent_status *es)\n{\n\treturn (ext4_es_type(es) & EXTENT_STATUS_HOLE) != 0;\n}\n\nstatic inline int ext4_es_is_mapped(struct extent_status *es)\n{\n\treturn (ext4_es_is_written(es) || ext4_es_is_unwritten(es));\n}\n\nstatic inline int ext4_es_is_delonly(struct extent_status *es)\n{\n\treturn (ext4_es_is_delayed(es) && !ext4_es_is_unwritten(es));\n}\n\nstatic inline void ext4_es_set_referenced(struct extent_status *es)\n{\n\tes->es_pblk |= ((ext4_fsblk_t)EXTENT_STATUS_REFERENCED) << ES_SHIFT;\n}\n\nstatic inline void ext4_es_clear_referenced(struct extent_status *es)\n{\n\tes->es_pblk &= ~(((ext4_fsblk_t)EXTENT_STATUS_REFERENCED) << ES_SHIFT);\n}\n\nstatic inline int ext4_es_is_referenced(struct extent_status *es)\n{\n\treturn (ext4_es_status(es) & EXTENT_STATUS_REFERENCED) != 0;\n}\n\nstatic inline ext4_fsblk_t ext4_es_pblock(struct extent_status *es)\n{\n\treturn es->es_pblk & ~ES_MASK;\n}\n\nstatic inline ext4_fsblk_t ext4_es_show_pblock(struct extent_status *es)\n{\n\text4_fsblk_t pblock = ext4_es_pblock(es);\n\treturn pblock == ~ES_MASK ? 0 : pblock;\n}\n\nstatic inline void ext4_es_store_pblock(struct extent_status *es,\n\t\t\t\t\text4_fsblk_t pb)\n{\n\text4_fsblk_t block;\n\n\tblock = (pb & ~ES_MASK) | (es->es_pblk & ES_MASK);\n\tes->es_pblk = block;\n}\n\nstatic inline void ext4_es_store_status(struct extent_status *es,\n\t\t\t\t\tunsigned int status)\n{\n\tes->es_pblk = (((ext4_fsblk_t)status << ES_SHIFT) & ES_MASK) |\n\t\t      (es->es_pblk & ~ES_MASK);\n}\n\nstatic inline void ext4_es_store_pblock_status(struct extent_status *es,\n\t\t\t\t\t       ext4_fsblk_t pb,\n\t\t\t\t\t       unsigned int status)\n{\n\tes->es_pblk = (((ext4_fsblk_t)status << ES_SHIFT) & ES_MASK) |\n\t\t      (pb & ~ES_MASK);\n}\n\nextern int ext4_es_register_shrinker(struct ext4_sb_info *sbi);\nextern void ext4_es_unregister_shrinker(struct ext4_sb_info *sbi);\n\nextern int ext4_seq_es_shrinker_info_show(struct seq_file *seq, void *v);\n\nextern int __init ext4_init_pending(void);\nextern void ext4_exit_pending(void);\nextern void ext4_init_pending_tree(struct ext4_pending_tree *tree);\nextern void ext4_remove_pending(struct inode *inode, ext4_lblk_t lblk);\nextern bool ext4_is_pending(struct inode *inode, ext4_lblk_t lblk);\nextern void ext4_es_insert_delayed_block(struct inode *inode, ext4_lblk_t lblk,\n\t\t\t\t\t bool allocated);\nextern unsigned int ext4_es_delayed_clu(struct inode *inode, ext4_lblk_t lblk,\n\t\t\t\t\text4_lblk_t len);\nextern void ext4_clear_inode_es(struct inode *inode);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}