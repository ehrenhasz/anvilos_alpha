{
  "module_name": "util.h",
  "hash_id": "1d3d01dcd4796ec773aa99f7e4bce3089634d76481181910a299d3132b5278cf",
  "original_prompt": "Ingested from linux-6.6.14/fs/gfs2/util.h",
  "human_readable_source": " \n \n\n#ifndef __UTIL_DOT_H__\n#define __UTIL_DOT_H__\n\n#ifdef pr_fmt\n#undef pr_fmt\n#define pr_fmt(fmt) KBUILD_MODNAME \": \" fmt\n#endif\n\n#include <linux/mempool.h>\n\n#include \"incore.h\"\n\n#define fs_emerg(fs, fmt, ...)\t\t\t\t\t\t\\\n\tpr_emerg(\"fsid=%s: \" fmt, (fs)->sd_fsname, ##__VA_ARGS__)\n#define fs_warn(fs, fmt, ...)\t\t\t\t\t\t\\\n\tpr_warn(\"fsid=%s: \" fmt, (fs)->sd_fsname, ##__VA_ARGS__)\n#define fs_err(fs, fmt, ...)\t\t\t\t\t\t\\\n\tpr_err(\"fsid=%s: \" fmt, (fs)->sd_fsname, ##__VA_ARGS__)\n#define fs_info(fs, fmt, ...)\t\t\t\t\t\t\\\n\tpr_info(\"fsid=%s: \" fmt, (fs)->sd_fsname, ##__VA_ARGS__)\n\nvoid gfs2_assert_i(struct gfs2_sbd *sdp);\n\n#define gfs2_assert(sdp, assertion) \\\ndo { \\\n\tif (unlikely(!(assertion))) { \\\n\t\tgfs2_assert_i(sdp); \\\n\t\tBUG(); \\\n        } \\\n} while (0)\n\n\nvoid gfs2_assert_withdraw_i(struct gfs2_sbd *sdp, char *assertion,\n\t\t\t    const char *function, char *file, unsigned int line,\n\t\t\t    bool delayed);\n\n#define gfs2_assert_withdraw(sdp, assertion) \\\n\t({ \\\n\t\tbool _bool = (assertion); \\\n\t\tif (unlikely(!_bool)) \\\n\t\t\tgfs2_assert_withdraw_i((sdp), #assertion, \\\n\t\t\t\t\t__func__, __FILE__, __LINE__, false); \\\n\t\t!_bool; \\\n\t})\n\n#define gfs2_assert_withdraw_delayed(sdp, assertion) \\\n\t({ \\\n\t\tbool _bool = (assertion); \\\n\t\tif (unlikely(!_bool)) \\\n\t\t\tgfs2_assert_withdraw_i((sdp), #assertion, \\\n\t\t\t\t\t__func__, __FILE__, __LINE__, true); \\\n\t\t!_bool; \\\n\t})\n\nvoid gfs2_assert_warn_i(struct gfs2_sbd *sdp, char *assertion,\n\t\t\tconst char *function, char *file, unsigned int line);\n\n#define gfs2_assert_warn(sdp, assertion) \\\n\t({ \\\n\t\tbool _bool = (assertion); \\\n\t\tif (unlikely(!_bool)) \\\n\t\t\tgfs2_assert_warn_i((sdp), #assertion, \\\n\t\t\t\t\t__func__, __FILE__, __LINE__); \\\n\t\t!_bool; \\\n\t})\n\nvoid gfs2_consist_i(struct gfs2_sbd *sdp,\n\t\t    const char *function, char *file, unsigned int line);\n\n#define gfs2_consist(sdp) \\\ngfs2_consist_i((sdp), __func__, __FILE__, __LINE__)\n\n\nvoid gfs2_consist_inode_i(struct gfs2_inode *ip,\n\t\t\t  const char *function, char *file, unsigned int line);\n\n#define gfs2_consist_inode(ip) \\\ngfs2_consist_inode_i((ip), __func__, __FILE__, __LINE__)\n\n\nvoid gfs2_consist_rgrpd_i(struct gfs2_rgrpd *rgd,\n\t\t\t  const char *function, char *file, unsigned int line);\n\n#define gfs2_consist_rgrpd(rgd) \\\ngfs2_consist_rgrpd_i((rgd), __func__, __FILE__, __LINE__)\n\n\nint gfs2_meta_check_ii(struct gfs2_sbd *sdp, struct buffer_head *bh,\n\t\t       const char *type, const char *function,\n\t\t       char *file, unsigned int line);\n\nstatic inline int gfs2_meta_check(struct gfs2_sbd *sdp,\n\t\t\t\t    struct buffer_head *bh)\n{\n\tstruct gfs2_meta_header *mh = (struct gfs2_meta_header *)bh->b_data;\n\tu32 magic = be32_to_cpu(mh->mh_magic);\n\tif (unlikely(magic != GFS2_MAGIC)) {\n\t\tfs_err(sdp, \"Magic number missing at %llu\\n\",\n\t\t       (unsigned long long)bh->b_blocknr);\n\t\treturn -EIO;\n\t}\n\treturn 0;\n}\n\nint gfs2_metatype_check_ii(struct gfs2_sbd *sdp, struct buffer_head *bh,\n\t\t\t   u16 type, u16 t,\n\t\t\t   const char *function,\n\t\t\t   char *file, unsigned int line);\n\nstatic inline int gfs2_metatype_check_i(struct gfs2_sbd *sdp,\n\t\t\t\t\tstruct buffer_head *bh,\n\t\t\t\t\tu16 type,\n\t\t\t\t\tconst char *function,\n\t\t\t\t\tchar *file, unsigned int line)\n{\n\tstruct gfs2_meta_header *mh = (struct gfs2_meta_header *)bh->b_data;\n\tu32 magic = be32_to_cpu(mh->mh_magic);\n\tu16 t = be32_to_cpu(mh->mh_type);\n\tif (unlikely(magic != GFS2_MAGIC))\n\t\treturn gfs2_meta_check_ii(sdp, bh, \"magic number\", function,\n\t\t\t\t\t  file, line);\n        if (unlikely(t != type))\n\t\treturn gfs2_metatype_check_ii(sdp, bh, type, t, function,\n\t\t\t\t\t      file, line);\n\treturn 0;\n}\n\n#define gfs2_metatype_check(sdp, bh, type) \\\ngfs2_metatype_check_i((sdp), (bh), (type), __func__, __FILE__, __LINE__)\n\nstatic inline void gfs2_metatype_set(struct buffer_head *bh, u16 type,\n\t\t\t\t     u16 format)\n{\n\tstruct gfs2_meta_header *mh;\n\tmh = (struct gfs2_meta_header *)bh->b_data;\n\tmh->mh_type = cpu_to_be32(type);\n\tmh->mh_format = cpu_to_be32(format);\n}\n\n\nint gfs2_io_error_i(struct gfs2_sbd *sdp, const char *function,\n\t\t    char *file, unsigned int line);\n\nextern int check_journal_clean(struct gfs2_sbd *sdp, struct gfs2_jdesc *jd,\n\t\t\t       bool verbose);\nextern int gfs2_freeze_lock_shared(struct gfs2_sbd *sdp);\nextern void gfs2_freeze_unlock(struct gfs2_holder *freeze_gh);\n\n#define gfs2_io_error(sdp) \\\ngfs2_io_error_i((sdp), __func__, __FILE__, __LINE__)\n\n\nvoid gfs2_io_error_bh_i(struct gfs2_sbd *sdp, struct buffer_head *bh,\n\t\t\tconst char *function, char *file, unsigned int line,\n\t\t\tbool withdraw);\n\n#define gfs2_io_error_bh_wd(sdp, bh) \\\ngfs2_io_error_bh_i((sdp), (bh), __func__, __FILE__, __LINE__, true)\n\n#define gfs2_io_error_bh(sdp, bh) \\\ngfs2_io_error_bh_i((sdp), (bh), __func__, __FILE__, __LINE__, false)\n\n\nextern struct kmem_cache *gfs2_glock_cachep;\nextern struct kmem_cache *gfs2_glock_aspace_cachep;\nextern struct kmem_cache *gfs2_inode_cachep;\nextern struct kmem_cache *gfs2_bufdata_cachep;\nextern struct kmem_cache *gfs2_rgrpd_cachep;\nextern struct kmem_cache *gfs2_quotad_cachep;\nextern struct kmem_cache *gfs2_qadata_cachep;\nextern struct kmem_cache *gfs2_trans_cachep;\nextern mempool_t *gfs2_page_pool;\nextern struct workqueue_struct *gfs2_control_wq;\n\nstatic inline unsigned int gfs2_tune_get_i(struct gfs2_tune *gt,\n\t\t\t\t\t   unsigned int *p)\n{\n\tunsigned int x;\n\tspin_lock(&gt->gt_spin);\n\tx = *p;\n\tspin_unlock(&gt->gt_spin);\n\treturn x;\n}\n\n \nstatic inline void gfs2_withdraw_delayed(struct gfs2_sbd *sdp)\n{\n\tset_bit(SDF_WITHDRAWING, &sdp->sd_flags);\n}\n\n \nstatic inline bool gfs2_withdrawn(struct gfs2_sbd *sdp)\n{\n\treturn test_bit(SDF_WITHDRAWN, &sdp->sd_flags) ||\n\t\ttest_bit(SDF_WITHDRAWING, &sdp->sd_flags);\n}\n\n \nstatic inline bool gfs2_withdrawing(struct gfs2_sbd *sdp)\n{\n\treturn test_bit(SDF_WITHDRAWING, &sdp->sd_flags) &&\n\t       !test_bit(SDF_WITHDRAWN, &sdp->sd_flags);\n}\n\nstatic inline bool gfs2_withdraw_in_prog(struct gfs2_sbd *sdp)\n{\n\treturn test_bit(SDF_WITHDRAW_IN_PROG, &sdp->sd_flags);\n}\n\n#define gfs2_tune_get(sdp, field) \\\ngfs2_tune_get_i(&(sdp)->sd_tune, &(sdp)->sd_tune.field)\n\n__printf(2, 3)\nvoid gfs2_lm(struct gfs2_sbd *sdp, const char *fmt, ...);\nint gfs2_withdraw(struct gfs2_sbd *sdp);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}