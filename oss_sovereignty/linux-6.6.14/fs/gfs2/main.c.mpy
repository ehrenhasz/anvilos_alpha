{
  "module_name": "main.c",
  "hash_id": "a64f1746164fba309fab3e953465687996c7177d44ff54d0e0909819a0238e11",
  "original_prompt": "Ingested from linux-6.6.14/fs/gfs2/main.c",
  "human_readable_source": "\n \n\n#define pr_fmt(fmt) KBUILD_MODNAME \": \" fmt\n\n#include <linux/slab.h>\n#include <linux/spinlock.h>\n#include <linux/completion.h>\n#include <linux/buffer_head.h>\n#include <linux/module.h>\n#include <linux/init.h>\n#include <linux/gfs2_ondisk.h>\n#include <linux/rcupdate.h>\n#include <linux/rculist_bl.h>\n#include <linux/atomic.h>\n#include <linux/mempool.h>\n\n#include \"gfs2.h\"\n#include \"incore.h\"\n#include \"super.h\"\n#include \"sys.h\"\n#include \"util.h\"\n#include \"glock.h\"\n#include \"quota.h\"\n#include \"recovery.h\"\n#include \"dir.h\"\n#include \"glops.h\"\n\nstruct workqueue_struct *gfs2_control_wq;\n\nstatic void gfs2_init_inode_once(void *foo)\n{\n\tstruct gfs2_inode *ip = foo;\n\n\tinode_init_once(&ip->i_inode);\n\tatomic_set(&ip->i_sizehint, 0);\n\tinit_rwsem(&ip->i_rw_mutex);\n\tINIT_LIST_HEAD(&ip->i_ordered);\n\tip->i_qadata = NULL;\n\tgfs2_holder_mark_uninitialized(&ip->i_rgd_gh);\n\tmemset(&ip->i_res, 0, sizeof(ip->i_res));\n\tRB_CLEAR_NODE(&ip->i_res.rs_node);\n\tip->i_hash_cache = NULL;\n\tgfs2_holder_mark_uninitialized(&ip->i_iopen_gh);\n}\n\nstatic void gfs2_init_glock_once(void *foo)\n{\n\tstruct gfs2_glock *gl = foo;\n\n\tspin_lock_init(&gl->gl_lockref.lock);\n\tINIT_LIST_HEAD(&gl->gl_holders);\n\tINIT_LIST_HEAD(&gl->gl_lru);\n\tINIT_LIST_HEAD(&gl->gl_ail_list);\n\tatomic_set(&gl->gl_ail_count, 0);\n\tatomic_set(&gl->gl_revokes, 0);\n}\n\nstatic void gfs2_init_gl_aspace_once(void *foo)\n{\n\tstruct gfs2_glock_aspace *gla = foo;\n\n\tgfs2_init_glock_once(&gla->glock);\n\taddress_space_init_once(&gla->mapping);\n}\n\n \n\nstatic int __init init_gfs2_fs(void)\n{\n\tint error;\n\n\tgfs2_str2qstr(&gfs2_qdot, \".\");\n\tgfs2_str2qstr(&gfs2_qdotdot, \"..\");\n\tgfs2_quota_hash_init();\n\n\terror = gfs2_sys_init();\n\tif (error)\n\t\treturn error;\n\n\terror = list_lru_init(&gfs2_qd_lru);\n\tif (error)\n\t\tgoto fail_lru;\n\n\terror = gfs2_glock_init();\n\tif (error)\n\t\tgoto fail_glock;\n\n\terror = -ENOMEM;\n\tgfs2_glock_cachep = kmem_cache_create(\"gfs2_glock\",\n\t\t\t\t\t      sizeof(struct gfs2_glock),\n\t\t\t\t\t      0, SLAB_RECLAIM_ACCOUNT,\n\t\t\t\t\t      gfs2_init_glock_once);\n\tif (!gfs2_glock_cachep)\n\t\tgoto fail_cachep1;\n\n\tgfs2_glock_aspace_cachep = kmem_cache_create(\"gfs2_glock(aspace)\",\n\t\t\t\t\tsizeof(struct gfs2_glock_aspace),\n\t\t\t\t\t0, 0, gfs2_init_gl_aspace_once);\n\n\tif (!gfs2_glock_aspace_cachep)\n\t\tgoto fail_cachep2;\n\n\tgfs2_inode_cachep = kmem_cache_create(\"gfs2_inode\",\n\t\t\t\t\t      sizeof(struct gfs2_inode),\n\t\t\t\t\t      0,  SLAB_RECLAIM_ACCOUNT|\n\t\t\t\t\t\t  SLAB_MEM_SPREAD|\n\t\t\t\t\t\t  SLAB_ACCOUNT,\n\t\t\t\t\t      gfs2_init_inode_once);\n\tif (!gfs2_inode_cachep)\n\t\tgoto fail_cachep3;\n\n\tgfs2_bufdata_cachep = kmem_cache_create(\"gfs2_bufdata\",\n\t\t\t\t\t\tsizeof(struct gfs2_bufdata),\n\t\t\t\t\t        0, 0, NULL);\n\tif (!gfs2_bufdata_cachep)\n\t\tgoto fail_cachep4;\n\n\tgfs2_rgrpd_cachep = kmem_cache_create(\"gfs2_rgrpd\",\n\t\t\t\t\t      sizeof(struct gfs2_rgrpd),\n\t\t\t\t\t      0, 0, NULL);\n\tif (!gfs2_rgrpd_cachep)\n\t\tgoto fail_cachep5;\n\n\tgfs2_quotad_cachep = kmem_cache_create(\"gfs2_quotad\",\n\t\t\t\t\t       sizeof(struct gfs2_quota_data),\n\t\t\t\t\t       0, SLAB_RECLAIM_ACCOUNT, NULL);\n\tif (!gfs2_quotad_cachep)\n\t\tgoto fail_cachep6;\n\n\tgfs2_qadata_cachep = kmem_cache_create(\"gfs2_qadata\",\n\t\t\t\t\t       sizeof(struct gfs2_qadata),\n\t\t\t\t\t       0, 0, NULL);\n\tif (!gfs2_qadata_cachep)\n\t\tgoto fail_cachep7;\n\n\tgfs2_trans_cachep = kmem_cache_create(\"gfs2_trans\",\n\t\t\t\t\t       sizeof(struct gfs2_trans),\n\t\t\t\t\t       0, 0, NULL);\n\tif (!gfs2_trans_cachep)\n\t\tgoto fail_cachep8;\n\n\terror = register_shrinker(&gfs2_qd_shrinker, \"gfs2-qd\");\n\tif (error)\n\t\tgoto fail_shrinker;\n\n\terror = -ENOMEM;\n\tgfs2_recovery_wq = alloc_workqueue(\"gfs2_recovery\",\n\t\t\t\t\t  WQ_MEM_RECLAIM | WQ_FREEZABLE, 0);\n\tif (!gfs2_recovery_wq)\n\t\tgoto fail_wq1;\n\n\tgfs2_control_wq = alloc_workqueue(\"gfs2_control\",\n\t\t\t\t\t  WQ_UNBOUND | WQ_FREEZABLE, 0);\n\tif (!gfs2_control_wq)\n\t\tgoto fail_wq2;\n\n\tgfs2_freeze_wq = alloc_workqueue(\"gfs2_freeze\", 0, 0);\n\n\tif (!gfs2_freeze_wq)\n\t\tgoto fail_wq3;\n\n\tgfs2_page_pool = mempool_create_page_pool(64, 0);\n\tif (!gfs2_page_pool)\n\t\tgoto fail_mempool;\n\n\tgfs2_register_debugfs();\n\terror = register_filesystem(&gfs2_fs_type);\n\tif (error)\n\t\tgoto fail_fs1;\n\n\terror = register_filesystem(&gfs2meta_fs_type);\n\tif (error)\n\t\tgoto fail_fs2;\n\n\n\tpr_info(\"GFS2 installed\\n\");\n\n\treturn 0;\n\nfail_fs2:\n\tunregister_filesystem(&gfs2_fs_type);\nfail_fs1:\n\tmempool_destroy(gfs2_page_pool);\nfail_mempool:\n\tdestroy_workqueue(gfs2_freeze_wq);\nfail_wq3:\n\tdestroy_workqueue(gfs2_control_wq);\nfail_wq2:\n\tdestroy_workqueue(gfs2_recovery_wq);\nfail_wq1:\n\tunregister_shrinker(&gfs2_qd_shrinker);\nfail_shrinker:\n\tkmem_cache_destroy(gfs2_trans_cachep);\nfail_cachep8:\n\tkmem_cache_destroy(gfs2_qadata_cachep);\nfail_cachep7:\n\tkmem_cache_destroy(gfs2_quotad_cachep);\nfail_cachep6:\n\tkmem_cache_destroy(gfs2_rgrpd_cachep);\nfail_cachep5:\n\tkmem_cache_destroy(gfs2_bufdata_cachep);\nfail_cachep4:\n\tkmem_cache_destroy(gfs2_inode_cachep);\nfail_cachep3:\n\tkmem_cache_destroy(gfs2_glock_aspace_cachep);\nfail_cachep2:\n\tkmem_cache_destroy(gfs2_glock_cachep);\nfail_cachep1:\n\tgfs2_glock_exit();\nfail_glock:\n\tlist_lru_destroy(&gfs2_qd_lru);\nfail_lru:\n\tgfs2_sys_uninit();\n\treturn error;\n}\n\n \n\nstatic void __exit exit_gfs2_fs(void)\n{\n\tunregister_shrinker(&gfs2_qd_shrinker);\n\tgfs2_glock_exit();\n\tgfs2_unregister_debugfs();\n\tunregister_filesystem(&gfs2_fs_type);\n\tunregister_filesystem(&gfs2meta_fs_type);\n\tdestroy_workqueue(gfs2_recovery_wq);\n\tdestroy_workqueue(gfs2_control_wq);\n\tdestroy_workqueue(gfs2_freeze_wq);\n\tlist_lru_destroy(&gfs2_qd_lru);\n\n\trcu_barrier();\n\n\tmempool_destroy(gfs2_page_pool);\n\tkmem_cache_destroy(gfs2_trans_cachep);\n\tkmem_cache_destroy(gfs2_qadata_cachep);\n\tkmem_cache_destroy(gfs2_quotad_cachep);\n\tkmem_cache_destroy(gfs2_rgrpd_cachep);\n\tkmem_cache_destroy(gfs2_bufdata_cachep);\n\tkmem_cache_destroy(gfs2_inode_cachep);\n\tkmem_cache_destroy(gfs2_glock_aspace_cachep);\n\tkmem_cache_destroy(gfs2_glock_cachep);\n\n\tgfs2_sys_uninit();\n}\n\nMODULE_DESCRIPTION(\"Global File System\");\nMODULE_AUTHOR(\"Red Hat, Inc.\");\nMODULE_LICENSE(\"GPL\");\n\nmodule_init(init_gfs2_fs);\nmodule_exit(exit_gfs2_fs);\n\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}