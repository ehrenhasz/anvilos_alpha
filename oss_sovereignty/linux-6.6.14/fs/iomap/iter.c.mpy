{
  "module_name": "iter.c",
  "hash_id": "3e76bbc87075237778d266c7f0607ddd943f57b169bd7aa028dceb40ff132b43",
  "original_prompt": "Ingested from linux-6.6.14/fs/iomap/iter.c",
  "human_readable_source": "\n \n#include <linux/fs.h>\n#include <linux/iomap.h>\n#include \"trace.h\"\n\n \nstatic inline int iomap_iter_advance(struct iomap_iter *iter)\n{\n\tbool stale = iter->iomap.flags & IOMAP_F_STALE;\n\n\t \n\tif (iter->iomap.length) {\n\t\tif (iter->processed < 0)\n\t\t\treturn iter->processed;\n\t\tif (!iter->processed && !stale)\n\t\t\treturn 0;\n\t\tif (WARN_ON_ONCE(iter->processed > iomap_length(iter)))\n\t\t\treturn -EIO;\n\t\titer->pos += iter->processed;\n\t\titer->len -= iter->processed;\n\t\tif (!iter->len)\n\t\t\treturn 0;\n\t}\n\n\t \n\titer->processed = 0;\n\tmemset(&iter->iomap, 0, sizeof(iter->iomap));\n\tmemset(&iter->srcmap, 0, sizeof(iter->srcmap));\n\treturn 1;\n}\n\nstatic inline void iomap_iter_done(struct iomap_iter *iter)\n{\n\tWARN_ON_ONCE(iter->iomap.offset > iter->pos);\n\tWARN_ON_ONCE(iter->iomap.length == 0);\n\tWARN_ON_ONCE(iter->iomap.offset + iter->iomap.length <= iter->pos);\n\tWARN_ON_ONCE(iter->iomap.flags & IOMAP_F_STALE);\n\n\ttrace_iomap_iter_dstmap(iter->inode, &iter->iomap);\n\tif (iter->srcmap.type != IOMAP_HOLE)\n\t\ttrace_iomap_iter_srcmap(iter->inode, &iter->srcmap);\n}\n\n \nint iomap_iter(struct iomap_iter *iter, const struct iomap_ops *ops)\n{\n\tint ret;\n\n\tif (iter->iomap.length && ops->iomap_end) {\n\t\tret = ops->iomap_end(iter->inode, iter->pos, iomap_length(iter),\n\t\t\t\titer->processed > 0 ? iter->processed : 0,\n\t\t\t\titer->flags, &iter->iomap);\n\t\tif (ret < 0 && !iter->processed)\n\t\t\treturn ret;\n\t}\n\n\ttrace_iomap_iter(iter, ops, _RET_IP_);\n\tret = iomap_iter_advance(iter);\n\tif (ret <= 0)\n\t\treturn ret;\n\n\tret = ops->iomap_begin(iter->inode, iter->pos, iter->len, iter->flags,\n\t\t\t       &iter->iomap, &iter->srcmap);\n\tif (ret < 0)\n\t\treturn ret;\n\tiomap_iter_done(iter);\n\treturn 1;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}