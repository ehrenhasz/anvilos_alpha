{
  "module_name": "util.c",
  "hash_id": "aec165573fe5df1e36245e7e181fcdecd0398e0a44765913e05ecd550a3b7220",
  "original_prompt": "Ingested from linux-6.6.14/fs/ceph/util.c",
  "human_readable_source": "\n \n#include <linux/module.h>\n#include <linux/ceph/types.h>\n\n \nint ceph_file_layout_is_valid(const struct ceph_file_layout *layout)\n{\n\t__u32 su = layout->stripe_unit;\n\t__u32 sc = layout->stripe_count;\n\t__u32 os = layout->object_size;\n\n\t \n\tif (!su || (su & (CEPH_MIN_STRIPE_UNIT-1)))\n\t\treturn 0;\n\tif (!os || (os & (CEPH_MIN_STRIPE_UNIT-1)))\n\t\treturn 0;\n\t \n\tif (os < su || os % su)\n\t\treturn 0;\n\t \n\tif (!sc)\n\t\treturn 0;\n\treturn 1;\n}\n\nvoid ceph_file_layout_from_legacy(struct ceph_file_layout *fl,\n\t\t\t\t  struct ceph_file_layout_legacy *legacy)\n{\n\tfl->stripe_unit = le32_to_cpu(legacy->fl_stripe_unit);\n\tfl->stripe_count = le32_to_cpu(legacy->fl_stripe_count);\n\tfl->object_size = le32_to_cpu(legacy->fl_object_size);\n\tfl->pool_id = le32_to_cpu(legacy->fl_pg_pool);\n\tif (fl->pool_id == 0 && fl->stripe_unit == 0 &&\n\t    fl->stripe_count == 0 && fl->object_size == 0)\n\t\tfl->pool_id = -1;\n}\n\nvoid ceph_file_layout_to_legacy(struct ceph_file_layout *fl,\n\t\t\t\tstruct ceph_file_layout_legacy *legacy)\n{\n\tlegacy->fl_stripe_unit = cpu_to_le32(fl->stripe_unit);\n\tlegacy->fl_stripe_count = cpu_to_le32(fl->stripe_count);\n\tlegacy->fl_object_size = cpu_to_le32(fl->object_size);\n\tif (fl->pool_id >= 0)\n\t\tlegacy->fl_pg_pool = cpu_to_le32(fl->pool_id);\n\telse\n\t\tlegacy->fl_pg_pool = 0;\n}\n\nint ceph_flags_to_mode(int flags)\n{\n\tint mode;\n\n#ifdef O_DIRECTORY   \n\tif ((flags & O_DIRECTORY) == O_DIRECTORY)\n\t\treturn CEPH_FILE_MODE_PIN;\n#endif\n\n\tswitch (flags & O_ACCMODE) {\n\tcase O_WRONLY:\n\t\tmode = CEPH_FILE_MODE_WR;\n\t\tbreak;\n\tcase O_RDONLY:\n\t\tmode = CEPH_FILE_MODE_RD;\n\t\tbreak;\n\tcase O_RDWR:\n\tcase O_ACCMODE:  \n\t\tmode = CEPH_FILE_MODE_RDWR;\n\t\tbreak;\n\t}\n#ifdef O_LAZY\n\tif (flags & O_LAZY)\n\t\tmode |= CEPH_FILE_MODE_LAZY;\n#endif\n\n\treturn mode;\n}\n\nint ceph_caps_for_mode(int mode)\n{\n\tint caps = CEPH_CAP_PIN;\n\n\tif (mode & CEPH_FILE_MODE_RD)\n\t\tcaps |= CEPH_CAP_FILE_SHARED |\n\t\t\tCEPH_CAP_FILE_RD | CEPH_CAP_FILE_CACHE;\n\tif (mode & CEPH_FILE_MODE_WR)\n\t\tcaps |= CEPH_CAP_FILE_EXCL |\n\t\t\tCEPH_CAP_FILE_WR | CEPH_CAP_FILE_BUFFER |\n\t\t\tCEPH_CAP_AUTH_SHARED | CEPH_CAP_AUTH_EXCL |\n\t\t\tCEPH_CAP_XATTR_SHARED | CEPH_CAP_XATTR_EXCL;\n\tif (mode & CEPH_FILE_MODE_LAZY)\n\t\tcaps |= CEPH_CAP_FILE_LAZYIO;\n\n\treturn caps;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}