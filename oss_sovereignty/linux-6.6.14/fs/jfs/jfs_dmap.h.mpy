{
  "module_name": "jfs_dmap.h",
  "hash_id": "c8138b71d04f6621a0234e466d698f618998826e11c2258a062a3e2ffc85c755",
  "original_prompt": "Ingested from linux-6.6.14/fs/jfs/jfs_dmap.h",
  "human_readable_source": " \n \n#ifndef\t_H_JFS_DMAP\n#define _H_JFS_DMAP\n\n#include \"jfs_txnmgr.h\"\n\n#define BMAPVERSION\t1\t \n#define\tTREESIZE\t(256+64+16+4+1)\t \n#define\tLEAFIND\t\t(64+16+4+1)\t \n#define LPERDMAP\t256\t \n#define L2LPERDMAP\t8\t \n#define\tDBWORD\t\t32\t \n#define\tL2DBWORD\t5\t \n#define BUDMIN\t\tL2DBWORD\t \n#define BPERDMAP\t(LPERDMAP * DBWORD)\t \n#define L2BPERDMAP\t13\t \n#define CTLTREESIZE\t(1024+256+64+16+4+1)\t \n#define CTLLEAFIND\t(256+64+16+4+1)\t \n#define LPERCTL\t\t1024\t \n#define L2LPERCTL\t10\t \n#define\tROOT\t\t0\t \n#define\tNOFREE\t\t((s8) -1)\t \n#define\tMAXAG\t\t128\t \n#define L2MAXAG\t\t7\t \n#define L2MINAGSZ\t25\t \n#define\tBMAPBLKNO\t0\t \n\n \n#define\tL2MAXL0SIZE\t(L2BPERDMAP + 1 * L2LPERCTL)\n#define\tL2MAXL1SIZE\t(L2BPERDMAP + 2 * L2LPERCTL)\n#define\tL2MAXL2SIZE\t(L2BPERDMAP + 3 * L2LPERCTL)\n\n \n#define\tMAXL0SIZE\t((s64)1 << L2MAXL0SIZE)\n#define\tMAXL1SIZE\t((s64)1 << L2MAXL1SIZE)\n#define\tMAXL2SIZE\t((s64)1 << L2MAXL2SIZE)\n\n#define\tMAXMAPSIZE\tMAXL2SIZE\t \n\n \nstatic inline signed char TREEMAX(signed char *cp)\n{\n\tsigned char tmp1, tmp2;\n\n\ttmp1 = max(*(cp+2), *(cp+3));\n\ttmp2 = max(*(cp), *(cp+1));\n\n\treturn max(tmp1, tmp2);\n}\n\n \n#define BLKTODMAP(b,s)    \\\n\t((((b) >> 13) + ((b) >> 23) + ((b) >> 33) + 3 + 1) << (s))\n\n \n#define BLKTOL0(b,s)      \\\n\t(((((b) >> 23) << 10) + ((b) >> 23) + ((b) >> 33) + 2 + 1) << (s))\n\n \n#define BLKTOL1(b,s)      \\\n     (((((b) >> 33) << 20) + (((b) >> 33) << 10) + ((b) >> 33) + 1 + 1) << (s))\n\n \n#define BLKTOCTL(b,s,l)   \\\n\t(((l) == 2) ? 1 : ((l) == 1) ? BLKTOL1((b),(s)) : BLKTOL0((b),(s)))\n\n \n#define\tBMAPSZTOLEV(size)\t\\\n\t(((size) <= MAXL0SIZE) ? 0 : ((size) <= MAXL1SIZE) ? 1 : 2)\n\n \n#define BLKTOAG(b,sbi)\t((b) >> ((sbi)->bmap->db_agl2size))\n\n \n#define AGTOBLK(a,ip)\t\\\n\t((s64)(a) << (JFS_SBI((ip)->i_sb)->bmap->db_agl2size))\n\n \nstruct dmaptree {\n\t__le32 nleafs;\t\t \n\t__le32 l2nleafs;\t \n\t__le32 leafidx;\t\t \n\t__le32 height;\t\t \n\ts8 budmin;\t\t \n\ts8 stree[TREESIZE];\t \n\tu8 pad[2];\t\t \n};\t\t\t\t \n\n \nstruct dmap {\n\t__le32 nblocks;\t\t \n\t__le32 nfree;\t\t \n\t__le64 start;\t\t \n\tstruct dmaptree tree;\t \n\tu8 pad[1672];\t\t \n\t__le32 wmap[LPERDMAP];\t \n\t__le32 pmap[LPERDMAP];\t \n};\t\t\t\t \n\n \nstruct dmapctl {\n\t__le32 nleafs;\t\t \n\t__le32 l2nleafs;\t \n\t__le32 leafidx;\t\t \n\t__le32 height;\t\t \n\ts8 budmin;\t\t \n\ts8 stree[CTLTREESIZE];\t \n\tu8 pad[2714];\t\t \n};\t\t\t\t \n\n \ntypedef union dmtree {\n\tstruct dmaptree t1;\n\tstruct dmapctl t2;\n} dmtree_t;\n\n \n#define\tdmt_nleafs\tt1.nleafs\n#define\tdmt_l2nleafs\tt1.l2nleafs\n#define\tdmt_leafidx\tt1.leafidx\n#define\tdmt_height\tt1.height\n#define\tdmt_budmin\tt1.budmin\n#define\tdmt_stree\tt2.stree\n\n \nstruct dbmap_disk {\n\t__le64 dn_mapsize;\t \n\t__le64 dn_nfree;\t \n\t__le32 dn_l2nbperpage;\t \n\t__le32 dn_numag;\t \n\t__le32 dn_maxlevel;\t \n\t__le32 dn_maxag;\t \n\t__le32 dn_agpref;\t \n\t__le32 dn_aglevel;\t \n\t__le32 dn_agheight;\t \n\t__le32 dn_agwidth;\t \n\t__le32 dn_agstart;\t \n\t__le32 dn_agl2size;\t \n\t__le64 dn_agfree[MAXAG]; \n\t__le64 dn_agsize;\t \n\ts8 dn_maxfreebud;\t \n\tu8 pad[3007];\t\t \n};\t\t\t\t \n\nstruct dbmap {\n\ts64 dn_mapsize;\t\t \n\ts64 dn_nfree;\t\t \n\tint dn_l2nbperpage;\t \n\tint dn_numag;\t\t \n\tint dn_maxlevel;\t \n\tint dn_maxag;\t\t \n\tint dn_agpref;\t\t \n\tint dn_aglevel;\t\t \n\tint dn_agheight;\t \n\tint dn_agwidth;\t\t \n\tint dn_agstart;\t\t \n\tint dn_agl2size;\t \n\ts64 dn_agfree[MAXAG];\t \n\ts64 dn_agsize;\t\t \n\tsigned char dn_maxfreebud;\t \n};\t\t\t\t \n \nstruct bmap {\n\tstruct dbmap db_bmap;\t\t \n\tstruct inode *db_ipbmap;\t \n\tstruct mutex db_bmaplock;\t \n\tatomic_t db_active[MAXAG];\t \n\tu32 *db_DBmap;\n};\n\n \n#define\tdb_mapsize\tdb_bmap.dn_mapsize\n#define\tdb_nfree\tdb_bmap.dn_nfree\n#define\tdb_agfree\tdb_bmap.dn_agfree\n#define\tdb_agsize\tdb_bmap.dn_agsize\n#define\tdb_agl2size\tdb_bmap.dn_agl2size\n#define\tdb_agwidth\tdb_bmap.dn_agwidth\n#define\tdb_agheight\tdb_bmap.dn_agheight\n#define\tdb_agstart\tdb_bmap.dn_agstart\n#define\tdb_numag\tdb_bmap.dn_numag\n#define\tdb_maxlevel\tdb_bmap.dn_maxlevel\n#define\tdb_aglevel\tdb_bmap.dn_aglevel\n#define\tdb_agpref\tdb_bmap.dn_agpref\n#define\tdb_maxag\tdb_bmap.dn_maxag\n#define\tdb_maxfreebud\tdb_bmap.dn_maxfreebud\n#define\tdb_l2nbperpage\tdb_bmap.dn_l2nbperpage\n\n \n \n#define\tBLKSTOL2(d)\t\t(blkstol2(d))\n\n \n#define\tNLSTOL2BSZ(n)\t\t(31 - cntlz((n)) + BUDMIN)\n\n \n#define\tLITOL2BSZ(n,m,b)\t((((n) == 0) ? (m) : cnttz((n))) + (b))\n\n \n#define BLKTOCTLLEAF(b,m)\t\\\n\t(((b) & (((s64)1 << ((m) + L2LPERCTL)) - 1)) >> (m))\n\n \n#define\tBUDSIZE(s,m)\t\t(1 << ((s) - (m)))\n\n \nextern int dbMount(struct inode *ipbmap);\n\nextern int dbUnmount(struct inode *ipbmap, int mounterror);\n\nextern int dbFree(struct inode *ipbmap, s64 blkno, s64 nblocks);\n\nextern int dbUpdatePMap(struct inode *ipbmap,\n\t\t\tint free, s64 blkno, s64 nblocks, struct tblock * tblk);\n\nextern int dbNextAG(struct inode *ipbmap);\n\nextern int dbAlloc(struct inode *ipbmap, s64 hint, s64 nblocks, s64 * results);\n\nextern int dbReAlloc(struct inode *ipbmap,\n\t\t     s64 blkno, s64 nblocks, s64 addnblocks, s64 * results);\n\nextern int dbSync(struct inode *ipbmap);\nextern int dbAllocBottomUp(struct inode *ip, s64 blkno, s64 nblocks);\nextern int dbExtendFS(struct inode *ipbmap, s64 blkno, s64 nblocks);\nextern void dbFinalizeBmap(struct inode *ipbmap);\nextern s64 dbMapFileSizeToMapSize(struct inode *ipbmap);\nextern s64 dbDiscardAG(struct inode *ip, int agno, s64 minlen);\n\n#endif\t\t\t\t \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}