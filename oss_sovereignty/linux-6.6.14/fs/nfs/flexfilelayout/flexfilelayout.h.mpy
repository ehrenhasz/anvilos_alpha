{
  "module_name": "flexfilelayout.h",
  "hash_id": "ec272316ad3ea3518630fb8f0b6830bd61f8970f325e0ac54ce970d0e9553df8",
  "original_prompt": "Ingested from linux-6.6.14/fs/nfs/flexfilelayout/flexfilelayout.h",
  "human_readable_source": " \n \n\n#ifndef FS_NFS_NFS4FLEXFILELAYOUT_H\n#define FS_NFS_NFS4FLEXFILELAYOUT_H\n\n#define FF_FLAGS_NO_LAYOUTCOMMIT 1\n#define FF_FLAGS_NO_IO_THRU_MDS  2\n#define FF_FLAGS_NO_READ_IO      4\n\n#include <linux/refcount.h>\n#include \"../pnfs.h\"\n\n \n#define NFS4_FLEXFILE_LAYOUT_MAX_MIRROR_CNT 4096\n\n \n#define FF_LAYOUTSTATS_REPORT_INTERVAL (60000L)\n#define FF_LAYOUTSTATS_MAXDEV 4\n\nstruct nfs4_ff_ds_version {\n\tu32\t\t\t\tversion;\n\tu32\t\t\t\tminor_version;\n\tu32\t\t\t\trsize;\n\tu32\t\t\t\twsize;\n\tbool\t\t\t\ttightly_coupled;\n};\n\n \nstruct nfs4_ff_layout_ds {\n\tstruct nfs4_deviceid_node\tid_node;\n\tu32\t\t\t\tds_versions_cnt;\n\tstruct nfs4_ff_ds_version\t*ds_versions;\n\tstruct nfs4_pnfs_ds\t\t*ds;\n};\n\nstruct nfs4_ff_layout_ds_err {\n\tstruct list_head\t\tlist;  \n\tu64\t\t\t\toffset;\n\tu64\t\t\t\tlength;\n\tint\t\t\t\tstatus;\n\tenum nfs_opnum4\t\t\topnum;\n\tnfs4_stateid\t\t\tstateid;\n\tstruct nfs4_deviceid\t\tdeviceid;\n};\n\nstruct nfs4_ff_io_stat {\n\t__u64\t\t\t\tops_requested;\n\t__u64\t\t\t\tbytes_requested;\n\t__u64\t\t\t\tops_completed;\n\t__u64\t\t\t\tbytes_completed;\n\t__u64\t\t\t\tbytes_not_delivered;\n\tktime_t\t\t\t\ttotal_busy_time;\n\tktime_t\t\t\t\taggregate_completion_time;\n};\n\nstruct nfs4_ff_busy_timer {\n\tktime_t start_time;\n\tatomic_t n_ops;\n};\n\nstruct nfs4_ff_layoutstat {\n\tstruct nfs4_ff_io_stat io_stat;\n\tstruct nfs4_ff_busy_timer busy_timer;\n};\n\nstruct nfs4_ff_layout_mirror {\n\tstruct pnfs_layout_hdr\t\t*layout;\n\tstruct list_head\t\tmirrors;\n\tu32\t\t\t\tds_count;\n\tu32\t\t\t\tefficiency;\n\tstruct nfs4_deviceid\t\tdevid;\n\tstruct nfs4_ff_layout_ds\t*mirror_ds;\n\tu32\t\t\t\tfh_versions_cnt;\n\tstruct nfs_fh\t\t\t*fh_versions;\n\tnfs4_stateid\t\t\tstateid;\n\tconst struct cred __rcu\t\t*ro_cred;\n\tconst struct cred __rcu\t\t*rw_cred;\n\trefcount_t\t\t\tref;\n\tspinlock_t\t\t\tlock;\n\tunsigned long\t\t\tflags;\n\tstruct nfs4_ff_layoutstat\tread_stat;\n\tstruct nfs4_ff_layoutstat\twrite_stat;\n\tktime_t\t\t\t\tstart_time;\n\tu32\t\t\t\treport_interval;\n};\n\n#define NFS4_FF_MIRROR_STAT_AVAIL\t(0)\n\nstruct nfs4_ff_layout_segment {\n\tstruct pnfs_layout_segment\tgeneric_hdr;\n\tu64\t\t\t\tstripe_unit;\n\tu32\t\t\t\tflags;\n\tu32\t\t\t\tmirror_array_cnt;\n\tstruct nfs4_ff_layout_mirror\t*mirror_array[];\n};\n\nstruct nfs4_flexfile_layout {\n\tstruct pnfs_layout_hdr generic_hdr;\n\tstruct pnfs_ds_commit_info commit_info;\n\tstruct list_head\tmirrors;\n\tstruct list_head\terror_list;  \n\tktime_t\t\t\tlast_report_time;  \n};\n\nstruct nfs4_flexfile_layoutreturn_args {\n\tstruct list_head errors;\n\tstruct nfs42_layoutstat_devinfo devinfo[FF_LAYOUTSTATS_MAXDEV];\n\tunsigned int num_errors;\n\tunsigned int num_dev;\n\tstruct page *pages[1];\n};\n\nstatic inline struct nfs4_flexfile_layout *\nFF_LAYOUT_FROM_HDR(struct pnfs_layout_hdr *lo)\n{\n\treturn container_of(lo, struct nfs4_flexfile_layout, generic_hdr);\n}\n\nstatic inline struct nfs4_ff_layout_segment *\nFF_LAYOUT_LSEG(struct pnfs_layout_segment *lseg)\n{\n\treturn container_of(lseg,\n\t\t\t    struct nfs4_ff_layout_segment,\n\t\t\t    generic_hdr);\n}\n\nstatic inline struct nfs4_ff_layout_ds *\nFF_LAYOUT_MIRROR_DS(struct nfs4_deviceid_node *node)\n{\n\treturn container_of(node, struct nfs4_ff_layout_ds, id_node);\n}\n\nstatic inline struct nfs4_ff_layout_mirror *\nFF_LAYOUT_COMP(struct pnfs_layout_segment *lseg, u32 idx)\n{\n\tstruct nfs4_ff_layout_segment *fls = FF_LAYOUT_LSEG(lseg);\n\n\tif (idx < fls->mirror_array_cnt)\n\t\treturn fls->mirror_array[idx];\n\treturn NULL;\n}\n\nstatic inline struct nfs4_deviceid_node *\nFF_LAYOUT_DEVID_NODE(struct pnfs_layout_segment *lseg, u32 idx)\n{\n\tstruct nfs4_ff_layout_mirror *mirror = FF_LAYOUT_COMP(lseg, idx);\n\n\tif (mirror != NULL) {\n\t\tstruct nfs4_ff_layout_ds *mirror_ds = mirror->mirror_ds;\n\n\t\tif (!IS_ERR_OR_NULL(mirror_ds))\n\t\t\treturn &mirror_ds->id_node;\n\t}\n\treturn NULL;\n}\n\nstatic inline u32\nFF_LAYOUT_MIRROR_COUNT(struct pnfs_layout_segment *lseg)\n{\n\treturn FF_LAYOUT_LSEG(lseg)->mirror_array_cnt;\n}\n\nstatic inline bool\nff_layout_no_fallback_to_mds(struct pnfs_layout_segment *lseg)\n{\n\treturn FF_LAYOUT_LSEG(lseg)->flags & FF_FLAGS_NO_IO_THRU_MDS;\n}\n\nstatic inline bool\nff_layout_no_read_on_rw(struct pnfs_layout_segment *lseg)\n{\n\treturn FF_LAYOUT_LSEG(lseg)->flags & FF_FLAGS_NO_READ_IO;\n}\n\nstatic inline int\nnfs4_ff_layout_ds_version(const struct nfs4_ff_layout_mirror *mirror)\n{\n\treturn mirror->mirror_ds->ds_versions[0].version;\n}\n\nstruct nfs4_ff_layout_ds *\nnfs4_ff_alloc_deviceid_node(struct nfs_server *server, struct pnfs_device *pdev,\n\t\t\t    gfp_t gfp_flags);\nvoid nfs4_ff_layout_put_deviceid(struct nfs4_ff_layout_ds *mirror_ds);\nvoid nfs4_ff_layout_free_deviceid(struct nfs4_ff_layout_ds *mirror_ds);\nint ff_layout_track_ds_error(struct nfs4_flexfile_layout *flo,\n\t\t\t     struct nfs4_ff_layout_mirror *mirror, u64 offset,\n\t\t\t     u64 length, int status, enum nfs_opnum4 opnum,\n\t\t\t     gfp_t gfp_flags);\nvoid ff_layout_send_layouterror(struct pnfs_layout_segment *lseg);\nint ff_layout_encode_ds_ioerr(struct xdr_stream *xdr, const struct list_head *head);\nvoid ff_layout_free_ds_ioerr(struct list_head *head);\nunsigned int ff_layout_fetch_ds_ioerr(struct pnfs_layout_hdr *lo,\n\t\tconst struct pnfs_layout_range *range,\n\t\tstruct list_head *head,\n\t\tunsigned int maxnum);\nstruct nfs_fh *\nnfs4_ff_layout_select_ds_fh(struct nfs4_ff_layout_mirror *mirror);\nvoid\nnfs4_ff_layout_select_ds_stateid(const struct nfs4_ff_layout_mirror *mirror,\n\t\tnfs4_stateid *stateid);\n\nstruct nfs4_pnfs_ds *\nnfs4_ff_layout_prepare_ds(struct pnfs_layout_segment *lseg,\n\t\t\t  struct nfs4_ff_layout_mirror *mirror,\n\t\t\t  bool fail_return);\n\nstruct rpc_clnt *\nnfs4_ff_find_or_create_ds_client(struct nfs4_ff_layout_mirror *mirror,\n\t\t\t\t struct nfs_client *ds_clp,\n\t\t\t\t struct inode *inode);\nconst struct cred *ff_layout_get_ds_cred(struct nfs4_ff_layout_mirror *mirror,\n\t\t\t\t\t const struct pnfs_layout_range *range,\n\t\t\t\t\t const struct cred *mdscred);\nbool ff_layout_avoid_mds_available_ds(struct pnfs_layout_segment *lseg);\nbool ff_layout_avoid_read_on_rw(struct pnfs_layout_segment *lseg);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}