{
  "module_name": "fscache.h",
  "hash_id": "fcd63695ec911030c746784a7fac1678341d3402ad7c4b42b99f7801824c5a64",
  "original_prompt": "Ingested from linux-6.6.14/fs/nfs/fscache.h",
  "human_readable_source": " \n \n\n#ifndef _NFS_FSCACHE_H\n#define _NFS_FSCACHE_H\n\n#include <linux/swap.h>\n#include <linux/nfs_fs.h>\n#include <linux/nfs_mount.h>\n#include <linux/nfs4_mount.h>\n#include <linux/fscache.h>\n#include <linux/iversion.h>\n\n#ifdef CONFIG_NFS_FSCACHE\n\n \nstruct nfs_fscache_inode_auxdata {\n\ts64\tmtime_sec;\n\ts64\tmtime_nsec;\n\ts64\tctime_sec;\n\ts64\tctime_nsec;\n\tu64\tchange_attr;\n};\n\nstruct nfs_netfs_io_data {\n\t \n\trefcount_t\t\t\trefcount;\n\tstruct netfs_io_subrequest\t*sreq;\n\n\t \n\tatomic64_t\ttransferred;\n\tint\t\terror;\n};\n\nstatic inline void nfs_netfs_get(struct nfs_netfs_io_data *netfs)\n{\n\trefcount_inc(&netfs->refcount);\n}\n\nstatic inline void nfs_netfs_put(struct nfs_netfs_io_data *netfs)\n{\n\tssize_t final_len;\n\n\t \n\tif (!refcount_dec_and_test(&netfs->refcount))\n\t\treturn;\n\n\t \n\tfinal_len = min_t(s64, netfs->sreq->len, atomic64_read(&netfs->transferred));\n\tnetfs_subreq_terminated(netfs->sreq, netfs->error ?: final_len, false);\n\tkfree(netfs);\n}\nstatic inline void nfs_netfs_inode_init(struct nfs_inode *nfsi)\n{\n\tnetfs_inode_init(&nfsi->netfs, &nfs_netfs_ops);\n}\nextern void nfs_netfs_initiate_read(struct nfs_pgio_header *hdr);\nextern void nfs_netfs_read_completion(struct nfs_pgio_header *hdr);\nextern int nfs_netfs_folio_unlock(struct folio *folio);\n\n \nextern int nfs_fscache_get_super_cookie(struct super_block *, const char *, int);\nextern void nfs_fscache_release_super_cookie(struct super_block *);\n\nextern void nfs_fscache_init_inode(struct inode *);\nextern void nfs_fscache_clear_inode(struct inode *);\nextern void nfs_fscache_open_file(struct inode *, struct file *);\nextern void nfs_fscache_release_file(struct inode *, struct file *);\nextern int nfs_netfs_readahead(struct readahead_control *ractl);\nextern int nfs_netfs_read_folio(struct file *file, struct folio *folio);\n\nstatic inline bool nfs_fscache_release_folio(struct folio *folio, gfp_t gfp)\n{\n\tif (folio_test_fscache(folio)) {\n\t\tif (current_is_kswapd() || !(gfp & __GFP_FS))\n\t\t\treturn false;\n\t\tfolio_wait_fscache(folio);\n\t}\n\tfscache_note_page_release(netfs_i_cookie(netfs_inode(folio->mapping->host)));\n\treturn true;\n}\n\nstatic inline void nfs_fscache_update_auxdata(struct nfs_fscache_inode_auxdata *auxdata,\n\t\t\t\t\t      struct inode *inode)\n{\n\tmemset(auxdata, 0, sizeof(*auxdata));\n\tauxdata->mtime_sec  = inode->i_mtime.tv_sec;\n\tauxdata->mtime_nsec = inode->i_mtime.tv_nsec;\n\tauxdata->ctime_sec  = inode_get_ctime(inode).tv_sec;\n\tauxdata->ctime_nsec = inode_get_ctime(inode).tv_nsec;\n\n\tif (NFS_SERVER(inode)->nfs_client->rpc_ops->version == 4)\n\t\tauxdata->change_attr = inode_peek_iversion_raw(inode);\n}\n\n \nstatic inline void nfs_fscache_invalidate(struct inode *inode, int flags)\n{\n\tstruct nfs_fscache_inode_auxdata auxdata;\n\tstruct fscache_cookie *cookie =  netfs_i_cookie(&NFS_I(inode)->netfs);\n\n\tnfs_fscache_update_auxdata(&auxdata, inode);\n\tfscache_invalidate(cookie, &auxdata, i_size_read(inode), flags);\n}\n\n \nstatic inline const char *nfs_server_fscache_state(struct nfs_server *server)\n{\n\tif (server->fscache)\n\t\treturn \"yes\";\n\treturn \"no \";\n}\n\nstatic inline void nfs_netfs_set_pgio_header(struct nfs_pgio_header *hdr,\n\t\t\t\t\t     struct nfs_pageio_descriptor *desc)\n{\n\thdr->netfs = desc->pg_netfs;\n}\nstatic inline void nfs_netfs_set_pageio_descriptor(struct nfs_pageio_descriptor *desc,\n\t\t\t\t\t\t   struct nfs_pgio_header *hdr)\n{\n\tdesc->pg_netfs = hdr->netfs;\n}\nstatic inline void nfs_netfs_reset_pageio_descriptor(struct nfs_pageio_descriptor *desc)\n{\n\tdesc->pg_netfs = NULL;\n}\n#else  \nstatic inline void nfs_netfs_inode_init(struct nfs_inode *nfsi) {}\nstatic inline void nfs_netfs_initiate_read(struct nfs_pgio_header *hdr) {}\nstatic inline void nfs_netfs_read_completion(struct nfs_pgio_header *hdr) {}\nstatic inline int nfs_netfs_folio_unlock(struct folio *folio)\n{\n\treturn 1;\n}\nstatic inline void nfs_fscache_release_super_cookie(struct super_block *sb) {}\n\nstatic inline void nfs_fscache_init_inode(struct inode *inode) {}\nstatic inline void nfs_fscache_clear_inode(struct inode *inode) {}\nstatic inline void nfs_fscache_open_file(struct inode *inode,\n\t\t\t\t\t struct file *filp) {}\nstatic inline void nfs_fscache_release_file(struct inode *inode, struct file *file) {}\nstatic inline int nfs_netfs_readahead(struct readahead_control *ractl)\n{\n\treturn -ENOBUFS;\n}\nstatic inline int nfs_netfs_read_folio(struct file *file, struct folio *folio)\n{\n\treturn -ENOBUFS;\n}\n\nstatic inline bool nfs_fscache_release_folio(struct folio *folio, gfp_t gfp)\n{\n\treturn true;  \n}\nstatic inline void nfs_fscache_invalidate(struct inode *inode, int flags) {}\n\nstatic inline const char *nfs_server_fscache_state(struct nfs_server *server)\n{\n\treturn \"no \";\n}\nstatic inline void nfs_netfs_set_pgio_header(struct nfs_pgio_header *hdr,\n\t\t\t\t\t     struct nfs_pageio_descriptor *desc) {}\nstatic inline void nfs_netfs_set_pageio_descriptor(struct nfs_pageio_descriptor *desc,\n\t\t\t\t\t\t   struct nfs_pgio_header *hdr) {}\nstatic inline void nfs_netfs_reset_pageio_descriptor(struct nfs_pageio_descriptor *desc) {}\n#endif  \n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}