{
  "module_name": "nfs3client.c",
  "hash_id": "4e48f1e27f2c31f28d82f34b3645e7a0b65f41f8c3e21f5e8a41ac60af73300f",
  "original_prompt": "Ingested from linux-6.6.14/fs/nfs/nfs3client.c",
  "human_readable_source": "\n#include <linux/nfs_fs.h>\n#include <linux/nfs_mount.h>\n#include <linux/sunrpc/addr.h>\n#include \"internal.h\"\n#include \"nfs3_fs.h\"\n#include \"netns.h\"\n#include \"sysfs.h\"\n\n#ifdef CONFIG_NFS_V3_ACL\nstatic struct rpc_stat\t\tnfsacl_rpcstat = { &nfsacl_program };\nstatic const struct rpc_version *nfsacl_version[] = {\n\t[3]\t\t\t= &nfsacl_version3,\n};\n\nconst struct rpc_program nfsacl_program = {\n\t.name\t\t\t= \"nfsacl\",\n\t.number\t\t\t= NFS_ACL_PROGRAM,\n\t.nrvers\t\t\t= ARRAY_SIZE(nfsacl_version),\n\t.version\t\t= nfsacl_version,\n\t.stats\t\t\t= &nfsacl_rpcstat,\n};\n\n \nstatic void nfs_init_server_aclclient(struct nfs_server *server)\n{\n\tif (server->flags & NFS_MOUNT_NOACL)\n\t\tgoto out_noacl;\n\n\tserver->client_acl = rpc_bind_new_program(server->client, &nfsacl_program, 3);\n\tif (IS_ERR(server->client_acl))\n\t\tgoto out_noacl;\n\n\tnfs_sysfs_link_rpc_client(server, server->client_acl, NULL);\n\n\t \n\tserver->caps |= NFS_CAP_ACLS;\n\treturn;\n\nout_noacl:\n\tserver->caps &= ~NFS_CAP_ACLS;\n}\n#else\nstatic inline void nfs_init_server_aclclient(struct nfs_server *server)\n{\n\tserver->flags &= ~NFS_MOUNT_NOACL;\n\tserver->caps &= ~NFS_CAP_ACLS;\n}\n#endif\n\nstruct nfs_server *nfs3_create_server(struct fs_context *fc)\n{\n\tstruct nfs_server *server = nfs_create_server(fc);\n\n\t \n\tif (!IS_ERR(server))\n\t\tnfs_init_server_aclclient(server);\n\treturn server;\n}\n\nstruct nfs_server *nfs3_clone_server(struct nfs_server *source,\n\t\t\t\t     struct nfs_fh *fh,\n\t\t\t\t     struct nfs_fattr *fattr,\n\t\t\t\t     rpc_authflavor_t flavor)\n{\n\tstruct nfs_server *server = nfs_clone_server(source, fh, fattr, flavor);\n\tif (!IS_ERR(server) && !IS_ERR(source->client_acl))\n\t\tnfs_init_server_aclclient(server);\n\treturn server;\n}\n\n \nstruct nfs_client *nfs3_set_ds_client(struct nfs_server *mds_srv,\n\t\tconst struct sockaddr_storage *ds_addr, int ds_addrlen,\n\t\tint ds_proto, unsigned int ds_timeo, unsigned int ds_retrans)\n{\n\tstruct rpc_timeout ds_timeout;\n\tunsigned long connect_timeout = ds_timeo * (ds_retrans + 1) * HZ / 10;\n\tstruct nfs_client *mds_clp = mds_srv->nfs_client;\n\tstruct nfs_client_initdata cl_init = {\n\t\t.addr = ds_addr,\n\t\t.addrlen = ds_addrlen,\n\t\t.nodename = mds_clp->cl_rpcclient->cl_nodename,\n\t\t.ip_addr = mds_clp->cl_ipaddr,\n\t\t.nfs_mod = &nfs_v3,\n\t\t.proto = ds_proto,\n\t\t.net = mds_clp->cl_net,\n\t\t.timeparms = &ds_timeout,\n\t\t.cred = mds_srv->cred,\n\t\t.xprtsec = mds_clp->cl_xprtsec,\n\t\t.connect_timeout = connect_timeout,\n\t\t.reconnect_timeout = connect_timeout,\n\t};\n\tstruct nfs_client *clp;\n\tchar buf[INET6_ADDRSTRLEN + 1];\n\n\t \n\tif (rpc_ntop((struct sockaddr *)ds_addr, buf, sizeof(buf)) <= 0)\n\t\treturn ERR_PTR(-EINVAL);\n\tcl_init.hostname = buf;\n\n\tswitch (ds_proto) {\n\tcase XPRT_TRANSPORT_TCP:\n\tcase XPRT_TRANSPORT_TCP_TLS:\n\t\tif (mds_clp->cl_nconnect > 1)\n\t\t\tcl_init.nconnect = mds_clp->cl_nconnect;\n\t}\n\n\tif (mds_srv->flags & NFS_MOUNT_NORESVPORT)\n\t\t__set_bit(NFS_CS_NORESVPORT, &cl_init.init_flags);\n\n\t__set_bit(NFS_CS_DS, &cl_init.init_flags);\n\n\t \n\tnfs_init_timeout_values(&ds_timeout, ds_proto, ds_timeo, ds_retrans);\n\tclp = nfs_get_client(&cl_init);\n\n\treturn clp;\n}\nEXPORT_SYMBOL_GPL(nfs3_set_ds_client);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}