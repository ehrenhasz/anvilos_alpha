{
  "module_name": "io.c",
  "hash_id": "40cb32ec906e77edcf6c778e1d5bc7b40633464d3ee246929cbf848ec1ef2e5f",
  "original_prompt": "Ingested from linux-6.6.14/fs/nfs/io.c",
  "human_readable_source": "\n \n\n#include <linux/types.h>\n#include <linux/kernel.h>\n#include <linux/bitops.h>\n#include <linux/rwsem.h>\n#include <linux/fs.h>\n#include <linux/nfs_fs.h>\n\n#include \"internal.h\"\n\n \nstatic void nfs_block_o_direct(struct nfs_inode *nfsi, struct inode *inode)\n{\n\tif (test_bit(NFS_INO_ODIRECT, &nfsi->flags)) {\n\t\tclear_bit(NFS_INO_ODIRECT, &nfsi->flags);\n\t\tinode_dio_wait(inode);\n\t}\n}\n\n \nvoid\nnfs_start_io_read(struct inode *inode)\n{\n\tstruct nfs_inode *nfsi = NFS_I(inode);\n\t \n\tdown_read(&inode->i_rwsem);\n\tif (test_bit(NFS_INO_ODIRECT, &nfsi->flags) == 0)\n\t\treturn;\n\tup_read(&inode->i_rwsem);\n\t \n\tdown_write(&inode->i_rwsem);\n\tnfs_block_o_direct(nfsi, inode);\n\tdowngrade_write(&inode->i_rwsem);\n}\n\n \nvoid\nnfs_end_io_read(struct inode *inode)\n{\n\tup_read(&inode->i_rwsem);\n}\n\n \nvoid\nnfs_start_io_write(struct inode *inode)\n{\n\tdown_write(&inode->i_rwsem);\n\tnfs_block_o_direct(NFS_I(inode), inode);\n}\n\n \nvoid\nnfs_end_io_write(struct inode *inode)\n{\n\tup_write(&inode->i_rwsem);\n}\n\n \nstatic void nfs_block_buffered(struct nfs_inode *nfsi, struct inode *inode)\n{\n\tif (!test_bit(NFS_INO_ODIRECT, &nfsi->flags)) {\n\t\tset_bit(NFS_INO_ODIRECT, &nfsi->flags);\n\t\tnfs_sync_mapping(inode->i_mapping);\n\t}\n}\n\n \nvoid\nnfs_start_io_direct(struct inode *inode)\n{\n\tstruct nfs_inode *nfsi = NFS_I(inode);\n\t \n\tdown_read(&inode->i_rwsem);\n\tif (test_bit(NFS_INO_ODIRECT, &nfsi->flags) != 0)\n\t\treturn;\n\tup_read(&inode->i_rwsem);\n\t \n\tdown_write(&inode->i_rwsem);\n\tnfs_block_buffered(nfsi, inode);\n\tdowngrade_write(&inode->i_rwsem);\n}\n\n \nvoid\nnfs_end_io_direct(struct inode *inode)\n{\n\tup_read(&inode->i_rwsem);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}