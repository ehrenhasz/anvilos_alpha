{
  "module_name": "blocklayout.h",
  "hash_id": "5c5d288451ae90efe6a00090d4fbab0019f87b503a5eb8b7b3bad26197dbc539",
  "original_prompt": "Ingested from linux-6.6.14/fs/nfs/blocklayout/blocklayout.h",
  "human_readable_source": " \n#ifndef FS_NFS_NFS4BLOCKLAYOUT_H\n#define FS_NFS_NFS4BLOCKLAYOUT_H\n\n#include <linux/device-mapper.h>\n#include <linux/nfs_fs.h>\n#include <linux/sunrpc/rpc_pipe_fs.h>\n\n#include \"../nfs4_fs.h\"\n#include \"../pnfs.h\"\n#include \"../netns.h\"\n\n#define PAGE_CACHE_SECTORS (PAGE_SIZE >> SECTOR_SHIFT)\n#define PAGE_CACHE_SECTOR_SHIFT (PAGE_SHIFT - SECTOR_SHIFT)\n#define SECTOR_SIZE (1 << SECTOR_SHIFT)\n\nstruct pnfs_block_dev;\n\n#define PNFS_BLOCK_MAX_UUIDS\t4\n#define PNFS_BLOCK_MAX_DEVICES\t64\n\n \n#define PNFS_BLOCK_UUID_LEN\t128\n\nstruct pnfs_block_volume {\n\tenum pnfs_block_volume_type\ttype;\n\tunion {\n\t\tstruct {\n\t\t\tint\t\tlen;\n\t\t\tint\t\tnr_sigs;\n\t\t\tstruct {\n\t\t\t\tu64\t\toffset;\n\t\t\t\tu32\t\tsig_len;\n\t\t\t\tu8\t\tsig[PNFS_BLOCK_UUID_LEN];\n\t\t\t} sigs[PNFS_BLOCK_MAX_UUIDS];\n\t\t} simple;\n\t\tstruct {\n\t\t\tu64\t\tstart;\n\t\t\tu64\t\tlen;\n\t\t\tu32\t\tvolume;\n\t\t} slice;\n\t\tstruct {\n\t\t\tu32\t\tvolumes_count;\n\t\t\tu32\t\tvolumes[PNFS_BLOCK_MAX_DEVICES];\n\t\t} concat;\n\t\tstruct {\n\t\t\tu64\t\tchunk_size;\n\t\t\tu32\t\tvolumes_count;\n\t\t\tu32\t\tvolumes[PNFS_BLOCK_MAX_DEVICES];\n\t\t} stripe;\n\t\tstruct {\n\t\t\tenum scsi_code_set\t\tcode_set;\n\t\t\tenum scsi_designator_type\tdesignator_type;\n\t\t\tint\t\t\t\tdesignator_len;\n\t\t\tu8\t\t\t\tdesignator[256];\n\t\t\tu64\t\t\t\tpr_key;\n\t\t} scsi;\n\t};\n};\n\nstruct pnfs_block_dev_map {\n\tu64\t\t\tstart;\n\tu64\t\t\tlen;\n\tu64\t\t\tdisk_offset;\n\tstruct block_device\t\t*bdev;\n};\n\nstruct pnfs_block_dev {\n\tstruct nfs4_deviceid_node\tnode;\n\n\tu64\t\t\t\tstart;\n\tu64\t\t\t\tlen;\n\n\tu32\t\t\t\tnr_children;\n\tstruct pnfs_block_dev\t\t*children;\n\tu64\t\t\t\tchunk_size;\n\n\tstruct block_device\t\t*bdev;\n\tu64\t\t\t\tdisk_offset;\n\n\tu64\t\t\t\tpr_key;\n\tbool\t\t\t\tpr_registered;\n\n\tbool (*map)(struct pnfs_block_dev *dev, u64 offset,\n\t\t\tstruct pnfs_block_dev_map *map);\n};\n\n \nstruct pnfs_block_extent {\n\tunion {\n\t\tstruct rb_node\tbe_node;\n\t\tstruct list_head be_list;\n\t};\n\tstruct nfs4_deviceid_node *be_device;\n\tsector_t\tbe_f_offset;\t \n\tsector_t\tbe_length;\t \n\tsector_t\tbe_v_offset;\t \n\tenum pnfs_block_extent_state be_state;\t \n#define EXTENT_WRITTEN\t\t1\n#define EXTENT_COMMITTING\t2\n\tunsigned int\tbe_tag;\n};\n\nstruct pnfs_block_layout {\n\tstruct pnfs_layout_hdr\tbl_layout;\n\tstruct rb_root\t\tbl_ext_rw;\n\tstruct rb_root\t\tbl_ext_ro;\n\tspinlock_t\t\tbl_ext_lock;    \n\tbool\t\t\tbl_scsi_layout;\n\tu64\t\t\tbl_lwb;\n};\n\nstatic inline struct pnfs_block_layout *\nBLK_LO2EXT(struct pnfs_layout_hdr *lo)\n{\n\treturn container_of(lo, struct pnfs_block_layout, bl_layout);\n}\n\nstatic inline struct pnfs_block_layout *\nBLK_LSEG2EXT(struct pnfs_layout_segment *lseg)\n{\n\treturn BLK_LO2EXT(lseg->pls_layout);\n}\n\nstruct bl_pipe_msg {\n\tstruct rpc_pipe_msg msg;\n\twait_queue_head_t *bl_wq;\n};\n\nstruct bl_msg_hdr {\n\tu8  type;\n\tu16 totallen;  \n};\n\n#define BL_DEVICE_UMOUNT               0x0  \n#define BL_DEVICE_MOUNT                0x1  \n#define BL_DEVICE_REQUEST_INIT         0x0  \n#define BL_DEVICE_REQUEST_PROC         0x1  \n#define BL_DEVICE_REQUEST_ERR          0x2  \n\n \nstruct nfs4_deviceid_node *bl_alloc_deviceid_node(struct nfs_server *server,\n\t\tstruct pnfs_device *pdev, gfp_t gfp_mask);\nvoid bl_free_deviceid_node(struct nfs4_deviceid_node *d);\n\n \nint ext_tree_insert(struct pnfs_block_layout *bl,\n\t\tstruct pnfs_block_extent *new);\nint ext_tree_remove(struct pnfs_block_layout *bl, bool rw, sector_t start,\n\t\tsector_t end);\nint ext_tree_mark_written(struct pnfs_block_layout *bl, sector_t start,\n\t\tsector_t len, u64 lwb);\nbool ext_tree_lookup(struct pnfs_block_layout *bl, sector_t isect,\n\t\tstruct pnfs_block_extent *ret, bool rw);\nint ext_tree_prepare_commit(struct nfs4_layoutcommit_args *arg);\nvoid ext_tree_mark_committed(struct nfs4_layoutcommit_args *arg, int status);\n\n \ndev_t bl_resolve_deviceid(struct nfs_server *server,\n\t\tstruct pnfs_block_volume *b, gfp_t gfp_mask);\nint __init bl_init_pipefs(void);\nvoid bl_cleanup_pipefs(void);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}