{
  "module_name": "stats.c",
  "hash_id": "8f4d4a8cc9c08c3993027e7042476f8c415e4649cfc9a7bc2cd8fb342e23b51d",
  "original_prompt": "Ingested from linux-6.6.14/fs/nfsd/stats.c",
  "human_readable_source": "\n \n\n#include <linux/seq_file.h>\n#include <linux/module.h>\n#include <linux/sunrpc/stats.h>\n#include <net/net_namespace.h>\n\n#include \"nfsd.h\"\n\nstruct nfsd_stats\tnfsdstats;\nstruct svc_stat\t\tnfsd_svcstats = {\n\t.program\t= &nfsd_program,\n};\n\nstatic int nfsd_show(struct seq_file *seq, void *v)\n{\n\tint i;\n\n\tseq_printf(seq, \"rc %lld %lld %lld\\nfh %lld 0 0 0 0\\nio %lld %lld\\n\",\n\t\t   percpu_counter_sum_positive(&nfsdstats.counter[NFSD_STATS_RC_HITS]),\n\t\t   percpu_counter_sum_positive(&nfsdstats.counter[NFSD_STATS_RC_MISSES]),\n\t\t   percpu_counter_sum_positive(&nfsdstats.counter[NFSD_STATS_RC_NOCACHE]),\n\t\t   percpu_counter_sum_positive(&nfsdstats.counter[NFSD_STATS_FH_STALE]),\n\t\t   percpu_counter_sum_positive(&nfsdstats.counter[NFSD_STATS_IO_READ]),\n\t\t   percpu_counter_sum_positive(&nfsdstats.counter[NFSD_STATS_IO_WRITE]));\n\n\t \n\tseq_printf(seq, \"th %u 0\", atomic_read(&nfsdstats.th_cnt));\n\n\t \n\tfor (i = 0; i < 10; i++)\n\t\tseq_puts(seq, \" 0.000\");\n\n\t \n\tseq_puts(seq, \"\\nra 0 0 0 0 0 0 0 0 0 0 0 0\\n\");\n\n\t \n\tsvc_seq_show(seq, &nfsd_svcstats);\n\n#ifdef CONFIG_NFSD_V4\n\t \n\t \n\tseq_printf(seq,\"proc4ops %u\", LAST_NFS4_OP + 1);\n\tfor (i = 0; i <= LAST_NFS4_OP; i++) {\n\t\tseq_printf(seq, \" %lld\",\n\t\t\t   percpu_counter_sum_positive(&nfsdstats.counter[NFSD_STATS_NFS4_OP(i)]));\n\t}\n\tseq_printf(seq, \"\\nwdeleg_getattr %lld\",\n\t\tpercpu_counter_sum_positive(&nfsdstats.counter[NFSD_STATS_WDELEG_GETATTR]));\n\n\tseq_putc(seq, '\\n');\n#endif\n\n\treturn 0;\n}\n\nDEFINE_PROC_SHOW_ATTRIBUTE(nfsd);\n\nint nfsd_percpu_counters_init(struct percpu_counter counters[], int num)\n{\n\tint i, err = 0;\n\n\tfor (i = 0; !err && i < num; i++)\n\t\terr = percpu_counter_init(&counters[i], 0, GFP_KERNEL);\n\n\tif (!err)\n\t\treturn 0;\n\n\tfor (; i > 0; i--)\n\t\tpercpu_counter_destroy(&counters[i-1]);\n\n\treturn err;\n}\n\nvoid nfsd_percpu_counters_reset(struct percpu_counter counters[], int num)\n{\n\tint i;\n\n\tfor (i = 0; i < num; i++)\n\t\tpercpu_counter_set(&counters[i], 0);\n}\n\nvoid nfsd_percpu_counters_destroy(struct percpu_counter counters[], int num)\n{\n\tint i;\n\n\tfor (i = 0; i < num; i++)\n\t\tpercpu_counter_destroy(&counters[i]);\n}\n\nstatic int nfsd_stat_counters_init(void)\n{\n\treturn nfsd_percpu_counters_init(nfsdstats.counter, NFSD_STATS_COUNTERS_NUM);\n}\n\nstatic void nfsd_stat_counters_destroy(void)\n{\n\tnfsd_percpu_counters_destroy(nfsdstats.counter, NFSD_STATS_COUNTERS_NUM);\n}\n\nint nfsd_stat_init(void)\n{\n\tint err;\n\n\terr = nfsd_stat_counters_init();\n\tif (err)\n\t\treturn err;\n\n\tsvc_proc_register(&init_net, &nfsd_svcstats, &nfsd_proc_ops);\n\n\treturn 0;\n}\n\nvoid nfsd_stat_shutdown(void)\n{\n\tnfsd_stat_counters_destroy();\n\tsvc_proc_unregister(&init_net, \"nfsd\");\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}