{
  "module_name": "usnjrnl.c",
  "hash_id": "ce81cdce2e5e81c56adce0b28287a9cdf394bb0197c6d80ac0bb922735ca9ced",
  "original_prompt": "Ingested from linux-6.6.14/fs/ntfs/usnjrnl.c",
  "human_readable_source": "\n \n\n#ifdef NTFS_RW\n\n#include <linux/fs.h>\n#include <linux/highmem.h>\n#include <linux/mm.h>\n\n#include \"aops.h\"\n#include \"debug.h\"\n#include \"endian.h\"\n#include \"time.h\"\n#include \"types.h\"\n#include \"usnjrnl.h\"\n#include \"volume.h\"\n\n \nbool ntfs_stamp_usnjrnl(ntfs_volume *vol)\n{\n\tntfs_debug(\"Entering.\");\n\tif (likely(!NVolUsnJrnlStamped(vol))) {\n\t\tsle64 stamp;\n\t\tstruct page *page;\n\t\tUSN_HEADER *uh;\n\n\t\tpage = ntfs_map_page(vol->usnjrnl_max_ino->i_mapping, 0);\n\t\tif (IS_ERR(page)) {\n\t\t\tntfs_error(vol->sb, \"Failed to read from \"\n\t\t\t\t\t\"$UsnJrnl/$DATA/$Max attribute.\");\n\t\t\treturn false;\n\t\t}\n\t\tuh = (USN_HEADER*)page_address(page);\n\t\tstamp = get_current_ntfs_time();\n\t\tntfs_debug(\"Stamping transaction log ($UsnJrnl): old \"\n\t\t\t\t\"journal_id 0x%llx, old lowest_valid_usn \"\n\t\t\t\t\"0x%llx, new journal_id 0x%llx, new \"\n\t\t\t\t\"lowest_valid_usn 0x%llx.\",\n\t\t\t\t(long long)sle64_to_cpu(uh->journal_id),\n\t\t\t\t(long long)sle64_to_cpu(uh->lowest_valid_usn),\n\t\t\t\t(long long)sle64_to_cpu(stamp),\n\t\t\t\ti_size_read(vol->usnjrnl_j_ino));\n\t\tuh->lowest_valid_usn =\n\t\t\t\tcpu_to_sle64(i_size_read(vol->usnjrnl_j_ino));\n\t\tuh->journal_id = stamp;\n\t\tflush_dcache_page(page);\n\t\tset_page_dirty(page);\n\t\tntfs_unmap_page(page);\n\t\t \n\t\tNVolSetUsnJrnlStamped(vol);\n\t}\n\tntfs_debug(\"Done.\");\n\treturn true;\n}\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}