{
  "module_name": "quota.c",
  "hash_id": "6d80b7bb126cdf7a03ee8410536086287dfbee7c07369e1ad849d2fba165cb99",
  "original_prompt": "Ingested from linux-6.6.14/fs/ntfs/quota.c",
  "human_readable_source": "\n \n\n#ifdef NTFS_RW\n\n#include \"index.h\"\n#include \"quota.h\"\n#include \"debug.h\"\n#include \"ntfs.h\"\n\n \nbool ntfs_mark_quotas_out_of_date(ntfs_volume *vol)\n{\n\tntfs_index_context *ictx;\n\tQUOTA_CONTROL_ENTRY *qce;\n\tconst le32 qid = QUOTA_DEFAULTS_ID;\n\tint err;\n\n\tntfs_debug(\"Entering.\");\n\tif (NVolQuotaOutOfDate(vol))\n\t\tgoto done;\n\tif (!vol->quota_ino || !vol->quota_q_ino) {\n\t\tntfs_error(vol->sb, \"Quota inodes are not open.\");\n\t\treturn false;\n\t}\n\tinode_lock(vol->quota_q_ino);\n\tictx = ntfs_index_ctx_get(NTFS_I(vol->quota_q_ino));\n\tif (!ictx) {\n\t\tntfs_error(vol->sb, \"Failed to get index context.\");\n\t\tgoto err_out;\n\t}\n\terr = ntfs_index_lookup(&qid, sizeof(qid), ictx);\n\tif (err) {\n\t\tif (err == -ENOENT)\n\t\t\tntfs_error(vol->sb, \"Quota defaults entry is not \"\n\t\t\t\t\t\"present.\");\n\t\telse\n\t\t\tntfs_error(vol->sb, \"Lookup of quota defaults entry \"\n\t\t\t\t\t\"failed.\");\n\t\tgoto err_out;\n\t}\n\tif (ictx->data_len < offsetof(QUOTA_CONTROL_ENTRY, sid)) {\n\t\tntfs_error(vol->sb, \"Quota defaults entry size is invalid.  \"\n\t\t\t\t\"Run chkdsk.\");\n\t\tgoto err_out;\n\t}\n\tqce = (QUOTA_CONTROL_ENTRY*)ictx->data;\n\tif (le32_to_cpu(qce->version) != QUOTA_VERSION) {\n\t\tntfs_error(vol->sb, \"Quota defaults entry version 0x%x is not \"\n\t\t\t\t\"supported.\", le32_to_cpu(qce->version));\n\t\tgoto err_out;\n\t}\n\tntfs_debug(\"Quota defaults flags = 0x%x.\", le32_to_cpu(qce->flags));\n\t \n\tif (qce->flags & QUOTA_FLAG_OUT_OF_DATE)\n\t\tgoto set_done;\n\t \n\tif (!(qce->flags & (QUOTA_FLAG_TRACKING_ENABLED |\n\t\t\tQUOTA_FLAG_TRACKING_REQUESTED |\n\t\t\tQUOTA_FLAG_PENDING_DELETES)))\n\t\tgoto set_done;\n\t \n\tqce->flags |= QUOTA_FLAG_OUT_OF_DATE;\n\t \n\tntfs_index_entry_flush_dcache_page(ictx);\n\tntfs_index_entry_mark_dirty(ictx);\nset_done:\n\tntfs_index_ctx_put(ictx);\n\tinode_unlock(vol->quota_q_ino);\n\t \n\tNVolSetQuotaOutOfDate(vol);\ndone:\n\tntfs_debug(\"Done.\");\n\treturn true;\nerr_out:\n\tif (ictx)\n\t\tntfs_index_ctx_put(ictx);\n\tinode_unlock(vol->quota_q_ino);\n\treturn false;\n}\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}