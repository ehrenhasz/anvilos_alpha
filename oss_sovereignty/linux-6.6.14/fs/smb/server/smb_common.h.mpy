{
  "module_name": "smb_common.h",
  "hash_id": "236a63c411dc617cc7dc37e73466359fb75ff5edec020783424eb36e40614014",
  "original_prompt": "Ingested from linux-6.6.14/fs/smb/server/smb_common.h",
  "human_readable_source": " \n \n\n#ifndef __SMB_COMMON_H__\n#define __SMB_COMMON_H__\n\n#include <linux/kernel.h>\n\n#include \"glob.h\"\n#include \"nterr.h\"\n#include \"../common/smb2pdu.h\"\n#include \"smb2pdu.h\"\n\n \n#define ESHARE\t\t\t50000\n\n#define SMB1_PROT\t\t0\n#define SMB2_PROT\t\t1\n#define SMB21_PROT\t\t2\n \n#define SMB2X_PROT\t\t3\n#define SMB30_PROT\t\t4\n#define SMB302_PROT\t\t5\n#define SMB311_PROT\t\t6\n#define BAD_PROT\t\t0xFFFF\n\n#define SMB1_VERSION_STRING\t\"1.0\"\n#define SMB20_VERSION_STRING\t\"2.0\"\n#define SMB21_VERSION_STRING\t\"2.1\"\n#define SMB30_VERSION_STRING\t\"3.0\"\n#define SMB302_VERSION_STRING\t\"3.02\"\n#define SMB311_VERSION_STRING\t\"3.1.1\"\n\n#define SMB_ECHO_INTERVAL\t(60 * HZ)\n\n#define CIFS_DEFAULT_IOSIZE\t(64 * 1024)\n#define MAX_CIFS_SMALL_BUFFER_SIZE 448  \n\n#define MAX_STREAM_PROT_LEN\t0x00FFFFFF\n\n \n#define F_SUPERSEDED\t0\n#define F_OPENED\t1\n#define F_CREATED\t2\n#define F_OVERWRITTEN\t3\n\n \n#define ATTR_POSIX_SEMANTICS\t\t0x01000000\n#define ATTR_BACKUP_SEMANTICS\t\t0x02000000\n#define ATTR_DELETE_ON_CLOSE\t\t0x04000000\n#define ATTR_SEQUENTIAL_SCAN\t\t0x08000000\n#define ATTR_RANDOM_ACCESS\t\t0x10000000\n#define ATTR_NO_BUFFERING\t\t0x20000000\n#define ATTR_WRITE_THROUGH\t\t0x80000000\n\n \n#define FILE_SUPPORTS_SPARSE_VDL\t0x10000000  \n#define FILE_SUPPORTS_BLOCK_REFCOUNTING\t0x08000000  \n#define FILE_SUPPORT_INTEGRITY_STREAMS\t0x04000000\n#define FILE_SUPPORTS_USN_JOURNAL\t0x02000000\n#define FILE_SUPPORTS_OPEN_BY_FILE_ID\t0x01000000\n#define FILE_SUPPORTS_EXTENDED_ATTRIBUTES 0x00800000\n#define FILE_SUPPORTS_HARD_LINKS\t0x00400000\n#define FILE_SUPPORTS_TRANSACTIONS\t0x00200000\n#define FILE_SEQUENTIAL_WRITE_ONCE\t0x00100000\n#define FILE_READ_ONLY_VOLUME\t\t0x00080000\n#define FILE_NAMED_STREAMS\t\t0x00040000\n#define FILE_SUPPORTS_ENCRYPTION\t0x00020000\n#define FILE_SUPPORTS_OBJECT_IDS\t0x00010000\n#define FILE_VOLUME_IS_COMPRESSED\t0x00008000\n#define FILE_SUPPORTS_REMOTE_STORAGE\t0x00000100\n#define FILE_SUPPORTS_REPARSE_POINTS\t0x00000080\n#define FILE_SUPPORTS_SPARSE_FILES\t0x00000040\n#define FILE_VOLUME_QUOTAS\t\t0x00000020\n#define FILE_FILE_COMPRESSION\t\t0x00000010\n#define FILE_PERSISTENT_ACLS\t\t0x00000008\n#define FILE_UNICODE_ON_DISK\t\t0x00000004\n#define FILE_CASE_PRESERVED_NAMES\t0x00000002\n#define FILE_CASE_SENSITIVE_SEARCH\t0x00000001\n\n#define FILE_READ_DATA        0x00000001   \n#define FILE_WRITE_DATA       0x00000002   \n#define FILE_APPEND_DATA      0x00000004   \n#define FILE_READ_EA          0x00000008   \n \n#define FILE_WRITE_EA         0x00000010   \n \n#define FILE_EXECUTE          0x00000020   \n \n#define FILE_DELETE_CHILD     0x00000040\n#define FILE_READ_ATTRIBUTES  0x00000080   \n \n#define FILE_WRITE_ATTRIBUTES 0x00000100   \n \n#define DELETE                0x00010000   \n#define READ_CONTROL          0x00020000   \n \n \n#define WRITE_DAC             0x00040000   \n \n \n#define WRITE_OWNER           0x00080000   \n \n#define SYNCHRONIZE           0x00100000   \n \n \n#define GENERIC_ALL           0x10000000\n#define GENERIC_EXECUTE       0x20000000\n#define GENERIC_WRITE         0x40000000\n#define GENERIC_READ          0x80000000\n \n \n \n \n \n\n#define SET_FILE_READ_RIGHTS (FILE_READ_DATA | FILE_READ_EA \\\n\t\t| FILE_READ_ATTRIBUTES \\\n\t\t| DELETE | READ_CONTROL | WRITE_DAC \\\n\t\t| WRITE_OWNER | SYNCHRONIZE)\n#define SET_FILE_WRITE_RIGHTS (FILE_WRITE_DATA | FILE_APPEND_DATA \\\n\t\t| FILE_WRITE_EA \\\n\t\t| FILE_DELETE_CHILD \\\n\t\t| FILE_WRITE_ATTRIBUTES \\\n\t\t| DELETE | READ_CONTROL | WRITE_DAC \\\n\t\t| WRITE_OWNER | SYNCHRONIZE)\n#define SET_FILE_EXEC_RIGHTS (FILE_READ_EA | FILE_WRITE_EA | FILE_EXECUTE \\\n\t\t| FILE_READ_ATTRIBUTES \\\n\t\t| FILE_WRITE_ATTRIBUTES \\\n\t\t| DELETE | READ_CONTROL | WRITE_DAC \\\n\t\t| WRITE_OWNER | SYNCHRONIZE)\n\n#define SET_MINIMUM_RIGHTS (FILE_READ_EA | FILE_READ_ATTRIBUTES \\\n\t\t| READ_CONTROL | SYNCHRONIZE)\n\n \n#define GENERIC_READ_FLAGS\t(READ_CONTROL | FILE_READ_DATA | \\\n\t\tFILE_READ_ATTRIBUTES | \\\n\t\tFILE_READ_EA | SYNCHRONIZE)\n\n#define GENERIC_WRITE_FLAGS\t(READ_CONTROL | FILE_WRITE_DATA | \\\n\t\tFILE_WRITE_ATTRIBUTES | FILE_WRITE_EA | \\\n\t\tFILE_APPEND_DATA | SYNCHRONIZE)\n\n#define GENERIC_EXECUTE_FLAGS\t(READ_CONTROL | FILE_EXECUTE | \\\n\t\tFILE_READ_ATTRIBUTES | SYNCHRONIZE)\n\n#define GENERIC_ALL_FLAGS\t(DELETE | READ_CONTROL | WRITE_DAC | \\\n\t\tWRITE_OWNER | SYNCHRONIZE | FILE_READ_DATA | \\\n\t\tFILE_WRITE_DATA | FILE_APPEND_DATA | \\\n\t\tFILE_READ_EA | FILE_WRITE_EA | \\\n\t\tFILE_EXECUTE | FILE_DELETE_CHILD | \\\n\t\tFILE_READ_ATTRIBUTES | FILE_WRITE_ATTRIBUTES)\n\n#define SMB1_PROTO_NUMBER\t\tcpu_to_le32(0x424d53ff)\n#define SMB_COM_NEGOTIATE\t\t0x72\n#define SMB1_CLIENT_GUID_SIZE\t\t(16)\n\n#define SMBFLG_RESPONSE 0x80\t \n\n#define SMBFLG2_IS_LONG_NAME\tcpu_to_le16(0x40)\n#define SMBFLG2_EXT_SEC\t\tcpu_to_le16(0x800)\n#define SMBFLG2_ERR_STATUS\tcpu_to_le16(0x4000)\n#define SMBFLG2_UNICODE\t\tcpu_to_le16(0x8000)\n\nstruct smb_hdr {\n\t__be32 smb_buf_length;\n\t__u8 Protocol[4];\n\t__u8 Command;\n\tunion {\n\t\tstruct {\n\t\t\t__u8 ErrorClass;\n\t\t\t__u8 Reserved;\n\t\t\t__le16 Error;\n\t\t} __packed DosError;\n\t\t__le32 CifsError;\n\t} __packed Status;\n\t__u8 Flags;\n\t__le16 Flags2;           \n\t__le16 PidHigh;\n\tunion {\n\t\tstruct {\n\t\t\t__le32 SequenceNumber;   \n\t\t\t__u32 Reserved;  \n\t\t} __packed Sequence;\n\t\t__u8 SecuritySignature[8];       \n\t} __packed Signature;\n\t__u8 pad[2];\n\t__le16 Tid;\n\t__le16 Pid;\n\t__le16 Uid;\n\t__le16 Mid;\n\t__u8 WordCount;\n} __packed;\n\nstruct smb_negotiate_req {\n\tstruct smb_hdr hdr;      \n\t__le16 ByteCount;\n\tunsigned char DialectsArray[];\n} __packed;\n\nstruct smb_negotiate_rsp {\n\tstruct smb_hdr hdr;      \n\t__le16 DialectIndex;  \n\t__le16 ByteCount;\n} __packed;\n\nstruct filesystem_attribute_info {\n\t__le32 Attributes;\n\t__le32 MaxPathNameComponentLength;\n\t__le32 FileSystemNameLen;\n\t__le16 FileSystemName[1];  \n} __packed;\n\nstruct filesystem_device_info {\n\t__le32 DeviceType;\n\t__le32 DeviceCharacteristics;\n} __packed;  \n\nstruct filesystem_vol_info {\n\t__le64 VolumeCreationTime;\n\t__le32 SerialNumber;\n\t__le32 VolumeLabelSize;\n\t__le16 Reserved;\n\t__le16 VolumeLabel[1];\n} __packed;\n\nstruct filesystem_info {\n\t__le64 TotalAllocationUnits;\n\t__le64 FreeAllocationUnits;\n\t__le32 SectorsPerAllocationUnit;\n\t__le32 BytesPerSector;\n} __packed;      \n\n#define EXTENDED_INFO_MAGIC 0x43667364\t \n#define STRING_LENGTH 28\n\nstruct fs_extended_info {\n\t__le32 magic;\n\t__le32 version;\n\t__le32 release;\n\t__u64 rel_date;\n\tchar    version_string[STRING_LENGTH];\n} __packed;\n\nstruct object_id_info {\n\tchar objid[16];\n\tstruct fs_extended_info extended_info;\n} __packed;\n\nstruct file_directory_info {\n\t__le32 NextEntryOffset;\n\t__u32 FileIndex;\n\t__le64 CreationTime;\n\t__le64 LastAccessTime;\n\t__le64 LastWriteTime;\n\t__le64 ChangeTime;\n\t__le64 EndOfFile;\n\t__le64 AllocationSize;\n\t__le32 ExtFileAttributes;\n\t__le32 FileNameLength;\n\tchar FileName[];\n} __packed;    \n\nstruct file_names_info {\n\t__le32 NextEntryOffset;\n\t__u32 FileIndex;\n\t__le32 FileNameLength;\n\tchar FileName[];\n} __packed;    \n\nstruct file_full_directory_info {\n\t__le32 NextEntryOffset;\n\t__u32 FileIndex;\n\t__le64 CreationTime;\n\t__le64 LastAccessTime;\n\t__le64 LastWriteTime;\n\t__le64 ChangeTime;\n\t__le64 EndOfFile;\n\t__le64 AllocationSize;\n\t__le32 ExtFileAttributes;\n\t__le32 FileNameLength;\n\t__le32 EaSize;\n\tchar FileName[];\n} __packed;  \n\nstruct file_both_directory_info {\n\t__le32 NextEntryOffset;\n\t__u32 FileIndex;\n\t__le64 CreationTime;\n\t__le64 LastAccessTime;\n\t__le64 LastWriteTime;\n\t__le64 ChangeTime;\n\t__le64 EndOfFile;\n\t__le64 AllocationSize;\n\t__le32 ExtFileAttributes;\n\t__le32 FileNameLength;\n\t__le32 EaSize;  \n\t__u8   ShortNameLength;\n\t__u8   Reserved;\n\t__u8   ShortName[24];\n\tchar FileName[];\n} __packed;  \n\nstruct file_id_both_directory_info {\n\t__le32 NextEntryOffset;\n\t__u32 FileIndex;\n\t__le64 CreationTime;\n\t__le64 LastAccessTime;\n\t__le64 LastWriteTime;\n\t__le64 ChangeTime;\n\t__le64 EndOfFile;\n\t__le64 AllocationSize;\n\t__le32 ExtFileAttributes;\n\t__le32 FileNameLength;\n\t__le32 EaSize;  \n\t__u8   ShortNameLength;\n\t__u8   Reserved;\n\t__u8   ShortName[24];\n\t__le16 Reserved2;\n\t__le64 UniqueId;\n\tchar FileName[];\n} __packed;\n\nstruct file_id_full_dir_info {\n\t__le32 NextEntryOffset;\n\t__u32 FileIndex;\n\t__le64 CreationTime;\n\t__le64 LastAccessTime;\n\t__le64 LastWriteTime;\n\t__le64 ChangeTime;\n\t__le64 EndOfFile;\n\t__le64 AllocationSize;\n\t__le32 ExtFileAttributes;\n\t__le32 FileNameLength;\n\t__le32 EaSize;  \n\t__le32 Reserved;\n\t__le64 UniqueId;  \n\tchar FileName[];\n} __packed;  \n\nstruct smb_version_values {\n\tchar\t\t*version_string;\n\t__u16\t\tprotocol_id;\n\t__le16\t\tlock_cmd;\n\t__u32\t\tcapabilities;\n\t__u32\t\tmax_read_size;\n\t__u32\t\tmax_write_size;\n\t__u32\t\tmax_trans_size;\n\t__u32\t\tmax_credits;\n\t__u32\t\tlarge_lock_type;\n\t__u32\t\texclusive_lock_type;\n\t__u32\t\tshared_lock_type;\n\t__u32\t\tunlock_lock_type;\n\tsize_t\t\theader_size;\n\tsize_t\t\tmax_header_size;\n\tsize_t\t\tread_rsp_size;\n\tunsigned int\tcap_unix;\n\tunsigned int\tcap_nt_find;\n\tunsigned int\tcap_large_files;\n\t__u16\t\tsigning_enabled;\n\t__u16\t\tsigning_required;\n\tsize_t\t\tcreate_lease_size;\n\tsize_t\t\tcreate_durable_size;\n\tsize_t\t\tcreate_durable_v2_size;\n\tsize_t\t\tcreate_mxac_size;\n\tsize_t\t\tcreate_disk_id_size;\n\tsize_t\t\tcreate_posix_size;\n};\n\nstruct filesystem_posix_info {\n\t \n\t__le32 OptimalTransferSize;   \n\t__le32 BlockSize;\n\t \n\t__le64 TotalBlocks;\n\t__le64 BlocksAvail;        \n\t__le64 UserBlocksAvail;    \n\t \n\t__le64 TotalFileNodes;\n\t__le64 FreeFileNodes;\n\t__le64 FileSysIdentifier;    \n\t \n\t \n} __packed;\n\nstruct smb_version_ops {\n\tu16 (*get_cmd_val)(struct ksmbd_work *swork);\n\tint (*init_rsp_hdr)(struct ksmbd_work *swork);\n\tvoid (*set_rsp_status)(struct ksmbd_work *swork, __le32 err);\n\tint (*allocate_rsp_buf)(struct ksmbd_work *work);\n\tint (*set_rsp_credits)(struct ksmbd_work *work);\n\tint (*check_user_session)(struct ksmbd_work *work);\n\tint (*get_ksmbd_tcon)(struct ksmbd_work *work);\n\tbool (*is_sign_req)(struct ksmbd_work *work, unsigned int command);\n\tint (*check_sign_req)(struct ksmbd_work *work);\n\tvoid (*set_sign_rsp)(struct ksmbd_work *work);\n\tint (*generate_signingkey)(struct ksmbd_session *sess, struct ksmbd_conn *conn);\n\tint (*generate_encryptionkey)(struct ksmbd_conn *conn, struct ksmbd_session *sess);\n\tbool (*is_transform_hdr)(void *buf);\n\tint (*decrypt_req)(struct ksmbd_work *work);\n\tint (*encrypt_resp)(struct ksmbd_work *work);\n};\n\nstruct smb_version_cmds {\n\tint (*proc)(struct ksmbd_work *swork);\n};\n\nint ksmbd_min_protocol(void);\nint ksmbd_max_protocol(void);\n\nint ksmbd_lookup_protocol_idx(char *str);\n\nint ksmbd_verify_smb_message(struct ksmbd_work *work);\nbool ksmbd_smb_request(struct ksmbd_conn *conn);\n\nint ksmbd_lookup_dialect_by_id(__le16 *cli_dialects, __le16 dialects_count);\n\nint ksmbd_init_smb_server(struct ksmbd_work *work);\n\nstruct ksmbd_kstat;\nint ksmbd_populate_dot_dotdot_entries(struct ksmbd_work *work,\n\t\t\t\t      int info_level,\n\t\t\t\t      struct ksmbd_file *dir,\n\t\t\t\t      struct ksmbd_dir_info *d_info,\n\t\t\t\t      char *search_pattern,\n\t\t\t\t      int (*fn)(struct ksmbd_conn *,\n\t\t\t\t\t\tint,\n\t\t\t\t\t\tstruct ksmbd_dir_info *,\n\t\t\t\t\t\tstruct ksmbd_kstat *));\n\nint ksmbd_extract_shortname(struct ksmbd_conn *conn,\n\t\t\t    const char *longname,\n\t\t\t    char *shortname);\n\nint ksmbd_smb_negotiate_common(struct ksmbd_work *work, unsigned int command);\n\nint ksmbd_smb_check_shared_mode(struct file *filp, struct ksmbd_file *curr_fp);\nint ksmbd_override_fsids(struct ksmbd_work *work);\nvoid ksmbd_revert_fsids(struct ksmbd_work *work);\n\nunsigned int ksmbd_server_side_copy_max_chunk_count(void);\nunsigned int ksmbd_server_side_copy_max_chunk_size(void);\nunsigned int ksmbd_server_side_copy_max_total_size(void);\nbool is_asterisk(char *p);\n__le32 smb_map_generic_desired_access(__le32 daccess);\n\nstatic inline unsigned int get_rfc1002_len(void *buf)\n{\n\treturn be32_to_cpu(*((__be32 *)buf)) & 0xffffff;\n}\n\nstatic inline void inc_rfc1001_len(void *buf, int count)\n{\n\tbe32_add_cpu((__be32 *)buf, count);\n}\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}