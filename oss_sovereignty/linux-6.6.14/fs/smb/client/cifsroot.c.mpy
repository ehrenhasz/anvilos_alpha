{
  "module_name": "cifsroot.c",
  "hash_id": "cf73c1878c2241de398f387ab05a5b131e9e9cc187a28a204666b35d76371633",
  "original_prompt": "Ingested from linux-6.6.14/fs/smb/client/cifsroot.c",
  "human_readable_source": "\n \n#include <linux/init.h>\n#include <linux/fs.h>\n#include <linux/types.h>\n#include <linux/ctype.h>\n#include <linux/string.h>\n#include <linux/root_dev.h>\n#include <linux/kernel.h>\n#include <linux/in.h>\n#include <linux/inet.h>\n#include <net/ipconfig.h>\n\n#define DEFAULT_MNT_OPTS \\\n\t\"vers=1.0,cifsacl,mfsymlinks,rsize=1048576,wsize=65536,uid=0,gid=0,\" \\\n\t\"hard,rootfs\"\n\nstatic char root_dev[2048] __initdata = \"\";\nstatic char root_opts[1024] __initdata = DEFAULT_MNT_OPTS;\n\nstatic __be32 __init parse_srvaddr(char *start, char *end)\n{\n\t \n\tchar addr[sizeof(\"aaa.bbb.ccc.ddd\")];\n\tint i = 0;\n\n\twhile (start < end && i < sizeof(addr) - 1) {\n\t\tif (isdigit(*start) || *start == '.')\n\t\t\taddr[i++] = *start;\n\t\tstart++;\n\t}\n\taddr[i] = '\\0';\n\treturn in_aton(addr);\n}\n\n \n\t\ts = strchrnul(s, ',');\n\t\t \n\t\tlen = s - line + 1;\n\t\tif (len > sizeof(root_dev)) {\n\t\t\tpr_err(\"Root-CIFS: UNC path too long\\n\");\n\t\t\treturn 1;\n\t\t}\n\t\tstrscpy(root_dev, line, len);\n\t\tsrvaddr = parse_srvaddr(&line[2], s);\n\t\tif (*s) {\n\t\t\tint n = snprintf(root_opts,\n\t\t\t\t\t sizeof(root_opts), \"%s,%s\",\n\t\t\t\t\t DEFAULT_MNT_OPTS, s + 1);\n\t\t\tif (n >= sizeof(root_opts)) {\n\t\t\t\tpr_err(\"Root-CIFS: mount options string too long\\n\");\n\t\t\t\troot_opts[sizeof(root_opts)-1] = '\\0';\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t}\n\t}\n\n\troot_server_addr = srvaddr;\n\n\treturn 1;\n}\n\n__setup(\"cifsroot=\", cifs_root_setup);\n\nint __init cifs_root_data(char **dev, char **opts)\n{\n\tif (!root_dev[0] || root_server_addr == htonl(INADDR_NONE)) {\n\t\tpr_err(\"Root-CIFS: no SMB server address\\n\");\n\t\treturn -1;\n\t}\n\n\t*dev = root_dev;\n\t*opts = root_opts;\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}