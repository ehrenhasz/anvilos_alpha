{
  "module_name": "security.c",
  "hash_id": "c1744f6a3b827523b53e9d63ea7b9ae41e3f2147e8a6f311488b34c4bf66f2e6",
  "original_prompt": "Ingested from linux-6.6.14/fs/cachefiles/security.c",
  "human_readable_source": "\n \n\n#include <linux/fs.h>\n#include <linux/cred.h>\n#include \"internal.h\"\n\n \nint cachefiles_get_security_ID(struct cachefiles_cache *cache)\n{\n\tstruct cred *new;\n\tint ret;\n\n\t_enter(\"{%s}\", cache->secctx);\n\n\tnew = prepare_kernel_cred(current);\n\tif (!new) {\n\t\tret = -ENOMEM;\n\t\tgoto error;\n\t}\n\n\tif (cache->secctx) {\n\t\tret = set_security_override_from_ctx(new, cache->secctx);\n\t\tif (ret < 0) {\n\t\t\tput_cred(new);\n\t\t\tpr_err(\"Security denies permission to nominate security context: error %d\\n\",\n\t\t\t       ret);\n\t\t\tgoto error;\n\t\t}\n\t}\n\n\tcache->cache_cred = new;\n\tret = 0;\nerror:\n\t_leave(\" = %d\", ret);\n\treturn ret;\n}\n\n \nstatic int cachefiles_check_cache_dir(struct cachefiles_cache *cache,\n\t\t\t\t      struct dentry *root)\n{\n\tint ret;\n\n\tret = security_inode_mkdir(d_backing_inode(root), root, 0);\n\tif (ret < 0) {\n\t\tpr_err(\"Security denies permission to make dirs: error %d\",\n\t\t       ret);\n\t\treturn ret;\n\t}\n\n\tret = security_inode_create(d_backing_inode(root), root, 0);\n\tif (ret < 0)\n\t\tpr_err(\"Security denies permission to create files: error %d\",\n\t\t       ret);\n\n\treturn ret;\n}\n\n \nint cachefiles_determine_cache_security(struct cachefiles_cache *cache,\n\t\t\t\t\tstruct dentry *root,\n\t\t\t\t\tconst struct cred **_saved_cred)\n{\n\tstruct cred *new;\n\tint ret;\n\n\t_enter(\"\");\n\n\t \n\tnew = prepare_creds();\n\tif (!new)\n\t\treturn -ENOMEM;\n\n\tcachefiles_end_secure(cache, *_saved_cred);\n\n\t \n\tret = set_create_files_as(new, d_backing_inode(root));\n\tif (ret < 0) {\n\t\tabort_creds(new);\n\t\tcachefiles_begin_secure(cache, _saved_cred);\n\t\t_leave(\" = %d [cfa]\", ret);\n\t\treturn ret;\n\t}\n\n\tput_cred(cache->cache_cred);\n\tcache->cache_cred = new;\n\n\tcachefiles_begin_secure(cache, _saved_cred);\n\tret = cachefiles_check_cache_dir(cache, root);\n\n\tif (ret == -EOPNOTSUPP)\n\t\tret = 0;\n\t_leave(\" = %d\", ret);\n\treturn ret;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}