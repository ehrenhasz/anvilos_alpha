{
  "module_name": "zonefs.h",
  "hash_id": "cf9f5e2f328d1a2b7f5fa1f7df7dc62bf60d5b33617a348786ad63095d698211",
  "original_prompt": "Ingested from linux-6.6.14/fs/zonefs/zonefs.h",
  "human_readable_source": " \n \n#ifndef __ZONEFS_H__\n#define __ZONEFS_H__\n\n#include <linux/fs.h>\n#include <linux/magic.h>\n#include <linux/uuid.h>\n#include <linux/mutex.h>\n#include <linux/rwsem.h>\n#include <linux/kobject.h>\n\n \n#define ZONEFS_NAME_MAX\t\t16\n\n \nenum zonefs_ztype {\n\tZONEFS_ZTYPE_CNV,\n\tZONEFS_ZTYPE_SEQ,\n\tZONEFS_ZTYPE_MAX,\n};\n\nstatic inline enum zonefs_ztype zonefs_zone_type(struct blk_zone *zone)\n{\n\tif (zone->type == BLK_ZONE_TYPE_CONVENTIONAL)\n\t\treturn ZONEFS_ZTYPE_CNV;\n\treturn ZONEFS_ZTYPE_SEQ;\n}\n\n#define ZONEFS_ZONE_INIT_MODE\t(1U << 0)\n#define ZONEFS_ZONE_OPEN\t(1U << 1)\n#define ZONEFS_ZONE_ACTIVE\t(1U << 2)\n#define ZONEFS_ZONE_OFFLINE\t(1U << 3)\n#define ZONEFS_ZONE_READONLY\t(1U << 4)\n#define ZONEFS_ZONE_CNV\t\t(1U << 31)\n\n \nstruct zonefs_zone {\n\t \n\tunsigned int\t\tz_flags;\n\n\t \n\tsector_t\t\tz_sector;\n\n\t \n\tloff_t\t\t\tz_size;\n\n\t \n\tloff_t\t\t\tz_capacity;\n\n\t \n\tloff_t\t\t\tz_wpoffset;\n\n\t \n\tumode_t\t\t\tz_mode;\n\tkuid_t\t\t\tz_uid;\n\tkgid_t\t\t\tz_gid;\n};\n\n \nstruct zonefs_zone_group {\n\tstruct inode\t\t*g_inode;\n\tunsigned int\t\tg_nr_zones;\n\tstruct zonefs_zone\t*g_zones;\n};\n\n \nstruct zonefs_inode_info {\n\tstruct inode\t\ti_vnode;\n\n\t \n\tstruct mutex\t\ti_truncate_mutex;\n\n\t \n\tunsigned int\t\ti_wr_refcnt;\n};\n\nstatic inline struct zonefs_inode_info *ZONEFS_I(struct inode *inode)\n{\n\treturn container_of(inode, struct zonefs_inode_info, i_vnode);\n}\n\nstatic inline bool zonefs_zone_is_cnv(struct zonefs_zone *z)\n{\n\treturn z->z_flags & ZONEFS_ZONE_CNV;\n}\n\nstatic inline bool zonefs_zone_is_seq(struct zonefs_zone *z)\n{\n\treturn !zonefs_zone_is_cnv(z);\n}\n\nstatic inline struct zonefs_zone *zonefs_inode_zone(struct inode *inode)\n{\n\treturn inode->i_private;\n}\n\nstatic inline bool zonefs_inode_is_cnv(struct inode *inode)\n{\n\treturn zonefs_zone_is_cnv(zonefs_inode_zone(inode));\n}\n\nstatic inline bool zonefs_inode_is_seq(struct inode *inode)\n{\n\treturn zonefs_zone_is_seq(zonefs_inode_zone(inode));\n}\n\n \n#define ZONEFS_LABEL_LEN\t64\n#define ZONEFS_UUID_SIZE\t16\n#define ZONEFS_SUPER_SIZE\t4096\n\nstruct zonefs_super {\n\n\t \n\t__le32\t\ts_magic;\n\n\t \n\t__le32\t\ts_crc;\n\n\t \n\tchar\t\ts_label[ZONEFS_LABEL_LEN];\n\n\t \n\t__u8\t\ts_uuid[ZONEFS_UUID_SIZE];\n\n\t \n\t__le64\t\ts_features;\n\n\t \n\t__le32\t\ts_uid;\n\t__le32\t\ts_gid;\n\n\t \n\t__le32\t\ts_perm;\n\n\t \n\t__u8\t\ts_reserved[3988];\n\n} __packed;\n\n \nenum zonefs_features {\n\t \n\tZONEFS_F_AGGRCNV = 1ULL << 0,\n\t \n\tZONEFS_F_UID = 1ULL << 1,\n\t \n\tZONEFS_F_GID = 1ULL << 2,\n\t \n\tZONEFS_F_PERM = 1ULL << 3,\n};\n\n#define ZONEFS_F_DEFINED_FEATURES \\\n\t(ZONEFS_F_AGGRCNV | ZONEFS_F_UID | ZONEFS_F_GID | ZONEFS_F_PERM)\n\n \n#define ZONEFS_MNTOPT_ERRORS_RO\t\t(1 << 0)  \n#define ZONEFS_MNTOPT_ERRORS_ZRO\t(1 << 1)  \n#define ZONEFS_MNTOPT_ERRORS_ZOL\t(1 << 2)  \n#define ZONEFS_MNTOPT_ERRORS_REPAIR\t(1 << 3)  \n#define ZONEFS_MNTOPT_ERRORS_MASK\t\\\n\t(ZONEFS_MNTOPT_ERRORS_RO | ZONEFS_MNTOPT_ERRORS_ZRO | \\\n\t ZONEFS_MNTOPT_ERRORS_ZOL | ZONEFS_MNTOPT_ERRORS_REPAIR)\n#define ZONEFS_MNTOPT_EXPLICIT_OPEN\t(1 << 4)  \n\n \nstruct zonefs_sb_info {\n\n\tunsigned long\t\ts_mount_opts;\n\n\tspinlock_t\t\ts_lock;\n\n\tunsigned long long\ts_features;\n\tkuid_t\t\t\ts_uid;\n\tkgid_t\t\t\ts_gid;\n\tumode_t\t\t\ts_perm;\n\tuuid_t\t\t\ts_uuid;\n\tunsigned int\t\ts_zone_sectors_shift;\n\n\tstruct zonefs_zone_group s_zgroup[ZONEFS_ZTYPE_MAX];\n\n\tloff_t\t\t\ts_blocks;\n\tloff_t\t\t\ts_used_blocks;\n\n\tunsigned int\t\ts_max_wro_seq_files;\n\tatomic_t\t\ts_wro_seq_files;\n\n\tunsigned int\t\ts_max_active_seq_files;\n\tatomic_t\t\ts_active_seq_files;\n\n\tbool\t\t\ts_sysfs_registered;\n\tstruct kobject\t\ts_kobj;\n\tstruct completion\ts_kobj_unregister;\n};\n\nstatic inline struct zonefs_sb_info *ZONEFS_SB(struct super_block *sb)\n{\n\treturn sb->s_fs_info;\n}\n\n#define zonefs_info(sb, format, args...)\t\\\n\tpr_info(\"zonefs (%s): \" format, sb->s_id, ## args)\n#define zonefs_err(sb, format, args...)\t\t\\\n\tpr_err(\"zonefs (%s) ERROR: \" format, sb->s_id, ## args)\n#define zonefs_warn(sb, format, args...)\t\\\n\tpr_warn(\"zonefs (%s) WARNING: \" format, sb->s_id, ## args)\n\n \nvoid zonefs_inode_account_active(struct inode *inode);\nint zonefs_inode_zone_mgmt(struct inode *inode, enum req_op op);\nvoid zonefs_i_size_write(struct inode *inode, loff_t isize);\nvoid zonefs_update_stats(struct inode *inode, loff_t new_isize);\nvoid __zonefs_io_error(struct inode *inode, bool write);\n\nstatic inline void zonefs_io_error(struct inode *inode, bool write)\n{\n\tstruct zonefs_inode_info *zi = ZONEFS_I(inode);\n\n\tmutex_lock(&zi->i_truncate_mutex);\n\t__zonefs_io_error(inode, write);\n\tmutex_unlock(&zi->i_truncate_mutex);\n}\n\n \nextern const struct inode_operations zonefs_dir_inode_operations;\nextern const struct file_operations zonefs_dir_operations;\n\n \nextern const struct address_space_operations zonefs_file_aops;\nextern const struct file_operations zonefs_file_operations;\nint zonefs_file_truncate(struct inode *inode, loff_t isize);\n\n \nint zonefs_sysfs_register(struct super_block *sb);\nvoid zonefs_sysfs_unregister(struct super_block *sb);\nint zonefs_sysfs_init(void);\nvoid zonefs_sysfs_exit(void);\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}