{
  "module_name": "kmsg.c",
  "hash_id": "7b4df24dfa43fc20aa03a5a9e7ad2f1ccb54ff3c761ab88fb8fd08a7937754c0",
  "original_prompt": "Ingested from linux-6.6.14/fs/proc/kmsg.c",
  "human_readable_source": "\n \n\n#include <linux/types.h>\n#include <linux/errno.h>\n#include <linux/time.h>\n#include <linux/kernel.h>\n#include <linux/poll.h>\n#include <linux/proc_fs.h>\n#include <linux/fs.h>\n#include <linux/syslog.h>\n\n#include <asm/io.h>\n\nstatic int kmsg_open(struct inode * inode, struct file * file)\n{\n\treturn do_syslog(SYSLOG_ACTION_OPEN, NULL, 0, SYSLOG_FROM_PROC);\n}\n\nstatic int kmsg_release(struct inode * inode, struct file * file)\n{\n\t(void) do_syslog(SYSLOG_ACTION_CLOSE, NULL, 0, SYSLOG_FROM_PROC);\n\treturn 0;\n}\n\nstatic ssize_t kmsg_read(struct file *file, char __user *buf,\n\t\t\t size_t count, loff_t *ppos)\n{\n\tif ((file->f_flags & O_NONBLOCK) &&\n\t    !do_syslog(SYSLOG_ACTION_SIZE_UNREAD, NULL, 0, SYSLOG_FROM_PROC))\n\t\treturn -EAGAIN;\n\treturn do_syslog(SYSLOG_ACTION_READ, buf, count, SYSLOG_FROM_PROC);\n}\n\nstatic __poll_t kmsg_poll(struct file *file, poll_table *wait)\n{\n\tpoll_wait(file, &log_wait, wait);\n\tif (do_syslog(SYSLOG_ACTION_SIZE_UNREAD, NULL, 0, SYSLOG_FROM_PROC))\n\t\treturn EPOLLIN | EPOLLRDNORM;\n\treturn 0;\n}\n\n\nstatic const struct proc_ops kmsg_proc_ops = {\n\t.proc_flags\t= PROC_ENTRY_PERMANENT,\n\t.proc_read\t= kmsg_read,\n\t.proc_poll\t= kmsg_poll,\n\t.proc_open\t= kmsg_open,\n\t.proc_release\t= kmsg_release,\n\t.proc_lseek\t= generic_file_llseek,\n};\n\nstatic int __init proc_kmsg_init(void)\n{\n\tproc_create(\"kmsg\", S_IRUSR, NULL, &kmsg_proc_ops);\n\treturn 0;\n}\nfs_initcall(proc_kmsg_init);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}