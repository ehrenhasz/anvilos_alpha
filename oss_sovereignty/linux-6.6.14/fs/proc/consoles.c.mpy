{
  "module_name": "consoles.c",
  "hash_id": "95a6516c97266d1c884570676d91c547f136672882c59f52a6922d6bde2e2208",
  "original_prompt": "Ingested from linux-6.6.14/fs/proc/consoles.c",
  "human_readable_source": "\n \n\n#include <linux/console.h>\n#include <linux/kernel.h>\n#include <linux/proc_fs.h>\n#include <linux/seq_file.h>\n#include <linux/tty_driver.h>\n\n \nstatic int show_console_dev(struct seq_file *m, void *v)\n{\n\tstatic const struct {\n\t\tshort flag;\n\t\tchar name;\n\t} con_flags[] = {\n\t\t{ CON_ENABLED,\t\t'E' },\n\t\t{ CON_CONSDEV,\t\t'C' },\n\t\t{ CON_BOOT,\t\t'B' },\n\t\t{ CON_PRINTBUFFER,\t'p' },\n\t\t{ CON_BRL,\t\t'b' },\n\t\t{ CON_ANYTIME,\t\t'a' },\n\t};\n\tchar flags[ARRAY_SIZE(con_flags) + 1];\n\tstruct console *con = v;\n\tunsigned int a;\n\tdev_t dev = 0;\n\n\tif (con->device) {\n\t\tconst struct tty_driver *driver;\n\t\tint index;\n\n\t\t \n\t\tconsole_lock();\n\t\tdriver = con->device(con, &index);\n\t\tconsole_unlock();\n\n\t\tif (driver) {\n\t\t\tdev = MKDEV(driver->major, driver->minor_start);\n\t\t\tdev += index;\n\t\t}\n\t}\n\n\tfor (a = 0; a < ARRAY_SIZE(con_flags); a++)\n\t\tflags[a] = (con->flags & con_flags[a].flag) ?\n\t\t\tcon_flags[a].name : ' ';\n\tflags[a] = 0;\n\n\tseq_setwidth(m, 21 - 1);\n\tseq_printf(m, \"%s%d\", con->name, con->index);\n\tseq_pad(m, ' ');\n\tseq_printf(m, \"%c%c%c (%s)\", con->read ? 'R' : '-',\n\t\t\tcon->write ? 'W' : '-', con->unblank ? 'U' : '-',\n\t\t\tflags);\n\tif (dev)\n\t\tseq_printf(m, \" %4d:%d\", MAJOR(dev), MINOR(dev));\n\n\tseq_putc(m, '\\n');\n\treturn 0;\n}\n\nstatic void *c_start(struct seq_file *m, loff_t *pos)\n{\n\tstruct console *con;\n\tloff_t off = 0;\n\n\t \n\tconsole_list_lock();\n\tfor_each_console(con)\n\t\tif (off++ == *pos)\n\t\t\tbreak;\n\n\treturn con;\n}\n\nstatic void *c_next(struct seq_file *m, void *v, loff_t *pos)\n{\n\tstruct console *con = v;\n\n\t++*pos;\n\treturn hlist_entry_safe(con->node.next, struct console, node);\n}\n\nstatic void c_stop(struct seq_file *m, void *v)\n{\n\tconsole_list_unlock();\n}\n\nstatic const struct seq_operations consoles_op = {\n\t.start\t= c_start,\n\t.next\t= c_next,\n\t.stop\t= c_stop,\n\t.show\t= show_console_dev\n};\n\nstatic int __init proc_consoles_init(void)\n{\n\tproc_create_seq(\"consoles\", 0, NULL, &consoles_op);\n\treturn 0;\n}\nfs_initcall(proc_consoles_init);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}