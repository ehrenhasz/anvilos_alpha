{
  "module_name": "bootconfig.c",
  "hash_id": "3efdf960e6e913b5b2d5980cd9fa2856ffbe57995f6c3429ef0e40a9d52c9f17",
  "original_prompt": "Ingested from linux-6.6.14/fs/proc/bootconfig.c",
  "human_readable_source": "\n \n#include <linux/fs.h>\n#include <linux/init.h>\n#include <linux/printk.h>\n#include <linux/proc_fs.h>\n#include <linux/seq_file.h>\n#include <linux/bootconfig.h>\n#include <linux/slab.h>\n\nstatic char *saved_boot_config;\n\nstatic int boot_config_proc_show(struct seq_file *m, void *v)\n{\n\tif (saved_boot_config)\n\t\tseq_puts(m, saved_boot_config);\n\treturn 0;\n}\n\n \n#define rest(dst, end) ((end) > (dst) ? (end) - (dst) : 0)\n\n \nstatic int __init copy_xbc_key_value_list(char *dst, size_t size)\n{\n\tstruct xbc_node *leaf, *vnode;\n\tchar *key, *end = dst + size;\n\tconst char *val;\n\tchar q;\n\tint ret = 0;\n\n\tkey = kzalloc(XBC_KEYLEN_MAX, GFP_KERNEL);\n\tif (!key)\n\t\treturn -ENOMEM;\n\n\txbc_for_each_key_value(leaf, val) {\n\t\tret = xbc_node_compose_key(leaf, key, XBC_KEYLEN_MAX);\n\t\tif (ret < 0)\n\t\t\tbreak;\n\t\tret = snprintf(dst, rest(dst, end), \"%s = \", key);\n\t\tif (ret < 0)\n\t\t\tbreak;\n\t\tdst += ret;\n\t\tvnode = xbc_node_get_child(leaf);\n\t\tif (vnode) {\n\t\t\txbc_array_for_each_value(vnode, val) {\n\t\t\t\tif (strchr(val, '\"'))\n\t\t\t\t\tq = '\\'';\n\t\t\t\telse\n\t\t\t\t\tq = '\"';\n\t\t\t\tret = snprintf(dst, rest(dst, end), \"%c%s%c%s\",\n\t\t\t\t\tq, val, q, xbc_node_is_array(vnode) ? \", \" : \"\\n\");\n\t\t\t\tif (ret < 0)\n\t\t\t\t\tgoto out;\n\t\t\t\tdst += ret;\n\t\t\t}\n\t\t} else {\n\t\t\tret = snprintf(dst, rest(dst, end), \"\\\"\\\"\\n\");\n\t\t\tif (ret < 0)\n\t\t\t\tbreak;\n\t\t\tdst += ret;\n\t\t}\n\t}\nout:\n\tkfree(key);\n\n\treturn ret < 0 ? ret : dst - (end - size);\n}\n\nstatic int __init proc_boot_config_init(void)\n{\n\tint len;\n\n\tlen = copy_xbc_key_value_list(NULL, 0);\n\tif (len < 0)\n\t\treturn len;\n\n\tif (len > 0) {\n\t\tsaved_boot_config = kzalloc(len + 1, GFP_KERNEL);\n\t\tif (!saved_boot_config)\n\t\t\treturn -ENOMEM;\n\n\t\tlen = copy_xbc_key_value_list(saved_boot_config, len + 1);\n\t\tif (len < 0) {\n\t\t\tkfree(saved_boot_config);\n\t\t\treturn len;\n\t\t}\n\t}\n\n\tproc_create_single(\"bootconfig\", 0, NULL, boot_config_proc_show);\n\n\treturn 0;\n}\nfs_initcall(proc_boot_config_init);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}