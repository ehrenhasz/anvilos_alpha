{
  "module_name": "thread_self.c",
  "hash_id": "94f53f1d94be40a07c405be11808e8e3391e07dbdefe51f09a25d639b78586a4",
  "original_prompt": "Ingested from linux-6.6.14/fs/proc/thread_self.c",
  "human_readable_source": "\n#include <linux/cache.h>\n#include <linux/sched.h>\n#include <linux/slab.h>\n#include <linux/pid_namespace.h>\n#include \"internal.h\"\n\n \nstatic const char *proc_thread_self_get_link(struct dentry *dentry,\n\t\t\t\t\t     struct inode *inode,\n\t\t\t\t\t     struct delayed_call *done)\n{\n\tstruct pid_namespace *ns = proc_pid_ns(inode->i_sb);\n\tpid_t tgid = task_tgid_nr_ns(current, ns);\n\tpid_t pid = task_pid_nr_ns(current, ns);\n\tchar *name;\n\n\tif (!pid)\n\t\treturn ERR_PTR(-ENOENT);\n\tname = kmalloc(10 + 6 + 10 + 1, dentry ? GFP_KERNEL : GFP_ATOMIC);\n\tif (unlikely(!name))\n\t\treturn dentry ? ERR_PTR(-ENOMEM) : ERR_PTR(-ECHILD);\n\tsprintf(name, \"%u/task/%u\", tgid, pid);\n\tset_delayed_call(done, kfree_link, name);\n\treturn name;\n}\n\nstatic const struct inode_operations proc_thread_self_inode_operations = {\n\t.get_link\t= proc_thread_self_get_link,\n};\n\nstatic unsigned thread_self_inum __ro_after_init;\n\nint proc_setup_thread_self(struct super_block *s)\n{\n\tstruct inode *root_inode = d_inode(s->s_root);\n\tstruct proc_fs_info *fs_info = proc_sb_info(s);\n\tstruct dentry *thread_self;\n\tint ret = -ENOMEM;\n\n\tinode_lock(root_inode);\n\tthread_self = d_alloc_name(s->s_root, \"thread-self\");\n\tif (thread_self) {\n\t\tstruct inode *inode = new_inode(s);\n\t\tif (inode) {\n\t\t\tinode->i_ino = thread_self_inum;\n\t\t\tinode->i_mtime = inode->i_atime = inode_set_ctime_current(inode);\n\t\t\tinode->i_mode = S_IFLNK | S_IRWXUGO;\n\t\t\tinode->i_uid = GLOBAL_ROOT_UID;\n\t\t\tinode->i_gid = GLOBAL_ROOT_GID;\n\t\t\tinode->i_op = &proc_thread_self_inode_operations;\n\t\t\td_add(thread_self, inode);\n\t\t\tret = 0;\n\t\t} else {\n\t\t\tdput(thread_self);\n\t\t}\n\t}\n\tinode_unlock(root_inode);\n\n\tif (ret)\n\t\tpr_err(\"proc_fill_super: can't allocate /proc/thread-self\\n\");\n\telse\n\t\tfs_info->proc_thread_self = thread_self;\n\n\treturn ret;\n}\n\nvoid __init proc_thread_self_init(void)\n{\n\tproc_alloc_inum(&thread_self_inum);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}