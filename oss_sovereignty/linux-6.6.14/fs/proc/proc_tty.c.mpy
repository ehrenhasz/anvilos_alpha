{
  "module_name": "proc_tty.c",
  "hash_id": "9546c3b0146264922cef4a6876267cd651f84a4ac1869b0bb9b064b2ccc8ee58",
  "original_prompt": "Ingested from linux-6.6.14/fs/proc/proc_tty.c",
  "human_readable_source": "\n \n#include <linux/module.h>\n#include <linux/init.h>\n#include <linux/errno.h>\n#include <linux/time.h>\n#include <linux/proc_fs.h>\n#include <linux/stat.h>\n#include <linux/tty.h>\n#include <linux/seq_file.h>\n#include <linux/bitops.h>\n#include \"internal.h\"\n\n \nstatic struct proc_dir_entry *proc_tty_driver;\n\n \nstatic void show_tty_range(struct seq_file *m, struct tty_driver *p,\n\tdev_t from, int num)\n{\n\tseq_printf(m, \"%-20s \", p->driver_name ? p->driver_name : \"unknown\");\n\tseq_printf(m, \"/dev/%-8s \", p->name);\n\tif (p->num > 1) {\n\t\tseq_printf(m, \"%3d %d-%d \", MAJOR(from), MINOR(from),\n\t\t\tMINOR(from) + num - 1);\n\t} else {\n\t\tseq_printf(m, \"%3d %7d \", MAJOR(from), MINOR(from));\n\t}\n\tswitch (p->type) {\n\tcase TTY_DRIVER_TYPE_SYSTEM:\n\t\tseq_puts(m, \"system\");\n\t\tif (p->subtype == SYSTEM_TYPE_TTY)\n\t\t\tseq_puts(m, \":/dev/tty\");\n\t\telse if (p->subtype == SYSTEM_TYPE_SYSCONS)\n\t\t\tseq_puts(m, \":console\");\n\t\telse if (p->subtype == SYSTEM_TYPE_CONSOLE)\n\t\t\tseq_puts(m, \":vtmaster\");\n\t\tbreak;\n\tcase TTY_DRIVER_TYPE_CONSOLE:\n\t\tseq_puts(m, \"console\");\n\t\tbreak;\n\tcase TTY_DRIVER_TYPE_SERIAL:\n\t\tseq_puts(m, \"serial\");\n\t\tbreak;\n\tcase TTY_DRIVER_TYPE_PTY:\n\t\tif (p->subtype == PTY_TYPE_MASTER)\n\t\t\tseq_puts(m, \"pty:master\");\n\t\telse if (p->subtype == PTY_TYPE_SLAVE)\n\t\t\tseq_puts(m, \"pty:slave\");\n\t\telse\n\t\t\tseq_puts(m, \"pty\");\n\t\tbreak;\n\tdefault:\n\t\tseq_printf(m, \"type:%d.%d\", p->type, p->subtype);\n\t}\n\tseq_putc(m, '\\n');\n}\n\nstatic int show_tty_driver(struct seq_file *m, void *v)\n{\n\tstruct tty_driver *p = list_entry(v, struct tty_driver, tty_drivers);\n\tdev_t from = MKDEV(p->major, p->minor_start);\n\tdev_t to = from + p->num;\n\n\tif (&p->tty_drivers == tty_drivers.next) {\n\t\t \n\t\tseq_printf(m, \"%-20s /dev/%-8s \", \"/dev/tty\", \"tty\");\n\t\tseq_printf(m, \"%3d %7d \", TTYAUX_MAJOR, 0);\n\t\tseq_puts(m, \"system:/dev/tty\\n\");\n\t\tseq_printf(m, \"%-20s /dev/%-8s \", \"/dev/console\", \"console\");\n\t\tseq_printf(m, \"%3d %7d \", TTYAUX_MAJOR, 1);\n\t\tseq_puts(m, \"system:console\\n\");\n#ifdef CONFIG_UNIX98_PTYS\n\t\tseq_printf(m, \"%-20s /dev/%-8s \", \"/dev/ptmx\", \"ptmx\");\n\t\tseq_printf(m, \"%3d %7d \", TTYAUX_MAJOR, 2);\n\t\tseq_puts(m, \"system\\n\");\n#endif\n#ifdef CONFIG_VT\n\t\tseq_printf(m, \"%-20s /dev/%-8s \", \"/dev/vc/0\", \"vc/0\");\n\t\tseq_printf(m, \"%3d %7d \", TTY_MAJOR, 0);\n\t\tseq_puts(m, \"system:vtmaster\\n\");\n#endif\n\t}\n\n\twhile (MAJOR(from) < MAJOR(to)) {\n\t\tdev_t next = MKDEV(MAJOR(from)+1, 0);\n\t\tshow_tty_range(m, p, from, next - from);\n\t\tfrom = next;\n\t}\n\tif (from != to)\n\t\tshow_tty_range(m, p, from, to - from);\n\treturn 0;\n}\n\n \nstatic void *t_start(struct seq_file *m, loff_t *pos)\n{\n\tmutex_lock(&tty_mutex);\n\treturn seq_list_start(&tty_drivers, *pos);\n}\n\nstatic void *t_next(struct seq_file *m, void *v, loff_t *pos)\n{\n\treturn seq_list_next(v, &tty_drivers, pos);\n}\n\nstatic void t_stop(struct seq_file *m, void *v)\n{\n\tmutex_unlock(&tty_mutex);\n}\n\nstatic const struct seq_operations tty_drivers_op = {\n\t.start\t= t_start,\n\t.next\t= t_next,\n\t.stop\t= t_stop,\n\t.show\t= show_tty_driver\n};\n\n \nvoid proc_tty_register_driver(struct tty_driver *driver)\n{\n\tstruct proc_dir_entry *ent;\n\t\t\n\tif (!driver->driver_name || driver->proc_entry ||\n\t    !driver->ops->proc_show)\n\t\treturn;\n\n\tent = proc_create_single_data(driver->driver_name, 0, proc_tty_driver,\n\t\t\t       driver->ops->proc_show, driver);\n\tdriver->proc_entry = ent;\n}\n\n \nvoid proc_tty_unregister_driver(struct tty_driver *driver)\n{\n\tstruct proc_dir_entry *ent;\n\n\tent = driver->proc_entry;\n\tif (!ent)\n\t\treturn;\n\t\t\n\tremove_proc_entry(ent->name, proc_tty_driver);\n\t\n\tdriver->proc_entry = NULL;\n}\n\n \nvoid __init proc_tty_init(void)\n{\n\tif (!proc_mkdir(\"tty\", NULL))\n\t\treturn;\n\tproc_mkdir(\"tty/ldisc\", NULL);\t \n\t \n\tproc_tty_driver = proc_mkdir_mode(\"tty/driver\", S_IRUSR|S_IXUSR, NULL);\n\tproc_create_seq(\"tty/ldiscs\", 0, NULL, &tty_ldiscs_seq_ops);\n\tproc_create_seq(\"tty/drivers\", 0, NULL, &tty_drivers_op);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}