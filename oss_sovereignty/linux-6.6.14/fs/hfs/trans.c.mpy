{
  "module_name": "trans.c",
  "hash_id": "8641b2630f5e4654b5c076393af27418c4465f5e5723daf8200911e589818053",
  "original_prompt": "Ingested from linux-6.6.14/fs/hfs/trans.c",
  "human_readable_source": " \n\n#include <linux/types.h>\n#include <linux/nls.h>\n\n#include \"hfs_fs.h\"\n\n \n\n \nint hfs_mac2asc(struct super_block *sb, char *out, const struct hfs_name *in)\n{\n\tstruct nls_table *nls_disk = HFS_SB(sb)->nls_disk;\n\tstruct nls_table *nls_io = HFS_SB(sb)->nls_io;\n\tconst char *src;\n\tchar *dst;\n\tint srclen, dstlen, size;\n\n\tsrc = in->name;\n\tsrclen = in->len;\n\tif (srclen > HFS_NAMELEN)\n\t\tsrclen = HFS_NAMELEN;\n\tdst = out;\n\tdstlen = HFS_MAX_NAMELEN;\n\tif (nls_io) {\n\t\twchar_t ch;\n\n\t\twhile (srclen > 0) {\n\t\t\tif (nls_disk) {\n\t\t\t\tsize = nls_disk->char2uni(src, srclen, &ch);\n\t\t\t\tif (size <= 0) {\n\t\t\t\t\tch = '?';\n\t\t\t\t\tsize = 1;\n\t\t\t\t}\n\t\t\t\tsrc += size;\n\t\t\t\tsrclen -= size;\n\t\t\t} else {\n\t\t\t\tch = *src++;\n\t\t\t\tsrclen--;\n\t\t\t}\n\t\t\tif (ch == '/')\n\t\t\t\tch = ':';\n\t\t\tsize = nls_io->uni2char(ch, dst, dstlen);\n\t\t\tif (size < 0) {\n\t\t\t\tif (size == -ENAMETOOLONG)\n\t\t\t\t\tgoto out;\n\t\t\t\t*dst = '?';\n\t\t\t\tsize = 1;\n\t\t\t}\n\t\t\tdst += size;\n\t\t\tdstlen -= size;\n\t\t}\n\t} else {\n\t\tchar ch;\n\n\t\twhile (--srclen >= 0)\n\t\t\t*dst++ = (ch = *src++) == '/' ? ':' : ch;\n\t}\nout:\n\treturn dst - out;\n}\n\n \nvoid hfs_asc2mac(struct super_block *sb, struct hfs_name *out, const struct qstr *in)\n{\n\tstruct nls_table *nls_disk = HFS_SB(sb)->nls_disk;\n\tstruct nls_table *nls_io = HFS_SB(sb)->nls_io;\n\tconst char *src;\n\tchar *dst;\n\tint srclen, dstlen, size;\n\n\tsrc = in->name;\n\tsrclen = in->len;\n\tdst = out->name;\n\tdstlen = HFS_NAMELEN;\n\tif (nls_io) {\n\t\twchar_t ch;\n\n\t\twhile (srclen > 0 && dstlen > 0) {\n\t\t\tsize = nls_io->char2uni(src, srclen, &ch);\n\t\t\tif (size < 0) {\n\t\t\t\tch = '?';\n\t\t\t\tsize = 1;\n\t\t\t}\n\t\t\tsrc += size;\n\t\t\tsrclen -= size;\n\t\t\tif (ch == ':')\n\t\t\t\tch = '/';\n\t\t\tif (nls_disk) {\n\t\t\t\tsize = nls_disk->uni2char(ch, dst, dstlen);\n\t\t\t\tif (size < 0) {\n\t\t\t\t\tif (size == -ENAMETOOLONG)\n\t\t\t\t\t\tgoto out;\n\t\t\t\t\t*dst = '?';\n\t\t\t\t\tsize = 1;\n\t\t\t\t}\n\t\t\t\tdst += size;\n\t\t\t\tdstlen -= size;\n\t\t\t} else {\n\t\t\t\t*dst++ = ch > 0xff ? '?' : ch;\n\t\t\t\tdstlen--;\n\t\t\t}\n\t\t}\n\t} else {\n\t\tchar ch;\n\n\t\tif (dstlen > srclen)\n\t\t\tdstlen = srclen;\n\t\twhile (--dstlen >= 0)\n\t\t\t*dst++ = (ch = *src++) == ':' ? '/' : ch;\n\t}\nout:\n\tout->len = dst - (char *)out->name;\n\tdstlen = HFS_NAMELEN - out->len;\n\twhile (--dstlen >= 0)\n\t\t*dst++ = 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}