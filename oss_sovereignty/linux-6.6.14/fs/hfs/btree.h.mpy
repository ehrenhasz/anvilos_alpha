{
  "module_name": "btree.h",
  "hash_id": "398e255cb56fa1dd414a6b035fe9f93559580d4a790a32b69dd6b1ec154912e4",
  "original_prompt": "Ingested from linux-6.6.14/fs/hfs/btree.h",
  "human_readable_source": " \n \n\n#include \"hfs_fs.h\"\n\ntypedef int (*btree_keycmp)(const btree_key *, const btree_key *);\n\n#define NODE_HASH_SIZE  256\n\n \nenum hfs_btree_mutex_classes {\n\tCATALOG_BTREE_MUTEX,\n\tEXTENTS_BTREE_MUTEX,\n\tATTR_BTREE_MUTEX,\n};\n\n \nstruct hfs_btree {\n\tstruct super_block *sb;\n\tstruct inode *inode;\n\tbtree_keycmp keycmp;\n\n\tu32 cnid;\n\tu32 root;\n\tu32 leaf_count;\n\tu32 leaf_head;\n\tu32 leaf_tail;\n\tu32 node_count;\n\tu32 free_nodes;\n\tu32 attributes;\n\n\tunsigned int node_size;\n\tunsigned int node_size_shift;\n\tunsigned int max_key_len;\n\tunsigned int depth;\n\n\t\n\tstruct mutex tree_lock;\n\n\tunsigned int pages_per_bnode;\n\tspinlock_t hash_lock;\n\tstruct hfs_bnode *node_hash[NODE_HASH_SIZE];\n\tint node_hash_cnt;\n};\n\n \nstruct hfs_bnode {\n\tstruct hfs_btree *tree;\n\n\tu32 prev;\n\tu32 this;\n\tu32 next;\n\tu32 parent;\n\n\tu16 num_recs;\n\tu8 type;\n\tu8 height;\n\n\tstruct hfs_bnode *next_hash;\n\tunsigned long flags;\n\twait_queue_head_t lock_wq;\n\tatomic_t refcnt;\n\tunsigned int page_offset;\n\tstruct page *page[];\n};\n\n#define HFS_BNODE_ERROR\t\t0\n#define HFS_BNODE_NEW\t\t1\n#define HFS_BNODE_DELETED\t2\n\nstruct hfs_find_data {\n\tbtree_key *key;\n\tbtree_key *search_key;\n\tstruct hfs_btree *tree;\n\tstruct hfs_bnode *bnode;\n\tint record;\n\tint keyoffset, keylength;\n\tint entryoffset, entrylength;\n};\n\n\n \nextern struct hfs_btree *hfs_btree_open(struct super_block *, u32, btree_keycmp);\nextern void hfs_btree_close(struct hfs_btree *);\nextern void hfs_btree_write(struct hfs_btree *);\nextern int hfs_bmap_reserve(struct hfs_btree *, int);\nextern struct hfs_bnode * hfs_bmap_alloc(struct hfs_btree *);\nextern void hfs_bmap_free(struct hfs_bnode *node);\n\n \nextern void hfs_bnode_read(struct hfs_bnode *, void *, int, int);\nextern u16 hfs_bnode_read_u16(struct hfs_bnode *, int);\nextern u8 hfs_bnode_read_u8(struct hfs_bnode *, int);\nextern void hfs_bnode_read_key(struct hfs_bnode *, void *, int);\nextern void hfs_bnode_write(struct hfs_bnode *, void *, int, int);\nextern void hfs_bnode_write_u16(struct hfs_bnode *, int, u16);\nextern void hfs_bnode_write_u8(struct hfs_bnode *, int, u8);\nextern void hfs_bnode_clear(struct hfs_bnode *, int, int);\nextern void hfs_bnode_copy(struct hfs_bnode *, int,\n\t\t\t   struct hfs_bnode *, int, int);\nextern void hfs_bnode_move(struct hfs_bnode *, int, int, int);\nextern void hfs_bnode_dump(struct hfs_bnode *);\nextern void hfs_bnode_unlink(struct hfs_bnode *);\nextern struct hfs_bnode *hfs_bnode_findhash(struct hfs_btree *, u32);\nextern struct hfs_bnode *hfs_bnode_find(struct hfs_btree *, u32);\nextern void hfs_bnode_unhash(struct hfs_bnode *);\nextern void hfs_bnode_free(struct hfs_bnode *);\nextern struct hfs_bnode *hfs_bnode_create(struct hfs_btree *, u32);\nextern void hfs_bnode_get(struct hfs_bnode *);\nextern void hfs_bnode_put(struct hfs_bnode *);\n\n \nextern u16 hfs_brec_lenoff(struct hfs_bnode *, u16, u16 *);\nextern u16 hfs_brec_keylen(struct hfs_bnode *, u16);\nextern int hfs_brec_insert(struct hfs_find_data *, void *, int);\nextern int hfs_brec_remove(struct hfs_find_data *);\n\n \nextern int hfs_find_init(struct hfs_btree *, struct hfs_find_data *);\nextern void hfs_find_exit(struct hfs_find_data *);\nextern int __hfs_brec_find(struct hfs_bnode *, struct hfs_find_data *);\nextern int hfs_brec_find(struct hfs_find_data *);\nextern int hfs_brec_read(struct hfs_find_data *, void *, int);\nextern int hfs_brec_goto(struct hfs_find_data *, int);\n\n\nstruct hfs_bnode_desc {\n\t__be32 next;\t\t \n\t__be32 prev;\t\t \n\tu8 type;\t\t \n\tu8 height;\t\t \n\t__be16 num_recs;\t \n\tu16 reserved;\n} __packed;\n\n#define HFS_NODE_INDEX\t0x00\t \n#define HFS_NODE_HEADER\t0x01\t \n#define HFS_NODE_MAP\t0x02\t \n#define HFS_NODE_LEAF\t0xFF\t \n\nstruct hfs_btree_header_rec {\n\t__be16 depth;\t\t \n\t__be32 root;\t\t \n\t__be32 leaf_count;\t \n\t__be32 leaf_head;\t \n\t__be32 leaf_tail;\t \n\t__be16 node_size;\t \n\t__be16 max_key_len;\t \n\t__be32 node_count;\t \n\t__be32 free_nodes;\t \n\tu16 reserved1;\n\t__be32 clump_size;\t \n\tu8 btree_type;\t\t \n\tu8 reserved2;\n\t__be32 attributes;\t \n\tu32 reserved3[16];\n} __packed;\n\n#define BTREE_ATTR_BADCLOSE\t0x00000001\t \n#define HFS_TREE_BIGKEYS\t0x00000002\t \n#define HFS_TREE_VARIDXKEYS\t0x00000004\t \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}