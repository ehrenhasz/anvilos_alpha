{
  "module_name": "attr.c",
  "hash_id": "c44de3498c005054dd24a648155a943efdf25a13bb3955fee87526a9449ff666",
  "original_prompt": "Ingested from linux-6.6.14/fs/hfs/attr.c",
  "human_readable_source": "\n \n\n\n#include <linux/fs.h>\n#include <linux/xattr.h>\n\n#include \"hfs_fs.h\"\n#include \"btree.h\"\n\nenum hfs_xattr_type {\n\tHFS_TYPE,\n\tHFS_CREATOR,\n};\n\nstatic int __hfs_setxattr(struct inode *inode, enum hfs_xattr_type type,\n\t\t\t  const void *value, size_t size, int flags)\n{\n\tstruct hfs_find_data fd;\n\thfs_cat_rec rec;\n\tstruct hfs_cat_file *file;\n\tint res;\n\n\tif (!S_ISREG(inode->i_mode) || HFS_IS_RSRC(inode))\n\t\treturn -EOPNOTSUPP;\n\n\tres = hfs_find_init(HFS_SB(inode->i_sb)->cat_tree, &fd);\n\tif (res)\n\t\treturn res;\n\tfd.search_key->cat = HFS_I(inode)->cat_key;\n\tres = hfs_brec_find(&fd);\n\tif (res)\n\t\tgoto out;\n\thfs_bnode_read(fd.bnode, &rec, fd.entryoffset,\n\t\t\tsizeof(struct hfs_cat_file));\n\tfile = &rec.file;\n\n\tswitch (type) {\n\tcase HFS_TYPE:\n\t\tif (size == 4)\n\t\t\tmemcpy(&file->UsrWds.fdType, value, 4);\n\t\telse\n\t\t\tres = -ERANGE;\n\t\tbreak;\n\n\tcase HFS_CREATOR:\n\t\tif (size == 4)\n\t\t\tmemcpy(&file->UsrWds.fdCreator, value, 4);\n\t\telse\n\t\t\tres = -ERANGE;\n\t\tbreak;\n\t}\n\n\tif (!res)\n\t\thfs_bnode_write(fd.bnode, &rec, fd.entryoffset,\n\t\t\t\tsizeof(struct hfs_cat_file));\nout:\n\thfs_find_exit(&fd);\n\treturn res;\n}\n\nstatic ssize_t __hfs_getxattr(struct inode *inode, enum hfs_xattr_type type,\n\t\t\t      void *value, size_t size)\n{\n\tstruct hfs_find_data fd;\n\thfs_cat_rec rec;\n\tstruct hfs_cat_file *file;\n\tssize_t res = 0;\n\n\tif (!S_ISREG(inode->i_mode) || HFS_IS_RSRC(inode))\n\t\treturn -EOPNOTSUPP;\n\n\tif (size) {\n\t\tres = hfs_find_init(HFS_SB(inode->i_sb)->cat_tree, &fd);\n\t\tif (res)\n\t\t\treturn res;\n\t\tfd.search_key->cat = HFS_I(inode)->cat_key;\n\t\tres = hfs_brec_find(&fd);\n\t\tif (res)\n\t\t\tgoto out;\n\t\thfs_bnode_read(fd.bnode, &rec, fd.entryoffset,\n\t\t\t\tsizeof(struct hfs_cat_file));\n\t}\n\tfile = &rec.file;\n\n\tswitch (type) {\n\tcase HFS_TYPE:\n\t\tif (size >= 4) {\n\t\t\tmemcpy(value, &file->UsrWds.fdType, 4);\n\t\t\tres = 4;\n\t\t} else\n\t\t\tres = size ? -ERANGE : 4;\n\t\tbreak;\n\n\tcase HFS_CREATOR:\n\t\tif (size >= 4) {\n\t\t\tmemcpy(value, &file->UsrWds.fdCreator, 4);\n\t\t\tres = 4;\n\t\t} else\n\t\t\tres = size ? -ERANGE : 4;\n\t\tbreak;\n\t}\n\nout:\n\tif (size)\n\t\thfs_find_exit(&fd);\n\treturn res;\n}\n\nstatic int hfs_xattr_get(const struct xattr_handler *handler,\n\t\t\t struct dentry *unused, struct inode *inode,\n\t\t\t const char *name, void *value, size_t size)\n{\n\treturn __hfs_getxattr(inode, handler->flags, value, size);\n}\n\nstatic int hfs_xattr_set(const struct xattr_handler *handler,\n\t\t\t struct mnt_idmap *idmap,\n\t\t\t struct dentry *unused, struct inode *inode,\n\t\t\t const char *name, const void *value, size_t size,\n\t\t\t int flags)\n{\n\tif (!value)\n\t\treturn -EOPNOTSUPP;\n\n\treturn __hfs_setxattr(inode, handler->flags, value, size, flags);\n}\n\nstatic const struct xattr_handler hfs_creator_handler = {\n\t.name = \"hfs.creator\",\n\t.flags = HFS_CREATOR,\n\t.get = hfs_xattr_get,\n\t.set = hfs_xattr_set,\n};\n\nstatic const struct xattr_handler hfs_type_handler = {\n\t.name = \"hfs.type\",\n\t.flags = HFS_TYPE,\n\t.get = hfs_xattr_get,\n\t.set = hfs_xattr_set,\n};\n\nconst struct xattr_handler *hfs_xattr_handlers[] = {\n\t&hfs_creator_handler,\n\t&hfs_type_handler,\n\tNULL\n};\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}