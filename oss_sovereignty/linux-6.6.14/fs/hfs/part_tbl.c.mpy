{
  "module_name": "part_tbl.c",
  "hash_id": "18120e8bb9096a592495d9ba1694442e3d6a0729f650a370f022054ac085464e",
  "original_prompt": "Ingested from linux-6.6.14/fs/hfs/part_tbl.c",
  "human_readable_source": " \n\n#include \"hfs_fs.h\"\n\n \nstruct new_pmap {\n\t__be16\tpmSig;\t\t \n\t__be16\treSigPad;\t \n\t__be32\tpmMapBlkCnt;\t \n\t__be32\tpmPyPartStart;\t \n\t__be32\tpmPartBlkCnt;\t \n\tu8\tpmPartName[32];\t \n\tu8\tpmPartType[32];\t \n\t \n} __packed;\n\n \nstruct old_pmap {\n\t__be16\t\tpdSig;\t \n\tstruct \told_pmap_entry {\n\t\t__be32\tpdStart;\n\t\t__be32\tpdSize;\n\t\t__be32\tpdFSID;\n\t}\tpdEntry[42];\n} __packed;\n\n \nint hfs_part_find(struct super_block *sb,\n\t\t  sector_t *part_start, sector_t *part_size)\n{\n\tstruct buffer_head *bh;\n\t__be16 *data;\n\tint i, size, res;\n\n\tres = -ENOENT;\n\tbh = sb_bread512(sb, *part_start + HFS_PMAP_BLK, data);\n\tif (!bh)\n\t\treturn -EIO;\n\n\tswitch (be16_to_cpu(*data)) {\n\tcase HFS_OLD_PMAP_MAGIC:\n\t  {\n\t\tstruct old_pmap *pm;\n\t\tstruct old_pmap_entry *p;\n\n\t\tpm = (struct old_pmap *)bh->b_data;\n\t\tp = pm->pdEntry;\n\t\tsize = 42;\n\t\tfor (i = 0; i < size; p++, i++) {\n\t\t\tif (p->pdStart && p->pdSize &&\n\t\t\t    p->pdFSID == cpu_to_be32(0x54465331)  &&\n\t\t\t    (HFS_SB(sb)->part < 0 || HFS_SB(sb)->part == i)) {\n\t\t\t\t*part_start += be32_to_cpu(p->pdStart);\n\t\t\t\t*part_size = be32_to_cpu(p->pdSize);\n\t\t\t\tres = 0;\n\t\t\t}\n\t\t}\n\t\tbreak;\n\t  }\n\tcase HFS_NEW_PMAP_MAGIC:\n\t  {\n\t\tstruct new_pmap *pm;\n\n\t\tpm = (struct new_pmap *)bh->b_data;\n\t\tsize = be32_to_cpu(pm->pmMapBlkCnt);\n\t\tfor (i = 0; i < size;) {\n\t\t\tif (!memcmp(pm->pmPartType,\"Apple_HFS\", 9) &&\n\t\t\t    (HFS_SB(sb)->part < 0 || HFS_SB(sb)->part == i)) {\n\t\t\t\t*part_start += be32_to_cpu(pm->pmPyPartStart);\n\t\t\t\t*part_size = be32_to_cpu(pm->pmPartBlkCnt);\n\t\t\t\tres = 0;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tbrelse(bh);\n\t\t\tbh = sb_bread512(sb, *part_start + HFS_PMAP_BLK + ++i, pm);\n\t\t\tif (!bh)\n\t\t\t\treturn -EIO;\n\t\t\tif (pm->pmSig != cpu_to_be16(HFS_NEW_PMAP_MAGIC))\n\t\t\t\tbreak;\n\t\t}\n\t\tbreak;\n\t  }\n\t}\n\tbrelse(bh);\n\n\treturn res;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}