{
  "module_name": "vxfs_olt.c",
  "hash_id": "7219398bfbad3b934fdbe8688465e2f5c1a5acb40612dbc4f2a152e6d26159bf",
  "original_prompt": "Ingested from linux-6.6.14/fs/freevxfs/vxfs_olt.c",
  "human_readable_source": "\n \n\n \n#include <linux/fs.h>\n#include <linux/buffer_head.h>\n#include <linux/kernel.h>\n\n#include \"vxfs.h\"\n#include \"vxfs_olt.h\"\n#include \"vxfs_extern.h\"\n\n\nstatic inline void\nvxfs_get_fshead(struct vxfs_oltfshead *fshp, struct vxfs_sb_info *infp)\n{\n\tBUG_ON(infp->vsi_fshino);\n\tinfp->vsi_fshino = fs32_to_cpu(infp, fshp->olt_fsino[0]);\n}\n\nstatic inline void\nvxfs_get_ilist(struct vxfs_oltilist *ilistp, struct vxfs_sb_info *infp)\n{\n\tBUG_ON(infp->vsi_iext);\n\tinfp->vsi_iext = fs32_to_cpu(infp, ilistp->olt_iext[0]);\n}\n\nstatic inline u_long\nvxfs_oblock(struct super_block *sbp, daddr_t block, u_long bsize)\n{\n\tBUG_ON(sbp->s_blocksize % bsize);\n\treturn (block * (sbp->s_blocksize / bsize));\n}\n\n\n \nint\nvxfs_read_olt(struct super_block *sbp, u_long bsize)\n{\n\tstruct vxfs_sb_info\t*infp = VXFS_SBI(sbp);\n\tstruct buffer_head\t*bp;\n\tstruct vxfs_olt\t\t*op;\n\tchar\t\t\t*oaddr, *eaddr;\n\n\tbp = sb_bread(sbp, vxfs_oblock(sbp, infp->vsi_oltext, bsize));\n\tif (!bp || !bp->b_data)\n\t\tgoto fail;\n\n\top = (struct vxfs_olt *)bp->b_data;\n\tif (fs32_to_cpu(infp, op->olt_magic) != VXFS_OLT_MAGIC) {\n\t\tprintk(KERN_NOTICE \"vxfs: ivalid olt magic number\\n\");\n\t\tgoto fail;\n\t}\n\n\t \n\tif (infp->vsi_oltsize > 1) {\n\t\tprintk(KERN_NOTICE \"vxfs: oltsize > 1 detected.\\n\");\n\t\tprintk(KERN_NOTICE \"vxfs: please notify hch@infradead.org\\n\");\n\t\tgoto fail;\n\t}\n\n\toaddr = bp->b_data + fs32_to_cpu(infp, op->olt_size);\n\teaddr = bp->b_data + (infp->vsi_oltsize * sbp->s_blocksize);\n\n\twhile (oaddr < eaddr) {\n\t\tstruct vxfs_oltcommon\t*ocp =\n\t\t\t(struct vxfs_oltcommon *)oaddr;\n\t\t\n\t\tswitch (fs32_to_cpu(infp, ocp->olt_type)) {\n\t\tcase VXFS_OLT_FSHEAD:\n\t\t\tvxfs_get_fshead((struct vxfs_oltfshead *)oaddr, infp);\n\t\t\tbreak;\n\t\tcase VXFS_OLT_ILIST:\n\t\t\tvxfs_get_ilist((struct vxfs_oltilist *)oaddr, infp);\n\t\t\tbreak;\n\t\t}\n\n\t\toaddr += fs32_to_cpu(infp, ocp->olt_size);\n\t}\n\n\tbrelse(bp);\n\treturn (infp->vsi_fshino && infp->vsi_iext) ? 0 : -EINVAL;\n\nfail:\n\tbrelse(bp);\n\treturn -EINVAL;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}