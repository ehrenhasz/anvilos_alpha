{
  "module_name": "dir.c",
  "hash_id": "c8e330d8997fa6517799e69dacfd77defaa1a12d7e267f349523dfa74dbd6716",
  "original_prompt": "Ingested from linux-6.6.14/fs/qnx4/dir.c",
  "human_readable_source": "\n \n\n#include <linux/buffer_head.h>\n#include \"qnx4.h\"\n\n \nunion qnx4_directory_entry {\n\tstruct {\n\t\tconst char de_name[48];\n\t\tu8 de_pad[15];\n\t\tu8 de_status;\n\t};\n\tstruct qnx4_inode_entry inode;\n\tstruct qnx4_link_info link;\n};\n\nstatic int qnx4_readdir(struct file *file, struct dir_context *ctx)\n{\n\tstruct inode *inode = file_inode(file);\n\tunsigned int offset;\n\tstruct buffer_head *bh;\n\tunsigned long blknum;\n\tint ix, ino;\n\tint size;\n\n\tQNX4DEBUG((KERN_INFO \"qnx4_readdir:i_size = %ld\\n\", (long) inode->i_size));\n\tQNX4DEBUG((KERN_INFO \"pos                 = %ld\\n\", (long) ctx->pos));\n\n\twhile (ctx->pos < inode->i_size) {\n\t\tblknum = qnx4_block_map(inode, ctx->pos >> QNX4_BLOCK_SIZE_BITS);\n\t\tbh = sb_bread(inode->i_sb, blknum);\n\t\tif (bh == NULL) {\n\t\t\tprintk(KERN_ERR \"qnx4_readdir: bread failed (%ld)\\n\", blknum);\n\t\t\treturn 0;\n\t\t}\n\t\tix = (ctx->pos >> QNX4_DIR_ENTRY_SIZE_BITS) % QNX4_INODES_PER_BLOCK;\n\t\tfor (; ix < QNX4_INODES_PER_BLOCK; ix++, ctx->pos += QNX4_DIR_ENTRY_SIZE) {\n\t\t\tunion qnx4_directory_entry *de;\n\n\t\t\toffset = ix * QNX4_DIR_ENTRY_SIZE;\n\t\t\tde = (union qnx4_directory_entry *) (bh->b_data + offset);\n\n\t\t\tif (!de->de_name[0])\n\t\t\t\tcontinue;\n\t\t\tif (!(de->de_status & (QNX4_FILE_USED|QNX4_FILE_LINK)))\n\t\t\t\tcontinue;\n\t\t\tif (!(de->de_status & QNX4_FILE_LINK)) {\n\t\t\t\tsize = sizeof(de->inode.di_fname);\n\t\t\t\tino = blknum * QNX4_INODES_PER_BLOCK + ix - 1;\n\t\t\t} else {\n\t\t\t\tsize = sizeof(de->link.dl_fname);\n\t\t\t\tino = ( le32_to_cpu(de->link.dl_inode_blk) - 1 ) *\n\t\t\t\t\tQNX4_INODES_PER_BLOCK +\n\t\t\t\t\tde->link.dl_inode_ndx;\n\t\t\t}\n\t\t\tsize = strnlen(de->de_name, size);\n\t\t\tQNX4DEBUG((KERN_INFO \"qnx4_readdir:%.*s\\n\", size, name));\n\t\t\tif (!dir_emit(ctx, de->de_name, size, ino, DT_UNKNOWN)) {\n\t\t\t\tbrelse(bh);\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t}\n\t\tbrelse(bh);\n\t}\n\treturn 0;\n}\n\nconst struct file_operations qnx4_dir_operations =\n{\n\t.llseek\t\t= generic_file_llseek,\n\t.read\t\t= generic_read_dir,\n\t.iterate_shared\t= qnx4_readdir,\n\t.fsync\t\t= generic_file_fsync,\n};\n\nconst struct inode_operations qnx4_dir_inode_operations =\n{\n\t.lookup\t\t= qnx4_lookup,\n};\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}