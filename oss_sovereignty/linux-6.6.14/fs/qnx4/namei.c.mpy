{
  "module_name": "namei.c",
  "hash_id": "eec22a066e4987118ab0707b5acac04d7442fe84e2c780bdd8b22ea009b890ac",
  "original_prompt": "Ingested from linux-6.6.14/fs/qnx4/namei.c",
  "human_readable_source": "\n \n\n#include <linux/buffer_head.h>\n#include \"qnx4.h\"\n\n\n \nstatic int qnx4_match(int len, const char *name,\n\t\t      struct buffer_head *bh, unsigned long *offset)\n{\n\tstruct qnx4_inode_entry *de;\n\tint namelen, thislen;\n\n\tif (bh == NULL) {\n\t\tprintk(KERN_WARNING \"qnx4: matching unassigned buffer !\\n\");\n\t\treturn 0;\n\t}\n\tde = (struct qnx4_inode_entry *) (bh->b_data + *offset);\n\t*offset += QNX4_DIR_ENTRY_SIZE;\n\tif ((de->di_status & QNX4_FILE_LINK) != 0) {\n\t\tnamelen = QNX4_NAME_MAX;\n\t} else {\n\t\tnamelen = QNX4_SHORT_NAME_MAX;\n\t}\n\tthislen = strlen( de->di_fname );\n\tif ( thislen > namelen )\n\t\tthislen = namelen;\n\tif (len != thislen) {\n\t\treturn 0;\n\t}\n\tif (strncmp(name, de->di_fname, len) == 0) {\n\t\tif ((de->di_status & (QNX4_FILE_USED|QNX4_FILE_LINK)) != 0) {\n\t\t\treturn 1;\n\t\t}\n\t}\n\treturn 0;\n}\n\nstatic struct buffer_head *qnx4_find_entry(int len, struct inode *dir,\n\t   const char *name, struct qnx4_inode_entry **res_dir, int *ino)\n{\n\tunsigned long block, offset, blkofs;\n\tstruct buffer_head *bh;\n\n\t*res_dir = NULL;\n\tbh = NULL;\n\tblock = offset = blkofs = 0;\n\twhile (blkofs * QNX4_BLOCK_SIZE + offset < dir->i_size) {\n\t\tif (!bh) {\n\t\t\tblock = qnx4_block_map(dir, blkofs);\n\t\t\tif (block)\n\t\t\t\tbh = sb_bread(dir->i_sb, block);\n\t\t\tif (!bh) {\n\t\t\t\tblkofs++;\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t}\n\t\t*res_dir = (struct qnx4_inode_entry *) (bh->b_data + offset);\n\t\tif (qnx4_match(len, name, bh, &offset)) {\n\t\t\t*ino = block * QNX4_INODES_PER_BLOCK +\n\t\t\t    (offset / QNX4_DIR_ENTRY_SIZE) - 1;\n\t\t\treturn bh;\n\t\t}\n\t\tif (offset < bh->b_size) {\n\t\t\tcontinue;\n\t\t}\n\t\tbrelse(bh);\n\t\tbh = NULL;\n\t\toffset = 0;\n\t\tblkofs++;\n\t}\n\tbrelse(bh);\n\t*res_dir = NULL;\n\treturn NULL;\n}\n\nstruct dentry * qnx4_lookup(struct inode *dir, struct dentry *dentry, unsigned int flags)\n{\n\tint ino;\n\tstruct qnx4_inode_entry *de;\n\tstruct qnx4_link_info *lnk;\n\tstruct buffer_head *bh;\n\tconst char *name = dentry->d_name.name;\n\tint len = dentry->d_name.len;\n\tstruct inode *foundinode = NULL;\n\n\tif (!(bh = qnx4_find_entry(len, dir, name, &de, &ino)))\n\t\tgoto out;\n\t \n\tif ((de->di_status & QNX4_FILE_LINK) == QNX4_FILE_LINK) {\n\t\tlnk = (struct qnx4_link_info *) de;\n\t\tino = (le32_to_cpu(lnk->dl_inode_blk) - 1) *\n                    QNX4_INODES_PER_BLOCK +\n\t\t    lnk->dl_inode_ndx;\n\t}\n\tbrelse(bh);\n\n\tfoundinode = qnx4_iget(dir->i_sb, ino);\n\tif (IS_ERR(foundinode))\n\t\tQNX4DEBUG((KERN_ERR \"qnx4: lookup->iget -> error %ld\\n\",\n\t\t\t   PTR_ERR(foundinode)));\nout:\n\treturn d_splice_alias(foundinode, dentry);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}