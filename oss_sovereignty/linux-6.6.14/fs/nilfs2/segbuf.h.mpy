{
  "module_name": "segbuf.h",
  "hash_id": "570d130d029102062888303dcc8390d134b800579495f4de20d2047902622208",
  "original_prompt": "Ingested from linux-6.6.14/fs/nilfs2/segbuf.h",
  "human_readable_source": " \n \n#ifndef _NILFS_SEGBUF_H\n#define _NILFS_SEGBUF_H\n\n#include <linux/fs.h>\n#include <linux/buffer_head.h>\n#include <linux/bio.h>\n#include <linux/completion.h>\n\n \nstruct nilfs_segsum_info {\n\tunsigned int\t\tflags;\n\tunsigned long\t\tnfinfo;\n\tunsigned long\t\tnblocks;\n\tunsigned long\t\tnsumblk;\n\tunsigned long\t\tsumbytes;\n\tunsigned long\t\tnfileblk;\n\tu64\t\t\tseg_seq;\n\t__u64\t\t\tcno;\n\ttime64_t\t\tctime;\n\tsector_t\t\tnext;\n};\n\n \nstruct nilfs_segment_buffer {\n\tstruct super_block     *sb_super;\n\tstruct list_head\tsb_list;\n\n\t \n\tstruct nilfs_segsum_info sb_sum;\n\t__u64\t\t\tsb_segnum;\n\t__u64\t\t\tsb_nextnum;\n\tsector_t\t\tsb_fseg_start, sb_fseg_end;\n\tsector_t\t\tsb_pseg_start;\n\tunsigned int\t\tsb_rest_blocks;\n\n\t \n\tstruct list_head\tsb_segsum_buffers;\n\tstruct list_head\tsb_payload_buffers;  \n\tstruct buffer_head     *sb_super_root;\n\n\t \n\tint\t\t\tsb_nbio;\n\tatomic_t\t\tsb_err;\n\tstruct completion\tsb_bio_event;\n};\n\n#define NILFS_LIST_SEGBUF(head)  \\\n\tlist_entry((head), struct nilfs_segment_buffer, sb_list)\n#define NILFS_NEXT_SEGBUF(segbuf)  NILFS_LIST_SEGBUF((segbuf)->sb_list.next)\n#define NILFS_PREV_SEGBUF(segbuf)  NILFS_LIST_SEGBUF((segbuf)->sb_list.prev)\n#define NILFS_LAST_SEGBUF(head)    NILFS_LIST_SEGBUF((head)->prev)\n#define NILFS_FIRST_SEGBUF(head)   NILFS_LIST_SEGBUF((head)->next)\n#define NILFS_SEGBUF_IS_LAST(segbuf, head)  ((segbuf)->sb_list.next == (head))\n\n#define nilfs_for_each_segbuf_before(s, t, h) \\\n\tfor ((s) = NILFS_FIRST_SEGBUF(h); (s) != (t); \\\n\t     (s) = NILFS_NEXT_SEGBUF(s))\n\n#define NILFS_SEGBUF_FIRST_BH(head)  \\\n\t(list_entry((head)->next, struct buffer_head, b_assoc_buffers))\n#define NILFS_SEGBUF_NEXT_BH(bh)  \\\n\t(list_entry((bh)->b_assoc_buffers.next, struct buffer_head, \\\n\t\t    b_assoc_buffers))\n#define NILFS_SEGBUF_BH_IS_LAST(bh, head)  ((bh)->b_assoc_buffers.next == head)\n\nextern struct kmem_cache *nilfs_segbuf_cachep;\n\nstruct nilfs_segment_buffer *nilfs_segbuf_new(struct super_block *);\nvoid nilfs_segbuf_free(struct nilfs_segment_buffer *);\nvoid nilfs_segbuf_map(struct nilfs_segment_buffer *, __u64, unsigned long,\n\t\t      struct the_nilfs *);\nvoid nilfs_segbuf_map_cont(struct nilfs_segment_buffer *segbuf,\n\t\t\t   struct nilfs_segment_buffer *prev);\nvoid nilfs_segbuf_set_next_segnum(struct nilfs_segment_buffer *, __u64,\n\t\t\t\t  struct the_nilfs *);\nint nilfs_segbuf_reset(struct nilfs_segment_buffer *, unsigned int, time64_t,\n\t\t       __u64);\nint nilfs_segbuf_extend_segsum(struct nilfs_segment_buffer *);\nint nilfs_segbuf_extend_payload(struct nilfs_segment_buffer *,\n\t\t\t\tstruct buffer_head **);\nvoid nilfs_segbuf_fill_in_segsum(struct nilfs_segment_buffer *);\n\nstatic inline int nilfs_segbuf_simplex(struct nilfs_segment_buffer *segbuf)\n{\n\tunsigned int flags = segbuf->sb_sum.flags;\n\n\treturn (flags & (NILFS_SS_LOGBGN | NILFS_SS_LOGEND)) ==\n\t\t(NILFS_SS_LOGBGN | NILFS_SS_LOGEND);\n}\n\nstatic inline int nilfs_segbuf_empty(struct nilfs_segment_buffer *segbuf)\n{\n\treturn segbuf->sb_sum.nblocks == segbuf->sb_sum.nsumblk;\n}\n\nstatic inline void\nnilfs_segbuf_add_segsum_buffer(struct nilfs_segment_buffer *segbuf,\n\t\t\t       struct buffer_head *bh)\n{\n\tlist_add_tail(&bh->b_assoc_buffers, &segbuf->sb_segsum_buffers);\n\tsegbuf->sb_sum.nblocks++;\n\tsegbuf->sb_sum.nsumblk++;\n}\n\nstatic inline void\nnilfs_segbuf_add_payload_buffer(struct nilfs_segment_buffer *segbuf,\n\t\t\t\tstruct buffer_head *bh)\n{\n\tlist_add_tail(&bh->b_assoc_buffers, &segbuf->sb_payload_buffers);\n\tsegbuf->sb_sum.nblocks++;\n}\n\nstatic inline void\nnilfs_segbuf_add_file_buffer(struct nilfs_segment_buffer *segbuf,\n\t\t\t     struct buffer_head *bh)\n{\n\tget_bh(bh);\n\tnilfs_segbuf_add_payload_buffer(segbuf, bh);\n\tsegbuf->sb_sum.nfileblk++;\n}\n\nvoid nilfs_clear_logs(struct list_head *logs);\nvoid nilfs_truncate_logs(struct list_head *logs,\n\t\t\t struct nilfs_segment_buffer *last);\nint nilfs_write_logs(struct list_head *logs, struct the_nilfs *nilfs);\nint nilfs_wait_on_logs(struct list_head *logs);\nvoid nilfs_add_checksums_on_logs(struct list_head *logs, u32 seed);\n\nstatic inline void nilfs_destroy_logs(struct list_head *logs)\n{\n\tnilfs_truncate_logs(logs, NULL);\n}\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}