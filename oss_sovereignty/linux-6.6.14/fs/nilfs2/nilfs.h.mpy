{
  "module_name": "nilfs.h",
  "hash_id": "cda40e18044a21f85d3bef6ccb039c7dac64cfd8394d325fd243ae078032780a",
  "original_prompt": "Ingested from linux-6.6.14/fs/nilfs2/nilfs.h",
  "human_readable_source": " \n \n\n#ifndef _NILFS_H\n#define _NILFS_H\n\n#include <linux/kernel.h>\n#include <linux/buffer_head.h>\n#include <linux/spinlock.h>\n#include <linux/blkdev.h>\n#include <linux/nilfs2_api.h>\n#include <linux/nilfs2_ondisk.h>\n#include \"the_nilfs.h\"\n#include \"bmap.h\"\n\n \nstruct nilfs_inode_info {\n\t__u32 i_flags;\n\tunsigned long  i_state;\t\t \n\tstruct nilfs_bmap *i_bmap;\n\tstruct nilfs_bmap i_bmap_data;\n\t__u64 i_xattr;\t \n\t__u32 i_dir_start_lookup;\n\t__u64 i_cno;\t\t \n\tstruct inode *i_assoc_inode;\n\tstruct list_head i_dirty;\t \n\n#ifdef CONFIG_NILFS_XATTR\n\t \n\tstruct rw_semaphore xattr_sem;\n#endif\n\tstruct buffer_head *i_bh;\t \n\tstruct nilfs_root *i_root;\n\tstruct inode vfs_inode;\n};\n\nstatic inline struct nilfs_inode_info *NILFS_I(const struct inode *inode)\n{\n\treturn container_of(inode, struct nilfs_inode_info, vfs_inode);\n}\n\nstatic inline struct nilfs_inode_info *\nNILFS_BMAP_I(const struct nilfs_bmap *bmap)\n{\n\treturn container_of(bmap, struct nilfs_inode_info, i_bmap_data);\n}\n\n \nenum {\n\tNILFS_I_NEW = 0,\t\t \n\tNILFS_I_DIRTY,\t\t\t \n\tNILFS_I_QUEUED,\t\t\t \n\tNILFS_I_BUSY,\t\t\t \n\tNILFS_I_COLLECTED,\t\t \n\tNILFS_I_UPDATED,\t\t \n\tNILFS_I_INODE_SYNC,\t\t \n\tNILFS_I_BMAP,\t\t\t \n\tNILFS_I_GCINODE,\t\t \n\tNILFS_I_BTNC,\t\t\t \n\tNILFS_I_SHADOW,\t\t\t \n};\n\n \nenum {\n\tNILFS_SB_COMMIT = 0,\t \n\tNILFS_SB_COMMIT_ALL\t \n};\n\n \n#define NILFS_MDT_INO_BITS\t\t\t\t\t\t\\\n\t(BIT(NILFS_DAT_INO) | BIT(NILFS_CPFILE_INO) |\t\t\t\\\n\t BIT(NILFS_SUFILE_INO) | BIT(NILFS_IFILE_INO) |\t\t\t\\\n\t BIT(NILFS_ATIME_INO) | BIT(NILFS_SKETCH_INO))\n\n#define NILFS_SYS_INO_BITS (BIT(NILFS_ROOT_INO) | NILFS_MDT_INO_BITS)\n\n#define NILFS_FIRST_INO(sb) (((struct the_nilfs *)sb->s_fs_info)->ns_first_ino)\n\n#define NILFS_MDT_INODE(sb, ino) \\\n\t((ino) < NILFS_FIRST_INO(sb) && (NILFS_MDT_INO_BITS & BIT(ino)))\n#define NILFS_VALID_INODE(sb, ino) \\\n\t((ino) >= NILFS_FIRST_INO(sb) || (NILFS_SYS_INO_BITS & BIT(ino)))\n\n \nstruct nilfs_transaction_info {\n\tu32\t\t\tti_magic;\n\tvoid\t\t       *ti_save;\n\t\t\t\t \n\tunsigned short\t\tti_flags;\n\tunsigned short\t\tti_count;\n};\n\n \n#define NILFS_TI_MAGIC\t\t0xd9e392fb\n\n \n#define NILFS_TI_DYNAMIC_ALLOC\t0x0001   \n#define NILFS_TI_SYNC\t\t0x0002\t \n#define NILFS_TI_GC\t\t0x0004\t \n#define NILFS_TI_COMMIT\t\t0x0008\t \n#define NILFS_TI_WRITER\t\t0x0010\t \n\n\nint nilfs_transaction_begin(struct super_block *,\n\t\t\t    struct nilfs_transaction_info *, int);\nint nilfs_transaction_commit(struct super_block *);\nvoid nilfs_transaction_abort(struct super_block *);\n\nstatic inline void nilfs_set_transaction_flag(unsigned int flag)\n{\n\tstruct nilfs_transaction_info *ti = current->journal_info;\n\n\tti->ti_flags |= flag;\n}\n\nstatic inline int nilfs_test_transaction_flag(unsigned int flag)\n{\n\tstruct nilfs_transaction_info *ti = current->journal_info;\n\n\tif (ti == NULL || ti->ti_magic != NILFS_TI_MAGIC)\n\t\treturn 0;\n\treturn !!(ti->ti_flags & flag);\n}\n\nstatic inline int nilfs_doing_gc(void)\n{\n\treturn nilfs_test_transaction_flag(NILFS_TI_GC);\n}\n\nstatic inline int nilfs_doing_construction(void)\n{\n\treturn nilfs_test_transaction_flag(NILFS_TI_WRITER);\n}\n\n \n#ifdef CONFIG_NILFS_POSIX_ACL\n#error \"NILFS: not yet supported POSIX ACL\"\nextern int nilfs_acl_chmod(struct inode *);\nextern int nilfs_init_acl(struct inode *, struct inode *);\n#else\nstatic inline int nilfs_acl_chmod(struct inode *inode)\n{\n\treturn 0;\n}\n\nstatic inline int nilfs_init_acl(struct inode *inode, struct inode *dir)\n{\n\tif (S_ISLNK(inode->i_mode))\n\t\treturn 0;\n\n\tinode->i_mode &= ~current_umask();\n\treturn 0;\n}\n#endif\n\n#define NILFS_ATIME_DISABLE\n\n \n#define NILFS_FL_INHERITED\t\t\t\t\t\t\\\n\t(FS_SECRM_FL | FS_UNRM_FL | FS_COMPR_FL | FS_SYNC_FL |\t\t\\\n\t FS_IMMUTABLE_FL | FS_APPEND_FL | FS_NODUMP_FL | FS_NOATIME_FL |\\\n\t FS_COMPRBLK_FL | FS_NOCOMP_FL | FS_NOTAIL_FL | FS_DIRSYNC_FL)\n\n \nstatic inline __u32 nilfs_mask_flags(umode_t mode, __u32 flags)\n{\n\tif (S_ISDIR(mode))\n\t\treturn flags;\n\telse if (S_ISREG(mode))\n\t\treturn flags & ~(FS_DIRSYNC_FL | FS_TOPDIR_FL);\n\telse\n\t\treturn flags & (FS_NODUMP_FL | FS_NOATIME_FL);\n}\n\n \nextern int nilfs_add_link(struct dentry *, struct inode *);\nextern ino_t nilfs_inode_by_name(struct inode *, const struct qstr *);\nextern int nilfs_make_empty(struct inode *, struct inode *);\nextern struct nilfs_dir_entry *\nnilfs_find_entry(struct inode *, const struct qstr *, struct page **);\nextern int nilfs_delete_entry(struct nilfs_dir_entry *, struct page *);\nextern int nilfs_empty_dir(struct inode *);\nextern struct nilfs_dir_entry *nilfs_dotdot(struct inode *, struct page **);\nextern void nilfs_set_link(struct inode *, struct nilfs_dir_entry *,\n\t\t\t   struct page *, struct inode *);\n\n \nextern int nilfs_sync_file(struct file *, loff_t, loff_t, int);\n\n \nint nilfs_fileattr_get(struct dentry *dentry, struct fileattr *m);\nint nilfs_fileattr_set(struct mnt_idmap *idmap,\n\t\t       struct dentry *dentry, struct fileattr *fa);\nlong nilfs_ioctl(struct file *, unsigned int, unsigned long);\nlong nilfs_compat_ioctl(struct file *file, unsigned int cmd, unsigned long arg);\nint nilfs_ioctl_prepare_clean_segments(struct the_nilfs *, struct nilfs_argv *,\n\t\t\t\t       void **);\n\n \nvoid nilfs_inode_add_blocks(struct inode *inode, int n);\nvoid nilfs_inode_sub_blocks(struct inode *inode, int n);\nextern struct inode *nilfs_new_inode(struct inode *, umode_t);\nextern int nilfs_get_block(struct inode *, sector_t, struct buffer_head *, int);\nextern void nilfs_set_inode_flags(struct inode *);\nextern int nilfs_read_inode_common(struct inode *, struct nilfs_inode *);\nextern void nilfs_write_inode_common(struct inode *, struct nilfs_inode *, int);\nstruct inode *nilfs_ilookup(struct super_block *sb, struct nilfs_root *root,\n\t\t\t    unsigned long ino);\nstruct inode *nilfs_iget_locked(struct super_block *sb, struct nilfs_root *root,\n\t\t\t\tunsigned long ino);\nstruct inode *nilfs_iget(struct super_block *sb, struct nilfs_root *root,\n\t\t\t unsigned long ino);\nextern struct inode *nilfs_iget_for_gc(struct super_block *sb,\n\t\t\t\t       unsigned long ino, __u64 cno);\nint nilfs_attach_btree_node_cache(struct inode *inode);\nvoid nilfs_detach_btree_node_cache(struct inode *inode);\nstruct inode *nilfs_iget_for_shadow(struct inode *inode);\nextern void nilfs_update_inode(struct inode *, struct buffer_head *, int);\nextern void nilfs_truncate(struct inode *);\nextern void nilfs_evict_inode(struct inode *);\nextern int nilfs_setattr(struct mnt_idmap *, struct dentry *,\n\t\t\t struct iattr *);\nextern void nilfs_write_failed(struct address_space *mapping, loff_t to);\nint nilfs_permission(struct mnt_idmap *idmap, struct inode *inode,\n\t\t     int mask);\nint nilfs_load_inode_block(struct inode *inode, struct buffer_head **pbh);\nextern int nilfs_inode_dirty(struct inode *);\nint nilfs_set_file_dirty(struct inode *inode, unsigned int nr_dirty);\nextern int __nilfs_mark_inode_dirty(struct inode *, int);\nextern void nilfs_dirty_inode(struct inode *, int flags);\nint nilfs_fiemap(struct inode *inode, struct fiemap_extent_info *fieinfo,\n\t\t __u64 start, __u64 len);\nstatic inline int nilfs_mark_inode_dirty(struct inode *inode)\n{\n\treturn __nilfs_mark_inode_dirty(inode, I_DIRTY);\n}\nstatic inline int nilfs_mark_inode_dirty_sync(struct inode *inode)\n{\n\treturn __nilfs_mark_inode_dirty(inode, I_DIRTY_SYNC);\n}\n\n \nextern struct inode *nilfs_alloc_inode(struct super_block *);\n\n__printf(2, 3)\nvoid __nilfs_msg(struct super_block *sb, const char *fmt, ...);\nextern __printf(3, 4)\nvoid __nilfs_error(struct super_block *sb, const char *function,\n\t\t   const char *fmt, ...);\n\n#ifdef CONFIG_PRINTK\n\n#define nilfs_msg(sb, level, fmt, ...)\t\t\t\t\t\\\n\t__nilfs_msg(sb, level fmt, ##__VA_ARGS__)\n#define nilfs_error(sb, fmt, ...)\t\t\t\t\t\\\n\t__nilfs_error(sb, __func__, fmt, ##__VA_ARGS__)\n\n#else\n\n#define nilfs_msg(sb, level, fmt, ...)\t\t\t\t\t\\\n\tdo {\t\t\t\t\t\t\t\t\\\n\t\tno_printk(level fmt, ##__VA_ARGS__);\t\t\t\\\n\t\t(void)(sb);\t\t\t\t\t\t\\\n\t} while (0)\n#define nilfs_error(sb, fmt, ...)\t\t\t\t\t\\\n\tdo {\t\t\t\t\t\t\t\t\\\n\t\tno_printk(fmt, ##__VA_ARGS__);\t\t\t\t\\\n\t\t__nilfs_error(sb, \"\", \" \");\t\t\t\t\\\n\t} while (0)\n\n#endif  \n\n#define nilfs_crit(sb, fmt, ...)\t\t\t\t\t\\\n\tnilfs_msg(sb, KERN_CRIT, fmt, ##__VA_ARGS__)\n#define nilfs_err(sb, fmt, ...)\t\t\t\t\t\t\\\n\tnilfs_msg(sb, KERN_ERR, fmt, ##__VA_ARGS__)\n#define nilfs_warn(sb, fmt, ...)\t\t\t\t\t\\\n\tnilfs_msg(sb, KERN_WARNING, fmt, ##__VA_ARGS__)\n#define nilfs_info(sb, fmt, ...)\t\t\t\t\t\\\n\tnilfs_msg(sb, KERN_INFO, fmt, ##__VA_ARGS__)\n\nextern struct nilfs_super_block *\nnilfs_read_super_block(struct super_block *, u64, int, struct buffer_head **);\nextern int nilfs_store_magic_and_option(struct super_block *,\n\t\t\t\t\tstruct nilfs_super_block *, char *);\nextern int nilfs_check_feature_compatibility(struct super_block *,\n\t\t\t\t\t     struct nilfs_super_block *);\nextern void nilfs_set_log_cursor(struct nilfs_super_block *,\n\t\t\t\t struct the_nilfs *);\nstruct nilfs_super_block **nilfs_prepare_super(struct super_block *sb,\n\t\t\t\t\t       int flip);\nint nilfs_commit_super(struct super_block *sb, int flag);\nint nilfs_cleanup_super(struct super_block *sb);\nint nilfs_resize_fs(struct super_block *sb, __u64 newsize);\nint nilfs_attach_checkpoint(struct super_block *sb, __u64 cno, int curr_mnt,\n\t\t\t    struct nilfs_root **root);\nint nilfs_checkpoint_is_mounted(struct super_block *sb, __u64 cno);\n\n \nint nilfs_gccache_submit_read_data(struct inode *, sector_t, sector_t, __u64,\n\t\t\t\t   struct buffer_head **);\nint nilfs_gccache_submit_read_node(struct inode *, sector_t, __u64,\n\t\t\t\t   struct buffer_head **);\nint nilfs_gccache_wait_and_mark_dirty(struct buffer_head *);\nint nilfs_init_gcinode(struct inode *inode);\nvoid nilfs_remove_all_gcinodes(struct the_nilfs *nilfs);\n\n \nint __init nilfs_sysfs_init(void);\nvoid nilfs_sysfs_exit(void);\nint nilfs_sysfs_create_device_group(struct super_block *);\nvoid nilfs_sysfs_delete_device_group(struct the_nilfs *);\nint nilfs_sysfs_create_snapshot_group(struct nilfs_root *);\nvoid nilfs_sysfs_delete_snapshot_group(struct nilfs_root *);\n\n \nextern const struct file_operations nilfs_dir_operations;\nextern const struct inode_operations nilfs_file_inode_operations;\nextern const struct file_operations nilfs_file_operations;\nextern const struct address_space_operations nilfs_aops;\nextern const struct inode_operations nilfs_dir_inode_operations;\nextern const struct inode_operations nilfs_special_inode_operations;\nextern const struct inode_operations nilfs_symlink_inode_operations;\n\n \nextern struct file_system_type nilfs_fs_type;\n\n\n#endif\t \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}