{
  "module_name": "mdt.h",
  "hash_id": "06deae1f739c9f752fee48a9281498e11c41268f3568c2464d0a4093d43fd56e",
  "original_prompt": "Ingested from linux-6.6.14/fs/nilfs2/mdt.h",
  "human_readable_source": " \n \n\n#ifndef _NILFS_MDT_H\n#define _NILFS_MDT_H\n\n#include <linux/buffer_head.h>\n#include <linux/blockgroup_lock.h>\n#include \"nilfs.h\"\n#include \"page.h\"\n\n \nstruct nilfs_shadow_map {\n\tstruct nilfs_bmap_store bmap_store;\n\tstruct inode *inode;\n\tstruct list_head frozen_buffers;\n};\n\n \nstruct nilfs_mdt_info {\n\tstruct rw_semaphore\tmi_sem;\n\tstruct blockgroup_lock *mi_bgl;\n\tunsigned int\t\tmi_entry_size;\n\tunsigned int\t\tmi_first_entry_offset;\n\tunsigned long\t\tmi_entries_per_block;\n\tstruct nilfs_palloc_cache *mi_palloc_cache;\n\tstruct nilfs_shadow_map *mi_shadow;\n\tunsigned long\t\tmi_blocks_per_group;\n\tunsigned long\t\tmi_blocks_per_desc_block;\n};\n\nstatic inline struct nilfs_mdt_info *NILFS_MDT(const struct inode *inode)\n{\n\treturn inode->i_private;\n}\n\nstatic inline int nilfs_is_metadata_file_inode(const struct inode *inode)\n{\n\treturn inode->i_private != NULL;\n}\n\n \n#define NILFS_MDT_GFP      (__GFP_RECLAIM | __GFP_IO | __GFP_HIGHMEM)\n\nint nilfs_mdt_get_block(struct inode *, unsigned long, int,\n\t\t\tvoid (*init_block)(struct inode *,\n\t\t\t\t\t   struct buffer_head *, void *),\n\t\t\tstruct buffer_head **);\nint nilfs_mdt_find_block(struct inode *inode, unsigned long start,\n\t\t\t unsigned long end, unsigned long *blkoff,\n\t\t\t struct buffer_head **out_bh);\nint nilfs_mdt_delete_block(struct inode *, unsigned long);\nint nilfs_mdt_forget_block(struct inode *, unsigned long);\nint nilfs_mdt_fetch_dirty(struct inode *);\n\nint nilfs_mdt_init(struct inode *inode, gfp_t gfp_mask, size_t objsz);\nvoid nilfs_mdt_clear(struct inode *inode);\nvoid nilfs_mdt_destroy(struct inode *inode);\n\nvoid nilfs_mdt_set_entry_size(struct inode *, unsigned int, unsigned int);\n\nint nilfs_mdt_setup_shadow_map(struct inode *inode,\n\t\t\t       struct nilfs_shadow_map *shadow);\nint nilfs_mdt_save_to_shadow_map(struct inode *inode);\nvoid nilfs_mdt_restore_from_shadow_map(struct inode *inode);\nvoid nilfs_mdt_clear_shadow_map(struct inode *inode);\nint nilfs_mdt_freeze_buffer(struct inode *inode, struct buffer_head *bh);\nstruct buffer_head *nilfs_mdt_get_frozen_buffer(struct inode *inode,\n\t\t\t\t\t\tstruct buffer_head *bh);\n\nstatic inline void nilfs_mdt_mark_dirty(struct inode *inode)\n{\n\tif (!test_bit(NILFS_I_DIRTY, &NILFS_I(inode)->i_state))\n\t\tset_bit(NILFS_I_DIRTY, &NILFS_I(inode)->i_state);\n}\n\nstatic inline void nilfs_mdt_clear_dirty(struct inode *inode)\n{\n\tclear_bit(NILFS_I_DIRTY, &NILFS_I(inode)->i_state);\n}\n\nstatic inline __u64 nilfs_mdt_cno(struct inode *inode)\n{\n\treturn ((struct the_nilfs *)inode->i_sb->s_fs_info)->ns_cno;\n}\n\nstatic inline spinlock_t *\nnilfs_mdt_bgl_lock(struct inode *inode, unsigned int block_group)\n{\n\treturn bgl_lock_ptr(NILFS_MDT(inode)->mi_bgl, block_group);\n}\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}