{
  "module_name": "super.c",
  "hash_id": "37329eb0b4092352b38714ad7eb174f023e5956145450a591d3547803ac0becf",
  "original_prompt": "Ingested from linux-6.6.14/fs/ecryptfs/super.c",
  "human_readable_source": "\n \n\n#include <linux/fs.h>\n#include <linux/mount.h>\n#include <linux/key.h>\n#include <linux/slab.h>\n#include <linux/seq_file.h>\n#include <linux/file.h>\n#include <linux/statfs.h>\n#include <linux/magic.h>\n#include \"ecryptfs_kernel.h\"\n\nstruct kmem_cache *ecryptfs_inode_info_cache;\n\n \nstatic struct inode *ecryptfs_alloc_inode(struct super_block *sb)\n{\n\tstruct ecryptfs_inode_info *inode_info;\n\tstruct inode *inode = NULL;\n\n\tinode_info = alloc_inode_sb(sb, ecryptfs_inode_info_cache, GFP_KERNEL);\n\tif (unlikely(!inode_info))\n\t\tgoto out;\n\tif (ecryptfs_init_crypt_stat(&inode_info->crypt_stat)) {\n\t\tkmem_cache_free(ecryptfs_inode_info_cache, inode_info);\n\t\tgoto out;\n\t}\n\tmutex_init(&inode_info->lower_file_mutex);\n\tatomic_set(&inode_info->lower_file_count, 0);\n\tinode_info->lower_file = NULL;\n\tinode = &inode_info->vfs_inode;\nout:\n\treturn inode;\n}\n\nstatic void ecryptfs_free_inode(struct inode *inode)\n{\n\tstruct ecryptfs_inode_info *inode_info;\n\tinode_info = ecryptfs_inode_to_private(inode);\n\n\tkmem_cache_free(ecryptfs_inode_info_cache, inode_info);\n}\n\n \nstatic void ecryptfs_destroy_inode(struct inode *inode)\n{\n\tstruct ecryptfs_inode_info *inode_info;\n\n\tinode_info = ecryptfs_inode_to_private(inode);\n\tBUG_ON(inode_info->lower_file);\n\tecryptfs_destroy_crypt_stat(&inode_info->crypt_stat);\n}\n\n \nstatic int ecryptfs_statfs(struct dentry *dentry, struct kstatfs *buf)\n{\n\tstruct dentry *lower_dentry = ecryptfs_dentry_to_lower(dentry);\n\tint rc;\n\n\tif (!lower_dentry->d_sb->s_op->statfs)\n\t\treturn -ENOSYS;\n\n\trc = lower_dentry->d_sb->s_op->statfs(lower_dentry, buf);\n\tif (rc)\n\t\treturn rc;\n\n\tbuf->f_type = ECRYPTFS_SUPER_MAGIC;\n\trc = ecryptfs_set_f_namelen(&buf->f_namelen, buf->f_namelen,\n\t       &ecryptfs_superblock_to_private(dentry->d_sb)->mount_crypt_stat);\n\n\treturn rc;\n}\n\n \nstatic void ecryptfs_evict_inode(struct inode *inode)\n{\n\ttruncate_inode_pages_final(&inode->i_data);\n\tclear_inode(inode);\n\tiput(ecryptfs_inode_to_lower(inode));\n}\n\n \nstatic int ecryptfs_show_options(struct seq_file *m, struct dentry *root)\n{\n\tstruct super_block *sb = root->d_sb;\n\tstruct ecryptfs_mount_crypt_stat *mount_crypt_stat =\n\t\t&ecryptfs_superblock_to_private(sb)->mount_crypt_stat;\n\tstruct ecryptfs_global_auth_tok *walker;\n\n\tmutex_lock(&mount_crypt_stat->global_auth_tok_list_mutex);\n\tlist_for_each_entry(walker,\n\t\t\t    &mount_crypt_stat->global_auth_tok_list,\n\t\t\t    mount_crypt_stat_list) {\n\t\tif (walker->flags & ECRYPTFS_AUTH_TOK_FNEK)\n\t\t\tseq_printf(m, \",ecryptfs_fnek_sig=%s\", walker->sig);\n\t\telse\n\t\t\tseq_printf(m, \",ecryptfs_sig=%s\", walker->sig);\n\t}\n\tmutex_unlock(&mount_crypt_stat->global_auth_tok_list_mutex);\n\n\tseq_printf(m, \",ecryptfs_cipher=%s\",\n\t\tmount_crypt_stat->global_default_cipher_name);\n\n\tif (mount_crypt_stat->global_default_cipher_key_size)\n\t\tseq_printf(m, \",ecryptfs_key_bytes=%zd\",\n\t\t\t   mount_crypt_stat->global_default_cipher_key_size);\n\tif (mount_crypt_stat->flags & ECRYPTFS_PLAINTEXT_PASSTHROUGH_ENABLED)\n\t\tseq_printf(m, \",ecryptfs_passthrough\");\n\tif (mount_crypt_stat->flags & ECRYPTFS_XATTR_METADATA_ENABLED)\n\t\tseq_printf(m, \",ecryptfs_xattr_metadata\");\n\tif (mount_crypt_stat->flags & ECRYPTFS_ENCRYPTED_VIEW_ENABLED)\n\t\tseq_printf(m, \",ecryptfs_encrypted_view\");\n\tif (mount_crypt_stat->flags & ECRYPTFS_UNLINK_SIGS)\n\t\tseq_printf(m, \",ecryptfs_unlink_sigs\");\n\tif (mount_crypt_stat->flags & ECRYPTFS_GLOBAL_MOUNT_AUTH_TOK_ONLY)\n\t\tseq_printf(m, \",ecryptfs_mount_auth_tok_only\");\n\n\treturn 0;\n}\n\nconst struct super_operations ecryptfs_sops = {\n\t.alloc_inode = ecryptfs_alloc_inode,\n\t.destroy_inode = ecryptfs_destroy_inode,\n\t.free_inode = ecryptfs_free_inode,\n\t.statfs = ecryptfs_statfs,\n\t.remount_fs = NULL,\n\t.evict_inode = ecryptfs_evict_inode,\n\t.show_options = ecryptfs_show_options\n};\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}