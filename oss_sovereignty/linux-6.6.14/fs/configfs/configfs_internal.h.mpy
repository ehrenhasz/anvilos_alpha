{
  "module_name": "configfs_internal.h",
  "hash_id": "f45dabb9318064013e3d4a16cb31265bcc393b30cea19a72e98c4027d905434b",
  "original_prompt": "Ingested from linux-6.6.14/fs/configfs/configfs_internal.h",
  "human_readable_source": " \n \n\n#ifdef pr_fmt\n#undef pr_fmt\n#endif\n\n#define pr_fmt(fmt) KBUILD_MODNAME \": \" fmt\n\n#include <linux/slab.h>\n#include <linux/list.h>\n#include <linux/spinlock.h>\n\nstruct configfs_fragment {\n\tatomic_t frag_count;\n\tstruct rw_semaphore frag_sem;\n\tbool frag_dead;\n};\n\nvoid put_fragment(struct configfs_fragment *);\nstruct configfs_fragment *get_fragment(struct configfs_fragment *);\n\nstruct configfs_dirent {\n\tatomic_t\t\ts_count;\n\tint\t\t\ts_dependent_count;\n\tstruct list_head\ts_sibling;\n\tstruct list_head\ts_children;\n\tint\t\t\ts_links;\n\tvoid\t\t\t* s_element;\n\tint\t\t\ts_type;\n\tumode_t\t\t\ts_mode;\n\tstruct dentry\t\t* s_dentry;\n\tstruct iattr\t\t* s_iattr;\n#ifdef CONFIG_LOCKDEP\n\tint\t\t\ts_depth;\n#endif\n\tstruct configfs_fragment *s_frag;\n};\n\n#define CONFIGFS_ROOT\t\t0x0001\n#define CONFIGFS_DIR\t\t0x0002\n#define CONFIGFS_ITEM_ATTR\t0x0004\n#define CONFIGFS_ITEM_BIN_ATTR\t0x0008\n#define CONFIGFS_ITEM_LINK\t0x0020\n#define CONFIGFS_USET_DIR\t0x0040\n#define CONFIGFS_USET_DEFAULT\t0x0080\n#define CONFIGFS_USET_DROPPING\t0x0100\n#define CONFIGFS_USET_IN_MKDIR\t0x0200\n#define CONFIGFS_USET_CREATING\t0x0400\n#define CONFIGFS_NOT_PINNED\t(CONFIGFS_ITEM_ATTR | CONFIGFS_ITEM_BIN_ATTR)\n\nextern struct mutex configfs_symlink_mutex;\nextern spinlock_t configfs_dirent_lock;\n\nextern struct kmem_cache *configfs_dir_cachep;\n\nextern int configfs_is_root(struct config_item *item);\n\nextern struct inode * configfs_new_inode(umode_t mode, struct configfs_dirent *, struct super_block *);\nextern struct inode *configfs_create(struct dentry *, umode_t mode);\n\nextern int configfs_create_file(struct config_item *, const struct configfs_attribute *);\nextern int configfs_create_bin_file(struct config_item *,\n\t\t\t\t    const struct configfs_bin_attribute *);\nextern int configfs_make_dirent(struct configfs_dirent *, struct dentry *,\n\t\t\t\tvoid *, umode_t, int, struct configfs_fragment *);\nextern int configfs_dirent_is_ready(struct configfs_dirent *);\n\nextern void configfs_hash_and_remove(struct dentry * dir, const char * name);\n\nextern const unsigned char * configfs_get_name(struct configfs_dirent *sd);\nextern void configfs_drop_dentry(struct configfs_dirent *sd, struct dentry *parent);\nextern int configfs_setattr(struct mnt_idmap *idmap,\n\t\t\t    struct dentry *dentry, struct iattr *iattr);\n\nextern struct dentry *configfs_pin_fs(void);\nextern void configfs_release_fs(void);\n\nextern const struct file_operations configfs_dir_operations;\nextern const struct file_operations configfs_file_operations;\nextern const struct file_operations configfs_bin_file_operations;\nextern const struct inode_operations configfs_dir_inode_operations;\nextern const struct inode_operations configfs_root_inode_operations;\nextern const struct inode_operations configfs_symlink_inode_operations;\nextern const struct dentry_operations configfs_dentry_ops;\n\nextern int configfs_symlink(struct mnt_idmap *idmap,\n\t\t\t    struct inode *dir, struct dentry *dentry,\n\t\t\t    const char *symname);\nextern int configfs_unlink(struct inode *dir, struct dentry *dentry);\n\nint configfs_create_link(struct configfs_dirent *target, struct dentry *parent,\n\t\tstruct dentry *dentry, char *body);\n\nstatic inline struct config_item * to_item(struct dentry * dentry)\n{\n\tstruct configfs_dirent * sd = dentry->d_fsdata;\n\treturn ((struct config_item *) sd->s_element);\n}\n\nstatic inline struct configfs_attribute * to_attr(struct dentry * dentry)\n{\n\tstruct configfs_dirent * sd = dentry->d_fsdata;\n\treturn ((struct configfs_attribute *) sd->s_element);\n}\n\nstatic inline struct configfs_bin_attribute *to_bin_attr(struct dentry *dentry)\n{\n\tstruct configfs_attribute *attr = to_attr(dentry);\n\n\treturn container_of(attr, struct configfs_bin_attribute, cb_attr);\n}\n\nstatic inline struct config_item *configfs_get_config_item(struct dentry *dentry)\n{\n\tstruct config_item * item = NULL;\n\n\tspin_lock(&dentry->d_lock);\n\tif (!d_unhashed(dentry)) {\n\t\tstruct configfs_dirent * sd = dentry->d_fsdata;\n\t\titem = config_item_get(sd->s_element);\n\t}\n\tspin_unlock(&dentry->d_lock);\n\n\treturn item;\n}\n\nstatic inline void release_configfs_dirent(struct configfs_dirent * sd)\n{\n\tif (!(sd->s_type & CONFIGFS_ROOT)) {\n\t\tkfree(sd->s_iattr);\n\t\tput_fragment(sd->s_frag);\n\t\tkmem_cache_free(configfs_dir_cachep, sd);\n\t}\n}\n\nstatic inline struct configfs_dirent * configfs_get(struct configfs_dirent * sd)\n{\n\tif (sd) {\n\t\tWARN_ON(!atomic_read(&sd->s_count));\n\t\tatomic_inc(&sd->s_count);\n\t}\n\treturn sd;\n}\n\nstatic inline void configfs_put(struct configfs_dirent * sd)\n{\n\tWARN_ON(!atomic_read(&sd->s_count));\n\tif (atomic_dec_and_test(&sd->s_count))\n\t\trelease_configfs_dirent(sd);\n}\n\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}