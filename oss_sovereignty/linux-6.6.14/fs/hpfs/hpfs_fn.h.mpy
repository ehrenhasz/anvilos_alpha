{
  "module_name": "hpfs_fn.h",
  "hash_id": "8abcb6b8ee631314c087a2e2767ee2aa4ae748cfb937057746a76ad27ca57a02",
  "original_prompt": "Ingested from linux-6.6.14/fs/hpfs/hpfs_fn.h",
  "human_readable_source": " \n \n\n\n\n#ifdef pr_fmt\n#undef pr_fmt\n#endif\n\n#define pr_fmt(fmt) KBUILD_MODNAME \": \" fmt\n\n#include <linux/mutex.h>\n#include <linux/pagemap.h>\n#include <linux/buffer_head.h>\n#include <linux/slab.h>\n#include <linux/sched/signal.h>\n#include <linux/blkdev.h>\n#include <asm/unaligned.h>\n\n#include \"hpfs.h\"\n\n#define EIOERROR  EIO\n#define EFSERROR  EUCLEAN\n\n#define ANODE_ALLOC_FWD\t512\n#define FNODE_ALLOC_FWD\t0\n#define ALLOC_FWD_MIN\t16\n#define ALLOC_FWD_MAX\t128\n#define ALLOC_M\t\t1\n#define FNODE_RD_AHEAD\t16\n#define ANODE_RD_AHEAD\t0\n#define DNODE_RD_AHEAD\t72\n#define COUNT_RD_AHEAD\t62\n\n#define FREE_DNODES_ADD\t58\n#define FREE_DNODES_DEL\t29\n\n#define CHKCOND(x,y) if (!(x)) printk y\n\nstruct hpfs_inode_info {\n\tloff_t mmu_private;\n\tino_t i_parent_dir;\t \n\tunsigned i_dno;\t\t \n\tunsigned i_dpos;\t \n\tunsigned i_dsubdno;\t \n\tunsigned i_file_sec;\t \n\tunsigned i_disk_sec;\t \n\tunsigned i_n_secs;\t \n\tunsigned i_ea_size;\t \n\tunsigned i_ea_mode : 1;\t \n\tunsigned i_ea_uid : 1;\t \n\tunsigned i_ea_gid : 1;\t \n\tunsigned i_dirty : 1;\n\tloff_t **i_rddir_off;\n\tstruct inode vfs_inode;\n};\n\nstruct hpfs_sb_info {\n\tstruct mutex hpfs_mutex;\t \n\tino_t sb_root;\t\t\t \n\tunsigned sb_fs_size;\t\t \n\tunsigned sb_bitmaps;\t\t \n\tunsigned sb_dirband_start;\t \n\tunsigned sb_dirband_size;\t \n\tunsigned sb_dmap;\t\t \n\tunsigned sb_n_free;\t\t \n\tunsigned sb_n_free_dnodes;\t \n\tkuid_t sb_uid;\t\t\t \n\tkgid_t sb_gid;\t\t\t \n\tumode_t sb_mode;\t\t \n\tunsigned sb_eas : 2;\t\t \n\tunsigned sb_err : 2;\t\t \n\tunsigned sb_chk : 2;\t\t \n\tunsigned sb_lowercase : 1;\t \n\tunsigned sb_was_error : 1;\t \n\tunsigned sb_chkdsk : 2;\t\t \n\tunsigned char *sb_cp_table;\t \n\t\t\t\t\t \n\t\t\t\t\t \n\t__le32 *sb_bmp_dir;\t\t \n\tunsigned sb_c_bitmap;\t\t \n\tunsigned sb_max_fwd_alloc;\t \n\tint sb_timeshift;\n\tstruct rcu_head rcu;\n\n\tunsigned n_hotfixes;\n\tsecno hotfix_from[256];\n\tsecno hotfix_to[256];\n};\n\n \n\nstruct quad_buffer_head {\n\tstruct buffer_head *bh[4];\n\tvoid *data;\n};\n\n \n\nstatic inline dnode_secno de_down_pointer (struct hpfs_dirent *de)\n{\n  CHKCOND(de->down,(\"HPFS: de_down_pointer: !de->down\\n\"));\n  return le32_to_cpu(*(__le32 *) ((void *) de + le16_to_cpu(de->length) - 4));\n}\n\n \n\nstatic inline struct hpfs_dirent *dnode_first_de (struct dnode *dnode)\n{\n  return (void *) dnode->dirent;\n}\n\n \n\nstatic inline struct hpfs_dirent *dnode_end_de (struct dnode *dnode)\n{\n  CHKCOND(le32_to_cpu(dnode->first_free)>=0x14 && le32_to_cpu(dnode->first_free)<=0xa00,(\"HPFS: dnode_end_de: dnode->first_free = %x\\n\",(unsigned)le32_to_cpu(dnode->first_free)));\n  return (void *) dnode + le32_to_cpu(dnode->first_free);\n}\n\n \n\nstatic inline struct hpfs_dirent *de_next_de (struct hpfs_dirent *de)\n{\n  CHKCOND(le16_to_cpu(de->length)>=0x20 && le16_to_cpu(de->length)<0x800,(\"HPFS: de_next_de: de->length = %x\\n\",(unsigned)le16_to_cpu(de->length)));\n  return (void *) de + le16_to_cpu(de->length);\n}\n\nstatic inline struct extended_attribute *fnode_ea(struct fnode *fnode)\n{\n\treturn (struct extended_attribute *)((char *)fnode + le16_to_cpu(fnode->ea_offs) + le16_to_cpu(fnode->acl_size_s));\n}\n\nstatic inline struct extended_attribute *fnode_end_ea(struct fnode *fnode)\n{\n\treturn (struct extended_attribute *)((char *)fnode + le16_to_cpu(fnode->ea_offs) + le16_to_cpu(fnode->acl_size_s) + le16_to_cpu(fnode->ea_size_s));\n}\n\nstatic unsigned ea_valuelen(struct extended_attribute *ea)\n{\n\treturn ea->valuelen_lo + 256 * ea->valuelen_hi;\n}\n\nstatic inline struct extended_attribute *next_ea(struct extended_attribute *ea)\n{\n\treturn (struct extended_attribute *)((char *)ea + 5 + ea->namelen + ea_valuelen(ea));\n}\n\nstatic inline secno ea_sec(struct extended_attribute *ea)\n{\n\treturn le32_to_cpu(get_unaligned((__le32 *)((char *)ea + 9 + ea->namelen)));\n}\n\nstatic inline secno ea_len(struct extended_attribute *ea)\n{\n\treturn le32_to_cpu(get_unaligned((__le32 *)((char *)ea + 5 + ea->namelen)));\n}\n\nstatic inline char *ea_data(struct extended_attribute *ea)\n{\n\treturn (char *)((char *)ea + 5 + ea->namelen);\n}\n\nstatic inline unsigned de_size(int namelen, secno down_ptr)\n{\n\treturn ((0x1f + namelen + 3) & ~3) + (down_ptr ? 4 : 0);\n}\n\nstatic inline void copy_de(struct hpfs_dirent *dst, struct hpfs_dirent *src)\n{\n\tint a;\n\tint n;\n\tif (!dst || !src) return;\n\ta = dst->down;\n\tn = dst->not_8x3;\n\tmemcpy((char *)dst + 2, (char *)src + 2, 28);\n\tdst->down = a;\n\tdst->not_8x3 = n;\n}\n\nstatic inline unsigned tstbits(__le32 *bmp, unsigned b, unsigned n)\n{\n\tint i;\n\tif ((b >= 0x4000) || (b + n - 1 >= 0x4000)) return n;\n\tif (!((le32_to_cpu(bmp[(b & 0x3fff) >> 5]) >> (b & 0x1f)) & 1)) return 1;\n\tfor (i = 1; i < n; i++)\n\t\tif (!((le32_to_cpu(bmp[((b+i) & 0x3fff) >> 5]) >> ((b+i) & 0x1f)) & 1))\n\t\t\treturn i + 1;\n\treturn 0;\n}\n\n \n\nint hpfs_chk_sectors(struct super_block *, secno, int, char *);\nsecno hpfs_alloc_sector(struct super_block *, secno, unsigned, int);\nint hpfs_alloc_if_possible(struct super_block *, secno);\nvoid hpfs_free_sectors(struct super_block *, secno, unsigned);\nint hpfs_check_free_dnodes(struct super_block *, int);\nvoid hpfs_free_dnode(struct super_block *, secno);\nstruct dnode *hpfs_alloc_dnode(struct super_block *, secno, dnode_secno *, struct quad_buffer_head *);\nstruct fnode *hpfs_alloc_fnode(struct super_block *, secno, fnode_secno *, struct buffer_head **);\nstruct anode *hpfs_alloc_anode(struct super_block *, secno, anode_secno *, struct buffer_head **);\nint hpfs_trim_fs(struct super_block *, u64, u64, u64, unsigned *);\n\n \n\nsecno hpfs_bplus_lookup(struct super_block *, struct inode *, struct bplus_header *, unsigned, struct buffer_head *);\nsecno hpfs_add_sector_to_btree(struct super_block *, secno, int, unsigned);\nvoid hpfs_remove_btree(struct super_block *, struct bplus_header *);\nint hpfs_ea_read(struct super_block *, secno, int, unsigned, unsigned, char *);\nint hpfs_ea_write(struct super_block *, secno, int, unsigned, unsigned, const char *);\nvoid hpfs_ea_remove(struct super_block *, secno, int, unsigned);\nvoid hpfs_truncate_btree(struct super_block *, secno, int, unsigned);\nvoid hpfs_remove_fnode(struct super_block *, fnode_secno fno);\n\n \n\nsecno hpfs_search_hotfix_map(struct super_block *s, secno sec);\nunsigned hpfs_search_hotfix_map_for_range(struct super_block *s, secno sec, unsigned n);\nvoid hpfs_prefetch_sectors(struct super_block *, unsigned, int);\nvoid *hpfs_map_sector(struct super_block *, unsigned, struct buffer_head **, int);\nvoid *hpfs_get_sector(struct super_block *, unsigned, struct buffer_head **);\nvoid *hpfs_map_4sectors(struct super_block *, unsigned, struct quad_buffer_head *, int);\nvoid *hpfs_get_4sectors(struct super_block *, unsigned, struct quad_buffer_head *);\nvoid hpfs_brelse4(struct quad_buffer_head *);\nvoid hpfs_mark_4buffers_dirty(struct quad_buffer_head *);\n\n \n\nextern const struct dentry_operations hpfs_dentry_operations;\n\n \n\nstruct dentry *hpfs_lookup(struct inode *, struct dentry *, unsigned int);\nextern const struct file_operations hpfs_dir_ops;\n\n \n\nint hpfs_add_pos(struct inode *, loff_t *);\nvoid hpfs_del_pos(struct inode *, loff_t *);\nstruct hpfs_dirent *hpfs_add_de(struct super_block *, struct dnode *,\n\t\t\t\tconst unsigned char *, unsigned, secno);\nint hpfs_add_dirent(struct inode *, const unsigned char *, unsigned,\n\t\t    struct hpfs_dirent *);\nint hpfs_remove_dirent(struct inode *, dnode_secno, struct hpfs_dirent *, struct quad_buffer_head *, int);\nvoid hpfs_count_dnodes(struct super_block *, dnode_secno, int *, int *, int *);\ndnode_secno hpfs_de_as_down_as_possible(struct super_block *, dnode_secno dno);\nstruct hpfs_dirent *map_pos_dirent(struct inode *, loff_t *, struct quad_buffer_head *);\nstruct hpfs_dirent *map_dirent(struct inode *, dnode_secno,\n\t\t\t       const unsigned char *, unsigned, dnode_secno *,\n\t\t\t       struct quad_buffer_head *);\nvoid hpfs_remove_dtree(struct super_block *, dnode_secno);\nstruct hpfs_dirent *map_fnode_dirent(struct super_block *, fnode_secno, struct fnode *, struct quad_buffer_head *);\n\n \n\nvoid hpfs_ea_ext_remove(struct super_block *, secno, int, unsigned);\nint hpfs_read_ea(struct super_block *, struct fnode *, char *, char *, int);\nchar *hpfs_get_ea(struct super_block *, struct fnode *, char *, int *);\nvoid hpfs_set_ea(struct inode *, struct fnode *, const char *,\n\t\t const char *, int);\n\n \n\nint hpfs_file_fsync(struct file *, loff_t, loff_t, int);\nvoid hpfs_truncate(struct inode *);\nextern const struct file_operations hpfs_file_ops;\nextern const struct inode_operations hpfs_file_iops;\nextern const struct address_space_operations hpfs_aops;\n\n \n\nvoid hpfs_init_inode(struct inode *);\nvoid hpfs_read_inode(struct inode *);\nvoid hpfs_write_inode(struct inode *);\nvoid hpfs_write_inode_nolock(struct inode *);\nint hpfs_setattr(struct mnt_idmap *, struct dentry *, struct iattr *);\nvoid hpfs_write_if_changed(struct inode *);\nvoid hpfs_evict_inode(struct inode *);\n\n \n\n__le32 *hpfs_map_dnode_bitmap(struct super_block *, struct quad_buffer_head *);\n__le32 *hpfs_map_bitmap(struct super_block *, unsigned, struct quad_buffer_head *, char *);\nvoid hpfs_prefetch_bitmap(struct super_block *, unsigned);\nunsigned char *hpfs_load_code_page(struct super_block *, secno);\n__le32 *hpfs_load_bitmap_directory(struct super_block *, secno bmp);\nvoid hpfs_load_hotfix_map(struct super_block *s, struct hpfs_spare_block *spareblock);\nstruct fnode *hpfs_map_fnode(struct super_block *s, ino_t, struct buffer_head **);\nstruct anode *hpfs_map_anode(struct super_block *s, anode_secno, struct buffer_head **);\nstruct dnode *hpfs_map_dnode(struct super_block *s, dnode_secno, struct quad_buffer_head *);\ndnode_secno hpfs_fnode_dno(struct super_block *s, ino_t ino);\n\n \n\nunsigned char hpfs_upcase(unsigned char *, unsigned char);\nint hpfs_chk_name(const unsigned char *, unsigned *);\nunsigned char *hpfs_translate_name(struct super_block *, unsigned char *, unsigned, int, int);\nint hpfs_compare_names(struct super_block *, const unsigned char *, unsigned,\n\t\t       const unsigned char *, unsigned, int);\nint hpfs_is_name_long(const unsigned char *, unsigned);\nvoid hpfs_adjust_length(const unsigned char *, unsigned *);\n\n \n\nextern const struct inode_operations hpfs_dir_iops;\nextern const struct address_space_operations hpfs_symlink_aops;\n\nstatic inline struct hpfs_inode_info *hpfs_i(struct inode *inode)\n{\n\treturn container_of(inode, struct hpfs_inode_info, vfs_inode);\n}\n\nstatic inline struct hpfs_sb_info *hpfs_sb(struct super_block *sb)\n{\n\treturn sb->s_fs_info;\n}\n\n \n\n__printf(2, 3)\nvoid hpfs_error(struct super_block *, const char *, ...);\nint hpfs_stop_cycles(struct super_block *, int, int *, int *, char *);\nunsigned hpfs_get_free_dnodes(struct super_block *);\nlong hpfs_ioctl(struct file *file, unsigned cmd, unsigned long arg);\n\n \n\nstatic inline time64_t local_to_gmt(struct super_block *s, time64_t t)\n{\n\textern struct timezone sys_tz;\n\treturn t + sys_tz.tz_minuteswest * 60 + hpfs_sb(s)->sb_timeshift;\n}\n\nstatic inline time32_t gmt_to_local(struct super_block *s, time64_t t)\n{\n\textern struct timezone sys_tz;\n\treturn t - sys_tz.tz_minuteswest * 60 - hpfs_sb(s)->sb_timeshift;\n}\n\nstatic inline time32_t local_get_seconds(struct super_block *s)\n{\n\treturn gmt_to_local(s, ktime_get_real_seconds());\n}\n\n \nstatic inline void hpfs_lock(struct super_block *s)\n{\n\tstruct hpfs_sb_info *sbi = hpfs_sb(s);\n\tmutex_lock(&sbi->hpfs_mutex);\n}\n\nstatic inline void hpfs_unlock(struct super_block *s)\n{\n\tstruct hpfs_sb_info *sbi = hpfs_sb(s);\n\tmutex_unlock(&sbi->hpfs_mutex);\n}\n\nstatic inline void hpfs_lock_assert(struct super_block *s)\n{\n\tstruct hpfs_sb_info *sbi = hpfs_sb(s);\n\tWARN_ON(!mutex_is_locked(&sbi->hpfs_mutex));\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}