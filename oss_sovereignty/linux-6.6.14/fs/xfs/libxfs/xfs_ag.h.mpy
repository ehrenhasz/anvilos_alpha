{
  "module_name": "xfs_ag.h",
  "hash_id": "e3ab648bfc0ec9e54c90dada1813ca861b9cdebf41f68744a6f22ae1a7cae490",
  "original_prompt": "Ingested from linux-6.6.14/fs/xfs/libxfs/xfs_ag.h",
  "human_readable_source": " \n \n\n#ifndef __LIBXFS_AG_H\n#define __LIBXFS_AG_H 1\n\nstruct xfs_mount;\nstruct xfs_trans;\nstruct xfs_perag;\n\n \n\n \nstruct xfs_ag_resv {\n\t \n\txfs_extlen_t\t\t\tar_orig_reserved;\n\t \n\txfs_extlen_t\t\t\tar_reserved;\n\t \n\txfs_extlen_t\t\t\tar_asked;\n};\n\n \nstruct xfs_perag {\n\tstruct xfs_mount *pag_mount;\t \n\txfs_agnumber_t\tpag_agno;\t \n\tatomic_t\tpag_ref;\t \n\tatomic_t\tpag_active_ref;\t \n\twait_queue_head_t pag_active_wq; \n\tunsigned long\tpag_opstate;\n\tuint8_t\t\tpagf_levels[XFS_BTNUM_AGF];\n\t\t\t\t\t \n\tuint32_t\tpagf_flcount;\t \n\txfs_extlen_t\tpagf_freeblks;\t \n\txfs_extlen_t\tpagf_longest;\t \n\tuint32_t\tpagf_btreeblks;\t \n\txfs_agino_t\tpagi_freecount;\t \n\txfs_agino_t\tpagi_count;\t \n\n\t \n\txfs_agino_t\tpagl_pagino;\n\txfs_agino_t\tpagl_leftrec;\n\txfs_agino_t\tpagl_rightrec;\n\n\tint\t\tpagb_count;\t \n\tuint8_t\t\tpagf_refcount_level;  \n\n\t \n\tstruct xfs_ag_resv\tpag_meta_resv;\n\t \n\tstruct xfs_ag_resv\tpag_rmapbt_resv;\n\n\t \n\tstruct rcu_head\trcu_head;\n\n\t \n\txfs_agblock_t\t\tblock_count;\n\txfs_agblock_t\t\tmin_block;\n\txfs_agino_t\t\tagino_min;\n\txfs_agino_t\t\tagino_max;\n\n#ifdef __KERNEL__\n\t \n\n\t \n\tuint16_t\tpag_checked;\n\tuint16_t\tpag_sick;\n\tspinlock_t\tpag_state_lock;\n\n\tspinlock_t\tpagb_lock;\t \n\tstruct rb_root\tpagb_tree;\t \n\tunsigned int\tpagb_gen;\t \n\twait_queue_head_t pagb_wait;\t \n\n\tatomic_t        pagf_fstrms;     \n\n\tspinlock_t\tpag_ici_lock;\t \n\tstruct radix_tree_root pag_ici_root;\t \n\tint\t\tpag_ici_reclaimable;\t \n\tunsigned long\tpag_ici_reclaim_cursor;\t \n\n\t \n\tspinlock_t\tpag_buf_lock;\t \n\tstruct rhashtable pag_buf_hash;\n\n\t \n\tstruct delayed_work\tpag_blockgc_work;\n\n\t \n\tstruct xfs_defer_drain\tpag_intents_drain;\n#endif  \n};\n\n \n#define XFS_AGSTATE_AGF_INIT\t\t0\n#define XFS_AGSTATE_AGI_INIT\t\t1\n#define XFS_AGSTATE_PREFERS_METADATA\t2\n#define XFS_AGSTATE_ALLOWS_INODES\t3\n#define XFS_AGSTATE_AGFL_NEEDS_RESET\t4\n\n#define __XFS_AG_OPSTATE(name, NAME) \\\nstatic inline bool xfs_perag_ ## name (struct xfs_perag *pag) \\\n{ \\\n\treturn test_bit(XFS_AGSTATE_ ## NAME, &pag->pag_opstate); \\\n}\n\n__XFS_AG_OPSTATE(initialised_agf, AGF_INIT)\n__XFS_AG_OPSTATE(initialised_agi, AGI_INIT)\n__XFS_AG_OPSTATE(prefers_metadata, PREFERS_METADATA)\n__XFS_AG_OPSTATE(allows_inodes, ALLOWS_INODES)\n__XFS_AG_OPSTATE(agfl_needs_reset, AGFL_NEEDS_RESET)\n\nint xfs_initialize_perag(struct xfs_mount *mp, xfs_agnumber_t agcount,\n\t\t\txfs_rfsblock_t dcount, xfs_agnumber_t *maxagi);\nint xfs_initialize_perag_data(struct xfs_mount *mp, xfs_agnumber_t agno);\nvoid xfs_free_perag(struct xfs_mount *mp);\n\n \nstruct xfs_perag *xfs_perag_get(struct xfs_mount *mp, xfs_agnumber_t agno);\nstruct xfs_perag *xfs_perag_get_tag(struct xfs_mount *mp, xfs_agnumber_t agno,\n\t\tunsigned int tag);\nstruct xfs_perag *xfs_perag_hold(struct xfs_perag *pag);\nvoid xfs_perag_put(struct xfs_perag *pag);\n\n \nstruct xfs_perag *xfs_perag_grab(struct xfs_mount *, xfs_agnumber_t);\nstruct xfs_perag *xfs_perag_grab_tag(struct xfs_mount *, xfs_agnumber_t,\n\t\t\t\t   int tag);\nvoid xfs_perag_rele(struct xfs_perag *pag);\n\n \nxfs_agblock_t xfs_ag_block_count(struct xfs_mount *mp, xfs_agnumber_t agno);\nvoid xfs_agino_range(struct xfs_mount *mp, xfs_agnumber_t agno,\n\t\txfs_agino_t *first, xfs_agino_t *last);\n\nstatic inline bool\nxfs_verify_agbno(struct xfs_perag *pag, xfs_agblock_t agbno)\n{\n\tif (agbno >= pag->block_count)\n\t\treturn false;\n\tif (agbno <= pag->min_block)\n\t\treturn false;\n\treturn true;\n}\n\nstatic inline bool\nxfs_verify_agbext(\n\tstruct xfs_perag\t*pag,\n\txfs_agblock_t\t\tagbno,\n\txfs_agblock_t\t\tlen)\n{\n\tif (agbno + len <= agbno)\n\t\treturn false;\n\n\tif (!xfs_verify_agbno(pag, agbno))\n\t\treturn false;\n\n\treturn xfs_verify_agbno(pag, agbno + len - 1);\n}\n\n \nstatic inline bool\nxfs_verify_agino(struct xfs_perag *pag, xfs_agino_t agino)\n{\n\tif (agino < pag->agino_min)\n\t\treturn false;\n\tif (agino > pag->agino_max)\n\t\treturn false;\n\treturn true;\n}\n\n \nstatic inline bool\nxfs_verify_agino_or_null(struct xfs_perag *pag, xfs_agino_t agino)\n{\n\tif (agino == NULLAGINO)\n\t\treturn true;\n\treturn xfs_verify_agino(pag, agino);\n}\n\nstatic inline bool\nxfs_ag_contains_log(struct xfs_mount *mp, xfs_agnumber_t agno)\n{\n\treturn mp->m_sb.sb_logstart > 0 &&\n\t       agno == XFS_FSB_TO_AGNO(mp, mp->m_sb.sb_logstart);\n}\n\n \nstatic inline struct xfs_perag *\nxfs_perag_next(\n\tstruct xfs_perag\t*pag,\n\txfs_agnumber_t\t\t*agno,\n\txfs_agnumber_t\t\tend_agno)\n{\n\tstruct xfs_mount\t*mp = pag->pag_mount;\n\n\t*agno = pag->pag_agno + 1;\n\txfs_perag_rele(pag);\n\twhile (*agno <= end_agno) {\n\t\tpag = xfs_perag_grab(mp, *agno);\n\t\tif (pag)\n\t\t\treturn pag;\n\t\t(*agno)++;\n\t}\n\treturn NULL;\n}\n\n#define for_each_perag_range(mp, agno, end_agno, pag) \\\n\tfor ((pag) = xfs_perag_grab((mp), (agno)); \\\n\t\t(pag) != NULL; \\\n\t\t(pag) = xfs_perag_next((pag), &(agno), (end_agno)))\n\n#define for_each_perag_from(mp, agno, pag) \\\n\tfor_each_perag_range((mp), (agno), (mp)->m_sb.sb_agcount - 1, (pag))\n\n#define for_each_perag(mp, agno, pag) \\\n\t(agno) = 0; \\\n\tfor_each_perag_from((mp), (agno), (pag))\n\n#define for_each_perag_tag(mp, agno, pag, tag) \\\n\tfor ((agno) = 0, (pag) = xfs_perag_grab_tag((mp), 0, (tag)); \\\n\t\t(pag) != NULL; \\\n\t\t(agno) = (pag)->pag_agno + 1, \\\n\t\txfs_perag_rele(pag), \\\n\t\t(pag) = xfs_perag_grab_tag((mp), (agno), (tag)))\n\nstatic inline struct xfs_perag *\nxfs_perag_next_wrap(\n\tstruct xfs_perag\t*pag,\n\txfs_agnumber_t\t\t*agno,\n\txfs_agnumber_t\t\tstop_agno,\n\txfs_agnumber_t\t\trestart_agno,\n\txfs_agnumber_t\t\twrap_agno)\n{\n\tstruct xfs_mount\t*mp = pag->pag_mount;\n\n\t*agno = pag->pag_agno + 1;\n\txfs_perag_rele(pag);\n\twhile (*agno != stop_agno) {\n\t\tif (*agno >= wrap_agno) {\n\t\t\tif (restart_agno >= stop_agno)\n\t\t\t\tbreak;\n\t\t\t*agno = restart_agno;\n\t\t}\n\n\t\tpag = xfs_perag_grab(mp, *agno);\n\t\tif (pag)\n\t\t\treturn pag;\n\t\t(*agno)++;\n\t}\n\treturn NULL;\n}\n\n \n#define for_each_perag_wrap_range(mp, start_agno, restart_agno, wrap_agno, agno, pag) \\\n\tfor ((agno) = (start_agno), (pag) = xfs_perag_grab((mp), (agno)); \\\n\t\t(pag) != NULL; \\\n\t\t(pag) = xfs_perag_next_wrap((pag), &(agno), (start_agno), \\\n\t\t\t\t(restart_agno), (wrap_agno)))\n \n#define for_each_perag_wrap_at(mp, start_agno, wrap_agno, agno, pag) \\\n\tfor_each_perag_wrap_range((mp), (start_agno), 0, (wrap_agno), (agno), (pag))\n\n \n#define for_each_perag_wrap(mp, start_agno, agno, pag) \\\n\tfor_each_perag_wrap_at((mp), (start_agno), (mp)->m_sb.sb_agcount, \\\n\t\t\t\t(agno), (pag))\n\n\nstruct aghdr_init_data {\n\t \n\txfs_agblock_t\t\tagno;\t\t \n\txfs_extlen_t\t\tagsize;\t\t \n\tstruct list_head\tbuffer_list;\t \n\txfs_rfsblock_t\t\tnfree;\t\t \n\n\t \n\txfs_daddr_t\t\tdaddr;\t\t \n\tsize_t\t\t\tnumblks;\t \n\txfs_btnum_t\t\ttype;\t\t \n};\n\nint xfs_ag_init_headers(struct xfs_mount *mp, struct aghdr_init_data *id);\nint xfs_ag_shrink_space(struct xfs_perag *pag, struct xfs_trans **tpp,\n\t\t\txfs_extlen_t delta);\nint xfs_ag_extend_space(struct xfs_perag *pag, struct xfs_trans *tp,\n\t\t\txfs_extlen_t len);\nint xfs_ag_get_geometry(struct xfs_perag *pag, struct xfs_ag_geometry *ageo);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}