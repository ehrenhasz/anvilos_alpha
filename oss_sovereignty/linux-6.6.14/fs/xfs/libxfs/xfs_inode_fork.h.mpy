{
  "module_name": "xfs_inode_fork.h",
  "hash_id": "fcb88409b1503c8b4964e028fbcbe44264d350fd0956d91a8d07e99a56bbe6a6",
  "original_prompt": "Ingested from linux-6.6.14/fs/xfs/libxfs/xfs_inode_fork.h",
  "human_readable_source": "\n \n#ifndef\t__XFS_INODE_FORK_H__\n#define\t__XFS_INODE_FORK_H__\n\nstruct xfs_inode_log_item;\nstruct xfs_dinode;\n\n \nstruct xfs_ifork {\n\tint64_t\t\t\tif_bytes;\t \n\tstruct xfs_btree_block\t*if_broot;\t \n\tunsigned int\t\tif_seq;\t\t \n\tint\t\t\tif_height;\t \n\tunion {\n\t\tvoid\t\t*if_root;\t \n\t\tchar\t\t*if_data;\t \n\t} if_u1;\n\txfs_extnum_t\t\tif_nextents;\t \n\tshort\t\t\tif_broot_bytes;\t \n\tint8_t\t\t\tif_format;\t \n\tuint8_t\t\t\tif_needextents;\t \n};\n\n \n#define XFS_IEXT_ADD_NOSPLIT_CNT\t(1)\n\n \n#define XFS_IEXT_PUNCH_HOLE_CNT\t\t(1)\n\n \n#define XFS_IEXT_ATTR_MANIP_CNT(rmt_blks) \\\n\t(XFS_DA_NODE_MAXDEPTH + max(1, rmt_blks))\n\n \n#define XFS_IEXT_WRITE_UNWRITTEN_CNT\t(2)\n\n\n \n#define XFS_IEXT_REFLINK_END_COW_CNT\t(2)\n\n \n#define XFS_IEXT_SWAP_RMAP_CNT\t\t(1)\n\n \n#define XFS_IFORK_MAXEXT(ip, w) \\\n\t(xfs_inode_fork_size(ip, w) / sizeof(xfs_bmbt_rec_t))\n\nstatic inline bool xfs_ifork_has_extents(struct xfs_ifork *ifp)\n{\n\treturn ifp->if_format == XFS_DINODE_FMT_EXTENTS ||\n\t\tifp->if_format == XFS_DINODE_FMT_BTREE;\n}\n\nstatic inline xfs_extnum_t xfs_ifork_nextents(struct xfs_ifork *ifp)\n{\n\tif (!ifp)\n\t\treturn 0;\n\treturn ifp->if_nextents;\n}\n\nstatic inline int8_t xfs_ifork_format(struct xfs_ifork *ifp)\n{\n\tif (!ifp)\n\t\treturn XFS_DINODE_FMT_EXTENTS;\n\treturn ifp->if_format;\n}\n\nstatic inline xfs_extnum_t xfs_iext_max_nextents(bool has_large_extent_counts,\n\t\t\t\tint whichfork)\n{\n\tswitch (whichfork) {\n\tcase XFS_DATA_FORK:\n\tcase XFS_COW_FORK:\n\t\tif (has_large_extent_counts)\n\t\t\treturn XFS_MAX_EXTCNT_DATA_FORK_LARGE;\n\t\treturn XFS_MAX_EXTCNT_DATA_FORK_SMALL;\n\n\tcase XFS_ATTR_FORK:\n\t\tif (has_large_extent_counts)\n\t\t\treturn XFS_MAX_EXTCNT_ATTR_FORK_LARGE;\n\t\treturn XFS_MAX_EXTCNT_ATTR_FORK_SMALL;\n\n\tdefault:\n\t\tASSERT(0);\n\t\treturn 0;\n\t}\n}\n\nstatic inline xfs_extnum_t\nxfs_dfork_data_extents(\n\tstruct xfs_dinode\t*dip)\n{\n\tif (xfs_dinode_has_large_extent_counts(dip))\n\t\treturn be64_to_cpu(dip->di_big_nextents);\n\n\treturn be32_to_cpu(dip->di_nextents);\n}\n\nstatic inline xfs_extnum_t\nxfs_dfork_attr_extents(\n\tstruct xfs_dinode\t*dip)\n{\n\tif (xfs_dinode_has_large_extent_counts(dip))\n\t\treturn be32_to_cpu(dip->di_big_anextents);\n\n\treturn be16_to_cpu(dip->di_anextents);\n}\n\nstatic inline xfs_extnum_t\nxfs_dfork_nextents(\n\tstruct xfs_dinode\t*dip,\n\tint\t\t\twhichfork)\n{\n\tswitch (whichfork) {\n\tcase XFS_DATA_FORK:\n\t\treturn xfs_dfork_data_extents(dip);\n\tcase XFS_ATTR_FORK:\n\t\treturn xfs_dfork_attr_extents(dip);\n\tdefault:\n\t\tASSERT(0);\n\t\tbreak;\n\t}\n\n\treturn 0;\n}\n\nvoid xfs_ifork_zap_attr(struct xfs_inode *ip);\nvoid xfs_ifork_init_attr(struct xfs_inode *ip, enum xfs_dinode_fmt format,\n\t\txfs_extnum_t nextents);\nstruct xfs_ifork *xfs_iext_state_to_fork(struct xfs_inode *ip, int state);\n\nint\t\txfs_iformat_data_fork(struct xfs_inode *, struct xfs_dinode *);\nint\t\txfs_iformat_attr_fork(struct xfs_inode *, struct xfs_dinode *);\nvoid\t\txfs_iflush_fork(struct xfs_inode *, struct xfs_dinode *,\n\t\t\t\tstruct xfs_inode_log_item *, int);\nvoid\t\txfs_idestroy_fork(struct xfs_ifork *ifp);\nvoid\t\txfs_idata_realloc(struct xfs_inode *ip, int64_t byte_diff,\n\t\t\t\tint whichfork);\nvoid\t\txfs_iroot_realloc(struct xfs_inode *, int, int);\nint\t\txfs_iread_extents(struct xfs_trans *, struct xfs_inode *, int);\nint\t\txfs_iextents_copy(struct xfs_inode *, struct xfs_bmbt_rec *,\n\t\t\t\t  int);\nvoid\t\txfs_init_local_fork(struct xfs_inode *ip, int whichfork,\n\t\t\t\tconst void *data, int64_t size);\n\nxfs_extnum_t\txfs_iext_count(struct xfs_ifork *ifp);\nvoid\t\txfs_iext_insert(struct xfs_inode *, struct xfs_iext_cursor *cur,\n\t\t\tstruct xfs_bmbt_irec *, int);\nvoid\t\txfs_iext_remove(struct xfs_inode *, struct xfs_iext_cursor *,\n\t\t\tint);\nvoid\t\txfs_iext_destroy(struct xfs_ifork *);\n\nbool\t\txfs_iext_lookup_extent(struct xfs_inode *ip,\n\t\t\tstruct xfs_ifork *ifp, xfs_fileoff_t bno,\n\t\t\tstruct xfs_iext_cursor *cur,\n\t\t\tstruct xfs_bmbt_irec *gotp);\nbool\t\txfs_iext_lookup_extent_before(struct xfs_inode *ip,\n\t\t\tstruct xfs_ifork *ifp, xfs_fileoff_t *end,\n\t\t\tstruct xfs_iext_cursor *cur,\n\t\t\tstruct xfs_bmbt_irec *gotp);\nbool\t\txfs_iext_get_extent(struct xfs_ifork *ifp,\n\t\t\tstruct xfs_iext_cursor *cur,\n\t\t\tstruct xfs_bmbt_irec *gotp);\nvoid\t\txfs_iext_update_extent(struct xfs_inode *ip, int state,\n\t\t\tstruct xfs_iext_cursor *cur,\n\t\t\tstruct xfs_bmbt_irec *gotp);\n\nvoid\t\txfs_iext_first(struct xfs_ifork *, struct xfs_iext_cursor *);\nvoid\t\txfs_iext_last(struct xfs_ifork *, struct xfs_iext_cursor *);\nvoid\t\txfs_iext_next(struct xfs_ifork *, struct xfs_iext_cursor *);\nvoid\t\txfs_iext_prev(struct xfs_ifork *, struct xfs_iext_cursor *);\n\nstatic inline bool xfs_iext_next_extent(struct xfs_ifork *ifp,\n\t\tstruct xfs_iext_cursor *cur, struct xfs_bmbt_irec *gotp)\n{\n\txfs_iext_next(ifp, cur);\n\treturn xfs_iext_get_extent(ifp, cur, gotp);\n}\n\nstatic inline bool xfs_iext_prev_extent(struct xfs_ifork *ifp,\n\t\tstruct xfs_iext_cursor *cur, struct xfs_bmbt_irec *gotp)\n{\n\txfs_iext_prev(ifp, cur);\n\treturn xfs_iext_get_extent(ifp, cur, gotp);\n}\n\n \nstatic inline bool xfs_iext_peek_next_extent(struct xfs_ifork *ifp,\n\t\tstruct xfs_iext_cursor *cur, struct xfs_bmbt_irec *gotp)\n{\n\tstruct xfs_iext_cursor ncur = *cur;\n\n\txfs_iext_next(ifp, &ncur);\n\treturn xfs_iext_get_extent(ifp, &ncur, gotp);\n}\n\n \nstatic inline bool xfs_iext_peek_prev_extent(struct xfs_ifork *ifp,\n\t\tstruct xfs_iext_cursor *cur, struct xfs_bmbt_irec *gotp)\n{\n\tstruct xfs_iext_cursor ncur = *cur;\n\n\txfs_iext_prev(ifp, &ncur);\n\treturn xfs_iext_get_extent(ifp, &ncur, gotp);\n}\n\n#define for_each_xfs_iext(ifp, ext, got)\t\t\\\n\tfor (xfs_iext_first((ifp), (ext));\t\t\\\n\t     xfs_iext_get_extent((ifp), (ext), (got));\t\\\n\t     xfs_iext_next((ifp), (ext)))\n\nextern struct kmem_cache\t*xfs_ifork_cache;\n\nextern void xfs_ifork_init_cow(struct xfs_inode *ip);\n\nint xfs_ifork_verify_local_data(struct xfs_inode *ip);\nint xfs_ifork_verify_local_attr(struct xfs_inode *ip);\nint xfs_iext_count_may_overflow(struct xfs_inode *ip, int whichfork,\n\t\tint nr_to_add);\nint xfs_iext_count_upgrade(struct xfs_trans *tp, struct xfs_inode *ip,\n\t\tuint nr_to_add);\n\n \nstatic inline bool xfs_need_iread_extents(const struct xfs_ifork *ifp)\n{\n\t \n\treturn smp_load_acquire(&ifp->if_needextents) != 0;\n}\n\n#endif\t \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}