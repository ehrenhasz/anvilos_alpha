{
  "module_name": "xfs_trans_resv.c",
  "hash_id": "2cc16cfb13fdbac237f80a8a578484d4a8ec36418be82f2fbf7826aadbbb31d8",
  "original_prompt": "Ingested from linux-6.6.14/fs/xfs/libxfs/xfs_trans_resv.c",
  "human_readable_source": "\n \n#include \"xfs.h\"\n#include \"xfs_fs.h\"\n#include \"xfs_shared.h\"\n#include \"xfs_format.h\"\n#include \"xfs_log_format.h\"\n#include \"xfs_trans_resv.h\"\n#include \"xfs_mount.h\"\n#include \"xfs_da_format.h\"\n#include \"xfs_da_btree.h\"\n#include \"xfs_inode.h\"\n#include \"xfs_bmap_btree.h\"\n#include \"xfs_quota.h\"\n#include \"xfs_trans.h\"\n#include \"xfs_qm.h\"\n#include \"xfs_trans_space.h\"\n\n#define _ALLOC\ttrue\n#define _FREE\tfalse\n\n \nSTATIC uint\nxfs_buf_log_overhead(void)\n{\n\treturn round_up(sizeof(struct xlog_op_header) +\n\t\t\tsizeof(struct xfs_buf_log_format), 128);\n}\n\n \nSTATIC uint\nxfs_calc_buf_res(\n\tuint\t\tnbufs,\n\tuint\t\tsize)\n{\n\treturn nbufs * (size + xfs_buf_log_overhead());\n}\n\n \nuint\nxfs_allocfree_block_count(\n\tstruct xfs_mount *mp,\n\tuint\t\tnum_ops)\n{\n\tuint\t\tblocks;\n\n\tblocks = num_ops * 2 * (2 * mp->m_alloc_maxlevels - 1);\n\tif (xfs_has_rmapbt(mp))\n\t\tblocks += num_ops * (2 * mp->m_rmap_maxlevels - 1);\n\n\treturn blocks;\n}\n\n \nstatic unsigned int\nxfs_refcountbt_block_count(\n\tstruct xfs_mount\t*mp,\n\tunsigned int\t\tnum_ops)\n{\n\treturn num_ops * (2 * mp->m_refc_maxlevels - 1);\n}\n\n \nSTATIC uint\nxfs_calc_inode_res(\n\tstruct xfs_mount\t*mp,\n\tuint\t\t\tninodes)\n{\n\treturn ninodes *\n\t\t(4 * sizeof(struct xlog_op_header) +\n\t\t sizeof(struct xfs_inode_log_format) +\n\t\t mp->m_sb.sb_inodesize +\n\t\t 2 * XFS_BMBT_BLOCK_LEN(mp));\n}\n\n \nSTATIC uint\nxfs_calc_inobt_res(\n\tstruct xfs_mount\t*mp)\n{\n\treturn xfs_calc_buf_res(M_IGEO(mp)->inobt_maxlevels,\n\t\t\tXFS_FSB_TO_B(mp, 1)) +\n\t\t\t\txfs_calc_buf_res(xfs_allocfree_block_count(mp, 1),\n\t\t\tXFS_FSB_TO_B(mp, 1));\n}\n\n \nSTATIC uint\nxfs_calc_finobt_res(\n\tstruct xfs_mount\t*mp)\n{\n\tif (!xfs_has_finobt(mp))\n\t\treturn 0;\n\n\treturn xfs_calc_inobt_res(mp);\n}\n\n \nSTATIC uint\nxfs_calc_inode_chunk_res(\n\tstruct xfs_mount\t*mp,\n\tbool\t\t\talloc)\n{\n\tuint\t\t\tres, size = 0;\n\n\tres = xfs_calc_buf_res(xfs_allocfree_block_count(mp, 1),\n\t\t\t       XFS_FSB_TO_B(mp, 1));\n\tif (alloc) {\n\t\t \n\t\tif (xfs_has_v3inodes(mp))\n\t\t\treturn res;\n\t\tsize = XFS_FSB_TO_B(mp, 1);\n\t}\n\n\tres += xfs_calc_buf_res(M_IGEO(mp)->ialloc_blks, size);\n\treturn res;\n}\n\n \nstatic unsigned int\nxfs_rtalloc_block_count(\n\tstruct xfs_mount\t*mp,\n\tunsigned int\t\tnum_ops)\n{\n\tunsigned int\t\tblksz = XFS_FSB_TO_B(mp, 1);\n\tunsigned int\t\trtbmp_bytes;\n\n\trtbmp_bytes = (XFS_MAX_BMBT_EXTLEN / mp->m_sb.sb_rextsize) / NBBY;\n\treturn (howmany(rtbmp_bytes, blksz) + 1) * num_ops;\n}\n\n \n\n \nstatic unsigned int\nxfs_calc_refcountbt_reservation(\n\tstruct xfs_mount\t*mp,\n\tunsigned int\t\tnr_ops)\n{\n\tunsigned int\t\tblksz = XFS_FSB_TO_B(mp, 1);\n\n\tif (!xfs_has_reflink(mp))\n\t\treturn 0;\n\n\treturn xfs_calc_buf_res(nr_ops, mp->m_sb.sb_sectsize) +\n\t       xfs_calc_buf_res(xfs_refcountbt_block_count(mp, nr_ops), blksz);\n}\n\n \nSTATIC uint\nxfs_calc_write_reservation(\n\tstruct xfs_mount\t*mp,\n\tbool\t\t\tfor_minlogsize)\n{\n\tunsigned int\t\tt1, t2, t3, t4;\n\tunsigned int\t\tblksz = XFS_FSB_TO_B(mp, 1);\n\n\tt1 = xfs_calc_inode_res(mp, 1) +\n\t     xfs_calc_buf_res(XFS_BM_MAXLEVELS(mp, XFS_DATA_FORK), blksz) +\n\t     xfs_calc_buf_res(3, mp->m_sb.sb_sectsize) +\n\t     xfs_calc_buf_res(xfs_allocfree_block_count(mp, 2), blksz);\n\n\tif (xfs_has_realtime(mp)) {\n\t\tt2 = xfs_calc_inode_res(mp, 1) +\n\t\t     xfs_calc_buf_res(XFS_BM_MAXLEVELS(mp, XFS_DATA_FORK),\n\t\t\t\t     blksz) +\n\t\t     xfs_calc_buf_res(3, mp->m_sb.sb_sectsize) +\n\t\t     xfs_calc_buf_res(xfs_rtalloc_block_count(mp, 1), blksz) +\n\t\t     xfs_calc_buf_res(xfs_allocfree_block_count(mp, 1), blksz);\n\t} else {\n\t\tt2 = 0;\n\t}\n\n\tt3 = xfs_calc_buf_res(5, mp->m_sb.sb_sectsize) +\n\t     xfs_calc_buf_res(xfs_allocfree_block_count(mp, 2), blksz);\n\n\t \n\tif (for_minlogsize) {\n\t\tunsigned int\tadj = 0;\n\n\t\tif (xfs_has_reflink(mp))\n\t\t\tadj = xfs_calc_buf_res(\n\t\t\t\t\txfs_refcountbt_block_count(mp, 2),\n\t\t\t\t\tblksz);\n\t\tt1 += adj;\n\t\tt3 += adj;\n\t\treturn XFS_DQUOT_LOGRES(mp) + max3(t1, t2, t3);\n\t}\n\n\tt4 = xfs_calc_refcountbt_reservation(mp, 1);\n\treturn XFS_DQUOT_LOGRES(mp) + max(t4, max3(t1, t2, t3));\n}\n\nunsigned int\nxfs_calc_write_reservation_minlogsize(\n\tstruct xfs_mount\t*mp)\n{\n\treturn xfs_calc_write_reservation(mp, true);\n}\n\n \nSTATIC uint\nxfs_calc_itruncate_reservation(\n\tstruct xfs_mount\t*mp,\n\tbool\t\t\tfor_minlogsize)\n{\n\tunsigned int\t\tt1, t2, t3, t4;\n\tunsigned int\t\tblksz = XFS_FSB_TO_B(mp, 1);\n\n\tt1 = xfs_calc_inode_res(mp, 1) +\n\t     xfs_calc_buf_res(XFS_BM_MAXLEVELS(mp, XFS_DATA_FORK) + 1, blksz);\n\n\tt2 = xfs_calc_buf_res(9, mp->m_sb.sb_sectsize) +\n\t     xfs_calc_buf_res(xfs_allocfree_block_count(mp, 4), blksz);\n\n\tif (xfs_has_realtime(mp)) {\n\t\tt3 = xfs_calc_buf_res(5, mp->m_sb.sb_sectsize) +\n\t\t     xfs_calc_buf_res(xfs_rtalloc_block_count(mp, 2), blksz) +\n\t\t     xfs_calc_buf_res(xfs_allocfree_block_count(mp, 2), blksz);\n\t} else {\n\t\tt3 = 0;\n\t}\n\n\t \n\tif (for_minlogsize) {\n\t\tif (xfs_has_reflink(mp))\n\t\t\tt2 += xfs_calc_buf_res(\n\t\t\t\t\txfs_refcountbt_block_count(mp, 4),\n\t\t\t\t\tblksz);\n\n\t\treturn XFS_DQUOT_LOGRES(mp) + max3(t1, t2, t3);\n\t}\n\n\tt4 = xfs_calc_refcountbt_reservation(mp, 2);\n\treturn XFS_DQUOT_LOGRES(mp) + max(t4, max3(t1, t2, t3));\n}\n\nunsigned int\nxfs_calc_itruncate_reservation_minlogsize(\n\tstruct xfs_mount\t*mp)\n{\n\treturn xfs_calc_itruncate_reservation(mp, true);\n}\n\n \nSTATIC uint\nxfs_calc_rename_reservation(\n\tstruct xfs_mount\t*mp)\n{\n\treturn XFS_DQUOT_LOGRES(mp) +\n\t\tmax((xfs_calc_inode_res(mp, 5) +\n\t\t     xfs_calc_buf_res(2 * XFS_DIROP_LOG_COUNT(mp),\n\t\t\t\t      XFS_FSB_TO_B(mp, 1))),\n\t\t    (xfs_calc_buf_res(7, mp->m_sb.sb_sectsize) +\n\t\t     xfs_calc_buf_res(xfs_allocfree_block_count(mp, 3),\n\t\t\t\t      XFS_FSB_TO_B(mp, 1))));\n}\n\n \nSTATIC uint\nxfs_calc_iunlink_remove_reservation(\n\tstruct xfs_mount        *mp)\n{\n\treturn xfs_calc_buf_res(1, mp->m_sb.sb_sectsize) +\n\t       2 * M_IGEO(mp)->inode_cluster_size;\n}\n\n \nSTATIC uint\nxfs_calc_link_reservation(\n\tstruct xfs_mount\t*mp)\n{\n\treturn XFS_DQUOT_LOGRES(mp) +\n\t\txfs_calc_iunlink_remove_reservation(mp) +\n\t\tmax((xfs_calc_inode_res(mp, 2) +\n\t\t     xfs_calc_buf_res(XFS_DIROP_LOG_COUNT(mp),\n\t\t\t\t      XFS_FSB_TO_B(mp, 1))),\n\t\t    (xfs_calc_buf_res(3, mp->m_sb.sb_sectsize) +\n\t\t     xfs_calc_buf_res(xfs_allocfree_block_count(mp, 1),\n\t\t\t\t      XFS_FSB_TO_B(mp, 1))));\n}\n\n \nSTATIC uint\nxfs_calc_iunlink_add_reservation(xfs_mount_t *mp)\n{\n\treturn xfs_calc_buf_res(1, mp->m_sb.sb_sectsize) +\n\t\t\tM_IGEO(mp)->inode_cluster_size;\n}\n\n \nSTATIC uint\nxfs_calc_remove_reservation(\n\tstruct xfs_mount\t*mp)\n{\n\treturn XFS_DQUOT_LOGRES(mp) +\n\t\txfs_calc_iunlink_add_reservation(mp) +\n\t\tmax((xfs_calc_inode_res(mp, 2) +\n\t\t     xfs_calc_buf_res(XFS_DIROP_LOG_COUNT(mp),\n\t\t\t\t      XFS_FSB_TO_B(mp, 1))),\n\t\t    (xfs_calc_buf_res(4, mp->m_sb.sb_sectsize) +\n\t\t     xfs_calc_buf_res(xfs_allocfree_block_count(mp, 2),\n\t\t\t\t      XFS_FSB_TO_B(mp, 1))));\n}\n\n \n\n \nSTATIC uint\nxfs_calc_create_resv_modify(\n\tstruct xfs_mount\t*mp)\n{\n\treturn xfs_calc_inode_res(mp, 2) +\n\t\txfs_calc_buf_res(1, mp->m_sb.sb_sectsize) +\n\t\t(uint)XFS_FSB_TO_B(mp, 1) +\n\t\txfs_calc_buf_res(XFS_DIROP_LOG_COUNT(mp), XFS_FSB_TO_B(mp, 1)) +\n\t\txfs_calc_finobt_res(mp);\n}\n\n \nSTATIC uint\nxfs_calc_icreate_resv_alloc(\n\tstruct xfs_mount\t*mp)\n{\n\treturn xfs_calc_buf_res(2, mp->m_sb.sb_sectsize) +\n\t\tmp->m_sb.sb_sectsize +\n\t\txfs_calc_inode_chunk_res(mp, _ALLOC) +\n\t\txfs_calc_inobt_res(mp) +\n\t\txfs_calc_finobt_res(mp);\n}\n\nSTATIC uint\nxfs_calc_icreate_reservation(xfs_mount_t *mp)\n{\n\treturn XFS_DQUOT_LOGRES(mp) +\n\t\tmax(xfs_calc_icreate_resv_alloc(mp),\n\t\t    xfs_calc_create_resv_modify(mp));\n}\n\nSTATIC uint\nxfs_calc_create_tmpfile_reservation(\n\tstruct xfs_mount        *mp)\n{\n\tuint\tres = XFS_DQUOT_LOGRES(mp);\n\n\tres += xfs_calc_icreate_resv_alloc(mp);\n\treturn res + xfs_calc_iunlink_add_reservation(mp);\n}\n\n \nSTATIC uint\nxfs_calc_mkdir_reservation(\n\tstruct xfs_mount\t*mp)\n{\n\treturn xfs_calc_icreate_reservation(mp);\n}\n\n\n \nSTATIC uint\nxfs_calc_symlink_reservation(\n\tstruct xfs_mount\t*mp)\n{\n\treturn xfs_calc_icreate_reservation(mp) +\n\t       xfs_calc_buf_res(1, XFS_SYMLINK_MAXLEN);\n}\n\n \nSTATIC uint\nxfs_calc_ifree_reservation(\n\tstruct xfs_mount\t*mp)\n{\n\treturn XFS_DQUOT_LOGRES(mp) +\n\t\txfs_calc_inode_res(mp, 1) +\n\t\txfs_calc_buf_res(3, mp->m_sb.sb_sectsize) +\n\t\txfs_calc_iunlink_remove_reservation(mp) +\n\t\txfs_calc_inode_chunk_res(mp, _FREE) +\n\t\txfs_calc_inobt_res(mp) +\n\t\txfs_calc_finobt_res(mp);\n}\n\n \nSTATIC uint\nxfs_calc_ichange_reservation(\n\tstruct xfs_mount\t*mp)\n{\n\treturn XFS_DQUOT_LOGRES(mp) +\n\t\txfs_calc_inode_res(mp, 1) +\n\t\txfs_calc_buf_res(1, mp->m_sb.sb_sectsize);\n\n}\n\n \nSTATIC uint\nxfs_calc_growdata_reservation(\n\tstruct xfs_mount\t*mp)\n{\n\treturn xfs_calc_buf_res(3, mp->m_sb.sb_sectsize) +\n\t\txfs_calc_buf_res(xfs_allocfree_block_count(mp, 1),\n\t\t\t\t XFS_FSB_TO_B(mp, 1));\n}\n\n \nSTATIC uint\nxfs_calc_growrtalloc_reservation(\n\tstruct xfs_mount\t*mp)\n{\n\treturn xfs_calc_buf_res(2, mp->m_sb.sb_sectsize) +\n\t\txfs_calc_buf_res(XFS_BM_MAXLEVELS(mp, XFS_DATA_FORK),\n\t\t\t\t XFS_FSB_TO_B(mp, 1)) +\n\t\txfs_calc_inode_res(mp, 1) +\n\t\txfs_calc_buf_res(xfs_allocfree_block_count(mp, 1),\n\t\t\t\t XFS_FSB_TO_B(mp, 1));\n}\n\n \nSTATIC uint\nxfs_calc_growrtzero_reservation(\n\tstruct xfs_mount\t*mp)\n{\n\treturn xfs_calc_buf_res(1, mp->m_sb.sb_blocksize);\n}\n\n \nSTATIC uint\nxfs_calc_growrtfree_reservation(\n\tstruct xfs_mount\t*mp)\n{\n\treturn xfs_calc_buf_res(1, mp->m_sb.sb_sectsize) +\n\t\txfs_calc_inode_res(mp, 2) +\n\t\txfs_calc_buf_res(1, mp->m_sb.sb_blocksize) +\n\t\txfs_calc_buf_res(1, mp->m_rsumsize);\n}\n\n \nSTATIC uint\nxfs_calc_swrite_reservation(\n\tstruct xfs_mount\t*mp)\n{\n\treturn xfs_calc_inode_res(mp, 1);\n}\n\n \nSTATIC uint\nxfs_calc_writeid_reservation(\n\tstruct xfs_mount\t*mp)\n{\n\treturn xfs_calc_inode_res(mp, 1);\n}\n\n \nSTATIC uint\nxfs_calc_addafork_reservation(\n\tstruct xfs_mount\t*mp)\n{\n\treturn XFS_DQUOT_LOGRES(mp) +\n\t\txfs_calc_inode_res(mp, 1) +\n\t\txfs_calc_buf_res(2, mp->m_sb.sb_sectsize) +\n\t\txfs_calc_buf_res(1, mp->m_dir_geo->blksize) +\n\t\txfs_calc_buf_res(XFS_DAENTER_BMAP1B(mp, XFS_DATA_FORK) + 1,\n\t\t\t\t XFS_FSB_TO_B(mp, 1)) +\n\t\txfs_calc_buf_res(xfs_allocfree_block_count(mp, 1),\n\t\t\t\t XFS_FSB_TO_B(mp, 1));\n}\n\n \nSTATIC uint\nxfs_calc_attrinval_reservation(\n\tstruct xfs_mount\t*mp)\n{\n\treturn max((xfs_calc_inode_res(mp, 1) +\n\t\t    xfs_calc_buf_res(XFS_BM_MAXLEVELS(mp, XFS_ATTR_FORK),\n\t\t\t\t     XFS_FSB_TO_B(mp, 1))),\n\t\t   (xfs_calc_buf_res(9, mp->m_sb.sb_sectsize) +\n\t\t    xfs_calc_buf_res(xfs_allocfree_block_count(mp, 4),\n\t\t\t\t     XFS_FSB_TO_B(mp, 1))));\n}\n\n \nSTATIC uint\nxfs_calc_attrsetm_reservation(\n\tstruct xfs_mount\t*mp)\n{\n\treturn XFS_DQUOT_LOGRES(mp) +\n\t\txfs_calc_inode_res(mp, 1) +\n\t\txfs_calc_buf_res(1, mp->m_sb.sb_sectsize) +\n\t\txfs_calc_buf_res(XFS_DA_NODE_MAXDEPTH, XFS_FSB_TO_B(mp, 1));\n}\n\n \nSTATIC uint\nxfs_calc_attrsetrt_reservation(\n\tstruct xfs_mount\t*mp)\n{\n\treturn xfs_calc_buf_res(1, mp->m_sb.sb_sectsize) +\n\t\txfs_calc_buf_res(XFS_BM_MAXLEVELS(mp, XFS_ATTR_FORK),\n\t\t\t\t XFS_FSB_TO_B(mp, 1));\n}\n\n \nSTATIC uint\nxfs_calc_attrrm_reservation(\n\tstruct xfs_mount\t*mp)\n{\n\treturn XFS_DQUOT_LOGRES(mp) +\n\t\tmax((xfs_calc_inode_res(mp, 1) +\n\t\t     xfs_calc_buf_res(XFS_DA_NODE_MAXDEPTH,\n\t\t\t\t      XFS_FSB_TO_B(mp, 1)) +\n\t\t     (uint)XFS_FSB_TO_B(mp,\n\t\t\t\t\tXFS_BM_MAXLEVELS(mp, XFS_ATTR_FORK)) +\n\t\t     xfs_calc_buf_res(XFS_BM_MAXLEVELS(mp, XFS_DATA_FORK), 0)),\n\t\t    (xfs_calc_buf_res(5, mp->m_sb.sb_sectsize) +\n\t\t     xfs_calc_buf_res(xfs_allocfree_block_count(mp, 2),\n\t\t\t\t      XFS_FSB_TO_B(mp, 1))));\n}\n\n \nSTATIC uint\nxfs_calc_clear_agi_bucket_reservation(\n\tstruct xfs_mount\t*mp)\n{\n\treturn xfs_calc_buf_res(1, mp->m_sb.sb_sectsize);\n}\n\n \nSTATIC uint\nxfs_calc_qm_setqlim_reservation(void)\n{\n\treturn xfs_calc_buf_res(1, sizeof(struct xfs_disk_dquot));\n}\n\n \nSTATIC uint\nxfs_calc_qm_dqalloc_reservation(\n\tstruct xfs_mount\t*mp,\n\tbool\t\t\tfor_minlogsize)\n{\n\treturn xfs_calc_write_reservation(mp, for_minlogsize) +\n\t\txfs_calc_buf_res(1,\n\t\t\tXFS_FSB_TO_B(mp, XFS_DQUOT_CLUSTER_SIZE_FSB) - 1);\n}\n\nunsigned int\nxfs_calc_qm_dqalloc_reservation_minlogsize(\n\tstruct xfs_mount\t*mp)\n{\n\treturn xfs_calc_qm_dqalloc_reservation(mp, true);\n}\n\n \nSTATIC uint\nxfs_calc_sb_reservation(\n\tstruct xfs_mount\t*mp)\n{\n\treturn xfs_calc_buf_res(1, mp->m_sb.sb_sectsize);\n}\n\nvoid\nxfs_trans_resv_calc(\n\tstruct xfs_mount\t*mp,\n\tstruct xfs_trans_resv\t*resp)\n{\n\tint\t\t\tlogcount_adj = 0;\n\n\t \n\tresp->tr_write.tr_logres = xfs_calc_write_reservation(mp, false);\n\tresp->tr_write.tr_logcount = XFS_WRITE_LOG_COUNT;\n\tresp->tr_write.tr_logflags |= XFS_TRANS_PERM_LOG_RES;\n\n\tresp->tr_itruncate.tr_logres = xfs_calc_itruncate_reservation(mp, false);\n\tresp->tr_itruncate.tr_logcount = XFS_ITRUNCATE_LOG_COUNT;\n\tresp->tr_itruncate.tr_logflags |= XFS_TRANS_PERM_LOG_RES;\n\n\tresp->tr_rename.tr_logres = xfs_calc_rename_reservation(mp);\n\tresp->tr_rename.tr_logcount = XFS_RENAME_LOG_COUNT;\n\tresp->tr_rename.tr_logflags |= XFS_TRANS_PERM_LOG_RES;\n\n\tresp->tr_link.tr_logres = xfs_calc_link_reservation(mp);\n\tresp->tr_link.tr_logcount = XFS_LINK_LOG_COUNT;\n\tresp->tr_link.tr_logflags |= XFS_TRANS_PERM_LOG_RES;\n\n\tresp->tr_remove.tr_logres = xfs_calc_remove_reservation(mp);\n\tresp->tr_remove.tr_logcount = XFS_REMOVE_LOG_COUNT;\n\tresp->tr_remove.tr_logflags |= XFS_TRANS_PERM_LOG_RES;\n\n\tresp->tr_symlink.tr_logres = xfs_calc_symlink_reservation(mp);\n\tresp->tr_symlink.tr_logcount = XFS_SYMLINK_LOG_COUNT;\n\tresp->tr_symlink.tr_logflags |= XFS_TRANS_PERM_LOG_RES;\n\n\tresp->tr_create.tr_logres = xfs_calc_icreate_reservation(mp);\n\tresp->tr_create.tr_logcount = XFS_CREATE_LOG_COUNT;\n\tresp->tr_create.tr_logflags |= XFS_TRANS_PERM_LOG_RES;\n\n\tresp->tr_create_tmpfile.tr_logres =\n\t\t\txfs_calc_create_tmpfile_reservation(mp);\n\tresp->tr_create_tmpfile.tr_logcount = XFS_CREATE_TMPFILE_LOG_COUNT;\n\tresp->tr_create_tmpfile.tr_logflags |= XFS_TRANS_PERM_LOG_RES;\n\n\tresp->tr_mkdir.tr_logres = xfs_calc_mkdir_reservation(mp);\n\tresp->tr_mkdir.tr_logcount = XFS_MKDIR_LOG_COUNT;\n\tresp->tr_mkdir.tr_logflags |= XFS_TRANS_PERM_LOG_RES;\n\n\tresp->tr_ifree.tr_logres = xfs_calc_ifree_reservation(mp);\n\tresp->tr_ifree.tr_logcount = XFS_INACTIVE_LOG_COUNT;\n\tresp->tr_ifree.tr_logflags |= XFS_TRANS_PERM_LOG_RES;\n\n\tresp->tr_addafork.tr_logres = xfs_calc_addafork_reservation(mp);\n\tresp->tr_addafork.tr_logcount = XFS_ADDAFORK_LOG_COUNT;\n\tresp->tr_addafork.tr_logflags |= XFS_TRANS_PERM_LOG_RES;\n\n\tresp->tr_attrinval.tr_logres = xfs_calc_attrinval_reservation(mp);\n\tresp->tr_attrinval.tr_logcount = XFS_ATTRINVAL_LOG_COUNT;\n\tresp->tr_attrinval.tr_logflags |= XFS_TRANS_PERM_LOG_RES;\n\n\tresp->tr_attrsetm.tr_logres = xfs_calc_attrsetm_reservation(mp);\n\tresp->tr_attrsetm.tr_logcount = XFS_ATTRSET_LOG_COUNT;\n\tresp->tr_attrsetm.tr_logflags |= XFS_TRANS_PERM_LOG_RES;\n\n\tresp->tr_attrrm.tr_logres = xfs_calc_attrrm_reservation(mp);\n\tresp->tr_attrrm.tr_logcount = XFS_ATTRRM_LOG_COUNT;\n\tresp->tr_attrrm.tr_logflags |= XFS_TRANS_PERM_LOG_RES;\n\n\tresp->tr_growrtalloc.tr_logres = xfs_calc_growrtalloc_reservation(mp);\n\tresp->tr_growrtalloc.tr_logcount = XFS_DEFAULT_PERM_LOG_COUNT;\n\tresp->tr_growrtalloc.tr_logflags |= XFS_TRANS_PERM_LOG_RES;\n\n\tresp->tr_qm_dqalloc.tr_logres = xfs_calc_qm_dqalloc_reservation(mp,\n\t\t\tfalse);\n\tresp->tr_qm_dqalloc.tr_logcount = XFS_WRITE_LOG_COUNT;\n\tresp->tr_qm_dqalloc.tr_logflags |= XFS_TRANS_PERM_LOG_RES;\n\n\t \n\tresp->tr_qm_setqlim.tr_logres = xfs_calc_qm_setqlim_reservation();\n\tresp->tr_qm_setqlim.tr_logcount = XFS_DEFAULT_LOG_COUNT;\n\n\tresp->tr_sb.tr_logres = xfs_calc_sb_reservation(mp);\n\tresp->tr_sb.tr_logcount = XFS_DEFAULT_LOG_COUNT;\n\n\t \n\tresp->tr_growdata.tr_logres = xfs_calc_growdata_reservation(mp);\n\tresp->tr_growdata.tr_logcount = XFS_DEFAULT_PERM_LOG_COUNT;\n\tresp->tr_growdata.tr_logflags |= XFS_TRANS_PERM_LOG_RES;\n\n\t \n\tresp->tr_ichange.tr_logres = xfs_calc_ichange_reservation(mp);\n\tresp->tr_fsyncts.tr_logres = xfs_calc_swrite_reservation(mp);\n\tresp->tr_writeid.tr_logres = xfs_calc_writeid_reservation(mp);\n\tresp->tr_attrsetrt.tr_logres = xfs_calc_attrsetrt_reservation(mp);\n\tresp->tr_clearagi.tr_logres = xfs_calc_clear_agi_bucket_reservation(mp);\n\tresp->tr_growrtzero.tr_logres = xfs_calc_growrtzero_reservation(mp);\n\tresp->tr_growrtfree.tr_logres = xfs_calc_growrtfree_reservation(mp);\n\n\t \n\tif (xfs_has_reflink(mp) || xfs_has_rmapbt(mp))\n\t\tlogcount_adj++;\n\tif (xfs_has_reflink(mp))\n\t\tlogcount_adj++;\n\tif (xfs_has_rmapbt(mp))\n\t\tlogcount_adj++;\n\n\tresp->tr_itruncate.tr_logcount += logcount_adj;\n\tresp->tr_write.tr_logcount += logcount_adj;\n\tresp->tr_qm_dqalloc.tr_logcount += logcount_adj;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}