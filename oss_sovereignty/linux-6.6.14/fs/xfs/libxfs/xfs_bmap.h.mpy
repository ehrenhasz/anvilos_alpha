{
  "module_name": "xfs_bmap.h",
  "hash_id": "d854d6bc2d56b72f04268a01af45ede43ba97feaa5618e92365a646d70f33092",
  "original_prompt": "Ingested from linux-6.6.14/fs/xfs/libxfs/xfs_bmap.h",
  "human_readable_source": " \n \n#ifndef __XFS_BMAP_H__\n#define\t__XFS_BMAP_H__\n\nstruct getbmap;\nstruct xfs_bmbt_irec;\nstruct xfs_ifork;\nstruct xfs_inode;\nstruct xfs_mount;\nstruct xfs_trans;\nstruct xfs_alloc_arg;\n\n \nstruct xfs_bmalloca {\n\tstruct xfs_trans\t*tp;\t \n\tstruct xfs_inode\t*ip;\t \n\tstruct xfs_bmbt_irec\tprev;\t \n\tstruct xfs_bmbt_irec\tgot;\t \n\n\txfs_fileoff_t\t\toffset;\t \n\txfs_extlen_t\t\tlength;\t \n\txfs_fsblock_t\t\tblkno;\t \n\n\tstruct xfs_btree_cur\t*cur;\t \n\tstruct xfs_iext_cursor\ticur;\t \n\tint\t\t\tnallocs; \n\tint\t\t\tlogflags; \n\n\txfs_extlen_t\t\ttotal;\t \n\txfs_extlen_t\t\tminlen;\t \n\txfs_extlen_t\t\tminleft;  \n\tbool\t\t\teof;\t \n\tbool\t\t\twasdel;\t \n\tbool\t\t\taeof;\t \n\tbool\t\t\tconv;\t \n\tint\t\t\tdatatype; \n\tuint32_t\t\tflags;\n};\n\n#define\tXFS_BMAP_MAX_NMAP\t4\n\n \n#define XFS_BMAPI_ENTIRE\t(1u << 0)  \n#define XFS_BMAPI_METADATA\t(1u << 1)  \n#define XFS_BMAPI_ATTRFORK\t(1u << 2)  \n#define XFS_BMAPI_PREALLOC\t(1u << 3)  \n#define XFS_BMAPI_CONTIG\t(1u << 4)  \n \n#define XFS_BMAPI_CONVERT\t(1u << 5)\n\n \n#define XFS_BMAPI_ZERO\t\t(1u << 6)\n\n \n#define XFS_BMAPI_REMAP\t\t(1u << 7)\n\n \n#define XFS_BMAPI_COWFORK\t(1u << 8)\n\n \n#define XFS_BMAPI_NODISCARD\t(1u << 9)\n\n \n#define XFS_BMAPI_NORMAP\t(1u << 10)\n\n#define XFS_BMAPI_FLAGS \\\n\t{ XFS_BMAPI_ENTIRE,\t\"ENTIRE\" }, \\\n\t{ XFS_BMAPI_METADATA,\t\"METADATA\" }, \\\n\t{ XFS_BMAPI_ATTRFORK,\t\"ATTRFORK\" }, \\\n\t{ XFS_BMAPI_PREALLOC,\t\"PREALLOC\" }, \\\n\t{ XFS_BMAPI_CONTIG,\t\"CONTIG\" }, \\\n\t{ XFS_BMAPI_CONVERT,\t\"CONVERT\" }, \\\n\t{ XFS_BMAPI_ZERO,\t\"ZERO\" }, \\\n\t{ XFS_BMAPI_REMAP,\t\"REMAP\" }, \\\n\t{ XFS_BMAPI_COWFORK,\t\"COWFORK\" }, \\\n\t{ XFS_BMAPI_NODISCARD,\t\"NODISCARD\" }, \\\n\t{ XFS_BMAPI_NORMAP,\t\"NORMAP\" }\n\n\nstatic inline int xfs_bmapi_aflag(int w)\n{\n\treturn (w == XFS_ATTR_FORK ? XFS_BMAPI_ATTRFORK :\n\t       (w == XFS_COW_FORK ? XFS_BMAPI_COWFORK : 0));\n}\n\nstatic inline int xfs_bmapi_whichfork(uint32_t bmapi_flags)\n{\n\tif (bmapi_flags & XFS_BMAPI_COWFORK)\n\t\treturn XFS_COW_FORK;\n\telse if (bmapi_flags & XFS_BMAPI_ATTRFORK)\n\t\treturn XFS_ATTR_FORK;\n\treturn XFS_DATA_FORK;\n}\n\n \n#define\tDELAYSTARTBLOCK\t\t((xfs_fsblock_t)-1LL)\n#define\tHOLESTARTBLOCK\t\t((xfs_fsblock_t)-2LL)\n\n \n#define BMAP_LEFT_CONTIG\t(1u << 0)\n#define BMAP_RIGHT_CONTIG\t(1u << 1)\n#define BMAP_LEFT_FILLING\t(1u << 2)\n#define BMAP_RIGHT_FILLING\t(1u << 3)\n#define BMAP_LEFT_DELAY\t\t(1u << 4)\n#define BMAP_RIGHT_DELAY\t(1u << 5)\n#define BMAP_LEFT_VALID\t\t(1u << 6)\n#define BMAP_RIGHT_VALID\t(1u << 7)\n#define BMAP_ATTRFORK\t\t(1u << 8)\n#define BMAP_COWFORK\t\t(1u << 9)\n\n#define XFS_BMAP_EXT_FLAGS \\\n\t{ BMAP_LEFT_CONTIG,\t\"LC\" }, \\\n\t{ BMAP_RIGHT_CONTIG,\t\"RC\" }, \\\n\t{ BMAP_LEFT_FILLING,\t\"LF\" }, \\\n\t{ BMAP_RIGHT_FILLING,\t\"RF\" }, \\\n\t{ BMAP_ATTRFORK,\t\"ATTR\" }, \\\n\t{ BMAP_COWFORK,\t\t\"COW\" }\n\n \nstatic inline bool xfs_bmap_is_real_extent(const struct xfs_bmbt_irec *irec)\n{\n\treturn irec->br_startblock != HOLESTARTBLOCK &&\n\t\tirec->br_startblock != DELAYSTARTBLOCK &&\n\t\t!isnullstartblock(irec->br_startblock);\n}\n\n \nstatic inline bool xfs_bmap_is_written_extent(struct xfs_bmbt_irec *irec)\n{\n\treturn xfs_bmap_is_real_extent(irec) &&\n\t       irec->br_state != XFS_EXT_UNWRITTEN;\n}\n\n \n#define xfs_valid_startblock(ip, startblock) \\\n\t((startblock) != 0 || XFS_IS_REALTIME_INODE(ip))\n\nint\txfs_bmap_longest_free_extent(struct xfs_perag *pag,\n\t\tstruct xfs_trans *tp, xfs_extlen_t *blen);\nvoid\txfs_trim_extent(struct xfs_bmbt_irec *irec, xfs_fileoff_t bno,\n\t\txfs_filblks_t len);\nunsigned int xfs_bmap_compute_attr_offset(struct xfs_mount *mp);\nint\txfs_bmap_add_attrfork(struct xfs_inode *ip, int size, int rsvd);\nvoid\txfs_bmap_local_to_extents_empty(struct xfs_trans *tp,\n\t\tstruct xfs_inode *ip, int whichfork);\nvoid\txfs_bmap_compute_maxlevels(struct xfs_mount *mp, int whichfork);\nint\txfs_bmap_first_unused(struct xfs_trans *tp, struct xfs_inode *ip,\n\t\txfs_extlen_t len, xfs_fileoff_t *unused, int whichfork);\nint\txfs_bmap_last_before(struct xfs_trans *tp, struct xfs_inode *ip,\n\t\txfs_fileoff_t *last_block, int whichfork);\nint\txfs_bmap_last_offset(struct xfs_inode *ip, xfs_fileoff_t *unused,\n\t\tint whichfork);\nint\txfs_bmapi_read(struct xfs_inode *ip, xfs_fileoff_t bno,\n\t\txfs_filblks_t len, struct xfs_bmbt_irec *mval,\n\t\tint *nmap, uint32_t flags);\nint\txfs_bmapi_write(struct xfs_trans *tp, struct xfs_inode *ip,\n\t\txfs_fileoff_t bno, xfs_filblks_t len, uint32_t flags,\n\t\txfs_extlen_t total, struct xfs_bmbt_irec *mval, int *nmap);\nint\t__xfs_bunmapi(struct xfs_trans *tp, struct xfs_inode *ip,\n\t\txfs_fileoff_t bno, xfs_filblks_t *rlen, uint32_t flags,\n\t\txfs_extnum_t nexts);\nint\txfs_bunmapi(struct xfs_trans *tp, struct xfs_inode *ip,\n\t\txfs_fileoff_t bno, xfs_filblks_t len, uint32_t flags,\n\t\txfs_extnum_t nexts, int *done);\nint\txfs_bmap_del_extent_delay(struct xfs_inode *ip, int whichfork,\n\t\tstruct xfs_iext_cursor *cur, struct xfs_bmbt_irec *got,\n\t\tstruct xfs_bmbt_irec *del);\nvoid\txfs_bmap_del_extent_cow(struct xfs_inode *ip,\n\t\tstruct xfs_iext_cursor *cur, struct xfs_bmbt_irec *got,\n\t\tstruct xfs_bmbt_irec *del);\nuint\txfs_default_attroffset(struct xfs_inode *ip);\nint\txfs_bmap_collapse_extents(struct xfs_trans *tp, struct xfs_inode *ip,\n\t\txfs_fileoff_t *next_fsb, xfs_fileoff_t offset_shift_fsb,\n\t\tbool *done);\nint\txfs_bmap_can_insert_extents(struct xfs_inode *ip, xfs_fileoff_t off,\n\t\txfs_fileoff_t shift);\nint\txfs_bmap_insert_extents(struct xfs_trans *tp, struct xfs_inode *ip,\n\t\txfs_fileoff_t *next_fsb, xfs_fileoff_t offset_shift_fsb,\n\t\tbool *done, xfs_fileoff_t stop_fsb);\nint\txfs_bmap_split_extent(struct xfs_trans *tp, struct xfs_inode *ip,\n\t\txfs_fileoff_t split_offset);\nint\txfs_bmapi_reserve_delalloc(struct xfs_inode *ip, int whichfork,\n\t\txfs_fileoff_t off, xfs_filblks_t len, xfs_filblks_t prealloc,\n\t\tstruct xfs_bmbt_irec *got, struct xfs_iext_cursor *cur,\n\t\tint eof);\nint\txfs_bmapi_convert_delalloc(struct xfs_inode *ip, int whichfork,\n\t\txfs_off_t offset, struct iomap *iomap, unsigned int *seq);\nint\txfs_bmap_add_extent_unwritten_real(struct xfs_trans *tp,\n\t\tstruct xfs_inode *ip, int whichfork,\n\t\tstruct xfs_iext_cursor *icur, struct xfs_btree_cur **curp,\n\t\tstruct xfs_bmbt_irec *new, int *logflagsp);\nxfs_extlen_t xfs_bmapi_minleft(struct xfs_trans *tp, struct xfs_inode *ip,\n\t\tint fork);\nint\txfs_bmap_btalloc_low_space(struct xfs_bmalloca *ap,\n\t\tstruct xfs_alloc_arg *args);\n\nenum xfs_bmap_intent_type {\n\tXFS_BMAP_MAP = 1,\n\tXFS_BMAP_UNMAP,\n};\n\nstruct xfs_bmap_intent {\n\tstruct list_head\t\t\tbi_list;\n\tenum xfs_bmap_intent_type\t\tbi_type;\n\tint\t\t\t\t\tbi_whichfork;\n\tstruct xfs_inode\t\t\t*bi_owner;\n\tstruct xfs_perag\t\t\t*bi_pag;\n\tstruct xfs_bmbt_irec\t\t\tbi_bmap;\n};\n\nvoid xfs_bmap_update_get_group(struct xfs_mount *mp,\n\t\tstruct xfs_bmap_intent *bi);\n\nint\txfs_bmap_finish_one(struct xfs_trans *tp, struct xfs_bmap_intent *bi);\nvoid\txfs_bmap_map_extent(struct xfs_trans *tp, struct xfs_inode *ip,\n\t\tstruct xfs_bmbt_irec *imap);\nvoid\txfs_bmap_unmap_extent(struct xfs_trans *tp, struct xfs_inode *ip,\n\t\tstruct xfs_bmbt_irec *imap);\n\nstatic inline uint32_t xfs_bmap_fork_to_state(int whichfork)\n{\n\tswitch (whichfork) {\n\tcase XFS_ATTR_FORK:\n\t\treturn BMAP_ATTRFORK;\n\tcase XFS_COW_FORK:\n\t\treturn BMAP_COWFORK;\n\tdefault:\n\t\treturn 0;\n\t}\n}\n\nxfs_failaddr_t xfs_bmap_validate_extent(struct xfs_inode *ip, int whichfork,\n\t\tstruct xfs_bmbt_irec *irec);\nint xfs_bmap_complain_bad_rec(struct xfs_inode *ip, int whichfork,\n\t\txfs_failaddr_t fa, const struct xfs_bmbt_irec *irec);\n\nint\txfs_bmapi_remap(struct xfs_trans *tp, struct xfs_inode *ip,\n\t\txfs_fileoff_t bno, xfs_filblks_t len, xfs_fsblock_t startblock,\n\t\tuint32_t flags);\n\nextern struct kmem_cache\t*xfs_bmap_intent_cache;\n\nint __init xfs_bmap_intent_init_cache(void);\nvoid xfs_bmap_intent_destroy_cache(void);\n\n#endif\t \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}