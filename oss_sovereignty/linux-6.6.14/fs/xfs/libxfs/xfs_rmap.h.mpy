{
  "module_name": "xfs_rmap.h",
  "hash_id": "6139fc0c576e3b015707b5409e7bd128869040c47830a1469982d8557e1e2edb",
  "original_prompt": "Ingested from linux-6.6.14/fs/xfs/libxfs/xfs_rmap.h",
  "human_readable_source": "\n \n#ifndef __XFS_RMAP_H__\n#define __XFS_RMAP_H__\n\nstruct xfs_perag;\n\nstatic inline void\nxfs_rmap_ino_bmbt_owner(\n\tstruct xfs_owner_info\t*oi,\n\txfs_ino_t\t\tino,\n\tint\t\t\twhichfork)\n{\n\toi->oi_owner = ino;\n\toi->oi_offset = 0;\n\toi->oi_flags = XFS_OWNER_INFO_BMBT_BLOCK;\n\tif (whichfork == XFS_ATTR_FORK)\n\t\toi->oi_flags |= XFS_OWNER_INFO_ATTR_FORK;\n}\n\nstatic inline void\nxfs_rmap_ino_owner(\n\tstruct xfs_owner_info\t*oi,\n\txfs_ino_t\t\tino,\n\tint\t\t\twhichfork,\n\txfs_fileoff_t\t\toffset)\n{\n\toi->oi_owner = ino;\n\toi->oi_offset = offset;\n\toi->oi_flags = 0;\n\tif (whichfork == XFS_ATTR_FORK)\n\t\toi->oi_flags |= XFS_OWNER_INFO_ATTR_FORK;\n}\n\nstatic inline bool\nxfs_rmap_should_skip_owner_update(\n\tconst struct xfs_owner_info\t*oi)\n{\n\treturn oi->oi_owner == XFS_RMAP_OWN_NULL;\n}\n\n \n\nstruct xfs_buf;\n\nstatic inline __u64\nxfs_rmap_irec_offset_pack(\n\tconst struct xfs_rmap_irec\t*irec)\n{\n\t__u64\t\t\tx;\n\n\tx = XFS_RMAP_OFF(irec->rm_offset);\n\tif (irec->rm_flags & XFS_RMAP_ATTR_FORK)\n\t\tx |= XFS_RMAP_OFF_ATTR_FORK;\n\tif (irec->rm_flags & XFS_RMAP_BMBT_BLOCK)\n\t\tx |= XFS_RMAP_OFF_BMBT_BLOCK;\n\tif (irec->rm_flags & XFS_RMAP_UNWRITTEN)\n\t\tx |= XFS_RMAP_OFF_UNWRITTEN;\n\treturn x;\n}\n\nstatic inline xfs_failaddr_t\nxfs_rmap_irec_offset_unpack(\n\t__u64\t\t\toffset,\n\tstruct xfs_rmap_irec\t*irec)\n{\n\tif (offset & ~(XFS_RMAP_OFF_MASK | XFS_RMAP_OFF_FLAGS))\n\t\treturn __this_address;\n\n\tirec->rm_offset = XFS_RMAP_OFF(offset);\n\tirec->rm_flags = 0;\n\tif (offset & XFS_RMAP_OFF_ATTR_FORK)\n\t\tirec->rm_flags |= XFS_RMAP_ATTR_FORK;\n\tif (offset & XFS_RMAP_OFF_BMBT_BLOCK)\n\t\tirec->rm_flags |= XFS_RMAP_BMBT_BLOCK;\n\tif (offset & XFS_RMAP_OFF_UNWRITTEN)\n\t\tirec->rm_flags |= XFS_RMAP_UNWRITTEN;\n\treturn NULL;\n}\n\nstatic inline void\nxfs_owner_info_unpack(\n\tconst struct xfs_owner_info\t*oinfo,\n\tuint64_t\t\t\t*owner,\n\tuint64_t\t\t\t*offset,\n\tunsigned int\t\t\t*flags)\n{\n\tunsigned int\t\t\tr = 0;\n\n\t*owner = oinfo->oi_owner;\n\t*offset = oinfo->oi_offset;\n\tif (oinfo->oi_flags & XFS_OWNER_INFO_ATTR_FORK)\n\t\tr |= XFS_RMAP_ATTR_FORK;\n\tif (oinfo->oi_flags & XFS_OWNER_INFO_BMBT_BLOCK)\n\t\tr |= XFS_RMAP_BMBT_BLOCK;\n\t*flags = r;\n}\n\nstatic inline void\nxfs_owner_info_pack(\n\tstruct xfs_owner_info\t*oinfo,\n\tuint64_t\t\towner,\n\tuint64_t\t\toffset,\n\tunsigned int\t\tflags)\n{\n\toinfo->oi_owner = owner;\n\toinfo->oi_offset = XFS_RMAP_OFF(offset);\n\toinfo->oi_flags = 0;\n\tif (flags & XFS_RMAP_ATTR_FORK)\n\t\toinfo->oi_flags |= XFS_OWNER_INFO_ATTR_FORK;\n\tif (flags & XFS_RMAP_BMBT_BLOCK)\n\t\toinfo->oi_flags |= XFS_OWNER_INFO_BMBT_BLOCK;\n}\n\nint xfs_rmap_alloc(struct xfs_trans *tp, struct xfs_buf *agbp,\n\t\t   struct xfs_perag *pag, xfs_agblock_t bno, xfs_extlen_t len,\n\t\t   const struct xfs_owner_info *oinfo);\nint xfs_rmap_free(struct xfs_trans *tp, struct xfs_buf *agbp,\n\t\t  struct xfs_perag *pag, xfs_agblock_t bno, xfs_extlen_t len,\n\t\t  const struct xfs_owner_info *oinfo);\n\nint xfs_rmap_lookup_le(struct xfs_btree_cur *cur, xfs_agblock_t bno,\n\t\tuint64_t owner, uint64_t offset, unsigned int flags,\n\t\tstruct xfs_rmap_irec *irec, int *stat);\nint xfs_rmap_lookup_eq(struct xfs_btree_cur *cur, xfs_agblock_t bno,\n\t\txfs_extlen_t len, uint64_t owner, uint64_t offset,\n\t\tunsigned int flags, int *stat);\nint xfs_rmap_insert(struct xfs_btree_cur *rcur, xfs_agblock_t agbno,\n\t\txfs_extlen_t len, uint64_t owner, uint64_t offset,\n\t\tunsigned int flags);\nint xfs_rmap_get_rec(struct xfs_btree_cur *cur, struct xfs_rmap_irec *irec,\n\t\tint *stat);\n\ntypedef int (*xfs_rmap_query_range_fn)(\n\tstruct xfs_btree_cur\t\t*cur,\n\tconst struct xfs_rmap_irec\t*rec,\n\tvoid\t\t\t\t*priv);\n\nint xfs_rmap_query_range(struct xfs_btree_cur *cur,\n\t\tconst struct xfs_rmap_irec *low_rec,\n\t\tconst struct xfs_rmap_irec *high_rec,\n\t\txfs_rmap_query_range_fn fn, void *priv);\nint xfs_rmap_query_all(struct xfs_btree_cur *cur, xfs_rmap_query_range_fn fn,\n\t\tvoid *priv);\n\nenum xfs_rmap_intent_type {\n\tXFS_RMAP_MAP,\n\tXFS_RMAP_MAP_SHARED,\n\tXFS_RMAP_UNMAP,\n\tXFS_RMAP_UNMAP_SHARED,\n\tXFS_RMAP_CONVERT,\n\tXFS_RMAP_CONVERT_SHARED,\n\tXFS_RMAP_ALLOC,\n\tXFS_RMAP_FREE,\n};\n\nstruct xfs_rmap_intent {\n\tstruct list_head\t\t\tri_list;\n\tenum xfs_rmap_intent_type\t\tri_type;\n\tint\t\t\t\t\tri_whichfork;\n\tuint64_t\t\t\t\tri_owner;\n\tstruct xfs_bmbt_irec\t\t\tri_bmap;\n\tstruct xfs_perag\t\t\t*ri_pag;\n};\n\nvoid xfs_rmap_update_get_group(struct xfs_mount *mp,\n\t\tstruct xfs_rmap_intent *ri);\n\n \nvoid xfs_rmap_map_extent(struct xfs_trans *tp, struct xfs_inode *ip,\n\t\tint whichfork, struct xfs_bmbt_irec *imap);\nvoid xfs_rmap_unmap_extent(struct xfs_trans *tp, struct xfs_inode *ip,\n\t\tint whichfork, struct xfs_bmbt_irec *imap);\nvoid xfs_rmap_convert_extent(struct xfs_mount *mp, struct xfs_trans *tp,\n\t\tstruct xfs_inode *ip, int whichfork,\n\t\tstruct xfs_bmbt_irec *imap);\nvoid xfs_rmap_alloc_extent(struct xfs_trans *tp, xfs_agnumber_t agno,\n\t\txfs_agblock_t bno, xfs_extlen_t len, uint64_t owner);\nvoid xfs_rmap_free_extent(struct xfs_trans *tp, xfs_agnumber_t agno,\n\t\txfs_agblock_t bno, xfs_extlen_t len, uint64_t owner);\n\nvoid xfs_rmap_finish_one_cleanup(struct xfs_trans *tp,\n\t\tstruct xfs_btree_cur *rcur, int error);\nint xfs_rmap_finish_one(struct xfs_trans *tp, struct xfs_rmap_intent *ri,\n\t\tstruct xfs_btree_cur **pcur);\n\nint xfs_rmap_lookup_le_range(struct xfs_btree_cur *cur, xfs_agblock_t bno,\n\t\tuint64_t owner, uint64_t offset, unsigned int flags,\n\t\tstruct xfs_rmap_irec *irec, int\t*stat);\nint xfs_rmap_compare(const struct xfs_rmap_irec *a,\n\t\tconst struct xfs_rmap_irec *b);\nunion xfs_btree_rec;\nxfs_failaddr_t xfs_rmap_btrec_to_irec(const union xfs_btree_rec *rec,\n\t\tstruct xfs_rmap_irec *irec);\nxfs_failaddr_t xfs_rmap_check_irec(struct xfs_btree_cur *cur,\n\t\tconst struct xfs_rmap_irec *irec);\n\nint xfs_rmap_has_records(struct xfs_btree_cur *cur, xfs_agblock_t bno,\n\t\txfs_extlen_t len, enum xbtree_recpacking *outcome);\n\nstruct xfs_rmap_matches {\n\t \n\tunsigned long long\tmatches;\n\n\t \n\tunsigned long long\tnon_owner_matches;\n\n\t \n\tunsigned long long\tbad_non_owner_matches;\n};\n\nint xfs_rmap_count_owners(struct xfs_btree_cur *cur, xfs_agblock_t bno,\n\t\txfs_extlen_t len, const struct xfs_owner_info *oinfo,\n\t\tstruct xfs_rmap_matches *rmatch);\nint xfs_rmap_has_other_keys(struct xfs_btree_cur *cur, xfs_agblock_t bno,\n\t\txfs_extlen_t len, const struct xfs_owner_info *oinfo,\n\t\tbool *has_other);\nint xfs_rmap_map_raw(struct xfs_btree_cur *cur, struct xfs_rmap_irec *rmap);\n\nextern const struct xfs_owner_info XFS_RMAP_OINFO_SKIP_UPDATE;\nextern const struct xfs_owner_info XFS_RMAP_OINFO_ANY_OWNER;\nextern const struct xfs_owner_info XFS_RMAP_OINFO_FS;\nextern const struct xfs_owner_info XFS_RMAP_OINFO_LOG;\nextern const struct xfs_owner_info XFS_RMAP_OINFO_AG;\nextern const struct xfs_owner_info XFS_RMAP_OINFO_INOBT;\nextern const struct xfs_owner_info XFS_RMAP_OINFO_INODES;\nextern const struct xfs_owner_info XFS_RMAP_OINFO_REFC;\nextern const struct xfs_owner_info XFS_RMAP_OINFO_COW;\n\nextern struct kmem_cache\t*xfs_rmap_intent_cache;\n\nint __init xfs_rmap_intent_init_cache(void);\nvoid xfs_rmap_intent_destroy_cache(void);\n\n#endif\t \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}