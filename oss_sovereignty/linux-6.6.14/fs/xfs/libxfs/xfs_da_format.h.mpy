{
  "module_name": "xfs_da_format.h",
  "hash_id": "a6272f628a34f39bbe18776b4503a911ef6091f8fa4b4e38cf927fd41a646574",
  "original_prompt": "Ingested from linux-6.6.14/fs/xfs/libxfs/xfs_da_format.h",
  "human_readable_source": " \n \n#ifndef __XFS_DA_FORMAT_H__\n#define __XFS_DA_FORMAT_H__\n\n \n#define XFS_DA_NODE_MAGIC\t0xfebe\t \n#define XFS_ATTR_LEAF_MAGIC\t0xfbee\t \n#define XFS_DIR2_LEAF1_MAGIC\t0xd2f1\t \n#define XFS_DIR2_LEAFN_MAGIC\t0xd2ff\t \n\ntypedef struct xfs_da_blkinfo {\n\t__be32\t\tforw;\t\t\t \n\t__be32\t\tback;\t\t\t \n\t__be16\t\tmagic;\t\t\t \n\t__be16\t\tpad;\t\t\t \n} xfs_da_blkinfo_t;\n\n \n#define XFS_DA3_NODE_MAGIC\t0x3ebe\t \n#define XFS_ATTR3_LEAF_MAGIC\t0x3bee\t \n#define XFS_DIR3_LEAF1_MAGIC\t0x3df1\t \n#define XFS_DIR3_LEAFN_MAGIC\t0x3dff\t \n\nstruct xfs_da3_blkinfo {\n\t \n\tstruct xfs_da_blkinfo\thdr;\n\t__be32\t\t\tcrc;\t \n\t__be64\t\t\tblkno;\t \n\t__be64\t\t\tlsn;\t \n\tuuid_t\t\t\tuuid;\t \n\t__be64\t\t\towner;\t \n};\n\n \n#define XFS_DA_NODE_MAXDEPTH\t5\t \n\ntypedef struct xfs_da_node_hdr {\n\tstruct xfs_da_blkinfo\tinfo;\t \n\t__be16\t\t\t__count;  \n\t__be16\t\t\t__level;  \n} xfs_da_node_hdr_t;\n\nstruct xfs_da3_node_hdr {\n\tstruct xfs_da3_blkinfo\tinfo;\t \n\t__be16\t\t\t__count;  \n\t__be16\t\t\t__level;  \n\t__be32\t\t\t__pad32;\n};\n\n#define XFS_DA3_NODE_CRC_OFF\t(offsetof(struct xfs_da3_node_hdr, info.crc))\n\ntypedef struct xfs_da_node_entry {\n\t__be32\thashval;\t \n\t__be32\tbefore;\t\t \n} xfs_da_node_entry_t;\n\ntypedef struct xfs_da_intnode {\n\tstruct xfs_da_node_hdr\thdr;\n\tstruct xfs_da_node_entry __btree[];\n} xfs_da_intnode_t;\n\nstruct xfs_da3_intnode {\n\tstruct xfs_da3_node_hdr\thdr;\n\tstruct xfs_da_node_entry __btree[];\n};\n\n \n\n#define\tXFS_DIR2_BLOCK_MAGIC\t0x58443242\t \n#define\tXFS_DIR2_DATA_MAGIC\t0x58443244\t \n#define\tXFS_DIR2_FREE_MAGIC\t0x58443246\t \n\n \n\n#define\tXFS_DIR3_BLOCK_MAGIC\t0x58444233\t \n#define\tXFS_DIR3_DATA_MAGIC\t0x58444433\t \n#define\tXFS_DIR3_FREE_MAGIC\t0x58444633\t \n\n \n#define XFS_DIR3_FT_UNKNOWN\t\t0\n#define XFS_DIR3_FT_REG_FILE\t\t1\n#define XFS_DIR3_FT_DIR\t\t\t2\n#define XFS_DIR3_FT_CHRDEV\t\t3\n#define XFS_DIR3_FT_BLKDEV\t\t4\n#define XFS_DIR3_FT_FIFO\t\t5\n#define XFS_DIR3_FT_SOCK\t\t6\n#define XFS_DIR3_FT_SYMLINK\t\t7\n#define XFS_DIR3_FT_WHT\t\t\t8\n\n#define XFS_DIR3_FT_MAX\t\t\t9\n\n \ntypedef uint16_t\txfs_dir2_data_off_t;\n#define\tNULLDATAOFF\t0xffffU\ntypedef uint\t\txfs_dir2_data_aoff_t;\t \n\n \ntypedef uint32_t\txfs_dir2_dataptr_t;\n#define\tXFS_DIR2_MAX_DATAPTR\t((xfs_dir2_dataptr_t)0xffffffff)\n#define\tXFS_DIR2_NULL_DATAPTR\t((xfs_dir2_dataptr_t)0)\n\n \ntypedef\txfs_off_t\txfs_dir2_off_t;\n\n \ntypedef uint32_t\txfs_dir2_db_t;\n\n#define XFS_INO32_SIZE\t4\n#define XFS_INO64_SIZE\t8\n#define XFS_INO64_DIFF\t(XFS_INO64_SIZE - XFS_INO32_SIZE)\n\n#define\tXFS_DIR2_MAX_SHORT_INUM\t((xfs_ino_t)0xffffffffULL)\n\n \ntypedef struct xfs_dir2_sf_hdr {\n\tuint8_t\t\t\tcount;\t\t \n\tuint8_t\t\t\ti8count;\t \n\tuint8_t\t\t\tparent[8];\t \n} __packed xfs_dir2_sf_hdr_t;\n\ntypedef struct xfs_dir2_sf_entry {\n\t__u8\t\t\tnamelen;\t \n\t__u8\t\t\toffset[2];\t \n\t__u8\t\t\tname[];\t\t \n\t \n} __packed xfs_dir2_sf_entry_t;\n\nstatic inline int xfs_dir2_sf_hdr_size(int i8count)\n{\n\treturn sizeof(struct xfs_dir2_sf_hdr) -\n\t\t(i8count == 0) * XFS_INO64_DIFF;\n}\n\nstatic inline xfs_dir2_data_aoff_t\nxfs_dir2_sf_get_offset(xfs_dir2_sf_entry_t *sfep)\n{\n\treturn get_unaligned_be16(sfep->offset);\n}\n\nstatic inline void\nxfs_dir2_sf_put_offset(xfs_dir2_sf_entry_t *sfep, xfs_dir2_data_aoff_t off)\n{\n\tput_unaligned_be16(off, sfep->offset);\n}\n\nstatic inline struct xfs_dir2_sf_entry *\nxfs_dir2_sf_firstentry(struct xfs_dir2_sf_hdr *hdr)\n{\n\treturn (struct xfs_dir2_sf_entry *)\n\t\t((char *)hdr + xfs_dir2_sf_hdr_size(hdr->i8count));\n}\n\n \n\n#define\tXFS_DIR2_DATA_ALIGN_LOG\t3\t\t \n#define\tXFS_DIR2_DATA_ALIGN\t(1 << XFS_DIR2_DATA_ALIGN_LOG)\n#define\tXFS_DIR2_DATA_FREE_TAG\t0xffff\n#define\tXFS_DIR2_DATA_FD_COUNT\t3\n\n \n#define\tXFS_DIR2_MAX_SPACES\t3\n#define\tXFS_DIR2_SPACE_SIZE\t(1ULL << (32 + XFS_DIR2_DATA_ALIGN_LOG))\n#define\tXFS_DIR2_DATA_SPACE\t0\n#define\tXFS_DIR2_DATA_OFFSET\t(XFS_DIR2_DATA_SPACE * XFS_DIR2_SPACE_SIZE)\n\n \ntypedef struct xfs_dir2_data_free {\n\t__be16\t\t\toffset;\t\t \n\t__be16\t\t\tlength;\t\t \n} xfs_dir2_data_free_t;\n\n \ntypedef struct xfs_dir2_data_hdr {\n\t__be32\t\t\tmagic;\t\t \n\t\t\t\t\t\t \n\txfs_dir2_data_free_t\tbestfree[XFS_DIR2_DATA_FD_COUNT];\n} xfs_dir2_data_hdr_t;\n\n \nstruct xfs_dir3_blk_hdr {\n\t__be32\t\t\tmagic;\t \n\t__be32\t\t\tcrc;\t \n\t__be64\t\t\tblkno;\t \n\t__be64\t\t\tlsn;\t \n\tuuid_t\t\t\tuuid;\t \n\t__be64\t\t\towner;\t \n};\n\nstruct xfs_dir3_data_hdr {\n\tstruct xfs_dir3_blk_hdr\thdr;\n\txfs_dir2_data_free_t\tbest_free[XFS_DIR2_DATA_FD_COUNT];\n\t__be32\t\t\tpad;\t \n};\n\n#define XFS_DIR3_DATA_CRC_OFF  offsetof(struct xfs_dir3_data_hdr, hdr.crc)\n\n \ntypedef struct xfs_dir2_data_entry {\n\t__be64\t\t\tinumber;\t \n\t__u8\t\t\tnamelen;\t \n\t__u8\t\t\tname[];\t\t \n      \t \n      \t\t \n} xfs_dir2_data_entry_t;\n\n \ntypedef struct xfs_dir2_data_unused {\n\t__be16\t\t\tfreetag;\t \n\t__be16\t\t\tlength;\t\t \n\t\t\t\t\t\t \n\t__be16\t\t\ttag;\t\t \n} xfs_dir2_data_unused_t;\n\n \nstatic inline __be16 *\nxfs_dir2_data_unused_tag_p(struct xfs_dir2_data_unused *dup)\n{\n\treturn (__be16 *)((char *)dup +\n\t\t\tbe16_to_cpu(dup->length) - sizeof(__be16));\n}\n\n \n\n \n#define\tXFS_DIR2_LEAF_SPACE\t1\n#define\tXFS_DIR2_LEAF_OFFSET\t(XFS_DIR2_LEAF_SPACE * XFS_DIR2_SPACE_SIZE)\n\n \ntypedef struct xfs_dir2_leaf_hdr {\n\txfs_da_blkinfo_t\tinfo;\t\t \n\t__be16\t\t\tcount;\t\t \n\t__be16\t\t\tstale;\t\t \n} xfs_dir2_leaf_hdr_t;\n\nstruct xfs_dir3_leaf_hdr {\n\tstruct xfs_da3_blkinfo\tinfo;\t\t \n\t__be16\t\t\tcount;\t\t \n\t__be16\t\t\tstale;\t\t \n\t__be32\t\t\tpad;\t\t \n};\n\n \ntypedef struct xfs_dir2_leaf_entry {\n\t__be32\t\t\thashval;\t \n\t__be32\t\t\taddress;\t \n} xfs_dir2_leaf_entry_t;\n\n \ntypedef struct xfs_dir2_leaf_tail {\n\t__be32\t\t\tbestcount;\n} xfs_dir2_leaf_tail_t;\n\n \ntypedef struct xfs_dir2_leaf {\n\txfs_dir2_leaf_hdr_t\thdr;\t\t\t \n\txfs_dir2_leaf_entry_t\t__ents[];\t\t \n} xfs_dir2_leaf_t;\n\nstruct xfs_dir3_leaf {\n\tstruct xfs_dir3_leaf_hdr\thdr;\t\t \n\tstruct xfs_dir2_leaf_entry\t__ents[];\t \n};\n\n#define XFS_DIR3_LEAF_CRC_OFF  offsetof(struct xfs_dir3_leaf_hdr, info.crc)\n\n \nstatic inline __be16 *\nxfs_dir2_leaf_bests_p(struct xfs_dir2_leaf_tail *ltp)\n{\n\treturn (__be16 *)ltp - be32_to_cpu(ltp->bestcount);\n}\n\n \n\n \n#define\tXFS_DIR2_FREE_SPACE\t2\n#define\tXFS_DIR2_FREE_OFFSET\t(XFS_DIR2_FREE_SPACE * XFS_DIR2_SPACE_SIZE)\n\ntypedef\tstruct xfs_dir2_free_hdr {\n\t__be32\t\t\tmagic;\t\t \n\t__be32\t\t\tfirstdb;\t \n\t__be32\t\t\tnvalid;\t\t \n\t__be32\t\t\tnused;\t\t \n} xfs_dir2_free_hdr_t;\n\ntypedef struct xfs_dir2_free {\n\txfs_dir2_free_hdr_t\thdr;\t\t \n\t__be16\t\t\tbests[];\t \n\t\t\t\t\t\t \n} xfs_dir2_free_t;\n\nstruct xfs_dir3_free_hdr {\n\tstruct xfs_dir3_blk_hdr\thdr;\n\t__be32\t\t\tfirstdb;\t \n\t__be32\t\t\tnvalid;\t\t \n\t__be32\t\t\tnused;\t\t \n\t__be32\t\t\tpad;\t\t \n};\n\nstruct xfs_dir3_free {\n\tstruct xfs_dir3_free_hdr hdr;\n\t__be16\t\t\tbests[];\t \n\t\t\t\t\t\t \n};\n\n#define XFS_DIR3_FREE_CRC_OFF  offsetof(struct xfs_dir3_free, hdr.hdr.crc)\n\n \n\ntypedef struct xfs_dir2_block_tail {\n\t__be32\t\tcount;\t\t\t \n\t__be32\t\tstale;\t\t\t \n} xfs_dir2_block_tail_t;\n\n \nstatic inline struct xfs_dir2_leaf_entry *\nxfs_dir2_block_leaf_p(struct xfs_dir2_block_tail *btp)\n{\n\treturn ((struct xfs_dir2_leaf_entry *)btp) - be32_to_cpu(btp->count);\n}\n\n\n \n#define XFS_ATTR_LEAF_MAPSIZE\t3\t \n\n \nstruct xfs_attr_shortform {\n\tstruct xfs_attr_sf_hdr {\t \n\t\t__be16\ttotsize;\t \n\t\t__u8\tcount;\t \n\t\t__u8\tpadding;\n\t} hdr;\n\tstruct xfs_attr_sf_entry {\n\t\tuint8_t namelen;\t \n\t\tuint8_t valuelen;\t \n\t\tuint8_t flags;\t \n\t\tuint8_t nameval[];\t \n\t} list[];\t\t\t \n};\n\ntypedef struct xfs_attr_leaf_map {\t \n\t__be16\tbase;\t\t\t   \n\t__be16\tsize;\t\t\t   \n} xfs_attr_leaf_map_t;\n\ntypedef struct xfs_attr_leaf_hdr {\t \n\txfs_da_blkinfo_t info;\t\t \n\t__be16\tcount;\t\t\t \n\t__be16\tusedbytes;\t\t \n\t__be16\tfirstused;\t\t \n\t__u8\tholes;\t\t\t \n\t__u8\tpad1;\n\txfs_attr_leaf_map_t freemap[XFS_ATTR_LEAF_MAPSIZE];\n\t\t\t\t\t \n} xfs_attr_leaf_hdr_t;\n\ntypedef struct xfs_attr_leaf_entry {\t \n\t__be32\thashval;\t\t \n\t__be16\tnameidx;\t\t \n\t__u8\tflags;\t\t\t \n\t__u8\tpad2;\t\t\t \n} xfs_attr_leaf_entry_t;\n\ntypedef struct xfs_attr_leaf_name_local {\n\t__be16\tvaluelen;\t\t \n\t__u8\tnamelen;\t\t \n\t \n\t__u8\tnameval[];\t\t \n} xfs_attr_leaf_name_local_t;\n\ntypedef struct xfs_attr_leaf_name_remote {\n\t__be32\tvalueblk;\t\t \n\t__be32\tvaluelen;\t\t \n\t__u8\tnamelen;\t\t \n\t \n\t__u8\tname[];\t\t\t \n} xfs_attr_leaf_name_remote_t;\n\ntypedef struct xfs_attr_leafblock {\n\txfs_attr_leaf_hdr_t\thdr;\t \n\txfs_attr_leaf_entry_t\tentries[];\t \n\t \n} xfs_attr_leafblock_t;\n\n \nstruct xfs_attr3_leaf_hdr {\n\tstruct xfs_da3_blkinfo\tinfo;\n\t__be16\t\t\tcount;\n\t__be16\t\t\tusedbytes;\n\t__be16\t\t\tfirstused;\n\t__u8\t\t\tholes;\n\t__u8\t\t\tpad1;\n\tstruct xfs_attr_leaf_map freemap[XFS_ATTR_LEAF_MAPSIZE];\n\t__be32\t\t\tpad2;\t\t \n};\n\n#define XFS_ATTR3_LEAF_CRC_OFF\t(offsetof(struct xfs_attr3_leaf_hdr, info.crc))\n\nstruct xfs_attr3_leafblock {\n\tstruct xfs_attr3_leaf_hdr\thdr;\n\tstruct xfs_attr_leaf_entry\tentries[];\n\n\t \n};\n\n \n#define XFS_ATTR3_LEAF_NULLOFF\t0\n\n \n#define\tXFS_ATTR_LOCAL_BIT\t0\t \n#define\tXFS_ATTR_ROOT_BIT\t1\t \n#define\tXFS_ATTR_SECURE_BIT\t2\t \n#define\tXFS_ATTR_INCOMPLETE_BIT\t7\t \n#define XFS_ATTR_LOCAL\t\t(1u << XFS_ATTR_LOCAL_BIT)\n#define XFS_ATTR_ROOT\t\t(1u << XFS_ATTR_ROOT_BIT)\n#define XFS_ATTR_SECURE\t\t(1u << XFS_ATTR_SECURE_BIT)\n#define XFS_ATTR_INCOMPLETE\t(1u << XFS_ATTR_INCOMPLETE_BIT)\n#define XFS_ATTR_NSP_ONDISK_MASK\t(XFS_ATTR_ROOT | XFS_ATTR_SECURE)\n\n \n#define\tXFS_ATTR_LEAF_NAME_ALIGN\t((uint)sizeof(xfs_dablk_t))\n\nstatic inline int\nxfs_attr3_leaf_hdr_size(struct xfs_attr_leafblock *leafp)\n{\n\tif (leafp->hdr.info.magic == cpu_to_be16(XFS_ATTR3_LEAF_MAGIC))\n\t\treturn sizeof(struct xfs_attr3_leaf_hdr);\n\treturn sizeof(struct xfs_attr_leaf_hdr);\n}\n\nstatic inline struct xfs_attr_leaf_entry *\nxfs_attr3_leaf_entryp(xfs_attr_leafblock_t *leafp)\n{\n\tif (leafp->hdr.info.magic == cpu_to_be16(XFS_ATTR3_LEAF_MAGIC))\n\t\treturn &((struct xfs_attr3_leafblock *)leafp)->entries[0];\n\treturn &leafp->entries[0];\n}\n\n \nstatic inline char *\nxfs_attr3_leaf_name(xfs_attr_leafblock_t *leafp, int idx)\n{\n\tstruct xfs_attr_leaf_entry *entries = xfs_attr3_leaf_entryp(leafp);\n\n\treturn &((char *)leafp)[be16_to_cpu(entries[idx].nameidx)];\n}\n\nstatic inline xfs_attr_leaf_name_remote_t *\nxfs_attr3_leaf_name_remote(xfs_attr_leafblock_t *leafp, int idx)\n{\n\treturn (xfs_attr_leaf_name_remote_t *)xfs_attr3_leaf_name(leafp, idx);\n}\n\nstatic inline xfs_attr_leaf_name_local_t *\nxfs_attr3_leaf_name_local(xfs_attr_leafblock_t *leafp, int idx)\n{\n\treturn (xfs_attr_leaf_name_local_t *)xfs_attr3_leaf_name(leafp, idx);\n}\n\n \nstatic inline int xfs_attr_leaf_entsize_remote(int nlen)\n{\n\t \n\tconst size_t remotesize =\n\t\t\toffsetof(struct xfs_attr_leaf_name_remote, name) + 2;\n\n\treturn round_up(remotesize + nlen, XFS_ATTR_LEAF_NAME_ALIGN);\n}\n\nstatic inline int xfs_attr_leaf_entsize_local(int nlen, int vlen)\n{\n\t \n\tconst size_t localsize =\n\t\t\toffsetof(struct xfs_attr_leaf_name_local, nameval);\n\n\treturn round_up(localsize + nlen + vlen, XFS_ATTR_LEAF_NAME_ALIGN);\n}\n\nstatic inline int xfs_attr_leaf_entsize_local_max(int bsize)\n{\n\treturn (((bsize) >> 1) + ((bsize) >> 2));\n}\n\n\n\n \n#define XFS_ATTR3_RMT_MAGIC\t0x5841524d\t \n\nstruct xfs_attr3_rmt_hdr {\n\t__be32\trm_magic;\n\t__be32\trm_offset;\n\t__be32\trm_bytes;\n\t__be32\trm_crc;\n\tuuid_t\trm_uuid;\n\t__be64\trm_owner;\n\t__be64\trm_blkno;\n\t__be64\trm_lsn;\n};\n\n#define XFS_ATTR3_RMT_CRC_OFF\toffsetof(struct xfs_attr3_rmt_hdr, rm_crc)\n\n#define XFS_ATTR3_RMT_BUF_SPACE(mp, bufsize)\t\\\n\t((bufsize) - (xfs_has_crc((mp)) ? \\\n\t\t\tsizeof(struct xfs_attr3_rmt_hdr) : 0))\n\n \nstatic inline unsigned int xfs_dir2_dirblock_bytes(struct xfs_sb *sbp)\n{\n\treturn 1 << (sbp->sb_blocklog + sbp->sb_dirblklog);\n}\n\nxfs_failaddr_t xfs_da3_blkinfo_verify(struct xfs_buf *bp,\n\t\t\t\t      struct xfs_da3_blkinfo *hdr3);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}