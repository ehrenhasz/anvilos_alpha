{
  "module_name": "xfs_trans.h",
  "hash_id": "523c761c588098ce2981b08d7e230960523189b2a46d367616685f19c5f0c27c",
  "original_prompt": "Ingested from linux-6.6.14/fs/xfs/xfs_trans.h",
  "human_readable_source": "\n \n#ifndef\t__XFS_TRANS_H__\n#define\t__XFS_TRANS_H__\n\n \n\nstruct xlog;\nstruct xfs_buf;\nstruct xfs_buftarg;\nstruct xfs_efd_log_item;\nstruct xfs_efi_log_item;\nstruct xfs_inode;\nstruct xfs_item_ops;\nstruct xfs_log_iovec;\nstruct xfs_mount;\nstruct xfs_trans;\nstruct xfs_trans_res;\nstruct xfs_dquot_acct;\nstruct xfs_rud_log_item;\nstruct xfs_rui_log_item;\nstruct xfs_btree_cur;\nstruct xfs_cui_log_item;\nstruct xfs_cud_log_item;\nstruct xfs_bui_log_item;\nstruct xfs_bud_log_item;\n\nstruct xfs_log_item {\n\tstruct list_head\t\tli_ail;\t\t \n\tstruct list_head\t\tli_trans;\t \n\txfs_lsn_t\t\t\tli_lsn;\t\t \n\tstruct xlog\t\t\t*li_log;\n\tstruct xfs_ail\t\t\t*li_ailp;\t \n\tuint\t\t\t\tli_type;\t \n\tunsigned long\t\t\tli_flags;\t \n\tstruct xfs_buf\t\t\t*li_buf;\t \n\tstruct list_head\t\tli_bio_list;\t \n\tconst struct xfs_item_ops\t*li_ops;\t \n\n\t \n\tstruct list_head\t\tli_cil;\t\t \n\tstruct xfs_log_vec\t\t*li_lv;\t\t \n\tstruct xfs_log_vec\t\t*li_lv_shadow;\t \n\txfs_csn_t\t\t\tli_seq;\t\t \n\tuint32_t\t\t\tli_order_id;\t \n};\n\n \n#define\tXFS_LI_IN_AIL\t0\n#define\tXFS_LI_ABORTED\t1\n#define\tXFS_LI_FAILED\t2\n#define\tXFS_LI_DIRTY\t3\n#define\tXFS_LI_WHITEOUT\t4\n\n#define XFS_LI_FLAGS \\\n\t{ (1u << XFS_LI_IN_AIL),\t\"IN_AIL\" }, \\\n\t{ (1u << XFS_LI_ABORTED),\t\"ABORTED\" }, \\\n\t{ (1u << XFS_LI_FAILED),\t\"FAILED\" }, \\\n\t{ (1u << XFS_LI_DIRTY),\t\t\"DIRTY\" }, \\\n\t{ (1u << XFS_LI_WHITEOUT),\t\"WHITEOUT\" }\n\nstruct xfs_item_ops {\n\tunsigned flags;\n\tvoid (*iop_size)(struct xfs_log_item *, int *, int *);\n\tvoid (*iop_format)(struct xfs_log_item *, struct xfs_log_vec *);\n\tvoid (*iop_pin)(struct xfs_log_item *);\n\tvoid (*iop_unpin)(struct xfs_log_item *, int remove);\n\tuint64_t (*iop_sort)(struct xfs_log_item *lip);\n\tint (*iop_precommit)(struct xfs_trans *tp, struct xfs_log_item *lip);\n\tvoid (*iop_committing)(struct xfs_log_item *lip, xfs_csn_t seq);\n\txfs_lsn_t (*iop_committed)(struct xfs_log_item *, xfs_lsn_t);\n\tuint (*iop_push)(struct xfs_log_item *, struct list_head *);\n\tvoid (*iop_release)(struct xfs_log_item *);\n\tint (*iop_recover)(struct xfs_log_item *lip,\n\t\t\t   struct list_head *capture_list);\n\tbool (*iop_match)(struct xfs_log_item *item, uint64_t id);\n\tstruct xfs_log_item *(*iop_relog)(struct xfs_log_item *intent,\n\t\t\tstruct xfs_trans *tp);\n\tstruct xfs_log_item *(*iop_intent)(struct xfs_log_item *intent_done);\n};\n\n \n \n#define XFS_ITEM_RELEASE_WHEN_COMMITTED\t(1 << 0)\n#define XFS_ITEM_INTENT\t\t\t(1 << 1)\n#define XFS_ITEM_INTENT_DONE\t\t(1 << 2)\n\nstatic inline bool\nxlog_item_is_intent(struct xfs_log_item *lip)\n{\n\treturn lip->li_ops->flags & XFS_ITEM_INTENT;\n}\n\nstatic inline bool\nxlog_item_is_intent_done(struct xfs_log_item *lip)\n{\n\treturn lip->li_ops->flags & XFS_ITEM_INTENT_DONE;\n}\n\nvoid\txfs_log_item_init(struct xfs_mount *mp, struct xfs_log_item *item,\n\t\t\t  int type, const struct xfs_item_ops *ops);\n\n \n#define XFS_ITEM_SUCCESS\t0\n#define XFS_ITEM_PINNED\t\t1\n#define XFS_ITEM_LOCKED\t\t2\n#define XFS_ITEM_FLUSHING\t3\n\n \ntypedef struct xfs_trans {\n\tunsigned int\t\tt_magic;\t \n\tunsigned int\t\tt_log_res;\t \n\tunsigned int\t\tt_log_count;\t \n\tunsigned int\t\tt_blk_res;\t \n\tunsigned int\t\tt_blk_res_used;\t \n\tunsigned int\t\tt_rtx_res;\t \n\tunsigned int\t\tt_rtx_res_used;\t \n\tunsigned int\t\tt_flags;\t \n\txfs_agnumber_t\t\tt_highest_agno;\t \n\tstruct xlog_ticket\t*t_ticket;\t \n\tstruct xfs_mount\t*t_mountp;\t \n\tstruct xfs_dquot_acct   *t_dqinfo;\t \n\tint64_t\t\t\tt_icount_delta;\t \n\tint64_t\t\t\tt_ifree_delta;\t \n\tint64_t\t\t\tt_fdblocks_delta;  \n\tint64_t\t\t\tt_res_fdblocks_delta;  \n\tint64_t\t\t\tt_frextents_delta; \n\tint64_t\t\t\tt_res_frextents_delta;  \n\tint64_t\t\t\tt_dblocks_delta; \n\tint64_t\t\t\tt_agcount_delta; \n\tint64_t\t\t\tt_imaxpct_delta; \n\tint64_t\t\t\tt_rextsize_delta; \n\tint64_t\t\t\tt_rbmblocks_delta; \n\tint64_t\t\t\tt_rblocks_delta; \n\tint64_t\t\t\tt_rextents_delta; \n\tint64_t\t\t\tt_rextslog_delta; \n\tstruct list_head\tt_items;\t \n\tstruct list_head\tt_busy;\t\t \n\tstruct list_head\tt_dfops;\t \n\tunsigned long\t\tt_pflags;\t \n} xfs_trans_t;\n\n \n#define\txfs_trans_set_sync(tp)\t\t((tp)->t_flags |= XFS_TRANS_SYNC)\n\n \nint\t\txfs_trans_alloc(struct xfs_mount *mp, struct xfs_trans_res *resp,\n\t\t\tuint blocks, uint rtextents, uint flags,\n\t\t\tstruct xfs_trans **tpp);\nint\t\txfs_trans_alloc_empty(struct xfs_mount *mp,\n\t\t\tstruct xfs_trans **tpp);\nvoid\t\txfs_trans_mod_sb(xfs_trans_t *, uint, int64_t);\n\nint xfs_trans_get_buf_map(struct xfs_trans *tp, struct xfs_buftarg *target,\n\t\tstruct xfs_buf_map *map, int nmaps, xfs_buf_flags_t flags,\n\t\tstruct xfs_buf **bpp);\n\nstatic inline int\nxfs_trans_get_buf(\n\tstruct xfs_trans\t*tp,\n\tstruct xfs_buftarg\t*target,\n\txfs_daddr_t\t\tblkno,\n\tint\t\t\tnumblks,\n\txfs_buf_flags_t\t\tflags,\n\tstruct xfs_buf\t\t**bpp)\n{\n\tDEFINE_SINGLE_BUF_MAP(map, blkno, numblks);\n\treturn xfs_trans_get_buf_map(tp, target, &map, 1, flags, bpp);\n}\n\nint\t\txfs_trans_read_buf_map(struct xfs_mount *mp,\n\t\t\t\t       struct xfs_trans *tp,\n\t\t\t\t       struct xfs_buftarg *target,\n\t\t\t\t       struct xfs_buf_map *map, int nmaps,\n\t\t\t\t       xfs_buf_flags_t flags,\n\t\t\t\t       struct xfs_buf **bpp,\n\t\t\t\t       const struct xfs_buf_ops *ops);\n\nstatic inline int\nxfs_trans_read_buf(\n\tstruct xfs_mount\t*mp,\n\tstruct xfs_trans\t*tp,\n\tstruct xfs_buftarg\t*target,\n\txfs_daddr_t\t\tblkno,\n\tint\t\t\tnumblks,\n\txfs_buf_flags_t\t\tflags,\n\tstruct xfs_buf\t\t**bpp,\n\tconst struct xfs_buf_ops *ops)\n{\n\tDEFINE_SINGLE_BUF_MAP(map, blkno, numblks);\n\treturn xfs_trans_read_buf_map(mp, tp, target, &map, 1,\n\t\t\t\t      flags, bpp, ops);\n}\n\nstruct xfs_buf\t*xfs_trans_getsb(struct xfs_trans *);\n\nvoid\t\txfs_trans_brelse(xfs_trans_t *, struct xfs_buf *);\nvoid\t\txfs_trans_bjoin(xfs_trans_t *, struct xfs_buf *);\nvoid\t\txfs_trans_bhold(xfs_trans_t *, struct xfs_buf *);\nvoid\t\txfs_trans_bhold_release(xfs_trans_t *, struct xfs_buf *);\nvoid\t\txfs_trans_binval(xfs_trans_t *, struct xfs_buf *);\nvoid\t\txfs_trans_inode_buf(xfs_trans_t *, struct xfs_buf *);\nvoid\t\txfs_trans_stale_inode_buf(xfs_trans_t *, struct xfs_buf *);\nbool\t\txfs_trans_ordered_buf(xfs_trans_t *, struct xfs_buf *);\nvoid\t\txfs_trans_dquot_buf(xfs_trans_t *, struct xfs_buf *, uint);\nvoid\t\txfs_trans_inode_alloc_buf(xfs_trans_t *, struct xfs_buf *);\nvoid\t\txfs_trans_ichgtime(struct xfs_trans *, struct xfs_inode *, int);\nvoid\t\txfs_trans_ijoin(struct xfs_trans *, struct xfs_inode *, uint);\nvoid\t\txfs_trans_log_buf(struct xfs_trans *, struct xfs_buf *, uint,\n\t\t\t\t  uint);\nvoid\t\txfs_trans_dirty_buf(struct xfs_trans *, struct xfs_buf *);\nbool\t\txfs_trans_buf_is_dirty(struct xfs_buf *bp);\nvoid\t\txfs_trans_log_inode(xfs_trans_t *, struct xfs_inode *, uint);\n\nint\t\txfs_trans_commit(struct xfs_trans *);\nint\t\txfs_trans_roll(struct xfs_trans **);\nint\t\txfs_trans_roll_inode(struct xfs_trans **, struct xfs_inode *);\nvoid\t\txfs_trans_cancel(xfs_trans_t *);\nint\t\txfs_trans_ail_init(struct xfs_mount *);\nvoid\t\txfs_trans_ail_destroy(struct xfs_mount *);\n\nvoid\t\txfs_trans_buf_set_type(struct xfs_trans *, struct xfs_buf *,\n\t\t\t\t       enum xfs_blft);\nvoid\t\txfs_trans_buf_copy_type(struct xfs_buf *dst_bp,\n\t\t\t\t\tstruct xfs_buf *src_bp);\n\nextern struct kmem_cache\t*xfs_trans_cache;\n\nstatic inline struct xfs_log_item *\nxfs_trans_item_relog(\n\tstruct xfs_log_item\t*lip,\n\tstruct xfs_trans\t*tp)\n{\n\treturn lip->li_ops->iop_relog(lip, tp);\n}\n\nstruct xfs_dquot;\n\nint xfs_trans_alloc_inode(struct xfs_inode *ip, struct xfs_trans_res *resv,\n\t\tunsigned int dblocks, unsigned int rblocks, bool force,\n\t\tstruct xfs_trans **tpp);\nint xfs_trans_alloc_icreate(struct xfs_mount *mp, struct xfs_trans_res *resv,\n\t\tstruct xfs_dquot *udqp, struct xfs_dquot *gdqp,\n\t\tstruct xfs_dquot *pdqp, unsigned int dblocks,\n\t\tstruct xfs_trans **tpp);\nint xfs_trans_alloc_ichange(struct xfs_inode *ip, struct xfs_dquot *udqp,\n\t\tstruct xfs_dquot *gdqp, struct xfs_dquot *pdqp, bool force,\n\t\tstruct xfs_trans **tpp);\nint xfs_trans_alloc_dir(struct xfs_inode *dp, struct xfs_trans_res *resv,\n\t\tstruct xfs_inode *ip, unsigned int *dblocks,\n\t\tstruct xfs_trans **tpp, int *nospace_error);\n\nstatic inline void\nxfs_trans_set_context(\n\tstruct xfs_trans\t*tp)\n{\n\tASSERT(current->journal_info == NULL);\n\ttp->t_pflags = memalloc_nofs_save();\n\tcurrent->journal_info = tp;\n}\n\nstatic inline void\nxfs_trans_clear_context(\n\tstruct xfs_trans\t*tp)\n{\n\tif (current->journal_info == tp) {\n\t\tmemalloc_nofs_restore(tp->t_pflags);\n\t\tcurrent->journal_info = NULL;\n\t}\n}\n\nstatic inline void\nxfs_trans_switch_context(\n\tstruct xfs_trans\t*old_tp,\n\tstruct xfs_trans\t*new_tp)\n{\n\tASSERT(current->journal_info == old_tp);\n\tnew_tp->t_pflags = old_tp->t_pflags;\n\told_tp->t_pflags = 0;\n\tcurrent->journal_info = new_tp;\n}\n\n#endif\t \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}