{
  "module_name": "procfs.c",
  "hash_id": "a4258e00e06cba93d9cf8e5e727f7f026e3bb490dc92c91851c77862809edbd6",
  "original_prompt": "Ingested from linux-6.6.14/fs/lockd/procfs.c",
  "human_readable_source": "\n \n\n#include <linux/fs.h>\n#include <linux/proc_fs.h>\n#include <linux/module.h>\n#include <linux/nsproxy.h>\n#include <net/net_namespace.h>\n\n#include \"netns.h\"\n#include \"procfs.h\"\n\n \nstatic ssize_t\nnlm_end_grace_write(struct file *file, const char __user *buf, size_t size,\n\t\t    loff_t *pos)\n{\n\tchar *data;\n\tstruct lockd_net *ln = net_generic(current->nsproxy->net_ns,\n\t\t\t\t\t   lockd_net_id);\n\n\tif (size < 1)\n\t\treturn -EINVAL;\n\n\tdata = simple_transaction_get(file, buf, size);\n\tif (IS_ERR(data))\n\t\treturn PTR_ERR(data);\n\n\tswitch(data[0]) {\n\tcase 'Y':\n\tcase 'y':\n\tcase '1':\n\t\tlocks_end_grace(&ln->lockd_manager);\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\treturn size;\n}\n\nstatic ssize_t\nnlm_end_grace_read(struct file *file, char __user *buf, size_t size,\n\t\t   loff_t *pos)\n{\n\tstruct lockd_net *ln = net_generic(current->nsproxy->net_ns,\n\t\t\t\t\t   lockd_net_id);\n\tchar resp[3];\n\n\tresp[0] = list_empty(&ln->lockd_manager.list) ? 'Y' : 'N';\n\tresp[1] = '\\n';\n\tresp[2] = '\\0';\n\n\treturn simple_read_from_buffer(buf, size, pos, resp, sizeof(resp));\n}\n\nstatic const struct proc_ops lockd_end_grace_proc_ops = {\n\t.proc_write\t= nlm_end_grace_write,\n\t.proc_read\t= nlm_end_grace_read,\n\t.proc_lseek\t= default_llseek,\n\t.proc_release\t= simple_transaction_release,\n};\n\nint __init\nlockd_create_procfs(void)\n{\n\tstruct proc_dir_entry *entry;\n\n\tentry = proc_mkdir(\"fs/lockd\", NULL);\n\tif (!entry)\n\t\treturn -ENOMEM;\n\tentry = proc_create(\"nlm_end_grace\", S_IRUGO|S_IWUSR, entry,\n\t\t\t    &lockd_end_grace_proc_ops);\n\tif (!entry) {\n\t\tremove_proc_entry(\"fs/lockd\", NULL);\n\t\treturn -ENOMEM;\n\t}\n\treturn 0;\n}\n\nvoid __exit\nlockd_remove_procfs(void)\n{\n\tremove_proc_entry(\"fs/lockd/nlm_end_grace\", NULL);\n\tremove_proc_entry(\"fs/lockd\", NULL);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}