{
  "module_name": "blk-rq-qos.h",
  "hash_id": "16a183afffe9fe56bb7c7c30a2a3851d48b92e774444d238571ae29f6dd9109c",
  "original_prompt": "Ingested from linux-6.6.14/block/blk-rq-qos.h",
  "human_readable_source": " \n#ifndef RQ_QOS_H\n#define RQ_QOS_H\n\n#include <linux/kernel.h>\n#include <linux/blkdev.h>\n#include <linux/blk_types.h>\n#include <linux/atomic.h>\n#include <linux/wait.h>\n#include <linux/blk-mq.h>\n\n#include \"blk-mq-debugfs.h\"\n\nstruct blk_mq_debugfs_attr;\n\nenum rq_qos_id {\n\tRQ_QOS_WBT,\n\tRQ_QOS_LATENCY,\n\tRQ_QOS_COST,\n};\n\nstruct rq_wait {\n\twait_queue_head_t wait;\n\tatomic_t inflight;\n};\n\nstruct rq_qos {\n\tconst struct rq_qos_ops *ops;\n\tstruct gendisk *disk;\n\tenum rq_qos_id id;\n\tstruct rq_qos *next;\n#ifdef CONFIG_BLK_DEBUG_FS\n\tstruct dentry *debugfs_dir;\n#endif\n};\n\nstruct rq_qos_ops {\n\tvoid (*throttle)(struct rq_qos *, struct bio *);\n\tvoid (*track)(struct rq_qos *, struct request *, struct bio *);\n\tvoid (*merge)(struct rq_qos *, struct request *, struct bio *);\n\tvoid (*issue)(struct rq_qos *, struct request *);\n\tvoid (*requeue)(struct rq_qos *, struct request *);\n\tvoid (*done)(struct rq_qos *, struct request *);\n\tvoid (*done_bio)(struct rq_qos *, struct bio *);\n\tvoid (*cleanup)(struct rq_qos *, struct bio *);\n\tvoid (*queue_depth_changed)(struct rq_qos *);\n\tvoid (*exit)(struct rq_qos *);\n\tconst struct blk_mq_debugfs_attr *debugfs_attrs;\n};\n\nstruct rq_depth {\n\tunsigned int max_depth;\n\n\tint scale_step;\n\tbool scaled_max;\n\n\tunsigned int queue_depth;\n\tunsigned int default_depth;\n};\n\nstatic inline struct rq_qos *rq_qos_id(struct request_queue *q,\n\t\t\t\t       enum rq_qos_id id)\n{\n\tstruct rq_qos *rqos;\n\tfor (rqos = q->rq_qos; rqos; rqos = rqos->next) {\n\t\tif (rqos->id == id)\n\t\t\tbreak;\n\t}\n\treturn rqos;\n}\n\nstatic inline struct rq_qos *wbt_rq_qos(struct request_queue *q)\n{\n\treturn rq_qos_id(q, RQ_QOS_WBT);\n}\n\nstatic inline struct rq_qos *iolat_rq_qos(struct request_queue *q)\n{\n\treturn rq_qos_id(q, RQ_QOS_LATENCY);\n}\n\nstatic inline void rq_wait_init(struct rq_wait *rq_wait)\n{\n\tatomic_set(&rq_wait->inflight, 0);\n\tinit_waitqueue_head(&rq_wait->wait);\n}\n\nint rq_qos_add(struct rq_qos *rqos, struct gendisk *disk, enum rq_qos_id id,\n\t\tconst struct rq_qos_ops *ops);\nvoid rq_qos_del(struct rq_qos *rqos);\n\ntypedef bool (acquire_inflight_cb_t)(struct rq_wait *rqw, void *private_data);\ntypedef void (cleanup_cb_t)(struct rq_wait *rqw, void *private_data);\n\nvoid rq_qos_wait(struct rq_wait *rqw, void *private_data,\n\t\t acquire_inflight_cb_t *acquire_inflight_cb,\n\t\t cleanup_cb_t *cleanup_cb);\nbool rq_wait_inc_below(struct rq_wait *rq_wait, unsigned int limit);\nbool rq_depth_scale_up(struct rq_depth *rqd);\nbool rq_depth_scale_down(struct rq_depth *rqd, bool hard_throttle);\nbool rq_depth_calc_max_depth(struct rq_depth *rqd);\n\nvoid __rq_qos_cleanup(struct rq_qos *rqos, struct bio *bio);\nvoid __rq_qos_done(struct rq_qos *rqos, struct request *rq);\nvoid __rq_qos_issue(struct rq_qos *rqos, struct request *rq);\nvoid __rq_qos_requeue(struct rq_qos *rqos, struct request *rq);\nvoid __rq_qos_throttle(struct rq_qos *rqos, struct bio *bio);\nvoid __rq_qos_track(struct rq_qos *rqos, struct request *rq, struct bio *bio);\nvoid __rq_qos_merge(struct rq_qos *rqos, struct request *rq, struct bio *bio);\nvoid __rq_qos_done_bio(struct rq_qos *rqos, struct bio *bio);\nvoid __rq_qos_queue_depth_changed(struct rq_qos *rqos);\n\nstatic inline void rq_qos_cleanup(struct request_queue *q, struct bio *bio)\n{\n\tif (q->rq_qos)\n\t\t__rq_qos_cleanup(q->rq_qos, bio);\n}\n\nstatic inline void rq_qos_done(struct request_queue *q, struct request *rq)\n{\n\tif (q->rq_qos)\n\t\t__rq_qos_done(q->rq_qos, rq);\n}\n\nstatic inline void rq_qos_issue(struct request_queue *q, struct request *rq)\n{\n\tif (q->rq_qos)\n\t\t__rq_qos_issue(q->rq_qos, rq);\n}\n\nstatic inline void rq_qos_requeue(struct request_queue *q, struct request *rq)\n{\n\tif (q->rq_qos)\n\t\t__rq_qos_requeue(q->rq_qos, rq);\n}\n\nstatic inline void rq_qos_done_bio(struct bio *bio)\n{\n\tif (bio->bi_bdev && (bio_flagged(bio, BIO_QOS_THROTTLED) ||\n\t\t\t     bio_flagged(bio, BIO_QOS_MERGED))) {\n\t\tstruct request_queue *q = bdev_get_queue(bio->bi_bdev);\n\t\tif (q->rq_qos)\n\t\t\t__rq_qos_done_bio(q->rq_qos, bio);\n\t}\n}\n\nstatic inline void rq_qos_throttle(struct request_queue *q, struct bio *bio)\n{\n\tif (q->rq_qos) {\n\t\tbio_set_flag(bio, BIO_QOS_THROTTLED);\n\t\t__rq_qos_throttle(q->rq_qos, bio);\n\t}\n}\n\nstatic inline void rq_qos_track(struct request_queue *q, struct request *rq,\n\t\t\t\tstruct bio *bio)\n{\n\tif (q->rq_qos)\n\t\t__rq_qos_track(q->rq_qos, rq, bio);\n}\n\nstatic inline void rq_qos_merge(struct request_queue *q, struct request *rq,\n\t\t\t\tstruct bio *bio)\n{\n\tif (q->rq_qos) {\n\t\tbio_set_flag(bio, BIO_QOS_MERGED);\n\t\t__rq_qos_merge(q->rq_qos, rq, bio);\n\t}\n}\n\nstatic inline void rq_qos_queue_depth_changed(struct request_queue *q)\n{\n\tif (q->rq_qos)\n\t\t__rq_qos_queue_depth_changed(q->rq_qos);\n}\n\nvoid rq_qos_exit(struct request_queue *);\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}