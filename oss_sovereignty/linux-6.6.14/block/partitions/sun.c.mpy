{
  "module_name": "sun.c",
  "hash_id": "809dc4fd48c676bfdeb55201f22b6c178fad371249ea1acedbb2542ea761ba7d",
  "original_prompt": "Ingested from linux-6.6.14/block/partitions/sun.c",
  "human_readable_source": "\n \n\n#include \"check.h\"\n\n#define SUN_LABEL_MAGIC          0xDABE\n#define SUN_VTOC_SANITY          0x600DDEEE\n\nenum {\n\tSUN_WHOLE_DISK = 5,\n\tLINUX_RAID_PARTITION = 0xfd,\t \n};\n\nint sun_partition(struct parsed_partitions *state)\n{\n\tint i;\n\t__be16 csum;\n\tint slot = 1;\n\t__be16 *ush;\n\tSector sect;\n\tstruct sun_disklabel {\n\t\tunsigned char info[128];    \n\t\tstruct sun_vtoc {\n\t\t    __be32 version;      \n\t\t    char   volume[8];    \n\t\t    __be16 nparts;       \n\t\t    struct sun_info {            \n\t\t\t__be16 id;\n\t\t\t__be16 flags;\n\t\t    } infos[8];\n\t\t    __be16 padding;      \n\t\t    __be32 bootinfo[3];   \n\t\t    __be32 sanity;        \n\t\t    __be32 reserved[10];  \n\t\t    __be32 timestamp[8];  \n\t\t} vtoc;\n\t\t__be32 write_reinstruct;  \n\t\t__be32 read_reinstruct;   \n\t\tunsigned char spare[148];  \n\t\t__be16 rspeed;      \n\t\t__be16 pcylcount;   \n\t\t__be16 sparecyl;    \n\t\t__be16 obs1;        \n\t\t__be16 obs2;        \n\t\t__be16 ilfact;      \n\t\t__be16 ncyl;        \n\t\t__be16 nacyl;       \n\t\t__be16 ntrks;       \n\t\t__be16 nsect;       \n\t\t__be16 obs3;        \n\t\t__be16 obs4;        \n\t\tstruct sun_partition {\n\t\t\t__be32 start_cylinder;\n\t\t\t__be32 num_sectors;\n\t\t} partitions[8];\n\t\t__be16 magic;       \n\t\t__be16 csum;        \n\t} * label;\n\tstruct sun_partition *p;\n\tunsigned long spc;\n\tint use_vtoc;\n\tint nparts;\n\n\tlabel = read_part_sector(state, 0, &sect);\n\tif (!label)\n\t\treturn -1;\n\n\tp = label->partitions;\n\tif (be16_to_cpu(label->magic) != SUN_LABEL_MAGIC) {\n \n\t\tput_dev_sector(sect);\n\t\treturn 0;\n\t}\n\t \n\tush = ((__be16 *) (label+1)) - 1;\n\tfor (csum = 0; ush >= ((__be16 *) label);)\n\t\tcsum ^= *ush--;\n\tif (csum) {\n\t\tprintk(\"Dev %s Sun disklabel: Csum bad, label corrupted\\n\",\n\t\t       state->disk->disk_name);\n\t\tput_dev_sector(sect);\n\t\treturn 0;\n\t}\n\n\t \n\tuse_vtoc = ((be32_to_cpu(label->vtoc.sanity) == SUN_VTOC_SANITY) &&\n\t\t    (be32_to_cpu(label->vtoc.version) == 1) &&\n\t\t    (be16_to_cpu(label->vtoc.nparts) <= 8));\n\n\t \n\tnparts = (use_vtoc) ? be16_to_cpu(label->vtoc.nparts) : 8;\n\n\t \n\tuse_vtoc = use_vtoc || !(label->vtoc.sanity ||\n\t\t\t\t label->vtoc.version || label->vtoc.nparts);\n\tspc = be16_to_cpu(label->ntrks) * be16_to_cpu(label->nsect);\n\tfor (i = 0; i < nparts; i++, p++) {\n\t\tunsigned long st_sector;\n\t\tunsigned int num_sectors;\n\n\t\tst_sector = be32_to_cpu(p->start_cylinder) * spc;\n\t\tnum_sectors = be32_to_cpu(p->num_sectors);\n\t\tif (num_sectors) {\n\t\t\tput_partition(state, slot, st_sector, num_sectors);\n\t\t\tstate->parts[slot].flags = 0;\n\t\t\tif (use_vtoc) {\n\t\t\t\tif (be16_to_cpu(label->vtoc.infos[i].id) == LINUX_RAID_PARTITION)\n\t\t\t\t\tstate->parts[slot].flags |= ADDPART_FLAG_RAID;\n\t\t\t\telse if (be16_to_cpu(label->vtoc.infos[i].id) == SUN_WHOLE_DISK)\n\t\t\t\t\tstate->parts[slot].flags |= ADDPART_FLAG_WHOLEDISK;\n\t\t\t}\n\t\t}\n\t\tslot++;\n\t}\n\tstrlcat(state->pp_buf, \"\\n\", PAGE_SIZE);\n\tput_dev_sector(sect);\n\treturn 1;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}