{
  "module_name": "sgi.c",
  "hash_id": "750e685a65048278195365fd73e77115be72a0fba3a34f85c8de23b582642872",
  "original_prompt": "Ingested from linux-6.6.14/block/partitions/sgi.c",
  "human_readable_source": "\n \n\n#include \"check.h\"\n\n#define SGI_LABEL_MAGIC 0x0be5a941\n\nenum {\n\tLINUX_RAID_PARTITION = 0xfd,\t \n};\n\nstruct sgi_disklabel {\n\t__be32 magic_mushroom;\t\t \n\t__be16 root_part_num;\t\t \n\t__be16 swap_part_num;\t\t \n\ts8 boot_file[16];\t\t \n\tu8 _unused0[48];\t\t \n\tstruct sgi_volume {\n\t\ts8 name[8];\t\t \n\t\t__be32 block_num;\t\t \n\t\t__be32 num_bytes;\t\t \n\t} volume[15];\n\tstruct sgi_partition {\n\t\t__be32 num_blocks;\t\t \n\t\t__be32 first_block;\t \n\t\t__be32 type;\t\t \n\t} partitions[16];\n\t__be32 csum;\t\t\t \n\t__be32 _unused1;\t\t\t \n};\n\nint sgi_partition(struct parsed_partitions *state)\n{\n\tint i, csum;\n\t__be32 magic;\n\tint slot = 1;\n\tunsigned int start, blocks;\n\t__be32 *ui, cs;\n\tSector sect;\n\tstruct sgi_disklabel *label;\n\tstruct sgi_partition *p;\n\n\tlabel = read_part_sector(state, 0, &sect);\n\tif (!label)\n\t\treturn -1;\n\tp = &label->partitions[0];\n\tmagic = label->magic_mushroom;\n\tif(be32_to_cpu(magic) != SGI_LABEL_MAGIC) {\n\t\t \n\t\tput_dev_sector(sect);\n\t\treturn 0;\n\t}\n\tui = ((__be32 *) (label + 1)) - 1;\n\tfor(csum = 0; ui >= ((__be32 *) label);) {\n\t\tcs = *ui--;\n\t\tcsum += be32_to_cpu(cs);\n\t}\n\tif(csum) {\n\t\tprintk(KERN_WARNING \"Dev %s SGI disklabel: csum bad, label corrupted\\n\",\n\t\t       state->disk->disk_name);\n\t\tput_dev_sector(sect);\n\t\treturn 0;\n\t}\n\t \n\tfor(i = 0; i < 16; i++, p++) {\n\t\tblocks = be32_to_cpu(p->num_blocks);\n\t\tstart  = be32_to_cpu(p->first_block);\n\t\tif (blocks) {\n\t\t\tput_partition(state, slot, start, blocks);\n\t\t\tif (be32_to_cpu(p->type) == LINUX_RAID_PARTITION)\n\t\t\t\tstate->parts[slot].flags = ADDPART_FLAG_RAID;\n\t\t}\n\t\tslot++;\n\t}\n\tstrlcat(state->pp_buf, \"\\n\", PAGE_SIZE);\n\tput_dev_sector(sect);\n\treturn 1;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}