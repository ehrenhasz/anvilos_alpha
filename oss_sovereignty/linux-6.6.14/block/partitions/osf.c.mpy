{
  "module_name": "osf.c",
  "hash_id": "6ce4ddeb0ae19713c0a79cc1b16638685759b01d88b064c12bc0b1c617730257",
  "original_prompt": "Ingested from linux-6.6.14/block/partitions/osf.c",
  "human_readable_source": "\n \n\n#include \"check.h\"\n\n#define MAX_OSF_PARTITIONS 18\n#define DISKLABELMAGIC (0x82564557UL)\n\nint osf_partition(struct parsed_partitions *state)\n{\n\tint i;\n\tint slot = 1;\n\tunsigned int npartitions;\n\tSector sect;\n\tunsigned char *data;\n\tstruct disklabel {\n\t\t__le32 d_magic;\n\t\t__le16 d_type,d_subtype;\n\t\tu8 d_typename[16];\n\t\tu8 d_packname[16];\n\t\t__le32 d_secsize;\n\t\t__le32 d_nsectors;\n\t\t__le32 d_ntracks;\n\t\t__le32 d_ncylinders;\n\t\t__le32 d_secpercyl;\n\t\t__le32 d_secprtunit;\n\t\t__le16 d_sparespertrack;\n\t\t__le16 d_sparespercyl;\n\t\t__le32 d_acylinders;\n\t\t__le16 d_rpm, d_interleave, d_trackskew, d_cylskew;\n\t\t__le32 d_headswitch, d_trkseek, d_flags;\n\t\t__le32 d_drivedata[5];\n\t\t__le32 d_spare[5];\n\t\t__le32 d_magic2;\n\t\t__le16 d_checksum;\n\t\t__le16 d_npartitions;\n\t\t__le32 d_bbsize, d_sbsize;\n\t\tstruct d_partition {\n\t\t\t__le32 p_size;\n\t\t\t__le32 p_offset;\n\t\t\t__le32 p_fsize;\n\t\t\tu8  p_fstype;\n\t\t\tu8  p_frag;\n\t\t\t__le16 p_cpg;\n\t\t} d_partitions[MAX_OSF_PARTITIONS];\n\t} * label;\n\tstruct d_partition * partition;\n\n\tdata = read_part_sector(state, 0, &sect);\n\tif (!data)\n\t\treturn -1;\n\n\tlabel = (struct disklabel *) (data+64);\n\tpartition = label->d_partitions;\n\tif (le32_to_cpu(label->d_magic) != DISKLABELMAGIC) {\n\t\tput_dev_sector(sect);\n\t\treturn 0;\n\t}\n\tif (le32_to_cpu(label->d_magic2) != DISKLABELMAGIC) {\n\t\tput_dev_sector(sect);\n\t\treturn 0;\n\t}\n\tnpartitions = le16_to_cpu(label->d_npartitions);\n\tif (npartitions > MAX_OSF_PARTITIONS) {\n\t\tput_dev_sector(sect);\n\t\treturn 0;\n\t}\n\tfor (i = 0 ; i < npartitions; i++, partition++) {\n\t\tif (slot == state->limit)\n\t\t        break;\n\t\tif (le32_to_cpu(partition->p_size))\n\t\t\tput_partition(state, slot,\n\t\t\t\tle32_to_cpu(partition->p_offset),\n\t\t\t\tle32_to_cpu(partition->p_size));\n\t\tslot++;\n\t}\n\tstrlcat(state->pp_buf, \"\\n\", PAGE_SIZE);\n\tput_dev_sector(sect);\n\treturn 1;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}