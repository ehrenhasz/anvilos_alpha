{
  "module_name": "filetable.h",
  "hash_id": "3f8939e422d2346abed50d876f6bf8ab784605d2468552560453bacf0e6ccc8e",
  "original_prompt": "Ingested from linux-6.6.14/io_uring/filetable.h",
  "human_readable_source": "\n#ifndef IOU_FILE_TABLE_H\n#define IOU_FILE_TABLE_H\n\n#include <linux/file.h>\n#include <linux/io_uring_types.h>\n\nbool io_alloc_file_tables(struct io_file_table *table, unsigned nr_files);\nvoid io_free_file_tables(struct io_file_table *table);\n\nint io_fixed_fd_install(struct io_kiocb *req, unsigned int issue_flags,\n\t\t\tstruct file *file, unsigned int file_slot);\nint __io_fixed_fd_install(struct io_ring_ctx *ctx, struct file *file,\n\t\t\t\tunsigned int file_slot);\nint io_fixed_fd_remove(struct io_ring_ctx *ctx, unsigned int offset);\n\nint io_register_file_alloc_range(struct io_ring_ctx *ctx,\n\t\t\t\t struct io_uring_file_index_range __user *arg);\n\nunsigned int io_file_get_flags(struct file *file);\n\nstatic inline void io_file_bitmap_clear(struct io_file_table *table, int bit)\n{\n\tWARN_ON_ONCE(!test_bit(bit, table->bitmap));\n\t__clear_bit(bit, table->bitmap);\n\ttable->alloc_hint = bit;\n}\n\nstatic inline void io_file_bitmap_set(struct io_file_table *table, int bit)\n{\n\tWARN_ON_ONCE(test_bit(bit, table->bitmap));\n\t__set_bit(bit, table->bitmap);\n\ttable->alloc_hint = bit + 1;\n}\n\nstatic inline struct io_fixed_file *\nio_fixed_file_slot(struct io_file_table *table, unsigned i)\n{\n\treturn &table->files[i];\n}\n\n#define FFS_NOWAIT\t\t0x1UL\n#define FFS_ISREG\t\t0x2UL\n#define FFS_MASK\t\t~(FFS_NOWAIT|FFS_ISREG)\n\nstatic inline unsigned int io_slot_flags(struct io_fixed_file *slot)\n{\n\treturn (slot->file_ptr & ~FFS_MASK) << REQ_F_SUPPORT_NOWAIT_BIT;\n}\n\nstatic inline struct file *io_slot_file(struct io_fixed_file *slot)\n{\n\treturn (struct file *)(slot->file_ptr & FFS_MASK);\n}\n\nstatic inline struct file *io_file_from_index(struct io_file_table *table,\n\t\t\t\t\t      int index)\n{\n\treturn io_slot_file(io_fixed_file_slot(table, index));\n}\n\nstatic inline void io_fixed_file_set(struct io_fixed_file *file_slot,\n\t\t\t\t     struct file *file)\n{\n\tfile_slot->file_ptr = (unsigned long)file |\n\t\t(io_file_get_flags(file) >> REQ_F_SUPPORT_NOWAIT_BIT);\n}\n\nstatic inline void io_reset_alloc_hint(struct io_ring_ctx *ctx)\n{\n\tctx->file_table.alloc_hint = ctx->file_alloc_start;\n}\n\nstatic inline void io_file_table_set_alloc_range(struct io_ring_ctx *ctx,\n\t\t\t\t\t\t unsigned off, unsigned len)\n{\n\tctx->file_alloc_start = off;\n\tctx->file_alloc_end = off + len;\n\tio_reset_alloc_hint(ctx);\n}\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}