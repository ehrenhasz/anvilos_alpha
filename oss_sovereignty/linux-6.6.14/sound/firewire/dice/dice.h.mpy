{
  "module_name": "dice.h",
  "hash_id": "2008c85968ae18dfadbd790dfab324433fd300f843ab60e2832bd4b2b7cfd41c",
  "original_prompt": "Ingested from linux-6.6.14/sound/firewire/dice/dice.h",
  "human_readable_source": " \n \n\n#ifndef SOUND_DICE_H_INCLUDED\n#define SOUND_DICE_H_INCLUDED\n\n#include <linux/compat.h>\n#include <linux/completion.h>\n#include <linux/delay.h>\n#include <linux/device.h>\n#include <linux/firewire.h>\n#include <linux/firewire-constants.h>\n#include <linux/jiffies.h>\n#include <linux/module.h>\n#include <linux/mod_devicetable.h>\n#include <linux/mutex.h>\n#include <linux/slab.h>\n#include <linux/spinlock.h>\n#include <linux/wait.h>\n#include <linux/sched/signal.h>\n\n#include <sound/control.h>\n#include <sound/core.h>\n#include <sound/firewire.h>\n#include <sound/hwdep.h>\n#include <sound/info.h>\n#include <sound/initval.h>\n#include <sound/pcm.h>\n#include <sound/pcm_params.h>\n#include <sound/rawmidi.h>\n\n#include \"../amdtp-am824.h\"\n#include \"../iso-resources.h\"\n#include \"../lib.h\"\n#include \"dice-interface.h\"\n\n \n#define MAX_STREAMS\t2\n\nenum snd_dice_rate_mode {\n\tSND_DICE_RATE_MODE_LOW = 0,\n\tSND_DICE_RATE_MODE_MIDDLE,\n\tSND_DICE_RATE_MODE_HIGH,\n\tSND_DICE_RATE_MODE_COUNT,\n};\n\nstruct snd_dice;\ntypedef int (*snd_dice_detect_formats_t)(struct snd_dice *dice);\n\nstruct snd_dice {\n\tstruct snd_card *card;\n\tstruct fw_unit *unit;\n\tspinlock_t lock;\n\tstruct mutex mutex;\n\n\t \n\tunsigned int global_offset;\n\tunsigned int rx_offset;\n\tunsigned int tx_offset;\n\tunsigned int sync_offset;\n\tunsigned int rsrv_offset;\n\n\tunsigned int clock_caps;\n\tunsigned int tx_pcm_chs[MAX_STREAMS][SND_DICE_RATE_MODE_COUNT];\n\tunsigned int rx_pcm_chs[MAX_STREAMS][SND_DICE_RATE_MODE_COUNT];\n\tunsigned int tx_midi_ports[MAX_STREAMS];\n\tunsigned int rx_midi_ports[MAX_STREAMS];\n\n\tstruct fw_address_handler notification_handler;\n\tint owner_generation;\n\tu32 notification_bits;\n\n\t \n\tint dev_lock_count;  \n\tbool dev_lock_changed;\n\twait_queue_head_t hwdep_wait;\n\n\t \n\tstruct fw_iso_resources tx_resources[MAX_STREAMS];\n\tstruct fw_iso_resources rx_resources[MAX_STREAMS];\n\tstruct amdtp_stream tx_stream[MAX_STREAMS];\n\tstruct amdtp_stream rx_stream[MAX_STREAMS];\n\tbool global_enabled:1;\n\tbool disable_double_pcm_frames:1;\n\tstruct completion clock_accepted;\n\tunsigned int substreams_counter;\n\n\tstruct amdtp_domain domain;\n};\n\nenum snd_dice_addr_type {\n\tSND_DICE_ADDR_TYPE_PRIVATE,\n\tSND_DICE_ADDR_TYPE_GLOBAL,\n\tSND_DICE_ADDR_TYPE_TX,\n\tSND_DICE_ADDR_TYPE_RX,\n\tSND_DICE_ADDR_TYPE_SYNC,\n\tSND_DICE_ADDR_TYPE_RSRV,\n};\n\nint snd_dice_transaction_write(struct snd_dice *dice,\n\t\t\t       enum snd_dice_addr_type type,\n\t\t\t       unsigned int offset,\n\t\t\t       void *buf, unsigned int len);\nint snd_dice_transaction_read(struct snd_dice *dice,\n\t\t\t      enum snd_dice_addr_type type, unsigned int offset,\n\t\t\t      void *buf, unsigned int len);\n\nstatic inline int snd_dice_transaction_write_global(struct snd_dice *dice,\n\t\t\t\t\t\t    unsigned int offset,\n\t\t\t\t\t\t    void *buf, unsigned int len)\n{\n\treturn snd_dice_transaction_write(dice,\n\t\t\t\t\t  SND_DICE_ADDR_TYPE_GLOBAL, offset,\n\t\t\t\t\t  buf, len);\n}\nstatic inline int snd_dice_transaction_read_global(struct snd_dice *dice,\n\t\t\t\t\t\t   unsigned int offset,\n\t\t\t\t\t\t   void *buf, unsigned int len)\n{\n\treturn snd_dice_transaction_read(dice,\n\t\t\t\t\t SND_DICE_ADDR_TYPE_GLOBAL, offset,\n\t\t\t\t\t buf, len);\n}\nstatic inline int snd_dice_transaction_write_tx(struct snd_dice *dice,\n\t\t\t\t\t\tunsigned int offset,\n\t\t\t\t\t\tvoid *buf, unsigned int len)\n{\n\treturn snd_dice_transaction_write(dice, SND_DICE_ADDR_TYPE_TX, offset,\n\t\t\t\t\t  buf, len);\n}\nstatic inline int snd_dice_transaction_read_tx(struct snd_dice *dice,\n\t\t\t\t\t       unsigned int offset,\n\t\t\t\t\t       void *buf, unsigned int len)\n{\n\treturn snd_dice_transaction_read(dice, SND_DICE_ADDR_TYPE_TX, offset,\n\t\t\t\t\t buf, len);\n}\nstatic inline int snd_dice_transaction_write_rx(struct snd_dice *dice,\n\t\t\t\t\t\tunsigned int offset,\n\t\t\t\t\t\tvoid *buf, unsigned int len)\n{\n\treturn snd_dice_transaction_write(dice, SND_DICE_ADDR_TYPE_RX, offset,\n\t\t\t\t\t  buf, len);\n}\nstatic inline int snd_dice_transaction_read_rx(struct snd_dice *dice,\n\t\t\t\t\t       unsigned int offset,\n\t\t\t\t\t       void *buf, unsigned int len)\n{\n\treturn snd_dice_transaction_read(dice, SND_DICE_ADDR_TYPE_RX, offset,\n\t\t\t\t\t buf, len);\n}\nstatic inline int snd_dice_transaction_write_sync(struct snd_dice *dice,\n\t\t\t\t\t\t  unsigned int offset,\n\t\t\t\t\t\t  void *buf, unsigned int len)\n{\n\treturn snd_dice_transaction_write(dice, SND_DICE_ADDR_TYPE_SYNC, offset,\n\t\t\t\t\t  buf, len);\n}\nstatic inline int snd_dice_transaction_read_sync(struct snd_dice *dice,\n\t\t\t\t\t\t unsigned int offset,\n\t\t\t\t\t\t void *buf, unsigned int len)\n{\n\treturn snd_dice_transaction_read(dice, SND_DICE_ADDR_TYPE_SYNC, offset,\n\t\t\t\t\t buf, len);\n}\n\nint snd_dice_transaction_get_clock_source(struct snd_dice *dice,\n\t\t\t\t\t  unsigned int *source);\nint snd_dice_transaction_get_rate(struct snd_dice *dice, unsigned int *rate);\nint snd_dice_transaction_set_enable(struct snd_dice *dice);\nvoid snd_dice_transaction_clear_enable(struct snd_dice *dice);\nint snd_dice_transaction_init(struct snd_dice *dice);\nint snd_dice_transaction_reinit(struct snd_dice *dice);\nvoid snd_dice_transaction_destroy(struct snd_dice *dice);\n\n#define SND_DICE_RATES_COUNT\t7\nextern const unsigned int snd_dice_rates[SND_DICE_RATES_COUNT];\n\nint snd_dice_stream_get_rate_mode(struct snd_dice *dice, unsigned int rate,\n\t\t\t\t  enum snd_dice_rate_mode *mode);\nint snd_dice_stream_start_duplex(struct snd_dice *dice);\nvoid snd_dice_stream_stop_duplex(struct snd_dice *dice);\nint snd_dice_stream_init_duplex(struct snd_dice *dice);\nvoid snd_dice_stream_destroy_duplex(struct snd_dice *dice);\nint snd_dice_stream_reserve_duplex(struct snd_dice *dice, unsigned int rate,\n\t\t\t\t   unsigned int events_per_period,\n\t\t\t\t   unsigned int events_per_buffer);\nvoid snd_dice_stream_update_duplex(struct snd_dice *dice);\nint snd_dice_stream_detect_current_formats(struct snd_dice *dice);\n\nint snd_dice_stream_lock_try(struct snd_dice *dice);\nvoid snd_dice_stream_lock_release(struct snd_dice *dice);\n\nint snd_dice_create_pcm(struct snd_dice *dice);\n\nint snd_dice_create_hwdep(struct snd_dice *dice);\n\nvoid snd_dice_create_proc(struct snd_dice *dice);\n\nint snd_dice_create_midi(struct snd_dice *dice);\n\nint snd_dice_detect_tcelectronic_formats(struct snd_dice *dice);\nint snd_dice_detect_alesis_formats(struct snd_dice *dice);\nint snd_dice_detect_alesis_mastercontrol_formats(struct snd_dice *dice);\nint snd_dice_detect_extension_formats(struct snd_dice *dice);\nint snd_dice_detect_mytek_formats(struct snd_dice *dice);\nint snd_dice_detect_presonus_formats(struct snd_dice *dice);\nint snd_dice_detect_harman_formats(struct snd_dice *dice);\nint snd_dice_detect_focusrite_pro40_tcd3070_formats(struct snd_dice *dice);\nint snd_dice_detect_weiss_formats(struct snd_dice *dice);\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}