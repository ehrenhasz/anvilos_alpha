{
  "module_name": "tascam.h",
  "hash_id": "4525ff087572ba8ca4cd936ed5be9802bc37d1531df5fe93e99be6d89775eac9",
  "original_prompt": "Ingested from linux-6.6.14/sound/firewire/tascam/tascam.h",
  "human_readable_source": " \n \n\n#ifndef SOUND_TASCAM_H_INCLUDED\n#define SOUND_TASCAM_H_INCLUDED\n\n#include <linux/device.h>\n#include <linux/firewire.h>\n#include <linux/firewire-constants.h>\n#include <linux/module.h>\n#include <linux/mod_devicetable.h>\n#include <linux/mutex.h>\n#include <linux/slab.h>\n#include <linux/compat.h>\n#include <linux/sched/signal.h>\n\n#include <sound/core.h>\n#include <sound/initval.h>\n#include <sound/info.h>\n#include <sound/pcm.h>\n#include <sound/pcm_params.h>\n#include <sound/firewire.h>\n#include <sound/hwdep.h>\n#include <sound/rawmidi.h>\n\n#include \"../lib.h\"\n#include \"../amdtp-stream.h\"\n#include \"../iso-resources.h\"\n\nstruct snd_tscm_spec {\n\tconst char *const name;\n\tbool has_adat;\n\tbool has_spdif;\n\tunsigned int pcm_capture_analog_channels;\n\tunsigned int pcm_playback_analog_channels;\n\tunsigned int midi_capture_ports;\n\tunsigned int midi_playback_ports;\n};\n\n#define TSCM_MIDI_IN_PORT_MAX\t4\n#define TSCM_MIDI_OUT_PORT_MAX\t4\n\nstruct snd_fw_async_midi_port {\n\tstruct fw_device *parent;\n\tstruct work_struct work;\n\tbool idling;\n\tktime_t next_ktime;\n\tbool error;\n\n\tstruct fw_transaction transaction;\n\n\tu8 buf[4];\n\tu8 running_status;\n\tbool on_sysex;\n\n\tstruct snd_rawmidi_substream *substream;\n\tint consume_bytes;\n};\n\n#define SND_TSCM_QUEUE_COUNT\t16\n\nstruct snd_tscm {\n\tstruct snd_card *card;\n\tstruct fw_unit *unit;\n\n\tstruct mutex mutex;\n\tspinlock_t lock;\n\n\tconst struct snd_tscm_spec *spec;\n\n\tstruct fw_iso_resources tx_resources;\n\tstruct fw_iso_resources rx_resources;\n\tstruct amdtp_stream tx_stream;\n\tstruct amdtp_stream rx_stream;\n\tunsigned int substreams_counter;\n\n\tint dev_lock_count;\n\tbool dev_lock_changed;\n\twait_queue_head_t hwdep_wait;\n\n\t \n\tstruct fw_address_handler async_handler;\n\tstruct snd_rawmidi_substream *tx_midi_substreams[TSCM_MIDI_IN_PORT_MAX];\n\n\t \n\tstruct snd_fw_async_midi_port out_ports[TSCM_MIDI_OUT_PORT_MAX];\n\n\t\n\t__be32 state[SNDRV_FIREWIRE_TASCAM_STATE_COUNT];\n\tstruct snd_hwdep *hwdep;\n\tstruct snd_firewire_tascam_change queue[SND_TSCM_QUEUE_COUNT];\n\tunsigned int pull_pos;\n\tunsigned int push_pos;\n\n\tstruct amdtp_domain domain;\n\tbool need_long_tx_init_skip;\n};\n\n#define TSCM_ADDR_BASE\t\t\t0xffff00000000ull\n\n#define TSCM_OFFSET_FIRMWARE_REGISTER\t0x0000\n#define TSCM_OFFSET_FIRMWARE_FPGA\t0x0004\n#define TSCM_OFFSET_FIRMWARE_ARM\t0x0008\n#define TSCM_OFFSET_FIRMWARE_HW\t\t0x000c\n\n#define TSCM_OFFSET_ISOC_TX_CH\t\t0x0200\n#define TSCM_OFFSET_UNKNOWN\t\t0x0204\n#define TSCM_OFFSET_START_STREAMING\t0x0208\n#define TSCM_OFFSET_ISOC_RX_CH\t\t0x020c\n#define TSCM_OFFSET_ISOC_RX_ON\t\t0x0210\t \n#define TSCM_OFFSET_TX_PCM_CHANNELS\t0x0214\n#define TSCM_OFFSET_RX_PCM_CHANNELS\t0x0218\n#define TSCM_OFFSET_MULTIPLEX_MODE\t0x021c\n#define TSCM_OFFSET_ISOC_TX_ON\t\t0x0220\n \n#define TSCM_OFFSET_CLOCK_STATUS\t0x0228\n#define TSCM_OFFSET_SET_OPTION\t\t0x022c\n\n#define TSCM_OFFSET_MIDI_TX_ON\t\t0x0300\n#define TSCM_OFFSET_MIDI_TX_ADDR_HI\t0x0304\n#define TSCM_OFFSET_MIDI_TX_ADDR_LO\t0x0308\n\n#define TSCM_OFFSET_LED_POWER\t\t0x0404\n\n#define TSCM_OFFSET_MIDI_RX_QUAD\t0x4000\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nenum snd_tscm_clock {\n\tSND_TSCM_CLOCK_INTERNAL = 0,\n\tSND_TSCM_CLOCK_WORD\t= 1,\n\tSND_TSCM_CLOCK_SPDIF\t= 2,\n\tSND_TSCM_CLOCK_ADAT\t= 3,\n};\n\nint amdtp_tscm_init(struct amdtp_stream *s, struct fw_unit *unit,\n\t\t  enum amdtp_stream_direction dir, unsigned int pcm_channels);\nint amdtp_tscm_set_parameters(struct amdtp_stream *s, unsigned int rate);\nint amdtp_tscm_add_pcm_hw_constraints(struct amdtp_stream *s,\n\t\t\t\t      struct snd_pcm_runtime *runtime);\n\nint snd_tscm_stream_get_rate(struct snd_tscm *tscm, unsigned int *rate);\nint snd_tscm_stream_get_clock(struct snd_tscm *tscm,\n\t\t\t      enum snd_tscm_clock *clock);\nint snd_tscm_stream_init_duplex(struct snd_tscm *tscm);\nvoid snd_tscm_stream_update_duplex(struct snd_tscm *tscm);\nvoid snd_tscm_stream_destroy_duplex(struct snd_tscm *tscm);\nint snd_tscm_stream_reserve_duplex(struct snd_tscm *tscm, unsigned int rate,\n\t\t\t\t   unsigned int frames_per_period,\n\t\t\t\t   unsigned int frames_per_buffer);\nint snd_tscm_stream_start_duplex(struct snd_tscm *tscm, unsigned int rate);\nvoid snd_tscm_stream_stop_duplex(struct snd_tscm *tscm);\n\nvoid snd_tscm_stream_lock_changed(struct snd_tscm *tscm);\nint snd_tscm_stream_lock_try(struct snd_tscm *tscm);\nvoid snd_tscm_stream_lock_release(struct snd_tscm *tscm);\n\nvoid snd_fw_async_midi_port_init(struct snd_fw_async_midi_port *port);\n\nstatic inline void\nsnd_fw_async_midi_port_run(struct snd_fw_async_midi_port *port,\n\t\t\t   struct snd_rawmidi_substream *substream)\n{\n\tif (!port->error) {\n\t\tport->substream = substream;\n\t\tschedule_work(&port->work);\n\t}\n}\n\nstatic inline void\nsnd_fw_async_midi_port_finish(struct snd_fw_async_midi_port *port)\n{\n\tport->substream = NULL;\n\tcancel_work_sync(&port->work);\n\tport->error = false;\n}\n\nint snd_tscm_transaction_register(struct snd_tscm *tscm);\nint snd_tscm_transaction_reregister(struct snd_tscm *tscm);\nvoid snd_tscm_transaction_unregister(struct snd_tscm *tscm);\n\nvoid snd_tscm_proc_init(struct snd_tscm *tscm);\n\nint snd_tscm_create_pcm_devices(struct snd_tscm *tscm);\n\nint snd_tscm_create_midi_devices(struct snd_tscm *tscm);\n\nint snd_tscm_create_hwdep_device(struct snd_tscm *tscm);\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}