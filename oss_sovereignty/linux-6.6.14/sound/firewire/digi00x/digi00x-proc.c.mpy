{
  "module_name": "digi00x-proc.c",
  "hash_id": "e2882abd474bdbe8ddfad01f7538c041a794716840893b02382bd7102a304c38",
  "original_prompt": "Ingested from linux-6.6.14/sound/firewire/digi00x/digi00x-proc.c",
  "human_readable_source": "\n \n\n#include \"digi00x.h\"\n\nstatic int get_optical_iface_mode(struct snd_dg00x *dg00x,\n\t\t\t\t  enum snd_dg00x_optical_mode *mode)\n{\n\t__be32 data;\n\tint err;\n\n\terr = snd_fw_transaction(dg00x->unit, TCODE_READ_QUADLET_REQUEST,\n\t\t\t\t DG00X_ADDR_BASE + DG00X_OFFSET_OPT_IFACE_MODE,\n\t\t\t\t &data, sizeof(data), 0);\n\tif (err >= 0)\n\t\t*mode = be32_to_cpu(data) & 0x01;\n\n\treturn err;\n}\n\nstatic void proc_read_clock(struct snd_info_entry *entry,\n\t\t\t    struct snd_info_buffer *buf)\n{\n\tstatic const char *const source_name[] = {\n\t\t[SND_DG00X_CLOCK_INTERNAL] = \"internal\",\n\t\t[SND_DG00X_CLOCK_SPDIF] = \"s/pdif\",\n\t\t[SND_DG00X_CLOCK_ADAT] = \"adat\",\n\t\t[SND_DG00X_CLOCK_WORD] = \"word clock\",\n\t};\n\tstatic const char *const optical_name[] = {\n\t\t[SND_DG00X_OPT_IFACE_MODE_ADAT] = \"adat\",\n\t\t[SND_DG00X_OPT_IFACE_MODE_SPDIF] = \"s/pdif\",\n\t};\n\tstruct snd_dg00x *dg00x = entry->private_data;\n\tenum snd_dg00x_optical_mode mode;\n\tunsigned int rate;\n\tenum snd_dg00x_clock clock;\n\tbool detect;\n\n\tif (get_optical_iface_mode(dg00x, &mode) < 0)\n\t\treturn;\n\tif (snd_dg00x_stream_get_local_rate(dg00x, &rate) < 0)\n\t\treturn;\n\tif (snd_dg00x_stream_get_clock(dg00x, &clock) < 0)\n\t\treturn;\n\n\tsnd_iprintf(buf, \"Optical mode: %s\\n\", optical_name[mode]);\n\tsnd_iprintf(buf, \"Sampling Rate: %d\\n\", rate);\n\tsnd_iprintf(buf, \"Clock Source: %s\\n\", source_name[clock]);\n\n\tif (clock == SND_DG00X_CLOCK_INTERNAL)\n\t\treturn;\n\n\tif (snd_dg00x_stream_check_external_clock(dg00x, &detect) < 0)\n\t\treturn;\n\tsnd_iprintf(buf, \"External source: %s\\n\", detect ? \"detected\" : \"not\");\n\tif (!detect)\n\t\treturn;\n\n\tif (snd_dg00x_stream_get_external_rate(dg00x, &rate) >= 0)\n\t\tsnd_iprintf(buf, \"External sampling rate: %d\\n\", rate);\n}\n\nvoid snd_dg00x_proc_init(struct snd_dg00x *dg00x)\n{\n\tstruct snd_info_entry *root, *entry;\n\n\t \n\troot = snd_info_create_card_entry(dg00x->card, \"firewire\",\n\t\t\t\t\t  dg00x->card->proc_root);\n\tif (root == NULL)\n\t\treturn;\n\n\troot->mode = S_IFDIR | 0555;\n\n\tentry = snd_info_create_card_entry(dg00x->card, \"clock\", root);\n\tif (entry)\n\t\tsnd_info_set_text_ops(entry, dg00x, proc_read_clock);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}