{
  "module_name": "bebob.h",
  "hash_id": "7f6f5790310d57989d123e142c4597cc90e4022c6d7461dd2b5f9c93ef6c6cdc",
  "original_prompt": "Ingested from linux-6.6.14/sound/firewire/bebob/bebob.h",
  "human_readable_source": " \n \n\n#ifndef SOUND_BEBOB_H_INCLUDED\n#define SOUND_BEBOB_H_INCLUDED\n\n#include <linux/compat.h>\n#include <linux/device.h>\n#include <linux/firewire.h>\n#include <linux/firewire-constants.h>\n#include <linux/module.h>\n#include <linux/mod_devicetable.h>\n#include <linux/delay.h>\n#include <linux/slab.h>\n#include <linux/sched/signal.h>\n\n#include <sound/core.h>\n#include <sound/initval.h>\n#include <sound/info.h>\n#include <sound/rawmidi.h>\n#include <sound/pcm.h>\n#include <sound/pcm_params.h>\n#include <sound/firewire.h>\n#include <sound/hwdep.h>\n\n#include \"../lib.h\"\n#include \"../fcp.h\"\n#include \"../packets-buffer.h\"\n#include \"../iso-resources.h\"\n#include \"../amdtp-am824.h\"\n#include \"../cmp.h\"\n\n \n#define BEBOB_ADDR_REG_INFO\t0xffffc8020000ULL\n#define BEBOB_ADDR_REG_REQ\t0xffffc8021000ULL\n\nstruct snd_bebob;\n\n#define SND_BEBOB_STRM_FMT_ENTRIES\t7\nstruct snd_bebob_stream_formation {\n\tunsigned int pcm;\n\tunsigned int midi;\n};\n \nextern const unsigned int snd_bebob_rate_table[SND_BEBOB_STRM_FMT_ENTRIES];\n\n \nenum snd_bebob_clock_type {\n\tSND_BEBOB_CLOCK_TYPE_INTERNAL = 0,\n\tSND_BEBOB_CLOCK_TYPE_EXTERNAL,\n\tSND_BEBOB_CLOCK_TYPE_SYT,\n};\nstruct snd_bebob_clock_spec {\n\tunsigned int num;\n\tconst char *const *labels;\n\tconst enum snd_bebob_clock_type *types;\n\tint (*get)(struct snd_bebob *bebob, unsigned int *id);\n};\nstruct snd_bebob_rate_spec {\n\tint (*get)(struct snd_bebob *bebob, unsigned int *rate);\n\tint (*set)(struct snd_bebob *bebob, unsigned int rate);\n};\nstruct snd_bebob_meter_spec {\n\tunsigned int num;\n\tconst char *const *labels;\n\tint (*get)(struct snd_bebob *bebob, u32 *target, unsigned int size);\n};\nstruct snd_bebob_spec {\n\tconst struct snd_bebob_clock_spec *clock;\n\tconst struct snd_bebob_rate_spec *rate;\n\tconst struct snd_bebob_meter_spec *meter;\n};\n\nenum snd_bebob_quirk {\n\tSND_BEBOB_QUIRK_INITIAL_DISCONTINUOUS_DBC = (1 << 0),\n\tSND_BEBOB_QUIRK_WRONG_DBC\t\t  = (1 << 1),\n};\n\nstruct snd_bebob {\n\tstruct snd_card *card;\n\tstruct fw_unit *unit;\n\tint card_index;\n\n\tstruct mutex mutex;\n\tspinlock_t lock;\n\n\tconst struct snd_bebob_spec *spec;\n\tunsigned int quirks;\t\n\n\tunsigned int midi_input_ports;\n\tunsigned int midi_output_ports;\n\n\tstruct amdtp_stream tx_stream;\n\tstruct amdtp_stream rx_stream;\n\tstruct cmp_connection out_conn;\n\tstruct cmp_connection in_conn;\n\tunsigned int substreams_counter;\n\n\tstruct snd_bebob_stream_formation\n\t\ttx_stream_formations[SND_BEBOB_STRM_FMT_ENTRIES];\n\tstruct snd_bebob_stream_formation\n\t\trx_stream_formations[SND_BEBOB_STRM_FMT_ENTRIES];\n\n\tint sync_input_plug;\n\n\t \n\tint dev_lock_count;\n\tbool dev_lock_changed;\n\twait_queue_head_t hwdep_wait;\n\n\t \n\tvoid *maudio_special_quirk;\n\n\tstruct amdtp_domain domain;\n};\n\nstatic inline int\nsnd_bebob_read_block(struct fw_unit *unit, u64 addr, void *buf, int size)\n{\n\treturn snd_fw_transaction(unit, TCODE_READ_BLOCK_REQUEST,\n\t\t\t\t  BEBOB_ADDR_REG_INFO + addr,\n\t\t\t\t  buf, size, 0);\n}\n\nstatic inline int\nsnd_bebob_read_quad(struct fw_unit *unit, u64 addr, u32 *buf)\n{\n\treturn snd_fw_transaction(unit, TCODE_READ_QUADLET_REQUEST,\n\t\t\t\t  BEBOB_ADDR_REG_INFO + addr,\n\t\t\t\t  (void *)buf, sizeof(u32), 0);\n}\n\n \nint avc_audio_set_selector(struct fw_unit *unit, unsigned int subunit_id,\n\t\t\t   unsigned int fb_id, unsigned int num);\nint avc_audio_get_selector(struct fw_unit *unit, unsigned  int subunit_id,\n\t\t\t   unsigned int fb_id, unsigned int *num);\n\n \n#define\tAVC_BRIDGECO_ADDR_BYTES\t6\nenum avc_bridgeco_plug_dir {\n\tAVC_BRIDGECO_PLUG_DIR_IN\t= 0x00,\n\tAVC_BRIDGECO_PLUG_DIR_OUT\t= 0x01\n};\nenum avc_bridgeco_plug_mode {\n\tAVC_BRIDGECO_PLUG_MODE_UNIT\t\t= 0x00,\n\tAVC_BRIDGECO_PLUG_MODE_SUBUNIT\t\t= 0x01,\n\tAVC_BRIDGECO_PLUG_MODE_FUNCTION_BLOCK\t= 0x02\n};\nenum avc_bridgeco_plug_unit {\n\tAVC_BRIDGECO_PLUG_UNIT_ISOC\t= 0x00,\n\tAVC_BRIDGECO_PLUG_UNIT_EXT\t= 0x01,\n\tAVC_BRIDGECO_PLUG_UNIT_ASYNC\t= 0x02\n};\nenum avc_bridgeco_plug_type {\n\tAVC_BRIDGECO_PLUG_TYPE_ISOC\t= 0x00,\n\tAVC_BRIDGECO_PLUG_TYPE_ASYNC\t= 0x01,\n\tAVC_BRIDGECO_PLUG_TYPE_MIDI\t= 0x02,\n\tAVC_BRIDGECO_PLUG_TYPE_SYNC\t= 0x03,\n\tAVC_BRIDGECO_PLUG_TYPE_ANA\t= 0x04,\n\tAVC_BRIDGECO_PLUG_TYPE_DIG\t= 0x05,\n\tAVC_BRIDGECO_PLUG_TYPE_ADDITION\t= 0x06\n};\nstatic inline void\navc_bridgeco_fill_unit_addr(u8 buf[AVC_BRIDGECO_ADDR_BYTES],\n\t\t\t    enum avc_bridgeco_plug_dir dir,\n\t\t\t    enum avc_bridgeco_plug_unit unit,\n\t\t\t    unsigned int pid)\n{\n\tbuf[0] = 0xff;\t \n\tbuf[1] = dir;\n\tbuf[2] = AVC_BRIDGECO_PLUG_MODE_UNIT;\n\tbuf[3] = unit;\n\tbuf[4] = 0xff & pid;\n\tbuf[5] = 0xff;\t \n}\nstatic inline void\navc_bridgeco_fill_msu_addr(u8 buf[AVC_BRIDGECO_ADDR_BYTES],\n\t\t\t   enum avc_bridgeco_plug_dir dir,\n\t\t\t   unsigned int pid)\n{\n\tbuf[0] = 0x60;\t \n\tbuf[1] = dir;\n\tbuf[2] = AVC_BRIDGECO_PLUG_MODE_SUBUNIT;\n\tbuf[3] = 0xff & pid;\n\tbuf[4] = 0xff;\t \n\tbuf[5] = 0xff;\t \n}\nint avc_bridgeco_get_plug_ch_pos(struct fw_unit *unit,\n\t\t\t\t u8 addr[AVC_BRIDGECO_ADDR_BYTES],\n\t\t\t\t u8 *buf, unsigned int len);\nint avc_bridgeco_get_plug_type(struct fw_unit *unit,\n\t\t\t       u8 addr[AVC_BRIDGECO_ADDR_BYTES],\n\t\t\t       enum avc_bridgeco_plug_type *type);\nint avc_bridgeco_get_plug_ch_count(struct fw_unit *unit, u8 addr[AVC_BRIDGECO_ADDR_BYTES],\n\t\t\t\t   unsigned int *ch_count);\nint avc_bridgeco_get_plug_section_type(struct fw_unit *unit,\n\t\t\t\t       u8 addr[AVC_BRIDGECO_ADDR_BYTES],\n\t\t\t\t       unsigned int id, u8 *type);\nint avc_bridgeco_get_plug_input(struct fw_unit *unit,\n\t\t\t\tu8 addr[AVC_BRIDGECO_ADDR_BYTES],\n\t\t\t\tu8 input[7]);\nint avc_bridgeco_get_plug_strm_fmt(struct fw_unit *unit,\n\t\t\t\t   u8 addr[AVC_BRIDGECO_ADDR_BYTES], u8 *buf,\n\t\t\t\t   unsigned int *len, unsigned int eid);\n\n \nint snd_bebob_stream_get_rate(struct snd_bebob *bebob, unsigned int *rate);\nint snd_bebob_stream_set_rate(struct snd_bebob *bebob, unsigned int rate);\nint snd_bebob_stream_get_clock_src(struct snd_bebob *bebob,\n\t\t\t\t   enum snd_bebob_clock_type *src);\nint snd_bebob_stream_discover(struct snd_bebob *bebob);\nint snd_bebob_stream_init_duplex(struct snd_bebob *bebob);\nint snd_bebob_stream_reserve_duplex(struct snd_bebob *bebob, unsigned int rate,\n\t\t\t\t    unsigned int frames_per_period,\n\t\t\t\t    unsigned int frames_per_buffer);\nint snd_bebob_stream_start_duplex(struct snd_bebob *bebob);\nvoid snd_bebob_stream_stop_duplex(struct snd_bebob *bebob);\nvoid snd_bebob_stream_destroy_duplex(struct snd_bebob *bebob);\n\nvoid snd_bebob_stream_lock_changed(struct snd_bebob *bebob);\nint snd_bebob_stream_lock_try(struct snd_bebob *bebob);\nvoid snd_bebob_stream_lock_release(struct snd_bebob *bebob);\n\nvoid snd_bebob_proc_init(struct snd_bebob *bebob);\n\nint snd_bebob_create_midi_devices(struct snd_bebob *bebob);\n\nint snd_bebob_create_pcm_devices(struct snd_bebob *bebob);\n\nint snd_bebob_create_hwdep_device(struct snd_bebob *bebob);\n\n \nextern const struct snd_bebob_spec phase88_rack_spec;\nextern const struct snd_bebob_spec yamaha_terratec_spec;\nextern const struct snd_bebob_spec saffirepro_26_spec;\nextern const struct snd_bebob_spec saffirepro_10_spec;\nextern const struct snd_bebob_spec saffire_le_spec;\nextern const struct snd_bebob_spec saffire_spec;\nextern const struct snd_bebob_spec maudio_fw410_spec;\nextern const struct snd_bebob_spec maudio_audiophile_spec;\nextern const struct snd_bebob_spec maudio_solo_spec;\nextern const struct snd_bebob_spec maudio_ozonic_spec;\nextern const struct snd_bebob_spec maudio_nrv10_spec;\nextern const struct snd_bebob_spec maudio_special_spec;\nint snd_bebob_maudio_special_discover(struct snd_bebob *bebob, bool is1814);\nint snd_bebob_maudio_load_firmware(struct fw_unit *unit);\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}