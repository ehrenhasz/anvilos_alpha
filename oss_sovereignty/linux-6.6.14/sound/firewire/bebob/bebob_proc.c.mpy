{
  "module_name": "bebob_proc.c",
  "hash_id": "80af6026c3cc66b0f2a3c64409e0a0c344d4aceeda6b0115226a6f18836215c8",
  "original_prompt": "Ingested from linux-6.6.14/sound/firewire/bebob/bebob_proc.c",
  "human_readable_source": "\n \n\n#include \"./bebob.h\"\n\n \nstruct hw_info {\n\tu64 manufacturer;\n\tu32 protocol_ver;\n\tu32 bld_ver;\n\tu32 guid[2];\n\tu32 model_id;\n\tu32 model_rev;\n\tu64 fw_date;\n\tu64 fw_time;\n\tu32 fw_id;\n\tu32 fw_ver;\n\tu32 base_addr;\n\tu32 max_size;\n\tu64 bld_date;\n\tu64 bld_time;\n \n} __packed;\n\nstatic void\nproc_read_hw_info(struct snd_info_entry *entry,\n\t\t  struct snd_info_buffer *buffer)\n{\n\tstruct snd_bebob *bebob = entry->private_data;\n\tstruct hw_info *info;\n\n\tinfo = kzalloc(sizeof(struct hw_info), GFP_KERNEL);\n\tif (info == NULL)\n\t\treturn;\n\n\tif (snd_bebob_read_block(bebob->unit, 0,\n\t\t\t\t   info, sizeof(struct hw_info)) < 0)\n\t\tgoto end;\n\n\tsnd_iprintf(buffer, \"Manufacturer:\\t%.8s\\n\",\n\t\t    (char *)&info->manufacturer);\n\tsnd_iprintf(buffer, \"Protocol Ver:\\t%d\\n\", info->protocol_ver);\n\tsnd_iprintf(buffer, \"Build Ver:\\t%d\\n\", info->bld_ver);\n\tsnd_iprintf(buffer, \"GUID:\\t\\t0x%.8X%.8X\\n\",\n\t\t    info->guid[0], info->guid[1]);\n\tsnd_iprintf(buffer, \"Model ID:\\t0x%02X\\n\", info->model_id);\n\tsnd_iprintf(buffer, \"Model Rev:\\t%d\\n\", info->model_rev);\n\tsnd_iprintf(buffer, \"Firmware Date:\\t%.8s\\n\", (char *)&info->fw_date);\n\tsnd_iprintf(buffer, \"Firmware Time:\\t%.8s\\n\", (char *)&info->fw_time);\n\tsnd_iprintf(buffer, \"Firmware ID:\\t0x%X\\n\", info->fw_id);\n\tsnd_iprintf(buffer, \"Firmware Ver:\\t%d\\n\", info->fw_ver);\n\tsnd_iprintf(buffer, \"Base Addr:\\t0x%X\\n\", info->base_addr);\n\tsnd_iprintf(buffer, \"Max Size:\\t%d\\n\", info->max_size);\n\tsnd_iprintf(buffer, \"Loader Date:\\t%.8s\\n\", (char *)&info->bld_date);\n\tsnd_iprintf(buffer, \"Loader Time:\\t%.8s\\n\", (char *)&info->bld_time);\n\nend:\n\tkfree(info);\n}\n\nstatic void\nproc_read_meters(struct snd_info_entry *entry,\n\t\t struct snd_info_buffer *buffer)\n{\n\tstruct snd_bebob *bebob = entry->private_data;\n\tconst struct snd_bebob_meter_spec *spec = bebob->spec->meter;\n\tu32 *buf;\n\tunsigned int i, c, channels, size;\n\n\tif (spec == NULL)\n\t\treturn;\n\n\tchannels = spec->num * 2;\n\tsize = channels * sizeof(u32);\n\tbuf = kmalloc(size, GFP_KERNEL);\n\tif (buf == NULL)\n\t\treturn;\n\n\tif (spec->get(bebob, buf, size) < 0)\n\t\tgoto end;\n\n\tfor (i = 0, c = 1; i < channels; i++) {\n\t\tsnd_iprintf(buffer, \"%s %d:\\t%d\\n\",\n\t\t\t    spec->labels[i / 2], c++, buf[i]);\n\t\tif ((i + 1 < channels - 1) &&\n\t\t    (strcmp(spec->labels[i / 2],\n\t\t\t    spec->labels[(i + 1) / 2]) != 0))\n\t\t\tc = 1;\n\t}\nend:\n\tkfree(buf);\n}\n\nstatic void\nproc_read_formation(struct snd_info_entry *entry,\n\t\tstruct snd_info_buffer *buffer)\n{\n\tstruct snd_bebob *bebob = entry->private_data;\n\tstruct snd_bebob_stream_formation *formation;\n\tunsigned int i;\n\n\tsnd_iprintf(buffer, \"Output Stream from device:\\n\");\n\tsnd_iprintf(buffer, \"\\tRate\\tPCM\\tMIDI\\n\");\n\tformation = bebob->tx_stream_formations;\n\tfor (i = 0; i < SND_BEBOB_STRM_FMT_ENTRIES; i++) {\n\t\tsnd_iprintf(buffer,\n\t\t\t    \"\\t%d\\t%d\\t%d\\n\", snd_bebob_rate_table[i],\n\t\t\t    formation[i].pcm, formation[i].midi);\n\t}\n\n\tsnd_iprintf(buffer, \"Input Stream to device:\\n\");\n\tsnd_iprintf(buffer, \"\\tRate\\tPCM\\tMIDI\\n\");\n\tformation = bebob->rx_stream_formations;\n\tfor (i = 0; i < SND_BEBOB_STRM_FMT_ENTRIES; i++) {\n\t\tsnd_iprintf(buffer,\n\t\t\t    \"\\t%d\\t%d\\t%d\\n\", snd_bebob_rate_table[i],\n\t\t\t    formation[i].pcm, formation[i].midi);\n\t}\n}\n\nstatic void\nproc_read_clock(struct snd_info_entry *entry,\n\t\tstruct snd_info_buffer *buffer)\n{\n\tstatic const char *const clk_labels[] = {\n\t\t\"Internal\",\n\t\t\"External\",\n\t\t\"SYT-Match\",\n\t};\n\tstruct snd_bebob *bebob = entry->private_data;\n\tconst struct snd_bebob_rate_spec *rate_spec = bebob->spec->rate;\n\tconst struct snd_bebob_clock_spec *clk_spec = bebob->spec->clock;\n\tenum snd_bebob_clock_type src;\n\tunsigned int rate;\n\n\tif (rate_spec->get(bebob, &rate) >= 0)\n\t\tsnd_iprintf(buffer, \"Sampling rate: %d\\n\", rate);\n\n\tif (snd_bebob_stream_get_clock_src(bebob, &src) >= 0) {\n\t\tif (clk_spec)\n\t\t\tsnd_iprintf(buffer, \"Clock Source: %s\\n\",\n\t\t\t\t    clk_labels[src]);\n\t\telse\n\t\t\tsnd_iprintf(buffer, \"Clock Source: %s (MSU-dest: %d)\\n\",\n\t\t\t\t    clk_labels[src], bebob->sync_input_plug);\n\t}\n}\n\nstatic void\nadd_node(struct snd_bebob *bebob, struct snd_info_entry *root, const char *name,\n\t void (*op)(struct snd_info_entry *e, struct snd_info_buffer *b))\n{\n\tstruct snd_info_entry *entry;\n\n\tentry = snd_info_create_card_entry(bebob->card, name, root);\n\tif (entry)\n\t\tsnd_info_set_text_ops(entry, bebob, op);\n}\n\nvoid snd_bebob_proc_init(struct snd_bebob *bebob)\n{\n\tstruct snd_info_entry *root;\n\n\t \n\troot = snd_info_create_card_entry(bebob->card, \"firewire\",\n\t\t\t\t\t  bebob->card->proc_root);\n\tif (root == NULL)\n\t\treturn;\n\troot->mode = S_IFDIR | 0555;\n\n\tadd_node(bebob, root, \"clock\", proc_read_clock);\n\tadd_node(bebob, root, \"firmware\", proc_read_hw_info);\n\tadd_node(bebob, root, \"formation\", proc_read_formation);\n\n\tif (bebob->spec->meter != NULL)\n\t\tadd_node(bebob, root, \"meter\", proc_read_meters);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}