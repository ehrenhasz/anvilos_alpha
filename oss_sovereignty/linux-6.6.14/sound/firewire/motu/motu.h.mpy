{
  "module_name": "motu.h",
  "hash_id": "7b4f1820d6d8170e91928b201458ba22293e05297f10ee3165f582ec4ed5e281",
  "original_prompt": "Ingested from linux-6.6.14/sound/firewire/motu/motu.h",
  "human_readable_source": " \n \n\n#ifndef SOUND_FIREWIRE_MOTU_H_INCLUDED\n#define SOUND_FIREWIRE_MOTU_H_INCLUDED\n\n#include <linux/device.h>\n#include <linux/firewire.h>\n#include <linux/firewire-constants.h>\n#include <linux/module.h>\n#include <linux/mod_devicetable.h>\n#include <linux/mutex.h>\n#include <linux/slab.h>\n#include <linux/compat.h>\n#include <linux/sched/signal.h>\n\n#include <sound/control.h>\n#include <sound/core.h>\n#include <sound/pcm.h>\n#include <sound/info.h>\n#include <sound/rawmidi.h>\n#include <sound/firewire.h>\n#include <sound/hwdep.h>\n\n#include \"../lib.h\"\n#include \"../amdtp-stream.h\"\n#include \"../iso-resources.h\"\n\nstruct snd_motu_packet_format {\n\tunsigned char midi_flag_offset;\n\tunsigned char midi_byte_offset;\n\tunsigned char pcm_byte_offset;\n\n\tunsigned char msg_chunks;\n\tunsigned char pcm_chunks[3];\n};\n\nstruct amdtp_motu_cache {\n\tunsigned int *event_offsets;\n\tunsigned int size;\n\tunsigned int tail;\n\tunsigned int tx_cycle_count;\n\tunsigned int head;\n\tunsigned int rx_cycle_count;\n};\n\nstruct snd_motu {\n\tstruct snd_card *card;\n\tstruct fw_unit *unit;\n\tstruct mutex mutex;\n\tspinlock_t lock;\n\n\t \n\tconst struct snd_motu_spec *spec;\n\n\t \n\tstruct snd_motu_packet_format tx_packet_formats;\n\tstruct snd_motu_packet_format rx_packet_formats;\n\tstruct amdtp_stream tx_stream;\n\tstruct amdtp_stream rx_stream;\n\tstruct fw_iso_resources tx_resources;\n\tstruct fw_iso_resources rx_resources;\n\tunsigned int substreams_counter;\n\n\t \n\tstruct fw_address_handler async_handler;\n\tu32 msg;\n\n\t \n\tint dev_lock_count;\n\tbool dev_lock_changed;\n\twait_queue_head_t hwdep_wait;\n\tstruct snd_hwdep *hwdep;\n\n\tstruct amdtp_domain domain;\n\n\tstruct amdtp_motu_cache cache;\n\n\tvoid *message_parser;\n};\n\nenum snd_motu_spec_flags {\n\tSND_MOTU_SPEC_RX_MIDI_2ND_Q\t= 0x0001,\n\tSND_MOTU_SPEC_RX_MIDI_3RD_Q\t= 0x0002,\n\tSND_MOTU_SPEC_TX_MIDI_2ND_Q\t= 0x0004,\n\tSND_MOTU_SPEC_TX_MIDI_3RD_Q\t= 0x0008,\n\tSND_MOTU_SPEC_REGISTER_DSP\t= 0x0010,\n\tSND_MOTU_SPEC_COMMAND_DSP\t= 0x0020,\n};\n\n#define SND_MOTU_CLOCK_RATE_COUNT\t6\nextern const unsigned int snd_motu_clock_rates[SND_MOTU_CLOCK_RATE_COUNT];\n\nenum snd_motu_clock_source {\n\tSND_MOTU_CLOCK_SOURCE_INTERNAL,\n\tSND_MOTU_CLOCK_SOURCE_ADAT_ON_DSUB,\n\tSND_MOTU_CLOCK_SOURCE_ADAT_ON_OPT,\n\tSND_MOTU_CLOCK_SOURCE_ADAT_ON_OPT_A,\n\tSND_MOTU_CLOCK_SOURCE_ADAT_ON_OPT_B,\n\tSND_MOTU_CLOCK_SOURCE_SPDIF_ON_OPT,\n\tSND_MOTU_CLOCK_SOURCE_SPDIF_ON_OPT_A,\n\tSND_MOTU_CLOCK_SOURCE_SPDIF_ON_OPT_B,\n\tSND_MOTU_CLOCK_SOURCE_SPDIF_ON_COAX,\n\tSND_MOTU_CLOCK_SOURCE_AESEBU_ON_XLR,\n\tSND_MOTU_CLOCK_SOURCE_WORD_ON_BNC,\n\tSND_MOTU_CLOCK_SOURCE_SPH,\n\tSND_MOTU_CLOCK_SOURCE_UNKNOWN,\n};\n\nenum snd_motu_protocol_version {\n\tSND_MOTU_PROTOCOL_V1,\n\tSND_MOTU_PROTOCOL_V2,\n\tSND_MOTU_PROTOCOL_V3,\n};\n\nstruct snd_motu_spec {\n\tconst char *const name;\n\tenum snd_motu_protocol_version protocol_version;\n\t\n\tunsigned int flags;\n\n\tunsigned char tx_fixed_pcm_chunks[3];\n\tunsigned char rx_fixed_pcm_chunks[3];\n};\n\nextern const struct snd_motu_spec snd_motu_spec_828;\nextern const struct snd_motu_spec snd_motu_spec_896;\n\nextern const struct snd_motu_spec snd_motu_spec_828mk2;\nextern const struct snd_motu_spec snd_motu_spec_896hd;\nextern const struct snd_motu_spec snd_motu_spec_traveler;\nextern const struct snd_motu_spec snd_motu_spec_ultralite;\nextern const struct snd_motu_spec snd_motu_spec_8pre;\n\nextern const struct snd_motu_spec snd_motu_spec_828mk3_fw;\nextern const struct snd_motu_spec snd_motu_spec_828mk3_hybrid;\nextern const struct snd_motu_spec snd_motu_spec_traveler_mk3;\nextern const struct snd_motu_spec snd_motu_spec_ultralite_mk3;\nextern const struct snd_motu_spec snd_motu_spec_audio_express;\nextern const struct snd_motu_spec snd_motu_spec_track16;\nextern const struct snd_motu_spec snd_motu_spec_4pre;\n\nint amdtp_motu_init(struct amdtp_stream *s, struct fw_unit *unit,\n\t\t    enum amdtp_stream_direction dir,\n\t\t    const struct snd_motu_spec *spec,\n\t\t    struct amdtp_motu_cache *cache);\nint amdtp_motu_set_parameters(struct amdtp_stream *s, unsigned int rate,\n\t\t\t      unsigned int midi_ports,\n\t\t\t      struct snd_motu_packet_format *formats);\nint amdtp_motu_add_pcm_hw_constraints(struct amdtp_stream *s,\n\t\t\t\t      struct snd_pcm_runtime *runtime);\nvoid amdtp_motu_midi_trigger(struct amdtp_stream *s, unsigned int port,\n\t\t\t     struct snd_rawmidi_substream *midi);\n\nint snd_motu_transaction_read(struct snd_motu *motu, u32 offset, __be32 *reg,\n\t\t\t      size_t size);\nint snd_motu_transaction_write(struct snd_motu *motu, u32 offset, __be32 *reg,\n\t\t\t       size_t size);\nint snd_motu_transaction_register(struct snd_motu *motu);\nint snd_motu_transaction_reregister(struct snd_motu *motu);\nvoid snd_motu_transaction_unregister(struct snd_motu *motu);\n\nint snd_motu_stream_init_duplex(struct snd_motu *motu);\nvoid snd_motu_stream_destroy_duplex(struct snd_motu *motu);\nint snd_motu_stream_cache_packet_formats(struct snd_motu *motu);\nint snd_motu_stream_reserve_duplex(struct snd_motu *motu, unsigned int rate,\n\t\t\t\t   unsigned int frames_per_period,\n\t\t\t\t   unsigned int frames_per_buffer);\nint snd_motu_stream_start_duplex(struct snd_motu *motu);\nvoid snd_motu_stream_stop_duplex(struct snd_motu *motu);\nint snd_motu_stream_lock_try(struct snd_motu *motu);\nvoid snd_motu_stream_lock_release(struct snd_motu *motu);\n\nvoid snd_motu_proc_init(struct snd_motu *motu);\n\nint snd_motu_create_pcm_devices(struct snd_motu *motu);\n\nint snd_motu_create_midi_devices(struct snd_motu *motu);\n\nint snd_motu_create_hwdep_device(struct snd_motu *motu);\n\nint snd_motu_protocol_v1_get_clock_rate(struct snd_motu *motu,\n\t\t\t\t\tunsigned int *rate);\nint snd_motu_protocol_v1_set_clock_rate(struct snd_motu *motu,\n\t\t\t\t\tunsigned int rate);\nint snd_motu_protocol_v1_get_clock_source(struct snd_motu *motu,\n\t\t\t\t\t  enum snd_motu_clock_source *src);\nint snd_motu_protocol_v1_switch_fetching_mode(struct snd_motu *motu,\n\t\t\t\t\t      bool enable);\nint snd_motu_protocol_v1_cache_packet_formats(struct snd_motu *motu);\n\nint snd_motu_protocol_v2_get_clock_rate(struct snd_motu *motu,\n\t\t\t\t\tunsigned int *rate);\nint snd_motu_protocol_v2_set_clock_rate(struct snd_motu *motu,\n\t\t\t\t\tunsigned int rate);\nint snd_motu_protocol_v2_get_clock_source(struct snd_motu *motu,\n\t\t\t\t\t  enum snd_motu_clock_source *src);\nint snd_motu_protocol_v2_switch_fetching_mode(struct snd_motu *motu,\n\t\t\t\t\t      bool enable);\nint snd_motu_protocol_v2_cache_packet_formats(struct snd_motu *motu);\n\nint snd_motu_protocol_v3_get_clock_rate(struct snd_motu *motu,\n\t\t\t\t\tunsigned int *rate);\nint snd_motu_protocol_v3_set_clock_rate(struct snd_motu *motu,\n\t\t\t\t\tunsigned int rate);\nint snd_motu_protocol_v3_get_clock_source(struct snd_motu *motu,\n\t\t\t\t\t  enum snd_motu_clock_source *src);\nint snd_motu_protocol_v3_switch_fetching_mode(struct snd_motu *motu,\n\t\t\t\t\t      bool enable);\nint snd_motu_protocol_v3_cache_packet_formats(struct snd_motu *motu);\n\nstatic inline int snd_motu_protocol_get_clock_rate(struct snd_motu *motu,\n\t\t\t\t\t\t   unsigned int *rate)\n{\n\tif (motu->spec->protocol_version == SND_MOTU_PROTOCOL_V2)\n\t\treturn snd_motu_protocol_v2_get_clock_rate(motu, rate);\n\telse if (motu->spec->protocol_version == SND_MOTU_PROTOCOL_V3)\n\t\treturn snd_motu_protocol_v3_get_clock_rate(motu, rate);\n\telse if (motu->spec->protocol_version == SND_MOTU_PROTOCOL_V1)\n\t\treturn snd_motu_protocol_v1_get_clock_rate(motu, rate);\n\telse\n\t\treturn -ENXIO;\n}\n\nstatic inline int snd_motu_protocol_set_clock_rate(struct snd_motu *motu,\n\t\t\t\t\t\t   unsigned int rate)\n{\n\tif (motu->spec->protocol_version == SND_MOTU_PROTOCOL_V2)\n\t\treturn snd_motu_protocol_v2_set_clock_rate(motu, rate);\n\telse if (motu->spec->protocol_version == SND_MOTU_PROTOCOL_V3)\n\t\treturn snd_motu_protocol_v3_set_clock_rate(motu, rate);\n\telse if (motu->spec->protocol_version == SND_MOTU_PROTOCOL_V1)\n\t\treturn snd_motu_protocol_v1_set_clock_rate(motu, rate);\n\telse\n\t\treturn -ENXIO;\n}\n\nstatic inline int snd_motu_protocol_get_clock_source(struct snd_motu *motu,\n\t\t\t\t\tenum snd_motu_clock_source *source)\n{\n\tif (motu->spec->protocol_version == SND_MOTU_PROTOCOL_V2)\n\t\treturn snd_motu_protocol_v2_get_clock_source(motu, source);\n\telse if (motu->spec->protocol_version == SND_MOTU_PROTOCOL_V3)\n\t\treturn snd_motu_protocol_v3_get_clock_source(motu, source);\n\telse if (motu->spec->protocol_version == SND_MOTU_PROTOCOL_V1)\n\t\treturn snd_motu_protocol_v1_get_clock_source(motu, source);\n\telse\n\t\treturn -ENXIO;\n}\n\nstatic inline int snd_motu_protocol_switch_fetching_mode(struct snd_motu *motu,\n\t\t\t\t\t\t\t bool enable)\n{\n\tif (motu->spec->protocol_version == SND_MOTU_PROTOCOL_V2)\n\t\treturn snd_motu_protocol_v2_switch_fetching_mode(motu, enable);\n\telse if (motu->spec->protocol_version == SND_MOTU_PROTOCOL_V3)\n\t\treturn snd_motu_protocol_v3_switch_fetching_mode(motu, enable);\n\telse if (motu->spec->protocol_version == SND_MOTU_PROTOCOL_V1)\n\t\treturn snd_motu_protocol_v1_switch_fetching_mode(motu, enable);\n\telse\n\t\treturn -ENXIO;\n}\n\nstatic inline int snd_motu_protocol_cache_packet_formats(struct snd_motu *motu)\n{\n\tif (motu->spec->protocol_version == SND_MOTU_PROTOCOL_V2)\n\t\treturn snd_motu_protocol_v2_cache_packet_formats(motu);\n\telse if (motu->spec->protocol_version == SND_MOTU_PROTOCOL_V3)\n\t\treturn snd_motu_protocol_v3_cache_packet_formats(motu);\n\telse if (motu->spec->protocol_version == SND_MOTU_PROTOCOL_V1)\n\t\treturn snd_motu_protocol_v1_cache_packet_formats(motu);\n\telse\n\t\treturn -ENXIO;\n}\n\nint snd_motu_register_dsp_message_parser_new(struct snd_motu *motu);\nint snd_motu_register_dsp_message_parser_init(struct snd_motu *motu);\nvoid snd_motu_register_dsp_message_parser_parse(const struct amdtp_stream *s,\n\t\t\t\t\tconst struct pkt_desc *descs, unsigned int count);\nvoid snd_motu_register_dsp_message_parser_copy_meter(struct snd_motu *motu,\n\t\t\t\t\tstruct snd_firewire_motu_register_dsp_meter *meter);\nvoid snd_motu_register_dsp_message_parser_copy_parameter(struct snd_motu *motu,\n\t\t\t\t\tstruct snd_firewire_motu_register_dsp_parameter *params);\nunsigned int snd_motu_register_dsp_message_parser_count_event(struct snd_motu *motu);\nbool snd_motu_register_dsp_message_parser_copy_event(struct snd_motu *motu, u32 *event);\n\nint snd_motu_command_dsp_message_parser_new(struct snd_motu *motu);\nint snd_motu_command_dsp_message_parser_init(struct snd_motu *motu, enum cip_sfc sfc);\nvoid snd_motu_command_dsp_message_parser_parse(const struct amdtp_stream *s,\n\t\t\t\t\tconst struct pkt_desc *descs, unsigned int count);\nvoid snd_motu_command_dsp_message_parser_copy_meter(struct snd_motu *motu,\n\t\t\t\t\tstruct snd_firewire_motu_command_dsp_meter *meter);\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}