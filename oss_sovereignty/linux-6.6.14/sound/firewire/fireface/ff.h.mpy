{
  "module_name": "ff.h",
  "hash_id": "19b6ab4022f8e887958cf1b839d27a44e6b57888e06a1a0f35614c363625b3ea",
  "original_prompt": "Ingested from linux-6.6.14/sound/firewire/fireface/ff.h",
  "human_readable_source": " \n \n\n#ifndef SOUND_FIREFACE_H_INCLUDED\n#define SOUND_FIREFACE_H_INCLUDED\n\n#include <linux/device.h>\n#include <linux/firewire.h>\n#include <linux/firewire-constants.h>\n#include <linux/module.h>\n#include <linux/mod_devicetable.h>\n#include <linux/mutex.h>\n#include <linux/slab.h>\n#include <linux/compat.h>\n#include <linux/sched/signal.h>\n\n#include <sound/core.h>\n#include <sound/info.h>\n#include <sound/rawmidi.h>\n#include <sound/pcm.h>\n#include <sound/pcm_params.h>\n#include <sound/hwdep.h>\n#include <sound/firewire.h>\n\n#include \"../lib.h\"\n#include \"../amdtp-stream.h\"\n#include \"../iso-resources.h\"\n\n#define SND_FF_MAXIMIM_MIDI_QUADS\t9\n#define SND_FF_IN_MIDI_PORTS\t\t2\n#define SND_FF_OUT_MIDI_PORTS\t\t2\n\nenum snd_ff_unit_version {\n\tSND_FF_UNIT_VERSION_FF800\t= 0x000001,\n\tSND_FF_UNIT_VERSION_FF400\t= 0x000002,\n\tSND_FF_UNIT_VERSION_UFX\t\t= 0x000003,\n\tSND_FF_UNIT_VERSION_UCX\t\t= 0x000004,\n\tSND_FF_UNIT_VERSION_802\t\t= 0x000005,\n};\n\nenum snd_ff_stream_mode {\n\tSND_FF_STREAM_MODE_LOW = 0,\n\tSND_FF_STREAM_MODE_MID,\n\tSND_FF_STREAM_MODE_HIGH,\n\tSND_FF_STREAM_MODE_COUNT,\n};\n\nstruct snd_ff_protocol;\nstruct snd_ff_spec {\n\tconst unsigned int pcm_capture_channels[SND_FF_STREAM_MODE_COUNT];\n\tconst unsigned int pcm_playback_channels[SND_FF_STREAM_MODE_COUNT];\n\n\tunsigned int midi_in_ports;\n\tunsigned int midi_out_ports;\n\n\tconst struct snd_ff_protocol *protocol;\n\tu64 midi_high_addr;\n\tu8 midi_addr_range;\n\tu64 midi_rx_addrs[SND_FF_OUT_MIDI_PORTS];\n};\n\nstruct snd_ff {\n\tstruct snd_card *card;\n\tstruct fw_unit *unit;\n\tstruct mutex mutex;\n\tspinlock_t lock;\n\n\tenum snd_ff_unit_version unit_version;\n\tconst struct snd_ff_spec *spec;\n\n\t \n\tstruct snd_rawmidi_substream *tx_midi_substreams[SND_FF_IN_MIDI_PORTS];\n\tstruct fw_address_handler async_handler;\n\n\t \n\tstruct snd_rawmidi_substream *rx_midi_substreams[SND_FF_OUT_MIDI_PORTS];\n\tbool on_sysex[SND_FF_OUT_MIDI_PORTS];\n\t__le32 msg_buf[SND_FF_OUT_MIDI_PORTS][SND_FF_MAXIMIM_MIDI_QUADS];\n\tstruct work_struct rx_midi_work[SND_FF_OUT_MIDI_PORTS];\n\tstruct fw_transaction transactions[SND_FF_OUT_MIDI_PORTS];\n\tktime_t next_ktime[SND_FF_OUT_MIDI_PORTS];\n\tbool rx_midi_error[SND_FF_OUT_MIDI_PORTS];\n\tunsigned int rx_bytes[SND_FF_OUT_MIDI_PORTS];\n\n\tunsigned int substreams_counter;\n\tstruct amdtp_stream tx_stream;\n\tstruct amdtp_stream rx_stream;\n\tstruct fw_iso_resources tx_resources;\n\tstruct fw_iso_resources rx_resources;\n\n\tint dev_lock_count;\n\tbool dev_lock_changed;\n\twait_queue_head_t hwdep_wait;\n\n\tstruct amdtp_domain domain;\n\n\tvoid *msg_parser;\n};\n\nenum snd_ff_clock_src {\n\tSND_FF_CLOCK_SRC_INTERNAL,\n\tSND_FF_CLOCK_SRC_SPDIF,\n\tSND_FF_CLOCK_SRC_ADAT1,\n\tSND_FF_CLOCK_SRC_ADAT2,\n\tSND_FF_CLOCK_SRC_WORD,\n\tSND_FF_CLOCK_SRC_LTC,\n\t \n};\n\nstruct snd_ff_protocol {\n\tsize_t msg_parser_size;\n\tbool (*has_msg)(struct snd_ff *ff);\n\tlong (*copy_msg_to_user)(struct snd_ff *ff, char __user *buf, long count);\n\tvoid (*handle_msg)(struct snd_ff *ff, unsigned int offset, const __le32 *buf,\n\t\t\t   size_t length, u32 tstamp);\n\tint (*fill_midi_msg)(struct snd_ff *ff,\n\t\t\t     struct snd_rawmidi_substream *substream,\n\t\t\t     unsigned int port);\n\tint (*get_clock)(struct snd_ff *ff, unsigned int *rate,\n\t\t\t enum snd_ff_clock_src *src);\n\tint (*switch_fetching_mode)(struct snd_ff *ff, bool enable);\n\tint (*allocate_resources)(struct snd_ff *ff, unsigned int rate);\n\tint (*begin_session)(struct snd_ff *ff, unsigned int rate);\n\tvoid (*finish_session)(struct snd_ff *ff);\n\tvoid (*dump_status)(struct snd_ff *ff, struct snd_info_buffer *buffer);\n};\n\nextern const struct snd_ff_protocol snd_ff_protocol_ff800;\nextern const struct snd_ff_protocol snd_ff_protocol_ff400;\nextern const struct snd_ff_protocol snd_ff_protocol_latter;\n\nint snd_ff_transaction_register(struct snd_ff *ff);\nint snd_ff_transaction_reregister(struct snd_ff *ff);\nvoid snd_ff_transaction_unregister(struct snd_ff *ff);\n\nint amdtp_ff_set_parameters(struct amdtp_stream *s, unsigned int rate,\n\t\t\t    unsigned int pcm_channels);\nint amdtp_ff_add_pcm_hw_constraints(struct amdtp_stream *s,\n\t\t\t\t    struct snd_pcm_runtime *runtime);\nint amdtp_ff_init(struct amdtp_stream *s, struct fw_unit *unit,\n\t\t  enum amdtp_stream_direction dir);\n\nint snd_ff_stream_get_multiplier_mode(enum cip_sfc sfc,\n\t\t\t\t      enum snd_ff_stream_mode *mode);\nint snd_ff_stream_init_duplex(struct snd_ff *ff);\nvoid snd_ff_stream_destroy_duplex(struct snd_ff *ff);\nint snd_ff_stream_reserve_duplex(struct snd_ff *ff, unsigned int rate,\n\t\t\t\t unsigned int frames_per_period,\n\t\t\t\t unsigned int frames_per_buffer);\nint snd_ff_stream_start_duplex(struct snd_ff *ff, unsigned int rate);\nvoid snd_ff_stream_stop_duplex(struct snd_ff *ff);\nvoid snd_ff_stream_update_duplex(struct snd_ff *ff);\n\nvoid snd_ff_stream_lock_changed(struct snd_ff *ff);\nint snd_ff_stream_lock_try(struct snd_ff *ff);\nvoid snd_ff_stream_lock_release(struct snd_ff *ff);\n\nvoid snd_ff_proc_init(struct snd_ff *ff);\nconst char *snd_ff_proc_get_clk_label(enum snd_ff_clock_src src);\n\nint snd_ff_create_midi_devices(struct snd_ff *ff);\n\nint snd_ff_create_pcm_devices(struct snd_ff *ff);\n\nint snd_ff_create_hwdep_devices(struct snd_ff *ff);\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}