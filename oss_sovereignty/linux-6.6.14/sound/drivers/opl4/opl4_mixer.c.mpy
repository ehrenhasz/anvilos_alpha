{
  "module_name": "opl4_mixer.c",
  "hash_id": "ee5c836abf9b059c111d4c6fcc741ded86e9b164d6f6b033389717a33c7e5780",
  "original_prompt": "Ingested from linux-6.6.14/sound/drivers/opl4/opl4_mixer.c",
  "human_readable_source": "\n \n\n#include \"opl4_local.h\"\n#include <sound/control.h>\n\nstatic int snd_opl4_ctl_info(struct snd_kcontrol *kcontrol, struct snd_ctl_elem_info *uinfo)\n{\n\tuinfo->type = SNDRV_CTL_ELEM_TYPE_INTEGER;\n\tuinfo->count = 2;\n\tuinfo->value.integer.min = 0;\n\tuinfo->value.integer.max = 7;\n\treturn 0;\n}\n\nstatic int snd_opl4_ctl_get(struct snd_kcontrol *kcontrol, struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_opl4 *opl4 = snd_kcontrol_chip(kcontrol);\n\tunsigned long flags;\n\tu8 reg = kcontrol->private_value;\n\tu8 value;\n\n\tspin_lock_irqsave(&opl4->reg_lock, flags);\n\tvalue = snd_opl4_read(opl4, reg);\n\tspin_unlock_irqrestore(&opl4->reg_lock, flags);\n\tucontrol->value.integer.value[0] = 7 - (value & 7);\n\tucontrol->value.integer.value[1] = 7 - ((value >> 3) & 7);\n\treturn 0;\n}\n\nstatic int snd_opl4_ctl_put(struct snd_kcontrol *kcontrol, struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_opl4 *opl4 = snd_kcontrol_chip(kcontrol);\n\tunsigned long flags;\n\tu8 reg = kcontrol->private_value;\n\tu8 value, old_value;\n\n\tvalue = (7 - (ucontrol->value.integer.value[0] & 7)) |\n\t\t((7 - (ucontrol->value.integer.value[1] & 7)) << 3);\n\tspin_lock_irqsave(&opl4->reg_lock, flags);\n\told_value = snd_opl4_read(opl4, reg);\n\tsnd_opl4_write(opl4, reg, value);\n\tspin_unlock_irqrestore(&opl4->reg_lock, flags);\n\treturn value != old_value;\n}\n\nstatic const struct snd_kcontrol_new snd_opl4_controls[] = {\n\t{\n\t\t.iface = SNDRV_CTL_ELEM_IFACE_MIXER,\n\t\t.name = \"FM Playback Volume\",\n\t\t.info = snd_opl4_ctl_info,\n\t\t.get = snd_opl4_ctl_get,\n\t\t.put = snd_opl4_ctl_put,\n\t\t.private_value = OPL4_REG_MIX_CONTROL_FM\n\t},\n\t{\n\t\t.iface = SNDRV_CTL_ELEM_IFACE_MIXER,\n\t\t.name = \"Wavetable Playback Volume\",\n\t\t.info = snd_opl4_ctl_info,\n\t\t.get = snd_opl4_ctl_get,\n\t\t.put = snd_opl4_ctl_put,\n\t\t.private_value = OPL4_REG_MIX_CONTROL_PCM\n\t}\n};\n\nint snd_opl4_create_mixer(struct snd_opl4 *opl4)\n{\n\tstruct snd_card *card = opl4->card;\n\tint i, err;\n\n\tstrcat(card->mixername, \",OPL4\");\n\n\tfor (i = 0; i < 2; ++i) {\n\t\terr = snd_ctl_add(card, snd_ctl_new1(&snd_opl4_controls[i], opl4));\n\t\tif (err < 0)\n\t\t\treturn err;\n\t}\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}