{
  "module_name": "opl3_drums.c",
  "hash_id": "c00b46927634879949d322a483d986cb1e62c02d3d8387bcf748a137f6056fca",
  "original_prompt": "Ingested from linux-6.6.14/sound/drivers/opl3/opl3_drums.c",
  "human_readable_source": "\n \n\n#include \"opl3_voice.h\"\n\nstatic const char snd_opl3_drum_table[47] =\n{\n\tOPL3_BASSDRUM_ON,  OPL3_BASSDRUM_ON,  OPL3_HIHAT_ON,\t \n\tOPL3_SNAREDRUM_ON, OPL3_HIHAT_ON,     OPL3_SNAREDRUM_ON,  \n\tOPL3_BASSDRUM_ON,  OPL3_HIHAT_ON,     OPL3_BASSDRUM_ON,\t \n\tOPL3_HIHAT_ON,     OPL3_TOMTOM_ON,    OPL3_HIHAT_ON,\t \n\tOPL3_TOMTOM_ON,    OPL3_TOMTOM_ON,    OPL3_CYMBAL_ON,\t \n\n\tOPL3_TOMTOM_ON,    OPL3_CYMBAL_ON,    OPL3_CYMBAL_ON,\t \n\tOPL3_CYMBAL_ON,    OPL3_CYMBAL_ON,    OPL3_CYMBAL_ON,\t \n\tOPL3_HIHAT_ON,     OPL3_CYMBAL_ON,    OPL3_TOMTOM_ON,\t \n\tOPL3_CYMBAL_ON,    OPL3_TOMTOM_ON,    OPL3_TOMTOM_ON,\t \n\tOPL3_HIHAT_ON,     OPL3_TOMTOM_ON,    OPL3_TOMTOM_ON,\t \n\n\tOPL3_TOMTOM_ON,    OPL3_TOMTOM_ON,    OPL3_TOMTOM_ON,\t \n\tOPL3_TOMTOM_ON,    OPL3_HIHAT_ON,     OPL3_HIHAT_ON,\t \n\tOPL3_HIHAT_ON,     OPL3_HIHAT_ON,     OPL3_TOMTOM_ON,\t \n\tOPL3_TOMTOM_ON,    OPL3_TOMTOM_ON,    OPL3_TOMTOM_ON,\t \n\tOPL3_TOMTOM_ON,    OPL3_TOMTOM_ON,    OPL3_TOMTOM_ON,\t \n\tOPL3_CYMBAL_ON,    OPL3_CYMBAL_ON\t\t\t \n};\n\nstruct snd_opl3_drum_voice {\n\tint voice;\n\tint op;\n\tunsigned char am_vib;\n\tunsigned char ksl_level;\n\tunsigned char attack_decay;\n\tunsigned char sustain_release;\n\tunsigned char feedback_connection;\n\tunsigned char wave_select;\n};\n\nstruct snd_opl3_drum_note {\n\tint voice;\n\tunsigned char fnum;\n\tunsigned char octave_f;\n\tunsigned char feedback_connection;\n};\n\nstatic const struct snd_opl3_drum_voice bass_op0 = {6, 0, 0x00, 0x32, 0xf8, 0x66, 0x30, 0x00};\nstatic const struct snd_opl3_drum_voice bass_op1 = {6, 1, 0x00, 0x03, 0xf6, 0x57, 0x30, 0x00};\nstatic const struct snd_opl3_drum_note bass_note = {6, 0x90, 0x09};\n\nstatic const struct snd_opl3_drum_voice hihat = {7, 0, 0x00, 0x03, 0xf0, 0x06, 0x20, 0x00};\n\nstatic const struct snd_opl3_drum_voice snare = {7, 1, 0x00, 0x03, 0xf0, 0x07, 0x20, 0x02};\nstatic const struct snd_opl3_drum_note snare_note = {7, 0xf4, 0x0d};\n\nstatic const struct snd_opl3_drum_voice tomtom = {8, 0, 0x02, 0x03, 0xf0, 0x06, 0x10, 0x00};\nstatic const struct snd_opl3_drum_note tomtom_note = {8, 0xf4, 0x09};\n\nstatic const struct snd_opl3_drum_voice cymbal = {8, 1, 0x04, 0x03, 0xf0, 0x06, 0x10, 0x00};\n\n \nstatic void snd_opl3_drum_voice_set(struct snd_opl3 *opl3,\n\t\t\t\t    const struct snd_opl3_drum_voice *data)\n{\n\tunsigned char op_offset = snd_opl3_regmap[data->voice][data->op];\n\tunsigned char voice_offset = data->voice;\n\tunsigned short opl3_reg;\n\t\n\t  \n\topl3_reg = OPL3_LEFT | (OPL3_REG_AM_VIB + op_offset);\n\topl3->command(opl3, opl3_reg, data->am_vib);\n\n\t  \n\topl3_reg = OPL3_LEFT | (OPL3_REG_KSL_LEVEL + op_offset);\n\topl3->command(opl3, opl3_reg, data->ksl_level);\n\n\t  \n\topl3_reg = OPL3_LEFT | (OPL3_REG_ATTACK_DECAY + op_offset);\n\topl3->command(opl3, opl3_reg, data->attack_decay);\n\n\t  \n\topl3_reg = OPL3_LEFT | (OPL3_REG_SUSTAIN_RELEASE + op_offset);\n\topl3->command(opl3, opl3_reg, data->sustain_release);\n\n\t  \n\topl3_reg = OPL3_LEFT | (OPL3_REG_FEEDBACK_CONNECTION + voice_offset);\n\topl3->command(opl3, opl3_reg, data->feedback_connection);\n\n\t \n\topl3_reg = OPL3_LEFT | (OPL3_REG_WAVE_SELECT + op_offset);\n\topl3->command(opl3, opl3_reg, data->wave_select);\n}\n\n \nstatic void snd_opl3_drum_note_set(struct snd_opl3 *opl3,\n\t\t\t\t   const struct snd_opl3_drum_note *data)\n{\n\tunsigned char voice_offset = data->voice;\n\tunsigned short opl3_reg;\n\n\t  \n\topl3_reg = OPL3_LEFT | (OPL3_REG_FNUM_LOW + voice_offset);\n\topl3->command(opl3, opl3_reg, data->fnum);\n\n\t  \n\topl3_reg = OPL3_LEFT | (OPL3_REG_KEYON_BLOCK + voice_offset);\n\topl3->command(opl3, opl3_reg, data->octave_f);\n}\n\n \nstatic void snd_opl3_drum_vol_set(struct snd_opl3 *opl3,\n\t\t\t\t  const struct snd_opl3_drum_voice *data,\n\t\t\t\t  int vel, struct snd_midi_channel *chan)\n{\n\tunsigned char op_offset = snd_opl3_regmap[data->voice][data->op];\n\tunsigned char voice_offset = data->voice;\n\tunsigned char reg_val;\n\tunsigned short opl3_reg;\n\n\t  \n\treg_val = data->ksl_level;\n\tsnd_opl3_calc_volume(&reg_val, vel, chan);\n\topl3_reg = OPL3_LEFT | (OPL3_REG_KSL_LEVEL + op_offset);\n\topl3->command(opl3, opl3_reg, reg_val);\n\n\t  \n\t \n\treg_val = data->feedback_connection | OPL3_STEREO_BITS;\n\tif (chan->gm_pan < 43)\n\t\treg_val &= ~OPL3_VOICE_TO_RIGHT;\n\tif (chan->gm_pan > 85)\n\t\treg_val &= ~OPL3_VOICE_TO_LEFT;\n\topl3_reg = OPL3_LEFT | (OPL3_REG_FEEDBACK_CONNECTION + voice_offset);\n\topl3->command(opl3, opl3_reg, reg_val);\n}\n\n \nvoid snd_opl3_load_drums(struct snd_opl3 *opl3)\n{\n\tsnd_opl3_drum_voice_set(opl3, &bass_op0);\n\tsnd_opl3_drum_voice_set(opl3, &bass_op1);\n\tsnd_opl3_drum_note_set(opl3, &bass_note);\n\n\tsnd_opl3_drum_voice_set(opl3, &hihat);\n\n\tsnd_opl3_drum_voice_set(opl3, &snare);\n\tsnd_opl3_drum_note_set(opl3, &snare_note);\n\n\tsnd_opl3_drum_voice_set(opl3, &tomtom);\n\tsnd_opl3_drum_note_set(opl3, &tomtom_note);\n\n\tsnd_opl3_drum_voice_set(opl3, &cymbal);\n}\n\n \nvoid snd_opl3_drum_switch(struct snd_opl3 *opl3, int note, int vel, int on_off,\n\t\t\t  struct snd_midi_channel *chan)\n{\n\tunsigned char drum_mask;\n\tconst struct snd_opl3_drum_voice *drum_voice;\n\n\tif (!(opl3->drum_reg & OPL3_PERCUSSION_ENABLE))\n\t\treturn;\n\n\tif ((note < 35) || (note > 81))\n\t\treturn;\n\tdrum_mask = snd_opl3_drum_table[note - 35];\n\n\tif (on_off) {\n\t\tswitch (drum_mask) {\n\t\tcase OPL3_BASSDRUM_ON:\n\t\t\tdrum_voice = &bass_op1;\n\t\t\tbreak;\n\t\tcase OPL3_HIHAT_ON:\n\t\t\tdrum_voice = &hihat;\n\t\t\tbreak;\n\t\tcase OPL3_SNAREDRUM_ON:\n\t\t\tdrum_voice = &snare;\n\t\t\tbreak;\n\t\tcase OPL3_TOMTOM_ON:\n\t\t\tdrum_voice = &tomtom;\n\t\t\tbreak;\n\t\tcase OPL3_CYMBAL_ON:\n\t\t\tdrum_voice = &cymbal;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tdrum_voice = &tomtom;\n\t\t}\n\n\t\tsnd_opl3_drum_vol_set(opl3, drum_voice, vel, chan);\n\t\topl3->drum_reg |= drum_mask;\n\t} else {\n\t\topl3->drum_reg &= ~drum_mask;\n\t}\n\topl3->command(opl3, OPL3_LEFT | OPL3_REG_PERCUSSION,\n\t\t\t opl3->drum_reg);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}