{
  "module_name": "pcsp.h",
  "hash_id": "434b004f9845f8cec20c09f4e8ecb7b82eb33cac5053de29d0dd93678a0881b0",
  "original_prompt": "Ingested from linux-6.6.14/sound/drivers/pcsp/pcsp.h",
  "human_readable_source": " \n \n\n#ifndef __PCSP_H__\n#define __PCSP_H__\n\n#include <linux/hrtimer.h>\n#include <linux/i8253.h>\n#include <linux/timex.h>\n\n#define PCSP_SOUND_VERSION 0x400\t \n#define PCSP_DEBUG 0\n\n \n#define DIV_18KHZ 64\n#define MAX_DIV DIV_18KHZ\n#define CALC_DIV(d) (MAX_DIV >> (d))\n#define CUR_DIV() CALC_DIV(chip->treble)\n#define PCSP_MAX_TREBLE 1\n\n \n#define PCSP_DEFAULT_TREBLE 0\n#define MIN_DIV (MAX_DIV >> PCSP_MAX_TREBLE)\n\n \n#define PCSP_MIN_LPJ 1000000\n#define PCSP_DEFAULT_SDIV (DIV_18KHZ >> 1)\n#define PCSP_DEFAULT_SRATE (PIT_TICK_RATE / PCSP_DEFAULT_SDIV)\n#define PCSP_INDEX_INC() (1 << (PCSP_MAX_TREBLE - chip->treble))\n#define PCSP_CALC_RATE(i) (PIT_TICK_RATE / CALC_DIV(i))\n#define PCSP_RATE() PCSP_CALC_RATE(chip->treble)\n#define PCSP_MIN_RATE__1 MAX_DIV/PIT_TICK_RATE\n#define PCSP_MAX_RATE__1 MIN_DIV/PIT_TICK_RATE\n#define PCSP_MAX_PERIOD_NS (1000000000ULL * PCSP_MIN_RATE__1)\n#define PCSP_MIN_PERIOD_NS (1000000000ULL * PCSP_MAX_RATE__1)\n#define PCSP_CALC_NS(div) ({ \\\n\tu64 __val = 1000000000ULL * (div); \\\n\tdo_div(__val, PIT_TICK_RATE); \\\n\t__val; \\\n})\n#define PCSP_PERIOD_NS() PCSP_CALC_NS(CUR_DIV())\n\n#define PCSP_MAX_PERIOD_SIZE\t(64*1024)\n#define PCSP_MAX_PERIODS\t512\n#define PCSP_BUFFER_SIZE\t(128*1024)\n\nstruct snd_pcsp {\n\tstruct snd_card *card;\n\tstruct snd_pcm *pcm;\n\tstruct input_dev *input_dev;\n\tstruct hrtimer timer;\n\tunsigned short port, irq, dma;\n\tspinlock_t substream_lock;\n\tstruct snd_pcm_substream *playback_substream;\n\tunsigned int fmt_size;\n\tunsigned int is_signed;\n\tsize_t playback_ptr;\n\tsize_t period_ptr;\n\tatomic_t timer_active;\n\tint thalf;\n\tu64 ns_rem;\n\tunsigned char val61;\n\tint enable;\n\tint max_treble;\n\tint treble;\n\tint pcspkr;\n};\n\nextern struct snd_pcsp pcsp_chip;\n\nextern enum hrtimer_restart pcsp_do_timer(struct hrtimer *handle);\nextern void pcsp_sync_stop(struct snd_pcsp *chip);\n\nextern int snd_pcsp_new_pcm(struct snd_pcsp *chip);\nextern int snd_pcsp_new_mixer(struct snd_pcsp *chip, int nopcm);\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}