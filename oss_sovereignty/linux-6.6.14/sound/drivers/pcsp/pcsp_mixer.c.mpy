{
  "module_name": "pcsp_mixer.c",
  "hash_id": "d5537ea61e497daa544b8c952ca0f9511b0153a06a4ff92ca86523f613d2e900",
  "original_prompt": "Ingested from linux-6.6.14/sound/drivers/pcsp/pcsp_mixer.c",
  "human_readable_source": "\n \n\n#include <sound/core.h>\n#include <sound/control.h>\n#include \"pcsp.h\"\n\n\nstatic int pcsp_enable_info(struct snd_kcontrol *kcontrol,\n\t\t\t    struct snd_ctl_elem_info *uinfo)\n{\n\tuinfo->type = SNDRV_CTL_ELEM_TYPE_BOOLEAN;\n\tuinfo->count = 1;\n\tuinfo->value.integer.min = 0;\n\tuinfo->value.integer.max = 1;\n\treturn 0;\n}\n\nstatic int pcsp_enable_get(struct snd_kcontrol *kcontrol,\n\t\t\t   struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_pcsp *chip = snd_kcontrol_chip(kcontrol);\n\tucontrol->value.integer.value[0] = chip->enable;\n\treturn 0;\n}\n\nstatic int pcsp_enable_put(struct snd_kcontrol *kcontrol,\n\t\t\t   struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_pcsp *chip = snd_kcontrol_chip(kcontrol);\n\tint changed = 0;\n\tint enab = ucontrol->value.integer.value[0];\n\tif (enab != chip->enable) {\n\t\tchip->enable = enab;\n\t\tchanged = 1;\n\t}\n\treturn changed;\n}\n\nstatic int pcsp_treble_info(struct snd_kcontrol *kcontrol,\n\t\t\t    struct snd_ctl_elem_info *uinfo)\n{\n\tstruct snd_pcsp *chip = snd_kcontrol_chip(kcontrol);\n\tuinfo->type = SNDRV_CTL_ELEM_TYPE_ENUMERATED;\n\tuinfo->count = 1;\n\tuinfo->value.enumerated.items = chip->max_treble + 1;\n\tif (uinfo->value.enumerated.item > chip->max_treble)\n\t\tuinfo->value.enumerated.item = chip->max_treble;\n\tsprintf(uinfo->value.enumerated.name, \"%lu\",\n\t\t(unsigned long)PCSP_CALC_RATE(uinfo->value.enumerated.item));\n\treturn 0;\n}\n\nstatic int pcsp_treble_get(struct snd_kcontrol *kcontrol,\n\t\t\t   struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_pcsp *chip = snd_kcontrol_chip(kcontrol);\n\tucontrol->value.enumerated.item[0] = chip->treble;\n\treturn 0;\n}\n\nstatic int pcsp_treble_put(struct snd_kcontrol *kcontrol,\n\t\t\t   struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_pcsp *chip = snd_kcontrol_chip(kcontrol);\n\tint changed = 0;\n\tint treble = ucontrol->value.enumerated.item[0];\n\tif (treble != chip->treble) {\n\t\tchip->treble = treble;\n#if PCSP_DEBUG\n\t\tprintk(KERN_INFO \"PCSP: rate set to %li\\n\", PCSP_RATE());\n#endif\n\t\tchanged = 1;\n\t}\n\treturn changed;\n}\n\nstatic int pcsp_pcspkr_info(struct snd_kcontrol *kcontrol,\n\t\t\t    struct snd_ctl_elem_info *uinfo)\n{\n\tuinfo->type = SNDRV_CTL_ELEM_TYPE_BOOLEAN;\n\tuinfo->count = 1;\n\tuinfo->value.integer.min = 0;\n\tuinfo->value.integer.max = 1;\n\treturn 0;\n}\n\nstatic int pcsp_pcspkr_get(struct snd_kcontrol *kcontrol,\n\t\t\t   struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_pcsp *chip = snd_kcontrol_chip(kcontrol);\n\tucontrol->value.integer.value[0] = chip->pcspkr;\n\treturn 0;\n}\n\nstatic int pcsp_pcspkr_put(struct snd_kcontrol *kcontrol,\n\t\t\t   struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_pcsp *chip = snd_kcontrol_chip(kcontrol);\n\tint changed = 0;\n\tint spkr = ucontrol->value.integer.value[0];\n\tif (spkr != chip->pcspkr) {\n\t\tchip->pcspkr = spkr;\n\t\tchanged = 1;\n\t}\n\treturn changed;\n}\n\n#define PCSP_MIXER_CONTROL(ctl_type, ctl_name) \\\n{ \\\n\t.iface =\tSNDRV_CTL_ELEM_IFACE_MIXER, \\\n\t.name =\t\tctl_name, \\\n\t.info =\t\tpcsp_##ctl_type##_info, \\\n\t.get =\t\tpcsp_##ctl_type##_get, \\\n\t.put =\t\tpcsp_##ctl_type##_put, \\\n}\n\nstatic const struct snd_kcontrol_new snd_pcsp_controls_pcm[] = {\n\tPCSP_MIXER_CONTROL(enable, \"Master Playback Switch\"),\n\tPCSP_MIXER_CONTROL(treble, \"BaseFRQ Playback Volume\"),\n};\n\nstatic const struct snd_kcontrol_new snd_pcsp_controls_spkr[] = {\n\tPCSP_MIXER_CONTROL(pcspkr, \"Beep Playback Switch\"),\n};\n\nstatic int snd_pcsp_ctls_add(struct snd_pcsp *chip,\n\t\t\t     const struct snd_kcontrol_new *ctls, int num)\n{\n\tint i, err;\n\tstruct snd_card *card = chip->card;\n\tfor (i = 0; i < num; i++) {\n\t\terr = snd_ctl_add(card, snd_ctl_new1(ctls + i, chip));\n\t\tif (err < 0)\n\t\t\treturn err;\n\t}\n\treturn 0;\n}\n\nint snd_pcsp_new_mixer(struct snd_pcsp *chip, int nopcm)\n{\n\tint err;\n\tstruct snd_card *card = chip->card;\n\n\tif (!nopcm) {\n\t\terr = snd_pcsp_ctls_add(chip, snd_pcsp_controls_pcm,\n\t\t\tARRAY_SIZE(snd_pcsp_controls_pcm));\n\t\tif (err < 0)\n\t\t\treturn err;\n\t}\n\terr = snd_pcsp_ctls_add(chip, snd_pcsp_controls_spkr,\n\t\tARRAY_SIZE(snd_pcsp_controls_spkr));\n\tif (err < 0)\n\t\treturn err;\n\n\tstrcpy(card->mixername, \"PC-Speaker\");\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}