{
  "module_name": "xonar_hdmi.c",
  "hash_id": "a6a0ca8ccad19502e8d2fa395cf29d25830f9b7307e75c18c72f6a0af5a079eb",
  "original_prompt": "Ingested from linux-6.6.14/sound/pci/oxygen/xonar_hdmi.c",
  "human_readable_source": "\n \n\n#include <linux/pci.h>\n#include <linux/delay.h>\n#include <sound/asoundef.h>\n#include <sound/control.h>\n#include <sound/core.h>\n#include <sound/pcm.h>\n#include <sound/pcm_params.h>\n#include <sound/tlv.h>\n#include \"xonar.h\"\n\nstatic void hdmi_write_command(struct oxygen *chip, u8 command,\n\t\t\t       unsigned int count, const u8 *params)\n{\n\tunsigned int i;\n\tu8 checksum;\n\n\toxygen_write_uart(chip, 0xfb);\n\toxygen_write_uart(chip, 0xef);\n\toxygen_write_uart(chip, command);\n\toxygen_write_uart(chip, count);\n\tfor (i = 0; i < count; ++i)\n\t\toxygen_write_uart(chip, params[i]);\n\tchecksum = 0xfb + 0xef + command + count;\n\tfor (i = 0; i < count; ++i)\n\t\tchecksum += params[i];\n\toxygen_write_uart(chip, checksum);\n}\n\nstatic void xonar_hdmi_init_commands(struct oxygen *chip,\n\t\t\t\t     struct xonar_hdmi *hdmi)\n{\n\tu8 param;\n\n\toxygen_reset_uart(chip);\n\tparam = 0;\n\thdmi_write_command(chip, 0x61, 1, &param);\n\tparam = 1;\n\thdmi_write_command(chip, 0x74, 1, &param);\n\thdmi_write_command(chip, 0x54, 5, hdmi->params);\n}\n\nvoid xonar_hdmi_init(struct oxygen *chip, struct xonar_hdmi *hdmi)\n{\n\thdmi->params[1] = IEC958_AES3_CON_FS_48000;\n\thdmi->params[4] = 1;\n\txonar_hdmi_init_commands(chip, hdmi);\n}\n\nvoid xonar_hdmi_cleanup(struct oxygen *chip)\n{\n\tu8 param = 0;\n\n\thdmi_write_command(chip, 0x74, 1, &param);\n}\n\nvoid xonar_hdmi_resume(struct oxygen *chip, struct xonar_hdmi *hdmi)\n{\n\txonar_hdmi_init_commands(chip, hdmi);\n}\n\nvoid xonar_hdmi_pcm_hardware_filter(unsigned int channel,\n\t\t\t\t    struct snd_pcm_hardware *hardware)\n{\n\tif (channel == PCM_MULTICH) {\n\t\thardware->rates = SNDRV_PCM_RATE_44100 |\n\t\t\t\t  SNDRV_PCM_RATE_48000 |\n\t\t\t\t  SNDRV_PCM_RATE_96000 |\n\t\t\t\t  SNDRV_PCM_RATE_192000;\n\t\thardware->rate_min = 44100;\n\t}\n}\n\nvoid xonar_set_hdmi_params(struct oxygen *chip, struct xonar_hdmi *hdmi,\n\t\t\t   struct snd_pcm_hw_params *params)\n{\n\thdmi->params[0] = 0;  \n\tswitch (params_rate(params)) {\n\tcase 44100:\n\t\thdmi->params[1] = IEC958_AES3_CON_FS_44100;\n\t\tbreak;\n\tcase 48000:\n\t\thdmi->params[1] = IEC958_AES3_CON_FS_48000;\n\t\tbreak;\n\tdefault:  \n\t\thdmi->params[1] = IEC958_AES3_CON_FS_96000;\n\t\tbreak;\n\tcase 192000:\n\t\thdmi->params[1] = IEC958_AES3_CON_FS_192000;\n\t\tbreak;\n\t}\n\thdmi->params[2] = params_channels(params) / 2 - 1;\n\tif (params_format(params) == SNDRV_PCM_FORMAT_S16_LE)\n\t\thdmi->params[3] = 0;\n\telse\n\t\thdmi->params[3] = 0xc0;\n\thdmi->params[4] = 1;  \n\thdmi_write_command(chip, 0x54, 5, hdmi->params);\n}\n\nvoid xonar_hdmi_uart_input(struct oxygen *chip)\n{\n\tif (chip->uart_input_count >= 2 &&\n\t    chip->uart_input[chip->uart_input_count - 2] == 'O' &&\n\t    chip->uart_input[chip->uart_input_count - 1] == 'K') {\n\t\tdev_dbg(chip->card->dev, \"message from HDMI chip received:\\n\");\n\t\tprint_hex_dump_bytes(\"\", DUMP_PREFIX_OFFSET,\n\t\t\t\t     chip->uart_input, chip->uart_input_count);\n\t\tchip->uart_input_count = 0;\n\t}\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}