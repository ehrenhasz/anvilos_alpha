{
  "module_name": "oxygen.h",
  "hash_id": "415d17c0ece42b4001cc7d22af32c2973b61e579a944b094225b38512be2bc35",
  "original_prompt": "Ingested from linux-6.6.14/sound/pci/oxygen/oxygen.h",
  "human_readable_source": " \n#ifndef OXYGEN_H_INCLUDED\n#define OXYGEN_H_INCLUDED\n\n#include <linux/mutex.h>\n#include <linux/spinlock.h>\n#include <linux/wait.h>\n#include <linux/workqueue.h>\n#include \"oxygen_regs.h\"\n\n \n#define PCM_A\t\t0\n#define PCM_B\t\t1\n#define PCM_C\t\t2\n#define PCM_SPDIF\t3\n#define PCM_MULTICH\t4\n#define PCM_AC97\t5\n#define PCM_COUNT\t6\n\n#define OXYGEN_MCLKS(f_single, f_double, f_quad) ((MCLK_##f_single << 0) | \\\n\t\t\t\t\t\t  (MCLK_##f_double << 2) | \\\n\t\t\t\t\t\t  (MCLK_##f_quad   << 4))\n\n#define OXYGEN_IO_SIZE\t0x100\n\n#define OXYGEN_EEPROM_ID\t0x434d\t \n\n \n#define PLAYBACK_0_TO_I2S\t0x0001\n      \n#define PLAYBACK_1_TO_SPDIF\t0x0004\n#define PLAYBACK_2_TO_AC97_1\t0x0008\n#define CAPTURE_0_FROM_I2S_1\t0x0010\n#define CAPTURE_0_FROM_I2S_2\t0x0020\n      \n#define CAPTURE_1_FROM_SPDIF\t0x0080\n#define CAPTURE_2_FROM_I2S_2\t0x0100\n#define CAPTURE_2_FROM_AC97_1\t0x0200\n#define CAPTURE_3_FROM_I2S_3\t0x0400\n#define MIDI_OUTPUT\t\t0x0800\n#define MIDI_INPUT\t\t0x1000\n#define AC97_CD_INPUT\t\t0x2000\n#define AC97_FMIC_SWITCH\t0x4000\n\nenum {\n\tCONTROL_SPDIF_PCM,\n\tCONTROL_SPDIF_INPUT_BITS,\n\tCONTROL_MIC_CAPTURE_SWITCH,\n\tCONTROL_LINE_CAPTURE_SWITCH,\n\tCONTROL_CD_CAPTURE_SWITCH,\n\tCONTROL_AUX_CAPTURE_SWITCH,\n\tCONTROL_COUNT\n};\n\n#define OXYGEN_PCI_SUBID(sv, sd) \\\n\t.vendor = PCI_VENDOR_ID_CMEDIA, \\\n\t.device = 0x8788, \\\n\t.subvendor = sv, \\\n\t.subdevice = sd\n\n#define BROKEN_EEPROM_DRIVER_DATA ((unsigned long)-1)\n#define OXYGEN_PCI_SUBID_BROKEN_EEPROM \\\n\tOXYGEN_PCI_SUBID(PCI_VENDOR_ID_CMEDIA, 0x8788), \\\n\t.driver_data = BROKEN_EEPROM_DRIVER_DATA\n\nstruct pci_dev;\nstruct pci_device_id;\nstruct snd_card;\nstruct snd_pcm_substream;\nstruct snd_pcm_hardware;\nstruct snd_pcm_hw_params;\nstruct snd_kcontrol_new;\nstruct snd_rawmidi;\nstruct snd_info_buffer;\nstruct oxygen;\n\nstruct oxygen_model {\n\tconst char *shortname;\n\tconst char *longname;\n\tconst char *chip;\n\tvoid (*init)(struct oxygen *chip);\n\tint (*control_filter)(struct snd_kcontrol_new *template);\n\tint (*mixer_init)(struct oxygen *chip);\n\tvoid (*cleanup)(struct oxygen *chip);\n\tvoid (*suspend)(struct oxygen *chip);\n\tvoid (*resume)(struct oxygen *chip);\n\tvoid (*pcm_hardware_filter)(unsigned int channel,\n\t\t\t\t    struct snd_pcm_hardware *hardware);\n\tvoid (*set_dac_params)(struct oxygen *chip,\n\t\t\t       struct snd_pcm_hw_params *params);\n\tvoid (*set_adc_params)(struct oxygen *chip,\n\t\t\t       struct snd_pcm_hw_params *params);\n\tvoid (*update_dac_volume)(struct oxygen *chip);\n\tvoid (*update_dac_mute)(struct oxygen *chip);\n\tvoid (*update_center_lfe_mix)(struct oxygen *chip, bool mixed);\n\tunsigned int (*adjust_dac_routing)(struct oxygen *chip,\n\t\t\t\t\t   unsigned int play_routing);\n\tvoid (*gpio_changed)(struct oxygen *chip);\n\tvoid (*uart_input)(struct oxygen *chip);\n\tvoid (*ac97_switch)(struct oxygen *chip,\n\t\t\t    unsigned int reg, unsigned int mute);\n\tvoid (*dump_registers)(struct oxygen *chip,\n\t\t\t       struct snd_info_buffer *buffer);\n\tconst unsigned int *dac_tlv;\n\tsize_t model_data_size;\n\tunsigned int device_config;\n\tu8 dac_channels_pcm;\n\tu8 dac_channels_mixer;\n\tu8 dac_volume_min;\n\tu8 dac_volume_max;\n\tu8 misc_flags;\n\tu8 function_flags;\n\tu8 dac_mclks;\n\tu8 adc_mclks;\n\tu16 dac_i2s_format;\n\tu16 adc_i2s_format;\n};\n\nstruct oxygen {\n\tunsigned long addr;\n\tspinlock_t reg_lock;\n\tstruct mutex mutex;\n\tstruct snd_card *card;\n\tstruct pci_dev *pci;\n\tstruct snd_rawmidi *midi;\n\tint irq;\n\tvoid *model_data;\n\tunsigned int interrupt_mask;\n\tu8 dac_volume[8];\n\tu8 dac_mute;\n\tu8 pcm_active;\n\tu8 pcm_running;\n\tu8 dac_routing;\n\tu8 spdif_playback_enable;\n\tu8 has_ac97_0;\n\tu8 has_ac97_1;\n\tu32 spdif_bits;\n\tu32 spdif_pcm_bits;\n\tstruct snd_pcm_substream *streams[PCM_COUNT];\n\tstruct snd_kcontrol *controls[CONTROL_COUNT];\n\tstruct work_struct spdif_input_bits_work;\n\tstruct work_struct gpio_work;\n\twait_queue_head_t ac97_waitqueue;\n\tunion {\n\t\tu8 _8[OXYGEN_IO_SIZE];\n\t\t__le16 _16[OXYGEN_IO_SIZE / 2];\n\t\t__le32 _32[OXYGEN_IO_SIZE / 4];\n\t} saved_registers;\n\tu16 saved_ac97_registers[2][0x40];\n\tunsigned int uart_input_count;\n\tu8 uart_input[32];\n\tstruct oxygen_model model;\n};\n\n \n\nint oxygen_pci_probe(struct pci_dev *pci, int index, char *id,\n\t\t     struct module *owner,\n\t\t     const struct pci_device_id *ids,\n\t\t     int (*get_model)(struct oxygen *chip,\n\t\t\t\t      const struct pci_device_id *id\n\t\t\t\t     )\n\t\t    );\n#ifdef CONFIG_PM_SLEEP\nextern const struct dev_pm_ops oxygen_pci_pm;\n#endif\nvoid oxygen_pci_shutdown(struct pci_dev *pci);\n\n \n\nint oxygen_mixer_init(struct oxygen *chip);\nvoid oxygen_update_dac_routing(struct oxygen *chip);\nvoid oxygen_update_spdif_source(struct oxygen *chip);\n\n \n\nint oxygen_pcm_init(struct oxygen *chip);\n\n \n\nu8 oxygen_read8(struct oxygen *chip, unsigned int reg);\nu16 oxygen_read16(struct oxygen *chip, unsigned int reg);\nu32 oxygen_read32(struct oxygen *chip, unsigned int reg);\nvoid oxygen_write8(struct oxygen *chip, unsigned int reg, u8 value);\nvoid oxygen_write16(struct oxygen *chip, unsigned int reg, u16 value);\nvoid oxygen_write32(struct oxygen *chip, unsigned int reg, u32 value);\nvoid oxygen_write8_masked(struct oxygen *chip, unsigned int reg,\n\t\t\t  u8 value, u8 mask);\nvoid oxygen_write16_masked(struct oxygen *chip, unsigned int reg,\n\t\t\t   u16 value, u16 mask);\nvoid oxygen_write32_masked(struct oxygen *chip, unsigned int reg,\n\t\t\t   u32 value, u32 mask);\n\nu16 oxygen_read_ac97(struct oxygen *chip, unsigned int codec,\n\t\t     unsigned int index);\nvoid oxygen_write_ac97(struct oxygen *chip, unsigned int codec,\n\t\t       unsigned int index, u16 data);\nvoid oxygen_write_ac97_masked(struct oxygen *chip, unsigned int codec,\n\t\t\t      unsigned int index, u16 data, u16 mask);\n\nint oxygen_write_spi(struct oxygen *chip, u8 control, unsigned int data);\nvoid oxygen_write_i2c(struct oxygen *chip, u8 device, u8 map, u8 data);\n\nvoid oxygen_reset_uart(struct oxygen *chip);\nvoid oxygen_write_uart(struct oxygen *chip, u8 data);\n\nu16 oxygen_read_eeprom(struct oxygen *chip, unsigned int index);\nvoid oxygen_write_eeprom(struct oxygen *chip, unsigned int index, u16 value);\n\nstatic inline void oxygen_set_bits8(struct oxygen *chip,\n\t\t\t\t    unsigned int reg, u8 value)\n{\n\toxygen_write8_masked(chip, reg, value, value);\n}\n\nstatic inline void oxygen_set_bits16(struct oxygen *chip,\n\t\t\t\t     unsigned int reg, u16 value)\n{\n\toxygen_write16_masked(chip, reg, value, value);\n}\n\nstatic inline void oxygen_set_bits32(struct oxygen *chip,\n\t\t\t\t     unsigned int reg, u32 value)\n{\n\toxygen_write32_masked(chip, reg, value, value);\n}\n\nstatic inline void oxygen_clear_bits8(struct oxygen *chip,\n\t\t\t\t      unsigned int reg, u8 value)\n{\n\toxygen_write8_masked(chip, reg, 0, value);\n}\n\nstatic inline void oxygen_clear_bits16(struct oxygen *chip,\n\t\t\t\t       unsigned int reg, u16 value)\n{\n\toxygen_write16_masked(chip, reg, 0, value);\n}\n\nstatic inline void oxygen_clear_bits32(struct oxygen *chip,\n\t\t\t\t       unsigned int reg, u32 value)\n{\n\toxygen_write32_masked(chip, reg, 0, value);\n}\n\nstatic inline void oxygen_ac97_set_bits(struct oxygen *chip, unsigned int codec,\n\t\t\t\t\tunsigned int index, u16 value)\n{\n\toxygen_write_ac97_masked(chip, codec, index, value, value);\n}\n\nstatic inline void oxygen_ac97_clear_bits(struct oxygen *chip,\n\t\t\t\t\t  unsigned int codec,\n\t\t\t\t\t  unsigned int index, u16 value)\n{\n\toxygen_write_ac97_masked(chip, codec, index, 0, value);\n}\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}