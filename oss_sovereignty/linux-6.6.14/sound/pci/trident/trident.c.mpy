{
  "module_name": "trident.c",
  "hash_id": "dbd87ea32944bb34fc606f6298444c65af13a5fbb2386e6b61cb8babe8643ee6",
  "original_prompt": "Ingested from linux-6.6.14/sound/pci/trident/trident.c",
  "human_readable_source": "\n \n\n#include <linux/init.h>\n#include <linux/pci.h>\n#include <linux/time.h>\n#include <linux/module.h>\n#include <sound/core.h>\n#include \"trident.h\"\n#include <sound/initval.h>\n\nMODULE_AUTHOR(\"Jaroslav Kysela <perex@perex.cz>, <audio@tridentmicro.com>\");\nMODULE_DESCRIPTION(\"Trident 4D-WaveDX/NX & SiS SI7018\");\nMODULE_LICENSE(\"GPL\");\n\nstatic int index[SNDRV_CARDS] = SNDRV_DEFAULT_IDX;\t \nstatic char *id[SNDRV_CARDS] = SNDRV_DEFAULT_STR;\t \nstatic bool enable[SNDRV_CARDS] = SNDRV_DEFAULT_ENABLE_PNP;\t \nstatic int pcm_channels[SNDRV_CARDS] = {[0 ... (SNDRV_CARDS - 1)] = 32};\nstatic int wavetable_size[SNDRV_CARDS] = {[0 ... (SNDRV_CARDS - 1)] = 8192};\n\nmodule_param_array(index, int, NULL, 0444);\nMODULE_PARM_DESC(index, \"Index value for Trident 4DWave PCI soundcard.\");\nmodule_param_array(id, charp, NULL, 0444);\nMODULE_PARM_DESC(id, \"ID string for Trident 4DWave PCI soundcard.\");\nmodule_param_array(enable, bool, NULL, 0444);\nMODULE_PARM_DESC(enable, \"Enable Trident 4DWave PCI soundcard.\");\nmodule_param_array(pcm_channels, int, NULL, 0444);\nMODULE_PARM_DESC(pcm_channels, \"Number of hardware channels assigned for PCM.\");\nmodule_param_array(wavetable_size, int, NULL, 0444);\nMODULE_PARM_DESC(wavetable_size, \"Maximum memory size in kB for wavetable synth.\");\n\nstatic const struct pci_device_id snd_trident_ids[] = {\n\t{PCI_DEVICE(PCI_VENDOR_ID_TRIDENT, PCI_DEVICE_ID_TRIDENT_4DWAVE_DX), \n\t\tPCI_CLASS_MULTIMEDIA_AUDIO << 8, 0xffff00, 0},\n\t{PCI_DEVICE(PCI_VENDOR_ID_TRIDENT, PCI_DEVICE_ID_TRIDENT_4DWAVE_NX), \n\t\t0, 0, 0},\n\t{PCI_DEVICE(PCI_VENDOR_ID_SI, PCI_DEVICE_ID_SI_7018), 0, 0, 0},\n\t{ 0, }\n};\n\nMODULE_DEVICE_TABLE(pci, snd_trident_ids);\n\nstatic int snd_trident_probe(struct pci_dev *pci,\n\t\t\t     const struct pci_device_id *pci_id)\n{\n\tstatic int dev;\n\tstruct snd_card *card;\n\tstruct snd_trident *trident;\n\tconst char *str;\n\tint err, pcm_dev = 0;\n\n\tif (dev >= SNDRV_CARDS)\n\t\treturn -ENODEV;\n\tif (!enable[dev]) {\n\t\tdev++;\n\t\treturn -ENOENT;\n\t}\n\n\terr = snd_devm_card_new(&pci->dev, index[dev], id[dev], THIS_MODULE,\n\t\t\t\tsizeof(*trident), &card);\n\tif (err < 0)\n\t\treturn err;\n\ttrident = card->private_data;\n\n\terr = snd_trident_create(card, pci,\n\t\t\t\t pcm_channels[dev],\n\t\t\t\t ((pci->vendor << 16) | pci->device) == TRIDENT_DEVICE_ID_SI7018 ? 1 : 2,\n\t\t\t\t wavetable_size[dev]);\n\tif (err < 0)\n\t\treturn err;\n\n\tswitch (trident->device) {\n\tcase TRIDENT_DEVICE_ID_DX:\n\t\tstr = \"TRID4DWAVEDX\";\n\t\tbreak;\n\tcase TRIDENT_DEVICE_ID_NX:\n\t\tstr = \"TRID4DWAVENX\";\n\t\tbreak;\n\tcase TRIDENT_DEVICE_ID_SI7018:\n\t\tstr = \"SI7018\";\n\t\tbreak;\n\tdefault:\n\t\tstr = \"Unknown\";\n\t}\n\tstrcpy(card->driver, str);\n\tif (trident->device == TRIDENT_DEVICE_ID_SI7018) {\n\t\tstrcpy(card->shortname, \"SiS \");\n\t} else {\n\t\tstrcpy(card->shortname, \"Trident \");\n\t}\n\tstrcat(card->shortname, str);\n\tsprintf(card->longname, \"%s PCI Audio at 0x%lx, irq %d\",\n\t\tcard->shortname, trident->port, trident->irq);\n\n\terr = snd_trident_pcm(trident, pcm_dev++);\n\tif (err < 0)\n\t\treturn err;\n\tswitch (trident->device) {\n\tcase TRIDENT_DEVICE_ID_DX:\n\tcase TRIDENT_DEVICE_ID_NX:\n\t\terr = snd_trident_foldback_pcm(trident, pcm_dev++);\n\t\tif (err < 0)\n\t\t\treturn err;\n\t\tbreak;\n\t}\n\tif (trident->device == TRIDENT_DEVICE_ID_NX || trident->device == TRIDENT_DEVICE_ID_SI7018) {\n\t\terr = snd_trident_spdif_pcm(trident, pcm_dev++);\n\t\tif (err < 0)\n\t\t\treturn err;\n\t}\n\tif (trident->device != TRIDENT_DEVICE_ID_SI7018) {\n\t\terr = snd_mpu401_uart_new(card, 0, MPU401_HW_TRID4DWAVE,\n\t\t\t\t\t  trident->midi_port,\n\t\t\t\t\t  MPU401_INFO_INTEGRATED |\n\t\t\t\t\t  MPU401_INFO_IRQ_HOOK,\n\t\t\t\t\t  -1, &trident->rmidi);\n\t\tif (err < 0)\n\t\t\treturn err;\n\t}\n\n\tsnd_trident_create_gameport(trident);\n\n\terr = snd_card_register(card);\n\tif (err < 0)\n\t\treturn err;\n\tpci_set_drvdata(pci, card);\n\tdev++;\n\treturn 0;\n}\n\nstatic struct pci_driver trident_driver = {\n\t.name = KBUILD_MODNAME,\n\t.id_table = snd_trident_ids,\n\t.probe = snd_trident_probe,\n#ifdef CONFIG_PM_SLEEP\n\t.driver = {\n\t\t.pm = &snd_trident_pm,\n\t},\n#endif\n};\n\nmodule_pci_driver(trident_driver);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}