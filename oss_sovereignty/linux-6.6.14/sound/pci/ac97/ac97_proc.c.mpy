{
  "module_name": "ac97_proc.c",
  "hash_id": "d29ada95018bb20b79a0cc419a5283e314d90f9ef58694559364d77fac7536a0",
  "original_prompt": "Ingested from linux-6.6.14/sound/pci/ac97/ac97_proc.c",
  "human_readable_source": "\n \n\n#include <linux/mutex.h>\n\n#include <sound/core.h>\n#include <sound/ac97_codec.h>\n#include <sound/asoundef.h>\n#include \"ac97_local.h\"\n#include \"ac97_id.h\"\n\n \n\nstatic void snd_ac97_proc_read_functions(struct snd_ac97 *ac97, struct snd_info_buffer *buffer)\n{\n\tint header = 0, function;\n\tunsigned short info, sense_info;\n\tstatic const char *function_names[12] = {\n\t\t\"Master Out\", \"AUX Out\", \"Center/LFE Out\", \"SPDIF Out\",\n\t\t\"Phone In\", \"Mic 1\", \"Mic 2\", \"Line In\", \"CD In\", \"Video In\",\n\t\t\"Aux In\", \"Mono Out\"\n\t};\n\tstatic const char *locations[8] = {\n\t\t\"Rear I/O Panel\", \"Front Panel\", \"Motherboard\", \"Dock/External\",\n\t\t\"reserved\", \"reserved\", \"reserved\", \"NC/unused\"\n\t};\n\n\tfor (function = 0; function < 12; ++function) {\n\t\tsnd_ac97_write(ac97, AC97_FUNC_SELECT, function << 1);\n\t\tinfo = snd_ac97_read(ac97, AC97_FUNC_INFO);\n\t\tif (!(info & 0x0001))\n\t\t\tcontinue;\n\t\tif (!header) {\n\t\t\tsnd_iprintf(buffer, \"\\n                    Gain     Inverted  Buffer delay  Location\\n\");\n\t\t\theader = 1;\n\t\t}\n\t\tsense_info = snd_ac97_read(ac97, AC97_SENSE_INFO);\n\t\tsnd_iprintf(buffer, \"%-17s: %3d.%d dBV    %c      %2d/fs         %s\\n\",\n\t\t\t    function_names[function],\n\t\t\t    (info & 0x8000 ? -1 : 1) * ((info & 0x7000) >> 12) * 3 / 2,\n\t\t\t    ((info & 0x0800) >> 11) * 5,\n\t\t\t    info & 0x0400 ? 'X' : '-',\n\t\t\t    (info & 0x03e0) >> 5,\n\t\t\t    locations[sense_info >> 13]);\n\t}\n}\n\nstatic const char *snd_ac97_stereo_enhancements[] =\n{\n    \"No 3D Stereo Enhancement\",\n    \"Analog Devices Phat Stereo\",\n    \"Creative Stereo Enhancement\",\n    \"National Semi 3D Stereo Enhancement\",\n    \"YAMAHA Ymersion\",\n    \"BBE 3D Stereo Enhancement\",\n    \"Crystal Semi 3D Stereo Enhancement\",\n    \"Qsound QXpander\",\n    \"Spatializer 3D Stereo Enhancement\",\n    \"SRS 3D Stereo Enhancement\",\n    \"Platform Tech 3D Stereo Enhancement\",\n    \"AKM 3D Audio\",\n    \"Aureal Stereo Enhancement\",\n    \"Aztech 3D Enhancement\",\n    \"Binaura 3D Audio Enhancement\",\n    \"ESS Technology Stereo Enhancement\",\n    \"Harman International VMAx\",\n    \"Nvidea/IC Ensemble/KS Waves 3D Stereo Enhancement\",\n    \"Philips Incredible Sound\",\n    \"Texas Instruments 3D Stereo Enhancement\",\n    \"VLSI Technology 3D Stereo Enhancement\",\n    \"TriTech 3D Stereo Enhancement\",\n    \"Realtek 3D Stereo Enhancement\",\n    \"Samsung 3D Stereo Enhancement\",\n    \"Wolfson Microelectronics 3D Enhancement\",\n    \"Delta Integration 3D Enhancement\",\n    \"SigmaTel 3D Enhancement\",\n    \"IC Ensemble/KS Waves\",\n    \"Rockwell 3D Stereo Enhancement\",\n    \"Reserved 29\",\n    \"Reserved 30\",\n    \"Reserved 31\"\n};\n\nstatic void snd_ac97_proc_read_main(struct snd_ac97 *ac97, struct snd_info_buffer *buffer, int subidx)\n{\n\tchar name[64];\n\tunsigned short val, tmp, ext, mext;\n\tstatic const char *spdif_slots[4] = { \" SPDIF=3/4\", \" SPDIF=7/8\", \" SPDIF=6/9\", \" SPDIF=10/11\" };\n\tstatic const char *spdif_rates[4] = { \" Rate=44.1kHz\", \" Rate=res\", \" Rate=48kHz\", \" Rate=32kHz\" };\n\tstatic const char *spdif_rates_cs4205[4] = { \" Rate=48kHz\", \" Rate=44.1kHz\", \" Rate=res\", \" Rate=res\" };\n\tstatic const char *double_rate_slots[4] = { \"10/11\", \"7/8\", \"reserved\", \"reserved\" };\n\n\tsnd_ac97_get_name(NULL, ac97->id, name, 0);\n\tsnd_iprintf(buffer, \"%d-%d/%d: %s\\n\\n\", ac97->addr, ac97->num, subidx, name);\n\n\tif ((ac97->scaps & AC97_SCAP_AUDIO) == 0)\n\t\tgoto __modem;\n\n        snd_iprintf(buffer, \"PCI Subsys Vendor: 0x%04x\\n\",\n\t            ac97->subsystem_vendor);\n        snd_iprintf(buffer, \"PCI Subsys Device: 0x%04x\\n\\n\",\n                    ac97->subsystem_device);\n\n\tsnd_iprintf(buffer, \"Flags: %x\\n\", ac97->flags);\n\n\tif ((ac97->ext_id & AC97_EI_REV_MASK) >= AC97_EI_REV_23) {\n\t\tval = snd_ac97_read(ac97, AC97_INT_PAGING);\n\t\tsnd_ac97_update_bits(ac97, AC97_INT_PAGING,\n\t\t\t\t     AC97_PAGE_MASK, AC97_PAGE_1);\n\t\ttmp = snd_ac97_read(ac97, AC97_CODEC_CLASS_REV);\n\t\tsnd_iprintf(buffer, \"Revision         : 0x%02x\\n\", tmp & 0xff);\n\t\tsnd_iprintf(buffer, \"Compat. Class    : 0x%02x\\n\", (tmp >> 8) & 0x1f);\n\t\tsnd_iprintf(buffer, \"Subsys. Vendor ID: 0x%04x\\n\",\n\t\t\t    snd_ac97_read(ac97, AC97_PCI_SVID));\n\t\tsnd_iprintf(buffer, \"Subsys. ID       : 0x%04x\\n\\n\",\n\t\t\t    snd_ac97_read(ac97, AC97_PCI_SID));\n\t\tsnd_ac97_update_bits(ac97, AC97_INT_PAGING,\n\t\t\t\t     AC97_PAGE_MASK, val & AC97_PAGE_MASK);\n\t}\n\n\t\n\tval = ac97->caps;\n\tsnd_iprintf(buffer, \"Capabilities     :%s%s%s%s%s%s\\n\",\n\t    \t    val & AC97_BC_DEDICATED_MIC ? \" -dedicated MIC PCM IN channel-\" : \"\",\n\t\t    val & AC97_BC_RESERVED1 ? \" -reserved1-\" : \"\",\n\t\t    val & AC97_BC_BASS_TREBLE ? \" -bass & treble-\" : \"\",\n\t\t    val & AC97_BC_SIM_STEREO ? \" -simulated stereo-\" : \"\",\n\t\t    val & AC97_BC_HEADPHONE ? \" -headphone out-\" : \"\",\n\t\t    val & AC97_BC_LOUDNESS ? \" -loudness-\" : \"\");\n\ttmp = ac97->caps & AC97_BC_DAC_MASK;\n\tsnd_iprintf(buffer, \"DAC resolution   : %s%s%s%s\\n\",\n\t\t    tmp == AC97_BC_16BIT_DAC ? \"16-bit\" : \"\",\n\t\t    tmp == AC97_BC_18BIT_DAC ? \"18-bit\" : \"\",\n\t\t    tmp == AC97_BC_20BIT_DAC ? \"20-bit\" : \"\",\n\t\t    tmp == AC97_BC_DAC_MASK ? \"???\" : \"\");\n\ttmp = ac97->caps & AC97_BC_ADC_MASK;\n\tsnd_iprintf(buffer, \"ADC resolution   : %s%s%s%s\\n\",\n\t\t    tmp == AC97_BC_16BIT_ADC ? \"16-bit\" : \"\",\n\t\t    tmp == AC97_BC_18BIT_ADC ? \"18-bit\" : \"\",\n\t\t    tmp == AC97_BC_20BIT_ADC ? \"20-bit\" : \"\",\n\t\t    tmp == AC97_BC_ADC_MASK ? \"???\" : \"\");\n\tsnd_iprintf(buffer, \"3D enhancement   : %s\\n\",\n\t\tsnd_ac97_stereo_enhancements[(val >> 10) & 0x1f]);\n\tsnd_iprintf(buffer, \"\\nCurrent setup\\n\");\n\tval = snd_ac97_read(ac97, AC97_MIC);\n\tsnd_iprintf(buffer, \"Mic gain         : %s [%s]\\n\", val & 0x0040 ? \"+20dB\" : \"+0dB\", ac97->regs[AC97_MIC] & 0x0040 ? \"+20dB\" : \"+0dB\");\n\tval = snd_ac97_read(ac97, AC97_GENERAL_PURPOSE);\n\tsnd_iprintf(buffer, \"POP path         : %s 3D\\n\"\n\t\t    \"Sim. stereo      : %s\\n\"\n\t\t    \"3D enhancement   : %s\\n\"\n\t\t    \"Loudness         : %s\\n\"\n\t\t    \"Mono output      : %s\\n\"\n\t\t    \"Mic select       : %s\\n\"\n\t\t    \"ADC/DAC loopback : %s\\n\",\n\t\t    val & 0x8000 ? \"post\" : \"pre\",\n\t\t    val & 0x4000 ? \"on\" : \"off\",\n\t\t    val & 0x2000 ? \"on\" : \"off\",\n\t\t    val & 0x1000 ? \"on\" : \"off\",\n\t\t    val & 0x0200 ? \"Mic\" : \"MIX\",\n\t\t    val & 0x0100 ? \"Mic2\" : \"Mic1\",\n\t\t    val & 0x0080 ? \"on\" : \"off\");\n\tif (ac97->ext_id & AC97_EI_DRA)\n\t\tsnd_iprintf(buffer, \"Double rate slots: %s\\n\",\n\t\t\t    double_rate_slots[(val >> 10) & 3]);\n\n\text = snd_ac97_read(ac97, AC97_EXTENDED_ID);\n\tif (ext == 0)\n\t\tgoto __modem;\n\t\t\n\tsnd_iprintf(buffer, \"Extended ID      : codec=%i rev=%i%s%s%s%s DSA=%i%s%s%s%s\\n\",\n\t\t\t(ext & AC97_EI_ADDR_MASK) >> AC97_EI_ADDR_SHIFT,\n\t\t\t(ext & AC97_EI_REV_MASK) >> AC97_EI_REV_SHIFT,\n\t\t\text & AC97_EI_AMAP ? \" AMAP\" : \"\",\n\t\t\text & AC97_EI_LDAC ? \" LDAC\" : \"\",\n\t\t\text & AC97_EI_SDAC ? \" SDAC\" : \"\",\n\t\t\text & AC97_EI_CDAC ? \" CDAC\" : \"\",\n\t\t\t(ext & AC97_EI_DACS_SLOT_MASK) >> AC97_EI_DACS_SLOT_SHIFT,\n\t\t\text & AC97_EI_VRM ? \" VRM\" : \"\",\n\t\t\text & AC97_EI_SPDIF ? \" SPDIF\" : \"\",\n\t\t\text & AC97_EI_DRA ? \" DRA\" : \"\",\n\t\t\text & AC97_EI_VRA ? \" VRA\" : \"\");\n\tval = snd_ac97_read(ac97, AC97_EXTENDED_STATUS);\n\tsnd_iprintf(buffer, \"Extended status  :%s%s%s%s%s%s%s%s%s%s%s%s%s%s\\n\",\n\t\t\tval & AC97_EA_PRL ? \" PRL\" : \"\",\n\t\t\tval & AC97_EA_PRK ? \" PRK\" : \"\",\n\t\t\tval & AC97_EA_PRJ ? \" PRJ\" : \"\",\n\t\t\tval & AC97_EA_PRI ? \" PRI\" : \"\",\n\t\t\tval & AC97_EA_SPCV ? \" SPCV\" : \"\",\n\t\t\tval & AC97_EA_MDAC ? \" MADC\" : \"\",\n\t\t\tval & AC97_EA_LDAC ? \" LDAC\" : \"\",\n\t\t\tval & AC97_EA_SDAC ? \" SDAC\" : \"\",\n\t\t\tval & AC97_EA_CDAC ? \" CDAC\" : \"\",\n\t\t\text & AC97_EI_SPDIF ? spdif_slots[(val & AC97_EA_SPSA_SLOT_MASK) >> AC97_EA_SPSA_SLOT_SHIFT] : \"\",\n\t\t\tval & AC97_EA_VRM ? \" VRM\" : \"\",\n\t\t\tval & AC97_EA_SPDIF ? \" SPDIF\" : \"\",\n\t\t\tval & AC97_EA_DRA ? \" DRA\" : \"\",\n\t\t\tval & AC97_EA_VRA ? \" VRA\" : \"\");\n\tif (ext & AC97_EI_VRA) {\t \n\t\tval = snd_ac97_read(ac97, AC97_PCM_FRONT_DAC_RATE);\n\t\tsnd_iprintf(buffer, \"PCM front DAC    : %iHz\\n\", val);\n\t\tif (ext & AC97_EI_SDAC) {\n\t\t\tval = snd_ac97_read(ac97, AC97_PCM_SURR_DAC_RATE);\n\t\t\tsnd_iprintf(buffer, \"PCM Surr DAC     : %iHz\\n\", val);\n\t\t}\n\t\tif (ext & AC97_EI_LDAC) {\n\t\t\tval = snd_ac97_read(ac97, AC97_PCM_LFE_DAC_RATE);\n\t\t\tsnd_iprintf(buffer, \"PCM LFE DAC      : %iHz\\n\", val);\n\t\t}\n\t\tval = snd_ac97_read(ac97, AC97_PCM_LR_ADC_RATE);\n\t\tsnd_iprintf(buffer, \"PCM ADC          : %iHz\\n\", val);\n\t}\n\tif (ext & AC97_EI_VRM) {\n\t\tval = snd_ac97_read(ac97, AC97_PCM_MIC_ADC_RATE);\n\t\tsnd_iprintf(buffer, \"PCM MIC ADC      : %iHz\\n\", val);\n\t}\n\tif ((ext & AC97_EI_SPDIF) || (ac97->flags & AC97_CS_SPDIF) ||\n\t    (ac97->id == AC97_ID_YMF743)) {\n\t        if (ac97->flags & AC97_CS_SPDIF)\n\t\t\tval = snd_ac97_read(ac97, AC97_CSR_SPDIF);\n\t\telse if (ac97->id == AC97_ID_YMF743) {\n\t\t\tval = snd_ac97_read(ac97, AC97_YMF7X3_DIT_CTRL);\n\t\t\tval = 0x2000 | (val & 0xff00) >> 4 | (val & 0x38) >> 2;\n\t\t} else\n\t\t\tval = snd_ac97_read(ac97, AC97_SPDIF);\n\n\t\tsnd_iprintf(buffer, \"SPDIF Control    :%s%s%s%s Category=0x%x Generation=%i%s%s%s\\n\",\n\t\t\tval & AC97_SC_PRO ? \" PRO\" : \" Consumer\",\n\t\t\tval & AC97_SC_NAUDIO ? \" Non-audio\" : \" PCM\",\n\t\t\tval & AC97_SC_COPY ? \"\" : \" Copyright\",\n\t\t\tval & AC97_SC_PRE ? \" Preemph50/15\" : \"\",\n\t\t\t(val & AC97_SC_CC_MASK) >> AC97_SC_CC_SHIFT,\n\t\t\t(val & AC97_SC_L) >> 11,\n\t\t\t(ac97->flags & AC97_CS_SPDIF) ?\n\t\t\t    spdif_rates_cs4205[(val & AC97_SC_SPSR_MASK) >> AC97_SC_SPSR_SHIFT] :\n\t\t\t    spdif_rates[(val & AC97_SC_SPSR_MASK) >> AC97_SC_SPSR_SHIFT],\n\t\t\t(ac97->flags & AC97_CS_SPDIF) ?\n\t\t\t    (val & AC97_SC_DRS ? \" Validity\" : \"\") :\n\t\t\t    (val & AC97_SC_DRS ? \" DRS\" : \"\"),\n\t\t\t(ac97->flags & AC97_CS_SPDIF) ?\n\t\t\t    (val & AC97_SC_V ? \" Enabled\" : \"\") :\n\t\t\t    (val & AC97_SC_V ? \" Validity\" : \"\"));\n\t\t \n\t\tif ((ac97->id & 0xfffffff0) == 0x414c4720 &&\n\t\t    (snd_ac97_read(ac97, AC97_ALC650_CLOCK) & 0x01)) {\n\t\t\tval = snd_ac97_read(ac97, AC97_ALC650_SPDIF_INPUT_STATUS2);\n\t\t\tif (val & AC97_ALC650_CLOCK_LOCK) {\n\t\t\t\tval = snd_ac97_read(ac97, AC97_ALC650_SPDIF_INPUT_STATUS1);\n\t\t\t\tsnd_iprintf(buffer, \"SPDIF In Status  :%s%s%s%s Category=0x%x Generation=%i\",\n\t\t\t\t\t    val & AC97_ALC650_PRO ? \" PRO\" : \" Consumer\",\n\t\t\t\t\t    val & AC97_ALC650_NAUDIO ? \" Non-audio\" : \" PCM\",\n\t\t\t\t\t    val & AC97_ALC650_COPY ? \"\" : \" Copyright\",\n\t\t\t\t\t    val & AC97_ALC650_PRE ? \" Preemph50/15\" : \"\",\n\t\t\t\t\t    (val & AC97_ALC650_CC_MASK) >> AC97_ALC650_CC_SHIFT,\n\t\t\t\t\t    (val & AC97_ALC650_L) >> 15);\n\t\t\t\tval = snd_ac97_read(ac97, AC97_ALC650_SPDIF_INPUT_STATUS2);\n\t\t\t\tsnd_iprintf(buffer, \"%s Accuracy=%i%s%s\\n\",\n\t\t\t\t\t    spdif_rates[(val & AC97_ALC650_SPSR_MASK) >> AC97_ALC650_SPSR_SHIFT],\n\t\t\t\t\t    (val & AC97_ALC650_CLOCK_ACCURACY) >> AC97_ALC650_CLOCK_SHIFT,\n\t\t\t\t\t    (val & AC97_ALC650_CLOCK_LOCK ? \" Locked\" : \" Unlocked\"),\n\t\t\t\t\t    (val & AC97_ALC650_V ? \" Validity?\" : \"\"));\n\t\t\t} else {\n\t\t\t\tsnd_iprintf(buffer, \"SPDIF In Status  : Not Locked\\n\");\n\t\t\t}\n\t\t}\n\t}\n\tif ((ac97->ext_id & AC97_EI_REV_MASK) >= AC97_EI_REV_23) {\n\t\tval = snd_ac97_read(ac97, AC97_INT_PAGING);\n\t\tsnd_ac97_update_bits(ac97, AC97_INT_PAGING,\n\t\t\t\t     AC97_PAGE_MASK, AC97_PAGE_1);\n\t\tsnd_ac97_proc_read_functions(ac97, buffer);\n\t\tsnd_ac97_update_bits(ac97, AC97_INT_PAGING,\n\t\t\t\t     AC97_PAGE_MASK, val & AC97_PAGE_MASK);\n\t}\n\n\n      __modem:\n\tmext = snd_ac97_read(ac97, AC97_EXTENDED_MID);\n\tif (mext == 0)\n\t\treturn;\n\t\n\tsnd_iprintf(buffer, \"Extended modem ID: codec=%i%s%s%s%s%s\\n\",\n\t\t\t(mext & AC97_MEI_ADDR_MASK) >> AC97_MEI_ADDR_SHIFT,\n\t\t\tmext & AC97_MEI_CID2 ? \" CID2\" : \"\",\n\t\t\tmext & AC97_MEI_CID1 ? \" CID1\" : \"\",\n\t\t\tmext & AC97_MEI_HANDSET ? \" HSET\" : \"\",\n\t\t\tmext & AC97_MEI_LINE2 ? \" LIN2\" : \"\",\n\t\t\tmext & AC97_MEI_LINE1 ? \" LIN1\" : \"\");\n\tval = snd_ac97_read(ac97, AC97_EXTENDED_MSTATUS);\n\tsnd_iprintf(buffer, \"Modem status     :%s%s%s%s%s%s%s%s%s%s%s%s%s%s%s%s\\n\",\n\t\t\tval & AC97_MEA_GPIO ? \" GPIO\" : \"\",\n\t\t\tval & AC97_MEA_MREF ? \" MREF\" : \"\",\n\t\t\tval & AC97_MEA_ADC1 ? \" ADC1\" : \"\",\n\t\t\tval & AC97_MEA_DAC1 ? \" DAC1\" : \"\",\n\t\t\tval & AC97_MEA_ADC2 ? \" ADC2\" : \"\",\n\t\t\tval & AC97_MEA_DAC2 ? \" DAC2\" : \"\",\n\t\t\tval & AC97_MEA_HADC ? \" HADC\" : \"\",\n\t\t\tval & AC97_MEA_HDAC ? \" HDAC\" : \"\",\n\t\t\tval & AC97_MEA_PRA ? \" PRA(GPIO)\" : \"\",\n\t\t\tval & AC97_MEA_PRB ? \" PRB(res)\" : \"\",\n\t\t\tval & AC97_MEA_PRC ? \" PRC(ADC1)\" : \"\",\n\t\t\tval & AC97_MEA_PRD ? \" PRD(DAC1)\" : \"\",\n\t\t\tval & AC97_MEA_PRE ? \" PRE(ADC2)\" : \"\",\n\t\t\tval & AC97_MEA_PRF ? \" PRF(DAC2)\" : \"\",\n\t\t\tval & AC97_MEA_PRG ? \" PRG(HADC)\" : \"\",\n\t\t\tval & AC97_MEA_PRH ? \" PRH(HDAC)\" : \"\");\n\tif (mext & AC97_MEI_LINE1) {\n\t\tval = snd_ac97_read(ac97, AC97_LINE1_RATE);\n\t\tsnd_iprintf(buffer, \"Line1 rate       : %iHz\\n\", val);\n\t}\n\tif (mext & AC97_MEI_LINE2) {\n\t\tval = snd_ac97_read(ac97, AC97_LINE2_RATE);\n\t\tsnd_iprintf(buffer, \"Line2 rate       : %iHz\\n\", val);\n\t}\n\tif (mext & AC97_MEI_HANDSET) {\n\t\tval = snd_ac97_read(ac97, AC97_HANDSET_RATE);\n\t\tsnd_iprintf(buffer, \"Headset rate     : %iHz\\n\", val);\n\t}\n}\n\nstatic void snd_ac97_proc_read(struct snd_info_entry *entry, struct snd_info_buffer *buffer)\n{\n\tstruct snd_ac97 *ac97 = entry->private_data;\n\t\n\tmutex_lock(&ac97->page_mutex);\n\tif ((ac97->id & 0xffffff40) == AC97_ID_AD1881) {\t\n\t\tint idx;\n\t\tfor (idx = 0; idx < 3; idx++)\n\t\t\tif (ac97->spec.ad18xx.id[idx]) {\n\t\t\t\t \n\t\t\t\tsnd_ac97_update_bits(ac97, AC97_AD_SERIAL_CFG, 0x7000,\n\t\t\t\t\t\t     ac97->spec.ad18xx.unchained[idx] | ac97->spec.ad18xx.chained[idx]);\n\t\t\t\tsnd_ac97_proc_read_main(ac97, buffer, idx);\n\t\t\t\tsnd_iprintf(buffer, \"\\n\\n\");\n\t\t\t}\n\t\t \n\t\tsnd_ac97_update_bits(ac97, AC97_AD_SERIAL_CFG, 0x7000, 0x7000);\n\t\t\n\t\tsnd_iprintf(buffer, \"\\nAD18XX configuration\\n\");\n\t\tsnd_iprintf(buffer, \"Unchained        : 0x%04x,0x%04x,0x%04x\\n\",\n\t\t\tac97->spec.ad18xx.unchained[0],\n\t\t\tac97->spec.ad18xx.unchained[1],\n\t\t\tac97->spec.ad18xx.unchained[2]);\n\t\tsnd_iprintf(buffer, \"Chained          : 0x%04x,0x%04x,0x%04x\\n\",\n\t\t\tac97->spec.ad18xx.chained[0],\n\t\t\tac97->spec.ad18xx.chained[1],\n\t\t\tac97->spec.ad18xx.chained[2]);\n\t} else {\n\t\tsnd_ac97_proc_read_main(ac97, buffer, 0);\n\t}\n\tmutex_unlock(&ac97->page_mutex);\n}\n\n#ifdef CONFIG_SND_DEBUG\n \nstatic void snd_ac97_proc_regs_write(struct snd_info_entry *entry, struct snd_info_buffer *buffer)\n{\n\tstruct snd_ac97 *ac97 = entry->private_data;\n\tchar line[64];\n\tunsigned int reg, val;\n\tmutex_lock(&ac97->page_mutex);\n\twhile (!snd_info_get_line(buffer, line, sizeof(line))) {\n\t\tif (sscanf(line, \"%x %x\", &reg, &val) != 2)\n\t\t\tcontinue;\n\t\t \n\t\tif (reg < 0x80 && (reg & 1) == 0 && val <= 0xffff)\n\t\t\tsnd_ac97_write_cache(ac97, reg, val);\n\t}\n\tmutex_unlock(&ac97->page_mutex);\n}\n#endif\n\nstatic void snd_ac97_proc_regs_read_main(struct snd_ac97 *ac97, struct snd_info_buffer *buffer, int subidx)\n{\n\tint reg, val;\n\n\tfor (reg = 0; reg < 0x80; reg += 2) {\n\t\tval = snd_ac97_read(ac97, reg);\n\t\tsnd_iprintf(buffer, \"%i:%02x = %04x\\n\", subidx, reg, val);\n\t}\n}\n\nstatic void snd_ac97_proc_regs_read(struct snd_info_entry *entry, \n\t\t\t\t    struct snd_info_buffer *buffer)\n{\n\tstruct snd_ac97 *ac97 = entry->private_data;\n\n\tmutex_lock(&ac97->page_mutex);\n\tif ((ac97->id & 0xffffff40) == AC97_ID_AD1881) {\t\n\n\t\tint idx;\n\t\tfor (idx = 0; idx < 3; idx++)\n\t\t\tif (ac97->spec.ad18xx.id[idx]) {\n\t\t\t\t \n\t\t\t\tsnd_ac97_update_bits(ac97, AC97_AD_SERIAL_CFG, 0x7000,\n\t\t\t\t\t\t     ac97->spec.ad18xx.unchained[idx] | ac97->spec.ad18xx.chained[idx]);\n\t\t\t\tsnd_ac97_proc_regs_read_main(ac97, buffer, idx);\n\t\t\t}\n\t\t \n\t\tsnd_ac97_update_bits(ac97, AC97_AD_SERIAL_CFG, 0x7000, 0x7000);\n\t} else {\n\t\tsnd_ac97_proc_regs_read_main(ac97, buffer, 0);\n\t}\t\n\tmutex_unlock(&ac97->page_mutex);\n}\n\nvoid snd_ac97_proc_init(struct snd_ac97 * ac97)\n{\n\tstruct snd_info_entry *entry;\n\tchar name[32];\n\tconst char *prefix;\n\n\tif (ac97->bus->proc == NULL)\n\t\treturn;\n\tprefix = ac97_is_audio(ac97) ? \"ac97\" : \"mc97\";\n\tsprintf(name, \"%s#%d-%d\", prefix, ac97->addr, ac97->num);\n\tentry = snd_info_create_card_entry(ac97->bus->card, name,\n\t\t\t\t\t   ac97->bus->proc);\n\tif (entry)\n\t\tsnd_info_set_text_ops(entry, ac97, snd_ac97_proc_read);\n\tac97->proc = entry;\n\tsprintf(name, \"%s#%d-%d+regs\", prefix, ac97->addr, ac97->num);\n\tentry = snd_info_create_card_entry(ac97->bus->card, name,\n\t\t\t\t\t   ac97->bus->proc);\n\tif (entry) {\n\t\tsnd_info_set_text_ops(entry, ac97, snd_ac97_proc_regs_read);\n#ifdef CONFIG_SND_DEBUG\n\t\tentry->mode |= 0200;\n\t\tentry->c.text.write = snd_ac97_proc_regs_write;\n#endif\n\t}\n\tac97->proc_regs = entry;\n}\n\nvoid snd_ac97_proc_done(struct snd_ac97 * ac97)\n{\n\tsnd_info_free_entry(ac97->proc_regs);\n\tac97->proc_regs = NULL;\n\tsnd_info_free_entry(ac97->proc);\n\tac97->proc = NULL;\n}\n\nvoid snd_ac97_bus_proc_init(struct snd_ac97_bus * bus)\n{\n\tstruct snd_info_entry *entry;\n\tchar name[32];\n\n\tsprintf(name, \"codec97#%d\", bus->num);\n\tentry = snd_info_create_card_entry(bus->card, name,\n\t\t\t\t\t   bus->card->proc_root);\n\tif (entry)\n\t\tentry->mode = S_IFDIR | 0555;\n\tbus->proc = entry;\n}\n\nvoid snd_ac97_bus_proc_done(struct snd_ac97_bus * bus)\n{\n\tsnd_info_free_entry(bus->proc);\n\tbus->proc = NULL;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}