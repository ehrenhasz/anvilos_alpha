{
  "module_name": "ac97_patch.c",
  "hash_id": "936517f52b20041777944b98e6688348947cc70614f7130ba8f67c496a9051b8",
  "original_prompt": "Ingested from linux-6.6.14/sound/pci/ac97/ac97_patch.c",
  "human_readable_source": "\n \n\n#include \"ac97_local.h\"\n#include \"ac97_patch.h\"\n\n \n\nstatic struct snd_kcontrol *snd_ac97_find_mixer_ctl(struct snd_ac97 *ac97,\n\t\t\t\t\t\t    const char *name);\nstatic int snd_ac97_add_vmaster(struct snd_ac97 *ac97, char *name,\n\t\t\t\tconst unsigned int *tlv,\n\t\t\t\tconst char * const *followers);\n\n \n\nstatic int patch_build_controls(struct snd_ac97 * ac97, const struct snd_kcontrol_new *controls, int count)\n{\n\tint idx, err;\n\n\tfor (idx = 0; idx < count; idx++) {\n\t\terr = snd_ctl_add(ac97->bus->card, snd_ac97_cnew(&controls[idx], ac97));\n\t\tif (err < 0)\n\t\t\treturn err;\n\t}\n\treturn 0;\n}\n\n \nstatic void reset_tlv(struct snd_ac97 *ac97, const char *name,\n\t\t      const unsigned int *tlv)\n{\n\tstruct snd_ctl_elem_id sid;\n\tstruct snd_kcontrol *kctl;\n\tmemset(&sid, 0, sizeof(sid));\n\tstrcpy(sid.name, name);\n\tsid.iface = SNDRV_CTL_ELEM_IFACE_MIXER;\n\tkctl = snd_ctl_find_id(ac97->bus->card, &sid);\n\tif (kctl && kctl->tlv.p)\n\t\tkctl->tlv.p = tlv;\n}\n\n \nstatic int ac97_update_bits_page(struct snd_ac97 *ac97, unsigned short reg, unsigned short mask, unsigned short value, unsigned short page)\n{\n\tunsigned short page_save;\n\tint ret;\n\n\tmutex_lock(&ac97->page_mutex);\n\tpage_save = snd_ac97_read(ac97, AC97_INT_PAGING) & AC97_PAGE_MASK;\n\tsnd_ac97_update_bits(ac97, AC97_INT_PAGING, AC97_PAGE_MASK, page);\n\tret = snd_ac97_update_bits(ac97, reg, mask, value);\n\tsnd_ac97_update_bits(ac97, AC97_INT_PAGING, AC97_PAGE_MASK, page_save);\n\tmutex_unlock(&ac97->page_mutex);  \n\treturn ret;\n}\n\n \nstatic int ac97_surround_jack_mode_info(struct snd_kcontrol *kcontrol, struct snd_ctl_elem_info *uinfo)\n{\n\tstatic const char * const texts[] = { \"Shared\", \"Independent\" };\n\n\treturn snd_ctl_enum_info(uinfo, 1, 2, texts);\n}\n\nstatic int ac97_surround_jack_mode_get(struct snd_kcontrol *kcontrol, struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_ac97 *ac97 = snd_kcontrol_chip(kcontrol);\n\n\tucontrol->value.enumerated.item[0] = ac97->indep_surround;\n\treturn 0;\n}\n\nstatic int ac97_surround_jack_mode_put(struct snd_kcontrol *kcontrol, struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_ac97 *ac97 = snd_kcontrol_chip(kcontrol);\n\tunsigned char indep = !!ucontrol->value.enumerated.item[0];\n\n\tif (indep != ac97->indep_surround) {\n\t\tac97->indep_surround = indep;\n\t\tif (ac97->build_ops->update_jacks)\n\t\t\tac97->build_ops->update_jacks(ac97);\n\t\treturn 1;\n\t}\n\treturn 0;\n}\n\nstatic int ac97_channel_mode_info(struct snd_kcontrol *kcontrol, struct snd_ctl_elem_info *uinfo)\n{\n\tstatic const char * const texts[] = { \"2ch\", \"4ch\", \"6ch\", \"8ch\" };\n\n\treturn snd_ctl_enum_info(uinfo, 1, kcontrol->private_value, texts);\n}\n\nstatic int ac97_channel_mode_get(struct snd_kcontrol *kcontrol, struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_ac97 *ac97 = snd_kcontrol_chip(kcontrol);\n\n\tucontrol->value.enumerated.item[0] = ac97->channel_mode;\n\treturn 0;\n}\n\nstatic int ac97_channel_mode_put(struct snd_kcontrol *kcontrol, struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_ac97 *ac97 = snd_kcontrol_chip(kcontrol);\n\tunsigned char mode = ucontrol->value.enumerated.item[0];\n\n\tif (mode >= kcontrol->private_value)\n\t\treturn -EINVAL;\n\n\tif (mode != ac97->channel_mode) {\n\t\tac97->channel_mode = mode;\n\t\tif (ac97->build_ops->update_jacks)\n\t\t\tac97->build_ops->update_jacks(ac97);\n\t\treturn 1;\n\t}\n\treturn 0;\n}\n\n#define AC97_SURROUND_JACK_MODE_CTL \\\n\t{ \\\n\t\t.iface\t= SNDRV_CTL_ELEM_IFACE_MIXER, \\\n\t\t.name\t= \"Surround Jack Mode\", \\\n\t\t.info = ac97_surround_jack_mode_info, \\\n\t\t.get = ac97_surround_jack_mode_get, \\\n\t\t.put = ac97_surround_jack_mode_put, \\\n\t}\n \n#define AC97_CHANNEL_MODE_CTL \\\n\t{ \\\n\t\t.iface\t= SNDRV_CTL_ELEM_IFACE_MIXER, \\\n\t\t.name\t= \"Channel Mode\", \\\n\t\t.info = ac97_channel_mode_info, \\\n\t\t.get = ac97_channel_mode_get, \\\n\t\t.put = ac97_channel_mode_put, \\\n\t\t.private_value = 3, \\\n\t}\n \n#define AC97_CHANNEL_MODE_4CH_CTL \\\n\t{ \\\n\t\t.iface\t= SNDRV_CTL_ELEM_IFACE_MIXER, \\\n\t\t.name\t= \"Channel Mode\", \\\n\t\t.info = ac97_channel_mode_info, \\\n\t\t.get = ac97_channel_mode_get, \\\n\t\t.put = ac97_channel_mode_put, \\\n\t\t.private_value = 2, \\\n\t}\n \n#define AC97_CHANNEL_MODE_8CH_CTL \\\n\t{ \\\n\t\t.iface  = SNDRV_CTL_ELEM_IFACE_MIXER, \\\n\t\t.name   = \"Channel Mode\", \\\n\t\t.info = ac97_channel_mode_info, \\\n\t\t.get = ac97_channel_mode_get, \\\n\t\t.put = ac97_channel_mode_put, \\\n\t\t.private_value = 4, \\\n\t}\n\nstatic inline int is_surround_on(struct snd_ac97 *ac97)\n{\n\treturn ac97->channel_mode >= 1;\n}\n\nstatic inline int is_clfe_on(struct snd_ac97 *ac97)\n{\n\treturn ac97->channel_mode >= 2;\n}\n\n \nstatic inline int is_shared_surrout(struct snd_ac97 *ac97)\n{\n\treturn !ac97->indep_surround && is_surround_on(ac97);\n}\n\n \nstatic inline int is_shared_clfeout(struct snd_ac97 *ac97)\n{\n\treturn !ac97->indep_surround && is_clfe_on(ac97);\n}\n\n \nstatic inline int is_shared_linein(struct snd_ac97 *ac97)\n{\n\treturn !ac97->indep_surround && !is_surround_on(ac97);\n}\n\n \nstatic inline int is_shared_micin(struct snd_ac97 *ac97)\n{\n\treturn !ac97->indep_surround && !is_clfe_on(ac97);\n}\n\nstatic inline int alc850_is_aux_back_surround(struct snd_ac97 *ac97)\n{\n\treturn is_surround_on(ac97);\n}\n\n \n \n\n \n\nstatic int snd_ac97_ymf7x3_info_speaker(struct snd_kcontrol *kcontrol,\n\t\t\t\t\tstruct snd_ctl_elem_info *uinfo)\n{\n\tstatic const char * const texts[3] = {\n\t\t\"Standard\", \"Small\", \"Smaller\"\n\t};\n\n\treturn snd_ctl_enum_info(uinfo, 1, 3, texts);\n}\n\nstatic int snd_ac97_ymf7x3_get_speaker(struct snd_kcontrol *kcontrol,\n\t\t\t\t       struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_ac97 *ac97 = snd_kcontrol_chip(kcontrol);\n\tunsigned short val;\n\n\tval = ac97->regs[AC97_YMF7X3_3D_MODE_SEL];\n\tval = (val >> 10) & 3;\n\tif (val > 0)     \n\t\tval--;\n\tucontrol->value.enumerated.item[0] = val;\n\treturn 0;\n}\n\nstatic int snd_ac97_ymf7x3_put_speaker(struct snd_kcontrol *kcontrol,\n\t\t\t\t       struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_ac97 *ac97 = snd_kcontrol_chip(kcontrol);\n\tunsigned short val;\n\n\tif (ucontrol->value.enumerated.item[0] > 2)\n\t\treturn -EINVAL;\n\tval = (ucontrol->value.enumerated.item[0] + 1) << 10;\n\treturn snd_ac97_update(ac97, AC97_YMF7X3_3D_MODE_SEL, val);\n}\n\nstatic const struct snd_kcontrol_new snd_ac97_ymf7x3_controls_speaker =\n{\n\t.iface  = SNDRV_CTL_ELEM_IFACE_MIXER,\n\t.name   = \"3D Control - Speaker\",\n\t.info   = snd_ac97_ymf7x3_info_speaker,\n\t.get    = snd_ac97_ymf7x3_get_speaker,\n\t.put    = snd_ac97_ymf7x3_put_speaker,\n};\n\n \nstatic int snd_ac97_ymf7x3_spdif_source_info(struct snd_kcontrol *kcontrol,\n\t\t\t\t\t     struct snd_ctl_elem_info *uinfo)\n{\n\tstatic const char * const texts[2] = { \"AC-Link\", \"A/D Converter\" };\n\n\treturn snd_ctl_enum_info(uinfo, 1, 2, texts);\n}\n\nstatic int snd_ac97_ymf7x3_spdif_source_get(struct snd_kcontrol *kcontrol,\n\t\t\t\t\t    struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_ac97 *ac97 = snd_kcontrol_chip(kcontrol);\n\tunsigned short val;\n\n\tval = ac97->regs[AC97_YMF7X3_DIT_CTRL];\n\tucontrol->value.enumerated.item[0] = (val >> 1) & 1;\n\treturn 0;\n}\n\nstatic int snd_ac97_ymf7x3_spdif_source_put(struct snd_kcontrol *kcontrol,\n\t\t\t\t\t    struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_ac97 *ac97 = snd_kcontrol_chip(kcontrol);\n\tunsigned short val;\n\n\tif (ucontrol->value.enumerated.item[0] > 1)\n\t\treturn -EINVAL;\n\tval = ucontrol->value.enumerated.item[0] << 1;\n\treturn snd_ac97_update_bits(ac97, AC97_YMF7X3_DIT_CTRL, 0x0002, val);\n}\n\nstatic int patch_yamaha_ymf7x3_3d(struct snd_ac97 *ac97)\n{\n\tstruct snd_kcontrol *kctl;\n\tint err;\n\n\tkctl = snd_ac97_cnew(&snd_ac97_controls_3d[0], ac97);\n\terr = snd_ctl_add(ac97->bus->card, kctl);\n\tif (err < 0)\n\t\treturn err;\n\tstrcpy(kctl->id.name, \"3D Control - Wide\");\n\tkctl->private_value = AC97_SINGLE_VALUE(AC97_3D_CONTROL, 9, 7, 0);\n\tsnd_ac97_write_cache(ac97, AC97_3D_CONTROL, 0x0000);\n\terr = snd_ctl_add(ac97->bus->card,\n\t\t\t  snd_ac97_cnew(&snd_ac97_ymf7x3_controls_speaker,\n\t\t\t\t\tac97));\n\tif (err < 0)\n\t\treturn err;\n\tsnd_ac97_write_cache(ac97, AC97_YMF7X3_3D_MODE_SEL, 0x0c00);\n\treturn 0;\n}\n\nstatic const struct snd_kcontrol_new snd_ac97_yamaha_ymf743_controls_spdif[3] =\n{\n\tAC97_SINGLE(SNDRV_CTL_NAME_IEC958(\"\", PLAYBACK, SWITCH),\n\t\t    AC97_YMF7X3_DIT_CTRL, 0, 1, 0),\n\t{\n\t\t.iface\t= SNDRV_CTL_ELEM_IFACE_MIXER,\n\t\t.name\t= SNDRV_CTL_NAME_IEC958(\"\", PLAYBACK, NONE) \"Source\",\n\t\t.info\t= snd_ac97_ymf7x3_spdif_source_info,\n\t\t.get\t= snd_ac97_ymf7x3_spdif_source_get,\n\t\t.put\t= snd_ac97_ymf7x3_spdif_source_put,\n\t},\n\tAC97_SINGLE(SNDRV_CTL_NAME_IEC958(\"\", NONE, NONE) \"Mute\",\n\t\t    AC97_YMF7X3_DIT_CTRL, 2, 1, 1)\n};\n\nstatic int patch_yamaha_ymf743_build_spdif(struct snd_ac97 *ac97)\n{\n\tint err;\n\n\terr = patch_build_controls(ac97, &snd_ac97_controls_spdif[0], 3);\n\tif (err < 0)\n\t\treturn err;\n\terr = patch_build_controls(ac97,\n\t\t\t\t   snd_ac97_yamaha_ymf743_controls_spdif, 3);\n\tif (err < 0)\n\t\treturn err;\n\t \n\t \n\tsnd_ac97_write_cache(ac97, AC97_YMF7X3_DIT_CTRL, 0xa201);\n\treturn 0;\n}\n\nstatic const struct snd_ac97_build_ops patch_yamaha_ymf743_ops = {\n\t.build_spdif\t= patch_yamaha_ymf743_build_spdif,\n\t.build_3d\t= patch_yamaha_ymf7x3_3d,\n};\n\nstatic int patch_yamaha_ymf743(struct snd_ac97 *ac97)\n{\n\tac97->build_ops = &patch_yamaha_ymf743_ops;\n\tac97->caps |= AC97_BC_BASS_TREBLE;\n\tac97->caps |= 0x04 << 10;  \n\tac97->rates[AC97_RATES_SPDIF] = SNDRV_PCM_RATE_48000;  \n\tac97->ext_id |= AC97_EI_SPDIF;  \n\treturn 0;\n}\n\n \nstatic int snd_ac97_ymf753_spdif_output_pin_info(struct snd_kcontrol *kcontrol, struct snd_ctl_elem_info *uinfo)\n{\n\tstatic const char * const texts[3] = { \"Disabled\", \"Pin 43\", \"Pin 48\" };\n\n\treturn snd_ctl_enum_info(uinfo, 1, 3, texts);\n}\n\nstatic int snd_ac97_ymf753_spdif_output_pin_get(struct snd_kcontrol *kcontrol, struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_ac97 *ac97 = snd_kcontrol_chip(kcontrol);\n\tunsigned short val;\n\n\tval = ac97->regs[AC97_YMF7X3_DIT_CTRL];\n\tucontrol->value.enumerated.item[0] = (val & 0x0008) ? 2 : (val & 0x0020) ? 1 : 0;\n\treturn 0;\n}\n\nstatic int snd_ac97_ymf753_spdif_output_pin_put(struct snd_kcontrol *kcontrol, struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_ac97 *ac97 = snd_kcontrol_chip(kcontrol);\n\tunsigned short val;\n\n\tif (ucontrol->value.enumerated.item[0] > 2)\n\t\treturn -EINVAL;\n\tval = (ucontrol->value.enumerated.item[0] == 2) ? 0x0008 :\n\t      (ucontrol->value.enumerated.item[0] == 1) ? 0x0020 : 0;\n\treturn snd_ac97_update_bits(ac97, AC97_YMF7X3_DIT_CTRL, 0x0028, val);\n\t \n}\n\nstatic const struct snd_kcontrol_new snd_ac97_ymf753_controls_spdif[3] = {\n\t{\n\t\t.iface\t= SNDRV_CTL_ELEM_IFACE_MIXER,\n\t\t.name\t= SNDRV_CTL_NAME_IEC958(\"\",PLAYBACK,NONE) \"Source\",\n\t\t.info\t= snd_ac97_ymf7x3_spdif_source_info,\n\t\t.get\t= snd_ac97_ymf7x3_spdif_source_get,\n\t\t.put\t= snd_ac97_ymf7x3_spdif_source_put,\n\t},\n\t{\n\t\t.iface\t= SNDRV_CTL_ELEM_IFACE_MIXER,\n\t\t.name\t= SNDRV_CTL_NAME_IEC958(\"\",PLAYBACK,NONE) \"Output Pin\",\n\t\t.info\t= snd_ac97_ymf753_spdif_output_pin_info,\n\t\t.get\t= snd_ac97_ymf753_spdif_output_pin_get,\n\t\t.put\t= snd_ac97_ymf753_spdif_output_pin_put,\n\t},\n\tAC97_SINGLE(SNDRV_CTL_NAME_IEC958(\"\", NONE, NONE) \"Mute\",\n\t\t    AC97_YMF7X3_DIT_CTRL, 2, 1, 1)\n};\n\nstatic int patch_yamaha_ymf753_post_spdif(struct snd_ac97 * ac97)\n{\n\tint err;\n\n\terr = patch_build_controls(ac97, snd_ac97_ymf753_controls_spdif, ARRAY_SIZE(snd_ac97_ymf753_controls_spdif));\n\tif (err < 0)\n\t\treturn err;\n\treturn 0;\n}\n\nstatic const struct snd_ac97_build_ops patch_yamaha_ymf753_ops = {\n\t.build_3d\t= patch_yamaha_ymf7x3_3d,\n\t.build_post_spdif = patch_yamaha_ymf753_post_spdif\n};\n\nstatic int patch_yamaha_ymf753(struct snd_ac97 * ac97)\n{\n\t \n\tac97->build_ops = &patch_yamaha_ymf753_ops;\n\tac97->caps |= AC97_BC_BASS_TREBLE;\n\tac97->caps |= 0x04 << 10;  \n\treturn 0;\n}\n\n \n\nstatic const struct snd_kcontrol_new wm97xx_snd_ac97_controls[] = {\nAC97_DOUBLE(\"Front Playback Volume\", AC97_WM97XX_FMIXER_VOL, 8, 0, 31, 1),\nAC97_SINGLE(\"Front Playback Switch\", AC97_WM97XX_FMIXER_VOL, 15, 1, 1),\n};\n\nstatic int patch_wolfson_wm9703_specific(struct snd_ac97 * ac97)\n{\n\t \n\tint err, i;\n\t\n\tfor (i = 0; i < ARRAY_SIZE(wm97xx_snd_ac97_controls); i++) {\n\t\terr = snd_ctl_add(ac97->bus->card, snd_ac97_cnew(&wm97xx_snd_ac97_controls[i], ac97));\n\t\tif (err < 0)\n\t\t\treturn err;\n\t}\n\tsnd_ac97_write_cache(ac97,  AC97_WM97XX_FMIXER_VOL, 0x0808);\n\treturn 0;\n}\n\nstatic const struct snd_ac97_build_ops patch_wolfson_wm9703_ops = {\n\t.build_specific = patch_wolfson_wm9703_specific,\n};\n\nstatic int patch_wolfson03(struct snd_ac97 * ac97)\n{\n\tac97->build_ops = &patch_wolfson_wm9703_ops;\n\treturn 0;\n}\n\nstatic const struct snd_kcontrol_new wm9704_snd_ac97_controls[] = {\nAC97_DOUBLE(\"Front Playback Volume\", AC97_WM97XX_FMIXER_VOL, 8, 0, 31, 1),\nAC97_SINGLE(\"Front Playback Switch\", AC97_WM97XX_FMIXER_VOL, 15, 1, 1),\nAC97_DOUBLE(\"Rear Playback Volume\", AC97_WM9704_RMIXER_VOL, 8, 0, 31, 1),\nAC97_SINGLE(\"Rear Playback Switch\", AC97_WM9704_RMIXER_VOL, 15, 1, 1),\nAC97_DOUBLE(\"Rear DAC Volume\", AC97_WM9704_RPCM_VOL, 8, 0, 31, 1),\nAC97_DOUBLE(\"Surround Volume\", AC97_SURROUND_MASTER, 8, 0, 31, 1),\n};\n\nstatic int patch_wolfson_wm9704_specific(struct snd_ac97 * ac97)\n{\n\tint err, i;\n\tfor (i = 0; i < ARRAY_SIZE(wm9704_snd_ac97_controls); i++) {\n\t\terr = snd_ctl_add(ac97->bus->card, snd_ac97_cnew(&wm9704_snd_ac97_controls[i], ac97));\n\t\tif (err < 0)\n\t\t\treturn err;\n\t}\n\t \n\tsnd_ac97_write_cache(ac97, AC97_WM9704_TEST, 0x0200);\n\treturn 0;\n}\n\nstatic const struct snd_ac97_build_ops patch_wolfson_wm9704_ops = {\n\t.build_specific = patch_wolfson_wm9704_specific,\n};\n\nstatic int patch_wolfson04(struct snd_ac97 * ac97)\n{\n\t \n\tac97->build_ops = &patch_wolfson_wm9704_ops;\n\treturn 0;\n}\n\nstatic int patch_wolfson05(struct snd_ac97 * ac97)\n{\n\t \n\tac97->build_ops = &patch_wolfson_wm9703_ops;\n#ifdef CONFIG_TOUCHSCREEN_WM9705\n\t \n\tac97->flags |= AC97_HAS_NO_VIDEO | AC97_HAS_NO_AUX;\n#endif\n\treturn 0;\n}\n\nstatic const char* wm9711_alc_select[] = {\"None\", \"Left\", \"Right\", \"Stereo\"};\nstatic const char* wm9711_alc_mix[] = {\"Stereo\", \"Right\", \"Left\", \"None\"};\nstatic const char* wm9711_out3_src[] = {\"Left\", \"VREF\", \"Left + Right\", \"Mono\"};\nstatic const char* wm9711_out3_lrsrc[] = {\"Master Mix\", \"Headphone Mix\"};\nstatic const char* wm9711_rec_adc[] = {\"Stereo\", \"Left\", \"Right\", \"Mute\"};\nstatic const char* wm9711_base[] = {\"Linear Control\", \"Adaptive Boost\"};\nstatic const char* wm9711_rec_gain[] = {\"+1.5dB Steps\", \"+0.75dB Steps\"};\nstatic const char* wm9711_mic[] = {\"Mic 1\", \"Differential\", \"Mic 2\", \"Stereo\"};\nstatic const char* wm9711_rec_sel[] = \n\t{\"Mic 1\", \"NC\", \"NC\", \"Master Mix\", \"Line\", \"Headphone Mix\", \"Phone Mix\", \"Phone\"};\nstatic const char* wm9711_ng_type[] = {\"Constant Gain\", \"Mute\"};\n\nstatic const struct ac97_enum wm9711_enum[] = {\nAC97_ENUM_SINGLE(AC97_PCI_SVID, 14, 4, wm9711_alc_select),\nAC97_ENUM_SINGLE(AC97_VIDEO, 10, 4, wm9711_alc_mix),\nAC97_ENUM_SINGLE(AC97_AUX, 9, 4, wm9711_out3_src),\nAC97_ENUM_SINGLE(AC97_AUX, 8, 2, wm9711_out3_lrsrc),\nAC97_ENUM_SINGLE(AC97_REC_SEL, 12, 4, wm9711_rec_adc),\nAC97_ENUM_SINGLE(AC97_MASTER_TONE, 15, 2, wm9711_base),\nAC97_ENUM_DOUBLE(AC97_REC_GAIN, 14, 6, 2, wm9711_rec_gain),\nAC97_ENUM_SINGLE(AC97_MIC, 5, 4, wm9711_mic),\nAC97_ENUM_DOUBLE(AC97_REC_SEL, 8, 0, 8, wm9711_rec_sel),\nAC97_ENUM_SINGLE(AC97_PCI_SVID, 5, 2, wm9711_ng_type),\n};\n\nstatic const struct snd_kcontrol_new wm9711_snd_ac97_controls[] = {\nAC97_SINGLE(\"ALC Target Volume\", AC97_CODEC_CLASS_REV, 12, 15, 0),\nAC97_SINGLE(\"ALC Hold Time\", AC97_CODEC_CLASS_REV, 8, 15, 0),\nAC97_SINGLE(\"ALC Decay Time\", AC97_CODEC_CLASS_REV, 4, 15, 0),\nAC97_SINGLE(\"ALC Attack Time\", AC97_CODEC_CLASS_REV, 0, 15, 0),\nAC97_ENUM(\"ALC Function\", wm9711_enum[0]),\nAC97_SINGLE(\"ALC Max Volume\", AC97_PCI_SVID, 11, 7, 1),\nAC97_SINGLE(\"ALC ZC Timeout\", AC97_PCI_SVID, 9, 3, 1),\nAC97_SINGLE(\"ALC ZC Switch\", AC97_PCI_SVID, 8, 1, 0),\nAC97_SINGLE(\"ALC NG Switch\", AC97_PCI_SVID, 7, 1, 0),\nAC97_ENUM(\"ALC NG Type\", wm9711_enum[9]),\nAC97_SINGLE(\"ALC NG Threshold\", AC97_PCI_SVID, 0, 31, 1),\n\nAC97_SINGLE(\"Side Tone Switch\", AC97_VIDEO, 15, 1, 1),\nAC97_SINGLE(\"Side Tone Volume\", AC97_VIDEO, 12, 7, 1),\nAC97_ENUM(\"ALC Headphone Mux\", wm9711_enum[1]),\nAC97_SINGLE(\"ALC Headphone Volume\", AC97_VIDEO, 7, 7, 1),\n\nAC97_SINGLE(\"Out3 Switch\", AC97_AUX, 15, 1, 1),\nAC97_SINGLE(\"Out3 ZC Switch\", AC97_AUX, 7, 1, 0),\nAC97_ENUM(\"Out3 Mux\", wm9711_enum[2]),\nAC97_ENUM(\"Out3 LR Mux\", wm9711_enum[3]),\nAC97_SINGLE(\"Out3 Volume\", AC97_AUX, 0, 31, 1),\n\nAC97_SINGLE(\"Beep to Headphone Switch\", AC97_PC_BEEP, 15, 1, 1),\nAC97_SINGLE(\"Beep to Headphone Volume\", AC97_PC_BEEP, 12, 7, 1),\nAC97_SINGLE(\"Beep to Side Tone Switch\", AC97_PC_BEEP, 11, 1, 1),\nAC97_SINGLE(\"Beep to Side Tone Volume\", AC97_PC_BEEP, 8, 7, 1),\nAC97_SINGLE(\"Beep to Phone Switch\", AC97_PC_BEEP, 7, 1, 1),\nAC97_SINGLE(\"Beep to Phone Volume\", AC97_PC_BEEP, 4, 7, 1),\n\nAC97_SINGLE(\"Aux to Headphone Switch\", AC97_CD, 15, 1, 1),\nAC97_SINGLE(\"Aux to Headphone Volume\", AC97_CD, 12, 7, 1),\nAC97_SINGLE(\"Aux to Side Tone Switch\", AC97_CD, 11, 1, 1),\nAC97_SINGLE(\"Aux to Side Tone Volume\", AC97_CD, 8, 7, 1),\nAC97_SINGLE(\"Aux to Phone Switch\", AC97_CD, 7, 1, 1),\nAC97_SINGLE(\"Aux to Phone Volume\", AC97_CD, 4, 7, 1),\n\nAC97_SINGLE(\"Phone to Headphone Switch\", AC97_PHONE, 15, 1, 1),\nAC97_SINGLE(\"Phone to Master Switch\", AC97_PHONE, 14, 1, 1),\n\nAC97_SINGLE(\"Line to Headphone Switch\", AC97_LINE, 15, 1, 1),\nAC97_SINGLE(\"Line to Master Switch\", AC97_LINE, 14, 1, 1),\nAC97_SINGLE(\"Line to Phone Switch\", AC97_LINE, 13, 1, 1),\n\nAC97_SINGLE(\"PCM Playback to Headphone Switch\", AC97_PCM, 15, 1, 1),\nAC97_SINGLE(\"PCM Playback to Master Switch\", AC97_PCM, 14, 1, 1),\nAC97_SINGLE(\"PCM Playback to Phone Switch\", AC97_PCM, 13, 1, 1),\n\nAC97_SINGLE(\"Capture 20dB Boost Switch\", AC97_REC_SEL, 14, 1, 0),\nAC97_ENUM(\"Capture to Phone Mux\", wm9711_enum[4]),\nAC97_SINGLE(\"Capture to Phone 20dB Boost Switch\", AC97_REC_SEL, 11, 1, 1),\nAC97_ENUM(\"Capture Select\", wm9711_enum[8]),\n\nAC97_SINGLE(\"3D Upper Cut-off Switch\", AC97_3D_CONTROL, 5, 1, 1),\nAC97_SINGLE(\"3D Lower Cut-off Switch\", AC97_3D_CONTROL, 4, 1, 1),\n\nAC97_ENUM(\"Bass Control\", wm9711_enum[5]),\nAC97_SINGLE(\"Bass Cut-off Switch\", AC97_MASTER_TONE, 12, 1, 1),\nAC97_SINGLE(\"Tone Cut-off Switch\", AC97_MASTER_TONE, 4, 1, 1),\nAC97_SINGLE(\"Playback Attenuate (-6dB) Switch\", AC97_MASTER_TONE, 6, 1, 0),\n\nAC97_SINGLE(\"ADC Switch\", AC97_REC_GAIN, 15, 1, 1),\nAC97_ENUM(\"Capture Volume Steps\", wm9711_enum[6]),\nAC97_DOUBLE(\"Capture Volume\", AC97_REC_GAIN, 8, 0, 63, 1),\nAC97_SINGLE(\"Capture ZC Switch\", AC97_REC_GAIN, 7, 1, 0),\n\nAC97_SINGLE(\"Mic 1 to Phone Switch\", AC97_MIC, 14, 1, 1),\nAC97_SINGLE(\"Mic 2 to Phone Switch\", AC97_MIC, 13, 1, 1),\nAC97_ENUM(\"Mic Select Source\", wm9711_enum[7]),\nAC97_SINGLE(\"Mic 1 Volume\", AC97_MIC, 8, 31, 1),\nAC97_SINGLE(\"Mic 2 Volume\", AC97_MIC, 0, 31, 1),\nAC97_SINGLE(\"Mic 20dB Boost Switch\", AC97_MIC, 7, 1, 0),\n\nAC97_SINGLE(\"Master Left Inv Switch\", AC97_MASTER, 6, 1, 0),\nAC97_SINGLE(\"Master ZC Switch\", AC97_MASTER, 7, 1, 0),\nAC97_SINGLE(\"Headphone ZC Switch\", AC97_HEADPHONE, 7, 1, 0),\nAC97_SINGLE(\"Mono ZC Switch\", AC97_MASTER_MONO, 7, 1, 0),\n};\n\nstatic int patch_wolfson_wm9711_specific(struct snd_ac97 * ac97)\n{\n\tint err, i;\n\t\n\tfor (i = 0; i < ARRAY_SIZE(wm9711_snd_ac97_controls); i++) {\n\t\terr = snd_ctl_add(ac97->bus->card, snd_ac97_cnew(&wm9711_snd_ac97_controls[i], ac97));\n\t\tif (err < 0)\n\t\t\treturn err;\n\t}\n\tsnd_ac97_write_cache(ac97,  AC97_CODEC_CLASS_REV, 0x0808);\n\tsnd_ac97_write_cache(ac97,  AC97_PCI_SVID, 0x0808);\n\tsnd_ac97_write_cache(ac97,  AC97_VIDEO, 0x0808);\n\tsnd_ac97_write_cache(ac97,  AC97_AUX, 0x0808);\n\tsnd_ac97_write_cache(ac97,  AC97_PC_BEEP, 0x0808);\n\tsnd_ac97_write_cache(ac97,  AC97_CD, 0x0000);\n\treturn 0;\n}\n\nstatic const struct snd_ac97_build_ops patch_wolfson_wm9711_ops = {\n\t.build_specific = patch_wolfson_wm9711_specific,\n};\n\nstatic int patch_wolfson11(struct snd_ac97 * ac97)\n{\n\t \n\tac97->build_ops = &patch_wolfson_wm9711_ops;\n\n\tac97->flags |= AC97_HAS_NO_REC_GAIN | AC97_STEREO_MUTES | AC97_HAS_NO_MIC |\n\t\tAC97_HAS_NO_PC_BEEP | AC97_HAS_NO_VIDEO | AC97_HAS_NO_CD;\n\t\n\treturn 0;\n}\n\nstatic const char* wm9713_mic_mixer[] = {\"Stereo\", \"Mic 1\", \"Mic 2\", \"Mute\"};\nstatic const char* wm9713_rec_mux[] = {\"Stereo\", \"Left\", \"Right\", \"Mute\"};\nstatic const char* wm9713_rec_src[] = \n\t{\"Mic 1\", \"Mic 2\", \"Line\", \"Mono In\", \"Headphone Mix\", \"Master Mix\", \n\t\"Mono Mix\", \"Zh\"};\nstatic const char* wm9713_rec_gain[] = {\"+1.5dB Steps\", \"+0.75dB Steps\"};\nstatic const char* wm9713_alc_select[] = {\"None\", \"Left\", \"Right\", \"Stereo\"};\nstatic const char* wm9713_mono_pga[] = {\"Vmid\", \"Zh\", \"Mono Mix\", \"Inv 1\"};\nstatic const char* wm9713_spk_pga[] = \n\t{\"Vmid\", \"Zh\", \"Headphone Mix\", \"Master Mix\", \"Inv\", \"NC\", \"NC\", \"NC\"};\nstatic const char* wm9713_hp_pga[] = {\"Vmid\", \"Zh\", \"Headphone Mix\", \"NC\"};\nstatic const char* wm9713_out3_pga[] = {\"Vmid\", \"Zh\", \"Inv 1\", \"NC\"};\nstatic const char* wm9713_out4_pga[] = {\"Vmid\", \"Zh\", \"Inv 2\", \"NC\"};\nstatic const char* wm9713_dac_inv[] = \n\t{\"Off\", \"Mono Mix\", \"Master Mix\", \"Headphone Mix L\", \"Headphone Mix R\", \n\t\"Headphone Mix Mono\", \"NC\", \"Vmid\"};\nstatic const char* wm9713_base[] = {\"Linear Control\", \"Adaptive Boost\"};\nstatic const char* wm9713_ng_type[] = {\"Constant Gain\", \"Mute\"};\n\nstatic const struct ac97_enum wm9713_enum[] = {\nAC97_ENUM_SINGLE(AC97_LINE, 3, 4, wm9713_mic_mixer),\nAC97_ENUM_SINGLE(AC97_VIDEO, 14, 4, wm9713_rec_mux),\nAC97_ENUM_SINGLE(AC97_VIDEO, 9, 4, wm9713_rec_mux),\nAC97_ENUM_DOUBLE(AC97_VIDEO, 3, 0, 8, wm9713_rec_src),\nAC97_ENUM_DOUBLE(AC97_CD, 14, 6, 2, wm9713_rec_gain),\nAC97_ENUM_SINGLE(AC97_PCI_SVID, 14, 4, wm9713_alc_select),\nAC97_ENUM_SINGLE(AC97_REC_GAIN, 14, 4, wm9713_mono_pga),\nAC97_ENUM_DOUBLE(AC97_REC_GAIN, 11, 8, 8, wm9713_spk_pga),\nAC97_ENUM_DOUBLE(AC97_REC_GAIN, 6, 4, 4, wm9713_hp_pga),\nAC97_ENUM_SINGLE(AC97_REC_GAIN, 2, 4, wm9713_out3_pga),\nAC97_ENUM_SINGLE(AC97_REC_GAIN, 0, 4, wm9713_out4_pga),\nAC97_ENUM_DOUBLE(AC97_REC_GAIN_MIC, 13, 10, 8, wm9713_dac_inv),\nAC97_ENUM_SINGLE(AC97_GENERAL_PURPOSE, 15, 2, wm9713_base),\nAC97_ENUM_SINGLE(AC97_PCI_SVID, 5, 2, wm9713_ng_type),\n};\n\nstatic const struct snd_kcontrol_new wm13_snd_ac97_controls[] = {\nAC97_DOUBLE(\"Line In Volume\", AC97_PC_BEEP, 8, 0, 31, 1),\nAC97_SINGLE(\"Line In to Headphone Switch\", AC97_PC_BEEP, 15, 1, 1),\nAC97_SINGLE(\"Line In to Master Switch\", AC97_PC_BEEP, 14, 1, 1),\nAC97_SINGLE(\"Line In to Mono Switch\", AC97_PC_BEEP, 13, 1, 1),\n\nAC97_DOUBLE(\"PCM Playback Volume\", AC97_PHONE, 8, 0, 31, 1),\nAC97_SINGLE(\"PCM Playback to Headphone Switch\", AC97_PHONE, 15, 1, 1),\nAC97_SINGLE(\"PCM Playback to Master Switch\", AC97_PHONE, 14, 1, 1),\nAC97_SINGLE(\"PCM Playback to Mono Switch\", AC97_PHONE, 13, 1, 1),\n\nAC97_SINGLE(\"Mic 1 Volume\", AC97_MIC, 8, 31, 1),\nAC97_SINGLE(\"Mic 2 Volume\", AC97_MIC, 0, 31, 1),\nAC97_SINGLE(\"Mic 1 to Mono Switch\", AC97_LINE, 7, 1, 1),\nAC97_SINGLE(\"Mic 2 to Mono Switch\", AC97_LINE, 6, 1, 1),\nAC97_SINGLE(\"Mic Boost (+20dB) Switch\", AC97_LINE, 5, 1, 0),\nAC97_ENUM(\"Mic to Headphone Mux\", wm9713_enum[0]),\nAC97_SINGLE(\"Mic Headphone Mixer Volume\", AC97_LINE, 0, 7, 1),\n\nAC97_SINGLE(\"Capture Switch\", AC97_CD, 15, 1, 1),\nAC97_ENUM(\"Capture Volume Steps\", wm9713_enum[4]),\nAC97_DOUBLE(\"Capture Volume\", AC97_CD, 8, 0, 15, 0),\nAC97_SINGLE(\"Capture ZC Switch\", AC97_CD, 7, 1, 0),\n\nAC97_ENUM(\"Capture to Headphone Mux\", wm9713_enum[1]),\nAC97_SINGLE(\"Capture to Headphone Volume\", AC97_VIDEO, 11, 7, 1),\nAC97_ENUM(\"Capture to Mono Mux\", wm9713_enum[2]),\nAC97_SINGLE(\"Capture to Mono Boost (+20dB) Switch\", AC97_VIDEO, 8, 1, 0),\nAC97_SINGLE(\"Capture ADC Boost (+20dB) Switch\", AC97_VIDEO, 6, 1, 0),\nAC97_ENUM(\"Capture Select\", wm9713_enum[3]),\n\nAC97_SINGLE(\"ALC Target Volume\", AC97_CODEC_CLASS_REV, 12, 15, 0),\nAC97_SINGLE(\"ALC Hold Time\", AC97_CODEC_CLASS_REV, 8, 15, 0),\nAC97_SINGLE(\"ALC Decay Time \", AC97_CODEC_CLASS_REV, 4, 15, 0),\nAC97_SINGLE(\"ALC Attack Time\", AC97_CODEC_CLASS_REV, 0, 15, 0),\nAC97_ENUM(\"ALC Function\", wm9713_enum[5]),\nAC97_SINGLE(\"ALC Max Volume\", AC97_PCI_SVID, 11, 7, 0),\nAC97_SINGLE(\"ALC ZC Timeout\", AC97_PCI_SVID, 9, 3, 0),\nAC97_SINGLE(\"ALC ZC Switch\", AC97_PCI_SVID, 8, 1, 0),\nAC97_SINGLE(\"ALC NG Switch\", AC97_PCI_SVID, 7, 1, 0),\nAC97_ENUM(\"ALC NG Type\", wm9713_enum[13]),\nAC97_SINGLE(\"ALC NG Threshold\", AC97_PCI_SVID, 0, 31, 0),\n\nAC97_DOUBLE(\"Master ZC Switch\", AC97_MASTER, 14, 6, 1, 0),\nAC97_DOUBLE(\"Headphone ZC Switch\", AC97_HEADPHONE, 14, 6, 1, 0),\nAC97_DOUBLE(\"Out3/4 ZC Switch\", AC97_MASTER_MONO, 14, 6, 1, 0),\nAC97_SINGLE(\"Master Right Switch\", AC97_MASTER, 7, 1, 1),\nAC97_SINGLE(\"Headphone Right Switch\", AC97_HEADPHONE, 7, 1, 1),\nAC97_SINGLE(\"Out3/4 Right Switch\", AC97_MASTER_MONO, 7, 1, 1),\n\nAC97_SINGLE(\"Mono In to Headphone Switch\", AC97_MASTER_TONE, 15, 1, 1),\nAC97_SINGLE(\"Mono In to Master Switch\", AC97_MASTER_TONE, 14, 1, 1),\nAC97_SINGLE(\"Mono In Volume\", AC97_MASTER_TONE, 8, 31, 1),\nAC97_SINGLE(\"Mono Switch\", AC97_MASTER_TONE, 7, 1, 1),\nAC97_SINGLE(\"Mono ZC Switch\", AC97_MASTER_TONE, 6, 1, 0),\nAC97_SINGLE(\"Mono Volume\", AC97_MASTER_TONE, 0, 31, 1),\n\nAC97_SINGLE(\"Beep to Headphone Switch\", AC97_AUX, 15, 1, 1),\nAC97_SINGLE(\"Beep to Headphone Volume\", AC97_AUX, 12, 7, 1),\nAC97_SINGLE(\"Beep to Master Switch\", AC97_AUX, 11, 1, 1),\nAC97_SINGLE(\"Beep to Master Volume\", AC97_AUX, 8, 7, 1),\nAC97_SINGLE(\"Beep to Mono Switch\", AC97_AUX, 7, 1, 1),\nAC97_SINGLE(\"Beep to Mono Volume\", AC97_AUX, 4, 7, 1),\n\nAC97_SINGLE(\"Voice to Headphone Switch\", AC97_PCM, 15, 1, 1),\nAC97_SINGLE(\"Voice to Headphone Volume\", AC97_PCM, 12, 7, 1),\nAC97_SINGLE(\"Voice to Master Switch\", AC97_PCM, 11, 1, 1),\nAC97_SINGLE(\"Voice to Master Volume\", AC97_PCM, 8, 7, 1),\nAC97_SINGLE(\"Voice to Mono Switch\", AC97_PCM, 7, 1, 1),\nAC97_SINGLE(\"Voice to Mono Volume\", AC97_PCM, 4, 7, 1),\n\nAC97_SINGLE(\"Aux to Headphone Switch\", AC97_REC_SEL, 15, 1, 1),\nAC97_SINGLE(\"Aux to Headphone Volume\", AC97_REC_SEL, 12, 7, 1),\nAC97_SINGLE(\"Aux to Master Switch\", AC97_REC_SEL, 11, 1, 1),\nAC97_SINGLE(\"Aux to Master Volume\", AC97_REC_SEL, 8, 7, 1),\nAC97_SINGLE(\"Aux to Mono Switch\", AC97_REC_SEL, 7, 1, 1),\nAC97_SINGLE(\"Aux to Mono Volume\", AC97_REC_SEL, 4, 7, 1),\n\nAC97_ENUM(\"Mono Input Mux\", wm9713_enum[6]),\nAC97_ENUM(\"Master Input Mux\", wm9713_enum[7]),\nAC97_ENUM(\"Headphone Input Mux\", wm9713_enum[8]),\nAC97_ENUM(\"Out 3 Input Mux\", wm9713_enum[9]),\nAC97_ENUM(\"Out 4 Input Mux\", wm9713_enum[10]),\n\nAC97_ENUM(\"Bass Control\", wm9713_enum[12]),\nAC97_SINGLE(\"Bass Cut-off Switch\", AC97_GENERAL_PURPOSE, 12, 1, 1),\nAC97_SINGLE(\"Tone Cut-off Switch\", AC97_GENERAL_PURPOSE, 4, 1, 1),\nAC97_SINGLE(\"Playback Attenuate (-6dB) Switch\", AC97_GENERAL_PURPOSE, 6, 1, 0),\nAC97_SINGLE(\"Bass Volume\", AC97_GENERAL_PURPOSE, 8, 15, 1),\nAC97_SINGLE(\"Tone Volume\", AC97_GENERAL_PURPOSE, 0, 15, 1),\n};\n\nstatic const struct snd_kcontrol_new wm13_snd_ac97_controls_3d[] = {\nAC97_ENUM(\"Inv Input Mux\", wm9713_enum[11]),\nAC97_SINGLE(\"3D Upper Cut-off Switch\", AC97_REC_GAIN_MIC, 5, 1, 0),\nAC97_SINGLE(\"3D Lower Cut-off Switch\", AC97_REC_GAIN_MIC, 4, 1, 0),\nAC97_SINGLE(\"3D Depth\", AC97_REC_GAIN_MIC, 0, 15, 1),\n};\n\nstatic int patch_wolfson_wm9713_3d (struct snd_ac97 * ac97)\n{\n\tint err, i;\n    \n\tfor (i = 0; i < ARRAY_SIZE(wm13_snd_ac97_controls_3d); i++) {\n\t\terr = snd_ctl_add(ac97->bus->card, snd_ac97_cnew(&wm13_snd_ac97_controls_3d[i], ac97));\n\t\tif (err < 0)\n\t\t\treturn err;\n\t}\n\treturn 0;\n}\n\nstatic int patch_wolfson_wm9713_specific(struct snd_ac97 * ac97)\n{\n\tint err, i;\n\t\n\tfor (i = 0; i < ARRAY_SIZE(wm13_snd_ac97_controls); i++) {\n\t\terr = snd_ctl_add(ac97->bus->card, snd_ac97_cnew(&wm13_snd_ac97_controls[i], ac97));\n\t\tif (err < 0)\n\t\t\treturn err;\n\t}\n\tsnd_ac97_write_cache(ac97, AC97_PC_BEEP, 0x0808);\n\tsnd_ac97_write_cache(ac97, AC97_PHONE, 0x0808);\n\tsnd_ac97_write_cache(ac97, AC97_MIC, 0x0808);\n\tsnd_ac97_write_cache(ac97, AC97_LINE, 0x00da);\n\tsnd_ac97_write_cache(ac97, AC97_CD, 0x0808);\n\tsnd_ac97_write_cache(ac97, AC97_VIDEO, 0xd612);\n\tsnd_ac97_write_cache(ac97, AC97_REC_GAIN, 0x1ba0);\n\treturn 0;\n}\n\n#ifdef CONFIG_PM\nstatic void patch_wolfson_wm9713_suspend (struct snd_ac97 * ac97)\n{\n\tsnd_ac97_write_cache(ac97, AC97_EXTENDED_MID, 0xfeff);\n\tsnd_ac97_write_cache(ac97, AC97_EXTENDED_MSTATUS, 0xffff);\n}\n\nstatic void patch_wolfson_wm9713_resume (struct snd_ac97 * ac97)\n{\n\tsnd_ac97_write_cache(ac97, AC97_EXTENDED_MID, 0xda00);\n\tsnd_ac97_write_cache(ac97, AC97_EXTENDED_MSTATUS, 0x3810);\n\tsnd_ac97_write_cache(ac97, AC97_POWERDOWN, 0x0);\n}\n#endif\n\nstatic const struct snd_ac97_build_ops patch_wolfson_wm9713_ops = {\n\t.build_specific = patch_wolfson_wm9713_specific,\n\t.build_3d = patch_wolfson_wm9713_3d,\n#ifdef CONFIG_PM\t\n\t.suspend = patch_wolfson_wm9713_suspend,\n\t.resume = patch_wolfson_wm9713_resume\n#endif\n};\n\nstatic int patch_wolfson13(struct snd_ac97 * ac97)\n{\n\t \n\tac97->build_ops = &patch_wolfson_wm9713_ops;\n\n\tac97->flags |= AC97_HAS_NO_REC_GAIN | AC97_STEREO_MUTES | AC97_HAS_NO_PHONE |\n\t\tAC97_HAS_NO_PC_BEEP | AC97_HAS_NO_VIDEO | AC97_HAS_NO_CD | AC97_HAS_NO_TONE |\n\t\tAC97_HAS_NO_STD_PCM;\n    \tac97->scaps &= ~AC97_SCAP_MODEM;\n\n\tsnd_ac97_write_cache(ac97, AC97_EXTENDED_MID, 0xda00);\n\tsnd_ac97_write_cache(ac97, AC97_EXTENDED_MSTATUS, 0x3810);\n\tsnd_ac97_write_cache(ac97, AC97_POWERDOWN, 0x0);\n\n\treturn 0;\n}\n\n \nstatic int patch_tritech_tr28028(struct snd_ac97 * ac97)\n{\n\tsnd_ac97_write_cache(ac97, 0x26, 0x0300);\n\tsnd_ac97_write_cache(ac97, 0x26, 0x0000);\n\tsnd_ac97_write_cache(ac97, AC97_SURROUND_MASTER, 0x0000);\n\tsnd_ac97_write_cache(ac97, AC97_SPDIF, 0x0000);\n\treturn 0;\n}\n\n \nstatic int patch_sigmatel_stac9700_3d(struct snd_ac97 * ac97)\n{\n\tstruct snd_kcontrol *kctl;\n\tint err;\n\n\terr = snd_ctl_add(ac97->bus->card, kctl = snd_ac97_cnew(&snd_ac97_controls_3d[0], ac97));\n\tif (err < 0)\n\t\treturn err;\n\tstrcpy(kctl->id.name, \"3D Control Sigmatel - Depth\");\n\tkctl->private_value = AC97_SINGLE_VALUE(AC97_3D_CONTROL, 2, 3, 0);\n\tsnd_ac97_write_cache(ac97, AC97_3D_CONTROL, 0x0000);\n\treturn 0;\n}\n\nstatic int patch_sigmatel_stac9708_3d(struct snd_ac97 * ac97)\n{\n\tstruct snd_kcontrol *kctl;\n\tint err;\n\n\tkctl = snd_ac97_cnew(&snd_ac97_controls_3d[0], ac97);\n\terr = snd_ctl_add(ac97->bus->card, kctl);\n\tif (err < 0)\n\t\treturn err;\n\tstrcpy(kctl->id.name, \"3D Control Sigmatel - Depth\");\n\tkctl->private_value = AC97_SINGLE_VALUE(AC97_3D_CONTROL, 0, 3, 0);\n\tkctl = snd_ac97_cnew(&snd_ac97_controls_3d[0], ac97);\n\terr = snd_ctl_add(ac97->bus->card, kctl);\n\tif (err < 0)\n\t\treturn err;\n\tstrcpy(kctl->id.name, \"3D Control Sigmatel - Rear Depth\");\n\tkctl->private_value = AC97_SINGLE_VALUE(AC97_3D_CONTROL, 2, 3, 0);\n\tsnd_ac97_write_cache(ac97, AC97_3D_CONTROL, 0x0000);\n\treturn 0;\n}\n\nstatic const struct snd_kcontrol_new snd_ac97_sigmatel_4speaker =\nAC97_SINGLE(\"Sigmatel 4-Speaker Stereo Playback Switch\",\n\t\tAC97_SIGMATEL_DAC2INVERT, 2, 1, 0);\n\n \nstatic const struct snd_kcontrol_new snd_ac97_sigmatel_phaseinvert =\nAC97_SINGLE(\"Surround Phase Inversion Playback Switch\",\n\t\tAC97_SIGMATEL_DAC2INVERT, 3, 1, 0);\n\nstatic const struct snd_kcontrol_new snd_ac97_sigmatel_controls[] = {\nAC97_SINGLE(\"Sigmatel DAC 6dB Attenuate\", AC97_SIGMATEL_ANALOG, 1, 1, 0),\nAC97_SINGLE(\"Sigmatel ADC 6dB Attenuate\", AC97_SIGMATEL_ANALOG, 0, 1, 0)\n};\n\nstatic int patch_sigmatel_stac97xx_specific(struct snd_ac97 * ac97)\n{\n\tint err;\n\n\tsnd_ac97_write_cache(ac97, AC97_SIGMATEL_ANALOG, snd_ac97_read(ac97, AC97_SIGMATEL_ANALOG) & ~0x0003);\n\tif (snd_ac97_try_bit(ac97, AC97_SIGMATEL_ANALOG, 1)) {\n\t\terr = patch_build_controls(ac97, &snd_ac97_sigmatel_controls[0], 1);\n\t\tif (err < 0)\n\t\t\treturn err;\n\t}\n\tif (snd_ac97_try_bit(ac97, AC97_SIGMATEL_ANALOG, 0)) {\n\t\terr = patch_build_controls(ac97, &snd_ac97_sigmatel_controls[1], 1);\n\t\tif (err < 0)\n\t\t\treturn err;\n\t}\n\tif (snd_ac97_try_bit(ac97, AC97_SIGMATEL_DAC2INVERT, 2)) {\n\t\terr = patch_build_controls(ac97, &snd_ac97_sigmatel_4speaker, 1);\n\t\tif (err < 0)\n\t\t\treturn err;\n\t}\n\tif (snd_ac97_try_bit(ac97, AC97_SIGMATEL_DAC2INVERT, 3)) {\n\t\terr = patch_build_controls(ac97, &snd_ac97_sigmatel_phaseinvert, 1);\n\t\tif (err < 0)\n\t\t\treturn err;\n\t}\n\treturn 0;\n}\n\nstatic const struct snd_ac97_build_ops patch_sigmatel_stac9700_ops = {\n\t.build_3d\t= patch_sigmatel_stac9700_3d,\n\t.build_specific\t= patch_sigmatel_stac97xx_specific\n};\n\nstatic int patch_sigmatel_stac9700(struct snd_ac97 * ac97)\n{\n\tac97->build_ops = &patch_sigmatel_stac9700_ops;\n\treturn 0;\n}\n\nstatic int snd_ac97_stac9708_put_bias(struct snd_kcontrol *kcontrol, struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_ac97 *ac97 = snd_kcontrol_chip(kcontrol);\n\tint err;\n\n\tmutex_lock(&ac97->page_mutex);\n\tsnd_ac97_write(ac97, AC97_SIGMATEL_BIAS1, 0xabba);\n\terr = snd_ac97_update_bits(ac97, AC97_SIGMATEL_BIAS2, 0x0010,\n\t\t\t\t   (ucontrol->value.integer.value[0] & 1) << 4);\n\tsnd_ac97_write(ac97, AC97_SIGMATEL_BIAS1, 0);\n\tmutex_unlock(&ac97->page_mutex);\n\treturn err;\n}\n\nstatic const struct snd_kcontrol_new snd_ac97_stac9708_bias_control = {\n\t.iface = SNDRV_CTL_ELEM_IFACE_MIXER,\n\t.name = \"Sigmatel Output Bias Switch\",\n\t.info = snd_ac97_info_volsw,\n\t.get = snd_ac97_get_volsw,\n\t.put = snd_ac97_stac9708_put_bias,\n\t.private_value = AC97_SINGLE_VALUE(AC97_SIGMATEL_BIAS2, 4, 1, 0),\n};\n\nstatic int patch_sigmatel_stac9708_specific(struct snd_ac97 *ac97)\n{\n\tint err;\n\n\t \n\tsnd_ac97_remove_ctl(ac97, \"PCM Out Path & Mute\", NULL);\n\n\tsnd_ac97_rename_vol_ctl(ac97, \"Headphone Playback\", \"Sigmatel Surround Playback\");\n\terr = patch_build_controls(ac97, &snd_ac97_stac9708_bias_control, 1);\n\tif (err < 0)\n\t\treturn err;\n\treturn patch_sigmatel_stac97xx_specific(ac97);\n}\n\nstatic const struct snd_ac97_build_ops patch_sigmatel_stac9708_ops = {\n\t.build_3d\t= patch_sigmatel_stac9708_3d,\n\t.build_specific\t= patch_sigmatel_stac9708_specific\n};\n\nstatic int patch_sigmatel_stac9708(struct snd_ac97 * ac97)\n{\n\tunsigned int codec72, codec6c;\n\n\tac97->build_ops = &patch_sigmatel_stac9708_ops;\n\tac97->caps |= 0x10;\t \n\n\tcodec72 = snd_ac97_read(ac97, AC97_SIGMATEL_BIAS2) & 0x8000;\n\tcodec6c = snd_ac97_read(ac97, AC97_SIGMATEL_ANALOG);\n\n\tif ((codec72==0) && (codec6c==0)) {\n\t\tsnd_ac97_write_cache(ac97, AC97_SIGMATEL_CIC1, 0xabba);\n\t\tsnd_ac97_write_cache(ac97, AC97_SIGMATEL_CIC2, 0x1000);\n\t\tsnd_ac97_write_cache(ac97, AC97_SIGMATEL_BIAS1, 0xabba);\n\t\tsnd_ac97_write_cache(ac97, AC97_SIGMATEL_BIAS2, 0x0007);\n\t} else if ((codec72==0x8000) && (codec6c==0)) {\n\t\tsnd_ac97_write_cache(ac97, AC97_SIGMATEL_CIC1, 0xabba);\n\t\tsnd_ac97_write_cache(ac97, AC97_SIGMATEL_CIC2, 0x1001);\n\t\tsnd_ac97_write_cache(ac97, AC97_SIGMATEL_DAC2INVERT, 0x0008);\n\t} else if ((codec72==0x8000) && (codec6c==0x0080)) {\n\t\t \n\t}\n\tsnd_ac97_write_cache(ac97, AC97_SIGMATEL_MULTICHN, 0x0000);\n\treturn 0;\n}\n\nstatic int patch_sigmatel_stac9721(struct snd_ac97 * ac97)\n{\n\tac97->build_ops = &patch_sigmatel_stac9700_ops;\n\tif (snd_ac97_read(ac97, AC97_SIGMATEL_ANALOG) == 0) {\n\t\t\n\t\tsnd_ac97_write_cache(ac97, AC97_SIGMATEL_CIC1, 0xabba);\n\t\tsnd_ac97_write_cache(ac97, AC97_SIGMATEL_CIC2, 0x4000);\n\t\tsnd_ac97_write_cache(ac97, AC97_SIGMATEL_BIAS1, 0xabba);\n\t\tsnd_ac97_write_cache(ac97, AC97_SIGMATEL_BIAS2, 0x0002);\n\t}\n\tsnd_ac97_write_cache(ac97, AC97_SIGMATEL_MULTICHN, 0x0000);\n\treturn 0;\n}\n\nstatic int patch_sigmatel_stac9744(struct snd_ac97 * ac97)\n{\n\t\n\tac97->build_ops = &patch_sigmatel_stac9700_ops;\n\tsnd_ac97_write_cache(ac97, AC97_SIGMATEL_CIC1, 0xabba);\n\tsnd_ac97_write_cache(ac97, AC97_SIGMATEL_CIC2, 0x0000);\t \n\tsnd_ac97_write_cache(ac97, AC97_SIGMATEL_BIAS1, 0xabba);\n\tsnd_ac97_write_cache(ac97, AC97_SIGMATEL_BIAS2, 0x0002);\n\tsnd_ac97_write_cache(ac97, AC97_SIGMATEL_MULTICHN, 0x0000);\n\treturn 0;\n}\n\nstatic int patch_sigmatel_stac9756(struct snd_ac97 * ac97)\n{\n\t\n\tac97->build_ops = &patch_sigmatel_stac9700_ops;\n\tsnd_ac97_write_cache(ac97, AC97_SIGMATEL_CIC1, 0xabba);\n\tsnd_ac97_write_cache(ac97, AC97_SIGMATEL_CIC2, 0x0000);\t \n\tsnd_ac97_write_cache(ac97, AC97_SIGMATEL_BIAS1, 0xabba);\n\tsnd_ac97_write_cache(ac97, AC97_SIGMATEL_BIAS2, 0x0002);\n\tsnd_ac97_write_cache(ac97, AC97_SIGMATEL_MULTICHN, 0x0000);\n\treturn 0;\n}\n\nstatic int snd_ac97_stac9758_output_jack_info(struct snd_kcontrol *kcontrol, struct snd_ctl_elem_info *uinfo)\n{\n\tstatic const char * const texts[5] = {\n\t\t\"Input/Disabled\", \"Front Output\",\n\t\t\"Rear Output\", \"Center/LFE Output\", \"Mixer Output\" };\n\n\treturn snd_ctl_enum_info(uinfo, 1, 5, texts);\n}\n\nstatic int snd_ac97_stac9758_output_jack_get(struct snd_kcontrol *kcontrol, struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_ac97 *ac97 = snd_kcontrol_chip(kcontrol);\n\tint shift = kcontrol->private_value;\n\tunsigned short val;\n\n\tval = ac97->regs[AC97_SIGMATEL_OUTSEL] >> shift;\n\tif (!(val & 4))\n\t\tucontrol->value.enumerated.item[0] = 0;\n\telse\n\t\tucontrol->value.enumerated.item[0] = 1 + (val & 3);\n\treturn 0;\n}\n\nstatic int snd_ac97_stac9758_output_jack_put(struct snd_kcontrol *kcontrol, struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_ac97 *ac97 = snd_kcontrol_chip(kcontrol);\n\tint shift = kcontrol->private_value;\n\tunsigned short val;\n\n\tif (ucontrol->value.enumerated.item[0] > 4)\n\t\treturn -EINVAL;\n\tif (ucontrol->value.enumerated.item[0] == 0)\n\t\tval = 0;\n\telse\n\t\tval = 4 | (ucontrol->value.enumerated.item[0] - 1);\n\treturn ac97_update_bits_page(ac97, AC97_SIGMATEL_OUTSEL,\n\t\t\t\t     7 << shift, val << shift, 0);\n}\n\nstatic int snd_ac97_stac9758_input_jack_info(struct snd_kcontrol *kcontrol, struct snd_ctl_elem_info *uinfo)\n{\n\tstatic const char * const texts[7] = {\n\t\t\"Mic2 Jack\", \"Mic1 Jack\", \"Line In Jack\",\n\t\t\"Front Jack\", \"Rear Jack\", \"Center/LFE Jack\", \"Mute\" };\n\n\treturn snd_ctl_enum_info(uinfo, 1, 7, texts);\n}\n\nstatic int snd_ac97_stac9758_input_jack_get(struct snd_kcontrol *kcontrol, struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_ac97 *ac97 = snd_kcontrol_chip(kcontrol);\n\tint shift = kcontrol->private_value;\n\tunsigned short val;\n\n\tval = ac97->regs[AC97_SIGMATEL_INSEL];\n\tucontrol->value.enumerated.item[0] = (val >> shift) & 7;\n\treturn 0;\n}\n\nstatic int snd_ac97_stac9758_input_jack_put(struct snd_kcontrol *kcontrol, struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_ac97 *ac97 = snd_kcontrol_chip(kcontrol);\n\tint shift = kcontrol->private_value;\n\n\treturn ac97_update_bits_page(ac97, AC97_SIGMATEL_INSEL, 7 << shift,\n\t\t\t\t     ucontrol->value.enumerated.item[0] << shift, 0);\n}\n\nstatic int snd_ac97_stac9758_phonesel_info(struct snd_kcontrol *kcontrol, struct snd_ctl_elem_info *uinfo)\n{\n\tstatic const char * const texts[3] = {\n\t\t\"None\", \"Front Jack\", \"Rear Jack\"\n\t};\n\n\treturn snd_ctl_enum_info(uinfo, 1, 3, texts);\n}\n\nstatic int snd_ac97_stac9758_phonesel_get(struct snd_kcontrol *kcontrol, struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_ac97 *ac97 = snd_kcontrol_chip(kcontrol);\n\n\tucontrol->value.enumerated.item[0] = ac97->regs[AC97_SIGMATEL_IOMISC] & 3;\n\treturn 0;\n}\n\nstatic int snd_ac97_stac9758_phonesel_put(struct snd_kcontrol *kcontrol, struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_ac97 *ac97 = snd_kcontrol_chip(kcontrol);\n\n\treturn ac97_update_bits_page(ac97, AC97_SIGMATEL_IOMISC, 3,\n\t\t\t\t     ucontrol->value.enumerated.item[0], 0);\n}\n\n#define STAC9758_OUTPUT_JACK(xname, shift) \\\n{\t.iface = SNDRV_CTL_ELEM_IFACE_MIXER, .name = xname, \\\n\t.info = snd_ac97_stac9758_output_jack_info, \\\n\t.get = snd_ac97_stac9758_output_jack_get, \\\n\t.put = snd_ac97_stac9758_output_jack_put, \\\n\t.private_value = shift }\n#define STAC9758_INPUT_JACK(xname, shift) \\\n{\t.iface = SNDRV_CTL_ELEM_IFACE_MIXER, .name = xname, \\\n\t.info = snd_ac97_stac9758_input_jack_info, \\\n\t.get = snd_ac97_stac9758_input_jack_get, \\\n\t.put = snd_ac97_stac9758_input_jack_put, \\\n\t.private_value = shift }\nstatic const struct snd_kcontrol_new snd_ac97_sigmatel_stac9758_controls[] = {\n\tSTAC9758_OUTPUT_JACK(\"Mic1 Jack\", 1),\n\tSTAC9758_OUTPUT_JACK(\"LineIn Jack\", 4),\n\tSTAC9758_OUTPUT_JACK(\"Front Jack\", 7),\n\tSTAC9758_OUTPUT_JACK(\"Rear Jack\", 10),\n\tSTAC9758_OUTPUT_JACK(\"Center/LFE Jack\", 13),\n\tSTAC9758_INPUT_JACK(\"Mic Input Source\", 0),\n\tSTAC9758_INPUT_JACK(\"Line Input Source\", 8),\n\t{\n\t\t.iface = SNDRV_CTL_ELEM_IFACE_MIXER,\n\t\t.name = \"Headphone Amp\",\n\t\t.info = snd_ac97_stac9758_phonesel_info,\n\t\t.get = snd_ac97_stac9758_phonesel_get,\n\t\t.put = snd_ac97_stac9758_phonesel_put\n\t},\n\tAC97_SINGLE(\"Exchange Center/LFE\", AC97_SIGMATEL_IOMISC, 4, 1, 0),\n\tAC97_SINGLE(\"Headphone +3dB Boost\", AC97_SIGMATEL_IOMISC, 8, 1, 0)\n};\n\nstatic int patch_sigmatel_stac9758_specific(struct snd_ac97 *ac97)\n{\n\tint err;\n\n\terr = patch_sigmatel_stac97xx_specific(ac97);\n\tif (err < 0)\n\t\treturn err;\n\terr = patch_build_controls(ac97, snd_ac97_sigmatel_stac9758_controls,\n\t\t\t\t   ARRAY_SIZE(snd_ac97_sigmatel_stac9758_controls));\n\tif (err < 0)\n\t\treturn err;\n\t \n\tsnd_ac97_rename_vol_ctl(ac97, \"Headphone Playback\", \"Front Playback\");\n\t \n\t \n\t \n\tsnd_ac97_rename_vol_ctl(ac97, \"Video Playback\", \"Surround Mix Playback\");\n\t \n\n\treturn 0;\n}\n\nstatic const struct snd_ac97_build_ops patch_sigmatel_stac9758_ops = {\n\t.build_3d\t= patch_sigmatel_stac9700_3d,\n\t.build_specific\t= patch_sigmatel_stac9758_specific\n};\n\nstatic int patch_sigmatel_stac9758(struct snd_ac97 * ac97)\n{\n\tstatic const unsigned short regs[4] = {\n\t\tAC97_SIGMATEL_OUTSEL,\n\t\tAC97_SIGMATEL_IOMISC,\n\t\tAC97_SIGMATEL_INSEL,\n\t\tAC97_SIGMATEL_VARIOUS\n\t};\n\tstatic const unsigned short def_regs[4] = {\n\t\t  0xd794,  \n\t\t  0x2001,\n\t\t  0x0201,  \n\t\t  0x0040\n\t};\n\tstatic const unsigned short m675_regs[4] = {\n\t\t  0xfc70,  \n\t\t  0x2102,  \n\t\t  0x0203,  \n\t\t  0x0041  \n\t};\n\tconst unsigned short *pregs = def_regs;\n\tint i;\n\n\t \n\tif (ac97->pci && \n\t    ac97->subsystem_vendor == 0x107b &&\n\t    ac97->subsystem_device == 0x0601)\n\t    \tpregs = m675_regs;\n\n\t\n\tac97->build_ops = &patch_sigmatel_stac9758_ops;\n\t \n\tsnd_ac97_update_bits(ac97, AC97_INT_PAGING, AC97_PAGE_MASK, AC97_PAGE_VENDOR);\n\tfor (i = 0; i < 4; i++)\n\t\tsnd_ac97_write_cache(ac97, regs[i], pregs[i]);\n\n\tac97->flags |= AC97_STEREO_MUTES;\n\treturn 0;\n}\n\n \nstatic const struct snd_kcontrol_new snd_ac97_cirrus_controls_spdif[2] = {\n\tAC97_SINGLE(SNDRV_CTL_NAME_IEC958(\"\",PLAYBACK,SWITCH), AC97_CSR_SPDIF, 15, 1, 0),\n\tAC97_SINGLE(SNDRV_CTL_NAME_IEC958(\"\",PLAYBACK,NONE) \"AC97-SPSA\", AC97_CSR_ACMODE, 0, 3, 0)\n};\n\nstatic int patch_cirrus_build_spdif(struct snd_ac97 * ac97)\n{\n\tint err;\n\n\t \n\terr = patch_build_controls(ac97, &snd_ac97_controls_spdif[0], 3);\n\tif (err < 0)\n\t\treturn err;\n\t \n\terr = patch_build_controls(ac97, &snd_ac97_cirrus_controls_spdif[0], 1);\n\tif (err < 0)\n\t\treturn err;\n\tswitch (ac97->id & AC97_ID_CS_MASK) {\n\tcase AC97_ID_CS4205:\n\t\terr = patch_build_controls(ac97, &snd_ac97_cirrus_controls_spdif[1], 1);\n\t\tif (err < 0)\n\t\t\treturn err;\n\t\tbreak;\n\t}\n\t \n\t \n\tsnd_ac97_write_cache(ac97, AC97_CSR_SPDIF, 0x0a20);\n\treturn 0;\n}\n\nstatic const struct snd_ac97_build_ops patch_cirrus_ops = {\n\t.build_spdif = patch_cirrus_build_spdif\n};\n\nstatic int patch_cirrus_spdif(struct snd_ac97 * ac97)\n{\n\t \n\n\tac97->build_ops = &patch_cirrus_ops;\n\tac97->flags |= AC97_CS_SPDIF; \n\tac97->rates[AC97_RATES_SPDIF] &= ~SNDRV_PCM_RATE_32000;\n        ac97->ext_id |= AC97_EI_SPDIF;\t \n\tsnd_ac97_write_cache(ac97, AC97_CSR_ACMODE, 0x0080);\n\treturn 0;\n}\n\nstatic int patch_cirrus_cs4299(struct snd_ac97 * ac97)\n{\n\t \n\tac97->flags |= AC97_HAS_PC_BEEP;\n\t\n\treturn patch_cirrus_spdif(ac97);\n}\n\n \nstatic const struct snd_kcontrol_new snd_ac97_conexant_controls_spdif[1] = {\n\tAC97_SINGLE(SNDRV_CTL_NAME_IEC958(\"\",PLAYBACK,SWITCH), AC97_CXR_AUDIO_MISC, 3, 1, 0),\n};\n\nstatic int patch_conexant_build_spdif(struct snd_ac97 * ac97)\n{\n\tint err;\n\n\t \n\terr = patch_build_controls(ac97, &snd_ac97_controls_spdif[0], 3);\n\tif (err < 0)\n\t\treturn err;\n\t \n\terr = patch_build_controls(ac97, &snd_ac97_conexant_controls_spdif[0], 1);\n\tif (err < 0)\n\t\treturn err;\n\t \n\t \n\tsnd_ac97_write_cache(ac97, AC97_CXR_AUDIO_MISC,\n\t\t\t     snd_ac97_read(ac97, AC97_CXR_AUDIO_MISC) & ~(AC97_CXR_SPDIFEN|AC97_CXR_COPYRGT|AC97_CXR_SPDIF_MASK));\n\treturn 0;\n}\n\nstatic const struct snd_ac97_build_ops patch_conexant_ops = {\n\t.build_spdif = patch_conexant_build_spdif\n};\n\nstatic int patch_conexant(struct snd_ac97 * ac97)\n{\n\tac97->build_ops = &patch_conexant_ops;\n\tac97->flags |= AC97_CX_SPDIF;\n        ac97->ext_id |= AC97_EI_SPDIF;\t \n\tac97->rates[AC97_RATES_SPDIF] = SNDRV_PCM_RATE_48000;  \n\treturn 0;\n}\n\nstatic int patch_cx20551(struct snd_ac97 *ac97)\n{\n\tsnd_ac97_update_bits(ac97, 0x5c, 0x01, 0x01);\n\treturn 0;\n}\n\n \n#ifdef CONFIG_PM\nstatic void ad18xx_resume(struct snd_ac97 *ac97)\n{\n\tstatic const unsigned short setup_regs[] = {\n\t\tAC97_AD_MISC, AC97_AD_SERIAL_CFG, AC97_AD_JACK_SPDIF,\n\t};\n\tint i, codec;\n\n\tfor (i = 0; i < (int)ARRAY_SIZE(setup_regs); i++) {\n\t\tunsigned short reg = setup_regs[i];\n\t\tif (test_bit(reg, ac97->reg_accessed)) {\n\t\t\tsnd_ac97_write(ac97, reg, ac97->regs[reg]);\n\t\t\tsnd_ac97_read(ac97, reg);\n\t\t}\n\t}\n\n\tif (! (ac97->flags & AC97_AD_MULTI))\n\t\t \n\t\tsnd_ac97_restore_status(ac97);\n\telse {\n\t\t \n\t\tfor (codec = 0; codec < 3; codec++) {\n\t\t\tif (! ac97->spec.ad18xx.id[codec])\n\t\t\t\tcontinue;\n\t\t\t \n\t\t\tsnd_ac97_update_bits(ac97, AC97_AD_SERIAL_CFG, 0x7000,\n\t\t\t\t\t     ac97->spec.ad18xx.unchained[codec] | ac97->spec.ad18xx.chained[codec]);\n\t\t\tac97->bus->ops->write(ac97, AC97_AD_CODEC_CFG, ac97->spec.ad18xx.codec_cfg[codec]);\n\t\t}\n\t\t \n\t\tsnd_ac97_update_bits(ac97, AC97_AD_SERIAL_CFG, 0x7000, 0x7000);\n\n\t\t \n\t\tfor (i = 2; i < 0x7c ; i += 2) {\n\t\t\tif (i == AC97_POWERDOWN || i == AC97_EXTENDED_ID)\n\t\t\t\tcontinue;\n\t\t\tif (test_bit(i, ac97->reg_accessed)) {\n\t\t\t\t \n\t\t\t\tif (i == AC97_PCM) {\n\t\t\t\t\tfor (codec = 0; codec < 3; codec++) {\n\t\t\t\t\t\tif (! ac97->spec.ad18xx.id[codec])\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t \n\t\t\t\t\t\tsnd_ac97_update_bits(ac97, AC97_AD_SERIAL_CFG, 0x7000,\n\t\t\t\t\t\t\t\t     ac97->spec.ad18xx.unchained[codec] | ac97->spec.ad18xx.chained[codec]);\n\t\t\t\t\t\t \n\t\t\t\t\t\tac97->bus->ops->write(ac97, AC97_PCM, ac97->spec.ad18xx.pcmreg[codec]);\n\t\t\t\t\t}\n\t\t\t\t\t \n\t\t\t\t\tsnd_ac97_update_bits(ac97, AC97_AD_SERIAL_CFG, 0x7000, 0x7000);\n\t\t\t\t\tcontinue;\n\t\t\t\t} else if (i == AC97_AD_TEST ||\n\t\t\t\t\t   i == AC97_AD_CODEC_CFG ||\n\t\t\t\t\t   i == AC97_AD_SERIAL_CFG)\n\t\t\t\t\tcontinue;  \n\t\t\t}\n\t\t\tsnd_ac97_write(ac97, i, ac97->regs[i]);\n\t\t\tsnd_ac97_read(ac97, i);\n\t\t}\n\t}\n\n\tsnd_ac97_restore_iec958(ac97);\n}\n\nstatic void ad1888_resume(struct snd_ac97 *ac97)\n{\n\tad18xx_resume(ac97);\n\tsnd_ac97_write_cache(ac97, AC97_CODEC_CLASS_REV, 0x8080);\n}\n\n#endif\n\nstatic const struct snd_ac97_res_table ad1819_restbl[] = {\n\t{ AC97_PHONE, 0x9f1f },\n\t{ AC97_MIC, 0x9f1f },\n\t{ AC97_LINE, 0x9f1f },\n\t{ AC97_CD, 0x9f1f },\n\t{ AC97_VIDEO, 0x9f1f },\n\t{ AC97_AUX, 0x9f1f },\n\t{ AC97_PCM, 0x9f1f },\n\t{ }  \n};\n\nstatic int patch_ad1819(struct snd_ac97 * ac97)\n{\n\tunsigned short scfg;\n\n\t\n\tscfg = snd_ac97_read(ac97, AC97_AD_SERIAL_CFG);\n\tsnd_ac97_write_cache(ac97, AC97_AD_SERIAL_CFG, scfg | 0x7000);  \n\tac97->res_table = ad1819_restbl;\n\treturn 0;\n}\n\nstatic unsigned short patch_ad1881_unchained(struct snd_ac97 * ac97, int idx, unsigned short mask)\n{\n\tunsigned short val;\n\n\t\n\tsnd_ac97_update_bits(ac97, AC97_AD_SERIAL_CFG, 0x7000, mask);\n\tsnd_ac97_write_cache(ac97, AC97_AD_CODEC_CFG, 0x0000);\t \n\tval = snd_ac97_read(ac97, AC97_VENDOR_ID2);\n\tif ((val & 0xff40) != 0x5340)\n\t\treturn 0;\n\tac97->spec.ad18xx.unchained[idx] = mask;\n\tac97->spec.ad18xx.id[idx] = val;\n\tac97->spec.ad18xx.codec_cfg[idx] = 0x0000;\n\treturn mask;\n}\n\nstatic int patch_ad1881_chained1(struct snd_ac97 * ac97, int idx, unsigned short codec_bits)\n{\n\tstatic const int cfg_bits[3] = { 1<<12, 1<<14, 1<<13 };\n\tunsigned short val;\n\t\n\tsnd_ac97_update_bits(ac97, AC97_AD_SERIAL_CFG, 0x7000, cfg_bits[idx]);\n\tsnd_ac97_write_cache(ac97, AC97_AD_CODEC_CFG, 0x0004);\t\n\tval = snd_ac97_read(ac97, AC97_VENDOR_ID2);\n\tif ((val & 0xff40) != 0x5340)\n\t\treturn 0;\n\tif (codec_bits)\n\t\tsnd_ac97_write_cache(ac97, AC97_AD_CODEC_CFG, codec_bits);\n\tac97->spec.ad18xx.chained[idx] = cfg_bits[idx];\n\tac97->spec.ad18xx.id[idx] = val;\n\tac97->spec.ad18xx.codec_cfg[idx] = codec_bits ? codec_bits : 0x0004;\n\treturn 1;\n}\n\nstatic void patch_ad1881_chained(struct snd_ac97 * ac97, int unchained_idx, int cidx1, int cidx2)\n{\n\t\n\tif (ac97->spec.ad18xx.unchained[cidx1] || ac97->spec.ad18xx.chained[cidx1])\n\t\tcidx1 = -1;\n\tif (ac97->spec.ad18xx.unchained[cidx2] || ac97->spec.ad18xx.chained[cidx2])\n\t\tcidx2 = -1;\n\tif (cidx1 < 0 && cidx2 < 0)\n\t\treturn;\n\t\n\tsnd_ac97_update_bits(ac97, AC97_AD_SERIAL_CFG, 0x7000,\n\t\t\t     ac97->spec.ad18xx.unchained[unchained_idx]);\n\tsnd_ac97_write_cache(ac97, AC97_AD_CODEC_CFG, 0x0002);\t\t\n\tac97->spec.ad18xx.codec_cfg[unchained_idx] = 0x0002;\n\tif (cidx1 >= 0) {\n\t\tif (cidx2 < 0)\n\t\t\tpatch_ad1881_chained1(ac97, cidx1, 0);\n\t\telse if (patch_ad1881_chained1(ac97, cidx1, 0x0006))\t\n\t\t\tpatch_ad1881_chained1(ac97, cidx2, 0);\n\t\telse if (patch_ad1881_chained1(ac97, cidx2, 0x0006))\t\n\t\t\tpatch_ad1881_chained1(ac97, cidx1, 0);\n\t} else if (cidx2 >= 0) {\n\t\tpatch_ad1881_chained1(ac97, cidx2, 0);\n\t}\n}\n\nstatic const struct snd_ac97_build_ops patch_ad1881_build_ops = {\n#ifdef CONFIG_PM\n\t.resume = ad18xx_resume\n#endif\n};\n\nstatic int patch_ad1881(struct snd_ac97 * ac97)\n{\n\tstatic const char cfg_idxs[3][2] = {\n\t\t{2, 1},\n\t\t{0, 2},\n\t\t{0, 1}\n\t};\n\t\n\t\n\tunsigned short codecs[3];\n\tunsigned short val;\n\tint idx, num;\n\n\tval = snd_ac97_read(ac97, AC97_AD_SERIAL_CFG);\n\tsnd_ac97_write_cache(ac97, AC97_AD_SERIAL_CFG, val);\n\tcodecs[0] = patch_ad1881_unchained(ac97, 0, (1<<12));\n\tcodecs[1] = patch_ad1881_unchained(ac97, 1, (1<<14));\n\tcodecs[2] = patch_ad1881_unchained(ac97, 2, (1<<13));\n\n\tif (! (codecs[0] || codecs[1] || codecs[2]))\n\t\tgoto __end;\n\n\tfor (idx = 0; idx < 3; idx++)\n\t\tif (ac97->spec.ad18xx.unchained[idx])\n\t\t\tpatch_ad1881_chained(ac97, idx, cfg_idxs[idx][0], cfg_idxs[idx][1]);\n\n\tif (ac97->spec.ad18xx.id[1]) {\n\t\tac97->flags |= AC97_AD_MULTI;\n\t\tac97->scaps |= AC97_SCAP_SURROUND_DAC;\n\t}\n\tif (ac97->spec.ad18xx.id[2]) {\n\t\tac97->flags |= AC97_AD_MULTI;\n\t\tac97->scaps |= AC97_SCAP_CENTER_LFE_DAC;\n\t}\n\n      __end:\n\t \n\tsnd_ac97_update_bits(ac97, AC97_AD_SERIAL_CFG, 0x7000, 0x7000);\n\t \n\tfor (idx = num = 0; idx < 3; idx++)\n\t\tif (ac97->spec.ad18xx.id[idx])\n\t\t\tnum++;\n\tif (num == 1) {\n\t\t \n\t\tsnd_ac97_write_cache(ac97, AC97_AD_CODEC_CFG, 0x0000);\n\t\tac97->spec.ad18xx.codec_cfg[0] = \n\t\t\tac97->spec.ad18xx.codec_cfg[1] = \n\t\t\tac97->spec.ad18xx.codec_cfg[2] = 0x0000;\n\t}\n\t \n\tac97->ext_id = snd_ac97_read(ac97, AC97_EXTENDED_ID);\n\tif (ac97->spec.ad18xx.id[0]) {\n\t\tac97->id &= 0xffff0000;\n\t\tac97->id |= ac97->spec.ad18xx.id[0];\n\t}\n\tac97->build_ops = &patch_ad1881_build_ops;\n\treturn 0;\n}\n\nstatic const struct snd_kcontrol_new snd_ac97_controls_ad1885[] = {\n\tAC97_SINGLE(\"Digital Mono Direct\", AC97_AD_MISC, 11, 1, 0),\n\t   \n\tAC97_SINGLE(\"Low Power Mixer\", AC97_AD_MISC, 14, 1, 0),\n\tAC97_SINGLE(\"Zero Fill DAC\", AC97_AD_MISC, 15, 1, 0),\n\tAC97_SINGLE(\"Headphone Jack Sense\", AC97_AD_JACK_SPDIF, 9, 1, 1),  \n\tAC97_SINGLE(\"Line Jack Sense\", AC97_AD_JACK_SPDIF, 8, 1, 1),  \n};\n\nstatic const DECLARE_TLV_DB_SCALE(db_scale_6bit_6db_max, -8850, 150, 0);\n\nstatic int patch_ad1885_specific(struct snd_ac97 * ac97)\n{\n\tint err;\n\n\terr = patch_build_controls(ac97, snd_ac97_controls_ad1885, ARRAY_SIZE(snd_ac97_controls_ad1885));\n\tif (err < 0)\n\t\treturn err;\n\treset_tlv(ac97, \"Headphone Playback Volume\",\n\t\t  db_scale_6bit_6db_max);\n\treturn 0;\n}\n\nstatic const struct snd_ac97_build_ops patch_ad1885_build_ops = {\n\t.build_specific = &patch_ad1885_specific,\n#ifdef CONFIG_PM\n\t.resume = ad18xx_resume\n#endif\n};\n\nstatic int patch_ad1885(struct snd_ac97 * ac97)\n{\n\tpatch_ad1881(ac97);\n\t \n\t \n\n\t \n\tsnd_ac97_write_cache(ac97, AC97_AD_MISC, 0x0404);\n\n\tac97->build_ops = &patch_ad1885_build_ops;\n\treturn 0;\n}\n\nstatic int patch_ad1886_specific(struct snd_ac97 * ac97)\n{\n\treset_tlv(ac97, \"Headphone Playback Volume\",\n\t\t  db_scale_6bit_6db_max);\n\treturn 0;\n}\n\nstatic const struct snd_ac97_build_ops patch_ad1886_build_ops = {\n\t.build_specific = &patch_ad1886_specific,\n#ifdef CONFIG_PM\n\t.resume = ad18xx_resume\n#endif\n};\n\nstatic int patch_ad1886(struct snd_ac97 * ac97)\n{\n\tpatch_ad1881(ac97);\n\t \n\t \n\tsnd_ac97_write_cache(ac97, AC97_AD_JACK_SPDIF, 0x0010);\n\tac97->build_ops = &patch_ad1886_build_ops;\n\treturn 0;\n}\n\n \n#define AC97_AD198X_MBC\t\t0x0003\t \n#define AC97_AD198X_MBC_20\t0x0000\t \n#define AC97_AD198X_MBC_10\t0x0001\t \n#define AC97_AD198X_MBC_30\t0x0002\t \n#define AC97_AD198X_VREFD\t0x0004\t \n#define AC97_AD198X_VREFH\t0x0008\t \n#define AC97_AD198X_VREF_0\t0x000c\t \n#define AC97_AD198X_VREF_MASK\t(AC97_AD198X_VREFH | AC97_AD198X_VREFD)\n#define AC97_AD198X_VREF_SHIFT\t2\n#define AC97_AD198X_SRU\t\t0x0010\t \n#define AC97_AD198X_LOSEL\t0x0020\t \n#define AC97_AD198X_2MIC\t0x0040\t \n#define AC97_AD198X_SPRD\t0x0080\t \n#define AC97_AD198X_DMIX0\t0x0100\t \n\t\t\t\t\t \n#define AC97_AD198X_DMIX1\t0x0200\t \n#define AC97_AD198X_HPSEL\t0x0400\t \n#define AC97_AD198X_CLDIS\t0x0800\t \n#define AC97_AD198X_LODIS\t0x1000\t \n#define AC97_AD198X_MSPLT\t0x2000\t \n#define AC97_AD198X_AC97NC\t0x4000\t \n#define AC97_AD198X_DACZ\t0x8000\t \n\n \n#define AC97_AD1986_MBC\t\t0x0003\t \n#define AC97_AD1986_MBC_20\t0x0000\t \n#define AC97_AD1986_MBC_10\t0x0001\t \n#define AC97_AD1986_MBC_30\t0x0002\t \n#define AC97_AD1986_LISEL0\t0x0004\t \n#define AC97_AD1986_LISEL1\t0x0008\t \n#define AC97_AD1986_LISEL_MASK\t(AC97_AD1986_LISEL1 | AC97_AD1986_LISEL0)\n#define AC97_AD1986_LISEL_LI\t0x0000   \n#define AC97_AD1986_LISEL_SURR\t0x0004   \n#define AC97_AD1986_LISEL_MIC\t0x0008   \n#define AC97_AD1986_SRU\t\t0x0010\t \n#define AC97_AD1986_SOSEL\t0x0020\t \n#define AC97_AD1986_2MIC\t0x0040\t \n#define AC97_AD1986_SPRD\t0x0080\t \n#define AC97_AD1986_DMIX0\t0x0100\t \n\t\t\t\t\t \n#define AC97_AD1986_DMIX1\t0x0200\t \n#define AC97_AD1986_CLDIS\t0x0800\t \n#define AC97_AD1986_SODIS\t0x1000\t \n#define AC97_AD1986_MSPLT\t0x2000\t \n#define AC97_AD1986_AC97NC\t0x4000\t \n#define AC97_AD1986_DACZ\t0x8000\t \n\n \n#define AC97_AD_MISC2\t\t0x70\t \n\n#define AC97_AD1986_CVREF0\t0x0004\t \n#define AC97_AD1986_CVREF1\t0x0008\t \n#define AC97_AD1986_CVREF2\t0x0010\t \n#define AC97_AD1986_CVREF_MASK \\\n\t(AC97_AD1986_CVREF2 | AC97_AD1986_CVREF1 | AC97_AD1986_CVREF0)\n#define AC97_AD1986_JSMAP\t0x0020\t \n#define AC97_AD1986_MMDIS\t0x0080\t \n#define AC97_AD1986_MVREF0\t0x0400\t \n#define AC97_AD1986_MVREF1\t0x0800\t \n#define AC97_AD1986_MVREF2\t0x1000\t \n#define AC97_AD1986_MVREF_MASK \\\n\t(AC97_AD1986_MVREF2 | AC97_AD1986_MVREF1 | AC97_AD1986_MVREF0)\n\n \n#define AC97_AD_MISC3\t\t0x7a\t \n\n#define AC97_AD1986_MMIX\t0x0004\t \n#define AC97_AD1986_GPO\t\t0x0008\t \n#define AC97_AD1986_LOHPEN\t0x0010\t \n#define AC97_AD1986_LVREF0\t0x0100\t \n#define AC97_AD1986_LVREF1\t0x0200\t \n#define AC97_AD1986_LVREF2\t0x0400\t \n#define AC97_AD1986_LVREF_MASK \\\n\t(AC97_AD1986_LVREF2 | AC97_AD1986_LVREF1 | AC97_AD1986_LVREF0)\n#define AC97_AD1986_JSINVA\t0x0800\t \n#define AC97_AD1986_LOSEL\t0x1000\t \n#define AC97_AD1986_HPSEL0\t0x2000\t \n\t\t\t\t\t \n#define AC97_AD1986_HPSEL1\t0x4000\t \n\t\t\t\t\t \n#define AC97_AD1986_JSINVB\t0x8000\t \n\n \n#define AC97_AD1986_OMS0\t0x0100\t \n#define AC97_AD1986_OMS1\t0x0200\t \n#define AC97_AD1986_OMS2\t0x0400\t \n#define AC97_AD1986_OMS_MASK \\\n\t(AC97_AD1986_OMS2 | AC97_AD1986_OMS1 | AC97_AD1986_OMS0)\n#define AC97_AD1986_OMS_M\t0x0000   \n#define AC97_AD1986_OMS_L\t0x0100   \n#define AC97_AD1986_OMS_C\t0x0200   \n#define AC97_AD1986_OMS_MC\t0x0400   \n\t\t\t\t\t \n#define AC97_AD1986_OMS_ML\t0x0500   \n\t\t\t\t\t \n#define AC97_AD1986_OMS_LC\t0x0600   \n\t\t\t\t\t \n#define AC97_AD1986_OMS_MLC\t0x0700   \n\t\t\t\t\t \n\n\nstatic int snd_ac97_ad198x_spdif_source_info(struct snd_kcontrol *kcontrol, struct snd_ctl_elem_info *uinfo)\n{\n\tstatic const char * const texts[2] = { \"AC-Link\", \"A/D Converter\" };\n\n\treturn snd_ctl_enum_info(uinfo, 1, 2, texts);\n}\n\nstatic int snd_ac97_ad198x_spdif_source_get(struct snd_kcontrol *kcontrol, struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_ac97 *ac97 = snd_kcontrol_chip(kcontrol);\n\tunsigned short val;\n\n\tval = ac97->regs[AC97_AD_SERIAL_CFG];\n\tucontrol->value.enumerated.item[0] = (val >> 2) & 1;\n\treturn 0;\n}\n\nstatic int snd_ac97_ad198x_spdif_source_put(struct snd_kcontrol *kcontrol, struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_ac97 *ac97 = snd_kcontrol_chip(kcontrol);\n\tunsigned short val;\n\n\tif (ucontrol->value.enumerated.item[0] > 1)\n\t\treturn -EINVAL;\n\tval = ucontrol->value.enumerated.item[0] << 2;\n\treturn snd_ac97_update_bits(ac97, AC97_AD_SERIAL_CFG, 0x0004, val);\n}\n\nstatic const struct snd_kcontrol_new snd_ac97_ad198x_spdif_source = {\n\t.iface\t= SNDRV_CTL_ELEM_IFACE_MIXER,\n\t.name\t= SNDRV_CTL_NAME_IEC958(\"\",PLAYBACK,NONE) \"Source\",\n\t.info\t= snd_ac97_ad198x_spdif_source_info,\n\t.get\t= snd_ac97_ad198x_spdif_source_get,\n\t.put\t= snd_ac97_ad198x_spdif_source_put,\n};\n\nstatic int patch_ad198x_post_spdif(struct snd_ac97 * ac97)\n{\n \treturn patch_build_controls(ac97, &snd_ac97_ad198x_spdif_source, 1);\n}\n\nstatic const struct snd_kcontrol_new snd_ac97_ad1981x_jack_sense[] = {\n\tAC97_SINGLE(\"Headphone Jack Sense\", AC97_AD_JACK_SPDIF, 11, 1, 0),\n\tAC97_SINGLE(\"Line Jack Sense\", AC97_AD_JACK_SPDIF, 12, 1, 0),\n};\n\n \nstatic const unsigned int ad1981_jacks_denylist[] = {\n\t0x10140523,  \n\t0x10140534,  \n\t0x10140537,  \n\t0x1014053e,  \n\t0x10140554,  \n\t0x10140567,  \n\t0x10140581,  \n\t0x10280160,  \n\t0x104380b0,  \n\t0x11790241,  \n\t0x1179ff10,  \n\t0x144dc01a,  \n\t0  \n};\n\nstatic int check_list(struct snd_ac97 *ac97, const unsigned int *list)\n{\n\tu32 subid = ((u32)ac97->subsystem_vendor << 16) | ac97->subsystem_device;\n\tfor (; *list; list++)\n\t\tif (*list == subid)\n\t\t\treturn 1;\n\treturn 0;\n}\n\nstatic int patch_ad1981a_specific(struct snd_ac97 * ac97)\n{\n\tif (check_list(ac97, ad1981_jacks_denylist))\n\t\treturn 0;\n\treturn patch_build_controls(ac97, snd_ac97_ad1981x_jack_sense,\n\t\t\t\t    ARRAY_SIZE(snd_ac97_ad1981x_jack_sense));\n}\n\nstatic const struct snd_ac97_build_ops patch_ad1981a_build_ops = {\n\t.build_post_spdif = patch_ad198x_post_spdif,\n\t.build_specific = patch_ad1981a_specific,\n#ifdef CONFIG_PM\n\t.resume = ad18xx_resume\n#endif\n};\n\n \nstatic const unsigned int ad1981_jacks_allowlist[] = {\n\t0x0e11005a,  \n\t0x103c0890,  \n\t0x103c0938,  \n\t0x103c099c,  \n\t0x103c0944,  \n\t0x103c0934,  \n\t0x103c006d,  \n\t0x103c300d,  \n\t0x17340088,  \n\t0  \n};\n\nstatic void check_ad1981_hp_jack_sense(struct snd_ac97 *ac97)\n{\n\tif (check_list(ac97, ad1981_jacks_allowlist))\n\t\t \n\t\tsnd_ac97_update_bits(ac97, AC97_AD_JACK_SPDIF, 1<<11, 1<<11);\n}\n\nstatic int patch_ad1981a(struct snd_ac97 *ac97)\n{\n\tpatch_ad1881(ac97);\n\tac97->build_ops = &patch_ad1981a_build_ops;\n\tsnd_ac97_update_bits(ac97, AC97_AD_MISC, AC97_AD198X_MSPLT, AC97_AD198X_MSPLT);\n\tac97->flags |= AC97_STEREO_MUTES;\n\tcheck_ad1981_hp_jack_sense(ac97);\n\treturn 0;\n}\n\nstatic const struct snd_kcontrol_new snd_ac97_ad198x_2cmic =\nAC97_SINGLE(\"Stereo Mic\", AC97_AD_MISC, 6, 1, 0);\n\nstatic int patch_ad1981b_specific(struct snd_ac97 *ac97)\n{\n\tint err;\n\n\terr = patch_build_controls(ac97, &snd_ac97_ad198x_2cmic, 1);\n\tif (err < 0)\n\t\treturn err;\n\tif (check_list(ac97, ad1981_jacks_denylist))\n\t\treturn 0;\n\treturn patch_build_controls(ac97, snd_ac97_ad1981x_jack_sense,\n\t\t\t\t    ARRAY_SIZE(snd_ac97_ad1981x_jack_sense));\n}\n\nstatic const struct snd_ac97_build_ops patch_ad1981b_build_ops = {\n\t.build_post_spdif = patch_ad198x_post_spdif,\n\t.build_specific = patch_ad1981b_specific,\n#ifdef CONFIG_PM\n\t.resume = ad18xx_resume\n#endif\n};\n\nstatic int patch_ad1981b(struct snd_ac97 *ac97)\n{\n\tpatch_ad1881(ac97);\n\tac97->build_ops = &patch_ad1981b_build_ops;\n\tsnd_ac97_update_bits(ac97, AC97_AD_MISC, AC97_AD198X_MSPLT, AC97_AD198X_MSPLT);\n\tac97->flags |= AC97_STEREO_MUTES;\n\tcheck_ad1981_hp_jack_sense(ac97);\n\treturn 0;\n}\n\n#define snd_ac97_ad1888_lohpsel_info\tsnd_ctl_boolean_mono_info\n\nstatic int snd_ac97_ad1888_lohpsel_get(struct snd_kcontrol *kcontrol, struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_ac97 *ac97 = snd_kcontrol_chip(kcontrol);\n\tunsigned short val;\n\n\tval = ac97->regs[AC97_AD_MISC];\n\tucontrol->value.integer.value[0] = !(val & AC97_AD198X_LOSEL);\n\tif (ac97->spec.ad18xx.lo_as_master)\n\t\tucontrol->value.integer.value[0] =\n\t\t\t!ucontrol->value.integer.value[0];\n\treturn 0;\n}\n\nstatic int snd_ac97_ad1888_lohpsel_put(struct snd_kcontrol *kcontrol, struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_ac97 *ac97 = snd_kcontrol_chip(kcontrol);\n\tunsigned short val;\n\n\tval = !ucontrol->value.integer.value[0];\n\tif (ac97->spec.ad18xx.lo_as_master)\n\t\tval = !val;\n\tval = val ? (AC97_AD198X_LOSEL | AC97_AD198X_HPSEL) : 0;\n\treturn snd_ac97_update_bits(ac97, AC97_AD_MISC,\n\t\t\t\t    AC97_AD198X_LOSEL | AC97_AD198X_HPSEL, val);\n}\n\nstatic int snd_ac97_ad1888_downmix_info(struct snd_kcontrol *kcontrol, struct snd_ctl_elem_info *uinfo)\n{\n\tstatic const char * const texts[3] = {\"Off\", \"6 -> 4\", \"6 -> 2\"};\n\n\treturn snd_ctl_enum_info(uinfo, 1, 3, texts);\n}\n\nstatic int snd_ac97_ad1888_downmix_get(struct snd_kcontrol *kcontrol, struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_ac97 *ac97 = snd_kcontrol_chip(kcontrol);\n\tunsigned short val;\n\n\tval = ac97->regs[AC97_AD_MISC];\n\tif (!(val & AC97_AD198X_DMIX1))\n\t\tucontrol->value.enumerated.item[0] = 0;\n\telse\n\t\tucontrol->value.enumerated.item[0] = 1 + ((val >> 8) & 1);\n\treturn 0;\n}\n\nstatic int snd_ac97_ad1888_downmix_put(struct snd_kcontrol *kcontrol, struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_ac97 *ac97 = snd_kcontrol_chip(kcontrol);\n\tunsigned short val;\n\n\tif (ucontrol->value.enumerated.item[0] > 2)\n\t\treturn -EINVAL;\n\tif (ucontrol->value.enumerated.item[0] == 0)\n\t\tval = 0;\n\telse\n\t\tval = AC97_AD198X_DMIX1 |\n\t\t\t((ucontrol->value.enumerated.item[0] - 1) << 8);\n\treturn snd_ac97_update_bits(ac97, AC97_AD_MISC,\n\t\t\t\t    AC97_AD198X_DMIX0 | AC97_AD198X_DMIX1, val);\n}\n\nstatic void ad1888_update_jacks(struct snd_ac97 *ac97)\n{\n\tunsigned short val = 0;\n\t \n\tif (!ac97->spec.ad18xx.lo_as_master && is_shared_linein(ac97))\n\t\tval |= (1 << 12);\n\t \n\tif (is_shared_micin(ac97))\n\t\tval |= (1 << 11);\n\t \n\tsnd_ac97_update_bits(ac97, AC97_AD_MISC, (1 << 11) | (1 << 12), val);\n}\n\nstatic const struct snd_kcontrol_new snd_ac97_ad1888_controls[] = {\n\t{\n\t\t.iface = SNDRV_CTL_ELEM_IFACE_MIXER,\n\t\t.name = \"Exchange Front/Surround\",\n\t\t.info = snd_ac97_ad1888_lohpsel_info,\n\t\t.get = snd_ac97_ad1888_lohpsel_get,\n\t\t.put = snd_ac97_ad1888_lohpsel_put\n\t},\n\tAC97_SINGLE(\"V_REFOUT Enable\", AC97_AD_MISC, AC97_AD_VREFD_SHIFT, 1, 1),\n\tAC97_SINGLE(\"High Pass Filter Enable\", AC97_AD_TEST2,\n\t\t\tAC97_AD_HPFD_SHIFT, 1, 1),\n\tAC97_SINGLE(\"Spread Front to Surround and Center/LFE\", AC97_AD_MISC, 7, 1, 0),\n\t{\n\t\t.iface = SNDRV_CTL_ELEM_IFACE_MIXER,\n\t\t.name = \"Downmix\",\n\t\t.info = snd_ac97_ad1888_downmix_info,\n\t\t.get = snd_ac97_ad1888_downmix_get,\n\t\t.put = snd_ac97_ad1888_downmix_put\n\t},\n\tAC97_SURROUND_JACK_MODE_CTL,\n\tAC97_CHANNEL_MODE_CTL,\n\n\tAC97_SINGLE(\"Headphone Jack Sense\", AC97_AD_JACK_SPDIF, 10, 1, 0),\n\tAC97_SINGLE(\"Line Jack Sense\", AC97_AD_JACK_SPDIF, 12, 1, 0),\n};\n\nstatic int patch_ad1888_specific(struct snd_ac97 *ac97)\n{\n\tif (!ac97->spec.ad18xx.lo_as_master) {\n\t\t \n\t\tsnd_ac97_rename_vol_ctl(ac97, \"Master Playback\",\n\t\t\t\t\t\"Master Surround Playback\");\n\t\tsnd_ac97_rename_vol_ctl(ac97, \"Headphone Playback\",\n\t\t\t\t\t\"Master Playback\");\n\t}\n\treturn patch_build_controls(ac97, snd_ac97_ad1888_controls, ARRAY_SIZE(snd_ac97_ad1888_controls));\n}\n\nstatic const struct snd_ac97_build_ops patch_ad1888_build_ops = {\n\t.build_post_spdif = patch_ad198x_post_spdif,\n\t.build_specific = patch_ad1888_specific,\n#ifdef CONFIG_PM\n\t.resume = ad1888_resume,\n#endif\n\t.update_jacks = ad1888_update_jacks,\n};\n\nstatic int patch_ad1888(struct snd_ac97 * ac97)\n{\n\tunsigned short misc;\n\t\n\tpatch_ad1881(ac97);\n\tac97->build_ops = &patch_ad1888_build_ops;\n\n\t \n\tif (ac97->subsystem_vendor == 0x1043 &&\n\t    ac97->subsystem_device == 0x1193)  \n\t\tac97->spec.ad18xx.lo_as_master = 1;\n\n\tmisc = snd_ac97_read(ac97, AC97_AD_MISC);\n\t \n\t \n\tmisc |= AC97_AD198X_MSPLT | AC97_AD198X_AC97NC;\n\tif (!ac97->spec.ad18xx.lo_as_master)\n\t\t \n\t\t \n\t\tmisc |= AC97_AD198X_LOSEL | AC97_AD198X_HPSEL;\n\n\tsnd_ac97_write_cache(ac97, AC97_AD_MISC, misc);\n\tac97->flags |= AC97_STEREO_MUTES;\n\treturn 0;\n}\n\nstatic int patch_ad1980_specific(struct snd_ac97 *ac97)\n{\n\tint err;\n\n\terr = patch_ad1888_specific(ac97);\n\tif (err < 0)\n\t\treturn err;\n\treturn patch_build_controls(ac97, &snd_ac97_ad198x_2cmic, 1);\n}\n\nstatic const struct snd_ac97_build_ops patch_ad1980_build_ops = {\n\t.build_post_spdif = patch_ad198x_post_spdif,\n\t.build_specific = patch_ad1980_specific,\n#ifdef CONFIG_PM\n\t.resume = ad18xx_resume,\n#endif\n\t.update_jacks = ad1888_update_jacks,\n};\n\nstatic int patch_ad1980(struct snd_ac97 * ac97)\n{\n\tpatch_ad1888(ac97);\n\tac97->build_ops = &patch_ad1980_build_ops;\n\treturn 0;\n}\n\nstatic int snd_ac97_ad1985_vrefout_info(struct snd_kcontrol *kcontrol,\n\t\t\t\t\tstruct snd_ctl_elem_info *uinfo)\n{\n\tstatic const char * const texts[4] = {\n\t\t\"High-Z\", \"3.7 V\", \"2.25 V\", \"0 V\"\n\t};\n\n\treturn snd_ctl_enum_info(uinfo, 1, 4, texts);\n}\n\nstatic int snd_ac97_ad1985_vrefout_get(struct snd_kcontrol *kcontrol,\n\t\t\t\t       struct snd_ctl_elem_value *ucontrol)\n{\n\tstatic const int reg2ctrl[4] = {2, 0, 1, 3};\n\tstruct snd_ac97 *ac97 = snd_kcontrol_chip(kcontrol);\n\tunsigned short val;\n\tval = (ac97->regs[AC97_AD_MISC] & AC97_AD198X_VREF_MASK)\n\t      >> AC97_AD198X_VREF_SHIFT;\n\tucontrol->value.enumerated.item[0] = reg2ctrl[val];\n\treturn 0;\n}\n\nstatic int snd_ac97_ad1985_vrefout_put(struct snd_kcontrol *kcontrol, \n\t\t\t\t       struct snd_ctl_elem_value *ucontrol)\n{\n\tstatic const int ctrl2reg[4] = {1, 2, 0, 3};\n\tstruct snd_ac97 *ac97 = snd_kcontrol_chip(kcontrol);\n\tunsigned short val;\n\n\tif (ucontrol->value.enumerated.item[0] > 3)\n\t\treturn -EINVAL;\n\tval = ctrl2reg[ucontrol->value.enumerated.item[0]]\n\t      << AC97_AD198X_VREF_SHIFT;\n\treturn snd_ac97_update_bits(ac97, AC97_AD_MISC,\n\t\t\t\t    AC97_AD198X_VREF_MASK, val);\n}\n\nstatic const struct snd_kcontrol_new snd_ac97_ad1985_controls[] = {\n\tAC97_SINGLE(\"Exchange Center/LFE\", AC97_AD_SERIAL_CFG, 3, 1, 0),\n\t{\n\t\t.iface = SNDRV_CTL_ELEM_IFACE_MIXER,\n\t\t.name = \"Exchange Front/Surround\",\n\t\t.info = snd_ac97_ad1888_lohpsel_info,\n\t\t.get = snd_ac97_ad1888_lohpsel_get,\n\t\t.put = snd_ac97_ad1888_lohpsel_put\n\t},\n\tAC97_SINGLE(\"High Pass Filter Enable\", AC97_AD_TEST2, 12, 1, 1),\n\tAC97_SINGLE(\"Spread Front to Surround and Center/LFE\",\n\t\t    AC97_AD_MISC, 7, 1, 0),\n\t{\n\t\t.iface = SNDRV_CTL_ELEM_IFACE_MIXER,\n\t\t.name = \"Downmix\",\n\t\t.info = snd_ac97_ad1888_downmix_info,\n\t\t.get = snd_ac97_ad1888_downmix_get,\n\t\t.put = snd_ac97_ad1888_downmix_put\n\t},\n\t{\n\t\t.iface = SNDRV_CTL_ELEM_IFACE_MIXER,\n\t\t.name = \"V_REFOUT\",\n\t\t.info = snd_ac97_ad1985_vrefout_info,\n\t\t.get = snd_ac97_ad1985_vrefout_get,\n\t\t.put = snd_ac97_ad1985_vrefout_put\n\t},\n\tAC97_SURROUND_JACK_MODE_CTL,\n\tAC97_CHANNEL_MODE_CTL,\n\n\tAC97_SINGLE(\"Headphone Jack Sense\", AC97_AD_JACK_SPDIF, 10, 1, 0),\n\tAC97_SINGLE(\"Line Jack Sense\", AC97_AD_JACK_SPDIF, 12, 1, 0),\n};\n\nstatic void ad1985_update_jacks(struct snd_ac97 *ac97)\n{\n\tad1888_update_jacks(ac97);\n\t \n\tsnd_ac97_update_bits(ac97, AC97_AD_SERIAL_CFG, 1 << 9,\n\t\t\t     is_shared_micin(ac97) ? 1 << 9 : 0);\n}\n\nstatic int patch_ad1985_specific(struct snd_ac97 *ac97)\n{\n\tint err;\n\n\t \n\tsnd_ac97_rename_vol_ctl(ac97, \"Master Playback\",\n\t\t\t\t\"Master Surround Playback\");\n\tsnd_ac97_rename_vol_ctl(ac97, \"Headphone Playback\", \"Master Playback\");\n\n\terr = patch_build_controls(ac97, &snd_ac97_ad198x_2cmic, 1);\n\tif (err < 0)\n\t\treturn err;\n\n\treturn patch_build_controls(ac97, snd_ac97_ad1985_controls,\n\t\t\t\t    ARRAY_SIZE(snd_ac97_ad1985_controls));\n}\n\nstatic const struct snd_ac97_build_ops patch_ad1985_build_ops = {\n\t.build_post_spdif = patch_ad198x_post_spdif,\n\t.build_specific = patch_ad1985_specific,\n#ifdef CONFIG_PM\n\t.resume = ad18xx_resume,\n#endif\n\t.update_jacks = ad1985_update_jacks,\n};\n\nstatic int patch_ad1985(struct snd_ac97 * ac97)\n{\n\tunsigned short misc;\n\t\n\tpatch_ad1881(ac97);\n\tac97->build_ops = &patch_ad1985_build_ops;\n\tmisc = snd_ac97_read(ac97, AC97_AD_MISC);\n\t \n\t \n\t \n\tsnd_ac97_write_cache(ac97, AC97_AD_MISC, misc |\n\t\t\t     AC97_AD198X_LOSEL |\n\t\t\t     AC97_AD198X_HPSEL |\n\t\t\t     AC97_AD198X_MSPLT |\n\t\t\t     AC97_AD198X_AC97NC);\n\tac97->flags |= AC97_STEREO_MUTES;\n\n\t \n\tad1985_update_jacks(ac97);\n\n\t \n\tac97->ext_id = (ac97->ext_id & ~AC97_EI_REV_MASK) | AC97_EI_REV_23;\n\treturn 0;\n}\n\n#define snd_ac97_ad1986_bool_info\tsnd_ctl_boolean_mono_info\n\nstatic int snd_ac97_ad1986_lososel_get(struct snd_kcontrol *kcontrol,\n\t\t\t\t       struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_ac97 *ac97 = snd_kcontrol_chip(kcontrol);\n\tunsigned short val;\n\n\tval = ac97->regs[AC97_AD_MISC3];\n\tucontrol->value.integer.value[0] = (val & AC97_AD1986_LOSEL) != 0;\n\treturn 0;\n}\n\nstatic int snd_ac97_ad1986_lososel_put(struct snd_kcontrol *kcontrol,\n\t\t\t\t       struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_ac97 *ac97 = snd_kcontrol_chip(kcontrol);\n\tint ret0;\n\tint ret1;\n\tint sprd = (ac97->regs[AC97_AD_MISC] & AC97_AD1986_SPRD) != 0;\n\n\tret0 = snd_ac97_update_bits(ac97, AC97_AD_MISC3, AC97_AD1986_LOSEL,\n\t\t\t\t\tucontrol->value.integer.value[0] != 0\n\t\t\t\t    ? AC97_AD1986_LOSEL : 0);\n\tif (ret0 < 0)\n\t\treturn ret0;\n\n\t \n\tret1 = snd_ac97_update_bits(ac97, AC97_AD_MISC, AC97_AD1986_SOSEL,\n\t\t\t\t    (ucontrol->value.integer.value[0] != 0\n\t\t\t\t     || sprd)\n\t\t\t\t    ? AC97_AD1986_SOSEL : 0);\n\tif (ret1 < 0)\n\t\treturn ret1;\n\n\treturn (ret0 > 0 || ret1 > 0) ? 1 : 0;\n}\n\nstatic int snd_ac97_ad1986_spread_get(struct snd_kcontrol *kcontrol,\n\t\t\t\t      struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_ac97 *ac97 = snd_kcontrol_chip(kcontrol);\n\tunsigned short val;\n\n\tval = ac97->regs[AC97_AD_MISC];\n\tucontrol->value.integer.value[0] = (val & AC97_AD1986_SPRD) != 0;\n\treturn 0;\n}\n\nstatic int snd_ac97_ad1986_spread_put(struct snd_kcontrol *kcontrol,\n\t\t\t\t      struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_ac97 *ac97 = snd_kcontrol_chip(kcontrol);\n\tint ret0;\n\tint ret1;\n\tint sprd = (ac97->regs[AC97_AD_MISC3] & AC97_AD1986_LOSEL) != 0;\n\n\tret0 = snd_ac97_update_bits(ac97, AC97_AD_MISC, AC97_AD1986_SPRD,\n\t\t\t\t\tucontrol->value.integer.value[0] != 0\n\t\t\t\t    ? AC97_AD1986_SPRD : 0);\n\tif (ret0 < 0)\n\t\treturn ret0;\n\n\t \n\tret1 = snd_ac97_update_bits(ac97, AC97_AD_MISC, AC97_AD1986_SOSEL,\n\t\t\t\t    (ucontrol->value.integer.value[0] != 0\n\t\t\t\t     || sprd)\n\t\t\t\t    ? AC97_AD1986_SOSEL : 0);\n\tif (ret1 < 0)\n\t\treturn ret1;\n\n\treturn (ret0 > 0 || ret1 > 0) ? 1 : 0;\n}\n\nstatic int snd_ac97_ad1986_miclisel_get(struct snd_kcontrol *kcontrol,\n\t\t\t\t\tstruct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_ac97 *ac97 = snd_kcontrol_chip(kcontrol);\n\n\tucontrol->value.integer.value[0] = ac97->spec.ad18xx.swap_mic_linein;\n\treturn 0;\n}\n\nstatic int snd_ac97_ad1986_miclisel_put(struct snd_kcontrol *kcontrol,\n\t\t\t\t\tstruct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_ac97 *ac97 = snd_kcontrol_chip(kcontrol);\n\tunsigned char swap = ucontrol->value.integer.value[0] != 0;\n\n\tif (swap != ac97->spec.ad18xx.swap_mic_linein) {\n\t\tac97->spec.ad18xx.swap_mic_linein = swap;\n\t\tif (ac97->build_ops->update_jacks)\n\t\t\tac97->build_ops->update_jacks(ac97);\n\t\treturn 1;\n\t}\n\treturn 0;\n}\n\nstatic int snd_ac97_ad1986_vrefout_get(struct snd_kcontrol *kcontrol,\n\t\t\t\t       struct snd_ctl_elem_value *ucontrol)\n{\n\t \n\tstruct snd_ac97 *ac97 = snd_kcontrol_chip(kcontrol);\n\tunsigned short val;\n\tunsigned short reg = ac97->regs[AC97_AD_MISC2];\n\tif ((reg & AC97_AD1986_MVREF0) != 0)\n\t\tval = 2;\n\telse if ((reg & AC97_AD1986_MVREF1) != 0)\n\t\tval = 3;\n\telse if ((reg & AC97_AD1986_MVREF2) != 0)\n\t\tval = 1;\n\telse\n\t\tval = 0;\n\tucontrol->value.enumerated.item[0] = val;\n\treturn 0;\n}\n\nstatic int snd_ac97_ad1986_vrefout_put(struct snd_kcontrol *kcontrol,\n\t\t\t\t       struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_ac97 *ac97 = snd_kcontrol_chip(kcontrol);\n\tunsigned short cval;\n\tunsigned short lval;\n\tunsigned short mval;\n\tint cret;\n\tint lret;\n\tint mret;\n\n\tswitch (ucontrol->value.enumerated.item[0])\n\t{\n\tcase 0:  \n\t\tcval = 0;\n\t\tlval = 0;\n\t\tmval = 0;\n\t\tbreak;\n\tcase 1:  \n\t\tcval = AC97_AD1986_CVREF2;\n\t\tlval = AC97_AD1986_LVREF2;\n\t\tmval = AC97_AD1986_MVREF2;\n\t\tbreak;\n\tcase 2:  \n\t\tcval = AC97_AD1986_CVREF0;\n\t\tlval = AC97_AD1986_LVREF0;\n\t\tmval = AC97_AD1986_MVREF0;\n\t\tbreak;\n\tcase 3:  \n\t\tcval = AC97_AD1986_CVREF1;\n\t\tlval = AC97_AD1986_LVREF1;\n\t\tmval = AC97_AD1986_MVREF1;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tcret = snd_ac97_update_bits(ac97, AC97_AD_MISC2,\n\t\t\t\t    AC97_AD1986_CVREF_MASK, cval);\n\tif (cret < 0)\n\t\treturn cret;\n\tlret = snd_ac97_update_bits(ac97, AC97_AD_MISC3,\n\t\t\t\t    AC97_AD1986_LVREF_MASK, lval);\n\tif (lret < 0)\n\t\treturn lret;\n\tmret = snd_ac97_update_bits(ac97, AC97_AD_MISC2,\n\t\t\t\t    AC97_AD1986_MVREF_MASK, mval);\n\tif (mret < 0)\n\t\treturn mret;\n\n\treturn (cret > 0 || lret > 0 || mret > 0) ? 1 : 0;\n}\n\nstatic const struct snd_kcontrol_new snd_ac97_ad1986_controls[] = {\n\tAC97_SINGLE(\"Exchange Center/LFE\", AC97_AD_SERIAL_CFG, 3, 1, 0),\n\t{\n\t\t.iface = SNDRV_CTL_ELEM_IFACE_MIXER,\n\t\t.name = \"Exchange Front/Surround\",\n\t\t.info = snd_ac97_ad1986_bool_info,\n\t\t.get = snd_ac97_ad1986_lososel_get,\n\t\t.put = snd_ac97_ad1986_lososel_put\n\t},\n\t{\n\t\t.iface = SNDRV_CTL_ELEM_IFACE_MIXER,\n\t\t.name = \"Exchange Mic/Line In\",\n\t\t.info = snd_ac97_ad1986_bool_info,\n\t\t.get = snd_ac97_ad1986_miclisel_get,\n\t\t.put = snd_ac97_ad1986_miclisel_put\n\t},\n\t{\n\t\t.iface = SNDRV_CTL_ELEM_IFACE_MIXER,\n\t\t.name = \"Spread Front to Surround and Center/LFE\",\n\t\t.info = snd_ac97_ad1986_bool_info,\n\t\t.get = snd_ac97_ad1986_spread_get,\n\t\t.put = snd_ac97_ad1986_spread_put\n\t},\n\t{\n\t\t.iface = SNDRV_CTL_ELEM_IFACE_MIXER,\n\t\t.name = \"Downmix\",\n\t\t.info = snd_ac97_ad1888_downmix_info,\n\t\t.get = snd_ac97_ad1888_downmix_get,\n\t\t.put = snd_ac97_ad1888_downmix_put\n\t},\n\t{\n\t\t.iface = SNDRV_CTL_ELEM_IFACE_MIXER,\n\t\t.name = \"V_REFOUT\",\n\t\t.info = snd_ac97_ad1985_vrefout_info,\n\t\t.get = snd_ac97_ad1986_vrefout_get,\n\t\t.put = snd_ac97_ad1986_vrefout_put\n\t},\n\tAC97_SURROUND_JACK_MODE_CTL,\n\tAC97_CHANNEL_MODE_CTL,\n\n\tAC97_SINGLE(\"Headphone Jack Sense\", AC97_AD_JACK_SPDIF, 10, 1, 0),\n\tAC97_SINGLE(\"Line Jack Sense\", AC97_AD_JACK_SPDIF, 12, 1, 0)\n};\n\nstatic void ad1986_update_jacks(struct snd_ac97 *ac97)\n{\n\tunsigned short misc_val = 0;\n\tunsigned short ser_val;\n\n\t \n\tif (!is_surround_on(ac97))\n\t\tmisc_val |= AC97_AD1986_SODIS;\n\tif (!is_clfe_on(ac97))\n\t\tmisc_val |= AC97_AD1986_CLDIS;\n\n\t \n\tif (is_shared_linein(ac97))\n\t\tmisc_val |= AC97_AD1986_LISEL_SURR;\n\telse if (ac97->spec.ad18xx.swap_mic_linein != 0)\n\t\tmisc_val |= AC97_AD1986_LISEL_MIC;\n\tsnd_ac97_update_bits(ac97, AC97_AD_MISC,\n\t\t\t     AC97_AD1986_SODIS | AC97_AD1986_CLDIS |\n\t\t\t     AC97_AD1986_LISEL_MASK,\n\t\t\t     misc_val);\n\n\t \n\tif (is_shared_micin(ac97))\n\t\tser_val = AC97_AD1986_OMS_C;\n\telse if (ac97->spec.ad18xx.swap_mic_linein != 0)\n\t\tser_val = AC97_AD1986_OMS_L;\n\telse\n\t\tser_val = AC97_AD1986_OMS_M;\n\tsnd_ac97_update_bits(ac97, AC97_AD_SERIAL_CFG,\n\t\t\t     AC97_AD1986_OMS_MASK,\n\t\t\t     ser_val);\n}\n\nstatic int patch_ad1986_specific(struct snd_ac97 *ac97)\n{\n\tint err;\n\n\terr = patch_build_controls(ac97, &snd_ac97_ad198x_2cmic, 1);\n\tif (err < 0)\n\t\treturn err;\n\n\treturn patch_build_controls(ac97, snd_ac97_ad1986_controls,\n\t\t\t\t    ARRAY_SIZE(snd_ac97_ad1985_controls));\n}\n\nstatic const struct snd_ac97_build_ops patch_ad1986_build_ops = {\n\t.build_post_spdif = patch_ad198x_post_spdif,\n\t.build_specific = patch_ad1986_specific,\n#ifdef CONFIG_PM\n\t.resume = ad18xx_resume,\n#endif\n\t.update_jacks = ad1986_update_jacks,\n};\n\nstatic int patch_ad1986(struct snd_ac97 * ac97)\n{\n\tpatch_ad1881(ac97);\n\tac97->build_ops = &patch_ad1986_build_ops;\n\tac97->flags |= AC97_STEREO_MUTES;\n\n\t \n\tad1986_update_jacks(ac97);\n\n\treturn 0;\n}\n\n \nstatic int patch_alc203(struct snd_ac97 *ac97)\n{\n\tsnd_ac97_update_bits(ac97, 0x7a, 0x400, 0x400);\n\treturn 0;\n}\n\n \nstatic void alc650_update_jacks(struct snd_ac97 *ac97)\n{\n\tint shared;\n\t\n\t \n\tshared = is_shared_surrout(ac97);\n\tsnd_ac97_update_bits(ac97, AC97_ALC650_MULTICH, 1 << 9,\n\t\t\t     shared ? (1 << 9) : 0);\n\t \n\tshared = is_shared_clfeout(ac97);\n\t \n\tsnd_ac97_update_bits(ac97, AC97_ALC650_CLOCK, 1 << 12,\n\t\t\t     shared ? (1 << 12) : 0);\n\t \n\tsnd_ac97_update_bits(ac97, AC97_ALC650_MULTICH, 1 << 10,\n\t\t\t     shared ? (1 << 10) : 0);\n\t \n\tsnd_ac97_update_bits(ac97, AC97_ALC650_GPIO_STATUS, 0x100,\n\t\t\t     shared ? 0 : 0x100);\n}\n\nstatic int alc650_swap_surround_put(struct snd_kcontrol *kcontrol,\n\t\t\t\t    struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_ac97 *ac97 = snd_kcontrol_chip(kcontrol);\n\tstruct snd_pcm_chmap *map = ac97->chmaps[SNDRV_PCM_STREAM_PLAYBACK];\n\n\tif (map) {\n\t\tif (ucontrol->value.integer.value[0])\n\t\t\tmap->chmap = snd_pcm_std_chmaps;\n\t\telse\n\t\t\tmap->chmap = snd_pcm_alt_chmaps;\n\t}\n\treturn snd_ac97_put_volsw(kcontrol, ucontrol);\n}\n\nstatic const struct snd_kcontrol_new snd_ac97_controls_alc650[] = {\n\tAC97_SINGLE(\"Duplicate Front\", AC97_ALC650_MULTICH, 0, 1, 0),\n\tAC97_SINGLE(\"Surround Down Mix\", AC97_ALC650_MULTICH, 1, 1, 0),\n\tAC97_SINGLE(\"Center/LFE Down Mix\", AC97_ALC650_MULTICH, 2, 1, 0),\n\tAC97_SINGLE(\"Exchange Center/LFE\", AC97_ALC650_MULTICH, 3, 1, 0),\n\t \n\t \n\t \n\t \n\t \n\t \n\t \n\t \n\t{\n\t\t.iface = SNDRV_CTL_ELEM_IFACE_MIXER,\n\t\t.name = \"Swap Surround Slot\",\n\t\t.info = snd_ac97_info_volsw,\n\t\t.get = snd_ac97_get_volsw,\n\t\t.put = alc650_swap_surround_put,\n\t\t.private_value =  AC97_SINGLE_VALUE(AC97_ALC650_MULTICH, 14, 1, 0),\n\t},\n#if 0  \n\tAC97_SINGLE(\"IEC958 Input Clock Enable\", AC97_ALC650_CLOCK, 0, 1, 0),\n\tAC97_SINGLE(\"IEC958 Input Pin Enable\", AC97_ALC650_CLOCK, 1, 1, 0),\n\tAC97_SINGLE(\"Surround DAC Switch\", AC97_ALC650_SURR_DAC_VOL, 15, 1, 1),\n\tAC97_DOUBLE(\"Surround DAC Volume\", AC97_ALC650_SURR_DAC_VOL, 8, 0, 31, 1),\n\tAC97_SINGLE(\"Center/LFE DAC Switch\", AC97_ALC650_LFE_DAC_VOL, 15, 1, 1),\n\tAC97_DOUBLE(\"Center/LFE DAC Volume\", AC97_ALC650_LFE_DAC_VOL, 8, 0, 31, 1),\n#endif\n\tAC97_SURROUND_JACK_MODE_CTL,\n\tAC97_CHANNEL_MODE_CTL,\n};\n\nstatic const struct snd_kcontrol_new snd_ac97_spdif_controls_alc650[] = {\n        AC97_SINGLE(SNDRV_CTL_NAME_IEC958(\"\",CAPTURE,SWITCH), AC97_ALC650_MULTICH, 11, 1, 0),\n        AC97_SINGLE(\"Analog to IEC958 Output\", AC97_ALC650_MULTICH, 12, 1, 0),\n\t \n\t \n};\n\nstatic const DECLARE_TLV_DB_SCALE(db_scale_5bit_3db_max, -4350, 150, 0);\n\nstatic int patch_alc650_specific(struct snd_ac97 * ac97)\n{\n\tint err;\n\n\terr = patch_build_controls(ac97, snd_ac97_controls_alc650, ARRAY_SIZE(snd_ac97_controls_alc650));\n\tif (err < 0)\n\t\treturn err;\n\tif (ac97->ext_id & AC97_EI_SPDIF) {\n\t\terr = patch_build_controls(ac97, snd_ac97_spdif_controls_alc650, ARRAY_SIZE(snd_ac97_spdif_controls_alc650));\n\t\tif (err < 0)\n\t\t\treturn err;\n\t}\n\tif (ac97->id != AC97_ID_ALC650F)\n\t\treset_tlv(ac97, \"Master Playback Volume\",\n\t\t\t  db_scale_5bit_3db_max);\n\treturn 0;\n}\n\nstatic const struct snd_ac97_build_ops patch_alc650_ops = {\n\t.build_specific\t= patch_alc650_specific,\n\t.update_jacks = alc650_update_jacks\n};\n\nstatic int patch_alc650(struct snd_ac97 * ac97)\n{\n\tunsigned short val;\n\n\tac97->build_ops = &patch_alc650_ops;\n\n\t \n\tval = snd_ac97_read(ac97, AC97_ALC650_REVISION) & 0x3f;\n\tif (val < 3)\n\t\tac97->id = 0x414c4720;           \n\telse if (val < 0x10)\n\t\tac97->id = 0x414c4721;           \n\telse if (val < 0x20)\n\t\tac97->id = 0x414c4722;           \n\telse if (val < 0x30)\n\t\tac97->id = 0x414c4723;           \n\n\t \n\t \n\tac97->spec.dev_flags = (ac97->id == 0x414c4722 ||\n\t\t\t\tac97->id == 0x414c4723);\n\n\t \n\tsnd_ac97_write_cache(ac97, AC97_ALC650_GPIO_STATUS, \n\t\tsnd_ac97_read(ac97, AC97_ALC650_GPIO_STATUS) | 0x8000);\n\n\t \n\tval = snd_ac97_read(ac97, AC97_ALC650_CLOCK);\n\t \n\tif (ac97->spec.dev_flags &&\n\t     \n\t    ! (ac97->subsystem_vendor == 0x1043 &&\n\t       ac97->subsystem_device == 0x1103))\n\t\tval |= 0x03;  \n\telse\n\t\tval &= ~0x03;  \n\tsnd_ac97_write_cache(ac97, AC97_ALC650_CLOCK, val);\n\n\t \n\tsnd_ac97_write_cache(ac97, AC97_ALC650_MULTICH, 0);\n\n\t \n\t \n\tsnd_ac97_write_cache(ac97, AC97_ALC650_GPIO_SETUP,\n\t\t\t     snd_ac97_read(ac97, AC97_ALC650_GPIO_SETUP) | 0x01);\n\tsnd_ac97_write_cache(ac97, AC97_ALC650_GPIO_STATUS,\n\t\t\t     (snd_ac97_read(ac97, AC97_ALC650_GPIO_STATUS) | 0x100) & ~0x10);\n\n\t \n\tsnd_ac97_write_cache(ac97, AC97_ALC650_SURR_DAC_VOL, 0x0808);\n\tsnd_ac97_write_cache(ac97, AC97_ALC650_LFE_DAC_VOL, 0x0808);\n\treturn 0;\n}\n\nstatic void alc655_update_jacks(struct snd_ac97 *ac97)\n{\n\tint shared;\n\t\n\t \n\tshared = is_shared_surrout(ac97);\n\tac97_update_bits_page(ac97, AC97_ALC650_MULTICH, 1 << 9,\n\t\t\t      shared ? (1 << 9) : 0, 0);\n\t \n\tshared = is_shared_clfeout(ac97);\n\t \n\tsnd_ac97_update_bits(ac97, AC97_ALC650_CLOCK, 1 << 12,\n\t\t\t     shared ? (1 << 12) : 0);\n\tac97_update_bits_page(ac97, AC97_ALC650_MULTICH, 1 << 10,\n\t\t\t      shared ? (1 << 10) : 0, 0);\n}\n\nstatic const struct snd_kcontrol_new snd_ac97_controls_alc655[] = {\n\tAC97_PAGE_SINGLE(\"Duplicate Front\", AC97_ALC650_MULTICH, 0, 1, 0, 0),\n\tAC97_SURROUND_JACK_MODE_CTL,\n\tAC97_CHANNEL_MODE_CTL,\n};\n\nstatic int alc655_iec958_route_info(struct snd_kcontrol *kcontrol, struct snd_ctl_elem_info *uinfo)\n{\n\tstatic const char * const texts_655[3] = {\n\t\t\"PCM\", \"Analog In\", \"IEC958 In\"\n\t};\n\tstatic const char * const texts_658[4] = {\n\t\t\"PCM\", \"Analog1 In\", \"Analog2 In\", \"IEC958 In\"\n\t};\n\tstruct snd_ac97 *ac97 = snd_kcontrol_chip(kcontrol);\n\n\tif (ac97->spec.dev_flags)\n\t\treturn snd_ctl_enum_info(uinfo, 1, 4, texts_658);\n\telse\n\t\treturn snd_ctl_enum_info(uinfo, 1, 3, texts_655);\n}\n\nstatic int alc655_iec958_route_get(struct snd_kcontrol *kcontrol, struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_ac97 *ac97 = snd_kcontrol_chip(kcontrol);\n\tunsigned short val;\n\n\tval = ac97->regs[AC97_ALC650_MULTICH];\n\tval = (val >> 12) & 3;\n\tif (ac97->spec.dev_flags && val == 3)\n\t\tval = 0;\n\tucontrol->value.enumerated.item[0] = val;\n\treturn 0;\n}\n\nstatic int alc655_iec958_route_put(struct snd_kcontrol *kcontrol, struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_ac97 *ac97 = snd_kcontrol_chip(kcontrol);\n\n\treturn ac97_update_bits_page(ac97, AC97_ALC650_MULTICH, 3 << 12,\n\t\t\t\t     (unsigned short)ucontrol->value.enumerated.item[0] << 12,\n\t\t\t\t     0);\n}\n\nstatic const struct snd_kcontrol_new snd_ac97_spdif_controls_alc655[] = {\n        AC97_PAGE_SINGLE(SNDRV_CTL_NAME_IEC958(\"\",CAPTURE,SWITCH), AC97_ALC650_MULTICH, 11, 1, 0, 0),\n\t \n         \n\t{\n\t\t.iface  = SNDRV_CTL_ELEM_IFACE_MIXER,\n\t\t.name   = SNDRV_CTL_NAME_IEC958(\"\",PLAYBACK,NONE) \"Source\",\n\t\t.info   = alc655_iec958_route_info,\n\t\t.get    = alc655_iec958_route_get,\n\t\t.put    = alc655_iec958_route_put,\n\t},\n};\n\nstatic int patch_alc655_specific(struct snd_ac97 * ac97)\n{\n\tint err;\n\n\terr = patch_build_controls(ac97, snd_ac97_controls_alc655, ARRAY_SIZE(snd_ac97_controls_alc655));\n\tif (err < 0)\n\t\treturn err;\n\tif (ac97->ext_id & AC97_EI_SPDIF) {\n\t\terr = patch_build_controls(ac97, snd_ac97_spdif_controls_alc655, ARRAY_SIZE(snd_ac97_spdif_controls_alc655));\n\t\tif (err < 0)\n\t\t\treturn err;\n\t}\n\treturn 0;\n}\n\nstatic const struct snd_ac97_build_ops patch_alc655_ops = {\n\t.build_specific\t= patch_alc655_specific,\n\t.update_jacks = alc655_update_jacks\n};\n\nstatic int patch_alc655(struct snd_ac97 * ac97)\n{\n\tunsigned int val;\n\n\tif (ac97->id == AC97_ID_ALC658) {\n\t\tac97->spec.dev_flags = 1;  \n\t\tif ((snd_ac97_read(ac97, AC97_ALC650_REVISION) & 0x3f) == 2) {\n\t\t\tac97->id = AC97_ID_ALC658D;\n\t\t\tac97->spec.dev_flags = 2;\n\t\t}\n\t}\n\n\tac97->build_ops = &patch_alc655_ops;\n\n\t \n\tsnd_ac97_update_bits(ac97, AC97_INT_PAGING, AC97_PAGE_MASK, AC97_PAGE_VENDOR);\n\n\t \n\tval = snd_ac97_read(ac97, 0x7a);  \n\tif (ac97->spec.dev_flags)  \n\t\tval &= ~(1 << 1);  \n\telse {  \n\t\tif (ac97->subsystem_vendor == 0x1462 &&\n\t\t    (ac97->subsystem_device == 0x0131 ||  \n\t\t     ac97->subsystem_device == 0x0161 ||  \n\t\t     ac97->subsystem_device == 0x0351 ||  \n\t\t     ac97->subsystem_device == 0x0471 ||  \n\t\t     ac97->subsystem_device == 0x0061))   \n\t\t\tval &= ~(1 << 1);  \n\t\telse\n\t\t\tval |= (1 << 1);  \n\t\t \n\t\tac97->ext_id |= AC97_EI_SPDIF;\n\t}\n\tval &= ~(1 << 12);  \n\tsnd_ac97_write_cache(ac97, 0x7a, val);\n\t \n\tsnd_ac97_write_cache(ac97, AC97_ALC650_MULTICH, 1<<15);\n\n\t \n\tsnd_ac97_write_cache(ac97, AC97_ALC650_SURR_DAC_VOL, 0x0808);\n\tsnd_ac97_write_cache(ac97, AC97_ALC650_LFE_DAC_VOL, 0x0808);\n\n\t \n\tif (ac97->id == AC97_ID_ALC658D)\n\t\tsnd_ac97_update_bits(ac97, 0x74, 0x0800, 0x0800);\n\n\treturn 0;\n}\n\n\n#define AC97_ALC850_JACK_SELECT\t0x76\n#define AC97_ALC850_MISC1\t0x7a\n#define AC97_ALC850_MULTICH    0x6a\n\nstatic void alc850_update_jacks(struct snd_ac97 *ac97)\n{\n\tint shared;\n\tint aux_is_back_surround;\n\t\n\t \n\tshared = is_shared_surrout(ac97);\n\t \n\tsnd_ac97_update_bits(ac97, AC97_ALC850_MISC1, (1<<4)|(1<<5),\n\t\t\t     shared ? (1<<5) : (1<<4));\n\t \n\tsnd_ac97_update_bits(ac97, AC97_ALC850_JACK_SELECT, 7 << 12,\n\t\t\t     shared ? (2<<12) : (0<<12));\n\t \n\tshared = is_shared_clfeout(ac97);\n\t \n\tsnd_ac97_update_bits(ac97, AC97_ALC850_MISC1, (1<<12)|(1<<13),\n\t\t\t     shared ? (1<<12) : (1<<13));\n\t \n\tsnd_ac97_update_bits(ac97, AC97_ALC850_JACK_SELECT, 7 << 4,\n\t\t\t     shared ? (5<<4) : (1<<4));\n\n\taux_is_back_surround = alc850_is_aux_back_surround(ac97);\n\t \n\tsnd_ac97_update_bits(ac97, AC97_ALC850_MULTICH, 1 << 10,\n\t\t\t\t aux_is_back_surround ? (1<<10) : (0<<10));\n}\n\nstatic const struct snd_kcontrol_new snd_ac97_controls_alc850[] = {\n\tAC97_PAGE_SINGLE(\"Duplicate Front\", AC97_ALC650_MULTICH, 0, 1, 0, 0),\n\tAC97_SINGLE(\"Mic Front Input Switch\", AC97_ALC850_JACK_SELECT, 15, 1, 1),\n\tAC97_SURROUND_JACK_MODE_CTL,\n\tAC97_CHANNEL_MODE_8CH_CTL,\n};\n\nstatic int patch_alc850_specific(struct snd_ac97 *ac97)\n{\n\tint err;\n\n\terr = patch_build_controls(ac97, snd_ac97_controls_alc850, ARRAY_SIZE(snd_ac97_controls_alc850));\n\tif (err < 0)\n\t\treturn err;\n\tif (ac97->ext_id & AC97_EI_SPDIF) {\n\t\terr = patch_build_controls(ac97, snd_ac97_spdif_controls_alc655, ARRAY_SIZE(snd_ac97_spdif_controls_alc655));\n\t\tif (err < 0)\n\t\t\treturn err;\n\t}\n\treturn 0;\n}\n\nstatic const struct snd_ac97_build_ops patch_alc850_ops = {\n\t.build_specific\t= patch_alc850_specific,\n\t.update_jacks = alc850_update_jacks\n};\n\nstatic int patch_alc850(struct snd_ac97 *ac97)\n{\n\tac97->build_ops = &patch_alc850_ops;\n\n\tac97->spec.dev_flags = 0;  \n\tac97->flags |= AC97_HAS_8CH;\n\n\t \n\tsnd_ac97_update_bits(ac97, AC97_INT_PAGING, AC97_PAGE_MASK, AC97_PAGE_VENDOR);\n\n\t \n\t \n\tsnd_ac97_write_cache(ac97, AC97_ALC650_MULTICH, 1<<15);\n\t \n\tsnd_ac97_write_cache(ac97, 0x7a, (1<<1)|(1<<4)|(0<<5)|(1<<6)|\n\t\t\t     (1<<7)|(0<<12)|(1<<13)|(0<<14));\n\t \n\tsnd_ac97_write_cache(ac97, 0x76, (0<<0)|(0<<2)|(1<<4)|(1<<7)|(2<<8)|\n\t\t\t     (1<<11)|(0<<12)|(1<<15));\n\n\t \n\tsnd_ac97_write_cache(ac97, AC97_ALC650_SURR_DAC_VOL, 0x0808);\n\tsnd_ac97_write_cache(ac97, AC97_ALC650_LFE_DAC_VOL, 0x0808);\n\treturn 0;\n}\n\nstatic int patch_aztech_azf3328_specific(struct snd_ac97 *ac97)\n{\n\tstruct snd_kcontrol *kctl_3d_center =\n\t\tsnd_ac97_find_mixer_ctl(ac97, \"3D Control - Center\");\n\tstruct snd_kcontrol *kctl_3d_depth =\n\t\tsnd_ac97_find_mixer_ctl(ac97, \"3D Control - Depth\");\n\n\t \n\tif (kctl_3d_center) {\n\t\tkctl_3d_center->private_value =\n\t\t\tAC97_SINGLE_VALUE(AC97_3D_CONTROL, 1, 0x07, 0);\n\t\tsnd_ac97_rename_vol_ctl(ac97,\n\t\t\t\"3D Control - Center\", \"3D Control - Width\"\n\t\t);\n\t}\n\tif (kctl_3d_depth)\n\t\tkctl_3d_depth->private_value =\n\t\t\tAC97_SINGLE_VALUE(AC97_3D_CONTROL, 8, 0x03, 0);\n\n\t \n\tsnd_ac97_rename_vol_ctl(ac97,\n\t\t\"Master Mono Playback\", \"Modem Playback\"\n\t);\n\tsnd_ac97_rename_vol_ctl(ac97,\n\t\t\"Headphone Playback\", \"FM Synth Playback\"\n\t);\n\n\treturn 0;\n}\n\nstatic const struct snd_ac97_build_ops patch_aztech_azf3328_ops = {\n\t.build_specific\t= patch_aztech_azf3328_specific\n};\n\nstatic int patch_aztech_azf3328(struct snd_ac97 *ac97)\n{\n\tac97->build_ops = &patch_aztech_azf3328_ops;\n\treturn 0;\n}\n\n \nstatic void cm9738_update_jacks(struct snd_ac97 *ac97)\n{\n\t \n\tsnd_ac97_update_bits(ac97, AC97_CM9738_VENDOR_CTRL, 1 << 10,\n\t\t\t     is_shared_surrout(ac97) ? (1 << 10) : 0);\n}\n\nstatic const struct snd_kcontrol_new snd_ac97_cm9738_controls[] = {\n\tAC97_SINGLE(\"Duplicate Front\", AC97_CM9738_VENDOR_CTRL, 13, 1, 0),\n\tAC97_SURROUND_JACK_MODE_CTL,\n\tAC97_CHANNEL_MODE_4CH_CTL,\n};\n\nstatic int patch_cm9738_specific(struct snd_ac97 * ac97)\n{\n\treturn patch_build_controls(ac97, snd_ac97_cm9738_controls, ARRAY_SIZE(snd_ac97_cm9738_controls));\n}\n\nstatic const struct snd_ac97_build_ops patch_cm9738_ops = {\n\t.build_specific\t= patch_cm9738_specific,\n\t.update_jacks = cm9738_update_jacks\n};\n\nstatic int patch_cm9738(struct snd_ac97 * ac97)\n{\n\tac97->build_ops = &patch_cm9738_ops;\n\t \n\t \n\tac97->flags |= AC97_HAS_NO_PCM_VOL;\n\tsnd_ac97_write_cache(ac97, AC97_PCM, 0x8000);\n\n\treturn 0;\n}\n\nstatic int snd_ac97_cmedia_spdif_playback_source_info(struct snd_kcontrol *kcontrol, struct snd_ctl_elem_info *uinfo)\n{\n\tstatic const char * const texts[] = { \"Analog\", \"Digital\" };\n\n\treturn snd_ctl_enum_info(uinfo, 1, 2, texts);\n}\n\nstatic int snd_ac97_cmedia_spdif_playback_source_get(struct snd_kcontrol *kcontrol, struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_ac97 *ac97 = snd_kcontrol_chip(kcontrol);\n\tunsigned short val;\n\n\tval = ac97->regs[AC97_CM9739_SPDIF_CTRL];\n\tucontrol->value.enumerated.item[0] = (val >> 1) & 0x01;\n\treturn 0;\n}\n\nstatic int snd_ac97_cmedia_spdif_playback_source_put(struct snd_kcontrol *kcontrol, struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_ac97 *ac97 = snd_kcontrol_chip(kcontrol);\n\n\treturn snd_ac97_update_bits(ac97, AC97_CM9739_SPDIF_CTRL,\n\t\t\t\t    0x01 << 1, \n\t\t\t\t    (ucontrol->value.enumerated.item[0] & 0x01) << 1);\n}\n\nstatic const struct snd_kcontrol_new snd_ac97_cm9739_controls_spdif[] = {\n\t \n\t{  \n\t\t.iface\t= SNDRV_CTL_ELEM_IFACE_MIXER,\n\t\t.name\t= SNDRV_CTL_NAME_IEC958(\"\",PLAYBACK,NONE) \"Source\",\n\t\t.info\t= snd_ac97_cmedia_spdif_playback_source_info,\n\t\t.get\t= snd_ac97_cmedia_spdif_playback_source_get,\n\t\t.put\t= snd_ac97_cmedia_spdif_playback_source_put,\n\t},\n\t \n\tAC97_SINGLE(SNDRV_CTL_NAME_IEC958(\"\",CAPTURE,NONE) \"Valid Switch\", AC97_CM9739_SPDIF_CTRL, 2, 1, 0),\n\t \n\tAC97_SINGLE(SNDRV_CTL_NAME_IEC958(\"\",CAPTURE,NONE) \"Monitor\", AC97_CM9739_SPDIF_CTRL, 3, 1, 0), \n\t \n\tAC97_SINGLE(SNDRV_CTL_NAME_IEC958(\"\",CAPTURE,SWITCH), AC97_CM9739_SPDIF_CTRL, 4, 1, 0),\n\t \n};\n\nstatic void cm9739_update_jacks(struct snd_ac97 *ac97)\n{\n\t \n\tsnd_ac97_update_bits(ac97, AC97_CM9739_MULTI_CHAN, 1 << 10,\n\t\t\t     is_shared_surrout(ac97) ? (1 << 10) : 0);\n\t \n\tsnd_ac97_update_bits(ac97, AC97_CM9739_MULTI_CHAN, 0x3000,\n\t\t\t     is_shared_clfeout(ac97) ? 0x1000 : 0x2000);\n}\n\nstatic const struct snd_kcontrol_new snd_ac97_cm9739_controls[] = {\n\tAC97_SURROUND_JACK_MODE_CTL,\n\tAC97_CHANNEL_MODE_CTL,\n};\n\nstatic int patch_cm9739_specific(struct snd_ac97 * ac97)\n{\n\treturn patch_build_controls(ac97, snd_ac97_cm9739_controls, ARRAY_SIZE(snd_ac97_cm9739_controls));\n}\n\nstatic int patch_cm9739_post_spdif(struct snd_ac97 * ac97)\n{\n\treturn patch_build_controls(ac97, snd_ac97_cm9739_controls_spdif, ARRAY_SIZE(snd_ac97_cm9739_controls_spdif));\n}\n\nstatic const struct snd_ac97_build_ops patch_cm9739_ops = {\n\t.build_specific\t= patch_cm9739_specific,\n\t.build_post_spdif = patch_cm9739_post_spdif,\n\t.update_jacks = cm9739_update_jacks\n};\n\nstatic int patch_cm9739(struct snd_ac97 * ac97)\n{\n\tunsigned short val;\n\n\tac97->build_ops = &patch_cm9739_ops;\n\n\t \n\tac97->flags |= AC97_HAS_NO_MASTER_VOL | AC97_HAS_NO_PCM_VOL;\n\tsnd_ac97_write_cache(ac97, AC97_MASTER, 0x8000);\n\tsnd_ac97_write_cache(ac97, AC97_PCM, 0x8000);\n\n\t \n\tval = snd_ac97_read(ac97, AC97_EXTENDED_STATUS);\n\tif (val & AC97_EA_SPCV) {\n\t\t \n\t\tsnd_ac97_write_cache(ac97, AC97_CM9739_SPDIF_CTRL,\n\t\t\t\t     snd_ac97_read(ac97, AC97_CM9739_SPDIF_CTRL) | 0x01);\n\t\tac97->rates[AC97_RATES_SPDIF] = SNDRV_PCM_RATE_48000;  \n\t} else {\n\t\tac97->ext_id &= ~AC97_EI_SPDIF;  \n\t\tac97->rates[AC97_RATES_SPDIF] = 0;\n\t}\n\n\t \n\t \n\t \n\t \n\t \n\t \n\t \n\t \n\t \n\tval = snd_ac97_read(ac97, AC97_CM9739_MULTI_CHAN) & (1 << 4);\n\tval |= (1 << 3);\n\tval |= (1 << 13);\n\tif (! (ac97->ext_id & AC97_EI_SPDIF))\n\t\tval |= (1 << 14);\n\tsnd_ac97_write_cache(ac97, AC97_CM9739_MULTI_CHAN, val);\n\n\t \n\tsnd_ac97_write_cache(ac97, 0x70, 0x0100);\n\tsnd_ac97_write_cache(ac97, 0x72, 0x0020);\n\t \n\tif (ac97->pci &&\n\t     ac97->subsystem_vendor == 0x1043 &&\n\t     ac97->subsystem_device == 0x1843) {\n\t\tsnd_ac97_write_cache(ac97, AC97_CM9739_SPDIF_CTRL,\n\t\t\tsnd_ac97_read(ac97, AC97_CM9739_SPDIF_CTRL) & ~0x01);\n\t\tsnd_ac97_write_cache(ac97, AC97_CM9739_MULTI_CHAN,\n\t\t\tsnd_ac97_read(ac97, AC97_CM9739_MULTI_CHAN) | (1 << 14));\n\t}\n\n\treturn 0;\n}\n\n#define AC97_CM9761_MULTI_CHAN\t0x64\n#define AC97_CM9761_FUNC\t0x66\n#define AC97_CM9761_SPDIF_CTRL\t0x6c\n\nstatic void cm9761_update_jacks(struct snd_ac97 *ac97)\n{\n\t \n\tstatic const unsigned short surr_on[3][2] = {\n\t\t{ 0x0008, 0x0000 },  \n\t\t{ 0x0000, 0x0008 },  \n\t\t{ 0x0000, 0x0008 },  \n\t};\n\tstatic const unsigned short clfe_on[3][2] = {\n\t\t{ 0x0000, 0x1000 },  \n\t\t{ 0x1000, 0x0000 },  \n\t\t{ 0x0000, 0x1000 },  \n\t};\n\tstatic const unsigned short surr_shared[3][2] = {\n\t\t{ 0x0000, 0x0400 },  \n\t\t{ 0x0000, 0x0400 },  \n\t\t{ 0x0000, 0x0400 },  \n\t};\n\tstatic const unsigned short clfe_shared[3][2] = {\n\t\t{ 0x2000, 0x0880 },  \n\t\t{ 0x0000, 0x2880 },  \n\t\t{ 0x2000, 0x0800 },  \n\t};\n\tunsigned short val = 0;\n\n\tval |= surr_on[ac97->spec.dev_flags][is_surround_on(ac97)];\n\tval |= clfe_on[ac97->spec.dev_flags][is_clfe_on(ac97)];\n\tval |= surr_shared[ac97->spec.dev_flags][is_shared_surrout(ac97)];\n\tval |= clfe_shared[ac97->spec.dev_flags][is_shared_clfeout(ac97)];\n\n\tsnd_ac97_update_bits(ac97, AC97_CM9761_MULTI_CHAN, 0x3c88, val);\n}\n\nstatic const struct snd_kcontrol_new snd_ac97_cm9761_controls[] = {\n\tAC97_SURROUND_JACK_MODE_CTL,\n\tAC97_CHANNEL_MODE_CTL,\n};\n\nstatic int cm9761_spdif_out_source_info(struct snd_kcontrol *kcontrol, struct snd_ctl_elem_info *uinfo)\n{\n\tstatic const char * const texts[] = { \"AC-Link\", \"ADC\", \"SPDIF-In\" };\n\n\treturn snd_ctl_enum_info(uinfo, 1, 3, texts);\n}\n\nstatic int cm9761_spdif_out_source_get(struct snd_kcontrol *kcontrol, struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_ac97 *ac97 = snd_kcontrol_chip(kcontrol);\n\n\tif (ac97->regs[AC97_CM9761_FUNC] & 0x1)\n\t\tucontrol->value.enumerated.item[0] = 2;  \n\telse if (ac97->regs[AC97_CM9761_SPDIF_CTRL] & 0x2)\n\t\tucontrol->value.enumerated.item[0] = 1;  \n\telse\n\t\tucontrol->value.enumerated.item[0] = 0;  \n\treturn 0;\n}\n\nstatic int cm9761_spdif_out_source_put(struct snd_kcontrol *kcontrol, struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_ac97 *ac97 = snd_kcontrol_chip(kcontrol);\n\n\tif (ucontrol->value.enumerated.item[0] == 2)\n\t\treturn snd_ac97_update_bits(ac97, AC97_CM9761_FUNC, 0x1, 0x1);\n\tsnd_ac97_update_bits(ac97, AC97_CM9761_FUNC, 0x1, 0);\n\treturn snd_ac97_update_bits(ac97, AC97_CM9761_SPDIF_CTRL, 0x2,\n\t\t\t\t    ucontrol->value.enumerated.item[0] == 1 ? 0x2 : 0);\n}\n\nstatic const char * const cm9761_dac_clock[] = {\n\t\"AC-Link\", \"SPDIF-In\", \"Both\"\n};\nstatic const struct ac97_enum cm9761_dac_clock_enum =\n\tAC97_ENUM_SINGLE(AC97_CM9761_SPDIF_CTRL, 9, 3, cm9761_dac_clock);\n\nstatic const struct snd_kcontrol_new snd_ac97_cm9761_controls_spdif[] = {\n\t{  \n\t\t.iface\t= SNDRV_CTL_ELEM_IFACE_MIXER,\n\t\t.name\t= SNDRV_CTL_NAME_IEC958(\"\",PLAYBACK,NONE) \"Source\",\n\t\t.info = cm9761_spdif_out_source_info,\n\t\t.get = cm9761_spdif_out_source_get,\n\t\t.put = cm9761_spdif_out_source_put,\n\t},\n\t \n\tAC97_SINGLE(SNDRV_CTL_NAME_IEC958(\"\",CAPTURE,NONE) \"Valid Switch\", AC97_CM9761_SPDIF_CTRL, 2, 1, 0),\n\t \n\tAC97_SINGLE(SNDRV_CTL_NAME_IEC958(\"\",CAPTURE,NONE) \"Monitor\", AC97_CM9761_SPDIF_CTRL, 3, 1, 0), \n\t \n\tAC97_SINGLE(SNDRV_CTL_NAME_IEC958(\"\",CAPTURE,SWITCH), AC97_CM9761_SPDIF_CTRL, 4, 1, 0),\n\t \n\tAC97_ENUM(\"DAC Clock Source\", cm9761_dac_clock_enum),\n};\n\nstatic int patch_cm9761_post_spdif(struct snd_ac97 * ac97)\n{\n\treturn patch_build_controls(ac97, snd_ac97_cm9761_controls_spdif, ARRAY_SIZE(snd_ac97_cm9761_controls_spdif));\n}\n\nstatic int patch_cm9761_specific(struct snd_ac97 * ac97)\n{\n\treturn patch_build_controls(ac97, snd_ac97_cm9761_controls, ARRAY_SIZE(snd_ac97_cm9761_controls));\n}\n\nstatic const struct snd_ac97_build_ops patch_cm9761_ops = {\n\t.build_specific\t= patch_cm9761_specific,\n\t.build_post_spdif = patch_cm9761_post_spdif,\n\t.update_jacks = cm9761_update_jacks\n};\n\nstatic int patch_cm9761(struct snd_ac97 *ac97)\n{\n\tunsigned short val;\n\n\t \n\t \n\tac97->flags |=   AC97_HAS_NO_PCM_VOL;\n\tsnd_ac97_write_cache(ac97, AC97_MASTER, 0x8808);\n\tsnd_ac97_write_cache(ac97, AC97_PCM, 0x8808);\n\n\tac97->spec.dev_flags = 0;  \n\tif (ac97->id == AC97_ID_CM9761_82) {\n\t\tunsigned short tmp;\n\t\t \n\t\tval = snd_ac97_read(ac97, AC97_INT_PAGING);\n\t\tsnd_ac97_write_cache(ac97, AC97_INT_PAGING, (val & ~0x0f) | 0x01);\n\t\ttmp = snd_ac97_read(ac97, 0x60);\n\t\tac97->spec.dev_flags = tmp & 1;  \n\t\tsnd_ac97_write_cache(ac97, AC97_INT_PAGING, val);\n\t} else if (ac97->id == AC97_ID_CM9761_83)\n\t\tac97->spec.dev_flags = 2;\n\n\tac97->build_ops = &patch_cm9761_ops;\n\n\t \n\t \n        ac97->ext_id |= AC97_EI_SPDIF;\n\t \n\tsnd_ac97_write_cache(ac97, AC97_EXTENDED_STATUS, 0x05c0);\n\t \n\tsnd_ac97_write_cache(ac97, AC97_CM9761_SPDIF_CTRL, 0x0001);  \n\tac97->rates[AC97_RATES_SPDIF] = SNDRV_PCM_RATE_48000;  \n\n\t \n\t \n\n#if 0\n\tif (ac97->spec.dev_flags)\n\t\tval = 0x0214;\n\telse\n\t\tval = 0x321c;\n#endif\n\tval = snd_ac97_read(ac97, AC97_CM9761_MULTI_CHAN);\n\tval |= (1 << 4);  \n\tsnd_ac97_write_cache(ac97, AC97_CM9761_MULTI_CHAN, val);\n\n\t \n\tsnd_ac97_write_cache(ac97, 0x70, 0x0100);\n\tsnd_ac97_write_cache(ac97, 0x72, 0x0020);\n\n\treturn 0;\n}\n       \n#define AC97_CM9780_SIDE\t0x60\n#define AC97_CM9780_JACK\t0x62\n#define AC97_CM9780_MIXER\t0x64\n#define AC97_CM9780_MULTI_CHAN\t0x66\n#define AC97_CM9780_SPDIF\t0x6c\n\nstatic const char * const cm9780_ch_select[] = {\n\t\"Front\", \"Side\", \"Center/LFE\", \"Rear\"\n};\nstatic const struct ac97_enum cm9780_ch_select_enum =\n\tAC97_ENUM_SINGLE(AC97_CM9780_MULTI_CHAN, 6, 4, cm9780_ch_select);\nstatic const struct snd_kcontrol_new cm9780_controls[] = {\n\tAC97_DOUBLE(\"Side Playback Switch\", AC97_CM9780_SIDE, 15, 7, 1, 1),\n\tAC97_DOUBLE(\"Side Playback Volume\", AC97_CM9780_SIDE, 8, 0, 31, 0),\n\tAC97_ENUM(\"Side Playback Route\", cm9780_ch_select_enum),\n};\n\nstatic int patch_cm9780_specific(struct snd_ac97 *ac97)\n{\n\treturn patch_build_controls(ac97, cm9780_controls, ARRAY_SIZE(cm9780_controls));\n}\n\nstatic const struct snd_ac97_build_ops patch_cm9780_ops = {\n\t.build_specific\t= patch_cm9780_specific,\n\t.build_post_spdif = patch_cm9761_post_spdif\t \n};\n\nstatic int patch_cm9780(struct snd_ac97 *ac97)\n{\n\tunsigned short val;\n\n\tac97->build_ops = &patch_cm9780_ops;\n\n\t \n\tif (ac97->ext_id & AC97_EI_SPDIF) {\n\t\tac97->rates[AC97_RATES_SPDIF] = SNDRV_PCM_RATE_48000;  \n\t\tval = snd_ac97_read(ac97, AC97_CM9780_SPDIF);\n\t\tval |= 0x1;  \n\t\tsnd_ac97_write_cache(ac97, AC97_CM9780_SPDIF, val);\n\t}\n\n\treturn 0;\n}\n\n \nstatic const struct snd_kcontrol_new snd_ac97_controls_vt1613[] = {\nAC97_SINGLE(\"DC Offset removal\", 0x5a, 10, 1, 0),\n};\n\nstatic int patch_vt1613_specific(struct snd_ac97 *ac97)\n{\n\treturn patch_build_controls(ac97, &snd_ac97_controls_vt1613[0],\n\t\t\t\t    ARRAY_SIZE(snd_ac97_controls_vt1613));\n};\n\nstatic const struct snd_ac97_build_ops patch_vt1613_ops = {\n\t.build_specific\t= patch_vt1613_specific\n};\n\nstatic int patch_vt1613(struct snd_ac97 *ac97)\n{\n\tac97->build_ops = &patch_vt1613_ops;\n\n\tac97->flags |= AC97_HAS_NO_VIDEO;\n\tac97->caps |= AC97_BC_HEADPHONE;\n\n\treturn 0;\n}\n\n \nstatic const struct snd_kcontrol_new snd_ac97_controls_vt1616[] = {\nAC97_SINGLE(\"DC Offset removal\", 0x5a, 10, 1, 0),\nAC97_SINGLE(\"Alternate Level to Surround Out\", 0x5a, 15, 1, 0),\nAC97_SINGLE(\"Downmix LFE and Center to Front\", 0x5a, 12, 1, 0),\nAC97_SINGLE(\"Downmix Surround to Front\", 0x5a, 11, 1, 0),\n};\n\nstatic const char * const follower_vols_vt1616[] = {\n\t\"Front Playback Volume\",\n\t\"Surround Playback Volume\",\n\t\"Center Playback Volume\",\n\t\"LFE Playback Volume\",\n\tNULL\n};\n\nstatic const char * const follower_sws_vt1616[] = {\n\t\"Front Playback Switch\",\n\t\"Surround Playback Switch\",\n\t\"Center Playback Switch\",\n\t\"LFE Playback Switch\",\n\tNULL\n};\n\n \nstatic struct snd_kcontrol *snd_ac97_find_mixer_ctl(struct snd_ac97 *ac97,\n\t\t\t\t\t\t    const char *name)\n{\n\treturn snd_ctl_find_id_mixer(ac97->bus->card, name);\n}\n\n \nstatic int snd_ac97_add_vmaster(struct snd_ac97 *ac97, char *name,\n\t\t\t\tconst unsigned int *tlv,\n\t\t\t\tconst char * const *followers)\n{\n\tstruct snd_kcontrol *kctl;\n\tint err;\n\n\tkctl = snd_ctl_make_virtual_master(name, tlv);\n\tif (!kctl)\n\t\treturn -ENOMEM;\n\terr = snd_ctl_add(ac97->bus->card, kctl);\n\tif (err < 0)\n\t\treturn err;\n\n\treturn snd_ctl_add_followers(ac97->bus->card, kctl, followers);\n}\n\nstatic int patch_vt1616_specific(struct snd_ac97 * ac97)\n{\n\tstruct snd_kcontrol *kctl;\n\tint err;\n\n\tif (snd_ac97_try_bit(ac97, 0x5a, 9)) {\n\t\terr = patch_build_controls(ac97, &snd_ac97_controls_vt1616[0], 1);\n\t\tif (err < 0)\n\t\t\treturn err;\n\t}\n\terr = patch_build_controls(ac97, &snd_ac97_controls_vt1616[1], ARRAY_SIZE(snd_ac97_controls_vt1616) - 1);\n\tif (err < 0)\n\t\treturn err;\n\n\t \n\tkctl = snd_ac97_find_mixer_ctl(ac97, \"Master Playback Volume\");\n\tif (!kctl)\n\t\treturn -EINVAL;\n\n\tsnd_ac97_rename_vol_ctl(ac97, \"Master Playback\", \"Front Playback\");\n\n\terr = snd_ac97_add_vmaster(ac97, \"Master Playback Volume\",\n\t\t\t\t   kctl->tlv.p, follower_vols_vt1616);\n\tif (err < 0)\n\t\treturn err;\n\n\terr = snd_ac97_add_vmaster(ac97, \"Master Playback Switch\",\n\t\t\t\t   NULL, follower_sws_vt1616);\n\tif (err < 0)\n\t\treturn err;\n\n\treturn 0;\n}\n\nstatic const struct snd_ac97_build_ops patch_vt1616_ops = {\n\t.build_specific\t= patch_vt1616_specific\n};\n\nstatic int patch_vt1616(struct snd_ac97 * ac97)\n{\n\tac97->build_ops = &patch_vt1616_ops;\n\treturn 0;\n}\n\n \n\n \n\n \nstatic int snd_ac97_vt1617a_smart51_info(struct snd_kcontrol *kcontrol,\n\t\t\t\t\t struct snd_ctl_elem_info *uinfo)\n{\n\t  \n\n\tstatic const char * const texts[] = {\"LineIn Mic1\", \"LineIn Mic1 Mic3\",\n\t\t\t\t       \"Surr LFE/C Mic3\", \"LineIn LFE/C Mic3\",\n\t\t\t\t       \"LineIn Mic2\", \"LineIn Mic2 Mic1\",\n\t\t\t\t       \"Surr LFE Mic1\", \"Surr LFE Mic1 Mic2\"};\n\n\treturn snd_ctl_enum_info(uinfo, 1, 8, texts);\n}\n\nstatic int snd_ac97_vt1617a_smart51_get(struct snd_kcontrol *kcontrol,\n\t\t\t\t\tstruct snd_ctl_elem_value *ucontrol)\n{\n\tushort usSM51, usMS;  \n\n\tstruct snd_ac97 *pac97;\n\t\n\tpac97 = snd_kcontrol_chip(kcontrol);  \n\n\t \n \n\tusSM51 = snd_ac97_read(pac97, 0x7a) >> 14;\n\tusMS   = snd_ac97_read(pac97, 0x20) >> 8;\n  \n\tucontrol->value.enumerated.item[0] = (usSM51 << 1) + usMS;\n\n\treturn 0;\n}\n\nstatic int snd_ac97_vt1617a_smart51_put(struct snd_kcontrol *kcontrol,\n\t\t\t\t\tstruct snd_ctl_elem_value *ucontrol)\n{\n\tushort usSM51, usMS, usReg;  \n\n\tstruct snd_ac97 *pac97;\n\n\tpac97 = snd_kcontrol_chip(kcontrol);  \n\n\tusSM51 = ucontrol->value.enumerated.item[0] >> 1;\n\tusMS   = ucontrol->value.enumerated.item[0] &  1;\n\n\t \n\n\tusReg = snd_ac97_read(pac97, 0x7a);\n\tsnd_ac97_write_cache(pac97, 0x7a, (usReg & 0x3FFF) + (usSM51 << 14));\n\tusReg = snd_ac97_read(pac97, 0x20);\n\tsnd_ac97_write_cache(pac97, 0x20, (usReg & 0xFEFF) + (usMS   <<  8));\n\n\treturn 0;\n}\n\nstatic const struct snd_kcontrol_new snd_ac97_controls_vt1617a[] = {\n\n\tAC97_SINGLE(\"Center/LFE Exchange\", 0x5a, 8, 1, 0),\n\t \n\t{\n\t\t.iface         = SNDRV_CTL_ELEM_IFACE_MIXER,\n\t\t.name          = \"Smart 5.1 Select\",\n\t\t.info          = snd_ac97_vt1617a_smart51_info,\n\t\t.get           = snd_ac97_vt1617a_smart51_get,\n\t\t.put           = snd_ac97_vt1617a_smart51_put,\n\t},\n};\n\nstatic int patch_vt1617a(struct snd_ac97 * ac97)\n{\n\tint err = 0;\n\tint val;\n\n\t \n\n\terr = patch_build_controls(ac97, &snd_ac97_controls_vt1617a[0],\n\t\t\t\t   ARRAY_SIZE(snd_ac97_controls_vt1617a));\n\n\t \n\t \n\tval = snd_ac97_read(ac97, 0x5c);\n\tif (!(val & 0x20))\n\t\tsnd_ac97_write_cache(ac97, 0x5c, 0x20);\n\n\tac97->ext_id |= AC97_EI_SPDIF;\t \n\tac97->rates[AC97_RATES_SPDIF] = SNDRV_PCM_RATE_44100 | SNDRV_PCM_RATE_48000;\n\tac97->build_ops = &patch_vt1616_ops;\n\n\treturn err;\n}\n\n \n\nstruct vt1618_uaj_item {\n\tunsigned short mask;\n\tunsigned short shift;\n\tconst char * const items[4];\n};\n\n \n\nstatic const struct vt1618_uaj_item vt1618_uaj[3] = {\n\t{\n\t\t \n\t\t.mask  = 0x03,\n\t\t.shift = 0,\n\t\t.items = {\n\t\t\t\"Speaker Out\", \"DAC Unmixed Out\", \"Line In\", \"Mic In\"\n\t\t}\n\t},\n\t{\n\t\t \n\t\t.mask  = 0x0c,\n\t\t.shift = 2,\n\t\t.items = {\n\t\t\t\"Surround Out\", \"DAC Unmixed Out\", \"Line In\", \"Mic In\"\n\t\t}\n\t},\n\t{\n\t\t \n\t\t.mask  = 0x30,\n\t\t.shift = 4,\n\t\t.items = {\n\t\t\t\"Center LFE Out\", \"DAC Unmixed Out\", \"Line In\", \"Mic In\"\n\t\t},\n\t},\n};\n\nstatic int snd_ac97_vt1618_UAJ_info(struct snd_kcontrol *kcontrol,\n\t\t\t\t    struct snd_ctl_elem_info *uinfo)\n{\n\treturn snd_ctl_enum_info(uinfo, 1, 4,\n\t\t\t\t vt1618_uaj[kcontrol->private_value].items);\n}\n\n \nstatic int snd_ac97_vt1618_UAJ_get(struct snd_kcontrol *kcontrol,\n\t\t\t\t   struct snd_ctl_elem_value *ucontrol)\n{\n\tunsigned short datpag, uaj;\n\tstruct snd_ac97 *pac97 = snd_kcontrol_chip(kcontrol);\n\n\tmutex_lock(&pac97->page_mutex);\n\n\tdatpag = snd_ac97_read(pac97, AC97_INT_PAGING) & AC97_PAGE_MASK;\n\tsnd_ac97_update_bits(pac97, AC97_INT_PAGING, AC97_PAGE_MASK, 0);\n\n\tuaj = snd_ac97_read(pac97, 0x60) &\n\t\tvt1618_uaj[kcontrol->private_value].mask;\n\n\tsnd_ac97_update_bits(pac97, AC97_INT_PAGING, AC97_PAGE_MASK, datpag);\n\tmutex_unlock(&pac97->page_mutex);\n\n\tucontrol->value.enumerated.item[0] = uaj >>\n\t\tvt1618_uaj[kcontrol->private_value].shift;\n\n\treturn 0;\n}\n\nstatic int snd_ac97_vt1618_UAJ_put(struct snd_kcontrol *kcontrol,\n\t\t\t\t   struct snd_ctl_elem_value *ucontrol)\n{\n\treturn ac97_update_bits_page(snd_kcontrol_chip(kcontrol), 0x60,\n\t\t\t\t     vt1618_uaj[kcontrol->private_value].mask,\n\t\t\t\t     ucontrol->value.enumerated.item[0]<<\n\t\t\t\t     vt1618_uaj[kcontrol->private_value].shift,\n\t\t\t\t     0);\n}\n\n \n\nstatic int snd_ac97_vt1618_aux_info(struct snd_kcontrol *kcontrol,\n\t\t\t\t     struct snd_ctl_elem_info *uinfo)\n{\n\tstatic const char * const txt_aux[] = {\"Aux In\", \"Back Surr Out\"};\n\n\treturn snd_ctl_enum_info(uinfo, 1, 2, txt_aux);\n}\n\nstatic int snd_ac97_vt1618_aux_get(struct snd_kcontrol *kcontrol,\n\t\t\t\t   struct snd_ctl_elem_value *ucontrol)\n{\n\tucontrol->value.enumerated.item[0] =\n\t\t(snd_ac97_read(snd_kcontrol_chip(kcontrol), 0x5c) & 0x0008)>>3;\n\treturn 0;\n}\n\nstatic int snd_ac97_vt1618_aux_put(struct snd_kcontrol *kcontrol,\n\t\t\t\t   struct snd_ctl_elem_value *ucontrol)\n{\n\t \n\n\tsnd_ac97_update_bits(snd_kcontrol_chip(kcontrol), 0x5c, 0x0008,\n\t\t\t     ucontrol->value.enumerated.item[0] << 3);\n\n\t \n\n\treturn snd_ac97_update_bits(snd_kcontrol_chip(kcontrol), 0x76, 0x0008,\n\t\t\t\t    ucontrol->value.enumerated.item[0] << 3);\n}\n\nstatic const struct snd_kcontrol_new snd_ac97_controls_vt1618[] = {\n\tAC97_SINGLE(\"Exchange Center/LFE\", 0x5a,  8, 1,     0),\n\tAC97_SINGLE(\"DC Offset\",           0x5a, 10, 1,     0),\n\tAC97_SINGLE(\"Soft Mute\",           0x5c,  0, 1,     1),\n\tAC97_SINGLE(\"Headphone Amp\",       0x5c,  5, 1,     1),\n\tAC97_DOUBLE(\"Back Surr Volume\",    0x5e,  8, 0, 31, 1),\n\tAC97_SINGLE(\"Back Surr Switch\",    0x5e, 15, 1,     1),\n\t{\n\t\t.iface         = SNDRV_CTL_ELEM_IFACE_MIXER,\n\t\t.name          = \"Speaker Jack Mode\",\n\t\t.info          = snd_ac97_vt1618_UAJ_info,\n\t\t.get           = snd_ac97_vt1618_UAJ_get,\n\t\t.put           = snd_ac97_vt1618_UAJ_put,\n\t\t.private_value = 0\n\t},\n\t{\n\t\t.iface         = SNDRV_CTL_ELEM_IFACE_MIXER,\n\t\t.name          = \"Line Jack Mode\",\n\t\t.info          = snd_ac97_vt1618_UAJ_info,\n\t\t.get           = snd_ac97_vt1618_UAJ_get,\n\t\t.put           = snd_ac97_vt1618_UAJ_put,\n\t\t.private_value = 1\n\t},\n\t{\n\t\t.iface         = SNDRV_CTL_ELEM_IFACE_MIXER,\n\t\t.name          = \"Mic Jack Mode\",\n\t\t.info          = snd_ac97_vt1618_UAJ_info,\n\t\t.get           = snd_ac97_vt1618_UAJ_get,\n\t\t.put           = snd_ac97_vt1618_UAJ_put,\n\t\t.private_value = 2\n\t},\n\t{\n\t\t.iface         = SNDRV_CTL_ELEM_IFACE_MIXER,\n\t\t.name          = \"Aux Jack Mode\",\n\t\t.info          = snd_ac97_vt1618_aux_info,\n\t\t.get           = snd_ac97_vt1618_aux_get,\n\t\t.put           = snd_ac97_vt1618_aux_put,\n\t}\n};\n\nstatic int patch_vt1618(struct snd_ac97 *ac97)\n{\n\treturn patch_build_controls(ac97, snd_ac97_controls_vt1618,\n\t\t\t\t    ARRAY_SIZE(snd_ac97_controls_vt1618));\n}\n\n \nstatic void it2646_update_jacks(struct snd_ac97 *ac97)\n{\n\t \n\tsnd_ac97_update_bits(ac97, 0x76, 1 << 9,\n\t\t\t     is_shared_surrout(ac97) ? (1<<9) : 0);\n\t \n\tsnd_ac97_update_bits(ac97, 0x76, 1 << 10,\n\t\t\t     is_shared_clfeout(ac97) ? (1<<10) : 0);\n}\n\nstatic const struct snd_kcontrol_new snd_ac97_controls_it2646[] = {\n\tAC97_SURROUND_JACK_MODE_CTL,\n\tAC97_CHANNEL_MODE_CTL,\n};\n\nstatic const struct snd_kcontrol_new snd_ac97_spdif_controls_it2646[] = {\n\tAC97_SINGLE(SNDRV_CTL_NAME_IEC958(\"\",CAPTURE,SWITCH), 0x76, 11, 1, 0),\n\tAC97_SINGLE(\"Analog to IEC958 Output\", 0x76, 12, 1, 0),\n\tAC97_SINGLE(\"IEC958 Input Monitor\", 0x76, 13, 1, 0),\n};\n\nstatic int patch_it2646_specific(struct snd_ac97 * ac97)\n{\n\tint err;\n\terr = patch_build_controls(ac97, snd_ac97_controls_it2646, ARRAY_SIZE(snd_ac97_controls_it2646));\n\tif (err < 0)\n\t\treturn err;\n\terr = patch_build_controls(ac97, snd_ac97_spdif_controls_it2646, ARRAY_SIZE(snd_ac97_spdif_controls_it2646));\n\tif (err < 0)\n\t\treturn err;\n\treturn 0;\n}\n\nstatic const struct snd_ac97_build_ops patch_it2646_ops = {\n\t.build_specific\t= patch_it2646_specific,\n\t.update_jacks = it2646_update_jacks\n};\n\nstatic int patch_it2646(struct snd_ac97 * ac97)\n{\n\tac97->build_ops = &patch_it2646_ops;\n\t \n\tsnd_ac97_write_cache(ac97, 0x5E, 0x0808);\n\tsnd_ac97_write_cache(ac97, 0x7A, 0x0808);\n\treturn 0;\n}\n\n \n\n#define AC97_SI3036_CHIP_ID     0x5a\n#define AC97_SI3036_LINE_CFG    0x5c\n\nstatic const struct snd_kcontrol_new snd_ac97_controls_si3036[] = {\nAC97_DOUBLE(\"Modem Speaker Volume\", 0x5c, 14, 12, 3, 1)\n};\n\nstatic int patch_si3036_specific(struct snd_ac97 * ac97)\n{\n\tint idx, err;\n\tfor (idx = 0; idx < ARRAY_SIZE(snd_ac97_controls_si3036); idx++) {\n\t\terr = snd_ctl_add(ac97->bus->card, snd_ctl_new1(&snd_ac97_controls_si3036[idx], ac97));\n\t\tif (err < 0)\n\t\t\treturn err;\n\t}\n\treturn 0;\n}\n\nstatic const struct snd_ac97_build_ops patch_si3036_ops = {\n\t.build_specific\t= patch_si3036_specific,\n};\n\nstatic int mpatch_si3036(struct snd_ac97 * ac97)\n{\n\tac97->build_ops = &patch_si3036_ops;\n\tsnd_ac97_write_cache(ac97, 0x5c, 0xf210 );\n\tsnd_ac97_write_cache(ac97, 0x68, 0);\n\treturn 0;\n}\n\n \n\nstatic const struct snd_ac97_res_table lm4550_restbl[] = {\n\t{ AC97_MASTER, 0x1f1f },\n\t{ AC97_HEADPHONE, 0x1f1f },\n\t{ AC97_MASTER_MONO, 0x001f },\n\t{ AC97_PC_BEEP, 0x001f },\t \n\t{ AC97_PHONE, 0x001f },\n\t{ AC97_MIC, 0x001f },\n\t{ AC97_LINE, 0x1f1f },\n\t{ AC97_CD, 0x1f1f },\n\t{ AC97_VIDEO, 0x1f1f },\n\t{ AC97_AUX, 0x1f1f },\n\t{ AC97_PCM, 0x1f1f },\n\t{ AC97_REC_GAIN, 0x0f0f },\n\t{ }  \n};\n\nstatic int patch_lm4550(struct snd_ac97 *ac97)\n{\n\tac97->res_table = lm4550_restbl;\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}