{
  "module_name": "cs5535audio_pm.c",
  "hash_id": "4a8af36a76e5ca6acda905e6defe249bd9c7542deafffe64ef9293f04775db3a",
  "original_prompt": "Ingested from linux-6.6.14/sound/pci/cs5535audio/cs5535audio_pm.c",
  "human_readable_source": "\n \n\n#include <linux/init.h>\n#include <linux/pci.h>\n#include <linux/delay.h>\n#include <sound/core.h>\n#include <sound/control.h>\n#include <sound/initval.h>\n#include <sound/asoundef.h>\n#include <sound/pcm.h>\n#include <sound/ac97_codec.h>\n#include \"cs5535audio.h\"\n\nstatic void snd_cs5535audio_stop_hardware(struct cs5535audio *cs5535au)\n{\n\t \n\n\t \n\tcs_writel(cs5535au, ACC_CODEC_CNTL, ACC_CODEC_CNTL_LNK_SHUTDOWN);\n\n}\n\nstatic int __maybe_unused snd_cs5535audio_suspend(struct device *dev)\n{\n\tstruct snd_card *card = dev_get_drvdata(dev);\n\tstruct cs5535audio *cs5535au = card->private_data;\n\tint i;\n\n\tsnd_power_change_state(card, SNDRV_CTL_POWER_D3hot);\n\tsnd_ac97_suspend(cs5535au->ac97);\n\tfor (i = 0; i < NUM_CS5535AUDIO_DMAS; i++) {\n\t\tstruct cs5535audio_dma *dma = &cs5535au->dmas[i];\n\t\tif (dma && dma->substream)\n\t\t\tdma->saved_prd = dma->ops->read_prd(cs5535au);\n\t}\n\t \n\tsnd_cs5535audio_stop_hardware(cs5535au);\n\treturn 0;\n}\n\nstatic int __maybe_unused snd_cs5535audio_resume(struct device *dev)\n{\n\tstruct snd_card *card = dev_get_drvdata(dev);\n\tstruct cs5535audio *cs5535au = card->private_data;\n\tu32 tmp;\n\tint timeout;\n\tint i;\n\n\t \n\tcs_writel(cs5535au, ACC_CODEC_CNTL, ACC_CODEC_CNTL_LNK_WRM_RST);\n\n\ttimeout = 50;\n\tdo {\n\t\ttmp = cs_readl(cs5535au, ACC_CODEC_STATUS);\n\t\tif (tmp & PRM_RDY_STS)\n\t\t\tbreak;\n\t\tudelay(1);\n\t} while (--timeout);\n\n\tif (!timeout)\n\t\tdev_err(cs5535au->card->dev, \"Failure getting AC Link ready\\n\");\n\n\t \n\tfor (i = 0; i < NUM_CS5535AUDIO_DMAS; i++) {\n\t\tstruct cs5535audio_dma *dma = &cs5535au->dmas[i];\n\t\tif (dma && dma->substream) {\n\t\t\tdma->substream->ops->prepare(dma->substream);\n\t\t\tdma->ops->setup_prd(cs5535au, dma->saved_prd);\n\t\t}\n\t}\n\n\t \n\tsnd_ac97_resume(cs5535au->ac97);\n\tsnd_power_change_state(card, SNDRV_CTL_POWER_D0);\n\n\treturn 0;\n}\n\nSIMPLE_DEV_PM_OPS(snd_cs5535audio_pm, snd_cs5535audio_suspend, snd_cs5535audio_resume);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}