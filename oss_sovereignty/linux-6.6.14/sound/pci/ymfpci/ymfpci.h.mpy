{
  "module_name": "ymfpci.h",
  "hash_id": "afc36479e10f6f554fdd7c1da4a126c17055078bb98bb5738046d6d2bd89170e",
  "original_prompt": "Ingested from linux-6.6.14/sound/pci/ymfpci/ymfpci.h",
  "human_readable_source": " \n#ifndef __SOUND_YMFPCI_H\n#define __SOUND_YMFPCI_H\n\n \n\n#include <sound/pcm.h>\n#include <sound/rawmidi.h>\n#include <sound/ac97_codec.h>\n#include <sound/timer.h>\n#include <linux/gameport.h>\n\n \n\n#define YMFREG(chip, reg)\t\t(chip->port + YDSXGR_##reg)\n\n#define\tYDSXGR_INTFLAG\t\t\t0x0004\n#define\tYDSXGR_ACTIVITY\t\t\t0x0006\n#define\tYDSXGR_GLOBALCTRL\t\t0x0008\n#define\tYDSXGR_ZVCTRL\t\t\t0x000A\n#define\tYDSXGR_TIMERCTRL\t\t0x0010\n#define\tYDSXGR_TIMERCOUNT\t\t0x0012\n#define\tYDSXGR_SPDIFOUTCTRL\t\t0x0018\n#define\tYDSXGR_SPDIFOUTSTATUS\t\t0x001C\n#define\tYDSXGR_EEPROMCTRL\t\t0x0020\n#define\tYDSXGR_SPDIFINCTRL\t\t0x0034\n#define\tYDSXGR_SPDIFINSTATUS\t\t0x0038\n#define\tYDSXGR_DSPPROGRAMDL\t\t0x0048\n#define\tYDSXGR_DLCNTRL\t\t\t0x004C\n#define\tYDSXGR_GPIOININTFLAG\t\t0x0050\n#define\tYDSXGR_GPIOININTENABLE\t\t0x0052\n#define\tYDSXGR_GPIOINSTATUS\t\t0x0054\n#define\tYDSXGR_GPIOOUTCTRL\t\t0x0056\n#define\tYDSXGR_GPIOFUNCENABLE\t\t0x0058\n#define\tYDSXGR_GPIOTYPECONFIG\t\t0x005A\n#define\tYDSXGR_AC97CMDDATA\t\t0x0060\n#define\tYDSXGR_AC97CMDADR\t\t0x0062\n#define\tYDSXGR_PRISTATUSDATA\t\t0x0064\n#define\tYDSXGR_PRISTATUSADR\t\t0x0066\n#define\tYDSXGR_SECSTATUSDATA\t\t0x0068\n#define\tYDSXGR_SECSTATUSADR\t\t0x006A\n#define\tYDSXGR_SECCONFIG\t\t0x0070\n#define\tYDSXGR_LEGACYOUTVOL\t\t0x0080\n#define\tYDSXGR_LEGACYOUTVOLL\t\t0x0080\n#define\tYDSXGR_LEGACYOUTVOLR\t\t0x0082\n#define\tYDSXGR_NATIVEDACOUTVOL\t\t0x0084\n#define\tYDSXGR_NATIVEDACOUTVOLL\t\t0x0084\n#define\tYDSXGR_NATIVEDACOUTVOLR\t\t0x0086\n#define\tYDSXGR_ZVOUTVOL\t\t\t0x0088\n#define\tYDSXGR_ZVOUTVOLL\t\t0x0088\n#define\tYDSXGR_ZVOUTVOLR\t\t0x008A\n#define\tYDSXGR_SECADCOUTVOL\t\t0x008C\n#define\tYDSXGR_SECADCOUTVOLL\t\t0x008C\n#define\tYDSXGR_SECADCOUTVOLR\t\t0x008E\n#define\tYDSXGR_PRIADCOUTVOL\t\t0x0090\n#define\tYDSXGR_PRIADCOUTVOLL\t\t0x0090\n#define\tYDSXGR_PRIADCOUTVOLR\t\t0x0092\n#define\tYDSXGR_LEGACYLOOPVOL\t\t0x0094\n#define\tYDSXGR_LEGACYLOOPVOLL\t\t0x0094\n#define\tYDSXGR_LEGACYLOOPVOLR\t\t0x0096\n#define\tYDSXGR_NATIVEDACLOOPVOL\t\t0x0098\n#define\tYDSXGR_NATIVEDACLOOPVOLL\t0x0098\n#define\tYDSXGR_NATIVEDACLOOPVOLR\t0x009A\n#define\tYDSXGR_ZVLOOPVOL\t\t0x009C\n#define\tYDSXGR_ZVLOOPVOLL\t\t0x009E\n#define\tYDSXGR_ZVLOOPVOLR\t\t0x009E\n#define\tYDSXGR_SECADCLOOPVOL\t\t0x00A0\n#define\tYDSXGR_SECADCLOOPVOLL\t\t0x00A0\n#define\tYDSXGR_SECADCLOOPVOLR\t\t0x00A2\n#define\tYDSXGR_PRIADCLOOPVOL\t\t0x00A4\n#define\tYDSXGR_PRIADCLOOPVOLL\t\t0x00A4\n#define\tYDSXGR_PRIADCLOOPVOLR\t\t0x00A6\n#define\tYDSXGR_NATIVEADCINVOL\t\t0x00A8\n#define\tYDSXGR_NATIVEADCINVOLL\t\t0x00A8\n#define\tYDSXGR_NATIVEADCINVOLR\t\t0x00AA\n#define\tYDSXGR_NATIVEDACINVOL\t\t0x00AC\n#define\tYDSXGR_NATIVEDACINVOLL\t\t0x00AC\n#define\tYDSXGR_NATIVEDACINVOLR\t\t0x00AE\n#define\tYDSXGR_BUF441OUTVOL\t\t0x00B0\n#define\tYDSXGR_BUF441OUTVOLL\t\t0x00B0\n#define\tYDSXGR_BUF441OUTVOLR\t\t0x00B2\n#define\tYDSXGR_BUF441LOOPVOL\t\t0x00B4\n#define\tYDSXGR_BUF441LOOPVOLL\t\t0x00B4\n#define\tYDSXGR_BUF441LOOPVOLR\t\t0x00B6\n#define\tYDSXGR_SPDIFOUTVOL\t\t0x00B8\n#define\tYDSXGR_SPDIFOUTVOLL\t\t0x00B8\n#define\tYDSXGR_SPDIFOUTVOLR\t\t0x00BA\n#define\tYDSXGR_SPDIFLOOPVOL\t\t0x00BC\n#define\tYDSXGR_SPDIFLOOPVOLL\t\t0x00BC\n#define\tYDSXGR_SPDIFLOOPVOLR\t\t0x00BE\n#define\tYDSXGR_ADCSLOTSR\t\t0x00C0\n#define\tYDSXGR_RECSLOTSR\t\t0x00C4\n#define\tYDSXGR_ADCFORMAT\t\t0x00C8\n#define\tYDSXGR_RECFORMAT\t\t0x00CC\n#define\tYDSXGR_P44SLOTSR\t\t0x00D0\n#define\tYDSXGR_STATUS\t\t\t0x0100\n#define\tYDSXGR_CTRLSELECT\t\t0x0104\n#define\tYDSXGR_MODE\t\t\t0x0108\n#define\tYDSXGR_SAMPLECOUNT\t\t0x010C\n#define\tYDSXGR_NUMOFSAMPLES\t\t0x0110\n#define\tYDSXGR_CONFIG\t\t\t0x0114\n#define\tYDSXGR_PLAYCTRLSIZE\t\t0x0140\n#define\tYDSXGR_RECCTRLSIZE\t\t0x0144\n#define\tYDSXGR_EFFCTRLSIZE\t\t0x0148\n#define\tYDSXGR_WORKSIZE\t\t\t0x014C\n#define\tYDSXGR_MAPOFREC\t\t\t0x0150\n#define\tYDSXGR_MAPOFEFFECT\t\t0x0154\n#define\tYDSXGR_PLAYCTRLBASE\t\t0x0158\n#define\tYDSXGR_RECCTRLBASE\t\t0x015C\n#define\tYDSXGR_EFFCTRLBASE\t\t0x0160\n#define\tYDSXGR_WORKBASE\t\t\t0x0164\n#define\tYDSXGR_DSPINSTRAM\t\t0x1000\n#define\tYDSXGR_CTRLINSTRAM\t\t0x4000\n\n#define YDSXG_AC97READCMD\t\t0x8000\n#define YDSXG_AC97WRITECMD\t\t0x0000\n\n#define PCIR_DSXG_LEGACY\t\t0x40\n#define PCIR_DSXG_ELEGACY\t\t0x42\n#define PCIR_DSXG_CTRL\t\t\t0x48\n#define PCIR_DSXG_PWRCTRL1\t\t0x4a\n#define PCIR_DSXG_PWRCTRL2\t\t0x4e\n#define PCIR_DSXG_FMBASE\t\t0x60\n#define PCIR_DSXG_SBBASE\t\t0x62\n#define PCIR_DSXG_MPU401BASE\t\t0x64\n#define PCIR_DSXG_JOYBASE\t\t0x66\n\n#define YDSXG_DSPLENGTH\t\t\t0x0080\n#define YDSXG_CTRLLENGTH\t\t0x3000\n\n#define YDSXG_DEFAULT_WORK_SIZE\t\t0x0400\n\n#define YDSXG_PLAYBACK_VOICES\t\t64\n#define YDSXG_CAPTURE_VOICES\t\t2\n#define YDSXG_EFFECT_VOICES\t\t5\n\n#define YMFPCI_LEGACY_SBEN\t(1 << 0)\t \n#define YMFPCI_LEGACY_FMEN\t(1 << 1)\t \n#define YMFPCI_LEGACY_JPEN\t(1 << 2)\t \n#define YMFPCI_LEGACY_MEN\t(1 << 3)\t \n#define YMFPCI_LEGACY_MIEN\t(1 << 4)\t \n#define YMFPCI_LEGACY_IOBITS\t(1 << 5)\t \n#define YMFPCI_LEGACY_SDMA\t(3 << 6)\t \n#define YMFPCI_LEGACY_SBIRQ\t(7 << 8)\t \n#define YMFPCI_LEGACY_MPUIRQ\t(7 << 11)\t \n#define YMFPCI_LEGACY_SIEN\t(1 << 14)\t \n#define YMFPCI_LEGACY_LAD\t(1 << 15)\t \n\n#define YMFPCI_LEGACY2_FMIO\t(3 << 0)\t \n#define YMFPCI_LEGACY2_SBIO\t(3 << 2)\t \n#define YMFPCI_LEGACY2_MPUIO\t(3 << 4)\t \n#define YMFPCI_LEGACY2_JSIO\t(3 << 6)\t \n#define YMFPCI_LEGACY2_MAIM\t(1 << 8)\t \n#define YMFPCI_LEGACY2_SMOD\t(3 << 11)\t \n#define YMFPCI_LEGACY2_SBVER\t(3 << 13)\t \n#define YMFPCI_LEGACY2_IMOD\t(1 << 15)\t \n \n\n#if IS_REACHABLE(CONFIG_GAMEPORT)\n#define SUPPORT_JOYSTICK\n#endif\n\n \n\nstruct snd_ymfpci_playback_bank {\n\t__le32 format;\n\t__le32 loop_default;\n\t__le32 base;\t\t\t \n\t__le32 loop_start;\t\t \n\t__le32 loop_end;\t\t \n\t__le32 loop_frac;\t\t \n\t__le32 delta_end;\t\t \n\t__le32 lpfK_end;\n\t__le32 eg_gain_end;\n\t__le32 left_gain_end;\n\t__le32 right_gain_end;\n\t__le32 eff1_gain_end;\n\t__le32 eff2_gain_end;\n\t__le32 eff3_gain_end;\n\t__le32 lpfQ;\n\t__le32 status;\n\t__le32 num_of_frames;\n\t__le32 loop_count;\n\t__le32 start;\n\t__le32 start_frac;\n\t__le32 delta;\n\t__le32 lpfK;\n\t__le32 eg_gain;\n\t__le32 left_gain;\n\t__le32 right_gain;\n\t__le32 eff1_gain;\n\t__le32 eff2_gain;\n\t__le32 eff3_gain;\n\t__le32 lpfD1;\n\t__le32 lpfD2;\n };\n\nstruct snd_ymfpci_capture_bank {\n\t__le32 base;\t\t\t \n\t__le32 loop_end;\t\t \n\t__le32 start;\t\t\t \n\t__le32 num_of_loops;\t\t \n};\n\nstruct snd_ymfpci_effect_bank {\n\t__le32 base;\t\t\t \n\t__le32 loop_end;\t\t \n\t__le32 start;\t\t\t \n\t__le32 temp;\n};\n\nstruct snd_ymfpci_pcm;\nstruct snd_ymfpci;\n\nenum snd_ymfpci_voice_type {\n\tYMFPCI_PCM,\n\tYMFPCI_SYNTH,\n\tYMFPCI_MIDI\n};\n\nstruct snd_ymfpci_voice {\n\tstruct snd_ymfpci *chip;\n\tint number;\n\tunsigned int use: 1,\n\t    pcm: 1,\n\t    synth: 1,\n\t    midi: 1;\n\tstruct snd_ymfpci_playback_bank *bank;\n\tdma_addr_t bank_addr;\n\tvoid (*interrupt)(struct snd_ymfpci *chip, struct snd_ymfpci_voice *voice);\n\tstruct snd_ymfpci_pcm *ypcm;\n};\n\nenum snd_ymfpci_pcm_type {\n\tPLAYBACK_VOICE,\n\tCAPTURE_REC,\n\tCAPTURE_AC97,\n\tEFFECT_DRY_LEFT,\n\tEFFECT_DRY_RIGHT,\n\tEFFECT_EFF1,\n\tEFFECT_EFF2,\n\tEFFECT_EFF3\n};\n\nstruct snd_ymfpci_pcm {\n\tstruct snd_ymfpci *chip;\n\tenum snd_ymfpci_pcm_type type;\n\tstruct snd_pcm_substream *substream;\n\tstruct snd_ymfpci_voice *voices[2];\t \n\tunsigned int running: 1,\n\t\t     use_441_slot: 1,\n\t             output_front: 1,\n\t             output_rear: 1,\n\t             swap_rear: 1;\n\tunsigned int update_pcm_vol;\n\tu32 period_size;\t\t \n\tu32 buffer_size;\t\t \n\tu32 period_pos;\n\tu32 last_pos;\n\tu32 capture_bank_number;\n\tu32 shift;\n};\n\nstatic const int saved_regs_index[] = {\n\t \n\tYDSXGR_SPDIFOUTCTRL,\n\tYDSXGR_SPDIFOUTSTATUS,\n\tYDSXGR_SPDIFINCTRL,\n\t \n\tYDSXGR_PRIADCLOOPVOL,\n\tYDSXGR_NATIVEDACINVOL,\n\tYDSXGR_NATIVEDACOUTVOL,\n\tYDSXGR_BUF441OUTVOL,\n\tYDSXGR_NATIVEADCINVOL,\n\tYDSXGR_SPDIFLOOPVOL,\n\tYDSXGR_SPDIFOUTVOL,\n\tYDSXGR_ZVOUTVOL,\n\tYDSXGR_LEGACYOUTVOL,\n\t \n\tYDSXGR_PLAYCTRLBASE,\n\tYDSXGR_RECCTRLBASE,\n\tYDSXGR_EFFCTRLBASE,\n\tYDSXGR_WORKBASE,\n\t \n\tYDSXGR_MAPOFREC,\n\tYDSXGR_RECFORMAT,\n\tYDSXGR_RECSLOTSR,\n\tYDSXGR_ADCFORMAT,\n\tYDSXGR_ADCSLOTSR,\n};\n#define YDSXGR_NUM_SAVED_REGS\tARRAY_SIZE(saved_regs_index)\n\nstatic const int pci_saved_regs_index[] = {\n\t \n\tPCIR_DSXG_LEGACY,\n\tPCIR_DSXG_ELEGACY,\n\t \n\tPCIR_DSXG_FMBASE,\n\tPCIR_DSXG_SBBASE,\n\tPCIR_DSXG_MPU401BASE,\n\tPCIR_DSXG_JOYBASE,\n};\n#define DSXG_PCI_NUM_SAVED_REGS\tARRAY_SIZE(pci_saved_regs_index)\n#define DSXG_PCI_NUM_SAVED_LEGACY_REGS\t2\nstatic_assert(DSXG_PCI_NUM_SAVED_LEGACY_REGS <= DSXG_PCI_NUM_SAVED_REGS);\n\nstruct snd_ymfpci {\n\tint irq;\n\n\tunsigned int device_id;\t \n\tunsigned char rev;\t \n\tunsigned long reg_area_phys;\n\tvoid __iomem *reg_area_virt;\n\n\tu16 old_legacy_ctrl;\n#ifdef SUPPORT_JOYSTICK\n\tstruct gameport *gameport;\n#endif\n\n\tstruct snd_dma_buffer *work_ptr;\n\n\tunsigned int bank_size_playback;\n\tunsigned int bank_size_capture;\n\tunsigned int bank_size_effect;\n\tunsigned int work_size;\n\n\tvoid *bank_base_playback;\n\tvoid *bank_base_capture;\n\tvoid *bank_base_effect;\n\tvoid *work_base;\n\tdma_addr_t bank_base_playback_addr;\n\tdma_addr_t bank_base_capture_addr;\n\tdma_addr_t bank_base_effect_addr;\n\tdma_addr_t work_base_addr;\n\tstruct snd_dma_buffer ac3_tmp_base;\n\n\t__le32 *ctrl_playback;\n\tstruct snd_ymfpci_playback_bank *bank_playback[YDSXG_PLAYBACK_VOICES][2];\n\tstruct snd_ymfpci_capture_bank *bank_capture[YDSXG_CAPTURE_VOICES][2];\n\tstruct snd_ymfpci_effect_bank *bank_effect[YDSXG_EFFECT_VOICES][2];\n\n\tint start_count;\n\n\tu32 active_bank;\n\tstruct snd_ymfpci_voice voices[64];\n\tint src441_used;\n\n\tstruct snd_ac97_bus *ac97_bus;\n\tstruct snd_ac97 *ac97;\n\tstruct snd_rawmidi *rawmidi;\n\tstruct snd_timer *timer;\n\tunsigned int timer_ticks;\n\n\tstruct pci_dev *pci;\n\tstruct snd_card *card;\n\tstruct snd_pcm *pcm;\n\tstruct snd_pcm *pcm2;\n\tstruct snd_pcm *pcm_spdif;\n\tstruct snd_pcm *pcm_4ch;\n\tstruct snd_pcm_substream *capture_substream[YDSXG_CAPTURE_VOICES];\n\tstruct snd_pcm_substream *effect_substream[YDSXG_EFFECT_VOICES];\n\tstruct snd_kcontrol *ctl_vol_recsrc;\n\tstruct snd_kcontrol *ctl_vol_adcrec;\n\tstruct snd_kcontrol *ctl_vol_spdifrec;\n\tunsigned short spdif_bits, spdif_pcm_bits;\n\tstruct snd_kcontrol *spdif_pcm_ctl;\n\tint mode_dup4ch;\n\tint rear_opened;\n\tint spdif_opened;\n\tstruct snd_ymfpci_pcm_mixer {\n\t\tu16 left;\n\t\tu16 right;\n\t\tstruct snd_kcontrol *ctl;\n\t} pcm_mixer[32];\n\n\tspinlock_t reg_lock;\n\tspinlock_t voice_lock;\n\twait_queue_head_t interrupt_sleep;\n\tatomic_t interrupt_sleep_count;\n\tstruct snd_info_entry *proc_entry;\n\tconst struct firmware *dsp_microcode;\n\tconst struct firmware *controller_microcode;\n\n\tu32 saved_regs[YDSXGR_NUM_SAVED_REGS];\n\tu32 saved_ydsxgr_mode;\n\tu16 saved_dsxg_pci_regs[DSXG_PCI_NUM_SAVED_REGS];\n};\n\nint snd_ymfpci_create(struct snd_card *card,\n\t\t      struct pci_dev *pci,\n\t\t      u16 old_legacy_ctrl);\nvoid snd_ymfpci_free_gameport(struct snd_ymfpci *chip);\n\nextern const struct dev_pm_ops snd_ymfpci_pm;\n\nint snd_ymfpci_pcm(struct snd_ymfpci *chip, int device);\nint snd_ymfpci_pcm2(struct snd_ymfpci *chip, int device);\nint snd_ymfpci_pcm_spdif(struct snd_ymfpci *chip, int device);\nint snd_ymfpci_pcm_4ch(struct snd_ymfpci *chip, int device);\nint snd_ymfpci_mixer(struct snd_ymfpci *chip, int rear_switch);\nint snd_ymfpci_timer(struct snd_ymfpci *chip, int device);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}