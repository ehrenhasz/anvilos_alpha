{
  "module_name": "cs46xx.c",
  "hash_id": "6f618a6544a2e22aa53a26d13c6e8356e745c483becc5fcd5d71f1eb16295f3b",
  "original_prompt": "Ingested from linux-6.6.14/sound/pci/cs46xx/cs46xx.c",
  "human_readable_source": "\n \n\n \n\n#include <linux/pci.h>\n#include <linux/time.h>\n#include <linux/init.h>\n#include <linux/module.h>\n#include <sound/core.h>\n#include \"cs46xx.h\"\n#include <sound/initval.h>\n\nMODULE_AUTHOR(\"Jaroslav Kysela <perex@perex.cz>\");\nMODULE_DESCRIPTION(\"Cirrus Logic Sound Fusion CS46XX\");\nMODULE_LICENSE(\"GPL\");\n\nstatic int index[SNDRV_CARDS] = SNDRV_DEFAULT_IDX;\t \nstatic char *id[SNDRV_CARDS] = SNDRV_DEFAULT_STR;\t \nstatic bool enable[SNDRV_CARDS] = SNDRV_DEFAULT_ENABLE_PNP;\t \nstatic bool external_amp[SNDRV_CARDS];\nstatic bool thinkpad[SNDRV_CARDS];\nstatic bool mmap_valid[SNDRV_CARDS] = {[0 ... (SNDRV_CARDS - 1)] = 1};\n\nmodule_param_array(index, int, NULL, 0444);\nMODULE_PARM_DESC(index, \"Index value for the CS46xx soundcard.\");\nmodule_param_array(id, charp, NULL, 0444);\nMODULE_PARM_DESC(id, \"ID string for the CS46xx soundcard.\");\nmodule_param_array(enable, bool, NULL, 0444);\nMODULE_PARM_DESC(enable, \"Enable CS46xx soundcard.\");\nmodule_param_array(external_amp, bool, NULL, 0444);\nMODULE_PARM_DESC(external_amp, \"Force to enable external amplifier.\");\nmodule_param_array(thinkpad, bool, NULL, 0444);\nMODULE_PARM_DESC(thinkpad, \"Force to enable Thinkpad's CLKRUN control.\");\nmodule_param_array(mmap_valid, bool, NULL, 0444);\nMODULE_PARM_DESC(mmap_valid, \"Support OSS mmap.\");\n\nstatic const struct pci_device_id snd_cs46xx_ids[] = {\n\t{ PCI_VDEVICE(CIRRUS, 0x6001), 0, },    \n\t{ PCI_VDEVICE(CIRRUS, 0x6003), 0, },    \n\t{ PCI_VDEVICE(CIRRUS, 0x6004), 0, },    \n\t{ 0, }\n};\n\nMODULE_DEVICE_TABLE(pci, snd_cs46xx_ids);\n\nstatic int snd_card_cs46xx_probe(struct pci_dev *pci,\n\t\t\t\t const struct pci_device_id *pci_id)\n{\n\tstatic int dev;\n\tstruct snd_card *card;\n\tstruct snd_cs46xx *chip;\n\tint err;\n\n\tif (dev >= SNDRV_CARDS)\n\t\treturn -ENODEV;\n\tif (!enable[dev]) {\n\t\tdev++;\n\t\treturn -ENOENT;\n\t}\n\n\terr = snd_devm_card_new(&pci->dev, index[dev], id[dev], THIS_MODULE,\n\t\t\t\tsizeof(*chip), &card);\n\tif (err < 0)\n\t\treturn err;\n\tchip = card->private_data;\n\terr = snd_cs46xx_create(card, pci,\n\t\t\t\texternal_amp[dev], thinkpad[dev]);\n\tif (err < 0)\n\t\tgoto error;\n\tcard->private_data = chip;\n\tchip->accept_valid = mmap_valid[dev];\n\terr = snd_cs46xx_pcm(chip, 0);\n\tif (err < 0)\n\t\tgoto error;\n#ifdef CONFIG_SND_CS46XX_NEW_DSP\n\terr = snd_cs46xx_pcm_rear(chip, 1);\n\tif (err < 0)\n\t\tgoto error;\n\terr = snd_cs46xx_pcm_iec958(chip, 2);\n\tif (err < 0)\n\t\tgoto error;\n#endif\n\terr = snd_cs46xx_mixer(chip, 2);\n\tif (err < 0)\n\t\tgoto error;\n#ifdef CONFIG_SND_CS46XX_NEW_DSP\n\tif (chip->nr_ac97_codecs ==2) {\n\t\terr = snd_cs46xx_pcm_center_lfe(chip, 3);\n\t\tif (err < 0)\n\t\t\tgoto error;\n\t}\n#endif\n\terr = snd_cs46xx_midi(chip, 0);\n\tif (err < 0)\n\t\tgoto error;\n\terr = snd_cs46xx_start_dsp(chip);\n\tif (err < 0)\n\t\tgoto error;\n\n\tsnd_cs46xx_gameport(chip);\n\n\tstrcpy(card->driver, \"CS46xx\");\n\tstrcpy(card->shortname, \"Sound Fusion CS46xx\");\n\tsprintf(card->longname, \"%s at 0x%lx/0x%lx, irq %i\",\n\t\tcard->shortname,\n\t\tchip->ba0_addr,\n\t\tchip->ba1_addr,\n\t\tchip->irq);\n\n\terr = snd_card_register(card);\n\tif (err < 0)\n\t\tgoto error;\n\n\tpci_set_drvdata(pci, card);\n\tdev++;\n\treturn 0;\n\n error:\n\tsnd_card_free(card);\n\treturn err;\n}\n\nstatic struct pci_driver cs46xx_driver = {\n\t.name = KBUILD_MODNAME,\n\t.id_table = snd_cs46xx_ids,\n\t.probe = snd_card_cs46xx_probe,\n#ifdef CONFIG_PM_SLEEP\n\t.driver = {\n\t\t.pm = &snd_cs46xx_pm,\n\t},\n#endif\n};\n\nmodule_pci_driver(cs46xx_driver);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}