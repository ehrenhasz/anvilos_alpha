{
  "module_name": "xfi.c",
  "hash_id": "1711701aba0eec3c9ee3f3645e0302b3a522675c0c70813ff8e2c4221295d27a",
  "original_prompt": "Ingested from linux-6.6.14/sound/pci/ctxfi/xfi.c",
  "human_readable_source": "\n \n\n#include <linux/init.h>\n#include <linux/pci.h>\n#include <linux/moduleparam.h>\n#include <linux/pci_ids.h>\n#include <linux/module.h>\n#include <sound/core.h>\n#include <sound/initval.h>\n#include \"ctatc.h\"\n#include \"cthardware.h\"\n\nMODULE_AUTHOR(\"Creative Technology Ltd\");\nMODULE_DESCRIPTION(\"X-Fi driver version 1.03\");\nMODULE_LICENSE(\"GPL v2\");\n\nstatic unsigned int reference_rate = 48000;\nstatic unsigned int multiple = 2;\nMODULE_PARM_DESC(reference_rate, \"Reference rate (default=48000)\");\nmodule_param(reference_rate, uint, 0444);\nMODULE_PARM_DESC(multiple, \"Rate multiplier (default=2)\");\nmodule_param(multiple, uint, 0444);\n\nstatic int index[SNDRV_CARDS] = SNDRV_DEFAULT_IDX;\nstatic char *id[SNDRV_CARDS] = SNDRV_DEFAULT_STR;\nstatic bool enable[SNDRV_CARDS] = SNDRV_DEFAULT_ENABLE_PNP;\nstatic unsigned int subsystem[SNDRV_CARDS];\n\nmodule_param_array(index, int, NULL, 0444);\nMODULE_PARM_DESC(index, \"Index value for Creative X-Fi driver\");\nmodule_param_array(id, charp, NULL, 0444);\nMODULE_PARM_DESC(id, \"ID string for Creative X-Fi driver\");\nmodule_param_array(enable, bool, NULL, 0444);\nMODULE_PARM_DESC(enable, \"Enable Creative X-Fi driver\");\nmodule_param_array(subsystem, int, NULL, 0444);\nMODULE_PARM_DESC(subsystem, \"Override subsystem ID for Creative X-Fi driver\");\n\nstatic const struct pci_device_id ct_pci_dev_ids[] = {\n\t \n\t{ PCI_DEVICE(PCI_VENDOR_ID_CREATIVE, PCI_DEVICE_ID_CREATIVE_20K1),\n\t  .driver_data = ATC20K1,\n\t},\n\t{ PCI_DEVICE(PCI_VENDOR_ID_CREATIVE, PCI_DEVICE_ID_CREATIVE_20K2),\n\t  .driver_data = ATC20K2,\n\t},\n\t{ 0, }\n};\nMODULE_DEVICE_TABLE(pci, ct_pci_dev_ids);\n\nstatic int\nct_card_probe(struct pci_dev *pci, const struct pci_device_id *pci_id)\n{\n\tstatic int dev;\n\tstruct snd_card *card;\n\tstruct ct_atc *atc;\n\tint err;\n\n\tif (dev >= SNDRV_CARDS)\n\t\treturn -ENODEV;\n\n\tif (!enable[dev]) {\n\t\tdev++;\n\t\treturn -ENOENT;\n\t}\n\terr = snd_card_new(&pci->dev, index[dev], id[dev], THIS_MODULE,\n\t\t\t   0, &card);\n\tif (err)\n\t\treturn err;\n\tif ((reference_rate != 48000) && (reference_rate != 44100)) {\n\t\tdev_err(card->dev,\n\t\t\t\"Invalid reference_rate value %u!!!\\n\",\n\t\t\treference_rate);\n\t\tdev_err(card->dev,\n\t\t\t\"The valid values for reference_rate are 48000 and 44100, Value 48000 is assumed.\\n\");\n\t\treference_rate = 48000;\n\t}\n\tif ((multiple != 1) && (multiple != 2) && (multiple != 4)) {\n\t\tdev_err(card->dev, \"Invalid multiple value %u!!!\\n\",\n\t\t\tmultiple);\n\t\tdev_err(card->dev,\n\t\t\t\"The valid values for multiple are 1, 2 and 4, Value 2 is assumed.\\n\");\n\t\tmultiple = 2;\n\t}\n\terr = ct_atc_create(card, pci, reference_rate, multiple,\n\t\t\t    pci_id->driver_data, subsystem[dev], &atc);\n\tif (err < 0)\n\t\tgoto error;\n\n\tcard->private_data = atc;\n\n\t \n\terr = ct_atc_create_alsa_devs(atc);\n\tif (err < 0)\n\t\tgoto error;\n\n\tstrcpy(card->driver, \"SB-XFi\");\n\tstrcpy(card->shortname, \"Creative X-Fi\");\n\tsnprintf(card->longname, sizeof(card->longname), \"%s %s %s\",\n\t\t card->shortname, atc->chip_name, atc->model_name);\n\n\terr = snd_card_register(card);\n\tif (err < 0)\n\t\tgoto error;\n\n\tpci_set_drvdata(pci, card);\n\tdev++;\n\n\treturn 0;\n\nerror:\n\tsnd_card_free(card);\n\treturn err;\n}\n\nstatic void ct_card_remove(struct pci_dev *pci)\n{\n\tsnd_card_free(pci_get_drvdata(pci));\n}\n\n#ifdef CONFIG_PM_SLEEP\nstatic int ct_card_suspend(struct device *dev)\n{\n\tstruct snd_card *card = dev_get_drvdata(dev);\n\tstruct ct_atc *atc = card->private_data;\n\n\treturn atc->suspend(atc);\n}\n\nstatic int ct_card_resume(struct device *dev)\n{\n\tstruct snd_card *card = dev_get_drvdata(dev);\n\tstruct ct_atc *atc = card->private_data;\n\n\treturn atc->resume(atc);\n}\n\nstatic SIMPLE_DEV_PM_OPS(ct_card_pm, ct_card_suspend, ct_card_resume);\n#define CT_CARD_PM_OPS\t&ct_card_pm\n#else\n#define CT_CARD_PM_OPS\tNULL\n#endif\n\nstatic struct pci_driver ct_driver = {\n\t.name = KBUILD_MODNAME,\n\t.id_table = ct_pci_dev_ids,\n\t.probe = ct_card_probe,\n\t.remove = ct_card_remove,\n\t.driver = {\n\t\t.pm = CT_CARD_PM_OPS,\n\t},\n};\n\nmodule_pci_driver(ct_driver);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}