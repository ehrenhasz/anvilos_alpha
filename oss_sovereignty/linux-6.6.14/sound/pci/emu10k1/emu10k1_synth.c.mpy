{
  "module_name": "emu10k1_synth.c",
  "hash_id": "7fc39f25fc2afc5289f35336f9adacb94f09737b95cc7e7f8b27b26d9566ed6b",
  "original_prompt": "Ingested from linux-6.6.14/sound/pci/emu10k1/emu10k1_synth.c",
  "human_readable_source": "\n \n\n#include \"emu10k1_synth_local.h\"\n#include <linux/init.h>\n#include <linux/module.h>\n\nMODULE_AUTHOR(\"Takashi Iwai\");\nMODULE_DESCRIPTION(\"Routines for control of EMU10K1 WaveTable synth\");\nMODULE_LICENSE(\"GPL\");\n\n \nstatic int snd_emu10k1_synth_probe(struct device *_dev)\n{\n\tstruct snd_seq_device *dev = to_seq_dev(_dev);\n\tstruct snd_emux *emux;\n\tstruct snd_emu10k1 *hw;\n\tstruct snd_emu10k1_synth_arg *arg;\n\n\targ = SNDRV_SEQ_DEVICE_ARGPTR(dev);\n\tif (arg == NULL)\n\t\treturn -EINVAL;\n\n\tif (arg->seq_ports <= 0)\n\t\treturn 0;  \n\tif (arg->max_voices < 1)\n\t\targ->max_voices = 1;\n\telse if (arg->max_voices > 64)\n\t\targ->max_voices = 64;\n\n\tif (snd_emux_new(&emux) < 0)\n\t\treturn -ENOMEM;\n\n\tsnd_emu10k1_ops_setup(emux);\n\thw = arg->hwptr;\n\temux->hw = hw;\n\temux->max_voices = arg->max_voices;\n\temux->num_ports = arg->seq_ports;\n\temux->memhdr = hw->memhdr;\n\t \n\temux->midi_ports = arg->seq_ports < 2 ? arg->seq_ports : 2;\n\t \n\temux->midi_devidx = hw->audigy ? 2 : 1;\n\temux->linear_panning = 0;\n\temux->hwdep_idx = 2;  \n\n\tif (snd_emux_register(emux, dev->card, arg->index, \"Emu10k1\") < 0) {\n\t\tsnd_emux_free(emux);\n\t\treturn -ENOMEM;\n\t}\n\n\tspin_lock_irq(&hw->voice_lock);\n\thw->synth = emux;\n\thw->get_synth_voice = snd_emu10k1_synth_get_voice;\n\tspin_unlock_irq(&hw->voice_lock);\n\n\tdev->driver_data = emux;\n\n\treturn 0;\n}\n\nstatic int snd_emu10k1_synth_remove(struct device *_dev)\n{\n\tstruct snd_seq_device *dev = to_seq_dev(_dev);\n\tstruct snd_emux *emux;\n\tstruct snd_emu10k1 *hw;\n\n\tif (dev->driver_data == NULL)\n\t\treturn 0;  \n\n\temux = dev->driver_data;\n\n\thw = emux->hw;\n\tspin_lock_irq(&hw->voice_lock);\n\thw->synth = NULL;\n\thw->get_synth_voice = NULL;\n\tspin_unlock_irq(&hw->voice_lock);\n\n\tsnd_emux_free(emux);\n\treturn 0;\n}\n\n \n\nstatic struct snd_seq_driver emu10k1_synth_driver = {\n\t.driver = {\n\t\t.name = KBUILD_MODNAME,\n\t\t.probe = snd_emu10k1_synth_probe,\n\t\t.remove = snd_emu10k1_synth_remove,\n\t},\n\t.id = SNDRV_SEQ_DEV_ID_EMU10K1_SYNTH,\n\t.argsize = sizeof(struct snd_emu10k1_synth_arg),\n};\n\nmodule_snd_seq_driver(emu10k1_synth_driver);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}