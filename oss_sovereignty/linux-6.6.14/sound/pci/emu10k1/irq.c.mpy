{
  "module_name": "irq.c",
  "hash_id": "23a61dee655ad9de60891658dda6bded08b6f8c7685fb4437db43faf8fd0e430",
  "original_prompt": "Ingested from linux-6.6.14/sound/pci/emu10k1/irq.c",
  "human_readable_source": "\n \n\n#include <linux/time.h>\n#include <sound/core.h>\n#include <sound/emu10k1.h>\n\nirqreturn_t snd_emu10k1_interrupt(int irq, void *dev_id)\n{\n\tstruct snd_emu10k1 *emu = dev_id;\n\tunsigned int status, orig_status;\n\tint handled = 0;\n\tint timeout = 0;\n\n\twhile ((status = inl(emu->port + IPR)) != 0) {\n\t\thandled = 1;\n\t\tif ((status & 0xffffffff) == 0xffffffff) {\n\t\t\tdev_info(emu->card->dev,\n\t\t\t\t \"Suspected sound card removal\\n\");\n\t\t\tbreak;\n\t\t}\n\t\tif (++timeout == 1000) {\n\t\t\tdev_info(emu->card->dev, \"emu10k1 irq routine failure\\n\");\n\t\t\tbreak;\n\t\t}\n\t\torig_status = status;\n\t\tif (status & IPR_PCIERROR) {\n\t\t\tdev_err(emu->card->dev, \"interrupt: PCI error\\n\");\n\t\t\tsnd_emu10k1_intr_disable(emu, INTE_PCIERRORENABLE);\n\t\t\tstatus &= ~IPR_PCIERROR;\n\t\t}\n\t\tif (status & (IPR_VOLINCR|IPR_VOLDECR|IPR_MUTE)) {\n\t\t\tif (emu->hwvol_interrupt)\n\t\t\t\temu->hwvol_interrupt(emu, status);\n\t\t\telse\n\t\t\t\tsnd_emu10k1_intr_disable(emu, INTE_VOLINCRENABLE|INTE_VOLDECRENABLE|INTE_MUTEENABLE);\n\t\t\tstatus &= ~(IPR_VOLINCR|IPR_VOLDECR|IPR_MUTE);\n\t\t}\n\t\tif (status & IPR_CHANNELLOOP) {\n\t\t\tstruct snd_emu10k1_voice *pvoice;\n\t\t\tint voice;\n\t\t\tint voice_max = status & IPR_CHANNELNUMBERMASK;\n\t\t\tu32 val;\n\n\t\t\tval = snd_emu10k1_ptr_read(emu, CLIPL, 0);\n\t\t\tpvoice = emu->voices;\n\t\t\tfor (voice = 0; voice <= voice_max; voice++) {\n\t\t\t\tif (voice == 0x20)\n\t\t\t\t\tval = snd_emu10k1_ptr_read(emu, CLIPH, 0);\n\t\t\t\tif (val & 1) {\n\t\t\t\t\tif (pvoice->use && pvoice->interrupt != NULL) {\n\t\t\t\t\t\tpvoice->interrupt(emu, pvoice);\n\t\t\t\t\t\tsnd_emu10k1_voice_intr_ack(emu, voice);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsnd_emu10k1_voice_intr_disable(emu, voice);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tval >>= 1;\n\t\t\t\tpvoice++;\n\t\t\t}\n\t\t\tval = snd_emu10k1_ptr_read(emu, HLIPL, 0);\n\t\t\tpvoice = emu->voices;\n\t\t\tfor (voice = 0; voice <= voice_max; voice++) {\n\t\t\t\tif (voice == 0x20)\n\t\t\t\t\tval = snd_emu10k1_ptr_read(emu, HLIPH, 0);\n\t\t\t\tif (val & 1) {\n\t\t\t\t\tif (pvoice->use && pvoice->interrupt != NULL) {\n\t\t\t\t\t\tpvoice->interrupt(emu, pvoice);\n\t\t\t\t\t\tsnd_emu10k1_voice_half_loop_intr_ack(emu, voice);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsnd_emu10k1_voice_half_loop_intr_disable(emu, voice);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tval >>= 1;\n\t\t\t\tpvoice++;\n\t\t\t}\n\t\t\tstatus &= ~(IPR_CHANNELLOOP | IPR_CHANNELNUMBERMASK);\n\t\t}\n\t\tif (status & (IPR_ADCBUFFULL|IPR_ADCBUFHALFFULL)) {\n\t\t\tif (emu->capture_interrupt)\n\t\t\t\temu->capture_interrupt(emu, status);\n\t\t\telse\n\t\t\t\tsnd_emu10k1_intr_disable(emu, INTE_ADCBUFENABLE);\n\t\t\tstatus &= ~(IPR_ADCBUFFULL|IPR_ADCBUFHALFFULL);\n\t\t}\n\t\tif (status & (IPR_MICBUFFULL|IPR_MICBUFHALFFULL)) {\n\t\t\tif (emu->capture_mic_interrupt)\n\t\t\t\temu->capture_mic_interrupt(emu, status);\n\t\t\telse\n\t\t\t\tsnd_emu10k1_intr_disable(emu, INTE_MICBUFENABLE);\n\t\t\tstatus &= ~(IPR_MICBUFFULL|IPR_MICBUFHALFFULL);\n\t\t}\n\t\tif (status & (IPR_EFXBUFFULL|IPR_EFXBUFHALFFULL)) {\n\t\t\tif (emu->capture_efx_interrupt)\n\t\t\t\temu->capture_efx_interrupt(emu, status);\n\t\t\telse\n\t\t\t\tsnd_emu10k1_intr_disable(emu, INTE_EFXBUFENABLE);\n\t\t\tstatus &= ~(IPR_EFXBUFFULL|IPR_EFXBUFHALFFULL);\n\t\t}\n\t\tif (status & (IPR_MIDITRANSBUFEMPTY|IPR_MIDIRECVBUFEMPTY)) {\n\t\t\tif (emu->midi.interrupt)\n\t\t\t\temu->midi.interrupt(emu, status);\n\t\t\telse\n\t\t\t\tsnd_emu10k1_intr_disable(emu, INTE_MIDITXENABLE|INTE_MIDIRXENABLE);\n\t\t\tstatus &= ~(IPR_MIDITRANSBUFEMPTY|IPR_MIDIRECVBUFEMPTY);\n\t\t}\n\t\tif (status & (IPR_A_MIDITRANSBUFEMPTY2|IPR_A_MIDIRECVBUFEMPTY2)) {\n\t\t\tif (emu->midi2.interrupt)\n\t\t\t\temu->midi2.interrupt(emu, status);\n\t\t\telse\n\t\t\t\tsnd_emu10k1_intr_disable(emu, INTE_A_MIDITXENABLE2|INTE_A_MIDIRXENABLE2);\n\t\t\tstatus &= ~(IPR_A_MIDITRANSBUFEMPTY2|IPR_A_MIDIRECVBUFEMPTY2);\n\t\t}\n\t\tif (status & IPR_INTERVALTIMER) {\n\t\t\tif (emu->timer)\n\t\t\t\tsnd_timer_interrupt(emu->timer, emu->timer->sticks);\n\t\t\telse\n\t\t\t\tsnd_emu10k1_intr_disable(emu, INTE_INTERVALTIMERENB);\n\t\t\tstatus &= ~IPR_INTERVALTIMER;\n\t\t}\n\t\tif (status & (IPR_GPSPDIFSTATUSCHANGE|IPR_CDROMSTATUSCHANGE)) {\n\t\t\tif (emu->spdif_interrupt)\n\t\t\t\temu->spdif_interrupt(emu, status);\n\t\t\telse\n\t\t\t\tsnd_emu10k1_intr_disable(emu, INTE_GPSPDIFENABLE|INTE_CDSPDIFENABLE);\n\t\t\tstatus &= ~(IPR_GPSPDIFSTATUSCHANGE|IPR_CDROMSTATUSCHANGE);\n\t\t}\n\t\tif (status & IPR_FXDSP) {\n\t\t\tif (emu->dsp_interrupt)\n\t\t\t\temu->dsp_interrupt(emu);\n\t\t\telse\n\t\t\t\tsnd_emu10k1_intr_disable(emu, INTE_FXDSPENABLE);\n\t\t\tstatus &= ~IPR_FXDSP;\n\t\t}\n\t\tif (status & IPR_P16V) {\n\t\t\tif (emu->p16v_interrupt)\n\t\t\t\temu->p16v_interrupt(emu);\n\t\t\telse\n\t\t\t\toutl(0, emu->port + INTE2);\n\t\t\tstatus &= ~IPR_P16V;\n\t\t}\n\t\tif (status & IPR_A_GPIO) {\n\t\t\tif (emu->gpio_interrupt)\n\t\t\t\temu->gpio_interrupt(emu);\n\t\t\telse\n\t\t\t\tsnd_emu10k1_intr_disable(emu, INTE_A_GPIOENABLE);\n\t\t\tstatus &= ~IPR_A_GPIO;\n\t\t}\n\n\t\tif (status) {\n\t\t\tdev_err(emu->card->dev,\n\t\t\t\t\"unhandled interrupt: 0x%08x\\n\", status);\n\t\t}\n\t\toutl(orig_status, emu->port + IPR);  \n\t}\n\n\treturn IRQ_RETVAL(handled);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}