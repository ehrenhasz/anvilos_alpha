{
  "module_name": "cs4236.c",
  "hash_id": "323f832524db5bd12f3162dfb0ef45fa53ef22a5194711a8e6cebb417f9042dc",
  "original_prompt": "Ingested from linux-6.6.14/sound/isa/cs423x/cs4236.c",
  "human_readable_source": "\n \n\n#include <linux/init.h>\n#include <linux/err.h>\n#include <linux/isa.h>\n#include <linux/pnp.h>\n#include <linux/module.h>\n#include <sound/core.h>\n#include <sound/wss.h>\n#include <sound/mpu401.h>\n#include <sound/opl3.h>\n#include <sound/initval.h>\n\nMODULE_AUTHOR(\"Jaroslav Kysela <perex@perex.cz>\");\nMODULE_LICENSE(\"GPL\");\nMODULE_DESCRIPTION(\"Cirrus Logic CS4232-9\");\nMODULE_ALIAS(\"snd_cs4232\");\n\n#define IDENT \"CS4232+\"\n#define DEV_NAME \"cs4232+\"\n\nstatic int index[SNDRV_CARDS] = SNDRV_DEFAULT_IDX;\t \nstatic char *id[SNDRV_CARDS] = SNDRV_DEFAULT_STR;\t \nstatic bool enable[SNDRV_CARDS] = SNDRV_DEFAULT_ENABLE_ISAPNP;  \n#ifdef CONFIG_PNP\nstatic bool isapnp[SNDRV_CARDS] = {[0 ... (SNDRV_CARDS - 1)] = 1};\n#endif\nstatic long port[SNDRV_CARDS] = SNDRV_DEFAULT_PORT;\t \nstatic long cport[SNDRV_CARDS] = SNDRV_DEFAULT_PORT;\t \nstatic long mpu_port[SNDRV_CARDS] = SNDRV_DEFAULT_PORT; \nstatic long fm_port[SNDRV_CARDS] = SNDRV_DEFAULT_PORT;\t \nstatic long sb_port[SNDRV_CARDS] = SNDRV_DEFAULT_PORT;\t \nstatic int irq[SNDRV_CARDS] = SNDRV_DEFAULT_IRQ;\t \nstatic int mpu_irq[SNDRV_CARDS] = SNDRV_DEFAULT_IRQ;\t \nstatic int dma1[SNDRV_CARDS] = SNDRV_DEFAULT_DMA;\t \nstatic int dma2[SNDRV_CARDS] = SNDRV_DEFAULT_DMA;\t \n\nmodule_param_array(index, int, NULL, 0444);\nMODULE_PARM_DESC(index, \"Index value for \" IDENT \" soundcard.\");\nmodule_param_array(id, charp, NULL, 0444);\nMODULE_PARM_DESC(id, \"ID string for \" IDENT \" soundcard.\");\nmodule_param_array(enable, bool, NULL, 0444);\nMODULE_PARM_DESC(enable, \"Enable \" IDENT \" soundcard.\");\n#ifdef CONFIG_PNP\nmodule_param_array(isapnp, bool, NULL, 0444);\nMODULE_PARM_DESC(isapnp, \"ISA PnP detection for specified soundcard.\");\n#endif\nmodule_param_hw_array(port, long, ioport, NULL, 0444);\nMODULE_PARM_DESC(port, \"Port # for \" IDENT \" driver.\");\nmodule_param_hw_array(cport, long, ioport, NULL, 0444);\nMODULE_PARM_DESC(cport, \"Control port # for \" IDENT \" driver.\");\nmodule_param_hw_array(mpu_port, long, ioport, NULL, 0444);\nMODULE_PARM_DESC(mpu_port, \"MPU-401 port # for \" IDENT \" driver.\");\nmodule_param_hw_array(fm_port, long, ioport, NULL, 0444);\nMODULE_PARM_DESC(fm_port, \"FM port # for \" IDENT \" driver.\");\nmodule_param_hw_array(sb_port, long, ioport, NULL, 0444);\nMODULE_PARM_DESC(sb_port, \"SB port # for \" IDENT \" driver (optional).\");\nmodule_param_hw_array(irq, int, irq, NULL, 0444);\nMODULE_PARM_DESC(irq, \"IRQ # for \" IDENT \" driver.\");\nmodule_param_hw_array(mpu_irq, int, irq, NULL, 0444);\nMODULE_PARM_DESC(mpu_irq, \"MPU-401 IRQ # for \" IDENT \" driver.\");\nmodule_param_hw_array(dma1, int, dma, NULL, 0444);\nMODULE_PARM_DESC(dma1, \"DMA1 # for \" IDENT \" driver.\");\nmodule_param_hw_array(dma2, int, dma, NULL, 0444);\nMODULE_PARM_DESC(dma2, \"DMA2 # for \" IDENT \" driver.\");\n\n#ifdef CONFIG_PNP\nstatic int isa_registered;\nstatic int pnpc_registered;\nstatic int pnp_registered;\n#endif  \n\nstruct snd_card_cs4236 {\n\tstruct snd_wss *chip;\n#ifdef CONFIG_PNP\n\tstruct pnp_dev *wss;\n\tstruct pnp_dev *ctrl;\n\tstruct pnp_dev *mpu;\n#endif\n};\n\n#ifdef CONFIG_PNP\n\n \nstatic const struct pnp_device_id snd_cs423x_pnpbiosids[] = {\n\t{ .id = \"CSC0100\" },\n\t{ .id = \"CSC0000\" },\n\t \n\t{ .id = \"GIM0100\" },\n\t{ .id = \"\" }\n};\nMODULE_DEVICE_TABLE(pnp, snd_cs423x_pnpbiosids);\n\n#define CS423X_ISAPNP_DRIVER\t\"cs4232_isapnp\"\nstatic const struct pnp_card_device_id snd_cs423x_pnpids[] = {\n\t \n\t{ .id = \"CSC0d32\", .devs = { { \"CSC0000\" }, { \"CSC0010\" }, { \"PNPb006\" } } },\n\t \n\t{ .id = \"CSC1a32\", .devs = { { \"CSC0000\" }, { \"CSC0010\" }, { \"CSC0003\" } } },\n\t \n\t{ .id = \"CSC4232\", .devs = { { \"CSC0000\" }, { \"CSC0002\" }, { \"CSC0003\" } } },\n\t \n\t{ .id = \"CSC4236\", .devs = { { \"CSC0000\" }, { \"CSC0010\" }, { \"CSC0003\" } } },\n\t \n\t{ .id = \"CSC7532\", .devs = { { \"CSC0000\" }, { \"CSC0010\" }, { \"CSCb006\" } } },\n\t \n\t{ .id = \"CSC7632\", .devs = { { \"CSC0000\" }, { \"CSC0010\" }, { \"PNPb006\" } } },\n\t \n\t{ .id = \"CSCf032\", .devs = { { \"CSC0000\" }, { \"CSC0010\" }, { \"CSC0003\" } } },\n\t \n\t{ .id = \"CSCe825\", .devs = { { \"CSC0100\" }, { \"CSC0110\" }, { \"CSC010f\" } } },\n\t \n\t{ .id = \"CSC0225\", .devs = { { \"CSC0000\" }, { \"CSC0010\" }, { \"CSC0003\" } } },\n\t \n\t{ .id = \"CSC0225\", .devs = { { \"CSC0100\" }, { \"CSC0110\" }, { \"CSC0103\" } } },\n\t \n\t{ .id = \"CSC0225\", .devs = { { \"CSC0100\" }, { \"CSC0110\" } } },\n\t \n\t{ .id = \"CSC0437\", .devs = { { \"CSC0000\" }, { \"CSC0010\" }, { \"CSC0003\" } } },\n\t \n\t{ .id = \"CSC0735\", .devs = { { \"CSC0000\" }, { \"CSC0010\" } } },\n\t \n\t{ .id = \"CSC0b35\", .devs = { { \"CSC0000\" }, { \"CSC0010\" }, { \"CSC0003\" } } },\n\t \n\t{ .id = \"CSC0b36\", .devs = { { \"CSC0000\" }, { \"CSC0010\" }, { \"CSC0003\" } } },\n\t \n\t{ .id = \"CSC1425\", .devs = { { \"CSC0100\" }, { \"CSC0110\" } } },\n\t \n\t{ .id = \"CSC1335\", .devs = { { \"CSC0000\" }, { \"CSC0010\" }, { \"CSC0003\" } } },\n\t \n\t{ .id = \"CSC1525\", .devs = { { \"CSC0100\" }, { \"CSC0110\" }, { \"CSC0103\" } } },\n\t \n\t{ .id = \"CSC1e37\", .devs = { { \"CSC0000\" }, { \"CSC0010\" }, { \"CSC0003\" } } },\n\t \n\t{ .id = \"CSC4236\", .devs = { { \"CSC0000\" }, { \"CSC0010\" }, { \"CSC0003\" } } },\n\t \n\t{ .id = \"CSC4237\", .devs = { { \"CSC0000\" }, { \"CSC0010\" }, { \"CSC0003\" } } },\n\t \n\t{ .id = \"CSC4336\", .devs = { { \"CSC0000\" }, { \"CSC0010\" }, { \"CSC0003\" } } },\n\t \n\t{ .id = \"CSC4536\", .devs = { { \"CSC0000\" }, { \"CSC0010\" }, { \"CSC0003\" } } },\n\t \n\t{ .id = \"CSC4625\", .devs = { { \"CSC0100\" }, { \"CSC0110\" }, { \"CSC0103\" } } },\n\t \n\t{ .id = \"CSC4637\", .devs = { { \"CSC0000\" }, { \"CSC0010\" }, { \"CSC0003\" } } },\n\t \n\t{ .id = \"CSC4837\", .devs = { { \"CSC0000\" }, { \"CSC0010\" }, { \"CSC0003\" } } },\n\t \n\t{ .id = \"CSC6835\", .devs = { { \"CSC0000\" }, { \"CSC0010\" }, { \"CSC0003\" } } },\n\t \n\t{ .id = \"CSC6835\", .devs = { { \"CSC0000\" }, { \"CSC0010\" } } },\n\t \n\t{ .id = \"CSC6836\", .devs = { { \"CSC0000\" }, { \"CSC0010\" }, { \"CSC0003\" } } },\n\t \n\t{ .id = \"CSC7537\", .devs = { { \"CSC0000\" }, { \"CSC0010\" }, { \"CSC0003\" } } },\n\t \n\t{ .id = \"CSC8025\", .devs = { { \"CSC0100\" }, { \"CSC0110\" }, { \"CSC0103\" } } },\n\t \n\t{ .id = \"CSC8037\", .devs = { { \"CSC0000\" }, { \"CSC0010\" }, { \"CSC0003\" } } },\n\t \n\t{ .id = \"CSCc835\", .devs = { { \"CSC0000\" }, { \"CSC0010\" } } },\n\t \n\t{ .id = \"CSC9836\", .devs = { { \"CSC0000\" }, { \"CSC0010\" }, { \"CSC0003\" } } },\n\t \n\t{ .id = \"CSC9837\", .devs = { { \"CSC0000\" }, { \"CSC0010\" }, { \"CSC0003\" } } },\n\t \n\t{ .id = \"CSCa736\", .devs = { { \"CSC0000\" }, { \"CSC0010\" }, { \"CSC0003\" } } },\n\t \n\t{ .id = \"CSCa836\", .devs = { { \"CSCa800\" }, { \"CSCa810\" }, { \"CSCa803\" } } },\n\t \n\t{ .id = \"CSCa836\", .devs = { { \"CSCa800\" }, { \"CSCa810\" } } },\n\t \n\t{ .id = \"CSCd925\", .devs = { { \"CSC0000\" }, { \"CSC0010\" }, { \"CSC0003\" } } },\n\t \n\t{ .id = \"CSCd937\", .devs = { { \"CSC0000\" }, { \"CSC0010\" }, { \"CSC0003\" } } },\n\t \n\t{ .id = \"CSCe825\", .devs = { { \"CSC0100\" }, { \"CSC0110\" } } },\n\t \n\t{ .id = \"CSC4825\", .devs = { { \"CSC0100\" }, { \"CSC0110\" } } },\n\t \n\t{ .id = \"CSCe835\", .devs = { { \"CSC0000\" }, { \"CSC0010\" } } },\n\t \n\t{ .id = \"CSCe836\", .devs = { { \"CSC0000\" }, { \"CSC0010\" } } },\n\t \n\t{ .id = \"CSCe936\", .devs = { { \"CSC0000\" }, { \"CSC0010\" }, { \"CSC0003\" } } },\n\t \n\t{ .id = \"CSCf235\", .devs = { { \"CSC0000\" }, { \"CSC0010\" }, { \"CSC0003\" } } },\n\t \n\t{ .id = \"CSCf238\", .devs = { { \"CSC0000\" }, { \"CSC0010\" }, { \"CSC0003\" } } },\n\t \n\t{ .id = \"\" }\t \n};\n\nMODULE_DEVICE_TABLE(pnp_card, snd_cs423x_pnpids);\n\n \nstatic int snd_cs423x_pnp_init_wss(int dev, struct pnp_dev *pdev)\n{\n\tif (pnp_activate_dev(pdev) < 0) {\n\t\tprintk(KERN_ERR IDENT \" WSS PnP configure failed for WSS (out of resources?)\\n\");\n\t\treturn -EBUSY;\n\t}\n\tport[dev] = pnp_port_start(pdev, 0);\n\tif (fm_port[dev] > 0)\n\t\tfm_port[dev] = pnp_port_start(pdev, 1);\n\tsb_port[dev] = pnp_port_start(pdev, 2);\n\tirq[dev] = pnp_irq(pdev, 0);\n\tdma1[dev] = pnp_dma(pdev, 0);\n\tdma2[dev] = pnp_dma(pdev, 1) == 4 ? -1 : (int)pnp_dma(pdev, 1);\n\tsnd_printdd(\"isapnp WSS: wss port=0x%lx, fm port=0x%lx, sb port=0x%lx\\n\",\n\t\t\tport[dev], fm_port[dev], sb_port[dev]);\n\tsnd_printdd(\"isapnp WSS: irq=%i, dma1=%i, dma2=%i\\n\",\n\t\t\tirq[dev], dma1[dev], dma2[dev]);\n\treturn 0;\n}\n\n \nstatic int snd_cs423x_pnp_init_ctrl(int dev, struct pnp_dev *pdev)\n{\n\tif (pnp_activate_dev(pdev) < 0) {\n\t\tprintk(KERN_ERR IDENT \" CTRL PnP configure failed for WSS (out of resources?)\\n\");\n\t\treturn -EBUSY;\n\t}\n\tcport[dev] = pnp_port_start(pdev, 0);\n\tsnd_printdd(\"isapnp CTRL: control port=0x%lx\\n\", cport[dev]);\n\treturn 0;\n}\n\n \nstatic int snd_cs423x_pnp_init_mpu(int dev, struct pnp_dev *pdev)\n{\n\tif (pnp_activate_dev(pdev) < 0) {\n\t\tprintk(KERN_ERR IDENT \" MPU401 PnP configure failed for WSS (out of resources?)\\n\");\n\t\tmpu_port[dev] = SNDRV_AUTO_PORT;\n\t\tmpu_irq[dev] = SNDRV_AUTO_IRQ;\n\t} else {\n\t\tmpu_port[dev] = pnp_port_start(pdev, 0);\n\t\tif (mpu_irq[dev] >= 0 &&\n\t\t    pnp_irq_valid(pdev, 0) &&\n\t\t    pnp_irq(pdev, 0) != (resource_size_t)-1) {\n\t\t\tmpu_irq[dev] = pnp_irq(pdev, 0);\n\t\t} else {\n\t\t\tmpu_irq[dev] = -1;\t \n\t\t}\n\t}\n\tsnd_printdd(\"isapnp MPU: port=0x%lx, irq=%i\\n\", mpu_port[dev], mpu_irq[dev]);\n\treturn 0;\n}\n\nstatic int snd_card_cs423x_pnp(int dev, struct snd_card_cs4236 *acard,\n\t\t\t       struct pnp_dev *pdev,\n\t\t\t       struct pnp_dev *cdev)\n{\n\tacard->wss = pdev;\n\tif (snd_cs423x_pnp_init_wss(dev, acard->wss) < 0)\n\t\treturn -EBUSY;\n\tif (cdev)\n\t\tcport[dev] = pnp_port_start(cdev, 0);\n\telse\n\t\tcport[dev] = -1;\n\treturn 0;\n}\n\nstatic int snd_card_cs423x_pnpc(int dev, struct snd_card_cs4236 *acard,\n\t\t\t\tstruct pnp_card_link *card,\n\t\t\t\tconst struct pnp_card_device_id *id)\n{\n\tacard->wss = pnp_request_card_device(card, id->devs[0].id, NULL);\n\tif (acard->wss == NULL)\n\t\treturn -EBUSY;\n\tacard->ctrl = pnp_request_card_device(card, id->devs[1].id, NULL);\n\tif (acard->ctrl == NULL)\n\t\treturn -EBUSY;\n\tif (id->devs[2].id[0]) {\n\t\tacard->mpu = pnp_request_card_device(card, id->devs[2].id, NULL);\n\t\tif (acard->mpu == NULL)\n\t\t\treturn -EBUSY;\n\t}\n\n\t \n\tif (snd_cs423x_pnp_init_wss(dev, acard->wss) < 0)\n\t\treturn -EBUSY;\n\n\t \n\tif (acard->ctrl && cport[dev] > 0) {\n\t\tif (snd_cs423x_pnp_init_ctrl(dev, acard->ctrl) < 0)\n\t\t\treturn -EBUSY;\n\t}\n\t \n\tif (acard->mpu && mpu_port[dev] > 0) {\n\t\tif (snd_cs423x_pnp_init_mpu(dev, acard->mpu) < 0)\n\t\t\treturn -EBUSY;\n\t}\n\treturn 0;\n}\n#endif  \n\n#ifdef CONFIG_PNP\n#define is_isapnp_selected(dev)\t\tisapnp[dev]\n#else\n#define is_isapnp_selected(dev)\t\t0\n#endif\n\nstatic int snd_cs423x_card_new(struct device *pdev, int dev,\n\t\t\t       struct snd_card **cardp)\n{\n\tstruct snd_card *card;\n\tint err;\n\n\terr = snd_devm_card_new(pdev, index[dev], id[dev], THIS_MODULE,\n\t\t\t\tsizeof(struct snd_card_cs4236), &card);\n\tif (err < 0)\n\t\treturn err;\n\t*cardp = card;\n\treturn 0;\n}\n\nstatic int snd_cs423x_probe(struct snd_card *card, int dev)\n{\n\tstruct snd_card_cs4236 *acard;\n\tstruct snd_wss *chip;\n\tstruct snd_opl3 *opl3;\n\tint err;\n\n\tacard = card->private_data;\n\tif (sb_port[dev] > 0 && sb_port[dev] != SNDRV_AUTO_PORT) {\n\t\tif (!devm_request_region(card->dev, sb_port[dev], 16,\n\t\t\t\t\t IDENT \" SB\")) {\n\t\t\tprintk(KERN_ERR IDENT \": unable to register SB port at 0x%lx\\n\", sb_port[dev]);\n\t\t\treturn -EBUSY;\n\t\t}\n\t}\n\n\terr = snd_cs4236_create(card, port[dev], cport[dev],\n\t\t\t     irq[dev],\n\t\t\t     dma1[dev], dma2[dev],\n\t\t\t     WSS_HW_DETECT3, 0, &chip);\n\tif (err < 0)\n\t\treturn err;\n\n\tacard->chip = chip;\n\tif (chip->hardware & WSS_HW_CS4236B_MASK) {\n\n\t\terr = snd_cs4236_pcm(chip, 0);\n\t\tif (err < 0)\n\t\t\treturn err;\n\n\t\terr = snd_cs4236_mixer(chip);\n\t\tif (err < 0)\n\t\t\treturn err;\n\t} else {\n\t\terr = snd_wss_pcm(chip, 0);\n\t\tif (err < 0)\n\t\t\treturn err;\n\n\t\terr = snd_wss_mixer(chip);\n\t\tif (err < 0)\n\t\t\treturn err;\n\t}\n\tstrscpy(card->driver, chip->pcm->name, sizeof(card->driver));\n\tstrscpy(card->shortname, chip->pcm->name, sizeof(card->shortname));\n\tif (dma2[dev] < 0)\n\t\tscnprintf(card->longname, sizeof(card->longname),\n\t\t\t  \"%s at 0x%lx, irq %i, dma %i\",\n\t\t\t  chip->pcm->name, chip->port, irq[dev], dma1[dev]);\n\telse\n\t\tscnprintf(card->longname, sizeof(card->longname),\n\t\t\t  \"%s at 0x%lx, irq %i, dma %i&%d\",\n\t\t\t  chip->pcm->name, chip->port, irq[dev], dma1[dev],\n\t\t\t  dma2[dev]);\n\n\terr = snd_wss_timer(chip, 0);\n\tif (err < 0)\n\t\treturn err;\n\n\tif (fm_port[dev] > 0 && fm_port[dev] != SNDRV_AUTO_PORT) {\n\t\tif (snd_opl3_create(card,\n\t\t\t\t    fm_port[dev], fm_port[dev] + 2,\n\t\t\t\t    OPL3_HW_OPL3_CS, 0, &opl3) < 0) {\n\t\t\tprintk(KERN_WARNING IDENT \": OPL3 not detected\\n\");\n\t\t} else {\n\t\t\terr = snd_opl3_hwdep_new(opl3, 0, 1, NULL);\n\t\t\tif (err < 0)\n\t\t\t\treturn err;\n\t\t}\n\t}\n\n\tif (mpu_port[dev] > 0 && mpu_port[dev] != SNDRV_AUTO_PORT) {\n\t\tif (mpu_irq[dev] == SNDRV_AUTO_IRQ)\n\t\t\tmpu_irq[dev] = -1;\n\t\tif (snd_mpu401_uart_new(card, 0, MPU401_HW_CS4232,\n\t\t\t\t\tmpu_port[dev], 0,\n\t\t\t\t\tmpu_irq[dev], NULL) < 0)\n\t\t\tprintk(KERN_WARNING IDENT \": MPU401 not detected\\n\");\n\t}\n\n\treturn snd_card_register(card);\n}\n\nstatic int snd_cs423x_isa_match(struct device *pdev,\n\t\t\t\tunsigned int dev)\n{\n\tif (!enable[dev] || is_isapnp_selected(dev))\n\t\treturn 0;\n\n\tif (port[dev] == SNDRV_AUTO_PORT) {\n\t\tdev_err(pdev, \"please specify port\\n\");\n\t\treturn 0;\n\t}\n\tif (cport[dev] == SNDRV_AUTO_PORT) {\n\t\tdev_err(pdev, \"please specify cport\\n\");\n\t\treturn 0;\n\t}\n\tif (irq[dev] == SNDRV_AUTO_IRQ) {\n\t\tdev_err(pdev, \"please specify irq\\n\");\n\t\treturn 0;\n\t}\n\tif (dma1[dev] == SNDRV_AUTO_DMA) {\n\t\tdev_err(pdev, \"please specify dma1\\n\");\n\t\treturn 0;\n\t}\n\treturn 1;\n}\n\nstatic int snd_cs423x_isa_probe(struct device *pdev,\n\t\t\t\tunsigned int dev)\n{\n\tstruct snd_card *card;\n\tint err;\n\n\terr = snd_cs423x_card_new(pdev, dev, &card);\n\tif (err < 0)\n\t\treturn err;\n\terr = snd_cs423x_probe(card, dev);\n\tif (err < 0)\n\t\treturn err;\n\tdev_set_drvdata(pdev, card);\n\treturn 0;\n}\n\n#ifdef CONFIG_PM\nstatic int snd_cs423x_suspend(struct snd_card *card)\n{\n\tstruct snd_card_cs4236 *acard = card->private_data;\n\tsnd_power_change_state(card, SNDRV_CTL_POWER_D3hot);\n\tacard->chip->suspend(acard->chip);\n\treturn 0;\n}\n\nstatic int snd_cs423x_resume(struct snd_card *card)\n{\n\tstruct snd_card_cs4236 *acard = card->private_data;\n\tacard->chip->resume(acard->chip);\n\tsnd_power_change_state(card, SNDRV_CTL_POWER_D0);\n\treturn 0;\n}\n\nstatic int snd_cs423x_isa_suspend(struct device *dev, unsigned int n,\n\t\t\t\t  pm_message_t state)\n{\n\treturn snd_cs423x_suspend(dev_get_drvdata(dev));\n}\n\nstatic int snd_cs423x_isa_resume(struct device *dev, unsigned int n)\n{\n\treturn snd_cs423x_resume(dev_get_drvdata(dev));\n}\n#endif\n\nstatic struct isa_driver cs423x_isa_driver = {\n\t.match\t\t= snd_cs423x_isa_match,\n\t.probe\t\t= snd_cs423x_isa_probe,\n#ifdef CONFIG_PM\n\t.suspend\t= snd_cs423x_isa_suspend,\n\t.resume\t\t= snd_cs423x_isa_resume,\n#endif\n\t.driver\t\t= {\n\t\t.name\t= DEV_NAME\n\t},\n};\n\n\n#ifdef CONFIG_PNP\nstatic int snd_cs423x_pnpbios_detect(struct pnp_dev *pdev,\n\t\t\t\t     const struct pnp_device_id *id)\n{\n\tstatic int dev;\n\tint err;\n\tstruct snd_card *card;\n\tstruct pnp_dev *cdev, *iter;\n\tchar cid[PNP_ID_LEN];\n\n\tif (pnp_device_is_isapnp(pdev))\n\t\treturn -ENOENT;\t \n\tfor (; dev < SNDRV_CARDS; dev++) {\n\t\tif (enable[dev] && isapnp[dev])\n\t\t\tbreak;\n\t}\n\tif (dev >= SNDRV_CARDS)\n\t\treturn -ENODEV;\n\n\t \n\tstrcpy(cid, pdev->id[0].id);\n\tcid[5] = '1';\n\tcdev = NULL;\n\tlist_for_each_entry(iter, &(pdev->protocol->devices), protocol_list) {\n\t\tif (!strcmp(iter->id[0].id, cid)) {\n\t\t\tcdev = iter;\n\t\t\tbreak;\n\t\t}\n\t}\n\terr = snd_cs423x_card_new(&pdev->dev, dev, &card);\n\tif (err < 0)\n\t\treturn err;\n\terr = snd_card_cs423x_pnp(dev, card->private_data, pdev, cdev);\n\tif (err < 0) {\n\t\tprintk(KERN_ERR \"PnP BIOS detection failed for \" IDENT \"\\n\");\n\t\treturn err;\n\t}\n\terr = snd_cs423x_probe(card, dev);\n\tif (err < 0)\n\t\treturn err;\n\tpnp_set_drvdata(pdev, card);\n\tdev++;\n\treturn 0;\n}\n\n#ifdef CONFIG_PM\nstatic int snd_cs423x_pnp_suspend(struct pnp_dev *pdev, pm_message_t state)\n{\n\treturn snd_cs423x_suspend(pnp_get_drvdata(pdev));\n}\n\nstatic int snd_cs423x_pnp_resume(struct pnp_dev *pdev)\n{\n\treturn snd_cs423x_resume(pnp_get_drvdata(pdev));\n}\n#endif\n\nstatic struct pnp_driver cs423x_pnp_driver = {\n\t.name = \"cs423x-pnpbios\",\n\t.id_table = snd_cs423x_pnpbiosids,\n\t.probe = snd_cs423x_pnpbios_detect,\n#ifdef CONFIG_PM\n\t.suspend\t= snd_cs423x_pnp_suspend,\n\t.resume\t\t= snd_cs423x_pnp_resume,\n#endif\n};\n\nstatic int snd_cs423x_pnpc_detect(struct pnp_card_link *pcard,\n\t\t\t\t  const struct pnp_card_device_id *pid)\n{\n\tstatic int dev;\n\tstruct snd_card *card;\n\tint res;\n\n\tfor ( ; dev < SNDRV_CARDS; dev++) {\n\t\tif (enable[dev] && isapnp[dev])\n\t\t\tbreak;\n\t}\n\tif (dev >= SNDRV_CARDS)\n\t\treturn -ENODEV;\n\n\tres = snd_cs423x_card_new(&pcard->card->dev, dev, &card);\n\tif (res < 0)\n\t\treturn res;\n\tres = snd_card_cs423x_pnpc(dev, card->private_data, pcard, pid);\n\tif (res < 0) {\n\t\tprintk(KERN_ERR \"isapnp detection failed and probing for \" IDENT\n\t\t       \" is not supported\\n\");\n\t\treturn res;\n\t}\n\tres = snd_cs423x_probe(card, dev);\n\tif (res < 0)\n\t\treturn res;\n\tpnp_set_card_drvdata(pcard, card);\n\tdev++;\n\treturn 0;\n}\n\n#ifdef CONFIG_PM\nstatic int snd_cs423x_pnpc_suspend(struct pnp_card_link *pcard, pm_message_t state)\n{\n\treturn snd_cs423x_suspend(pnp_get_card_drvdata(pcard));\n}\n\nstatic int snd_cs423x_pnpc_resume(struct pnp_card_link *pcard)\n{\n\treturn snd_cs423x_resume(pnp_get_card_drvdata(pcard));\n}\n#endif\n\nstatic struct pnp_card_driver cs423x_pnpc_driver = {\n\t.flags = PNP_DRIVER_RES_DISABLE,\n\t.name = CS423X_ISAPNP_DRIVER,\n\t.id_table = snd_cs423x_pnpids,\n\t.probe = snd_cs423x_pnpc_detect,\n#ifdef CONFIG_PM\n\t.suspend\t= snd_cs423x_pnpc_suspend,\n\t.resume\t\t= snd_cs423x_pnpc_resume,\n#endif\n};\n#endif  \n\nstatic int __init alsa_card_cs423x_init(void)\n{\n\tint err;\n\n\terr = isa_register_driver(&cs423x_isa_driver, SNDRV_CARDS);\n#ifdef CONFIG_PNP\n\tif (!err)\n\t\tisa_registered = 1;\n\terr = pnp_register_driver(&cs423x_pnp_driver);\n\tif (!err)\n\t\tpnp_registered = 1;\n\terr = pnp_register_card_driver(&cs423x_pnpc_driver);\n\tif (!err)\n\t\tpnpc_registered = 1;\n\tif (pnp_registered)\n\t\terr = 0;\n\tif (isa_registered)\n\t\terr = 0;\n#endif\n\treturn err;\n}\n\nstatic void __exit alsa_card_cs423x_exit(void)\n{\n#ifdef CONFIG_PNP\n\tif (pnpc_registered)\n\t\tpnp_unregister_card_driver(&cs423x_pnpc_driver);\n\tif (pnp_registered)\n\t\tpnp_unregister_driver(&cs423x_pnp_driver);\n\tif (isa_registered)\n#endif\n\t\tisa_unregister_driver(&cs423x_isa_driver);\n}\n\nmodule_init(alsa_card_cs423x_init)\nmodule_exit(alsa_card_cs423x_exit)\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}