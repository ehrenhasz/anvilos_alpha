{
  "module_name": "gus_mem_proc.c",
  "hash_id": "165f4207b2046d2add5ff55a3bf27b3b0ef70a87d1c0e8aa71976651e8a27238",
  "original_prompt": "Ingested from linux-6.6.14/sound/isa/gus/gus_mem_proc.c",
  "human_readable_source": "\n \n\n#include <linux/slab.h>\n#include <sound/core.h>\n#include <sound/gus.h>\n#include <sound/info.h>\n\nstruct gus_proc_private {\n\tint rom;\t\t \n\tunsigned int address;\n\tunsigned int size;\n\tstruct snd_gus_card * gus;\n};\n\nstatic ssize_t snd_gf1_mem_proc_dump(struct snd_info_entry *entry,\n\t\t\t\t     void *file_private_data,\n\t\t\t\t     struct file *file, char __user *buf,\n\t\t\t\t     size_t count, loff_t pos)\n{\n\tstruct gus_proc_private *priv = entry->private_data;\n\tstruct snd_gus_card *gus = priv->gus;\n\tint err;\n\n\terr = snd_gus_dram_read(gus, buf, pos, count, priv->rom);\n\tif (err < 0)\n\t\treturn err;\n\treturn count;\n}\t\t\t\n\nstatic void snd_gf1_mem_proc_free(struct snd_info_entry *entry)\n{\n\tstruct gus_proc_private *priv = entry->private_data;\n\tkfree(priv);\n}\n\nstatic const struct snd_info_entry_ops snd_gf1_mem_proc_ops = {\n\t.read = snd_gf1_mem_proc_dump,\n};\n\nint snd_gf1_mem_proc_init(struct snd_gus_card * gus)\n{\n\tint idx;\n\tchar name[16];\n\tstruct gus_proc_private *priv;\n\tstruct snd_info_entry *entry;\n\n\tfor (idx = 0; idx < 4; idx++) {\n\t\tif (gus->gf1.mem_alloc.banks_8[idx].size > 0) {\n\t\t\tpriv = kzalloc(sizeof(*priv), GFP_KERNEL);\n\t\t\tif (priv == NULL)\n\t\t\t\treturn -ENOMEM;\n\t\t\tpriv->gus = gus;\n\t\t\tsprintf(name, \"gus-ram-%i\", idx);\n\t\t\tif (! snd_card_proc_new(gus->card, name, &entry)) {\n\t\t\t\tentry->content = SNDRV_INFO_CONTENT_DATA;\n\t\t\t\tentry->private_data = priv;\n\t\t\t\tentry->private_free = snd_gf1_mem_proc_free;\n\t\t\t\tentry->c.ops = &snd_gf1_mem_proc_ops;\n\t\t\t\tpriv->address = gus->gf1.mem_alloc.banks_8[idx].address;\n\t\t\t\tpriv->size = entry->size = gus->gf1.mem_alloc.banks_8[idx].size;\n\t\t\t}\n\t\t}\n\t}\n\tfor (idx = 0; idx < 4; idx++) {\n\t\tif (gus->gf1.rom_present & (1 << idx)) {\n\t\t\tpriv = kzalloc(sizeof(*priv), GFP_KERNEL);\n\t\t\tif (priv == NULL)\n\t\t\t\treturn -ENOMEM;\n\t\t\tpriv->rom = 1;\n\t\t\tpriv->gus = gus;\n\t\t\tsprintf(name, \"gus-rom-%i\", idx);\n\t\t\tif (! snd_card_proc_new(gus->card, name, &entry)) {\n\t\t\t\tentry->content = SNDRV_INFO_CONTENT_DATA;\n\t\t\t\tentry->private_data = priv;\n\t\t\t\tentry->private_free = snd_gf1_mem_proc_free;\n\t\t\t\tentry->c.ops = &snd_gf1_mem_proc_ops;\n\t\t\t\tpriv->address = idx * 4096 * 1024;\n\t\t\t\tpriv->size = entry->size = gus->gf1.rom_memory;\n\t\t\t}\n\t\t}\n\t}\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}