{
  "module_name": "gus_dram.c",
  "hash_id": "1fa1f6994a708557b196169ddc027ae04d20d62520388e504c12eefaf9f41a43",
  "original_prompt": "Ingested from linux-6.6.14/sound/isa/gus/gus_dram.c",
  "human_readable_source": "\n \n\n#include <linux/time.h>\n#include <sound/core.h>\n#include <sound/gus.h>\n#include <sound/info.h>\n\n\nstatic int snd_gus_dram_poke(struct snd_gus_card *gus, char __user *_buffer,\n\t\t\t     unsigned int address, unsigned int size)\n{\n\tunsigned long flags;\n\tunsigned int size1, size2;\n\tchar buffer[256], *pbuffer;\n\n\twhile (size > 0) {\n\t\tsize1 = size > sizeof(buffer) ? sizeof(buffer) : size;\n\t\tif (copy_from_user(buffer, _buffer, size1))\n\t\t\treturn -EFAULT;\n\t\tif (gus->interwave) {\n\t\t\tspin_lock_irqsave(&gus->reg_lock, flags);\n\t\t\tsnd_gf1_write8(gus, SNDRV_GF1_GB_MEMORY_CONTROL, 0x01);\n\t\t\tsnd_gf1_dram_addr(gus, address);\n\t\t\toutsb(GUSP(gus, DRAM), buffer, size1);\n\t\t\tspin_unlock_irqrestore(&gus->reg_lock, flags);\n\t\t\taddress += size1;\n\t\t} else {\n\t\t\tpbuffer = buffer;\n\t\t\tsize2 = size1;\n\t\t\twhile (size2--)\n\t\t\t\tsnd_gf1_poke(gus, address++, *pbuffer++);\n\t\t}\n\t\tsize -= size1;\n\t\t_buffer += size1;\n\t}\n\treturn 0;\n}\n\n\nint snd_gus_dram_write(struct snd_gus_card *gus, char __user *buffer,\n\t\t       unsigned int address, unsigned int size)\n{\n\treturn snd_gus_dram_poke(gus, buffer, address, size);\n}\n\nstatic int snd_gus_dram_peek(struct snd_gus_card *gus, char __user *_buffer,\n\t\t\t     unsigned int address, unsigned int size,\n\t\t\t     int rom)\n{\n\tunsigned long flags;\n\tunsigned int size1, size2;\n\tchar buffer[256], *pbuffer;\n\n\twhile (size > 0) {\n\t\tsize1 = size > sizeof(buffer) ? sizeof(buffer) : size;\n\t\tif (gus->interwave) {\n\t\t\tspin_lock_irqsave(&gus->reg_lock, flags);\n\t\t\tsnd_gf1_write8(gus, SNDRV_GF1_GB_MEMORY_CONTROL, rom ? 0x03 : 0x01);\n\t\t\tsnd_gf1_dram_addr(gus, address);\n\t\t\tinsb(GUSP(gus, DRAM), buffer, size1);\n\t\t\tsnd_gf1_write8(gus, SNDRV_GF1_GB_MEMORY_CONTROL, 0x01);\n\t\t\tspin_unlock_irqrestore(&gus->reg_lock, flags);\n\t\t\taddress += size1;\n\t\t} else {\n\t\t\tpbuffer = buffer;\n\t\t\tsize2 = size1;\n\t\t\twhile (size2--)\n\t\t\t\t*pbuffer++ = snd_gf1_peek(gus, address++);\n\t\t}\n\t\tif (copy_to_user(_buffer, buffer, size1))\n\t\t\treturn -EFAULT;\n\t\tsize -= size1;\n\t\t_buffer += size1;\n\t}\n\treturn 0;\n}\n\nint snd_gus_dram_read(struct snd_gus_card *gus, char __user *buffer,\n\t\t      unsigned int address, unsigned int size,\n\t\t      int rom)\n{\n\treturn snd_gus_dram_peek(gus, buffer, address, size, rom);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}