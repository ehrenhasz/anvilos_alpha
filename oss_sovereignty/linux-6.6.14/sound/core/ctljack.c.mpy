{
  "module_name": "ctljack.c",
  "hash_id": "eac6e40d43037556d2947a566371d3d038339f2973a6c83ef7dc2668c42d4dc9",
  "original_prompt": "Ingested from linux-6.6.14/sound/core/ctljack.c",
  "human_readable_source": "\n \n\n#include <linux/kernel.h>\n#include <linux/export.h>\n#include <sound/core.h>\n#include <sound/control.h>\n\n#define jack_detect_kctl_info\tsnd_ctl_boolean_mono_info\n\nstatic int jack_detect_kctl_get(struct snd_kcontrol *kcontrol,\n\t\t\t\tstruct snd_ctl_elem_value *ucontrol)\n{\n\tucontrol->value.integer.value[0] = kcontrol->private_value;\n\treturn 0;\n}\n\nstatic const struct snd_kcontrol_new jack_detect_kctl = {\n\t \n\t.iface = SNDRV_CTL_ELEM_IFACE_CARD,\n\t.access = SNDRV_CTL_ELEM_ACCESS_READ,\n\t.info = jack_detect_kctl_info,\n\t.get = jack_detect_kctl_get,\n};\n\nstatic int get_available_index(struct snd_card *card, const char *name)\n{\n\tstruct snd_ctl_elem_id sid;\n\n\tmemset(&sid, 0, sizeof(sid));\n\n\tsid.index = 0;\n\tsid.iface = SNDRV_CTL_ELEM_IFACE_CARD;\n\tstrscpy(sid.name, name, sizeof(sid.name));\n\n\twhile (snd_ctl_find_id(card, &sid)) {\n\t\tsid.index++;\n\t\t \n\t\tsid.numid = 0;\n\t}\n\n\treturn sid.index;\n}\n\nstatic void jack_kctl_name_gen(char *name, const char *src_name, int size)\n{\n\tsize_t count = strlen(src_name);\n\tbool need_cat = true;\n\n\t \n\tif (count >= 5)\n\t\tneed_cat = strncmp(&src_name[count - 5], \" Jack\", 5) ? true : false;\n\n\tsnprintf(name, size, need_cat ? \"%s Jack\" : \"%s\", src_name);\n\n}\n\nstruct snd_kcontrol *\nsnd_kctl_jack_new(const char *name, struct snd_card *card)\n{\n\tstruct snd_kcontrol *kctl;\n\n\tkctl = snd_ctl_new1(&jack_detect_kctl, NULL);\n\tif (!kctl)\n\t\treturn NULL;\n\n\tjack_kctl_name_gen(kctl->id.name, name, sizeof(kctl->id.name));\n\tkctl->id.index = get_available_index(card, kctl->id.name);\n\tkctl->private_value = 0;\n\treturn kctl;\n}\n\nvoid snd_kctl_jack_report(struct snd_card *card,\n\t\t\t  struct snd_kcontrol *kctl, bool status)\n{\n\tif (kctl->private_value == status)\n\t\treturn;\n\tkctl->private_value = status;\n\tsnd_ctl_notify(card, SNDRV_CTL_EVENT_MASK_VALUE, &kctl->id);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}