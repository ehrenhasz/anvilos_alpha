{
  "module_name": "device.c",
  "hash_id": "52878c9dc736c1962ca7d8d815f1444487a6fc0a7fa28bece7f0c34a320b1c1f",
  "original_prompt": "Ingested from linux-6.6.14/sound/core/device.c",
  "human_readable_source": "\n \n\n#include <linux/slab.h>\n#include <linux/time.h>\n#include <linux/export.h>\n#include <linux/errno.h>\n#include <sound/core.h>\n\n \nint snd_device_new(struct snd_card *card, enum snd_device_type type,\n\t\t   void *device_data, const struct snd_device_ops *ops)\n{\n\tstruct snd_device *dev;\n\tstruct list_head *p;\n\n\tif (snd_BUG_ON(!card || !device_data || !ops))\n\t\treturn -ENXIO;\n\tdev = kzalloc(sizeof(*dev), GFP_KERNEL);\n\tif (!dev)\n\t\treturn -ENOMEM;\n\tINIT_LIST_HEAD(&dev->list);\n\tdev->card = card;\n\tdev->type = type;\n\tdev->state = SNDRV_DEV_BUILD;\n\tdev->device_data = device_data;\n\tdev->ops = ops;\n\n\t \n\tlist_for_each_prev(p, &card->devices) {\n\t\tstruct snd_device *pdev = list_entry(p, struct snd_device, list);\n\t\tif ((unsigned int)pdev->type <= (unsigned int)type)\n\t\t\tbreak;\n\t}\n\n\tlist_add(&dev->list, p);\n\treturn 0;\n}\nEXPORT_SYMBOL(snd_device_new);\n\nstatic void __snd_device_disconnect(struct snd_device *dev)\n{\n\tif (dev->state == SNDRV_DEV_REGISTERED) {\n\t\tif (dev->ops->dev_disconnect &&\n\t\t    dev->ops->dev_disconnect(dev))\n\t\t\tdev_err(dev->card->dev, \"device disconnect failure\\n\");\n\t\tdev->state = SNDRV_DEV_DISCONNECTED;\n\t}\n}\n\nstatic void __snd_device_free(struct snd_device *dev)\n{\n\t \n\tlist_del(&dev->list);\n\n\t__snd_device_disconnect(dev);\n\tif (dev->ops->dev_free) {\n\t\tif (dev->ops->dev_free(dev))\n\t\t\tdev_err(dev->card->dev, \"device free failure\\n\");\n\t}\n\tkfree(dev);\n}\n\nstatic struct snd_device *look_for_dev(struct snd_card *card, void *device_data)\n{\n\tstruct snd_device *dev;\n\n\tlist_for_each_entry(dev, &card->devices, list)\n\t\tif (dev->device_data == device_data)\n\t\t\treturn dev;\n\n\treturn NULL;\n}\n\n \nvoid snd_device_disconnect(struct snd_card *card, void *device_data)\n{\n\tstruct snd_device *dev;\n\n\tif (snd_BUG_ON(!card || !device_data))\n\t\treturn;\n\tdev = look_for_dev(card, device_data);\n\tif (dev)\n\t\t__snd_device_disconnect(dev);\n\telse\n\t\tdev_dbg(card->dev, \"device disconnect %p (from %pS), not found\\n\",\n\t\t\tdevice_data, __builtin_return_address(0));\n}\nEXPORT_SYMBOL_GPL(snd_device_disconnect);\n\n \nvoid snd_device_free(struct snd_card *card, void *device_data)\n{\n\tstruct snd_device *dev;\n\t\n\tif (snd_BUG_ON(!card || !device_data))\n\t\treturn;\n\tdev = look_for_dev(card, device_data);\n\tif (dev)\n\t\t__snd_device_free(dev);\n\telse\n\t\tdev_dbg(card->dev, \"device free %p (from %pS), not found\\n\",\n\t\t\tdevice_data, __builtin_return_address(0));\n}\nEXPORT_SYMBOL(snd_device_free);\n\nstatic int __snd_device_register(struct snd_device *dev)\n{\n\tif (dev->state == SNDRV_DEV_BUILD) {\n\t\tif (dev->ops->dev_register) {\n\t\t\tint err = dev->ops->dev_register(dev);\n\t\t\tif (err < 0)\n\t\t\t\treturn err;\n\t\t}\n\t\tdev->state = SNDRV_DEV_REGISTERED;\n\t}\n\treturn 0;\n}\n\n \nint snd_device_register(struct snd_card *card, void *device_data)\n{\n\tstruct snd_device *dev;\n\n\tif (snd_BUG_ON(!card || !device_data))\n\t\treturn -ENXIO;\n\tdev = look_for_dev(card, device_data);\n\tif (dev)\n\t\treturn __snd_device_register(dev);\n\tsnd_BUG();\n\treturn -ENXIO;\n}\nEXPORT_SYMBOL(snd_device_register);\n\n \nint snd_device_register_all(struct snd_card *card)\n{\n\tstruct snd_device *dev;\n\tint err;\n\t\n\tif (snd_BUG_ON(!card))\n\t\treturn -ENXIO;\n\tlist_for_each_entry(dev, &card->devices, list) {\n\t\terr = __snd_device_register(dev);\n\t\tif (err < 0)\n\t\t\treturn err;\n\t}\n\treturn 0;\n}\n\n \nvoid snd_device_disconnect_all(struct snd_card *card)\n{\n\tstruct snd_device *dev;\n\n\tif (snd_BUG_ON(!card))\n\t\treturn;\n\tlist_for_each_entry_reverse(dev, &card->devices, list)\n\t\t__snd_device_disconnect(dev);\n}\n\n \nvoid snd_device_free_all(struct snd_card *card)\n{\n\tstruct snd_device *dev, *next;\n\n\tif (snd_BUG_ON(!card))\n\t\treturn;\n\tlist_for_each_entry_safe_reverse(dev, next, &card->devices, list) {\n\t\t \n\t\tif (dev->type == SNDRV_DEV_CONTROL ||\n\t\t    dev->type == SNDRV_DEV_LOWLEVEL)\n\t\t\tcontinue;\n\t\t__snd_device_free(dev);\n\t}\n\n\t \n\tlist_for_each_entry_safe_reverse(dev, next, &card->devices, list)\n\t\t__snd_device_free(dev);\n}\n\n \nint snd_device_get_state(struct snd_card *card, void *device_data)\n{\n\tstruct snd_device *dev;\n\n\tdev = look_for_dev(card, device_data);\n\tif (dev)\n\t\treturn dev->state;\n\treturn -1;\n}\nEXPORT_SYMBOL_GPL(snd_device_get_state);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}