{
  "module_name": "seq_oss_ioctl.c",
  "hash_id": "e07202bf8aaa10c9a49d70cd38d23370066f76f2feae4868cba28260c724ae21",
  "original_prompt": "Ingested from linux-6.6.14/sound/core/seq/oss/seq_oss_ioctl.c",
  "human_readable_source": "\n \n\n#include \"seq_oss_device.h\"\n#include \"seq_oss_readq.h\"\n#include \"seq_oss_writeq.h\"\n#include \"seq_oss_timer.h\"\n#include \"seq_oss_synth.h\"\n#include \"seq_oss_midi.h\"\n#include \"seq_oss_event.h\"\n\nstatic int snd_seq_oss_synth_info_user(struct seq_oss_devinfo *dp, void __user *arg)\n{\n\tstruct synth_info info;\n\n\tif (copy_from_user(&info, arg, sizeof(info)))\n\t\treturn -EFAULT;\n\tif (snd_seq_oss_synth_make_info(dp, info.device, &info) < 0)\n\t\treturn -EINVAL;\n\tif (copy_to_user(arg, &info, sizeof(info)))\n\t\treturn -EFAULT;\n\treturn 0;\n}\n\nstatic int snd_seq_oss_midi_info_user(struct seq_oss_devinfo *dp, void __user *arg)\n{\n\tstruct midi_info info;\n\n\tif (copy_from_user(&info, arg, sizeof(info)))\n\t\treturn -EFAULT;\n\tif (snd_seq_oss_midi_make_info(dp, info.device, &info) < 0)\n\t\treturn -EINVAL;\n\tif (copy_to_user(arg, &info, sizeof(info)))\n\t\treturn -EFAULT;\n\treturn 0;\n}\n\nstatic int snd_seq_oss_oob_user(struct seq_oss_devinfo *dp, void __user *arg)\n{\n\tunsigned char ev[8];\n\tstruct snd_seq_event tmpev;\n\n\tif (copy_from_user(ev, arg, 8))\n\t\treturn -EFAULT;\n\tmemset(&tmpev, 0, sizeof(tmpev));\n\tsnd_seq_oss_fill_addr(dp, &tmpev, dp->addr.client, dp->addr.port);\n\ttmpev.time.tick = 0;\n\tif (! snd_seq_oss_process_event(dp, (union evrec *)ev, &tmpev)) {\n\t\tsnd_seq_oss_dispatch(dp, &tmpev, 0, 0);\n\t}\n\treturn 0;\n}\n\nint\nsnd_seq_oss_ioctl(struct seq_oss_devinfo *dp, unsigned int cmd, unsigned long carg)\n{\n\tint dev, val;\n\tvoid __user *arg = (void __user *)carg;\n\tint __user *p = arg;\n\n\tswitch (cmd) {\n\tcase SNDCTL_TMR_TIMEBASE:\n\tcase SNDCTL_TMR_TEMPO:\n\tcase SNDCTL_TMR_START:\n\tcase SNDCTL_TMR_STOP:\n\tcase SNDCTL_TMR_CONTINUE:\n\tcase SNDCTL_TMR_METRONOME:\n\tcase SNDCTL_TMR_SOURCE:\n\tcase SNDCTL_TMR_SELECT:\n\tcase SNDCTL_SEQ_CTRLRATE:\n\t\treturn snd_seq_oss_timer_ioctl(dp->timer, cmd, arg);\n\n\tcase SNDCTL_SEQ_PANIC:\n\t\tsnd_seq_oss_reset(dp);\n\t\treturn -EINVAL;\n\n\tcase SNDCTL_SEQ_SYNC:\n\t\tif (! is_write_mode(dp->file_mode) || dp->writeq == NULL)\n\t\t\treturn 0;\n\t\twhile (snd_seq_oss_writeq_sync(dp->writeq))\n\t\t\t;\n\t\tif (signal_pending(current))\n\t\t\treturn -ERESTARTSYS;\n\t\treturn 0;\n\n\tcase SNDCTL_SEQ_RESET:\n\t\tsnd_seq_oss_reset(dp);\n\t\treturn 0;\n\n\tcase SNDCTL_SEQ_TESTMIDI:\n\t\tif (get_user(dev, p))\n\t\t\treturn -EFAULT;\n\t\treturn snd_seq_oss_midi_open(dp, dev, dp->file_mode);\n\n\tcase SNDCTL_SEQ_GETINCOUNT:\n\t\tif (dp->readq == NULL || ! is_read_mode(dp->file_mode))\n\t\t\treturn 0;\n\t\treturn put_user(dp->readq->qlen, p) ? -EFAULT : 0;\n\n\tcase SNDCTL_SEQ_GETOUTCOUNT:\n\t\tif (! is_write_mode(dp->file_mode) || dp->writeq == NULL)\n\t\t\treturn 0;\n\t\treturn put_user(snd_seq_oss_writeq_get_free_size(dp->writeq), p) ? -EFAULT : 0;\n\n\tcase SNDCTL_SEQ_GETTIME:\n\t\treturn put_user(snd_seq_oss_timer_cur_tick(dp->timer), p) ? -EFAULT : 0;\n\n\tcase SNDCTL_SEQ_RESETSAMPLES:\n\t\tif (get_user(dev, p))\n\t\t\treturn -EFAULT;\n\t\treturn snd_seq_oss_synth_ioctl(dp, dev, cmd, carg);\n\n\tcase SNDCTL_SEQ_NRSYNTHS:\n\t\treturn put_user(dp->max_synthdev, p) ? -EFAULT : 0;\n\n\tcase SNDCTL_SEQ_NRMIDIS:\n\t\treturn put_user(dp->max_mididev, p) ? -EFAULT : 0;\n\n\tcase SNDCTL_SYNTH_MEMAVL:\n\t\tif (get_user(dev, p))\n\t\t\treturn -EFAULT;\n\t\tval = snd_seq_oss_synth_ioctl(dp, dev, cmd, carg);\n\t\treturn put_user(val, p) ? -EFAULT : 0;\n\n\tcase SNDCTL_FM_4OP_ENABLE:\n\t\tif (get_user(dev, p))\n\t\t\treturn -EFAULT;\n\t\tsnd_seq_oss_synth_ioctl(dp, dev, cmd, carg);\n\t\treturn 0;\n\n\tcase SNDCTL_SYNTH_INFO:\n\tcase SNDCTL_SYNTH_ID:\n\t\treturn snd_seq_oss_synth_info_user(dp, arg);\n\n\tcase SNDCTL_SEQ_OUTOFBAND:\n\t\treturn snd_seq_oss_oob_user(dp, arg);\n\n\tcase SNDCTL_MIDI_INFO:\n\t\treturn snd_seq_oss_midi_info_user(dp, arg);\n\n\tcase SNDCTL_SEQ_THRESHOLD:\n\t\tif (! is_write_mode(dp->file_mode))\n\t\t\treturn 0;\n\t\tif (get_user(val, p))\n\t\t\treturn -EFAULT;\n\t\tif (val < 1)\n\t\t\tval = 1;\n\t\tif (val >= dp->writeq->maxlen)\n\t\t\tval = dp->writeq->maxlen - 1;\n\t\tsnd_seq_oss_writeq_set_output(dp->writeq, val);\n\t\treturn 0;\n\n\tcase SNDCTL_MIDI_PRETIME:\n\t\tif (dp->readq == NULL || !is_read_mode(dp->file_mode))\n\t\t\treturn 0;\n\t\tif (get_user(val, p))\n\t\t\treturn -EFAULT;\n\t\tif (val <= 0)\n\t\t\tval = -1;\n\t\telse\n\t\t\tval = (HZ * val) / 10;\n\t\tdp->readq->pre_event_timeout = val;\n\t\treturn put_user(val, p) ? -EFAULT : 0;\n\n\tdefault:\n\t\tif (! is_write_mode(dp->file_mode))\n\t\t\treturn -EIO;\n\t\treturn snd_seq_oss_synth_ioctl(dp, 0, cmd, carg);\n\t}\n\treturn 0;\n}\n\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}