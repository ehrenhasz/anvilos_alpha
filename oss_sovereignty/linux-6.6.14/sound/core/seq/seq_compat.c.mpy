{
  "module_name": "seq_compat.c",
  "hash_id": "d66e4ab6385e53dfbc7c0b3e697a7160d04651c2dd00c3f2be915a95ec379e5f",
  "original_prompt": "Ingested from linux-6.6.14/sound/core/seq/seq_compat.c",
  "human_readable_source": "\n \n\n \n\n#include <linux/compat.h>\n#include <linux/slab.h>\n\nstruct snd_seq_port_info32 {\n\tstruct snd_seq_addr addr;\t \n\tchar name[64];\t\t\t \n\n\tu32 capability;\t \n\tu32 type;\t\t \n\ts32 midi_channels;\t\t \n\ts32 midi_voices;\t\t \n\ts32 synth_voices;\t\t \n\n\ts32 read_use;\t\t\t \n\ts32 write_use;\t\t\t \n\n\tu32 kernel;\t\t\t \n\tu32 flags;\t\t \n\tunsigned char time_queue;\t \n\tchar reserved[59];\t\t \n};\n\nstatic int snd_seq_call_port_info_ioctl(struct snd_seq_client *client, unsigned int cmd,\n\t\t\t\t\tstruct snd_seq_port_info32 __user *data32)\n{\n\tint err = -EFAULT;\n\tstruct snd_seq_port_info *data;\n\n\tdata = kmalloc(sizeof(*data), GFP_KERNEL);\n\tif (!data)\n\t\treturn -ENOMEM;\n\n\tif (copy_from_user(data, data32, sizeof(*data32)) ||\n\t    get_user(data->flags, &data32->flags) ||\n\t    get_user(data->time_queue, &data32->time_queue))\n\t\tgoto error;\n\tdata->kernel = NULL;\n\n\terr = snd_seq_kernel_client_ctl(client->number, cmd, data);\n\tif (err < 0)\n\t\tgoto error;\n\n\tif (copy_to_user(data32, data, sizeof(*data32)) ||\n\t    put_user(data->flags, &data32->flags) ||\n\t    put_user(data->time_queue, &data32->time_queue))\n\t\terr = -EFAULT;\n\n error:\n\tkfree(data);\n\treturn err;\n}\n\n\n\n \n\nenum {\n\tSNDRV_SEQ_IOCTL_CREATE_PORT32 = _IOWR('S', 0x20, struct snd_seq_port_info32),\n\tSNDRV_SEQ_IOCTL_DELETE_PORT32 = _IOW ('S', 0x21, struct snd_seq_port_info32),\n\tSNDRV_SEQ_IOCTL_GET_PORT_INFO32 = _IOWR('S', 0x22, struct snd_seq_port_info32),\n\tSNDRV_SEQ_IOCTL_SET_PORT_INFO32 = _IOW ('S', 0x23, struct snd_seq_port_info32),\n\tSNDRV_SEQ_IOCTL_QUERY_NEXT_PORT32 = _IOWR('S', 0x52, struct snd_seq_port_info32),\n};\n\nstatic long snd_seq_ioctl_compat(struct file *file, unsigned int cmd, unsigned long arg)\n{\n\tstruct snd_seq_client *client = file->private_data;\n\tvoid __user *argp = compat_ptr(arg);\n\n\tif (snd_BUG_ON(!client))\n\t\treturn -ENXIO;\n\n\tswitch (cmd) {\n\tcase SNDRV_SEQ_IOCTL_PVERSION:\n\tcase SNDRV_SEQ_IOCTL_USER_PVERSION:\n\tcase SNDRV_SEQ_IOCTL_CLIENT_ID:\n\tcase SNDRV_SEQ_IOCTL_SYSTEM_INFO:\n\tcase SNDRV_SEQ_IOCTL_GET_CLIENT_INFO:\n\tcase SNDRV_SEQ_IOCTL_SET_CLIENT_INFO:\n\tcase SNDRV_SEQ_IOCTL_GET_CLIENT_UMP_INFO:\n\tcase SNDRV_SEQ_IOCTL_SET_CLIENT_UMP_INFO:\n\tcase SNDRV_SEQ_IOCTL_SUBSCRIBE_PORT:\n\tcase SNDRV_SEQ_IOCTL_UNSUBSCRIBE_PORT:\n\tcase SNDRV_SEQ_IOCTL_CREATE_QUEUE:\n\tcase SNDRV_SEQ_IOCTL_DELETE_QUEUE:\n\tcase SNDRV_SEQ_IOCTL_GET_QUEUE_INFO:\n\tcase SNDRV_SEQ_IOCTL_SET_QUEUE_INFO:\n\tcase SNDRV_SEQ_IOCTL_GET_NAMED_QUEUE:\n\tcase SNDRV_SEQ_IOCTL_GET_QUEUE_STATUS:\n\tcase SNDRV_SEQ_IOCTL_GET_QUEUE_TEMPO:\n\tcase SNDRV_SEQ_IOCTL_SET_QUEUE_TEMPO:\n\tcase SNDRV_SEQ_IOCTL_GET_QUEUE_TIMER:\n\tcase SNDRV_SEQ_IOCTL_SET_QUEUE_TIMER:\n\tcase SNDRV_SEQ_IOCTL_GET_QUEUE_CLIENT:\n\tcase SNDRV_SEQ_IOCTL_SET_QUEUE_CLIENT:\n\tcase SNDRV_SEQ_IOCTL_GET_CLIENT_POOL:\n\tcase SNDRV_SEQ_IOCTL_SET_CLIENT_POOL:\n\tcase SNDRV_SEQ_IOCTL_REMOVE_EVENTS:\n\tcase SNDRV_SEQ_IOCTL_QUERY_SUBS:\n\tcase SNDRV_SEQ_IOCTL_GET_SUBSCRIPTION:\n\tcase SNDRV_SEQ_IOCTL_QUERY_NEXT_CLIENT:\n\tcase SNDRV_SEQ_IOCTL_RUNNING_MODE:\n\t\treturn snd_seq_ioctl(file, cmd, arg);\n\tcase SNDRV_SEQ_IOCTL_CREATE_PORT32:\n\t\treturn snd_seq_call_port_info_ioctl(client, SNDRV_SEQ_IOCTL_CREATE_PORT, argp);\n\tcase SNDRV_SEQ_IOCTL_DELETE_PORT32:\n\t\treturn snd_seq_call_port_info_ioctl(client, SNDRV_SEQ_IOCTL_DELETE_PORT, argp);\n\tcase SNDRV_SEQ_IOCTL_GET_PORT_INFO32:\n\t\treturn snd_seq_call_port_info_ioctl(client, SNDRV_SEQ_IOCTL_GET_PORT_INFO, argp);\n\tcase SNDRV_SEQ_IOCTL_SET_PORT_INFO32:\n\t\treturn snd_seq_call_port_info_ioctl(client, SNDRV_SEQ_IOCTL_SET_PORT_INFO, argp);\n\tcase SNDRV_SEQ_IOCTL_QUERY_NEXT_PORT32:\n\t\treturn snd_seq_call_port_info_ioctl(client, SNDRV_SEQ_IOCTL_QUERY_NEXT_PORT, argp);\n\t}\n\treturn -ENOIOCTLCMD;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}