{
  "module_name": "route.c",
  "hash_id": "2c1c040382d9132445d9fd79bf07347c414aa68e4bf3e33bc08c7bd866d8b520",
  "original_prompt": "Ingested from linux-6.6.14/sound/core/oss/route.c",
  "human_readable_source": " \n\n#include <linux/time.h>\n#include <sound/core.h>\n#include <sound/pcm.h>\n#include \"pcm_plugin.h\"\n\nstatic void zero_areas(struct snd_pcm_plugin_channel *dvp, int ndsts,\n\t\t       snd_pcm_uframes_t frames, snd_pcm_format_t format)\n{\n\tint dst = 0;\n\tfor (; dst < ndsts; ++dst) {\n\t\tif (dvp->wanted)\n\t\t\tsnd_pcm_area_silence(&dvp->area, 0, frames, format);\n\t\tdvp->enabled = 0;\n\t\tdvp++;\n\t}\n}\n\nstatic inline void copy_area(const struct snd_pcm_plugin_channel *src_channel,\n\t\t\t     struct snd_pcm_plugin_channel *dst_channel,\n\t\t\t     snd_pcm_uframes_t frames, snd_pcm_format_t format)\n{\n\tdst_channel->enabled = 1;\n\tsnd_pcm_area_copy(&src_channel->area, 0, &dst_channel->area, 0, frames, format);\n}\n\nstatic snd_pcm_sframes_t route_transfer(struct snd_pcm_plugin *plugin,\n\t\t\t\t\tconst struct snd_pcm_plugin_channel *src_channels,\n\t\t\t\t\tstruct snd_pcm_plugin_channel *dst_channels,\n\t\t\t\t\tsnd_pcm_uframes_t frames)\n{\n\tint nsrcs, ndsts, dst;\n\tstruct snd_pcm_plugin_channel *dvp;\n\tsnd_pcm_format_t format;\n\n\tif (snd_BUG_ON(!plugin || !src_channels || !dst_channels))\n\t\treturn -ENXIO;\n\tif (frames == 0)\n\t\treturn 0;\n\tif (frames > dst_channels[0].frames)\n\t\tframes = dst_channels[0].frames;\n\n\tnsrcs = plugin->src_format.channels;\n\tndsts = plugin->dst_format.channels;\n\n\tformat = plugin->dst_format.format;\n\tdvp = dst_channels;\n\tif (nsrcs <= 1) {\n\t\t \n\t\tfor (dst = 0; dst < ndsts; ++dst) {\n\t\t\tcopy_area(src_channels, dvp, frames, format);\n\t\t\tdvp++;\n\t\t}\n\t\treturn frames;\n\t}\n\n\tfor (dst = 0; dst < ndsts && dst < nsrcs; ++dst) {\n\t\tcopy_area(src_channels, dvp, frames, format);\n\t\tdvp++;\n\t\tsrc_channels++;\n\t}\n\tif (dst < ndsts)\n\t\tzero_areas(dvp, ndsts - dst, frames, format);\n\treturn frames;\n}\n\nint snd_pcm_plugin_build_route(struct snd_pcm_substream *plug,\n\t\t\t       struct snd_pcm_plugin_format *src_format,\n\t\t\t       struct snd_pcm_plugin_format *dst_format,\n\t\t\t       struct snd_pcm_plugin **r_plugin)\n{\n\tstruct snd_pcm_plugin *plugin;\n\tint err;\n\n\tif (snd_BUG_ON(!r_plugin))\n\t\treturn -ENXIO;\n\t*r_plugin = NULL;\n\tif (snd_BUG_ON(src_format->rate != dst_format->rate))\n\t\treturn -ENXIO;\n\tif (snd_BUG_ON(src_format->format != dst_format->format))\n\t\treturn -ENXIO;\n\n\terr = snd_pcm_plugin_build(plug, \"route conversion\",\n\t\t\t\t   src_format, dst_format, 0, &plugin);\n\tif (err < 0)\n\t\treturn err;\n\n\tplugin->transfer = route_transfer;\n\t*r_plugin = plugin;\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}