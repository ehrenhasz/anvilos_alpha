{
  "module_name": "io.c",
  "hash_id": "7db2db1e9559be14d7c60361eaa6dfc26f9faf66292a63b79464d7feccde5cf6",
  "original_prompt": "Ingested from linux-6.6.14/sound/core/oss/io.c",
  "human_readable_source": " \n  \n#include <linux/time.h>\n#include <sound/core.h>\n#include <sound/pcm.h>\n#include <sound/pcm_params.h>\n#include \"pcm_plugin.h\"\n\n#define pcm_write(plug,buf,count) snd_pcm_oss_write3(plug,buf,count,1)\n#define pcm_writev(plug,vec,count) snd_pcm_oss_writev3(plug,vec,count)\n#define pcm_read(plug,buf,count) snd_pcm_oss_read3(plug,buf,count,1)\n#define pcm_readv(plug,vec,count) snd_pcm_oss_readv3(plug,vec,count)\n\n \n \nstatic snd_pcm_sframes_t io_playback_transfer(struct snd_pcm_plugin *plugin,\n\t\t\t\t    const struct snd_pcm_plugin_channel *src_channels,\n\t\t\t\t    struct snd_pcm_plugin_channel *dst_channels,\n\t\t\t\t    snd_pcm_uframes_t frames)\n{\n\tif (snd_BUG_ON(!plugin))\n\t\treturn -ENXIO;\n\tif (snd_BUG_ON(!src_channels))\n\t\treturn -ENXIO;\n\tif (plugin->access == SNDRV_PCM_ACCESS_RW_INTERLEAVED) {\n\t\treturn pcm_write(plugin->plug, src_channels->area.addr, frames);\n\t} else {\n\t\tint channel, channels = plugin->dst_format.channels;\n\t\tvoid **bufs = (void**)plugin->extra_data;\n\t\tif (snd_BUG_ON(!bufs))\n\t\t\treturn -ENXIO;\n\t\tfor (channel = 0; channel < channels; channel++) {\n\t\t\tif (src_channels[channel].enabled)\n\t\t\t\tbufs[channel] = src_channels[channel].area.addr;\n\t\t\telse\n\t\t\t\tbufs[channel] = NULL;\n\t\t}\n\t\treturn pcm_writev(plugin->plug, bufs, frames);\n\t}\n}\n \nstatic snd_pcm_sframes_t io_capture_transfer(struct snd_pcm_plugin *plugin,\n\t\t\t\t   const struct snd_pcm_plugin_channel *src_channels,\n\t\t\t\t   struct snd_pcm_plugin_channel *dst_channels,\n\t\t\t\t   snd_pcm_uframes_t frames)\n{\n\tif (snd_BUG_ON(!plugin))\n\t\treturn -ENXIO;\n\tif (snd_BUG_ON(!dst_channels))\n\t\treturn -ENXIO;\n\tif (plugin->access == SNDRV_PCM_ACCESS_RW_INTERLEAVED) {\n\t\treturn pcm_read(plugin->plug, dst_channels->area.addr, frames);\n\t} else {\n\t\tint channel, channels = plugin->dst_format.channels;\n\t\tvoid **bufs = (void**)plugin->extra_data;\n\t\tif (snd_BUG_ON(!bufs))\n\t\t\treturn -ENXIO;\n\t\tfor (channel = 0; channel < channels; channel++) {\n\t\t\tif (dst_channels[channel].enabled)\n\t\t\t\tbufs[channel] = dst_channels[channel].area.addr;\n\t\t\telse\n\t\t\t\tbufs[channel] = NULL;\n\t\t}\n\t\treturn pcm_readv(plugin->plug, bufs, frames);\n\t}\n\treturn 0;\n}\n \nstatic snd_pcm_sframes_t io_src_channels(struct snd_pcm_plugin *plugin,\n\t\t\t     snd_pcm_uframes_t frames,\n\t\t\t     struct snd_pcm_plugin_channel **channels)\n{\n\tint err;\n\tunsigned int channel;\n\tstruct snd_pcm_plugin_channel *v;\n\terr = snd_pcm_plugin_client_channels(plugin, frames, &v);\n\tif (err < 0)\n\t\treturn err;\n\t*channels = v;\n\tif (plugin->access == SNDRV_PCM_ACCESS_RW_INTERLEAVED) {\n\t\tfor (channel = 0; channel < plugin->src_format.channels; ++channel, ++v)\n\t\t\tv->wanted = 1;\n\t}\n\treturn frames;\n}\n\nint snd_pcm_plugin_build_io(struct snd_pcm_substream *plug,\n\t\t\t    struct snd_pcm_hw_params *params,\n\t\t\t    struct snd_pcm_plugin **r_plugin)\n{\n\tint err;\n\tstruct snd_pcm_plugin_format format;\n\tstruct snd_pcm_plugin *plugin;\n\n\tif (snd_BUG_ON(!r_plugin))\n\t\treturn -ENXIO;\n\t*r_plugin = NULL;\n\tif (snd_BUG_ON(!plug || !params))\n\t\treturn -ENXIO;\n\tformat.format = params_format(params);\n\tformat.rate = params_rate(params);\n\tformat.channels = params_channels(params);\n\terr = snd_pcm_plugin_build(plug, \"I/O io\",\n\t\t\t\t   &format, &format,\n\t\t\t\t   sizeof(void *) * format.channels,\n\t\t\t\t   &plugin);\n\tif (err < 0)\n\t\treturn err;\n\tplugin->access = params_access(params);\n\tif (snd_pcm_plug_stream(plug) == SNDRV_PCM_STREAM_PLAYBACK) {\n\t\tplugin->transfer = io_playback_transfer;\n\t\tif (plugin->access == SNDRV_PCM_ACCESS_RW_INTERLEAVED)\n\t\t\tplugin->client_channels = io_src_channels;\n\t} else {\n\t\tplugin->transfer = io_capture_transfer;\n\t}\n\n\t*r_plugin = plugin;\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}