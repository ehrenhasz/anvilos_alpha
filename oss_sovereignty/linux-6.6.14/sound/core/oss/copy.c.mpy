{
  "module_name": "copy.c",
  "hash_id": "78ae2da4986726bee0769ac285d98a5ce0e729bec4f829e82d9f2afb7ed2547b",
  "original_prompt": "Ingested from linux-6.6.14/sound/core/oss/copy.c",
  "human_readable_source": " \n\n#include <linux/time.h>\n#include <sound/core.h>\n#include <sound/pcm.h>\n#include \"pcm_plugin.h\"\n\nstatic snd_pcm_sframes_t copy_transfer(struct snd_pcm_plugin *plugin,\n\t\t\t     const struct snd_pcm_plugin_channel *src_channels,\n\t\t\t     struct snd_pcm_plugin_channel *dst_channels,\n\t\t\t     snd_pcm_uframes_t frames)\n{\n\tunsigned int channel;\n\tunsigned int nchannels;\n\n\tif (snd_BUG_ON(!plugin || !src_channels || !dst_channels))\n\t\treturn -ENXIO;\n\tif (frames == 0)\n\t\treturn 0;\n\tnchannels = plugin->src_format.channels;\n\tfor (channel = 0; channel < nchannels; channel++) {\n\t\tif (snd_BUG_ON(src_channels->area.first % 8 ||\n\t\t\t       src_channels->area.step % 8))\n\t\t\treturn -ENXIO;\n\t\tif (snd_BUG_ON(dst_channels->area.first % 8 ||\n\t\t\t       dst_channels->area.step % 8))\n\t\t\treturn -ENXIO;\n\t\tif (!src_channels->enabled) {\n\t\t\tif (dst_channels->wanted)\n\t\t\t\tsnd_pcm_area_silence(&dst_channels->area, 0, frames, plugin->dst_format.format);\n\t\t\tdst_channels->enabled = 0;\n\t\t\tcontinue;\n\t\t}\n\t\tdst_channels->enabled = 1;\n\t\tsnd_pcm_area_copy(&src_channels->area, 0, &dst_channels->area, 0, frames, plugin->src_format.format);\n\t\tsrc_channels++;\n\t\tdst_channels++;\n\t}\n\treturn frames;\n}\n\nint snd_pcm_plugin_build_copy(struct snd_pcm_substream *plug,\n\t\t\t      struct snd_pcm_plugin_format *src_format,\n\t\t\t      struct snd_pcm_plugin_format *dst_format,\n\t\t\t      struct snd_pcm_plugin **r_plugin)\n{\n\tint err;\n\tstruct snd_pcm_plugin *plugin;\n\tint width;\n\n\tif (snd_BUG_ON(!r_plugin))\n\t\treturn -ENXIO;\n\t*r_plugin = NULL;\n\n\tif (snd_BUG_ON(src_format->format != dst_format->format))\n\t\treturn -ENXIO;\n\tif (snd_BUG_ON(src_format->rate != dst_format->rate))\n\t\treturn -ENXIO;\n\tif (snd_BUG_ON(src_format->channels != dst_format->channels))\n\t\treturn -ENXIO;\n\n\twidth = snd_pcm_format_physical_width(src_format->format);\n\tif (snd_BUG_ON(width <= 0))\n\t\treturn -ENXIO;\n\n\terr = snd_pcm_plugin_build(plug, \"copy\", src_format, dst_format,\n\t\t\t\t   0, &plugin);\n\tif (err < 0)\n\t\treturn err;\n\tplugin->transfer = copy_transfer;\n\t*r_plugin = plugin;\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}