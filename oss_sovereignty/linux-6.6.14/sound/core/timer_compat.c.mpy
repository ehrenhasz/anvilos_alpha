{
  "module_name": "timer_compat.c",
  "hash_id": "6905e41dc231f130fdf68c92d2a6b0bcfb6191881508732f3177e88c17c4c8d7",
  "original_prompt": "Ingested from linux-6.6.14/sound/core/timer_compat.c",
  "human_readable_source": "\n \n\n \n\n#include <linux/compat.h>\n\n \nstruct snd_timer_gparams32 {\n\tstruct snd_timer_id tid;\n\tu32 period_num;\n\tu32 period_den;\n\tunsigned char reserved[32];\n} __packed;\n\nstruct snd_timer_info32 {\n\tu32 flags;\n\ts32 card;\n\tunsigned char id[64];\n\tunsigned char name[80];\n\tu32 reserved0;\n\tu32 resolution;\n\tunsigned char reserved[64];\n};\n\nstatic int snd_timer_user_gparams_compat(struct file *file,\n\t\t\t\t\tstruct snd_timer_gparams32 __user *user)\n{\n\tstruct snd_timer_gparams gparams;\n\n\tif (copy_from_user(&gparams.tid, &user->tid, sizeof(gparams.tid)) ||\n\t    get_user(gparams.period_num, &user->period_num) ||\n\t    get_user(gparams.period_den, &user->period_den))\n\t\treturn -EFAULT;\n\n\treturn timer_set_gparams(&gparams);\n}\n\nstatic int snd_timer_user_info_compat(struct file *file,\n\t\t\t\t      struct snd_timer_info32 __user *_info)\n{\n\tstruct snd_timer_user *tu;\n\tstruct snd_timer_info32 info;\n\tstruct snd_timer *t;\n\n\ttu = file->private_data;\n\tif (!tu->timeri)\n\t\treturn -EBADFD;\n\tt = tu->timeri->timer;\n\tif (!t)\n\t\treturn -EBADFD;\n\tmemset(&info, 0, sizeof(info));\n\tinfo.card = t->card ? t->card->number : -1;\n\tif (t->hw.flags & SNDRV_TIMER_HW_SLAVE)\n\t\tinfo.flags |= SNDRV_TIMER_FLG_SLAVE;\n\tstrscpy(info.id, t->id, sizeof(info.id));\n\tstrscpy(info.name, t->name, sizeof(info.name));\n\tinfo.resolution = t->hw.resolution;\n\tif (copy_to_user(_info, &info, sizeof(*_info)))\n\t\treturn -EFAULT;\n\treturn 0;\n}\n\nenum {\n\tSNDRV_TIMER_IOCTL_GPARAMS32 = _IOW('T', 0x04, struct snd_timer_gparams32),\n\tSNDRV_TIMER_IOCTL_INFO32 = _IOR('T', 0x11, struct snd_timer_info32),\n\tSNDRV_TIMER_IOCTL_STATUS_COMPAT32 = _IOW('T', 0x14, struct snd_timer_status32),\n\tSNDRV_TIMER_IOCTL_STATUS_COMPAT64 = _IOW('T', 0x14, struct snd_timer_status64),\n};\n\nstatic long __snd_timer_user_ioctl_compat(struct file *file, unsigned int cmd,\n\t\t\t\t\t  unsigned long arg)\n{\n\tvoid __user *argp = compat_ptr(arg);\n\n\tswitch (cmd) {\n\tcase SNDRV_TIMER_IOCTL_PVERSION:\n\tcase SNDRV_TIMER_IOCTL_TREAD_OLD:\n\tcase SNDRV_TIMER_IOCTL_TREAD64:\n\tcase SNDRV_TIMER_IOCTL_GINFO:\n\tcase SNDRV_TIMER_IOCTL_GSTATUS:\n\tcase SNDRV_TIMER_IOCTL_SELECT:\n\tcase SNDRV_TIMER_IOCTL_PARAMS:\n\tcase SNDRV_TIMER_IOCTL_START:\n\tcase SNDRV_TIMER_IOCTL_START_OLD:\n\tcase SNDRV_TIMER_IOCTL_STOP:\n\tcase SNDRV_TIMER_IOCTL_STOP_OLD:\n\tcase SNDRV_TIMER_IOCTL_CONTINUE:\n\tcase SNDRV_TIMER_IOCTL_CONTINUE_OLD:\n\tcase SNDRV_TIMER_IOCTL_PAUSE:\n\tcase SNDRV_TIMER_IOCTL_PAUSE_OLD:\n\tcase SNDRV_TIMER_IOCTL_NEXT_DEVICE:\n\t\treturn __snd_timer_user_ioctl(file, cmd, (unsigned long)argp, true);\n\tcase SNDRV_TIMER_IOCTL_GPARAMS32:\n\t\treturn snd_timer_user_gparams_compat(file, argp);\n\tcase SNDRV_TIMER_IOCTL_INFO32:\n\t\treturn snd_timer_user_info_compat(file, argp);\n\tcase SNDRV_TIMER_IOCTL_STATUS_COMPAT32:\n\t\treturn snd_timer_user_status32(file, argp);\n\tcase SNDRV_TIMER_IOCTL_STATUS_COMPAT64:\n\t\treturn snd_timer_user_status64(file, argp);\n\t}\n\treturn -ENOIOCTLCMD;\n}\n\nstatic long snd_timer_user_ioctl_compat(struct file *file, unsigned int cmd,\n\t\t\t\t\tunsigned long arg)\n{\n\tstruct snd_timer_user *tu = file->private_data;\n\tlong ret;\n\n\tmutex_lock(&tu->ioctl_lock);\n\tret = __snd_timer_user_ioctl_compat(file, cmd, arg);\n\tmutex_unlock(&tu->ioctl_lock);\n\treturn ret;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}