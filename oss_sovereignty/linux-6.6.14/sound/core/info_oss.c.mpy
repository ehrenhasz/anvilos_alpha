{
  "module_name": "info_oss.c",
  "hash_id": "7742672c01ed1b5515ffd4e8cb778bf0bdde41f4e64d7365bd7e5742375ffb8a",
  "original_prompt": "Ingested from linux-6.6.14/sound/core/info_oss.c",
  "human_readable_source": "\n \n\n#include <linux/slab.h>\n#include <linux/time.h>\n#include <linux/string.h>\n#include <linux/export.h>\n#include <sound/core.h>\n#include <sound/minors.h>\n#include <sound/info.h>\n#include <linux/utsname.h>\n#include <linux/mutex.h>\n\n \n\nstatic DEFINE_MUTEX(strings);\nstatic char *snd_sndstat_strings[SNDRV_CARDS][SNDRV_OSS_INFO_DEV_COUNT];\n\nint snd_oss_info_register(int dev, int num, char *string)\n{\n\tchar *x;\n\n\tif (snd_BUG_ON(dev < 0 || dev >= SNDRV_OSS_INFO_DEV_COUNT))\n\t\treturn -ENXIO;\n\tif (snd_BUG_ON(num < 0 || num >= SNDRV_CARDS))\n\t\treturn -ENXIO;\n\tmutex_lock(&strings);\n\tif (string == NULL) {\n\t\tx = snd_sndstat_strings[num][dev];\n\t\tkfree(x);\n\t\tx = NULL;\n\t} else {\n\t\tx = kstrdup(string, GFP_KERNEL);\n\t\tif (x == NULL) {\n\t\t\tmutex_unlock(&strings);\n\t\t\treturn -ENOMEM;\n\t\t}\n\t}\n\tsnd_sndstat_strings[num][dev] = x;\n\tmutex_unlock(&strings);\n\treturn 0;\n}\nEXPORT_SYMBOL(snd_oss_info_register);\n\nstatic int snd_sndstat_show_strings(struct snd_info_buffer *buf, char *id, int dev)\n{\n\tint idx, ok = -1;\n\tchar *str;\n\n\tsnd_iprintf(buf, \"\\n%s:\", id);\n\tmutex_lock(&strings);\n\tfor (idx = 0; idx < SNDRV_CARDS; idx++) {\n\t\tstr = snd_sndstat_strings[idx][dev];\n\t\tif (str) {\n\t\t\tif (ok < 0) {\n\t\t\t\tsnd_iprintf(buf, \"\\n\");\n\t\t\t\tok++;\n\t\t\t}\n\t\t\tsnd_iprintf(buf, \"%i: %s\\n\", idx, str);\n\t\t}\n\t}\n\tmutex_unlock(&strings);\n\tif (ok < 0)\n\t\tsnd_iprintf(buf, \" NOT ENABLED IN CONFIG\\n\");\n\treturn ok;\n}\n\nstatic void snd_sndstat_proc_read(struct snd_info_entry *entry,\n\t\t\t\t  struct snd_info_buffer *buffer)\n{\n\tsnd_iprintf(buffer, \"Sound Driver:3.8.1a-980706 (ALSA emulation code)\\n\");\n\tsnd_iprintf(buffer, \"Kernel: %s %s %s %s %s\\n\",\n\t\t    init_utsname()->sysname,\n\t\t    init_utsname()->nodename,\n\t\t    init_utsname()->release,\n\t\t    init_utsname()->version,\n\t\t    init_utsname()->machine);\n\tsnd_iprintf(buffer, \"Config options: 0\\n\");\n\tsnd_iprintf(buffer, \"\\nInstalled drivers: \\n\");\n\tsnd_iprintf(buffer, \"Type 10: ALSA emulation\\n\");\n\tsnd_iprintf(buffer, \"\\nCard config: \\n\");\n\tsnd_card_info_read_oss(buffer);\n\tsnd_sndstat_show_strings(buffer, \"Audio devices\", SNDRV_OSS_INFO_DEV_AUDIO);\n\tsnd_sndstat_show_strings(buffer, \"Synth devices\", SNDRV_OSS_INFO_DEV_SYNTH);\n\tsnd_sndstat_show_strings(buffer, \"Midi devices\", SNDRV_OSS_INFO_DEV_MIDI);\n\tsnd_sndstat_show_strings(buffer, \"Timers\", SNDRV_OSS_INFO_DEV_TIMERS);\n\tsnd_sndstat_show_strings(buffer, \"Mixers\", SNDRV_OSS_INFO_DEV_MIXERS);\n}\n\nint __init snd_info_minor_register(void)\n{\n\tstruct snd_info_entry *entry;\n\n\tmemset(snd_sndstat_strings, 0, sizeof(snd_sndstat_strings));\n\tentry = snd_info_create_module_entry(THIS_MODULE, \"sndstat\",\n\t\t\t\t\t     snd_oss_root);\n\tif (!entry)\n\t\treturn -ENOMEM;\n\tentry->c.text.read = snd_sndstat_proc_read;\n\treturn snd_info_register(entry);  \n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}