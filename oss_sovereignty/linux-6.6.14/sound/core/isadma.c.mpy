{
  "module_name": "isadma.c",
  "hash_id": "fe870106105d793ba54b3d0a5af07a73c2c39bc8032e7737461fd83d2591625b",
  "original_prompt": "Ingested from linux-6.6.14/sound/core/isadma.c",
  "human_readable_source": "\n \n\n \n\n#undef HAVE_REALLY_SLOW_DMA_CONTROLLER\n\n#include <linux/export.h>\n#include <linux/isa-dma.h>\n#include <sound/core.h>\n\n \nvoid snd_dma_program(unsigned long dma,\n\t\t     unsigned long addr, unsigned int size,\n                     unsigned short mode)\n{\n\tunsigned long flags;\n\n\tflags = claim_dma_lock();\n\tdisable_dma(dma);\n\tclear_dma_ff(dma);\n\tset_dma_mode(dma, mode);\n\tset_dma_addr(dma, addr);\n\tset_dma_count(dma, size);\n\tif (!(mode & DMA_MODE_NO_ENABLE))\n\t\tenable_dma(dma);\n\trelease_dma_lock(flags);\n}\nEXPORT_SYMBOL(snd_dma_program);\n\n \nvoid snd_dma_disable(unsigned long dma)\n{\n\tunsigned long flags;\n\n\tflags = claim_dma_lock();\n\tclear_dma_ff(dma);\n\tdisable_dma(dma);\n\trelease_dma_lock(flags);\n}\nEXPORT_SYMBOL(snd_dma_disable);\n\n \nunsigned int snd_dma_pointer(unsigned long dma, unsigned int size)\n{\n\tunsigned long flags;\n\tunsigned int result, result1;\n\n\tflags = claim_dma_lock();\n\tclear_dma_ff(dma);\n\tif (!isa_dma_bridge_buggy)\n\t\tdisable_dma(dma);\n\tresult = get_dma_residue(dma);\n\t \n\tresult1 = get_dma_residue(dma);\n\tif (!isa_dma_bridge_buggy)\n\t\tenable_dma(dma);\n\trelease_dma_lock(flags);\n\tif (unlikely(result < result1))\n\t\tresult = result1;\n#ifdef CONFIG_SND_DEBUG\n\tif (result > size)\n\t\tpr_err(\"ALSA: pointer (0x%x) for DMA #%ld is greater than transfer size (0x%x)\\n\", result, dma, size);\n#endif\n\tif (result >= size || result == 0)\n\t\treturn 0;\n\telse\n\t\treturn size - result;\n}\nEXPORT_SYMBOL(snd_dma_pointer);\n\nstruct snd_dma_data {\n\tint dma;\n};\n\nstatic void __snd_release_dma(struct device *dev, void *data)\n{\n\tstruct snd_dma_data *p = data;\n\n\tsnd_dma_disable(p->dma);\n\tfree_dma(p->dma);\n}\n\n \nint snd_devm_request_dma(struct device *dev, int dma, const char *name)\n{\n\tstruct snd_dma_data *p;\n\n\tif (request_dma(dma, name))\n\t\treturn -EBUSY;\n\tp = devres_alloc(__snd_release_dma, sizeof(*p), GFP_KERNEL);\n\tif (!p) {\n\t\tfree_dma(dma);\n\t\treturn -ENOMEM;\n\t}\n\tp->dma = dma;\n\tdevres_add(dev, p);\n\treturn 0;\n}\nEXPORT_SYMBOL_GPL(snd_devm_request_dma);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}