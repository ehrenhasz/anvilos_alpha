{
  "module_name": "pcm_iec958.c",
  "hash_id": "4bf62d7d042109c9ffb441680326306978ad4d72bbb88246c052743e30af12bb",
  "original_prompt": "Ingested from linux-6.6.14/sound/core/pcm_iec958.c",
  "human_readable_source": "\n \n#include <linux/export.h>\n#include <linux/types.h>\n#include <sound/asoundef.h>\n#include <sound/pcm.h>\n#include <sound/pcm_params.h>\n#include <sound/pcm_iec958.h>\n\n \nint snd_pcm_create_iec958_consumer_default(u8 *cs, size_t len)\n{\n\tif (len < 4)\n\t\treturn -EINVAL;\n\n\tmemset(cs, 0, len);\n\n\tcs[0] = IEC958_AES0_CON_NOT_COPYRIGHT | IEC958_AES0_CON_EMPHASIS_NONE;\n\tcs[1] = IEC958_AES1_CON_GENERAL;\n\tcs[2] = IEC958_AES2_CON_SOURCE_UNSPEC | IEC958_AES2_CON_CHANNEL_UNSPEC;\n\tcs[3] = IEC958_AES3_CON_CLOCK_1000PPM | IEC958_AES3_CON_FS_NOTID;\n\n\tif (len > 4)\n\t\tcs[4] = IEC958_AES4_CON_WORDLEN_NOTID;\n\n\treturn len;\n}\nEXPORT_SYMBOL_GPL(snd_pcm_create_iec958_consumer_default);\n\nstatic int fill_iec958_consumer(uint rate, uint sample_width,\n\t\t\t\tu8 *cs, size_t len)\n{\n\tif (len < 4)\n\t\treturn -EINVAL;\n\n\tif ((cs[3] & IEC958_AES3_CON_FS) == IEC958_AES3_CON_FS_NOTID) {\n\t\tunsigned int fs;\n\n\t\tswitch (rate) {\n\t\t\tcase 32000:\n\t\t\t\tfs = IEC958_AES3_CON_FS_32000;\n\t\t\t\tbreak;\n\t\t\tcase 44100:\n\t\t\t\tfs = IEC958_AES3_CON_FS_44100;\n\t\t\t\tbreak;\n\t\t\tcase 48000:\n\t\t\t\tfs = IEC958_AES3_CON_FS_48000;\n\t\t\t\tbreak;\n\t\t\tcase 88200:\n\t\t\t\tfs = IEC958_AES3_CON_FS_88200;\n\t\t\t\tbreak;\n\t\t\tcase 96000:\n\t\t\t\tfs = IEC958_AES3_CON_FS_96000;\n\t\t\t\tbreak;\n\t\t\tcase 176400:\n\t\t\t\tfs = IEC958_AES3_CON_FS_176400;\n\t\t\t\tbreak;\n\t\t\tcase 192000:\n\t\t\t\tfs = IEC958_AES3_CON_FS_192000;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\treturn -EINVAL;\n\t\t}\n\n\t\tcs[3] &= ~IEC958_AES3_CON_FS;\n\t\tcs[3] |= fs;\n\t}\n\n\tif (len > 4 &&\n\t    (cs[4] & IEC958_AES4_CON_WORDLEN) == IEC958_AES4_CON_WORDLEN_NOTID) {\n\t\tunsigned int ws;\n\n\t\tswitch (sample_width) {\n\t\tcase 16:\n\t\t\tws = IEC958_AES4_CON_WORDLEN_20_16;\n\t\t\tbreak;\n\t\tcase 18:\n\t\t\tws = IEC958_AES4_CON_WORDLEN_22_18;\n\t\t\tbreak;\n\t\tcase 20:\n\t\t\tws = IEC958_AES4_CON_WORDLEN_20_16 |\n\t\t\t     IEC958_AES4_CON_MAX_WORDLEN_24;\n\t\t\tbreak;\n\t\tcase 24:\n\t\tcase 32:  \n\t\t\tws = IEC958_AES4_CON_WORDLEN_24_20 |\n\t\t\t     IEC958_AES4_CON_MAX_WORDLEN_24;\n\t\t\tbreak;\n\n\t\tdefault:\n\t\t\treturn -EINVAL;\n\t\t}\n\n\t\tcs[4] &= ~IEC958_AES4_CON_WORDLEN;\n\t\tcs[4] |= ws;\n\t}\n\n\treturn len;\n}\n\n \nint snd_pcm_fill_iec958_consumer(struct snd_pcm_runtime *runtime,\n\t\t\t\t u8 *cs, size_t len)\n{\n\treturn fill_iec958_consumer(runtime->rate,\n\t\t\t\t    snd_pcm_format_width(runtime->format),\n\t\t\t\t    cs, len);\n}\nEXPORT_SYMBOL_GPL(snd_pcm_fill_iec958_consumer);\n\n \nint snd_pcm_fill_iec958_consumer_hw_params(struct snd_pcm_hw_params *params,\n\t\t\t\t\t   u8 *cs, size_t len)\n{\n\treturn fill_iec958_consumer(params_rate(params), params_width(params), cs, len);\n}\nEXPORT_SYMBOL_GPL(snd_pcm_fill_iec958_consumer_hw_params);\n\n \nint snd_pcm_create_iec958_consumer(struct snd_pcm_runtime *runtime, u8 *cs,\n\tsize_t len)\n{\n\tint ret;\n\n\tret = snd_pcm_create_iec958_consumer_default(cs, len);\n\tif (ret < 0)\n\t\treturn ret;\n\n\treturn snd_pcm_fill_iec958_consumer(runtime, cs, len);\n}\nEXPORT_SYMBOL(snd_pcm_create_iec958_consumer);\n\n \nint snd_pcm_create_iec958_consumer_hw_params(struct snd_pcm_hw_params *params,\n\t\t\t\t\t     u8 *cs, size_t len)\n{\n\tint ret;\n\n\tret = snd_pcm_create_iec958_consumer_default(cs, len);\n\tif (ret < 0)\n\t\treturn ret;\n\n\treturn fill_iec958_consumer(params_rate(params), params_width(params), cs, len);\n}\nEXPORT_SYMBOL(snd_pcm_create_iec958_consumer_hw_params);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}