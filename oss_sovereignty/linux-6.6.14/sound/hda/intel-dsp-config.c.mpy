{
  "module_name": "intel-dsp-config.c",
  "hash_id": "35a9fe125bc6c809e1a5a53fa8e863e77c9af63eeb8c703ef142fbb72a8d22c2",
  "original_prompt": "Ingested from linux-6.6.14/sound/hda/intel-dsp-config.c",
  "human_readable_source": "\n\n\n#include <linux/acpi.h>\n#include <linux/bits.h>\n#include <linux/dmi.h>\n#include <linux/module.h>\n#include <linux/pci.h>\n#include <linux/soundwire/sdw.h>\n#include <linux/soundwire/sdw_intel.h>\n#include <sound/core.h>\n#include <sound/intel-dsp-config.h>\n#include <sound/intel-nhlt.h>\n#include <sound/soc-acpi.h>\n\nstatic int dsp_driver;\n\nmodule_param(dsp_driver, int, 0444);\nMODULE_PARM_DESC(dsp_driver, \"Force the DSP driver for Intel DSP (0=auto, 1=legacy, 2=SST, 3=SOF)\");\n\n#define FLAG_SST\t\t\tBIT(0)\n#define FLAG_SOF\t\t\tBIT(1)\n#define FLAG_SST_ONLY_IF_DMIC\t\tBIT(15)\n#define FLAG_SOF_ONLY_IF_DMIC\t\tBIT(16)\n#define FLAG_SOF_ONLY_IF_SOUNDWIRE\tBIT(17)\n\n#define FLAG_SOF_ONLY_IF_DMIC_OR_SOUNDWIRE (FLAG_SOF_ONLY_IF_DMIC | \\\n\t\t\t\t\t    FLAG_SOF_ONLY_IF_SOUNDWIRE)\n\nstruct config_entry {\n\tu32 flags;\n\tu16 device;\n\tu8 acpi_hid[ACPI_ID_LEN];\n\tconst struct dmi_system_id *dmi_table;\n\tconst struct snd_soc_acpi_codecs *codec_hid;\n};\n\nstatic const struct snd_soc_acpi_codecs __maybe_unused essx_83x6 = {\n\t.num_codecs = 3,\n\t.codecs = { \"ESSX8316\", \"ESSX8326\", \"ESSX8336\"},\n};\n\n \nstatic const struct config_entry config_table[] = {\n \n#if IS_ENABLED(CONFIG_SND_SOC_SOF_MERRIFIELD)\n\t{\n\t\t.flags = FLAG_SOF,\n\t\t.device = PCI_DEVICE_ID_INTEL_SST_TNG,\n\t},\n#endif\n \n#if IS_ENABLED(CONFIG_SND_SOC_SOF_APOLLOLAKE)\n\t{\n\t\t.flags = FLAG_SOF,\n\t\t.device = PCI_DEVICE_ID_INTEL_HDA_APL,\n\t\t.dmi_table = (const struct dmi_system_id []) {\n\t\t\t{\n\t\t\t\t.ident = \"Up Squared\",\n\t\t\t\t.matches = {\n\t\t\t\t\tDMI_MATCH(DMI_SYS_VENDOR, \"AAEON\"),\n\t\t\t\t\tDMI_MATCH(DMI_BOARD_NAME, \"UP-APL01\"),\n\t\t\t\t}\n\t\t\t},\n\t\t\t{}\n\t\t}\n\t},\n\t{\n\t\t.flags = FLAG_SOF,\n\t\t.device = PCI_DEVICE_ID_INTEL_HDA_APL,\n\t\t.codec_hid =  &essx_83x6,\n\t},\n#endif\n#if IS_ENABLED(CONFIG_SND_SOC_INTEL_APL)\n\t{\n\t\t.flags = FLAG_SST,\n\t\t.device = PCI_DEVICE_ID_INTEL_HDA_APL,\n\t\t.dmi_table = (const struct dmi_system_id []) {\n\t\t\t{\n\t\t\t\t.ident = \"Google Chromebooks\",\n\t\t\t\t.matches = {\n\t\t\t\t\tDMI_MATCH(DMI_SYS_VENDOR, \"Google\"),\n\t\t\t\t}\n\t\t\t},\n\t\t\t{}\n\t\t}\n\t},\n#endif\n \n\n \n#if IS_ENABLED(CONFIG_SND_SOC_INTEL_SKL)\n\t{\n\t\t.flags = FLAG_SST,\n\t\t.device = PCI_DEVICE_ID_INTEL_HDA_SKL_LP,\n\t\t.dmi_table = (const struct dmi_system_id []) {\n\t\t\t{\n\t\t\t\t.ident = \"Google Chromebooks\",\n\t\t\t\t.matches = {\n\t\t\t\t\tDMI_MATCH(DMI_SYS_VENDOR, \"Google\"),\n\t\t\t\t}\n\t\t\t},\n\t\t\t{}\n\t\t}\n\t},\n\t{\n\t\t.flags = FLAG_SST | FLAG_SST_ONLY_IF_DMIC,\n\t\t.device = PCI_DEVICE_ID_INTEL_HDA_SKL_LP,\n\t},\n#endif\n \n#if IS_ENABLED(CONFIG_SND_SOC_INTEL_KBL)\n\t{\n\t\t.flags = FLAG_SST,\n\t\t.device = PCI_DEVICE_ID_INTEL_HDA_KBL_LP,\n\t\t.dmi_table = (const struct dmi_system_id []) {\n\t\t\t{\n\t\t\t\t.ident = \"Google Chromebooks\",\n\t\t\t\t.matches = {\n\t\t\t\t\tDMI_MATCH(DMI_SYS_VENDOR, \"Google\"),\n\t\t\t\t}\n\t\t\t},\n\t\t\t{}\n\t\t}\n\t},\n\t{\n\t\t.flags = FLAG_SST | FLAG_SST_ONLY_IF_DMIC,\n\t\t.device = PCI_DEVICE_ID_INTEL_HDA_KBL_LP,\n\t},\n#endif\n\n \n \n#if IS_ENABLED(CONFIG_SND_SOC_SOF_GEMINILAKE)\n\t{\n\t\t.flags = FLAG_SOF,\n\t\t.device = PCI_DEVICE_ID_INTEL_HDA_GML,\n\t\t.dmi_table = (const struct dmi_system_id []) {\n\t\t\t{\n\t\t\t\t.ident = \"Google Chromebooks\",\n\t\t\t\t.matches = {\n\t\t\t\t\tDMI_MATCH(DMI_SYS_VENDOR, \"Google\"),\n\t\t\t\t}\n\t\t\t},\n\t\t\t{}\n\t\t}\n\t},\n\t{\n\t\t.flags = FLAG_SOF,\n\t\t.device = PCI_DEVICE_ID_INTEL_HDA_GML,\n\t\t.codec_hid =  &essx_83x6,\n\t},\n#endif\n\n \n\n \n#if IS_ENABLED(CONFIG_SND_SOC_SOF_CANNONLAKE)\n\t{\n\t\t.flags = FLAG_SOF,\n\t\t.device = PCI_DEVICE_ID_INTEL_HDA_CNL_LP,\n\t\t.dmi_table = (const struct dmi_system_id []) {\n\t\t\t{\n\t\t\t\t.ident = \"Google Chromebooks\",\n\t\t\t\t.matches = {\n\t\t\t\t\tDMI_MATCH(DMI_SYS_VENDOR, \"Google\"),\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t.ident = \"UP-WHL\",\n\t\t\t\t.matches = {\n\t\t\t\t\tDMI_MATCH(DMI_SYS_VENDOR, \"AAEON\"),\n\t\t\t\t}\n\t\t\t},\n\t\t\t{}\n\t\t}\n\t},\n\t{\n\t\t.flags = FLAG_SOF,\n\t\t.device = PCI_DEVICE_ID_INTEL_HDA_CNL_LP,\n\t\t.codec_hid =  &essx_83x6,\n\t},\n\t{\n\t\t.flags = FLAG_SOF | FLAG_SOF_ONLY_IF_DMIC_OR_SOUNDWIRE,\n\t\t.device = PCI_DEVICE_ID_INTEL_HDA_CNL_LP,\n\t},\n#endif\n\n \n#if IS_ENABLED(CONFIG_SND_SOC_SOF_COFFEELAKE)\n\t{\n\t\t.flags = FLAG_SOF,\n\t\t.device = PCI_DEVICE_ID_INTEL_HDA_CNL_H,\n\t\t.dmi_table = (const struct dmi_system_id []) {\n\t\t\t{\n\t\t\t\t.ident = \"Google Chromebooks\",\n\t\t\t\t.matches = {\n\t\t\t\t\tDMI_MATCH(DMI_SYS_VENDOR, \"Google\"),\n\t\t\t\t}\n\t\t\t},\n\t\t\t{}\n\t\t}\n\t},\n\t{\n\t\t.flags = FLAG_SOF | FLAG_SOF_ONLY_IF_DMIC_OR_SOUNDWIRE,\n\t\t.device = PCI_DEVICE_ID_INTEL_HDA_CNL_H,\n\t},\n#endif\n\n#if IS_ENABLED(CONFIG_SND_SOC_SOF_COMETLAKE)\n \n\t{\n\t\t.flags = FLAG_SOF,\n\t\t.device = PCI_DEVICE_ID_INTEL_HDA_CML_LP,\n\t\t.dmi_table = (const struct dmi_system_id []) {\n\t\t\t{\n\t\t\t\t.ident = \"Google Chromebooks\",\n\t\t\t\t.matches = {\n\t\t\t\t\tDMI_MATCH(DMI_SYS_VENDOR, \"Google\"),\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t.matches = {\n\t\t\t\t\tDMI_MATCH(DMI_SYS_VENDOR, \"Dell Inc\"),\n\t\t\t\t\tDMI_EXACT_MATCH(DMI_PRODUCT_SKU, \"09C6\")\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\t \n\t\t\t\t.matches = {\n\t\t\t\t\tDMI_MATCH(DMI_SYS_VENDOR, \"Dell Inc\"),\n\t\t\t\t\tDMI_EXACT_MATCH(DMI_PRODUCT_SKU, \"0983\")\n\t\t\t\t},\n\t\t\t},\n\t\t\t{}\n\t\t}\n\t},\n\t{\n\t\t.flags = FLAG_SOF,\n\t\t.device = PCI_DEVICE_ID_INTEL_HDA_CML_LP,\n\t\t.codec_hid =  &essx_83x6,\n\t},\n\t{\n\t\t.flags = FLAG_SOF | FLAG_SOF_ONLY_IF_DMIC_OR_SOUNDWIRE,\n\t\t.device = PCI_DEVICE_ID_INTEL_HDA_CML_LP,\n\t},\n \n\t{\n\t\t.flags = FLAG_SOF,\n\t\t.device = PCI_DEVICE_ID_INTEL_HDA_CML_H,\n\t\t.dmi_table = (const struct dmi_system_id []) {\n\t\t\t{\n\t\t\t\t.matches = {\n\t\t\t\t\tDMI_MATCH(DMI_SYS_VENDOR, \"Dell Inc\"),\n\t\t\t\t\tDMI_EXACT_MATCH(DMI_PRODUCT_SKU, \"098F\"),\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\t.matches = {\n\t\t\t\t\tDMI_MATCH(DMI_SYS_VENDOR, \"Dell Inc\"),\n\t\t\t\t\tDMI_EXACT_MATCH(DMI_PRODUCT_SKU, \"0990\"),\n\t\t\t\t},\n\t\t\t},\n\t\t\t{}\n\t\t}\n\t},\n\t{\n\t\t.flags = FLAG_SOF,\n\t\t.device = PCI_DEVICE_ID_INTEL_HDA_CML_H,\n\t\t.codec_hid =  &essx_83x6,\n\t},\n\t{\n\t\t.flags = FLAG_SOF | FLAG_SOF_ONLY_IF_DMIC_OR_SOUNDWIRE,\n\t\t.device = PCI_DEVICE_ID_INTEL_HDA_CML_H,\n\t},\n#endif\n\n \n#if IS_ENABLED(CONFIG_SND_SOC_SOF_ICELAKE)\n\t{\n\t\t.flags = FLAG_SOF,\n\t\t.device = PCI_DEVICE_ID_INTEL_HDA_ICL_LP,\n\t\t.dmi_table = (const struct dmi_system_id []) {\n\t\t\t{\n\t\t\t\t.ident = \"Google Chromebooks\",\n\t\t\t\t.matches = {\n\t\t\t\t\tDMI_MATCH(DMI_SYS_VENDOR, \"Google\"),\n\t\t\t\t}\n\t\t\t},\n\t\t\t{}\n\t\t}\n\t},\n\t{\n\t\t.flags = FLAG_SOF,\n\t\t.device = PCI_DEVICE_ID_INTEL_HDA_ICL_LP,\n\t\t.codec_hid =  &essx_83x6,\n\t},\n\t{\n\t\t.flags = FLAG_SOF | FLAG_SOF_ONLY_IF_DMIC_OR_SOUNDWIRE,\n\t\t.device = PCI_DEVICE_ID_INTEL_HDA_ICL_LP,\n\t},\n#endif\n\n \n#if IS_ENABLED(CONFIG_SND_SOC_SOF_JASPERLAKE)\n\t{\n\t\t.flags = FLAG_SOF,\n\t\t.device = PCI_DEVICE_ID_INTEL_HDA_JSL_N,\n\t\t.dmi_table = (const struct dmi_system_id []) {\n\t\t\t{\n\t\t\t\t.ident = \"Google Chromebooks\",\n\t\t\t\t.matches = {\n\t\t\t\t\tDMI_MATCH(DMI_SYS_VENDOR, \"Google\"),\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t.ident = \"Google firmware\",\n\t\t\t\t.matches = {\n\t\t\t\t\tDMI_MATCH(DMI_BIOS_VERSION, \"Google\"),\n\t\t\t\t}\n\t\t\t},\n\t\t\t{}\n\t\t}\n\t},\n\t{\n\t\t.flags = FLAG_SOF,\n\t\t.device = PCI_DEVICE_ID_INTEL_HDA_JSL_N,\n\t\t.codec_hid =  &essx_83x6,\n\t},\n\t{\n\t\t.flags = FLAG_SOF | FLAG_SOF_ONLY_IF_DMIC,\n\t\t.device = PCI_DEVICE_ID_INTEL_HDA_JSL_N,\n\t},\n#endif\n\n \n#if IS_ENABLED(CONFIG_SND_SOC_SOF_TIGERLAKE)\n\t{\n\t\t.flags = FLAG_SOF,\n\t\t.device = PCI_DEVICE_ID_INTEL_HDA_TGL_LP,\n\t\t.dmi_table = (const struct dmi_system_id []) {\n\t\t\t{\n\t\t\t\t.ident = \"Google Chromebooks\",\n\t\t\t\t.matches = {\n\t\t\t\t\tDMI_MATCH(DMI_SYS_VENDOR, \"Google\"),\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t.ident = \"UPX-TGL\",\n\t\t\t\t.matches = {\n\t\t\t\t\tDMI_MATCH(DMI_SYS_VENDOR, \"AAEON\"),\n\t\t\t\t}\n\t\t\t},\n\t\t\t{}\n\t\t}\n\t},\n\t{\n\t\t.flags = FLAG_SOF,\n\t\t.device = PCI_DEVICE_ID_INTEL_HDA_TGL_LP,\n\t\t.codec_hid =  &essx_83x6,\n\t},\n\t{\n\t\t.flags = FLAG_SOF | FLAG_SOF_ONLY_IF_DMIC_OR_SOUNDWIRE,\n\t\t.device = PCI_DEVICE_ID_INTEL_HDA_TGL_LP,\n\t},\n\t{\n\t\t.flags = FLAG_SOF | FLAG_SOF_ONLY_IF_DMIC_OR_SOUNDWIRE,\n\t\t.device = PCI_DEVICE_ID_INTEL_HDA_TGL_H,\n\t},\n#endif\n\n \n#if IS_ENABLED(CONFIG_SND_SOC_SOF_ELKHARTLAKE)\n\t{\n\t\t.flags = FLAG_SOF | FLAG_SOF_ONLY_IF_DMIC,\n\t\t.device = PCI_DEVICE_ID_INTEL_HDA_EHL_0,\n\t},\n\t{\n\t\t.flags = FLAG_SOF | FLAG_SOF_ONLY_IF_DMIC,\n\t\t.device = PCI_DEVICE_ID_INTEL_HDA_EHL_3,\n\t},\n#endif\n\n \n#if IS_ENABLED(CONFIG_SND_SOC_SOF_ALDERLAKE)\n\t{\n\t\t.flags = FLAG_SOF | FLAG_SOF_ONLY_IF_DMIC_OR_SOUNDWIRE,\n\t\t.device = PCI_DEVICE_ID_INTEL_HDA_ADL_S,\n\t},\n\t{\n\t\t.flags = FLAG_SOF | FLAG_SOF_ONLY_IF_DMIC_OR_SOUNDWIRE,\n\t\t.device = PCI_DEVICE_ID_INTEL_HDA_RPL_S,\n\t},\n\t{\n\t\t.flags = FLAG_SOF,\n\t\t.device = PCI_DEVICE_ID_INTEL_HDA_ADL_P,\n\t\t.dmi_table = (const struct dmi_system_id []) {\n\t\t\t{\n\t\t\t\t.ident = \"Google Chromebooks\",\n\t\t\t\t.matches = {\n\t\t\t\t\tDMI_MATCH(DMI_SYS_VENDOR, \"Google\"),\n\t\t\t\t}\n\t\t\t},\n\t\t\t{}\n\t\t}\n\t},\n\t{\n\t\t.flags = FLAG_SOF,\n\t\t.device = PCI_DEVICE_ID_INTEL_HDA_ADL_P,\n\t\t.codec_hid =  &essx_83x6,\n\t},\n\t{\n\t\t.flags = FLAG_SOF | FLAG_SOF_ONLY_IF_DMIC_OR_SOUNDWIRE,\n\t\t.device = PCI_DEVICE_ID_INTEL_HDA_ADL_P,\n\t},\n\t{\n\t\t.flags = FLAG_SOF | FLAG_SOF_ONLY_IF_DMIC_OR_SOUNDWIRE,\n\t\t.device = PCI_DEVICE_ID_INTEL_HDA_ADL_PX,\n\t},\n\t{\n\t\t.flags = FLAG_SOF,\n\t\t.device = PCI_DEVICE_ID_INTEL_HDA_ADL_PS,\n\t\t.codec_hid =  &essx_83x6,\n\t},\n\t{\n\t\t.flags = FLAG_SOF | FLAG_SOF_ONLY_IF_DMIC_OR_SOUNDWIRE,\n\t\t.device = PCI_DEVICE_ID_INTEL_HDA_ADL_PS,\n\t},\n\t{\n\t\t.flags = FLAG_SOF | FLAG_SOF_ONLY_IF_DMIC_OR_SOUNDWIRE,\n\t\t.device = PCI_DEVICE_ID_INTEL_HDA_ADL_M,\n\t},\n\t{\n\t\t.flags = FLAG_SOF,\n\t\t.device = PCI_DEVICE_ID_INTEL_HDA_ADL_N,\n\t\t.dmi_table = (const struct dmi_system_id []) {\n\t\t\t{\n\t\t\t\t.ident = \"Google Chromebooks\",\n\t\t\t\t.matches = {\n\t\t\t\t\tDMI_MATCH(DMI_SYS_VENDOR, \"Google\"),\n\t\t\t\t}\n\t\t\t},\n\t\t\t{}\n\t\t}\n\t},\n\t{\n\t\t.flags = FLAG_SOF | FLAG_SOF_ONLY_IF_DMIC_OR_SOUNDWIRE,\n\t\t.device = PCI_DEVICE_ID_INTEL_HDA_ADL_N,\n\t},\n\t{\n\t\t.flags = FLAG_SOF,\n\t\t.device = PCI_DEVICE_ID_INTEL_HDA_RPL_P_0,\n\t\t.dmi_table = (const struct dmi_system_id []) {\n\t\t\t{\n\t\t\t\t.ident = \"Google Chromebooks\",\n\t\t\t\t.matches = {\n\t\t\t\t\tDMI_MATCH(DMI_SYS_VENDOR, \"Google\"),\n\t\t\t\t}\n\t\t\t},\n\t\t\t{}\n\t\t}\n\t},\n\t{\n\t\t.flags = FLAG_SOF | FLAG_SOF_ONLY_IF_DMIC_OR_SOUNDWIRE,\n\t\t.device = PCI_DEVICE_ID_INTEL_HDA_RPL_P_0,\n\t},\n\t{\n\t\t.flags = FLAG_SOF,\n\t\t.device = PCI_DEVICE_ID_INTEL_HDA_RPL_P_1,\n\t\t.dmi_table = (const struct dmi_system_id []) {\n\t\t\t{\n\t\t\t\t.ident = \"Google Chromebooks\",\n\t\t\t\t.matches = {\n\t\t\t\t\tDMI_MATCH(DMI_SYS_VENDOR, \"Google\"),\n\t\t\t\t}\n\t\t\t},\n\t\t\t{}\n\t\t}\n\t},\n\t{\n\t\t.flags = FLAG_SOF | FLAG_SOF_ONLY_IF_DMIC_OR_SOUNDWIRE,\n\t\t.device = PCI_DEVICE_ID_INTEL_HDA_RPL_P_1,\n\t},\n\t{\n\t\t.flags = FLAG_SOF | FLAG_SOF_ONLY_IF_DMIC_OR_SOUNDWIRE,\n\t\t.device = PCI_DEVICE_ID_INTEL_HDA_RPL_M,\n\t},\n\t{\n\t\t.flags = FLAG_SOF | FLAG_SOF_ONLY_IF_DMIC_OR_SOUNDWIRE,\n\t\t.device = PCI_DEVICE_ID_INTEL_HDA_RPL_PX,\n\t},\n#endif\n\n \n#if IS_ENABLED(CONFIG_SND_SOC_SOF_METEORLAKE)\n\t \n\t{\n\t\t.flags = FLAG_SOF | FLAG_SOF_ONLY_IF_DMIC_OR_SOUNDWIRE,\n\t\t.device = PCI_DEVICE_ID_INTEL_HDA_MTL,\n\t},\n#endif\n\n \n#if IS_ENABLED(CONFIG_SND_SOC_SOF_LUNARLAKE)\n\t \n\t{\n\t\t.flags = FLAG_SOF | FLAG_SOF_ONLY_IF_DMIC_OR_SOUNDWIRE,\n\t\t.device = PCI_DEVICE_ID_INTEL_HDA_LNL_P,\n\t},\n#endif\n};\n\nstatic const struct config_entry *snd_intel_dsp_find_config\n\t\t(struct pci_dev *pci, const struct config_entry *table, u32 len)\n{\n\tu16 device;\n\n\tdevice = pci->device;\n\tfor (; len > 0; len--, table++) {\n\t\tif (table->device != device)\n\t\t\tcontinue;\n\t\tif (table->dmi_table && !dmi_check_system(table->dmi_table))\n\t\t\tcontinue;\n\t\tif (table->codec_hid) {\n\t\t\tint i;\n\n\t\t\tfor (i = 0; i < table->codec_hid->num_codecs; i++)\n\t\t\t\tif (acpi_dev_present(table->codec_hid->codecs[i], NULL, -1))\n\t\t\t\t\tbreak;\n\t\t\tif (i == table->codec_hid->num_codecs)\n\t\t\t\tcontinue;\n\t\t}\n\t\treturn table;\n\t}\n\treturn NULL;\n}\n\nstatic int snd_intel_dsp_check_dmic(struct pci_dev *pci)\n{\n\tstruct nhlt_acpi_table *nhlt;\n\tint ret = 0;\n\n\tnhlt = intel_nhlt_init(&pci->dev);\n\tif (nhlt) {\n\t\tif (intel_nhlt_has_endpoint_type(nhlt, NHLT_LINK_DMIC))\n\t\t\tret = 1;\n\t\tintel_nhlt_free(nhlt);\n\t}\n\treturn ret;\n}\n\n#if IS_ENABLED(CONFIG_SND_SOC_SOF_INTEL_SOUNDWIRE)\nstatic int snd_intel_dsp_check_soundwire(struct pci_dev *pci)\n{\n\tstruct sdw_intel_acpi_info info;\n\tacpi_handle handle;\n\tint ret;\n\n\thandle = ACPI_HANDLE(&pci->dev);\n\n\tret = sdw_intel_acpi_scan(handle, &info);\n\tif (ret < 0)\n\t\treturn ret;\n\n\treturn info.link_mask;\n}\n#else\nstatic int snd_intel_dsp_check_soundwire(struct pci_dev *pci)\n{\n\treturn 0;\n}\n#endif\n\nint snd_intel_dsp_driver_probe(struct pci_dev *pci)\n{\n\tconst struct config_entry *cfg;\n\n\t \n\tif (pci->vendor != PCI_VENDOR_ID_INTEL)\n\t\treturn SND_INTEL_DSP_DRIVER_ANY;\n\n\t \n\tswitch (pci->device) {\n\tcase PCI_DEVICE_ID_INTEL_HDA_BDW:\n\tcase PCI_DEVICE_ID_INTEL_HDA_HSW_0:\n\tcase PCI_DEVICE_ID_INTEL_HDA_HSW_2:\n\tcase PCI_DEVICE_ID_INTEL_HDA_HSW_3:\n\tcase PCI_DEVICE_ID_INTEL_HDA_BYT:\n\tcase PCI_DEVICE_ID_INTEL_HDA_BSW:\n\t\treturn SND_INTEL_DSP_DRIVER_ANY;\n\t}\n\n\tif (dsp_driver > 0 && dsp_driver <= SND_INTEL_DSP_DRIVER_LAST)\n\t\treturn dsp_driver;\n\n\t \n\tif (pci->class == 0x040300)\n\t\treturn SND_INTEL_DSP_DRIVER_LEGACY;\n\tif (pci->class != 0x040100 && pci->class != 0x040380) {\n\t\tdev_err(&pci->dev, \"Unknown PCI class/subclass/prog-if information (0x%06x) found, selecting HDAudio legacy driver\\n\", pci->class);\n\t\treturn SND_INTEL_DSP_DRIVER_LEGACY;\n\t}\n\n\tdev_info(&pci->dev, \"DSP detected with PCI class/subclass/prog-if info 0x%06x\\n\", pci->class);\n\n\t \n\tcfg = snd_intel_dsp_find_config(pci, config_table, ARRAY_SIZE(config_table));\n\tif (!cfg)\n\t\treturn SND_INTEL_DSP_DRIVER_ANY;\n\n\tif (cfg->flags & FLAG_SOF) {\n\t\tif (cfg->flags & FLAG_SOF_ONLY_IF_SOUNDWIRE &&\n\t\t    snd_intel_dsp_check_soundwire(pci) > 0) {\n\t\t\tdev_info(&pci->dev, \"SoundWire enabled on CannonLake+ platform, using SOF driver\\n\");\n\t\t\treturn SND_INTEL_DSP_DRIVER_SOF;\n\t\t}\n\t\tif (cfg->flags & FLAG_SOF_ONLY_IF_DMIC &&\n\t\t    snd_intel_dsp_check_dmic(pci)) {\n\t\t\tdev_info(&pci->dev, \"Digital mics found on Skylake+ platform, using SOF driver\\n\");\n\t\t\treturn SND_INTEL_DSP_DRIVER_SOF;\n\t\t}\n\t\tif (!(cfg->flags & FLAG_SOF_ONLY_IF_DMIC_OR_SOUNDWIRE))\n\t\t\treturn SND_INTEL_DSP_DRIVER_SOF;\n\t}\n\n\n\tif (cfg->flags & FLAG_SST) {\n\t\tif (cfg->flags & FLAG_SST_ONLY_IF_DMIC) {\n\t\t\tif (snd_intel_dsp_check_dmic(pci)) {\n\t\t\t\tdev_info(&pci->dev, \"Digital mics found on Skylake+ platform, using SST driver\\n\");\n\t\t\t\treturn SND_INTEL_DSP_DRIVER_SST;\n\t\t\t}\n\t\t} else {\n\t\t\treturn SND_INTEL_DSP_DRIVER_SST;\n\t\t}\n\t}\n\n\treturn SND_INTEL_DSP_DRIVER_LEGACY;\n}\nEXPORT_SYMBOL_GPL(snd_intel_dsp_driver_probe);\n\n \n#if IS_ENABLED(CONFIG_SND_INTEL_BYT_PREFER_SOF) || \\\n    !IS_ENABLED(CONFIG_SND_SST_ATOM_HIFI2_PLATFORM_ACPI)\n#define FLAG_SST_OR_SOF_BYT\tFLAG_SOF\n#else\n#define FLAG_SST_OR_SOF_BYT\tFLAG_SST\n#endif\n\n \nstatic const struct config_entry acpi_config_table[] = {\n#if IS_ENABLED(CONFIG_SND_SST_ATOM_HIFI2_PLATFORM_ACPI) || \\\n    IS_ENABLED(CONFIG_SND_SOC_SOF_BAYTRAIL)\n \n\t{\n\t\t.flags = FLAG_SST_OR_SOF_BYT,\n\t\t.acpi_hid = \"80860F28\",\n\t},\n \n\t{\n\t\t.flags = FLAG_SST_OR_SOF_BYT,\n\t\t.acpi_hid = \"808622A8\",\n\t},\n#endif\n \n#if IS_ENABLED(CONFIG_SND_SOC_INTEL_CATPT)\n\t{\n\t\t.flags = FLAG_SST,\n\t\t.acpi_hid = \"INT3438\"\n\t},\n#endif\n#if IS_ENABLED(CONFIG_SND_SOC_SOF_BROADWELL)\n\t{\n\t\t.flags = FLAG_SOF,\n\t\t.acpi_hid = \"INT3438\"\n\t},\n#endif\n \n#if IS_ENABLED(CONFIG_SND_SOC_INTEL_CATPT)\n\t{\n\t\t.flags = FLAG_SST,\n\t\t.acpi_hid = \"INT33C8\"\n\t},\n#endif\n};\n\nstatic const struct config_entry *snd_intel_acpi_dsp_find_config(const u8 acpi_hid[ACPI_ID_LEN],\n\t\t\t\t\t\t\t\t const struct config_entry *table,\n\t\t\t\t\t\t\t\t u32 len)\n{\n\tfor (; len > 0; len--, table++) {\n\t\tif (memcmp(table->acpi_hid, acpi_hid, ACPI_ID_LEN))\n\t\t\tcontinue;\n\t\tif (table->dmi_table && !dmi_check_system(table->dmi_table))\n\t\t\tcontinue;\n\t\treturn table;\n\t}\n\treturn NULL;\n}\n\nint snd_intel_acpi_dsp_driver_probe(struct device *dev, const u8 acpi_hid[ACPI_ID_LEN])\n{\n\tconst struct config_entry *cfg;\n\n\tif (dsp_driver > SND_INTEL_DSP_DRIVER_LEGACY && dsp_driver <= SND_INTEL_DSP_DRIVER_LAST)\n\t\treturn dsp_driver;\n\n\tif (dsp_driver == SND_INTEL_DSP_DRIVER_LEGACY) {\n\t\tdev_warn(dev, \"dsp_driver parameter %d not supported, using automatic detection\\n\",\n\t\t\t SND_INTEL_DSP_DRIVER_LEGACY);\n\t}\n\n\t \n\tcfg = snd_intel_acpi_dsp_find_config(acpi_hid,  acpi_config_table,\n\t\t\t\t\t     ARRAY_SIZE(acpi_config_table));\n\tif (!cfg)\n\t\treturn SND_INTEL_DSP_DRIVER_ANY;\n\n\tif (cfg->flags & FLAG_SST)\n\t\treturn SND_INTEL_DSP_DRIVER_SST;\n\n\tif (cfg->flags & FLAG_SOF)\n\t\treturn SND_INTEL_DSP_DRIVER_SOF;\n\n\treturn SND_INTEL_DSP_DRIVER_SST;\n}\nEXPORT_SYMBOL_GPL(snd_intel_acpi_dsp_driver_probe);\n\nMODULE_LICENSE(\"GPL v2\");\nMODULE_DESCRIPTION(\"Intel DSP config driver\");\nMODULE_IMPORT_NS(SND_INTEL_SOUNDWIRE_ACPI);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}