{
  "module_name": "armada-370-db.c",
  "hash_id": "b4e9793f14453f557285bbed3ca1bd9d9a807e6cba0b278f382fd68881867d01",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/kirkwood/armada-370-db.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/moduleparam.h>\n#include <linux/interrupt.h>\n#include <linux/platform_device.h>\n#include <linux/slab.h>\n#include <sound/soc.h>\n#include <linux/of.h>\n#include <linux/platform_data/asoc-kirkwood.h>\n#include \"../codecs/cs42l51.h\"\n\nstatic int a370db_hw_params(struct snd_pcm_substream *substream,\n\t\t\t    struct snd_pcm_hw_params *params)\n{\n\tstruct snd_soc_pcm_runtime *rtd = asoc_substream_to_rtd(substream);\n\tstruct snd_soc_dai *codec_dai = asoc_rtd_to_codec(rtd, 0);\n\tunsigned int freq;\n\n\tswitch (params_rate(params)) {\n\tdefault:\n\tcase 44100:\n\t\tfreq = 11289600;\n\t\tbreak;\n\tcase 48000:\n\t\tfreq = 12288000;\n\t\tbreak;\n\tcase 96000:\n\t\tfreq = 24576000;\n\t\tbreak;\n\t}\n\n\treturn snd_soc_dai_set_sysclk(codec_dai, 0, freq, SND_SOC_CLOCK_IN);\n}\n\nstatic const struct snd_soc_ops a370db_ops = {\n\t.hw_params = a370db_hw_params,\n};\n\nstatic const struct snd_soc_dapm_widget a370db_dapm_widgets[] = {\n\tSND_SOC_DAPM_HP(\"Out Jack\", NULL),\n\tSND_SOC_DAPM_LINE(\"In Jack\", NULL),\n};\n\nstatic const struct snd_soc_dapm_route a370db_route[] = {\n\t{ \"Out Jack\",\tNULL,\t\"HPL\" },\n\t{ \"Out Jack\",\tNULL,\t\"HPR\" },\n\t{ \"AIN1L\",\tNULL,\t\"In Jack\" },\n\t{ \"AIN1L\",\tNULL,\t\"In Jack\" },\n};\n\nSND_SOC_DAILINK_DEFS(analog,\n\tDAILINK_COMP_ARRAY(COMP_CPU(\"i2s\")),\n\tDAILINK_COMP_ARRAY(COMP_CODEC(NULL, \"cs42l51-hifi\")),\n\tDAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(spdif_out,\n\tDAILINK_COMP_ARRAY(COMP_CPU(\"spdif\")),\n\tDAILINK_COMP_ARRAY(COMP_CODEC(NULL, \"dit-hifi\")),\n\tDAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(spdif_in,\n\tDAILINK_COMP_ARRAY(COMP_CPU(\"spdif\")),\n\tDAILINK_COMP_ARRAY(COMP_CODEC(NULL, \"dir-hifi\")),\n\tDAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nstatic struct snd_soc_dai_link a370db_dai[] = {\n{\n\t.name = \"CS42L51\",\n\t.stream_name = \"analog\",\n\t.dai_fmt = SND_SOC_DAIFMT_I2S | SND_SOC_DAIFMT_CBS_CFS,\n\t.ops = &a370db_ops,\n\tSND_SOC_DAILINK_REG(analog),\n},\n{\n\t.name = \"S/PDIF out\",\n\t.stream_name = \"spdif-out\",\n\t.dai_fmt = SND_SOC_DAIFMT_I2S | SND_SOC_DAIFMT_CBS_CFS,\n\tSND_SOC_DAILINK_REG(spdif_out),\n},\n{\n\t.name = \"S/PDIF in\",\n\t.stream_name = \"spdif-in\",\n\t.dai_fmt = SND_SOC_DAIFMT_I2S | SND_SOC_DAIFMT_CBS_CFS,\n\tSND_SOC_DAILINK_REG(spdif_in),\n},\n};\n\nstatic struct snd_soc_card a370db = {\n\t.name = \"a370db\",\n\t.owner = THIS_MODULE,\n\t.dai_link = a370db_dai,\n\t.num_links = ARRAY_SIZE(a370db_dai),\n\t.dapm_widgets = a370db_dapm_widgets,\n\t.num_dapm_widgets = ARRAY_SIZE(a370db_dapm_widgets),\n\t.dapm_routes = a370db_route,\n\t.num_dapm_routes = ARRAY_SIZE(a370db_route),\n};\n\nstatic int a370db_probe(struct platform_device *pdev)\n{\n\tstruct snd_soc_card *card = &a370db;\n\n\tcard->dev = &pdev->dev;\n\n\ta370db_dai[0].cpus->of_node =\n\t\tof_parse_phandle(pdev->dev.of_node,\n\t\t\t\t \"marvell,audio-controller\", 0);\n\ta370db_dai[0].platforms->of_node = a370db_dai[0].cpus->of_node;\n\n\ta370db_dai[0].codecs->of_node =\n\t\tof_parse_phandle(pdev->dev.of_node,\n\t\t\t\t \"marvell,audio-codec\", 0);\n\n\ta370db_dai[1].cpus->of_node = a370db_dai[0].cpus->of_node;\n\ta370db_dai[1].platforms->of_node = a370db_dai[0].cpus->of_node;\n\n\ta370db_dai[1].codecs->of_node =\n\t\tof_parse_phandle(pdev->dev.of_node,\n\t\t\t\t \"marvell,audio-codec\", 1);\n\n\ta370db_dai[2].cpus->of_node = a370db_dai[0].cpus->of_node;\n\ta370db_dai[2].platforms->of_node = a370db_dai[0].cpus->of_node;\n\n\ta370db_dai[2].codecs->of_node =\n\t\tof_parse_phandle(pdev->dev.of_node,\n\t\t\t\t \"marvell,audio-codec\", 2);\n\n\treturn devm_snd_soc_register_card(card->dev, card);\n}\n\nstatic const struct of_device_id a370db_dt_ids[] __maybe_unused = {\n\t{ .compatible = \"marvell,a370db-audio\" },\n\t{ },\n};\nMODULE_DEVICE_TABLE(of, a370db_dt_ids);\n\nstatic struct platform_driver a370db_driver = {\n\t.driver\t\t= {\n\t\t.name\t= \"a370db-audio\",\n\t\t.of_match_table = of_match_ptr(a370db_dt_ids),\n\t},\n\t.probe\t\t= a370db_probe,\n};\n\nmodule_platform_driver(a370db_driver);\n\nMODULE_AUTHOR(\"Thomas Petazzoni <thomas.petazzoni@free-electrons.com>\");\nMODULE_DESCRIPTION(\"ALSA SoC a370db audio client\");\nMODULE_LICENSE(\"GPL\");\nMODULE_ALIAS(\"platform:a370db-audio\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}