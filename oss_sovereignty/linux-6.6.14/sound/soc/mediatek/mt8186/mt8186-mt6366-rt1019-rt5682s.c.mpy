{
  "module_name": "mt8186-mt6366-rt1019-rt5682s.c",
  "hash_id": "6acc8fc2f7f05a91b7d68d949d57fcebe8562abf3f2bcb3e7932d24714ad5f2d",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/mediatek/mt8186/mt8186-mt6366-rt1019-rt5682s.c",
  "human_readable_source": "\n\n\n\n\n\n\n\n\n#include <linux/gpio.h>\n#include <linux/gpio/consumer.h>\n#include <linux/input.h>\n#include <linux/module.h>\n#include <linux/of_device.h>\n#include <sound/jack.h>\n#include <sound/pcm_params.h>\n#include <sound/rt5682.h>\n#include <sound/soc.h>\n\n#include \"../../codecs/mt6358.h\"\n#include \"../../codecs/rt5682.h\"\n#include \"../common/mtk-afe-platform-driver.h\"\n#include \"../common/mtk-dsp-sof-common.h\"\n#include \"../common/mtk-soc-card.h\"\n#include \"mt8186-afe-common.h\"\n#include \"mt8186-afe-clk.h\"\n#include \"mt8186-afe-gpio.h\"\n#include \"mt8186-mt6366-common.h\"\n\n#define RT1019_CODEC_DAI\t\"HiFi\"\n#define RT1019_DEV0_NAME\t\"rt1019p\"\n\n#define RT5682S_CODEC_DAI\t\"rt5682s-aif1\"\n#define RT5682S_DEV0_NAME\t\"rt5682s.5-001a\"\n\n#define SOF_DMA_DL1 \"SOF_DMA_DL1\"\n#define SOF_DMA_DL2 \"SOF_DMA_DL2\"\n#define SOF_DMA_UL1 \"SOF_DMA_UL1\"\n#define SOF_DMA_UL2 \"SOF_DMA_UL2\"\n\nstruct mt8186_mt6366_rt1019_rt5682s_priv {\n\tstruct snd_soc_jack headset_jack, hdmi_jack;\n\tstruct gpio_desc *dmic_sel;\n\tint dmic_switch;\n};\n\n \nstatic struct snd_soc_jack_pin mt8186_jack_pins[] = {\n\t{\n\t\t.pin = \"Headphone\",\n\t\t.mask = SND_JACK_HEADPHONE,\n\t},\n\t{\n\t\t.pin = \"Headset Mic\",\n\t\t.mask = SND_JACK_MICROPHONE,\n\t},\n};\n\nstatic struct snd_soc_codec_conf mt8186_mt6366_rt1019_rt5682s_codec_conf[] = {\n\t{\n\t\t.dlc = COMP_CODEC_CONF(\"mt6358-sound\"),\n\t\t.name_prefix = \"Mt6366\",\n\t},\n\t{\n\t\t.dlc = COMP_CODEC_CONF(\"bt-sco\"),\n\t\t.name_prefix = \"Mt8186 bt\",\n\t},\n\t{\n\t\t.dlc = COMP_CODEC_CONF(\"hdmi-audio-codec\"),\n\t\t.name_prefix = \"Mt8186 hdmi\",\n\t},\n};\n\nstatic int dmic_get(struct snd_kcontrol *kcontrol,\n\t\t    struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_soc_dapm_context *dapm = snd_soc_dapm_kcontrol_dapm(kcontrol);\n\tstruct mtk_soc_card_data *soc_card_data =\n\t\tsnd_soc_card_get_drvdata(dapm->card);\n\tstruct mt8186_mt6366_rt1019_rt5682s_priv *priv = soc_card_data->mach_priv;\n\n\tucontrol->value.integer.value[0] = priv->dmic_switch;\n\treturn 0;\n}\n\nstatic int dmic_set(struct snd_kcontrol *kcontrol,\n\t\t    struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_soc_dapm_context *dapm = snd_soc_dapm_kcontrol_dapm(kcontrol);\n\tstruct mtk_soc_card_data *soc_card_data =\n\t\tsnd_soc_card_get_drvdata(dapm->card);\n\tstruct mt8186_mt6366_rt1019_rt5682s_priv *priv = soc_card_data->mach_priv;\n\n\tpriv->dmic_switch = ucontrol->value.integer.value[0];\n\tif (priv->dmic_sel) {\n\t\tgpiod_set_value(priv->dmic_sel, priv->dmic_switch);\n\t\tdev_dbg(dapm->card->dev, \"dmic_set_value %d\\n\",\n\t\t\t priv->dmic_switch);\n\t}\n\treturn 0;\n}\n\nstatic const char * const dmic_mux_text[] = {\n\t\"Front Mic\",\n\t\"Rear Mic\",\n};\n\nstatic SOC_ENUM_SINGLE_DECL(mt8186_dmic_enum,\n\t\t\t    SND_SOC_NOPM, 0, dmic_mux_text);\n\nstatic const struct snd_kcontrol_new mt8186_dmic_mux_control =\n\tSOC_DAPM_ENUM_EXT(\"DMIC Select Mux\", mt8186_dmic_enum,\n\t\t\t  dmic_get, dmic_set);\n\nstatic const struct snd_soc_dapm_widget dmic_widgets[] = {\n\tSND_SOC_DAPM_MIC(\"DMIC\", NULL),\n\tSND_SOC_DAPM_MUX(\"Dmic Mux\", SND_SOC_NOPM, 0, 0, &mt8186_dmic_mux_control),\n};\n\nstatic const struct snd_soc_dapm_route dmic_map[] = {\n\t \n\t{\"Dmic Mux\", \"Front Mic\", \"DMIC\"},\n\t{\"Dmic Mux\", \"Rear Mic\", \"DMIC\"},\n};\n\nstatic int primary_codec_init(struct snd_soc_pcm_runtime *rtd)\n{\n\tstruct snd_soc_card *card = rtd->card;\n\tstruct mtk_soc_card_data *soc_card_data = snd_soc_card_get_drvdata(card);\n\tstruct mt8186_mt6366_rt1019_rt5682s_priv *priv = soc_card_data->mach_priv;\n\tint ret;\n\n\tret = mt8186_mt6366_init(rtd);\n\n\tif (ret) {\n\t\tdev_err(card->dev, \"mt8186_mt6366_init failed: %d\\n\", ret);\n\t\treturn ret;\n\t}\n\n\tif (!priv->dmic_sel) {\n\t\tdev_dbg(card->dev, \"dmic_sel is null\\n\");\n\t\treturn 0;\n\t}\n\n\tret = snd_soc_dapm_new_controls(&card->dapm, dmic_widgets,\n\t\t\t\t\tARRAY_SIZE(dmic_widgets));\n\tif (ret) {\n\t\tdev_err(card->dev, \"DMic widget addition failed: %d\\n\", ret);\n\t\t \n\t\treturn ret;\n\t}\n\n\tret = snd_soc_dapm_add_routes(&card->dapm, dmic_map,\n\t\t\t\t      ARRAY_SIZE(dmic_map));\n\n\tif (ret)\n\t\tdev_err(card->dev, \"DMic map addition failed: %d\\n\", ret);\n\n\treturn ret;\n}\n\nstatic int mt8186_rt5682s_init(struct snd_soc_pcm_runtime *rtd)\n{\n\tstruct snd_soc_component *cmpnt_afe =\n\t\tsnd_soc_rtdcom_lookup(rtd, AFE_PCM_NAME);\n\tstruct mtk_base_afe *afe = snd_soc_component_get_drvdata(cmpnt_afe);\n\tstruct mtk_soc_card_data *soc_card_data =\n\t\tsnd_soc_card_get_drvdata(rtd->card);\n\tstruct mt8186_mt6366_rt1019_rt5682s_priv *priv = soc_card_data->mach_priv;\n\tstruct snd_soc_jack *jack = &priv->headset_jack;\n\tstruct snd_soc_component *cmpnt_codec =\n\t\tasoc_rtd_to_codec(rtd, 0)->component;\n\tint ret;\n\n\tret = mt8186_dai_i2s_set_share(afe, \"I2S1\", \"I2S0\");\n\tif (ret) {\n\t\tdev_err(rtd->dev, \"Failed to set up shared clocks\\n\");\n\t\treturn ret;\n\t}\n\n\tret = snd_soc_card_jack_new_pins(rtd->card, \"Headset Jack\",\n\t\t\t\t    SND_JACK_HEADSET | SND_JACK_BTN_0 |\n\t\t\t\t    SND_JACK_BTN_1 | SND_JACK_BTN_2 |\n\t\t\t\t    SND_JACK_BTN_3,\n\t\t\t\t    jack, mt8186_jack_pins,\n\t\t\t\t    ARRAY_SIZE(mt8186_jack_pins));\n\tif (ret) {\n\t\tdev_err(rtd->dev, \"Headset Jack creation failed: %d\\n\", ret);\n\t\treturn ret;\n\t}\n\n\tsnd_jack_set_key(jack->jack, SND_JACK_BTN_0, KEY_PLAYPAUSE);\n\tsnd_jack_set_key(jack->jack, SND_JACK_BTN_1, KEY_VOICECOMMAND);\n\tsnd_jack_set_key(jack->jack, SND_JACK_BTN_2, KEY_VOLUMEUP);\n\tsnd_jack_set_key(jack->jack, SND_JACK_BTN_3, KEY_VOLUMEDOWN);\n\n\treturn snd_soc_component_set_jack(cmpnt_codec, jack, NULL);\n}\n\nstatic int mt8186_rt5682s_i2s_hw_params(struct snd_pcm_substream *substream,\n\t\t\t\t\tstruct snd_pcm_hw_params *params)\n{\n\tstruct snd_soc_pcm_runtime *rtd = substream->private_data;\n\tstruct snd_soc_card *card = rtd->card;\n\tstruct snd_soc_dai *cpu_dai = asoc_rtd_to_cpu(rtd, 0);\n\tstruct snd_soc_dai *codec_dai = asoc_rtd_to_codec(rtd, 0);\n\tunsigned int rate = params_rate(params);\n\tunsigned int mclk_fs_ratio = 128;\n\tunsigned int mclk_fs = rate * mclk_fs_ratio;\n\tint bitwidth;\n\tint ret;\n\n\tbitwidth = snd_pcm_format_width(params_format(params));\n\tif (bitwidth < 0) {\n\t\tdev_err(card->dev, \"invalid bit width: %d\\n\", bitwidth);\n\t\treturn bitwidth;\n\t}\n\n\tret = snd_soc_dai_set_tdm_slot(codec_dai, 0x00, 0x0, 0x2, bitwidth);\n\tif (ret) {\n\t\tdev_err(card->dev, \"failed to set tdm slot\\n\");\n\t\treturn ret;\n\t}\n\n\tret = snd_soc_dai_set_pll(codec_dai, RT5682_PLL1,\n\t\t\t\t  RT5682_PLL1_S_BCLK1,\n\t\t\t\t  params_rate(params) * 64,\n\t\t\t\t  params_rate(params) * 512);\n\tif (ret) {\n\t\tdev_err(card->dev, \"failed to set pll\\n\");\n\t\treturn ret;\n\t}\n\n\tret = snd_soc_dai_set_sysclk(codec_dai,\n\t\t\t\t     RT5682_SCLK_S_PLL1,\n\t\t\t\t     params_rate(params) * 512,\n\t\t\t\t     SND_SOC_CLOCK_IN);\n\tif (ret) {\n\t\tdev_err(card->dev, \"failed to set sysclk\\n\");\n\t\treturn ret;\n\t}\n\n\treturn snd_soc_dai_set_sysclk(cpu_dai, 0, mclk_fs, SND_SOC_CLOCK_OUT);\n}\n\nstatic const struct snd_soc_ops mt8186_rt5682s_i2s_ops = {\n\t.hw_params = mt8186_rt5682s_i2s_hw_params,\n};\n\nstatic int mt8186_mt6366_rt1019_rt5682s_hdmi_init(struct snd_soc_pcm_runtime *rtd)\n{\n\tstruct snd_soc_component *cmpnt_afe =\n\t\tsnd_soc_rtdcom_lookup(rtd, AFE_PCM_NAME);\n\tstruct mtk_base_afe *afe = snd_soc_component_get_drvdata(cmpnt_afe);\n\tstruct snd_soc_component *cmpnt_codec =\n\t\tasoc_rtd_to_codec(rtd, 0)->component;\n\tstruct mtk_soc_card_data *soc_card_data =\n\t\tsnd_soc_card_get_drvdata(rtd->card);\n\tstruct mt8186_mt6366_rt1019_rt5682s_priv *priv = soc_card_data->mach_priv;\n\tint ret;\n\n\tret = mt8186_dai_i2s_set_share(afe, \"I2S2\", \"I2S3\");\n\tif (ret) {\n\t\tdev_err(rtd->dev, \"Failed to set up shared clocks\\n\");\n\t\treturn ret;\n\t}\n\n\tret = snd_soc_card_jack_new(rtd->card, \"HDMI Jack\", SND_JACK_LINEOUT, &priv->hdmi_jack);\n\tif (ret) {\n\t\tdev_err(rtd->dev, \"HDMI Jack creation failed: %d\\n\", ret);\n\t\treturn ret;\n\t}\n\n\treturn snd_soc_component_set_jack(cmpnt_codec, &priv->hdmi_jack, NULL);\n}\n\nstatic int mt8186_hw_params_fixup(struct snd_soc_pcm_runtime *rtd,\n\t\t\t\t  struct snd_pcm_hw_params *params,\n\t\t\t\t  snd_pcm_format_t fmt)\n{\n\tstruct snd_interval *channels = hw_param_interval(params,\n\t\tSNDRV_PCM_HW_PARAM_CHANNELS);\n\n\tdev_dbg(rtd->dev, \"%s(), fix format to %d\\n\", __func__, fmt);\n\n\t \n\tchannels->min = 2;\n\tchannels->max = 2;\n\n\t \n\tsnd_mask_reset_range(hw_param_mask(params, SNDRV_PCM_HW_PARAM_FORMAT),\n\t\t\t     0, (__force unsigned int)SNDRV_PCM_FORMAT_LAST);\n\n\tparams_set_format(params, fmt);\n\n\treturn 0;\n}\n\nstatic int mt8186_i2s_hw_params_fixup(struct snd_soc_pcm_runtime *rtd,\n\t\t\t\t      struct snd_pcm_hw_params *params)\n{\n\treturn mt8186_hw_params_fixup(rtd, params, SNDRV_PCM_FORMAT_S24_LE);\n}\n\nstatic int mt8186_it6505_i2s_hw_params_fixup(struct snd_soc_pcm_runtime *rtd,\n\t\t\t\t\t     struct snd_pcm_hw_params *params)\n{\n\treturn mt8186_hw_params_fixup(rtd, params, SNDRV_PCM_FORMAT_S32_LE);\n}\n\n \nstatic int mt8186_sof_dai_link_fixup(struct snd_soc_pcm_runtime *rtd,\n\t\t\t\t     struct snd_pcm_hw_params *params)\n{\n\tint ret;\n\n\tret = mtk_sof_dai_link_fixup(rtd, params);\n\n\tif (!strcmp(rtd->dai_link->name, \"I2S0\") ||\n\t    !strcmp(rtd->dai_link->name, \"I2S1\") ||\n\t    !strcmp(rtd->dai_link->name, \"I2S2\"))\n\t\tmt8186_i2s_hw_params_fixup(rtd, params);\n\telse if (!strcmp(rtd->dai_link->name, \"I2S3\"))\n\t\tmt8186_it6505_i2s_hw_params_fixup(rtd, params);\n\n\treturn ret;\n}\n\nstatic int mt8186_mt6366_rt1019_rt5682s_playback_startup(struct snd_pcm_substream *substream)\n{\n\tstatic const unsigned int rates[] = {\n\t\t48000\n\t};\n\tstatic const unsigned int channels[] = {\n\t\t2\n\t};\n\tstatic const struct snd_pcm_hw_constraint_list constraints_rates = {\n\t\t.count = ARRAY_SIZE(rates),\n\t\t.list  = rates,\n\t\t.mask = 0,\n\t};\n\tstatic const struct snd_pcm_hw_constraint_list constraints_channels = {\n\t\t.count = ARRAY_SIZE(channels),\n\t\t.list  = channels,\n\t\t.mask = 0,\n\t};\n\n\tstruct snd_soc_pcm_runtime *rtd = asoc_substream_to_rtd(substream);\n\tstruct snd_pcm_runtime *runtime = substream->runtime;\n\tint ret;\n\n\tret = snd_pcm_hw_constraint_list(runtime, 0,\n\t\t\t\t\t SNDRV_PCM_HW_PARAM_RATE,\n\t\t\t\t\t &constraints_rates);\n\tif (ret < 0) {\n\t\tdev_err(rtd->dev, \"hw_constraint_list rate failed\\n\");\n\t\treturn ret;\n\t}\n\n\tret = snd_pcm_hw_constraint_list(runtime, 0,\n\t\t\t\t\t SNDRV_PCM_HW_PARAM_CHANNELS,\n\t\t\t\t\t &constraints_channels);\n\tif (ret < 0) {\n\t\tdev_err(rtd->dev, \"hw_constraint_list channel failed\\n\");\n\t\treturn ret;\n\t}\n\n\treturn 0;\n}\n\nstatic const struct snd_soc_ops mt8186_mt6366_rt1019_rt5682s_playback_ops = {\n\t.startup = mt8186_mt6366_rt1019_rt5682s_playback_startup,\n};\n\nstatic int mt8186_mt6366_rt1019_rt5682s_capture_startup(struct snd_pcm_substream *substream)\n{\n\tstatic const unsigned int rates[] = {\n\t\t48000\n\t};\n\tstatic const unsigned int channels[] = {\n\t\t1, 2\n\t};\n\tstatic const struct snd_pcm_hw_constraint_list constraints_rates = {\n\t\t.count = ARRAY_SIZE(rates),\n\t\t.list  = rates,\n\t\t.mask = 0,\n\t};\n\tstatic const struct snd_pcm_hw_constraint_list constraints_channels = {\n\t\t.count = ARRAY_SIZE(channels),\n\t\t.list  = channels,\n\t\t.mask = 0,\n\t};\n\n\tstruct snd_soc_pcm_runtime *rtd = asoc_substream_to_rtd(substream);\n\tstruct snd_pcm_runtime *runtime = substream->runtime;\n\tint ret;\n\n\tret = snd_pcm_hw_constraint_list(runtime, 0,\n\t\t\t\t\t SNDRV_PCM_HW_PARAM_RATE,\n\t\t\t\t\t &constraints_rates);\n\tif (ret < 0) {\n\t\tdev_err(rtd->dev, \"hw_constraint_list rate failed\\n\");\n\t\treturn ret;\n\t}\n\n\tret = snd_pcm_hw_constraint_list(runtime, 0,\n\t\t\t\t\t SNDRV_PCM_HW_PARAM_CHANNELS,\n\t\t\t\t\t &constraints_channels);\n\tif (ret < 0) {\n\t\tdev_err(rtd->dev, \"hw_constraint_list channel failed\\n\");\n\t\treturn ret;\n\t}\n\n\treturn 0;\n}\n\nstatic const struct snd_soc_ops mt8186_mt6366_rt1019_rt5682s_capture_ops = {\n\t.startup = mt8186_mt6366_rt1019_rt5682s_capture_startup,\n};\n\n \nSND_SOC_DAILINK_DEFS(playback1,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"DL1\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(playback12,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"DL12\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(playback2,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"DL2\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(playback3,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"DL3\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(playback4,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"DL4\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(playback5,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"DL5\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(playback6,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"DL6\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(playback7,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"DL7\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(playback8,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"DL8\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(capture1,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"UL1\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(capture2,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"UL2\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(capture3,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"UL3\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(capture4,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"UL4\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(capture5,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"UL5\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(capture6,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"UL6\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(capture7,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"UL7\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\n \nSND_SOC_DAILINK_DEFS(hostless_lpbk,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"Hostless LPBK DAI\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\nSND_SOC_DAILINK_DEFS(hostless_fm,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"Hostless FM DAI\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\nSND_SOC_DAILINK_DEFS(hostless_src1,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"Hostless_SRC_1_DAI\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\nSND_SOC_DAILINK_DEFS(hostless_src_bargein,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"Hostless_SRC_Bargein_DAI\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\n \nSND_SOC_DAILINK_DEFS(adda,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"ADDA\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_CODEC(\"mt6358-sound\",\n\t\t\t\t\t\t   \"mt6358-snd-codec-aif1\"),\n\t\t\t\t\tCOMP_CODEC(\"dmic-codec\",\n\t\t\t\t\t\t   \"dmic-hifi\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\nSND_SOC_DAILINK_DEFS(i2s0,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"I2S0\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\nSND_SOC_DAILINK_DEFS(i2s1,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"I2S1\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\nSND_SOC_DAILINK_DEFS(i2s2,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"I2S2\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\nSND_SOC_DAILINK_DEFS(i2s3,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"I2S3\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\nSND_SOC_DAILINK_DEFS(hw_gain1,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"HW Gain 1\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\nSND_SOC_DAILINK_DEFS(hw_gain2,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"HW Gain 2\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\nSND_SOC_DAILINK_DEFS(hw_src1,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"HW_SRC_1\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\nSND_SOC_DAILINK_DEFS(hw_src2,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"HW_SRC_2\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\nSND_SOC_DAILINK_DEFS(connsys_i2s,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"CONNSYS_I2S\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\nSND_SOC_DAILINK_DEFS(pcm1,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"PCM 1\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_CODEC(\"bt-sco\", \"bt-sco-pcm-wb\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\nSND_SOC_DAILINK_DEFS(tdm_in,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"TDM IN\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\n \nSND_SOC_DAILINK_DEFS(hostless_ul1,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"Hostless_UL1 DAI\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\nSND_SOC_DAILINK_DEFS(hostless_ul2,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"Hostless_UL2 DAI\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\nSND_SOC_DAILINK_DEFS(hostless_ul3,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"Hostless_UL3 DAI\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\nSND_SOC_DAILINK_DEFS(hostless_ul5,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"Hostless_UL5 DAI\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\nSND_SOC_DAILINK_DEFS(hostless_ul6,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"Hostless_UL6 DAI\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\nSND_SOC_DAILINK_DEFS(hostless_hw_gain_aaudio,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"Hostless HW Gain AAudio DAI\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\nSND_SOC_DAILINK_DEFS(hostless_src_aaudio,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"Hostless SRC AAudio DAI\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\nSND_SOC_DAILINK_DEFS(AFE_SOF_DL1,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"SOF_DL1\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(AFE_SOF_DL2,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"SOF_DL2\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(AFE_SOF_UL1,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"SOF_UL1\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(AFE_SOF_UL2,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"SOF_UL2\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nstatic const struct sof_conn_stream g_sof_conn_streams[] = {\n\t{ \"I2S1\", \"AFE_SOF_DL1\", SOF_DMA_DL1, SNDRV_PCM_STREAM_PLAYBACK},\n\t{ \"I2S3\", \"AFE_SOF_DL2\", SOF_DMA_DL2, SNDRV_PCM_STREAM_PLAYBACK},\n\t{ \"Primary Codec\", \"AFE_SOF_UL1\", SOF_DMA_UL1, SNDRV_PCM_STREAM_CAPTURE},\n\t{ \"I2S0\", \"AFE_SOF_UL2\", SOF_DMA_UL2, SNDRV_PCM_STREAM_CAPTURE},\n};\n\nstatic struct snd_soc_dai_link mt8186_mt6366_rt1019_rt5682s_dai_links[] = {\n\t \n\t{\n\t\t.name = \"Playback_1\",\n\t\t.stream_name = \"Playback_1\",\n\t\t.trigger = {SND_SOC_DPCM_TRIGGER_PRE,\n\t\t\t    SND_SOC_DPCM_TRIGGER_PRE},\n\t\t.dynamic = 1,\n\t\t.dpcm_playback = 1,\n\t\t.dpcm_merged_format = 1,\n\t\t.dpcm_merged_chan = 1,\n\t\t.dpcm_merged_rate = 1,\n\t\t.ops = &mt8186_mt6366_rt1019_rt5682s_playback_ops,\n\t\tSND_SOC_DAILINK_REG(playback1),\n\t},\n\t{\n\t\t.name = \"Playback_12\",\n\t\t.stream_name = \"Playback_12\",\n\t\t.trigger = {SND_SOC_DPCM_TRIGGER_PRE,\n\t\t\t    SND_SOC_DPCM_TRIGGER_PRE},\n\t\t.dynamic = 1,\n\t\t.dpcm_playback = 1,\n\t\tSND_SOC_DAILINK_REG(playback12),\n\t},\n\t{\n\t\t.name = \"Playback_2\",\n\t\t.stream_name = \"Playback_2\",\n\t\t.trigger = {SND_SOC_DPCM_TRIGGER_PRE,\n\t\t\t    SND_SOC_DPCM_TRIGGER_PRE},\n\t\t.dynamic = 1,\n\t\t.dpcm_playback = 1,\n\t\t.dpcm_merged_format = 1,\n\t\t.dpcm_merged_chan = 1,\n\t\t.dpcm_merged_rate = 1,\n\t\tSND_SOC_DAILINK_REG(playback2),\n\t},\n\t{\n\t\t.name = \"Playback_3\",\n\t\t.stream_name = \"Playback_3\",\n\t\t.trigger = {SND_SOC_DPCM_TRIGGER_PRE,\n\t\t\t    SND_SOC_DPCM_TRIGGER_PRE},\n\t\t.dynamic = 1,\n\t\t.dpcm_playback = 1,\n\t\t.dpcm_merged_format = 1,\n\t\t.dpcm_merged_chan = 1,\n\t\t.dpcm_merged_rate = 1,\n\t\t.ops = &mt8186_mt6366_rt1019_rt5682s_playback_ops,\n\t\tSND_SOC_DAILINK_REG(playback3),\n\t},\n\t{\n\t\t.name = \"Playback_4\",\n\t\t.stream_name = \"Playback_4\",\n\t\t.trigger = {SND_SOC_DPCM_TRIGGER_PRE,\n\t\t\t    SND_SOC_DPCM_TRIGGER_PRE},\n\t\t.dynamic = 1,\n\t\t.dpcm_playback = 1,\n\t\tSND_SOC_DAILINK_REG(playback4),\n\t},\n\t{\n\t\t.name = \"Playback_5\",\n\t\t.stream_name = \"Playback_5\",\n\t\t.trigger = {SND_SOC_DPCM_TRIGGER_PRE,\n\t\t\t    SND_SOC_DPCM_TRIGGER_PRE},\n\t\t.dynamic = 1,\n\t\t.dpcm_playback = 1,\n\t\tSND_SOC_DAILINK_REG(playback5),\n\t},\n\t{\n\t\t.name = \"Playback_6\",\n\t\t.stream_name = \"Playback_6\",\n\t\t.trigger = {SND_SOC_DPCM_TRIGGER_PRE,\n\t\t\t    SND_SOC_DPCM_TRIGGER_PRE},\n\t\t.dynamic = 1,\n\t\t.dpcm_playback = 1,\n\t\tSND_SOC_DAILINK_REG(playback6),\n\t},\n\t{\n\t\t.name = \"Playback_7\",\n\t\t.stream_name = \"Playback_7\",\n\t\t.trigger = {SND_SOC_DPCM_TRIGGER_PRE,\n\t\t\t    SND_SOC_DPCM_TRIGGER_PRE},\n\t\t.dynamic = 1,\n\t\t.dpcm_playback = 1,\n\t\tSND_SOC_DAILINK_REG(playback7),\n\t},\n\t{\n\t\t.name = \"Playback_8\",\n\t\t.stream_name = \"Playback_8\",\n\t\t.trigger = {SND_SOC_DPCM_TRIGGER_PRE,\n\t\t\t    SND_SOC_DPCM_TRIGGER_PRE},\n\t\t.dynamic = 1,\n\t\t.dpcm_playback = 1,\n\t\tSND_SOC_DAILINK_REG(playback8),\n\t},\n\t{\n\t\t.name = \"Capture_1\",\n\t\t.stream_name = \"Capture_1\",\n\t\t.trigger = {SND_SOC_DPCM_TRIGGER_PRE,\n\t\t\t    SND_SOC_DPCM_TRIGGER_PRE},\n\t\t.dynamic = 1,\n\t\t.dpcm_capture = 1,\n\t\tSND_SOC_DAILINK_REG(capture1),\n\t},\n\t{\n\t\t.name = \"Capture_2\",\n\t\t.stream_name = \"Capture_2\",\n\t\t.trigger = {SND_SOC_DPCM_TRIGGER_PRE,\n\t\t\t    SND_SOC_DPCM_TRIGGER_PRE},\n\t\t.dynamic = 1,\n\t\t.dpcm_capture = 1,\n\t\t.dpcm_merged_format = 1,\n\t\t.dpcm_merged_chan = 1,\n\t\t.dpcm_merged_rate = 1,\n\t\t.ops = &mt8186_mt6366_rt1019_rt5682s_capture_ops,\n\t\tSND_SOC_DAILINK_REG(capture2),\n\t},\n\t{\n\t\t.name = \"Capture_3\",\n\t\t.stream_name = \"Capture_3\",\n\t\t.trigger = {SND_SOC_DPCM_TRIGGER_PRE,\n\t\t\t    SND_SOC_DPCM_TRIGGER_PRE},\n\t\t.dynamic = 1,\n\t\t.dpcm_capture = 1,\n\t\tSND_SOC_DAILINK_REG(capture3),\n\t},\n\t{\n\t\t.name = \"Capture_4\",\n\t\t.stream_name = \"Capture_4\",\n\t\t.trigger = {SND_SOC_DPCM_TRIGGER_PRE,\n\t\t\t    SND_SOC_DPCM_TRIGGER_PRE},\n\t\t.dynamic = 1,\n\t\t.dpcm_capture = 1,\n\t\t.dpcm_merged_format = 1,\n\t\t.dpcm_merged_chan = 1,\n\t\t.dpcm_merged_rate = 1,\n\t\t.ops = &mt8186_mt6366_rt1019_rt5682s_capture_ops,\n\t\tSND_SOC_DAILINK_REG(capture4),\n\t},\n\t{\n\t\t.name = \"Capture_5\",\n\t\t.stream_name = \"Capture_5\",\n\t\t.trigger = {SND_SOC_DPCM_TRIGGER_PRE,\n\t\t\t    SND_SOC_DPCM_TRIGGER_PRE},\n\t\t.dynamic = 1,\n\t\t.dpcm_capture = 1,\n\t\tSND_SOC_DAILINK_REG(capture5),\n\t},\n\t{\n\t\t.name = \"Capture_6\",\n\t\t.stream_name = \"Capture_6\",\n\t\t.trigger = {SND_SOC_DPCM_TRIGGER_PRE,\n\t\t\t    SND_SOC_DPCM_TRIGGER_PRE},\n\t\t.dynamic = 1,\n\t\t.dpcm_capture = 1,\n\t\t.dpcm_merged_format = 1,\n\t\t.dpcm_merged_chan = 1,\n\t\t.dpcm_merged_rate = 1,\n\t\tSND_SOC_DAILINK_REG(capture6),\n\t},\n\t{\n\t\t.name = \"Capture_7\",\n\t\t.stream_name = \"Capture_7\",\n\t\t.trigger = {SND_SOC_DPCM_TRIGGER_PRE,\n\t\t\t    SND_SOC_DPCM_TRIGGER_PRE},\n\t\t.dynamic = 1,\n\t\t.dpcm_capture = 1,\n\t\tSND_SOC_DAILINK_REG(capture7),\n\t},\n\t{\n\t\t.name = \"Hostless_LPBK\",\n\t\t.stream_name = \"Hostless_LPBK\",\n\t\t.trigger = {SND_SOC_DPCM_TRIGGER_PRE,\n\t\t\t    SND_SOC_DPCM_TRIGGER_PRE},\n\t\t.dynamic = 1,\n\t\t.dpcm_playback = 1,\n\t\t.dpcm_capture = 1,\n\t\t.ignore_suspend = 1,\n\t\tSND_SOC_DAILINK_REG(hostless_lpbk),\n\t},\n\t{\n\t\t.name = \"Hostless_FM\",\n\t\t.stream_name = \"Hostless_FM\",\n\t\t.trigger = {SND_SOC_DPCM_TRIGGER_PRE,\n\t\t\t    SND_SOC_DPCM_TRIGGER_PRE},\n\t\t.dynamic = 1,\n\t\t.dpcm_playback = 1,\n\t\t.dpcm_capture = 1,\n\t\t.ignore_suspend = 1,\n\t\tSND_SOC_DAILINK_REG(hostless_fm),\n\t},\n\t{\n\t\t.name = \"Hostless_SRC_1\",\n\t\t.stream_name = \"Hostless_SRC_1\",\n\t\t.trigger = {SND_SOC_DPCM_TRIGGER_PRE,\n\t\t\t    SND_SOC_DPCM_TRIGGER_PRE},\n\t\t.dynamic = 1,\n\t\t.dpcm_playback = 1,\n\t\t.dpcm_capture = 1,\n\t\t.ignore_suspend = 1,\n\t\tSND_SOC_DAILINK_REG(hostless_src1),\n\t},\n\t{\n\t\t.name = \"Hostless_SRC_Bargein\",\n\t\t.stream_name = \"Hostless_SRC_Bargein\",\n\t\t.trigger = {SND_SOC_DPCM_TRIGGER_PRE,\n\t\t\t    SND_SOC_DPCM_TRIGGER_PRE},\n\t\t.dynamic = 1,\n\t\t.dpcm_playback = 1,\n\t\t.dpcm_capture = 1,\n\t\t.ignore_suspend = 1,\n\t\tSND_SOC_DAILINK_REG(hostless_src_bargein),\n\t},\n\t{\n\t\t.name = \"Hostless_HW_Gain_AAudio\",\n\t\t.stream_name = \"Hostless_HW_Gain_AAudio\",\n\t\t.trigger = {SND_SOC_DPCM_TRIGGER_PRE,\n\t\t\t    SND_SOC_DPCM_TRIGGER_PRE},\n\t\t.dynamic = 1,\n\t\t.dpcm_capture = 1,\n\t\t.ignore_suspend = 1,\n\t\tSND_SOC_DAILINK_REG(hostless_hw_gain_aaudio),\n\t},\n\t{\n\t\t.name = \"Hostless_SRC_AAudio\",\n\t\t.stream_name = \"Hostless_SRC_AAudio\",\n\t\t.trigger = {SND_SOC_DPCM_TRIGGER_PRE,\n\t\t\t    SND_SOC_DPCM_TRIGGER_PRE},\n\t\t.dynamic = 1,\n\t\t.dpcm_playback = 1,\n\t\t.dpcm_capture = 1,\n\t\t.ignore_suspend = 1,\n\t\tSND_SOC_DAILINK_REG(hostless_src_aaudio),\n\t},\n\t \n\t{\n\t\t.name = \"Primary Codec\",\n\t\t.no_pcm = 1,\n\t\t.dpcm_playback = 1,\n\t\t.dpcm_capture = 1,\n\t\t.ignore_suspend = 1,\n\t\t.init = primary_codec_init,\n\t\tSND_SOC_DAILINK_REG(adda),\n\t},\n\t{\n\t\t.name = \"I2S3\",\n\t\t.no_pcm = 1,\n\t\t.dai_fmt = SND_SOC_DAIFMT_I2S |\n\t\t\t   SND_SOC_DAIFMT_IB_IF |\n\t\t\t   SND_SOC_DAIFMT_CBM_CFM,\n\t\t.dpcm_playback = 1,\n\t\t.ignore_suspend = 1,\n\t\t.init = mt8186_mt6366_rt1019_rt5682s_hdmi_init,\n\t\t.be_hw_params_fixup = mt8186_it6505_i2s_hw_params_fixup,\n\t\tSND_SOC_DAILINK_REG(i2s3),\n\t},\n\t{\n\t\t.name = \"I2S0\",\n\t\t.no_pcm = 1,\n\t\t.dpcm_capture = 1,\n\t\t.ignore_suspend = 1,\n\t\t.be_hw_params_fixup = mt8186_i2s_hw_params_fixup,\n\t\t.ops = &mt8186_rt5682s_i2s_ops,\n\t\tSND_SOC_DAILINK_REG(i2s0),\n\t},\n\t{\n\t\t.name = \"I2S1\",\n\t\t.no_pcm = 1,\n\t\t.dpcm_playback = 1,\n\t\t.ignore_suspend = 1,\n\t\t.be_hw_params_fixup = mt8186_i2s_hw_params_fixup,\n\t\t.init = mt8186_rt5682s_init,\n\t\t.ops = &mt8186_rt5682s_i2s_ops,\n\t\tSND_SOC_DAILINK_REG(i2s1),\n\t},\n\t{\n\t\t.name = \"I2S2\",\n\t\t.no_pcm = 1,\n\t\t.dpcm_capture = 1,\n\t\t.ignore_suspend = 1,\n\t\t.be_hw_params_fixup = mt8186_i2s_hw_params_fixup,\n\t\tSND_SOC_DAILINK_REG(i2s2),\n\t},\n\t{\n\t\t.name = \"HW Gain 1\",\n\t\t.no_pcm = 1,\n\t\t.dpcm_playback = 1,\n\t\t.dpcm_capture = 1,\n\t\t.ignore_suspend = 1,\n\t\tSND_SOC_DAILINK_REG(hw_gain1),\n\t},\n\t{\n\t\t.name = \"HW Gain 2\",\n\t\t.no_pcm = 1,\n\t\t.dpcm_playback = 1,\n\t\t.dpcm_capture = 1,\n\t\t.ignore_suspend = 1,\n\t\tSND_SOC_DAILINK_REG(hw_gain2),\n\t},\n\t{\n\t\t.name = \"HW_SRC_1\",\n\t\t.no_pcm = 1,\n\t\t.dpcm_playback = 1,\n\t\t.dpcm_capture = 1,\n\t\t.ignore_suspend = 1,\n\t\tSND_SOC_DAILINK_REG(hw_src1),\n\t},\n\t{\n\t\t.name = \"HW_SRC_2\",\n\t\t.no_pcm = 1,\n\t\t.dpcm_playback = 1,\n\t\t.dpcm_capture = 1,\n\t\t.ignore_suspend = 1,\n\t\tSND_SOC_DAILINK_REG(hw_src2),\n\t},\n\t{\n\t\t.name = \"CONNSYS_I2S\",\n\t\t.no_pcm = 1,\n\t\t.dpcm_capture = 1,\n\t\t.ignore_suspend = 1,\n\t\tSND_SOC_DAILINK_REG(connsys_i2s),\n\t},\n\t{\n\t\t.name = \"PCM 1\",\n\t\t.dai_fmt = SND_SOC_DAIFMT_I2S |\n\t\t\t   SND_SOC_DAIFMT_NB_IF,\n\t\t.no_pcm = 1,\n\t\t.dpcm_playback = 1,\n\t\t.dpcm_capture = 1,\n\t\t.ignore_suspend = 1,\n\t\tSND_SOC_DAILINK_REG(pcm1),\n\t},\n\t{\n\t\t.name = \"TDM IN\",\n\t\t.no_pcm = 1,\n\t\t.dpcm_capture = 1,\n\t\t.ignore_suspend = 1,\n\t\tSND_SOC_DAILINK_REG(tdm_in),\n\t},\n\t \n\t{\n\t\t.name = \"Hostless_UL1\",\n\t\t.no_pcm = 1,\n\t\t.dpcm_capture = 1,\n\t\t.ignore_suspend = 1,\n\t\tSND_SOC_DAILINK_REG(hostless_ul1),\n\t},\n\t{\n\t\t.name = \"Hostless_UL2\",\n\t\t.no_pcm = 1,\n\t\t.dpcm_capture = 1,\n\t\t.ignore_suspend = 1,\n\t\tSND_SOC_DAILINK_REG(hostless_ul2),\n\t},\n\t{\n\t\t.name = \"Hostless_UL3\",\n\t\t.no_pcm = 1,\n\t\t.dpcm_capture = 1,\n\t\t.ignore_suspend = 1,\n\t\tSND_SOC_DAILINK_REG(hostless_ul3),\n\t},\n\t{\n\t\t.name = \"Hostless_UL5\",\n\t\t.no_pcm = 1,\n\t\t.dpcm_capture = 1,\n\t\t.ignore_suspend = 1,\n\t\tSND_SOC_DAILINK_REG(hostless_ul5),\n\t},\n\t{\n\t\t.name = \"Hostless_UL6\",\n\t\t.no_pcm = 1,\n\t\t.dpcm_capture = 1,\n\t\t.ignore_suspend = 1,\n\t\tSND_SOC_DAILINK_REG(hostless_ul6),\n\t},\n\t \n\t{\n\t\t.name = \"AFE_SOF_DL1\",\n\t\t.no_pcm = 1,\n\t\t.dpcm_playback = 1,\n\t\tSND_SOC_DAILINK_REG(AFE_SOF_DL1),\n\t},\n\t{\n\t\t.name = \"AFE_SOF_DL2\",\n\t\t.no_pcm = 1,\n\t\t.dpcm_playback = 1,\n\t\tSND_SOC_DAILINK_REG(AFE_SOF_DL2),\n\t},\n\t{\n\t\t.name = \"AFE_SOF_UL1\",\n\t\t.no_pcm = 1,\n\t\t.dpcm_capture = 1,\n\t\tSND_SOC_DAILINK_REG(AFE_SOF_UL1),\n\t},\n\t{\n\t\t.name = \"AFE_SOF_UL2\",\n\t\t.no_pcm = 1,\n\t\t.dpcm_capture = 1,\n\t\tSND_SOC_DAILINK_REG(AFE_SOF_UL2),\n\t},\n};\n\nstatic const struct snd_soc_dapm_widget\nmt8186_mt6366_rt1019_rt5682s_widgets[] = {\n\tSND_SOC_DAPM_SPK(\"Speakers\", NULL),\n\tSND_SOC_DAPM_HP(\"Headphone\", NULL),\n\tSND_SOC_DAPM_MIC(\"Headset Mic\", NULL),\n\tSND_SOC_DAPM_OUTPUT(\"HDMI1\"),\n\tSND_SOC_DAPM_MIXER(SOF_DMA_DL1, SND_SOC_NOPM, 0, 0, NULL, 0),\n\tSND_SOC_DAPM_MIXER(SOF_DMA_DL2, SND_SOC_NOPM, 0, 0, NULL, 0),\n\tSND_SOC_DAPM_MIXER(SOF_DMA_UL1, SND_SOC_NOPM, 0, 0, NULL, 0),\n\tSND_SOC_DAPM_MIXER(SOF_DMA_UL2, SND_SOC_NOPM, 0, 0, NULL, 0),\n};\n\nstatic const struct snd_soc_dapm_route\nmt8186_mt6366_rt1019_rt5682s_routes[] = {\n\t \n\t{ \"Speakers\", NULL, \"Speaker\" },\n\t \n\t{ \"Headphone\", NULL, \"HPOL\" },\n\t{ \"Headphone\", NULL, \"HPOR\" },\n\t{ \"IN1P\", NULL, \"Headset Mic\" },\n\t \n\t{ \"HDMI1\", NULL, \"TX\" },\n\t \n\t{SOF_DMA_UL1, NULL, \"UL1_CH1\"},\n\t{SOF_DMA_UL1, NULL, \"UL1_CH2\"},\n\t{SOF_DMA_UL2, NULL, \"UL2_CH1\"},\n\t{SOF_DMA_UL2, NULL, \"UL2_CH2\"},\n\t \n\t{\"DSP_DL1_VIRT\", NULL, SOF_DMA_DL1},\n\t{\"DSP_DL2_VIRT\", NULL, SOF_DMA_DL2},\n};\n\nstatic const struct snd_kcontrol_new\nmt8186_mt6366_rt1019_rt5682s_controls[] = {\n\tSOC_DAPM_PIN_SWITCH(\"Speakers\"),\n\tSOC_DAPM_PIN_SWITCH(\"Headphone\"),\n\tSOC_DAPM_PIN_SWITCH(\"Headset Mic\"),\n\tSOC_DAPM_PIN_SWITCH(\"HDMI1\"),\n};\n\nstatic struct snd_soc_card mt8186_mt6366_rt1019_rt5682s_soc_card = {\n\t.name = \"mt8186_rt1019_rt5682s\",\n\t.owner = THIS_MODULE,\n\t.dai_link = mt8186_mt6366_rt1019_rt5682s_dai_links,\n\t.num_links = ARRAY_SIZE(mt8186_mt6366_rt1019_rt5682s_dai_links),\n\t.controls = mt8186_mt6366_rt1019_rt5682s_controls,\n\t.num_controls = ARRAY_SIZE(mt8186_mt6366_rt1019_rt5682s_controls),\n\t.dapm_widgets = mt8186_mt6366_rt1019_rt5682s_widgets,\n\t.num_dapm_widgets = ARRAY_SIZE(mt8186_mt6366_rt1019_rt5682s_widgets),\n\t.dapm_routes = mt8186_mt6366_rt1019_rt5682s_routes,\n\t.num_dapm_routes = ARRAY_SIZE(mt8186_mt6366_rt1019_rt5682s_routes),\n\t.codec_conf = mt8186_mt6366_rt1019_rt5682s_codec_conf,\n\t.num_configs = ARRAY_SIZE(mt8186_mt6366_rt1019_rt5682s_codec_conf),\n};\n\nstatic struct snd_soc_card mt8186_mt6366_rt5682s_max98360_soc_card = {\n\t.name = \"mt8186_rt5682s_max98360\",\n\t.owner = THIS_MODULE,\n\t.dai_link = mt8186_mt6366_rt1019_rt5682s_dai_links,\n\t.num_links = ARRAY_SIZE(mt8186_mt6366_rt1019_rt5682s_dai_links),\n\t.controls = mt8186_mt6366_rt1019_rt5682s_controls,\n\t.num_controls = ARRAY_SIZE(mt8186_mt6366_rt1019_rt5682s_controls),\n\t.dapm_widgets = mt8186_mt6366_rt1019_rt5682s_widgets,\n\t.num_dapm_widgets = ARRAY_SIZE(mt8186_mt6366_rt1019_rt5682s_widgets),\n\t.dapm_routes = mt8186_mt6366_rt1019_rt5682s_routes,\n\t.num_dapm_routes = ARRAY_SIZE(mt8186_mt6366_rt1019_rt5682s_routes),\n\t.codec_conf = mt8186_mt6366_rt1019_rt5682s_codec_conf,\n\t.num_configs = ARRAY_SIZE(mt8186_mt6366_rt1019_rt5682s_codec_conf),\n};\n\nstatic int mt8186_mt6366_rt1019_rt5682s_dev_probe(struct platform_device *pdev)\n{\n\tstruct snd_soc_card *card;\n\tstruct snd_soc_dai_link *dai_link;\n\tstruct mtk_soc_card_data *soc_card_data;\n\tstruct mt8186_mt6366_rt1019_rt5682s_priv *mach_priv;\n\tstruct device_node *platform_node, *headset_codec, *playback_codec, *adsp_node;\n\tint sof_on = 0;\n\tint ret, i;\n\n\tcard = (struct snd_soc_card *)device_get_match_data(&pdev->dev);\n\tif (!card)\n\t\treturn -EINVAL;\n\tcard->dev = &pdev->dev;\n\n\tsoc_card_data = devm_kzalloc(&pdev->dev, sizeof(*soc_card_data), GFP_KERNEL);\n\tif (!soc_card_data)\n\t\treturn -ENOMEM;\n\tmach_priv = devm_kzalloc(&pdev->dev, sizeof(*mach_priv), GFP_KERNEL);\n\tif (!mach_priv)\n\t\treturn -ENOMEM;\n\n\tsoc_card_data->mach_priv = mach_priv;\n\n\tmach_priv->dmic_sel = devm_gpiod_get_optional(&pdev->dev,\n\t\t\t\t\t\t      \"dmic\", GPIOD_OUT_LOW);\n\tif (IS_ERR(mach_priv->dmic_sel)) {\n\t\tdev_err(&pdev->dev, \"DMIC gpio failed err=%ld\\n\",\n\t\t\tPTR_ERR(mach_priv->dmic_sel));\n\t\treturn PTR_ERR(mach_priv->dmic_sel);\n\t}\n\n\tadsp_node = of_parse_phandle(pdev->dev.of_node, \"mediatek,adsp\", 0);\n\tif (adsp_node) {\n\t\tstruct mtk_sof_priv *sof_priv;\n\n\t\tsof_priv = devm_kzalloc(&pdev->dev, sizeof(*sof_priv), GFP_KERNEL);\n\t\tif (!sof_priv) {\n\t\t\tret = -ENOMEM;\n\t\t\tgoto err_adsp_node;\n\t\t}\n\t\tsof_priv->conn_streams = g_sof_conn_streams;\n\t\tsof_priv->num_streams = ARRAY_SIZE(g_sof_conn_streams);\n\t\tsof_priv->sof_dai_link_fixup = mt8186_sof_dai_link_fixup;\n\t\tsoc_card_data->sof_priv = sof_priv;\n\t\tcard->probe = mtk_sof_card_probe;\n\t\tcard->late_probe = mtk_sof_card_late_probe;\n\t\tif (!card->topology_shortname_created) {\n\t\t\tsnprintf(card->topology_shortname, 32, \"sof-%s\", card->name);\n\t\t\tcard->topology_shortname_created = true;\n\t\t}\n\t\tcard->name = card->topology_shortname;\n\t\tsof_on = 1;\n\t} else {\n\t\tdev_dbg(&pdev->dev, \"Probe without adsp\\n\");\n\t}\n\n\tif (of_property_read_bool(pdev->dev.of_node, \"mediatek,dai-link\")) {\n\t\tret = mtk_sof_dailink_parse_of(card, pdev->dev.of_node,\n\t\t\t\t\t       \"mediatek,dai-link\",\n\t\t\t\t\t       mt8186_mt6366_rt1019_rt5682s_dai_links,\n\t\t\t\t\t       ARRAY_SIZE(mt8186_mt6366_rt1019_rt5682s_dai_links));\n\t\tif (ret) {\n\t\t\tdev_dbg(&pdev->dev, \"Parse dai-link fail\\n\");\n\t\t\tgoto err_adsp_node;\n\t\t}\n\t} else {\n\t\tif (!sof_on)\n\t\t\tcard->num_links = ARRAY_SIZE(mt8186_mt6366_rt1019_rt5682s_dai_links)\n\t\t\t\t\t- ARRAY_SIZE(g_sof_conn_streams);\n\t}\n\n\tplatform_node = of_parse_phandle(pdev->dev.of_node, \"mediatek,platform\", 0);\n\tif (!platform_node) {\n\t\tret = -EINVAL;\n\t\tdev_err_probe(&pdev->dev, ret, \"Property 'platform' missing or invalid\\n\");\n\t\tgoto err_platform_node;\n\t}\n\n\tplayback_codec = of_get_child_by_name(pdev->dev.of_node, \"playback-codecs\");\n\tif (!playback_codec) {\n\t\tret = -EINVAL;\n\t\tdev_err_probe(&pdev->dev, ret, \"Property 'playback-codecs' missing or invalid\\n\");\n\t\tgoto err_playback_codec;\n\t}\n\n\theadset_codec = of_get_child_by_name(pdev->dev.of_node, \"headset-codec\");\n\tif (!headset_codec) {\n\t\tret = -EINVAL;\n\t\tdev_err_probe(&pdev->dev, ret, \"Property 'headset-codec' missing or invalid\\n\");\n\t\tgoto err_headset_codec;\n\t}\n\n\tfor_each_card_prelinks(card, i, dai_link) {\n\t\tret = mt8186_mt6366_card_set_be_link(card, dai_link, playback_codec, \"I2S3\");\n\t\tif (ret) {\n\t\t\tdev_err_probe(&pdev->dev, ret, \"%s set playback_codec fail\\n\",\n\t\t\t\t      dai_link->name);\n\t\t\tgoto err_probe;\n\t\t}\n\n\t\tret = mt8186_mt6366_card_set_be_link(card, dai_link, headset_codec, \"I2S0\");\n\t\tif (ret) {\n\t\t\tdev_err_probe(&pdev->dev, ret, \"%s set headset_codec fail\\n\",\n\t\t\t\t      dai_link->name);\n\t\t\tgoto err_probe;\n\t\t}\n\n\t\tret = mt8186_mt6366_card_set_be_link(card, dai_link, headset_codec, \"I2S1\");\n\t\tif (ret) {\n\t\t\tdev_err_probe(&pdev->dev, ret, \"%s set headset_codec fail\\n\",\n\t\t\t\t      dai_link->name);\n\t\t\tgoto err_probe;\n\t\t}\n\n\t\tif (!strncmp(dai_link->name, \"AFE_SOF\", strlen(\"AFE_SOF\")) && sof_on)\n\t\t\tdai_link->platforms->of_node = adsp_node;\n\n\t\tif (!dai_link->platforms->name && !dai_link->platforms->of_node)\n\t\t\tdai_link->platforms->of_node = platform_node;\n\t}\n\n\tsnd_soc_card_set_drvdata(card, soc_card_data);\n\n\tret = mt8186_afe_gpio_init(&pdev->dev);\n\tif (ret) {\n\t\tdev_err_probe(&pdev->dev, ret, \"%s init gpio error\\n\", __func__);\n\t\tgoto err_probe;\n\t}\n\n\tret = devm_snd_soc_register_card(&pdev->dev, card);\n\tif (ret)\n\t\tdev_err_probe(&pdev->dev, ret, \"%s snd_soc_register_card fail\\n\", __func__);\n\nerr_probe:\n\tof_node_put(headset_codec);\nerr_headset_codec:\n\tof_node_put(playback_codec);\nerr_playback_codec:\n\tof_node_put(platform_node);\nerr_platform_node:\nerr_adsp_node:\n\tof_node_put(adsp_node);\n\n\treturn ret;\n}\n\n#if IS_ENABLED(CONFIG_OF)\nstatic const struct of_device_id mt8186_mt6366_rt1019_rt5682s_dt_match[] = {\n\t{\n\t\t.compatible = \"mediatek,mt8186-mt6366-rt1019-rt5682s-sound\",\n\t\t.data = &mt8186_mt6366_rt1019_rt5682s_soc_card,\n\t},\n\t{\n\t\t.compatible = \"mediatek,mt8186-mt6366-rt5682s-max98360-sound\",\n\t\t.data = &mt8186_mt6366_rt5682s_max98360_soc_card,\n\t},\n\t{}\n};\nMODULE_DEVICE_TABLE(of, mt8186_mt6366_rt1019_rt5682s_dt_match);\n#endif\n\nstatic struct platform_driver mt8186_mt6366_rt1019_rt5682s_driver = {\n\t.driver = {\n\t\t.name = \"mt8186_mt6366_rt1019_rt5682s\",\n#if IS_ENABLED(CONFIG_OF)\n\t\t.of_match_table = mt8186_mt6366_rt1019_rt5682s_dt_match,\n#endif\n\t\t.pm = &snd_soc_pm_ops,\n\t},\n\t.probe = mt8186_mt6366_rt1019_rt5682s_dev_probe,\n};\n\nmodule_platform_driver(mt8186_mt6366_rt1019_rt5682s_driver);\n\n \nMODULE_DESCRIPTION(\"MT8186-MT6366-RT1019-RT5682S ALSA SoC machine driver\");\nMODULE_AUTHOR(\"Jiaxin Yu <jiaxin.yu@mediatek.com>\");\nMODULE_LICENSE(\"GPL v2\");\nMODULE_ALIAS(\"mt8186_mt6366_rt1019_rt5682s soc card\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}