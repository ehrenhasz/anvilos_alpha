{
  "module_name": "mt8186-dai-hostless.c",
  "hash_id": "2c9547d138855cb4a647b6d23d2db4d49853eafdf88595b6fb755f99ca978262",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/mediatek/mt8186/mt8186-dai-hostless.c",
  "human_readable_source": "\n\n\n\n\n\n\n#include \"mt8186-afe-common.h\"\n\nstatic const struct snd_pcm_hardware mt8186_hostless_hardware = {\n\t.info = (SNDRV_PCM_INFO_MMAP | SNDRV_PCM_INFO_INTERLEAVED |\n\t\t SNDRV_PCM_INFO_MMAP_VALID),\n\t.period_bytes_min = 256,\n\t.period_bytes_max = 4 * 48 * 1024,\n\t.periods_min = 2,\n\t.periods_max = 256,\n\t.buffer_bytes_max = 4 * 48 * 1024,\n\t.fifo_size = 0,\n};\n\n \nstatic const struct snd_soc_dapm_route mtk_dai_hostless_routes[] = {\n\t \n\t{\"ADDA_DL_CH1\", \"ADDA_UL_CH1 Switch\", \"Hostless LPBK DL\"},\n\t{\"ADDA_DL_CH1\", \"ADDA_UL_CH2 Switch\", \"Hostless LPBK DL\"},\n\t{\"ADDA_DL_CH2\", \"ADDA_UL_CH1 Switch\", \"Hostless LPBK DL\"},\n\t{\"ADDA_DL_CH2\", \"ADDA_UL_CH2 Switch\", \"Hostless LPBK DL\"},\n\t{\"I2S1_CH1\", \"ADDA_UL_CH1 Switch\", \"Hostless LPBK DL\"},\n\t{\"I2S1_CH2\", \"ADDA_UL_CH2 Switch\", \"Hostless LPBK DL\"},\n\t{\"I2S3_CH1\", \"ADDA_UL_CH1 Switch\", \"Hostless LPBK DL\"},\n\t{\"I2S3_CH1\", \"ADDA_UL_CH2 Switch\", \"Hostless LPBK DL\"},\n\t{\"I2S3_CH2\", \"ADDA_UL_CH1 Switch\", \"Hostless LPBK DL\"},\n\t{\"I2S3_CH2\", \"ADDA_UL_CH2 Switch\", \"Hostless LPBK DL\"},\n\t{\"Hostless LPBK UL\", NULL, \"ADDA_UL_Mux\"},\n\n\t \n\t \n\t{\"Hostless FM UL\", NULL, \"Connsys I2S\"},\n\n\t{\"HW_GAIN1_IN_CH1\", \"CONNSYS_I2S_CH1 Switch\", \"Hostless FM DL\"},\n\t{\"HW_GAIN1_IN_CH2\", \"CONNSYS_I2S_CH2 Switch\", \"Hostless FM DL\"},\n\t \n\t{\"Hostless FM UL\", NULL, \"HW Gain 1 Out\"},\n\n\t{\"ADDA_DL_CH1\", \"GAIN1_OUT_CH1 Switch\", \"Hostless FM DL\"},\n\t{\"ADDA_DL_CH2\", \"GAIN1_OUT_CH2 Switch\", \"Hostless FM DL\"},\n\t \n\t{\"I2S3_CH1\", \"GAIN1_OUT_CH1 Switch\", \"Hostless FM DL\"},\n\t{\"I2S3_CH2\", \"GAIN1_OUT_CH2 Switch\", \"Hostless FM DL\"},\n\t \n\t{\"I2S1_CH1\", \"GAIN1_OUT_CH1 Switch\", \"Hostless FM DL\"},\n\t{\"I2S1_CH2\", \"GAIN1_OUT_CH2 Switch\", \"Hostless FM DL\"},\n\n\t \n\t{\"ADDA_DL_CH1\", \"SRC_1_OUT_CH1 Switch\", \"Hostless_SRC_1_DL\"},\n\t{\"ADDA_DL_CH2\", \"SRC_1_OUT_CH2 Switch\", \"Hostless_SRC_1_DL\"},\n\t{\"I2S1_CH1\", \"SRC_1_OUT_CH1 Switch\", \"Hostless_SRC_1_DL\"},\n\t{\"I2S1_CH2\", \"SRC_1_OUT_CH2 Switch\", \"Hostless_SRC_1_DL\"},\n\t{\"I2S3_CH1\", \"SRC_1_OUT_CH1 Switch\", \"Hostless_SRC_1_DL\"},\n\t{\"I2S3_CH2\", \"SRC_1_OUT_CH2 Switch\", \"Hostless_SRC_1_DL\"},\n\t{\"Hostless_SRC_1_UL\", NULL, \"HW_SRC_1_Out\"},\n\n\t \n\t{\"HW_SRC_1_IN_CH1\", \"I2S0_CH1 Switch\", \"Hostless_SRC_Bargein_DL\"},\n\t{\"HW_SRC_1_IN_CH2\", \"I2S0_CH2 Switch\", \"Hostless_SRC_Bargein_DL\"},\n\t{\"Hostless_SRC_Bargein_UL\", NULL, \"I2S0\"},\n\n\t \n\t{\"Hostless HW Gain AAudio In\", NULL, \"HW Gain 2 In\"},\n\t{\"Hostless SRC AAudio UL\", NULL, \"HW Gain 2 Out\"},\n\t{\"HW_SRC_2_IN_CH1\", \"HW_GAIN2_OUT_CH1 Switch\", \"Hostless SRC AAudio DL\"},\n\t{\"HW_SRC_2_IN_CH2\", \"HW_GAIN2_OUT_CH2 Switch\", \"Hostless SRC AAudio DL\"},\n};\n\n \nstatic int mtk_dai_hostless_startup(struct snd_pcm_substream *substream,\n\t\t\t\t    struct snd_soc_dai *dai)\n{\n\tstruct mtk_base_afe *afe = snd_soc_dai_get_drvdata(dai);\n\tstruct snd_pcm_runtime *runtime = substream->runtime;\n\tint ret;\n\n\tsnd_soc_set_runtime_hwparams(substream, &mt8186_hostless_hardware);\n\n\tret = snd_pcm_hw_constraint_integer(runtime,\n\t\t\t\t\t    SNDRV_PCM_HW_PARAM_PERIODS);\n\tif (ret < 0) {\n\t\tdev_err(afe->dev, \"snd_pcm_hw_constraint_integer failed\\n\");\n\t\treturn ret;\n\t}\n\n\treturn 0;\n}\n\nstatic const struct snd_soc_dai_ops mtk_dai_hostless_ops = {\n\t.startup = mtk_dai_hostless_startup,\n};\n\n \n#define MTK_HOSTLESS_RATES (SNDRV_PCM_RATE_8000_48000 |\\\n\t\t\t   SNDRV_PCM_RATE_88200 |\\\n\t\t\t   SNDRV_PCM_RATE_96000 |\\\n\t\t\t   SNDRV_PCM_RATE_176400 |\\\n\t\t\t   SNDRV_PCM_RATE_192000)\n\n#define MTK_HOSTLESS_FORMATS (SNDRV_PCM_FMTBIT_S16_LE |\\\n\t\t\t     SNDRV_PCM_FMTBIT_S24_LE |\\\n\t\t\t     SNDRV_PCM_FMTBIT_S32_LE)\n\nstatic struct snd_soc_dai_driver mtk_dai_hostless_driver[] = {\n\t{\n\t\t.name = \"Hostless LPBK DAI\",\n\t\t.id = MT8186_DAI_HOSTLESS_LPBK,\n\t\t.playback = {\n\t\t\t.stream_name = \"Hostless LPBK DL\",\n\t\t\t.channels_min = 1,\n\t\t\t.channels_max = 2,\n\t\t\t.rates = MTK_HOSTLESS_RATES,\n\t\t\t.formats = MTK_HOSTLESS_FORMATS,\n\t\t},\n\t\t.capture = {\n\t\t\t.stream_name = \"Hostless LPBK UL\",\n\t\t\t.channels_min = 1,\n\t\t\t.channels_max = 2,\n\t\t\t.rates = MTK_HOSTLESS_RATES,\n\t\t\t.formats = MTK_HOSTLESS_FORMATS,\n\t\t},\n\t\t.ops = &mtk_dai_hostless_ops,\n\t},\n\t{\n\t\t.name = \"Hostless FM DAI\",\n\t\t.id = MT8186_DAI_HOSTLESS_FM,\n\t\t.playback = {\n\t\t\t.stream_name = \"Hostless FM DL\",\n\t\t\t.channels_min = 1,\n\t\t\t.channels_max = 2,\n\t\t\t.rates = MTK_HOSTLESS_RATES,\n\t\t\t.formats = MTK_HOSTLESS_FORMATS,\n\t\t},\n\t\t.capture = {\n\t\t\t.stream_name = \"Hostless FM UL\",\n\t\t\t.channels_min = 1,\n\t\t\t.channels_max = 2,\n\t\t\t.rates = MTK_HOSTLESS_RATES,\n\t\t\t.formats = MTK_HOSTLESS_FORMATS,\n\t\t},\n\t\t.ops = &mtk_dai_hostless_ops,\n\t},\n\t{\n\t\t.name = \"Hostless_SRC_1_DAI\",\n\t\t.id = MT8186_DAI_HOSTLESS_SRC_1,\n\t\t.playback = {\n\t\t\t.stream_name = \"Hostless_SRC_1_DL\",\n\t\t\t.channels_min = 1,\n\t\t\t.channels_max = 2,\n\t\t\t.rates = MTK_HOSTLESS_RATES,\n\t\t\t.formats = MTK_HOSTLESS_FORMATS,\n\t\t},\n\t\t.capture = {\n\t\t\t.stream_name = \"Hostless_SRC_1_UL\",\n\t\t\t.channels_min = 1,\n\t\t\t.channels_max = 2,\n\t\t\t.rates = MTK_HOSTLESS_RATES,\n\t\t\t.formats = MTK_HOSTLESS_FORMATS,\n\t\t},\n\t\t.ops = &mtk_dai_hostless_ops,\n\t},\n\t{\n\t\t.name = \"Hostless_SRC_Bargein_DAI\",\n\t\t.id = MT8186_DAI_HOSTLESS_SRC_BARGEIN,\n\t\t.playback = {\n\t\t\t.stream_name = \"Hostless_SRC_Bargein_DL\",\n\t\t\t.channels_min = 1,\n\t\t\t.channels_max = 2,\n\t\t\t.rates = MTK_HOSTLESS_RATES,\n\t\t\t.formats = MTK_HOSTLESS_FORMATS,\n\t\t},\n\t\t.capture = {\n\t\t\t.stream_name = \"Hostless_SRC_Bargein_UL\",\n\t\t\t.channels_min = 1,\n\t\t\t.channels_max = 2,\n\t\t\t.rates = MTK_HOSTLESS_RATES,\n\t\t\t.formats = MTK_HOSTLESS_FORMATS,\n\t\t},\n\t\t.ops = &mtk_dai_hostless_ops,\n\t},\n\t \n\t{\n\t\t.name = \"Hostless_UL1 DAI\",\n\t\t.id = MT8186_DAI_HOSTLESS_UL1,\n\t\t.capture = {\n\t\t\t.stream_name = \"Hostless_UL1 UL\",\n\t\t\t.channels_min = 1,\n\t\t\t.channels_max = 4,\n\t\t\t.rates = MTK_HOSTLESS_RATES,\n\t\t\t.formats = MTK_HOSTLESS_FORMATS,\n\t\t},\n\t\t.ops = &mtk_dai_hostless_ops,\n\t},\n\t{\n\t\t.name = \"Hostless_UL2 DAI\",\n\t\t.id = MT8186_DAI_HOSTLESS_UL2,\n\t\t.capture = {\n\t\t\t.stream_name = \"Hostless_UL2 UL\",\n\t\t\t.channels_min = 1,\n\t\t\t.channels_max = 4,\n\t\t\t.rates = MTK_HOSTLESS_RATES,\n\t\t\t.formats = MTK_HOSTLESS_FORMATS,\n\t\t},\n\t\t.ops = &mtk_dai_hostless_ops,\n\t},\n\t{\n\t\t.name = \"Hostless_UL3 DAI\",\n\t\t.id = MT8186_DAI_HOSTLESS_UL3,\n\t\t.capture = {\n\t\t\t.stream_name = \"Hostless_UL3 UL\",\n\t\t\t.channels_min = 1,\n\t\t\t.channels_max = 2,\n\t\t\t.rates = MTK_HOSTLESS_RATES,\n\t\t\t.formats = MTK_HOSTLESS_FORMATS,\n\t\t},\n\t\t.ops = &mtk_dai_hostless_ops,\n\t},\n\t{\n\t\t.name = \"Hostless_UL5 DAI\",\n\t\t.id = MT8186_DAI_HOSTLESS_UL5,\n\t\t.capture = {\n\t\t\t.stream_name = \"Hostless_UL5 UL\",\n\t\t\t.channels_min = 1,\n\t\t\t.channels_max = 12,\n\t\t\t.rates = MTK_HOSTLESS_RATES,\n\t\t\t.formats = MTK_HOSTLESS_FORMATS,\n\t\t},\n\t\t.ops = &mtk_dai_hostless_ops,\n\t},\n\t{\n\t\t.name = \"Hostless_UL6 DAI\",\n\t\t.id = MT8186_DAI_HOSTLESS_UL6,\n\t\t.capture = {\n\t\t\t.stream_name = \"Hostless_UL6 UL\",\n\t\t\t.channels_min = 1,\n\t\t\t.channels_max = 2,\n\t\t\t.rates = MTK_HOSTLESS_RATES,\n\t\t\t.formats = MTK_HOSTLESS_FORMATS,\n\t\t},\n\t\t.ops = &mtk_dai_hostless_ops,\n\t},\n\t{\n\t\t.name = \"Hostless HW Gain AAudio DAI\",\n\t\t.id = MT8186_DAI_HOSTLESS_HW_GAIN_AAUDIO,\n\t\t.capture = {\n\t\t\t.stream_name = \"Hostless HW Gain AAudio In\",\n\t\t\t.channels_min = 1,\n\t\t\t.channels_max = 2,\n\t\t\t.rates = MTK_HOSTLESS_RATES,\n\t\t\t.formats = MTK_HOSTLESS_FORMATS,\n\t\t},\n\t\t.ops = &mtk_dai_hostless_ops,\n\t},\n\t{\n\t\t.name = \"Hostless SRC AAudio DAI\",\n\t\t.id = MT8186_DAI_HOSTLESS_SRC_AAUDIO,\n\t\t.playback = {\n\t\t\t.stream_name = \"Hostless SRC AAudio DL\",\n\t\t\t.channels_min = 1,\n\t\t\t.channels_max = 2,\n\t\t\t.rates = MTK_HOSTLESS_RATES,\n\t\t\t.formats = MTK_HOSTLESS_FORMATS,\n\t\t},\n\t\t.capture = {\n\t\t\t.stream_name = \"Hostless SRC AAudio UL\",\n\t\t\t.channels_min = 1,\n\t\t\t.channels_max = 2,\n\t\t\t.rates = MTK_HOSTLESS_RATES,\n\t\t\t.formats = MTK_HOSTLESS_FORMATS,\n\t\t},\n\t\t.ops = &mtk_dai_hostless_ops,\n\t},\n};\n\nint mt8186_dai_hostless_register(struct mtk_base_afe *afe)\n{\n\tstruct mtk_base_afe_dai *dai;\n\n\tdai = devm_kzalloc(afe->dev, sizeof(*dai), GFP_KERNEL);\n\tif (!dai)\n\t\treturn -ENOMEM;\n\n\tlist_add(&dai->list, &afe->sub_dais);\n\n\tdai->dai_drivers = mtk_dai_hostless_driver;\n\tdai->num_dai_drivers = ARRAY_SIZE(mtk_dai_hostless_driver);\n\n\tdai->dapm_routes = mtk_dai_hostless_routes;\n\tdai->num_dapm_routes = ARRAY_SIZE(mtk_dai_hostless_routes);\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}