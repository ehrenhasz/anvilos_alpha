{
  "module_name": "mt6797-mt6351.c",
  "hash_id": "6b8b94b02346d5df67cba4480d059b9bd6f57c4acecc3357235ff45842219b62",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/mediatek/mt6797/mt6797-mt6351.c",
  "human_readable_source": "\n\n\n\n\n\n\n#include <linux/module.h>\n#include <sound/soc.h>\n\n#include \"mt6797-afe-common.h\"\n\nSND_SOC_DAILINK_DEFS(playback_1,\n\tDAILINK_COMP_ARRAY(COMP_CPU(\"DL1\")),\n\tDAILINK_COMP_ARRAY(COMP_DUMMY()),\n\tDAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(playback_2,\n\tDAILINK_COMP_ARRAY(COMP_CPU(\"DL2\")),\n\tDAILINK_COMP_ARRAY(COMP_DUMMY()),\n\tDAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(playback_3,\n\tDAILINK_COMP_ARRAY(COMP_CPU(\"DL3\")),\n\tDAILINK_COMP_ARRAY(COMP_DUMMY()),\n\tDAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(capture_1,\n\tDAILINK_COMP_ARRAY(COMP_CPU(\"UL1\")),\n\tDAILINK_COMP_ARRAY(COMP_DUMMY()),\n\tDAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(capture_2,\n\tDAILINK_COMP_ARRAY(COMP_CPU(\"UL2\")),\n\tDAILINK_COMP_ARRAY(COMP_DUMMY()),\n\tDAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(capture_3,\n\tDAILINK_COMP_ARRAY(COMP_CPU(\"UL3\")),\n\tDAILINK_COMP_ARRAY(COMP_DUMMY()),\n\tDAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(capture_mono_1,\n\tDAILINK_COMP_ARRAY(COMP_CPU(\"UL_MONO_1\")),\n\tDAILINK_COMP_ARRAY(COMP_DUMMY()),\n\tDAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(hostless_lpbk,\n\tDAILINK_COMP_ARRAY(COMP_CPU(\"Hostless LPBK DAI\")),\n\tDAILINK_COMP_ARRAY(COMP_DUMMY()),\n\tDAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(hostless_speech,\n\tDAILINK_COMP_ARRAY(COMP_CPU(\"Hostless Speech DAI\")),\n\tDAILINK_COMP_ARRAY(COMP_DUMMY()),\n\tDAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(primary_codec,\n\tDAILINK_COMP_ARRAY(COMP_CPU(\"ADDA\")),\n\tDAILINK_COMP_ARRAY(COMP_CODEC(NULL, \"mt6351-snd-codec-aif1\")),\n\tDAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(pcm1,\n\tDAILINK_COMP_ARRAY(COMP_CPU(\"PCM 1\")),\n\tDAILINK_COMP_ARRAY(COMP_DUMMY()),\n\tDAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(pcm2,\n\tDAILINK_COMP_ARRAY(COMP_CPU(\"PCM 2\")),\n\tDAILINK_COMP_ARRAY(COMP_DUMMY()),\n\tDAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nstatic struct snd_soc_dai_link mt6797_mt6351_dai_links[] = {\n\t \n\t{\n\t\t.name = \"Playback_1\",\n\t\t.stream_name = \"Playback_1\",\n\t\t.trigger = {SND_SOC_DPCM_TRIGGER_PRE,\n\t\t\t    SND_SOC_DPCM_TRIGGER_PRE},\n\t\t.dynamic = 1,\n\t\t.dpcm_playback = 1,\n\t\tSND_SOC_DAILINK_REG(playback_1),\n\t},\n\t{\n\t\t.name = \"Playback_2\",\n\t\t.stream_name = \"Playback_2\",\n\t\t.trigger = {SND_SOC_DPCM_TRIGGER_PRE,\n\t\t\t    SND_SOC_DPCM_TRIGGER_PRE},\n\t\t.dynamic = 1,\n\t\t.dpcm_playback = 1,\n\t\tSND_SOC_DAILINK_REG(playback_2),\n\t},\n\t{\n\t\t.name = \"Playback_3\",\n\t\t.stream_name = \"Playback_3\",\n\t\t.trigger = {SND_SOC_DPCM_TRIGGER_PRE,\n\t\t\t    SND_SOC_DPCM_TRIGGER_PRE},\n\t\t.dynamic = 1,\n\t\t.dpcm_playback = 1,\n\t\tSND_SOC_DAILINK_REG(playback_3),\n\t},\n\t{\n\t\t.name = \"Capture_1\",\n\t\t.stream_name = \"Capture_1\",\n\t\t.trigger = {SND_SOC_DPCM_TRIGGER_PRE,\n\t\t\t    SND_SOC_DPCM_TRIGGER_PRE},\n\t\t.dynamic = 1,\n\t\t.dpcm_capture = 1,\n\t\tSND_SOC_DAILINK_REG(capture_1),\n\t},\n\t{\n\t\t.name = \"Capture_2\",\n\t\t.stream_name = \"Capture_2\",\n\t\t.trigger = {SND_SOC_DPCM_TRIGGER_PRE,\n\t\t\t    SND_SOC_DPCM_TRIGGER_PRE},\n\t\t.dynamic = 1,\n\t\t.dpcm_capture = 1,\n\t\tSND_SOC_DAILINK_REG(capture_2),\n\t},\n\t{\n\t\t.name = \"Capture_3\",\n\t\t.stream_name = \"Capture_3\",\n\t\t.trigger = {SND_SOC_DPCM_TRIGGER_PRE,\n\t\t\t    SND_SOC_DPCM_TRIGGER_PRE},\n\t\t.dynamic = 1,\n\t\t.dpcm_capture = 1,\n\t\tSND_SOC_DAILINK_REG(capture_3),\n\t},\n\t{\n\t\t.name = \"Capture_Mono_1\",\n\t\t.stream_name = \"Capture_Mono_1\",\n\t\t.trigger = {SND_SOC_DPCM_TRIGGER_PRE,\n\t\t\t    SND_SOC_DPCM_TRIGGER_PRE},\n\t\t.dynamic = 1,\n\t\t.dpcm_capture = 1,\n\t\tSND_SOC_DAILINK_REG(capture_mono_1),\n\t},\n\t{\n\t\t.name = \"Hostless_LPBK\",\n\t\t.stream_name = \"Hostless_LPBK\",\n\t\t.trigger = {SND_SOC_DPCM_TRIGGER_PRE,\n\t\t\t    SND_SOC_DPCM_TRIGGER_PRE},\n\t\t.dynamic = 1,\n\t\t.dpcm_playback = 1,\n\t\t.dpcm_capture = 1,\n\t\t.ignore_suspend = 1,\n\t\tSND_SOC_DAILINK_REG(hostless_lpbk),\n\t},\n\t{\n\t\t.name = \"Hostless_Speech\",\n\t\t.stream_name = \"Hostless_Speech\",\n\t\t.trigger = {SND_SOC_DPCM_TRIGGER_PRE,\n\t\t\t    SND_SOC_DPCM_TRIGGER_PRE},\n\t\t.dynamic = 1,\n\t\t.dpcm_playback = 1,\n\t\t.dpcm_capture = 1,\n\t\t.ignore_suspend = 1,\n\t\tSND_SOC_DAILINK_REG(hostless_speech),\n\t},\n\t \n\t{\n\t\t.name = \"Primary Codec\",\n\t\t.no_pcm = 1,\n\t\t.dpcm_playback = 1,\n\t\t.dpcm_capture = 1,\n\t\t.ignore_suspend = 1,\n\t\tSND_SOC_DAILINK_REG(primary_codec),\n\t},\n\t{\n\t\t.name = \"PCM 1\",\n\t\t.no_pcm = 1,\n\t\t.dpcm_playback = 1,\n\t\t.dpcm_capture = 1,\n\t\t.ignore_suspend = 1,\n\t\tSND_SOC_DAILINK_REG(pcm1),\n\t},\n\t{\n\t\t.name = \"PCM 2\",\n\t\t.no_pcm = 1,\n\t\t.dpcm_playback = 1,\n\t\t.dpcm_capture = 1,\n\t\t.ignore_suspend = 1,\n\t\tSND_SOC_DAILINK_REG(pcm2),\n\t},\n};\n\nstatic struct snd_soc_card mt6797_mt6351_card = {\n\t.name = \"mt6797-mt6351\",\n\t.owner = THIS_MODULE,\n\t.dai_link = mt6797_mt6351_dai_links,\n\t.num_links = ARRAY_SIZE(mt6797_mt6351_dai_links),\n};\n\nstatic int mt6797_mt6351_dev_probe(struct platform_device *pdev)\n{\n\tstruct snd_soc_card *card = &mt6797_mt6351_card;\n\tstruct device_node *platform_node, *codec_node;\n\tstruct snd_soc_dai_link *dai_link;\n\tint ret, i;\n\n\tcard->dev = &pdev->dev;\n\n\tplatform_node = of_parse_phandle(pdev->dev.of_node,\n\t\t\t\t\t \"mediatek,platform\", 0);\n\tif (!platform_node) {\n\t\tdev_err(&pdev->dev, \"Property 'platform' missing or invalid\\n\");\n\t\treturn -EINVAL;\n\t}\n\tfor_each_card_prelinks(card, i, dai_link) {\n\t\tif (dai_link->platforms->name)\n\t\t\tcontinue;\n\t\tdai_link->platforms->of_node = platform_node;\n\t}\n\n\tcodec_node = of_parse_phandle(pdev->dev.of_node,\n\t\t\t\t      \"mediatek,audio-codec\", 0);\n\tif (!codec_node) {\n\t\tdev_err(&pdev->dev,\n\t\t\t\"Property 'audio-codec' missing or invalid\\n\");\n\t\tret = -EINVAL;\n\t\tgoto put_platform_node;\n\t}\n\tfor_each_card_prelinks(card, i, dai_link) {\n\t\tif (dai_link->codecs->name)\n\t\t\tcontinue;\n\t\tdai_link->codecs->of_node = codec_node;\n\t}\n\n\tret = devm_snd_soc_register_card(&pdev->dev, card);\n\tif (ret)\n\t\tdev_err(&pdev->dev, \"%s snd_soc_register_card fail %d\\n\",\n\t\t\t__func__, ret);\n\n\tof_node_put(codec_node);\nput_platform_node:\n\tof_node_put(platform_node);\n\treturn ret;\n}\n\n#ifdef CONFIG_OF\nstatic const struct of_device_id mt6797_mt6351_dt_match[] = {\n\t{.compatible = \"mediatek,mt6797-mt6351-sound\",},\n\t{}\n};\nMODULE_DEVICE_TABLE(of, mt6797_mt6351_dt_match);\n#endif\n\nstatic struct platform_driver mt6797_mt6351_driver = {\n\t.driver = {\n\t\t.name = \"mt6797-mt6351\",\n#ifdef CONFIG_OF\n\t\t.of_match_table = mt6797_mt6351_dt_match,\n#endif\n\t},\n\t.probe = mt6797_mt6351_dev_probe,\n};\n\nmodule_platform_driver(mt6797_mt6351_driver);\n\n \nMODULE_DESCRIPTION(\"MT6797 MT6351 ALSA SoC machine driver\");\nMODULE_AUTHOR(\"KaiChieh Chuang <kaichieh.chuang@mediatek.com>\");\nMODULE_LICENSE(\"GPL v2\");\nMODULE_ALIAS(\"mt6797 mt6351 soc card\");\n\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}