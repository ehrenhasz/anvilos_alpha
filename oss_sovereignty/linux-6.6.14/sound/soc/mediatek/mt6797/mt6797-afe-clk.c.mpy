{
  "module_name": "mt6797-afe-clk.c",
  "hash_id": "163848a4ab04b862bedd887a16854933b02a8b62f7daa6a05ed29fbef5269f9d",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/mediatek/mt6797/mt6797-afe-clk.c",
  "human_readable_source": "\n\n\n\n\n\n\n#include <linux/clk.h>\n\n#include \"mt6797-afe-common.h\"\n#include \"mt6797-afe-clk.h\"\n\nenum {\n\tCLK_INFRA_SYS_AUD,\n\tCLK_INFRA_SYS_AUD_26M,\n\tCLK_TOP_MUX_AUD,\n\tCLK_TOP_MUX_AUD_BUS,\n\tCLK_TOP_SYSPLL3_D4,\n\tCLK_TOP_SYSPLL1_D4,\n\tCLK_CLK26M,\n\tCLK_NUM\n};\n\nstatic const char *aud_clks[CLK_NUM] = {\n\t[CLK_INFRA_SYS_AUD] = \"infra_sys_audio_clk\",\n\t[CLK_INFRA_SYS_AUD_26M] = \"infra_sys_audio_26m\",\n\t[CLK_TOP_MUX_AUD] = \"top_mux_audio\",\n\t[CLK_TOP_MUX_AUD_BUS] = \"top_mux_aud_intbus\",\n\t[CLK_TOP_SYSPLL3_D4] = \"top_sys_pll3_d4\",\n\t[CLK_TOP_SYSPLL1_D4] = \"top_sys_pll1_d4\",\n\t[CLK_CLK26M] = \"top_clk26m_clk\",\n};\n\nint mt6797_init_clock(struct mtk_base_afe *afe)\n{\n\tstruct mt6797_afe_private *afe_priv = afe->platform_priv;\n\tint i;\n\n\tafe_priv->clk = devm_kcalloc(afe->dev, CLK_NUM, sizeof(*afe_priv->clk),\n\t\t\t\t     GFP_KERNEL);\n\tif (!afe_priv->clk)\n\t\treturn -ENOMEM;\n\n\tfor (i = 0; i < CLK_NUM; i++) {\n\t\tafe_priv->clk[i] = devm_clk_get(afe->dev, aud_clks[i]);\n\t\tif (IS_ERR(afe_priv->clk[i])) {\n\t\t\tdev_err(afe->dev, \"%s(), devm_clk_get %s fail, ret %ld\\n\",\n\t\t\t\t__func__, aud_clks[i],\n\t\t\t\tPTR_ERR(afe_priv->clk[i]));\n\t\t\treturn PTR_ERR(afe_priv->clk[i]);\n\t\t}\n\t}\n\n\treturn 0;\n}\n\nint mt6797_afe_enable_clock(struct mtk_base_afe *afe)\n{\n\tstruct mt6797_afe_private *afe_priv = afe->platform_priv;\n\tint ret;\n\n\tret = clk_prepare_enable(afe_priv->clk[CLK_INFRA_SYS_AUD]);\n\tif (ret) {\n\t\tdev_err(afe->dev, \"%s(), clk_prepare_enable %s fail %d\\n\",\n\t\t\t__func__, aud_clks[CLK_INFRA_SYS_AUD], ret);\n\t\tgoto CLK_INFRA_SYS_AUDIO_ERR;\n\t}\n\n\tret = clk_prepare_enable(afe_priv->clk[CLK_INFRA_SYS_AUD_26M]);\n\tif (ret) {\n\t\tdev_err(afe->dev, \"%s(), clk_prepare_enable %s fail %d\\n\",\n\t\t\t__func__, aud_clks[CLK_INFRA_SYS_AUD_26M], ret);\n\t\tgoto CLK_INFRA_SYS_AUD_26M_ERR;\n\t}\n\n\tret = clk_prepare_enable(afe_priv->clk[CLK_TOP_MUX_AUD]);\n\tif (ret) {\n\t\tdev_err(afe->dev, \"%s(), clk_prepare_enable %s fail %d\\n\",\n\t\t\t__func__, aud_clks[CLK_TOP_MUX_AUD], ret);\n\t\tgoto CLK_MUX_AUDIO_ERR;\n\t}\n\n\tret = clk_set_parent(afe_priv->clk[CLK_TOP_MUX_AUD],\n\t\t\t     afe_priv->clk[CLK_CLK26M]);\n\tif (ret) {\n\t\tdev_err(afe->dev, \"%s(), clk_set_parent %s-%s fail %d\\n\",\n\t\t\t__func__, aud_clks[CLK_TOP_MUX_AUD],\n\t\t\taud_clks[CLK_CLK26M], ret);\n\t\tgoto CLK_MUX_AUDIO_ERR;\n\t}\n\n\tret = clk_prepare_enable(afe_priv->clk[CLK_TOP_MUX_AUD_BUS]);\n\tif (ret) {\n\t\tdev_err(afe->dev, \"%s(), clk_prepare_enable %s fail %d\\n\",\n\t\t\t__func__, aud_clks[CLK_TOP_MUX_AUD_BUS], ret);\n\t\tgoto CLK_MUX_AUDIO_INTBUS_ERR;\n\t}\n\n\treturn ret;\n\nCLK_MUX_AUDIO_INTBUS_ERR:\n\tclk_disable_unprepare(afe_priv->clk[CLK_TOP_MUX_AUD_BUS]);\nCLK_MUX_AUDIO_ERR:\n\tclk_disable_unprepare(afe_priv->clk[CLK_TOP_MUX_AUD]);\nCLK_INFRA_SYS_AUD_26M_ERR:\n\tclk_disable_unprepare(afe_priv->clk[CLK_INFRA_SYS_AUD_26M]);\nCLK_INFRA_SYS_AUDIO_ERR:\n\tclk_disable_unprepare(afe_priv->clk[CLK_INFRA_SYS_AUD]);\n\n\treturn 0;\n}\n\nint mt6797_afe_disable_clock(struct mtk_base_afe *afe)\n{\n\tstruct mt6797_afe_private *afe_priv = afe->platform_priv;\n\n\tclk_disable_unprepare(afe_priv->clk[CLK_TOP_MUX_AUD_BUS]);\n\tclk_disable_unprepare(afe_priv->clk[CLK_TOP_MUX_AUD]);\n\tclk_disable_unprepare(afe_priv->clk[CLK_INFRA_SYS_AUD_26M]);\n\tclk_disable_unprepare(afe_priv->clk[CLK_INFRA_SYS_AUD]);\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}