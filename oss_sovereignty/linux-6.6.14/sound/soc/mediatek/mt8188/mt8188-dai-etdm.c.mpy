{
  "module_name": "mt8188-dai-etdm.c",
  "hash_id": "e6a5e8d6331a9af24d43285a7657ab07a2befccedf6944a0f4add176227916e3",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/mediatek/mt8188/mt8188-dai-etdm.c",
  "human_readable_source": "\n \n\n#include <linux/bitfield.h>\n#include <linux/pm_runtime.h>\n#include <linux/regmap.h>\n#include <sound/pcm_params.h>\n#include \"mt8188-afe-clk.h\"\n#include \"mt8188-afe-common.h\"\n#include \"mt8188-reg.h\"\n\n#define MT8188_ETDM_MAX_CHANNELS 16\n#define MT8188_ETDM_NORMAL_MAX_BCK_RATE 24576000\n#define ETDM_TO_DAI_ID(x) ((x) + MT8188_AFE_IO_ETDM_START)\n#define ENUM_TO_STR(x)\t#x\n\nenum {\n\tSUPPLY_SEQ_APLL,\n\tSUPPLY_SEQ_ETDM_MCLK,\n\tSUPPLY_SEQ_ETDM_CG,\n\tSUPPLY_SEQ_DPTX_EN,\n\tSUPPLY_SEQ_ETDM_EN,\n};\n\nenum {\n\tMTK_DAI_ETDM_FORMAT_I2S = 0,\n\tMTK_DAI_ETDM_FORMAT_LJ,\n\tMTK_DAI_ETDM_FORMAT_RJ,\n\tMTK_DAI_ETDM_FORMAT_EIAJ,\n\tMTK_DAI_ETDM_FORMAT_DSPA,\n\tMTK_DAI_ETDM_FORMAT_DSPB,\n};\n\nenum {\n\tMTK_DAI_ETDM_DATA_ONE_PIN = 0,\n\tMTK_DAI_ETDM_DATA_MULTI_PIN,\n};\n\nenum {\n\tETDM_IN,\n\tETDM_OUT,\n};\n\nenum {\n\tCOWORK_ETDM_NONE = 0,\n\tCOWORK_ETDM_IN1_M = 2,\n\tCOWORK_ETDM_IN1_S = 3,\n\tCOWORK_ETDM_IN2_M = 4,\n\tCOWORK_ETDM_IN2_S = 5,\n\tCOWORK_ETDM_OUT1_M = 10,\n\tCOWORK_ETDM_OUT1_S = 11,\n\tCOWORK_ETDM_OUT2_M = 12,\n\tCOWORK_ETDM_OUT2_S = 13,\n\tCOWORK_ETDM_OUT3_M = 14,\n\tCOWORK_ETDM_OUT3_S = 15,\n};\n\nenum {\n\tETDM_RELATCH_TIMING_A1A2SYS,\n\tETDM_RELATCH_TIMING_A3SYS,\n\tETDM_RELATCH_TIMING_A4SYS,\n};\n\nenum {\n\tETDM_SYNC_NONE,\n\tETDM_SYNC_FROM_IN1 = 2,\n\tETDM_SYNC_FROM_IN2 = 4,\n\tETDM_SYNC_FROM_OUT1 = 10,\n\tETDM_SYNC_FROM_OUT2 = 12,\n\tETDM_SYNC_FROM_OUT3 = 14,\n};\n\nstruct etdm_con_reg {\n\tunsigned int con0;\n\tunsigned int con1;\n\tunsigned int con2;\n\tunsigned int con3;\n\tunsigned int con4;\n\tunsigned int con5;\n};\n\nstruct mtk_dai_etdm_rate {\n\tunsigned int rate;\n\tunsigned int reg_value;\n};\n\nstruct mtk_dai_etdm_priv {\n\tunsigned int data_mode;\n\tbool slave_mode;\n\tbool lrck_inv;\n\tbool bck_inv;\n\tunsigned int rate;\n\tunsigned int format;\n\tunsigned int slots;\n\tunsigned int lrck_width;\n\tunsigned int mclk_freq;\n\tunsigned int mclk_fixed_apll;\n\tunsigned int mclk_apll;\n\tunsigned int mclk_dir;\n\tint cowork_source_id; \n\tunsigned int cowork_slv_count;\n\tint cowork_slv_id[MT8188_AFE_IO_ETDM_NUM - 1]; \n\tbool in_disable_ch[MT8188_ETDM_MAX_CHANNELS];\n};\n\nstatic const struct mtk_dai_etdm_rate mt8188_etdm_rates[] = {\n\t{ .rate = 8000, .reg_value = 0, },\n\t{ .rate = 12000, .reg_value = 1, },\n\t{ .rate = 16000, .reg_value = 2, },\n\t{ .rate = 24000, .reg_value = 3, },\n\t{ .rate = 32000, .reg_value = 4, },\n\t{ .rate = 48000, .reg_value = 5, },\n\t{ .rate = 96000, .reg_value = 7, },\n\t{ .rate = 192000, .reg_value = 9, },\n\t{ .rate = 384000, .reg_value = 11, },\n\t{ .rate = 11025, .reg_value = 16, },\n\t{ .rate = 22050, .reg_value = 17, },\n\t{ .rate = 44100, .reg_value = 18, },\n\t{ .rate = 88200, .reg_value = 19, },\n\t{ .rate = 176400, .reg_value = 20, },\n\t{ .rate = 352800, .reg_value = 21, },\n};\n\nstatic int get_etdm_fs_timing(unsigned int rate)\n{\n\tint i;\n\n\tfor (i = 0; i < ARRAY_SIZE(mt8188_etdm_rates); i++)\n\t\tif (mt8188_etdm_rates[i].rate == rate)\n\t\t\treturn mt8188_etdm_rates[i].reg_value;\n\n\treturn -EINVAL;\n}\n\nstatic unsigned int get_etdm_ch_fixup(unsigned int channels)\n{\n\tif (channels > 16)\n\t\treturn 24;\n\telse if (channels > 8)\n\t\treturn 16;\n\telse if (channels > 4)\n\t\treturn 8;\n\telse if (channels > 2)\n\t\treturn 4;\n\telse\n\t\treturn 2;\n}\n\nstatic int get_etdm_reg(unsigned int dai_id, struct etdm_con_reg *etdm_reg)\n{\n\tswitch (dai_id) {\n\tcase MT8188_AFE_IO_ETDM1_IN:\n\t\tetdm_reg->con0 = ETDM_IN1_CON0;\n\t\tetdm_reg->con1 = ETDM_IN1_CON1;\n\t\tetdm_reg->con2 = ETDM_IN1_CON2;\n\t\tetdm_reg->con3 = ETDM_IN1_CON3;\n\t\tetdm_reg->con4 = ETDM_IN1_CON4;\n\t\tetdm_reg->con5 = ETDM_IN1_CON5;\n\t\tbreak;\n\tcase MT8188_AFE_IO_ETDM2_IN:\n\t\tetdm_reg->con0 = ETDM_IN2_CON0;\n\t\tetdm_reg->con1 = ETDM_IN2_CON1;\n\t\tetdm_reg->con2 = ETDM_IN2_CON2;\n\t\tetdm_reg->con3 = ETDM_IN2_CON3;\n\t\tetdm_reg->con4 = ETDM_IN2_CON4;\n\t\tetdm_reg->con5 = ETDM_IN2_CON5;\n\t\tbreak;\n\tcase MT8188_AFE_IO_ETDM1_OUT:\n\t\tetdm_reg->con0 = ETDM_OUT1_CON0;\n\t\tetdm_reg->con1 = ETDM_OUT1_CON1;\n\t\tetdm_reg->con2 = ETDM_OUT1_CON2;\n\t\tetdm_reg->con3 = ETDM_OUT1_CON3;\n\t\tetdm_reg->con4 = ETDM_OUT1_CON4;\n\t\tetdm_reg->con5 = ETDM_OUT1_CON5;\n\t\tbreak;\n\tcase MT8188_AFE_IO_ETDM2_OUT:\n\t\tetdm_reg->con0 = ETDM_OUT2_CON0;\n\t\tetdm_reg->con1 = ETDM_OUT2_CON1;\n\t\tetdm_reg->con2 = ETDM_OUT2_CON2;\n\t\tetdm_reg->con3 = ETDM_OUT2_CON3;\n\t\tetdm_reg->con4 = ETDM_OUT2_CON4;\n\t\tetdm_reg->con5 = ETDM_OUT2_CON5;\n\t\tbreak;\n\tcase MT8188_AFE_IO_ETDM3_OUT:\n\tcase MT8188_AFE_IO_DPTX:\n\t\tetdm_reg->con0 = ETDM_OUT3_CON0;\n\t\tetdm_reg->con1 = ETDM_OUT3_CON1;\n\t\tetdm_reg->con2 = ETDM_OUT3_CON2;\n\t\tetdm_reg->con3 = ETDM_OUT3_CON3;\n\t\tetdm_reg->con4 = ETDM_OUT3_CON4;\n\t\tetdm_reg->con5 = ETDM_OUT3_CON5;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\treturn 0;\n}\n\nstatic int get_etdm_dir(unsigned int dai_id)\n{\n\tswitch (dai_id) {\n\tcase MT8188_AFE_IO_ETDM1_IN:\n\tcase MT8188_AFE_IO_ETDM2_IN:\n\t\treturn ETDM_IN;\n\tcase MT8188_AFE_IO_ETDM1_OUT:\n\tcase MT8188_AFE_IO_ETDM2_OUT:\n\tcase MT8188_AFE_IO_ETDM3_OUT:\n\t\treturn ETDM_OUT;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n}\n\nstatic int get_etdm_wlen(unsigned int bitwidth)\n{\n\treturn bitwidth <= 16 ? 16 : 32;\n}\n\nstatic bool is_valid_etdm_dai(int dai_id)\n{\n\tswitch (dai_id) {\n\tcase MT8188_AFE_IO_ETDM1_IN:\n\t\tfallthrough;\n\tcase MT8188_AFE_IO_ETDM2_IN:\n\t\tfallthrough;\n\tcase MT8188_AFE_IO_ETDM1_OUT:\n\t\tfallthrough;\n\tcase MT8188_AFE_IO_ETDM2_OUT:\n\t\tfallthrough;\n\tcase MT8188_AFE_IO_DPTX:\n\t\tfallthrough;\n\tcase MT8188_AFE_IO_ETDM3_OUT:\n\t\treturn true;\n\tdefault:\n\t\treturn false;\n\t}\n}\n\nstatic int is_cowork_mode(struct snd_soc_dai *dai)\n{\n\tstruct mtk_base_afe *afe = snd_soc_dai_get_drvdata(dai);\n\tstruct mt8188_afe_private *afe_priv = afe->platform_priv;\n\tstruct mtk_dai_etdm_priv *etdm_data;\n\n\tif (!is_valid_etdm_dai(dai->id))\n\t\treturn -EINVAL;\n\tetdm_data = afe_priv->dai_priv[dai->id];\n\n\treturn (etdm_data->cowork_slv_count > 0 ||\n\t\tetdm_data->cowork_source_id != COWORK_ETDM_NONE);\n}\n\nstatic int sync_to_dai_id(int source_sel)\n{\n\tswitch (source_sel) {\n\tcase ETDM_SYNC_FROM_IN1:\n\t\treturn MT8188_AFE_IO_ETDM1_IN;\n\tcase ETDM_SYNC_FROM_IN2:\n\t\treturn MT8188_AFE_IO_ETDM2_IN;\n\tcase ETDM_SYNC_FROM_OUT1:\n\t\treturn MT8188_AFE_IO_ETDM1_OUT;\n\tcase ETDM_SYNC_FROM_OUT2:\n\t\treturn MT8188_AFE_IO_ETDM2_OUT;\n\tcase ETDM_SYNC_FROM_OUT3:\n\t\treturn MT8188_AFE_IO_ETDM3_OUT;\n\tdefault:\n\t\treturn 0;\n\t}\n}\n\nstatic int get_etdm_cowork_master_id(struct snd_soc_dai *dai)\n{\n\tstruct mtk_base_afe *afe = snd_soc_dai_get_drvdata(dai);\n\tstruct mt8188_afe_private *afe_priv = afe->platform_priv;\n\tstruct mtk_dai_etdm_priv *etdm_data;\n\tint dai_id;\n\n\tif (!is_valid_etdm_dai(dai->id))\n\t\treturn -EINVAL;\n\tetdm_data = afe_priv->dai_priv[dai->id];\n\tdai_id = etdm_data->cowork_source_id;\n\n\tif (dai_id == COWORK_ETDM_NONE)\n\t\tdai_id = dai->id;\n\n\treturn dai_id;\n}\n\nstatic int mtk_dai_etdm_get_cg_id_by_dai_id(int dai_id)\n{\n\tswitch (dai_id) {\n\tcase MT8188_AFE_IO_DPTX:\n\t\treturn MT8188_CLK_AUD_HDMI_OUT;\n\tcase MT8188_AFE_IO_ETDM1_IN:\n\t\treturn MT8188_CLK_AUD_TDM_IN;\n\tcase MT8188_AFE_IO_ETDM2_IN:\n\t\treturn MT8188_CLK_AUD_I2SIN;\n\tcase MT8188_AFE_IO_ETDM1_OUT:\n\t\treturn MT8188_CLK_AUD_TDM_OUT;\n\tcase MT8188_AFE_IO_ETDM2_OUT:\n\t\treturn MT8188_CLK_AUD_I2S_OUT;\n\tcase MT8188_AFE_IO_ETDM3_OUT:\n\t\treturn MT8188_CLK_AUD_HDMI_OUT;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n}\n\nstatic int mtk_dai_etdm_get_clk_id_by_dai_id(int dai_id)\n{\n\tswitch (dai_id) {\n\tcase MT8188_AFE_IO_DPTX:\n\t\treturn MT8188_CLK_TOP_DPTX_M_SEL;\n\tcase MT8188_AFE_IO_ETDM1_IN:\n\t\treturn MT8188_CLK_TOP_I2SI1_M_SEL;\n\tcase MT8188_AFE_IO_ETDM2_IN:\n\t\treturn MT8188_CLK_TOP_I2SI2_M_SEL;\n\tcase MT8188_AFE_IO_ETDM1_OUT:\n\t\treturn MT8188_CLK_TOP_I2SO1_M_SEL;\n\tcase MT8188_AFE_IO_ETDM2_OUT:\n\t\treturn MT8188_CLK_TOP_I2SO2_M_SEL;\n\tcase MT8188_AFE_IO_ETDM3_OUT:\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n}\n\nstatic int mtk_dai_etdm_get_clkdiv_id_by_dai_id(int dai_id)\n{\n\tswitch (dai_id) {\n\tcase MT8188_AFE_IO_DPTX:\n\t\treturn MT8188_CLK_TOP_APLL12_DIV9;\n\tcase MT8188_AFE_IO_ETDM1_IN:\n\t\treturn MT8188_CLK_TOP_APLL12_DIV0;\n\tcase MT8188_AFE_IO_ETDM2_IN:\n\t\treturn MT8188_CLK_TOP_APLL12_DIV1;\n\tcase MT8188_AFE_IO_ETDM1_OUT:\n\t\treturn MT8188_CLK_TOP_APLL12_DIV2;\n\tcase MT8188_AFE_IO_ETDM2_OUT:\n\t\treturn MT8188_CLK_TOP_APLL12_DIV3;\n\tcase MT8188_AFE_IO_ETDM3_OUT:\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n}\n\nstatic int get_etdm_id_by_name(struct mtk_base_afe *afe,\n\t\t\t       const char *name)\n{\n\tif (!strncmp(name, \"ETDM1_IN\", strlen(\"ETDM1_IN\")))\n\t\treturn MT8188_AFE_IO_ETDM1_IN;\n\telse if (!strncmp(name, \"ETDM2_IN\", strlen(\"ETDM2_IN\")))\n\t\treturn MT8188_AFE_IO_ETDM2_IN;\n\telse if (!strncmp(name, \"ETDM1_OUT\", strlen(\"ETDM1_OUT\")))\n\t\treturn MT8188_AFE_IO_ETDM1_OUT;\n\telse if (!strncmp(name, \"ETDM2_OUT\", strlen(\"ETDM2_OUT\")))\n\t\treturn MT8188_AFE_IO_ETDM2_OUT;\n\telse if (!strncmp(name, \"ETDM3_OUT\", strlen(\"ETDM3_OUT\")))\n\t\treturn MT8188_AFE_IO_ETDM3_OUT;\n\telse if (!strncmp(name, \"DPTX\", strlen(\"DPTX\")))\n\t\treturn MT8188_AFE_IO_ETDM3_OUT;\n\telse\n\t\treturn -EINVAL;\n}\n\nstatic struct mtk_dai_etdm_priv *get_etdm_priv_by_name(struct mtk_base_afe *afe,\n\t\t\t\t\t\t       const char *name)\n{\n\tstruct mt8188_afe_private *afe_priv = afe->platform_priv;\n\tint dai_id = get_etdm_id_by_name(afe, name);\n\n\tif (dai_id < MT8188_AFE_IO_ETDM_START ||\n\t    dai_id >= MT8188_AFE_IO_ETDM_END)\n\t\treturn NULL;\n\n\treturn afe_priv->dai_priv[dai_id];\n}\n\nstatic int mtk_dai_etdm_enable_mclk(struct mtk_base_afe *afe, int dai_id)\n{\n\tstruct mt8188_afe_private *afe_priv = afe->platform_priv;\n\tstruct mtk_dai_etdm_priv *etdm_data;\n\tstruct etdm_con_reg etdm_reg;\n\tunsigned int val = 0;\n\tunsigned int mask;\n\tint clkmux_id = mtk_dai_etdm_get_clk_id_by_dai_id(dai_id);\n\tint clkdiv_id = mtk_dai_etdm_get_clkdiv_id_by_dai_id(dai_id);\n\tint apll_clk_id;\n\tint apll;\n\tint ret;\n\n\tif (!is_valid_etdm_dai(dai_id))\n\t\treturn -EINVAL;\n\tetdm_data = afe_priv->dai_priv[dai_id];\n\n\tapll = etdm_data->mclk_apll;\n\tapll_clk_id = mt8188_afe_get_mclk_source_clk_id(apll);\n\n\tif (clkmux_id < 0 || clkdiv_id < 0)\n\t\treturn -EINVAL;\n\n\tif (apll_clk_id < 0)\n\t\treturn apll_clk_id;\n\n\tret = get_etdm_reg(dai_id, &etdm_reg);\n\tif (ret < 0)\n\t\treturn ret;\n\n\tmask = ETDM_CON1_MCLK_OUTPUT;\n\tif (etdm_data->mclk_dir == SND_SOC_CLOCK_OUT)\n\t\tval = ETDM_CON1_MCLK_OUTPUT;\n\tregmap_update_bits(afe->regmap, etdm_reg.con1, mask, val);\n\n\t \n\tmt8188_afe_enable_clk(afe, afe_priv->clk[clkmux_id]);\n\n\t \n\tret = mt8188_afe_set_clk_parent(afe, afe_priv->clk[clkmux_id],\n\t\t\t\t\tafe_priv->clk[apll_clk_id]);\n\tif (ret)\n\t\treturn ret;\n\n\t \n\tret = mt8188_afe_set_clk_rate(afe, afe_priv->clk[clkdiv_id],\n\t\t\t\t      etdm_data->mclk_freq);\n\n\tmt8188_afe_enable_clk(afe, afe_priv->clk[clkdiv_id]);\n\n\treturn 0;\n}\n\nstatic int mtk_dai_etdm_disable_mclk(struct mtk_base_afe *afe, int dai_id)\n{\n\tstruct mt8188_afe_private *afe_priv = afe->platform_priv;\n\tint clkmux_id = mtk_dai_etdm_get_clk_id_by_dai_id(dai_id);\n\tint clkdiv_id = mtk_dai_etdm_get_clkdiv_id_by_dai_id(dai_id);\n\n\tif (clkmux_id < 0 || clkdiv_id < 0)\n\t\treturn -EINVAL;\n\n\tmt8188_afe_disable_clk(afe, afe_priv->clk[clkdiv_id]);\n\tmt8188_afe_disable_clk(afe, afe_priv->clk[clkmux_id]);\n\n\treturn 0;\n}\n\nstatic int mtk_afe_etdm_apll_connect(struct snd_soc_dapm_widget *source,\n\t\t\t\t     struct snd_soc_dapm_widget *sink)\n{\n\tstruct snd_soc_dapm_widget *w = sink;\n\tstruct snd_soc_component *cmpnt = snd_soc_dapm_to_component(w->dapm);\n\tstruct mtk_base_afe *afe = snd_soc_component_get_drvdata(cmpnt);\n\tstruct mtk_dai_etdm_priv *etdm_priv;\n\tint cur_apll;\n\tint need_apll;\n\n\tetdm_priv = get_etdm_priv_by_name(afe, w->name);\n\tif (!etdm_priv) {\n\t\tdev_dbg(afe->dev, \"etdm_priv == NULL\\n\");\n\t\treturn 0;\n\t}\n\n\tcur_apll = mt8188_get_apll_by_name(afe, source->name);\n\tneed_apll = mt8188_get_apll_by_rate(afe, etdm_priv->rate);\n\n\treturn (need_apll == cur_apll) ? 1 : 0;\n}\n\nstatic int mtk_afe_mclk_apll_connect(struct snd_soc_dapm_widget *source,\n\t\t\t\t     struct snd_soc_dapm_widget *sink)\n{\n\tstruct snd_soc_dapm_widget *w = sink;\n\tstruct snd_soc_component *cmpnt = snd_soc_dapm_to_component(w->dapm);\n\tstruct mtk_base_afe *afe = snd_soc_component_get_drvdata(cmpnt);\n\tstruct mtk_dai_etdm_priv *etdm_priv;\n\tint cur_apll;\n\n\tetdm_priv = get_etdm_priv_by_name(afe, w->name);\n\n\tcur_apll = mt8188_get_apll_by_name(afe, source->name);\n\n\treturn (etdm_priv->mclk_apll == cur_apll) ? 1 : 0;\n}\n\nstatic int mtk_etdm_mclk_connect(struct snd_soc_dapm_widget *source,\n\t\t\t\t struct snd_soc_dapm_widget *sink)\n{\n\tstruct snd_soc_dapm_widget *w = sink;\n\tstruct snd_soc_component *cmpnt = snd_soc_dapm_to_component(w->dapm);\n\tstruct mtk_base_afe *afe = snd_soc_component_get_drvdata(cmpnt);\n\tstruct mt8188_afe_private *afe_priv = afe->platform_priv;\n\tstruct mtk_dai_etdm_priv *etdm_priv;\n\tint mclk_id;\n\n\tmclk_id = get_etdm_id_by_name(afe, source->name);\n\tif (mclk_id < 0) {\n\t\tdev_dbg(afe->dev, \"mclk_id < 0\\n\");\n\t\treturn 0;\n\t}\n\n\tetdm_priv = get_etdm_priv_by_name(afe, w->name);\n\tif (!etdm_priv) {\n\t\tdev_dbg(afe->dev, \"etdm_priv == NULL\\n\");\n\t\treturn 0;\n\t}\n\n\tif (get_etdm_id_by_name(afe, sink->name) == mclk_id)\n\t\treturn !!(etdm_priv->mclk_freq > 0);\n\n\tif (etdm_priv->cowork_source_id == mclk_id) {\n\t\tetdm_priv = afe_priv->dai_priv[mclk_id];\n\t\treturn !!(etdm_priv->mclk_freq > 0);\n\t}\n\n\treturn 0;\n}\n\nstatic int mtk_etdm_cowork_connect(struct snd_soc_dapm_widget *source,\n\t\t\t\t   struct snd_soc_dapm_widget *sink)\n{\n\tstruct snd_soc_dapm_widget *w = sink;\n\tstruct snd_soc_component *cmpnt = snd_soc_dapm_to_component(w->dapm);\n\tstruct mtk_base_afe *afe = snd_soc_component_get_drvdata(cmpnt);\n\tstruct mt8188_afe_private *afe_priv = afe->platform_priv;\n\tstruct mtk_dai_etdm_priv *etdm_priv;\n\tint source_id;\n\tint i;\n\n\tsource_id = get_etdm_id_by_name(afe, source->name);\n\tif (source_id < 0) {\n\t\tdev_dbg(afe->dev, \"%s() source_id < 0\\n\", __func__);\n\t\treturn 0;\n\t}\n\n\tetdm_priv = get_etdm_priv_by_name(afe, w->name);\n\tif (!etdm_priv) {\n\t\tdev_dbg(afe->dev, \"%s() etdm_priv == NULL\\n\", __func__);\n\t\treturn 0;\n\t}\n\n\tif (etdm_priv->cowork_source_id != COWORK_ETDM_NONE) {\n\t\tif (etdm_priv->cowork_source_id == source_id)\n\t\t\treturn 1;\n\n\t\tetdm_priv = afe_priv->dai_priv[etdm_priv->cowork_source_id];\n\t\tfor (i = 0; i < etdm_priv->cowork_slv_count; i++) {\n\t\t\tif (etdm_priv->cowork_slv_id[i] == source_id)\n\t\t\t\treturn 1;\n\t\t}\n\t} else {\n\t\tfor (i = 0; i < etdm_priv->cowork_slv_count; i++) {\n\t\t\tif (etdm_priv->cowork_slv_id[i] == source_id)\n\t\t\t\treturn 1;\n\t\t}\n\t}\n\n\treturn 0;\n}\n\nstatic int mtk_apll_event(struct snd_soc_dapm_widget *w,\n\t\t\t  struct snd_kcontrol *kcontrol,\n\t\t\t  int event)\n{\n\tstruct snd_soc_component *cmpnt = snd_soc_dapm_to_component(w->dapm);\n\tstruct mtk_base_afe *afe = snd_soc_component_get_drvdata(cmpnt);\n\n\tdev_dbg(cmpnt->dev, \"%s(), name %s, event 0x%x\\n\",\n\t\t__func__, w->name, event);\n\n\tswitch (event) {\n\tcase SND_SOC_DAPM_PRE_PMU:\n\t\tif (strcmp(w->name, APLL1_W_NAME) == 0)\n\t\t\tmt8188_apll1_enable(afe);\n\t\telse\n\t\t\tmt8188_apll2_enable(afe);\n\t\tbreak;\n\tcase SND_SOC_DAPM_POST_PMD:\n\t\tif (strcmp(w->name, APLL1_W_NAME) == 0)\n\t\t\tmt8188_apll1_disable(afe);\n\t\telse\n\t\t\tmt8188_apll2_disable(afe);\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n\n\treturn 0;\n}\n\nstatic int mtk_etdm_mclk_event(struct snd_soc_dapm_widget *w,\n\t\t\t       struct snd_kcontrol *kcontrol,\n\t\t\t       int event)\n{\n\tstruct snd_soc_component *cmpnt = snd_soc_dapm_to_component(w->dapm);\n\tstruct mtk_base_afe *afe = snd_soc_component_get_drvdata(cmpnt);\n\tint mclk_id = get_etdm_id_by_name(afe, w->name);\n\n\tif (mclk_id < 0) {\n\t\tdev_dbg(afe->dev, \"%s() mclk_id < 0\\n\", __func__);\n\t\treturn 0;\n\t}\n\n\tdev_dbg(cmpnt->dev, \"%s(), name %s, event 0x%x\\n\",\n\t\t__func__, w->name, event);\n\n\tswitch (event) {\n\tcase SND_SOC_DAPM_PRE_PMU:\n\t\tmtk_dai_etdm_enable_mclk(afe, mclk_id);\n\t\tbreak;\n\tcase SND_SOC_DAPM_POST_PMD:\n\t\tmtk_dai_etdm_disable_mclk(afe, mclk_id);\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n\n\treturn 0;\n}\n\nstatic int mtk_dptx_mclk_event(struct snd_soc_dapm_widget *w,\n\t\t\t       struct snd_kcontrol *kcontrol,\n\t\t\t       int event)\n{\n\tstruct snd_soc_component *cmpnt = snd_soc_dapm_to_component(w->dapm);\n\tstruct mtk_base_afe *afe = snd_soc_component_get_drvdata(cmpnt);\n\n\tdev_dbg(cmpnt->dev, \"%s(), name %s, event 0x%x\\n\",\n\t\t__func__, w->name, event);\n\n\tswitch (event) {\n\tcase SND_SOC_DAPM_PRE_PMU:\n\t\tmtk_dai_etdm_enable_mclk(afe, MT8188_AFE_IO_DPTX);\n\t\tbreak;\n\tcase SND_SOC_DAPM_POST_PMD:\n\t\tmtk_dai_etdm_disable_mclk(afe, MT8188_AFE_IO_DPTX);\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n\n\treturn 0;\n}\n\nstatic int mtk_etdm_cg_event(struct snd_soc_dapm_widget *w,\n\t\t\t     struct snd_kcontrol *kcontrol,\n\t\t\t     int event)\n{\n\tstruct snd_soc_component *cmpnt = snd_soc_dapm_to_component(w->dapm);\n\tstruct mtk_base_afe *afe = snd_soc_component_get_drvdata(cmpnt);\n\tstruct mt8188_afe_private *afe_priv = afe->platform_priv;\n\tint etdm_id;\n\tint cg_id;\n\n\tetdm_id = get_etdm_id_by_name(afe, w->name);\n\tif (etdm_id < 0) {\n\t\tdev_dbg(afe->dev, \"%s() etdm_id < 0\\n\", __func__);\n\t\treturn 0;\n\t}\n\n\tcg_id = mtk_dai_etdm_get_cg_id_by_dai_id(etdm_id);\n\tif (cg_id < 0) {\n\t\tdev_dbg(afe->dev, \"%s() cg_id < 0\\n\", __func__);\n\t\treturn 0;\n\t}\n\n\tdev_dbg(cmpnt->dev, \"%s(), name %s, event 0x%x\\n\",\n\t\t__func__, w->name, event);\n\n\tswitch (event) {\n\tcase SND_SOC_DAPM_PRE_PMU:\n\t\tmt8188_afe_enable_clk(afe, afe_priv->clk[cg_id]);\n\t\tbreak;\n\tcase SND_SOC_DAPM_POST_PMD:\n\t\tmt8188_afe_disable_clk(afe, afe_priv->clk[cg_id]);\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n\n\treturn 0;\n}\n\nstatic int mtk_etdm3_cg_event(struct snd_soc_dapm_widget *w,\n\t\t\t      struct snd_kcontrol *kcontrol,\n\t\t\t      int event)\n{\n\tstruct snd_soc_component *cmpnt = snd_soc_dapm_to_component(w->dapm);\n\tstruct mtk_base_afe *afe = snd_soc_component_get_drvdata(cmpnt);\n\tstruct mt8188_afe_private *afe_priv = afe->platform_priv;\n\n\tdev_dbg(cmpnt->dev, \"%s(), name %s, event 0x%x\\n\",\n\t\t__func__, w->name, event);\n\n\tswitch (event) {\n\tcase SND_SOC_DAPM_PRE_PMU:\n\t\tmt8188_afe_enable_clk(afe, afe_priv->clk[MT8188_CLK_AUD_HDMI_OUT]);\n\t\tbreak;\n\tcase SND_SOC_DAPM_POST_PMD:\n\t\tmt8188_afe_disable_clk(afe, afe_priv->clk[MT8188_CLK_AUD_HDMI_OUT]);\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n\n\treturn 0;\n}\n\nstatic const struct snd_kcontrol_new mtk_dai_etdm_o048_mix[] = {\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I020 Switch\", AFE_CONN48, 20, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I022 Switch\", AFE_CONN48, 22, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I046 Switch\", AFE_CONN48_1, 14, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I070 Switch\", AFE_CONN48_2, 6, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new mtk_dai_etdm_o049_mix[] = {\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I021 Switch\", AFE_CONN49, 21, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I023 Switch\", AFE_CONN49, 23, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I047 Switch\", AFE_CONN49_1, 15, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I071 Switch\", AFE_CONN49_2, 7, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new mtk_dai_etdm_o050_mix[] = {\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I024 Switch\", AFE_CONN50, 24, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I048 Switch\", AFE_CONN50_1, 16, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new mtk_dai_etdm_o051_mix[] = {\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I025 Switch\", AFE_CONN51, 25, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I049 Switch\", AFE_CONN51_1, 17, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new mtk_dai_etdm_o052_mix[] = {\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I026 Switch\", AFE_CONN52, 26, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I050 Switch\", AFE_CONN52_1, 18, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new mtk_dai_etdm_o053_mix[] = {\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I027 Switch\", AFE_CONN53, 27, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I051 Switch\", AFE_CONN53_1, 19, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new mtk_dai_etdm_o054_mix[] = {\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I028 Switch\", AFE_CONN54, 28, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I052 Switch\", AFE_CONN54_1, 20, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new mtk_dai_etdm_o055_mix[] = {\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I029 Switch\", AFE_CONN55, 29, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I053 Switch\", AFE_CONN55_1, 21, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new mtk_dai_etdm_o056_mix[] = {\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I030 Switch\", AFE_CONN56, 30, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I054 Switch\", AFE_CONN56_1, 22, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new mtk_dai_etdm_o057_mix[] = {\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I031 Switch\", AFE_CONN57, 31, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I055 Switch\", AFE_CONN57_1, 23, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new mtk_dai_etdm_o058_mix[] = {\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I032 Switch\", AFE_CONN58_1, 0, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I056 Switch\", AFE_CONN58_1, 24, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new mtk_dai_etdm_o059_mix[] = {\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I033 Switch\", AFE_CONN59_1, 1, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I057 Switch\", AFE_CONN59_1, 25, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new mtk_dai_etdm_o060_mix[] = {\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I034 Switch\", AFE_CONN60_1, 2, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I058 Switch\", AFE_CONN60_1, 26, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new mtk_dai_etdm_o061_mix[] = {\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I035 Switch\", AFE_CONN61_1, 3, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I059 Switch\", AFE_CONN61_1, 27, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new mtk_dai_etdm_o062_mix[] = {\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I036 Switch\", AFE_CONN62_1, 4, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I060 Switch\", AFE_CONN62_1, 28, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new mtk_dai_etdm_o063_mix[] = {\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I037 Switch\", AFE_CONN63_1, 5, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I061 Switch\", AFE_CONN63_1, 29, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new mtk_dai_etdm_o072_mix[] = {\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I020 Switch\", AFE_CONN72, 20, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I022 Switch\", AFE_CONN72, 22, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I046 Switch\", AFE_CONN72_1, 14, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I070 Switch\", AFE_CONN72_2, 6, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new mtk_dai_etdm_o073_mix[] = {\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I021 Switch\", AFE_CONN73, 21, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I023 Switch\", AFE_CONN73, 23, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I047 Switch\", AFE_CONN73_1, 15, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I071 Switch\", AFE_CONN73_2, 7, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new mtk_dai_etdm_o074_mix[] = {\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I024 Switch\", AFE_CONN74, 24, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I048 Switch\", AFE_CONN74_1, 16, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new mtk_dai_etdm_o075_mix[] = {\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I025 Switch\", AFE_CONN75, 25, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I049 Switch\", AFE_CONN75_1, 17, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new mtk_dai_etdm_o076_mix[] = {\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I026 Switch\", AFE_CONN76, 26, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I050 Switch\", AFE_CONN76_1, 18, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new mtk_dai_etdm_o077_mix[] = {\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I027 Switch\", AFE_CONN77, 27, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I051 Switch\", AFE_CONN77_1, 19, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new mtk_dai_etdm_o078_mix[] = {\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I028 Switch\", AFE_CONN78, 28, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I052 Switch\", AFE_CONN78_1, 20, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new mtk_dai_etdm_o079_mix[] = {\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I029 Switch\", AFE_CONN79, 29, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I053 Switch\", AFE_CONN79_1, 21, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new mtk_dai_etdm_o080_mix[] = {\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I030 Switch\", AFE_CONN80, 30, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I054 Switch\", AFE_CONN80_1, 22, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new mtk_dai_etdm_o081_mix[] = {\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I031 Switch\", AFE_CONN81, 31, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I055 Switch\", AFE_CONN81_1, 23, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new mtk_dai_etdm_o082_mix[] = {\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I032 Switch\", AFE_CONN82_1, 0, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I056 Switch\", AFE_CONN82_1, 24, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new mtk_dai_etdm_o083_mix[] = {\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I033 Switch\", AFE_CONN83_1, 1, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I057 Switch\", AFE_CONN83_1, 25, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new mtk_dai_etdm_o084_mix[] = {\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I034 Switch\", AFE_CONN84_1, 2, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I058 Switch\", AFE_CONN84_1, 26, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new mtk_dai_etdm_o085_mix[] = {\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I035 Switch\", AFE_CONN85_1, 3, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I059 Switch\", AFE_CONN85_1, 27, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new mtk_dai_etdm_o086_mix[] = {\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I036 Switch\", AFE_CONN86_1, 4, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I060 Switch\", AFE_CONN86_1, 28, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new mtk_dai_etdm_o087_mix[] = {\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I037 Switch\", AFE_CONN87_1, 5, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"I061 Switch\", AFE_CONN87_1, 29, 1, 0),\n};\n\nstatic const char * const mt8188_etdm_clk_src_sel_text[] = {\n\t\"26m\",\n\t\"a1sys_a2sys\",\n\t\"a3sys\",\n\t\"a4sys\",\n};\n\nstatic SOC_ENUM_SINGLE_EXT_DECL(etdmout_clk_src_enum,\n\tmt8188_etdm_clk_src_sel_text);\n\nstatic const char * const hdmitx_dptx_mux_map[] = {\n\t\"Disconnect\", \"Connect\",\n};\n\nstatic int hdmitx_dptx_mux_map_value[] = {\n\t0, 1,\n};\n\n \nstatic SOC_VALUE_ENUM_SINGLE_AUTODISABLE_DECL(hdmi_out_mux_map_enum,\n\t\t\t\tSND_SOC_NOPM,\n\t\t\t\t0,\n\t\t\t\t1,\n\t\t\t\thdmitx_dptx_mux_map,\n\t\t\t\thdmitx_dptx_mux_map_value);\n\nstatic const struct snd_kcontrol_new hdmi_out_mux_control =\n\tSOC_DAPM_ENUM(\"HDMI_OUT_MUX\", hdmi_out_mux_map_enum);\n\n \nstatic SOC_VALUE_ENUM_SINGLE_AUTODISABLE_DECL(dptx_out_mux_map_enum,\n\t\t\t\tSND_SOC_NOPM,\n\t\t\t\t0,\n\t\t\t\t1,\n\t\t\t\thdmitx_dptx_mux_map,\n\t\t\t\thdmitx_dptx_mux_map_value);\n\nstatic const struct snd_kcontrol_new dptx_out_mux_control =\n\tSOC_DAPM_ENUM(\"DPTX_OUT_MUX\", dptx_out_mux_map_enum);\n\n \nstatic const char *const afe_conn_hdmi_mux_map[] = {\n\t\"CH0\", \"CH1\", \"CH2\", \"CH3\", \"CH4\", \"CH5\", \"CH6\", \"CH7\",\n};\n\nstatic int afe_conn_hdmi_mux_map_value[] = {\n\t0, 1, 2, 3, 4, 5, 6, 7,\n};\n\nstatic SOC_VALUE_ENUM_SINGLE_DECL(hdmi_ch0_mux_map_enum,\n\t\t\t\tAFE_TDMOUT_CONN0,\n\t\t\t\t0,\n\t\t\t\t0xf,\n\t\t\t\tafe_conn_hdmi_mux_map,\n\t\t\t\tafe_conn_hdmi_mux_map_value);\n\nstatic const struct snd_kcontrol_new hdmi_ch0_mux_control =\n\tSOC_DAPM_ENUM(\"HDMI_CH0_MUX\", hdmi_ch0_mux_map_enum);\n\nstatic SOC_VALUE_ENUM_SINGLE_DECL(hdmi_ch1_mux_map_enum,\n\t\t\t\tAFE_TDMOUT_CONN0,\n\t\t\t\t4,\n\t\t\t\t0xf,\n\t\t\t\tafe_conn_hdmi_mux_map,\n\t\t\t\tafe_conn_hdmi_mux_map_value);\n\nstatic const struct snd_kcontrol_new hdmi_ch1_mux_control =\n\tSOC_DAPM_ENUM(\"HDMI_CH1_MUX\", hdmi_ch1_mux_map_enum);\n\nstatic SOC_VALUE_ENUM_SINGLE_DECL(hdmi_ch2_mux_map_enum,\n\t\t\t\tAFE_TDMOUT_CONN0,\n\t\t\t\t8,\n\t\t\t\t0xf,\n\t\t\t\tafe_conn_hdmi_mux_map,\n\t\t\t\tafe_conn_hdmi_mux_map_value);\n\nstatic const struct snd_kcontrol_new hdmi_ch2_mux_control =\n\tSOC_DAPM_ENUM(\"HDMI_CH2_MUX\", hdmi_ch2_mux_map_enum);\n\nstatic SOC_VALUE_ENUM_SINGLE_DECL(hdmi_ch3_mux_map_enum,\n\t\t\t\tAFE_TDMOUT_CONN0,\n\t\t\t\t12,\n\t\t\t\t0xf,\n\t\t\t\tafe_conn_hdmi_mux_map,\n\t\t\t\tafe_conn_hdmi_mux_map_value);\n\nstatic const struct snd_kcontrol_new hdmi_ch3_mux_control =\n\tSOC_DAPM_ENUM(\"HDMI_CH3_MUX\", hdmi_ch3_mux_map_enum);\n\nstatic SOC_VALUE_ENUM_SINGLE_DECL(hdmi_ch4_mux_map_enum,\n\t\t\t\tAFE_TDMOUT_CONN0,\n\t\t\t\t16,\n\t\t\t\t0xf,\n\t\t\t\tafe_conn_hdmi_mux_map,\n\t\t\t\tafe_conn_hdmi_mux_map_value);\n\nstatic const struct snd_kcontrol_new hdmi_ch4_mux_control =\n\tSOC_DAPM_ENUM(\"HDMI_CH4_MUX\", hdmi_ch4_mux_map_enum);\n\nstatic SOC_VALUE_ENUM_SINGLE_DECL(hdmi_ch5_mux_map_enum,\n\t\t\t\tAFE_TDMOUT_CONN0,\n\t\t\t\t20,\n\t\t\t\t0xf,\n\t\t\t\tafe_conn_hdmi_mux_map,\n\t\t\t\tafe_conn_hdmi_mux_map_value);\n\nstatic const struct snd_kcontrol_new hdmi_ch5_mux_control =\n\tSOC_DAPM_ENUM(\"HDMI_CH5_MUX\", hdmi_ch5_mux_map_enum);\n\nstatic SOC_VALUE_ENUM_SINGLE_DECL(hdmi_ch6_mux_map_enum,\n\t\t\t\tAFE_TDMOUT_CONN0,\n\t\t\t\t24,\n\t\t\t\t0xf,\n\t\t\t\tafe_conn_hdmi_mux_map,\n\t\t\t\tafe_conn_hdmi_mux_map_value);\n\nstatic const struct snd_kcontrol_new hdmi_ch6_mux_control =\n\tSOC_DAPM_ENUM(\"HDMI_CH6_MUX\", hdmi_ch6_mux_map_enum);\n\nstatic SOC_VALUE_ENUM_SINGLE_DECL(hdmi_ch7_mux_map_enum,\n\t\t\t\tAFE_TDMOUT_CONN0,\n\t\t\t\t28,\n\t\t\t\t0xf,\n\t\t\t\tafe_conn_hdmi_mux_map,\n\t\t\t\tafe_conn_hdmi_mux_map_value);\n\nstatic const struct snd_kcontrol_new hdmi_ch7_mux_control =\n\tSOC_DAPM_ENUM(\"HDMI_CH7_MUX\", hdmi_ch7_mux_map_enum);\n\nstatic int mt8188_etdm_clk_src_sel_put(struct snd_kcontrol *kcontrol,\n\t\t\t\t       struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_soc_component *component = snd_kcontrol_chip(kcontrol);\n\tstruct soc_enum *e = (struct soc_enum *)kcontrol->private_value;\n\tstruct mtk_base_afe *afe = snd_soc_component_get_drvdata(component);\n\tunsigned int source = ucontrol->value.enumerated.item[0];\n\tunsigned int val;\n\tunsigned int old_val;\n\tunsigned int mask;\n\tunsigned int reg;\n\n\tif (source >= e->items)\n\t\treturn -EINVAL;\n\n\tif (!strcmp(kcontrol->id.name, \"ETDM_OUT1_Clock_Source\")) {\n\t\treg = ETDM_OUT1_CON4;\n\t\tmask = ETDM_OUT_CON4_CLOCK_MASK;\n\t\tval = FIELD_PREP(ETDM_OUT_CON4_CLOCK_MASK, source);\n\t} else if (!strcmp(kcontrol->id.name, \"ETDM_OUT2_Clock_Source\")) {\n\t\treg = ETDM_OUT2_CON4;\n\t\tmask = ETDM_OUT_CON4_CLOCK_MASK;\n\t\tval = FIELD_PREP(ETDM_OUT_CON4_CLOCK_MASK, source);\n\t} else if (!strcmp(kcontrol->id.name, \"ETDM_OUT3_Clock_Source\")) {\n\t\treg = ETDM_OUT3_CON4;\n\t\tmask = ETDM_OUT_CON4_CLOCK_MASK;\n\t\tval = FIELD_PREP(ETDM_OUT_CON4_CLOCK_MASK, source);\n\t} else if (!strcmp(kcontrol->id.name, \"ETDM_IN1_Clock_Source\")) {\n\t\treg = ETDM_IN1_CON2;\n\t\tmask = ETDM_IN_CON2_CLOCK_MASK;\n\t\tval = FIELD_PREP(ETDM_IN_CON2_CLOCK_MASK, source);\n\t} else if (!strcmp(kcontrol->id.name, \"ETDM_IN2_Clock_Source\")) {\n\t\treg = ETDM_IN2_CON2;\n\t\tmask = ETDM_IN_CON2_CLOCK_MASK;\n\t\tval = FIELD_PREP(ETDM_IN_CON2_CLOCK_MASK, source);\n\t} else {\n\t\treturn -EINVAL;\n\t}\n\n\tregmap_read(afe->regmap, reg, &old_val);\n\told_val &= mask;\n\tif (old_val == val)\n\t\treturn 0;\n\n\tregmap_update_bits(afe->regmap, reg, mask, val);\n\n\treturn 1;\n}\n\nstatic int mt8188_etdm_clk_src_sel_get(struct snd_kcontrol *kcontrol,\n\t\t\t\t       struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_soc_component *component =\n\t\tsnd_soc_kcontrol_component(kcontrol);\n\tstruct mtk_base_afe *afe = snd_soc_component_get_drvdata(component);\n\tunsigned int value;\n\tunsigned int reg;\n\tunsigned int mask;\n\tunsigned int shift;\n\n\tif (!strcmp(kcontrol->id.name, \"ETDM_OUT1_Clock_Source\")) {\n\t\treg = ETDM_OUT1_CON4;\n\t\tmask = ETDM_OUT_CON4_CLOCK_MASK;\n\t\tshift = ETDM_OUT_CON4_CLOCK_SHIFT;\n\t} else if (!strcmp(kcontrol->id.name, \"ETDM_OUT2_Clock_Source\")) {\n\t\treg = ETDM_OUT2_CON4;\n\t\tmask = ETDM_OUT_CON4_CLOCK_MASK;\n\t\tshift = ETDM_OUT_CON4_CLOCK_SHIFT;\n\t} else if (!strcmp(kcontrol->id.name, \"ETDM_OUT3_Clock_Source\")) {\n\t\treg = ETDM_OUT3_CON4;\n\t\tmask = ETDM_OUT_CON4_CLOCK_MASK;\n\t\tshift = ETDM_OUT_CON4_CLOCK_SHIFT;\n\t} else if (!strcmp(kcontrol->id.name, \"ETDM_IN1_Clock_Source\")) {\n\t\treg = ETDM_IN1_CON2;\n\t\tmask = ETDM_IN_CON2_CLOCK_MASK;\n\t\tshift = ETDM_IN_CON2_CLOCK_SHIFT;\n\t} else if (!strcmp(kcontrol->id.name, \"ETDM_IN2_Clock_Source\")) {\n\t\treg = ETDM_IN2_CON2;\n\t\tmask = ETDM_IN_CON2_CLOCK_MASK;\n\t\tshift = ETDM_IN_CON2_CLOCK_SHIFT;\n\t} else {\n\t\treturn -EINVAL;\n\t}\n\n\tregmap_read(afe->regmap, reg, &value);\n\n\tvalue &= mask;\n\tvalue >>= shift;\n\tucontrol->value.enumerated.item[0] = value;\n\treturn 0;\n}\n\nstatic const struct snd_kcontrol_new mtk_dai_etdm_controls[] = {\n\tSOC_ENUM_EXT(\"ETDM_OUT1_Clock_Source\", etdmout_clk_src_enum,\n\t\t     mt8188_etdm_clk_src_sel_get,\n\t\t     mt8188_etdm_clk_src_sel_put),\n\tSOC_ENUM_EXT(\"ETDM_OUT2_Clock_Source\", etdmout_clk_src_enum,\n\t\t     mt8188_etdm_clk_src_sel_get,\n\t\t     mt8188_etdm_clk_src_sel_put),\n\tSOC_ENUM_EXT(\"ETDM_OUT3_Clock_Source\", etdmout_clk_src_enum,\n\t\t     mt8188_etdm_clk_src_sel_get,\n\t\t     mt8188_etdm_clk_src_sel_put),\n\tSOC_ENUM_EXT(\"ETDM_IN1_Clock_Source\", etdmout_clk_src_enum,\n\t\t     mt8188_etdm_clk_src_sel_get,\n\t\t     mt8188_etdm_clk_src_sel_put),\n\tSOC_ENUM_EXT(\"ETDM_IN2_Clock_Source\", etdmout_clk_src_enum,\n\t\t     mt8188_etdm_clk_src_sel_get,\n\t\t     mt8188_etdm_clk_src_sel_put),\n};\n\nstatic const struct snd_soc_dapm_widget mtk_dai_etdm_widgets[] = {\n\t \n\tSND_SOC_DAPM_MIXER(\"I012\", SND_SOC_NOPM, 0, 0, NULL, 0),\n\tSND_SOC_DAPM_MIXER(\"I013\", SND_SOC_NOPM, 0, 0, NULL, 0),\n\tSND_SOC_DAPM_MIXER(\"I014\", SND_SOC_NOPM, 0, 0, NULL, 0),\n\tSND_SOC_DAPM_MIXER(\"I015\", SND_SOC_NOPM, 0, 0, NULL, 0),\n\tSND_SOC_DAPM_MIXER(\"I016\", SND_SOC_NOPM, 0, 0, NULL, 0),\n\tSND_SOC_DAPM_MIXER(\"I017\", SND_SOC_NOPM, 0, 0, NULL, 0),\n\tSND_SOC_DAPM_MIXER(\"I018\", SND_SOC_NOPM, 0, 0, NULL, 0),\n\tSND_SOC_DAPM_MIXER(\"I019\", SND_SOC_NOPM, 0, 0, NULL, 0),\n\tSND_SOC_DAPM_MIXER(\"I188\", SND_SOC_NOPM, 0, 0, NULL, 0),\n\tSND_SOC_DAPM_MIXER(\"I189\", SND_SOC_NOPM, 0, 0, NULL, 0),\n\tSND_SOC_DAPM_MIXER(\"I190\", SND_SOC_NOPM, 0, 0, NULL, 0),\n\tSND_SOC_DAPM_MIXER(\"I191\", SND_SOC_NOPM, 0, 0, NULL, 0),\n\tSND_SOC_DAPM_MIXER(\"I192\", SND_SOC_NOPM, 0, 0, NULL, 0),\n\tSND_SOC_DAPM_MIXER(\"I193\", SND_SOC_NOPM, 0, 0, NULL, 0),\n\tSND_SOC_DAPM_MIXER(\"I194\", SND_SOC_NOPM, 0, 0, NULL, 0),\n\tSND_SOC_DAPM_MIXER(\"I195\", SND_SOC_NOPM, 0, 0, NULL, 0),\n\n\t \n\tSND_SOC_DAPM_MIXER(\"I072\", SND_SOC_NOPM, 0, 0, NULL, 0),\n\tSND_SOC_DAPM_MIXER(\"I073\", SND_SOC_NOPM, 0, 0, NULL, 0),\n\tSND_SOC_DAPM_MIXER(\"I074\", SND_SOC_NOPM, 0, 0, NULL, 0),\n\tSND_SOC_DAPM_MIXER(\"I075\", SND_SOC_NOPM, 0, 0, NULL, 0),\n\tSND_SOC_DAPM_MIXER(\"I076\", SND_SOC_NOPM, 0, 0, NULL, 0),\n\tSND_SOC_DAPM_MIXER(\"I077\", SND_SOC_NOPM, 0, 0, NULL, 0),\n\tSND_SOC_DAPM_MIXER(\"I078\", SND_SOC_NOPM, 0, 0, NULL, 0),\n\tSND_SOC_DAPM_MIXER(\"I079\", SND_SOC_NOPM, 0, 0, NULL, 0),\n\tSND_SOC_DAPM_MIXER(\"I080\", SND_SOC_NOPM, 0, 0, NULL, 0),\n\tSND_SOC_DAPM_MIXER(\"I081\", SND_SOC_NOPM, 0, 0, NULL, 0),\n\tSND_SOC_DAPM_MIXER(\"I082\", SND_SOC_NOPM, 0, 0, NULL, 0),\n\tSND_SOC_DAPM_MIXER(\"I083\", SND_SOC_NOPM, 0, 0, NULL, 0),\n\tSND_SOC_DAPM_MIXER(\"I084\", SND_SOC_NOPM, 0, 0, NULL, 0),\n\tSND_SOC_DAPM_MIXER(\"I085\", SND_SOC_NOPM, 0, 0, NULL, 0),\n\tSND_SOC_DAPM_MIXER(\"I086\", SND_SOC_NOPM, 0, 0, NULL, 0),\n\tSND_SOC_DAPM_MIXER(\"I087\", SND_SOC_NOPM, 0, 0, NULL, 0),\n\n\t \n\tSND_SOC_DAPM_MIXER(\"O048\", SND_SOC_NOPM, 0, 0,\n\t\t\t   mtk_dai_etdm_o048_mix, ARRAY_SIZE(mtk_dai_etdm_o048_mix)),\n\tSND_SOC_DAPM_MIXER(\"O049\", SND_SOC_NOPM, 0, 0,\n\t\t\t   mtk_dai_etdm_o049_mix, ARRAY_SIZE(mtk_dai_etdm_o049_mix)),\n\tSND_SOC_DAPM_MIXER(\"O050\", SND_SOC_NOPM, 0, 0,\n\t\t\t   mtk_dai_etdm_o050_mix, ARRAY_SIZE(mtk_dai_etdm_o050_mix)),\n\tSND_SOC_DAPM_MIXER(\"O051\", SND_SOC_NOPM, 0, 0,\n\t\t\t   mtk_dai_etdm_o051_mix, ARRAY_SIZE(mtk_dai_etdm_o051_mix)),\n\tSND_SOC_DAPM_MIXER(\"O052\", SND_SOC_NOPM, 0, 0,\n\t\t\t   mtk_dai_etdm_o052_mix, ARRAY_SIZE(mtk_dai_etdm_o052_mix)),\n\tSND_SOC_DAPM_MIXER(\"O053\", SND_SOC_NOPM, 0, 0,\n\t\t\t   mtk_dai_etdm_o053_mix, ARRAY_SIZE(mtk_dai_etdm_o053_mix)),\n\tSND_SOC_DAPM_MIXER(\"O054\", SND_SOC_NOPM, 0, 0,\n\t\t\t   mtk_dai_etdm_o054_mix, ARRAY_SIZE(mtk_dai_etdm_o054_mix)),\n\tSND_SOC_DAPM_MIXER(\"O055\", SND_SOC_NOPM, 0, 0,\n\t\t\t   mtk_dai_etdm_o055_mix, ARRAY_SIZE(mtk_dai_etdm_o055_mix)),\n\tSND_SOC_DAPM_MIXER(\"O056\", SND_SOC_NOPM, 0, 0,\n\t\t\t   mtk_dai_etdm_o056_mix, ARRAY_SIZE(mtk_dai_etdm_o056_mix)),\n\tSND_SOC_DAPM_MIXER(\"O057\", SND_SOC_NOPM, 0, 0,\n\t\t\t   mtk_dai_etdm_o057_mix, ARRAY_SIZE(mtk_dai_etdm_o057_mix)),\n\tSND_SOC_DAPM_MIXER(\"O058\", SND_SOC_NOPM, 0, 0,\n\t\t\t   mtk_dai_etdm_o058_mix, ARRAY_SIZE(mtk_dai_etdm_o058_mix)),\n\tSND_SOC_DAPM_MIXER(\"O059\", SND_SOC_NOPM, 0, 0,\n\t\t\t   mtk_dai_etdm_o059_mix, ARRAY_SIZE(mtk_dai_etdm_o059_mix)),\n\tSND_SOC_DAPM_MIXER(\"O060\", SND_SOC_NOPM, 0, 0,\n\t\t\t   mtk_dai_etdm_o060_mix, ARRAY_SIZE(mtk_dai_etdm_o060_mix)),\n\tSND_SOC_DAPM_MIXER(\"O061\", SND_SOC_NOPM, 0, 0,\n\t\t\t   mtk_dai_etdm_o061_mix, ARRAY_SIZE(mtk_dai_etdm_o061_mix)),\n\tSND_SOC_DAPM_MIXER(\"O062\", SND_SOC_NOPM, 0, 0,\n\t\t\t   mtk_dai_etdm_o062_mix, ARRAY_SIZE(mtk_dai_etdm_o062_mix)),\n\tSND_SOC_DAPM_MIXER(\"O063\", SND_SOC_NOPM, 0, 0,\n\t\t\t   mtk_dai_etdm_o063_mix, ARRAY_SIZE(mtk_dai_etdm_o063_mix)),\n\n\t \n\tSND_SOC_DAPM_MIXER(\"O072\", SND_SOC_NOPM, 0, 0,\n\t\t\t   mtk_dai_etdm_o072_mix, ARRAY_SIZE(mtk_dai_etdm_o072_mix)),\n\tSND_SOC_DAPM_MIXER(\"O073\", SND_SOC_NOPM, 0, 0,\n\t\t\t   mtk_dai_etdm_o073_mix, ARRAY_SIZE(mtk_dai_etdm_o073_mix)),\n\tSND_SOC_DAPM_MIXER(\"O074\", SND_SOC_NOPM, 0, 0,\n\t\t\t   mtk_dai_etdm_o074_mix, ARRAY_SIZE(mtk_dai_etdm_o074_mix)),\n\tSND_SOC_DAPM_MIXER(\"O075\", SND_SOC_NOPM, 0, 0,\n\t\t\t   mtk_dai_etdm_o075_mix, ARRAY_SIZE(mtk_dai_etdm_o075_mix)),\n\tSND_SOC_DAPM_MIXER(\"O076\", SND_SOC_NOPM, 0, 0,\n\t\t\t   mtk_dai_etdm_o076_mix, ARRAY_SIZE(mtk_dai_etdm_o076_mix)),\n\tSND_SOC_DAPM_MIXER(\"O077\", SND_SOC_NOPM, 0, 0,\n\t\t\t   mtk_dai_etdm_o077_mix, ARRAY_SIZE(mtk_dai_etdm_o077_mix)),\n\tSND_SOC_DAPM_MIXER(\"O078\", SND_SOC_NOPM, 0, 0,\n\t\t\t   mtk_dai_etdm_o078_mix, ARRAY_SIZE(mtk_dai_etdm_o078_mix)),\n\tSND_SOC_DAPM_MIXER(\"O079\", SND_SOC_NOPM, 0, 0,\n\t\t\t   mtk_dai_etdm_o079_mix, ARRAY_SIZE(mtk_dai_etdm_o079_mix)),\n\tSND_SOC_DAPM_MIXER(\"O080\", SND_SOC_NOPM, 0, 0,\n\t\t\t   mtk_dai_etdm_o080_mix, ARRAY_SIZE(mtk_dai_etdm_o080_mix)),\n\tSND_SOC_DAPM_MIXER(\"O081\", SND_SOC_NOPM, 0, 0,\n\t\t\t   mtk_dai_etdm_o081_mix, ARRAY_SIZE(mtk_dai_etdm_o081_mix)),\n\tSND_SOC_DAPM_MIXER(\"O082\", SND_SOC_NOPM, 0, 0,\n\t\t\t   mtk_dai_etdm_o082_mix, ARRAY_SIZE(mtk_dai_etdm_o082_mix)),\n\tSND_SOC_DAPM_MIXER(\"O083\", SND_SOC_NOPM, 0, 0,\n\t\t\t   mtk_dai_etdm_o083_mix, ARRAY_SIZE(mtk_dai_etdm_o083_mix)),\n\tSND_SOC_DAPM_MIXER(\"O084\", SND_SOC_NOPM, 0, 0,\n\t\t\t   mtk_dai_etdm_o084_mix, ARRAY_SIZE(mtk_dai_etdm_o084_mix)),\n\tSND_SOC_DAPM_MIXER(\"O085\", SND_SOC_NOPM, 0, 0,\n\t\t\t   mtk_dai_etdm_o085_mix, ARRAY_SIZE(mtk_dai_etdm_o085_mix)),\n\tSND_SOC_DAPM_MIXER(\"O086\", SND_SOC_NOPM, 0, 0,\n\t\t\t   mtk_dai_etdm_o086_mix, ARRAY_SIZE(mtk_dai_etdm_o086_mix)),\n\tSND_SOC_DAPM_MIXER(\"O087\", SND_SOC_NOPM, 0, 0,\n\t\t\t   mtk_dai_etdm_o087_mix, ARRAY_SIZE(mtk_dai_etdm_o087_mix)),\n\n\t \n\tSND_SOC_DAPM_MUX(\"HDMI_OUT_MUX\", SND_SOC_NOPM, 0, 0,\n\t\t\t &hdmi_out_mux_control),\n\tSND_SOC_DAPM_MUX(\"DPTX_OUT_MUX\", SND_SOC_NOPM, 0, 0,\n\t\t\t &dptx_out_mux_control),\n\n\tSND_SOC_DAPM_MUX(\"HDMI_CH0_MUX\", SND_SOC_NOPM, 0, 0,\n\t\t\t &hdmi_ch0_mux_control),\n\tSND_SOC_DAPM_MUX(\"HDMI_CH1_MUX\", SND_SOC_NOPM, 0, 0,\n\t\t\t &hdmi_ch1_mux_control),\n\tSND_SOC_DAPM_MUX(\"HDMI_CH2_MUX\", SND_SOC_NOPM, 0, 0,\n\t\t\t &hdmi_ch2_mux_control),\n\tSND_SOC_DAPM_MUX(\"HDMI_CH3_MUX\", SND_SOC_NOPM, 0, 0,\n\t\t\t &hdmi_ch3_mux_control),\n\tSND_SOC_DAPM_MUX(\"HDMI_CH4_MUX\", SND_SOC_NOPM, 0, 0,\n\t\t\t &hdmi_ch4_mux_control),\n\tSND_SOC_DAPM_MUX(\"HDMI_CH5_MUX\", SND_SOC_NOPM, 0, 0,\n\t\t\t &hdmi_ch5_mux_control),\n\tSND_SOC_DAPM_MUX(\"HDMI_CH6_MUX\", SND_SOC_NOPM, 0, 0,\n\t\t\t &hdmi_ch6_mux_control),\n\tSND_SOC_DAPM_MUX(\"HDMI_CH7_MUX\", SND_SOC_NOPM, 0, 0,\n\t\t\t &hdmi_ch7_mux_control),\n\n\t \n\tSND_SOC_DAPM_SUPPLY_S(\"ETDM1_IN_MCLK\", SUPPLY_SEQ_ETDM_MCLK,\n\t\t\t      SND_SOC_NOPM, 0, 0,\n\t\t\t      mtk_etdm_mclk_event,\n\t\t\t      SND_SOC_DAPM_PRE_PMU | SND_SOC_DAPM_POST_PMD),\n\tSND_SOC_DAPM_SUPPLY_S(\"ETDM2_IN_MCLK\", SUPPLY_SEQ_ETDM_MCLK,\n\t\t\t      SND_SOC_NOPM, 0, 0,\n\t\t\t      mtk_etdm_mclk_event,\n\t\t\t      SND_SOC_DAPM_PRE_PMU | SND_SOC_DAPM_POST_PMD),\n\tSND_SOC_DAPM_SUPPLY_S(\"ETDM1_OUT_MCLK\", SUPPLY_SEQ_ETDM_MCLK,\n\t\t\t      SND_SOC_NOPM, 0, 0,\n\t\t\t      mtk_etdm_mclk_event,\n\t\t\t      SND_SOC_DAPM_PRE_PMU | SND_SOC_DAPM_POST_PMD),\n\tSND_SOC_DAPM_SUPPLY_S(\"ETDM2_OUT_MCLK\", SUPPLY_SEQ_ETDM_MCLK,\n\t\t\t      SND_SOC_NOPM, 0, 0,\n\t\t\t      mtk_etdm_mclk_event,\n\t\t\t      SND_SOC_DAPM_PRE_PMU | SND_SOC_DAPM_POST_PMD),\n\tSND_SOC_DAPM_SUPPLY_S(\"DPTX_MCLK\", SUPPLY_SEQ_ETDM_MCLK,\n\t\t\t      SND_SOC_NOPM, 0, 0,\n\t\t\t      mtk_dptx_mclk_event,\n\t\t\t      SND_SOC_DAPM_PRE_PMU | SND_SOC_DAPM_POST_PMD),\n\n\t \n\tSND_SOC_DAPM_SUPPLY_S(\"ETDM1_IN_CG\", SUPPLY_SEQ_ETDM_CG,\n\t\t\t      SND_SOC_NOPM, 0, 0,\n\t\t\t      mtk_etdm_cg_event,\n\t\t\t      SND_SOC_DAPM_PRE_PMU | SND_SOC_DAPM_POST_PMD),\n\tSND_SOC_DAPM_SUPPLY_S(\"ETDM2_IN_CG\", SUPPLY_SEQ_ETDM_CG,\n\t\t\t      SND_SOC_NOPM, 0, 0,\n\t\t\t      mtk_etdm_cg_event,\n\t\t\t      SND_SOC_DAPM_PRE_PMU | SND_SOC_DAPM_POST_PMD),\n\tSND_SOC_DAPM_SUPPLY_S(\"ETDM1_OUT_CG\", SUPPLY_SEQ_ETDM_CG,\n\t\t\t      SND_SOC_NOPM, 0, 0,\n\t\t\t      mtk_etdm_cg_event,\n\t\t\t      SND_SOC_DAPM_PRE_PMU | SND_SOC_DAPM_POST_PMD),\n\tSND_SOC_DAPM_SUPPLY_S(\"ETDM2_OUT_CG\", SUPPLY_SEQ_ETDM_CG,\n\t\t\t      SND_SOC_NOPM, 0, 0,\n\t\t\t      mtk_etdm_cg_event,\n\t\t\t      SND_SOC_DAPM_PRE_PMU | SND_SOC_DAPM_POST_PMD),\n\tSND_SOC_DAPM_SUPPLY_S(\"ETDM3_OUT_CG\", SUPPLY_SEQ_ETDM_CG,\n\t\t\t      SND_SOC_NOPM, 0, 0,\n\t\t\t      mtk_etdm3_cg_event,\n\t\t\t      SND_SOC_DAPM_PRE_PMU | SND_SOC_DAPM_POST_PMD),\n\n\t \n\tSND_SOC_DAPM_SUPPLY_S(\"ETDM1_IN_EN\", SUPPLY_SEQ_ETDM_EN,\n\t\t\t      ETDM_IN1_CON0, ETDM_CON0_EN_SHIFT, 0, NULL, 0),\n\tSND_SOC_DAPM_SUPPLY_S(\"ETDM2_IN_EN\", SUPPLY_SEQ_ETDM_EN,\n\t\t\t      ETDM_IN2_CON0, ETDM_CON0_EN_SHIFT, 0, NULL, 0),\n\tSND_SOC_DAPM_SUPPLY_S(\"ETDM1_OUT_EN\", SUPPLY_SEQ_ETDM_EN,\n\t\t\t      ETDM_OUT1_CON0, ETDM_CON0_EN_SHIFT, 0, NULL, 0),\n\tSND_SOC_DAPM_SUPPLY_S(\"ETDM2_OUT_EN\", SUPPLY_SEQ_ETDM_EN,\n\t\t\t      ETDM_OUT2_CON0, ETDM_CON0_EN_SHIFT, 0, NULL, 0),\n\tSND_SOC_DAPM_SUPPLY_S(\"ETDM3_OUT_EN\", SUPPLY_SEQ_ETDM_EN,\n\t\t\t      ETDM_OUT3_CON0, ETDM_CON0_EN_SHIFT, 0, NULL, 0),\n\tSND_SOC_DAPM_SUPPLY_S(\"DPTX_EN\", SUPPLY_SEQ_DPTX_EN,\n\t\t\t      AFE_DPTX_CON, AFE_DPTX_CON_ON_SHIFT, 0, NULL, 0),\n\n\t \n\tSND_SOC_DAPM_SUPPLY_S(APLL1_W_NAME, SUPPLY_SEQ_APLL,\n\t\t\t      SND_SOC_NOPM, 0, 0,\n\t\t\t      mtk_apll_event,\n\t\t\t      SND_SOC_DAPM_PRE_PMU | SND_SOC_DAPM_POST_PMD),\n\tSND_SOC_DAPM_SUPPLY_S(APLL2_W_NAME, SUPPLY_SEQ_APLL,\n\t\t\t      SND_SOC_NOPM, 0, 0,\n\t\t\t      mtk_apll_event,\n\t\t\t      SND_SOC_DAPM_PRE_PMU | SND_SOC_DAPM_POST_PMD),\n\n\tSND_SOC_DAPM_INPUT(\"ETDM_INPUT\"),\n\tSND_SOC_DAPM_OUTPUT(\"ETDM_OUTPUT\"),\n};\n\nstatic const struct snd_soc_dapm_route mtk_dai_etdm_routes[] = {\n\t \n\t{\"ETDM1_IN\", NULL, \"ETDM1_IN_MCLK\", mtk_etdm_mclk_connect},\n\t{\"ETDM1_IN\", NULL, \"ETDM2_IN_MCLK\", mtk_etdm_mclk_connect},\n\t{\"ETDM1_IN\", NULL, \"ETDM1_OUT_MCLK\", mtk_etdm_mclk_connect},\n\t{\"ETDM1_IN\", NULL, \"ETDM2_OUT_MCLK\", mtk_etdm_mclk_connect},\n\n\t{\"ETDM2_IN\", NULL, \"ETDM1_IN_MCLK\", mtk_etdm_mclk_connect},\n\t{\"ETDM2_IN\", NULL, \"ETDM2_IN_MCLK\", mtk_etdm_mclk_connect},\n\t{\"ETDM2_IN\", NULL, \"ETDM1_OUT_MCLK\", mtk_etdm_mclk_connect},\n\t{\"ETDM2_IN\", NULL, \"ETDM2_OUT_MCLK\", mtk_etdm_mclk_connect},\n\n\t{\"ETDM1_OUT\", NULL, \"ETDM1_IN_MCLK\", mtk_etdm_mclk_connect},\n\t{\"ETDM1_OUT\", NULL, \"ETDM2_IN_MCLK\", mtk_etdm_mclk_connect},\n\t{\"ETDM1_OUT\", NULL, \"ETDM1_OUT_MCLK\", mtk_etdm_mclk_connect},\n\t{\"ETDM1_OUT\", NULL, \"ETDM2_OUT_MCLK\", mtk_etdm_mclk_connect},\n\n\t{\"ETDM2_OUT\", NULL, \"ETDM1_IN_MCLK\", mtk_etdm_mclk_connect},\n\t{\"ETDM2_OUT\", NULL, \"ETDM2_IN_MCLK\", mtk_etdm_mclk_connect},\n\t{\"ETDM2_OUT\", NULL, \"ETDM1_OUT_MCLK\", mtk_etdm_mclk_connect},\n\t{\"ETDM2_OUT\", NULL, \"ETDM2_OUT_MCLK\", mtk_etdm_mclk_connect},\n\n\t{\"DPTX\", NULL, \"DPTX_MCLK\"},\n\n\t{\"ETDM1_IN_MCLK\", NULL, APLL1_W_NAME, mtk_afe_mclk_apll_connect},\n\t{\"ETDM1_IN_MCLK\", NULL, APLL2_W_NAME, mtk_afe_mclk_apll_connect},\n\n\t{\"ETDM2_IN_MCLK\", NULL, APLL1_W_NAME, mtk_afe_mclk_apll_connect},\n\t{\"ETDM2_IN_MCLK\", NULL, APLL2_W_NAME, mtk_afe_mclk_apll_connect},\n\n\t{\"ETDM1_OUT_MCLK\", NULL, APLL1_W_NAME, mtk_afe_mclk_apll_connect},\n\t{\"ETDM1_OUT_MCLK\", NULL, APLL2_W_NAME, mtk_afe_mclk_apll_connect},\n\n\t{\"ETDM2_OUT_MCLK\", NULL, APLL1_W_NAME, mtk_afe_mclk_apll_connect},\n\t{\"ETDM2_OUT_MCLK\", NULL, APLL2_W_NAME, mtk_afe_mclk_apll_connect},\n\n\t{\"DPTX_MCLK\", NULL, APLL1_W_NAME, mtk_afe_mclk_apll_connect},\n\t{\"DPTX_MCLK\", NULL, APLL2_W_NAME, mtk_afe_mclk_apll_connect},\n\n\t \n\t{\"ETDM1_IN\", NULL, \"ETDM1_IN_CG\"},\n\t{\"ETDM1_IN\", NULL, \"ETDM2_IN_CG\", mtk_etdm_cowork_connect},\n\t{\"ETDM1_IN\", NULL, \"ETDM1_OUT_CG\", mtk_etdm_cowork_connect},\n\t{\"ETDM1_IN\", NULL, \"ETDM2_OUT_CG\", mtk_etdm_cowork_connect},\n\n\t{\"ETDM2_IN\", NULL, \"ETDM1_IN_CG\", mtk_etdm_cowork_connect},\n\t{\"ETDM2_IN\", NULL, \"ETDM2_IN_CG\"},\n\t{\"ETDM2_IN\", NULL, \"ETDM1_OUT_CG\", mtk_etdm_cowork_connect},\n\t{\"ETDM2_IN\", NULL, \"ETDM2_OUT_CG\", mtk_etdm_cowork_connect},\n\n\t{\"ETDM1_OUT\", NULL, \"ETDM1_IN_CG\", mtk_etdm_cowork_connect},\n\t{\"ETDM1_OUT\", NULL, \"ETDM2_IN_CG\", mtk_etdm_cowork_connect},\n\t{\"ETDM1_OUT\", NULL, \"ETDM1_OUT_CG\"},\n\t{\"ETDM1_OUT\", NULL, \"ETDM2_OUT_CG\", mtk_etdm_cowork_connect},\n\n\t{\"ETDM2_OUT\", NULL, \"ETDM1_IN_CG\", mtk_etdm_cowork_connect},\n\t{\"ETDM2_OUT\", NULL, \"ETDM2_IN_CG\", mtk_etdm_cowork_connect},\n\t{\"ETDM2_OUT\", NULL, \"ETDM1_OUT_CG\", mtk_etdm_cowork_connect},\n\t{\"ETDM2_OUT\", NULL, \"ETDM2_OUT_CG\"},\n\n\t{\"ETDM3_OUT\", NULL, \"ETDM3_OUT_CG\"},\n\t{\"DPTX\", NULL, \"ETDM3_OUT_CG\"},\n\n\t \n\t{\"ETDM1_IN\", NULL, \"ETDM1_IN_EN\"},\n\t{\"ETDM1_IN\", NULL, \"ETDM2_IN_EN\", mtk_etdm_cowork_connect},\n\t{\"ETDM1_IN\", NULL, \"ETDM1_OUT_EN\", mtk_etdm_cowork_connect},\n\t{\"ETDM1_IN\", NULL, \"ETDM2_OUT_EN\", mtk_etdm_cowork_connect},\n\n\t{\"ETDM2_IN\", NULL, \"ETDM1_IN_EN\", mtk_etdm_cowork_connect},\n\t{\"ETDM2_IN\", NULL, \"ETDM2_IN_EN\"},\n\t{\"ETDM2_IN\", NULL, \"ETDM1_OUT_EN\", mtk_etdm_cowork_connect},\n\t{\"ETDM2_IN\", NULL, \"ETDM2_OUT_EN\", mtk_etdm_cowork_connect},\n\n\t{\"ETDM1_OUT\", NULL, \"ETDM1_IN_EN\", mtk_etdm_cowork_connect},\n\t{\"ETDM1_OUT\", NULL, \"ETDM2_IN_EN\", mtk_etdm_cowork_connect},\n\t{\"ETDM1_OUT\", NULL, \"ETDM1_OUT_EN\"},\n\t{\"ETDM1_OUT\", NULL, \"ETDM2_OUT_EN\", mtk_etdm_cowork_connect},\n\n\t{\"ETDM2_OUT\", NULL, \"ETDM1_IN_EN\", mtk_etdm_cowork_connect},\n\t{\"ETDM2_OUT\", NULL, \"ETDM2_IN_EN\", mtk_etdm_cowork_connect},\n\t{\"ETDM2_OUT\", NULL, \"ETDM1_OUT_EN\", mtk_etdm_cowork_connect},\n\t{\"ETDM2_OUT\", NULL, \"ETDM2_OUT_EN\"},\n\n\t{\"ETDM3_OUT\", NULL, \"ETDM3_OUT_EN\"},\n\t{\"DPTX\", NULL, \"ETDM3_OUT_EN\"},\n\t{\"DPTX\", NULL, \"DPTX_EN\"},\n\n\t{\"ETDM1_IN_EN\", NULL, APLL1_W_NAME, mtk_afe_etdm_apll_connect},\n\t{\"ETDM1_IN_EN\", NULL, APLL2_W_NAME, mtk_afe_etdm_apll_connect},\n\n\t{\"ETDM2_IN_EN\", NULL, APLL1_W_NAME, mtk_afe_etdm_apll_connect},\n\t{\"ETDM2_IN_EN\", NULL, APLL2_W_NAME, mtk_afe_etdm_apll_connect},\n\n\t{\"ETDM1_OUT_EN\", NULL, APLL1_W_NAME, mtk_afe_etdm_apll_connect},\n\t{\"ETDM1_OUT_EN\", NULL, APLL2_W_NAME, mtk_afe_etdm_apll_connect},\n\n\t{\"ETDM2_OUT_EN\", NULL, APLL1_W_NAME, mtk_afe_etdm_apll_connect},\n\t{\"ETDM2_OUT_EN\", NULL, APLL2_W_NAME, mtk_afe_etdm_apll_connect},\n\n\t{\"ETDM3_OUT_EN\", NULL, APLL1_W_NAME, mtk_afe_etdm_apll_connect},\n\t{\"ETDM3_OUT_EN\", NULL, APLL2_W_NAME, mtk_afe_etdm_apll_connect},\n\n\t{\"I012\", NULL, \"ETDM2_IN\"},\n\t{\"I013\", NULL, \"ETDM2_IN\"},\n\t{\"I014\", NULL, \"ETDM2_IN\"},\n\t{\"I015\", NULL, \"ETDM2_IN\"},\n\t{\"I016\", NULL, \"ETDM2_IN\"},\n\t{\"I017\", NULL, \"ETDM2_IN\"},\n\t{\"I018\", NULL, \"ETDM2_IN\"},\n\t{\"I019\", NULL, \"ETDM2_IN\"},\n\t{\"I188\", NULL, \"ETDM2_IN\"},\n\t{\"I189\", NULL, \"ETDM2_IN\"},\n\t{\"I190\", NULL, \"ETDM2_IN\"},\n\t{\"I191\", NULL, \"ETDM2_IN\"},\n\t{\"I192\", NULL, \"ETDM2_IN\"},\n\t{\"I193\", NULL, \"ETDM2_IN\"},\n\t{\"I194\", NULL, \"ETDM2_IN\"},\n\t{\"I195\", NULL, \"ETDM2_IN\"},\n\n\t{\"I072\", NULL, \"ETDM1_IN\"},\n\t{\"I073\", NULL, \"ETDM1_IN\"},\n\t{\"I074\", NULL, \"ETDM1_IN\"},\n\t{\"I075\", NULL, \"ETDM1_IN\"},\n\t{\"I076\", NULL, \"ETDM1_IN\"},\n\t{\"I077\", NULL, \"ETDM1_IN\"},\n\t{\"I078\", NULL, \"ETDM1_IN\"},\n\t{\"I079\", NULL, \"ETDM1_IN\"},\n\t{\"I080\", NULL, \"ETDM1_IN\"},\n\t{\"I081\", NULL, \"ETDM1_IN\"},\n\t{\"I082\", NULL, \"ETDM1_IN\"},\n\t{\"I083\", NULL, \"ETDM1_IN\"},\n\t{\"I084\", NULL, \"ETDM1_IN\"},\n\t{\"I085\", NULL, \"ETDM1_IN\"},\n\t{\"I086\", NULL, \"ETDM1_IN\"},\n\t{\"I087\", NULL, \"ETDM1_IN\"},\n\n\t{\"UL8\", NULL, \"ETDM1_IN\"},\n\t{\"UL3\", NULL, \"ETDM2_IN\"},\n\n\t{\"ETDM2_OUT\", NULL, \"O048\"},\n\t{\"ETDM2_OUT\", NULL, \"O049\"},\n\t{\"ETDM2_OUT\", NULL, \"O050\"},\n\t{\"ETDM2_OUT\", NULL, \"O051\"},\n\t{\"ETDM2_OUT\", NULL, \"O052\"},\n\t{\"ETDM2_OUT\", NULL, \"O053\"},\n\t{\"ETDM2_OUT\", NULL, \"O054\"},\n\t{\"ETDM2_OUT\", NULL, \"O055\"},\n\t{\"ETDM2_OUT\", NULL, \"O056\"},\n\t{\"ETDM2_OUT\", NULL, \"O057\"},\n\t{\"ETDM2_OUT\", NULL, \"O058\"},\n\t{\"ETDM2_OUT\", NULL, \"O059\"},\n\t{\"ETDM2_OUT\", NULL, \"O060\"},\n\t{\"ETDM2_OUT\", NULL, \"O061\"},\n\t{\"ETDM2_OUT\", NULL, \"O062\"},\n\t{\"ETDM2_OUT\", NULL, \"O063\"},\n\n\t{\"ETDM1_OUT\", NULL, \"O072\"},\n\t{\"ETDM1_OUT\", NULL, \"O073\"},\n\t{\"ETDM1_OUT\", NULL, \"O074\"},\n\t{\"ETDM1_OUT\", NULL, \"O075\"},\n\t{\"ETDM1_OUT\", NULL, \"O076\"},\n\t{\"ETDM1_OUT\", NULL, \"O077\"},\n\t{\"ETDM1_OUT\", NULL, \"O078\"},\n\t{\"ETDM1_OUT\", NULL, \"O079\"},\n\t{\"ETDM1_OUT\", NULL, \"O080\"},\n\t{\"ETDM1_OUT\", NULL, \"O081\"},\n\t{\"ETDM1_OUT\", NULL, \"O082\"},\n\t{\"ETDM1_OUT\", NULL, \"O083\"},\n\t{\"ETDM1_OUT\", NULL, \"O084\"},\n\t{\"ETDM1_OUT\", NULL, \"O085\"},\n\t{\"ETDM1_OUT\", NULL, \"O086\"},\n\t{\"ETDM1_OUT\", NULL, \"O087\"},\n\n\t{\"O048\", \"I020 Switch\", \"I020\"},\n\t{\"O049\", \"I021 Switch\", \"I021\"},\n\n\t{\"O048\", \"I022 Switch\", \"I022\"},\n\t{\"O049\", \"I023 Switch\", \"I023\"},\n\t{\"O050\", \"I024 Switch\", \"I024\"},\n\t{\"O051\", \"I025 Switch\", \"I025\"},\n\t{\"O052\", \"I026 Switch\", \"I026\"},\n\t{\"O053\", \"I027 Switch\", \"I027\"},\n\t{\"O054\", \"I028 Switch\", \"I028\"},\n\t{\"O055\", \"I029 Switch\", \"I029\"},\n\t{\"O056\", \"I030 Switch\", \"I030\"},\n\t{\"O057\", \"I031 Switch\", \"I031\"},\n\t{\"O058\", \"I032 Switch\", \"I032\"},\n\t{\"O059\", \"I033 Switch\", \"I033\"},\n\t{\"O060\", \"I034 Switch\", \"I034\"},\n\t{\"O061\", \"I035 Switch\", \"I035\"},\n\t{\"O062\", \"I036 Switch\", \"I036\"},\n\t{\"O063\", \"I037 Switch\", \"I037\"},\n\n\t{\"O048\", \"I046 Switch\", \"I046\"},\n\t{\"O049\", \"I047 Switch\", \"I047\"},\n\t{\"O050\", \"I048 Switch\", \"I048\"},\n\t{\"O051\", \"I049 Switch\", \"I049\"},\n\t{\"O052\", \"I050 Switch\", \"I050\"},\n\t{\"O053\", \"I051 Switch\", \"I051\"},\n\t{\"O054\", \"I052 Switch\", \"I052\"},\n\t{\"O055\", \"I053 Switch\", \"I053\"},\n\t{\"O056\", \"I054 Switch\", \"I054\"},\n\t{\"O057\", \"I055 Switch\", \"I055\"},\n\t{\"O058\", \"I056 Switch\", \"I056\"},\n\t{\"O059\", \"I057 Switch\", \"I057\"},\n\t{\"O060\", \"I058 Switch\", \"I058\"},\n\t{\"O061\", \"I059 Switch\", \"I059\"},\n\t{\"O062\", \"I060 Switch\", \"I060\"},\n\t{\"O063\", \"I061 Switch\", \"I061\"},\n\n\t{\"O048\", \"I070 Switch\", \"I070\"},\n\t{\"O049\", \"I071 Switch\", \"I071\"},\n\n\t{\"O072\", \"I020 Switch\", \"I020\"},\n\t{\"O073\", \"I021 Switch\", \"I021\"},\n\n\t{\"O072\", \"I022 Switch\", \"I022\"},\n\t{\"O073\", \"I023 Switch\", \"I023\"},\n\t{\"O074\", \"I024 Switch\", \"I024\"},\n\t{\"O075\", \"I025 Switch\", \"I025\"},\n\t{\"O076\", \"I026 Switch\", \"I026\"},\n\t{\"O077\", \"I027 Switch\", \"I027\"},\n\t{\"O078\", \"I028 Switch\", \"I028\"},\n\t{\"O079\", \"I029 Switch\", \"I029\"},\n\t{\"O080\", \"I030 Switch\", \"I030\"},\n\t{\"O081\", \"I031 Switch\", \"I031\"},\n\t{\"O082\", \"I032 Switch\", \"I032\"},\n\t{\"O083\", \"I033 Switch\", \"I033\"},\n\t{\"O084\", \"I034 Switch\", \"I034\"},\n\t{\"O085\", \"I035 Switch\", \"I035\"},\n\t{\"O086\", \"I036 Switch\", \"I036\"},\n\t{\"O087\", \"I037 Switch\", \"I037\"},\n\n\t{\"O072\", \"I046 Switch\", \"I046\"},\n\t{\"O073\", \"I047 Switch\", \"I047\"},\n\t{\"O074\", \"I048 Switch\", \"I048\"},\n\t{\"O075\", \"I049 Switch\", \"I049\"},\n\t{\"O076\", \"I050 Switch\", \"I050\"},\n\t{\"O077\", \"I051 Switch\", \"I051\"},\n\t{\"O078\", \"I052 Switch\", \"I052\"},\n\t{\"O079\", \"I053 Switch\", \"I053\"},\n\t{\"O080\", \"I054 Switch\", \"I054\"},\n\t{\"O081\", \"I055 Switch\", \"I055\"},\n\t{\"O082\", \"I056 Switch\", \"I056\"},\n\t{\"O083\", \"I057 Switch\", \"I057\"},\n\t{\"O084\", \"I058 Switch\", \"I058\"},\n\t{\"O085\", \"I059 Switch\", \"I059\"},\n\t{\"O086\", \"I060 Switch\", \"I060\"},\n\t{\"O087\", \"I061 Switch\", \"I061\"},\n\n\t{\"O072\", \"I070 Switch\", \"I070\"},\n\t{\"O073\", \"I071 Switch\", \"I071\"},\n\n\t{\"HDMI_CH0_MUX\", \"CH0\", \"DL10\"},\n\t{\"HDMI_CH0_MUX\", \"CH1\", \"DL10\"},\n\t{\"HDMI_CH0_MUX\", \"CH2\", \"DL10\"},\n\t{\"HDMI_CH0_MUX\", \"CH3\", \"DL10\"},\n\t{\"HDMI_CH0_MUX\", \"CH4\", \"DL10\"},\n\t{\"HDMI_CH0_MUX\", \"CH5\", \"DL10\"},\n\t{\"HDMI_CH0_MUX\", \"CH6\", \"DL10\"},\n\t{\"HDMI_CH0_MUX\", \"CH7\", \"DL10\"},\n\n\t{\"HDMI_CH1_MUX\", \"CH0\", \"DL10\"},\n\t{\"HDMI_CH1_MUX\", \"CH1\", \"DL10\"},\n\t{\"HDMI_CH1_MUX\", \"CH2\", \"DL10\"},\n\t{\"HDMI_CH1_MUX\", \"CH3\", \"DL10\"},\n\t{\"HDMI_CH1_MUX\", \"CH4\", \"DL10\"},\n\t{\"HDMI_CH1_MUX\", \"CH5\", \"DL10\"},\n\t{\"HDMI_CH1_MUX\", \"CH6\", \"DL10\"},\n\t{\"HDMI_CH1_MUX\", \"CH7\", \"DL10\"},\n\n\t{\"HDMI_CH2_MUX\", \"CH0\", \"DL10\"},\n\t{\"HDMI_CH2_MUX\", \"CH1\", \"DL10\"},\n\t{\"HDMI_CH2_MUX\", \"CH2\", \"DL10\"},\n\t{\"HDMI_CH2_MUX\", \"CH3\", \"DL10\"},\n\t{\"HDMI_CH2_MUX\", \"CH4\", \"DL10\"},\n\t{\"HDMI_CH2_MUX\", \"CH5\", \"DL10\"},\n\t{\"HDMI_CH2_MUX\", \"CH6\", \"DL10\"},\n\t{\"HDMI_CH2_MUX\", \"CH7\", \"DL10\"},\n\n\t{\"HDMI_CH3_MUX\", \"CH0\", \"DL10\"},\n\t{\"HDMI_CH3_MUX\", \"CH1\", \"DL10\"},\n\t{\"HDMI_CH3_MUX\", \"CH2\", \"DL10\"},\n\t{\"HDMI_CH3_MUX\", \"CH3\", \"DL10\"},\n\t{\"HDMI_CH3_MUX\", \"CH4\", \"DL10\"},\n\t{\"HDMI_CH3_MUX\", \"CH5\", \"DL10\"},\n\t{\"HDMI_CH3_MUX\", \"CH6\", \"DL10\"},\n\t{\"HDMI_CH3_MUX\", \"CH7\", \"DL10\"},\n\n\t{\"HDMI_CH4_MUX\", \"CH0\", \"DL10\"},\n\t{\"HDMI_CH4_MUX\", \"CH1\", \"DL10\"},\n\t{\"HDMI_CH4_MUX\", \"CH2\", \"DL10\"},\n\t{\"HDMI_CH4_MUX\", \"CH3\", \"DL10\"},\n\t{\"HDMI_CH4_MUX\", \"CH4\", \"DL10\"},\n\t{\"HDMI_CH4_MUX\", \"CH5\", \"DL10\"},\n\t{\"HDMI_CH4_MUX\", \"CH6\", \"DL10\"},\n\t{\"HDMI_CH4_MUX\", \"CH7\", \"DL10\"},\n\n\t{\"HDMI_CH5_MUX\", \"CH0\", \"DL10\"},\n\t{\"HDMI_CH5_MUX\", \"CH1\", \"DL10\"},\n\t{\"HDMI_CH5_MUX\", \"CH2\", \"DL10\"},\n\t{\"HDMI_CH5_MUX\", \"CH3\", \"DL10\"},\n\t{\"HDMI_CH5_MUX\", \"CH4\", \"DL10\"},\n\t{\"HDMI_CH5_MUX\", \"CH5\", \"DL10\"},\n\t{\"HDMI_CH5_MUX\", \"CH6\", \"DL10\"},\n\t{\"HDMI_CH5_MUX\", \"CH7\", \"DL10\"},\n\n\t{\"HDMI_CH6_MUX\", \"CH0\", \"DL10\"},\n\t{\"HDMI_CH6_MUX\", \"CH1\", \"DL10\"},\n\t{\"HDMI_CH6_MUX\", \"CH2\", \"DL10\"},\n\t{\"HDMI_CH6_MUX\", \"CH3\", \"DL10\"},\n\t{\"HDMI_CH6_MUX\", \"CH4\", \"DL10\"},\n\t{\"HDMI_CH6_MUX\", \"CH5\", \"DL10\"},\n\t{\"HDMI_CH6_MUX\", \"CH6\", \"DL10\"},\n\t{\"HDMI_CH6_MUX\", \"CH7\", \"DL10\"},\n\n\t{\"HDMI_CH7_MUX\", \"CH0\", \"DL10\"},\n\t{\"HDMI_CH7_MUX\", \"CH1\", \"DL10\"},\n\t{\"HDMI_CH7_MUX\", \"CH2\", \"DL10\"},\n\t{\"HDMI_CH7_MUX\", \"CH3\", \"DL10\"},\n\t{\"HDMI_CH7_MUX\", \"CH4\", \"DL10\"},\n\t{\"HDMI_CH7_MUX\", \"CH5\", \"DL10\"},\n\t{\"HDMI_CH7_MUX\", \"CH6\", \"DL10\"},\n\t{\"HDMI_CH7_MUX\", \"CH7\", \"DL10\"},\n\n\t{\"HDMI_OUT_MUX\", \"Connect\", \"HDMI_CH0_MUX\"},\n\t{\"HDMI_OUT_MUX\", \"Connect\", \"HDMI_CH1_MUX\"},\n\t{\"HDMI_OUT_MUX\", \"Connect\", \"HDMI_CH2_MUX\"},\n\t{\"HDMI_OUT_MUX\", \"Connect\", \"HDMI_CH3_MUX\"},\n\t{\"HDMI_OUT_MUX\", \"Connect\", \"HDMI_CH4_MUX\"},\n\t{\"HDMI_OUT_MUX\", \"Connect\", \"HDMI_CH5_MUX\"},\n\t{\"HDMI_OUT_MUX\", \"Connect\", \"HDMI_CH6_MUX\"},\n\t{\"HDMI_OUT_MUX\", \"Connect\", \"HDMI_CH7_MUX\"},\n\n\t{\"DPTX_OUT_MUX\", \"Connect\", \"HDMI_CH0_MUX\"},\n\t{\"DPTX_OUT_MUX\", \"Connect\", \"HDMI_CH1_MUX\"},\n\t{\"DPTX_OUT_MUX\", \"Connect\", \"HDMI_CH2_MUX\"},\n\t{\"DPTX_OUT_MUX\", \"Connect\", \"HDMI_CH3_MUX\"},\n\t{\"DPTX_OUT_MUX\", \"Connect\", \"HDMI_CH4_MUX\"},\n\t{\"DPTX_OUT_MUX\", \"Connect\", \"HDMI_CH5_MUX\"},\n\t{\"DPTX_OUT_MUX\", \"Connect\", \"HDMI_CH6_MUX\"},\n\t{\"DPTX_OUT_MUX\", \"Connect\", \"HDMI_CH7_MUX\"},\n\n\t{\"ETDM3_OUT\", NULL, \"HDMI_OUT_MUX\"},\n\t{\"DPTX\", NULL, \"DPTX_OUT_MUX\"},\n\n\t{\"ETDM_OUTPUT\", NULL, \"DPTX\"},\n\t{\"ETDM_OUTPUT\", NULL, \"ETDM1_OUT\"},\n\t{\"ETDM_OUTPUT\", NULL, \"ETDM2_OUT\"},\n\t{\"ETDM_OUTPUT\", NULL, \"ETDM3_OUT\"},\n\t{\"ETDM1_IN\", NULL, \"ETDM_INPUT\"},\n\t{\"ETDM2_IN\", NULL, \"ETDM_INPUT\"},\n};\n\nstatic int etdm_cowork_slv_sel(int id, int slave_mode)\n{\n\tif (slave_mode) {\n\t\tswitch (id) {\n\t\tcase MT8188_AFE_IO_ETDM1_IN:\n\t\t\treturn COWORK_ETDM_IN1_S;\n\t\tcase MT8188_AFE_IO_ETDM2_IN:\n\t\t\treturn COWORK_ETDM_IN2_S;\n\t\tcase MT8188_AFE_IO_ETDM1_OUT:\n\t\t\treturn COWORK_ETDM_OUT1_S;\n\t\tcase MT8188_AFE_IO_ETDM2_OUT:\n\t\t\treturn COWORK_ETDM_OUT2_S;\n\t\tcase MT8188_AFE_IO_ETDM3_OUT:\n\t\t\treturn COWORK_ETDM_OUT3_S;\n\t\tdefault:\n\t\t\treturn -EINVAL;\n\t\t}\n\t} else {\n\t\tswitch (id) {\n\t\tcase MT8188_AFE_IO_ETDM1_IN:\n\t\t\treturn COWORK_ETDM_IN1_M;\n\t\tcase MT8188_AFE_IO_ETDM2_IN:\n\t\t\treturn COWORK_ETDM_IN2_M;\n\t\tcase MT8188_AFE_IO_ETDM1_OUT:\n\t\t\treturn COWORK_ETDM_OUT1_M;\n\t\tcase MT8188_AFE_IO_ETDM2_OUT:\n\t\t\treturn COWORK_ETDM_OUT2_M;\n\t\tcase MT8188_AFE_IO_ETDM3_OUT:\n\t\t\treturn COWORK_ETDM_OUT3_M;\n\t\tdefault:\n\t\t\treturn -EINVAL;\n\t\t}\n\t}\n}\n\nstatic int etdm_cowork_sync_sel(int id)\n{\n\tswitch (id) {\n\tcase MT8188_AFE_IO_ETDM1_IN:\n\t\treturn ETDM_SYNC_FROM_IN1;\n\tcase MT8188_AFE_IO_ETDM2_IN:\n\t\treturn ETDM_SYNC_FROM_IN2;\n\tcase MT8188_AFE_IO_ETDM1_OUT:\n\t\treturn ETDM_SYNC_FROM_OUT1;\n\tcase MT8188_AFE_IO_ETDM2_OUT:\n\t\treturn ETDM_SYNC_FROM_OUT2;\n\tcase MT8188_AFE_IO_ETDM3_OUT:\n\t\treturn ETDM_SYNC_FROM_OUT3;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n}\n\nstatic int mt8188_etdm_sync_mode_slv(struct mtk_base_afe *afe, int dai_id)\n{\n\tstruct mt8188_afe_private *afe_priv = afe->platform_priv;\n\tstruct mtk_dai_etdm_priv *etdm_data;\n\tunsigned int reg = 0;\n\tunsigned int mask;\n\tunsigned int val;\n\tint cowork_source_sel;\n\n\tif (!is_valid_etdm_dai(dai_id))\n\t\treturn -EINVAL;\n\tetdm_data = afe_priv->dai_priv[dai_id];\n\n\tcowork_source_sel = etdm_cowork_slv_sel(etdm_data->cowork_source_id,\n\t\t\t\t\t\ttrue);\n\tif (cowork_source_sel < 0)\n\t\treturn cowork_source_sel;\n\n\tswitch (dai_id) {\n\tcase MT8188_AFE_IO_ETDM1_IN:\n\t\treg = ETDM_COWORK_CON1;\n\t\tmask = ETDM_IN1_SLAVE_SEL_MASK;\n\t\tval = FIELD_PREP(ETDM_IN1_SLAVE_SEL_MASK, cowork_source_sel);\n\t\tbreak;\n\tcase MT8188_AFE_IO_ETDM2_IN:\n\t\treg = ETDM_COWORK_CON2;\n\t\tmask = ETDM_IN2_SLAVE_SEL_MASK;\n\t\tval = FIELD_PREP(ETDM_IN2_SLAVE_SEL_MASK, cowork_source_sel);\n\t\tbreak;\n\tcase MT8188_AFE_IO_ETDM1_OUT:\n\t\treg = ETDM_COWORK_CON0;\n\t\tmask = ETDM_OUT1_SLAVE_SEL_MASK;\n\t\tval = FIELD_PREP(ETDM_OUT1_SLAVE_SEL_MASK, cowork_source_sel);\n\t\tbreak;\n\tcase MT8188_AFE_IO_ETDM2_OUT:\n\t\treg = ETDM_COWORK_CON2;\n\t\tmask = ETDM_OUT2_SLAVE_SEL_MASK;\n\t\tval = FIELD_PREP(ETDM_OUT2_SLAVE_SEL_MASK, cowork_source_sel);\n\t\tbreak;\n\tcase MT8188_AFE_IO_ETDM3_OUT:\n\t\treg = ETDM_COWORK_CON2;\n\t\tmask = ETDM_OUT3_SLAVE_SEL_MASK;\n\t\tval = FIELD_PREP(ETDM_OUT3_SLAVE_SEL_MASK, cowork_source_sel);\n\t\tbreak;\n\tdefault:\n\t\treturn 0;\n\t}\n\n\tregmap_update_bits(afe->regmap, reg, mask, val);\n\n\treturn 0;\n}\n\nstatic int mt8188_etdm_sync_mode_mst(struct mtk_base_afe *afe, int dai_id)\n{\n\tstruct mt8188_afe_private *afe_priv = afe->platform_priv;\n\tstruct mtk_dai_etdm_priv *etdm_data;\n\tstruct etdm_con_reg etdm_reg;\n\tunsigned int reg = 0;\n\tunsigned int mask;\n\tunsigned int val;\n\tint cowork_source_sel;\n\tint ret;\n\n\tif (!is_valid_etdm_dai(dai_id))\n\t\treturn -EINVAL;\n\tetdm_data = afe_priv->dai_priv[dai_id];\n\n\tcowork_source_sel = etdm_cowork_sync_sel(etdm_data->cowork_source_id);\n\tif (cowork_source_sel < 0)\n\t\treturn cowork_source_sel;\n\n\tswitch (dai_id) {\n\tcase MT8188_AFE_IO_ETDM1_IN:\n\t\treg = ETDM_COWORK_CON1;\n\t\tmask = ETDM_IN1_SYNC_SEL_MASK;\n\t\tval = FIELD_PREP(ETDM_IN1_SYNC_SEL_MASK, cowork_source_sel);\n\t\tbreak;\n\tcase MT8188_AFE_IO_ETDM2_IN:\n\t\treg = ETDM_COWORK_CON2;\n\t\tmask = ETDM_IN2_SYNC_SEL_MASK;\n\t\tval = FIELD_PREP(ETDM_IN2_SYNC_SEL_MASK, cowork_source_sel);\n\t\tbreak;\n\tcase MT8188_AFE_IO_ETDM1_OUT:\n\t\treg = ETDM_COWORK_CON0;\n\t\tmask = ETDM_OUT1_SYNC_SEL_MASK;\n\t\tval = FIELD_PREP(ETDM_OUT1_SYNC_SEL_MASK, cowork_source_sel);\n\t\tbreak;\n\tcase MT8188_AFE_IO_ETDM2_OUT:\n\t\treg = ETDM_COWORK_CON2;\n\t\tmask = ETDM_OUT2_SYNC_SEL_MASK;\n\t\tval = FIELD_PREP(ETDM_OUT2_SYNC_SEL_MASK, cowork_source_sel);\n\t\tbreak;\n\tcase MT8188_AFE_IO_ETDM3_OUT:\n\t\treg = ETDM_COWORK_CON2;\n\t\tmask = ETDM_OUT3_SYNC_SEL_MASK;\n\t\tval = FIELD_PREP(ETDM_OUT3_SYNC_SEL_MASK, cowork_source_sel);\n\t\tbreak;\n\tdefault:\n\t\treturn 0;\n\t}\n\n\tret = get_etdm_reg(dai_id, &etdm_reg);\n\tif (ret < 0)\n\t\treturn ret;\n\n\tregmap_update_bits(afe->regmap, reg, mask, val);\n\n\tregmap_set_bits(afe->regmap, etdm_reg.con0, ETDM_CON0_SYNC_MODE);\n\n\treturn 0;\n}\n\nstatic int mt8188_etdm_sync_mode_configure(struct mtk_base_afe *afe, int dai_id)\n{\n\tstruct mt8188_afe_private *afe_priv = afe->platform_priv;\n\tstruct mtk_dai_etdm_priv *etdm_data;\n\n\tif (!is_valid_etdm_dai(dai_id))\n\t\treturn -EINVAL;\n\tetdm_data = afe_priv->dai_priv[dai_id];\n\n\tif (etdm_data->cowork_source_id == COWORK_ETDM_NONE)\n\t\treturn 0;\n\n\tif (etdm_data->slave_mode)\n\t\tmt8188_etdm_sync_mode_slv(afe, dai_id);\n\telse\n\t\tmt8188_etdm_sync_mode_mst(afe, dai_id);\n\n\treturn 0;\n}\n\n \nstatic int mtk_dai_etdm_fifo_mode(struct mtk_base_afe *afe,\n\t\t\t\t  int dai_id, unsigned int rate)\n{\n\tunsigned int mode = 0;\n\tunsigned int reg = 0;\n\tunsigned int val = 0;\n\tunsigned int mask = (ETDM_IN_AFIFO_MODE_MASK | ETDM_IN_USE_AFIFO);\n\n\tif (rate != 0)\n\t\tmode = mt8188_afe_fs_timing(rate);\n\n\tswitch (dai_id) {\n\tcase MT8188_AFE_IO_ETDM1_IN:\n\t\treg = ETDM_IN1_AFIFO_CON;\n\t\tif (rate == 0)\n\t\t\tmode = MT8188_ETDM_IN1_1X_EN;\n\t\tbreak;\n\tcase MT8188_AFE_IO_ETDM2_IN:\n\t\treg = ETDM_IN2_AFIFO_CON;\n\t\tif (rate == 0)\n\t\t\tmode = MT8188_ETDM_IN2_1X_EN;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tval = (mode | ETDM_IN_USE_AFIFO);\n\n\tregmap_update_bits(afe->regmap, reg, mask, val);\n\treturn 0;\n}\n\nstatic int mtk_dai_etdm_in_configure(struct mtk_base_afe *afe,\n\t\t\t\t     unsigned int rate,\n\t\t\t\t     unsigned int channels,\n\t\t\t\t     int dai_id)\n{\n\tstruct mt8188_afe_private *afe_priv = afe->platform_priv;\n\tstruct mtk_dai_etdm_priv *etdm_data;\n\tstruct etdm_con_reg etdm_reg;\n\tbool slave_mode;\n\tunsigned int data_mode;\n\tunsigned int lrck_width;\n\tunsigned int val = 0;\n\tunsigned int mask = 0;\n\tint ret;\n\tint i;\n\n\tif (!is_valid_etdm_dai(dai_id))\n\t\treturn -EINVAL;\n\tetdm_data = afe_priv->dai_priv[dai_id];\n\tslave_mode = etdm_data->slave_mode;\n\tdata_mode = etdm_data->data_mode;\n\tlrck_width = etdm_data->lrck_width;\n\n\tdev_dbg(afe->dev, \"%s rate %u channels %u, id %d\\n\",\n\t\t__func__, rate, channels, dai_id);\n\n\tret = get_etdm_reg(dai_id, &etdm_reg);\n\tif (ret < 0)\n\t\treturn ret;\n\n\t \n\tif (slave_mode)\n\t\tmtk_dai_etdm_fifo_mode(afe, dai_id, 0);\n\telse\n\t\tmtk_dai_etdm_fifo_mode(afe, dai_id, rate);\n\n\t \n\tif (lrck_width > 0) {\n\t\tmask |= (ETDM_IN_CON1_LRCK_AUTO_MODE |\n\t\t\tETDM_IN_CON1_LRCK_WIDTH_MASK);\n\t\tval |= FIELD_PREP(ETDM_IN_CON1_LRCK_WIDTH_MASK, lrck_width - 1);\n\t}\n\tregmap_update_bits(afe->regmap, etdm_reg.con1, mask, val);\n\n\tmask = 0;\n\tval = 0;\n\n\t \n\tif (!slave_mode) {\n\t\tmask |= ETDM_IN_CON2_UPDATE_GAP_MASK;\n\t\tif (rate == 352800 || rate == 384000)\n\t\t\tval |= FIELD_PREP(ETDM_IN_CON2_UPDATE_GAP_MASK, 4);\n\t\telse\n\t\t\tval |= FIELD_PREP(ETDM_IN_CON2_UPDATE_GAP_MASK, 3);\n\t}\n\tmask |= (ETDM_IN_CON2_MULTI_IP_2CH_MODE |\n\t\tETDM_IN_CON2_MULTI_IP_TOTAL_CH_MASK);\n\tif (data_mode == MTK_DAI_ETDM_DATA_MULTI_PIN) {\n\t\tval |= ETDM_IN_CON2_MULTI_IP_2CH_MODE |\n\t\t       FIELD_PREP(ETDM_IN_CON2_MULTI_IP_TOTAL_CH_MASK, channels - 1);\n\t}\n\tregmap_update_bits(afe->regmap, etdm_reg.con2, mask, val);\n\n\tmask = 0;\n\tval = 0;\n\n\t \n\tmask |= ETDM_IN_CON3_DISABLE_OUT_MASK;\n\tfor (i = 0; i < channels; i += 2) {\n\t\tif (etdm_data->in_disable_ch[i] &&\n\t\t    etdm_data->in_disable_ch[i + 1])\n\t\t\tval |= ETDM_IN_CON3_DISABLE_OUT(i >> 1);\n\t}\n\tif (!slave_mode) {\n\t\tmask |= ETDM_IN_CON3_FS_MASK;\n\t\tval |= FIELD_PREP(ETDM_IN_CON3_FS_MASK, get_etdm_fs_timing(rate));\n\t}\n\tregmap_update_bits(afe->regmap, etdm_reg.con3, mask, val);\n\n\tmask = 0;\n\tval = 0;\n\n\t \n\tmask |= (ETDM_IN_CON4_MASTER_LRCK_INV | ETDM_IN_CON4_MASTER_BCK_INV |\n\t\tETDM_IN_CON4_SLAVE_LRCK_INV | ETDM_IN_CON4_SLAVE_BCK_INV);\n\tif (slave_mode) {\n\t\tif (etdm_data->lrck_inv)\n\t\t\tval |= ETDM_IN_CON4_SLAVE_LRCK_INV;\n\t\tif (etdm_data->bck_inv)\n\t\t\tval |= ETDM_IN_CON4_SLAVE_BCK_INV;\n\t} else {\n\t\tif (etdm_data->lrck_inv)\n\t\t\tval |= ETDM_IN_CON4_MASTER_LRCK_INV;\n\t\tif (etdm_data->bck_inv)\n\t\t\tval |= ETDM_IN_CON4_MASTER_BCK_INV;\n\t}\n\tregmap_update_bits(afe->regmap, etdm_reg.con4, mask, val);\n\n\tmask = 0;\n\tval = 0;\n\n\t \n\tmask |= ETDM_IN_CON5_LR_SWAP_MASK;\n\tmask |= ETDM_IN_CON5_ENABLE_ODD_MASK;\n\tfor (i = 0; i < channels; i += 2) {\n\t\tif (etdm_data->in_disable_ch[i] &&\n\t\t    !etdm_data->in_disable_ch[i + 1]) {\n\t\t\tval |= ETDM_IN_CON5_LR_SWAP(i >> 1);\n\t\t\tval |= ETDM_IN_CON5_ENABLE_ODD(i >> 1);\n\t\t} else if (!etdm_data->in_disable_ch[i] &&\n\t\t\t   etdm_data->in_disable_ch[i + 1]) {\n\t\t\tval |= ETDM_IN_CON5_ENABLE_ODD(i >> 1);\n\t\t}\n\t}\n\tregmap_update_bits(afe->regmap, etdm_reg.con5, mask, val);\n\treturn 0;\n}\n\nstatic int mtk_dai_etdm_out_configure(struct mtk_base_afe *afe,\n\t\t\t\t      unsigned int rate,\n\t\t\t\t      unsigned int channels,\n\t\t\t\t      int dai_id)\n{\n\tstruct mt8188_afe_private *afe_priv = afe->platform_priv;\n\tstruct mtk_dai_etdm_priv *etdm_data;\n\tstruct etdm_con_reg etdm_reg;\n\tbool slave_mode;\n\tunsigned int lrck_width;\n\tunsigned int val = 0;\n\tunsigned int mask = 0;\n\tint fs = 0;\n\tint ret;\n\n\tif (!is_valid_etdm_dai(dai_id))\n\t\treturn -EINVAL;\n\tetdm_data = afe_priv->dai_priv[dai_id];\n\tslave_mode = etdm_data->slave_mode;\n\tlrck_width = etdm_data->lrck_width;\n\n\tdev_dbg(afe->dev, \"%s rate %u channels %u, id %d\\n\",\n\t\t__func__, rate, channels, dai_id);\n\n\tret = get_etdm_reg(dai_id, &etdm_reg);\n\tif (ret < 0)\n\t\treturn ret;\n\n\t \n\tmask = ETDM_OUT_CON0_RELATCH_DOMAIN_MASK;\n\tval = FIELD_PREP(ETDM_OUT_CON0_RELATCH_DOMAIN_MASK,\n\t\t\t ETDM_RELATCH_TIMING_A1A2SYS);\n\tregmap_update_bits(afe->regmap, etdm_reg.con0, mask, val);\n\n\tmask = 0;\n\tval = 0;\n\n\t \n\tif (lrck_width > 0) {\n\t\tmask |= (ETDM_OUT_CON1_LRCK_AUTO_MODE |\n\t\t\tETDM_OUT_CON1_LRCK_WIDTH_MASK);\n\t\tval |= FIELD_PREP(ETDM_OUT_CON1_LRCK_WIDTH_MASK, lrck_width - 1);\n\t}\n\tregmap_update_bits(afe->regmap, etdm_reg.con1, mask, val);\n\n\tmask = 0;\n\tval = 0;\n\n\tif (!slave_mode) {\n\t\t \n\t\tmask |= ETDM_OUT_CON4_FS_MASK;\n\t\tval |= FIELD_PREP(ETDM_OUT_CON4_FS_MASK, get_etdm_fs_timing(rate));\n\t}\n\n\tmask |= ETDM_OUT_CON4_RELATCH_EN_MASK;\n\tif (dai_id == MT8188_AFE_IO_ETDM1_OUT)\n\t\tfs = MT8188_ETDM_OUT1_1X_EN;\n\telse if (dai_id == MT8188_AFE_IO_ETDM2_OUT)\n\t\tfs = MT8188_ETDM_OUT2_1X_EN;\n\n\tval |= FIELD_PREP(ETDM_OUT_CON4_RELATCH_EN_MASK, fs);\n\n\tregmap_update_bits(afe->regmap, etdm_reg.con4, mask, val);\n\n\tmask = 0;\n\tval = 0;\n\n\t \n\tmask |= (ETDM_OUT_CON5_MASTER_LRCK_INV | ETDM_OUT_CON5_MASTER_BCK_INV |\n\t\tETDM_OUT_CON5_SLAVE_LRCK_INV | ETDM_OUT_CON5_SLAVE_BCK_INV);\n\tif (slave_mode) {\n\t\tif (etdm_data->lrck_inv)\n\t\t\tval |= ETDM_OUT_CON5_SLAVE_LRCK_INV;\n\t\tif (etdm_data->bck_inv)\n\t\t\tval |= ETDM_OUT_CON5_SLAVE_BCK_INV;\n\t} else {\n\t\tif (etdm_data->lrck_inv)\n\t\t\tval |= ETDM_OUT_CON5_MASTER_LRCK_INV;\n\t\tif (etdm_data->bck_inv)\n\t\t\tval |= ETDM_OUT_CON5_MASTER_BCK_INV;\n\t}\n\tregmap_update_bits(afe->regmap, etdm_reg.con5, mask, val);\n\n\treturn 0;\n}\n\nstatic int mtk_dai_etdm_configure(struct mtk_base_afe *afe,\n\t\t\t\t  unsigned int rate,\n\t\t\t\t  unsigned int channels,\n\t\t\t\t  unsigned int bit_width,\n\t\t\t\t  int dai_id)\n{\n\tstruct mt8188_afe_private *afe_priv = afe->platform_priv;\n\tstruct mtk_dai_etdm_priv *etdm_data;\n\tstruct etdm_con_reg etdm_reg;\n\tbool slave_mode;\n\tunsigned int etdm_channels;\n\tunsigned int val = 0;\n\tunsigned int mask = 0;\n\tunsigned int bck;\n\tunsigned int wlen = get_etdm_wlen(bit_width);\n\tint ret;\n\n\tif (!is_valid_etdm_dai(dai_id))\n\t\treturn -EINVAL;\n\tetdm_data = afe_priv->dai_priv[dai_id];\n\tslave_mode = etdm_data->slave_mode;\n\tetdm_data->rate = rate;\n\n\tret = get_etdm_reg(dai_id, &etdm_reg);\n\tif (ret < 0)\n\t\treturn ret;\n\n\tdev_dbg(afe->dev, \"%s fmt %u data %u lrck %d-%u bck %d, slv %u\\n\",\n\t\t__func__, etdm_data->format, etdm_data->data_mode,\n\t\tetdm_data->lrck_inv, etdm_data->lrck_width, etdm_data->bck_inv,\n\t\tetdm_data->slave_mode);\n\tdev_dbg(afe->dev, \"%s rate %u channels %u bitwidth %u, id %d\\n\",\n\t\t__func__, rate, channels, bit_width, dai_id);\n\n\tetdm_channels = (etdm_data->data_mode == MTK_DAI_ETDM_DATA_ONE_PIN) ?\n\t\t\tget_etdm_ch_fixup(channels) : 2;\n\n\tbck = rate * etdm_channels * wlen;\n\tif (bck > MT8188_ETDM_NORMAL_MAX_BCK_RATE) {\n\t\tdev_err(afe->dev, \"%s bck rate %u not support\\n\",\n\t\t\t__func__, bck);\n\t\treturn -EINVAL;\n\t}\n\n\t \n\tmask |= ETDM_CON0_BIT_LEN_MASK;\n\tval |= FIELD_PREP(ETDM_CON0_BIT_LEN_MASK, bit_width - 1);\n\tmask |= ETDM_CON0_WORD_LEN_MASK;\n\tval |= FIELD_PREP(ETDM_CON0_WORD_LEN_MASK, wlen - 1);\n\tmask |= ETDM_CON0_FORMAT_MASK;\n\tval |= FIELD_PREP(ETDM_CON0_FORMAT_MASK, etdm_data->format);\n\tmask |= ETDM_CON0_CH_NUM_MASK;\n\tval |= FIELD_PREP(ETDM_CON0_CH_NUM_MASK, etdm_channels - 1);\n\n\tmask |= ETDM_CON0_SLAVE_MODE;\n\tif (slave_mode) {\n\t\tif (dai_id == MT8188_AFE_IO_ETDM1_OUT) {\n\t\t\tdev_err(afe->dev, \"%s id %d only support master mode\\n\",\n\t\t\t\t__func__, dai_id);\n\t\t\treturn -EINVAL;\n\t\t}\n\t\tval |= ETDM_CON0_SLAVE_MODE;\n\t}\n\tregmap_update_bits(afe->regmap, etdm_reg.con0, mask, val);\n\n\tif (get_etdm_dir(dai_id) == ETDM_IN)\n\t\tmtk_dai_etdm_in_configure(afe, rate, channels, dai_id);\n\telse\n\t\tmtk_dai_etdm_out_configure(afe, rate, channels, dai_id);\n\n\treturn 0;\n}\n\nstatic int mtk_dai_etdm_hw_params(struct snd_pcm_substream *substream,\n\t\t\t\t  struct snd_pcm_hw_params *params,\n\t\t\t\t  struct snd_soc_dai *dai)\n{\n\tunsigned int rate = params_rate(params);\n\tunsigned int bit_width = params_width(params);\n\tunsigned int channels = params_channels(params);\n\tstruct mtk_base_afe *afe = snd_soc_dai_get_drvdata(dai);\n\tstruct mt8188_afe_private *afe_priv = afe->platform_priv;\n\tstruct mtk_dai_etdm_priv *mst_etdm_data;\n\tint mst_dai_id;\n\tint slv_dai_id;\n\tint ret;\n\tint i;\n\n\tdev_dbg(afe->dev, \"%s '%s' period %u-%u\\n\",\n\t\t__func__, snd_pcm_stream_str(substream),\n\t\tparams_period_size(params), params_periods(params));\n\n\tif (is_cowork_mode(dai)) {\n\t\tmst_dai_id = get_etdm_cowork_master_id(dai);\n\t\tif (!is_valid_etdm_dai(mst_dai_id))\n\t\t\treturn -EINVAL;\n\n\t\tmst_etdm_data = afe_priv->dai_priv[mst_dai_id];\n\t\tif (mst_etdm_data->slots)\n\t\t\tchannels = mst_etdm_data->slots;\n\n\t\tret = mtk_dai_etdm_configure(afe, rate, channels,\n\t\t\t\t\t     bit_width, mst_dai_id);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tfor (i = 0; i < mst_etdm_data->cowork_slv_count; i++) {\n\t\t\tslv_dai_id = mst_etdm_data->cowork_slv_id[i];\n\t\t\tret = mtk_dai_etdm_configure(afe, rate, channels,\n\t\t\t\t\t\t     bit_width, slv_dai_id);\n\t\t\tif (ret)\n\t\t\t\treturn ret;\n\n\t\t\tret = mt8188_etdm_sync_mode_configure(afe, slv_dai_id);\n\t\t\tif (ret)\n\t\t\t\treturn ret;\n\t\t}\n\t} else {\n\t\tif (!is_valid_etdm_dai(dai->id))\n\t\t\treturn -EINVAL;\n\t\tmst_etdm_data = afe_priv->dai_priv[dai->id];\n\t\tif (mst_etdm_data->slots)\n\t\t\tchannels = mst_etdm_data->slots;\n\n\t\tret = mtk_dai_etdm_configure(afe, rate, channels,\n\t\t\t\t\t     bit_width, dai->id);\n\t\tif (ret)\n\t\t\treturn ret;\n\t}\n\n\treturn 0;\n}\n\nstatic int mtk_dai_etdm_cal_mclk(struct mtk_base_afe *afe, int freq, int dai_id)\n{\n\tstruct mt8188_afe_private *afe_priv = afe->platform_priv;\n\tstruct mtk_dai_etdm_priv *etdm_data;\n\tint apll_rate;\n\tint apll;\n\n\tif (!is_valid_etdm_dai(dai_id))\n\t\treturn -EINVAL;\n\tetdm_data = afe_priv->dai_priv[dai_id];\n\n\tif (freq == 0) {\n\t\tetdm_data->mclk_freq = freq;\n\t\treturn 0;\n\t}\n\n\tif (etdm_data->mclk_fixed_apll == 0)\n\t\tapll = mt8188_afe_get_default_mclk_source_by_rate(freq);\n\telse\n\t\tapll = etdm_data->mclk_apll;\n\n\tapll_rate = mt8188_afe_get_mclk_source_rate(afe, apll);\n\n\tif (freq > apll_rate) {\n\t\tdev_err(afe->dev, \"freq %d > apll rate %d\\n\", freq, apll_rate);\n\t\treturn -EINVAL;\n\t}\n\n\tif (apll_rate % freq != 0) {\n\t\tdev_err(afe->dev, \"APLL%d cannot generate freq Hz\\n\", apll);\n\t\treturn -EINVAL;\n\t}\n\n\tif (etdm_data->mclk_fixed_apll == 0)\n\t\tetdm_data->mclk_apll = apll;\n\tetdm_data->mclk_freq = freq;\n\n\treturn 0;\n}\n\nstatic int mtk_dai_etdm_set_sysclk(struct snd_soc_dai *dai,\n\t\t\t\t   int clk_id, unsigned int freq, int dir)\n{\n\tstruct mtk_base_afe *afe = snd_soc_dai_get_drvdata(dai);\n\tstruct mt8188_afe_private *afe_priv = afe->platform_priv;\n\tstruct mtk_dai_etdm_priv *etdm_data;\n\tint dai_id;\n\n\tdev_dbg(dai->dev, \"%s id %d freq %u, dir %d\\n\",\n\t\t__func__, dai->id, freq, dir);\n\tif (is_cowork_mode(dai))\n\t\tdai_id = get_etdm_cowork_master_id(dai);\n\telse\n\t\tdai_id = dai->id;\n\n\tif (!is_valid_etdm_dai(dai_id))\n\t\treturn -EINVAL;\n\tetdm_data = afe_priv->dai_priv[dai_id];\n\tetdm_data->mclk_dir = dir;\n\treturn mtk_dai_etdm_cal_mclk(afe, freq, dai_id);\n}\n\nstatic int mtk_dai_etdm_set_tdm_slot(struct snd_soc_dai *dai,\n\t\t\t\t     unsigned int tx_mask, unsigned int rx_mask,\n\t\t\t\t     int slots, int slot_width)\n{\n\tstruct mtk_base_afe *afe = snd_soc_dai_get_drvdata(dai);\n\tstruct mt8188_afe_private *afe_priv = afe->platform_priv;\n\tstruct mtk_dai_etdm_priv *etdm_data;\n\tint dai_id;\n\n\tif (is_cowork_mode(dai))\n\t\tdai_id = get_etdm_cowork_master_id(dai);\n\telse\n\t\tdai_id = dai->id;\n\n\tif (!is_valid_etdm_dai(dai_id))\n\t\treturn -EINVAL;\n\tetdm_data = afe_priv->dai_priv[dai_id];\n\n\tdev_dbg(dai->dev, \"%s id %d slot_width %d\\n\",\n\t\t__func__, dai->id, slot_width);\n\n\tetdm_data->slots = slots;\n\tetdm_data->lrck_width = slot_width;\n\treturn 0;\n}\n\nstatic int mtk_dai_etdm_set_fmt(struct snd_soc_dai *dai, unsigned int fmt)\n{\n\tstruct mtk_base_afe *afe = snd_soc_dai_get_drvdata(dai);\n\tstruct mt8188_afe_private *afe_priv = afe->platform_priv;\n\tstruct mtk_dai_etdm_priv *etdm_data;\n\n\tif (!is_valid_etdm_dai(dai->id))\n\t\treturn -EINVAL;\n\tetdm_data = afe_priv->dai_priv[dai->id];\n\n\tswitch (fmt & SND_SOC_DAIFMT_FORMAT_MASK) {\n\tcase SND_SOC_DAIFMT_I2S:\n\t\tetdm_data->format = MTK_DAI_ETDM_FORMAT_I2S;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_LEFT_J:\n\t\tetdm_data->format = MTK_DAI_ETDM_FORMAT_LJ;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_RIGHT_J:\n\t\tetdm_data->format = MTK_DAI_ETDM_FORMAT_RJ;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_DSP_A:\n\t\tetdm_data->format = MTK_DAI_ETDM_FORMAT_DSPA;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_DSP_B:\n\t\tetdm_data->format = MTK_DAI_ETDM_FORMAT_DSPB;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tswitch (fmt & SND_SOC_DAIFMT_INV_MASK) {\n\tcase SND_SOC_DAIFMT_NB_NF:\n\t\tetdm_data->bck_inv = false;\n\t\tetdm_data->lrck_inv = false;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_NB_IF:\n\t\tetdm_data->bck_inv = false;\n\t\tetdm_data->lrck_inv = true;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_IB_NF:\n\t\tetdm_data->bck_inv = true;\n\t\tetdm_data->lrck_inv = false;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_IB_IF:\n\t\tetdm_data->bck_inv = true;\n\t\tetdm_data->lrck_inv = true;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tswitch (fmt & SND_SOC_DAIFMT_CLOCK_PROVIDER_MASK) {\n\tcase SND_SOC_DAIFMT_BC_FC:\n\t\tetdm_data->slave_mode = true;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_BP_FP:\n\t\tetdm_data->slave_mode = false;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\treturn 0;\n}\n\nstatic unsigned int mtk_dai_get_dptx_ch_en(unsigned int channel)\n{\n\tswitch (channel) {\n\tcase 1 ... 2:\n\t\treturn AFE_DPTX_CON_CH_EN_2CH;\n\tcase 3 ... 4:\n\t\treturn AFE_DPTX_CON_CH_EN_4CH;\n\tcase 5 ... 6:\n\t\treturn AFE_DPTX_CON_CH_EN_6CH;\n\tcase 7 ... 8:\n\t\treturn AFE_DPTX_CON_CH_EN_8CH;\n\tdefault:\n\t\treturn AFE_DPTX_CON_CH_EN_2CH;\n\t}\n}\n\nstatic unsigned int mtk_dai_get_dptx_ch(unsigned int ch)\n{\n\treturn (ch > 2) ?\n\t\tAFE_DPTX_CON_CH_NUM_8CH : AFE_DPTX_CON_CH_NUM_2CH;\n}\n\nstatic unsigned int mtk_dai_get_dptx_wlen(snd_pcm_format_t format)\n{\n\treturn snd_pcm_format_physical_width(format) <= 16 ?\n\t\tAFE_DPTX_CON_16BIT : AFE_DPTX_CON_24BIT;\n}\n\nstatic int mtk_dai_hdmitx_dptx_hw_params(struct snd_pcm_substream *substream,\n\t\t\t\t\t struct snd_pcm_hw_params *params,\n\t\t\t\t\t struct snd_soc_dai *dai)\n{\n\tstruct mtk_base_afe *afe = snd_soc_dai_get_drvdata(dai);\n\tstruct mt8188_afe_private *afe_priv = afe->platform_priv;\n\tstruct mtk_dai_etdm_priv *etdm_data;\n\tunsigned int rate = params_rate(params);\n\tunsigned int channels = params_channels(params);\n\tsnd_pcm_format_t format = params_format(params);\n\tint width = snd_pcm_format_physical_width(format);\n\tint ret;\n\n\tif (!is_valid_etdm_dai(dai->id))\n\t\treturn -EINVAL;\n\tetdm_data = afe_priv->dai_priv[dai->id];\n\n\t \n\tif (dai->id == MT8188_AFE_IO_DPTX) {\n\t\tregmap_update_bits(afe->regmap, AFE_DPTX_CON,\n\t\t\t\t   AFE_DPTX_CON_CH_EN_MASK,\n\t\t\t\t   mtk_dai_get_dptx_ch_en(channels));\n\t\tregmap_update_bits(afe->regmap, AFE_DPTX_CON,\n\t\t\t\t   AFE_DPTX_CON_CH_NUM_MASK,\n\t\t\t\t   mtk_dai_get_dptx_ch(channels));\n\t\tregmap_update_bits(afe->regmap, AFE_DPTX_CON,\n\t\t\t\t   AFE_DPTX_CON_16BIT_MASK,\n\t\t\t\t   mtk_dai_get_dptx_wlen(format));\n\n\t\tif (mtk_dai_get_dptx_ch(channels) == AFE_DPTX_CON_CH_NUM_8CH) {\n\t\t\tetdm_data->data_mode = MTK_DAI_ETDM_DATA_ONE_PIN;\n\t\t\tchannels = 8;\n\t\t} else {\n\t\t\tchannels = 2;\n\t\t}\n\t} else {\n\t\tetdm_data->data_mode = MTK_DAI_ETDM_DATA_MULTI_PIN;\n\t}\n\n\tret = mtk_dai_etdm_configure(afe, rate, channels, width, dai->id);\n\n\treturn ret;\n}\n\nstatic int mtk_dai_hdmitx_dptx_set_sysclk(struct snd_soc_dai *dai,\n\t\t\t\t\t  int clk_id,\n\t\t\t\t\t  unsigned int freq,\n\t\t\t\t\t  int dir)\n{\n\tstruct mtk_base_afe *afe = snd_soc_dai_get_drvdata(dai);\n\tstruct mt8188_afe_private *afe_priv = afe->platform_priv;\n\tstruct mtk_dai_etdm_priv *etdm_data;\n\n\tif (!is_valid_etdm_dai(dai->id))\n\t\treturn -EINVAL;\n\tetdm_data = afe_priv->dai_priv[dai->id];\n\n\tdev_dbg(dai->dev, \"%s id %d freq %u, dir %d\\n\",\n\t\t__func__, dai->id, freq, dir);\n\n\tetdm_data->mclk_dir = dir;\n\treturn mtk_dai_etdm_cal_mclk(afe, freq, dai->id);\n}\n\nstatic const struct snd_soc_dai_ops mtk_dai_etdm_ops = {\n\t.hw_params = mtk_dai_etdm_hw_params,\n\t.set_sysclk = mtk_dai_etdm_set_sysclk,\n\t.set_fmt = mtk_dai_etdm_set_fmt,\n\t.set_tdm_slot = mtk_dai_etdm_set_tdm_slot,\n};\n\nstatic const struct snd_soc_dai_ops mtk_dai_hdmitx_dptx_ops = {\n\t.hw_params\t= mtk_dai_hdmitx_dptx_hw_params,\n\t.set_sysclk\t= mtk_dai_hdmitx_dptx_set_sysclk,\n\t.set_fmt\t= mtk_dai_etdm_set_fmt,\n};\n\n \n#define MTK_ETDM_RATES (SNDRV_PCM_RATE_8000_192000)\n\n#define MTK_ETDM_FORMATS (SNDRV_PCM_FMTBIT_S16_LE |\\\n\t\t\t  SNDRV_PCM_FMTBIT_S24_LE |\\\n\t\t\t  SNDRV_PCM_FMTBIT_S32_LE)\n\nstatic struct snd_soc_dai_driver mtk_dai_etdm_driver[] = {\n\t{\n\t\t.name = \"DPTX\",\n\t\t.id = MT8188_AFE_IO_DPTX,\n\t\t.playback = {\n\t\t\t.stream_name = \"DPTX\",\n\t\t\t.channels_min = 1,\n\t\t\t.channels_max = 8,\n\t\t\t.rates = MTK_ETDM_RATES,\n\t\t\t.formats = MTK_ETDM_FORMATS,\n\t\t},\n\t\t.ops = &mtk_dai_hdmitx_dptx_ops,\n\t},\n\t{\n\t\t.name = \"ETDM1_IN\",\n\t\t.id = MT8188_AFE_IO_ETDM1_IN,\n\t\t.capture = {\n\t\t\t.stream_name = \"ETDM1_IN\",\n\t\t\t.channels_min = 1,\n\t\t\t.channels_max = 16,\n\t\t\t.rates = MTK_ETDM_RATES,\n\t\t\t.formats = MTK_ETDM_FORMATS,\n\t\t},\n\t\t.ops = &mtk_dai_etdm_ops,\n\t},\n\t{\n\t\t.name = \"ETDM2_IN\",\n\t\t.id = MT8188_AFE_IO_ETDM2_IN,\n\t\t.capture = {\n\t\t\t.stream_name = \"ETDM2_IN\",\n\t\t\t.channels_min = 1,\n\t\t\t.channels_max = 16,\n\t\t\t.rates = MTK_ETDM_RATES,\n\t\t\t.formats = MTK_ETDM_FORMATS,\n\t\t},\n\t\t.ops = &mtk_dai_etdm_ops,\n\t},\n\t{\n\t\t.name = \"ETDM1_OUT\",\n\t\t.id = MT8188_AFE_IO_ETDM1_OUT,\n\t\t.playback = {\n\t\t\t.stream_name = \"ETDM1_OUT\",\n\t\t\t.channels_min = 1,\n\t\t\t.channels_max = 16,\n\t\t\t.rates = MTK_ETDM_RATES,\n\t\t\t.formats = MTK_ETDM_FORMATS,\n\t\t},\n\t\t.ops = &mtk_dai_etdm_ops,\n\t},\n\t{\n\t\t.name = \"ETDM2_OUT\",\n\t\t.id = MT8188_AFE_IO_ETDM2_OUT,\n\t\t.playback = {\n\t\t\t.stream_name = \"ETDM2_OUT\",\n\t\t\t.channels_min = 1,\n\t\t\t.channels_max = 16,\n\t\t\t.rates = MTK_ETDM_RATES,\n\t\t\t.formats = MTK_ETDM_FORMATS,\n\t\t},\n\t\t.ops = &mtk_dai_etdm_ops,\n\t},\n\t{\n\t\t.name = \"ETDM3_OUT\",\n\t\t.id = MT8188_AFE_IO_ETDM3_OUT,\n\t\t.playback = {\n\t\t\t.stream_name = \"ETDM3_OUT\",\n\t\t\t.channels_min = 1,\n\t\t\t.channels_max = 8,\n\t\t\t.rates = MTK_ETDM_RATES,\n\t\t\t.formats = MTK_ETDM_FORMATS,\n\t\t},\n\t\t.ops = &mtk_dai_hdmitx_dptx_ops,\n\t},\n};\n\nstatic void mt8188_etdm_update_sync_info(struct mtk_base_afe *afe)\n{\n\tstruct mt8188_afe_private *afe_priv = afe->platform_priv;\n\tstruct mtk_dai_etdm_priv *etdm_data;\n\tstruct mtk_dai_etdm_priv *mst_data;\n\tint mst_dai_id;\n\tint i;\n\n\tfor (i = MT8188_AFE_IO_ETDM_START; i < MT8188_AFE_IO_ETDM_END; i++) {\n\t\tetdm_data = afe_priv->dai_priv[i];\n\t\tif (etdm_data->cowork_source_id != COWORK_ETDM_NONE) {\n\t\t\tmst_dai_id = etdm_data->cowork_source_id;\n\t\t\tmst_data = afe_priv->dai_priv[mst_dai_id];\n\t\t\tif (mst_data->cowork_source_id != COWORK_ETDM_NONE)\n\t\t\t\tdev_err(afe->dev, \"%s [%d] wrong sync source\\n\",\n\t\t\t\t\t__func__, i);\n\t\t\tmst_data->cowork_slv_id[mst_data->cowork_slv_count] = i;\n\t\t\tmst_data->cowork_slv_count++;\n\t\t}\n\t}\n}\n\nstatic void mt8188_dai_etdm_parse_of(struct mtk_base_afe *afe)\n{\n\tconst struct device_node *of_node = afe->dev->of_node;\n\tstruct mt8188_afe_private *afe_priv = afe->platform_priv;\n\tstruct mtk_dai_etdm_priv *etdm_data;\n\tchar prop[48];\n\tu8 disable_chn[MT8188_ETDM_MAX_CHANNELS];\n\tint max_chn = MT8188_ETDM_MAX_CHANNELS;\n\tunsigned int sync_id;\n\tu32 sel;\n\tint ret;\n\tint dai_id;\n\tint i, j;\n\tstruct {\n\t\tconst char *name;\n\t\tconst unsigned int sync_id;\n\t} of_afe_etdms[MT8188_AFE_IO_ETDM_NUM] = {\n\t\t{\"etdm-in1\", ETDM_SYNC_FROM_IN1},\n\t\t{\"etdm-in2\", ETDM_SYNC_FROM_IN2},\n\t\t{\"etdm-out1\", ETDM_SYNC_FROM_OUT1},\n\t\t{\"etdm-out2\", ETDM_SYNC_FROM_OUT2},\n\t\t{\"etdm-out3\", ETDM_SYNC_FROM_OUT3},\n\t};\n\n\tfor (i = 0; i < MT8188_AFE_IO_ETDM_NUM; i++) {\n\t\tdai_id = ETDM_TO_DAI_ID(i);\n\t\tetdm_data = afe_priv->dai_priv[dai_id];\n\n\t\tsnprintf(prop, sizeof(prop), \"mediatek,%s-multi-pin-mode\",\n\t\t\t of_afe_etdms[i].name);\n\n\t\tetdm_data->data_mode = of_property_read_bool(of_node, prop);\n\n\t\tsnprintf(prop, sizeof(prop), \"mediatek,%s-cowork-source\",\n\t\t\t of_afe_etdms[i].name);\n\n\t\tret = of_property_read_u32(of_node, prop, &sel);\n\t\tif (ret == 0) {\n\t\t\tif (sel >= MT8188_AFE_IO_ETDM_NUM) {\n\t\t\t\tdev_err(afe->dev, \"%s invalid id=%d\\n\",\n\t\t\t\t\t__func__, sel);\n\t\t\t\tetdm_data->cowork_source_id = COWORK_ETDM_NONE;\n\t\t\t} else {\n\t\t\t\tsync_id = of_afe_etdms[sel].sync_id;\n\t\t\t\tetdm_data->cowork_source_id =\n\t\t\t\t\tsync_to_dai_id(sync_id);\n\t\t\t}\n\t\t} else {\n\t\t\tetdm_data->cowork_source_id = COWORK_ETDM_NONE;\n\t\t}\n\t}\n\n\t \n\tfor (i = 0; i < 2; i++) {\n\t\tdai_id = ETDM_TO_DAI_ID(i);\n\t\tetdm_data = afe_priv->dai_priv[dai_id];\n\n\t\tsnprintf(prop, sizeof(prop), \"mediatek,%s-chn-disabled\",\n\t\t\t of_afe_etdms[i].name);\n\n\t\tret = of_property_read_variable_u8_array(of_node, prop,\n\t\t\t\t\t\t\t disable_chn,\n\t\t\t\t\t\t\t 1, max_chn);\n\t\tif (ret < 0)\n\t\t\tcontinue;\n\n\t\tfor (j = 0; j < ret; j++) {\n\t\t\tif (disable_chn[j] >= MT8188_ETDM_MAX_CHANNELS)\n\t\t\t\tdev_err(afe->dev, \"%s [%d] invalid chn %u\\n\",\n\t\t\t\t\t__func__, j, disable_chn[j]);\n\t\t\telse\n\t\t\t\tetdm_data->in_disable_ch[disable_chn[j]] = true;\n\t\t}\n\t}\n\tmt8188_etdm_update_sync_info(afe);\n}\n\nstatic int init_etdm_priv_data(struct mtk_base_afe *afe)\n{\n\tstruct mt8188_afe_private *afe_priv = afe->platform_priv;\n\tstruct mtk_dai_etdm_priv *etdm_priv;\n\tint i;\n\n\tfor (i = MT8188_AFE_IO_ETDM_START; i < MT8188_AFE_IO_ETDM_END; i++) {\n\t\tetdm_priv = devm_kzalloc(afe->dev,\n\t\t\t\t\t sizeof(struct mtk_dai_etdm_priv),\n\t\t\t\t\t GFP_KERNEL);\n\t\tif (!etdm_priv)\n\t\t\treturn -ENOMEM;\n\n\t\tafe_priv->dai_priv[i] = etdm_priv;\n\t}\n\n\tafe_priv->dai_priv[MT8188_AFE_IO_DPTX] =\n\t\tafe_priv->dai_priv[MT8188_AFE_IO_ETDM3_OUT];\n\n\tmt8188_dai_etdm_parse_of(afe);\n\treturn 0;\n}\n\nint mt8188_dai_etdm_register(struct mtk_base_afe *afe)\n{\n\tstruct mtk_base_afe_dai *dai;\n\n\tdai = devm_kzalloc(afe->dev, sizeof(*dai), GFP_KERNEL);\n\tif (!dai)\n\t\treturn -ENOMEM;\n\n\tlist_add(&dai->list, &afe->sub_dais);\n\n\tdai->dai_drivers = mtk_dai_etdm_driver;\n\tdai->num_dai_drivers = ARRAY_SIZE(mtk_dai_etdm_driver);\n\n\tdai->dapm_widgets = mtk_dai_etdm_widgets;\n\tdai->num_dapm_widgets = ARRAY_SIZE(mtk_dai_etdm_widgets);\n\tdai->dapm_routes = mtk_dai_etdm_routes;\n\tdai->num_dapm_routes = ARRAY_SIZE(mtk_dai_etdm_routes);\n\tdai->controls = mtk_dai_etdm_controls;\n\tdai->num_controls = ARRAY_SIZE(mtk_dai_etdm_controls);\n\n\treturn init_etdm_priv_data(afe);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}