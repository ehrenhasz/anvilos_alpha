{
  "module_name": "mt8192-afe-gpio.c",
  "hash_id": "dc92f1da19861b21873d785fd6b0ae6a7cff21d548eacb0b4fb14f72642080be",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/mediatek/mt8192/mt8192-afe-gpio.c",
  "human_readable_source": "\n\n\n\n\n\n\n\n#include <linux/gpio.h>\n#include <linux/pinctrl/consumer.h>\n\n#include \"mt8192-afe-common.h\"\n#include \"mt8192-afe-gpio.h\"\n\nstatic struct pinctrl *aud_pinctrl;\n\nenum mt8192_afe_gpio {\n\tMT8192_AFE_GPIO_DAT_MISO_OFF,\n\tMT8192_AFE_GPIO_DAT_MISO_ON,\n\tMT8192_AFE_GPIO_DAT_MOSI_OFF,\n\tMT8192_AFE_GPIO_DAT_MOSI_ON,\n\tMT8192_AFE_GPIO_DAT_MISO_CH34_OFF,\n\tMT8192_AFE_GPIO_DAT_MISO_CH34_ON,\n\tMT8192_AFE_GPIO_DAT_MOSI_CH34_OFF,\n\tMT8192_AFE_GPIO_DAT_MOSI_CH34_ON,\n\tMT8192_AFE_GPIO_I2S0_OFF,\n\tMT8192_AFE_GPIO_I2S0_ON,\n\tMT8192_AFE_GPIO_I2S1_OFF,\n\tMT8192_AFE_GPIO_I2S1_ON,\n\tMT8192_AFE_GPIO_I2S2_OFF,\n\tMT8192_AFE_GPIO_I2S2_ON,\n\tMT8192_AFE_GPIO_I2S3_OFF,\n\tMT8192_AFE_GPIO_I2S3_ON,\n\tMT8192_AFE_GPIO_I2S5_OFF,\n\tMT8192_AFE_GPIO_I2S5_ON,\n\tMT8192_AFE_GPIO_I2S6_OFF,\n\tMT8192_AFE_GPIO_I2S6_ON,\n\tMT8192_AFE_GPIO_I2S7_OFF,\n\tMT8192_AFE_GPIO_I2S7_ON,\n\tMT8192_AFE_GPIO_I2S8_OFF,\n\tMT8192_AFE_GPIO_I2S8_ON,\n\tMT8192_AFE_GPIO_I2S9_OFF,\n\tMT8192_AFE_GPIO_I2S9_ON,\n\tMT8192_AFE_GPIO_VOW_DAT_OFF,\n\tMT8192_AFE_GPIO_VOW_DAT_ON,\n\tMT8192_AFE_GPIO_VOW_CLK_OFF,\n\tMT8192_AFE_GPIO_VOW_CLK_ON,\n\tMT8192_AFE_GPIO_CLK_MOSI_OFF,\n\tMT8192_AFE_GPIO_CLK_MOSI_ON,\n\tMT8192_AFE_GPIO_TDM_OFF,\n\tMT8192_AFE_GPIO_TDM_ON,\n\tMT8192_AFE_GPIO_GPIO_NUM\n};\n\nstruct audio_gpio_attr {\n\tconst char *name;\n\tbool gpio_prepare;\n\tstruct pinctrl_state *gpioctrl;\n};\n\nstatic struct audio_gpio_attr aud_gpios[MT8192_AFE_GPIO_GPIO_NUM] = {\n\t[MT8192_AFE_GPIO_DAT_MISO_OFF] = {\"aud_dat_miso_off\", false, NULL},\n\t[MT8192_AFE_GPIO_DAT_MISO_ON] = {\"aud_dat_miso_on\", false, NULL},\n\t[MT8192_AFE_GPIO_DAT_MOSI_OFF] = {\"aud_dat_mosi_off\", false, NULL},\n\t[MT8192_AFE_GPIO_DAT_MOSI_ON] = {\"aud_dat_mosi_on\", false, NULL},\n\t[MT8192_AFE_GPIO_I2S0_OFF] = {\"aud_gpio_i2s0_off\", false, NULL},\n\t[MT8192_AFE_GPIO_I2S0_ON] = {\"aud_gpio_i2s0_on\", false, NULL},\n\t[MT8192_AFE_GPIO_I2S1_OFF] = {\"aud_gpio_i2s1_off\", false, NULL},\n\t[MT8192_AFE_GPIO_I2S1_ON] = {\"aud_gpio_i2s1_on\", false, NULL},\n\t[MT8192_AFE_GPIO_I2S2_OFF] = {\"aud_gpio_i2s2_off\", false, NULL},\n\t[MT8192_AFE_GPIO_I2S2_ON] = {\"aud_gpio_i2s2_on\", false, NULL},\n\t[MT8192_AFE_GPIO_I2S3_OFF] = {\"aud_gpio_i2s3_off\", false, NULL},\n\t[MT8192_AFE_GPIO_I2S3_ON] = {\"aud_gpio_i2s3_on\", false, NULL},\n\t[MT8192_AFE_GPIO_I2S5_OFF] = {\"aud_gpio_i2s5_off\", false, NULL},\n\t[MT8192_AFE_GPIO_I2S5_ON] = {\"aud_gpio_i2s5_on\", false, NULL},\n\t[MT8192_AFE_GPIO_I2S6_OFF] = {\"aud_gpio_i2s6_off\", false, NULL},\n\t[MT8192_AFE_GPIO_I2S6_ON] = {\"aud_gpio_i2s6_on\", false, NULL},\n\t[MT8192_AFE_GPIO_I2S7_OFF] = {\"aud_gpio_i2s7_off\", false, NULL},\n\t[MT8192_AFE_GPIO_I2S7_ON] = {\"aud_gpio_i2s7_on\", false, NULL},\n\t[MT8192_AFE_GPIO_I2S8_OFF] = {\"aud_gpio_i2s8_off\", false, NULL},\n\t[MT8192_AFE_GPIO_I2S8_ON] = {\"aud_gpio_i2s8_on\", false, NULL},\n\t[MT8192_AFE_GPIO_I2S9_OFF] = {\"aud_gpio_i2s9_off\", false, NULL},\n\t[MT8192_AFE_GPIO_I2S9_ON] = {\"aud_gpio_i2s9_on\", false, NULL},\n\t[MT8192_AFE_GPIO_TDM_OFF] = {\"aud_gpio_tdm_off\", false, NULL},\n\t[MT8192_AFE_GPIO_TDM_ON] = {\"aud_gpio_tdm_on\", false, NULL},\n\t[MT8192_AFE_GPIO_VOW_DAT_OFF] = {\"vow_dat_miso_off\", false, NULL},\n\t[MT8192_AFE_GPIO_VOW_DAT_ON] = {\"vow_dat_miso_on\", false, NULL},\n\t[MT8192_AFE_GPIO_VOW_CLK_OFF] = {\"vow_clk_miso_off\", false, NULL},\n\t[MT8192_AFE_GPIO_VOW_CLK_ON] = {\"vow_clk_miso_on\", false, NULL},\n\t[MT8192_AFE_GPIO_DAT_MISO_CH34_OFF] = {\"aud_dat_miso_ch34_off\",\n\t\t\t\t\t       false, NULL},\n\t[MT8192_AFE_GPIO_DAT_MISO_CH34_ON] = {\"aud_dat_miso_ch34_on\",\n\t\t\t\t\t      false, NULL},\n\t[MT8192_AFE_GPIO_DAT_MOSI_CH34_OFF] = {\"aud_dat_mosi_ch34_off\",\n\t\t\t\t\t       false, NULL},\n\t[MT8192_AFE_GPIO_DAT_MOSI_CH34_ON] = {\"aud_dat_mosi_ch34_on\",\n\t\t\t\t\t      false, NULL},\n\t[MT8192_AFE_GPIO_CLK_MOSI_OFF] = {\"aud_clk_mosi_off\", false, NULL},\n\t[MT8192_AFE_GPIO_CLK_MOSI_ON] = {\"aud_clk_mosi_on\", false, NULL},\n};\n\nstatic DEFINE_MUTEX(gpio_request_mutex);\n\nstatic int mt8192_afe_gpio_select(struct device *dev,\n\t\t\t\t  enum mt8192_afe_gpio type)\n{\n\tint ret;\n\n\tif (type < 0 || type >= MT8192_AFE_GPIO_GPIO_NUM) {\n\t\tdev_err(dev, \"%s(), error, invalid gpio type %d\\n\",\n\t\t\t__func__, type);\n\t\treturn -EINVAL;\n\t}\n\n\tif (!aud_gpios[type].gpio_prepare) {\n\t\tdev_warn(dev, \"%s(), error, gpio type %d not prepared\\n\",\n\t\t\t __func__, type);\n\t\treturn -EIO;\n\t}\n\n\tret = pinctrl_select_state(aud_pinctrl,\n\t\t\t\t   aud_gpios[type].gpioctrl);\n\tif (ret) {\n\t\tdev_dbg(dev, \"%s(), error, can not set gpio type %d\\n\",\n\t\t\t__func__, type);\n\t}\n\n\treturn ret;\n}\n\nint mt8192_afe_gpio_init(struct device *dev)\n{\n\tint i, ret;\n\n\taud_pinctrl = devm_pinctrl_get(dev);\n\tif (IS_ERR(aud_pinctrl)) {\n\t\tret = PTR_ERR(aud_pinctrl);\n\t\tdev_err(dev, \"%s(), ret %d, cannot get aud_pinctrl!\\n\",\n\t\t\t__func__, ret);\n\t\treturn ret;\n\t}\n\n\tfor (i = 0; i < ARRAY_SIZE(aud_gpios); i++) {\n\t\taud_gpios[i].gpioctrl = pinctrl_lookup_state(aud_pinctrl,\n\t\t\t\t\t\t\t     aud_gpios[i].name);\n\t\tif (IS_ERR(aud_gpios[i].gpioctrl)) {\n\t\t\tret = PTR_ERR(aud_gpios[i].gpioctrl);\n\t\t\tdev_dbg(dev, \"%s(), pinctrl_lookup_state %s fail, ret %d\\n\",\n\t\t\t\t__func__, aud_gpios[i].name, ret);\n\t\t} else {\n\t\t\taud_gpios[i].gpio_prepare = true;\n\t\t}\n\t}\n\n\tmt8192_afe_gpio_select(dev, MT8192_AFE_GPIO_CLK_MOSI_ON);\n\n\t \n\tmt8192_afe_gpio_request(dev, false, MT8192_DAI_ADDA, 0);\n\tmt8192_afe_gpio_request(dev, false, MT8192_DAI_ADDA, 1);\n\n\treturn 0;\n}\nEXPORT_SYMBOL(mt8192_afe_gpio_init);\n\nstatic int mt8192_afe_gpio_adda_dl(struct device *dev, bool enable)\n{\n\tif (enable) {\n\t\treturn mt8192_afe_gpio_select(dev,\n\t\t\t\t\t      MT8192_AFE_GPIO_DAT_MOSI_ON);\n\t} else {\n\t\treturn mt8192_afe_gpio_select(dev,\n\t\t\t\t\t      MT8192_AFE_GPIO_DAT_MOSI_OFF);\n\t}\n}\n\nstatic int mt8192_afe_gpio_adda_ul(struct device *dev, bool enable)\n{\n\tif (enable) {\n\t\treturn mt8192_afe_gpio_select(dev,\n\t\t\t\t\t      MT8192_AFE_GPIO_DAT_MISO_ON);\n\t} else {\n\t\treturn mt8192_afe_gpio_select(dev,\n\t\t\t\t\t      MT8192_AFE_GPIO_DAT_MISO_OFF);\n\t}\n}\n\nstatic int mt8192_afe_gpio_adda_ch34_dl(struct device *dev, bool enable)\n{\n\tif (enable) {\n\t\treturn mt8192_afe_gpio_select(dev,\n\t\t\tMT8192_AFE_GPIO_DAT_MOSI_CH34_ON);\n\t} else {\n\t\treturn mt8192_afe_gpio_select(dev,\n\t\t\tMT8192_AFE_GPIO_DAT_MOSI_CH34_OFF);\n\t}\n}\n\nstatic int mt8192_afe_gpio_adda_ch34_ul(struct device *dev, bool enable)\n{\n\tif (enable) {\n\t\treturn mt8192_afe_gpio_select(dev,\n\t\t\tMT8192_AFE_GPIO_DAT_MISO_CH34_ON);\n\t} else {\n\t\treturn mt8192_afe_gpio_select(dev,\n\t\t\tMT8192_AFE_GPIO_DAT_MISO_CH34_OFF);\n\t}\n}\n\nint mt8192_afe_gpio_request(struct device *dev, bool enable,\n\t\t\t    int dai, int uplink)\n{\n\tmutex_lock(&gpio_request_mutex);\n\tswitch (dai) {\n\tcase MT8192_DAI_ADDA:\n\t\tif (uplink)\n\t\t\tmt8192_afe_gpio_adda_ul(dev, enable);\n\t\telse\n\t\t\tmt8192_afe_gpio_adda_dl(dev, enable);\n\t\tbreak;\n\tcase MT8192_DAI_ADDA_CH34:\n\t\tif (uplink)\n\t\t\tmt8192_afe_gpio_adda_ch34_ul(dev, enable);\n\t\telse\n\t\t\tmt8192_afe_gpio_adda_ch34_dl(dev, enable);\n\t\tbreak;\n\tcase MT8192_DAI_I2S_0:\n\t\tif (enable)\n\t\t\tmt8192_afe_gpio_select(dev, MT8192_AFE_GPIO_I2S0_ON);\n\t\telse\n\t\t\tmt8192_afe_gpio_select(dev, MT8192_AFE_GPIO_I2S0_OFF);\n\t\tbreak;\n\tcase MT8192_DAI_I2S_1:\n\t\tif (enable)\n\t\t\tmt8192_afe_gpio_select(dev, MT8192_AFE_GPIO_I2S1_ON);\n\t\telse\n\t\t\tmt8192_afe_gpio_select(dev, MT8192_AFE_GPIO_I2S1_OFF);\n\t\tbreak;\n\tcase MT8192_DAI_I2S_2:\n\t\tif (enable)\n\t\t\tmt8192_afe_gpio_select(dev, MT8192_AFE_GPIO_I2S2_ON);\n\t\telse\n\t\t\tmt8192_afe_gpio_select(dev, MT8192_AFE_GPIO_I2S2_OFF);\n\t\tbreak;\n\tcase MT8192_DAI_I2S_3:\n\t\tif (enable)\n\t\t\tmt8192_afe_gpio_select(dev, MT8192_AFE_GPIO_I2S3_ON);\n\t\telse\n\t\t\tmt8192_afe_gpio_select(dev, MT8192_AFE_GPIO_I2S3_OFF);\n\t\tbreak;\n\tcase MT8192_DAI_I2S_5:\n\t\tif (enable)\n\t\t\tmt8192_afe_gpio_select(dev, MT8192_AFE_GPIO_I2S5_ON);\n\t\telse\n\t\t\tmt8192_afe_gpio_select(dev, MT8192_AFE_GPIO_I2S5_OFF);\n\t\tbreak;\n\tcase MT8192_DAI_I2S_6:\n\t\tif (enable)\n\t\t\tmt8192_afe_gpio_select(dev, MT8192_AFE_GPIO_I2S6_ON);\n\t\telse\n\t\t\tmt8192_afe_gpio_select(dev, MT8192_AFE_GPIO_I2S6_OFF);\n\t\tbreak;\n\tcase MT8192_DAI_I2S_7:\n\t\tif (enable)\n\t\t\tmt8192_afe_gpio_select(dev, MT8192_AFE_GPIO_I2S7_ON);\n\t\telse\n\t\t\tmt8192_afe_gpio_select(dev, MT8192_AFE_GPIO_I2S7_OFF);\n\t\tbreak;\n\tcase MT8192_DAI_I2S_8:\n\t\tif (enable)\n\t\t\tmt8192_afe_gpio_select(dev, MT8192_AFE_GPIO_I2S8_ON);\n\t\telse\n\t\t\tmt8192_afe_gpio_select(dev, MT8192_AFE_GPIO_I2S8_OFF);\n\t\tbreak;\n\tcase MT8192_DAI_I2S_9:\n\t\tif (enable)\n\t\t\tmt8192_afe_gpio_select(dev, MT8192_AFE_GPIO_I2S9_ON);\n\t\telse\n\t\t\tmt8192_afe_gpio_select(dev, MT8192_AFE_GPIO_I2S9_OFF);\n\t\tbreak;\n\tcase MT8192_DAI_TDM:\n\t\tif (enable)\n\t\t\tmt8192_afe_gpio_select(dev, MT8192_AFE_GPIO_TDM_ON);\n\t\telse\n\t\t\tmt8192_afe_gpio_select(dev, MT8192_AFE_GPIO_TDM_OFF);\n\t\tbreak;\n\tcase MT8192_DAI_VOW:\n\t\tif (enable) {\n\t\t\tmt8192_afe_gpio_select(dev,\n\t\t\t\t\t       MT8192_AFE_GPIO_VOW_CLK_ON);\n\t\t\tmt8192_afe_gpio_select(dev,\n\t\t\t\t\t       MT8192_AFE_GPIO_VOW_DAT_ON);\n\t\t} else {\n\t\t\tmt8192_afe_gpio_select(dev,\n\t\t\t\t\t       MT8192_AFE_GPIO_VOW_CLK_OFF);\n\t\t\tmt8192_afe_gpio_select(dev,\n\t\t\t\t\t       MT8192_AFE_GPIO_VOW_DAT_OFF);\n\t\t}\n\t\tbreak;\n\tdefault:\n\t\tmutex_unlock(&gpio_request_mutex);\n\t\tdev_warn(dev, \"%s(), invalid dai %d\\n\", __func__, dai);\n\t\treturn -EINVAL;\n\t}\n\tmutex_unlock(&gpio_request_mutex);\n\n\treturn 0;\n}\nEXPORT_SYMBOL(mt8192_afe_gpio_request);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}