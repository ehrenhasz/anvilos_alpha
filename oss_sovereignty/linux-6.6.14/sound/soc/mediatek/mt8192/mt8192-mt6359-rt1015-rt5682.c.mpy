{
  "module_name": "mt8192-mt6359-rt1015-rt5682.c",
  "hash_id": "34da7753b82d4c26cba2537c6ec8704ea8e8aa84449317274c3ef45aae4cbbdc",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/mediatek/mt8192/mt8192-mt6359-rt1015-rt5682.c",
  "human_readable_source": "\n\n\n\n\n\n\n\n\n#include <linux/input.h>\n#include <linux/module.h>\n#include <linux/of_device.h>\n#include <linux/pm_runtime.h>\n#include <sound/jack.h>\n#include <sound/pcm_params.h>\n#include <sound/rt5682.h>\n#include <sound/soc.h>\n\n#include \"../../codecs/mt6359.h\"\n#include \"../../codecs/rt1015.h\"\n#include \"../../codecs/rt5682.h\"\n#include \"../common/mtk-afe-platform-driver.h\"\n#include \"mt8192-afe-common.h\"\n#include \"mt8192-afe-clk.h\"\n#include \"mt8192-afe-gpio.h\"\n\n#define DRIVER_NAME \"mt8192_mt6359\"\n\n#define RT1015_CODEC_DAI\t\"rt1015-aif\"\n#define RT1015_DEV0_NAME\t\"rt1015.1-0028\"\n#define RT1015_DEV1_NAME\t\"rt1015.1-0029\"\n\n#define RT1015_RT5682_CARD_NAME \"mt8192_mt6359_rt1015_rt5682\"\n#define RT1015P_RT5682_CARD_NAME \"mt8192_mt6359_rt1015p_rt5682\"\n#define RT1015P_RT5682S_CARD_NAME \"mt8192_mt6359_rt1015p_rt5682s\"\n\n#define RT1015_RT5682_OF_NAME \"mediatek,mt8192_mt6359_rt1015_rt5682\"\n#define RT1015P_RT5682_OF_NAME \"mediatek,mt8192_mt6359_rt1015p_rt5682\"\n#define RT1015P_RT5682S_OF_NAME \"mediatek,mt8192_mt6359_rt1015p_rt5682s\"\n\nstruct mt8192_mt6359_priv {\n\tstruct snd_soc_jack headset_jack;\n\tstruct snd_soc_jack hdmi_jack;\n};\n\n \nstatic struct snd_soc_jack_pin mt8192_jack_pins[] = {\n\t{\n\t\t.pin = \"Headphone Jack\",\n\t\t.mask = SND_JACK_HEADPHONE,\n\t},\n\t{\n\t\t.pin = \"Headset Mic\",\n\t\t.mask = SND_JACK_MICROPHONE,\n\t},\n};\n\nstatic int mt8192_rt1015_i2s_hw_params(struct snd_pcm_substream *substream,\n\t\t\t\t       struct snd_pcm_hw_params *params)\n{\n\tstruct snd_soc_pcm_runtime *rtd = asoc_substream_to_rtd(substream);\n\tstruct snd_soc_card *card = rtd->card;\n\tstruct snd_soc_dai *cpu_dai = asoc_rtd_to_cpu(rtd, 0);\n\tstruct snd_soc_dai *codec_dai;\n\tunsigned int rate = params_rate(params);\n\tunsigned int mclk_fs_ratio = 128;\n\tunsigned int mclk_fs = rate * mclk_fs_ratio;\n\tint ret, i;\n\n\tfor_each_rtd_codec_dais(rtd, i, codec_dai) {\n\t\tret = snd_soc_dai_set_pll(codec_dai, 0,\n\t\t\t\t\t  RT1015_PLL_S_BCLK,\n\t\t\t\t\t  params_rate(params) * 64,\n\t\t\t\t\t  params_rate(params) * 256);\n\t\tif (ret) {\n\t\t\tdev_err(card->dev, \"failed to set pll\\n\");\n\t\t\treturn ret;\n\t\t}\n\n\t\tret = snd_soc_dai_set_sysclk(codec_dai,\n\t\t\t\t\t     RT1015_SCLK_S_PLL,\n\t\t\t\t\t     params_rate(params) * 256,\n\t\t\t\t\t     SND_SOC_CLOCK_IN);\n\t\tif (ret) {\n\t\t\tdev_err(card->dev, \"failed to set sysclk\\n\");\n\t\t\treturn ret;\n\t\t}\n\t}\n\n\treturn snd_soc_dai_set_sysclk(cpu_dai, 0, mclk_fs, SND_SOC_CLOCK_OUT);\n}\n\nstatic int mt8192_rt5682x_i2s_hw_params(struct snd_pcm_substream *substream,\n\t\t\t\t\tstruct snd_pcm_hw_params *params)\n{\n\tstruct snd_soc_pcm_runtime *rtd = asoc_substream_to_rtd(substream);\n\tstruct snd_soc_card *card = rtd->card;\n\tstruct snd_soc_dai *cpu_dai = asoc_rtd_to_cpu(rtd, 0);\n\tstruct snd_soc_dai *codec_dai = asoc_rtd_to_codec(rtd, 0);\n\tunsigned int rate = params_rate(params);\n\tunsigned int mclk_fs_ratio = 128;\n\tunsigned int mclk_fs = rate * mclk_fs_ratio;\n\tint bitwidth;\n\tint ret;\n\n\tbitwidth = snd_pcm_format_width(params_format(params));\n\tif (bitwidth < 0) {\n\t\tdev_err(card->dev, \"invalid bit width: %d\\n\", bitwidth);\n\t\treturn bitwidth;\n\t}\n\n\tret = snd_soc_dai_set_tdm_slot(codec_dai, 0x00, 0x0, 0x2, bitwidth);\n\tif (ret) {\n\t\tdev_err(card->dev, \"failed to set tdm slot\\n\");\n\t\treturn ret;\n\t}\n\n\tret = snd_soc_dai_set_pll(codec_dai, RT5682_PLL1,\n\t\t\t\t  RT5682_PLL1_S_BCLK1,\n\t\t\t\t  params_rate(params) * 64,\n\t\t\t\t  params_rate(params) * 512);\n\tif (ret) {\n\t\tdev_err(card->dev, \"failed to set pll\\n\");\n\t\treturn ret;\n\t}\n\n\tret = snd_soc_dai_set_sysclk(codec_dai,\n\t\t\t\t     RT5682_SCLK_S_PLL1,\n\t\t\t\t     params_rate(params) * 512,\n\t\t\t\t     SND_SOC_CLOCK_IN);\n\tif (ret) {\n\t\tdev_err(card->dev, \"failed to set sysclk\\n\");\n\t\treturn ret;\n\t}\n\n\treturn snd_soc_dai_set_sysclk(cpu_dai, 0, mclk_fs, SND_SOC_CLOCK_OUT);\n}\n\nstatic const struct snd_soc_ops mt8192_rt1015_i2s_ops = {\n\t.hw_params = mt8192_rt1015_i2s_hw_params,\n};\n\nstatic const struct snd_soc_ops mt8192_rt5682x_i2s_ops = {\n\t.hw_params = mt8192_rt5682x_i2s_hw_params,\n};\n\nstatic int mt8192_mt6359_mtkaif_calibration(struct snd_soc_pcm_runtime *rtd)\n{\n\tstruct snd_soc_component *cmpnt_afe =\n\t\tsnd_soc_rtdcom_lookup(rtd, AFE_PCM_NAME);\n\tstruct snd_soc_component *cmpnt_codec =\n\t\tasoc_rtd_to_codec(rtd, 0)->component;\n\tstruct mtk_base_afe *afe = snd_soc_component_get_drvdata(cmpnt_afe);\n\tstruct mt8192_afe_private *afe_priv = afe->platform_priv;\n\tint phase;\n\tunsigned int monitor;\n\tint test_done_1, test_done_2, test_done_3;\n\tint cycle_1, cycle_2, cycle_3;\n\tint prev_cycle_1, prev_cycle_2, prev_cycle_3;\n\tint chosen_phase_1, chosen_phase_2, chosen_phase_3;\n\tint counter;\n\tint mtkaif_calib_ok;\n\n\tpm_runtime_get_sync(afe->dev);\n\tmt8192_afe_gpio_request(afe->dev, true, MT8192_DAI_ADDA, 1);\n\tmt8192_afe_gpio_request(afe->dev, true, MT8192_DAI_ADDA, 0);\n\tmt8192_afe_gpio_request(afe->dev, true, MT8192_DAI_ADDA_CH34, 1);\n\tmt8192_afe_gpio_request(afe->dev, true, MT8192_DAI_ADDA_CH34, 0);\n\n\tmt6359_mtkaif_calibration_enable(cmpnt_codec);\n\n\t \n\tregmap_update_bits(afe->regmap, AFE_AUD_PAD_TOP, 0xff, 0x38);\n\tregmap_update_bits(afe->regmap, AFE_AUD_PAD_TOP, 0xff, 0x39);\n\n\t \n\tregmap_update_bits(afe_priv->topckgen,\n\t\t\t   CKSYS_AUD_TOP_CFG, 0xffff, 0x4);\n\n\tmtkaif_calib_ok = true;\n\tafe_priv->mtkaif_calibration_num_phase = 42;\t \n\tafe_priv->mtkaif_chosen_phase[0] = -1;\n\tafe_priv->mtkaif_chosen_phase[1] = -1;\n\tafe_priv->mtkaif_chosen_phase[2] = -1;\n\n\tfor (phase = 0;\n\t     phase <= afe_priv->mtkaif_calibration_num_phase &&\n\t     mtkaif_calib_ok;\n\t     phase++) {\n\t\tmt6359_set_mtkaif_calibration_phase(cmpnt_codec,\n\t\t\t\t\t\t    phase, phase, phase);\n\n\t\tregmap_update_bits(afe_priv->topckgen,\n\t\t\t\t   CKSYS_AUD_TOP_CFG, 0x1, 0x1);\n\n\t\ttest_done_1 = 0;\n\t\ttest_done_2 = 0;\n\t\ttest_done_3 = 0;\n\t\tcycle_1 = -1;\n\t\tcycle_2 = -1;\n\t\tcycle_3 = -1;\n\t\tcounter = 0;\n\t\twhile (test_done_1 == 0 ||\n\t\t       test_done_2 == 0 ||\n\t\t       test_done_3 == 0) {\n\t\t\tregmap_read(afe_priv->topckgen,\n\t\t\t\t    CKSYS_AUD_TOP_MON, &monitor);\n\n\t\t\ttest_done_1 = (monitor >> 28) & 0x1;\n\t\t\ttest_done_2 = (monitor >> 29) & 0x1;\n\t\t\ttest_done_3 = (monitor >> 30) & 0x1;\n\t\t\tif (test_done_1 == 1)\n\t\t\t\tcycle_1 = monitor & 0xf;\n\n\t\t\tif (test_done_2 == 1)\n\t\t\t\tcycle_2 = (monitor >> 4) & 0xf;\n\n\t\t\tif (test_done_3 == 1)\n\t\t\t\tcycle_3 = (monitor >> 8) & 0xf;\n\n\t\t\t \n\t\t\tif (++counter > 10000) {\n\t\t\t\tdev_err(afe->dev, \"%s(), test fail, cycle_1 %d, cycle_2 %d, cycle_3 %d, monitor 0x%x\\n\",\n\t\t\t\t\t__func__,\n\t\t\t\t\tcycle_1, cycle_2, cycle_3, monitor);\n\t\t\t\tmtkaif_calib_ok = false;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (phase == 0) {\n\t\t\tprev_cycle_1 = cycle_1;\n\t\t\tprev_cycle_2 = cycle_2;\n\t\t\tprev_cycle_3 = cycle_3;\n\t\t}\n\n\t\tif (cycle_1 != prev_cycle_1 &&\n\t\t    afe_priv->mtkaif_chosen_phase[0] < 0) {\n\t\t\tafe_priv->mtkaif_chosen_phase[0] = phase - 1;\n\t\t\tafe_priv->mtkaif_phase_cycle[0] = prev_cycle_1;\n\t\t}\n\n\t\tif (cycle_2 != prev_cycle_2 &&\n\t\t    afe_priv->mtkaif_chosen_phase[1] < 0) {\n\t\t\tafe_priv->mtkaif_chosen_phase[1] = phase - 1;\n\t\t\tafe_priv->mtkaif_phase_cycle[1] = prev_cycle_2;\n\t\t}\n\n\t\tif (cycle_3 != prev_cycle_3 &&\n\t\t    afe_priv->mtkaif_chosen_phase[2] < 0) {\n\t\t\tafe_priv->mtkaif_chosen_phase[2] = phase - 1;\n\t\t\tafe_priv->mtkaif_phase_cycle[2] = prev_cycle_3;\n\t\t}\n\n\t\tregmap_update_bits(afe_priv->topckgen,\n\t\t\t\t   CKSYS_AUD_TOP_CFG, 0x1, 0x0);\n\n\t\tif (afe_priv->mtkaif_chosen_phase[0] >= 0 &&\n\t\t    afe_priv->mtkaif_chosen_phase[1] >= 0 &&\n\t\t    afe_priv->mtkaif_chosen_phase[2] >= 0)\n\t\t\tbreak;\n\t}\n\n\tif (afe_priv->mtkaif_chosen_phase[0] < 0)\n\t\tchosen_phase_1 = 0;\n\telse\n\t\tchosen_phase_1 = afe_priv->mtkaif_chosen_phase[0];\n\n\tif (afe_priv->mtkaif_chosen_phase[1] < 0)\n\t\tchosen_phase_2 = 0;\n\telse\n\t\tchosen_phase_2 = afe_priv->mtkaif_chosen_phase[1];\n\n\tif (afe_priv->mtkaif_chosen_phase[2] < 0)\n\t\tchosen_phase_3 = 0;\n\telse\n\t\tchosen_phase_3 = afe_priv->mtkaif_chosen_phase[2];\n\n\tmt6359_set_mtkaif_calibration_phase(cmpnt_codec,\n\t\t\t\t\t    chosen_phase_1,\n\t\t\t\t\t    chosen_phase_2,\n\t\t\t\t\t    chosen_phase_3);\n\n\t \n\tregmap_update_bits(afe->regmap, AFE_AUD_PAD_TOP, 0xff, 0x38);\n\n\tmt6359_mtkaif_calibration_disable(cmpnt_codec);\n\n\tmt8192_afe_gpio_request(afe->dev, false, MT8192_DAI_ADDA, 1);\n\tmt8192_afe_gpio_request(afe->dev, false, MT8192_DAI_ADDA, 0);\n\tmt8192_afe_gpio_request(afe->dev, false, MT8192_DAI_ADDA_CH34, 1);\n\tmt8192_afe_gpio_request(afe->dev, false, MT8192_DAI_ADDA_CH34, 0);\n\tpm_runtime_put(afe->dev);\n\n\tdev_dbg(afe->dev, \"%s(), mtkaif_chosen_phase[0/1/2]:%d/%d/%d\\n\",\n\t\t__func__,\n\t\tafe_priv->mtkaif_chosen_phase[0],\n\t\tafe_priv->mtkaif_chosen_phase[1],\n\t\tafe_priv->mtkaif_chosen_phase[2]);\n\n\treturn 0;\n}\n\nstatic int mt8192_mt6359_init(struct snd_soc_pcm_runtime *rtd)\n{\n\tstruct snd_soc_component *cmpnt_afe =\n\t\tsnd_soc_rtdcom_lookup(rtd, AFE_PCM_NAME);\n\tstruct snd_soc_component *cmpnt_codec =\n\t\tasoc_rtd_to_codec(rtd, 0)->component;\n\tstruct mtk_base_afe *afe = snd_soc_component_get_drvdata(cmpnt_afe);\n\tstruct mt8192_afe_private *afe_priv = afe->platform_priv;\n\n\t \n\tmt6359_set_mtkaif_protocol(cmpnt_codec,\n\t\t\t\t   MT6359_MTKAIF_PROTOCOL_2_CLK_P2);\n\tafe_priv->mtkaif_protocol = MTKAIF_PROTOCOL_2_CLK_P2;\n\n\t \n\tmt8192_mt6359_mtkaif_calibration(rtd);\n\n\treturn 0;\n}\n\nstatic int mt8192_rt5682_init(struct snd_soc_pcm_runtime *rtd)\n{\n\tstruct snd_soc_component *cmpnt_afe =\n\t\tsnd_soc_rtdcom_lookup(rtd, AFE_PCM_NAME);\n\tstruct mtk_base_afe *afe = snd_soc_component_get_drvdata(cmpnt_afe);\n\tstruct snd_soc_component *cmpnt_codec =\n\t\tasoc_rtd_to_codec(rtd, 0)->component;\n\tstruct mt8192_mt6359_priv *priv = snd_soc_card_get_drvdata(rtd->card);\n\tstruct snd_soc_jack *jack = &priv->headset_jack;\n\tint ret;\n\n\tret = mt8192_dai_i2s_set_share(afe, \"I2S8\", \"I2S9\");\n\tif (ret) {\n\t\tdev_err(rtd->dev, \"Failed to set up shared clocks\\n\");\n\t\treturn ret;\n\t}\n\n\tret = snd_soc_card_jack_new_pins(rtd->card, \"Headset Jack\",\n\t\t\t\t    SND_JACK_HEADSET | SND_JACK_BTN_0 |\n\t\t\t\t    SND_JACK_BTN_1 | SND_JACK_BTN_2 |\n\t\t\t\t    SND_JACK_BTN_3,\n\t\t\t\t    jack, mt8192_jack_pins,\n\t\t\t\t    ARRAY_SIZE(mt8192_jack_pins));\n\tif (ret) {\n\t\tdev_err(rtd->dev, \"Headset Jack creation failed: %d\\n\", ret);\n\t\treturn ret;\n\t}\n\n\tsnd_jack_set_key(jack->jack, SND_JACK_BTN_0, KEY_PLAYPAUSE);\n\tsnd_jack_set_key(jack->jack, SND_JACK_BTN_1, KEY_VOICECOMMAND);\n\tsnd_jack_set_key(jack->jack, SND_JACK_BTN_2, KEY_VOLUMEUP);\n\tsnd_jack_set_key(jack->jack, SND_JACK_BTN_3, KEY_VOLUMEDOWN);\n\n\treturn snd_soc_component_set_jack(cmpnt_codec, jack, NULL);\n};\n\nstatic int mt8192_mt6359_hdmi_init(struct snd_soc_pcm_runtime *rtd)\n{\n\tstruct snd_soc_component *cmpnt_codec =\n\t\tasoc_rtd_to_codec(rtd, 0)->component;\n\tstruct mt8192_mt6359_priv *priv = snd_soc_card_get_drvdata(rtd->card);\n\tint ret;\n\n\tret = snd_soc_card_jack_new(rtd->card, \"HDMI Jack\", SND_JACK_LINEOUT,\n\t\t\t\t    &priv->hdmi_jack);\n\tif (ret) {\n\t\tdev_err(rtd->dev, \"HDMI Jack creation failed: %d\\n\", ret);\n\t\treturn ret;\n\t}\n\n\treturn snd_soc_component_set_jack(cmpnt_codec, &priv->hdmi_jack, NULL);\n}\n\nstatic int mt8192_i2s_hw_params_fixup(struct snd_soc_pcm_runtime *rtd,\n\t\t\t\t      struct snd_pcm_hw_params *params)\n{\n\t \n\tsnd_mask_reset_range(hw_param_mask(params, SNDRV_PCM_HW_PARAM_FORMAT),\n\t\t\t     0, (__force unsigned int)SNDRV_PCM_FORMAT_LAST);\n\n\tparams_set_format(params, SNDRV_PCM_FORMAT_S24_LE);\n\n\treturn 0;\n}\n\nstatic int\nmt8192_mt6359_cap1_startup(struct snd_pcm_substream *substream)\n{\n\tstatic const unsigned int channels[] = {\n\t\t1, 2, 4\n\t};\n\tstatic const struct snd_pcm_hw_constraint_list constraints_channels = {\n\t\t.count = ARRAY_SIZE(channels),\n\t\t.list = channels,\n\t\t.mask = 0,\n\t};\n\tstatic const unsigned int rates[] = {\n\t\t8000, 16000, 32000, 48000, 96000, 192000\n\t};\n\tstatic const struct snd_pcm_hw_constraint_list constraints_rates = {\n\t\t.count = ARRAY_SIZE(rates),\n\t\t.list  = rates,\n\t\t.mask = 0,\n\t};\n\n\tstruct snd_soc_pcm_runtime *rtd = asoc_substream_to_rtd(substream);\n\tstruct snd_pcm_runtime *runtime = substream->runtime;\n\tint ret;\n\n\tret = snd_pcm_hw_constraint_list(runtime, 0,\n\t\t\t\t\t SNDRV_PCM_HW_PARAM_CHANNELS,\n\t\t\t\t\t &constraints_channels);\n\tif (ret < 0) {\n\t\tdev_err(rtd->dev, \"hw_constraint_list channels failed\\n\");\n\t\treturn ret;\n\t}\n\n\tret = snd_pcm_hw_constraint_list(runtime, 0,\n\t\t\t\t\t SNDRV_PCM_HW_PARAM_RATE,\n\t\t\t\t\t &constraints_rates);\n\tif (ret < 0) {\n\t\tdev_err(rtd->dev, \"hw_constraint_list rate failed\\n\");\n\t\treturn ret;\n\t}\n\n\treturn 0;\n}\n\nstatic const struct snd_soc_ops mt8192_mt6359_capture1_ops = {\n\t.startup = mt8192_mt6359_cap1_startup,\n};\n\nstatic int\nmt8192_mt6359_rt5682_startup(struct snd_pcm_substream *substream)\n{\n\tstatic const unsigned int channels[] = {\n\t\t1, 2\n\t};\n\tstatic const struct snd_pcm_hw_constraint_list constraints_channels = {\n\t\t.count = ARRAY_SIZE(channels),\n\t\t.list = channels,\n\t\t.mask = 0,\n\t};\n\tstatic const unsigned int rates[] = {\n\t\t48000\n\t};\n\tstatic const struct snd_pcm_hw_constraint_list constraints_rates = {\n\t\t.count = ARRAY_SIZE(rates),\n\t\t.list  = rates,\n\t\t.mask = 0,\n\t};\n\n\tstruct snd_soc_pcm_runtime *rtd = asoc_substream_to_rtd(substream);\n\tstruct snd_pcm_runtime *runtime = substream->runtime;\n\tint ret;\n\n\tret = snd_pcm_hw_constraint_list(runtime, 0,\n\t\t\t\t\t SNDRV_PCM_HW_PARAM_CHANNELS,\n\t\t\t\t\t &constraints_channels);\n\tif (ret < 0) {\n\t\tdev_err(rtd->dev, \"hw_constraint_list channels failed\\n\");\n\t\treturn ret;\n\t}\n\n\tret = snd_pcm_hw_constraint_list(runtime, 0,\n\t\t\t\t\t SNDRV_PCM_HW_PARAM_RATE,\n\t\t\t\t\t &constraints_rates);\n\tif (ret < 0) {\n\t\tdev_err(rtd->dev, \"hw_constraint_list rate failed\\n\");\n\t\treturn ret;\n\t}\n\n\treturn 0;\n}\n\nstatic const struct snd_soc_ops mt8192_mt6359_rt5682_ops = {\n\t.startup = mt8192_mt6359_rt5682_startup,\n};\n\n \nSND_SOC_DAILINK_DEFS(playback1,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"DL1\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(playback12,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"DL12\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(playback2,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"DL2\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(playback3,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"DL3\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(playback4,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"DL4\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(playback5,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"DL5\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(playback6,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"DL6\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(playback7,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"DL7\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(playback8,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"DL8\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(playback9,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"DL9\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(capture1,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"UL1\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(capture2,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"UL2\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(capture3,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"UL3\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(capture4,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"UL4\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(capture5,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"UL5\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(capture6,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"UL6\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(capture7,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"UL7\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(capture8,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"UL8\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(capture_mono1,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"UL_MONO_1\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(capture_mono2,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"UL_MONO_2\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(capture_mono3,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"UL_MONO_3\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(playback_hdmi,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"HDMI\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\n \nSND_SOC_DAILINK_DEFS(primary_codec,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"ADDA\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_CODEC(\"mt6359-sound\",\n\t\t\t\t\t\t   \"mt6359-snd-codec-aif1\"),\n\t\t\t\t\tCOMP_CODEC(\"dmic-codec\",\n\t\t\t\t\t\t   \"dmic-hifi\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(primary_codec_ch34,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"ADDA_CH34\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_CODEC(\"mt6359-sound\",\n\t\t\t\t\t\t   \"mt6359-snd-codec-aif2\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(ap_dmic,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"AP_DMIC\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(ap_dmic_ch34,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"AP_DMIC_CH34\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(i2s0,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"I2S0\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(i2s1,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"I2S1\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(i2s2,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"I2S2\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(i2s3,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"I2S3\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(i2s5,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"I2S5\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(i2s6,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"I2S6\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(i2s7,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"I2S7\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(i2s8,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"I2S8\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(i2s9,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"I2S9\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(connsys_i2s,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"CONNSYS_I2S\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(pcm1,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"PCM 1\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(pcm2,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"PCM 2\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(tdm,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"TDM\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_CODEC(NULL, \"i2s-hifi\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nstatic struct snd_soc_dai_link mt8192_mt6359_dai_links[] = {\n\t \n\t{\n\t\t.name = \"Playback_1\",\n\t\t.stream_name = \"Playback_1\",\n\t\t.trigger = {SND_SOC_DPCM_TRIGGER_PRE,\n\t\t\t    SND_SOC_DPCM_TRIGGER_PRE},\n\t\t.dynamic = 1,\n\t\t.dpcm_playback = 1,\n\t\tSND_SOC_DAILINK_REG(playback1),\n\t},\n\t{\n\t\t.name = \"Playback_12\",\n\t\t.stream_name = \"Playback_12\",\n\t\t.trigger = {SND_SOC_DPCM_TRIGGER_PRE,\n\t\t\t    SND_SOC_DPCM_TRIGGER_PRE},\n\t\t.dynamic = 1,\n\t\t.dpcm_playback = 1,\n\t\tSND_SOC_DAILINK_REG(playback12),\n\t},\n\t{\n\t\t.name = \"Playback_2\",\n\t\t.stream_name = \"Playback_2\",\n\t\t.trigger = {SND_SOC_DPCM_TRIGGER_PRE,\n\t\t\t    SND_SOC_DPCM_TRIGGER_PRE},\n\t\t.dynamic = 1,\n\t\t.dpcm_playback = 1,\n\t\tSND_SOC_DAILINK_REG(playback2),\n\t},\n\t{\n\t\t.name = \"Playback_3\",\n\t\t.stream_name = \"Playback_3\",\n\t\t.trigger = {SND_SOC_DPCM_TRIGGER_PRE,\n\t\t\t    SND_SOC_DPCM_TRIGGER_PRE},\n\t\t.dynamic = 1,\n\t\t.dpcm_playback = 1,\n\t\t.ops = &mt8192_mt6359_rt5682_ops,\n\t\tSND_SOC_DAILINK_REG(playback3),\n\t},\n\t{\n\t\t.name = \"Playback_4\",\n\t\t.stream_name = \"Playback_4\",\n\t\t.trigger = {SND_SOC_DPCM_TRIGGER_PRE,\n\t\t\t    SND_SOC_DPCM_TRIGGER_PRE},\n\t\t.dynamic = 1,\n\t\t.dpcm_playback = 1,\n\t\tSND_SOC_DAILINK_REG(playback4),\n\t},\n\t{\n\t\t.name = \"Playback_5\",\n\t\t.stream_name = \"Playback_5\",\n\t\t.trigger = {SND_SOC_DPCM_TRIGGER_PRE,\n\t\t\t    SND_SOC_DPCM_TRIGGER_PRE},\n\t\t.dynamic = 1,\n\t\t.dpcm_playback = 1,\n\t\tSND_SOC_DAILINK_REG(playback5),\n\t},\n\t{\n\t\t.name = \"Playback_6\",\n\t\t.stream_name = \"Playback_6\",\n\t\t.trigger = {SND_SOC_DPCM_TRIGGER_PRE,\n\t\t\t    SND_SOC_DPCM_TRIGGER_PRE},\n\t\t.dynamic = 1,\n\t\t.dpcm_playback = 1,\n\t\tSND_SOC_DAILINK_REG(playback6),\n\t},\n\t{\n\t\t.name = \"Playback_7\",\n\t\t.stream_name = \"Playback_7\",\n\t\t.trigger = {SND_SOC_DPCM_TRIGGER_PRE,\n\t\t\t    SND_SOC_DPCM_TRIGGER_PRE},\n\t\t.dynamic = 1,\n\t\t.dpcm_playback = 1,\n\t\tSND_SOC_DAILINK_REG(playback7),\n\t},\n\t{\n\t\t.name = \"Playback_8\",\n\t\t.stream_name = \"Playback_8\",\n\t\t.trigger = {SND_SOC_DPCM_TRIGGER_PRE,\n\t\t\t    SND_SOC_DPCM_TRIGGER_PRE},\n\t\t.dynamic = 1,\n\t\t.dpcm_playback = 1,\n\t\tSND_SOC_DAILINK_REG(playback8),\n\t},\n\t{\n\t\t.name = \"Playback_9\",\n\t\t.stream_name = \"Playback_9\",\n\t\t.trigger = {SND_SOC_DPCM_TRIGGER_PRE,\n\t\t\t    SND_SOC_DPCM_TRIGGER_PRE},\n\t\t.dynamic = 1,\n\t\t.dpcm_playback = 1,\n\t\tSND_SOC_DAILINK_REG(playback9),\n\t},\n\t{\n\t\t.name = \"Capture_1\",\n\t\t.stream_name = \"Capture_1\",\n\t\t.trigger = {SND_SOC_DPCM_TRIGGER_PRE,\n\t\t\t    SND_SOC_DPCM_TRIGGER_PRE},\n\t\t.dynamic = 1,\n\t\t.dpcm_capture = 1,\n\t\t.ops = &mt8192_mt6359_capture1_ops,\n\t\tSND_SOC_DAILINK_REG(capture1),\n\t},\n\t{\n\t\t.name = \"Capture_2\",\n\t\t.stream_name = \"Capture_2\",\n\t\t.trigger = {SND_SOC_DPCM_TRIGGER_PRE,\n\t\t\t    SND_SOC_DPCM_TRIGGER_PRE},\n\t\t.dynamic = 1,\n\t\t.dpcm_capture = 1,\n\t\t.ops = &mt8192_mt6359_rt5682_ops,\n\t\tSND_SOC_DAILINK_REG(capture2),\n\t},\n\t{\n\t\t.name = \"Capture_3\",\n\t\t.stream_name = \"Capture_3\",\n\t\t.trigger = {SND_SOC_DPCM_TRIGGER_PRE,\n\t\t\t    SND_SOC_DPCM_TRIGGER_PRE},\n\t\t.dynamic = 1,\n\t\t.dpcm_capture = 1,\n\t\tSND_SOC_DAILINK_REG(capture3),\n\t},\n\t{\n\t\t.name = \"Capture_4\",\n\t\t.stream_name = \"Capture_4\",\n\t\t.trigger = {SND_SOC_DPCM_TRIGGER_PRE,\n\t\t\t    SND_SOC_DPCM_TRIGGER_PRE},\n\t\t.dynamic = 1,\n\t\t.dpcm_capture = 1,\n\t\tSND_SOC_DAILINK_REG(capture4),\n\t},\n\t{\n\t\t.name = \"Capture_5\",\n\t\t.stream_name = \"Capture_5\",\n\t\t.trigger = {SND_SOC_DPCM_TRIGGER_PRE,\n\t\t\t    SND_SOC_DPCM_TRIGGER_PRE},\n\t\t.dynamic = 1,\n\t\t.dpcm_capture = 1,\n\t\tSND_SOC_DAILINK_REG(capture5),\n\t},\n\t{\n\t\t.name = \"Capture_6\",\n\t\t.stream_name = \"Capture_6\",\n\t\t.trigger = {SND_SOC_DPCM_TRIGGER_PRE,\n\t\t\t    SND_SOC_DPCM_TRIGGER_PRE},\n\t\t.dynamic = 1,\n\t\t.dpcm_capture = 1,\n\t\tSND_SOC_DAILINK_REG(capture6),\n\t},\n\t{\n\t\t.name = \"Capture_7\",\n\t\t.stream_name = \"Capture_7\",\n\t\t.trigger = {SND_SOC_DPCM_TRIGGER_PRE,\n\t\t\t    SND_SOC_DPCM_TRIGGER_PRE},\n\t\t.dynamic = 1,\n\t\t.dpcm_capture = 1,\n\t\tSND_SOC_DAILINK_REG(capture7),\n\t},\n\t{\n\t\t.name = \"Capture_8\",\n\t\t.stream_name = \"Capture_8\",\n\t\t.trigger = {SND_SOC_DPCM_TRIGGER_PRE,\n\t\t\t    SND_SOC_DPCM_TRIGGER_PRE},\n\t\t.dynamic = 1,\n\t\t.dpcm_capture = 1,\n\t\tSND_SOC_DAILINK_REG(capture8),\n\t},\n\t{\n\t\t.name = \"Capture_Mono_1\",\n\t\t.stream_name = \"Capture_Mono_1\",\n\t\t.trigger = {SND_SOC_DPCM_TRIGGER_PRE,\n\t\t\t    SND_SOC_DPCM_TRIGGER_PRE},\n\t\t.dynamic = 1,\n\t\t.dpcm_capture = 1,\n\t\tSND_SOC_DAILINK_REG(capture_mono1),\n\t},\n\t{\n\t\t.name = \"Capture_Mono_2\",\n\t\t.stream_name = \"Capture_Mono_2\",\n\t\t.trigger = {SND_SOC_DPCM_TRIGGER_PRE,\n\t\t\t    SND_SOC_DPCM_TRIGGER_PRE},\n\t\t.dynamic = 1,\n\t\t.dpcm_capture = 1,\n\t\tSND_SOC_DAILINK_REG(capture_mono2),\n\t},\n\t{\n\t\t.name = \"Capture_Mono_3\",\n\t\t.stream_name = \"Capture_Mono_3\",\n\t\t.trigger = {SND_SOC_DPCM_TRIGGER_PRE,\n\t\t\t    SND_SOC_DPCM_TRIGGER_PRE},\n\t\t.dynamic = 1,\n\t\t.dpcm_capture = 1,\n\t\tSND_SOC_DAILINK_REG(capture_mono3),\n\t},\n\t{\n\t\t.name = \"playback_hdmi\",\n\t\t.stream_name = \"Playback_HDMI\",\n\t\t.trigger = {SND_SOC_DPCM_TRIGGER_PRE,\n\t\t\t    SND_SOC_DPCM_TRIGGER_PRE},\n\t\t.dynamic = 1,\n\t\t.dpcm_playback = 1,\n\t\tSND_SOC_DAILINK_REG(playback_hdmi),\n\t},\n\t \n\t{\n\t\t.name = \"Primary Codec\",\n\t\t.no_pcm = 1,\n\t\t.dpcm_playback = 1,\n\t\t.dpcm_capture = 1,\n\t\t.ignore_suspend = 1,\n\t\t.init = mt8192_mt6359_init,\n\t\tSND_SOC_DAILINK_REG(primary_codec),\n\t},\n\t{\n\t\t.name = \"Primary Codec CH34\",\n\t\t.no_pcm = 1,\n\t\t.dpcm_playback = 1,\n\t\t.dpcm_capture = 1,\n\t\t.ignore_suspend = 1,\n\t\tSND_SOC_DAILINK_REG(primary_codec_ch34),\n\t},\n\t{\n\t\t.name = \"AP_DMIC\",\n\t\t.no_pcm = 1,\n\t\t.dpcm_capture = 1,\n\t\t.ignore_suspend = 1,\n\t\tSND_SOC_DAILINK_REG(ap_dmic),\n\t},\n\t{\n\t\t.name = \"AP_DMIC_CH34\",\n\t\t.no_pcm = 1,\n\t\t.dpcm_capture = 1,\n\t\t.ignore_suspend = 1,\n\t\tSND_SOC_DAILINK_REG(ap_dmic_ch34),\n\t},\n\t{\n\t\t.name = \"I2S0\",\n\t\t.no_pcm = 1,\n\t\t.dpcm_capture = 1,\n\t\t.ignore_suspend = 1,\n\t\t.be_hw_params_fixup = mt8192_i2s_hw_params_fixup,\n\t\tSND_SOC_DAILINK_REG(i2s0),\n\t},\n\t{\n\t\t.name = \"I2S1\",\n\t\t.no_pcm = 1,\n\t\t.dpcm_playback = 1,\n\t\t.ignore_suspend = 1,\n\t\t.be_hw_params_fixup = mt8192_i2s_hw_params_fixup,\n\t\tSND_SOC_DAILINK_REG(i2s1),\n\t},\n\t{\n\t\t.name = \"I2S2\",\n\t\t.no_pcm = 1,\n\t\t.dpcm_capture = 1,\n\t\t.ignore_suspend = 1,\n\t\t.be_hw_params_fixup = mt8192_i2s_hw_params_fixup,\n\t\tSND_SOC_DAILINK_REG(i2s2),\n\t},\n\t{\n\t\t.name = \"I2S3\",\n\t\t.no_pcm = 1,\n\t\t.dpcm_playback = 1,\n\t\t.ignore_suspend = 1,\n\t\t.be_hw_params_fixup = mt8192_i2s_hw_params_fixup,\n\t\tSND_SOC_DAILINK_REG(i2s3),\n\t},\n\t{\n\t\t.name = \"I2S5\",\n\t\t.no_pcm = 1,\n\t\t.dpcm_playback = 1,\n\t\t.ignore_suspend = 1,\n\t\t.be_hw_params_fixup = mt8192_i2s_hw_params_fixup,\n\t\tSND_SOC_DAILINK_REG(i2s5),\n\t},\n\t{\n\t\t.name = \"I2S6\",\n\t\t.no_pcm = 1,\n\t\t.dpcm_capture = 1,\n\t\t.ignore_suspend = 1,\n\t\t.be_hw_params_fixup = mt8192_i2s_hw_params_fixup,\n\t\tSND_SOC_DAILINK_REG(i2s6),\n\t},\n\t{\n\t\t.name = \"I2S7\",\n\t\t.no_pcm = 1,\n\t\t.dpcm_playback = 1,\n\t\t.ignore_suspend = 1,\n\t\t.be_hw_params_fixup = mt8192_i2s_hw_params_fixup,\n\t\tSND_SOC_DAILINK_REG(i2s7),\n\t},\n\t{\n\t\t.name = \"I2S8\",\n\t\t.no_pcm = 1,\n\t\t.dpcm_capture = 1,\n\t\t.ignore_suspend = 1,\n\t\t.init = mt8192_rt5682_init,\n\t\t.be_hw_params_fixup = mt8192_i2s_hw_params_fixup,\n\t\tSND_SOC_DAILINK_REG(i2s8),\n\t\t.ops = &mt8192_rt5682x_i2s_ops,\n\t},\n\t{\n\t\t.name = \"I2S9\",\n\t\t.no_pcm = 1,\n\t\t.dpcm_playback = 1,\n\t\t.ignore_suspend = 1,\n\t\t.be_hw_params_fixup = mt8192_i2s_hw_params_fixup,\n\t\tSND_SOC_DAILINK_REG(i2s9),\n\t\t.ops = &mt8192_rt5682x_i2s_ops,\n\t},\n\t{\n\t\t.name = \"CONNSYS_I2S\",\n\t\t.no_pcm = 1,\n\t\t.dpcm_capture = 1,\n\t\t.ignore_suspend = 1,\n\t\tSND_SOC_DAILINK_REG(connsys_i2s),\n\t},\n\t{\n\t\t.name = \"PCM 1\",\n\t\t.no_pcm = 1,\n\t\t.dpcm_playback = 1,\n\t\t.dpcm_capture = 1,\n\t\t.ignore_suspend = 1,\n\t\tSND_SOC_DAILINK_REG(pcm1),\n\t},\n\t{\n\t\t.name = \"PCM 2\",\n\t\t.no_pcm = 1,\n\t\t.dpcm_playback = 1,\n\t\t.dpcm_capture = 1,\n\t\t.ignore_suspend = 1,\n\t\tSND_SOC_DAILINK_REG(pcm2),\n\t},\n\t{\n\t\t.name = \"TDM\",\n\t\t.no_pcm = 1,\n\t\t.dai_fmt = SND_SOC_DAIFMT_DSP_A |\n\t\t\t   SND_SOC_DAIFMT_IB_NF |\n\t\t\t   SND_SOC_DAIFMT_CBM_CFM,\n\t\t.dpcm_playback = 1,\n\t\t.ignore_suspend = 1,\n\t\t.be_hw_params_fixup = mt8192_i2s_hw_params_fixup,\n\t\t.ignore = 1,\n\t\t.init = mt8192_mt6359_hdmi_init,\n\t\tSND_SOC_DAILINK_REG(tdm),\n\t},\n};\n\nstatic const struct snd_soc_dapm_widget\nmt8192_mt6359_rt1015_rt5682_widgets[] = {\n\tSND_SOC_DAPM_SPK(\"Left Spk\", NULL),\n\tSND_SOC_DAPM_SPK(\"Right Spk\", NULL),\n\tSND_SOC_DAPM_HP(\"Headphone Jack\", NULL),\n\tSND_SOC_DAPM_MIC(\"Headset Mic\", NULL),\n\tSND_SOC_DAPM_OUTPUT(\"TDM Out\"),\n};\n\nstatic const struct snd_soc_dapm_route mt8192_mt6359_rt1015_rt5682_routes[] = {\n\t \n\t{ \"Left Spk\", NULL, \"Left SPO\" },\n\t{ \"Right Spk\", NULL, \"Right SPO\" },\n\t \n\t{ \"Headphone Jack\", NULL, \"HPOL\" },\n\t{ \"Headphone Jack\", NULL, \"HPOR\" },\n\t{ \"IN1P\", NULL, \"Headset Mic\" },\n\t \n\t{ \"TDM Out\", NULL, \"TDM\" },\n};\n\nstatic const struct snd_kcontrol_new mt8192_mt6359_rt1015_rt5682_controls[] = {\n\tSOC_DAPM_PIN_SWITCH(\"Left Spk\"),\n\tSOC_DAPM_PIN_SWITCH(\"Right Spk\"),\n\tSOC_DAPM_PIN_SWITCH(\"Headphone Jack\"),\n\tSOC_DAPM_PIN_SWITCH(\"Headset Mic\"),\n};\n\nstatic struct snd_soc_codec_conf rt1015_amp_conf[] = {\n\t{\n\t\t.dlc = COMP_CODEC_CONF(RT1015_DEV0_NAME),\n\t\t.name_prefix = \"Left\",\n\t},\n\t{\n\t\t.dlc = COMP_CODEC_CONF(RT1015_DEV1_NAME),\n\t\t.name_prefix = \"Right\",\n\t},\n};\n\nstatic struct snd_soc_card mt8192_mt6359_rt1015_rt5682_card = {\n\t.name = RT1015_RT5682_CARD_NAME,\n\t.driver_name = DRIVER_NAME,\n\t.owner = THIS_MODULE,\n\t.dai_link = mt8192_mt6359_dai_links,\n\t.num_links = ARRAY_SIZE(mt8192_mt6359_dai_links),\n\t.controls = mt8192_mt6359_rt1015_rt5682_controls,\n\t.num_controls = ARRAY_SIZE(mt8192_mt6359_rt1015_rt5682_controls),\n\t.dapm_widgets = mt8192_mt6359_rt1015_rt5682_widgets,\n\t.num_dapm_widgets = ARRAY_SIZE(mt8192_mt6359_rt1015_rt5682_widgets),\n\t.dapm_routes = mt8192_mt6359_rt1015_rt5682_routes,\n\t.num_dapm_routes = ARRAY_SIZE(mt8192_mt6359_rt1015_rt5682_routes),\n\t.codec_conf = rt1015_amp_conf,\n\t.num_configs = ARRAY_SIZE(rt1015_amp_conf),\n};\n\nstatic const struct snd_soc_dapm_widget mt8192_mt6359_rt1015p_rt5682x_widgets[] = {\n\tSND_SOC_DAPM_SPK(\"Speakers\", NULL),\n\tSND_SOC_DAPM_HP(\"Headphone Jack\", NULL),\n\tSND_SOC_DAPM_MIC(\"Headset Mic\", NULL),\n};\n\nstatic const struct snd_soc_dapm_route mt8192_mt6359_rt1015p_rt5682x_routes[] = {\n\t \n\t{ \"Speakers\", NULL, \"Speaker\" },\n\t \n\t{ \"Headphone Jack\", NULL, \"HPOL\" },\n\t{ \"Headphone Jack\", NULL, \"HPOR\" },\n\t{ \"IN1P\", NULL, \"Headset Mic\" },\n};\n\nstatic const struct snd_kcontrol_new mt8192_mt6359_rt1015p_rt5682x_controls[] = {\n\tSOC_DAPM_PIN_SWITCH(\"Speakers\"),\n\tSOC_DAPM_PIN_SWITCH(\"Headphone Jack\"),\n\tSOC_DAPM_PIN_SWITCH(\"Headset Mic\"),\n};\n\nstatic struct snd_soc_card mt8192_mt6359_rt1015p_rt5682x_card = {\n\t.driver_name = DRIVER_NAME,\n\t.owner = THIS_MODULE,\n\t.dai_link = mt8192_mt6359_dai_links,\n\t.num_links = ARRAY_SIZE(mt8192_mt6359_dai_links),\n\t.controls = mt8192_mt6359_rt1015p_rt5682x_controls,\n\t.num_controls = ARRAY_SIZE(mt8192_mt6359_rt1015p_rt5682x_controls),\n\t.dapm_widgets = mt8192_mt6359_rt1015p_rt5682x_widgets,\n\t.num_dapm_widgets = ARRAY_SIZE(mt8192_mt6359_rt1015p_rt5682x_widgets),\n\t.dapm_routes = mt8192_mt6359_rt1015p_rt5682x_routes,\n\t.num_dapm_routes = ARRAY_SIZE(mt8192_mt6359_rt1015p_rt5682x_routes),\n};\n\nstatic int mt8192_mt6359_card_set_be_link(struct snd_soc_card *card,\n\t\t\t\t\t  struct snd_soc_dai_link *link,\n\t\t\t\t\t  struct device_node *node,\n\t\t\t\t\t  char *link_name)\n{\n\tint ret;\n\n\tif (node && strcmp(link->name, link_name) == 0) {\n\t\tret = snd_soc_of_get_dai_link_codecs(card->dev, node, link);\n\t\tif (ret < 0) {\n\t\t\tdev_err_probe(card->dev, ret, \"get dai link codecs fail\\n\");\n\t\t\treturn ret;\n\t\t}\n\t}\n\n\treturn 0;\n}\n\nstatic int mt8192_mt6359_dev_probe(struct platform_device *pdev)\n{\n\tstruct snd_soc_card *card;\n\tstruct device_node *platform_node, *hdmi_codec, *headset_codec, *speaker_codec;\n\tint ret, i;\n\tstruct snd_soc_dai_link *dai_link;\n\tstruct mt8192_mt6359_priv *priv;\n\n\tcard = (struct snd_soc_card *)of_device_get_match_data(&pdev->dev);\n\tif (!card)\n\t\treturn -EINVAL;\n\tcard->dev = &pdev->dev;\n\n\tif (of_device_is_compatible(pdev->dev.of_node, RT1015P_RT5682_OF_NAME))\n\t\tcard->name = RT1015P_RT5682_CARD_NAME;\n\telse if (of_device_is_compatible(pdev->dev.of_node, RT1015P_RT5682S_OF_NAME))\n\t\tcard->name = RT1015P_RT5682S_CARD_NAME;\n\telse\n\t\tdev_dbg(&pdev->dev, \"No need to set card name\\n\");\n\n\thdmi_codec = of_parse_phandle(pdev->dev.of_node, \"mediatek,hdmi-codec\", 0);\n\tif (!hdmi_codec)\n\t\tdev_dbg(&pdev->dev, \"The machine has no hdmi-codec\\n\");\n\n\tplatform_node = of_parse_phandle(pdev->dev.of_node, \"mediatek,platform\", 0);\n\tif (!platform_node) {\n\t\tret = -EINVAL;\n\t\tdev_err_probe(&pdev->dev, ret, \"Property 'platform' missing or invalid\\n\");\n\t\tgoto err_platform_node;\n\t}\n\n\tspeaker_codec = of_get_child_by_name(pdev->dev.of_node, \"speaker-codecs\");\n\tif (!speaker_codec) {\n\t\tret = -EINVAL;\n\t\tdev_err_probe(&pdev->dev, ret, \"Property 'speaker-codecs' missing or invalid\\n\");\n\t\tgoto err_speaker_codec;\n\t}\n\n\theadset_codec = of_get_child_by_name(pdev->dev.of_node, \"headset-codec\");\n\tif (!headset_codec) {\n\t\tret = -EINVAL;\n\t\tdev_err_probe(&pdev->dev, ret, \"Property 'headset-codec' missing or invalid\\n\");\n\t\tgoto err_headset_codec;\n\t}\n\n\tfor_each_card_prelinks(card, i, dai_link) {\n\t\tret = mt8192_mt6359_card_set_be_link(card, dai_link, speaker_codec, \"I2S3\");\n\t\tif (ret) {\n\t\t\tdev_err_probe(&pdev->dev, ret, \"%s set speaker_codec fail\\n\",\n\t\t\t\t      dai_link->name);\n\t\t\tgoto err_probe;\n\t\t}\n\n\t\tret = mt8192_mt6359_card_set_be_link(card, dai_link, headset_codec, \"I2S8\");\n\t\tif (ret) {\n\t\t\tdev_err_probe(&pdev->dev, ret, \"%s set headset_codec fail\\n\",\n\t\t\t\t      dai_link->name);\n\t\t\tgoto err_probe;\n\t\t}\n\n\t\tret = mt8192_mt6359_card_set_be_link(card, dai_link, headset_codec, \"I2S9\");\n\t\tif (ret) {\n\t\t\tdev_err_probe(&pdev->dev, ret, \"%s set headset_codec fail\\n\",\n\t\t\t\t      dai_link->name);\n\t\t\tgoto err_probe;\n\t\t}\n\n\t\tif (hdmi_codec && strcmp(dai_link->name, \"TDM\") == 0) {\n\t\t\tdai_link->codecs->of_node = hdmi_codec;\n\t\t\tdai_link->ignore = 0;\n\t\t}\n\n\t\tif (strcmp(dai_link->codecs[0].dai_name, RT1015_CODEC_DAI) == 0)\n\t\t\tdai_link->ops = &mt8192_rt1015_i2s_ops;\n\n\t\tif (!dai_link->platforms->name)\n\t\t\tdai_link->platforms->of_node = platform_node;\n\t}\n\n\tpriv = devm_kzalloc(&pdev->dev, sizeof(*priv), GFP_KERNEL);\n\tif (!priv) {\n\t\tret = -ENOMEM;\n\t\tgoto err_probe;\n\t}\n\tsnd_soc_card_set_drvdata(card, priv);\n\n\tret = mt8192_afe_gpio_init(&pdev->dev);\n\tif (ret) {\n\t\tdev_err_probe(&pdev->dev, ret, \"%s init gpio error\\n\", __func__);\n\t\tgoto err_probe;\n\t}\n\n\tret = devm_snd_soc_register_card(&pdev->dev, card);\n\tif (ret)\n\t\tdev_err_probe(&pdev->dev, ret, \"%s snd_soc_register_card fail\\n\", __func__);\n\nerr_probe:\n\tof_node_put(headset_codec);\nerr_headset_codec:\n\tof_node_put(speaker_codec);\nerr_speaker_codec:\n\tof_node_put(platform_node);\nerr_platform_node:\n\tof_node_put(hdmi_codec);\n\treturn ret;\n}\n\n#ifdef CONFIG_OF\nstatic const struct of_device_id mt8192_mt6359_dt_match[] = {\n\t{\n\t\t.compatible = RT1015_RT5682_OF_NAME,\n\t\t.data = &mt8192_mt6359_rt1015_rt5682_card,\n\t},\n\t{\n\t\t.compatible = RT1015P_RT5682_OF_NAME,\n\t\t.data = &mt8192_mt6359_rt1015p_rt5682x_card,\n\t},\n\t{\n\t\t.compatible = RT1015P_RT5682S_OF_NAME,\n\t\t.data = &mt8192_mt6359_rt1015p_rt5682x_card,\n\t},\n\t{}\n};\nMODULE_DEVICE_TABLE(of, mt8192_mt6359_dt_match);\n#endif\n\nstatic const struct dev_pm_ops mt8192_mt6359_pm_ops = {\n\t.poweroff = snd_soc_poweroff,\n\t.restore = snd_soc_resume,\n};\n\nstatic struct platform_driver mt8192_mt6359_driver = {\n\t.driver = {\n\t\t.name = DRIVER_NAME,\n#ifdef CONFIG_OF\n\t\t.of_match_table = mt8192_mt6359_dt_match,\n#endif\n\t\t.pm = &mt8192_mt6359_pm_ops,\n\t},\n\t.probe = mt8192_mt6359_dev_probe,\n};\n\nmodule_platform_driver(mt8192_mt6359_driver);\n\n \nMODULE_DESCRIPTION(\"MT8192-MT6359 ALSA SoC machine driver\");\nMODULE_AUTHOR(\"Jiaxin Yu <jiaxin.yu@mediatek.com>\");\nMODULE_LICENSE(\"GPL v2\");\nMODULE_ALIAS(\"mt8192_mt6359 soc card\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}