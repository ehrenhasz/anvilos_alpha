{
  "module_name": "mt8192-dai-adda.c",
  "hash_id": "604134c516ccb35e54f8d82d75d5263250768ef19c3bbf867ce35906b0ec3af5",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/mediatek/mt8192/mt8192-dai-adda.c",
  "human_readable_source": "\n\n\n\n\n\n\n\n#include <linux/delay.h>\n#include <linux/regmap.h>\n\n#include \"mt8192-afe-clk.h\"\n#include \"mt8192-afe-common.h\"\n#include \"mt8192-afe-gpio.h\"\n#include \"mt8192-interconnection.h\"\n\nenum {\n\tUL_IIR_SW = 0,\n\tUL_IIR_5HZ,\n\tUL_IIR_10HZ,\n\tUL_IIR_25HZ,\n\tUL_IIR_50HZ,\n\tUL_IIR_75HZ,\n};\n\nenum {\n\tAUDIO_SDM_LEVEL_MUTE = 0,\n\tAUDIO_SDM_LEVEL_NORMAL = 0x1d,\n\t \n\t \n};\n\nenum {\n\tAUDIO_SDM_2ND = 0,\n\tAUDIO_SDM_3RD,\n};\n\nenum {\n\tDELAY_DATA_MISO1 = 0,\n\tDELAY_DATA_MISO2,\n};\n\nenum {\n\tMTK_AFE_ADDA_DL_RATE_8K = 0,\n\tMTK_AFE_ADDA_DL_RATE_11K = 1,\n\tMTK_AFE_ADDA_DL_RATE_12K = 2,\n\tMTK_AFE_ADDA_DL_RATE_16K = 3,\n\tMTK_AFE_ADDA_DL_RATE_22K = 4,\n\tMTK_AFE_ADDA_DL_RATE_24K = 5,\n\tMTK_AFE_ADDA_DL_RATE_32K = 6,\n\tMTK_AFE_ADDA_DL_RATE_44K = 7,\n\tMTK_AFE_ADDA_DL_RATE_48K = 8,\n\tMTK_AFE_ADDA_DL_RATE_96K = 9,\n\tMTK_AFE_ADDA_DL_RATE_192K = 10,\n};\n\nenum {\n\tMTK_AFE_ADDA_UL_RATE_8K = 0,\n\tMTK_AFE_ADDA_UL_RATE_16K = 1,\n\tMTK_AFE_ADDA_UL_RATE_32K = 2,\n\tMTK_AFE_ADDA_UL_RATE_48K = 3,\n\tMTK_AFE_ADDA_UL_RATE_96K = 4,\n\tMTK_AFE_ADDA_UL_RATE_192K = 5,\n\tMTK_AFE_ADDA_UL_RATE_48K_HD = 6,\n};\n\n#define SDM_AUTO_RESET_THRESHOLD 0x190000\n\nstatic unsigned int adda_dl_rate_transform(struct mtk_base_afe *afe,\n\t\t\t\t\t   unsigned int rate)\n{\n\tswitch (rate) {\n\tcase 8000:\n\t\treturn MTK_AFE_ADDA_DL_RATE_8K;\n\tcase 11025:\n\t\treturn MTK_AFE_ADDA_DL_RATE_11K;\n\tcase 12000:\n\t\treturn MTK_AFE_ADDA_DL_RATE_12K;\n\tcase 16000:\n\t\treturn MTK_AFE_ADDA_DL_RATE_16K;\n\tcase 22050:\n\t\treturn MTK_AFE_ADDA_DL_RATE_22K;\n\tcase 24000:\n\t\treturn MTK_AFE_ADDA_DL_RATE_24K;\n\tcase 32000:\n\t\treturn MTK_AFE_ADDA_DL_RATE_32K;\n\tcase 44100:\n\t\treturn MTK_AFE_ADDA_DL_RATE_44K;\n\tcase 48000:\n\t\treturn MTK_AFE_ADDA_DL_RATE_48K;\n\tcase 96000:\n\t\treturn MTK_AFE_ADDA_DL_RATE_96K;\n\tcase 192000:\n\t\treturn MTK_AFE_ADDA_DL_RATE_192K;\n\tdefault:\n\t\tdev_warn(afe->dev, \"%s(), rate %d invalid, use 48kHz!!!\\n\",\n\t\t\t __func__, rate);\n\t\treturn MTK_AFE_ADDA_DL_RATE_48K;\n\t}\n}\n\nstatic unsigned int adda_ul_rate_transform(struct mtk_base_afe *afe,\n\t\t\t\t\t   unsigned int rate)\n{\n\tswitch (rate) {\n\tcase 8000:\n\t\treturn MTK_AFE_ADDA_UL_RATE_8K;\n\tcase 16000:\n\t\treturn MTK_AFE_ADDA_UL_RATE_16K;\n\tcase 32000:\n\t\treturn MTK_AFE_ADDA_UL_RATE_32K;\n\tcase 48000:\n\t\treturn MTK_AFE_ADDA_UL_RATE_48K;\n\tcase 96000:\n\t\treturn MTK_AFE_ADDA_UL_RATE_96K;\n\tcase 192000:\n\t\treturn MTK_AFE_ADDA_UL_RATE_192K;\n\tdefault:\n\t\tdev_warn(afe->dev, \"%s(), rate %d invalid, use 48kHz!!!\\n\",\n\t\t\t __func__, rate);\n\t\treturn MTK_AFE_ADDA_UL_RATE_48K;\n\t}\n}\n\n \nstatic const struct snd_kcontrol_new mtk_adda_dl_ch1_mix[] = {\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"DL1_CH1\", AFE_CONN3, I_DL1_CH1, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"DL12_CH1\", AFE_CONN3, I_DL12_CH1, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"DL2_CH1\", AFE_CONN3, I_DL2_CH1, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"DL3_CH1\", AFE_CONN3, I_DL3_CH1, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"DL4_CH1\", AFE_CONN3_1, I_DL4_CH1, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"DL5_CH1\", AFE_CONN3_1, I_DL5_CH1, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"DL6_CH1\", AFE_CONN3_1, I_DL6_CH1, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"DL8_CH1\", AFE_CONN3_1, I_DL8_CH1, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"ADDA_UL_CH3\", AFE_CONN3,\n\t\t\t\t    I_ADDA_UL_CH3, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"ADDA_UL_CH2\", AFE_CONN3,\n\t\t\t\t    I_ADDA_UL_CH2, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"ADDA_UL_CH1\", AFE_CONN3,\n\t\t\t\t    I_ADDA_UL_CH1, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"GAIN1_OUT_CH1\", AFE_CONN3,\n\t\t\t\t    I_GAIN1_OUT_CH1, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"PCM_1_CAP_CH1\", AFE_CONN3,\n\t\t\t\t    I_PCM_1_CAP_CH1, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"PCM_2_CAP_CH1\", AFE_CONN3,\n\t\t\t\t    I_PCM_2_CAP_CH1, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"SRC_1_OUT_CH1\", AFE_CONN3_1,\n\t\t\t\t    I_SRC_1_OUT_CH1, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"SRC_2_OUT_CH1\", AFE_CONN3_1,\n\t\t\t\t    I_SRC_2_OUT_CH1, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new mtk_adda_dl_ch2_mix[] = {\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"DL1_CH1\", AFE_CONN4, I_DL1_CH1, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"DL1_CH2\", AFE_CONN4, I_DL1_CH2, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"DL12_CH2\", AFE_CONN4, I_DL12_CH2, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"DL2_CH1\", AFE_CONN4, I_DL2_CH1, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"DL2_CH2\", AFE_CONN4, I_DL2_CH2, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"DL3_CH1\", AFE_CONN4, I_DL3_CH1, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"DL3_CH2\", AFE_CONN4, I_DL3_CH2, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"DL4_CH2\", AFE_CONN4_1, I_DL4_CH2, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"DL5_CH2\", AFE_CONN4_1, I_DL5_CH2, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"DL6_CH2\", AFE_CONN4_1, I_DL6_CH2, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"DL8_CH2\", AFE_CONN4_1, I_DL8_CH2, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"ADDA_UL_CH3\", AFE_CONN4,\n\t\t\t\t    I_ADDA_UL_CH3, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"ADDA_UL_CH2\", AFE_CONN4,\n\t\t\t\t    I_ADDA_UL_CH2, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"ADDA_UL_CH1\", AFE_CONN4,\n\t\t\t\t    I_ADDA_UL_CH1, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"GAIN1_OUT_CH2\", AFE_CONN4,\n\t\t\t\t    I_GAIN1_OUT_CH2, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"PCM_1_CAP_CH1\", AFE_CONN4,\n\t\t\t\t    I_PCM_1_CAP_CH1, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"PCM_2_CAP_CH1\", AFE_CONN4,\n\t\t\t\t    I_PCM_2_CAP_CH1, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"PCM_1_CAP_CH2\", AFE_CONN4,\n\t\t\t\t    I_PCM_1_CAP_CH2, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"PCM_2_CAP_CH2\", AFE_CONN4,\n\t\t\t\t    I_PCM_2_CAP_CH2, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"SRC_1_OUT_CH2\", AFE_CONN4_1,\n\t\t\t\t    I_SRC_1_OUT_CH2, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"SRC_2_OUT_CH2\", AFE_CONN4_1,\n\t\t\t\t    I_SRC_2_OUT_CH2, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new mtk_adda_dl_ch3_mix[] = {\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"DL1_CH1\", AFE_CONN52, I_DL1_CH1, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"DL12_CH1\", AFE_CONN52, I_DL12_CH1, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"DL2_CH1\", AFE_CONN52, I_DL2_CH1, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"DL3_CH1\", AFE_CONN52, I_DL3_CH1, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"DL4_CH1\", AFE_CONN52_1, I_DL4_CH1, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"DL5_CH1\", AFE_CONN52_1, I_DL5_CH1, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"DL6_CH1\", AFE_CONN52_1, I_DL6_CH1, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"ADDA_UL_CH3\", AFE_CONN52,\n\t\t\t\t    I_ADDA_UL_CH3, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"ADDA_UL_CH2\", AFE_CONN52,\n\t\t\t\t    I_ADDA_UL_CH2, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"ADDA_UL_CH1\", AFE_CONN52,\n\t\t\t\t    I_ADDA_UL_CH1, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"GAIN1_OUT_CH1\", AFE_CONN52,\n\t\t\t\t    I_GAIN1_OUT_CH1, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"PCM_1_CAP_CH1\", AFE_CONN52,\n\t\t\t\t    I_PCM_1_CAP_CH1, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"PCM_2_CAP_CH1\", AFE_CONN52,\n\t\t\t\t    I_PCM_2_CAP_CH1, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new mtk_adda_dl_ch4_mix[] = {\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"DL1_CH1\", AFE_CONN53, I_DL1_CH1, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"DL1_CH2\", AFE_CONN53, I_DL1_CH2, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"DL12_CH2\", AFE_CONN53, I_DL12_CH2, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"DL2_CH1\", AFE_CONN53, I_DL2_CH1, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"DL2_CH2\", AFE_CONN53, I_DL2_CH2, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"DL3_CH1\", AFE_CONN53, I_DL3_CH1, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"DL3_CH2\", AFE_CONN53, I_DL3_CH2, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"DL4_CH2\", AFE_CONN53_1, I_DL4_CH2, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"DL5_CH2\", AFE_CONN53_1, I_DL5_CH2, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"DL6_CH2\", AFE_CONN53_1, I_DL6_CH1, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"ADDA_UL_CH3\", AFE_CONN53,\n\t\t\t\t    I_ADDA_UL_CH3, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"ADDA_UL_CH2\", AFE_CONN53,\n\t\t\t\t    I_ADDA_UL_CH2, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"ADDA_UL_CH1\", AFE_CONN53,\n\t\t\t\t    I_ADDA_UL_CH1, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"GAIN1_OUT_CH2\", AFE_CONN53,\n\t\t\t\t    I_GAIN1_OUT_CH2, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"PCM_1_CAP_CH1\", AFE_CONN53,\n\t\t\t\t    I_PCM_1_CAP_CH1, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"PCM_2_CAP_CH1\", AFE_CONN53,\n\t\t\t\t    I_PCM_2_CAP_CH1, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"PCM_1_CAP_CH2\", AFE_CONN53,\n\t\t\t\t    I_PCM_1_CAP_CH2, 1, 0),\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"PCM_2_CAP_CH2\", AFE_CONN53,\n\t\t\t\t    I_PCM_2_CAP_CH2, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new mtk_stf_ch1_mix[] = {\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"ADDA_UL_CH1\", AFE_CONN19,\n\t\t\t\t    I_ADDA_UL_CH1, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new mtk_stf_ch2_mix[] = {\n\tSOC_DAPM_SINGLE_AUTODISABLE(\"ADDA_UL_CH2\", AFE_CONN20,\n\t\t\t\t    I_ADDA_UL_CH2, 1, 0),\n};\n\nenum {\n\tSUPPLY_SEQ_ADDA_AFE_ON,\n\tSUPPLY_SEQ_ADDA_DL_ON,\n\tSUPPLY_SEQ_ADDA_AUD_PAD_TOP,\n\tSUPPLY_SEQ_ADDA_MTKAIF_CFG,\n\tSUPPLY_SEQ_ADDA6_MTKAIF_CFG,\n\tSUPPLY_SEQ_ADDA_FIFO,\n\tSUPPLY_SEQ_ADDA_AP_DMIC,\n\tSUPPLY_SEQ_ADDA_UL_ON,\n};\n\nstatic int mtk_adda_ul_src_dmic(struct mtk_base_afe *afe, int id)\n{\n\tunsigned int reg;\n\n\tswitch (id) {\n\tcase MT8192_DAI_ADDA:\n\tcase MT8192_DAI_AP_DMIC:\n\t\treg = AFE_ADDA_UL_SRC_CON0;\n\t\tbreak;\n\tcase MT8192_DAI_ADDA_CH34:\n\tcase MT8192_DAI_AP_DMIC_CH34:\n\t\treg = AFE_ADDA6_UL_SRC_CON0;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\t \n\tregmap_update_bits(afe->regmap, reg,\n\t\t\t   DIGMIC_3P25M_1P625M_SEL_CTL_MASK_SFT,\n\t\t\t   0x0);\n\tregmap_update_bits(afe->regmap, reg,\n\t\t\t   DMIC_LOW_POWER_MODE_CTL_MASK_SFT,\n\t\t\t   0x0);\n\n\t \n\tregmap_update_bits(afe->regmap, reg,\n\t\t\t   UL_SDM_3_LEVEL_CTL_MASK_SFT,\n\t\t\t   0x1 << UL_SDM_3_LEVEL_CTL_SFT);\n\tregmap_update_bits(afe->regmap, reg,\n\t\t\t   UL_MODE_3P25M_CH1_CTL_MASK_SFT,\n\t\t\t   0x1 << UL_MODE_3P25M_CH1_CTL_SFT);\n\tregmap_update_bits(afe->regmap, reg,\n\t\t\t   UL_MODE_3P25M_CH2_CTL_MASK_SFT,\n\t\t\t   0x1 << UL_MODE_3P25M_CH2_CTL_SFT);\n\treturn 0;\n}\n\nstatic int mtk_adda_ul_event(struct snd_soc_dapm_widget *w,\n\t\t\t     struct snd_kcontrol *kcontrol,\n\t\t\t     int event)\n{\n\tstruct snd_soc_component *cmpnt = snd_soc_dapm_to_component(w->dapm);\n\tstruct mtk_base_afe *afe = snd_soc_component_get_drvdata(cmpnt);\n\tstruct mt8192_afe_private *afe_priv = afe->platform_priv;\n\tint mtkaif_dmic = afe_priv->mtkaif_dmic;\n\n\tswitch (event) {\n\tcase SND_SOC_DAPM_PRE_PMU:\n\t\tmt8192_afe_gpio_request(afe->dev, true, MT8192_DAI_ADDA, 1);\n\n\t\t \n\t\tif (mtkaif_dmic) {\n\t\t\t \n\t\t\tregmap_update_bits(afe->regmap, AFE_ADDA_MTKAIF_RX_CFG0,\n\t\t\t\t\t   0x1, 0x1);\n\n\t\t\t \n\t\t\tregmap_update_bits(afe->regmap, AFE_ADDA_MTKAIF_RX_CFG0,\n\t\t\t\t\t   MTKAIF_RXIF_VOICE_MODE_MASK_SFT,\n\t\t\t\t\t   0x0);\n\t\t\tmtk_adda_ul_src_dmic(afe, MT8192_DAI_ADDA);\n\t\t}\n\t\tbreak;\n\tcase SND_SOC_DAPM_POST_PMD:\n\t\t \n\t\tusleep_range(125, 135);\n\t\tmt8192_afe_gpio_request(afe->dev, false, MT8192_DAI_ADDA, 1);\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n\n\treturn 0;\n}\n\nstatic int mtk_adda_ch34_ul_event(struct snd_soc_dapm_widget *w,\n\t\t\t\t  struct snd_kcontrol *kcontrol,\n\t\t\t\t  int event)\n{\n\tstruct snd_soc_component *cmpnt = snd_soc_dapm_to_component(w->dapm);\n\tstruct mtk_base_afe *afe = snd_soc_component_get_drvdata(cmpnt);\n\tstruct mt8192_afe_private *afe_priv = afe->platform_priv;\n\tint mtkaif_dmic = afe_priv->mtkaif_dmic_ch34;\n\tint mtkaif_adda6_only = afe_priv->mtkaif_adda6_only;\n\n\tswitch (event) {\n\tcase SND_SOC_DAPM_PRE_PMU:\n\t\tmt8192_afe_gpio_request(afe->dev, true, MT8192_DAI_ADDA_CH34,\n\t\t\t\t\t1);\n\n\t\t \n\t\tif (mtkaif_dmic) {\n\t\t\t \n\t\t\tregmap_update_bits(afe->regmap,\n\t\t\t\t\t   AFE_ADDA6_MTKAIF_RX_CFG0,\n\t\t\t\t\t   0x1, 0x1);\n\n\t\t\t \n\t\t\tregmap_update_bits(afe->regmap,\n\t\t\t\t\t   AFE_ADDA6_MTKAIF_RX_CFG0,\n\t\t\t\t\t   MTKAIF_RXIF_VOICE_MODE_MASK_SFT,\n\t\t\t\t\t   0x0);\n\t\t\tmtk_adda_ul_src_dmic(afe, MT8192_DAI_ADDA_CH34);\n\t\t}\n\n\t\t \n\t\tif (mtkaif_adda6_only) {\n\t\t\tregmap_update_bits(afe->regmap,\n\t\t\t\t\t   AFE_ADDA_MTKAIF_SYNCWORD_CFG,\n\t\t\t\t\t   0x1 << 23, 0x1 << 23);\n\t\t}\n\t\tbreak;\n\tcase SND_SOC_DAPM_POST_PMD:\n\t\t \n\t\tusleep_range(125, 135);\n\t\tmt8192_afe_gpio_request(afe->dev, false, MT8192_DAI_ADDA_CH34,\n\t\t\t\t\t1);\n\n\t\t \n\t\tafe_priv->mtkaif_dmic_ch34 = 0;\n\n\t\tif (mtkaif_adda6_only) {\n\t\t\tregmap_update_bits(afe->regmap,\n\t\t\t\t\t   AFE_ADDA_MTKAIF_SYNCWORD_CFG,\n\t\t\t\t\t   0x1 << 23, 0x0 << 23);\n\t\t}\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n\n\treturn 0;\n}\n\nstatic int mtk_adda_pad_top_event(struct snd_soc_dapm_widget *w,\n\t\t\t\t  struct snd_kcontrol *kcontrol,\n\t\t\t\t  int event)\n{\n\tstruct snd_soc_component *cmpnt = snd_soc_dapm_to_component(w->dapm);\n\tstruct mtk_base_afe *afe = snd_soc_component_get_drvdata(cmpnt);\n\tstruct mt8192_afe_private *afe_priv = afe->platform_priv;\n\n\tswitch (event) {\n\tcase SND_SOC_DAPM_PRE_PMU:\n\t\tif (afe_priv->mtkaif_protocol == MTKAIF_PROTOCOL_2_CLK_P2)\n\t\t\tregmap_write(afe->regmap, AFE_AUD_PAD_TOP, 0x38);\n\t\telse\n\t\t\tregmap_write(afe->regmap, AFE_AUD_PAD_TOP, 0x30);\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n\n\treturn 0;\n}\n\nstatic int mtk_adda_mtkaif_cfg_event(struct snd_soc_dapm_widget *w,\n\t\t\t\t     struct snd_kcontrol *kcontrol,\n\t\t\t\t     int event)\n{\n\tstruct snd_soc_component *cmpnt = snd_soc_dapm_to_component(w->dapm);\n\tstruct mtk_base_afe *afe = snd_soc_component_get_drvdata(cmpnt);\n\tstruct mt8192_afe_private *afe_priv = afe->platform_priv;\n\tint delay_data;\n\tint delay_cycle;\n\n\tswitch (event) {\n\tcase SND_SOC_DAPM_PRE_PMU:\n\t\tif (afe_priv->mtkaif_protocol == MTKAIF_PROTOCOL_2_CLK_P2) {\n\t\t\t \n\t\t\tregmap_write(afe->regmap, AFE_ADDA_MTKAIF_CFG0,\n\t\t\t\t     0x00010000);\n\t\t\tregmap_write(afe->regmap, AFE_ADDA6_MTKAIF_CFG0,\n\t\t\t\t     0x00010000);\n\n\t\t\tif (strcmp(w->name, \"ADDA_MTKAIF_CFG\") == 0 &&\n\t\t\t    (afe_priv->mtkaif_chosen_phase[0] < 0 ||\n\t\t\t     afe_priv->mtkaif_chosen_phase[1] < 0)) {\n\t\t\t\tdev_warn(afe->dev,\n\t\t\t\t\t \"%s(), mtkaif_chosen_phase[0/1]:%d/%d\\n\",\n\t\t\t\t\t __func__,\n\t\t\t\t\t afe_priv->mtkaif_chosen_phase[0],\n\t\t\t\t\t afe_priv->mtkaif_chosen_phase[1]);\n\t\t\t\tbreak;\n\t\t\t} else if (strcmp(w->name, \"ADDA6_MTKAIF_CFG\") == 0 &&\n\t\t\t\t   afe_priv->mtkaif_chosen_phase[2] < 0) {\n\t\t\t\tdev_warn(afe->dev,\n\t\t\t\t\t \"%s(), mtkaif_chosen_phase[2]:%d\\n\",\n\t\t\t\t\t __func__,\n\t\t\t\t\t afe_priv->mtkaif_chosen_phase[2]);\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\t \n\t\t\tregmap_update_bits(afe->regmap, AFE_ADDA_MTKAIF_CFG0,\n\t\t\t\t\t   MTKAIF_RXIF_CLKINV_ADC_MASK_SFT,\n\t\t\t\t\t   0x1 << MTKAIF_RXIF_CLKINV_ADC_SFT);\n\t\t\tregmap_update_bits(afe->regmap, AFE_ADDA6_MTKAIF_CFG0,\n\t\t\t\t\t   MTKAIF_RXIF_CLKINV_ADC_MASK_SFT,\n\t\t\t\t\t   0x1 << MTKAIF_RXIF_CLKINV_ADC_SFT);\n\n\t\t\t \n\t\t\tif (afe_priv->mtkaif_phase_cycle[0] >=\n\t\t\t    afe_priv->mtkaif_phase_cycle[1]) {\n\t\t\t\tdelay_data = DELAY_DATA_MISO1;\n\t\t\t\tdelay_cycle = afe_priv->mtkaif_phase_cycle[0] -\n\t\t\t\t\t      afe_priv->mtkaif_phase_cycle[1];\n\t\t\t} else {\n\t\t\t\tdelay_data = DELAY_DATA_MISO2;\n\t\t\t\tdelay_cycle = afe_priv->mtkaif_phase_cycle[1] -\n\t\t\t\t\t      afe_priv->mtkaif_phase_cycle[0];\n\t\t\t}\n\n\t\t\tregmap_update_bits(afe->regmap,\n\t\t\t\t\t   AFE_ADDA_MTKAIF_RX_CFG2,\n\t\t\t\t\t   MTKAIF_RXIF_DELAY_DATA_MASK_SFT,\n\t\t\t\t\t   delay_data <<\n\t\t\t\t\t   MTKAIF_RXIF_DELAY_DATA_SFT);\n\n\t\t\tregmap_update_bits(afe->regmap,\n\t\t\t\t\t   AFE_ADDA_MTKAIF_RX_CFG2,\n\t\t\t\t\t   MTKAIF_RXIF_DELAY_CYCLE_MASK_SFT,\n\t\t\t\t\t   delay_cycle <<\n\t\t\t\t\t   MTKAIF_RXIF_DELAY_CYCLE_SFT);\n\n\t\t\t \n\t\t\tif (afe_priv->mtkaif_phase_cycle[2] >=\n\t\t\t    afe_priv->mtkaif_phase_cycle[1]) {\n\t\t\t\tdelay_data = DELAY_DATA_MISO1;\t \n\t\t\t\tdelay_cycle = afe_priv->mtkaif_phase_cycle[2] -\n\t\t\t\t\t      afe_priv->mtkaif_phase_cycle[1];\n\t\t\t} else {\n\t\t\t\tdelay_data = DELAY_DATA_MISO2;\t \n\t\t\t\tdelay_cycle = afe_priv->mtkaif_phase_cycle[1] -\n\t\t\t\t\t      afe_priv->mtkaif_phase_cycle[2];\n\t\t\t}\n\n\t\t\tregmap_update_bits(afe->regmap,\n\t\t\t\t\t   AFE_ADDA6_MTKAIF_RX_CFG2,\n\t\t\t\t\t   MTKAIF_RXIF_DELAY_DATA_MASK_SFT,\n\t\t\t\t\t   delay_data <<\n\t\t\t\t\t   MTKAIF_RXIF_DELAY_DATA_SFT);\n\t\t\tregmap_update_bits(afe->regmap,\n\t\t\t\t\t   AFE_ADDA6_MTKAIF_RX_CFG2,\n\t\t\t\t\t   MTKAIF_RXIF_DELAY_CYCLE_MASK_SFT,\n\t\t\t\t\t   delay_cycle <<\n\t\t\t\t\t   MTKAIF_RXIF_DELAY_CYCLE_SFT);\n\t\t} else if (afe_priv->mtkaif_protocol == MTKAIF_PROTOCOL_2) {\n\t\t\tregmap_write(afe->regmap, AFE_ADDA_MTKAIF_CFG0,\n\t\t\t\t     0x00010000);\n\t\t\tregmap_write(afe->regmap, AFE_ADDA6_MTKAIF_CFG0,\n\t\t\t\t     0x00010000);\n\t\t} else {\n\t\t\tregmap_write(afe->regmap, AFE_ADDA_MTKAIF_CFG0, 0x0);\n\t\t\tregmap_write(afe->regmap, AFE_ADDA6_MTKAIF_CFG0, 0x0);\n\t\t}\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n\n\treturn 0;\n}\n\nstatic int mtk_adda_dl_event(struct snd_soc_dapm_widget *w,\n\t\t\t     struct snd_kcontrol *kcontrol,\n\t\t\t     int event)\n{\n\tstruct snd_soc_component *cmpnt = snd_soc_dapm_to_component(w->dapm);\n\tstruct mtk_base_afe *afe = snd_soc_component_get_drvdata(cmpnt);\n\n\tswitch (event) {\n\tcase SND_SOC_DAPM_PRE_PMU:\n\t\tmt8192_afe_gpio_request(afe->dev, true, MT8192_DAI_ADDA, 0);\n\t\tbreak;\n\tcase SND_SOC_DAPM_POST_PMD:\n\t\t \n\t\tusleep_range(125, 135);\n\t\tmt8192_afe_gpio_request(afe->dev, false, MT8192_DAI_ADDA, 0);\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n\n\treturn 0;\n}\n\nstatic int mtk_adda_ch34_dl_event(struct snd_soc_dapm_widget *w,\n\t\t\t\t  struct snd_kcontrol *kcontrol,\n\t\t\t\t  int event)\n{\n\tstruct snd_soc_component *cmpnt = snd_soc_dapm_to_component(w->dapm);\n\tstruct mtk_base_afe *afe = snd_soc_component_get_drvdata(cmpnt);\n\n\tswitch (event) {\n\tcase SND_SOC_DAPM_PRE_PMU:\n\t\tmt8192_afe_gpio_request(afe->dev, true, MT8192_DAI_ADDA_CH34,\n\t\t\t\t\t0);\n\t\tbreak;\n\tcase SND_SOC_DAPM_POST_PMD:\n\t\t \n\t\tusleep_range(125, 135);\n\t\tmt8192_afe_gpio_request(afe->dev, false, MT8192_DAI_ADDA_CH34,\n\t\t\t\t\t0);\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n\n\treturn 0;\n}\n\n \nstatic int stf_positive_gain_get(struct snd_kcontrol *kcontrol,\n\t\t\t\t struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_soc_component *cmpnt = snd_soc_kcontrol_component(kcontrol);\n\tstruct mtk_base_afe *afe = snd_soc_component_get_drvdata(cmpnt);\n\tstruct mt8192_afe_private *afe_priv = afe->platform_priv;\n\n\tucontrol->value.integer.value[0] = afe_priv->stf_positive_gain_db;\n\treturn 0;\n}\n\nstatic int stf_positive_gain_set(struct snd_kcontrol *kcontrol,\n\t\t\t\t struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_soc_component *cmpnt = snd_soc_kcontrol_component(kcontrol);\n\tstruct mtk_base_afe *afe = snd_soc_component_get_drvdata(cmpnt);\n\tstruct mt8192_afe_private *afe_priv = afe->platform_priv;\n\tint gain_db = ucontrol->value.integer.value[0];\n\tbool change = false;\n\n\tafe_priv->stf_positive_gain_db = gain_db;\n\n\tif (gain_db >= 0 && gain_db <= 24) {\n\t\tregmap_update_bits_check(afe->regmap,\n\t\t\t\t\t AFE_SIDETONE_GAIN,\n\t\t\t\t\t POSITIVE_GAIN_MASK_SFT,\n\t\t\t\t\t (gain_db / 6) << POSITIVE_GAIN_SFT,\n\t\t\t\t\t &change);\n\t} else {\n\t\treturn -EINVAL;\n\t}\n\n\treturn change;\n}\n\nstatic int mt8192_adda_dmic_get(struct snd_kcontrol *kcontrol,\n\t\t\t\tstruct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_soc_component *cmpnt = snd_soc_kcontrol_component(kcontrol);\n\tstruct mtk_base_afe *afe = snd_soc_component_get_drvdata(cmpnt);\n\tstruct mt8192_afe_private *afe_priv = afe->platform_priv;\n\n\tucontrol->value.integer.value[0] = afe_priv->mtkaif_dmic;\n\treturn 0;\n}\n\nstatic int mt8192_adda_dmic_set(struct snd_kcontrol *kcontrol,\n\t\t\t\tstruct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_soc_component *cmpnt = snd_soc_kcontrol_component(kcontrol);\n\tstruct mtk_base_afe *afe = snd_soc_component_get_drvdata(cmpnt);\n\tstruct mt8192_afe_private *afe_priv = afe->platform_priv;\n\tint dmic_on;\n\tbool change;\n\n\tdmic_on = ucontrol->value.integer.value[0];\n\n\tchange = (afe_priv->mtkaif_dmic != dmic_on) ||\n\t\t(afe_priv->mtkaif_dmic_ch34 != dmic_on);\n\n\tafe_priv->mtkaif_dmic = dmic_on;\n\tafe_priv->mtkaif_dmic_ch34 = dmic_on;\n\n\treturn change;\n}\n\nstatic int mt8192_adda6_only_get(struct snd_kcontrol *kcontrol,\n\t\t\t\t struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_soc_component *cmpnt = snd_soc_kcontrol_component(kcontrol);\n\tstruct mtk_base_afe *afe = snd_soc_component_get_drvdata(cmpnt);\n\tstruct mt8192_afe_private *afe_priv = afe->platform_priv;\n\n\tucontrol->value.integer.value[0] = afe_priv->mtkaif_adda6_only;\n\treturn 0;\n}\n\nstatic int mt8192_adda6_only_set(struct snd_kcontrol *kcontrol,\n\t\t\t\t struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_soc_component *cmpnt = snd_soc_kcontrol_component(kcontrol);\n\tstruct mtk_base_afe *afe = snd_soc_component_get_drvdata(cmpnt);\n\tstruct mt8192_afe_private *afe_priv = afe->platform_priv;\n\tint mtkaif_adda6_only;\n\tbool change;\n\n\tmtkaif_adda6_only = ucontrol->value.integer.value[0];\n\n\tchange = afe_priv->mtkaif_adda6_only != mtkaif_adda6_only;\n\tafe_priv->mtkaif_adda6_only = mtkaif_adda6_only;\n\n\treturn change;\n}\n\nstatic const struct snd_kcontrol_new mtk_adda_controls[] = {\n\tSOC_SINGLE(\"Sidetone_Gain\", AFE_SIDETONE_GAIN,\n\t\t   SIDE_TONE_GAIN_SFT, SIDE_TONE_GAIN_MASK, 0),\n\tSOC_SINGLE_EXT(\"Sidetone_Positive_Gain_dB\", SND_SOC_NOPM, 0, 24, 0,\n\t\t       stf_positive_gain_get, stf_positive_gain_set),\n\tSOC_SINGLE(\"ADDA_DL_GAIN\", AFE_ADDA_DL_SRC2_CON1,\n\t\t   DL_2_GAIN_CTL_PRE_SFT, DL_2_GAIN_CTL_PRE_MASK, 0),\n\tSOC_SINGLE_BOOL_EXT(\"MTKAIF_DMIC Switch\", 0,\n\t\t\t    mt8192_adda_dmic_get, mt8192_adda_dmic_set),\n\tSOC_SINGLE_BOOL_EXT(\"MTKAIF_ADDA6_ONLY Switch\", 0,\n\t\t\t    mt8192_adda6_only_get, mt8192_adda6_only_set),\n};\n\nstatic const struct snd_kcontrol_new stf_ctl =\n\tSOC_DAPM_SINGLE(\"Switch\", SND_SOC_NOPM, 0, 1, 0);\n\nstatic const u16 stf_coeff_table_16k[] = {\n\t0x049C, 0x09E8, 0x09E0, 0x089C,\n\t0xFF54, 0xF488, 0xEAFC, 0xEBAC,\n\t0xfA40, 0x17AC, 0x3D1C, 0x6028,\n\t0x7538\n};\n\nstatic const u16 stf_coeff_table_32k[] = {\n\t0xFE52, 0x0042, 0x00C5, 0x0194,\n\t0x029A, 0x03B7, 0x04BF, 0x057D,\n\t0x05BE, 0x0555, 0x0426, 0x0230,\n\t0xFF92, 0xFC89, 0xF973, 0xF6C6,\n\t0xF500, 0xF49D, 0xF603, 0xF970,\n\t0xFEF3, 0x065F, 0x0F4F, 0x1928,\n\t0x2329, 0x2C80, 0x345E, 0x3A0D,\n\t0x3D08\n};\n\nstatic const u16 stf_coeff_table_48k[] = {\n\t0x0401, 0xFFB0, 0xFF5A, 0xFECE,\n\t0xFE10, 0xFD28, 0xFC21, 0xFB08,\n\t0xF9EF, 0xF8E8, 0xF80A, 0xF76C,\n\t0xF724, 0xF746, 0xF7E6, 0xF90F,\n\t0xFACC, 0xFD1E, 0xFFFF, 0x0364,\n\t0x0737, 0x0B62, 0x0FC1, 0x1431,\n\t0x188A, 0x1CA4, 0x2056, 0x237D,\n\t0x25F9, 0x27B0, 0x2890\n};\n\nstatic int mtk_stf_event(struct snd_soc_dapm_widget *w,\n\t\t\t struct snd_kcontrol *kcontrol,\n\t\t\t int event)\n{\n\tstruct snd_soc_component *cmpnt = snd_soc_dapm_to_component(w->dapm);\n\tstruct mtk_base_afe *afe = snd_soc_component_get_drvdata(cmpnt);\n\n\tsize_t half_tap_num;\n\tconst u16 *stf_coeff_table;\n\tunsigned int ul_rate, reg_value;\n\tsize_t coef_addr;\n\n\tregmap_read(afe->regmap, AFE_ADDA_UL_SRC_CON0, &ul_rate);\n\tul_rate = ul_rate >> UL_VOICE_MODE_CH1_CH2_CTL_SFT;\n\tul_rate = ul_rate & UL_VOICE_MODE_CH1_CH2_CTL_MASK;\n\n\tif (ul_rate == MTK_AFE_ADDA_UL_RATE_48K) {\n\t\thalf_tap_num = ARRAY_SIZE(stf_coeff_table_48k);\n\t\tstf_coeff_table = stf_coeff_table_48k;\n\t} else if (ul_rate == MTK_AFE_ADDA_UL_RATE_32K) {\n\t\thalf_tap_num = ARRAY_SIZE(stf_coeff_table_32k);\n\t\tstf_coeff_table = stf_coeff_table_32k;\n\t} else {\n\t\thalf_tap_num = ARRAY_SIZE(stf_coeff_table_16k);\n\t\tstf_coeff_table = stf_coeff_table_16k;\n\t}\n\n\tregmap_read(afe->regmap, AFE_SIDETONE_CON1, &reg_value);\n\n\tswitch (event) {\n\tcase SND_SOC_DAPM_PRE_PMU:\n\t\t \n\t\tregmap_update_bits(afe->regmap,\n\t\t\t\t   AFE_SIDETONE_GAIN,\n\t\t\t\t   SIDE_TONE_GAIN_MASK_SFT,\n\t\t\t\t   0);\n\t\tregmap_update_bits(afe->regmap,\n\t\t\t\t   AFE_SIDETONE_GAIN,\n\t\t\t\t   POSITIVE_GAIN_MASK_SFT,\n\t\t\t\t   0);\n\t\t \n\t\tregmap_update_bits(afe->regmap,\n\t\t\t\t   AFE_SIDETONE_CON1,\n\t\t\t\t   0x1f << 27,\n\t\t\t\t   0x0);\n\t\t \n\t\tregmap_update_bits(afe->regmap,\n\t\t\t\t   AFE_SIDETONE_CON1,\n\t\t\t\t   SIDE_TONE_HALF_TAP_NUM_MASK_SFT,\n\t\t\t\t   half_tap_num << SIDE_TONE_HALF_TAP_NUM_SFT);\n\n\t\t \n\t\tregmap_read(afe->regmap, AFE_SIDETONE_CON0, &reg_value);\n\t\tfor (coef_addr = 0; coef_addr < half_tap_num; coef_addr++) {\n\t\t\tbool old_w_ready = (reg_value >> W_RDY_SFT) & 0x1;\n\t\t\tbool new_w_ready = 0;\n\t\t\tint try_cnt = 0;\n\n\t\t\tregmap_update_bits(afe->regmap,\n\t\t\t\t\t   AFE_SIDETONE_CON0,\n\t\t\t\t\t   0x39FFFFF,\n\t\t\t\t\t   (1 << R_W_EN_SFT) |\n\t\t\t\t\t   (1 << R_W_SEL_SFT) |\n\t\t\t\t\t   (0 << SEL_CH2_SFT) |\n\t\t\t\t\t   (coef_addr <<\n\t\t\t\t\t   SIDE_TONE_COEFFICIENT_ADDR_SFT) |\n\t\t\t\t\t   stf_coeff_table[coef_addr]);\n\n\t\t\t \n\t\t\tfor (try_cnt = 0; try_cnt < 10; try_cnt++) {\n\t\t\t\tregmap_read(afe->regmap,\n\t\t\t\t\t    AFE_SIDETONE_CON0, &reg_value);\n\t\t\t\tnew_w_ready = (reg_value >> W_RDY_SFT) & 0x1;\n\n\t\t\t\t \n\t\t\t\tif (new_w_ready == old_w_ready) {\n\t\t\t\t\tudelay(3);\n\t\t\t\t\tif (try_cnt == 9) {\n\t\t\t\t\t\tdev_warn(afe->dev,\n\t\t\t\t\t\t\t \"%s(), write coeff not ready\",\n\t\t\t\t\t\t\t __func__);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\t \n\t\t\tregmap_update_bits(afe->regmap,\n\t\t\t\t\t   AFE_SIDETONE_CON0,\n\t\t\t\t\t   R_W_SEL_MASK_SFT,\n\t\t\t\t\t   0x0);\n\t\t}\n\t\tbreak;\n\tcase SND_SOC_DAPM_POST_PMD:\n\t\t \n\t\tregmap_update_bits(afe->regmap,\n\t\t\t\t   AFE_SIDETONE_CON1,\n\t\t\t\t   0x1f << 27,\n\t\t\t\t   0x1f << 27);\n\n\t\t \n\t\tregmap_update_bits(afe->regmap,\n\t\t\t\t   AFE_SIDETONE_GAIN,\n\t\t\t\t   SIDE_TONE_GAIN_MASK_SFT,\n\t\t\t\t   0);\n\t\tregmap_update_bits(afe->regmap,\n\t\t\t\t   AFE_SIDETONE_GAIN,\n\t\t\t\t   POSITIVE_GAIN_MASK_SFT,\n\t\t\t\t   0);\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n\n\treturn 0;\n}\n\n \nenum {\n\tSTF_SRC_ADDA_ADDA6 = 0,\n\tSTF_SRC_O19O20,\n};\n\nstatic const char *const stf_o19o20_mux_map[] = {\n\t\"ADDA_ADDA6\",\n\t\"O19O20\",\n};\n\nstatic int stf_o19o20_mux_map_value[] = {\n\tSTF_SRC_ADDA_ADDA6,\n\tSTF_SRC_O19O20,\n};\n\nstatic SOC_VALUE_ENUM_SINGLE_DECL(stf_o19o20_mux_map_enum,\n\t\t\t\t  AFE_SIDETONE_CON1,\n\t\t\t\t  STF_SOURCE_FROM_O19O20_SFT,\n\t\t\t\t  STF_SOURCE_FROM_O19O20_MASK,\n\t\t\t\t  stf_o19o20_mux_map,\n\t\t\t\t  stf_o19o20_mux_map_value);\n\nstatic const struct snd_kcontrol_new stf_o19O20_mux_control =\n\tSOC_DAPM_ENUM(\"STF_O19O20_MUX\", stf_o19o20_mux_map_enum);\n\nenum {\n\tSTF_SRC_ADDA = 0,\n\tSTF_SRC_ADDA6,\n};\n\nstatic const char *const stf_adda_mux_map[] = {\n\t\"ADDA\",\n\t\"ADDA6\",\n};\n\nstatic int stf_adda_mux_map_value[] = {\n\tSTF_SRC_ADDA,\n\tSTF_SRC_ADDA6,\n};\n\nstatic SOC_VALUE_ENUM_SINGLE_DECL(stf_adda_mux_map_enum,\n\t\t\t\t  AFE_SIDETONE_CON1,\n\t\t\t\t  STF_O19O20_OUT_EN_SEL_SFT,\n\t\t\t\t  STF_O19O20_OUT_EN_SEL_MASK,\n\t\t\t\t  stf_adda_mux_map,\n\t\t\t\t  stf_adda_mux_map_value);\n\nstatic const struct snd_kcontrol_new stf_adda_mux_control =\n\tSOC_DAPM_ENUM(\"STF_ADDA_MUX\", stf_adda_mux_map_enum);\n\n \nenum {\n\tADDA_UL_MUX_MTKAIF = 0,\n\tADDA_UL_MUX_AP_DMIC,\n\tADDA_UL_MUX_MASK = 0x1,\n};\n\nstatic const char * const adda_ul_mux_map[] = {\n\t\"MTKAIF\", \"AP_DMIC\"\n};\n\nstatic int adda_ul_map_value[] = {\n\tADDA_UL_MUX_MTKAIF,\n\tADDA_UL_MUX_AP_DMIC,\n};\n\nstatic SOC_VALUE_ENUM_SINGLE_DECL(adda_ul_mux_map_enum,\n\t\t\t\t  SND_SOC_NOPM,\n\t\t\t\t  0,\n\t\t\t\t  ADDA_UL_MUX_MASK,\n\t\t\t\t  adda_ul_mux_map,\n\t\t\t\t  adda_ul_map_value);\n\nstatic const struct snd_kcontrol_new adda_ul_mux_control =\n\tSOC_DAPM_ENUM(\"ADDA_UL_MUX Select\", adda_ul_mux_map_enum);\n\nstatic const struct snd_kcontrol_new adda_ch34_ul_mux_control =\n\tSOC_DAPM_ENUM(\"ADDA_CH34_UL_MUX Select\", adda_ul_mux_map_enum);\n\nstatic const struct snd_soc_dapm_widget mtk_dai_adda_widgets[] = {\n\t \n\tSND_SOC_DAPM_MIXER(\"ADDA_DL_CH1\", SND_SOC_NOPM, 0, 0,\n\t\t\t   mtk_adda_dl_ch1_mix,\n\t\t\t   ARRAY_SIZE(mtk_adda_dl_ch1_mix)),\n\tSND_SOC_DAPM_MIXER(\"ADDA_DL_CH2\", SND_SOC_NOPM, 0, 0,\n\t\t\t   mtk_adda_dl_ch2_mix,\n\t\t\t   ARRAY_SIZE(mtk_adda_dl_ch2_mix)),\n\n\tSND_SOC_DAPM_MIXER(\"ADDA_DL_CH3\", SND_SOC_NOPM, 0, 0,\n\t\t\t   mtk_adda_dl_ch3_mix,\n\t\t\t   ARRAY_SIZE(mtk_adda_dl_ch3_mix)),\n\tSND_SOC_DAPM_MIXER(\"ADDA_DL_CH4\", SND_SOC_NOPM, 0, 0,\n\t\t\t   mtk_adda_dl_ch4_mix,\n\t\t\t   ARRAY_SIZE(mtk_adda_dl_ch4_mix)),\n\n\tSND_SOC_DAPM_SUPPLY_S(\"ADDA Enable\", SUPPLY_SEQ_ADDA_AFE_ON,\n\t\t\t      AFE_ADDA_UL_DL_CON0, ADDA_AFE_ON_SFT, 0,\n\t\t\t      NULL, 0),\n\n\tSND_SOC_DAPM_SUPPLY_S(\"ADDA Playback Enable\", SUPPLY_SEQ_ADDA_DL_ON,\n\t\t\t      AFE_ADDA_DL_SRC2_CON0,\n\t\t\t      DL_2_SRC_ON_TMP_CTL_PRE_SFT, 0,\n\t\t\t      mtk_adda_dl_event,\n\t\t\t      SND_SOC_DAPM_PRE_PMU | SND_SOC_DAPM_POST_PMD),\n\tSND_SOC_DAPM_SUPPLY_S(\"ADDA CH34 Playback Enable\",\n\t\t\t      SUPPLY_SEQ_ADDA_DL_ON,\n\t\t\t      AFE_ADDA_3RD_DAC_DL_SRC2_CON0,\n\t\t\t      DL_2_SRC_ON_TMP_CTL_PRE_SFT, 0,\n\t\t\t      mtk_adda_ch34_dl_event,\n\t\t\t      SND_SOC_DAPM_PRE_PMU | SND_SOC_DAPM_POST_PMD),\n\n\tSND_SOC_DAPM_SUPPLY_S(\"ADDA Capture Enable\", SUPPLY_SEQ_ADDA_UL_ON,\n\t\t\t      AFE_ADDA_UL_SRC_CON0,\n\t\t\t      UL_SRC_ON_TMP_CTL_SFT, 0,\n\t\t\t      mtk_adda_ul_event,\n\t\t\t      SND_SOC_DAPM_PRE_PMU | SND_SOC_DAPM_POST_PMD),\n\tSND_SOC_DAPM_SUPPLY_S(\"ADDA CH34 Capture Enable\", SUPPLY_SEQ_ADDA_UL_ON,\n\t\t\t      AFE_ADDA6_UL_SRC_CON0,\n\t\t\t      UL_SRC_ON_TMP_CTL_SFT, 0,\n\t\t\t      mtk_adda_ch34_ul_event,\n\t\t\t      SND_SOC_DAPM_PRE_PMU | SND_SOC_DAPM_POST_PMD),\n\n\tSND_SOC_DAPM_SUPPLY_S(\"AUD_PAD_TOP\", SUPPLY_SEQ_ADDA_AUD_PAD_TOP,\n\t\t\t      AFE_AUD_PAD_TOP,\n\t\t\t      RG_RX_FIFO_ON_SFT, 0,\n\t\t\t      mtk_adda_pad_top_event,\n\t\t\t      SND_SOC_DAPM_PRE_PMU),\n\tSND_SOC_DAPM_SUPPLY_S(\"ADDA_MTKAIF_CFG\", SUPPLY_SEQ_ADDA_MTKAIF_CFG,\n\t\t\t      SND_SOC_NOPM, 0, 0,\n\t\t\t      mtk_adda_mtkaif_cfg_event,\n\t\t\t      SND_SOC_DAPM_PRE_PMU),\n\tSND_SOC_DAPM_SUPPLY_S(\"ADDA6_MTKAIF_CFG\", SUPPLY_SEQ_ADDA6_MTKAIF_CFG,\n\t\t\t      SND_SOC_NOPM, 0, 0,\n\t\t\t      mtk_adda_mtkaif_cfg_event,\n\t\t\t      SND_SOC_DAPM_PRE_PMU),\n\n\tSND_SOC_DAPM_SUPPLY_S(\"AP_DMIC_EN\", SUPPLY_SEQ_ADDA_AP_DMIC,\n\t\t\t      AFE_ADDA_UL_SRC_CON0,\n\t\t\t      UL_AP_DMIC_ON_SFT, 0,\n\t\t\t      NULL, 0),\n\tSND_SOC_DAPM_SUPPLY_S(\"AP_DMIC_CH34_EN\", SUPPLY_SEQ_ADDA_AP_DMIC,\n\t\t\t      AFE_ADDA6_UL_SRC_CON0,\n\t\t\t      UL_AP_DMIC_ON_SFT, 0,\n\t\t\t      NULL, 0),\n\n\tSND_SOC_DAPM_SUPPLY_S(\"ADDA_FIFO\", SUPPLY_SEQ_ADDA_FIFO,\n\t\t\t      AFE_ADDA_UL_DL_CON0,\n\t\t\t      AFE_ADDA_FIFO_AUTO_RST_SFT, 1,\n\t\t\t      NULL, 0),\n\tSND_SOC_DAPM_SUPPLY_S(\"ADDA_CH34_FIFO\", SUPPLY_SEQ_ADDA_FIFO,\n\t\t\t      AFE_ADDA_UL_DL_CON0,\n\t\t\t      AFE_ADDA6_FIFO_AUTO_RST_SFT, 1,\n\t\t\t      NULL, 0),\n\n\tSND_SOC_DAPM_MUX(\"ADDA_UL_Mux\", SND_SOC_NOPM, 0, 0,\n\t\t\t &adda_ul_mux_control),\n\tSND_SOC_DAPM_MUX(\"ADDA_CH34_UL_Mux\", SND_SOC_NOPM, 0, 0,\n\t\t\t &adda_ch34_ul_mux_control),\n\n\tSND_SOC_DAPM_INPUT(\"AP_DMIC_INPUT\"),\n\tSND_SOC_DAPM_INPUT(\"AP_DMIC_CH34_INPUT\"),\n\n\t \n\tSND_SOC_DAPM_SWITCH_E(\"Sidetone Filter\",\n\t\t\t      AFE_SIDETONE_CON1, SIDE_TONE_ON_SFT, 0,\n\t\t\t      &stf_ctl,\n\t\t\t      mtk_stf_event,\n\t\t\t      SND_SOC_DAPM_PRE_PMU |\n\t\t\t      SND_SOC_DAPM_POST_PMD),\n\tSND_SOC_DAPM_MUX(\"STF_O19O20_MUX\", SND_SOC_NOPM, 0, 0,\n\t\t\t &stf_o19O20_mux_control),\n\tSND_SOC_DAPM_MUX(\"STF_ADDA_MUX\", SND_SOC_NOPM, 0, 0,\n\t\t\t &stf_adda_mux_control),\n\tSND_SOC_DAPM_MIXER(\"STF_CH1\", SND_SOC_NOPM, 0, 0,\n\t\t\t   mtk_stf_ch1_mix,\n\t\t\t   ARRAY_SIZE(mtk_stf_ch1_mix)),\n\tSND_SOC_DAPM_MIXER(\"STF_CH2\", SND_SOC_NOPM, 0, 0,\n\t\t\t   mtk_stf_ch2_mix,\n\t\t\t   ARRAY_SIZE(mtk_stf_ch2_mix)),\n\tSND_SOC_DAPM_OUTPUT(\"STF_OUTPUT\"),\n\n\t \n\tSND_SOC_DAPM_CLOCK_SUPPLY(\"top_mux_audio_h\"),\n\n\tSND_SOC_DAPM_CLOCK_SUPPLY(\"aud_dac_clk\"),\n\tSND_SOC_DAPM_CLOCK_SUPPLY(\"aud_dac_predis_clk\"),\n\tSND_SOC_DAPM_CLOCK_SUPPLY(\"aud_3rd_dac_clk\"),\n\tSND_SOC_DAPM_CLOCK_SUPPLY(\"aud_3rd_dac_predis_clk\"),\n\n\tSND_SOC_DAPM_CLOCK_SUPPLY(\"aud_adc_clk\"),\n\tSND_SOC_DAPM_CLOCK_SUPPLY(\"aud_adda6_adc_clk\"),\n};\n\nstatic const struct snd_soc_dapm_route mtk_dai_adda_routes[] = {\n\t \n\t{\"ADDA_DL_CH1\", \"DL1_CH1\", \"DL1\"},\n\t{\"ADDA_DL_CH2\", \"DL1_CH1\", \"DL1\"},\n\t{\"ADDA_DL_CH2\", \"DL1_CH2\", \"DL1\"},\n\n\t{\"ADDA_DL_CH1\", \"DL12_CH1\", \"DL12\"},\n\t{\"ADDA_DL_CH2\", \"DL12_CH2\", \"DL12\"},\n\n\t{\"ADDA_DL_CH1\", \"DL6_CH1\", \"DL6\"},\n\t{\"ADDA_DL_CH2\", \"DL6_CH2\", \"DL6\"},\n\n\t{\"ADDA_DL_CH1\", \"DL8_CH1\", \"DL8\"},\n\t{\"ADDA_DL_CH2\", \"DL8_CH2\", \"DL8\"},\n\n\t{\"ADDA_DL_CH1\", \"DL2_CH1\", \"DL2\"},\n\t{\"ADDA_DL_CH2\", \"DL2_CH1\", \"DL2\"},\n\t{\"ADDA_DL_CH2\", \"DL2_CH2\", \"DL2\"},\n\n\t{\"ADDA_DL_CH1\", \"DL3_CH1\", \"DL3\"},\n\t{\"ADDA_DL_CH2\", \"DL3_CH1\", \"DL3\"},\n\t{\"ADDA_DL_CH2\", \"DL3_CH2\", \"DL3\"},\n\n\t{\"ADDA_DL_CH1\", \"DL4_CH1\", \"DL4\"},\n\t{\"ADDA_DL_CH2\", \"DL4_CH2\", \"DL4\"},\n\n\t{\"ADDA_DL_CH1\", \"DL5_CH1\", \"DL5\"},\n\t{\"ADDA_DL_CH2\", \"DL5_CH2\", \"DL5\"},\n\n\t{\"ADDA Playback\", NULL, \"ADDA_DL_CH1\"},\n\t{\"ADDA Playback\", NULL, \"ADDA_DL_CH2\"},\n\n\t{\"ADDA Playback\", NULL, \"ADDA Enable\"},\n\t{\"ADDA Playback\", NULL, \"ADDA Playback Enable\"},\n\n\t{\"ADDA_DL_CH3\", \"DL1_CH1\", \"DL1\"},\n\t{\"ADDA_DL_CH4\", \"DL1_CH1\", \"DL1\"},\n\t{\"ADDA_DL_CH4\", \"DL1_CH2\", \"DL1\"},\n\n\t{\"ADDA_DL_CH3\", \"DL12_CH1\", \"DL12\"},\n\t{\"ADDA_DL_CH4\", \"DL12_CH2\", \"DL12\"},\n\n\t{\"ADDA_DL_CH3\", \"DL6_CH1\", \"DL6\"},\n\t{\"ADDA_DL_CH4\", \"DL6_CH2\", \"DL6\"},\n\n\t{\"ADDA_DL_CH3\", \"DL2_CH1\", \"DL2\"},\n\t{\"ADDA_DL_CH4\", \"DL2_CH1\", \"DL2\"},\n\t{\"ADDA_DL_CH4\", \"DL2_CH2\", \"DL2\"},\n\n\t{\"ADDA_DL_CH3\", \"DL3_CH1\", \"DL3\"},\n\t{\"ADDA_DL_CH4\", \"DL3_CH1\", \"DL3\"},\n\t{\"ADDA_DL_CH4\", \"DL3_CH2\", \"DL3\"},\n\n\t{\"ADDA_DL_CH3\", \"DL4_CH1\", \"DL4\"},\n\t{\"ADDA_DL_CH4\", \"DL4_CH2\", \"DL4\"},\n\n\t{\"ADDA_DL_CH3\", \"DL5_CH1\", \"DL5\"},\n\t{\"ADDA_DL_CH4\", \"DL5_CH2\", \"DL5\"},\n\n\t{\"ADDA CH34 Playback\", NULL, \"ADDA_DL_CH3\"},\n\t{\"ADDA CH34 Playback\", NULL, \"ADDA_DL_CH4\"},\n\n\t{\"ADDA CH34 Playback\", NULL, \"ADDA Enable\"},\n\t{\"ADDA CH34 Playback\", NULL, \"ADDA CH34 Playback Enable\"},\n\n\t \n\t{\"ADDA_UL_Mux\", \"MTKAIF\", \"ADDA Capture\"},\n\t{\"ADDA_UL_Mux\", \"AP_DMIC\", \"AP DMIC Capture\"},\n\n\t{\"ADDA_CH34_UL_Mux\", \"MTKAIF\", \"ADDA CH34 Capture\"},\n\t{\"ADDA_CH34_UL_Mux\", \"AP_DMIC\", \"AP DMIC CH34 Capture\"},\n\n\t{\"ADDA Capture\", NULL, \"ADDA Enable\"},\n\t{\"ADDA Capture\", NULL, \"ADDA Capture Enable\"},\n\t{\"ADDA Capture\", NULL, \"AUD_PAD_TOP\"},\n\t{\"ADDA Capture\", NULL, \"ADDA_MTKAIF_CFG\"},\n\n\t{\"AP DMIC Capture\", NULL, \"ADDA Enable\"},\n\t{\"AP DMIC Capture\", NULL, \"ADDA Capture Enable\"},\n\t{\"AP DMIC Capture\", NULL, \"ADDA_FIFO\"},\n\t{\"AP DMIC Capture\", NULL, \"AP_DMIC_EN\"},\n\n\t{\"ADDA CH34 Capture\", NULL, \"ADDA Enable\"},\n\t{\"ADDA CH34 Capture\", NULL, \"ADDA CH34 Capture Enable\"},\n\t{\"ADDA CH34 Capture\", NULL, \"AUD_PAD_TOP\"},\n\t{\"ADDA CH34 Capture\", NULL, \"ADDA6_MTKAIF_CFG\"},\n\n\t{\"AP DMIC CH34 Capture\", NULL, \"ADDA Enable\"},\n\t{\"AP DMIC CH34 Capture\", NULL, \"ADDA CH34 Capture Enable\"},\n\t{\"AP DMIC CH34 Capture\", NULL, \"ADDA_CH34_FIFO\"},\n\t{\"AP DMIC CH34 Capture\", NULL, \"AP_DMIC_CH34_EN\"},\n\n\t{\"AP DMIC Capture\", NULL, \"AP_DMIC_INPUT\"},\n\t{\"AP DMIC CH34 Capture\", NULL, \"AP_DMIC_CH34_INPUT\"},\n\n\t \n\t{\"STF_ADDA_MUX\", \"ADDA\", \"ADDA_UL_Mux\"},\n\t{\"STF_ADDA_MUX\", \"ADDA6\", \"ADDA_CH34_UL_Mux\"},\n\n\t{\"STF_O19O20_MUX\", \"ADDA_ADDA6\", \"STF_ADDA_MUX\"},\n\t{\"STF_O19O20_MUX\", \"O19O20\", \"STF_CH1\"},\n\t{\"STF_O19O20_MUX\", \"O19O20\", \"STF_CH2\"},\n\n\t{\"Sidetone Filter\", \"Switch\", \"STF_O19O20_MUX\"},\n\t{\"STF_OUTPUT\", NULL, \"Sidetone Filter\"},\n\t{\"ADDA Playback\", NULL, \"Sidetone Filter\"},\n\t{\"ADDA CH34 Playback\", NULL, \"Sidetone Filter\"},\n\n\t \n\t{\"ADDA Playback\", NULL, \"aud_dac_clk\"},\n\t{\"ADDA Playback\", NULL, \"aud_dac_predis_clk\"},\n\n\t{\"ADDA CH34 Playback\", NULL, \"aud_3rd_dac_clk\"},\n\t{\"ADDA CH34 Playback\", NULL, \"aud_3rd_dac_predis_clk\"},\n\n\t{\"ADDA Capture Enable\", NULL, \"aud_adc_clk\"},\n\t{\"ADDA CH34 Capture Enable\", NULL, \"aud_adda6_adc_clk\"},\n};\n\n \nstatic int mtk_dai_adda_hw_params(struct snd_pcm_substream *substream,\n\t\t\t\t  struct snd_pcm_hw_params *params,\n\t\t\t\t  struct snd_soc_dai *dai)\n{\n\tstruct mtk_base_afe *afe = snd_soc_dai_get_drvdata(dai);\n\tunsigned int rate = params_rate(params);\n\tint id = dai->id;\n\n\tif (substream->stream == SNDRV_PCM_STREAM_PLAYBACK) {\n\t\tunsigned int dl_src2_con0 = 0;\n\t\tunsigned int dl_src2_con1 = 0;\n\n\t\t \n\t\tdl_src2_con0 = adda_dl_rate_transform(afe, rate) <<\n\t\t\t       DL_2_INPUT_MODE_CTL_SFT;\n\n\t\t \n\t\tdl_src2_con0 |= (0x3 << DL_2_OUTPUT_SEL_CTL_SFT);\n\n\t\t \n\t\tdl_src2_con0 |= (0x01 << DL_2_MUTE_CH2_OFF_CTL_PRE_SFT);\n\t\tdl_src2_con0 |= (0x01 << DL_2_MUTE_CH1_OFF_CTL_PRE_SFT);\n\n\t\t \n\t\tif (rate == 8000 || rate == 16000)\n\t\t\tdl_src2_con0 |= 0x01 << DL_2_VOICE_MODE_CTL_PRE_SFT;\n\n\t\t \n\t\tdl_src2_con1 = MTK_AFE_ADDA_DL_GAIN_NORMAL <<\n\t\t\t       DL_2_GAIN_CTL_PRE_SFT;\n\n\t\t \n\t\tdl_src2_con0 |= (0x01 << DL_2_GAIN_ON_CTL_PRE_SFT);\n\n\t\tif (id == MT8192_DAI_ADDA) {\n\t\t\t \n\t\t\tregmap_write(afe->regmap, AFE_ADDA_PREDIS_CON0, 0);\n\t\t\tregmap_write(afe->regmap, AFE_ADDA_PREDIS_CON1, 0);\n\n\t\t\tregmap_write(afe->regmap,\n\t\t\t\t     AFE_ADDA_DL_SRC2_CON0, dl_src2_con0);\n\t\t\tregmap_write(afe->regmap,\n\t\t\t\t     AFE_ADDA_DL_SRC2_CON1, dl_src2_con1);\n\n\t\t\t \n\t\t\tregmap_update_bits(afe->regmap,\n\t\t\t\t\t   AFE_ADDA_DL_SDM_DCCOMP_CON,\n\t\t\t\t\t   ATTGAIN_CTL_MASK_SFT,\n\t\t\t\t\t   AUDIO_SDM_LEVEL_NORMAL <<\n\t\t\t\t\t   ATTGAIN_CTL_SFT);\n\n\t\t\t \n\t\t\tregmap_update_bits(afe->regmap,\n\t\t\t\t\t   AFE_ADDA_DL_SDM_DCCOMP_CON,\n\t\t\t\t\t   USE_3RD_SDM_MASK_SFT,\n\t\t\t\t\t   AUDIO_SDM_2ND << USE_3RD_SDM_SFT);\n\n\t\t\t \n\t\t\tregmap_write(afe->regmap,\n\t\t\t\t     AFE_ADDA_DL_SDM_AUTO_RESET_CON,\n\t\t\t\t     SDM_AUTO_RESET_THRESHOLD);\n\t\t\tregmap_update_bits(afe->regmap,\n\t\t\t\t\t   AFE_ADDA_DL_SDM_AUTO_RESET_CON,\n\t\t\t\t\t   ADDA_SDM_AUTO_RESET_ONOFF_MASK_SFT,\n\t\t\t\t\t   0x1 << ADDA_SDM_AUTO_RESET_ONOFF_SFT);\n\t\t} else {\n\t\t\t \n\t\t\tregmap_write(afe->regmap,\n\t\t\t\t     AFE_ADDA_3RD_DAC_PREDIS_CON0, 0);\n\t\t\tregmap_write(afe->regmap,\n\t\t\t\t     AFE_ADDA_3RD_DAC_PREDIS_CON1, 0);\n\n\t\t\tregmap_write(afe->regmap, AFE_ADDA_3RD_DAC_DL_SRC2_CON0,\n\t\t\t\t     dl_src2_con0);\n\t\t\tregmap_write(afe->regmap, AFE_ADDA_3RD_DAC_DL_SRC2_CON1,\n\t\t\t\t     dl_src2_con1);\n\n\t\t\t \n\t\t\tregmap_update_bits(afe->regmap,\n\t\t\t\t\t   AFE_ADDA_3RD_DAC_DL_SDM_DCCOMP_CON,\n\t\t\t\t\t   ATTGAIN_CTL_MASK_SFT,\n\t\t\t\t\t   AUDIO_SDM_LEVEL_NORMAL <<\n\t\t\t\t\t   ATTGAIN_CTL_SFT);\n\n\t\t\t \n\t\t\tregmap_update_bits(afe->regmap,\n\t\t\t\t\t   AFE_ADDA_3RD_DAC_DL_SDM_DCCOMP_CON,\n\t\t\t\t\t   USE_3RD_SDM_MASK_SFT,\n\t\t\t\t\t   AUDIO_SDM_2ND << USE_3RD_SDM_SFT);\n\n\t\t\t \n\t\t\tregmap_write(afe->regmap,\n\t\t\t\t     AFE_ADDA_3RD_DAC_DL_SDM_AUTO_RESET_CON,\n\t\t\t\t     SDM_AUTO_RESET_THRESHOLD);\n\t\t\tregmap_update_bits(afe->regmap,\n\t\t\t\t\t   AFE_ADDA_3RD_DAC_DL_SDM_AUTO_RESET_CON,\n\t\t\t\t\t   ADDA_3RD_DAC_SDM_AUTO_RESET_ONOFF_MASK_SFT,\n\t\t\t\t\t   0x1 << ADDA_3RD_DAC_SDM_AUTO_RESET_ONOFF_SFT);\n\t\t}\n\t} else {\n\t\tunsigned int voice_mode = 0;\n\t\tunsigned int ul_src_con0 = 0;\t \n\n\t\tvoice_mode = adda_ul_rate_transform(afe, rate);\n\n\t\tul_src_con0 |= (voice_mode << 17) & (0x7 << 17);\n\n\t\t \n\t\tul_src_con0 |= (1 << UL_IIR_ON_TMP_CTL_SFT) &\n\t\t\t       UL_IIR_ON_TMP_CTL_MASK_SFT;\n\t\tul_src_con0 |= (UL_IIR_SW << UL_IIRMODE_CTL_SFT) &\n\t\t\t       UL_IIRMODE_CTL_MASK_SFT;\n\n\t\tswitch (id) {\n\t\tcase MT8192_DAI_ADDA:\n\t\tcase MT8192_DAI_AP_DMIC:\n\t\t\t \n\t\t\tregmap_write(afe->regmap,\n\t\t\t\t     AFE_ADDA_IIR_COEF_02_01, 0x00000000);\n\t\t\tregmap_write(afe->regmap,\n\t\t\t\t     AFE_ADDA_IIR_COEF_04_03, 0x00003FB8);\n\t\t\tregmap_write(afe->regmap,\n\t\t\t\t     AFE_ADDA_IIR_COEF_06_05, 0x3FB80000);\n\t\t\tregmap_write(afe->regmap,\n\t\t\t\t     AFE_ADDA_IIR_COEF_08_07, 0x3FB80000);\n\t\t\tregmap_write(afe->regmap,\n\t\t\t\t     AFE_ADDA_IIR_COEF_10_09, 0x0000C048);\n\n\t\t\tregmap_write(afe->regmap,\n\t\t\t\t     AFE_ADDA_UL_SRC_CON0, ul_src_con0);\n\n\t\t\t \n\t\t\tregmap_update_bits(afe->regmap,\n\t\t\t\t\t   AFE_ADDA_TOP_CON0,\n\t\t\t\t\t   0x1 << 0,\n\t\t\t\t\t   0x0 << 0);\n\n\t\t\t \n\t\t\tregmap_update_bits(afe->regmap,\n\t\t\t\t\t   AFE_ADDA_MTKAIF_RX_CFG0,\n\t\t\t\t\t   0x1 << 0,\n\t\t\t\t\t   0x0 << 0);\n\t\t\tbreak;\n\t\tcase MT8192_DAI_ADDA_CH34:\n\t\tcase MT8192_DAI_AP_DMIC_CH34:\n\t\t\t \n\t\t\tregmap_write(afe->regmap,\n\t\t\t\t     AFE_ADDA6_IIR_COEF_02_01, 0x00000000);\n\t\t\tregmap_write(afe->regmap,\n\t\t\t\t     AFE_ADDA6_IIR_COEF_04_03, 0x00003FB8);\n\t\t\tregmap_write(afe->regmap,\n\t\t\t\t     AFE_ADDA6_IIR_COEF_06_05, 0x3FB80000);\n\t\t\tregmap_write(afe->regmap,\n\t\t\t\t     AFE_ADDA6_IIR_COEF_08_07, 0x3FB80000);\n\t\t\tregmap_write(afe->regmap,\n\t\t\t\t     AFE_ADDA6_IIR_COEF_10_09, 0x0000C048);\n\n\t\t\tregmap_write(afe->regmap,\n\t\t\t\t     AFE_ADDA6_UL_SRC_CON0, ul_src_con0);\n\n\t\t\t \n\t\t\tregmap_update_bits(afe->regmap,\n\t\t\t\t\t   AFE_ADDA6_TOP_CON0,\n\t\t\t\t\t   0x1 << 0,\n\t\t\t\t\t   0x0 << 0);\n\n\t\t\t \n\t\t\tregmap_update_bits(afe->regmap,\n\t\t\t\t\t   AFE_ADDA6_MTKAIF_RX_CFG0,\n\t\t\t\t\t   0x1 << 0,\n\t\t\t\t\t   0x0 << 0);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tbreak;\n\t\t}\n\n\t\t \n\t\tswitch (id) {\n\t\tcase MT8192_DAI_AP_DMIC:\n\t\tcase MT8192_DAI_AP_DMIC_CH34:\n\t\t\tmtk_adda_ul_src_dmic(afe, id);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tbreak;\n\t\t}\n\t}\n\n\treturn 0;\n}\n\nstatic const struct snd_soc_dai_ops mtk_dai_adda_ops = {\n\t.hw_params = mtk_dai_adda_hw_params,\n};\n\n \n#define MTK_ADDA_PLAYBACK_RATES (SNDRV_PCM_RATE_8000_48000 |\\\n\t\t\t\t SNDRV_PCM_RATE_96000 |\\\n\t\t\t\t SNDRV_PCM_RATE_192000)\n\n#define MTK_ADDA_CAPTURE_RATES (SNDRV_PCM_RATE_8000 |\\\n\t\t\t\tSNDRV_PCM_RATE_16000 |\\\n\t\t\t\tSNDRV_PCM_RATE_32000 |\\\n\t\t\t\tSNDRV_PCM_RATE_48000 |\\\n\t\t\t\tSNDRV_PCM_RATE_96000 |\\\n\t\t\t\tSNDRV_PCM_RATE_192000)\n\n#define MTK_ADDA_FORMATS (SNDRV_PCM_FMTBIT_S16_LE |\\\n\t\t\t  SNDRV_PCM_FMTBIT_S24_LE |\\\n\t\t\t  SNDRV_PCM_FMTBIT_S32_LE)\n\nstatic struct snd_soc_dai_driver mtk_dai_adda_driver[] = {\n\t{\n\t\t.name = \"ADDA\",\n\t\t.id = MT8192_DAI_ADDA,\n\t\t.playback = {\n\t\t\t.stream_name = \"ADDA Playback\",\n\t\t\t.channels_min = 1,\n\t\t\t.channels_max = 2,\n\t\t\t.rates = MTK_ADDA_PLAYBACK_RATES,\n\t\t\t.formats = MTK_ADDA_FORMATS,\n\t\t},\n\t\t.capture = {\n\t\t\t.stream_name = \"ADDA Capture\",\n\t\t\t.channels_min = 1,\n\t\t\t.channels_max = 2,\n\t\t\t.rates = MTK_ADDA_CAPTURE_RATES,\n\t\t\t.formats = MTK_ADDA_FORMATS,\n\t\t},\n\t\t.ops = &mtk_dai_adda_ops,\n\t},\n\t{\n\t\t.name = \"ADDA_CH34\",\n\t\t.id = MT8192_DAI_ADDA_CH34,\n\t\t.playback = {\n\t\t\t.stream_name = \"ADDA CH34 Playback\",\n\t\t\t.channels_min = 1,\n\t\t\t.channels_max = 2,\n\t\t\t.rates = MTK_ADDA_PLAYBACK_RATES,\n\t\t\t.formats = MTK_ADDA_FORMATS,\n\t\t},\n\t\t.capture = {\n\t\t\t.stream_name = \"ADDA CH34 Capture\",\n\t\t\t.channels_min = 1,\n\t\t\t.channels_max = 2,\n\t\t\t.rates = MTK_ADDA_CAPTURE_RATES,\n\t\t\t.formats = MTK_ADDA_FORMATS,\n\t\t},\n\t\t.ops = &mtk_dai_adda_ops,\n\t},\n\t{\n\t\t.name = \"AP_DMIC\",\n\t\t.id = MT8192_DAI_AP_DMIC,\n\t\t.capture = {\n\t\t\t.stream_name = \"AP DMIC Capture\",\n\t\t\t.channels_min = 1,\n\t\t\t.channels_max = 2,\n\t\t\t.rates = MTK_ADDA_CAPTURE_RATES,\n\t\t\t.formats = MTK_ADDA_FORMATS,\n\t\t},\n\t\t.ops = &mtk_dai_adda_ops,\n\t},\n\t{\n\t\t.name = \"AP_DMIC_CH34\",\n\t\t.id = MT8192_DAI_AP_DMIC_CH34,\n\t\t.capture = {\n\t\t\t.stream_name = \"AP DMIC CH34 Capture\",\n\t\t\t.channels_min = 1,\n\t\t\t.channels_max = 2,\n\t\t\t.rates = MTK_ADDA_CAPTURE_RATES,\n\t\t\t.formats = MTK_ADDA_FORMATS,\n\t\t},\n\t\t.ops = &mtk_dai_adda_ops,\n\t},\n};\n\nint mt8192_dai_adda_register(struct mtk_base_afe *afe)\n{\n\tstruct mtk_base_afe_dai *dai;\n\tstruct mt8192_afe_private *afe_priv = afe->platform_priv;\n\n\tdai = devm_kzalloc(afe->dev, sizeof(*dai), GFP_KERNEL);\n\tif (!dai)\n\t\treturn -ENOMEM;\n\n\tlist_add(&dai->list, &afe->sub_dais);\n\n\tdai->dai_drivers = mtk_dai_adda_driver;\n\tdai->num_dai_drivers = ARRAY_SIZE(mtk_dai_adda_driver);\n\n\tdai->controls = mtk_adda_controls;\n\tdai->num_controls = ARRAY_SIZE(mtk_adda_controls);\n\tdai->dapm_widgets = mtk_dai_adda_widgets;\n\tdai->num_dapm_widgets = ARRAY_SIZE(mtk_dai_adda_widgets);\n\tdai->dapm_routes = mtk_dai_adda_routes;\n\tdai->num_dapm_routes = ARRAY_SIZE(mtk_dai_adda_routes);\n\n\t \n\tafe_priv->dai_priv[MT8192_DAI_AP_DMIC] =\n\t\tafe_priv->dai_priv[MT8192_DAI_ADDA];\n\tafe_priv->dai_priv[MT8192_DAI_AP_DMIC_CH34] =\n\t\tafe_priv->dai_priv[MT8192_DAI_ADDA_CH34];\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}