{
  "module_name": "mt8195-mt6359.c",
  "hash_id": "059ca6bdaae9a8552cc183784f35d742fb9bf1348c2c9957449b663b4d162a66",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/mediatek/mt8195/mt8195-mt6359.c",
  "human_readable_source": "\n \n\n#include <linux/input.h>\n#include <linux/module.h>\n#include <linux/of_device.h>\n#include <linux/pm_runtime.h>\n#include <sound/jack.h>\n#include <sound/pcm_params.h>\n#include <sound/rt5682.h>\n#include <sound/soc.h>\n#include \"../../codecs/mt6359.h\"\n#include \"../../codecs/rt1011.h\"\n#include \"../../codecs/rt5682.h\"\n#include \"../common/mtk-afe-platform-driver.h\"\n#include \"../common/mtk-dsp-sof-common.h\"\n#include \"../common/mtk-soc-card.h\"\n#include \"mt8195-afe-clk.h\"\n#include \"mt8195-afe-common.h\"\n\n#define RT1011_SPEAKER_AMP_PRESENT\t\tBIT(0)\n#define RT1019_SPEAKER_AMP_PRESENT\t\tBIT(1)\n#define MAX98390_SPEAKER_AMP_PRESENT\t\tBIT(2)\n\n#define RT1011_CODEC_DAI\t\"rt1011-aif\"\n#define RT1011_DEV0_NAME\t\"rt1011.2-0038\"\n#define RT1011_DEV1_NAME\t\"rt1011.2-0039\"\n\n#define RT1019_CODEC_DAI\t\"HiFi\"\n#define RT1019_DEV0_NAME\t\"rt1019p\"\n\n#define MAX98390_CODEC_DAI\t\"max98390-aif1\"\n#define MAX98390_DEV0_NAME\t\"max98390.2-0038\"  \n#define MAX98390_DEV1_NAME\t\"max98390.2-0039\"  \n\n#define RT5682_CODEC_DAI\t\"rt5682-aif1\"\n#define RT5682_DEV0_NAME\t\"rt5682.2-001a\"\n\n#define RT5682S_CODEC_DAI\t\"rt5682s-aif1\"\n#define RT5682S_DEV0_NAME\t\"rt5682s.2-001a\"\n\n#define SOF_DMA_DL2 \"SOF_DMA_DL2\"\n#define SOF_DMA_DL3 \"SOF_DMA_DL3\"\n#define SOF_DMA_UL4 \"SOF_DMA_UL4\"\n#define SOF_DMA_UL5 \"SOF_DMA_UL5\"\n\nstruct mt8195_card_data {\n\tconst char *name;\n\tunsigned long quirk;\n};\n\nstruct mt8195_mt6359_priv {\n\tstruct snd_soc_jack headset_jack;\n\tstruct snd_soc_jack dp_jack;\n\tstruct snd_soc_jack hdmi_jack;\n\tstruct clk *i2so1_mclk;\n};\n\n \nstatic struct snd_soc_jack_pin mt8195_jack_pins[] = {\n\t{\n\t\t.pin = \"Headphone\",\n\t\t.mask = SND_JACK_HEADPHONE,\n\t},\n\t{\n\t\t.pin = \"Headset Mic\",\n\t\t.mask = SND_JACK_MICROPHONE,\n\t},\n};\n\nstatic const struct snd_soc_dapm_widget mt8195_mt6359_widgets[] = {\n\tSND_SOC_DAPM_HP(\"Headphone\", NULL),\n\tSND_SOC_DAPM_MIC(\"Headset Mic\", NULL),\n\tSND_SOC_DAPM_MIXER(SOF_DMA_DL2, SND_SOC_NOPM, 0, 0, NULL, 0),\n\tSND_SOC_DAPM_MIXER(SOF_DMA_DL3, SND_SOC_NOPM, 0, 0, NULL, 0),\n\tSND_SOC_DAPM_MIXER(SOF_DMA_UL4, SND_SOC_NOPM, 0, 0, NULL, 0),\n\tSND_SOC_DAPM_MIXER(SOF_DMA_UL5, SND_SOC_NOPM, 0, 0, NULL, 0),\n};\n\nstatic const struct snd_soc_dapm_route mt8195_mt6359_routes[] = {\n\t \n\t{ \"Headphone\", NULL, \"HPOL\" },\n\t{ \"Headphone\", NULL, \"HPOR\" },\n\t{ \"IN1P\", NULL, \"Headset Mic\" },\n\t \n\t{SOF_DMA_UL4, NULL, \"O034\"},\n\t{SOF_DMA_UL4, NULL, \"O035\"},\n\t{SOF_DMA_UL5, NULL, \"O036\"},\n\t{SOF_DMA_UL5, NULL, \"O037\"},\n\t \n\t{\"I070\", NULL, SOF_DMA_DL2},\n\t{\"I071\", NULL, SOF_DMA_DL2},\n\t{\"I020\", NULL, SOF_DMA_DL3},\n\t{\"I021\", NULL, SOF_DMA_DL3},\n};\n\nstatic const struct snd_kcontrol_new mt8195_mt6359_controls[] = {\n\tSOC_DAPM_PIN_SWITCH(\"Headphone\"),\n\tSOC_DAPM_PIN_SWITCH(\"Headset Mic\"),\n};\n\nstatic const struct snd_soc_dapm_widget mt8195_dual_speaker_widgets[] = {\n\tSND_SOC_DAPM_SPK(\"Left Spk\", NULL),\n\tSND_SOC_DAPM_SPK(\"Right Spk\", NULL),\n};\n\nstatic const struct snd_kcontrol_new mt8195_dual_speaker_controls[] = {\n\tSOC_DAPM_PIN_SWITCH(\"Left Spk\"),\n\tSOC_DAPM_PIN_SWITCH(\"Right Spk\"),\n};\n\nstatic const struct snd_soc_dapm_widget mt8195_speaker_widgets[] = {\n\tSND_SOC_DAPM_SPK(\"Ext Spk\", NULL),\n};\n\nstatic const struct snd_kcontrol_new mt8195_speaker_controls[] = {\n\tSOC_DAPM_PIN_SWITCH(\"Ext Spk\"),\n};\n\nstatic const struct snd_soc_dapm_route mt8195_rt1011_routes[] = {\n\t{ \"Left Spk\", NULL, \"Left SPO\" },\n\t{ \"Right Spk\", NULL, \"Right SPO\" },\n};\n\nstatic const struct snd_soc_dapm_route mt8195_rt1019_routes[] = {\n\t{ \"Ext Spk\", NULL, \"Speaker\" },\n};\n\nstatic const struct snd_soc_dapm_route mt8195_max98390_routes[] = {\n\t{ \"Left Spk\", NULL, \"Left BE_OUT\" },\n\t{ \"Right Spk\", NULL, \"Right BE_OUT\" },\n};\n\n#define CKSYS_AUD_TOP_CFG 0x032c\n#define CKSYS_AUD_TOP_MON 0x0330\n\nstatic int mt8195_mt6359_mtkaif_calibration(struct snd_soc_pcm_runtime *rtd)\n{\n\tstruct snd_soc_component *cmpnt_afe =\n\t\tsnd_soc_rtdcom_lookup(rtd, AFE_PCM_NAME);\n\tstruct snd_soc_component *cmpnt_codec =\n\t\tasoc_rtd_to_codec(rtd, 0)->component;\n\tstruct mtk_base_afe *afe = snd_soc_component_get_drvdata(cmpnt_afe);\n\tstruct mt8195_afe_private *afe_priv = afe->platform_priv;\n\tstruct mtkaif_param *param = &afe_priv->mtkaif_params;\n\tint chosen_phase_1, chosen_phase_2, chosen_phase_3;\n\tint prev_cycle_1, prev_cycle_2, prev_cycle_3;\n\tint test_done_1, test_done_2, test_done_3;\n\tint cycle_1, cycle_2, cycle_3;\n\tint mtkaif_chosen_phase[MT8195_MTKAIF_MISO_NUM];\n\tint mtkaif_phase_cycle[MT8195_MTKAIF_MISO_NUM];\n\tint mtkaif_calibration_num_phase;\n\tbool mtkaif_calibration_ok;\n\tunsigned int monitor = 0;\n\tint counter;\n\tint phase;\n\tint i;\n\n\tdev_dbg(afe->dev, \"%s(), start\\n\", __func__);\n\n\tparam->mtkaif_calibration_ok = false;\n\tfor (i = 0; i < MT8195_MTKAIF_MISO_NUM; i++) {\n\t\tparam->mtkaif_chosen_phase[i] = -1;\n\t\tparam->mtkaif_phase_cycle[i] = 0;\n\t\tmtkaif_chosen_phase[i] = -1;\n\t\tmtkaif_phase_cycle[i] = 0;\n\t}\n\n\tif (IS_ERR(afe_priv->topckgen)) {\n\t\tdev_info(afe->dev, \"%s() Cannot find topckgen controller\\n\",\n\t\t\t __func__);\n\t\treturn 0;\n\t}\n\n\tpm_runtime_get_sync(afe->dev);\n\tmt6359_mtkaif_calibration_enable(cmpnt_codec);\n\n\t \n\tregmap_update_bits(afe_priv->topckgen,\n\t\t\t   CKSYS_AUD_TOP_CFG, 0xffff, 0x4);\n\tmtkaif_calibration_num_phase = 42;\t \n\tmtkaif_calibration_ok = true;\n\n\tfor (phase = 0;\n\t     phase <= mtkaif_calibration_num_phase && mtkaif_calibration_ok;\n\t     phase++) {\n\t\tmt6359_set_mtkaif_calibration_phase(cmpnt_codec,\n\t\t\t\t\t\t    phase, phase, phase);\n\n\t\tregmap_update_bits(afe_priv->topckgen,\n\t\t\t\t   CKSYS_AUD_TOP_CFG, 0x1, 0x1);\n\n\t\ttest_done_1 = 0;\n\t\ttest_done_2 = 0;\n\t\ttest_done_3 = 0;\n\t\tcycle_1 = -1;\n\t\tcycle_2 = -1;\n\t\tcycle_3 = -1;\n\t\tcounter = 0;\n\t\twhile (!(test_done_1 & test_done_2 & test_done_3)) {\n\t\t\tregmap_read(afe_priv->topckgen,\n\t\t\t\t    CKSYS_AUD_TOP_MON, &monitor);\n\t\t\ttest_done_1 = (monitor >> 28) & 0x1;\n\t\t\ttest_done_2 = (monitor >> 29) & 0x1;\n\t\t\ttest_done_3 = (monitor >> 30) & 0x1;\n\t\t\tif (test_done_1 == 1)\n\t\t\t\tcycle_1 = monitor & 0xf;\n\n\t\t\tif (test_done_2 == 1)\n\t\t\t\tcycle_2 = (monitor >> 4) & 0xf;\n\n\t\t\tif (test_done_3 == 1)\n\t\t\t\tcycle_3 = (monitor >> 8) & 0xf;\n\n\t\t\t \n\t\t\tif (++counter > 10000) {\n\t\t\t\tdev_info(afe->dev, \"%s(), test fail, cycle_1 %d, cycle_2 %d, cycle_3 %d, monitor 0x%x\\n\",\n\t\t\t\t\t __func__,\n\t\t\t\t\t cycle_1, cycle_2, cycle_3, monitor);\n\t\t\t\tmtkaif_calibration_ok = false;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (phase == 0) {\n\t\t\tprev_cycle_1 = cycle_1;\n\t\t\tprev_cycle_2 = cycle_2;\n\t\t\tprev_cycle_3 = cycle_3;\n\t\t}\n\n\t\tif (cycle_1 != prev_cycle_1 &&\n\t\t    mtkaif_chosen_phase[MT8195_MTKAIF_MISO_0] < 0) {\n\t\t\tmtkaif_chosen_phase[MT8195_MTKAIF_MISO_0] = phase - 1;\n\t\t\tmtkaif_phase_cycle[MT8195_MTKAIF_MISO_0] = prev_cycle_1;\n\t\t}\n\n\t\tif (cycle_2 != prev_cycle_2 &&\n\t\t    mtkaif_chosen_phase[MT8195_MTKAIF_MISO_1] < 0) {\n\t\t\tmtkaif_chosen_phase[MT8195_MTKAIF_MISO_1] = phase - 1;\n\t\t\tmtkaif_phase_cycle[MT8195_MTKAIF_MISO_1] = prev_cycle_2;\n\t\t}\n\n\t\tif (cycle_3 != prev_cycle_3 &&\n\t\t    mtkaif_chosen_phase[MT8195_MTKAIF_MISO_2] < 0) {\n\t\t\tmtkaif_chosen_phase[MT8195_MTKAIF_MISO_2] = phase - 1;\n\t\t\tmtkaif_phase_cycle[MT8195_MTKAIF_MISO_2] = prev_cycle_3;\n\t\t}\n\n\t\tregmap_update_bits(afe_priv->topckgen,\n\t\t\t\t   CKSYS_AUD_TOP_CFG, 0x1, 0x0);\n\n\t\tif (mtkaif_chosen_phase[MT8195_MTKAIF_MISO_0] >= 0 &&\n\t\t    mtkaif_chosen_phase[MT8195_MTKAIF_MISO_1] >= 0 &&\n\t\t    mtkaif_chosen_phase[MT8195_MTKAIF_MISO_2] >= 0)\n\t\t\tbreak;\n\t}\n\n\tif (mtkaif_chosen_phase[MT8195_MTKAIF_MISO_0] < 0) {\n\t\tmtkaif_calibration_ok = false;\n\t\tchosen_phase_1 = 0;\n\t} else {\n\t\tchosen_phase_1 = mtkaif_chosen_phase[MT8195_MTKAIF_MISO_0];\n\t}\n\n\tif (mtkaif_chosen_phase[MT8195_MTKAIF_MISO_1] < 0) {\n\t\tmtkaif_calibration_ok = false;\n\t\tchosen_phase_2 = 0;\n\t} else {\n\t\tchosen_phase_2 = mtkaif_chosen_phase[MT8195_MTKAIF_MISO_1];\n\t}\n\n\tif (mtkaif_chosen_phase[MT8195_MTKAIF_MISO_2] < 0) {\n\t\tmtkaif_calibration_ok = false;\n\t\tchosen_phase_3 = 0;\n\t} else {\n\t\tchosen_phase_3 = mtkaif_chosen_phase[MT8195_MTKAIF_MISO_2];\n\t}\n\n\tmt6359_set_mtkaif_calibration_phase(cmpnt_codec,\n\t\t\t\t\t    chosen_phase_1,\n\t\t\t\t\t    chosen_phase_2,\n\t\t\t\t\t    chosen_phase_3);\n\n\tmt6359_mtkaif_calibration_disable(cmpnt_codec);\n\tpm_runtime_put(afe->dev);\n\n\tparam->mtkaif_calibration_ok = mtkaif_calibration_ok;\n\tparam->mtkaif_chosen_phase[MT8195_MTKAIF_MISO_0] = chosen_phase_1;\n\tparam->mtkaif_chosen_phase[MT8195_MTKAIF_MISO_1] = chosen_phase_2;\n\tparam->mtkaif_chosen_phase[MT8195_MTKAIF_MISO_2] = chosen_phase_3;\n\tfor (i = 0; i < MT8195_MTKAIF_MISO_NUM; i++)\n\t\tparam->mtkaif_phase_cycle[i] = mtkaif_phase_cycle[i];\n\n\tdev_info(afe->dev, \"%s(), end, calibration ok %d\\n\",\n\t\t __func__, param->mtkaif_calibration_ok);\n\n\treturn 0;\n}\n\nstatic int mt8195_mt6359_init(struct snd_soc_pcm_runtime *rtd)\n{\n\tstruct snd_soc_component *cmpnt_codec =\n\t\tasoc_rtd_to_codec(rtd, 0)->component;\n\n\t \n\tmt6359_set_mtkaif_protocol(cmpnt_codec,\n\t\t\t\t   MT6359_MTKAIF_PROTOCOL_2_CLK_P2);\n\n\t \n\tmt8195_mt6359_mtkaif_calibration(rtd);\n\n\treturn 0;\n}\n\nstatic int mt8195_hdmitx_dptx_startup(struct snd_pcm_substream *substream)\n{\n\tstatic const unsigned int rates[] = {\n\t\t48000\n\t};\n\tstatic const unsigned int channels[] = {\n\t\t2, 4, 6, 8\n\t};\n\tstatic const struct snd_pcm_hw_constraint_list constraints_rates = {\n\t\t.count = ARRAY_SIZE(rates),\n\t\t.list  = rates,\n\t\t.mask = 0,\n\t};\n\tstatic const struct snd_pcm_hw_constraint_list constraints_channels = {\n\t\t.count = ARRAY_SIZE(channels),\n\t\t.list  = channels,\n\t\t.mask = 0,\n\t};\n\n\tstruct snd_soc_pcm_runtime *rtd = asoc_substream_to_rtd(substream);\n\tstruct snd_pcm_runtime *runtime = substream->runtime;\n\tint ret;\n\n\tret = snd_pcm_hw_constraint_list(runtime, 0,\n\t\t\t\t\t SNDRV_PCM_HW_PARAM_RATE,\n\t\t\t\t\t &constraints_rates);\n\tif (ret < 0) {\n\t\tdev_err(rtd->dev, \"hw_constraint_list rate failed\\n\");\n\t\treturn ret;\n\t}\n\n\tret = snd_pcm_hw_constraint_list(runtime, 0,\n\t\t\t\t\t SNDRV_PCM_HW_PARAM_CHANNELS,\n\t\t\t\t\t &constraints_channels);\n\tif (ret < 0) {\n\t\tdev_err(rtd->dev, \"hw_constraint_list channel failed\\n\");\n\t\treturn ret;\n\t}\n\n\treturn 0;\n}\n\nstatic const struct snd_soc_ops mt8195_hdmitx_dptx_playback_ops = {\n\t.startup = mt8195_hdmitx_dptx_startup,\n};\n\nstatic int mt8195_dptx_hw_params(struct snd_pcm_substream *substream,\n\t\t\t\t struct snd_pcm_hw_params *params)\n{\n\tstruct snd_soc_pcm_runtime *rtd = substream->private_data;\n\tstruct snd_soc_dai *cpu_dai = asoc_rtd_to_cpu(rtd, 0);\n\n\treturn snd_soc_dai_set_sysclk(cpu_dai, 0, params_rate(params) * 256,\n\t\t\t\t      SND_SOC_CLOCK_OUT);\n}\n\nstatic const struct snd_soc_ops mt8195_dptx_ops = {\n\t.hw_params = mt8195_dptx_hw_params,\n};\n\nstatic int mt8195_dptx_codec_init(struct snd_soc_pcm_runtime *rtd)\n{\n\tstruct mtk_soc_card_data *soc_card_data = snd_soc_card_get_drvdata(rtd->card);\n\tstruct mt8195_mt6359_priv *priv = soc_card_data->mach_priv;\n\tstruct snd_soc_component *cmpnt_codec =\n\t\tasoc_rtd_to_codec(rtd, 0)->component;\n\tint ret;\n\n\tret = snd_soc_card_jack_new(rtd->card, \"DP Jack\", SND_JACK_LINEOUT,\n\t\t\t\t    &priv->dp_jack);\n\tif (ret)\n\t\treturn ret;\n\n\treturn snd_soc_component_set_jack(cmpnt_codec, &priv->dp_jack, NULL);\n}\n\nstatic int mt8195_hdmi_codec_init(struct snd_soc_pcm_runtime *rtd)\n{\n\tstruct mtk_soc_card_data *soc_card_data = snd_soc_card_get_drvdata(rtd->card);\n\tstruct mt8195_mt6359_priv *priv = soc_card_data->mach_priv;\n\tstruct snd_soc_component *cmpnt_codec =\n\t\tasoc_rtd_to_codec(rtd, 0)->component;\n\tint ret;\n\n\tret = snd_soc_card_jack_new(rtd->card, \"HDMI Jack\", SND_JACK_LINEOUT,\n\t\t\t\t    &priv->hdmi_jack);\n\tif (ret)\n\t\treturn ret;\n\n\treturn snd_soc_component_set_jack(cmpnt_codec, &priv->hdmi_jack, NULL);\n}\n\nstatic int mt8195_dptx_hw_params_fixup(struct snd_soc_pcm_runtime *rtd,\n\t\t\t\t       struct snd_pcm_hw_params *params)\n{\n\t \n\tsnd_mask_reset_range(hw_param_mask(params, SNDRV_PCM_HW_PARAM_FORMAT),\n\t\t\t     0, (__force unsigned int)SNDRV_PCM_FORMAT_LAST);\n\n\tparams_set_format(params, SNDRV_PCM_FORMAT_S24_LE);\n\n\treturn 0;\n}\n\nstatic int mt8195_playback_startup(struct snd_pcm_substream *substream)\n{\n\tstatic const unsigned int rates[] = {\n\t\t48000\n\t};\n\tstatic const unsigned int channels[] = {\n\t\t2\n\t};\n\tstatic const struct snd_pcm_hw_constraint_list constraints_rates = {\n\t\t.count = ARRAY_SIZE(rates),\n\t\t.list  = rates,\n\t\t.mask = 0,\n\t};\n\tstatic const struct snd_pcm_hw_constraint_list constraints_channels = {\n\t\t.count = ARRAY_SIZE(channels),\n\t\t.list  = channels,\n\t\t.mask = 0,\n\t};\n\n\tstruct snd_soc_pcm_runtime *rtd = asoc_substream_to_rtd(substream);\n\tstruct snd_pcm_runtime *runtime = substream->runtime;\n\tint ret;\n\n\tret = snd_pcm_hw_constraint_list(runtime, 0,\n\t\t\t\t\t SNDRV_PCM_HW_PARAM_RATE,\n\t\t\t\t\t &constraints_rates);\n\tif (ret < 0) {\n\t\tdev_err(rtd->dev, \"hw_constraint_list rate failed\\n\");\n\t\treturn ret;\n\t}\n\n\tret = snd_pcm_hw_constraint_list(runtime, 0,\n\t\t\t\t\t SNDRV_PCM_HW_PARAM_CHANNELS,\n\t\t\t\t\t &constraints_channels);\n\tif (ret < 0) {\n\t\tdev_err(rtd->dev, \"hw_constraint_list channel failed\\n\");\n\t\treturn ret;\n\t}\n\n\treturn 0;\n}\n\nstatic const struct snd_soc_ops mt8195_playback_ops = {\n\t.startup = mt8195_playback_startup,\n};\n\nstatic int mt8195_capture_startup(struct snd_pcm_substream *substream)\n{\n\tstatic const unsigned int rates[] = {\n\t\t48000\n\t};\n\tstatic const unsigned int channels[] = {\n\t\t1, 2\n\t};\n\tstatic const struct snd_pcm_hw_constraint_list constraints_rates = {\n\t\t.count = ARRAY_SIZE(rates),\n\t\t.list  = rates,\n\t\t.mask = 0,\n\t};\n\tstatic const struct snd_pcm_hw_constraint_list constraints_channels = {\n\t\t.count = ARRAY_SIZE(channels),\n\t\t.list  = channels,\n\t\t.mask = 0,\n\t};\n\n\tstruct snd_soc_pcm_runtime *rtd = asoc_substream_to_rtd(substream);\n\tstruct snd_pcm_runtime *runtime = substream->runtime;\n\tint ret;\n\n\tret = snd_pcm_hw_constraint_list(runtime, 0,\n\t\t\t\t\t SNDRV_PCM_HW_PARAM_RATE,\n\t\t\t\t\t &constraints_rates);\n\tif (ret < 0) {\n\t\tdev_err(rtd->dev, \"hw_constraint_list rate failed\\n\");\n\t\treturn ret;\n\t}\n\n\tret = snd_pcm_hw_constraint_list(runtime, 0,\n\t\t\t\t\t SNDRV_PCM_HW_PARAM_CHANNELS,\n\t\t\t\t\t &constraints_channels);\n\tif (ret < 0) {\n\t\tdev_err(rtd->dev, \"hw_constraint_list channel failed\\n\");\n\t\treturn ret;\n\t}\n\n\treturn 0;\n}\n\nstatic const struct snd_soc_ops mt8195_capture_ops = {\n\t.startup = mt8195_capture_startup,\n};\n\nstatic int mt8195_rt5682_etdm_hw_params(struct snd_pcm_substream *substream,\n\t\t\t\t\tstruct snd_pcm_hw_params *params)\n{\n\tstruct snd_soc_pcm_runtime *rtd = substream->private_data;\n\tstruct snd_soc_card *card = rtd->card;\n\tstruct snd_soc_dai *cpu_dai = asoc_rtd_to_cpu(rtd, 0);\n\tstruct snd_soc_dai *codec_dai = asoc_rtd_to_codec(rtd, 0);\n\tunsigned int rate = params_rate(params);\n\tint bitwidth;\n\tint ret;\n\n\tbitwidth = snd_pcm_format_width(params_format(params));\n\tif (bitwidth < 0) {\n\t\tdev_err(card->dev, \"invalid bit width: %d\\n\", bitwidth);\n\t\treturn bitwidth;\n\t}\n\n\tret = snd_soc_dai_set_tdm_slot(codec_dai, 0x00, 0x0, 0x2, bitwidth);\n\tif (ret) {\n\t\tdev_err(card->dev, \"failed to set tdm slot\\n\");\n\t\treturn ret;\n\t}\n\n\tret = snd_soc_dai_set_pll(codec_dai, RT5682_PLL1, RT5682_PLL1_S_MCLK,\n\t\t\t\t  rate * 256, rate * 512);\n\tif (ret) {\n\t\tdev_err(card->dev, \"failed to set pll\\n\");\n\t\treturn ret;\n\t}\n\n\tret = snd_soc_dai_set_sysclk(codec_dai, RT5682_SCLK_S_PLL1,\n\t\t\t\t     rate * 512, SND_SOC_CLOCK_IN);\n\tif (ret) {\n\t\tdev_err(card->dev, \"failed to set sysclk\\n\");\n\t\treturn ret;\n\t}\n\n\treturn snd_soc_dai_set_sysclk(cpu_dai, 0, rate * 256,\n\t\t\t\t      SND_SOC_CLOCK_OUT);\n}\n\nstatic const struct snd_soc_ops mt8195_rt5682_etdm_ops = {\n\t.hw_params = mt8195_rt5682_etdm_hw_params,\n};\n\nstatic int mt8195_rt5682_init(struct snd_soc_pcm_runtime *rtd)\n{\n\tstruct snd_soc_component *cmpnt_codec =\n\t\tasoc_rtd_to_codec(rtd, 0)->component;\n\tstruct mtk_soc_card_data *soc_card_data = snd_soc_card_get_drvdata(rtd->card);\n\tstruct mt8195_mt6359_priv *priv = soc_card_data->mach_priv;\n\tstruct snd_soc_jack *jack = &priv->headset_jack;\n\tstruct snd_soc_component *cmpnt_afe =\n\t\tsnd_soc_rtdcom_lookup(rtd, AFE_PCM_NAME);\n\tstruct mtk_base_afe *afe = snd_soc_component_get_drvdata(cmpnt_afe);\n\tstruct mt8195_afe_private *afe_priv = afe->platform_priv;\n\tint ret;\n\n\tpriv->i2so1_mclk = afe_priv->clk[MT8195_CLK_TOP_APLL12_DIV2];\n\n\tret = snd_soc_card_jack_new_pins(rtd->card, \"Headset Jack\",\n\t\t\t\t    SND_JACK_HEADSET | SND_JACK_BTN_0 |\n\t\t\t\t    SND_JACK_BTN_1 | SND_JACK_BTN_2 |\n\t\t\t\t    SND_JACK_BTN_3,\n\t\t\t\t    jack, mt8195_jack_pins,\n\t\t\t\t    ARRAY_SIZE(mt8195_jack_pins));\n\tif (ret) {\n\t\tdev_err(rtd->dev, \"Headset Jack creation failed: %d\\n\", ret);\n\t\treturn ret;\n\t}\n\n\tsnd_jack_set_key(jack->jack, SND_JACK_BTN_0, KEY_PLAYPAUSE);\n\tsnd_jack_set_key(jack->jack, SND_JACK_BTN_1, KEY_VOICECOMMAND);\n\tsnd_jack_set_key(jack->jack, SND_JACK_BTN_2, KEY_VOLUMEUP);\n\tsnd_jack_set_key(jack->jack, SND_JACK_BTN_3, KEY_VOLUMEDOWN);\n\n\tret = snd_soc_component_set_jack(cmpnt_codec, jack, NULL);\n\tif (ret) {\n\t\tdev_err(rtd->dev, \"Headset Jack set failed: %d\\n\", ret);\n\t\treturn ret;\n\t}\n\n\treturn 0;\n};\n\nstatic int mt8195_rt1011_etdm_hw_params(struct snd_pcm_substream *substream,\n\t\t\t\t\tstruct snd_pcm_hw_params *params)\n{\n\tstruct snd_soc_pcm_runtime *rtd = asoc_substream_to_rtd(substream);\n\tstruct snd_soc_dai *codec_dai;\n\tstruct snd_soc_card *card = rtd->card;\n\tint srate, i, ret;\n\n\tsrate = params_rate(params);\n\n\tfor_each_rtd_codec_dais(rtd, i, codec_dai) {\n\t\tret = snd_soc_dai_set_pll(codec_dai, 0, RT1011_PLL1_S_BCLK,\n\t\t\t\t\t  64 * srate, 256 * srate);\n\t\tif (ret < 0) {\n\t\t\tdev_err(card->dev, \"codec_dai clock not set\\n\");\n\t\t\treturn ret;\n\t\t}\n\n\t\tret = snd_soc_dai_set_sysclk(codec_dai,\n\t\t\t\t\t     RT1011_FS_SYS_PRE_S_PLL1,\n\t\t\t\t\t     256 * srate, SND_SOC_CLOCK_IN);\n\t\tif (ret < 0) {\n\t\t\tdev_err(card->dev, \"codec_dai clock not set\\n\");\n\t\t\treturn ret;\n\t\t}\n\t}\n\treturn 0;\n}\n\nstatic const struct snd_soc_ops mt8195_rt1011_etdm_ops = {\n\t.hw_params = mt8195_rt1011_etdm_hw_params,\n};\n\nstatic int mt8195_sof_be_hw_params(struct snd_pcm_substream *substream,\n\t\t\t\t   struct snd_pcm_hw_params *params)\n{\n\tstruct snd_soc_pcm_runtime *rtd = asoc_substream_to_rtd(substream);\n\tstruct snd_soc_component *cmpnt_afe = NULL;\n\tstruct snd_soc_pcm_runtime *runtime;\n\n\t \n\tfor_each_card_rtds(rtd->card, runtime) {\n\t\tcmpnt_afe = snd_soc_rtdcom_lookup(runtime, AFE_PCM_NAME);\n\t\tif (cmpnt_afe)\n\t\t\tbreak;\n\t}\n\n\tif (cmpnt_afe && !pm_runtime_active(cmpnt_afe->dev)) {\n\t\tdev_err(rtd->dev, \"afe pm runtime is not active!!\\n\");\n\t\treturn -EINVAL;\n\t}\n\n\treturn 0;\n}\n\nstatic const struct snd_soc_ops mt8195_sof_be_ops = {\n\t.hw_params = mt8195_sof_be_hw_params,\n};\n\nstatic int mt8195_rt1011_init(struct snd_soc_pcm_runtime *rtd)\n{\n\tstruct snd_soc_card *card = rtd->card;\n\tint ret;\n\n\tret = snd_soc_dapm_new_controls(&card->dapm, mt8195_dual_speaker_widgets,\n\t\t\t\t\tARRAY_SIZE(mt8195_dual_speaker_widgets));\n\tif (ret) {\n\t\tdev_err(rtd->dev, \"unable to add dapm controls, ret %d\\n\", ret);\n\t\t \n\t\treturn ret;\n\t}\n\n\tret = snd_soc_add_card_controls(card, mt8195_dual_speaker_controls,\n\t\t\t\t\tARRAY_SIZE(mt8195_dual_speaker_controls));\n\tif (ret) {\n\t\tdev_err(rtd->dev, \"unable to add card controls, ret %d\\n\", ret);\n\t\treturn ret;\n\t}\n\n\tret = snd_soc_dapm_add_routes(&card->dapm, mt8195_rt1011_routes,\n\t\t\t\t      ARRAY_SIZE(mt8195_rt1011_routes));\n\tif (ret)\n\t\tdev_err(rtd->dev, \"unable to add dapm routes, ret %d\\n\", ret);\n\n\treturn ret;\n}\n\nstatic int mt8195_rt1019_init(struct snd_soc_pcm_runtime *rtd)\n{\n\tstruct snd_soc_card *card = rtd->card;\n\tint ret;\n\n\tret = snd_soc_dapm_new_controls(&card->dapm, mt8195_speaker_widgets,\n\t\t\t\t\tARRAY_SIZE(mt8195_speaker_widgets));\n\tif (ret) {\n\t\tdev_err(rtd->dev, \"unable to add dapm controls, ret %d\\n\", ret);\n\t\t \n\t\treturn ret;\n\t}\n\n\tret = snd_soc_add_card_controls(card, mt8195_speaker_controls,\n\t\t\t\t\tARRAY_SIZE(mt8195_speaker_controls));\n\tif (ret) {\n\t\tdev_err(rtd->dev, \"unable to add card controls, ret %d\\n\", ret);\n\t\treturn ret;\n\t}\n\n\tret = snd_soc_dapm_add_routes(&card->dapm, mt8195_rt1019_routes,\n\t\t\t\t      ARRAY_SIZE(mt8195_rt1019_routes));\n\tif (ret)\n\t\tdev_err(rtd->dev, \"unable to add dapm routes, ret %d\\n\", ret);\n\n\treturn ret;\n}\n\nstatic int mt8195_max98390_init(struct snd_soc_pcm_runtime *rtd)\n{\n\tstruct snd_soc_card *card = rtd->card;\n\tint ret;\n\n\tret = snd_soc_dapm_new_controls(&card->dapm, mt8195_dual_speaker_widgets,\n\t\t\t\t\tARRAY_SIZE(mt8195_dual_speaker_widgets));\n\tif (ret) {\n\t\tdev_err(rtd->dev, \"unable to add dapm controls, ret %d\\n\", ret);\n\t\t \n\t\treturn ret;\n\t}\n\n\tret = snd_soc_add_card_controls(card, mt8195_dual_speaker_controls,\n\t\t\t\t\tARRAY_SIZE(mt8195_dual_speaker_controls));\n\tif (ret) {\n\t\tdev_err(rtd->dev, \"unable to add card controls, ret %d\\n\", ret);\n\t\treturn ret;\n\t}\n\n\tret = snd_soc_dapm_add_routes(&card->dapm, mt8195_max98390_routes,\n\t\t\t\t      ARRAY_SIZE(mt8195_max98390_routes));\n\tif (ret)\n\t\tdev_err(rtd->dev, \"unable to add dapm routes, ret %d\\n\", ret);\n\n\treturn ret;\n}\n\nstatic int mt8195_etdm_hw_params_fixup(struct snd_soc_pcm_runtime *rtd,\n\t\t\t\t       struct snd_pcm_hw_params *params)\n{\n\t \n\tsnd_mask_reset_range(hw_param_mask(params, SNDRV_PCM_HW_PARAM_FORMAT),\n\t\t\t     0, (__force unsigned int)SNDRV_PCM_FORMAT_LAST);\n\n\tparams_set_format(params, SNDRV_PCM_FORMAT_S24_LE);\n\n\treturn 0;\n}\n\nstatic int mt8195_set_bias_level_post(struct snd_soc_card *card,\n\tstruct snd_soc_dapm_context *dapm, enum snd_soc_bias_level level)\n{\n\tstruct snd_soc_component *component = dapm->component;\n\tstruct mtk_soc_card_data *soc_card_data = snd_soc_card_get_drvdata(card);\n\tstruct mt8195_mt6359_priv *priv = soc_card_data->mach_priv;\n\tint ret;\n\n\t \n\tif (!component ||\n\t    (strcmp(component->name, RT5682_DEV0_NAME) &&\n\t    strcmp(component->name, RT5682S_DEV0_NAME)))\n\t\treturn 0;\n\n\tswitch (level) {\n\tcase SND_SOC_BIAS_OFF:\n\t\tif (!__clk_is_enabled(priv->i2so1_mclk))\n\t\t\treturn 0;\n\n\t\tclk_disable_unprepare(priv->i2so1_mclk);\n\t\tdev_dbg(card->dev, \"Disable i2so1 mclk\\n\");\n\t\tbreak;\n\tcase SND_SOC_BIAS_ON:\n\t\tret = clk_prepare_enable(priv->i2so1_mclk);\n\t\tif (ret) {\n\t\t\tdev_err(card->dev, \"Can't enable i2so1 mclk: %d\\n\", ret);\n\t\t\treturn ret;\n\t\t}\n\t\tdev_dbg(card->dev, \"Enable i2so1 mclk\\n\");\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n\n\treturn 0;\n}\n\nenum {\n\tDAI_LINK_DL2_FE,\n\tDAI_LINK_DL3_FE,\n\tDAI_LINK_DL6_FE,\n\tDAI_LINK_DL7_FE,\n\tDAI_LINK_DL8_FE,\n\tDAI_LINK_DL10_FE,\n\tDAI_LINK_DL11_FE,\n\tDAI_LINK_UL1_FE,\n\tDAI_LINK_UL2_FE,\n\tDAI_LINK_UL3_FE,\n\tDAI_LINK_UL4_FE,\n\tDAI_LINK_UL5_FE,\n\tDAI_LINK_UL6_FE,\n\tDAI_LINK_UL8_FE,\n\tDAI_LINK_UL9_FE,\n\tDAI_LINK_UL10_FE,\n\tDAI_LINK_DL_SRC_BE,\n\tDAI_LINK_DPTX_BE,\n\tDAI_LINK_ETDM1_IN_BE,\n\tDAI_LINK_ETDM2_IN_BE,\n\tDAI_LINK_ETDM1_OUT_BE,\n\tDAI_LINK_ETDM2_OUT_BE,\n\tDAI_LINK_ETDM3_OUT_BE,\n\tDAI_LINK_PCM1_BE,\n\tDAI_LINK_UL_SRC1_BE,\n\tDAI_LINK_UL_SRC2_BE,\n\tDAI_LINK_REGULAR_LAST = DAI_LINK_UL_SRC2_BE,\n\tDAI_LINK_SOF_START,\n\tDAI_LINK_SOF_DL2_BE = DAI_LINK_SOF_START,\n\tDAI_LINK_SOF_DL3_BE,\n\tDAI_LINK_SOF_UL4_BE,\n\tDAI_LINK_SOF_UL5_BE,\n\tDAI_LINK_SOF_END = DAI_LINK_SOF_UL5_BE,\n};\n\n#define\tDAI_LINK_REGULAR_NUM\t(DAI_LINK_REGULAR_LAST + 1)\n\n \nSND_SOC_DAILINK_DEFS(DL2_FE,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"DL2\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(DL3_FE,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"DL3\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(DL6_FE,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"DL6\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(DL7_FE,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"DL7\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(DL8_FE,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"DL8\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(DL10_FE,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"DL10\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(DL11_FE,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"DL11\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(UL1_FE,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"UL1\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(UL2_FE,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"UL2\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(UL3_FE,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"UL3\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(UL4_FE,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"UL4\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(UL5_FE,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"UL5\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(UL6_FE,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"UL6\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(UL8_FE,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"UL8\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(UL9_FE,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"UL9\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(UL10_FE,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"UL10\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\n \nSND_SOC_DAILINK_DEFS(DL_SRC_BE,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"DL_SRC\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_CODEC(\"mt6359-sound\",\n\t\t\t\t\t\t   \"mt6359-snd-codec-aif1\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(DPTX_BE,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"DPTX\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(ETDM1_IN_BE,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"ETDM1_IN\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(ETDM2_IN_BE,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"ETDM2_IN\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(ETDM1_OUT_BE,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"ETDM1_OUT\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(ETDM2_OUT_BE,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"ETDM2_OUT\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(ETDM3_OUT_BE,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"ETDM3_OUT\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(PCM1_BE,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"PCM1\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(UL_SRC1_BE,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"UL_SRC1\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_CODEC(\"mt6359-sound\",\n\t\t\t\t\t\t   \"mt6359-snd-codec-aif1\"),\n\t\t\t\t\tCOMP_CODEC(\"dmic-codec\",\n\t\t\t\t\t\t   \"dmic-hifi\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(UL_SRC2_BE,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"UL_SRC2\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_CODEC(\"mt6359-sound\",\n\t\t\t\t\t\t   \"mt6359-snd-codec-aif2\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(AFE_SOF_DL2,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"SOF_DL2\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(AFE_SOF_DL3,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"SOF_DL3\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(AFE_SOF_UL4,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"SOF_UL4\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\nSND_SOC_DAILINK_DEFS(AFE_SOF_UL5,\n\t\t     DAILINK_COMP_ARRAY(COMP_CPU(\"SOF_UL5\")),\n\t\t     DAILINK_COMP_ARRAY(COMP_DUMMY()),\n\t\t     DAILINK_COMP_ARRAY(COMP_EMPTY()));\n\n \nSND_SOC_DAILINK_DEF(rt1019_comps,\n\t\t    DAILINK_COMP_ARRAY(COMP_CODEC(RT1019_DEV0_NAME,\n\t\t\t\t\t\t  RT1019_CODEC_DAI)));\n\nSND_SOC_DAILINK_DEF(rt1011_comps,\n\t\t    DAILINK_COMP_ARRAY(COMP_CODEC(RT1011_DEV0_NAME,\n\t\t\t\t\t\t  RT1011_CODEC_DAI),\n\t\t\t\t       COMP_CODEC(RT1011_DEV1_NAME,\n\t\t\t\t\t\t  RT1011_CODEC_DAI)));\n\nSND_SOC_DAILINK_DEF(max98390_comps,\n\t\t    DAILINK_COMP_ARRAY(COMP_CODEC(MAX98390_DEV0_NAME,\n\t\t\t\t\t\t  MAX98390_CODEC_DAI),\n\t\t\t\t       COMP_CODEC(MAX98390_DEV1_NAME,\n\t\t\t\t\t\t  MAX98390_CODEC_DAI)));\n\nstatic const struct sof_conn_stream g_sof_conn_streams[] = {\n\t{ \"ETDM2_OUT_BE\", \"AFE_SOF_DL2\", SOF_DMA_DL2, SNDRV_PCM_STREAM_PLAYBACK},\n\t{ \"ETDM1_OUT_BE\", \"AFE_SOF_DL3\", SOF_DMA_DL3, SNDRV_PCM_STREAM_PLAYBACK},\n\t{ \"UL_SRC1_BE\", \"AFE_SOF_UL4\", SOF_DMA_UL4, SNDRV_PCM_STREAM_CAPTURE},\n\t{ \"ETDM2_IN_BE\", \"AFE_SOF_UL5\", SOF_DMA_UL5, SNDRV_PCM_STREAM_CAPTURE},\n};\n\nstatic struct snd_soc_dai_link mt8195_mt6359_dai_links[] = {\n\t \n\t[DAI_LINK_DL2_FE] = {\n\t\t.name = \"DL2_FE\",\n\t\t.stream_name = \"DL2 Playback\",\n\t\t.trigger = {\n\t\t\tSND_SOC_DPCM_TRIGGER_POST,\n\t\t\tSND_SOC_DPCM_TRIGGER_POST,\n\t\t},\n\t\t.dynamic = 1,\n\t\t.dpcm_playback = 1,\n\t\t.ops = &mt8195_playback_ops,\n\t\tSND_SOC_DAILINK_REG(DL2_FE),\n\t},\n\t[DAI_LINK_DL3_FE] = {\n\t\t.name = \"DL3_FE\",\n\t\t.stream_name = \"DL3 Playback\",\n\t\t.trigger = {\n\t\t\tSND_SOC_DPCM_TRIGGER_POST,\n\t\t\tSND_SOC_DPCM_TRIGGER_POST,\n\t\t},\n\t\t.dynamic = 1,\n\t\t.dpcm_playback = 1,\n\t\t.ops = &mt8195_playback_ops,\n\t\tSND_SOC_DAILINK_REG(DL3_FE),\n\t},\n\t[DAI_LINK_DL6_FE] = {\n\t\t.name = \"DL6_FE\",\n\t\t.stream_name = \"DL6 Playback\",\n\t\t.trigger = {\n\t\t\tSND_SOC_DPCM_TRIGGER_POST,\n\t\t\tSND_SOC_DPCM_TRIGGER_POST,\n\t\t},\n\t\t.dynamic = 1,\n\t\t.dpcm_playback = 1,\n\t\t.ops = &mt8195_playback_ops,\n\t\tSND_SOC_DAILINK_REG(DL6_FE),\n\t},\n\t[DAI_LINK_DL7_FE] = {\n\t\t.name = \"DL7_FE\",\n\t\t.stream_name = \"DL7 Playback\",\n\t\t.trigger = {\n\t\t\tSND_SOC_DPCM_TRIGGER_PRE,\n\t\t\tSND_SOC_DPCM_TRIGGER_PRE,\n\t\t},\n\t\t.dynamic = 1,\n\t\t.dpcm_playback = 1,\n\t\tSND_SOC_DAILINK_REG(DL7_FE),\n\t},\n\t[DAI_LINK_DL8_FE] = {\n\t\t.name = \"DL8_FE\",\n\t\t.stream_name = \"DL8 Playback\",\n\t\t.trigger = {\n\t\t\tSND_SOC_DPCM_TRIGGER_POST,\n\t\t\tSND_SOC_DPCM_TRIGGER_POST,\n\t\t},\n\t\t.dynamic = 1,\n\t\t.dpcm_playback = 1,\n\t\t.ops = &mt8195_playback_ops,\n\t\tSND_SOC_DAILINK_REG(DL8_FE),\n\t},\n\t[DAI_LINK_DL10_FE] = {\n\t\t.name = \"DL10_FE\",\n\t\t.stream_name = \"DL10 Playback\",\n\t\t.trigger = {\n\t\t\tSND_SOC_DPCM_TRIGGER_POST,\n\t\t\tSND_SOC_DPCM_TRIGGER_POST,\n\t\t},\n\t\t.dynamic = 1,\n\t\t.dpcm_playback = 1,\n\t\t.ops = &mt8195_hdmitx_dptx_playback_ops,\n\t\tSND_SOC_DAILINK_REG(DL10_FE),\n\t},\n\t[DAI_LINK_DL11_FE] = {\n\t\t.name = \"DL11_FE\",\n\t\t.stream_name = \"DL11 Playback\",\n\t\t.trigger = {\n\t\t\tSND_SOC_DPCM_TRIGGER_POST,\n\t\t\tSND_SOC_DPCM_TRIGGER_POST,\n\t\t},\n\t\t.dynamic = 1,\n\t\t.dpcm_playback = 1,\n\t\t.ops = &mt8195_playback_ops,\n\t\tSND_SOC_DAILINK_REG(DL11_FE),\n\t},\n\t[DAI_LINK_UL1_FE] = {\n\t\t.name = \"UL1_FE\",\n\t\t.stream_name = \"UL1 Capture\",\n\t\t.trigger = {\n\t\t\tSND_SOC_DPCM_TRIGGER_PRE,\n\t\t\tSND_SOC_DPCM_TRIGGER_PRE,\n\t\t},\n\t\t.dynamic = 1,\n\t\t.dpcm_capture = 1,\n\t\tSND_SOC_DAILINK_REG(UL1_FE),\n\t},\n\t[DAI_LINK_UL2_FE] = {\n\t\t.name = \"UL2_FE\",\n\t\t.stream_name = \"UL2 Capture\",\n\t\t.trigger = {\n\t\t\tSND_SOC_DPCM_TRIGGER_POST,\n\t\t\tSND_SOC_DPCM_TRIGGER_POST,\n\t\t},\n\t\t.dynamic = 1,\n\t\t.dpcm_capture = 1,\n\t\t.ops = &mt8195_capture_ops,\n\t\tSND_SOC_DAILINK_REG(UL2_FE),\n\t},\n\t[DAI_LINK_UL3_FE] = {\n\t\t.name = \"UL3_FE\",\n\t\t.stream_name = \"UL3 Capture\",\n\t\t.trigger = {\n\t\t\tSND_SOC_DPCM_TRIGGER_POST,\n\t\t\tSND_SOC_DPCM_TRIGGER_POST,\n\t\t},\n\t\t.dynamic = 1,\n\t\t.dpcm_capture = 1,\n\t\t.ops = &mt8195_capture_ops,\n\t\tSND_SOC_DAILINK_REG(UL3_FE),\n\t},\n\t[DAI_LINK_UL4_FE] = {\n\t\t.name = \"UL4_FE\",\n\t\t.stream_name = \"UL4 Capture\",\n\t\t.trigger = {\n\t\t\tSND_SOC_DPCM_TRIGGER_POST,\n\t\t\tSND_SOC_DPCM_TRIGGER_POST,\n\t\t},\n\t\t.dynamic = 1,\n\t\t.dpcm_capture = 1,\n\t\t.ops = &mt8195_capture_ops,\n\t\tSND_SOC_DAILINK_REG(UL4_FE),\n\t},\n\t[DAI_LINK_UL5_FE] = {\n\t\t.name = \"UL5_FE\",\n\t\t.stream_name = \"UL5 Capture\",\n\t\t.trigger = {\n\t\t\tSND_SOC_DPCM_TRIGGER_POST,\n\t\t\tSND_SOC_DPCM_TRIGGER_POST,\n\t\t},\n\t\t.dynamic = 1,\n\t\t.dpcm_capture = 1,\n\t\t.ops = &mt8195_capture_ops,\n\t\tSND_SOC_DAILINK_REG(UL5_FE),\n\t},\n\t[DAI_LINK_UL6_FE] = {\n\t\t.name = \"UL6_FE\",\n\t\t.stream_name = \"UL6 Capture\",\n\t\t.trigger = {\n\t\t\tSND_SOC_DPCM_TRIGGER_PRE,\n\t\t\tSND_SOC_DPCM_TRIGGER_PRE,\n\t\t},\n\t\t.dynamic = 1,\n\t\t.dpcm_capture = 1,\n\t\tSND_SOC_DAILINK_REG(UL6_FE),\n\t},\n\t[DAI_LINK_UL8_FE] = {\n\t\t.name = \"UL8_FE\",\n\t\t.stream_name = \"UL8 Capture\",\n\t\t.trigger = {\n\t\t\tSND_SOC_DPCM_TRIGGER_POST,\n\t\t\tSND_SOC_DPCM_TRIGGER_POST,\n\t\t},\n\t\t.dynamic = 1,\n\t\t.dpcm_capture = 1,\n\t\t.ops = &mt8195_capture_ops,\n\t\tSND_SOC_DAILINK_REG(UL8_FE),\n\t},\n\t[DAI_LINK_UL9_FE] = {\n\t\t.name = \"UL9_FE\",\n\t\t.stream_name = \"UL9 Capture\",\n\t\t.trigger = {\n\t\t\tSND_SOC_DPCM_TRIGGER_POST,\n\t\t\tSND_SOC_DPCM_TRIGGER_POST,\n\t\t},\n\t\t.dynamic = 1,\n\t\t.dpcm_capture = 1,\n\t\t.ops = &mt8195_capture_ops,\n\t\tSND_SOC_DAILINK_REG(UL9_FE),\n\t},\n\t[DAI_LINK_UL10_FE] = {\n\t\t.name = \"UL10_FE\",\n\t\t.stream_name = \"UL10 Capture\",\n\t\t.trigger = {\n\t\t\tSND_SOC_DPCM_TRIGGER_POST,\n\t\t\tSND_SOC_DPCM_TRIGGER_POST,\n\t\t},\n\t\t.dynamic = 1,\n\t\t.dpcm_capture = 1,\n\t\t.ops = &mt8195_capture_ops,\n\t\tSND_SOC_DAILINK_REG(UL10_FE),\n\t},\n\t \n\t[DAI_LINK_DL_SRC_BE] = {\n\t\t.name = \"DL_SRC_BE\",\n\t\t.no_pcm = 1,\n\t\t.dpcm_playback = 1,\n\t\tSND_SOC_DAILINK_REG(DL_SRC_BE),\n\t},\n\t[DAI_LINK_DPTX_BE] = {\n\t\t.name = \"DPTX_BE\",\n\t\t.no_pcm = 1,\n\t\t.dpcm_playback = 1,\n\t\t.ops = &mt8195_dptx_ops,\n\t\t.be_hw_params_fixup = mt8195_dptx_hw_params_fixup,\n\t\tSND_SOC_DAILINK_REG(DPTX_BE),\n\t},\n\t[DAI_LINK_ETDM1_IN_BE] = {\n\t\t.name = \"ETDM1_IN_BE\",\n\t\t.no_pcm = 1,\n\t\t.dai_fmt = SND_SOC_DAIFMT_I2S |\n\t\t\tSND_SOC_DAIFMT_NB_NF |\n\t\t\tSND_SOC_DAIFMT_CBS_CFS,\n\t\t.dpcm_capture = 1,\n\t\tSND_SOC_DAILINK_REG(ETDM1_IN_BE),\n\t},\n\t[DAI_LINK_ETDM2_IN_BE] = {\n\t\t.name = \"ETDM2_IN_BE\",\n\t\t.no_pcm = 1,\n\t\t.dai_fmt = SND_SOC_DAIFMT_I2S |\n\t\t\tSND_SOC_DAIFMT_NB_NF |\n\t\t\tSND_SOC_DAIFMT_CBS_CFS,\n\t\t.dpcm_capture = 1,\n\t\t.init = mt8195_rt5682_init,\n\t\t.ops = &mt8195_rt5682_etdm_ops,\n\t\t.be_hw_params_fixup = mt8195_etdm_hw_params_fixup,\n\t\tSND_SOC_DAILINK_REG(ETDM2_IN_BE),\n\t},\n\t[DAI_LINK_ETDM1_OUT_BE] = {\n\t\t.name = \"ETDM1_OUT_BE\",\n\t\t.no_pcm = 1,\n\t\t.dai_fmt = SND_SOC_DAIFMT_I2S |\n\t\t\tSND_SOC_DAIFMT_NB_NF |\n\t\t\tSND_SOC_DAIFMT_CBS_CFS,\n\t\t.dpcm_playback = 1,\n\t\t.ops = &mt8195_rt5682_etdm_ops,\n\t\t.be_hw_params_fixup = mt8195_etdm_hw_params_fixup,\n\t\tSND_SOC_DAILINK_REG(ETDM1_OUT_BE),\n\t},\n\t[DAI_LINK_ETDM2_OUT_BE] = {\n\t\t.name = \"ETDM2_OUT_BE\",\n\t\t.no_pcm = 1,\n\t\t.dai_fmt = SND_SOC_DAIFMT_I2S |\n\t\t\tSND_SOC_DAIFMT_NB_NF |\n\t\t\tSND_SOC_DAIFMT_CBS_CFS,\n\t\t.dpcm_playback = 1,\n\t\tSND_SOC_DAILINK_REG(ETDM2_OUT_BE),\n\t},\n\t[DAI_LINK_ETDM3_OUT_BE] = {\n\t\t.name = \"ETDM3_OUT_BE\",\n\t\t.no_pcm = 1,\n\t\t.dai_fmt = SND_SOC_DAIFMT_I2S |\n\t\t\tSND_SOC_DAIFMT_NB_NF |\n\t\t\tSND_SOC_DAIFMT_CBS_CFS,\n\t\t.dpcm_playback = 1,\n\t\tSND_SOC_DAILINK_REG(ETDM3_OUT_BE),\n\t},\n\t[DAI_LINK_PCM1_BE] = {\n\t\t.name = \"PCM1_BE\",\n\t\t.no_pcm = 1,\n\t\t.dai_fmt = SND_SOC_DAIFMT_I2S |\n\t\t\tSND_SOC_DAIFMT_NB_NF |\n\t\t\tSND_SOC_DAIFMT_CBS_CFS,\n\t\t.dpcm_playback = 1,\n\t\t.dpcm_capture = 1,\n\t\tSND_SOC_DAILINK_REG(PCM1_BE),\n\t},\n\t[DAI_LINK_UL_SRC1_BE] = {\n\t\t.name = \"UL_SRC1_BE\",\n\t\t.no_pcm = 1,\n\t\t.dpcm_capture = 1,\n\t\tSND_SOC_DAILINK_REG(UL_SRC1_BE),\n\t},\n\t[DAI_LINK_UL_SRC2_BE] = {\n\t\t.name = \"UL_SRC2_BE\",\n\t\t.no_pcm = 1,\n\t\t.dpcm_capture = 1,\n\t\tSND_SOC_DAILINK_REG(UL_SRC2_BE),\n\t},\n\t \n\t[DAI_LINK_SOF_DL2_BE] = {\n\t\t.name = \"AFE_SOF_DL2\",\n\t\t.no_pcm = 1,\n\t\t.dpcm_playback = 1,\n\t\t.ops = &mt8195_sof_be_ops,\n\t\tSND_SOC_DAILINK_REG(AFE_SOF_DL2),\n\t},\n\t[DAI_LINK_SOF_DL3_BE] = {\n\t\t.name = \"AFE_SOF_DL3\",\n\t\t.no_pcm = 1,\n\t\t.dpcm_playback = 1,\n\t\t.ops = &mt8195_sof_be_ops,\n\t\tSND_SOC_DAILINK_REG(AFE_SOF_DL3),\n\t},\n\t[DAI_LINK_SOF_UL4_BE] = {\n\t\t.name = \"AFE_SOF_UL4\",\n\t\t.no_pcm = 1,\n\t\t.dpcm_capture = 1,\n\t\t.ops = &mt8195_sof_be_ops,\n\t\tSND_SOC_DAILINK_REG(AFE_SOF_UL4),\n\t},\n\t[DAI_LINK_SOF_UL5_BE] = {\n\t\t.name = \"AFE_SOF_UL5\",\n\t\t.no_pcm = 1,\n\t\t.dpcm_capture = 1,\n\t\t.ops = &mt8195_sof_be_ops,\n\t\tSND_SOC_DAILINK_REG(AFE_SOF_UL5),\n\t},\n};\n\nstatic struct snd_soc_codec_conf rt1011_codec_conf[] = {\n\t{\n\t\t.dlc = COMP_CODEC_CONF(RT1011_DEV0_NAME),\n\t\t.name_prefix = \"Left\",\n\t},\n\t{\n\t\t.dlc = COMP_CODEC_CONF(RT1011_DEV1_NAME),\n\t\t.name_prefix = \"Right\",\n\t},\n};\n\nstatic struct snd_soc_codec_conf max98390_codec_conf[] = {\n\t{\n\t\t.dlc = COMP_CODEC_CONF(MAX98390_DEV0_NAME),\n\t\t.name_prefix = \"Right\",\n\t},\n\t{\n\t\t.dlc = COMP_CODEC_CONF(MAX98390_DEV1_NAME),\n\t\t.name_prefix = \"Left\",\n\t},\n};\n\nstatic struct snd_soc_card mt8195_mt6359_soc_card = {\n\t.owner = THIS_MODULE,\n\t.dai_link = mt8195_mt6359_dai_links,\n\t.num_links = ARRAY_SIZE(mt8195_mt6359_dai_links),\n\t.controls = mt8195_mt6359_controls,\n\t.num_controls = ARRAY_SIZE(mt8195_mt6359_controls),\n\t.dapm_widgets = mt8195_mt6359_widgets,\n\t.num_dapm_widgets = ARRAY_SIZE(mt8195_mt6359_widgets),\n\t.dapm_routes = mt8195_mt6359_routes,\n\t.num_dapm_routes = ARRAY_SIZE(mt8195_mt6359_routes),\n\t.set_bias_level_post = mt8195_set_bias_level_post,\n};\n\n \nstatic int mt8195_dai_link_fixup(struct snd_soc_pcm_runtime *rtd,\n\t\t\t\t struct snd_pcm_hw_params *params)\n{\n\tint ret;\n\n\tret = mtk_sof_dai_link_fixup(rtd, params);\n\n\tif (!strcmp(rtd->dai_link->name, \"ETDM2_IN_BE\") ||\n\t    !strcmp(rtd->dai_link->name, \"ETDM1_OUT_BE\")) {\n\t\tmt8195_etdm_hw_params_fixup(rtd, params);\n\t}\n\n\treturn ret;\n}\n\nstatic int mt8195_mt6359_dev_probe(struct platform_device *pdev)\n{\n\tstruct snd_soc_card *card = &mt8195_mt6359_soc_card;\n\tstruct snd_soc_dai_link *dai_link;\n\tstruct mtk_soc_card_data *soc_card_data;\n\tstruct mt8195_mt6359_priv *mach_priv;\n\tstruct device_node *platform_node, *adsp_node, *dp_node, *hdmi_node;\n\tstruct mt8195_card_data *card_data;\n\tint is5682s = 0;\n\tint init6359 = 0;\n\tint sof_on = 0;\n\tint ret, i;\n\n\tcard_data = (struct mt8195_card_data *)of_device_get_match_data(&pdev->dev);\n\tcard->dev = &pdev->dev;\n\n\tret = snd_soc_of_parse_card_name(card, \"model\");\n\tif (ret) {\n\t\tdev_err(&pdev->dev, \"%s new card name parsing error %d\\n\",\n\t\t\t__func__, ret);\n\t\treturn ret;\n\t}\n\n\tif (!card->name)\n\t\tcard->name = card_data->name;\n\n\tif (strstr(card->name, \"_5682s\"))\n\t\tis5682s = 1;\n\tsoc_card_data = devm_kzalloc(&pdev->dev, sizeof(*card_data), GFP_KERNEL);\n\tif (!soc_card_data)\n\t\treturn -ENOMEM;\n\n\tmach_priv = devm_kzalloc(&pdev->dev, sizeof(*mach_priv), GFP_KERNEL);\n\tif (!mach_priv)\n\t\treturn -ENOMEM;\n\n\tsoc_card_data->mach_priv = mach_priv;\n\n\tadsp_node = of_parse_phandle(pdev->dev.of_node, \"mediatek,adsp\", 0);\n\tif (adsp_node) {\n\t\tstruct mtk_sof_priv *sof_priv;\n\n\t\tsof_priv = devm_kzalloc(&pdev->dev, sizeof(*sof_priv), GFP_KERNEL);\n\t\tif (!sof_priv) {\n\t\t\tret = -ENOMEM;\n\t\t\tgoto err_kzalloc;\n\t\t}\n\t\tsof_priv->conn_streams = g_sof_conn_streams;\n\t\tsof_priv->num_streams = ARRAY_SIZE(g_sof_conn_streams);\n\t\tsof_priv->sof_dai_link_fixup = mt8195_dai_link_fixup;\n\t\tsoc_card_data->sof_priv = sof_priv;\n\t\tcard->probe = mtk_sof_card_probe;\n\t\tcard->late_probe = mtk_sof_card_late_probe;\n\t\tif (!card->topology_shortname_created) {\n\t\t\tsnprintf(card->topology_shortname, 32, \"sof-%s\", card->name);\n\t\t\tcard->topology_shortname_created = true;\n\t\t}\n\t\tcard->name = card->topology_shortname;\n\t\tsof_on = 1;\n\t}\n\n\tif (of_property_read_bool(pdev->dev.of_node, \"mediatek,dai-link\")) {\n\t\tret = mtk_sof_dailink_parse_of(card, pdev->dev.of_node,\n\t\t\t\t\t       \"mediatek,dai-link\",\n\t\t\t\t\t       mt8195_mt6359_dai_links,\n\t\t\t\t\t       ARRAY_SIZE(mt8195_mt6359_dai_links));\n\t\tif (ret) {\n\t\t\tdev_dbg(&pdev->dev, \"Parse dai-link fail\\n\");\n\t\t\tgoto err_parse_of;\n\t\t}\n\t} else {\n\t\tif (!sof_on)\n\t\t\tcard->num_links = DAI_LINK_REGULAR_NUM;\n\t}\n\n\tplatform_node = of_parse_phandle(pdev->dev.of_node,\n\t\t\t\t\t \"mediatek,platform\", 0);\n\tif (!platform_node) {\n\t\tdev_dbg(&pdev->dev, \"Property 'platform' missing or invalid\\n\");\n\t\tret = -EINVAL;\n\t\tgoto err_platform_node;\n\t}\n\n\tdp_node = of_parse_phandle(pdev->dev.of_node, \"mediatek,dptx-codec\", 0);\n\thdmi_node = of_parse_phandle(pdev->dev.of_node,\n\t\t\t\t     \"mediatek,hdmi-codec\", 0);\n\n\tfor_each_card_prelinks(card, i, dai_link) {\n\t\tif (!dai_link->platforms->name) {\n\t\t\tif (!strncmp(dai_link->name, \"AFE_SOF\", strlen(\"AFE_SOF\")) && sof_on)\n\t\t\t\tdai_link->platforms->of_node = adsp_node;\n\t\t\telse\n\t\t\t\tdai_link->platforms->of_node = platform_node;\n\t\t}\n\n\t\tif (strcmp(dai_link->name, \"DPTX_BE\") == 0) {\n\t\t\tif (!dp_node) {\n\t\t\t\tdev_dbg(&pdev->dev, \"No property 'dptx-codec'\\n\");\n\t\t\t} else {\n\t\t\t\tdai_link->codecs->of_node = dp_node;\n\t\t\t\tdai_link->codecs->name = NULL;\n\t\t\t\tdai_link->codecs->dai_name = \"i2s-hifi\";\n\t\t\t\tdai_link->init = mt8195_dptx_codec_init;\n\t\t\t}\n\t\t} else if (strcmp(dai_link->name, \"ETDM3_OUT_BE\") == 0) {\n\t\t\tif (!hdmi_node) {\n\t\t\t\tdev_dbg(&pdev->dev, \"No property 'hdmi-codec'\\n\");\n\t\t\t} else {\n\t\t\t\tdai_link->codecs->of_node = hdmi_node;\n\t\t\t\tdai_link->codecs->name = NULL;\n\t\t\t\tdai_link->codecs->dai_name = \"i2s-hifi\";\n\t\t\t\tdai_link->init = mt8195_hdmi_codec_init;\n\t\t\t}\n\t\t} else if (strcmp(dai_link->name, \"ETDM1_OUT_BE\") == 0 ||\n\t\t\t   strcmp(dai_link->name, \"ETDM2_IN_BE\") == 0) {\n\t\t\tdai_link->codecs->name =\n\t\t\t\tis5682s ? RT5682S_DEV0_NAME : RT5682_DEV0_NAME;\n\t\t\tdai_link->codecs->dai_name =\n\t\t\t\tis5682s ? RT5682S_CODEC_DAI : RT5682_CODEC_DAI;\n\t\t} else if (strcmp(dai_link->name, \"DL_SRC_BE\") == 0 ||\n\t\t\t   strcmp(dai_link->name, \"UL_SRC1_BE\") == 0 ||\n\t\t\t   strcmp(dai_link->name, \"UL_SRC2_BE\") == 0) {\n\t\t\tif (!init6359) {\n\t\t\t\tdai_link->init = mt8195_mt6359_init;\n\t\t\t\tinit6359 = 1;\n\t\t\t}\n\t\t} else if (strcmp(dai_link->name, \"ETDM2_OUT_BE\") == 0) {\n\t\t\tswitch (card_data->quirk) {\n\t\t\tcase RT1011_SPEAKER_AMP_PRESENT:\n\t\t\t\tdai_link->codecs = rt1011_comps;\n\t\t\t\tdai_link->num_codecs = ARRAY_SIZE(rt1011_comps);\n\t\t\t\tdai_link->init = mt8195_rt1011_init;\n\t\t\t\tdai_link->ops = &mt8195_rt1011_etdm_ops;\n\t\t\t\tdai_link->be_hw_params_fixup = mt8195_etdm_hw_params_fixup;\n\t\t\t\tcard->codec_conf = rt1011_codec_conf;\n\t\t\t\tcard->num_configs = ARRAY_SIZE(rt1011_codec_conf);\n\t\t\t\tbreak;\n\t\t\tcase RT1019_SPEAKER_AMP_PRESENT:\n\t\t\t\tdai_link->codecs = rt1019_comps;\n\t\t\t\tdai_link->num_codecs = ARRAY_SIZE(rt1019_comps);\n\t\t\t\tdai_link->init = mt8195_rt1019_init;\n\t\t\t\tbreak;\n\t\t\tcase MAX98390_SPEAKER_AMP_PRESENT:\n\t\t\t\tdai_link->codecs = max98390_comps;\n\t\t\t\tdai_link->num_codecs = ARRAY_SIZE(max98390_comps);\n\t\t\t\tdai_link->init = mt8195_max98390_init;\n\t\t\t\tcard->codec_conf = max98390_codec_conf;\n\t\t\t\tcard->num_configs = ARRAY_SIZE(max98390_codec_conf);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tsnd_soc_card_set_drvdata(card, soc_card_data);\n\n\tret = devm_snd_soc_register_card(&pdev->dev, card);\n\n\tof_node_put(platform_node);\n\tof_node_put(dp_node);\n\tof_node_put(hdmi_node);\nerr_kzalloc:\nerr_parse_of:\nerr_platform_node:\n\tof_node_put(adsp_node);\n\treturn ret;\n}\n\nstatic struct mt8195_card_data mt8195_mt6359_rt1019_rt5682_card = {\n\t.name = \"mt8195_r1019_5682\",\n\t.quirk = RT1019_SPEAKER_AMP_PRESENT,\n};\n\nstatic struct mt8195_card_data mt8195_mt6359_rt1011_rt5682_card = {\n\t.name = \"mt8195_r1011_5682\",\n\t.quirk = RT1011_SPEAKER_AMP_PRESENT,\n};\n\nstatic struct mt8195_card_data mt8195_mt6359_max98390_rt5682_card = {\n\t.name = \"mt8195_m98390_r5682\",\n\t.quirk = MAX98390_SPEAKER_AMP_PRESENT,\n};\n\nstatic const struct of_device_id mt8195_mt6359_dt_match[] = {\n\t{\n\t\t.compatible = \"mediatek,mt8195_mt6359_rt1019_rt5682\",\n\t\t.data = &mt8195_mt6359_rt1019_rt5682_card,\n\t},\n\t{\n\t\t.compatible = \"mediatek,mt8195_mt6359_rt1011_rt5682\",\n\t\t.data = &mt8195_mt6359_rt1011_rt5682_card,\n\t},\n\t{\n\t\t.compatible = \"mediatek,mt8195_mt6359_max98390_rt5682\",\n\t\t.data = &mt8195_mt6359_max98390_rt5682_card,\n\t},\n\t{},\n};\nMODULE_DEVICE_TABLE(of, mt8195_mt6359_dt_match);\n\nstatic struct platform_driver mt8195_mt6359_driver = {\n\t.driver = {\n\t\t.name = \"mt8195_mt6359\",\n\t\t.of_match_table = mt8195_mt6359_dt_match,\n\t\t.pm = &snd_soc_pm_ops,\n\t},\n\t.probe = mt8195_mt6359_dev_probe,\n};\n\nmodule_platform_driver(mt8195_mt6359_driver);\n\n \nMODULE_DESCRIPTION(\"MT8195-MT6359 ALSA SoC machine driver\");\nMODULE_AUTHOR(\"Trevor Wu <trevor.wu@mediatek.com>\");\nMODULE_AUTHOR(\"YC Hung <yc.hung@mediatek.com>\");\nMODULE_LICENSE(\"GPL\");\nMODULE_ALIAS(\"mt8195_mt6359 soc card\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}