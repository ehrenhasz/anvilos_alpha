{
  "module_name": "soc-link.c",
  "hash_id": "4f2994cbeb34f5539bade00a35527fed790aec20aa67be3d46e53dfd9f782336",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/soc-link.c",
  "human_readable_source": "\n\n\n\n\n\n\n#include <sound/soc.h>\n#include <sound/soc-link.h>\n\n#define soc_link_ret(rtd, ret) _soc_link_ret(rtd, __func__, ret)\nstatic inline int _soc_link_ret(struct snd_soc_pcm_runtime *rtd,\n\t\t\t\tconst char *func, int ret)\n{\n\t \n\tif (ret >= 0)\n\t\treturn ret;\n\n\t \n\tswitch (ret) {\n\tcase -EPROBE_DEFER:\n\tcase -ENOTSUPP:\n\t\tbreak;\n\tdefault:\n\t\tdev_err(rtd->dev,\n\t\t\t\"ASoC: error at %s on %s: %d\\n\",\n\t\t\tfunc, rtd->dai_link->name, ret);\n\t}\n\n\treturn ret;\n}\n\n \n#define soc_link_mark_push(rtd, substream, tgt)\t\t((rtd)->mark_##tgt = substream)\n#define soc_link_mark_pop(rtd, substream, tgt)\t\t((rtd)->mark_##tgt = NULL)\n#define soc_link_mark_match(rtd, substream, tgt)\t((rtd)->mark_##tgt == substream)\n\nint snd_soc_link_init(struct snd_soc_pcm_runtime *rtd)\n{\n\tint ret = 0;\n\n\tif (rtd->dai_link->init)\n\t\tret = rtd->dai_link->init(rtd);\n\n\treturn soc_link_ret(rtd, ret);\n}\n\nvoid snd_soc_link_exit(struct snd_soc_pcm_runtime *rtd)\n{\n\tif (rtd->dai_link->exit)\n\t\trtd->dai_link->exit(rtd);\n}\n\nint snd_soc_link_be_hw_params_fixup(struct snd_soc_pcm_runtime *rtd,\n\t\t\t\t    struct snd_pcm_hw_params *params)\n{\n\tint ret = 0;\n\n\tif (rtd->dai_link->be_hw_params_fixup)\n\t\tret = rtd->dai_link->be_hw_params_fixup(rtd, params);\n\n\treturn soc_link_ret(rtd, ret);\n}\n\nint snd_soc_link_startup(struct snd_pcm_substream *substream)\n{\n\tstruct snd_soc_pcm_runtime *rtd = asoc_substream_to_rtd(substream);\n\tint ret = 0;\n\n\tif (rtd->dai_link->ops &&\n\t    rtd->dai_link->ops->startup)\n\t\tret = rtd->dai_link->ops->startup(substream);\n\n\t \n\tif (ret == 0)\n\t\tsoc_link_mark_push(rtd, substream, startup);\n\n\treturn soc_link_ret(rtd, ret);\n}\n\nvoid snd_soc_link_shutdown(struct snd_pcm_substream *substream,\n\t\t\t   int rollback)\n{\n\tstruct snd_soc_pcm_runtime *rtd = asoc_substream_to_rtd(substream);\n\n\tif (rollback && !soc_link_mark_match(rtd, substream, startup))\n\t\treturn;\n\n\tif (rtd->dai_link->ops &&\n\t    rtd->dai_link->ops->shutdown)\n\t\trtd->dai_link->ops->shutdown(substream);\n\n\t \n\tsoc_link_mark_pop(rtd, substream, startup);\n}\n\nint snd_soc_link_prepare(struct snd_pcm_substream *substream)\n{\n\tstruct snd_soc_pcm_runtime *rtd = asoc_substream_to_rtd(substream);\n\tint ret = 0;\n\n\tif (rtd->dai_link->ops &&\n\t    rtd->dai_link->ops->prepare)\n\t\tret = rtd->dai_link->ops->prepare(substream);\n\n\treturn soc_link_ret(rtd, ret);\n}\n\nint snd_soc_link_hw_params(struct snd_pcm_substream *substream,\n\t\t\t   struct snd_pcm_hw_params *params)\n{\n\tstruct snd_soc_pcm_runtime *rtd = asoc_substream_to_rtd(substream);\n\tint ret = 0;\n\n\tif (rtd->dai_link->ops &&\n\t    rtd->dai_link->ops->hw_params)\n\t\tret = rtd->dai_link->ops->hw_params(substream, params);\n\n\t \n\tif (ret == 0)\n\t\tsoc_link_mark_push(rtd, substream, hw_params);\n\n\treturn soc_link_ret(rtd, ret);\n}\n\nvoid snd_soc_link_hw_free(struct snd_pcm_substream *substream, int rollback)\n{\n\tstruct snd_soc_pcm_runtime *rtd = asoc_substream_to_rtd(substream);\n\n\tif (rollback && !soc_link_mark_match(rtd, substream, hw_params))\n\t\treturn;\n\n\tif (rtd->dai_link->ops &&\n\t    rtd->dai_link->ops->hw_free)\n\t\trtd->dai_link->ops->hw_free(substream);\n\n\t \n\tsoc_link_mark_pop(rtd, substream, hw_params);\n}\n\nstatic int soc_link_trigger(struct snd_pcm_substream *substream, int cmd)\n{\n\tstruct snd_soc_pcm_runtime *rtd = asoc_substream_to_rtd(substream);\n\tint ret = 0;\n\n\tif (rtd->dai_link->ops &&\n\t    rtd->dai_link->ops->trigger)\n\t\tret = rtd->dai_link->ops->trigger(substream, cmd);\n\n\treturn soc_link_ret(rtd, ret);\n}\n\nint snd_soc_link_trigger(struct snd_pcm_substream *substream, int cmd,\n\t\t\t int rollback)\n{\n\tstruct snd_soc_pcm_runtime *rtd = asoc_substream_to_rtd(substream);\n\tint ret = 0;\n\n\tswitch (cmd) {\n\tcase SNDRV_PCM_TRIGGER_START:\n\tcase SNDRV_PCM_TRIGGER_RESUME:\n\tcase SNDRV_PCM_TRIGGER_PAUSE_RELEASE:\n\t\tret = soc_link_trigger(substream, cmd);\n\t\tif (ret < 0)\n\t\t\tbreak;\n\t\tsoc_link_mark_push(rtd, substream, trigger);\n\t\tbreak;\n\tcase SNDRV_PCM_TRIGGER_STOP:\n\tcase SNDRV_PCM_TRIGGER_SUSPEND:\n\tcase SNDRV_PCM_TRIGGER_PAUSE_PUSH:\n\t\tif (rollback && !soc_link_mark_match(rtd, substream, trigger))\n\t\t\tbreak;\n\n\t\tret = soc_link_trigger(substream, cmd);\n\t\tsoc_link_mark_pop(rtd, substream, startup);\n\t}\n\n\treturn ret;\n}\n\nint snd_soc_link_compr_startup(struct snd_compr_stream *cstream)\n{\n\tstruct snd_soc_pcm_runtime *rtd = cstream->private_data;\n\tint ret = 0;\n\n\tif (rtd->dai_link->compr_ops &&\n\t    rtd->dai_link->compr_ops->startup)\n\t\tret = rtd->dai_link->compr_ops->startup(cstream);\n\n\tif (ret == 0)\n\t\tsoc_link_mark_push(rtd, cstream, compr_startup);\n\n\treturn soc_link_ret(rtd, ret);\n}\nEXPORT_SYMBOL_GPL(snd_soc_link_compr_startup);\n\nvoid snd_soc_link_compr_shutdown(struct snd_compr_stream *cstream,\n\t\t\t\t int rollback)\n{\n\tstruct snd_soc_pcm_runtime *rtd = cstream->private_data;\n\n\tif (rollback && !soc_link_mark_match(rtd, cstream, compr_startup))\n\t\treturn;\n\n\tif (rtd->dai_link->compr_ops &&\n\t    rtd->dai_link->compr_ops->shutdown)\n\t\trtd->dai_link->compr_ops->shutdown(cstream);\n\n\tsoc_link_mark_pop(rtd, cstream, compr_startup);\n}\nEXPORT_SYMBOL_GPL(snd_soc_link_compr_shutdown);\n\nint snd_soc_link_compr_set_params(struct snd_compr_stream *cstream)\n{\n\tstruct snd_soc_pcm_runtime *rtd = cstream->private_data;\n\tint ret = 0;\n\n\tif (rtd->dai_link->compr_ops &&\n\t    rtd->dai_link->compr_ops->set_params)\n\t\tret = rtd->dai_link->compr_ops->set_params(cstream);\n\n\treturn soc_link_ret(rtd, ret);\n}\nEXPORT_SYMBOL_GPL(snd_soc_link_compr_set_params);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}