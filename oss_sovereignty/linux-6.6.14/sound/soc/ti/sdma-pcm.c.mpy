{
  "module_name": "sdma-pcm.c",
  "hash_id": "4f27378618174a0286f7facf505c57244f9b59cceb3a73a8e789babf03c3d362",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/ti/sdma-pcm.c",
  "human_readable_source": "\n \n\n#include <linux/device.h>\n#include <linux/module.h>\n#include <sound/core.h>\n#include <sound/pcm.h>\n#include <sound/pcm_params.h>\n#include <sound/soc.h>\n#include <sound/dmaengine_pcm.h>\n\n#include \"sdma-pcm.h\"\n\nstatic const struct snd_pcm_hardware sdma_pcm_hardware = {\n\t.info\t\t\t= SNDRV_PCM_INFO_MMAP |\n\t\t\t\t  SNDRV_PCM_INFO_MMAP_VALID |\n\t\t\t\t  SNDRV_PCM_INFO_PAUSE | SNDRV_PCM_INFO_RESUME |\n\t\t\t\t  SNDRV_PCM_INFO_NO_PERIOD_WAKEUP |\n\t\t\t\t  SNDRV_PCM_INFO_INTERLEAVED,\n\t.period_bytes_min\t= 32,\n\t.period_bytes_max\t= 64 * 1024,\n\t.buffer_bytes_max\t= 128 * 1024,\n\t.periods_min\t\t= 2,\n\t.periods_max\t\t= 255,\n};\n\nstatic const struct snd_dmaengine_pcm_config sdma_dmaengine_pcm_config = {\n\t.pcm_hardware = &sdma_pcm_hardware,\n\t.prepare_slave_config = snd_dmaengine_pcm_prepare_slave_config,\n\t.prealloc_buffer_size = 128 * 1024,\n};\n\nint sdma_pcm_platform_register(struct device *dev,\n\t\t\t       char *txdmachan, char *rxdmachan)\n{\n\tstruct snd_dmaengine_pcm_config *config;\n\tunsigned int flags = 0;\n\n\t \n\tif (!txdmachan && !rxdmachan)\n\t\treturn devm_snd_dmaengine_pcm_register(dev,\n\t\t\t\t\t\t&sdma_dmaengine_pcm_config, 0);\n\n\tconfig = devm_kzalloc(dev, sizeof(*config), GFP_KERNEL);\n\tif (!config)\n\t\treturn -ENOMEM;\n\n\t*config = sdma_dmaengine_pcm_config;\n\n\tif (!txdmachan || !rxdmachan) {\n\t\t \n\t\tflags |= SND_DMAENGINE_PCM_FLAG_HALF_DUPLEX;\n\t\tif (!txdmachan) {\n\t\t\ttxdmachan = rxdmachan;\n\t\t\trxdmachan = NULL;\n\t\t}\n\t}\n\n\tconfig->chan_names[0] = txdmachan;\n\tconfig->chan_names[1] = rxdmachan;\n\n\treturn devm_snd_dmaengine_pcm_register(dev, config, flags);\n}\nEXPORT_SYMBOL_GPL(sdma_pcm_platform_register);\n\nMODULE_AUTHOR(\"Peter Ujfalusi <peter.ujfalusi@ti.com>\");\nMODULE_DESCRIPTION(\"sDMA PCM ASoC platform driver\");\nMODULE_LICENSE(\"GPL v2\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}