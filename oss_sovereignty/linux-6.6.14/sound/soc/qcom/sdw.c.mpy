{
  "module_name": "sdw.c",
  "hash_id": "8cc0ef6dadaa52d891a191dd4f660d63e52556bd0fcf169e9f5b3c19ddcb034d",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/qcom/sdw.c",
  "human_readable_source": "\n\n\n\n#include <linux/module.h>\n#include <sound/soc.h>\n#include \"qdsp6/q6afe.h\"\n#include \"sdw.h\"\n\nint qcom_snd_sdw_prepare(struct snd_pcm_substream *substream,\n\t\t\t struct sdw_stream_runtime *sruntime,\n\t\t\t bool *stream_prepared)\n{\n\tstruct snd_soc_pcm_runtime *rtd = substream->private_data;\n\tstruct snd_soc_dai *cpu_dai = asoc_rtd_to_cpu(rtd, 0);\n\tint ret;\n\n\tif (!sruntime)\n\t\treturn 0;\n\n\tswitch (cpu_dai->id) {\n\tcase WSA_CODEC_DMA_RX_0:\n\tcase WSA_CODEC_DMA_RX_1:\n\tcase RX_CODEC_DMA_RX_0:\n\tcase RX_CODEC_DMA_RX_1:\n\tcase TX_CODEC_DMA_TX_0:\n\tcase TX_CODEC_DMA_TX_1:\n\tcase TX_CODEC_DMA_TX_2:\n\tcase TX_CODEC_DMA_TX_3:\n\t\tbreak;\n\tdefault:\n\t\treturn 0;\n\t}\n\n\tif (*stream_prepared)\n\t\treturn 0;\n\n\tret = sdw_prepare_stream(sruntime);\n\tif (ret)\n\t\treturn ret;\n\n\t \n\n\tret = sdw_enable_stream(sruntime);\n\tif (ret) {\n\t\tsdw_deprepare_stream(sruntime);\n\t\treturn ret;\n\t}\n\t*stream_prepared  = true;\n\n\treturn ret;\n}\nEXPORT_SYMBOL_GPL(qcom_snd_sdw_prepare);\n\nint qcom_snd_sdw_hw_params(struct snd_pcm_substream *substream,\n\t\t\t   struct snd_pcm_hw_params *params,\n\t\t\t   struct sdw_stream_runtime **psruntime)\n{\n\tstruct snd_soc_pcm_runtime *rtd = substream->private_data;\n\tstruct snd_soc_dai *codec_dai;\n\tstruct snd_soc_dai *cpu_dai = asoc_rtd_to_cpu(rtd, 0);\n\tstruct sdw_stream_runtime *sruntime;\n\tint i;\n\n\tswitch (cpu_dai->id) {\n\tcase WSA_CODEC_DMA_RX_0:\n\tcase RX_CODEC_DMA_RX_0:\n\tcase RX_CODEC_DMA_RX_1:\n\tcase TX_CODEC_DMA_TX_0:\n\tcase TX_CODEC_DMA_TX_1:\n\tcase TX_CODEC_DMA_TX_2:\n\tcase TX_CODEC_DMA_TX_3:\n\t\tfor_each_rtd_codec_dais(rtd, i, codec_dai) {\n\t\t\tsruntime = snd_soc_dai_get_stream(codec_dai, substream->stream);\n\t\t\tif (sruntime != ERR_PTR(-ENOTSUPP))\n\t\t\t\t*psruntime = sruntime;\n\t\t}\n\t\tbreak;\n\t}\n\n\treturn 0;\n\n}\nEXPORT_SYMBOL_GPL(qcom_snd_sdw_hw_params);\n\nint qcom_snd_sdw_hw_free(struct snd_pcm_substream *substream,\n\t\t\t struct sdw_stream_runtime *sruntime, bool *stream_prepared)\n{\n\tstruct snd_soc_pcm_runtime *rtd = substream->private_data;\n\tstruct snd_soc_dai *cpu_dai = asoc_rtd_to_cpu(rtd, 0);\n\n\tswitch (cpu_dai->id) {\n\tcase WSA_CODEC_DMA_RX_0:\n\tcase WSA_CODEC_DMA_RX_1:\n\tcase RX_CODEC_DMA_RX_0:\n\tcase RX_CODEC_DMA_RX_1:\n\tcase TX_CODEC_DMA_TX_0:\n\tcase TX_CODEC_DMA_TX_1:\n\tcase TX_CODEC_DMA_TX_2:\n\tcase TX_CODEC_DMA_TX_3:\n\t\tif (sruntime && *stream_prepared) {\n\t\t\tsdw_disable_stream(sruntime);\n\t\t\tsdw_deprepare_stream(sruntime);\n\t\t\t*stream_prepared = false;\n\t\t}\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n\n\treturn 0;\n}\nEXPORT_SYMBOL_GPL(qcom_snd_sdw_hw_free);\nMODULE_LICENSE(\"GPL v2\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}