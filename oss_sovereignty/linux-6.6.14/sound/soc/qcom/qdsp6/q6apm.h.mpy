{
  "module_name": "q6apm.h",
  "hash_id": "094f454d8593980054e6199963cd2354979398f73d9282cecdc528a9cb59f711",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/qcom/qdsp6/q6apm.h",
  "human_readable_source": " \n#ifndef __Q6APM_H__\n#define __Q6APM_H__\n#include <linux/types.h>\n#include <linux/slab.h>\n#include <linux/wait.h>\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/sched.h>\n#include <linux/of.h>\n#include <linux/delay.h>\n#include <sound/soc.h>\n#include <linux/of_platform.h>\n#include <linux/jiffies.h>\n#include <linux/soc/qcom/apr.h>\n#include <dt-bindings/sound/qcom,q6dsp-lpass-ports.h>\n#include \"audioreach.h\"\n\n#define APM_PORT_MAX\t\t127\n#define APM_PORT_MAX_AUDIO_CHAN_CNT 8\n#define PCM_CHANNEL_NULL 0\n#define PCM_CHANNEL_FL    1\t \n#define PCM_CHANNEL_FR    2\t \n#define PCM_CHANNEL_FC    3\t \n#define PCM_CHANNEL_LS   4\t \n#define PCM_CHANNEL_RS   5\t \n#define PCM_CHANNEL_LFE  6\t \n#define PCM_CHANNEL_CS   7\t \n#define PCM_CHANNEL_LB   8\t \n#define PCM_CHANNEL_RB   9\t \n#define PCM_CHANNELS   10\t \n\n#define APM_TIMESTAMP_FLAG\t0x80000000\n#define FORMAT_LINEAR_PCM\t0x0000\n \n#define APM_CMD_EOS\t\t\t\t0x0003\n#define APM_CLIENT_EVENT_CMD_EOS_DONE\t\t0x1003\n#define APM_CMD_CLOSE\t\t\t\t0x0004\n#define APM_CLIENT_EVENT_CMD_CLOSE_DONE\t\t0x1004\n#define APM_CLIENT_EVENT_CMD_RUN_DONE\t\t0x1008\n#define APM_CLIENT_EVENT_DATA_WRITE_DONE\t0x1009\n#define APM_CLIENT_EVENT_DATA_READ_DONE\t\t0x100a\n#define APM_WRITE_TOKEN_MASK                   GENMASK(15, 0)\n#define APM_WRITE_TOKEN_LEN_MASK               GENMASK(31, 16)\n#define APM_WRITE_TOKEN_LEN_SHIFT              16\n\n#define APM_MAX_SESSIONS\t\t\t8\n#define APM_LAST_BUFFER_FLAG\t\t\tBIT(30)\n#define NO_TIMESTAMP\t\t\t\t0xFF00\n\nstruct q6apm {\n\tstruct device *dev;\n\tgpr_port_t *port;\n\tgpr_device_t *gdev;\n\t \n\twait_queue_head_t wait;\n\tstruct gpr_ibasic_rsp_result_t result;\n\n\tstruct mutex cmd_lock;\n\tstruct mutex lock;\n\tuint32_t state;\n\n\tstruct list_head widget_list;\n\tstruct idr graph_idr;\n\tstruct idr graph_info_idr;\n\tstruct idr sub_graphs_idr;\n\tstruct idr containers_idr;\n\tstruct idr modules_idr;\n};\n\nstruct audio_buffer {\n\tphys_addr_t phys;\n\tuint32_t size;\t\t \n};\n\nstruct audioreach_graph_data {\n\tstruct audio_buffer *buf;\n\tuint32_t num_periods;\n\tuint32_t dsp_buf;\n\tuint32_t mem_map_handle;\n};\n\nstruct audioreach_graph {\n\tstruct audioreach_graph_info *info;\n\tuint32_t id;\n\tint state;\n\tint start_count;\n\t \n\tvoid *graph;\n\tstruct kref refcount;\n\tstruct q6apm *apm;\n};\n\ntypedef void (*q6apm_cb) (uint32_t opcode, uint32_t token,\n\t\t\t  void *payload, void *priv);\nstruct q6apm_graph {\n\tvoid *priv;\n\tq6apm_cb cb;\n\tuint32_t id;\n\tstruct device *dev;\n\tstruct q6apm *apm;\n\tgpr_port_t *port;\n\tstruct audioreach_graph_data rx_data;\n\tstruct audioreach_graph_data tx_data;\n\tstruct gpr_ibasic_rsp_result_t result;\n\twait_queue_head_t cmd_wait;\n\tstruct mutex lock;\n\tstruct audioreach_graph *ar_graph;\n\tstruct audioreach_graph_info *info;\n};\n\n \nstruct q6apm_graph *q6apm_graph_open(struct device *dev, q6apm_cb cb,\n\t\t\t\t     void *priv, int graph_id);\nint q6apm_graph_close(struct q6apm_graph *graph);\nint q6apm_graph_prepare(struct q6apm_graph *graph);\nint q6apm_graph_start(struct q6apm_graph *graph);\nint q6apm_graph_stop(struct q6apm_graph *graph);\nint q6apm_graph_flush(struct q6apm_graph *graph);\n\n \nint q6apm_graph_media_format_pcm(struct q6apm_graph *graph,\n\t\t\t\t struct audioreach_module_config *cfg);\n\nint q6apm_graph_media_format_shmem(struct q6apm_graph *graph,\n\t\t\t\t   struct audioreach_module_config *cfg);\n\n \nint q6apm_read(struct q6apm_graph *graph);\nint q6apm_write_async(struct q6apm_graph *graph, uint32_t len, uint32_t msw_ts,\n\t\t      uint32_t lsw_ts, uint32_t wflags);\n\n \nint q6apm_map_memory_regions(struct q6apm_graph *graph,\n\t\t\t     unsigned int dir, phys_addr_t phys,\n\t\t\t     size_t period_sz, unsigned int periods);\nint q6apm_unmap_memory_regions(struct q6apm_graph *graph,\n\t\t\t       unsigned int dir);\n \nint q6apm_send_cmd_sync(struct q6apm *apm, struct gpr_pkt *pkt,\n\t\t\tuint32_t rsp_opcode);\n\n \nstruct audioreach_module *q6apm_find_module_by_mid(struct q6apm_graph *graph,\n\t\t\t\t\t\t    uint32_t mid);\nint q6apm_graph_get_rx_shmem_module_iid(struct q6apm_graph *graph);\n\nbool q6apm_is_adsp_ready(void);\n\nint q6apm_enable_compress_module(struct device *dev, struct q6apm_graph *graph, bool en);\nint q6apm_remove_initial_silence(struct device *dev, struct q6apm_graph *graph, uint32_t samples);\nint q6apm_remove_trailing_silence(struct device *dev, struct q6apm_graph *graph, uint32_t samples);\nint q6apm_set_real_module_id(struct device *dev, struct q6apm_graph *graph, uint32_t codec_id);\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}