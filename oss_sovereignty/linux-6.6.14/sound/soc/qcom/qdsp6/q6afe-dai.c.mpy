{
  "module_name": "q6afe-dai.c",
  "hash_id": "0d70e99cb00fc38114e7a950f52fc67b9289183a42c0e8bd9f798823abe7bd41",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/qcom/qdsp6/q6afe-dai.c",
  "human_readable_source": "\n\n\n\n#include <linux/err.h>\n#include <linux/init.h>\n#include <linux/module.h>\n#include <linux/device.h>\n#include <linux/platform_device.h>\n#include <linux/slab.h>\n#include <sound/pcm.h>\n#include <sound/soc.h>\n#include <sound/pcm_params.h>\n#include \"q6dsp-lpass-ports.h\"\n#include \"q6dsp-common.h\"\n#include \"q6afe.h\"\n\n\nstruct q6afe_dai_priv_data {\n\tuint32_t sd_line_mask;\n\tuint32_t sync_mode;\n\tuint32_t sync_src;\n\tuint32_t data_out_enable;\n\tuint32_t invert_sync;\n\tuint32_t data_delay;\n\tuint32_t data_align;\n};\n\nstruct q6afe_dai_data {\n\tstruct q6afe_port *port[AFE_PORT_MAX];\n\tstruct q6afe_port_config port_config[AFE_PORT_MAX];\n\tbool is_port_started[AFE_PORT_MAX];\n\tstruct q6afe_dai_priv_data priv[AFE_PORT_MAX];\n};\n\nstatic int q6slim_hw_params(struct snd_pcm_substream *substream,\n\t\t\t    struct snd_pcm_hw_params *params,\n\t\t\t    struct snd_soc_dai *dai)\n{\n\n\tstruct q6afe_dai_data *dai_data = dev_get_drvdata(dai->dev);\n\tstruct q6afe_slim_cfg *slim = &dai_data->port_config[dai->id].slim;\n\n\tslim->sample_rate = params_rate(params);\n\n\tswitch (params_format(params)) {\n\tcase SNDRV_PCM_FORMAT_S16_LE:\n\tcase SNDRV_PCM_FORMAT_SPECIAL:\n\t\tslim->bit_width = 16;\n\t\tbreak;\n\tcase SNDRV_PCM_FORMAT_S24_LE:\n\t\tslim->bit_width = 24;\n\t\tbreak;\n\tcase SNDRV_PCM_FORMAT_S32_LE:\n\t\tslim->bit_width = 32;\n\t\tbreak;\n\tdefault:\n\t\tpr_err(\"%s: format %d\\n\",\n\t\t\t__func__, params_format(params));\n\t\treturn -EINVAL;\n\t}\n\n\treturn 0;\n}\n\nstatic int q6hdmi_hw_params(struct snd_pcm_substream *substream,\n\t\t\t\tstruct snd_pcm_hw_params *params,\n\t\t\t\tstruct snd_soc_dai *dai)\n{\n\tstruct q6afe_dai_data *dai_data = dev_get_drvdata(dai->dev);\n\tint channels = params_channels(params);\n\tstruct q6afe_hdmi_cfg *hdmi = &dai_data->port_config[dai->id].hdmi;\n\tint ret;\n\n\thdmi->sample_rate = params_rate(params);\n\tswitch (params_format(params)) {\n\tcase SNDRV_PCM_FORMAT_S16_LE:\n\t\thdmi->bit_width = 16;\n\t\tbreak;\n\tcase SNDRV_PCM_FORMAT_S24_LE:\n\t\thdmi->bit_width = 24;\n\t\tbreak;\n\t}\n\n\tret = q6dsp_get_channel_allocation(channels);\n\tif (ret < 0)\n\t\treturn ret;\n\n\thdmi->channel_allocation = (u16) ret;\n\n\treturn 0;\n}\n\nstatic int q6i2s_hw_params(struct snd_pcm_substream *substream,\n\t\t\t   struct snd_pcm_hw_params *params,\n\t\t\t   struct snd_soc_dai *dai)\n{\n\tstruct q6afe_dai_data *dai_data = dev_get_drvdata(dai->dev);\n\tstruct q6afe_i2s_cfg *i2s = &dai_data->port_config[dai->id].i2s_cfg;\n\n\ti2s->sample_rate = params_rate(params);\n\ti2s->bit_width = params_width(params);\n\ti2s->num_channels = params_channels(params);\n\ti2s->sd_line_mask = dai_data->priv[dai->id].sd_line_mask;\n\n\treturn 0;\n}\n\nstatic int q6i2s_set_fmt(struct snd_soc_dai *dai, unsigned int fmt)\n{\n\tstruct q6afe_dai_data *dai_data = dev_get_drvdata(dai->dev);\n\tstruct q6afe_i2s_cfg *i2s = &dai_data->port_config[dai->id].i2s_cfg;\n\n\ti2s->fmt = fmt;\n\n\treturn 0;\n}\n\nstatic int q6tdm_set_tdm_slot(struct snd_soc_dai *dai,\n\t\t\t\tunsigned int tx_mask,\n\t\t\t\tunsigned int rx_mask,\n\t\t\t\tint slots, int slot_width)\n{\n\n\tstruct q6afe_dai_data *dai_data = dev_get_drvdata(dai->dev);\n\tstruct q6afe_tdm_cfg *tdm = &dai_data->port_config[dai->id].tdm;\n\tunsigned int cap_mask;\n\tint rc = 0;\n\n\t \n\tif ((slot_width != 16) && (slot_width != 32)) {\n\t\tdev_err(dai->dev, \"%s: invalid slot_width %d\\n\",\n\t\t\t__func__, slot_width);\n\t\treturn -EINVAL;\n\t}\n\n\t \n\tswitch (slots) {\n\tcase 2:\n\t\tcap_mask = 0x03;\n\t\tbreak;\n\tcase 4:\n\t\tcap_mask = 0x0F;\n\t\tbreak;\n\tcase 8:\n\t\tcap_mask = 0xFF;\n\t\tbreak;\n\tcase 16:\n\t\tcap_mask = 0xFFFF;\n\t\tbreak;\n\tdefault:\n\t\tdev_err(dai->dev, \"%s: invalid slots %d\\n\",\n\t\t\t__func__, slots);\n\t\treturn -EINVAL;\n\t}\n\n\tswitch (dai->id) {\n\tcase PRIMARY_TDM_RX_0 ... QUINARY_TDM_TX_7:\n\t\ttdm->nslots_per_frame = slots;\n\t\ttdm->slot_width = slot_width;\n\t\t \n\t\ttdm->slot_mask = ((dai->id & 0x1) ? tx_mask : rx_mask) & cap_mask;\n\t\tbreak;\n\tdefault:\n\t\tdev_err(dai->dev, \"%s: invalid dai id 0x%x\\n\",\n\t\t\t__func__, dai->id);\n\t\treturn -EINVAL;\n\t}\n\n\treturn rc;\n}\n\nstatic int q6tdm_set_channel_map(struct snd_soc_dai *dai,\n\t\t\t\tunsigned int tx_num, unsigned int *tx_slot,\n\t\t\t\tunsigned int rx_num, unsigned int *rx_slot)\n{\n\n\tstruct q6afe_dai_data *dai_data = dev_get_drvdata(dai->dev);\n\tstruct q6afe_tdm_cfg *tdm = &dai_data->port_config[dai->id].tdm;\n\tint rc = 0;\n\tint i = 0;\n\n\tswitch (dai->id) {\n\tcase PRIMARY_TDM_RX_0 ... QUINARY_TDM_TX_7:\n\t\tif (dai->id & 0x1) {\n\t\t\tif (!tx_slot) {\n\t\t\t\tdev_err(dai->dev, \"tx slot not found\\n\");\n\t\t\t\treturn -EINVAL;\n\t\t\t}\n\t\t\tif (tx_num > AFE_PORT_MAX_AUDIO_CHAN_CNT) {\n\t\t\t\tdev_err(dai->dev, \"invalid tx num %d\\n\",\n\t\t\t\t\ttx_num);\n\t\t\t\treturn -EINVAL;\n\t\t\t}\n\n\t\t\tfor (i = 0; i < tx_num; i++)\n\t\t\t\ttdm->ch_mapping[i] = tx_slot[i];\n\n\t\t\tfor (i = tx_num; i < AFE_PORT_MAX_AUDIO_CHAN_CNT; i++)\n\t\t\t\ttdm->ch_mapping[i] = Q6AFE_CMAP_INVALID;\n\n\t\t\ttdm->num_channels = tx_num;\n\t\t} else {\n\t\t\t \n\t\t\tif (!rx_slot) {\n\t\t\t\tdev_err(dai->dev, \"rx slot not found\\n\");\n\t\t\t\treturn -EINVAL;\n\t\t\t}\n\t\t\tif (rx_num > AFE_PORT_MAX_AUDIO_CHAN_CNT) {\n\t\t\t\tdev_err(dai->dev, \"invalid rx num %d\\n\",\n\t\t\t\t\trx_num);\n\t\t\t\treturn -EINVAL;\n\t\t\t}\n\n\t\t\tfor (i = 0; i < rx_num; i++)\n\t\t\t\ttdm->ch_mapping[i] = rx_slot[i];\n\n\t\t\tfor (i = rx_num; i < AFE_PORT_MAX_AUDIO_CHAN_CNT; i++)\n\t\t\t\ttdm->ch_mapping[i] = Q6AFE_CMAP_INVALID;\n\n\t\t\ttdm->num_channels = rx_num;\n\t\t}\n\n\t\tbreak;\n\tdefault:\n\t\tdev_err(dai->dev, \"%s: invalid dai id 0x%x\\n\",\n\t\t\t__func__, dai->id);\n\t\treturn -EINVAL;\n\t}\n\n\treturn rc;\n}\n\nstatic int q6tdm_hw_params(struct snd_pcm_substream *substream,\n\t\t\t   struct snd_pcm_hw_params *params,\n\t\t\t   struct snd_soc_dai *dai)\n{\n\tstruct q6afe_dai_data *dai_data = dev_get_drvdata(dai->dev);\n\tstruct q6afe_tdm_cfg *tdm = &dai_data->port_config[dai->id].tdm;\n\n\ttdm->bit_width = params_width(params);\n\ttdm->sample_rate = params_rate(params);\n\ttdm->num_channels = params_channels(params);\n\ttdm->data_align_type = dai_data->priv[dai->id].data_align;\n\ttdm->sync_src = dai_data->priv[dai->id].sync_src;\n\ttdm->sync_mode = dai_data->priv[dai->id].sync_mode;\n\n\treturn 0;\n}\n\nstatic int q6dma_set_channel_map(struct snd_soc_dai *dai,\n\t\t\t\t unsigned int tx_num, unsigned int *tx_ch_mask,\n\t\t\t\t unsigned int rx_num, unsigned int *rx_ch_mask)\n{\n\n\tstruct q6afe_dai_data *dai_data = dev_get_drvdata(dai->dev);\n\tstruct q6afe_cdc_dma_cfg *cfg = &dai_data->port_config[dai->id].dma_cfg;\n\tint ch_mask;\n\tint rc = 0;\n\n\tswitch (dai->id) {\n\tcase WSA_CODEC_DMA_TX_0:\n\tcase WSA_CODEC_DMA_TX_1:\n\tcase WSA_CODEC_DMA_TX_2:\n\tcase VA_CODEC_DMA_TX_0:\n\tcase VA_CODEC_DMA_TX_1:\n\tcase VA_CODEC_DMA_TX_2:\n\tcase TX_CODEC_DMA_TX_0:\n\tcase TX_CODEC_DMA_TX_1:\n\tcase TX_CODEC_DMA_TX_2:\n\tcase TX_CODEC_DMA_TX_3:\n\tcase TX_CODEC_DMA_TX_4:\n\tcase TX_CODEC_DMA_TX_5:\n\t\tif (!tx_ch_mask) {\n\t\t\tdev_err(dai->dev, \"tx slot not found\\n\");\n\t\t\treturn -EINVAL;\n\t\t}\n\n\t\tif (tx_num > AFE_PORT_MAX_AUDIO_CHAN_CNT) {\n\t\t\tdev_err(dai->dev, \"invalid tx num %d\\n\",\n\t\t\t\ttx_num);\n\t\t\treturn -EINVAL;\n\t\t}\n\t\tch_mask = *tx_ch_mask;\n\n\t\tbreak;\n\tcase WSA_CODEC_DMA_RX_0:\n\tcase WSA_CODEC_DMA_RX_1:\n\tcase RX_CODEC_DMA_RX_0:\n\tcase RX_CODEC_DMA_RX_1:\n\tcase RX_CODEC_DMA_RX_2:\n\tcase RX_CODEC_DMA_RX_3:\n\tcase RX_CODEC_DMA_RX_4:\n\tcase RX_CODEC_DMA_RX_5:\n\tcase RX_CODEC_DMA_RX_6:\n\tcase RX_CODEC_DMA_RX_7:\n\t\t \n\t\tif (!rx_ch_mask) {\n\t\t\tdev_err(dai->dev, \"rx slot not found\\n\");\n\t\t\treturn -EINVAL;\n\t\t}\n\t\tif (rx_num > AFE_PORT_MAX_AUDIO_CHAN_CNT) {\n\t\t\tdev_err(dai->dev, \"invalid rx num %d\\n\",\n\t\t\t\trx_num);\n\t\t\treturn -EINVAL;\n\t\t}\n\t\tch_mask = *rx_ch_mask;\n\n\t\tbreak;\n\tdefault:\n\t\tdev_err(dai->dev, \"%s: invalid dai id 0x%x\\n\",\n\t\t\t__func__, dai->id);\n\t\treturn -EINVAL;\n\t}\n\n\tcfg->active_channels_mask = ch_mask;\n\n\treturn rc;\n}\n\nstatic int q6dma_hw_params(struct snd_pcm_substream *substream,\n\t\t\t   struct snd_pcm_hw_params *params,\n\t\t\t   struct snd_soc_dai *dai)\n{\n\tstruct q6afe_dai_data *dai_data = dev_get_drvdata(dai->dev);\n\tstruct q6afe_cdc_dma_cfg *cfg = &dai_data->port_config[dai->id].dma_cfg;\n\n\tcfg->bit_width = params_width(params);\n\tcfg->sample_rate = params_rate(params);\n\tcfg->num_channels = params_channels(params);\n\n\treturn 0;\n}\nstatic void q6afe_dai_shutdown(struct snd_pcm_substream *substream,\n\t\t\t\tstruct snd_soc_dai *dai)\n{\n\tstruct q6afe_dai_data *dai_data = dev_get_drvdata(dai->dev);\n\tint rc;\n\n\tif (!dai_data->is_port_started[dai->id])\n\t\treturn;\n\n\trc = q6afe_port_stop(dai_data->port[dai->id]);\n\tif (rc < 0)\n\t\tdev_err(dai->dev, \"fail to close AFE port (%d)\\n\", rc);\n\n\tdai_data->is_port_started[dai->id] = false;\n\n}\n\nstatic int q6afe_dai_prepare(struct snd_pcm_substream *substream,\n\t\tstruct snd_soc_dai *dai)\n{\n\tstruct q6afe_dai_data *dai_data = dev_get_drvdata(dai->dev);\n\tint rc;\n\n\tif (dai_data->is_port_started[dai->id]) {\n\t\t \n\t\trc = q6afe_port_stop(dai_data->port[dai->id]);\n\t\tif (rc < 0) {\n\t\t\tdev_err(dai->dev, \"fail to close AFE port (%d)\\n\", rc);\n\t\t\treturn rc;\n\t\t}\n\t}\n\n\tswitch (dai->id) {\n\tcase HDMI_RX:\n\tcase DISPLAY_PORT_RX:\n\t\tq6afe_hdmi_port_prepare(dai_data->port[dai->id],\n\t\t\t\t\t&dai_data->port_config[dai->id].hdmi);\n\t\tbreak;\n\tcase SLIMBUS_0_RX ... SLIMBUS_6_TX:\n\t\tq6afe_slim_port_prepare(dai_data->port[dai->id],\n\t\t\t\t\t&dai_data->port_config[dai->id].slim);\n\t\tbreak;\n\tcase QUINARY_MI2S_RX ... QUINARY_MI2S_TX:\n\tcase PRIMARY_MI2S_RX ... QUATERNARY_MI2S_TX:\n\t\trc = q6afe_i2s_port_prepare(dai_data->port[dai->id],\n\t\t\t       &dai_data->port_config[dai->id].i2s_cfg);\n\t\tif (rc < 0) {\n\t\t\tdev_err(dai->dev, \"fail to prepare AFE port %x\\n\",\n\t\t\t\tdai->id);\n\t\t\treturn rc;\n\t\t}\n\t\tbreak;\n\tcase PRIMARY_TDM_RX_0 ... QUINARY_TDM_TX_7:\n\t\tq6afe_tdm_port_prepare(dai_data->port[dai->id],\n\t\t\t\t\t&dai_data->port_config[dai->id].tdm);\n\t\tbreak;\n\tcase WSA_CODEC_DMA_RX_0 ... RX_CODEC_DMA_RX_7:\n\t\tq6afe_cdc_dma_port_prepare(dai_data->port[dai->id],\n\t\t\t\t\t   &dai_data->port_config[dai->id].dma_cfg);\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\trc = q6afe_port_start(dai_data->port[dai->id]);\n\tif (rc < 0) {\n\t\tdev_err(dai->dev, \"fail to start AFE port %x\\n\", dai->id);\n\t\treturn rc;\n\t}\n\tdai_data->is_port_started[dai->id] = true;\n\n\treturn 0;\n}\n\nstatic int q6slim_set_channel_map(struct snd_soc_dai *dai,\n\t\t\t\tunsigned int tx_num, unsigned int *tx_slot,\n\t\t\t\tunsigned int rx_num, unsigned int *rx_slot)\n{\n\tstruct q6afe_dai_data *dai_data = dev_get_drvdata(dai->dev);\n\tstruct q6afe_port_config *pcfg = &dai_data->port_config[dai->id];\n\tint i;\n\n\tif (dai->id & 0x1) {\n\t\t \n\t\tif (!tx_slot) {\n\t\t\tpr_err(\"%s: tx slot not found\\n\", __func__);\n\t\t\treturn -EINVAL;\n\t\t}\n\n\t\tfor (i = 0; i < tx_num; i++)\n\t\t\tpcfg->slim.ch_mapping[i] = tx_slot[i];\n\n\t\tpcfg->slim.num_channels = tx_num;\n\n\n\t} else {\n\t\tif (!rx_slot) {\n\t\t\tpr_err(\"%s: rx slot not found\\n\", __func__);\n\t\t\treturn -EINVAL;\n\t\t}\n\n\t\tfor (i = 0; i < rx_num; i++)\n\t\t\tpcfg->slim.ch_mapping[i] =   rx_slot[i];\n\n\t\tpcfg->slim.num_channels = rx_num;\n\n\t}\n\n\treturn 0;\n}\n\nstatic int q6afe_mi2s_set_sysclk(struct snd_soc_dai *dai,\n\t\tint clk_id, unsigned int freq, int dir)\n{\n\tstruct q6afe_dai_data *dai_data = dev_get_drvdata(dai->dev);\n\tstruct q6afe_port *port = dai_data->port[dai->id];\n\n\tswitch (clk_id) {\n\tcase LPAIF_DIG_CLK:\n\t\treturn q6afe_port_set_sysclk(port, clk_id, 0, 5, freq, dir);\n\tcase LPAIF_BIT_CLK:\n\tcase LPAIF_OSR_CLK:\n\t\treturn q6afe_port_set_sysclk(port, clk_id,\n\t\t\t\t\t     Q6AFE_LPASS_CLK_SRC_INTERNAL,\n\t\t\t\t\t     Q6AFE_LPASS_CLK_ROOT_DEFAULT,\n\t\t\t\t\t     freq, dir);\n\tcase Q6AFE_LPASS_CLK_ID_PRI_MI2S_IBIT ... Q6AFE_LPASS_CLK_ID_QUI_MI2S_OSR:\n\tcase Q6AFE_LPASS_CLK_ID_MCLK_1 ... Q6AFE_LPASS_CLK_ID_INT_MCLK_1:\n\tcase Q6AFE_LPASS_CLK_ID_WSA_CORE_MCLK ... Q6AFE_LPASS_CLK_ID_VA_CORE_2X_MCLK:\n\t\treturn q6afe_port_set_sysclk(port, clk_id,\n\t\t\t\t\t     Q6AFE_LPASS_CLK_ATTRIBUTE_COUPLE_NO,\n\t\t\t\t\t     Q6AFE_LPASS_CLK_ROOT_DEFAULT,\n\t\t\t\t\t     freq, dir);\n\tcase Q6AFE_LPASS_CLK_ID_PRI_TDM_IBIT ... Q6AFE_LPASS_CLK_ID_QUIN_TDM_EBIT:\n\t\treturn q6afe_port_set_sysclk(port, clk_id,\n\t\t\t\t\t     Q6AFE_LPASS_CLK_ATTRIBUTE_INVERT_COUPLE_NO,\n\t\t\t\t\t     Q6AFE_LPASS_CLK_ROOT_DEFAULT,\n\t\t\t\t\t     freq, dir);\n\t}\n\n\treturn 0;\n}\n\nstatic const struct snd_soc_dapm_route q6afe_dapm_routes[] = {\n\t{\"HDMI Playback\", NULL, \"HDMI_RX\"},\n\t{\"DISPLAY_PORT_RX_0 Playback\", NULL, \"DISPLAY_PORT_RX\"},\n\t{\"Slimbus Playback\", NULL, \"SLIMBUS_0_RX\"},\n\t{\"Slimbus1 Playback\", NULL, \"SLIMBUS_1_RX\"},\n\t{\"Slimbus2 Playback\", NULL, \"SLIMBUS_2_RX\"},\n\t{\"Slimbus3 Playback\", NULL, \"SLIMBUS_3_RX\"},\n\t{\"Slimbus4 Playback\", NULL, \"SLIMBUS_4_RX\"},\n\t{\"Slimbus5 Playback\", NULL, \"SLIMBUS_5_RX\"},\n\t{\"Slimbus6 Playback\", NULL, \"SLIMBUS_6_RX\"},\n\n\t{\"SLIMBUS_0_TX\", NULL, \"Slimbus Capture\"},\n\t{\"SLIMBUS_1_TX\", NULL, \"Slimbus1 Capture\"},\n\t{\"SLIMBUS_2_TX\", NULL, \"Slimbus2 Capture\"},\n\t{\"SLIMBUS_3_TX\", NULL, \"Slimbus3 Capture\"},\n\t{\"SLIMBUS_4_TX\", NULL, \"Slimbus4 Capture\"},\n\t{\"SLIMBUS_5_TX\", NULL, \"Slimbus5 Capture\"},\n\t{\"SLIMBUS_6_TX\", NULL, \"Slimbus6 Capture\"},\n\n\t{\"Primary MI2S Playback\", NULL, \"PRI_MI2S_RX\"},\n\t{\"Secondary MI2S Playback\", NULL, \"SEC_MI2S_RX\"},\n\t{\"Tertiary MI2S Playback\", NULL, \"TERT_MI2S_RX\"},\n\t{\"Quaternary MI2S Playback\", NULL, \"QUAT_MI2S_RX\"},\n\t{\"Quinary MI2S Playback\", NULL, \"QUIN_MI2S_RX\"},\n\n\t{\"Primary TDM0 Playback\", NULL, \"PRIMARY_TDM_RX_0\"},\n\t{\"Primary TDM1 Playback\", NULL, \"PRIMARY_TDM_RX_1\"},\n\t{\"Primary TDM2 Playback\", NULL, \"PRIMARY_TDM_RX_2\"},\n\t{\"Primary TDM3 Playback\", NULL, \"PRIMARY_TDM_RX_3\"},\n\t{\"Primary TDM4 Playback\", NULL, \"PRIMARY_TDM_RX_4\"},\n\t{\"Primary TDM5 Playback\", NULL, \"PRIMARY_TDM_RX_5\"},\n\t{\"Primary TDM6 Playback\", NULL, \"PRIMARY_TDM_RX_6\"},\n\t{\"Primary TDM7 Playback\", NULL, \"PRIMARY_TDM_RX_7\"},\n\n\t{\"Secondary TDM0 Playback\", NULL, \"SEC_TDM_RX_0\"},\n\t{\"Secondary TDM1 Playback\", NULL, \"SEC_TDM_RX_1\"},\n\t{\"Secondary TDM2 Playback\", NULL, \"SEC_TDM_RX_2\"},\n\t{\"Secondary TDM3 Playback\", NULL, \"SEC_TDM_RX_3\"},\n\t{\"Secondary TDM4 Playback\", NULL, \"SEC_TDM_RX_4\"},\n\t{\"Secondary TDM5 Playback\", NULL, \"SEC_TDM_RX_5\"},\n\t{\"Secondary TDM6 Playback\", NULL, \"SEC_TDM_RX_6\"},\n\t{\"Secondary TDM7 Playback\", NULL, \"SEC_TDM_RX_7\"},\n\n\t{\"Tertiary TDM0 Playback\", NULL, \"TERT_TDM_RX_0\"},\n\t{\"Tertiary TDM1 Playback\", NULL, \"TERT_TDM_RX_1\"},\n\t{\"Tertiary TDM2 Playback\", NULL, \"TERT_TDM_RX_2\"},\n\t{\"Tertiary TDM3 Playback\", NULL, \"TERT_TDM_RX_3\"},\n\t{\"Tertiary TDM4 Playback\", NULL, \"TERT_TDM_RX_4\"},\n\t{\"Tertiary TDM5 Playback\", NULL, \"TERT_TDM_RX_5\"},\n\t{\"Tertiary TDM6 Playback\", NULL, \"TERT_TDM_RX_6\"},\n\t{\"Tertiary TDM7 Playback\", NULL, \"TERT_TDM_RX_7\"},\n\n\t{\"Quaternary TDM0 Playback\", NULL, \"QUAT_TDM_RX_0\"},\n\t{\"Quaternary TDM1 Playback\", NULL, \"QUAT_TDM_RX_1\"},\n\t{\"Quaternary TDM2 Playback\", NULL, \"QUAT_TDM_RX_2\"},\n\t{\"Quaternary TDM3 Playback\", NULL, \"QUAT_TDM_RX_3\"},\n\t{\"Quaternary TDM4 Playback\", NULL, \"QUAT_TDM_RX_4\"},\n\t{\"Quaternary TDM5 Playback\", NULL, \"QUAT_TDM_RX_5\"},\n\t{\"Quaternary TDM6 Playback\", NULL, \"QUAT_TDM_RX_6\"},\n\t{\"Quaternary TDM7 Playback\", NULL, \"QUAT_TDM_RX_7\"},\n\n\t{\"Quinary TDM0 Playback\", NULL, \"QUIN_TDM_RX_0\"},\n\t{\"Quinary TDM1 Playback\", NULL, \"QUIN_TDM_RX_1\"},\n\t{\"Quinary TDM2 Playback\", NULL, \"QUIN_TDM_RX_2\"},\n\t{\"Quinary TDM3 Playback\", NULL, \"QUIN_TDM_RX_3\"},\n\t{\"Quinary TDM4 Playback\", NULL, \"QUIN_TDM_RX_4\"},\n\t{\"Quinary TDM5 Playback\", NULL, \"QUIN_TDM_RX_5\"},\n\t{\"Quinary TDM6 Playback\", NULL, \"QUIN_TDM_RX_6\"},\n\t{\"Quinary TDM7 Playback\", NULL, \"QUIN_TDM_RX_7\"},\n\n\t{\"PRIMARY_TDM_TX_0\", NULL, \"Primary TDM0 Capture\"},\n\t{\"PRIMARY_TDM_TX_1\", NULL, \"Primary TDM1 Capture\"},\n\t{\"PRIMARY_TDM_TX_2\", NULL, \"Primary TDM2 Capture\"},\n\t{\"PRIMARY_TDM_TX_3\", NULL, \"Primary TDM3 Capture\"},\n\t{\"PRIMARY_TDM_TX_4\", NULL, \"Primary TDM4 Capture\"},\n\t{\"PRIMARY_TDM_TX_5\", NULL, \"Primary TDM5 Capture\"},\n\t{\"PRIMARY_TDM_TX_6\", NULL, \"Primary TDM6 Capture\"},\n\t{\"PRIMARY_TDM_TX_7\", NULL, \"Primary TDM7 Capture\"},\n\n\t{\"SEC_TDM_TX_0\", NULL, \"Secondary TDM0 Capture\"},\n\t{\"SEC_TDM_TX_1\", NULL, \"Secondary TDM1 Capture\"},\n\t{\"SEC_TDM_TX_2\", NULL, \"Secondary TDM2 Capture\"},\n\t{\"SEC_TDM_TX_3\", NULL, \"Secondary TDM3 Capture\"},\n\t{\"SEC_TDM_TX_4\", NULL, \"Secondary TDM4 Capture\"},\n\t{\"SEC_TDM_TX_5\", NULL, \"Secondary TDM5 Capture\"},\n\t{\"SEC_TDM_TX_6\", NULL, \"Secondary TDM6 Capture\"},\n\t{\"SEC_TDM_TX_7\", NULL, \"Secondary TDM7 Capture\"},\n\n\t{\"TERT_TDM_TX_0\", NULL, \"Tertiary TDM0 Capture\"},\n\t{\"TERT_TDM_TX_1\", NULL, \"Tertiary TDM1 Capture\"},\n\t{\"TERT_TDM_TX_2\", NULL, \"Tertiary TDM2 Capture\"},\n\t{\"TERT_TDM_TX_3\", NULL, \"Tertiary TDM3 Capture\"},\n\t{\"TERT_TDM_TX_4\", NULL, \"Tertiary TDM4 Capture\"},\n\t{\"TERT_TDM_TX_5\", NULL, \"Tertiary TDM5 Capture\"},\n\t{\"TERT_TDM_TX_6\", NULL, \"Tertiary TDM6 Capture\"},\n\t{\"TERT_TDM_TX_7\", NULL, \"Tertiary TDM7 Capture\"},\n\n\t{\"QUAT_TDM_TX_0\", NULL, \"Quaternary TDM0 Capture\"},\n\t{\"QUAT_TDM_TX_1\", NULL, \"Quaternary TDM1 Capture\"},\n\t{\"QUAT_TDM_TX_2\", NULL, \"Quaternary TDM2 Capture\"},\n\t{\"QUAT_TDM_TX_3\", NULL, \"Quaternary TDM3 Capture\"},\n\t{\"QUAT_TDM_TX_4\", NULL, \"Quaternary TDM4 Capture\"},\n\t{\"QUAT_TDM_TX_5\", NULL, \"Quaternary TDM5 Capture\"},\n\t{\"QUAT_TDM_TX_6\", NULL, \"Quaternary TDM6 Capture\"},\n\t{\"QUAT_TDM_TX_7\", NULL, \"Quaternary TDM7 Capture\"},\n\n\t{\"QUIN_TDM_TX_0\", NULL, \"Quinary TDM0 Capture\"},\n\t{\"QUIN_TDM_TX_1\", NULL, \"Quinary TDM1 Capture\"},\n\t{\"QUIN_TDM_TX_2\", NULL, \"Quinary TDM2 Capture\"},\n\t{\"QUIN_TDM_TX_3\", NULL, \"Quinary TDM3 Capture\"},\n\t{\"QUIN_TDM_TX_4\", NULL, \"Quinary TDM4 Capture\"},\n\t{\"QUIN_TDM_TX_5\", NULL, \"Quinary TDM5 Capture\"},\n\t{\"QUIN_TDM_TX_6\", NULL, \"Quinary TDM6 Capture\"},\n\t{\"QUIN_TDM_TX_7\", NULL, \"Quinary TDM7 Capture\"},\n\n\t{\"TERT_MI2S_TX\", NULL, \"Tertiary MI2S Capture\"},\n\t{\"PRI_MI2S_TX\", NULL, \"Primary MI2S Capture\"},\n\t{\"SEC_MI2S_TX\", NULL, \"Secondary MI2S Capture\"},\n\t{\"QUAT_MI2S_TX\", NULL, \"Quaternary MI2S Capture\"},\n\t{\"QUIN_MI2S_TX\", NULL, \"Quinary MI2S Capture\"},\n\n\t{\"WSA_CODEC_DMA_RX_0 Playback\", NULL, \"WSA_CODEC_DMA_RX_0\"},\n\t{\"WSA_CODEC_DMA_TX_0\", NULL, \"WSA_CODEC_DMA_TX_0 Capture\"},\n\t{\"WSA_CODEC_DMA_RX_1 Playback\", NULL, \"WSA_CODEC_DMA_RX_1\"},\n\t{\"WSA_CODEC_DMA_TX_1\", NULL, \"WSA_CODEC_DMA_TX_1 Capture\"},\n\t{\"WSA_CODEC_DMA_TX_2\", NULL, \"WSA_CODEC_DMA_TX_2 Capture\"},\n\t{\"VA_CODEC_DMA_TX_0\", NULL, \"VA_CODEC_DMA_TX_0 Capture\"},\n\t{\"VA_CODEC_DMA_TX_1\", NULL, \"VA_CODEC_DMA_TX_1 Capture\"},\n\t{\"VA_CODEC_DMA_TX_2\", NULL, \"VA_CODEC_DMA_TX_2 Capture\"},\n\t{\"RX_CODEC_DMA_RX_0 Playback\", NULL, \"RX_CODEC_DMA_RX_0\"},\n\t{\"TX_CODEC_DMA_TX_0\", NULL, \"TX_CODEC_DMA_TX_0 Capture\"},\n\t{\"RX_CODEC_DMA_RX_1 Playback\", NULL, \"RX_CODEC_DMA_RX_1\"},\n\t{\"TX_CODEC_DMA_TX_1\", NULL, \"TX_CODEC_DMA_TX_1 Capture\"},\n\t{\"RX_CODEC_DMA_RX_2 Playback\", NULL, \"RX_CODEC_DMA_RX_2\"},\n\t{\"TX_CODEC_DMA_TX_2\", NULL, \"TX_CODEC_DMA_TX_2 Capture\"},\n\t{\"RX_CODEC_DMA_RX_3 Playback\", NULL, \"RX_CODEC_DMA_RX_3\"},\n\t{\"TX_CODEC_DMA_TX_3\", NULL, \"TX_CODEC_DMA_TX_3 Capture\"},\n\t{\"RX_CODEC_DMA_RX_4 Playback\", NULL, \"RX_CODEC_DMA_RX_4\"},\n\t{\"TX_CODEC_DMA_TX_4\", NULL, \"TX_CODEC_DMA_TX_4 Capture\"},\n\t{\"RX_CODEC_DMA_RX_5 Playback\", NULL, \"RX_CODEC_DMA_RX_5\"},\n\t{\"TX_CODEC_DMA_TX_5\", NULL, \"TX_CODEC_DMA_TX_5 Capture\"},\n\t{\"RX_CODEC_DMA_RX_6 Playback\", NULL, \"RX_CODEC_DMA_RX_6\"},\n\t{\"RX_CODEC_DMA_RX_7 Playback\", NULL, \"RX_CODEC_DMA_RX_7\"},\n};\n\nstatic int msm_dai_q6_dai_probe(struct snd_soc_dai *dai)\n{\n\tstruct q6afe_dai_data *dai_data = dev_get_drvdata(dai->dev);\n\tstruct q6afe_port *port;\n\n\tport = q6afe_port_get_from_id(dai->dev, dai->id);\n\tif (IS_ERR(port)) {\n\t\tdev_err(dai->dev, \"Unable to get afe port\\n\");\n\t\treturn -EINVAL;\n\t}\n\tdai_data->port[dai->id] = port;\n\n\treturn 0;\n}\n\nstatic int msm_dai_q6_dai_remove(struct snd_soc_dai *dai)\n{\n\tstruct q6afe_dai_data *dai_data = dev_get_drvdata(dai->dev);\n\n\tq6afe_port_put(dai_data->port[dai->id]);\n\tdai_data->port[dai->id] = NULL;\n\n\treturn 0;\n}\n\nstatic const struct snd_soc_dai_ops q6hdmi_ops = {\n\t.probe\t\t\t= msm_dai_q6_dai_probe,\n\t.remove\t\t\t= msm_dai_q6_dai_remove,\n\t.prepare\t\t= q6afe_dai_prepare,\n\t.hw_params\t\t= q6hdmi_hw_params,\n\t.shutdown\t\t= q6afe_dai_shutdown,\n};\n\nstatic const struct snd_soc_dai_ops q6i2s_ops = {\n\t.probe\t\t\t= msm_dai_q6_dai_probe,\n\t.remove\t\t\t= msm_dai_q6_dai_remove,\n\t.prepare\t\t= q6afe_dai_prepare,\n\t.hw_params\t\t= q6i2s_hw_params,\n\t.set_fmt\t\t= q6i2s_set_fmt,\n\t.shutdown\t\t= q6afe_dai_shutdown,\n\t.set_sysclk\t\t= q6afe_mi2s_set_sysclk,\n};\n\nstatic const struct snd_soc_dai_ops q6slim_ops = {\n\t.probe\t\t\t= msm_dai_q6_dai_probe,\n\t.remove\t\t\t= msm_dai_q6_dai_remove,\n\t.prepare\t\t= q6afe_dai_prepare,\n\t.hw_params\t\t= q6slim_hw_params,\n\t.shutdown\t\t= q6afe_dai_shutdown,\n\t.set_channel_map\t= q6slim_set_channel_map,\n};\n\nstatic const struct snd_soc_dai_ops q6tdm_ops = {\n\t.probe\t\t\t= msm_dai_q6_dai_probe,\n\t.remove\t\t\t= msm_dai_q6_dai_remove,\n\t.prepare\t\t= q6afe_dai_prepare,\n\t.shutdown\t\t= q6afe_dai_shutdown,\n\t.set_sysclk\t\t= q6afe_mi2s_set_sysclk,\n\t.set_tdm_slot\t\t= q6tdm_set_tdm_slot,\n\t.set_channel_map\t= q6tdm_set_channel_map,\n\t.hw_params\t\t= q6tdm_hw_params,\n};\n\nstatic const struct snd_soc_dai_ops q6dma_ops = {\n\t.probe\t\t\t= msm_dai_q6_dai_probe,\n\t.remove\t\t\t= msm_dai_q6_dai_remove,\n\t.prepare\t\t= q6afe_dai_prepare,\n\t.shutdown\t\t= q6afe_dai_shutdown,\n\t.set_sysclk\t\t= q6afe_mi2s_set_sysclk,\n\t.set_channel_map\t= q6dma_set_channel_map,\n\t.hw_params\t\t= q6dma_hw_params,\n};\n\nstatic const struct snd_soc_dapm_widget q6afe_dai_widgets[] = {\n\tSND_SOC_DAPM_AIF_IN(\"HDMI_RX\", NULL, 0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"SLIMBUS_0_RX\", NULL, 0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"SLIMBUS_1_RX\", NULL, 0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"SLIMBUS_2_RX\", NULL, 0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"SLIMBUS_3_RX\", NULL, 0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"SLIMBUS_4_RX\", NULL, 0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"SLIMBUS_5_RX\", NULL, 0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"SLIMBUS_6_RX\", NULL, 0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"SLIMBUS_0_TX\", NULL, 0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"SLIMBUS_1_TX\", NULL, 0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"SLIMBUS_2_TX\", NULL, 0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"SLIMBUS_3_TX\", NULL, 0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"SLIMBUS_4_TX\", NULL, 0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"SLIMBUS_5_TX\", NULL, 0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"SLIMBUS_6_TX\", NULL, 0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"QUIN_MI2S_RX\", NULL,\n\t\t\t\t\t\t0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"QUIN_MI2S_TX\", NULL,\n\t\t\t\t\t\t0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"QUAT_MI2S_RX\", NULL,\n\t\t\t\t\t\t0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"QUAT_MI2S_TX\", NULL,\n\t\t\t\t\t\t0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"TERT_MI2S_RX\", NULL,\n\t\t\t\t\t\t0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"TERT_MI2S_TX\", NULL,\n\t\t\t\t\t\t0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"SEC_MI2S_RX\", NULL,\n\t\t\t     0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"SEC_MI2S_TX\", NULL,\n\t\t\t\t\t\t0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"SEC_MI2S_RX_SD1\",\n\t\t\t\"Secondary MI2S Playback SD1\",\n\t\t\t0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"PRI_MI2S_RX\", NULL,\n\t\t\t     0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"PRI_MI2S_TX\", NULL,\n\t\t\t\t\t\t0, SND_SOC_NOPM, 0, 0),\n\n\tSND_SOC_DAPM_AIF_IN(\"PRIMARY_TDM_RX_0\", NULL,\n\t\t\t     0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"PRIMARY_TDM_RX_1\", NULL,\n\t\t\t     0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"PRIMARY_TDM_RX_2\", NULL,\n\t\t\t     0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"PRIMARY_TDM_RX_3\", NULL,\n\t\t\t     0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"PRIMARY_TDM_RX_4\", NULL,\n\t\t\t     0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"PRIMARY_TDM_RX_5\", NULL,\n\t\t\t     0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"PRIMARY_TDM_RX_6\", NULL,\n\t\t\t     0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"PRIMARY_TDM_RX_7\", NULL,\n\t\t\t     0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"PRIMARY_TDM_TX_0\", NULL,\n\t\t\t\t\t\t0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"PRIMARY_TDM_TX_1\", NULL,\n\t\t\t\t\t\t0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"PRIMARY_TDM_TX_2\", NULL,\n\t\t\t\t\t\t0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"PRIMARY_TDM_TX_3\", NULL,\n\t\t\t\t\t\t0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"PRIMARY_TDM_TX_4\", NULL,\n\t\t\t\t\t\t0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"PRIMARY_TDM_TX_5\", NULL,\n\t\t\t\t\t\t0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"PRIMARY_TDM_TX_6\", NULL,\n\t\t\t\t\t\t0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"PRIMARY_TDM_TX_7\", NULL,\n\t\t\t\t\t\t0, SND_SOC_NOPM, 0, 0),\n\n\tSND_SOC_DAPM_AIF_IN(\"SEC_TDM_RX_0\", NULL,\n\t\t\t     0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"SEC_TDM_RX_1\", NULL,\n\t\t\t     0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"SEC_TDM_RX_2\", NULL,\n\t\t\t     0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"SEC_TDM_RX_3\", NULL,\n\t\t\t     0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"SEC_TDM_RX_4\", NULL,\n\t\t\t     0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"SEC_TDM_RX_5\", NULL,\n\t\t\t     0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"SEC_TDM_RX_6\", NULL,\n\t\t\t     0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"SEC_TDM_RX_7\", NULL,\n\t\t\t     0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"SEC_TDM_TX_0\", NULL,\n\t\t\t\t\t\t0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"SEC_TDM_TX_1\", NULL,\n\t\t\t\t\t\t0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"SEC_TDM_TX_2\", NULL,\n\t\t\t\t\t\t0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"SEC_TDM_TX_3\", NULL,\n\t\t\t\t\t\t0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"SEC_TDM_TX_4\", NULL,\n\t\t\t\t\t\t0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"SEC_TDM_TX_5\", NULL,\n\t\t\t\t\t\t0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"SEC_TDM_TX_6\", NULL,\n\t\t\t\t\t\t0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"SEC_TDM_TX_7\", NULL,\n\t\t\t\t\t\t0, SND_SOC_NOPM, 0, 0),\n\n\tSND_SOC_DAPM_AIF_IN(\"TERT_TDM_RX_0\", NULL,\n\t\t\t     0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"TERT_TDM_RX_1\", NULL,\n\t\t\t     0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"TERT_TDM_RX_2\", NULL,\n\t\t\t     0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"TERT_TDM_RX_3\", NULL,\n\t\t\t     0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"TERT_TDM_RX_4\", NULL,\n\t\t\t     0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"TERT_TDM_RX_5\", NULL,\n\t\t\t     0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"TERT_TDM_RX_6\", NULL,\n\t\t\t     0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"TERT_TDM_RX_7\", NULL,\n\t\t\t     0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"TERT_TDM_TX_0\", NULL,\n\t\t\t\t\t\t0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"TERT_TDM_TX_1\", NULL,\n\t\t\t\t\t\t0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"TERT_TDM_TX_2\", NULL,\n\t\t\t\t\t\t0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"TERT_TDM_TX_3\", NULL,\n\t\t\t\t\t\t0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"TERT_TDM_TX_4\", NULL,\n\t\t\t\t\t\t0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"TERT_TDM_TX_5\", NULL,\n\t\t\t\t\t\t0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"TERT_TDM_TX_6\", NULL,\n\t\t\t\t\t\t0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"TERT_TDM_TX_7\", NULL,\n\t\t\t\t\t\t0, SND_SOC_NOPM, 0, 0),\n\n\tSND_SOC_DAPM_AIF_IN(\"QUAT_TDM_RX_0\", NULL,\n\t\t\t     0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"QUAT_TDM_RX_1\", NULL,\n\t\t\t     0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"QUAT_TDM_RX_2\", NULL,\n\t\t\t     0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"QUAT_TDM_RX_3\", NULL,\n\t\t\t     0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"QUAT_TDM_RX_4\", NULL,\n\t\t\t     0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"QUAT_TDM_RX_5\", NULL,\n\t\t\t     0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"QUAT_TDM_RX_6\", NULL,\n\t\t\t     0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"QUAT_TDM_RX_7\", NULL,\n\t\t\t     0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"QUAT_TDM_TX_0\", NULL,\n\t\t\t\t\t\t0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"QUAT_TDM_TX_1\", NULL,\n\t\t\t\t\t\t0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"QUAT_TDM_TX_2\", NULL,\n\t\t\t\t\t\t0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"QUAT_TDM_TX_3\", NULL,\n\t\t\t\t\t\t0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"QUAT_TDM_TX_4\", NULL,\n\t\t\t\t\t\t0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"QUAT_TDM_TX_5\", NULL,\n\t\t\t\t\t\t0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"QUAT_TDM_TX_6\", NULL,\n\t\t\t\t\t\t0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"QUAT_TDM_TX_7\", NULL,\n\t\t\t\t\t\t0, SND_SOC_NOPM, 0, 0),\n\n\tSND_SOC_DAPM_AIF_IN(\"QUIN_TDM_RX_0\", NULL,\n\t\t\t     0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"QUIN_TDM_RX_1\", NULL,\n\t\t\t     0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"QUIN_TDM_RX_2\", NULL,\n\t\t\t     0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"QUIN_TDM_RX_3\", NULL,\n\t\t\t     0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"QUIN_TDM_RX_4\", NULL,\n\t\t\t     0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"QUIN_TDM_RX_5\", NULL,\n\t\t\t     0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"QUIN_TDM_RX_6\", NULL,\n\t\t\t     0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"QUIN_TDM_RX_7\", NULL,\n\t\t\t     0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"QUIN_TDM_TX_0\", NULL,\n\t\t\t\t\t\t0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"QUIN_TDM_TX_1\", NULL,\n\t\t\t\t\t\t0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"QUIN_TDM_TX_2\", NULL,\n\t\t\t\t\t\t0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"QUIN_TDM_TX_3\", NULL,\n\t\t\t\t\t\t0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"QUIN_TDM_TX_4\", NULL,\n\t\t\t\t\t\t0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"QUIN_TDM_TX_5\", NULL,\n\t\t\t\t\t\t0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"QUIN_TDM_TX_6\", NULL,\n\t\t\t\t\t\t0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"QUIN_TDM_TX_7\", NULL,\n\t\t\t\t\t\t0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"DISPLAY_PORT_RX\", \"NULL\", 0, SND_SOC_NOPM, 0, 0),\n\n\tSND_SOC_DAPM_AIF_IN(\"WSA_CODEC_DMA_RX_0\", \"NULL\",\n\t\t0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"WSA_CODEC_DMA_TX_0\", \"NULL\",\n\t\t 0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"WSA_CODEC_DMA_RX_1\", \"NULL\",\n\t\t0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"WSA_CODEC_DMA_TX_1\", \"NULL\",\n\t\t 0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"WSA_CODEC_DMA_TX_2\", \"NULL\",\n\t\t 0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"VA_CODEC_DMA_TX_0\", \"NULL\",\n\t\t 0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"VA_CODEC_DMA_TX_1\", \"NULL\",\n\t\t 0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"VA_CODEC_DMA_TX_2\", \"NULL\",\n\t\t 0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"RX_CODEC_DMA_RX_0\", \"NULL\",\n\t\t0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"TX_CODEC_DMA_TX_0\", \"NULL\",\n\t\t 0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"RX_CODEC_DMA_RX_1\", \"NULL\",\n\t\t0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"TX_CODEC_DMA_TX_1\", \"NULL\",\n\t\t 0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"RX_CODEC_DMA_RX_2\", \"NULL\",\n\t\t0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"TX_CODEC_DMA_TX_2\", \"NULL\",\n\t\t 0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"RX_CODEC_DMA_RX_3\", \"NULL\",\n\t\t0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"TX_CODEC_DMA_TX_3\", \"NULL\",\n\t\t 0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"RX_CODEC_DMA_RX_4\", \"NULL\",\n\t\t0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"TX_CODEC_DMA_TX_4\", \"NULL\",\n\t\t 0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"RX_CODEC_DMA_RX_5\", \"NULL\",\n\t\t0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"TX_CODEC_DMA_TX_5\", \"NULL\",\n\t\t 0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"RX_CODEC_DMA_RX_6\", \"NULL\",\n\t\t0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"RX_CODEC_DMA_RX_7\", \"NULL\",\n\t\t0, SND_SOC_NOPM, 0, 0),\n};\n\nstatic const struct snd_soc_component_driver q6afe_dai_component = {\n\t.name\t\t= \"q6afe-dai-component\",\n\t.dapm_widgets = q6afe_dai_widgets,\n\t.num_dapm_widgets = ARRAY_SIZE(q6afe_dai_widgets),\n\t.dapm_routes = q6afe_dapm_routes,\n\t.num_dapm_routes = ARRAY_SIZE(q6afe_dapm_routes),\n\t.of_xlate_dai_name = q6dsp_audio_ports_of_xlate_dai_name,\n\n};\n\nstatic void of_q6afe_parse_dai_data(struct device *dev,\n\t\t\t\t    struct q6afe_dai_data *data)\n{\n\tstruct device_node *node;\n\tint ret;\n\n\tfor_each_child_of_node(dev->of_node, node) {\n\t\tunsigned int lines[Q6AFE_MAX_MI2S_LINES];\n\t\tstruct q6afe_dai_priv_data *priv;\n\t\tint id, i, num_lines;\n\n\t\tret = of_property_read_u32(node, \"reg\", &id);\n\t\tif (ret || id < 0 || id >= AFE_PORT_MAX) {\n\t\t\tdev_err(dev, \"valid dai id not found:%d\\n\", ret);\n\t\t\tcontinue;\n\t\t}\n\n\t\tswitch (id) {\n\t\t \n\t\tcase QUINARY_MI2S_RX ... QUINARY_MI2S_TX:\n\t\tcase PRIMARY_MI2S_RX ... QUATERNARY_MI2S_TX:\n\t\t\tpriv = &data->priv[id];\n\t\t\tret = of_property_read_variable_u32_array(node,\n\t\t\t\t\t\t\t\"qcom,sd-lines\",\n\t\t\t\t\t\t\tlines, 0,\n\t\t\t\t\t\t\tQ6AFE_MAX_MI2S_LINES);\n\t\t\tif (ret < 0)\n\t\t\t\tnum_lines = 0;\n\t\t\telse\n\t\t\t\tnum_lines = ret;\n\n\t\t\tpriv->sd_line_mask = 0;\n\n\t\t\tfor (i = 0; i < num_lines; i++)\n\t\t\t\tpriv->sd_line_mask |= BIT(lines[i]);\n\n\t\t\tbreak;\n\t\tcase PRIMARY_TDM_RX_0 ... QUINARY_TDM_TX_7:\n\t\t\tpriv = &data->priv[id];\n\t\t\tret = of_property_read_u32(node, \"qcom,tdm-sync-mode\",\n\t\t\t\t\t\t   &priv->sync_mode);\n\t\t\tif (ret) {\n\t\t\t\tdev_err(dev, \"No Sync mode from DT\\n\");\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tret = of_property_read_u32(node, \"qcom,tdm-sync-src\",\n\t\t\t\t\t\t   &priv->sync_src);\n\t\t\tif (ret) {\n\t\t\t\tdev_err(dev, \"No Sync Src from DT\\n\");\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tret = of_property_read_u32(node, \"qcom,tdm-data-out\",\n\t\t\t\t\t\t   &priv->data_out_enable);\n\t\t\tif (ret) {\n\t\t\t\tdev_err(dev, \"No Data out enable from DT\\n\");\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tret = of_property_read_u32(node, \"qcom,tdm-invert-sync\",\n\t\t\t\t\t\t   &priv->invert_sync);\n\t\t\tif (ret) {\n\t\t\t\tdev_err(dev, \"No Invert sync from DT\\n\");\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tret = of_property_read_u32(node, \"qcom,tdm-data-delay\",\n\t\t\t\t\t\t   &priv->data_delay);\n\t\t\tif (ret) {\n\t\t\t\tdev_err(dev, \"No Data Delay from DT\\n\");\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tret = of_property_read_u32(node, \"qcom,tdm-data-align\",\n\t\t\t\t\t\t   &priv->data_align);\n\t\t\tif (ret) {\n\t\t\t\tdev_err(dev, \"No Data align from DT\\n\");\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tbreak;\n\t\t}\n\t}\n}\n\nstatic int q6afe_dai_dev_probe(struct platform_device *pdev)\n{\n\tstruct q6dsp_audio_port_dai_driver_config cfg;\n\tstruct snd_soc_dai_driver *dais;\n\tstruct q6afe_dai_data *dai_data;\n\tstruct device *dev = &pdev->dev;\n\tint num_dais;\n\n\tdai_data = devm_kzalloc(dev, sizeof(*dai_data), GFP_KERNEL);\n\tif (!dai_data)\n\t\treturn -ENOMEM;\n\n\tdev_set_drvdata(dev, dai_data);\n\tof_q6afe_parse_dai_data(dev, dai_data);\n\n\tcfg.q6hdmi_ops = &q6hdmi_ops;\n\tcfg.q6slim_ops = &q6slim_ops;\n\tcfg.q6i2s_ops = &q6i2s_ops;\n\tcfg.q6tdm_ops = &q6tdm_ops;\n\tcfg.q6dma_ops = &q6dma_ops;\n\tdais = q6dsp_audio_ports_set_config(dev, &cfg, &num_dais);\n\n\treturn devm_snd_soc_register_component(dev, &q6afe_dai_component, dais, num_dais);\n}\n\n#ifdef CONFIG_OF\nstatic const struct of_device_id q6afe_dai_device_id[] = {\n\t{ .compatible = \"qcom,q6afe-dais\" },\n\t{},\n};\nMODULE_DEVICE_TABLE(of, q6afe_dai_device_id);\n#endif\n\nstatic struct platform_driver q6afe_dai_platform_driver = {\n\t.driver = {\n\t\t.name = \"q6afe-dai\",\n\t\t.of_match_table = of_match_ptr(q6afe_dai_device_id),\n\t},\n\t.probe = q6afe_dai_dev_probe,\n};\nmodule_platform_driver(q6afe_dai_platform_driver);\n\nMODULE_DESCRIPTION(\"Q6 Audio Frontend dai driver\");\nMODULE_LICENSE(\"GPL v2\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}