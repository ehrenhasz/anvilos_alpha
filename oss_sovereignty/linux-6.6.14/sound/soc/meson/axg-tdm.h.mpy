{
  "module_name": "axg-tdm.h",
  "hash_id": "d8951e0dcbf6f994fcd103a40715f68c9837a61d298046140feb901f876626e9",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/meson/axg-tdm.h",
  "human_readable_source": " \n\n#ifndef _MESON_AXG_TDM_H\n#define _MESON_AXG_TDM_H\n\n#include <linux/clk.h>\n#include <linux/regmap.h>\n#include <sound/pcm.h>\n#include <sound/soc.h>\n#include <sound/soc-dai.h>\n\n#define AXG_TDM_NUM_LANES\t4\n#define AXG_TDM_CHANNEL_MAX\t128\n#define AXG_TDM_RATES\t\t(SNDRV_PCM_RATE_5512 |\t\t\\\n\t\t\t\t SNDRV_PCM_RATE_8000_192000)\n#define AXG_TDM_FORMATS\t\t(SNDRV_PCM_FMTBIT_S8 |\t\t\\\n\t\t\t\t SNDRV_PCM_FMTBIT_S16_LE |\t\\\n\t\t\t\t SNDRV_PCM_FMTBIT_S20_LE |\t\\\n\t\t\t\t SNDRV_PCM_FMTBIT_S24_LE |\t\\\n\t\t\t\t SNDRV_PCM_FMTBIT_S32_LE)\n\nstruct axg_tdm_iface {\n\tstruct clk *sclk;\n\tstruct clk *lrclk;\n\tstruct clk *mclk;\n\tunsigned long mclk_rate;\n\n\t \n\tunsigned int fmt;\n\tunsigned int slots;\n\tunsigned int slot_width;\n\n\t \n\tint rate;\n};\n\nstatic inline bool axg_tdm_lrclk_invert(unsigned int fmt)\n{\n\treturn ((fmt & SND_SOC_DAIFMT_FORMAT_MASK) == SND_SOC_DAIFMT_I2S) ^\n\t\t!!(fmt & (SND_SOC_DAIFMT_IB_IF | SND_SOC_DAIFMT_NB_IF));\n}\n\nstatic inline bool axg_tdm_sclk_invert(unsigned int fmt)\n{\n\treturn fmt & (SND_SOC_DAIFMT_IB_IF | SND_SOC_DAIFMT_IB_NF);\n}\n\nstruct axg_tdm_stream {\n\tstruct axg_tdm_iface *iface;\n\tstruct list_head formatter_list;\n\tstruct mutex lock;\n\tunsigned int channels;\n\tunsigned int width;\n\tunsigned int physical_width;\n\tu32 *mask;\n\tbool ready;\n};\n\nstruct axg_tdm_stream *axg_tdm_stream_alloc(struct axg_tdm_iface *iface);\nvoid axg_tdm_stream_free(struct axg_tdm_stream *ts);\nint axg_tdm_stream_start(struct axg_tdm_stream *ts);\nvoid axg_tdm_stream_stop(struct axg_tdm_stream *ts);\n\nstatic inline int axg_tdm_stream_reset(struct axg_tdm_stream *ts)\n{\n\taxg_tdm_stream_stop(ts);\n\treturn axg_tdm_stream_start(ts);\n}\n\nint axg_tdm_set_tdm_slots(struct snd_soc_dai *dai, u32 *tx_mask,\n\t\t\t  u32 *rx_mask, unsigned int slots,\n\t\t\t  unsigned int slot_width);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}