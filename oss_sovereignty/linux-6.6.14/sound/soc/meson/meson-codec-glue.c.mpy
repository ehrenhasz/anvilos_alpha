{
  "module_name": "meson-codec-glue.c",
  "hash_id": "b5870d3f0b4f496d7688bc6b98ff418acf5dab9742f501c4f8db66ef25b869b5",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/meson/meson-codec-glue.c",
  "human_readable_source": "\n\n\n\n\n#include <linux/module.h>\n#include <sound/pcm_params.h>\n#include <sound/soc.h>\n#include <sound/soc-dai.h>\n\n#include \"meson-codec-glue.h\"\n\nstatic struct snd_soc_dapm_widget *\nmeson_codec_glue_get_input(struct snd_soc_dapm_widget *w)\n{\n\tstruct snd_soc_dapm_path *p;\n\tstruct snd_soc_dapm_widget *in;\n\n\tsnd_soc_dapm_widget_for_each_source_path(w, p) {\n\t\tif (!p->connect)\n\t\t\tcontinue;\n\n\t\t \n\t\tif (snd_soc_dapm_to_component(w->dapm) !=\n\t\t    snd_soc_dapm_to_component(p->source->dapm))\n\t\t\tcontinue;\n\n\t\tif (p->source->id == snd_soc_dapm_dai_in)\n\t\t\treturn p->source;\n\n\t\tin = meson_codec_glue_get_input(p->source);\n\t\tif (in)\n\t\t\treturn in;\n\t}\n\n\treturn NULL;\n}\n\nstatic void meson_codec_glue_input_set_data(struct snd_soc_dai *dai,\n\t\t\t\t\t    struct meson_codec_glue_input *data)\n{\n\tsnd_soc_dai_dma_data_set_playback(dai, data);\n}\n\nstruct meson_codec_glue_input *\nmeson_codec_glue_input_get_data(struct snd_soc_dai *dai)\n{\n\treturn snd_soc_dai_dma_data_get_playback(dai);\n}\nEXPORT_SYMBOL_GPL(meson_codec_glue_input_get_data);\n\nstatic struct meson_codec_glue_input *\nmeson_codec_glue_output_get_input_data(struct snd_soc_dapm_widget *w)\n{\n\tstruct snd_soc_dapm_widget *in =\n\t\tmeson_codec_glue_get_input(w);\n\tstruct snd_soc_dai *dai;\n\n\tif (WARN_ON(!in))\n\t\treturn NULL;\n\n\tdai = in->priv;\n\n\treturn meson_codec_glue_input_get_data(dai);\n}\n\nint meson_codec_glue_input_hw_params(struct snd_pcm_substream *substream,\n\t\t\t\t     struct snd_pcm_hw_params *params,\n\t\t\t\t     struct snd_soc_dai *dai)\n{\n\tstruct meson_codec_glue_input *data =\n\t\tmeson_codec_glue_input_get_data(dai);\n\n\tdata->params.rates = snd_pcm_rate_to_rate_bit(params_rate(params));\n\tdata->params.rate_min = params_rate(params);\n\tdata->params.rate_max = params_rate(params);\n\tdata->params.formats = 1ULL << (__force int) params_format(params);\n\tdata->params.channels_min = params_channels(params);\n\tdata->params.channels_max = params_channels(params);\n\tdata->params.sig_bits = dai->driver->playback.sig_bits;\n\n\treturn 0;\n}\nEXPORT_SYMBOL_GPL(meson_codec_glue_input_hw_params);\n\nint meson_codec_glue_input_set_fmt(struct snd_soc_dai *dai,\n\t\t\t\t   unsigned int fmt)\n{\n\tstruct meson_codec_glue_input *data =\n\t\tmeson_codec_glue_input_get_data(dai);\n\n\t \n\tdata->fmt = fmt;\n\treturn 0;\n}\nEXPORT_SYMBOL_GPL(meson_codec_glue_input_set_fmt);\n\nint meson_codec_glue_output_startup(struct snd_pcm_substream *substream,\n\t\t\t\t    struct snd_soc_dai *dai)\n{\n\tstruct snd_soc_pcm_runtime *rtd = asoc_substream_to_rtd(substream);\n\tstruct snd_soc_dapm_widget *w = snd_soc_dai_get_widget_capture(dai);\n\tstruct meson_codec_glue_input *in_data = meson_codec_glue_output_get_input_data(w);\n\n\tif (!in_data)\n\t\treturn -ENODEV;\n\n\tif (WARN_ON(!rtd->dai_link->c2c_params)) {\n\t\tdev_warn(dai->dev, \"codec2codec link expected\\n\");\n\t\treturn -EINVAL;\n\t}\n\n\t \n\trtd->dai_link->c2c_params = &in_data->params;\n\trtd->dai_link->num_c2c_params = 1;\n\n\treturn snd_soc_runtime_set_dai_fmt(rtd, in_data->fmt);\n}\nEXPORT_SYMBOL_GPL(meson_codec_glue_output_startup);\n\nint meson_codec_glue_input_dai_probe(struct snd_soc_dai *dai)\n{\n\tstruct meson_codec_glue_input *data;\n\n\tdata = kzalloc(sizeof(*data), GFP_KERNEL);\n\tif (!data)\n\t\treturn -ENOMEM;\n\n\tmeson_codec_glue_input_set_data(dai, data);\n\treturn 0;\n}\nEXPORT_SYMBOL_GPL(meson_codec_glue_input_dai_probe);\n\nint meson_codec_glue_input_dai_remove(struct snd_soc_dai *dai)\n{\n\tstruct meson_codec_glue_input *data =\n\t\tmeson_codec_glue_input_get_data(dai);\n\n\tkfree(data);\n\treturn 0;\n}\nEXPORT_SYMBOL_GPL(meson_codec_glue_input_dai_remove);\n\nMODULE_AUTHOR(\"Jerome Brunet <jbrunet@baylibre.com>\");\nMODULE_DESCRIPTION(\"Amlogic Codec Glue Helpers\");\nMODULE_LICENSE(\"GPL v2\");\n\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}