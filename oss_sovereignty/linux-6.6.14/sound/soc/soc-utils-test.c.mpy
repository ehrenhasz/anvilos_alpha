{
  "module_name": "soc-utils-test.c",
  "hash_id": "6477a010882607fee49f8d07f8af54238269bada79840b889045bb2e121e5ad7",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/soc-utils-test.c",
  "human_readable_source": "\n\n\n\n#include <kunit/test.h>\n#include <linux/module.h>\n#include <sound/pcm.h>\n#include <sound/pcm_params.h>\n#include <sound/soc.h>\n#include <uapi/sound/asound.h>\n\nstatic const struct {\n\tu32 rate;\n\tsnd_pcm_format_t fmt;\n\tu8 channels;\n\tu8 tdm_width;\n\tu8 tdm_slots;\n\tu8 slot_multiple;\n\tu32 bclk;\n} tdm_params_to_bclk_cases[] = {\n\t \n\n\t \n\t{   8000,  SNDRV_PCM_FORMAT_S16_LE, 1,\t0,\t0,\t0,\t  128000 },\n\t{   8000,  SNDRV_PCM_FORMAT_S16_LE, 2,\t0,\t0,\t0,\t  256000 },\n\t{   8000,  SNDRV_PCM_FORMAT_S24_LE, 1,\t0,\t0,\t0,\t  192000 },\n\t{   8000,  SNDRV_PCM_FORMAT_S24_LE, 2,\t0,\t0,\t0,\t  384000 },\n\t{   8000,  SNDRV_PCM_FORMAT_S32_LE, 1,\t0,\t0,\t0,\t  256000 },\n\t{   8000,  SNDRV_PCM_FORMAT_S32_LE, 2,\t0,\t0,\t0,\t  512000 },\n\t{  44100,  SNDRV_PCM_FORMAT_S16_LE, 1,\t0,\t0,\t0,\t  705600 },\n\t{  44100,  SNDRV_PCM_FORMAT_S16_LE, 2,\t0,\t0,\t0,\t 1411200 },\n\t{  44100,  SNDRV_PCM_FORMAT_S24_LE, 1,\t0,\t0,\t0,\t 1058400 },\n\t{  44100,  SNDRV_PCM_FORMAT_S24_LE, 2,\t0,\t0,\t0,\t 2116800 },\n\t{  44100,  SNDRV_PCM_FORMAT_S32_LE, 1,\t0,\t0,\t0,\t 1411200 },\n\t{  44100,  SNDRV_PCM_FORMAT_S32_LE, 2,\t0,\t0,\t0,\t 2822400 },\n\t{ 384000,  SNDRV_PCM_FORMAT_S16_LE, 1,\t0,\t0,\t0,\t 6144000 },\n\t{ 384000,  SNDRV_PCM_FORMAT_S16_LE, 2,\t0,\t0,\t0,\t12288000 },\n\t{ 384000,  SNDRV_PCM_FORMAT_S24_LE, 1,\t0,\t0,\t0,\t 9216000 },\n\t{ 384000,  SNDRV_PCM_FORMAT_S24_LE, 2,\t0,\t0,\t0,\t18432000 },\n\t{ 384000,  SNDRV_PCM_FORMAT_S32_LE, 1,\t0,\t0,\t0,\t12288000 },\n\t{ 384000,  SNDRV_PCM_FORMAT_S32_LE, 2,\t0,\t0,\t0,\t24576000 },\n\n\t \n\t{   8000,  SNDRV_PCM_FORMAT_S16_LE, 1,\t0,\t0,\t2,\t  256000 },\n\t{   8000,  SNDRV_PCM_FORMAT_S16_LE, 2,\t0,\t0,\t2,\t  256000 },\n\t{   8000,  SNDRV_PCM_FORMAT_S24_LE, 1,\t0,\t0,\t2,\t  384000 },\n\t{   8000,  SNDRV_PCM_FORMAT_S24_LE, 2,\t0,\t0,\t2,\t  384000 },\n\t{   8000,  SNDRV_PCM_FORMAT_S32_LE, 1,\t0,\t0,\t2,\t  512000 },\n\t{   8000,  SNDRV_PCM_FORMAT_S32_LE, 2,\t0,\t0,\t2,\t  512000 },\n\t{  44100,  SNDRV_PCM_FORMAT_S16_LE, 1,\t0,\t0,\t2,\t 1411200 },\n\t{  44100,  SNDRV_PCM_FORMAT_S16_LE, 2,\t0,\t0,\t2,\t 1411200 },\n\t{  44100,  SNDRV_PCM_FORMAT_S24_LE, 1,\t0,\t0,\t2,\t 2116800 },\n\t{  44100,  SNDRV_PCM_FORMAT_S24_LE, 2,\t0,\t0,\t2,\t 2116800 },\n\t{  44100,  SNDRV_PCM_FORMAT_S32_LE, 1,\t0,\t0,\t2,\t 2822400 },\n\t{  44100,  SNDRV_PCM_FORMAT_S32_LE, 2,\t0,\t0,\t2,\t 2822400 },\n\t{ 384000,  SNDRV_PCM_FORMAT_S16_LE, 1,\t0,\t0,\t2,\t12288000 },\n\t{ 384000,  SNDRV_PCM_FORMAT_S16_LE, 2,\t0,\t0,\t2,\t12288000 },\n\t{ 384000,  SNDRV_PCM_FORMAT_S24_LE, 1,\t0,\t0,\t2,\t18432000 },\n\t{ 384000,  SNDRV_PCM_FORMAT_S24_LE, 2,\t0,\t0,\t2,\t18432000 },\n\t{ 384000,  SNDRV_PCM_FORMAT_S32_LE, 1,\t0,\t0,\t2,\t24576000 },\n\t{ 384000,  SNDRV_PCM_FORMAT_S32_LE, 2,\t0,\t0,\t2,\t24576000 },\n\n\t \n\t{   8000,  SNDRV_PCM_FORMAT_S16_LE, 1,\t0,\t8,\t0,\t 1024000 },\n\t{   8000,  SNDRV_PCM_FORMAT_S16_LE, 2,\t0,\t8,\t0,\t 1024000 },\n\t{   8000,  SNDRV_PCM_FORMAT_S16_LE, 3,\t0,\t8,\t0,\t 1024000 },\n\t{   8000,  SNDRV_PCM_FORMAT_S16_LE, 4,\t0,\t8,\t0,\t 1024000 },\n\t{   8000,  SNDRV_PCM_FORMAT_S32_LE, 1,\t0,\t8,\t0,\t 2048000 },\n\t{   8000,  SNDRV_PCM_FORMAT_S32_LE, 2,\t0,\t8,\t0,\t 2048000 },\n\t{   8000,  SNDRV_PCM_FORMAT_S32_LE, 3,\t0,\t8,\t0,\t 2048000 },\n\t{   8000,  SNDRV_PCM_FORMAT_S32_LE, 4,\t0,\t8,\t0,\t 2048000 },\n\t{ 384000,  SNDRV_PCM_FORMAT_S16_LE, 1,\t0,\t8,\t0,\t49152000 },\n\t{ 384000,  SNDRV_PCM_FORMAT_S16_LE, 2,\t0,\t8,\t0,\t49152000 },\n\t{ 384000,  SNDRV_PCM_FORMAT_S16_LE, 3,\t0,\t8,\t0,\t49152000 },\n\t{ 384000,  SNDRV_PCM_FORMAT_S16_LE, 4,\t0,\t8,\t0,\t49152000 },\n\t{ 384000,  SNDRV_PCM_FORMAT_S32_LE, 1,\t0,\t8,\t0,\t98304000 },\n\t{ 384000,  SNDRV_PCM_FORMAT_S32_LE, 2,\t0,\t8,\t0,\t98304000 },\n\t{ 384000,  SNDRV_PCM_FORMAT_S32_LE, 3,\t0,\t8,\t0,\t98304000 },\n\t{ 384000,  SNDRV_PCM_FORMAT_S32_LE, 4,\t0,\t8,\t0,\t98304000 },\n\n\t \n\t{   8000,  SNDRV_PCM_FORMAT_S16_LE, 1,\t32,\t0,\t0,\t  256000 },\n\t{   8000,  SNDRV_PCM_FORMAT_S16_LE, 2,\t32,\t0,\t0,\t  512000 },\n\t{   8000,  SNDRV_PCM_FORMAT_S16_LE, 3,\t32,\t0,\t0,\t  768000 },\n\t{   8000,  SNDRV_PCM_FORMAT_S16_LE, 4,\t32,\t0,\t0,\t 1024000 },\n\t{   8000,  SNDRV_PCM_FORMAT_S32_LE, 1,\t32,\t0,\t0,\t  256000 },\n\t{   8000,  SNDRV_PCM_FORMAT_S32_LE, 2,\t32,\t0,\t0,\t  512000 },\n\t{   8000,  SNDRV_PCM_FORMAT_S32_LE, 3,\t32,\t0,\t0,\t  768000 },\n\t{   8000,  SNDRV_PCM_FORMAT_S32_LE, 4,\t32,\t0,\t0,\t 1024000 },\n\t{ 384000,  SNDRV_PCM_FORMAT_S16_LE, 1,\t32,\t0,\t0,\t12288000 },\n\t{ 384000,  SNDRV_PCM_FORMAT_S16_LE, 2,\t32,\t0,\t0,\t24576000 },\n\t{ 384000,  SNDRV_PCM_FORMAT_S16_LE, 3,\t32,\t0,\t0,\t36864000 },\n\t{ 384000,  SNDRV_PCM_FORMAT_S16_LE, 4,\t32,\t0,\t0,\t49152000 },\n\t{ 384000,  SNDRV_PCM_FORMAT_S32_LE, 1,\t32,\t0,\t0,\t12288000 },\n\t{ 384000,  SNDRV_PCM_FORMAT_S32_LE, 2,\t32,\t0,\t0,\t24576000 },\n\t{ 384000,  SNDRV_PCM_FORMAT_S32_LE, 3,\t32,\t0,\t0,\t36864000 },\n\t{ 384000,  SNDRV_PCM_FORMAT_S32_LE, 4,\t32,\t0,\t0,\t49152000 },\n\n\t \n\t{   8000,  SNDRV_PCM_FORMAT_S16_LE, 1,\t24,\t6,\t0,\t 1152000 },\n\t{   8000,  SNDRV_PCM_FORMAT_S16_LE, 2,\t24,\t6,\t0,\t 1152000 },\n\t{   8000,  SNDRV_PCM_FORMAT_S16_LE, 3,\t24,\t6,\t0,\t 1152000 },\n\t{   8000,  SNDRV_PCM_FORMAT_S16_LE, 4,\t24,\t6,\t0,\t 1152000 },\n\t{   8000,  SNDRV_PCM_FORMAT_S24_LE, 1,\t24,\t6,\t0,\t 1152000 },\n\t{   8000,  SNDRV_PCM_FORMAT_S24_LE, 2,\t24,\t6,\t0,\t 1152000 },\n\t{   8000,  SNDRV_PCM_FORMAT_S24_LE, 3,\t24,\t6,\t0,\t 1152000 },\n\t{   8000,  SNDRV_PCM_FORMAT_S24_LE, 4,\t24,\t6,\t0,\t 1152000 },\n\t{ 192000,  SNDRV_PCM_FORMAT_S16_LE, 1,\t24,\t6,\t0,\t27648000 },\n\t{ 192000,  SNDRV_PCM_FORMAT_S16_LE, 2,\t24,\t6,\t0,\t27648000 },\n\t{ 192000,  SNDRV_PCM_FORMAT_S16_LE, 3,\t24,\t6,\t0,\t27648000 },\n\t{ 192000,  SNDRV_PCM_FORMAT_S16_LE, 4,\t24,\t6,\t0,\t27648000 },\n\t{ 192000,  SNDRV_PCM_FORMAT_S24_LE, 1,\t24,\t6,\t0,\t27648000 },\n\t{ 192000,  SNDRV_PCM_FORMAT_S24_LE, 2,\t24,\t6,\t0,\t27648000 },\n\t{ 192000,  SNDRV_PCM_FORMAT_S24_LE, 3,\t24,\t6,\t0,\t27648000 },\n\t{ 192000,  SNDRV_PCM_FORMAT_S24_LE, 4,\t24,\t6,\t0,\t27648000 },\n};\n\nstatic void test_tdm_params_to_bclk_one(struct kunit *test,\n\t\t\t\t\tunsigned int rate, snd_pcm_format_t fmt,\n\t\t\t\t\tunsigned int channels,\n\t\t\t\t\tunsigned int tdm_width, unsigned int tdm_slots,\n\t\t\t\t\tunsigned int slot_multiple,\n\t\t\t\t\tunsigned int expected_bclk)\n{\n\tstruct snd_pcm_hw_params params;\n\tint got_bclk;\n\n\t_snd_pcm_hw_params_any(&params);\n\tsnd_mask_none(hw_param_mask(&params, SNDRV_PCM_HW_PARAM_FORMAT));\n\thw_param_interval(&params, SNDRV_PCM_HW_PARAM_RATE)->min = rate;\n\thw_param_interval(&params, SNDRV_PCM_HW_PARAM_RATE)->max = rate;\n\thw_param_interval(&params, SNDRV_PCM_HW_PARAM_CHANNELS)->min = channels;\n\thw_param_interval(&params, SNDRV_PCM_HW_PARAM_CHANNELS)->max = channels;\n\tparams_set_format(&params, fmt);\n\n\tgot_bclk = snd_soc_tdm_params_to_bclk(&params, tdm_width, tdm_slots, slot_multiple);\n\tpr_debug(\"%s: r=%u sb=%u ch=%u tw=%u ts=%u sm=%u expected=%u got=%d\\n\",\n\t\t __func__,\n\t\t rate, params_width(&params), channels, tdm_width, tdm_slots, slot_multiple,\n\t\t expected_bclk, got_bclk);\n\tKUNIT_ASSERT_EQ(test, expected_bclk, (unsigned int)got_bclk);\n}\n\nstatic void test_tdm_params_to_bclk(struct kunit *test)\n{\n\tint i;\n\n\tfor (i = 0; i < ARRAY_SIZE(tdm_params_to_bclk_cases); ++i) {\n\t\ttest_tdm_params_to_bclk_one(test,\n\t\t\t\t\t    tdm_params_to_bclk_cases[i].rate,\n\t\t\t\t\t    tdm_params_to_bclk_cases[i].fmt,\n\t\t\t\t\t    tdm_params_to_bclk_cases[i].channels,\n\t\t\t\t\t    tdm_params_to_bclk_cases[i].tdm_width,\n\t\t\t\t\t    tdm_params_to_bclk_cases[i].tdm_slots,\n\t\t\t\t\t    tdm_params_to_bclk_cases[i].slot_multiple,\n\t\t\t\t\t    tdm_params_to_bclk_cases[i].bclk);\n\n\t\tif (tdm_params_to_bclk_cases[i].slot_multiple > 0)\n\t\t\tcontinue;\n\n\t\t \n\t\ttest_tdm_params_to_bclk_one(test,\n\t\t\t\t\t    tdm_params_to_bclk_cases[i].rate,\n\t\t\t\t\t    tdm_params_to_bclk_cases[i].fmt,\n\t\t\t\t\t    tdm_params_to_bclk_cases[i].channels,\n\t\t\t\t\t    tdm_params_to_bclk_cases[i].tdm_width,\n\t\t\t\t\t    tdm_params_to_bclk_cases[i].tdm_slots,\n\t\t\t\t\t    1,\n\t\t\t\t\t    tdm_params_to_bclk_cases[i].bclk);\n\t}\n}\n\nstatic void test_snd_soc_params_to_bclk_one(struct kunit *test,\n\t\t\t\t\t    unsigned int rate, snd_pcm_format_t fmt,\n\t\t\t\t\t    unsigned int channels,\n\t\t\t\t\t    unsigned int expected_bclk)\n{\n\tstruct snd_pcm_hw_params params;\n\tint got_bclk;\n\n\t_snd_pcm_hw_params_any(&params);\n\tsnd_mask_none(hw_param_mask(&params, SNDRV_PCM_HW_PARAM_FORMAT));\n\thw_param_interval(&params, SNDRV_PCM_HW_PARAM_RATE)->min = rate;\n\thw_param_interval(&params, SNDRV_PCM_HW_PARAM_RATE)->max = rate;\n\thw_param_interval(&params, SNDRV_PCM_HW_PARAM_CHANNELS)->min = channels;\n\thw_param_interval(&params, SNDRV_PCM_HW_PARAM_CHANNELS)->max = channels;\n\tparams_set_format(&params, fmt);\n\n\tgot_bclk = snd_soc_params_to_bclk(&params);\n\tpr_debug(\"%s: r=%u sb=%u ch=%u expected=%u got=%d\\n\",\n\t\t __func__,\n\t\t rate, params_width(&params), channels, expected_bclk, got_bclk);\n\tKUNIT_ASSERT_EQ(test, expected_bclk, (unsigned int)got_bclk);\n}\n\nstatic void test_snd_soc_params_to_bclk(struct kunit *test)\n{\n\tint i;\n\n\tfor (i = 0; i < ARRAY_SIZE(tdm_params_to_bclk_cases); ++i) {\n\t\t \n\t\tif (tdm_params_to_bclk_cases[i].tdm_width |\n\t\t    tdm_params_to_bclk_cases[i].tdm_slots |\n\t\t    tdm_params_to_bclk_cases[i].slot_multiple)\n\t\t\tcontinue;\n\n\t\ttest_snd_soc_params_to_bclk_one(test,\n\t\t\t\t\t\ttdm_params_to_bclk_cases[i].rate,\n\t\t\t\t\t\ttdm_params_to_bclk_cases[i].fmt,\n\t\t\t\t\t\ttdm_params_to_bclk_cases[i].channels,\n\t\t\t\t\t\ttdm_params_to_bclk_cases[i].bclk);\n\t}\n}\n\nstatic struct kunit_case soc_utils_test_cases[] = {\n\tKUNIT_CASE(test_tdm_params_to_bclk),\n\tKUNIT_CASE(test_snd_soc_params_to_bclk),\n\t{}\n};\n\nstatic struct kunit_suite soc_utils_test_suite = {\n\t.name = \"soc-utils\",\n\t.test_cases = soc_utils_test_cases,\n};\n\nkunit_test_suites(&soc_utils_test_suite);\n\nMODULE_DESCRIPTION(\"ASoC soc-utils kunit test\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}