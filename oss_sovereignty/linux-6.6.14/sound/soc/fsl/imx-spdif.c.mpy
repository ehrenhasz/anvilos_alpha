{
  "module_name": "imx-spdif.c",
  "hash_id": "0d6683ab12d319568bbd6bbcf22cd3c739393f6a506d6cbcf561042e1e57de80",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/fsl/imx-spdif.c",
  "human_readable_source": "\n\n\n\n#include <linux/module.h>\n#include <linux/of_platform.h>\n#include <sound/soc.h>\n\nstruct imx_spdif_data {\n\tstruct snd_soc_dai_link dai;\n\tstruct snd_soc_card card;\n};\n\nstatic int imx_spdif_audio_probe(struct platform_device *pdev)\n{\n\tstruct device_node *spdif_np, *np = pdev->dev.of_node;\n\tstruct imx_spdif_data *data;\n\tstruct snd_soc_dai_link_component *comp;\n\tint ret = 0;\n\n\tspdif_np = of_parse_phandle(np, \"spdif-controller\", 0);\n\tif (!spdif_np) {\n\t\tdev_err(&pdev->dev, \"failed to find spdif-controller\\n\");\n\t\tret = -EINVAL;\n\t\tgoto end;\n\t}\n\n\tdata = devm_kzalloc(&pdev->dev, sizeof(*data), GFP_KERNEL);\n\tcomp = devm_kzalloc(&pdev->dev, sizeof(*comp), GFP_KERNEL);\n\tif (!data || !comp) {\n\t\tret = -ENOMEM;\n\t\tgoto end;\n\t}\n\n\t \n\tdata->dai.cpus\t\t=\n\tdata->dai.platforms\t= comp;\n\tdata->dai.codecs\t= &asoc_dummy_dlc;\n\n\tdata->dai.num_cpus\t= 1;\n\tdata->dai.num_codecs\t= 1;\n\tdata->dai.num_platforms\t= 1;\n\n\tdata->dai.name = \"S/PDIF PCM\";\n\tdata->dai.stream_name = \"S/PDIF PCM\";\n\tdata->dai.cpus->of_node = spdif_np;\n\tdata->dai.playback_only = true;\n\tdata->dai.capture_only = true;\n\n\tif (of_property_read_bool(np, \"spdif-out\"))\n\t\tdata->dai.capture_only = false;\n\n\tif (of_property_read_bool(np, \"spdif-in\"))\n\t\tdata->dai.playback_only = false;\n\n\tif (data->dai.playback_only && data->dai.capture_only) {\n\t\tdev_err(&pdev->dev, \"no enabled S/PDIF DAI link\\n\");\n\t\tgoto end;\n\t}\n\n\tdata->card.dev = &pdev->dev;\n\tdata->card.dai_link = &data->dai;\n\tdata->card.num_links = 1;\n\tdata->card.owner = THIS_MODULE;\n\n\tret = snd_soc_of_parse_card_name(&data->card, \"model\");\n\tif (ret)\n\t\tgoto end;\n\n\tret = devm_snd_soc_register_card(&pdev->dev, &data->card);\n\tif (ret)\n\t\tdev_err_probe(&pdev->dev, ret, \"snd_soc_register_card failed\\n\");\n\nend:\n\tof_node_put(spdif_np);\n\n\treturn ret;\n}\n\nstatic const struct of_device_id imx_spdif_dt_ids[] = {\n\t{ .compatible = \"fsl,imx-audio-spdif\", },\n\t{   }\n};\nMODULE_DEVICE_TABLE(of, imx_spdif_dt_ids);\n\nstatic struct platform_driver imx_spdif_driver = {\n\t.driver = {\n\t\t.name = \"imx-spdif\",\n\t\t.pm = &snd_soc_pm_ops,\n\t\t.of_match_table = imx_spdif_dt_ids,\n\t},\n\t.probe = imx_spdif_audio_probe,\n};\n\nmodule_platform_driver(imx_spdif_driver);\n\nMODULE_AUTHOR(\"Freescale Semiconductor, Inc.\");\nMODULE_DESCRIPTION(\"Freescale i.MX S/PDIF machine driver\");\nMODULE_LICENSE(\"GPL v2\");\nMODULE_ALIAS(\"platform:imx-spdif\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}