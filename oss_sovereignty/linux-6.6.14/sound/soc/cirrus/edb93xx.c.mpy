{
  "module_name": "edb93xx.c",
  "hash_id": "576a12ab928f05e19ec5f4c96c74688eeeb488069dae619c257da3d6e84b078c",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/cirrus/edb93xx.c",
  "human_readable_source": "\n \n\n#include <linux/platform_device.h>\n#include <linux/gpio.h>\n#include <linux/module.h>\n#include <linux/soc/cirrus/ep93xx.h>\n#include <sound/core.h>\n#include <sound/pcm.h>\n#include <sound/soc.h>\n#include <asm/mach-types.h>\n\nstatic int edb93xx_hw_params(struct snd_pcm_substream *substream,\n\t\t\t     struct snd_pcm_hw_params *params)\n{\n\tstruct snd_soc_pcm_runtime *rtd = asoc_substream_to_rtd(substream);\n\tstruct snd_soc_dai *codec_dai = asoc_rtd_to_codec(rtd, 0);\n\tstruct snd_soc_dai *cpu_dai = asoc_rtd_to_cpu(rtd, 0);\n\tint err;\n\tunsigned int mclk_rate;\n\tunsigned int rate = params_rate(params);\n\n\t \n\tif (rate < 50000)\n\t\tmclk_rate = rate * 64 * 4;\n\telse\n\t\tmclk_rate = rate * 64 * 2;\n\n\terr = snd_soc_dai_set_sysclk(codec_dai, 0, mclk_rate,\n\t\t\t\t     SND_SOC_CLOCK_IN);\n\tif (err)\n\t\treturn err;\n\n\treturn snd_soc_dai_set_sysclk(cpu_dai, 0, mclk_rate,\n\t\t\t\t      SND_SOC_CLOCK_OUT);\n}\n\nstatic const struct snd_soc_ops edb93xx_ops = {\n\t.hw_params\t= edb93xx_hw_params,\n};\n\nSND_SOC_DAILINK_DEFS(hifi,\n\tDAILINK_COMP_ARRAY(COMP_CPU(\"ep93xx-i2s\")),\n\tDAILINK_COMP_ARRAY(COMP_CODEC(\"spi0.0\", \"cs4271-hifi\")),\n\tDAILINK_COMP_ARRAY(COMP_PLATFORM(\"ep93xx-i2s\")));\n\nstatic struct snd_soc_dai_link edb93xx_dai = {\n\t.name\t\t= \"CS4271\",\n\t.stream_name\t= \"CS4271 HiFi\",\n\t.dai_fmt\t= SND_SOC_DAIFMT_I2S | SND_SOC_DAIFMT_NB_NF |\n\t\t\t  SND_SOC_DAIFMT_CBC_CFC,\n\t.ops\t\t= &edb93xx_ops,\n\tSND_SOC_DAILINK_REG(hifi),\n};\n\nstatic struct snd_soc_card snd_soc_edb93xx = {\n\t.name\t\t= \"EDB93XX\",\n\t.owner\t\t= THIS_MODULE,\n\t.dai_link\t= &edb93xx_dai,\n\t.num_links\t= 1,\n};\n\nstatic int edb93xx_probe(struct platform_device *pdev)\n{\n\tstruct snd_soc_card *card = &snd_soc_edb93xx;\n\tint ret;\n\n\tret = ep93xx_i2s_acquire();\n\tif (ret)\n\t\treturn ret;\n\n\tcard->dev = &pdev->dev;\n\n\tret = snd_soc_register_card(card);\n\tif (ret) {\n\t\tdev_err(&pdev->dev, \"snd_soc_register_card() failed: %d\\n\",\n\t\t\tret);\n\t\tep93xx_i2s_release();\n\t}\n\n\treturn ret;\n}\n\nstatic void edb93xx_remove(struct platform_device *pdev)\n{\n\tstruct snd_soc_card *card = platform_get_drvdata(pdev);\n\n\tsnd_soc_unregister_card(card);\n\tep93xx_i2s_release();\n}\n\nstatic struct platform_driver edb93xx_driver = {\n\t.driver\t\t= {\n\t\t.name\t= \"edb93xx-audio\",\n\t},\n\t.probe\t\t= edb93xx_probe,\n\t.remove_new\t= edb93xx_remove,\n};\n\nmodule_platform_driver(edb93xx_driver);\n\nMODULE_AUTHOR(\"Alexander Sverdlin <subaparts@yandex.ru>\");\nMODULE_DESCRIPTION(\"ALSA SoC EDB93xx\");\nMODULE_LICENSE(\"GPL\");\nMODULE_ALIAS(\"platform:edb93xx-audio\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}