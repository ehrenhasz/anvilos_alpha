{
  "module_name": "skl_hda_dsp_common.c",
  "hash_id": "f4d9aac35b35e9b6387425497e91cea903bf1352c0ad35ba3565afc2e9d3585a",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/intel/boards/skl_hda_dsp_common.c",
  "human_readable_source": "\n\n\n \n#include <linux/module.h>\n#include <linux/platform_device.h>\n#include <sound/core.h>\n#include <sound/jack.h>\n#include <sound/pcm.h>\n#include <sound/pcm_params.h>\n#include <sound/soc.h>\n#include \"../../codecs/hdac_hdmi.h\"\n#include \"skl_hda_dsp_common.h\"\n\n#include <sound/hda_codec.h>\n#include \"../../codecs/hdac_hda.h\"\n\n#define NAME_SIZE\t32\n\nint skl_hda_hdmi_add_pcm(struct snd_soc_card *card, int device)\n{\n\tstruct skl_hda_private *ctx = snd_soc_card_get_drvdata(card);\n\tstruct skl_hda_hdmi_pcm *pcm;\n\tchar dai_name[NAME_SIZE];\n\n\tpcm = devm_kzalloc(card->dev, sizeof(*pcm), GFP_KERNEL);\n\tif (!pcm)\n\t\treturn -ENOMEM;\n\n\tsnprintf(dai_name, sizeof(dai_name), \"intel-hdmi-hifi%d\",\n\t\t ctx->dai_index);\n\tpcm->codec_dai = snd_soc_card_get_codec_dai(card, dai_name);\n\tif (!pcm->codec_dai)\n\t\treturn -EINVAL;\n\n\tpcm->device = device;\n\tlist_add_tail(&pcm->head, &ctx->hdmi_pcm_list);\n\n\treturn 0;\n}\n\nSND_SOC_DAILINK_DEF(idisp1_cpu,\n\tDAILINK_COMP_ARRAY(COMP_CPU(\"iDisp1 Pin\")));\nSND_SOC_DAILINK_DEF(idisp1_codec,\n\tDAILINK_COMP_ARRAY(COMP_CODEC(\"ehdaudio0D2\", \"intel-hdmi-hifi1\")));\n\nSND_SOC_DAILINK_DEF(idisp2_cpu,\n\tDAILINK_COMP_ARRAY(COMP_CPU(\"iDisp2 Pin\")));\nSND_SOC_DAILINK_DEF(idisp2_codec,\n\tDAILINK_COMP_ARRAY(COMP_CODEC(\"ehdaudio0D2\", \"intel-hdmi-hifi2\")));\n\nSND_SOC_DAILINK_DEF(idisp3_cpu,\n\tDAILINK_COMP_ARRAY(COMP_CPU(\"iDisp3 Pin\")));\nSND_SOC_DAILINK_DEF(idisp3_codec,\n\tDAILINK_COMP_ARRAY(COMP_CODEC(\"ehdaudio0D2\", \"intel-hdmi-hifi3\")));\n\nSND_SOC_DAILINK_DEF(analog_cpu,\n\tDAILINK_COMP_ARRAY(COMP_CPU(\"Analog CPU DAI\")));\nSND_SOC_DAILINK_DEF(analog_codec,\n\tDAILINK_COMP_ARRAY(COMP_CODEC(\"ehdaudio0D0\", \"Analog Codec DAI\")));\n\nSND_SOC_DAILINK_DEF(digital_cpu,\n\tDAILINK_COMP_ARRAY(COMP_CPU(\"Digital CPU DAI\")));\nSND_SOC_DAILINK_DEF(digital_codec,\n\tDAILINK_COMP_ARRAY(COMP_CODEC(\"ehdaudio0D0\", \"Digital Codec DAI\")));\n\nSND_SOC_DAILINK_DEF(dmic_pin,\n\tDAILINK_COMP_ARRAY(COMP_CPU(\"DMIC01 Pin\")));\n\nSND_SOC_DAILINK_DEF(dmic_codec,\n\tDAILINK_COMP_ARRAY(COMP_CODEC(\"dmic-codec\", \"dmic-hifi\")));\n\nSND_SOC_DAILINK_DEF(dmic16k,\n\tDAILINK_COMP_ARRAY(COMP_CPU(\"DMIC16k Pin\")));\n\nSND_SOC_DAILINK_DEF(platform,\n\tDAILINK_COMP_ARRAY(COMP_PLATFORM(\"0000:00:1f.3\")));\n\n \nstruct snd_soc_dai_link skl_hda_be_dai_links[HDA_DSP_MAX_BE_DAI_LINKS] = {\n\t \n\t{\n\t\t.name = \"iDisp1\",\n\t\t.id = 1,\n\t\t.dpcm_playback = 1,\n\t\t.no_pcm = 1,\n\t\tSND_SOC_DAILINK_REG(idisp1_cpu, idisp1_codec, platform),\n\t},\n\t{\n\t\t.name = \"iDisp2\",\n\t\t.id = 2,\n\t\t.dpcm_playback = 1,\n\t\t.no_pcm = 1,\n\t\tSND_SOC_DAILINK_REG(idisp2_cpu, idisp2_codec, platform),\n\t},\n\t{\n\t\t.name = \"iDisp3\",\n\t\t.id = 3,\n\t\t.dpcm_playback = 1,\n\t\t.no_pcm = 1,\n\t\tSND_SOC_DAILINK_REG(idisp3_cpu, idisp3_codec, platform),\n\t},\n\t{\n\t\t.name = \"Analog Playback and Capture\",\n\t\t.id = 4,\n\t\t.dpcm_playback = 1,\n\t\t.dpcm_capture = 1,\n\t\t.no_pcm = 1,\n\t\tSND_SOC_DAILINK_REG(analog_cpu, analog_codec, platform),\n\t},\n\t{\n\t\t.name = \"Digital Playback and Capture\",\n\t\t.id = 5,\n\t\t.dpcm_playback = 1,\n\t\t.dpcm_capture = 1,\n\t\t.no_pcm = 1,\n\t\tSND_SOC_DAILINK_REG(digital_cpu, digital_codec, platform),\n\t},\n\t{\n\t\t.name = \"dmic01\",\n\t\t.id = 6,\n\t\t.dpcm_capture = 1,\n\t\t.no_pcm = 1,\n\t\tSND_SOC_DAILINK_REG(dmic_pin, dmic_codec, platform),\n\t},\n\t{\n\t\t.name = \"dmic16k\",\n\t\t.id = 7,\n\t\t.dpcm_capture = 1,\n\t\t.no_pcm = 1,\n\t\tSND_SOC_DAILINK_REG(dmic16k, dmic_codec, platform),\n\t},\n};\n\nint skl_hda_hdmi_jack_init(struct snd_soc_card *card)\n{\n\tstruct skl_hda_private *ctx = snd_soc_card_get_drvdata(card);\n\tstruct snd_soc_component *component = NULL;\n\tstruct skl_hda_hdmi_pcm *pcm;\n\tchar jack_name[NAME_SIZE];\n\tint err;\n\n\tif (ctx->common_hdmi_codec_drv)\n\t\treturn skl_hda_hdmi_build_controls(card);\n\n\tlist_for_each_entry(pcm, &ctx->hdmi_pcm_list, head) {\n\t\tcomponent = pcm->codec_dai->component;\n\t\tsnprintf(jack_name, sizeof(jack_name),\n\t\t\t \"HDMI/DP, pcm=%d Jack\", pcm->device);\n\t\terr = snd_soc_card_jack_new(card, jack_name,\n\t\t\t\t\t    SND_JACK_AVOUT, &pcm->hdmi_jack);\n\n\t\tif (err)\n\t\t\treturn err;\n\n\t\terr = hdac_hdmi_jack_init(pcm->codec_dai, pcm->device,\n\t\t\t\t\t  &pcm->hdmi_jack);\n\t\tif (err < 0)\n\t\t\treturn err;\n\t}\n\n\tif (!component)\n\t\treturn -EINVAL;\n\n\treturn hdac_hdmi_jack_port_init(component, &card->dapm);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}