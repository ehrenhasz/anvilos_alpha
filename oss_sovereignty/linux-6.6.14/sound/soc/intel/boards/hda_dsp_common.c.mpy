{
  "module_name": "hda_dsp_common.c",
  "hash_id": "bbf128a4b009b6a5bd8eb0d406be4e74810a13feadd0d76a71944a216f0772f6",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/intel/boards/hda_dsp_common.c",
  "human_readable_source": "\n\n\n\n#include <linux/module.h>\n#include <sound/pcm.h>\n#include <sound/soc.h>\n#include <sound/hda_codec.h>\n#include <sound/hda_i915.h>\n#include \"../../codecs/hdac_hda.h\"\n\n#include \"hda_dsp_common.h\"\n\n#if IS_ENABLED(CONFIG_SND_SOC_SOF_HDA_AUDIO_CODEC)\n\n \nstatic struct snd_pcm *hda_dsp_hdmi_pcm_handle(struct snd_soc_card *card,\n\t\t\t\t\t       int hdmi_idx)\n{\n\tstruct snd_soc_pcm_runtime *rtd;\n\tstruct snd_pcm *spcm;\n\tint i = 0;\n\n\tfor_each_card_rtds(card, rtd) {\n\t\tspcm = rtd->pcm ?\n\t\t\trtd->pcm->streams[SNDRV_PCM_STREAM_PLAYBACK].pcm : NULL;\n\t\tif (spcm && strstr(spcm->id, \"HDMI\")) {\n\t\t\tif (i == hdmi_idx)\n\t\t\t\treturn rtd->pcm;\n\t\t\t++i;\n\t\t}\n\t}\n\n\treturn NULL;\n}\n\n \nint hda_dsp_hdmi_build_controls(struct snd_soc_card *card,\n\t\t\t\tstruct snd_soc_component *comp)\n{\n\tstruct hdac_hda_priv *hda_pvt;\n\tstruct hda_codec *hcodec;\n\tstruct snd_pcm *spcm;\n\tstruct hda_pcm *hpcm;\n\tint err = 0, i = 0;\n\n\tif (!comp)\n\t\treturn -EINVAL;\n\n\thda_pvt = snd_soc_component_get_drvdata(comp);\n\thcodec = hda_pvt->codec;\n\n\tlist_for_each_entry(hpcm, &hcodec->pcm_list_head, list) {\n\t\tspcm = hda_dsp_hdmi_pcm_handle(card, i);\n\t\tif (spcm) {\n\t\t\thpcm->pcm = spcm;\n\t\t\thpcm->device = spcm->device;\n\t\t\tdev_dbg(card->dev,\n\t\t\t\t\"mapping HDMI converter %d to PCM %d (%p)\\n\",\n\t\t\t\ti, hpcm->device, spcm);\n\t\t} else {\n\t\t\thpcm->pcm = NULL;\n\t\t\thpcm->device = SNDRV_PCM_INVALID_DEVICE;\n\t\t\tdev_warn(card->dev,\n\t\t\t\t \"%s: no PCM in topology for HDMI converter %d\\n\",\n\t\t\t\t __func__, i);\n\t\t}\n\t\ti++;\n\t}\n\tsnd_hdac_display_power(hcodec->core.bus,\n\t\t\t       HDA_CODEC_IDX_CONTROLLER, true);\n\terr = snd_hda_codec_build_controls(hcodec);\n\tif (err < 0)\n\t\tdev_err(card->dev, \"unable to create controls %d\\n\", err);\n\tsnd_hdac_display_power(hcodec->core.bus,\n\t\t\t       HDA_CODEC_IDX_CONTROLLER, false);\n\n\treturn err;\n}\nEXPORT_SYMBOL_NS(hda_dsp_hdmi_build_controls, SND_SOC_INTEL_HDA_DSP_COMMON);\n\n#endif\n\nMODULE_DESCRIPTION(\"ASoC Intel HDMI helpers\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}