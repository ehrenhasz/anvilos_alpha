{
  "module_name": "sof_sdw_rt5682.c",
  "hash_id": "a1a93657998484c5646b7720f6efafae4126bc6b89188e7a5f26a617c50a71ca",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/intel/boards/sof_sdw_rt5682.c",
  "human_readable_source": "\n\n\n \n\n#include <linux/device.h>\n#include <linux/errno.h>\n#include <linux/input.h>\n#include <linux/soundwire/sdw.h>\n#include <linux/soundwire/sdw_type.h>\n#include <sound/control.h>\n#include <sound/soc.h>\n#include <sound/soc-acpi.h>\n#include <sound/soc-dapm.h>\n#include <sound/jack.h>\n#include \"sof_sdw_common.h\"\n\nstatic const struct snd_soc_dapm_widget rt5682_widgets[] = {\n\tSND_SOC_DAPM_HP(\"Headphone\", NULL),\n\tSND_SOC_DAPM_MIC(\"Headset Mic\", NULL),\n};\n\nstatic const struct snd_soc_dapm_route rt5682_map[] = {\n\t \n\t{ \"Headphone\", NULL, \"rt5682 HPOL\" },\n\t{ \"Headphone\", NULL, \"rt5682 HPOR\" },\n\t{ \"rt5682 IN1P\", NULL, \"Headset Mic\" },\n};\n\nstatic const struct snd_kcontrol_new rt5682_controls[] = {\n\tSOC_DAPM_PIN_SWITCH(\"Headphone\"),\n\tSOC_DAPM_PIN_SWITCH(\"Headset Mic\"),\n};\n\nstatic struct snd_soc_jack_pin rt5682_jack_pins[] = {\n\t{\n\t\t.pin    = \"Headphone\",\n\t\t.mask   = SND_JACK_HEADPHONE,\n\t},\n\t{\n\t\t.pin    = \"Headset Mic\",\n\t\t.mask   = SND_JACK_MICROPHONE,\n\t},\n};\n\nstatic int rt5682_rtd_init(struct snd_soc_pcm_runtime *rtd)\n{\n\tstruct snd_soc_card *card = rtd->card;\n\tstruct mc_private *ctx = snd_soc_card_get_drvdata(card);\n\tstruct snd_soc_dai *codec_dai = asoc_rtd_to_codec(rtd, 0);\n\tstruct snd_soc_component *component = codec_dai->component;\n\tstruct snd_soc_jack *jack;\n\tint ret;\n\n\tcard->components = devm_kasprintf(card->dev, GFP_KERNEL,\n\t\t\t\t\t  \"%s hs:rt5682\",\n\t\t\t\t\t  card->components);\n\tif (!card->components)\n\t\treturn -ENOMEM;\n\n\tret = snd_soc_add_card_controls(card, rt5682_controls,\n\t\t\t\t\tARRAY_SIZE(rt5682_controls));\n\tif (ret) {\n\t\tdev_err(card->dev, \"rt5682 control addition failed: %d\\n\", ret);\n\t\treturn ret;\n\t}\n\n\tret = snd_soc_dapm_new_controls(&card->dapm, rt5682_widgets,\n\t\t\t\t\tARRAY_SIZE(rt5682_widgets));\n\tif (ret) {\n\t\tdev_err(card->dev, \"rt5682 widgets addition failed: %d\\n\", ret);\n\t\treturn ret;\n\t}\n\n\tret = snd_soc_dapm_add_routes(&card->dapm, rt5682_map,\n\t\t\t\t      ARRAY_SIZE(rt5682_map));\n\n\tif (ret) {\n\t\tdev_err(card->dev, \"rt5682 map addition failed: %d\\n\", ret);\n\t\treturn ret;\n\t}\n\n\tret = snd_soc_card_jack_new_pins(rtd->card, \"Headset Jack\",\n\t\t\t\t\t SND_JACK_HEADSET | SND_JACK_BTN_0 |\n\t\t\t\t\t SND_JACK_BTN_1 | SND_JACK_BTN_2 |\n\t\t\t\t\t SND_JACK_BTN_3,\n\t\t\t\t\t &ctx->sdw_headset,\n\t\t\t\t\t rt5682_jack_pins,\n\t\t\t\t\t ARRAY_SIZE(rt5682_jack_pins));\n\tif (ret) {\n\t\tdev_err(rtd->card->dev, \"Headset Jack creation failed: %d\\n\",\n\t\t\tret);\n\t\treturn ret;\n\t}\n\n\tjack = &ctx->sdw_headset;\n\n\tsnd_jack_set_key(jack->jack, SND_JACK_BTN_0, KEY_PLAYPAUSE);\n\tsnd_jack_set_key(jack->jack, SND_JACK_BTN_1, KEY_VOICECOMMAND);\n\tsnd_jack_set_key(jack->jack, SND_JACK_BTN_2, KEY_VOLUMEUP);\n\tsnd_jack_set_key(jack->jack, SND_JACK_BTN_3, KEY_VOLUMEDOWN);\n\n\tret = snd_soc_component_set_jack(component, jack, NULL);\n\n\tif (ret)\n\t\tdev_err(rtd->card->dev, \"Headset Jack call-back failed: %d\\n\",\n\t\t\tret);\n\n\treturn ret;\n}\n\nint sof_sdw_rt5682_init(struct snd_soc_card *card,\n\t\t\tconst struct snd_soc_acpi_link_adr *link,\n\t\t\tstruct snd_soc_dai_link *dai_links,\n\t\t\tstruct sof_sdw_codec_info *info,\n\t\t\tbool playback)\n{\n\t \n\tif (!playback)\n\t\treturn 0;\n\n\tdai_links->init = rt5682_rtd_init;\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}