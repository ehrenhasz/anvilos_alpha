{
  "module_name": "sof_sdw_rt700.c",
  "hash_id": "475b07b079e02615c2103aa93a2c7d644074ca1d2f605db0aea947bc4c2a6e54",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/intel/boards/sof_sdw_rt700.c",
  "human_readable_source": "\n\n\n \n\n#include <linux/device.h>\n#include <linux/errno.h>\n#include <linux/input.h>\n#include <sound/control.h>\n#include <sound/soc.h>\n#include <sound/soc-acpi.h>\n#include <sound/soc-dapm.h>\n#include <sound/jack.h>\n#include \"sof_sdw_common.h\"\n\nstatic const struct snd_soc_dapm_widget rt700_widgets[] = {\n\tSND_SOC_DAPM_HP(\"Headphones\", NULL),\n\tSND_SOC_DAPM_MIC(\"AMIC\", NULL),\n\tSND_SOC_DAPM_SPK(\"Speaker\", NULL),\n};\n\nstatic const struct snd_soc_dapm_route rt700_map[] = {\n\t \n\t{ \"Headphones\", NULL, \"rt700 HP\" },\n\t{ \"Speaker\", NULL, \"rt700 SPK\" },\n\t{ \"rt700 MIC2\", NULL, \"AMIC\" },\n};\n\nstatic const struct snd_kcontrol_new rt700_controls[] = {\n\tSOC_DAPM_PIN_SWITCH(\"Headphones\"),\n\tSOC_DAPM_PIN_SWITCH(\"AMIC\"),\n\tSOC_DAPM_PIN_SWITCH(\"Speaker\"),\n};\n\nstatic struct snd_soc_jack_pin rt700_jack_pins[] = {\n\t{\n\t\t.pin    = \"Headphones\",\n\t\t.mask   = SND_JACK_HEADPHONE,\n\t},\n\t{\n\t\t.pin    = \"AMIC\",\n\t\t.mask   = SND_JACK_MICROPHONE,\n\t},\n};\n\nstatic int rt700_rtd_init(struct snd_soc_pcm_runtime *rtd)\n{\n\tstruct snd_soc_card *card = rtd->card;\n\tstruct mc_private *ctx = snd_soc_card_get_drvdata(card);\n\tstruct snd_soc_dai *codec_dai = asoc_rtd_to_codec(rtd, 0);\n\tstruct snd_soc_component *component = codec_dai->component;\n\tstruct snd_soc_jack *jack;\n\tint ret;\n\n\tcard->components = devm_kasprintf(card->dev, GFP_KERNEL,\n\t\t\t\t\t  \"%s hs:rt700\",\n\t\t\t\t\t  card->components);\n\tif (!card->components)\n\t\treturn -ENOMEM;\n\n\tret = snd_soc_add_card_controls(card, rt700_controls,\n\t\t\t\t\tARRAY_SIZE(rt700_controls));\n\tif (ret) {\n\t\tdev_err(card->dev, \"rt700 controls addition failed: %d\\n\", ret);\n\t\treturn ret;\n\t}\n\n\tret = snd_soc_dapm_new_controls(&card->dapm, rt700_widgets,\n\t\t\t\t\tARRAY_SIZE(rt700_widgets));\n\tif (ret) {\n\t\tdev_err(card->dev, \"rt700 widgets addition failed: %d\\n\", ret);\n\t\treturn ret;\n\t}\n\n\tret = snd_soc_dapm_add_routes(&card->dapm, rt700_map,\n\t\t\t\t      ARRAY_SIZE(rt700_map));\n\n\tif (ret) {\n\t\tdev_err(card->dev, \"rt700 map addition failed: %d\\n\", ret);\n\t\treturn ret;\n\t}\n\n\tret = snd_soc_card_jack_new_pins(rtd->card, \"Headset Jack\",\n\t\t\t\t\t SND_JACK_HEADSET | SND_JACK_BTN_0 |\n\t\t\t\t\t SND_JACK_BTN_1 | SND_JACK_BTN_2 |\n\t\t\t\t\t SND_JACK_BTN_3,\n\t\t\t\t\t &ctx->sdw_headset,\n\t\t\t\t\t rt700_jack_pins,\n\t\t\t\t\t ARRAY_SIZE(rt700_jack_pins));\n\tif (ret) {\n\t\tdev_err(rtd->card->dev, \"Headset Jack creation failed: %d\\n\",\n\t\t\tret);\n\t\treturn ret;\n\t}\n\n\tjack = &ctx->sdw_headset;\n\n\tsnd_jack_set_key(jack->jack, SND_JACK_BTN_0, KEY_PLAYPAUSE);\n\tsnd_jack_set_key(jack->jack, SND_JACK_BTN_1, KEY_VOICECOMMAND);\n\tsnd_jack_set_key(jack->jack, SND_JACK_BTN_2, KEY_VOLUMEUP);\n\tsnd_jack_set_key(jack->jack, SND_JACK_BTN_3, KEY_VOLUMEDOWN);\n\n\tret = snd_soc_component_set_jack(component, jack, NULL);\n\tif (ret)\n\t\tdev_err(rtd->card->dev, \"Headset Jack call-back failed: %d\\n\",\n\t\t\tret);\n\n\treturn ret;\n}\n\nint sof_sdw_rt700_init(struct snd_soc_card *card,\n\t\t       const struct snd_soc_acpi_link_adr *link,\n\t\t       struct snd_soc_dai_link *dai_links,\n\t\t       struct sof_sdw_codec_info *info,\n\t\t       bool playback)\n{\n\t \n\tif (!playback)\n\t\treturn 0;\n\n\tdai_links->init = rt700_rtd_init;\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}