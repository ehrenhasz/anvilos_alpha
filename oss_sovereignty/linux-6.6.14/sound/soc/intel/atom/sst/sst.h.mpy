{
  "module_name": "sst.h",
  "hash_id": "b553a98479b7d7b70a96e7733c8ae348b94b66625ea77b3754d7a95d9502e2b2",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/intel/atom/sst/sst.h",
  "human_readable_source": " \n \n#ifndef __SST_H__\n#define __SST_H__\n\n#include <linux/firmware.h>\n\n \n#define SST_DRV_NAME \"intel_sst_driver\"\n\n#define SST_SUSPEND_DELAY 2000\n#define FW_CONTEXT_MEM (64*1024)\n#define SST_ICCM_BOUNDARY 4\n#define SST_CONFIG_SSP_SIGN 0x7ffe8001\n\n#define MRFLD_FW_VIRTUAL_BASE 0xC0000000\n#define MRFLD_FW_DDR_BASE_OFFSET 0x0\n#define MRFLD_FW_FEATURE_BASE_OFFSET 0x4\n#define MRFLD_FW_BSS_RESET_BIT 0\n\n \n#define SST_CSR\t\t\t0x00\n#define SST_ISRX\t\t0x18\n#define SST_IMRX\t\t0x28\n#define SST_IPCX\t\t0x38  \n#define SST_IPCD\t\t0x40  \n\nextern const struct dev_pm_ops intel_sst_pm;\nenum sst_states {\n\tSST_FW_LOADING = 1,\n\tSST_FW_RUNNING,\n\tSST_RESET,\n\tSST_SHUTDOWN,\n};\n\nenum sst_algo_ops {\n\tSST_SET_ALGO = 0,\n\tSST_GET_ALGO = 1,\n};\n\n#define SST_BLOCK_TIMEOUT\t1000\n\n#define FW_SIGNATURE_SIZE\t4\n#define FW_NAME_SIZE\t\t32\n\n \nenum sst_stream_states {\n\tSTREAM_UN_INIT\t= 0,\t \n\tSTREAM_RUNNING\t= 1,\t \n\tSTREAM_PAUSED\t= 2,\t \n\tSTREAM_INIT\t= 3,\t \n};\n\nenum sst_ram_type {\n\tSST_IRAM\t= 1,\n\tSST_DRAM\t= 2,\n\tSST_DDR\t= 5,\n\tSST_CUSTOM_INFO\t= 7,\t \n};\n\n \nunion interrupt_reg {\n\tstruct {\n\t\tu64 done_interrupt:1;\n\t\tu64 busy_interrupt:1;\n\t\tu64 rsvd:62;\n\t} part;\n\tu64 full;\n};\n\nunion sst_pisr_reg {\n\tstruct {\n\t\tu32 pssp0:1;\n\t\tu32 pssp1:1;\n\t\tu32 rsvd0:3;\n\t\tu32 dmac:1;\n\t\tu32 rsvd1:26;\n\t} part;\n\tu32 full;\n};\n\nunion sst_pimr_reg {\n\tstruct {\n\t\tu32 ssp0:1;\n\t\tu32 ssp1:1;\n\t\tu32 rsvd0:3;\n\t\tu32 dmac:1;\n\t\tu32 rsvd1:10;\n\t\tu32 ssp0_sc:1;\n\t\tu32 ssp1_sc:1;\n\t\tu32 rsvd2:3;\n\t\tu32 dmac_sc:1;\n\t\tu32 rsvd3:10;\n\t} part;\n\tu32 full;\n};\n\nunion config_status_reg_mrfld {\n\tstruct {\n\t\tu64 lpe_reset:1;\n\t\tu64 lpe_reset_vector:1;\n\t\tu64 runstall:1;\n\t\tu64 pwaitmode:1;\n\t\tu64 clk_sel:3;\n\t\tu64 rsvd2:1;\n\t\tu64 sst_clk:3;\n\t\tu64 xt_snoop:1;\n\t\tu64 rsvd3:4;\n\t\tu64 clk_sel1:6;\n\t\tu64 clk_enable:3;\n\t\tu64 rsvd4:6;\n\t\tu64 slim0baseclk:1;\n\t\tu64 rsvd:32;\n\t} part;\n\tu64 full;\n};\n\nunion interrupt_reg_mrfld {\n\tstruct {\n\t\tu64 done_interrupt:1;\n\t\tu64 busy_interrupt:1;\n\t\tu64 rsvd:62;\n\t} part;\n\tu64 full;\n};\n\nunion sst_imr_reg_mrfld {\n\tstruct {\n\t\tu64 done_interrupt:1;\n\t\tu64 busy_interrupt:1;\n\t\tu64 rsvd:62;\n\t} part;\n\tu64 full;\n};\n\n \nstruct sst_block {\n\tbool\tcondition;\n\tint\tret_code;\n\tvoid\t*data;\n\tu32     size;\n\tbool\ton;\n\tu32     msg_id;\n\tu32     drv_id;\n\tstruct list_head node;\n};\n\n \nstruct stream_info {\n\tunsigned int\t\tstatus;\n\tunsigned int\t\tprev;\n\tunsigned int\t\tresume_status;\n\tunsigned int\t\tresume_prev;\n\tstruct mutex\t\tlock;\n\tstruct snd_sst_alloc_mrfld alloc_param;\n\n\tvoid\t\t\t*pcm_substream;\n\tvoid (*period_elapsed)(void *pcm_substream);\n\n\tunsigned int\t\tsfreq;\n\tu32\t\t\tcumm_bytes;\n\n\tvoid\t\t\t*compr_cb_param;\n\tvoid (*compr_cb)(void *compr_cb_param);\n\n\tvoid\t\t\t*drain_cb_param;\n\tvoid (*drain_notify)(void *drain_cb_param);\n\n\tunsigned int\t\tnum_ch;\n\tunsigned int\t\tpipe_id;\n\tunsigned int\t\ttask_id;\n};\n\n#define SST_FW_SIGN \"$SST\"\n#define SST_FW_LIB_SIGN \"$LIB\"\n\n \nstruct sst_fw_header {\n\tunsigned char signature[FW_SIGNATURE_SIZE];\n\tu32 file_size;\n\tu32 modules;\n\tu32 file_format;\n\tu32 reserved[4];\n};\n\n \nstruct fw_module_header {\n\tunsigned char signature[FW_SIGNATURE_SIZE];\n\tu32 mod_size;\n\tu32 blocks;\n\tu32 type;\n\tu32 entry_point;\n};\n\n \nstruct fw_block_info {\n\tenum sst_ram_type\ttype;\n\tu32\t\t\tsize;\n\tu32\t\t\tram_offset;\n\tu32\t\t\trsvd;\n};\n\nstruct sst_runtime_param {\n\tstruct snd_sst_runtime_params param;\n};\n\nstruct sst_sg_list {\n\tstruct scatterlist *src;\n\tstruct scatterlist *dst;\n\tint list_len;\n\tunsigned int sg_idx;\n};\n\nstruct sst_memcpy_list {\n\tstruct list_head memcpylist;\n\tvoid *dstn;\n\tconst void *src;\n\tu32 size;\n\tbool is_io;\n};\n\n \nenum sst_lib_dwnld_status {\n\tSST_LIB_NOT_FOUND = 0,\n\tSST_LIB_FOUND,\n\tSST_LIB_DOWNLOADED,\n};\n\nstruct sst_module_info {\n\tconst char *name;  \n\tu32\tid;  \n\tu32\tentry_pt;  \n\tu8\tstatus;  \n\tu8\trsvd1;\n\tu16\trsvd2;\n};\n\n \nstruct sst_mem_mgr {\n\tphys_addr_t current_base;\n\tint avail;\n\tunsigned int count;\n};\n\nstruct sst_ipc_reg {\n\tint ipcx;\n\tint ipcd;\n};\n\nstruct sst_fw_save {\n\tvoid *iram;\t \n\tvoid *dram;\t \n\tvoid *sram;\t \n\tvoid *ddr;\t \n};\n\n \nstruct intel_sst_drv {\n\tint\t\t\tsst_state;\n\tint\t\t\tirq_num;\n\tunsigned short\t\tdev_id;\n\tvoid __iomem\t\t*ddr;\n\tvoid __iomem\t\t*shim;\n\tvoid __iomem\t\t*mailbox;\n\tvoid __iomem\t\t*iram;\n\tvoid __iomem\t\t*dram;\n\tunsigned int\t\tmailbox_add;\n\tunsigned int\t\tiram_base;\n\tunsigned int\t\tdram_base;\n\tunsigned int\t\tshim_phy_add;\n\tunsigned int\t\tiram_end;\n\tunsigned int\t\tdram_end;\n\tunsigned int\t\tddr_end;\n\tunsigned int\t\tddr_base;\n\tunsigned int\t\tmailbox_recv_offset;\n\tstruct list_head        block_list;\n\tstruct list_head\tipc_dispatch_list;\n\tstruct sst_platform_info *pdata;\n\tstruct list_head\trx_list;\n\tstruct work_struct      ipc_post_msg_wq;\n\twait_queue_head_t\twait_queue;\n\tstruct workqueue_struct *post_msg_wq;\n\tunsigned int\t\ttstamp;\n\t \n\tstruct stream_info\tstreams[MAX_NUM_STREAMS+1];\n\tspinlock_t\t\tipc_spin_lock;\n\tspinlock_t              block_lock;\n\tspinlock_t\t\trx_msg_lock;\n\tstruct pci_dev\t\t*pci;\n\tstruct device\t\t*dev;\n\tvolatile long unsigned \t\tpvt_id;\n\tstruct mutex            sst_lock;\n\tunsigned int\t\tstream_cnt;\n\tunsigned int\t\tcsr_value;\n\tvoid\t\t\t*fw_in_mem;\n\tstruct sst_sg_list\tfw_sg_list, library_list;\n\tstruct intel_sst_ops\t*ops;\n\tstruct sst_info\t\tinfo;\n\tstruct pm_qos_request\t*qos;\n\tunsigned int\t\tuse_dma;\n\tunsigned int\t\tuse_lli;\n\tatomic_t\t\tfw_clear_context;\n\tbool\t\t\tlib_dwnld_reqd;\n\tstruct list_head\tmemcpy_list;\n\tstruct sst_ipc_reg\tipc_reg;\n\tstruct sst_mem_mgr      lib_mem_mgr;\n\t \n\tchar firmware_name[FW_NAME_SIZE];\n\n\tstruct snd_sst_fw_version fw_version;\n\tstruct sst_fw_save\t*fw_save;\n};\n\n \n#define FW_DWNL_ID 0x01\n\nstruct intel_sst_ops {\n\tirqreturn_t (*interrupt)(int, void *);\n\tirqreturn_t (*irq_thread)(int, void *);\n\tvoid (*clear_interrupt)(struct intel_sst_drv *ctx);\n\tint (*start)(struct intel_sst_drv *ctx);\n\tint (*reset)(struct intel_sst_drv *ctx);\n\tvoid (*process_reply)(struct intel_sst_drv *ctx, struct ipc_post *msg);\n\tint (*post_message)(struct intel_sst_drv *ctx,\n\t\t\tstruct ipc_post *msg, bool sync);\n\tvoid (*process_message)(struct ipc_post *msg);\n\tvoid (*set_bypass)(bool set);\n\tint (*save_dsp_context)(struct intel_sst_drv *sst);\n\tvoid (*restore_dsp_context)(void);\n\tint (*alloc_stream)(struct intel_sst_drv *ctx, void *params);\n\tvoid (*post_download)(struct intel_sst_drv *sst);\n};\n\nint sst_realloc_stream(struct intel_sst_drv *sst_drv_ctx, int str_id);\nint sst_pause_stream(struct intel_sst_drv *sst_drv_ctx, int str_id);\nint sst_resume_stream(struct intel_sst_drv *sst_drv_ctx, int str_id);\nint sst_drop_stream(struct intel_sst_drv *sst_drv_ctx, int str_id);\nint sst_free_stream(struct intel_sst_drv *sst_drv_ctx, int str_id);\nint sst_start_stream(struct intel_sst_drv *sst_drv_ctx, int str_id);\nint sst_send_byte_stream_mrfld(struct intel_sst_drv *sst_drv_ctx,\n\t\t\tstruct snd_sst_bytes_v2 *bytes);\nint sst_set_stream_param(int str_id, struct snd_sst_params *str_param);\nint sst_set_metadata(int str_id, char *params);\nint sst_get_stream(struct intel_sst_drv *ctx,\n\t\tstruct snd_sst_params *str_param);\nint sst_get_stream_allocated(struct intel_sst_drv *ctx,\n\t\tstruct snd_sst_params *str_param,\n\t\tstruct snd_sst_lib_download **lib_dnld);\nint sst_drain_stream(struct intel_sst_drv *sst_drv_ctx,\n\t\tint str_id, bool partial_drain);\nint sst_post_message_mrfld(struct intel_sst_drv *sst_drv_ctx,\n\t\tstruct ipc_post *ipc_msg, bool sync);\nvoid sst_process_reply_mrfld(struct intel_sst_drv *sst_drv_ctx, struct ipc_post *msg);\nint sst_start_mrfld(struct intel_sst_drv *sst_drv_ctx);\nint intel_sst_reset_dsp_mrfld(struct intel_sst_drv *sst_drv_ctx);\nvoid intel_sst_clear_intr_mrfld(struct intel_sst_drv *sst_drv_ctx);\n\nint sst_load_fw(struct intel_sst_drv *sst_drv_ctx);\nint sst_load_library(struct snd_sst_lib_download *lib, u8 ops);\nvoid sst_post_download_mrfld(struct intel_sst_drv *ctx);\nint sst_get_block_stream(struct intel_sst_drv *sst_drv_ctx);\nvoid sst_memcpy_free_resources(struct intel_sst_drv *sst_drv_ctx);\n\nint sst_wait_interruptible(struct intel_sst_drv *sst_drv_ctx,\n\t\t\t\tstruct sst_block *block);\nint sst_wait_timeout(struct intel_sst_drv *sst_drv_ctx,\n\t\t\tstruct sst_block *block);\nint sst_create_ipc_msg(struct ipc_post **arg, bool large);\nint free_stream_context(struct intel_sst_drv *ctx, unsigned int str_id);\nvoid sst_clean_stream(struct stream_info *stream);\nint intel_sst_register_compress(struct intel_sst_drv *sst);\nint intel_sst_remove_compress(struct intel_sst_drv *sst);\nvoid sst_cdev_fragment_elapsed(struct intel_sst_drv *ctx, int str_id);\nint sst_send_sync_msg(int ipc, int str_id);\nint sst_get_num_channel(struct snd_sst_params *str_param);\nint sst_get_sfreq(struct snd_sst_params *str_param);\nint sst_alloc_stream_mrfld(struct intel_sst_drv *sst_drv_ctx, void *params);\nvoid sst_restore_fw_context(void);\nstruct sst_block *sst_create_block(struct intel_sst_drv *ctx,\n\t\t\t\tu32 msg_id, u32 drv_id);\nint sst_create_block_and_ipc_msg(struct ipc_post **arg, bool large,\n\t\tstruct intel_sst_drv *sst_drv_ctx, struct sst_block **block,\n\t\tu32 msg_id, u32 drv_id);\nint sst_free_block(struct intel_sst_drv *ctx, struct sst_block *freed);\nint sst_wake_up_block(struct intel_sst_drv *ctx, int result,\n\t\tu32 drv_id, u32 ipc, void *data, u32 size);\nint sst_request_firmware_async(struct intel_sst_drv *ctx);\nint sst_driver_ops(struct intel_sst_drv *sst);\nstruct sst_platform_info *sst_get_acpi_driver_data(const char *hid);\nvoid sst_firmware_load_cb(const struct firmware *fw, void *context);\nint sst_prepare_and_post_msg(struct intel_sst_drv *sst,\n\t\tint task_id, int ipc_msg, int cmd_id, int pipe_id,\n\t\tsize_t mbox_data_len, const void *mbox_data, void **data,\n\t\tbool large, bool fill_dsp, bool sync, bool response);\n\nvoid sst_process_pending_msg(struct work_struct *work);\nint sst_assign_pvt_id(struct intel_sst_drv *drv);\nint sst_validate_strid(struct intel_sst_drv *sst_drv_ctx, int str_id);\nstruct stream_info *get_stream_info(struct intel_sst_drv *sst_drv_ctx,\n\t\tint str_id);\nint get_stream_id_mrfld(struct intel_sst_drv *sst_drv_ctx,\n\t\tu32 pipe_id);\nu32 relocate_imr_addr_mrfld(u32 base_addr);\nvoid sst_add_to_dispatch_list_and_post(struct intel_sst_drv *sst,\n\t\t\t\t\tstruct ipc_post *msg);\nint sst_pm_runtime_put(struct intel_sst_drv *sst_drv);\nint sst_shim_write(void __iomem *addr, int offset, int value);\nu32 sst_shim_read(void __iomem *addr, int offset);\nu64 sst_reg_read64(void __iomem *addr, int offset);\nint sst_shim_write64(void __iomem *addr, int offset, u64 value);\nu64 sst_shim_read64(void __iomem *addr, int offset);\nvoid sst_set_fw_state_locked(\n\t\tstruct intel_sst_drv *sst_drv_ctx, int sst_state);\nvoid sst_fill_header_mrfld(union ipc_header_mrfld *header,\n\t\t\t\tint msg, int task_id, int large, int drv_id);\nvoid sst_fill_header_dsp(struct ipc_dsp_hdr *dsp, int msg,\n\t\t\t\t\tint pipe_id, int len);\n\nint sst_register(struct device *);\nint sst_unregister(struct device *);\n\nint sst_alloc_drv_context(struct intel_sst_drv **ctx,\n\t\tstruct device *dev, unsigned short dev_id);\nint sst_context_init(struct intel_sst_drv *ctx);\nvoid sst_context_cleanup(struct intel_sst_drv *ctx);\nvoid sst_configure_runtime_pm(struct intel_sst_drv *ctx);\nvoid memcpy32_toio(void __iomem *dst, const void *src, int count);\nvoid memcpy32_fromio(void *dst, const void __iomem *src, int count);\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}