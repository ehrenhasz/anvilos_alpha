{
  "module_name": "skl-sst-dsp.h",
  "hash_id": "2a6bd5976d4ea97e736a207688f9d0269471877cd3ecdc1ada3ee9b0e0b831bc",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/intel/skylake/skl-sst-dsp.h",
  "human_readable_source": " \n \n\n#ifndef __SKL_SST_DSP_H__\n#define __SKL_SST_DSP_H__\n\n#include <linux/interrupt.h>\n#include <linux/uuid.h>\n#include <linux/firmware.h>\n#include <sound/memalloc.h>\n#include \"skl-sst-cldma.h\"\n\nstruct sst_dsp;\nstruct sst_dsp_device;\nstruct skl_lib_info;\nstruct skl_dev;\n\n \n#define SKL_ADSP_GEN_BASE\t\t0x0\n#define SKL_ADSP_REG_ADSPCS\t\t(SKL_ADSP_GEN_BASE + 0x04)\n#define SKL_ADSP_REG_ADSPIC\t\t(SKL_ADSP_GEN_BASE + 0x08)\n#define SKL_ADSP_REG_ADSPIS\t\t(SKL_ADSP_GEN_BASE + 0x0C)\n#define SKL_ADSP_REG_ADSPIC2\t\t(SKL_ADSP_GEN_BASE + 0x10)\n#define SKL_ADSP_REG_ADSPIS2\t\t(SKL_ADSP_GEN_BASE + 0x14)\n\n \n#define SKL_ADSP_IPC_BASE\t\t0x40\n#define SKL_ADSP_REG_HIPCT\t\t(SKL_ADSP_IPC_BASE + 0x00)\n#define SKL_ADSP_REG_HIPCTE\t\t(SKL_ADSP_IPC_BASE + 0x04)\n#define SKL_ADSP_REG_HIPCI\t\t(SKL_ADSP_IPC_BASE + 0x08)\n#define SKL_ADSP_REG_HIPCIE\t\t(SKL_ADSP_IPC_BASE + 0x0C)\n#define SKL_ADSP_REG_HIPCCTL\t\t(SKL_ADSP_IPC_BASE + 0x10)\n\n \n#define SKL_ADSP_REG_HIPCI_BUSY\t\tBIT(31)\n\n \n#define SKL_ADSP_REG_HIPCIE_DONE\tBIT(30)\n\n \n#define SKL_ADSP_REG_HIPCCTL_DONE\tBIT(1)\n#define SKL_ADSP_REG_HIPCCTL_BUSY\tBIT(0)\n\n \n#define SKL_ADSP_REG_HIPCT_BUSY\t\tBIT(31)\n\n \n#define SKL_INSTANCE_ID\t\t\t0\n#define SKL_BASE_FW_MODULE_ID\t\t0\n\n \n#define SKL_ADSP_SRAM1_BASE\t\t0xA000\n\n#define SKL_ADSP_MMIO_LEN\t\t0x10000\n\n#define SKL_ADSP_W0_STAT_SZ\t\t0x1000\n\n#define SKL_ADSP_W0_UP_SZ\t\t0x1000\n\n#define SKL_ADSP_W1_SZ\t\t\t0x1000\n\n#define SKL_FW_STS_MASK\t\t\t0xf\n\n#define SKL_FW_INIT\t\t\t0x1\n#define SKL_FW_RFW_START\t\t0xf\n#define BXT_FW_ROM_INIT_RETRY\t\t3\n#define BXT_INIT_TIMEOUT\t\t300\n\n#define SKL_ADSPIC_IPC\t\t\t1\n#define SKL_ADSPIS_IPC\t\t\t1\n\n \n#define SKL_DSP_CORE0_ID\t\t0\n\n \n#define SKL_DSP_CORE_MASK(c)\t\tBIT(c)\n\n \n#define SKL_DSP_CORE0_MASK\t\tBIT(0)\n\n \n#define SKL_DSP_CORES_MASK(nc)\tGENMASK((nc - 1), 0)\n\n \n\n \n#define SKL_ADSPCS_CRST_SHIFT\t\t0\n#define SKL_ADSPCS_CRST_MASK(cm)\t((cm) << SKL_ADSPCS_CRST_SHIFT)\n\n \n#define SKL_ADSPCS_CSTALL_SHIFT\t\t8\n#define SKL_ADSPCS_CSTALL_MASK(cm)\t((cm) << SKL_ADSPCS_CSTALL_SHIFT)\n\n \n#define SKL_ADSPCS_SPA_SHIFT\t\t16\n#define SKL_ADSPCS_SPA_MASK(cm)\t\t((cm) << SKL_ADSPCS_SPA_SHIFT)\n\n \n#define SKL_ADSPCS_CPA_SHIFT\t\t24\n#define SKL_ADSPCS_CPA_MASK(cm)\t\t((cm) << SKL_ADSPCS_CPA_SHIFT)\n\n \nenum skl_dsp_states {\n\tSKL_DSP_RUNNING = 1,\n\t \n\tSKL_DSP_RUNNING_D0I3,  \n\tSKL_DSP_RESET,\n};\n\n \nenum skl_dsp_d0i3_states {\n\tSKL_DSP_D0I3_NONE = -1,  \n\tSKL_DSP_D0I3_NON_STREAMING = 0,\n\tSKL_DSP_D0I3_STREAMING = 1,\n};\n\nstruct skl_dsp_fw_ops {\n\tint (*load_fw)(struct sst_dsp  *ctx);\n\t \n\tint (*load_library)(struct sst_dsp *ctx,\n\t\tstruct skl_lib_info *linfo, int lib_count);\n\tint (*parse_fw)(struct sst_dsp *ctx);\n\tint (*set_state_D0)(struct sst_dsp *ctx, unsigned int core_id);\n\tint (*set_state_D3)(struct sst_dsp *ctx, unsigned int core_id);\n\tint (*set_state_D0i3)(struct sst_dsp *ctx);\n\tint (*set_state_D0i0)(struct sst_dsp *ctx);\n\tunsigned int (*get_fw_errcode)(struct sst_dsp *ctx);\n\tint (*load_mod)(struct sst_dsp *ctx, u16 mod_id, u8 *mod_name);\n\tint (*unload_mod)(struct sst_dsp *ctx, u16 mod_id);\n\n};\n\nstruct skl_dsp_loader_ops {\n\tint stream_tag;\n\n\tint (*alloc_dma_buf)(struct device *dev,\n\t\tstruct snd_dma_buffer *dmab, size_t size);\n\tint (*free_dma_buf)(struct device *dev,\n\t\tstruct snd_dma_buffer *dmab);\n\tint (*prepare)(struct device *dev, unsigned int format,\n\t\t\t\tunsigned int byte_size,\n\t\t\t\tstruct snd_dma_buffer *bufp);\n\tint (*trigger)(struct device *dev, bool start, int stream_tag);\n\n\tint (*cleanup)(struct device *dev, struct snd_dma_buffer *dmab,\n\t\t\t\t int stream_tag);\n};\n\n#define MAX_INSTANCE_BUFF 2\n\nstruct uuid_module {\n\tguid_t uuid;\n\tint id;\n\tint is_loadable;\n\tint max_instance;\n\tu64 pvt_id[MAX_INSTANCE_BUFF];\n\tint *instance_id;\n\n\tstruct list_head list;\n};\n\nstruct skl_load_module_info {\n\tu16 mod_id;\n\tconst struct firmware *fw;\n};\n\nstruct skl_module_table {\n\tstruct skl_load_module_info *mod_info;\n\tunsigned int usage_cnt;\n\tstruct list_head list;\n};\n\nvoid skl_cldma_process_intr(struct sst_dsp *ctx);\nvoid skl_cldma_int_disable(struct sst_dsp *ctx);\nint skl_cldma_prepare(struct sst_dsp *ctx);\nint skl_cldma_wait_interruptible(struct sst_dsp *ctx);\n\nvoid skl_dsp_set_state_locked(struct sst_dsp *ctx, int state);\nstruct sst_dsp *skl_dsp_ctx_init(struct device *dev,\n\t\tstruct sst_dsp_device *sst_dev, int irq);\nint skl_dsp_acquire_irq(struct sst_dsp *sst);\nbool is_skl_dsp_running(struct sst_dsp *ctx);\n\nunsigned int skl_dsp_get_enabled_cores(struct sst_dsp *ctx);\nvoid skl_dsp_init_core_state(struct sst_dsp *ctx);\nint skl_dsp_enable_core(struct sst_dsp *ctx, unsigned int core_mask);\nint skl_dsp_disable_core(struct sst_dsp *ctx, unsigned int core_mask);\nint skl_dsp_core_power_up(struct sst_dsp *ctx, unsigned int core_mask);\nint skl_dsp_core_power_down(struct sst_dsp *ctx, unsigned int core_mask);\nint skl_dsp_core_unset_reset_state(struct sst_dsp *ctx,\n\t\t\t\t\tunsigned int core_mask);\nint skl_dsp_start_core(struct sst_dsp *ctx, unsigned int core_mask);\n\nirqreturn_t skl_dsp_sst_interrupt(int irq, void *dev_id);\nint skl_dsp_wake(struct sst_dsp *ctx);\nint skl_dsp_sleep(struct sst_dsp *ctx);\nvoid skl_dsp_free(struct sst_dsp *dsp);\n\nint skl_dsp_get_core(struct sst_dsp *ctx, unsigned int core_id);\nint skl_dsp_put_core(struct sst_dsp *ctx, unsigned int core_id);\n\nint skl_dsp_boot(struct sst_dsp *ctx);\nint skl_sst_dsp_init(struct device *dev, void __iomem *mmio_base, int irq,\n\t\tconst char *fw_name, struct skl_dsp_loader_ops dsp_ops,\n\t\tstruct skl_dev **dsp);\nint bxt_sst_dsp_init(struct device *dev, void __iomem *mmio_base, int irq,\n\t\tconst char *fw_name, struct skl_dsp_loader_ops dsp_ops,\n\t\tstruct skl_dev **dsp);\nint skl_sst_init_fw(struct device *dev, struct skl_dev *skl);\nint bxt_sst_init_fw(struct device *dev, struct skl_dev *skl);\nvoid skl_sst_dsp_cleanup(struct device *dev, struct skl_dev *skl);\nvoid bxt_sst_dsp_cleanup(struct device *dev, struct skl_dev *skl);\n\nint snd_skl_parse_uuids(struct sst_dsp *ctx, const struct firmware *fw,\n\t\t\t\tunsigned int offset, int index);\nint skl_get_pvt_id(struct skl_dev *skl, guid_t *uuid_mod, int instance_id);\nint skl_put_pvt_id(struct skl_dev *skl, guid_t *uuid_mod, int *pvt_id);\nint skl_get_pvt_instance_id_map(struct skl_dev *skl,\n\t\t\t\tint module_id, int instance_id);\nvoid skl_freeup_uuid_list(struct skl_dev *skl);\n\nint skl_dsp_strip_extended_manifest(struct firmware *fw);\n\nvoid skl_dsp_set_astate_cfg(struct skl_dev *skl, u32 cnt, void *data);\n\nint skl_sst_ctx_init(struct device *dev, int irq, const char *fw_name,\n\t\tstruct skl_dsp_loader_ops dsp_ops, struct skl_dev **dsp,\n\t\tstruct sst_dsp_device *skl_dev);\nint skl_prepare_lib_load(struct skl_dev *skl, struct skl_lib_info *linfo,\n\t\t\tstruct firmware *stripped_fw,\n\t\t\tunsigned int hdr_offset, int index);\nvoid skl_release_library(struct skl_lib_info *linfo, int lib_count);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}