{
  "module_name": "skl-topology.h",
  "hash_id": "160a17038be22c1835c598d944b7e6e0ae2c2be9f67842715c11883879f0bd28",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/intel/skylake/skl-topology.h",
  "human_readable_source": " \n \n\n#ifndef __SKL_TOPOLOGY_H__\n#define __SKL_TOPOLOGY_H__\n\n#include <linux/types.h>\n\n#include <sound/hdaudio_ext.h>\n#include <sound/soc.h>\n#include <uapi/sound/skl-tplg-interface.h>\n#include \"skl.h\"\n\n#define BITS_PER_BYTE 8\n#define MAX_TS_GROUPS 8\n#define MAX_DMIC_TS_GROUPS 4\n#define MAX_FIXED_DMIC_PARAMS_SIZE 727\n\n \n#define UP_DOWN_MIXER_MAX_COEFF\t\t8\n\n#define MODULE_MAX_IN_PINS\t8\n#define MODULE_MAX_OUT_PINS\t8\n\n#define SKL_MIC_CH_SUPPORT\t4\n#define SKL_MIC_MAX_CH_SUPPORT\t8\n#define SKL_DEFAULT_MIC_SEL_GAIN\t0x3FF\n#define SKL_MIC_SEL_SWITCH\t0x3\n\n#define SKL_OUTPUT_PIN\t\t0\n#define SKL_INPUT_PIN\t\t1\n#define SKL_MAX_PATH_CONFIGS\t8\n#define SKL_MAX_MODULES_IN_PIPE\t8\n#define SKL_MAX_MODULE_FORMATS\t\t32\n#define SKL_MAX_MODULE_RESOURCES\t32\n\nenum skl_channel_index {\n\tSKL_CHANNEL_LEFT = 0,\n\tSKL_CHANNEL_RIGHT = 1,\n\tSKL_CHANNEL_CENTER = 2,\n\tSKL_CHANNEL_LEFT_SURROUND = 3,\n\tSKL_CHANNEL_CENTER_SURROUND = 3,\n\tSKL_CHANNEL_RIGHT_SURROUND = 4,\n\tSKL_CHANNEL_LFE = 7,\n\tSKL_CHANNEL_INVALID = 0xF,\n};\n\nenum skl_bitdepth {\n\tSKL_DEPTH_8BIT = 8,\n\tSKL_DEPTH_16BIT = 16,\n\tSKL_DEPTH_24BIT = 24,\n\tSKL_DEPTH_32BIT = 32,\n\tSKL_DEPTH_INVALID\n};\n\n\nenum skl_s_freq {\n\tSKL_FS_8000 = 8000,\n\tSKL_FS_11025 = 11025,\n\tSKL_FS_12000 = 12000,\n\tSKL_FS_16000 = 16000,\n\tSKL_FS_22050 = 22050,\n\tSKL_FS_24000 = 24000,\n\tSKL_FS_32000 = 32000,\n\tSKL_FS_44100 = 44100,\n\tSKL_FS_48000 = 48000,\n\tSKL_FS_64000 = 64000,\n\tSKL_FS_88200 = 88200,\n\tSKL_FS_96000 = 96000,\n\tSKL_FS_128000 = 128000,\n\tSKL_FS_176400 = 176400,\n\tSKL_FS_192000 = 192000,\n\tSKL_FS_INVALID\n};\n\n#define SKL_MAX_PARAMS_TYPES\t4\n\nenum skl_widget_type {\n\tSKL_WIDGET_VMIXER = 1,\n\tSKL_WIDGET_MIXER = 2,\n\tSKL_WIDGET_PGA = 3,\n\tSKL_WIDGET_MUX = 4\n};\n\nstruct skl_audio_data_format {\n\tenum skl_s_freq s_freq;\n\tenum skl_bitdepth bit_depth;\n\tu32 channel_map;\n\tenum skl_ch_cfg ch_cfg;\n\tenum skl_interleaving interleaving;\n\tu8 number_of_channels;\n\tu8 valid_bit_depth;\n\tu8 sample_type;\n\tu8 reserved;\n} __packed;\n\nstruct skl_base_cfg {\n\tu32 cpc;\n\tu32 ibs;\n\tu32 obs;\n\tu32 is_pages;\n\tstruct skl_audio_data_format audio_fmt;\n};\n\nstruct skl_cpr_gtw_cfg {\n\tu32 node_id;\n\tu32 dma_buffer_size;\n\tu32 config_length;\n\t \n\tstruct {\n\t\tu32 gtw_attrs;\n\t\tu32 data[];\n\t} config_data;\n} __packed;\n\nstruct skl_dma_control {\n\tu32 node_id;\n\tu32 config_length;\n\tu32 config_data[];\n} __packed;\n\nstruct skl_cpr_cfg {\n\tstruct skl_base_cfg base_cfg;\n\tstruct skl_audio_data_format out_fmt;\n\tu32 cpr_feature_mask;\n\tstruct skl_cpr_gtw_cfg gtw_cfg;\n} __packed;\n\nstruct skl_cpr_pin_fmt {\n\tu32 sink_id;\n\tstruct skl_audio_data_format src_fmt;\n\tstruct skl_audio_data_format dst_fmt;\n} __packed;\n\nstruct skl_src_module_cfg {\n\tstruct skl_base_cfg base_cfg;\n\tenum skl_s_freq src_cfg;\n} __packed;\n\nstruct skl_up_down_mixer_cfg {\n\tstruct skl_base_cfg base_cfg;\n\tenum skl_ch_cfg out_ch_cfg;\n\t \n\tu32 coeff_sel;\n\t \n\ts32 coeff[UP_DOWN_MIXER_MAX_COEFF];\n\tu32 ch_map;\n} __packed;\n\nstruct skl_pin_format {\n\tu32 pin_idx;\n\tu32 buf_size;\n\tstruct skl_audio_data_format audio_fmt;\n} __packed;\n\nstruct skl_base_cfg_ext {\n\tu16 nr_input_pins;\n\tu16 nr_output_pins;\n\tu8 reserved[8];\n\tu32 priv_param_length;\n\t \n\tstruct skl_pin_format pins_fmt[];\n} __packed;\n\nstruct skl_algo_cfg {\n\tstruct skl_base_cfg  base_cfg;\n\tchar params[];\n} __packed;\n\nstruct skl_base_outfmt_cfg {\n\tstruct skl_base_cfg base_cfg;\n\tstruct skl_audio_data_format out_fmt;\n} __packed;\n\nenum skl_dma_type {\n\tSKL_DMA_HDA_HOST_OUTPUT_CLASS = 0,\n\tSKL_DMA_HDA_HOST_INPUT_CLASS = 1,\n\tSKL_DMA_HDA_HOST_INOUT_CLASS = 2,\n\tSKL_DMA_HDA_LINK_OUTPUT_CLASS = 8,\n\tSKL_DMA_HDA_LINK_INPUT_CLASS = 9,\n\tSKL_DMA_HDA_LINK_INOUT_CLASS = 0xA,\n\tSKL_DMA_DMIC_LINK_INPUT_CLASS = 0xB,\n\tSKL_DMA_I2S_LINK_OUTPUT_CLASS = 0xC,\n\tSKL_DMA_I2S_LINK_INPUT_CLASS = 0xD,\n};\n\nunion skl_ssp_dma_node {\n\tu8 val;\n\tstruct {\n\t\tu8 time_slot_index:4;\n\t\tu8 i2s_instance:4;\n\t} dma_node;\n};\n\nunion skl_connector_node_id {\n\tu32 val;\n\tstruct {\n\t\tu32 vindex:8;\n\t\tu32 dma_type:4;\n\t\tu32 rsvd:20;\n\t} node;\n};\n\nstruct skl_module_fmt {\n\tu32 channels;\n\tu32 s_freq;\n\tu32 bit_depth;\n\tu32 valid_bit_depth;\n\tu32 ch_cfg;\n\tu32 interleaving_style;\n\tu32 sample_type;\n\tu32 ch_map;\n};\n\nstruct skl_module_cfg;\n\nstruct skl_mod_inst_map {\n\tu16 mod_id;\n\tu16 inst_id;\n};\n\nstruct skl_uuid_inst_map {\n\tu16 inst_id;\n\tu16 reserved;\n\tguid_t mod_uuid;\n} __packed;\n\nstruct skl_kpb_params {\n\tu32 num_modules;\n\tunion {\n\t\tDECLARE_FLEX_ARRAY(struct skl_mod_inst_map, map);\n\t\tDECLARE_FLEX_ARRAY(struct skl_uuid_inst_map, map_uuid);\n\t} u;\n};\n\nstruct skl_module_inst_id {\n\tguid_t mod_uuid;\n\tint module_id;\n\tu32 instance_id;\n\tint pvt_id;\n};\n\nenum skl_module_pin_state {\n\tSKL_PIN_UNBIND = 0,\n\tSKL_PIN_BIND_DONE = 1,\n};\n\nstruct skl_module_pin {\n\tstruct skl_module_inst_id id;\n\tbool is_dynamic;\n\tbool in_use;\n\tenum skl_module_pin_state pin_state;\n\tstruct skl_module_cfg *tgt_mcfg;\n};\n\nstruct skl_specific_cfg {\n\tu32 set_params;\n\tu32 param_id;\n\tu32 caps_size;\n\tu32 *caps;\n};\n\nenum skl_pipe_state {\n\tSKL_PIPE_INVALID = 0,\n\tSKL_PIPE_CREATED = 1,\n\tSKL_PIPE_PAUSED = 2,\n\tSKL_PIPE_STARTED = 3,\n\tSKL_PIPE_RESET = 4\n};\n\nstruct skl_pipe_module {\n\tstruct snd_soc_dapm_widget *w;\n\tstruct list_head node;\n};\n\nstruct skl_pipe_params {\n\tu8 host_dma_id;\n\tu8 link_dma_id;\n\tu32 ch;\n\tu32 s_freq;\n\tu32 s_fmt;\n\tu32 s_cont;\n\tu8 linktype;\n\tsnd_pcm_format_t format;\n\tint link_index;\n\tint stream;\n\tunsigned int host_bps;\n\tunsigned int link_bps;\n};\n\nstruct skl_pipe_fmt {\n\tu32 freq;\n\tu8 channels;\n\tu8 bps;\n};\n\nstruct skl_pipe_mcfg {\n\tu8 res_idx;\n\tu8 fmt_idx;\n};\n\nstruct skl_path_config {\n\tu8 mem_pages;\n\tstruct skl_pipe_fmt in_fmt;\n\tstruct skl_pipe_fmt out_fmt;\n};\n\nstruct skl_pipe {\n\tu8 ppl_id;\n\tu8 pipe_priority;\n\tu16 conn_type;\n\tu32 memory_pages;\n\tu8 lp_mode;\n\tstruct skl_pipe_params *p_params;\n\tenum skl_pipe_state state;\n\tu8 direction;\n\tu8 cur_config_idx;\n\tu8 nr_cfgs;\n\tstruct skl_path_config configs[SKL_MAX_PATH_CONFIGS];\n\tstruct list_head w_list;\n\tbool passthru;\n};\n\nenum skl_module_state {\n\tSKL_MODULE_UNINIT = 0,\n\tSKL_MODULE_INIT_DONE = 1,\n\tSKL_MODULE_BIND_DONE = 2,\n};\n\nenum d0i3_capability {\n\tSKL_D0I3_NONE = 0,\n\tSKL_D0I3_STREAMING = 1,\n\tSKL_D0I3_NON_STREAMING = 2,\n};\n\nstruct skl_module_pin_fmt {\n\tu8 id;\n\tstruct skl_module_fmt fmt;\n};\n\nstruct skl_module_iface {\n\tu8 fmt_idx;\n\tu8 nr_in_fmt;\n\tu8 nr_out_fmt;\n\tstruct skl_module_pin_fmt inputs[MAX_IN_QUEUE];\n\tstruct skl_module_pin_fmt outputs[MAX_OUT_QUEUE];\n};\n\nstruct skl_module_pin_resources {\n\tu8 pin_index;\n\tu32 buf_size;\n};\n\nstruct skl_module_res {\n\tu8 id;\n\tu32 is_pages;\n\tu32 ibs;\n\tu32 obs;\n\tu32 dma_buffer_size;\n\tu32 cpc;\n\tu8 nr_input_pins;\n\tu8 nr_output_pins;\n\tstruct skl_module_pin_resources input[MAX_IN_QUEUE];\n\tstruct skl_module_pin_resources output[MAX_OUT_QUEUE];\n};\n\nstruct skl_module {\n\tguid_t uuid;\n\tu8 loadable;\n\tu8 input_pin_type;\n\tu8 output_pin_type;\n\tu8 max_input_pins;\n\tu8 max_output_pins;\n\tu8 nr_resources;\n\tu8 nr_interfaces;\n\tstruct skl_module_res resources[SKL_MAX_MODULE_RESOURCES];\n\tstruct skl_module_iface formats[SKL_MAX_MODULE_FORMATS];\n};\n\nstruct skl_module_cfg {\n\tu8 guid[16];\n\tstruct skl_module_inst_id id;\n\tstruct skl_module *module;\n\tint res_idx;\n\tint fmt_idx;\n\tint fmt_cfg_idx;\n\tu8 domain;\n\tbool homogenous_inputs;\n\tbool homogenous_outputs;\n\tstruct skl_module_fmt in_fmt[MODULE_MAX_IN_PINS];\n\tstruct skl_module_fmt out_fmt[MODULE_MAX_OUT_PINS];\n\tu8 max_in_queue;\n\tu8 max_out_queue;\n\tu8 in_queue_mask;\n\tu8 out_queue_mask;\n\tu8 in_queue;\n\tu8 out_queue;\n\tu8 is_loadable;\n\tu8 core_id;\n\tu8 dev_type;\n\tu8 dma_id;\n\tu8 time_slot;\n\tu8 dmic_ch_combo_index;\n\tu32 dmic_ch_type;\n\tu32 params_fixup;\n\tu32 converter;\n\tu32 vbus_id;\n\tu32 mem_pages;\n\tenum d0i3_capability d0i3_caps;\n\tu32 dma_buffer_size;  \n\tstruct skl_module_pin *m_in_pin;\n\tstruct skl_module_pin *m_out_pin;\n\tenum skl_module_type m_type;\n\tenum skl_hw_conn_type  hw_conn_type;\n\tenum skl_module_state m_state;\n\tstruct skl_pipe *pipe;\n\tstruct skl_specific_cfg formats_config[SKL_MAX_PARAMS_TYPES];\n\tstruct skl_pipe_mcfg mod_cfg[SKL_MAX_MODULES_IN_PIPE];\n};\n\nstruct skl_algo_data {\n\tu32 param_id;\n\tu32 set_params;\n\tu32 max;\n\tu32 size;\n\tchar *params;\n};\n\nstruct skl_pipeline {\n\tstruct skl_pipe *pipe;\n\tstruct list_head node;\n};\n\nstruct skl_module_deferred_bind {\n\tstruct skl_module_cfg *src;\n\tstruct skl_module_cfg *dst;\n\tstruct list_head node;\n};\n\nstruct skl_mic_sel_config {\n\tu16 mic_switch;\n\tu16 flags;\n\tu16 blob[SKL_MIC_MAX_CH_SUPPORT][SKL_MIC_MAX_CH_SUPPORT];\n} __packed;\n\nenum skl_channel {\n\tSKL_CH_MONO = 1,\n\tSKL_CH_STEREO = 2,\n\tSKL_CH_TRIO = 3,\n\tSKL_CH_QUATRO = 4,\n};\n\nstatic inline struct skl_dev *get_skl_ctx(struct device *dev)\n{\n\tstruct hdac_bus *bus = dev_get_drvdata(dev);\n\n\treturn bus_to_skl(bus);\n}\n\nint skl_tplg_be_update_params(struct snd_soc_dai *dai,\n\tstruct skl_pipe_params *params);\nint skl_dsp_set_dma_control(struct skl_dev *skl, u32 *caps,\n\t\t\tu32 caps_size, u32 node_id);\nvoid skl_tplg_set_be_dmic_config(struct snd_soc_dai *dai,\n\tstruct skl_pipe_params *params, int stream);\nint skl_tplg_init(struct snd_soc_component *component,\n\t\t\t\tstruct hdac_bus *bus);\nvoid skl_tplg_exit(struct snd_soc_component *component,\n\t\t\t\tstruct hdac_bus *bus);\nstruct skl_module_cfg *skl_tplg_fe_get_cpr_module(\n\t\tstruct snd_soc_dai *dai, int stream);\nint skl_tplg_update_pipe_params(struct device *dev,\n\t\tstruct skl_module_cfg *mconfig, struct skl_pipe_params *params);\n\nvoid skl_tplg_d0i3_get(struct skl_dev *skl, enum d0i3_capability caps);\nvoid skl_tplg_d0i3_put(struct skl_dev *skl, enum d0i3_capability caps);\n\nint skl_create_pipeline(struct skl_dev *skl, struct skl_pipe *pipe);\n\nint skl_run_pipe(struct skl_dev *skl, struct skl_pipe *pipe);\n\nint skl_pause_pipe(struct skl_dev *skl, struct skl_pipe *pipe);\n\nint skl_delete_pipe(struct skl_dev *skl, struct skl_pipe *pipe);\n\nint skl_stop_pipe(struct skl_dev *skl, struct skl_pipe *pipe);\n\nint skl_reset_pipe(struct skl_dev *skl, struct skl_pipe *pipe);\n\nint skl_init_module(struct skl_dev *skl, struct skl_module_cfg *mconfig);\n\nint skl_bind_modules(struct skl_dev *skl, struct skl_module_cfg\n\t*src_mcfg, struct skl_module_cfg *dst_mcfg);\n\nint skl_unbind_modules(struct skl_dev *skl, struct skl_module_cfg\n\t*src_mcfg, struct skl_module_cfg *dst_mcfg);\n\nint skl_set_module_params(struct skl_dev *skl, u32 *params, int size,\n\t\t\tu32 param_id, struct skl_module_cfg *mcfg);\nint skl_get_module_params(struct skl_dev *skl, u32 *params, int size,\n\t\t\t  u32 param_id, struct skl_module_cfg *mcfg);\n\nstruct skl_module_cfg *skl_tplg_be_get_cpr_module(struct snd_soc_dai *dai,\n\t\t\t\t\t\t\t\tint stream);\nenum skl_bitdepth skl_get_bit_depth(int params);\nint skl_pcm_host_dma_prepare(struct device *dev,\n\t\t\tstruct skl_pipe_params *params);\nint skl_pcm_link_dma_prepare(struct device *dev,\n\t\t\tstruct skl_pipe_params *params);\n\nint skl_dai_load(struct snd_soc_component *cmp, int index,\n\t\tstruct snd_soc_dai_driver *dai_drv,\n\t\tstruct snd_soc_tplg_pcm *pcm, struct snd_soc_dai *dai);\nvoid skl_tplg_add_moduleid_in_bind_params(struct skl_dev *skl,\n\t\t\t\tstruct snd_soc_dapm_widget *w);\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}