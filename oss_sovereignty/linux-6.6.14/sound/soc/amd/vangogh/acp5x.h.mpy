{
  "module_name": "acp5x.h",
  "hash_id": "898588333d52e9f8bf10dfffc793f1f69d550a361404a90b6bfd0b1be1f31bd2",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/amd/vangogh/acp5x.h",
  "human_readable_source": " \n \n\n#include \"vg_chip_offset_byte.h\"\n#include <sound/pcm.h>\n\n#define ACP5x_PHY_BASE_ADDRESS 0x1240000\n#define ACP_DEVICE_ID 0x15E2\n#define ACP_SOFT_RESET_SOFTRESET_AUDDONE_MASK\t0x00010001\n\n#define ACP_PGFSM_CNTL_POWER_ON_MASK\t0x01\n#define ACP_PGFSM_CNTL_POWER_OFF_MASK\t0x00\n#define ACP_PGFSM_STATUS_MASK\t\t0x03\n#define ACP_POWERED_ON\t\t\t0x00\n#define ACP_POWER_ON_IN_PROGRESS\t0x01\n#define ACP_POWERED_OFF\t\t\t0x02\n#define ACP_POWER_OFF_IN_PROGRESS\t0x03\n\n#define ACP_ERR_INTR_MASK\t0x20000000\n#define ACP_EXT_INTR_STAT_CLEAR_MASK 0xFFFFFFFF\n\n#define ACP5x_DEVS 4\n#define\tACP5x_REG_START\t0x1240000\n#define\tACP5x_REG_END\t0x1250200\n#define ACP5x_I2STDM_REG_START\t0x1242400\n#define ACP5x_I2STDM_REG_END\t0x1242410\n#define ACP5x_HS_TDM_REG_START\t0x1242814\n#define ACP5x_HS_TDM_REG_END\t0x1242824\n#define I2S_MODE 0\n#define ACP5x_I2S_MODE 1\n#define ACP5x_RES 4\n#define\tI2S_RX_THRESHOLD 27\n#define\tI2S_TX_THRESHOLD 28\n#define\tHS_TX_THRESHOLD 24\n#define\tHS_RX_THRESHOLD 23\n\n#define I2S_SP_INSTANCE                 1\n#define I2S_HS_INSTANCE                 2\n\n#define ACP_SRAM_PTE_OFFSET\t0x02050000\n#define ACP_SRAM_SP_PB_PTE_OFFSET\t0x0\n#define ACP_SRAM_SP_CP_PTE_OFFSET\t0x100\n#define ACP_SRAM_HS_PB_PTE_OFFSET\t0x200\n#define ACP_SRAM_HS_CP_PTE_OFFSET\t0x300\n#define PAGE_SIZE_4K_ENABLE 0x2\n#define I2S_SP_TX_MEM_WINDOW_START\t0x4000000\n#define I2S_SP_RX_MEM_WINDOW_START\t0x4020000\n#define I2S_HS_TX_MEM_WINDOW_START\t0x4040000\n#define I2S_HS_RX_MEM_WINDOW_START\t0x4060000\n\n#define SP_PB_FIFO_ADDR_OFFSET\t\t0x500\n#define SP_CAPT_FIFO_ADDR_OFFSET\t0x700\n#define HS_PB_FIFO_ADDR_OFFSET\t\t0x900\n#define HS_CAPT_FIFO_ADDR_OFFSET\t0xB00\n#define PLAYBACK_MIN_NUM_PERIODS    2\n#define PLAYBACK_MAX_NUM_PERIODS    8\n#define PLAYBACK_MAX_PERIOD_SIZE    8192\n#define PLAYBACK_MIN_PERIOD_SIZE    1024\n#define CAPTURE_MIN_NUM_PERIODS     2\n#define CAPTURE_MAX_NUM_PERIODS     8\n#define CAPTURE_MAX_PERIOD_SIZE     8192\n#define CAPTURE_MIN_PERIOD_SIZE     1024\n\n#define MAX_BUFFER (PLAYBACK_MAX_PERIOD_SIZE * PLAYBACK_MAX_NUM_PERIODS)\n#define MIN_BUFFER MAX_BUFFER\n#define FIFO_SIZE 0x100\n#define DMA_SIZE 0x40\n#define FRM_LEN 0x100\n\n#define I2S_MASTER_MODE_ENABLE 1\n#define I2S_MASTER_MODE_DISABLE 0\n\n#define SLOT_WIDTH_8 8\n#define SLOT_WIDTH_16 16\n#define SLOT_WIDTH_24 24\n#define SLOT_WIDTH_32 32\n#define TDM_ENABLE 1\n#define TDM_DISABLE 0\n#define ACP5x_ITER_IRER_SAMP_LEN_MASK\t0x38\n\nstruct i2s_dev_data {\n\tbool tdm_mode;\n\tbool master_mode;\n\tint i2s_irq;\n\tu16 i2s_instance;\n\tu32 tdm_fmt;\n\tvoid __iomem *acp5x_base;\n\tstruct snd_pcm_substream *play_stream;\n\tstruct snd_pcm_substream *capture_stream;\n\tstruct snd_pcm_substream *i2ssp_play_stream;\n\tstruct snd_pcm_substream *i2ssp_capture_stream;\n};\n\nstruct i2s_stream_instance {\n\tu16 num_pages;\n\tu16 i2s_instance;\n\tu16 direction;\n\tu16 channels;\n\tu32 xfer_resolution;\n\tu32 val;\n\tdma_addr_t dma_addr;\n\tu64 bytescount;\n\tvoid __iomem *acp5x_base;\n\tu32 lrclk_div;\n\tu32 bclk_div;\n};\n\nunion acp_dma_count {\n\tstruct {\n\t\tu32 low;\n\t\tu32 high;\n\t} bcount;\n\tu64 bytescount;\n};\n\nstruct acp5x_platform_info {\n\tu16 play_i2s_instance;\n\tu16 cap_i2s_instance;\n};\n\nunion acp_i2stdm_mstrclkgen {\n\tstruct {\n\t\tu32 i2stdm_master_mode : 1;\n\t\tu32 i2stdm_format_mode : 1;\n\t\tu32 i2stdm_lrclk_div_val : 9;\n\t\tu32 i2stdm_bclk_div_val : 11;\n\t\tu32:10;\n\t} bitfields, bits;\n\tu32  u32_all;\n};\n\n \nstatic inline u32 acp_readl(void __iomem *base_addr)\n{\n\treturn readl(base_addr - ACP5x_PHY_BASE_ADDRESS);\n}\n\nstatic inline void acp_writel(u32 val, void __iomem *base_addr)\n{\n\twritel(val, base_addr - ACP5x_PHY_BASE_ADDRESS);\n}\n\nint snd_amd_acp_find_config(struct pci_dev *pci);\n\nstatic inline u64 acp_get_byte_count(struct i2s_stream_instance *rtd,\n\t\t\t\t     int direction)\n{\n\tunion acp_dma_count byte_count;\n\n\tif (direction == SNDRV_PCM_STREAM_PLAYBACK) {\n\t\tswitch (rtd->i2s_instance) {\n\t\tcase I2S_HS_INSTANCE:\n\t\t\tbyte_count.bcount.high =\n\t\t\t\tacp_readl(rtd->acp5x_base +\n\t\t\t\t\t  ACP_HS_TX_LINEARPOSCNTR_HIGH);\n\t\t\tbyte_count.bcount.low =\n\t\t\t\tacp_readl(rtd->acp5x_base +\n\t\t\t\t\t  ACP_HS_TX_LINEARPOSCNTR_LOW);\n\t\t\tbreak;\n\t\tcase I2S_SP_INSTANCE:\n\t\tdefault:\n\t\t\tbyte_count.bcount.high =\n\t\t\t\tacp_readl(rtd->acp5x_base +\n\t\t\t\t\t  ACP_I2S_TX_LINEARPOSCNTR_HIGH);\n\t\t\tbyte_count.bcount.low =\n\t\t\t\tacp_readl(rtd->acp5x_base +\n\t\t\t\t\t  ACP_I2S_TX_LINEARPOSCNTR_LOW);\n\t\t}\n\t} else {\n\t\tswitch (rtd->i2s_instance) {\n\t\tcase I2S_HS_INSTANCE:\n\t\t\tbyte_count.bcount.high =\n\t\t\t\tacp_readl(rtd->acp5x_base +\n\t\t\t\t\t  ACP_HS_RX_LINEARPOSCNTR_HIGH);\n\t\t\tbyte_count.bcount.low =\n\t\t\t\tacp_readl(rtd->acp5x_base +\n\t\t\t\t\t  ACP_HS_RX_LINEARPOSCNTR_LOW);\n\t\t\tbreak;\n\t\tcase I2S_SP_INSTANCE:\n\t\tdefault:\n\t\t\tbyte_count.bcount.high =\n\t\t\t\tacp_readl(rtd->acp5x_base +\n\t\t\t\t\t  ACP_I2S_RX_LINEARPOSCNTR_HIGH);\n\t\t\tbyte_count.bcount.low =\n\t\t\t\tacp_readl(rtd->acp5x_base +\n\t\t\t\t\t  ACP_I2S_RX_LINEARPOSCNTR_LOW);\n\t\t}\n\t}\n\treturn byte_count.bytescount;\n}\n\nstatic inline void acp5x_set_i2s_clk(struct i2s_dev_data *adata,\n\t\t\t\t     struct i2s_stream_instance *rtd)\n{\n\tunion acp_i2stdm_mstrclkgen mclkgen;\n\tu32 master_reg;\n\n\tswitch (rtd->i2s_instance) {\n\tcase I2S_HS_INSTANCE:\n\t\tmaster_reg = ACP_I2STDM2_MSTRCLKGEN;\n\t\tbreak;\n\tcase I2S_SP_INSTANCE:\n\tdefault:\n\t\tmaster_reg = ACP_I2STDM0_MSTRCLKGEN;\n\t\tbreak;\n\t}\n\n\tmclkgen.bits.i2stdm_master_mode = 0x1;\n\tif (adata->tdm_mode)\n\t\tmclkgen.bits.i2stdm_format_mode = 0x01;\n\telse\n\t\tmclkgen.bits.i2stdm_format_mode = 0x00;\n\n\tmclkgen.bits.i2stdm_bclk_div_val = rtd->bclk_div;\n\tmclkgen.bits.i2stdm_lrclk_div_val = rtd->lrclk_div;\n\tacp_writel(mclkgen.u32_all, rtd->acp5x_base + master_reg);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}