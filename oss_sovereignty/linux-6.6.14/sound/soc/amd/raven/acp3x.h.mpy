{
  "module_name": "acp3x.h",
  "hash_id": "23eb3f7fc639505d8cc6b20a771b28d02da97661c0bc259c6140f99f2ba26b96",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/amd/raven/acp3x.h",
  "human_readable_source": " \n \n\n#include \"chip_offset_byte.h\"\n#include <sound/pcm.h>\n#define I2S_SP_INSTANCE                 0x01\n#define I2S_BT_INSTANCE                 0x02\n\n#define TDM_ENABLE 1\n#define TDM_DISABLE 0\n\n#define ACP3x_DEVS\t\t4\n#define ACP3x_PHY_BASE_ADDRESS 0x1240000\n#define\tACP3x_I2S_MODE\t0\n#define\tACP3x_REG_START\t0x1240000\n#define\tACP3x_REG_END\t0x1250200\n#define ACP3x_I2STDM_REG_START\t0x1242400\n#define ACP3x_I2STDM_REG_END\t0x1242410\n#define ACP3x_BT_TDM_REG_START\t0x1242800\n#define ACP3x_BT_TDM_REG_END\t0x1242810\n#define I2S_MODE\t0x04\n#define\tI2S_RX_THRESHOLD\t27\n#define\tI2S_TX_THRESHOLD\t28\n#define\tBT_TX_THRESHOLD 26\n#define\tBT_RX_THRESHOLD 25\n#define ACP_ERR_INTR_MASK\t29\n#define ACP3x_POWER_ON 0x00\n#define ACP3x_POWER_ON_IN_PROGRESS 0x01\n#define ACP3x_POWER_OFF 0x02\n#define ACP3x_POWER_OFF_IN_PROGRESS 0x03\n#define ACP3x_SOFT_RESET__SoftResetAudDone_MASK\t0x00010001\n\n#define ACP_SRAM_PTE_OFFSET\t0x02050000\n#define ACP_SRAM_SP_PB_PTE_OFFSET\t0x0\n#define ACP_SRAM_SP_CP_PTE_OFFSET\t0x100\n#define ACP_SRAM_BT_PB_PTE_OFFSET\t0x200\n#define ACP_SRAM_BT_CP_PTE_OFFSET\t0x300\n#define PAGE_SIZE_4K_ENABLE 0x2\n#define I2S_SP_TX_MEM_WINDOW_START\t0x4000000\n#define I2S_SP_RX_MEM_WINDOW_START\t0x4020000\n#define I2S_BT_TX_MEM_WINDOW_START\t0x4040000\n#define I2S_BT_RX_MEM_WINDOW_START\t0x4060000\n\n#define SP_PB_FIFO_ADDR_OFFSET\t\t0x500\n#define SP_CAPT_FIFO_ADDR_OFFSET\t0x700\n#define BT_PB_FIFO_ADDR_OFFSET\t\t0x900\n#define BT_CAPT_FIFO_ADDR_OFFSET\t0xB00\n#define PLAYBACK_MIN_NUM_PERIODS    2\n#define PLAYBACK_MAX_NUM_PERIODS    8\n#define PLAYBACK_MAX_PERIOD_SIZE    8192\n#define PLAYBACK_MIN_PERIOD_SIZE    1024\n#define CAPTURE_MIN_NUM_PERIODS     2\n#define CAPTURE_MAX_NUM_PERIODS     8\n#define CAPTURE_MAX_PERIOD_SIZE     8192\n#define CAPTURE_MIN_PERIOD_SIZE     1024\n\n#define MAX_BUFFER (PLAYBACK_MAX_PERIOD_SIZE * PLAYBACK_MAX_NUM_PERIODS)\n#define MIN_BUFFER MAX_BUFFER\n#define FIFO_SIZE 0x100\n#define DMA_SIZE 0x40\n#define FRM_LEN 0x100\n\n#define SLOT_WIDTH_8 0x08\n#define SLOT_WIDTH_16 0x10\n#define SLOT_WIDTH_24 0x18\n#define SLOT_WIDTH_32 0x20\n#define ACP_PGFSM_CNTL_POWER_ON_MASK\t0x01\n#define ACP_PGFSM_CNTL_POWER_OFF_MASK\t0x00\n#define ACP_PGFSM_STATUS_MASK\t\t0x03\n#define ACP_POWERED_ON\t\t\t0x00\n#define ACP_POWER_ON_IN_PROGRESS\t0x01\n#define ACP_POWERED_OFF\t\t\t0x02\n#define ACP_POWER_OFF_IN_PROGRESS\t0x03\n\n#define ACP3x_ITER_IRER_SAMP_LEN_MASK\t0x38\n#define ACP_EXT_INTR_STAT_CLEAR_MASK 0xFFFFFFFF\n\nstruct acp3x_platform_info {\n\tu16 play_i2s_instance;\n\tu16 cap_i2s_instance;\n\tu16 capture_channel;\n};\n\nstruct i2s_dev_data {\n\tbool tdm_mode;\n\tint i2s_irq;\n\tu16 i2s_instance;\n\tu32 tdm_fmt;\n\tu32 substream_type;\n\tvoid __iomem *acp3x_base;\n\tstruct snd_pcm_substream *play_stream;\n\tstruct snd_pcm_substream *capture_stream;\n\tstruct snd_pcm_substream *i2ssp_play_stream;\n\tstruct snd_pcm_substream *i2ssp_capture_stream;\n};\n\nstruct i2s_stream_instance {\n\tu16 num_pages;\n\tu16 i2s_instance;\n\tu16 capture_channel;\n\tu16 direction;\n\tu16 channels;\n\tu32 xfer_resolution;\n\tu32 val;\n\tdma_addr_t dma_addr;\n\tu64 bytescount;\n\tvoid __iomem *acp3x_base;\n};\n\nstatic inline u32 rv_readl(void __iomem *base_addr)\n{\n\treturn readl(base_addr - ACP3x_PHY_BASE_ADDRESS);\n}\n\nstatic inline void rv_writel(u32 val, void __iomem *base_addr)\n{\n\twritel(val, base_addr - ACP3x_PHY_BASE_ADDRESS);\n}\n\nstatic inline u64 acp_get_byte_count(struct i2s_stream_instance *rtd,\n\t\t\t\t\t\t\tint direction)\n{\n\tu64 byte_count;\n\n\tif (direction == SNDRV_PCM_STREAM_PLAYBACK) {\n\t\tswitch (rtd->i2s_instance) {\n\t\tcase I2S_BT_INSTANCE:\n\t\t\tbyte_count = rv_readl(rtd->acp3x_base +\n\t\t\t\t\tmmACP_BT_TX_LINEARPOSITIONCNTR_HIGH);\n\t\t\tbyte_count |= rv_readl(rtd->acp3x_base +\n\t\t\t\t\tmmACP_BT_TX_LINEARPOSITIONCNTR_LOW);\n\t\t\tbreak;\n\t\tcase I2S_SP_INSTANCE:\n\t\tdefault:\n\t\t\tbyte_count = rv_readl(rtd->acp3x_base +\n\t\t\t\t\tmmACP_I2S_TX_LINEARPOSITIONCNTR_HIGH);\n\t\t\tbyte_count |= rv_readl(rtd->acp3x_base +\n\t\t\t\t\tmmACP_I2S_TX_LINEARPOSITIONCNTR_LOW);\n\t\t}\n\n\t} else {\n\t\tswitch (rtd->i2s_instance) {\n\t\tcase I2S_BT_INSTANCE:\n\t\t\tbyte_count = rv_readl(rtd->acp3x_base +\n\t\t\t\t\tmmACP_BT_RX_LINEARPOSITIONCNTR_HIGH);\n\t\t\tbyte_count |= rv_readl(rtd->acp3x_base +\n\t\t\t\t\tmmACP_BT_RX_LINEARPOSITIONCNTR_LOW);\n\t\t\tbreak;\n\t\tcase I2S_SP_INSTANCE:\n\t\tdefault:\n\t\t\tbyte_count = rv_readl(rtd->acp3x_base +\n\t\t\t\t\tmmACP_I2S_RX_LINEARPOSITIONCNTR_HIGH);\n\t\t\tbyte_count |= rv_readl(rtd->acp3x_base +\n\t\t\t\t\tmmACP_I2S_RX_LINEARPOSITIONCNTR_LOW);\n\t\t}\n\t}\n\treturn byte_count;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}