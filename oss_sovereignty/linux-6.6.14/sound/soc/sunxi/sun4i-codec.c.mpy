{
  "module_name": "sun4i-codec.c",
  "hash_id": "bf34a5809e6302717b7ab7faaa3a09e6be3eba63ef8d113e92e2eeef1beb6614",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/sunxi/sun4i-codec.c",
  "human_readable_source": "\n \n\n#include <linux/init.h>\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/platform_device.h>\n#include <linux/delay.h>\n#include <linux/slab.h>\n#include <linux/of.h>\n#include <linux/of_address.h>\n#include <linux/of_device.h>\n#include <linux/of_platform.h>\n#include <linux/clk.h>\n#include <linux/regmap.h>\n#include <linux/reset.h>\n#include <linux/gpio/consumer.h>\n\n#include <sound/core.h>\n#include <sound/pcm.h>\n#include <sound/pcm_params.h>\n#include <sound/soc.h>\n#include <sound/tlv.h>\n#include <sound/initval.h>\n#include <sound/dmaengine_pcm.h>\n\n \n#define SUN4I_CODEC_DAC_DPC\t\t\t(0x00)\n#define SUN4I_CODEC_DAC_DPC_EN_DA\t\t\t(31)\n#define SUN4I_CODEC_DAC_DPC_DVOL\t\t\t(12)\n#define SUN4I_CODEC_DAC_FIFOC\t\t\t(0x04)\n#define SUN4I_CODEC_DAC_FIFOC_DAC_FS\t\t\t(29)\n#define SUN4I_CODEC_DAC_FIFOC_FIR_VERSION\t\t(28)\n#define SUN4I_CODEC_DAC_FIFOC_SEND_LASAT\t\t(26)\n#define SUN4I_CODEC_DAC_FIFOC_TX_FIFO_MODE\t\t(24)\n#define SUN4I_CODEC_DAC_FIFOC_DRQ_CLR_CNT\t\t(21)\n#define SUN4I_CODEC_DAC_FIFOC_TX_TRIG_LEVEL\t\t(8)\n#define SUN4I_CODEC_DAC_FIFOC_MONO_EN\t\t\t(6)\n#define SUN4I_CODEC_DAC_FIFOC_TX_SAMPLE_BITS\t\t(5)\n#define SUN4I_CODEC_DAC_FIFOC_DAC_DRQ_EN\t\t(4)\n#define SUN4I_CODEC_DAC_FIFOC_FIFO_FLUSH\t\t(0)\n#define SUN4I_CODEC_DAC_FIFOS\t\t\t(0x08)\n#define SUN4I_CODEC_DAC_TXDATA\t\t\t(0x0c)\n\n \n#define SUN4I_CODEC_DAC_ACTL\t\t\t(0x10)\n#define SUN4I_CODEC_DAC_ACTL_DACAENR\t\t\t(31)\n#define SUN4I_CODEC_DAC_ACTL_DACAENL\t\t\t(30)\n#define SUN4I_CODEC_DAC_ACTL_MIXEN\t\t\t(29)\n#define SUN4I_CODEC_DAC_ACTL_LNG\t\t\t(26)\n#define SUN4I_CODEC_DAC_ACTL_FMG\t\t\t(23)\n#define SUN4I_CODEC_DAC_ACTL_MICG\t\t\t(20)\n#define SUN4I_CODEC_DAC_ACTL_LLNS\t\t\t(19)\n#define SUN4I_CODEC_DAC_ACTL_RLNS\t\t\t(18)\n#define SUN4I_CODEC_DAC_ACTL_LFMS\t\t\t(17)\n#define SUN4I_CODEC_DAC_ACTL_RFMS\t\t\t(16)\n#define SUN4I_CODEC_DAC_ACTL_LDACLMIXS\t\t\t(15)\n#define SUN4I_CODEC_DAC_ACTL_RDACRMIXS\t\t\t(14)\n#define SUN4I_CODEC_DAC_ACTL_LDACRMIXS\t\t\t(13)\n#define SUN4I_CODEC_DAC_ACTL_MIC1LS\t\t\t(12)\n#define SUN4I_CODEC_DAC_ACTL_MIC1RS\t\t\t(11)\n#define SUN4I_CODEC_DAC_ACTL_MIC2LS\t\t\t(10)\n#define SUN4I_CODEC_DAC_ACTL_MIC2RS\t\t\t(9)\n#define SUN4I_CODEC_DAC_ACTL_DACPAS\t\t\t(8)\n#define SUN4I_CODEC_DAC_ACTL_MIXPAS\t\t\t(7)\n#define SUN4I_CODEC_DAC_ACTL_PA_MUTE\t\t\t(6)\n#define SUN4I_CODEC_DAC_ACTL_PA_VOL\t\t\t(0)\n#define SUN4I_CODEC_DAC_TUNE\t\t\t(0x14)\n#define SUN4I_CODEC_DAC_DEBUG\t\t\t(0x18)\n\n \n#define SUN4I_CODEC_ADC_FIFOC\t\t\t(0x1c)\n#define SUN4I_CODEC_ADC_FIFOC_ADC_FS\t\t\t(29)\n#define SUN4I_CODEC_ADC_FIFOC_EN_AD\t\t\t(28)\n#define SUN4I_CODEC_ADC_FIFOC_RX_FIFO_MODE\t\t(24)\n#define SUN4I_CODEC_ADC_FIFOC_RX_TRIG_LEVEL\t\t(8)\n#define SUN4I_CODEC_ADC_FIFOC_MONO_EN\t\t\t(7)\n#define SUN4I_CODEC_ADC_FIFOC_RX_SAMPLE_BITS\t\t(6)\n#define SUN4I_CODEC_ADC_FIFOC_ADC_DRQ_EN\t\t(4)\n#define SUN4I_CODEC_ADC_FIFOC_FIFO_FLUSH\t\t(0)\n#define SUN4I_CODEC_ADC_FIFOS\t\t\t(0x20)\n#define SUN4I_CODEC_ADC_RXDATA\t\t\t(0x24)\n\n \n#define SUN4I_CODEC_ADC_ACTL\t\t\t(0x28)\n#define SUN4I_CODEC_ADC_ACTL_ADC_R_EN\t\t\t(31)\n#define SUN4I_CODEC_ADC_ACTL_ADC_L_EN\t\t\t(30)\n#define SUN4I_CODEC_ADC_ACTL_PREG1EN\t\t\t(29)\n#define SUN4I_CODEC_ADC_ACTL_PREG2EN\t\t\t(28)\n#define SUN4I_CODEC_ADC_ACTL_VMICEN\t\t\t(27)\n#define SUN4I_CODEC_ADC_ACTL_PREG1\t\t\t(25)\n#define SUN4I_CODEC_ADC_ACTL_PREG2\t\t\t(23)\n#define SUN4I_CODEC_ADC_ACTL_VADCG\t\t\t(20)\n#define SUN4I_CODEC_ADC_ACTL_ADCIS\t\t\t(17)\n#define SUN4I_CODEC_ADC_ACTL_LNPREG\t\t\t(13)\n#define SUN4I_CODEC_ADC_ACTL_PA_EN\t\t\t(4)\n#define SUN4I_CODEC_ADC_ACTL_DDE\t\t\t(3)\n#define SUN4I_CODEC_ADC_DEBUG\t\t\t(0x2c)\n\n \n#define SUN4I_CODEC_DAC_TXCNT\t\t\t(0x30)\n#define SUN4I_CODEC_ADC_RXCNT\t\t\t(0x34)\n\n \n#define SUN7I_CODEC_AC_DAC_CAL\t\t\t(0x38)\n\n \n#define SUN7I_CODEC_AC_MIC_PHONE_CAL\t\t(0x3c)\n\n#define SUN7I_CODEC_AC_MIC_PHONE_CAL_PREG1\t\t(29)\n#define SUN7I_CODEC_AC_MIC_PHONE_CAL_PREG2\t\t(26)\n\n \n\n \n#define SUN6I_CODEC_ADC_FIFOC\t\t\t(0x10)\n#define SUN6I_CODEC_ADC_FIFOC_EN_AD\t\t\t(28)\n#define SUN6I_CODEC_ADC_FIFOS\t\t\t(0x14)\n#define SUN6I_CODEC_ADC_RXDATA\t\t\t(0x18)\n\n \n#define SUN6I_CODEC_OM_DACA_CTRL\t\t(0x20)\n#define SUN6I_CODEC_OM_DACA_CTRL_DACAREN\t\t(31)\n#define SUN6I_CODEC_OM_DACA_CTRL_DACALEN\t\t(30)\n#define SUN6I_CODEC_OM_DACA_CTRL_RMIXEN\t\t\t(29)\n#define SUN6I_CODEC_OM_DACA_CTRL_LMIXEN\t\t\t(28)\n#define SUN6I_CODEC_OM_DACA_CTRL_RMIX_MIC1\t\t(23)\n#define SUN6I_CODEC_OM_DACA_CTRL_RMIX_MIC2\t\t(22)\n#define SUN6I_CODEC_OM_DACA_CTRL_RMIX_PHONE\t\t(21)\n#define SUN6I_CODEC_OM_DACA_CTRL_RMIX_PHONEP\t\t(20)\n#define SUN6I_CODEC_OM_DACA_CTRL_RMIX_LINEINR\t\t(19)\n#define SUN6I_CODEC_OM_DACA_CTRL_RMIX_DACR\t\t(18)\n#define SUN6I_CODEC_OM_DACA_CTRL_RMIX_DACL\t\t(17)\n#define SUN6I_CODEC_OM_DACA_CTRL_LMIX_MIC1\t\t(16)\n#define SUN6I_CODEC_OM_DACA_CTRL_LMIX_MIC2\t\t(15)\n#define SUN6I_CODEC_OM_DACA_CTRL_LMIX_PHONE\t\t(14)\n#define SUN6I_CODEC_OM_DACA_CTRL_LMIX_PHONEN\t\t(13)\n#define SUN6I_CODEC_OM_DACA_CTRL_LMIX_LINEINL\t\t(12)\n#define SUN6I_CODEC_OM_DACA_CTRL_LMIX_DACL\t\t(11)\n#define SUN6I_CODEC_OM_DACA_CTRL_LMIX_DACR\t\t(10)\n#define SUN6I_CODEC_OM_DACA_CTRL_RHPIS\t\t\t(9)\n#define SUN6I_CODEC_OM_DACA_CTRL_LHPIS\t\t\t(8)\n#define SUN6I_CODEC_OM_DACA_CTRL_RHPPAMUTE\t\t(7)\n#define SUN6I_CODEC_OM_DACA_CTRL_LHPPAMUTE\t\t(6)\n#define SUN6I_CODEC_OM_DACA_CTRL_HPVOL\t\t\t(0)\n#define SUN6I_CODEC_OM_PA_CTRL\t\t\t(0x24)\n#define SUN6I_CODEC_OM_PA_CTRL_HPPAEN\t\t\t(31)\n#define SUN6I_CODEC_OM_PA_CTRL_HPCOM_CTL\t\t(29)\n#define SUN6I_CODEC_OM_PA_CTRL_COMPTEN\t\t\t(28)\n#define SUN6I_CODEC_OM_PA_CTRL_MIC1G\t\t\t(15)\n#define SUN6I_CODEC_OM_PA_CTRL_MIC2G\t\t\t(12)\n#define SUN6I_CODEC_OM_PA_CTRL_LINEING\t\t\t(9)\n#define SUN6I_CODEC_OM_PA_CTRL_PHONEG\t\t\t(6)\n#define SUN6I_CODEC_OM_PA_CTRL_PHONEPG\t\t\t(3)\n#define SUN6I_CODEC_OM_PA_CTRL_PHONENG\t\t\t(0)\n\n \n#define SUN6I_CODEC_MIC_CTRL\t\t\t(0x28)\n#define SUN6I_CODEC_MIC_CTRL_HBIASEN\t\t\t(31)\n#define SUN6I_CODEC_MIC_CTRL_MBIASEN\t\t\t(30)\n#define SUN6I_CODEC_MIC_CTRL_MIC1AMPEN\t\t\t(28)\n#define SUN6I_CODEC_MIC_CTRL_MIC1BOOST\t\t\t(25)\n#define SUN6I_CODEC_MIC_CTRL_MIC2AMPEN\t\t\t(24)\n#define SUN6I_CODEC_MIC_CTRL_MIC2BOOST\t\t\t(21)\n#define SUN6I_CODEC_MIC_CTRL_MIC2SLT\t\t\t(20)\n#define SUN6I_CODEC_MIC_CTRL_LINEOUTLEN\t\t\t(19)\n#define SUN6I_CODEC_MIC_CTRL_LINEOUTREN\t\t\t(18)\n#define SUN6I_CODEC_MIC_CTRL_LINEOUTLSRC\t\t(17)\n#define SUN6I_CODEC_MIC_CTRL_LINEOUTRSRC\t\t(16)\n#define SUN6I_CODEC_MIC_CTRL_LINEOUTVC\t\t\t(11)\n#define SUN6I_CODEC_MIC_CTRL_PHONEPREG\t\t\t(8)\n\n \n#define SUN6I_CODEC_ADC_ACTL\t\t\t(0x2c)\n#define SUN6I_CODEC_ADC_ACTL_ADCREN\t\t\t(31)\n#define SUN6I_CODEC_ADC_ACTL_ADCLEN\t\t\t(30)\n#define SUN6I_CODEC_ADC_ACTL_ADCRG\t\t\t(27)\n#define SUN6I_CODEC_ADC_ACTL_ADCLG\t\t\t(24)\n#define SUN6I_CODEC_ADC_ACTL_RADCMIX_MIC1\t\t(13)\n#define SUN6I_CODEC_ADC_ACTL_RADCMIX_MIC2\t\t(12)\n#define SUN6I_CODEC_ADC_ACTL_RADCMIX_PHONE\t\t(11)\n#define SUN6I_CODEC_ADC_ACTL_RADCMIX_PHONEP\t\t(10)\n#define SUN6I_CODEC_ADC_ACTL_RADCMIX_LINEINR\t\t(9)\n#define SUN6I_CODEC_ADC_ACTL_RADCMIX_OMIXR\t\t(8)\n#define SUN6I_CODEC_ADC_ACTL_RADCMIX_OMIXL\t\t(7)\n#define SUN6I_CODEC_ADC_ACTL_LADCMIX_MIC1\t\t(6)\n#define SUN6I_CODEC_ADC_ACTL_LADCMIX_MIC2\t\t(5)\n#define SUN6I_CODEC_ADC_ACTL_LADCMIX_PHONE\t\t(4)\n#define SUN6I_CODEC_ADC_ACTL_LADCMIX_PHONEN\t\t(3)\n#define SUN6I_CODEC_ADC_ACTL_LADCMIX_LINEINL\t\t(2)\n#define SUN6I_CODEC_ADC_ACTL_LADCMIX_OMIXL\t\t(1)\n#define SUN6I_CODEC_ADC_ACTL_LADCMIX_OMIXR\t\t(0)\n\n \n#define SUN6I_CODEC_ADDA_TUNE\t\t\t(0x30)\n\n \n#define SUN6I_CODEC_CALIBRATION\t\t\t(0x34)\n\n \n#define SUN6I_CODEC_DAC_TXCNT\t\t\t(0x40)\n#define SUN6I_CODEC_ADC_RXCNT\t\t\t(0x44)\n\n \n#define SUN6I_CODEC_HMIC_CTL\t\t\t(0x50)\n#define SUN6I_CODEC_HMIC_DATA\t\t\t(0x54)\n\n \n\n \n#define SUN8I_A23_CODEC_DAC_TXCNT\t\t(0x1c)\n#define SUN8I_A23_CODEC_ADC_RXCNT\t\t(0x20)\n\n \n#define SUN8I_H3_CODEC_DAC_TXDATA\t\t(0x20)\n#define SUN8I_H3_CODEC_DAC_DBG\t\t\t(0x48)\n#define SUN8I_H3_CODEC_ADC_DBG\t\t\t(0x4c)\n\n \n\nstruct sun4i_codec {\n\tstruct device\t*dev;\n\tstruct regmap\t*regmap;\n\tstruct clk\t*clk_apb;\n\tstruct clk\t*clk_module;\n\tstruct reset_control *rst;\n\tstruct gpio_desc *gpio_pa;\n\n\t \n\tstruct regmap_field *reg_adc_fifoc;\n\n\tstruct snd_dmaengine_dai_dma_data\tcapture_dma_data;\n\tstruct snd_dmaengine_dai_dma_data\tplayback_dma_data;\n};\n\nstatic void sun4i_codec_start_playback(struct sun4i_codec *scodec)\n{\n\t \n\tregmap_set_bits(scodec->regmap, SUN4I_CODEC_DAC_FIFOC,\n\t\t\tBIT(SUN4I_CODEC_DAC_FIFOC_FIFO_FLUSH));\n\n\t \n\tregmap_set_bits(scodec->regmap, SUN4I_CODEC_DAC_FIFOC,\n\t\t\tBIT(SUN4I_CODEC_DAC_FIFOC_DAC_DRQ_EN));\n}\n\nstatic void sun4i_codec_stop_playback(struct sun4i_codec *scodec)\n{\n\t \n\tregmap_clear_bits(scodec->regmap, SUN4I_CODEC_DAC_FIFOC,\n\t\t\t  BIT(SUN4I_CODEC_DAC_FIFOC_DAC_DRQ_EN));\n}\n\nstatic void sun4i_codec_start_capture(struct sun4i_codec *scodec)\n{\n\t \n\tregmap_field_set_bits(scodec->reg_adc_fifoc,\n\t\t\t      BIT(SUN4I_CODEC_ADC_FIFOC_ADC_DRQ_EN));\n}\n\nstatic void sun4i_codec_stop_capture(struct sun4i_codec *scodec)\n{\n\t \n\tregmap_field_clear_bits(scodec->reg_adc_fifoc,\n\t\t\t\t BIT(SUN4I_CODEC_ADC_FIFOC_ADC_DRQ_EN));\n}\n\nstatic int sun4i_codec_trigger(struct snd_pcm_substream *substream, int cmd,\n\t\t\t       struct snd_soc_dai *dai)\n{\n\tstruct snd_soc_pcm_runtime *rtd = asoc_substream_to_rtd(substream);\n\tstruct sun4i_codec *scodec = snd_soc_card_get_drvdata(rtd->card);\n\n\tswitch (cmd) {\n\tcase SNDRV_PCM_TRIGGER_START:\n\tcase SNDRV_PCM_TRIGGER_RESUME:\n\tcase SNDRV_PCM_TRIGGER_PAUSE_RELEASE:\n\t\tif (substream->stream == SNDRV_PCM_STREAM_PLAYBACK)\n\t\t\tsun4i_codec_start_playback(scodec);\n\t\telse\n\t\t\tsun4i_codec_start_capture(scodec);\n\t\tbreak;\n\n\tcase SNDRV_PCM_TRIGGER_STOP:\n\tcase SNDRV_PCM_TRIGGER_SUSPEND:\n\tcase SNDRV_PCM_TRIGGER_PAUSE_PUSH:\n\t\tif (substream->stream == SNDRV_PCM_STREAM_PLAYBACK)\n\t\t\tsun4i_codec_stop_playback(scodec);\n\t\telse\n\t\t\tsun4i_codec_stop_capture(scodec);\n\t\tbreak;\n\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\treturn 0;\n}\n\nstatic int sun4i_codec_prepare_capture(struct snd_pcm_substream *substream,\n\t\t\t\t       struct snd_soc_dai *dai)\n{\n\tstruct snd_soc_pcm_runtime *rtd = asoc_substream_to_rtd(substream);\n\tstruct sun4i_codec *scodec = snd_soc_card_get_drvdata(rtd->card);\n\n\n\t \n\tregmap_field_set_bits(scodec->reg_adc_fifoc,\n\t\t\t\t BIT(SUN4I_CODEC_ADC_FIFOC_FIFO_FLUSH));\n\n\n\t \n\tregmap_field_update_bits(scodec->reg_adc_fifoc,\n\t\t\t\t 0xf << SUN4I_CODEC_ADC_FIFOC_RX_TRIG_LEVEL,\n\t\t\t\t 0x7 << SUN4I_CODEC_ADC_FIFOC_RX_TRIG_LEVEL);\n\n\t \n\tif (of_device_is_compatible(scodec->dev->of_node,\n\t\t\t\t    \"allwinner,sun4i-a10-codec\") ||\n\t    of_device_is_compatible(scodec->dev->of_node,\n\t\t\t\t    \"allwinner,sun7i-a20-codec\")) {\n\t\tregmap_update_bits(scodec->regmap, SUN4I_CODEC_ADC_ACTL,\n\t\t\t\t   0x3 << 25,\n\t\t\t\t   0x1 << 25);\n\t}\n\n\tif (of_device_is_compatible(scodec->dev->of_node,\n\t\t\t\t    \"allwinner,sun7i-a20-codec\"))\n\t\t \n\t\tregmap_update_bits(scodec->regmap, SUN4I_CODEC_DAC_TUNE,\n\t\t\t\t   0x3 << 8,\n\t\t\t\t   0x1 << 8);\n\n\treturn 0;\n}\n\nstatic int sun4i_codec_prepare_playback(struct snd_pcm_substream *substream,\n\t\t\t\t\tstruct snd_soc_dai *dai)\n{\n\tstruct snd_soc_pcm_runtime *rtd = asoc_substream_to_rtd(substream);\n\tstruct sun4i_codec *scodec = snd_soc_card_get_drvdata(rtd->card);\n\tu32 val;\n\n\t \n\tregmap_set_bits(scodec->regmap, SUN4I_CODEC_DAC_FIFOC,\n\t\t\t   BIT(SUN4I_CODEC_DAC_FIFOC_FIFO_FLUSH));\n\n\t \n\tregmap_update_bits(scodec->regmap, SUN4I_CODEC_DAC_FIFOC,\n\t\t\t   0x3f << SUN4I_CODEC_DAC_FIFOC_TX_TRIG_LEVEL,\n\t\t\t   0xf << SUN4I_CODEC_DAC_FIFOC_TX_TRIG_LEVEL);\n\n\tif (substream->runtime->rate > 32000)\n\t\t \n\t\tval = 0;\n\telse\n\t\t \n\t\tval = BIT(SUN4I_CODEC_DAC_FIFOC_FIR_VERSION);\n\n\tregmap_update_bits(scodec->regmap, SUN4I_CODEC_DAC_FIFOC,\n\t\t\t   BIT(SUN4I_CODEC_DAC_FIFOC_FIR_VERSION),\n\t\t\t   val);\n\n\t \n\tregmap_clear_bits(scodec->regmap, SUN4I_CODEC_DAC_FIFOC,\n\t\t\t   BIT(SUN4I_CODEC_DAC_FIFOC_SEND_LASAT));\n\n\treturn 0;\n};\n\nstatic int sun4i_codec_prepare(struct snd_pcm_substream *substream,\n\t\t\t       struct snd_soc_dai *dai)\n{\n\tif (substream->stream == SNDRV_PCM_STREAM_PLAYBACK)\n\t\treturn sun4i_codec_prepare_playback(substream, dai);\n\n\treturn sun4i_codec_prepare_capture(substream, dai);\n}\n\nstatic unsigned long sun4i_codec_get_mod_freq(struct snd_pcm_hw_params *params)\n{\n\tunsigned int rate = params_rate(params);\n\n\tswitch (rate) {\n\tcase 176400:\n\tcase 88200:\n\tcase 44100:\n\tcase 33075:\n\tcase 22050:\n\tcase 14700:\n\tcase 11025:\n\tcase 7350:\n\t\treturn 22579200;\n\n\tcase 192000:\n\tcase 96000:\n\tcase 48000:\n\tcase 32000:\n\tcase 24000:\n\tcase 16000:\n\tcase 12000:\n\tcase 8000:\n\t\treturn 24576000;\n\n\tdefault:\n\t\treturn 0;\n\t}\n}\n\nstatic int sun4i_codec_get_hw_rate(struct snd_pcm_hw_params *params)\n{\n\tunsigned int rate = params_rate(params);\n\n\tswitch (rate) {\n\tcase 192000:\n\tcase 176400:\n\t\treturn 6;\n\n\tcase 96000:\n\tcase 88200:\n\t\treturn 7;\n\n\tcase 48000:\n\tcase 44100:\n\t\treturn 0;\n\n\tcase 32000:\n\tcase 33075:\n\t\treturn 1;\n\n\tcase 24000:\n\tcase 22050:\n\t\treturn 2;\n\n\tcase 16000:\n\tcase 14700:\n\t\treturn 3;\n\n\tcase 12000:\n\tcase 11025:\n\t\treturn 4;\n\n\tcase 8000:\n\tcase 7350:\n\t\treturn 5;\n\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n}\n\nstatic int sun4i_codec_hw_params_capture(struct sun4i_codec *scodec,\n\t\t\t\t\t struct snd_pcm_hw_params *params,\n\t\t\t\t\t unsigned int hwrate)\n{\n\t \n\tregmap_field_update_bits(scodec->reg_adc_fifoc,\n\t\t\t\t 7 << SUN4I_CODEC_ADC_FIFOC_ADC_FS,\n\t\t\t\t hwrate << SUN4I_CODEC_ADC_FIFOC_ADC_FS);\n\n\t \n\tif (params_channels(params) == 1)\n\t\tregmap_field_set_bits(scodec->reg_adc_fifoc,\n\t\t\t\t\t BIT(SUN4I_CODEC_ADC_FIFOC_MONO_EN));\n\telse\n\t\tregmap_field_clear_bits(scodec->reg_adc_fifoc,\n\t\t\t\t\t BIT(SUN4I_CODEC_ADC_FIFOC_MONO_EN));\n\n\t \n\tif (hw_param_interval(params, SNDRV_PCM_HW_PARAM_SAMPLE_BITS)->min == 32) {\n\t\tregmap_field_set_bits(scodec->reg_adc_fifoc,\n\t\t\t\t   BIT(SUN4I_CODEC_ADC_FIFOC_RX_SAMPLE_BITS));\n\n\t\tregmap_field_clear_bits(scodec->reg_adc_fifoc,\n\t\t\t\t   BIT(SUN4I_CODEC_ADC_FIFOC_RX_FIFO_MODE));\n\n\t\tscodec->capture_dma_data.addr_width = DMA_SLAVE_BUSWIDTH_4_BYTES;\n\t} else {\n\t\tregmap_field_clear_bits(scodec->reg_adc_fifoc,\n\t\t\t\t   BIT(SUN4I_CODEC_ADC_FIFOC_RX_SAMPLE_BITS));\n\n\t\t \n\t\tregmap_field_set_bits(scodec->reg_adc_fifoc,\n\t\t\t\t   BIT(SUN4I_CODEC_ADC_FIFOC_RX_FIFO_MODE));\n\n\t\tscodec->capture_dma_data.addr_width = DMA_SLAVE_BUSWIDTH_2_BYTES;\n\t}\n\n\treturn 0;\n}\n\nstatic int sun4i_codec_hw_params_playback(struct sun4i_codec *scodec,\n\t\t\t\t\t  struct snd_pcm_hw_params *params,\n\t\t\t\t\t  unsigned int hwrate)\n{\n\tu32 val;\n\n\t \n\tregmap_update_bits(scodec->regmap, SUN4I_CODEC_DAC_FIFOC,\n\t\t\t   7 << SUN4I_CODEC_DAC_FIFOC_DAC_FS,\n\t\t\t   hwrate << SUN4I_CODEC_DAC_FIFOC_DAC_FS);\n\n\t \n\tif (params_channels(params) == 1)\n\t\tval = BIT(SUN4I_CODEC_DAC_FIFOC_MONO_EN);\n\telse\n\t\tval = 0;\n\n\tregmap_update_bits(scodec->regmap, SUN4I_CODEC_DAC_FIFOC,\n\t\t\t   BIT(SUN4I_CODEC_DAC_FIFOC_MONO_EN),\n\t\t\t   val);\n\n\t \n\tif (hw_param_interval(params, SNDRV_PCM_HW_PARAM_SAMPLE_BITS)->min == 32) {\n\t\tregmap_set_bits(scodec->regmap, SUN4I_CODEC_DAC_FIFOC,\n\t\t\t\t   BIT(SUN4I_CODEC_DAC_FIFOC_TX_SAMPLE_BITS));\n\n\t\t \n\t\tregmap_clear_bits(scodec->regmap, SUN4I_CODEC_DAC_FIFOC,\n\t\t\t\t   BIT(SUN4I_CODEC_DAC_FIFOC_TX_FIFO_MODE));\n\n\t\tscodec->playback_dma_data.addr_width = DMA_SLAVE_BUSWIDTH_4_BYTES;\n\t} else {\n\t\tregmap_clear_bits(scodec->regmap, SUN4I_CODEC_DAC_FIFOC,\n\t\t\t\t   BIT(SUN4I_CODEC_DAC_FIFOC_TX_SAMPLE_BITS));\n\n\t\t \n\t\tregmap_set_bits(scodec->regmap, SUN4I_CODEC_DAC_FIFOC,\n\t\t\t\t   BIT(SUN4I_CODEC_DAC_FIFOC_TX_FIFO_MODE));\n\n\t\tscodec->playback_dma_data.addr_width = DMA_SLAVE_BUSWIDTH_2_BYTES;\n\t}\n\n\treturn 0;\n}\n\nstatic int sun4i_codec_hw_params(struct snd_pcm_substream *substream,\n\t\t\t\t struct snd_pcm_hw_params *params,\n\t\t\t\t struct snd_soc_dai *dai)\n{\n\tstruct snd_soc_pcm_runtime *rtd = asoc_substream_to_rtd(substream);\n\tstruct sun4i_codec *scodec = snd_soc_card_get_drvdata(rtd->card);\n\tunsigned long clk_freq;\n\tint ret, hwrate;\n\n\tclk_freq = sun4i_codec_get_mod_freq(params);\n\tif (!clk_freq)\n\t\treturn -EINVAL;\n\n\tret = clk_set_rate(scodec->clk_module, clk_freq);\n\tif (ret)\n\t\treturn ret;\n\n\thwrate = sun4i_codec_get_hw_rate(params);\n\tif (hwrate < 0)\n\t\treturn hwrate;\n\n\tif (substream->stream == SNDRV_PCM_STREAM_PLAYBACK)\n\t\treturn sun4i_codec_hw_params_playback(scodec, params,\n\t\t\t\t\t\t      hwrate);\n\n\treturn sun4i_codec_hw_params_capture(scodec, params,\n\t\t\t\t\t     hwrate);\n}\n\n\nstatic unsigned int sun4i_codec_src_rates[] = {\n\t8000, 11025, 12000, 16000, 22050, 24000, 32000,\n\t44100, 48000, 96000, 192000\n};\n\n\nstatic struct snd_pcm_hw_constraint_list sun4i_codec_constraints = {\n\t.count  = ARRAY_SIZE(sun4i_codec_src_rates),\n\t.list   = sun4i_codec_src_rates,\n};\n\n\nstatic int sun4i_codec_startup(struct snd_pcm_substream *substream,\n\t\t\t       struct snd_soc_dai *dai)\n{\n\tstruct snd_soc_pcm_runtime *rtd = asoc_substream_to_rtd(substream);\n\tstruct sun4i_codec *scodec = snd_soc_card_get_drvdata(rtd->card);\n\n\tsnd_pcm_hw_constraint_list(substream->runtime, 0,\n\t\t\t\tSNDRV_PCM_HW_PARAM_RATE, &sun4i_codec_constraints);\n\n\t \n\tregmap_set_bits(scodec->regmap, SUN4I_CODEC_DAC_FIFOC,\n\t\t\t   3 << SUN4I_CODEC_DAC_FIFOC_DRQ_CLR_CNT);\n\n\treturn clk_prepare_enable(scodec->clk_module);\n}\n\nstatic void sun4i_codec_shutdown(struct snd_pcm_substream *substream,\n\t\t\t\t struct snd_soc_dai *dai)\n{\n\tstruct snd_soc_pcm_runtime *rtd = asoc_substream_to_rtd(substream);\n\tstruct sun4i_codec *scodec = snd_soc_card_get_drvdata(rtd->card);\n\n\tclk_disable_unprepare(scodec->clk_module);\n}\n\nstatic const struct snd_soc_dai_ops sun4i_codec_dai_ops = {\n\t.startup\t= sun4i_codec_startup,\n\t.shutdown\t= sun4i_codec_shutdown,\n\t.trigger\t= sun4i_codec_trigger,\n\t.hw_params\t= sun4i_codec_hw_params,\n\t.prepare\t= sun4i_codec_prepare,\n};\n\nstatic struct snd_soc_dai_driver sun4i_codec_dai = {\n\t.name\t= \"Codec\",\n\t.ops\t= &sun4i_codec_dai_ops,\n\t.playback = {\n\t\t.stream_name\t= \"Codec Playback\",\n\t\t.channels_min\t= 1,\n\t\t.channels_max\t= 2,\n\t\t.rate_min\t= 8000,\n\t\t.rate_max\t= 192000,\n\t\t.rates\t\t= SNDRV_PCM_RATE_CONTINUOUS,\n\t\t.formats\t= SNDRV_PCM_FMTBIT_S16_LE |\n\t\t\t\t  SNDRV_PCM_FMTBIT_S32_LE,\n\t\t.sig_bits\t= 24,\n\t},\n\t.capture = {\n\t\t.stream_name\t= \"Codec Capture\",\n\t\t.channels_min\t= 1,\n\t\t.channels_max\t= 2,\n\t\t.rate_min\t= 8000,\n\t\t.rate_max\t= 48000,\n\t\t.rates\t\t= SNDRV_PCM_RATE_CONTINUOUS,\n\t\t.formats\t= SNDRV_PCM_FMTBIT_S16_LE |\n\t\t\t\t  SNDRV_PCM_FMTBIT_S32_LE,\n\t\t.sig_bits\t= 24,\n\t},\n};\n\n \nstatic const struct snd_kcontrol_new sun4i_codec_pa_mute =\n\tSOC_DAPM_SINGLE(\"Switch\", SUN4I_CODEC_DAC_ACTL,\n\t\t\tSUN4I_CODEC_DAC_ACTL_PA_MUTE, 1, 0);\n\nstatic DECLARE_TLV_DB_SCALE(sun4i_codec_pa_volume_scale, -6300, 100, 1);\nstatic DECLARE_TLV_DB_SCALE(sun4i_codec_linein_loopback_gain_scale, -150, 150,\n\t\t\t    0);\nstatic DECLARE_TLV_DB_SCALE(sun4i_codec_linein_preamp_gain_scale, -1200, 300,\n\t\t\t    0);\nstatic DECLARE_TLV_DB_SCALE(sun4i_codec_fmin_loopback_gain_scale, -450, 150,\n\t\t\t    0);\nstatic DECLARE_TLV_DB_SCALE(sun4i_codec_micin_loopback_gain_scale, -450, 150,\n\t\t\t    0);\nstatic DECLARE_TLV_DB_RANGE(sun4i_codec_micin_preamp_gain_scale,\n\t\t\t    0, 0, TLV_DB_SCALE_ITEM(0, 0, 0),\n\t\t\t    1, 7, TLV_DB_SCALE_ITEM(3500, 300, 0));\nstatic DECLARE_TLV_DB_RANGE(sun7i_codec_micin_preamp_gain_scale,\n\t\t\t    0, 0, TLV_DB_SCALE_ITEM(0, 0, 0),\n\t\t\t    1, 7, TLV_DB_SCALE_ITEM(2400, 300, 0));\n\nstatic const struct snd_kcontrol_new sun4i_codec_controls[] = {\n\tSOC_SINGLE_TLV(\"Power Amplifier Volume\", SUN4I_CODEC_DAC_ACTL,\n\t\t       SUN4I_CODEC_DAC_ACTL_PA_VOL, 0x3F, 0,\n\t\t       sun4i_codec_pa_volume_scale),\n\tSOC_SINGLE_TLV(\"Line Playback Volume\", SUN4I_CODEC_DAC_ACTL,\n\t\t       SUN4I_CODEC_DAC_ACTL_LNG, 1, 0,\n\t\t       sun4i_codec_linein_loopback_gain_scale),\n\tSOC_SINGLE_TLV(\"Line Boost Volume\", SUN4I_CODEC_ADC_ACTL,\n\t\t       SUN4I_CODEC_ADC_ACTL_LNPREG, 7, 0,\n\t\t       sun4i_codec_linein_preamp_gain_scale),\n\tSOC_SINGLE_TLV(\"FM Playback Volume\", SUN4I_CODEC_DAC_ACTL,\n\t\t       SUN4I_CODEC_DAC_ACTL_FMG, 3, 0,\n\t\t       sun4i_codec_fmin_loopback_gain_scale),\n\tSOC_SINGLE_TLV(\"Mic Playback Volume\", SUN4I_CODEC_DAC_ACTL,\n\t\t       SUN4I_CODEC_DAC_ACTL_MICG, 7, 0,\n\t\t       sun4i_codec_micin_loopback_gain_scale),\n\tSOC_SINGLE_TLV(\"Mic1 Boost Volume\", SUN4I_CODEC_ADC_ACTL,\n\t\t       SUN4I_CODEC_ADC_ACTL_PREG1, 3, 0,\n\t\t       sun4i_codec_micin_preamp_gain_scale),\n\tSOC_SINGLE_TLV(\"Mic2 Boost Volume\", SUN4I_CODEC_ADC_ACTL,\n\t\t       SUN4I_CODEC_ADC_ACTL_PREG2, 3, 0,\n\t\t       sun4i_codec_micin_preamp_gain_scale),\n};\n\nstatic const struct snd_kcontrol_new sun7i_codec_controls[] = {\n\tSOC_SINGLE_TLV(\"Power Amplifier Volume\", SUN4I_CODEC_DAC_ACTL,\n\t\t       SUN4I_CODEC_DAC_ACTL_PA_VOL, 0x3F, 0,\n\t\t       sun4i_codec_pa_volume_scale),\n\tSOC_SINGLE_TLV(\"Line Playback Volume\", SUN4I_CODEC_DAC_ACTL,\n\t\t       SUN4I_CODEC_DAC_ACTL_LNG, 1, 0,\n\t\t       sun4i_codec_linein_loopback_gain_scale),\n\tSOC_SINGLE_TLV(\"Line Boost Volume\", SUN4I_CODEC_ADC_ACTL,\n\t\t       SUN4I_CODEC_ADC_ACTL_LNPREG, 7, 0,\n\t\t       sun4i_codec_linein_preamp_gain_scale),\n\tSOC_SINGLE_TLV(\"FM Playback Volume\", SUN4I_CODEC_DAC_ACTL,\n\t\t       SUN4I_CODEC_DAC_ACTL_FMG, 3, 0,\n\t\t       sun4i_codec_fmin_loopback_gain_scale),\n\tSOC_SINGLE_TLV(\"Mic Playback Volume\", SUN4I_CODEC_DAC_ACTL,\n\t\t       SUN4I_CODEC_DAC_ACTL_MICG, 7, 0,\n\t\t       sun4i_codec_micin_loopback_gain_scale),\n\tSOC_SINGLE_TLV(\"Mic1 Boost Volume\", SUN7I_CODEC_AC_MIC_PHONE_CAL,\n\t\t       SUN7I_CODEC_AC_MIC_PHONE_CAL_PREG1, 7, 0,\n\t\t       sun7i_codec_micin_preamp_gain_scale),\n\tSOC_SINGLE_TLV(\"Mic2 Boost Volume\", SUN7I_CODEC_AC_MIC_PHONE_CAL,\n\t\t       SUN7I_CODEC_AC_MIC_PHONE_CAL_PREG2, 7, 0,\n\t\t       sun7i_codec_micin_preamp_gain_scale),\n};\n\nstatic const struct snd_kcontrol_new sun4i_codec_mixer_controls[] = {\n\tSOC_DAPM_SINGLE(\"Left Mixer Left DAC Playback Switch\",\n\t\t\tSUN4I_CODEC_DAC_ACTL, SUN4I_CODEC_DAC_ACTL_LDACLMIXS,\n\t\t\t1, 0),\n\tSOC_DAPM_SINGLE(\"Right Mixer Right DAC Playback Switch\",\n\t\t\tSUN4I_CODEC_DAC_ACTL, SUN4I_CODEC_DAC_ACTL_RDACRMIXS,\n\t\t\t1, 0),\n\tSOC_DAPM_SINGLE(\"Right Mixer Left DAC Playback Switch\",\n\t\t\tSUN4I_CODEC_DAC_ACTL,\n\t\t\tSUN4I_CODEC_DAC_ACTL_LDACRMIXS, 1, 0),\n\tSOC_DAPM_DOUBLE(\"Line Playback Switch\", SUN4I_CODEC_DAC_ACTL,\n\t\t\tSUN4I_CODEC_DAC_ACTL_LLNS,\n\t\t\tSUN4I_CODEC_DAC_ACTL_RLNS, 1, 0),\n\tSOC_DAPM_DOUBLE(\"FM Playback Switch\", SUN4I_CODEC_DAC_ACTL,\n\t\t\tSUN4I_CODEC_DAC_ACTL_LFMS,\n\t\t\tSUN4I_CODEC_DAC_ACTL_RFMS, 1, 0),\n\tSOC_DAPM_DOUBLE(\"Mic1 Playback Switch\", SUN4I_CODEC_DAC_ACTL,\n\t\t\tSUN4I_CODEC_DAC_ACTL_MIC1LS,\n\t\t\tSUN4I_CODEC_DAC_ACTL_MIC1RS, 1, 0),\n\tSOC_DAPM_DOUBLE(\"Mic2 Playback Switch\", SUN4I_CODEC_DAC_ACTL,\n\t\t\tSUN4I_CODEC_DAC_ACTL_MIC2LS,\n\t\t\tSUN4I_CODEC_DAC_ACTL_MIC2RS, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new sun4i_codec_pa_mixer_controls[] = {\n\tSOC_DAPM_SINGLE(\"DAC Playback Switch\", SUN4I_CODEC_DAC_ACTL,\n\t\t\tSUN4I_CODEC_DAC_ACTL_DACPAS, 1, 0),\n\tSOC_DAPM_SINGLE(\"Mixer Playback Switch\", SUN4I_CODEC_DAC_ACTL,\n\t\t\tSUN4I_CODEC_DAC_ACTL_MIXPAS, 1, 0),\n};\n\nstatic const struct snd_soc_dapm_widget sun4i_codec_codec_dapm_widgets[] = {\n\t \n\tSND_SOC_DAPM_SUPPLY(\"ADC\", SUN4I_CODEC_ADC_FIFOC,\n\t\t\t    SUN4I_CODEC_ADC_FIFOC_EN_AD, 0,\n\t\t\t    NULL, 0),\n\n\t \n\tSND_SOC_DAPM_SUPPLY(\"DAC\", SUN4I_CODEC_DAC_DPC,\n\t\t\t    SUN4I_CODEC_DAC_DPC_EN_DA, 0,\n\t\t\t    NULL, 0),\n\n\t \n\tSND_SOC_DAPM_ADC(\"Left ADC\", \"Codec Capture\", SUN4I_CODEC_ADC_ACTL,\n\t\t\t SUN4I_CODEC_ADC_ACTL_ADC_L_EN, 0),\n\tSND_SOC_DAPM_ADC(\"Right ADC\", \"Codec Capture\", SUN4I_CODEC_ADC_ACTL,\n\t\t\t SUN4I_CODEC_ADC_ACTL_ADC_R_EN, 0),\n\n\t \n\tSND_SOC_DAPM_DAC(\"Left DAC\", \"Codec Playback\", SUN4I_CODEC_DAC_ACTL,\n\t\t\t SUN4I_CODEC_DAC_ACTL_DACAENL, 0),\n\tSND_SOC_DAPM_DAC(\"Right DAC\", \"Codec Playback\", SUN4I_CODEC_DAC_ACTL,\n\t\t\t SUN4I_CODEC_DAC_ACTL_DACAENR, 0),\n\n\t \n\tSND_SOC_DAPM_MIXER(\"Left Mixer\", SND_SOC_NOPM, 0, 0,\n\t\t\t   sun4i_codec_mixer_controls,\n\t\t\t   ARRAY_SIZE(sun4i_codec_mixer_controls)),\n\tSND_SOC_DAPM_MIXER(\"Right Mixer\", SND_SOC_NOPM, 0, 0,\n\t\t\t   sun4i_codec_mixer_controls,\n\t\t\t   ARRAY_SIZE(sun4i_codec_mixer_controls)),\n\n\t \n\tSND_SOC_DAPM_SUPPLY(\"Mixer Enable\", SUN4I_CODEC_DAC_ACTL,\n\t\t\t    SUN4I_CODEC_DAC_ACTL_MIXEN, 0, NULL, 0),\n\n\t \n\tSND_SOC_DAPM_SUPPLY(\"VMIC\", SUN4I_CODEC_ADC_ACTL,\n\t\t\t    SUN4I_CODEC_ADC_ACTL_VMICEN, 0, NULL, 0),\n\n\t \n\tSND_SOC_DAPM_PGA(\"MIC1 Pre-Amplifier\", SUN4I_CODEC_ADC_ACTL,\n\t\t\t SUN4I_CODEC_ADC_ACTL_PREG1EN, 0, NULL, 0),\n\tSND_SOC_DAPM_PGA(\"MIC2 Pre-Amplifier\", SUN4I_CODEC_ADC_ACTL,\n\t\t\t SUN4I_CODEC_ADC_ACTL_PREG2EN, 0, NULL, 0),\n\n\t \n\tSND_SOC_DAPM_MIXER(\"Power Amplifier\", SUN4I_CODEC_ADC_ACTL,\n\t\t\t   SUN4I_CODEC_ADC_ACTL_PA_EN, 0,\n\t\t\t   sun4i_codec_pa_mixer_controls,\n\t\t\t   ARRAY_SIZE(sun4i_codec_pa_mixer_controls)),\n\tSND_SOC_DAPM_SWITCH(\"Power Amplifier Mute\", SND_SOC_NOPM, 0, 0,\n\t\t\t    &sun4i_codec_pa_mute),\n\n\tSND_SOC_DAPM_INPUT(\"Line Right\"),\n\tSND_SOC_DAPM_INPUT(\"Line Left\"),\n\tSND_SOC_DAPM_INPUT(\"FM Right\"),\n\tSND_SOC_DAPM_INPUT(\"FM Left\"),\n\tSND_SOC_DAPM_INPUT(\"Mic1\"),\n\tSND_SOC_DAPM_INPUT(\"Mic2\"),\n\n\tSND_SOC_DAPM_OUTPUT(\"HP Right\"),\n\tSND_SOC_DAPM_OUTPUT(\"HP Left\"),\n};\n\nstatic const struct snd_soc_dapm_route sun4i_codec_codec_dapm_routes[] = {\n\t \n\t{ \"Left ADC\", NULL, \"ADC\" },\n\t{ \"Left DAC\", NULL, \"DAC\" },\n\n\t \n\t{ \"Right ADC\", NULL, \"ADC\" },\n\t{ \"Right DAC\", NULL, \"DAC\" },\n\n\t \n\t{ \"Right Mixer\", NULL, \"Mixer Enable\" },\n\t{ \"Right Mixer\", \"Right Mixer Left DAC Playback Switch\", \"Left DAC\" },\n\t{ \"Right Mixer\", \"Right Mixer Right DAC Playback Switch\", \"Right DAC\" },\n\t{ \"Right Mixer\", \"Line Playback Switch\", \"Line Right\" },\n\t{ \"Right Mixer\", \"FM Playback Switch\", \"FM Right\" },\n\t{ \"Right Mixer\", \"Mic1 Playback Switch\", \"MIC1 Pre-Amplifier\" },\n\t{ \"Right Mixer\", \"Mic2 Playback Switch\", \"MIC2 Pre-Amplifier\" },\n\n\t \n\t{ \"Left Mixer\", NULL, \"Mixer Enable\" },\n\t{ \"Left Mixer\", \"Left Mixer Left DAC Playback Switch\", \"Left DAC\" },\n\t{ \"Left Mixer\", \"Line Playback Switch\", \"Line Left\" },\n\t{ \"Left Mixer\", \"FM Playback Switch\", \"FM Left\" },\n\t{ \"Left Mixer\", \"Mic1 Playback Switch\", \"MIC1 Pre-Amplifier\" },\n\t{ \"Left Mixer\", \"Mic2 Playback Switch\", \"MIC2 Pre-Amplifier\" },\n\n\t \n\t{ \"Power Amplifier\", \"Mixer Playback Switch\", \"Left Mixer\" },\n\t{ \"Power Amplifier\", \"Mixer Playback Switch\", \"Right Mixer\" },\n\t{ \"Power Amplifier\", \"DAC Playback Switch\", \"Left DAC\" },\n\t{ \"Power Amplifier\", \"DAC Playback Switch\", \"Right DAC\" },\n\n\t \n\t{ \"Power Amplifier Mute\", \"Switch\", \"Power Amplifier\" },\n\t{ \"HP Right\", NULL, \"Power Amplifier Mute\" },\n\t{ \"HP Left\", NULL, \"Power Amplifier Mute\" },\n\n\t \n\t{ \"Left ADC\", NULL, \"MIC1 Pre-Amplifier\" },\n\t{ \"Right ADC\", NULL, \"MIC1 Pre-Amplifier\" },\n\t{ \"MIC1 Pre-Amplifier\", NULL, \"Mic1\"},\n\t{ \"Mic1\", NULL, \"VMIC\" },\n\n\t \n\t{ \"Left ADC\", NULL, \"MIC2 Pre-Amplifier\" },\n\t{ \"Right ADC\", NULL, \"MIC2 Pre-Amplifier\" },\n\t{ \"MIC2 Pre-Amplifier\", NULL, \"Mic2\"},\n\t{ \"Mic2\", NULL, \"VMIC\" },\n};\n\nstatic const struct snd_soc_component_driver sun4i_codec_codec = {\n\t.controls\t\t= sun4i_codec_controls,\n\t.num_controls\t\t= ARRAY_SIZE(sun4i_codec_controls),\n\t.dapm_widgets\t\t= sun4i_codec_codec_dapm_widgets,\n\t.num_dapm_widgets\t= ARRAY_SIZE(sun4i_codec_codec_dapm_widgets),\n\t.dapm_routes\t\t= sun4i_codec_codec_dapm_routes,\n\t.num_dapm_routes\t= ARRAY_SIZE(sun4i_codec_codec_dapm_routes),\n\t.idle_bias_on\t\t= 1,\n\t.use_pmdown_time\t= 1,\n\t.endianness\t\t= 1,\n};\n\nstatic const struct snd_soc_component_driver sun7i_codec_codec = {\n\t.controls\t\t= sun7i_codec_controls,\n\t.num_controls\t\t= ARRAY_SIZE(sun7i_codec_controls),\n\t.dapm_widgets\t\t= sun4i_codec_codec_dapm_widgets,\n\t.num_dapm_widgets\t= ARRAY_SIZE(sun4i_codec_codec_dapm_widgets),\n\t.dapm_routes\t\t= sun4i_codec_codec_dapm_routes,\n\t.num_dapm_routes\t= ARRAY_SIZE(sun4i_codec_codec_dapm_routes),\n\t.idle_bias_on\t\t= 1,\n\t.use_pmdown_time\t= 1,\n\t.endianness\t\t= 1,\n};\n\n \n\n \nstatic const struct snd_kcontrol_new sun6i_codec_mixer_controls[] = {\n\tSOC_DAPM_DOUBLE(\"DAC Playback Switch\",\n\t\t\tSUN6I_CODEC_OM_DACA_CTRL,\n\t\t\tSUN6I_CODEC_OM_DACA_CTRL_LMIX_DACL,\n\t\t\tSUN6I_CODEC_OM_DACA_CTRL_RMIX_DACR, 1, 0),\n\tSOC_DAPM_DOUBLE(\"DAC Reversed Playback Switch\",\n\t\t\tSUN6I_CODEC_OM_DACA_CTRL,\n\t\t\tSUN6I_CODEC_OM_DACA_CTRL_LMIX_DACR,\n\t\t\tSUN6I_CODEC_OM_DACA_CTRL_RMIX_DACL, 1, 0),\n\tSOC_DAPM_DOUBLE(\"Line In Playback Switch\",\n\t\t\tSUN6I_CODEC_OM_DACA_CTRL,\n\t\t\tSUN6I_CODEC_OM_DACA_CTRL_LMIX_LINEINL,\n\t\t\tSUN6I_CODEC_OM_DACA_CTRL_RMIX_LINEINR, 1, 0),\n\tSOC_DAPM_DOUBLE(\"Mic1 Playback Switch\",\n\t\t\tSUN6I_CODEC_OM_DACA_CTRL,\n\t\t\tSUN6I_CODEC_OM_DACA_CTRL_LMIX_MIC1,\n\t\t\tSUN6I_CODEC_OM_DACA_CTRL_RMIX_MIC1, 1, 0),\n\tSOC_DAPM_DOUBLE(\"Mic2 Playback Switch\",\n\t\t\tSUN6I_CODEC_OM_DACA_CTRL,\n\t\t\tSUN6I_CODEC_OM_DACA_CTRL_LMIX_MIC2,\n\t\t\tSUN6I_CODEC_OM_DACA_CTRL_RMIX_MIC2, 1, 0),\n};\n\n \nstatic const struct snd_kcontrol_new sun6i_codec_adc_mixer_controls[] = {\n\tSOC_DAPM_DOUBLE(\"Mixer Capture Switch\",\n\t\t\tSUN6I_CODEC_ADC_ACTL,\n\t\t\tSUN6I_CODEC_ADC_ACTL_LADCMIX_OMIXL,\n\t\t\tSUN6I_CODEC_ADC_ACTL_RADCMIX_OMIXR, 1, 0),\n\tSOC_DAPM_DOUBLE(\"Mixer Reversed Capture Switch\",\n\t\t\tSUN6I_CODEC_ADC_ACTL,\n\t\t\tSUN6I_CODEC_ADC_ACTL_LADCMIX_OMIXR,\n\t\t\tSUN6I_CODEC_ADC_ACTL_RADCMIX_OMIXL, 1, 0),\n\tSOC_DAPM_DOUBLE(\"Line In Capture Switch\",\n\t\t\tSUN6I_CODEC_ADC_ACTL,\n\t\t\tSUN6I_CODEC_ADC_ACTL_LADCMIX_LINEINL,\n\t\t\tSUN6I_CODEC_ADC_ACTL_RADCMIX_LINEINR, 1, 0),\n\tSOC_DAPM_DOUBLE(\"Mic1 Capture Switch\",\n\t\t\tSUN6I_CODEC_ADC_ACTL,\n\t\t\tSUN6I_CODEC_ADC_ACTL_LADCMIX_MIC1,\n\t\t\tSUN6I_CODEC_ADC_ACTL_RADCMIX_MIC1, 1, 0),\n\tSOC_DAPM_DOUBLE(\"Mic2 Capture Switch\",\n\t\t\tSUN6I_CODEC_ADC_ACTL,\n\t\t\tSUN6I_CODEC_ADC_ACTL_LADCMIX_MIC2,\n\t\t\tSUN6I_CODEC_ADC_ACTL_RADCMIX_MIC2, 1, 0),\n};\n\n \nstatic const char * const sun6i_codec_hp_src_enum_text[] = {\n\t\"DAC\", \"Mixer\",\n};\n\nstatic SOC_ENUM_DOUBLE_DECL(sun6i_codec_hp_src_enum,\n\t\t\t    SUN6I_CODEC_OM_DACA_CTRL,\n\t\t\t    SUN6I_CODEC_OM_DACA_CTRL_LHPIS,\n\t\t\t    SUN6I_CODEC_OM_DACA_CTRL_RHPIS,\n\t\t\t    sun6i_codec_hp_src_enum_text);\n\nstatic const struct snd_kcontrol_new sun6i_codec_hp_src[] = {\n\tSOC_DAPM_ENUM(\"Headphone Source Playback Route\",\n\t\t      sun6i_codec_hp_src_enum),\n};\n\n \nstatic const char * const sun6i_codec_mic2_src_enum_text[] = {\n\t\"Mic2\", \"Mic3\",\n};\n\nstatic SOC_ENUM_SINGLE_DECL(sun6i_codec_mic2_src_enum,\n\t\t\t    SUN6I_CODEC_MIC_CTRL,\n\t\t\t    SUN6I_CODEC_MIC_CTRL_MIC2SLT,\n\t\t\t    sun6i_codec_mic2_src_enum_text);\n\nstatic const struct snd_kcontrol_new sun6i_codec_mic2_src[] = {\n\tSOC_DAPM_ENUM(\"Mic2 Amplifier Source Route\",\n\t\t      sun6i_codec_mic2_src_enum),\n};\n\n \nstatic const char * const sun6i_codec_lineout_src_enum_text[] = {\n\t\"Stereo\", \"Mono Differential\",\n};\n\nstatic SOC_ENUM_DOUBLE_DECL(sun6i_codec_lineout_src_enum,\n\t\t\t    SUN6I_CODEC_MIC_CTRL,\n\t\t\t    SUN6I_CODEC_MIC_CTRL_LINEOUTLSRC,\n\t\t\t    SUN6I_CODEC_MIC_CTRL_LINEOUTRSRC,\n\t\t\t    sun6i_codec_lineout_src_enum_text);\n\nstatic const struct snd_kcontrol_new sun6i_codec_lineout_src[] = {\n\tSOC_DAPM_ENUM(\"Line Out Source Playback Route\",\n\t\t      sun6i_codec_lineout_src_enum),\n};\n\n \nstatic const DECLARE_TLV_DB_SCALE(sun6i_codec_dvol_scale, -7308, 116, 0);\nstatic const DECLARE_TLV_DB_SCALE(sun6i_codec_hp_vol_scale, -6300, 100, 1);\nstatic const DECLARE_TLV_DB_SCALE(sun6i_codec_out_mixer_pregain_scale,\n\t\t\t\t  -450, 150, 0);\nstatic const DECLARE_TLV_DB_RANGE(sun6i_codec_lineout_vol_scale,\n\t0, 1, TLV_DB_SCALE_ITEM(TLV_DB_GAIN_MUTE, 0, 1),\n\t2, 31, TLV_DB_SCALE_ITEM(-4350, 150, 0),\n);\nstatic const DECLARE_TLV_DB_RANGE(sun6i_codec_mic_gain_scale,\n\t0, 0, TLV_DB_SCALE_ITEM(0, 0, 0),\n\t1, 7, TLV_DB_SCALE_ITEM(2400, 300, 0),\n);\n\nstatic const struct snd_kcontrol_new sun6i_codec_codec_widgets[] = {\n\tSOC_SINGLE_TLV(\"DAC Playback Volume\", SUN4I_CODEC_DAC_DPC,\n\t\t       SUN4I_CODEC_DAC_DPC_DVOL, 0x3f, 1,\n\t\t       sun6i_codec_dvol_scale),\n\tSOC_SINGLE_TLV(\"Headphone Playback Volume\",\n\t\t       SUN6I_CODEC_OM_DACA_CTRL,\n\t\t       SUN6I_CODEC_OM_DACA_CTRL_HPVOL, 0x3f, 0,\n\t\t       sun6i_codec_hp_vol_scale),\n\tSOC_SINGLE_TLV(\"Line Out Playback Volume\",\n\t\t       SUN6I_CODEC_MIC_CTRL,\n\t\t       SUN6I_CODEC_MIC_CTRL_LINEOUTVC, 0x1f, 0,\n\t\t       sun6i_codec_lineout_vol_scale),\n\tSOC_DOUBLE(\"Headphone Playback Switch\",\n\t\t   SUN6I_CODEC_OM_DACA_CTRL,\n\t\t   SUN6I_CODEC_OM_DACA_CTRL_LHPPAMUTE,\n\t\t   SUN6I_CODEC_OM_DACA_CTRL_RHPPAMUTE, 1, 0),\n\tSOC_DOUBLE(\"Line Out Playback Switch\",\n\t\t   SUN6I_CODEC_MIC_CTRL,\n\t\t   SUN6I_CODEC_MIC_CTRL_LINEOUTLEN,\n\t\t   SUN6I_CODEC_MIC_CTRL_LINEOUTREN, 1, 0),\n\t \n\tSOC_SINGLE_TLV(\"Line In Playback Volume\",\n\t\t       SUN6I_CODEC_OM_PA_CTRL, SUN6I_CODEC_OM_PA_CTRL_LINEING,\n\t\t       0x7, 0, sun6i_codec_out_mixer_pregain_scale),\n\tSOC_SINGLE_TLV(\"Mic1 Playback Volume\",\n\t\t       SUN6I_CODEC_OM_PA_CTRL, SUN6I_CODEC_OM_PA_CTRL_MIC1G,\n\t\t       0x7, 0, sun6i_codec_out_mixer_pregain_scale),\n\tSOC_SINGLE_TLV(\"Mic2 Playback Volume\",\n\t\t       SUN6I_CODEC_OM_PA_CTRL, SUN6I_CODEC_OM_PA_CTRL_MIC2G,\n\t\t       0x7, 0, sun6i_codec_out_mixer_pregain_scale),\n\n\t \n\tSOC_SINGLE_TLV(\"Mic1 Boost Volume\", SUN6I_CODEC_MIC_CTRL,\n\t\t       SUN6I_CODEC_MIC_CTRL_MIC1BOOST, 0x7, 0,\n\t\t       sun6i_codec_mic_gain_scale),\n\tSOC_SINGLE_TLV(\"Mic2 Boost Volume\", SUN6I_CODEC_MIC_CTRL,\n\t\t       SUN6I_CODEC_MIC_CTRL_MIC2BOOST, 0x7, 0,\n\t\t       sun6i_codec_mic_gain_scale),\n\tSOC_DOUBLE_TLV(\"ADC Capture Volume\",\n\t\t       SUN6I_CODEC_ADC_ACTL, SUN6I_CODEC_ADC_ACTL_ADCLG,\n\t\t       SUN6I_CODEC_ADC_ACTL_ADCRG, 0x7, 0,\n\t\t       sun6i_codec_out_mixer_pregain_scale),\n};\n\nstatic const struct snd_soc_dapm_widget sun6i_codec_codec_dapm_widgets[] = {\n\t \n\tSND_SOC_DAPM_INPUT(\"MIC1\"),\n\tSND_SOC_DAPM_INPUT(\"MIC2\"),\n\tSND_SOC_DAPM_INPUT(\"MIC3\"),\n\n\t \n\tSND_SOC_DAPM_SUPPLY(\"HBIAS\", SUN6I_CODEC_MIC_CTRL,\n\t\t\t    SUN6I_CODEC_MIC_CTRL_HBIASEN, 0, NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"MBIAS\", SUN6I_CODEC_MIC_CTRL,\n\t\t\t    SUN6I_CODEC_MIC_CTRL_MBIASEN, 0, NULL, 0),\n\n\t \n\tSND_SOC_DAPM_MUX(\"Mic2 Amplifier Source Route\",\n\t\t\t SND_SOC_NOPM, 0, 0, sun6i_codec_mic2_src),\n\tSND_SOC_DAPM_PGA(\"Mic1 Amplifier\", SUN6I_CODEC_MIC_CTRL,\n\t\t\t SUN6I_CODEC_MIC_CTRL_MIC1AMPEN, 0, NULL, 0),\n\tSND_SOC_DAPM_PGA(\"Mic2 Amplifier\", SUN6I_CODEC_MIC_CTRL,\n\t\t\t SUN6I_CODEC_MIC_CTRL_MIC2AMPEN, 0, NULL, 0),\n\n\t \n\tSND_SOC_DAPM_INPUT(\"LINEIN\"),\n\n\t \n\tSND_SOC_DAPM_SUPPLY(\"ADC Enable\", SUN6I_CODEC_ADC_FIFOC,\n\t\t\t    SUN6I_CODEC_ADC_FIFOC_EN_AD, 0,\n\t\t\t    NULL, 0),\n\n\t \n\tSND_SOC_DAPM_ADC(\"Left ADC\", \"Codec Capture\", SUN6I_CODEC_ADC_ACTL,\n\t\t\t SUN6I_CODEC_ADC_ACTL_ADCLEN, 0),\n\tSND_SOC_DAPM_ADC(\"Right ADC\", \"Codec Capture\", SUN6I_CODEC_ADC_ACTL,\n\t\t\t SUN6I_CODEC_ADC_ACTL_ADCREN, 0),\n\n\t \n\tSOC_MIXER_ARRAY(\"Left ADC Mixer\", SND_SOC_NOPM, 0, 0,\n\t\t\tsun6i_codec_adc_mixer_controls),\n\tSOC_MIXER_ARRAY(\"Right ADC Mixer\", SND_SOC_NOPM, 0, 0,\n\t\t\tsun6i_codec_adc_mixer_controls),\n\n\t \n\tSND_SOC_DAPM_SUPPLY(\"DAC Enable\", SUN4I_CODEC_DAC_DPC,\n\t\t\t    SUN4I_CODEC_DAC_DPC_EN_DA, 0,\n\t\t\t    NULL, 0),\n\n\t \n\tSND_SOC_DAPM_DAC(\"Left DAC\", \"Codec Playback\",\n\t\t\t SUN6I_CODEC_OM_DACA_CTRL,\n\t\t\t SUN6I_CODEC_OM_DACA_CTRL_DACALEN, 0),\n\tSND_SOC_DAPM_DAC(\"Right DAC\", \"Codec Playback\",\n\t\t\t SUN6I_CODEC_OM_DACA_CTRL,\n\t\t\t SUN6I_CODEC_OM_DACA_CTRL_DACAREN, 0),\n\n\t \n\tSOC_MIXER_ARRAY(\"Left Mixer\", SUN6I_CODEC_OM_DACA_CTRL,\n\t\t\tSUN6I_CODEC_OM_DACA_CTRL_LMIXEN, 0,\n\t\t\tsun6i_codec_mixer_controls),\n\tSOC_MIXER_ARRAY(\"Right Mixer\", SUN6I_CODEC_OM_DACA_CTRL,\n\t\t\tSUN6I_CODEC_OM_DACA_CTRL_RMIXEN, 0,\n\t\t\tsun6i_codec_mixer_controls),\n\n\t \n\tSND_SOC_DAPM_MUX(\"Headphone Source Playback Route\",\n\t\t\t SND_SOC_NOPM, 0, 0, sun6i_codec_hp_src),\n\tSND_SOC_DAPM_OUT_DRV(\"Headphone Amp\", SUN6I_CODEC_OM_PA_CTRL,\n\t\t\t     SUN6I_CODEC_OM_PA_CTRL_HPPAEN, 0, NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"HPCOM Protection\", SUN6I_CODEC_OM_PA_CTRL,\n\t\t\t    SUN6I_CODEC_OM_PA_CTRL_COMPTEN, 0, NULL, 0),\n\tSND_SOC_DAPM_REG(snd_soc_dapm_supply, \"HPCOM\", SUN6I_CODEC_OM_PA_CTRL,\n\t\t\t SUN6I_CODEC_OM_PA_CTRL_HPCOM_CTL, 0x3, 0x3, 0),\n\tSND_SOC_DAPM_OUTPUT(\"HP\"),\n\n\t \n\tSND_SOC_DAPM_MUX(\"Line Out Source Playback Route\",\n\t\t\t SND_SOC_NOPM, 0, 0, sun6i_codec_lineout_src),\n\tSND_SOC_DAPM_OUTPUT(\"LINEOUT\"),\n};\n\nstatic const struct snd_soc_dapm_route sun6i_codec_codec_dapm_routes[] = {\n\t \n\t{ \"Left DAC\", NULL, \"DAC Enable\" },\n\t{ \"Right DAC\", NULL, \"DAC Enable\" },\n\n\t \n\t{ \"Mic1 Amplifier\", NULL, \"MIC1\"},\n\t{ \"Mic2 Amplifier Source Route\", \"Mic2\", \"MIC2\" },\n\t{ \"Mic2 Amplifier Source Route\", \"Mic3\", \"MIC3\" },\n\t{ \"Mic2 Amplifier\", NULL, \"Mic2 Amplifier Source Route\"},\n\n\t \n\t{ \"Left Mixer\", \"DAC Playback Switch\", \"Left DAC\" },\n\t{ \"Left Mixer\", \"DAC Reversed Playback Switch\", \"Right DAC\" },\n\t{ \"Left Mixer\", \"Line In Playback Switch\", \"LINEIN\" },\n\t{ \"Left Mixer\", \"Mic1 Playback Switch\", \"Mic1 Amplifier\" },\n\t{ \"Left Mixer\", \"Mic2 Playback Switch\", \"Mic2 Amplifier\" },\n\n\t \n\t{ \"Right Mixer\", \"DAC Playback Switch\", \"Right DAC\" },\n\t{ \"Right Mixer\", \"DAC Reversed Playback Switch\", \"Left DAC\" },\n\t{ \"Right Mixer\", \"Line In Playback Switch\", \"LINEIN\" },\n\t{ \"Right Mixer\", \"Mic1 Playback Switch\", \"Mic1 Amplifier\" },\n\t{ \"Right Mixer\", \"Mic2 Playback Switch\", \"Mic2 Amplifier\" },\n\n\t \n\t{ \"Left ADC Mixer\", \"Mixer Capture Switch\", \"Left Mixer\" },\n\t{ \"Left ADC Mixer\", \"Mixer Reversed Capture Switch\", \"Right Mixer\" },\n\t{ \"Left ADC Mixer\", \"Line In Capture Switch\", \"LINEIN\" },\n\t{ \"Left ADC Mixer\", \"Mic1 Capture Switch\", \"Mic1 Amplifier\" },\n\t{ \"Left ADC Mixer\", \"Mic2 Capture Switch\", \"Mic2 Amplifier\" },\n\n\t \n\t{ \"Right ADC Mixer\", \"Mixer Capture Switch\", \"Right Mixer\" },\n\t{ \"Right ADC Mixer\", \"Mixer Reversed Capture Switch\", \"Left Mixer\" },\n\t{ \"Right ADC Mixer\", \"Line In Capture Switch\", \"LINEIN\" },\n\t{ \"Right ADC Mixer\", \"Mic1 Capture Switch\", \"Mic1 Amplifier\" },\n\t{ \"Right ADC Mixer\", \"Mic2 Capture Switch\", \"Mic2 Amplifier\" },\n\n\t \n\t{ \"Headphone Source Playback Route\", \"DAC\", \"Left DAC\" },\n\t{ \"Headphone Source Playback Route\", \"DAC\", \"Right DAC\" },\n\t{ \"Headphone Source Playback Route\", \"Mixer\", \"Left Mixer\" },\n\t{ \"Headphone Source Playback Route\", \"Mixer\", \"Right Mixer\" },\n\t{ \"Headphone Amp\", NULL, \"Headphone Source Playback Route\" },\n\t{ \"HP\", NULL, \"Headphone Amp\" },\n\t{ \"HPCOM\", NULL, \"HPCOM Protection\" },\n\n\t \n\t{ \"Line Out Source Playback Route\", \"Stereo\", \"Left Mixer\" },\n\t{ \"Line Out Source Playback Route\", \"Stereo\", \"Right Mixer\" },\n\t{ \"Line Out Source Playback Route\", \"Mono Differential\", \"Left Mixer\" },\n\t{ \"Line Out Source Playback Route\", \"Mono Differential\", \"Right Mixer\" },\n\t{ \"LINEOUT\", NULL, \"Line Out Source Playback Route\" },\n\n\t \n\t{ \"Left ADC\", NULL, \"ADC Enable\" },\n\t{ \"Right ADC\", NULL, \"ADC Enable\" },\n\t{ \"Left ADC\", NULL, \"Left ADC Mixer\" },\n\t{ \"Right ADC\", NULL, \"Right ADC Mixer\" },\n};\n\nstatic const struct snd_soc_component_driver sun6i_codec_codec = {\n\t.controls\t\t= sun6i_codec_codec_widgets,\n\t.num_controls\t\t= ARRAY_SIZE(sun6i_codec_codec_widgets),\n\t.dapm_widgets\t\t= sun6i_codec_codec_dapm_widgets,\n\t.num_dapm_widgets\t= ARRAY_SIZE(sun6i_codec_codec_dapm_widgets),\n\t.dapm_routes\t\t= sun6i_codec_codec_dapm_routes,\n\t.num_dapm_routes\t= ARRAY_SIZE(sun6i_codec_codec_dapm_routes),\n\t.idle_bias_on\t\t= 1,\n\t.use_pmdown_time\t= 1,\n\t.endianness\t\t= 1,\n};\n\n \nstatic const struct snd_kcontrol_new sun8i_a23_codec_codec_controls[] = {\n\tSOC_SINGLE_TLV(\"DAC Playback Volume\", SUN4I_CODEC_DAC_DPC,\n\t\t       SUN4I_CODEC_DAC_DPC_DVOL, 0x3f, 1,\n\t\t       sun6i_codec_dvol_scale),\n};\n\nstatic const struct snd_soc_dapm_widget sun8i_a23_codec_codec_widgets[] = {\n\t \n\tSND_SOC_DAPM_SUPPLY(\"ADC Enable\", SUN6I_CODEC_ADC_FIFOC,\n\t\t\t    SUN6I_CODEC_ADC_FIFOC_EN_AD, 0, NULL, 0),\n\t \n\tSND_SOC_DAPM_SUPPLY(\"DAC Enable\", SUN4I_CODEC_DAC_DPC,\n\t\t\t    SUN4I_CODEC_DAC_DPC_EN_DA, 0, NULL, 0),\n\n};\n\nstatic const struct snd_soc_component_driver sun8i_a23_codec_codec = {\n\t.controls\t\t= sun8i_a23_codec_codec_controls,\n\t.num_controls\t\t= ARRAY_SIZE(sun8i_a23_codec_codec_controls),\n\t.dapm_widgets\t\t= sun8i_a23_codec_codec_widgets,\n\t.num_dapm_widgets\t= ARRAY_SIZE(sun8i_a23_codec_codec_widgets),\n\t.idle_bias_on\t\t= 1,\n\t.use_pmdown_time\t= 1,\n\t.endianness\t\t= 1,\n};\n\nstatic const struct snd_soc_component_driver sun4i_codec_component = {\n\t.name\t\t\t= \"sun4i-codec\",\n\t.legacy_dai_naming\t= 1,\n#ifdef CONFIG_DEBUG_FS\n\t.debugfs_prefix\t\t= \"cpu\",\n#endif\n};\n\n#define SUN4I_CODEC_RATES\tSNDRV_PCM_RATE_CONTINUOUS\n#define SUN4I_CODEC_FORMATS\t(SNDRV_PCM_FMTBIT_S16_LE | \\\n\t\t\t\t SNDRV_PCM_FMTBIT_S32_LE)\n\nstatic int sun4i_codec_dai_probe(struct snd_soc_dai *dai)\n{\n\tstruct snd_soc_card *card = snd_soc_dai_get_drvdata(dai);\n\tstruct sun4i_codec *scodec = snd_soc_card_get_drvdata(card);\n\n\tsnd_soc_dai_init_dma_data(dai, &scodec->playback_dma_data,\n\t\t\t\t  &scodec->capture_dma_data);\n\n\treturn 0;\n}\n\nstatic const struct snd_soc_dai_ops dummy_dai_ops = {\n\t.probe\t= sun4i_codec_dai_probe,\n};\n\nstatic struct snd_soc_dai_driver dummy_cpu_dai = {\n\t.name\t= \"sun4i-codec-cpu-dai\",\n\t.playback = {\n\t\t.stream_name\t= \"Playback\",\n\t\t.channels_min\t= 1,\n\t\t.channels_max\t= 2,\n\t\t.rates\t\t= SUN4I_CODEC_RATES,\n\t\t.formats\t= SUN4I_CODEC_FORMATS,\n\t\t.sig_bits\t= 24,\n\t},\n\t.capture = {\n\t\t.stream_name\t= \"Capture\",\n\t\t.channels_min\t= 1,\n\t\t.channels_max\t= 2,\n\t\t.rates \t\t= SUN4I_CODEC_RATES,\n\t\t.formats \t= SUN4I_CODEC_FORMATS,\n\t\t.sig_bits\t= 24,\n\t },\n\t.ops = &dummy_dai_ops,\n};\n\nstatic struct snd_soc_dai_link *sun4i_codec_create_link(struct device *dev,\n\t\t\t\t\t\t\tint *num_links)\n{\n\tstruct snd_soc_dai_link *link = devm_kzalloc(dev, sizeof(*link),\n\t\t\t\t\t\t     GFP_KERNEL);\n\tstruct snd_soc_dai_link_component *dlc = devm_kzalloc(dev,\n\t\t\t\t\t\t3 * sizeof(*dlc), GFP_KERNEL);\n\tif (!link || !dlc)\n\t\treturn NULL;\n\n\tlink->cpus\t= &dlc[0];\n\tlink->codecs\t= &dlc[1];\n\tlink->platforms\t= &dlc[2];\n\n\tlink->num_cpus\t\t= 1;\n\tlink->num_codecs\t= 1;\n\tlink->num_platforms\t= 1;\n\n\tlink->name\t\t= \"cdc\";\n\tlink->stream_name\t= \"CDC PCM\";\n\tlink->codecs->dai_name\t= \"Codec\";\n\tlink->cpus->dai_name\t= dev_name(dev);\n\tlink->codecs->name\t= dev_name(dev);\n\tlink->platforms->name\t= dev_name(dev);\n\tlink->dai_fmt\t\t= SND_SOC_DAIFMT_I2S;\n\n\t*num_links = 1;\n\n\treturn link;\n};\n\nstatic int sun4i_codec_spk_event(struct snd_soc_dapm_widget *w,\n\t\t\t\t struct snd_kcontrol *k, int event)\n{\n\tstruct sun4i_codec *scodec = snd_soc_card_get_drvdata(w->dapm->card);\n\n\tgpiod_set_value_cansleep(scodec->gpio_pa,\n\t\t\t\t !!SND_SOC_DAPM_EVENT_ON(event));\n\n\tif (SND_SOC_DAPM_EVENT_ON(event)) {\n\t\t \n\t\tmsleep(700);\n\t}\n\n\treturn 0;\n}\n\nstatic const struct snd_soc_dapm_widget sun4i_codec_card_dapm_widgets[] = {\n\tSND_SOC_DAPM_SPK(\"Speaker\", sun4i_codec_spk_event),\n};\n\nstatic const struct snd_soc_dapm_route sun4i_codec_card_dapm_routes[] = {\n\t{ \"Speaker\", NULL, \"HP Right\" },\n\t{ \"Speaker\", NULL, \"HP Left\" },\n};\n\nstatic struct snd_soc_card *sun4i_codec_create_card(struct device *dev)\n{\n\tstruct snd_soc_card *card;\n\n\tcard = devm_kzalloc(dev, sizeof(*card), GFP_KERNEL);\n\tif (!card)\n\t\treturn ERR_PTR(-ENOMEM);\n\n\tcard->dai_link = sun4i_codec_create_link(dev, &card->num_links);\n\tif (!card->dai_link)\n\t\treturn ERR_PTR(-ENOMEM);\n\n\tcard->dev\t\t= dev;\n\tcard->owner\t\t= THIS_MODULE;\n\tcard->name\t\t= \"sun4i-codec\";\n\tcard->dapm_widgets\t= sun4i_codec_card_dapm_widgets;\n\tcard->num_dapm_widgets\t= ARRAY_SIZE(sun4i_codec_card_dapm_widgets);\n\tcard->dapm_routes\t= sun4i_codec_card_dapm_routes;\n\tcard->num_dapm_routes\t= ARRAY_SIZE(sun4i_codec_card_dapm_routes);\n\n\treturn card;\n};\n\nstatic const struct snd_soc_dapm_widget sun6i_codec_card_dapm_widgets[] = {\n\tSND_SOC_DAPM_HP(\"Headphone\", NULL),\n\tSND_SOC_DAPM_LINE(\"Line In\", NULL),\n\tSND_SOC_DAPM_LINE(\"Line Out\", NULL),\n\tSND_SOC_DAPM_MIC(\"Headset Mic\", NULL),\n\tSND_SOC_DAPM_MIC(\"Mic\", NULL),\n\tSND_SOC_DAPM_SPK(\"Speaker\", sun4i_codec_spk_event),\n};\n\nstatic struct snd_soc_card *sun6i_codec_create_card(struct device *dev)\n{\n\tstruct snd_soc_card *card;\n\tint ret;\n\n\tcard = devm_kzalloc(dev, sizeof(*card), GFP_KERNEL);\n\tif (!card)\n\t\treturn ERR_PTR(-ENOMEM);\n\n\tcard->dai_link = sun4i_codec_create_link(dev, &card->num_links);\n\tif (!card->dai_link)\n\t\treturn ERR_PTR(-ENOMEM);\n\n\tcard->dev\t\t= dev;\n\tcard->owner\t\t= THIS_MODULE;\n\tcard->name\t\t= \"A31 Audio Codec\";\n\tcard->dapm_widgets\t= sun6i_codec_card_dapm_widgets;\n\tcard->num_dapm_widgets\t= ARRAY_SIZE(sun6i_codec_card_dapm_widgets);\n\tcard->fully_routed\t= true;\n\n\tret = snd_soc_of_parse_audio_routing(card, \"allwinner,audio-routing\");\n\tif (ret)\n\t\tdev_warn(dev, \"failed to parse audio-routing: %d\\n\", ret);\n\n\treturn card;\n};\n\n \nstatic const struct snd_soc_dapm_route sun8i_codec_card_routes[] = {\n\t \n\t{ \"Left ADC\", NULL, \"ADC Enable\" },\n\t{ \"Right ADC\", NULL, \"ADC Enable\" },\n\t{ \"Codec Capture\", NULL, \"Left ADC\" },\n\t{ \"Codec Capture\", NULL, \"Right ADC\" },\n\n\t \n\t{ \"Left DAC\", NULL, \"DAC Enable\" },\n\t{ \"Right DAC\", NULL, \"DAC Enable\" },\n\t{ \"Left DAC\", NULL, \"Codec Playback\" },\n\t{ \"Right DAC\", NULL, \"Codec Playback\" },\n};\n\nstatic struct snd_soc_aux_dev aux_dev = {\n\t.dlc = COMP_EMPTY(),\n};\n\nstatic struct snd_soc_card *sun8i_a23_codec_create_card(struct device *dev)\n{\n\tstruct snd_soc_card *card;\n\tint ret;\n\n\tcard = devm_kzalloc(dev, sizeof(*card), GFP_KERNEL);\n\tif (!card)\n\t\treturn ERR_PTR(-ENOMEM);\n\n\taux_dev.dlc.of_node = of_parse_phandle(dev->of_node,\n\t\t\t\t\t\t \"allwinner,codec-analog-controls\",\n\t\t\t\t\t\t 0);\n\tif (!aux_dev.dlc.of_node) {\n\t\tdev_err(dev, \"Can't find analog controls for codec.\\n\");\n\t\treturn ERR_PTR(-EINVAL);\n\t}\n\n\tcard->dai_link = sun4i_codec_create_link(dev, &card->num_links);\n\tif (!card->dai_link)\n\t\treturn ERR_PTR(-ENOMEM);\n\n\tcard->dev\t\t= dev;\n\tcard->owner\t\t= THIS_MODULE;\n\tcard->name\t\t= \"A23 Audio Codec\";\n\tcard->dapm_widgets\t= sun6i_codec_card_dapm_widgets;\n\tcard->num_dapm_widgets\t= ARRAY_SIZE(sun6i_codec_card_dapm_widgets);\n\tcard->dapm_routes\t= sun8i_codec_card_routes;\n\tcard->num_dapm_routes\t= ARRAY_SIZE(sun8i_codec_card_routes);\n\tcard->aux_dev\t\t= &aux_dev;\n\tcard->num_aux_devs\t= 1;\n\tcard->fully_routed\t= true;\n\n\tret = snd_soc_of_parse_audio_routing(card, \"allwinner,audio-routing\");\n\tif (ret)\n\t\tdev_warn(dev, \"failed to parse audio-routing: %d\\n\", ret);\n\n\treturn card;\n};\n\nstatic struct snd_soc_card *sun8i_h3_codec_create_card(struct device *dev)\n{\n\tstruct snd_soc_card *card;\n\tint ret;\n\n\tcard = devm_kzalloc(dev, sizeof(*card), GFP_KERNEL);\n\tif (!card)\n\t\treturn ERR_PTR(-ENOMEM);\n\n\taux_dev.dlc.of_node = of_parse_phandle(dev->of_node,\n\t\t\t\t\t\t \"allwinner,codec-analog-controls\",\n\t\t\t\t\t\t 0);\n\tif (!aux_dev.dlc.of_node) {\n\t\tdev_err(dev, \"Can't find analog controls for codec.\\n\");\n\t\treturn ERR_PTR(-EINVAL);\n\t}\n\n\tcard->dai_link = sun4i_codec_create_link(dev, &card->num_links);\n\tif (!card->dai_link)\n\t\treturn ERR_PTR(-ENOMEM);\n\n\tcard->dev\t\t= dev;\n\tcard->owner\t\t= THIS_MODULE;\n\tcard->name\t\t= \"H3 Audio Codec\";\n\tcard->dapm_widgets\t= sun6i_codec_card_dapm_widgets;\n\tcard->num_dapm_widgets\t= ARRAY_SIZE(sun6i_codec_card_dapm_widgets);\n\tcard->dapm_routes\t= sun8i_codec_card_routes;\n\tcard->num_dapm_routes\t= ARRAY_SIZE(sun8i_codec_card_routes);\n\tcard->aux_dev\t\t= &aux_dev;\n\tcard->num_aux_devs\t= 1;\n\tcard->fully_routed\t= true;\n\n\tret = snd_soc_of_parse_audio_routing(card, \"allwinner,audio-routing\");\n\tif (ret)\n\t\tdev_warn(dev, \"failed to parse audio-routing: %d\\n\", ret);\n\n\treturn card;\n};\n\nstatic struct snd_soc_card *sun8i_v3s_codec_create_card(struct device *dev)\n{\n\tstruct snd_soc_card *card;\n\tint ret;\n\n\tcard = devm_kzalloc(dev, sizeof(*card), GFP_KERNEL);\n\tif (!card)\n\t\treturn ERR_PTR(-ENOMEM);\n\n\taux_dev.dlc.of_node = of_parse_phandle(dev->of_node,\n\t\t\t\t\t\t \"allwinner,codec-analog-controls\",\n\t\t\t\t\t\t 0);\n\tif (!aux_dev.dlc.of_node) {\n\t\tdev_err(dev, \"Can't find analog controls for codec.\\n\");\n\t\treturn ERR_PTR(-EINVAL);\n\t}\n\n\tcard->dai_link = sun4i_codec_create_link(dev, &card->num_links);\n\tif (!card->dai_link)\n\t\treturn ERR_PTR(-ENOMEM);\n\n\tcard->dev\t\t= dev;\n\tcard->owner\t\t= THIS_MODULE;\n\tcard->name\t\t= \"V3s Audio Codec\";\n\tcard->dapm_widgets\t= sun6i_codec_card_dapm_widgets;\n\tcard->num_dapm_widgets\t= ARRAY_SIZE(sun6i_codec_card_dapm_widgets);\n\tcard->dapm_routes\t= sun8i_codec_card_routes;\n\tcard->num_dapm_routes\t= ARRAY_SIZE(sun8i_codec_card_routes);\n\tcard->aux_dev\t\t= &aux_dev;\n\tcard->num_aux_devs\t= 1;\n\tcard->fully_routed\t= true;\n\n\tret = snd_soc_of_parse_audio_routing(card, \"allwinner,audio-routing\");\n\tif (ret)\n\t\tdev_warn(dev, \"failed to parse audio-routing: %d\\n\", ret);\n\n\treturn card;\n};\n\nstatic const struct regmap_config sun4i_codec_regmap_config = {\n\t.reg_bits\t= 32,\n\t.reg_stride\t= 4,\n\t.val_bits\t= 32,\n\t.max_register\t= SUN4I_CODEC_ADC_RXCNT,\n};\n\nstatic const struct regmap_config sun6i_codec_regmap_config = {\n\t.reg_bits\t= 32,\n\t.reg_stride\t= 4,\n\t.val_bits\t= 32,\n\t.max_register\t= SUN6I_CODEC_HMIC_DATA,\n};\n\nstatic const struct regmap_config sun7i_codec_regmap_config = {\n\t.reg_bits\t= 32,\n\t.reg_stride\t= 4,\n\t.val_bits\t= 32,\n\t.max_register\t= SUN7I_CODEC_AC_MIC_PHONE_CAL,\n};\n\nstatic const struct regmap_config sun8i_a23_codec_regmap_config = {\n\t.reg_bits\t= 32,\n\t.reg_stride\t= 4,\n\t.val_bits\t= 32,\n\t.max_register\t= SUN8I_A23_CODEC_ADC_RXCNT,\n};\n\nstatic const struct regmap_config sun8i_h3_codec_regmap_config = {\n\t.reg_bits\t= 32,\n\t.reg_stride\t= 4,\n\t.val_bits\t= 32,\n\t.max_register\t= SUN8I_H3_CODEC_ADC_DBG,\n};\n\nstatic const struct regmap_config sun8i_v3s_codec_regmap_config = {\n\t.reg_bits\t= 32,\n\t.reg_stride\t= 4,\n\t.val_bits\t= 32,\n\t.max_register\t= SUN8I_H3_CODEC_ADC_DBG,\n};\n\nstruct sun4i_codec_quirks {\n\tconst struct regmap_config *regmap_config;\n\tconst struct snd_soc_component_driver *codec;\n\tstruct snd_soc_card * (*create_card)(struct device *dev);\n\tstruct reg_field reg_adc_fifoc;\t \n\tunsigned int reg_dac_txdata;\t \n\tunsigned int reg_adc_rxdata;\t \n\tbool has_reset;\n};\n\nstatic const struct sun4i_codec_quirks sun4i_codec_quirks = {\n\t.regmap_config\t= &sun4i_codec_regmap_config,\n\t.codec\t\t= &sun4i_codec_codec,\n\t.create_card\t= sun4i_codec_create_card,\n\t.reg_adc_fifoc\t= REG_FIELD(SUN4I_CODEC_ADC_FIFOC, 0, 31),\n\t.reg_dac_txdata\t= SUN4I_CODEC_DAC_TXDATA,\n\t.reg_adc_rxdata\t= SUN4I_CODEC_ADC_RXDATA,\n};\n\nstatic const struct sun4i_codec_quirks sun6i_a31_codec_quirks = {\n\t.regmap_config\t= &sun6i_codec_regmap_config,\n\t.codec\t\t= &sun6i_codec_codec,\n\t.create_card\t= sun6i_codec_create_card,\n\t.reg_adc_fifoc\t= REG_FIELD(SUN6I_CODEC_ADC_FIFOC, 0, 31),\n\t.reg_dac_txdata\t= SUN4I_CODEC_DAC_TXDATA,\n\t.reg_adc_rxdata\t= SUN6I_CODEC_ADC_RXDATA,\n\t.has_reset\t= true,\n};\n\nstatic const struct sun4i_codec_quirks sun7i_codec_quirks = {\n\t.regmap_config\t= &sun7i_codec_regmap_config,\n\t.codec\t\t= &sun7i_codec_codec,\n\t.create_card\t= sun4i_codec_create_card,\n\t.reg_adc_fifoc\t= REG_FIELD(SUN4I_CODEC_ADC_FIFOC, 0, 31),\n\t.reg_dac_txdata\t= SUN4I_CODEC_DAC_TXDATA,\n\t.reg_adc_rxdata\t= SUN4I_CODEC_ADC_RXDATA,\n};\n\nstatic const struct sun4i_codec_quirks sun8i_a23_codec_quirks = {\n\t.regmap_config\t= &sun8i_a23_codec_regmap_config,\n\t.codec\t\t= &sun8i_a23_codec_codec,\n\t.create_card\t= sun8i_a23_codec_create_card,\n\t.reg_adc_fifoc\t= REG_FIELD(SUN6I_CODEC_ADC_FIFOC, 0, 31),\n\t.reg_dac_txdata\t= SUN4I_CODEC_DAC_TXDATA,\n\t.reg_adc_rxdata\t= SUN6I_CODEC_ADC_RXDATA,\n\t.has_reset\t= true,\n};\n\nstatic const struct sun4i_codec_quirks sun8i_h3_codec_quirks = {\n\t.regmap_config\t= &sun8i_h3_codec_regmap_config,\n\t \n\t.codec\t\t= &sun8i_a23_codec_codec,\n\t.create_card\t= sun8i_h3_codec_create_card,\n\t.reg_adc_fifoc\t= REG_FIELD(SUN6I_CODEC_ADC_FIFOC, 0, 31),\n\t.reg_dac_txdata\t= SUN8I_H3_CODEC_DAC_TXDATA,\n\t.reg_adc_rxdata\t= SUN6I_CODEC_ADC_RXDATA,\n\t.has_reset\t= true,\n};\n\nstatic const struct sun4i_codec_quirks sun8i_v3s_codec_quirks = {\n\t.regmap_config\t= &sun8i_v3s_codec_regmap_config,\n\t \n\t.codec\t\t= &sun8i_a23_codec_codec,\n\t.create_card\t= sun8i_v3s_codec_create_card,\n\t.reg_adc_fifoc\t= REG_FIELD(SUN6I_CODEC_ADC_FIFOC, 0, 31),\n\t.reg_dac_txdata\t= SUN8I_H3_CODEC_DAC_TXDATA,\n\t.reg_adc_rxdata\t= SUN6I_CODEC_ADC_RXDATA,\n\t.has_reset\t= true,\n};\n\nstatic const struct of_device_id sun4i_codec_of_match[] = {\n\t{\n\t\t.compatible = \"allwinner,sun4i-a10-codec\",\n\t\t.data = &sun4i_codec_quirks,\n\t},\n\t{\n\t\t.compatible = \"allwinner,sun6i-a31-codec\",\n\t\t.data = &sun6i_a31_codec_quirks,\n\t},\n\t{\n\t\t.compatible = \"allwinner,sun7i-a20-codec\",\n\t\t.data = &sun7i_codec_quirks,\n\t},\n\t{\n\t\t.compatible = \"allwinner,sun8i-a23-codec\",\n\t\t.data = &sun8i_a23_codec_quirks,\n\t},\n\t{\n\t\t.compatible = \"allwinner,sun8i-h3-codec\",\n\t\t.data = &sun8i_h3_codec_quirks,\n\t},\n\t{\n\t\t.compatible = \"allwinner,sun8i-v3s-codec\",\n\t\t.data = &sun8i_v3s_codec_quirks,\n\t},\n\t{}\n};\nMODULE_DEVICE_TABLE(of, sun4i_codec_of_match);\n\nstatic int sun4i_codec_probe(struct platform_device *pdev)\n{\n\tstruct snd_soc_card *card;\n\tstruct sun4i_codec *scodec;\n\tconst struct sun4i_codec_quirks *quirks;\n\tstruct resource *res;\n\tvoid __iomem *base;\n\tint ret;\n\n\tscodec = devm_kzalloc(&pdev->dev, sizeof(*scodec), GFP_KERNEL);\n\tif (!scodec)\n\t\treturn -ENOMEM;\n\n\tscodec->dev = &pdev->dev;\n\n\tbase = devm_platform_get_and_ioremap_resource(pdev, 0, &res);\n\tif (IS_ERR(base))\n\t\treturn PTR_ERR(base);\n\n\tquirks = of_device_get_match_data(&pdev->dev);\n\tif (quirks == NULL) {\n\t\tdev_err(&pdev->dev, \"Failed to determine the quirks to use\\n\");\n\t\treturn -ENODEV;\n\t}\n\n\tscodec->regmap = devm_regmap_init_mmio(&pdev->dev, base,\n\t\t\t\t\t       quirks->regmap_config);\n\tif (IS_ERR(scodec->regmap)) {\n\t\tdev_err(&pdev->dev, \"Failed to create our regmap\\n\");\n\t\treturn PTR_ERR(scodec->regmap);\n\t}\n\n\t \n\tscodec->clk_apb = devm_clk_get(&pdev->dev, \"apb\");\n\tif (IS_ERR(scodec->clk_apb)) {\n\t\tdev_err(&pdev->dev, \"Failed to get the APB clock\\n\");\n\t\treturn PTR_ERR(scodec->clk_apb);\n\t}\n\n\tscodec->clk_module = devm_clk_get(&pdev->dev, \"codec\");\n\tif (IS_ERR(scodec->clk_module)) {\n\t\tdev_err(&pdev->dev, \"Failed to get the module clock\\n\");\n\t\treturn PTR_ERR(scodec->clk_module);\n\t}\n\n\tif (quirks->has_reset) {\n\t\tscodec->rst = devm_reset_control_get_exclusive(&pdev->dev,\n\t\t\t\t\t\t\t       NULL);\n\t\tif (IS_ERR(scodec->rst)) {\n\t\t\tdev_err(&pdev->dev, \"Failed to get reset control\\n\");\n\t\t\treturn PTR_ERR(scodec->rst);\n\t\t}\n\t}\n\n\tscodec->gpio_pa = devm_gpiod_get_optional(&pdev->dev, \"allwinner,pa\",\n\t\t\t\t\t\t  GPIOD_OUT_LOW);\n\tif (IS_ERR(scodec->gpio_pa)) {\n\t\tret = PTR_ERR(scodec->gpio_pa);\n\t\tdev_err_probe(&pdev->dev, ret, \"Failed to get pa gpio\\n\");\n\t\treturn ret;\n\t}\n\n\t \n\tscodec->reg_adc_fifoc = devm_regmap_field_alloc(&pdev->dev,\n\t\t\t\t\t\t\tscodec->regmap,\n\t\t\t\t\t\t\tquirks->reg_adc_fifoc);\n\tif (IS_ERR(scodec->reg_adc_fifoc)) {\n\t\tret = PTR_ERR(scodec->reg_adc_fifoc);\n\t\tdev_err(&pdev->dev, \"Failed to create regmap fields: %d\\n\",\n\t\t\tret);\n\t\treturn ret;\n\t}\n\n\t \n\tif (clk_prepare_enable(scodec->clk_apb)) {\n\t\tdev_err(&pdev->dev, \"Failed to enable the APB clock\\n\");\n\t\treturn -EINVAL;\n\t}\n\n\t \n\tif (scodec->rst) {\n\t\tret = reset_control_deassert(scodec->rst);\n\t\tif (ret) {\n\t\t\tdev_err(&pdev->dev,\n\t\t\t\t\"Failed to deassert the reset control\\n\");\n\t\t\tgoto err_clk_disable;\n\t\t}\n\t}\n\n\t \n\tscodec->playback_dma_data.addr = res->start + quirks->reg_dac_txdata;\n\tscodec->playback_dma_data.maxburst = 8;\n\tscodec->playback_dma_data.addr_width = DMA_SLAVE_BUSWIDTH_2_BYTES;\n\n\t \n\tscodec->capture_dma_data.addr = res->start + quirks->reg_adc_rxdata;\n\tscodec->capture_dma_data.maxburst = 8;\n\tscodec->capture_dma_data.addr_width = DMA_SLAVE_BUSWIDTH_2_BYTES;\n\n\tret = devm_snd_soc_register_component(&pdev->dev, quirks->codec,\n\t\t\t\t     &sun4i_codec_dai, 1);\n\tif (ret) {\n\t\tdev_err(&pdev->dev, \"Failed to register our codec\\n\");\n\t\tgoto err_assert_reset;\n\t}\n\n\tret = devm_snd_soc_register_component(&pdev->dev,\n\t\t\t\t\t      &sun4i_codec_component,\n\t\t\t\t\t      &dummy_cpu_dai, 1);\n\tif (ret) {\n\t\tdev_err(&pdev->dev, \"Failed to register our DAI\\n\");\n\t\tgoto err_assert_reset;\n\t}\n\n\tret = devm_snd_dmaengine_pcm_register(&pdev->dev, NULL, 0);\n\tif (ret) {\n\t\tdev_err(&pdev->dev, \"Failed to register against DMAEngine\\n\");\n\t\tgoto err_assert_reset;\n\t}\n\n\tcard = quirks->create_card(&pdev->dev);\n\tif (IS_ERR(card)) {\n\t\tret = PTR_ERR(card);\n\t\tdev_err(&pdev->dev, \"Failed to create our card\\n\");\n\t\tgoto err_assert_reset;\n\t}\n\n\tsnd_soc_card_set_drvdata(card, scodec);\n\n\tret = snd_soc_register_card(card);\n\tif (ret) {\n\t\tdev_err_probe(&pdev->dev, ret, \"Failed to register our card\\n\");\n\t\tgoto err_assert_reset;\n\t}\n\n\treturn 0;\n\nerr_assert_reset:\n\tif (scodec->rst)\n\t\treset_control_assert(scodec->rst);\nerr_clk_disable:\n\tclk_disable_unprepare(scodec->clk_apb);\n\treturn ret;\n}\n\nstatic void sun4i_codec_remove(struct platform_device *pdev)\n{\n\tstruct snd_soc_card *card = platform_get_drvdata(pdev);\n\tstruct sun4i_codec *scodec = snd_soc_card_get_drvdata(card);\n\n\tsnd_soc_unregister_card(card);\n\tif (scodec->rst)\n\t\treset_control_assert(scodec->rst);\n\tclk_disable_unprepare(scodec->clk_apb);\n}\n\nstatic struct platform_driver sun4i_codec_driver = {\n\t.driver = {\n\t\t.name = \"sun4i-codec\",\n\t\t.of_match_table = sun4i_codec_of_match,\n\t},\n\t.probe = sun4i_codec_probe,\n\t.remove_new = sun4i_codec_remove,\n};\nmodule_platform_driver(sun4i_codec_driver);\n\nMODULE_DESCRIPTION(\"Allwinner A10 codec driver\");\nMODULE_AUTHOR(\"Emilio L\u00f3pez <emilio@elopez.com.ar>\");\nMODULE_AUTHOR(\"Jon Smirl <jonsmirl@gmail.com>\");\nMODULE_AUTHOR(\"Maxime Ripard <maxime.ripard@free-electrons.com>\");\nMODULE_AUTHOR(\"Chen-Yu Tsai <wens@csie.org>\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}