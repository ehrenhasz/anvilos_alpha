{
  "module_name": "sun8i-adda-pr-regmap.c",
  "hash_id": "ec7e8ff6cdc2db2fc61c2cc162c1d168a7fb1d83625703a5d0b8be566d139e61",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/sunxi/sun8i-adda-pr-regmap.c",
  "human_readable_source": "\n \n\n#include <linux/io.h>\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/regmap.h>\n\n#include \"sun8i-adda-pr-regmap.h\"\n\n \n#define ADDA_PR\t\t\t0x0\t\t \n#define ADDA_PR_RESET\t\t\tBIT(28)\n#define ADDA_PR_WRITE\t\t\tBIT(24)\n#define ADDA_PR_ADDR_SHIFT\t\t16\n#define ADDA_PR_ADDR_MASK\t\tGENMASK(4, 0)\n#define ADDA_PR_DATA_IN_SHIFT\t\t8\n#define ADDA_PR_DATA_IN_MASK\t\tGENMASK(7, 0)\n#define ADDA_PR_DATA_OUT_SHIFT\t\t0\n#define ADDA_PR_DATA_OUT_MASK\t\tGENMASK(7, 0)\n\n \nstatic int adda_reg_read(void *context, unsigned int reg, unsigned int *val)\n{\n\tvoid __iomem *base = (void __iomem *)context;\n\tu32 tmp;\n\n\t \n\twritel(readl(base) | ADDA_PR_RESET, base);\n\n\t \n\twritel(readl(base) & ~ADDA_PR_WRITE, base);\n\n\t \n\ttmp = readl(base);\n\ttmp &= ~(ADDA_PR_ADDR_MASK << ADDA_PR_ADDR_SHIFT);\n\ttmp |= (reg & ADDA_PR_ADDR_MASK) << ADDA_PR_ADDR_SHIFT;\n\twritel(tmp, base);\n\n\t \n\t*val = readl(base) & ADDA_PR_DATA_OUT_MASK;\n\n\treturn 0;\n}\n\nstatic int adda_reg_write(void *context, unsigned int reg, unsigned int val)\n{\n\tvoid __iomem *base = (void __iomem *)context;\n\tu32 tmp;\n\n\t \n\twritel(readl(base) | ADDA_PR_RESET, base);\n\n\t \n\ttmp = readl(base);\n\ttmp &= ~(ADDA_PR_ADDR_MASK << ADDA_PR_ADDR_SHIFT);\n\ttmp |= (reg & ADDA_PR_ADDR_MASK) << ADDA_PR_ADDR_SHIFT;\n\twritel(tmp, base);\n\n\t \n\ttmp = readl(base);\n\ttmp &= ~(ADDA_PR_DATA_IN_MASK << ADDA_PR_DATA_IN_SHIFT);\n\ttmp |= (val & ADDA_PR_DATA_IN_MASK) << ADDA_PR_DATA_IN_SHIFT;\n\twritel(tmp, base);\n\n\t \n\twritel(readl(base) | ADDA_PR_WRITE, base);\n\n\t \n\twritel(readl(base) & ~ADDA_PR_WRITE, base);\n\n\treturn 0;\n}\n\nstatic const struct regmap_config adda_pr_regmap_cfg = {\n\t.name\t\t= \"adda-pr\",\n\t.reg_bits\t= 5,\n\t.reg_stride\t= 1,\n\t.val_bits\t= 8,\n\t.reg_read\t= adda_reg_read,\n\t.reg_write\t= adda_reg_write,\n\t.fast_io\t= true,\n\t.max_register\t= 31,\n};\n\nstruct regmap *sun8i_adda_pr_regmap_init(struct device *dev,\n\t\t\t\t\t void __iomem *base)\n{\n\treturn devm_regmap_init(dev, NULL, base, &adda_pr_regmap_cfg);\n}\nEXPORT_SYMBOL_GPL(sun8i_adda_pr_regmap_init);\n\nMODULE_DESCRIPTION(\"Allwinner analog audio codec regmap driver\");\nMODULE_AUTHOR(\"Vasily Khoruzhick <anarsoul@gmail.com>\");\nMODULE_LICENSE(\"GPL\");\nMODULE_ALIAS(\"platform:sunxi-adda-pr\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}