{
  "module_name": "sun8i-codec.c",
  "hash_id": "3875a397991e0267fdb435d3cabb2d175756c24584b6fe31fcb55392e91c251b",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/sunxi/sun8i-codec.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/delay.h>\n#include <linux/clk.h>\n#include <linux/io.h>\n#include <linux/of_device.h>\n#include <linux/pm_runtime.h>\n#include <linux/regmap.h>\n#include <linux/log2.h>\n\n#include <sound/pcm_params.h>\n#include <sound/soc.h>\n#include <sound/soc-dapm.h>\n#include <sound/tlv.h>\n\n#define SUN8I_SYSCLK_CTL\t\t\t\t0x00c\n#define SUN8I_SYSCLK_CTL_AIF1CLK_ENA\t\t\t11\n#define SUN8I_SYSCLK_CTL_AIF1CLK_SRC_PLL\t\t(0x2 << 8)\n#define SUN8I_SYSCLK_CTL_AIF2CLK_ENA\t\t\t7\n#define SUN8I_SYSCLK_CTL_AIF2CLK_SRC_PLL\t\t(0x2 << 4)\n#define SUN8I_SYSCLK_CTL_SYSCLK_ENA\t\t\t3\n#define SUN8I_SYSCLK_CTL_SYSCLK_SRC\t\t\t0\n#define SUN8I_SYSCLK_CTL_SYSCLK_SRC_AIF1CLK\t\t(0x0 << 0)\n#define SUN8I_SYSCLK_CTL_SYSCLK_SRC_AIF2CLK\t\t(0x1 << 0)\n#define SUN8I_MOD_CLK_ENA\t\t\t\t0x010\n#define SUN8I_MOD_CLK_ENA_AIF1\t\t\t\t15\n#define SUN8I_MOD_CLK_ENA_AIF2\t\t\t\t14\n#define SUN8I_MOD_CLK_ENA_AIF3\t\t\t\t13\n#define SUN8I_MOD_CLK_ENA_ADC\t\t\t\t3\n#define SUN8I_MOD_CLK_ENA_DAC\t\t\t\t2\n#define SUN8I_MOD_RST_CTL\t\t\t\t0x014\n#define SUN8I_MOD_RST_CTL_AIF1\t\t\t\t15\n#define SUN8I_MOD_RST_CTL_AIF2\t\t\t\t14\n#define SUN8I_MOD_RST_CTL_AIF3\t\t\t\t13\n#define SUN8I_MOD_RST_CTL_ADC\t\t\t\t3\n#define SUN8I_MOD_RST_CTL_DAC\t\t\t\t2\n#define SUN8I_SYS_SR_CTRL\t\t\t\t0x018\n#define SUN8I_SYS_SR_CTRL_AIF1_FS\t\t\t12\n#define SUN8I_SYS_SR_CTRL_AIF2_FS\t\t\t8\n#define SUN8I_AIF_CLK_CTRL(n)\t\t\t\t(0x040 * (1 + (n)))\n#define SUN8I_AIF_CLK_CTRL_MSTR_MOD\t\t\t15\n#define SUN8I_AIF_CLK_CTRL_CLK_INV\t\t\t13\n#define SUN8I_AIF_CLK_CTRL_BCLK_DIV\t\t\t9\n#define SUN8I_AIF_CLK_CTRL_LRCK_DIV\t\t\t6\n#define SUN8I_AIF_CLK_CTRL_WORD_SIZ\t\t\t4\n#define SUN8I_AIF_CLK_CTRL_DATA_FMT\t\t\t2\n#define SUN8I_AIF1_ADCDAT_CTRL\t\t\t\t0x044\n#define SUN8I_AIF1_ADCDAT_CTRL_AIF1_AD0L_ENA\t\t15\n#define SUN8I_AIF1_ADCDAT_CTRL_AIF1_AD0R_ENA\t\t14\n#define SUN8I_AIF1_ADCDAT_CTRL_AIF1_AD0L_SRC\t\t10\n#define SUN8I_AIF1_ADCDAT_CTRL_AIF1_AD0R_SRC\t\t8\n#define SUN8I_AIF1_DACDAT_CTRL\t\t\t\t0x048\n#define SUN8I_AIF1_DACDAT_CTRL_AIF1_DA0L_ENA\t\t15\n#define SUN8I_AIF1_DACDAT_CTRL_AIF1_DA0R_ENA\t\t14\n#define SUN8I_AIF1_DACDAT_CTRL_AIF1_DA0L_SRC\t\t10\n#define SUN8I_AIF1_DACDAT_CTRL_AIF1_DA0R_SRC\t\t8\n#define SUN8I_AIF1_MXR_SRC\t\t\t\t0x04c\n#define SUN8I_AIF1_MXR_SRC_AD0L_MXR_SRC_AIF1DA0L\t15\n#define SUN8I_AIF1_MXR_SRC_AD0L_MXR_SRC_AIF2DACL\t14\n#define SUN8I_AIF1_MXR_SRC_AD0L_MXR_SRC_ADCL\t\t13\n#define SUN8I_AIF1_MXR_SRC_AD0L_MXR_SRC_AIF2DACR\t12\n#define SUN8I_AIF1_MXR_SRC_AD0R_MXR_SRC_AIF1DA0R\t11\n#define SUN8I_AIF1_MXR_SRC_AD0R_MXR_SRC_AIF2DACR\t10\n#define SUN8I_AIF1_MXR_SRC_AD0R_MXR_SRC_ADCR\t\t9\n#define SUN8I_AIF1_MXR_SRC_AD0R_MXR_SRC_AIF2DACL\t8\n#define SUN8I_AIF1_VOL_CTRL1\t\t\t\t0x050\n#define SUN8I_AIF1_VOL_CTRL1_AD0L_VOL\t\t\t8\n#define SUN8I_AIF1_VOL_CTRL1_AD0R_VOL\t\t\t0\n#define SUN8I_AIF1_VOL_CTRL3\t\t\t\t0x058\n#define SUN8I_AIF1_VOL_CTRL3_DA0L_VOL\t\t\t8\n#define SUN8I_AIF1_VOL_CTRL3_DA0R_VOL\t\t\t0\n#define SUN8I_AIF2_ADCDAT_CTRL\t\t\t\t0x084\n#define SUN8I_AIF2_ADCDAT_CTRL_AIF2_ADCL_ENA\t\t15\n#define SUN8I_AIF2_ADCDAT_CTRL_AIF2_ADCR_ENA\t\t14\n#define SUN8I_AIF2_ADCDAT_CTRL_AIF2_ADCL_SRC\t\t10\n#define SUN8I_AIF2_ADCDAT_CTRL_AIF2_ADCR_SRC\t\t8\n#define SUN8I_AIF2_DACDAT_CTRL\t\t\t\t0x088\n#define SUN8I_AIF2_DACDAT_CTRL_AIF2_DACL_ENA\t\t15\n#define SUN8I_AIF2_DACDAT_CTRL_AIF2_DACR_ENA\t\t14\n#define SUN8I_AIF2_DACDAT_CTRL_AIF2_DACL_SRC\t\t10\n#define SUN8I_AIF2_DACDAT_CTRL_AIF2_DACR_SRC\t\t8\n#define SUN8I_AIF2_MXR_SRC\t\t\t\t0x08c\n#define SUN8I_AIF2_MXR_SRC_ADCL_MXR_SRC_AIF1DA0L\t15\n#define SUN8I_AIF2_MXR_SRC_ADCL_MXR_SRC_AIF1DA1L\t14\n#define SUN8I_AIF2_MXR_SRC_ADCL_MXR_SRC_AIF2DACR\t13\n#define SUN8I_AIF2_MXR_SRC_ADCL_MXR_SRC_ADCL\t\t12\n#define SUN8I_AIF2_MXR_SRC_ADCR_MXR_SRC_AIF1DA0R\t11\n#define SUN8I_AIF2_MXR_SRC_ADCR_MXR_SRC_AIF1DA1R\t10\n#define SUN8I_AIF2_MXR_SRC_ADCR_MXR_SRC_AIF2DACL\t9\n#define SUN8I_AIF2_MXR_SRC_ADCR_MXR_SRC_ADCR\t\t8\n#define SUN8I_AIF2_VOL_CTRL1\t\t\t\t0x090\n#define SUN8I_AIF2_VOL_CTRL1_ADCL_VOL\t\t\t8\n#define SUN8I_AIF2_VOL_CTRL1_ADCR_VOL\t\t\t0\n#define SUN8I_AIF2_VOL_CTRL2\t\t\t\t0x098\n#define SUN8I_AIF2_VOL_CTRL2_DACL_VOL\t\t\t8\n#define SUN8I_AIF2_VOL_CTRL2_DACR_VOL\t\t\t0\n#define SUN8I_AIF3_CLK_CTRL_AIF3_CLK_SRC_AIF1\t\t(0x0 << 0)\n#define SUN8I_AIF3_CLK_CTRL_AIF3_CLK_SRC_AIF2\t\t(0x1 << 0)\n#define SUN8I_AIF3_CLK_CTRL_AIF3_CLK_SRC_AIF1CLK\t(0x2 << 0)\n#define SUN8I_AIF3_PATH_CTRL\t\t\t\t0x0cc\n#define SUN8I_AIF3_PATH_CTRL_AIF3_ADC_SRC\t\t10\n#define SUN8I_AIF3_PATH_CTRL_AIF2_DAC_SRC\t\t8\n#define SUN8I_AIF3_PATH_CTRL_AIF3_PINS_TRI\t\t7\n#define SUN8I_ADC_DIG_CTRL\t\t\t\t0x100\n#define SUN8I_ADC_DIG_CTRL_ENAD\t\t\t\t15\n#define SUN8I_ADC_DIG_CTRL_ADOUT_DTS\t\t\t2\n#define SUN8I_ADC_DIG_CTRL_ADOUT_DLY\t\t\t1\n#define SUN8I_ADC_VOL_CTRL\t\t\t\t0x104\n#define SUN8I_ADC_VOL_CTRL_ADCL_VOL\t\t\t8\n#define SUN8I_ADC_VOL_CTRL_ADCR_VOL\t\t\t0\n#define SUN8I_DAC_DIG_CTRL\t\t\t\t0x120\n#define SUN8I_DAC_DIG_CTRL_ENDA\t\t\t\t15\n#define SUN8I_DAC_VOL_CTRL\t\t\t\t0x124\n#define SUN8I_DAC_VOL_CTRL_DACL_VOL\t\t\t8\n#define SUN8I_DAC_VOL_CTRL_DACR_VOL\t\t\t0\n#define SUN8I_DAC_MXR_SRC\t\t\t\t0x130\n#define SUN8I_DAC_MXR_SRC_DACL_MXR_SRC_AIF1DA0L\t\t15\n#define SUN8I_DAC_MXR_SRC_DACL_MXR_SRC_AIF1DA1L\t\t14\n#define SUN8I_DAC_MXR_SRC_DACL_MXR_SRC_AIF2DACL\t\t13\n#define SUN8I_DAC_MXR_SRC_DACL_MXR_SRC_ADCL\t\t12\n#define SUN8I_DAC_MXR_SRC_DACR_MXR_SRC_AIF1DA0R\t\t11\n#define SUN8I_DAC_MXR_SRC_DACR_MXR_SRC_AIF1DA1R\t\t10\n#define SUN8I_DAC_MXR_SRC_DACR_MXR_SRC_AIF2DACR\t\t9\n#define SUN8I_DAC_MXR_SRC_DACR_MXR_SRC_ADCR\t\t8\n\n#define SUN8I_SYSCLK_CTL_AIF1CLK_SRC_MASK\tGENMASK(9, 8)\n#define SUN8I_SYSCLK_CTL_AIF2CLK_SRC_MASK\tGENMASK(5, 4)\n#define SUN8I_SYS_SR_CTRL_AIF1_FS_MASK\t\tGENMASK(15, 12)\n#define SUN8I_SYS_SR_CTRL_AIF2_FS_MASK\t\tGENMASK(11, 8)\n#define SUN8I_AIF_CLK_CTRL_CLK_INV_MASK\t\tGENMASK(14, 13)\n#define SUN8I_AIF_CLK_CTRL_BCLK_DIV_MASK\tGENMASK(12, 9)\n#define SUN8I_AIF_CLK_CTRL_LRCK_DIV_MASK\tGENMASK(8, 6)\n#define SUN8I_AIF_CLK_CTRL_WORD_SIZ_MASK\tGENMASK(5, 4)\n#define SUN8I_AIF_CLK_CTRL_DATA_FMT_MASK\tGENMASK(3, 2)\n#define SUN8I_AIF3_CLK_CTRL_AIF3_CLK_SRC_MASK\tGENMASK(1, 0)\n\n#define SUN8I_CODEC_PASSTHROUGH_SAMPLE_RATE 48000\n\n#define SUN8I_CODEC_PCM_FORMATS\t(SNDRV_PCM_FMTBIT_S8     |\\\n\t\t\t\t SNDRV_PCM_FMTBIT_S16_LE |\\\n\t\t\t\t SNDRV_PCM_FMTBIT_S20_LE |\\\n\t\t\t\t SNDRV_PCM_FMTBIT_S24_LE |\\\n\t\t\t\t SNDRV_PCM_FMTBIT_S20_3LE|\\\n\t\t\t\t SNDRV_PCM_FMTBIT_S24_3LE)\n\n#define SUN8I_CODEC_PCM_RATES\t(SNDRV_PCM_RATE_8000_48000|\\\n\t\t\t\t SNDRV_PCM_RATE_88200     |\\\n\t\t\t\t SNDRV_PCM_RATE_96000     |\\\n\t\t\t\t SNDRV_PCM_RATE_176400    |\\\n\t\t\t\t SNDRV_PCM_RATE_192000    |\\\n\t\t\t\t SNDRV_PCM_RATE_KNOT)\n\nenum {\n\tSUN8I_CODEC_AIF1,\n\tSUN8I_CODEC_AIF2,\n\tSUN8I_CODEC_AIF3,\n\tSUN8I_CODEC_NAIFS\n};\n\nstruct sun8i_codec_aif {\n\tunsigned int\tlrck_div_order;\n\tunsigned int\tsample_rate;\n\tunsigned int\tslots;\n\tunsigned int\tslot_width;\n\tunsigned int\tactive_streams\t: 2;\n\tunsigned int\topen_streams\t: 2;\n};\n\nstruct sun8i_codec_quirks {\n\tbool legacy_widgets\t: 1;\n\tbool lrck_inversion\t: 1;\n};\n\nstruct sun8i_codec {\n\tstruct regmap\t\t\t*regmap;\n\tstruct clk\t\t\t*clk_module;\n\tconst struct sun8i_codec_quirks\t*quirks;\n\tstruct sun8i_codec_aif\t\taifs[SUN8I_CODEC_NAIFS];\n\tunsigned int\t\t\tsysclk_rate;\n\tint\t\t\t\tsysclk_refcnt;\n};\n\nstatic struct snd_soc_dai_driver sun8i_codec_dais[];\n\nstatic int sun8i_codec_runtime_resume(struct device *dev)\n{\n\tstruct sun8i_codec *scodec = dev_get_drvdata(dev);\n\tint ret;\n\n\tregcache_cache_only(scodec->regmap, false);\n\n\tret = regcache_sync(scodec->regmap);\n\tif (ret) {\n\t\tdev_err(dev, \"Failed to sync regmap cache\\n\");\n\t\treturn ret;\n\t}\n\n\treturn 0;\n}\n\nstatic int sun8i_codec_runtime_suspend(struct device *dev)\n{\n\tstruct sun8i_codec *scodec = dev_get_drvdata(dev);\n\n\tregcache_cache_only(scodec->regmap, true);\n\tregcache_mark_dirty(scodec->regmap);\n\n\treturn 0;\n}\n\nstatic int sun8i_codec_get_hw_rate(unsigned int sample_rate)\n{\n\tswitch (sample_rate) {\n\tcase 7350:\n\tcase 8000:\n\t\treturn 0x0;\n\tcase 11025:\n\t\treturn 0x1;\n\tcase 12000:\n\t\treturn 0x2;\n\tcase 14700:\n\tcase 16000:\n\t\treturn 0x3;\n\tcase 22050:\n\t\treturn 0x4;\n\tcase 24000:\n\t\treturn 0x5;\n\tcase 29400:\n\tcase 32000:\n\t\treturn 0x6;\n\tcase 44100:\n\t\treturn 0x7;\n\tcase 48000:\n\t\treturn 0x8;\n\tcase 88200:\n\tcase 96000:\n\t\treturn 0x9;\n\tcase 176400:\n\tcase 192000:\n\t\treturn 0xa;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n}\n\nstatic int sun8i_codec_update_sample_rate(struct sun8i_codec *scodec)\n{\n\tunsigned int max_rate = 0;\n\tint hw_rate, i;\n\n\tfor (i = SUN8I_CODEC_AIF1; i < SUN8I_CODEC_NAIFS; ++i) {\n\t\tstruct sun8i_codec_aif *aif = &scodec->aifs[i];\n\n\t\tif (aif->active_streams)\n\t\t\tmax_rate = max(max_rate, aif->sample_rate);\n\t}\n\n\t \n\tif (!max_rate)\n\t\tmax_rate = SUN8I_CODEC_PASSTHROUGH_SAMPLE_RATE;\n\n\thw_rate = sun8i_codec_get_hw_rate(max_rate);\n\tif (hw_rate < 0)\n\t\treturn hw_rate;\n\n\tregmap_update_bits(scodec->regmap, SUN8I_SYS_SR_CTRL,\n\t\t\t   SUN8I_SYS_SR_CTRL_AIF1_FS_MASK,\n\t\t\t   hw_rate << SUN8I_SYS_SR_CTRL_AIF1_FS);\n\n\treturn 0;\n}\n\nstatic int sun8i_codec_set_fmt(struct snd_soc_dai *dai, unsigned int fmt)\n{\n\tstruct sun8i_codec *scodec = snd_soc_dai_get_drvdata(dai);\n\tu32 dsp_format, format, invert, value;\n\n\t \n\tswitch (fmt & SND_SOC_DAIFMT_CLOCK_PROVIDER_MASK) {\n\tcase SND_SOC_DAIFMT_CBC_CFC:  \n\t\tvalue = 0x1;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_CBP_CFP:  \n\t\tvalue = 0x0;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tif (dai->id == SUN8I_CODEC_AIF3) {\n\t\t \n\t\tif (value)\n\t\t\treturn -EINVAL;\n\n\t\t \n\t\tregmap_update_bits(scodec->regmap, SUN8I_AIF_CLK_CTRL(dai->id),\n\t\t\t\t   SUN8I_AIF3_CLK_CTRL_AIF3_CLK_SRC_MASK,\n\t\t\t\t   SUN8I_AIF3_CLK_CTRL_AIF3_CLK_SRC_AIF2);\n\t} else {\n\t\tregmap_update_bits(scodec->regmap, SUN8I_AIF_CLK_CTRL(dai->id),\n\t\t\t\t   BIT(SUN8I_AIF_CLK_CTRL_MSTR_MOD),\n\t\t\t\t   value << SUN8I_AIF_CLK_CTRL_MSTR_MOD);\n\t}\n\n\t \n\tswitch (fmt & SND_SOC_DAIFMT_FORMAT_MASK) {\n\tcase SND_SOC_DAIFMT_I2S:\n\t\tformat = 0x0;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_LEFT_J:\n\t\tformat = 0x1;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_RIGHT_J:\n\t\tformat = 0x2;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_DSP_A:\n\t\tformat = 0x3;\n\t\tdsp_format = 0x0;  \n\t\tbreak;\n\tcase SND_SOC_DAIFMT_DSP_B:\n\t\tformat = 0x3;\n\t\tdsp_format = 0x1;  \n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tif (dai->id == SUN8I_CODEC_AIF3) {\n\t\t \n\t\tif (format != 3)\n\t\t\treturn -EINVAL;\n\t} else {\n\t\tregmap_update_bits(scodec->regmap, SUN8I_AIF_CLK_CTRL(dai->id),\n\t\t\t\t   SUN8I_AIF_CLK_CTRL_DATA_FMT_MASK,\n\t\t\t\t   format << SUN8I_AIF_CLK_CTRL_DATA_FMT);\n\t}\n\n\t \n\tswitch (fmt & SND_SOC_DAIFMT_INV_MASK) {\n\tcase SND_SOC_DAIFMT_NB_NF:  \n\t\tinvert = 0x0;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_NB_IF:  \n\t\tinvert = 0x1;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_IB_NF:  \n\t\tinvert = 0x2;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_IB_IF:  \n\t\tinvert = 0x3;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tif (format == 0x3) {\n\t\t \n\t\tif (invert & BIT(0))\n\t\t\treturn -EINVAL;\n\n\t\t \n\t\tinvert |= dsp_format;\n\t} else {\n\t\t \n\t\tinvert ^= scodec->quirks->lrck_inversion;\n\t}\n\n\tregmap_update_bits(scodec->regmap, SUN8I_AIF_CLK_CTRL(dai->id),\n\t\t\t   SUN8I_AIF_CLK_CTRL_CLK_INV_MASK,\n\t\t\t   invert << SUN8I_AIF_CLK_CTRL_CLK_INV);\n\n\treturn 0;\n}\n\nstatic int sun8i_codec_set_tdm_slot(struct snd_soc_dai *dai,\n\t\t\t\t    unsigned int tx_mask, unsigned int rx_mask,\n\t\t\t\t    int slots, int slot_width)\n{\n\tstruct sun8i_codec *scodec = snd_soc_dai_get_drvdata(dai);\n\tstruct sun8i_codec_aif *aif = &scodec->aifs[dai->id];\n\n\tif (slot_width && !is_power_of_2(slot_width))\n\t\treturn -EINVAL;\n\n\taif->slots = slots;\n\taif->slot_width = slot_width;\n\n\treturn 0;\n}\n\nstatic const unsigned int sun8i_codec_rates[] = {\n\t  7350,   8000,  11025,  12000,  14700,  16000,  22050,  24000,\n\t 29400,  32000,  44100,  48000,  88200,  96000, 176400, 192000,\n};\n\nstatic const struct snd_pcm_hw_constraint_list sun8i_codec_all_rates = {\n\t.list\t= sun8i_codec_rates,\n\t.count\t= ARRAY_SIZE(sun8i_codec_rates),\n};\n\nstatic const struct snd_pcm_hw_constraint_list sun8i_codec_22M_rates = {\n\t.list\t= sun8i_codec_rates,\n\t.count\t= ARRAY_SIZE(sun8i_codec_rates),\n\t.mask\t= 0x5555,\n};\n\nstatic const struct snd_pcm_hw_constraint_list sun8i_codec_24M_rates = {\n\t.list\t= sun8i_codec_rates,\n\t.count\t= ARRAY_SIZE(sun8i_codec_rates),\n\t.mask\t= 0xaaaa,\n};\n\nstatic int sun8i_codec_startup(struct snd_pcm_substream *substream,\n\t\t\t       struct snd_soc_dai *dai)\n{\n\tstruct sun8i_codec *scodec = snd_soc_dai_get_drvdata(dai);\n\tconst struct snd_pcm_hw_constraint_list *list;\n\n\t \n\tif (dai->id != SUN8I_CODEC_AIF1)\n\t\treturn 0;\n\n\tif (!scodec->sysclk_refcnt)\n\t\tlist = &sun8i_codec_all_rates;\n\telse if (scodec->sysclk_rate == 22579200)\n\t\tlist = &sun8i_codec_22M_rates;\n\telse if (scodec->sysclk_rate == 24576000)\n\t\tlist = &sun8i_codec_24M_rates;\n\telse\n\t\treturn -EINVAL;\n\n\treturn snd_pcm_hw_constraint_list(substream->runtime, 0,\n\t\t\t\t\t  SNDRV_PCM_HW_PARAM_RATE, list);\n}\n\nstruct sun8i_codec_clk_div {\n\tu8\tdiv;\n\tu8\tval;\n};\n\nstatic const struct sun8i_codec_clk_div sun8i_codec_bclk_div[] = {\n\t{ .div = 1,\t.val = 0 },\n\t{ .div = 2,\t.val = 1 },\n\t{ .div = 4,\t.val = 2 },\n\t{ .div = 6,\t.val = 3 },\n\t{ .div = 8,\t.val = 4 },\n\t{ .div = 12,\t.val = 5 },\n\t{ .div = 16,\t.val = 6 },\n\t{ .div = 24,\t.val = 7 },\n\t{ .div = 32,\t.val = 8 },\n\t{ .div = 48,\t.val = 9 },\n\t{ .div = 64,\t.val = 10 },\n\t{ .div = 96,\t.val = 11 },\n\t{ .div = 128,\t.val = 12 },\n\t{ .div = 192,\t.val = 13 },\n};\n\nstatic int sun8i_codec_get_bclk_div(unsigned int sysclk_rate,\n\t\t\t\t    unsigned int lrck_div_order,\n\t\t\t\t    unsigned int sample_rate)\n{\n\tunsigned int div = sysclk_rate / sample_rate >> lrck_div_order;\n\tint i;\n\n\tfor (i = 0; i < ARRAY_SIZE(sun8i_codec_bclk_div); i++) {\n\t\tconst struct sun8i_codec_clk_div *bdiv = &sun8i_codec_bclk_div[i];\n\n\t\tif (bdiv->div == div)\n\t\t\treturn bdiv->val;\n\t}\n\n\treturn -EINVAL;\n}\n\nstatic int sun8i_codec_get_lrck_div_order(unsigned int slots,\n\t\t\t\t\t  unsigned int slot_width)\n{\n\tunsigned int div = slots * slot_width;\n\n\tif (div < 16 || div > 256)\n\t\treturn -EINVAL;\n\n\treturn order_base_2(div);\n}\n\nstatic unsigned int sun8i_codec_get_sysclk_rate(unsigned int sample_rate)\n{\n\treturn (sample_rate % 4000) ? 22579200 : 24576000;\n}\n\nstatic int sun8i_codec_hw_params(struct snd_pcm_substream *substream,\n\t\t\t\t struct snd_pcm_hw_params *params,\n\t\t\t\t struct snd_soc_dai *dai)\n{\n\tstruct sun8i_codec *scodec = snd_soc_dai_get_drvdata(dai);\n\tstruct sun8i_codec_aif *aif = &scodec->aifs[dai->id];\n\tunsigned int sample_rate = params_rate(params);\n\tunsigned int slots = aif->slots ?: params_channels(params);\n\tunsigned int slot_width = aif->slot_width ?: params_width(params);\n\tunsigned int sysclk_rate = sun8i_codec_get_sysclk_rate(sample_rate);\n\tint bclk_div, lrck_div_order, ret, word_size;\n\tu32 clk_reg;\n\n\t \n\tswitch (params_width(params)) {\n\tcase 8:\n\t\tword_size = 0x0;\n\t\tbreak;\n\tcase 16:\n\t\tword_size = 0x1;\n\t\tbreak;\n\tcase 20:\n\t\tword_size = 0x2;\n\t\tbreak;\n\tcase 24:\n\t\tword_size = 0x3;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tregmap_update_bits(scodec->regmap, SUN8I_AIF_CLK_CTRL(dai->id),\n\t\t\t   SUN8I_AIF_CLK_CTRL_WORD_SIZ_MASK,\n\t\t\t   word_size << SUN8I_AIF_CLK_CTRL_WORD_SIZ);\n\n\t \n\tlrck_div_order = sun8i_codec_get_lrck_div_order(slots, slot_width);\n\tif (lrck_div_order < 0)\n\t\treturn lrck_div_order;\n\n\tif (dai->id == SUN8I_CODEC_AIF2 || dai->id == SUN8I_CODEC_AIF3) {\n\t\t \n\t\tint partner = (SUN8I_CODEC_AIF2 + SUN8I_CODEC_AIF3) - dai->id;\n\t\tconst struct sun8i_codec_aif *partner_aif = &scodec->aifs[partner];\n\t\tconst char *partner_name = sun8i_codec_dais[partner].name;\n\n\t\tif (partner_aif->open_streams &&\n\t\t    (lrck_div_order != partner_aif->lrck_div_order ||\n\t\t     sample_rate != partner_aif->sample_rate)) {\n\t\t\tdev_err(dai->dev,\n\t\t\t\t\"%s sample and bit rates must match %s when both are used\\n\",\n\t\t\t\tdai->name, partner_name);\n\t\t\treturn -EBUSY;\n\t\t}\n\n\t\tclk_reg = SUN8I_AIF_CLK_CTRL(SUN8I_CODEC_AIF2);\n\t} else {\n\t\tclk_reg = SUN8I_AIF_CLK_CTRL(dai->id);\n\t}\n\n\tregmap_update_bits(scodec->regmap, clk_reg,\n\t\t\t   SUN8I_AIF_CLK_CTRL_LRCK_DIV_MASK,\n\t\t\t   (lrck_div_order - 4) << SUN8I_AIF_CLK_CTRL_LRCK_DIV);\n\n\t \n\tbclk_div = sun8i_codec_get_bclk_div(sysclk_rate, lrck_div_order, sample_rate);\n\tif (bclk_div < 0)\n\t\treturn bclk_div;\n\n\tregmap_update_bits(scodec->regmap, clk_reg,\n\t\t\t   SUN8I_AIF_CLK_CTRL_BCLK_DIV_MASK,\n\t\t\t   bclk_div << SUN8I_AIF_CLK_CTRL_BCLK_DIV);\n\n\t \n\tret = (aif->open_streams ? clk_set_rate : clk_set_rate_exclusive)(scodec->clk_module,\n\t\t\t\t\t\t\t\t\t  sysclk_rate);\n\tif (ret == -EBUSY)\n\t\tdev_err(dai->dev,\n\t\t\t\"%s sample rate (%u Hz) conflicts with other audio streams\\n\",\n\t\t\tdai->name, sample_rate);\n\tif (ret < 0)\n\t\treturn ret;\n\n\tif (!aif->open_streams)\n\t\tscodec->sysclk_refcnt++;\n\tscodec->sysclk_rate = sysclk_rate;\n\n\taif->lrck_div_order = lrck_div_order;\n\taif->sample_rate = sample_rate;\n\taif->open_streams |= BIT(substream->stream);\n\n\treturn sun8i_codec_update_sample_rate(scodec);\n}\n\nstatic int sun8i_codec_hw_free(struct snd_pcm_substream *substream,\n\t\t\t       struct snd_soc_dai *dai)\n{\n\tstruct sun8i_codec *scodec = snd_soc_dai_get_drvdata(dai);\n\tstruct sun8i_codec_aif *aif = &scodec->aifs[dai->id];\n\n\t \n\tif (aif->open_streams != BIT(substream->stream))\n\t\tgoto done;\n\n\tclk_rate_exclusive_put(scodec->clk_module);\n\tscodec->sysclk_refcnt--;\n\taif->lrck_div_order = 0;\n\taif->sample_rate = 0;\n\ndone:\n\taif->open_streams &= ~BIT(substream->stream);\n\treturn 0;\n}\n\nstatic const struct snd_soc_dai_ops sun8i_codec_dai_ops = {\n\t.set_fmt\t= sun8i_codec_set_fmt,\n\t.set_tdm_slot\t= sun8i_codec_set_tdm_slot,\n\t.startup\t= sun8i_codec_startup,\n\t.hw_params\t= sun8i_codec_hw_params,\n\t.hw_free\t= sun8i_codec_hw_free,\n};\n\nstatic struct snd_soc_dai_driver sun8i_codec_dais[] = {\n\t{\n\t\t.name\t= \"sun8i-codec-aif1\",\n\t\t.id\t= SUN8I_CODEC_AIF1,\n\t\t.ops\t= &sun8i_codec_dai_ops,\n\t\t \n\t\t.capture = {\n\t\t\t.stream_name\t= \"AIF1 Capture\",\n\t\t\t.channels_min\t= 1,\n\t\t\t.channels_max\t= 2,\n\t\t\t.rates\t\t= SUN8I_CODEC_PCM_RATES,\n\t\t\t.formats\t= SUN8I_CODEC_PCM_FORMATS,\n\t\t\t.sig_bits\t= 24,\n\t\t},\n\t\t \n\t\t.playback = {\n\t\t\t.stream_name\t= \"AIF1 Playback\",\n\t\t\t.channels_min\t= 1,\n\t\t\t.channels_max\t= 2,\n\t\t\t.rates\t\t= SUN8I_CODEC_PCM_RATES,\n\t\t\t.formats\t= SUN8I_CODEC_PCM_FORMATS,\n\t\t},\n\t\t.symmetric_rate\t\t= true,\n\t\t.symmetric_channels\t= true,\n\t\t.symmetric_sample_bits\t= true,\n\t},\n\t{\n\t\t.name\t= \"sun8i-codec-aif2\",\n\t\t.id\t= SUN8I_CODEC_AIF2,\n\t\t.ops\t= &sun8i_codec_dai_ops,\n\t\t \n\t\t.capture = {\n\t\t\t.stream_name\t= \"AIF2 Capture\",\n\t\t\t.channels_min\t= 1,\n\t\t\t.channels_max\t= 2,\n\t\t\t.rates\t\t= SUN8I_CODEC_PCM_RATES,\n\t\t\t.formats\t= SUN8I_CODEC_PCM_FORMATS,\n\t\t\t.sig_bits\t= 24,\n\t\t},\n\t\t \n\t\t.playback = {\n\t\t\t.stream_name\t= \"AIF2 Playback\",\n\t\t\t.channels_min\t= 1,\n\t\t\t.channels_max\t= 2,\n\t\t\t.rates\t\t= SUN8I_CODEC_PCM_RATES,\n\t\t\t.formats\t= SUN8I_CODEC_PCM_FORMATS,\n\t\t},\n\t\t.symmetric_rate\t\t= true,\n\t\t.symmetric_channels\t= true,\n\t\t.symmetric_sample_bits\t= true,\n\t},\n\t{\n\t\t.name\t= \"sun8i-codec-aif3\",\n\t\t.id\t= SUN8I_CODEC_AIF3,\n\t\t.ops\t= &sun8i_codec_dai_ops,\n\t\t \n\t\t.capture = {\n\t\t\t.stream_name\t= \"AIF3 Capture\",\n\t\t\t.channels_min\t= 1,\n\t\t\t.channels_max\t= 1,\n\t\t\t.rates\t\t= SUN8I_CODEC_PCM_RATES,\n\t\t\t.formats\t= SUN8I_CODEC_PCM_FORMATS,\n\t\t\t.sig_bits\t= 24,\n\t\t},\n\t\t \n\t\t.playback = {\n\t\t\t.stream_name\t= \"AIF3 Playback\",\n\t\t\t.channels_min\t= 1,\n\t\t\t.channels_max\t= 1,\n\t\t\t.rates\t\t= SUN8I_CODEC_PCM_RATES,\n\t\t\t.formats\t= SUN8I_CODEC_PCM_FORMATS,\n\t\t},\n\t\t.symmetric_rate\t\t= true,\n\t\t.symmetric_channels\t= true,\n\t\t.symmetric_sample_bits\t= true,\n\t},\n};\n\nstatic const DECLARE_TLV_DB_SCALE(sun8i_codec_vol_scale, -12000, 75, 1);\n\nstatic const struct snd_kcontrol_new sun8i_codec_controls[] = {\n\tSOC_DOUBLE_TLV(\"AIF1 AD0 Capture Volume\",\n\t\t       SUN8I_AIF1_VOL_CTRL1,\n\t\t       SUN8I_AIF1_VOL_CTRL1_AD0L_VOL,\n\t\t       SUN8I_AIF1_VOL_CTRL1_AD0R_VOL,\n\t\t       0xc0, 0, sun8i_codec_vol_scale),\n\tSOC_DOUBLE_TLV(\"AIF1 DA0 Playback Volume\",\n\t\t       SUN8I_AIF1_VOL_CTRL3,\n\t\t       SUN8I_AIF1_VOL_CTRL3_DA0L_VOL,\n\t\t       SUN8I_AIF1_VOL_CTRL3_DA0R_VOL,\n\t\t       0xc0, 0, sun8i_codec_vol_scale),\n\tSOC_DOUBLE_TLV(\"AIF2 ADC Capture Volume\",\n\t\t       SUN8I_AIF2_VOL_CTRL1,\n\t\t       SUN8I_AIF2_VOL_CTRL1_ADCL_VOL,\n\t\t       SUN8I_AIF2_VOL_CTRL1_ADCR_VOL,\n\t\t       0xc0, 0, sun8i_codec_vol_scale),\n\tSOC_DOUBLE_TLV(\"AIF2 DAC Playback Volume\",\n\t\t       SUN8I_AIF2_VOL_CTRL2,\n\t\t       SUN8I_AIF2_VOL_CTRL2_DACL_VOL,\n\t\t       SUN8I_AIF2_VOL_CTRL2_DACR_VOL,\n\t\t       0xc0, 0, sun8i_codec_vol_scale),\n\tSOC_DOUBLE_TLV(\"ADC Capture Volume\",\n\t\t       SUN8I_ADC_VOL_CTRL,\n\t\t       SUN8I_ADC_VOL_CTRL_ADCL_VOL,\n\t\t       SUN8I_ADC_VOL_CTRL_ADCR_VOL,\n\t\t       0xc0, 0, sun8i_codec_vol_scale),\n\tSOC_DOUBLE_TLV(\"DAC Playback Volume\",\n\t\t       SUN8I_DAC_VOL_CTRL,\n\t\t       SUN8I_DAC_VOL_CTRL_DACL_VOL,\n\t\t       SUN8I_DAC_VOL_CTRL_DACR_VOL,\n\t\t       0xc0, 0, sun8i_codec_vol_scale),\n};\n\nstatic int sun8i_codec_aif_event(struct snd_soc_dapm_widget *w,\n\t\t\t\t struct snd_kcontrol *kcontrol, int event)\n{\n\tstruct snd_soc_component *component = snd_soc_dapm_to_component(w->dapm);\n\tstruct sun8i_codec *scodec = snd_soc_component_get_drvdata(component);\n\tstruct sun8i_codec_aif *aif = &scodec->aifs[w->sname[3] - '1'];\n\tint stream = w->id == snd_soc_dapm_aif_out;\n\n\tif (SND_SOC_DAPM_EVENT_ON(event))\n\t\taif->active_streams |= BIT(stream);\n\telse\n\t\taif->active_streams &= ~BIT(stream);\n\n\treturn sun8i_codec_update_sample_rate(scodec);\n}\n\nstatic const char *const sun8i_aif_stereo_mux_enum_values[] = {\n\t\"Stereo\", \"Reverse Stereo\", \"Sum Mono\", \"Mix Mono\"\n};\n\nstatic SOC_ENUM_DOUBLE_DECL(sun8i_aif1_ad0_stereo_mux_enum,\n\t\t\t    SUN8I_AIF1_ADCDAT_CTRL,\n\t\t\t    SUN8I_AIF1_ADCDAT_CTRL_AIF1_AD0L_SRC,\n\t\t\t    SUN8I_AIF1_ADCDAT_CTRL_AIF1_AD0R_SRC,\n\t\t\t    sun8i_aif_stereo_mux_enum_values);\n\nstatic const struct snd_kcontrol_new sun8i_aif1_ad0_stereo_mux_control =\n\tSOC_DAPM_ENUM(\"AIF1 AD0 Stereo Capture Route\",\n\t\t      sun8i_aif1_ad0_stereo_mux_enum);\n\nstatic SOC_ENUM_DOUBLE_DECL(sun8i_aif2_adc_stereo_mux_enum,\n\t\t\t    SUN8I_AIF2_ADCDAT_CTRL,\n\t\t\t    SUN8I_AIF2_ADCDAT_CTRL_AIF2_ADCL_SRC,\n\t\t\t    SUN8I_AIF2_ADCDAT_CTRL_AIF2_ADCR_SRC,\n\t\t\t    sun8i_aif_stereo_mux_enum_values);\n\nstatic const struct snd_kcontrol_new sun8i_aif2_adc_stereo_mux_control =\n\tSOC_DAPM_ENUM(\"AIF2 ADC Stereo Capture Route\",\n\t\t      sun8i_aif2_adc_stereo_mux_enum);\n\nstatic const char *const sun8i_aif3_adc_mux_enum_values[] = {\n\t\"None\", \"AIF2 ADCL\", \"AIF2 ADCR\"\n};\n\nstatic SOC_ENUM_SINGLE_DECL(sun8i_aif3_adc_mux_enum,\n\t\t\t    SUN8I_AIF3_PATH_CTRL,\n\t\t\t    SUN8I_AIF3_PATH_CTRL_AIF3_ADC_SRC,\n\t\t\t    sun8i_aif3_adc_mux_enum_values);\n\nstatic const struct snd_kcontrol_new sun8i_aif3_adc_mux_control =\n\tSOC_DAPM_ENUM(\"AIF3 ADC Source Capture Route\",\n\t\t      sun8i_aif3_adc_mux_enum);\n\nstatic const struct snd_kcontrol_new sun8i_aif1_ad0_mixer_controls[] = {\n\tSOC_DAPM_DOUBLE(\"AIF1 Slot 0 Digital ADC Capture Switch\",\n\t\t\tSUN8I_AIF1_MXR_SRC,\n\t\t\tSUN8I_AIF1_MXR_SRC_AD0L_MXR_SRC_AIF1DA0L,\n\t\t\tSUN8I_AIF1_MXR_SRC_AD0R_MXR_SRC_AIF1DA0R, 1, 0),\n\tSOC_DAPM_DOUBLE(\"AIF2 Digital ADC Capture Switch\",\n\t\t\tSUN8I_AIF1_MXR_SRC,\n\t\t\tSUN8I_AIF1_MXR_SRC_AD0L_MXR_SRC_AIF2DACL,\n\t\t\tSUN8I_AIF1_MXR_SRC_AD0R_MXR_SRC_AIF2DACR, 1, 0),\n\tSOC_DAPM_DOUBLE(\"AIF1 Data Digital ADC Capture Switch\",\n\t\t\tSUN8I_AIF1_MXR_SRC,\n\t\t\tSUN8I_AIF1_MXR_SRC_AD0L_MXR_SRC_ADCL,\n\t\t\tSUN8I_AIF1_MXR_SRC_AD0R_MXR_SRC_ADCR, 1, 0),\n\tSOC_DAPM_DOUBLE(\"AIF2 Inv Digital ADC Capture Switch\",\n\t\t\tSUN8I_AIF1_MXR_SRC,\n\t\t\tSUN8I_AIF1_MXR_SRC_AD0L_MXR_SRC_AIF2DACR,\n\t\t\tSUN8I_AIF1_MXR_SRC_AD0R_MXR_SRC_AIF2DACL, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new sun8i_aif2_adc_mixer_controls[] = {\n\tSOC_DAPM_DOUBLE(\"AIF2 ADC Mixer AIF1 DA0 Capture Switch\",\n\t\t\tSUN8I_AIF2_MXR_SRC,\n\t\t\tSUN8I_AIF2_MXR_SRC_ADCL_MXR_SRC_AIF1DA0L,\n\t\t\tSUN8I_AIF2_MXR_SRC_ADCR_MXR_SRC_AIF1DA0R, 1, 0),\n\tSOC_DAPM_DOUBLE(\"AIF2 ADC Mixer AIF1 DA1 Capture Switch\",\n\t\t\tSUN8I_AIF2_MXR_SRC,\n\t\t\tSUN8I_AIF2_MXR_SRC_ADCL_MXR_SRC_AIF1DA1L,\n\t\t\tSUN8I_AIF2_MXR_SRC_ADCR_MXR_SRC_AIF1DA1R, 1, 0),\n\tSOC_DAPM_DOUBLE(\"AIF2 ADC Mixer AIF2 DAC Rev Capture Switch\",\n\t\t\tSUN8I_AIF2_MXR_SRC,\n\t\t\tSUN8I_AIF2_MXR_SRC_ADCL_MXR_SRC_AIF2DACR,\n\t\t\tSUN8I_AIF2_MXR_SRC_ADCR_MXR_SRC_AIF2DACL, 1, 0),\n\tSOC_DAPM_DOUBLE(\"AIF2 ADC Mixer ADC Capture Switch\",\n\t\t\tSUN8I_AIF2_MXR_SRC,\n\t\t\tSUN8I_AIF2_MXR_SRC_ADCL_MXR_SRC_ADCL,\n\t\t\tSUN8I_AIF2_MXR_SRC_ADCR_MXR_SRC_ADCR, 1, 0),\n};\n\nstatic const char *const sun8i_aif2_dac_mux_enum_values[] = {\n\t\"AIF2\", \"AIF3+2\", \"AIF2+3\"\n};\n\nstatic SOC_ENUM_SINGLE_DECL(sun8i_aif2_dac_mux_enum,\n\t\t\t    SUN8I_AIF3_PATH_CTRL,\n\t\t\t    SUN8I_AIF3_PATH_CTRL_AIF2_DAC_SRC,\n\t\t\t    sun8i_aif2_dac_mux_enum_values);\n\nstatic const struct snd_kcontrol_new sun8i_aif2_dac_mux_control =\n\tSOC_DAPM_ENUM(\"AIF2 DAC Source Playback Route\",\n\t\t      sun8i_aif2_dac_mux_enum);\n\nstatic SOC_ENUM_DOUBLE_DECL(sun8i_aif1_da0_stereo_mux_enum,\n\t\t\t    SUN8I_AIF1_DACDAT_CTRL,\n\t\t\t    SUN8I_AIF1_DACDAT_CTRL_AIF1_DA0L_SRC,\n\t\t\t    SUN8I_AIF1_DACDAT_CTRL_AIF1_DA0R_SRC,\n\t\t\t    sun8i_aif_stereo_mux_enum_values);\n\nstatic const struct snd_kcontrol_new sun8i_aif1_da0_stereo_mux_control =\n\tSOC_DAPM_ENUM(\"AIF1 DA0 Stereo Playback Route\",\n\t\t      sun8i_aif1_da0_stereo_mux_enum);\n\nstatic SOC_ENUM_DOUBLE_DECL(sun8i_aif2_dac_stereo_mux_enum,\n\t\t\t    SUN8I_AIF2_DACDAT_CTRL,\n\t\t\t    SUN8I_AIF2_DACDAT_CTRL_AIF2_DACL_SRC,\n\t\t\t    SUN8I_AIF2_DACDAT_CTRL_AIF2_DACR_SRC,\n\t\t\t    sun8i_aif_stereo_mux_enum_values);\n\nstatic const struct snd_kcontrol_new sun8i_aif2_dac_stereo_mux_control =\n\tSOC_DAPM_ENUM(\"AIF2 DAC Stereo Playback Route\",\n\t\t      sun8i_aif2_dac_stereo_mux_enum);\n\nstatic const struct snd_kcontrol_new sun8i_dac_mixer_controls[] = {\n\tSOC_DAPM_DOUBLE(\"AIF1 Slot 0 Digital DAC Playback Switch\",\n\t\t\tSUN8I_DAC_MXR_SRC,\n\t\t\tSUN8I_DAC_MXR_SRC_DACL_MXR_SRC_AIF1DA0L,\n\t\t\tSUN8I_DAC_MXR_SRC_DACR_MXR_SRC_AIF1DA0R, 1, 0),\n\tSOC_DAPM_DOUBLE(\"AIF1 Slot 1 Digital DAC Playback Switch\",\n\t\t\tSUN8I_DAC_MXR_SRC,\n\t\t\tSUN8I_DAC_MXR_SRC_DACL_MXR_SRC_AIF1DA1L,\n\t\t\tSUN8I_DAC_MXR_SRC_DACR_MXR_SRC_AIF1DA1R, 1, 0),\n\tSOC_DAPM_DOUBLE(\"AIF2 Digital DAC Playback Switch\", SUN8I_DAC_MXR_SRC,\n\t\t\tSUN8I_DAC_MXR_SRC_DACL_MXR_SRC_AIF2DACL,\n\t\t\tSUN8I_DAC_MXR_SRC_DACR_MXR_SRC_AIF2DACR, 1, 0),\n\tSOC_DAPM_DOUBLE(\"ADC Digital DAC Playback Switch\", SUN8I_DAC_MXR_SRC,\n\t\t\tSUN8I_DAC_MXR_SRC_DACL_MXR_SRC_ADCL,\n\t\t\tSUN8I_DAC_MXR_SRC_DACR_MXR_SRC_ADCR, 1, 0),\n};\n\nstatic const struct snd_soc_dapm_widget sun8i_codec_dapm_widgets[] = {\n\t \n\tSND_SOC_DAPM_CLOCK_SUPPLY(\"mod\"),\n\n\tSND_SOC_DAPM_SUPPLY(\"AIF1CLK\",\n\t\t\t    SUN8I_SYSCLK_CTL,\n\t\t\t    SUN8I_SYSCLK_CTL_AIF1CLK_ENA, 0, NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"AIF2CLK\",\n\t\t\t    SUN8I_SYSCLK_CTL,\n\t\t\t    SUN8I_SYSCLK_CTL_AIF2CLK_ENA, 0, NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"SYSCLK\",\n\t\t\t    SUN8I_SYSCLK_CTL,\n\t\t\t    SUN8I_SYSCLK_CTL_SYSCLK_ENA, 0, NULL, 0),\n\n\t \n\tSND_SOC_DAPM_SUPPLY(\"CLK AIF1\",\n\t\t\t    SUN8I_MOD_CLK_ENA,\n\t\t\t    SUN8I_MOD_CLK_ENA_AIF1, 0, NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"CLK AIF2\",\n\t\t\t    SUN8I_MOD_CLK_ENA,\n\t\t\t    SUN8I_MOD_CLK_ENA_AIF2, 0, NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"CLK AIF3\",\n\t\t\t    SUN8I_MOD_CLK_ENA,\n\t\t\t    SUN8I_MOD_CLK_ENA_AIF3, 0, NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"CLK ADC\",\n\t\t\t    SUN8I_MOD_CLK_ENA,\n\t\t\t    SUN8I_MOD_CLK_ENA_ADC, 0, NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"CLK DAC\",\n\t\t\t    SUN8I_MOD_CLK_ENA,\n\t\t\t    SUN8I_MOD_CLK_ENA_DAC, 0, NULL, 0),\n\n\t \n\tSND_SOC_DAPM_SUPPLY(\"RST AIF1\",\n\t\t\t    SUN8I_MOD_RST_CTL,\n\t\t\t    SUN8I_MOD_RST_CTL_AIF1, 0, NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"RST AIF2\",\n\t\t\t    SUN8I_MOD_RST_CTL,\n\t\t\t    SUN8I_MOD_RST_CTL_AIF2, 0, NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"RST AIF3\",\n\t\t\t    SUN8I_MOD_RST_CTL,\n\t\t\t    SUN8I_MOD_RST_CTL_AIF3, 0, NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"RST ADC\",\n\t\t\t    SUN8I_MOD_RST_CTL,\n\t\t\t    SUN8I_MOD_RST_CTL_ADC, 0, NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"RST DAC\",\n\t\t\t    SUN8I_MOD_RST_CTL,\n\t\t\t    SUN8I_MOD_RST_CTL_DAC, 0, NULL, 0),\n\n\t \n\tSND_SOC_DAPM_SUPPLY(\"ADC\",\n\t\t\t    SUN8I_ADC_DIG_CTRL,\n\t\t\t    SUN8I_ADC_DIG_CTRL_ENAD, 0, NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"DAC\",\n\t\t\t    SUN8I_DAC_DIG_CTRL,\n\t\t\t    SUN8I_DAC_DIG_CTRL_ENDA, 0, NULL, 0),\n\n\t \n\tSND_SOC_DAPM_AIF_OUT_E(\"AIF1 AD0L\", \"AIF1 Capture\", 0,\n\t\t\t       SUN8I_AIF1_ADCDAT_CTRL,\n\t\t\t       SUN8I_AIF1_ADCDAT_CTRL_AIF1_AD0L_ENA, 0,\n\t\t\t       sun8i_codec_aif_event,\n\t\t\t       SND_SOC_DAPM_PRE_PMU | SND_SOC_DAPM_POST_PMD),\n\tSND_SOC_DAPM_AIF_OUT(\"AIF1 AD0R\", \"AIF1 Capture\", 1,\n\t\t\t     SUN8I_AIF1_ADCDAT_CTRL,\n\t\t\t     SUN8I_AIF1_ADCDAT_CTRL_AIF1_AD0R_ENA, 0),\n\n\tSND_SOC_DAPM_AIF_OUT_E(\"AIF2 ADCL\", \"AIF2 Capture\", 0,\n\t\t\t       SUN8I_AIF2_ADCDAT_CTRL,\n\t\t\t       SUN8I_AIF2_ADCDAT_CTRL_AIF2_ADCL_ENA, 0,\n\t\t\t       sun8i_codec_aif_event,\n\t\t\t       SND_SOC_DAPM_PRE_PMU | SND_SOC_DAPM_POST_PMD),\n\tSND_SOC_DAPM_AIF_OUT(\"AIF2 ADCR\", \"AIF2 Capture\", 1,\n\t\t\t     SUN8I_AIF2_ADCDAT_CTRL,\n\t\t\t     SUN8I_AIF2_ADCDAT_CTRL_AIF2_ADCR_ENA, 0),\n\n\tSND_SOC_DAPM_AIF_OUT_E(\"AIF3 ADC\", \"AIF3 Capture\", 0,\n\t\t\t       SND_SOC_NOPM, 0, 0,\n\t\t\t       sun8i_codec_aif_event,\n\t\t\t       SND_SOC_DAPM_PRE_PMU | SND_SOC_DAPM_POST_PMD),\n\n\t \n\tSND_SOC_DAPM_MUX(\"AIF1 AD0L Stereo Mux\", SND_SOC_NOPM, 0, 0,\n\t\t\t &sun8i_aif1_ad0_stereo_mux_control),\n\tSND_SOC_DAPM_MUX(\"AIF1 AD0R Stereo Mux\", SND_SOC_NOPM, 0, 0,\n\t\t\t &sun8i_aif1_ad0_stereo_mux_control),\n\n\tSND_SOC_DAPM_MUX(\"AIF2 ADCL Stereo Mux\", SND_SOC_NOPM, 0, 0,\n\t\t\t &sun8i_aif2_adc_stereo_mux_control),\n\tSND_SOC_DAPM_MUX(\"AIF2 ADCR Stereo Mux\", SND_SOC_NOPM, 0, 0,\n\t\t\t &sun8i_aif2_adc_stereo_mux_control),\n\n\t \n\tSND_SOC_DAPM_MUX(\"AIF3 ADC Source Capture Route\", SND_SOC_NOPM, 0, 0,\n\t\t\t &sun8i_aif3_adc_mux_control),\n\n\t \n\tSOC_MIXER_ARRAY(\"AIF1 AD0L Mixer\", SND_SOC_NOPM, 0, 0,\n\t\t\tsun8i_aif1_ad0_mixer_controls),\n\tSOC_MIXER_ARRAY(\"AIF1 AD0R Mixer\", SND_SOC_NOPM, 0, 0,\n\t\t\tsun8i_aif1_ad0_mixer_controls),\n\n\tSOC_MIXER_ARRAY(\"AIF2 ADCL Mixer\", SND_SOC_NOPM, 0, 0,\n\t\t\tsun8i_aif2_adc_mixer_controls),\n\tSOC_MIXER_ARRAY(\"AIF2 ADCR Mixer\", SND_SOC_NOPM, 0, 0,\n\t\t\tsun8i_aif2_adc_mixer_controls),\n\n\t \n\tSND_SOC_DAPM_MUX(\"AIF2 DACL Source\", SND_SOC_NOPM, 0, 0,\n\t\t\t &sun8i_aif2_dac_mux_control),\n\tSND_SOC_DAPM_MUX(\"AIF2 DACR Source\", SND_SOC_NOPM, 0, 0,\n\t\t\t &sun8i_aif2_dac_mux_control),\n\n\t \n\tSND_SOC_DAPM_MUX(\"AIF1 DA0L Stereo Mux\", SND_SOC_NOPM, 0, 0,\n\t\t\t &sun8i_aif1_da0_stereo_mux_control),\n\tSND_SOC_DAPM_MUX(\"AIF1 DA0R Stereo Mux\", SND_SOC_NOPM, 0, 0,\n\t\t\t &sun8i_aif1_da0_stereo_mux_control),\n\n\tSND_SOC_DAPM_MUX(\"AIF2 DACL Stereo Mux\", SND_SOC_NOPM, 0, 0,\n\t\t\t &sun8i_aif2_dac_stereo_mux_control),\n\tSND_SOC_DAPM_MUX(\"AIF2 DACR Stereo Mux\", SND_SOC_NOPM, 0, 0,\n\t\t\t &sun8i_aif2_dac_stereo_mux_control),\n\n\t \n\tSND_SOC_DAPM_AIF_IN_E(\"AIF1 DA0L\", \"AIF1 Playback\", 0,\n\t\t\t      SUN8I_AIF1_DACDAT_CTRL,\n\t\t\t      SUN8I_AIF1_DACDAT_CTRL_AIF1_DA0L_ENA, 0,\n\t\t\t      sun8i_codec_aif_event,\n\t\t\t      SND_SOC_DAPM_PRE_PMU | SND_SOC_DAPM_POST_PMD),\n\tSND_SOC_DAPM_AIF_IN(\"AIF1 DA0R\", \"AIF1 Playback\", 1,\n\t\t\t    SUN8I_AIF1_DACDAT_CTRL,\n\t\t\t    SUN8I_AIF1_DACDAT_CTRL_AIF1_DA0R_ENA, 0),\n\n\tSND_SOC_DAPM_AIF_IN_E(\"AIF2 DACL\", \"AIF2 Playback\", 0,\n\t\t\t      SUN8I_AIF2_DACDAT_CTRL,\n\t\t\t      SUN8I_AIF2_DACDAT_CTRL_AIF2_DACL_ENA, 0,\n\t\t\t      sun8i_codec_aif_event,\n\t\t\t      SND_SOC_DAPM_PRE_PMU | SND_SOC_DAPM_POST_PMD),\n\tSND_SOC_DAPM_AIF_IN(\"AIF2 DACR\", \"AIF2 Playback\", 1,\n\t\t\t    SUN8I_AIF2_DACDAT_CTRL,\n\t\t\t    SUN8I_AIF2_DACDAT_CTRL_AIF2_DACR_ENA, 0),\n\n\tSND_SOC_DAPM_AIF_IN_E(\"AIF3 DAC\", \"AIF3 Playback\", 0,\n\t\t\t      SND_SOC_NOPM, 0, 0,\n\t\t\t      sun8i_codec_aif_event,\n\t\t\t      SND_SOC_DAPM_PRE_PMU | SND_SOC_DAPM_POST_PMD),\n\n\t \n\tSND_SOC_DAPM_ADC(\"ADCL\", NULL, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_ADC(\"ADCR\", NULL, SND_SOC_NOPM, 0, 0),\n\n\t \n\tSND_SOC_DAPM_DAC(\"DACL\", NULL, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_DAC(\"DACR\", NULL, SND_SOC_NOPM, 0, 0),\n\n\t \n\tSOC_MIXER_ARRAY(\"DACL Mixer\", SND_SOC_NOPM, 0, 0,\n\t\t\tsun8i_dac_mixer_controls),\n\tSOC_MIXER_ARRAY(\"DACR Mixer\", SND_SOC_NOPM, 0, 0,\n\t\t\tsun8i_dac_mixer_controls),\n};\n\nstatic const struct snd_soc_dapm_route sun8i_codec_dapm_routes[] = {\n\t \n\t{ \"AIF1CLK\", NULL, \"mod\" },\n\n\t{ \"SYSCLK\", NULL, \"AIF1CLK\" },\n\n\t{ \"CLK AIF1\", NULL, \"AIF1CLK\" },\n\t{ \"CLK AIF1\", NULL, \"SYSCLK\" },\n\t{ \"RST AIF1\", NULL, \"CLK AIF1\" },\n\t{ \"AIF1 AD0L\", NULL, \"RST AIF1\" },\n\t{ \"AIF1 AD0R\", NULL, \"RST AIF1\" },\n\t{ \"AIF1 DA0L\", NULL, \"RST AIF1\" },\n\t{ \"AIF1 DA0R\", NULL, \"RST AIF1\" },\n\n\t{ \"CLK AIF2\", NULL, \"AIF2CLK\" },\n\t{ \"CLK AIF2\", NULL, \"SYSCLK\" },\n\t{ \"RST AIF2\", NULL, \"CLK AIF2\" },\n\t{ \"AIF2 ADCL\", NULL, \"RST AIF2\" },\n\t{ \"AIF2 ADCR\", NULL, \"RST AIF2\" },\n\t{ \"AIF2 DACL\", NULL, \"RST AIF2\" },\n\t{ \"AIF2 DACR\", NULL, \"RST AIF2\" },\n\n\t{ \"CLK AIF3\", NULL, \"AIF1CLK\" },\n\t{ \"CLK AIF3\", NULL, \"SYSCLK\" },\n\t{ \"RST AIF3\", NULL, \"CLK AIF3\" },\n\t{ \"AIF3 ADC\", NULL, \"RST AIF3\" },\n\t{ \"AIF3 DAC\", NULL, \"RST AIF3\" },\n\n\t{ \"CLK ADC\", NULL, \"SYSCLK\" },\n\t{ \"RST ADC\", NULL, \"CLK ADC\" },\n\t{ \"ADC\", NULL, \"RST ADC\" },\n\t{ \"ADCL\", NULL, \"ADC\" },\n\t{ \"ADCR\", NULL, \"ADC\" },\n\n\t{ \"CLK DAC\", NULL, \"SYSCLK\" },\n\t{ \"RST DAC\", NULL, \"CLK DAC\" },\n\t{ \"DAC\", NULL, \"RST DAC\" },\n\t{ \"DACL\", NULL, \"DAC\" },\n\t{ \"DACR\", NULL, \"DAC\" },\n\n\t \n\t{ \"AIF1 AD0L\", NULL, \"AIF1 AD0L Stereo Mux\" },\n\t{ \"AIF1 AD0R\", NULL, \"AIF1 AD0R Stereo Mux\" },\n\n\t{ \"AIF2 ADCL\", NULL, \"AIF2 ADCL Stereo Mux\" },\n\t{ \"AIF2 ADCR\", NULL, \"AIF2 ADCR Stereo Mux\" },\n\n\t{ \"AIF3 ADC\", NULL, \"AIF3 ADC Source Capture Route\" },\n\n\t \n\t{ \"AIF1 AD0L Stereo Mux\", \"Stereo\", \"AIF1 AD0L Mixer\" },\n\t{ \"AIF1 AD0L Stereo Mux\", \"Reverse Stereo\", \"AIF1 AD0R Mixer\" },\n\t{ \"AIF1 AD0L Stereo Mux\", \"Sum Mono\", \"AIF1 AD0L Mixer\" },\n\t{ \"AIF1 AD0L Stereo Mux\", \"Sum Mono\", \"AIF1 AD0R Mixer\" },\n\t{ \"AIF1 AD0L Stereo Mux\", \"Mix Mono\", \"AIF1 AD0L Mixer\" },\n\t{ \"AIF1 AD0L Stereo Mux\", \"Mix Mono\", \"AIF1 AD0R Mixer\" },\n\n\t{ \"AIF1 AD0R Stereo Mux\", \"Stereo\", \"AIF1 AD0R Mixer\" },\n\t{ \"AIF1 AD0R Stereo Mux\", \"Reverse Stereo\", \"AIF1 AD0L Mixer\" },\n\t{ \"AIF1 AD0R Stereo Mux\", \"Sum Mono\", \"AIF1 AD0L Mixer\" },\n\t{ \"AIF1 AD0R Stereo Mux\", \"Sum Mono\", \"AIF1 AD0R Mixer\" },\n\t{ \"AIF1 AD0R Stereo Mux\", \"Mix Mono\", \"AIF1 AD0L Mixer\" },\n\t{ \"AIF1 AD0R Stereo Mux\", \"Mix Mono\", \"AIF1 AD0R Mixer\" },\n\n\t{ \"AIF2 ADCL Stereo Mux\", \"Stereo\", \"AIF2 ADCL Mixer\" },\n\t{ \"AIF2 ADCL Stereo Mux\", \"Reverse Stereo\", \"AIF2 ADCR Mixer\" },\n\t{ \"AIF2 ADCL Stereo Mux\", \"Sum Mono\", \"AIF2 ADCL Mixer\" },\n\t{ \"AIF2 ADCL Stereo Mux\", \"Sum Mono\", \"AIF2 ADCR Mixer\" },\n\t{ \"AIF2 ADCL Stereo Mux\", \"Mix Mono\", \"AIF2 ADCL Mixer\" },\n\t{ \"AIF2 ADCL Stereo Mux\", \"Mix Mono\", \"AIF2 ADCR Mixer\" },\n\n\t{ \"AIF2 ADCR Stereo Mux\", \"Stereo\", \"AIF2 ADCR Mixer\" },\n\t{ \"AIF2 ADCR Stereo Mux\", \"Reverse Stereo\", \"AIF2 ADCL Mixer\" },\n\t{ \"AIF2 ADCR Stereo Mux\", \"Sum Mono\", \"AIF2 ADCL Mixer\" },\n\t{ \"AIF2 ADCR Stereo Mux\", \"Sum Mono\", \"AIF2 ADCR Mixer\" },\n\t{ \"AIF2 ADCR Stereo Mux\", \"Mix Mono\", \"AIF2 ADCL Mixer\" },\n\t{ \"AIF2 ADCR Stereo Mux\", \"Mix Mono\", \"AIF2 ADCR Mixer\" },\n\n\t \n\t{ \"AIF3 ADC Source Capture Route\", \"AIF2 ADCL\", \"AIF2 ADCL Mixer\" },\n\t{ \"AIF3 ADC Source Capture Route\", \"AIF2 ADCR\", \"AIF2 ADCR Mixer\" },\n\n\t \n\t{ \"AIF1 AD0L Mixer\", \"AIF1 Slot 0 Digital ADC Capture Switch\", \"AIF1 DA0L Stereo Mux\" },\n\t{ \"AIF1 AD0L Mixer\", \"AIF2 Digital ADC Capture Switch\", \"AIF2 DACL Source\" },\n\t{ \"AIF1 AD0L Mixer\", \"AIF1 Data Digital ADC Capture Switch\", \"ADCL\" },\n\t{ \"AIF1 AD0L Mixer\", \"AIF2 Inv Digital ADC Capture Switch\", \"AIF2 DACR Source\" },\n\n\t{ \"AIF1 AD0R Mixer\", \"AIF1 Slot 0 Digital ADC Capture Switch\", \"AIF1 DA0R Stereo Mux\" },\n\t{ \"AIF1 AD0R Mixer\", \"AIF2 Digital ADC Capture Switch\", \"AIF2 DACR Source\" },\n\t{ \"AIF1 AD0R Mixer\", \"AIF1 Data Digital ADC Capture Switch\", \"ADCR\" },\n\t{ \"AIF1 AD0R Mixer\", \"AIF2 Inv Digital ADC Capture Switch\", \"AIF2 DACL Source\" },\n\n\t{ \"AIF2 ADCL Mixer\", \"AIF2 ADC Mixer AIF1 DA0 Capture Switch\", \"AIF1 DA0L Stereo Mux\" },\n\t{ \"AIF2 ADCL Mixer\", \"AIF2 ADC Mixer AIF2 DAC Rev Capture Switch\", \"AIF2 DACR Source\" },\n\t{ \"AIF2 ADCL Mixer\", \"AIF2 ADC Mixer ADC Capture Switch\", \"ADCL\" },\n\n\t{ \"AIF2 ADCR Mixer\", \"AIF2 ADC Mixer AIF1 DA0 Capture Switch\", \"AIF1 DA0R Stereo Mux\" },\n\t{ \"AIF2 ADCR Mixer\", \"AIF2 ADC Mixer AIF2 DAC Rev Capture Switch\", \"AIF2 DACL Source\" },\n\t{ \"AIF2 ADCR Mixer\", \"AIF2 ADC Mixer ADC Capture Switch\", \"ADCR\" },\n\n\t \n\t{ \"AIF2 DACL Source\", \"AIF2\", \"AIF2 DACL Stereo Mux\" },\n\t{ \"AIF2 DACL Source\", \"AIF3+2\", \"AIF3 DAC\" },\n\t{ \"AIF2 DACL Source\", \"AIF2+3\", \"AIF2 DACL Stereo Mux\" },\n\n\t{ \"AIF2 DACR Source\", \"AIF2\", \"AIF2 DACR Stereo Mux\" },\n\t{ \"AIF2 DACR Source\", \"AIF3+2\", \"AIF2 DACR Stereo Mux\" },\n\t{ \"AIF2 DACR Source\", \"AIF2+3\", \"AIF3 DAC\" },\n\n\t \n\t{ \"AIF1 DA0L Stereo Mux\", \"Stereo\", \"AIF1 DA0L\" },\n\t{ \"AIF1 DA0L Stereo Mux\", \"Reverse Stereo\", \"AIF1 DA0R\" },\n\t{ \"AIF1 DA0L Stereo Mux\", \"Sum Mono\", \"AIF1 DA0L\" },\n\t{ \"AIF1 DA0L Stereo Mux\", \"Sum Mono\", \"AIF1 DA0R\" },\n\t{ \"AIF1 DA0L Stereo Mux\", \"Mix Mono\", \"AIF1 DA0L\" },\n\t{ \"AIF1 DA0L Stereo Mux\", \"Mix Mono\", \"AIF1 DA0R\" },\n\n\t{ \"AIF1 DA0R Stereo Mux\", \"Stereo\", \"AIF1 DA0R\" },\n\t{ \"AIF1 DA0R Stereo Mux\", \"Reverse Stereo\", \"AIF1 DA0L\" },\n\t{ \"AIF1 DA0R Stereo Mux\", \"Sum Mono\", \"AIF1 DA0L\" },\n\t{ \"AIF1 DA0R Stereo Mux\", \"Sum Mono\", \"AIF1 DA0R\" },\n\t{ \"AIF1 DA0R Stereo Mux\", \"Mix Mono\", \"AIF1 DA0L\" },\n\t{ \"AIF1 DA0R Stereo Mux\", \"Mix Mono\", \"AIF1 DA0R\" },\n\n\t{ \"AIF2 DACL Stereo Mux\", \"Stereo\", \"AIF2 DACL\" },\n\t{ \"AIF2 DACL Stereo Mux\", \"Reverse Stereo\", \"AIF2 DACR\" },\n\t{ \"AIF2 DACL Stereo Mux\", \"Sum Mono\", \"AIF2 DACL\" },\n\t{ \"AIF2 DACL Stereo Mux\", \"Sum Mono\", \"AIF2 DACR\" },\n\t{ \"AIF2 DACL Stereo Mux\", \"Mix Mono\", \"AIF2 DACL\" },\n\t{ \"AIF2 DACL Stereo Mux\", \"Mix Mono\", \"AIF2 DACR\" },\n\n\t{ \"AIF2 DACR Stereo Mux\", \"Stereo\", \"AIF2 DACR\" },\n\t{ \"AIF2 DACR Stereo Mux\", \"Reverse Stereo\", \"AIF2 DACL\" },\n\t{ \"AIF2 DACR Stereo Mux\", \"Sum Mono\", \"AIF2 DACL\" },\n\t{ \"AIF2 DACR Stereo Mux\", \"Sum Mono\", \"AIF2 DACR\" },\n\t{ \"AIF2 DACR Stereo Mux\", \"Mix Mono\", \"AIF2 DACL\" },\n\t{ \"AIF2 DACR Stereo Mux\", \"Mix Mono\", \"AIF2 DACR\" },\n\n\t \n\t{ \"DACL\", NULL, \"DACL Mixer\" },\n\t{ \"DACR\", NULL, \"DACR Mixer\" },\n\n\t \n\t{ \"DACL Mixer\", \"AIF1 Slot 0 Digital DAC Playback Switch\", \"AIF1 DA0L Stereo Mux\" },\n\t{ \"DACL Mixer\", \"AIF2 Digital DAC Playback Switch\", \"AIF2 DACL Source\" },\n\t{ \"DACL Mixer\", \"ADC Digital DAC Playback Switch\", \"ADCL\" },\n\n\t{ \"DACR Mixer\", \"AIF1 Slot 0 Digital DAC Playback Switch\", \"AIF1 DA0R Stereo Mux\" },\n\t{ \"DACR Mixer\", \"AIF2 Digital DAC Playback Switch\", \"AIF2 DACR Source\" },\n\t{ \"DACR Mixer\", \"ADC Digital DAC Playback Switch\", \"ADCR\" },\n};\n\nstatic const struct snd_soc_dapm_widget sun8i_codec_legacy_widgets[] = {\n\t \n\tSND_SOC_DAPM_ADC(\"AIF1 Slot 0 Left ADC\", NULL, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_ADC(\"AIF1 Slot 0 Right ADC\", NULL, SND_SOC_NOPM, 0, 0),\n\n\t \n\tSND_SOC_DAPM_DAC(\"AIF1 Slot 0 Left\", NULL, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_DAC(\"AIF1 Slot 0 Right\", NULL, SND_SOC_NOPM, 0, 0),\n};\n\nstatic const struct snd_soc_dapm_route sun8i_codec_legacy_routes[] = {\n\t \n\t{ \"ADCL\", NULL, \"AIF1 Slot 0 Left ADC\" },\n\t{ \"ADCR\", NULL, \"AIF1 Slot 0 Right ADC\" },\n\n\t \n\t{ \"AIF1 Slot 0 Left\", NULL, \"DACL\" },\n\t{ \"AIF1 Slot 0 Right\", NULL, \"DACR\" },\n};\n\nstatic int sun8i_codec_component_probe(struct snd_soc_component *component)\n{\n\tstruct snd_soc_dapm_context *dapm = snd_soc_component_get_dapm(component);\n\tstruct sun8i_codec *scodec = snd_soc_component_get_drvdata(component);\n\tint ret;\n\n\t \n\tif (scodec->quirks->legacy_widgets) {\n\t\tret = snd_soc_dapm_new_controls(dapm, sun8i_codec_legacy_widgets,\n\t\t\t\t\t\tARRAY_SIZE(sun8i_codec_legacy_widgets));\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tret = snd_soc_dapm_add_routes(dapm, sun8i_codec_legacy_routes,\n\t\t\t\t\t      ARRAY_SIZE(sun8i_codec_legacy_routes));\n\t\tif (ret)\n\t\t\treturn ret;\n\t}\n\n\t \n\tregmap_update_bits(scodec->regmap, SUN8I_SYSCLK_CTL,\n\t\t\t   SUN8I_SYSCLK_CTL_AIF1CLK_SRC_MASK |\n\t\t\t   SUN8I_SYSCLK_CTL_AIF2CLK_SRC_MASK,\n\t\t\t   SUN8I_SYSCLK_CTL_AIF1CLK_SRC_PLL |\n\t\t\t   SUN8I_SYSCLK_CTL_AIF2CLK_SRC_PLL);\n\n\t \n\tregmap_update_bits(scodec->regmap, SUN8I_SYSCLK_CTL,\n\t\t\t   BIT(SUN8I_SYSCLK_CTL_SYSCLK_SRC),\n\t\t\t   SUN8I_SYSCLK_CTL_SYSCLK_SRC_AIF1CLK);\n\n\t \n\tsun8i_codec_update_sample_rate(scodec);\n\n\treturn 0;\n}\n\nstatic const struct snd_soc_component_driver sun8i_soc_component = {\n\t.controls\t\t= sun8i_codec_controls,\n\t.num_controls\t\t= ARRAY_SIZE(sun8i_codec_controls),\n\t.dapm_widgets\t\t= sun8i_codec_dapm_widgets,\n\t.num_dapm_widgets\t= ARRAY_SIZE(sun8i_codec_dapm_widgets),\n\t.dapm_routes\t\t= sun8i_codec_dapm_routes,\n\t.num_dapm_routes\t= ARRAY_SIZE(sun8i_codec_dapm_routes),\n\t.probe\t\t\t= sun8i_codec_component_probe,\n\t.idle_bias_on\t\t= 1,\n\t.endianness\t\t= 1,\n};\n\nstatic const struct regmap_config sun8i_codec_regmap_config = {\n\t.reg_bits\t= 32,\n\t.reg_stride\t= 4,\n\t.val_bits\t= 32,\n\t.max_register\t= SUN8I_DAC_MXR_SRC,\n\n\t.cache_type\t= REGCACHE_FLAT,\n};\n\nstatic int sun8i_codec_probe(struct platform_device *pdev)\n{\n\tstruct sun8i_codec *scodec;\n\tvoid __iomem *base;\n\tint ret;\n\n\tscodec = devm_kzalloc(&pdev->dev, sizeof(*scodec), GFP_KERNEL);\n\tif (!scodec)\n\t\treturn -ENOMEM;\n\n\tscodec->clk_module = devm_clk_get(&pdev->dev, \"mod\");\n\tif (IS_ERR(scodec->clk_module)) {\n\t\tdev_err(&pdev->dev, \"Failed to get the module clock\\n\");\n\t\treturn PTR_ERR(scodec->clk_module);\n\t}\n\n\tbase = devm_platform_ioremap_resource(pdev, 0);\n\tif (IS_ERR(base)) {\n\t\tdev_err(&pdev->dev, \"Failed to map the registers\\n\");\n\t\treturn PTR_ERR(base);\n\t}\n\n\tscodec->regmap = devm_regmap_init_mmio_clk(&pdev->dev, \"bus\", base,\n\t\t\t\t\t\t   &sun8i_codec_regmap_config);\n\tif (IS_ERR(scodec->regmap)) {\n\t\tdev_err(&pdev->dev, \"Failed to create our regmap\\n\");\n\t\treturn PTR_ERR(scodec->regmap);\n\t}\n\n\tscodec->quirks = of_device_get_match_data(&pdev->dev);\n\n\tplatform_set_drvdata(pdev, scodec);\n\n\tpm_runtime_enable(&pdev->dev);\n\tif (!pm_runtime_enabled(&pdev->dev)) {\n\t\tret = sun8i_codec_runtime_resume(&pdev->dev);\n\t\tif (ret)\n\t\t\tgoto err_pm_disable;\n\t}\n\n\tret = devm_snd_soc_register_component(&pdev->dev, &sun8i_soc_component,\n\t\t\t\t\t      sun8i_codec_dais,\n\t\t\t\t\t      ARRAY_SIZE(sun8i_codec_dais));\n\tif (ret) {\n\t\tdev_err(&pdev->dev, \"Failed to register codec\\n\");\n\t\tgoto err_suspend;\n\t}\n\n\treturn ret;\n\nerr_suspend:\n\tif (!pm_runtime_status_suspended(&pdev->dev))\n\t\tsun8i_codec_runtime_suspend(&pdev->dev);\n\nerr_pm_disable:\n\tpm_runtime_disable(&pdev->dev);\n\n\treturn ret;\n}\n\nstatic void sun8i_codec_remove(struct platform_device *pdev)\n{\n\tpm_runtime_disable(&pdev->dev);\n\tif (!pm_runtime_status_suspended(&pdev->dev))\n\t\tsun8i_codec_runtime_suspend(&pdev->dev);\n}\n\nstatic const struct sun8i_codec_quirks sun8i_a33_quirks = {\n\t.legacy_widgets\t= true,\n\t.lrck_inversion\t= true,\n};\n\nstatic const struct sun8i_codec_quirks sun50i_a64_quirks = {\n};\n\nstatic const struct of_device_id sun8i_codec_of_match[] = {\n\t{ .compatible = \"allwinner,sun8i-a33-codec\", .data = &sun8i_a33_quirks },\n\t{ .compatible = \"allwinner,sun50i-a64-codec\", .data = &sun50i_a64_quirks },\n\t{}\n};\nMODULE_DEVICE_TABLE(of, sun8i_codec_of_match);\n\nstatic const struct dev_pm_ops sun8i_codec_pm_ops = {\n\tSET_RUNTIME_PM_OPS(sun8i_codec_runtime_suspend,\n\t\t\t   sun8i_codec_runtime_resume, NULL)\n};\n\nstatic struct platform_driver sun8i_codec_driver = {\n\t.driver = {\n\t\t.name = \"sun8i-codec\",\n\t\t.of_match_table = sun8i_codec_of_match,\n\t\t.pm = &sun8i_codec_pm_ops,\n\t},\n\t.probe = sun8i_codec_probe,\n\t.remove_new = sun8i_codec_remove,\n};\nmodule_platform_driver(sun8i_codec_driver);\n\nMODULE_DESCRIPTION(\"Allwinner A33 (sun8i) codec driver\");\nMODULE_AUTHOR(\"Myl\u00e8ne Josserand <mylene.josserand@free-electrons.com>\");\nMODULE_LICENSE(\"GPL\");\nMODULE_ALIAS(\"platform:sun8i-codec\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}