{
  "module_name": "soc-topology-test.c",
  "hash_id": "15bbcc0c3db1a56938c7085ecb62cce182faf44eeda6d58be9cc01a81c985670",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/soc-topology-test.c",
  "human_readable_source": "\n \n\n#include <linux/firmware.h>\n#include <sound/core.h>\n#include <sound/soc.h>\n#include <sound/soc-topology.h>\n#include <kunit/test.h>\n\n \n\n \nstatic struct device *test_dev;\n\nstatic struct device_driver test_drv = {\n\t.name = \"sound-soc-topology-test-driver\",\n};\n\nstatic int snd_soc_tplg_test_init(struct kunit *test)\n{\n\ttest_dev = root_device_register(\"sound-soc-topology-test\");\n\ttest_dev = get_device(test_dev);\n\tif (!test_dev)\n\t\treturn -ENODEV;\n\n\ttest_dev->driver = &test_drv;\n\n\treturn 0;\n}\n\nstatic void snd_soc_tplg_test_exit(struct kunit *test)\n{\n\tput_device(test_dev);\n\troot_device_unregister(test_dev);\n}\n\n \nstruct kunit_soc_component {\n\tstruct kunit *kunit;\n\tint expect;  \n\tstruct snd_soc_component comp;\n\tstruct snd_soc_card card;\n\tstruct firmware fw;\n};\n\nstatic int d_probe(struct snd_soc_component *component)\n{\n\tstruct kunit_soc_component *kunit_comp =\n\t\t\tcontainer_of(component, struct kunit_soc_component, comp);\n\tint ret;\n\n\tret = snd_soc_tplg_component_load(component, NULL, &kunit_comp->fw);\n\tKUNIT_EXPECT_EQ_MSG(kunit_comp->kunit, kunit_comp->expect, ret,\n\t\t\t    \"Failed topology load\");\n\n\treturn 0;\n}\n\nstatic void d_remove(struct snd_soc_component *component)\n{\n\tstruct kunit_soc_component *kunit_comp =\n\t\t\tcontainer_of(component, struct kunit_soc_component, comp);\n\tint ret;\n\n\tret = snd_soc_tplg_component_remove(component);\n\tKUNIT_EXPECT_EQ(kunit_comp->kunit, 0, ret);\n}\n\n \nSND_SOC_DAILINK_DEF(dummy, DAILINK_COMP_ARRAY(COMP_DUMMY()));\n\nSND_SOC_DAILINK_DEF(platform, DAILINK_COMP_ARRAY(COMP_PLATFORM(\"sound-soc-topology-test\")));\n\nstatic struct snd_soc_dai_link kunit_dai_links[] = {\n\t{\n\t\t.name = \"KUNIT Audio Port\",\n\t\t.id = 0,\n\t\t.stream_name = \"Audio Playback/Capture\",\n\t\t.nonatomic = 1,\n\t\t.dynamic = 1,\n\t\t.trigger = {SND_SOC_DPCM_TRIGGER_POST, SND_SOC_DPCM_TRIGGER_POST},\n\t\t.dpcm_playback = 1,\n\t\t.dpcm_capture = 1,\n\t\tSND_SOC_DAILINK_REG(dummy, dummy, platform),\n\t},\n};\n\nstatic const struct snd_soc_component_driver test_component = {\n\t.name = \"sound-soc-topology-test\",\n\t.probe = d_probe,\n\t.remove = d_remove,\n};\n\n \n\n \n \n \n \n\nstruct tplg_tmpl_001 {\n\tstruct snd_soc_tplg_hdr header;\n\tstruct snd_soc_tplg_manifest manifest;\n} __packed;\n\nstatic struct tplg_tmpl_001 tplg_tmpl_empty = {\n\t.header = {\n\t\t.magic = cpu_to_le32(SND_SOC_TPLG_MAGIC),\n\t\t.abi = cpu_to_le32(5),\n\t\t.version = 0,\n\t\t.type = cpu_to_le32(SND_SOC_TPLG_TYPE_MANIFEST),\n\t\t.size = cpu_to_le32(sizeof(struct snd_soc_tplg_hdr)),\n\t\t.vendor_type = 0,\n\t\t.payload_size = cpu_to_le32(sizeof(struct snd_soc_tplg_manifest)),\n\t\t.index = 0,\n\t\t.count = cpu_to_le32(1),\n\t},\n\n\t.manifest = {\n\t\t.size = cpu_to_le32(sizeof(struct snd_soc_tplg_manifest)),\n\t\t \n\t},\n};\n\n \n\nstruct tplg_tmpl_002 {\n\tstruct snd_soc_tplg_hdr header;\n\tstruct snd_soc_tplg_manifest manifest;\n\tstruct snd_soc_tplg_hdr pcm_header;\n\tstruct snd_soc_tplg_pcm pcm;\n} __packed;\n\nstatic struct tplg_tmpl_002 tplg_tmpl_with_pcm = {\n\t.header = {\n\t\t.magic = cpu_to_le32(SND_SOC_TPLG_MAGIC),\n\t\t.abi = cpu_to_le32(5),\n\t\t.version = 0,\n\t\t.type = cpu_to_le32(SND_SOC_TPLG_TYPE_MANIFEST),\n\t\t.size = cpu_to_le32(sizeof(struct snd_soc_tplg_hdr)),\n\t\t.vendor_type = 0,\n\t\t.payload_size = cpu_to_le32(sizeof(struct snd_soc_tplg_manifest)),\n\t\t.index = 0,\n\t\t.count = cpu_to_le32(1),\n\t},\n\t.manifest = {\n\t\t.size = cpu_to_le32(sizeof(struct snd_soc_tplg_manifest)),\n\t\t.pcm_elems = cpu_to_le32(1),\n\t\t \n\t},\n\t.pcm_header = {\n\t\t.magic = cpu_to_le32(SND_SOC_TPLG_MAGIC),\n\t\t.abi = cpu_to_le32(5),\n\t\t.version = 0,\n\t\t.type = cpu_to_le32(SND_SOC_TPLG_TYPE_PCM),\n\t\t.size = cpu_to_le32(sizeof(struct snd_soc_tplg_hdr)),\n\t\t.vendor_type = 0,\n\t\t.payload_size = cpu_to_le32(sizeof(struct snd_soc_tplg_pcm)),\n\t\t.index = 0,\n\t\t.count = cpu_to_le32(1),\n\t},\n\t.pcm = {\n\t\t.size = cpu_to_le32(sizeof(struct snd_soc_tplg_pcm)),\n\t\t.pcm_name = \"KUNIT Audio\",\n\t\t.dai_name = \"kunit-audio-dai\",\n\t\t.pcm_id = 0,\n\t\t.dai_id = 0,\n\t\t.playback = cpu_to_le32(1),\n\t\t.capture = cpu_to_le32(1),\n\t\t.compress = 0,\n\t\t.stream = {\n\t\t\t[0] = {\n\t\t\t\t.channels = cpu_to_le32(2),\n\t\t\t},\n\t\t\t[1] = {\n\t\t\t\t.channels = cpu_to_le32(2),\n\t\t\t},\n\t\t},\n\t\t.num_streams = 0,\n\t\t.caps = {\n\t\t\t[0] = {\n\t\t\t\t.name = \"kunit-audio-playback\",\n\t\t\t\t.channels_min = cpu_to_le32(2),\n\t\t\t\t.channels_max = cpu_to_le32(2),\n\t\t\t},\n\t\t\t[1] = {\n\t\t\t\t.name = \"kunit-audio-capture\",\n\t\t\t\t.channels_min = cpu_to_le32(2),\n\t\t\t\t.channels_max = cpu_to_le32(2),\n\t\t\t},\n\t\t},\n\t\t.flag_mask = 0,\n\t\t.flags = 0,\n\t\t.priv = { 0 },\n\t},\n};\n\n \n\n \n \n\n \nstatic int d_probe_null_comp(struct snd_soc_component *component)\n{\n\tstruct kunit_soc_component *kunit_comp =\n\t\t\tcontainer_of(component, struct kunit_soc_component, comp);\n\tint ret;\n\n\t \n\tret = snd_soc_tplg_component_load(NULL, NULL, &kunit_comp->fw);\n\tKUNIT_EXPECT_EQ_MSG(kunit_comp->kunit, kunit_comp->expect, ret,\n\t\t\t    \"Failed topology load\");\n\n\treturn 0;\n}\n\nstatic const struct snd_soc_component_driver test_component_null_comp = {\n\t.name = \"sound-soc-topology-test\",\n\t.probe = d_probe_null_comp,\n};\n\nstatic void snd_soc_tplg_test_load_with_null_comp(struct kunit *test)\n{\n\tstruct kunit_soc_component *kunit_comp;\n\tint ret;\n\n\t \n\tkunit_comp = kunit_kzalloc(test, sizeof(*kunit_comp), GFP_KERNEL);\n\tKUNIT_EXPECT_NOT_ERR_OR_NULL(test, kunit_comp);\n\tkunit_comp->kunit = test;\n\tkunit_comp->expect = -EINVAL;  \n\n\tkunit_comp->card.dev = test_dev,\n\tkunit_comp->card.name = \"kunit-card\",\n\tkunit_comp->card.owner = THIS_MODULE,\n\tkunit_comp->card.dai_link = kunit_dai_links,\n\tkunit_comp->card.num_links = ARRAY_SIZE(kunit_dai_links),\n\tkunit_comp->card.fully_routed = true,\n\n\t \n\tret = snd_soc_register_card(&kunit_comp->card);\n\tif (ret != 0 && ret != -EPROBE_DEFER)\n\t\tKUNIT_FAIL(test, \"Failed to register card\");\n\n\tret = snd_soc_component_initialize(&kunit_comp->comp, &test_component_null_comp, test_dev);\n\tKUNIT_EXPECT_EQ(test, 0, ret);\n\n\tret = snd_soc_add_component(&kunit_comp->comp, NULL, 0);\n\tKUNIT_EXPECT_EQ(test, 0, ret);\n\n\t \n\tsnd_soc_unregister_card(&kunit_comp->card);\n\tsnd_soc_unregister_component(test_dev);\n}\n\n\n\n\n \nstatic void snd_soc_tplg_test_load_with_null_ops(struct kunit *test)\n{\n\tstruct kunit_soc_component *kunit_comp;\n\tint ret;\n\n\t \n\tkunit_comp = kunit_kzalloc(test, sizeof(*kunit_comp), GFP_KERNEL);\n\tKUNIT_EXPECT_NOT_ERR_OR_NULL(test, kunit_comp);\n\tkunit_comp->kunit = test;\n\tkunit_comp->expect = 0;  \n\n\tkunit_comp->card.dev = test_dev,\n\tkunit_comp->card.name = \"kunit-card\",\n\tkunit_comp->card.owner = THIS_MODULE,\n\tkunit_comp->card.dai_link = kunit_dai_links,\n\tkunit_comp->card.num_links = ARRAY_SIZE(kunit_dai_links),\n\tkunit_comp->card.fully_routed = true,\n\n\t \n\tret = snd_soc_register_card(&kunit_comp->card);\n\tif (ret != 0 && ret != -EPROBE_DEFER)\n\t\tKUNIT_FAIL(test, \"Failed to register card\");\n\n\tret = snd_soc_component_initialize(&kunit_comp->comp, &test_component, test_dev);\n\tKUNIT_EXPECT_EQ(test, 0, ret);\n\n\tret = snd_soc_add_component(&kunit_comp->comp, NULL, 0);\n\tKUNIT_EXPECT_EQ(test, 0, ret);\n\n\t \n\tsnd_soc_unregister_card(&kunit_comp->card);\n\n\tsnd_soc_unregister_component(test_dev);\n}\n\n \n \n\n \nstatic int d_probe_null_fw(struct snd_soc_component *component)\n{\n\tstruct kunit_soc_component *kunit_comp =\n\t\t\tcontainer_of(component, struct kunit_soc_component, comp);\n\tint ret;\n\n\t \n\tret = snd_soc_tplg_component_load(component, NULL, NULL);\n\tKUNIT_EXPECT_EQ_MSG(kunit_comp->kunit, kunit_comp->expect, ret,\n\t\t\t    \"Failed topology load\");\n\n\treturn 0;\n}\n\nstatic const struct snd_soc_component_driver test_component_null_fw = {\n\t.name = \"sound-soc-topology-test\",\n\t.probe = d_probe_null_fw,\n};\n\nstatic void snd_soc_tplg_test_load_with_null_fw(struct kunit *test)\n{\n\tstruct kunit_soc_component *kunit_comp;\n\tint ret;\n\n\t \n\tkunit_comp = kunit_kzalloc(test, sizeof(*kunit_comp), GFP_KERNEL);\n\tKUNIT_EXPECT_NOT_ERR_OR_NULL(test, kunit_comp);\n\tkunit_comp->kunit = test;\n\tkunit_comp->expect = -EINVAL;  \n\n\tkunit_comp->card.dev = test_dev,\n\tkunit_comp->card.name = \"kunit-card\",\n\tkunit_comp->card.owner = THIS_MODULE,\n\tkunit_comp->card.dai_link = kunit_dai_links,\n\tkunit_comp->card.num_links = ARRAY_SIZE(kunit_dai_links),\n\tkunit_comp->card.fully_routed = true,\n\n\t \n\tret = snd_soc_register_card(&kunit_comp->card);\n\tif (ret != 0 && ret != -EPROBE_DEFER)\n\t\tKUNIT_FAIL(test, \"Failed to register card\");\n\n\tret = snd_soc_component_initialize(&kunit_comp->comp, &test_component_null_fw, test_dev);\n\tKUNIT_EXPECT_EQ(test, 0, ret);\n\n\tret = snd_soc_add_component(&kunit_comp->comp, NULL, 0);\n\tKUNIT_EXPECT_EQ(test, 0, ret);\n\n\t \n\tsnd_soc_unregister_card(&kunit_comp->card);\n\n\tsnd_soc_unregister_component(test_dev);\n}\n\n\n\nstatic void snd_soc_tplg_test_load_empty_tplg(struct kunit *test)\n{\n\tstruct kunit_soc_component *kunit_comp;\n\tstruct tplg_tmpl_001 *data;\n\tint size;\n\tint ret;\n\n\t \n\tkunit_comp = kunit_kzalloc(test, sizeof(*kunit_comp), GFP_KERNEL);\n\tKUNIT_EXPECT_NOT_ERR_OR_NULL(test, kunit_comp);\n\tkunit_comp->kunit = test;\n\tkunit_comp->expect = 0;  \n\n\tsize = sizeof(tplg_tmpl_empty);\n\tdata = kunit_kzalloc(kunit_comp->kunit, size, GFP_KERNEL);\n\tKUNIT_EXPECT_NOT_ERR_OR_NULL(kunit_comp->kunit, data);\n\n\tmemcpy(data, &tplg_tmpl_empty, sizeof(tplg_tmpl_empty));\n\n\tkunit_comp->fw.data = (u8 *)data;\n\tkunit_comp->fw.size = size;\n\n\tkunit_comp->card.dev = test_dev,\n\tkunit_comp->card.name = \"kunit-card\",\n\tkunit_comp->card.owner = THIS_MODULE,\n\tkunit_comp->card.dai_link = kunit_dai_links,\n\tkunit_comp->card.num_links = ARRAY_SIZE(kunit_dai_links),\n\tkunit_comp->card.fully_routed = true,\n\n\t \n\tret = snd_soc_register_card(&kunit_comp->card);\n\tif (ret != 0 && ret != -EPROBE_DEFER)\n\t\tKUNIT_FAIL(test, \"Failed to register card\");\n\n\tret = snd_soc_component_initialize(&kunit_comp->comp, &test_component, test_dev);\n\tKUNIT_EXPECT_EQ(test, 0, ret);\n\n\tret = snd_soc_add_component(&kunit_comp->comp, NULL, 0);\n\tKUNIT_EXPECT_EQ(test, 0, ret);\n\n\t \n\tsnd_soc_unregister_card(&kunit_comp->card);\n\n\tsnd_soc_unregister_component(test_dev);\n}\n\n\n\n\n\nstatic void snd_soc_tplg_test_load_empty_tplg_bad_magic(struct kunit *test)\n{\n\tstruct kunit_soc_component *kunit_comp;\n\tstruct tplg_tmpl_001 *data;\n\tint size;\n\tint ret;\n\n\t \n\tkunit_comp = kunit_kzalloc(test, sizeof(*kunit_comp), GFP_KERNEL);\n\tKUNIT_EXPECT_NOT_ERR_OR_NULL(test, kunit_comp);\n\tkunit_comp->kunit = test;\n\tkunit_comp->expect = -EINVAL;  \n\n\tsize = sizeof(tplg_tmpl_empty);\n\tdata = kunit_kzalloc(kunit_comp->kunit, size, GFP_KERNEL);\n\tKUNIT_EXPECT_NOT_ERR_OR_NULL(kunit_comp->kunit, data);\n\n\tmemcpy(data, &tplg_tmpl_empty, sizeof(tplg_tmpl_empty));\n\t \n\tdata->header.magic = cpu_to_le32(SND_SOC_TPLG_MAGIC + 1);\n\n\tkunit_comp->fw.data = (u8 *)data;\n\tkunit_comp->fw.size = size;\n\n\tkunit_comp->card.dev = test_dev,\n\tkunit_comp->card.name = \"kunit-card\",\n\tkunit_comp->card.owner = THIS_MODULE,\n\tkunit_comp->card.dai_link = kunit_dai_links,\n\tkunit_comp->card.num_links = ARRAY_SIZE(kunit_dai_links),\n\tkunit_comp->card.fully_routed = true,\n\n\t \n\tret = snd_soc_register_card(&kunit_comp->card);\n\tif (ret != 0 && ret != -EPROBE_DEFER)\n\t\tKUNIT_FAIL(test, \"Failed to register card\");\n\n\tret = snd_soc_component_initialize(&kunit_comp->comp, &test_component, test_dev);\n\tKUNIT_EXPECT_EQ(test, 0, ret);\n\n\tret = snd_soc_add_component(&kunit_comp->comp, NULL, 0);\n\tKUNIT_EXPECT_EQ(test, 0, ret);\n\n\t \n\tsnd_soc_unregister_card(&kunit_comp->card);\n\n\tsnd_soc_unregister_component(test_dev);\n}\n\n\n\n\n\nstatic void snd_soc_tplg_test_load_empty_tplg_bad_abi(struct kunit *test)\n{\n\tstruct kunit_soc_component *kunit_comp;\n\tstruct tplg_tmpl_001 *data;\n\tint size;\n\tint ret;\n\n\t \n\tkunit_comp = kunit_kzalloc(test, sizeof(*kunit_comp), GFP_KERNEL);\n\tKUNIT_EXPECT_NOT_ERR_OR_NULL(test, kunit_comp);\n\tkunit_comp->kunit = test;\n\tkunit_comp->expect = -EINVAL;  \n\n\tsize = sizeof(tplg_tmpl_empty);\n\tdata = kunit_kzalloc(kunit_comp->kunit, size, GFP_KERNEL);\n\tKUNIT_EXPECT_NOT_ERR_OR_NULL(kunit_comp->kunit, data);\n\n\tmemcpy(data, &tplg_tmpl_empty, sizeof(tplg_tmpl_empty));\n\t \n\tdata->header.abi = cpu_to_le32(SND_SOC_TPLG_ABI_VERSION + 1);\n\n\tkunit_comp->fw.data = (u8 *)data;\n\tkunit_comp->fw.size = size;\n\n\tkunit_comp->card.dev = test_dev,\n\tkunit_comp->card.name = \"kunit-card\",\n\tkunit_comp->card.owner = THIS_MODULE,\n\tkunit_comp->card.dai_link = kunit_dai_links,\n\tkunit_comp->card.num_links = ARRAY_SIZE(kunit_dai_links),\n\tkunit_comp->card.fully_routed = true,\n\n\t \n\tret = snd_soc_register_card(&kunit_comp->card);\n\tif (ret != 0 && ret != -EPROBE_DEFER)\n\t\tKUNIT_FAIL(test, \"Failed to register card\");\n\n\tret = snd_soc_component_initialize(&kunit_comp->comp, &test_component, test_dev);\n\tKUNIT_EXPECT_EQ(test, 0, ret);\n\n\tret = snd_soc_add_component(&kunit_comp->comp, NULL, 0);\n\tKUNIT_EXPECT_EQ(test, 0, ret);\n\n\t \n\tsnd_soc_unregister_card(&kunit_comp->card);\n\n\tsnd_soc_unregister_component(test_dev);\n}\n\n\n\n\n\nstatic void snd_soc_tplg_test_load_empty_tplg_bad_size(struct kunit *test)\n{\n\tstruct kunit_soc_component *kunit_comp;\n\tstruct tplg_tmpl_001 *data;\n\tint size;\n\tint ret;\n\n\t \n\tkunit_comp = kunit_kzalloc(test, sizeof(*kunit_comp), GFP_KERNEL);\n\tKUNIT_EXPECT_NOT_ERR_OR_NULL(test, kunit_comp);\n\tkunit_comp->kunit = test;\n\tkunit_comp->expect = -EINVAL;  \n\n\tsize = sizeof(tplg_tmpl_empty);\n\tdata = kunit_kzalloc(kunit_comp->kunit, size, GFP_KERNEL);\n\tKUNIT_EXPECT_NOT_ERR_OR_NULL(kunit_comp->kunit, data);\n\n\tmemcpy(data, &tplg_tmpl_empty, sizeof(tplg_tmpl_empty));\n\t \n\tdata->header.size = cpu_to_le32(sizeof(struct snd_soc_tplg_hdr) + 1);\n\n\tkunit_comp->fw.data = (u8 *)data;\n\tkunit_comp->fw.size = size;\n\n\tkunit_comp->card.dev = test_dev,\n\tkunit_comp->card.name = \"kunit-card\",\n\tkunit_comp->card.owner = THIS_MODULE,\n\tkunit_comp->card.dai_link = kunit_dai_links,\n\tkunit_comp->card.num_links = ARRAY_SIZE(kunit_dai_links),\n\tkunit_comp->card.fully_routed = true,\n\n\t \n\tret = snd_soc_register_card(&kunit_comp->card);\n\tif (ret != 0 && ret != -EPROBE_DEFER)\n\t\tKUNIT_FAIL(test, \"Failed to register card\");\n\n\tret = snd_soc_component_initialize(&kunit_comp->comp, &test_component, test_dev);\n\tKUNIT_EXPECT_EQ(test, 0, ret);\n\n\tret = snd_soc_add_component(&kunit_comp->comp, NULL, 0);\n\tKUNIT_EXPECT_EQ(test, 0, ret);\n\n\t \n\tsnd_soc_unregister_card(&kunit_comp->card);\n\n\tsnd_soc_unregister_component(test_dev);\n}\n\n\n\n\n\nstatic void snd_soc_tplg_test_load_empty_tplg_bad_payload_size(struct kunit *test)\n{\n\tstruct kunit_soc_component *kunit_comp;\n\tstruct tplg_tmpl_001 *data;\n\tint size;\n\tint ret;\n\n\t \n\tkunit_comp = kunit_kzalloc(test, sizeof(*kunit_comp), GFP_KERNEL);\n\tKUNIT_EXPECT_NOT_ERR_OR_NULL(test, kunit_comp);\n\tkunit_comp->kunit = test;\n\tkunit_comp->expect = -EINVAL;  \n\n\tsize = sizeof(tplg_tmpl_empty);\n\tdata = kunit_kzalloc(kunit_comp->kunit, size, GFP_KERNEL);\n\tKUNIT_EXPECT_NOT_ERR_OR_NULL(kunit_comp->kunit, data);\n\n\tmemcpy(data, &tplg_tmpl_empty, sizeof(tplg_tmpl_empty));\n\t \n\tdata->header.payload_size = 0;\n\n\tkunit_comp->fw.data = (u8 *)data;\n\tkunit_comp->fw.size = size;\n\n\tkunit_comp->card.dev = test_dev,\n\tkunit_comp->card.name = \"kunit-card\",\n\tkunit_comp->card.owner = THIS_MODULE,\n\tkunit_comp->card.dai_link = kunit_dai_links,\n\tkunit_comp->card.num_links = ARRAY_SIZE(kunit_dai_links),\n\tkunit_comp->card.fully_routed = true,\n\n\t \n\tret = snd_soc_register_card(&kunit_comp->card);\n\tif (ret != 0 && ret != -EPROBE_DEFER)\n\t\tKUNIT_FAIL(test, \"Failed to register card\");\n\n\tret = snd_soc_component_initialize(&kunit_comp->comp, &test_component, test_dev);\n\tKUNIT_EXPECT_EQ(test, 0, ret);\n\n\tret = snd_soc_add_component(&kunit_comp->comp, NULL, 0);\n\tKUNIT_EXPECT_EQ(test, 0, ret);\n\n\t \n\tsnd_soc_unregister_component(test_dev);\n\n\tsnd_soc_unregister_card(&kunit_comp->card);\n}\n\n\n\nstatic void snd_soc_tplg_test_load_pcm_tplg(struct kunit *test)\n{\n\tstruct kunit_soc_component *kunit_comp;\n\tu8 *data;\n\tint size;\n\tint ret;\n\n\t \n\tkunit_comp = kunit_kzalloc(test, sizeof(*kunit_comp), GFP_KERNEL);\n\tKUNIT_EXPECT_NOT_ERR_OR_NULL(test, kunit_comp);\n\tkunit_comp->kunit = test;\n\tkunit_comp->expect = 0;  \n\n\tsize = sizeof(tplg_tmpl_with_pcm);\n\tdata = kunit_kzalloc(kunit_comp->kunit, size, GFP_KERNEL);\n\tKUNIT_EXPECT_NOT_ERR_OR_NULL(kunit_comp->kunit, data);\n\n\tmemcpy(data, &tplg_tmpl_with_pcm, sizeof(tplg_tmpl_with_pcm));\n\n\tkunit_comp->fw.data = data;\n\tkunit_comp->fw.size = size;\n\n\tkunit_comp->card.dev = test_dev,\n\tkunit_comp->card.name = \"kunit-card\",\n\tkunit_comp->card.owner = THIS_MODULE,\n\tkunit_comp->card.dai_link = kunit_dai_links,\n\tkunit_comp->card.num_links = ARRAY_SIZE(kunit_dai_links),\n\tkunit_comp->card.fully_routed = true,\n\n\t \n\tret = snd_soc_register_card(&kunit_comp->card);\n\tif (ret != 0 && ret != -EPROBE_DEFER)\n\t\tKUNIT_FAIL(test, \"Failed to register card\");\n\n\tret = snd_soc_component_initialize(&kunit_comp->comp, &test_component, test_dev);\n\tKUNIT_EXPECT_EQ(test, 0, ret);\n\n\tret = snd_soc_add_component(&kunit_comp->comp, NULL, 0);\n\tKUNIT_EXPECT_EQ(test, 0, ret);\n\n\tsnd_soc_unregister_component(test_dev);\n\n\t \n\tsnd_soc_unregister_card(&kunit_comp->card);\n}\n\n\n\n\nstatic void snd_soc_tplg_test_load_pcm_tplg_reload_comp(struct kunit *test)\n{\n\tstruct kunit_soc_component *kunit_comp;\n\tu8 *data;\n\tint size;\n\tint ret;\n\tint i;\n\n\t \n\tkunit_comp = kunit_kzalloc(test, sizeof(*kunit_comp), GFP_KERNEL);\n\tKUNIT_EXPECT_NOT_ERR_OR_NULL(test, kunit_comp);\n\tkunit_comp->kunit = test;\n\tkunit_comp->expect = 0;  \n\n\tsize = sizeof(tplg_tmpl_with_pcm);\n\tdata = kunit_kzalloc(kunit_comp->kunit, size, GFP_KERNEL);\n\tKUNIT_EXPECT_NOT_ERR_OR_NULL(kunit_comp->kunit, data);\n\n\tmemcpy(data, &tplg_tmpl_with_pcm, sizeof(tplg_tmpl_with_pcm));\n\n\tkunit_comp->fw.data = data;\n\tkunit_comp->fw.size = size;\n\n\tkunit_comp->card.dev = test_dev,\n\tkunit_comp->card.name = \"kunit-card\",\n\tkunit_comp->card.owner = THIS_MODULE,\n\tkunit_comp->card.dai_link = kunit_dai_links,\n\tkunit_comp->card.num_links = ARRAY_SIZE(kunit_dai_links),\n\tkunit_comp->card.fully_routed = true,\n\n\t \n\tret = snd_soc_register_card(&kunit_comp->card);\n\tif (ret != 0 && ret != -EPROBE_DEFER)\n\t\tKUNIT_FAIL(test, \"Failed to register card\");\n\n\tfor (i = 0; i < 100; i++) {\n\t\tret = snd_soc_component_initialize(&kunit_comp->comp, &test_component, test_dev);\n\t\tKUNIT_EXPECT_EQ(test, 0, ret);\n\n\t\tret = snd_soc_add_component(&kunit_comp->comp, NULL, 0);\n\t\tKUNIT_EXPECT_EQ(test, 0, ret);\n\n\t\tsnd_soc_unregister_component(test_dev);\n\t}\n\n\t \n\tsnd_soc_unregister_card(&kunit_comp->card);\n}\n\n\n\n\nstatic void snd_soc_tplg_test_load_pcm_tplg_reload_card(struct kunit *test)\n{\n\tstruct kunit_soc_component *kunit_comp;\n\tu8 *data;\n\tint size;\n\tint ret;\n\tint i;\n\n\t \n\tkunit_comp = kunit_kzalloc(test, sizeof(*kunit_comp), GFP_KERNEL);\n\tKUNIT_EXPECT_NOT_ERR_OR_NULL(test, kunit_comp);\n\tkunit_comp->kunit = test;\n\tkunit_comp->expect = 0;  \n\n\tsize = sizeof(tplg_tmpl_with_pcm);\n\tdata = kunit_kzalloc(kunit_comp->kunit, size, GFP_KERNEL);\n\tKUNIT_EXPECT_NOT_ERR_OR_NULL(kunit_comp->kunit, data);\n\n\tmemcpy(data, &tplg_tmpl_with_pcm, sizeof(tplg_tmpl_with_pcm));\n\n\tkunit_comp->fw.data = data;\n\tkunit_comp->fw.size = size;\n\n\tkunit_comp->card.dev = test_dev,\n\tkunit_comp->card.name = \"kunit-card\",\n\tkunit_comp->card.owner = THIS_MODULE,\n\tkunit_comp->card.dai_link = kunit_dai_links,\n\tkunit_comp->card.num_links = ARRAY_SIZE(kunit_dai_links),\n\tkunit_comp->card.fully_routed = true,\n\n\t \n\tret = snd_soc_component_initialize(&kunit_comp->comp, &test_component, test_dev);\n\tKUNIT_EXPECT_EQ(test, 0, ret);\n\n\tret = snd_soc_add_component(&kunit_comp->comp, NULL, 0);\n\tKUNIT_EXPECT_EQ(test, 0, ret);\n\n\tfor (i = 0; i < 100; i++) {\n\t\tret = snd_soc_register_card(&kunit_comp->card);\n\t\tif (ret != 0 && ret != -EPROBE_DEFER)\n\t\t\tKUNIT_FAIL(test, \"Failed to register card\");\n\n\t\tsnd_soc_unregister_card(&kunit_comp->card);\n\t}\n\n\t \n\tsnd_soc_unregister_component(test_dev);\n}\n\n \n\nstatic struct kunit_case snd_soc_tplg_test_cases[] = {\n\tKUNIT_CASE(snd_soc_tplg_test_load_with_null_comp),\n\tKUNIT_CASE(snd_soc_tplg_test_load_with_null_ops),\n\tKUNIT_CASE(snd_soc_tplg_test_load_with_null_fw),\n\tKUNIT_CASE(snd_soc_tplg_test_load_empty_tplg),\n\tKUNIT_CASE(snd_soc_tplg_test_load_empty_tplg_bad_magic),\n\tKUNIT_CASE(snd_soc_tplg_test_load_empty_tplg_bad_abi),\n\tKUNIT_CASE(snd_soc_tplg_test_load_empty_tplg_bad_size),\n\tKUNIT_CASE(snd_soc_tplg_test_load_empty_tplg_bad_payload_size),\n\tKUNIT_CASE(snd_soc_tplg_test_load_pcm_tplg),\n\tKUNIT_CASE(snd_soc_tplg_test_load_pcm_tplg_reload_comp),\n\tKUNIT_CASE(snd_soc_tplg_test_load_pcm_tplg_reload_card),\n\t{}\n};\n\nstatic struct kunit_suite snd_soc_tplg_test_suite = {\n\t.name = \"snd_soc_tplg_test\",\n\t.init = snd_soc_tplg_test_init,\n\t.exit = snd_soc_tplg_test_exit,\n\t.test_cases = snd_soc_tplg_test_cases,\n};\n\nkunit_test_suites(&snd_soc_tplg_test_suite);\n\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}