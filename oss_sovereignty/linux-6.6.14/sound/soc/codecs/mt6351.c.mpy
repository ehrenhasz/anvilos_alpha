{
  "module_name": "mt6351.c",
  "hash_id": "76c9304f99476ccd184aa8e70e9bc7e5b61fa76a56412d21172e027982fde726",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/codecs/mt6351.c",
  "human_readable_source": "\n\n\n\n\n\n\n#include <linux/dma-mapping.h>\n#include <linux/platform_device.h>\n#include <linux/slab.h>\n#include <linux/module.h>\n#include <linux/of_device.h>\n#include <linux/delay.h>\n\n#include <sound/core.h>\n#include <sound/pcm.h>\n#include <sound/soc.h>\n#include <sound/tlv.h>\n\n#include \"mt6351.h\"\n\n \n#define RG_CLKSQ_EN_AUD_BIT (0)\n\n \n#define RG_AUDNCP_CK_PDN_BIT (12)\n#define RG_AUDIF_CK_PDN_BIT (13)\n#define RG_AUD_CK_PDN_BIT (14)\n#define RG_ZCD13M_CK_PDN_BIT (15)\n\n \n#define RG_AUDDACLPWRUP_VAUDP32_BIT (0)\n#define RG_AUDDACRPWRUP_VAUDP32_BIT (1)\n#define RG_AUD_DAC_PWR_UP_VA32_BIT (2)\n#define RG_AUD_DAC_PWL_UP_VA32_BIT (3)\n\n#define RG_AUDHSPWRUP_VAUDP32_BIT (4)\n\n#define RG_AUDHPLPWRUP_VAUDP32_BIT (5)\n#define RG_AUDHPRPWRUP_VAUDP32_BIT (6)\n\n#define RG_AUDHSMUXINPUTSEL_VAUDP32_SFT (7)\n#define RG_AUDHSMUXINPUTSEL_VAUDP32_MASK (0x3)\n\n#define RG_AUDHPLMUXINPUTSEL_VAUDP32_SFT (9)\n#define RG_AUDHPLMUXINPUTSEL_VAUDP32_MASK (0x3)\n\n#define RG_AUDHPRMUXINPUTSEL_VAUDP32_SFT (11)\n#define RG_AUDHPRMUXINPUTSEL_VAUDP32_MASK (0x3)\n\n#define RG_AUDHSSCDISABLE_VAUDP32 (13)\n#define RG_AUDHPLSCDISABLE_VAUDP32_BIT (14)\n#define RG_AUDHPRSCDISABLE_VAUDP32_BIT (15)\n\n \n#define RG_HSOUTPUTSTBENH_VAUDP32_BIT (8)\n\n \n#define RG_AUDLOLPWRUP_VAUDP32_BIT (2)\n\n#define RG_AUDLOLMUXINPUTSEL_VAUDP32_SFT (3)\n#define RG_AUDLOLMUXINPUTSEL_VAUDP32_MASK (0x3)\n\n#define RG_AUDLOLSCDISABLE_VAUDP32_BIT (5)\n#define RG_LOOUTPUTSTBENH_VAUDP32_BIT (9)\n\n \n#define RG_ABIDEC_RSVD0_VAUDP32_HPL_BIT (8)\n#define RG_ABIDEC_RSVD0_VAUDP32_HPR_BIT (9)\n#define RG_ABIDEC_RSVD0_VAUDP32_HS_BIT (10)\n#define RG_ABIDEC_RSVD0_VAUDP32_LOL_BIT (11)\n\n \n#define RG_AUDIBIASPWRDN_VAUDP32_BIT (8)\n#define RG_RSTB_DECODER_VA32_BIT (9)\n#define RG_AUDGLB_PWRDN_VA32_BIT (12)\n\n#define RG_LCLDO_DEC_EN_VA32_BIT (13)\n#define RG_LCLDO_DEC_REMOTE_SENSE_VA18_BIT (15)\n \n#define RG_NVREG_EN_VAUDP32_BIT (8)\n\n#define RG_AUDGLB_LP2_VOW_EN_VA32 10\n\n \n#define RG_AFE_ON_BIT (0)\n\n \n#define RG_DL_2_SRC_ON_TMP_CTL_PRE_BIT (0)\n\n \n#define UL_SRC_ON_TMP_CTL (0)\n\n \n#define RG_DL_SINE_ON_SFT (0)\n#define RG_DL_SINE_ON_MASK (0x1)\n\n#define RG_UL_SINE_ON_SFT (1)\n#define RG_UL_SINE_ON_MASK (0x1)\n\n \n#define AUD_TOP_PDN_RESERVED_BIT 0\n#define AUD_TOP_PWR_CLK_DIS_CTL_BIT 2\n#define AUD_TOP_PDN_ADC_CTL_BIT 5\n#define AUD_TOP_PDN_DAC_CTL_BIT 6\n#define AUD_TOP_PDN_AFE_CTL_BIT 7\n\n \n#define SGEN_C_MUTE_SW_CTL_BIT 6\n#define SGEN_C_DAC_EN_CTL_BIT 7\n\n \n#define RG_NCP_ON_BIT 0\n\n \n#define RG_VUSB33_EN 1\n#define RG_VUSB33_ON_CTRL 3\n\n \n#define RG_VA18_EN 1\n#define RG_VA18_ON_CTRL 3\n\n \n#define RG_AUDPREAMPLON 0\n#define RG_AUDPREAMPLDCCEN 1\n#define RG_AUDPREAMPLDCPRECHARGE 2\n\n#define RG_AUDPREAMPLINPUTSEL_SFT (4)\n#define RG_AUDPREAMPLINPUTSEL_MASK (0x3)\n\n#define RG_AUDADCLPWRUP 12\n\n#define RG_AUDADCLINPUTSEL_SFT (13)\n#define RG_AUDADCLINPUTSEL_MASK (0x3)\n\n \n#define RG_AUDPREAMPRON 0\n#define RG_AUDPREAMPRDCCEN 1\n#define RG_AUDPREAMPRDCPRECHARGE 2\n\n#define RG_AUDPREAMPRINPUTSEL_SFT (4)\n#define RG_AUDPREAMPRINPUTSEL_MASK (0x3)\n\n#define RG_AUDADCRPWRUP 12\n\n#define RG_AUDADCRINPUTSEL_SFT (13)\n#define RG_AUDADCRINPUTSEL_MASK (0x3)\n\n \n#define RG_AUDADCCLKRSTB 6\n\n \n#define RG_AUDPWDBMICBIAS0 0\n#define RG_AUDMICBIAS0VREF 4\n#define RG_AUDMICBIAS0LOWPEN 7\n\n#define RG_AUDPWDBMICBIAS2 8\n#define RG_AUDMICBIAS2VREF 12\n#define RG_AUDMICBIAS2LOWPEN 15\n\n \n#define RG_AUDPWDBMICBIAS1 0\n#define RG_AUDMICBIAS1DCSW1NEN 2\n#define RG_AUDMICBIAS1VREF 4\n#define RG_AUDMICBIAS1LOWPEN 7\n\nenum {\n\tAUDIO_ANALOG_VOLUME_HSOUTL,\n\tAUDIO_ANALOG_VOLUME_HSOUTR,\n\tAUDIO_ANALOG_VOLUME_HPOUTL,\n\tAUDIO_ANALOG_VOLUME_HPOUTR,\n\tAUDIO_ANALOG_VOLUME_LINEOUTL,\n\tAUDIO_ANALOG_VOLUME_LINEOUTR,\n\tAUDIO_ANALOG_VOLUME_MICAMP1,\n\tAUDIO_ANALOG_VOLUME_MICAMP2,\n\tAUDIO_ANALOG_VOLUME_TYPE_MAX\n};\n\n \nenum {\n\tSUPPLY_SUBSEQ_SETTING,\n\tSUPPLY_SUBSEQ_ENABLE,\n\tSUPPLY_SUBSEQ_MICBIAS,\n};\n\n#define REG_STRIDE 2\n\nstruct mt6351_priv {\n\tstruct device *dev;\n\tstruct regmap *regmap;\n\n\tunsigned int dl_rate;\n\tunsigned int ul_rate;\n\n\tint ana_gain[AUDIO_ANALOG_VOLUME_TYPE_MAX];\n\n\tint hp_en_counter;\n};\n\nstatic void set_hp_gain_zero(struct snd_soc_component *cmpnt)\n{\n\tregmap_update_bits(cmpnt->regmap, MT6351_ZCD_CON2,\n\t\t\t   0x1f << 7, 0x8 << 7);\n\tregmap_update_bits(cmpnt->regmap, MT6351_ZCD_CON2,\n\t\t\t   0x1f << 0, 0x8 << 0);\n}\n\nstatic unsigned int get_cap_reg_val(struct snd_soc_component *cmpnt,\n\t\t\t\t    unsigned int rate)\n{\n\tswitch (rate) {\n\tcase 8000:\n\t\treturn 0;\n\tcase 16000:\n\t\treturn 1;\n\tcase 32000:\n\t\treturn 2;\n\tcase 48000:\n\t\treturn 3;\n\tcase 96000:\n\t\treturn 4;\n\tcase 192000:\n\t\treturn 5;\n\tdefault:\n\t\tdev_warn(cmpnt->dev, \"%s(), error rate %d, return 3\",\n\t\t\t __func__, rate);\n\t\treturn 3;\n\t}\n}\n\nstatic unsigned int get_play_reg_val(struct snd_soc_component *cmpnt,\n\t\t\t\t     unsigned int rate)\n{\n\tswitch (rate) {\n\tcase 8000:\n\t\treturn 0;\n\tcase 11025:\n\t\treturn 1;\n\tcase 12000:\n\t\treturn 2;\n\tcase 16000:\n\t\treturn 3;\n\tcase 22050:\n\t\treturn 4;\n\tcase 24000:\n\t\treturn 5;\n\tcase 32000:\n\t\treturn 6;\n\tcase 44100:\n\t\treturn 7;\n\tcase 48000:\n\tcase 96000:\n\tcase 192000:\n\t\treturn 8;\n\tdefault:\n\t\tdev_warn(cmpnt->dev, \"%s(), error rate %d, return 8\",\n\t\t\t __func__, rate);\n\t\treturn 8;\n\t}\n}\n\nstatic int mt6351_codec_dai_hw_params(struct snd_pcm_substream *substream,\n\t\t\t\t      struct snd_pcm_hw_params *params,\n\t\t\t\t      struct snd_soc_dai *dai)\n{\n\tstruct snd_soc_component *cmpnt = dai->component;\n\tstruct mt6351_priv *priv = snd_soc_component_get_drvdata(cmpnt);\n\tunsigned int rate = params_rate(params);\n\n\tdev_dbg(priv->dev, \"%s(), substream->stream %d, rate %d\\n\",\n\t\t__func__, substream->stream, rate);\n\n\tif (substream->stream == SNDRV_PCM_STREAM_PLAYBACK)\n\t\tpriv->dl_rate = rate;\n\telse if (substream->stream == SNDRV_PCM_STREAM_CAPTURE)\n\t\tpriv->ul_rate = rate;\n\n\treturn 0;\n}\n\nstatic const struct snd_soc_dai_ops mt6351_codec_dai_ops = {\n\t.hw_params = mt6351_codec_dai_hw_params,\n};\n\n#define MT6351_FORMATS (SNDRV_PCM_FMTBIT_S16_LE | SNDRV_PCM_FMTBIT_U16_LE |\\\n\t\t\tSNDRV_PCM_FMTBIT_S24_LE | SNDRV_PCM_FMTBIT_U24_LE |\\\n\t\t\tSNDRV_PCM_FMTBIT_S32_LE | SNDRV_PCM_FMTBIT_U32_LE)\n\nstatic struct snd_soc_dai_driver mt6351_dai_driver[] = {\n\t{\n\t\t.name = \"mt6351-snd-codec-aif1\",\n\t\t.playback = {\n\t\t\t.stream_name = \"AIF1 Playback\",\n\t\t\t.channels_min = 1,\n\t\t\t.channels_max = 2,\n\t\t\t.rates = SNDRV_PCM_RATE_8000_48000 |\n\t\t\t\t SNDRV_PCM_RATE_96000 |\n\t\t\t\t SNDRV_PCM_RATE_192000,\n\t\t\t.formats = MT6351_FORMATS,\n\t\t},\n\t\t.capture = {\n\t\t\t.stream_name = \"AIF1 Capture\",\n\t\t\t.channels_min = 1,\n\t\t\t.channels_max = 2,\n\t\t\t.rates = SNDRV_PCM_RATE_8000 |\n\t\t\t\t SNDRV_PCM_RATE_16000 |\n\t\t\t\t SNDRV_PCM_RATE_32000 |\n\t\t\t\t SNDRV_PCM_RATE_48000 |\n\t\t\t\t SNDRV_PCM_RATE_96000 |\n\t\t\t\t SNDRV_PCM_RATE_192000,\n\t\t\t.formats = MT6351_FORMATS,\n\t\t},\n\t\t.ops = &mt6351_codec_dai_ops,\n\t},\n};\n\nenum {\n\tHP_GAIN_SET_ZERO,\n\tHP_GAIN_RESTORE,\n};\n\nstatic void hp_gain_ramp_set(struct snd_soc_component *cmpnt, int hp_gain_ctl)\n{\n\tstruct mt6351_priv *priv = snd_soc_component_get_drvdata(cmpnt);\n\tint idx, old_idx, offset, reg_idx;\n\n\tif (hp_gain_ctl == HP_GAIN_SET_ZERO) {\n\t\tidx = 8;\t \n\t\told_idx = priv->ana_gain[AUDIO_ANALOG_VOLUME_HPOUTL];\n\t} else {\n\t\tidx = priv->ana_gain[AUDIO_ANALOG_VOLUME_HPOUTL];\n\t\told_idx = 8;\t \n\t}\n\tdev_dbg(priv->dev, \"%s(), idx %d, old_idx %d\\n\",\n\t\t__func__, idx, old_idx);\n\n\tif (idx > old_idx)\n\t\toffset = idx - old_idx;\n\telse\n\t\toffset = old_idx - idx;\n\n\treg_idx = old_idx;\n\n\twhile (offset > 0) {\n\t\treg_idx = idx > old_idx ? reg_idx + 1 : reg_idx - 1;\n\n\t\t \n\t\tif ((reg_idx >= 0 && reg_idx <= 0x12) || reg_idx == 0x1f) {\n\t\t\tregmap_update_bits(cmpnt->regmap,\n\t\t\t\t\t   MT6351_ZCD_CON2,\n\t\t\t\t\t   0xf9f,\n\t\t\t\t\t   (reg_idx << 7) | reg_idx);\n\t\t\tusleep_range(100, 120);\n\t\t}\n\t\toffset--;\n\t}\n}\n\nstatic void hp_zcd_enable(struct snd_soc_component *cmpnt)\n{\n\t \n\t \n\tregmap_update_bits(cmpnt->regmap, MT6351_ZCD_CON0, 0x7 << 8, 0x1 << 8);\n\tregmap_update_bits(cmpnt->regmap, MT6351_ZCD_CON0, 0x1 << 7, 0x0 << 7);\n\n\t \n\tregmap_update_bits(cmpnt->regmap, MT6351_ZCD_CON0, 0x1 << 6, 0x1 << 6);\n\n\tregmap_update_bits(cmpnt->regmap, MT6351_ZCD_CON0, 0x3 << 4, 0x0 << 4);\n\tregmap_update_bits(cmpnt->regmap, MT6351_ZCD_CON0, 0x7 << 1, 0x5 << 1);\n\tregmap_update_bits(cmpnt->regmap, MT6351_ZCD_CON0, 0x1 << 0, 0x1 << 0);\n}\n\nstatic void hp_zcd_disable(struct snd_soc_component *cmpnt)\n{\n\tregmap_write(cmpnt->regmap, MT6351_ZCD_CON0, 0x0000);\n}\n\nstatic const DECLARE_TLV_DB_SCALE(playback_tlv, -1000, 100, 0);\nstatic const DECLARE_TLV_DB_SCALE(pga_tlv, 0, 600, 0);\n\nstatic const struct snd_kcontrol_new mt6351_snd_controls[] = {\n\t \n\tSOC_DOUBLE_TLV(\"Headphone Volume\",\n\t\t       MT6351_ZCD_CON2, 0, 7, 0x12, 1,\n\t\t       playback_tlv),\n\tSOC_DOUBLE_TLV(\"Lineout Volume\",\n\t\t       MT6351_ZCD_CON1, 0, 7, 0x12, 1,\n\t\t       playback_tlv),\n\tSOC_SINGLE_TLV(\"Handset Volume\",\n\t\t       MT6351_ZCD_CON3, 0, 0x12, 1,\n\t\t       playback_tlv),\n        \n\tSOC_DOUBLE_R_TLV(\"PGA Volume\",\n\t\t\t MT6351_AUDENC_ANA_CON0, MT6351_AUDENC_ANA_CON1,\n\t\t\t 8, 4, 0,\n\t\t\t pga_tlv),\n};\n\n \n\n \nstatic const char *const lo_in_mux_map[] = {\n\t\"Open\", \"Mute\", \"Playback\", \"Test Mode\",\n};\n\nstatic int lo_in_mux_map_value[] = {\n\t0x0, 0x1, 0x2, 0x3,\n};\n\nstatic SOC_VALUE_ENUM_SINGLE_DECL(lo_in_mux_map_enum,\n\t\t\t\t  MT6351_AUDDEC_ANA_CON3,\n\t\t\t\t  RG_AUDLOLMUXINPUTSEL_VAUDP32_SFT,\n\t\t\t\t  RG_AUDLOLMUXINPUTSEL_VAUDP32_MASK,\n\t\t\t\t  lo_in_mux_map,\n\t\t\t\t  lo_in_mux_map_value);\n\nstatic const struct snd_kcontrol_new lo_in_mux_control =\n\tSOC_DAPM_ENUM(\"In Select\", lo_in_mux_map_enum);\n\n \nstatic const char *const hp_in_mux_map[] = {\n\t\"Open\", \"LoudSPK Playback\", \"Audio Playback\", \"Test Mode\",\n};\n\nstatic int hp_in_mux_map_value[] = {\n\t0x0, 0x1, 0x2, 0x3,\n};\n\nstatic SOC_VALUE_ENUM_SINGLE_DECL(hpl_in_mux_map_enum,\n\t\t\t\t  MT6351_AUDDEC_ANA_CON0,\n\t\t\t\t  RG_AUDHPLMUXINPUTSEL_VAUDP32_SFT,\n\t\t\t\t  RG_AUDHPLMUXINPUTSEL_VAUDP32_MASK,\n\t\t\t\t  hp_in_mux_map,\n\t\t\t\t  hp_in_mux_map_value);\n\nstatic const struct snd_kcontrol_new hpl_in_mux_control =\n\tSOC_DAPM_ENUM(\"HPL Select\", hpl_in_mux_map_enum);\n\nstatic SOC_VALUE_ENUM_SINGLE_DECL(hpr_in_mux_map_enum,\n\t\t\t\t  MT6351_AUDDEC_ANA_CON0,\n\t\t\t\t  RG_AUDHPRMUXINPUTSEL_VAUDP32_SFT,\n\t\t\t\t  RG_AUDHPRMUXINPUTSEL_VAUDP32_MASK,\n\t\t\t\t  hp_in_mux_map,\n\t\t\t\t  hp_in_mux_map_value);\n\nstatic const struct snd_kcontrol_new hpr_in_mux_control =\n\tSOC_DAPM_ENUM(\"HPR Select\", hpr_in_mux_map_enum);\n\n \nstatic const char *const rcv_in_mux_map[] = {\n\t\"Open\", \"Mute\", \"Voice Playback\", \"Test Mode\",\n};\n\nstatic int rcv_in_mux_map_value[] = {\n\t0x0, 0x1, 0x2, 0x3,\n};\n\nstatic SOC_VALUE_ENUM_SINGLE_DECL(rcv_in_mux_map_enum,\n\t\t\t\t  MT6351_AUDDEC_ANA_CON0,\n\t\t\t\t  RG_AUDHSMUXINPUTSEL_VAUDP32_SFT,\n\t\t\t\t  RG_AUDHSMUXINPUTSEL_VAUDP32_MASK,\n\t\t\t\t  rcv_in_mux_map,\n\t\t\t\t  rcv_in_mux_map_value);\n\nstatic const struct snd_kcontrol_new rcv_in_mux_control =\n\tSOC_DAPM_ENUM(\"RCV Select\", rcv_in_mux_map_enum);\n\n \nstatic const char *const dac_in_mux_map[] = {\n\t\"Normal Path\", \"Sgen\",\n};\n\nstatic int dac_in_mux_map_value[] = {\n\t0x0, 0x1,\n};\n\nstatic SOC_VALUE_ENUM_SINGLE_DECL(dac_in_mux_map_enum,\n\t\t\t\t  MT6351_AFE_TOP_CON0,\n\t\t\t\t  RG_DL_SINE_ON_SFT,\n\t\t\t\t  RG_DL_SINE_ON_MASK,\n\t\t\t\t  dac_in_mux_map,\n\t\t\t\t  dac_in_mux_map_value);\n\nstatic const struct snd_kcontrol_new dac_in_mux_control =\n\tSOC_DAPM_ENUM(\"DAC Select\", dac_in_mux_map_enum);\n\n \nstatic SOC_VALUE_ENUM_SINGLE_DECL(aif_out_mux_map_enum,\n\t\t\t\t  MT6351_AFE_TOP_CON0,\n\t\t\t\t  RG_UL_SINE_ON_SFT,\n\t\t\t\t  RG_UL_SINE_ON_MASK,\n\t\t\t\t  dac_in_mux_map,\n\t\t\t\t  dac_in_mux_map_value);\n\nstatic const struct snd_kcontrol_new aif_out_mux_control =\n\tSOC_DAPM_ENUM(\"AIF Out Select\", aif_out_mux_map_enum);\n\n \nstatic const char *const adc_left_mux_map[] = {\n\t\"Idle\", \"AIN0\", \"Left Preamplifier\", \"Idle_1\",\n};\n\nstatic int adc_left_mux_map_value[] = {\n\t0x0, 0x1, 0x2, 0x3,\n};\n\nstatic SOC_VALUE_ENUM_SINGLE_DECL(adc_left_mux_map_enum,\n\t\t\t\t  MT6351_AUDENC_ANA_CON0,\n\t\t\t\t  RG_AUDADCLINPUTSEL_SFT,\n\t\t\t\t  RG_AUDADCLINPUTSEL_MASK,\n\t\t\t\t  adc_left_mux_map,\n\t\t\t\t  adc_left_mux_map_value);\n\nstatic const struct snd_kcontrol_new adc_left_mux_control =\n\tSOC_DAPM_ENUM(\"ADC L Select\", adc_left_mux_map_enum);\n\n \nstatic const char *const adc_right_mux_map[] = {\n\t\"Idle\", \"AIN0\", \"Right Preamplifier\", \"Idle_1\",\n};\n\nstatic int adc_right_mux_map_value[] = {\n\t0x0, 0x1, 0x2, 0x3,\n};\n\nstatic SOC_VALUE_ENUM_SINGLE_DECL(adc_right_mux_map_enum,\n\t\t\t\t  MT6351_AUDENC_ANA_CON1,\n\t\t\t\t  RG_AUDADCRINPUTSEL_SFT,\n\t\t\t\t  RG_AUDADCRINPUTSEL_MASK,\n\t\t\t\t  adc_right_mux_map,\n\t\t\t\t  adc_right_mux_map_value);\n\nstatic const struct snd_kcontrol_new adc_right_mux_control =\n\tSOC_DAPM_ENUM(\"ADC R Select\", adc_right_mux_map_enum);\n\n \nstatic const char *const pga_left_mux_map[] = {\n\t\"None\", \"AIN0\", \"AIN1\", \"AIN2\",\n};\n\nstatic int pga_left_mux_map_value[] = {\n\t0x0, 0x1, 0x2, 0x3,\n};\n\nstatic SOC_VALUE_ENUM_SINGLE_DECL(pga_left_mux_map_enum,\n\t\t\t\t  MT6351_AUDENC_ANA_CON0,\n\t\t\t\t  RG_AUDPREAMPLINPUTSEL_SFT,\n\t\t\t\t  RG_AUDPREAMPLINPUTSEL_MASK,\n\t\t\t\t  pga_left_mux_map,\n\t\t\t\t  pga_left_mux_map_value);\n\nstatic const struct snd_kcontrol_new pga_left_mux_control =\n\tSOC_DAPM_ENUM(\"PGA L Select\", pga_left_mux_map_enum);\n\n \nstatic const char *const pga_right_mux_map[] = {\n\t\"None\", \"AIN0\", \"AIN3\", \"AIN2\",\n};\n\nstatic int pga_right_mux_map_value[] = {\n\t0x0, 0x1, 0x2, 0x3,\n};\n\nstatic SOC_VALUE_ENUM_SINGLE_DECL(pga_right_mux_map_enum,\n\t\t\t\t  MT6351_AUDENC_ANA_CON1,\n\t\t\t\t  RG_AUDPREAMPRINPUTSEL_SFT,\n\t\t\t\t  RG_AUDPREAMPRINPUTSEL_MASK,\n\t\t\t\t  pga_right_mux_map,\n\t\t\t\t  pga_right_mux_map_value);\n\nstatic const struct snd_kcontrol_new pga_right_mux_control =\n\tSOC_DAPM_ENUM(\"PGA R Select\", pga_right_mux_map_enum);\n\nstatic int mt_reg_set_clr_event(struct snd_soc_dapm_widget *w,\n\t\t\t\tstruct snd_kcontrol *kcontrol,\n\t\t\t\tint event)\n{\n\tstruct snd_soc_component *cmpnt = snd_soc_dapm_to_component(w->dapm);\n\n\tswitch (event) {\n\tcase SND_SOC_DAPM_POST_PMU:\n\t\tif (w->on_val) {\n\t\t\t \n\t\t\tregmap_update_bits(cmpnt->regmap,\n\t\t\t\t\t   w->reg + REG_STRIDE,\n\t\t\t\t\t   0x1 << w->shift,\n\t\t\t\t\t   0x1 << w->shift);\n\t\t} else {\n\t\t\t \n\t\t\tregmap_update_bits(cmpnt->regmap,\n\t\t\t\t\t   w->reg + REG_STRIDE * 2,\n\t\t\t\t\t   0x1 << w->shift,\n\t\t\t\t\t   0x1 << w->shift);\n\t\t}\n\t\tbreak;\n\tcase SND_SOC_DAPM_PRE_PMD:\n\t\tif (w->off_val) {\n\t\t\t \n\t\t\tregmap_update_bits(cmpnt->regmap,\n\t\t\t\t\t   w->reg + REG_STRIDE,\n\t\t\t\t\t   0x1 << w->shift,\n\t\t\t\t\t   0x1 << w->shift);\n\t\t} else {\n\t\t\t \n\t\t\tregmap_update_bits(cmpnt->regmap,\n\t\t\t\t\t   w->reg + REG_STRIDE * 2,\n\t\t\t\t\t   0x1 << w->shift,\n\t\t\t\t\t   0x1 << w->shift);\n\t\t}\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n\n\treturn 0;\n}\n\nstatic int mt_ncp_event(struct snd_soc_dapm_widget *w,\n\t\t\tstruct snd_kcontrol *kcontrol,\n\t\t\tint event)\n{\n\tstruct snd_soc_component *cmpnt = snd_soc_dapm_to_component(w->dapm);\n\n\tswitch (event) {\n\tcase SND_SOC_DAPM_PRE_PMU:\n\t\tregmap_update_bits(cmpnt->regmap, MT6351_AFE_NCP_CFG1,\n\t\t\t\t   0xffff, 0x1515);\n\t\t \n\t\tregmap_update_bits(cmpnt->regmap, MT6351_AFE_NCP_CFG0,\n\t\t\t\t   0xfffe, 0x8C00);\n\t\tbreak;\n\tcase SND_SOC_DAPM_POST_PMU:\n\t\tusleep_range(250, 270);\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n\n\treturn 0;\n}\n\nstatic int mt_sgen_event(struct snd_soc_dapm_widget *w,\n\t\t\t struct snd_kcontrol *kcontrol,\n\t\t\t int event)\n{\n\tstruct snd_soc_component *cmpnt = snd_soc_dapm_to_component(w->dapm);\n\n\tswitch (event) {\n\tcase SND_SOC_DAPM_PRE_PMU:\n\t\tregmap_update_bits(cmpnt->regmap, MT6351_AFE_SGEN_CFG0,\n\t\t\t\t   0xffef, 0x0008);\n\t\tregmap_update_bits(cmpnt->regmap, MT6351_AFE_SGEN_CFG1,\n\t\t\t\t   0xffff, 0x0101);\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n\n\treturn 0;\n}\n\nstatic int mt_aif_in_event(struct snd_soc_dapm_widget *w,\n\t\t\t   struct snd_kcontrol *kcontrol,\n\t\t\t   int event)\n{\n\tstruct snd_soc_component *cmpnt = snd_soc_dapm_to_component(w->dapm);\n\tstruct mt6351_priv *priv = snd_soc_component_get_drvdata(cmpnt);\n\n\tdev_dbg(priv->dev, \"%s(), event 0x%x, rate %d\\n\",\n\t\t__func__, event, priv->dl_rate);\n\n\tswitch (event) {\n\tcase SND_SOC_DAPM_PRE_PMU:\n\t\t \n\t\tregmap_update_bits(cmpnt->regmap, MT6351_AFUNC_AUD_CON2,\n\t\t\t\t   0xffff, 0x0006);\n\t\t \n\t\tregmap_update_bits(cmpnt->regmap, MT6351_AFUNC_AUD_CON0,\n\t\t\t\t   0xffff, 0xC3A1);\n\t\t \n\t\tregmap_update_bits(cmpnt->regmap, MT6351_AFUNC_AUD_CON2,\n\t\t\t\t   0xffff, 0x0003);\n\t\t \n\t\tregmap_update_bits(cmpnt->regmap, MT6351_AFUNC_AUD_CON2,\n\t\t\t\t   0xffff, 0x000B);\n\t\t \n\t\tregmap_update_bits(cmpnt->regmap, MT6351_AFE_DL_SDM_CON1,\n\t\t\t\t   0xffff, 0x001E);\n\n\t\tregmap_write(cmpnt->regmap, MT6351_AFE_PMIC_NEWIF_CFG0,\n\t\t\t     (get_play_reg_val(cmpnt, priv->dl_rate) << 12) |\n\t\t\t     0x330);\n\t\tregmap_write(cmpnt->regmap, MT6351_AFE_DL_SRC2_CON0_H,\n\t\t\t     (get_play_reg_val(cmpnt, priv->dl_rate) << 12) |\n\t\t\t     0x300);\n\n\t\tregmap_update_bits(cmpnt->regmap, MT6351_AFE_PMIC_NEWIF_CFG2,\n\t\t\t\t   0x8000, 0x8000);\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n\n\treturn 0;\n}\n\nstatic int mt_hp_event(struct snd_soc_dapm_widget *w,\n\t\t       struct snd_kcontrol *kcontrol,\n\t\t       int event)\n{\n\tstruct snd_soc_component *cmpnt = snd_soc_dapm_to_component(w->dapm);\n\tstruct mt6351_priv *priv = snd_soc_component_get_drvdata(cmpnt);\n\tint reg;\n\n\tdev_dbg(priv->dev, \"%s(), event 0x%x, hp_en_counter %d\\n\",\n\t\t__func__, event, priv->hp_en_counter);\n\n\tswitch (event) {\n\tcase SND_SOC_DAPM_PRE_PMU:\n\t\tpriv->hp_en_counter++;\n\t\tif (priv->hp_en_counter > 1)\n\t\t\tbreak;\t \n\t\telse if (priv->hp_en_counter <= 0)\n\t\t\tdev_err(priv->dev, \"%s(), hp_en_counter %d <= 0\\n\",\n\t\t\t\t__func__,\n\t\t\t\tpriv->hp_en_counter);\n\n\t\thp_zcd_disable(cmpnt);\n\n\t\t \n\t\tregmap_update_bits(cmpnt->regmap, MT6351_AUDDEC_ANA_CON6,\n\t\t\t\t   0x0700, 0x0700);\n\n\t\t \n\t\tregmap_read(cmpnt->regmap, MT6351_ZCD_CON2, &reg);\n\t\tpriv->ana_gain[AUDIO_ANALOG_VOLUME_HPOUTL] = reg & 0x1f;\n\t\tpriv->ana_gain[AUDIO_ANALOG_VOLUME_HPOUTR] = (reg >> 7) & 0x1f;\n\n\t\t \n\t\tregmap_update_bits(cmpnt->regmap,\n\t\t\t\t   MT6351_ZCD_CON2, 0xffff, 0x0F9F);\n\t\t \n\t\tregmap_update_bits(cmpnt->regmap,\n\t\t\t\t   MT6351_ZCD_CON3, 0xffff, 0x001F);\n\t\t \n\t\tregmap_update_bits(cmpnt->regmap, MT6351_AUDDEC_ANA_CON2,\n\t\t\t\t   0x0001, 0x0001);\n\t\t \n\t\tregmap_update_bits(cmpnt->regmap, MT6351_AUDDEC_ANA_CON1,\n\t\t\t\t   0xffff, 0x2000);\n\t\t \n\t\tregmap_update_bits(cmpnt->regmap, MT6351_AUDDEC_ANA_CON1,\n\t\t\t\t   0xffff, 0x2100);\n\t\t \n\t\tregmap_update_bits(cmpnt->regmap, MT6351_AUDDEC_ANA_CON0,\n\t\t\t\t   0x0010, 0xE090);\n\t\t \n\t\tregmap_update_bits(cmpnt->regmap, MT6351_AUDDEC_ANA_CON1,\n\t\t\t\t   0xffff, 0x2140);\n\n\t\tusleep_range(50, 60);\n\n\t\t \n\t\tset_hp_gain_zero(cmpnt);\n\n\t\t \n\t\tregmap_update_bits(cmpnt->regmap, MT6351_AUDDEC_ANA_CON1,\n\t\t\t\t   0xffff, 0x2100);\n\t\t \n\t\tregmap_update_bits(cmpnt->regmap, MT6351_AUDDEC_ANA_CON1,\n\t\t\t\t   0xffff, 0x2000);\n\t\t \n\t\tregmap_update_bits(cmpnt->regmap, MT6351_AUDDEC_ANA_CON0,\n\t\t\t\t   0x0010, 0xF4EF);\n\t\t \n\n\t\t \n\t\tregmap_update_bits(cmpnt->regmap, MT6351_AUDDEC_ANA_CON6,\n\t\t\t\t   0x0700, 0x0300);\n\n\t\t \n\t\t \n\t\thp_zcd_enable(cmpnt);\n\n\t\t \n\t\thp_gain_ramp_set(cmpnt, HP_GAIN_RESTORE);\n\n\t\tbreak;\n\tcase SND_SOC_DAPM_PRE_PMD:\n\t\tpriv->hp_en_counter--;\n\t\tif (priv->hp_en_counter > 0)\n\t\t\tbreak;\t \n\t\telse if (priv->hp_en_counter < 0)\n\t\t\tdev_err(priv->dev, \"%s(), hp_en_counter %d <= 0\\n\",\n\t\t\t\t__func__,\n\t\t\t\tpriv->hp_en_counter);\n\n\t\t \n\t\thp_zcd_disable(cmpnt);\n\n\t\t \n\t\thp_gain_ramp_set(cmpnt, HP_GAIN_SET_ZERO);\n\n\t\tset_hp_gain_zero(cmpnt);\n\t\tbreak;\n\tcase SND_SOC_DAPM_POST_PMD:\n\t\tif (priv->hp_en_counter > 0)\n\t\t\tbreak;\t \n\t\telse if (priv->hp_en_counter < 0)\n\t\t\tdev_err(priv->dev, \"%s(), hp_en_counter %d <= 0\\n\",\n\t\t\t\t__func__,\n\t\t\t\tpriv->hp_en_counter);\n\n\t\t \n\t\tregmap_update_bits(cmpnt->regmap,\n\t\t\t\t   MT6351_AUDDEC_ANA_CON6,\n\t\t\t\t   0x0700,\n\t\t\t\t   0x0000);\n\t\t \n\t\tregmap_update_bits(cmpnt->regmap,\n\t\t\t\t   MT6351_AUDDEC_ANA_CON2,\n\t\t\t\t   0x0001,\n\t\t\t\t   0x0000);\n\n\t\t \n\t\thp_gain_ramp_set(cmpnt, HP_GAIN_RESTORE);\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n\n\treturn 0;\n}\n\nstatic int mt_aif_out_event(struct snd_soc_dapm_widget *w,\n\t\t\t    struct snd_kcontrol *kcontrol,\n\t\t\t    int event)\n{\n\tstruct snd_soc_component *cmpnt = snd_soc_dapm_to_component(w->dapm);\n\tstruct mt6351_priv *priv = snd_soc_component_get_drvdata(cmpnt);\n\n\tdev_dbg(priv->dev, \"%s(), event 0x%x, rate %d\\n\",\n\t\t__func__, event, priv->ul_rate);\n\n\tswitch (event) {\n\tcase SND_SOC_DAPM_PRE_PMU:\n\t\t \n\t\tregmap_update_bits(cmpnt->regmap, MT6351_AFE_DCCLK_CFG0,\n\t\t\t\t   0xffff, 0x2062);\n\t\t \n\t\tregmap_update_bits(cmpnt->regmap, MT6351_AFE_DCCLK_CFG0,\n\t\t\t\t   0xffff, 0x2060);\n\t\t \n\t\tregmap_update_bits(cmpnt->regmap, MT6351_AFE_DCCLK_CFG0,\n\t\t\t\t   0xffff, 0x2061);\n\n\t\t \n\t\tregmap_update_bits(cmpnt->regmap, MT6351_AFE_UL_SRC_CON0_H,\n\t\t\t\t   0x000E,\n\t\t\t\t   get_cap_reg_val(cmpnt, priv->ul_rate) << 1);\n\n\t\t \n\t\tif (priv->ul_rate <= 48000) {\n\t\t\t \n\t\t\tregmap_update_bits(cmpnt->regmap,\n\t\t\t\t\t   MT6351_AFE_HPANC_CFG0,\n\t\t\t\t\t   0x1 << 1,\n\t\t\t\t\t   0x1 << 1);\n\t\t\t \n\t\t\tregmap_update_bits(cmpnt->regmap,\n\t\t\t\t\t   MT6351_AFE_HPANC_CFG0,\n\t\t\t\t\t   0x1 << 0,\n\t\t\t\t\t   0x0 << 0);\n\t\t}\n\t\tbreak;\n\tcase SND_SOC_DAPM_PRE_PMD:\n\t\t \n\t\tif (priv->ul_rate <= 48000) {\n\t\t\t \n\t\t\tregmap_update_bits(cmpnt->regmap,\n\t\t\t\t\t   MT6351_AFE_HPANC_CFG0,\n\t\t\t\t\t   0x1 << 1,\n\t\t\t\t\t   0x0 << 1);\n\t\t\t \n\t\t\tregmap_update_bits(cmpnt->regmap,\n\t\t\t\t\t   MT6351_AFE_HPANC_CFG0,\n\t\t\t\t\t   0x1 << 0,\n\t\t\t\t\t   0x1 << 0);\n\t\t}\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n\n\treturn 0;\n}\n\nstatic int mt_adc_clkgen_event(struct snd_soc_dapm_widget *w,\n\t\t\t       struct snd_kcontrol *kcontrol,\n\t\t\t       int event)\n{\n\tstruct snd_soc_component *cmpnt = snd_soc_dapm_to_component(w->dapm);\n\n\tswitch (event) {\n\tcase SND_SOC_DAPM_PRE_PMU:\n\t\t \n\t\tregmap_update_bits(cmpnt->regmap, MT6351_AUDENC_ANA_CON3,\n\t\t\t\t   0x3 << 4, 0x0);\n\t\tbreak;\n\tcase SND_SOC_DAPM_POST_PMU:\n\t\t \n\t\tregmap_update_bits(cmpnt->regmap, MT6351_AUDENC_ANA_CON3,\n\t\t\t\t   0x3 << 2, 0x0);\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n\treturn 0;\n}\n\nstatic int mt_pga_left_event(struct snd_soc_dapm_widget *w,\n\t\t\t     struct snd_kcontrol *kcontrol,\n\t\t\t     int event)\n{\n\tstruct snd_soc_component *cmpnt = snd_soc_dapm_to_component(w->dapm);\n\n\tswitch (event) {\n\tcase SND_SOC_DAPM_PRE_PMU:\n\t\t \n\t\tregmap_update_bits(cmpnt->regmap, MT6351_AUDENC_ANA_CON0,\n\t\t\t\t   0x3 << RG_AUDPREAMPLDCPRECHARGE,\n\t\t\t\t   0x1 << RG_AUDPREAMPLDCPRECHARGE);\n\t\t \n\t\tregmap_update_bits(cmpnt->regmap, MT6351_AUDENC_ANA_CON0,\n\t\t\t\t   0x3 << RG_AUDPREAMPLDCCEN,\n\t\t\t\t   0x1 << RG_AUDPREAMPLDCCEN);\n\t\tbreak;\n\tcase SND_SOC_DAPM_POST_PMU:\n\t\tusleep_range(100, 120);\n\t\t \n\t\tregmap_update_bits(cmpnt->regmap, MT6351_AUDENC_ANA_CON0,\n\t\t\t\t   0x3 << RG_AUDPREAMPLDCPRECHARGE,\n\t\t\t\t   0x0 << RG_AUDPREAMPLDCPRECHARGE);\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n\treturn 0;\n}\n\nstatic int mt_pga_right_event(struct snd_soc_dapm_widget *w,\n\t\t\t      struct snd_kcontrol *kcontrol,\n\t\t\t      int event)\n{\n\tstruct snd_soc_component *cmpnt = snd_soc_dapm_to_component(w->dapm);\n\n\tswitch (event) {\n\tcase SND_SOC_DAPM_PRE_PMU:\n\t\t \n\t\tregmap_update_bits(cmpnt->regmap, MT6351_AUDENC_ANA_CON1,\n\t\t\t\t   0x3 << RG_AUDPREAMPRDCPRECHARGE,\n\t\t\t\t   0x1 << RG_AUDPREAMPRDCPRECHARGE);\n\t\t \n\t\tregmap_update_bits(cmpnt->regmap, MT6351_AUDENC_ANA_CON1,\n\t\t\t\t   0x3 << RG_AUDPREAMPRDCCEN,\n\t\t\t\t   0x1 << RG_AUDPREAMPRDCCEN);\n\t\tbreak;\n\tcase SND_SOC_DAPM_POST_PMU:\n\t\tusleep_range(100, 120);\n\t\t \n\t\tregmap_update_bits(cmpnt->regmap, MT6351_AUDENC_ANA_CON1,\n\t\t\t\t   0x3 << RG_AUDPREAMPRDCPRECHARGE,\n\t\t\t\t   0x0 << RG_AUDPREAMPRDCPRECHARGE);\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n\treturn 0;\n}\n\nstatic int mt_mic_bias_0_event(struct snd_soc_dapm_widget *w,\n\t\t\t       struct snd_kcontrol *kcontrol,\n\t\t\t       int event)\n{\n\tstruct snd_soc_component *cmpnt = snd_soc_dapm_to_component(w->dapm);\n\n\tswitch (event) {\n\tcase SND_SOC_DAPM_PRE_PMU:\n\t\t \n\t\tregmap_update_bits(cmpnt->regmap, MT6351_AUDENC_ANA_CON9,\n\t\t\t\t   0x3 << RG_AUDMICBIAS0LOWPEN, 0x0);\n\t\t \n\t\tregmap_update_bits(cmpnt->regmap, MT6351_AUDENC_ANA_CON9,\n\t\t\t\t   0x7 << RG_AUDMICBIAS0VREF,\n\t\t\t\t   0x2 << RG_AUDMICBIAS0VREF);\n\t\tbreak;\n\tcase SND_SOC_DAPM_POST_PMD:\n\t\t \n\t\tregmap_update_bits(cmpnt->regmap, MT6351_AUDENC_ANA_CON9,\n\t\t\t\t   0x7 << RG_AUDMICBIAS0VREF,\n\t\t\t\t   0x0 << RG_AUDMICBIAS0VREF);\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n\treturn 0;\n}\n\nstatic int mt_mic_bias_1_event(struct snd_soc_dapm_widget *w,\n\t\t\t       struct snd_kcontrol *kcontrol,\n\t\t\t       int event)\n{\n\tstruct snd_soc_component *cmpnt = snd_soc_dapm_to_component(w->dapm);\n\n\tswitch (event) {\n\tcase SND_SOC_DAPM_PRE_PMU:\n\t\t \n\t\tregmap_update_bits(cmpnt->regmap, MT6351_AUDENC_ANA_CON10,\n\t\t\t\t   0x3 << RG_AUDMICBIAS1LOWPEN, 0x0);\n\t\t \n\t\tregmap_update_bits(cmpnt->regmap, MT6351_AUDENC_ANA_CON10,\n\t\t\t\t   0x7 << RG_AUDMICBIAS1VREF,\n\t\t\t\t   0x7 << RG_AUDMICBIAS1VREF);\n\t\tbreak;\n\tcase SND_SOC_DAPM_POST_PMD:\n\t\t \n\t\tregmap_update_bits(cmpnt->regmap, MT6351_AUDENC_ANA_CON10,\n\t\t\t\t   0x7 << RG_AUDMICBIAS1VREF,\n\t\t\t\t   0x0 << RG_AUDMICBIAS1VREF);\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n\treturn 0;\n}\n\nstatic int mt_mic_bias_2_event(struct snd_soc_dapm_widget *w,\n\t\t\t       struct snd_kcontrol *kcontrol,\n\t\t\t       int event)\n{\n\tstruct snd_soc_component *cmpnt = snd_soc_dapm_to_component(w->dapm);\n\n\tswitch (event) {\n\tcase SND_SOC_DAPM_PRE_PMU:\n\t\t \n\t\tregmap_update_bits(cmpnt->regmap, MT6351_AUDENC_ANA_CON9,\n\t\t\t\t   0x3 << RG_AUDMICBIAS2LOWPEN, 0x0);\n\t\t \n\t\tregmap_update_bits(cmpnt->regmap, MT6351_AUDENC_ANA_CON9,\n\t\t\t\t   0x7 << RG_AUDMICBIAS2VREF,\n\t\t\t\t   0x2 << RG_AUDMICBIAS2VREF);\n\t\tbreak;\n\tcase SND_SOC_DAPM_POST_PMD:\n\t\t \n\t\tregmap_update_bits(cmpnt->regmap, MT6351_AUDENC_ANA_CON9,\n\t\t\t\t   0x7 << RG_AUDMICBIAS2VREF,\n\t\t\t\t   0x0 << RG_AUDMICBIAS2VREF);\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n\treturn 0;\n}\n\n \nstatic const struct snd_soc_dapm_widget mt6351_dapm_widgets[] = {\n\t \n\tSND_SOC_DAPM_SUPPLY(\"AUDIO_TOP_AFE_CTL\", MT6351_AUDIO_TOP_CON0,\n\t\t\t    AUD_TOP_PDN_AFE_CTL_BIT, 1, NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"AUDIO_TOP_DAC_CTL\", MT6351_AUDIO_TOP_CON0,\n\t\t\t    AUD_TOP_PDN_DAC_CTL_BIT, 1, NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"AUDIO_TOP_ADC_CTL\", MT6351_AUDIO_TOP_CON0,\n\t\t\t    AUD_TOP_PDN_ADC_CTL_BIT, 1, NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"AUDIO_TOP_PWR_CLK\", MT6351_AUDIO_TOP_CON0,\n\t\t\t    AUD_TOP_PWR_CLK_DIS_CTL_BIT, 1, NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"AUDIO_TOP_PDN_RESERVED\", MT6351_AUDIO_TOP_CON0,\n\t\t\t    AUD_TOP_PDN_RESERVED_BIT, 1, NULL, 0),\n\n\tSND_SOC_DAPM_SUPPLY(\"NCP\", MT6351_AFE_NCP_CFG0,\n\t\t\t    RG_NCP_ON_BIT, 0,\n\t\t\t    mt_ncp_event,\n\t\t\t    SND_SOC_DAPM_PRE_PMU | SND_SOC_DAPM_POST_PMU),\n\n\tSND_SOC_DAPM_SUPPLY(\"DL Digital Clock\", SND_SOC_NOPM,\n\t\t\t    0, 0, NULL, 0),\n\n\t \n\tSND_SOC_DAPM_SUPPLY(\"AUDGLB\", MT6351_AUDDEC_ANA_CON9,\n\t\t\t    RG_AUDGLB_PWRDN_VA32_BIT, 1, NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"CLKSQ Audio\", MT6351_TOP_CLKSQ,\n\t\t\t    RG_CLKSQ_EN_AUD_BIT, 0,\n\t\t\t    mt_reg_set_clr_event,\n\t\t\t    SND_SOC_DAPM_POST_PMU | SND_SOC_DAPM_PRE_PMD),\n\tSND_SOC_DAPM_SUPPLY(\"ZCD13M_CK\", MT6351_TOP_CKPDN_CON0,\n\t\t\t    RG_ZCD13M_CK_PDN_BIT, 1,\n\t\t\t    mt_reg_set_clr_event,\n\t\t\t    SND_SOC_DAPM_POST_PMU | SND_SOC_DAPM_PRE_PMD),\n\tSND_SOC_DAPM_SUPPLY(\"AUD_CK\", MT6351_TOP_CKPDN_CON0,\n\t\t\t    RG_AUD_CK_PDN_BIT, 1,\n\t\t\t    mt_reg_set_clr_event,\n\t\t\t    SND_SOC_DAPM_POST_PMU | SND_SOC_DAPM_PRE_PMD),\n\tSND_SOC_DAPM_SUPPLY(\"AUDIF_CK\", MT6351_TOP_CKPDN_CON0,\n\t\t\t    RG_AUDIF_CK_PDN_BIT, 1,\n\t\t\t    mt_reg_set_clr_event,\n\t\t\t    SND_SOC_DAPM_POST_PMU | SND_SOC_DAPM_PRE_PMD),\n\tSND_SOC_DAPM_SUPPLY(\"AUDNCP_CK\", MT6351_TOP_CKPDN_CON0,\n\t\t\t    RG_AUDNCP_CK_PDN_BIT, 1,\n\t\t\t    mt_reg_set_clr_event,\n\t\t\t    SND_SOC_DAPM_POST_PMU | SND_SOC_DAPM_PRE_PMD),\n\n\tSND_SOC_DAPM_SUPPLY(\"AFE_ON\", MT6351_AFE_UL_DL_CON0, RG_AFE_ON_BIT, 0,\n\t\t\t    NULL, 0),\n\n\t \n\tSND_SOC_DAPM_AIF_IN_E(\"AIF_RX\", \"AIF1 Playback\", 0,\n\t\t\t      MT6351_AFE_DL_SRC2_CON0_L,\n\t\t\t      RG_DL_2_SRC_ON_TMP_CTL_PRE_BIT, 0,\n\t\t\t      mt_aif_in_event, SND_SOC_DAPM_PRE_PMU),\n\n\t \n\tSND_SOC_DAPM_SUPPLY(\"DL Power Supply\", SND_SOC_NOPM,\n\t\t\t    0, 0, NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"NV Regulator\", MT6351_AUDDEC_ANA_CON10,\n\t\t\t    RG_NVREG_EN_VAUDP32_BIT, 0, NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"AUD_CLK\", MT6351_AUDDEC_ANA_CON9,\n\t\t\t    RG_RSTB_DECODER_VA32_BIT, 0, NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"IBIST\", MT6351_AUDDEC_ANA_CON9,\n\t\t\t    RG_AUDIBIASPWRDN_VAUDP32_BIT, 1, NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"LDO\", MT6351_AUDDEC_ANA_CON9,\n\t\t\t    RG_LCLDO_DEC_EN_VA32_BIT, 0, NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"LDO_REMOTE_SENSE\", MT6351_AUDDEC_ANA_CON9,\n\t\t\t    RG_LCLDO_DEC_REMOTE_SENSE_VA18_BIT, 0, NULL, 0),\n\n\t \n\tSND_SOC_DAPM_MUX(\"DAC In Mux\", SND_SOC_NOPM, 0, 0, &dac_in_mux_control),\n\n\tSND_SOC_DAPM_DAC(\"DACL\", NULL, MT6351_AUDDEC_ANA_CON0,\n\t\t\t RG_AUDDACLPWRUP_VAUDP32_BIT, 0),\n\tSND_SOC_DAPM_SUPPLY(\"DACL_BIASGEN\", MT6351_AUDDEC_ANA_CON0,\n\t\t\t    RG_AUD_DAC_PWL_UP_VA32_BIT, 0, NULL, 0),\n\n\tSND_SOC_DAPM_DAC(\"DACR\", NULL, MT6351_AUDDEC_ANA_CON0,\n\t\t\t RG_AUDDACRPWRUP_VAUDP32_BIT, 0),\n\tSND_SOC_DAPM_SUPPLY(\"DACR_BIASGEN\", MT6351_AUDDEC_ANA_CON0,\n\t\t\t    RG_AUD_DAC_PWR_UP_VA32_BIT, 0, NULL, 0),\n\t \n\tSND_SOC_DAPM_MUX(\"LOL Mux\", SND_SOC_NOPM, 0, 0, &lo_in_mux_control),\n\n\tSND_SOC_DAPM_SUPPLY(\"LO Stability Enh\", MT6351_AUDDEC_ANA_CON3,\n\t\t\t    RG_LOOUTPUTSTBENH_VAUDP32_BIT, 0, NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"LOL Bias Gen\", MT6351_AUDDEC_ANA_CON6,\n\t\t\t    RG_ABIDEC_RSVD0_VAUDP32_LOL_BIT, 0, NULL, 0),\n\n\tSND_SOC_DAPM_OUT_DRV(\"LOL Buffer\", MT6351_AUDDEC_ANA_CON3,\n\t\t\t     RG_AUDLOLPWRUP_VAUDP32_BIT, 0, NULL, 0),\n\n\t \n\tSND_SOC_DAPM_MUX(\"HPL Mux\", SND_SOC_NOPM, 0, 0, &hpl_in_mux_control),\n\tSND_SOC_DAPM_MUX(\"HPR Mux\", SND_SOC_NOPM, 0, 0, &hpr_in_mux_control),\n\n\tSND_SOC_DAPM_OUT_DRV_E(\"HPL Power\", MT6351_AUDDEC_ANA_CON0,\n\t\t\t       RG_AUDHPLPWRUP_VAUDP32_BIT, 0, NULL, 0,\n\t\t\t       mt_hp_event,\n\t\t\t       SND_SOC_DAPM_PRE_PMU |\n\t\t\t       SND_SOC_DAPM_PRE_PMD |\n\t\t\t       SND_SOC_DAPM_POST_PMD),\n\tSND_SOC_DAPM_OUT_DRV_E(\"HPR Power\", MT6351_AUDDEC_ANA_CON0,\n\t\t\t       RG_AUDHPRPWRUP_VAUDP32_BIT, 0, NULL, 0,\n\t\t\t       mt_hp_event,\n\t\t\t       SND_SOC_DAPM_PRE_PMU |\n\t\t\t       SND_SOC_DAPM_PRE_PMD |\n\t\t\t       SND_SOC_DAPM_POST_PMD),\n\n\t \n\tSND_SOC_DAPM_MUX(\"RCV Mux\", SND_SOC_NOPM, 0, 0, &rcv_in_mux_control),\n\n\tSND_SOC_DAPM_SUPPLY(\"RCV Stability Enh\", MT6351_AUDDEC_ANA_CON1,\n\t\t\t    RG_HSOUTPUTSTBENH_VAUDP32_BIT, 0, NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"RCV Bias Gen\", MT6351_AUDDEC_ANA_CON6,\n\t\t\t    RG_ABIDEC_RSVD0_VAUDP32_HS_BIT, 0, NULL, 0),\n\n\tSND_SOC_DAPM_OUT_DRV(\"RCV Buffer\", MT6351_AUDDEC_ANA_CON0,\n\t\t\t     RG_AUDHSPWRUP_VAUDP32_BIT, 0, NULL, 0),\n\n\t \n\tSND_SOC_DAPM_OUTPUT(\"Receiver\"),\n\tSND_SOC_DAPM_OUTPUT(\"Headphone L\"),\n\tSND_SOC_DAPM_OUTPUT(\"Headphone R\"),\n\tSND_SOC_DAPM_OUTPUT(\"LINEOUT L\"),\n\n\t \n\tSND_SOC_DAPM_SUPPLY(\"SGEN DL Enable\", MT6351_AFE_SGEN_CFG0,\n\t\t\t    SGEN_C_DAC_EN_CTL_BIT, 0, NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"SGEN MUTE\", MT6351_AFE_SGEN_CFG0,\n\t\t\t    SGEN_C_MUTE_SW_CTL_BIT, 1,\n\t\t\t    mt_sgen_event, SND_SOC_DAPM_PRE_PMU),\n\tSND_SOC_DAPM_SUPPLY(\"SGEN DL SRC\", MT6351_AFE_DL_SRC2_CON0_L,\n\t\t\t    RG_DL_2_SRC_ON_TMP_CTL_PRE_BIT, 0, NULL, 0),\n\n\tSND_SOC_DAPM_INPUT(\"SGEN DL\"),\n\n\t \n\tSND_SOC_DAPM_AIF_OUT_E(\"AIF1TX\", \"AIF1 Capture\", 0,\n\t\t\t       MT6351_AFE_UL_SRC_CON0_L,\n\t\t\t       UL_SRC_ON_TMP_CTL, 0,\n\t\t\t       mt_aif_out_event,\n\t\t\t       SND_SOC_DAPM_PRE_PMU | SND_SOC_DAPM_PRE_PMD),\n\n\tSND_SOC_DAPM_SUPPLY_S(\"VUSB33_LDO\", SUPPLY_SUBSEQ_ENABLE,\n\t\t\t      MT6351_LDO_VUSB33_CON0, RG_VUSB33_EN, 0,\n\t\t\t      NULL, 0),\n\tSND_SOC_DAPM_SUPPLY_S(\"VUSB33_LDO_CTRL\", SUPPLY_SUBSEQ_SETTING,\n\t\t\t      MT6351_LDO_VUSB33_CON0, RG_VUSB33_ON_CTRL, 1,\n\t\t\t      NULL, 0),\n\n\tSND_SOC_DAPM_SUPPLY_S(\"VA18_LDO\", SUPPLY_SUBSEQ_ENABLE,\n\t\t\t      MT6351_LDO_VA18_CON0, RG_VA18_EN, 0, NULL, 0),\n\tSND_SOC_DAPM_SUPPLY_S(\"VA18_LDO_CTRL\", SUPPLY_SUBSEQ_SETTING,\n\t\t\t      MT6351_LDO_VA18_CON0, RG_VA18_ON_CTRL, 1,\n\t\t\t      NULL, 0),\n\n\tSND_SOC_DAPM_SUPPLY_S(\"ADC CLKGEN\", SUPPLY_SUBSEQ_ENABLE,\n\t\t\t      MT6351_AUDENC_ANA_CON3, RG_AUDADCCLKRSTB, 0,\n\t\t\t      mt_adc_clkgen_event,\n\t\t\t      SND_SOC_DAPM_PRE_PMU | SND_SOC_DAPM_POST_PMU),\n\n\t \n\tSND_SOC_DAPM_MUX(\"AIF Out Mux\", SND_SOC_NOPM, 0, 0,\n\t\t\t &aif_out_mux_control),\n\n\tSND_SOC_DAPM_MUX(\"ADC L Mux\", SND_SOC_NOPM, 0, 0,\n\t\t\t &adc_left_mux_control),\n\tSND_SOC_DAPM_MUX(\"ADC R Mux\", SND_SOC_NOPM, 0, 0,\n\t\t\t &adc_right_mux_control),\n\n\tSND_SOC_DAPM_ADC(\"ADC L\", NULL,\n\t\t\t MT6351_AUDENC_ANA_CON0, RG_AUDADCLPWRUP, 0),\n\tSND_SOC_DAPM_ADC(\"ADC R\", NULL,\n\t\t\t MT6351_AUDENC_ANA_CON1, RG_AUDADCRPWRUP, 0),\n\n\tSND_SOC_DAPM_MUX(\"PGA L Mux\", SND_SOC_NOPM, 0, 0,\n\t\t\t &pga_left_mux_control),\n\tSND_SOC_DAPM_MUX(\"PGA R Mux\", SND_SOC_NOPM, 0, 0,\n\t\t\t &pga_right_mux_control),\n\n\tSND_SOC_DAPM_PGA_E(\"PGA L\", MT6351_AUDENC_ANA_CON0, RG_AUDPREAMPLON, 0,\n\t\t\t   NULL, 0,\n\t\t\t   mt_pga_left_event,\n\t\t\t   SND_SOC_DAPM_PRE_PMU | SND_SOC_DAPM_POST_PMU),\n\tSND_SOC_DAPM_PGA_E(\"PGA R\", MT6351_AUDENC_ANA_CON1, RG_AUDPREAMPRON, 0,\n\t\t\t   NULL, 0,\n\t\t\t   mt_pga_right_event,\n\t\t\t   SND_SOC_DAPM_PRE_PMU | SND_SOC_DAPM_POST_PMU),\n\n\t \n\tSND_SOC_DAPM_SUPPLY_S(\"Mic Bias 0\", SUPPLY_SUBSEQ_MICBIAS,\n\t\t\t      MT6351_AUDENC_ANA_CON9, RG_AUDPWDBMICBIAS0, 0,\n\t\t\t      mt_mic_bias_0_event,\n\t\t\t      SND_SOC_DAPM_PRE_PMU | SND_SOC_DAPM_POST_PMD),\n\t \n\tSND_SOC_DAPM_SUPPLY_S(\"Mic Bias 2\", SUPPLY_SUBSEQ_MICBIAS,\n\t\t\t      MT6351_AUDENC_ANA_CON9, RG_AUDPWDBMICBIAS2, 0,\n\t\t\t      mt_mic_bias_2_event,\n\t\t\t      SND_SOC_DAPM_PRE_PMU | SND_SOC_DAPM_POST_PMD),\n\t \n\tSND_SOC_DAPM_SUPPLY_S(\"Mic Bias 1\", SUPPLY_SUBSEQ_MICBIAS,\n\t\t\t      MT6351_AUDENC_ANA_CON10, RG_AUDPWDBMICBIAS1, 0,\n\t\t\t      mt_mic_bias_1_event,\n\t\t\t      SND_SOC_DAPM_PRE_PMU | SND_SOC_DAPM_POST_PMD),\n\tSND_SOC_DAPM_SUPPLY_S(\"Mic Bias 1 DCC pull high\", SUPPLY_SUBSEQ_MICBIAS,\n\t\t\t      MT6351_AUDENC_ANA_CON10,\n\t\t\t      RG_AUDMICBIAS1DCSW1NEN, 0,\n\t\t\t      NULL, 0),\n\n\t \n\tSND_SOC_DAPM_INPUT(\"AIN0\"),\n\tSND_SOC_DAPM_INPUT(\"AIN1\"),\n\tSND_SOC_DAPM_INPUT(\"AIN2\"),\n\tSND_SOC_DAPM_INPUT(\"AIN3\"),\n};\n\nstatic const struct snd_soc_dapm_route mt6351_dapm_routes[] = {\n\t \n\t{\"AIF1TX\", NULL, \"AIF Out Mux\"},\n\t{\"AIF1TX\", NULL, \"VUSB33_LDO\"},\n\t{\"VUSB33_LDO\", NULL, \"VUSB33_LDO_CTRL\"},\n\t{\"AIF1TX\", NULL, \"VA18_LDO\"},\n\t{\"VA18_LDO\", NULL, \"VA18_LDO_CTRL\"},\n\n\t{\"AIF1TX\", NULL, \"AUDGLB\"},\n\t{\"AIF1TX\", NULL, \"CLKSQ Audio\"},\n\n\t{\"AIF1TX\", NULL, \"AFE_ON\"},\n\n\t{\"AIF1TX\", NULL, \"AUDIO_TOP_AFE_CTL\"},\n\t{\"AIF1TX\", NULL, \"AUDIO_TOP_ADC_CTL\"},\n\t{\"AIF1TX\", NULL, \"AUDIO_TOP_PWR_CLK\"},\n\t{\"AIF1TX\", NULL, \"AUDIO_TOP_PDN_RESERVED\"},\n\n\t{\"AIF Out Mux\", \"Normal Path\", \"ADC L\"},\n\t{\"AIF Out Mux\", \"Normal Path\", \"ADC R\"},\n\n\t{\"ADC L\", NULL, \"ADC L Mux\"},\n\t{\"ADC L\", NULL, \"AUD_CK\"},\n\t{\"ADC L\", NULL, \"AUDIF_CK\"},\n\t{\"ADC L\", NULL, \"ADC CLKGEN\"},\n\t{\"ADC R\", NULL, \"ADC R Mux\"},\n\t{\"ADC R\", NULL, \"AUD_CK\"},\n\t{\"ADC R\", NULL, \"AUDIF_CK\"},\n\t{\"ADC R\", NULL, \"ADC CLKGEN\"},\n\n\t{\"ADC L Mux\", \"AIN0\", \"AIN0\"},\n\t{\"ADC L Mux\", \"Left Preamplifier\", \"PGA L\"},\n\n\t{\"ADC R Mux\", \"AIN0\", \"AIN0\"},\n\t{\"ADC R Mux\", \"Right Preamplifier\", \"PGA R\"},\n\n\t{\"PGA L\", NULL, \"PGA L Mux\"},\n\t{\"PGA R\", NULL, \"PGA R Mux\"},\n\n\t{\"PGA L Mux\", \"AIN0\", \"AIN0\"},\n\t{\"PGA L Mux\", \"AIN1\", \"AIN1\"},\n\t{\"PGA L Mux\", \"AIN2\", \"AIN2\"},\n\n\t{\"PGA R Mux\", \"AIN0\", \"AIN0\"},\n\t{\"PGA R Mux\", \"AIN3\", \"AIN3\"},\n\t{\"PGA R Mux\", \"AIN2\", \"AIN2\"},\n\n\t{\"AIN0\", NULL, \"Mic Bias 0\"},\n\t{\"AIN2\", NULL, \"Mic Bias 2\"},\n\n\t{\"AIN1\", NULL, \"Mic Bias 1\"},\n\t{\"AIN1\", NULL, \"Mic Bias 1 DCC pull high\"},\n\n\t \n\t{\"DL Power Supply\", NULL, \"AUDGLB\"},\n\t{\"DL Power Supply\", NULL, \"CLKSQ Audio\"},\n\t{\"DL Power Supply\", NULL, \"ZCD13M_CK\"},\n\t{\"DL Power Supply\", NULL, \"AUD_CK\"},\n\t{\"DL Power Supply\", NULL, \"AUDIF_CK\"},\n\t{\"DL Power Supply\", NULL, \"AUDNCP_CK\"},\n\n\t{\"DL Power Supply\", NULL, \"NV Regulator\"},\n\t{\"DL Power Supply\", NULL, \"AUD_CLK\"},\n\t{\"DL Power Supply\", NULL, \"IBIST\"},\n\t{\"DL Power Supply\", NULL, \"LDO\"},\n\t{\"LDO\", NULL, \"LDO_REMOTE_SENSE\"},\n\n\t \n\t{\"DL Digital Clock\", NULL, \"AUDIO_TOP_AFE_CTL\"},\n\t{\"DL Digital Clock\", NULL, \"AUDIO_TOP_DAC_CTL\"},\n\t{\"DL Digital Clock\", NULL, \"AUDIO_TOP_PWR_CLK\"},\n\t{\"DL Digital Clock\", NULL, \"AUDIO_TOP_PDN_RESERVED\"},\n\t{\"DL Digital Clock\", NULL, \"NCP\"},\n\t{\"DL Digital Clock\", NULL, \"AFE_ON\"},\n\n\t{\"AIF_RX\", NULL, \"DL Digital Clock\"},\n\n\t \n\t{\"DAC In Mux\", \"Normal Path\", \"AIF_RX\"},\n\n\t{\"DAC In Mux\", \"Sgen\", \"SGEN DL\"},\n\t{\"SGEN DL\", NULL, \"SGEN DL SRC\"},\n\t{\"SGEN DL\", NULL, \"SGEN MUTE\"},\n\t{\"SGEN DL\", NULL, \"SGEN DL Enable\"},\n\t{\"SGEN DL\", NULL, \"DL Digital Clock\"},\n\n\t{\"DACL\", NULL, \"DAC In Mux\"},\n\t{\"DACL\", NULL, \"DL Power Supply\"},\n\t{\"DACL\", NULL, \"DACL_BIASGEN\"},\n\n\t{\"DACR\", NULL, \"DAC In Mux\"},\n\t{\"DACR\", NULL, \"DL Power Supply\"},\n\t{\"DACR\", NULL, \"DACR_BIASGEN\"},\n\n\t{\"LOL Mux\", \"Playback\", \"DACL\"},\n\n\t{\"LOL Buffer\", NULL, \"LOL Mux\"},\n\t{\"LOL Buffer\", NULL, \"LO Stability Enh\"},\n\t{\"LOL Buffer\", NULL, \"LOL Bias Gen\"},\n\n\t{\"LINEOUT L\", NULL, \"LOL Buffer\"},\n\n\t \n\t{\"HPL Mux\", \"Audio Playback\", \"DACL\"},\n\t{\"HPR Mux\", \"Audio Playback\", \"DACR\"},\n\n\t{\"HPL Mux\", \"LoudSPK Playback\", \"DACL\"},\n\t{\"HPR Mux\", \"LoudSPK Playback\", \"DACR\"},\n\n\t{\"HPL Power\", NULL, \"HPL Mux\"},\n\t{\"HPR Power\", NULL, \"HPR Mux\"},\n\n\t{\"Headphone L\", NULL, \"HPL Power\"},\n\t{\"Headphone R\", NULL, \"HPR Power\"},\n\n\t \n\t{\"RCV Mux\", \"Voice Playback\", \"DACL\"},\n\n\t{\"RCV Buffer\", NULL, \"RCV Mux\"},\n\t{\"RCV Buffer\", NULL, \"RCV Stability Enh\"},\n\t{\"RCV Buffer\", NULL, \"RCV Bias Gen\"},\n\n\t{\"Receiver\", NULL, \"RCV Buffer\"},\n};\n\nstatic int mt6351_codec_init_reg(struct snd_soc_component *cmpnt)\n{\n\t \n\tregmap_update_bits(cmpnt->regmap, MT6351_TOP_CLKSQ, 0x0001, 0x0);\n\t \n\tregmap_update_bits(cmpnt->regmap, MT6351_AUDDEC_ANA_CON9,\n\t\t\t   0x1000, 0x1000);\n\t \n\tregmap_update_bits(cmpnt->regmap, MT6351_TOP_CKPDN_CON0_SET,\n\t\t\t   0x3800, 0x3800);\n\t \n\tregmap_update_bits(cmpnt->regmap, MT6351_AUDDEC_ANA_CON0,\n\t\t\t   0xe000, 0xe000);\n\t \n\tregmap_update_bits(cmpnt->regmap, MT6351_AUDDEC_ANA_CON3,\n\t\t\t   0x20, 0x20);\n\t \n\tregmap_update_bits(cmpnt->regmap, MT6351_AFE_PMIC_NEWIF_CFG2,\n\t\t\t   0x8000, 0x8000);\n\treturn 0;\n}\n\nstatic int mt6351_codec_probe(struct snd_soc_component *cmpnt)\n{\n\tstruct mt6351_priv *priv = snd_soc_component_get_drvdata(cmpnt);\n\n\tsnd_soc_component_init_regmap(cmpnt, priv->regmap);\n\n\tmt6351_codec_init_reg(cmpnt);\n\treturn 0;\n}\n\nstatic const struct snd_soc_component_driver mt6351_soc_component_driver = {\n\t.probe = mt6351_codec_probe,\n\t.controls = mt6351_snd_controls,\n\t.num_controls = ARRAY_SIZE(mt6351_snd_controls),\n\t.dapm_widgets = mt6351_dapm_widgets,\n\t.num_dapm_widgets = ARRAY_SIZE(mt6351_dapm_widgets),\n\t.dapm_routes = mt6351_dapm_routes,\n\t.num_dapm_routes = ARRAY_SIZE(mt6351_dapm_routes),\n\t.endianness = 1,\n};\n\nstatic int mt6351_codec_driver_probe(struct platform_device *pdev)\n{\n\tstruct mt6351_priv *priv;\n\n\tpriv = devm_kzalloc(&pdev->dev,\n\t\t\t    sizeof(struct mt6351_priv),\n\t\t\t    GFP_KERNEL);\n\tif (!priv)\n\t\treturn -ENOMEM;\n\n\tdev_set_drvdata(&pdev->dev, priv);\n\n\tpriv->dev = &pdev->dev;\n\n\tpriv->regmap = dev_get_regmap(pdev->dev.parent, NULL);\n\tif (!priv->regmap)\n\t\treturn -ENODEV;\n\n\tdev_dbg(priv->dev, \"%s(), dev name %s\\n\",\n\t\t__func__, dev_name(&pdev->dev));\n\n\treturn devm_snd_soc_register_component(&pdev->dev,\n\t\t\t\t\t       &mt6351_soc_component_driver,\n\t\t\t\t\t       mt6351_dai_driver,\n\t\t\t\t\t       ARRAY_SIZE(mt6351_dai_driver));\n}\n\nstatic const struct of_device_id mt6351_of_match[] = {\n\t{.compatible = \"mediatek,mt6351-sound\",},\n\t{}\n};\n\nstatic struct platform_driver mt6351_codec_driver = {\n\t.driver = {\n\t\t.name = \"mt6351-sound\",\n\t\t.of_match_table = mt6351_of_match,\n\t},\n\t.probe = mt6351_codec_driver_probe,\n};\n\nmodule_platform_driver(mt6351_codec_driver)\n\n \nMODULE_DESCRIPTION(\"MT6351 ALSA SoC codec driver\");\nMODULE_AUTHOR(\"KaiChieh Chuang <kaichieh.chuang@mediatek.com>\");\nMODULE_LICENSE(\"GPL v2\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}