{
  "module_name": "alc5623.c",
  "hash_id": "b9b1440596cbeeb052cafae491d31d3859215f0d909dbc12a263a439a667111c",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/codecs/alc5623.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/init.h>\n#include <linux/delay.h>\n#include <linux/pm.h>\n#include <linux/i2c.h>\n#include <linux/regmap.h>\n#include <linux/slab.h>\n#include <linux/of.h>\n#include <sound/core.h>\n#include <sound/pcm.h>\n#include <sound/pcm_params.h>\n#include <sound/tlv.h>\n#include <sound/soc.h>\n#include <sound/initval.h>\n#include <sound/alc5623.h>\n\n#include \"alc5623.h\"\n\nstatic int caps_charge = 2000;\nmodule_param(caps_charge, int, 0);\nMODULE_PARM_DESC(caps_charge, \"ALC5623 cap charge time (msecs)\");\n\n \nstruct alc5623_priv {\n\tstruct regmap *regmap;\n\tu8 id;\n\tunsigned int sysclk;\n\tunsigned int add_ctrl;\n\tunsigned int jack_det_ctrl;\n};\n\nstatic inline int alc5623_reset(struct snd_soc_component *component)\n{\n\treturn snd_soc_component_write(component, ALC5623_RESET, 0);\n}\n\nstatic int amp_mixer_event(struct snd_soc_dapm_widget *w,\n\tstruct snd_kcontrol *kcontrol, int event)\n{\n\tstruct snd_soc_component *component = snd_soc_dapm_to_component(w->dapm);\n\n\t \n\t \n\t \n\t \n\tsnd_soc_component_write(component, ALC5623_HID_CTRL_INDEX, 0x46);\n\n\tswitch (event) {\n\tcase SND_SOC_DAPM_PRE_PMU:\n\t\tsnd_soc_component_write(component, ALC5623_HID_CTRL_DATA, 0xFFFF);\n\t\tbreak;\n\tcase SND_SOC_DAPM_POST_PMD:\n\t\tsnd_soc_component_write(component, ALC5623_HID_CTRL_DATA, 0);\n\t\tbreak;\n\t}\n\n\treturn 0;\n}\n\n \n\nstatic const DECLARE_TLV_DB_SCALE(vol_tlv, -3450, 150, 0);\nstatic const DECLARE_TLV_DB_SCALE(hp_tlv, -4650, 150, 0);\nstatic const DECLARE_TLV_DB_SCALE(adc_rec_tlv, -1650, 150, 0);\nstatic const DECLARE_TLV_DB_RANGE(boost_tlv,\n\t0, 0, TLV_DB_SCALE_ITEM(0, 0, 0),\n\t1, 1, TLV_DB_SCALE_ITEM(2000, 0, 0),\n\t2, 2, TLV_DB_SCALE_ITEM(3000, 0, 0)\n);\nstatic const DECLARE_TLV_DB_SCALE(dig_tlv, 0, 600, 0);\n\nstatic const struct snd_kcontrol_new alc5621_vol_snd_controls[] = {\n\tSOC_DOUBLE_TLV(\"Speaker Playback Volume\",\n\t\t\tALC5623_SPK_OUT_VOL, 8, 0, 31, 1, hp_tlv),\n\tSOC_DOUBLE(\"Speaker Playback Switch\",\n\t\t\tALC5623_SPK_OUT_VOL, 15, 7, 1, 1),\n\tSOC_DOUBLE_TLV(\"Headphone Playback Volume\",\n\t\t\tALC5623_HP_OUT_VOL, 8, 0, 31, 1, hp_tlv),\n\tSOC_DOUBLE(\"Headphone Playback Switch\",\n\t\t\tALC5623_HP_OUT_VOL, 15, 7, 1, 1),\n};\n\nstatic const struct snd_kcontrol_new alc5622_vol_snd_controls[] = {\n\tSOC_DOUBLE_TLV(\"Speaker Playback Volume\",\n\t\t\tALC5623_SPK_OUT_VOL, 8, 0, 31, 1, hp_tlv),\n\tSOC_DOUBLE(\"Speaker Playback Switch\",\n\t\t\tALC5623_SPK_OUT_VOL, 15, 7, 1, 1),\n\tSOC_DOUBLE_TLV(\"Line Playback Volume\",\n\t\t\tALC5623_HP_OUT_VOL, 8, 0, 31, 1, hp_tlv),\n\tSOC_DOUBLE(\"Line Playback Switch\",\n\t\t\tALC5623_HP_OUT_VOL, 15, 7, 1, 1),\n};\n\nstatic const struct snd_kcontrol_new alc5623_vol_snd_controls[] = {\n\tSOC_DOUBLE_TLV(\"Line Playback Volume\",\n\t\t\tALC5623_SPK_OUT_VOL, 8, 0, 31, 1, hp_tlv),\n\tSOC_DOUBLE(\"Line Playback Switch\",\n\t\t\tALC5623_SPK_OUT_VOL, 15, 7, 1, 1),\n\tSOC_DOUBLE_TLV(\"Headphone Playback Volume\",\n\t\t\tALC5623_HP_OUT_VOL, 8, 0, 31, 1, hp_tlv),\n\tSOC_DOUBLE(\"Headphone Playback Switch\",\n\t\t\tALC5623_HP_OUT_VOL, 15, 7, 1, 1),\n};\n\nstatic const struct snd_kcontrol_new alc5623_snd_controls[] = {\n\tSOC_DOUBLE_TLV(\"Auxout Playback Volume\",\n\t\t\tALC5623_MONO_AUX_OUT_VOL, 8, 0, 31, 1, hp_tlv),\n\tSOC_DOUBLE(\"Auxout Playback Switch\",\n\t\t\tALC5623_MONO_AUX_OUT_VOL, 15, 7, 1, 1),\n\tSOC_DOUBLE_TLV(\"PCM Playback Volume\",\n\t\t\tALC5623_STEREO_DAC_VOL, 8, 0, 31, 1, vol_tlv),\n\tSOC_DOUBLE_TLV(\"AuxI Capture Volume\",\n\t\t\tALC5623_AUXIN_VOL, 8, 0, 31, 1, vol_tlv),\n\tSOC_DOUBLE_TLV(\"LineIn Capture Volume\",\n\t\t\tALC5623_LINE_IN_VOL, 8, 0, 31, 1, vol_tlv),\n\tSOC_SINGLE_TLV(\"Mic1 Capture Volume\",\n\t\t\tALC5623_MIC_VOL, 8, 31, 1, vol_tlv),\n\tSOC_SINGLE_TLV(\"Mic2 Capture Volume\",\n\t\t\tALC5623_MIC_VOL, 0, 31, 1, vol_tlv),\n\tSOC_DOUBLE_TLV(\"Rec Capture Volume\",\n\t\t\tALC5623_ADC_REC_GAIN, 7, 0, 31, 0, adc_rec_tlv),\n\tSOC_SINGLE_TLV(\"Mic 1 Boost Volume\",\n\t\t\tALC5623_MIC_CTRL, 10, 2, 0, boost_tlv),\n\tSOC_SINGLE_TLV(\"Mic 2 Boost Volume\",\n\t\t\tALC5623_MIC_CTRL, 8, 2, 0, boost_tlv),\n\tSOC_SINGLE_TLV(\"Digital Boost Volume\",\n\t\t\tALC5623_ADD_CTRL_REG, 4, 3, 0, dig_tlv),\n};\n\n \nstatic const struct snd_kcontrol_new alc5623_hp_mixer_controls[] = {\nSOC_DAPM_SINGLE(\"LI2HP Playback Switch\", ALC5623_LINE_IN_VOL, 15, 1, 1),\nSOC_DAPM_SINGLE(\"AUXI2HP Playback Switch\", ALC5623_AUXIN_VOL, 15, 1, 1),\nSOC_DAPM_SINGLE(\"MIC12HP Playback Switch\", ALC5623_MIC_ROUTING_CTRL, 15, 1, 1),\nSOC_DAPM_SINGLE(\"MIC22HP Playback Switch\", ALC5623_MIC_ROUTING_CTRL, 7, 1, 1),\nSOC_DAPM_SINGLE(\"DAC2HP Playback Switch\", ALC5623_STEREO_DAC_VOL, 15, 1, 1),\n};\n\nstatic const struct snd_kcontrol_new alc5623_hpl_mixer_controls[] = {\nSOC_DAPM_SINGLE(\"ADC2HP_L Playback Switch\", ALC5623_ADC_REC_GAIN, 15, 1, 1),\n};\n\nstatic const struct snd_kcontrol_new alc5623_hpr_mixer_controls[] = {\nSOC_DAPM_SINGLE(\"ADC2HP_R Playback Switch\", ALC5623_ADC_REC_GAIN, 14, 1, 1),\n};\n\nstatic const struct snd_kcontrol_new alc5623_mono_mixer_controls[] = {\nSOC_DAPM_SINGLE(\"ADC2MONO_L Playback Switch\", ALC5623_ADC_REC_GAIN, 13, 1, 1),\nSOC_DAPM_SINGLE(\"ADC2MONO_R Playback Switch\", ALC5623_ADC_REC_GAIN, 12, 1, 1),\nSOC_DAPM_SINGLE(\"LI2MONO Playback Switch\", ALC5623_LINE_IN_VOL, 13, 1, 1),\nSOC_DAPM_SINGLE(\"AUXI2MONO Playback Switch\", ALC5623_AUXIN_VOL, 13, 1, 1),\nSOC_DAPM_SINGLE(\"MIC12MONO Playback Switch\", ALC5623_MIC_ROUTING_CTRL, 13, 1, 1),\nSOC_DAPM_SINGLE(\"MIC22MONO Playback Switch\", ALC5623_MIC_ROUTING_CTRL, 5, 1, 1),\nSOC_DAPM_SINGLE(\"DAC2MONO Playback Switch\", ALC5623_STEREO_DAC_VOL, 13, 1, 1),\n};\n\nstatic const struct snd_kcontrol_new alc5623_speaker_mixer_controls[] = {\nSOC_DAPM_SINGLE(\"LI2SPK Playback Switch\", ALC5623_LINE_IN_VOL, 14, 1, 1),\nSOC_DAPM_SINGLE(\"AUXI2SPK Playback Switch\", ALC5623_AUXIN_VOL, 14, 1, 1),\nSOC_DAPM_SINGLE(\"MIC12SPK Playback Switch\", ALC5623_MIC_ROUTING_CTRL, 14, 1, 1),\nSOC_DAPM_SINGLE(\"MIC22SPK Playback Switch\", ALC5623_MIC_ROUTING_CTRL, 6, 1, 1),\nSOC_DAPM_SINGLE(\"DAC2SPK Playback Switch\", ALC5623_STEREO_DAC_VOL, 14, 1, 1),\n};\n\n \nstatic const struct snd_kcontrol_new alc5623_captureL_mixer_controls[] = {\nSOC_DAPM_SINGLE(\"Mic1 Capture Switch\", ALC5623_ADC_REC_MIXER, 14, 1, 1),\nSOC_DAPM_SINGLE(\"Mic2 Capture Switch\", ALC5623_ADC_REC_MIXER, 13, 1, 1),\nSOC_DAPM_SINGLE(\"LineInL Capture Switch\", ALC5623_ADC_REC_MIXER, 12, 1, 1),\nSOC_DAPM_SINGLE(\"Left AuxI Capture Switch\", ALC5623_ADC_REC_MIXER, 11, 1, 1),\nSOC_DAPM_SINGLE(\"HPMixerL Capture Switch\", ALC5623_ADC_REC_MIXER, 10, 1, 1),\nSOC_DAPM_SINGLE(\"SPKMixer Capture Switch\", ALC5623_ADC_REC_MIXER, 9, 1, 1),\nSOC_DAPM_SINGLE(\"MonoMixer Capture Switch\", ALC5623_ADC_REC_MIXER, 8, 1, 1),\n};\n\n \nstatic const struct snd_kcontrol_new alc5623_captureR_mixer_controls[] = {\nSOC_DAPM_SINGLE(\"Mic1 Capture Switch\", ALC5623_ADC_REC_MIXER, 6, 1, 1),\nSOC_DAPM_SINGLE(\"Mic2 Capture Switch\", ALC5623_ADC_REC_MIXER, 5, 1, 1),\nSOC_DAPM_SINGLE(\"LineInR Capture Switch\", ALC5623_ADC_REC_MIXER, 4, 1, 1),\nSOC_DAPM_SINGLE(\"Right AuxI Capture Switch\", ALC5623_ADC_REC_MIXER, 3, 1, 1),\nSOC_DAPM_SINGLE(\"HPMixerR Capture Switch\", ALC5623_ADC_REC_MIXER, 2, 1, 1),\nSOC_DAPM_SINGLE(\"SPKMixer Capture Switch\", ALC5623_ADC_REC_MIXER, 1, 1, 1),\nSOC_DAPM_SINGLE(\"MonoMixer Capture Switch\", ALC5623_ADC_REC_MIXER, 0, 1, 1),\n};\n\nstatic const char *alc5623_spk_n_sour_sel[] = {\n\t\t\"RN/-R\", \"RP/+R\", \"LN/-R\", \"Vmid\" };\nstatic const char *alc5623_hpl_out_input_sel[] = {\n\t\t\"Vmid\", \"HP Left Mix\"};\nstatic const char *alc5623_hpr_out_input_sel[] = {\n\t\t\"Vmid\", \"HP Right Mix\"};\nstatic const char *alc5623_spkout_input_sel[] = {\n\t\t\"Vmid\", \"HPOut Mix\", \"Speaker Mix\", \"Mono Mix\"};\nstatic const char *alc5623_aux_out_input_sel[] = {\n\t\t\"Vmid\", \"HPOut Mix\", \"Speaker Mix\", \"Mono Mix\"};\n\n \nstatic SOC_ENUM_SINGLE_DECL(alc5623_aux_out_input_enum,\n\t\t\t    ALC5623_OUTPUT_MIXER_CTRL, 6,\n\t\t\t    alc5623_aux_out_input_sel);\nstatic const struct snd_kcontrol_new alc5623_auxout_mux_controls =\nSOC_DAPM_ENUM(\"Route\", alc5623_aux_out_input_enum);\n\n \nstatic SOC_ENUM_SINGLE_DECL(alc5623_spkout_input_enum,\n\t\t\t    ALC5623_OUTPUT_MIXER_CTRL, 10,\n\t\t\t    alc5623_spkout_input_sel);\nstatic const struct snd_kcontrol_new alc5623_spkout_mux_controls =\nSOC_DAPM_ENUM(\"Route\", alc5623_spkout_input_enum);\n\n \nstatic SOC_ENUM_SINGLE_DECL(alc5623_hpl_out_input_enum,\n\t\t\t    ALC5623_OUTPUT_MIXER_CTRL, 9,\n\t\t\t    alc5623_hpl_out_input_sel);\nstatic const struct snd_kcontrol_new alc5623_hpl_out_mux_controls =\nSOC_DAPM_ENUM(\"Route\", alc5623_hpl_out_input_enum);\n\n \nstatic SOC_ENUM_SINGLE_DECL(alc5623_hpr_out_input_enum,\n\t\t\t    ALC5623_OUTPUT_MIXER_CTRL, 8,\n\t\t\t    alc5623_hpr_out_input_sel);\nstatic const struct snd_kcontrol_new alc5623_hpr_out_mux_controls =\nSOC_DAPM_ENUM(\"Route\", alc5623_hpr_out_input_enum);\n\n \nstatic SOC_ENUM_SINGLE_DECL(alc5623_spk_n_sour_enum,\n\t\t\t    ALC5623_OUTPUT_MIXER_CTRL, 14,\n\t\t\t    alc5623_spk_n_sour_sel);\nstatic const struct snd_kcontrol_new alc5623_spkoutn_mux_controls =\nSOC_DAPM_ENUM(\"Route\", alc5623_spk_n_sour_enum);\n\nstatic const struct snd_soc_dapm_widget alc5623_dapm_widgets[] = {\n \nSND_SOC_DAPM_MUX(\"AuxOut Mux\", SND_SOC_NOPM, 0, 0,\n\t&alc5623_auxout_mux_controls),\nSND_SOC_DAPM_MUX(\"SpeakerOut Mux\", SND_SOC_NOPM, 0, 0,\n\t&alc5623_spkout_mux_controls),\nSND_SOC_DAPM_MUX(\"Left Headphone Mux\", SND_SOC_NOPM, 0, 0,\n\t&alc5623_hpl_out_mux_controls),\nSND_SOC_DAPM_MUX(\"Right Headphone Mux\", SND_SOC_NOPM, 0, 0,\n\t&alc5623_hpr_out_mux_controls),\nSND_SOC_DAPM_MUX(\"SpeakerOut N Mux\", SND_SOC_NOPM, 0, 0,\n\t&alc5623_spkoutn_mux_controls),\n\n \nSND_SOC_DAPM_MIXER(\"HP Mix\", SND_SOC_NOPM, 0, 0,\n\t&alc5623_hp_mixer_controls[0],\n\tARRAY_SIZE(alc5623_hp_mixer_controls)),\nSND_SOC_DAPM_MIXER(\"HPR Mix\", ALC5623_PWR_MANAG_ADD2, 4, 0,\n\t&alc5623_hpr_mixer_controls[0],\n\tARRAY_SIZE(alc5623_hpr_mixer_controls)),\nSND_SOC_DAPM_MIXER(\"HPL Mix\", ALC5623_PWR_MANAG_ADD2, 5, 0,\n\t&alc5623_hpl_mixer_controls[0],\n\tARRAY_SIZE(alc5623_hpl_mixer_controls)),\nSND_SOC_DAPM_MIXER(\"HPOut Mix\", SND_SOC_NOPM, 0, 0, NULL, 0),\nSND_SOC_DAPM_MIXER(\"Mono Mix\", ALC5623_PWR_MANAG_ADD2, 2, 0,\n\t&alc5623_mono_mixer_controls[0],\n\tARRAY_SIZE(alc5623_mono_mixer_controls)),\nSND_SOC_DAPM_MIXER(\"Speaker Mix\", ALC5623_PWR_MANAG_ADD2, 3, 0,\n\t&alc5623_speaker_mixer_controls[0],\n\tARRAY_SIZE(alc5623_speaker_mixer_controls)),\n\n \nSND_SOC_DAPM_MIXER(\"Left Capture Mix\", ALC5623_PWR_MANAG_ADD2, 1, 0,\n\t&alc5623_captureL_mixer_controls[0],\n\tARRAY_SIZE(alc5623_captureL_mixer_controls)),\nSND_SOC_DAPM_MIXER(\"Right Capture Mix\", ALC5623_PWR_MANAG_ADD2, 0, 0,\n\t&alc5623_captureR_mixer_controls[0],\n\tARRAY_SIZE(alc5623_captureR_mixer_controls)),\n\nSND_SOC_DAPM_DAC(\"Left DAC\", \"Left HiFi Playback\",\n\tALC5623_PWR_MANAG_ADD2, 9, 0),\nSND_SOC_DAPM_DAC(\"Right DAC\", \"Right HiFi Playback\",\n\tALC5623_PWR_MANAG_ADD2, 8, 0),\nSND_SOC_DAPM_MIXER(\"I2S Mix\", ALC5623_PWR_MANAG_ADD1, 15, 0, NULL, 0),\nSND_SOC_DAPM_MIXER(\"AuxI Mix\", SND_SOC_NOPM, 0, 0, NULL, 0),\nSND_SOC_DAPM_MIXER(\"Line Mix\", SND_SOC_NOPM, 0, 0, NULL, 0),\nSND_SOC_DAPM_ADC(\"Left ADC\", \"Left HiFi Capture\",\n\tALC5623_PWR_MANAG_ADD2, 7, 0),\nSND_SOC_DAPM_ADC(\"Right ADC\", \"Right HiFi Capture\",\n\tALC5623_PWR_MANAG_ADD2, 6, 0),\nSND_SOC_DAPM_PGA(\"Left Headphone\", ALC5623_PWR_MANAG_ADD3, 10, 0, NULL, 0),\nSND_SOC_DAPM_PGA(\"Right Headphone\", ALC5623_PWR_MANAG_ADD3, 9, 0, NULL, 0),\nSND_SOC_DAPM_PGA(\"SpeakerOut\", ALC5623_PWR_MANAG_ADD3, 12, 0, NULL, 0),\nSND_SOC_DAPM_PGA(\"Left AuxOut\", ALC5623_PWR_MANAG_ADD3, 14, 0, NULL, 0),\nSND_SOC_DAPM_PGA(\"Right AuxOut\", ALC5623_PWR_MANAG_ADD3, 13, 0, NULL, 0),\nSND_SOC_DAPM_PGA(\"Left LineIn\", ALC5623_PWR_MANAG_ADD3, 7, 0, NULL, 0),\nSND_SOC_DAPM_PGA(\"Right LineIn\", ALC5623_PWR_MANAG_ADD3, 6, 0, NULL, 0),\nSND_SOC_DAPM_PGA(\"Left AuxI\", ALC5623_PWR_MANAG_ADD3, 5, 0, NULL, 0),\nSND_SOC_DAPM_PGA(\"Right AuxI\", ALC5623_PWR_MANAG_ADD3, 4, 0, NULL, 0),\nSND_SOC_DAPM_PGA(\"MIC1 PGA\", ALC5623_PWR_MANAG_ADD3, 3, 0, NULL, 0),\nSND_SOC_DAPM_PGA(\"MIC2 PGA\", ALC5623_PWR_MANAG_ADD3, 2, 0, NULL, 0),\nSND_SOC_DAPM_PGA(\"MIC1 Pre Amp\", ALC5623_PWR_MANAG_ADD3, 1, 0, NULL, 0),\nSND_SOC_DAPM_PGA(\"MIC2 Pre Amp\", ALC5623_PWR_MANAG_ADD3, 0, 0, NULL, 0),\nSND_SOC_DAPM_MICBIAS(\"Mic Bias1\", ALC5623_PWR_MANAG_ADD1, 11, 0),\n\nSND_SOC_DAPM_OUTPUT(\"AUXOUTL\"),\nSND_SOC_DAPM_OUTPUT(\"AUXOUTR\"),\nSND_SOC_DAPM_OUTPUT(\"HPL\"),\nSND_SOC_DAPM_OUTPUT(\"HPR\"),\nSND_SOC_DAPM_OUTPUT(\"SPKOUT\"),\nSND_SOC_DAPM_OUTPUT(\"SPKOUTN\"),\nSND_SOC_DAPM_INPUT(\"LINEINL\"),\nSND_SOC_DAPM_INPUT(\"LINEINR\"),\nSND_SOC_DAPM_INPUT(\"AUXINL\"),\nSND_SOC_DAPM_INPUT(\"AUXINR\"),\nSND_SOC_DAPM_INPUT(\"MIC1\"),\nSND_SOC_DAPM_INPUT(\"MIC2\"),\nSND_SOC_DAPM_VMID(\"Vmid\"),\n};\n\nstatic const char *alc5623_amp_names[] = {\"AB Amp\", \"D Amp\"};\nstatic SOC_ENUM_SINGLE_DECL(alc5623_amp_enum,\n\t\t\t    ALC5623_OUTPUT_MIXER_CTRL, 13,\n\t\t\t    alc5623_amp_names);\nstatic const struct snd_kcontrol_new alc5623_amp_mux_controls =\n\tSOC_DAPM_ENUM(\"Route\", alc5623_amp_enum);\n\nstatic const struct snd_soc_dapm_widget alc5623_dapm_amp_widgets[] = {\nSND_SOC_DAPM_PGA_E(\"D Amp\", ALC5623_PWR_MANAG_ADD2, 14, 0, NULL, 0,\n\tamp_mixer_event, SND_SOC_DAPM_PRE_PMU | SND_SOC_DAPM_POST_PMD),\nSND_SOC_DAPM_PGA(\"AB Amp\", ALC5623_PWR_MANAG_ADD2, 15, 0, NULL, 0),\nSND_SOC_DAPM_MUX(\"AB-D Amp Mux\", SND_SOC_NOPM, 0, 0,\n\t&alc5623_amp_mux_controls),\n};\n\nstatic const struct snd_soc_dapm_route intercon[] = {\n\t \n\t{\"I2S Mix\", NULL,\t\t\t\t\"Left DAC\"},\n\t{\"I2S Mix\", NULL,\t\t\t\t\"Right DAC\"},\n\t{\"Line Mix\", NULL,\t\t\t\t\"Right LineIn\"},\n\t{\"Line Mix\", NULL,\t\t\t\t\"Left LineIn\"},\n\t{\"AuxI Mix\", NULL,\t\t\t\t\"Left AuxI\"},\n\t{\"AuxI Mix\", NULL,\t\t\t\t\"Right AuxI\"},\n\t{\"AUXOUTL\", NULL,\t\t\t\t\"Left AuxOut\"},\n\t{\"AUXOUTR\", NULL,\t\t\t\t\"Right AuxOut\"},\n\n\t \n\t{\"HPL Mix\", \"ADC2HP_L Playback Switch\",\t\t\"Left Capture Mix\"},\n\t{\"HPL Mix\", NULL,\t\t\t\t\"HP Mix\"},\n\t{\"HPR Mix\", \"ADC2HP_R Playback Switch\",\t\t\"Right Capture Mix\"},\n\t{\"HPR Mix\", NULL,\t\t\t\t\"HP Mix\"},\n\t{\"HP Mix\", \"LI2HP Playback Switch\",\t\t\"Line Mix\"},\n\t{\"HP Mix\", \"AUXI2HP Playback Switch\",\t\t\"AuxI Mix\"},\n\t{\"HP Mix\", \"MIC12HP Playback Switch\",\t\t\"MIC1 PGA\"},\n\t{\"HP Mix\", \"MIC22HP Playback Switch\",\t\t\"MIC2 PGA\"},\n\t{\"HP Mix\", \"DAC2HP Playback Switch\",\t\t\"I2S Mix\"},\n\n\t \n\t{\"Speaker Mix\", \"LI2SPK Playback Switch\",\t\"Line Mix\"},\n\t{\"Speaker Mix\", \"AUXI2SPK Playback Switch\",\t\"AuxI Mix\"},\n\t{\"Speaker Mix\", \"MIC12SPK Playback Switch\",\t\"MIC1 PGA\"},\n\t{\"Speaker Mix\", \"MIC22SPK Playback Switch\",\t\"MIC2 PGA\"},\n\t{\"Speaker Mix\", \"DAC2SPK Playback Switch\",\t\"I2S Mix\"},\n\n\t \n\t{\"Mono Mix\", \"ADC2MONO_L Playback Switch\",\t\"Left Capture Mix\"},\n\t{\"Mono Mix\", \"ADC2MONO_R Playback Switch\",\t\"Right Capture Mix\"},\n\t{\"Mono Mix\", \"LI2MONO Playback Switch\",\t\t\"Line Mix\"},\n\t{\"Mono Mix\", \"AUXI2MONO Playback Switch\",\t\"AuxI Mix\"},\n\t{\"Mono Mix\", \"MIC12MONO Playback Switch\",\t\"MIC1 PGA\"},\n\t{\"Mono Mix\", \"MIC22MONO Playback Switch\",\t\"MIC2 PGA\"},\n\t{\"Mono Mix\", \"DAC2MONO Playback Switch\",\t\"I2S Mix\"},\n\n\t \n\t{\"Left Capture Mix\", \"LineInL Capture Switch\",\t\"LINEINL\"},\n\t{\"Left Capture Mix\", \"Left AuxI Capture Switch\", \"AUXINL\"},\n\t{\"Left Capture Mix\", \"Mic1 Capture Switch\",\t\"MIC1 Pre Amp\"},\n\t{\"Left Capture Mix\", \"Mic2 Capture Switch\",\t\"MIC2 Pre Amp\"},\n\t{\"Left Capture Mix\", \"HPMixerL Capture Switch\", \"HPL Mix\"},\n\t{\"Left Capture Mix\", \"SPKMixer Capture Switch\", \"Speaker Mix\"},\n\t{\"Left Capture Mix\", \"MonoMixer Capture Switch\", \"Mono Mix\"},\n\n\t \n\t{\"Right Capture Mix\", \"LineInR Capture Switch\",\t\"LINEINR\"},\n\t{\"Right Capture Mix\", \"Right AuxI Capture Switch\",\t\"AUXINR\"},\n\t{\"Right Capture Mix\", \"Mic1 Capture Switch\",\t\"MIC1 Pre Amp\"},\n\t{\"Right Capture Mix\", \"Mic2 Capture Switch\",\t\"MIC2 Pre Amp\"},\n\t{\"Right Capture Mix\", \"HPMixerR Capture Switch\", \"HPR Mix\"},\n\t{\"Right Capture Mix\", \"SPKMixer Capture Switch\", \"Speaker Mix\"},\n\t{\"Right Capture Mix\", \"MonoMixer Capture Switch\", \"Mono Mix\"},\n\n\t \n\t{\"Left Headphone Mux\", \"HP Left Mix\",\t\t\"HPL Mix\"},\n\t{\"Left Headphone Mux\", \"Vmid\",\t\t\t\"Vmid\"},\n\n\t \n\t{\"Right Headphone Mux\", \"HP Right Mix\",\t\t\"HPR Mix\"},\n\t{\"Right Headphone Mux\", \"Vmid\",\t\t\t\"Vmid\"},\n\n\t \n\t{\"SpeakerOut Mux\", \"Vmid\",\t\t\t\"Vmid\"},\n\t{\"SpeakerOut Mux\", \"HPOut Mix\",\t\t\t\"HPOut Mix\"},\n\t{\"SpeakerOut Mux\", \"Speaker Mix\",\t\t\"Speaker Mix\"},\n\t{\"SpeakerOut Mux\", \"Mono Mix\",\t\t\t\"Mono Mix\"},\n\n\t \n\t{\"AuxOut Mux\", \"Vmid\",\t\t\t\t\"Vmid\"},\n\t{\"AuxOut Mux\", \"HPOut Mix\",\t\t\t\"HPOut Mix\"},\n\t{\"AuxOut Mux\", \"Speaker Mix\",\t\t\t\"Speaker Mix\"},\n\t{\"AuxOut Mux\", \"Mono Mix\",\t\t\t\"Mono Mix\"},\n\n\t \n\t{\"HPL\", NULL,\t\t\t\t\t\"Left Headphone\"},\n\t{\"Left Headphone\", NULL,\t\t\t\"Left Headphone Mux\"},\n\t{\"HPR\", NULL,\t\t\t\t\t\"Right Headphone\"},\n\t{\"Right Headphone\", NULL,\t\t\t\"Right Headphone Mux\"},\n\t{\"Left AuxOut\", NULL,\t\t\t\t\"AuxOut Mux\"},\n\t{\"Right AuxOut\", NULL,\t\t\t\t\"AuxOut Mux\"},\n\n\t \n\t{\"Left LineIn\", NULL,\t\t\t\t\"LINEINL\"},\n\t{\"Right LineIn\", NULL,\t\t\t\t\"LINEINR\"},\n\t{\"Left AuxI\", NULL,\t\t\t\t\"AUXINL\"},\n\t{\"Right AuxI\", NULL,\t\t\t\t\"AUXINR\"},\n\t{\"MIC1 Pre Amp\", NULL,\t\t\t\t\"MIC1\"},\n\t{\"MIC2 Pre Amp\", NULL,\t\t\t\t\"MIC2\"},\n\t{\"MIC1 PGA\", NULL,\t\t\t\t\"MIC1 Pre Amp\"},\n\t{\"MIC2 PGA\", NULL,\t\t\t\t\"MIC2 Pre Amp\"},\n\n\t \n\t{\"Left ADC\", NULL,\t\t\t\t\"Left Capture Mix\"},\n\n\t \n\t{\"Right ADC\", NULL,\t\t\t\t\"Right Capture Mix\"},\n\n\t{\"SpeakerOut N Mux\", \"RN/-R\",\t\t\t\"SpeakerOut\"},\n\t{\"SpeakerOut N Mux\", \"RP/+R\",\t\t\t\"SpeakerOut\"},\n\t{\"SpeakerOut N Mux\", \"LN/-R\",\t\t\t\"SpeakerOut\"},\n\t{\"SpeakerOut N Mux\", \"Vmid\",\t\t\t\"Vmid\"},\n\n\t{\"SPKOUT\", NULL,\t\t\t\t\"SpeakerOut\"},\n\t{\"SPKOUTN\", NULL,\t\t\t\t\"SpeakerOut N Mux\"},\n};\n\nstatic const struct snd_soc_dapm_route intercon_spk[] = {\n\t{\"SpeakerOut\", NULL,\t\t\t\t\"SpeakerOut Mux\"},\n};\n\nstatic const struct snd_soc_dapm_route intercon_amp_spk[] = {\n\t{\"AB Amp\", NULL,\t\t\t\t\"SpeakerOut Mux\"},\n\t{\"D Amp\", NULL,\t\t\t\t\t\"SpeakerOut Mux\"},\n\t{\"AB-D Amp Mux\", \"AB Amp\",\t\t\t\"AB Amp\"},\n\t{\"AB-D Amp Mux\", \"D Amp\",\t\t\t\"D Amp\"},\n\t{\"SpeakerOut\", NULL,\t\t\t\t\"AB-D Amp Mux\"},\n};\n\n \nstruct _pll_div {\n\tu32 pll_in;\n\tu32 pll_out;\n\tu16 regvalue;\n};\n\n \n \nstatic const struct _pll_div codec_master_pll_div[] = {\n\n\t{  2048000,  8192000,\t0x0ea0},\n\t{  3686400,  8192000,\t0x4e27},\n\t{ 12000000,  8192000,\t0x456b},\n\t{ 13000000,  8192000,\t0x495f},\n\t{ 13100000,  8192000,\t0x0320},\n\t{  2048000,  11289600,\t0xf637},\n\t{  3686400,  11289600,\t0x2f22},\n\t{ 12000000,  11289600,\t0x3e2f},\n\t{ 13000000,  11289600,\t0x4d5b},\n\t{ 13100000,  11289600,\t0x363b},\n\t{  2048000,  16384000,\t0x1ea0},\n\t{  3686400,  16384000,\t0x9e27},\n\t{ 12000000,  16384000,\t0x452b},\n\t{ 13000000,  16384000,\t0x542f},\n\t{ 13100000,  16384000,\t0x03a0},\n\t{  2048000,  16934400,\t0xe625},\n\t{  3686400,  16934400,\t0x9126},\n\t{ 12000000,  16934400,\t0x4d2c},\n\t{ 13000000,  16934400,\t0x742f},\n\t{ 13100000,  16934400,\t0x3c27},\n\t{  2048000,  22579200,\t0x2aa0},\n\t{  3686400,  22579200,\t0x2f20},\n\t{ 12000000,  22579200,\t0x7e2f},\n\t{ 13000000,  22579200,\t0x742f},\n\t{ 13100000,  22579200,\t0x3c27},\n\t{  2048000,  24576000,\t0x2ea0},\n\t{  3686400,  24576000,\t0xee27},\n\t{ 12000000,  24576000,\t0x2915},\n\t{ 13000000,  24576000,\t0x772e},\n\t{ 13100000,  24576000,\t0x0d20},\n};\n\nstatic const struct _pll_div codec_slave_pll_div[] = {\n\n\t{  1024000,  16384000,  0x3ea0},\n\t{  1411200,  22579200,\t0x3ea0},\n\t{  1536000,  24576000,\t0x3ea0},\n\t{  2048000,  16384000,  0x1ea0},\n\t{  2822400,  22579200,\t0x1ea0},\n\t{  3072000,  24576000,\t0x1ea0},\n\n};\n\nstatic int alc5623_set_dai_pll(struct snd_soc_dai *codec_dai, int pll_id,\n\t\tint source, unsigned int freq_in, unsigned int freq_out)\n{\n\tint i;\n\tstruct snd_soc_component *component = codec_dai->component;\n\tint gbl_clk = 0, pll_div = 0;\n\tu16 reg;\n\n\tif (pll_id < ALC5623_PLL_FR_MCLK || pll_id > ALC5623_PLL_FR_BCK)\n\t\treturn -ENODEV;\n\n\t \n\tsnd_soc_component_update_bits(component, ALC5623_PWR_MANAG_ADD2,\n\t\t\t\tALC5623_PWR_ADD2_PLL,\n\t\t\t\t0);\n\n\t \n\treg = snd_soc_component_read(component, ALC5623_DAI_CONTROL);\n\tif (reg & ALC5623_DAI_SDP_SLAVE_MODE)\n\t\treturn 0;\n\n\tif (!freq_in || !freq_out)\n\t\treturn 0;\n\n\tswitch (pll_id) {\n\tcase ALC5623_PLL_FR_MCLK:\n\t\tfor (i = 0; i < ARRAY_SIZE(codec_master_pll_div); i++) {\n\t\t\tif (codec_master_pll_div[i].pll_in == freq_in\n\t\t\t   && codec_master_pll_div[i].pll_out == freq_out) {\n\t\t\t\t \n\t\t\t\tpll_div  = codec_master_pll_div[i].regvalue;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tbreak;\n\tcase ALC5623_PLL_FR_BCK:\n\t\tfor (i = 0; i < ARRAY_SIZE(codec_slave_pll_div); i++) {\n\t\t\tif (codec_slave_pll_div[i].pll_in == freq_in\n\t\t\t   && codec_slave_pll_div[i].pll_out == freq_out) {\n\t\t\t\t \n\t\t\t\tgbl_clk = ALC5623_GBL_CLK_PLL_SOUR_SEL_BITCLK;\n\t\t\t\tpll_div = codec_slave_pll_div[i].regvalue;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tif (!pll_div)\n\t\treturn -EINVAL;\n\n\tsnd_soc_component_write(component, ALC5623_GLOBAL_CLK_CTRL_REG, gbl_clk);\n\tsnd_soc_component_write(component, ALC5623_PLL_CTRL, pll_div);\n\tsnd_soc_component_update_bits(component, ALC5623_PWR_MANAG_ADD2,\n\t\t\t\tALC5623_PWR_ADD2_PLL,\n\t\t\t\tALC5623_PWR_ADD2_PLL);\n\tgbl_clk |= ALC5623_GBL_CLK_SYS_SOUR_SEL_PLL;\n\tsnd_soc_component_write(component, ALC5623_GLOBAL_CLK_CTRL_REG, gbl_clk);\n\n\treturn 0;\n}\n\nstruct _coeff_div {\n\tu16 fs;\n\tu16 regvalue;\n};\n\n \n \nstatic const struct _coeff_div coeff_div[] = {\n\t{256*8, 0x3a69},\n\t{384*8, 0x3c6b},\n\t{256*4, 0x2a69},\n\t{384*4, 0x2c6b},\n\t{256*2, 0x1a69},\n\t{384*2, 0x1c6b},\n\t{256*1, 0x0a69},\n\t{384*1, 0x0c6b},\n};\n\nstatic int get_coeff(struct snd_soc_component *component, int rate)\n{\n\tstruct alc5623_priv *alc5623 = snd_soc_component_get_drvdata(component);\n\tint i;\n\n\tfor (i = 0; i < ARRAY_SIZE(coeff_div); i++) {\n\t\tif (coeff_div[i].fs * rate == alc5623->sysclk)\n\t\t\treturn i;\n\t}\n\treturn -EINVAL;\n}\n\n \nstatic int alc5623_set_dai_sysclk(struct snd_soc_dai *codec_dai,\n\t\tint clk_id, unsigned int freq, int dir)\n{\n\tstruct snd_soc_component *component = codec_dai->component;\n\tstruct alc5623_priv *alc5623 = snd_soc_component_get_drvdata(component);\n\n\tswitch (freq) {\n\tcase  8192000:\n\tcase 11289600:\n\tcase 12288000:\n\tcase 16384000:\n\tcase 16934400:\n\tcase 18432000:\n\tcase 22579200:\n\tcase 24576000:\n\t\talc5623->sysclk = freq;\n\t\treturn 0;\n\t}\n\treturn -EINVAL;\n}\n\nstatic int alc5623_set_dai_fmt(struct snd_soc_dai *codec_dai,\n\t\tunsigned int fmt)\n{\n\tstruct snd_soc_component *component = codec_dai->component;\n\tu16 iface = 0;\n\n\t \n\tswitch (fmt & SND_SOC_DAIFMT_CLOCK_PROVIDER_MASK) {\n\tcase SND_SOC_DAIFMT_CBP_CFP:\n\t\tiface = ALC5623_DAI_SDP_MASTER_MODE;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_CBC_CFC:\n\t\tiface = ALC5623_DAI_SDP_SLAVE_MODE;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\t \n\tswitch (fmt & SND_SOC_DAIFMT_FORMAT_MASK) {\n\tcase SND_SOC_DAIFMT_I2S:\n\t\tiface |= ALC5623_DAI_I2S_DF_I2S;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_RIGHT_J:\n\t\tiface |= ALC5623_DAI_I2S_DF_RIGHT;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_LEFT_J:\n\t\tiface |= ALC5623_DAI_I2S_DF_LEFT;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_DSP_A:\n\t\tiface |= ALC5623_DAI_I2S_DF_PCM;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_DSP_B:\n\t\tiface |= ALC5623_DAI_I2S_DF_PCM | ALC5623_DAI_I2S_PCM_MODE;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\t \n\tswitch (fmt & SND_SOC_DAIFMT_INV_MASK) {\n\tcase SND_SOC_DAIFMT_NB_NF:\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_IB_IF:\n\t\tiface |= ALC5623_DAI_MAIN_I2S_BCLK_POL_CTRL;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_IB_NF:\n\t\tiface |= ALC5623_DAI_MAIN_I2S_BCLK_POL_CTRL;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_NB_IF:\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\treturn snd_soc_component_write(component, ALC5623_DAI_CONTROL, iface);\n}\n\nstatic int alc5623_pcm_hw_params(struct snd_pcm_substream *substream,\n\t\tstruct snd_pcm_hw_params *params, struct snd_soc_dai *dai)\n{\n\tstruct snd_soc_component *component = dai->component;\n\tstruct alc5623_priv *alc5623 = snd_soc_component_get_drvdata(component);\n\tint coeff, rate;\n\tu16 iface;\n\n\tiface = snd_soc_component_read(component, ALC5623_DAI_CONTROL);\n\tiface &= ~ALC5623_DAI_I2S_DL_MASK;\n\n\t \n\tswitch (params_width(params)) {\n\tcase 16:\n\t\tiface |= ALC5623_DAI_I2S_DL_16;\n\t\tbreak;\n\tcase 20:\n\t\tiface |= ALC5623_DAI_I2S_DL_20;\n\t\tbreak;\n\tcase 24:\n\t\tiface |= ALC5623_DAI_I2S_DL_24;\n\t\tbreak;\n\tcase 32:\n\t\tiface |= ALC5623_DAI_I2S_DL_32;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\t \n\tsnd_soc_component_write(component, ALC5623_DAI_CONTROL, iface);\n\trate = params_rate(params);\n\tcoeff = get_coeff(component, rate);\n\tif (coeff < 0)\n\t\treturn -EINVAL;\n\n\tcoeff = coeff_div[coeff].regvalue;\n\tdev_dbg(component->dev, \"%s: sysclk=%d,rate=%d,coeff=0x%04x\\n\",\n\t\t__func__, alc5623->sysclk, rate, coeff);\n\tsnd_soc_component_write(component, ALC5623_STEREO_AD_DA_CLK_CTRL, coeff);\n\n\treturn 0;\n}\n\nstatic int alc5623_mute(struct snd_soc_dai *dai, int mute, int direction)\n{\n\tstruct snd_soc_component *component = dai->component;\n\tu16 hp_mute = ALC5623_MISC_M_DAC_L_INPUT | ALC5623_MISC_M_DAC_R_INPUT;\n\tu16 mute_reg = snd_soc_component_read(component, ALC5623_MISC_CTRL) & ~hp_mute;\n\n\tif (mute)\n\t\tmute_reg |= hp_mute;\n\n\treturn snd_soc_component_write(component, ALC5623_MISC_CTRL, mute_reg);\n}\n\n#define ALC5623_ADD2_POWER_EN (ALC5623_PWR_ADD2_VREF \\\n\t| ALC5623_PWR_ADD2_DAC_REF_CIR)\n\n#define ALC5623_ADD3_POWER_EN (ALC5623_PWR_ADD3_MAIN_BIAS \\\n\t| ALC5623_PWR_ADD3_MIC1_BOOST_AD)\n\n#define ALC5623_ADD1_POWER_EN \\\n\t(ALC5623_PWR_ADD1_SHORT_CURR_DET_EN | ALC5623_PWR_ADD1_SOFTGEN_EN \\\n\t| ALC5623_PWR_ADD1_DEPOP_BUF_HP | ALC5623_PWR_ADD1_HP_OUT_AMP \\\n\t| ALC5623_PWR_ADD1_HP_OUT_ENH_AMP)\n\n#define ALC5623_ADD1_POWER_EN_5622 \\\n\t(ALC5623_PWR_ADD1_SHORT_CURR_DET_EN \\\n\t| ALC5623_PWR_ADD1_HP_OUT_AMP)\n\nstatic void enable_power_depop(struct snd_soc_component *component)\n{\n\tstruct alc5623_priv *alc5623 = snd_soc_component_get_drvdata(component);\n\n\tsnd_soc_component_update_bits(component, ALC5623_PWR_MANAG_ADD1,\n\t\t\t\tALC5623_PWR_ADD1_SOFTGEN_EN,\n\t\t\t\tALC5623_PWR_ADD1_SOFTGEN_EN);\n\n\tsnd_soc_component_write(component, ALC5623_PWR_MANAG_ADD3, ALC5623_ADD3_POWER_EN);\n\n\tsnd_soc_component_update_bits(component, ALC5623_MISC_CTRL,\n\t\t\t\tALC5623_MISC_HP_DEPOP_MODE2_EN,\n\t\t\t\tALC5623_MISC_HP_DEPOP_MODE2_EN);\n\n\tmsleep(500);\n\n\tsnd_soc_component_write(component, ALC5623_PWR_MANAG_ADD2, ALC5623_ADD2_POWER_EN);\n\n\t \n\tif (alc5623->id == 0x22)\n\t\tsnd_soc_component_write(component, ALC5623_PWR_MANAG_ADD1,\n\t\t\tALC5623_ADD1_POWER_EN_5622);\n\telse\n\t\tsnd_soc_component_write(component, ALC5623_PWR_MANAG_ADD1,\n\t\t\tALC5623_ADD1_POWER_EN);\n\n\t \n\tsnd_soc_component_update_bits(component, ALC5623_MISC_CTRL,\n\t\t\t\tALC5623_MISC_HP_DEPOP_MODE2_EN,\n\t\t\t\t0);\n\n}\n\nstatic int alc5623_set_bias_level(struct snd_soc_component *component,\n\t\t\t\t      enum snd_soc_bias_level level)\n{\n\tswitch (level) {\n\tcase SND_SOC_BIAS_ON:\n\t\tenable_power_depop(component);\n\t\tbreak;\n\tcase SND_SOC_BIAS_PREPARE:\n\t\tbreak;\n\tcase SND_SOC_BIAS_STANDBY:\n\t\t \n\t\tsnd_soc_component_write(component, ALC5623_PWR_MANAG_ADD2,\n\t\t\t\tALC5623_PWR_ADD2_VREF);\n\t\tsnd_soc_component_write(component, ALC5623_PWR_MANAG_ADD3,\n\t\t\t\tALC5623_PWR_ADD3_MAIN_BIAS);\n\t\tbreak;\n\tcase SND_SOC_BIAS_OFF:\n\t\t \n\t\tsnd_soc_component_write(component, ALC5623_PWR_MANAG_ADD2, 0);\n\t\tsnd_soc_component_write(component, ALC5623_PWR_MANAG_ADD3, 0);\n\t\tsnd_soc_component_write(component, ALC5623_PWR_MANAG_ADD1, 0);\n\t\tbreak;\n\t}\n\treturn 0;\n}\n\n#define ALC5623_FORMATS\t(SNDRV_PCM_FMTBIT_S16_LE \\\n\t\t\t| SNDRV_PCM_FMTBIT_S24_LE \\\n\t\t\t| SNDRV_PCM_FMTBIT_S32_LE)\n\nstatic const struct snd_soc_dai_ops alc5623_dai_ops = {\n\t\t.hw_params = alc5623_pcm_hw_params,\n\t\t.mute_stream = alc5623_mute,\n\t\t.set_fmt = alc5623_set_dai_fmt,\n\t\t.set_sysclk = alc5623_set_dai_sysclk,\n\t\t.set_pll = alc5623_set_dai_pll,\n\t\t.no_capture_mute = 1,\n};\n\nstatic struct snd_soc_dai_driver alc5623_dai = {\n\t.name = \"alc5623-hifi\",\n\t.playback = {\n\t\t.stream_name = \"Playback\",\n\t\t.channels_min = 1,\n\t\t.channels_max = 2,\n\t\t.rate_min =\t8000,\n\t\t.rate_max =\t48000,\n\t\t.rates = SNDRV_PCM_RATE_8000_48000,\n\t\t.formats = ALC5623_FORMATS,},\n\t.capture = {\n\t\t.stream_name = \"Capture\",\n\t\t.channels_min = 1,\n\t\t.channels_max = 2,\n\t\t.rate_min =\t8000,\n\t\t.rate_max =\t48000,\n\t\t.rates = SNDRV_PCM_RATE_8000_48000,\n\t\t.formats = ALC5623_FORMATS,},\n\n\t.ops = &alc5623_dai_ops,\n};\n\nstatic int alc5623_suspend(struct snd_soc_component *component)\n{\n\tstruct alc5623_priv *alc5623 = snd_soc_component_get_drvdata(component);\n\n\tregcache_cache_only(alc5623->regmap, true);\n\n\treturn 0;\n}\n\nstatic int alc5623_resume(struct snd_soc_component *component)\n{\n\tstruct alc5623_priv *alc5623 = snd_soc_component_get_drvdata(component);\n\tint ret;\n\n\t \n\tregcache_cache_only(alc5623->regmap, false);\n\tret = regcache_sync(alc5623->regmap);\n\tif (ret != 0) {\n\t\tdev_err(component->dev, \"Failed to sync register cache: %d\\n\",\n\t\t\tret);\n\t\tregcache_cache_only(alc5623->regmap, true);\n\t\treturn ret;\n\t}\n\n\treturn 0;\n}\n\nstatic int alc5623_probe(struct snd_soc_component *component)\n{\n\tstruct alc5623_priv *alc5623 = snd_soc_component_get_drvdata(component);\n\tstruct snd_soc_dapm_context *dapm = snd_soc_component_get_dapm(component);\n\n\talc5623_reset(component);\n\n\tif (alc5623->add_ctrl) {\n\t\tsnd_soc_component_write(component, ALC5623_ADD_CTRL_REG,\n\t\t\t\talc5623->add_ctrl);\n\t}\n\n\tif (alc5623->jack_det_ctrl) {\n\t\tsnd_soc_component_write(component, ALC5623_JACK_DET_CTRL,\n\t\t\t\talc5623->jack_det_ctrl);\n\t}\n\n\tswitch (alc5623->id) {\n\tcase 0x21:\n\t\tsnd_soc_add_component_controls(component, alc5621_vol_snd_controls,\n\t\t\tARRAY_SIZE(alc5621_vol_snd_controls));\n\t\tbreak;\n\tcase 0x22:\n\t\tsnd_soc_add_component_controls(component, alc5622_vol_snd_controls,\n\t\t\tARRAY_SIZE(alc5622_vol_snd_controls));\n\t\tbreak;\n\tcase 0x23:\n\t\tsnd_soc_add_component_controls(component, alc5623_vol_snd_controls,\n\t\t\tARRAY_SIZE(alc5623_vol_snd_controls));\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tsnd_soc_add_component_controls(component, alc5623_snd_controls,\n\t\t\tARRAY_SIZE(alc5623_snd_controls));\n\n\tsnd_soc_dapm_new_controls(dapm, alc5623_dapm_widgets,\n\t\t\t\t\tARRAY_SIZE(alc5623_dapm_widgets));\n\n\t \n\tsnd_soc_dapm_add_routes(dapm, intercon, ARRAY_SIZE(intercon));\n\n\tswitch (alc5623->id) {\n\tcase 0x21:\n\tcase 0x22:\n\t\tsnd_soc_dapm_new_controls(dapm, alc5623_dapm_amp_widgets,\n\t\t\t\t\tARRAY_SIZE(alc5623_dapm_amp_widgets));\n\t\tsnd_soc_dapm_add_routes(dapm, intercon_amp_spk,\n\t\t\t\t\tARRAY_SIZE(intercon_amp_spk));\n\t\tbreak;\n\tcase 0x23:\n\t\tsnd_soc_dapm_add_routes(dapm, intercon_spk,\n\t\t\t\t\tARRAY_SIZE(intercon_spk));\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\treturn 0;\n}\n\nstatic const struct snd_soc_component_driver soc_component_device_alc5623 = {\n\t.probe\t\t\t= alc5623_probe,\n\t.suspend\t\t= alc5623_suspend,\n\t.resume\t\t\t= alc5623_resume,\n\t.set_bias_level\t\t= alc5623_set_bias_level,\n\t.suspend_bias_off\t= 1,\n\t.idle_bias_on\t\t= 1,\n\t.use_pmdown_time\t= 1,\n\t.endianness\t\t= 1,\n};\n\nstatic const struct regmap_config alc5623_regmap = {\n\t.reg_bits = 8,\n\t.val_bits = 16,\n\t.reg_stride = 2,\n\n\t.max_register = ALC5623_VENDOR_ID2,\n\t.cache_type = REGCACHE_RBTREE,\n};\n\nstatic const struct i2c_device_id alc5623_i2c_table[] = {\n\t{\"alc5621\", 0x21},\n\t{\"alc5622\", 0x22},\n\t{\"alc5623\", 0x23},\n\t{}\n};\nMODULE_DEVICE_TABLE(i2c, alc5623_i2c_table);\n\n \nstatic int alc5623_i2c_probe(struct i2c_client *client)\n{\n\tstruct alc5623_platform_data *pdata;\n\tstruct alc5623_priv *alc5623;\n\tstruct device_node *np;\n\tunsigned int vid1, vid2;\n\tint ret;\n\tu32 val32;\n\tconst struct i2c_device_id *id;\n\n\talc5623 = devm_kzalloc(&client->dev, sizeof(struct alc5623_priv),\n\t\t\t       GFP_KERNEL);\n\tif (alc5623 == NULL)\n\t\treturn -ENOMEM;\n\n\talc5623->regmap = devm_regmap_init_i2c(client, &alc5623_regmap);\n\tif (IS_ERR(alc5623->regmap)) {\n\t\tret = PTR_ERR(alc5623->regmap);\n\t\tdev_err(&client->dev, \"Failed to initialise I/O: %d\\n\", ret);\n\t\treturn ret;\n\t}\n\n\tret = regmap_read(alc5623->regmap, ALC5623_VENDOR_ID1, &vid1);\n\tif (ret < 0) {\n\t\tdev_err(&client->dev, \"failed to read vendor ID1: %d\\n\", ret);\n\t\treturn ret;\n\t}\n\n\tret = regmap_read(alc5623->regmap, ALC5623_VENDOR_ID2, &vid2);\n\tif (ret < 0) {\n\t\tdev_err(&client->dev, \"failed to read vendor ID2: %d\\n\", ret);\n\t\treturn ret;\n\t}\n\tvid2 >>= 8;\n\n\tid = i2c_match_id(alc5623_i2c_table, client);\n\n\tif ((vid1 != 0x10ec) || (vid2 != id->driver_data)) {\n\t\tdev_err(&client->dev, \"unknown or wrong codec\\n\");\n\t\tdev_err(&client->dev, \"Expected %x:%lx, got %x:%x\\n\",\n\t\t\t\t0x10ec, id->driver_data,\n\t\t\t\tvid1, vid2);\n\t\treturn -ENODEV;\n\t}\n\n\tdev_dbg(&client->dev, \"Found codec id : alc56%02x\\n\", vid2);\n\n\tpdata = client->dev.platform_data;\n\tif (pdata) {\n\t\talc5623->add_ctrl = pdata->add_ctrl;\n\t\talc5623->jack_det_ctrl = pdata->jack_det_ctrl;\n\t} else {\n\t\tif (client->dev.of_node) {\n\t\t\tnp = client->dev.of_node;\n\t\t\tret = of_property_read_u32(np, \"add-ctrl\", &val32);\n\t\t\tif (!ret)\n\t\t\t\talc5623->add_ctrl = val32;\n\t\t\tret = of_property_read_u32(np, \"jack-det-ctrl\", &val32);\n\t\t\tif (!ret)\n\t\t\t\talc5623->jack_det_ctrl = val32;\n\t\t}\n\t}\n\n\talc5623->id = vid2;\n\tswitch (alc5623->id) {\n\tcase 0x21:\n\t\talc5623_dai.name = \"alc5621-hifi\";\n\t\tbreak;\n\tcase 0x22:\n\t\talc5623_dai.name = \"alc5622-hifi\";\n\t\tbreak;\n\tcase 0x23:\n\t\talc5623_dai.name = \"alc5623-hifi\";\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\ti2c_set_clientdata(client, alc5623);\n\n\tret =  devm_snd_soc_register_component(&client->dev,\n\t\t&soc_component_device_alc5623, &alc5623_dai, 1);\n\tif (ret != 0)\n\t\tdev_err(&client->dev, \"Failed to register codec: %d\\n\", ret);\n\n\treturn ret;\n}\n\n#ifdef CONFIG_OF\nstatic const struct of_device_id alc5623_of_match[] = {\n\t{ .compatible = \"realtek,alc5623\", },\n\t{ }\n};\nMODULE_DEVICE_TABLE(of, alc5623_of_match);\n#endif\n\n \nstatic struct i2c_driver alc5623_i2c_driver = {\n\t.driver = {\n\t\t.name = \"alc562x-codec\",\n\t\t.of_match_table = of_match_ptr(alc5623_of_match),\n\t},\n\t.probe = alc5623_i2c_probe,\n\t.id_table = alc5623_i2c_table,\n};\n\nmodule_i2c_driver(alc5623_i2c_driver);\n\nMODULE_DESCRIPTION(\"ASoC alc5621/2/3 driver\");\nMODULE_AUTHOR(\"Arnaud Patard <arnaud.patard@rtp-net.org>\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}