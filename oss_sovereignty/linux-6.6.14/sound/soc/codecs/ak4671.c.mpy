{
  "module_name": "ak4671.c",
  "hash_id": "6a39e94cc47a3e7d214e2a472d267de0e39b585f7e2ba6a896b2a42159c57693",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/codecs/ak4671.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/init.h>\n#include <linux/i2c.h>\n#include <linux/delay.h>\n#include <linux/regmap.h>\n#include <linux/slab.h>\n#include <sound/soc.h>\n#include <sound/initval.h>\n#include <sound/tlv.h>\n\n#include \"ak4671.h\"\n\n\n \nstatic const struct reg_default ak4671_reg_defaults[] = {\n\t{ 0x00, 0x00 },\t \n\t{ 0x01, 0xf6 },\t \n\t{ 0x02, 0x00 },\t \n\t{ 0x03, 0x02 },\t \n\t{ 0x04, 0x00 },\t \n\t{ 0x05, 0x55 },\t \n\t{ 0x06, 0x00 },\t \n\t{ 0x07, 0x00 },\t \n\t{ 0x08, 0xb5 },\t \n\t{ 0x09, 0x00 },\t \n\t{ 0x0a, 0x00 },\t \n\t{ 0x0b, 0x00 },\t \n\t{ 0x0c, 0x00 },\t \n\t{ 0x0d, 0x00 },\t \n\t{ 0x0e, 0x00 },\t \n\t{ 0x0f, 0x00 },\t \n\t{ 0x10, 0x00 },\t \n\t{ 0x11, 0x80 },\t \n\t{ 0x12, 0x91 },\t \n\t{ 0x13, 0x91 },\t \n\t{ 0x14, 0xe1 },\t \n\t{ 0x15, 0x00 },\t \n\t{ 0x16, 0x00 },\t \n\t{ 0x17, 0x00 },\t \n\t{ 0x18, 0x02 },\t \n\t{ 0x19, 0x01 },\t \n\t{ 0x1a, 0x18 },\t \n\t{ 0x1b, 0x18 },\t \n\t{ 0x1c, 0x00 },\t \n\t{ 0x1d, 0x02 },\t \n\t{ 0x1e, 0x00 },\t \n\t{ 0x1f, 0x00 },\t \n\t{ 0x20, 0x00 },\t \n\t{ 0x21, 0x00 },\t \n\t{ 0x22, 0x00 },\t \n\t{ 0x23, 0x00 },\t \n\t{ 0x24, 0x00 },\t \n\t{ 0x25, 0x00 },\t \n\t{ 0x26, 0x00 },\t \n\t{ 0x27, 0x00 },\t \n\t{ 0x28, 0xa9 },\t \n\t{ 0x29, 0x1f },\t \n\t{ 0x2a, 0xad },\t \n\t{ 0x2b, 0x20 },\t \n\t{ 0x2c, 0x00 },\t \n\t{ 0x2d, 0x00 },\t \n\t{ 0x2e, 0x00 },\t \n\t{ 0x2f, 0x00 },\t \n\t{ 0x30, 0x00 },\t \n\n\t{ 0x32, 0x00 },\t \n\t{ 0x33, 0x00 },\t \n\t{ 0x34, 0x00 },\t \n\t{ 0x35, 0x00 },\t \n\t{ 0x36, 0x00 },\t \n\t{ 0x37, 0x00 },\t \n\t{ 0x38, 0x00 },\t \n\t{ 0x39, 0x00 },\t \n\t{ 0x3a, 0x00 },\t \n\t{ 0x3b, 0x00 },\t \n\t{ 0x3c, 0x00 },\t \n\t{ 0x3d, 0x00 },\t \n\t{ 0x3e, 0x00 },\t \n\t{ 0x3f, 0x00 },\t \n\t{ 0x40, 0x00 },\t \n\t{ 0x41, 0x00 },\t \n\t{ 0x42, 0x00 },\t \n\t{ 0x43, 0x00 },\t \n\t{ 0x44, 0x00 },\t \n\t{ 0x45, 0x00 },\t \n\t{ 0x46, 0x00 },\t \n\t{ 0x47, 0x00 },\t \n\t{ 0x48, 0x00 },\t \n\t{ 0x49, 0x00 },\t \n\t{ 0x4a, 0x00 },\t \n\t{ 0x4b, 0x00 },\t \n\t{ 0x4c, 0x00 },\t \n\t{ 0x4d, 0x00 },\t \n\t{ 0x4e, 0x00 },\t \n\t{ 0x4f, 0x00 },\t \n\t{ 0x50, 0x88 },\t \n\t{ 0x51, 0x88 },\t \n\t{ 0x52, 0x08 },\t \n\t{ 0x53, 0x00 },\t \n\t{ 0x54, 0x00 },\t \n\t{ 0x55, 0x00 },\t \n\t{ 0x56, 0x18 },\t \n\t{ 0x57, 0x18 },\t \n\t{ 0x58, 0x00 },\t \n\t{ 0x59, 0x00 },\t \n\t{ 0x5a, 0x00 },\t \n};\n\n \nstatic DECLARE_TLV_DB_SCALE(out1_tlv, -3000, 600, 1);\n\n \nstatic DECLARE_TLV_DB_SCALE(out2_tlv, -3300, 300, 1);\n\n \nstatic DECLARE_TLV_DB_SCALE(out3_tlv, -600, 300, 0);\n\n \nstatic DECLARE_TLV_DB_SCALE(mic_amp_tlv, -1500, 300, 0);\n\nstatic const struct snd_kcontrol_new ak4671_snd_controls[] = {\n\t \n\tSOC_SINGLE_TLV(\"Line Output1 Playback Volume\",\n\t\t\tAK4671_OUTPUT_VOLUME_CONTROL, 0, 0x6, 0, out1_tlv),\n\tSOC_SINGLE_TLV(\"Headphone Output2 Playback Volume\",\n\t\t\tAK4671_OUTPUT_VOLUME_CONTROL, 4, 0xd, 0, out2_tlv),\n\tSOC_SINGLE_TLV(\"Line Output3 Playback Volume\",\n\t\t\tAK4671_LOUT3_POWER_MANAGERMENT, 6, 0x3, 0, out3_tlv),\n\n\t \n\tSOC_DOUBLE_TLV(\"Mic Amp Capture Volume\",\n\t\t\tAK4671_MIC_AMP_GAIN, 0, 4, 0xf, 0, mic_amp_tlv),\n};\n\n \nstatic int ak4671_out2_event(struct snd_soc_dapm_widget *w,\n\t\tstruct snd_kcontrol *kcontrol, int event)\n{\n\tstruct snd_soc_component *component = snd_soc_dapm_to_component(w->dapm);\n\n\tswitch (event) {\n\tcase SND_SOC_DAPM_POST_PMU:\n\t\tsnd_soc_component_update_bits(component, AK4671_LOUT2_POWER_MANAGERMENT,\n\t\t\t\t    AK4671_MUTEN, AK4671_MUTEN);\n\t\tbreak;\n\tcase SND_SOC_DAPM_PRE_PMD:\n\t\tsnd_soc_component_update_bits(component, AK4671_LOUT2_POWER_MANAGERMENT,\n\t\t\t\t    AK4671_MUTEN, 0);\n\t\tbreak;\n\t}\n\n\treturn 0;\n}\n\n \nstatic const struct snd_kcontrol_new ak4671_lout1_mixer_controls[] = {\n\tSOC_DAPM_SINGLE(\"DACL\", AK4671_LOUT1_SIGNAL_SELECT, 0, 1, 0),\n\tSOC_DAPM_SINGLE(\"LINL1\", AK4671_LOUT1_SIGNAL_SELECT, 1, 1, 0),\n\tSOC_DAPM_SINGLE(\"LINL2\", AK4671_LOUT1_SIGNAL_SELECT, 2, 1, 0),\n\tSOC_DAPM_SINGLE(\"LINL3\", AK4671_LOUT1_SIGNAL_SELECT, 3, 1, 0),\n\tSOC_DAPM_SINGLE(\"LINL4\", AK4671_LOUT1_SIGNAL_SELECT, 4, 1, 0),\n\tSOC_DAPM_SINGLE(\"LOOPL\", AK4671_LOUT1_SIGNAL_SELECT, 5, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new ak4671_rout1_mixer_controls[] = {\n\tSOC_DAPM_SINGLE(\"DACR\", AK4671_ROUT1_SIGNAL_SELECT, 0, 1, 0),\n\tSOC_DAPM_SINGLE(\"RINR1\", AK4671_ROUT1_SIGNAL_SELECT, 1, 1, 0),\n\tSOC_DAPM_SINGLE(\"RINR2\", AK4671_ROUT1_SIGNAL_SELECT, 2, 1, 0),\n\tSOC_DAPM_SINGLE(\"RINR3\", AK4671_ROUT1_SIGNAL_SELECT, 3, 1, 0),\n\tSOC_DAPM_SINGLE(\"RINR4\", AK4671_ROUT1_SIGNAL_SELECT, 4, 1, 0),\n\tSOC_DAPM_SINGLE(\"LOOPR\", AK4671_ROUT1_SIGNAL_SELECT, 5, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new ak4671_lout2_mixer_controls[] = {\n\tSOC_DAPM_SINGLE(\"DACHL\", AK4671_LOUT2_SIGNAL_SELECT, 0, 1, 0),\n\tSOC_DAPM_SINGLE(\"LINH1\", AK4671_LOUT2_SIGNAL_SELECT, 1, 1, 0),\n\tSOC_DAPM_SINGLE(\"LINH2\", AK4671_LOUT2_SIGNAL_SELECT, 2, 1, 0),\n\tSOC_DAPM_SINGLE(\"LINH3\", AK4671_LOUT2_SIGNAL_SELECT, 3, 1, 0),\n\tSOC_DAPM_SINGLE(\"LINH4\", AK4671_LOUT2_SIGNAL_SELECT, 4, 1, 0),\n\tSOC_DAPM_SINGLE(\"LOOPHL\", AK4671_LOUT2_SIGNAL_SELECT, 5, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new ak4671_rout2_mixer_controls[] = {\n\tSOC_DAPM_SINGLE(\"DACHR\", AK4671_ROUT2_SIGNAL_SELECT, 0, 1, 0),\n\tSOC_DAPM_SINGLE(\"RINH1\", AK4671_ROUT2_SIGNAL_SELECT, 1, 1, 0),\n\tSOC_DAPM_SINGLE(\"RINH2\", AK4671_ROUT2_SIGNAL_SELECT, 2, 1, 0),\n\tSOC_DAPM_SINGLE(\"RINH3\", AK4671_ROUT2_SIGNAL_SELECT, 3, 1, 0),\n\tSOC_DAPM_SINGLE(\"RINH4\", AK4671_ROUT2_SIGNAL_SELECT, 4, 1, 0),\n\tSOC_DAPM_SINGLE(\"LOOPHR\", AK4671_ROUT2_SIGNAL_SELECT, 5, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new ak4671_lout3_mixer_controls[] = {\n\tSOC_DAPM_SINGLE(\"DACSL\", AK4671_LOUT3_SIGNAL_SELECT, 0, 1, 0),\n\tSOC_DAPM_SINGLE(\"LINS1\", AK4671_LOUT3_SIGNAL_SELECT, 1, 1, 0),\n\tSOC_DAPM_SINGLE(\"LINS2\", AK4671_LOUT3_SIGNAL_SELECT, 2, 1, 0),\n\tSOC_DAPM_SINGLE(\"LINS3\", AK4671_LOUT3_SIGNAL_SELECT, 3, 1, 0),\n\tSOC_DAPM_SINGLE(\"LINS4\", AK4671_LOUT3_SIGNAL_SELECT, 4, 1, 0),\n\tSOC_DAPM_SINGLE(\"LOOPSL\", AK4671_LOUT3_SIGNAL_SELECT, 5, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new ak4671_rout3_mixer_controls[] = {\n\tSOC_DAPM_SINGLE(\"DACSR\", AK4671_ROUT3_SIGNAL_SELECT, 0, 1, 0),\n\tSOC_DAPM_SINGLE(\"RINS1\", AK4671_ROUT3_SIGNAL_SELECT, 1, 1, 0),\n\tSOC_DAPM_SINGLE(\"RINS2\", AK4671_ROUT3_SIGNAL_SELECT, 2, 1, 0),\n\tSOC_DAPM_SINGLE(\"RINS3\", AK4671_ROUT3_SIGNAL_SELECT, 3, 1, 0),\n\tSOC_DAPM_SINGLE(\"RINS4\", AK4671_ROUT3_SIGNAL_SELECT, 4, 1, 0),\n\tSOC_DAPM_SINGLE(\"LOOPSR\", AK4671_ROUT3_SIGNAL_SELECT, 5, 1, 0),\n};\n\n \nstatic const char *ak4671_lin_mux_texts[] =\n\t\t{\"LIN1\", \"LIN2\", \"LIN3\", \"LIN4\"};\nstatic SOC_ENUM_SINGLE_DECL(ak4671_lin_mux_enum,\n\t\t\t    AK4671_MIC_SIGNAL_SELECT, 0,\n\t\t\t    ak4671_lin_mux_texts);\nstatic const struct snd_kcontrol_new ak4671_lin_mux_control =\n\tSOC_DAPM_ENUM(\"Route\", ak4671_lin_mux_enum);\n\nstatic const char *ak4671_rin_mux_texts[] =\n\t\t{\"RIN1\", \"RIN2\", \"RIN3\", \"RIN4\"};\nstatic SOC_ENUM_SINGLE_DECL(ak4671_rin_mux_enum,\n\t\t\t    AK4671_MIC_SIGNAL_SELECT, 2,\n\t\t\t    ak4671_rin_mux_texts);\nstatic const struct snd_kcontrol_new ak4671_rin_mux_control =\n\tSOC_DAPM_ENUM(\"Route\", ak4671_rin_mux_enum);\n\nstatic const struct snd_soc_dapm_widget ak4671_dapm_widgets[] = {\n\t \n\tSND_SOC_DAPM_INPUT(\"LIN1\"),\n\tSND_SOC_DAPM_INPUT(\"RIN1\"),\n\tSND_SOC_DAPM_INPUT(\"LIN2\"),\n\tSND_SOC_DAPM_INPUT(\"RIN2\"),\n\tSND_SOC_DAPM_INPUT(\"LIN3\"),\n\tSND_SOC_DAPM_INPUT(\"RIN3\"),\n\tSND_SOC_DAPM_INPUT(\"LIN4\"),\n\tSND_SOC_DAPM_INPUT(\"RIN4\"),\n\n\t \n\tSND_SOC_DAPM_OUTPUT(\"LOUT1\"),\n\tSND_SOC_DAPM_OUTPUT(\"ROUT1\"),\n\tSND_SOC_DAPM_OUTPUT(\"LOUT2\"),\n\tSND_SOC_DAPM_OUTPUT(\"ROUT2\"),\n\tSND_SOC_DAPM_OUTPUT(\"LOUT3\"),\n\tSND_SOC_DAPM_OUTPUT(\"ROUT3\"),\n\n\t \n\tSND_SOC_DAPM_DAC(\"DAC Left\", \"Left HiFi Playback\",\n\t\t\tAK4671_AD_DA_POWER_MANAGEMENT, 6, 0),\n\tSND_SOC_DAPM_DAC(\"DAC Right\", \"Right HiFi Playback\",\n\t\t\tAK4671_AD_DA_POWER_MANAGEMENT, 7, 0),\n\n\t \n\tSND_SOC_DAPM_ADC(\"ADC Left\", \"Left HiFi Capture\",\n\t\t\tAK4671_AD_DA_POWER_MANAGEMENT, 4, 0),\n\tSND_SOC_DAPM_ADC(\"ADC Right\", \"Right HiFi Capture\",\n\t\t\tAK4671_AD_DA_POWER_MANAGEMENT, 5, 0),\n\n\t \n\tSND_SOC_DAPM_PGA(\"LOUT2 Mix Amp\",\n\t\t\tAK4671_LOUT2_POWER_MANAGERMENT, 5, 0, NULL, 0),\n\tSND_SOC_DAPM_PGA(\"ROUT2 Mix Amp\",\n\t\t\tAK4671_LOUT2_POWER_MANAGERMENT, 6, 0, NULL, 0),\n\n\tSND_SOC_DAPM_PGA(\"LIN1 Mixing Circuit\",\n\t\t\tAK4671_MIXING_POWER_MANAGEMENT1, 0, 0, NULL, 0),\n\tSND_SOC_DAPM_PGA(\"RIN1 Mixing Circuit\",\n\t\t\tAK4671_MIXING_POWER_MANAGEMENT1, 1, 0, NULL, 0),\n\tSND_SOC_DAPM_PGA(\"LIN2 Mixing Circuit\",\n\t\t\tAK4671_MIXING_POWER_MANAGEMENT1, 2, 0, NULL, 0),\n\tSND_SOC_DAPM_PGA(\"RIN2 Mixing Circuit\",\n\t\t\tAK4671_MIXING_POWER_MANAGEMENT1, 3, 0, NULL, 0),\n\tSND_SOC_DAPM_PGA(\"LIN3 Mixing Circuit\",\n\t\t\tAK4671_MIXING_POWER_MANAGEMENT1, 4, 0, NULL, 0),\n\tSND_SOC_DAPM_PGA(\"RIN3 Mixing Circuit\",\n\t\t\tAK4671_MIXING_POWER_MANAGEMENT1, 5, 0, NULL, 0),\n\tSND_SOC_DAPM_PGA(\"LIN4 Mixing Circuit\",\n\t\t\tAK4671_MIXING_POWER_MANAGEMENT1, 6, 0, NULL, 0),\n\tSND_SOC_DAPM_PGA(\"RIN4 Mixing Circuit\",\n\t\t\tAK4671_MIXING_POWER_MANAGEMENT1, 7, 0, NULL, 0),\n\n\t \n\tSND_SOC_DAPM_MIXER(\"LOUT1 Mixer\", AK4671_LOUT1_POWER_MANAGERMENT, 0, 0,\n\t\t\t&ak4671_lout1_mixer_controls[0],\n\t\t\tARRAY_SIZE(ak4671_lout1_mixer_controls)),\n\tSND_SOC_DAPM_MIXER(\"ROUT1 Mixer\", AK4671_LOUT1_POWER_MANAGERMENT, 1, 0,\n\t\t\t&ak4671_rout1_mixer_controls[0],\n\t\t\tARRAY_SIZE(ak4671_rout1_mixer_controls)),\n\tSND_SOC_DAPM_MIXER_E(\"LOUT2 Mixer\", AK4671_LOUT2_POWER_MANAGERMENT,\n\t\t\t0, 0, &ak4671_lout2_mixer_controls[0],\n\t\t\tARRAY_SIZE(ak4671_lout2_mixer_controls),\n\t\t\tak4671_out2_event,\n\t\t\tSND_SOC_DAPM_POST_PMU|SND_SOC_DAPM_PRE_PMD),\n\tSND_SOC_DAPM_MIXER_E(\"ROUT2 Mixer\", AK4671_LOUT2_POWER_MANAGERMENT,\n\t\t\t1, 0, &ak4671_rout2_mixer_controls[0],\n\t\t\tARRAY_SIZE(ak4671_rout2_mixer_controls),\n\t\t\tak4671_out2_event,\n\t\t\tSND_SOC_DAPM_POST_PMU|SND_SOC_DAPM_PRE_PMD),\n\tSND_SOC_DAPM_MIXER(\"LOUT3 Mixer\", AK4671_LOUT3_POWER_MANAGERMENT, 0, 0,\n\t\t\t&ak4671_lout3_mixer_controls[0],\n\t\t\tARRAY_SIZE(ak4671_lout3_mixer_controls)),\n\tSND_SOC_DAPM_MIXER(\"ROUT3 Mixer\", AK4671_LOUT3_POWER_MANAGERMENT, 1, 0,\n\t\t\t&ak4671_rout3_mixer_controls[0],\n\t\t\tARRAY_SIZE(ak4671_rout3_mixer_controls)),\n\n\t \n\tSND_SOC_DAPM_MUX(\"LIN MUX\", AK4671_AD_DA_POWER_MANAGEMENT, 2, 0,\n\t\t\t&ak4671_lin_mux_control),\n\tSND_SOC_DAPM_MUX(\"RIN MUX\", AK4671_AD_DA_POWER_MANAGEMENT, 3, 0,\n\t\t\t&ak4671_rin_mux_control),\n\n\t \n\tSND_SOC_DAPM_MICBIAS(\"Mic Bias\", AK4671_AD_DA_POWER_MANAGEMENT, 1, 0),\n\n\t \n\tSND_SOC_DAPM_SUPPLY(\"PMPLL\", AK4671_PLL_MODE_SELECT1, 0, 0, NULL, 0),\n};\n\nstatic const struct snd_soc_dapm_route ak4671_intercon[] = {\n\t{\"DAC Left\", NULL, \"PMPLL\"},\n\t{\"DAC Right\", NULL, \"PMPLL\"},\n\t{\"ADC Left\", NULL, \"PMPLL\"},\n\t{\"ADC Right\", NULL, \"PMPLL\"},\n\n\t \n\t{\"LOUT1\", NULL, \"LOUT1 Mixer\"},\n\t{\"ROUT1\", NULL, \"ROUT1 Mixer\"},\n\t{\"LOUT2\", NULL, \"LOUT2 Mix Amp\"},\n\t{\"ROUT2\", NULL, \"ROUT2 Mix Amp\"},\n\t{\"LOUT3\", NULL, \"LOUT3 Mixer\"},\n\t{\"ROUT3\", NULL, \"ROUT3 Mixer\"},\n\n\t{\"LOUT1 Mixer\", \"DACL\", \"DAC Left\"},\n\t{\"ROUT1 Mixer\", \"DACR\", \"DAC Right\"},\n\t{\"LOUT2 Mixer\", \"DACHL\", \"DAC Left\"},\n\t{\"ROUT2 Mixer\", \"DACHR\", \"DAC Right\"},\n\t{\"LOUT2 Mix Amp\", NULL, \"LOUT2 Mixer\"},\n\t{\"ROUT2 Mix Amp\", NULL, \"ROUT2 Mixer\"},\n\t{\"LOUT3 Mixer\", \"DACSL\", \"DAC Left\"},\n\t{\"ROUT3 Mixer\", \"DACSR\", \"DAC Right\"},\n\n\t \n\t{\"LIN MUX\", \"LIN1\", \"LIN1\"},\n\t{\"LIN MUX\", \"LIN2\", \"LIN2\"},\n\t{\"LIN MUX\", \"LIN3\", \"LIN3\"},\n\t{\"LIN MUX\", \"LIN4\", \"LIN4\"},\n\n\t{\"RIN MUX\", \"RIN1\", \"RIN1\"},\n\t{\"RIN MUX\", \"RIN2\", \"RIN2\"},\n\t{\"RIN MUX\", \"RIN3\", \"RIN3\"},\n\t{\"RIN MUX\", \"RIN4\", \"RIN4\"},\n\n\t{\"LIN1\", NULL, \"Mic Bias\"},\n\t{\"RIN1\", NULL, \"Mic Bias\"},\n\t{\"LIN2\", NULL, \"Mic Bias\"},\n\t{\"RIN2\", NULL, \"Mic Bias\"},\n\n\t{\"ADC Left\", NULL, \"LIN MUX\"},\n\t{\"ADC Right\", NULL, \"RIN MUX\"},\n\n\t \n\t{\"LIN1 Mixing Circuit\", NULL, \"LIN1\"},\n\t{\"RIN1 Mixing Circuit\", NULL, \"RIN1\"},\n\t{\"LIN2 Mixing Circuit\", NULL, \"LIN2\"},\n\t{\"RIN2 Mixing Circuit\", NULL, \"RIN2\"},\n\t{\"LIN3 Mixing Circuit\", NULL, \"LIN3\"},\n\t{\"RIN3 Mixing Circuit\", NULL, \"RIN3\"},\n\t{\"LIN4 Mixing Circuit\", NULL, \"LIN4\"},\n\t{\"RIN4 Mixing Circuit\", NULL, \"RIN4\"},\n\n\t{\"LOUT1 Mixer\", \"LINL1\", \"LIN1 Mixing Circuit\"},\n\t{\"ROUT1 Mixer\", \"RINR1\", \"RIN1 Mixing Circuit\"},\n\t{\"LOUT2 Mixer\", \"LINH1\", \"LIN1 Mixing Circuit\"},\n\t{\"ROUT2 Mixer\", \"RINH1\", \"RIN1 Mixing Circuit\"},\n\t{\"LOUT3 Mixer\", \"LINS1\", \"LIN1 Mixing Circuit\"},\n\t{\"ROUT3 Mixer\", \"RINS1\", \"RIN1 Mixing Circuit\"},\n\n\t{\"LOUT1 Mixer\", \"LINL2\", \"LIN2 Mixing Circuit\"},\n\t{\"ROUT1 Mixer\", \"RINR2\", \"RIN2 Mixing Circuit\"},\n\t{\"LOUT2 Mixer\", \"LINH2\", \"LIN2 Mixing Circuit\"},\n\t{\"ROUT2 Mixer\", \"RINH2\", \"RIN2 Mixing Circuit\"},\n\t{\"LOUT3 Mixer\", \"LINS2\", \"LIN2 Mixing Circuit\"},\n\t{\"ROUT3 Mixer\", \"RINS2\", \"RIN2 Mixing Circuit\"},\n\n\t{\"LOUT1 Mixer\", \"LINL3\", \"LIN3 Mixing Circuit\"},\n\t{\"ROUT1 Mixer\", \"RINR3\", \"RIN3 Mixing Circuit\"},\n\t{\"LOUT2 Mixer\", \"LINH3\", \"LIN3 Mixing Circuit\"},\n\t{\"ROUT2 Mixer\", \"RINH3\", \"RIN3 Mixing Circuit\"},\n\t{\"LOUT3 Mixer\", \"LINS3\", \"LIN3 Mixing Circuit\"},\n\t{\"ROUT3 Mixer\", \"RINS3\", \"RIN3 Mixing Circuit\"},\n\n\t{\"LOUT1 Mixer\", \"LINL4\", \"LIN4 Mixing Circuit\"},\n\t{\"ROUT1 Mixer\", \"RINR4\", \"RIN4 Mixing Circuit\"},\n\t{\"LOUT2 Mixer\", \"LINH4\", \"LIN4 Mixing Circuit\"},\n\t{\"ROUT2 Mixer\", \"RINH4\", \"RIN4 Mixing Circuit\"},\n\t{\"LOUT3 Mixer\", \"LINS4\", \"LIN4 Mixing Circuit\"},\n\t{\"ROUT3 Mixer\", \"RINS4\", \"RIN4 Mixing Circuit\"},\n};\n\nstatic int ak4671_hw_params(struct snd_pcm_substream *substream,\n\t\tstruct snd_pcm_hw_params *params,\n\t\tstruct snd_soc_dai *dai)\n{\n\tstruct snd_soc_component *component = dai->component;\n\tu8 fs;\n\n\tfs = snd_soc_component_read(component, AK4671_PLL_MODE_SELECT0);\n\tfs &= ~AK4671_FS;\n\n\tswitch (params_rate(params)) {\n\tcase 8000:\n\t\tfs |= AK4671_FS_8KHZ;\n\t\tbreak;\n\tcase 12000:\n\t\tfs |= AK4671_FS_12KHZ;\n\t\tbreak;\n\tcase 16000:\n\t\tfs |= AK4671_FS_16KHZ;\n\t\tbreak;\n\tcase 24000:\n\t\tfs |= AK4671_FS_24KHZ;\n\t\tbreak;\n\tcase 11025:\n\t\tfs |= AK4671_FS_11_025KHZ;\n\t\tbreak;\n\tcase 22050:\n\t\tfs |= AK4671_FS_22_05KHZ;\n\t\tbreak;\n\tcase 32000:\n\t\tfs |= AK4671_FS_32KHZ;\n\t\tbreak;\n\tcase 44100:\n\t\tfs |= AK4671_FS_44_1KHZ;\n\t\tbreak;\n\tcase 48000:\n\t\tfs |= AK4671_FS_48KHZ;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tsnd_soc_component_write(component, AK4671_PLL_MODE_SELECT0, fs);\n\n\treturn 0;\n}\n\nstatic int ak4671_set_dai_sysclk(struct snd_soc_dai *dai, int clk_id,\n\t\tunsigned int freq, int dir)\n{\n\tstruct snd_soc_component *component = dai->component;\n\tu8 pll;\n\n\tpll = snd_soc_component_read(component, AK4671_PLL_MODE_SELECT0);\n\tpll &= ~AK4671_PLL;\n\n\tswitch (freq) {\n\tcase 11289600:\n\t\tpll |= AK4671_PLL_11_2896MHZ;\n\t\tbreak;\n\tcase 12000000:\n\t\tpll |= AK4671_PLL_12MHZ;\n\t\tbreak;\n\tcase 12288000:\n\t\tpll |= AK4671_PLL_12_288MHZ;\n\t\tbreak;\n\tcase 13000000:\n\t\tpll |= AK4671_PLL_13MHZ;\n\t\tbreak;\n\tcase 13500000:\n\t\tpll |= AK4671_PLL_13_5MHZ;\n\t\tbreak;\n\tcase 19200000:\n\t\tpll |= AK4671_PLL_19_2MHZ;\n\t\tbreak;\n\tcase 24000000:\n\t\tpll |= AK4671_PLL_24MHZ;\n\t\tbreak;\n\tcase 26000000:\n\t\tpll |= AK4671_PLL_26MHZ;\n\t\tbreak;\n\tcase 27000000:\n\t\tpll |= AK4671_PLL_27MHZ;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tsnd_soc_component_write(component, AK4671_PLL_MODE_SELECT0, pll);\n\n\treturn 0;\n}\n\nstatic int ak4671_set_dai_fmt(struct snd_soc_dai *dai, unsigned int fmt)\n{\n\tstruct snd_soc_component *component = dai->component;\n\tu8 mode;\n\tu8 format;\n\n\t \n\tmode = snd_soc_component_read(component, AK4671_PLL_MODE_SELECT1);\n\n\tswitch (fmt & SND_SOC_DAIFMT_CLOCK_PROVIDER_MASK) {\n\tcase SND_SOC_DAIFMT_CBP_CFP:\n\t\tmode |= AK4671_M_S;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_CBP_CFC:\n\t\tmode &= ~(AK4671_M_S);\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\t \n\tformat = snd_soc_component_read(component, AK4671_FORMAT_SELECT);\n\tformat &= ~AK4671_DIF;\n\n\tswitch (fmt & SND_SOC_DAIFMT_FORMAT_MASK) {\n\tcase SND_SOC_DAIFMT_I2S:\n\t\tformat |= AK4671_DIF_I2S_MODE;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_LEFT_J:\n\t\tformat |= AK4671_DIF_MSB_MODE;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_DSP_A:\n\t\tformat |= AK4671_DIF_DSP_MODE;\n\t\tformat |= AK4671_BCKP;\n\t\tformat |= AK4671_MSBS;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\t \n\tsnd_soc_component_write(component, AK4671_PLL_MODE_SELECT1, mode);\n\tsnd_soc_component_write(component, AK4671_FORMAT_SELECT, format);\n\n\treturn 0;\n}\n\nstatic int ak4671_set_bias_level(struct snd_soc_component *component,\n\t\tenum snd_soc_bias_level level)\n{\n\tswitch (level) {\n\tcase SND_SOC_BIAS_ON:\n\tcase SND_SOC_BIAS_PREPARE:\n\tcase SND_SOC_BIAS_STANDBY:\n\t\tsnd_soc_component_update_bits(component, AK4671_AD_DA_POWER_MANAGEMENT,\n\t\t\t\t    AK4671_PMVCM, AK4671_PMVCM);\n\t\tbreak;\n\tcase SND_SOC_BIAS_OFF:\n\t\tsnd_soc_component_write(component, AK4671_AD_DA_POWER_MANAGEMENT, 0x00);\n\t\tbreak;\n\t}\n\treturn 0;\n}\n\n#define AK4671_RATES\t\t(SNDRV_PCM_RATE_8000 | SNDRV_PCM_RATE_11025 |\\\n\t\t\t\tSNDRV_PCM_RATE_16000 | SNDRV_PCM_RATE_22050 |\\\n\t\t\t\tSNDRV_PCM_RATE_32000 | SNDRV_PCM_RATE_44100 |\\\n\t\t\t\tSNDRV_PCM_RATE_48000)\n\n#define AK4671_FORMATS\t\tSNDRV_PCM_FMTBIT_S16_LE\n\nstatic const struct snd_soc_dai_ops ak4671_dai_ops = {\n\t.hw_params\t= ak4671_hw_params,\n\t.set_sysclk\t= ak4671_set_dai_sysclk,\n\t.set_fmt\t= ak4671_set_dai_fmt,\n};\n\nstatic struct snd_soc_dai_driver ak4671_dai = {\n\t.name = \"ak4671-hifi\",\n\t.playback = {\n\t\t.stream_name = \"Playback\",\n\t\t.channels_min = 1,\n\t\t.channels_max = 2,\n\t\t.rates = AK4671_RATES,\n\t\t.formats = AK4671_FORMATS,},\n\t.capture = {\n\t\t.stream_name = \"Capture\",\n\t\t.channels_min = 1,\n\t\t.channels_max = 2,\n\t\t.rates = AK4671_RATES,\n\t\t.formats = AK4671_FORMATS,},\n\t.ops = &ak4671_dai_ops,\n};\n\nstatic const struct snd_soc_component_driver soc_component_dev_ak4671 = {\n\t.set_bias_level\t\t= ak4671_set_bias_level,\n\t.controls\t\t= ak4671_snd_controls,\n\t.num_controls\t\t= ARRAY_SIZE(ak4671_snd_controls),\n\t.dapm_widgets\t\t= ak4671_dapm_widgets,\n\t.num_dapm_widgets\t= ARRAY_SIZE(ak4671_dapm_widgets),\n\t.dapm_routes\t\t= ak4671_intercon,\n\t.num_dapm_routes\t= ARRAY_SIZE(ak4671_intercon),\n\t.idle_bias_on\t\t= 1,\n\t.use_pmdown_time\t= 1,\n\t.endianness\t\t= 1,\n};\n\nstatic const struct regmap_config ak4671_regmap = {\n\t.reg_bits = 8,\n\t.val_bits = 8,\n\n\t.max_register = AK4671_SAR_ADC_CONTROL,\n\t.reg_defaults = ak4671_reg_defaults,\n\t.num_reg_defaults = ARRAY_SIZE(ak4671_reg_defaults),\n\t.cache_type = REGCACHE_RBTREE,\n};\n\nstatic int ak4671_i2c_probe(struct i2c_client *client)\n{\n\tstruct regmap *regmap;\n\tint ret;\n\n\tregmap = devm_regmap_init_i2c(client, &ak4671_regmap);\n\tif (IS_ERR(regmap)) {\n\t\tret = PTR_ERR(regmap);\n\t\tdev_err(&client->dev, \"Failed to create regmap: %d\\n\", ret);\n\t\treturn ret;\n\t}\n\n\tret = devm_snd_soc_register_component(&client->dev,\n\t\t\t&soc_component_dev_ak4671, &ak4671_dai, 1);\n\treturn ret;\n}\n\nstatic const struct i2c_device_id ak4671_i2c_id[] = {\n\t{ \"ak4671\", 0 },\n\t{ }\n};\nMODULE_DEVICE_TABLE(i2c, ak4671_i2c_id);\n\nstatic struct i2c_driver ak4671_i2c_driver = {\n\t.driver = {\n\t\t.name = \"ak4671-codec\",\n\t},\n\t.probe = ak4671_i2c_probe,\n\t.id_table = ak4671_i2c_id,\n};\n\nmodule_i2c_driver(ak4671_i2c_driver);\n\nMODULE_DESCRIPTION(\"ASoC AK4671 codec driver\");\nMODULE_AUTHOR(\"Joonyoung Shim <jy0922.shim@samsung.com>\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}