{
  "module_name": "wcd-mbhc-v2.h",
  "hash_id": "6d18279924bbec7ca3752f328d906d52fb83d469558b2d4c9dfd6239aa1e7f99",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/codecs/wcd-mbhc-v2.h",
  "human_readable_source": " \n\n#ifndef __WCD_MBHC_V2_H__\n#define __WCD_MBHC_V2_H__\n\n#include <sound/jack.h>\n\n#define WCD_MBHC_FIELD(id, rreg, rmask) \\\n\t[id] = { .reg = rreg, .mask = rmask }\n\nenum wcd_mbhc_field_function {\n\tWCD_MBHC_L_DET_EN,\n\tWCD_MBHC_GND_DET_EN,\n\tWCD_MBHC_MECH_DETECTION_TYPE,\n\tWCD_MBHC_MIC_CLAMP_CTL,\n\tWCD_MBHC_ELECT_DETECTION_TYPE,\n\tWCD_MBHC_HS_L_DET_PULL_UP_CTRL,\n\tWCD_MBHC_HS_L_DET_PULL_UP_COMP_CTRL,\n\tWCD_MBHC_HPHL_PLUG_TYPE,\n\tWCD_MBHC_GND_PLUG_TYPE,\n\tWCD_MBHC_SW_HPH_LP_100K_TO_GND,\n\tWCD_MBHC_ELECT_SCHMT_ISRC,\n\tWCD_MBHC_FSM_EN,\n\tWCD_MBHC_INSREM_DBNC,\n\tWCD_MBHC_BTN_DBNC,\n\tWCD_MBHC_HS_VREF,\n\tWCD_MBHC_HS_COMP_RESULT,\n\tWCD_MBHC_IN2P_CLAMP_STATE,\n\tWCD_MBHC_MIC_SCHMT_RESULT,\n\tWCD_MBHC_HPHL_SCHMT_RESULT,\n\tWCD_MBHC_HPHR_SCHMT_RESULT,\n\tWCD_MBHC_OCP_FSM_EN,\n\tWCD_MBHC_BTN_RESULT,\n\tWCD_MBHC_BTN_ISRC_CTL,\n\tWCD_MBHC_ELECT_RESULT,\n\tWCD_MBHC_MICB_CTRL,     \n\tWCD_MBHC_HPH_CNP_WG_TIME,\n\tWCD_MBHC_HPHR_PA_EN,\n\tWCD_MBHC_HPHL_PA_EN,\n\tWCD_MBHC_HPH_PA_EN,\n\tWCD_MBHC_SWCH_LEVEL_REMOVE,\n\tWCD_MBHC_PULLDOWN_CTRL,\n\tWCD_MBHC_ANC_DET_EN,\n\tWCD_MBHC_FSM_STATUS,\n\tWCD_MBHC_MUX_CTL,\n\tWCD_MBHC_MOISTURE_STATUS,\n\tWCD_MBHC_HPHR_GND,\n\tWCD_MBHC_HPHL_GND,\n\tWCD_MBHC_HPHL_OCP_DET_EN,\n\tWCD_MBHC_HPHR_OCP_DET_EN,\n\tWCD_MBHC_HPHL_OCP_STATUS,\n\tWCD_MBHC_HPHR_OCP_STATUS,\n\tWCD_MBHC_ADC_EN,\n\tWCD_MBHC_ADC_COMPLETE,\n\tWCD_MBHC_ADC_TIMEOUT,\n\tWCD_MBHC_ADC_RESULT,\n\tWCD_MBHC_MICB2_VOUT,\n\tWCD_MBHC_ADC_MODE,\n\tWCD_MBHC_DETECTION_DONE,\n\tWCD_MBHC_ELECT_ISRC_EN,\n\tWCD_MBHC_REG_FUNC_MAX,\n};\n\n#define WCD_MBHC_DEF_BUTTONS 8\n#define WCD_MBHC_KEYCODE_NUM 8\n#define WCD_MBHC_USLEEP_RANGE_MARGIN_US 100\n#define WCD_MBHC_THR_HS_MICB_MV  2700\n#define WCD_MONO_HS_MIN_THR\t2\n\nenum wcd_mbhc_detect_logic {\n\tWCD_DETECTION_LEGACY,\n\tWCD_DETECTION_ADC,\n};\n\nenum wcd_mbhc_cs_mb_en_flag {\n\tWCD_MBHC_EN_CS = 0,\n\tWCD_MBHC_EN_MB,\n\tWCD_MBHC_EN_PULLUP,\n\tWCD_MBHC_EN_NONE,\n};\n\nenum {\n\tWCD_MBHC_ELEC_HS_INS,\n\tWCD_MBHC_ELEC_HS_REM,\n};\n\nenum wcd_mbhc_plug_type {\n\tMBHC_PLUG_TYPE_INVALID = -1,\n\tMBHC_PLUG_TYPE_NONE,\n\tMBHC_PLUG_TYPE_HEADSET,\n\tMBHC_PLUG_TYPE_HEADPHONE,\n\tMBHC_PLUG_TYPE_HIGH_HPH,\n\tMBHC_PLUG_TYPE_GND_MIC_SWAP,\n};\n\nenum pa_dac_ack_flags {\n\tWCD_MBHC_HPHL_PA_OFF_ACK = 0,\n\tWCD_MBHC_HPHR_PA_OFF_ACK,\n};\n\nenum wcd_mbhc_btn_det_mem {\n\tWCD_MBHC_BTN_DET_V_BTN_LOW,\n\tWCD_MBHC_BTN_DET_V_BTN_HIGH\n};\n\nenum {\n\tMIC_BIAS_1 = 1,\n\tMIC_BIAS_2,\n\tMIC_BIAS_3,\n\tMIC_BIAS_4\n};\n\nenum {\n\tMICB_PULLUP_ENABLE,\n\tMICB_PULLUP_DISABLE,\n\tMICB_ENABLE,\n\tMICB_DISABLE,\n};\n\nenum wcd_notify_event {\n\tWCD_EVENT_INVALID,\n\t \n\tWCD_EVENT_PRE_MICBIAS_2_OFF,\n\tWCD_EVENT_POST_MICBIAS_2_OFF,\n\tWCD_EVENT_PRE_MICBIAS_2_ON,\n\tWCD_EVENT_POST_MICBIAS_2_ON,\n\tWCD_EVENT_PRE_DAPM_MICBIAS_2_OFF,\n\tWCD_EVENT_POST_DAPM_MICBIAS_2_OFF,\n\tWCD_EVENT_PRE_DAPM_MICBIAS_2_ON,\n\tWCD_EVENT_POST_DAPM_MICBIAS_2_ON,\n\t \n\tWCD_EVENT_PRE_HPHL_PA_ON,\n\tWCD_EVENT_POST_HPHL_PA_OFF,\n\tWCD_EVENT_PRE_HPHR_PA_ON,\n\tWCD_EVENT_POST_HPHR_PA_OFF,\n\tWCD_EVENT_PRE_HPHL_PA_OFF,\n\tWCD_EVENT_PRE_HPHR_PA_OFF,\n\tWCD_EVENT_OCP_OFF,\n\tWCD_EVENT_OCP_ON,\n\tWCD_EVENT_LAST,\n};\n\nenum wcd_mbhc_event_state {\n\tWCD_MBHC_EVENT_PA_HPHL,\n\tWCD_MBHC_EVENT_PA_HPHR,\n};\n\nenum wcd_mbhc_hph_type {\n\tWCD_MBHC_HPH_NONE = 0,\n\tWCD_MBHC_HPH_MONO,\n\tWCD_MBHC_HPH_STEREO,\n};\n\n \n\nenum mbhc_hs_pullup_iref {\n\tI_DEFAULT = -1,\n\tI_OFF = 0,\n\tI_1P0_UA,\n\tI_2P0_UA,\n\tI_3P0_UA,\n};\n\nenum mbhc_hs_pullup_iref_v2 {\n\tHS_PULLUP_I_DEFAULT = -1,\n\tHS_PULLUP_I_3P0_UA = 0,\n\tHS_PULLUP_I_2P25_UA,\n\tHS_PULLUP_I_1P5_UA,\n\tHS_PULLUP_I_0P75_UA,\n\tHS_PULLUP_I_1P125_UA = 0x05,\n\tHS_PULLUP_I_0P375_UA = 0x07,\n\tHS_PULLUP_I_2P0_UA,\n\tHS_PULLUP_I_1P0_UA = 0x0A,\n\tHS_PULLUP_I_0P5_UA,\n\tHS_PULLUP_I_0P25_UA = 0x0F,\n\tHS_PULLUP_I_0P125_UA = 0x17,\n\tHS_PULLUP_I_OFF,\n};\n\nenum mbhc_moisture_rref {\n\tR_OFF,\n\tR_24_KOHM,\n\tR_84_KOHM,\n\tR_184_KOHM,\n};\n\nstruct wcd_mbhc_config {\n\tint btn_high[WCD_MBHC_DEF_BUTTONS];\n\tint btn_low[WCD_MBHC_DEF_BUTTONS];\n\tint v_hs_max;\n\tint num_btn;\n\tbool mono_stero_detection;\n\tbool (*swap_gnd_mic)(struct snd_soc_component *component, bool active);\n\tbool hs_ext_micbias;\n\tbool gnd_det_en;\n\tuint32_t linein_th;\n\tbool moisture_en;\n\tint mbhc_micbias;\n\tint anc_micbias;\n\tbool moisture_duty_cycle_en;\n\tbool hphl_swh;  \n\tbool gnd_swh;  \n\tu32 hs_thr;\n\tu32 hph_thr;\n\tu32 micb_mv;\n\tu32 moist_vref;\n\tu32 moist_iref;\n\tu32 moist_rref;\n};\n\nstruct wcd_mbhc_intr {\n\tint mbhc_sw_intr;\n\tint mbhc_btn_press_intr;\n\tint mbhc_btn_release_intr;\n\tint mbhc_hs_ins_intr;\n\tint mbhc_hs_rem_intr;\n\tint hph_left_ocp;\n\tint hph_right_ocp;\n};\n\nstruct wcd_mbhc_field {\n\tu16 reg;\n\tu8 mask;\n};\n\nstruct wcd_mbhc;\n\nstruct wcd_mbhc_cb {\n\tvoid (*update_cross_conn_thr)(struct snd_soc_component *component);\n\tvoid (*get_micbias_val)(struct snd_soc_component *component, int *mb);\n\tvoid (*bcs_enable)(struct snd_soc_component *component, bool bcs_enable);\n\tvoid (*compute_impedance)(struct snd_soc_component *component,\n\t\t\t\t  uint32_t *zl, uint32_t *zr);\n\tvoid (*set_micbias_value)(struct snd_soc_component *component);\n\tvoid (*set_auto_zeroing)(struct snd_soc_component *component,\n\t\t\tbool enable);\n\tvoid (*clk_setup)(struct snd_soc_component *component, bool enable);\n\tbool (*micbias_enable_status)(struct snd_soc_component *component, int micb_num);\n\tvoid (*mbhc_bias)(struct snd_soc_component *component, bool enable);\n\tvoid (*set_btn_thr)(struct snd_soc_component *component,\n\t\t\t    int *btn_low, int *btn_high,\n\t\t\t    int num_btn, bool is_micbias);\n\tvoid (*hph_pull_up_control)(struct snd_soc_component *component,\n\t\t\t\t    enum mbhc_hs_pullup_iref);\n\tint (*mbhc_micbias_control)(struct snd_soc_component *component,\n\t\t\tint micb_num, int req);\n\tvoid (*mbhc_micb_ramp_control)(struct snd_soc_component *component,\n\t\t\tbool enable);\n\tbool (*extn_use_mb)(struct snd_soc_component *component);\n\tint (*mbhc_micb_ctrl_thr_mic)(struct snd_soc_component *component,\n\t\t\tint micb_num, bool req_en);\n\tvoid (*mbhc_gnd_det_ctrl)(struct snd_soc_component *component,\n\t\t\tbool enable);\n\tvoid (*hph_pull_down_ctrl)(struct snd_soc_component *component,\n\t\t\tbool enable);\n\tvoid (*mbhc_moisture_config)(struct snd_soc_component *component);\n\tvoid (*update_anc_state)(struct snd_soc_component *component,\n\t\t\tbool enable, int anc_num);\n\tvoid (*hph_pull_up_control_v2)(struct snd_soc_component *component,\n\t\t\tint pull_up_cur);\n\tbool (*mbhc_get_moisture_status)(struct snd_soc_component *component);\n\tvoid (*mbhc_moisture_polling_ctrl)(struct snd_soc_component *component, bool enable);\n\tvoid (*mbhc_moisture_detect_en)(struct snd_soc_component *component, bool enable);\n};\n\n#if IS_ENABLED(CONFIG_SND_SOC_WCD_MBHC)\nint wcd_dt_parse_mbhc_data(struct device *dev, struct wcd_mbhc_config *cfg);\nint wcd_mbhc_start(struct wcd_mbhc *mbhc, struct wcd_mbhc_config *mbhc_cfg,\n\t\t   struct snd_soc_jack *jack);\nvoid wcd_mbhc_stop(struct wcd_mbhc *mbhc);\nvoid wcd_mbhc_set_hph_type(struct wcd_mbhc *mbhc, int hph_type);\nint wcd_mbhc_get_hph_type(struct wcd_mbhc *mbhc);\nstruct wcd_mbhc *wcd_mbhc_init(struct snd_soc_component *component,\n\t\t      const struct wcd_mbhc_cb *mbhc_cb,\n\t\t      const struct wcd_mbhc_intr *mbhc_cdc_intr_ids,\n\t\t      struct wcd_mbhc_field *fields,\n\t\t      bool impedance_det_en);\nint wcd_mbhc_get_impedance(struct wcd_mbhc *mbhc, uint32_t *zl,\n\t\t\t   uint32_t *zr);\nvoid wcd_mbhc_deinit(struct wcd_mbhc *mbhc);\nint wcd_mbhc_event_notify(struct wcd_mbhc *mbhc, unsigned long event);\n\n#else\nstatic inline int wcd_dt_parse_mbhc_data(struct device *dev,\n\t\t\t\t\t struct wcd_mbhc_config *cfg)\n{\n\treturn -ENOTSUPP;\n}\n\nstatic inline void wcd_mbhc_stop(struct wcd_mbhc *mbhc)\n{\n}\n\nstatic inline struct wcd_mbhc *wcd_mbhc_init(struct snd_soc_component *component,\n\t\t      const struct wcd_mbhc_cb *mbhc_cb,\n\t\t      const struct wcd_mbhc_intr *mbhc_cdc_intr_ids,\n\t\t      struct wcd_mbhc_field *fields,\n\t\t      bool impedance_det_en)\n{\n\treturn ERR_PTR(-ENOTSUPP);\n}\n\nstatic inline void wcd_mbhc_set_hph_type(struct wcd_mbhc *mbhc, int hph_type)\n{\n}\n\nstatic inline int wcd_mbhc_get_hph_type(struct wcd_mbhc *mbhc)\n{\n\treturn -ENOTSUPP;\n}\n\nstatic inline int wcd_mbhc_event_notify(struct wcd_mbhc *mbhc, unsigned long event)\n{\n\treturn -ENOTSUPP;\n}\n\nstatic inline int wcd_mbhc_start(struct wcd_mbhc *mbhc,\n\t\t\t\t struct wcd_mbhc_config *mbhc_cfg,\n\t\t\t\t struct snd_soc_jack *jack)\n{\n\treturn 0;\n}\n\nstatic inline int wcd_mbhc_get_impedance(struct wcd_mbhc *mbhc,\n\t\t\t\t\t uint32_t *zl,\n\t\t\t\t\t uint32_t *zr)\n{\n\t*zl = 0;\n\t*zr = 0;\n\treturn -EINVAL;\n}\nstatic inline void wcd_mbhc_deinit(struct wcd_mbhc *mbhc)\n{\n}\n#endif\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}