{
  "module_name": "rt1011.c",
  "hash_id": "06f48b48897dab30b0391e6882a9be6662170827cd2fcc5d9411da8806c64802",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/codecs/rt1011.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/moduleparam.h>\n#include <linux/init.h>\n#include <linux/delay.h>\n#include <linux/pm.h>\n#include <linux/i2c.h>\n#include <linux/acpi.h>\n#include <linux/regmap.h>\n#include <linux/platform_device.h>\n#include <linux/firmware.h>\n#include <sound/core.h>\n#include <sound/pcm.h>\n#include <sound/pcm_params.h>\n#include <sound/soc.h>\n#include <sound/soc-dapm.h>\n#include <sound/initval.h>\n#include <sound/tlv.h>\n\n#include \"rl6231.h\"\n#include \"rt1011.h\"\n\nstatic int rt1011_calibrate(struct rt1011_priv *rt1011,\n\tunsigned char cali_flag);\n\nstatic const struct reg_sequence init_list[] = {\n\n\t{ RT1011_POWER_9, 0xa840 },\n\n\t{ RT1011_ADC_SET_5, 0x0a20 },\n\t{ RT1011_DAC_SET_2, 0xa032 },\n\n\t{ RT1011_SPK_PRO_DC_DET_1, 0xb00c },\n\t{ RT1011_SPK_PRO_DC_DET_2, 0xcccc },\n\n\t{ RT1011_A_TIMING_1, 0x6054 },\n\n\t{ RT1011_POWER_7, 0x3e55 },\n\t{ RT1011_POWER_8, 0x0520 },\n\t{ RT1011_BOOST_CON_1, 0xe188 },\n\t{ RT1011_POWER_4, 0x16f2 },\n\n\t{ RT1011_CROSS_BQ_SET_1, 0x0004 },\n\t{ RT1011_SIL_DET, 0xc313 },\n\t{ RT1011_SINE_GEN_REG_1, 0x0707 },\n\n\t{ RT1011_DC_CALIB_CLASSD_3, 0xcb00 },\n\n\t{ RT1011_DAC_SET_1, 0xe702 },\n\t{ RT1011_DAC_SET_3, 0x2004 },\n};\n\nstatic const struct reg_default rt1011_reg[] = {\n\t{0x0000, 0x0000},\n\t{0x0002, 0x0000},\n\t{0x0004, 0xa000},\n\t{0x0006, 0x0000},\n\t{0x0008, 0x0003},\n\t{0x000a, 0x087e},\n\t{0x000c, 0x0020},\n\t{0x000e, 0x9002},\n\t{0x0010, 0x0000},\n\t{0x0012, 0x0000},\n\t{0x0020, 0x0c40},\n\t{0x0022, 0x4313},\n\t{0x0076, 0x0000},\n\t{0x0078, 0x0000},\n\t{0x007a, 0x0000},\n\t{0x007c, 0x10ec},\n\t{0x007d, 0x1011},\n\t{0x00f0, 0x5000},\n\t{0x00f2, 0x0374},\n\t{0x00f3, 0x0000},\n\t{0x00f4, 0x0000},\n\t{0x0100, 0x0038},\n\t{0x0102, 0xff02},\n\t{0x0104, 0x0232},\n\t{0x0106, 0x200c},\n\t{0x0107, 0x0000},\n\t{0x0108, 0x2f2f},\n\t{0x010a, 0x2f2f},\n\t{0x010c, 0x002f},\n\t{0x010e, 0xe000},\n\t{0x0110, 0x0820},\n\t{0x0111, 0x4010},\n\t{0x0112, 0x0000},\n\t{0x0114, 0x0000},\n\t{0x0116, 0x0000},\n\t{0x0118, 0x0000},\n\t{0x011a, 0x0101},\n\t{0x011c, 0x4567},\n\t{0x011e, 0x0000},\n\t{0x0120, 0x0000},\n\t{0x0122, 0x0000},\n\t{0x0124, 0x0123},\n\t{0x0126, 0x4567},\n\t{0x0200, 0x0000},\n\t{0x0300, 0xffdd},\n\t{0x0302, 0x001e},\n\t{0x0311, 0x0000},\n\t{0x0313, 0x5254},\n\t{0x0314, 0x0062},\n\t{0x0316, 0x7f40},\n\t{0x0319, 0x000f},\n\t{0x031a, 0xffff},\n\t{0x031b, 0x0000},\n\t{0x031c, 0x009f},\n\t{0x031d, 0xffff},\n\t{0x031e, 0x0000},\n\t{0x031f, 0x0000},\n\t{0x0320, 0xe31c},\n\t{0x0321, 0x0000},\n\t{0x0322, 0x0000},\n\t{0x0324, 0x0000},\n\t{0x0326, 0x0002},\n\t{0x0328, 0x20b2},\n\t{0x0329, 0x0175},\n\t{0x032a, 0x32ad},\n\t{0x032b, 0x3455},\n\t{0x032c, 0x0528},\n\t{0x032d, 0xa800},\n\t{0x032e, 0x030e},\n\t{0x0330, 0x2080},\n\t{0x0332, 0x0034},\n\t{0x0334, 0x0000},\n\t{0x0508, 0x0010},\n\t{0x050a, 0x0018},\n\t{0x050c, 0x0000},\n\t{0x050d, 0xffff},\n\t{0x050e, 0x1f1f},\n\t{0x050f, 0x04ff},\n\t{0x0510, 0x4020},\n\t{0x0511, 0x01f0},\n\t{0x0512, 0x0702},\n\t{0x0516, 0xbb80},\n\t{0x0517, 0xffff},\n\t{0x0518, 0xffff},\n\t{0x0519, 0x307f},\n\t{0x051a, 0xffff},\n\t{0x051b, 0x0000},\n\t{0x051c, 0x0000},\n\t{0x051d, 0x2000},\n\t{0x051e, 0x0000},\n\t{0x051f, 0x0000},\n\t{0x0520, 0x0000},\n\t{0x0521, 0x1001},\n\t{0x0522, 0x7fff},\n\t{0x0524, 0x7fff},\n\t{0x0526, 0x0000},\n\t{0x0528, 0x0000},\n\t{0x052a, 0x0000},\n\t{0x0530, 0x0401},\n\t{0x0532, 0x3000},\n\t{0x0534, 0x0000},\n\t{0x0535, 0xffff},\n\t{0x0536, 0x101c},\n\t{0x0538, 0x1814},\n\t{0x053a, 0x100c},\n\t{0x053c, 0x0804},\n\t{0x053d, 0x0000},\n\t{0x053e, 0x0000},\n\t{0x053f, 0x0000},\n\t{0x0540, 0x0000},\n\t{0x0541, 0x0000},\n\t{0x0542, 0x0000},\n\t{0x0543, 0x0000},\n\t{0x0544, 0x001c},\n\t{0x0545, 0x1814},\n\t{0x0546, 0x100c},\n\t{0x0547, 0x0804},\n\t{0x0548, 0x0000},\n\t{0x0549, 0x0000},\n\t{0x054a, 0x0000},\n\t{0x054b, 0x0000},\n\t{0x054c, 0x0000},\n\t{0x054d, 0x0000},\n\t{0x054e, 0x0000},\n\t{0x054f, 0x0000},\n\t{0x0566, 0x0000},\n\t{0x0568, 0x20f1},\n\t{0x056a, 0x0007},\n\t{0x0600, 0x9d00},\n\t{0x0611, 0x2000},\n\t{0x0612, 0x505f},\n\t{0x0613, 0x0444},\n\t{0x0614, 0x4000},\n\t{0x0615, 0x4004},\n\t{0x0616, 0x0606},\n\t{0x0617, 0x8904},\n\t{0x0618, 0xe021},\n\t{0x0621, 0x2000},\n\t{0x0622, 0x505f},\n\t{0x0623, 0x0444},\n\t{0x0624, 0x4000},\n\t{0x0625, 0x4004},\n\t{0x0626, 0x0606},\n\t{0x0627, 0x8704},\n\t{0x0628, 0xe021},\n\t{0x0631, 0x2000},\n\t{0x0632, 0x517f},\n\t{0x0633, 0x0440},\n\t{0x0634, 0x4000},\n\t{0x0635, 0x4104},\n\t{0x0636, 0x0306},\n\t{0x0637, 0x8904},\n\t{0x0638, 0xe021},\n\t{0x0702, 0x0014},\n\t{0x0704, 0x0000},\n\t{0x0706, 0x0014},\n\t{0x0708, 0x0000},\n\t{0x070a, 0x0000},\n\t{0x0710, 0x0200},\n\t{0x0711, 0x0000},\n\t{0x0712, 0x0200},\n\t{0x0713, 0x0000},\n\t{0x0720, 0x0200},\n\t{0x0721, 0x0000},\n\t{0x0722, 0x0000},\n\t{0x0723, 0x0000},\n\t{0x0724, 0x0000},\n\t{0x0725, 0x0000},\n\t{0x0726, 0x0000},\n\t{0x0727, 0x0000},\n\t{0x0728, 0x0000},\n\t{0x0729, 0x0000},\n\t{0x0730, 0x0200},\n\t{0x0731, 0x0000},\n\t{0x0732, 0x0000},\n\t{0x0733, 0x0000},\n\t{0x0734, 0x0000},\n\t{0x0735, 0x0000},\n\t{0x0736, 0x0000},\n\t{0x0737, 0x0000},\n\t{0x0738, 0x0000},\n\t{0x0739, 0x0000},\n\t{0x0740, 0x0200},\n\t{0x0741, 0x0000},\n\t{0x0742, 0x0000},\n\t{0x0743, 0x0000},\n\t{0x0744, 0x0000},\n\t{0x0745, 0x0000},\n\t{0x0746, 0x0000},\n\t{0x0747, 0x0000},\n\t{0x0748, 0x0000},\n\t{0x0749, 0x0000},\n\t{0x0750, 0x0200},\n\t{0x0751, 0x0000},\n\t{0x0752, 0x0000},\n\t{0x0753, 0x0000},\n\t{0x0754, 0x0000},\n\t{0x0755, 0x0000},\n\t{0x0756, 0x0000},\n\t{0x0757, 0x0000},\n\t{0x0758, 0x0000},\n\t{0x0759, 0x0000},\n\t{0x0760, 0x0200},\n\t{0x0761, 0x0000},\n\t{0x0762, 0x0000},\n\t{0x0763, 0x0000},\n\t{0x0764, 0x0000},\n\t{0x0765, 0x0000},\n\t{0x0766, 0x0000},\n\t{0x0767, 0x0000},\n\t{0x0768, 0x0000},\n\t{0x0769, 0x0000},\n\t{0x0770, 0x0200},\n\t{0x0771, 0x0000},\n\t{0x0772, 0x0000},\n\t{0x0773, 0x0000},\n\t{0x0774, 0x0000},\n\t{0x0775, 0x0000},\n\t{0x0776, 0x0000},\n\t{0x0777, 0x0000},\n\t{0x0778, 0x0000},\n\t{0x0779, 0x0000},\n\t{0x0780, 0x0200},\n\t{0x0781, 0x0000},\n\t{0x0782, 0x0000},\n\t{0x0783, 0x0000},\n\t{0x0784, 0x0000},\n\t{0x0785, 0x0000},\n\t{0x0786, 0x0000},\n\t{0x0787, 0x0000},\n\t{0x0788, 0x0000},\n\t{0x0789, 0x0000},\n\t{0x0790, 0x0200},\n\t{0x0791, 0x0000},\n\t{0x0792, 0x0000},\n\t{0x0793, 0x0000},\n\t{0x0794, 0x0000},\n\t{0x0795, 0x0000},\n\t{0x0796, 0x0000},\n\t{0x0797, 0x0000},\n\t{0x0798, 0x0000},\n\t{0x0799, 0x0000},\n\t{0x07a0, 0x0200},\n\t{0x07a1, 0x0000},\n\t{0x07a2, 0x0000},\n\t{0x07a3, 0x0000},\n\t{0x07a4, 0x0000},\n\t{0x07a5, 0x0000},\n\t{0x07a6, 0x0000},\n\t{0x07a7, 0x0000},\n\t{0x07a8, 0x0000},\n\t{0x07a9, 0x0000},\n\t{0x07b0, 0x0200},\n\t{0x07b1, 0x0000},\n\t{0x07b2, 0x0000},\n\t{0x07b3, 0x0000},\n\t{0x07b4, 0x0000},\n\t{0x07b5, 0x0000},\n\t{0x07b6, 0x0000},\n\t{0x07b7, 0x0000},\n\t{0x07b8, 0x0000},\n\t{0x07b9, 0x0000},\n\t{0x07c0, 0x0200},\n\t{0x07c1, 0x0000},\n\t{0x07c2, 0x0000},\n\t{0x07c3, 0x0000},\n\t{0x07c4, 0x0000},\n\t{0x07c5, 0x0000},\n\t{0x07c6, 0x0000},\n\t{0x07c7, 0x0000},\n\t{0x07c8, 0x0000},\n\t{0x07c9, 0x0000},\n\t{0x1000, 0x4040},\n\t{0x1002, 0x6505},\n\t{0x1004, 0x5405},\n\t{0x1006, 0x5555},\n\t{0x1007, 0x003f},\n\t{0x1008, 0x7fd7},\n\t{0x1009, 0x770f},\n\t{0x100a, 0xfffe},\n\t{0x100b, 0xe000},\n\t{0x100c, 0x0000},\n\t{0x100d, 0x0007},\n\t{0x1010, 0xa433},\n\t{0x1020, 0x0000},\n\t{0x1022, 0x0000},\n\t{0x1024, 0x0000},\n\t{0x1200, 0x5a01},\n\t{0x1202, 0x6324},\n\t{0x1204, 0x0b00},\n\t{0x1206, 0x0000},\n\t{0x1208, 0x0000},\n\t{0x120a, 0x0024},\n\t{0x120c, 0x0000},\n\t{0x120e, 0x000e},\n\t{0x1210, 0x0000},\n\t{0x1212, 0x0000},\n\t{0x1300, 0x0701},\n\t{0x1302, 0x12f9},\n\t{0x1304, 0x3405},\n\t{0x1305, 0x0844},\n\t{0x1306, 0x5611},\n\t{0x1308, 0x555e},\n\t{0x130a, 0xa605},\n\t{0x130c, 0x2000},\n\t{0x130e, 0x0000},\n\t{0x130f, 0x0001},\n\t{0x1310, 0xaa48},\n\t{0x1312, 0x0285},\n\t{0x1314, 0xaaaa},\n\t{0x1316, 0xaaa0},\n\t{0x1318, 0x2aaa},\n\t{0x131a, 0xaa07},\n\t{0x1322, 0x0029},\n\t{0x1323, 0x4a52},\n\t{0x1324, 0x002c},\n\t{0x1325, 0x0b02},\n\t{0x1326, 0x002d},\n\t{0x1327, 0x6b5a},\n\t{0x1328, 0x002e},\n\t{0x1329, 0xcbb2},\n\t{0x132a, 0x0030},\n\t{0x132b, 0x2c0b},\n\t{0x1330, 0x0031},\n\t{0x1331, 0x8c63},\n\t{0x1332, 0x0032},\n\t{0x1333, 0xecbb},\n\t{0x1334, 0x0034},\n\t{0x1335, 0x4d13},\n\t{0x1336, 0x0037},\n\t{0x1337, 0x0dc3},\n\t{0x1338, 0x003d},\n\t{0x1339, 0xef7b},\n\t{0x133a, 0x0044},\n\t{0x133b, 0xd134},\n\t{0x133c, 0x0047},\n\t{0x133d, 0x91e4},\n\t{0x133e, 0x004d},\n\t{0x133f, 0xc370},\n\t{0x1340, 0x0053},\n\t{0x1341, 0xf4fd},\n\t{0x1342, 0x0060},\n\t{0x1343, 0x5816},\n\t{0x1344, 0x006c},\n\t{0x1345, 0xbb2e},\n\t{0x1346, 0x0072},\n\t{0x1347, 0xecbb},\n\t{0x1348, 0x0076},\n\t{0x1349, 0x5d97},\n\t{0x1500, 0x0702},\n\t{0x1502, 0x002f},\n\t{0x1504, 0x0000},\n\t{0x1510, 0x0064},\n\t{0x1512, 0x0000},\n\t{0x1514, 0xdf47},\n\t{0x1516, 0x079c},\n\t{0x1518, 0xfbf5},\n\t{0x151a, 0x00bc},\n\t{0x151c, 0x3b85},\n\t{0x151e, 0x02b3},\n\t{0x1520, 0x3333},\n\t{0x1522, 0x0000},\n\t{0x1524, 0x4000},\n\t{0x1528, 0x0064},\n\t{0x152a, 0x0000},\n\t{0x152c, 0x0000},\n\t{0x152e, 0x0000},\n\t{0x1530, 0x0000},\n\t{0x1532, 0x0000},\n\t{0x1534, 0x0000},\n\t{0x1536, 0x0000},\n\t{0x1538, 0x0040},\n\t{0x1539, 0x0000},\n\t{0x153a, 0x0040},\n\t{0x153b, 0x0000},\n\t{0x153c, 0x0064},\n\t{0x153e, 0x0bf9},\n\t{0x1540, 0xb2a9},\n\t{0x1544, 0x0200},\n\t{0x1546, 0x0000},\n\t{0x1548, 0x00ca},\n\t{0x1552, 0x03ff},\n\t{0x1554, 0x017f},\n\t{0x1556, 0x017f},\n\t{0x155a, 0x0000},\n\t{0x155c, 0x0000},\n\t{0x1560, 0x0040},\n\t{0x1562, 0x0000},\n\t{0x1570, 0x03ff},\n\t{0x1571, 0xdcff},\n\t{0x1572, 0x1e00},\n\t{0x1573, 0x224f},\n\t{0x1574, 0x0000},\n\t{0x1575, 0x0000},\n\t{0x1576, 0x1e00},\n\t{0x1577, 0x0000},\n\t{0x1578, 0x0000},\n\t{0x1579, 0x1128},\n\t{0x157a, 0x03ff},\n\t{0x157b, 0xdcff},\n\t{0x157c, 0x1e00},\n\t{0x157d, 0x224f},\n\t{0x157e, 0x0000},\n\t{0x157f, 0x0000},\n\t{0x1580, 0x1e00},\n\t{0x1581, 0x0000},\n\t{0x1582, 0x0000},\n\t{0x1583, 0x1128},\n\t{0x1590, 0x03ff},\n\t{0x1591, 0xdcff},\n\t{0x1592, 0x1e00},\n\t{0x1593, 0x224f},\n\t{0x1594, 0x0000},\n\t{0x1595, 0x0000},\n\t{0x1596, 0x1e00},\n\t{0x1597, 0x0000},\n\t{0x1598, 0x0000},\n\t{0x1599, 0x1128},\n\t{0x159a, 0x03ff},\n\t{0x159b, 0xdcff},\n\t{0x159c, 0x1e00},\n\t{0x159d, 0x224f},\n\t{0x159e, 0x0000},\n\t{0x159f, 0x0000},\n\t{0x15a0, 0x1e00},\n\t{0x15a1, 0x0000},\n\t{0x15a2, 0x0000},\n\t{0x15a3, 0x1128},\n\t{0x15b0, 0x007f},\n\t{0x15b1, 0xffff},\n\t{0x15b2, 0x007f},\n\t{0x15b3, 0xffff},\n\t{0x15b4, 0x007f},\n\t{0x15b5, 0xffff},\n\t{0x15b8, 0x007f},\n\t{0x15b9, 0xffff},\n\t{0x15bc, 0x0000},\n\t{0x15bd, 0x0000},\n\t{0x15be, 0xff00},\n\t{0x15bf, 0x0000},\n\t{0x15c0, 0xff00},\n\t{0x15c1, 0x0000},\n\t{0x15c3, 0xfc00},\n\t{0x15c4, 0xbb80},\n\t{0x15d0, 0x0000},\n\t{0x15d1, 0x0000},\n\t{0x15d2, 0x0000},\n\t{0x15d3, 0x0000},\n\t{0x15d4, 0x0000},\n\t{0x15d5, 0x0000},\n\t{0x15d6, 0x0000},\n\t{0x15d7, 0x0000},\n\t{0x15d8, 0x0200},\n\t{0x15d9, 0x0000},\n\t{0x15da, 0x0000},\n\t{0x15db, 0x0000},\n\t{0x15dc, 0x0000},\n\t{0x15dd, 0x0000},\n\t{0x15de, 0x0000},\n\t{0x15df, 0x0000},\n\t{0x15e0, 0x0000},\n\t{0x15e1, 0x0000},\n\t{0x15e2, 0x0200},\n\t{0x15e3, 0x0000},\n\t{0x15e4, 0x0000},\n\t{0x15e5, 0x0000},\n\t{0x15e6, 0x0000},\n\t{0x15e7, 0x0000},\n\t{0x15e8, 0x0000},\n\t{0x15e9, 0x0000},\n\t{0x15ea, 0x0000},\n\t{0x15eb, 0x0000},\n\t{0x15ec, 0x0200},\n\t{0x15ed, 0x0000},\n\t{0x15ee, 0x0000},\n\t{0x15ef, 0x0000},\n\t{0x15f0, 0x0000},\n\t{0x15f1, 0x0000},\n\t{0x15f2, 0x0000},\n\t{0x15f3, 0x0000},\n\t{0x15f4, 0x0000},\n\t{0x15f5, 0x0000},\n\t{0x15f6, 0x0200},\n\t{0x15f7, 0x0200},\n\t{0x15f8, 0x8200},\n\t{0x15f9, 0x0000},\n\t{0x1600, 0x007d},\n\t{0x1601, 0xa178},\n\t{0x1602, 0x00c2},\n\t{0x1603, 0x5383},\n\t{0x1604, 0x0000},\n\t{0x1605, 0x02c1},\n\t{0x1606, 0x007d},\n\t{0x1607, 0xa178},\n\t{0x1608, 0x00c2},\n\t{0x1609, 0x5383},\n\t{0x160a, 0x003e},\n\t{0x160b, 0xd37d},\n\t{0x1611, 0x3210},\n\t{0x1612, 0x7418},\n\t{0x1613, 0xc0ff},\n\t{0x1614, 0x0000},\n\t{0x1615, 0x00ff},\n\t{0x1616, 0x0000},\n\t{0x1617, 0x0000},\n\t{0x1621, 0x6210},\n\t{0x1622, 0x7418},\n\t{0x1623, 0xc0ff},\n\t{0x1624, 0x0000},\n\t{0x1625, 0x00ff},\n\t{0x1626, 0x0000},\n\t{0x1627, 0x0000},\n\t{0x1631, 0x3a14},\n\t{0x1632, 0x7418},\n\t{0x1633, 0xc3ff},\n\t{0x1634, 0x0000},\n\t{0x1635, 0x00ff},\n\t{0x1636, 0x0000},\n\t{0x1637, 0x0000},\n\t{0x1638, 0x0000},\n\t{0x163a, 0x0000},\n\t{0x163c, 0x0000},\n\t{0x163e, 0x0000},\n\t{0x1640, 0x0000},\n\t{0x1642, 0x0000},\n\t{0x1644, 0x0000},\n\t{0x1646, 0x0000},\n\t{0x1648, 0x0000},\n\t{0x1650, 0x0000},\n\t{0x1652, 0x0000},\n\t{0x1654, 0x0000},\n\t{0x1656, 0x0000},\n\t{0x1658, 0x0000},\n\t{0x1660, 0x0000},\n\t{0x1662, 0x0000},\n\t{0x1664, 0x0000},\n\t{0x1666, 0x0000},\n\t{0x1668, 0x0000},\n\t{0x1670, 0x0000},\n\t{0x1672, 0x0000},\n\t{0x1674, 0x0000},\n\t{0x1676, 0x0000},\n\t{0x1678, 0x0000},\n\t{0x1680, 0x0000},\n\t{0x1682, 0x0000},\n\t{0x1684, 0x0000},\n\t{0x1686, 0x0000},\n\t{0x1688, 0x0000},\n\t{0x1690, 0x0000},\n\t{0x1692, 0x0000},\n\t{0x1694, 0x0000},\n\t{0x1696, 0x0000},\n\t{0x1698, 0x0000},\n\t{0x1700, 0x0000},\n\t{0x1702, 0x0000},\n\t{0x1704, 0x0000},\n\t{0x1706, 0x0000},\n\t{0x1708, 0x0000},\n\t{0x1710, 0x0000},\n\t{0x1712, 0x0000},\n\t{0x1714, 0x0000},\n\t{0x1716, 0x0000},\n\t{0x1718, 0x0000},\n\t{0x1720, 0x0000},\n\t{0x1722, 0x0000},\n\t{0x1724, 0x0000},\n\t{0x1726, 0x0000},\n\t{0x1728, 0x0000},\n\t{0x1730, 0x0000},\n\t{0x1732, 0x0000},\n\t{0x1734, 0x0000},\n\t{0x1736, 0x0000},\n\t{0x1738, 0x0000},\n\t{0x173a, 0x0000},\n\t{0x173c, 0x0000},\n\t{0x173e, 0x0000},\n\t{0x17bb, 0x0500},\n\t{0x17bd, 0x0004},\n\t{0x17bf, 0x0004},\n\t{0x17c1, 0x0004},\n\t{0x17c2, 0x7fff},\n\t{0x17c3, 0x0000},\n\t{0x17c5, 0x0000},\n\t{0x17c7, 0x0000},\n\t{0x17c9, 0x0000},\n\t{0x17cb, 0x2010},\n\t{0x17cd, 0x0000},\n\t{0x17cf, 0x0000},\n\t{0x17d1, 0x0000},\n\t{0x17d3, 0x0000},\n\t{0x17d5, 0x0000},\n\t{0x17d7, 0x0000},\n\t{0x17d9, 0x0000},\n\t{0x17db, 0x0000},\n\t{0x17dd, 0x0000},\n\t{0x17df, 0x0000},\n\t{0x17e1, 0x0000},\n\t{0x17e3, 0x0000},\n\t{0x17e5, 0x0000},\n\t{0x17e7, 0x0000},\n\t{0x17e9, 0x0000},\n\t{0x17eb, 0x0000},\n\t{0x17ed, 0x0000},\n\t{0x17ef, 0x0000},\n\t{0x17f1, 0x0000},\n\t{0x17f3, 0x0000},\n\t{0x17f5, 0x0000},\n\t{0x17f7, 0x0000},\n\t{0x17f9, 0x0000},\n\t{0x17fb, 0x0000},\n\t{0x17fd, 0x0000},\n\t{0x17ff, 0x0000},\n\t{0x1801, 0x0000},\n\t{0x1803, 0x0000},\n};\n\nstatic int rt1011_reg_init(struct snd_soc_component *component)\n{\n\tstruct rt1011_priv *rt1011 = snd_soc_component_get_drvdata(component);\n\n\tregmap_multi_reg_write(rt1011->regmap,\n\t\tinit_list, ARRAY_SIZE(init_list));\n\treturn 0;\n}\n\nstatic bool rt1011_volatile_register(struct device *dev, unsigned int reg)\n{\n\tswitch (reg) {\n\tcase RT1011_RESET:\n\tcase RT1011_SRC_2:\n\tcase RT1011_CLK_DET:\n\tcase RT1011_SIL_DET:\n\tcase RT1011_VERSION_ID:\n\tcase RT1011_VENDOR_ID:\n\tcase RT1011_DEVICE_ID:\n\tcase RT1011_DUM_RO:\n\tcase RT1011_DAC_SET_3:\n\tcase RT1011_PWM_CAL:\n\tcase RT1011_SPK_VOL_TEST_OUT:\n\tcase RT1011_VBAT_VOL_DET_1:\n\tcase RT1011_VBAT_TEST_OUT_1:\n\tcase RT1011_VBAT_TEST_OUT_2:\n\tcase RT1011_VBAT_PROTECTION:\n\tcase RT1011_VBAT_DET:\n\tcase RT1011_BOOST_CON_1:\n\tcase RT1011_SHORT_CIRCUIT_DET_1:\n\tcase RT1011_SPK_TEMP_PROTECT_3:\n\tcase RT1011_SPK_TEMP_PROTECT_6:\n\tcase RT1011_SPK_PRO_DC_DET_3:\n\tcase RT1011_SPK_PRO_DC_DET_7:\n\tcase RT1011_SPK_PRO_DC_DET_8:\n\tcase RT1011_SPL_1:\n\tcase RT1011_SPL_4:\n\tcase RT1011_EXCUR_PROTECT_1:\n\tcase RT1011_CROSS_BQ_SET_1:\n\tcase RT1011_CROSS_BQ_SET_2:\n\tcase RT1011_BQ_SET_0:\n\tcase RT1011_BQ_SET_1:\n\tcase RT1011_BQ_SET_2:\n\tcase RT1011_TEST_PAD_STATUS:\n\tcase RT1011_DC_CALIB_CLASSD_1:\n\tcase RT1011_DC_CALIB_CLASSD_5:\n\tcase RT1011_DC_CALIB_CLASSD_6:\n\tcase RT1011_DC_CALIB_CLASSD_7:\n\tcase RT1011_DC_CALIB_CLASSD_8:\n\tcase RT1011_SINE_GEN_REG_2:\n\tcase RT1011_STP_CALIB_RS_TEMP:\n\tcase RT1011_SPK_RESISTANCE_1:\n\tcase RT1011_SPK_RESISTANCE_2:\n\tcase RT1011_SPK_THERMAL:\n\tcase RT1011_ALC_BK_GAIN_O:\n\tcase RT1011_ALC_BK_GAIN_O_PRE:\n\tcase RT1011_SPK_DC_O_23_16:\n\tcase RT1011_SPK_DC_O_15_0:\n\tcase RT1011_INIT_RECIPROCAL_SYN_24_16:\n\tcase RT1011_INIT_RECIPROCAL_SYN_15_0:\n\tcase RT1011_SPK_EXCURSION_23_16:\n\tcase RT1011_SPK_EXCURSION_15_0:\n\tcase RT1011_SEP_MAIN_OUT_23_16:\n\tcase RT1011_SEP_MAIN_OUT_15_0:\n\tcase RT1011_ALC_DRC_HB_INTERNAL_5:\n\tcase RT1011_ALC_DRC_HB_INTERNAL_6:\n\tcase RT1011_ALC_DRC_HB_INTERNAL_7:\n\tcase RT1011_ALC_DRC_BB_INTERNAL_5:\n\tcase RT1011_ALC_DRC_BB_INTERNAL_6:\n\tcase RT1011_ALC_DRC_BB_INTERNAL_7:\n\tcase RT1011_ALC_DRC_POS_INTERNAL_5:\n\tcase RT1011_ALC_DRC_POS_INTERNAL_6:\n\tcase RT1011_ALC_DRC_POS_INTERNAL_7:\n\tcase RT1011_ALC_DRC_POS_INTERNAL_8:\n\tcase RT1011_ALC_DRC_POS_INTERNAL_9:\n\tcase RT1011_ALC_DRC_POS_INTERNAL_10:\n\tcase RT1011_ALC_DRC_POS_INTERNAL_11:\n\tcase RT1011_IRQ_1:\n\tcase RT1011_EFUSE_CONTROL_1:\n\tcase RT1011_EFUSE_CONTROL_2:\n\tcase RT1011_EFUSE_MATCH_DONE ... RT1011_EFUSE_READ_R0_3_15_0:\n\t\treturn true;\n\n\tdefault:\n\t\treturn false;\n\t}\n}\n\nstatic bool rt1011_readable_register(struct device *dev, unsigned int reg)\n{\n\tswitch (reg) {\n\tcase RT1011_RESET:\n\tcase RT1011_CLK_1:\n\tcase RT1011_CLK_2:\n\tcase RT1011_CLK_3:\n\tcase RT1011_CLK_4:\n\tcase RT1011_PLL_1:\n\tcase RT1011_PLL_2:\n\tcase RT1011_SRC_1:\n\tcase RT1011_SRC_2:\n\tcase RT1011_SRC_3:\n\tcase RT1011_CLK_DET:\n\tcase RT1011_SIL_DET:\n\tcase RT1011_PRIV_INDEX:\n\tcase RT1011_PRIV_DATA:\n\tcase RT1011_CUSTOMER_ID:\n\tcase RT1011_FM_VER:\n\tcase RT1011_VERSION_ID:\n\tcase RT1011_VENDOR_ID:\n\tcase RT1011_DEVICE_ID:\n\tcase RT1011_DUM_RW_0:\n\tcase RT1011_DUM_YUN:\n\tcase RT1011_DUM_RW_1:\n\tcase RT1011_DUM_RO:\n\tcase RT1011_MAN_I2C_DEV:\n\tcase RT1011_DAC_SET_1:\n\tcase RT1011_DAC_SET_2:\n\tcase RT1011_DAC_SET_3:\n\tcase RT1011_ADC_SET:\n\tcase RT1011_ADC_SET_1:\n\tcase RT1011_ADC_SET_2:\n\tcase RT1011_ADC_SET_3:\n\tcase RT1011_ADC_SET_4:\n\tcase RT1011_ADC_SET_5:\n\tcase RT1011_TDM_TOTAL_SET:\n\tcase RT1011_TDM1_SET_TCON:\n\tcase RT1011_TDM1_SET_1:\n\tcase RT1011_TDM1_SET_2:\n\tcase RT1011_TDM1_SET_3:\n\tcase RT1011_TDM1_SET_4:\n\tcase RT1011_TDM1_SET_5:\n\tcase RT1011_TDM2_SET_1:\n\tcase RT1011_TDM2_SET_2:\n\tcase RT1011_TDM2_SET_3:\n\tcase RT1011_TDM2_SET_4:\n\tcase RT1011_TDM2_SET_5:\n\tcase RT1011_PWM_CAL:\n\tcase RT1011_MIXER_1:\n\tcase RT1011_MIXER_2:\n\tcase RT1011_ADRC_LIMIT:\n\tcase RT1011_A_PRO:\n\tcase RT1011_A_TIMING_1:\n\tcase RT1011_A_TIMING_2:\n\tcase RT1011_A_TEMP_SEN:\n\tcase RT1011_SPK_VOL_DET_1:\n\tcase RT1011_SPK_VOL_DET_2:\n\tcase RT1011_SPK_VOL_TEST_OUT:\n\tcase RT1011_VBAT_VOL_DET_1:\n\tcase RT1011_VBAT_VOL_DET_2:\n\tcase RT1011_VBAT_TEST_OUT_1:\n\tcase RT1011_VBAT_TEST_OUT_2:\n\tcase RT1011_VBAT_PROTECTION:\n\tcase RT1011_VBAT_DET:\n\tcase RT1011_POWER_1:\n\tcase RT1011_POWER_2:\n\tcase RT1011_POWER_3:\n\tcase RT1011_POWER_4:\n\tcase RT1011_POWER_5:\n\tcase RT1011_POWER_6:\n\tcase RT1011_POWER_7:\n\tcase RT1011_POWER_8:\n\tcase RT1011_POWER_9:\n\tcase RT1011_CLASS_D_POS:\n\tcase RT1011_BOOST_CON_1:\n\tcase RT1011_BOOST_CON_2:\n\tcase RT1011_ANALOG_CTRL:\n\tcase RT1011_POWER_SEQ:\n\tcase RT1011_SHORT_CIRCUIT_DET_1:\n\tcase RT1011_SHORT_CIRCUIT_DET_2:\n\tcase RT1011_SPK_TEMP_PROTECT_0:\n\tcase RT1011_SPK_TEMP_PROTECT_1:\n\tcase RT1011_SPK_TEMP_PROTECT_2:\n\tcase RT1011_SPK_TEMP_PROTECT_3:\n\tcase RT1011_SPK_TEMP_PROTECT_4:\n\tcase RT1011_SPK_TEMP_PROTECT_5:\n\tcase RT1011_SPK_TEMP_PROTECT_6:\n\tcase RT1011_SPK_TEMP_PROTECT_7:\n\tcase RT1011_SPK_TEMP_PROTECT_8:\n\tcase RT1011_SPK_TEMP_PROTECT_9:\n\tcase RT1011_SPK_PRO_DC_DET_1:\n\tcase RT1011_SPK_PRO_DC_DET_2:\n\tcase RT1011_SPK_PRO_DC_DET_3:\n\tcase RT1011_SPK_PRO_DC_DET_4:\n\tcase RT1011_SPK_PRO_DC_DET_5:\n\tcase RT1011_SPK_PRO_DC_DET_6:\n\tcase RT1011_SPK_PRO_DC_DET_7:\n\tcase RT1011_SPK_PRO_DC_DET_8:\n\tcase RT1011_SPL_1:\n\tcase RT1011_SPL_2:\n\tcase RT1011_SPL_3:\n\tcase RT1011_SPL_4:\n\tcase RT1011_THER_FOLD_BACK_1:\n\tcase RT1011_THER_FOLD_BACK_2:\n\tcase RT1011_EXCUR_PROTECT_1:\n\tcase RT1011_EXCUR_PROTECT_2:\n\tcase RT1011_EXCUR_PROTECT_3:\n\tcase RT1011_EXCUR_PROTECT_4:\n\tcase RT1011_BAT_GAIN_1:\n\tcase RT1011_BAT_GAIN_2:\n\tcase RT1011_BAT_GAIN_3:\n\tcase RT1011_BAT_GAIN_4:\n\tcase RT1011_BAT_GAIN_5:\n\tcase RT1011_BAT_GAIN_6:\n\tcase RT1011_BAT_GAIN_7:\n\tcase RT1011_BAT_GAIN_8:\n\tcase RT1011_BAT_GAIN_9:\n\tcase RT1011_BAT_GAIN_10:\n\tcase RT1011_BAT_GAIN_11:\n\tcase RT1011_BAT_RT_THMAX_1:\n\tcase RT1011_BAT_RT_THMAX_2:\n\tcase RT1011_BAT_RT_THMAX_3:\n\tcase RT1011_BAT_RT_THMAX_4:\n\tcase RT1011_BAT_RT_THMAX_5:\n\tcase RT1011_BAT_RT_THMAX_6:\n\tcase RT1011_BAT_RT_THMAX_7:\n\tcase RT1011_BAT_RT_THMAX_8:\n\tcase RT1011_BAT_RT_THMAX_9:\n\tcase RT1011_BAT_RT_THMAX_10:\n\tcase RT1011_BAT_RT_THMAX_11:\n\tcase RT1011_BAT_RT_THMAX_12:\n\tcase RT1011_SPREAD_SPECTURM:\n\tcase RT1011_PRO_GAIN_MODE:\n\tcase RT1011_RT_DRC_CROSS:\n\tcase RT1011_RT_DRC_HB_1:\n\tcase RT1011_RT_DRC_HB_2:\n\tcase RT1011_RT_DRC_HB_3:\n\tcase RT1011_RT_DRC_HB_4:\n\tcase RT1011_RT_DRC_HB_5:\n\tcase RT1011_RT_DRC_HB_6:\n\tcase RT1011_RT_DRC_HB_7:\n\tcase RT1011_RT_DRC_HB_8:\n\tcase RT1011_RT_DRC_BB_1:\n\tcase RT1011_RT_DRC_BB_2:\n\tcase RT1011_RT_DRC_BB_3:\n\tcase RT1011_RT_DRC_BB_4:\n\tcase RT1011_RT_DRC_BB_5:\n\tcase RT1011_RT_DRC_BB_6:\n\tcase RT1011_RT_DRC_BB_7:\n\tcase RT1011_RT_DRC_BB_8:\n\tcase RT1011_RT_DRC_POS_1:\n\tcase RT1011_RT_DRC_POS_2:\n\tcase RT1011_RT_DRC_POS_3:\n\tcase RT1011_RT_DRC_POS_4:\n\tcase RT1011_RT_DRC_POS_5:\n\tcase RT1011_RT_DRC_POS_6:\n\tcase RT1011_RT_DRC_POS_7:\n\tcase RT1011_RT_DRC_POS_8:\n\tcase RT1011_CROSS_BQ_SET_1:\n\tcase RT1011_CROSS_BQ_SET_2:\n\tcase RT1011_BQ_SET_0:\n\tcase RT1011_BQ_SET_1:\n\tcase RT1011_BQ_SET_2:\n\tcase RT1011_BQ_PRE_GAIN_28_16:\n\tcase RT1011_BQ_PRE_GAIN_15_0:\n\tcase RT1011_BQ_POST_GAIN_28_16:\n\tcase RT1011_BQ_POST_GAIN_15_0:\n\tcase RT1011_BQ_H0_28_16 ... RT1011_BQ_A2_15_0:\n\tcase RT1011_BQ_1_H0_28_16 ... RT1011_BQ_1_A2_15_0:\n\tcase RT1011_BQ_2_H0_28_16 ... RT1011_BQ_2_A2_15_0:\n\tcase RT1011_BQ_3_H0_28_16 ... RT1011_BQ_3_A2_15_0:\n\tcase RT1011_BQ_4_H0_28_16 ... RT1011_BQ_4_A2_15_0:\n\tcase RT1011_BQ_5_H0_28_16 ... RT1011_BQ_5_A2_15_0:\n\tcase RT1011_BQ_6_H0_28_16 ... RT1011_BQ_6_A2_15_0:\n\tcase RT1011_BQ_7_H0_28_16 ... RT1011_BQ_7_A2_15_0:\n\tcase RT1011_BQ_8_H0_28_16 ... RT1011_BQ_8_A2_15_0:\n\tcase RT1011_BQ_9_H0_28_16 ... RT1011_BQ_9_A2_15_0:\n\tcase RT1011_BQ_10_H0_28_16 ... RT1011_BQ_10_A2_15_0:\n\tcase RT1011_TEST_PAD_STATUS ... RT1011_PLL_INTERNAL_SET:\n\tcase RT1011_TEST_OUT_1 ... RT1011_TEST_OUT_3:\n\tcase RT1011_DC_CALIB_CLASSD_1 ... RT1011_DC_CALIB_CLASSD_10:\n\tcase RT1011_CLASSD_INTERNAL_SET_1 ... RT1011_VREF_LV_1:\n\tcase RT1011_SMART_BOOST_TIMING_1 ... RT1011_SMART_BOOST_TIMING_36:\n\tcase RT1011_SINE_GEN_REG_1 ... RT1011_SINE_GEN_REG_3:\n\tcase RT1011_STP_INITIAL_RS_TEMP ... RT1011_SPK_THERMAL:\n\tcase RT1011_STP_OTP_TH ... RT1011_INIT_RECIPROCAL_SYN_15_0:\n\tcase RT1011_STP_BQ_1_A1_L_28_16 ... RT1011_STP_BQ_1_H0_R_15_0:\n\tcase RT1011_STP_BQ_2_A1_L_28_16 ... RT1011_SEP_RE_REG_15_0:\n\tcase RT1011_DRC_CF_PARAMS_1 ... RT1011_DRC_CF_PARAMS_12:\n\tcase RT1011_ALC_DRC_HB_INTERNAL_1 ... RT1011_ALC_DRC_HB_INTERNAL_7:\n\tcase RT1011_ALC_DRC_BB_INTERNAL_1 ... RT1011_ALC_DRC_BB_INTERNAL_7:\n\tcase RT1011_ALC_DRC_POS_INTERNAL_1 ... RT1011_ALC_DRC_POS_INTERNAL_8:\n\tcase RT1011_ALC_DRC_POS_INTERNAL_9 ... RT1011_BQ_1_PARAMS_CHECK_5:\n\tcase RT1011_BQ_2_PARAMS_CHECK_1 ... RT1011_BQ_2_PARAMS_CHECK_5:\n\tcase RT1011_BQ_3_PARAMS_CHECK_1 ... RT1011_BQ_3_PARAMS_CHECK_5:\n\tcase RT1011_BQ_4_PARAMS_CHECK_1 ... RT1011_BQ_4_PARAMS_CHECK_5:\n\tcase RT1011_BQ_5_PARAMS_CHECK_1 ... RT1011_BQ_5_PARAMS_CHECK_5:\n\tcase RT1011_BQ_6_PARAMS_CHECK_1 ... RT1011_BQ_6_PARAMS_CHECK_5:\n\tcase RT1011_BQ_7_PARAMS_CHECK_1 ... RT1011_BQ_7_PARAMS_CHECK_5:\n\tcase RT1011_BQ_8_PARAMS_CHECK_1 ... RT1011_BQ_8_PARAMS_CHECK_5:\n\tcase RT1011_BQ_9_PARAMS_CHECK_1 ... RT1011_BQ_9_PARAMS_CHECK_5:\n\tcase RT1011_BQ_10_PARAMS_CHECK_1 ... RT1011_BQ_10_PARAMS_CHECK_5:\n\tcase RT1011_IRQ_1 ... RT1011_PART_NUMBER_EFUSE:\n\tcase RT1011_EFUSE_CONTROL_1 ... RT1011_EFUSE_READ_R0_3_15_0:\n\t\treturn true;\n\tdefault:\n\t\treturn false;\n\t}\n}\n\nstatic const char * const rt1011_din_source_select[] = {\n\t\"Left\",\n\t\"Right\",\n\t\"Left + Right average\",\n};\n\nstatic SOC_ENUM_SINGLE_DECL(rt1011_din_source_enum, RT1011_CROSS_BQ_SET_1, 5,\n\trt1011_din_source_select);\n\nstatic const char * const rt1011_tdm_data_out_select[] = {\n\t\"TDM_O_LR\", \"BQ1\", \"DVOL\", \"BQ10\", \"ALC\", \"DMIX\", \"ADC_SRC_LR\",\n\t\"ADC_O_LR\", \"ADC_MONO\", \"RSPK_BPF_LR\", \"DMIX_ADD\", \"ENVELOPE_FS\",\n\t\"SEP_O_GAIN\", \"ALC_BK_GAIN\", \"STP_V_C\", \"DMIX_ABST\"\n};\n\nstatic const char * const rt1011_tdm_l_ch_data_select[] = {\n\t\"Slot0\", \"Slot1\", \"Slot2\", \"Slot3\", \"Slot4\", \"Slot5\", \"Slot6\", \"Slot7\"\n};\nstatic SOC_ENUM_SINGLE_DECL(rt1011_tdm1_l_dac1_enum, RT1011_TDM1_SET_4, 12,\n\trt1011_tdm_l_ch_data_select);\nstatic SOC_ENUM_SINGLE_DECL(rt1011_tdm2_l_dac1_enum, RT1011_TDM2_SET_4, 12,\n\trt1011_tdm_l_ch_data_select);\n\nstatic SOC_ENUM_SINGLE_DECL(rt1011_tdm1_adc1_dat_enum,\n\tRT1011_ADCDAT_OUT_SOURCE, 0, rt1011_tdm_data_out_select);\nstatic SOC_ENUM_SINGLE_DECL(rt1011_tdm1_adc1_loc_enum, RT1011_TDM1_SET_2, 0,\n\trt1011_tdm_l_ch_data_select);\n\nstatic const char * const rt1011_adc_data_mode_select[] = {\n\t\"Stereo\", \"Mono\"\n};\nstatic SOC_ENUM_SINGLE_DECL(rt1011_adc_dout_mode_enum, RT1011_TDM1_SET_1, 12,\n\trt1011_adc_data_mode_select);\n\nstatic const char * const rt1011_tdm_adc_data_len_control[] = {\n\t\"1CH\", \"2CH\", \"3CH\", \"4CH\", \"5CH\", \"6CH\", \"7CH\", \"8CH\"\n};\nstatic SOC_ENUM_SINGLE_DECL(rt1011_tdm1_dout_len_enum, RT1011_TDM1_SET_2, 13,\n\trt1011_tdm_adc_data_len_control);\nstatic SOC_ENUM_SINGLE_DECL(rt1011_tdm2_dout_len_enum, RT1011_TDM2_SET_2, 13,\n\trt1011_tdm_adc_data_len_control);\n\nstatic const char * const rt1011_tdm_adc_swap_select[] = {\n\t\"L/R\", \"R/L\", \"L/L\", \"R/R\"\n};\n\nstatic SOC_ENUM_SINGLE_DECL(rt1011_tdm_adc1_1_enum, RT1011_TDM1_SET_3, 6,\n\trt1011_tdm_adc_swap_select);\nstatic SOC_ENUM_SINGLE_DECL(rt1011_tdm_adc2_1_enum, RT1011_TDM1_SET_3, 4,\n\trt1011_tdm_adc_swap_select);\n\nstatic void rt1011_reset(struct regmap *regmap)\n{\n\tregmap_write(regmap, RT1011_RESET, 0);\n}\n\nstatic int rt1011_recv_spk_mode_get(struct snd_kcontrol *kcontrol,\n\t\tstruct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_soc_component *component =\n\t\tsnd_soc_kcontrol_component(kcontrol);\n\tstruct rt1011_priv *rt1011 =\n\t\tsnd_soc_component_get_drvdata(component);\n\n\tucontrol->value.integer.value[0] = rt1011->recv_spk_mode;\n\n\treturn 0;\n}\n\nstatic int rt1011_recv_spk_mode_put(struct snd_kcontrol *kcontrol,\n\t\tstruct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_soc_component *component =\n\t\tsnd_soc_kcontrol_component(kcontrol);\n\tstruct rt1011_priv *rt1011 =\n\t\tsnd_soc_component_get_drvdata(component);\n\n\tif (ucontrol->value.integer.value[0] == rt1011->recv_spk_mode)\n\t\treturn 0;\n\n\tif (snd_soc_component_get_bias_level(component) == SND_SOC_BIAS_OFF) {\n\t\trt1011->recv_spk_mode = ucontrol->value.integer.value[0];\n\n\t\tif (rt1011->recv_spk_mode) {\n\n\t\t\t \n\t\t\tsnd_soc_component_update_bits(component,\n\t\t\t\tRT1011_CLASSD_INTERNAL_SET_3,\n\t\t\t\tRT1011_REG_GAIN_CLASSD_RI_SPK_MASK,\n\t\t\t\tRT1011_REG_GAIN_CLASSD_RI_410K);\n\t\t\tsnd_soc_component_update_bits(component,\n\t\t\t\tRT1011_CLASSD_INTERNAL_SET_1,\n\t\t\t\tRT1011_RECV_MODE_SPK_MASK,\n\t\t\t\tRT1011_RECV_MODE);\n\t\t} else {\n\t\t\t \n\t\t\tsnd_soc_component_update_bits(component,\n\t\t\t\tRT1011_CLASSD_INTERNAL_SET_3,\n\t\t\t\tRT1011_REG_GAIN_CLASSD_RI_SPK_MASK,\n\t\t\t\tRT1011_REG_GAIN_CLASSD_RI_72P5K);\n\t\t\tsnd_soc_component_update_bits(component,\n\t\t\t\tRT1011_CLASSD_INTERNAL_SET_1,\n\t\t\t\tRT1011_RECV_MODE_SPK_MASK,\n\t\t\t\tRT1011_SPK_MODE);\n\t\t}\n\t}\n\n\treturn 0;\n}\n\nstatic bool rt1011_validate_bq_drc_coeff(unsigned short reg)\n{\n\tif ((reg == RT1011_DAC_SET_1) ||\n\t\t(reg >= RT1011_ADC_SET && reg <= RT1011_ADC_SET_1) ||\n\t\t(reg == RT1011_ADC_SET_4) || (reg == RT1011_ADC_SET_5) ||\n\t\t(reg == RT1011_MIXER_1) ||\n\t\t(reg == RT1011_A_TIMING_1) ||\n\t\t(reg >= RT1011_POWER_7 && reg <= RT1011_POWER_8) ||\n\t\t(reg == RT1011_CLASS_D_POS) || (reg == RT1011_ANALOG_CTRL) ||\n\t\t(reg >= RT1011_SPK_TEMP_PROTECT_0 && reg <= RT1011_SPK_TEMP_PROTECT_6) ||\n\t\t(reg >= RT1011_SPK_PRO_DC_DET_5 && reg <= RT1011_BAT_GAIN_1) ||\n\t\t(reg >= RT1011_RT_DRC_CROSS && reg <= RT1011_RT_DRC_POS_8) ||\n\t\t(reg >= RT1011_CROSS_BQ_SET_1 && reg <= RT1011_BQ_10_A2_15_0) ||\n\t\t(reg >= RT1011_SMART_BOOST_TIMING_1 && reg <= RT1011_SMART_BOOST_TIMING_36) ||\n\t\t(reg == RT1011_SINE_GEN_REG_1) ||\n\t\t(reg >= RT1011_STP_ALPHA_RECIPROCAL_MSB && reg <= RT1011_BQ_6_PARAMS_CHECK_5) ||\n\t\t(reg >= RT1011_BQ_7_PARAMS_CHECK_1 && reg <= RT1011_BQ_10_PARAMS_CHECK_5))\n\t\treturn true;\n\n\treturn false;\n}\n\nstatic int rt1011_bq_drc_coeff_get(struct snd_kcontrol *kcontrol,\n\t\t\t\t\tstruct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_soc_component *component =\n\t\tsnd_soc_kcontrol_component(kcontrol);\n\tstruct rt1011_priv *rt1011 =\n\t\tsnd_soc_component_get_drvdata(component);\n\tstruct rt1011_bq_drc_params *bq_drc_info;\n\tstruct rt1011_bq_drc_params *params =\n\t\t(struct rt1011_bq_drc_params *)ucontrol->value.integer.value;\n\tunsigned int i, mode_idx = 0;\n\n\tif (strstr(ucontrol->id.name, \"AdvanceMode Initial Set\"))\n\t\tmode_idx = RT1011_ADVMODE_INITIAL_SET;\n\telse if (strstr(ucontrol->id.name, \"AdvanceMode SEP BQ Coeff\"))\n\t\tmode_idx = RT1011_ADVMODE_SEP_BQ_COEFF;\n\telse if (strstr(ucontrol->id.name, \"AdvanceMode EQ BQ Coeff\"))\n\t\tmode_idx = RT1011_ADVMODE_EQ_BQ_COEFF;\n\telse if (strstr(ucontrol->id.name, \"AdvanceMode BQ UI Coeff\"))\n\t\tmode_idx = RT1011_ADVMODE_BQ_UI_COEFF;\n\telse if (strstr(ucontrol->id.name, \"AdvanceMode SmartBoost Coeff\"))\n\t\tmode_idx = RT1011_ADVMODE_SMARTBOOST_COEFF;\n\telse\n\t\treturn -EINVAL;\n\n\tpr_info(\"%s, id.name=%s, mode_idx=%d\\n\", __func__,\n\t\tucontrol->id.name, mode_idx);\n\tbq_drc_info = rt1011->bq_drc_params[mode_idx];\n\n\tfor (i = 0; i < RT1011_BQ_DRC_NUM; i++) {\n\t\tparams[i].reg = bq_drc_info[i].reg;\n\t\tparams[i].val = bq_drc_info[i].val;\n\t}\n\n\treturn 0;\n}\n\nstatic int rt1011_bq_drc_coeff_put(struct snd_kcontrol *kcontrol,\n\t\t\t\t\tstruct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_soc_component *component =\n\t\tsnd_soc_kcontrol_component(kcontrol);\n\tstruct rt1011_priv *rt1011 =\n\t\tsnd_soc_component_get_drvdata(component);\n\tstruct rt1011_bq_drc_params *bq_drc_info;\n\tstruct rt1011_bq_drc_params *params =\n\t\t(struct rt1011_bq_drc_params *)ucontrol->value.integer.value;\n\tunsigned int i, mode_idx = 0;\n\n\tif (strstr(ucontrol->id.name, \"AdvanceMode Initial Set\"))\n\t\tmode_idx = RT1011_ADVMODE_INITIAL_SET;\n\telse if (strstr(ucontrol->id.name, \"AdvanceMode SEP BQ Coeff\"))\n\t\tmode_idx = RT1011_ADVMODE_SEP_BQ_COEFF;\n\telse if (strstr(ucontrol->id.name, \"AdvanceMode EQ BQ Coeff\"))\n\t\tmode_idx = RT1011_ADVMODE_EQ_BQ_COEFF;\n\telse if (strstr(ucontrol->id.name, \"AdvanceMode BQ UI Coeff\"))\n\t\tmode_idx = RT1011_ADVMODE_BQ_UI_COEFF;\n\telse if (strstr(ucontrol->id.name, \"AdvanceMode SmartBoost Coeff\"))\n\t\tmode_idx = RT1011_ADVMODE_SMARTBOOST_COEFF;\n\telse\n\t\treturn -EINVAL;\n\n\tbq_drc_info = rt1011->bq_drc_params[mode_idx];\n\tmemset(bq_drc_info, 0,\n\t\tsizeof(struct rt1011_bq_drc_params) * RT1011_BQ_DRC_NUM);\n\n\tpr_info(\"%s, id.name=%s, mode_idx=%d\\n\", __func__,\n\t\tucontrol->id.name, mode_idx);\n\tfor (i = 0; i < RT1011_BQ_DRC_NUM; i++) {\n\t\tbq_drc_info[i].reg = params[i].reg;\n\t\tbq_drc_info[i].val = params[i].val;\n\t}\n\n\tfor (i = 0; i < RT1011_BQ_DRC_NUM; i++) {\n\t\tif (bq_drc_info[i].reg == 0)\n\t\t\tbreak;\n\t\telse if (rt1011_validate_bq_drc_coeff(bq_drc_info[i].reg)) {\n\t\t\tsnd_soc_component_write(component, bq_drc_info[i].reg,\n\t\t\t\t\tbq_drc_info[i].val);\n\t\t}\n\t}\n\n\treturn 0;\n}\n\nstatic int rt1011_bq_drc_info(struct snd_kcontrol *kcontrol,\n\t\t\t struct snd_ctl_elem_info *uinfo)\n{\n\tuinfo->type = SNDRV_CTL_ELEM_TYPE_INTEGER;\n\tuinfo->count = 128;\n\tuinfo->value.integer.max = 0x17ffffff;\n\n\treturn 0;\n}\n\n#define RT1011_BQ_DRC(xname) \\\n{\t.iface = SNDRV_CTL_ELEM_IFACE_MIXER, .name = xname, \\\n\t.info = rt1011_bq_drc_info, \\\n\t.get = rt1011_bq_drc_coeff_get, \\\n\t.put = rt1011_bq_drc_coeff_put \\\n}\n\nstatic int rt1011_r0_cali_get(struct snd_kcontrol *kcontrol,\n\t\tstruct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_soc_component *component = snd_kcontrol_chip(kcontrol);\n\tstruct rt1011_priv *rt1011 = snd_soc_component_get_drvdata(component);\n\n\tucontrol->value.integer.value[0] = rt1011->cali_done;\n\n\treturn 0;\n}\n\nstatic int rt1011_r0_cali_put(struct snd_kcontrol *kcontrol,\n\t\tstruct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_soc_component *component = snd_kcontrol_chip(kcontrol);\n\tstruct rt1011_priv *rt1011 = snd_soc_component_get_drvdata(component);\n\n\trt1011->cali_done = 0;\n\tif (snd_soc_component_get_bias_level(component) == SND_SOC_BIAS_OFF &&\n\t\tucontrol->value.integer.value[0])\n\t\trt1011_calibrate(rt1011, 1);\n\n\treturn 0;\n}\n\nstatic int rt1011_r0_load(struct rt1011_priv *rt1011)\n{\n\tif (!rt1011->r0_reg)\n\t\treturn -EINVAL;\n\n\t \n\tregmap_write(rt1011->regmap, RT1011_INIT_RECIPROCAL_REG_24_16,\n\t\t((rt1011->r0_reg>>16) & 0x1ff));\n\tregmap_write(rt1011->regmap, RT1011_INIT_RECIPROCAL_REG_15_0,\n\t\t(rt1011->r0_reg & 0xffff));\n\tregmap_write(rt1011->regmap, RT1011_SPK_TEMP_PROTECT_4, 0x4080);\n\n\treturn 0;\n}\n\nstatic int rt1011_r0_load_mode_get(struct snd_kcontrol *kcontrol,\n\t\tstruct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_soc_component *component = snd_kcontrol_chip(kcontrol);\n\tstruct rt1011_priv *rt1011 = snd_soc_component_get_drvdata(component);\n\n\tucontrol->value.integer.value[0] = rt1011->r0_reg;\n\n\treturn 0;\n}\n\nstatic int rt1011_r0_load_mode_put(struct snd_kcontrol *kcontrol,\n\t\tstruct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_soc_component *component = snd_kcontrol_chip(kcontrol);\n\tstruct rt1011_priv *rt1011 = snd_soc_component_get_drvdata(component);\n\tstruct device *dev;\n\tunsigned int r0_integer, r0_factor, format;\n\n\tif (ucontrol->value.integer.value[0] == rt1011->r0_reg)\n\t\treturn 0;\n\n\tif (ucontrol->value.integer.value[0] == 0)\n\t\treturn -EINVAL;\n\n\tdev = regmap_get_device(rt1011->regmap);\n\tif (snd_soc_component_get_bias_level(component) == SND_SOC_BIAS_OFF) {\n\t\trt1011->r0_reg = ucontrol->value.integer.value[0];\n\n\t\tformat = 2147483648U;  \n\t\tr0_integer = format / rt1011->r0_reg / 128;\n\t\tr0_factor = ((format / rt1011->r0_reg * 100) / 128)\n\t\t\t\t\t\t- (r0_integer * 100);\n\t\tdev_info(dev, \"New r0 resistance about %d.%02d ohm, reg=0x%X\\n\",\n\t\t\tr0_integer, r0_factor, rt1011->r0_reg);\n\n\t\tif (rt1011->r0_reg)\n\t\t\trt1011_r0_load(rt1011);\n\t}\n\n\treturn 0;\n}\n\nstatic int rt1011_r0_load_info(struct snd_kcontrol *kcontrol,\n\t\t\t struct snd_ctl_elem_info *uinfo)\n{\n\tuinfo->type = SNDRV_CTL_ELEM_TYPE_INTEGER;\n\tuinfo->count = 1;\n\tuinfo->value.integer.max = 0x1ffffff;\n\n\treturn 0;\n}\n\n#define RT1011_R0_LOAD(xname) \\\n{\t.iface = SNDRV_CTL_ELEM_IFACE_MIXER, .name = xname, \\\n\t.info = rt1011_r0_load_info, \\\n\t.get = rt1011_r0_load_mode_get, \\\n\t.put = rt1011_r0_load_mode_put \\\n}\n\nstatic const char * const rt1011_i2s_ref[] = {\n\t\"None\", \"Left Channel\", \"Right Channel\"\n};\n\nstatic SOC_ENUM_SINGLE_DECL(rt1011_i2s_ref_enum, 0, 0,\n\trt1011_i2s_ref);\n\nstatic int rt1011_i2s_ref_put(struct snd_kcontrol *kcontrol,\n\t\tstruct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_soc_component *component =\n\t\tsnd_soc_kcontrol_component(kcontrol);\n\tstruct rt1011_priv *rt1011 =\n\t\tsnd_soc_component_get_drvdata(component);\n\n\trt1011->i2s_ref = ucontrol->value.enumerated.item[0];\n\tswitch (rt1011->i2s_ref) {\n\tcase RT1011_I2S_REF_LEFT_CH:\n\t\tregmap_write(rt1011->regmap, RT1011_TDM_TOTAL_SET, 0x0240);\n\t\tregmap_write(rt1011->regmap, RT1011_TDM1_SET_2, 0x8);\n\t\tregmap_write(rt1011->regmap, RT1011_TDM1_SET_1, 0x1022);\n\t\tregmap_write(rt1011->regmap, RT1011_ADCDAT_OUT_SOURCE, 0x4);\n\t\tbreak;\n\tcase RT1011_I2S_REF_RIGHT_CH:\n\t\tregmap_write(rt1011->regmap, RT1011_TDM_TOTAL_SET, 0x0240);\n\t\tregmap_write(rt1011->regmap, RT1011_TDM1_SET_2, 0x8);\n\t\tregmap_write(rt1011->regmap, RT1011_TDM1_SET_1, 0x10a2);\n\t\tregmap_write(rt1011->regmap, RT1011_ADCDAT_OUT_SOURCE, 0x4);\n\t\tbreak;\n\tdefault:\n\t\tdev_info(component->dev, \"I2S Reference: Do nothing\\n\");\n\t}\n\n\treturn 0;\n}\n\nstatic int rt1011_i2s_ref_get(struct snd_kcontrol *kcontrol,\n\t\tstruct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_soc_component *component =\n\t\tsnd_soc_kcontrol_component(kcontrol);\n\tstruct rt1011_priv *rt1011 =\n\t\tsnd_soc_component_get_drvdata(component);\n\n\tucontrol->value.enumerated.item[0] = rt1011->i2s_ref;\n\n\treturn 0;\n}\n\nstatic const struct snd_kcontrol_new rt1011_snd_controls[] = {\n\t \n\tSOC_ENUM(\"DIN Source\", rt1011_din_source_enum),\n\n\t \n\tSOC_ENUM(\"TDM1 DIN Source\", rt1011_tdm1_l_dac1_enum),\n\tSOC_ENUM(\"TDM2 DIN Source\", rt1011_tdm2_l_dac1_enum),\n\n\t \n\tSOC_ENUM(\"TDM1 DOUT Source\", rt1011_tdm1_adc1_dat_enum),\n\tSOC_ENUM(\"TDM1 DOUT Location\", rt1011_tdm1_adc1_loc_enum),\n\tSOC_ENUM(\"TDM1 ADC1DAT Swap Select\", rt1011_tdm_adc1_1_enum),\n\tSOC_ENUM(\"TDM1 ADC2DAT Swap Select\", rt1011_tdm_adc2_1_enum),\n\n\t \n\tSOC_ENUM(\"I2S ADC DOUT Mode\", rt1011_adc_dout_mode_enum),\n\tSOC_ENUM(\"TDM1 DOUT Length\", rt1011_tdm1_dout_len_enum),\n\tSOC_ENUM(\"TDM2 DOUT Length\", rt1011_tdm2_dout_len_enum),\n\n\t \n\tSOC_SINGLE_EXT(\"RECV SPK Mode\", SND_SOC_NOPM, 0, 1, 0,\n\t\trt1011_recv_spk_mode_get, rt1011_recv_spk_mode_put),\n\n\t \n\tRT1011_BQ_DRC(\"AdvanceMode Initial Set\"),\n\tRT1011_BQ_DRC(\"AdvanceMode SEP BQ Coeff\"),\n\tRT1011_BQ_DRC(\"AdvanceMode EQ BQ Coeff\"),\n\tRT1011_BQ_DRC(\"AdvanceMode BQ UI Coeff\"),\n\tRT1011_BQ_DRC(\"AdvanceMode SmartBoost Coeff\"),\n\n\t \n\tSOC_SINGLE_EXT(\"R0 Calibration\", SND_SOC_NOPM, 0, 1, 0,\n\t\trt1011_r0_cali_get, rt1011_r0_cali_put),\n\tRT1011_R0_LOAD(\"R0 Load Mode\"),\n\n\t \n\tSOC_SINGLE(\"R0 Temperature\", RT1011_STP_INITIAL_RESISTANCE_TEMP,\n\t\t2, 255, 0),\n\t \n\tSOC_ENUM_EXT(\"I2S Reference\", rt1011_i2s_ref_enum,\n\t\trt1011_i2s_ref_get, rt1011_i2s_ref_put),\n};\n\nstatic int rt1011_is_sys_clk_from_pll(struct snd_soc_dapm_widget *source,\n\t\t\t struct snd_soc_dapm_widget *sink)\n{\n\tstruct snd_soc_component *component =\n\t\tsnd_soc_dapm_to_component(source->dapm);\n\tstruct rt1011_priv *rt1011 = snd_soc_component_get_drvdata(component);\n\n\tif (rt1011->sysclk_src == RT1011_FS_SYS_PRE_S_PLL1)\n\t\treturn 1;\n\telse\n\t\treturn 0;\n}\n\nstatic int rt1011_dac_event(struct snd_soc_dapm_widget *w,\n\tstruct snd_kcontrol *kcontrol, int event)\n{\n\tstruct snd_soc_component *component =\n\t\tsnd_soc_dapm_to_component(w->dapm);\n\n\tswitch (event) {\n\tcase SND_SOC_DAPM_POST_PMU:\n\t\tsnd_soc_component_update_bits(component,\n\t\t\tRT1011_SPK_TEMP_PROTECT_0,\n\t\t\tRT1011_STP_EN_MASK | RT1011_STP_RS_CLB_EN_MASK,\n\t\t\tRT1011_STP_EN | RT1011_STP_RS_CLB_EN);\n\t\tsnd_soc_component_update_bits(component, RT1011_POWER_9,\n\t\t\tRT1011_POW_MNL_SDB_MASK, RT1011_POW_MNL_SDB);\n\t\tmsleep(50);\n\t\tsnd_soc_component_update_bits(component,\n\t\t\tRT1011_CLASSD_INTERNAL_SET_1,\n\t\t\tRT1011_DRIVER_READY_SPK, RT1011_DRIVER_READY_SPK);\n\t\tbreak;\n\tcase SND_SOC_DAPM_PRE_PMD:\n\t\tsnd_soc_component_update_bits(component, RT1011_POWER_9,\n\t\t\tRT1011_POW_MNL_SDB_MASK, 0);\n\t\tsnd_soc_component_update_bits(component,\n\t\t\tRT1011_SPK_TEMP_PROTECT_0,\n\t\t\tRT1011_STP_EN_MASK | RT1011_STP_RS_CLB_EN_MASK, 0);\n\t\tmsleep(200);\n\t\tsnd_soc_component_update_bits(component,\n\t\t\tRT1011_CLASSD_INTERNAL_SET_1,\n\t\t\tRT1011_DRIVER_READY_SPK, 0);\n\t\tbreak;\n\n\tdefault:\n\t\treturn 0;\n\t}\n\n\treturn 0;\n}\n\n\nstatic const struct snd_soc_dapm_widget rt1011_dapm_widgets[] = {\n\tSND_SOC_DAPM_SUPPLY(\"LDO2\", RT1011_POWER_1,\n\t\tRT1011_POW_LDO2_BIT, 0, NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"ISENSE SPK\", RT1011_POWER_1,\n\t\tRT1011_POW_ISENSE_SPK_BIT, 0, NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"VSENSE SPK\", RT1011_POWER_1,\n\t\tRT1011_POW_VSENSE_SPK_BIT, 0, NULL, 0),\n\n\tSND_SOC_DAPM_SUPPLY(\"PLL\", RT1011_POWER_2,\n\t\tRT1011_PLLEN_BIT, 0, NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"BG\", RT1011_POWER_2,\n\t\tRT1011_POW_BG_BIT, 0, NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"BG MBIAS\", RT1011_POWER_2,\n\t\tRT1011_POW_BG_MBIAS_LV_BIT, 0, NULL, 0),\n\n\tSND_SOC_DAPM_SUPPLY(\"DET VBAT\", RT1011_POWER_3,\n\t\tRT1011_POW_DET_VBAT_BIT, 0, NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"MBIAS\", RT1011_POWER_3,\n\t\tRT1011_POW_MBIAS_LV_BIT, 0, NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"ADC I\", RT1011_POWER_3,\n\t\tRT1011_POW_ADC_I_BIT, 0, NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"ADC V\", RT1011_POWER_3,\n\t\tRT1011_POW_ADC_V_BIT, 0, NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"ADC T\", RT1011_POWER_3,\n\t\tRT1011_POW_ADC_T_BIT, 0, NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"DITHER ADC T\", RT1011_POWER_3,\n\t\tRT1011_POWD_ADC_T_BIT, 0, NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"MIX I\", RT1011_POWER_3,\n\t\tRT1011_POW_MIX_I_BIT, 0, NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"MIX V\", RT1011_POWER_3,\n\t\tRT1011_POW_MIX_V_BIT, 0, NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"SUM I\", RT1011_POWER_3,\n\t\tRT1011_POW_SUM_I_BIT, 0, NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"SUM V\", RT1011_POWER_3,\n\t\tRT1011_POW_SUM_V_BIT, 0, NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"MIX T\", RT1011_POWER_3,\n\t\tRT1011_POW_MIX_T_BIT, 0, NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"VREF\", RT1011_POWER_3,\n\t\tRT1011_POW_VREF_LV_BIT, 0, NULL, 0),\n\n\tSND_SOC_DAPM_SUPPLY(\"BOOST SWR\", RT1011_POWER_4,\n\t\tRT1011_POW_EN_SWR_BIT, 0, NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"BGOK SWR\", RT1011_POWER_4,\n\t\tRT1011_POW_EN_PASS_BGOK_SWR_BIT, 0, NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"VPOK SWR\", RT1011_POWER_4,\n\t\tRT1011_POW_EN_PASS_VPOK_SWR_BIT, 0, NULL, 0),\n\n\tSND_SOC_DAPM_SUPPLY(\"TEMP REG\", RT1011_A_TEMP_SEN,\n\t\tRT1011_POW_TEMP_REG_BIT, 0, NULL, 0),\n\n\t \n\tSND_SOC_DAPM_AIF_IN(\"AIF1RX\", \"AIF1 Playback\", 0, SND_SOC_NOPM, 0, 0),\n\t \n\tSND_SOC_DAPM_SUPPLY(\"DAC Power\", RT1011_POWER_1,\n\t\tRT1011_POW_DAC_BIT, 0, NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"CLK12M\", RT1011_POWER_1,\n\t\tRT1011_POW_CLK12M_BIT, 0, NULL, 0),\n\tSND_SOC_DAPM_DAC_E(\"DAC\", NULL, RT1011_DAC_SET_3,\n\t\tRT1011_DA_MUTE_EN_SFT, 1, rt1011_dac_event,\n\t\tSND_SOC_DAPM_PRE_PMD | SND_SOC_DAPM_POST_PMU),\n\n\t \n\tSND_SOC_DAPM_OUTPUT(\"SPO\"),\n};\n\nstatic const struct snd_soc_dapm_route rt1011_dapm_routes[] = {\n\n\t{ \"DAC\", NULL, \"AIF1RX\" },\n\t{ \"DAC\", NULL, \"DAC Power\" },\n\t{ \"DAC\", NULL, \"LDO2\" },\n\t{ \"DAC\", NULL, \"ISENSE SPK\" },\n\t{ \"DAC\", NULL, \"VSENSE SPK\" },\n\t{ \"DAC\", NULL, \"CLK12M\" },\n\n\t{ \"DAC\", NULL, \"PLL\", rt1011_is_sys_clk_from_pll },\n\t{ \"DAC\", NULL, \"BG\" },\n\t{ \"DAC\", NULL, \"BG MBIAS\" },\n\n\t{ \"DAC\", NULL, \"BOOST SWR\" },\n\t{ \"DAC\", NULL, \"BGOK SWR\" },\n\t{ \"DAC\", NULL, \"VPOK SWR\" },\n\n\t{ \"DAC\", NULL, \"DET VBAT\" },\n\t{ \"DAC\", NULL, \"MBIAS\" },\n\t{ \"DAC\", NULL, \"VREF\" },\n\t{ \"DAC\", NULL, \"ADC I\" },\n\t{ \"DAC\", NULL, \"ADC V\" },\n\t{ \"DAC\", NULL, \"ADC T\" },\n\t{ \"DAC\", NULL, \"DITHER ADC T\" },\n\t{ \"DAC\", NULL, \"MIX I\" },\n\t{ \"DAC\", NULL, \"MIX V\" },\n\t{ \"DAC\", NULL, \"SUM I\" },\n\t{ \"DAC\", NULL, \"SUM V\" },\n\t{ \"DAC\", NULL, \"MIX T\" },\n\n\t{ \"DAC\", NULL, \"TEMP REG\" },\n\n\t{ \"SPO\", NULL, \"DAC\" },\n};\n\nstatic int rt1011_get_clk_info(int sclk, int rate)\n{\n\tint i;\n\tstatic const int pd[] = {1, 2, 3, 4, 6, 8, 12, 16};\n\n\tif (sclk <= 0 || rate <= 0)\n\t\treturn -EINVAL;\n\n\trate = rate << 8;\n\tfor (i = 0; i < ARRAY_SIZE(pd); i++)\n\t\tif (sclk == rate * pd[i])\n\t\t\treturn i;\n\n\treturn -EINVAL;\n}\n\nstatic int rt1011_hw_params(struct snd_pcm_substream *substream,\n\tstruct snd_pcm_hw_params *params, struct snd_soc_dai *dai)\n{\n\tstruct snd_soc_component *component = dai->component;\n\tstruct rt1011_priv *rt1011 = snd_soc_component_get_drvdata(component);\n\tunsigned int val_len = 0, ch_len = 0, val_clk, mask_clk;\n\tint pre_div, bclk_ms, frame_size;\n\n\trt1011->lrck = params_rate(params);\n\tpre_div = rt1011_get_clk_info(rt1011->sysclk, rt1011->lrck);\n\tif (pre_div < 0) {\n\t\tdev_warn(component->dev, \"Force using PLL \");\n\t\tsnd_soc_dai_set_pll(dai, 0, RT1011_PLL1_S_BCLK,\n\t\t\trt1011->lrck * 64, rt1011->lrck * 256);\n\t\tsnd_soc_dai_set_sysclk(dai, RT1011_FS_SYS_PRE_S_PLL1,\n\t\t\trt1011->lrck * 256, SND_SOC_CLOCK_IN);\n\t\tpre_div = 0;\n\t}\n\tframe_size = snd_soc_params_to_frame_size(params);\n\tif (frame_size < 0) {\n\t\tdev_err(component->dev, \"Unsupported frame size: %d\\n\",\n\t\t\tframe_size);\n\t\treturn -EINVAL;\n\t}\n\n\tbclk_ms = frame_size > 32;\n\trt1011->bclk = rt1011->lrck * (32 << bclk_ms);\n\n\tdev_dbg(component->dev, \"bclk_ms is %d and pre_div is %d for iis %d\\n\",\n\t\t\t\tbclk_ms, pre_div, dai->id);\n\n\tdev_dbg(component->dev, \"lrck is %dHz and pre_div is %d for iis %d\\n\",\n\t\t\t\trt1011->lrck, pre_div, dai->id);\n\n\tswitch (params_width(params)) {\n\tcase 16:\n\t\tval_len |= RT1011_I2S_TX_DL_16B;\n\t\tval_len |= RT1011_I2S_RX_DL_16B;\n\t\tch_len |= RT1011_I2S_CH_TX_LEN_16B;\n\t\tch_len |= RT1011_I2S_CH_RX_LEN_16B;\n\t\tbreak;\n\tcase 20:\n\t\tval_len |= RT1011_I2S_TX_DL_20B;\n\t\tval_len |= RT1011_I2S_RX_DL_20B;\n\t\tch_len |= RT1011_I2S_CH_TX_LEN_20B;\n\t\tch_len |= RT1011_I2S_CH_RX_LEN_20B;\n\t\tbreak;\n\tcase 24:\n\t\tval_len |= RT1011_I2S_TX_DL_24B;\n\t\tval_len |= RT1011_I2S_RX_DL_24B;\n\t\tch_len |= RT1011_I2S_CH_TX_LEN_24B;\n\t\tch_len |= RT1011_I2S_CH_RX_LEN_24B;\n\t\tbreak;\n\tcase 32:\n\t\tval_len |= RT1011_I2S_TX_DL_32B;\n\t\tval_len |= RT1011_I2S_RX_DL_32B;\n\t\tch_len |= RT1011_I2S_CH_TX_LEN_32B;\n\t\tch_len |= RT1011_I2S_CH_RX_LEN_32B;\n\t\tbreak;\n\tcase 8:\n\t\tval_len |= RT1011_I2S_TX_DL_8B;\n\t\tval_len |= RT1011_I2S_RX_DL_8B;\n\t\tch_len |= RT1011_I2S_CH_TX_LEN_8B;\n\t\tch_len |= RT1011_I2S_CH_RX_LEN_8B;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tswitch (dai->id) {\n\tcase RT1011_AIF1:\n\t\tmask_clk = RT1011_FS_SYS_DIV_MASK;\n\t\tval_clk = pre_div << RT1011_FS_SYS_DIV_SFT;\n\t\tsnd_soc_component_update_bits(component, RT1011_TDM_TOTAL_SET,\n\t\t\tRT1011_I2S_TX_DL_MASK | RT1011_I2S_RX_DL_MASK,\n\t\t\tval_len);\n\t\tsnd_soc_component_update_bits(component, RT1011_TDM1_SET_1,\n\t\t\tRT1011_I2S_CH_TX_LEN_MASK |\n\t\t\tRT1011_I2S_CH_RX_LEN_MASK,\n\t\t\tch_len);\n\t\tbreak;\n\tdefault:\n\t\tdev_err(component->dev, \"Invalid dai->id: %d\\n\", dai->id);\n\t\treturn -EINVAL;\n\t}\n\n\tsnd_soc_component_update_bits(component,\n\t\tRT1011_CLK_2, mask_clk, val_clk);\n\n\treturn 0;\n}\n\nstatic int rt1011_set_dai_fmt(struct snd_soc_dai *dai, unsigned int fmt)\n{\n\tstruct snd_soc_component *component = dai->component;\n\tstruct snd_soc_dapm_context *dapm =\n\t\tsnd_soc_component_get_dapm(component);\n\tunsigned int reg_val = 0, reg_bclk_inv = 0;\n\tint ret = 0;\n\n\tsnd_soc_dapm_mutex_lock(dapm);\n\tswitch (fmt & SND_SOC_DAIFMT_MASTER_MASK) {\n\tcase SND_SOC_DAIFMT_CBS_CFS:\n\t\treg_val |= RT1011_I2S_TDM_MS_S;\n\t\tbreak;\n\tdefault:\n\t\tret = -EINVAL;\n\t\tgoto _set_fmt_err_;\n\t}\n\n\tswitch (fmt & SND_SOC_DAIFMT_INV_MASK) {\n\tcase SND_SOC_DAIFMT_NB_NF:\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_IB_NF:\n\t\treg_bclk_inv |= RT1011_TDM_INV_BCLK;\n\t\tbreak;\n\tdefault:\n\t\tret = -EINVAL;\n\t\tgoto _set_fmt_err_;\n\t}\n\n\tswitch (fmt & SND_SOC_DAIFMT_FORMAT_MASK) {\n\tcase SND_SOC_DAIFMT_I2S:\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_LEFT_J:\n\t\treg_val |= RT1011_I2S_TDM_DF_LEFT;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_DSP_A:\n\t\treg_val |= RT1011_I2S_TDM_DF_PCM_A;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_DSP_B:\n\t\treg_val |= RT1011_I2S_TDM_DF_PCM_B;\n\t\tbreak;\n\tdefault:\n\t\tret = -EINVAL;\n\t\tgoto _set_fmt_err_;\n\t}\n\n\tswitch (dai->id) {\n\tcase RT1011_AIF1:\n\t\tsnd_soc_component_update_bits(component, RT1011_TDM_TOTAL_SET,\n\t\t\tRT1011_I2S_TDM_MS_MASK | RT1011_I2S_TDM_DF_MASK,\n\t\t\treg_val);\n\t\tsnd_soc_component_update_bits(component, RT1011_TDM1_SET_1,\n\t\t\tRT1011_TDM_INV_BCLK_MASK, reg_bclk_inv);\n\t\tsnd_soc_component_update_bits(component, RT1011_TDM2_SET_1,\n\t\t\tRT1011_TDM_INV_BCLK_MASK, reg_bclk_inv);\n\t\tbreak;\n\tdefault:\n\t\tdev_err(component->dev, \"Invalid dai->id: %d\\n\", dai->id);\n\t\tret = -EINVAL;\n\t}\n\n_set_fmt_err_:\n\tsnd_soc_dapm_mutex_unlock(dapm);\n\treturn ret;\n}\n\nstatic int rt1011_set_component_sysclk(struct snd_soc_component *component,\n\t\tint clk_id, int source, unsigned int freq, int dir)\n{\n\tstruct rt1011_priv *rt1011 = snd_soc_component_get_drvdata(component);\n\tunsigned int reg_val = 0;\n\n\tif (freq == rt1011->sysclk && clk_id == rt1011->sysclk_src)\n\t\treturn 0;\n\n\t \n\tsnd_soc_component_update_bits(component, RT1011_CLK_DET,\n\t\t\tRT1011_EN_MCLK_DET_MASK, 0);\n\n\tswitch (clk_id) {\n\tcase RT1011_FS_SYS_PRE_S_MCLK:\n\t\treg_val |= RT1011_FS_SYS_PRE_MCLK;\n\t\tsnd_soc_component_update_bits(component, RT1011_CLK_DET,\n\t\t\tRT1011_EN_MCLK_DET_MASK, RT1011_EN_MCLK_DET);\n\t\tbreak;\n\tcase RT1011_FS_SYS_PRE_S_BCLK:\n\t\treg_val |= RT1011_FS_SYS_PRE_BCLK;\n\t\tbreak;\n\tcase RT1011_FS_SYS_PRE_S_PLL1:\n\t\treg_val |= RT1011_FS_SYS_PRE_PLL1;\n\t\tbreak;\n\tcase RT1011_FS_SYS_PRE_S_RCCLK:\n\t\treg_val |= RT1011_FS_SYS_PRE_RCCLK;\n\t\tbreak;\n\tdefault:\n\t\tdev_err(component->dev, \"Invalid clock id (%d)\\n\", clk_id);\n\t\treturn -EINVAL;\n\t}\n\tsnd_soc_component_update_bits(component, RT1011_CLK_2,\n\t\tRT1011_FS_SYS_PRE_MASK, reg_val);\n\trt1011->sysclk = freq;\n\trt1011->sysclk_src = clk_id;\n\n\tdev_dbg(component->dev, \"Sysclk is %dHz and clock id is %d\\n\",\n\t\tfreq, clk_id);\n\n\treturn 0;\n}\n\nstatic int rt1011_set_component_pll(struct snd_soc_component *component,\n\t\tint pll_id, int source, unsigned int freq_in,\n\t\tunsigned int freq_out)\n{\n\tstruct rt1011_priv *rt1011 = snd_soc_component_get_drvdata(component);\n\tstruct rl6231_pll_code pll_code;\n\tint ret;\n\n\tif (source == rt1011->pll_src && freq_in == rt1011->pll_in &&\n\t    freq_out == rt1011->pll_out)\n\t\treturn 0;\n\n\tif (!freq_in || !freq_out) {\n\t\tdev_dbg(component->dev, \"PLL disabled\\n\");\n\n\t\trt1011->pll_in = 0;\n\t\trt1011->pll_out = 0;\n\t\tsnd_soc_component_update_bits(component, RT1011_CLK_2,\n\t\t\tRT1011_FS_SYS_PRE_MASK, RT1011_FS_SYS_PRE_BCLK);\n\t\treturn 0;\n\t}\n\n\tswitch (source) {\n\tcase RT1011_PLL2_S_MCLK:\n\t\tsnd_soc_component_update_bits(component, RT1011_CLK_2,\n\t\t\tRT1011_PLL2_SRC_MASK, RT1011_PLL2_SRC_MCLK);\n\t\tsnd_soc_component_update_bits(component, RT1011_CLK_2,\n\t\t\tRT1011_PLL1_SRC_MASK, RT1011_PLL1_SRC_PLL2);\n\t\tsnd_soc_component_update_bits(component, RT1011_CLK_DET,\n\t\t\tRT1011_EN_MCLK_DET_MASK, RT1011_EN_MCLK_DET);\n\t\tbreak;\n\tcase RT1011_PLL1_S_BCLK:\n\t\tsnd_soc_component_update_bits(component, RT1011_CLK_2,\n\t\t\t\tRT1011_PLL1_SRC_MASK, RT1011_PLL1_SRC_BCLK);\n\t\tbreak;\n\tcase RT1011_PLL2_S_RCCLK:\n\t\tsnd_soc_component_update_bits(component, RT1011_CLK_2,\n\t\t\tRT1011_PLL2_SRC_MASK, RT1011_PLL2_SRC_RCCLK);\n\t\tsnd_soc_component_update_bits(component, RT1011_CLK_2,\n\t\t\tRT1011_PLL1_SRC_MASK, RT1011_PLL1_SRC_PLL2);\n\t\tbreak;\n\tdefault:\n\t\tdev_err(component->dev, \"Unknown PLL Source %d\\n\", source);\n\t\treturn -EINVAL;\n\t}\n\n\tret = rl6231_pll_calc(freq_in, freq_out, &pll_code);\n\tif (ret < 0) {\n\t\tdev_err(component->dev, \"Unsupported input clock %d\\n\",\n\t\t\tfreq_in);\n\t\treturn ret;\n\t}\n\n\tdev_dbg(component->dev, \"bypass=%d m=%d n=%d k=%d\\n\",\n\t\tpll_code.m_bp, (pll_code.m_bp ? 0 : pll_code.m_code),\n\t\tpll_code.n_code, pll_code.k_code);\n\n\tsnd_soc_component_write(component, RT1011_PLL_1,\n\t\t((pll_code.m_bp ? 0 : pll_code.m_code) << RT1011_PLL1_QM_SFT) |\n\t\t(pll_code.m_bp << RT1011_PLL1_BPM_SFT) |\n\t\tpll_code.n_code);\n\tsnd_soc_component_write(component, RT1011_PLL_2,\n\t\tpll_code.k_code);\n\n\trt1011->pll_in = freq_in;\n\trt1011->pll_out = freq_out;\n\trt1011->pll_src = source;\n\n\treturn 0;\n}\n\nstatic int rt1011_set_tdm_slot(struct snd_soc_dai *dai,\n\tunsigned int tx_mask, unsigned int rx_mask, int slots, int slot_width)\n{\n\tstruct snd_soc_component *component = dai->component;\n\tstruct snd_soc_dapm_context *dapm =\n\t\tsnd_soc_component_get_dapm(component);\n\tunsigned int val = 0, tdm_en = 0, rx_slotnum, tx_slotnum;\n\tint ret = 0, first_bit, last_bit;\n\n\tsnd_soc_dapm_mutex_lock(dapm);\n\tif (rx_mask || tx_mask)\n\t\ttdm_en = RT1011_TDM_I2S_DOCK_EN_1;\n\n\tswitch (slots) {\n\tcase 4:\n\t\tval |= RT1011_I2S_TX_4CH;\n\t\tval |= RT1011_I2S_RX_4CH;\n\t\tbreak;\n\tcase 6:\n\t\tval |= RT1011_I2S_TX_6CH;\n\t\tval |= RT1011_I2S_RX_6CH;\n\t\tbreak;\n\tcase 8:\n\t\tval |= RT1011_I2S_TX_8CH;\n\t\tval |= RT1011_I2S_RX_8CH;\n\t\tbreak;\n\tcase 2:\n\t\tbreak;\n\tdefault:\n\t\tret = -EINVAL;\n\t\tgoto _set_tdm_err_;\n\t}\n\n\tswitch (slot_width) {\n\tcase 20:\n\t\tval |= RT1011_I2S_CH_TX_LEN_20B;\n\t\tval |= RT1011_I2S_CH_RX_LEN_20B;\n\t\tbreak;\n\tcase 24:\n\t\tval |= RT1011_I2S_CH_TX_LEN_24B;\n\t\tval |= RT1011_I2S_CH_RX_LEN_24B;\n\t\tbreak;\n\tcase 32:\n\t\tval |= RT1011_I2S_CH_TX_LEN_32B;\n\t\tval |= RT1011_I2S_CH_RX_LEN_32B;\n\t\tbreak;\n\tcase 16:\n\t\tbreak;\n\tdefault:\n\t\tret = -EINVAL;\n\t\tgoto _set_tdm_err_;\n\t}\n\n\t \n\trx_slotnum = hweight_long(rx_mask);\n\tif (rx_slotnum > 1 || !rx_slotnum) {\n\t\tret = -EINVAL;\n\t\tdev_err(component->dev, \"too many rx slots or zero slot\\n\");\n\t\tgoto _set_tdm_err_;\n\t}\n\n\tfirst_bit = __ffs(rx_mask);\n\tswitch (first_bit) {\n\tcase 0:\n\tcase 2:\n\tcase 4:\n\tcase 6:\n\t\tsnd_soc_component_update_bits(component,\n\t\t\tRT1011_CROSS_BQ_SET_1, RT1011_MONO_LR_SEL_MASK,\n\t\t\tRT1011_MONO_L_CHANNEL);\n\t\tsnd_soc_component_update_bits(component,\n\t\t\tRT1011_TDM1_SET_4,\n\t\t\tRT1011_TDM_I2S_TX_L_DAC1_1_MASK |\n\t\t\tRT1011_TDM_I2S_TX_R_DAC1_1_MASK,\n\t\t\t(first_bit << RT1011_TDM_I2S_TX_L_DAC1_1_SFT) |\n\t\t\t((first_bit+1) << RT1011_TDM_I2S_TX_R_DAC1_1_SFT));\n\t\tbreak;\n\tcase 1:\n\tcase 3:\n\tcase 5:\n\tcase 7:\n\t\tsnd_soc_component_update_bits(component,\n\t\t\tRT1011_CROSS_BQ_SET_1, RT1011_MONO_LR_SEL_MASK,\n\t\t\tRT1011_MONO_R_CHANNEL);\n\t\tsnd_soc_component_update_bits(component,\n\t\t\tRT1011_TDM1_SET_4,\n\t\t\tRT1011_TDM_I2S_TX_L_DAC1_1_MASK |\n\t\t\tRT1011_TDM_I2S_TX_R_DAC1_1_MASK,\n\t\t\t((first_bit-1) << RT1011_TDM_I2S_TX_L_DAC1_1_SFT) |\n\t\t\t(first_bit << RT1011_TDM_I2S_TX_R_DAC1_1_SFT));\n\t\tbreak;\n\tdefault:\n\t\tret = -EINVAL;\n\t\tgoto _set_tdm_err_;\n\t}\n\n\t \n\ttx_slotnum = hweight_long(tx_mask);\n\tif (tx_slotnum > 2 || !tx_slotnum) {\n\t\tret = -EINVAL;\n\t\tdev_err(component->dev, \"too many tx slots or zero slot\\n\");\n\t\tgoto _set_tdm_err_;\n\t}\n\n\tfirst_bit = __ffs(tx_mask);\n\tlast_bit = __fls(tx_mask);\n\tif (last_bit - first_bit > 1) {\n\t\tret = -EINVAL;\n\t\tdev_err(component->dev, \"tx slot location error\\n\");\n\t\tgoto _set_tdm_err_;\n\t}\n\n\tif (tx_slotnum == 1) {\n\t\tsnd_soc_component_update_bits(component, RT1011_TDM1_SET_2,\n\t\t\tRT1011_TDM_I2S_DOCK_ADCDAT_LEN_1_MASK |\n\t\t\tRT1011_TDM_ADCDAT1_DATA_LOCATION, first_bit);\n\t\tswitch (first_bit) {\n\t\tcase 1:\n\t\t\tsnd_soc_component_update_bits(component,\n\t\t\t\tRT1011_TDM1_SET_3,\n\t\t\t\tRT1011_TDM_I2S_RX_ADC1_1_MASK,\n\t\t\t\tRT1011_TDM_I2S_RX_ADC1_1_LL);\n\t\t\tbreak;\n\t\tcase 3:\n\t\t\tsnd_soc_component_update_bits(component,\n\t\t\t\tRT1011_TDM1_SET_3,\n\t\t\t\tRT1011_TDM_I2S_RX_ADC2_1_MASK,\n\t\t\t\tRT1011_TDM_I2S_RX_ADC2_1_LL);\n\t\t\tbreak;\n\t\tcase 5:\n\t\t\tsnd_soc_component_update_bits(component,\n\t\t\t\tRT1011_TDM1_SET_3,\n\t\t\t\tRT1011_TDM_I2S_RX_ADC3_1_MASK,\n\t\t\t\tRT1011_TDM_I2S_RX_ADC3_1_LL);\n\t\t\tbreak;\n\t\tcase 7:\n\t\t\tsnd_soc_component_update_bits(component,\n\t\t\t\tRT1011_TDM1_SET_3,\n\t\t\t\tRT1011_TDM_I2S_RX_ADC4_1_MASK,\n\t\t\t\tRT1011_TDM_I2S_RX_ADC4_1_LL);\n\t\t\tbreak;\n\t\tcase 0:\n\t\t\tsnd_soc_component_update_bits(component,\n\t\t\t\tRT1011_TDM1_SET_3,\n\t\t\t\tRT1011_TDM_I2S_RX_ADC1_1_MASK, 0);\n\t\t\tbreak;\n\t\tcase 2:\n\t\t\tsnd_soc_component_update_bits(component,\n\t\t\t\tRT1011_TDM1_SET_3,\n\t\t\t\tRT1011_TDM_I2S_RX_ADC2_1_MASK, 0);\n\t\t\tbreak;\n\t\tcase 4:\n\t\t\tsnd_soc_component_update_bits(component,\n\t\t\t\tRT1011_TDM1_SET_3,\n\t\t\t\tRT1011_TDM_I2S_RX_ADC3_1_MASK, 0);\n\t\t\tbreak;\n\t\tcase 6:\n\t\t\tsnd_soc_component_update_bits(component,\n\t\t\t\tRT1011_TDM1_SET_3,\n\t\t\t\tRT1011_TDM_I2S_RX_ADC4_1_MASK, 0);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tret = -EINVAL;\n\t\t\tdev_dbg(component->dev,\n\t\t\t\t\"tx slot location error\\n\");\n\t\t\tgoto _set_tdm_err_;\n\t\t}\n\t} else if (tx_slotnum == 2) {\n\t\tswitch (first_bit) {\n\t\tcase 0:\n\t\tcase 2:\n\t\tcase 4:\n\t\tcase 6:\n\t\t\tsnd_soc_component_update_bits(component,\n\t\t\t\tRT1011_TDM1_SET_2,\n\t\t\t\tRT1011_TDM_I2S_DOCK_ADCDAT_LEN_1_MASK |\n\t\t\t\tRT1011_TDM_ADCDAT1_DATA_LOCATION,\n\t\t\t\tRT1011_TDM_I2S_DOCK_ADCDAT_2CH | first_bit);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tret = -EINVAL;\n\t\t\tdev_dbg(component->dev,\n\t\t\t\t\"tx slot location should be paired and start from slot0/2/4/6\\n\");\n\t\t\tgoto _set_tdm_err_;\n\t\t}\n\t}\n\n\tsnd_soc_component_update_bits(component, RT1011_TDM1_SET_1,\n\t\tRT1011_I2S_CH_TX_MASK | RT1011_I2S_CH_RX_MASK |\n\t\tRT1011_I2S_CH_TX_LEN_MASK | RT1011_I2S_CH_RX_LEN_MASK, val);\n\tsnd_soc_component_update_bits(component, RT1011_TDM2_SET_1,\n\t\tRT1011_I2S_CH_TX_MASK | RT1011_I2S_CH_RX_MASK |\n\t\tRT1011_I2S_CH_TX_LEN_MASK | RT1011_I2S_CH_RX_LEN_MASK, val);\n\tsnd_soc_component_update_bits(component, RT1011_TDM1_SET_2,\n\t\tRT1011_TDM_I2S_DOCK_EN_1_MASK, tdm_en);\n\tsnd_soc_component_update_bits(component, RT1011_TDM2_SET_2,\n\t\tRT1011_TDM_I2S_DOCK_EN_2_MASK, tdm_en);\n\n\tsnd_soc_component_update_bits(component, RT1011_TDM_TOTAL_SET,\n\t\tRT1011_ADCDAT1_PIN_CONFIG | RT1011_ADCDAT2_PIN_CONFIG,\n\t\tRT1011_ADCDAT1_OUTPUT | RT1011_ADCDAT2_OUTPUT);\n\n_set_tdm_err_:\n\tsnd_soc_dapm_mutex_unlock(dapm);\n\treturn ret;\n}\n\nstatic int rt1011_probe(struct snd_soc_component *component)\n{\n\tstruct rt1011_priv *rt1011 = snd_soc_component_get_drvdata(component);\n\tint i;\n\n\trt1011->component = component;\n\n\tschedule_work(&rt1011->cali_work);\n\n\trt1011->i2s_ref = 0;\n\trt1011->bq_drc_params = devm_kcalloc(component->dev,\n\t\tRT1011_ADVMODE_NUM, sizeof(struct rt1011_bq_drc_params *),\n\t\tGFP_KERNEL);\n\tif (!rt1011->bq_drc_params)\n\t\treturn -ENOMEM;\n\n\tfor (i = 0; i < RT1011_ADVMODE_NUM; i++) {\n\t\trt1011->bq_drc_params[i] = devm_kcalloc(component->dev,\n\t\t\tRT1011_BQ_DRC_NUM, sizeof(struct rt1011_bq_drc_params),\n\t\t\tGFP_KERNEL);\n\t\tif (!rt1011->bq_drc_params[i])\n\t\t\treturn -ENOMEM;\n\t}\n\n\treturn 0;\n}\n\nstatic void rt1011_remove(struct snd_soc_component *component)\n{\n\tstruct rt1011_priv *rt1011 = snd_soc_component_get_drvdata(component);\n\n\tcancel_work_sync(&rt1011->cali_work);\n\trt1011_reset(rt1011->regmap);\n}\n\n#ifdef CONFIG_PM\nstatic int rt1011_suspend(struct snd_soc_component *component)\n{\n\tstruct rt1011_priv *rt1011 = snd_soc_component_get_drvdata(component);\n\n\tregcache_cache_only(rt1011->regmap, true);\n\tregcache_mark_dirty(rt1011->regmap);\n\n\treturn 0;\n}\n\nstatic int rt1011_resume(struct snd_soc_component *component)\n{\n\tstruct rt1011_priv *rt1011 = snd_soc_component_get_drvdata(component);\n\n\tregcache_cache_only(rt1011->regmap, false);\n\tregcache_sync(rt1011->regmap);\n\n\treturn 0;\n}\n#else\n#define rt1011_suspend NULL\n#define rt1011_resume NULL\n#endif\n\nstatic int rt1011_set_bias_level(struct snd_soc_component *component,\n\t\t\t\t enum snd_soc_bias_level level)\n{\n\tswitch (level) {\n\tcase SND_SOC_BIAS_OFF:\n\t\tsnd_soc_component_write(component,\n\t\t\tRT1011_SYSTEM_RESET_1, 0x0000);\n\t\tsnd_soc_component_write(component,\n\t\t\tRT1011_SYSTEM_RESET_2, 0x0000);\n\t\tsnd_soc_component_write(component,\n\t\t\tRT1011_SYSTEM_RESET_3, 0x0001);\n\t\tsnd_soc_component_write(component,\n\t\t\tRT1011_SYSTEM_RESET_1, 0x003f);\n\t\tsnd_soc_component_write(component,\n\t\t\tRT1011_SYSTEM_RESET_2, 0x7fd7);\n\t\tsnd_soc_component_write(component,\n\t\t\tRT1011_SYSTEM_RESET_3, 0x770f);\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n\n\treturn 0;\n}\n\n#define RT1011_STEREO_RATES SNDRV_PCM_RATE_8000_192000\n#define RT1011_FORMATS (SNDRV_PCM_FMTBIT_S8 | \\\n\t\t\tSNDRV_PCM_FMTBIT_S20_3LE | SNDRV_PCM_FMTBIT_S16_LE | \\\n\t\t\tSNDRV_PCM_FMTBIT_S24_LE | SNDRV_PCM_FMTBIT_S32_LE)\n\nstatic const struct snd_soc_dai_ops rt1011_aif_dai_ops = {\n\t.hw_params = rt1011_hw_params,\n\t.set_fmt = rt1011_set_dai_fmt,\n\t.set_tdm_slot = rt1011_set_tdm_slot,\n};\n\nstatic struct snd_soc_dai_driver rt1011_dai[] = {\n\t{\n\t\t.name = \"rt1011-aif\",\n\t\t.playback = {\n\t\t\t.stream_name = \"AIF1 Playback\",\n\t\t\t.channels_min = 1,\n\t\t\t.channels_max = 2,\n\t\t\t.rates = RT1011_STEREO_RATES,\n\t\t\t.formats = RT1011_FORMATS,\n\t\t},\n\t\t.ops = &rt1011_aif_dai_ops,\n\t},\n};\n\nstatic const struct snd_soc_component_driver soc_component_dev_rt1011 = {\n\t.probe = rt1011_probe,\n\t.remove = rt1011_remove,\n\t.suspend = rt1011_suspend,\n\t.resume = rt1011_resume,\n\t.set_bias_level = rt1011_set_bias_level,\n\t.controls = rt1011_snd_controls,\n\t.num_controls = ARRAY_SIZE(rt1011_snd_controls),\n\t.dapm_widgets = rt1011_dapm_widgets,\n\t.num_dapm_widgets = ARRAY_SIZE(rt1011_dapm_widgets),\n\t.dapm_routes = rt1011_dapm_routes,\n\t.num_dapm_routes = ARRAY_SIZE(rt1011_dapm_routes),\n\t.set_sysclk = rt1011_set_component_sysclk,\n\t.set_pll = rt1011_set_component_pll,\n\t.use_pmdown_time = 1,\n\t.endianness = 1,\n};\n\nstatic const struct regmap_config rt1011_regmap = {\n\t.reg_bits = 16,\n\t.val_bits = 16,\n\t.max_register = RT1011_MAX_REG + 1,\n\t.volatile_reg = rt1011_volatile_register,\n\t.readable_reg = rt1011_readable_register,\n\t.cache_type = REGCACHE_MAPLE,\n\t.reg_defaults = rt1011_reg,\n\t.num_reg_defaults = ARRAY_SIZE(rt1011_reg),\n\t.use_single_read = true,\n\t.use_single_write = true,\n};\n\n#if defined(CONFIG_OF)\nstatic const struct of_device_id rt1011_of_match[] = {\n\t{ .compatible = \"realtek,rt1011\", },\n\t{},\n};\nMODULE_DEVICE_TABLE(of, rt1011_of_match);\n#endif\n\n#ifdef CONFIG_ACPI\nstatic const struct acpi_device_id rt1011_acpi_match[] = {\n\t{\"10EC1011\", 0,},\n\t{},\n};\nMODULE_DEVICE_TABLE(acpi, rt1011_acpi_match);\n#endif\n\nstatic const struct i2c_device_id rt1011_i2c_id[] = {\n\t{ \"rt1011\", 0 },\n\t{ }\n};\nMODULE_DEVICE_TABLE(i2c, rt1011_i2c_id);\n\nstatic int rt1011_calibrate(struct rt1011_priv *rt1011, unsigned char cali_flag)\n{\n\tunsigned int value, count = 0, r0[3];\n\tunsigned int chk_cnt = 50;  \n\tunsigned int dc_offset;\n\tunsigned int r0_integer, r0_factor, format;\n\tstruct device *dev = regmap_get_device(rt1011->regmap);\n\tstruct snd_soc_dapm_context *dapm =\n\t\tsnd_soc_component_get_dapm(rt1011->component);\n\tint ret = 0;\n\n\tsnd_soc_dapm_mutex_lock(dapm);\n\tregcache_cache_bypass(rt1011->regmap, true);\n\n\tregmap_write(rt1011->regmap, RT1011_RESET, 0x0000);\n\tregmap_write(rt1011->regmap, RT1011_SYSTEM_RESET_3, 0x740f);\n\tregmap_write(rt1011->regmap, RT1011_SYSTEM_RESET_3, 0x770f);\n\n\t \n\tregmap_write(rt1011->regmap, RT1011_CLK_2, 0x9400);\n\tregmap_write(rt1011->regmap, RT1011_PLL_1, 0x0800);\n\tregmap_write(rt1011->regmap, RT1011_PLL_2, 0x0020);\n\tregmap_write(rt1011->regmap, RT1011_CLK_DET, 0x0800);\n\n\t \n\tregmap_write(rt1011->regmap, RT1011_ADC_SET_5, 0x0a20);\n\tregmap_write(rt1011->regmap, RT1011_DAC_SET_2, 0xe232);\n\tregmap_write(rt1011->regmap, RT1011_ADC_SET_4, 0xc000);\n\n\t \n\tregmap_write(rt1011->regmap, RT1011_SPK_PRO_DC_DET_1, 0xb00c);\n\tregmap_write(rt1011->regmap, RT1011_SPK_PRO_DC_DET_2, 0xcccc);\n\n\t \n\tregmap_write(rt1011->regmap, RT1011_POWER_1, 0xe0e0);\n\tregmap_write(rt1011->regmap, RT1011_POWER_3, 0x5003);\n\tregmap_write(rt1011->regmap, RT1011_POWER_9, 0xa860);\n\tregmap_write(rt1011->regmap, RT1011_DAC_SET_2, 0xa032);\n\n\t \n\tregmap_write(rt1011->regmap, RT1011_POWER_2, 0x0007);\n\tregmap_write(rt1011->regmap, RT1011_POWER_3, 0x5ff7);\n\tregmap_write(rt1011->regmap, RT1011_A_TEMP_SEN, 0x7f44);\n\tregmap_write(rt1011->regmap, RT1011_A_TIMING_1, 0x4054);\n\tregmap_write(rt1011->regmap, RT1011_BAT_GAIN_1, 0x309c);\n\n\t \n\tregmap_write(rt1011->regmap, RT1011_DC_CALIB_CLASSD_3, 0xcb00);\n\tregmap_write(rt1011->regmap, RT1011_BOOST_CON_1, 0xe080);\n\tregmap_write(rt1011->regmap, RT1011_POWER_4, 0x16f2);\n\tregmap_write(rt1011->regmap, RT1011_POWER_6, 0x36ad);\n\n\t \n\tregmap_write(rt1011->regmap, RT1011_MIXER_1, 0x3f1d);\n\n\t \n\tregmap_write(rt1011->regmap, RT1011_EFUSE_CONTROL_1, 0x0d0a);\n\tmsleep(30);\n\n\tregmap_read(rt1011->regmap, RT1011_EFUSE_ADC_OFFSET_18_16, &value);\n\tdc_offset = value << 16;\n\tregmap_read(rt1011->regmap, RT1011_EFUSE_ADC_OFFSET_15_0, &value);\n\tdc_offset |= (value & 0xffff);\n\tdev_info(dev, \"ADC offset=0x%x\\n\", dc_offset);\n\tregmap_read(rt1011->regmap, RT1011_EFUSE_DAC_OFFSET_G0_20_16, &value);\n\tdc_offset = value << 16;\n\tregmap_read(rt1011->regmap, RT1011_EFUSE_DAC_OFFSET_G0_15_0, &value);\n\tdc_offset |= (value & 0xffff);\n\tdev_info(dev, \"Gain0 offset=0x%x\\n\", dc_offset);\n\tregmap_read(rt1011->regmap, RT1011_EFUSE_DAC_OFFSET_G1_20_16, &value);\n\tdc_offset = value << 16;\n\tregmap_read(rt1011->regmap, RT1011_EFUSE_DAC_OFFSET_G1_15_0, &value);\n\tdc_offset |= (value & 0xffff);\n\tdev_info(dev, \"Gain1 offset=0x%x\\n\", dc_offset);\n\n\tif (cali_flag) {\n\n\t\tregmap_write(rt1011->regmap, RT1011_ADC_SET_1, 0x2925);\n\t\t \n\t\tregmap_write(rt1011->regmap, RT1011_CLASS_D_POS, 0x010e);\n\t\tregmap_write(rt1011->regmap,\n\t\t\tRT1011_CLASSD_INTERNAL_SET_1, 0x1701);\n\n\t\t \n\t\tregmap_write(rt1011->regmap, RT1011_SPK_TEMP_PROTECT_0, 0x8000);\n\t\tregmap_write(rt1011->regmap, RT1011_SPK_TEMP_PROTECT_7, 0xf000);\n\t\tregmap_write(rt1011->regmap, RT1011_SPK_TEMP_PROTECT_4, 0x4040);\n\t\tregmap_write(rt1011->regmap, RT1011_SPK_TEMP_PROTECT_0, 0xc000);\n\t\tregmap_write(rt1011->regmap, RT1011_SPK_TEMP_PROTECT_6, 0x07c2);\n\n\t\tr0[0] = r0[1] = r0[2] = count = 0;\n\t\twhile (count < chk_cnt) {\n\t\t\tmsleep(100);\n\t\t\tregmap_read(rt1011->regmap,\n\t\t\t\tRT1011_INIT_RECIPROCAL_SYN_24_16, &value);\n\t\t\tr0[count%3] = value << 16;\n\t\t\tregmap_read(rt1011->regmap,\n\t\t\t\tRT1011_INIT_RECIPROCAL_SYN_15_0, &value);\n\t\t\tr0[count%3] |= value;\n\n\t\t\tif (r0[count%3] == 0)\n\t\t\t\tcontinue;\n\n\t\t\tcount++;\n\n\t\t\tif (r0[0] == r0[1] && r0[1] == r0[2])\n\t\t\t\tbreak;\n\t\t}\n\t\tif (count > chk_cnt) {\n\t\t\tdev_err(dev, \"Calibrate R0 Failure\\n\");\n\t\t\tret = -EAGAIN;\n\t\t} else {\n\t\t\tformat = 2147483648U;  \n\t\t\tr0_integer = format / r0[0] / 128;\n\t\t\tr0_factor = ((format / r0[0] * 100) / 128)\n\t\t\t\t\t\t\t- (r0_integer * 100);\n\t\t\trt1011->r0_reg = r0[0];\n\t\t\trt1011->cali_done = 1;\n\t\t\tdev_info(dev, \"r0 resistance about %d.%02d ohm, reg=0x%X\\n\",\n\t\t\t\tr0_integer, r0_factor, r0[0]);\n\t\t}\n\t}\n\n\t \n\tregmap_write(rt1011->regmap, RT1011_SPK_TEMP_PROTECT_0, 0x0000);\n\tmsleep(400);\n\tregmap_write(rt1011->regmap, RT1011_POWER_9, 0xa840);\n\tregmap_write(rt1011->regmap, RT1011_SPK_TEMP_PROTECT_6, 0x0702);\n\tregmap_write(rt1011->regmap, RT1011_MIXER_1, 0xffdd);\n\tregmap_write(rt1011->regmap, RT1011_CLASSD_INTERNAL_SET_1, 0x0701);\n\tregmap_write(rt1011->regmap, RT1011_DAC_SET_3, 0xe004);\n\tregmap_write(rt1011->regmap, RT1011_A_TEMP_SEN, 0x7f40);\n\tregmap_write(rt1011->regmap, RT1011_POWER_1, 0x0000);\n\tregmap_write(rt1011->regmap, RT1011_POWER_2, 0x0000);\n\tregmap_write(rt1011->regmap, RT1011_POWER_3, 0x0002);\n\tregmap_write(rt1011->regmap, RT1011_POWER_4, 0x00f2);\n\n\tregmap_write(rt1011->regmap, RT1011_RESET, 0x0000);\n\n\tif (cali_flag) {\n\t\tif (count <= chk_cnt) {\n\t\t\tregmap_write(rt1011->regmap,\n\t\t\t\tRT1011_INIT_RECIPROCAL_REG_24_16,\n\t\t\t\t((r0[0]>>16) & 0x1ff));\n\t\t\tregmap_write(rt1011->regmap,\n\t\t\t\tRT1011_INIT_RECIPROCAL_REG_15_0,\n\t\t\t\t(r0[0] & 0xffff));\n\t\t\tregmap_write(rt1011->regmap,\n\t\t\t\tRT1011_SPK_TEMP_PROTECT_4, 0x4080);\n\t\t}\n\t}\n\n\tregcache_cache_bypass(rt1011->regmap, false);\n\tregcache_mark_dirty(rt1011->regmap);\n\tregcache_sync(rt1011->regmap);\n\tsnd_soc_dapm_mutex_unlock(dapm);\n\n\treturn ret;\n}\n\nstatic void rt1011_calibration_work(struct work_struct *work)\n{\n\tstruct rt1011_priv *rt1011 =\n\t\tcontainer_of(work, struct rt1011_priv, cali_work);\n\tstruct snd_soc_component *component = rt1011->component;\n\tunsigned int r0_integer, r0_factor, format;\n\n\tif (rt1011->r0_calib)\n\t\trt1011_calibrate(rt1011, 0);\n\telse\n\t\trt1011_calibrate(rt1011, 1);\n\n\t \n\trt1011->cali_done = 0;\n\n\t \n\trt1011_reg_init(component);\n\n\t \n\tif (rt1011->temperature_calib <= 0xff &&\n\t\trt1011->temperature_calib > 0) {\n\t\tsnd_soc_component_update_bits(component,\n\t\t\tRT1011_STP_INITIAL_RESISTANCE_TEMP, 0x3ff,\n\t\t\t(rt1011->temperature_calib << 2));\n\t}\n\n\tif (rt1011->r0_calib) {\n\t\trt1011->r0_reg = rt1011->r0_calib;\n\n\t\tformat = 2147483648U;  \n\t\tr0_integer = format / rt1011->r0_reg / 128;\n\t\tr0_factor = ((format / rt1011->r0_reg * 100) / 128)\n\t\t\t\t\t\t- (r0_integer * 100);\n\t\tdev_info(component->dev, \"DP r0 resistance about %d.%02d ohm, reg=0x%X\\n\",\n\t\t\tr0_integer, r0_factor, rt1011->r0_reg);\n\n\t\trt1011_r0_load(rt1011);\n\t}\n\n\tsnd_soc_component_write(component, RT1011_ADC_SET_1, 0x2925);\n}\n\nstatic int rt1011_parse_dp(struct rt1011_priv *rt1011, struct device *dev)\n{\n\tdevice_property_read_u32(dev, \"realtek,temperature_calib\",\n\t\t&rt1011->temperature_calib);\n\tdevice_property_read_u32(dev, \"realtek,r0_calib\",\n\t\t&rt1011->r0_calib);\n\n\tdev_dbg(dev, \"%s: r0_calib: 0x%x, temperature_calib: 0x%x\",\n\t\t__func__, rt1011->r0_calib, rt1011->temperature_calib);\n\n\treturn 0;\n}\n\nstatic int rt1011_i2c_probe(struct i2c_client *i2c)\n{\n\tstruct rt1011_priv *rt1011;\n\tint ret;\n\tunsigned int val;\n\n\trt1011 = devm_kzalloc(&i2c->dev, sizeof(struct rt1011_priv),\n\t\t\t\tGFP_KERNEL);\n\tif (!rt1011)\n\t\treturn -ENOMEM;\n\n\ti2c_set_clientdata(i2c, rt1011);\n\n\trt1011_parse_dp(rt1011, &i2c->dev);\n\n\trt1011->regmap = devm_regmap_init_i2c(i2c, &rt1011_regmap);\n\tif (IS_ERR(rt1011->regmap)) {\n\t\tret = PTR_ERR(rt1011->regmap);\n\t\tdev_err(&i2c->dev, \"Failed to allocate register map: %d\\n\",\n\t\t\tret);\n\t\treturn ret;\n\t}\n\n\tregmap_read(rt1011->regmap, RT1011_DEVICE_ID, &val);\n\tif (val != RT1011_DEVICE_ID_NUM) {\n\t\tdev_err(&i2c->dev,\n\t\t\t\"Device with ID register %x is not rt1011\\n\", val);\n\t\treturn -ENODEV;\n\t}\n\n\tINIT_WORK(&rt1011->cali_work, rt1011_calibration_work);\n\n\treturn devm_snd_soc_register_component(&i2c->dev,\n\t\t&soc_component_dev_rt1011,\n\t\trt1011_dai, ARRAY_SIZE(rt1011_dai));\n\n}\n\nstatic void rt1011_i2c_shutdown(struct i2c_client *client)\n{\n\tstruct rt1011_priv *rt1011 = i2c_get_clientdata(client);\n\n\trt1011_reset(rt1011->regmap);\n}\n\nstatic struct i2c_driver rt1011_i2c_driver = {\n\t.driver = {\n\t\t.name = \"rt1011\",\n\t\t.of_match_table = of_match_ptr(rt1011_of_match),\n\t\t.acpi_match_table = ACPI_PTR(rt1011_acpi_match)\n\t},\n\t.probe = rt1011_i2c_probe,\n\t.shutdown = rt1011_i2c_shutdown,\n\t.id_table = rt1011_i2c_id,\n};\nmodule_i2c_driver(rt1011_i2c_driver);\n\nMODULE_DESCRIPTION(\"ASoC RT1011 amplifier driver\");\nMODULE_AUTHOR(\"Shuming Fan <shumingf@realtek.com>\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}