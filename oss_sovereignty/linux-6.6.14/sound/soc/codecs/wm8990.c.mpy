{
  "module_name": "wm8990.c",
  "hash_id": "b5b60099a87770934df894141b8c487e715582597fe407f02b15aefd326516cf",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/codecs/wm8990.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/moduleparam.h>\n#include <linux/kernel.h>\n#include <linux/init.h>\n#include <linux/delay.h>\n#include <linux/pm.h>\n#include <linux/i2c.h>\n#include <linux/regmap.h>\n#include <linux/slab.h>\n#include <sound/core.h>\n#include <sound/pcm.h>\n#include <sound/pcm_params.h>\n#include <sound/soc.h>\n#include <sound/initval.h>\n#include <sound/tlv.h>\n#include <asm/div64.h>\n\n#include \"wm8990.h\"\n\n \nstruct wm8990_priv {\n\tstruct regmap *regmap;\n\tunsigned int sysclk;\n\tunsigned int pcmclk;\n};\n\n#define wm8990_reset(c) snd_soc_component_write(c, WM8990_RESET, 0)\n\nstatic const DECLARE_TLV_DB_SCALE(in_pga_tlv, -1650, 3000, 0);\n\nstatic const DECLARE_TLV_DB_SCALE(out_mix_tlv, 0, -2100, 0);\n\nstatic const DECLARE_TLV_DB_SCALE(out_pga_tlv, -7300, 600, 0);\n\nstatic const DECLARE_TLV_DB_SCALE(out_dac_tlv, -7163, 0, 0);\n\nstatic const DECLARE_TLV_DB_SCALE(in_adc_tlv, -7163, 1763, 0);\n\nstatic const DECLARE_TLV_DB_SCALE(out_sidetone_tlv, -3600, 0, 0);\n\nstatic int wm899x_outpga_put_volsw_vu(struct snd_kcontrol *kcontrol,\n\tstruct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_soc_component *component = snd_soc_kcontrol_component(kcontrol);\n\tstruct soc_mixer_control *mc =\n\t\t(struct soc_mixer_control *)kcontrol->private_value;\n\tint reg = mc->reg;\n\tint ret;\n\tu16 val;\n\n\tret = snd_soc_put_volsw(kcontrol, ucontrol);\n\tif (ret < 0)\n\t\treturn ret;\n\n\t \n\tval = snd_soc_component_read(component, reg);\n\treturn snd_soc_component_write(component, reg, val | 0x0100);\n}\n\n#define SOC_WM899X_OUTPGA_SINGLE_R_TLV(xname, reg, shift, max, invert,\\\n\ttlv_array) \\\n\tSOC_SINGLE_EXT_TLV(xname, reg, shift, max, invert, \\\n\t\tsnd_soc_get_volsw, wm899x_outpga_put_volsw_vu, tlv_array)\n\n\nstatic const char *wm8990_digital_sidetone[] =\n\t{\"None\", \"Left ADC\", \"Right ADC\", \"Reserved\"};\n\nstatic SOC_ENUM_SINGLE_DECL(wm8990_left_digital_sidetone_enum,\n\t\t\t    WM8990_DIGITAL_SIDE_TONE,\n\t\t\t    WM8990_ADC_TO_DACL_SHIFT,\n\t\t\t    wm8990_digital_sidetone);\n\nstatic SOC_ENUM_SINGLE_DECL(wm8990_right_digital_sidetone_enum,\n\t\t\t    WM8990_DIGITAL_SIDE_TONE,\n\t\t\t    WM8990_ADC_TO_DACR_SHIFT,\n\t\t\t    wm8990_digital_sidetone);\n\nstatic const char *wm8990_adcmode[] =\n\t{\"Hi-fi mode\", \"Voice mode 1\", \"Voice mode 2\", \"Voice mode 3\"};\n\nstatic SOC_ENUM_SINGLE_DECL(wm8990_right_adcmode_enum,\n\t\t\t    WM8990_ADC_CTRL,\n\t\t\t    WM8990_ADC_HPF_CUT_SHIFT,\n\t\t\t    wm8990_adcmode);\n\nstatic const struct snd_kcontrol_new wm8990_snd_controls[] = {\n \nSOC_SINGLE(\"LIN12 PGA Boost\", WM8990_INPUT_MIXER3, WM8990_L12MNBST_BIT, 1, 0),\nSOC_SINGLE(\"LIN34 PGA Boost\", WM8990_INPUT_MIXER3, WM8990_L34MNBST_BIT, 1, 0),\n \nSOC_SINGLE(\"RIN12 PGA Boost\", WM8990_INPUT_MIXER3, WM8990_R12MNBST_BIT, 1, 0),\nSOC_SINGLE(\"RIN34 PGA Boost\", WM8990_INPUT_MIXER3, WM8990_R34MNBST_BIT, 1, 0),\n\n \nSOC_SINGLE_TLV(\"LOMIX LIN3 Bypass Volume\", WM8990_OUTPUT_MIXER3,\n\tWM8990_LLI3LOVOL_SHIFT, WM8990_LLI3LOVOL_MASK, 1, out_mix_tlv),\nSOC_SINGLE_TLV(\"LOMIX RIN12 PGA Bypass Volume\", WM8990_OUTPUT_MIXER3,\n\tWM8990_LR12LOVOL_SHIFT, WM8990_LR12LOVOL_MASK, 1, out_mix_tlv),\nSOC_SINGLE_TLV(\"LOMIX LIN12 PGA Bypass Volume\", WM8990_OUTPUT_MIXER3,\n\tWM8990_LL12LOVOL_SHIFT, WM8990_LL12LOVOL_MASK, 1, out_mix_tlv),\nSOC_SINGLE_TLV(\"LOMIX RIN3 Bypass Volume\", WM8990_OUTPUT_MIXER5,\n\tWM8990_LRI3LOVOL_SHIFT, WM8990_LRI3LOVOL_MASK, 1, out_mix_tlv),\nSOC_SINGLE_TLV(\"LOMIX AINRMUX Bypass Volume\", WM8990_OUTPUT_MIXER5,\n\tWM8990_LRBLOVOL_SHIFT, WM8990_LRBLOVOL_MASK, 1, out_mix_tlv),\nSOC_SINGLE_TLV(\"LOMIX AINLMUX Bypass Volume\", WM8990_OUTPUT_MIXER5,\n\tWM8990_LRBLOVOL_SHIFT, WM8990_LRBLOVOL_MASK, 1, out_mix_tlv),\n\n \nSOC_SINGLE_TLV(\"ROMIX RIN3 Bypass Volume\", WM8990_OUTPUT_MIXER4,\n\tWM8990_RRI3ROVOL_SHIFT, WM8990_RRI3ROVOL_MASK, 1, out_mix_tlv),\nSOC_SINGLE_TLV(\"ROMIX LIN12 PGA Bypass Volume\", WM8990_OUTPUT_MIXER4,\n\tWM8990_RL12ROVOL_SHIFT, WM8990_RL12ROVOL_MASK, 1, out_mix_tlv),\nSOC_SINGLE_TLV(\"ROMIX RIN12 PGA Bypass Volume\", WM8990_OUTPUT_MIXER4,\n\tWM8990_RR12ROVOL_SHIFT, WM8990_RR12ROVOL_MASK, 1, out_mix_tlv),\nSOC_SINGLE_TLV(\"ROMIX LIN3 Bypass Volume\", WM8990_OUTPUT_MIXER6,\n\tWM8990_RLI3ROVOL_SHIFT, WM8990_RLI3ROVOL_MASK, 1, out_mix_tlv),\nSOC_SINGLE_TLV(\"ROMIX AINLMUX Bypass Volume\", WM8990_OUTPUT_MIXER6,\n\tWM8990_RLBROVOL_SHIFT, WM8990_RLBROVOL_MASK, 1, out_mix_tlv),\nSOC_SINGLE_TLV(\"ROMIX AINRMUX Bypass Volume\", WM8990_OUTPUT_MIXER6,\n\tWM8990_RRBROVOL_SHIFT, WM8990_RRBROVOL_MASK, 1, out_mix_tlv),\n\n \nSOC_WM899X_OUTPGA_SINGLE_R_TLV(\"LOUT Volume\", WM8990_LEFT_OUTPUT_VOLUME,\n\tWM8990_LOUTVOL_SHIFT, WM8990_LOUTVOL_MASK, 0, out_pga_tlv),\nSOC_SINGLE(\"LOUT ZC\", WM8990_LEFT_OUTPUT_VOLUME, WM8990_LOZC_BIT, 1, 0),\n\n \nSOC_WM899X_OUTPGA_SINGLE_R_TLV(\"ROUT Volume\", WM8990_RIGHT_OUTPUT_VOLUME,\n\tWM8990_ROUTVOL_SHIFT, WM8990_ROUTVOL_MASK, 0, out_pga_tlv),\nSOC_SINGLE(\"ROUT ZC\", WM8990_RIGHT_OUTPUT_VOLUME, WM8990_ROZC_BIT, 1, 0),\n\n \nSOC_WM899X_OUTPGA_SINGLE_R_TLV(\"LOPGA Volume\", WM8990_LEFT_OPGA_VOLUME,\n\tWM8990_LOPGAVOL_SHIFT, WM8990_LOPGAVOL_MASK, 0, out_pga_tlv),\nSOC_SINGLE(\"LOPGA ZC Switch\", WM8990_LEFT_OPGA_VOLUME,\n\tWM8990_LOPGAZC_BIT, 1, 0),\n\n \nSOC_WM899X_OUTPGA_SINGLE_R_TLV(\"ROPGA Volume\", WM8990_RIGHT_OPGA_VOLUME,\n\tWM8990_ROPGAVOL_SHIFT, WM8990_ROPGAVOL_MASK, 0, out_pga_tlv),\nSOC_SINGLE(\"ROPGA ZC Switch\", WM8990_RIGHT_OPGA_VOLUME,\n\tWM8990_ROPGAZC_BIT, 1, 0),\n\nSOC_SINGLE(\"LON Mute Switch\", WM8990_LINE_OUTPUTS_VOLUME,\n\tWM8990_LONMUTE_BIT, 1, 0),\nSOC_SINGLE(\"LOP Mute Switch\", WM8990_LINE_OUTPUTS_VOLUME,\n\tWM8990_LOPMUTE_BIT, 1, 0),\nSOC_SINGLE(\"LOP Attenuation Switch\", WM8990_LINE_OUTPUTS_VOLUME,\n\tWM8990_LOATTN_BIT, 1, 0),\nSOC_SINGLE(\"RON Mute Switch\", WM8990_LINE_OUTPUTS_VOLUME,\n\tWM8990_RONMUTE_BIT, 1, 0),\nSOC_SINGLE(\"ROP Mute Switch\", WM8990_LINE_OUTPUTS_VOLUME,\n\tWM8990_ROPMUTE_BIT, 1, 0),\nSOC_SINGLE(\"ROP Attenuation Switch\", WM8990_LINE_OUTPUTS_VOLUME,\n\tWM8990_ROATTN_BIT, 1, 0),\n\nSOC_SINGLE(\"OUT3 Mute Switch\", WM8990_OUT3_4_VOLUME,\n\tWM8990_OUT3MUTE_BIT, 1, 0),\nSOC_SINGLE(\"OUT3 Attenuation Switch\", WM8990_OUT3_4_VOLUME,\n\tWM8990_OUT3ATTN_BIT, 1, 0),\n\nSOC_SINGLE(\"OUT4 Mute Switch\", WM8990_OUT3_4_VOLUME,\n\tWM8990_OUT4MUTE_BIT, 1, 0),\nSOC_SINGLE(\"OUT4 Attenuation Switch\", WM8990_OUT3_4_VOLUME,\n\tWM8990_OUT4ATTN_BIT, 1, 0),\n\nSOC_SINGLE(\"Speaker Mode Switch\", WM8990_CLASSD1,\n\tWM8990_CDMODE_BIT, 1, 0),\n\nSOC_SINGLE(\"Speaker Output Attenuation Volume\", WM8990_SPEAKER_VOLUME,\n\tWM8990_SPKATTN_SHIFT, WM8990_SPKATTN_MASK, 0),\nSOC_SINGLE(\"Speaker DC Boost Volume\", WM8990_CLASSD3,\n\tWM8990_DCGAIN_SHIFT, WM8990_DCGAIN_MASK, 0),\nSOC_SINGLE(\"Speaker AC Boost Volume\", WM8990_CLASSD3,\n\tWM8990_ACGAIN_SHIFT, WM8990_ACGAIN_MASK, 0),\nSOC_SINGLE_TLV(\"Speaker Volume\", WM8990_CLASSD4,\n\tWM8990_SPKVOL_SHIFT, WM8990_SPKVOL_MASK, 0, out_pga_tlv),\nSOC_SINGLE(\"Speaker ZC Switch\", WM8990_CLASSD4,\n\tWM8990_SPKZC_SHIFT, WM8990_SPKZC_MASK, 0),\n\nSOC_WM899X_OUTPGA_SINGLE_R_TLV(\"Left DAC Digital Volume\",\n\tWM8990_LEFT_DAC_DIGITAL_VOLUME,\n\tWM8990_DACL_VOL_SHIFT,\n\tWM8990_DACL_VOL_MASK,\n\t0,\n\tout_dac_tlv),\n\nSOC_WM899X_OUTPGA_SINGLE_R_TLV(\"Right DAC Digital Volume\",\n\tWM8990_RIGHT_DAC_DIGITAL_VOLUME,\n\tWM8990_DACR_VOL_SHIFT,\n\tWM8990_DACR_VOL_MASK,\n\t0,\n\tout_dac_tlv),\n\nSOC_ENUM(\"Left Digital Sidetone\", wm8990_left_digital_sidetone_enum),\nSOC_ENUM(\"Right Digital Sidetone\", wm8990_right_digital_sidetone_enum),\n\nSOC_SINGLE_TLV(\"Left Digital Sidetone Volume\", WM8990_DIGITAL_SIDE_TONE,\n\tWM8990_ADCL_DAC_SVOL_SHIFT, WM8990_ADCL_DAC_SVOL_MASK, 0,\n\tout_sidetone_tlv),\nSOC_SINGLE_TLV(\"Right Digital Sidetone Volume\", WM8990_DIGITAL_SIDE_TONE,\n\tWM8990_ADCR_DAC_SVOL_SHIFT, WM8990_ADCR_DAC_SVOL_MASK, 0,\n\tout_sidetone_tlv),\n\nSOC_SINGLE(\"ADC Digital High Pass Filter Switch\", WM8990_ADC_CTRL,\n\tWM8990_ADC_HPF_ENA_BIT, 1, 0),\n\nSOC_ENUM(\"ADC HPF Mode\", wm8990_right_adcmode_enum),\n\nSOC_WM899X_OUTPGA_SINGLE_R_TLV(\"Left ADC Digital Volume\",\n\tWM8990_LEFT_ADC_DIGITAL_VOLUME,\n\tWM8990_ADCL_VOL_SHIFT,\n\tWM8990_ADCL_VOL_MASK,\n\t0,\n\tin_adc_tlv),\n\nSOC_WM899X_OUTPGA_SINGLE_R_TLV(\"Right ADC Digital Volume\",\n\tWM8990_RIGHT_ADC_DIGITAL_VOLUME,\n\tWM8990_ADCR_VOL_SHIFT,\n\tWM8990_ADCR_VOL_MASK,\n\t0,\n\tin_adc_tlv),\n\nSOC_WM899X_OUTPGA_SINGLE_R_TLV(\"LIN12 Volume\",\n\tWM8990_LEFT_LINE_INPUT_1_2_VOLUME,\n\tWM8990_LIN12VOL_SHIFT,\n\tWM8990_LIN12VOL_MASK,\n\t0,\n\tin_pga_tlv),\n\nSOC_SINGLE(\"LIN12 ZC Switch\", WM8990_LEFT_LINE_INPUT_1_2_VOLUME,\n\tWM8990_LI12ZC_BIT, 1, 0),\n\nSOC_SINGLE(\"LIN12 Mute Switch\", WM8990_LEFT_LINE_INPUT_1_2_VOLUME,\n\tWM8990_LI12MUTE_BIT, 1, 0),\n\nSOC_WM899X_OUTPGA_SINGLE_R_TLV(\"LIN34 Volume\",\n\tWM8990_LEFT_LINE_INPUT_3_4_VOLUME,\n\tWM8990_LIN34VOL_SHIFT,\n\tWM8990_LIN34VOL_MASK,\n\t0,\n\tin_pga_tlv),\n\nSOC_SINGLE(\"LIN34 ZC Switch\", WM8990_LEFT_LINE_INPUT_3_4_VOLUME,\n\tWM8990_LI34ZC_BIT, 1, 0),\n\nSOC_SINGLE(\"LIN34 Mute Switch\", WM8990_LEFT_LINE_INPUT_3_4_VOLUME,\n\tWM8990_LI34MUTE_BIT, 1, 0),\n\nSOC_WM899X_OUTPGA_SINGLE_R_TLV(\"RIN12 Volume\",\n\tWM8990_RIGHT_LINE_INPUT_1_2_VOLUME,\n\tWM8990_RIN12VOL_SHIFT,\n\tWM8990_RIN12VOL_MASK,\n\t0,\n\tin_pga_tlv),\n\nSOC_SINGLE(\"RIN12 ZC Switch\", WM8990_RIGHT_LINE_INPUT_1_2_VOLUME,\n\tWM8990_RI12ZC_BIT, 1, 0),\n\nSOC_SINGLE(\"RIN12 Mute Switch\", WM8990_RIGHT_LINE_INPUT_1_2_VOLUME,\n\tWM8990_RI12MUTE_BIT, 1, 0),\n\nSOC_WM899X_OUTPGA_SINGLE_R_TLV(\"RIN34 Volume\",\n\tWM8990_RIGHT_LINE_INPUT_3_4_VOLUME,\n\tWM8990_RIN34VOL_SHIFT,\n\tWM8990_RIN34VOL_MASK,\n\t0,\n\tin_pga_tlv),\n\nSOC_SINGLE(\"RIN34 ZC Switch\", WM8990_RIGHT_LINE_INPUT_3_4_VOLUME,\n\tWM8990_RI34ZC_BIT, 1, 0),\n\nSOC_SINGLE(\"RIN34 Mute Switch\", WM8990_RIGHT_LINE_INPUT_3_4_VOLUME,\n\tWM8990_RI34MUTE_BIT, 1, 0),\n\n};\n\n \n\nstatic int outmixer_event(struct snd_soc_dapm_widget *w,\n\tstruct snd_kcontrol *kcontrol, int event)\n{\n\tstruct snd_soc_component *component = snd_soc_dapm_to_component(w->dapm);\n\tu32 reg_shift = kcontrol->private_value & 0xfff;\n\tint ret = 0;\n\tu16 reg;\n\n\tswitch (reg_shift) {\n\tcase WM8990_SPEAKER_MIXER | (WM8990_LDSPK_BIT << 8) :\n\t\treg = snd_soc_component_read(component, WM8990_OUTPUT_MIXER1);\n\t\tif (reg & WM8990_LDLO) {\n\t\t\tprintk(KERN_WARNING\n\t\t\t\"Cannot set as Output Mixer 1 LDLO Set\\n\");\n\t\t\tret = -1;\n\t\t}\n\t\tbreak;\n\tcase WM8990_SPEAKER_MIXER | (WM8990_RDSPK_BIT << 8):\n\t\treg = snd_soc_component_read(component, WM8990_OUTPUT_MIXER2);\n\t\tif (reg & WM8990_RDRO) {\n\t\t\tprintk(KERN_WARNING\n\t\t\t\"Cannot set as Output Mixer 2 RDRO Set\\n\");\n\t\t\tret = -1;\n\t\t}\n\t\tbreak;\n\tcase WM8990_OUTPUT_MIXER1 | (WM8990_LDLO_BIT << 8):\n\t\treg = snd_soc_component_read(component, WM8990_SPEAKER_MIXER);\n\t\tif (reg & WM8990_LDSPK) {\n\t\t\tprintk(KERN_WARNING\n\t\t\t\"Cannot set as Speaker Mixer LDSPK Set\\n\");\n\t\t\tret = -1;\n\t\t}\n\t\tbreak;\n\tcase WM8990_OUTPUT_MIXER2 | (WM8990_RDRO_BIT << 8):\n\t\treg = snd_soc_component_read(component, WM8990_SPEAKER_MIXER);\n\t\tif (reg & WM8990_RDSPK) {\n\t\t\tprintk(KERN_WARNING\n\t\t\t\"Cannot set as Speaker Mixer RDSPK Set\\n\");\n\t\t\tret = -1;\n\t\t}\n\t\tbreak;\n\t}\n\n\treturn ret;\n}\n\n \nstatic const DECLARE_TLV_DB_SCALE(in_mix_tlv, -1200, 600, 0);\n\n \nstatic const struct snd_kcontrol_new wm8990_dapm_lin12_pga_controls[] = {\nSOC_DAPM_SINGLE(\"LIN1 Switch\", WM8990_INPUT_MIXER2, WM8990_LMN1_BIT, 1, 0),\nSOC_DAPM_SINGLE(\"LIN2 Switch\", WM8990_INPUT_MIXER2, WM8990_LMP2_BIT, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new wm8990_dapm_lin34_pga_controls[] = {\nSOC_DAPM_SINGLE(\"LIN3 Switch\", WM8990_INPUT_MIXER2, WM8990_LMN3_BIT, 1, 0),\nSOC_DAPM_SINGLE(\"LIN4 Switch\", WM8990_INPUT_MIXER2, WM8990_LMP4_BIT, 1, 0),\n};\n\n \nstatic const struct snd_kcontrol_new wm8990_dapm_rin12_pga_controls[] = {\nSOC_DAPM_SINGLE(\"RIN1 Switch\", WM8990_INPUT_MIXER2, WM8990_RMN1_BIT, 1, 0),\nSOC_DAPM_SINGLE(\"RIN2 Switch\", WM8990_INPUT_MIXER2, WM8990_RMP2_BIT, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new wm8990_dapm_rin34_pga_controls[] = {\nSOC_DAPM_SINGLE(\"RIN3 Switch\", WM8990_INPUT_MIXER2, WM8990_RMN3_BIT, 1, 0),\nSOC_DAPM_SINGLE(\"RIN4 Switch\", WM8990_INPUT_MIXER2, WM8990_RMP4_BIT, 1, 0),\n};\n\n \nstatic const struct snd_kcontrol_new wm8990_dapm_inmixl_controls[] = {\nSOC_DAPM_SINGLE_TLV(\"Record Left Volume\", WM8990_INPUT_MIXER3,\n\tWM8990_LDBVOL_SHIFT, WM8990_LDBVOL_MASK, 0, in_mix_tlv),\nSOC_DAPM_SINGLE_TLV(\"LIN2 Volume\", WM8990_INPUT_MIXER5, WM8990_LI2BVOL_SHIFT,\n\t7, 0, in_mix_tlv),\nSOC_DAPM_SINGLE(\"LINPGA12 Switch\", WM8990_INPUT_MIXER3, WM8990_L12MNB_BIT,\n\t1, 0),\nSOC_DAPM_SINGLE(\"LINPGA34 Switch\", WM8990_INPUT_MIXER3, WM8990_L34MNB_BIT,\n\t1, 0),\n};\n\n \nstatic const struct snd_kcontrol_new wm8990_dapm_inmixr_controls[] = {\nSOC_DAPM_SINGLE_TLV(\"Record Right Volume\", WM8990_INPUT_MIXER4,\n\tWM8990_RDBVOL_SHIFT, WM8990_RDBVOL_MASK, 0, in_mix_tlv),\nSOC_DAPM_SINGLE_TLV(\"RIN2 Volume\", WM8990_INPUT_MIXER6, WM8990_RI2BVOL_SHIFT,\n\t7, 0, in_mix_tlv),\nSOC_DAPM_SINGLE(\"RINPGA12 Switch\", WM8990_INPUT_MIXER3, WM8990_L12MNB_BIT,\n\t1, 0),\nSOC_DAPM_SINGLE(\"RINPGA34 Switch\", WM8990_INPUT_MIXER3, WM8990_L34MNB_BIT,\n\t1, 0),\n};\n\n \nstatic const char *wm8990_ainlmux[] =\n\t{\"INMIXL Mix\", \"RXVOICE Mix\", \"DIFFINL Mix\"};\n\nstatic SOC_ENUM_SINGLE_DECL(wm8990_ainlmux_enum,\n\t\t\t    WM8990_INPUT_MIXER1, WM8990_AINLMODE_SHIFT,\n\t\t\t    wm8990_ainlmux);\n\nstatic const struct snd_kcontrol_new wm8990_dapm_ainlmux_controls =\nSOC_DAPM_ENUM(\"Route\", wm8990_ainlmux_enum);\n\n \n\n \nstatic const char *wm8990_ainrmux[] =\n\t{\"INMIXR Mix\", \"RXVOICE Mix\", \"DIFFINR Mix\"};\n\nstatic SOC_ENUM_SINGLE_DECL(wm8990_ainrmux_enum,\n\t\t\t    WM8990_INPUT_MIXER1, WM8990_AINRMODE_SHIFT,\n\t\t\t    wm8990_ainrmux);\n\nstatic const struct snd_kcontrol_new wm8990_dapm_ainrmux_controls =\nSOC_DAPM_ENUM(\"Route\", wm8990_ainrmux_enum);\n\n \nstatic const struct snd_kcontrol_new wm8990_dapm_lomix_controls[] = {\nSOC_DAPM_SINGLE(\"LOMIX Right ADC Bypass Switch\", WM8990_OUTPUT_MIXER1,\n\tWM8990_LRBLO_BIT, 1, 0),\nSOC_DAPM_SINGLE(\"LOMIX Left ADC Bypass Switch\", WM8990_OUTPUT_MIXER1,\n\tWM8990_LLBLO_BIT, 1, 0),\nSOC_DAPM_SINGLE(\"LOMIX RIN3 Bypass Switch\", WM8990_OUTPUT_MIXER1,\n\tWM8990_LRI3LO_BIT, 1, 0),\nSOC_DAPM_SINGLE(\"LOMIX LIN3 Bypass Switch\", WM8990_OUTPUT_MIXER1,\n\tWM8990_LLI3LO_BIT, 1, 0),\nSOC_DAPM_SINGLE(\"LOMIX RIN12 PGA Bypass Switch\", WM8990_OUTPUT_MIXER1,\n\tWM8990_LR12LO_BIT, 1, 0),\nSOC_DAPM_SINGLE(\"LOMIX LIN12 PGA Bypass Switch\", WM8990_OUTPUT_MIXER1,\n\tWM8990_LL12LO_BIT, 1, 0),\nSOC_DAPM_SINGLE(\"LOMIX Left DAC Switch\", WM8990_OUTPUT_MIXER1,\n\tWM8990_LDLO_BIT, 1, 0),\n};\n\n \nstatic const struct snd_kcontrol_new wm8990_dapm_romix_controls[] = {\nSOC_DAPM_SINGLE(\"ROMIX Left ADC Bypass Switch\", WM8990_OUTPUT_MIXER2,\n\tWM8990_RLBRO_BIT, 1, 0),\nSOC_DAPM_SINGLE(\"ROMIX Right ADC Bypass Switch\", WM8990_OUTPUT_MIXER2,\n\tWM8990_RRBRO_BIT, 1, 0),\nSOC_DAPM_SINGLE(\"ROMIX LIN3 Bypass Switch\", WM8990_OUTPUT_MIXER2,\n\tWM8990_RLI3RO_BIT, 1, 0),\nSOC_DAPM_SINGLE(\"ROMIX RIN3 Bypass Switch\", WM8990_OUTPUT_MIXER2,\n\tWM8990_RRI3RO_BIT, 1, 0),\nSOC_DAPM_SINGLE(\"ROMIX LIN12 PGA Bypass Switch\", WM8990_OUTPUT_MIXER2,\n\tWM8990_RL12RO_BIT, 1, 0),\nSOC_DAPM_SINGLE(\"ROMIX RIN12 PGA Bypass Switch\", WM8990_OUTPUT_MIXER2,\n\tWM8990_RR12RO_BIT, 1, 0),\nSOC_DAPM_SINGLE(\"ROMIX Right DAC Switch\", WM8990_OUTPUT_MIXER2,\n\tWM8990_RDRO_BIT, 1, 0),\n};\n\n \nstatic const struct snd_kcontrol_new wm8990_dapm_lonmix_controls[] = {\nSOC_DAPM_SINGLE(\"LONMIX Left Mixer PGA Switch\", WM8990_LINE_MIXER1,\n\tWM8990_LLOPGALON_BIT, 1, 0),\nSOC_DAPM_SINGLE(\"LONMIX Right Mixer PGA Switch\", WM8990_LINE_MIXER1,\n\tWM8990_LROPGALON_BIT, 1, 0),\nSOC_DAPM_SINGLE(\"LONMIX Inverted LOP Switch\", WM8990_LINE_MIXER1,\n\tWM8990_LOPLON_BIT, 1, 0),\n};\n\n \nstatic const struct snd_kcontrol_new wm8990_dapm_lopmix_controls[] = {\nSOC_DAPM_SINGLE(\"LOPMIX Right Mic Bypass Switch\", WM8990_LINE_MIXER1,\n\tWM8990_LR12LOP_BIT, 1, 0),\nSOC_DAPM_SINGLE(\"LOPMIX Left Mic Bypass Switch\", WM8990_LINE_MIXER1,\n\tWM8990_LL12LOP_BIT, 1, 0),\nSOC_DAPM_SINGLE(\"LOPMIX Left Mixer PGA Switch\", WM8990_LINE_MIXER1,\n\tWM8990_LLOPGALOP_BIT, 1, 0),\n};\n\n \nstatic const struct snd_kcontrol_new wm8990_dapm_ronmix_controls[] = {\nSOC_DAPM_SINGLE(\"RONMIX Right Mixer PGA Switch\", WM8990_LINE_MIXER2,\n\tWM8990_RROPGARON_BIT, 1, 0),\nSOC_DAPM_SINGLE(\"RONMIX Left Mixer PGA Switch\", WM8990_LINE_MIXER2,\n\tWM8990_RLOPGARON_BIT, 1, 0),\nSOC_DAPM_SINGLE(\"RONMIX Inverted ROP Switch\", WM8990_LINE_MIXER2,\n\tWM8990_ROPRON_BIT, 1, 0),\n};\n\n \nstatic const struct snd_kcontrol_new wm8990_dapm_ropmix_controls[] = {\nSOC_DAPM_SINGLE(\"ROPMIX Left Mic Bypass Switch\", WM8990_LINE_MIXER2,\n\tWM8990_RL12ROP_BIT, 1, 0),\nSOC_DAPM_SINGLE(\"ROPMIX Right Mic Bypass Switch\", WM8990_LINE_MIXER2,\n\tWM8990_RR12ROP_BIT, 1, 0),\nSOC_DAPM_SINGLE(\"ROPMIX Right Mixer PGA Switch\", WM8990_LINE_MIXER2,\n\tWM8990_RROPGAROP_BIT, 1, 0),\n};\n\n \nstatic const struct snd_kcontrol_new wm8990_dapm_out3mix_controls[] = {\nSOC_DAPM_SINGLE(\"OUT3MIX LIN4/RXP Bypass Switch\", WM8990_OUT3_4_MIXER,\n\tWM8990_LI4O3_BIT, 1, 0),\nSOC_DAPM_SINGLE(\"OUT3MIX Left Out PGA Switch\", WM8990_OUT3_4_MIXER,\n\tWM8990_LPGAO3_BIT, 1, 0),\n};\n\n \nstatic const struct snd_kcontrol_new wm8990_dapm_out4mix_controls[] = {\nSOC_DAPM_SINGLE(\"OUT4MIX Right Out PGA Switch\", WM8990_OUT3_4_MIXER,\n\tWM8990_RPGAO4_BIT, 1, 0),\nSOC_DAPM_SINGLE(\"OUT4MIX RIN4/RXP Bypass Switch\", WM8990_OUT3_4_MIXER,\n\tWM8990_RI4O4_BIT, 1, 0),\n};\n\n \nstatic const struct snd_kcontrol_new wm8990_dapm_spkmix_controls[] = {\nSOC_DAPM_SINGLE(\"SPKMIX LIN2 Bypass Switch\", WM8990_SPEAKER_MIXER,\n\tWM8990_LI2SPK_BIT, 1, 0),\nSOC_DAPM_SINGLE(\"SPKMIX LADC Bypass Switch\", WM8990_SPEAKER_MIXER,\n\tWM8990_LB2SPK_BIT, 1, 0),\nSOC_DAPM_SINGLE(\"SPKMIX Left Mixer PGA Switch\", WM8990_SPEAKER_MIXER,\n\tWM8990_LOPGASPK_BIT, 1, 0),\nSOC_DAPM_SINGLE(\"SPKMIX Left DAC Switch\", WM8990_SPEAKER_MIXER,\n\tWM8990_LDSPK_BIT, 1, 0),\nSOC_DAPM_SINGLE(\"SPKMIX Right DAC Switch\", WM8990_SPEAKER_MIXER,\n\tWM8990_RDSPK_BIT, 1, 0),\nSOC_DAPM_SINGLE(\"SPKMIX Right Mixer PGA Switch\", WM8990_SPEAKER_MIXER,\n\tWM8990_ROPGASPK_BIT, 1, 0),\nSOC_DAPM_SINGLE(\"SPKMIX RADC Bypass Switch\", WM8990_SPEAKER_MIXER,\n\tWM8990_RL12ROP_BIT, 1, 0),\nSOC_DAPM_SINGLE(\"SPKMIX RIN2 Bypass Switch\", WM8990_SPEAKER_MIXER,\n\tWM8990_RI2SPK_BIT, 1, 0),\n};\n\nstatic const struct snd_soc_dapm_widget wm8990_dapm_widgets[] = {\n \n \nSND_SOC_DAPM_INPUT(\"LIN1\"),\nSND_SOC_DAPM_INPUT(\"LIN2\"),\nSND_SOC_DAPM_INPUT(\"LIN3\"),\nSND_SOC_DAPM_INPUT(\"LIN4/RXN\"),\nSND_SOC_DAPM_INPUT(\"RIN3\"),\nSND_SOC_DAPM_INPUT(\"RIN4/RXP\"),\nSND_SOC_DAPM_INPUT(\"RIN1\"),\nSND_SOC_DAPM_INPUT(\"RIN2\"),\nSND_SOC_DAPM_INPUT(\"Internal ADC Source\"),\n\nSND_SOC_DAPM_SUPPLY(\"INL\", WM8990_POWER_MANAGEMENT_2, WM8990_AINL_ENA_BIT, 0,\n\t\t    NULL, 0),\nSND_SOC_DAPM_SUPPLY(\"INR\", WM8990_POWER_MANAGEMENT_2, WM8990_AINR_ENA_BIT, 0,\n\t\t    NULL, 0),\n\n \nSND_SOC_DAPM_ADC(\"Left ADC\", \"Left Capture\", WM8990_POWER_MANAGEMENT_2,\n\tWM8990_ADCL_ENA_BIT, 0),\nSND_SOC_DAPM_ADC(\"Right ADC\", \"Right Capture\", WM8990_POWER_MANAGEMENT_2,\n\tWM8990_ADCR_ENA_BIT, 0),\n\n \nSND_SOC_DAPM_MIXER(\"LIN12 PGA\", WM8990_POWER_MANAGEMENT_2, WM8990_LIN12_ENA_BIT,\n\t0, &wm8990_dapm_lin12_pga_controls[0],\n\tARRAY_SIZE(wm8990_dapm_lin12_pga_controls)),\nSND_SOC_DAPM_MIXER(\"LIN34 PGA\", WM8990_POWER_MANAGEMENT_2, WM8990_LIN34_ENA_BIT,\n\t0, &wm8990_dapm_lin34_pga_controls[0],\n\tARRAY_SIZE(wm8990_dapm_lin34_pga_controls)),\nSND_SOC_DAPM_MIXER(\"RIN12 PGA\", WM8990_POWER_MANAGEMENT_2, WM8990_RIN12_ENA_BIT,\n\t0, &wm8990_dapm_rin12_pga_controls[0],\n\tARRAY_SIZE(wm8990_dapm_rin12_pga_controls)),\nSND_SOC_DAPM_MIXER(\"RIN34 PGA\", WM8990_POWER_MANAGEMENT_2, WM8990_RIN34_ENA_BIT,\n\t0, &wm8990_dapm_rin34_pga_controls[0],\n\tARRAY_SIZE(wm8990_dapm_rin34_pga_controls)),\n\n \nSND_SOC_DAPM_MIXER(\"INMIXL\", SND_SOC_NOPM, 0, 0,\n\t&wm8990_dapm_inmixl_controls[0],\n\tARRAY_SIZE(wm8990_dapm_inmixl_controls)),\n\n \nSND_SOC_DAPM_MUX(\"AINLMUX\", SND_SOC_NOPM, 0, 0, &wm8990_dapm_ainlmux_controls),\n\n \nSND_SOC_DAPM_MIXER(\"INMIXR\", SND_SOC_NOPM, 0, 0,\n\t&wm8990_dapm_inmixr_controls[0],\n\tARRAY_SIZE(wm8990_dapm_inmixr_controls)),\n\n \nSND_SOC_DAPM_MUX(\"AINRMUX\", SND_SOC_NOPM, 0, 0, &wm8990_dapm_ainrmux_controls),\n\n \n \nSND_SOC_DAPM_DAC(\"Left DAC\", \"Left Playback\", WM8990_POWER_MANAGEMENT_3,\n\tWM8990_DACL_ENA_BIT, 0),\nSND_SOC_DAPM_DAC(\"Right DAC\", \"Right Playback\", WM8990_POWER_MANAGEMENT_3,\n\tWM8990_DACR_ENA_BIT, 0),\n\n \nSND_SOC_DAPM_MIXER_E(\"LOMIX\", WM8990_POWER_MANAGEMENT_3, WM8990_LOMIX_ENA_BIT,\n\t0, &wm8990_dapm_lomix_controls[0],\n\tARRAY_SIZE(wm8990_dapm_lomix_controls),\n\toutmixer_event, SND_SOC_DAPM_PRE_REG),\n\n \nSND_SOC_DAPM_MIXER(\"LONMIX\", WM8990_POWER_MANAGEMENT_3, WM8990_LON_ENA_BIT, 0,\n\t&wm8990_dapm_lonmix_controls[0],\n\tARRAY_SIZE(wm8990_dapm_lonmix_controls)),\n\n \nSND_SOC_DAPM_MIXER(\"LOPMIX\", WM8990_POWER_MANAGEMENT_3, WM8990_LOP_ENA_BIT, 0,\n\t&wm8990_dapm_lopmix_controls[0],\n\tARRAY_SIZE(wm8990_dapm_lopmix_controls)),\n\n \nSND_SOC_DAPM_MIXER(\"OUT3MIX\", WM8990_POWER_MANAGEMENT_1, WM8990_OUT3_ENA_BIT, 0,\n\t&wm8990_dapm_out3mix_controls[0],\n\tARRAY_SIZE(wm8990_dapm_out3mix_controls)),\n\n \nSND_SOC_DAPM_MIXER_E(\"SPKMIX\", WM8990_POWER_MANAGEMENT_1, WM8990_SPK_ENA_BIT, 0,\n\t&wm8990_dapm_spkmix_controls[0],\n\tARRAY_SIZE(wm8990_dapm_spkmix_controls), outmixer_event,\n\tSND_SOC_DAPM_PRE_REG),\n\n \nSND_SOC_DAPM_MIXER(\"OUT4MIX\", WM8990_POWER_MANAGEMENT_1, WM8990_OUT4_ENA_BIT, 0,\n\t&wm8990_dapm_out4mix_controls[0],\n\tARRAY_SIZE(wm8990_dapm_out4mix_controls)),\n\n \nSND_SOC_DAPM_MIXER(\"ROPMIX\", WM8990_POWER_MANAGEMENT_3, WM8990_ROP_ENA_BIT, 0,\n\t&wm8990_dapm_ropmix_controls[0],\n\tARRAY_SIZE(wm8990_dapm_ropmix_controls)),\n\n \nSND_SOC_DAPM_MIXER(\"RONMIX\", WM8990_POWER_MANAGEMENT_3, WM8990_RON_ENA_BIT, 0,\n\t&wm8990_dapm_ronmix_controls[0],\n\tARRAY_SIZE(wm8990_dapm_ronmix_controls)),\n\n \nSND_SOC_DAPM_MIXER_E(\"ROMIX\", WM8990_POWER_MANAGEMENT_3, WM8990_ROMIX_ENA_BIT,\n\t0, &wm8990_dapm_romix_controls[0],\n\tARRAY_SIZE(wm8990_dapm_romix_controls),\n\toutmixer_event, SND_SOC_DAPM_PRE_REG),\n\n \nSND_SOC_DAPM_PGA(\"LOUT PGA\", WM8990_POWER_MANAGEMENT_1, WM8990_LOUT_ENA_BIT, 0,\n\tNULL, 0),\n\n \nSND_SOC_DAPM_PGA(\"ROUT PGA\", WM8990_POWER_MANAGEMENT_1, WM8990_ROUT_ENA_BIT, 0,\n\tNULL, 0),\n\n \nSND_SOC_DAPM_PGA(\"LOPGA\", WM8990_POWER_MANAGEMENT_3, WM8990_LOPGA_ENA_BIT, 0,\n\tNULL, 0),\n\n \nSND_SOC_DAPM_PGA(\"ROPGA\", WM8990_POWER_MANAGEMENT_3, WM8990_ROPGA_ENA_BIT, 0,\n\tNULL, 0),\n\n \nSND_SOC_DAPM_SUPPLY(\"MICBIAS\", WM8990_POWER_MANAGEMENT_1,\n\t\t    WM8990_MICBIAS_ENA_BIT, 0, NULL, 0),\n\nSND_SOC_DAPM_OUTPUT(\"LON\"),\nSND_SOC_DAPM_OUTPUT(\"LOP\"),\nSND_SOC_DAPM_OUTPUT(\"OUT3\"),\nSND_SOC_DAPM_OUTPUT(\"LOUT\"),\nSND_SOC_DAPM_OUTPUT(\"SPKN\"),\nSND_SOC_DAPM_OUTPUT(\"SPKP\"),\nSND_SOC_DAPM_OUTPUT(\"ROUT\"),\nSND_SOC_DAPM_OUTPUT(\"OUT4\"),\nSND_SOC_DAPM_OUTPUT(\"ROP\"),\nSND_SOC_DAPM_OUTPUT(\"RON\"),\n\nSND_SOC_DAPM_OUTPUT(\"Internal DAC Sink\"),\n};\n\nstatic const struct snd_soc_dapm_route wm8990_dapm_routes[] = {\n\t \n\t{\"Internal DAC Sink\", NULL, \"Left DAC\"},\n\t{\"Internal DAC Sink\", NULL, \"Right DAC\"},\n\n\t \n\t{\"Left ADC\", NULL, \"Internal ADC Source\"},\n\t{\"Right ADC\", NULL, \"Internal ADC Source\"},\n\n\t{\"AINLMUX\", NULL, \"INL\"},\n\t{\"INMIXL\", NULL, \"INL\"},\n\t{\"AINRMUX\", NULL, \"INR\"},\n\t{\"INMIXR\", NULL, \"INR\"},\n\n\t \n\t \n\t{\"LIN12 PGA\", \"LIN1 Switch\", \"LIN1\"},\n\t{\"LIN12 PGA\", \"LIN2 Switch\", \"LIN2\"},\n\t \n\t{\"LIN34 PGA\", \"LIN3 Switch\", \"LIN3\"},\n\t{\"LIN34 PGA\", \"LIN4 Switch\", \"LIN4/RXN\"},\n\t \n\t{\"INMIXL\", \"Record Left Volume\", \"LOMIX\"},\n\t{\"INMIXL\", \"LIN2 Volume\", \"LIN2\"},\n\t{\"INMIXL\", \"LINPGA12 Switch\", \"LIN12 PGA\"},\n\t{\"INMIXL\", \"LINPGA34 Switch\", \"LIN34 PGA\"},\n\t \n\t{\"AINLMUX\", \"INMIXL Mix\", \"INMIXL\"},\n\t{\"AINLMUX\", \"DIFFINL Mix\", \"LIN12 PGA\"},\n\t{\"AINLMUX\", \"DIFFINL Mix\", \"LIN34 PGA\"},\n\t{\"AINLMUX\", \"RXVOICE Mix\", \"LIN4/RXN\"},\n\t{\"AINLMUX\", \"RXVOICE Mix\", \"RIN4/RXP\"},\n\t \n\t{\"Left ADC\", NULL, \"AINLMUX\"},\n\n\t \n\t{\"RIN12 PGA\", \"RIN1 Switch\", \"RIN1\"},\n\t{\"RIN12 PGA\", \"RIN2 Switch\", \"RIN2\"},\n\t \n\t{\"RIN34 PGA\", \"RIN3 Switch\", \"RIN3\"},\n\t{\"RIN34 PGA\", \"RIN4 Switch\", \"RIN4/RXP\"},\n\t \n\t{\"INMIXR\", \"Record Right Volume\", \"ROMIX\"},\n\t{\"INMIXR\", \"RIN2 Volume\", \"RIN2\"},\n\t{\"INMIXR\", \"RINPGA12 Switch\", \"RIN12 PGA\"},\n\t{\"INMIXR\", \"RINPGA34 Switch\", \"RIN34 PGA\"},\n\t \n\t{\"AINRMUX\", \"INMIXR Mix\", \"INMIXR\"},\n\t{\"AINRMUX\", \"DIFFINR Mix\", \"RIN12 PGA\"},\n\t{\"AINRMUX\", \"DIFFINR Mix\", \"RIN34 PGA\"},\n\t{\"AINRMUX\", \"RXVOICE Mix\", \"LIN4/RXN\"},\n\t{\"AINRMUX\", \"RXVOICE Mix\", \"RIN4/RXP\"},\n\t \n\t{\"Right ADC\", NULL, \"AINRMUX\"},\n\n\t \n\t{\"LOMIX\", \"LOMIX RIN3 Bypass Switch\", \"RIN3\"},\n\t{\"LOMIX\", \"LOMIX LIN3 Bypass Switch\", \"LIN3\"},\n\t{\"LOMIX\", \"LOMIX LIN12 PGA Bypass Switch\", \"LIN12 PGA\"},\n\t{\"LOMIX\", \"LOMIX RIN12 PGA Bypass Switch\", \"RIN12 PGA\"},\n\t{\"LOMIX\", \"LOMIX Right ADC Bypass Switch\", \"AINRMUX\"},\n\t{\"LOMIX\", \"LOMIX Left ADC Bypass Switch\", \"AINLMUX\"},\n\t{\"LOMIX\", \"LOMIX Left DAC Switch\", \"Left DAC\"},\n\n\t \n\t{\"ROMIX\", \"ROMIX RIN3 Bypass Switch\", \"RIN3\"},\n\t{\"ROMIX\", \"ROMIX LIN3 Bypass Switch\", \"LIN3\"},\n\t{\"ROMIX\", \"ROMIX LIN12 PGA Bypass Switch\", \"LIN12 PGA\"},\n\t{\"ROMIX\", \"ROMIX RIN12 PGA Bypass Switch\", \"RIN12 PGA\"},\n\t{\"ROMIX\", \"ROMIX Right ADC Bypass Switch\", \"AINRMUX\"},\n\t{\"ROMIX\", \"ROMIX Left ADC Bypass Switch\", \"AINLMUX\"},\n\t{\"ROMIX\", \"ROMIX Right DAC Switch\", \"Right DAC\"},\n\n\t \n\t{\"SPKMIX\", \"SPKMIX LIN2 Bypass Switch\", \"LIN2\"},\n\t{\"SPKMIX\", \"SPKMIX RIN2 Bypass Switch\", \"RIN2\"},\n\t{\"SPKMIX\", \"SPKMIX LADC Bypass Switch\", \"AINLMUX\"},\n\t{\"SPKMIX\", \"SPKMIX RADC Bypass Switch\", \"AINRMUX\"},\n\t{\"SPKMIX\", \"SPKMIX Left Mixer PGA Switch\", \"LOPGA\"},\n\t{\"SPKMIX\", \"SPKMIX Right Mixer PGA Switch\", \"ROPGA\"},\n\t{\"SPKMIX\", \"SPKMIX Right DAC Switch\", \"Right DAC\"},\n\t{\"SPKMIX\", \"SPKMIX Left DAC Switch\", \"Left DAC\"},\n\n\t \n\t{\"LONMIX\", \"LONMIX Left Mixer PGA Switch\", \"LOPGA\"},\n\t{\"LONMIX\", \"LONMIX Right Mixer PGA Switch\", \"ROPGA\"},\n\t{\"LONMIX\", \"LONMIX Inverted LOP Switch\", \"LOPMIX\"},\n\n\t \n\t{\"LOPMIX\", \"LOPMIX Right Mic Bypass Switch\", \"RIN12 PGA\"},\n\t{\"LOPMIX\", \"LOPMIX Left Mic Bypass Switch\", \"LIN12 PGA\"},\n\t{\"LOPMIX\", \"LOPMIX Left Mixer PGA Switch\", \"LOPGA\"},\n\n\t \n\t{\"OUT3MIX\", \"OUT3MIX LIN4/RXP Bypass Switch\", \"LIN4/RXN\"},\n\t{\"OUT3MIX\", \"OUT3MIX Left Out PGA Switch\", \"LOPGA\"},\n\n\t \n\t{\"OUT4MIX\", \"OUT4MIX Right Out PGA Switch\", \"ROPGA\"},\n\t{\"OUT4MIX\", \"OUT4MIX RIN4/RXP Bypass Switch\", \"RIN4/RXP\"},\n\n\t \n\t{\"RONMIX\", \"RONMIX Right Mixer PGA Switch\", \"ROPGA\"},\n\t{\"RONMIX\", \"RONMIX Left Mixer PGA Switch\", \"LOPGA\"},\n\t{\"RONMIX\", \"RONMIX Inverted ROP Switch\", \"ROPMIX\"},\n\n\t \n\t{\"ROPMIX\", \"ROPMIX Left Mic Bypass Switch\", \"LIN12 PGA\"},\n\t{\"ROPMIX\", \"ROPMIX Right Mic Bypass Switch\", \"RIN12 PGA\"},\n\t{\"ROPMIX\", \"ROPMIX Right Mixer PGA Switch\", \"ROPGA\"},\n\n\t \n\t{\"LOPGA\", NULL, \"LOMIX\"},\n\t{\"ROPGA\", NULL, \"ROMIX\"},\n\n\t{\"LOUT PGA\", NULL, \"LOMIX\"},\n\t{\"ROUT PGA\", NULL, \"ROMIX\"},\n\n\t \n\t{\"LON\", NULL, \"LONMIX\"},\n\t{\"LOP\", NULL, \"LOPMIX\"},\n\t{\"OUT3\", NULL, \"OUT3MIX\"},\n\t{\"LOUT\", NULL, \"LOUT PGA\"},\n\t{\"SPKN\", NULL, \"SPKMIX\"},\n\t{\"ROUT\", NULL, \"ROUT PGA\"},\n\t{\"OUT4\", NULL, \"OUT4MIX\"},\n\t{\"ROP\", NULL, \"ROPMIX\"},\n\t{\"RON\", NULL, \"RONMIX\"},\n};\n\n \nstruct _pll_div {\n\tu32 div2;\n\tu32 n;\n\tu32 k;\n};\n\n \n#define FIXED_PLL_SIZE ((1 << 16) * 10)\n\nstatic void pll_factors(struct _pll_div *pll_div, unsigned int target,\n\tunsigned int source)\n{\n\tu64 Kpart;\n\tunsigned int K, Ndiv, Nmod;\n\n\n\tNdiv = target / source;\n\tif (Ndiv < 6) {\n\t\tsource >>= 1;\n\t\tpll_div->div2 = 1;\n\t\tNdiv = target / source;\n\t} else\n\t\tpll_div->div2 = 0;\n\n\tif ((Ndiv < 6) || (Ndiv > 12))\n\t\tprintk(KERN_WARNING\n\t\t\"WM8990 N value outwith recommended range! N = %u\\n\", Ndiv);\n\n\tpll_div->n = Ndiv;\n\tNmod = target % source;\n\tKpart = FIXED_PLL_SIZE * (long long)Nmod;\n\n\tdo_div(Kpart, source);\n\n\tK = Kpart & 0xFFFFFFFF;\n\n\t \n\tif ((K % 10) >= 5)\n\t\tK += 5;\n\n\t \n\tK /= 10;\n\n\tpll_div->k = K;\n}\n\nstatic int wm8990_set_dai_pll(struct snd_soc_dai *codec_dai, int pll_id,\n\t\tint source, unsigned int freq_in, unsigned int freq_out)\n{\n\tstruct snd_soc_component *component = codec_dai->component;\n\tstruct _pll_div pll_div;\n\n\tif (freq_in && freq_out) {\n\t\tpll_factors(&pll_div, freq_out * 4, freq_in);\n\n\t\t \n\t\tsnd_soc_component_update_bits(component, WM8990_POWER_MANAGEMENT_2,\n\t\t\t\t    WM8990_PLL_ENA, WM8990_PLL_ENA);\n\n\t\t \n\t\tsnd_soc_component_update_bits(component, WM8990_CLOCKING_2,\n\t\t\t\t    WM8990_SYSCLK_SRC, WM8990_SYSCLK_SRC);\n\n\t\t \n\t\tsnd_soc_component_write(component, WM8990_PLL1, pll_div.n | WM8990_SDM |\n\t\t\t(pll_div.div2?WM8990_PRESCALE:0));\n\t\tsnd_soc_component_write(component, WM8990_PLL2, (u8)(pll_div.k>>8));\n\t\tsnd_soc_component_write(component, WM8990_PLL3, (u8)(pll_div.k & 0xFF));\n\t} else {\n\t\t \n\t\tsnd_soc_component_update_bits(component, WM8990_POWER_MANAGEMENT_2,\n\t\t\t\t    WM8990_PLL_ENA, 0);\n\t}\n\treturn 0;\n}\n\n \nstatic int wm8990_set_dai_sysclk(struct snd_soc_dai *codec_dai,\n\t\tint clk_id, unsigned int freq, int dir)\n{\n\tstruct snd_soc_component *component = codec_dai->component;\n\tstruct wm8990_priv *wm8990 = snd_soc_component_get_drvdata(component);\n\n\twm8990->sysclk = freq;\n\treturn 0;\n}\n\n \nstatic int wm8990_set_dai_fmt(struct snd_soc_dai *codec_dai,\n\t\tunsigned int fmt)\n{\n\tstruct snd_soc_component *component = codec_dai->component;\n\tu16 audio1, audio3;\n\n\taudio1 = snd_soc_component_read(component, WM8990_AUDIO_INTERFACE_1);\n\taudio3 = snd_soc_component_read(component, WM8990_AUDIO_INTERFACE_3);\n\n\t \n\tswitch (fmt & SND_SOC_DAIFMT_MASTER_MASK) {\n\tcase SND_SOC_DAIFMT_CBS_CFS:\n\t\taudio3 &= ~WM8990_AIF_MSTR1;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_CBM_CFM:\n\t\taudio3 |= WM8990_AIF_MSTR1;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\taudio1 &= ~WM8990_AIF_FMT_MASK;\n\n\t \n\tswitch (fmt & SND_SOC_DAIFMT_FORMAT_MASK) {\n\tcase SND_SOC_DAIFMT_I2S:\n\t\taudio1 |= WM8990_AIF_TMF_I2S;\n\t\taudio1 &= ~WM8990_AIF_LRCLK_INV;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_RIGHT_J:\n\t\taudio1 |= WM8990_AIF_TMF_RIGHTJ;\n\t\taudio1 &= ~WM8990_AIF_LRCLK_INV;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_LEFT_J:\n\t\taudio1 |= WM8990_AIF_TMF_LEFTJ;\n\t\taudio1 &= ~WM8990_AIF_LRCLK_INV;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_DSP_A:\n\t\taudio1 |= WM8990_AIF_TMF_DSP;\n\t\taudio1 &= ~WM8990_AIF_LRCLK_INV;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_DSP_B:\n\t\taudio1 |= WM8990_AIF_TMF_DSP | WM8990_AIF_LRCLK_INV;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tsnd_soc_component_write(component, WM8990_AUDIO_INTERFACE_1, audio1);\n\tsnd_soc_component_write(component, WM8990_AUDIO_INTERFACE_3, audio3);\n\treturn 0;\n}\n\nstatic int wm8990_set_dai_clkdiv(struct snd_soc_dai *codec_dai,\n\t\tint div_id, int div)\n{\n\tstruct snd_soc_component *component = codec_dai->component;\n\n\tswitch (div_id) {\n\tcase WM8990_MCLK_DIV:\n\t\tsnd_soc_component_update_bits(component, WM8990_CLOCKING_2,\n\t\t\t\t    WM8990_MCLK_DIV_MASK, div);\n\t\tbreak;\n\tcase WM8990_DACCLK_DIV:\n\t\tsnd_soc_component_update_bits(component, WM8990_CLOCKING_2,\n\t\t\t\t    WM8990_DAC_CLKDIV_MASK, div);\n\t\tbreak;\n\tcase WM8990_ADCCLK_DIV:\n\t\tsnd_soc_component_update_bits(component, WM8990_CLOCKING_2,\n\t\t\t\t    WM8990_ADC_CLKDIV_MASK, div);\n\t\tbreak;\n\tcase WM8990_BCLK_DIV:\n\t\tsnd_soc_component_update_bits(component, WM8990_CLOCKING_1,\n\t\t\t\t    WM8990_BCLK_DIV_MASK, div);\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\treturn 0;\n}\n\n \nstatic int wm8990_hw_params(struct snd_pcm_substream *substream,\n\t\t\t    struct snd_pcm_hw_params *params,\n\t\t\t    struct snd_soc_dai *dai)\n{\n\tstruct snd_soc_component *component = dai->component;\n\tu16 audio1 = snd_soc_component_read(component, WM8990_AUDIO_INTERFACE_1);\n\n\taudio1 &= ~WM8990_AIF_WL_MASK;\n\t \n\tswitch (params_width(params)) {\n\tcase 16:\n\t\tbreak;\n\tcase 20:\n\t\taudio1 |= WM8990_AIF_WL_20BITS;\n\t\tbreak;\n\tcase 24:\n\t\taudio1 |= WM8990_AIF_WL_24BITS;\n\t\tbreak;\n\tcase 32:\n\t\taudio1 |= WM8990_AIF_WL_32BITS;\n\t\tbreak;\n\t}\n\n\tsnd_soc_component_write(component, WM8990_AUDIO_INTERFACE_1, audio1);\n\treturn 0;\n}\n\nstatic int wm8990_mute(struct snd_soc_dai *dai, int mute, int direction)\n{\n\tstruct snd_soc_component *component = dai->component;\n\tu16 val;\n\n\tval  = snd_soc_component_read(component, WM8990_DAC_CTRL) & ~WM8990_DAC_MUTE;\n\n\tif (mute)\n\t\tsnd_soc_component_write(component, WM8990_DAC_CTRL, val | WM8990_DAC_MUTE);\n\telse\n\t\tsnd_soc_component_write(component, WM8990_DAC_CTRL, val);\n\n\treturn 0;\n}\n\nstatic int wm8990_set_bias_level(struct snd_soc_component *component,\n\tenum snd_soc_bias_level level)\n{\n\tstruct wm8990_priv *wm8990 = snd_soc_component_get_drvdata(component);\n\tint ret;\n\n\tswitch (level) {\n\tcase SND_SOC_BIAS_ON:\n\t\tbreak;\n\n\tcase SND_SOC_BIAS_PREPARE:\n\t\t \n\t\tsnd_soc_component_update_bits(component, WM8990_POWER_MANAGEMENT_1,\n\t\t\t\t    WM8990_VMID_MODE_MASK, 0x2);\n\t\tbreak;\n\n\tcase SND_SOC_BIAS_STANDBY:\n\t\tif (snd_soc_component_get_bias_level(component) == SND_SOC_BIAS_OFF) {\n\t\t\tret = regcache_sync(wm8990->regmap);\n\t\t\tif (ret < 0) {\n\t\t\t\tdev_err(component->dev, \"Failed to sync cache: %d\\n\", ret);\n\t\t\t\treturn ret;\n\t\t\t}\n\n\t\t\t \n\t\t\tsnd_soc_component_write(component, WM8990_ANTIPOP1, WM8990_DIS_LLINE |\n\t\t\t\tWM8990_DIS_RLINE | WM8990_DIS_OUT3 |\n\t\t\t\tWM8990_DIS_OUT4 | WM8990_DIS_LOUT |\n\t\t\t\tWM8990_DIS_ROUT);\n\n\t\t\t \n\t\t\tsnd_soc_component_write(component, WM8990_ANTIPOP2, WM8990_SOFTST |\n\t\t\t\t     WM8990_BUFDCOPEN | WM8990_POBCTRL |\n\t\t\t\t     WM8990_VMIDTOG);\n\n\t\t\t \n\t\t\tmsleep(300);\n\n\t\t\t \n\t\t\tsnd_soc_component_write(component, WM8990_ANTIPOP2, WM8990_SOFTST |\n\t\t\t\t     WM8990_BUFDCOPEN | WM8990_POBCTRL);\n\n\t\t\t \n\t\t\tsnd_soc_component_write(component, WM8990_ANTIPOP1, 0);\n\n\t\t\t \n\t\t\tsnd_soc_component_write(component, WM8990_POWER_MANAGEMENT_1, 0x1b00);\n\n\t\t\tmsleep(50);\n\n\t\t\t \n\t\t\tsnd_soc_component_write(component, WM8990_POWER_MANAGEMENT_1, 0x1f02);\n\n\t\t\tmsleep(100);\n\n\t\t\t \n\t\t\tsnd_soc_component_write(component, WM8990_POWER_MANAGEMENT_1, 0x1f03);\n\n\t\t\tmsleep(600);\n\n\t\t\t \n\t\t\tsnd_soc_component_write(component, WM8990_ANTIPOP2, WM8990_SOFTST |\n\t\t\t\t     WM8990_BUFDCOPEN | WM8990_POBCTRL |\n\t\t\t\t     WM8990_BUFIOEN);\n\n\t\t\t \n\t\t\tsnd_soc_component_write(component, WM8990_POWER_MANAGEMENT_1, 0x3);\n\n\t\t\t \n\t\t\tsnd_soc_component_write(component, WM8990_ANTIPOP2, WM8990_BUFIOEN);\n\n\t\t\t \n\t\t\tsnd_soc_component_write(component, WM8990_EXT_ACCESS_ENA, 0x2);\n\t\t\tsnd_soc_component_write(component, WM8990_EXT_CTL1, 0xa003);\n\t\t\tsnd_soc_component_write(component, WM8990_EXT_ACCESS_ENA, 0);\n\t\t}\n\n\t\t \n\t\tsnd_soc_component_update_bits(component, WM8990_POWER_MANAGEMENT_1,\n\t\t\t\t    WM8990_VMID_MODE_MASK, 0x4);\n\t\tbreak;\n\n\tcase SND_SOC_BIAS_OFF:\n\t\t \n\t\tsnd_soc_component_write(component, WM8990_ANTIPOP2, WM8990_SOFTST |\n\t\t\tWM8990_POBCTRL | WM8990_BUFIOEN);\n\n\t\t \n\t\tsnd_soc_component_write(component, WM8990_ANTIPOP2, WM8990_SOFTST |\n\t\t\tWM8990_BUFDCOPEN | WM8990_POBCTRL |\n\t\t\tWM8990_BUFIOEN);\n\n\t\t \n\t\tsnd_soc_component_update_bits(component, WM8990_DAC_CTRL,\n\t\t\t\t    WM8990_DAC_MUTE, WM8990_DAC_MUTE);\n\n\t\t \n\t\tsnd_soc_component_write(component, WM8990_POWER_MANAGEMENT_1, 0x1f03);\n\n\t\t \n\t\tsnd_soc_component_write(component, WM8990_POWER_MANAGEMENT_1, 0x1f01);\n\n\t\tmsleep(300);\n\n\t\t \n\t\tsnd_soc_component_write(component, WM8990_ANTIPOP1, WM8990_DIS_LLINE |\n\t\t\tWM8990_DIS_RLINE | WM8990_DIS_OUT3 |\n\t\t\tWM8990_DIS_OUT4 | WM8990_DIS_LOUT |\n\t\t\tWM8990_DIS_ROUT);\n\n\t\t \n\t\tsnd_soc_component_write(component, WM8990_POWER_MANAGEMENT_1, 0x0);\n\n\t\t \n\t\tsnd_soc_component_write(component, WM8990_ANTIPOP2, 0x0);\n\n\t\tregcache_mark_dirty(wm8990->regmap);\n\t\tbreak;\n\t}\n\n\treturn 0;\n}\n\n#define WM8990_RATES (SNDRV_PCM_RATE_8000 | SNDRV_PCM_RATE_11025 |\\\n\tSNDRV_PCM_RATE_16000 | SNDRV_PCM_RATE_22050 | SNDRV_PCM_RATE_44100 | \\\n\tSNDRV_PCM_RATE_48000)\n\n#define WM8990_FORMATS (SNDRV_PCM_FMTBIT_S16_LE | SNDRV_PCM_FMTBIT_S20_3LE |\\\n\tSNDRV_PCM_FMTBIT_S24_LE | SNDRV_PCM_FMTBIT_S32_LE)\n\n \nstatic const struct snd_soc_dai_ops wm8990_dai_ops = {\n\t.hw_params\t= wm8990_hw_params,\n\t.mute_stream\t= wm8990_mute,\n\t.set_fmt\t= wm8990_set_dai_fmt,\n\t.set_clkdiv\t= wm8990_set_dai_clkdiv,\n\t.set_pll\t= wm8990_set_dai_pll,\n\t.set_sysclk\t= wm8990_set_dai_sysclk,\n\t.no_capture_mute = 1,\n};\n\nstatic struct snd_soc_dai_driver wm8990_dai = {\n \n\t.name = \"wm8990-hifi\",\n\t.playback = {\n\t\t.stream_name = \"Playback\",\n\t\t.channels_min = 1,\n\t\t.channels_max = 2,\n\t\t.rates = WM8990_RATES,\n\t\t.formats = WM8990_FORMATS,},\n\t.capture = {\n\t\t.stream_name = \"Capture\",\n\t\t.channels_min = 1,\n\t\t.channels_max = 2,\n\t\t.rates = WM8990_RATES,\n\t\t.formats = WM8990_FORMATS,},\n\t.ops = &wm8990_dai_ops,\n};\n\n \nstatic int wm8990_probe(struct snd_soc_component *component)\n{\n\twm8990_reset(component);\n\n\t \n\tsnd_soc_component_force_bias_level(component, SND_SOC_BIAS_STANDBY);\n\n\tsnd_soc_component_update_bits(component, WM8990_AUDIO_INTERFACE_4,\n\t\t\t    WM8990_ALRCGPIO1, WM8990_ALRCGPIO1);\n\n\tsnd_soc_component_update_bits(component, WM8990_GPIO1_GPIO2,\n\t\t\t    WM8990_GPIO1_SEL_MASK, 1);\n\n\tsnd_soc_component_update_bits(component, WM8990_POWER_MANAGEMENT_2,\n\t\t\t    WM8990_OPCLK_ENA, WM8990_OPCLK_ENA);\n\n\tsnd_soc_component_write(component, WM8990_LEFT_OUTPUT_VOLUME, 0x50 | (1<<8));\n\tsnd_soc_component_write(component, WM8990_RIGHT_OUTPUT_VOLUME, 0x50 | (1<<8));\n\n\treturn 0;\n}\n\nstatic const struct snd_soc_component_driver soc_component_dev_wm8990 = {\n\t.probe\t\t\t= wm8990_probe,\n\t.set_bias_level\t\t= wm8990_set_bias_level,\n\t.controls\t\t= wm8990_snd_controls,\n\t.num_controls\t\t= ARRAY_SIZE(wm8990_snd_controls),\n\t.dapm_widgets\t\t= wm8990_dapm_widgets,\n\t.num_dapm_widgets\t= ARRAY_SIZE(wm8990_dapm_widgets),\n\t.dapm_routes\t\t= wm8990_dapm_routes,\n\t.num_dapm_routes\t= ARRAY_SIZE(wm8990_dapm_routes),\n\t.suspend_bias_off\t= 1,\n\t.idle_bias_on\t\t= 1,\n\t.use_pmdown_time\t= 1,\n\t.endianness\t\t= 1,\n};\n\nstatic int wm8990_i2c_probe(struct i2c_client *i2c)\n{\n\tstruct wm8990_priv *wm8990;\n\tint ret;\n\n\twm8990 = devm_kzalloc(&i2c->dev, sizeof(struct wm8990_priv),\n\t\t\t      GFP_KERNEL);\n\tif (wm8990 == NULL)\n\t\treturn -ENOMEM;\n\n\ti2c_set_clientdata(i2c, wm8990);\n\n\tret = devm_snd_soc_register_component(&i2c->dev,\n\t\t\t&soc_component_dev_wm8990, &wm8990_dai, 1);\n\n\treturn ret;\n}\n\nstatic const struct i2c_device_id wm8990_i2c_id[] = {\n\t{ \"wm8990\", 0 },\n\t{ }\n};\nMODULE_DEVICE_TABLE(i2c, wm8990_i2c_id);\n\nstatic struct i2c_driver wm8990_i2c_driver = {\n\t.driver = {\n\t\t.name = \"wm8990\",\n\t},\n\t.probe = wm8990_i2c_probe,\n\t.id_table = wm8990_i2c_id,\n};\n\nmodule_i2c_driver(wm8990_i2c_driver);\n\nMODULE_DESCRIPTION(\"ASoC WM8990 driver\");\nMODULE_AUTHOR(\"Liam Girdwood\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}