{
  "module_name": "wm8962.c",
  "hash_id": "0ea63aed5ced3ae834c7dea812c4eff9387cdb4038ea001c64e5e07858acc81f",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/codecs/wm8962.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/moduleparam.h>\n#include <linux/init.h>\n#include <linux/clk.h>\n#include <linux/delay.h>\n#include <linux/pm.h>\n#include <linux/gcd.h>\n#include <linux/gpio/driver.h>\n#include <linux/i2c.h>\n#include <linux/input.h>\n#include <linux/pm_runtime.h>\n#include <linux/regmap.h>\n#include <linux/regulator/consumer.h>\n#include <linux/slab.h>\n#include <linux/workqueue.h>\n#include <linux/mutex.h>\n#include <sound/core.h>\n#include <sound/jack.h>\n#include <sound/pcm.h>\n#include <sound/pcm_params.h>\n#include <sound/soc.h>\n#include <sound/initval.h>\n#include <sound/tlv.h>\n#include <sound/wm8962.h>\n#include <trace/events/asoc.h>\n\n#include \"wm8962.h\"\n\n#define WM8962_NUM_SUPPLIES 8\nstatic const char *wm8962_supply_names[WM8962_NUM_SUPPLIES] = {\n\t\"DCVDD\",\n\t\"DBVDD\",\n\t\"AVDD\",\n\t\"CPVDD\",\n\t\"MICVDD\",\n\t\"PLLVDD\",\n\t\"SPKVDD1\",\n\t\"SPKVDD2\",\n};\n\n \nstruct wm8962_priv {\n\tstruct wm8962_pdata pdata;\n\tstruct regmap *regmap;\n\tstruct snd_soc_component *component;\n\n\tint sysclk;\n\tint sysclk_rate;\n\n\tint bclk;   \n\tint lrclk;\n\n\tstruct completion fll_lock;\n\tint fll_src;\n\tint fll_fref;\n\tint fll_fout;\n\n\tstruct mutex dsp2_ena_lock;\n\tu16 dsp2_ena;\n\n\tstruct delayed_work mic_work;\n\tstruct snd_soc_jack *jack;\n\n\tstruct regulator_bulk_data supplies[WM8962_NUM_SUPPLIES];\n\tstruct notifier_block disable_nb[WM8962_NUM_SUPPLIES];\n\n\tstruct input_dev *beep;\n\tstruct work_struct beep_work;\n\tint beep_rate;\n\n#ifdef CONFIG_GPIOLIB\n\tstruct gpio_chip gpio_chip;\n#endif\n\n\tint irq;\n};\n\n \n#define WM8962_REGULATOR_EVENT(n) \\\nstatic int wm8962_regulator_event_##n(struct notifier_block *nb, \\\n\t\t\t\t    unsigned long event, void *data)\t\\\n{ \\\n\tstruct wm8962_priv *wm8962 = container_of(nb, struct wm8962_priv, \\\n\t\t\t\t\t\t  disable_nb[n]); \\\n\tif (event & REGULATOR_EVENT_DISABLE) { \\\n\t\tregcache_mark_dirty(wm8962->regmap);\t\\\n\t} \\\n\treturn 0; \\\n}\n\nWM8962_REGULATOR_EVENT(0)\nWM8962_REGULATOR_EVENT(1)\nWM8962_REGULATOR_EVENT(2)\nWM8962_REGULATOR_EVENT(3)\nWM8962_REGULATOR_EVENT(4)\nWM8962_REGULATOR_EVENT(5)\nWM8962_REGULATOR_EVENT(6)\nWM8962_REGULATOR_EVENT(7)\n\nstatic const struct reg_default wm8962_reg[] = {\n\t{ 0, 0x009F },    \n\t{ 1, 0x049F },    \n\t{ 2, 0x0000 },    \n\t{ 3, 0x0000 },    \n\n\t{ 5, 0x0018 },    \n\t{ 6, 0x2008 },    \n\t{ 7, 0x000A },    \n\t{ 8, 0x01E4 },    \n\t{ 9, 0x0300 },    \n\t{ 10, 0x00C0 },   \n\t{ 11, 0x00C0 },   \n\n\t{ 14, 0x0040 },    \n\t{ 15, 0x6243 },    \n\n\t{ 17, 0x007B },    \n\t{ 18, 0x0000 },    \n\t{ 19, 0x1C32 },    \n\t{ 20, 0x3200 },    \n\t{ 21, 0x00C0 },    \n\t{ 22, 0x00C0 },    \n\t{ 23, 0x0160 },    \n\t{ 24, 0x0000 },    \n\t{ 25, 0x0000 },    \n\t{ 26, 0x0000 },    \n\t{ 27, 0x0010 },    \n\t{ 28, 0x0000 },    \n\n\t{ 30, 0x005E },    \n\t{ 31, 0x0000 },    \n\t{ 32, 0x0145 },    \n\t{ 33, 0x0145 },    \n\t{ 34, 0x0009 },    \n\t{ 35, 0x0003 },    \n\t{ 37, 0x0008 },    \n\t{ 38, 0x0008 },    \n\n\t{ 40, 0x0000 },    \n\t{ 41, 0x0000 },    \n\n\t{ 49, 0x0010 },    \n\t{ 51, 0x0003 },    \n\n\t{ 56, 0x0506 },    \n\t{ 57, 0x0000 },    \n\t{ 58, 0x0000 },    \n\n\t{ 60, 0x0300 },    \n\t{ 61, 0x0300 },    \n\n\t{ 64, 0x0810 },    \n\n\t{ 68, 0x001B },    \n\t{ 69, 0x0000 },    \n\n\t{ 71, 0x01FB },    \n\t{ 72, 0x0000 },    \n\n\t{ 82, 0x0004 },    \n\n\t{ 87, 0x0000 },    \n\n\t{ 90, 0x0000 },    \n\n\t{ 93, 0x0000 },    \n\t{ 94, 0x0000 },    \n\n\t{ 99, 0x0000 },    \n\t{ 100, 0x0000 },    \n\t{ 101, 0x0000 },    \n\t{ 102, 0x013F },    \n\t{ 103, 0x013F },    \n\n\t{ 105, 0x0000 },    \n\t{ 106, 0x0000 },    \n\t{ 107, 0x013F },    \n\t{ 108, 0x013F },    \n\t{ 109, 0x0003 },    \n\t{ 110, 0x0002 },    \n\n\t{ 115, 0x0006 },    \n\t{ 116, 0x0026 },    \n\n\t{ 119, 0x0000 },    \n\n\t{ 124, 0x0011 },    \n\t{ 125, 0x004B },    \n\t{ 126, 0x000D },    \n\t{ 127, 0x0000 },    \n\n\t{ 131, 0x0000 },    \n\n\t{ 136, 0x0067 },    \n\t{ 137, 0x001C },    \n\t{ 138, 0x0071 },    \n\t{ 139, 0x00C7 },    \n\t{ 140, 0x0067 },    \n\t{ 141, 0x0048 },    \n\t{ 142, 0x0022 },    \n\t{ 143, 0x0097 },    \n\n\t{ 155, 0x000C },    \n\t{ 156, 0x0039 },    \n\t{ 157, 0x0180 },    \n\n\t{ 159, 0x0032 },    \n\t{ 160, 0x0018 },    \n\t{ 161, 0x007D },    \n\t{ 162, 0x0008 },    \n\n\t{ 252, 0x0005 },    \n\n\t{ 256, 0x0000 },    \n\t{ 257, 0x0000 },    \n\t{ 258, 0x0000 },    \n\t{ 259, 0x0000 },    \n\t{ 260, 0x0000 },    \n\t{ 261, 0x0000 },    \n\t{ 262, 0x0000 },    \n\n\t{ 264, 0x0000 },    \n\t{ 265, 0x0000 },    \n\n\t{ 268, 0x0000 },    \n\t{ 269, 0x0000 },    \n\t{ 270, 0x0000 },    \n\t{ 271, 0x0000 },    \n\n\t{ 276, 0x000C },    \n\t{ 277, 0x0925 },    \n\t{ 278, 0x0000 },    \n\t{ 279, 0x0000 },    \n\t{ 280, 0x0000 },    \n\n\t{ 285, 0x0000 },    \n\n\t{ 335, 0x0004 },    \n\t{ 336, 0x6318 },    \n\t{ 337, 0x6300 },    \n\t{ 338, 0x0FCA },    \n\t{ 339, 0x0400 },    \n\t{ 340, 0x00D8 },    \n\t{ 341, 0x1EB5 },    \n\t{ 342, 0xF145 },    \n\t{ 343, 0x0B75 },    \n\t{ 344, 0x01C5 },    \n\t{ 345, 0x1C58 },    \n\t{ 346, 0xF373 },    \n\t{ 347, 0x0A54 },    \n\t{ 348, 0x0558 },    \n\t{ 349, 0x168E },    \n\t{ 350, 0xF829 },    \n\t{ 351, 0x07AD },    \n\t{ 352, 0x1103 },    \n\t{ 353, 0x0564 },    \n\t{ 354, 0x0559 },    \n\t{ 355, 0x4000 },    \n\t{ 356, 0x6318 },    \n\t{ 357, 0x6300 },    \n\t{ 358, 0x0FCA },    \n\t{ 359, 0x0400 },    \n\t{ 360, 0x00D8 },    \n\t{ 361, 0x1EB5 },    \n\t{ 362, 0xF145 },    \n\t{ 363, 0x0B75 },    \n\t{ 364, 0x01C5 },    \n\t{ 365, 0x1C58 },    \n\t{ 366, 0xF373 },    \n\t{ 367, 0x0A54 },    \n\t{ 368, 0x0558 },    \n\t{ 369, 0x168E },    \n\t{ 370, 0xF829 },    \n\t{ 371, 0x07AD },    \n\t{ 372, 0x1103 },    \n\t{ 373, 0x0564 },    \n\t{ 374, 0x0559 },    \n\t{ 375, 0x4000 },    \n\n\t{ 513, 0x0000 },    \n\t{ 514, 0x0000 },    \n\n\t{ 516, 0x8100 },    \n\t{ 517, 0x8100 },    \n\n\t{ 568, 0x0030 },    \n\t{ 569, 0xFFED },    \n\n\t{ 576, 0x0000 },    \n\n\t{ 584, 0x002D },    \n\n\t{ 586, 0x0000 },    \n\n\t{ 768, 0x1C00 },    \n\n\t{ 8192, 0x0000 },    \n\n\t{ 9216, 0x0030 },    \n\t{ 9217, 0x0000 },    \n\t{ 9218, 0x0000 },    \n\n\t{ 12288, 0x0000 },    \n\t{ 12289, 0x0000 },    \n\n\t{ 13312, 0x0000 },    \n\t{ 13313, 0x0000 },    \n\n\t{ 14336, 0x0000 },    \n\t{ 14337, 0x0000 },    \n\n\t{ 15360, 0x000A },    \n\n\t{ 16384, 0x0000 },    \n\t{ 16385, 0x0000 },    \n\t{ 16386, 0x0000 },    \n\t{ 16387, 0x0000 },    \n\t{ 16388, 0x0000 },    \n\t{ 16389, 0x0000 },    \n\n\t{ 16896, 0x0002 },    \n\t{ 16897, 0xBD12 },    \n\t{ 16898, 0x007C },    \n\t{ 16899, 0x586C },    \n\t{ 16900, 0x0053 },    \n\t{ 16901, 0x8121 },    \n\t{ 16902, 0x003F },    \n\t{ 16903, 0x8BD8 },    \n\t{ 16904, 0x0032 },    \n\t{ 16905, 0xF52D },    \n\t{ 16906, 0x0065 },    \n\t{ 16907, 0xAC8C },    \n\t{ 16908, 0x006B },    \n\t{ 16909, 0xE087 },    \n\t{ 16910, 0x0072 },    \n\t{ 16911, 0x1483 },    \n\t{ 16912, 0x0072 },    \n\t{ 16913, 0x1483 },    \n\t{ 16914, 0x0043 },    \n\t{ 16915, 0x3525 },    \n\t{ 16916, 0x0006 },    \n\t{ 16917, 0x6A4A },    \n\t{ 16918, 0x0043 },    \n\t{ 16919, 0x6079 },    \n\t{ 16920, 0x0008 },    \n\t{ 16921, 0x0000 },    \n\t{ 16922, 0x0001 },    \n\t{ 16923, 0x0000 },    \n\t{ 16924, 0x0059 },    \n\t{ 16925, 0x999A },    \n\n\t{ 17408, 0x0083 },    \n\t{ 17409, 0x98AD },    \n\n\t{ 17920, 0x007F },    \n\t{ 17921, 0xFFFF },    \n\t{ 17922, 0x0000 },    \n\t{ 17923, 0x0000 },    \n\t{ 17924, 0x0000 },    \n\t{ 17925, 0x0000 },    \n\t{ 17926, 0x0000 },    \n\t{ 17927, 0x0000 },    \n\t{ 17928, 0x0000 },    \n\t{ 17929, 0x0000 },    \n\t{ 17930, 0x0000 },    \n\t{ 17931, 0x0000 },    \n\t{ 17932, 0x0000 },    \n\t{ 17933, 0x0000 },    \n\t{ 17934, 0x0000 },    \n\t{ 17935, 0x0000 },    \n\t{ 17936, 0x0000 },    \n\t{ 17937, 0x0000 },    \n\t{ 17938, 0x0000 },    \n\t{ 17939, 0x0000 },    \n\t{ 17940, 0x0000 },    \n\t{ 17941, 0x0000 },    \n\t{ 17942, 0x0000 },    \n\t{ 17943, 0x0000 },    \n\t{ 17944, 0x0000 },    \n\t{ 17945, 0x0000 },    \n\t{ 17946, 0x0000 },    \n\t{ 17947, 0x0000 },    \n\t{ 17948, 0x0000 },    \n\t{ 17949, 0x0000 },    \n\t{ 17950, 0x0000 },    \n\t{ 17951, 0x0000 },    \n\t{ 17952, 0x0000 },    \n\t{ 17953, 0x0000 },    \n\t{ 17954, 0x0000 },    \n\t{ 17955, 0x0000 },    \n\t{ 17956, 0x0000 },    \n\t{ 17957, 0x0000 },    \n\t{ 17958, 0x0000 },    \n\t{ 17959, 0x0000 },    \n\t{ 17960, 0x0000 },    \n\t{ 17961, 0x0000 },    \n\t{ 17962, 0x0000 },    \n\t{ 17963, 0x0000 },    \n\t{ 17964, 0x0000 },    \n\t{ 17965, 0x0000 },    \n\t{ 17966, 0x0000 },    \n\t{ 17967, 0x0000 },    \n\t{ 17968, 0x0000 },    \n\t{ 17969, 0x0000 },    \n\t{ 17970, 0x0000 },    \n\t{ 17971, 0x0000 },    \n\t{ 17972, 0x0000 },    \n\t{ 17973, 0x0000 },    \n\t{ 17974, 0x0000 },    \n\t{ 17975, 0x0000 },    \n\t{ 17976, 0x0000 },    \n\t{ 17977, 0x0000 },    \n\t{ 17978, 0x0000 },    \n\t{ 17979, 0x0000 },    \n\t{ 17980, 0x0000 },    \n\t{ 17981, 0x0000 },    \n\t{ 17982, 0x0000 },    \n\t{ 17983, 0x0000 },    \n\n\t{ 18432, 0x0020 },    \n\t{ 18433, 0x0000 },    \n\t{ 18434, 0x0040 },    \n\t{ 18435, 0x0000 },    \n\n\t{ 18944, 0x007F },    \n\t{ 18945, 0xFFFF },    \n\t{ 18946, 0x0000 },    \n\t{ 18947, 0x0000 },    \n\t{ 18948, 0x0000 },    \n\t{ 18949, 0x0000 },    \n\t{ 18950, 0x0000 },    \n\t{ 18951, 0x0000 },    \n\t{ 18952, 0x0000 },    \n\t{ 18953, 0x0000 },    \n\t{ 18954, 0x0000 },    \n\t{ 18955, 0x0000 },    \n\t{ 18956, 0x0000 },    \n\t{ 18957, 0x0000 },    \n\t{ 18958, 0x0000 },    \n\t{ 18959, 0x0000 },    \n\t{ 18960, 0x0000 },    \n\t{ 18961, 0x0000 },    \n\t{ 18962, 0x0000 },    \n\t{ 18963, 0x0000 },    \n\t{ 18964, 0x0000 },    \n\t{ 18965, 0x0000 },    \n\t{ 18966, 0x0000 },    \n\t{ 18967, 0x0000 },    \n\t{ 18968, 0x0000 },    \n\t{ 18969, 0x0000 },    \n\t{ 18970, 0x0000 },    \n\t{ 18971, 0x0000 },    \n\t{ 18972, 0x0000 },    \n\t{ 18973, 0x0000 },    \n\t{ 18974, 0x0000 },    \n\t{ 18975, 0x0000 },    \n\t{ 18976, 0x0000 },    \n\t{ 18977, 0x0000 },    \n\t{ 18978, 0x0000 },    \n\t{ 18979, 0x0000 },    \n\t{ 18980, 0x0000 },    \n\t{ 18981, 0x0000 },    \n\t{ 18982, 0x0000 },    \n\t{ 18983, 0x0000 },    \n\t{ 18984, 0x0000 },    \n\t{ 18985, 0x0000 },    \n\t{ 18986, 0x0000 },    \n\t{ 18987, 0x0000 },    \n\t{ 18988, 0x0000 },    \n\t{ 18989, 0x0000 },    \n\t{ 18990, 0x0000 },    \n\t{ 18991, 0x0000 },    \n\t{ 18992, 0x0000 },    \n\t{ 18993, 0x0000 },    \n\t{ 18994, 0x0000 },    \n\t{ 18995, 0x0000 },    \n\t{ 18996, 0x0000 },    \n\t{ 18997, 0x0000 },    \n\t{ 18998, 0x0000 },    \n\t{ 18999, 0x0000 },    \n\t{ 19000, 0x0000 },    \n\t{ 19001, 0x0000 },    \n\t{ 19002, 0x0000 },    \n\t{ 19003, 0x0000 },    \n\t{ 19004, 0x0000 },    \n\t{ 19005, 0x0000 },    \n\t{ 19006, 0x0000 },    \n\t{ 19007, 0x0000 },    \n\n\t{ 19456, 0x007F },    \n\t{ 19457, 0xFFFF },    \n\t{ 19458, 0x0000 },    \n\t{ 19459, 0x0000 },    \n\t{ 19460, 0x0000 },    \n\t{ 19461, 0x0000 },    \n\t{ 19462, 0x0000 },    \n\t{ 19463, 0x0000 },    \n\t{ 19464, 0x0000 },    \n\t{ 19465, 0x0000 },    \n\t{ 19466, 0x0000 },    \n\t{ 19467, 0x0000 },    \n\t{ 19468, 0x0000 },    \n\t{ 19469, 0x0000 },    \n\t{ 19470, 0x0000 },    \n\t{ 19471, 0x0000 },    \n\t{ 19472, 0x0000 },    \n\t{ 19473, 0x0000 },    \n\t{ 19474, 0x0000 },    \n\t{ 19475, 0x0000 },    \n\t{ 19476, 0x0000 },    \n\t{ 19477, 0x0000 },    \n\t{ 19478, 0x0000 },    \n\t{ 19479, 0x0000 },    \n\t{ 19480, 0x0000 },    \n\t{ 19481, 0x0000 },    \n\t{ 19482, 0x0000 },    \n\t{ 19483, 0x0000 },    \n\t{ 19484, 0x0000 },    \n\t{ 19485, 0x0000 },    \n\t{ 19486, 0x0000 },    \n\t{ 19487, 0x0000 },    \n\t{ 19488, 0x0000 },    \n\t{ 19489, 0x0000 },    \n\t{ 19490, 0x0000 },    \n\t{ 19491, 0x0000 },    \n\t{ 19492, 0x0000 },    \n\t{ 19493, 0x0000 },    \n\t{ 19494, 0x0000 },    \n\t{ 19495, 0x0000 },    \n\t{ 19496, 0x0000 },    \n\t{ 19497, 0x0000 },    \n\t{ 19498, 0x0000 },    \n\t{ 19499, 0x0000 },    \n\t{ 19500, 0x0000 },    \n\t{ 19501, 0x0000 },    \n\t{ 19502, 0x0000 },    \n\t{ 19503, 0x0000 },    \n\t{ 19504, 0x0000 },    \n\t{ 19505, 0x0000 },    \n\t{ 19506, 0x0000 },    \n\t{ 19507, 0x0000 },    \n\t{ 19508, 0x0000 },    \n\t{ 19509, 0x0000 },    \n\t{ 19510, 0x0000 },    \n\t{ 19511, 0x0000 },    \n\t{ 19512, 0x0000 },    \n\t{ 19513, 0x0000 },    \n\t{ 19514, 0x0000 },    \n\t{ 19515, 0x0000 },    \n\t{ 19516, 0x0000 },    \n\t{ 19517, 0x0000 },    \n\t{ 19518, 0x0000 },    \n\t{ 19519, 0x0000 },    \n\n\t{ 19968, 0x0020 },    \n\t{ 19969, 0x0000 },    \n\t{ 19970, 0x0040 },    \n\t{ 19971, 0x0000 },    \n\n\t{ 20480, 0x007F },    \n\t{ 20481, 0xFFFF },    \n\t{ 20482, 0x0000 },    \n\t{ 20483, 0x0000 },    \n\t{ 20484, 0x0000 },    \n\t{ 20485, 0x0000 },    \n\t{ 20486, 0x0000 },    \n\t{ 20487, 0x0000 },    \n\t{ 20488, 0x0000 },    \n\t{ 20489, 0x0000 },    \n\t{ 20490, 0x0000 },    \n\t{ 20491, 0x0000 },    \n\t{ 20492, 0x0000 },    \n\t{ 20493, 0x0000 },    \n\t{ 20494, 0x0000 },    \n\t{ 20495, 0x0000 },    \n\t{ 20496, 0x0000 },    \n\t{ 20497, 0x0000 },    \n\t{ 20498, 0x0000 },    \n\t{ 20499, 0x0000 },    \n\t{ 20500, 0x0000 },    \n\t{ 20501, 0x0000 },    \n\t{ 20502, 0x0000 },    \n\t{ 20503, 0x0000 },    \n\t{ 20504, 0x0000 },    \n\t{ 20505, 0x0000 },    \n\t{ 20506, 0x0000 },    \n\t{ 20507, 0x0000 },    \n\t{ 20508, 0x0000 },    \n\t{ 20509, 0x0000 },    \n\t{ 20510, 0x0000 },    \n\t{ 20511, 0x0000 },    \n\t{ 20512, 0x0000 },    \n\t{ 20513, 0x0000 },    \n\t{ 20514, 0x0000 },    \n\t{ 20515, 0x0000 },    \n\t{ 20516, 0x0000 },    \n\t{ 20517, 0x0000 },    \n\t{ 20518, 0x0000 },    \n\t{ 20519, 0x0000 },    \n\t{ 20520, 0x0000 },    \n\t{ 20521, 0x0000 },    \n\t{ 20522, 0x0000 },    \n\t{ 20523, 0x0000 },    \n\t{ 20524, 0x0000 },    \n\t{ 20525, 0x0000 },    \n\t{ 20526, 0x0000 },    \n\t{ 20527, 0x0000 },    \n\t{ 20528, 0x0000 },    \n\t{ 20529, 0x0000 },    \n\t{ 20530, 0x0000 },    \n\t{ 20531, 0x0000 },    \n\t{ 20532, 0x0000 },    \n\t{ 20533, 0x0000 },    \n\t{ 20534, 0x0000 },    \n\t{ 20535, 0x0000 },    \n\t{ 20536, 0x0000 },    \n\t{ 20537, 0x0000 },    \n\t{ 20538, 0x0000 },    \n\t{ 20539, 0x0000 },    \n\t{ 20540, 0x0000 },    \n\t{ 20541, 0x0000 },    \n\t{ 20542, 0x0000 },    \n\t{ 20543, 0x0000 },    \n\n\t{ 20992, 0x008C },    \n\t{ 20993, 0x0200 },    \n\t{ 20994, 0x0035 },    \n\t{ 20995, 0x0700 },    \n\t{ 20996, 0x003A },    \n\t{ 20997, 0x4100 },    \n\t{ 20998, 0x008B },    \n\t{ 20999, 0x7D00 },    \n\t{ 21000, 0x003A },    \n\t{ 21001, 0x4100 },    \n\t{ 21002, 0x008C },    \n\t{ 21003, 0xFEE8 },    \n\t{ 21004, 0x0078 },    \n\t{ 21005, 0x0000 },    \n\t{ 21006, 0x003F },    \n\t{ 21007, 0xB260 },    \n\t{ 21008, 0x002D },    \n\t{ 21009, 0x1818 },    \n\t{ 21010, 0x0020 },    \n\t{ 21011, 0x0000 },    \n\t{ 21012, 0x00F1 },    \n\t{ 21013, 0x8340 },    \n\t{ 21014, 0x00FB },    \n\t{ 21015, 0x8300 },    \n\t{ 21016, 0x00EE },    \n\t{ 21017, 0xAEC0 },    \n\t{ 21018, 0x00FB },    \n\t{ 21019, 0xAC40 },    \n\t{ 21020, 0x00F1 },    \n\t{ 21021, 0x7F80 },    \n\t{ 21022, 0x00F4 },    \n\t{ 21023, 0x3B40 },    \n\t{ 21024, 0x00F5 },    \n\t{ 21025, 0xFB00 },    \n\t{ 21026, 0x00EA },    \n\t{ 21027, 0x10C0 },    \n\t{ 21028, 0x00FC },    \n\t{ 21029, 0xC580 },    \n\t{ 21030, 0x00E2 },    \n\t{ 21031, 0x75C0 },    \n\t{ 21032, 0x0004 },    \n\t{ 21033, 0xB480 },    \n\t{ 21034, 0x00D4 },    \n\t{ 21035, 0xF980 },    \n\t{ 21036, 0x0004 },    \n\t{ 21037, 0x9140 },    \n\t{ 21038, 0x00D8 },    \n\t{ 21039, 0xA480 },    \n\t{ 21040, 0x0002 },    \n\t{ 21041, 0x3DC0 },    \n\t{ 21042, 0x00CF },    \n\t{ 21043, 0x7A80 },    \n\t{ 21044, 0x00DC },    \n\t{ 21045, 0x0600 },    \n\t{ 21046, 0x00F2 },    \n\t{ 21047, 0xDAC0 },    \n\t{ 21048, 0x00BA },    \n\t{ 21049, 0xF340 },    \n\t{ 21050, 0x000A },    \n\t{ 21051, 0x7940 },    \n\t{ 21052, 0x001C },    \n\t{ 21053, 0x0680 },    \n\t{ 21054, 0x00FD },    \n\t{ 21055, 0x2D00 },    \n\t{ 21056, 0x001C },    \n\t{ 21057, 0xE840 },    \n\t{ 21058, 0x000D },    \n\t{ 21059, 0xDC40 },    \n\t{ 21060, 0x00FC },    \n\t{ 21061, 0x9D00 },    \n\t{ 21062, 0x0009 },    \n\t{ 21063, 0x5580 },    \n\t{ 21064, 0x00FE },    \n\t{ 21065, 0x7E80 },    \n\t{ 21066, 0x000E },    \n\t{ 21067, 0xAB40 },    \n\t{ 21068, 0x00F9 },    \n\t{ 21069, 0x9880 },    \n\t{ 21070, 0x0009 },    \n\t{ 21071, 0x87C0 },    \n\t{ 21072, 0x00FD },    \n\t{ 21073, 0x2C40 },    \n\t{ 21074, 0x0009 },    \n\t{ 21075, 0x4800 },    \n\t{ 21076, 0x0003 },    \n\t{ 21077, 0x5F40 },    \n\t{ 21078, 0x0000 },    \n\t{ 21079, 0x8700 },    \n\t{ 21080, 0x00FA },    \n\t{ 21081, 0xE4C0 },    \n\t{ 21082, 0x0000 },    \n\t{ 21083, 0x0B40 },    \n\t{ 21084, 0x0004 },    \n\t{ 21085, 0xE180 },    \n\t{ 21086, 0x0001 },    \n\t{ 21087, 0x1F40 },    \n\t{ 21088, 0x00F8 },    \n\t{ 21089, 0xB000 },    \n\t{ 21090, 0x00FB },    \n\t{ 21091, 0xCBC0 },    \n\t{ 21092, 0x0004 },    \n\t{ 21093, 0xF380 },    \n\t{ 21094, 0x0007 },    \n\t{ 21095, 0xDF40 },    \n\t{ 21096, 0x00FF },    \n\t{ 21097, 0x0700 },    \n\t{ 21098, 0x00EF },    \n\t{ 21099, 0xD700 },    \n\t{ 21100, 0x00FB },    \n\t{ 21101, 0xAF40 },    \n\t{ 21102, 0x0010 },    \n\t{ 21103, 0x8A80 },    \n\t{ 21104, 0x0011 },    \n\t{ 21105, 0x07C0 },    \n\t{ 21106, 0x00E0 },    \n\t{ 21107, 0x0800 },    \n\t{ 21108, 0x00D2 },    \n\t{ 21109, 0x7600 },    \n\t{ 21110, 0x0020 },    \n\t{ 21111, 0xCF40 },    \n\t{ 21112, 0x0030 },    \n\t{ 21113, 0x2340 },    \n\t{ 21114, 0x00FD },    \n\t{ 21115, 0x69C0 },    \n\t{ 21116, 0x0028 },    \n\t{ 21117, 0x3500 },    \n\t{ 21118, 0x0006 },    \n\t{ 21119, 0x3300 },    \n\t{ 21120, 0x00D9 },    \n\t{ 21121, 0xF6C0 },    \n\t{ 21122, 0x00F3 },    \n\t{ 21123, 0x3340 },    \n\t{ 21124, 0x000F },    \n\t{ 21125, 0x4200 },    \n\t{ 21126, 0x0004 },    \n\t{ 21127, 0x0C80 },    \n\t{ 21128, 0x00FB },    \n\t{ 21129, 0x3F80 },    \n\t{ 21130, 0x00F7 },    \n\t{ 21131, 0x57C0 },    \n\t{ 21132, 0x0003 },    \n\t{ 21133, 0x5400 },    \n\t{ 21134, 0x0000 },    \n\t{ 21135, 0xC6C0 },    \n\t{ 21136, 0x0003 },    \n\t{ 21137, 0x12C0 },    \n\t{ 21138, 0x00FD },    \n\t{ 21139, 0x8580 },    \n};\n\nstatic bool wm8962_volatile_register(struct device *dev, unsigned int reg)\n{\n\tswitch (reg) {\n\tcase WM8962_CLOCKING1:\n\tcase WM8962_SOFTWARE_RESET:\n\tcase WM8962_THERMAL_SHUTDOWN_STATUS:\n\tcase WM8962_ADDITIONAL_CONTROL_4:\n\tcase WM8962_DC_SERVO_6:\n\tcase WM8962_INTERRUPT_STATUS_1:\n\tcase WM8962_INTERRUPT_STATUS_2:\n\tcase WM8962_DSP2_EXECCONTROL:\n\t\treturn true;\n\tdefault:\n\t\treturn false;\n\t}\n}\n\nstatic bool wm8962_readable_register(struct device *dev, unsigned int reg)\n{\n\tswitch (reg) {\n\tcase WM8962_LEFT_INPUT_VOLUME:\n\tcase WM8962_RIGHT_INPUT_VOLUME:\n\tcase WM8962_HPOUTL_VOLUME:\n\tcase WM8962_HPOUTR_VOLUME:\n\tcase WM8962_CLOCKING1:\n\tcase WM8962_ADC_DAC_CONTROL_1:\n\tcase WM8962_ADC_DAC_CONTROL_2:\n\tcase WM8962_AUDIO_INTERFACE_0:\n\tcase WM8962_CLOCKING2:\n\tcase WM8962_AUDIO_INTERFACE_1:\n\tcase WM8962_LEFT_DAC_VOLUME:\n\tcase WM8962_RIGHT_DAC_VOLUME:\n\tcase WM8962_AUDIO_INTERFACE_2:\n\tcase WM8962_SOFTWARE_RESET:\n\tcase WM8962_ALC1:\n\tcase WM8962_ALC2:\n\tcase WM8962_ALC3:\n\tcase WM8962_NOISE_GATE:\n\tcase WM8962_LEFT_ADC_VOLUME:\n\tcase WM8962_RIGHT_ADC_VOLUME:\n\tcase WM8962_ADDITIONAL_CONTROL_1:\n\tcase WM8962_ADDITIONAL_CONTROL_2:\n\tcase WM8962_PWR_MGMT_1:\n\tcase WM8962_PWR_MGMT_2:\n\tcase WM8962_ADDITIONAL_CONTROL_3:\n\tcase WM8962_ANTI_POP:\n\tcase WM8962_CLOCKING_3:\n\tcase WM8962_INPUT_MIXER_CONTROL_1:\n\tcase WM8962_LEFT_INPUT_MIXER_VOLUME:\n\tcase WM8962_RIGHT_INPUT_MIXER_VOLUME:\n\tcase WM8962_INPUT_MIXER_CONTROL_2:\n\tcase WM8962_INPUT_BIAS_CONTROL:\n\tcase WM8962_LEFT_INPUT_PGA_CONTROL:\n\tcase WM8962_RIGHT_INPUT_PGA_CONTROL:\n\tcase WM8962_SPKOUTL_VOLUME:\n\tcase WM8962_SPKOUTR_VOLUME:\n\tcase WM8962_THERMAL_SHUTDOWN_STATUS:\n\tcase WM8962_ADDITIONAL_CONTROL_4:\n\tcase WM8962_CLASS_D_CONTROL_1:\n\tcase WM8962_CLASS_D_CONTROL_2:\n\tcase WM8962_CLOCKING_4:\n\tcase WM8962_DAC_DSP_MIXING_1:\n\tcase WM8962_DAC_DSP_MIXING_2:\n\tcase WM8962_DC_SERVO_0:\n\tcase WM8962_DC_SERVO_1:\n\tcase WM8962_DC_SERVO_4:\n\tcase WM8962_DC_SERVO_6:\n\tcase WM8962_ANALOGUE_PGA_BIAS:\n\tcase WM8962_ANALOGUE_HP_0:\n\tcase WM8962_ANALOGUE_HP_2:\n\tcase WM8962_CHARGE_PUMP_1:\n\tcase WM8962_CHARGE_PUMP_B:\n\tcase WM8962_WRITE_SEQUENCER_CONTROL_1:\n\tcase WM8962_WRITE_SEQUENCER_CONTROL_2:\n\tcase WM8962_WRITE_SEQUENCER_CONTROL_3:\n\tcase WM8962_CONTROL_INTERFACE:\n\tcase WM8962_MIXER_ENABLES:\n\tcase WM8962_HEADPHONE_MIXER_1:\n\tcase WM8962_HEADPHONE_MIXER_2:\n\tcase WM8962_HEADPHONE_MIXER_3:\n\tcase WM8962_HEADPHONE_MIXER_4:\n\tcase WM8962_SPEAKER_MIXER_1:\n\tcase WM8962_SPEAKER_MIXER_2:\n\tcase WM8962_SPEAKER_MIXER_3:\n\tcase WM8962_SPEAKER_MIXER_4:\n\tcase WM8962_SPEAKER_MIXER_5:\n\tcase WM8962_BEEP_GENERATOR_1:\n\tcase WM8962_OSCILLATOR_TRIM_3:\n\tcase WM8962_OSCILLATOR_TRIM_4:\n\tcase WM8962_OSCILLATOR_TRIM_7:\n\tcase WM8962_ANALOGUE_CLOCKING1:\n\tcase WM8962_ANALOGUE_CLOCKING2:\n\tcase WM8962_ANALOGUE_CLOCKING3:\n\tcase WM8962_PLL_SOFTWARE_RESET:\n\tcase WM8962_PLL2:\n\tcase WM8962_PLL_4:\n\tcase WM8962_PLL_9:\n\tcase WM8962_PLL_10:\n\tcase WM8962_PLL_11:\n\tcase WM8962_PLL_12:\n\tcase WM8962_PLL_13:\n\tcase WM8962_PLL_14:\n\tcase WM8962_PLL_15:\n\tcase WM8962_PLL_16:\n\tcase WM8962_FLL_CONTROL_1:\n\tcase WM8962_FLL_CONTROL_2:\n\tcase WM8962_FLL_CONTROL_3:\n\tcase WM8962_FLL_CONTROL_5:\n\tcase WM8962_FLL_CONTROL_6:\n\tcase WM8962_FLL_CONTROL_7:\n\tcase WM8962_FLL_CONTROL_8:\n\tcase WM8962_GENERAL_TEST_1:\n\tcase WM8962_DF1:\n\tcase WM8962_DF2:\n\tcase WM8962_DF3:\n\tcase WM8962_DF4:\n\tcase WM8962_DF5:\n\tcase WM8962_DF6:\n\tcase WM8962_DF7:\n\tcase WM8962_LHPF1:\n\tcase WM8962_LHPF2:\n\tcase WM8962_THREED1:\n\tcase WM8962_THREED2:\n\tcase WM8962_THREED3:\n\tcase WM8962_THREED4:\n\tcase WM8962_DRC_1:\n\tcase WM8962_DRC_2:\n\tcase WM8962_DRC_3:\n\tcase WM8962_DRC_4:\n\tcase WM8962_DRC_5:\n\tcase WM8962_TLOOPBACK:\n\tcase WM8962_EQ1:\n\tcase WM8962_EQ2:\n\tcase WM8962_EQ3:\n\tcase WM8962_EQ4:\n\tcase WM8962_EQ5:\n\tcase WM8962_EQ6:\n\tcase WM8962_EQ7:\n\tcase WM8962_EQ8:\n\tcase WM8962_EQ9:\n\tcase WM8962_EQ10:\n\tcase WM8962_EQ11:\n\tcase WM8962_EQ12:\n\tcase WM8962_EQ13:\n\tcase WM8962_EQ14:\n\tcase WM8962_EQ15:\n\tcase WM8962_EQ16:\n\tcase WM8962_EQ17:\n\tcase WM8962_EQ18:\n\tcase WM8962_EQ19:\n\tcase WM8962_EQ20:\n\tcase WM8962_EQ21:\n\tcase WM8962_EQ22:\n\tcase WM8962_EQ23:\n\tcase WM8962_EQ24:\n\tcase WM8962_EQ25:\n\tcase WM8962_EQ26:\n\tcase WM8962_EQ27:\n\tcase WM8962_EQ28:\n\tcase WM8962_EQ29:\n\tcase WM8962_EQ30:\n\tcase WM8962_EQ31:\n\tcase WM8962_EQ32:\n\tcase WM8962_EQ33:\n\tcase WM8962_EQ34:\n\tcase WM8962_EQ35:\n\tcase WM8962_EQ36:\n\tcase WM8962_EQ37:\n\tcase WM8962_EQ38:\n\tcase WM8962_EQ39:\n\tcase WM8962_EQ40:\n\tcase WM8962_EQ41:\n\tcase WM8962_GPIO_2:\n\tcase WM8962_GPIO_3:\n\tcase WM8962_GPIO_5:\n\tcase WM8962_GPIO_6:\n\tcase WM8962_INTERRUPT_STATUS_1:\n\tcase WM8962_INTERRUPT_STATUS_2:\n\tcase WM8962_INTERRUPT_STATUS_1_MASK:\n\tcase WM8962_INTERRUPT_STATUS_2_MASK:\n\tcase WM8962_INTERRUPT_CONTROL:\n\tcase WM8962_IRQ_DEBOUNCE:\n\tcase WM8962_MICINT_SOURCE_POL:\n\tcase WM8962_DSP2_POWER_MANAGEMENT:\n\tcase WM8962_DSP2_EXECCONTROL:\n\tcase WM8962_DSP2_INSTRUCTION_RAM_0:\n\tcase WM8962_DSP2_ADDRESS_RAM_2:\n\tcase WM8962_DSP2_ADDRESS_RAM_1:\n\tcase WM8962_DSP2_ADDRESS_RAM_0:\n\tcase WM8962_DSP2_DATA1_RAM_1:\n\tcase WM8962_DSP2_DATA1_RAM_0:\n\tcase WM8962_DSP2_DATA2_RAM_1:\n\tcase WM8962_DSP2_DATA2_RAM_0:\n\tcase WM8962_DSP2_DATA3_RAM_1:\n\tcase WM8962_DSP2_DATA3_RAM_0:\n\tcase WM8962_DSP2_COEFF_RAM_0:\n\tcase WM8962_RETUNEADC_SHARED_COEFF_1:\n\tcase WM8962_RETUNEADC_SHARED_COEFF_0:\n\tcase WM8962_RETUNEDAC_SHARED_COEFF_1:\n\tcase WM8962_RETUNEDAC_SHARED_COEFF_0:\n\tcase WM8962_SOUNDSTAGE_ENABLES_1:\n\tcase WM8962_SOUNDSTAGE_ENABLES_0:\n\tcase WM8962_HDBASS_AI_1:\n\tcase WM8962_HDBASS_AI_0:\n\tcase WM8962_HDBASS_AR_1:\n\tcase WM8962_HDBASS_AR_0:\n\tcase WM8962_HDBASS_B_1:\n\tcase WM8962_HDBASS_B_0:\n\tcase WM8962_HDBASS_K_1:\n\tcase WM8962_HDBASS_K_0:\n\tcase WM8962_HDBASS_N1_1:\n\tcase WM8962_HDBASS_N1_0:\n\tcase WM8962_HDBASS_N2_1:\n\tcase WM8962_HDBASS_N2_0:\n\tcase WM8962_HDBASS_N3_1:\n\tcase WM8962_HDBASS_N3_0:\n\tcase WM8962_HDBASS_N4_1:\n\tcase WM8962_HDBASS_N4_0:\n\tcase WM8962_HDBASS_N5_1:\n\tcase WM8962_HDBASS_N5_0:\n\tcase WM8962_HDBASS_X1_1:\n\tcase WM8962_HDBASS_X1_0:\n\tcase WM8962_HDBASS_X2_1:\n\tcase WM8962_HDBASS_X2_0:\n\tcase WM8962_HDBASS_X3_1:\n\tcase WM8962_HDBASS_X3_0:\n\tcase WM8962_HDBASS_ATK_1:\n\tcase WM8962_HDBASS_ATK_0:\n\tcase WM8962_HDBASS_DCY_1:\n\tcase WM8962_HDBASS_DCY_0:\n\tcase WM8962_HDBASS_PG_1:\n\tcase WM8962_HDBASS_PG_0:\n\tcase WM8962_HPF_C_1:\n\tcase WM8962_HPF_C_0:\n\tcase WM8962_ADCL_RETUNE_C1_1:\n\tcase WM8962_ADCL_RETUNE_C1_0:\n\tcase WM8962_ADCL_RETUNE_C2_1:\n\tcase WM8962_ADCL_RETUNE_C2_0:\n\tcase WM8962_ADCL_RETUNE_C3_1:\n\tcase WM8962_ADCL_RETUNE_C3_0:\n\tcase WM8962_ADCL_RETUNE_C4_1:\n\tcase WM8962_ADCL_RETUNE_C4_0:\n\tcase WM8962_ADCL_RETUNE_C5_1:\n\tcase WM8962_ADCL_RETUNE_C5_0:\n\tcase WM8962_ADCL_RETUNE_C6_1:\n\tcase WM8962_ADCL_RETUNE_C6_0:\n\tcase WM8962_ADCL_RETUNE_C7_1:\n\tcase WM8962_ADCL_RETUNE_C7_0:\n\tcase WM8962_ADCL_RETUNE_C8_1:\n\tcase WM8962_ADCL_RETUNE_C8_0:\n\tcase WM8962_ADCL_RETUNE_C9_1:\n\tcase WM8962_ADCL_RETUNE_C9_0:\n\tcase WM8962_ADCL_RETUNE_C10_1:\n\tcase WM8962_ADCL_RETUNE_C10_0:\n\tcase WM8962_ADCL_RETUNE_C11_1:\n\tcase WM8962_ADCL_RETUNE_C11_0:\n\tcase WM8962_ADCL_RETUNE_C12_1:\n\tcase WM8962_ADCL_RETUNE_C12_0:\n\tcase WM8962_ADCL_RETUNE_C13_1:\n\tcase WM8962_ADCL_RETUNE_C13_0:\n\tcase WM8962_ADCL_RETUNE_C14_1:\n\tcase WM8962_ADCL_RETUNE_C14_0:\n\tcase WM8962_ADCL_RETUNE_C15_1:\n\tcase WM8962_ADCL_RETUNE_C15_0:\n\tcase WM8962_ADCL_RETUNE_C16_1:\n\tcase WM8962_ADCL_RETUNE_C16_0:\n\tcase WM8962_ADCL_RETUNE_C17_1:\n\tcase WM8962_ADCL_RETUNE_C17_0:\n\tcase WM8962_ADCL_RETUNE_C18_1:\n\tcase WM8962_ADCL_RETUNE_C18_0:\n\tcase WM8962_ADCL_RETUNE_C19_1:\n\tcase WM8962_ADCL_RETUNE_C19_0:\n\tcase WM8962_ADCL_RETUNE_C20_1:\n\tcase WM8962_ADCL_RETUNE_C20_0:\n\tcase WM8962_ADCL_RETUNE_C21_1:\n\tcase WM8962_ADCL_RETUNE_C21_0:\n\tcase WM8962_ADCL_RETUNE_C22_1:\n\tcase WM8962_ADCL_RETUNE_C22_0:\n\tcase WM8962_ADCL_RETUNE_C23_1:\n\tcase WM8962_ADCL_RETUNE_C23_0:\n\tcase WM8962_ADCL_RETUNE_C24_1:\n\tcase WM8962_ADCL_RETUNE_C24_0:\n\tcase WM8962_ADCL_RETUNE_C25_1:\n\tcase WM8962_ADCL_RETUNE_C25_0:\n\tcase WM8962_ADCL_RETUNE_C26_1:\n\tcase WM8962_ADCL_RETUNE_C26_0:\n\tcase WM8962_ADCL_RETUNE_C27_1:\n\tcase WM8962_ADCL_RETUNE_C27_0:\n\tcase WM8962_ADCL_RETUNE_C28_1:\n\tcase WM8962_ADCL_RETUNE_C28_0:\n\tcase WM8962_ADCL_RETUNE_C29_1:\n\tcase WM8962_ADCL_RETUNE_C29_0:\n\tcase WM8962_ADCL_RETUNE_C30_1:\n\tcase WM8962_ADCL_RETUNE_C30_0:\n\tcase WM8962_ADCL_RETUNE_C31_1:\n\tcase WM8962_ADCL_RETUNE_C31_0:\n\tcase WM8962_ADCL_RETUNE_C32_1:\n\tcase WM8962_ADCL_RETUNE_C32_0:\n\tcase WM8962_RETUNEADC_PG2_1:\n\tcase WM8962_RETUNEADC_PG2_0:\n\tcase WM8962_RETUNEADC_PG_1:\n\tcase WM8962_RETUNEADC_PG_0:\n\tcase WM8962_ADCR_RETUNE_C1_1:\n\tcase WM8962_ADCR_RETUNE_C1_0:\n\tcase WM8962_ADCR_RETUNE_C2_1:\n\tcase WM8962_ADCR_RETUNE_C2_0:\n\tcase WM8962_ADCR_RETUNE_C3_1:\n\tcase WM8962_ADCR_RETUNE_C3_0:\n\tcase WM8962_ADCR_RETUNE_C4_1:\n\tcase WM8962_ADCR_RETUNE_C4_0:\n\tcase WM8962_ADCR_RETUNE_C5_1:\n\tcase WM8962_ADCR_RETUNE_C5_0:\n\tcase WM8962_ADCR_RETUNE_C6_1:\n\tcase WM8962_ADCR_RETUNE_C6_0:\n\tcase WM8962_ADCR_RETUNE_C7_1:\n\tcase WM8962_ADCR_RETUNE_C7_0:\n\tcase WM8962_ADCR_RETUNE_C8_1:\n\tcase WM8962_ADCR_RETUNE_C8_0:\n\tcase WM8962_ADCR_RETUNE_C9_1:\n\tcase WM8962_ADCR_RETUNE_C9_0:\n\tcase WM8962_ADCR_RETUNE_C10_1:\n\tcase WM8962_ADCR_RETUNE_C10_0:\n\tcase WM8962_ADCR_RETUNE_C11_1:\n\tcase WM8962_ADCR_RETUNE_C11_0:\n\tcase WM8962_ADCR_RETUNE_C12_1:\n\tcase WM8962_ADCR_RETUNE_C12_0:\n\tcase WM8962_ADCR_RETUNE_C13_1:\n\tcase WM8962_ADCR_RETUNE_C13_0:\n\tcase WM8962_ADCR_RETUNE_C14_1:\n\tcase WM8962_ADCR_RETUNE_C14_0:\n\tcase WM8962_ADCR_RETUNE_C15_1:\n\tcase WM8962_ADCR_RETUNE_C15_0:\n\tcase WM8962_ADCR_RETUNE_C16_1:\n\tcase WM8962_ADCR_RETUNE_C16_0:\n\tcase WM8962_ADCR_RETUNE_C17_1:\n\tcase WM8962_ADCR_RETUNE_C17_0:\n\tcase WM8962_ADCR_RETUNE_C18_1:\n\tcase WM8962_ADCR_RETUNE_C18_0:\n\tcase WM8962_ADCR_RETUNE_C19_1:\n\tcase WM8962_ADCR_RETUNE_C19_0:\n\tcase WM8962_ADCR_RETUNE_C20_1:\n\tcase WM8962_ADCR_RETUNE_C20_0:\n\tcase WM8962_ADCR_RETUNE_C21_1:\n\tcase WM8962_ADCR_RETUNE_C21_0:\n\tcase WM8962_ADCR_RETUNE_C22_1:\n\tcase WM8962_ADCR_RETUNE_C22_0:\n\tcase WM8962_ADCR_RETUNE_C23_1:\n\tcase WM8962_ADCR_RETUNE_C23_0:\n\tcase WM8962_ADCR_RETUNE_C24_1:\n\tcase WM8962_ADCR_RETUNE_C24_0:\n\tcase WM8962_ADCR_RETUNE_C25_1:\n\tcase WM8962_ADCR_RETUNE_C25_0:\n\tcase WM8962_ADCR_RETUNE_C26_1:\n\tcase WM8962_ADCR_RETUNE_C26_0:\n\tcase WM8962_ADCR_RETUNE_C27_1:\n\tcase WM8962_ADCR_RETUNE_C27_0:\n\tcase WM8962_ADCR_RETUNE_C28_1:\n\tcase WM8962_ADCR_RETUNE_C28_0:\n\tcase WM8962_ADCR_RETUNE_C29_1:\n\tcase WM8962_ADCR_RETUNE_C29_0:\n\tcase WM8962_ADCR_RETUNE_C30_1:\n\tcase WM8962_ADCR_RETUNE_C30_0:\n\tcase WM8962_ADCR_RETUNE_C31_1:\n\tcase WM8962_ADCR_RETUNE_C31_0:\n\tcase WM8962_ADCR_RETUNE_C32_1:\n\tcase WM8962_ADCR_RETUNE_C32_0:\n\tcase WM8962_DACL_RETUNE_C1_1:\n\tcase WM8962_DACL_RETUNE_C1_0:\n\tcase WM8962_DACL_RETUNE_C2_1:\n\tcase WM8962_DACL_RETUNE_C2_0:\n\tcase WM8962_DACL_RETUNE_C3_1:\n\tcase WM8962_DACL_RETUNE_C3_0:\n\tcase WM8962_DACL_RETUNE_C4_1:\n\tcase WM8962_DACL_RETUNE_C4_0:\n\tcase WM8962_DACL_RETUNE_C5_1:\n\tcase WM8962_DACL_RETUNE_C5_0:\n\tcase WM8962_DACL_RETUNE_C6_1:\n\tcase WM8962_DACL_RETUNE_C6_0:\n\tcase WM8962_DACL_RETUNE_C7_1:\n\tcase WM8962_DACL_RETUNE_C7_0:\n\tcase WM8962_DACL_RETUNE_C8_1:\n\tcase WM8962_DACL_RETUNE_C8_0:\n\tcase WM8962_DACL_RETUNE_C9_1:\n\tcase WM8962_DACL_RETUNE_C9_0:\n\tcase WM8962_DACL_RETUNE_C10_1:\n\tcase WM8962_DACL_RETUNE_C10_0:\n\tcase WM8962_DACL_RETUNE_C11_1:\n\tcase WM8962_DACL_RETUNE_C11_0:\n\tcase WM8962_DACL_RETUNE_C12_1:\n\tcase WM8962_DACL_RETUNE_C12_0:\n\tcase WM8962_DACL_RETUNE_C13_1:\n\tcase WM8962_DACL_RETUNE_C13_0:\n\tcase WM8962_DACL_RETUNE_C14_1:\n\tcase WM8962_DACL_RETUNE_C14_0:\n\tcase WM8962_DACL_RETUNE_C15_1:\n\tcase WM8962_DACL_RETUNE_C15_0:\n\tcase WM8962_DACL_RETUNE_C16_1:\n\tcase WM8962_DACL_RETUNE_C16_0:\n\tcase WM8962_DACL_RETUNE_C17_1:\n\tcase WM8962_DACL_RETUNE_C17_0:\n\tcase WM8962_DACL_RETUNE_C18_1:\n\tcase WM8962_DACL_RETUNE_C18_0:\n\tcase WM8962_DACL_RETUNE_C19_1:\n\tcase WM8962_DACL_RETUNE_C19_0:\n\tcase WM8962_DACL_RETUNE_C20_1:\n\tcase WM8962_DACL_RETUNE_C20_0:\n\tcase WM8962_DACL_RETUNE_C21_1:\n\tcase WM8962_DACL_RETUNE_C21_0:\n\tcase WM8962_DACL_RETUNE_C22_1:\n\tcase WM8962_DACL_RETUNE_C22_0:\n\tcase WM8962_DACL_RETUNE_C23_1:\n\tcase WM8962_DACL_RETUNE_C23_0:\n\tcase WM8962_DACL_RETUNE_C24_1:\n\tcase WM8962_DACL_RETUNE_C24_0:\n\tcase WM8962_DACL_RETUNE_C25_1:\n\tcase WM8962_DACL_RETUNE_C25_0:\n\tcase WM8962_DACL_RETUNE_C26_1:\n\tcase WM8962_DACL_RETUNE_C26_0:\n\tcase WM8962_DACL_RETUNE_C27_1:\n\tcase WM8962_DACL_RETUNE_C27_0:\n\tcase WM8962_DACL_RETUNE_C28_1:\n\tcase WM8962_DACL_RETUNE_C28_0:\n\tcase WM8962_DACL_RETUNE_C29_1:\n\tcase WM8962_DACL_RETUNE_C29_0:\n\tcase WM8962_DACL_RETUNE_C30_1:\n\tcase WM8962_DACL_RETUNE_C30_0:\n\tcase WM8962_DACL_RETUNE_C31_1:\n\tcase WM8962_DACL_RETUNE_C31_0:\n\tcase WM8962_DACL_RETUNE_C32_1:\n\tcase WM8962_DACL_RETUNE_C32_0:\n\tcase WM8962_RETUNEDAC_PG2_1:\n\tcase WM8962_RETUNEDAC_PG2_0:\n\tcase WM8962_RETUNEDAC_PG_1:\n\tcase WM8962_RETUNEDAC_PG_0:\n\tcase WM8962_DACR_RETUNE_C1_1:\n\tcase WM8962_DACR_RETUNE_C1_0:\n\tcase WM8962_DACR_RETUNE_C2_1:\n\tcase WM8962_DACR_RETUNE_C2_0:\n\tcase WM8962_DACR_RETUNE_C3_1:\n\tcase WM8962_DACR_RETUNE_C3_0:\n\tcase WM8962_DACR_RETUNE_C4_1:\n\tcase WM8962_DACR_RETUNE_C4_0:\n\tcase WM8962_DACR_RETUNE_C5_1:\n\tcase WM8962_DACR_RETUNE_C5_0:\n\tcase WM8962_DACR_RETUNE_C6_1:\n\tcase WM8962_DACR_RETUNE_C6_0:\n\tcase WM8962_DACR_RETUNE_C7_1:\n\tcase WM8962_DACR_RETUNE_C7_0:\n\tcase WM8962_DACR_RETUNE_C8_1:\n\tcase WM8962_DACR_RETUNE_C8_0:\n\tcase WM8962_DACR_RETUNE_C9_1:\n\tcase WM8962_DACR_RETUNE_C9_0:\n\tcase WM8962_DACR_RETUNE_C10_1:\n\tcase WM8962_DACR_RETUNE_C10_0:\n\tcase WM8962_DACR_RETUNE_C11_1:\n\tcase WM8962_DACR_RETUNE_C11_0:\n\tcase WM8962_DACR_RETUNE_C12_1:\n\tcase WM8962_DACR_RETUNE_C12_0:\n\tcase WM8962_DACR_RETUNE_C13_1:\n\tcase WM8962_DACR_RETUNE_C13_0:\n\tcase WM8962_DACR_RETUNE_C14_1:\n\tcase WM8962_DACR_RETUNE_C14_0:\n\tcase WM8962_DACR_RETUNE_C15_1:\n\tcase WM8962_DACR_RETUNE_C15_0:\n\tcase WM8962_DACR_RETUNE_C16_1:\n\tcase WM8962_DACR_RETUNE_C16_0:\n\tcase WM8962_DACR_RETUNE_C17_1:\n\tcase WM8962_DACR_RETUNE_C17_0:\n\tcase WM8962_DACR_RETUNE_C18_1:\n\tcase WM8962_DACR_RETUNE_C18_0:\n\tcase WM8962_DACR_RETUNE_C19_1:\n\tcase WM8962_DACR_RETUNE_C19_0:\n\tcase WM8962_DACR_RETUNE_C20_1:\n\tcase WM8962_DACR_RETUNE_C20_0:\n\tcase WM8962_DACR_RETUNE_C21_1:\n\tcase WM8962_DACR_RETUNE_C21_0:\n\tcase WM8962_DACR_RETUNE_C22_1:\n\tcase WM8962_DACR_RETUNE_C22_0:\n\tcase WM8962_DACR_RETUNE_C23_1:\n\tcase WM8962_DACR_RETUNE_C23_0:\n\tcase WM8962_DACR_RETUNE_C24_1:\n\tcase WM8962_DACR_RETUNE_C24_0:\n\tcase WM8962_DACR_RETUNE_C25_1:\n\tcase WM8962_DACR_RETUNE_C25_0:\n\tcase WM8962_DACR_RETUNE_C26_1:\n\tcase WM8962_DACR_RETUNE_C26_0:\n\tcase WM8962_DACR_RETUNE_C27_1:\n\tcase WM8962_DACR_RETUNE_C27_0:\n\tcase WM8962_DACR_RETUNE_C28_1:\n\tcase WM8962_DACR_RETUNE_C28_0:\n\tcase WM8962_DACR_RETUNE_C29_1:\n\tcase WM8962_DACR_RETUNE_C29_0:\n\tcase WM8962_DACR_RETUNE_C30_1:\n\tcase WM8962_DACR_RETUNE_C30_0:\n\tcase WM8962_DACR_RETUNE_C31_1:\n\tcase WM8962_DACR_RETUNE_C31_0:\n\tcase WM8962_DACR_RETUNE_C32_1:\n\tcase WM8962_DACR_RETUNE_C32_0:\n\tcase WM8962_VSS_XHD2_1:\n\tcase WM8962_VSS_XHD2_0:\n\tcase WM8962_VSS_XHD3_1:\n\tcase WM8962_VSS_XHD3_0:\n\tcase WM8962_VSS_XHN1_1:\n\tcase WM8962_VSS_XHN1_0:\n\tcase WM8962_VSS_XHN2_1:\n\tcase WM8962_VSS_XHN2_0:\n\tcase WM8962_VSS_XHN3_1:\n\tcase WM8962_VSS_XHN3_0:\n\tcase WM8962_VSS_XLA_1:\n\tcase WM8962_VSS_XLA_0:\n\tcase WM8962_VSS_XLB_1:\n\tcase WM8962_VSS_XLB_0:\n\tcase WM8962_VSS_XLG_1:\n\tcase WM8962_VSS_XLG_0:\n\tcase WM8962_VSS_PG2_1:\n\tcase WM8962_VSS_PG2_0:\n\tcase WM8962_VSS_PG_1:\n\tcase WM8962_VSS_PG_0:\n\tcase WM8962_VSS_XTD1_1:\n\tcase WM8962_VSS_XTD1_0:\n\tcase WM8962_VSS_XTD2_1:\n\tcase WM8962_VSS_XTD2_0:\n\tcase WM8962_VSS_XTD3_1:\n\tcase WM8962_VSS_XTD3_0:\n\tcase WM8962_VSS_XTD4_1:\n\tcase WM8962_VSS_XTD4_0:\n\tcase WM8962_VSS_XTD5_1:\n\tcase WM8962_VSS_XTD5_0:\n\tcase WM8962_VSS_XTD6_1:\n\tcase WM8962_VSS_XTD6_0:\n\tcase WM8962_VSS_XTD7_1:\n\tcase WM8962_VSS_XTD7_0:\n\tcase WM8962_VSS_XTD8_1:\n\tcase WM8962_VSS_XTD8_0:\n\tcase WM8962_VSS_XTD9_1:\n\tcase WM8962_VSS_XTD9_0:\n\tcase WM8962_VSS_XTD10_1:\n\tcase WM8962_VSS_XTD10_0:\n\tcase WM8962_VSS_XTD11_1:\n\tcase WM8962_VSS_XTD11_0:\n\tcase WM8962_VSS_XTD12_1:\n\tcase WM8962_VSS_XTD12_0:\n\tcase WM8962_VSS_XTD13_1:\n\tcase WM8962_VSS_XTD13_0:\n\tcase WM8962_VSS_XTD14_1:\n\tcase WM8962_VSS_XTD14_0:\n\tcase WM8962_VSS_XTD15_1:\n\tcase WM8962_VSS_XTD15_0:\n\tcase WM8962_VSS_XTD16_1:\n\tcase WM8962_VSS_XTD16_0:\n\tcase WM8962_VSS_XTD17_1:\n\tcase WM8962_VSS_XTD17_0:\n\tcase WM8962_VSS_XTD18_1:\n\tcase WM8962_VSS_XTD18_0:\n\tcase WM8962_VSS_XTD19_1:\n\tcase WM8962_VSS_XTD19_0:\n\tcase WM8962_VSS_XTD20_1:\n\tcase WM8962_VSS_XTD20_0:\n\tcase WM8962_VSS_XTD21_1:\n\tcase WM8962_VSS_XTD21_0:\n\tcase WM8962_VSS_XTD22_1:\n\tcase WM8962_VSS_XTD22_0:\n\tcase WM8962_VSS_XTD23_1:\n\tcase WM8962_VSS_XTD23_0:\n\tcase WM8962_VSS_XTD24_1:\n\tcase WM8962_VSS_XTD24_0:\n\tcase WM8962_VSS_XTD25_1:\n\tcase WM8962_VSS_XTD25_0:\n\tcase WM8962_VSS_XTD26_1:\n\tcase WM8962_VSS_XTD26_0:\n\tcase WM8962_VSS_XTD27_1:\n\tcase WM8962_VSS_XTD27_0:\n\tcase WM8962_VSS_XTD28_1:\n\tcase WM8962_VSS_XTD28_0:\n\tcase WM8962_VSS_XTD29_1:\n\tcase WM8962_VSS_XTD29_0:\n\tcase WM8962_VSS_XTD30_1:\n\tcase WM8962_VSS_XTD30_0:\n\tcase WM8962_VSS_XTD31_1:\n\tcase WM8962_VSS_XTD31_0:\n\tcase WM8962_VSS_XTD32_1:\n\tcase WM8962_VSS_XTD32_0:\n\tcase WM8962_VSS_XTS1_1:\n\tcase WM8962_VSS_XTS1_0:\n\tcase WM8962_VSS_XTS2_1:\n\tcase WM8962_VSS_XTS2_0:\n\tcase WM8962_VSS_XTS3_1:\n\tcase WM8962_VSS_XTS3_0:\n\tcase WM8962_VSS_XTS4_1:\n\tcase WM8962_VSS_XTS4_0:\n\tcase WM8962_VSS_XTS5_1:\n\tcase WM8962_VSS_XTS5_0:\n\tcase WM8962_VSS_XTS6_1:\n\tcase WM8962_VSS_XTS6_0:\n\tcase WM8962_VSS_XTS7_1:\n\tcase WM8962_VSS_XTS7_0:\n\tcase WM8962_VSS_XTS8_1:\n\tcase WM8962_VSS_XTS8_0:\n\tcase WM8962_VSS_XTS9_1:\n\tcase WM8962_VSS_XTS9_0:\n\tcase WM8962_VSS_XTS10_1:\n\tcase WM8962_VSS_XTS10_0:\n\tcase WM8962_VSS_XTS11_1:\n\tcase WM8962_VSS_XTS11_0:\n\tcase WM8962_VSS_XTS12_1:\n\tcase WM8962_VSS_XTS12_0:\n\tcase WM8962_VSS_XTS13_1:\n\tcase WM8962_VSS_XTS13_0:\n\tcase WM8962_VSS_XTS14_1:\n\tcase WM8962_VSS_XTS14_0:\n\tcase WM8962_VSS_XTS15_1:\n\tcase WM8962_VSS_XTS15_0:\n\tcase WM8962_VSS_XTS16_1:\n\tcase WM8962_VSS_XTS16_0:\n\tcase WM8962_VSS_XTS17_1:\n\tcase WM8962_VSS_XTS17_0:\n\tcase WM8962_VSS_XTS18_1:\n\tcase WM8962_VSS_XTS18_0:\n\tcase WM8962_VSS_XTS19_1:\n\tcase WM8962_VSS_XTS19_0:\n\tcase WM8962_VSS_XTS20_1:\n\tcase WM8962_VSS_XTS20_0:\n\tcase WM8962_VSS_XTS21_1:\n\tcase WM8962_VSS_XTS21_0:\n\tcase WM8962_VSS_XTS22_1:\n\tcase WM8962_VSS_XTS22_0:\n\tcase WM8962_VSS_XTS23_1:\n\tcase WM8962_VSS_XTS23_0:\n\tcase WM8962_VSS_XTS24_1:\n\tcase WM8962_VSS_XTS24_0:\n\tcase WM8962_VSS_XTS25_1:\n\tcase WM8962_VSS_XTS25_0:\n\tcase WM8962_VSS_XTS26_1:\n\tcase WM8962_VSS_XTS26_0:\n\tcase WM8962_VSS_XTS27_1:\n\tcase WM8962_VSS_XTS27_0:\n\tcase WM8962_VSS_XTS28_1:\n\tcase WM8962_VSS_XTS28_0:\n\tcase WM8962_VSS_XTS29_1:\n\tcase WM8962_VSS_XTS29_0:\n\tcase WM8962_VSS_XTS30_1:\n\tcase WM8962_VSS_XTS30_0:\n\tcase WM8962_VSS_XTS31_1:\n\tcase WM8962_VSS_XTS31_0:\n\tcase WM8962_VSS_XTS32_1:\n\tcase WM8962_VSS_XTS32_0:\n\t\treturn true;\n\tdefault:\n\t\treturn false;\n\t}\n}\n\nstatic int wm8962_reset(struct wm8962_priv *wm8962)\n{\n\tint ret;\n\n\tret = regmap_write(wm8962->regmap, WM8962_SOFTWARE_RESET, 0x6243);\n\tif (ret != 0)\n\t\treturn ret;\n\n\treturn regmap_write(wm8962->regmap, WM8962_PLL_SOFTWARE_RESET, 0);\n}\n\nstatic const DECLARE_TLV_DB_SCALE(inpga_tlv, -2325, 75, 0);\nstatic const DECLARE_TLV_DB_SCALE(mixin_tlv, -1500, 300, 0);\nstatic const DECLARE_TLV_DB_RANGE(mixinpga_tlv,\n\t0, 1, TLV_DB_SCALE_ITEM(0, 600, 0),\n\t2, 2, TLV_DB_SCALE_ITEM(1300, 1300, 0),\n\t3, 4, TLV_DB_SCALE_ITEM(1800, 200, 0),\n\t5, 5, TLV_DB_SCALE_ITEM(2400, 0, 0),\n\t6, 7, TLV_DB_SCALE_ITEM(2700, 300, 0)\n);\nstatic const DECLARE_TLV_DB_SCALE(beep_tlv, -9600, 600, 1);\nstatic const DECLARE_TLV_DB_SCALE(digital_tlv, -7200, 75, 1);\nstatic const DECLARE_TLV_DB_SCALE(st_tlv, -3600, 300, 0);\nstatic const DECLARE_TLV_DB_SCALE(inmix_tlv, -600, 600, 0);\nstatic const DECLARE_TLV_DB_SCALE(bypass_tlv, -1500, 300, 0);\nstatic const DECLARE_TLV_DB_SCALE(out_tlv, -12100, 100, 1);\nstatic const DECLARE_TLV_DB_SCALE(hp_tlv, -700, 100, 0);\nstatic const DECLARE_TLV_DB_RANGE(classd_tlv,\n\t0, 6, TLV_DB_SCALE_ITEM(0, 150, 0),\n\t7, 7, TLV_DB_SCALE_ITEM(1200, 0, 0)\n);\nstatic const DECLARE_TLV_DB_SCALE(eq_tlv, -1200, 100, 0);\n\nstatic int wm8962_dsp2_write_config(struct snd_soc_component *component)\n{\n\tstruct wm8962_priv *wm8962 = snd_soc_component_get_drvdata(component);\n\n\treturn regcache_sync_region(wm8962->regmap,\n\t\t\t\t    WM8962_HDBASS_AI_1, WM8962_MAX_REGISTER);\n}\n\nstatic int wm8962_dsp2_set_enable(struct snd_soc_component *component, u16 val)\n{\n\tu16 adcl = snd_soc_component_read(component, WM8962_LEFT_ADC_VOLUME);\n\tu16 adcr = snd_soc_component_read(component, WM8962_RIGHT_ADC_VOLUME);\n\tu16 dac = snd_soc_component_read(component, WM8962_ADC_DAC_CONTROL_1);\n\n\t \n\tsnd_soc_component_write(component, WM8962_LEFT_ADC_VOLUME, 0);\n\tsnd_soc_component_write(component, WM8962_RIGHT_ADC_VOLUME, WM8962_ADC_VU);\n\tsnd_soc_component_update_bits(component, WM8962_ADC_DAC_CONTROL_1,\n\t\t\t    WM8962_DAC_MUTE, WM8962_DAC_MUTE);\n\n\tsnd_soc_component_write(component, WM8962_SOUNDSTAGE_ENABLES_0, val);\n\n\t \n\tsnd_soc_component_write(component, WM8962_LEFT_ADC_VOLUME, adcl);\n\tsnd_soc_component_write(component, WM8962_RIGHT_ADC_VOLUME, adcr);\n\tsnd_soc_component_update_bits(component, WM8962_ADC_DAC_CONTROL_1,\n\t\t\t    WM8962_DAC_MUTE, dac);\n\n\treturn 0;\n}\n\nstatic int wm8962_dsp2_start(struct snd_soc_component *component)\n{\n\tstruct wm8962_priv *wm8962 = snd_soc_component_get_drvdata(component);\n\n\twm8962_dsp2_write_config(component);\n\n\tsnd_soc_component_write(component, WM8962_DSP2_EXECCONTROL, WM8962_DSP2_RUNR);\n\n\twm8962_dsp2_set_enable(component, wm8962->dsp2_ena);\n\n\treturn 0;\n}\n\nstatic int wm8962_dsp2_stop(struct snd_soc_component *component)\n{\n\twm8962_dsp2_set_enable(component, 0);\n\n\tsnd_soc_component_write(component, WM8962_DSP2_EXECCONTROL, WM8962_DSP2_STOP);\n\n\treturn 0;\n}\n\n#define WM8962_DSP2_ENABLE(xname, xshift) \\\n{\t.iface = SNDRV_CTL_ELEM_IFACE_MIXER, .name = xname, \\\n\t.info = wm8962_dsp2_ena_info, \\\n\t.get = wm8962_dsp2_ena_get, .put = wm8962_dsp2_ena_put, \\\n\t.private_value = xshift }\n\nstatic int wm8962_dsp2_ena_info(struct snd_kcontrol *kcontrol,\n\t\t\t\tstruct snd_ctl_elem_info *uinfo)\n{\n\tuinfo->type = SNDRV_CTL_ELEM_TYPE_BOOLEAN;\n\n\tuinfo->count = 1;\n\tuinfo->value.integer.min = 0;\n\tuinfo->value.integer.max = 1;\n\n\treturn 0;\n}\n\nstatic int wm8962_dsp2_ena_get(struct snd_kcontrol *kcontrol,\n\t\t\t       struct snd_ctl_elem_value *ucontrol)\n{\n\tint shift = kcontrol->private_value;\n\tstruct snd_soc_component *component = snd_soc_kcontrol_component(kcontrol);\n\tstruct wm8962_priv *wm8962 = snd_soc_component_get_drvdata(component);\n\n\tucontrol->value.integer.value[0] = !!(wm8962->dsp2_ena & 1 << shift);\n\n\treturn 0;\n}\n\nstatic int wm8962_dsp2_ena_put(struct snd_kcontrol *kcontrol,\n\t\t\t       struct snd_ctl_elem_value *ucontrol)\n{\n\tint shift = kcontrol->private_value;\n\tstruct snd_soc_component *component = snd_soc_kcontrol_component(kcontrol);\n\tstruct wm8962_priv *wm8962 = snd_soc_component_get_drvdata(component);\n\tint old = wm8962->dsp2_ena;\n\tint ret = 0;\n\tint dsp2_running = snd_soc_component_read(component, WM8962_DSP2_POWER_MANAGEMENT) &\n\t\tWM8962_DSP2_ENA;\n\n\tmutex_lock(&wm8962->dsp2_ena_lock);\n\n\tif (ucontrol->value.integer.value[0])\n\t\twm8962->dsp2_ena |= 1 << shift;\n\telse\n\t\twm8962->dsp2_ena &= ~(1 << shift);\n\n\tif (wm8962->dsp2_ena == old)\n\t\tgoto out;\n\n\tret = 1;\n\n\tif (dsp2_running) {\n\t\tif (wm8962->dsp2_ena)\n\t\t\twm8962_dsp2_set_enable(component, wm8962->dsp2_ena);\n\t\telse\n\t\t\twm8962_dsp2_stop(component);\n\t}\n\nout:\n\tmutex_unlock(&wm8962->dsp2_ena_lock);\n\n\treturn ret;\n}\n\n \nstatic int wm8962_put_hp_sw(struct snd_kcontrol *kcontrol,\n\t\t\t    struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_soc_component *component = snd_soc_kcontrol_component(kcontrol);\n\tint ret;\n\n\t \n        ret = snd_soc_put_volsw(kcontrol, ucontrol);\n\tif (ret == 0)\n\t\treturn 0;\n\n\t \n\tret = snd_soc_component_read(component, WM8962_PWR_MGMT_2);\n\tif (ret & WM8962_HPOUTL_PGA_ENA) {\n\t\tsnd_soc_component_write(component, WM8962_HPOUTL_VOLUME,\n\t\t\t      snd_soc_component_read(component, WM8962_HPOUTL_VOLUME));\n\t\treturn 1;\n\t}\n\n\t \n\tif (ret & WM8962_HPOUTR_PGA_ENA)\n\t\tsnd_soc_component_write(component, WM8962_HPOUTR_VOLUME,\n\t\t\t      snd_soc_component_read(component, WM8962_HPOUTR_VOLUME));\n\n\treturn 1;\n}\n\n \nstatic int wm8962_put_spk_sw(struct snd_kcontrol *kcontrol,\n\t\t\t    struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_soc_component *component = snd_soc_kcontrol_component(kcontrol);\n\tint ret;\n\n\t \n        ret = snd_soc_put_volsw(kcontrol, ucontrol);\n\tif (ret == 0)\n\t\treturn 0;\n\n\t \n\tret = snd_soc_component_read(component, WM8962_PWR_MGMT_2);\n\tif (ret & WM8962_SPKOUTL_PGA_ENA) {\n\t\tsnd_soc_component_write(component, WM8962_SPKOUTL_VOLUME,\n\t\t\t      snd_soc_component_read(component, WM8962_SPKOUTL_VOLUME));\n\t\treturn 1;\n\t}\n\n\t \n\tif (ret & WM8962_SPKOUTR_PGA_ENA)\n\t\tsnd_soc_component_write(component, WM8962_SPKOUTR_VOLUME,\n\t\t\t      snd_soc_component_read(component, WM8962_SPKOUTR_VOLUME));\n\n\treturn 1;\n}\n\nstatic const char *cap_hpf_mode_text[] = {\n\t\"Hi-fi\", \"Application\"\n};\n\nstatic SOC_ENUM_SINGLE_DECL(cap_hpf_mode,\n\t\t\t    WM8962_ADC_DAC_CONTROL_2, 10, cap_hpf_mode_text);\n\n\nstatic const char *cap_lhpf_mode_text[] = {\n\t\"LPF\", \"HPF\"\n};\n\nstatic SOC_ENUM_SINGLE_DECL(cap_lhpf_mode,\n\t\t\t    WM8962_LHPF1, 1, cap_lhpf_mode_text);\n\nstatic const struct snd_kcontrol_new wm8962_snd_controls[] = {\nSOC_DOUBLE(\"Input Mixer Switch\", WM8962_INPUT_MIXER_CONTROL_1, 3, 2, 1, 1),\n\nSOC_SINGLE_TLV(\"MIXINL IN2L Volume\", WM8962_LEFT_INPUT_MIXER_VOLUME, 6, 7, 0,\n\t       mixin_tlv),\nSOC_SINGLE_TLV(\"MIXINL PGA Volume\", WM8962_LEFT_INPUT_MIXER_VOLUME, 3, 7, 0,\n\t       mixinpga_tlv),\nSOC_SINGLE_TLV(\"MIXINL IN3L Volume\", WM8962_LEFT_INPUT_MIXER_VOLUME, 0, 7, 0,\n\t       mixin_tlv),\n\nSOC_SINGLE_TLV(\"MIXINR IN2R Volume\", WM8962_RIGHT_INPUT_MIXER_VOLUME, 6, 7, 0,\n\t       mixin_tlv),\nSOC_SINGLE_TLV(\"MIXINR PGA Volume\", WM8962_RIGHT_INPUT_MIXER_VOLUME, 3, 7, 0,\n\t       mixinpga_tlv),\nSOC_SINGLE_TLV(\"MIXINR IN3R Volume\", WM8962_RIGHT_INPUT_MIXER_VOLUME, 0, 7, 0,\n\t       mixin_tlv),\n\nSOC_DOUBLE_R_TLV(\"Digital Capture Volume\", WM8962_LEFT_ADC_VOLUME,\n\t\t WM8962_RIGHT_ADC_VOLUME, 1, 127, 0, digital_tlv),\nSOC_DOUBLE_R_TLV(\"Capture Volume\", WM8962_LEFT_INPUT_VOLUME,\n\t\t WM8962_RIGHT_INPUT_VOLUME, 0, 63, 0, inpga_tlv),\nSOC_DOUBLE_R(\"Capture Switch\", WM8962_LEFT_INPUT_VOLUME,\n\t     WM8962_RIGHT_INPUT_VOLUME, 7, 1, 1),\nSOC_DOUBLE_R(\"Capture ZC Switch\", WM8962_LEFT_INPUT_VOLUME,\n\t     WM8962_RIGHT_INPUT_VOLUME, 6, 1, 1),\nSOC_SINGLE(\"Capture HPF Switch\", WM8962_ADC_DAC_CONTROL_1, 0, 1, 1),\nSOC_ENUM(\"Capture HPF Mode\", cap_hpf_mode),\nSOC_SINGLE(\"Capture HPF Cutoff\", WM8962_ADC_DAC_CONTROL_2, 7, 7, 0),\nSOC_SINGLE(\"Capture LHPF Switch\", WM8962_LHPF1, 0, 1, 0),\nSOC_ENUM(\"Capture LHPF Mode\", cap_lhpf_mode),\n\nSOC_DOUBLE_R_TLV(\"Sidetone Volume\", WM8962_DAC_DSP_MIXING_1,\n\t\t WM8962_DAC_DSP_MIXING_2, 4, 12, 0, st_tlv),\n\nSOC_DOUBLE_R_TLV(\"Digital Playback Volume\", WM8962_LEFT_DAC_VOLUME,\n\t\t WM8962_RIGHT_DAC_VOLUME, 1, 127, 0, digital_tlv),\nSOC_SINGLE(\"DAC High Performance Switch\", WM8962_ADC_DAC_CONTROL_2, 0, 1, 0),\nSOC_SINGLE(\"DAC L/R Swap Switch\", WM8962_AUDIO_INTERFACE_0, 5, 1, 0),\nSOC_SINGLE(\"ADC L/R Swap Switch\", WM8962_AUDIO_INTERFACE_0, 8, 1, 0),\nSOC_SINGLE(\"DAC Monomix Switch\", WM8962_DAC_DSP_MIXING_1, WM8962_DAC_MONOMIX_SHIFT, 1, 0),\nSOC_SINGLE(\"ADC Monomix Switch\", WM8962_THREED1, WM8962_ADC_MONOMIX_SHIFT, 1, 0),\n\nSOC_SINGLE(\"ADC High Performance Switch\", WM8962_ADDITIONAL_CONTROL_1,\n\t   5, 1, 0),\n\nSOC_SINGLE_TLV(\"Beep Volume\", WM8962_BEEP_GENERATOR_1, 4, 15, 0, beep_tlv),\n\nSOC_DOUBLE_R_TLV(\"Headphone Volume\", WM8962_HPOUTL_VOLUME,\n\t\t WM8962_HPOUTR_VOLUME, 0, 127, 0, out_tlv),\nSOC_DOUBLE_EXT(\"Headphone Switch\", WM8962_PWR_MGMT_2, 1, 0, 1, 1,\n\t       snd_soc_get_volsw, wm8962_put_hp_sw),\nSOC_DOUBLE_R(\"Headphone ZC Switch\", WM8962_HPOUTL_VOLUME, WM8962_HPOUTR_VOLUME,\n\t     7, 1, 0),\nSOC_DOUBLE_TLV(\"Headphone Aux Volume\", WM8962_ANALOGUE_HP_2, 3, 6, 7, 0,\n\t       hp_tlv),\n\nSOC_DOUBLE_R(\"Headphone Mixer Switch\", WM8962_HEADPHONE_MIXER_3,\n\t     WM8962_HEADPHONE_MIXER_4, 8, 1, 1),\n\nSOC_SINGLE_TLV(\"HPMIXL IN4L Volume\", WM8962_HEADPHONE_MIXER_3,\n\t       3, 7, 0, bypass_tlv),\nSOC_SINGLE_TLV(\"HPMIXL IN4R Volume\", WM8962_HEADPHONE_MIXER_3,\n\t       0, 7, 0, bypass_tlv),\nSOC_SINGLE_TLV(\"HPMIXL MIXINL Volume\", WM8962_HEADPHONE_MIXER_3,\n\t       7, 1, 1, inmix_tlv),\nSOC_SINGLE_TLV(\"HPMIXL MIXINR Volume\", WM8962_HEADPHONE_MIXER_3,\n\t       6, 1, 1, inmix_tlv),\n\nSOC_SINGLE_TLV(\"HPMIXR IN4L Volume\", WM8962_HEADPHONE_MIXER_4,\n\t       3, 7, 0, bypass_tlv),\nSOC_SINGLE_TLV(\"HPMIXR IN4R Volume\", WM8962_HEADPHONE_MIXER_4,\n\t       0, 7, 0, bypass_tlv),\nSOC_SINGLE_TLV(\"HPMIXR MIXINL Volume\", WM8962_HEADPHONE_MIXER_4,\n\t       7, 1, 1, inmix_tlv),\nSOC_SINGLE_TLV(\"HPMIXR MIXINR Volume\", WM8962_HEADPHONE_MIXER_4,\n\t       6, 1, 1, inmix_tlv),\n\nSOC_SINGLE_TLV(\"Speaker Boost Volume\", WM8962_CLASS_D_CONTROL_2, 0, 7, 0,\n\t       classd_tlv),\n\nSOC_SINGLE(\"EQ Switch\", WM8962_EQ1, WM8962_EQ_ENA_SHIFT, 1, 0),\nSOC_DOUBLE_R_TLV(\"EQ1 Volume\", WM8962_EQ2, WM8962_EQ22,\n\t\t WM8962_EQL_B1_GAIN_SHIFT, 31, 0, eq_tlv),\nSOC_DOUBLE_R_TLV(\"EQ2 Volume\", WM8962_EQ2, WM8962_EQ22,\n\t\t WM8962_EQL_B2_GAIN_SHIFT, 31, 0, eq_tlv),\nSOC_DOUBLE_R_TLV(\"EQ3 Volume\", WM8962_EQ2, WM8962_EQ22,\n\t\t WM8962_EQL_B3_GAIN_SHIFT, 31, 0, eq_tlv),\nSOC_DOUBLE_R_TLV(\"EQ4 Volume\", WM8962_EQ3, WM8962_EQ23,\n\t\t WM8962_EQL_B4_GAIN_SHIFT, 31, 0, eq_tlv),\nSOC_DOUBLE_R_TLV(\"EQ5 Volume\", WM8962_EQ3, WM8962_EQ23,\n\t\t WM8962_EQL_B5_GAIN_SHIFT, 31, 0, eq_tlv),\nSND_SOC_BYTES(\"EQL Coefficients\", WM8962_EQ4, 18),\nSND_SOC_BYTES(\"EQR Coefficients\", WM8962_EQ24, 18),\n\n\nSOC_SINGLE(\"3D Switch\", WM8962_THREED1, 0, 1, 0),\nSND_SOC_BYTES_MASK(\"3D Coefficients\", WM8962_THREED1, 4, WM8962_THREED_ENA),\n\nSOC_SINGLE(\"DF1 Switch\", WM8962_DF1, 0, 1, 0),\nSND_SOC_BYTES_MASK(\"DF1 Coefficients\", WM8962_DF1, 7, WM8962_DF1_ENA),\n\nSOC_SINGLE(\"DRC Switch\", WM8962_DRC_1, 0, 1, 0),\nSND_SOC_BYTES_MASK(\"DRC Coefficients\", WM8962_DRC_1, 5, WM8962_DRC_ENA),\n\nWM8962_DSP2_ENABLE(\"VSS Switch\", WM8962_VSS_ENA_SHIFT),\nSND_SOC_BYTES(\"VSS Coefficients\", WM8962_VSS_XHD2_1, 148),\nWM8962_DSP2_ENABLE(\"HPF1 Switch\", WM8962_HPF1_ENA_SHIFT),\nWM8962_DSP2_ENABLE(\"HPF2 Switch\", WM8962_HPF2_ENA_SHIFT),\nSND_SOC_BYTES(\"HPF Coefficients\", WM8962_LHPF2, 1),\nWM8962_DSP2_ENABLE(\"HD Bass Switch\", WM8962_HDBASS_ENA_SHIFT),\nSND_SOC_BYTES(\"HD Bass Coefficients\", WM8962_HDBASS_AI_1, 30),\n\nSOC_DOUBLE(\"ALC Switch\", WM8962_ALC1, WM8962_ALCL_ENA_SHIFT,\n\t\tWM8962_ALCR_ENA_SHIFT, 1, 0),\nSND_SOC_BYTES_MASK(\"ALC Coefficients\", WM8962_ALC1, 4,\n\t\tWM8962_ALCL_ENA_MASK | WM8962_ALCR_ENA_MASK),\n};\n\nstatic const struct snd_kcontrol_new wm8962_spk_mono_controls[] = {\nSOC_SINGLE_TLV(\"Speaker Volume\", WM8962_SPKOUTL_VOLUME, 0, 127, 0, out_tlv),\nSOC_SINGLE_EXT(\"Speaker Switch\", WM8962_CLASS_D_CONTROL_1, 1, 1, 1,\n\t       snd_soc_get_volsw, wm8962_put_spk_sw),\nSOC_SINGLE(\"Speaker ZC Switch\", WM8962_SPKOUTL_VOLUME, 7, 1, 0),\n\nSOC_SINGLE(\"Speaker Mixer Switch\", WM8962_SPEAKER_MIXER_3, 8, 1, 1),\nSOC_SINGLE_TLV(\"Speaker Mixer IN4L Volume\", WM8962_SPEAKER_MIXER_3,\n\t       3, 7, 0, bypass_tlv),\nSOC_SINGLE_TLV(\"Speaker Mixer IN4R Volume\", WM8962_SPEAKER_MIXER_3,\n\t       0, 7, 0, bypass_tlv),\nSOC_SINGLE_TLV(\"Speaker Mixer MIXINL Volume\", WM8962_SPEAKER_MIXER_3,\n\t       7, 1, 1, inmix_tlv),\nSOC_SINGLE_TLV(\"Speaker Mixer MIXINR Volume\", WM8962_SPEAKER_MIXER_3,\n\t       6, 1, 1, inmix_tlv),\nSOC_SINGLE_TLV(\"Speaker Mixer DACL Volume\", WM8962_SPEAKER_MIXER_5,\n\t       7, 1, 0, inmix_tlv),\nSOC_SINGLE_TLV(\"Speaker Mixer DACR Volume\", WM8962_SPEAKER_MIXER_5,\n\t       6, 1, 0, inmix_tlv),\n};\n\nstatic const struct snd_kcontrol_new wm8962_spk_stereo_controls[] = {\nSOC_DOUBLE_R_TLV(\"Speaker Volume\", WM8962_SPKOUTL_VOLUME,\n\t\t WM8962_SPKOUTR_VOLUME, 0, 127, 0, out_tlv),\nSOC_DOUBLE_EXT(\"Speaker Switch\", WM8962_CLASS_D_CONTROL_1, 1, 0, 1, 1,\n\t       snd_soc_get_volsw, wm8962_put_spk_sw),\nSOC_DOUBLE_R(\"Speaker ZC Switch\", WM8962_SPKOUTL_VOLUME, WM8962_SPKOUTR_VOLUME,\n\t     7, 1, 0),\n\nSOC_DOUBLE_R(\"Speaker Mixer Switch\", WM8962_SPEAKER_MIXER_3,\n\t     WM8962_SPEAKER_MIXER_4, 8, 1, 1),\n\nSOC_SINGLE_TLV(\"SPKOUTL Mixer IN4L Volume\", WM8962_SPEAKER_MIXER_3,\n\t       3, 7, 0, bypass_tlv),\nSOC_SINGLE_TLV(\"SPKOUTL Mixer IN4R Volume\", WM8962_SPEAKER_MIXER_3,\n\t       0, 7, 0, bypass_tlv),\nSOC_SINGLE_TLV(\"SPKOUTL Mixer MIXINL Volume\", WM8962_SPEAKER_MIXER_3,\n\t       7, 1, 1, inmix_tlv),\nSOC_SINGLE_TLV(\"SPKOUTL Mixer MIXINR Volume\", WM8962_SPEAKER_MIXER_3,\n\t       6, 1, 1, inmix_tlv),\nSOC_SINGLE_TLV(\"SPKOUTL Mixer DACL Volume\", WM8962_SPEAKER_MIXER_5,\n\t       7, 1, 0, inmix_tlv),\nSOC_SINGLE_TLV(\"SPKOUTL Mixer DACR Volume\", WM8962_SPEAKER_MIXER_5,\n\t       6, 1, 0, inmix_tlv),\n\nSOC_SINGLE_TLV(\"SPKOUTR Mixer IN4L Volume\", WM8962_SPEAKER_MIXER_4,\n\t       3, 7, 0, bypass_tlv),\nSOC_SINGLE_TLV(\"SPKOUTR Mixer IN4R Volume\", WM8962_SPEAKER_MIXER_4,\n\t       0, 7, 0, bypass_tlv),\nSOC_SINGLE_TLV(\"SPKOUTR Mixer MIXINL Volume\", WM8962_SPEAKER_MIXER_4,\n\t       7, 1, 1, inmix_tlv),\nSOC_SINGLE_TLV(\"SPKOUTR Mixer MIXINR Volume\", WM8962_SPEAKER_MIXER_4,\n\t       6, 1, 1, inmix_tlv),\nSOC_SINGLE_TLV(\"SPKOUTR Mixer DACL Volume\", WM8962_SPEAKER_MIXER_5,\n\t       5, 1, 0, inmix_tlv),\nSOC_SINGLE_TLV(\"SPKOUTR Mixer DACR Volume\", WM8962_SPEAKER_MIXER_5,\n\t       4, 1, 0, inmix_tlv),\n};\n\nstatic int tp_event(struct snd_soc_dapm_widget *w,\n\t\t    struct snd_kcontrol *kcontrol, int event)\n{\n\tint ret, reg, val, mask;\n\tstruct snd_soc_component *component = snd_soc_dapm_to_component(w->dapm);\n\n\tret = pm_runtime_resume_and_get(component->dev);\n\tif (ret < 0) {\n\t\tdev_err(component->dev, \"Failed to resume device: %d\\n\", ret);\n\t\treturn ret;\n\t}\n\n\treg = WM8962_ADDITIONAL_CONTROL_4;\n\n\tif (!strcmp(w->name, \"TEMP_HP\")) {\n\t\tmask = WM8962_TEMP_ENA_HP_MASK;\n\t\tval = WM8962_TEMP_ENA_HP;\n\t} else if (!strcmp(w->name, \"TEMP_SPK\")) {\n\t\tmask = WM8962_TEMP_ENA_SPK_MASK;\n\t\tval = WM8962_TEMP_ENA_SPK;\n\t} else {\n\t\tpm_runtime_put(component->dev);\n\t\treturn -EINVAL;\n\t}\n\n\tswitch (event) {\n\tcase SND_SOC_DAPM_POST_PMD:\n\t\tval = 0;\n\t\tfallthrough;\n\tcase SND_SOC_DAPM_POST_PMU:\n\t\tret = snd_soc_component_update_bits(component, reg, mask, val);\n\t\tbreak;\n\tdefault:\n\t\tWARN(1, \"Invalid event %d\\n\", event);\n\t\tpm_runtime_put(component->dev);\n\t\treturn -EINVAL;\n\t}\n\n\tpm_runtime_put(component->dev);\n\n\treturn 0;\n}\n\nstatic int cp_event(struct snd_soc_dapm_widget *w,\n\t\t    struct snd_kcontrol *kcontrol, int event)\n{\n\tswitch (event) {\n\tcase SND_SOC_DAPM_POST_PMU:\n\t\tmsleep(5);\n\t\tbreak;\n\n\tdefault:\n\t\tWARN(1, \"Invalid event %d\\n\", event);\n\t\treturn -EINVAL;\n\t}\n\n\treturn 0;\n}\n\nstatic int hp_event(struct snd_soc_dapm_widget *w,\n\t\t    struct snd_kcontrol *kcontrol, int event)\n{\n\tstruct snd_soc_component *component = snd_soc_dapm_to_component(w->dapm);\n\tint timeout;\n\tint reg;\n\tint expected = (WM8962_DCS_STARTUP_DONE_HP1L |\n\t\t\tWM8962_DCS_STARTUP_DONE_HP1R);\n\n\tswitch (event) {\n\tcase SND_SOC_DAPM_POST_PMU:\n\t\tsnd_soc_component_update_bits(component, WM8962_ANALOGUE_HP_0,\n\t\t\t\t    WM8962_HP1L_ENA | WM8962_HP1R_ENA,\n\t\t\t\t    WM8962_HP1L_ENA | WM8962_HP1R_ENA);\n\t\tudelay(20);\n\n\t\tsnd_soc_component_update_bits(component, WM8962_ANALOGUE_HP_0,\n\t\t\t\t    WM8962_HP1L_ENA_DLY | WM8962_HP1R_ENA_DLY,\n\t\t\t\t    WM8962_HP1L_ENA_DLY | WM8962_HP1R_ENA_DLY);\n\n\t\t \n\t\tsnd_soc_component_update_bits(component, WM8962_DC_SERVO_1,\n\t\t\t\t    WM8962_HP1L_DCS_ENA | WM8962_HP1R_DCS_ENA |\n\t\t\t\t    WM8962_HP1L_DCS_STARTUP |\n\t\t\t\t    WM8962_HP1R_DCS_STARTUP,\n\t\t\t\t    WM8962_HP1L_DCS_ENA | WM8962_HP1R_DCS_ENA |\n\t\t\t\t    WM8962_HP1L_DCS_STARTUP |\n\t\t\t\t    WM8962_HP1R_DCS_STARTUP);\n\n\t\t \n\t\ttimeout = 0;\n\t\tdo {\n\t\t\tmsleep(1);\n\t\t\treg = snd_soc_component_read(component, WM8962_DC_SERVO_6);\n\t\t\tif (reg < 0) {\n\t\t\t\tdev_err(component->dev,\n\t\t\t\t\t\"Failed to read DCS status: %d\\n\",\n\t\t\t\t\treg);\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tdev_dbg(component->dev, \"DCS status: %x\\n\", reg);\n\t\t} while (++timeout < 200 && (reg & expected) != expected);\n\n\t\tif ((reg & expected) != expected)\n\t\t\tdev_err(component->dev, \"DC servo timed out\\n\");\n\t\telse\n\t\t\tdev_dbg(component->dev, \"DC servo complete after %dms\\n\",\n\t\t\t\ttimeout);\n\n\t\tsnd_soc_component_update_bits(component, WM8962_ANALOGUE_HP_0,\n\t\t\t\t    WM8962_HP1L_ENA_OUTP |\n\t\t\t\t    WM8962_HP1R_ENA_OUTP,\n\t\t\t\t    WM8962_HP1L_ENA_OUTP |\n\t\t\t\t    WM8962_HP1R_ENA_OUTP);\n\t\tudelay(20);\n\n\t\tsnd_soc_component_update_bits(component, WM8962_ANALOGUE_HP_0,\n\t\t\t\t    WM8962_HP1L_RMV_SHORT |\n\t\t\t\t    WM8962_HP1R_RMV_SHORT,\n\t\t\t\t    WM8962_HP1L_RMV_SHORT |\n\t\t\t\t    WM8962_HP1R_RMV_SHORT);\n\t\tbreak;\n\n\tcase SND_SOC_DAPM_PRE_PMD:\n\t\tsnd_soc_component_update_bits(component, WM8962_ANALOGUE_HP_0,\n\t\t\t\t    WM8962_HP1L_RMV_SHORT |\n\t\t\t\t    WM8962_HP1R_RMV_SHORT, 0);\n\n\t\tudelay(20);\n\n\t\tsnd_soc_component_update_bits(component, WM8962_DC_SERVO_1,\n\t\t\t\t    WM8962_HP1L_DCS_ENA | WM8962_HP1R_DCS_ENA |\n\t\t\t\t    WM8962_HP1L_DCS_STARTUP |\n\t\t\t\t    WM8962_HP1R_DCS_STARTUP,\n\t\t\t\t    0);\n\n\t\tsnd_soc_component_update_bits(component, WM8962_ANALOGUE_HP_0,\n\t\t\t\t    WM8962_HP1L_ENA | WM8962_HP1R_ENA |\n\t\t\t\t    WM8962_HP1L_ENA_DLY | WM8962_HP1R_ENA_DLY |\n\t\t\t\t    WM8962_HP1L_ENA_OUTP |\n\t\t\t\t    WM8962_HP1R_ENA_OUTP, 0);\n\t\t\t\t    \n\t\tbreak;\n\n\tdefault:\n\t\tWARN(1, \"Invalid event %d\\n\", event);\n\t\treturn -EINVAL;\n\t\n\t}\n\n\treturn 0;\n}\n\n \nstatic int out_pga_event(struct snd_soc_dapm_widget *w,\n\t\t\t struct snd_kcontrol *kcontrol, int event)\n{\n\tstruct snd_soc_component *component = snd_soc_dapm_to_component(w->dapm);\n\tint reg;\n\n\tswitch (w->shift) {\n\tcase WM8962_HPOUTR_PGA_ENA_SHIFT:\n\t\treg = WM8962_HPOUTR_VOLUME;\n\t\tbreak;\n\tcase WM8962_HPOUTL_PGA_ENA_SHIFT:\n\t\treg = WM8962_HPOUTL_VOLUME;\n\t\tbreak;\n\tcase WM8962_SPKOUTR_PGA_ENA_SHIFT:\n\t\treg = WM8962_SPKOUTR_VOLUME;\n\t\tbreak;\n\tcase WM8962_SPKOUTL_PGA_ENA_SHIFT:\n\t\treg = WM8962_SPKOUTL_VOLUME;\n\t\tbreak;\n\tdefault:\n\t\tWARN(1, \"Invalid shift %d\\n\", w->shift);\n\t\treturn -EINVAL;\n\t}\n\n\tswitch (event) {\n\tcase SND_SOC_DAPM_POST_PMU:\n\t\treturn snd_soc_component_write(component, reg,\n\t\t\tsnd_soc_component_read(component, reg));\n\tdefault:\n\t\tWARN(1, \"Invalid event %d\\n\", event);\n\t\treturn -EINVAL;\n\t}\n}\n\nstatic int dsp2_event(struct snd_soc_dapm_widget *w,\n\t\t      struct snd_kcontrol *kcontrol, int event)\n{\n\tstruct snd_soc_component *component = snd_soc_dapm_to_component(w->dapm);\n\tstruct wm8962_priv *wm8962 = snd_soc_component_get_drvdata(component);\n\n\tswitch (event) {\n\tcase SND_SOC_DAPM_POST_PMU:\n\t\tif (wm8962->dsp2_ena)\n\t\t\twm8962_dsp2_start(component);\n\t\tbreak;\n\n\tcase SND_SOC_DAPM_PRE_PMD:\n\t\tif (wm8962->dsp2_ena)\n\t\t\twm8962_dsp2_stop(component);\n\t\tbreak;\n\n\tdefault:\n\t\tWARN(1, \"Invalid event %d\\n\", event);\n\t\treturn -EINVAL;\n\t}\n\n\treturn 0;\n}\n\nstatic const char *st_text[] = { \"None\", \"Left\", \"Right\" };\n\nstatic SOC_ENUM_SINGLE_DECL(str_enum,\n\t\t\t    WM8962_DAC_DSP_MIXING_1, 2, st_text);\n\nstatic const struct snd_kcontrol_new str_mux =\n\tSOC_DAPM_ENUM(\"Right Sidetone\", str_enum);\n\nstatic SOC_ENUM_SINGLE_DECL(stl_enum,\n\t\t\t    WM8962_DAC_DSP_MIXING_2, 2, st_text);\n\nstatic const struct snd_kcontrol_new stl_mux =\n\tSOC_DAPM_ENUM(\"Left Sidetone\", stl_enum);\n\nstatic const char *outmux_text[] = { \"DAC\", \"Mixer\" };\n\nstatic SOC_ENUM_SINGLE_DECL(spkoutr_enum,\n\t\t\t    WM8962_SPEAKER_MIXER_2, 7, outmux_text);\n\nstatic const struct snd_kcontrol_new spkoutr_mux =\n\tSOC_DAPM_ENUM(\"SPKOUTR Mux\", spkoutr_enum);\n\nstatic SOC_ENUM_SINGLE_DECL(spkoutl_enum,\n\t\t\t    WM8962_SPEAKER_MIXER_1, 7, outmux_text);\n\nstatic const struct snd_kcontrol_new spkoutl_mux =\n\tSOC_DAPM_ENUM(\"SPKOUTL Mux\", spkoutl_enum);\n\nstatic SOC_ENUM_SINGLE_DECL(hpoutr_enum,\n\t\t\t    WM8962_HEADPHONE_MIXER_2, 7, outmux_text);\n\nstatic const struct snd_kcontrol_new hpoutr_mux =\n\tSOC_DAPM_ENUM(\"HPOUTR Mux\", hpoutr_enum);\n\nstatic SOC_ENUM_SINGLE_DECL(hpoutl_enum,\n\t\t\t    WM8962_HEADPHONE_MIXER_1, 7, outmux_text);\n\nstatic const struct snd_kcontrol_new hpoutl_mux =\n\tSOC_DAPM_ENUM(\"HPOUTL Mux\", hpoutl_enum);\n\nstatic const char * const input_mode_text[] = { \"Analog\", \"Digital\" };\n\nstatic SOC_ENUM_SINGLE_VIRT_DECL(input_mode_enum, input_mode_text);\n\nstatic const struct snd_kcontrol_new input_mode_mux =\n\tSOC_DAPM_ENUM(\"Input Mode\", input_mode_enum);\n\nstatic const struct snd_kcontrol_new inpgal[] = {\nSOC_DAPM_SINGLE(\"IN1L Switch\", WM8962_LEFT_INPUT_PGA_CONTROL, 3, 1, 0),\nSOC_DAPM_SINGLE(\"IN2L Switch\", WM8962_LEFT_INPUT_PGA_CONTROL, 2, 1, 0),\nSOC_DAPM_SINGLE(\"IN3L Switch\", WM8962_LEFT_INPUT_PGA_CONTROL, 1, 1, 0),\nSOC_DAPM_SINGLE(\"IN4L Switch\", WM8962_LEFT_INPUT_PGA_CONTROL, 0, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new inpgar[] = {\nSOC_DAPM_SINGLE(\"IN1R Switch\", WM8962_RIGHT_INPUT_PGA_CONTROL, 3, 1, 0),\nSOC_DAPM_SINGLE(\"IN2R Switch\", WM8962_RIGHT_INPUT_PGA_CONTROL, 2, 1, 0),\nSOC_DAPM_SINGLE(\"IN3R Switch\", WM8962_RIGHT_INPUT_PGA_CONTROL, 1, 1, 0),\nSOC_DAPM_SINGLE(\"IN4R Switch\", WM8962_RIGHT_INPUT_PGA_CONTROL, 0, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new mixinl[] = {\nSOC_DAPM_SINGLE(\"IN2L Switch\", WM8962_INPUT_MIXER_CONTROL_2, 5, 1, 0),\nSOC_DAPM_SINGLE(\"IN3L Switch\", WM8962_INPUT_MIXER_CONTROL_2, 4, 1, 0),\nSOC_DAPM_SINGLE(\"PGA Switch\", WM8962_INPUT_MIXER_CONTROL_2, 3, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new mixinr[] = {\nSOC_DAPM_SINGLE(\"IN2R Switch\", WM8962_INPUT_MIXER_CONTROL_2, 2, 1, 0),\nSOC_DAPM_SINGLE(\"IN3R Switch\", WM8962_INPUT_MIXER_CONTROL_2, 1, 1, 0),\nSOC_DAPM_SINGLE(\"PGA Switch\", WM8962_INPUT_MIXER_CONTROL_2, 0, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new hpmixl[] = {\nSOC_DAPM_SINGLE(\"DACL Switch\", WM8962_HEADPHONE_MIXER_1, 5, 1, 0),\nSOC_DAPM_SINGLE(\"DACR Switch\", WM8962_HEADPHONE_MIXER_1, 4, 1, 0),\nSOC_DAPM_SINGLE(\"MIXINL Switch\", WM8962_HEADPHONE_MIXER_1, 3, 1, 0),\nSOC_DAPM_SINGLE(\"MIXINR Switch\", WM8962_HEADPHONE_MIXER_1, 2, 1, 0),\nSOC_DAPM_SINGLE(\"IN4L Switch\", WM8962_HEADPHONE_MIXER_1, 1, 1, 0),\nSOC_DAPM_SINGLE(\"IN4R Switch\", WM8962_HEADPHONE_MIXER_1, 0, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new hpmixr[] = {\nSOC_DAPM_SINGLE(\"DACL Switch\", WM8962_HEADPHONE_MIXER_2, 5, 1, 0),\nSOC_DAPM_SINGLE(\"DACR Switch\", WM8962_HEADPHONE_MIXER_2, 4, 1, 0),\nSOC_DAPM_SINGLE(\"MIXINL Switch\", WM8962_HEADPHONE_MIXER_2, 3, 1, 0),\nSOC_DAPM_SINGLE(\"MIXINR Switch\", WM8962_HEADPHONE_MIXER_2, 2, 1, 0),\nSOC_DAPM_SINGLE(\"IN4L Switch\", WM8962_HEADPHONE_MIXER_2, 1, 1, 0),\nSOC_DAPM_SINGLE(\"IN4R Switch\", WM8962_HEADPHONE_MIXER_2, 0, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new spkmixl[] = {\nSOC_DAPM_SINGLE(\"DACL Switch\", WM8962_SPEAKER_MIXER_1, 5, 1, 0),\nSOC_DAPM_SINGLE(\"DACR Switch\", WM8962_SPEAKER_MIXER_1, 4, 1, 0),\nSOC_DAPM_SINGLE(\"MIXINL Switch\", WM8962_SPEAKER_MIXER_1, 3, 1, 0),\nSOC_DAPM_SINGLE(\"MIXINR Switch\", WM8962_SPEAKER_MIXER_1, 2, 1, 0),\nSOC_DAPM_SINGLE(\"IN4L Switch\", WM8962_SPEAKER_MIXER_1, 1, 1, 0),\nSOC_DAPM_SINGLE(\"IN4R Switch\", WM8962_SPEAKER_MIXER_1, 0, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new spkmixr[] = {\nSOC_DAPM_SINGLE(\"DACL Switch\", WM8962_SPEAKER_MIXER_2, 5, 1, 0),\nSOC_DAPM_SINGLE(\"DACR Switch\", WM8962_SPEAKER_MIXER_2, 4, 1, 0),\nSOC_DAPM_SINGLE(\"MIXINL Switch\", WM8962_SPEAKER_MIXER_2, 3, 1, 0),\nSOC_DAPM_SINGLE(\"MIXINR Switch\", WM8962_SPEAKER_MIXER_2, 2, 1, 0),\nSOC_DAPM_SINGLE(\"IN4L Switch\", WM8962_SPEAKER_MIXER_2, 1, 1, 0),\nSOC_DAPM_SINGLE(\"IN4R Switch\", WM8962_SPEAKER_MIXER_2, 0, 1, 0),\n};\n\nstatic const struct snd_soc_dapm_widget wm8962_dapm_widgets[] = {\nSND_SOC_DAPM_INPUT(\"IN1L\"),\nSND_SOC_DAPM_INPUT(\"IN1R\"),\nSND_SOC_DAPM_INPUT(\"IN2L\"),\nSND_SOC_DAPM_INPUT(\"IN2R\"),\nSND_SOC_DAPM_INPUT(\"IN3L\"),\nSND_SOC_DAPM_INPUT(\"IN3R\"),\nSND_SOC_DAPM_INPUT(\"IN4L\"),\nSND_SOC_DAPM_INPUT(\"IN4R\"),\nSND_SOC_DAPM_SIGGEN(\"Beep\"),\nSND_SOC_DAPM_INPUT(\"DMICDAT\"),\n\nSND_SOC_DAPM_SUPPLY(\"MICBIAS\", WM8962_PWR_MGMT_1, 1, 0, NULL, 0),\n\nSND_SOC_DAPM_SUPPLY(\"Class G\", WM8962_CHARGE_PUMP_B, 0, 1, NULL, 0),\nSND_SOC_DAPM_SUPPLY(\"SYSCLK\", WM8962_CLOCKING2, 5, 0, NULL, 0),\nSND_SOC_DAPM_SUPPLY(\"Charge Pump\", WM8962_CHARGE_PUMP_1, 0, 0, cp_event,\n\t\t    SND_SOC_DAPM_POST_PMU),\nSND_SOC_DAPM_SUPPLY(\"TOCLK\", WM8962_ADDITIONAL_CONTROL_1, 0, 0, NULL, 0),\nSND_SOC_DAPM_SUPPLY_S(\"DSP2\", 1, WM8962_DSP2_POWER_MANAGEMENT,\n\t\t      WM8962_DSP2_ENA_SHIFT, 0, dsp2_event,\n\t\t      SND_SOC_DAPM_POST_PMU | SND_SOC_DAPM_PRE_PMD),\nSND_SOC_DAPM_SUPPLY(\"TEMP_HP\", SND_SOC_NOPM, 0, 0, tp_event,\n\t\tSND_SOC_DAPM_POST_PMU|SND_SOC_DAPM_POST_PMD),\nSND_SOC_DAPM_SUPPLY(\"TEMP_SPK\", SND_SOC_NOPM, 0, 0, tp_event,\n\t\tSND_SOC_DAPM_POST_PMU|SND_SOC_DAPM_POST_PMD),\n\nSND_SOC_DAPM_MIXER(\"INPGAL\", WM8962_LEFT_INPUT_PGA_CONTROL, 4, 0,\n\t\t   inpgal, ARRAY_SIZE(inpgal)),\nSND_SOC_DAPM_MIXER(\"INPGAR\", WM8962_RIGHT_INPUT_PGA_CONTROL, 4, 0,\n\t\t   inpgar, ARRAY_SIZE(inpgar)),\nSND_SOC_DAPM_MIXER(\"MIXINL\", WM8962_PWR_MGMT_1, 5, 0,\n\t\t   mixinl, ARRAY_SIZE(mixinl)),\nSND_SOC_DAPM_MIXER(\"MIXINR\", WM8962_PWR_MGMT_1, 4, 0,\n\t\t   mixinr, ARRAY_SIZE(mixinr)),\n\nSND_SOC_DAPM_AIF_IN(\"DMIC_ENA\", NULL, 0, WM8962_PWR_MGMT_1, 10, 0),\n\nSND_SOC_DAPM_MUX(\"Input Mode L\", SND_SOC_NOPM, 0, 0, &input_mode_mux),\nSND_SOC_DAPM_MUX(\"Input Mode R\", SND_SOC_NOPM, 0, 0, &input_mode_mux),\n\nSND_SOC_DAPM_ADC(\"ADCL\", \"Capture\", WM8962_PWR_MGMT_1, 3, 0),\nSND_SOC_DAPM_ADC(\"ADCR\", \"Capture\", WM8962_PWR_MGMT_1, 2, 0),\n\nSND_SOC_DAPM_MUX(\"STL\", SND_SOC_NOPM, 0, 0, &stl_mux),\nSND_SOC_DAPM_MUX(\"STR\", SND_SOC_NOPM, 0, 0, &str_mux),\n\nSND_SOC_DAPM_DAC(\"DACL\", \"Playback\", WM8962_PWR_MGMT_2, 8, 0),\nSND_SOC_DAPM_DAC(\"DACR\", \"Playback\", WM8962_PWR_MGMT_2, 7, 0),\n\nSND_SOC_DAPM_PGA(\"Left Bypass\", SND_SOC_NOPM, 0, 0, NULL, 0),\nSND_SOC_DAPM_PGA(\"Right Bypass\", SND_SOC_NOPM, 0, 0, NULL, 0),\n\nSND_SOC_DAPM_MIXER(\"HPMIXL\", WM8962_MIXER_ENABLES, 3, 0,\n\t\t   hpmixl, ARRAY_SIZE(hpmixl)),\nSND_SOC_DAPM_MIXER(\"HPMIXR\", WM8962_MIXER_ENABLES, 2, 0,\n\t\t   hpmixr, ARRAY_SIZE(hpmixr)),\n\nSND_SOC_DAPM_MUX_E(\"HPOUTL PGA\", WM8962_PWR_MGMT_2, 6, 0, &hpoutl_mux,\n\t\t   out_pga_event, SND_SOC_DAPM_POST_PMU),\nSND_SOC_DAPM_MUX_E(\"HPOUTR PGA\", WM8962_PWR_MGMT_2, 5, 0, &hpoutr_mux,\n\t\t   out_pga_event, SND_SOC_DAPM_POST_PMU),\n\nSND_SOC_DAPM_PGA_E(\"HPOUT\", SND_SOC_NOPM, 0, 0, NULL, 0, hp_event,\n\t\t   SND_SOC_DAPM_POST_PMU | SND_SOC_DAPM_PRE_PMD),\n\nSND_SOC_DAPM_OUTPUT(\"HPOUTL\"),\nSND_SOC_DAPM_OUTPUT(\"HPOUTR\"),\n};\n\nstatic const struct snd_soc_dapm_widget wm8962_dapm_spk_mono_widgets[] = {\nSND_SOC_DAPM_MIXER(\"Speaker Mixer\", WM8962_MIXER_ENABLES, 1, 0,\n\t\t   spkmixl, ARRAY_SIZE(spkmixl)),\nSND_SOC_DAPM_MUX_E(\"Speaker PGA\", WM8962_PWR_MGMT_2, 4, 0, &spkoutl_mux,\n\t\t   out_pga_event, SND_SOC_DAPM_POST_PMU),\nSND_SOC_DAPM_PGA(\"Speaker Output\", WM8962_CLASS_D_CONTROL_1, 7, 0, NULL, 0),\nSND_SOC_DAPM_OUTPUT(\"SPKOUT\"),\n};\n\nstatic const struct snd_soc_dapm_widget wm8962_dapm_spk_stereo_widgets[] = {\nSND_SOC_DAPM_MIXER(\"SPKOUTL Mixer\", WM8962_MIXER_ENABLES, 1, 0,\n\t\t   spkmixl, ARRAY_SIZE(spkmixl)),\nSND_SOC_DAPM_MIXER(\"SPKOUTR Mixer\", WM8962_MIXER_ENABLES, 0, 0,\n\t\t   spkmixr, ARRAY_SIZE(spkmixr)),\n\nSND_SOC_DAPM_MUX_E(\"SPKOUTL PGA\", WM8962_PWR_MGMT_2, 4, 0, &spkoutl_mux,\n\t\t   out_pga_event, SND_SOC_DAPM_POST_PMU),\nSND_SOC_DAPM_MUX_E(\"SPKOUTR PGA\", WM8962_PWR_MGMT_2, 3, 0, &spkoutr_mux,\n\t\t   out_pga_event, SND_SOC_DAPM_POST_PMU),\n\nSND_SOC_DAPM_PGA(\"SPKOUTR Output\", WM8962_CLASS_D_CONTROL_1, 7, 0, NULL, 0),\nSND_SOC_DAPM_PGA(\"SPKOUTL Output\", WM8962_CLASS_D_CONTROL_1, 6, 0, NULL, 0),\n\nSND_SOC_DAPM_OUTPUT(\"SPKOUTL\"),\nSND_SOC_DAPM_OUTPUT(\"SPKOUTR\"),\n};\n\nstatic const struct snd_soc_dapm_route wm8962_intercon[] = {\n\t{ \"INPGAL\", \"IN1L Switch\", \"IN1L\" },\n\t{ \"INPGAL\", \"IN2L Switch\", \"IN2L\" },\n\t{ \"INPGAL\", \"IN3L Switch\", \"IN3L\" },\n\t{ \"INPGAL\", \"IN4L Switch\", \"IN4L\" },\n\n\t{ \"INPGAR\", \"IN1R Switch\", \"IN1R\" },\n\t{ \"INPGAR\", \"IN2R Switch\", \"IN2R\" },\n\t{ \"INPGAR\", \"IN3R Switch\", \"IN3R\" },\n\t{ \"INPGAR\", \"IN4R Switch\", \"IN4R\" },\n\n\t{ \"MIXINL\", \"IN2L Switch\", \"IN2L\" },\n\t{ \"MIXINL\", \"IN3L Switch\", \"IN3L\" },\n\t{ \"MIXINL\", \"PGA Switch\", \"INPGAL\" },\n\n\t{ \"MIXINR\", \"IN2R Switch\", \"IN2R\" },\n\t{ \"MIXINR\", \"IN3R Switch\", \"IN3R\" },\n\t{ \"MIXINR\", \"PGA Switch\", \"INPGAR\" },\n\n\t{ \"MICBIAS\", NULL, \"SYSCLK\" },\n\n\t{ \"DMIC_ENA\", NULL, \"DMICDAT\" },\n\n\t{ \"Input Mode L\", \"Analog\", \"MIXINL\" },\n\t{ \"Input Mode L\", \"Digital\", \"DMIC_ENA\" },\n\t{ \"Input Mode R\", \"Analog\", \"MIXINR\" },\n\t{ \"Input Mode R\", \"Digital\", \"DMIC_ENA\" },\n\n\t{ \"ADCL\", NULL, \"SYSCLK\" },\n\t{ \"ADCL\", NULL, \"TOCLK\" },\n\t{ \"ADCL\", NULL, \"Input Mode L\" },\n\t{ \"ADCL\", NULL, \"DSP2\" },\n\n\t{ \"ADCR\", NULL, \"SYSCLK\" },\n\t{ \"ADCR\", NULL, \"TOCLK\" },\n\t{ \"ADCR\", NULL, \"Input Mode R\" },\n\t{ \"ADCR\", NULL, \"DSP2\" },\n\n\t{ \"STL\", \"Left\", \"ADCL\" },\n\t{ \"STL\", \"Right\", \"ADCR\" },\n\t{ \"STL\", NULL, \"Class G\" },\n\n\t{ \"STR\", \"Left\", \"ADCL\" },\n\t{ \"STR\", \"Right\", \"ADCR\" },\n\t{ \"STR\", NULL, \"Class G\" },\n\n\t{ \"DACL\", NULL, \"SYSCLK\" },\n\t{ \"DACL\", NULL, \"TOCLK\" },\n\t{ \"DACL\", NULL, \"Beep\" },\n\t{ \"DACL\", NULL, \"STL\" },\n\t{ \"DACL\", NULL, \"DSP2\" },\n\n\t{ \"DACR\", NULL, \"SYSCLK\" },\n\t{ \"DACR\", NULL, \"TOCLK\" },\n\t{ \"DACR\", NULL, \"Beep\" },\n\t{ \"DACR\", NULL, \"STR\" },\n\t{ \"DACR\", NULL, \"DSP2\" },\n\n\t{ \"HPMIXL\", \"IN4L Switch\", \"IN4L\" },\n\t{ \"HPMIXL\", \"IN4R Switch\", \"IN4R\" },\n\t{ \"HPMIXL\", \"DACL Switch\", \"DACL\" },\n\t{ \"HPMIXL\", \"DACR Switch\", \"DACR\" },\n\t{ \"HPMIXL\", \"MIXINL Switch\", \"MIXINL\" },\n\t{ \"HPMIXL\", \"MIXINR Switch\", \"MIXINR\" },\n\n\t{ \"HPMIXR\", \"IN4L Switch\", \"IN4L\" },\n\t{ \"HPMIXR\", \"IN4R Switch\", \"IN4R\" },\n\t{ \"HPMIXR\", \"DACL Switch\", \"DACL\" },\n\t{ \"HPMIXR\", \"DACR Switch\", \"DACR\" },\n\t{ \"HPMIXR\", \"MIXINL Switch\", \"MIXINL\" },\n\t{ \"HPMIXR\", \"MIXINR Switch\", \"MIXINR\" },\n\n\t{ \"Left Bypass\", NULL, \"HPMIXL\" },\n\t{ \"Left Bypass\", NULL, \"Class G\" },\n\n\t{ \"Right Bypass\", NULL, \"HPMIXR\" },\n\t{ \"Right Bypass\", NULL, \"Class G\" },\n\n\t{ \"HPOUTL PGA\", \"Mixer\", \"Left Bypass\" },\n\t{ \"HPOUTL PGA\", \"DAC\", \"DACL\" },\n\n\t{ \"HPOUTR PGA\", \"Mixer\", \"Right Bypass\" },\n\t{ \"HPOUTR PGA\", \"DAC\", \"DACR\" },\n\n\t{ \"HPOUT\", NULL, \"HPOUTL PGA\" },\n\t{ \"HPOUT\", NULL, \"HPOUTR PGA\" },\n\t{ \"HPOUT\", NULL, \"Charge Pump\" },\n\t{ \"HPOUT\", NULL, \"SYSCLK\" },\n\t{ \"HPOUT\", NULL, \"TOCLK\" },\n\n\t{ \"HPOUTL\", NULL, \"HPOUT\" },\n\t{ \"HPOUTR\", NULL, \"HPOUT\" },\n\n\t{ \"HPOUTL\", NULL, \"TEMP_HP\" },\n\t{ \"HPOUTR\", NULL, \"TEMP_HP\" },\n};\n\nstatic const struct snd_soc_dapm_route wm8962_spk_mono_intercon[] = {\n\t{ \"Speaker Mixer\", \"IN4L Switch\", \"IN4L\" },\n\t{ \"Speaker Mixer\", \"IN4R Switch\", \"IN4R\" },\n\t{ \"Speaker Mixer\", \"DACL Switch\", \"DACL\" },\n\t{ \"Speaker Mixer\", \"DACR Switch\", \"DACR\" },\n\t{ \"Speaker Mixer\", \"MIXINL Switch\", \"MIXINL\" },\n\t{ \"Speaker Mixer\", \"MIXINR Switch\", \"MIXINR\" },\n\n\t{ \"Speaker PGA\", \"Mixer\", \"Speaker Mixer\" },\n\t{ \"Speaker PGA\", \"DAC\", \"DACL\" },\n\n\t{ \"Speaker Output\", NULL, \"Speaker PGA\" },\n\t{ \"Speaker Output\", NULL, \"SYSCLK\" },\n\t{ \"Speaker Output\", NULL, \"TOCLK\" },\n\t{ \"Speaker Output\", NULL, \"TEMP_SPK\" },\n\n\t{ \"SPKOUT\", NULL, \"Speaker Output\" },\n};\n\nstatic const struct snd_soc_dapm_route wm8962_spk_stereo_intercon[] = {\n\t{ \"SPKOUTL Mixer\", \"IN4L Switch\", \"IN4L\" },\n\t{ \"SPKOUTL Mixer\", \"IN4R Switch\", \"IN4R\" },\n\t{ \"SPKOUTL Mixer\", \"DACL Switch\", \"DACL\" },\n\t{ \"SPKOUTL Mixer\", \"DACR Switch\", \"DACR\" },\n\t{ \"SPKOUTL Mixer\", \"MIXINL Switch\", \"MIXINL\" },\n\t{ \"SPKOUTL Mixer\", \"MIXINR Switch\", \"MIXINR\" },\n\n\t{ \"SPKOUTR Mixer\", \"IN4L Switch\", \"IN4L\" },\n\t{ \"SPKOUTR Mixer\", \"IN4R Switch\", \"IN4R\" },\n\t{ \"SPKOUTR Mixer\", \"DACL Switch\", \"DACL\" },\n\t{ \"SPKOUTR Mixer\", \"DACR Switch\", \"DACR\" },\n\t{ \"SPKOUTR Mixer\", \"MIXINL Switch\", \"MIXINL\" },\n\t{ \"SPKOUTR Mixer\", \"MIXINR Switch\", \"MIXINR\" },\n\n\t{ \"SPKOUTL PGA\", \"Mixer\", \"SPKOUTL Mixer\" },\n\t{ \"SPKOUTL PGA\", \"DAC\", \"DACL\" },\n\n\t{ \"SPKOUTR PGA\", \"Mixer\", \"SPKOUTR Mixer\" },\n\t{ \"SPKOUTR PGA\", \"DAC\", \"DACR\" },\n\n\t{ \"SPKOUTL Output\", NULL, \"SPKOUTL PGA\" },\n\t{ \"SPKOUTL Output\", NULL, \"SYSCLK\" },\n\t{ \"SPKOUTL Output\", NULL, \"TOCLK\" },\n\t{ \"SPKOUTL Output\", NULL, \"TEMP_SPK\" },\n\n\t{ \"SPKOUTR Output\", NULL, \"SPKOUTR PGA\" },\n\t{ \"SPKOUTR Output\", NULL, \"SYSCLK\" },\n\t{ \"SPKOUTR Output\", NULL, \"TOCLK\" },\n\t{ \"SPKOUTR Output\", NULL, \"TEMP_SPK\" },\n\n\t{ \"SPKOUTL\", NULL, \"SPKOUTL Output\" },\n\t{ \"SPKOUTR\", NULL, \"SPKOUTR Output\" },\n};\n\nstatic int wm8962_add_widgets(struct snd_soc_component *component)\n{\n\tstruct wm8962_priv *wm8962 = snd_soc_component_get_drvdata(component);\n\tstruct wm8962_pdata *pdata = &wm8962->pdata;\n\tstruct snd_soc_dapm_context *dapm = snd_soc_component_get_dapm(component);\n\n\tsnd_soc_add_component_controls(component, wm8962_snd_controls,\n\t\t\t     ARRAY_SIZE(wm8962_snd_controls));\n\tif (pdata->spk_mono)\n\t\tsnd_soc_add_component_controls(component, wm8962_spk_mono_controls,\n\t\t\t\t     ARRAY_SIZE(wm8962_spk_mono_controls));\n\telse\n\t\tsnd_soc_add_component_controls(component, wm8962_spk_stereo_controls,\n\t\t\t\t     ARRAY_SIZE(wm8962_spk_stereo_controls));\n\n\n\tsnd_soc_dapm_new_controls(dapm, wm8962_dapm_widgets,\n\t\t\t\t  ARRAY_SIZE(wm8962_dapm_widgets));\n\tif (pdata->spk_mono)\n\t\tsnd_soc_dapm_new_controls(dapm, wm8962_dapm_spk_mono_widgets,\n\t\t\t\t\t  ARRAY_SIZE(wm8962_dapm_spk_mono_widgets));\n\telse\n\t\tsnd_soc_dapm_new_controls(dapm, wm8962_dapm_spk_stereo_widgets,\n\t\t\t\t\t  ARRAY_SIZE(wm8962_dapm_spk_stereo_widgets));\n\n\tsnd_soc_dapm_add_routes(dapm, wm8962_intercon,\n\t\t\t\tARRAY_SIZE(wm8962_intercon));\n\tif (pdata->spk_mono)\n\t\tsnd_soc_dapm_add_routes(dapm, wm8962_spk_mono_intercon,\n\t\t\t\t\tARRAY_SIZE(wm8962_spk_mono_intercon));\n\telse\n\t\tsnd_soc_dapm_add_routes(dapm, wm8962_spk_stereo_intercon,\n\t\t\t\t\tARRAY_SIZE(wm8962_spk_stereo_intercon));\n\n\n\tsnd_soc_dapm_disable_pin(dapm, \"Beep\");\n\n\treturn 0;\n}\n\n \nstatic const int bclk_divs[] = {\n\t1, -1, 2, 3, 4, -1, 6, 8, -1, 12, 16, 24, -1, 32, 32, 32\n};\n\nstatic const int sysclk_rates[] = {\n\t64, 128, 192, 256, 384, 512, 768, 1024, 1408, 1536, 3072, 6144\n};\n\nstatic void wm8962_configure_bclk(struct snd_soc_component *component)\n{\n\tstruct wm8962_priv *wm8962 = snd_soc_component_get_drvdata(component);\n\tint best, min_diff, diff;\n\tint dspclk, i;\n\tint clocking2 = 0;\n\tint clocking4 = 0;\n\tint aif2 = 0;\n\n\tif (!wm8962->sysclk_rate) {\n\t\tdev_dbg(component->dev, \"No SYSCLK configured\\n\");\n\t\treturn;\n\t}\n\n\tif (!wm8962->bclk || !wm8962->lrclk) {\n\t\tdev_dbg(component->dev, \"No audio clocks configured\\n\");\n\t\treturn;\n\t}\n\n\tfor (i = 0; i < ARRAY_SIZE(sysclk_rates); i++) {\n\t\tif (sysclk_rates[i] == wm8962->sysclk_rate / wm8962->lrclk) {\n\t\t\tclocking4 |= i << WM8962_SYSCLK_RATE_SHIFT;\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tif (i == ARRAY_SIZE(sysclk_rates)) {\n\t\tdev_err(component->dev, \"Unsupported sysclk ratio %d\\n\",\n\t\t\twm8962->sysclk_rate / wm8962->lrclk);\n\t\treturn;\n\t}\n\n\tdev_dbg(component->dev, \"Selected sysclk ratio %d\\n\", sysclk_rates[i]);\n\n\tsnd_soc_component_update_bits(component, WM8962_CLOCKING_4,\n\t\t\t    WM8962_SYSCLK_RATE_MASK, clocking4);\n\n\t \n\tif (snd_soc_component_get_bias_level(component) != SND_SOC_BIAS_ON)\n\t\tsnd_soc_component_update_bits(component, WM8962_CLOCKING2,\n\t\t\t\tWM8962_SYSCLK_ENA_MASK, WM8962_SYSCLK_ENA);\n\n\t \n\tusleep_range(500, 1000);\n\tdspclk = snd_soc_component_read(component, WM8962_CLOCKING1);\n\n\tif (snd_soc_component_get_bias_level(component) != SND_SOC_BIAS_ON)\n\t\tsnd_soc_component_update_bits(component, WM8962_CLOCKING2,\n\t\t\t\tWM8962_SYSCLK_ENA_MASK, 0);\n\n\tif (dspclk < 0) {\n\t\tdev_err(component->dev, \"Failed to read DSPCLK: %d\\n\", dspclk);\n\t\treturn;\n\t}\n\n\tdspclk = (dspclk & WM8962_DSPCLK_DIV_MASK) >> WM8962_DSPCLK_DIV_SHIFT;\n\tswitch (dspclk) {\n\tcase 0:\n\t\tdspclk = wm8962->sysclk_rate;\n\t\tbreak;\n\tcase 1:\n\t\tdspclk = wm8962->sysclk_rate / 2;\n\t\tbreak;\n\tcase 2:\n\t\tdspclk = wm8962->sysclk_rate / 4;\n\t\tbreak;\n\tdefault:\n\t\tdev_warn(component->dev, \"Unknown DSPCLK divisor read back\\n\");\n\t\tdspclk = wm8962->sysclk_rate;\n\t}\n\n\tdev_dbg(component->dev, \"DSPCLK is %dHz, BCLK %d\\n\", dspclk, wm8962->bclk);\n\n\t \n\tbest = 0;\n\tmin_diff = INT_MAX;\n\tfor (i = 0; i < ARRAY_SIZE(bclk_divs); i++) {\n\t\tif (bclk_divs[i] < 0)\n\t\t\tcontinue;\n\n\t\tdiff = (dspclk / bclk_divs[i]) - wm8962->bclk;\n\t\tif (diff < 0)  \n\t\t\tbreak;\n\t\tif (diff < min_diff) {\n\t\t\tbest = i;\n\t\t\tmin_diff = diff;\n\t\t}\n\t}\n\twm8962->bclk = dspclk / bclk_divs[best];\n\tclocking2 |= best;\n\tdev_dbg(component->dev, \"Selected BCLK_DIV %d for %dHz\\n\",\n\t\tbclk_divs[best], wm8962->bclk);\n\n\taif2 |= wm8962->bclk / wm8962->lrclk;\n\tdev_dbg(component->dev, \"Selected LRCLK divisor %d for %dHz\\n\",\n\t\twm8962->bclk / wm8962->lrclk, wm8962->lrclk);\n\n\tsnd_soc_component_update_bits(component, WM8962_CLOCKING2,\n\t\t\t    WM8962_BCLK_DIV_MASK, clocking2);\n\tsnd_soc_component_update_bits(component, WM8962_AUDIO_INTERFACE_2,\n\t\t\t    WM8962_AIF_RATE_MASK, aif2);\n}\n\nstatic int wm8962_set_bias_level(struct snd_soc_component *component,\n\t\t\t\t enum snd_soc_bias_level level)\n{\n\tswitch (level) {\n\tcase SND_SOC_BIAS_ON:\n\t\tbreak;\n\n\tcase SND_SOC_BIAS_PREPARE:\n\t\t \n\t\tsnd_soc_component_update_bits(component, WM8962_PWR_MGMT_1,\n\t\t\t\t    WM8962_VMID_SEL_MASK, 0x80);\n\n\t\twm8962_configure_bclk(component);\n\t\tbreak;\n\n\tcase SND_SOC_BIAS_STANDBY:\n\t\t \n\t\tsnd_soc_component_update_bits(component, WM8962_PWR_MGMT_1,\n\t\t\t\t    WM8962_VMID_SEL_MASK, 0x100);\n\n\t\tif (snd_soc_component_get_bias_level(component) == SND_SOC_BIAS_OFF)\n\t\t\tmsleep(100);\n\t\tbreak;\n\n\tcase SND_SOC_BIAS_OFF:\n\t\tbreak;\n\t}\n\n\treturn 0;\n}\n\nstatic const struct {\n\tint rate;\n\tint reg;\n} sr_vals[] = {\n\t{ 48000, 0 },\n\t{ 44100, 0 },\n\t{ 32000, 1 },\n\t{ 22050, 2 },\n\t{ 24000, 2 },\n\t{ 16000, 3 },\n\t{ 11025, 4 },\n\t{ 12000, 4 },\n\t{ 8000,  5 },\n\t{ 88200, 6 },\n\t{ 96000, 6 },\n};\n\nstatic int wm8962_hw_params(struct snd_pcm_substream *substream,\n\t\t\t    struct snd_pcm_hw_params *params,\n\t\t\t    struct snd_soc_dai *dai)\n{\n\tstruct snd_soc_component *component = dai->component;\n\tstruct wm8962_priv *wm8962 = snd_soc_component_get_drvdata(component);\n\tint i;\n\tint aif0 = 0;\n\tint adctl3 = 0;\n\n\twm8962->bclk = snd_soc_params_to_bclk(params);\n\tif (params_channels(params) == 1)\n\t\twm8962->bclk *= 2;\n\n\twm8962->lrclk = params_rate(params);\n\n\tfor (i = 0; i < ARRAY_SIZE(sr_vals); i++) {\n\t\tif (sr_vals[i].rate == wm8962->lrclk) {\n\t\t\tadctl3 |= sr_vals[i].reg;\n\t\t\tbreak;\n\t\t}\n\t}\n\tif (i == ARRAY_SIZE(sr_vals)) {\n\t\tdev_err(component->dev, \"Unsupported rate %dHz\\n\", wm8962->lrclk);\n\t\treturn -EINVAL;\n\t}\n\n\tif (wm8962->lrclk % 8000 == 0)\n\t\tadctl3 |= WM8962_SAMPLE_RATE_INT_MODE;\n\n\tswitch (params_width(params)) {\n\tcase 16:\n\t\tbreak;\n\tcase 20:\n\t\taif0 |= 0x4;\n\t\tbreak;\n\tcase 24:\n\t\taif0 |= 0x8;\n\t\tbreak;\n\tcase 32:\n\t\taif0 |= 0xc;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tsnd_soc_component_update_bits(component, WM8962_AUDIO_INTERFACE_0,\n\t\t\t    WM8962_WL_MASK, aif0);\n\tsnd_soc_component_update_bits(component, WM8962_ADDITIONAL_CONTROL_3,\n\t\t\t    WM8962_SAMPLE_RATE_INT_MODE |\n\t\t\t    WM8962_SAMPLE_RATE_MASK, adctl3);\n\n\tdev_dbg(component->dev, \"hw_params set BCLK %dHz LRCLK %dHz\\n\",\n\t\twm8962->bclk, wm8962->lrclk);\n\n\tif (snd_soc_component_get_bias_level(component) == SND_SOC_BIAS_ON)\n\t\twm8962_configure_bclk(component);\n\n\treturn 0;\n}\n\nstatic int wm8962_set_dai_sysclk(struct snd_soc_dai *dai, int clk_id,\n\t\t\t\t unsigned int freq, int dir)\n{\n\tstruct snd_soc_component *component = dai->component;\n\tstruct wm8962_priv *wm8962 = snd_soc_component_get_drvdata(component);\n\tint src;\n\n\tswitch (clk_id) {\n\tcase WM8962_SYSCLK_MCLK:\n\t\twm8962->sysclk = WM8962_SYSCLK_MCLK;\n\t\tsrc = 0;\n\t\tbreak;\n\tcase WM8962_SYSCLK_FLL:\n\t\twm8962->sysclk = WM8962_SYSCLK_FLL;\n\t\tsrc = 1 << WM8962_SYSCLK_SRC_SHIFT;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tsnd_soc_component_update_bits(component, WM8962_CLOCKING2, WM8962_SYSCLK_SRC_MASK,\n\t\t\t    src);\n\n\twm8962->sysclk_rate = freq;\n\n\treturn 0;\n}\n\nstatic int wm8962_set_dai_fmt(struct snd_soc_dai *dai, unsigned int fmt)\n{\n\tstruct snd_soc_component *component = dai->component;\n\tint aif0 = 0;\n\n\tswitch (fmt & SND_SOC_DAIFMT_FORMAT_MASK) {\n\tcase SND_SOC_DAIFMT_DSP_B:\n\t\taif0 |= WM8962_LRCLK_INV | 3;\n\t\tfallthrough;\n\tcase SND_SOC_DAIFMT_DSP_A:\n\t\taif0 |= 3;\n\n\t\tswitch (fmt & SND_SOC_DAIFMT_INV_MASK) {\n\t\tcase SND_SOC_DAIFMT_NB_NF:\n\t\tcase SND_SOC_DAIFMT_IB_NF:\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn -EINVAL;\n\t\t}\n\t\tbreak;\n\n\tcase SND_SOC_DAIFMT_RIGHT_J:\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_LEFT_J:\n\t\taif0 |= 1;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_I2S:\n\t\taif0 |= 2;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tswitch (fmt & SND_SOC_DAIFMT_INV_MASK) {\n\tcase SND_SOC_DAIFMT_NB_NF:\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_IB_NF:\n\t\taif0 |= WM8962_BCLK_INV;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_NB_IF:\n\t\taif0 |= WM8962_LRCLK_INV;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_IB_IF:\n\t\taif0 |= WM8962_BCLK_INV | WM8962_LRCLK_INV;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tswitch (fmt & SND_SOC_DAIFMT_MASTER_MASK) {\n\tcase SND_SOC_DAIFMT_CBM_CFM:\n\t\taif0 |= WM8962_MSTR;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_CBS_CFS:\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tsnd_soc_component_update_bits(component, WM8962_AUDIO_INTERFACE_0,\n\t\t\t    WM8962_FMT_MASK | WM8962_BCLK_INV | WM8962_MSTR |\n\t\t\t    WM8962_LRCLK_INV, aif0);\n\n\treturn 0;\n}\n\nstruct _fll_div {\n\tu16 fll_fratio;\n\tu16 fll_outdiv;\n\tu16 fll_refclk_div;\n\tu16 n;\n\tu16 theta;\n\tu16 lambda;\n};\n\n \n#define FIXED_FLL_SIZE ((1 << 16) * 10)\n\nstatic struct {\n\tunsigned int min;\n\tunsigned int max;\n\tu16 fll_fratio;\n\tint ratio;\n} fll_fratios[] = {\n\t{       0,    64000, 4, 16 },\n\t{   64000,   128000, 3,  8 },\n\t{  128000,   256000, 2,  4 },\n\t{  256000,  1000000, 1,  2 },\n\t{ 1000000, 13500000, 0,  1 },\n};\n\nstatic int fll_factors(struct _fll_div *fll_div, unsigned int Fref,\n\t\t       unsigned int Fout)\n{\n\tunsigned int target;\n\tunsigned int div;\n\tunsigned int fratio, gcd_fll;\n\tint i;\n\n\t \n\tdiv = 1;\n\tfll_div->fll_refclk_div = 0;\n\twhile ((Fref / div) > 13500000) {\n\t\tdiv *= 2;\n\t\tfll_div->fll_refclk_div++;\n\n\t\tif (div > 4) {\n\t\t\tpr_err(\"Can't scale %dMHz input down to <=13.5MHz\\n\",\n\t\t\t       Fref);\n\t\t\treturn -EINVAL;\n\t\t}\n\t}\n\n\tpr_debug(\"FLL Fref=%u Fout=%u\\n\", Fref, Fout);\n\n\t \n\tFref /= div;\n\n\t \n\tdiv = 2;\n\twhile (Fout * div < 90000000) {\n\t\tdiv++;\n\t\tif (div > 64) {\n\t\t\tpr_err(\"Unable to find FLL_OUTDIV for Fout=%uHz\\n\",\n\t\t\t       Fout);\n\t\t\treturn -EINVAL;\n\t\t}\n\t}\n\ttarget = Fout * div;\n\tfll_div->fll_outdiv = div - 1;\n\n\tpr_debug(\"FLL Fvco=%dHz\\n\", target);\n\n\t \n\tfor (i = 0; i < ARRAY_SIZE(fll_fratios); i++) {\n\t\tif (fll_fratios[i].min <= Fref && Fref <= fll_fratios[i].max) {\n\t\t\tfll_div->fll_fratio = fll_fratios[i].fll_fratio;\n\t\t\tfratio = fll_fratios[i].ratio;\n\t\t\tbreak;\n\t\t}\n\t}\n\tif (i == ARRAY_SIZE(fll_fratios)) {\n\t\tpr_err(\"Unable to find FLL_FRATIO for Fref=%uHz\\n\", Fref);\n\t\treturn -EINVAL;\n\t}\n\n\tfll_div->n = target / (fratio * Fref);\n\n\tif (target % Fref == 0) {\n\t\tfll_div->theta = 0;\n\t\tfll_div->lambda = 1;\n\t} else {\n\t\tgcd_fll = gcd(target, fratio * Fref);\n\n\t\tfll_div->theta = (target - (fll_div->n * fratio * Fref))\n\t\t\t/ gcd_fll;\n\t\tfll_div->lambda = (fratio * Fref) / gcd_fll;\n\t}\n\n\tpr_debug(\"FLL N=%x THETA=%x LAMBDA=%x\\n\",\n\t\t fll_div->n, fll_div->theta, fll_div->lambda);\n\tpr_debug(\"FLL_FRATIO=%x FLL_OUTDIV=%x FLL_REFCLK_DIV=%x\\n\",\n\t\t fll_div->fll_fratio, fll_div->fll_outdiv,\n\t\t fll_div->fll_refclk_div);\n\n\treturn 0;\n}\n\nstatic int wm8962_set_fll(struct snd_soc_component *component, int fll_id, int source,\n\t\t\t  unsigned int Fref, unsigned int Fout)\n{\n\tstruct wm8962_priv *wm8962 = snd_soc_component_get_drvdata(component);\n\tstruct _fll_div fll_div;\n\tunsigned long timeout;\n\tint ret;\n\tint fll1 = 0;\n\n\t \n\tif (source == wm8962->fll_src && Fref == wm8962->fll_fref &&\n\t    Fout == wm8962->fll_fout)\n\t\treturn 0;\n\n\tif (Fout == 0) {\n\t\tdev_dbg(component->dev, \"FLL disabled\\n\");\n\n\t\twm8962->fll_fref = 0;\n\t\twm8962->fll_fout = 0;\n\n\t\tsnd_soc_component_update_bits(component, WM8962_FLL_CONTROL_1,\n\t\t\t\t    WM8962_FLL_ENA, 0);\n\n\t\tpm_runtime_put(component->dev);\n\n\t\treturn 0;\n\t}\n\n\tret = fll_factors(&fll_div, Fref, Fout);\n\tif (ret != 0)\n\t\treturn ret;\n\n\t \n\tsnd_soc_component_update_bits(component, WM8962_FLL_CONTROL_1, WM8962_FLL_ENA, 0);\n\n\tswitch (fll_id) {\n\tcase WM8962_FLL_MCLK:\n\tcase WM8962_FLL_BCLK:\n\tcase WM8962_FLL_OSC:\n\t\tfll1 |= (fll_id - 1) << WM8962_FLL_REFCLK_SRC_SHIFT;\n\t\tbreak;\n\tcase WM8962_FLL_INT:\n\t\tsnd_soc_component_update_bits(component, WM8962_FLL_CONTROL_1,\n\t\t\t\t    WM8962_FLL_OSC_ENA, WM8962_FLL_OSC_ENA);\n\t\tsnd_soc_component_update_bits(component, WM8962_FLL_CONTROL_5,\n\t\t\t\t    WM8962_FLL_FRC_NCO, WM8962_FLL_FRC_NCO);\n\t\tbreak;\n\tdefault:\n\t\tdev_err(component->dev, \"Unknown FLL source %d\\n\", ret);\n\t\treturn -EINVAL;\n\t}\n\n\tif (fll_div.theta)\n\t\tfll1 |= WM8962_FLL_FRAC;\n\n\t \n\tsnd_soc_component_update_bits(component, WM8962_FLL_CONTROL_1, WM8962_FLL_ENA, 0);\n\n\tsnd_soc_component_update_bits(component, WM8962_FLL_CONTROL_2,\n\t\t\t    WM8962_FLL_OUTDIV_MASK |\n\t\t\t    WM8962_FLL_REFCLK_DIV_MASK,\n\t\t\t    (fll_div.fll_outdiv << WM8962_FLL_OUTDIV_SHIFT) |\n\t\t\t    (fll_div.fll_refclk_div));\n\n\tsnd_soc_component_update_bits(component, WM8962_FLL_CONTROL_3,\n\t\t\t    WM8962_FLL_FRATIO_MASK, fll_div.fll_fratio);\n\n\tsnd_soc_component_write(component, WM8962_FLL_CONTROL_6, fll_div.theta);\n\tsnd_soc_component_write(component, WM8962_FLL_CONTROL_7, fll_div.lambda);\n\tsnd_soc_component_write(component, WM8962_FLL_CONTROL_8, fll_div.n);\n\n\treinit_completion(&wm8962->fll_lock);\n\n\tret = pm_runtime_resume_and_get(component->dev);\n\tif (ret < 0) {\n\t\tdev_err(component->dev, \"Failed to resume device: %d\\n\", ret);\n\t\treturn ret;\n\t}\n\n\tsnd_soc_component_update_bits(component, WM8962_FLL_CONTROL_1,\n\t\t\t    WM8962_FLL_FRAC | WM8962_FLL_REFCLK_SRC_MASK |\n\t\t\t    WM8962_FLL_ENA, fll1 | WM8962_FLL_ENA);\n\n\tdev_dbg(component->dev, \"FLL configured for %dHz->%dHz\\n\", Fref, Fout);\n\n\t \n\tif (wm8962->irq)\n\t\ttimeout = msecs_to_jiffies(5);\n\telse\n\t\ttimeout = msecs_to_jiffies(1);\n\n\ttimeout = wait_for_completion_timeout(&wm8962->fll_lock,\n\t\t\t\t\t      timeout);\n\n\tif (timeout == 0 && wm8962->irq) {\n\t\tdev_err(component->dev, \"FLL lock timed out\");\n\t\tsnd_soc_component_update_bits(component, WM8962_FLL_CONTROL_1,\n\t\t\t\t    WM8962_FLL_ENA, 0);\n\t\tpm_runtime_put(component->dev);\n\t\treturn -ETIMEDOUT;\n\t}\n\n\twm8962->fll_fref = Fref;\n\twm8962->fll_fout = Fout;\n\twm8962->fll_src = source;\n\n\treturn 0;\n}\n\nstatic int wm8962_mute(struct snd_soc_dai *dai, int mute, int direction)\n{\n\tstruct snd_soc_component *component = dai->component;\n\tint val, ret;\n\n\tif (mute)\n\t\tval = WM8962_DAC_MUTE | WM8962_DAC_MUTE_ALT;\n\telse\n\t\tval = 0;\n\n\t \n\tret = snd_soc_component_update_bits(component, WM8962_CLASS_D_CONTROL_1,\n\t\t\t\t  WM8962_DAC_MUTE_ALT, val);\n\tif (ret < 0)\n\t\treturn ret;\n\n\treturn snd_soc_component_update_bits(component, WM8962_ADC_DAC_CONTROL_1,\n\t\t\t\t   WM8962_DAC_MUTE, val);\n}\n\n#define WM8962_RATES (SNDRV_PCM_RATE_8000_48000 |\\\n\t\tSNDRV_PCM_RATE_88200 | SNDRV_PCM_RATE_96000)\n\n#define WM8962_FORMATS (SNDRV_PCM_FMTBIT_S16_LE | SNDRV_PCM_FMTBIT_S20_3LE |\\\n\t\t\tSNDRV_PCM_FMTBIT_S24_LE | SNDRV_PCM_FMTBIT_S32_LE)\n\nstatic const struct snd_soc_dai_ops wm8962_dai_ops = {\n\t.hw_params = wm8962_hw_params,\n\t.set_sysclk = wm8962_set_dai_sysclk,\n\t.set_fmt = wm8962_set_dai_fmt,\n\t.mute_stream = wm8962_mute,\n\t.no_capture_mute = 1,\n};\n\nstatic struct snd_soc_dai_driver wm8962_dai = {\n\t.name = \"wm8962\",\n\t.playback = {\n\t\t.stream_name = \"Playback\",\n\t\t.channels_min = 1,\n\t\t.channels_max = 2,\n\t\t.rates = WM8962_RATES,\n\t\t.formats = WM8962_FORMATS,\n\t},\n\t.capture = {\n\t\t.stream_name = \"Capture\",\n\t\t.channels_min = 1,\n\t\t.channels_max = 2,\n\t\t.rates = WM8962_RATES,\n\t\t.formats = WM8962_FORMATS,\n\t},\n\t.ops = &wm8962_dai_ops,\n\t.symmetric_rate = 1,\n};\n\nstatic void wm8962_mic_work(struct work_struct *work)\n{\n\tstruct wm8962_priv *wm8962 = container_of(work,\n\t\t\t\t\t\t  struct wm8962_priv,\n\t\t\t\t\t\t  mic_work.work);\n\tstruct snd_soc_component *component = wm8962->component;\n\tint status = 0;\n\tint irq_pol = 0;\n\tint reg;\n\n\treg = snd_soc_component_read(component, WM8962_ADDITIONAL_CONTROL_4);\n\n\tif (reg & WM8962_MICDET_STS) {\n\t\tstatus |= SND_JACK_MICROPHONE;\n\t\tirq_pol |= WM8962_MICD_IRQ_POL;\n\t}\n\n\tif (reg & WM8962_MICSHORT_STS) {\n\t\tstatus |= SND_JACK_BTN_0;\n\t\tirq_pol |= WM8962_MICSCD_IRQ_POL;\n\t}\n\n\tsnd_soc_jack_report(wm8962->jack, status,\n\t\t\t    SND_JACK_MICROPHONE | SND_JACK_BTN_0);\n\n\tsnd_soc_component_update_bits(component, WM8962_MICINT_SOURCE_POL,\n\t\t\t    WM8962_MICSCD_IRQ_POL |\n\t\t\t    WM8962_MICD_IRQ_POL, irq_pol);\n}\n\nstatic irqreturn_t wm8962_irq(int irq, void *data)\n{\n\tstruct device *dev = data;\n\tstruct wm8962_priv *wm8962 = dev_get_drvdata(dev);\n\tunsigned int mask;\n\tunsigned int active;\n\tint reg, ret;\n\n\tret = pm_runtime_resume_and_get(dev);\n\tif (ret < 0) {\n\t\tdev_err(dev, \"Failed to resume: %d\\n\", ret);\n\t\treturn IRQ_NONE;\n\t}\n\n\tret = regmap_read(wm8962->regmap, WM8962_INTERRUPT_STATUS_2_MASK,\n\t\t\t  &mask);\n\tif (ret != 0) {\n\t\tpm_runtime_put(dev);\n\t\tdev_err(dev, \"Failed to read interrupt mask: %d\\n\",\n\t\t\tret);\n\t\treturn IRQ_NONE;\n\t}\n\n\tret = regmap_read(wm8962->regmap, WM8962_INTERRUPT_STATUS_2, &active);\n\tif (ret != 0) {\n\t\tpm_runtime_put(dev);\n\t\tdev_err(dev, \"Failed to read interrupt: %d\\n\", ret);\n\t\treturn IRQ_NONE;\n\t}\n\n\tactive &= ~mask;\n\n\tif (!active) {\n\t\tpm_runtime_put(dev);\n\t\treturn IRQ_NONE;\n\t}\n\n\t \n\tret = regmap_write(wm8962->regmap, WM8962_INTERRUPT_STATUS_2, active);\n\tif (ret != 0)\n\t\tdev_warn(dev, \"Failed to ack interrupt: %d\\n\", ret);\n\n\tif (active & WM8962_FLL_LOCK_EINT) {\n\t\tdev_dbg(dev, \"FLL locked\\n\");\n\t\tcomplete(&wm8962->fll_lock);\n\t}\n\n\tif (active & WM8962_FIFOS_ERR_EINT)\n\t\tdev_err(dev, \"FIFO error\\n\");\n\n\tif (active & WM8962_TEMP_SHUT_EINT) {\n\t\tdev_crit(dev, \"Thermal shutdown\\n\");\n\n\t\tret = regmap_read(wm8962->regmap,\n\t\t\t\t  WM8962_THERMAL_SHUTDOWN_STATUS,  &reg);\n\t\tif (ret != 0) {\n\t\t\tdev_warn(dev, \"Failed to read thermal status: %d\\n\",\n\t\t\t\t ret);\n\t\t\treg = 0;\n\t\t}\n\n\t\tif (reg & WM8962_TEMP_ERR_HP)\n\t\t\tdev_crit(dev, \"Headphone thermal error\\n\");\n\t\tif (reg & WM8962_TEMP_WARN_HP)\n\t\t\tdev_crit(dev, \"Headphone thermal warning\\n\");\n\t\tif (reg & WM8962_TEMP_ERR_SPK)\n\t\t\tdev_crit(dev, \"Speaker thermal error\\n\");\n\t\tif (reg & WM8962_TEMP_WARN_SPK)\n\t\t\tdev_crit(dev, \"Speaker thermal warning\\n\");\n\t}\n\n\tif (active & (WM8962_MICSCD_EINT | WM8962_MICD_EINT)) {\n\t\tdev_dbg(dev, \"Microphone event detected\\n\");\n\n#ifndef CONFIG_SND_SOC_WM8962_MODULE\n\t\ttrace_snd_soc_jack_irq(dev_name(dev));\n#endif\n\n\t\tpm_wakeup_event(dev, 300);\n\n\t\tqueue_delayed_work(system_power_efficient_wq,\n\t\t\t\t   &wm8962->mic_work,\n\t\t\t\t   msecs_to_jiffies(250));\n\t}\n\n\tpm_runtime_put(dev);\n\n\treturn IRQ_HANDLED;\n}\n\n \nint wm8962_mic_detect(struct snd_soc_component *component, struct snd_soc_jack *jack)\n{\n\tstruct wm8962_priv *wm8962 = snd_soc_component_get_drvdata(component);\n\tstruct snd_soc_dapm_context *dapm = snd_soc_component_get_dapm(component);\n\tint irq_mask, enable;\n\n\twm8962->jack = jack;\n\tif (jack) {\n\t\tirq_mask = 0;\n\t\tenable = WM8962_MICDET_ENA;\n\t} else {\n\t\tirq_mask = WM8962_MICD_EINT | WM8962_MICSCD_EINT;\n\t\tenable = 0;\n\t}\n\n\tsnd_soc_component_update_bits(component, WM8962_INTERRUPT_STATUS_2_MASK,\n\t\t\t    WM8962_MICD_EINT | WM8962_MICSCD_EINT, irq_mask);\n\tsnd_soc_component_update_bits(component, WM8962_ADDITIONAL_CONTROL_4,\n\t\t\t    WM8962_MICDET_ENA, enable);\n\n\t \n\tsnd_soc_jack_report(wm8962->jack, 0,\n\t\t\t    SND_JACK_MICROPHONE | SND_JACK_BTN_0);\n\n\tsnd_soc_dapm_mutex_lock(dapm);\n\n\tif (jack) {\n\t\tsnd_soc_dapm_force_enable_pin_unlocked(dapm, \"SYSCLK\");\n\t\tsnd_soc_dapm_force_enable_pin_unlocked(dapm, \"MICBIAS\");\n\t} else {\n\t\tsnd_soc_dapm_disable_pin_unlocked(dapm, \"SYSCLK\");\n\t\tsnd_soc_dapm_disable_pin_unlocked(dapm, \"MICBIAS\");\n\t}\n\n\tsnd_soc_dapm_mutex_unlock(dapm);\n\n\treturn 0;\n}\nEXPORT_SYMBOL_GPL(wm8962_mic_detect);\n\nstatic int beep_rates[] = {\n\t500, 1000, 2000, 4000,\n};\n\nstatic void wm8962_beep_work(struct work_struct *work)\n{\n\tstruct wm8962_priv *wm8962 =\n\t\tcontainer_of(work, struct wm8962_priv, beep_work);\n\tstruct snd_soc_component *component = wm8962->component;\n\tstruct snd_soc_dapm_context *dapm = snd_soc_component_get_dapm(component);\n\tint i;\n\tint reg = 0;\n\tint best = 0;\n\n\tif (wm8962->beep_rate) {\n\t\tfor (i = 0; i < ARRAY_SIZE(beep_rates); i++) {\n\t\t\tif (abs(wm8962->beep_rate - beep_rates[i]) <\n\t\t\t    abs(wm8962->beep_rate - beep_rates[best]))\n\t\t\t\tbest = i;\n\t\t}\n\n\t\tdev_dbg(component->dev, \"Set beep rate %dHz for requested %dHz\\n\",\n\t\t\tbeep_rates[best], wm8962->beep_rate);\n\n\t\treg = WM8962_BEEP_ENA | (best << WM8962_BEEP_RATE_SHIFT);\n\n\t\tsnd_soc_dapm_enable_pin(dapm, \"Beep\");\n\t} else {\n\t\tdev_dbg(component->dev, \"Disabling beep\\n\");\n\t\tsnd_soc_dapm_disable_pin(dapm, \"Beep\");\n\t}\n\n\tsnd_soc_component_update_bits(component, WM8962_BEEP_GENERATOR_1,\n\t\t\t    WM8962_BEEP_ENA | WM8962_BEEP_RATE_MASK, reg);\n\n\tsnd_soc_dapm_sync(dapm);\n}\n\n \nstatic int wm8962_beep_event(struct input_dev *dev, unsigned int type,\n\t\t\t     unsigned int code, int hz)\n{\n\tstruct snd_soc_component *component = input_get_drvdata(dev);\n\tstruct wm8962_priv *wm8962 = snd_soc_component_get_drvdata(component);\n\n\tdev_dbg(component->dev, \"Beep event %x %x\\n\", code, hz);\n\n\tswitch (code) {\n\tcase SND_BELL:\n\t\tif (hz)\n\t\t\thz = 1000;\n\t\tfallthrough;\n\tcase SND_TONE:\n\t\tbreak;\n\tdefault:\n\t\treturn -1;\n\t}\n\n\t \n\twm8962->beep_rate = hz;\n\tschedule_work(&wm8962->beep_work);\n\treturn 0;\n}\n\nstatic ssize_t beep_store(struct device *dev, struct device_attribute *attr,\n\t\t\t  const char *buf, size_t count)\n{\n\tstruct wm8962_priv *wm8962 = dev_get_drvdata(dev);\n\tlong int time;\n\tint ret;\n\n\tret = kstrtol(buf, 10, &time);\n\tif (ret != 0)\n\t\treturn ret;\n\n\tinput_event(wm8962->beep, EV_SND, SND_TONE, time);\n\n\treturn count;\n}\n\nstatic DEVICE_ATTR_WO(beep);\n\nstatic void wm8962_init_beep(struct snd_soc_component *component)\n{\n\tstruct wm8962_priv *wm8962 = snd_soc_component_get_drvdata(component);\n\tint ret;\n\n\twm8962->beep = devm_input_allocate_device(component->dev);\n\tif (!wm8962->beep) {\n\t\tdev_err(component->dev, \"Failed to allocate beep device\\n\");\n\t\treturn;\n\t}\n\n\tINIT_WORK(&wm8962->beep_work, wm8962_beep_work);\n\twm8962->beep_rate = 0;\n\n\twm8962->beep->name = \"WM8962 Beep Generator\";\n\twm8962->beep->phys = dev_name(component->dev);\n\twm8962->beep->id.bustype = BUS_I2C;\n\n\twm8962->beep->evbit[0] = BIT_MASK(EV_SND);\n\twm8962->beep->sndbit[0] = BIT_MASK(SND_BELL) | BIT_MASK(SND_TONE);\n\twm8962->beep->event = wm8962_beep_event;\n\twm8962->beep->dev.parent = component->dev;\n\tinput_set_drvdata(wm8962->beep, component);\n\n\tret = input_register_device(wm8962->beep);\n\tif (ret != 0) {\n\t\twm8962->beep = NULL;\n\t\tdev_err(component->dev, \"Failed to register beep device\\n\");\n\t}\n\n\tret = device_create_file(component->dev, &dev_attr_beep);\n\tif (ret != 0) {\n\t\tdev_err(component->dev, \"Failed to create keyclick file: %d\\n\",\n\t\t\tret);\n\t}\n}\n\nstatic void wm8962_free_beep(struct snd_soc_component *component)\n{\n\tstruct wm8962_priv *wm8962 = snd_soc_component_get_drvdata(component);\n\n\tdevice_remove_file(component->dev, &dev_attr_beep);\n\tcancel_work_sync(&wm8962->beep_work);\n\twm8962->beep = NULL;\n\n\tsnd_soc_component_update_bits(component, WM8962_BEEP_GENERATOR_1, WM8962_BEEP_ENA,0);\n}\n\nstatic void wm8962_set_gpio_mode(struct wm8962_priv *wm8962, int gpio)\n{\n\tint mask = 0;\n\tint val = 0;\n\n\t \n\tswitch (gpio) {\n\tcase 2:\n\t\tmask = WM8962_CLKOUT2_SEL_MASK;\n\t\tval = 1 << WM8962_CLKOUT2_SEL_SHIFT;\n\t\tbreak;\n\tcase 3:\n\t\tmask = WM8962_CLKOUT3_SEL_MASK;\n\t\tval = 1 << WM8962_CLKOUT3_SEL_SHIFT;\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n\n\tif (mask)\n\t\tregmap_update_bits(wm8962->regmap, WM8962_ANALOGUE_CLOCKING1,\n\t\t\t\t   mask, val);\n}\n\n#ifdef CONFIG_GPIOLIB\nstatic int wm8962_gpio_request(struct gpio_chip *chip, unsigned offset)\n{\n\tstruct wm8962_priv *wm8962 = gpiochip_get_data(chip);\n\n\t \n\tswitch (offset + 1) {\n\tcase 2:\n\tcase 3:\n\tcase 5:\n\tcase 6:\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\twm8962_set_gpio_mode(wm8962, offset + 1);\n\n\treturn 0;\n}\n\nstatic void wm8962_gpio_set(struct gpio_chip *chip, unsigned offset, int value)\n{\n\tstruct wm8962_priv *wm8962 = gpiochip_get_data(chip);\n\tstruct snd_soc_component *component = wm8962->component;\n\n\tsnd_soc_component_update_bits(component, WM8962_GPIO_BASE + offset,\n\t\t\t    WM8962_GP2_LVL, !!value << WM8962_GP2_LVL_SHIFT);\n}\n\nstatic int wm8962_gpio_direction_out(struct gpio_chip *chip,\n\t\t\t\t     unsigned offset, int value)\n{\n\tstruct wm8962_priv *wm8962 = gpiochip_get_data(chip);\n\tstruct snd_soc_component *component = wm8962->component;\n\tint ret, val;\n\n\t \n\tval = (1 << WM8962_GP2_FN_SHIFT) | (value << WM8962_GP2_LVL_SHIFT);\n\n\tret = snd_soc_component_update_bits(component, WM8962_GPIO_BASE + offset,\n\t\t\t\t  WM8962_GP2_FN_MASK | WM8962_GP2_LVL, val);\n\tif (ret < 0)\n\t\treturn ret;\n\n\treturn 0;\n}\n\nstatic const struct gpio_chip wm8962_template_chip = {\n\t.label\t\t\t= \"wm8962\",\n\t.owner\t\t\t= THIS_MODULE,\n\t.request\t\t= wm8962_gpio_request,\n\t.direction_output\t= wm8962_gpio_direction_out,\n\t.set\t\t\t= wm8962_gpio_set,\n\t.can_sleep\t\t= 1,\n};\n\nstatic void wm8962_init_gpio(struct snd_soc_component *component)\n{\n\tstruct wm8962_priv *wm8962 = snd_soc_component_get_drvdata(component);\n\tstruct wm8962_pdata *pdata = &wm8962->pdata;\n\tint ret;\n\n\twm8962->gpio_chip = wm8962_template_chip;\n\twm8962->gpio_chip.ngpio = WM8962_MAX_GPIO;\n\twm8962->gpio_chip.parent = component->dev;\n\n\tif (pdata->gpio_base)\n\t\twm8962->gpio_chip.base = pdata->gpio_base;\n\telse\n\t\twm8962->gpio_chip.base = -1;\n\n\tret = gpiochip_add_data(&wm8962->gpio_chip, wm8962);\n\tif (ret != 0)\n\t\tdev_err(component->dev, \"Failed to add GPIOs: %d\\n\", ret);\n}\n\nstatic void wm8962_free_gpio(struct snd_soc_component *component)\n{\n\tstruct wm8962_priv *wm8962 = snd_soc_component_get_drvdata(component);\n\n\tgpiochip_remove(&wm8962->gpio_chip);\n}\n#else\nstatic void wm8962_init_gpio(struct snd_soc_component *component)\n{\n}\n\nstatic void wm8962_free_gpio(struct snd_soc_component *component)\n{\n}\n#endif\n\nstatic int wm8962_probe(struct snd_soc_component *component)\n{\n\tstruct snd_soc_dapm_context *dapm = snd_soc_component_get_dapm(component);\n\tint ret;\n\tstruct wm8962_priv *wm8962 = snd_soc_component_get_drvdata(component);\n\tint i;\n\tbool dmicclk, dmicdat;\n\n\twm8962->component = component;\n\n\twm8962->disable_nb[0].notifier_call = wm8962_regulator_event_0;\n\twm8962->disable_nb[1].notifier_call = wm8962_regulator_event_1;\n\twm8962->disable_nb[2].notifier_call = wm8962_regulator_event_2;\n\twm8962->disable_nb[3].notifier_call = wm8962_regulator_event_3;\n\twm8962->disable_nb[4].notifier_call = wm8962_regulator_event_4;\n\twm8962->disable_nb[5].notifier_call = wm8962_regulator_event_5;\n\twm8962->disable_nb[6].notifier_call = wm8962_regulator_event_6;\n\twm8962->disable_nb[7].notifier_call = wm8962_regulator_event_7;\n\n\t \n\tfor (i = 0; i < ARRAY_SIZE(wm8962->supplies); i++) {\n\t\tret = devm_regulator_register_notifier(\n\t\t\t\t\t\twm8962->supplies[i].consumer,\n\t\t\t\t\t\t&wm8962->disable_nb[i]);\n\t\tif (ret != 0) {\n\t\t\tdev_err(component->dev,\n\t\t\t\t\"Failed to register regulator notifier: %d\\n\",\n\t\t\t\tret);\n\t\t}\n\t}\n\n\twm8962_add_widgets(component);\n\n\t \n\tdmicclk = false;\n\tdmicdat = false;\n\tfor (i = 1; i < WM8962_MAX_GPIO; i++) {\n\t\t \n\t\tif (i == 3)\n\t\t\tcontinue;\n\t\tswitch (snd_soc_component_read(component, WM8962_GPIO_BASE + i)\n\t\t\t& WM8962_GP2_FN_MASK) {\n\t\tcase WM8962_GPIO_FN_DMICCLK:\n\t\t\tdmicclk = true;\n\t\t\tbreak;\n\t\tcase WM8962_GPIO_FN_DMICDAT:\n\t\t\tdmicdat = true;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tbreak;\n\t\t}\n\t}\n\tif (!dmicclk || !dmicdat) {\n\t\tdev_dbg(component->dev, \"DMIC not in use, disabling\\n\");\n\t\tsnd_soc_dapm_nc_pin(dapm, \"DMICDAT\");\n\t}\n\tif (dmicclk != dmicdat)\n\t\tdev_warn(component->dev, \"DMIC GPIOs partially configured\\n\");\n\n\twm8962_init_beep(component);\n\twm8962_init_gpio(component);\n\n\treturn 0;\n}\n\nstatic void wm8962_remove(struct snd_soc_component *component)\n{\n\tstruct wm8962_priv *wm8962 = snd_soc_component_get_drvdata(component);\n\n\tcancel_delayed_work_sync(&wm8962->mic_work);\n\n\twm8962_free_gpio(component);\n\twm8962_free_beep(component);\n}\n\nstatic const struct snd_soc_component_driver soc_component_dev_wm8962 = {\n\t.probe\t\t\t= wm8962_probe,\n\t.remove\t\t\t= wm8962_remove,\n\t.set_bias_level\t\t= wm8962_set_bias_level,\n\t.set_pll\t\t= wm8962_set_fll,\n\t.use_pmdown_time\t= 1,\n\t.endianness\t\t= 1,\n};\n\n \nstatic const struct reg_sequence wm8962_dc_measure[] = {\n\t{ 0xfd, 0x1 },\n\t{ 0xcc, 0x40 },\n\t{ 0xfd, 0 },\n};\n\nstatic const struct regmap_config wm8962_regmap = {\n\t.reg_bits = 16,\n\t.val_bits = 16,\n\n\t.max_register = WM8962_MAX_REGISTER,\n\t.reg_defaults = wm8962_reg,\n\t.num_reg_defaults = ARRAY_SIZE(wm8962_reg),\n\t.volatile_reg = wm8962_volatile_register,\n\t.readable_reg = wm8962_readable_register,\n\t.cache_type = REGCACHE_MAPLE,\n};\n\nstatic int wm8962_set_pdata_from_of(struct i2c_client *i2c,\n\t\t\t\t    struct wm8962_pdata *pdata)\n{\n\tconst struct device_node *np = i2c->dev.of_node;\n\tu32 val32;\n\tint i;\n\n\tif (of_property_read_bool(np, \"spk-mono\"))\n\t\tpdata->spk_mono = true;\n\n\tif (of_property_read_u32(np, \"mic-cfg\", &val32) >= 0)\n\t\tpdata->mic_cfg = val32;\n\n\tif (of_property_read_u32_array(np, \"gpio-cfg\", pdata->gpio_init,\n\t\t\t\t       ARRAY_SIZE(pdata->gpio_init)) >= 0)\n\t\tfor (i = 0; i < ARRAY_SIZE(pdata->gpio_init); i++) {\n\t\t\t \n\t\t\tif (pdata->gpio_init[i] > 0xffff)\n\t\t\t\tpdata->gpio_init[i] = 0x0;\n\t\t}\n\n\tpdata->mclk = devm_clk_get_optional(&i2c->dev, NULL);\n\treturn PTR_ERR_OR_ZERO(pdata->mclk);\n}\n\nstatic int wm8962_i2c_probe(struct i2c_client *i2c)\n{\n\tstruct wm8962_pdata *pdata = dev_get_platdata(&i2c->dev);\n\tstruct wm8962_priv *wm8962;\n\tunsigned int reg;\n\tint ret, i, irq_pol, trigger;\n\n\twm8962 = devm_kzalloc(&i2c->dev, sizeof(*wm8962), GFP_KERNEL);\n\tif (wm8962 == NULL)\n\t\treturn -ENOMEM;\n\n\tmutex_init(&wm8962->dsp2_ena_lock);\n\n\ti2c_set_clientdata(i2c, wm8962);\n\n\tINIT_DELAYED_WORK(&wm8962->mic_work, wm8962_mic_work);\n\tinit_completion(&wm8962->fll_lock);\n\twm8962->irq = i2c->irq;\n\n\t \n\tif (pdata) {\n\t\tmemcpy(&wm8962->pdata, pdata, sizeof(struct wm8962_pdata));\n\t} else if (i2c->dev.of_node) {\n\t\tret = wm8962_set_pdata_from_of(i2c, &wm8962->pdata);\n\t\tif (ret != 0)\n\t\t\treturn ret;\n\t}\n\n\tfor (i = 0; i < ARRAY_SIZE(wm8962->supplies); i++)\n\t\twm8962->supplies[i].supply = wm8962_supply_names[i];\n\n\tret = devm_regulator_bulk_get(&i2c->dev, ARRAY_SIZE(wm8962->supplies),\n\t\t\t\t wm8962->supplies);\n\tif (ret != 0) {\n\t\tdev_err(&i2c->dev, \"Failed to request supplies: %d\\n\", ret);\n\t\tgoto err;\n\t}\n\n\tret = regulator_bulk_enable(ARRAY_SIZE(wm8962->supplies),\n\t\t\t\t    wm8962->supplies);\n\tif (ret != 0) {\n\t\tdev_err(&i2c->dev, \"Failed to enable supplies: %d\\n\", ret);\n\t\treturn ret;\n\t}\n\n\twm8962->regmap = devm_regmap_init_i2c(i2c, &wm8962_regmap);\n\tif (IS_ERR(wm8962->regmap)) {\n\t\tret = PTR_ERR(wm8962->regmap);\n\t\tdev_err(&i2c->dev, \"Failed to allocate regmap: %d\\n\", ret);\n\t\tgoto err_enable;\n\t}\n\n\t \n\tregcache_cache_bypass(wm8962->regmap, true);\n\n\tret = regmap_read(wm8962->regmap, WM8962_SOFTWARE_RESET, &reg);\n\tif (ret < 0) {\n\t\tdev_err(&i2c->dev, \"Failed to read ID register\\n\");\n\t\tgoto err_enable;\n\t}\n\tif (reg != 0x6243) {\n\t\tdev_err(&i2c->dev,\n\t\t\t\"Device is not a WM8962, ID %x != 0x6243\\n\", reg);\n\t\tret = -EINVAL;\n\t\tgoto err_enable;\n\t}\n\n\tret = regmap_read(wm8962->regmap, WM8962_RIGHT_INPUT_VOLUME, &reg);\n\tif (ret < 0) {\n\t\tdev_err(&i2c->dev, \"Failed to read device revision: %d\\n\",\n\t\t\tret);\n\t\tgoto err_enable;\n\t}\n\n\tdev_info(&i2c->dev, \"customer id %x revision %c\\n\",\n\t\t (reg & WM8962_CUST_ID_MASK) >> WM8962_CUST_ID_SHIFT,\n\t\t ((reg & WM8962_CHIP_REV_MASK) >> WM8962_CHIP_REV_SHIFT)\n\t\t + 'A');\n\n\tregcache_cache_bypass(wm8962->regmap, false);\n\n\tret = wm8962_reset(wm8962);\n\tif (ret < 0) {\n\t\tdev_err(&i2c->dev, \"Failed to issue reset\\n\");\n\t\tgoto err_enable;\n\t}\n\n\t \n\tregmap_update_bits(wm8962->regmap, WM8962_CLOCKING2,\n\t\t\t   WM8962_SYSCLK_ENA, 0);\n\n\t \n\tregmap_update_bits(wm8962->regmap, WM8962_CLOCKING2,\n\t\t\t   WM8962_CLKREG_OVD, WM8962_CLKREG_OVD);\n\n\t \n\tregmap_update_bits(wm8962->regmap, WM8962_PLL2,\n\t\t\t   WM8962_OSC_ENA | WM8962_PLL2_ENA | WM8962_PLL3_ENA,\n\t\t\t   0);\n\n\t \n\tfor (i = 0; i < ARRAY_SIZE(wm8962->pdata.gpio_init); i++)\n\t\tif (wm8962->pdata.gpio_init[i]) {\n\t\t\twm8962_set_gpio_mode(wm8962, i + 1);\n\t\t\tregmap_write(wm8962->regmap, 0x200 + i,\n\t\t\t\t     wm8962->pdata.gpio_init[i] & 0xffff);\n\t\t}\n\n\n\t \n\tif (wm8962->pdata.spk_mono)\n\t\tregmap_update_bits(wm8962->regmap, WM8962_CLASS_D_CONTROL_2,\n\t\t\t\t   WM8962_SPK_MONO_MASK, WM8962_SPK_MONO);\n\n\t \n\tif (wm8962->pdata.mic_cfg)\n\t\tregmap_update_bits(wm8962->regmap, WM8962_ADDITIONAL_CONTROL_4,\n\t\t\t\t   WM8962_MICDET_ENA |\n\t\t\t\t   WM8962_MICDET_THR_MASK |\n\t\t\t\t   WM8962_MICSHORT_THR_MASK |\n\t\t\t\t   WM8962_MICBIAS_LVL,\n\t\t\t\t   wm8962->pdata.mic_cfg);\n\n\t \n\tregmap_update_bits(wm8962->regmap, WM8962_LEFT_INPUT_VOLUME,\n\t\t\t   WM8962_IN_VU, WM8962_IN_VU);\n\tregmap_update_bits(wm8962->regmap, WM8962_RIGHT_INPUT_VOLUME,\n\t\t\t   WM8962_IN_VU, WM8962_IN_VU);\n\tregmap_update_bits(wm8962->regmap, WM8962_LEFT_ADC_VOLUME,\n\t\t\t   WM8962_ADC_VU, WM8962_ADC_VU);\n\tregmap_update_bits(wm8962->regmap, WM8962_RIGHT_ADC_VOLUME,\n\t\t\t   WM8962_ADC_VU, WM8962_ADC_VU);\n\tregmap_update_bits(wm8962->regmap, WM8962_LEFT_DAC_VOLUME,\n\t\t\t   WM8962_DAC_VU, WM8962_DAC_VU);\n\tregmap_update_bits(wm8962->regmap, WM8962_RIGHT_DAC_VOLUME,\n\t\t\t   WM8962_DAC_VU, WM8962_DAC_VU);\n\tregmap_update_bits(wm8962->regmap, WM8962_SPKOUTL_VOLUME,\n\t\t\t   WM8962_SPKOUT_VU, WM8962_SPKOUT_VU);\n\tregmap_update_bits(wm8962->regmap, WM8962_SPKOUTR_VOLUME,\n\t\t\t   WM8962_SPKOUT_VU, WM8962_SPKOUT_VU);\n\tregmap_update_bits(wm8962->regmap, WM8962_HPOUTL_VOLUME,\n\t\t\t   WM8962_HPOUT_VU, WM8962_HPOUT_VU);\n\tregmap_update_bits(wm8962->regmap, WM8962_HPOUTR_VOLUME,\n\t\t\t   WM8962_HPOUT_VU, WM8962_HPOUT_VU);\n\n\t \n\tregmap_update_bits(wm8962->regmap, WM8962_EQ1,\n\t\t\t   WM8962_EQ_SHARED_COEFF, 0);\n\n\t \n\tregmap_update_bits(wm8962->regmap, WM8962_IRQ_DEBOUNCE,\n\t\t\t   WM8962_FLL_LOCK_DB | WM8962_PLL3_LOCK_DB |\n\t\t\t   WM8962_PLL2_LOCK_DB | WM8962_TEMP_SHUT_DB,\n\t\t\t   0);\n\n\tif (wm8962->pdata.in4_dc_measure) {\n\t\tret = regmap_register_patch(wm8962->regmap,\n\t\t\t\t\t    wm8962_dc_measure,\n\t\t\t\t\t    ARRAY_SIZE(wm8962_dc_measure));\n\t\tif (ret != 0)\n\t\t\tdev_err(&i2c->dev,\n\t\t\t\t\"Failed to configure for DC measurement: %d\\n\",\n\t\t\t\tret);\n\t}\n\n\tif (wm8962->irq) {\n\t\tif (wm8962->pdata.irq_active_low) {\n\t\t\ttrigger = IRQF_TRIGGER_LOW;\n\t\t\tirq_pol = WM8962_IRQ_POL;\n\t\t} else {\n\t\t\ttrigger = IRQF_TRIGGER_HIGH;\n\t\t\tirq_pol = 0;\n\t\t}\n\n\t\tregmap_update_bits(wm8962->regmap, WM8962_INTERRUPT_CONTROL,\n\t\t\t\t   WM8962_IRQ_POL, irq_pol);\n\n\t\tret = devm_request_threaded_irq(&i2c->dev, wm8962->irq, NULL,\n\t\t\t\t\t\twm8962_irq,\n\t\t\t\t\t\ttrigger | IRQF_ONESHOT,\n\t\t\t\t\t\t\"wm8962\", &i2c->dev);\n\t\tif (ret != 0) {\n\t\t\tdev_err(&i2c->dev, \"Failed to request IRQ %d: %d\\n\",\n\t\t\t\twm8962->irq, ret);\n\t\t\twm8962->irq = 0;\n\t\t\t \n\t\t} else {\n\t\t\t \n\t\t\tregmap_update_bits(wm8962->regmap,\n\t\t\t\t\t   WM8962_INTERRUPT_STATUS_2_MASK,\n\t\t\t\t\t   WM8962_FLL_LOCK_EINT |\n\t\t\t\t\t   WM8962_TEMP_SHUT_EINT |\n\t\t\t\t\t   WM8962_FIFOS_ERR_EINT, 0);\n\t\t}\n\t}\n\n\tpm_runtime_enable(&i2c->dev);\n\tpm_request_idle(&i2c->dev);\n\n\tret = devm_snd_soc_register_component(&i2c->dev,\n\t\t\t\t     &soc_component_dev_wm8962, &wm8962_dai, 1);\n\tif (ret < 0)\n\t\tgoto err_pm_runtime;\n\n\tregmap_update_bits(wm8962->regmap, WM8962_ADDITIONAL_CONTROL_4,\n\t\t\t    WM8962_TEMP_ENA_HP_MASK, 0);\n\tregmap_update_bits(wm8962->regmap, WM8962_ADDITIONAL_CONTROL_4,\n\t\t\t    WM8962_TEMP_ENA_SPK_MASK, 0);\n\n\tregcache_cache_only(wm8962->regmap, true);\n\n\t \n\tregulator_bulk_disable(ARRAY_SIZE(wm8962->supplies), wm8962->supplies);\n\n\treturn 0;\n\nerr_pm_runtime:\n\tpm_runtime_disable(&i2c->dev);\nerr_enable:\n\tregulator_bulk_disable(ARRAY_SIZE(wm8962->supplies), wm8962->supplies);\nerr:\n\treturn ret;\n}\n\nstatic void wm8962_i2c_remove(struct i2c_client *client)\n{\n\tpm_runtime_disable(&client->dev);\n}\n\n#ifdef CONFIG_PM\nstatic int wm8962_runtime_resume(struct device *dev)\n{\n\tstruct wm8962_priv *wm8962 = dev_get_drvdata(dev);\n\tint ret;\n\n\tret = clk_prepare_enable(wm8962->pdata.mclk);\n\tif (ret) {\n\t\tdev_err(dev, \"Failed to enable MCLK: %d\\n\", ret);\n\t\treturn ret;\n\t}\n\n\tret = regulator_bulk_enable(ARRAY_SIZE(wm8962->supplies),\n\t\t\t\t    wm8962->supplies);\n\tif (ret != 0) {\n\t\tdev_err(dev, \"Failed to enable supplies: %d\\n\", ret);\n\t\tgoto disable_clock;\n\t}\n\n\tregcache_cache_only(wm8962->regmap, false);\n\n\twm8962_reset(wm8962);\n\n\tregcache_mark_dirty(wm8962->regmap);\n\n\t \n\tregmap_write_bits(wm8962->regmap, WM8962_CLOCKING2,\n\t\t\t  WM8962_SYSCLK_ENA, 0);\n\n\t \n\tregmap_update_bits(wm8962->regmap, WM8962_CLOCKING2,\n\t\t\t   WM8962_CLKREG_OVD, WM8962_CLKREG_OVD);\n\n\t \n\tregmap_update_bits(wm8962->regmap, WM8962_PLL2,\n\t\t\t   WM8962_OSC_ENA | WM8962_PLL2_ENA | WM8962_PLL3_ENA,\n\t\t\t   0);\n\n\tregcache_sync(wm8962->regmap);\n\n\tregmap_update_bits(wm8962->regmap, WM8962_ANTI_POP,\n\t\t\t   WM8962_STARTUP_BIAS_ENA | WM8962_VMID_BUF_ENA,\n\t\t\t   WM8962_STARTUP_BIAS_ENA | WM8962_VMID_BUF_ENA);\n\n\t \n\tregmap_update_bits(wm8962->regmap, WM8962_PWR_MGMT_1,\n\t\t\t   WM8962_BIAS_ENA | WM8962_VMID_SEL_MASK,\n\t\t\t   WM8962_BIAS_ENA | 0x180);\n\n\tmsleep(5);\n\n\treturn 0;\n\ndisable_clock:\n\tclk_disable_unprepare(wm8962->pdata.mclk);\n\treturn ret;\n}\n\nstatic int wm8962_runtime_suspend(struct device *dev)\n{\n\tstruct wm8962_priv *wm8962 = dev_get_drvdata(dev);\n\n\tregmap_update_bits(wm8962->regmap, WM8962_PWR_MGMT_1,\n\t\t\t   WM8962_VMID_SEL_MASK | WM8962_BIAS_ENA, 0);\n\n\tregmap_update_bits(wm8962->regmap, WM8962_ANTI_POP,\n\t\t\t   WM8962_STARTUP_BIAS_ENA |\n\t\t\t   WM8962_VMID_BUF_ENA, 0);\n\n\tregcache_cache_only(wm8962->regmap, true);\n\n\tregulator_bulk_disable(ARRAY_SIZE(wm8962->supplies),\n\t\t\t       wm8962->supplies);\n\n\tclk_disable_unprepare(wm8962->pdata.mclk);\n\n\treturn 0;\n}\n#endif\n\nstatic const struct dev_pm_ops wm8962_pm = {\n\tSET_SYSTEM_SLEEP_PM_OPS(pm_runtime_force_suspend, pm_runtime_force_resume)\n\tSET_RUNTIME_PM_OPS(wm8962_runtime_suspend, wm8962_runtime_resume, NULL)\n};\n\nstatic const struct i2c_device_id wm8962_i2c_id[] = {\n\t{ \"wm8962\", 0 },\n\t{ }\n};\nMODULE_DEVICE_TABLE(i2c, wm8962_i2c_id);\n\nstatic const struct of_device_id wm8962_of_match[] = {\n\t{ .compatible = \"wlf,wm8962\", },\n\t{ }\n};\nMODULE_DEVICE_TABLE(of, wm8962_of_match);\n\nstatic struct i2c_driver wm8962_i2c_driver = {\n\t.driver = {\n\t\t.name = \"wm8962\",\n\t\t.of_match_table = wm8962_of_match,\n\t\t.pm = &wm8962_pm,\n\t},\n\t.probe =    wm8962_i2c_probe,\n\t.remove =   wm8962_i2c_remove,\n\t.id_table = wm8962_i2c_id,\n};\n\nmodule_i2c_driver(wm8962_i2c_driver);\n\nMODULE_DESCRIPTION(\"ASoC WM8962 driver\");\nMODULE_AUTHOR(\"Mark Brown <broonie@opensource.wolfsonmicro.com>\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}