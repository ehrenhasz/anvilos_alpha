{
  "module_name": "msm8916-wcd-digital.c",
  "hash_id": "91f40ce4a355cd722abf7cc6910879f4f533c122e036062a441bf3753c6eb587",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/codecs/msm8916-wcd-digital.c",
  "human_readable_source": "\n\n\n#include <linux/module.h>\n#include <linux/err.h>\n#include <linux/kernel.h>\n#include <linux/delay.h>\n#include <linux/types.h>\n#include <linux/clk.h>\n#include <linux/of.h>\n#include <linux/platform_device.h>\n#include <linux/regmap.h>\n#include <linux/mfd/syscon.h>\n#include <sound/soc.h>\n#include <sound/pcm.h>\n#include <sound/pcm_params.h>\n#include <sound/tlv.h>\n\n#define LPASS_CDC_CLK_RX_RESET_CTL\t\t(0x000)\n#define LPASS_CDC_CLK_TX_RESET_B1_CTL\t\t(0x004)\n#define CLK_RX_RESET_B1_CTL_TX1_RESET_MASK\tBIT(0)\n#define CLK_RX_RESET_B1_CTL_TX2_RESET_MASK\tBIT(1)\n#define LPASS_CDC_CLK_DMIC_B1_CTL\t\t(0x008)\n#define DMIC_B1_CTL_DMIC0_CLK_SEL_MASK\t\tGENMASK(3, 1)\n#define DMIC_B1_CTL_DMIC0_CLK_SEL_DIV2\t\t(0x0 << 1)\n#define DMIC_B1_CTL_DMIC0_CLK_SEL_DIV3\t\t(0x1 << 1)\n#define DMIC_B1_CTL_DMIC0_CLK_SEL_DIV4\t\t(0x2 << 1)\n#define DMIC_B1_CTL_DMIC0_CLK_SEL_DIV6\t\t(0x3 << 1)\n#define DMIC_B1_CTL_DMIC0_CLK_SEL_DIV16\t\t(0x4 << 1)\n#define DMIC_B1_CTL_DMIC0_CLK_EN_MASK\t\tBIT(0)\n#define DMIC_B1_CTL_DMIC0_CLK_EN_ENABLE\t\tBIT(0)\n\n#define LPASS_CDC_CLK_RX_I2S_CTL\t\t(0x00C)\n#define RX_I2S_CTL_RX_I2S_MODE_MASK\t\tBIT(5)\n#define RX_I2S_CTL_RX_I2S_MODE_16\t\tBIT(5)\n#define RX_I2S_CTL_RX_I2S_MODE_32\t\t0\n#define RX_I2S_CTL_RX_I2S_FS_RATE_MASK\t\tGENMASK(2, 0)\n#define RX_I2S_CTL_RX_I2S_FS_RATE_F_8_KHZ\t0x0\n#define RX_I2S_CTL_RX_I2S_FS_RATE_F_16_KHZ\t0x1\n#define RX_I2S_CTL_RX_I2S_FS_RATE_F_32_KHZ\t0x2\n#define RX_I2S_CTL_RX_I2S_FS_RATE_F_48_KHZ\t0x3\n#define RX_I2S_CTL_RX_I2S_FS_RATE_F_96_KHZ\t0x4\n#define RX_I2S_CTL_RX_I2S_FS_RATE_F_192_KHZ\t0x5\n#define LPASS_CDC_CLK_TX_I2S_CTL\t\t(0x010)\n#define TX_I2S_CTL_TX_I2S_MODE_MASK\t\tBIT(5)\n#define TX_I2S_CTL_TX_I2S_MODE_16\t\tBIT(5)\n#define TX_I2S_CTL_TX_I2S_MODE_32\t\t0\n#define TX_I2S_CTL_TX_I2S_FS_RATE_MASK\t\tGENMASK(2, 0)\n#define TX_I2S_CTL_TX_I2S_FS_RATE_F_8_KHZ\t0x0\n#define TX_I2S_CTL_TX_I2S_FS_RATE_F_16_KHZ\t0x1\n#define TX_I2S_CTL_TX_I2S_FS_RATE_F_32_KHZ\t0x2\n#define TX_I2S_CTL_TX_I2S_FS_RATE_F_48_KHZ\t0x3\n#define TX_I2S_CTL_TX_I2S_FS_RATE_F_96_KHZ\t0x4\n#define TX_I2S_CTL_TX_I2S_FS_RATE_F_192_KHZ\t0x5\n\n#define LPASS_CDC_CLK_OTHR_RESET_B1_CTL\t\t(0x014)\n#define LPASS_CDC_CLK_TX_CLK_EN_B1_CTL\t\t(0x018)\n#define LPASS_CDC_CLK_OTHR_CTL\t\t\t(0x01C)\n#define LPASS_CDC_CLK_RX_B1_CTL\t\t\t(0x020)\n#define LPASS_CDC_CLK_MCLK_CTL\t\t\t(0x024)\n#define MCLK_CTL_MCLK_EN_MASK\t\t\tBIT(0)\n#define MCLK_CTL_MCLK_EN_ENABLE\t\t\tBIT(0)\n#define MCLK_CTL_MCLK_EN_DISABLE\t\t0\n#define LPASS_CDC_CLK_PDM_CTL\t\t\t(0x028)\n#define LPASS_CDC_CLK_PDM_CTL_PDM_EN_MASK\tBIT(0)\n#define LPASS_CDC_CLK_PDM_CTL_PDM_EN\t\tBIT(0)\n#define LPASS_CDC_CLK_PDM_CTL_PDM_CLK_SEL_MASK\tBIT(1)\n#define LPASS_CDC_CLK_PDM_CTL_PDM_CLK_SEL_FB\tBIT(1)\n#define LPASS_CDC_CLK_PDM_CTL_PDM_CLK_PDM_CLK\t0\n\n#define LPASS_CDC_CLK_SD_CTL\t\t\t(0x02C)\n#define LPASS_CDC_RX1_B1_CTL\t\t\t(0x040)\n#define LPASS_CDC_RX2_B1_CTL\t\t\t(0x060)\n#define LPASS_CDC_RX3_B1_CTL\t\t\t(0x080)\n#define LPASS_CDC_RX1_B2_CTL\t\t\t(0x044)\n#define LPASS_CDC_RX2_B2_CTL\t\t\t(0x064)\n#define LPASS_CDC_RX3_B2_CTL\t\t\t(0x084)\n#define LPASS_CDC_RX1_B3_CTL\t\t\t(0x048)\n#define LPASS_CDC_RX2_B3_CTL\t\t\t(0x068)\n#define LPASS_CDC_RX3_B3_CTL\t\t\t(0x088)\n#define LPASS_CDC_RX1_B4_CTL\t\t\t(0x04C)\n#define LPASS_CDC_RX2_B4_CTL\t\t\t(0x06C)\n#define LPASS_CDC_RX3_B4_CTL\t\t\t(0x08C)\n#define LPASS_CDC_RX1_B5_CTL\t\t\t(0x050)\n#define LPASS_CDC_RX2_B5_CTL\t\t\t(0x070)\n#define LPASS_CDC_RX3_B5_CTL\t\t\t(0x090)\n#define LPASS_CDC_RX1_B6_CTL\t\t\t(0x054)\n#define RXn_B6_CTL_MUTE_MASK\t\t\tBIT(0)\n#define RXn_B6_CTL_MUTE_ENABLE\t\t\tBIT(0)\n#define RXn_B6_CTL_MUTE_DISABLE\t\t\t0\n#define LPASS_CDC_RX2_B6_CTL\t\t\t(0x074)\n#define LPASS_CDC_RX3_B6_CTL\t\t\t(0x094)\n#define LPASS_CDC_RX1_VOL_CTL_B1_CTL\t\t(0x058)\n#define LPASS_CDC_RX2_VOL_CTL_B1_CTL\t\t(0x078)\n#define LPASS_CDC_RX3_VOL_CTL_B1_CTL\t\t(0x098)\n#define LPASS_CDC_RX1_VOL_CTL_B2_CTL\t\t(0x05C)\n#define LPASS_CDC_RX2_VOL_CTL_B2_CTL\t\t(0x07C)\n#define LPASS_CDC_RX3_VOL_CTL_B2_CTL\t\t(0x09C)\n#define LPASS_CDC_TOP_GAIN_UPDATE\t\t(0x0A0)\n#define LPASS_CDC_TOP_CTL\t\t\t(0x0A4)\n#define TOP_CTL_DIG_MCLK_FREQ_MASK\t\tBIT(0)\n#define TOP_CTL_DIG_MCLK_FREQ_F_12_288MHZ\t0\n#define TOP_CTL_DIG_MCLK_FREQ_F_9_6MHZ\t\tBIT(0)\n\n#define LPASS_CDC_DEBUG_DESER1_CTL\t\t(0x0E0)\n#define LPASS_CDC_DEBUG_DESER2_CTL\t\t(0x0E4)\n#define LPASS_CDC_DEBUG_B1_CTL_CFG\t\t(0x0E8)\n#define LPASS_CDC_DEBUG_B2_CTL_CFG\t\t(0x0EC)\n#define LPASS_CDC_DEBUG_B3_CTL_CFG\t\t(0x0F0)\n#define LPASS_CDC_IIR1_GAIN_B1_CTL\t\t(0x100)\n#define LPASS_CDC_IIR2_GAIN_B1_CTL\t\t(0x140)\n#define LPASS_CDC_IIR1_GAIN_B2_CTL\t\t(0x104)\n#define LPASS_CDC_IIR2_GAIN_B2_CTL\t\t(0x144)\n#define LPASS_CDC_IIR1_GAIN_B3_CTL\t\t(0x108)\n#define LPASS_CDC_IIR2_GAIN_B3_CTL\t\t(0x148)\n#define LPASS_CDC_IIR1_GAIN_B4_CTL\t\t(0x10C)\n#define LPASS_CDC_IIR2_GAIN_B4_CTL\t\t(0x14C)\n#define LPASS_CDC_IIR1_GAIN_B5_CTL\t\t(0x110)\n#define LPASS_CDC_IIR2_GAIN_B5_CTL\t\t(0x150)\n#define LPASS_CDC_IIR1_GAIN_B6_CTL\t\t(0x114)\n#define LPASS_CDC_IIR2_GAIN_B6_CTL\t\t(0x154)\n#define LPASS_CDC_IIR1_GAIN_B7_CTL\t\t(0x118)\n#define LPASS_CDC_IIR2_GAIN_B7_CTL\t\t(0x158)\n#define LPASS_CDC_IIR1_GAIN_B8_CTL\t\t(0x11C)\n#define LPASS_CDC_IIR2_GAIN_B8_CTL\t\t(0x15C)\n#define LPASS_CDC_IIR1_CTL\t\t\t(0x120)\n#define LPASS_CDC_IIR2_CTL\t\t\t(0x160)\n#define LPASS_CDC_IIR1_GAIN_TIMER_CTL\t\t(0x124)\n#define LPASS_CDC_IIR2_GAIN_TIMER_CTL\t\t(0x164)\n#define LPASS_CDC_IIR1_COEF_B1_CTL\t\t(0x128)\n#define LPASS_CDC_IIR2_COEF_B1_CTL\t\t(0x168)\n#define LPASS_CDC_IIR1_COEF_B2_CTL\t\t(0x12C)\n#define LPASS_CDC_IIR2_COEF_B2_CTL\t\t(0x16C)\n#define LPASS_CDC_CONN_RX1_B1_CTL\t\t(0x180)\n#define LPASS_CDC_CONN_RX1_B2_CTL\t\t(0x184)\n#define LPASS_CDC_CONN_RX1_B3_CTL\t\t(0x188)\n#define LPASS_CDC_CONN_RX2_B1_CTL\t\t(0x18C)\n#define LPASS_CDC_CONN_RX2_B2_CTL\t\t(0x190)\n#define LPASS_CDC_CONN_RX2_B3_CTL\t\t(0x194)\n#define LPASS_CDC_CONN_RX3_B1_CTL\t\t(0x198)\n#define LPASS_CDC_CONN_RX3_B2_CTL\t\t(0x19C)\n#define LPASS_CDC_CONN_TX_B1_CTL\t\t(0x1A0)\n#define LPASS_CDC_CONN_EQ1_B1_CTL\t\t(0x1A8)\n#define LPASS_CDC_CONN_EQ1_B2_CTL\t\t(0x1AC)\n#define LPASS_CDC_CONN_EQ1_B3_CTL\t\t(0x1B0)\n#define LPASS_CDC_CONN_EQ1_B4_CTL\t\t(0x1B4)\n#define LPASS_CDC_CONN_EQ2_B1_CTL\t\t(0x1B8)\n#define LPASS_CDC_CONN_EQ2_B2_CTL\t\t(0x1BC)\n#define LPASS_CDC_CONN_EQ2_B3_CTL\t\t(0x1C0)\n#define LPASS_CDC_CONN_EQ2_B4_CTL\t\t(0x1C4)\n#define LPASS_CDC_CONN_TX_I2S_SD1_CTL\t\t(0x1C8)\n#define LPASS_CDC_TX1_VOL_CTL_TIMER\t\t(0x280)\n#define LPASS_CDC_TX2_VOL_CTL_TIMER\t\t(0x2A0)\n#define LPASS_CDC_TX1_VOL_CTL_GAIN\t\t(0x284)\n#define LPASS_CDC_TX2_VOL_CTL_GAIN\t\t(0x2A4)\n#define LPASS_CDC_TX1_VOL_CTL_CFG\t\t(0x288)\n#define TX_VOL_CTL_CFG_MUTE_EN_MASK\t\tBIT(0)\n#define TX_VOL_CTL_CFG_MUTE_EN_ENABLE\t\tBIT(0)\n\n#define LPASS_CDC_TX2_VOL_CTL_CFG\t\t(0x2A8)\n#define LPASS_CDC_TX1_MUX_CTL\t\t\t(0x28C)\n#define TX_MUX_CTL_CUT_OFF_FREQ_MASK\t\tGENMASK(5, 4)\n#define TX_MUX_CTL_CUT_OFF_FREQ_SHIFT\t\t4\n#define TX_MUX_CTL_CF_NEG_3DB_4HZ\t\t(0x0 << 4)\n#define TX_MUX_CTL_CF_NEG_3DB_75HZ\t\t(0x1 << 4)\n#define TX_MUX_CTL_CF_NEG_3DB_150HZ\t\t(0x2 << 4)\n#define TX_MUX_CTL_HPF_BP_SEL_MASK\t\tBIT(3)\n#define TX_MUX_CTL_HPF_BP_SEL_BYPASS\t\tBIT(3)\n#define TX_MUX_CTL_HPF_BP_SEL_NO_BYPASS\t\t0\n\n#define LPASS_CDC_TX2_MUX_CTL\t\t\t(0x2AC)\n#define LPASS_CDC_TX1_CLK_FS_CTL\t\t(0x290)\n#define LPASS_CDC_TX2_CLK_FS_CTL\t\t(0x2B0)\n#define LPASS_CDC_TX1_DMIC_CTL\t\t\t(0x294)\n#define LPASS_CDC_TX2_DMIC_CTL\t\t\t(0x2B4)\n#define TXN_DMIC_CTL_CLK_SEL_MASK\t\tGENMASK(2, 0)\n#define TXN_DMIC_CTL_CLK_SEL_DIV2\t\t0x0\n#define TXN_DMIC_CTL_CLK_SEL_DIV3\t\t0x1\n#define TXN_DMIC_CTL_CLK_SEL_DIV4\t\t0x2\n#define TXN_DMIC_CTL_CLK_SEL_DIV6\t\t0x3\n#define TXN_DMIC_CTL_CLK_SEL_DIV16\t\t0x4\n\n#define MSM8916_WCD_DIGITAL_RATES (SNDRV_PCM_RATE_8000 | \\\n\t\t\t\t   SNDRV_PCM_RATE_16000 | \\\n\t\t\t\t   SNDRV_PCM_RATE_32000 | \\\n\t\t\t\t   SNDRV_PCM_RATE_48000)\n#define MSM8916_WCD_DIGITAL_FORMATS (SNDRV_PCM_FMTBIT_S16_LE |\\\n\t\t\t\t     SNDRV_PCM_FMTBIT_S32_LE)\n\n \nenum {\n\tIIR1 = 0,\n\tIIR2,\n\tIIR_MAX,\n};\n\n \nenum {\n\tBAND1 = 0,\n\tBAND2,\n\tBAND3,\n\tBAND4,\n\tBAND5,\n\tBAND_MAX,\n};\n\n#define WCD_IIR_FILTER_SIZE\t(sizeof(u32)*BAND_MAX)\n\n#define WCD_IIR_FILTER_CTL(xname, iidx, bidx) \\\n{       .iface = SNDRV_CTL_ELEM_IFACE_MIXER, .name = xname, \\\n\t.info = wcd_iir_filter_info, \\\n\t.get = msm8x16_wcd_get_iir_band_audio_mixer, \\\n\t.put = msm8x16_wcd_put_iir_band_audio_mixer, \\\n\t.private_value = (unsigned long)&(struct wcd_iir_filter_ctl) { \\\n\t\t.iir_idx = iidx, \\\n\t\t.band_idx = bidx, \\\n\t\t.bytes_ext = {.max = WCD_IIR_FILTER_SIZE, }, \\\n\t} \\\n}\n\nstruct wcd_iir_filter_ctl {\n\tunsigned int iir_idx;\n\tunsigned int band_idx;\n\tstruct soc_bytes_ext bytes_ext;\n};\n\nstruct msm8916_wcd_digital_priv {\n\tstruct clk *ahbclk, *mclk;\n};\n\nstatic const unsigned long rx_gain_reg[] = {\n\tLPASS_CDC_RX1_VOL_CTL_B2_CTL,\n\tLPASS_CDC_RX2_VOL_CTL_B2_CTL,\n\tLPASS_CDC_RX3_VOL_CTL_B2_CTL,\n};\n\nstatic const unsigned long tx_gain_reg[] = {\n\tLPASS_CDC_TX1_VOL_CTL_GAIN,\n\tLPASS_CDC_TX2_VOL_CTL_GAIN,\n};\n\nstatic const char *const rx_mix1_text[] = {\n\t\"ZERO\", \"IIR1\", \"IIR2\", \"RX1\", \"RX2\", \"RX3\"\n};\n\nstatic const char * const rx_mix2_text[] = {\n\t\"ZERO\", \"IIR1\", \"IIR2\"\n};\n\nstatic const char *const dec_mux_text[] = {\n\t\"ZERO\", \"ADC1\", \"ADC2\", \"ADC3\", \"DMIC1\", \"DMIC2\"\n};\n\nstatic const char *const cic_mux_text[] = { \"AMIC\", \"DMIC\" };\n\n \nstatic const struct soc_enum rx_mix1_inp_enum[] = {\n\tSOC_ENUM_SINGLE(LPASS_CDC_CONN_RX1_B1_CTL, 0, 6, rx_mix1_text),\n\tSOC_ENUM_SINGLE(LPASS_CDC_CONN_RX1_B1_CTL, 3, 6, rx_mix1_text),\n\tSOC_ENUM_SINGLE(LPASS_CDC_CONN_RX1_B2_CTL, 0, 6, rx_mix1_text),\n};\n\n \nstatic const struct soc_enum rx2_mix1_inp_enum[] = {\n\tSOC_ENUM_SINGLE(LPASS_CDC_CONN_RX2_B1_CTL, 0, 6, rx_mix1_text),\n\tSOC_ENUM_SINGLE(LPASS_CDC_CONN_RX2_B1_CTL, 3, 6, rx_mix1_text),\n\tSOC_ENUM_SINGLE(LPASS_CDC_CONN_RX2_B2_CTL, 0, 6, rx_mix1_text),\n};\n\n \nstatic const struct soc_enum rx3_mix1_inp_enum[] = {\n\tSOC_ENUM_SINGLE(LPASS_CDC_CONN_RX3_B1_CTL, 0, 6, rx_mix1_text),\n\tSOC_ENUM_SINGLE(LPASS_CDC_CONN_RX3_B1_CTL, 3, 6, rx_mix1_text),\n\tSOC_ENUM_SINGLE(LPASS_CDC_CONN_RX3_B2_CTL, 0, 6, rx_mix1_text),\n};\n\n \nstatic const struct soc_enum rx_mix2_inp1_chain_enum =\n\tSOC_ENUM_SINGLE(LPASS_CDC_CONN_RX1_B3_CTL,\n\t\t0, 3, rx_mix2_text);\n\n \nstatic const struct soc_enum rx2_mix2_inp1_chain_enum =\n\tSOC_ENUM_SINGLE(LPASS_CDC_CONN_RX2_B3_CTL,\n\t\t0, 3, rx_mix2_text);\n\n \nstatic const struct soc_enum dec1_mux_enum = SOC_ENUM_SINGLE(\n\t\t\t\tLPASS_CDC_CONN_TX_B1_CTL, 0, 6, dec_mux_text);\nstatic const struct soc_enum dec2_mux_enum = SOC_ENUM_SINGLE(\n\t\t\t\tLPASS_CDC_CONN_TX_B1_CTL, 3, 6, dec_mux_text);\n\n \nstatic const struct soc_enum cic1_mux_enum = SOC_ENUM_SINGLE(\n\t\t\t\tLPASS_CDC_TX1_MUX_CTL, 0, 2, cic_mux_text);\nstatic const struct soc_enum cic2_mux_enum = SOC_ENUM_SINGLE(\n\t\t\t\tLPASS_CDC_TX2_MUX_CTL, 0, 2, cic_mux_text);\n\n \nstatic const struct snd_kcontrol_new dec1_mux = SOC_DAPM_ENUM(\n\t\t\t\t\"DEC1 MUX Mux\", dec1_mux_enum);\nstatic const struct snd_kcontrol_new dec2_mux = SOC_DAPM_ENUM(\n\t\t\t\t\"DEC2 MUX Mux\",\tdec2_mux_enum);\nstatic const struct snd_kcontrol_new cic1_mux = SOC_DAPM_ENUM(\n\t\t\t\t\"CIC1 MUX Mux\", cic1_mux_enum);\nstatic const struct snd_kcontrol_new cic2_mux = SOC_DAPM_ENUM(\n\t\t\t\t\"CIC2 MUX Mux\",\tcic2_mux_enum);\nstatic const struct snd_kcontrol_new rx_mix1_inp1_mux = SOC_DAPM_ENUM(\n\t\t\t\t\"RX1 MIX1 INP1 Mux\", rx_mix1_inp_enum[0]);\nstatic const struct snd_kcontrol_new rx_mix1_inp2_mux = SOC_DAPM_ENUM(\n\t\t\t\t\"RX1 MIX1 INP2 Mux\", rx_mix1_inp_enum[1]);\nstatic const struct snd_kcontrol_new rx_mix1_inp3_mux = SOC_DAPM_ENUM(\n\t\t\t\t\"RX1 MIX1 INP3 Mux\", rx_mix1_inp_enum[2]);\nstatic const struct snd_kcontrol_new rx2_mix1_inp1_mux = SOC_DAPM_ENUM(\n\t\t\t\t\"RX2 MIX1 INP1 Mux\", rx2_mix1_inp_enum[0]);\nstatic const struct snd_kcontrol_new rx2_mix1_inp2_mux = SOC_DAPM_ENUM(\n\t\t\t\t\"RX2 MIX1 INP2 Mux\", rx2_mix1_inp_enum[1]);\nstatic const struct snd_kcontrol_new rx2_mix1_inp3_mux = SOC_DAPM_ENUM(\n\t\t\t\t\"RX2 MIX1 INP3 Mux\", rx2_mix1_inp_enum[2]);\nstatic const struct snd_kcontrol_new rx3_mix1_inp1_mux = SOC_DAPM_ENUM(\n\t\t\t\t\"RX3 MIX1 INP1 Mux\", rx3_mix1_inp_enum[0]);\nstatic const struct snd_kcontrol_new rx3_mix1_inp2_mux = SOC_DAPM_ENUM(\n\t\t\t\t\"RX3 MIX1 INP2 Mux\", rx3_mix1_inp_enum[1]);\nstatic const struct snd_kcontrol_new rx3_mix1_inp3_mux = SOC_DAPM_ENUM(\n\t\t\t\t\"RX3 MIX1 INP3 Mux\", rx3_mix1_inp_enum[2]);\nstatic const struct snd_kcontrol_new rx1_mix2_inp1_mux = SOC_DAPM_ENUM(\n\t\t\t\t\"RX1 MIX2 INP1 Mux\", rx_mix2_inp1_chain_enum);\nstatic const struct snd_kcontrol_new rx2_mix2_inp1_mux = SOC_DAPM_ENUM(\n\t\t\t\t\"RX2 MIX2 INP1 Mux\", rx2_mix2_inp1_chain_enum);\n\n \nstatic const DECLARE_TLV_DB_SCALE(digital_gain, -8400, 100, -8400);\n\n \nstatic const char * const hpf_cutoff_text[] = {\n\t\"4Hz\", \"75Hz\", \"150Hz\",\n};\n\nstatic SOC_ENUM_SINGLE_DECL(tx1_hpf_cutoff_enum, LPASS_CDC_TX1_MUX_CTL, 4,\n\t\t\t    hpf_cutoff_text);\nstatic SOC_ENUM_SINGLE_DECL(tx2_hpf_cutoff_enum, LPASS_CDC_TX2_MUX_CTL, 4,\n\t\t\t    hpf_cutoff_text);\n\n \nstatic const char * const dc_blocker_cutoff_text[] = {\n\t\"4Hz\", \"75Hz\", \"150Hz\",\n};\n\nstatic SOC_ENUM_SINGLE_DECL(rx1_dcb_cutoff_enum, LPASS_CDC_RX1_B4_CTL, 0,\n\t\t\t    dc_blocker_cutoff_text);\nstatic SOC_ENUM_SINGLE_DECL(rx2_dcb_cutoff_enum, LPASS_CDC_RX2_B4_CTL, 0,\n\t\t\t    dc_blocker_cutoff_text);\nstatic SOC_ENUM_SINGLE_DECL(rx3_dcb_cutoff_enum, LPASS_CDC_RX3_B4_CTL, 0,\n\t\t\t    dc_blocker_cutoff_text);\n\nstatic int msm8x16_wcd_codec_set_iir_gain(struct snd_soc_dapm_widget *w,\n\t\tstruct snd_kcontrol *kcontrol, int event)\n{\n\tstruct snd_soc_component *component =\n\t\t\tsnd_soc_dapm_to_component(w->dapm);\n\tint value = 0, reg = 0;\n\n\tswitch (event) {\n\tcase SND_SOC_DAPM_POST_PMU:\n\t\tif (w->shift == 0)\n\t\t\treg = LPASS_CDC_IIR1_GAIN_B1_CTL;\n\t\telse if (w->shift == 1)\n\t\t\treg = LPASS_CDC_IIR2_GAIN_B1_CTL;\n\t\tvalue = snd_soc_component_read(component, reg);\n\t\tsnd_soc_component_write(component, reg, value);\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n\treturn 0;\n}\n\nstatic uint32_t get_iir_band_coeff(struct snd_soc_component *component,\n\t\t\t\t   int iir_idx, int band_idx,\n\t\t\t\t   int coeff_idx)\n{\n\tuint32_t value = 0;\n\n\t \n\tsnd_soc_component_write(component,\n\t\t(LPASS_CDC_IIR1_COEF_B1_CTL + 64 * iir_idx),\n\t\t((band_idx * BAND_MAX + coeff_idx)\n\t\t* sizeof(uint32_t)) & 0x7F);\n\n\tvalue |= snd_soc_component_read(component,\n\t\t(LPASS_CDC_IIR1_COEF_B2_CTL + 64 * iir_idx));\n\n\tsnd_soc_component_write(component,\n\t\t(LPASS_CDC_IIR1_COEF_B1_CTL + 64 * iir_idx),\n\t\t((band_idx * BAND_MAX + coeff_idx)\n\t\t* sizeof(uint32_t) + 1) & 0x7F);\n\n\tvalue |= (snd_soc_component_read(component,\n\t\t(LPASS_CDC_IIR1_COEF_B2_CTL + 64 * iir_idx)) << 8);\n\n\tsnd_soc_component_write(component,\n\t\t(LPASS_CDC_IIR1_COEF_B1_CTL + 64 * iir_idx),\n\t\t((band_idx * BAND_MAX + coeff_idx)\n\t\t* sizeof(uint32_t) + 2) & 0x7F);\n\n\tvalue |= (snd_soc_component_read(component,\n\t\t(LPASS_CDC_IIR1_COEF_B2_CTL + 64 * iir_idx)) << 16);\n\n\tsnd_soc_component_write(component,\n\t\t(LPASS_CDC_IIR1_COEF_B1_CTL + 64 * iir_idx),\n\t\t((band_idx * BAND_MAX + coeff_idx)\n\t\t* sizeof(uint32_t) + 3) & 0x7F);\n\n\t \n\tvalue |= ((snd_soc_component_read(component,\n\t\t (LPASS_CDC_IIR1_COEF_B2_CTL + 64 * iir_idx)) & 0x3f) << 24);\n\treturn value;\n\n}\n\nstatic int msm8x16_wcd_get_iir_band_audio_mixer(\n\t\t\t\t\tstruct snd_kcontrol *kcontrol,\n\t\t\t\t\tstruct snd_ctl_elem_value *ucontrol)\n{\n\n\tstruct snd_soc_component *component =\n\t\t\tsnd_soc_kcontrol_component(kcontrol);\n\tstruct wcd_iir_filter_ctl *ctl =\n\t\t\t(struct wcd_iir_filter_ctl *)kcontrol->private_value;\n\tstruct soc_bytes_ext *params = &ctl->bytes_ext;\n\tint iir_idx = ctl->iir_idx;\n\tint band_idx = ctl->band_idx;\n\tu32 coeff[BAND_MAX];\n\n\tcoeff[0] = get_iir_band_coeff(component, iir_idx, band_idx, 0);\n\tcoeff[1] = get_iir_band_coeff(component, iir_idx, band_idx, 1);\n\tcoeff[2] = get_iir_band_coeff(component, iir_idx, band_idx, 2);\n\tcoeff[3] = get_iir_band_coeff(component, iir_idx, band_idx, 3);\n\tcoeff[4] = get_iir_band_coeff(component, iir_idx, band_idx, 4);\n\n\tmemcpy(ucontrol->value.bytes.data, &coeff[0], params->max);\n\n\treturn 0;\n}\n\nstatic void set_iir_band_coeff(struct snd_soc_component *component,\n\t\t\t\tint iir_idx, int band_idx,\n\t\t\t\tuint32_t value)\n{\n\tsnd_soc_component_write(component,\n\t\t(LPASS_CDC_IIR1_COEF_B2_CTL + 64 * iir_idx),\n\t\t(value & 0xFF));\n\n\tsnd_soc_component_write(component,\n\t\t(LPASS_CDC_IIR1_COEF_B2_CTL + 64 * iir_idx),\n\t\t(value >> 8) & 0xFF);\n\n\tsnd_soc_component_write(component,\n\t\t(LPASS_CDC_IIR1_COEF_B2_CTL + 64 * iir_idx),\n\t\t(value >> 16) & 0xFF);\n\n\t \n\tsnd_soc_component_write(component,\n\t\t(LPASS_CDC_IIR1_COEF_B2_CTL + 64 * iir_idx),\n\t\t(value >> 24) & 0x3F);\n}\n\nstatic int msm8x16_wcd_put_iir_band_audio_mixer(\n\t\t\t\t\tstruct snd_kcontrol *kcontrol,\n\t\t\t\t\tstruct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_soc_component *component =\n\t\t\tsnd_soc_kcontrol_component(kcontrol);\n\tstruct wcd_iir_filter_ctl *ctl =\n\t\t\t(struct wcd_iir_filter_ctl *)kcontrol->private_value;\n\tstruct soc_bytes_ext *params = &ctl->bytes_ext;\n\tint iir_idx = ctl->iir_idx;\n\tint band_idx = ctl->band_idx;\n\tu32 coeff[BAND_MAX];\n\n\tmemcpy(&coeff[0], ucontrol->value.bytes.data, params->max);\n\n\t \n\t \n\tsnd_soc_component_write(component,\n\t\t(LPASS_CDC_IIR1_COEF_B1_CTL + 64 * iir_idx),\n\t\t(band_idx * BAND_MAX * sizeof(uint32_t)) & 0x7F);\n\n\tset_iir_band_coeff(component, iir_idx, band_idx, coeff[0]);\n\tset_iir_band_coeff(component, iir_idx, band_idx, coeff[1]);\n\tset_iir_band_coeff(component, iir_idx, band_idx, coeff[2]);\n\tset_iir_band_coeff(component, iir_idx, band_idx, coeff[3]);\n\tset_iir_band_coeff(component, iir_idx, band_idx, coeff[4]);\n\n\treturn 0;\n}\n\nstatic int wcd_iir_filter_info(struct snd_kcontrol *kcontrol,\n\t\t\t\tstruct snd_ctl_elem_info *ucontrol)\n{\n\tstruct wcd_iir_filter_ctl *ctl =\n\t\t(struct wcd_iir_filter_ctl *)kcontrol->private_value;\n\tstruct soc_bytes_ext *params = &ctl->bytes_ext;\n\n\tucontrol->type = SNDRV_CTL_ELEM_TYPE_BYTES;\n\tucontrol->count = params->max;\n\n\treturn 0;\n}\n\nstatic const struct snd_kcontrol_new msm8916_wcd_digital_snd_controls[] = {\n\tSOC_SINGLE_S8_TLV(\"RX1 Digital Volume\", LPASS_CDC_RX1_VOL_CTL_B2_CTL,\n\t\t\t-84, 40, digital_gain),\n\tSOC_SINGLE_S8_TLV(\"RX2 Digital Volume\", LPASS_CDC_RX2_VOL_CTL_B2_CTL,\n\t\t\t-84, 40, digital_gain),\n\tSOC_SINGLE_S8_TLV(\"RX3 Digital Volume\", LPASS_CDC_RX3_VOL_CTL_B2_CTL,\n\t\t\t-84, 40, digital_gain),\n\tSOC_SINGLE_S8_TLV(\"TX1 Digital Volume\", LPASS_CDC_TX1_VOL_CTL_GAIN,\n\t\t\t-84, 40, digital_gain),\n\tSOC_SINGLE_S8_TLV(\"TX2 Digital Volume\", LPASS_CDC_TX2_VOL_CTL_GAIN,\n\t\t\t-84, 40, digital_gain),\n\tSOC_ENUM(\"TX1 HPF Cutoff\", tx1_hpf_cutoff_enum),\n\tSOC_ENUM(\"TX2 HPF Cutoff\", tx2_hpf_cutoff_enum),\n\tSOC_SINGLE(\"TX1 HPF Switch\", LPASS_CDC_TX1_MUX_CTL, 3, 1, 0),\n\tSOC_SINGLE(\"TX2 HPF Switch\", LPASS_CDC_TX2_MUX_CTL, 3, 1, 0),\n\tSOC_ENUM(\"RX1 DCB Cutoff\", rx1_dcb_cutoff_enum),\n\tSOC_ENUM(\"RX2 DCB Cutoff\", rx2_dcb_cutoff_enum),\n\tSOC_ENUM(\"RX3 DCB Cutoff\", rx3_dcb_cutoff_enum),\n\tSOC_SINGLE(\"RX1 DCB Switch\", LPASS_CDC_RX1_B5_CTL, 2, 1, 0),\n\tSOC_SINGLE(\"RX2 DCB Switch\", LPASS_CDC_RX2_B5_CTL, 2, 1, 0),\n\tSOC_SINGLE(\"RX3 DCB Switch\", LPASS_CDC_RX3_B5_CTL, 2, 1, 0),\n\tSOC_SINGLE(\"RX1 Mute Switch\", LPASS_CDC_RX1_B6_CTL, 0, 1, 0),\n\tSOC_SINGLE(\"RX2 Mute Switch\", LPASS_CDC_RX2_B6_CTL, 0, 1, 0),\n\tSOC_SINGLE(\"RX3 Mute Switch\", LPASS_CDC_RX3_B6_CTL, 0, 1, 0),\n\n\tSOC_SINGLE(\"IIR1 Band1 Switch\", LPASS_CDC_IIR1_CTL, 0, 1, 0),\n\tSOC_SINGLE(\"IIR1 Band2 Switch\", LPASS_CDC_IIR1_CTL, 1, 1, 0),\n\tSOC_SINGLE(\"IIR1 Band3 Switch\", LPASS_CDC_IIR1_CTL, 2, 1, 0),\n\tSOC_SINGLE(\"IIR1 Band4 Switch\", LPASS_CDC_IIR1_CTL, 3, 1, 0),\n\tSOC_SINGLE(\"IIR1 Band5 Switch\", LPASS_CDC_IIR1_CTL, 4, 1, 0),\n\tSOC_SINGLE(\"IIR2 Band1 Switch\", LPASS_CDC_IIR2_CTL, 0, 1, 0),\n\tSOC_SINGLE(\"IIR2 Band2 Switch\", LPASS_CDC_IIR2_CTL, 1, 1, 0),\n\tSOC_SINGLE(\"IIR2 Band3 Switch\", LPASS_CDC_IIR2_CTL, 2, 1, 0),\n\tSOC_SINGLE(\"IIR2 Band4 Switch\", LPASS_CDC_IIR2_CTL, 3, 1, 0),\n\tSOC_SINGLE(\"IIR2 Band5 Switch\", LPASS_CDC_IIR2_CTL, 4, 1, 0),\n\tWCD_IIR_FILTER_CTL(\"IIR1 Band1\", IIR1, BAND1),\n\tWCD_IIR_FILTER_CTL(\"IIR1 Band2\", IIR1, BAND2),\n\tWCD_IIR_FILTER_CTL(\"IIR1 Band3\", IIR1, BAND3),\n\tWCD_IIR_FILTER_CTL(\"IIR1 Band4\", IIR1, BAND4),\n\tWCD_IIR_FILTER_CTL(\"IIR1 Band5\", IIR1, BAND5),\n\tWCD_IIR_FILTER_CTL(\"IIR2 Band1\", IIR2, BAND1),\n\tWCD_IIR_FILTER_CTL(\"IIR2 Band2\", IIR2, BAND2),\n\tWCD_IIR_FILTER_CTL(\"IIR2 Band3\", IIR2, BAND3),\n\tWCD_IIR_FILTER_CTL(\"IIR2 Band4\", IIR2, BAND4),\n\tWCD_IIR_FILTER_CTL(\"IIR2 Band5\", IIR2, BAND5),\n\tSOC_SINGLE_S8_TLV(\"IIR1 INP1 Volume\", LPASS_CDC_IIR1_GAIN_B1_CTL,\n\t\t\t-84, 40, digital_gain),\n\tSOC_SINGLE_S8_TLV(\"IIR1 INP2 Volume\", LPASS_CDC_IIR1_GAIN_B2_CTL,\n\t\t\t-84, 40, digital_gain),\n\tSOC_SINGLE_S8_TLV(\"IIR1 INP3 Volume\", LPASS_CDC_IIR1_GAIN_B3_CTL,\n\t\t\t-84, 40, digital_gain),\n\tSOC_SINGLE_S8_TLV(\"IIR1 INP4 Volume\", LPASS_CDC_IIR1_GAIN_B4_CTL,\n\t\t\t-84, 40, digital_gain),\n\tSOC_SINGLE_S8_TLV(\"IIR2 INP1 Volume\", LPASS_CDC_IIR2_GAIN_B1_CTL,\n\t\t\t-84, 40, digital_gain),\n\tSOC_SINGLE_S8_TLV(\"IIR2 INP2 Volume\", LPASS_CDC_IIR2_GAIN_B2_CTL,\n\t\t\t-84, 40, digital_gain),\n\tSOC_SINGLE_S8_TLV(\"IIR2 INP3 Volume\", LPASS_CDC_IIR2_GAIN_B3_CTL,\n\t\t\t-84, 40, digital_gain),\n\tSOC_SINGLE_S8_TLV(\"IIR2 INP4 Volume\", LPASS_CDC_IIR2_GAIN_B4_CTL,\n\t\t\t-84, 40, digital_gain),\n\n};\n\nstatic int msm8916_wcd_digital_enable_interpolator(\n\t\t\t\t\t\tstruct snd_soc_dapm_widget *w,\n\t\t\t\t\t\tstruct snd_kcontrol *kcontrol,\n\t\t\t\t\t\tint event)\n{\n\tstruct snd_soc_component *component = snd_soc_dapm_to_component(w->dapm);\n\n\tswitch (event) {\n\tcase SND_SOC_DAPM_POST_PMU:\n\t\t \n\t\tusleep_range(10000, 10100);\n\t\tsnd_soc_component_write(component, rx_gain_reg[w->shift],\n\t\t\t      snd_soc_component_read(component, rx_gain_reg[w->shift]));\n\t\tbreak;\n\tcase SND_SOC_DAPM_POST_PMD:\n\t\tsnd_soc_component_update_bits(component, LPASS_CDC_CLK_RX_RESET_CTL,\n\t\t\t\t\t      1 << w->shift, 1 << w->shift);\n\t\tsnd_soc_component_update_bits(component, LPASS_CDC_CLK_RX_RESET_CTL,\n\t\t\t\t\t      1 << w->shift, 0x0);\n\t\tbreak;\n\t}\n\treturn 0;\n}\n\nstatic int msm8916_wcd_digital_enable_dec(struct snd_soc_dapm_widget *w,\n\t\t\t\t\t  struct snd_kcontrol *kcontrol,\n\t\t\t\t\t  int event)\n{\n\tstruct snd_soc_component *component = snd_soc_dapm_to_component(w->dapm);\n\tunsigned int decimator = w->shift + 1;\n\tu16 dec_reset_reg, tx_vol_ctl_reg, tx_mux_ctl_reg;\n\tu8 dec_hpf_cut_of_freq;\n\n\tdec_reset_reg = LPASS_CDC_CLK_TX_RESET_B1_CTL;\n\ttx_vol_ctl_reg = LPASS_CDC_TX1_VOL_CTL_CFG + 32 * (decimator - 1);\n\ttx_mux_ctl_reg = LPASS_CDC_TX1_MUX_CTL + 32 * (decimator - 1);\n\n\tswitch (event) {\n\tcase SND_SOC_DAPM_PRE_PMU:\n\t\t \n\t\tsnd_soc_component_update_bits(component, tx_vol_ctl_reg,\n\t\t\t\t    TX_VOL_CTL_CFG_MUTE_EN_MASK,\n\t\t\t\t    TX_VOL_CTL_CFG_MUTE_EN_ENABLE);\n\t\tdec_hpf_cut_of_freq = snd_soc_component_read(component, tx_mux_ctl_reg) &\n\t\t\t\t\tTX_MUX_CTL_CUT_OFF_FREQ_MASK;\n\t\tdec_hpf_cut_of_freq >>= TX_MUX_CTL_CUT_OFF_FREQ_SHIFT;\n\t\tif (dec_hpf_cut_of_freq != TX_MUX_CTL_CF_NEG_3DB_150HZ) {\n\t\t\t \n\t\t\tsnd_soc_component_update_bits(component, tx_mux_ctl_reg,\n\t\t\t\t\t    TX_MUX_CTL_CUT_OFF_FREQ_MASK,\n\t\t\t\t\t    TX_MUX_CTL_CF_NEG_3DB_150HZ);\n\t\t}\n\t\tbreak;\n\tcase SND_SOC_DAPM_POST_PMU:\n\t\t \n\t\tsnd_soc_component_update_bits(component, tx_mux_ctl_reg,\n\t\t\t\t    TX_MUX_CTL_HPF_BP_SEL_MASK,\n\t\t\t\t    TX_MUX_CTL_HPF_BP_SEL_NO_BYPASS);\n\t\t \n\t\tsnd_soc_component_write(component, tx_gain_reg[w->shift],\n\t\t\t      snd_soc_component_read(component, tx_gain_reg[w->shift]));\n\t\tsnd_soc_component_update_bits(component, tx_vol_ctl_reg,\n\t\t\t\t    TX_VOL_CTL_CFG_MUTE_EN_MASK, 0);\n\t\tbreak;\n\tcase SND_SOC_DAPM_PRE_PMD:\n\t\tsnd_soc_component_update_bits(component, tx_vol_ctl_reg,\n\t\t\t\t    TX_VOL_CTL_CFG_MUTE_EN_MASK,\n\t\t\t\t    TX_VOL_CTL_CFG_MUTE_EN_ENABLE);\n\t\tsnd_soc_component_update_bits(component, tx_mux_ctl_reg,\n\t\t\t\t    TX_MUX_CTL_HPF_BP_SEL_MASK,\n\t\t\t\t    TX_MUX_CTL_HPF_BP_SEL_BYPASS);\n\t\tbreak;\n\tcase SND_SOC_DAPM_POST_PMD:\n\t\tsnd_soc_component_update_bits(component, dec_reset_reg, 1 << w->shift,\n\t\t\t\t    1 << w->shift);\n\t\tsnd_soc_component_update_bits(component, dec_reset_reg, 1 << w->shift, 0x0);\n\t\tsnd_soc_component_update_bits(component, tx_mux_ctl_reg,\n\t\t\t\t    TX_MUX_CTL_HPF_BP_SEL_MASK,\n\t\t\t\t    TX_MUX_CTL_HPF_BP_SEL_BYPASS);\n\t\tsnd_soc_component_update_bits(component, tx_vol_ctl_reg,\n\t\t\t\t    TX_VOL_CTL_CFG_MUTE_EN_MASK, 0);\n\t\tbreak;\n\t}\n\n\treturn 0;\n}\n\nstatic int msm8916_wcd_digital_enable_dmic(struct snd_soc_dapm_widget *w,\n\t\t\t\t\t   struct snd_kcontrol *kcontrol,\n\t\t\t\t\t   int event)\n{\n\tstruct snd_soc_component *component = snd_soc_dapm_to_component(w->dapm);\n\tunsigned int dmic;\n\tint ret;\n\t \n\tchar *dmic_num = strpbrk(w->name, \"12\");\n\n\tif (dmic_num == NULL) {\n\t\tdev_err(component->dev, \"Invalid DMIC\\n\");\n\t\treturn -EINVAL;\n\t}\n\tret = kstrtouint(dmic_num, 10, &dmic);\n\tif (ret < 0 || dmic > 2) {\n\t\tdev_err(component->dev, \"Invalid DMIC line on the component\\n\");\n\t\treturn -EINVAL;\n\t}\n\n\tswitch (event) {\n\tcase SND_SOC_DAPM_PRE_PMU:\n\t\tsnd_soc_component_update_bits(component, LPASS_CDC_CLK_DMIC_B1_CTL,\n\t\t\t\t    DMIC_B1_CTL_DMIC0_CLK_SEL_MASK,\n\t\t\t\t    DMIC_B1_CTL_DMIC0_CLK_SEL_DIV3);\n\t\tswitch (dmic) {\n\t\tcase 1:\n\t\t\tsnd_soc_component_update_bits(component, LPASS_CDC_TX1_DMIC_CTL,\n\t\t\t\t\t    TXN_DMIC_CTL_CLK_SEL_MASK,\n\t\t\t\t\t    TXN_DMIC_CTL_CLK_SEL_DIV3);\n\t\t\tbreak;\n\t\tcase 2:\n\t\t\tsnd_soc_component_update_bits(component, LPASS_CDC_TX2_DMIC_CTL,\n\t\t\t\t\t    TXN_DMIC_CTL_CLK_SEL_MASK,\n\t\t\t\t\t    TXN_DMIC_CTL_CLK_SEL_DIV3);\n\t\t\tbreak;\n\t\t}\n\t\tbreak;\n\t}\n\n\treturn 0;\n}\n\nstatic const char * const iir_inp1_text[] = {\n\t\"ZERO\", \"DEC1\", \"DEC2\", \"RX1\", \"RX2\", \"RX3\"\n};\n\nstatic const struct soc_enum iir1_inp1_mux_enum =\n\tSOC_ENUM_SINGLE(LPASS_CDC_CONN_EQ1_B1_CTL,\n\t\t0, 6, iir_inp1_text);\n\nstatic const struct soc_enum iir2_inp1_mux_enum =\n\tSOC_ENUM_SINGLE(LPASS_CDC_CONN_EQ2_B1_CTL,\n\t\t0, 6, iir_inp1_text);\n\nstatic const struct snd_kcontrol_new iir1_inp1_mux =\n\tSOC_DAPM_ENUM(\"IIR1 INP1 Mux\", iir1_inp1_mux_enum);\n\nstatic const struct snd_kcontrol_new iir2_inp1_mux =\n\tSOC_DAPM_ENUM(\"IIR2 INP1 Mux\", iir2_inp1_mux_enum);\n\nstatic const struct snd_soc_dapm_widget msm8916_wcd_digital_dapm_widgets[] = {\n\t \n\tSND_SOC_DAPM_AIF_IN(\"I2S RX1\", NULL, 0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"I2S RX2\", NULL, 0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"I2S RX3\", NULL, 0, SND_SOC_NOPM, 0, 0),\n\n\tSND_SOC_DAPM_OUTPUT(\"PDM_RX1\"),\n\tSND_SOC_DAPM_OUTPUT(\"PDM_RX2\"),\n\tSND_SOC_DAPM_OUTPUT(\"PDM_RX3\"),\n\n\tSND_SOC_DAPM_INPUT(\"LPASS_PDM_TX\"),\n\n\tSND_SOC_DAPM_MIXER(\"RX1 MIX1\", SND_SOC_NOPM, 0, 0, NULL, 0),\n\tSND_SOC_DAPM_MIXER(\"RX2 MIX1\", SND_SOC_NOPM, 0, 0, NULL, 0),\n\tSND_SOC_DAPM_MIXER(\"RX3 MIX1\", SND_SOC_NOPM, 0, 0, NULL, 0),\n\n\t \n\tSND_SOC_DAPM_MIXER_E(\"RX1 INT\", LPASS_CDC_CLK_RX_B1_CTL, 0, 0, NULL,\n\t\t\t     0, msm8916_wcd_digital_enable_interpolator,\n\t\t\t     SND_SOC_DAPM_POST_PMU | SND_SOC_DAPM_POST_PMD),\n\tSND_SOC_DAPM_MIXER_E(\"RX2 INT\", LPASS_CDC_CLK_RX_B1_CTL, 1, 0, NULL,\n\t\t\t     0, msm8916_wcd_digital_enable_interpolator,\n\t\t\t     SND_SOC_DAPM_POST_PMU | SND_SOC_DAPM_POST_PMD),\n\tSND_SOC_DAPM_MIXER_E(\"RX3 INT\", LPASS_CDC_CLK_RX_B1_CTL, 2, 0, NULL,\n\t\t\t     0, msm8916_wcd_digital_enable_interpolator,\n\t\t\t     SND_SOC_DAPM_POST_PMU | SND_SOC_DAPM_POST_PMD),\n\tSND_SOC_DAPM_MUX(\"RX1 MIX1 INP1\", SND_SOC_NOPM, 0, 0,\n\t\t\t &rx_mix1_inp1_mux),\n\tSND_SOC_DAPM_MUX(\"RX1 MIX1 INP2\", SND_SOC_NOPM, 0, 0,\n\t\t\t &rx_mix1_inp2_mux),\n\tSND_SOC_DAPM_MUX(\"RX1 MIX1 INP3\", SND_SOC_NOPM, 0, 0,\n\t\t\t &rx_mix1_inp3_mux),\n\tSND_SOC_DAPM_MUX(\"RX2 MIX1 INP1\", SND_SOC_NOPM, 0, 0,\n\t\t\t &rx2_mix1_inp1_mux),\n\tSND_SOC_DAPM_MUX(\"RX2 MIX1 INP2\", SND_SOC_NOPM, 0, 0,\n\t\t\t &rx2_mix1_inp2_mux),\n\tSND_SOC_DAPM_MUX(\"RX2 MIX1 INP3\", SND_SOC_NOPM, 0, 0,\n\t\t\t &rx2_mix1_inp3_mux),\n\tSND_SOC_DAPM_MUX(\"RX3 MIX1 INP1\", SND_SOC_NOPM, 0, 0,\n\t\t\t &rx3_mix1_inp1_mux),\n\tSND_SOC_DAPM_MUX(\"RX3 MIX1 INP2\", SND_SOC_NOPM, 0, 0,\n\t\t\t &rx3_mix1_inp2_mux),\n\tSND_SOC_DAPM_MUX(\"RX3 MIX1 INP3\", SND_SOC_NOPM, 0, 0,\n\t\t\t &rx3_mix1_inp3_mux),\n\tSND_SOC_DAPM_MUX(\"RX1 MIX2 INP1\", SND_SOC_NOPM, 0, 0,\n\t\t\t &rx1_mix2_inp1_mux),\n\tSND_SOC_DAPM_MUX(\"RX2 MIX2 INP1\", SND_SOC_NOPM, 0, 0,\n\t\t\t &rx2_mix2_inp1_mux),\n\n\tSND_SOC_DAPM_MUX(\"CIC1 MUX\", SND_SOC_NOPM, 0, 0, &cic1_mux),\n\tSND_SOC_DAPM_MUX(\"CIC2 MUX\", SND_SOC_NOPM, 0, 0, &cic2_mux),\n\t \n\tSND_SOC_DAPM_MIXER(\"ADC1\", SND_SOC_NOPM, 0, 0, NULL, 0),\n\tSND_SOC_DAPM_MIXER(\"ADC2\", SND_SOC_NOPM, 0, 0, NULL, 0),\n\tSND_SOC_DAPM_MIXER(\"ADC3\", SND_SOC_NOPM, 0, 0, NULL, 0),\n\n\tSND_SOC_DAPM_MUX_E(\"DEC1 MUX\", LPASS_CDC_CLK_TX_CLK_EN_B1_CTL, 0, 0,\n\t\t\t   &dec1_mux, msm8916_wcd_digital_enable_dec,\n\t\t\t   SND_SOC_DAPM_PRE_PMU | SND_SOC_DAPM_POST_PMU |\n\t\t\t   SND_SOC_DAPM_PRE_PMD | SND_SOC_DAPM_POST_PMD),\n\tSND_SOC_DAPM_MUX_E(\"DEC2 MUX\", LPASS_CDC_CLK_TX_CLK_EN_B1_CTL, 1, 0,\n\t\t\t   &dec2_mux, msm8916_wcd_digital_enable_dec,\n\t\t\t   SND_SOC_DAPM_PRE_PMU | SND_SOC_DAPM_POST_PMU |\n\t\t\t   SND_SOC_DAPM_PRE_PMD | SND_SOC_DAPM_POST_PMD),\n\tSND_SOC_DAPM_AIF_OUT(\"I2S TX1\", NULL, 0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"I2S TX2\", NULL, 0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"I2S TX3\", NULL, 0, SND_SOC_NOPM, 0, 0),\n\n\t \n\tSND_SOC_DAPM_ADC_E(\"DMIC1\", NULL, SND_SOC_NOPM, 0, 0,\n\t\t\t   msm8916_wcd_digital_enable_dmic,\n\t\t\t   SND_SOC_DAPM_PRE_PMU | SND_SOC_DAPM_POST_PMD),\n\tSND_SOC_DAPM_ADC_E(\"DMIC2\", NULL, SND_SOC_NOPM, 0, 0,\n\t\t\t   msm8916_wcd_digital_enable_dmic,\n\t\t\t   SND_SOC_DAPM_PRE_PMU | SND_SOC_DAPM_POST_PMD),\n\tSND_SOC_DAPM_SUPPLY(\"DMIC_CLK\", LPASS_CDC_CLK_DMIC_B1_CTL, 0, 0,\n\t\t\t    NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"RX_I2S_CLK\", LPASS_CDC_CLK_RX_I2S_CTL,\n\t\t\t    4, 0, NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"TX_I2S_CLK\", LPASS_CDC_CLK_TX_I2S_CTL, 4, 0,\n\t\t\t    NULL, 0),\n\n\tSND_SOC_DAPM_SUPPLY(\"MCLK\", SND_SOC_NOPM, 0, 0, NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"PDM_CLK\", LPASS_CDC_CLK_PDM_CTL, 0, 0, NULL, 0),\n\t \n\tSND_SOC_DAPM_SUPPLY_S(\"CDC_CONN\", -2, LPASS_CDC_CLK_OTHR_CTL, 2, 0,\n\t\t\t      NULL, 0),\n\tSND_SOC_DAPM_MIC(\"Digital Mic1\", NULL),\n\tSND_SOC_DAPM_MIC(\"Digital Mic2\", NULL),\n\n\t \n\tSND_SOC_DAPM_MUX(\"IIR1 INP1 MUX\", SND_SOC_NOPM, 0, 0, &iir1_inp1_mux),\n\tSND_SOC_DAPM_PGA_E(\"IIR1\", LPASS_CDC_CLK_SD_CTL, 0, 0, NULL, 0,\n\t\tmsm8x16_wcd_codec_set_iir_gain, SND_SOC_DAPM_POST_PMU),\n\n\tSND_SOC_DAPM_MUX(\"IIR2 INP1 MUX\", SND_SOC_NOPM, 0, 0, &iir2_inp1_mux),\n\tSND_SOC_DAPM_PGA_E(\"IIR2\", LPASS_CDC_CLK_SD_CTL, 1, 0, NULL, 0,\n\t\tmsm8x16_wcd_codec_set_iir_gain, SND_SOC_DAPM_POST_PMU),\n\n};\n\nstatic int msm8916_wcd_digital_get_clks(struct platform_device *pdev,\n\t\t\t\t\tstruct msm8916_wcd_digital_priv\t*priv)\n{\n\tstruct device *dev = &pdev->dev;\n\n\tpriv->ahbclk = devm_clk_get(dev, \"ahbix-clk\");\n\tif (IS_ERR(priv->ahbclk)) {\n\t\tdev_err(dev, \"failed to get ahbix clk\\n\");\n\t\treturn PTR_ERR(priv->ahbclk);\n\t}\n\n\tpriv->mclk = devm_clk_get(dev, \"mclk\");\n\tif (IS_ERR(priv->mclk)) {\n\t\tdev_err(dev, \"failed to get mclk\\n\");\n\t\treturn PTR_ERR(priv->mclk);\n\t}\n\n\treturn 0;\n}\n\nstatic int msm8916_wcd_digital_component_probe(struct snd_soc_component *component)\n{\n\tstruct msm8916_wcd_digital_priv *priv = dev_get_drvdata(component->dev);\n\n\tsnd_soc_component_set_drvdata(component, priv);\n\n\treturn 0;\n}\n\nstatic int msm8916_wcd_digital_component_set_sysclk(struct snd_soc_component *component,\n\t\t\t\t\t\tint clk_id, int source,\n\t\t\t\t\t\tunsigned int freq, int dir)\n{\n\tstruct msm8916_wcd_digital_priv *p = dev_get_drvdata(component->dev);\n\n\treturn clk_set_rate(p->mclk, freq);\n}\n\nstatic int msm8916_wcd_digital_hw_params(struct snd_pcm_substream *substream,\n\t\t\t\t\t struct snd_pcm_hw_params *params,\n\t\t\t\t\t struct snd_soc_dai *dai)\n{\n\tu8 tx_fs_rate;\n\tu8 rx_fs_rate;\n\n\tswitch (params_rate(params)) {\n\tcase 8000:\n\t\ttx_fs_rate = TX_I2S_CTL_TX_I2S_FS_RATE_F_8_KHZ;\n\t\trx_fs_rate = RX_I2S_CTL_RX_I2S_FS_RATE_F_8_KHZ;\n\t\tbreak;\n\tcase 16000:\n\t\ttx_fs_rate = TX_I2S_CTL_TX_I2S_FS_RATE_F_16_KHZ;\n\t\trx_fs_rate = RX_I2S_CTL_RX_I2S_FS_RATE_F_16_KHZ;\n\t\tbreak;\n\tcase 32000:\n\t\ttx_fs_rate = TX_I2S_CTL_TX_I2S_FS_RATE_F_32_KHZ;\n\t\trx_fs_rate = RX_I2S_CTL_RX_I2S_FS_RATE_F_32_KHZ;\n\t\tbreak;\n\tcase 48000:\n\t\ttx_fs_rate = TX_I2S_CTL_TX_I2S_FS_RATE_F_48_KHZ;\n\t\trx_fs_rate = RX_I2S_CTL_RX_I2S_FS_RATE_F_48_KHZ;\n\t\tbreak;\n\tdefault:\n\t\tdev_err(dai->component->dev, \"Invalid sampling rate %d\\n\",\n\t\t\tparams_rate(params));\n\t\treturn -EINVAL;\n\t}\n\n\tswitch (substream->stream) {\n\tcase SNDRV_PCM_STREAM_CAPTURE:\n\t\tsnd_soc_component_update_bits(dai->component, LPASS_CDC_CLK_TX_I2S_CTL,\n\t\t\t\t    TX_I2S_CTL_TX_I2S_FS_RATE_MASK, tx_fs_rate);\n\t\tbreak;\n\tcase SNDRV_PCM_STREAM_PLAYBACK:\n\t\tsnd_soc_component_update_bits(dai->component, LPASS_CDC_CLK_RX_I2S_CTL,\n\t\t\t\t    RX_I2S_CTL_RX_I2S_FS_RATE_MASK, rx_fs_rate);\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tswitch (params_format(params)) {\n\tcase SNDRV_PCM_FORMAT_S16_LE:\n\t\tsnd_soc_component_update_bits(dai->component, LPASS_CDC_CLK_TX_I2S_CTL,\n\t\t\t\t    TX_I2S_CTL_TX_I2S_MODE_MASK,\n\t\t\t\t    TX_I2S_CTL_TX_I2S_MODE_16);\n\t\tsnd_soc_component_update_bits(dai->component, LPASS_CDC_CLK_RX_I2S_CTL,\n\t\t\t\t    RX_I2S_CTL_RX_I2S_MODE_MASK,\n\t\t\t\t    RX_I2S_CTL_RX_I2S_MODE_16);\n\t\tbreak;\n\n\tcase SNDRV_PCM_FORMAT_S32_LE:\n\t\tsnd_soc_component_update_bits(dai->component, LPASS_CDC_CLK_TX_I2S_CTL,\n\t\t\t\t    TX_I2S_CTL_TX_I2S_MODE_MASK,\n\t\t\t\t    TX_I2S_CTL_TX_I2S_MODE_32);\n\t\tsnd_soc_component_update_bits(dai->component, LPASS_CDC_CLK_RX_I2S_CTL,\n\t\t\t\t    RX_I2S_CTL_RX_I2S_MODE_MASK,\n\t\t\t\t    RX_I2S_CTL_RX_I2S_MODE_32);\n\t\tbreak;\n\tdefault:\n\t\tdev_err(dai->dev, \"%s: wrong format selected\\n\", __func__);\n\t\treturn -EINVAL;\n\t}\n\n\treturn 0;\n}\n\nstatic const struct snd_soc_dapm_route msm8916_wcd_digital_audio_map[] = {\n\n\t{\"I2S RX1\",  NULL, \"AIF1 Playback\"},\n\t{\"I2S RX2\",  NULL, \"AIF1 Playback\"},\n\t{\"I2S RX3\",  NULL, \"AIF1 Playback\"},\n\n\t{\"AIF1 Capture\", NULL, \"I2S TX1\"},\n\t{\"AIF1 Capture\", NULL, \"I2S TX2\"},\n\t{\"AIF1 Capture\", NULL, \"I2S TX3\"},\n\n\t{\"CIC1 MUX\", \"DMIC\", \"DEC1 MUX\"},\n\t{\"CIC1 MUX\", \"AMIC\", \"DEC1 MUX\"},\n\t{\"CIC2 MUX\", \"DMIC\", \"DEC2 MUX\"},\n\t{\"CIC2 MUX\", \"AMIC\", \"DEC2 MUX\"},\n\n\t \n\t{\"DEC1 MUX\", \"DMIC1\", \"DMIC1\"},\n\t{\"DEC1 MUX\", \"DMIC2\", \"DMIC2\"},\n\t{\"DEC1 MUX\", \"ADC1\", \"ADC1\"},\n\t{\"DEC1 MUX\", \"ADC2\", \"ADC2\"},\n\t{\"DEC1 MUX\", \"ADC3\", \"ADC3\"},\n\t{\"DEC1 MUX\", NULL, \"CDC_CONN\"},\n\n\t{\"DEC2 MUX\", \"DMIC1\", \"DMIC1\"},\n\t{\"DEC2 MUX\", \"DMIC2\", \"DMIC2\"},\n\t{\"DEC2 MUX\", \"ADC1\", \"ADC1\"},\n\t{\"DEC2 MUX\", \"ADC2\", \"ADC2\"},\n\t{\"DEC2 MUX\", \"ADC3\", \"ADC3\"},\n\t{\"DEC2 MUX\", NULL, \"CDC_CONN\"},\n\n\t{\"DMIC1\", NULL, \"DMIC_CLK\"},\n\t{\"DMIC2\", NULL, \"DMIC_CLK\"},\n\n\t{\"I2S TX1\", NULL, \"CIC1 MUX\"},\n\t{\"I2S TX2\", NULL, \"CIC2 MUX\"},\n\n\t{\"I2S TX1\", NULL, \"TX_I2S_CLK\"},\n\t{\"I2S TX2\", NULL, \"TX_I2S_CLK\"},\n\n\t{\"TX_I2S_CLK\", NULL, \"MCLK\"},\n\t{\"TX_I2S_CLK\", NULL, \"PDM_CLK\"},\n\n\t{\"ADC1\", NULL, \"LPASS_PDM_TX\"},\n\t{\"ADC2\", NULL, \"LPASS_PDM_TX\"},\n\t{\"ADC3\", NULL, \"LPASS_PDM_TX\"},\n\n\t{\"I2S RX1\", NULL, \"RX_I2S_CLK\"},\n\t{\"I2S RX2\", NULL, \"RX_I2S_CLK\"},\n\t{\"I2S RX3\", NULL, \"RX_I2S_CLK\"},\n\n\t{\"RX_I2S_CLK\", NULL, \"PDM_CLK\"},\n\t{\"RX_I2S_CLK\", NULL, \"MCLK\"},\n\t{\"RX_I2S_CLK\", NULL, \"CDC_CONN\"},\n\n\t \n\t{\"PDM_RX1\", NULL, \"RX1 INT\"},\n\t{\"RX1 INT\", NULL, \"RX1 MIX1\"},\n\n\t{\"RX1 MIX1\", NULL, \"RX1 MIX1 INP1\"},\n\t{\"RX1 MIX1\", NULL, \"RX1 MIX1 INP2\"},\n\t{\"RX1 MIX1\", NULL, \"RX1 MIX1 INP3\"},\n\n\t{\"RX1 MIX1 INP1\", \"RX1\", \"I2S RX1\"},\n\t{\"RX1 MIX1 INP1\", \"RX2\", \"I2S RX2\"},\n\t{\"RX1 MIX1 INP1\", \"RX3\", \"I2S RX3\"},\n\t{\"RX1 MIX1 INP1\", \"IIR1\", \"IIR1\"},\n\t{\"RX1 MIX1 INP1\", \"IIR2\", \"IIR2\"},\n\n\t{\"RX1 MIX1 INP2\", \"RX1\", \"I2S RX1\"},\n\t{\"RX1 MIX1 INP2\", \"RX2\", \"I2S RX2\"},\n\t{\"RX1 MIX1 INP2\", \"RX3\", \"I2S RX3\"},\n\t{\"RX1 MIX1 INP2\", \"IIR1\", \"IIR1\"},\n\t{\"RX1 MIX1 INP2\", \"IIR2\", \"IIR2\"},\n\n\t{\"RX1 MIX1 INP3\", \"RX1\", \"I2S RX1\"},\n\t{\"RX1 MIX1 INP3\", \"RX2\", \"I2S RX2\"},\n\t{\"RX1 MIX1 INP3\", \"RX3\", \"I2S RX3\"},\n\n\t \n\t{\"PDM_RX2\", NULL, \"RX2 INT\"},\n\t{\"RX2 INT\", NULL, \"RX2 MIX1\"},\n\n\t{\"RX2 MIX1\", NULL, \"RX2 MIX1 INP1\"},\n\t{\"RX2 MIX1\", NULL, \"RX2 MIX1 INP2\"},\n\t{\"RX2 MIX1\", NULL, \"RX2 MIX1 INP3\"},\n\n\t{\"RX2 MIX1 INP1\", \"RX1\", \"I2S RX1\"},\n\t{\"RX2 MIX1 INP1\", \"RX2\", \"I2S RX2\"},\n\t{\"RX2 MIX1 INP1\", \"RX3\", \"I2S RX3\"},\n\t{\"RX2 MIX1 INP1\", \"IIR1\", \"IIR1\"},\n\t{\"RX2 MIX1 INP1\", \"IIR2\", \"IIR2\"},\n\n\t{\"RX2 MIX1 INP2\", \"RX1\", \"I2S RX1\"},\n\t{\"RX2 MIX1 INP2\", \"RX2\", \"I2S RX2\"},\n\t{\"RX2 MIX1 INP2\", \"RX3\", \"I2S RX3\"},\n\t{\"RX2 MIX1 INP1\", \"IIR1\", \"IIR1\"},\n\t{\"RX2 MIX1 INP1\", \"IIR2\", \"IIR2\"},\n\n\t{\"RX2 MIX1 INP3\", \"RX1\", \"I2S RX1\"},\n\t{\"RX2 MIX1 INP3\", \"RX2\", \"I2S RX2\"},\n\t{\"RX2 MIX1 INP3\", \"RX3\", \"I2S RX3\"},\n\n\t \n\t{\"PDM_RX3\", NULL, \"RX3 INT\"},\n\t{\"RX3 INT\", NULL, \"RX3 MIX1\"},\n\n\t{\"RX3 MIX1\", NULL, \"RX3 MIX1 INP1\"},\n\t{\"RX3 MIX1\", NULL, \"RX3 MIX1 INP2\"},\n\t{\"RX3 MIX1\", NULL, \"RX3 MIX1 INP3\"},\n\n\t{\"RX3 MIX1 INP1\", \"RX1\", \"I2S RX1\"},\n\t{\"RX3 MIX1 INP1\", \"RX2\", \"I2S RX2\"},\n\t{\"RX3 MIX1 INP1\", \"RX3\", \"I2S RX3\"},\n\t{\"RX3 MIX1 INP1\", \"IIR1\", \"IIR1\"},\n\t{\"RX3 MIX1 INP1\", \"IIR2\", \"IIR2\"},\n\n\t{\"RX3 MIX1 INP2\", \"RX1\", \"I2S RX1\"},\n\t{\"RX3 MIX1 INP2\", \"RX2\", \"I2S RX2\"},\n\t{\"RX3 MIX1 INP2\", \"RX3\", \"I2S RX3\"},\n\t{\"RX3 MIX1 INP2\", \"IIR1\", \"IIR1\"},\n\t{\"RX3 MIX1 INP2\", \"IIR2\", \"IIR2\"},\n\n\t{\"RX1 MIX2 INP1\", \"IIR1\", \"IIR1\"},\n\t{\"RX2 MIX2 INP1\", \"IIR1\", \"IIR1\"},\n\t{\"RX1 MIX2 INP1\", \"IIR2\", \"IIR2\"},\n\t{\"RX2 MIX2 INP1\", \"IIR2\", \"IIR2\"},\n\n\t{\"IIR1\", NULL, \"IIR1 INP1 MUX\"},\n\t{\"IIR1 INP1 MUX\", \"DEC1\", \"DEC1 MUX\"},\n\t{\"IIR1 INP1 MUX\", \"DEC2\", \"DEC2 MUX\"},\n\n\t{\"IIR2\", NULL, \"IIR2 INP1 MUX\"},\n\t{\"IIR2 INP1 MUX\", \"DEC1\", \"DEC1 MUX\"},\n\t{\"IIR2 INP1 MUX\", \"DEC2\", \"DEC2 MUX\"},\n\n\t{\"RX3 MIX1 INP3\", \"RX1\", \"I2S RX1\"},\n\t{\"RX3 MIX1 INP3\", \"RX2\", \"I2S RX2\"},\n\t{\"RX3 MIX1 INP3\", \"RX3\", \"I2S RX3\"},\n\n};\n\nstatic int msm8916_wcd_digital_startup(struct snd_pcm_substream *substream,\n\t\t\t\t       struct snd_soc_dai *dai)\n{\n\tstruct snd_soc_component *component = dai->component;\n\tstruct msm8916_wcd_digital_priv *msm8916_wcd;\n\tunsigned long mclk_rate;\n\n\tmsm8916_wcd = snd_soc_component_get_drvdata(component);\n\tsnd_soc_component_update_bits(component, LPASS_CDC_CLK_MCLK_CTL,\n\t\t\t    MCLK_CTL_MCLK_EN_MASK,\n\t\t\t    MCLK_CTL_MCLK_EN_ENABLE);\n\tsnd_soc_component_update_bits(component, LPASS_CDC_CLK_PDM_CTL,\n\t\t\t    LPASS_CDC_CLK_PDM_CTL_PDM_CLK_SEL_MASK,\n\t\t\t    LPASS_CDC_CLK_PDM_CTL_PDM_CLK_SEL_FB);\n\n\tmclk_rate = clk_get_rate(msm8916_wcd->mclk);\n\tswitch (mclk_rate) {\n\tcase 12288000:\n\t\tsnd_soc_component_update_bits(component, LPASS_CDC_TOP_CTL,\n\t\t\t\t    TOP_CTL_DIG_MCLK_FREQ_MASK,\n\t\t\t\t    TOP_CTL_DIG_MCLK_FREQ_F_12_288MHZ);\n\t\tbreak;\n\tcase 9600000:\n\t\tsnd_soc_component_update_bits(component, LPASS_CDC_TOP_CTL,\n\t\t\t\t    TOP_CTL_DIG_MCLK_FREQ_MASK,\n\t\t\t\t    TOP_CTL_DIG_MCLK_FREQ_F_9_6MHZ);\n\t\tbreak;\n\tdefault:\n\t\tdev_err(component->dev, \"Invalid mclk rate %ld\\n\", mclk_rate);\n\t\tbreak;\n\t}\n\treturn 0;\n}\n\nstatic void msm8916_wcd_digital_shutdown(struct snd_pcm_substream *substream,\n\t\t\t\t\t struct snd_soc_dai *dai)\n{\n\tsnd_soc_component_update_bits(dai->component, LPASS_CDC_CLK_PDM_CTL,\n\t\t\t    LPASS_CDC_CLK_PDM_CTL_PDM_CLK_SEL_MASK, 0);\n}\n\nstatic const struct snd_soc_dai_ops msm8916_wcd_digital_dai_ops = {\n\t.startup = msm8916_wcd_digital_startup,\n\t.shutdown = msm8916_wcd_digital_shutdown,\n\t.hw_params = msm8916_wcd_digital_hw_params,\n};\n\nstatic struct snd_soc_dai_driver msm8916_wcd_digital_dai[] = {\n\t[0] = {\n\t       .name = \"msm8916_wcd_digital_i2s_rx1\",\n\t       .id = 0,\n\t       .playback = {\n\t\t\t    .stream_name = \"AIF1 Playback\",\n\t\t\t    .rates = MSM8916_WCD_DIGITAL_RATES,\n\t\t\t    .formats = MSM8916_WCD_DIGITAL_FORMATS,\n\t\t\t    .channels_min = 1,\n\t\t\t    .channels_max = 3,\n\t\t\t    },\n\t       .ops = &msm8916_wcd_digital_dai_ops,\n\t       },\n\t[1] = {\n\t       .name = \"msm8916_wcd_digital_i2s_tx1\",\n\t       .id = 1,\n\t       .capture = {\n\t\t\t   .stream_name = \"AIF1 Capture\",\n\t\t\t   .rates = MSM8916_WCD_DIGITAL_RATES,\n\t\t\t   .formats = MSM8916_WCD_DIGITAL_FORMATS,\n\t\t\t   .channels_min = 1,\n\t\t\t   .channels_max = 4,\n\t\t\t   },\n\t       .ops = &msm8916_wcd_digital_dai_ops,\n\t       },\n};\n\nstatic const struct snd_soc_component_driver msm8916_wcd_digital = {\n\t.probe\t\t\t= msm8916_wcd_digital_component_probe,\n\t.set_sysclk\t\t= msm8916_wcd_digital_component_set_sysclk,\n\t.controls\t\t= msm8916_wcd_digital_snd_controls,\n\t.num_controls\t\t= ARRAY_SIZE(msm8916_wcd_digital_snd_controls),\n\t.dapm_widgets\t\t= msm8916_wcd_digital_dapm_widgets,\n\t.num_dapm_widgets\t= ARRAY_SIZE(msm8916_wcd_digital_dapm_widgets),\n\t.dapm_routes\t\t= msm8916_wcd_digital_audio_map,\n\t.num_dapm_routes\t= ARRAY_SIZE(msm8916_wcd_digital_audio_map),\n\t.idle_bias_on\t\t= 1,\n\t.use_pmdown_time\t= 1,\n\t.endianness\t\t= 1,\n};\n\nstatic const struct regmap_config msm8916_codec_regmap_config = {\n\t.reg_bits = 32,\n\t.reg_stride = 4,\n\t.val_bits = 32,\n\t.max_register = LPASS_CDC_TX2_DMIC_CTL,\n\t.cache_type = REGCACHE_FLAT,\n};\n\nstatic int msm8916_wcd_digital_probe(struct platform_device *pdev)\n{\n\tstruct msm8916_wcd_digital_priv *priv;\n\tstruct device *dev = &pdev->dev;\n\tvoid __iomem *base;\n\tstruct regmap *digital_map;\n\tint ret;\n\n\tpriv = devm_kzalloc(dev, sizeof(*priv), GFP_KERNEL);\n\tif (!priv)\n\t\treturn -ENOMEM;\n\n\tbase = devm_platform_ioremap_resource(pdev, 0);\n\tif (IS_ERR(base))\n\t\treturn PTR_ERR(base);\n\n\tdigital_map =\n\t    devm_regmap_init_mmio(&pdev->dev, base,\n\t\t\t\t  &msm8916_codec_regmap_config);\n\tif (IS_ERR(digital_map))\n\t\treturn PTR_ERR(digital_map);\n\n\tret = msm8916_wcd_digital_get_clks(pdev, priv);\n\tif (ret < 0)\n\t\treturn ret;\n\n\tret = clk_prepare_enable(priv->ahbclk);\n\tif (ret < 0) {\n\t\tdev_err(dev, \"failed to enable ahbclk %d\\n\", ret);\n\t\treturn ret;\n\t}\n\n\tret = clk_prepare_enable(priv->mclk);\n\tif (ret < 0) {\n\t\tdev_err(dev, \"failed to enable mclk %d\\n\", ret);\n\t\tgoto err_clk;\n\t}\n\n\tdev_set_drvdata(dev, priv);\n\n\tret = devm_snd_soc_register_component(dev, &msm8916_wcd_digital,\n\t\t\t\t      msm8916_wcd_digital_dai,\n\t\t\t\t      ARRAY_SIZE(msm8916_wcd_digital_dai));\n\tif (ret)\n\t\tgoto err_mclk;\n\n\treturn 0;\n\nerr_mclk:\n\tclk_disable_unprepare(priv->mclk);\nerr_clk:\n\tclk_disable_unprepare(priv->ahbclk);\n\treturn ret;\n}\n\nstatic void msm8916_wcd_digital_remove(struct platform_device *pdev)\n{\n\tstruct msm8916_wcd_digital_priv *priv = dev_get_drvdata(&pdev->dev);\n\n\tclk_disable_unprepare(priv->mclk);\n\tclk_disable_unprepare(priv->ahbclk);\n}\n\nstatic const struct of_device_id msm8916_wcd_digital_match_table[] = {\n\t{ .compatible = \"qcom,msm8916-wcd-digital-codec\" },\n\t{ }\n};\n\nMODULE_DEVICE_TABLE(of, msm8916_wcd_digital_match_table);\n\nstatic struct platform_driver msm8916_wcd_digital_driver = {\n\t.driver = {\n\t\t   .name = \"msm8916-wcd-digital-codec\",\n\t\t   .of_match_table = msm8916_wcd_digital_match_table,\n\t},\n\t.probe = msm8916_wcd_digital_probe,\n\t.remove_new = msm8916_wcd_digital_remove,\n};\n\nmodule_platform_driver(msm8916_wcd_digital_driver);\n\nMODULE_AUTHOR(\"Srinivas Kandagatla <srinivas.kandagatla@linaro.org>\");\nMODULE_DESCRIPTION(\"MSM8916 WCD Digital Codec driver\");\nMODULE_LICENSE(\"GPL v2\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}