{
  "module_name": "rt5631.c",
  "hash_id": "53ad4f3561df12364f07d461afc15c4513a3b7edc609d7ed637c970ed79ef04c",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/codecs/rt5631.c",
  "human_readable_source": "\n \n#include <linux/module.h>\n#include <linux/moduleparam.h>\n#include <linux/init.h>\n#include <linux/delay.h>\n#include <linux/pm.h>\n#include <linux/i2c.h>\n#include <linux/regmap.h>\n#include <sound/core.h>\n#include <sound/pcm.h>\n#include <sound/pcm_params.h>\n#include <sound/soc.h>\n#include <sound/soc-dapm.h>\n#include <sound/initval.h>\n#include <sound/tlv.h>\n\n#include \"rt5631.h\"\n\nstruct rt5631_priv {\n\tstruct regmap *regmap;\n\tint codec_version;\n\tint master;\n\tint sysclk;\n\tint rx_rate;\n\tint bclk_rate;\n\tint dmic_used_flag;\n};\n\nstatic const struct reg_default rt5631_reg[] = {\n\t{ RT5631_SPK_OUT_VOL, 0x8888 },\n\t{ RT5631_HP_OUT_VOL, 0x8080 },\n\t{ RT5631_MONO_AXO_1_2_VOL, 0xa080 },\n\t{ RT5631_AUX_IN_VOL, 0x0808 },\n\t{ RT5631_ADC_REC_MIXER, 0xf0f0 },\n\t{ RT5631_VDAC_DIG_VOL, 0x0010 },\n\t{ RT5631_OUTMIXER_L_CTRL, 0xffc0 },\n\t{ RT5631_OUTMIXER_R_CTRL, 0xffc0 },\n\t{ RT5631_AXO1MIXER_CTRL, 0x88c0 },\n\t{ RT5631_AXO2MIXER_CTRL, 0x88c0 },\n\t{ RT5631_DIG_MIC_CTRL, 0x3000 },\n\t{ RT5631_MONO_INPUT_VOL, 0x8808 },\n\t{ RT5631_SPK_MIXER_CTRL, 0xf8f8 },\n\t{ RT5631_SPK_MONO_OUT_CTRL, 0xfc00 },\n\t{ RT5631_SPK_MONO_HP_OUT_CTRL, 0x4440 },\n\t{ RT5631_SDP_CTRL, 0x8000 },\n\t{ RT5631_MONO_SDP_CTRL, 0x8000 },\n\t{ RT5631_STEREO_AD_DA_CLK_CTRL, 0x2010 },\n\t{ RT5631_GEN_PUR_CTRL_REG, 0x0e00 },\n\t{ RT5631_INT_ST_IRQ_CTRL_2, 0x071a },\n\t{ RT5631_MISC_CTRL, 0x2040 },\n\t{ RT5631_DEPOP_FUN_CTRL_2, 0x8000 },\n\t{ RT5631_SOFT_VOL_CTRL, 0x07e0 },\n\t{ RT5631_ALC_CTRL_1, 0x0206 },\n\t{ RT5631_ALC_CTRL_3, 0x2000 },\n\t{ RT5631_PSEUDO_SPATL_CTRL, 0x0553 },\n};\n\n \nstatic void rt5631_write_index(struct snd_soc_component *component,\n\t\tunsigned int reg, unsigned int value)\n{\n\tsnd_soc_component_write(component, RT5631_INDEX_ADD, reg);\n\tsnd_soc_component_write(component, RT5631_INDEX_DATA, value);\n}\n\n \nstatic unsigned int rt5631_read_index(struct snd_soc_component *component,\n\t\t\t\tunsigned int reg)\n{\n\tunsigned int value;\n\n\tsnd_soc_component_write(component, RT5631_INDEX_ADD, reg);\n\tvalue = snd_soc_component_read(component, RT5631_INDEX_DATA);\n\n\treturn value;\n}\n\nstatic int rt5631_reset(struct snd_soc_component *component)\n{\n\treturn snd_soc_component_write(component, RT5631_RESET, 0);\n}\n\nstatic bool rt5631_volatile_register(struct device *dev, unsigned int reg)\n{\n\tswitch (reg) {\n\tcase RT5631_RESET:\n\tcase RT5631_INT_ST_IRQ_CTRL_2:\n\tcase RT5631_INDEX_ADD:\n\tcase RT5631_INDEX_DATA:\n\tcase RT5631_EQ_CTRL:\n\t\treturn true;\n\tdefault:\n\t\treturn false;\n\t}\n}\n\nstatic bool rt5631_readable_register(struct device *dev, unsigned int reg)\n{\n\tswitch (reg) {\n\tcase RT5631_RESET:\n\tcase RT5631_SPK_OUT_VOL:\n\tcase RT5631_HP_OUT_VOL:\n\tcase RT5631_MONO_AXO_1_2_VOL:\n\tcase RT5631_AUX_IN_VOL:\n\tcase RT5631_STEREO_DAC_VOL_1:\n\tcase RT5631_MIC_CTRL_1:\n\tcase RT5631_STEREO_DAC_VOL_2:\n\tcase RT5631_ADC_CTRL_1:\n\tcase RT5631_ADC_REC_MIXER:\n\tcase RT5631_ADC_CTRL_2:\n\tcase RT5631_VDAC_DIG_VOL:\n\tcase RT5631_OUTMIXER_L_CTRL:\n\tcase RT5631_OUTMIXER_R_CTRL:\n\tcase RT5631_AXO1MIXER_CTRL:\n\tcase RT5631_AXO2MIXER_CTRL:\n\tcase RT5631_MIC_CTRL_2:\n\tcase RT5631_DIG_MIC_CTRL:\n\tcase RT5631_MONO_INPUT_VOL:\n\tcase RT5631_SPK_MIXER_CTRL:\n\tcase RT5631_SPK_MONO_OUT_CTRL:\n\tcase RT5631_SPK_MONO_HP_OUT_CTRL:\n\tcase RT5631_SDP_CTRL:\n\tcase RT5631_MONO_SDP_CTRL:\n\tcase RT5631_STEREO_AD_DA_CLK_CTRL:\n\tcase RT5631_PWR_MANAG_ADD1:\n\tcase RT5631_PWR_MANAG_ADD2:\n\tcase RT5631_PWR_MANAG_ADD3:\n\tcase RT5631_PWR_MANAG_ADD4:\n\tcase RT5631_GEN_PUR_CTRL_REG:\n\tcase RT5631_GLOBAL_CLK_CTRL:\n\tcase RT5631_PLL_CTRL:\n\tcase RT5631_INT_ST_IRQ_CTRL_1:\n\tcase RT5631_INT_ST_IRQ_CTRL_2:\n\tcase RT5631_GPIO_CTRL:\n\tcase RT5631_MISC_CTRL:\n\tcase RT5631_DEPOP_FUN_CTRL_1:\n\tcase RT5631_DEPOP_FUN_CTRL_2:\n\tcase RT5631_JACK_DET_CTRL:\n\tcase RT5631_SOFT_VOL_CTRL:\n\tcase RT5631_ALC_CTRL_1:\n\tcase RT5631_ALC_CTRL_2:\n\tcase RT5631_ALC_CTRL_3:\n\tcase RT5631_PSEUDO_SPATL_CTRL:\n\tcase RT5631_INDEX_ADD:\n\tcase RT5631_INDEX_DATA:\n\tcase RT5631_EQ_CTRL:\n\tcase RT5631_VENDOR_ID:\n\tcase RT5631_VENDOR_ID1:\n\tcase RT5631_VENDOR_ID2:\n\t\treturn true;\n\tdefault:\n\t\treturn false;\n\t}\n}\n\nstatic const DECLARE_TLV_DB_SCALE(out_vol_tlv, -4650, 150, 0);\nstatic const DECLARE_TLV_DB_SCALE(dac_vol_tlv, -95625, 375, 0);\nstatic const DECLARE_TLV_DB_SCALE(in_vol_tlv, -3450, 150, 0);\n \nstatic const DECLARE_TLV_DB_RANGE(mic_bst_tlv,\n\t0, 0, TLV_DB_SCALE_ITEM(0, 0, 0),\n\t1, 1, TLV_DB_SCALE_ITEM(2000, 0, 0),\n\t2, 2, TLV_DB_SCALE_ITEM(2400, 0, 0),\n\t3, 5, TLV_DB_SCALE_ITEM(3000, 500, 0),\n\t6, 6, TLV_DB_SCALE_ITEM(4400, 0, 0),\n\t7, 7, TLV_DB_SCALE_ITEM(5000, 0, 0),\n\t8, 8, TLV_DB_SCALE_ITEM(5200, 0, 0)\n);\n\nstatic int rt5631_dmic_get(struct snd_kcontrol *kcontrol,\n\t\tstruct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_soc_component *component = snd_soc_kcontrol_component(kcontrol);\n\tstruct rt5631_priv *rt5631 = snd_soc_component_get_drvdata(component);\n\n\tucontrol->value.integer.value[0] = rt5631->dmic_used_flag;\n\n\treturn 0;\n}\n\nstatic int rt5631_dmic_put(struct snd_kcontrol *kcontrol,\n\t\tstruct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_soc_component *component = snd_soc_kcontrol_component(kcontrol);\n\tstruct rt5631_priv *rt5631 = snd_soc_component_get_drvdata(component);\n\n\trt5631->dmic_used_flag = ucontrol->value.integer.value[0];\n\treturn 0;\n}\n\n \nstatic const char *rt5631_input_mode[] = {\n\t\"Single ended\", \"Differential\"};\n\nstatic SOC_ENUM_SINGLE_DECL(rt5631_mic1_mode_enum, RT5631_MIC_CTRL_1,\n\t\t\t    RT5631_MIC1_DIFF_INPUT_SHIFT, rt5631_input_mode);\n\nstatic SOC_ENUM_SINGLE_DECL(rt5631_mic2_mode_enum, RT5631_MIC_CTRL_1,\n\t\t\t    RT5631_MIC2_DIFF_INPUT_SHIFT, rt5631_input_mode);\n\n \nstatic SOC_ENUM_SINGLE_DECL(rt5631_monoin_mode_enum, RT5631_MONO_INPUT_VOL,\n\t\t\t    RT5631_MONO_DIFF_INPUT_SHIFT, rt5631_input_mode);\n\n \nstatic const char *rt5631_spk_ratio[] = {\"1.00x\", \"1.09x\", \"1.27x\", \"1.44x\",\n\t\t\t\"1.56x\", \"1.68x\", \"1.99x\", \"2.34x\"};\n\nstatic SOC_ENUM_SINGLE_DECL(rt5631_spk_ratio_enum, RT5631_GEN_PUR_CTRL_REG,\n\t\t\t    RT5631_SPK_AMP_RATIO_CTRL_SHIFT, rt5631_spk_ratio);\n\nstatic const struct snd_kcontrol_new rt5631_snd_controls[] = {\n\t \n\tSOC_ENUM(\"MIC1 Mode Control\",  rt5631_mic1_mode_enum),\n\tSOC_SINGLE_TLV(\"MIC1 Boost Volume\", RT5631_MIC_CTRL_2,\n\t\tRT5631_MIC1_BOOST_SHIFT, 8, 0, mic_bst_tlv),\n\tSOC_ENUM(\"MIC2 Mode Control\", rt5631_mic2_mode_enum),\n\tSOC_SINGLE_TLV(\"MIC2 Boost Volume\", RT5631_MIC_CTRL_2,\n\t\tRT5631_MIC2_BOOST_SHIFT, 8, 0, mic_bst_tlv),\n\t \n\tSOC_ENUM(\"MONOIN Mode Control\", rt5631_monoin_mode_enum),\n\tSOC_DOUBLE_TLV(\"MONOIN_RX Capture Volume\", RT5631_MONO_INPUT_VOL,\n\t\t\tRT5631_L_VOL_SHIFT, RT5631_R_VOL_SHIFT,\n\t\t\tRT5631_VOL_MASK, 1, in_vol_tlv),\n\t \n\tSOC_DOUBLE_TLV(\"AXI Capture Volume\", RT5631_AUX_IN_VOL,\n\t\t\tRT5631_L_VOL_SHIFT, RT5631_R_VOL_SHIFT,\n\t\t\tRT5631_VOL_MASK, 1, in_vol_tlv),\n\t \n\tSOC_DOUBLE_TLV(\"PCM Playback Volume\", RT5631_STEREO_DAC_VOL_2,\n\t\t\tRT5631_L_VOL_SHIFT, RT5631_R_VOL_SHIFT,\n\t\t\tRT5631_DAC_VOL_MASK, 1, dac_vol_tlv),\n\tSOC_DOUBLE(\"PCM Playback Switch\", RT5631_STEREO_DAC_VOL_1,\n\t\t\tRT5631_L_MUTE_SHIFT, RT5631_R_MUTE_SHIFT, 1, 1),\n\t \n\tSOC_SINGLE(\"AXO1 Playback Switch\", RT5631_MONO_AXO_1_2_VOL,\n\t\t\t\tRT5631_L_MUTE_SHIFT, 1, 1),\n\tSOC_SINGLE(\"AXO2 Playback Switch\", RT5631_MONO_AXO_1_2_VOL,\n\t\t\t\tRT5631_R_VOL_SHIFT, 1, 1),\n\t \n\tSOC_DOUBLE(\"OUTVOL Channel Switch\", RT5631_SPK_OUT_VOL,\n\t\tRT5631_L_EN_SHIFT, RT5631_R_EN_SHIFT, 1, 0),\n\n\t \n\tSOC_DOUBLE(\"Speaker Playback Switch\", RT5631_SPK_OUT_VOL,\n\t\tRT5631_L_MUTE_SHIFT, RT5631_R_MUTE_SHIFT, 1, 1),\n\tSOC_DOUBLE_TLV(\"Speaker Playback Volume\", RT5631_SPK_OUT_VOL,\n\t\tRT5631_L_VOL_SHIFT, RT5631_R_VOL_SHIFT, 39, 1, out_vol_tlv),\n\t \n\tSOC_SINGLE(\"MONO Playback Switch\", RT5631_MONO_AXO_1_2_VOL,\n\t\t\t\tRT5631_MUTE_MONO_SHIFT, 1, 1),\n\t \n\tSOC_DOUBLE(\"HP Playback Switch\", RT5631_HP_OUT_VOL,\n\t\tRT5631_L_MUTE_SHIFT, RT5631_R_MUTE_SHIFT, 1, 1),\n\tSOC_DOUBLE_TLV(\"HP Playback Volume\", RT5631_HP_OUT_VOL,\n\t\tRT5631_L_VOL_SHIFT, RT5631_R_VOL_SHIFT,\n\t\tRT5631_VOL_MASK, 1, out_vol_tlv),\n\t \n\tSOC_SINGLE_EXT(\"DMIC Switch\", 0, 0, 1, 0,\n\t\trt5631_dmic_get, rt5631_dmic_put),\n\tSOC_DOUBLE(\"DMIC Capture Switch\", RT5631_DIG_MIC_CTRL,\n\t\tRT5631_DMIC_L_CH_MUTE_SHIFT,\n\t\tRT5631_DMIC_R_CH_MUTE_SHIFT, 1, 1),\n\n\t \n\tSOC_ENUM(\"SPK Ratio Control\", rt5631_spk_ratio_enum),\n};\n\nstatic int check_sysclk1_source(struct snd_soc_dapm_widget *source,\n\t\t\t struct snd_soc_dapm_widget *sink)\n{\n\tstruct snd_soc_component *component = snd_soc_dapm_to_component(source->dapm);\n\tunsigned int reg;\n\n\treg = snd_soc_component_read(component, RT5631_GLOBAL_CLK_CTRL);\n\treturn reg & RT5631_SYSCLK_SOUR_SEL_PLL;\n}\n\nstatic int check_dmic_used(struct snd_soc_dapm_widget *source,\n\t\t\t struct snd_soc_dapm_widget *sink)\n{\n\tstruct snd_soc_component *component = snd_soc_dapm_to_component(source->dapm);\n\tstruct rt5631_priv *rt5631 = snd_soc_component_get_drvdata(component);\n\treturn rt5631->dmic_used_flag;\n}\n\nstatic int check_dacl_to_outmixl(struct snd_soc_dapm_widget *source,\n\t\t\t struct snd_soc_dapm_widget *sink)\n{\n\tstruct snd_soc_component *component = snd_soc_dapm_to_component(source->dapm);\n\tunsigned int reg;\n\n\treg = snd_soc_component_read(component, RT5631_OUTMIXER_L_CTRL);\n\treturn !(reg & RT5631_M_DAC_L_TO_OUTMIXER_L);\n}\n\nstatic int check_dacr_to_outmixr(struct snd_soc_dapm_widget *source,\n\t\t\t struct snd_soc_dapm_widget *sink)\n{\n\tstruct snd_soc_component *component = snd_soc_dapm_to_component(source->dapm);\n\tunsigned int reg;\n\n\treg = snd_soc_component_read(component, RT5631_OUTMIXER_R_CTRL);\n\treturn !(reg & RT5631_M_DAC_R_TO_OUTMIXER_R);\n}\n\nstatic int check_dacl_to_spkmixl(struct snd_soc_dapm_widget *source,\n\t\t\t struct snd_soc_dapm_widget *sink)\n{\n\tstruct snd_soc_component *component = snd_soc_dapm_to_component(source->dapm);\n\tunsigned int reg;\n\n\treg = snd_soc_component_read(component, RT5631_SPK_MIXER_CTRL);\n\treturn !(reg & RT5631_M_DAC_L_TO_SPKMIXER_L);\n}\n\nstatic int check_dacr_to_spkmixr(struct snd_soc_dapm_widget *source,\n\t\t\t struct snd_soc_dapm_widget *sink)\n{\n\tstruct snd_soc_component *component = snd_soc_dapm_to_component(source->dapm);\n\tunsigned int reg;\n\n\treg = snd_soc_component_read(component, RT5631_SPK_MIXER_CTRL);\n\treturn !(reg & RT5631_M_DAC_R_TO_SPKMIXER_R);\n}\n\nstatic int check_adcl_select(struct snd_soc_dapm_widget *source,\n\t\t\t struct snd_soc_dapm_widget *sink)\n{\n\tstruct snd_soc_component *component = snd_soc_dapm_to_component(source->dapm);\n\tunsigned int reg;\n\n\treg = snd_soc_component_read(component, RT5631_ADC_REC_MIXER);\n\treturn !(reg & RT5631_M_MIC1_TO_RECMIXER_L);\n}\n\nstatic int check_adcr_select(struct snd_soc_dapm_widget *source,\n\t\t\t struct snd_soc_dapm_widget *sink)\n{\n\tstruct snd_soc_component *component = snd_soc_dapm_to_component(source->dapm);\n\tunsigned int reg;\n\n\treg = snd_soc_component_read(component, RT5631_ADC_REC_MIXER);\n\treturn !(reg & RT5631_M_MIC2_TO_RECMIXER_R);\n}\n\n \nstatic void onebit_depop_power_stage(struct snd_soc_component *component, int enable)\n{\n\tunsigned int soft_vol, hp_zc;\n\n\t \n\tsnd_soc_component_update_bits(component, RT5631_DEPOP_FUN_CTRL_2,\n\t\t\t\tRT5631_EN_ONE_BIT_DEPOP, 0);\n\n\t \n\tsoft_vol = snd_soc_component_read(component, RT5631_SOFT_VOL_CTRL);\n\tsnd_soc_component_write(component, RT5631_SOFT_VOL_CTRL, 0);\n\thp_zc = snd_soc_component_read(component, RT5631_INT_ST_IRQ_CTRL_2);\n\tsnd_soc_component_write(component, RT5631_INT_ST_IRQ_CTRL_2, hp_zc & 0xf7ff);\n\tif (enable) {\n\t\t \n\t\trt5631_write_index(component, RT5631_TEST_MODE_CTRL, 0x84c0);\n\t\trt5631_write_index(component, RT5631_SPK_INTL_CTRL, 0x309f);\n\t\trt5631_write_index(component, RT5631_CP_INTL_REG2, 0x6530);\n\t\t \n\t\tsnd_soc_component_write(component, RT5631_DEPOP_FUN_CTRL_2,\n\t\t\t\tRT5631_EN_CAP_FREE_DEPOP);\n\t} else {\n\t\t \n\t\tsnd_soc_component_write(component, RT5631_DEPOP_FUN_CTRL_2, 0);\n\t\tmsleep(100);\n\t}\n\n\t \n\tsnd_soc_component_write(component, RT5631_SOFT_VOL_CTRL, soft_vol);\n\tsnd_soc_component_write(component, RT5631_INT_ST_IRQ_CTRL_2, hp_zc);\n}\n\n \nstatic void onebit_depop_mute_stage(struct snd_soc_component *component, int enable)\n{\n\tunsigned int soft_vol, hp_zc;\n\n\t \n\tsnd_soc_component_update_bits(component, RT5631_DEPOP_FUN_CTRL_2,\n\t\t\t\tRT5631_EN_ONE_BIT_DEPOP, 0);\n\n\t \n\tsoft_vol = snd_soc_component_read(component, RT5631_SOFT_VOL_CTRL);\n\tsnd_soc_component_write(component, RT5631_SOFT_VOL_CTRL, 0);\n\thp_zc = snd_soc_component_read(component, RT5631_INT_ST_IRQ_CTRL_2);\n\tsnd_soc_component_write(component, RT5631_INT_ST_IRQ_CTRL_2, hp_zc & 0xf7ff);\n\tif (enable) {\n\t\tschedule_timeout_uninterruptible(msecs_to_jiffies(10));\n\t\t \n\t\trt5631_write_index(component, RT5631_SPK_INTL_CTRL, 0x307f);\n\t\tsnd_soc_component_update_bits(component, RT5631_HP_OUT_VOL,\n\t\t\t\tRT5631_L_MUTE | RT5631_R_MUTE, 0);\n\t\tmsleep(300);\n\t} else {\n\t\tsnd_soc_component_update_bits(component, RT5631_HP_OUT_VOL,\n\t\t\tRT5631_L_MUTE | RT5631_R_MUTE,\n\t\t\tRT5631_L_MUTE | RT5631_R_MUTE);\n\t\tmsleep(100);\n\t}\n\n\t \n\tsnd_soc_component_write(component, RT5631_SOFT_VOL_CTRL, soft_vol);\n\tsnd_soc_component_write(component, RT5631_INT_ST_IRQ_CTRL_2, hp_zc);\n}\n\n \nstatic void depop_seq_power_stage(struct snd_soc_component *component, int enable)\n{\n\tunsigned int soft_vol, hp_zc;\n\n\t \n\tsnd_soc_component_update_bits(component, RT5631_DEPOP_FUN_CTRL_2,\n\t\tRT5631_EN_ONE_BIT_DEPOP, RT5631_EN_ONE_BIT_DEPOP);\n\n\t \n\tsoft_vol = snd_soc_component_read(component, RT5631_SOFT_VOL_CTRL);\n\tsnd_soc_component_write(component, RT5631_SOFT_VOL_CTRL, 0);\n\thp_zc = snd_soc_component_read(component, RT5631_INT_ST_IRQ_CTRL_2);\n\tsnd_soc_component_write(component, RT5631_INT_ST_IRQ_CTRL_2, hp_zc & 0xf7ff);\n\tif (enable) {\n\t\t \n\t\trt5631_write_index(component, RT5631_SPK_INTL_CTRL, 0x303e);\n\n\t\t \n\t\tsnd_soc_component_update_bits(component, RT5631_PWR_MANAG_ADD3,\n\t\t\tRT5631_PWR_CHARGE_PUMP | RT5631_PWR_HP_L_AMP |\n\t\t\tRT5631_PWR_HP_R_AMP,\n\t\t\tRT5631_PWR_CHARGE_PUMP | RT5631_PWR_HP_L_AMP |\n\t\t\tRT5631_PWR_HP_R_AMP);\n\n\t\t \n\t\tsnd_soc_component_write(component, RT5631_DEPOP_FUN_CTRL_1,\n\t\t\tRT5631_POW_ON_SOFT_GEN | RT5631_EN_DEPOP2_FOR_HP);\n\t\tmsleep(100);\n\n\t\t \n\t\tsnd_soc_component_update_bits(component, RT5631_PWR_MANAG_ADD3,\n\t\t\tRT5631_PWR_HP_DEPOP_DIS, RT5631_PWR_HP_DEPOP_DIS);\n\t} else {\n\t\t \n\t\trt5631_write_index(component, RT5631_SPK_INTL_CTRL, 0x303F);\n\t\tsnd_soc_component_write(component, RT5631_DEPOP_FUN_CTRL_1,\n\t\t\tRT5631_POW_ON_SOFT_GEN | RT5631_EN_MUTE_UNMUTE_DEPOP |\n\t\t\tRT5631_PD_HPAMP_L_ST_UP | RT5631_PD_HPAMP_R_ST_UP);\n\t\tmsleep(75);\n\t\tsnd_soc_component_write(component, RT5631_DEPOP_FUN_CTRL_1,\n\t\t\tRT5631_POW_ON_SOFT_GEN | RT5631_PD_HPAMP_L_ST_UP |\n\t\t\tRT5631_PD_HPAMP_R_ST_UP);\n\n\t\t \n\t\tsnd_soc_component_update_bits(component, RT5631_PWR_MANAG_ADD3,\n\t\t\t\tRT5631_PWR_HP_DEPOP_DIS, 0);\n\n\t\t \n\t\tsnd_soc_component_write(component, RT5631_DEPOP_FUN_CTRL_1,\n\t\t\tRT5631_POW_ON_SOFT_GEN | RT5631_EN_DEPOP2_FOR_HP |\n\t\t\tRT5631_PD_HPAMP_L_ST_UP | RT5631_PD_HPAMP_R_ST_UP);\n\t\tmsleep(80);\n\t\tsnd_soc_component_write(component, RT5631_DEPOP_FUN_CTRL_1,\n\t\t\tRT5631_POW_ON_SOFT_GEN);\n\n\t\t \n\t\tsnd_soc_component_update_bits(component, RT5631_PWR_MANAG_ADD3,\n\t\t\tRT5631_PWR_CHARGE_PUMP | RT5631_PWR_HP_L_AMP |\n\t\t\tRT5631_PWR_HP_R_AMP, 0);\n\t}\n\n\t \n\tsnd_soc_component_write(component, RT5631_SOFT_VOL_CTRL, soft_vol);\n\tsnd_soc_component_write(component, RT5631_INT_ST_IRQ_CTRL_2, hp_zc);\n}\n\n \nstatic void depop_seq_mute_stage(struct snd_soc_component *component, int enable)\n{\n\tunsigned int soft_vol, hp_zc;\n\n\t \n\tsnd_soc_component_update_bits(component, RT5631_DEPOP_FUN_CTRL_2,\n\t\tRT5631_EN_ONE_BIT_DEPOP, RT5631_EN_ONE_BIT_DEPOP);\n\n\t \n\tsoft_vol = snd_soc_component_read(component, RT5631_SOFT_VOL_CTRL);\n\tsnd_soc_component_write(component, RT5631_SOFT_VOL_CTRL, 0);\n\thp_zc = snd_soc_component_read(component, RT5631_INT_ST_IRQ_CTRL_2);\n\tsnd_soc_component_write(component, RT5631_INT_ST_IRQ_CTRL_2, hp_zc & 0xf7ff);\n\tif (enable) {\n\t\tschedule_timeout_uninterruptible(msecs_to_jiffies(10));\n\n\t\t \n\t\trt5631_write_index(component, RT5631_SPK_INTL_CTRL, 0x302f);\n\t\tsnd_soc_component_write(component, RT5631_DEPOP_FUN_CTRL_1,\n\t\t\tRT5631_POW_ON_SOFT_GEN | RT5631_EN_MUTE_UNMUTE_DEPOP |\n\t\t\tRT5631_EN_HP_R_M_UN_MUTE_DEPOP |\n\t\t\tRT5631_EN_HP_L_M_UN_MUTE_DEPOP);\n\n\t\tsnd_soc_component_update_bits(component, RT5631_HP_OUT_VOL,\n\t\t\t\tRT5631_L_MUTE | RT5631_R_MUTE, 0);\n\t\tmsleep(160);\n\t} else {\n\t\t \n\t\trt5631_write_index(component, RT5631_SPK_INTL_CTRL, 0x302f);\n\t\tsnd_soc_component_write(component, RT5631_DEPOP_FUN_CTRL_1,\n\t\t\tRT5631_POW_ON_SOFT_GEN | RT5631_EN_MUTE_UNMUTE_DEPOP |\n\t\t\tRT5631_EN_HP_R_M_UN_MUTE_DEPOP |\n\t\t\tRT5631_EN_HP_L_M_UN_MUTE_DEPOP);\n\n\t\tsnd_soc_component_update_bits(component, RT5631_HP_OUT_VOL,\n\t\t\tRT5631_L_MUTE | RT5631_R_MUTE,\n\t\t\tRT5631_L_MUTE | RT5631_R_MUTE);\n\t\tmsleep(150);\n\t}\n\n\t \n\tsnd_soc_component_write(component, RT5631_SOFT_VOL_CTRL, soft_vol);\n\tsnd_soc_component_write(component, RT5631_INT_ST_IRQ_CTRL_2, hp_zc);\n}\n\nstatic int hp_event(struct snd_soc_dapm_widget *w,\n\tstruct snd_kcontrol *kcontrol, int event)\n{\n\tstruct snd_soc_component *component = snd_soc_dapm_to_component(w->dapm);\n\tstruct rt5631_priv *rt5631 = snd_soc_component_get_drvdata(component);\n\n\tswitch (event) {\n\tcase SND_SOC_DAPM_PRE_PMD:\n\t\tif (rt5631->codec_version) {\n\t\t\tonebit_depop_mute_stage(component, 0);\n\t\t\tonebit_depop_power_stage(component, 0);\n\t\t} else {\n\t\t\tdepop_seq_mute_stage(component, 0);\n\t\t\tdepop_seq_power_stage(component, 0);\n\t\t}\n\t\tbreak;\n\n\tcase SND_SOC_DAPM_POST_PMU:\n\t\tif (rt5631->codec_version) {\n\t\t\tonebit_depop_power_stage(component, 1);\n\t\t\tonebit_depop_mute_stage(component, 1);\n\t\t} else {\n\t\t\tdepop_seq_power_stage(component, 1);\n\t\t\tdepop_seq_mute_stage(component, 1);\n\t\t}\n\t\tbreak;\n\n\tdefault:\n\t\tbreak;\n\t}\n\n\treturn 0;\n}\n\nstatic int set_dmic_params(struct snd_soc_dapm_widget *w,\n\tstruct snd_kcontrol *kcontrol, int event)\n{\n\tstruct snd_soc_component *component = snd_soc_dapm_to_component(w->dapm);\n\tstruct rt5631_priv *rt5631 = snd_soc_component_get_drvdata(component);\n\n\tswitch (rt5631->rx_rate) {\n\tcase 44100:\n\tcase 48000:\n\t\tsnd_soc_component_update_bits(component, RT5631_DIG_MIC_CTRL,\n\t\t\tRT5631_DMIC_CLK_CTRL_MASK,\n\t\t\tRT5631_DMIC_CLK_CTRL_TO_32FS);\n\t\tbreak;\n\n\tcase 32000:\n\tcase 22050:\n\t\tsnd_soc_component_update_bits(component, RT5631_DIG_MIC_CTRL,\n\t\t\tRT5631_DMIC_CLK_CTRL_MASK,\n\t\t\tRT5631_DMIC_CLK_CTRL_TO_64FS);\n\t\tbreak;\n\n\tcase 16000:\n\tcase 11025:\n\tcase 8000:\n\t\tsnd_soc_component_update_bits(component, RT5631_DIG_MIC_CTRL,\n\t\t\tRT5631_DMIC_CLK_CTRL_MASK,\n\t\t\tRT5631_DMIC_CLK_CTRL_TO_128FS);\n\t\tbreak;\n\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\treturn 0;\n}\n\nstatic const struct snd_kcontrol_new rt5631_recmixl_mixer_controls[] = {\n\tSOC_DAPM_SINGLE(\"OUTMIXL Capture Switch\", RT5631_ADC_REC_MIXER,\n\t\t\tRT5631_M_OUTMIXL_RECMIXL_BIT, 1, 1),\n\tSOC_DAPM_SINGLE(\"MIC1_BST1 Capture Switch\", RT5631_ADC_REC_MIXER,\n\t\t\tRT5631_M_MIC1_RECMIXL_BIT, 1, 1),\n\tSOC_DAPM_SINGLE(\"AXILVOL Capture Switch\", RT5631_ADC_REC_MIXER,\n\t\t\tRT5631_M_AXIL_RECMIXL_BIT, 1, 1),\n\tSOC_DAPM_SINGLE(\"MONOIN_RX Capture Switch\", RT5631_ADC_REC_MIXER,\n\t\t\tRT5631_M_MONO_IN_RECMIXL_BIT, 1, 1),\n};\n\nstatic const struct snd_kcontrol_new rt5631_recmixr_mixer_controls[] = {\n\tSOC_DAPM_SINGLE(\"MONOIN_RX Capture Switch\", RT5631_ADC_REC_MIXER,\n\t\t\tRT5631_M_MONO_IN_RECMIXR_BIT, 1, 1),\n\tSOC_DAPM_SINGLE(\"AXIRVOL Capture Switch\", RT5631_ADC_REC_MIXER,\n\t\t\tRT5631_M_AXIR_RECMIXR_BIT, 1, 1),\n\tSOC_DAPM_SINGLE(\"MIC2_BST2 Capture Switch\", RT5631_ADC_REC_MIXER,\n\t\t\tRT5631_M_MIC2_RECMIXR_BIT, 1, 1),\n\tSOC_DAPM_SINGLE(\"OUTMIXR Capture Switch\", RT5631_ADC_REC_MIXER,\n\t\t\tRT5631_M_OUTMIXR_RECMIXR_BIT, 1, 1),\n};\n\nstatic const struct snd_kcontrol_new rt5631_spkmixl_mixer_controls[] = {\n\tSOC_DAPM_SINGLE(\"RECMIXL Playback Switch\", RT5631_SPK_MIXER_CTRL,\n\t\t\tRT5631_M_RECMIXL_SPKMIXL_BIT, 1, 1),\n\tSOC_DAPM_SINGLE(\"MIC1_P Playback Switch\", RT5631_SPK_MIXER_CTRL,\n\t\t\tRT5631_M_MIC1P_SPKMIXL_BIT, 1, 1),\n\tSOC_DAPM_SINGLE(\"DACL Playback Switch\", RT5631_SPK_MIXER_CTRL,\n\t\t\tRT5631_M_DACL_SPKMIXL_BIT, 1, 1),\n\tSOC_DAPM_SINGLE(\"OUTMIXL Playback Switch\", RT5631_SPK_MIXER_CTRL,\n\t\t\tRT5631_M_OUTMIXL_SPKMIXL_BIT, 1, 1),\n};\n\nstatic const struct snd_kcontrol_new rt5631_spkmixr_mixer_controls[] = {\n\tSOC_DAPM_SINGLE(\"OUTMIXR Playback Switch\", RT5631_SPK_MIXER_CTRL,\n\t\t\tRT5631_M_OUTMIXR_SPKMIXR_BIT, 1, 1),\n\tSOC_DAPM_SINGLE(\"DACR Playback Switch\", RT5631_SPK_MIXER_CTRL,\n\t\t\tRT5631_M_DACR_SPKMIXR_BIT, 1, 1),\n\tSOC_DAPM_SINGLE(\"MIC2_P Playback Switch\", RT5631_SPK_MIXER_CTRL,\n\t\t\tRT5631_M_MIC2P_SPKMIXR_BIT, 1, 1),\n\tSOC_DAPM_SINGLE(\"RECMIXR Playback Switch\", RT5631_SPK_MIXER_CTRL,\n\t\t\tRT5631_M_RECMIXR_SPKMIXR_BIT, 1, 1),\n};\n\nstatic const struct snd_kcontrol_new rt5631_outmixl_mixer_controls[] = {\n\tSOC_DAPM_SINGLE(\"RECMIXL Playback Switch\", RT5631_OUTMIXER_L_CTRL,\n\t\t\t\tRT5631_M_RECMIXL_OUTMIXL_BIT, 1, 1),\n\tSOC_DAPM_SINGLE(\"RECMIXR Playback Switch\", RT5631_OUTMIXER_L_CTRL,\n\t\t\t\tRT5631_M_RECMIXR_OUTMIXL_BIT, 1, 1),\n\tSOC_DAPM_SINGLE(\"DACL Playback Switch\", RT5631_OUTMIXER_L_CTRL,\n\t\t\t\tRT5631_M_DACL_OUTMIXL_BIT, 1, 1),\n\tSOC_DAPM_SINGLE(\"MIC1_BST1 Playback Switch\", RT5631_OUTMIXER_L_CTRL,\n\t\t\t\tRT5631_M_MIC1_OUTMIXL_BIT, 1, 1),\n\tSOC_DAPM_SINGLE(\"MIC2_BST2 Playback Switch\", RT5631_OUTMIXER_L_CTRL,\n\t\t\t\tRT5631_M_MIC2_OUTMIXL_BIT, 1, 1),\n\tSOC_DAPM_SINGLE(\"MONOIN_RXP Playback Switch\", RT5631_OUTMIXER_L_CTRL,\n\t\t\t\tRT5631_M_MONO_INP_OUTMIXL_BIT, 1, 1),\n\tSOC_DAPM_SINGLE(\"AXILVOL Playback Switch\", RT5631_OUTMIXER_L_CTRL,\n\t\t\t\tRT5631_M_AXIL_OUTMIXL_BIT, 1, 1),\n\tSOC_DAPM_SINGLE(\"AXIRVOL Playback Switch\", RT5631_OUTMIXER_L_CTRL,\n\t\t\t\tRT5631_M_AXIR_OUTMIXL_BIT, 1, 1),\n\tSOC_DAPM_SINGLE(\"VDAC Playback Switch\", RT5631_OUTMIXER_L_CTRL,\n\t\t\t\tRT5631_M_VDAC_OUTMIXL_BIT, 1, 1),\n};\n\nstatic const struct snd_kcontrol_new rt5631_outmixr_mixer_controls[] = {\n\tSOC_DAPM_SINGLE(\"VDAC Playback Switch\", RT5631_OUTMIXER_R_CTRL,\n\t\t\t\tRT5631_M_VDAC_OUTMIXR_BIT, 1, 1),\n\tSOC_DAPM_SINGLE(\"AXIRVOL Playback Switch\", RT5631_OUTMIXER_R_CTRL,\n\t\t\t\tRT5631_M_AXIR_OUTMIXR_BIT, 1, 1),\n\tSOC_DAPM_SINGLE(\"AXILVOL Playback Switch\", RT5631_OUTMIXER_R_CTRL,\n\t\t\t\tRT5631_M_AXIL_OUTMIXR_BIT, 1, 1),\n\tSOC_DAPM_SINGLE(\"MONOIN_RXN Playback Switch\", RT5631_OUTMIXER_R_CTRL,\n\t\t\t\tRT5631_M_MONO_INN_OUTMIXR_BIT, 1, 1),\n\tSOC_DAPM_SINGLE(\"MIC2_BST2 Playback Switch\", RT5631_OUTMIXER_R_CTRL,\n\t\t\t\tRT5631_M_MIC2_OUTMIXR_BIT, 1, 1),\n\tSOC_DAPM_SINGLE(\"MIC1_BST1 Playback Switch\", RT5631_OUTMIXER_R_CTRL,\n\t\t\t\tRT5631_M_MIC1_OUTMIXR_BIT, 1, 1),\n\tSOC_DAPM_SINGLE(\"DACR Playback Switch\", RT5631_OUTMIXER_R_CTRL,\n\t\t\t\tRT5631_M_DACR_OUTMIXR_BIT, 1, 1),\n\tSOC_DAPM_SINGLE(\"RECMIXR Playback Switch\", RT5631_OUTMIXER_R_CTRL,\n\t\t\t\tRT5631_M_RECMIXR_OUTMIXR_BIT, 1, 1),\n\tSOC_DAPM_SINGLE(\"RECMIXL Playback Switch\", RT5631_OUTMIXER_R_CTRL,\n\t\t\t\tRT5631_M_RECMIXL_OUTMIXR_BIT, 1, 1),\n};\n\nstatic const struct snd_kcontrol_new rt5631_AXO1MIX_mixer_controls[] = {\n\tSOC_DAPM_SINGLE(\"MIC1_BST1 Playback Switch\", RT5631_AXO1MIXER_CTRL,\n\t\t\t\tRT5631_M_MIC1_AXO1MIX_BIT , 1, 1),\n\tSOC_DAPM_SINGLE(\"MIC2_BST2 Playback Switch\", RT5631_AXO1MIXER_CTRL,\n\t\t\t\tRT5631_M_MIC2_AXO1MIX_BIT, 1, 1),\n\tSOC_DAPM_SINGLE(\"OUTVOLL Playback Switch\", RT5631_AXO1MIXER_CTRL,\n\t\t\t\tRT5631_M_OUTMIXL_AXO1MIX_BIT , 1 , 1),\n\tSOC_DAPM_SINGLE(\"OUTVOLR Playback Switch\", RT5631_AXO1MIXER_CTRL,\n\t\t\t\tRT5631_M_OUTMIXR_AXO1MIX_BIT, 1, 1),\n};\n\nstatic const struct snd_kcontrol_new rt5631_AXO2MIX_mixer_controls[] = {\n\tSOC_DAPM_SINGLE(\"MIC1_BST1 Playback Switch\", RT5631_AXO2MIXER_CTRL,\n\t\t\t\tRT5631_M_MIC1_AXO2MIX_BIT, 1, 1),\n\tSOC_DAPM_SINGLE(\"MIC2_BST2 Playback Switch\", RT5631_AXO2MIXER_CTRL,\n\t\t\t\tRT5631_M_MIC2_AXO2MIX_BIT, 1, 1),\n\tSOC_DAPM_SINGLE(\"OUTVOLL Playback Switch\", RT5631_AXO2MIXER_CTRL,\n\t\t\t\tRT5631_M_OUTMIXL_AXO2MIX_BIT, 1, 1),\n\tSOC_DAPM_SINGLE(\"OUTVOLR Playback Switch\", RT5631_AXO2MIXER_CTRL,\n\t\t\t\tRT5631_M_OUTMIXR_AXO2MIX_BIT, 1 , 1),\n};\n\nstatic const struct snd_kcontrol_new rt5631_spolmix_mixer_controls[] = {\n\tSOC_DAPM_SINGLE(\"SPKVOLL Playback Switch\", RT5631_SPK_MONO_OUT_CTRL,\n\t\t\t\tRT5631_M_SPKVOLL_SPOLMIX_BIT, 1, 1),\n\tSOC_DAPM_SINGLE(\"SPKVOLR Playback Switch\", RT5631_SPK_MONO_OUT_CTRL,\n\t\t\t\tRT5631_M_SPKVOLR_SPOLMIX_BIT, 1, 1),\n};\n\nstatic const struct snd_kcontrol_new rt5631_spormix_mixer_controls[] = {\n\tSOC_DAPM_SINGLE(\"SPKVOLL Playback Switch\", RT5631_SPK_MONO_OUT_CTRL,\n\t\t\t\tRT5631_M_SPKVOLL_SPORMIX_BIT, 1, 1),\n\tSOC_DAPM_SINGLE(\"SPKVOLR Playback Switch\", RT5631_SPK_MONO_OUT_CTRL,\n\t\t\t\tRT5631_M_SPKVOLR_SPORMIX_BIT, 1, 1),\n};\n\nstatic const struct snd_kcontrol_new rt5631_monomix_mixer_controls[] = {\n\tSOC_DAPM_SINGLE(\"OUTVOLL Playback Switch\", RT5631_SPK_MONO_OUT_CTRL,\n\t\t\t\tRT5631_M_OUTVOLL_MONOMIX_BIT, 1, 1),\n\tSOC_DAPM_SINGLE(\"OUTVOLR Playback Switch\", RT5631_SPK_MONO_OUT_CTRL,\n\t\t\t\tRT5631_M_OUTVOLR_MONOMIX_BIT, 1, 1),\n};\n\n \nstatic const char *rt5631_spkvoll_sel[] = {\"Vmid\", \"SPKMIXL\"};\n\nstatic SOC_ENUM_SINGLE_DECL(rt5631_spkvoll_enum, RT5631_SPK_OUT_VOL,\n\t\t\t    RT5631_L_EN_SHIFT, rt5631_spkvoll_sel);\n\nstatic const struct snd_kcontrol_new rt5631_spkvoll_mux_control =\n\tSOC_DAPM_ENUM(\"Left SPKVOL SRC\", rt5631_spkvoll_enum);\n\n \nstatic const char *rt5631_hpvoll_sel[] = {\"Vmid\", \"OUTMIXL\"};\n\nstatic SOC_ENUM_SINGLE_DECL(rt5631_hpvoll_enum, RT5631_HP_OUT_VOL,\n\t\t\t    RT5631_L_EN_SHIFT, rt5631_hpvoll_sel);\n\nstatic const struct snd_kcontrol_new rt5631_hpvoll_mux_control =\n\tSOC_DAPM_ENUM(\"Left HPVOL SRC\", rt5631_hpvoll_enum);\n\n \nstatic const char *rt5631_outvoll_sel[] = {\"Vmid\", \"OUTMIXL\"};\n\nstatic SOC_ENUM_SINGLE_DECL(rt5631_outvoll_enum, RT5631_MONO_AXO_1_2_VOL,\n\t\t\t    RT5631_L_EN_SHIFT, rt5631_outvoll_sel);\n\nstatic const struct snd_kcontrol_new rt5631_outvoll_mux_control =\n\tSOC_DAPM_ENUM(\"Left OUTVOL SRC\", rt5631_outvoll_enum);\n\n \nstatic const char *rt5631_outvolr_sel[] = {\"Vmid\", \"OUTMIXR\"};\n\nstatic SOC_ENUM_SINGLE_DECL(rt5631_outvolr_enum, RT5631_MONO_AXO_1_2_VOL,\n\t\t\t    RT5631_R_EN_SHIFT, rt5631_outvolr_sel);\n\nstatic const struct snd_kcontrol_new rt5631_outvolr_mux_control =\n\tSOC_DAPM_ENUM(\"Right OUTVOL SRC\", rt5631_outvolr_enum);\n\n \nstatic const char *rt5631_hpvolr_sel[] = {\"Vmid\", \"OUTMIXR\"};\n\nstatic SOC_ENUM_SINGLE_DECL(rt5631_hpvolr_enum, RT5631_HP_OUT_VOL,\n\t\t\t    RT5631_R_EN_SHIFT, rt5631_hpvolr_sel);\n\nstatic const struct snd_kcontrol_new rt5631_hpvolr_mux_control =\n\tSOC_DAPM_ENUM(\"Right HPVOL SRC\", rt5631_hpvolr_enum);\n\n \nstatic const char *rt5631_spkvolr_sel[] = {\"Vmid\", \"SPKMIXR\"};\n\nstatic SOC_ENUM_SINGLE_DECL(rt5631_spkvolr_enum, RT5631_SPK_OUT_VOL,\n\t\t\t    RT5631_R_EN_SHIFT, rt5631_spkvolr_sel);\n\nstatic const struct snd_kcontrol_new rt5631_spkvolr_mux_control =\n\tSOC_DAPM_ENUM(\"Right SPKVOL SRC\", rt5631_spkvolr_enum);\n\n \nstatic const char *rt5631_spol_src_sel[] = {\n\t\"SPOLMIX\", \"MONOIN_RX\", \"VDAC\", \"DACL\"};\n\nstatic SOC_ENUM_SINGLE_DECL(rt5631_spol_src_enum, RT5631_SPK_MONO_HP_OUT_CTRL,\n\t\t\t    RT5631_SPK_L_MUX_SEL_SHIFT, rt5631_spol_src_sel);\n\nstatic const struct snd_kcontrol_new rt5631_spol_mux_control =\n\tSOC_DAPM_ENUM(\"SPOL SRC\", rt5631_spol_src_enum);\n\n \nstatic const char *rt5631_spor_src_sel[] = {\n\t\"SPORMIX\", \"MONOIN_RX\", \"VDAC\", \"DACR\"};\n\nstatic SOC_ENUM_SINGLE_DECL(rt5631_spor_src_enum, RT5631_SPK_MONO_HP_OUT_CTRL,\n\t\t\t    RT5631_SPK_R_MUX_SEL_SHIFT, rt5631_spor_src_sel);\n\nstatic const struct snd_kcontrol_new rt5631_spor_mux_control =\n\tSOC_DAPM_ENUM(\"SPOR SRC\", rt5631_spor_src_enum);\n\n \nstatic const char *rt5631_mono_src_sel[] = {\"MONOMIX\", \"MONOIN_RX\", \"VDAC\"};\n\nstatic SOC_ENUM_SINGLE_DECL(rt5631_mono_src_enum, RT5631_SPK_MONO_HP_OUT_CTRL,\n\t\t\t    RT5631_MONO_MUX_SEL_SHIFT, rt5631_mono_src_sel);\n\nstatic const struct snd_kcontrol_new rt5631_mono_mux_control =\n\tSOC_DAPM_ENUM(\"MONO SRC\", rt5631_mono_src_enum);\n\n \nstatic const char *rt5631_hpl_src_sel[] = {\"Left HPVOL\", \"Left DAC\"};\n\nstatic SOC_ENUM_SINGLE_DECL(rt5631_hpl_src_enum, RT5631_SPK_MONO_HP_OUT_CTRL,\n\t\t\t    RT5631_HP_L_MUX_SEL_SHIFT, rt5631_hpl_src_sel);\n\nstatic const struct snd_kcontrol_new rt5631_hpl_mux_control =\n\tSOC_DAPM_ENUM(\"HPL SRC\", rt5631_hpl_src_enum);\n\n \nstatic const char *rt5631_hpr_src_sel[] = {\"Right HPVOL\", \"Right DAC\"};\n\nstatic SOC_ENUM_SINGLE_DECL(rt5631_hpr_src_enum, RT5631_SPK_MONO_HP_OUT_CTRL,\n\t\t\t    RT5631_HP_R_MUX_SEL_SHIFT, rt5631_hpr_src_sel);\n\nstatic const struct snd_kcontrol_new rt5631_hpr_mux_control =\n\tSOC_DAPM_ENUM(\"HPR SRC\", rt5631_hpr_src_enum);\n\nstatic const struct snd_soc_dapm_widget rt5631_dapm_widgets[] = {\n\t \n\tSND_SOC_DAPM_VMID(\"Vmid\"),\n\t \n\tSND_SOC_DAPM_SUPPLY(\"PLL1\", RT5631_PWR_MANAG_ADD2,\n\t\t\tRT5631_PWR_PLL1_BIT, 0, NULL, 0),\n\n\t \n\t \n\tSND_SOC_DAPM_INPUT(\"MIC1\"),\n\tSND_SOC_DAPM_INPUT(\"MIC2\"),\n\tSND_SOC_DAPM_INPUT(\"AXIL\"),\n\tSND_SOC_DAPM_INPUT(\"AXIR\"),\n\tSND_SOC_DAPM_INPUT(\"MONOIN_RXN\"),\n\tSND_SOC_DAPM_INPUT(\"MONOIN_RXP\"),\n\tSND_SOC_DAPM_INPUT(\"DMIC\"),\n\n\t \n\tSND_SOC_DAPM_MICBIAS(\"MIC Bias1\", RT5631_PWR_MANAG_ADD2,\n\t\t\tRT5631_PWR_MICBIAS1_VOL_BIT, 0),\n\tSND_SOC_DAPM_MICBIAS(\"MIC Bias2\", RT5631_PWR_MANAG_ADD2,\n\t\t\tRT5631_PWR_MICBIAS2_VOL_BIT, 0),\n\n\t \n\tSND_SOC_DAPM_PGA(\"MIC1 Boost\", RT5631_PWR_MANAG_ADD2,\n\t\t\tRT5631_PWR_MIC1_BOOT_GAIN_BIT, 0, NULL, 0),\n\tSND_SOC_DAPM_PGA(\"MIC2 Boost\", RT5631_PWR_MANAG_ADD2,\n\t\t\tRT5631_PWR_MIC2_BOOT_GAIN_BIT, 0, NULL, 0),\n\tSND_SOC_DAPM_PGA(\"MONOIN_RXP Boost\", RT5631_PWR_MANAG_ADD4,\n\t\t\tRT5631_PWR_MONO_IN_P_VOL_BIT, 0, NULL, 0),\n\tSND_SOC_DAPM_PGA(\"MONOIN_RXN Boost\", RT5631_PWR_MANAG_ADD4,\n\t\t\tRT5631_PWR_MONO_IN_N_VOL_BIT, 0, NULL, 0),\n\tSND_SOC_DAPM_PGA(\"AXIL Boost\", RT5631_PWR_MANAG_ADD4,\n\t\t\tRT5631_PWR_AXIL_IN_VOL_BIT, 0, NULL, 0),\n\tSND_SOC_DAPM_PGA(\"AXIR Boost\", RT5631_PWR_MANAG_ADD4,\n\t\t\tRT5631_PWR_AXIR_IN_VOL_BIT, 0, NULL, 0),\n\n\t \n\tSND_SOC_DAPM_MIXER(\"MONO_IN\", SND_SOC_NOPM, 0, 0, NULL, 0),\n\n\t \n\tSND_SOC_DAPM_MIXER(\"RECMIXL Mixer\", RT5631_PWR_MANAG_ADD2,\n\t\tRT5631_PWR_RECMIXER_L_BIT, 0,\n\t\t&rt5631_recmixl_mixer_controls[0],\n\t\tARRAY_SIZE(rt5631_recmixl_mixer_controls)),\n\tSND_SOC_DAPM_MIXER(\"RECMIXR Mixer\", RT5631_PWR_MANAG_ADD2,\n\t\tRT5631_PWR_RECMIXER_R_BIT, 0,\n\t\t&rt5631_recmixr_mixer_controls[0],\n\t\tARRAY_SIZE(rt5631_recmixr_mixer_controls)),\n\t \n\tSND_SOC_DAPM_MIXER(\"ADC Mixer\", SND_SOC_NOPM, 0, 0, NULL, 0),\n\n\t \n\tSND_SOC_DAPM_SUPPLY(\"DMIC Supply\", RT5631_DIG_MIC_CTRL,\n\t\tRT5631_DMIC_ENA_SHIFT, 0,\n\t\tset_dmic_params, SND_SOC_DAPM_PRE_PMU),\n\t \n\tSND_SOC_DAPM_SUPPLY(\"Left ADC Select\", RT5631_INT_ST_IRQ_CTRL_2,\n\t\t\tRT5631_ADC_DATA_SEL_MIC1_SHIFT, 0, NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"Right ADC Select\", RT5631_INT_ST_IRQ_CTRL_2,\n\t\t\tRT5631_ADC_DATA_SEL_MIC2_SHIFT, 0, NULL, 0),\n\n\t \n\tSND_SOC_DAPM_ADC(\"Left ADC\", \"HIFI Capture\",\n\t\tRT5631_PWR_MANAG_ADD1, RT5631_PWR_ADC_L_CLK_BIT, 0),\n\tSND_SOC_DAPM_ADC(\"Right ADC\", \"HIFI Capture\",\n\t\tRT5631_PWR_MANAG_ADD1, RT5631_PWR_ADC_R_CLK_BIT, 0),\n\n\t \n\tSND_SOC_DAPM_SUPPLY(\"I2S\", RT5631_PWR_MANAG_ADD1,\n\t\t\tRT5631_PWR_MAIN_I2S_BIT, 0, NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"DAC REF\", RT5631_PWR_MANAG_ADD1,\n\t\t\tRT5631_PWR_DAC_REF_BIT, 0, NULL, 0),\n\n\t \n\t \n\tSND_SOC_DAPM_DAC(\"Left DAC\", \"HIFI Playback\",\n\t\tRT5631_PWR_MANAG_ADD1, RT5631_PWR_DAC_L_CLK_BIT, 0),\n\tSND_SOC_DAPM_DAC(\"Right DAC\", \"HIFI Playback\",\n\t\tRT5631_PWR_MANAG_ADD1, RT5631_PWR_DAC_R_CLK_BIT, 0),\n\tSND_SOC_DAPM_DAC(\"Voice DAC\", \"Voice DAC Mono Playback\",\n\t\t\t\tSND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_PGA(\"Voice DAC Boost\", SND_SOC_NOPM, 0, 0, NULL, 0),\n\t \n\tSND_SOC_DAPM_SUPPLY(\"Left DAC To Mixer\", RT5631_PWR_MANAG_ADD1,\n\t\t\tRT5631_PWR_DAC_L_TO_MIXER_BIT, 0, NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"Right DAC To Mixer\", RT5631_PWR_MANAG_ADD1,\n\t\t\tRT5631_PWR_DAC_R_TO_MIXER_BIT, 0, NULL, 0),\n\n\t \n\tSND_SOC_DAPM_MIXER(\"SPKMIXL Mixer\", RT5631_PWR_MANAG_ADD2,\n\t\t\tRT5631_PWR_SPKMIXER_L_BIT, 0,\n\t\t\t&rt5631_spkmixl_mixer_controls[0],\n\t\t\tARRAY_SIZE(rt5631_spkmixl_mixer_controls)),\n\t \n\tSND_SOC_DAPM_MIXER(\"OUTMIXL Mixer\", RT5631_PWR_MANAG_ADD2,\n\t\t\tRT5631_PWR_OUTMIXER_L_BIT, 0,\n\t\t\t&rt5631_outmixl_mixer_controls[0],\n\t\t\tARRAY_SIZE(rt5631_outmixl_mixer_controls)),\n\t \n\tSND_SOC_DAPM_MIXER(\"OUTMIXR Mixer\", RT5631_PWR_MANAG_ADD2,\n\t\t\tRT5631_PWR_OUTMIXER_R_BIT, 0,\n\t\t\t&rt5631_outmixr_mixer_controls[0],\n\t\t\tARRAY_SIZE(rt5631_outmixr_mixer_controls)),\n\t \n\tSND_SOC_DAPM_MIXER(\"SPKMIXR Mixer\", RT5631_PWR_MANAG_ADD2,\n\t\t\tRT5631_PWR_SPKMIXER_R_BIT, 0,\n\t\t\t&rt5631_spkmixr_mixer_controls[0],\n\t\t\tARRAY_SIZE(rt5631_spkmixr_mixer_controls)),\n\n\t \n\tSND_SOC_DAPM_MUX(\"Left SPKVOL Mux\", RT5631_PWR_MANAG_ADD4,\n\t\t\tRT5631_PWR_SPK_L_VOL_BIT, 0,\n\t\t\t&rt5631_spkvoll_mux_control),\n\tSND_SOC_DAPM_MUX(\"Left HPVOL Mux\", RT5631_PWR_MANAG_ADD4,\n\t\t\tRT5631_PWR_HP_L_OUT_VOL_BIT, 0,\n\t\t\t&rt5631_hpvoll_mux_control),\n\tSND_SOC_DAPM_MUX(\"Left OUTVOL Mux\", RT5631_PWR_MANAG_ADD4,\n\t\t\tRT5631_PWR_LOUT_VOL_BIT, 0,\n\t\t\t&rt5631_outvoll_mux_control),\n\tSND_SOC_DAPM_MUX(\"Right OUTVOL Mux\", RT5631_PWR_MANAG_ADD4,\n\t\t\tRT5631_PWR_ROUT_VOL_BIT, 0,\n\t\t\t&rt5631_outvolr_mux_control),\n\tSND_SOC_DAPM_MUX(\"Right HPVOL Mux\", RT5631_PWR_MANAG_ADD4,\n\t\t\tRT5631_PWR_HP_R_OUT_VOL_BIT, 0,\n\t\t\t&rt5631_hpvolr_mux_control),\n\tSND_SOC_DAPM_MUX(\"Right SPKVOL Mux\", RT5631_PWR_MANAG_ADD4,\n\t\t\tRT5631_PWR_SPK_R_VOL_BIT, 0,\n\t\t\t&rt5631_spkvolr_mux_control),\n\n\t \n\tSND_SOC_DAPM_PGA_S(\"Left DAC_HP\", 0, SND_SOC_NOPM, 0, 0, NULL, 0),\n\tSND_SOC_DAPM_PGA_S(\"Right DAC_HP\", 0, SND_SOC_NOPM, 0, 0, NULL, 0),\n\n\t \n\tSND_SOC_DAPM_PGA_S(\"HP Depop\", 1, SND_SOC_NOPM, 0, 0,\n\t\thp_event, SND_SOC_DAPM_PRE_PMD | SND_SOC_DAPM_POST_PMU),\n\n\t \n\tSND_SOC_DAPM_MIXER(\"AXO1MIX Mixer\", RT5631_PWR_MANAG_ADD3,\n\t\t\tRT5631_PWR_AXO1MIXER_BIT, 0,\n\t\t\t&rt5631_AXO1MIX_mixer_controls[0],\n\t\t\tARRAY_SIZE(rt5631_AXO1MIX_mixer_controls)),\n\t \n\tSND_SOC_DAPM_MIXER(\"SPOLMIX Mixer\", SND_SOC_NOPM, 0, 0,\n\t\t\t&rt5631_spolmix_mixer_controls[0],\n\t\t\tARRAY_SIZE(rt5631_spolmix_mixer_controls)),\n\t \n\tSND_SOC_DAPM_MIXER(\"MONOMIX Mixer\", RT5631_PWR_MANAG_ADD3,\n\t\t\tRT5631_PWR_MONOMIXER_BIT, 0,\n\t\t\t&rt5631_monomix_mixer_controls[0],\n\t\t\tARRAY_SIZE(rt5631_monomix_mixer_controls)),\n\t \n\tSND_SOC_DAPM_MIXER(\"SPORMIX Mixer\", SND_SOC_NOPM, 0, 0,\n\t\t\t&rt5631_spormix_mixer_controls[0],\n\t\t\tARRAY_SIZE(rt5631_spormix_mixer_controls)),\n\t \n\tSND_SOC_DAPM_MIXER(\"AXO2MIX Mixer\", RT5631_PWR_MANAG_ADD3,\n\t\t\tRT5631_PWR_AXO2MIXER_BIT, 0,\n\t\t\t&rt5631_AXO2MIX_mixer_controls[0],\n\t\t\tARRAY_SIZE(rt5631_AXO2MIX_mixer_controls)),\n\n\t \n\tSND_SOC_DAPM_MUX(\"SPOL Mux\", SND_SOC_NOPM, 0, 0,\n\t\t\t&rt5631_spol_mux_control),\n\tSND_SOC_DAPM_MUX(\"SPOR Mux\", SND_SOC_NOPM, 0, 0,\n\t\t\t&rt5631_spor_mux_control),\n\tSND_SOC_DAPM_MUX(\"MONO Mux\", SND_SOC_NOPM, 0, 0,\n\t\t\t&rt5631_mono_mux_control),\n\tSND_SOC_DAPM_MUX(\"HPL Mux\", SND_SOC_NOPM, 0, 0,\n\t\t\t&rt5631_hpl_mux_control),\n\tSND_SOC_DAPM_MUX(\"HPR Mux\", SND_SOC_NOPM, 0, 0,\n\t\t\t&rt5631_hpr_mux_control),\n\n\t \n\tSND_SOC_DAPM_SUPPLY(\"MONO Depop\", RT5631_PWR_MANAG_ADD3,\n\t\t\tRT5631_PWR_MONO_DEPOP_DIS_BIT, 0, NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"Class D\", RT5631_PWR_MANAG_ADD1,\n\t\t\tRT5631_PWR_CLASS_D_BIT, 0, NULL, 0),\n\n\t \n\tSND_SOC_DAPM_OUTPUT(\"AUXO1\"),\n\tSND_SOC_DAPM_OUTPUT(\"AUXO2\"),\n\tSND_SOC_DAPM_OUTPUT(\"SPOL\"),\n\tSND_SOC_DAPM_OUTPUT(\"SPOR\"),\n\tSND_SOC_DAPM_OUTPUT(\"HPOL\"),\n\tSND_SOC_DAPM_OUTPUT(\"HPOR\"),\n\tSND_SOC_DAPM_OUTPUT(\"MONO\"),\n};\n\nstatic const struct snd_soc_dapm_route rt5631_dapm_routes[] = {\n\t{\"MIC1 Boost\", NULL, \"MIC1\"},\n\t{\"MIC2 Boost\", NULL, \"MIC2\"},\n\t{\"MONOIN_RXP Boost\", NULL, \"MONOIN_RXP\"},\n\t{\"MONOIN_RXN Boost\", NULL, \"MONOIN_RXN\"},\n\t{\"AXIL Boost\", NULL, \"AXIL\"},\n\t{\"AXIR Boost\", NULL, \"AXIR\"},\n\n\t{\"MONO_IN\", NULL, \"MONOIN_RXP Boost\"},\n\t{\"MONO_IN\", NULL, \"MONOIN_RXN Boost\"},\n\n\t{\"RECMIXL Mixer\", \"OUTMIXL Capture Switch\", \"OUTMIXL Mixer\"},\n\t{\"RECMIXL Mixer\", \"MIC1_BST1 Capture Switch\", \"MIC1 Boost\"},\n\t{\"RECMIXL Mixer\", \"AXILVOL Capture Switch\", \"AXIL Boost\"},\n\t{\"RECMIXL Mixer\", \"MONOIN_RX Capture Switch\", \"MONO_IN\"},\n\n\t{\"RECMIXR Mixer\", \"OUTMIXR Capture Switch\", \"OUTMIXR Mixer\"},\n\t{\"RECMIXR Mixer\", \"MIC2_BST2 Capture Switch\", \"MIC2 Boost\"},\n\t{\"RECMIXR Mixer\", \"AXIRVOL Capture Switch\", \"AXIR Boost\"},\n\t{\"RECMIXR Mixer\", \"MONOIN_RX Capture Switch\", \"MONO_IN\"},\n\n\t{\"ADC Mixer\", NULL, \"RECMIXL Mixer\"},\n\t{\"ADC Mixer\", NULL, \"RECMIXR Mixer\"},\n\n\t{\"Left ADC\", NULL, \"ADC Mixer\"},\n\t{\"Left ADC\", NULL, \"Left ADC Select\", check_adcl_select},\n\t{\"Left ADC\", NULL, \"PLL1\", check_sysclk1_source},\n\t{\"Left ADC\", NULL, \"I2S\"},\n\t{\"Left ADC\", NULL, \"DAC REF\"},\n\n\t{\"Right ADC\", NULL, \"ADC Mixer\"},\n\t{\"Right ADC\", NULL, \"Right ADC Select\", check_adcr_select},\n\t{\"Right ADC\", NULL, \"PLL1\", check_sysclk1_source},\n\t{\"Right ADC\", NULL, \"I2S\"},\n\t{\"Right ADC\", NULL, \"DAC REF\"},\n\n\t{\"DMIC\", NULL, \"DMIC Supply\", check_dmic_used},\n\t{\"Left ADC\", NULL, \"DMIC\"},\n\t{\"Right ADC\", NULL, \"DMIC\"},\n\n\t{\"Left DAC\", NULL, \"PLL1\", check_sysclk1_source},\n\t{\"Left DAC\", NULL, \"I2S\"},\n\t{\"Left DAC\", NULL, \"DAC REF\"},\n\t{\"Right DAC\", NULL, \"PLL1\", check_sysclk1_source},\n\t{\"Right DAC\", NULL, \"I2S\"},\n\t{\"Right DAC\", NULL, \"DAC REF\"},\n\n\t{\"Voice DAC Boost\", NULL, \"Voice DAC\"},\n\n\t{\"SPKMIXL Mixer\", NULL, \"Left DAC To Mixer\", check_dacl_to_spkmixl},\n\t{\"SPKMIXL Mixer\", \"RECMIXL Playback Switch\", \"RECMIXL Mixer\"},\n\t{\"SPKMIXL Mixer\", \"MIC1_P Playback Switch\", \"MIC1\"},\n\t{\"SPKMIXL Mixer\", \"DACL Playback Switch\", \"Left DAC\"},\n\t{\"SPKMIXL Mixer\", \"OUTMIXL Playback Switch\", \"OUTMIXL Mixer\"},\n\n\t{\"SPKMIXR Mixer\", NULL, \"Right DAC To Mixer\", check_dacr_to_spkmixr},\n\t{\"SPKMIXR Mixer\", \"OUTMIXR Playback Switch\", \"OUTMIXR Mixer\"},\n\t{\"SPKMIXR Mixer\", \"DACR Playback Switch\", \"Right DAC\"},\n\t{\"SPKMIXR Mixer\", \"MIC2_P Playback Switch\", \"MIC2\"},\n\t{\"SPKMIXR Mixer\", \"RECMIXR Playback Switch\", \"RECMIXR Mixer\"},\n\n\t{\"OUTMIXL Mixer\", NULL, \"Left DAC To Mixer\", check_dacl_to_outmixl},\n\t{\"OUTMIXL Mixer\", \"RECMIXL Playback Switch\", \"RECMIXL Mixer\"},\n\t{\"OUTMIXL Mixer\", \"RECMIXR Playback Switch\", \"RECMIXR Mixer\"},\n\t{\"OUTMIXL Mixer\", \"DACL Playback Switch\", \"Left DAC\"},\n\t{\"OUTMIXL Mixer\", \"MIC1_BST1 Playback Switch\", \"MIC1 Boost\"},\n\t{\"OUTMIXL Mixer\", \"MIC2_BST2 Playback Switch\", \"MIC2 Boost\"},\n\t{\"OUTMIXL Mixer\", \"MONOIN_RXP Playback Switch\", \"MONOIN_RXP Boost\"},\n\t{\"OUTMIXL Mixer\", \"AXILVOL Playback Switch\", \"AXIL Boost\"},\n\t{\"OUTMIXL Mixer\", \"AXIRVOL Playback Switch\", \"AXIR Boost\"},\n\t{\"OUTMIXL Mixer\", \"VDAC Playback Switch\", \"Voice DAC Boost\"},\n\n\t{\"OUTMIXR Mixer\", NULL, \"Right DAC To Mixer\", check_dacr_to_outmixr},\n\t{\"OUTMIXR Mixer\", \"RECMIXL Playback Switch\", \"RECMIXL Mixer\"},\n\t{\"OUTMIXR Mixer\", \"RECMIXR Playback Switch\", \"RECMIXR Mixer\"},\n\t{\"OUTMIXR Mixer\", \"DACR Playback Switch\", \"Right DAC\"},\n\t{\"OUTMIXR Mixer\", \"MIC1_BST1 Playback Switch\", \"MIC1 Boost\"},\n\t{\"OUTMIXR Mixer\", \"MIC2_BST2 Playback Switch\", \"MIC2 Boost\"},\n\t{\"OUTMIXR Mixer\", \"MONOIN_RXN Playback Switch\", \"MONOIN_RXN Boost\"},\n\t{\"OUTMIXR Mixer\", \"AXILVOL Playback Switch\", \"AXIL Boost\"},\n\t{\"OUTMIXR Mixer\", \"AXIRVOL Playback Switch\", \"AXIR Boost\"},\n\t{\"OUTMIXR Mixer\", \"VDAC Playback Switch\", \"Voice DAC Boost\"},\n\n\t{\"Left SPKVOL Mux\",  \"SPKMIXL\", \"SPKMIXL Mixer\"},\n\t{\"Left SPKVOL Mux\",  \"Vmid\", \"Vmid\"},\n\t{\"Left HPVOL Mux\",  \"OUTMIXL\", \"OUTMIXL Mixer\"},\n\t{\"Left HPVOL Mux\",  \"Vmid\", \"Vmid\"},\n\t{\"Left OUTVOL Mux\",  \"OUTMIXL\", \"OUTMIXL Mixer\"},\n\t{\"Left OUTVOL Mux\",  \"Vmid\", \"Vmid\"},\n\t{\"Right OUTVOL Mux\",  \"OUTMIXR\", \"OUTMIXR Mixer\"},\n\t{\"Right OUTVOL Mux\",  \"Vmid\", \"Vmid\"},\n\t{\"Right HPVOL Mux\",  \"OUTMIXR\", \"OUTMIXR Mixer\"},\n\t{\"Right HPVOL Mux\",  \"Vmid\", \"Vmid\"},\n\t{\"Right SPKVOL Mux\",  \"SPKMIXR\", \"SPKMIXR Mixer\"},\n\t{\"Right SPKVOL Mux\",  \"Vmid\", \"Vmid\"},\n\n\t{\"AXO1MIX Mixer\", \"MIC1_BST1 Playback Switch\", \"MIC1 Boost\"},\n\t{\"AXO1MIX Mixer\", \"OUTVOLL Playback Switch\", \"Left OUTVOL Mux\"},\n\t{\"AXO1MIX Mixer\", \"OUTVOLR Playback Switch\", \"Right OUTVOL Mux\"},\n\t{\"AXO1MIX Mixer\", \"MIC2_BST2 Playback Switch\", \"MIC2 Boost\"},\n\n\t{\"AXO2MIX Mixer\", \"MIC1_BST1 Playback Switch\", \"MIC1 Boost\"},\n\t{\"AXO2MIX Mixer\", \"OUTVOLL Playback Switch\", \"Left OUTVOL Mux\"},\n\t{\"AXO2MIX Mixer\", \"OUTVOLR Playback Switch\", \"Right OUTVOL Mux\"},\n\t{\"AXO2MIX Mixer\", \"MIC2_BST2 Playback Switch\", \"MIC2 Boost\"},\n\n\t{\"SPOLMIX Mixer\", \"SPKVOLL Playback Switch\", \"Left SPKVOL Mux\"},\n\t{\"SPOLMIX Mixer\", \"SPKVOLR Playback Switch\", \"Right SPKVOL Mux\"},\n\n\t{\"SPORMIX Mixer\", \"SPKVOLL Playback Switch\", \"Left SPKVOL Mux\"},\n\t{\"SPORMIX Mixer\", \"SPKVOLR Playback Switch\", \"Right SPKVOL Mux\"},\n\n\t{\"MONOMIX Mixer\", \"OUTVOLL Playback Switch\", \"Left OUTVOL Mux\"},\n\t{\"MONOMIX Mixer\", \"OUTVOLR Playback Switch\", \"Right OUTVOL Mux\"},\n\n\t{\"SPOL Mux\", \"SPOLMIX\", \"SPOLMIX Mixer\"},\n\t{\"SPOL Mux\", \"MONOIN_RX\", \"MONO_IN\"},\n\t{\"SPOL Mux\", \"VDAC\", \"Voice DAC Boost\"},\n\t{\"SPOL Mux\", \"DACL\", \"Left DAC\"},\n\n\t{\"SPOR Mux\", \"SPORMIX\", \"SPORMIX Mixer\"},\n\t{\"SPOR Mux\", \"MONOIN_RX\", \"MONO_IN\"},\n\t{\"SPOR Mux\", \"VDAC\", \"Voice DAC Boost\"},\n\t{\"SPOR Mux\", \"DACR\", \"Right DAC\"},\n\n\t{\"MONO Mux\", \"MONOMIX\", \"MONOMIX Mixer\"},\n\t{\"MONO Mux\", \"MONOIN_RX\", \"MONO_IN\"},\n\t{\"MONO Mux\", \"VDAC\", \"Voice DAC Boost\"},\n\n\t{\"Right DAC_HP\", NULL, \"Right DAC\"},\n\t{\"Left DAC_HP\", NULL, \"Left DAC\"},\n\n\t{\"HPL Mux\", \"Left HPVOL\", \"Left HPVOL Mux\"},\n\t{\"HPL Mux\", \"Left DAC\", \"Left DAC_HP\"},\n\t{\"HPR Mux\", \"Right HPVOL\", \"Right HPVOL Mux\"},\n\t{\"HPR Mux\", \"Right DAC\", \"Right DAC_HP\"},\n\n\t{\"HP Depop\", NULL, \"HPL Mux\"},\n\t{\"HP Depop\", NULL, \"HPR Mux\"},\n\n\t{\"AUXO1\", NULL, \"AXO1MIX Mixer\"},\n\t{\"AUXO2\", NULL, \"AXO2MIX Mixer\"},\n\n\t{\"SPOL\", NULL, \"Class D\"},\n\t{\"SPOL\", NULL, \"SPOL Mux\"},\n\t{\"SPOR\", NULL, \"Class D\"},\n\t{\"SPOR\", NULL, \"SPOR Mux\"},\n\n\t{\"HPOL\", NULL, \"HP Depop\"},\n\t{\"HPOR\", NULL, \"HP Depop\"},\n\n\t{\"MONO\", NULL, \"MONO Depop\"},\n\t{\"MONO\", NULL, \"MONO Mux\"},\n};\n\nstruct coeff_clk_div {\n\tu32 mclk;\n\tu32 bclk;\n\tu32 rate;\n\tu16 reg_val;\n};\n\n \nstruct pll_div {\n\tu32 pll_in;\n\tu32 pll_out;\n\tu16 reg_val;\n};\n\nstatic const struct pll_div codec_master_pll_div[] = {\n\t{2048000,  8192000,  0x0ea0},\n\t{3686400,  8192000,  0x4e27},\n\t{12000000,  8192000,  0x456b},\n\t{13000000,  8192000,  0x495f},\n\t{13100000,  8192000,  0x0320},\n\t{2048000,  11289600,  0xf637},\n\t{3686400,  11289600,  0x2f22},\n\t{12000000,  11289600,  0x3e2f},\n\t{13000000,  11289600,  0x4d5b},\n\t{13100000,  11289600,  0x363b},\n\t{2048000,  16384000,  0x1ea0},\n\t{3686400,  16384000,  0x9e27},\n\t{12000000,  16384000,  0x452b},\n\t{13000000,  16384000,  0x542f},\n\t{13100000,  16384000,  0x03a0},\n\t{2048000,  16934400,  0xe625},\n\t{3686400,  16934400,  0x9126},\n\t{12000000,  16934400,  0x4d2c},\n\t{13000000,  16934400,  0x742f},\n\t{13100000,  16934400,  0x3c27},\n\t{2048000,  22579200,  0x2aa0},\n\t{3686400,  22579200,  0x2f20},\n\t{12000000,  22579200,  0x7e2f},\n\t{13000000,  22579200,  0x742f},\n\t{13100000,  22579200,  0x3c27},\n\t{2048000,  24576000,  0x2ea0},\n\t{3686400,  24576000,  0xee27},\n\t{12000000,  24576000,  0x2915},\n\t{13000000,  24576000,  0x772e},\n\t{13100000,  24576000,  0x0d20},\n\t{26000000,  24576000,  0x2027},\n\t{26000000,  22579200,  0x392f},\n\t{24576000,  22579200,  0x0921},\n\t{24576000,  24576000,  0x02a0},\n};\n\nstatic const struct pll_div codec_slave_pll_div[] = {\n\t{256000,  2048000,  0x46f0},\n\t{256000,  4096000,  0x3ea0},\n\t{352800,  5644800,  0x3ea0},\n\t{512000,  8192000,  0x3ea0},\n\t{1024000,  8192000,  0x46f0},\n\t{705600,  11289600,  0x3ea0},\n\t{1024000,  16384000,  0x3ea0},\n\t{1411200,  22579200,  0x3ea0},\n\t{1536000,  24576000,  0x3ea0},\n\t{2048000,  16384000,  0x1ea0},\n\t{2822400,  22579200,  0x1ea0},\n\t{2822400,  45158400,  0x5ec0},\n\t{5644800,  45158400,  0x46f0},\n\t{3072000,  24576000,  0x1ea0},\n\t{3072000,  49152000,  0x5ec0},\n\t{6144000,  49152000,  0x46f0},\n\t{705600,  11289600,  0x3ea0},\n\t{705600,  8467200,  0x3ab0},\n\t{24576000,  24576000,  0x02a0},\n\t{1411200,  11289600,  0x1690},\n\t{2822400,  11289600,  0x0a90},\n\t{1536000,  12288000,  0x1690},\n\t{3072000,  12288000,  0x0a90},\n};\n\nstatic const struct coeff_clk_div coeff_div[] = {\n\t \n\t{2048000,  8000 * 32,  8000, 0x1000},\n\t{2048000,  8000 * 64,  8000, 0x0000},\n\t{2822400,  11025 * 32,  11025,  0x1000},\n\t{2822400,  11025 * 64,  11025,  0x0000},\n\t{4096000,  16000 * 32,  16000,  0x1000},\n\t{4096000,  16000 * 64,  16000,  0x0000},\n\t{5644800,  22050 * 32,  22050,  0x1000},\n\t{5644800,  22050 * 64,  22050,  0x0000},\n\t{8192000,  32000 * 32,  32000,  0x1000},\n\t{8192000,  32000 * 64,  32000,  0x0000},\n\t{11289600,  44100 * 32,  44100,  0x1000},\n\t{11289600,  44100 * 64,  44100,  0x0000},\n\t{12288000,  48000 * 32,  48000,  0x1000},\n\t{12288000,  48000 * 64,  48000,  0x0000},\n\t{22579200,  88200 * 32,  88200,  0x1000},\n\t{22579200,  88200 * 64,  88200,  0x0000},\n\t{24576000,  96000 * 32,  96000,  0x1000},\n\t{24576000,  96000 * 64,  96000,  0x0000},\n\t \n\t{4096000,  8000 * 32,  8000, 0x3000},\n\t{4096000,  8000 * 64,  8000, 0x2000},\n\t{5644800,  11025 * 32,  11025, 0x3000},\n\t{5644800,  11025 * 64,  11025, 0x2000},\n\t{8192000,  16000 * 32,  16000, 0x3000},\n\t{8192000,  16000 * 64,  16000, 0x2000},\n\t{11289600,  22050 * 32,  22050, 0x3000},\n\t{11289600,  22050 * 64,  22050, 0x2000},\n\t{16384000,  32000 * 32,  32000, 0x3000},\n\t{16384000,  32000 * 64,  32000, 0x2000},\n\t{22579200,  44100 * 32,  44100, 0x3000},\n\t{22579200,  44100 * 64,  44100, 0x2000},\n\t{24576000,  48000 * 32,  48000, 0x3000},\n\t{24576000,  48000 * 64,  48000, 0x2000},\n\t{45158400,  88200 * 32,  88200, 0x3000},\n\t{45158400,  88200 * 64,  88200, 0x2000},\n\t{49152000,  96000 * 32,  96000, 0x3000},\n\t{49152000,  96000 * 64,  96000, 0x2000},\n\t \n\t{24576000,  8000 * 32,  8000,  0x7080},\n\t{24576000,  8000 * 64,  8000,  0x6080},\n\t{24576000,  16000 * 32,  16000,  0x5080},\n\t{24576000,  16000 * 64,  16000,  0x4080},\n\t{24576000,  24000 * 32,  24000,  0x5000},\n\t{24576000,  24000 * 64,  24000,  0x4000},\n\t{24576000,  32000 * 32,  32000,  0x3080},\n\t{24576000,  32000 * 64,  32000,  0x2080},\n\t{22579200,  11025 * 32,  11025,  0x7000},\n\t{22579200,  11025 * 64,  11025,  0x6000},\n\t{22579200,  22050 * 32,  22050,  0x5000},\n\t{22579200,  22050 * 64,  22050,  0x4000},\n};\n\nstatic int get_coeff(int mclk, int rate, int timesofbclk)\n{\n\tint i;\n\n\tfor (i = 0; i < ARRAY_SIZE(coeff_div); i++) {\n\t\tif (coeff_div[i].mclk == mclk && coeff_div[i].rate == rate &&\n\t\t\t(coeff_div[i].bclk / coeff_div[i].rate) == timesofbclk)\n\t\t\treturn i;\n\t}\n\treturn -EINVAL;\n}\n\nstatic int rt5631_hifi_pcm_params(struct snd_pcm_substream *substream,\n\t\tstruct snd_pcm_hw_params *params, struct snd_soc_dai *dai)\n{\n\tstruct snd_soc_component *component = dai->component;\n\tstruct rt5631_priv *rt5631 = snd_soc_component_get_drvdata(component);\n\tint timesofbclk = 32, coeff;\n\tunsigned int iface = 0;\n\n\tdev_dbg(component->dev, \"enter %s\\n\", __func__);\n\n\trt5631->bclk_rate = snd_soc_params_to_bclk(params);\n\tif (rt5631->bclk_rate < 0) {\n\t\tdev_err(component->dev, \"Fail to get BCLK rate\\n\");\n\t\treturn rt5631->bclk_rate;\n\t}\n\trt5631->rx_rate = params_rate(params);\n\n\tif (rt5631->master)\n\t\tcoeff = get_coeff(rt5631->sysclk, rt5631->rx_rate,\n\t\t\trt5631->bclk_rate / rt5631->rx_rate);\n\telse\n\t\tcoeff = get_coeff(rt5631->sysclk, rt5631->rx_rate,\n\t\t\t\t\ttimesofbclk);\n\tif (coeff < 0) {\n\t\tdev_err(component->dev, \"Fail to get coeff\\n\");\n\t\treturn coeff;\n\t}\n\n\tswitch (params_width(params)) {\n\tcase 16:\n\t\tbreak;\n\tcase 20:\n\t\tiface |= RT5631_SDP_I2S_DL_20;\n\t\tbreak;\n\tcase 24:\n\t\tiface |= RT5631_SDP_I2S_DL_24;\n\t\tbreak;\n\tcase 8:\n\t\tiface |= RT5631_SDP_I2S_DL_8;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tsnd_soc_component_update_bits(component, RT5631_SDP_CTRL,\n\t\tRT5631_SDP_I2S_DL_MASK, iface);\n\tsnd_soc_component_write(component, RT5631_STEREO_AD_DA_CLK_CTRL,\n\t\t\t\t\tcoeff_div[coeff].reg_val);\n\n\treturn 0;\n}\n\nstatic int rt5631_hifi_codec_set_dai_fmt(struct snd_soc_dai *codec_dai,\n\t\t\t\t\t\tunsigned int fmt)\n{\n\tstruct snd_soc_component *component = codec_dai->component;\n\tstruct rt5631_priv *rt5631 = snd_soc_component_get_drvdata(component);\n\tunsigned int iface = 0;\n\n\tdev_dbg(component->dev, \"enter %s\\n\", __func__);\n\n\tswitch (fmt & SND_SOC_DAIFMT_MASTER_MASK) {\n\tcase SND_SOC_DAIFMT_CBM_CFM:\n\t\trt5631->master = 1;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_CBS_CFS:\n\t\tiface |= RT5631_SDP_MODE_SEL_SLAVE;\n\t\trt5631->master = 0;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tswitch (fmt & SND_SOC_DAIFMT_FORMAT_MASK) {\n\tcase SND_SOC_DAIFMT_I2S:\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_LEFT_J:\n\t\tiface |= RT5631_SDP_I2S_DF_LEFT;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_DSP_A:\n\t\tiface |= RT5631_SDP_I2S_DF_PCM_A;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_DSP_B:\n\t\tiface  |= RT5631_SDP_I2S_DF_PCM_B;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tswitch (fmt & SND_SOC_DAIFMT_INV_MASK) {\n\tcase SND_SOC_DAIFMT_NB_NF:\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_IB_NF:\n\t\tiface |= RT5631_SDP_I2S_BCLK_POL_CTRL;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tsnd_soc_component_write(component, RT5631_SDP_CTRL, iface);\n\n\treturn 0;\n}\n\nstatic int rt5631_hifi_codec_set_dai_sysclk(struct snd_soc_dai *codec_dai,\n\t\t\t\tint clk_id, unsigned int freq, int dir)\n{\n\tstruct snd_soc_component *component = codec_dai->component;\n\tstruct rt5631_priv *rt5631 = snd_soc_component_get_drvdata(component);\n\n\tdev_dbg(component->dev, \"enter %s, syclk=%d\\n\", __func__, freq);\n\n\tif ((freq >= (256 * 8000)) && (freq <= (512 * 96000))) {\n\t\trt5631->sysclk = freq;\n\t\treturn 0;\n\t}\n\n\treturn -EINVAL;\n}\n\nstatic int rt5631_codec_set_dai_pll(struct snd_soc_dai *codec_dai, int pll_id,\n\t\tint source, unsigned int freq_in, unsigned int freq_out)\n{\n\tstruct snd_soc_component *component = codec_dai->component;\n\tstruct rt5631_priv *rt5631 = snd_soc_component_get_drvdata(component);\n\tint i, ret = -EINVAL;\n\n\tdev_dbg(component->dev, \"enter %s\\n\", __func__);\n\n\tif (!freq_in || !freq_out) {\n\t\tdev_dbg(component->dev, \"PLL disabled\\n\");\n\n\t\tsnd_soc_component_update_bits(component, RT5631_GLOBAL_CLK_CTRL,\n\t\t\tRT5631_SYSCLK_SOUR_SEL_MASK,\n\t\t\tRT5631_SYSCLK_SOUR_SEL_MCLK);\n\n\t\treturn 0;\n\t}\n\n\tif (rt5631->master) {\n\t\tfor (i = 0; i < ARRAY_SIZE(codec_master_pll_div); i++)\n\t\t\tif (freq_in == codec_master_pll_div[i].pll_in &&\n\t\t\tfreq_out == codec_master_pll_div[i].pll_out) {\n\t\t\t\tdev_info(component->dev,\n\t\t\t\t\t\"change PLL in master mode\\n\");\n\t\t\t\tsnd_soc_component_write(component, RT5631_PLL_CTRL,\n\t\t\t\t\tcodec_master_pll_div[i].reg_val);\n\t\t\t\tschedule_timeout_uninterruptible(\n\t\t\t\t\tmsecs_to_jiffies(20));\n\t\t\t\tsnd_soc_component_update_bits(component,\n\t\t\t\t\tRT5631_GLOBAL_CLK_CTRL,\n\t\t\t\t\tRT5631_SYSCLK_SOUR_SEL_MASK |\n\t\t\t\t\tRT5631_PLLCLK_SOUR_SEL_MASK,\n\t\t\t\t\tRT5631_SYSCLK_SOUR_SEL_PLL |\n\t\t\t\t\tRT5631_PLLCLK_SOUR_SEL_MCLK);\n\t\t\t\tret = 0;\n\t\t\t\tbreak;\n\t\t\t}\n\t} else {\n\t\tfor (i = 0; i < ARRAY_SIZE(codec_slave_pll_div); i++)\n\t\t\tif (freq_in == codec_slave_pll_div[i].pll_in &&\n\t\t\tfreq_out == codec_slave_pll_div[i].pll_out) {\n\t\t\t\tdev_info(component->dev,\n\t\t\t\t\t\"change PLL in slave mode\\n\");\n\t\t\t\tsnd_soc_component_write(component, RT5631_PLL_CTRL,\n\t\t\t\t\tcodec_slave_pll_div[i].reg_val);\n\t\t\t\tschedule_timeout_uninterruptible(\n\t\t\t\t\tmsecs_to_jiffies(20));\n\t\t\t\tsnd_soc_component_update_bits(component,\n\t\t\t\t\tRT5631_GLOBAL_CLK_CTRL,\n\t\t\t\t\tRT5631_SYSCLK_SOUR_SEL_MASK |\n\t\t\t\t\tRT5631_PLLCLK_SOUR_SEL_MASK,\n\t\t\t\t\tRT5631_SYSCLK_SOUR_SEL_PLL |\n\t\t\t\t\tRT5631_PLLCLK_SOUR_SEL_BCLK);\n\t\t\t\tret = 0;\n\t\t\t\tbreak;\n\t\t\t}\n\t}\n\n\treturn ret;\n}\n\nstatic int rt5631_set_bias_level(struct snd_soc_component *component,\n\t\t\tenum snd_soc_bias_level level)\n{\n\tstruct rt5631_priv *rt5631 = snd_soc_component_get_drvdata(component);\n\n\tswitch (level) {\n\tcase SND_SOC_BIAS_ON:\n\tcase SND_SOC_BIAS_PREPARE:\n\t\tsnd_soc_component_update_bits(component, RT5631_PWR_MANAG_ADD2,\n\t\t\tRT5631_PWR_MICBIAS1_VOL | RT5631_PWR_MICBIAS2_VOL,\n\t\t\tRT5631_PWR_MICBIAS1_VOL | RT5631_PWR_MICBIAS2_VOL);\n\t\tbreak;\n\n\tcase SND_SOC_BIAS_STANDBY:\n\t\tif (snd_soc_component_get_bias_level(component) == SND_SOC_BIAS_OFF) {\n\t\t\tsnd_soc_component_update_bits(component, RT5631_PWR_MANAG_ADD3,\n\t\t\t\tRT5631_PWR_VREF | RT5631_PWR_MAIN_BIAS,\n\t\t\t\tRT5631_PWR_VREF | RT5631_PWR_MAIN_BIAS);\n\t\t\tmsleep(80);\n\t\t\tsnd_soc_component_update_bits(component, RT5631_PWR_MANAG_ADD3,\n\t\t\t\tRT5631_PWR_FAST_VREF_CTRL,\n\t\t\t\tRT5631_PWR_FAST_VREF_CTRL);\n\t\t\tregcache_cache_only(rt5631->regmap, false);\n\t\t\tregcache_sync(rt5631->regmap);\n\t\t}\n\t\tbreak;\n\n\tcase SND_SOC_BIAS_OFF:\n\t\tsnd_soc_component_write(component, RT5631_PWR_MANAG_ADD1, 0x0000);\n\t\tsnd_soc_component_write(component, RT5631_PWR_MANAG_ADD2, 0x0000);\n\t\tsnd_soc_component_write(component, RT5631_PWR_MANAG_ADD3, 0x0000);\n\t\tsnd_soc_component_write(component, RT5631_PWR_MANAG_ADD4, 0x0000);\n\t\tbreak;\n\n\tdefault:\n\t\tbreak;\n\t}\n\n\treturn 0;\n}\n\nstatic int rt5631_probe(struct snd_soc_component *component)\n{\n\tstruct rt5631_priv *rt5631 = snd_soc_component_get_drvdata(component);\n\tunsigned int val;\n\n\tval = rt5631_read_index(component, RT5631_ADDA_MIXER_INTL_REG3);\n\tif (val & 0x0002)\n\t\trt5631->codec_version = 1;\n\telse\n\t\trt5631->codec_version = 0;\n\n\trt5631_reset(component);\n\tsnd_soc_component_update_bits(component, RT5631_PWR_MANAG_ADD3,\n\t\tRT5631_PWR_VREF | RT5631_PWR_MAIN_BIAS,\n\t\tRT5631_PWR_VREF | RT5631_PWR_MAIN_BIAS);\n\tmsleep(80);\n\tsnd_soc_component_update_bits(component, RT5631_PWR_MANAG_ADD3,\n\t\tRT5631_PWR_FAST_VREF_CTRL, RT5631_PWR_FAST_VREF_CTRL);\n\t \n\tsnd_soc_component_write(component, RT5631_INT_ST_IRQ_CTRL_2, 0x0f18);\n\t \n\tif (rt5631->codec_version)\n\t\tsnd_soc_component_update_bits(component, RT5631_INT_ST_IRQ_CTRL_2,\n\t\t\t\t\t0x2000, 0x2000);\n\telse\n\t\tsnd_soc_component_update_bits(component, RT5631_INT_ST_IRQ_CTRL_2,\n\t\t\t\t\t0x2000, 0);\n\t \n\tif (rt5631->dmic_used_flag) {\n\t\tsnd_soc_component_update_bits(component, RT5631_GPIO_CTRL,\n\t\t\tRT5631_GPIO_PIN_FUN_SEL_MASK |\n\t\t\tRT5631_GPIO_DMIC_FUN_SEL_MASK,\n\t\t\tRT5631_GPIO_PIN_FUN_SEL_GPIO_DIMC |\n\t\t\tRT5631_GPIO_DMIC_FUN_SEL_DIMC);\n\t\tsnd_soc_component_update_bits(component, RT5631_DIG_MIC_CTRL,\n\t\t\tRT5631_DMIC_L_CH_LATCH_MASK |\n\t\t\tRT5631_DMIC_R_CH_LATCH_MASK,\n\t\t\tRT5631_DMIC_L_CH_LATCH_FALLING |\n\t\t\tRT5631_DMIC_R_CH_LATCH_RISING);\n\t}\n\n\tsnd_soc_component_init_bias_level(component, SND_SOC_BIAS_STANDBY);\n\n\treturn 0;\n}\n\n#define RT5631_STEREO_RATES SNDRV_PCM_RATE_8000_96000\n#define RT5631_FORMAT\t(SNDRV_PCM_FMTBIT_S16_LE | \\\n\t\t\tSNDRV_PCM_FMTBIT_S20_3LE | \\\n\t\t\tSNDRV_PCM_FMTBIT_S24_LE | \\\n\t\t\tSNDRV_PCM_FMTBIT_S8)\n\nstatic const struct snd_soc_dai_ops rt5631_ops = {\n\t.hw_params = rt5631_hifi_pcm_params,\n\t.set_fmt = rt5631_hifi_codec_set_dai_fmt,\n\t.set_sysclk = rt5631_hifi_codec_set_dai_sysclk,\n\t.set_pll = rt5631_codec_set_dai_pll,\n};\n\nstatic struct snd_soc_dai_driver rt5631_dai[] = {\n\t{\n\t\t.name = \"rt5631-hifi\",\n\t\t.id = 1,\n\t\t.playback = {\n\t\t\t.stream_name = \"HIFI Playback\",\n\t\t\t.channels_min = 1,\n\t\t\t.channels_max = 2,\n\t\t\t.rates = RT5631_STEREO_RATES,\n\t\t\t.formats = RT5631_FORMAT,\n\t\t},\n\t\t.capture = {\n\t\t\t.stream_name = \"HIFI Capture\",\n\t\t\t.channels_min = 1,\n\t\t\t.channels_max = 2,\n\t\t\t.rates = RT5631_STEREO_RATES,\n\t\t\t.formats = RT5631_FORMAT,\n\t\t},\n\t\t.ops = &rt5631_ops,\n\t},\n};\n\nstatic const struct snd_soc_component_driver soc_component_dev_rt5631 = {\n\t.probe\t\t\t= rt5631_probe,\n\t.set_bias_level\t\t= rt5631_set_bias_level,\n\t.controls\t\t= rt5631_snd_controls,\n\t.num_controls\t\t= ARRAY_SIZE(rt5631_snd_controls),\n\t.dapm_widgets\t\t= rt5631_dapm_widgets,\n\t.num_dapm_widgets\t= ARRAY_SIZE(rt5631_dapm_widgets),\n\t.dapm_routes\t\t= rt5631_dapm_routes,\n\t.num_dapm_routes\t= ARRAY_SIZE(rt5631_dapm_routes),\n\t.suspend_bias_off\t= 1,\n\t.idle_bias_on\t\t= 1,\n\t.use_pmdown_time\t= 1,\n\t.endianness\t\t= 1,\n};\n\nstatic const struct i2c_device_id rt5631_i2c_id[] = {\n\t{ \"rt5631\", 0 },\n\t{ \"alc5631\", 0 },\n\t{ }\n};\nMODULE_DEVICE_TABLE(i2c, rt5631_i2c_id);\n\n#ifdef CONFIG_OF\nstatic const struct of_device_id rt5631_i2c_dt_ids[] = {\n\t{ .compatible = \"realtek,rt5631\"},\n\t{ .compatible = \"realtek,alc5631\"},\n\t{ }\n};\nMODULE_DEVICE_TABLE(of, rt5631_i2c_dt_ids);\n#endif\n\nstatic const struct regmap_config rt5631_regmap_config = {\n\t.reg_bits = 8,\n\t.val_bits = 16,\n\n\t.readable_reg = rt5631_readable_register,\n\t.volatile_reg = rt5631_volatile_register,\n\t.max_register = RT5631_VENDOR_ID2,\n\t.reg_defaults = rt5631_reg,\n\t.num_reg_defaults = ARRAY_SIZE(rt5631_reg),\n\t.cache_type = REGCACHE_MAPLE,\n\t.use_single_read = true,\n\t.use_single_write = true,\n};\n\nstatic int rt5631_i2c_probe(struct i2c_client *i2c)\n{\n\tstruct rt5631_priv *rt5631;\n\tint ret;\n\n\trt5631 = devm_kzalloc(&i2c->dev, sizeof(struct rt5631_priv),\n\t\t\t      GFP_KERNEL);\n\tif (NULL == rt5631)\n\t\treturn -ENOMEM;\n\n\ti2c_set_clientdata(i2c, rt5631);\n\n\trt5631->regmap = devm_regmap_init_i2c(i2c, &rt5631_regmap_config);\n\tif (IS_ERR(rt5631->regmap))\n\t\treturn PTR_ERR(rt5631->regmap);\n\n\tret = devm_snd_soc_register_component(&i2c->dev,\n\t\t\t&soc_component_dev_rt5631,\n\t\t\trt5631_dai, ARRAY_SIZE(rt5631_dai));\n\treturn ret;\n}\n\nstatic void rt5631_i2c_remove(struct i2c_client *client)\n{}\n\nstatic struct i2c_driver rt5631_i2c_driver = {\n\t.driver = {\n\t\t.name = \"rt5631\",\n\t\t.of_match_table = of_match_ptr(rt5631_i2c_dt_ids),\n\t},\n\t.probe    = rt5631_i2c_probe,\n\t.remove   = rt5631_i2c_remove,\n\t.id_table = rt5631_i2c_id,\n};\n\nmodule_i2c_driver(rt5631_i2c_driver);\n\nMODULE_DESCRIPTION(\"ASoC RT5631 driver\");\nMODULE_AUTHOR(\"flove <flove@realtek.com>\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}