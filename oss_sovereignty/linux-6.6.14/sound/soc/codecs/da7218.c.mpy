{
  "module_name": "da7218.c",
  "hash_id": "c9b300e0f852758694960a06df300071725a7e1039bc7f15a976f6c13f66848c",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/codecs/da7218.c",
  "human_readable_source": "\n \n\n#include <linux/clk.h>\n#include <linux/i2c.h>\n#include <linux/of_device.h>\n#include <linux/regmap.h>\n#include <linux/slab.h>\n#include <linux/pm.h>\n#include <linux/module.h>\n#include <linux/delay.h>\n#include <linux/regulator/consumer.h>\n#include <sound/pcm.h>\n#include <sound/pcm_params.h>\n#include <sound/soc.h>\n#include <sound/soc-dapm.h>\n#include <sound/jack.h>\n#include <sound/initval.h>\n#include <sound/tlv.h>\n#include <asm/div64.h>\n\n#include <sound/da7218.h>\n#include \"da7218.h\"\n\n\n \n\n \nstatic const DECLARE_TLV_DB_SCALE(da7218_mic_gain_tlv, -600, 600, 0);\nstatic const DECLARE_TLV_DB_SCALE(da7218_mixin_gain_tlv, -450, 150, 0);\nstatic const DECLARE_TLV_DB_SCALE(da7218_in_dig_gain_tlv, -8325, 75, 0);\nstatic const DECLARE_TLV_DB_SCALE(da7218_ags_trigger_tlv, -9000, 600, 0);\nstatic const DECLARE_TLV_DB_SCALE(da7218_ags_att_max_tlv, 0, 600, 0);\nstatic const DECLARE_TLV_DB_SCALE(da7218_alc_threshold_tlv, -9450, 150, 0);\nstatic const DECLARE_TLV_DB_SCALE(da7218_alc_gain_tlv, 0, 600, 0);\nstatic const DECLARE_TLV_DB_SCALE(da7218_alc_ana_gain_tlv, 0, 600, 0);\n\n \nstatic const DECLARE_TLV_DB_SCALE(da7218_dmix_gain_tlv, -4200, 150, 0);\n\n \nstatic const DECLARE_TLV_DB_SCALE(da7218_dgs_trigger_tlv, -9450, 150, 0);\nstatic const DECLARE_TLV_DB_SCALE(da7218_dgs_anticlip_tlv, -4200, 600, 0);\nstatic const DECLARE_TLV_DB_SCALE(da7218_dgs_signal_tlv, -9000, 600, 0);\nstatic const DECLARE_TLV_DB_SCALE(da7218_out_eq_band_tlv, -1050, 150, 0);\nstatic const DECLARE_TLV_DB_SCALE(da7218_out_dig_gain_tlv, -8325, 75, 0);\nstatic const DECLARE_TLV_DB_SCALE(da7218_dac_ng_threshold_tlv, -10200, 600, 0);\nstatic const DECLARE_TLV_DB_SCALE(da7218_mixout_gain_tlv, -100, 50, 0);\nstatic const DECLARE_TLV_DB_SCALE(da7218_hp_gain_tlv, -5700, 150, 0);\n\n \nstatic const char * const da7218_alc_attack_rate_txt[] = {\n\t\"7.33/fs\", \"14.66/fs\", \"29.32/fs\", \"58.64/fs\", \"117.3/fs\", \"234.6/fs\",\n\t\"469.1/fs\", \"938.2/fs\", \"1876/fs\", \"3753/fs\", \"7506/fs\", \"15012/fs\",\n\t\"30024/fs\",\n};\n\nstatic const struct soc_enum da7218_alc_attack_rate =\n\tSOC_ENUM_SINGLE(DA7218_ALC_CTRL2, DA7218_ALC_ATTACK_SHIFT,\n\t\t\tDA7218_ALC_ATTACK_MAX, da7218_alc_attack_rate_txt);\n\nstatic const char * const da7218_alc_release_rate_txt[] = {\n\t\"28.66/fs\", \"57.33/fs\", \"114.6/fs\", \"229.3/fs\", \"458.6/fs\", \"917.1/fs\",\n\t\"1834/fs\", \"3668/fs\", \"7337/fs\", \"14674/fs\", \"29348/fs\",\n};\n\nstatic const struct soc_enum da7218_alc_release_rate =\n\tSOC_ENUM_SINGLE(DA7218_ALC_CTRL2, DA7218_ALC_RELEASE_SHIFT,\n\t\t\tDA7218_ALC_RELEASE_MAX, da7218_alc_release_rate_txt);\n\nstatic const char * const da7218_alc_hold_time_txt[] = {\n\t\"62/fs\", \"124/fs\", \"248/fs\", \"496/fs\", \"992/fs\", \"1984/fs\", \"3968/fs\",\n\t\"7936/fs\", \"15872/fs\", \"31744/fs\", \"63488/fs\", \"126976/fs\",\n\t\"253952/fs\", \"507904/fs\", \"1015808/fs\", \"2031616/fs\"\n};\n\nstatic const struct soc_enum da7218_alc_hold_time =\n\tSOC_ENUM_SINGLE(DA7218_ALC_CTRL3, DA7218_ALC_HOLD_SHIFT,\n\t\t\tDA7218_ALC_HOLD_MAX, da7218_alc_hold_time_txt);\n\nstatic const char * const da7218_alc_anticlip_step_txt[] = {\n\t\"0.034dB/fs\", \"0.068dB/fs\", \"0.136dB/fs\", \"0.272dB/fs\",\n};\n\nstatic const struct soc_enum da7218_alc_anticlip_step =\n\tSOC_ENUM_SINGLE(DA7218_ALC_ANTICLIP_CTRL,\n\t\t\tDA7218_ALC_ANTICLIP_STEP_SHIFT,\n\t\t\tDA7218_ALC_ANTICLIP_STEP_MAX,\n\t\t\tda7218_alc_anticlip_step_txt);\n\nstatic const char * const da7218_integ_rate_txt[] = {\n\t\"1/4\", \"1/16\", \"1/256\", \"1/65536\"\n};\n\nstatic const struct soc_enum da7218_integ_attack_rate =\n\tSOC_ENUM_SINGLE(DA7218_ENV_TRACK_CTRL, DA7218_INTEG_ATTACK_SHIFT,\n\t\t\tDA7218_INTEG_MAX, da7218_integ_rate_txt);\n\nstatic const struct soc_enum da7218_integ_release_rate =\n\tSOC_ENUM_SINGLE(DA7218_ENV_TRACK_CTRL, DA7218_INTEG_RELEASE_SHIFT,\n\t\t\tDA7218_INTEG_MAX, da7218_integ_rate_txt);\n\n \nstatic const char * const da7218_gain_ramp_rate_txt[] = {\n\t\"Nominal Rate * 8\", \"Nominal Rate\", \"Nominal Rate / 8\",\n\t\"Nominal Rate / 16\",\n};\n\nstatic const struct soc_enum da7218_gain_ramp_rate =\n\tSOC_ENUM_SINGLE(DA7218_GAIN_RAMP_CTRL, DA7218_GAIN_RAMP_RATE_SHIFT,\n\t\t\tDA7218_GAIN_RAMP_RATE_MAX, da7218_gain_ramp_rate_txt);\n\nstatic const char * const da7218_hpf_mode_txt[] = {\n\t\"Disabled\", \"Audio\", \"Voice\",\n};\n\nstatic const unsigned int da7218_hpf_mode_val[] = {\n\tDA7218_HPF_DISABLED, DA7218_HPF_AUDIO_EN, DA7218_HPF_VOICE_EN,\n};\n\nstatic const struct soc_enum da7218_in1_hpf_mode =\n\tSOC_VALUE_ENUM_SINGLE(DA7218_IN_1_HPF_FILTER_CTRL,\n\t\t\t      DA7218_HPF_MODE_SHIFT, DA7218_HPF_MODE_MASK,\n\t\t\t      DA7218_HPF_MODE_MAX, da7218_hpf_mode_txt,\n\t\t\t      da7218_hpf_mode_val);\n\nstatic const struct soc_enum da7218_in2_hpf_mode =\n\tSOC_VALUE_ENUM_SINGLE(DA7218_IN_2_HPF_FILTER_CTRL,\n\t\t\t      DA7218_HPF_MODE_SHIFT, DA7218_HPF_MODE_MASK,\n\t\t\t      DA7218_HPF_MODE_MAX, da7218_hpf_mode_txt,\n\t\t\t      da7218_hpf_mode_val);\n\nstatic const struct soc_enum da7218_out1_hpf_mode =\n\tSOC_VALUE_ENUM_SINGLE(DA7218_OUT_1_HPF_FILTER_CTRL,\n\t\t\t      DA7218_HPF_MODE_SHIFT, DA7218_HPF_MODE_MASK,\n\t\t\t      DA7218_HPF_MODE_MAX, da7218_hpf_mode_txt,\n\t\t\t      da7218_hpf_mode_val);\n\nstatic const char * const da7218_audio_hpf_corner_txt[] = {\n\t\"2Hz\", \"4Hz\", \"8Hz\", \"16Hz\",\n};\n\nstatic const struct soc_enum da7218_in1_audio_hpf_corner =\n\tSOC_ENUM_SINGLE(DA7218_IN_1_HPF_FILTER_CTRL,\n\t\t\tDA7218_IN_1_AUDIO_HPF_CORNER_SHIFT,\n\t\t\tDA7218_AUDIO_HPF_CORNER_MAX,\n\t\t\tda7218_audio_hpf_corner_txt);\n\nstatic const struct soc_enum da7218_in2_audio_hpf_corner =\n\tSOC_ENUM_SINGLE(DA7218_IN_2_HPF_FILTER_CTRL,\n\t\t\tDA7218_IN_2_AUDIO_HPF_CORNER_SHIFT,\n\t\t\tDA7218_AUDIO_HPF_CORNER_MAX,\n\t\t\tda7218_audio_hpf_corner_txt);\n\nstatic const struct soc_enum da7218_out1_audio_hpf_corner =\n\tSOC_ENUM_SINGLE(DA7218_OUT_1_HPF_FILTER_CTRL,\n\t\t\tDA7218_OUT_1_AUDIO_HPF_CORNER_SHIFT,\n\t\t\tDA7218_AUDIO_HPF_CORNER_MAX,\n\t\t\tda7218_audio_hpf_corner_txt);\n\nstatic const char * const da7218_voice_hpf_corner_txt[] = {\n\t\"2.5Hz\", \"25Hz\", \"50Hz\", \"100Hz\", \"150Hz\", \"200Hz\", \"300Hz\", \"400Hz\",\n};\n\nstatic const struct soc_enum da7218_in1_voice_hpf_corner =\n\tSOC_ENUM_SINGLE(DA7218_IN_1_HPF_FILTER_CTRL,\n\t\t\tDA7218_IN_1_VOICE_HPF_CORNER_SHIFT,\n\t\t\tDA7218_VOICE_HPF_CORNER_MAX,\n\t\t\tda7218_voice_hpf_corner_txt);\n\nstatic const struct soc_enum da7218_in2_voice_hpf_corner =\n\tSOC_ENUM_SINGLE(DA7218_IN_2_HPF_FILTER_CTRL,\n\t\t\tDA7218_IN_2_VOICE_HPF_CORNER_SHIFT,\n\t\t\tDA7218_VOICE_HPF_CORNER_MAX,\n\t\t\tda7218_voice_hpf_corner_txt);\n\nstatic const struct soc_enum da7218_out1_voice_hpf_corner =\n\tSOC_ENUM_SINGLE(DA7218_OUT_1_HPF_FILTER_CTRL,\n\t\t\tDA7218_OUT_1_VOICE_HPF_CORNER_SHIFT,\n\t\t\tDA7218_VOICE_HPF_CORNER_MAX,\n\t\t\tda7218_voice_hpf_corner_txt);\n\nstatic const char * const da7218_tonegen_dtmf_key_txt[] = {\n\t\"0\", \"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\", \"A\", \"B\", \"C\", \"D\",\n\t\"*\", \"#\"\n};\n\nstatic const struct soc_enum da7218_tonegen_dtmf_key =\n\tSOC_ENUM_SINGLE(DA7218_TONE_GEN_CFG1, DA7218_DTMF_REG_SHIFT,\n\t\t\tDA7218_DTMF_REG_MAX, da7218_tonegen_dtmf_key_txt);\n\nstatic const char * const da7218_tonegen_swg_sel_txt[] = {\n\t\"Sum\", \"SWG1\", \"SWG2\", \"SWG1_1-Cos\"\n};\n\nstatic const struct soc_enum da7218_tonegen_swg_sel =\n\tSOC_ENUM_SINGLE(DA7218_TONE_GEN_CFG2, DA7218_SWG_SEL_SHIFT,\n\t\t\tDA7218_SWG_SEL_MAX, da7218_tonegen_swg_sel_txt);\n\n \nstatic const char * const da7218_dgs_rise_coeff_txt[] = {\n\t\"1/1\", \"1/16\", \"1/64\", \"1/256\", \"1/1024\", \"1/4096\", \"1/16384\",\n};\n\nstatic const struct soc_enum da7218_dgs_rise_coeff =\n\tSOC_ENUM_SINGLE(DA7218_DGS_RISE_FALL, DA7218_DGS_RISE_COEFF_SHIFT,\n\t\t\tDA7218_DGS_RISE_COEFF_MAX, da7218_dgs_rise_coeff_txt);\n\nstatic const char * const da7218_dgs_fall_coeff_txt[] = {\n\t\"1/4\", \"1/16\", \"1/64\", \"1/256\", \"1/1024\", \"1/4096\", \"1/16384\", \"1/65536\",\n};\n\nstatic const struct soc_enum da7218_dgs_fall_coeff =\n\tSOC_ENUM_SINGLE(DA7218_DGS_RISE_FALL, DA7218_DGS_FALL_COEFF_SHIFT,\n\t\t\tDA7218_DGS_FALL_COEFF_MAX, da7218_dgs_fall_coeff_txt);\n\nstatic const char * const da7218_dac_ng_setup_time_txt[] = {\n\t\"256 Samples\", \"512 Samples\", \"1024 Samples\", \"2048 Samples\"\n};\n\nstatic const struct soc_enum da7218_dac_ng_setup_time =\n\tSOC_ENUM_SINGLE(DA7218_DAC_NG_SETUP_TIME,\n\t\t\tDA7218_DAC_NG_SETUP_TIME_SHIFT,\n\t\t\tDA7218_DAC_NG_SETUP_TIME_MAX,\n\t\t\tda7218_dac_ng_setup_time_txt);\n\nstatic const char * const da7218_dac_ng_rampup_txt[] = {\n\t\"0.22ms/dB\", \"0.0138ms/dB\"\n};\n\nstatic const struct soc_enum da7218_dac_ng_rampup_rate =\n\tSOC_ENUM_SINGLE(DA7218_DAC_NG_SETUP_TIME,\n\t\t\tDA7218_DAC_NG_RAMPUP_RATE_SHIFT,\n\t\t\tDA7218_DAC_NG_RAMPUP_RATE_MAX,\n\t\t\tda7218_dac_ng_rampup_txt);\n\nstatic const char * const da7218_dac_ng_rampdown_txt[] = {\n\t\"0.88ms/dB\", \"14.08ms/dB\"\n};\n\nstatic const struct soc_enum da7218_dac_ng_rampdown_rate =\n\tSOC_ENUM_SINGLE(DA7218_DAC_NG_SETUP_TIME,\n\t\t\tDA7218_DAC_NG_RAMPDN_RATE_SHIFT,\n\t\t\tDA7218_DAC_NG_RAMPDN_RATE_MAX,\n\t\t\tda7218_dac_ng_rampdown_txt);\n\nstatic const char * const da7218_cp_mchange_txt[] = {\n\t\"Largest Volume\", \"DAC Volume\", \"Signal Magnitude\"\n};\n\nstatic const unsigned int da7218_cp_mchange_val[] = {\n\tDA7218_CP_MCHANGE_LARGEST_VOL, DA7218_CP_MCHANGE_DAC_VOL,\n\tDA7218_CP_MCHANGE_SIG_MAG\n};\n\nstatic const struct soc_enum da7218_cp_mchange =\n\tSOC_VALUE_ENUM_SINGLE(DA7218_CP_CTRL, DA7218_CP_MCHANGE_SHIFT,\n\t\t\t      DA7218_CP_MCHANGE_REL_MASK, DA7218_CP_MCHANGE_MAX,\n\t\t\t      da7218_cp_mchange_txt, da7218_cp_mchange_val);\n\nstatic const char * const da7218_cp_fcontrol_txt[] = {\n\t\"1MHz\", \"500KHz\", \"250KHz\", \"125KHz\", \"63KHz\", \"0KHz\"\n};\n\nstatic const struct soc_enum da7218_cp_fcontrol =\n\tSOC_ENUM_SINGLE(DA7218_CP_DELAY, DA7218_CP_FCONTROL_SHIFT,\n\t\t\tDA7218_CP_FCONTROL_MAX, da7218_cp_fcontrol_txt);\n\nstatic const char * const da7218_cp_tau_delay_txt[] = {\n\t\"0ms\", \"2ms\", \"4ms\", \"16ms\", \"64ms\", \"128ms\", \"256ms\", \"512ms\"\n};\n\nstatic const struct soc_enum da7218_cp_tau_delay =\n\tSOC_ENUM_SINGLE(DA7218_CP_DELAY, DA7218_CP_TAU_DELAY_SHIFT,\n\t\t\tDA7218_CP_TAU_DELAY_MAX, da7218_cp_tau_delay_txt);\n\n \n\n \nstatic void da7218_alc_calib(struct snd_soc_component *component)\n{\n\tu8 mic_1_ctrl, mic_2_ctrl;\n\tu8 mixin_1_ctrl, mixin_2_ctrl;\n\tu8 in_1l_filt_ctrl, in_1r_filt_ctrl, in_2l_filt_ctrl, in_2r_filt_ctrl;\n\tu8 in_1_hpf_ctrl, in_2_hpf_ctrl;\n\tu8 calib_ctrl;\n\tint i = 0;\n\tbool calibrated = false;\n\n\t \n\tmic_1_ctrl = snd_soc_component_read(component, DA7218_MIC_1_CTRL);\n\tmic_2_ctrl = snd_soc_component_read(component, DA7218_MIC_2_CTRL);\n\n\t \n\tmixin_1_ctrl = snd_soc_component_read(component, DA7218_MIXIN_1_CTRL);\n\tmixin_2_ctrl = snd_soc_component_read(component, DA7218_MIXIN_2_CTRL);\n\n\t \n\tin_1l_filt_ctrl = snd_soc_component_read(component, DA7218_IN_1L_FILTER_CTRL);\n\tin_1r_filt_ctrl = snd_soc_component_read(component, DA7218_IN_1R_FILTER_CTRL);\n\tin_2l_filt_ctrl = snd_soc_component_read(component, DA7218_IN_2L_FILTER_CTRL);\n\tin_2r_filt_ctrl = snd_soc_component_read(component, DA7218_IN_2R_FILTER_CTRL);\n\n\t \n\tin_1_hpf_ctrl = snd_soc_component_read(component, DA7218_IN_1_HPF_FILTER_CTRL);\n\tin_2_hpf_ctrl = snd_soc_component_read(component, DA7218_IN_2_HPF_FILTER_CTRL);\n\n\t \n\tsnd_soc_component_update_bits(component, DA7218_MIC_1_CTRL, DA7218_MIC_1_AMP_EN_MASK,\n\t\t\t    DA7218_MIC_1_AMP_EN_MASK);\n\tsnd_soc_component_update_bits(component, DA7218_MIC_2_CTRL, DA7218_MIC_2_AMP_EN_MASK,\n\t\t\t    DA7218_MIC_2_AMP_EN_MASK);\n\tsnd_soc_component_update_bits(component, DA7218_MIC_1_CTRL,\n\t\t\t    DA7218_MIC_1_AMP_MUTE_EN_MASK,\n\t\t\t    DA7218_MIC_1_AMP_MUTE_EN_MASK);\n\tsnd_soc_component_update_bits(component, DA7218_MIC_2_CTRL,\n\t\t\t    DA7218_MIC_2_AMP_MUTE_EN_MASK,\n\t\t\t    DA7218_MIC_2_AMP_MUTE_EN_MASK);\n\n\t \n\tsnd_soc_component_update_bits(component, DA7218_MIXIN_1_CTRL,\n\t\t\t    DA7218_MIXIN_1_AMP_EN_MASK |\n\t\t\t    DA7218_MIXIN_1_AMP_MUTE_EN_MASK,\n\t\t\t    DA7218_MIXIN_1_AMP_EN_MASK);\n\tsnd_soc_component_update_bits(component, DA7218_MIXIN_2_CTRL,\n\t\t\t    DA7218_MIXIN_2_AMP_EN_MASK |\n\t\t\t    DA7218_MIXIN_2_AMP_MUTE_EN_MASK,\n\t\t\t    DA7218_MIXIN_2_AMP_EN_MASK);\n\n\t \n\tsnd_soc_component_update_bits(component, DA7218_IN_1L_FILTER_CTRL,\n\t\t\t    DA7218_IN_1L_FILTER_EN_MASK |\n\t\t\t    DA7218_IN_1L_MUTE_EN_MASK,\n\t\t\t    DA7218_IN_1L_FILTER_EN_MASK);\n\tsnd_soc_component_update_bits(component, DA7218_IN_1R_FILTER_CTRL,\n\t\t\t    DA7218_IN_1R_FILTER_EN_MASK |\n\t\t\t    DA7218_IN_1R_MUTE_EN_MASK,\n\t\t\t    DA7218_IN_1R_FILTER_EN_MASK);\n\tsnd_soc_component_update_bits(component, DA7218_IN_2L_FILTER_CTRL,\n\t\t\t    DA7218_IN_2L_FILTER_EN_MASK |\n\t\t\t    DA7218_IN_2L_MUTE_EN_MASK,\n\t\t\t    DA7218_IN_2L_FILTER_EN_MASK);\n\tsnd_soc_component_update_bits(component, DA7218_IN_2R_FILTER_CTRL,\n\t\t\t    DA7218_IN_2R_FILTER_EN_MASK |\n\t\t\t    DA7218_IN_2R_MUTE_EN_MASK,\n\t\t\t    DA7218_IN_2R_FILTER_EN_MASK);\n\n\t \n\tsnd_soc_component_update_bits(component, DA7218_IN_1_HPF_FILTER_CTRL,\n\t\t\t    DA7218_IN_1_VOICE_EN_MASK, 0);\n\tsnd_soc_component_update_bits(component, DA7218_IN_2_HPF_FILTER_CTRL,\n\t\t\t    DA7218_IN_2_VOICE_EN_MASK, 0);\n\n\t \n\tsnd_soc_component_update_bits(component, DA7218_CALIB_CTRL, DA7218_CALIB_AUTO_EN_MASK,\n\t\t\t    DA7218_CALIB_AUTO_EN_MASK);\n\tdo {\n\t\tcalib_ctrl = snd_soc_component_read(component, DA7218_CALIB_CTRL);\n\t\tif (calib_ctrl & DA7218_CALIB_AUTO_EN_MASK) {\n\t\t\t++i;\n\t\t\tusleep_range(DA7218_ALC_CALIB_DELAY_MIN,\n\t\t\t\t     DA7218_ALC_CALIB_DELAY_MAX);\n\t\t} else {\n\t\t\tcalibrated = true;\n\t\t}\n\n\t} while ((i < DA7218_ALC_CALIB_MAX_TRIES) && (!calibrated));\n\n\t \n\tif ((!calibrated) || (calib_ctrl & DA7218_CALIB_OVERFLOW_MASK)) {\n\t\tdev_warn(component->dev,\n\t\t\t \"ALC auto calibration failed - %s\\n\",\n\t\t\t (calibrated) ? \"overflow\" : \"timeout\");\n\t\tsnd_soc_component_update_bits(component, DA7218_CALIB_CTRL,\n\t\t\t\t    DA7218_CALIB_OFFSET_EN_MASK, 0);\n\t\tsnd_soc_component_update_bits(component, DA7218_ALC_CTRL1,\n\t\t\t\t    DA7218_ALC_SYNC_MODE_MASK, 0);\n\n\t} else {\n\t\t \n\t\tsnd_soc_component_update_bits(component, DA7218_CALIB_CTRL,\n\t\t\t\t    DA7218_CALIB_OFFSET_EN_MASK,\n\t\t\t\t    DA7218_CALIB_OFFSET_EN_MASK);\n\n\t\t \n\t\tsnd_soc_component_update_bits(component, DA7218_ALC_CTRL1,\n\t\t\t\t    DA7218_ALC_SYNC_MODE_MASK,\n\t\t\t\t    DA7218_ALC_SYNC_MODE_CH1 |\n\t\t\t\t    DA7218_ALC_SYNC_MODE_CH2);\n\t}\n\n\t \n\tsnd_soc_component_write(component, DA7218_IN_1_HPF_FILTER_CTRL, in_1_hpf_ctrl);\n\tsnd_soc_component_write(component, DA7218_IN_2_HPF_FILTER_CTRL, in_2_hpf_ctrl);\n\n\t \n\tsnd_soc_component_write(component, DA7218_IN_1L_FILTER_CTRL, in_1l_filt_ctrl);\n\tsnd_soc_component_write(component, DA7218_IN_1R_FILTER_CTRL, in_1r_filt_ctrl);\n\tsnd_soc_component_write(component, DA7218_IN_2L_FILTER_CTRL, in_2l_filt_ctrl);\n\tsnd_soc_component_write(component, DA7218_IN_2R_FILTER_CTRL, in_2r_filt_ctrl);\n\n\t \n\tsnd_soc_component_write(component, DA7218_MIXIN_1_CTRL, mixin_1_ctrl);\n\tsnd_soc_component_write(component, DA7218_MIXIN_2_CTRL, mixin_2_ctrl);\n\n\t \n\tsnd_soc_component_write(component, DA7218_MIC_1_CTRL, mic_1_ctrl);\n\tsnd_soc_component_write(component, DA7218_MIC_2_CTRL, mic_2_ctrl);\n}\n\nstatic int da7218_mixin_gain_put(struct snd_kcontrol *kcontrol,\n\t\t\t\t struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_soc_component *component = snd_soc_kcontrol_component(kcontrol);\n\tstruct da7218_priv *da7218 = snd_soc_component_get_drvdata(component);\n\tint ret;\n\n\tret = snd_soc_put_volsw(kcontrol, ucontrol);\n\n\t \n\tif ((ret == 1) && (da7218->alc_en))\n\t\tda7218_alc_calib(component);\n\n\treturn ret;\n}\n\nstatic int da7218_alc_sw_put(struct snd_kcontrol *kcontrol,\n\t\t\t     struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct soc_mixer_control *mc =\n\t\t(struct soc_mixer_control *) kcontrol->private_value;\n\tstruct snd_soc_component *component = snd_soc_kcontrol_component(kcontrol);\n\tstruct da7218_priv *da7218 = snd_soc_component_get_drvdata(component);\n\tunsigned int lvalue = ucontrol->value.integer.value[0];\n\tunsigned int rvalue = ucontrol->value.integer.value[1];\n\tunsigned int lshift = mc->shift;\n\tunsigned int rshift = mc->rshift;\n\tunsigned int mask = (mc->max << lshift) | (mc->max << rshift);\n\n\t \n\tif ((lvalue || rvalue) && (!da7218->alc_en))\n\t\tda7218_alc_calib(component);\n\n\t \n\tda7218->alc_en &= ~mask;\n\tda7218->alc_en |= (lvalue << lshift) | (rvalue << rshift);\n\n\treturn snd_soc_put_volsw(kcontrol, ucontrol);\n}\n\n \nstatic int da7218_tonegen_freq_get(struct snd_kcontrol *kcontrol,\n\t\t\t\t   struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_soc_component *component = snd_soc_kcontrol_component(kcontrol);\n\tstruct da7218_priv *da7218 = snd_soc_component_get_drvdata(component);\n\tstruct soc_mixer_control *mixer_ctrl =\n\t\t(struct soc_mixer_control *) kcontrol->private_value;\n\tunsigned int reg = mixer_ctrl->reg;\n\tu16 val;\n\tint ret;\n\n\t \n\tret = regmap_raw_read(da7218->regmap, reg, &val, 2);\n\tif (ret)\n\t\treturn ret;\n\n\tucontrol->value.integer.value[0] = le16_to_cpu(val);\n\n\treturn 0;\n}\n\nstatic int da7218_tonegen_freq_put(struct snd_kcontrol *kcontrol,\n\t\t\t\t   struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_soc_component *component = snd_soc_kcontrol_component(kcontrol);\n\tstruct da7218_priv *da7218 = snd_soc_component_get_drvdata(component);\n\tstruct soc_mixer_control *mixer_ctrl =\n\t\t(struct soc_mixer_control *) kcontrol->private_value;\n\tunsigned int reg = mixer_ctrl->reg;\n\tu16 val;\n\n\t \n\tval = cpu_to_le16(ucontrol->value.integer.value[0]);\n\n\treturn regmap_raw_write(da7218->regmap, reg, &val, 2);\n}\n\nstatic int da7218_mic_lvl_det_sw_put(struct snd_kcontrol *kcontrol,\n\t\t\t\t     struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_soc_component *component = snd_soc_kcontrol_component(kcontrol);\n\tstruct da7218_priv *da7218 = snd_soc_component_get_drvdata(component);\n\tstruct soc_mixer_control *mixer_ctrl =\n\t\t(struct soc_mixer_control *) kcontrol->private_value;\n\tunsigned int lvalue = ucontrol->value.integer.value[0];\n\tunsigned int rvalue = ucontrol->value.integer.value[1];\n\tunsigned int lshift = mixer_ctrl->shift;\n\tunsigned int rshift = mixer_ctrl->rshift;\n\tunsigned int mask = (mixer_ctrl->max << lshift) |\n\t\t\t    (mixer_ctrl->max << rshift);\n\tda7218->mic_lvl_det_en &= ~mask;\n\tda7218->mic_lvl_det_en |= (lvalue << lshift) | (rvalue << rshift);\n\n\t \n\treturn snd_soc_component_write(component, mixer_ctrl->reg,\n\t\t\t     (da7218->in_filt_en & da7218->mic_lvl_det_en));\n}\n\nstatic int da7218_mic_lvl_det_sw_get(struct snd_kcontrol *kcontrol,\n\t\t\t\t     struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_soc_component *component = snd_soc_kcontrol_component(kcontrol);\n\tstruct da7218_priv *da7218 = snd_soc_component_get_drvdata(component);\n\tstruct soc_mixer_control *mixer_ctrl =\n\t\t(struct soc_mixer_control *) kcontrol->private_value;\n\tunsigned int lshift = mixer_ctrl->shift;\n\tunsigned int rshift = mixer_ctrl->rshift;\n\tunsigned int lmask = (mixer_ctrl->max << lshift);\n\tunsigned int rmask = (mixer_ctrl->max << rshift);\n\n\tucontrol->value.integer.value[0] =\n\t\t(da7218->mic_lvl_det_en & lmask) >> lshift;\n\tucontrol->value.integer.value[1] =\n\t\t(da7218->mic_lvl_det_en & rmask) >> rshift;\n\n\treturn 0;\n}\n\nstatic int da7218_biquad_coeff_get(struct snd_kcontrol *kcontrol,\n\t\t\t\t   struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_soc_component *component = snd_soc_kcontrol_component(kcontrol);\n\tstruct da7218_priv *da7218 = snd_soc_component_get_drvdata(component);\n\tstruct soc_bytes_ext *bytes_ext =\n\t\t(struct soc_bytes_ext *) kcontrol->private_value;\n\n\t \n\tswitch (bytes_ext->max) {\n\tcase DA7218_OUT_1_BIQ_5STAGE_CFG_SIZE:\n\t\tmemcpy(ucontrol->value.bytes.data, da7218->biq_5stage_coeff,\n\t\t       bytes_ext->max);\n\t\tbreak;\n\tcase DA7218_SIDETONE_BIQ_3STAGE_CFG_SIZE:\n\t\tmemcpy(ucontrol->value.bytes.data, da7218->stbiq_3stage_coeff,\n\t\t       bytes_ext->max);\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\treturn 0;\n}\n\nstatic int da7218_biquad_coeff_put(struct snd_kcontrol *kcontrol,\n\t\t\t\t   struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_soc_component *component = snd_soc_kcontrol_component(kcontrol);\n\tstruct da7218_priv *da7218 = snd_soc_component_get_drvdata(component);\n\tstruct soc_bytes_ext *bytes_ext =\n\t\t(struct soc_bytes_ext *) kcontrol->private_value;\n\tu8 reg, out_filt1l;\n\tu8 cfg[DA7218_BIQ_CFG_SIZE];\n\tint i;\n\n\t \n\tswitch (bytes_ext->max) {\n\tcase DA7218_OUT_1_BIQ_5STAGE_CFG_SIZE:\n\t\treg = DA7218_OUT_1_BIQ_5STAGE_DATA;\n\t\tmemcpy(da7218->biq_5stage_coeff, ucontrol->value.bytes.data,\n\t\t       bytes_ext->max);\n\t\tbreak;\n\tcase DA7218_SIDETONE_BIQ_3STAGE_CFG_SIZE:\n\t\treg = DA7218_SIDETONE_BIQ_3STAGE_DATA;\n\t\tmemcpy(da7218->stbiq_3stage_coeff, ucontrol->value.bytes.data,\n\t\t       bytes_ext->max);\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\t \n\tout_filt1l = snd_soc_component_read(component, DA7218_OUT_1L_FILTER_CTRL);\n\tsnd_soc_component_write(component, DA7218_OUT_1L_FILTER_CTRL,\n\t\t      out_filt1l | DA7218_OUT_1L_FILTER_EN_MASK);\n\n\tfor (i = 0; i < bytes_ext->max; ++i) {\n\t\tcfg[DA7218_BIQ_CFG_DATA] = ucontrol->value.bytes.data[i];\n\t\tcfg[DA7218_BIQ_CFG_ADDR] = i;\n\t\tregmap_raw_write(da7218->regmap, reg, cfg, DA7218_BIQ_CFG_SIZE);\n\t}\n\n\t \n\tsnd_soc_component_write(component, DA7218_OUT_1L_FILTER_CTRL, out_filt1l);\n\n\treturn 0;\n}\n\n\n \n\nstatic const struct snd_kcontrol_new da7218_snd_controls[] = {\n\t \n\tSOC_SINGLE_TLV(\"Mic1 Volume\", DA7218_MIC_1_GAIN,\n\t\t       DA7218_MIC_1_AMP_GAIN_SHIFT, DA7218_MIC_AMP_GAIN_MAX,\n\t\t       DA7218_NO_INVERT, da7218_mic_gain_tlv),\n\tSOC_SINGLE(\"Mic1 Switch\", DA7218_MIC_1_CTRL,\n\t\t   DA7218_MIC_1_AMP_MUTE_EN_SHIFT, DA7218_SWITCH_EN_MAX,\n\t\t   DA7218_INVERT),\n\tSOC_SINGLE_TLV(\"Mic2 Volume\", DA7218_MIC_2_GAIN,\n\t\t       DA7218_MIC_2_AMP_GAIN_SHIFT, DA7218_MIC_AMP_GAIN_MAX,\n\t\t       DA7218_NO_INVERT, da7218_mic_gain_tlv),\n\tSOC_SINGLE(\"Mic2 Switch\", DA7218_MIC_2_CTRL,\n\t\t   DA7218_MIC_2_AMP_MUTE_EN_SHIFT, DA7218_SWITCH_EN_MAX,\n\t\t   DA7218_INVERT),\n\n\t \n\tSOC_SINGLE_EXT_TLV(\"Mixin1 Volume\", DA7218_MIXIN_1_GAIN,\n\t\t\t   DA7218_MIXIN_1_AMP_GAIN_SHIFT,\n\t\t\t   DA7218_MIXIN_AMP_GAIN_MAX, DA7218_NO_INVERT,\n\t\t\t   snd_soc_get_volsw, da7218_mixin_gain_put,\n\t\t\t   da7218_mixin_gain_tlv),\n\tSOC_SINGLE(\"Mixin1 Switch\", DA7218_MIXIN_1_CTRL,\n\t\t   DA7218_MIXIN_1_AMP_MUTE_EN_SHIFT, DA7218_SWITCH_EN_MAX,\n\t\t   DA7218_INVERT),\n\tSOC_SINGLE(\"Mixin1 Gain Ramp Switch\", DA7218_MIXIN_1_CTRL,\n\t\t   DA7218_MIXIN_1_AMP_RAMP_EN_SHIFT, DA7218_SWITCH_EN_MAX,\n\t\t   DA7218_NO_INVERT),\n\tSOC_SINGLE(\"Mixin1 ZC Gain Switch\", DA7218_MIXIN_1_CTRL,\n\t\t   DA7218_MIXIN_1_AMP_ZC_EN_SHIFT, DA7218_SWITCH_EN_MAX,\n\t\t   DA7218_NO_INVERT),\n\tSOC_SINGLE_EXT_TLV(\"Mixin2 Volume\", DA7218_MIXIN_2_GAIN,\n\t\t\t   DA7218_MIXIN_2_AMP_GAIN_SHIFT,\n\t\t\t   DA7218_MIXIN_AMP_GAIN_MAX, DA7218_NO_INVERT,\n\t\t\t   snd_soc_get_volsw, da7218_mixin_gain_put,\n\t\t\t   da7218_mixin_gain_tlv),\n\tSOC_SINGLE(\"Mixin2 Switch\", DA7218_MIXIN_2_CTRL,\n\t\t   DA7218_MIXIN_2_AMP_MUTE_EN_SHIFT, DA7218_SWITCH_EN_MAX,\n\t\t   DA7218_INVERT),\n\tSOC_SINGLE(\"Mixin2 Gain Ramp Switch\", DA7218_MIXIN_2_CTRL,\n\t\t   DA7218_MIXIN_2_AMP_RAMP_EN_SHIFT, DA7218_SWITCH_EN_MAX,\n\t\t   DA7218_NO_INVERT),\n\tSOC_SINGLE(\"Mixin2 ZC Gain Switch\", DA7218_MIXIN_2_CTRL,\n\t\t   DA7218_MIXIN_2_AMP_ZC_EN_SHIFT, DA7218_SWITCH_EN_MAX,\n\t\t   DA7218_NO_INVERT),\n\n\t \n\tSOC_SINGLE(\"ADC1 AAF Switch\", DA7218_ADC_1_CTRL,\n\t\t   DA7218_ADC_1_AAF_EN_SHIFT, DA7218_SWITCH_EN_MAX,\n\t\t   DA7218_NO_INVERT),\n\tSOC_SINGLE(\"ADC2 AAF Switch\", DA7218_ADC_2_CTRL,\n\t\t   DA7218_ADC_2_AAF_EN_SHIFT, DA7218_SWITCH_EN_MAX,\n\t\t   DA7218_NO_INVERT),\n\tSOC_SINGLE(\"ADC LP Mode Switch\", DA7218_ADC_MODE,\n\t\t   DA7218_ADC_LP_MODE_SHIFT, DA7218_SWITCH_EN_MAX,\n\t\t   DA7218_NO_INVERT),\n\n\t \n\tSOC_SINGLE_TLV(\"In Filter1L Volume\", DA7218_IN_1L_GAIN,\n\t\t       DA7218_IN_1L_DIGITAL_GAIN_SHIFT,\n\t\t       DA7218_IN_DIGITAL_GAIN_MAX, DA7218_NO_INVERT,\n\t\t       da7218_in_dig_gain_tlv),\n\tSOC_SINGLE(\"In Filter1L Switch\", DA7218_IN_1L_FILTER_CTRL,\n\t\t   DA7218_IN_1L_MUTE_EN_SHIFT, DA7218_SWITCH_EN_MAX,\n\t\t   DA7218_INVERT),\n\tSOC_SINGLE(\"In Filter1L Gain Ramp Switch\", DA7218_IN_1L_FILTER_CTRL,\n\t\t   DA7218_IN_1L_RAMP_EN_SHIFT, DA7218_SWITCH_EN_MAX,\n\t\t   DA7218_NO_INVERT),\n\tSOC_SINGLE_TLV(\"In Filter1R Volume\", DA7218_IN_1R_GAIN,\n\t\t       DA7218_IN_1R_DIGITAL_GAIN_SHIFT,\n\t\t       DA7218_IN_DIGITAL_GAIN_MAX, DA7218_NO_INVERT,\n\t\t       da7218_in_dig_gain_tlv),\n\tSOC_SINGLE(\"In Filter1R Switch\", DA7218_IN_1R_FILTER_CTRL,\n\t\t   DA7218_IN_1R_MUTE_EN_SHIFT, DA7218_SWITCH_EN_MAX,\n\t\t   DA7218_INVERT),\n\tSOC_SINGLE(\"In Filter1R Gain Ramp Switch\",\n\t\t   DA7218_IN_1R_FILTER_CTRL, DA7218_IN_1R_RAMP_EN_SHIFT,\n\t\t   DA7218_SWITCH_EN_MAX, DA7218_NO_INVERT),\n\tSOC_SINGLE_TLV(\"In Filter2L Volume\", DA7218_IN_2L_GAIN,\n\t\t       DA7218_IN_2L_DIGITAL_GAIN_SHIFT,\n\t\t       DA7218_IN_DIGITAL_GAIN_MAX, DA7218_NO_INVERT,\n\t\t       da7218_in_dig_gain_tlv),\n\tSOC_SINGLE(\"In Filter2L Switch\", DA7218_IN_2L_FILTER_CTRL,\n\t\t   DA7218_IN_2L_MUTE_EN_SHIFT, DA7218_SWITCH_EN_MAX,\n\t\t   DA7218_INVERT),\n\tSOC_SINGLE(\"In Filter2L Gain Ramp Switch\", DA7218_IN_2L_FILTER_CTRL,\n\t\t   DA7218_IN_2L_RAMP_EN_SHIFT, DA7218_SWITCH_EN_MAX,\n\t\t   DA7218_NO_INVERT),\n\tSOC_SINGLE_TLV(\"In Filter2R Volume\", DA7218_IN_2R_GAIN,\n\t\t       DA7218_IN_2R_DIGITAL_GAIN_SHIFT,\n\t\t       DA7218_IN_DIGITAL_GAIN_MAX, DA7218_NO_INVERT,\n\t\t       da7218_in_dig_gain_tlv),\n\tSOC_SINGLE(\"In Filter2R Switch\", DA7218_IN_2R_FILTER_CTRL,\n\t\t   DA7218_IN_2R_MUTE_EN_SHIFT, DA7218_SWITCH_EN_MAX,\n\t\t   DA7218_INVERT),\n\tSOC_SINGLE(\"In Filter2R Gain Ramp Switch\",\n\t\t   DA7218_IN_2R_FILTER_CTRL, DA7218_IN_2R_RAMP_EN_SHIFT,\n\t\t   DA7218_SWITCH_EN_MAX, DA7218_NO_INVERT),\n\n\t \n\tSOC_SINGLE_TLV(\"AGS Trigger\", DA7218_AGS_TRIGGER,\n\t\t       DA7218_AGS_TRIGGER_SHIFT, DA7218_AGS_TRIGGER_MAX,\n\t\t       DA7218_INVERT, da7218_ags_trigger_tlv),\n\tSOC_SINGLE_TLV(\"AGS Max Attenuation\", DA7218_AGS_ATT_MAX,\n\t\t       DA7218_AGS_ATT_MAX_SHIFT, DA7218_AGS_ATT_MAX_MAX,\n\t\t       DA7218_NO_INVERT, da7218_ags_att_max_tlv),\n\tSOC_SINGLE(\"AGS Anticlip Switch\", DA7218_AGS_ANTICLIP_CTRL,\n\t\t   DA7218_AGS_ANTICLIP_EN_SHIFT, DA7218_SWITCH_EN_MAX,\n\t\t   DA7218_NO_INVERT),\n\tSOC_SINGLE(\"AGS Channel1 Switch\", DA7218_AGS_ENABLE,\n\t\t   DA7218_AGS_ENABLE_CHAN1_SHIFT, DA7218_SWITCH_EN_MAX,\n\t\t   DA7218_NO_INVERT),\n\tSOC_SINGLE(\"AGS Channel2 Switch\", DA7218_AGS_ENABLE,\n\t\t   DA7218_AGS_ENABLE_CHAN2_SHIFT, DA7218_SWITCH_EN_MAX,\n\t\t   DA7218_NO_INVERT),\n\n\t \n\tSOC_ENUM(\"ALC Attack Rate\", da7218_alc_attack_rate),\n\tSOC_ENUM(\"ALC Release Rate\", da7218_alc_release_rate),\n\tSOC_ENUM(\"ALC Hold Time\", da7218_alc_hold_time),\n\tSOC_SINGLE_TLV(\"ALC Noise Threshold\", DA7218_ALC_NOISE,\n\t\t       DA7218_ALC_NOISE_SHIFT, DA7218_ALC_THRESHOLD_MAX,\n\t\t       DA7218_INVERT, da7218_alc_threshold_tlv),\n\tSOC_SINGLE_TLV(\"ALC Min Threshold\", DA7218_ALC_TARGET_MIN,\n\t\t       DA7218_ALC_THRESHOLD_MIN_SHIFT, DA7218_ALC_THRESHOLD_MAX,\n\t\t       DA7218_INVERT, da7218_alc_threshold_tlv),\n\tSOC_SINGLE_TLV(\"ALC Max Threshold\", DA7218_ALC_TARGET_MAX,\n\t\t       DA7218_ALC_THRESHOLD_MAX_SHIFT, DA7218_ALC_THRESHOLD_MAX,\n\t\t       DA7218_INVERT, da7218_alc_threshold_tlv),\n\tSOC_SINGLE_TLV(\"ALC Max Attenuation\", DA7218_ALC_GAIN_LIMITS,\n\t\t       DA7218_ALC_ATTEN_MAX_SHIFT, DA7218_ALC_ATTEN_GAIN_MAX,\n\t\t       DA7218_NO_INVERT, da7218_alc_gain_tlv),\n\tSOC_SINGLE_TLV(\"ALC Max Gain\", DA7218_ALC_GAIN_LIMITS,\n\t\t       DA7218_ALC_GAIN_MAX_SHIFT, DA7218_ALC_ATTEN_GAIN_MAX,\n\t\t       DA7218_NO_INVERT, da7218_alc_gain_tlv),\n\tSOC_SINGLE_RANGE_TLV(\"ALC Min Analog Gain\", DA7218_ALC_ANA_GAIN_LIMITS,\n\t\t\t     DA7218_ALC_ANA_GAIN_MIN_SHIFT,\n\t\t\t     DA7218_ALC_ANA_GAIN_MIN, DA7218_ALC_ANA_GAIN_MAX,\n\t\t\t     DA7218_NO_INVERT, da7218_alc_ana_gain_tlv),\n\tSOC_SINGLE_RANGE_TLV(\"ALC Max Analog Gain\", DA7218_ALC_ANA_GAIN_LIMITS,\n\t\t\t     DA7218_ALC_ANA_GAIN_MAX_SHIFT,\n\t\t\t     DA7218_ALC_ANA_GAIN_MIN, DA7218_ALC_ANA_GAIN_MAX,\n\t\t\t     DA7218_NO_INVERT, da7218_alc_ana_gain_tlv),\n\tSOC_ENUM(\"ALC Anticlip Step\", da7218_alc_anticlip_step),\n\tSOC_SINGLE(\"ALC Anticlip Switch\", DA7218_ALC_ANTICLIP_CTRL,\n\t\t   DA7218_ALC_ANTICLIP_EN_SHIFT, DA7218_SWITCH_EN_MAX,\n\t\t   DA7218_NO_INVERT),\n\tSOC_DOUBLE_EXT(\"ALC Channel1 Switch\", DA7218_ALC_CTRL1,\n\t\t       DA7218_ALC_CHAN1_L_EN_SHIFT, DA7218_ALC_CHAN1_R_EN_SHIFT,\n\t\t       DA7218_SWITCH_EN_MAX, DA7218_NO_INVERT,\n\t\t       snd_soc_get_volsw, da7218_alc_sw_put),\n\tSOC_DOUBLE_EXT(\"ALC Channel2 Switch\", DA7218_ALC_CTRL1,\n\t\t       DA7218_ALC_CHAN2_L_EN_SHIFT, DA7218_ALC_CHAN2_R_EN_SHIFT,\n\t\t       DA7218_SWITCH_EN_MAX, DA7218_NO_INVERT,\n\t\t       snd_soc_get_volsw, da7218_alc_sw_put),\n\n\t \n\tSOC_ENUM(\"Envelope Tracking Attack Rate\", da7218_integ_attack_rate),\n\tSOC_ENUM(\"Envelope Tracking Release Rate\", da7218_integ_release_rate),\n\n\t \n\tSOC_ENUM(\"In Filter1 HPF Mode\", da7218_in1_hpf_mode),\n\tSOC_ENUM(\"In Filter1 HPF Corner Audio\", da7218_in1_audio_hpf_corner),\n\tSOC_ENUM(\"In Filter1 HPF Corner Voice\", da7218_in1_voice_hpf_corner),\n\tSOC_ENUM(\"In Filter2 HPF Mode\", da7218_in2_hpf_mode),\n\tSOC_ENUM(\"In Filter2 HPF Corner Audio\", da7218_in2_audio_hpf_corner),\n\tSOC_ENUM(\"In Filter2 HPF Corner Voice\", da7218_in2_voice_hpf_corner),\n\n\t \n\tSOC_DOUBLE_EXT(\"Mic Level Detect Channel1 Switch\", DA7218_LVL_DET_CTRL,\n\t\t       DA7218_LVL_DET_EN_CHAN1L_SHIFT,\n\t\t       DA7218_LVL_DET_EN_CHAN1R_SHIFT, DA7218_SWITCH_EN_MAX,\n\t\t       DA7218_NO_INVERT, da7218_mic_lvl_det_sw_get,\n\t\t       da7218_mic_lvl_det_sw_put),\n\tSOC_DOUBLE_EXT(\"Mic Level Detect Channel2 Switch\", DA7218_LVL_DET_CTRL,\n\t\t       DA7218_LVL_DET_EN_CHAN2L_SHIFT,\n\t\t       DA7218_LVL_DET_EN_CHAN2R_SHIFT, DA7218_SWITCH_EN_MAX,\n\t\t       DA7218_NO_INVERT, da7218_mic_lvl_det_sw_get,\n\t\t       da7218_mic_lvl_det_sw_put),\n\tSOC_SINGLE(\"Mic Level Detect Level\", DA7218_LVL_DET_LEVEL,\n\t\t   DA7218_LVL_DET_LEVEL_SHIFT, DA7218_LVL_DET_LEVEL_MAX,\n\t\t   DA7218_NO_INVERT),\n\n\t \n\tSOC_SINGLE_TLV(\"DMix In Filter1L Out1 DAIL Volume\",\n\t\t       DA7218_DMIX_OUTDAI_1L_INFILT_1L_GAIN,\n\t\t       DA7218_OUTDAI_1L_INFILT_1L_GAIN_SHIFT,\n\t\t       DA7218_DMIX_GAIN_MAX, DA7218_NO_INVERT,\n\t\t       da7218_dmix_gain_tlv),\n\tSOC_SINGLE_TLV(\"DMix In Filter1L Out1 DAIR Volume\",\n\t\t       DA7218_DMIX_OUTDAI_1R_INFILT_1L_GAIN,\n\t\t       DA7218_OUTDAI_1R_INFILT_1L_GAIN_SHIFT,\n\t\t       DA7218_DMIX_GAIN_MAX, DA7218_NO_INVERT,\n\t\t       da7218_dmix_gain_tlv),\n\tSOC_SINGLE_TLV(\"DMix In Filter1L Out2 DAIL Volume\",\n\t\t       DA7218_DMIX_OUTDAI_2L_INFILT_1L_GAIN,\n\t\t       DA7218_OUTDAI_2L_INFILT_1L_GAIN_SHIFT,\n\t\t       DA7218_DMIX_GAIN_MAX, DA7218_NO_INVERT,\n\t\t       da7218_dmix_gain_tlv),\n\tSOC_SINGLE_TLV(\"DMix In Filter1L Out2 DAIR Volume\",\n\t\t       DA7218_DMIX_OUTDAI_2R_INFILT_1L_GAIN,\n\t\t       DA7218_OUTDAI_2R_INFILT_1L_GAIN_SHIFT,\n\t\t       DA7218_DMIX_GAIN_MAX, DA7218_NO_INVERT,\n\t\t       da7218_dmix_gain_tlv),\n\n\tSOC_SINGLE_TLV(\"DMix In Filter1R Out1 DAIL Volume\",\n\t\t       DA7218_DMIX_OUTDAI_1L_INFILT_1R_GAIN,\n\t\t       DA7218_OUTDAI_1L_INFILT_1R_GAIN_SHIFT,\n\t\t       DA7218_DMIX_GAIN_MAX, DA7218_NO_INVERT,\n\t\t       da7218_dmix_gain_tlv),\n\tSOC_SINGLE_TLV(\"DMix In Filter1R Out1 DAIR Volume\",\n\t\t       DA7218_DMIX_OUTDAI_1R_INFILT_1R_GAIN,\n\t\t       DA7218_OUTDAI_1R_INFILT_1R_GAIN_SHIFT,\n\t\t       DA7218_DMIX_GAIN_MAX, DA7218_NO_INVERT,\n\t\t       da7218_dmix_gain_tlv),\n\tSOC_SINGLE_TLV(\"DMix In Filter1R Out2 DAIL Volume\",\n\t\t       DA7218_DMIX_OUTDAI_2L_INFILT_1R_GAIN,\n\t\t       DA7218_OUTDAI_2L_INFILT_1R_GAIN_SHIFT,\n\t\t       DA7218_DMIX_GAIN_MAX, DA7218_NO_INVERT,\n\t\t       da7218_dmix_gain_tlv),\n\tSOC_SINGLE_TLV(\"DMix In Filter1R Out2 DAIR Volume\",\n\t\t       DA7218_DMIX_OUTDAI_2R_INFILT_1R_GAIN,\n\t\t       DA7218_OUTDAI_2R_INFILT_1R_GAIN_SHIFT,\n\t\t       DA7218_DMIX_GAIN_MAX, DA7218_NO_INVERT,\n\t\t       da7218_dmix_gain_tlv),\n\n\tSOC_SINGLE_TLV(\"DMix In Filter2L Out1 DAIL Volume\",\n\t\t       DA7218_DMIX_OUTDAI_1L_INFILT_2L_GAIN,\n\t\t       DA7218_OUTDAI_1L_INFILT_2L_GAIN_SHIFT,\n\t\t       DA7218_DMIX_GAIN_MAX, DA7218_NO_INVERT,\n\t\t       da7218_dmix_gain_tlv),\n\tSOC_SINGLE_TLV(\"DMix In Filter2L Out1 DAIR Volume\",\n\t\t       DA7218_DMIX_OUTDAI_1R_INFILT_2L_GAIN,\n\t\t       DA7218_OUTDAI_1R_INFILT_2L_GAIN_SHIFT,\n\t\t       DA7218_DMIX_GAIN_MAX, DA7218_NO_INVERT,\n\t\t       da7218_dmix_gain_tlv),\n\tSOC_SINGLE_TLV(\"DMix In Filter2L Out2 DAIL Volume\",\n\t\t       DA7218_DMIX_OUTDAI_2L_INFILT_2L_GAIN,\n\t\t       DA7218_OUTDAI_2L_INFILT_2L_GAIN_SHIFT,\n\t\t       DA7218_DMIX_GAIN_MAX, DA7218_NO_INVERT,\n\t\t       da7218_dmix_gain_tlv),\n\tSOC_SINGLE_TLV(\"DMix In Filter2L Out2 DAIR Volume\",\n\t\t       DA7218_DMIX_OUTDAI_2R_INFILT_2L_GAIN,\n\t\t       DA7218_OUTDAI_2R_INFILT_2L_GAIN_SHIFT,\n\t\t       DA7218_DMIX_GAIN_MAX, DA7218_NO_INVERT,\n\t\t       da7218_dmix_gain_tlv),\n\n\tSOC_SINGLE_TLV(\"DMix In Filter2R Out1 DAIL Volume\",\n\t\t       DA7218_DMIX_OUTDAI_1L_INFILT_2R_GAIN,\n\t\t       DA7218_OUTDAI_1L_INFILT_2R_GAIN_SHIFT,\n\t\t       DA7218_DMIX_GAIN_MAX, DA7218_NO_INVERT,\n\t\t       da7218_dmix_gain_tlv),\n\tSOC_SINGLE_TLV(\"DMix In Filter2R Out1 DAIR Volume\",\n\t\t       DA7218_DMIX_OUTDAI_1R_INFILT_2R_GAIN,\n\t\t       DA7218_OUTDAI_1R_INFILT_2R_GAIN_SHIFT,\n\t\t       DA7218_DMIX_GAIN_MAX, DA7218_NO_INVERT,\n\t\t       da7218_dmix_gain_tlv),\n\tSOC_SINGLE_TLV(\"DMix In Filter2R Out2 DAIL Volume\",\n\t\t       DA7218_DMIX_OUTDAI_2L_INFILT_2R_GAIN,\n\t\t       DA7218_OUTDAI_2L_INFILT_2R_GAIN_SHIFT,\n\t\t       DA7218_DMIX_GAIN_MAX, DA7218_NO_INVERT,\n\t\t       da7218_dmix_gain_tlv),\n\tSOC_SINGLE_TLV(\"DMix In Filter2R Out2 DAIR Volume\",\n\t\t       DA7218_DMIX_OUTDAI_2R_INFILT_2R_GAIN,\n\t\t       DA7218_OUTDAI_2R_INFILT_2R_GAIN_SHIFT,\n\t\t       DA7218_DMIX_GAIN_MAX, DA7218_NO_INVERT,\n\t\t       da7218_dmix_gain_tlv),\n\n\tSOC_SINGLE_TLV(\"DMix ToneGen Out1 DAIL Volume\",\n\t\t       DA7218_DMIX_OUTDAI_1L_TONEGEN_GAIN,\n\t\t       DA7218_OUTDAI_1L_TONEGEN_GAIN_SHIFT,\n\t\t       DA7218_DMIX_GAIN_MAX, DA7218_NO_INVERT,\n\t\t       da7218_dmix_gain_tlv),\n\tSOC_SINGLE_TLV(\"DMix ToneGen Out1 DAIR Volume\",\n\t\t       DA7218_DMIX_OUTDAI_1R_TONEGEN_GAIN,\n\t\t       DA7218_OUTDAI_1R_TONEGEN_GAIN_SHIFT,\n\t\t       DA7218_DMIX_GAIN_MAX, DA7218_NO_INVERT,\n\t\t       da7218_dmix_gain_tlv),\n\tSOC_SINGLE_TLV(\"DMix ToneGen Out2 DAIL Volume\",\n\t\t       DA7218_DMIX_OUTDAI_2L_TONEGEN_GAIN,\n\t\t       DA7218_OUTDAI_2L_TONEGEN_GAIN_SHIFT,\n\t\t       DA7218_DMIX_GAIN_MAX, DA7218_NO_INVERT,\n\t\t       da7218_dmix_gain_tlv),\n\tSOC_SINGLE_TLV(\"DMix ToneGen Out2 DAIR Volume\",\n\t\t       DA7218_DMIX_OUTDAI_2R_TONEGEN_GAIN,\n\t\t       DA7218_OUTDAI_2R_TONEGEN_GAIN_SHIFT,\n\t\t       DA7218_DMIX_GAIN_MAX, DA7218_NO_INVERT,\n\t\t       da7218_dmix_gain_tlv),\n\n\tSOC_SINGLE_TLV(\"DMix In DAIL Out1 DAIL Volume\",\n\t\t       DA7218_DMIX_OUTDAI_1L_INDAI_1L_GAIN,\n\t\t       DA7218_OUTDAI_1L_INDAI_1L_GAIN_SHIFT,\n\t\t       DA7218_DMIX_GAIN_MAX, DA7218_NO_INVERT,\n\t\t       da7218_dmix_gain_tlv),\n\tSOC_SINGLE_TLV(\"DMix In DAIL Out1 DAIR Volume\",\n\t\t       DA7218_DMIX_OUTDAI_1R_INDAI_1L_GAIN,\n\t\t       DA7218_OUTDAI_1R_INDAI_1L_GAIN_SHIFT,\n\t\t       DA7218_DMIX_GAIN_MAX, DA7218_NO_INVERT,\n\t\t       da7218_dmix_gain_tlv),\n\tSOC_SINGLE_TLV(\"DMix In DAIL Out2 DAIL Volume\",\n\t\t       DA7218_DMIX_OUTDAI_2L_INDAI_1L_GAIN,\n\t\t       DA7218_OUTDAI_2L_INDAI_1L_GAIN_SHIFT,\n\t\t       DA7218_DMIX_GAIN_MAX, DA7218_NO_INVERT,\n\t\t       da7218_dmix_gain_tlv),\n\tSOC_SINGLE_TLV(\"DMix In DAIL Out2 DAIR Volume\",\n\t\t       DA7218_DMIX_OUTDAI_2R_INDAI_1L_GAIN,\n\t\t       DA7218_OUTDAI_2R_INDAI_1L_GAIN_SHIFT,\n\t\t       DA7218_DMIX_GAIN_MAX, DA7218_NO_INVERT,\n\t\t       da7218_dmix_gain_tlv),\n\n\tSOC_SINGLE_TLV(\"DMix In DAIR Out1 DAIL Volume\",\n\t\t       DA7218_DMIX_OUTDAI_1L_INDAI_1R_GAIN,\n\t\t       DA7218_OUTDAI_1L_INDAI_1R_GAIN_SHIFT,\n\t\t       DA7218_DMIX_GAIN_MAX, DA7218_NO_INVERT,\n\t\t       da7218_dmix_gain_tlv),\n\tSOC_SINGLE_TLV(\"DMix In DAIR Out1 DAIR Volume\",\n\t\t       DA7218_DMIX_OUTDAI_1R_INDAI_1R_GAIN,\n\t\t       DA7218_OUTDAI_1R_INDAI_1R_GAIN_SHIFT,\n\t\t       DA7218_DMIX_GAIN_MAX, DA7218_NO_INVERT,\n\t\t       da7218_dmix_gain_tlv),\n\tSOC_SINGLE_TLV(\"DMix In DAIR Out2 DAIL Volume\",\n\t\t       DA7218_DMIX_OUTDAI_2L_INDAI_1R_GAIN,\n\t\t       DA7218_OUTDAI_2L_INDAI_1R_GAIN_SHIFT,\n\t\t       DA7218_DMIX_GAIN_MAX, DA7218_NO_INVERT,\n\t\t       da7218_dmix_gain_tlv),\n\tSOC_SINGLE_TLV(\"DMix In DAIR Out2 DAIR Volume\",\n\t\t       DA7218_DMIX_OUTDAI_2R_INDAI_1R_GAIN,\n\t\t       DA7218_OUTDAI_2R_INDAI_1R_GAIN_SHIFT,\n\t\t       DA7218_DMIX_GAIN_MAX, DA7218_NO_INVERT,\n\t\t       da7218_dmix_gain_tlv),\n\n\t \n\tSOC_SINGLE_TLV(\"DMix In Filter1L Out FilterL Volume\",\n\t\t       DA7218_DMIX_OUTFILT_1L_INFILT_1L_GAIN,\n\t\t       DA7218_OUTFILT_1L_INFILT_1L_GAIN_SHIFT,\n\t\t       DA7218_DMIX_GAIN_MAX, DA7218_NO_INVERT,\n\t\t       da7218_dmix_gain_tlv),\n\tSOC_SINGLE_TLV(\"DMix In Filter1L Out FilterR Volume\",\n\t\t       DA7218_DMIX_OUTFILT_1R_INFILT_1L_GAIN,\n\t\t       DA7218_OUTFILT_1R_INFILT_1L_GAIN_SHIFT,\n\t\t       DA7218_DMIX_GAIN_MAX, DA7218_NO_INVERT,\n\t\t       da7218_dmix_gain_tlv),\n\n\tSOC_SINGLE_TLV(\"DMix In Filter1R Out FilterL Volume\",\n\t\t       DA7218_DMIX_OUTFILT_1L_INFILT_1R_GAIN,\n\t\t       DA7218_OUTFILT_1L_INFILT_1R_GAIN_SHIFT,\n\t\t       DA7218_DMIX_GAIN_MAX, DA7218_NO_INVERT,\n\t\t       da7218_dmix_gain_tlv),\n\tSOC_SINGLE_TLV(\"DMix In Filter1R Out FilterR Volume\",\n\t\t       DA7218_DMIX_OUTFILT_1R_INFILT_1R_GAIN,\n\t\t       DA7218_OUTFILT_1R_INFILT_1R_GAIN_SHIFT,\n\t\t       DA7218_DMIX_GAIN_MAX, DA7218_NO_INVERT,\n\t\t       da7218_dmix_gain_tlv),\n\n\tSOC_SINGLE_TLV(\"DMix In Filter2L Out FilterL Volume\",\n\t\t       DA7218_DMIX_OUTFILT_1L_INFILT_2L_GAIN,\n\t\t       DA7218_OUTFILT_1L_INFILT_2L_GAIN_SHIFT,\n\t\t       DA7218_DMIX_GAIN_MAX, DA7218_NO_INVERT,\n\t\t       da7218_dmix_gain_tlv),\n\tSOC_SINGLE_TLV(\"DMix In Filter2L Out FilterR Volume\",\n\t\t       DA7218_DMIX_OUTFILT_1R_INFILT_2L_GAIN,\n\t\t       DA7218_OUTFILT_1R_INFILT_2L_GAIN_SHIFT,\n\t\t       DA7218_DMIX_GAIN_MAX, DA7218_NO_INVERT,\n\t\t       da7218_dmix_gain_tlv),\n\n\tSOC_SINGLE_TLV(\"DMix In Filter2R Out FilterL Volume\",\n\t\t       DA7218_DMIX_OUTFILT_1L_INFILT_2R_GAIN,\n\t\t       DA7218_OUTFILT_1L_INFILT_2R_GAIN_SHIFT,\n\t\t       DA7218_DMIX_GAIN_MAX, DA7218_NO_INVERT,\n\t\t       da7218_dmix_gain_tlv),\n\tSOC_SINGLE_TLV(\"DMix In Filter2R Out FilterR Volume\",\n\t\t       DA7218_DMIX_OUTFILT_1R_INFILT_2R_GAIN,\n\t\t       DA7218_OUTFILT_1R_INFILT_2R_GAIN_SHIFT,\n\t\t       DA7218_DMIX_GAIN_MAX, DA7218_NO_INVERT,\n\t\t       da7218_dmix_gain_tlv),\n\n\tSOC_SINGLE_TLV(\"DMix ToneGen Out FilterL Volume\",\n\t\t       DA7218_DMIX_OUTFILT_1L_TONEGEN_GAIN,\n\t\t       DA7218_OUTFILT_1L_TONEGEN_GAIN_SHIFT,\n\t\t       DA7218_DMIX_GAIN_MAX, DA7218_NO_INVERT,\n\t\t       da7218_dmix_gain_tlv),\n\tSOC_SINGLE_TLV(\"DMix ToneGen Out FilterR Volume\",\n\t\t       DA7218_DMIX_OUTFILT_1R_TONEGEN_GAIN,\n\t\t       DA7218_OUTFILT_1R_TONEGEN_GAIN_SHIFT,\n\t\t       DA7218_DMIX_GAIN_MAX, DA7218_NO_INVERT,\n\t\t       da7218_dmix_gain_tlv),\n\n\tSOC_SINGLE_TLV(\"DMix In DAIL Out FilterL Volume\",\n\t\t       DA7218_DMIX_OUTFILT_1L_INDAI_1L_GAIN,\n\t\t       DA7218_OUTFILT_1L_INDAI_1L_GAIN_SHIFT,\n\t\t       DA7218_DMIX_GAIN_MAX, DA7218_NO_INVERT,\n\t\t       da7218_dmix_gain_tlv),\n\tSOC_SINGLE_TLV(\"DMix In DAIL Out FilterR Volume\",\n\t\t       DA7218_DMIX_OUTFILT_1R_INDAI_1L_GAIN,\n\t\t       DA7218_OUTFILT_1R_INDAI_1L_GAIN_SHIFT,\n\t\t       DA7218_DMIX_GAIN_MAX, DA7218_NO_INVERT,\n\t\t       da7218_dmix_gain_tlv),\n\n\tSOC_SINGLE_TLV(\"DMix In DAIR Out FilterL Volume\",\n\t\t       DA7218_DMIX_OUTFILT_1L_INDAI_1R_GAIN,\n\t\t       DA7218_OUTFILT_1L_INDAI_1R_GAIN_SHIFT,\n\t\t       DA7218_DMIX_GAIN_MAX, DA7218_NO_INVERT,\n\t\t       da7218_dmix_gain_tlv),\n\tSOC_SINGLE_TLV(\"DMix In DAIR Out FilterR Volume\",\n\t\t       DA7218_DMIX_OUTFILT_1R_INDAI_1R_GAIN,\n\t\t       DA7218_OUTFILT_1R_INDAI_1R_GAIN_SHIFT,\n\t\t       DA7218_DMIX_GAIN_MAX, DA7218_NO_INVERT,\n\t\t       da7218_dmix_gain_tlv),\n\n\t \n\tSND_SOC_BYTES_EXT(\"Sidetone BiQuad Coefficients\",\n\t\t\t  DA7218_SIDETONE_BIQ_3STAGE_CFG_SIZE,\n\t\t\t  da7218_biquad_coeff_get, da7218_biquad_coeff_put),\n\tSOC_SINGLE_TLV(\"Sidetone Volume\", DA7218_SIDETONE_GAIN,\n\t\t       DA7218_SIDETONE_GAIN_SHIFT, DA7218_DMIX_GAIN_MAX,\n\t\t       DA7218_NO_INVERT, da7218_dmix_gain_tlv),\n\tSOC_SINGLE(\"Sidetone Switch\", DA7218_SIDETONE_CTRL,\n\t\t   DA7218_SIDETONE_MUTE_EN_SHIFT, DA7218_SWITCH_EN_MAX,\n\t\t   DA7218_INVERT),\n\n\t \n\tSOC_ENUM(\"ToneGen DTMF Key\", da7218_tonegen_dtmf_key),\n\tSOC_SINGLE(\"ToneGen DTMF Switch\", DA7218_TONE_GEN_CFG1,\n\t\t   DA7218_DTMF_EN_SHIFT, DA7218_SWITCH_EN_MAX,\n\t\t   DA7218_NO_INVERT),\n\tSOC_ENUM(\"ToneGen Sinewave Gen Type\", da7218_tonegen_swg_sel),\n\tSOC_SINGLE_EXT(\"ToneGen Sinewave1 Freq\", DA7218_TONE_GEN_FREQ1_L,\n\t\t       DA7218_FREQ1_L_SHIFT, DA7218_FREQ_MAX, DA7218_NO_INVERT,\n\t\t       da7218_tonegen_freq_get, da7218_tonegen_freq_put),\n\tSOC_SINGLE_EXT(\"ToneGen Sinewave2 Freq\", DA7218_TONE_GEN_FREQ2_L,\n\t\t       DA7218_FREQ2_L_SHIFT, DA7218_FREQ_MAX, DA7218_NO_INVERT,\n\t\t       da7218_tonegen_freq_get, da7218_tonegen_freq_put),\n\tSOC_SINGLE(\"ToneGen On Time\", DA7218_TONE_GEN_ON_PER,\n\t\t   DA7218_BEEP_ON_PER_SHIFT, DA7218_BEEP_ON_OFF_MAX,\n\t\t   DA7218_NO_INVERT),\n\tSOC_SINGLE(\"ToneGen Off Time\", DA7218_TONE_GEN_OFF_PER,\n\t\t   DA7218_BEEP_OFF_PER_SHIFT, DA7218_BEEP_ON_OFF_MAX,\n\t\t   DA7218_NO_INVERT),\n\n\t \n\tSOC_ENUM(\"Gain Ramp Rate\", da7218_gain_ramp_rate),\n\n\t \n\tSOC_SINGLE_TLV(\"DGS Trigger\", DA7218_DGS_TRIGGER,\n\t\t       DA7218_DGS_TRIGGER_LVL_SHIFT, DA7218_DGS_TRIGGER_MAX,\n\t\t       DA7218_INVERT, da7218_dgs_trigger_tlv),\n\tSOC_ENUM(\"DGS Rise Coefficient\", da7218_dgs_rise_coeff),\n\tSOC_ENUM(\"DGS Fall Coefficient\", da7218_dgs_fall_coeff),\n\tSOC_SINGLE(\"DGS Sync Delay\", DA7218_DGS_SYNC_DELAY,\n\t\t   DA7218_DGS_SYNC_DELAY_SHIFT, DA7218_DGS_SYNC_DELAY_MAX,\n\t\t   DA7218_NO_INVERT),\n\tSOC_SINGLE(\"DGS Fast SR Sync Delay\", DA7218_DGS_SYNC_DELAY2,\n\t\t   DA7218_DGS_SYNC_DELAY2_SHIFT, DA7218_DGS_SYNC_DELAY_MAX,\n\t\t   DA7218_NO_INVERT),\n\tSOC_SINGLE(\"DGS Voice Filter Sync Delay\", DA7218_DGS_SYNC_DELAY3,\n\t\t   DA7218_DGS_SYNC_DELAY3_SHIFT, DA7218_DGS_SYNC_DELAY3_MAX,\n\t\t   DA7218_NO_INVERT),\n\tSOC_SINGLE_TLV(\"DGS Anticlip Level\", DA7218_DGS_LEVELS,\n\t\t       DA7218_DGS_ANTICLIP_LVL_SHIFT,\n\t\t       DA7218_DGS_ANTICLIP_LVL_MAX, DA7218_INVERT,\n\t\t       da7218_dgs_anticlip_tlv),\n\tSOC_SINGLE_TLV(\"DGS Signal Level\", DA7218_DGS_LEVELS,\n\t\t       DA7218_DGS_SIGNAL_LVL_SHIFT, DA7218_DGS_SIGNAL_LVL_MAX,\n\t\t       DA7218_INVERT, da7218_dgs_signal_tlv),\n\tSOC_SINGLE(\"DGS Gain Subrange Switch\", DA7218_DGS_GAIN_CTRL,\n\t\t   DA7218_DGS_SUBR_EN_SHIFT, DA7218_SWITCH_EN_MAX,\n\t\t   DA7218_NO_INVERT),\n\tSOC_SINGLE(\"DGS Gain Ramp Switch\", DA7218_DGS_GAIN_CTRL,\n\t\t   DA7218_DGS_RAMP_EN_SHIFT, DA7218_SWITCH_EN_MAX,\n\t\t   DA7218_NO_INVERT),\n\tSOC_SINGLE(\"DGS Gain Steps\", DA7218_DGS_GAIN_CTRL,\n\t\t   DA7218_DGS_STEPS_SHIFT, DA7218_DGS_STEPS_MAX,\n\t\t   DA7218_NO_INVERT),\n\tSOC_DOUBLE(\"DGS Switch\", DA7218_DGS_ENABLE, DA7218_DGS_ENABLE_L_SHIFT,\n\t\t   DA7218_DGS_ENABLE_R_SHIFT, DA7218_SWITCH_EN_MAX,\n\t\t   DA7218_NO_INVERT),\n\n\t \n\tSOC_ENUM(\"Out Filter HPF Mode\", da7218_out1_hpf_mode),\n\tSOC_ENUM(\"Out Filter HPF Corner Audio\", da7218_out1_audio_hpf_corner),\n\tSOC_ENUM(\"Out Filter HPF Corner Voice\", da7218_out1_voice_hpf_corner),\n\n\t \n\tSOC_SINGLE_TLV(\"Out EQ Band1 Volume\", DA7218_OUT_1_EQ_12_FILTER_CTRL,\n\t\t       DA7218_OUT_1_EQ_BAND1_SHIFT, DA7218_OUT_EQ_BAND_MAX,\n\t\t       DA7218_NO_INVERT, da7218_out_eq_band_tlv),\n\tSOC_SINGLE_TLV(\"Out EQ Band2 Volume\", DA7218_OUT_1_EQ_12_FILTER_CTRL,\n\t\t       DA7218_OUT_1_EQ_BAND2_SHIFT, DA7218_OUT_EQ_BAND_MAX,\n\t\t       DA7218_NO_INVERT, da7218_out_eq_band_tlv),\n\tSOC_SINGLE_TLV(\"Out EQ Band3 Volume\", DA7218_OUT_1_EQ_34_FILTER_CTRL,\n\t\t       DA7218_OUT_1_EQ_BAND3_SHIFT, DA7218_OUT_EQ_BAND_MAX,\n\t\t       DA7218_NO_INVERT, da7218_out_eq_band_tlv),\n\tSOC_SINGLE_TLV(\"Out EQ Band4 Volume\", DA7218_OUT_1_EQ_34_FILTER_CTRL,\n\t\t       DA7218_OUT_1_EQ_BAND4_SHIFT, DA7218_OUT_EQ_BAND_MAX,\n\t\t       DA7218_NO_INVERT, da7218_out_eq_band_tlv),\n\tSOC_SINGLE_TLV(\"Out EQ Band5 Volume\", DA7218_OUT_1_EQ_5_FILTER_CTRL,\n\t\t       DA7218_OUT_1_EQ_BAND5_SHIFT, DA7218_OUT_EQ_BAND_MAX,\n\t\t       DA7218_NO_INVERT, da7218_out_eq_band_tlv),\n\tSOC_SINGLE(\"Out EQ Switch\", DA7218_OUT_1_EQ_5_FILTER_CTRL,\n\t\t   DA7218_OUT_1_EQ_EN_SHIFT, DA7218_SWITCH_EN_MAX,\n\t\t   DA7218_NO_INVERT),\n\n\t \n\tSND_SOC_BYTES_EXT(\"BiQuad Coefficients\",\n\t\t\t  DA7218_OUT_1_BIQ_5STAGE_CFG_SIZE,\n\t\t\t  da7218_biquad_coeff_get, da7218_biquad_coeff_put),\n\tSOC_SINGLE(\"BiQuad Filter Switch\", DA7218_OUT_1_BIQ_5STAGE_CTRL,\n\t\t   DA7218_OUT_1_BIQ_5STAGE_MUTE_EN_SHIFT, DA7218_SWITCH_EN_MAX,\n\t\t   DA7218_INVERT),\n\n\t \n\tSOC_DOUBLE_R_RANGE_TLV(\"Out Filter Volume\", DA7218_OUT_1L_GAIN,\n\t\t\t       DA7218_OUT_1R_GAIN,\n\t\t\t       DA7218_OUT_1L_DIGITAL_GAIN_SHIFT,\n\t\t\t       DA7218_OUT_DIGITAL_GAIN_MIN,\n\t\t\t       DA7218_OUT_DIGITAL_GAIN_MAX, DA7218_NO_INVERT,\n\t\t\t       da7218_out_dig_gain_tlv),\n\tSOC_DOUBLE_R(\"Out Filter Switch\", DA7218_OUT_1L_FILTER_CTRL,\n\t\t     DA7218_OUT_1R_FILTER_CTRL, DA7218_OUT_1L_MUTE_EN_SHIFT,\n\t\t     DA7218_SWITCH_EN_MAX, DA7218_INVERT),\n\tSOC_DOUBLE_R(\"Out Filter Gain Subrange Switch\",\n\t\t     DA7218_OUT_1L_FILTER_CTRL, DA7218_OUT_1R_FILTER_CTRL,\n\t\t     DA7218_OUT_1L_SUBRANGE_EN_SHIFT, DA7218_SWITCH_EN_MAX,\n\t\t     DA7218_NO_INVERT),\n\tSOC_DOUBLE_R(\"Out Filter Gain Ramp Switch\", DA7218_OUT_1L_FILTER_CTRL,\n\t\t     DA7218_OUT_1R_FILTER_CTRL, DA7218_OUT_1L_RAMP_EN_SHIFT,\n\t\t     DA7218_SWITCH_EN_MAX, DA7218_NO_INVERT),\n\n\t \n\tSOC_DOUBLE_R_RANGE_TLV(\"Mixout Volume\", DA7218_MIXOUT_L_GAIN,\n\t\t\t       DA7218_MIXOUT_R_GAIN,\n\t\t\t       DA7218_MIXOUT_L_AMP_GAIN_SHIFT,\n\t\t\t       DA7218_MIXOUT_AMP_GAIN_MIN,\n\t\t\t       DA7218_MIXOUT_AMP_GAIN_MAX, DA7218_NO_INVERT,\n\t\t\t       da7218_mixout_gain_tlv),\n\n\t \n\tSOC_ENUM(\"DAC NG Setup Time\", da7218_dac_ng_setup_time),\n\tSOC_ENUM(\"DAC NG Rampup Rate\", da7218_dac_ng_rampup_rate),\n\tSOC_ENUM(\"DAC NG Rampdown Rate\", da7218_dac_ng_rampdown_rate),\n\tSOC_SINGLE_TLV(\"DAC NG Off Threshold\", DA7218_DAC_NG_OFF_THRESH,\n\t\t       DA7218_DAC_NG_OFF_THRESHOLD_SHIFT,\n\t\t       DA7218_DAC_NG_THRESHOLD_MAX, DA7218_NO_INVERT,\n\t\t       da7218_dac_ng_threshold_tlv),\n\tSOC_SINGLE_TLV(\"DAC NG On Threshold\", DA7218_DAC_NG_ON_THRESH,\n\t\t       DA7218_DAC_NG_ON_THRESHOLD_SHIFT,\n\t\t       DA7218_DAC_NG_THRESHOLD_MAX, DA7218_NO_INVERT,\n\t\t       da7218_dac_ng_threshold_tlv),\n\tSOC_SINGLE(\"DAC NG Switch\", DA7218_DAC_NG_CTRL, DA7218_DAC_NG_EN_SHIFT,\n\t\t   DA7218_SWITCH_EN_MAX, DA7218_NO_INVERT),\n\n\t \n\tSOC_ENUM(\"Charge Pump Track Mode\", da7218_cp_mchange),\n\tSOC_ENUM(\"Charge Pump Frequency\", da7218_cp_fcontrol),\n\tSOC_ENUM(\"Charge Pump Decay Rate\", da7218_cp_tau_delay),\n\tSOC_SINGLE(\"Charge Pump Threshold\", DA7218_CP_VOL_THRESHOLD1,\n\t\t   DA7218_CP_THRESH_VDD2_SHIFT, DA7218_CP_THRESH_VDD2_MAX,\n\t\t   DA7218_NO_INVERT),\n\n\t \n\tSOC_DOUBLE_R_RANGE_TLV(\"Headphone Volume\", DA7218_HP_L_GAIN,\n\t\t\t       DA7218_HP_R_GAIN, DA7218_HP_L_AMP_GAIN_SHIFT,\n\t\t\t       DA7218_HP_AMP_GAIN_MIN, DA7218_HP_AMP_GAIN_MAX,\n\t\t\t       DA7218_NO_INVERT, da7218_hp_gain_tlv),\n\tSOC_DOUBLE_R(\"Headphone Switch\", DA7218_HP_L_CTRL, DA7218_HP_R_CTRL,\n\t\t     DA7218_HP_L_AMP_MUTE_EN_SHIFT, DA7218_SWITCH_EN_MAX,\n\t\t     DA7218_INVERT),\n\tSOC_DOUBLE_R(\"Headphone Gain Ramp Switch\", DA7218_HP_L_CTRL,\n\t\t     DA7218_HP_R_CTRL, DA7218_HP_L_AMP_RAMP_EN_SHIFT,\n\t\t     DA7218_SWITCH_EN_MAX, DA7218_NO_INVERT),\n\tSOC_DOUBLE_R(\"Headphone ZC Gain Switch\", DA7218_HP_L_CTRL,\n\t\t     DA7218_HP_R_CTRL, DA7218_HP_L_AMP_ZC_EN_SHIFT,\n\t\t     DA7218_SWITCH_EN_MAX, DA7218_NO_INVERT),\n};\n\n\n \n\nstatic const char * const da7218_mic_sel_text[] = { \"Analog\", \"Digital\" };\n\nstatic const struct soc_enum da7218_mic1_sel =\n\tSOC_ENUM_SINGLE_EXT(ARRAY_SIZE(da7218_mic_sel_text),\n\t\t\t    da7218_mic_sel_text);\n\nstatic const struct snd_kcontrol_new da7218_mic1_sel_mux =\n\tSOC_DAPM_ENUM(\"Mic1 Mux\", da7218_mic1_sel);\n\nstatic const struct soc_enum da7218_mic2_sel =\n\tSOC_ENUM_SINGLE_EXT(ARRAY_SIZE(da7218_mic_sel_text),\n\t\t\t    da7218_mic_sel_text);\n\nstatic const struct snd_kcontrol_new da7218_mic2_sel_mux =\n\tSOC_DAPM_ENUM(\"Mic2 Mux\", da7218_mic2_sel);\n\nstatic const char * const da7218_sidetone_in_sel_txt[] = {\n\t\"In Filter1L\", \"In Filter1R\", \"In Filter2L\", \"In Filter2R\"\n};\n\nstatic const struct soc_enum da7218_sidetone_in_sel =\n\tSOC_ENUM_SINGLE(DA7218_SIDETONE_IN_SELECT,\n\t\t\tDA7218_SIDETONE_IN_SELECT_SHIFT,\n\t\t\tDA7218_SIDETONE_IN_SELECT_MAX,\n\t\t\tda7218_sidetone_in_sel_txt);\n\nstatic const struct snd_kcontrol_new da7218_sidetone_in_sel_mux =\n\tSOC_DAPM_ENUM(\"Sidetone Mux\", da7218_sidetone_in_sel);\n\nstatic const char * const da7218_out_filt_biq_sel_txt[] = {\n\t\"Bypass\", \"Enabled\"\n};\n\nstatic const struct soc_enum da7218_out_filtl_biq_sel =\n\tSOC_ENUM_SINGLE(DA7218_OUT_1L_FILTER_CTRL,\n\t\t\tDA7218_OUT_1L_BIQ_5STAGE_SEL_SHIFT,\n\t\t\tDA7218_OUT_BIQ_5STAGE_SEL_MAX,\n\t\t\tda7218_out_filt_biq_sel_txt);\n\nstatic const struct snd_kcontrol_new da7218_out_filtl_biq_sel_mux =\n\tSOC_DAPM_ENUM(\"Out FilterL BiQuad Mux\", da7218_out_filtl_biq_sel);\n\nstatic const struct soc_enum da7218_out_filtr_biq_sel =\n\tSOC_ENUM_SINGLE(DA7218_OUT_1R_FILTER_CTRL,\n\t\t\tDA7218_OUT_1R_BIQ_5STAGE_SEL_SHIFT,\n\t\t\tDA7218_OUT_BIQ_5STAGE_SEL_MAX,\n\t\t\tda7218_out_filt_biq_sel_txt);\n\nstatic const struct snd_kcontrol_new da7218_out_filtr_biq_sel_mux =\n\tSOC_DAPM_ENUM(\"Out FilterR BiQuad Mux\", da7218_out_filtr_biq_sel);\n\n\n \n\n#define DA7218_DMIX_CTRLS(reg)\t\t\t\t\t\t\\\n\tSOC_DAPM_SINGLE(\"In Filter1L Switch\", reg,\t\t\t\\\n\t\t\tDA7218_DMIX_SRC_INFILT1L,\t\t\t\\\n\t\t\tDA7218_SWITCH_EN_MAX, DA7218_NO_INVERT),\t\\\n\tSOC_DAPM_SINGLE(\"In Filter1R Switch\", reg,\t\t\t\\\n\t\t\tDA7218_DMIX_SRC_INFILT1R,\t\t\t\\\n\t\t\tDA7218_SWITCH_EN_MAX, DA7218_NO_INVERT),\t\\\n\tSOC_DAPM_SINGLE(\"In Filter2L Switch\", reg,\t\t\t\\\n\t\t\tDA7218_DMIX_SRC_INFILT2L,\t\t\t\\\n\t\t\tDA7218_SWITCH_EN_MAX, DA7218_NO_INVERT),\t\\\n\tSOC_DAPM_SINGLE(\"In Filter2R Switch\", reg,\t\t\t\\\n\t\t\tDA7218_DMIX_SRC_INFILT2R,\t\t\t\\\n\t\t\tDA7218_SWITCH_EN_MAX, DA7218_NO_INVERT),\t\\\n\tSOC_DAPM_SINGLE(\"ToneGen Switch\", reg,\t\t\t\t\\\n\t\t\tDA7218_DMIX_SRC_TONEGEN,\t\t\t\\\n\t\t\tDA7218_SWITCH_EN_MAX, DA7218_NO_INVERT),\t\\\n\tSOC_DAPM_SINGLE(\"DAIL Switch\", reg, DA7218_DMIX_SRC_DAIL,\t\\\n\t\t\tDA7218_SWITCH_EN_MAX, DA7218_NO_INVERT),\t\\\n\tSOC_DAPM_SINGLE(\"DAIR Switch\", reg, DA7218_DMIX_SRC_DAIR,\t\\\n\t\t\tDA7218_SWITCH_EN_MAX, DA7218_NO_INVERT)\n\nstatic const struct snd_kcontrol_new da7218_out_dai1l_mix_controls[] = {\n\tDA7218_DMIX_CTRLS(DA7218_DROUTING_OUTDAI_1L),\n};\n\nstatic const struct snd_kcontrol_new da7218_out_dai1r_mix_controls[] = {\n\tDA7218_DMIX_CTRLS(DA7218_DROUTING_OUTDAI_1R),\n};\n\nstatic const struct snd_kcontrol_new da7218_out_dai2l_mix_controls[] = {\n\tDA7218_DMIX_CTRLS(DA7218_DROUTING_OUTDAI_2L),\n};\n\nstatic const struct snd_kcontrol_new da7218_out_dai2r_mix_controls[] = {\n\tDA7218_DMIX_CTRLS(DA7218_DROUTING_OUTDAI_2R),\n};\n\nstatic const struct snd_kcontrol_new da7218_out_filtl_mix_controls[] = {\n\tDA7218_DMIX_CTRLS(DA7218_DROUTING_OUTFILT_1L),\n};\n\nstatic const struct snd_kcontrol_new da7218_out_filtr_mix_controls[] = {\n\tDA7218_DMIX_CTRLS(DA7218_DROUTING_OUTFILT_1R),\n};\n\n#define DA7218_DMIX_ST_CTRLS(reg)\t\t\t\t\t\\\n\tSOC_DAPM_SINGLE(\"Out FilterL Switch\", reg,\t\t\t\\\n\t\t\tDA7218_DMIX_ST_SRC_OUTFILT1L,\t\t\t\\\n\t\t\tDA7218_SWITCH_EN_MAX, DA7218_NO_INVERT),\t\\\n\tSOC_DAPM_SINGLE(\"Out FilterR Switch\", reg,\t\t\t\\\n\t\t\tDA7218_DMIX_ST_SRC_OUTFILT1R,\t\t\t\\\n\t\t\tDA7218_SWITCH_EN_MAX, DA7218_NO_INVERT),\t\\\n\tSOC_DAPM_SINGLE(\"Sidetone Switch\", reg,\t\t\t\t\\\n\t\t\tDA7218_DMIX_ST_SRC_SIDETONE,\t\t\t\\\n\t\t\tDA7218_SWITCH_EN_MAX, DA7218_NO_INVERT)\t\t\\\n\nstatic const struct snd_kcontrol_new da7218_st_out_filtl_mix_controls[] = {\n\tDA7218_DMIX_ST_CTRLS(DA7218_DROUTING_ST_OUTFILT_1L),\n};\n\nstatic const struct snd_kcontrol_new da7218_st_out_filtr_mix_controls[] = {\n\tDA7218_DMIX_ST_CTRLS(DA7218_DROUTING_ST_OUTFILT_1R),\n};\n\n\n \n\n \nstatic int da7218_in_filter_event(struct snd_soc_dapm_widget *w,\n\t\t\t\t  struct snd_kcontrol *kcontrol, int event)\n{\n\tstruct snd_soc_component *component = snd_soc_dapm_to_component(w->dapm);\n\tstruct da7218_priv *da7218 = snd_soc_component_get_drvdata(component);\n\tu8 mask;\n\n\tswitch (w->reg) {\n\tcase DA7218_IN_1L_FILTER_CTRL:\n\t\tmask = (1 << DA7218_LVL_DET_EN_CHAN1L_SHIFT);\n\t\tbreak;\n\tcase DA7218_IN_1R_FILTER_CTRL:\n\t\tmask = (1 << DA7218_LVL_DET_EN_CHAN1R_SHIFT);\n\t\tbreak;\n\tcase DA7218_IN_2L_FILTER_CTRL:\n\t\tmask = (1 << DA7218_LVL_DET_EN_CHAN2L_SHIFT);\n\t\tbreak;\n\tcase DA7218_IN_2R_FILTER_CTRL:\n\t\tmask = (1 << DA7218_LVL_DET_EN_CHAN2R_SHIFT);\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tswitch (event) {\n\tcase SND_SOC_DAPM_POST_PMU:\n\t\tda7218->in_filt_en |= mask;\n\t\t \n\t\tif (mask & da7218->mic_lvl_det_en)\n\t\t\tmsleep(DA7218_MIC_LVL_DET_DELAY);\n\t\tbreak;\n\tcase SND_SOC_DAPM_PRE_PMD:\n\t\tda7218->in_filt_en &= ~mask;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\t \n\tsnd_soc_component_write(component, DA7218_LVL_DET_CTRL,\n\t\t      (da7218->in_filt_en & da7218->mic_lvl_det_en));\n\n\treturn 0;\n}\n\nstatic int da7218_dai_event(struct snd_soc_dapm_widget *w,\n\t\t\t    struct snd_kcontrol *kcontrol, int event)\n{\n\tstruct snd_soc_component *component = snd_soc_dapm_to_component(w->dapm);\n\tstruct da7218_priv *da7218 = snd_soc_component_get_drvdata(component);\n\tu8 pll_ctrl, pll_status, refosc_cal;\n\tint i;\n\tbool success;\n\n\tswitch (event) {\n\tcase SND_SOC_DAPM_POST_PMU:\n\t\tif (da7218->master)\n\t\t\t \n\t\t\tsnd_soc_component_update_bits(component, DA7218_DAI_CLK_MODE,\n\t\t\t\t\t    DA7218_DAI_CLK_EN_MASK,\n\t\t\t\t\t    DA7218_DAI_CLK_EN_MASK);\n\n\t\t \n\t\tsnd_soc_component_write(component, DA7218_PLL_REFOSC_CAL,\n\t\t\t      DA7218_PLL_REFOSC_CAL_START_MASK);\n\t\tsnd_soc_component_write(component, DA7218_PLL_REFOSC_CAL,\n\t\t\t      DA7218_PLL_REFOSC_CAL_START_MASK |\n\t\t\t      DA7218_PLL_REFOSC_CAL_EN_MASK);\n\n\t\t \n\t\ti = 0;\n\t\tsuccess = false;\n\t\tdo {\n\t\t\trefosc_cal = snd_soc_component_read(component, DA7218_PLL_REFOSC_CAL);\n\t\t\tif (!(refosc_cal & DA7218_PLL_REFOSC_CAL_START_MASK)) {\n\t\t\t\tsuccess = true;\n\t\t\t} else {\n\t\t\t\t++i;\n\t\t\t\tusleep_range(DA7218_REF_OSC_CHECK_DELAY_MIN,\n\t\t\t\t\t     DA7218_REF_OSC_CHECK_DELAY_MAX);\n\t\t\t}\n\t\t} while ((i < DA7218_REF_OSC_CHECK_TRIES) && (!success));\n\n\t\tif (!success)\n\t\t\tdev_warn(component->dev,\n\t\t\t\t \"Reference oscillator failed calibration\\n\");\n\n\t\t \n\t\tsnd_soc_component_write(component, DA7218_PC_COUNT,\n\t\t\t      DA7218_PC_RESYNC_AUTO_MASK);\n\n\t\t \n\t\tpll_ctrl = snd_soc_component_read(component, DA7218_PLL_CTRL);\n\t\tif ((pll_ctrl & DA7218_PLL_MODE_MASK) != DA7218_PLL_MODE_SRM)\n\t\t\treturn 0;\n\n\t\t \n\t\ti = 0;\n\t\tsuccess = false;\n\t\tdo {\n\t\t\tpll_status = snd_soc_component_read(component, DA7218_PLL_STATUS);\n\t\t\tif (pll_status & DA7218_PLL_SRM_STATUS_SRM_LOCK) {\n\t\t\t\tsuccess = true;\n\t\t\t} else {\n\t\t\t\t++i;\n\t\t\t\tmsleep(DA7218_SRM_CHECK_DELAY);\n\t\t\t}\n\t\t} while ((i < DA7218_SRM_CHECK_TRIES) && (!success));\n\n\t\tif (!success)\n\t\t\tdev_warn(component->dev, \"SRM failed to lock\\n\");\n\n\t\treturn 0;\n\tcase SND_SOC_DAPM_POST_PMD:\n\t\t \n\t\tsnd_soc_component_write(component, DA7218_PC_COUNT, DA7218_PC_FREERUN_MASK);\n\n\t\tif (da7218->master)\n\t\t\t \n\t\t\tsnd_soc_component_update_bits(component, DA7218_DAI_CLK_MODE,\n\t\t\t\t\t    DA7218_DAI_CLK_EN_MASK, 0);\n\n\t\treturn 0;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n}\n\nstatic int da7218_cp_event(struct snd_soc_dapm_widget *w,\n\t\t\t   struct snd_kcontrol *kcontrol, int event)\n{\n\tstruct snd_soc_component *component = snd_soc_dapm_to_component(w->dapm);\n\tstruct da7218_priv *da7218 = snd_soc_component_get_drvdata(component);\n\n\t \n\tif (da7218->hp_single_supply)\n\t\treturn 0;\n\n\tswitch (event) {\n\tcase SND_SOC_DAPM_PRE_PMU:\n\t\tsnd_soc_component_update_bits(component, DA7218_CP_CTRL, DA7218_CP_EN_MASK,\n\t\t\t\t    DA7218_CP_EN_MASK);\n\t\treturn 0;\n\tcase SND_SOC_DAPM_PRE_PMD:\n\t\tsnd_soc_component_update_bits(component, DA7218_CP_CTRL, DA7218_CP_EN_MASK,\n\t\t\t\t    0);\n\t\treturn 0;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n}\n\nstatic int da7218_hp_pga_event(struct snd_soc_dapm_widget *w,\n\t\t\t       struct snd_kcontrol *kcontrol, int event)\n{\n\tstruct snd_soc_component *component = snd_soc_dapm_to_component(w->dapm);\n\n\tswitch (event) {\n\tcase SND_SOC_DAPM_POST_PMU:\n\t\t \n\t\tsnd_soc_component_update_bits(component, w->reg, DA7218_HP_AMP_OE_MASK,\n\t\t\t\t    DA7218_HP_AMP_OE_MASK);\n\t\treturn 0;\n\tcase SND_SOC_DAPM_PRE_PMD:\n\t\t \n\t\tsnd_soc_component_update_bits(component, w->reg, DA7218_HP_AMP_OE_MASK, 0);\n\t\treturn 0;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n}\n\n\n \n\nstatic const struct snd_soc_dapm_widget da7218_dapm_widgets[] = {\n\t \n\tSND_SOC_DAPM_SUPPLY(\"Mic Bias1\", DA7218_MICBIAS_EN,\n\t\t\t    DA7218_MICBIAS_1_EN_SHIFT, DA7218_NO_INVERT,\n\t\t\t    NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"Mic Bias2\", DA7218_MICBIAS_EN,\n\t\t\t    DA7218_MICBIAS_2_EN_SHIFT, DA7218_NO_INVERT,\n\t\t\t    NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"DMic1 Left\", DA7218_DMIC_1_CTRL,\n\t\t\t    DA7218_DMIC_1L_EN_SHIFT, DA7218_NO_INVERT,\n\t\t\t    NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"DMic1 Right\", DA7218_DMIC_1_CTRL,\n\t\t\t    DA7218_DMIC_1R_EN_SHIFT, DA7218_NO_INVERT,\n\t\t\t    NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"DMic2 Left\", DA7218_DMIC_2_CTRL,\n\t\t\t    DA7218_DMIC_2L_EN_SHIFT, DA7218_NO_INVERT,\n\t\t\t    NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"DMic2 Right\", DA7218_DMIC_2_CTRL,\n\t\t\t    DA7218_DMIC_2R_EN_SHIFT, DA7218_NO_INVERT,\n\t\t\t    NULL, 0),\n\n\t \n\tSND_SOC_DAPM_INPUT(\"MIC1\"),\n\tSND_SOC_DAPM_INPUT(\"MIC2\"),\n\tSND_SOC_DAPM_INPUT(\"DMIC1L\"),\n\tSND_SOC_DAPM_INPUT(\"DMIC1R\"),\n\tSND_SOC_DAPM_INPUT(\"DMIC2L\"),\n\tSND_SOC_DAPM_INPUT(\"DMIC2R\"),\n\n\t \n\tSND_SOC_DAPM_SUPPLY(\"Mixin1 Supply\", DA7218_MIXIN_1_CTRL,\n\t\t\t    DA7218_MIXIN_1_MIX_SEL_SHIFT, DA7218_NO_INVERT,\n\t\t\t    NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"Mixin2 Supply\", DA7218_MIXIN_2_CTRL,\n\t\t\t    DA7218_MIXIN_2_MIX_SEL_SHIFT, DA7218_NO_INVERT,\n\t\t\t    NULL, 0),\n\n\t \n\tSND_SOC_DAPM_PGA(\"Mic1 PGA\", DA7218_MIC_1_CTRL,\n\t\t\t DA7218_MIC_1_AMP_EN_SHIFT, DA7218_NO_INVERT,\n\t\t\t NULL, 0),\n\tSND_SOC_DAPM_PGA(\"Mic2 PGA\", DA7218_MIC_2_CTRL,\n\t\t\t DA7218_MIC_2_AMP_EN_SHIFT, DA7218_NO_INVERT,\n\t\t\t NULL, 0),\n\tSND_SOC_DAPM_PGA(\"Mixin1 PGA\", DA7218_MIXIN_1_CTRL,\n\t\t\t DA7218_MIXIN_1_AMP_EN_SHIFT, DA7218_NO_INVERT,\n\t\t\t NULL, 0),\n\tSND_SOC_DAPM_PGA(\"Mixin2 PGA\", DA7218_MIXIN_2_CTRL,\n\t\t\t DA7218_MIXIN_2_AMP_EN_SHIFT, DA7218_NO_INVERT,\n\t\t\t NULL, 0),\n\n\t \n\tSND_SOC_DAPM_MUX(\"Mic1 Mux\", SND_SOC_NOPM, 0, 0, &da7218_mic1_sel_mux),\n\tSND_SOC_DAPM_MUX(\"Mic2 Mux\", SND_SOC_NOPM, 0, 0, &da7218_mic2_sel_mux),\n\n\t \n\tSND_SOC_DAPM_ADC_E(\"In Filter1L\", NULL, DA7218_IN_1L_FILTER_CTRL,\n\t\t\t   DA7218_IN_1L_FILTER_EN_SHIFT, DA7218_NO_INVERT,\n\t\t\t   da7218_in_filter_event,\n\t\t\t   SND_SOC_DAPM_POST_PMU | SND_SOC_DAPM_PRE_PMD),\n\tSND_SOC_DAPM_ADC_E(\"In Filter1R\", NULL, DA7218_IN_1R_FILTER_CTRL,\n\t\t\t   DA7218_IN_1R_FILTER_EN_SHIFT, DA7218_NO_INVERT,\n\t\t\t   da7218_in_filter_event,\n\t\t\t   SND_SOC_DAPM_POST_PMU | SND_SOC_DAPM_PRE_PMD),\n\tSND_SOC_DAPM_ADC_E(\"In Filter2L\", NULL, DA7218_IN_2L_FILTER_CTRL,\n\t\t\t   DA7218_IN_2L_FILTER_EN_SHIFT, DA7218_NO_INVERT,\n\t\t\t   da7218_in_filter_event,\n\t\t\t   SND_SOC_DAPM_POST_PMU | SND_SOC_DAPM_PRE_PMD),\n\tSND_SOC_DAPM_ADC_E(\"In Filter2R\", NULL, DA7218_IN_2R_FILTER_CTRL,\n\t\t\t   DA7218_IN_2R_FILTER_EN_SHIFT, DA7218_NO_INVERT,\n\t\t\t   da7218_in_filter_event,\n\t\t\t   SND_SOC_DAPM_POST_PMU | SND_SOC_DAPM_PRE_PMD),\n\n\t \n\tSND_SOC_DAPM_SIGGEN(\"TONE\"),\n\tSND_SOC_DAPM_PGA(\"Tone Generator\", DA7218_TONE_GEN_CFG1,\n\t\t\t DA7218_START_STOPN_SHIFT, DA7218_NO_INVERT, NULL, 0),\n\n\t \n\tSND_SOC_DAPM_MUX(\"Sidetone Mux\", SND_SOC_NOPM, 0, 0,\n\t\t\t &da7218_sidetone_in_sel_mux),\n\tSND_SOC_DAPM_ADC(\"Sidetone Filter\", NULL, DA7218_SIDETONE_CTRL,\n\t\t\t DA7218_SIDETONE_FILTER_EN_SHIFT, DA7218_NO_INVERT),\n\n\t \n\tSND_SOC_DAPM_MIXER(\"Mixer DAI1L\", SND_SOC_NOPM, 0, 0,\n\t\t\t   da7218_out_dai1l_mix_controls,\n\t\t\t   ARRAY_SIZE(da7218_out_dai1l_mix_controls)),\n\tSND_SOC_DAPM_MIXER(\"Mixer DAI1R\", SND_SOC_NOPM, 0, 0,\n\t\t\t   da7218_out_dai1r_mix_controls,\n\t\t\t   ARRAY_SIZE(da7218_out_dai1r_mix_controls)),\n\tSND_SOC_DAPM_MIXER(\"Mixer DAI2L\", SND_SOC_NOPM, 0, 0,\n\t\t\t   da7218_out_dai2l_mix_controls,\n\t\t\t   ARRAY_SIZE(da7218_out_dai2l_mix_controls)),\n\tSND_SOC_DAPM_MIXER(\"Mixer DAI2R\", SND_SOC_NOPM, 0, 0,\n\t\t\t   da7218_out_dai2r_mix_controls,\n\t\t\t   ARRAY_SIZE(da7218_out_dai2r_mix_controls)),\n\n\t \n\tSND_SOC_DAPM_SUPPLY(\"DAI\", DA7218_DAI_CTRL, DA7218_DAI_EN_SHIFT,\n\t\t\t    DA7218_NO_INVERT, da7218_dai_event,\n\t\t\t    SND_SOC_DAPM_POST_PMU | SND_SOC_DAPM_POST_PMD),\n\n\t \n\tSND_SOC_DAPM_AIF_OUT(\"DAIOUT\", \"Capture\", 0, DA7218_DAI_TDM_CTRL,\n\t\t\t     DA7218_DAI_OE_SHIFT, DA7218_NO_INVERT),\n\tSND_SOC_DAPM_AIF_IN(\"DAIIN\", \"Playback\", 0, SND_SOC_NOPM, 0, 0),\n\n\t \n\tSND_SOC_DAPM_MIXER(\"Mixer Out FilterL\", SND_SOC_NOPM, 0, 0,\n\t\t\t   da7218_out_filtl_mix_controls,\n\t\t\t   ARRAY_SIZE(da7218_out_filtl_mix_controls)),\n\tSND_SOC_DAPM_MIXER(\"Mixer Out FilterR\", SND_SOC_NOPM, 0, 0,\n\t\t\t   da7218_out_filtr_mix_controls,\n\t\t\t   ARRAY_SIZE(da7218_out_filtr_mix_controls)),\n\n\t \n\tSND_SOC_DAPM_MUX(\"Out FilterL BiQuad Mux\", SND_SOC_NOPM, 0, 0,\n\t\t\t &da7218_out_filtl_biq_sel_mux),\n\tSND_SOC_DAPM_MUX(\"Out FilterR BiQuad Mux\", SND_SOC_NOPM, 0, 0,\n\t\t\t &da7218_out_filtr_biq_sel_mux),\n\tSND_SOC_DAPM_DAC(\"BiQuad Filter\", NULL, DA7218_OUT_1_BIQ_5STAGE_CTRL,\n\t\t\t DA7218_OUT_1_BIQ_5STAGE_FILTER_EN_SHIFT,\n\t\t\t DA7218_NO_INVERT),\n\n\t \n\tSND_SOC_DAPM_MIXER(\"ST Mixer Out FilterL\", SND_SOC_NOPM, 0, 0,\n\t\t\t   da7218_st_out_filtl_mix_controls,\n\t\t\t   ARRAY_SIZE(da7218_st_out_filtl_mix_controls)),\n\tSND_SOC_DAPM_MIXER(\"ST Mixer Out FilterR\", SND_SOC_NOPM, 0, 0,\n\t\t\t   da7218_st_out_filtr_mix_controls,\n\t\t\t   ARRAY_SIZE(da7218_st_out_filtr_mix_controls)),\n\n\t \n\tSND_SOC_DAPM_DAC(\"Out FilterL\", NULL, DA7218_OUT_1L_FILTER_CTRL,\n\t\t\t DA7218_OUT_1L_FILTER_EN_SHIFT, DA7218_NO_INVERT),\n\tSND_SOC_DAPM_DAC(\"Out FilterR\", NULL, DA7218_OUT_1R_FILTER_CTRL,\n\t\t\t DA7218_IN_1R_FILTER_EN_SHIFT, DA7218_NO_INVERT),\n\n\t \n\tSND_SOC_DAPM_PGA(\"Mixout Left PGA\", DA7218_MIXOUT_L_CTRL,\n\t\t\t DA7218_MIXOUT_L_AMP_EN_SHIFT, DA7218_NO_INVERT,\n\t\t\t NULL, 0),\n\tSND_SOC_DAPM_PGA(\"Mixout Right PGA\", DA7218_MIXOUT_R_CTRL,\n\t\t\t DA7218_MIXOUT_R_AMP_EN_SHIFT, DA7218_NO_INVERT,\n\t\t\t NULL, 0),\n\tSND_SOC_DAPM_PGA_E(\"Headphone Left PGA\", DA7218_HP_L_CTRL,\n\t\t\t   DA7218_HP_L_AMP_EN_SHIFT, DA7218_NO_INVERT, NULL, 0,\n\t\t\t   da7218_hp_pga_event,\n\t\t\t   SND_SOC_DAPM_POST_PMU | SND_SOC_DAPM_PRE_PMD),\n\tSND_SOC_DAPM_PGA_E(\"Headphone Right PGA\", DA7218_HP_R_CTRL,\n\t\t\t   DA7218_HP_R_AMP_EN_SHIFT, DA7218_NO_INVERT, NULL, 0,\n\t\t\t   da7218_hp_pga_event,\n\t\t\t   SND_SOC_DAPM_POST_PMU | SND_SOC_DAPM_PRE_PMD),\n\n\t \n\tSND_SOC_DAPM_SUPPLY(\"Charge Pump\", SND_SOC_NOPM, 0, 0, da7218_cp_event,\n\t\t\t    SND_SOC_DAPM_PRE_PMU | SND_SOC_DAPM_PRE_PMD),\n\n\t \n\tSND_SOC_DAPM_OUTPUT(\"HPL\"),\n\tSND_SOC_DAPM_OUTPUT(\"HPR\"),\n};\n\n\n \n\n#define DA7218_DMIX_ROUTES(name)\t\t\t\t\\\n\t{name, \"In Filter1L Switch\", \"In Filter1L\"},\t\t\\\n\t{name, \"In Filter1R Switch\", \"In Filter1R\"},\t\t\\\n\t{name, \"In Filter2L Switch\", \"In Filter2L\"},\t\t\\\n\t{name, \"In Filter2R Switch\", \"In Filter2R\"},\t\t\\\n\t{name, \"ToneGen Switch\", \"Tone Generator\"},\t\t\\\n\t{name, \"DAIL Switch\", \"DAIIN\"},\t\t\t\t\\\n\t{name, \"DAIR Switch\", \"DAIIN\"}\n\n#define DA7218_DMIX_ST_ROUTES(name)\t\t\t\t\\\n\t{name, \"Out FilterL Switch\", \"Out FilterL BiQuad Mux\"},\t\\\n\t{name, \"Out FilterR Switch\", \"Out FilterR BiQuad Mux\"},\t\\\n\t{name, \"Sidetone Switch\", \"Sidetone Filter\"}\n\n\n \n\nstatic const struct snd_soc_dapm_route da7218_audio_map[] = {\n\t \n\t{\"MIC1\", NULL, \"Mic Bias1\"},\n\t{\"MIC2\", NULL, \"Mic Bias2\"},\n\t{\"DMIC1L\", NULL, \"Mic Bias1\"},\n\t{\"DMIC1L\", NULL, \"DMic1 Left\"},\n\t{\"DMIC1R\", NULL, \"Mic Bias1\"},\n\t{\"DMIC1R\", NULL, \"DMic1 Right\"},\n\t{\"DMIC2L\", NULL, \"Mic Bias2\"},\n\t{\"DMIC2L\", NULL, \"DMic2 Left\"},\n\t{\"DMIC2R\", NULL, \"Mic Bias2\"},\n\t{\"DMIC2R\", NULL, \"DMic2 Right\"},\n\n\t{\"Mic1 PGA\", NULL, \"MIC1\"},\n\t{\"Mic2 PGA\", NULL, \"MIC2\"},\n\n\t{\"Mixin1 PGA\", NULL, \"Mixin1 Supply\"},\n\t{\"Mixin2 PGA\", NULL, \"Mixin2 Supply\"},\n\n\t{\"Mixin1 PGA\", NULL, \"Mic1 PGA\"},\n\t{\"Mixin2 PGA\", NULL, \"Mic2 PGA\"},\n\n\t{\"Mic1 Mux\", \"Analog\", \"Mixin1 PGA\"},\n\t{\"Mic1 Mux\", \"Digital\", \"DMIC1L\"},\n\t{\"Mic1 Mux\", \"Digital\", \"DMIC1R\"},\n\t{\"Mic2 Mux\", \"Analog\", \"Mixin2 PGA\"},\n\t{\"Mic2 Mux\", \"Digital\", \"DMIC2L\"},\n\t{\"Mic2 Mux\", \"Digital\", \"DMIC2R\"},\n\n\t{\"In Filter1L\", NULL, \"Mic1 Mux\"},\n\t{\"In Filter1R\", NULL, \"Mic1 Mux\"},\n\t{\"In Filter2L\", NULL, \"Mic2 Mux\"},\n\t{\"In Filter2R\", NULL, \"Mic2 Mux\"},\n\n\t{\"Tone Generator\", NULL, \"TONE\"},\n\n\t{\"Sidetone Mux\", \"In Filter1L\", \"In Filter1L\"},\n\t{\"Sidetone Mux\", \"In Filter1R\", \"In Filter1R\"},\n\t{\"Sidetone Mux\", \"In Filter2L\", \"In Filter2L\"},\n\t{\"Sidetone Mux\", \"In Filter2R\", \"In Filter2R\"},\n\t{\"Sidetone Filter\", NULL, \"Sidetone Mux\"},\n\n\tDA7218_DMIX_ROUTES(\"Mixer DAI1L\"),\n\tDA7218_DMIX_ROUTES(\"Mixer DAI1R\"),\n\tDA7218_DMIX_ROUTES(\"Mixer DAI2L\"),\n\tDA7218_DMIX_ROUTES(\"Mixer DAI2R\"),\n\n\t{\"DAIOUT\", NULL, \"Mixer DAI1L\"},\n\t{\"DAIOUT\", NULL, \"Mixer DAI1R\"},\n\t{\"DAIOUT\", NULL, \"Mixer DAI2L\"},\n\t{\"DAIOUT\", NULL, \"Mixer DAI2R\"},\n\n\t{\"DAIOUT\", NULL, \"DAI\"},\n\n\t \n\t{\"DAIIN\", NULL, \"DAI\"},\n\n\tDA7218_DMIX_ROUTES(\"Mixer Out FilterL\"),\n\tDA7218_DMIX_ROUTES(\"Mixer Out FilterR\"),\n\n\t{\"BiQuad Filter\", NULL, \"Mixer Out FilterL\"},\n\t{\"BiQuad Filter\", NULL, \"Mixer Out FilterR\"},\n\n\t{\"Out FilterL BiQuad Mux\", \"Bypass\", \"Mixer Out FilterL\"},\n\t{\"Out FilterL BiQuad Mux\", \"Enabled\", \"BiQuad Filter\"},\n\t{\"Out FilterR BiQuad Mux\", \"Bypass\", \"Mixer Out FilterR\"},\n\t{\"Out FilterR BiQuad Mux\", \"Enabled\", \"BiQuad Filter\"},\n\n\tDA7218_DMIX_ST_ROUTES(\"ST Mixer Out FilterL\"),\n\tDA7218_DMIX_ST_ROUTES(\"ST Mixer Out FilterR\"),\n\n\t{\"Out FilterL\", NULL, \"ST Mixer Out FilterL\"},\n\t{\"Out FilterR\", NULL, \"ST Mixer Out FilterR\"},\n\n\t{\"Mixout Left PGA\", NULL, \"Out FilterL\"},\n\t{\"Mixout Right PGA\", NULL, \"Out FilterR\"},\n\n\t{\"Headphone Left PGA\", NULL, \"Mixout Left PGA\"},\n\t{\"Headphone Right PGA\", NULL, \"Mixout Right PGA\"},\n\n\t{\"HPL\", NULL, \"Headphone Left PGA\"},\n\t{\"HPR\", NULL, \"Headphone Right PGA\"},\n\n\t{\"HPL\", NULL, \"Charge Pump\"},\n\t{\"HPR\", NULL, \"Charge Pump\"},\n};\n\n\n \n\nstatic int da7218_set_dai_sysclk(struct snd_soc_dai *codec_dai,\n\t\t\t\t int clk_id, unsigned int freq, int dir)\n{\n\tstruct snd_soc_component *component = codec_dai->component;\n\tstruct da7218_priv *da7218 = snd_soc_component_get_drvdata(component);\n\tint ret;\n\n\tif (da7218->mclk_rate == freq)\n\t\treturn 0;\n\n\tif ((freq < 2000000) || (freq > 54000000)) {\n\t\tdev_err(codec_dai->dev, \"Unsupported MCLK value %d\\n\",\n\t\t\tfreq);\n\t\treturn -EINVAL;\n\t}\n\n\tswitch (clk_id) {\n\tcase DA7218_CLKSRC_MCLK_SQR:\n\t\tsnd_soc_component_update_bits(component, DA7218_PLL_CTRL,\n\t\t\t\t    DA7218_PLL_MCLK_SQR_EN_MASK,\n\t\t\t\t    DA7218_PLL_MCLK_SQR_EN_MASK);\n\t\tbreak;\n\tcase DA7218_CLKSRC_MCLK:\n\t\tsnd_soc_component_update_bits(component, DA7218_PLL_CTRL,\n\t\t\t\t    DA7218_PLL_MCLK_SQR_EN_MASK, 0);\n\t\tbreak;\n\tdefault:\n\t\tdev_err(codec_dai->dev, \"Unknown clock source %d\\n\", clk_id);\n\t\treturn -EINVAL;\n\t}\n\n\tif (da7218->mclk) {\n\t\tfreq = clk_round_rate(da7218->mclk, freq);\n\t\tret = clk_set_rate(da7218->mclk, freq);\n\t\tif (ret) {\n\t\t\tdev_err(codec_dai->dev, \"Failed to set clock rate %d\\n\",\n\t\t\t\tfreq);\n\t\t\treturn ret;\n\t\t}\n\t}\n\n\tda7218->mclk_rate = freq;\n\n\treturn 0;\n}\n\nstatic int da7218_set_dai_pll(struct snd_soc_dai *codec_dai, int pll_id,\n\t\t\t      int source, unsigned int fref, unsigned int fout)\n{\n\tstruct snd_soc_component *component = codec_dai->component;\n\tstruct da7218_priv *da7218 = snd_soc_component_get_drvdata(component);\n\n\tu8 pll_ctrl, indiv_bits, indiv;\n\tu8 pll_frac_top, pll_frac_bot, pll_integer;\n\tu32 freq_ref;\n\tu64 frac_div;\n\n\t \n\tif (da7218->mclk_rate < 2000000) {\n\t\tdev_err(component->dev, \"PLL input clock %d below valid range\\n\",\n\t\t\tda7218->mclk_rate);\n\t\treturn -EINVAL;\n\t} else if (da7218->mclk_rate <= 4500000) {\n\t\tindiv_bits = DA7218_PLL_INDIV_2_TO_4_5_MHZ;\n\t\tindiv = DA7218_PLL_INDIV_2_TO_4_5_MHZ_VAL;\n\t} else if (da7218->mclk_rate <= 9000000) {\n\t\tindiv_bits = DA7218_PLL_INDIV_4_5_TO_9_MHZ;\n\t\tindiv = DA7218_PLL_INDIV_4_5_TO_9_MHZ_VAL;\n\t} else if (da7218->mclk_rate <= 18000000) {\n\t\tindiv_bits = DA7218_PLL_INDIV_9_TO_18_MHZ;\n\t\tindiv = DA7218_PLL_INDIV_9_TO_18_MHZ_VAL;\n\t} else if (da7218->mclk_rate <= 36000000) {\n\t\tindiv_bits = DA7218_PLL_INDIV_18_TO_36_MHZ;\n\t\tindiv = DA7218_PLL_INDIV_18_TO_36_MHZ_VAL;\n\t} else if (da7218->mclk_rate <= 54000000) {\n\t\tindiv_bits = DA7218_PLL_INDIV_36_TO_54_MHZ;\n\t\tindiv = DA7218_PLL_INDIV_36_TO_54_MHZ_VAL;\n\t} else {\n\t\tdev_err(component->dev, \"PLL input clock %d above valid range\\n\",\n\t\t\tda7218->mclk_rate);\n\t\treturn -EINVAL;\n\t}\n\tfreq_ref = (da7218->mclk_rate / indiv);\n\tpll_ctrl = indiv_bits;\n\n\t \n\tswitch (source) {\n\tcase DA7218_SYSCLK_MCLK:\n\t\tpll_ctrl |= DA7218_PLL_MODE_BYPASS;\n\t\tsnd_soc_component_update_bits(component, DA7218_PLL_CTRL,\n\t\t\t\t    DA7218_PLL_INDIV_MASK |\n\t\t\t\t    DA7218_PLL_MODE_MASK, pll_ctrl);\n\t\treturn 0;\n\tcase DA7218_SYSCLK_PLL:\n\t\tpll_ctrl |= DA7218_PLL_MODE_NORMAL;\n\t\tbreak;\n\tcase DA7218_SYSCLK_PLL_SRM:\n\t\tpll_ctrl |= DA7218_PLL_MODE_SRM;\n\t\tbreak;\n\tdefault:\n\t\tdev_err(component->dev, \"Invalid PLL config\\n\");\n\t\treturn -EINVAL;\n\t}\n\n\t \n\tpll_integer = fout / freq_ref;\n\tfrac_div = (u64)(fout % freq_ref) * 8192ULL;\n\tdo_div(frac_div, freq_ref);\n\tpll_frac_top = (frac_div >> DA7218_BYTE_SHIFT) & DA7218_BYTE_MASK;\n\tpll_frac_bot = (frac_div) & DA7218_BYTE_MASK;\n\n\t \n\tsnd_soc_component_write(component, DA7218_PLL_FRAC_TOP, pll_frac_top);\n\tsnd_soc_component_write(component, DA7218_PLL_FRAC_BOT, pll_frac_bot);\n\tsnd_soc_component_write(component, DA7218_PLL_INTEGER, pll_integer);\n\tsnd_soc_component_update_bits(component, DA7218_PLL_CTRL,\n\t\t\t    DA7218_PLL_MODE_MASK | DA7218_PLL_INDIV_MASK,\n\t\t\t    pll_ctrl);\n\n\treturn 0;\n}\n\nstatic int da7218_set_dai_fmt(struct snd_soc_dai *codec_dai, unsigned int fmt)\n{\n\tstruct snd_soc_component *component = codec_dai->component;\n\tstruct da7218_priv *da7218 = snd_soc_component_get_drvdata(component);\n\tu8 dai_clk_mode = 0, dai_ctrl = 0;\n\n\tswitch (fmt & SND_SOC_DAIFMT_MASTER_MASK) {\n\tcase SND_SOC_DAIFMT_CBM_CFM:\n\t\tda7218->master = true;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_CBS_CFS:\n\t\tda7218->master = false;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tswitch (fmt & SND_SOC_DAIFMT_FORMAT_MASK) {\n\tcase SND_SOC_DAIFMT_I2S:\n\tcase SND_SOC_DAIFMT_LEFT_J:\n\tcase SND_SOC_DAIFMT_RIGHT_J:\n\t\tswitch (fmt & SND_SOC_DAIFMT_INV_MASK) {\n\t\tcase SND_SOC_DAIFMT_NB_NF:\n\t\t\tbreak;\n\t\tcase SND_SOC_DAIFMT_NB_IF:\n\t\t\tdai_clk_mode |= DA7218_DAI_WCLK_POL_INV;\n\t\t\tbreak;\n\t\tcase SND_SOC_DAIFMT_IB_NF:\n\t\t\tdai_clk_mode |= DA7218_DAI_CLK_POL_INV;\n\t\t\tbreak;\n\t\tcase SND_SOC_DAIFMT_IB_IF:\n\t\t\tdai_clk_mode |= DA7218_DAI_WCLK_POL_INV |\n\t\t\t\t\tDA7218_DAI_CLK_POL_INV;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn -EINVAL;\n\t\t}\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_DSP_B:\n\t\tswitch (fmt & SND_SOC_DAIFMT_INV_MASK) {\n\t\tcase SND_SOC_DAIFMT_NB_NF:\n\t\t\tdai_clk_mode |= DA7218_DAI_CLK_POL_INV;\n\t\t\tbreak;\n\t\tcase SND_SOC_DAIFMT_NB_IF:\n\t\t\tdai_clk_mode |= DA7218_DAI_WCLK_POL_INV |\n\t\t\t\t\tDA7218_DAI_CLK_POL_INV;\n\t\t\tbreak;\n\t\tcase SND_SOC_DAIFMT_IB_NF:\n\t\t\tbreak;\n\t\tcase SND_SOC_DAIFMT_IB_IF:\n\t\t\tdai_clk_mode |= DA7218_DAI_WCLK_POL_INV;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn -EINVAL;\n\t\t}\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tswitch (fmt & SND_SOC_DAIFMT_FORMAT_MASK) {\n\tcase SND_SOC_DAIFMT_I2S:\n\t\tdai_ctrl |= DA7218_DAI_FORMAT_I2S;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_LEFT_J:\n\t\tdai_ctrl |= DA7218_DAI_FORMAT_LEFT_J;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_RIGHT_J:\n\t\tdai_ctrl |= DA7218_DAI_FORMAT_RIGHT_J;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_DSP_B:\n\t\tdai_ctrl |= DA7218_DAI_FORMAT_DSP;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\t \n\tdai_clk_mode |= DA7218_DAI_BCLKS_PER_WCLK_64;\n\n\tsnd_soc_component_write(component, DA7218_DAI_CLK_MODE, dai_clk_mode);\n\tsnd_soc_component_update_bits(component, DA7218_DAI_CTRL, DA7218_DAI_FORMAT_MASK,\n\t\t\t    dai_ctrl);\n\n\treturn 0;\n}\n\nstatic int da7218_set_dai_tdm_slot(struct snd_soc_dai *dai,\n\t\t\t\t   unsigned int tx_mask, unsigned int rx_mask,\n\t\t\t\t   int slots, int slot_width)\n{\n\tstruct snd_soc_component *component = dai->component;\n\tu8 dai_bclks_per_wclk;\n\tu32 frame_size;\n\n\t \n\tif (!tx_mask) {\n\t\tsnd_soc_component_update_bits(component, DA7218_DAI_TDM_CTRL,\n\t\t\t\t    DA7218_DAI_TDM_CH_EN_MASK |\n\t\t\t\t    DA7218_DAI_TDM_MODE_EN_MASK, 0);\n\t\tsnd_soc_component_update_bits(component, DA7218_DAI_CLK_MODE,\n\t\t\t\t    DA7218_DAI_BCLKS_PER_WCLK_MASK,\n\t\t\t\t    DA7218_DAI_BCLKS_PER_WCLK_64);\n\t\treturn 0;\n\t}\n\n\t \n\tif (fls(tx_mask) > DA7218_DAI_TDM_MAX_SLOTS) {\n\t\tdev_err(component->dev, \"Invalid number of slots, max = %d\\n\",\n\t\t\tDA7218_DAI_TDM_MAX_SLOTS);\n\t\treturn -EINVAL;\n\t}\n\n\t \n\tif (rx_mask >> DA7218_2BYTE_SHIFT) {\n\t\tdev_err(component->dev, \"Invalid slot offset, max = %d\\n\",\n\t\t\tDA7218_2BYTE_MASK);\n\t\treturn -EINVAL;\n\t}\n\n\t \n\tframe_size = slots * slot_width;\n\tswitch (frame_size) {\n\tcase 32:\n\t\tdai_bclks_per_wclk = DA7218_DAI_BCLKS_PER_WCLK_32;\n\t\tbreak;\n\tcase 64:\n\t\tdai_bclks_per_wclk = DA7218_DAI_BCLKS_PER_WCLK_64;\n\t\tbreak;\n\tcase 128:\n\t\tdai_bclks_per_wclk = DA7218_DAI_BCLKS_PER_WCLK_128;\n\t\tbreak;\n\tcase 256:\n\t\tdai_bclks_per_wclk = DA7218_DAI_BCLKS_PER_WCLK_256;\n\t\tbreak;\n\tdefault:\n\t\tdev_err(component->dev, \"Invalid frame size\\n\");\n\t\treturn -EINVAL;\n\t}\n\n\tsnd_soc_component_update_bits(component, DA7218_DAI_CLK_MODE,\n\t\t\t    DA7218_DAI_BCLKS_PER_WCLK_MASK,\n\t\t\t    dai_bclks_per_wclk);\n\tsnd_soc_component_write(component, DA7218_DAI_OFFSET_LOWER,\n\t\t      (rx_mask & DA7218_BYTE_MASK));\n\tsnd_soc_component_write(component, DA7218_DAI_OFFSET_UPPER,\n\t\t      ((rx_mask >> DA7218_BYTE_SHIFT) & DA7218_BYTE_MASK));\n\tsnd_soc_component_update_bits(component, DA7218_DAI_TDM_CTRL,\n\t\t\t    DA7218_DAI_TDM_CH_EN_MASK |\n\t\t\t    DA7218_DAI_TDM_MODE_EN_MASK,\n\t\t\t    (tx_mask << DA7218_DAI_TDM_CH_EN_SHIFT) |\n\t\t\t    DA7218_DAI_TDM_MODE_EN_MASK);\n\n\treturn 0;\n}\n\nstatic int da7218_hw_params(struct snd_pcm_substream *substream,\n\t\t\t    struct snd_pcm_hw_params *params,\n\t\t\t    struct snd_soc_dai *dai)\n{\n\tstruct snd_soc_component *component = dai->component;\n\tu8 dai_ctrl = 0, fs;\n\tunsigned int channels;\n\n\tswitch (params_width(params)) {\n\tcase 16:\n\t\tdai_ctrl |= DA7218_DAI_WORD_LENGTH_S16_LE;\n\t\tbreak;\n\tcase 20:\n\t\tdai_ctrl |= DA7218_DAI_WORD_LENGTH_S20_LE;\n\t\tbreak;\n\tcase 24:\n\t\tdai_ctrl |= DA7218_DAI_WORD_LENGTH_S24_LE;\n\t\tbreak;\n\tcase 32:\n\t\tdai_ctrl |= DA7218_DAI_WORD_LENGTH_S32_LE;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tchannels = params_channels(params);\n\tif ((channels < 1) || (channels > DA7218_DAI_CH_NUM_MAX)) {\n\t\tdev_err(component->dev,\n\t\t\t\"Invalid number of channels, only 1 to %d supported\\n\",\n\t\t\tDA7218_DAI_CH_NUM_MAX);\n\t\treturn -EINVAL;\n\t}\n\tdai_ctrl |= channels << DA7218_DAI_CH_NUM_SHIFT;\n\n\tswitch (params_rate(params)) {\n\tcase 8000:\n\t\tfs = DA7218_SR_8000;\n\t\tbreak;\n\tcase 11025:\n\t\tfs = DA7218_SR_11025;\n\t\tbreak;\n\tcase 12000:\n\t\tfs = DA7218_SR_12000;\n\t\tbreak;\n\tcase 16000:\n\t\tfs = DA7218_SR_16000;\n\t\tbreak;\n\tcase 22050:\n\t\tfs = DA7218_SR_22050;\n\t\tbreak;\n\tcase 24000:\n\t\tfs = DA7218_SR_24000;\n\t\tbreak;\n\tcase 32000:\n\t\tfs = DA7218_SR_32000;\n\t\tbreak;\n\tcase 44100:\n\t\tfs = DA7218_SR_44100;\n\t\tbreak;\n\tcase 48000:\n\t\tfs = DA7218_SR_48000;\n\t\tbreak;\n\tcase 88200:\n\t\tfs = DA7218_SR_88200;\n\t\tbreak;\n\tcase 96000:\n\t\tfs = DA7218_SR_96000;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tsnd_soc_component_update_bits(component, DA7218_DAI_CTRL,\n\t\t\t    DA7218_DAI_WORD_LENGTH_MASK | DA7218_DAI_CH_NUM_MASK,\n\t\t\t    dai_ctrl);\n\t \n\tsnd_soc_component_write(component, DA7218_SR,\n\t\t      (fs << DA7218_SR_DAC_SHIFT) | (fs << DA7218_SR_ADC_SHIFT));\n\n\treturn 0;\n}\n\nstatic const struct snd_soc_dai_ops da7218_dai_ops = {\n\t.hw_params\t= da7218_hw_params,\n\t.set_sysclk\t= da7218_set_dai_sysclk,\n\t.set_pll\t= da7218_set_dai_pll,\n\t.set_fmt\t= da7218_set_dai_fmt,\n\t.set_tdm_slot\t= da7218_set_dai_tdm_slot,\n};\n\n#define DA7218_FORMATS (SNDRV_PCM_FMTBIT_S16_LE | SNDRV_PCM_FMTBIT_S20_3LE |\\\n\t\t\tSNDRV_PCM_FMTBIT_S24_LE | SNDRV_PCM_FMTBIT_S32_LE)\n\nstatic struct snd_soc_dai_driver da7218_dai = {\n\t.name = \"da7218-hifi\",\n\t.playback = {\n\t\t.stream_name = \"Playback\",\n\t\t.channels_min = 1,\n\t\t.channels_max = 4,\t \n\t\t.rates = SNDRV_PCM_RATE_8000_96000,\n\t\t.formats = DA7218_FORMATS,\n\t},\n\t.capture = {\n\t\t.stream_name = \"Capture\",\n\t\t.channels_min = 1,\n\t\t.channels_max = 4,\n\t\t.rates = SNDRV_PCM_RATE_8000_96000,\n\t\t.formats = DA7218_FORMATS,\n\t},\n\t.ops = &da7218_dai_ops,\n\t.symmetric_rate = 1,\n\t.symmetric_channels = 1,\n\t.symmetric_sample_bits = 1,\n};\n\n\n \n\nint da7218_hpldet(struct snd_soc_component *component, struct snd_soc_jack *jack)\n{\n\tstruct da7218_priv *da7218 = snd_soc_component_get_drvdata(component);\n\n\tif (da7218->dev_id == DA7217_DEV_ID)\n\t\treturn -EINVAL;\n\n\tda7218->jack = jack;\n\tsnd_soc_component_update_bits(component, DA7218_HPLDET_JACK,\n\t\t\t    DA7218_HPLDET_JACK_EN_MASK,\n\t\t\t    jack ? DA7218_HPLDET_JACK_EN_MASK : 0);\n\n\treturn 0;\n}\nEXPORT_SYMBOL_GPL(da7218_hpldet);\n\nstatic void da7218_micldet_irq(struct snd_soc_component *component)\n{\n\tchar *envp[] = {\n\t\t\"EVENT=MIC_LEVEL_DETECT\",\n\t\tNULL,\n\t};\n\n\tkobject_uevent_env(&component->dev->kobj, KOBJ_CHANGE, envp);\n}\n\nstatic void da7218_hpldet_irq(struct snd_soc_component *component)\n{\n\tstruct da7218_priv *da7218 = snd_soc_component_get_drvdata(component);\n\tu8 jack_status;\n\tint report;\n\n\tjack_status = snd_soc_component_read(component, DA7218_EVENT_STATUS);\n\n\tif (jack_status & DA7218_HPLDET_JACK_STS_MASK)\n\t\treport = SND_JACK_HEADPHONE;\n\telse\n\t\treport = 0;\n\n\tsnd_soc_jack_report(da7218->jack, report, SND_JACK_HEADPHONE);\n}\n\n \n\nstatic irqreturn_t da7218_irq_thread(int irq, void *data)\n{\n\tstruct snd_soc_component *component = data;\n\tu8 status;\n\n\t \n\tstatus = snd_soc_component_read(component, DA7218_EVENT);\n\tif (!status)\n\t\treturn IRQ_NONE;\n\n\t \n\tif (status & DA7218_LVL_DET_EVENT_MASK)\n\t\tda7218_micldet_irq(component);\n\n\t \n\tif (status & DA7218_HPLDET_JACK_EVENT_MASK)\n\t\tda7218_hpldet_irq(component);\n\n\t \n\tsnd_soc_component_write(component, DA7218_EVENT, status);\n\n\treturn IRQ_HANDLED;\n}\n\n \n\nstatic const struct of_device_id da7218_of_match[] = {\n\t{ .compatible = \"dlg,da7217\", .data = (void *) DA7217_DEV_ID },\n\t{ .compatible = \"dlg,da7218\", .data = (void *) DA7218_DEV_ID },\n\t{ }\n};\nMODULE_DEVICE_TABLE(of, da7218_of_match);\n\nstatic inline int da7218_of_get_id(struct device *dev)\n{\n\tconst struct of_device_id *id = of_match_device(da7218_of_match, dev);\n\n\tif (id)\n\t\treturn (uintptr_t)id->data;\n\telse\n\t\treturn -EINVAL;\n}\n\nstatic enum da7218_micbias_voltage\n\tda7218_of_micbias_lvl(struct snd_soc_component *component, u32 val)\n{\n\tswitch (val) {\n\tcase 1200:\n\t\treturn DA7218_MICBIAS_1_2V;\n\tcase 1600:\n\t\treturn DA7218_MICBIAS_1_6V;\n\tcase 1800:\n\t\treturn DA7218_MICBIAS_1_8V;\n\tcase 2000:\n\t\treturn DA7218_MICBIAS_2_0V;\n\tcase 2200:\n\t\treturn DA7218_MICBIAS_2_2V;\n\tcase 2400:\n\t\treturn DA7218_MICBIAS_2_4V;\n\tcase 2600:\n\t\treturn DA7218_MICBIAS_2_6V;\n\tcase 2800:\n\t\treturn DA7218_MICBIAS_2_8V;\n\tcase 3000:\n\t\treturn DA7218_MICBIAS_3_0V;\n\tdefault:\n\t\tdev_warn(component->dev, \"Invalid micbias level\");\n\t\treturn DA7218_MICBIAS_1_6V;\n\t}\n}\n\nstatic enum da7218_mic_amp_in_sel\n\tda7218_of_mic_amp_in_sel(struct snd_soc_component *component, const char *str)\n{\n\tif (!strcmp(str, \"diff\")) {\n\t\treturn DA7218_MIC_AMP_IN_SEL_DIFF;\n\t} else if (!strcmp(str, \"se_p\")) {\n\t\treturn DA7218_MIC_AMP_IN_SEL_SE_P;\n\t} else if (!strcmp(str, \"se_n\")) {\n\t\treturn DA7218_MIC_AMP_IN_SEL_SE_N;\n\t} else {\n\t\tdev_warn(component->dev, \"Invalid mic input type selection\");\n\t\treturn DA7218_MIC_AMP_IN_SEL_DIFF;\n\t}\n}\n\nstatic enum da7218_dmic_data_sel\n\tda7218_of_dmic_data_sel(struct snd_soc_component *component, const char *str)\n{\n\tif (!strcmp(str, \"lrise_rfall\")) {\n\t\treturn DA7218_DMIC_DATA_LRISE_RFALL;\n\t} else if (!strcmp(str, \"lfall_rrise\")) {\n\t\treturn DA7218_DMIC_DATA_LFALL_RRISE;\n\t} else {\n\t\tdev_warn(component->dev, \"Invalid DMIC data type selection\");\n\t\treturn DA7218_DMIC_DATA_LRISE_RFALL;\n\t}\n}\n\nstatic enum da7218_dmic_samplephase\n\tda7218_of_dmic_samplephase(struct snd_soc_component *component, const char *str)\n{\n\tif (!strcmp(str, \"on_clkedge\")) {\n\t\treturn DA7218_DMIC_SAMPLE_ON_CLKEDGE;\n\t} else if (!strcmp(str, \"between_clkedge\")) {\n\t\treturn DA7218_DMIC_SAMPLE_BETWEEN_CLKEDGE;\n\t} else {\n\t\tdev_warn(component->dev, \"Invalid DMIC sample phase\");\n\t\treturn DA7218_DMIC_SAMPLE_ON_CLKEDGE;\n\t}\n}\n\nstatic enum da7218_dmic_clk_rate\n\tda7218_of_dmic_clkrate(struct snd_soc_component *component, u32 val)\n{\n\tswitch (val) {\n\tcase 1500000:\n\t\treturn DA7218_DMIC_CLK_1_5MHZ;\n\tcase 3000000:\n\t\treturn DA7218_DMIC_CLK_3_0MHZ;\n\tdefault:\n\t\tdev_warn(component->dev, \"Invalid DMIC clock rate\");\n\t\treturn DA7218_DMIC_CLK_3_0MHZ;\n\t}\n}\n\nstatic enum da7218_hpldet_jack_rate\n\tda7218_of_jack_rate(struct snd_soc_component *component, u32 val)\n{\n\tswitch (val) {\n\tcase 5:\n\t\treturn DA7218_HPLDET_JACK_RATE_5US;\n\tcase 10:\n\t\treturn DA7218_HPLDET_JACK_RATE_10US;\n\tcase 20:\n\t\treturn DA7218_HPLDET_JACK_RATE_20US;\n\tcase 40:\n\t\treturn DA7218_HPLDET_JACK_RATE_40US;\n\tcase 80:\n\t\treturn DA7218_HPLDET_JACK_RATE_80US;\n\tcase 160:\n\t\treturn DA7218_HPLDET_JACK_RATE_160US;\n\tcase 320:\n\t\treturn DA7218_HPLDET_JACK_RATE_320US;\n\tcase 640:\n\t\treturn DA7218_HPLDET_JACK_RATE_640US;\n\tdefault:\n\t\tdev_warn(component->dev, \"Invalid jack detect rate\");\n\t\treturn DA7218_HPLDET_JACK_RATE_40US;\n\t}\n}\n\nstatic enum da7218_hpldet_jack_debounce\n\tda7218_of_jack_debounce(struct snd_soc_component *component, u32 val)\n{\n\tswitch (val) {\n\tcase 0:\n\t\treturn DA7218_HPLDET_JACK_DEBOUNCE_OFF;\n\tcase 2:\n\t\treturn DA7218_HPLDET_JACK_DEBOUNCE_2;\n\tcase 3:\n\t\treturn DA7218_HPLDET_JACK_DEBOUNCE_3;\n\tcase 4:\n\t\treturn DA7218_HPLDET_JACK_DEBOUNCE_4;\n\tdefault:\n\t\tdev_warn(component->dev, \"Invalid jack debounce\");\n\t\treturn DA7218_HPLDET_JACK_DEBOUNCE_2;\n\t}\n}\n\nstatic enum da7218_hpldet_jack_thr\n\tda7218_of_jack_thr(struct snd_soc_component *component, u32 val)\n{\n\tswitch (val) {\n\tcase 84:\n\t\treturn DA7218_HPLDET_JACK_THR_84PCT;\n\tcase 88:\n\t\treturn DA7218_HPLDET_JACK_THR_88PCT;\n\tcase 92:\n\t\treturn DA7218_HPLDET_JACK_THR_92PCT;\n\tcase 96:\n\t\treturn DA7218_HPLDET_JACK_THR_96PCT;\n\tdefault:\n\t\tdev_warn(component->dev, \"Invalid jack threshold level\");\n\t\treturn DA7218_HPLDET_JACK_THR_84PCT;\n\t}\n}\n\nstatic struct da7218_pdata *da7218_of_to_pdata(struct snd_soc_component *component)\n{\n\tstruct da7218_priv *da7218 = snd_soc_component_get_drvdata(component);\n\tstruct device_node *np = component->dev->of_node;\n\tstruct device_node *hpldet_np;\n\tstruct da7218_pdata *pdata;\n\tstruct da7218_hpldet_pdata *hpldet_pdata;\n\tconst char *of_str;\n\tu32 of_val32;\n\n\tpdata = devm_kzalloc(component->dev, sizeof(*pdata), GFP_KERNEL);\n\tif (!pdata)\n\t\treturn NULL;\n\n\tif (of_property_read_u32(np, \"dlg,micbias1-lvl-millivolt\", &of_val32) >= 0)\n\t\tpdata->micbias1_lvl = da7218_of_micbias_lvl(component, of_val32);\n\telse\n\t\tpdata->micbias1_lvl = DA7218_MICBIAS_1_6V;\n\n\tif (of_property_read_u32(np, \"dlg,micbias2-lvl-millivolt\", &of_val32) >= 0)\n\t\tpdata->micbias2_lvl = da7218_of_micbias_lvl(component, of_val32);\n\telse\n\t\tpdata->micbias2_lvl = DA7218_MICBIAS_1_6V;\n\n\tif (!of_property_read_string(np, \"dlg,mic1-amp-in-sel\", &of_str))\n\t\tpdata->mic1_amp_in_sel =\n\t\t\tda7218_of_mic_amp_in_sel(component, of_str);\n\telse\n\t\tpdata->mic1_amp_in_sel = DA7218_MIC_AMP_IN_SEL_DIFF;\n\n\tif (!of_property_read_string(np, \"dlg,mic2-amp-in-sel\", &of_str))\n\t\tpdata->mic2_amp_in_sel =\n\t\t\tda7218_of_mic_amp_in_sel(component, of_str);\n\telse\n\t\tpdata->mic2_amp_in_sel = DA7218_MIC_AMP_IN_SEL_DIFF;\n\n\tif (!of_property_read_string(np, \"dlg,dmic1-data-sel\", &of_str))\n\t\tpdata->dmic1_data_sel =\tda7218_of_dmic_data_sel(component, of_str);\n\telse\n\t\tpdata->dmic1_data_sel =\tDA7218_DMIC_DATA_LRISE_RFALL;\n\n\tif (!of_property_read_string(np, \"dlg,dmic1-samplephase\", &of_str))\n\t\tpdata->dmic1_samplephase =\n\t\t\tda7218_of_dmic_samplephase(component, of_str);\n\telse\n\t\tpdata->dmic1_samplephase = DA7218_DMIC_SAMPLE_ON_CLKEDGE;\n\n\tif (of_property_read_u32(np, \"dlg,dmic1-clkrate-hz\", &of_val32) >= 0)\n\t\tpdata->dmic1_clk_rate = da7218_of_dmic_clkrate(component, of_val32);\n\telse\n\t\tpdata->dmic1_clk_rate = DA7218_DMIC_CLK_3_0MHZ;\n\n\tif (!of_property_read_string(np, \"dlg,dmic2-data-sel\", &of_str))\n\t\tpdata->dmic2_data_sel = da7218_of_dmic_data_sel(component, of_str);\n\telse\n\t\tpdata->dmic2_data_sel =\tDA7218_DMIC_DATA_LRISE_RFALL;\n\n\tif (!of_property_read_string(np, \"dlg,dmic2-samplephase\", &of_str))\n\t\tpdata->dmic2_samplephase =\n\t\t\tda7218_of_dmic_samplephase(component, of_str);\n\telse\n\t\tpdata->dmic2_samplephase = DA7218_DMIC_SAMPLE_ON_CLKEDGE;\n\n\tif (of_property_read_u32(np, \"dlg,dmic2-clkrate-hz\", &of_val32) >= 0)\n\t\tpdata->dmic2_clk_rate = da7218_of_dmic_clkrate(component, of_val32);\n\telse\n\t\tpdata->dmic2_clk_rate = DA7218_DMIC_CLK_3_0MHZ;\n\n\tif (da7218->dev_id == DA7217_DEV_ID) {\n\t\tif (of_property_read_bool(np, \"dlg,hp-diff-single-supply\"))\n\t\t\tpdata->hp_diff_single_supply = true;\n\t}\n\n\tif (da7218->dev_id == DA7218_DEV_ID) {\n\t\thpldet_np = of_get_child_by_name(np, \"da7218_hpldet\");\n\t\tif (!hpldet_np)\n\t\t\treturn pdata;\n\n\t\thpldet_pdata = devm_kzalloc(component->dev, sizeof(*hpldet_pdata),\n\t\t\t\t\t    GFP_KERNEL);\n\t\tif (!hpldet_pdata) {\n\t\t\tof_node_put(hpldet_np);\n\t\t\treturn pdata;\n\t\t}\n\t\tpdata->hpldet_pdata = hpldet_pdata;\n\n\t\tif (of_property_read_u32(hpldet_np, \"dlg,jack-rate-us\",\n\t\t\t\t\t &of_val32) >= 0)\n\t\t\thpldet_pdata->jack_rate =\n\t\t\t\tda7218_of_jack_rate(component, of_val32);\n\t\telse\n\t\t\thpldet_pdata->jack_rate = DA7218_HPLDET_JACK_RATE_40US;\n\n\t\tif (of_property_read_u32(hpldet_np, \"dlg,jack-debounce\",\n\t\t\t\t\t &of_val32) >= 0)\n\t\t\thpldet_pdata->jack_debounce =\n\t\t\t\tda7218_of_jack_debounce(component, of_val32);\n\t\telse\n\t\t\thpldet_pdata->jack_debounce =\n\t\t\t\tDA7218_HPLDET_JACK_DEBOUNCE_2;\n\n\t\tif (of_property_read_u32(hpldet_np, \"dlg,jack-threshold-pct\",\n\t\t\t\t\t &of_val32) >= 0)\n\t\t\thpldet_pdata->jack_thr =\n\t\t\t\tda7218_of_jack_thr(component, of_val32);\n\t\telse\n\t\t\thpldet_pdata->jack_thr = DA7218_HPLDET_JACK_THR_84PCT;\n\n\t\tif (of_property_read_bool(hpldet_np, \"dlg,comp-inv\"))\n\t\t\thpldet_pdata->comp_inv = true;\n\n\t\tif (of_property_read_bool(hpldet_np, \"dlg,hyst\"))\n\t\t\thpldet_pdata->hyst = true;\n\n\t\tif (of_property_read_bool(hpldet_np, \"dlg,discharge\"))\n\t\t\thpldet_pdata->discharge = true;\n\n\t\tof_node_put(hpldet_np);\n\t}\n\n\treturn pdata;\n}\n\n\n \n\nstatic int da7218_set_bias_level(struct snd_soc_component *component,\n\t\t\t\t enum snd_soc_bias_level level)\n{\n\tstruct da7218_priv *da7218 = snd_soc_component_get_drvdata(component);\n\tint ret;\n\n\tswitch (level) {\n\tcase SND_SOC_BIAS_ON:\n\t\tbreak;\n\tcase SND_SOC_BIAS_PREPARE:\n\t\t \n\t\tif (snd_soc_component_get_bias_level(component) == SND_SOC_BIAS_STANDBY) {\n\t\t\tif (da7218->mclk) {\n\t\t\t\tret = clk_prepare_enable(da7218->mclk);\n\t\t\t\tif (ret) {\n\t\t\t\t\tdev_err(component->dev, \"Failed to enable mclk\\n\");\n\t\t\t\t\treturn ret;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tbreak;\n\tcase SND_SOC_BIAS_STANDBY:\n\t\tif (snd_soc_component_get_bias_level(component) == SND_SOC_BIAS_OFF) {\n\t\t\t \n\t\t\tsnd_soc_component_update_bits(component, DA7218_REFERENCES,\n\t\t\t\t\t    DA7218_BIAS_EN_MASK,\n\t\t\t\t\t    DA7218_BIAS_EN_MASK);\n\n\t\t\t \n\t\t\tsnd_soc_component_update_bits(component, DA7218_LDO_CTRL,\n\t\t\t\t\t    DA7218_LDO_EN_MASK,\n\t\t\t\t\t    DA7218_LDO_EN_MASK);\n\t\t} else {\n\t\t\t \n\t\t\tif (da7218->mclk)\n\t\t\t\tclk_disable_unprepare(da7218->mclk);\n\t\t}\n\t\tbreak;\n\tcase SND_SOC_BIAS_OFF:\n\t\t \n\t\tif (!da7218->jack) {\n\t\t\t \n\t\t\tsnd_soc_component_update_bits(component, DA7218_LDO_CTRL,\n\t\t\t\t\t    DA7218_LDO_EN_MASK, 0);\n\n\t\t\t \n\t\t\tsnd_soc_component_update_bits(component, DA7218_REFERENCES,\n\t\t\t\t\t    DA7218_BIAS_EN_MASK, 0);\n\t\t}\n\t\tbreak;\n\t}\n\n\treturn 0;\n}\n\nstatic const char *da7218_supply_names[DA7218_NUM_SUPPLIES] = {\n\t[DA7218_SUPPLY_VDD] = \"VDD\",\n\t[DA7218_SUPPLY_VDDMIC] = \"VDDMIC\",\n\t[DA7218_SUPPLY_VDDIO] = \"VDDIO\",\n};\n\nstatic int da7218_handle_supplies(struct snd_soc_component *component)\n{\n\tstruct da7218_priv *da7218 = snd_soc_component_get_drvdata(component);\n\tstruct regulator *vddio;\n\tu8 io_voltage_lvl = DA7218_IO_VOLTAGE_LEVEL_2_5V_3_6V;\n\tint i, ret;\n\n\t \n\tfor (i = 0; i < DA7218_NUM_SUPPLIES; ++i)\n\t\tda7218->supplies[i].supply = da7218_supply_names[i];\n\n\tret = devm_regulator_bulk_get(component->dev, DA7218_NUM_SUPPLIES,\n\t\t\t\t      da7218->supplies);\n\tif (ret) {\n\t\tdev_err(component->dev, \"Failed to get supplies\\n\");\n\t\treturn ret;\n\t}\n\n\t \n\tvddio = da7218->supplies[DA7218_SUPPLY_VDDIO].consumer;\n\tret = regulator_get_voltage(vddio);\n\tif (ret < 1500000)\n\t\tdev_warn(component->dev, \"Invalid VDDIO voltage\\n\");\n\telse if (ret < 2500000)\n\t\tio_voltage_lvl = DA7218_IO_VOLTAGE_LEVEL_1_5V_2_5V;\n\n\t \n\tret = regulator_bulk_enable(DA7218_NUM_SUPPLIES, da7218->supplies);\n\tif (ret) {\n\t\tdev_err(component->dev, \"Failed to enable supplies\\n\");\n\t\treturn ret;\n\t}\n\n\t \n\tsnd_soc_component_write(component, DA7218_SYSTEM_ACTIVE, DA7218_SYSTEM_ACTIVE_MASK);\n\n\t \n\tsnd_soc_component_write(component, DA7218_IO_CTRL, io_voltage_lvl);\n\n\treturn 0;\n}\n\nstatic void da7218_handle_pdata(struct snd_soc_component *component)\n{\n\tstruct da7218_priv *da7218 = snd_soc_component_get_drvdata(component);\n\tstruct da7218_pdata *pdata = da7218->pdata;\n\n\tif (pdata) {\n\t\tu8 micbias_lvl = 0, dmic_cfg = 0;\n\n\t\t \n\t\tswitch (pdata->micbias1_lvl) {\n\t\tcase DA7218_MICBIAS_1_2V:\n\t\t\tmicbias_lvl |= DA7218_MICBIAS_1_LP_MODE_MASK;\n\t\t\tbreak;\n\t\tcase DA7218_MICBIAS_1_6V:\n\t\tcase DA7218_MICBIAS_1_8V:\n\t\tcase DA7218_MICBIAS_2_0V:\n\t\tcase DA7218_MICBIAS_2_2V:\n\t\tcase DA7218_MICBIAS_2_4V:\n\t\tcase DA7218_MICBIAS_2_6V:\n\t\tcase DA7218_MICBIAS_2_8V:\n\t\tcase DA7218_MICBIAS_3_0V:\n\t\t\tmicbias_lvl |= (pdata->micbias1_lvl <<\n\t\t\t\t\tDA7218_MICBIAS_1_LEVEL_SHIFT);\n\t\t\tbreak;\n\t\t}\n\n\t\tswitch (pdata->micbias2_lvl) {\n\t\tcase DA7218_MICBIAS_1_2V:\n\t\t\tmicbias_lvl |= DA7218_MICBIAS_2_LP_MODE_MASK;\n\t\t\tbreak;\n\t\tcase DA7218_MICBIAS_1_6V:\n\t\tcase DA7218_MICBIAS_1_8V:\n\t\tcase DA7218_MICBIAS_2_0V:\n\t\tcase DA7218_MICBIAS_2_2V:\n\t\tcase DA7218_MICBIAS_2_4V:\n\t\tcase DA7218_MICBIAS_2_6V:\n\t\tcase DA7218_MICBIAS_2_8V:\n\t\tcase DA7218_MICBIAS_3_0V:\n\t\t\tmicbias_lvl |= (pdata->micbias2_lvl <<\n\t\t\t\t\t DA7218_MICBIAS_2_LEVEL_SHIFT);\n\t\t\tbreak;\n\t\t}\n\n\t\tsnd_soc_component_write(component, DA7218_MICBIAS_CTRL, micbias_lvl);\n\n\t\t \n\t\tswitch (pdata->mic1_amp_in_sel) {\n\t\tcase DA7218_MIC_AMP_IN_SEL_DIFF:\n\t\tcase DA7218_MIC_AMP_IN_SEL_SE_P:\n\t\tcase DA7218_MIC_AMP_IN_SEL_SE_N:\n\t\t\tsnd_soc_component_write(component, DA7218_MIC_1_SELECT,\n\t\t\t\t      pdata->mic1_amp_in_sel);\n\t\t\tbreak;\n\t\t}\n\n\t\tswitch (pdata->mic2_amp_in_sel) {\n\t\tcase DA7218_MIC_AMP_IN_SEL_DIFF:\n\t\tcase DA7218_MIC_AMP_IN_SEL_SE_P:\n\t\tcase DA7218_MIC_AMP_IN_SEL_SE_N:\n\t\t\tsnd_soc_component_write(component, DA7218_MIC_2_SELECT,\n\t\t\t\t      pdata->mic2_amp_in_sel);\n\t\t\tbreak;\n\t\t}\n\n\t\t \n\t\tswitch (pdata->dmic1_data_sel) {\n\t\tcase DA7218_DMIC_DATA_LFALL_RRISE:\n\t\tcase DA7218_DMIC_DATA_LRISE_RFALL:\n\t\t\tdmic_cfg |= (pdata->dmic1_data_sel <<\n\t\t\t\t     DA7218_DMIC_1_DATA_SEL_SHIFT);\n\t\t\tbreak;\n\t\t}\n\n\t\tswitch (pdata->dmic1_samplephase) {\n\t\tcase DA7218_DMIC_SAMPLE_ON_CLKEDGE:\n\t\tcase DA7218_DMIC_SAMPLE_BETWEEN_CLKEDGE:\n\t\t\tdmic_cfg |= (pdata->dmic1_samplephase <<\n\t\t\t\t     DA7218_DMIC_1_SAMPLEPHASE_SHIFT);\n\t\t\tbreak;\n\t\t}\n\n\t\tswitch (pdata->dmic1_clk_rate) {\n\t\tcase DA7218_DMIC_CLK_3_0MHZ:\n\t\tcase DA7218_DMIC_CLK_1_5MHZ:\n\t\t\tdmic_cfg |= (pdata->dmic1_clk_rate <<\n\t\t\t\t     DA7218_DMIC_1_CLK_RATE_SHIFT);\n\t\t\tbreak;\n\t\t}\n\n\t\tsnd_soc_component_update_bits(component, DA7218_DMIC_1_CTRL,\n\t\t\t\t    DA7218_DMIC_1_DATA_SEL_MASK |\n\t\t\t\t    DA7218_DMIC_1_SAMPLEPHASE_MASK |\n\t\t\t\t    DA7218_DMIC_1_CLK_RATE_MASK, dmic_cfg);\n\n\t\tdmic_cfg = 0;\n\t\tswitch (pdata->dmic2_data_sel) {\n\t\tcase DA7218_DMIC_DATA_LFALL_RRISE:\n\t\tcase DA7218_DMIC_DATA_LRISE_RFALL:\n\t\t\tdmic_cfg |= (pdata->dmic2_data_sel <<\n\t\t\t\t     DA7218_DMIC_2_DATA_SEL_SHIFT);\n\t\t\tbreak;\n\t\t}\n\n\t\tswitch (pdata->dmic2_samplephase) {\n\t\tcase DA7218_DMIC_SAMPLE_ON_CLKEDGE:\n\t\tcase DA7218_DMIC_SAMPLE_BETWEEN_CLKEDGE:\n\t\t\tdmic_cfg |= (pdata->dmic2_samplephase <<\n\t\t\t\t     DA7218_DMIC_2_SAMPLEPHASE_SHIFT);\n\t\t\tbreak;\n\t\t}\n\n\t\tswitch (pdata->dmic2_clk_rate) {\n\t\tcase DA7218_DMIC_CLK_3_0MHZ:\n\t\tcase DA7218_DMIC_CLK_1_5MHZ:\n\t\t\tdmic_cfg |= (pdata->dmic2_clk_rate <<\n\t\t\t\t     DA7218_DMIC_2_CLK_RATE_SHIFT);\n\t\t\tbreak;\n\t\t}\n\n\t\tsnd_soc_component_update_bits(component, DA7218_DMIC_2_CTRL,\n\t\t\t\t    DA7218_DMIC_2_DATA_SEL_MASK |\n\t\t\t\t    DA7218_DMIC_2_SAMPLEPHASE_MASK |\n\t\t\t\t    DA7218_DMIC_2_CLK_RATE_MASK, dmic_cfg);\n\n\t\t \n\t\tif (da7218->dev_id == DA7217_DEV_ID) {\n\t\t\tda7218->hp_single_supply =\n\t\t\t\tpdata->hp_diff_single_supply;\n\n\t\t\tif (da7218->hp_single_supply) {\n\t\t\t\tsnd_soc_component_write(component, DA7218_HP_DIFF_UNLOCK,\n\t\t\t\t\t      DA7218_HP_DIFF_UNLOCK_VAL);\n\t\t\t\tsnd_soc_component_update_bits(component, DA7218_HP_DIFF_CTRL,\n\t\t\t\t\t\t    DA7218_HP_AMP_SINGLE_SUPPLY_EN_MASK,\n\t\t\t\t\t\t    DA7218_HP_AMP_SINGLE_SUPPLY_EN_MASK);\n\t\t\t}\n\t\t}\n\n\t\t \n\t\tif ((da7218->dev_id == DA7218_DEV_ID) &&\n\t\t    (pdata->hpldet_pdata)) {\n\t\t\tstruct da7218_hpldet_pdata *hpldet_pdata =\n\t\t\t\tpdata->hpldet_pdata;\n\t\t\tu8 hpldet_cfg = 0;\n\n\t\t\tswitch (hpldet_pdata->jack_rate) {\n\t\t\tcase DA7218_HPLDET_JACK_RATE_5US:\n\t\t\tcase DA7218_HPLDET_JACK_RATE_10US:\n\t\t\tcase DA7218_HPLDET_JACK_RATE_20US:\n\t\t\tcase DA7218_HPLDET_JACK_RATE_40US:\n\t\t\tcase DA7218_HPLDET_JACK_RATE_80US:\n\t\t\tcase DA7218_HPLDET_JACK_RATE_160US:\n\t\t\tcase DA7218_HPLDET_JACK_RATE_320US:\n\t\t\tcase DA7218_HPLDET_JACK_RATE_640US:\n\t\t\t\thpldet_cfg |=\n\t\t\t\t\t(hpldet_pdata->jack_rate <<\n\t\t\t\t\t DA7218_HPLDET_JACK_RATE_SHIFT);\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tswitch (hpldet_pdata->jack_debounce) {\n\t\t\tcase DA7218_HPLDET_JACK_DEBOUNCE_OFF:\n\t\t\tcase DA7218_HPLDET_JACK_DEBOUNCE_2:\n\t\t\tcase DA7218_HPLDET_JACK_DEBOUNCE_3:\n\t\t\tcase DA7218_HPLDET_JACK_DEBOUNCE_4:\n\t\t\t\thpldet_cfg |=\n\t\t\t\t\t(hpldet_pdata->jack_debounce <<\n\t\t\t\t\t DA7218_HPLDET_JACK_DEBOUNCE_SHIFT);\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tswitch (hpldet_pdata->jack_thr) {\n\t\t\tcase DA7218_HPLDET_JACK_THR_84PCT:\n\t\t\tcase DA7218_HPLDET_JACK_THR_88PCT:\n\t\t\tcase DA7218_HPLDET_JACK_THR_92PCT:\n\t\t\tcase DA7218_HPLDET_JACK_THR_96PCT:\n\t\t\t\thpldet_cfg |=\n\t\t\t\t\t(hpldet_pdata->jack_thr <<\n\t\t\t\t\t DA7218_HPLDET_JACK_THR_SHIFT);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tsnd_soc_component_update_bits(component, DA7218_HPLDET_JACK,\n\t\t\t\t\t    DA7218_HPLDET_JACK_RATE_MASK |\n\t\t\t\t\t    DA7218_HPLDET_JACK_DEBOUNCE_MASK |\n\t\t\t\t\t    DA7218_HPLDET_JACK_THR_MASK,\n\t\t\t\t\t    hpldet_cfg);\n\n\t\t\thpldet_cfg = 0;\n\t\t\tif (hpldet_pdata->comp_inv)\n\t\t\t\thpldet_cfg |= DA7218_HPLDET_COMP_INV_MASK;\n\n\t\t\tif (hpldet_pdata->hyst)\n\t\t\t\thpldet_cfg |= DA7218_HPLDET_HYST_EN_MASK;\n\n\t\t\tif (hpldet_pdata->discharge)\n\t\t\t\thpldet_cfg |= DA7218_HPLDET_DISCHARGE_EN_MASK;\n\n\t\t\tsnd_soc_component_write(component, DA7218_HPLDET_CTRL, hpldet_cfg);\n\t\t}\n\t}\n}\n\nstatic int da7218_probe(struct snd_soc_component *component)\n{\n\tstruct da7218_priv *da7218 = snd_soc_component_get_drvdata(component);\n\tint ret;\n\n\t \n\tret = da7218_handle_supplies(component);\n\tif (ret)\n\t\treturn ret;\n\n\t \n\tif (component->dev->of_node)\n\t\tda7218->pdata = da7218_of_to_pdata(component);\n\telse\n\t\tda7218->pdata = dev_get_platdata(component->dev);\n\n\tda7218_handle_pdata(component);\n\n\t \n\tda7218->mclk = devm_clk_get_optional(component->dev, \"mclk\");\n\tif (IS_ERR(da7218->mclk)) {\n\t\tret = PTR_ERR(da7218->mclk);\n\t\tgoto err_disable_reg;\n\t}\n\n\t \n\tsnd_soc_component_write(component, DA7218_PC_COUNT, DA7218_PC_FREERUN_MASK);\n\n\t \n\tsnd_soc_component_write(component, DA7218_DROUTING_OUTFILT_1L, 0);\n\tsnd_soc_component_write(component, DA7218_DROUTING_OUTFILT_1R, 0);\n\n\t \n\tsnd_soc_component_update_bits(component, DA7218_CP_CTRL,\n\t\t\t    DA7218_CP_SMALL_SWITCH_FREQ_EN_MASK, 0);\n\n\t \n\tsnd_soc_component_update_bits(component, DA7218_MIXIN_1_CTRL,\n\t\t\t    DA7218_MIXIN_1_AMP_RAMP_EN_MASK,\n\t\t\t    DA7218_MIXIN_1_AMP_RAMP_EN_MASK);\n\tsnd_soc_component_update_bits(component, DA7218_MIXIN_2_CTRL,\n\t\t\t    DA7218_MIXIN_2_AMP_RAMP_EN_MASK,\n\t\t\t    DA7218_MIXIN_2_AMP_RAMP_EN_MASK);\n\tsnd_soc_component_update_bits(component, DA7218_IN_1L_FILTER_CTRL,\n\t\t\t    DA7218_IN_1L_RAMP_EN_MASK,\n\t\t\t    DA7218_IN_1L_RAMP_EN_MASK);\n\tsnd_soc_component_update_bits(component, DA7218_IN_1R_FILTER_CTRL,\n\t\t\t    DA7218_IN_1R_RAMP_EN_MASK,\n\t\t\t    DA7218_IN_1R_RAMP_EN_MASK);\n\tsnd_soc_component_update_bits(component, DA7218_IN_2L_FILTER_CTRL,\n\t\t\t    DA7218_IN_2L_RAMP_EN_MASK,\n\t\t\t    DA7218_IN_2L_RAMP_EN_MASK);\n\tsnd_soc_component_update_bits(component, DA7218_IN_2R_FILTER_CTRL,\n\t\t\t    DA7218_IN_2R_RAMP_EN_MASK,\n\t\t\t    DA7218_IN_2R_RAMP_EN_MASK);\n\tsnd_soc_component_update_bits(component, DA7218_DGS_GAIN_CTRL,\n\t\t\t    DA7218_DGS_RAMP_EN_MASK, DA7218_DGS_RAMP_EN_MASK);\n\tsnd_soc_component_update_bits(component, DA7218_OUT_1L_FILTER_CTRL,\n\t\t\t    DA7218_OUT_1L_RAMP_EN_MASK,\n\t\t\t    DA7218_OUT_1L_RAMP_EN_MASK);\n\tsnd_soc_component_update_bits(component, DA7218_OUT_1R_FILTER_CTRL,\n\t\t\t    DA7218_OUT_1R_RAMP_EN_MASK,\n\t\t\t    DA7218_OUT_1R_RAMP_EN_MASK);\n\tsnd_soc_component_update_bits(component, DA7218_HP_L_CTRL,\n\t\t\t    DA7218_HP_L_AMP_RAMP_EN_MASK,\n\t\t\t    DA7218_HP_L_AMP_RAMP_EN_MASK);\n\tsnd_soc_component_update_bits(component, DA7218_HP_R_CTRL,\n\t\t\t    DA7218_HP_R_AMP_RAMP_EN_MASK,\n\t\t\t    DA7218_HP_R_AMP_RAMP_EN_MASK);\n\n\t \n\tsnd_soc_component_write(component, DA7218_TONE_GEN_CYCLES, DA7218_BEEP_CYCLES_MASK);\n\n\t \n\tif (da7218->dev_id == DA7217_DEV_ID) {\n\t\tsnd_soc_component_update_bits(component, DA7218_HP_DIFF_CTRL,\n\t\t\t\t    DA7218_HP_AMP_DIFF_MODE_EN_MASK,\n\t\t\t\t    DA7218_HP_AMP_DIFF_MODE_EN_MASK);\n\n\t\t \n\t\tsnd_soc_component_write(component, DA7218_EVENT_MASK,\n\t\t\t      DA7218_HPLDET_JACK_EVENT_IRQ_MSK_MASK);\n\t}\n\n\tif (da7218->irq) {\n\t\tret = devm_request_threaded_irq(component->dev, da7218->irq, NULL,\n\t\t\t\t\t\tda7218_irq_thread,\n\t\t\t\t\t\tIRQF_TRIGGER_LOW | IRQF_ONESHOT,\n\t\t\t\t\t\t\"da7218\", component);\n\t\tif (ret != 0) {\n\t\t\tdev_err(component->dev, \"Failed to request IRQ %d: %d\\n\",\n\t\t\t\tda7218->irq, ret);\n\t\t\tgoto err_disable_reg;\n\t\t}\n\n\t}\n\n\treturn 0;\n\nerr_disable_reg:\n\tregulator_bulk_disable(DA7218_NUM_SUPPLIES, da7218->supplies);\n\n\treturn ret;\n}\n\nstatic void da7218_remove(struct snd_soc_component *component)\n{\n\tstruct da7218_priv *da7218 = snd_soc_component_get_drvdata(component);\n\n\tregulator_bulk_disable(DA7218_NUM_SUPPLIES, da7218->supplies);\n}\n\n#ifdef CONFIG_PM\nstatic int da7218_suspend(struct snd_soc_component *component)\n{\n\tstruct da7218_priv *da7218 = snd_soc_component_get_drvdata(component);\n\n\tda7218_set_bias_level(component, SND_SOC_BIAS_OFF);\n\n\t \n\tif (!da7218->jack)\n\t\tsnd_soc_component_write(component, DA7218_SYSTEM_ACTIVE, 0);\n\n\treturn 0;\n}\n\nstatic int da7218_resume(struct snd_soc_component *component)\n{\n\tstruct da7218_priv *da7218 = snd_soc_component_get_drvdata(component);\n\n\t \n\tif (!da7218->jack)\n\t\tsnd_soc_component_write(component, DA7218_SYSTEM_ACTIVE,\n\t\t\t      DA7218_SYSTEM_ACTIVE_MASK);\n\n\tda7218_set_bias_level(component, SND_SOC_BIAS_STANDBY);\n\n\treturn 0;\n}\n#else\n#define da7218_suspend NULL\n#define da7218_resume NULL\n#endif\n\nstatic const struct snd_soc_component_driver soc_component_dev_da7218 = {\n\t.probe\t\t\t= da7218_probe,\n\t.remove\t\t\t= da7218_remove,\n\t.suspend\t\t= da7218_suspend,\n\t.resume\t\t\t= da7218_resume,\n\t.set_bias_level\t\t= da7218_set_bias_level,\n\t.controls\t\t= da7218_snd_controls,\n\t.num_controls\t\t= ARRAY_SIZE(da7218_snd_controls),\n\t.dapm_widgets\t\t= da7218_dapm_widgets,\n\t.num_dapm_widgets\t= ARRAY_SIZE(da7218_dapm_widgets),\n\t.dapm_routes\t\t= da7218_audio_map,\n\t.num_dapm_routes\t= ARRAY_SIZE(da7218_audio_map),\n\t.idle_bias_on\t\t= 1,\n\t.use_pmdown_time\t= 1,\n\t.endianness\t\t= 1,\n};\n\n\n \n\nstatic struct reg_default da7218_reg_defaults[] = {\n\t{ DA7218_SYSTEM_ACTIVE, 0x00 },\n\t{ DA7218_CIF_CTRL, 0x00 },\n\t{ DA7218_SPARE1, 0x00 },\n\t{ DA7218_SR, 0xAA },\n\t{ DA7218_PC_COUNT, 0x02 },\n\t{ DA7218_GAIN_RAMP_CTRL, 0x00 },\n\t{ DA7218_CIF_TIMEOUT_CTRL, 0x01 },\n\t{ DA7218_SYSTEM_MODES_INPUT, 0x00 },\n\t{ DA7218_SYSTEM_MODES_OUTPUT, 0x00 },\n\t{ DA7218_IN_1L_FILTER_CTRL, 0x00 },\n\t{ DA7218_IN_1R_FILTER_CTRL, 0x00 },\n\t{ DA7218_IN_2L_FILTER_CTRL, 0x00 },\n\t{ DA7218_IN_2R_FILTER_CTRL, 0x00 },\n\t{ DA7218_OUT_1L_FILTER_CTRL, 0x40 },\n\t{ DA7218_OUT_1R_FILTER_CTRL, 0x40 },\n\t{ DA7218_OUT_1_HPF_FILTER_CTRL, 0x80 },\n\t{ DA7218_OUT_1_EQ_12_FILTER_CTRL, 0x77 },\n\t{ DA7218_OUT_1_EQ_34_FILTER_CTRL, 0x77 },\n\t{ DA7218_OUT_1_EQ_5_FILTER_CTRL, 0x07 },\n\t{ DA7218_OUT_1_BIQ_5STAGE_CTRL, 0x40 },\n\t{ DA7218_OUT_1_BIQ_5STAGE_DATA, 0x00 },\n\t{ DA7218_OUT_1_BIQ_5STAGE_ADDR, 0x00 },\n\t{ DA7218_MIXIN_1_CTRL, 0x48 },\n\t{ DA7218_MIXIN_1_GAIN, 0x03 },\n\t{ DA7218_MIXIN_2_CTRL, 0x48 },\n\t{ DA7218_MIXIN_2_GAIN, 0x03 },\n\t{ DA7218_ALC_CTRL1, 0x00 },\n\t{ DA7218_ALC_CTRL2, 0x00 },\n\t{ DA7218_ALC_CTRL3, 0x00 },\n\t{ DA7218_ALC_NOISE, 0x3F },\n\t{ DA7218_ALC_TARGET_MIN, 0x3F },\n\t{ DA7218_ALC_TARGET_MAX, 0x00 },\n\t{ DA7218_ALC_GAIN_LIMITS, 0xFF },\n\t{ DA7218_ALC_ANA_GAIN_LIMITS, 0x71 },\n\t{ DA7218_ALC_ANTICLIP_CTRL, 0x00 },\n\t{ DA7218_AGS_ENABLE, 0x00 },\n\t{ DA7218_AGS_TRIGGER, 0x09 },\n\t{ DA7218_AGS_ATT_MAX, 0x00 },\n\t{ DA7218_AGS_TIMEOUT, 0x00 },\n\t{ DA7218_AGS_ANTICLIP_CTRL, 0x00 },\n\t{ DA7218_ENV_TRACK_CTRL, 0x00 },\n\t{ DA7218_LVL_DET_CTRL, 0x00 },\n\t{ DA7218_LVL_DET_LEVEL, 0x7F },\n\t{ DA7218_DGS_TRIGGER, 0x24 },\n\t{ DA7218_DGS_ENABLE, 0x00 },\n\t{ DA7218_DGS_RISE_FALL, 0x50 },\n\t{ DA7218_DGS_SYNC_DELAY, 0xA3 },\n\t{ DA7218_DGS_SYNC_DELAY2, 0x31 },\n\t{ DA7218_DGS_SYNC_DELAY3, 0x11 },\n\t{ DA7218_DGS_LEVELS, 0x01 },\n\t{ DA7218_DGS_GAIN_CTRL, 0x74 },\n\t{ DA7218_DROUTING_OUTDAI_1L, 0x01 },\n\t{ DA7218_DMIX_OUTDAI_1L_INFILT_1L_GAIN, 0x1C },\n\t{ DA7218_DMIX_OUTDAI_1L_INFILT_1R_GAIN, 0x1C },\n\t{ DA7218_DMIX_OUTDAI_1L_INFILT_2L_GAIN, 0x1C },\n\t{ DA7218_DMIX_OUTDAI_1L_INFILT_2R_GAIN, 0x1C },\n\t{ DA7218_DMIX_OUTDAI_1L_TONEGEN_GAIN, 0x1C },\n\t{ DA7218_DMIX_OUTDAI_1L_INDAI_1L_GAIN, 0x1C },\n\t{ DA7218_DMIX_OUTDAI_1L_INDAI_1R_GAIN, 0x1C },\n\t{ DA7218_DROUTING_OUTDAI_1R, 0x04 },\n\t{ DA7218_DMIX_OUTDAI_1R_INFILT_1L_GAIN, 0x1C },\n\t{ DA7218_DMIX_OUTDAI_1R_INFILT_1R_GAIN, 0x1C },\n\t{ DA7218_DMIX_OUTDAI_1R_INFILT_2L_GAIN, 0x1C },\n\t{ DA7218_DMIX_OUTDAI_1R_INFILT_2R_GAIN, 0x1C },\n\t{ DA7218_DMIX_OUTDAI_1R_TONEGEN_GAIN, 0x1C },\n\t{ DA7218_DMIX_OUTDAI_1R_INDAI_1L_GAIN, 0x1C },\n\t{ DA7218_DMIX_OUTDAI_1R_INDAI_1R_GAIN, 0x1C },\n\t{ DA7218_DROUTING_OUTFILT_1L, 0x01 },\n\t{ DA7218_DMIX_OUTFILT_1L_INFILT_1L_GAIN, 0x1C },\n\t{ DA7218_DMIX_OUTFILT_1L_INFILT_1R_GAIN, 0x1C },\n\t{ DA7218_DMIX_OUTFILT_1L_INFILT_2L_GAIN, 0x1C },\n\t{ DA7218_DMIX_OUTFILT_1L_INFILT_2R_GAIN, 0x1C },\n\t{ DA7218_DMIX_OUTFILT_1L_TONEGEN_GAIN, 0x1C },\n\t{ DA7218_DMIX_OUTFILT_1L_INDAI_1L_GAIN, 0x1C },\n\t{ DA7218_DMIX_OUTFILT_1L_INDAI_1R_GAIN, 0x1C },\n\t{ DA7218_DROUTING_OUTFILT_1R, 0x04 },\n\t{ DA7218_DMIX_OUTFILT_1R_INFILT_1L_GAIN, 0x1C },\n\t{ DA7218_DMIX_OUTFILT_1R_INFILT_1R_GAIN, 0x1C },\n\t{ DA7218_DMIX_OUTFILT_1R_INFILT_2L_GAIN, 0x1C },\n\t{ DA7218_DMIX_OUTFILT_1R_INFILT_2R_GAIN, 0x1C },\n\t{ DA7218_DMIX_OUTFILT_1R_TONEGEN_GAIN, 0x1C },\n\t{ DA7218_DMIX_OUTFILT_1R_INDAI_1L_GAIN, 0x1C },\n\t{ DA7218_DMIX_OUTFILT_1R_INDAI_1R_GAIN, 0x1C },\n\t{ DA7218_DROUTING_OUTDAI_2L, 0x04 },\n\t{ DA7218_DMIX_OUTDAI_2L_INFILT_1L_GAIN, 0x1C },\n\t{ DA7218_DMIX_OUTDAI_2L_INFILT_1R_GAIN, 0x1C },\n\t{ DA7218_DMIX_OUTDAI_2L_INFILT_2L_GAIN, 0x1C },\n\t{ DA7218_DMIX_OUTDAI_2L_INFILT_2R_GAIN, 0x1C },\n\t{ DA7218_DMIX_OUTDAI_2L_TONEGEN_GAIN, 0x1C },\n\t{ DA7218_DMIX_OUTDAI_2L_INDAI_1L_GAIN, 0x1C },\n\t{ DA7218_DMIX_OUTDAI_2L_INDAI_1R_GAIN, 0x1C },\n\t{ DA7218_DROUTING_OUTDAI_2R, 0x08 },\n\t{ DA7218_DMIX_OUTDAI_2R_INFILT_1L_GAIN, 0x1C },\n\t{ DA7218_DMIX_OUTDAI_2R_INFILT_1R_GAIN, 0x1C },\n\t{ DA7218_DMIX_OUTDAI_2R_INFILT_2L_GAIN, 0x1C },\n\t{ DA7218_DMIX_OUTDAI_2R_INFILT_2R_GAIN, 0x1C },\n\t{ DA7218_DMIX_OUTDAI_2R_TONEGEN_GAIN, 0x1C },\n\t{ DA7218_DMIX_OUTDAI_2R_INDAI_1L_GAIN, 0x1C },\n\t{ DA7218_DMIX_OUTDAI_2R_INDAI_1R_GAIN, 0x1C },\n\t{ DA7218_DAI_CTRL, 0x28 },\n\t{ DA7218_DAI_TDM_CTRL, 0x40 },\n\t{ DA7218_DAI_OFFSET_LOWER, 0x00 },\n\t{ DA7218_DAI_OFFSET_UPPER, 0x00 },\n\t{ DA7218_DAI_CLK_MODE, 0x01 },\n\t{ DA7218_PLL_CTRL, 0x04 },\n\t{ DA7218_PLL_FRAC_TOP, 0x00 },\n\t{ DA7218_PLL_FRAC_BOT, 0x00 },\n\t{ DA7218_PLL_INTEGER, 0x20 },\n\t{ DA7218_DAC_NG_CTRL, 0x00 },\n\t{ DA7218_DAC_NG_SETUP_TIME, 0x00 },\n\t{ DA7218_DAC_NG_OFF_THRESH, 0x00 },\n\t{ DA7218_DAC_NG_ON_THRESH, 0x00 },\n\t{ DA7218_TONE_GEN_CFG2, 0x00 },\n\t{ DA7218_TONE_GEN_FREQ1_L, 0x55 },\n\t{ DA7218_TONE_GEN_FREQ1_U, 0x15 },\n\t{ DA7218_TONE_GEN_FREQ2_L, 0x00 },\n\t{ DA7218_TONE_GEN_FREQ2_U, 0x40 },\n\t{ DA7218_TONE_GEN_CYCLES, 0x00 },\n\t{ DA7218_TONE_GEN_ON_PER, 0x02 },\n\t{ DA7218_TONE_GEN_OFF_PER, 0x01 },\n\t{ DA7218_CP_CTRL, 0x60 },\n\t{ DA7218_CP_DELAY, 0x11 },\n\t{ DA7218_CP_VOL_THRESHOLD1, 0x0E },\n\t{ DA7218_MIC_1_CTRL, 0x40 },\n\t{ DA7218_MIC_1_GAIN, 0x01 },\n\t{ DA7218_MIC_1_SELECT, 0x00 },\n\t{ DA7218_MIC_2_CTRL, 0x40 },\n\t{ DA7218_MIC_2_GAIN, 0x01 },\n\t{ DA7218_MIC_2_SELECT, 0x00 },\n\t{ DA7218_IN_1_HPF_FILTER_CTRL, 0x80 },\n\t{ DA7218_IN_2_HPF_FILTER_CTRL, 0x80 },\n\t{ DA7218_ADC_1_CTRL, 0x07 },\n\t{ DA7218_ADC_2_CTRL, 0x07 },\n\t{ DA7218_MIXOUT_L_CTRL, 0x00 },\n\t{ DA7218_MIXOUT_L_GAIN, 0x03 },\n\t{ DA7218_MIXOUT_R_CTRL, 0x00 },\n\t{ DA7218_MIXOUT_R_GAIN, 0x03 },\n\t{ DA7218_HP_L_CTRL, 0x40 },\n\t{ DA7218_HP_L_GAIN, 0x3B },\n\t{ DA7218_HP_R_CTRL, 0x40 },\n\t{ DA7218_HP_R_GAIN, 0x3B },\n\t{ DA7218_HP_DIFF_CTRL, 0x00 },\n\t{ DA7218_HP_DIFF_UNLOCK, 0xC3 },\n\t{ DA7218_HPLDET_JACK, 0x0B },\n\t{ DA7218_HPLDET_CTRL, 0x00 },\n\t{ DA7218_REFERENCES, 0x08 },\n\t{ DA7218_IO_CTRL, 0x00 },\n\t{ DA7218_LDO_CTRL, 0x00 },\n\t{ DA7218_SIDETONE_CTRL, 0x40 },\n\t{ DA7218_SIDETONE_IN_SELECT, 0x00 },\n\t{ DA7218_SIDETONE_GAIN, 0x1C },\n\t{ DA7218_DROUTING_ST_OUTFILT_1L, 0x01 },\n\t{ DA7218_DROUTING_ST_OUTFILT_1R, 0x02 },\n\t{ DA7218_SIDETONE_BIQ_3STAGE_DATA, 0x00 },\n\t{ DA7218_SIDETONE_BIQ_3STAGE_ADDR, 0x00 },\n\t{ DA7218_EVENT_MASK, 0x00 },\n\t{ DA7218_DMIC_1_CTRL, 0x00 },\n\t{ DA7218_DMIC_2_CTRL, 0x00 },\n\t{ DA7218_IN_1L_GAIN, 0x6F },\n\t{ DA7218_IN_1R_GAIN, 0x6F },\n\t{ DA7218_IN_2L_GAIN, 0x6F },\n\t{ DA7218_IN_2R_GAIN, 0x6F },\n\t{ DA7218_OUT_1L_GAIN, 0x6F },\n\t{ DA7218_OUT_1R_GAIN, 0x6F },\n\t{ DA7218_MICBIAS_CTRL, 0x00 },\n\t{ DA7218_MICBIAS_EN, 0x00 },\n};\n\nstatic bool da7218_volatile_register(struct device *dev, unsigned int reg)\n{\n\tswitch (reg) {\n\tcase DA7218_STATUS1:\n\tcase DA7218_SOFT_RESET:\n\tcase DA7218_SYSTEM_STATUS:\n\tcase DA7218_CALIB_CTRL:\n\tcase DA7218_CALIB_OFFSET_AUTO_M_1:\n\tcase DA7218_CALIB_OFFSET_AUTO_U_1:\n\tcase DA7218_CALIB_OFFSET_AUTO_M_2:\n\tcase DA7218_CALIB_OFFSET_AUTO_U_2:\n\tcase DA7218_PLL_STATUS:\n\tcase DA7218_PLL_REFOSC_CAL:\n\tcase DA7218_TONE_GEN_CFG1:\n\tcase DA7218_ADC_MODE:\n\tcase DA7218_HP_SNGL_CTRL:\n\tcase DA7218_HPLDET_TEST:\n\tcase DA7218_EVENT_STATUS:\n\tcase DA7218_EVENT:\n\t\treturn true;\n\tdefault:\n\t\treturn false;\n\t}\n}\n\nstatic const struct regmap_config da7218_regmap_config = {\n\t.reg_bits = 8,\n\t.val_bits = 8,\n\n\t.max_register = DA7218_MICBIAS_EN,\n\t.reg_defaults = da7218_reg_defaults,\n\t.num_reg_defaults = ARRAY_SIZE(da7218_reg_defaults),\n\t.volatile_reg = da7218_volatile_register,\n\t.cache_type = REGCACHE_RBTREE,\n};\n\n\n \n\nstatic const struct i2c_device_id da7218_i2c_id[];\n\nstatic inline int da7218_i2c_get_id(struct i2c_client *i2c)\n{\n\tconst struct i2c_device_id *id = i2c_match_id(da7218_i2c_id, i2c);\n\n\tif (id)\n\t\treturn (uintptr_t)id->driver_data;\n\telse\n\t\treturn -EINVAL;\n}\n\nstatic int da7218_i2c_probe(struct i2c_client *i2c)\n{\n\tstruct da7218_priv *da7218;\n\tint ret;\n\n\tda7218 = devm_kzalloc(&i2c->dev, sizeof(*da7218), GFP_KERNEL);\n\tif (!da7218)\n\t\treturn -ENOMEM;\n\n\ti2c_set_clientdata(i2c, da7218);\n\n\tif (i2c->dev.of_node)\n\t\tda7218->dev_id = da7218_of_get_id(&i2c->dev);\n\telse\n\t\tda7218->dev_id = da7218_i2c_get_id(i2c);\n\n\tif ((da7218->dev_id != DA7217_DEV_ID) &&\n\t    (da7218->dev_id != DA7218_DEV_ID)) {\n\t\tdev_err(&i2c->dev, \"Invalid device Id\\n\");\n\t\treturn -EINVAL;\n\t}\n\n\tda7218->irq = i2c->irq;\n\n\tda7218->regmap = devm_regmap_init_i2c(i2c, &da7218_regmap_config);\n\tif (IS_ERR(da7218->regmap)) {\n\t\tret = PTR_ERR(da7218->regmap);\n\t\tdev_err(&i2c->dev, \"regmap_init() failed: %d\\n\", ret);\n\t\treturn ret;\n\t}\n\n\tret = devm_snd_soc_register_component(&i2c->dev,\n\t\t\t&soc_component_dev_da7218, &da7218_dai, 1);\n\tif (ret < 0) {\n\t\tdev_err(&i2c->dev, \"Failed to register da7218 component: %d\\n\",\n\t\t\tret);\n\t}\n\treturn ret;\n}\n\nstatic const struct i2c_device_id da7218_i2c_id[] = {\n\t{ \"da7217\", DA7217_DEV_ID },\n\t{ \"da7218\", DA7218_DEV_ID },\n\t{ }\n};\nMODULE_DEVICE_TABLE(i2c, da7218_i2c_id);\n\nstatic struct i2c_driver da7218_i2c_driver = {\n\t.driver = {\n\t\t.name = \"da7218\",\n\t\t.of_match_table = da7218_of_match,\n\t},\n\t.probe\t\t= da7218_i2c_probe,\n\t.id_table\t= da7218_i2c_id,\n};\n\nmodule_i2c_driver(da7218_i2c_driver);\n\nMODULE_DESCRIPTION(\"ASoC DA7218 Codec driver\");\nMODULE_AUTHOR(\"Adam Thomson <Adam.Thomson.Opensource@diasemi.com>\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}