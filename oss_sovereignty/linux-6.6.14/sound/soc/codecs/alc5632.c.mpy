{
  "module_name": "alc5632.c",
  "hash_id": "ff1baae353d8cee167691268f2ef996b99c10af616669c3608724f0b4fe7d278",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/codecs/alc5632.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/init.h>\n#include <linux/delay.h>\n#include <linux/pm.h>\n#include <linux/i2c.h>\n#include <linux/slab.h>\n#include <linux/regmap.h>\n#include <sound/core.h>\n#include <sound/pcm.h>\n#include <sound/pcm_params.h>\n#include <sound/tlv.h>\n#include <sound/soc.h>\n#include <sound/initval.h>\n\n#include \"alc5632.h\"\n\n \nstatic const struct reg_default alc5632_reg_defaults[] = {\n\t{   2, 0x8080 },\t \n\t{   4, 0x8080 },\t \n\t{   6, 0x8080 },\t \n\t{   8, 0xC800 },\t \n\t{  10, 0xE808 },\t \n\t{  12, 0x1010 },\t \n\t{  14, 0x0808 },\t \n\t{  16, 0xEE0F },\t \n\t{  18, 0xCBCB },\t \n\t{  20, 0x7F7F },\t \n\t{  24, 0xE010 },\t \n\t{  28, 0x8008 },\t \n\t{  34, 0x0000 },\t \n\t{  36, 0x00C0 },     \n\t{  46, 0x0000 },\t \n\t{  52, 0x8000 },\t \n\t{  54, 0x0000 },\t \n\t{  58, 0x0000 },\t \n\t{  60, 0x0000 },\t \n\t{  62, 0x8000 },\t \n\t{  64, 0x0C0A },\t \n\t{  66, 0x0000 },\t \n\t{  68, 0x0000 },\t \n\t{  70, 0x0000 },\t \n\t{  76, 0xBE3E },\t \n\t{  78, 0xBE3E },\t \n\t{  80, 0x0000 },\t \n\t{  82, 0x0000 },\t \n\t{  86, 0x0000 },\t \n\t{  90, 0x0009 },\t \n\t{  92, 0x0000 },\t \n\t{  94, 0x3000 },\t \n\t{  96, 0x3075 },\t \n\t{  98, 0x1010 },\t \n\t{ 100, 0x3110 },\t \n\t{ 104, 0x0553 },\t \n\t{ 106, 0x0000 },\t \n};\n\n \nstruct alc5632_priv {\n\tstruct regmap *regmap;\n\tu8 id;\n\tunsigned int sysclk;\n};\n\nstatic bool alc5632_volatile_register(struct device *dev,\n\t\t\t\t\t\t\tunsigned int reg)\n{\n\tswitch (reg) {\n\tcase ALC5632_RESET:\n\tcase ALC5632_PWR_DOWN_CTRL_STATUS:\n\tcase ALC5632_GPIO_PIN_STATUS:\n\tcase ALC5632_OVER_CURR_STATUS:\n\tcase ALC5632_HID_CTRL_DATA:\n\tcase ALC5632_EQ_CTRL:\n\tcase ALC5632_VENDOR_ID1:\n\tcase ALC5632_VENDOR_ID2:\n\t\treturn true;\n\n\tdefault:\n\t\tbreak;\n\t}\n\n\treturn false;\n}\n\nstatic inline int alc5632_reset(struct regmap *map)\n{\n\treturn regmap_write(map, ALC5632_RESET, 0x59B4);\n}\n\nstatic int amp_mixer_event(struct snd_soc_dapm_widget *w,\n\tstruct snd_kcontrol *kcontrol, int event)\n{\n\tstruct snd_soc_component *component = snd_soc_dapm_to_component(w->dapm);\n\n\t \n\t \n\t \n\t \n\tsnd_soc_component_write(component, ALC5632_HID_CTRL_INDEX, 0x46);\n\n\tswitch (event) {\n\tcase SND_SOC_DAPM_PRE_PMU:\n\t\tsnd_soc_component_write(component, ALC5632_HID_CTRL_DATA, 0xFFFF);\n\t\tbreak;\n\tcase SND_SOC_DAPM_POST_PMD:\n\t\tsnd_soc_component_write(component, ALC5632_HID_CTRL_DATA, 0);\n\t\tbreak;\n\t}\n\n\treturn 0;\n}\n\n \n\n \nstatic const DECLARE_TLV_DB_SCALE(vol_tlv, -3450, 150, 0);\n \nstatic const DECLARE_TLV_DB_SCALE(hp_tlv, -4650, 150, 0);\n \nstatic const DECLARE_TLV_DB_SCALE(adc_rec_tlv, -1650, 150, 0);\nstatic const DECLARE_TLV_DB_RANGE(boost_tlv,\n\t0, 1, TLV_DB_SCALE_ITEM(0, 2000, 0),\n\t1, 3, TLV_DB_SCALE_ITEM(2000, 1000, 0)\n);\n \nstatic const DECLARE_TLV_DB_SCALE(dig_tlv, 0, 600, 0);\n \nstatic const DECLARE_TLV_DB_SCALE(vdac_tlv, -3525, 75, 0);\n\nstatic const struct snd_kcontrol_new alc5632_vol_snd_controls[] = {\n\t \n\t \n\tSOC_DOUBLE_TLV(\"Speaker Playback Volume\",\n\t\t\tALC5632_SPK_OUT_VOL, 8, 0, 31, 1, hp_tlv),\n\t \n\tSOC_DOUBLE(\"Speaker Playback Switch\",\n\t\t\tALC5632_SPK_OUT_VOL, 15, 7, 1, 1),\n\tSOC_DOUBLE_TLV(\"Headphone Playback Volume\",\n\t\t\tALC5632_HP_OUT_VOL, 8, 0, 31, 1, hp_tlv),\n\tSOC_DOUBLE(\"Headphone Playback Switch\",\n\t\t\tALC5632_HP_OUT_VOL, 15, 7, 1, 1),\n};\n\nstatic const struct snd_kcontrol_new alc5632_snd_controls[] = {\n\tSOC_DOUBLE_TLV(\"Auxout Playback Volume\",\n\t\t\tALC5632_AUX_OUT_VOL, 8, 0, 31, 1, hp_tlv),\n\tSOC_DOUBLE(\"Auxout Playback Switch\",\n\t\t\tALC5632_AUX_OUT_VOL, 15, 7, 1, 1),\n\tSOC_SINGLE_TLV(\"Voice DAC Playback Volume\",\n\t\t\tALC5632_VOICE_DAC_VOL, 0, 63, 0, vdac_tlv),\n\tSOC_SINGLE(\"Voice DAC Playback Switch\",\n\t\t\tALC5632_VOICE_DAC_VOL, 12, 1, 1),\n\tSOC_SINGLE_TLV(\"Phone Playback Volume\",\n\t\t\tALC5632_PHONE_IN_VOL, 8, 31, 1, vol_tlv),\n\tSOC_DOUBLE_TLV(\"LineIn Playback Volume\",\n\t\t\tALC5632_LINE_IN_VOL, 8, 0, 31, 1, vol_tlv),\n\tSOC_DOUBLE_TLV(\"Master Playback Volume\",\n\t\t\tALC5632_STEREO_DAC_IN_VOL, 8, 0, 63, 1, vdac_tlv),\n\tSOC_DOUBLE(\"Master Playback Switch\",\n\t\t\tALC5632_STEREO_DAC_IN_VOL, 15, 7, 1, 1),\n\tSOC_SINGLE_TLV(\"Mic1 Playback Volume\",\n\t\t\tALC5632_MIC_VOL, 8, 31, 1, vol_tlv),\n\tSOC_SINGLE_TLV(\"Mic2 Playback Volume\",\n\t\t\tALC5632_MIC_VOL, 0, 31, 1, vol_tlv),\n\tSOC_DOUBLE_TLV(\"Rec Capture Volume\",\n\t\t\tALC5632_ADC_REC_GAIN, 8, 0, 31, 0, adc_rec_tlv),\n\tSOC_SINGLE_TLV(\"Mic 1 Boost Volume\",\n\t\t\tALC5632_MIC_CTRL, 10, 3, 0, boost_tlv),\n\tSOC_SINGLE_TLV(\"Mic 2 Boost Volume\",\n\t\t\tALC5632_MIC_CTRL, 8, 3, 0, boost_tlv),\n\tSOC_SINGLE_TLV(\"DMIC Boost Capture Volume\",\n\t\t\tALC5632_DIGI_BOOST_CTRL, 0, 7, 0, dig_tlv),\n\tSOC_SINGLE(\"DMIC En Capture Switch\",\n\t\t\tALC5632_DIGI_BOOST_CTRL, 15, 1, 0),\n\tSOC_SINGLE(\"DMIC PreFilter Capture Switch\",\n\t\t\tALC5632_DIGI_BOOST_CTRL, 12, 1, 0),\n};\n\n \nstatic const struct snd_kcontrol_new alc5632_hp_mixer_controls[] = {\nSOC_DAPM_SINGLE(\"LI2HP Playback Switch\", ALC5632_LINE_IN_VOL, 15, 1, 1),\nSOC_DAPM_SINGLE(\"PHONE2HP Playback Switch\", ALC5632_PHONE_IN_VOL, 15, 1, 1),\nSOC_DAPM_SINGLE(\"MIC12HP Playback Switch\", ALC5632_MIC_ROUTING_CTRL, 15, 1, 1),\nSOC_DAPM_SINGLE(\"MIC22HP Playback Switch\", ALC5632_MIC_ROUTING_CTRL, 11, 1, 1),\nSOC_DAPM_SINGLE(\"VOICE2HP Playback Switch\", ALC5632_VOICE_DAC_VOL, 15, 1, 1),\n};\n\nstatic const struct snd_kcontrol_new alc5632_hpl_mixer_controls[] = {\nSOC_DAPM_SINGLE(\"ADC2HP_L Playback Switch\", ALC5632_ADC_REC_GAIN, 15, 1, 1),\nSOC_DAPM_SINGLE(\"DACL2HP Playback Switch\", ALC5632_MIC_ROUTING_CTRL, 3, 1, 1),\n};\n\nstatic const struct snd_kcontrol_new alc5632_hpr_mixer_controls[] = {\nSOC_DAPM_SINGLE(\"ADC2HP_R Playback Switch\", ALC5632_ADC_REC_GAIN, 7, 1, 1),\nSOC_DAPM_SINGLE(\"DACR2HP Playback Switch\", ALC5632_MIC_ROUTING_CTRL, 2, 1, 1),\n};\n\nstatic const struct snd_kcontrol_new alc5632_mono_mixer_controls[] = {\nSOC_DAPM_SINGLE(\"ADC2MONO_L Playback Switch\", ALC5632_ADC_REC_GAIN, 14, 1, 1),\nSOC_DAPM_SINGLE(\"ADC2MONO_R Playback Switch\", ALC5632_ADC_REC_GAIN, 6, 1, 1),\nSOC_DAPM_SINGLE(\"LI2MONO Playback Switch\", ALC5632_LINE_IN_VOL, 13, 1, 1),\nSOC_DAPM_SINGLE(\"MIC12MONO Playback Switch\",\n\t\t\t\t\tALC5632_MIC_ROUTING_CTRL, 13, 1, 1),\nSOC_DAPM_SINGLE(\"MIC22MONO Playback Switch\",\n\t\t\t\t\tALC5632_MIC_ROUTING_CTRL, 9, 1, 1),\nSOC_DAPM_SINGLE(\"DAC2MONO Playback Switch\", ALC5632_MIC_ROUTING_CTRL, 0, 1, 1),\nSOC_DAPM_SINGLE(\"VOICE2MONO Playback Switch\", ALC5632_VOICE_DAC_VOL, 13, 1, 1),\n};\n\nstatic const struct snd_kcontrol_new alc5632_speaker_mixer_controls[] = {\nSOC_DAPM_SINGLE(\"LI2SPK Playback Switch\", ALC5632_LINE_IN_VOL, 14, 1, 1),\nSOC_DAPM_SINGLE(\"PHONE2SPK Playback Switch\", ALC5632_PHONE_IN_VOL, 14, 1, 1),\nSOC_DAPM_SINGLE(\"MIC12SPK Playback Switch\",\n\t\t\t\t\tALC5632_MIC_ROUTING_CTRL, 14, 1, 1),\nSOC_DAPM_SINGLE(\"MIC22SPK Playback Switch\",\n\t\t\t\t\tALC5632_MIC_ROUTING_CTRL, 10, 1, 1),\nSOC_DAPM_SINGLE(\"DAC2SPK Playback Switch\", ALC5632_MIC_ROUTING_CTRL, 1, 1, 1),\nSOC_DAPM_SINGLE(\"VOICE2SPK Playback Switch\", ALC5632_VOICE_DAC_VOL, 14, 1, 1),\n};\n\n \nstatic const struct snd_kcontrol_new alc5632_captureL_mixer_controls[] = {\nSOC_DAPM_SINGLE(\"MIC12REC_L Capture Switch\", ALC5632_ADC_REC_MIXER, 14, 1, 1),\nSOC_DAPM_SINGLE(\"MIC22REC_L Capture Switch\", ALC5632_ADC_REC_MIXER, 13, 1, 1),\nSOC_DAPM_SINGLE(\"LIL2REC Capture Switch\", ALC5632_ADC_REC_MIXER, 12, 1, 1),\nSOC_DAPM_SINGLE(\"PH2REC_L Capture Switch\", ALC5632_ADC_REC_MIXER, 11, 1, 1),\nSOC_DAPM_SINGLE(\"HPL2REC Capture Switch\", ALC5632_ADC_REC_MIXER, 10, 1, 1),\nSOC_DAPM_SINGLE(\"SPK2REC_L Capture Switch\", ALC5632_ADC_REC_MIXER, 9, 1, 1),\nSOC_DAPM_SINGLE(\"MONO2REC_L Capture Switch\", ALC5632_ADC_REC_MIXER, 8, 1, 1),\n};\n\n \nstatic const struct snd_kcontrol_new alc5632_captureR_mixer_controls[] = {\nSOC_DAPM_SINGLE(\"MIC12REC_R Capture Switch\", ALC5632_ADC_REC_MIXER, 6, 1, 1),\nSOC_DAPM_SINGLE(\"MIC22REC_R Capture Switch\", ALC5632_ADC_REC_MIXER, 5, 1, 1),\nSOC_DAPM_SINGLE(\"LIR2REC Capture Switch\", ALC5632_ADC_REC_MIXER, 4, 1, 1),\nSOC_DAPM_SINGLE(\"PH2REC_R Capture Switch\", ALC5632_ADC_REC_MIXER, 3, 1, 1),\nSOC_DAPM_SINGLE(\"HPR2REC Capture Switch\", ALC5632_ADC_REC_MIXER, 2, 1, 1),\nSOC_DAPM_SINGLE(\"SPK2REC_R Capture Switch\", ALC5632_ADC_REC_MIXER, 1, 1, 1),\nSOC_DAPM_SINGLE(\"MONO2REC_R Capture Switch\", ALC5632_ADC_REC_MIXER, 0, 1, 1),\n};\n\n \nstatic const struct snd_kcontrol_new alc5632_dmicl_mixer_controls[] = {\nSOC_DAPM_SINGLE(\"DMICL2ADC Capture Switch\", ALC5632_DIGI_BOOST_CTRL, 7, 1, 1),\n};\nstatic const struct snd_kcontrol_new alc5632_dmicr_mixer_controls[] = {\nSOC_DAPM_SINGLE(\"DMICR2ADC Capture Switch\", ALC5632_DIGI_BOOST_CTRL, 6, 1, 1),\n};\n\nstatic const char * const alc5632_spk_n_sour_sel[] = {\n\t\t\"RN/-R\", \"RP/+R\", \"LN/-R\", \"Mute\"};\nstatic const char * const alc5632_hpl_out_input_sel[] = {\n\t\t\"Vmid\", \"HP Left Mix\"};\nstatic const char * const alc5632_hpr_out_input_sel[] = {\n\t\t\"Vmid\", \"HP Right Mix\"};\nstatic const char * const alc5632_spkout_input_sel[] = {\n\t\t\"Vmid\", \"HPOut Mix\", \"Speaker Mix\", \"Mono Mix\"};\nstatic const char * const alc5632_aux_out_input_sel[] = {\n\t\t\"Vmid\", \"HPOut Mix\", \"Speaker Mix\", \"Mono Mix\"};\nstatic const char * const alc5632_adcr_func_sel[] = {\n\t\t\"Stereo ADC\", \"Voice ADC\"};\nstatic const char * const alc5632_i2s_out_sel[] = {\n\t\t\"ADC LR\", \"Voice Stereo Digital\"};\n\n \nstatic SOC_ENUM_SINGLE_DECL(alc5632_aux_out_input_enum,\n\t\t\t    ALC5632_OUTPUT_MIXER_CTRL, 6,\n\t\t\t    alc5632_aux_out_input_sel);\nstatic const struct snd_kcontrol_new alc5632_auxout_mux_controls =\nSOC_DAPM_ENUM(\"AuxOut Mux\", alc5632_aux_out_input_enum);\n\n \nstatic SOC_ENUM_SINGLE_DECL(alc5632_spkout_input_enum,\n\t\t\t    ALC5632_OUTPUT_MIXER_CTRL, 10,\n\t\t\t    alc5632_spkout_input_sel);\nstatic const struct snd_kcontrol_new alc5632_spkout_mux_controls =\nSOC_DAPM_ENUM(\"SpeakerOut Mux\", alc5632_spkout_input_enum);\n\n \nstatic SOC_ENUM_SINGLE_DECL(alc5632_hpl_out_input_enum,\n\t\t\t    ALC5632_OUTPUT_MIXER_CTRL, 9,\n\t\t\t    alc5632_hpl_out_input_sel);\nstatic const struct snd_kcontrol_new alc5632_hpl_out_mux_controls =\nSOC_DAPM_ENUM(\"Left Headphone Mux\", alc5632_hpl_out_input_enum);\n\n \nstatic SOC_ENUM_SINGLE_DECL(alc5632_hpr_out_input_enum,\n\t\t\t    ALC5632_OUTPUT_MIXER_CTRL, 8,\n\t\t\t    alc5632_hpr_out_input_sel);\nstatic const struct snd_kcontrol_new alc5632_hpr_out_mux_controls =\nSOC_DAPM_ENUM(\"Right Headphone Mux\", alc5632_hpr_out_input_enum);\n\n \nstatic SOC_ENUM_SINGLE_DECL(alc5632_spk_n_sour_enum,\n\t\t\t    ALC5632_OUTPUT_MIXER_CTRL, 14,\n\t\t\t    alc5632_spk_n_sour_sel);\nstatic const struct snd_kcontrol_new alc5632_spkoutn_mux_controls =\nSOC_DAPM_ENUM(\"SpeakerOut N Mux\", alc5632_spk_n_sour_enum);\n\n \nstatic const char *alc5632_amp_names[] = {\"AB Amp\", \"D Amp\"};\nstatic SOC_ENUM_SINGLE_DECL(alc5632_amp_enum,\n\t\t\t    ALC5632_OUTPUT_MIXER_CTRL, 13,\n\t\t\t    alc5632_amp_names);\nstatic const struct snd_kcontrol_new alc5632_amp_mux_controls =\n\tSOC_DAPM_ENUM(\"AB-D Amp Mux\", alc5632_amp_enum);\n\n \nstatic SOC_ENUM_SINGLE_DECL(alc5632_adcr_func_enum,\n\t\t\t    ALC5632_DAC_FUNC_SELECT, 5,\n\t\t\t    alc5632_adcr_func_sel);\nstatic const struct snd_kcontrol_new alc5632_adcr_func_controls =\n\tSOC_DAPM_ENUM(\"ADCR Mux\", alc5632_adcr_func_enum);\n\n \nstatic SOC_ENUM_SINGLE_DECL(alc5632_i2s_out_enum,\n\t\t\t    ALC5632_I2S_OUT_CTL, 5,\n\t\t\t    alc5632_i2s_out_sel);\nstatic const struct snd_kcontrol_new alc5632_i2s_out_controls =\n\tSOC_DAPM_ENUM(\"I2SOut Mux\", alc5632_i2s_out_enum);\n\nstatic const struct snd_soc_dapm_widget alc5632_dapm_widgets[] = {\n \nSND_SOC_DAPM_MUX(\"AuxOut Mux\", SND_SOC_NOPM, 0, 0,\n\t&alc5632_auxout_mux_controls),\nSND_SOC_DAPM_MUX(\"SpeakerOut Mux\", SND_SOC_NOPM, 0, 0,\n\t&alc5632_spkout_mux_controls),\nSND_SOC_DAPM_MUX(\"Left Headphone Mux\", SND_SOC_NOPM, 0, 0,\n\t&alc5632_hpl_out_mux_controls),\nSND_SOC_DAPM_MUX(\"Right Headphone Mux\", SND_SOC_NOPM, 0, 0,\n\t&alc5632_hpr_out_mux_controls),\nSND_SOC_DAPM_MUX(\"SpeakerOut N Mux\", SND_SOC_NOPM, 0, 0,\n\t&alc5632_spkoutn_mux_controls),\nSND_SOC_DAPM_MUX(\"ADCR Mux\", SND_SOC_NOPM, 0, 0,\n\t&alc5632_adcr_func_controls),\nSND_SOC_DAPM_MUX(\"I2SOut Mux\", ALC5632_PWR_MANAG_ADD1, 11, 0,\n\t&alc5632_i2s_out_controls),\n\n \nSND_SOC_DAPM_MIXER(\"HP Mix\", SND_SOC_NOPM, 0, 0,\n\t&alc5632_hp_mixer_controls[0],\n\tARRAY_SIZE(alc5632_hp_mixer_controls)),\nSND_SOC_DAPM_MIXER(\"HPR Mix\", ALC5632_PWR_MANAG_ADD2, 4, 0,\n\t&alc5632_hpr_mixer_controls[0],\n\tARRAY_SIZE(alc5632_hpr_mixer_controls)),\nSND_SOC_DAPM_MIXER(\"HPL Mix\", ALC5632_PWR_MANAG_ADD2, 5, 0,\n\t&alc5632_hpl_mixer_controls[0],\n\tARRAY_SIZE(alc5632_hpl_mixer_controls)),\nSND_SOC_DAPM_MIXER(\"HPOut Mix\", SND_SOC_NOPM, 0, 0, NULL, 0),\nSND_SOC_DAPM_MIXER(\"Mono Mix\", ALC5632_PWR_MANAG_ADD2, 2, 0,\n\t&alc5632_mono_mixer_controls[0],\n\tARRAY_SIZE(alc5632_mono_mixer_controls)),\nSND_SOC_DAPM_MIXER(\"Speaker Mix\", ALC5632_PWR_MANAG_ADD2, 3, 0,\n\t&alc5632_speaker_mixer_controls[0],\n\tARRAY_SIZE(alc5632_speaker_mixer_controls)),\nSND_SOC_DAPM_MIXER(\"DMICL Mix\", SND_SOC_NOPM, 0, 0,\n\t&alc5632_dmicl_mixer_controls[0],\n\tARRAY_SIZE(alc5632_dmicl_mixer_controls)),\nSND_SOC_DAPM_MIXER(\"DMICR Mix\", SND_SOC_NOPM, 0, 0,\n\t&alc5632_dmicr_mixer_controls[0],\n\tARRAY_SIZE(alc5632_dmicr_mixer_controls)),\n\n \nSND_SOC_DAPM_MIXER(\"Left Capture Mix\", ALC5632_PWR_MANAG_ADD2, 1, 0,\n\t&alc5632_captureL_mixer_controls[0],\n\tARRAY_SIZE(alc5632_captureL_mixer_controls)),\nSND_SOC_DAPM_MIXER(\"Right Capture Mix\", ALC5632_PWR_MANAG_ADD2, 0, 0,\n\t&alc5632_captureR_mixer_controls[0],\n\tARRAY_SIZE(alc5632_captureR_mixer_controls)),\n\nSND_SOC_DAPM_AIF_IN(\"AIFRXL\", \"Left HiFi Playback\", 0, SND_SOC_NOPM, 0, 0),\nSND_SOC_DAPM_AIF_IN(\"AIFRXR\", \"Right HiFi Playback\", 0, SND_SOC_NOPM, 0, 0),\nSND_SOC_DAPM_AIF_OUT(\"AIFTXL\", \"Left HiFi Capture\", 0, SND_SOC_NOPM, 0, 0),\nSND_SOC_DAPM_AIF_OUT(\"AIFTXR\", \"Right HiFi Capture\", 0, SND_SOC_NOPM, 0, 0),\nSND_SOC_DAPM_AIF_IN(\"VAIFRX\", \"Voice Playback\", 0, SND_SOC_NOPM, 0, 0),\nSND_SOC_DAPM_AIF_OUT(\"VAIFTX\", \"Voice Capture\", 0, SND_SOC_NOPM, 0, 0),\n\nSND_SOC_DAPM_DAC(\"Voice DAC\", NULL, ALC5632_PWR_MANAG_ADD2, 10, 0),\nSND_SOC_DAPM_DAC(\"Left DAC\", NULL, ALC5632_PWR_MANAG_ADD2, 9, 0),\nSND_SOC_DAPM_DAC(\"Right DAC\", NULL, ALC5632_PWR_MANAG_ADD2, 8, 0),\nSND_SOC_DAPM_ADC(\"Left ADC\", NULL, ALC5632_PWR_MANAG_ADD2, 7, 0),\nSND_SOC_DAPM_ADC(\"Right ADC\", NULL, ALC5632_PWR_MANAG_ADD2, 6, 0),\n\nSND_SOC_DAPM_MIXER(\"DAC Left Channel\", ALC5632_PWR_MANAG_ADD1, 15, 0, NULL, 0),\nSND_SOC_DAPM_MIXER(\"DAC Right Channel\",\n\tALC5632_PWR_MANAG_ADD1, 14, 0, NULL, 0),\nSND_SOC_DAPM_MIXER(\"I2S Mix\", ALC5632_PWR_MANAG_ADD1, 11, 0, NULL, 0),\nSND_SOC_DAPM_MIXER(\"Phone Mix\", SND_SOC_NOPM, 0, 0, NULL, 0),\nSND_SOC_DAPM_MIXER(\"Line Mix\", SND_SOC_NOPM, 0, 0, NULL, 0),\nSND_SOC_DAPM_MIXER(\"Voice Mix\", SND_SOC_NOPM, 0, 0, NULL, 0),\nSND_SOC_DAPM_MIXER(\"ADCLR\", SND_SOC_NOPM, 0, 0, NULL, 0),\n\nSND_SOC_DAPM_PGA(\"Left Headphone\", ALC5632_PWR_MANAG_ADD3, 11, 0, NULL, 0),\nSND_SOC_DAPM_PGA(\"Right Headphone\", ALC5632_PWR_MANAG_ADD3, 10, 0, NULL, 0),\nSND_SOC_DAPM_PGA(\"Left Speaker\", ALC5632_PWR_MANAG_ADD3, 13, 0, NULL, 0),\nSND_SOC_DAPM_PGA(\"Right Speaker\", ALC5632_PWR_MANAG_ADD3, 12, 0, NULL, 0),\nSND_SOC_DAPM_PGA(\"Aux Out\", ALC5632_PWR_MANAG_ADD3, 14, 0, NULL, 0),\nSND_SOC_DAPM_PGA(\"Left LineIn\", ALC5632_PWR_MANAG_ADD3, 7, 0, NULL, 0),\nSND_SOC_DAPM_PGA(\"Right LineIn\", ALC5632_PWR_MANAG_ADD3, 6, 0, NULL, 0),\nSND_SOC_DAPM_PGA(\"Phone\", ALC5632_PWR_MANAG_ADD3, 5, 0, NULL, 0),\nSND_SOC_DAPM_PGA(\"Phone ADMix\", ALC5632_PWR_MANAG_ADD3, 4, 0, NULL, 0),\nSND_SOC_DAPM_PGA(\"MIC1 PGA\", ALC5632_PWR_MANAG_ADD3, 3, 0, NULL, 0),\nSND_SOC_DAPM_PGA(\"MIC2 PGA\", ALC5632_PWR_MANAG_ADD3, 2, 0, NULL, 0),\nSND_SOC_DAPM_PGA(\"MIC1 Pre Amp\", ALC5632_PWR_MANAG_ADD3, 1, 0, NULL, 0),\nSND_SOC_DAPM_PGA(\"MIC2 Pre Amp\", ALC5632_PWR_MANAG_ADD3, 0, 0, NULL, 0),\nSND_SOC_DAPM_SUPPLY(\"MICBIAS1\", ALC5632_PWR_MANAG_ADD1, 3, 0, NULL, 0),\nSND_SOC_DAPM_SUPPLY(\"MICBIAS2\", ALC5632_PWR_MANAG_ADD1, 2, 0, NULL, 0),\n\nSND_SOC_DAPM_PGA_E(\"D Amp\", ALC5632_PWR_MANAG_ADD2, 14, 0, NULL, 0,\n\tamp_mixer_event, SND_SOC_DAPM_PRE_PMU | SND_SOC_DAPM_POST_PMD),\nSND_SOC_DAPM_PGA(\"AB Amp\", ALC5632_PWR_MANAG_ADD2, 15, 0, NULL, 0),\nSND_SOC_DAPM_MUX(\"AB-D Amp Mux\", ALC5632_PWR_MANAG_ADD1, 10, 0,\n\t&alc5632_amp_mux_controls),\n\nSND_SOC_DAPM_OUTPUT(\"AUXOUT\"),\nSND_SOC_DAPM_OUTPUT(\"HPL\"),\nSND_SOC_DAPM_OUTPUT(\"HPR\"),\nSND_SOC_DAPM_OUTPUT(\"SPKOUT\"),\nSND_SOC_DAPM_OUTPUT(\"SPKOUTN\"),\n\nSND_SOC_DAPM_INPUT(\"LINEINL\"),\nSND_SOC_DAPM_INPUT(\"LINEINR\"),\nSND_SOC_DAPM_INPUT(\"PHONEP\"),\nSND_SOC_DAPM_INPUT(\"PHONEN\"),\nSND_SOC_DAPM_INPUT(\"DMICDAT\"),\nSND_SOC_DAPM_INPUT(\"MIC1\"),\nSND_SOC_DAPM_INPUT(\"MIC2\"),\nSND_SOC_DAPM_VMID(\"Vmid\"),\n};\n\n\nstatic const struct snd_soc_dapm_route alc5632_dapm_routes[] = {\n\t \n\t{\"Left DAC\", NULL, \"AIFRXL\"},\n\t{\"Right DAC\", NULL, \"AIFRXR\"},\n\n\t \n\t{\"I2S Mix\",\tNULL,\t\"Left DAC\"},\n\t{\"I2S Mix\",\tNULL,\t\"Right DAC\"},\n\t{\"Line Mix\",\tNULL,\t\"Right LineIn\"},\n\t{\"Line Mix\",\tNULL,\t\"Left LineIn\"},\n\t{\"Phone Mix\",\tNULL,\t\"Phone\"},\n\t{\"Phone Mix\",\tNULL,\t\"Phone ADMix\"},\n\t{\"AUXOUT\",\t\tNULL,\t\"Aux Out\"},\n\n\t \n\t{\"DAC Right Channel\",\tNULL,\t\"I2S Mix\"},\n\t{\"DAC Left Channel\",\tNULL,   \"I2S Mix\"},\n\n\t \n\t{\"HPL Mix\",\t\"ADC2HP_L Playback Switch\",\t\"Left Capture Mix\"},\n\t{\"HPL Mix\", NULL,\t\t\t\t\t\"HP Mix\"},\n\t{\"HPR Mix\", \"ADC2HP_R Playback Switch\",\t\"Right Capture Mix\"},\n\t{\"HPR Mix\", NULL,\t\t\t\t\t\"HP Mix\"},\n\t{\"HP Mix\",\t\"LI2HP Playback Switch\",\t\"Line Mix\"},\n\t{\"HP Mix\",\t\"PHONE2HP Playback Switch\",\t\"Phone Mix\"},\n\t{\"HP Mix\",\t\"MIC12HP Playback Switch\",\t\"MIC1 PGA\"},\n\t{\"HP Mix\",\t\"MIC22HP Playback Switch\",\t\"MIC2 PGA\"},\n\t{\"HP Mix\", \"VOICE2HP Playback Switch\",\t\"Voice Mix\"},\n\t{\"HPR Mix\", \"DACR2HP Playback Switch\",\t\"DAC Right Channel\"},\n\t{\"HPL Mix\", \"DACL2HP Playback Switch\",\t\"DAC Left Channel\"},\n\t{\"HPOut Mix\", NULL, \"HP Mix\"},\n\t{\"HPOut Mix\", NULL, \"HPR Mix\"},\n\t{\"HPOut Mix\", NULL, \"HPL Mix\"},\n\n\t \n\t{\"Speaker Mix\", \"LI2SPK Playback Switch\",\t\"Line Mix\"},\n\t{\"Speaker Mix\", \"PHONE2SPK Playback Switch\", \"Phone Mix\"},\n\t{\"Speaker Mix\", \"MIC12SPK Playback Switch\",\t\"MIC1 PGA\"},\n\t{\"Speaker Mix\", \"MIC22SPK Playback Switch\",\t\"MIC2 PGA\"},\n\t{\"Speaker Mix\", \"DAC2SPK Playback Switch\",\t\"DAC Left Channel\"},\n\t{\"Speaker Mix\", \"VOICE2SPK Playback Switch\",\t\"Voice Mix\"},\n\n\t \n\t{\"Mono Mix\", \"ADC2MONO_L Playback Switch\",\t\"Left Capture Mix\"},\n\t{\"Mono Mix\", \"ADC2MONO_R Playback Switch\",\t\"Right Capture Mix\"},\n\t{\"Mono Mix\", \"LI2MONO Playback Switch\",\t\t\"Line Mix\"},\n\t{\"Mono Mix\", \"MIC12MONO Playback Switch\",\t\"MIC1 PGA\"},\n\t{\"Mono Mix\", \"MIC22MONO Playback Switch\",\t\"MIC2 PGA\"},\n\t{\"Mono Mix\", \"DAC2MONO Playback Switch\",\t\"DAC Left Channel\"},\n\t{\"Mono Mix\", \"VOICE2MONO Playback Switch\",\t\"Voice Mix\"},\n\n\t \n\t{\"Left Capture Mix\", \"LIL2REC Capture Switch\", \"LINEINL\"},\n\t{\"Left Capture Mix\", \"PH2REC_L Capture Switch\", \"PHONEN\"},\n\t{\"Left Capture Mix\", \"MIC12REC_L Capture Switch\", \"MIC1 Pre Amp\"},\n\t{\"Left Capture Mix\", \"MIC22REC_L Capture Switch\", \"MIC2 Pre Amp\"},\n\t{\"Left Capture Mix\", \"HPL2REC Capture Switch\", \"HPL Mix\"},\n\t{\"Left Capture Mix\", \"SPK2REC_L Capture Switch\", \"Speaker Mix\"},\n\t{\"Left Capture Mix\", \"MONO2REC_L Capture Switch\", \"Mono Mix\"},\n\n\t \n\t{\"Right Capture Mix\", \"LIR2REC Capture Switch\", \"LINEINR\"},\n\t{\"Right Capture Mix\", \"PH2REC_R Capture Switch\", \"PHONEP\"},\n\t{\"Right Capture Mix\", \"MIC12REC_R Capture Switch\", \"MIC1 Pre Amp\"},\n\t{\"Right Capture Mix\", \"MIC22REC_R Capture Switch\", \"MIC2 Pre Amp\"},\n\t{\"Right Capture Mix\", \"HPR2REC Capture Switch\", \"HPR Mix\"},\n\t{\"Right Capture Mix\", \"SPK2REC_R Capture Switch\", \"Speaker Mix\"},\n\t{\"Right Capture Mix\", \"MONO2REC_R Capture Switch\", \"Mono Mix\"},\n\n\t \n\t{\"Left Headphone Mux\", \"HP Left Mix\",\t\t\"HPL Mix\"},\n\t{\"Left Headphone Mux\", \"Vmid\",\t\t\t\"Vmid\"},\n\n\t \n\t{\"Right Headphone Mux\", \"HP Right Mix\",\t\t\"HPR Mix\"},\n\t{\"Right Headphone Mux\", \"Vmid\",\t\t\t\"Vmid\"},\n\n\t \n\t{\"SpeakerOut Mux\", \"Vmid\",\t\t\t\"Vmid\"},\n\t{\"SpeakerOut Mux\", \"HPOut Mix\",\t\t\t\"HPOut Mix\"},\n\t{\"SpeakerOut Mux\", \"Speaker Mix\",\t\t\"Speaker Mix\"},\n\t{\"SpeakerOut Mux\", \"Mono Mix\",\t\t\t\"Mono Mix\"},\n\n\t \n\t{\"AuxOut Mux\", \"Vmid\",\t\t\t\t\"Vmid\"},\n\t{\"AuxOut Mux\", \"HPOut Mix\",\t\t\t\"HPOut Mix\"},\n\t{\"AuxOut Mux\", \"Speaker Mix\",\t\t\t\"Speaker Mix\"},\n\t{\"AuxOut Mux\", \"Mono Mix\",\t\t\t\"Mono Mix\"},\n\n\t \n\t{\"HPL\", NULL,\t\t\t\t\t\"Left Headphone\"},\n\t{\"Left Headphone\", NULL,\t\t\t\"Left Headphone Mux\"},\n\t{\"HPR\", NULL,\t\t\t\t\t\"Right Headphone\"},\n\t{\"Right Headphone\", NULL,\t\t\t\"Right Headphone Mux\"},\n\t{\"Aux Out\", NULL,\t\t\t\t\"AuxOut Mux\"},\n\n\t \n\t{\"Left LineIn\", NULL,\t\t\t\t\"LINEINL\"},\n\t{\"Right LineIn\", NULL,\t\t\t\t\"LINEINR\"},\n\t{\"Phone\", NULL,\t\t\t\t\"PHONEP\"},\n\t{\"MIC1 Pre Amp\", NULL,\t\t\t\t\"MIC1\"},\n\t{\"MIC2 Pre Amp\", NULL,\t\t\t\t\"MIC2\"},\n\t{\"MIC1 PGA\", NULL,\t\t\t\t\"MIC1 Pre Amp\"},\n\t{\"MIC2 PGA\", NULL,\t\t\t\t\"MIC2 Pre Amp\"},\n\n\t \n\t{\"Left ADC\", NULL,\t\t\t\t\"Left Capture Mix\"},\n\t{\"DMICL Mix\", \"DMICL2ADC Capture Switch\", \"DMICDAT\"},\n\t{\"Left ADC\", NULL,\t\t\t\t\"DMICL Mix\"},\n\t{\"ADCLR\", NULL,\t\t\t\t\t\"Left ADC\"},\n\n\t \n\t{\"Right ADC\", NULL, \"Right Capture Mix\"},\n\t{\"DMICR Mix\", \"DMICR2ADC Capture Switch\", \"DMICDAT\"},\n\t{\"Right ADC\", NULL, \"DMICR Mix\"},\n\t{\"ADCR Mux\", \"Stereo ADC\", \"Right ADC\"},\n\t{\"ADCR Mux\", \"Voice ADC\", \"Right ADC\"},\n\t{\"ADCLR\", NULL, \"ADCR Mux\"},\n\t{\"VAIFTX\", NULL, \"ADCR Mux\"},\n\n\t \n\t{\"I2SOut Mux\", \"ADC LR\", \"ADCLR\"},\n\t{\"I2SOut Mux\", \"Voice Stereo Digital\", \"VAIFRX\"},\n\t{\"AIFTXL\", NULL, \"I2SOut Mux\"},\n\t{\"AIFTXR\", NULL, \"I2SOut Mux\"},\n\n\t \n\t{\"Voice DAC\", NULL, \"VAIFRX\"},\n\t{\"Voice Mix\", NULL, \"Voice DAC\"},\n\n\t \n\t{\"SpeakerOut N Mux\", \"RN/-R\",\t\t\t\"Left Speaker\"},\n\t{\"SpeakerOut N Mux\", \"RP/+R\",\t\t\t\"Left Speaker\"},\n\t{\"SpeakerOut N Mux\", \"LN/-R\",\t\t\t\"Left Speaker\"},\n\t{\"SpeakerOut N Mux\", \"Mute\",\t\t\t\"Vmid\"},\n\n\t{\"SpeakerOut N Mux\", \"RN/-R\",\t\t\t\"Right Speaker\"},\n\t{\"SpeakerOut N Mux\", \"RP/+R\",\t\t\t\"Right Speaker\"},\n\t{\"SpeakerOut N Mux\", \"LN/-R\",\t\t\t\"Right Speaker\"},\n\t{\"SpeakerOut N Mux\", \"Mute\",\t\t\t\"Vmid\"},\n\n\t{\"AB Amp\", NULL,\t\t\t\t\"SpeakerOut Mux\"},\n\t{\"D Amp\", NULL,\t\t\t\t\t\"SpeakerOut Mux\"},\n\t{\"AB-D Amp Mux\", \"AB Amp\",\t\t\t\"AB Amp\"},\n\t{\"AB-D Amp Mux\", \"D Amp\",\t\t\t\"D Amp\"},\n\t{\"Left Speaker\", NULL,\t\t\t\t\"AB-D Amp Mux\"},\n\t{\"Right Speaker\", NULL,\t\t\t\t\"AB-D Amp Mux\"},\n\n\t{\"SPKOUT\", NULL,\t\t\t\t\"Left Speaker\"},\n\t{\"SPKOUT\", NULL,\t\t\t\t\"Right Speaker\"},\n\n\t{\"SPKOUTN\", NULL,\t\t\t\t\"SpeakerOut N Mux\"},\n\n};\n\n \nstruct _pll_div {\n\tu32 pll_in;\n\tu32 pll_out;\n\tu16 regvalue;\n};\n\n \n \nstatic const struct _pll_div codec_master_pll_div[] = {\n\n\t{  2048000,  8192000,\t0x0ea0},\n\t{  3686400,  8192000,\t0x4e27},\n\t{ 12000000,  8192000,\t0x456b},\n\t{ 13000000,  8192000,\t0x495f},\n\t{ 13100000,  8192000,\t0x0320},\n\t{  2048000,  11289600,\t0xf637},\n\t{  3686400,  11289600,\t0x2f22},\n\t{ 12000000,  11289600,\t0x3e2f},\n\t{ 13000000,  11289600,\t0x4d5b},\n\t{ 13100000,  11289600,\t0x363b},\n\t{  2048000,  16384000,\t0x1ea0},\n\t{  3686400,  16384000,\t0x9e27},\n\t{ 12000000,  16384000,\t0x452b},\n\t{ 13000000,  16384000,\t0x542f},\n\t{ 13100000,  16384000,\t0x03a0},\n\t{  2048000,  16934400,\t0xe625},\n\t{  3686400,  16934400,\t0x9126},\n\t{ 12000000,  16934400,\t0x4d2c},\n\t{ 13000000,  16934400,\t0x742f},\n\t{ 13100000,  16934400,\t0x3c27},\n\t{  2048000,  22579200,\t0x2aa0},\n\t{  3686400,  22579200,\t0x2f20},\n\t{ 12000000,  22579200,\t0x7e2f},\n\t{ 13000000,  22579200,\t0x742f},\n\t{ 13100000,  22579200,\t0x3c27},\n\t{  2048000,  24576000,\t0x2ea0},\n\t{  3686400,  24576000,\t0xee27},\n\t{ 12000000,  24576000,\t0x2915},\n\t{ 13000000,  24576000,\t0x772e},\n\t{ 13100000,  24576000,\t0x0d20},\n};\n\n \n\nstatic const struct _pll_div codec_slave_pll_div[] = {\n\n\t{  1024000,  16384000,  0x3ea0},\n\t{  1411200,  22579200,\t0x3ea0},\n\t{  1536000,  24576000,\t0x3ea0},\n\t{  2048000,  16384000,  0x1ea0},\n\t{  2822400,  22579200,\t0x1ea0},\n\t{  3072000,  24576000,\t0x1ea0},\n\n};\n\nstatic int alc5632_set_dai_pll(struct snd_soc_dai *codec_dai, int pll_id,\n\t\tint source, unsigned int freq_in, unsigned int freq_out)\n{\n\tint i;\n\tstruct snd_soc_component *component = codec_dai->component;\n\tint gbl_clk = 0, pll_div = 0;\n\tu16 reg;\n\n\tif (pll_id < ALC5632_PLL_FR_MCLK || pll_id > ALC5632_PLL_FR_VBCLK)\n\t\treturn -EINVAL;\n\n\t \n\tsnd_soc_component_update_bits(component, ALC5632_PWR_MANAG_ADD2,\n\t\t\t\tALC5632_PWR_ADD2_PLL1,\n\t\t\t\t0);\n\tsnd_soc_component_update_bits(component, ALC5632_PWR_MANAG_ADD2,\n\t\t\t\tALC5632_PWR_ADD2_PLL2,\n\t\t\t\t0);\n\n\t \n\treg = snd_soc_component_read(component, ALC5632_DAI_CONTROL);\n\tif (reg & ALC5632_DAI_SDP_SLAVE_MODE)\n\t\treturn 0;\n\n\tif (!freq_in || !freq_out)\n\t\treturn 0;\n\n\tswitch (pll_id) {\n\tcase ALC5632_PLL_FR_MCLK:\n\t\tfor (i = 0; i < ARRAY_SIZE(codec_master_pll_div); i++) {\n\t\t\tif (codec_master_pll_div[i].pll_in == freq_in\n\t\t\t   && codec_master_pll_div[i].pll_out == freq_out) {\n\t\t\t\t \n\t\t\t\tpll_div  = codec_master_pll_div[i].regvalue;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tbreak;\n\tcase ALC5632_PLL_FR_BCLK:\n\t\tfor (i = 0; i < ARRAY_SIZE(codec_slave_pll_div); i++) {\n\t\t\tif (codec_slave_pll_div[i].pll_in == freq_in\n\t\t\t   && codec_slave_pll_div[i].pll_out == freq_out) {\n\t\t\t\t \n\t\t\t\tgbl_clk = ALC5632_PLL_FR_BCLK;\n\t\t\t\tpll_div = codec_slave_pll_div[i].regvalue;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tbreak;\n\tcase ALC5632_PLL_FR_VBCLK:\n\t\tfor (i = 0; i < ARRAY_SIZE(codec_slave_pll_div); i++) {\n\t\t\tif (codec_slave_pll_div[i].pll_in == freq_in\n\t\t\t   && codec_slave_pll_div[i].pll_out == freq_out) {\n\t\t\t\t \n\t\t\t\tgbl_clk = ALC5632_PLL_FR_VBCLK;\n\t\t\t\tpll_div = codec_slave_pll_div[i].regvalue;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tif (!pll_div)\n\t\treturn -EINVAL;\n\n\t \n\tsnd_soc_component_write(component, ALC5632_GPCR2, gbl_clk);\n\t \n\tsnd_soc_component_write(component, ALC5632_PLL1_CTRL, pll_div);\n\t \n\tsnd_soc_component_update_bits(component, ALC5632_PWR_MANAG_ADD2,\n\t\t\t\tALC5632_PWR_ADD2_PLL1,\n\t\t\t\tALC5632_PWR_ADD2_PLL1);\n\t \n\tsnd_soc_component_update_bits(component, ALC5632_PWR_MANAG_ADD2,\n\t\t\t\tALC5632_PWR_ADD2_PLL2,\n\t\t\t\tALC5632_PWR_ADD2_PLL2);\n\t \n\tsnd_soc_component_update_bits(component, ALC5632_GPCR1,\n\t\t\tALC5632_GPCR1_CLK_SYS_SRC_SEL_PLL1,\n\t\t\tALC5632_GPCR1_CLK_SYS_SRC_SEL_PLL1);\n\n\treturn 0;\n}\n\nstruct _coeff_div {\n\tu16 fs;\n\tu16 regvalue;\n};\n\n \n \nstatic const struct _coeff_div coeff_div[] = {\n\t{512*1, 0x3075},\n};\n\nstatic int get_coeff(struct snd_soc_component *component, int rate)\n{\n\tstruct alc5632_priv *alc5632 = snd_soc_component_get_drvdata(component);\n\tint i;\n\n\tfor (i = 0; i < ARRAY_SIZE(coeff_div); i++) {\n\t\tif (coeff_div[i].fs * rate == alc5632->sysclk)\n\t\t\treturn i;\n\t}\n\treturn -EINVAL;\n}\n\n \nstatic int alc5632_set_dai_sysclk(struct snd_soc_dai *codec_dai,\n\t\tint clk_id, unsigned int freq, int dir)\n{\n\tstruct snd_soc_component *component = codec_dai->component;\n\tstruct alc5632_priv *alc5632 = snd_soc_component_get_drvdata(component);\n\n\tswitch (freq) {\n\tcase  4096000:\n\tcase  8192000:\n\tcase 11289600:\n\tcase 12288000:\n\tcase 16384000:\n\tcase 16934400:\n\tcase 18432000:\n\tcase 22579200:\n\tcase 24576000:\n\t\talc5632->sysclk = freq;\n\t\treturn 0;\n\t}\n\treturn -EINVAL;\n}\n\nstatic int alc5632_set_dai_fmt(struct snd_soc_dai *codec_dai,\n\t\tunsigned int fmt)\n{\n\tstruct snd_soc_component *component = codec_dai->component;\n\tu16 iface = 0;\n\n\t \n\tswitch (fmt & SND_SOC_DAIFMT_CLOCK_PROVIDER_MASK) {\n\tcase SND_SOC_DAIFMT_CBP_CFP:\n\t\tiface = ALC5632_DAI_SDP_MASTER_MODE;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_CBC_CFC:\n\t\tiface = ALC5632_DAI_SDP_SLAVE_MODE;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\t \n\tswitch (fmt & SND_SOC_DAIFMT_FORMAT_MASK) {\n\tcase SND_SOC_DAIFMT_I2S:\n\t\tiface |= ALC5632_DAI_I2S_DF_I2S;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_LEFT_J:\n\t\tiface |= ALC5632_DAI_I2S_DF_LEFT;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_DSP_A:\n\t\tiface |= ALC5632_DAI_I2S_DF_PCM_A;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_DSP_B:\n\t\tiface |= ALC5632_DAI_I2S_DF_PCM_B;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\t \n\tswitch (fmt & SND_SOC_DAIFMT_INV_MASK) {\n\tcase SND_SOC_DAIFMT_NB_NF:\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_IB_IF:\n\t\tiface |= ALC5632_DAI_MAIN_I2S_BCLK_POL_CTRL;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_IB_NF:\n\t\tiface |= ALC5632_DAI_MAIN_I2S_BCLK_POL_CTRL;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_NB_IF:\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\treturn snd_soc_component_write(component, ALC5632_DAI_CONTROL, iface);\n}\n\nstatic int alc5632_pcm_hw_params(struct snd_pcm_substream *substream,\n\t\tstruct snd_pcm_hw_params *params, struct snd_soc_dai *dai)\n{\n\tstruct snd_soc_component *component = dai->component;\n\tint coeff, rate;\n\tu16 iface;\n\n\tiface = snd_soc_component_read(component, ALC5632_DAI_CONTROL);\n\tiface &= ~ALC5632_DAI_I2S_DL_MASK;\n\n\t \n\tswitch (params_width(params)) {\n\tcase 16:\n\t\tiface |= ALC5632_DAI_I2S_DL_16;\n\t\tbreak;\n\tcase 20:\n\t\tiface |= ALC5632_DAI_I2S_DL_20;\n\t\tbreak;\n\tcase 24:\n\t\tiface |= ALC5632_DAI_I2S_DL_24;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\t \n\tsnd_soc_component_write(component, ALC5632_DAI_CONTROL, iface);\n\trate = params_rate(params);\n\tcoeff = get_coeff(component, rate);\n\tif (coeff < 0)\n\t\treturn -EINVAL;\n\n\tcoeff = coeff_div[coeff].regvalue;\n\tsnd_soc_component_write(component, ALC5632_DAC_CLK_CTRL1, coeff);\n\n\treturn 0;\n}\n\nstatic int alc5632_mute(struct snd_soc_dai *dai, int mute, int direction)\n{\n\tstruct snd_soc_component *component = dai->component;\n\tu16 hp_mute = ALC5632_MISC_HP_DEPOP_MUTE_L\n\t\t\t\t\t\t|ALC5632_MISC_HP_DEPOP_MUTE_R;\n\tu16 mute_reg = snd_soc_component_read(component, ALC5632_MISC_CTRL) & ~hp_mute;\n\n\tif (mute)\n\t\tmute_reg |= hp_mute;\n\n\treturn snd_soc_component_write(component, ALC5632_MISC_CTRL, mute_reg);\n}\n\n#define ALC5632_ADD2_POWER_EN (ALC5632_PWR_ADD2_VREF)\n\n#define ALC5632_ADD3_POWER_EN (ALC5632_PWR_ADD3_MIC1_BOOST_AD)\n\n#define ALC5632_ADD1_POWER_EN \\\n\t\t(ALC5632_PWR_ADD1_DAC_REF \\\n\t\t| ALC5632_PWR_ADD1_SOFTGEN_EN \\\n\t\t| ALC5632_PWR_ADD1_HP_OUT_AMP \\\n\t\t| ALC5632_PWR_ADD1_HP_OUT_ENH_AMP \\\n\t\t| ALC5632_PWR_ADD1_MAIN_BIAS)\n\nstatic void enable_power_depop(struct snd_soc_component *component)\n{\n\tsnd_soc_component_update_bits(component, ALC5632_PWR_MANAG_ADD1,\n\t\t\t\tALC5632_PWR_ADD1_SOFTGEN_EN,\n\t\t\t\tALC5632_PWR_ADD1_SOFTGEN_EN);\n\n\tsnd_soc_component_update_bits(component, ALC5632_PWR_MANAG_ADD3,\n\t\t\t\tALC5632_ADD3_POWER_EN,\n\t\t\t\tALC5632_ADD3_POWER_EN);\n\n\tsnd_soc_component_update_bits(component, ALC5632_MISC_CTRL,\n\t\t\t\tALC5632_MISC_HP_DEPOP_MODE2_EN,\n\t\t\t\tALC5632_MISC_HP_DEPOP_MODE2_EN);\n\n\t \n\t \n\tsnd_soc_component_update_bits(component, ALC5632_PWR_DOWN_CTRL_STATUS,\n\t\t\t\tALC5632_PWR_DOWN_CTRL_STATUS_MASK,\n\t\t\t\t0);\n\n\tmsleep(500);\n\n\tsnd_soc_component_update_bits(component, ALC5632_PWR_MANAG_ADD2,\n\t\t\t\tALC5632_ADD2_POWER_EN,\n\t\t\t\tALC5632_ADD2_POWER_EN);\n\n\tsnd_soc_component_update_bits(component, ALC5632_PWR_MANAG_ADD1,\n\t\t\t\tALC5632_ADD1_POWER_EN,\n\t\t\t\tALC5632_ADD1_POWER_EN);\n\n\t \n\tsnd_soc_component_update_bits(component, ALC5632_MISC_CTRL,\n\t\t\t\tALC5632_MISC_HP_DEPOP_MODE2_EN,\n\t\t\t\t0);\n\n}\n\nstatic int alc5632_set_bias_level(struct snd_soc_component *component,\n\t\t\t\t      enum snd_soc_bias_level level)\n{\n\tswitch (level) {\n\tcase SND_SOC_BIAS_ON:\n\t\tenable_power_depop(component);\n\t\tbreak;\n\tcase SND_SOC_BIAS_PREPARE:\n\t\tbreak;\n\tcase SND_SOC_BIAS_STANDBY:\n\t\t \n\t\tsnd_soc_component_update_bits(component, ALC5632_PWR_MANAG_ADD1,\n\t\t\t\tALC5632_PWR_MANAG_ADD1_MASK,\n\t\t\t\tALC5632_PWR_ADD1_MAIN_BIAS);\n\t\tsnd_soc_component_update_bits(component, ALC5632_PWR_MANAG_ADD2,\n\t\t\t\tALC5632_PWR_MANAG_ADD2_MASK,\n\t\t\t\tALC5632_PWR_ADD2_VREF);\n\t\t \n\t\tsnd_soc_component_update_bits(component, ALC5632_PWR_DOWN_CTRL_STATUS,\n\t\t\t\tALC5632_PWR_DOWN_CTRL_STATUS_MASK,\n\t\t\t\t0xffff ^ (ALC5632_PWR_VREF_PR3\n\t\t\t\t| ALC5632_PWR_VREF_PR2));\n\t\tbreak;\n\tcase SND_SOC_BIAS_OFF:\n\t\t \n\t\tsnd_soc_component_update_bits(component, ALC5632_PWR_MANAG_ADD2,\n\t\t\t\tALC5632_PWR_MANAG_ADD2_MASK, 0);\n\t\tsnd_soc_component_update_bits(component, ALC5632_PWR_MANAG_ADD3,\n\t\t\t\tALC5632_PWR_MANAG_ADD3_MASK, 0);\n\t\tsnd_soc_component_update_bits(component, ALC5632_PWR_MANAG_ADD1,\n\t\t\t\tALC5632_PWR_MANAG_ADD1_MASK, 0);\n\t\tbreak;\n\t}\n\treturn 0;\n}\n\n#define ALC5632_FORMATS\t(SNDRV_PCM_FMTBIT_S16_LE \\\n\t\t\t| SNDRV_PCM_FMTBIT_S24_LE \\\n\t\t\t| SNDRV_PCM_FMTBIT_S32_LE)\n\nstatic const struct snd_soc_dai_ops alc5632_dai_ops = {\n\t\t.hw_params = alc5632_pcm_hw_params,\n\t\t.mute_stream = alc5632_mute,\n\t\t.set_fmt = alc5632_set_dai_fmt,\n\t\t.set_sysclk = alc5632_set_dai_sysclk,\n\t\t.set_pll = alc5632_set_dai_pll,\n\t\t.no_capture_mute = 1,\n};\n\nstatic struct snd_soc_dai_driver alc5632_dai = {\n\t.name = \"alc5632-hifi\",\n\t.playback = {\n\t\t.stream_name = \"HiFi Playback\",\n\t\t.channels_min = 1,\n\t\t.channels_max = 2,\n\t\t.rate_min =\t8000,\n\t\t.rate_max =\t48000,\n\t\t.rates = SNDRV_PCM_RATE_8000_48000,\n\t\t.formats = ALC5632_FORMATS,},\n\t.capture = {\n\t\t.stream_name = \"HiFi Capture\",\n\t\t.channels_min = 1,\n\t\t.channels_max = 2,\n\t\t.rate_min =\t8000,\n\t\t.rate_max =\t48000,\n\t\t.rates = SNDRV_PCM_RATE_8000_48000,\n\t\t.formats = ALC5632_FORMATS,},\n\n\t.ops = &alc5632_dai_ops,\n\t.symmetric_rate = 1,\n};\n\n#ifdef CONFIG_PM\nstatic int alc5632_resume(struct snd_soc_component *component)\n{\n\tstruct alc5632_priv *alc5632 = snd_soc_component_get_drvdata(component);\n\n\tregcache_sync(alc5632->regmap);\n\n\treturn 0;\n}\n#else\n#define\talc5632_resume\tNULL\n#endif\n\nstatic int alc5632_probe(struct snd_soc_component *component)\n{\n\tstruct alc5632_priv *alc5632 = snd_soc_component_get_drvdata(component);\n\n\tswitch (alc5632->id) {\n\tcase 0x5c:\n\t\tsnd_soc_add_component_controls(component, alc5632_vol_snd_controls,\n\t\t\tARRAY_SIZE(alc5632_vol_snd_controls));\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\treturn 0;\n}\n\nstatic const struct snd_soc_component_driver soc_component_device_alc5632 = {\n\t.probe\t\t\t= alc5632_probe,\n\t.resume\t\t\t= alc5632_resume,\n\t.set_bias_level\t\t= alc5632_set_bias_level,\n\t.controls\t\t= alc5632_snd_controls,\n\t.num_controls\t\t= ARRAY_SIZE(alc5632_snd_controls),\n\t.dapm_widgets\t\t= alc5632_dapm_widgets,\n\t.num_dapm_widgets\t= ARRAY_SIZE(alc5632_dapm_widgets),\n\t.dapm_routes\t\t= alc5632_dapm_routes,\n\t.num_dapm_routes\t= ARRAY_SIZE(alc5632_dapm_routes),\n\t.suspend_bias_off\t= 1,\n\t.idle_bias_on\t\t= 1,\n\t.use_pmdown_time\t= 1,\n\t.endianness\t\t= 1,\n};\n\nstatic const struct regmap_config alc5632_regmap = {\n\t.reg_bits = 8,\n\t.val_bits = 16,\n\n\t.max_register = ALC5632_MAX_REGISTER,\n\t.reg_defaults = alc5632_reg_defaults,\n\t.num_reg_defaults = ARRAY_SIZE(alc5632_reg_defaults),\n\t.volatile_reg = alc5632_volatile_register,\n\t.cache_type = REGCACHE_RBTREE,\n};\n\nstatic const struct i2c_device_id alc5632_i2c_table[] = {\n\t{\"alc5632\", 0x5c},\n\t{}\n};\nMODULE_DEVICE_TABLE(i2c, alc5632_i2c_table);\n\n \nstatic int alc5632_i2c_probe(struct i2c_client *client)\n{\n\tstruct alc5632_priv *alc5632;\n\tint ret, ret1, ret2;\n\tunsigned int vid1, vid2;\n\tconst struct i2c_device_id *id;\n\n\talc5632 = devm_kzalloc(&client->dev,\n\t\t\t sizeof(struct alc5632_priv), GFP_KERNEL);\n\tif (alc5632 == NULL)\n\t\treturn -ENOMEM;\n\n\ti2c_set_clientdata(client, alc5632);\n\n\talc5632->regmap = devm_regmap_init_i2c(client, &alc5632_regmap);\n\tif (IS_ERR(alc5632->regmap)) {\n\t\tret = PTR_ERR(alc5632->regmap);\n\t\tdev_err(&client->dev, \"regmap_init() failed: %d\\n\", ret);\n\t\treturn ret;\n\t}\n\n\tret1 = regmap_read(alc5632->regmap, ALC5632_VENDOR_ID1, &vid1);\n\tret2 = regmap_read(alc5632->regmap, ALC5632_VENDOR_ID2, &vid2);\n\tif (ret1 != 0 || ret2 != 0) {\n\t\tdev_err(&client->dev,\n\t\t\"Failed to read chip ID: ret1=%d, ret2=%d\\n\", ret1, ret2);\n\t\treturn -EIO;\n\t}\n\n\tvid2 >>= 8;\n\n\tid = i2c_match_id(alc5632_i2c_table, client);\n\n\tif ((vid1 != 0x10EC) || (vid2 != id->driver_data)) {\n\t\tdev_err(&client->dev,\n\t\t\"Device is not a ALC5632: VID1=0x%x, VID2=0x%x\\n\", vid1, vid2);\n\t\treturn -EINVAL;\n\t}\n\n\tret = alc5632_reset(alc5632->regmap);\n\tif (ret < 0) {\n\t\tdev_err(&client->dev, \"Failed to issue reset\\n\");\n\t\treturn ret;\n\t}\n\n\talc5632->id = vid2;\n\tswitch (alc5632->id) {\n\tcase 0x5c:\n\t\talc5632_dai.name = \"alc5632-hifi\";\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tret = devm_snd_soc_register_component(&client->dev,\n\t\t&soc_component_device_alc5632, &alc5632_dai, 1);\n\n\tif (ret < 0) {\n\t\tdev_err(&client->dev, \"Failed to register component: %d\\n\", ret);\n\t\treturn ret;\n\t}\n\n\treturn ret;\n}\n\n#ifdef CONFIG_OF\nstatic const struct of_device_id alc5632_of_match[] = {\n\t{ .compatible = \"realtek,alc5632\", },\n\t{ }\n};\nMODULE_DEVICE_TABLE(of, alc5632_of_match);\n#endif\n\n \nstatic struct i2c_driver alc5632_i2c_driver = {\n\t.driver = {\n\t\t.name = \"alc5632\",\n\t\t.of_match_table = of_match_ptr(alc5632_of_match),\n\t},\n\t.probe = alc5632_i2c_probe,\n\t.id_table = alc5632_i2c_table,\n};\n\nmodule_i2c_driver(alc5632_i2c_driver);\n\nMODULE_DESCRIPTION(\"ASoC ALC5632 driver\");\nMODULE_AUTHOR(\"Leon Romanovsky <leon@leon.nu>\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}