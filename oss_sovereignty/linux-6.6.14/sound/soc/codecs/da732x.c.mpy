{
  "module_name": "da732x.c",
  "hash_id": "1ead4a2a8586c8702532a0c9e1e396072b0c027faaecada5ff1391c7fa0ccc4c",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/codecs/da732x.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/moduleparam.h>\n#include <linux/init.h>\n#include <linux/delay.h>\n#include <linux/pm.h>\n#include <linux/i2c.h>\n#include <linux/regmap.h>\n#include <linux/platform_device.h>\n#include <linux/slab.h>\n#include <linux/sysfs.h>\n#include <sound/core.h>\n#include <sound/pcm.h>\n#include <sound/pcm_params.h>\n#include <sound/soc.h>\n#include <sound/soc-dapm.h>\n#include <sound/initval.h>\n#include <sound/tlv.h>\n#include <asm/div64.h>\n\n#include \"da732x.h\"\n#include \"da732x_reg.h\"\n\n\nstruct da732x_priv {\n\tstruct regmap *regmap;\n\n\tunsigned int sysclk;\n\tbool pll_en;\n};\n\n \nstatic const struct reg_default da732x_reg_cache[] = {\n\t{ DA732X_REG_REF1\t\t, 0x02 },\n\t{ DA732X_REG_BIAS_EN\t\t, 0x80 },\n\t{ DA732X_REG_BIAS1\t\t, 0x00 },\n\t{ DA732X_REG_BIAS2\t\t, 0x00 },\n\t{ DA732X_REG_BIAS3\t\t, 0x00 },\n\t{ DA732X_REG_BIAS4\t\t, 0x00 },\n\t{ DA732X_REG_MICBIAS2\t\t, 0x00 },\n\t{ DA732X_REG_MICBIAS1\t\t, 0x00 },\n\t{ DA732X_REG_MICDET\t\t, 0x00 },\n\t{ DA732X_REG_MIC1_PRE\t\t, 0x01 },\n\t{ DA732X_REG_MIC1\t\t, 0x40 },\n\t{ DA732X_REG_MIC2_PRE\t\t, 0x01 },\n\t{ DA732X_REG_MIC2\t\t, 0x40 },\n\t{ DA732X_REG_AUX1L\t\t, 0x75 },\n\t{ DA732X_REG_AUX1R\t\t, 0x75 },\n\t{ DA732X_REG_MIC3_PRE\t\t, 0x01 },\n\t{ DA732X_REG_MIC3\t\t, 0x40 },\n\t{ DA732X_REG_INP_PINBIAS\t, 0x00 },\n\t{ DA732X_REG_INP_ZC_EN\t\t, 0x00 },\n\t{ DA732X_REG_INP_MUX\t\t, 0x50 },\n\t{ DA732X_REG_HP_DET\t\t, 0x00 },\n\t{ DA732X_REG_HPL_DAC_OFFSET\t, 0x00 },\n\t{ DA732X_REG_HPL_DAC_OFF_CNTL\t, 0x00 },\n\t{ DA732X_REG_HPL_OUT_OFFSET\t, 0x00 },\n\t{ DA732X_REG_HPL\t\t, 0x40 },\n\t{ DA732X_REG_HPL_VOL\t\t, 0x0F },\n\t{ DA732X_REG_HPR_DAC_OFFSET\t, 0x00 },\n\t{ DA732X_REG_HPR_DAC_OFF_CNTL\t, 0x00 },\n\t{ DA732X_REG_HPR_OUT_OFFSET\t, 0x00 },\n\t{ DA732X_REG_HPR\t\t, 0x40 },\n\t{ DA732X_REG_HPR_VOL\t\t, 0x0F },\n\t{ DA732X_REG_LIN2\t\t, 0x4F },\n\t{ DA732X_REG_LIN3\t\t, 0x4F },\n\t{ DA732X_REG_LIN4\t\t, 0x4F },\n\t{ DA732X_REG_OUT_ZC_EN\t\t, 0x00 },\n\t{ DA732X_REG_HP_LIN1_GNDSEL\t, 0x00 },\n\t{ DA732X_REG_CP_HP1\t\t, 0x0C },\n\t{ DA732X_REG_CP_HP2\t\t, 0x03 },\n\t{ DA732X_REG_CP_CTRL1\t\t, 0x00 },\n\t{ DA732X_REG_CP_CTRL2\t\t, 0x99 },\n\t{ DA732X_REG_CP_CTRL3\t\t, 0x25 },\n\t{ DA732X_REG_CP_LEVEL_MASK\t, 0x3F },\n\t{ DA732X_REG_CP_DET\t\t, 0x00 },\n\t{ DA732X_REG_CP_STATUS\t\t, 0x00 },\n\t{ DA732X_REG_CP_THRESH1\t\t, 0x00 },\n\t{ DA732X_REG_CP_THRESH2\t\t, 0x00 },\n\t{ DA732X_REG_CP_THRESH3\t\t, 0x00 },\n\t{ DA732X_REG_CP_THRESH4\t\t, 0x00 },\n\t{ DA732X_REG_CP_THRESH5\t\t, 0x00 },\n\t{ DA732X_REG_CP_THRESH6\t\t, 0x00 },\n\t{ DA732X_REG_CP_THRESH7\t\t, 0x00 },\n\t{ DA732X_REG_CP_THRESH8\t\t, 0x00 },\n\t{ DA732X_REG_PLL_DIV_LO\t\t, 0x00 },\n\t{ DA732X_REG_PLL_DIV_MID\t, 0x00 },\n\t{ DA732X_REG_PLL_DIV_HI\t\t, 0x00 },\n\t{ DA732X_REG_PLL_CTRL\t\t, 0x02 },\n\t{ DA732X_REG_CLK_CTRL\t\t, 0xaa },\n\t{ DA732X_REG_CLK_DSP\t\t, 0x07 },\n\t{ DA732X_REG_CLK_EN1\t\t, 0x00 },\n\t{ DA732X_REG_CLK_EN2\t\t, 0x00 },\n\t{ DA732X_REG_CLK_EN3\t\t, 0x00 },\n\t{ DA732X_REG_CLK_EN4\t\t, 0x00 },\n\t{ DA732X_REG_CLK_EN5\t\t, 0x00 },\n\t{ DA732X_REG_AIF_MCLK\t\t, 0x00 },\n\t{ DA732X_REG_AIFA1\t\t, 0x02 },\n\t{ DA732X_REG_AIFA2\t\t, 0x00 },\n\t{ DA732X_REG_AIFA3\t\t, 0x08 },\n\t{ DA732X_REG_AIFB1\t\t, 0x02 },\n\t{ DA732X_REG_AIFB2\t\t, 0x00 },\n\t{ DA732X_REG_AIFB3\t\t, 0x08 },\n\t{ DA732X_REG_PC_CTRL\t\t, 0xC0 },\n\t{ DA732X_REG_DATA_ROUTE\t\t, 0x00 },\n\t{ DA732X_REG_DSP_CTRL\t\t, 0x00 },\n\t{ DA732X_REG_CIF_CTRL2\t\t, 0x00 },\n\t{ DA732X_REG_HANDSHAKE\t\t, 0x00 },\n\t{ DA732X_REG_SPARE1_OUT\t\t, 0x00 },\n\t{ DA732X_REG_SPARE2_OUT\t\t, 0x00 },\n\t{ DA732X_REG_SPARE1_IN\t\t, 0x00 },\n\t{ DA732X_REG_ADC1_PD\t\t, 0x00 },\n\t{ DA732X_REG_ADC1_HPF\t\t, 0x00 },\n\t{ DA732X_REG_ADC1_SEL\t\t, 0x00 },\n\t{ DA732X_REG_ADC1_EQ12\t\t, 0x00 },\n\t{ DA732X_REG_ADC1_EQ34\t\t, 0x00 },\n\t{ DA732X_REG_ADC1_EQ5\t\t, 0x00 },\n\t{ DA732X_REG_ADC2_PD\t\t, 0x00 },\n\t{ DA732X_REG_ADC2_HPF\t\t, 0x00 },\n\t{ DA732X_REG_ADC2_SEL\t\t, 0x00 },\n\t{ DA732X_REG_ADC2_EQ12\t\t, 0x00 },\n\t{ DA732X_REG_ADC2_EQ34\t\t, 0x00 },\n\t{ DA732X_REG_ADC2_EQ5\t\t, 0x00 },\n\t{ DA732X_REG_DAC1_HPF\t\t, 0x00 },\n\t{ DA732X_REG_DAC1_L_VOL\t\t, 0x00 },\n\t{ DA732X_REG_DAC1_R_VOL\t\t, 0x00 },\n\t{ DA732X_REG_DAC1_SEL\t\t, 0x00 },\n\t{ DA732X_REG_DAC1_SOFTMUTE\t, 0x00 },\n\t{ DA732X_REG_DAC1_EQ12\t\t, 0x00 },\n\t{ DA732X_REG_DAC1_EQ34\t\t, 0x00 },\n\t{ DA732X_REG_DAC1_EQ5\t\t, 0x00 },\n\t{ DA732X_REG_DAC2_HPF\t\t, 0x00 },\n\t{ DA732X_REG_DAC2_L_VOL\t\t, 0x00 },\n\t{ DA732X_REG_DAC2_R_VOL\t\t, 0x00 },\n\t{ DA732X_REG_DAC2_SEL\t\t, 0x00 },\n\t{ DA732X_REG_DAC2_SOFTMUTE\t, 0x00 },\n\t{ DA732X_REG_DAC2_EQ12\t\t, 0x00 },\n\t{ DA732X_REG_DAC2_EQ34\t\t, 0x00 },\n\t{ DA732X_REG_DAC2_EQ5\t\t, 0x00 },\n\t{ DA732X_REG_DAC3_HPF\t\t, 0x00 },\n\t{ DA732X_REG_DAC3_VOL\t\t, 0x00 },\n\t{ DA732X_REG_DAC3_SEL\t\t, 0x00 },\n\t{ DA732X_REG_DAC3_SOFTMUTE\t, 0x00 },\n\t{ DA732X_REG_DAC3_EQ12\t\t, 0x00 },\n\t{ DA732X_REG_DAC3_EQ34\t\t, 0x00 },\n\t{ DA732X_REG_DAC3_EQ5\t\t, 0x00 },\n\t{ DA732X_REG_BIQ_BYP\t\t, 0x00 },\n\t{ DA732X_REG_DMA_CMD\t\t, 0x00 },\n\t{ DA732X_REG_DMA_ADDR0\t\t, 0x00 },\n\t{ DA732X_REG_DMA_ADDR1\t\t, 0x00 },\n\t{ DA732X_REG_DMA_DATA0\t\t, 0x00 },\n\t{ DA732X_REG_DMA_DATA1\t\t, 0x00 },\n\t{ DA732X_REG_DMA_DATA2\t\t, 0x00 },\n\t{ DA732X_REG_DMA_DATA3\t\t, 0x00 },\n\t{ DA732X_REG_UNLOCK\t\t, 0x00 },\n};\n\nstatic inline int da732x_get_input_div(struct snd_soc_component *component, int sysclk)\n{\n\tint val;\n\n\tif (sysclk < DA732X_MCLK_10MHZ) {\n\t\tval = DA732X_MCLK_VAL_0_10MHZ;\n\t} else if ((sysclk >= DA732X_MCLK_10MHZ) &&\n\t    (sysclk < DA732X_MCLK_20MHZ)) {\n\t\tval = DA732X_MCLK_VAL_10_20MHZ;\n\t} else if ((sysclk >= DA732X_MCLK_20MHZ) &&\n\t    (sysclk < DA732X_MCLK_40MHZ)) {\n\t\tval = DA732X_MCLK_VAL_20_40MHZ;\n\t} else if ((sysclk >= DA732X_MCLK_40MHZ) &&\n\t    (sysclk <= DA732X_MCLK_54MHZ)) {\n\t\tval = DA732X_MCLK_VAL_40_54MHZ;\n\t} else {\n\t\treturn -EINVAL;\n\t}\n\n\tsnd_soc_component_write(component, DA732X_REG_PLL_CTRL, val);\n\n\treturn val;\n}\n\nstatic void da732x_set_charge_pump(struct snd_soc_component *component, int state)\n{\n\tswitch (state) {\n\tcase DA732X_ENABLE_CP:\n\t\tsnd_soc_component_write(component, DA732X_REG_CLK_EN2, DA732X_CP_CLK_EN);\n\t\tsnd_soc_component_write(component, DA732X_REG_CP_HP2, DA732X_HP_CP_EN |\n\t\t\t      DA732X_HP_CP_REG | DA732X_HP_CP_PULSESKIP);\n\t\tsnd_soc_component_write(component, DA732X_REG_CP_CTRL1, DA732X_CP_EN |\n\t\t\t      DA732X_CP_CTRL_CPVDD1);\n\t\tsnd_soc_component_write(component, DA732X_REG_CP_CTRL2,\n\t\t\t      DA732X_CP_MANAGE_MAGNITUDE | DA732X_CP_BOOST);\n\t\tsnd_soc_component_write(component, DA732X_REG_CP_CTRL3, DA732X_CP_1MHZ);\n\t\tbreak;\n\tcase DA732X_DISABLE_CP:\n\t\tsnd_soc_component_write(component, DA732X_REG_CLK_EN2, DA732X_CP_CLK_DIS);\n\t\tsnd_soc_component_write(component, DA732X_REG_CP_HP2, DA732X_HP_CP_DIS);\n\t\tsnd_soc_component_write(component, DA732X_REG_CP_CTRL1, DA723X_CP_DIS);\n\t\tbreak;\n\tdefault:\n\t\tpr_err(\"Wrong charge pump state\\n\");\n\t\tbreak;\n\t}\n}\n\nstatic const DECLARE_TLV_DB_SCALE(mic_boost_tlv, DA732X_MIC_PRE_VOL_DB_MIN,\n\t\t\t\t  DA732X_MIC_PRE_VOL_DB_INC, 0);\n\nstatic const DECLARE_TLV_DB_SCALE(mic_pga_tlv, DA732X_MIC_VOL_DB_MIN,\n\t\t\t\t  DA732X_MIC_VOL_DB_INC, 0);\n\nstatic const DECLARE_TLV_DB_SCALE(aux_pga_tlv, DA732X_AUX_VOL_DB_MIN,\n\t\t\t\t  DA732X_AUX_VOL_DB_INC, 0);\n\nstatic const DECLARE_TLV_DB_SCALE(hp_pga_tlv, DA732X_HP_VOL_DB_MIN,\n\t\t\t\t  DA732X_AUX_VOL_DB_INC, 0);\n\nstatic const DECLARE_TLV_DB_SCALE(lin2_pga_tlv, DA732X_LIN2_VOL_DB_MIN,\n\t\t\t\t  DA732X_LIN2_VOL_DB_INC, 0);\n\nstatic const DECLARE_TLV_DB_SCALE(lin3_pga_tlv, DA732X_LIN3_VOL_DB_MIN,\n\t\t\t\t  DA732X_LIN3_VOL_DB_INC, 0);\n\nstatic const DECLARE_TLV_DB_SCALE(lin4_pga_tlv, DA732X_LIN4_VOL_DB_MIN,\n\t\t\t\t  DA732X_LIN4_VOL_DB_INC, 0);\n\nstatic const DECLARE_TLV_DB_SCALE(adc_pga_tlv, DA732X_ADC_VOL_DB_MIN,\n\t\t\t\t  DA732X_ADC_VOL_DB_INC, 0);\n\nstatic const DECLARE_TLV_DB_SCALE(dac_pga_tlv, DA732X_DAC_VOL_DB_MIN,\n\t\t\t\t  DA732X_DAC_VOL_DB_INC, 0);\n\nstatic const DECLARE_TLV_DB_SCALE(eq_band_pga_tlv, DA732X_EQ_BAND_VOL_DB_MIN,\n\t\t\t\t  DA732X_EQ_BAND_VOL_DB_INC, 0);\n\nstatic const DECLARE_TLV_DB_SCALE(eq_overall_tlv, DA732X_EQ_OVERALL_VOL_DB_MIN,\n\t\t\t\t  DA732X_EQ_OVERALL_VOL_DB_INC, 0);\n\n \nstatic const char *da732x_hpf_mode[] = {\n\t\"Disable\", \"Music\", \"Voice\",\n};\n\nstatic const char *da732x_hpf_music[] = {\n\t\"1.8Hz\", \"3.75Hz\", \"7.5Hz\", \"15Hz\",\n};\n\nstatic const char *da732x_hpf_voice[] = {\n\t\"2.5Hz\", \"25Hz\", \"50Hz\", \"100Hz\",\n\t\"150Hz\", \"200Hz\", \"300Hz\", \"400Hz\"\n};\n\nstatic SOC_ENUM_SINGLE_DECL(da732x_dac1_hpf_mode_enum,\n\t\t\t    DA732X_REG_DAC1_HPF, DA732X_HPF_MODE_SHIFT,\n\t\t\t    da732x_hpf_mode);\n\nstatic SOC_ENUM_SINGLE_DECL(da732x_dac2_hpf_mode_enum,\n\t\t\t    DA732X_REG_DAC2_HPF, DA732X_HPF_MODE_SHIFT,\n\t\t\t    da732x_hpf_mode);\n\nstatic SOC_ENUM_SINGLE_DECL(da732x_dac3_hpf_mode_enum,\n\t\t\t    DA732X_REG_DAC3_HPF, DA732X_HPF_MODE_SHIFT,\n\t\t\t    da732x_hpf_mode);\n\nstatic SOC_ENUM_SINGLE_DECL(da732x_adc1_hpf_mode_enum,\n\t\t\t    DA732X_REG_ADC1_HPF, DA732X_HPF_MODE_SHIFT,\n\t\t\t    da732x_hpf_mode);\n\nstatic SOC_ENUM_SINGLE_DECL(da732x_adc2_hpf_mode_enum,\n\t\t\t    DA732X_REG_ADC2_HPF, DA732X_HPF_MODE_SHIFT,\n\t\t\t    da732x_hpf_mode);\n\nstatic SOC_ENUM_SINGLE_DECL(da732x_dac1_hp_filter_enum,\n\t\t\t    DA732X_REG_DAC1_HPF, DA732X_HPF_MUSIC_SHIFT,\n\t\t\t    da732x_hpf_music);\n\nstatic SOC_ENUM_SINGLE_DECL(da732x_dac2_hp_filter_enum,\n\t\t\t    DA732X_REG_DAC2_HPF, DA732X_HPF_MUSIC_SHIFT,\n\t\t\t    da732x_hpf_music);\n\nstatic SOC_ENUM_SINGLE_DECL(da732x_dac3_hp_filter_enum,\n\t\t\t    DA732X_REG_DAC3_HPF, DA732X_HPF_MUSIC_SHIFT,\n\t\t\t    da732x_hpf_music);\n\nstatic SOC_ENUM_SINGLE_DECL(da732x_adc1_hp_filter_enum,\n\t\t\t    DA732X_REG_ADC1_HPF, DA732X_HPF_MUSIC_SHIFT,\n\t\t\t    da732x_hpf_music);\n\nstatic SOC_ENUM_SINGLE_DECL(da732x_adc2_hp_filter_enum,\n\t\t\t    DA732X_REG_ADC2_HPF, DA732X_HPF_MUSIC_SHIFT,\n\t\t\t    da732x_hpf_music);\n\nstatic SOC_ENUM_SINGLE_DECL(da732x_dac1_voice_filter_enum,\n\t\t\t    DA732X_REG_DAC1_HPF, DA732X_HPF_VOICE_SHIFT,\n\t\t\t    da732x_hpf_voice);\n\nstatic SOC_ENUM_SINGLE_DECL(da732x_dac2_voice_filter_enum,\n\t\t\t    DA732X_REG_DAC2_HPF, DA732X_HPF_VOICE_SHIFT,\n\t\t\t    da732x_hpf_voice);\n\nstatic SOC_ENUM_SINGLE_DECL(da732x_dac3_voice_filter_enum,\n\t\t\t    DA732X_REG_DAC3_HPF, DA732X_HPF_VOICE_SHIFT,\n\t\t\t    da732x_hpf_voice);\n\nstatic SOC_ENUM_SINGLE_DECL(da732x_adc1_voice_filter_enum,\n\t\t\t    DA732X_REG_ADC1_HPF, DA732X_HPF_VOICE_SHIFT,\n\t\t\t    da732x_hpf_voice);\n\nstatic SOC_ENUM_SINGLE_DECL(da732x_adc2_voice_filter_enum,\n\t\t\t    DA732X_REG_ADC2_HPF, DA732X_HPF_VOICE_SHIFT,\n\t\t\t    da732x_hpf_voice);\n\nstatic int da732x_hpf_set(struct snd_kcontrol *kcontrol,\n\t\t\t  struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_soc_component *component = snd_soc_kcontrol_component(kcontrol);\n\tstruct soc_enum *enum_ctrl = (struct soc_enum *)kcontrol->private_value;\n\tunsigned int reg = enum_ctrl->reg;\n\tunsigned int sel = ucontrol->value.enumerated.item[0];\n\tunsigned int bits;\n\n\tswitch (sel) {\n\tcase DA732X_HPF_DISABLED:\n\t\tbits = DA732X_HPF_DIS;\n\t\tbreak;\n\tcase DA732X_HPF_VOICE:\n\t\tbits = DA732X_HPF_VOICE_EN;\n\t\tbreak;\n\tcase DA732X_HPF_MUSIC:\n\t\tbits = DA732X_HPF_MUSIC_EN;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tsnd_soc_component_update_bits(component, reg, DA732X_HPF_MASK, bits);\n\n\treturn 0;\n}\n\nstatic int da732x_hpf_get(struct snd_kcontrol *kcontrol,\n\t\t\t  struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_soc_component *component = snd_soc_kcontrol_component(kcontrol);\n\tstruct soc_enum *enum_ctrl = (struct soc_enum *)kcontrol->private_value;\n\tunsigned int reg = enum_ctrl->reg;\n\tint val;\n\n\tval = snd_soc_component_read(component, reg) & DA732X_HPF_MASK;\n\n\tswitch (val) {\n\tcase DA732X_HPF_VOICE_EN:\n\t\tucontrol->value.enumerated.item[0] = DA732X_HPF_VOICE;\n\t\tbreak;\n\tcase DA732X_HPF_MUSIC_EN:\n\t\tucontrol->value.enumerated.item[0] = DA732X_HPF_MUSIC;\n\t\tbreak;\n\tdefault:\n\t\tucontrol->value.enumerated.item[0] = DA732X_HPF_DISABLED;\n\t\tbreak;\n\t}\n\n\treturn 0;\n}\n\nstatic const struct snd_kcontrol_new da732x_snd_controls[] = {\n\t \n\tSOC_SINGLE_RANGE_TLV(\"MIC1 Boost Volume\", DA732X_REG_MIC1_PRE,\n\t\t\t     DA732X_MICBOOST_SHIFT, DA732X_MICBOOST_MIN,\n\t\t\t     DA732X_MICBOOST_MAX, 0, mic_boost_tlv),\n\tSOC_SINGLE_RANGE_TLV(\"MIC2 Boost Volume\", DA732X_REG_MIC2_PRE,\n\t\t\t     DA732X_MICBOOST_SHIFT, DA732X_MICBOOST_MIN,\n\t\t\t     DA732X_MICBOOST_MAX, 0, mic_boost_tlv),\n\tSOC_SINGLE_RANGE_TLV(\"MIC3 Boost Volume\", DA732X_REG_MIC3_PRE,\n\t\t\t     DA732X_MICBOOST_SHIFT, DA732X_MICBOOST_MIN,\n\t\t\t     DA732X_MICBOOST_MAX, 0, mic_boost_tlv),\n\n\t \n\tSOC_SINGLE(\"MIC1 Switch\", DA732X_REG_MIC1, DA732X_MIC_MUTE_SHIFT,\n\t\t   DA732X_SWITCH_MAX, DA732X_INVERT),\n\tSOC_SINGLE_RANGE_TLV(\"MIC1 Volume\", DA732X_REG_MIC1,\n\t\t\t     DA732X_MIC_VOL_SHIFT, DA732X_MIC_VOL_VAL_MIN,\n\t\t\t     DA732X_MIC_VOL_VAL_MAX, 0, mic_pga_tlv),\n\tSOC_SINGLE(\"MIC2 Switch\", DA732X_REG_MIC2, DA732X_MIC_MUTE_SHIFT,\n\t\t   DA732X_SWITCH_MAX, DA732X_INVERT),\n\tSOC_SINGLE_RANGE_TLV(\"MIC2 Volume\", DA732X_REG_MIC2,\n\t\t\t     DA732X_MIC_VOL_SHIFT, DA732X_MIC_VOL_VAL_MIN,\n\t\t\t     DA732X_MIC_VOL_VAL_MAX, 0, mic_pga_tlv),\n\tSOC_SINGLE(\"MIC3 Switch\", DA732X_REG_MIC3, DA732X_MIC_MUTE_SHIFT,\n\t\t   DA732X_SWITCH_MAX, DA732X_INVERT),\n\tSOC_SINGLE_RANGE_TLV(\"MIC3 Volume\", DA732X_REG_MIC3,\n\t\t\t     DA732X_MIC_VOL_SHIFT, DA732X_MIC_VOL_VAL_MIN,\n\t\t\t     DA732X_MIC_VOL_VAL_MAX, 0, mic_pga_tlv),\n\n\t \n\tSOC_SINGLE(\"AUX1L Switch\", DA732X_REG_AUX1L, DA732X_AUX_MUTE_SHIFT,\n\t\t   DA732X_SWITCH_MAX, DA732X_INVERT),\n\tSOC_SINGLE_TLV(\"AUX1L Volume\", DA732X_REG_AUX1L,\n\t\t       DA732X_AUX_VOL_SHIFT, DA732X_AUX_VOL_VAL_MAX,\n\t\t       DA732X_NO_INVERT, aux_pga_tlv),\n\tSOC_SINGLE(\"AUX1R Switch\", DA732X_REG_AUX1R, DA732X_AUX_MUTE_SHIFT,\n\t\t   DA732X_SWITCH_MAX, DA732X_INVERT),\n\tSOC_SINGLE_TLV(\"AUX1R Volume\", DA732X_REG_AUX1R,\n\t\t       DA732X_AUX_VOL_SHIFT, DA732X_AUX_VOL_VAL_MAX,\n\t\t       DA732X_NO_INVERT, aux_pga_tlv),\n\n\t \n\tSOC_DOUBLE_TLV(\"ADC1 Volume\", DA732X_REG_ADC1_SEL,\n\t\t       DA732X_ADCL_VOL_SHIFT, DA732X_ADCR_VOL_SHIFT,\n\t\t       DA732X_ADC_VOL_VAL_MAX, DA732X_INVERT, adc_pga_tlv),\n\n\tSOC_DOUBLE_TLV(\"ADC2 Volume\", DA732X_REG_ADC2_SEL,\n\t\t       DA732X_ADCL_VOL_SHIFT, DA732X_ADCR_VOL_SHIFT,\n\t\t       DA732X_ADC_VOL_VAL_MAX, DA732X_INVERT, adc_pga_tlv),\n\n\t \n\tSOC_DOUBLE(\"Digital Playback DAC12 Switch\", DA732X_REG_DAC1_SEL,\n\t\t   DA732X_DACL_MUTE_SHIFT, DA732X_DACR_MUTE_SHIFT,\n\t\t   DA732X_SWITCH_MAX, DA732X_INVERT),\n\tSOC_DOUBLE_R_TLV(\"Digital Playback DAC12 Volume\", DA732X_REG_DAC1_L_VOL,\n\t\t\t DA732X_REG_DAC1_R_VOL, DA732X_DAC_VOL_SHIFT,\n\t\t\t DA732X_DAC_VOL_VAL_MAX, DA732X_INVERT, dac_pga_tlv),\n\tSOC_SINGLE(\"Digital Playback DAC3 Switch\", DA732X_REG_DAC2_SEL,\n\t\t   DA732X_DACL_MUTE_SHIFT, DA732X_SWITCH_MAX, DA732X_INVERT),\n\tSOC_SINGLE_TLV(\"Digital Playback DAC3 Volume\", DA732X_REG_DAC2_L_VOL,\n\t\t\tDA732X_DAC_VOL_SHIFT, DA732X_DAC_VOL_VAL_MAX,\n\t\t\tDA732X_INVERT, dac_pga_tlv),\n\tSOC_SINGLE(\"Digital Playback DAC4 Switch\", DA732X_REG_DAC2_SEL,\n\t\t   DA732X_DACR_MUTE_SHIFT, DA732X_SWITCH_MAX, DA732X_INVERT),\n\tSOC_SINGLE_TLV(\"Digital Playback DAC4 Volume\", DA732X_REG_DAC2_R_VOL,\n\t\t       DA732X_DAC_VOL_SHIFT, DA732X_DAC_VOL_VAL_MAX,\n\t\t       DA732X_INVERT, dac_pga_tlv),\n\tSOC_SINGLE(\"Digital Playback DAC5 Switch\", DA732X_REG_DAC3_SEL,\n\t\t   DA732X_DACL_MUTE_SHIFT, DA732X_SWITCH_MAX, DA732X_INVERT),\n\tSOC_SINGLE_TLV(\"Digital Playback DAC5 Volume\", DA732X_REG_DAC3_VOL,\n\t\t       DA732X_DAC_VOL_SHIFT, DA732X_DAC_VOL_VAL_MAX,\n\t\t       DA732X_INVERT, dac_pga_tlv),\n\n\t \n\tSOC_ENUM_EXT(\"DAC1 High Pass Filter Mode\",\n\t\t     da732x_dac1_hpf_mode_enum, da732x_hpf_get, da732x_hpf_set),\n\tSOC_ENUM(\"DAC1 High Pass Filter\", da732x_dac1_hp_filter_enum),\n\tSOC_ENUM(\"DAC1 Voice Filter\", da732x_dac1_voice_filter_enum),\n\n\tSOC_ENUM_EXT(\"DAC2 High Pass Filter Mode\",\n\t\t     da732x_dac2_hpf_mode_enum, da732x_hpf_get, da732x_hpf_set),\n\tSOC_ENUM(\"DAC2 High Pass Filter\", da732x_dac2_hp_filter_enum),\n\tSOC_ENUM(\"DAC2 Voice Filter\", da732x_dac2_voice_filter_enum),\n\n\tSOC_ENUM_EXT(\"DAC3 High Pass Filter Mode\",\n\t\t     da732x_dac3_hpf_mode_enum, da732x_hpf_get, da732x_hpf_set),\n\tSOC_ENUM(\"DAC3 High Pass Filter\", da732x_dac3_hp_filter_enum),\n\tSOC_ENUM(\"DAC3 Filter Mode\", da732x_dac3_voice_filter_enum),\n\n\tSOC_ENUM_EXT(\"ADC1 High Pass Filter Mode\",\n\t\t     da732x_adc1_hpf_mode_enum, da732x_hpf_get, da732x_hpf_set),\n\tSOC_ENUM(\"ADC1 High Pass Filter\", da732x_adc1_hp_filter_enum),\n\tSOC_ENUM(\"ADC1 Voice Filter\", da732x_adc1_voice_filter_enum),\n\n\tSOC_ENUM_EXT(\"ADC2 High Pass Filter Mode\",\n\t\t     da732x_adc2_hpf_mode_enum, da732x_hpf_get, da732x_hpf_set),\n\tSOC_ENUM(\"ADC2 High Pass Filter\", da732x_adc2_hp_filter_enum),\n\tSOC_ENUM(\"ADC2 Voice Filter\", da732x_adc2_voice_filter_enum),\n\n\t \n\tSOC_SINGLE(\"ADC1 EQ Switch\", DA732X_REG_ADC1_EQ5,\n\t\t   DA732X_EQ_EN_SHIFT, DA732X_EQ_EN_MAX, DA732X_NO_INVERT),\n\tSOC_SINGLE_TLV(\"ADC1 EQ Band 1 Volume\", DA732X_REG_ADC1_EQ12,\n\t\t       DA732X_EQ_BAND1_SHIFT, DA732X_EQ_VOL_VAL_MAX,\n\t\t       DA732X_INVERT, eq_band_pga_tlv),\n\tSOC_SINGLE_TLV(\"ADC1 EQ Band 2 Volume\", DA732X_REG_ADC1_EQ12,\n\t\t       DA732X_EQ_BAND2_SHIFT, DA732X_EQ_VOL_VAL_MAX,\n\t\t       DA732X_INVERT, eq_band_pga_tlv),\n\tSOC_SINGLE_TLV(\"ADC1 EQ Band 3 Volume\", DA732X_REG_ADC1_EQ34,\n\t\t       DA732X_EQ_BAND3_SHIFT, DA732X_EQ_VOL_VAL_MAX,\n\t\t       DA732X_INVERT, eq_band_pga_tlv),\n\tSOC_SINGLE_TLV(\"ADC1 EQ Band 4 Volume\", DA732X_REG_ADC1_EQ34,\n\t\t       DA732X_EQ_BAND4_SHIFT, DA732X_EQ_VOL_VAL_MAX,\n\t\t       DA732X_INVERT, eq_band_pga_tlv),\n\tSOC_SINGLE_TLV(\"ADC1 EQ Band 5 Volume\", DA732X_REG_ADC1_EQ5,\n\t\t       DA732X_EQ_BAND5_SHIFT, DA732X_EQ_VOL_VAL_MAX,\n\t\t       DA732X_INVERT, eq_band_pga_tlv),\n\tSOC_SINGLE_TLV(\"ADC1 EQ Overall Volume\", DA732X_REG_ADC1_EQ5,\n\t\t       DA732X_EQ_OVERALL_SHIFT, DA732X_EQ_OVERALL_VOL_VAL_MAX,\n\t\t       DA732X_INVERT, eq_overall_tlv),\n\n\tSOC_SINGLE(\"ADC2 EQ Switch\", DA732X_REG_ADC2_EQ5,\n\t\t   DA732X_EQ_EN_SHIFT, DA732X_EQ_EN_MAX, DA732X_NO_INVERT),\n\tSOC_SINGLE_TLV(\"ADC2 EQ Band 1 Volume\", DA732X_REG_ADC2_EQ12,\n\t\t       DA732X_EQ_BAND1_SHIFT, DA732X_EQ_VOL_VAL_MAX,\n\t\t       DA732X_INVERT, eq_band_pga_tlv),\n\tSOC_SINGLE_TLV(\"ADC2 EQ Band 2 Volume\", DA732X_REG_ADC2_EQ12,\n\t\t       DA732X_EQ_BAND2_SHIFT, DA732X_EQ_VOL_VAL_MAX,\n\t\t       DA732X_INVERT, eq_band_pga_tlv),\n\tSOC_SINGLE_TLV(\"ADC2 EQ Band 3 Volume\", DA732X_REG_ADC2_EQ34,\n\t\t       DA732X_EQ_BAND3_SHIFT, DA732X_EQ_VOL_VAL_MAX,\n\t\t       DA732X_INVERT, eq_band_pga_tlv),\n\tSOC_SINGLE_TLV(\"ACD2 EQ Band 4 Volume\", DA732X_REG_ADC2_EQ34,\n\t\t       DA732X_EQ_BAND4_SHIFT, DA732X_EQ_VOL_VAL_MAX,\n\t\t       DA732X_INVERT, eq_band_pga_tlv),\n\tSOC_SINGLE_TLV(\"ACD2 EQ Band 5 Volume\", DA732X_REG_ADC2_EQ5,\n\t\t       DA732X_EQ_BAND5_SHIFT, DA732X_EQ_VOL_VAL_MAX,\n\t\t       DA732X_INVERT, eq_band_pga_tlv),\n\tSOC_SINGLE_TLV(\"ADC2 EQ Overall Volume\", DA732X_REG_ADC1_EQ5,\n\t\t       DA732X_EQ_OVERALL_SHIFT, DA732X_EQ_OVERALL_VOL_VAL_MAX,\n\t\t       DA732X_INVERT, eq_overall_tlv),\n\n\tSOC_SINGLE(\"DAC1 EQ Switch\", DA732X_REG_DAC1_EQ5,\n\t\t   DA732X_EQ_EN_SHIFT, DA732X_EQ_EN_MAX, DA732X_NO_INVERT),\n\tSOC_SINGLE_TLV(\"DAC1 EQ Band 1 Volume\", DA732X_REG_DAC1_EQ12,\n\t\t       DA732X_EQ_BAND1_SHIFT, DA732X_EQ_VOL_VAL_MAX,\n\t\t       DA732X_INVERT, eq_band_pga_tlv),\n\tSOC_SINGLE_TLV(\"DAC1 EQ Band 2 Volume\", DA732X_REG_DAC1_EQ12,\n\t\t       DA732X_EQ_BAND2_SHIFT, DA732X_EQ_VOL_VAL_MAX,\n\t\t       DA732X_INVERT, eq_band_pga_tlv),\n\tSOC_SINGLE_TLV(\"DAC1 EQ Band 3 Volume\", DA732X_REG_DAC1_EQ34,\n\t\t       DA732X_EQ_BAND3_SHIFT, DA732X_EQ_VOL_VAL_MAX,\n\t\t       DA732X_INVERT, eq_band_pga_tlv),\n\tSOC_SINGLE_TLV(\"DAC1 EQ Band 4 Volume\", DA732X_REG_DAC1_EQ34,\n\t\t       DA732X_EQ_BAND4_SHIFT, DA732X_EQ_VOL_VAL_MAX,\n\t\t       DA732X_INVERT, eq_band_pga_tlv),\n\tSOC_SINGLE_TLV(\"DAC1 EQ Band 5 Volume\", DA732X_REG_DAC1_EQ5,\n\t\t       DA732X_EQ_BAND5_SHIFT, DA732X_EQ_VOL_VAL_MAX,\n\t\t       DA732X_INVERT, eq_band_pga_tlv),\n\n\tSOC_SINGLE(\"DAC2 EQ Switch\", DA732X_REG_DAC2_EQ5,\n\t\t   DA732X_EQ_EN_SHIFT, DA732X_EQ_EN_MAX, DA732X_NO_INVERT),\n\tSOC_SINGLE_TLV(\"DAC2 EQ Band 1 Volume\", DA732X_REG_DAC2_EQ12,\n\t\t       DA732X_EQ_BAND1_SHIFT, DA732X_EQ_VOL_VAL_MAX,\n\t\t       DA732X_INVERT, eq_band_pga_tlv),\n\tSOC_SINGLE_TLV(\"DAC2 EQ Band 2 Volume\", DA732X_REG_DAC2_EQ12,\n\t\t       DA732X_EQ_BAND2_SHIFT, DA732X_EQ_VOL_VAL_MAX,\n\t\t       DA732X_INVERT, eq_band_pga_tlv),\n\tSOC_SINGLE_TLV(\"DAC2 EQ Band 3 Volume\", DA732X_REG_DAC2_EQ34,\n\t\t       DA732X_EQ_BAND3_SHIFT, DA732X_EQ_VOL_VAL_MAX,\n\t\t       DA732X_INVERT, eq_band_pga_tlv),\n\tSOC_SINGLE_TLV(\"DAC2 EQ Band 4 Volume\", DA732X_REG_DAC2_EQ34,\n\t\t       DA732X_EQ_BAND4_SHIFT, DA732X_EQ_VOL_VAL_MAX,\n\t\t       DA732X_INVERT, eq_band_pga_tlv),\n\tSOC_SINGLE_TLV(\"DAC2 EQ Band 5 Volume\", DA732X_REG_DAC2_EQ5,\n\t\t       DA732X_EQ_BAND5_SHIFT, DA732X_EQ_VOL_VAL_MAX,\n\t\t       DA732X_INVERT, eq_band_pga_tlv),\n\n\tSOC_SINGLE(\"DAC3 EQ Switch\", DA732X_REG_DAC3_EQ5,\n\t\t   DA732X_EQ_EN_SHIFT, DA732X_EQ_EN_MAX, DA732X_NO_INVERT),\n\tSOC_SINGLE_TLV(\"DAC3 EQ Band 1 Volume\", DA732X_REG_DAC3_EQ12,\n\t\t       DA732X_EQ_BAND1_SHIFT, DA732X_EQ_VOL_VAL_MAX,\n\t\t       DA732X_INVERT, eq_band_pga_tlv),\n\tSOC_SINGLE_TLV(\"DAC3 EQ Band 2 Volume\", DA732X_REG_DAC3_EQ12,\n\t\t       DA732X_EQ_BAND2_SHIFT, DA732X_EQ_VOL_VAL_MAX,\n\t\t       DA732X_INVERT, eq_band_pga_tlv),\n\tSOC_SINGLE_TLV(\"DAC3 EQ Band 3 Volume\", DA732X_REG_DAC3_EQ34,\n\t\t       DA732X_EQ_BAND3_SHIFT, DA732X_EQ_VOL_VAL_MAX,\n\t\t       DA732X_INVERT, eq_band_pga_tlv),\n\tSOC_SINGLE_TLV(\"DAC3 EQ Band 4 Volume\", DA732X_REG_DAC3_EQ34,\n\t\t       DA732X_EQ_BAND4_SHIFT, DA732X_EQ_VOL_VAL_MAX,\n\t\t       DA732X_INVERT, eq_band_pga_tlv),\n\tSOC_SINGLE_TLV(\"DAC3 EQ Band 5 Volume\", DA732X_REG_DAC3_EQ5,\n\t\t       DA732X_EQ_BAND5_SHIFT, DA732X_EQ_VOL_VAL_MAX,\n\t\t       DA732X_INVERT, eq_band_pga_tlv),\n\n\t \n\tSOC_SINGLE(\"Lineout 2 Switch\", DA732X_REG_LIN2, DA732X_LOUT_MUTE_SHIFT,\n\t\t   DA732X_SWITCH_MAX, DA732X_INVERT),\n\tSOC_SINGLE_TLV(\"Lineout 2 Volume\", DA732X_REG_LIN2,\n\t\t       DA732X_LOUT_VOL_SHIFT, DA732X_LOUT_VOL_VAL_MAX,\n\t\t       DA732X_NO_INVERT, lin2_pga_tlv),\n\n\t \n\tSOC_SINGLE(\"Lineout 3 Switch\", DA732X_REG_LIN3, DA732X_LOUT_MUTE_SHIFT,\n\t\t   DA732X_SWITCH_MAX, DA732X_INVERT),\n\tSOC_SINGLE_TLV(\"Lineout 3 Volume\", DA732X_REG_LIN3,\n\t\t       DA732X_LOUT_VOL_SHIFT, DA732X_LOUT_VOL_VAL_MAX,\n\t\t       DA732X_NO_INVERT, lin3_pga_tlv),\n\n\t \n\tSOC_SINGLE(\"Lineout 4 Switch\", DA732X_REG_LIN4, DA732X_LOUT_MUTE_SHIFT,\n\t\t   DA732X_SWITCH_MAX, DA732X_INVERT),\n\tSOC_SINGLE_TLV(\"Lineout 4 Volume\", DA732X_REG_LIN4,\n\t\t       DA732X_LOUT_VOL_SHIFT, DA732X_LOUT_VOL_VAL_MAX,\n\t\t       DA732X_NO_INVERT, lin4_pga_tlv),\n\n\t \n\tSOC_DOUBLE_R(\"Headphone Switch\", DA732X_REG_HPR, DA732X_REG_HPL,\n\t\t     DA732X_HP_MUTE_SHIFT, DA732X_SWITCH_MAX, DA732X_INVERT),\n\tSOC_DOUBLE_R_TLV(\"Headphone Volume\", DA732X_REG_HPL_VOL,\n\t\t\t DA732X_REG_HPR_VOL, DA732X_HP_VOL_SHIFT,\n\t\t\t DA732X_HP_VOL_VAL_MAX, DA732X_NO_INVERT, hp_pga_tlv),\n};\n\nstatic int da732x_adc_event(struct snd_soc_dapm_widget *w,\n\t\t\t    struct snd_kcontrol *kcontrol, int event)\n{\n\tstruct snd_soc_component *component = snd_soc_dapm_to_component(w->dapm);\n\n\tswitch (event) {\n\tcase SND_SOC_DAPM_POST_PMU:\n\t\tswitch (w->reg) {\n\t\tcase DA732X_REG_ADC1_PD:\n\t\t\tsnd_soc_component_update_bits(component, DA732X_REG_CLK_EN3,\n\t\t\t\t\t    DA732X_ADCA_BB_CLK_EN,\n\t\t\t\t\t    DA732X_ADCA_BB_CLK_EN);\n\t\t\tbreak;\n\t\tcase DA732X_REG_ADC2_PD:\n\t\t\tsnd_soc_component_update_bits(component, DA732X_REG_CLK_EN3,\n\t\t\t\t\t    DA732X_ADCC_BB_CLK_EN,\n\t\t\t\t\t    DA732X_ADCC_BB_CLK_EN);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn -EINVAL;\n\t\t}\n\n\t\tsnd_soc_component_update_bits(component, w->reg, DA732X_ADC_RST_MASK,\n\t\t\t\t    DA732X_ADC_SET_ACT);\n\t\tsnd_soc_component_update_bits(component, w->reg, DA732X_ADC_PD_MASK,\n\t\t\t\t    DA732X_ADC_ON);\n\t\tbreak;\n\tcase SND_SOC_DAPM_POST_PMD:\n\t\tsnd_soc_component_update_bits(component, w->reg, DA732X_ADC_PD_MASK,\n\t\t\t\t    DA732X_ADC_OFF);\n\t\tsnd_soc_component_update_bits(component, w->reg, DA732X_ADC_RST_MASK,\n\t\t\t\t    DA732X_ADC_SET_RST);\n\n\t\tswitch (w->reg) {\n\t\tcase DA732X_REG_ADC1_PD:\n\t\t\tsnd_soc_component_update_bits(component, DA732X_REG_CLK_EN3,\n\t\t\t\t\t    DA732X_ADCA_BB_CLK_EN, 0);\n\t\t\tbreak;\n\t\tcase DA732X_REG_ADC2_PD:\n\t\t\tsnd_soc_component_update_bits(component, DA732X_REG_CLK_EN3,\n\t\t\t\t\t    DA732X_ADCC_BB_CLK_EN, 0);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn -EINVAL;\n\t\t}\n\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\treturn 0;\n}\n\nstatic int da732x_out_pga_event(struct snd_soc_dapm_widget *w,\n\t\t\t\tstruct snd_kcontrol *kcontrol, int event)\n{\n\tstruct snd_soc_component *component = snd_soc_dapm_to_component(w->dapm);\n\n\tswitch (event) {\n\tcase SND_SOC_DAPM_POST_PMU:\n\t\tsnd_soc_component_update_bits(component, w->reg,\n\t\t\t\t    (1 << w->shift) | DA732X_OUT_HIZ_EN,\n\t\t\t\t    (1 << w->shift) | DA732X_OUT_HIZ_EN);\n\t\tbreak;\n\tcase SND_SOC_DAPM_POST_PMD:\n\t\tsnd_soc_component_update_bits(component, w->reg,\n\t\t\t\t    (1 << w->shift) | DA732X_OUT_HIZ_EN,\n\t\t\t\t    (1 << w->shift) | DA732X_OUT_HIZ_DIS);\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\treturn 0;\n}\n\nstatic const char *adcl_text[] = {\n\t\"AUX1L\", \"MIC1\"\n};\n\nstatic const char *adcr_text[] = {\n\t\"AUX1R\", \"MIC2\", \"MIC3\"\n};\n\nstatic const char *enable_text[] = {\n\t\"Disabled\",\n\t\"Enabled\"\n};\n\n \nstatic SOC_ENUM_SINGLE_DECL(adc1l_enum,\n\t\t\t    DA732X_REG_INP_MUX, DA732X_ADC1L_MUX_SEL_SHIFT,\n\t\t\t    adcl_text);\nstatic const struct snd_kcontrol_new adc1l_mux =\n\tSOC_DAPM_ENUM(\"ADC Route\", adc1l_enum);\n\n \nstatic SOC_ENUM_SINGLE_DECL(adc1r_enum,\n\t\t\t    DA732X_REG_INP_MUX, DA732X_ADC1R_MUX_SEL_SHIFT,\n\t\t\t    adcr_text);\nstatic const struct snd_kcontrol_new adc1r_mux =\n\tSOC_DAPM_ENUM(\"ADC Route\", adc1r_enum);\n\n \nstatic SOC_ENUM_SINGLE_DECL(adc2l_enum,\n\t\t\t    DA732X_REG_INP_MUX, DA732X_ADC2L_MUX_SEL_SHIFT,\n\t\t\t    adcl_text);\nstatic const struct snd_kcontrol_new adc2l_mux =\n\tSOC_DAPM_ENUM(\"ADC Route\", adc2l_enum);\n\n \nstatic SOC_ENUM_SINGLE_DECL(adc2r_enum,\n\t\t\t    DA732X_REG_INP_MUX, DA732X_ADC2R_MUX_SEL_SHIFT,\n\t\t\t    adcr_text);\n\nstatic const struct snd_kcontrol_new adc2r_mux =\n\tSOC_DAPM_ENUM(\"ADC Route\", adc2r_enum);\n\nstatic SOC_ENUM_SINGLE_DECL(da732x_hp_left_output,\n\t\t\t    DA732X_REG_HPL, DA732X_HP_OUT_DAC_EN_SHIFT,\n\t\t\t    enable_text);\n\nstatic const struct snd_kcontrol_new hpl_mux =\n\tSOC_DAPM_ENUM(\"HPL Switch\", da732x_hp_left_output);\n\nstatic SOC_ENUM_SINGLE_DECL(da732x_hp_right_output,\n\t\t\t    DA732X_REG_HPR, DA732X_HP_OUT_DAC_EN_SHIFT,\n\t\t\t    enable_text);\n\nstatic const struct snd_kcontrol_new hpr_mux =\n\tSOC_DAPM_ENUM(\"HPR Switch\", da732x_hp_right_output);\n\nstatic SOC_ENUM_SINGLE_DECL(da732x_speaker_output,\n\t\t\t    DA732X_REG_LIN3, DA732X_LOUT_DAC_EN_SHIFT,\n\t\t\t    enable_text);\n\nstatic const struct snd_kcontrol_new spk_mux =\n\tSOC_DAPM_ENUM(\"SPK Switch\", da732x_speaker_output);\n\nstatic SOC_ENUM_SINGLE_DECL(da732x_lout4_output,\n\t\t\t    DA732X_REG_LIN4, DA732X_LOUT_DAC_EN_SHIFT,\n\t\t\t    enable_text);\n\nstatic const struct snd_kcontrol_new lout4_mux =\n\tSOC_DAPM_ENUM(\"LOUT4 Switch\", da732x_lout4_output);\n\nstatic SOC_ENUM_SINGLE_DECL(da732x_lout2_output,\n\t\t\t    DA732X_REG_LIN2, DA732X_LOUT_DAC_EN_SHIFT,\n\t\t\t    enable_text);\n\nstatic const struct snd_kcontrol_new lout2_mux =\n\tSOC_DAPM_ENUM(\"LOUT2 Switch\", da732x_lout2_output);\n\nstatic const struct snd_soc_dapm_widget da732x_dapm_widgets[] = {\n\t \n\tSND_SOC_DAPM_SUPPLY(\"ADC1 Supply\", DA732X_REG_ADC1_PD, 0,\n\t\t\t    DA732X_NO_INVERT, da732x_adc_event,\n\t\t\t    SND_SOC_DAPM_PRE_PMU | SND_SOC_DAPM_POST_PMD),\n\tSND_SOC_DAPM_SUPPLY(\"ADC2 Supply\", DA732X_REG_ADC2_PD, 0,\n\t\t\t    DA732X_NO_INVERT, da732x_adc_event,\n\t\t\t    SND_SOC_DAPM_PRE_PMU | SND_SOC_DAPM_POST_PMD),\n\tSND_SOC_DAPM_SUPPLY(\"DAC1 CLK\", DA732X_REG_CLK_EN4,\n\t\t\t    DA732X_DACA_BB_CLK_SHIFT, DA732X_NO_INVERT,\n\t\t\t    NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"DAC2 CLK\", DA732X_REG_CLK_EN4,\n\t\t\t    DA732X_DACC_BB_CLK_SHIFT, DA732X_NO_INVERT,\n\t\t\t    NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"DAC3 CLK\", DA732X_REG_CLK_EN5,\n\t\t\t    DA732X_DACE_BB_CLK_SHIFT, DA732X_NO_INVERT,\n\t\t\t    NULL, 0),\n\n\t \n\tSND_SOC_DAPM_SUPPLY(\"MICBIAS1\", DA732X_REG_MICBIAS1,\n\t\t\t    DA732X_MICBIAS_EN_SHIFT,\n\t\t\t    DA732X_NO_INVERT, NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"MICBIAS2\", DA732X_REG_MICBIAS2,\n\t\t\t    DA732X_MICBIAS_EN_SHIFT,\n\t\t\t    DA732X_NO_INVERT, NULL, 0),\n\n\t \n\tSND_SOC_DAPM_INPUT(\"MIC1\"),\n\tSND_SOC_DAPM_INPUT(\"MIC2\"),\n\tSND_SOC_DAPM_INPUT(\"MIC3\"),\n\tSND_SOC_DAPM_INPUT(\"AUX1L\"),\n\tSND_SOC_DAPM_INPUT(\"AUX1R\"),\n\n\t \n\tSND_SOC_DAPM_OUTPUT(\"HPL\"),\n\tSND_SOC_DAPM_OUTPUT(\"HPR\"),\n\tSND_SOC_DAPM_OUTPUT(\"LOUTL\"),\n\tSND_SOC_DAPM_OUTPUT(\"LOUTR\"),\n\tSND_SOC_DAPM_OUTPUT(\"ClassD\"),\n\n\t \n\tSND_SOC_DAPM_ADC(\"ADC1L\", NULL, DA732X_REG_ADC1_SEL,\n\t\t\t DA732X_ADCL_EN_SHIFT, DA732X_NO_INVERT),\n\tSND_SOC_DAPM_ADC(\"ADC1R\", NULL, DA732X_REG_ADC1_SEL,\n\t\t\t DA732X_ADCR_EN_SHIFT, DA732X_NO_INVERT),\n\tSND_SOC_DAPM_ADC(\"ADC2L\", NULL, DA732X_REG_ADC2_SEL,\n\t\t\t DA732X_ADCL_EN_SHIFT, DA732X_NO_INVERT),\n\tSND_SOC_DAPM_ADC(\"ADC2R\", NULL, DA732X_REG_ADC2_SEL,\n\t\t\t DA732X_ADCR_EN_SHIFT, DA732X_NO_INVERT),\n\n\t \n\tSND_SOC_DAPM_DAC(\"DAC1L\", NULL, DA732X_REG_DAC1_SEL,\n\t\t\t DA732X_DACL_EN_SHIFT, DA732X_NO_INVERT),\n\tSND_SOC_DAPM_DAC(\"DAC1R\", NULL, DA732X_REG_DAC1_SEL,\n\t\t\t DA732X_DACR_EN_SHIFT, DA732X_NO_INVERT),\n\tSND_SOC_DAPM_DAC(\"DAC2L\", NULL, DA732X_REG_DAC2_SEL,\n\t\t\t DA732X_DACL_EN_SHIFT, DA732X_NO_INVERT),\n\tSND_SOC_DAPM_DAC(\"DAC2R\", NULL, DA732X_REG_DAC2_SEL,\n\t\t\t DA732X_DACR_EN_SHIFT, DA732X_NO_INVERT),\n\tSND_SOC_DAPM_DAC(\"DAC3\", NULL, DA732X_REG_DAC3_SEL,\n\t\t\t DA732X_DACL_EN_SHIFT, DA732X_NO_INVERT),\n\n\t \n\tSND_SOC_DAPM_PGA(\"MIC1 PGA\", DA732X_REG_MIC1, DA732X_MIC_EN_SHIFT,\n\t\t\t 0, NULL, 0),\n\tSND_SOC_DAPM_PGA(\"MIC2 PGA\", DA732X_REG_MIC2, DA732X_MIC_EN_SHIFT,\n\t\t\t 0, NULL, 0),\n\tSND_SOC_DAPM_PGA(\"MIC3 PGA\", DA732X_REG_MIC3, DA732X_MIC_EN_SHIFT,\n\t\t\t 0, NULL, 0),\n\tSND_SOC_DAPM_PGA(\"AUX1L PGA\", DA732X_REG_AUX1L, DA732X_AUX_EN_SHIFT,\n\t\t\t 0, NULL, 0),\n\tSND_SOC_DAPM_PGA(\"AUX1R PGA\", DA732X_REG_AUX1R, DA732X_AUX_EN_SHIFT,\n\t\t\t 0, NULL, 0),\n\n\tSND_SOC_DAPM_PGA_E(\"HP Left\", DA732X_REG_HPL, DA732X_HP_OUT_EN_SHIFT,\n\t\t\t   0, NULL, 0, da732x_out_pga_event,\n\t\t\t   SND_SOC_DAPM_POST_PMU | SND_SOC_DAPM_POST_PMD),\n\tSND_SOC_DAPM_PGA_E(\"HP Right\", DA732X_REG_HPR, DA732X_HP_OUT_EN_SHIFT,\n\t\t\t   0, NULL, 0, da732x_out_pga_event,\n\t\t\t   SND_SOC_DAPM_POST_PMU | SND_SOC_DAPM_POST_PMD),\n\tSND_SOC_DAPM_PGA_E(\"LIN2\", DA732X_REG_LIN2, DA732X_LIN_OUT_EN_SHIFT,\n\t\t\t   0, NULL, 0, da732x_out_pga_event,\n\t\t\t   SND_SOC_DAPM_POST_PMU | SND_SOC_DAPM_POST_PMD),\n\tSND_SOC_DAPM_PGA_E(\"LIN3\", DA732X_REG_LIN3, DA732X_LIN_OUT_EN_SHIFT,\n\t\t\t   0, NULL, 0, da732x_out_pga_event,\n\t\t\t   SND_SOC_DAPM_POST_PMU | SND_SOC_DAPM_POST_PMD),\n\tSND_SOC_DAPM_PGA_E(\"LIN4\", DA732X_REG_LIN4, DA732X_LIN_OUT_EN_SHIFT,\n\t\t\t   0, NULL, 0, da732x_out_pga_event,\n\t\t\t   SND_SOC_DAPM_POST_PMU | SND_SOC_DAPM_POST_PMD),\n\n\t \n\tSND_SOC_DAPM_MUX(\"ADC1 Left MUX\", SND_SOC_NOPM, 0, 0, &adc1l_mux),\n\tSND_SOC_DAPM_MUX(\"ADC1 Right MUX\", SND_SOC_NOPM, 0, 0, &adc1r_mux),\n\tSND_SOC_DAPM_MUX(\"ADC2 Left MUX\", SND_SOC_NOPM, 0, 0, &adc2l_mux),\n\tSND_SOC_DAPM_MUX(\"ADC2 Right MUX\", SND_SOC_NOPM, 0, 0, &adc2r_mux),\n\n\tSND_SOC_DAPM_MUX(\"HP Left MUX\", SND_SOC_NOPM, 0, 0, &hpl_mux),\n\tSND_SOC_DAPM_MUX(\"HP Right MUX\", SND_SOC_NOPM, 0, 0, &hpr_mux),\n\tSND_SOC_DAPM_MUX(\"Speaker MUX\", SND_SOC_NOPM, 0, 0, &spk_mux),\n\tSND_SOC_DAPM_MUX(\"LOUT2 MUX\", SND_SOC_NOPM, 0, 0, &lout2_mux),\n\tSND_SOC_DAPM_MUX(\"LOUT4 MUX\", SND_SOC_NOPM, 0, 0, &lout4_mux),\n\n\t \n\tSND_SOC_DAPM_AIF_OUT(\"AIFA Output\", \"AIFA Capture\", 0, DA732X_REG_AIFA3,\n\t\t\t     DA732X_AIF_EN_SHIFT, 0),\n\tSND_SOC_DAPM_AIF_IN(\"AIFA Input\", \"AIFA Playback\", 0, DA732X_REG_AIFA3,\n\t\t\t    DA732X_AIF_EN_SHIFT, 0),\n\n\tSND_SOC_DAPM_AIF_OUT(\"AIFB Output\", \"AIFB Capture\", 0, DA732X_REG_AIFB3,\n\t\t\t     DA732X_AIF_EN_SHIFT, 0),\n\tSND_SOC_DAPM_AIF_IN(\"AIFB Input\", \"AIFB Playback\", 0, DA732X_REG_AIFB3,\n\t\t\t    DA732X_AIF_EN_SHIFT, 0),\n};\n\nstatic const struct snd_soc_dapm_route da732x_dapm_routes[] = {\n\t \n\t{\"AUX1L PGA\", NULL, \"AUX1L\"},\n\t{\"AUX1R PGA\", NULL, \"AUX1R\"},\n\t{\"MIC1 PGA\", NULL, \"MIC1\"},\n\t{\"MIC2 PGA\", NULL, \"MIC2\"},\n\t{\"MIC3 PGA\", NULL, \"MIC3\"},\n\n\t \n\t{\"ADC1 Left MUX\", \"MIC1\", \"MIC1 PGA\"},\n\t{\"ADC1 Left MUX\", \"AUX1L\", \"AUX1L PGA\"},\n\n\t{\"ADC1 Right MUX\", \"AUX1R\", \"AUX1R PGA\"},\n\t{\"ADC1 Right MUX\", \"MIC2\", \"MIC2 PGA\"},\n\t{\"ADC1 Right MUX\", \"MIC3\", \"MIC3 PGA\"},\n\n\t{\"ADC2 Left MUX\", \"AUX1L\", \"AUX1L PGA\"},\n\t{\"ADC2 Left MUX\", \"MIC1\", \"MIC1 PGA\"},\n\n\t{\"ADC2 Right MUX\", \"AUX1R\", \"AUX1R PGA\"},\n\t{\"ADC2 Right MUX\", \"MIC2\", \"MIC2 PGA\"},\n\t{\"ADC2 Right MUX\", \"MIC3\", \"MIC3 PGA\"},\n\n\t{\"ADC1L\", NULL, \"ADC1 Supply\"},\n\t{\"ADC1R\", NULL, \"ADC1 Supply\"},\n\t{\"ADC2L\", NULL, \"ADC2 Supply\"},\n\t{\"ADC2R\", NULL, \"ADC2 Supply\"},\n\n\t{\"ADC1L\", NULL, \"ADC1 Left MUX\"},\n\t{\"ADC1R\", NULL, \"ADC1 Right MUX\"},\n\t{\"ADC2L\", NULL, \"ADC2 Left MUX\"},\n\t{\"ADC2R\", NULL, \"ADC2 Right MUX\"},\n\n\t{\"AIFA Output\", NULL, \"ADC1L\"},\n\t{\"AIFA Output\", NULL, \"ADC1R\"},\n\t{\"AIFB Output\", NULL, \"ADC2L\"},\n\t{\"AIFB Output\", NULL, \"ADC2R\"},\n\n\t{\"HP Left MUX\", \"Enabled\", \"AIFA Input\"},\n\t{\"HP Right MUX\", \"Enabled\", \"AIFA Input\"},\n\t{\"Speaker MUX\", \"Enabled\", \"AIFB Input\"},\n\t{\"LOUT2 MUX\", \"Enabled\", \"AIFB Input\"},\n\t{\"LOUT4 MUX\", \"Enabled\", \"AIFB Input\"},\n\n\t{\"DAC1L\", NULL, \"DAC1 CLK\"},\n\t{\"DAC1R\", NULL, \"DAC1 CLK\"},\n\t{\"DAC2L\", NULL, \"DAC2 CLK\"},\n\t{\"DAC2R\", NULL, \"DAC2 CLK\"},\n\t{\"DAC3\", NULL, \"DAC3 CLK\"},\n\n\t{\"DAC1L\", NULL, \"HP Left MUX\"},\n\t{\"DAC1R\", NULL, \"HP Right MUX\"},\n\t{\"DAC2L\", NULL, \"Speaker MUX\"},\n\t{\"DAC2R\", NULL, \"LOUT4 MUX\"},\n\t{\"DAC3\", NULL, \"LOUT2 MUX\"},\n\n\t \n\t{\"HP Left\", NULL, \"DAC1L\"},\n\t{\"HP Right\", NULL, \"DAC1R\"},\n\t{\"LIN3\", NULL, \"DAC2L\"},\n\t{\"LIN4\", NULL, \"DAC2R\"},\n\t{\"LIN2\", NULL, \"DAC3\"},\n\n\t \n\t{\"ClassD\", NULL, \"LIN3\"},\n\t{\"LOUTL\", NULL, \"LIN2\"},\n\t{\"LOUTR\", NULL, \"LIN4\"},\n\t{\"HPL\", NULL, \"HP Left\"},\n\t{\"HPR\", NULL, \"HP Right\"},\n};\n\nstatic int da732x_hw_params(struct snd_pcm_substream *substream,\n\t\t\t    struct snd_pcm_hw_params *params,\n\t\t\t    struct snd_soc_dai *dai)\n{\n\tstruct snd_soc_component *component = dai->component;\n\tu32 aif = 0;\n\tu32 reg_aif;\n\tu32 fs;\n\n\treg_aif = dai->driver->base;\n\n\tswitch (params_width(params)) {\n\tcase 16:\n\t\taif |= DA732X_AIF_WORD_16;\n\t\tbreak;\n\tcase 20:\n\t\taif |= DA732X_AIF_WORD_20;\n\t\tbreak;\n\tcase 24:\n\t\taif |= DA732X_AIF_WORD_24;\n\t\tbreak;\n\tcase 32:\n\t\taif |= DA732X_AIF_WORD_32;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tswitch (params_rate(params)) {\n\tcase 8000:\n\t\tfs = DA732X_SR_8KHZ;\n\t\tbreak;\n\tcase 11025:\n\t\tfs = DA732X_SR_11_025KHZ;\n\t\tbreak;\n\tcase 12000:\n\t\tfs = DA732X_SR_12KHZ;\n\t\tbreak;\n\tcase 16000:\n\t\tfs = DA732X_SR_16KHZ;\n\t\tbreak;\n\tcase 22050:\n\t\tfs = DA732X_SR_22_05KHZ;\n\t\tbreak;\n\tcase 24000:\n\t\tfs = DA732X_SR_24KHZ;\n\t\tbreak;\n\tcase 32000:\n\t\tfs = DA732X_SR_32KHZ;\n\t\tbreak;\n\tcase 44100:\n\t\tfs = DA732X_SR_44_1KHZ;\n\t\tbreak;\n\tcase 48000:\n\t\tfs = DA732X_SR_48KHZ;\n\t\tbreak;\n\tcase 88100:\n\t\tfs = DA732X_SR_88_1KHZ;\n\t\tbreak;\n\tcase 96000:\n\t\tfs = DA732X_SR_96KHZ;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tsnd_soc_component_update_bits(component, reg_aif, DA732X_AIF_WORD_MASK, aif);\n\tsnd_soc_component_update_bits(component, DA732X_REG_CLK_CTRL, DA732X_SR1_MASK, fs);\n\n\treturn 0;\n}\n\nstatic int da732x_set_dai_fmt(struct snd_soc_dai *dai, u32 fmt)\n{\n\tstruct snd_soc_component *component = dai->component;\n\tu32 aif_mclk, pc_count;\n\tu32 reg_aif1, aif1;\n\tu32 reg_aif3, aif3;\n\n\tswitch (dai->id) {\n\tcase DA732X_DAI_ID1:\n\t\treg_aif1 = DA732X_REG_AIFA1;\n\t\treg_aif3 = DA732X_REG_AIFA3;\n\t\tpc_count = DA732X_PC_PULSE_AIFA | DA732X_PC_RESYNC_NOT_AUT |\n\t\t\t   DA732X_PC_SAME;\n\t\tbreak;\n\tcase DA732X_DAI_ID2:\n\t\treg_aif1 = DA732X_REG_AIFB1;\n\t\treg_aif3 = DA732X_REG_AIFB3;\n\t\tpc_count = DA732X_PC_PULSE_AIFB | DA732X_PC_RESYNC_NOT_AUT |\n\t\t\t   DA732X_PC_SAME;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tswitch (fmt & SND_SOC_DAIFMT_MASTER_MASK) {\n\tcase SND_SOC_DAIFMT_CBS_CFS:\n\t\taif1 = DA732X_AIF_SLAVE;\n\t\taif_mclk = DA732X_AIFM_FRAME_64 | DA732X_AIFM_SRC_SEL_AIFA;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_CBM_CFM:\n\t\taif1 = DA732X_AIF_CLK_FROM_SRC;\n\t\taif_mclk = DA732X_CLK_GENERATION_AIF_A;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tswitch (fmt & SND_SOC_DAIFMT_FORMAT_MASK) {\n\tcase SND_SOC_DAIFMT_I2S:\n\t\taif3 = DA732X_AIF_I2S_MODE;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_RIGHT_J:\n\t\taif3 = DA732X_AIF_RIGHT_J_MODE;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_LEFT_J:\n\t\taif3 = DA732X_AIF_LEFT_J_MODE;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_DSP_B:\n\t\taif3 = DA732X_AIF_DSP_MODE;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\t \n\tswitch (fmt & SND_SOC_DAIFMT_FORMAT_MASK) {\n\tcase SND_SOC_DAIFMT_DSP_B:\n\t\tswitch (fmt & SND_SOC_DAIFMT_INV_MASK) {\n\t\tcase SND_SOC_DAIFMT_NB_NF:\n\t\t\tbreak;\n\t\tcase SND_SOC_DAIFMT_IB_NF:\n\t\t\taif3 |= DA732X_AIF_BCLK_INV;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn -EINVAL;\n\t\t}\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_I2S:\n\tcase SND_SOC_DAIFMT_RIGHT_J:\n\tcase SND_SOC_DAIFMT_LEFT_J:\n\t\tswitch (fmt & SND_SOC_DAIFMT_INV_MASK) {\n\t\tcase SND_SOC_DAIFMT_NB_NF:\n\t\t\tbreak;\n\t\tcase SND_SOC_DAIFMT_IB_IF:\n\t\t\taif3 |= DA732X_AIF_BCLK_INV | DA732X_AIF_WCLK_INV;\n\t\t\tbreak;\n\t\tcase SND_SOC_DAIFMT_IB_NF:\n\t\t\taif3 |= DA732X_AIF_BCLK_INV;\n\t\t\tbreak;\n\t\tcase SND_SOC_DAIFMT_NB_IF:\n\t\t\taif3 |= DA732X_AIF_WCLK_INV;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn -EINVAL;\n\t\t}\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tsnd_soc_component_write(component, DA732X_REG_AIF_MCLK, aif_mclk);\n\tsnd_soc_component_update_bits(component, reg_aif1, DA732X_AIF1_CLK_MASK, aif1);\n\tsnd_soc_component_update_bits(component, reg_aif3, DA732X_AIF_BCLK_INV |\n\t\t\t    DA732X_AIF_WCLK_INV | DA732X_AIF_MODE_MASK, aif3);\n\tsnd_soc_component_write(component, DA732X_REG_PC_CTRL, pc_count);\n\n\treturn 0;\n}\n\n\n\nstatic int da732x_set_dai_pll(struct snd_soc_component *component, int pll_id,\n\t\t\t      int source, unsigned int freq_in,\n\t\t\t      unsigned int freq_out)\n{\n\tstruct da732x_priv *da732x = snd_soc_component_get_drvdata(component);\n\tint fref, indiv;\n\tu8 div_lo, div_mid, div_hi;\n\tu64 frac_div;\n\n\t \n\tif (freq_out == 0) {\n\t\tsnd_soc_component_update_bits(component, DA732X_REG_PLL_CTRL,\n\t\t\t\t    DA732X_PLL_EN, 0);\n\t\tda732x->pll_en = false;\n\t\treturn 0;\n\t}\n\n\tif (da732x->pll_en)\n\t\treturn -EBUSY;\n\n\tif (source == DA732X_SRCCLK_MCLK) {\n\t\t \n\t\tswitch (da732x->sysclk) {\n\t\tcase 11290000:\n\t\tcase 12288000:\n\t\tcase 22580000:\n\t\tcase 24576000:\n\t\tcase 45160000:\n\t\tcase 49152000:\n\t\t\tsnd_soc_component_write(component, DA732X_REG_PLL_CTRL,\n\t\t\t\t      DA732X_PLL_BYPASS);\n\t\t\treturn 0;\n\t\tdefault:\n\t\t\tdev_err(component->dev,\n\t\t\t\t\"Cannot use PLL Bypass, invalid SYSCLK rate\\n\");\n\t\t\treturn -EINVAL;\n\t\t}\n\t}\n\n\tindiv = da732x_get_input_div(component, da732x->sysclk);\n\tif (indiv < 0)\n\t\treturn indiv;\n\n\tfref = da732x->sysclk / BIT(indiv);\n\tdiv_hi = freq_out / fref;\n\tfrac_div = (u64)(freq_out % fref) * 8192ULL;\n\tdo_div(frac_div, fref);\n\tdiv_mid = (frac_div >> DA732X_1BYTE_SHIFT) & DA732X_U8_MASK;\n\tdiv_lo = (frac_div) & DA732X_U8_MASK;\n\n\tsnd_soc_component_write(component, DA732X_REG_PLL_DIV_LO, div_lo);\n\tsnd_soc_component_write(component, DA732X_REG_PLL_DIV_MID, div_mid);\n\tsnd_soc_component_write(component, DA732X_REG_PLL_DIV_HI, div_hi);\n\n\tsnd_soc_component_update_bits(component, DA732X_REG_PLL_CTRL, DA732X_PLL_EN,\n\t\t\t    DA732X_PLL_EN);\n\n\tda732x->pll_en = true;\n\n\treturn 0;\n}\n\nstatic int da732x_set_dai_sysclk(struct snd_soc_dai *dai, int clk_id,\n\t\t\t\t unsigned int freq, int dir)\n{\n\tstruct snd_soc_component *component = dai->component;\n\tstruct da732x_priv *da732x = snd_soc_component_get_drvdata(component);\n\n\tda732x->sysclk = freq;\n\n\treturn 0;\n}\n\n#define DA732X_RATES\tSNDRV_PCM_RATE_8000_96000\n\n#define\tDA732X_FORMATS (SNDRV_PCM_FMTBIT_S16_LE | SNDRV_PCM_FMTBIT_S20_3LE | \\\n\t\t\tSNDRV_PCM_FMTBIT_S24_LE | SNDRV_PCM_FMTBIT_S32_LE)\n\nstatic const struct snd_soc_dai_ops da732x_dai_ops = {\n\t.hw_params\t= da732x_hw_params,\n\t.set_fmt\t= da732x_set_dai_fmt,\n\t.set_sysclk\t= da732x_set_dai_sysclk,\n};\n\nstatic struct snd_soc_dai_driver da732x_dai[] = {\n\t{\n\t\t.name\t= \"DA732X_AIFA\",\n\t\t.id\t= DA732X_DAI_ID1,\n\t\t.base\t= DA732X_REG_AIFA1,\n\t\t.playback = {\n\t\t\t.stream_name = \"AIFA Playback\",\n\t\t\t.channels_min = 1,\n\t\t\t.channels_max = 2,\n\t\t\t.rates = DA732X_RATES,\n\t\t\t.formats = DA732X_FORMATS,\n\t\t},\n\t\t.capture = {\n\t\t\t.stream_name = \"AIFA Capture\",\n\t\t\t.channels_min = 1,\n\t\t\t.channels_max = 2,\n\t\t\t.rates = DA732X_RATES,\n\t\t\t.formats = DA732X_FORMATS,\n\t\t},\n\t\t.ops = &da732x_dai_ops,\n\t},\n\t{\n\t\t.name\t= \"DA732X_AIFB\",\n\t\t.id\t= DA732X_DAI_ID2,\n\t\t.base\t= DA732X_REG_AIFB1,\n\t\t.playback = {\n\t\t\t.stream_name = \"AIFB Playback\",\n\t\t\t.channels_min = 1,\n\t\t\t.channels_max = 2,\n\t\t\t.rates = DA732X_RATES,\n\t\t\t.formats = DA732X_FORMATS,\n\t\t},\n\t\t.capture = {\n\t\t\t.stream_name = \"AIFB Capture\",\n\t\t\t.channels_min = 1,\n\t\t\t.channels_max = 2,\n\t\t\t.rates = DA732X_RATES,\n\t\t\t.formats = DA732X_FORMATS,\n\t\t},\n\t\t.ops = &da732x_dai_ops,\n\t},\n};\n\nstatic bool da732x_volatile(struct device *dev, unsigned int reg)\n{\n\tswitch (reg) {\n\tcase DA732X_REG_HPL_DAC_OFF_CNTL:\n\tcase DA732X_REG_HPR_DAC_OFF_CNTL:\n\t\treturn true;\n\tdefault:\n\t\treturn false;\n\t}\n}\n\nstatic const struct regmap_config da732x_regmap = {\n\t.reg_bits\t\t= 8,\n\t.val_bits\t\t= 8,\n\n\t.max_register\t\t= DA732X_MAX_REG,\n\t.volatile_reg\t\t= da732x_volatile,\n\t.reg_defaults\t\t= da732x_reg_cache,\n\t.num_reg_defaults\t= ARRAY_SIZE(da732x_reg_cache),\n\t.cache_type\t\t= REGCACHE_RBTREE,\n};\n\n\nstatic void da732x_dac_offset_adjust(struct snd_soc_component *component)\n{\n\tu8 offset[DA732X_HP_DACS];\n\tu8 sign[DA732X_HP_DACS];\n\tu8 step = DA732X_DAC_OFFSET_STEP;\n\n\t \n\tsnd_soc_component_write(component, DA732X_REG_HPL_DAC_OFFSET,\n\t\t      DA732X_HP_DAC_OFFSET_TRIM_VAL);\n\tsnd_soc_component_write(component, DA732X_REG_HPR_DAC_OFFSET,\n\t\t      DA732X_HP_DAC_OFFSET_TRIM_VAL);\n\tsnd_soc_component_write(component, DA732X_REG_HPL_DAC_OFF_CNTL,\n\t\t      DA732X_HP_DAC_OFF_CALIBRATION |\n\t\t      DA732X_HP_DAC_OFF_SCALE_STEPS);\n\tsnd_soc_component_write(component, DA732X_REG_HPR_DAC_OFF_CNTL,\n\t\t      DA732X_HP_DAC_OFF_CALIBRATION |\n\t\t      DA732X_HP_DAC_OFF_SCALE_STEPS);\n\n\t \n\tmsleep(DA732X_WAIT_FOR_STABILIZATION);\n\n\t \n\tsign[DA732X_HPL_DAC] = (snd_soc_component_read(component, DA732X_REG_HPL_DAC_OFF_CNTL) &\n\t\t\t\tDA732X_HP_DAC_OFF_CNTL_COMPO);\n\tsign[DA732X_HPR_DAC] = (snd_soc_component_read(component, DA732X_REG_HPR_DAC_OFF_CNTL) &\n\t\t\t\tDA732X_HP_DAC_OFF_CNTL_COMPO);\n\n\t \n\toffset[DA732X_HPL_DAC] = sign[DA732X_HPL_DAC] << DA732X_HP_DAC_COMPO_SHIFT;\n\toffset[DA732X_HPR_DAC] = sign[DA732X_HPR_DAC] << DA732X_HP_DAC_COMPO_SHIFT;\n\n\tdo {\n\t\toffset[DA732X_HPL_DAC] |= step;\n\t\toffset[DA732X_HPR_DAC] |= step;\n\t\tsnd_soc_component_write(component, DA732X_REG_HPL_DAC_OFFSET,\n\t\t\t      ~offset[DA732X_HPL_DAC] & DA732X_HP_DAC_OFF_MASK);\n\t\tsnd_soc_component_write(component, DA732X_REG_HPR_DAC_OFFSET,\n\t\t\t      ~offset[DA732X_HPR_DAC] & DA732X_HP_DAC_OFF_MASK);\n\n\t\tmsleep(DA732X_WAIT_FOR_STABILIZATION);\n\n\t\tif ((snd_soc_component_read(component, DA732X_REG_HPL_DAC_OFF_CNTL) &\n\t\t     DA732X_HP_DAC_OFF_CNTL_COMPO) ^ sign[DA732X_HPL_DAC])\n\t\t\toffset[DA732X_HPL_DAC] &= ~step;\n\t\tif ((snd_soc_component_read(component, DA732X_REG_HPR_DAC_OFF_CNTL) &\n\t\t     DA732X_HP_DAC_OFF_CNTL_COMPO) ^ sign[DA732X_HPR_DAC])\n\t\t\toffset[DA732X_HPR_DAC] &= ~step;\n\n\t\tstep >>= 1;\n\t} while (step);\n\n\t \n\tsnd_soc_component_write(component, DA732X_REG_HPL_DAC_OFFSET,\n\t\t      ~offset[DA732X_HPL_DAC] &\tDA732X_HP_DAC_OFF_MASK);\n\tsnd_soc_component_write(component, DA732X_REG_HPR_DAC_OFFSET,\n\t\t      ~offset[DA732X_HPR_DAC] &\tDA732X_HP_DAC_OFF_MASK);\n\n\t \n\tsnd_soc_component_write(component, DA732X_REG_HPL_DAC_OFF_CNTL,\n\t\tDA732X_HP_DAC_OFF_SCALE_STEPS);\n\tsnd_soc_component_write(component, DA732X_REG_HPR_DAC_OFF_CNTL,\n\t\tDA732X_HP_DAC_OFF_SCALE_STEPS);\n}\n\nstatic void da732x_output_offset_adjust(struct snd_soc_component *component)\n{\n\tu8 offset[DA732X_HP_AMPS];\n\tu8 sign[DA732X_HP_AMPS];\n\tu8 step = DA732X_OUTPUT_OFFSET_STEP;\n\n\toffset[DA732X_HPL_AMP] = DA732X_HP_OUT_TRIM_VAL;\n\toffset[DA732X_HPR_AMP] = DA732X_HP_OUT_TRIM_VAL;\n\n\t \n\tsnd_soc_component_write(component, DA732X_REG_HPL_OUT_OFFSET, DA732X_HP_OUT_TRIM_VAL);\n\tsnd_soc_component_write(component, DA732X_REG_HPR_OUT_OFFSET, DA732X_HP_OUT_TRIM_VAL);\n\tsnd_soc_component_write(component, DA732X_REG_HPL,\n\t\t      DA732X_HP_OUT_COMP | DA732X_HP_OUT_EN);\n\tsnd_soc_component_write(component, DA732X_REG_HPR,\n\t\t      DA732X_HP_OUT_COMP | DA732X_HP_OUT_EN);\n\n\t \n\tmsleep(DA732X_WAIT_FOR_STABILIZATION);\n\n\t \n\tsign[DA732X_HPL_AMP] = snd_soc_component_read(component, DA732X_REG_HPL) &\n\t\t\t       DA732X_HP_OUT_COMPO;\n\tsign[DA732X_HPR_AMP] = snd_soc_component_read(component, DA732X_REG_HPR) &\n\t\t\t       DA732X_HP_OUT_COMPO;\n\n\tsnd_soc_component_write(component, DA732X_REG_HPL, DA732X_HP_OUT_COMP |\n\t\t      (sign[DA732X_HPL_AMP] >> DA732X_HP_OUT_COMPO_SHIFT) |\n\t\t      DA732X_HP_OUT_EN);\n\tsnd_soc_component_write(component, DA732X_REG_HPR, DA732X_HP_OUT_COMP |\n\t\t      (sign[DA732X_HPR_AMP] >> DA732X_HP_OUT_COMPO_SHIFT) |\n\t\t      DA732X_HP_OUT_EN);\n\n\t \n\tdo {\n\t\toffset[DA732X_HPL_AMP] |= step;\n\t\toffset[DA732X_HPR_AMP] |= step;\n\t\tsnd_soc_component_write(component, DA732X_REG_HPL_OUT_OFFSET,\n\t\t\t      offset[DA732X_HPL_AMP]);\n\t\tsnd_soc_component_write(component, DA732X_REG_HPR_OUT_OFFSET,\n\t\t\t      offset[DA732X_HPR_AMP]);\n\n\t\tmsleep(DA732X_WAIT_FOR_STABILIZATION);\n\n\t\tif ((snd_soc_component_read(component, DA732X_REG_HPL) &\n\t\t     DA732X_HP_OUT_COMPO) ^ sign[DA732X_HPL_AMP])\n\t\t\toffset[DA732X_HPL_AMP] &= ~step;\n\t\tif ((snd_soc_component_read(component, DA732X_REG_HPR) &\n\t\t     DA732X_HP_OUT_COMPO) ^ sign[DA732X_HPR_AMP])\n\t\t\toffset[DA732X_HPR_AMP] &= ~step;\n\n\t\tstep >>= 1;\n\t} while (step);\n\n\t \n\tsnd_soc_component_write(component, DA732X_REG_HPL_OUT_OFFSET, offset[DA732X_HPL_AMP]);\n\tsnd_soc_component_write(component, DA732X_REG_HPR_OUT_OFFSET, offset[DA732X_HPR_AMP]);\n}\n\nstatic void da732x_hp_dc_offset_cancellation(struct snd_soc_component *component)\n{\n\t \n\tsnd_soc_component_write(component, DA732X_REG_DAC1_SOFTMUTE, DA732X_SOFTMUTE_EN |\n\t\t      DA732X_GAIN_RAMPED | DA732X_16_SAMPLES);\n\tsnd_soc_component_write(component, DA732X_REG_DAC1_SEL, DA732X_DACL_EN |\n\t\t      DA732X_DACR_EN | DA732X_DACL_SDM | DA732X_DACR_SDM |\n\t\t      DA732X_DACL_MUTE | DA732X_DACR_MUTE);\n\tsnd_soc_component_write(component, DA732X_REG_HPL, DA732X_HP_OUT_DAC_EN |\n\t\t      DA732X_HP_OUT_MUTE | DA732X_HP_OUT_EN);\n\tsnd_soc_component_write(component, DA732X_REG_HPR, DA732X_HP_OUT_EN |\n\t\t      DA732X_HP_OUT_MUTE | DA732X_HP_OUT_DAC_EN);\n\n\tda732x_dac_offset_adjust(component);\n\tda732x_output_offset_adjust(component);\n\n\tsnd_soc_component_write(component, DA732X_REG_DAC1_SEL, DA732X_DACS_DIS);\n\tsnd_soc_component_write(component, DA732X_REG_HPL, DA732X_HP_DIS);\n\tsnd_soc_component_write(component, DA732X_REG_HPR, DA732X_HP_DIS);\n}\n\nstatic int da732x_set_bias_level(struct snd_soc_component *component,\n\t\t\t\t enum snd_soc_bias_level level)\n{\n\tstruct da732x_priv *da732x = snd_soc_component_get_drvdata(component);\n\n\tswitch (level) {\n\tcase SND_SOC_BIAS_ON:\n\t\tsnd_soc_component_update_bits(component, DA732X_REG_BIAS_EN,\n\t\t\t\t    DA732X_BIAS_BOOST_MASK,\n\t\t\t\t    DA732X_BIAS_BOOST_100PC);\n\t\tbreak;\n\tcase SND_SOC_BIAS_PREPARE:\n\t\tbreak;\n\tcase SND_SOC_BIAS_STANDBY:\n\t\tif (snd_soc_component_get_bias_level(component) == SND_SOC_BIAS_OFF) {\n\t\t\t \n\t\t\tsnd_soc_component_write(component, DA732X_REG_REF1,\n\t\t\t\t      DA732X_VMID_FASTCHG);\n\t\t\tsnd_soc_component_write(component, DA732X_REG_BIAS_EN,\n\t\t\t\t      DA732X_BIAS_EN);\n\n\t\t\tmdelay(DA732X_STARTUP_DELAY);\n\n\t\t\t \n\t\t\tsnd_soc_component_write(component, DA732X_REG_REF1,\n\t\t\t\t      DA732X_REFBUFX2_EN);\n\n\t\t\t \n\t\t\tsnd_soc_component_write(component, DA732X_REG_DATA_ROUTE,\n\t\t\t\t      DA732X_BYPASS_DSP);\n\n\t\t\t \n\t\t\tsnd_soc_component_write(component, DA732X_REG_DSP_CTRL,\n\t\t\t\t      DA732X_DIGITAL_EN);\n\n\t\t\tsnd_soc_component_write(component, DA732X_REG_SPARE1_OUT,\n\t\t\t\t      DA732X_HP_DRIVER_EN |\n\t\t\t\t      DA732X_HP_GATE_LOW |\n\t\t\t\t      DA732X_HP_LOOP_GAIN_CTRL);\n\t\t\tsnd_soc_component_write(component, DA732X_REG_HP_LIN1_GNDSEL,\n\t\t\t\t      DA732X_HP_OUT_GNDSEL);\n\n\t\t\tda732x_set_charge_pump(component, DA732X_ENABLE_CP);\n\n\t\t\tsnd_soc_component_write(component, DA732X_REG_CLK_EN1,\n\t\t\t      DA732X_SYS3_CLK_EN | DA732X_PC_CLK_EN);\n\n\t\t\t \n\t\t\tsnd_soc_component_write(component, DA732X_REG_INP_ZC_EN,\n\t\t\t\t      DA732X_MIC1_PRE_ZC_EN |\n\t\t\t\t      DA732X_MIC1_ZC_EN |\n\t\t\t\t      DA732X_MIC2_PRE_ZC_EN |\n\t\t\t\t      DA732X_MIC2_ZC_EN |\n\t\t\t\t      DA732X_AUXL_ZC_EN |\n\t\t\t\t      DA732X_AUXR_ZC_EN |\n\t\t\t\t      DA732X_MIC3_PRE_ZC_EN |\n\t\t\t\t      DA732X_MIC3_ZC_EN);\n\t\t\tsnd_soc_component_write(component, DA732X_REG_OUT_ZC_EN,\n\t\t\t\t      DA732X_HPL_ZC_EN | DA732X_HPR_ZC_EN |\n\t\t\t\t      DA732X_LIN2_ZC_EN | DA732X_LIN3_ZC_EN |\n\t\t\t\t      DA732X_LIN4_ZC_EN);\n\n\t\t\tda732x_hp_dc_offset_cancellation(component);\n\n\t\t\tregcache_cache_only(da732x->regmap, false);\n\t\t\tregcache_sync(da732x->regmap);\n\t\t} else {\n\t\t\tsnd_soc_component_update_bits(component, DA732X_REG_BIAS_EN,\n\t\t\t\t\t    DA732X_BIAS_BOOST_MASK,\n\t\t\t\t\t    DA732X_BIAS_BOOST_50PC);\n\t\t\tsnd_soc_component_update_bits(component, DA732X_REG_PLL_CTRL,\n\t\t\t\t\t    DA732X_PLL_EN, 0);\n\t\t\tda732x->pll_en = false;\n\t\t}\n\t\tbreak;\n\tcase SND_SOC_BIAS_OFF:\n\t\tregcache_cache_only(da732x->regmap, true);\n\t\tda732x_set_charge_pump(component, DA732X_DISABLE_CP);\n\t\tsnd_soc_component_update_bits(component, DA732X_REG_BIAS_EN, DA732X_BIAS_EN,\n\t\t\t\t    DA732X_BIAS_DIS);\n\t\tda732x->pll_en = false;\n\t\tbreak;\n\t}\n\n\treturn 0;\n}\n\nstatic const struct snd_soc_component_driver soc_component_dev_da732x = {\n\t.set_bias_level\t\t= da732x_set_bias_level,\n\t.controls\t\t= da732x_snd_controls,\n\t.num_controls\t\t= ARRAY_SIZE(da732x_snd_controls),\n\t.dapm_widgets\t\t= da732x_dapm_widgets,\n\t.num_dapm_widgets\t= ARRAY_SIZE(da732x_dapm_widgets),\n\t.dapm_routes\t\t= da732x_dapm_routes,\n\t.num_dapm_routes\t= ARRAY_SIZE(da732x_dapm_routes),\n\t.set_pll\t\t= da732x_set_dai_pll,\n\t.idle_bias_on\t\t= 1,\n\t.use_pmdown_time\t= 1,\n\t.endianness\t\t= 1,\n};\n\nstatic int da732x_i2c_probe(struct i2c_client *i2c)\n{\n\tstruct da732x_priv *da732x;\n\tunsigned int reg;\n\tint ret;\n\n\tda732x = devm_kzalloc(&i2c->dev, sizeof(struct da732x_priv),\n\t\t\t      GFP_KERNEL);\n\tif (!da732x)\n\t\treturn -ENOMEM;\n\n\ti2c_set_clientdata(i2c, da732x);\n\n\tda732x->regmap = devm_regmap_init_i2c(i2c, &da732x_regmap);\n\tif (IS_ERR(da732x->regmap)) {\n\t\tret = PTR_ERR(da732x->regmap);\n\t\tdev_err(&i2c->dev, \"Failed to initialize regmap\\n\");\n\t\tgoto err;\n\t}\n\n\tret = regmap_read(da732x->regmap, DA732X_REG_ID, &reg);\n\tif (ret < 0) {\n\t\tdev_err(&i2c->dev, \"Failed to read ID register: %d\\n\", ret);\n\t\tgoto err;\n\t}\n\n\tdev_info(&i2c->dev, \"Revision: %d.%d\\n\",\n\t\t (reg & DA732X_ID_MAJOR_MASK) >> 4,\n\t\t (reg & DA732X_ID_MINOR_MASK));\n\n\tret = devm_snd_soc_register_component(&i2c->dev,\n\t\t\t\t     &soc_component_dev_da732x,\n\t\t\t\t     da732x_dai, ARRAY_SIZE(da732x_dai));\n\tif (ret != 0)\n\t\tdev_err(&i2c->dev, \"Failed to register component.\\n\");\n\nerr:\n\treturn ret;\n}\n\nstatic const struct i2c_device_id da732x_i2c_id[] = {\n\t{ \"da7320\", 0},\n\t{ }\n};\nMODULE_DEVICE_TABLE(i2c, da732x_i2c_id);\n\nstatic struct i2c_driver da732x_i2c_driver = {\n\t.driver\t\t= {\n\t\t.name\t= \"da7320\",\n\t},\n\t.probe\t\t= da732x_i2c_probe,\n\t.id_table\t= da732x_i2c_id,\n};\n\nmodule_i2c_driver(da732x_i2c_driver);\n\n\nMODULE_DESCRIPTION(\"ASoC DA732X driver\");\nMODULE_AUTHOR(\"Michal Hajduk <michal.hajduk@diasemi.com>\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}