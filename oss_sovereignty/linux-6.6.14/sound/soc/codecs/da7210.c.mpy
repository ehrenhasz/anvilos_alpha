{
  "module_name": "da7210.c",
  "hash_id": "3f307e534846c56109b705ad191db2d568d286aca4adbfcfb563fe9d772f1279",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/codecs/da7210.c",
  "human_readable_source": "\n\n\n\n\n\n\n\n\n\n\n\n#include <linux/delay.h>\n#include <linux/i2c.h>\n#include <linux/spi/spi.h>\n#include <linux/regmap.h>\n#include <linux/slab.h>\n#include <linux/module.h>\n#include <sound/pcm.h>\n#include <sound/pcm_params.h>\n#include <sound/soc.h>\n#include <sound/initval.h>\n#include <sound/tlv.h>\n\n \n#define DA7210_PAGE_CONTROL\t\t0x00\n#define DA7210_CONTROL\t\t\t0x01\n#define DA7210_STATUS\t\t\t0x02\n#define DA7210_STARTUP1\t\t\t0x03\n#define DA7210_STARTUP2\t\t\t0x04\n#define DA7210_STARTUP3\t\t\t0x05\n#define DA7210_MIC_L\t\t\t0x07\n#define DA7210_MIC_R\t\t\t0x08\n#define DA7210_AUX1_L\t\t\t0x09\n#define DA7210_AUX1_R\t\t\t0x0A\n#define DA7210_AUX2\t\t\t0x0B\n#define DA7210_IN_GAIN\t\t\t0x0C\n#define DA7210_INMIX_L\t\t\t0x0D\n#define DA7210_INMIX_R\t\t\t0x0E\n#define DA7210_ADC_HPF\t\t\t0x0F\n#define DA7210_ADC\t\t\t0x10\n#define DA7210_ADC_EQ1_2\t\t0X11\n#define DA7210_ADC_EQ3_4\t\t0x12\n#define DA7210_ADC_EQ5\t\t\t0x13\n#define DA7210_DAC_HPF\t\t\t0x14\n#define DA7210_DAC_L\t\t\t0x15\n#define DA7210_DAC_R\t\t\t0x16\n#define DA7210_DAC_SEL\t\t\t0x17\n#define DA7210_SOFTMUTE\t\t\t0x18\n#define DA7210_DAC_EQ1_2\t\t0x19\n#define DA7210_DAC_EQ3_4\t\t0x1A\n#define DA7210_DAC_EQ5\t\t\t0x1B\n#define DA7210_OUTMIX_L\t\t\t0x1C\n#define DA7210_OUTMIX_R\t\t\t0x1D\n#define DA7210_OUT1_L\t\t\t0x1E\n#define DA7210_OUT1_R\t\t\t0x1F\n#define DA7210_OUT2\t\t\t0x20\n#define DA7210_HP_L_VOL\t\t\t0x21\n#define DA7210_HP_R_VOL\t\t\t0x22\n#define DA7210_HP_CFG\t\t\t0x23\n#define DA7210_ZERO_CROSS\t\t0x24\n#define DA7210_DAI_SRC_SEL\t\t0x25\n#define DA7210_DAI_CFG1\t\t\t0x26\n#define DA7210_DAI_CFG3\t\t\t0x28\n#define DA7210_PLL_DIV1\t\t\t0x29\n#define DA7210_PLL_DIV2\t\t\t0x2A\n#define DA7210_PLL_DIV3\t\t\t0x2B\n#define DA7210_PLL\t\t\t0x2C\n#define DA7210_ALC_MAX\t\t\t0x83\n#define DA7210_ALC_MIN\t\t\t0x84\n#define DA7210_ALC_NOIS\t\t\t0x85\n#define DA7210_ALC_ATT\t\t\t0x86\n#define DA7210_ALC_REL\t\t\t0x87\n#define DA7210_ALC_DEL\t\t\t0x88\n#define DA7210_A_HID_UNLOCK\t\t0x8A\n#define DA7210_A_TEST_UNLOCK\t\t0x8B\n#define DA7210_A_PLL1\t\t\t0x90\n#define DA7210_A_CP_MODE\t\t0xA7\n\n \n#define DA7210_SC_MST_EN\t\t(1 << 0)\n\n \n#define DA7210_MICBIAS_EN\t\t(1 << 6)\n#define DA7210_MIC_L_EN\t\t\t(1 << 7)\n\n \n#define DA7210_MIC_R_EN\t\t\t(1 << 7)\n\n \n#define DA7210_IN_L_EN\t\t\t(1 << 7)\n\n \n#define DA7210_IN_R_EN\t\t\t(1 << 7)\n\n \n#define DA7210_ADC_ALC_EN\t\t(1 << 0)\n#define DA7210_ADC_L_EN\t\t\t(1 << 3)\n#define DA7210_ADC_R_EN\t\t\t(1 << 7)\n\n \n#define DA7210_VOICE_F0_MASK\t\t(0x7 << 4)\n#define DA7210_VOICE_F0_25\t\t(1 << 4)\n#define DA7210_VOICE_EN\t\t\t(1 << 7)\n\n \n#define DA7210_DAC_L_SRC_DAI_L\t\t(4 << 0)\n#define DA7210_DAC_L_EN\t\t\t(1 << 3)\n#define DA7210_DAC_R_SRC_DAI_R\t\t(5 << 4)\n#define DA7210_DAC_R_EN\t\t\t(1 << 7)\n\n \n#define DA7210_OUT_L_EN\t\t\t(1 << 7)\n\n \n#define DA7210_OUT_R_EN\t\t\t(1 << 7)\n\n \n#define DA7210_HP_2CAP_MODE\t\t(1 << 1)\n#define DA7210_HP_SENSE_EN\t\t(1 << 2)\n#define DA7210_HP_L_EN\t\t\t(1 << 3)\n#define DA7210_HP_MODE\t\t\t(1 << 6)\n#define DA7210_HP_R_EN\t\t\t(1 << 7)\n\n \n#define DA7210_DAI_OUT_L_SRC\t\t(6 << 0)\n#define DA7210_DAI_OUT_R_SRC\t\t(7 << 4)\n\n \n#define DA7210_DAI_WORD_S16_LE\t\t(0 << 0)\n#define DA7210_DAI_WORD_S20_3LE\t\t(1 << 0)\n#define DA7210_DAI_WORD_S24_LE\t\t(2 << 0)\n#define DA7210_DAI_WORD_S32_LE\t\t(3 << 0)\n#define DA7210_DAI_FLEN_64BIT\t\t(1 << 2)\n#define DA7210_DAI_MODE_SLAVE\t\t(0 << 7)\n#define DA7210_DAI_MODE_MASTER\t\t(1 << 7)\n\n \n#define DA7210_DAI_FORMAT_I2SMODE\t(0 << 0)\n#define DA7210_DAI_FORMAT_LEFT_J\t(1 << 0)\n#define DA7210_DAI_FORMAT_RIGHT_J\t(2 << 0)\n#define DA7210_DAI_OE\t\t\t(1 << 3)\n#define DA7210_DAI_EN\t\t\t(1 << 7)\n\n \n#define DA7210_PLL_DIV_L_MASK\t\t(0xF << 0)\n#define DA7210_MCLK_RANGE_10_20_MHZ\t(1 << 4)\n#define DA7210_PLL_BYP\t\t\t(1 << 6)\n\n \n#define DA7210_PLL_FS_MASK\t\t(0xF << 0)\n#define DA7210_PLL_FS_8000\t\t(0x1 << 0)\n#define DA7210_PLL_FS_11025\t\t(0x2 << 0)\n#define DA7210_PLL_FS_12000\t\t(0x3 << 0)\n#define DA7210_PLL_FS_16000\t\t(0x5 << 0)\n#define DA7210_PLL_FS_22050\t\t(0x6 << 0)\n#define DA7210_PLL_FS_24000\t\t(0x7 << 0)\n#define DA7210_PLL_FS_32000\t\t(0x9 << 0)\n#define DA7210_PLL_FS_44100\t\t(0xA << 0)\n#define DA7210_PLL_FS_48000\t\t(0xB << 0)\n#define DA7210_PLL_FS_88200\t\t(0xE << 0)\n#define DA7210_PLL_FS_96000\t\t(0xF << 0)\n#define DA7210_MCLK_DET_EN\t\t(0x1 << 5)\n#define DA7210_MCLK_SRM_EN\t\t(0x1 << 6)\n#define DA7210_PLL_EN\t\t\t(0x1 << 7)\n\n \n#define DA7210_RAMP_EN\t\t\t(1 << 6)\n\n \n#define DA7210_REG_EN\t\t\t(1 << 0)\n#define DA7210_BIAS_EN\t\t\t(1 << 2)\n#define DA7210_NOISE_SUP_EN\t\t(1 << 3)\n\n \n#define DA7210_INPGA_L_VOL\t\t(0x0F << 0)\n#define DA7210_INPGA_R_VOL\t\t(0xF0 << 0)\n\n \n#define DA7210_AUX1_L_ZC\t\t(1 << 0)\n#define DA7210_AUX1_R_ZC\t\t(1 << 1)\n#define DA7210_HP_L_ZC\t\t\t(1 << 6)\n#define DA7210_HP_R_ZC\t\t\t(1 << 7)\n\n \n#define DA7210_AUX1_L_VOL\t\t(0x3F << 0)\n#define DA7210_AUX1_L_EN\t\t(1 << 7)\n\n \n#define DA7210_AUX1_R_VOL\t\t(0x3F << 0)\n#define DA7210_AUX1_R_EN\t\t(1 << 7)\n\n \n#define DA7210_AUX2_EN\t\t\t(1 << 3)\n\n \n#define DA7210_INPGA_MIN_VOL_NS\t\t0x0A   \n#define DA7210_AUX1_MIN_VOL_NS\t\t0x35   \n\n \n#define DA7210_OUT1_L_EN\t\t(1 << 7)\n\n \n#define DA7210_OUT1_R_EN\t\t(1 << 7)\n\n \n#define DA7210_OUT2_OUTMIX_R\t\t(1 << 5)\n#define DA7210_OUT2_OUTMIX_L\t\t(1 << 6)\n#define DA7210_OUT2_EN\t\t\t(1 << 7)\n\nstruct pll_div {\n\tint fref;\n\tint fout;\n\tu8 div1;\n\tu8 div2;\n\tu8 div3;\n\tu8 mode;\t \n};\n\n \nstatic const struct pll_div da7210_pll_div[] = {\n\t \n\t{ 12000000, 2822400, 0xE8, 0x6C, 0x2, 1},\t \n\t{ 13000000, 2822400, 0xDF, 0x28, 0xC, 1},\t \n\t{ 13500000, 2822400, 0xDB, 0x0A, 0xD, 1},\t \n\t{ 14400000, 2822400, 0xD4, 0x5A, 0x2, 1},\t \n\t{ 19200000, 2822400, 0xBB, 0x43, 0x9, 1},\t \n\t{ 19680000, 2822400, 0xB9, 0x6D, 0xA, 1},\t \n\t{ 19800000, 2822400, 0xB8, 0xFB, 0xB, 1},\t \n\t \n\t{ 12000000, 3072000, 0xF3, 0x12, 0x7, 1},\t \n\t{ 13000000, 3072000, 0xE8, 0xFD, 0x5, 1},\t \n\t{ 13500000, 3072000, 0xE4, 0x82, 0x3, 1},\t \n\t{ 14400000, 3072000, 0xDD, 0x3A, 0x0, 1},\t \n\t{ 19200000, 3072000, 0xC1, 0xEB, 0x8, 1},\t \n\t{ 19680000, 3072000, 0xBF, 0xEC, 0x0, 1},\t \n\t{ 19800000, 3072000, 0xBF, 0x70, 0x0, 1},\t \n\t \n\t{ 12000000, 2822400, 0xED, 0xBF, 0x5, 0},\t \n\t{ 13000000, 2822400, 0xE4, 0x13, 0x0, 0},\t \n\t{ 13500000, 2822400, 0xDF, 0xC6, 0x8, 0},\t \n\t{ 14400000, 2822400, 0xD8, 0xCA, 0x1, 0},\t \n\t{ 19200000, 2822400, 0xBE, 0x97, 0x9, 0},\t \n\t{ 19680000, 2822400, 0xBC, 0xAC, 0xD, 0},\t \n\t{ 19800000, 2822400, 0xBC, 0x35, 0xE, 0},\t \n};\n\nenum clk_src {\n\tDA7210_CLKSRC_MCLK\n};\n\n#define DA7210_VERSION \"0.0.1\"\n\n \nstatic const DECLARE_TLV_DB_RANGE(hp_out_tlv,\n\t0x0, 0x10, TLV_DB_SCALE_ITEM(TLV_DB_GAIN_MUTE, 0, 1),\n\t \n\t0x11, 0x3f, TLV_DB_SCALE_ITEM(-5400, 150, 0)\n);\n\nstatic const DECLARE_TLV_DB_RANGE(lineout_vol_tlv,\n\t0x0, 0x10, TLV_DB_SCALE_ITEM(TLV_DB_GAIN_MUTE, 0, 1),\n\t \n\t0x11, 0x3f, TLV_DB_SCALE_ITEM(-5400, 150, 0)\n);\n\nstatic const DECLARE_TLV_DB_RANGE(mono_vol_tlv,\n\t0x0, 0x2, TLV_DB_SCALE_ITEM(-1800, 0, 1),\n\t \n\t0x3, 0x7, TLV_DB_SCALE_ITEM(-1800, 600, 0)\n);\n\nstatic const DECLARE_TLV_DB_RANGE(aux1_vol_tlv,\n\t0x0, 0x10, TLV_DB_SCALE_ITEM(TLV_DB_GAIN_MUTE, 0, 1),\n\t \n\t0x11, 0x3f, TLV_DB_SCALE_ITEM(-4800, 150, 0)\n);\n\nstatic const DECLARE_TLV_DB_SCALE(eq_gain_tlv, -1050, 150, 0);\nstatic const DECLARE_TLV_DB_SCALE(adc_eq_master_gain_tlv, -1800, 600, 1);\nstatic const DECLARE_TLV_DB_SCALE(dac_gain_tlv, -7725, 75, 0);\nstatic const DECLARE_TLV_DB_SCALE(mic_vol_tlv, -600, 600, 0);\nstatic const DECLARE_TLV_DB_SCALE(aux2_vol_tlv, -600, 600, 0);\nstatic const DECLARE_TLV_DB_SCALE(inpga_gain_tlv, -450, 150, 0);\n\n \nstatic const char * const da7210_hpf_cutoff_txt[] = {\n\t\"Fs/8192*pi\", \"Fs/4096*pi\", \"Fs/2048*pi\", \"Fs/1024*pi\"\n};\n\nstatic SOC_ENUM_SINGLE_DECL(da7210_dac_hpf_cutoff,\n\t\t\t    DA7210_DAC_HPF, 0, da7210_hpf_cutoff_txt);\n\nstatic SOC_ENUM_SINGLE_DECL(da7210_adc_hpf_cutoff,\n\t\t\t    DA7210_ADC_HPF, 0, da7210_hpf_cutoff_txt);\n\n \nstatic const char * const da7210_vf_cutoff_txt[] = {\n\t\"2.5Hz\", \"25Hz\", \"50Hz\", \"100Hz\", \"150Hz\", \"200Hz\", \"300Hz\", \"400Hz\"\n};\n\nstatic SOC_ENUM_SINGLE_DECL(da7210_dac_vf_cutoff,\n\t\t\t    DA7210_DAC_HPF, 4, da7210_vf_cutoff_txt);\n\nstatic SOC_ENUM_SINGLE_DECL(da7210_adc_vf_cutoff,\n\t\t\t    DA7210_ADC_HPF, 4, da7210_vf_cutoff_txt);\n\nstatic const char *da7210_hp_mode_txt[] = {\n\t\"Class H\", \"Class G\"\n};\n\nstatic SOC_ENUM_SINGLE_DECL(da7210_hp_mode_sel,\n\t\t\t    DA7210_HP_CFG, 0, da7210_hp_mode_txt);\n\n \nstatic int da7210_put_alc_sw(struct snd_kcontrol *kcontrol,\n\t\t\t     struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_soc_component *component = snd_soc_kcontrol_component(kcontrol);\n\n\tif (ucontrol->value.integer.value[0]) {\n\t\t \n\t\tif (snd_soc_component_read(component, DA7210_CONTROL) & DA7210_NOISE_SUP_EN) {\n\t\t\tdev_dbg(component->dev,\n\t\t\t\t\"Disable noise suppression to enable ALC\\n\");\n\t\t\treturn -EINVAL;\n\t\t}\n\t}\n\t \n\treturn snd_soc_put_volsw(kcontrol, ucontrol);\n}\n\n \nstatic int da7210_put_noise_sup_sw(struct snd_kcontrol *kcontrol,\n\t\t\t\t   struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_soc_component *component = snd_soc_kcontrol_component(kcontrol);\n\tu8 val;\n\n\tif (ucontrol->value.integer.value[0]) {\n\t\t \n\t\tif (snd_soc_component_read(component, DA7210_ADC) & DA7210_ADC_ALC_EN)\n\t\t\tgoto err;\n\n\t\t \n\t\tif ((snd_soc_component_read(component, DA7210_ZERO_CROSS) &\n\t\t\t(DA7210_AUX1_L_ZC | DA7210_AUX1_R_ZC | DA7210_HP_L_ZC |\n\t\t\tDA7210_HP_R_ZC)) != (DA7210_AUX1_L_ZC |\n\t\t\tDA7210_AUX1_R_ZC | DA7210_HP_L_ZC | DA7210_HP_R_ZC))\n\t\t\tgoto err;\n\n\t\t \n\t\tval = snd_soc_component_read(component, DA7210_IN_GAIN);\n\t\tif (((val & DA7210_INPGA_L_VOL) < DA7210_INPGA_MIN_VOL_NS) ||\n\t\t\t(((val & DA7210_INPGA_R_VOL) >> 4) <\n\t\t\tDA7210_INPGA_MIN_VOL_NS))\n\t\t\tgoto err;\n\n\t\t \n\t\tif (((snd_soc_component_read(component, DA7210_AUX1_L) & DA7210_AUX1_L_VOL) <\n\t\t    DA7210_AUX1_MIN_VOL_NS) ||\n\t\t    ((snd_soc_component_read(component, DA7210_AUX1_R) & DA7210_AUX1_R_VOL) <\n\t\t    DA7210_AUX1_MIN_VOL_NS))\n\t\t\tgoto err;\n\t}\n\t \n\treturn snd_soc_put_volsw(kcontrol, ucontrol);\n\nerr:\n\treturn -EINVAL;\n}\n\nstatic const struct snd_kcontrol_new da7210_snd_controls[] = {\n\n\tSOC_DOUBLE_R_TLV(\"HeadPhone Playback Volume\",\n\t\t\t DA7210_HP_L_VOL, DA7210_HP_R_VOL,\n\t\t\t 0, 0x3F, 0, hp_out_tlv),\n\tSOC_DOUBLE_R_TLV(\"Digital Playback Volume\",\n\t\t\t DA7210_DAC_L, DA7210_DAC_R,\n\t\t\t 0, 0x77, 1, dac_gain_tlv),\n\tSOC_DOUBLE_R_TLV(\"Lineout Playback Volume\",\n\t\t\t DA7210_OUT1_L, DA7210_OUT1_R,\n\t\t\t 0, 0x3f, 0, lineout_vol_tlv),\n\tSOC_SINGLE_TLV(\"Mono Playback Volume\", DA7210_OUT2, 0, 0x7, 0,\n\t\t       mono_vol_tlv),\n\n\tSOC_DOUBLE_R_TLV(\"Mic Capture Volume\",\n\t\t\t DA7210_MIC_L, DA7210_MIC_R,\n\t\t\t 0, 0x5, 0, mic_vol_tlv),\n\tSOC_DOUBLE_R_TLV(\"Aux1 Capture Volume\",\n\t\t\t DA7210_AUX1_L, DA7210_AUX1_R,\n\t\t\t 0, 0x3f, 0, aux1_vol_tlv),\n\tSOC_SINGLE_TLV(\"Aux2 Capture Volume\", DA7210_AUX2, 0, 0x3, 0,\n\t\t       aux2_vol_tlv),\n\tSOC_DOUBLE_TLV(\"In PGA Capture Volume\", DA7210_IN_GAIN, 0, 4, 0xF, 0,\n\t\t       inpga_gain_tlv),\n\n\t \n\tSOC_SINGLE(\"DAC EQ Switch\", DA7210_DAC_EQ5, 7, 1, 0),\n\tSOC_SINGLE_TLV(\"DAC EQ1 Volume\", DA7210_DAC_EQ1_2, 0, 0xf, 1,\n\t\t       eq_gain_tlv),\n\tSOC_SINGLE_TLV(\"DAC EQ2 Volume\", DA7210_DAC_EQ1_2, 4, 0xf, 1,\n\t\t       eq_gain_tlv),\n\tSOC_SINGLE_TLV(\"DAC EQ3 Volume\", DA7210_DAC_EQ3_4, 0, 0xf, 1,\n\t\t       eq_gain_tlv),\n\tSOC_SINGLE_TLV(\"DAC EQ4 Volume\", DA7210_DAC_EQ3_4, 4, 0xf, 1,\n\t\t       eq_gain_tlv),\n\tSOC_SINGLE_TLV(\"DAC EQ5 Volume\", DA7210_DAC_EQ5, 0, 0xf, 1,\n\t\t       eq_gain_tlv),\n\n\t \n\tSOC_SINGLE(\"ADC EQ Switch\", DA7210_ADC_EQ5, 7, 1, 0),\n\tSOC_SINGLE_TLV(\"ADC EQ Master Volume\", DA7210_ADC_EQ5, 4, 0x3,\n\t\t       1, adc_eq_master_gain_tlv),\n\tSOC_SINGLE_TLV(\"ADC EQ1 Volume\", DA7210_ADC_EQ1_2, 0, 0xf, 1,\n\t\t       eq_gain_tlv),\n\tSOC_SINGLE_TLV(\"ADC EQ2 Volume\", DA7210_ADC_EQ1_2, 4, 0xf, 1,\n\t\t       eq_gain_tlv),\n\tSOC_SINGLE_TLV(\"ADC EQ3 Volume\", DA7210_ADC_EQ3_4, 0, 0xf, 1,\n\t\t       eq_gain_tlv),\n\tSOC_SINGLE_TLV(\"ADC EQ4 Volume\", DA7210_ADC_EQ3_4, 4, 0xf, 1,\n\t\t       eq_gain_tlv),\n\tSOC_SINGLE_TLV(\"ADC EQ5 Volume\", DA7210_ADC_EQ5, 0, 0xf, 1,\n\t\t       eq_gain_tlv),\n\n\tSOC_SINGLE(\"DAC HPF Switch\", DA7210_DAC_HPF, 3, 1, 0),\n\tSOC_ENUM(\"DAC HPF Cutoff\", da7210_dac_hpf_cutoff),\n\tSOC_SINGLE(\"DAC Voice Mode Switch\", DA7210_DAC_HPF, 7, 1, 0),\n\tSOC_ENUM(\"DAC Voice Cutoff\", da7210_dac_vf_cutoff),\n\n\tSOC_SINGLE(\"ADC HPF Switch\", DA7210_ADC_HPF, 3, 1, 0),\n\tSOC_ENUM(\"ADC HPF Cutoff\", da7210_adc_hpf_cutoff),\n\tSOC_SINGLE(\"ADC Voice Mode Switch\", DA7210_ADC_HPF, 7, 1, 0),\n\tSOC_ENUM(\"ADC Voice Cutoff\", da7210_adc_vf_cutoff),\n\n\t \n\tSOC_DOUBLE_R(\"Mic Capture Switch\", DA7210_MIC_L, DA7210_MIC_R, 3, 1, 0),\n\tSOC_SINGLE(\"Aux2 Capture Switch\", DA7210_AUX2, 2, 1, 0),\n\tSOC_DOUBLE(\"ADC Capture Switch\", DA7210_ADC, 2, 6, 1, 0),\n\tSOC_SINGLE(\"Digital Soft Mute Switch\", DA7210_SOFTMUTE, 7, 1, 0),\n\tSOC_SINGLE(\"Digital Soft Mute Rate\", DA7210_SOFTMUTE, 0, 0x7, 0),\n\n\t \n\tSOC_DOUBLE(\"Aux1 ZC Switch\", DA7210_ZERO_CROSS, 0, 1, 1, 0),\n\tSOC_DOUBLE(\"In PGA ZC Switch\", DA7210_ZERO_CROSS, 2, 3, 1, 0),\n\tSOC_DOUBLE(\"Lineout ZC Switch\", DA7210_ZERO_CROSS, 4, 5, 1, 0),\n\tSOC_DOUBLE(\"Headphone ZC Switch\", DA7210_ZERO_CROSS, 6, 7, 1, 0),\n\n\tSOC_ENUM(\"Headphone Class\", da7210_hp_mode_sel),\n\n\t \n\tSOC_SINGLE_EXT(\"ALC Enable Switch\", DA7210_ADC, 0, 1, 0,\n\t\t       snd_soc_get_volsw, da7210_put_alc_sw),\n\tSOC_SINGLE(\"ALC Capture Max Volume\", DA7210_ALC_MAX, 0, 0x3F, 0),\n\tSOC_SINGLE(\"ALC Capture Min Volume\", DA7210_ALC_MIN, 0, 0x3F, 0),\n\tSOC_SINGLE(\"ALC Capture Noise Volume\", DA7210_ALC_NOIS, 0, 0x3F, 0),\n\tSOC_SINGLE(\"ALC Capture Attack Rate\", DA7210_ALC_ATT, 0, 0xFF, 0),\n\tSOC_SINGLE(\"ALC Capture Release Rate\", DA7210_ALC_REL, 0, 0xFF, 0),\n\tSOC_SINGLE(\"ALC Capture Release Delay\", DA7210_ALC_DEL, 0, 0xFF, 0),\n\n\tSOC_SINGLE_EXT(\"Noise Suppression Enable Switch\", DA7210_CONTROL, 3, 1,\n\t\t       0, snd_soc_get_volsw, da7210_put_noise_sup_sw),\n};\n\n \n \nstatic const struct snd_kcontrol_new da7210_dapm_inmixl_controls[] = {\n\tSOC_DAPM_SINGLE(\"Mic Left Switch\", DA7210_INMIX_L, 0, 1, 0),\n\tSOC_DAPM_SINGLE(\"Mic Right Switch\", DA7210_INMIX_L, 1, 1, 0),\n\tSOC_DAPM_SINGLE(\"Aux1 Left Switch\", DA7210_INMIX_L, 2, 1, 0),\n\tSOC_DAPM_SINGLE(\"Aux2 Switch\", DA7210_INMIX_L, 3, 1, 0),\n\tSOC_DAPM_SINGLE(\"Outmix Left Switch\", DA7210_INMIX_L, 4, 1, 0),\n};\n\n \nstatic const struct snd_kcontrol_new da7210_dapm_inmixr_controls[] = {\n\tSOC_DAPM_SINGLE(\"Mic Right Switch\", DA7210_INMIX_R, 0, 1, 0),\n\tSOC_DAPM_SINGLE(\"Mic Left Switch\", DA7210_INMIX_R, 1, 1, 0),\n\tSOC_DAPM_SINGLE(\"Aux1 Right Switch\", DA7210_INMIX_R, 2, 1, 0),\n\tSOC_DAPM_SINGLE(\"Aux2 Switch\", DA7210_INMIX_R, 3, 1, 0),\n\tSOC_DAPM_SINGLE(\"Outmix Right Switch\", DA7210_INMIX_R, 4, 1, 0),\n};\n\n \nstatic const struct snd_kcontrol_new da7210_dapm_outmixl_controls[] = {\n\tSOC_DAPM_SINGLE(\"Aux1 Left Switch\", DA7210_OUTMIX_L, 0, 1, 0),\n\tSOC_DAPM_SINGLE(\"Aux2 Switch\", DA7210_OUTMIX_L, 1, 1, 0),\n\tSOC_DAPM_SINGLE(\"INPGA Left Switch\", DA7210_OUTMIX_L, 2, 1, 0),\n\tSOC_DAPM_SINGLE(\"INPGA Right Switch\", DA7210_OUTMIX_L, 3, 1, 0),\n\tSOC_DAPM_SINGLE(\"DAC Left Switch\", DA7210_OUTMIX_L, 4, 1, 0),\n};\n\n \nstatic const struct snd_kcontrol_new da7210_dapm_outmixr_controls[] = {\n\tSOC_DAPM_SINGLE(\"Aux1 Right Switch\", DA7210_OUTMIX_R, 0, 1, 0),\n\tSOC_DAPM_SINGLE(\"Aux2 Switch\", DA7210_OUTMIX_R, 1, 1, 0),\n\tSOC_DAPM_SINGLE(\"INPGA Left Switch\", DA7210_OUTMIX_R, 2, 1, 0),\n\tSOC_DAPM_SINGLE(\"INPGA Right Switch\", DA7210_OUTMIX_R, 3, 1, 0),\n\tSOC_DAPM_SINGLE(\"DAC Right Switch\", DA7210_OUTMIX_R, 4, 1, 0),\n};\n\n \nstatic const struct snd_kcontrol_new da7210_dapm_monomix_controls[] = {\n\tSOC_DAPM_SINGLE(\"INPGA Right Switch\", DA7210_OUT2, 3, 1, 0),\n\tSOC_DAPM_SINGLE(\"INPGA Left Switch\", DA7210_OUT2, 4, 1, 0),\n\tSOC_DAPM_SINGLE(\"Outmix Right Switch\", DA7210_OUT2, 5, 1, 0),\n\tSOC_DAPM_SINGLE(\"Outmix Left Switch\", DA7210_OUT2, 6, 1, 0),\n};\n\n \nstatic const struct snd_soc_dapm_widget da7210_dapm_widgets[] = {\n\t \n\t \n\tSND_SOC_DAPM_INPUT(\"MICL\"),\n\tSND_SOC_DAPM_INPUT(\"MICR\"),\n\tSND_SOC_DAPM_INPUT(\"AUX1L\"),\n\tSND_SOC_DAPM_INPUT(\"AUX1R\"),\n\tSND_SOC_DAPM_INPUT(\"AUX2\"),\n\n\t \n\tSND_SOC_DAPM_PGA(\"Mic Left\", DA7210_STARTUP3, 0, 1, NULL, 0),\n\tSND_SOC_DAPM_PGA(\"Mic Right\", DA7210_STARTUP3, 1, 1, NULL, 0),\n\tSND_SOC_DAPM_PGA(\"Aux1 Left\", DA7210_STARTUP3, 2, 1, NULL, 0),\n\tSND_SOC_DAPM_PGA(\"Aux1 Right\", DA7210_STARTUP3, 3, 1, NULL, 0),\n\tSND_SOC_DAPM_PGA(\"Aux2 Mono\", DA7210_STARTUP3, 4, 1, NULL, 0),\n\n\tSND_SOC_DAPM_PGA(\"INPGA Left\", DA7210_INMIX_L, 7, 0, NULL, 0),\n\tSND_SOC_DAPM_PGA(\"INPGA Right\", DA7210_INMIX_R, 7, 0, NULL, 0),\n\n\t \n\tSND_SOC_DAPM_SUPPLY(\"Mic Bias\", DA7210_MIC_L, 6, 0, NULL, 0),\n\n\t \n\tSND_SOC_DAPM_MIXER(\"In Mixer Left\", SND_SOC_NOPM, 0, 0,\n\t\t&da7210_dapm_inmixl_controls[0],\n\t\tARRAY_SIZE(da7210_dapm_inmixl_controls)),\n\n\tSND_SOC_DAPM_MIXER(\"In Mixer Right\", SND_SOC_NOPM, 0, 0,\n\t\t&da7210_dapm_inmixr_controls[0],\n\t\tARRAY_SIZE(da7210_dapm_inmixr_controls)),\n\n\t \n\tSND_SOC_DAPM_ADC(\"ADC Left\", \"Capture\", DA7210_STARTUP3, 5, 1),\n\tSND_SOC_DAPM_ADC(\"ADC Right\", \"Capture\", DA7210_STARTUP3, 6, 1),\n\n\t \n\t \n\tSND_SOC_DAPM_DAC(\"DAC Left\", \"Playback\", DA7210_STARTUP2, 5, 1),\n\tSND_SOC_DAPM_DAC(\"DAC Right\", \"Playback\", DA7210_STARTUP2, 6, 1),\n\n\t \n\tSND_SOC_DAPM_MIXER(\"Out Mixer Left\", SND_SOC_NOPM, 0, 0,\n\t\t&da7210_dapm_outmixl_controls[0],\n\t\tARRAY_SIZE(da7210_dapm_outmixl_controls)),\n\n\tSND_SOC_DAPM_MIXER(\"Out Mixer Right\", SND_SOC_NOPM, 0, 0,\n\t\t&da7210_dapm_outmixr_controls[0],\n\t\tARRAY_SIZE(da7210_dapm_outmixr_controls)),\n\n\tSND_SOC_DAPM_MIXER(\"Mono Mixer\", SND_SOC_NOPM, 0, 0,\n\t\t&da7210_dapm_monomix_controls[0],\n\t\tARRAY_SIZE(da7210_dapm_monomix_controls)),\n\n\t \n\tSND_SOC_DAPM_PGA(\"OUTPGA Left Enable\", DA7210_OUTMIX_L, 7, 0, NULL, 0),\n\tSND_SOC_DAPM_PGA(\"OUTPGA Right Enable\", DA7210_OUTMIX_R, 7, 0, NULL, 0),\n\n\tSND_SOC_DAPM_PGA(\"Out1 Left\", DA7210_STARTUP2, 0, 1, NULL, 0),\n\tSND_SOC_DAPM_PGA(\"Out1 Right\", DA7210_STARTUP2, 1, 1, NULL, 0),\n\tSND_SOC_DAPM_PGA(\"Out2 Mono\", DA7210_STARTUP2, 2, 1, NULL, 0),\n\tSND_SOC_DAPM_PGA(\"Headphone Left\", DA7210_STARTUP2, 3, 1, NULL, 0),\n\tSND_SOC_DAPM_PGA(\"Headphone Right\", DA7210_STARTUP2, 4, 1, NULL, 0),\n\n\t \n\tSND_SOC_DAPM_OUTPUT(\"OUT1L\"),\n\tSND_SOC_DAPM_OUTPUT(\"OUT1R\"),\n\tSND_SOC_DAPM_OUTPUT(\"HPL\"),\n\tSND_SOC_DAPM_OUTPUT(\"HPR\"),\n\tSND_SOC_DAPM_OUTPUT(\"OUT2\"),\n};\n\n \nstatic const struct snd_soc_dapm_route da7210_audio_map[] = {\n\t \n\t \n\t{\"Mic Left\", NULL, \"MICL\"},\n\t{\"Mic Right\", NULL, \"MICR\"},\n\t{\"Aux1 Left\", NULL, \"AUX1L\"},\n\t{\"Aux1 Right\", NULL, \"AUX1R\"},\n\t{\"Aux2 Mono\", NULL, \"AUX2\"},\n\n\t{\"In Mixer Left\", \"Mic Left Switch\", \"Mic Left\"},\n\t{\"In Mixer Left\", \"Mic Right Switch\", \"Mic Right\"},\n\t{\"In Mixer Left\", \"Aux1 Left Switch\", \"Aux1 Left\"},\n\t{\"In Mixer Left\", \"Aux2 Switch\", \"Aux2 Mono\"},\n\t{\"In Mixer Left\", \"Outmix Left Switch\", \"Out Mixer Left\"},\n\n\t{\"In Mixer Right\", \"Mic Right Switch\", \"Mic Right\"},\n\t{\"In Mixer Right\", \"Mic Left Switch\", \"Mic Left\"},\n\t{\"In Mixer Right\", \"Aux1 Right Switch\", \"Aux1 Right\"},\n\t{\"In Mixer Right\", \"Aux2 Switch\", \"Aux2 Mono\"},\n\t{\"In Mixer Right\", \"Outmix Right Switch\", \"Out Mixer Right\"},\n\n\t{\"INPGA Left\", NULL, \"In Mixer Left\"},\n\t{\"ADC Left\", NULL, \"INPGA Left\"},\n\n\t{\"INPGA Right\", NULL, \"In Mixer Right\"},\n\t{\"ADC Right\", NULL, \"INPGA Right\"},\n\n\t \n\t{\"Out Mixer Left\", \"Aux1 Left Switch\", \"Aux1 Left\"},\n\t{\"Out Mixer Left\", \"Aux2 Switch\", \"Aux2 Mono\"},\n\t{\"Out Mixer Left\", \"INPGA Left Switch\", \"INPGA Left\"},\n\t{\"Out Mixer Left\", \"INPGA Right Switch\", \"INPGA Right\"},\n\t{\"Out Mixer Left\", \"DAC Left Switch\", \"DAC Left\"},\n\n\t{\"Out Mixer Right\", \"Aux1 Right Switch\", \"Aux1 Right\"},\n\t{\"Out Mixer Right\", \"Aux2 Switch\", \"Aux2 Mono\"},\n\t{\"Out Mixer Right\", \"INPGA Right Switch\", \"INPGA Right\"},\n\t{\"Out Mixer Right\", \"INPGA Left Switch\", \"INPGA Left\"},\n\t{\"Out Mixer Right\", \"DAC Right Switch\", \"DAC Right\"},\n\n\t{\"Mono Mixer\", \"INPGA Right Switch\", \"INPGA Right\"},\n\t{\"Mono Mixer\", \"INPGA Left Switch\", \"INPGA Left\"},\n\t{\"Mono Mixer\", \"Outmix Right Switch\", \"Out Mixer Right\"},\n\t{\"Mono Mixer\", \"Outmix Left Switch\", \"Out Mixer Left\"},\n\n\t{\"OUTPGA Left Enable\", NULL, \"Out Mixer Left\"},\n\t{\"OUTPGA Right Enable\", NULL, \"Out Mixer Right\"},\n\n\t{\"Out1 Left\", NULL, \"OUTPGA Left Enable\"},\n\t{\"OUT1L\", NULL, \"Out1 Left\"},\n\n\t{\"Out1 Right\", NULL, \"OUTPGA Right Enable\"},\n\t{\"OUT1R\", NULL, \"Out1 Right\"},\n\n\t{\"Headphone Left\", NULL, \"OUTPGA Left Enable\"},\n\t{\"HPL\", NULL, \"Headphone Left\"},\n\n\t{\"Headphone Right\", NULL, \"OUTPGA Right Enable\"},\n\t{\"HPR\", NULL, \"Headphone Right\"},\n\n\t{\"Out2 Mono\", NULL, \"Mono Mixer\"},\n\t{\"OUT2\", NULL, \"Out2 Mono\"},\n};\n\n \nstruct da7210_priv {\n\tstruct regmap *regmap;\n\tunsigned int mclk_rate;\n\tint master;\n};\n\nstatic const struct reg_default da7210_reg_defaults[] = {\n\t{ 0x00, 0x00 },\n\t{ 0x01, 0x11 },\n\t{ 0x03, 0x00 },\n\t{ 0x04, 0x00 },\n\t{ 0x05, 0x00 },\n\t{ 0x06, 0x00 },\n\t{ 0x07, 0x00 },\n\t{ 0x08, 0x00 },\n\t{ 0x09, 0x00 },\n\t{ 0x0a, 0x00 },\n\t{ 0x0b, 0x00 },\n\t{ 0x0c, 0x00 },\n\t{ 0x0d, 0x00 },\n\t{ 0x0e, 0x00 },\n\t{ 0x0f, 0x08 },\n\t{ 0x10, 0x00 },\n\t{ 0x11, 0x00 },\n\t{ 0x12, 0x00 },\n\t{ 0x13, 0x00 },\n\t{ 0x14, 0x08 },\n\t{ 0x15, 0x10 },\n\t{ 0x16, 0x10 },\n\t{ 0x17, 0x54 },\n\t{ 0x18, 0x40 },\n\t{ 0x19, 0x00 },\n\t{ 0x1a, 0x00 },\n\t{ 0x1b, 0x00 },\n\t{ 0x1c, 0x00 },\n\t{ 0x1d, 0x00 },\n\t{ 0x1e, 0x00 },\n\t{ 0x1f, 0x00 },\n\t{ 0x20, 0x00 },\n\t{ 0x21, 0x00 },\n\t{ 0x22, 0x00 },\n\t{ 0x23, 0x02 },\n\t{ 0x24, 0x00 },\n\t{ 0x25, 0x76 },\n\t{ 0x26, 0x00 },\n\t{ 0x27, 0x00 },\n\t{ 0x28, 0x04 },\n\t{ 0x29, 0x00 },\n\t{ 0x2a, 0x00 },\n\t{ 0x2b, 0x30 },\n\t{ 0x2c, 0x2A },\n\t{ 0x83, 0x00 },\n\t{ 0x84, 0x00 },\n\t{ 0x85, 0x00 },\n\t{ 0x86, 0x00 },\n\t{ 0x87, 0x00 },\n\t{ 0x88, 0x00 },\n};\n\nstatic bool da7210_readable_register(struct device *dev, unsigned int reg)\n{\n\tswitch (reg) {\n\tcase DA7210_A_HID_UNLOCK:\n\tcase DA7210_A_TEST_UNLOCK:\n\tcase DA7210_A_PLL1:\n\tcase DA7210_A_CP_MODE:\n\t\treturn false;\n\tdefault:\n\t\treturn true;\n\t}\n}\n\nstatic bool da7210_volatile_register(struct device *dev,\n\t\t\t\t    unsigned int reg)\n{\n\tswitch (reg) {\n\tcase DA7210_STATUS:\n\t\treturn true;\n\tdefault:\n\t\treturn false;\n\t}\n}\n\n \nstatic int da7210_hw_params(struct snd_pcm_substream *substream,\n\t\t\t    struct snd_pcm_hw_params *params,\n\t\t\t    struct snd_soc_dai *dai)\n{\n\tstruct snd_soc_component *component = dai->component;\n\tstruct da7210_priv *da7210 = snd_soc_component_get_drvdata(component);\n\tu32 dai_cfg1;\n\tu32 fs, sysclk;\n\n\t \n\tsnd_soc_component_write(component, DA7210_DAI_SRC_SEL,\n\t\t     DA7210_DAI_OUT_R_SRC | DA7210_DAI_OUT_L_SRC);\n\n\t \n\tsnd_soc_component_write(component, DA7210_DAI_CFG3, DA7210_DAI_OE | DA7210_DAI_EN);\n\n\tdai_cfg1 = 0xFC & snd_soc_component_read(component, DA7210_DAI_CFG1);\n\n\tswitch (params_width(params)) {\n\tcase 16:\n\t\tdai_cfg1 |= DA7210_DAI_WORD_S16_LE;\n\t\tbreak;\n\tcase 20:\n\t\tdai_cfg1 |= DA7210_DAI_WORD_S20_3LE;\n\t\tbreak;\n\tcase 24:\n\t\tdai_cfg1 |= DA7210_DAI_WORD_S24_LE;\n\t\tbreak;\n\tcase 32:\n\t\tdai_cfg1 |= DA7210_DAI_WORD_S32_LE;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tsnd_soc_component_write(component, DA7210_DAI_CFG1, dai_cfg1);\n\n\tswitch (params_rate(params)) {\n\tcase 8000:\n\t\tfs\t\t= DA7210_PLL_FS_8000;\n\t\tsysclk\t\t= 3072000;\n\t\tbreak;\n\tcase 11025:\n\t\tfs\t\t= DA7210_PLL_FS_11025;\n\t\tsysclk\t\t= 2822400;\n\t\tbreak;\n\tcase 12000:\n\t\tfs\t\t= DA7210_PLL_FS_12000;\n\t\tsysclk\t\t= 3072000;\n\t\tbreak;\n\tcase 16000:\n\t\tfs\t\t= DA7210_PLL_FS_16000;\n\t\tsysclk\t\t= 3072000;\n\t\tbreak;\n\tcase 22050:\n\t\tfs\t\t= DA7210_PLL_FS_22050;\n\t\tsysclk\t\t= 2822400;\n\t\tbreak;\n\tcase 32000:\n\t\tfs\t\t= DA7210_PLL_FS_32000;\n\t\tsysclk\t\t= 3072000;\n\t\tbreak;\n\tcase 44100:\n\t\tfs\t\t= DA7210_PLL_FS_44100;\n\t\tsysclk\t\t= 2822400;\n\t\tbreak;\n\tcase 48000:\n\t\tfs\t\t= DA7210_PLL_FS_48000;\n\t\tsysclk\t\t= 3072000;\n\t\tbreak;\n\tcase 88200:\n\t\tfs\t\t= DA7210_PLL_FS_88200;\n\t\tsysclk\t\t= 2822400;\n\t\tbreak;\n\tcase 96000:\n\t\tfs\t\t= DA7210_PLL_FS_96000;\n\t\tsysclk\t\t= 3072000;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\t \n\tsnd_soc_component_update_bits(component, DA7210_STARTUP1, DA7210_SC_MST_EN, 0);\n\n\tsnd_soc_component_update_bits(component, DA7210_PLL, DA7210_PLL_FS_MASK, fs);\n\n\tif (da7210->mclk_rate && (da7210->mclk_rate != sysclk)) {\n\t\t \n\t\tsnd_soc_component_update_bits(component, DA7210_PLL_DIV3, DA7210_PLL_BYP, 0);\n\n\t\tif (!da7210->master) {\n\t\t\t \n\t\t\tsnd_soc_component_update_bits(component, DA7210_PLL,\n\t\t\t\t\t\t   (DA7210_MCLK_SRM_EN |\n\t\t\t\t\t\t    DA7210_MCLK_DET_EN),\n\t\t\t\t\t\t   (DA7210_MCLK_SRM_EN |\n\t\t\t\t\t\t    DA7210_MCLK_DET_EN));\n\t\t}\n\t} else {\n\t\t \n\t\tsnd_soc_component_update_bits(component, DA7210_PLL, DA7210_MCLK_DET_EN,\n\t\t\t\t\t\t       DA7210_MCLK_DET_EN);\n\t\tsnd_soc_component_update_bits(component, DA7210_PLL_DIV3, DA7210_PLL_BYP,\n\t\t\t\t\t\t\t    DA7210_PLL_BYP);\n\t}\n\t \n\tsnd_soc_component_update_bits(component, DA7210_STARTUP1,\n\t\t\t    DA7210_SC_MST_EN, DA7210_SC_MST_EN);\n\n\treturn 0;\n}\n\n \nstatic int da7210_set_dai_fmt(struct snd_soc_dai *codec_dai, u32 fmt)\n{\n\tstruct snd_soc_component *component = codec_dai->component;\n\tstruct da7210_priv *da7210 = snd_soc_component_get_drvdata(component);\n\tu32 dai_cfg1;\n\tu32 dai_cfg3;\n\n\tdai_cfg1 = 0x7f & snd_soc_component_read(component, DA7210_DAI_CFG1);\n\tdai_cfg3 = 0xfc & snd_soc_component_read(component, DA7210_DAI_CFG3);\n\n\tif ((snd_soc_component_read(component, DA7210_PLL) & DA7210_PLL_EN) &&\n\t\t(!(snd_soc_component_read(component, DA7210_PLL_DIV3) & DA7210_PLL_BYP)))\n\t\treturn -EINVAL;\n\n\tswitch (fmt & SND_SOC_DAIFMT_MASTER_MASK) {\n\tcase SND_SOC_DAIFMT_CBM_CFM:\n\t\tda7210->master = 1;\n\t\tdai_cfg1 |= DA7210_DAI_MODE_MASTER;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_CBS_CFS:\n\t\tda7210->master = 0;\n\t\tdai_cfg1 |= DA7210_DAI_MODE_SLAVE;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\t \n\tswitch (fmt & SND_SOC_DAIFMT_FORMAT_MASK) {\n\tcase SND_SOC_DAIFMT_I2S:\n\t\tdai_cfg3 |= DA7210_DAI_FORMAT_I2SMODE;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_LEFT_J:\n\t\tdai_cfg3 |= DA7210_DAI_FORMAT_LEFT_J;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_RIGHT_J:\n\t\tdai_cfg3 |= DA7210_DAI_FORMAT_RIGHT_J;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\t \n\tdai_cfg1 |= DA7210_DAI_FLEN_64BIT;\n\n\tsnd_soc_component_write(component, DA7210_DAI_CFG1, dai_cfg1);\n\tsnd_soc_component_write(component, DA7210_DAI_CFG3, dai_cfg3);\n\n\treturn 0;\n}\n\nstatic int da7210_mute(struct snd_soc_dai *dai, int mute, int direction)\n{\n\tstruct snd_soc_component *component = dai->component;\n\tu8 mute_reg = snd_soc_component_read(component, DA7210_DAC_HPF) & 0xFB;\n\n\tif (mute)\n\t\tsnd_soc_component_write(component, DA7210_DAC_HPF, mute_reg | 0x4);\n\telse\n\t\tsnd_soc_component_write(component, DA7210_DAC_HPF, mute_reg);\n\treturn 0;\n}\n\n#define DA7210_FORMATS (SNDRV_PCM_FMTBIT_S16_LE | SNDRV_PCM_FMTBIT_S20_3LE |\\\n\t\t\tSNDRV_PCM_FMTBIT_S24_LE | SNDRV_PCM_FMTBIT_S32_LE)\n\nstatic int da7210_set_dai_sysclk(struct snd_soc_dai *codec_dai,\n\t\t\t\t int clk_id, unsigned int freq, int dir)\n{\n\tstruct snd_soc_component *component = codec_dai->component;\n\tstruct da7210_priv *da7210 = snd_soc_component_get_drvdata(component);\n\n\tswitch (clk_id) {\n\tcase DA7210_CLKSRC_MCLK:\n\t\tswitch (freq) {\n\t\tcase 12000000:\n\t\tcase 13000000:\n\t\tcase 13500000:\n\t\tcase 14400000:\n\t\tcase 19200000:\n\t\tcase 19680000:\n\t\tcase 19800000:\n\t\t\tda7210->mclk_rate = freq;\n\t\t\treturn 0;\n\t\tdefault:\n\t\t\tdev_err(codec_dai->dev, \"Unsupported MCLK value %d\\n\",\n\t\t\t\tfreq);\n\t\t\treturn -EINVAL;\n\t\t}\n\t\tbreak;\n\tdefault:\n\t\tdev_err(codec_dai->dev, \"Unknown clock source %d\\n\", clk_id);\n\t\treturn -EINVAL;\n\t}\n}\n\n \nstatic int da7210_set_dai_pll(struct snd_soc_dai *codec_dai, int pll_id,\n\t\t\t      int source, unsigned int fref, unsigned int fout)\n{\n\tstruct snd_soc_component *component = codec_dai->component;\n\tstruct da7210_priv *da7210 = snd_soc_component_get_drvdata(component);\n\n\tu8 pll_div1, pll_div2, pll_div3, cnt;\n\n\t \n\tif (!da7210->master)\n\t\tfout = 2822400;\n\n\t \n\tfor (cnt = 0; cnt < ARRAY_SIZE(da7210_pll_div); cnt++) {\n\t\t \n\t\tif ((fref == da7210_pll_div[cnt].fref) &&\n\t\t    (da7210->master ==  da7210_pll_div[cnt].mode) &&\n\t\t    (fout == da7210_pll_div[cnt].fout)) {\n\t\t\t \n\t\t\tpll_div1 = da7210_pll_div[cnt].div1;\n\t\t\tpll_div2 = da7210_pll_div[cnt].div2;\n\t\t\tpll_div3 = da7210_pll_div[cnt].div3;\n\t\t\tbreak;\n\t\t}\n\t}\n\tif (cnt >= ARRAY_SIZE(da7210_pll_div))\n\t\tgoto err;\n\n\t \n\tsnd_soc_component_update_bits(component, DA7210_STARTUP1, DA7210_SC_MST_EN, 0);\n\t \n\tsnd_soc_component_write(component, DA7210_PLL_DIV1, pll_div1);\n\tsnd_soc_component_write(component, DA7210_PLL_DIV2, pll_div2);\n\tsnd_soc_component_update_bits(component, DA7210_PLL_DIV3,\n\t\t\t\t   DA7210_PLL_DIV_L_MASK, pll_div3);\n\n\t \n\tsnd_soc_component_update_bits(component, DA7210_PLL, DA7210_PLL_EN, DA7210_PLL_EN);\n\n\t \n\tsnd_soc_component_update_bits(component, DA7210_STARTUP1, DA7210_SC_MST_EN,\n\t\t\t\t\t\t    DA7210_SC_MST_EN);\n\treturn 0;\nerr:\n\tdev_err(codec_dai->dev, \"Unsupported PLL input frequency %d\\n\", fref);\n\treturn -EINVAL;\n}\n\n \nstatic const struct snd_soc_dai_ops da7210_dai_ops = {\n\t.hw_params\t= da7210_hw_params,\n\t.set_fmt\t= da7210_set_dai_fmt,\n\t.set_sysclk\t= da7210_set_dai_sysclk,\n\t.set_pll\t= da7210_set_dai_pll,\n\t.mute_stream\t= da7210_mute,\n\t.no_capture_mute = 1,\n};\n\nstatic struct snd_soc_dai_driver da7210_dai = {\n\t.name = \"da7210-hifi\",\n\t \n\t.playback = {\n\t\t.stream_name = \"Playback\",\n\t\t.channels_min = 1,\n\t\t.channels_max = 2,\n\t\t.rates = SNDRV_PCM_RATE_8000_96000,\n\t\t.formats = DA7210_FORMATS,\n\t},\n\t \n\t.capture = {\n\t\t.stream_name = \"Capture\",\n\t\t.channels_min = 1,\n\t\t.channels_max = 2,\n\t\t.rates = SNDRV_PCM_RATE_8000_96000,\n\t\t.formats = DA7210_FORMATS,\n\t},\n\t.ops = &da7210_dai_ops,\n\t.symmetric_rate = 1,\n};\n\nstatic int da7210_probe(struct snd_soc_component *component)\n{\n\tstruct da7210_priv *da7210 = snd_soc_component_get_drvdata(component);\n\n\tdev_info(component->dev, \"DA7210 Audio Codec %s\\n\", DA7210_VERSION);\n\n\tda7210->mclk_rate       = 0;     \n\tda7210->master          = 0;     \n\n\t \n\tsnd_soc_component_write(component, DA7210_CONTROL, DA7210_REG_EN | DA7210_BIAS_EN);\n\n\t \n\n\t \n\tsnd_soc_component_write(component, DA7210_MIC_L, DA7210_MIC_L_EN | DA7210_MICBIAS_EN);\n\tsnd_soc_component_write(component, DA7210_MIC_R, DA7210_MIC_R_EN);\n\n\t \n\tsnd_soc_component_write(component, DA7210_INMIX_L, DA7210_IN_L_EN);\n\tsnd_soc_component_write(component, DA7210_INMIX_R, DA7210_IN_R_EN);\n\n\t \n\tsnd_soc_component_write(component, DA7210_ADC, DA7210_ADC_L_EN | DA7210_ADC_R_EN);\n\n\t \n\n\t \n\tsnd_soc_component_write(component, DA7210_DAC_SEL,\n\t\t     DA7210_DAC_L_SRC_DAI_L | DA7210_DAC_L_EN |\n\t\t     DA7210_DAC_R_SRC_DAI_R | DA7210_DAC_R_EN);\n\n\t \n\tsnd_soc_component_write(component, DA7210_OUTMIX_L, DA7210_OUT_L_EN);\n\tsnd_soc_component_write(component, DA7210_OUTMIX_R, DA7210_OUT_R_EN);\n\n\t \n\tsnd_soc_component_write(component, DA7210_HP_CFG,\n\t\t     DA7210_HP_2CAP_MODE | DA7210_HP_SENSE_EN |\n\t\t     DA7210_HP_L_EN | DA7210_HP_MODE | DA7210_HP_R_EN);\n\n\t \n\tsnd_soc_component_write(component, DA7210_SOFTMUTE, DA7210_RAMP_EN);\n\n\t \n\n\t \n\tsnd_soc_component_write(component, DA7210_OUT1_L, DA7210_OUT1_L_EN);\n\tsnd_soc_component_write(component, DA7210_OUT1_R, DA7210_OUT1_R_EN);\n\tsnd_soc_component_write(component, DA7210_OUT2, DA7210_OUT2_EN |\n\t\t     DA7210_OUT2_OUTMIX_L | DA7210_OUT2_OUTMIX_R);\n\n\t \n\tsnd_soc_component_write(component, DA7210_AUX1_L, DA7210_AUX1_L_EN);\n\tsnd_soc_component_write(component, DA7210_AUX1_R, DA7210_AUX1_R_EN);\n\t \n\tsnd_soc_component_write(component, DA7210_AUX2, DA7210_AUX2_EN);\n\n\t \n\tsnd_soc_component_write(component, DA7210_PLL_DIV3, DA7210_MCLK_RANGE_10_20_MHZ |\n\t\t\t\t\t      DA7210_PLL_BYP);\n\n\t \n\tsnd_soc_component_write(component, DA7210_PLL, DA7210_PLL_FS_48000);\n\n\t \n\tsnd_soc_component_write(component, DA7210_STARTUP1, DA7210_SC_MST_EN);\n\n\tdev_info(component->dev, \"DA7210 Audio Codec %s\\n\", DA7210_VERSION);\n\n\treturn 0;\n}\n\nstatic const struct snd_soc_component_driver soc_component_dev_da7210 = {\n\t.probe\t\t\t= da7210_probe,\n\t.controls\t\t= da7210_snd_controls,\n\t.num_controls\t\t= ARRAY_SIZE(da7210_snd_controls),\n\t.dapm_widgets\t\t= da7210_dapm_widgets,\n\t.num_dapm_widgets\t= ARRAY_SIZE(da7210_dapm_widgets),\n\t.dapm_routes\t\t= da7210_audio_map,\n\t.num_dapm_routes\t= ARRAY_SIZE(da7210_audio_map),\n\t.idle_bias_on\t\t= 1,\n\t.use_pmdown_time\t= 1,\n\t.endianness\t\t= 1,\n};\n\n#if IS_ENABLED(CONFIG_I2C)\n\nstatic const struct reg_sequence da7210_regmap_i2c_patch[] = {\n\n\t \n\t{ DA7210_STARTUP1, 0x00 },\n\t \n\t{ DA7210_PLL_DIV3, DA7210_MCLK_RANGE_10_20_MHZ },\n\n\t \n\t{ DA7210_A_HID_UNLOCK, 0x8B},\n\t{ DA7210_A_TEST_UNLOCK, 0xB4},\n\t{ DA7210_A_PLL1, 0x01},\n\t{ DA7210_A_CP_MODE, 0x7C},\n\t \n\t{ DA7210_A_HID_UNLOCK, 0x00},\n\t{ DA7210_A_TEST_UNLOCK, 0x00},\n};\n\nstatic const struct regmap_config da7210_regmap_config_i2c = {\n\t.reg_bits = 8,\n\t.val_bits = 8,\n\n\t.reg_defaults = da7210_reg_defaults,\n\t.num_reg_defaults = ARRAY_SIZE(da7210_reg_defaults),\n\t.volatile_reg = da7210_volatile_register,\n\t.readable_reg = da7210_readable_register,\n\t.cache_type = REGCACHE_RBTREE,\n};\n\nstatic int da7210_i2c_probe(struct i2c_client *i2c)\n{\n\tstruct da7210_priv *da7210;\n\tint ret;\n\n\tda7210 = devm_kzalloc(&i2c->dev, sizeof(struct da7210_priv),\n\t\t\t      GFP_KERNEL);\n\tif (!da7210)\n\t\treturn -ENOMEM;\n\n\ti2c_set_clientdata(i2c, da7210);\n\n\tda7210->regmap = devm_regmap_init_i2c(i2c, &da7210_regmap_config_i2c);\n\tif (IS_ERR(da7210->regmap)) {\n\t\tret = PTR_ERR(da7210->regmap);\n\t\tdev_err(&i2c->dev, \"regmap_init() failed: %d\\n\", ret);\n\t\treturn ret;\n\t}\n\n\tret = regmap_register_patch(da7210->regmap, da7210_regmap_i2c_patch,\n\t\t\t\t    ARRAY_SIZE(da7210_regmap_i2c_patch));\n\tif (ret != 0)\n\t\tdev_warn(&i2c->dev, \"Failed to apply regmap patch: %d\\n\", ret);\n\n\tret =  devm_snd_soc_register_component(&i2c->dev,\n\t\t\t&soc_component_dev_da7210, &da7210_dai, 1);\n\tif (ret < 0)\n\t\tdev_err(&i2c->dev, \"Failed to register component: %d\\n\", ret);\n\n\treturn ret;\n}\n\nstatic const struct i2c_device_id da7210_i2c_id[] = {\n\t{ \"da7210\", 0 },\n\t{ }\n};\nMODULE_DEVICE_TABLE(i2c, da7210_i2c_id);\n\n \nstatic struct i2c_driver da7210_i2c_driver = {\n\t.driver = {\n\t\t.name = \"da7210\",\n\t},\n\t.probe\t\t= da7210_i2c_probe,\n\t.id_table\t= da7210_i2c_id,\n};\n#endif\n\n#if defined(CONFIG_SPI_MASTER)\n\nstatic const struct reg_sequence da7210_regmap_spi_patch[] = {\n\t \n\t{ DA7210_AUX2, 0x00 },\n\t{ DA7210_AUX2, 0x00 },\n\n\t \n\t{ DA7210_STARTUP1, 0x00 },\n\t \n\t{ DA7210_PLL_DIV3, DA7210_MCLK_RANGE_10_20_MHZ },\n\n\t \n\t{ DA7210_PAGE_CONTROL, 0x80 },\n\t \n\t{ DA7210_A_HID_UNLOCK, 0x8B},\n\t{ DA7210_A_TEST_UNLOCK, 0xB4},\n\t{ DA7210_A_PLL1, 0x01},\n\t{ DA7210_A_CP_MODE, 0x7C},\n\t \n\t{ DA7210_A_HID_UNLOCK, 0x00},\n\t{ DA7210_A_TEST_UNLOCK, 0x00},\n\t \n\t{ DA7210_PAGE_CONTROL, 0x00 },\n};\n\nstatic const struct regmap_config da7210_regmap_config_spi = {\n\t.reg_bits = 8,\n\t.val_bits = 8,\n\t.read_flag_mask = 0x01,\n\t.write_flag_mask = 0x00,\n\n\t.reg_defaults = da7210_reg_defaults,\n\t.num_reg_defaults = ARRAY_SIZE(da7210_reg_defaults),\n\t.volatile_reg = da7210_volatile_register,\n\t.readable_reg = da7210_readable_register,\n\t.cache_type = REGCACHE_RBTREE,\n};\n\nstatic int da7210_spi_probe(struct spi_device *spi)\n{\n\tstruct da7210_priv *da7210;\n\tint ret;\n\n\tda7210 = devm_kzalloc(&spi->dev, sizeof(struct da7210_priv),\n\t\t\t      GFP_KERNEL);\n\tif (!da7210)\n\t\treturn -ENOMEM;\n\n\tspi_set_drvdata(spi, da7210);\n\tda7210->regmap = devm_regmap_init_spi(spi, &da7210_regmap_config_spi);\n\tif (IS_ERR(da7210->regmap)) {\n\t\tret = PTR_ERR(da7210->regmap);\n\t\tdev_err(&spi->dev, \"Failed to register regmap: %d\\n\", ret);\n\t\treturn ret;\n\t}\n\n\tret = regmap_register_patch(da7210->regmap, da7210_regmap_spi_patch,\n\t\t\t\t    ARRAY_SIZE(da7210_regmap_spi_patch));\n\tif (ret != 0)\n\t\tdev_warn(&spi->dev, \"Failed to apply regmap patch: %d\\n\", ret);\n\n\tret = devm_snd_soc_register_component(&spi->dev,\n\t\t\t&soc_component_dev_da7210, &da7210_dai, 1);\n\n\treturn ret;\n}\n\nstatic struct spi_driver da7210_spi_driver = {\n\t.driver = {\n\t\t.name = \"da7210\",\n\t},\n\t.probe = da7210_spi_probe,\n};\n#endif\n\nstatic int __init da7210_modinit(void)\n{\n\tint ret = 0;\n#if IS_ENABLED(CONFIG_I2C)\n\tret = i2c_add_driver(&da7210_i2c_driver);\n\tif (ret)\n\t\treturn ret;\n#endif\n#if defined(CONFIG_SPI_MASTER)\n\tret = spi_register_driver(&da7210_spi_driver);\n\tif (ret) {\n\t\tprintk(KERN_ERR \"Failed to register da7210 SPI driver: %d\\n\",\n\t\t       ret);\n\t}\n#endif\n\treturn ret;\n}\nmodule_init(da7210_modinit);\n\nstatic void __exit da7210_exit(void)\n{\n#if IS_ENABLED(CONFIG_I2C)\n\ti2c_del_driver(&da7210_i2c_driver);\n#endif\n#if defined(CONFIG_SPI_MASTER)\n\tspi_unregister_driver(&da7210_spi_driver);\n#endif\n}\nmodule_exit(da7210_exit);\n\nMODULE_DESCRIPTION(\"ASoC DA7210 driver\");\nMODULE_AUTHOR(\"David Chen, Kuninori Morimoto\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}