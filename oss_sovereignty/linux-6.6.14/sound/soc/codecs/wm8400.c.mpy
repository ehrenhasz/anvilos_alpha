{
  "module_name": "wm8400.c",
  "hash_id": "22985ea1c7e73329b04665c8d3e5c9babb3c452df986603216ce990b6f8e93f9",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/codecs/wm8400.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/moduleparam.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/init.h>\n#include <linux/delay.h>\n#include <linux/pm.h>\n#include <linux/platform_device.h>\n#include <linux/regulator/consumer.h>\n#include <linux/mfd/wm8400-audio.h>\n#include <linux/mfd/wm8400-private.h>\n#include <linux/mfd/core.h>\n#include <sound/core.h>\n#include <sound/pcm.h>\n#include <sound/pcm_params.h>\n#include <sound/soc.h>\n#include <sound/initval.h>\n#include <sound/tlv.h>\n\n#include \"wm8400.h\"\n\nstatic struct regulator_bulk_data power[] = {\n\t{\n\t\t.supply = \"I2S1VDD\",\n\t},\n\t{\n\t\t.supply = \"I2S2VDD\",\n\t},\n\t{\n\t\t.supply = \"DCVDD\",\n\t},\n\t{\n\t\t.supply = \"AVDD\",\n\t},\n\t{\n\t\t.supply = \"FLLVDD\",\n\t},\n\t{\n\t\t.supply = \"HPVDD\",\n\t},\n\t{\n\t\t.supply = \"SPKVDD\",\n\t},\n};\n\n \nstruct wm8400_priv {\n\tstruct wm8400 *wm8400;\n\tu16 fake_register;\n\tunsigned int sysclk;\n\tunsigned int pcmclk;\n\tint fll_in, fll_out;\n};\n\nstatic void wm8400_component_reset(struct snd_soc_component *component)\n{\n\tstruct wm8400_priv *wm8400 = snd_soc_component_get_drvdata(component);\n\n\twm8400_reset_codec_reg_cache(wm8400->wm8400);\n}\n\nstatic const DECLARE_TLV_DB_SCALE(in_pga_tlv, -1650, 3000, 0);\n\nstatic const DECLARE_TLV_DB_SCALE(out_mix_tlv, -2100, 0, 0);\n\nstatic const DECLARE_TLV_DB_SCALE(out_pga_tlv, -7300, 600, 0);\n\nstatic const DECLARE_TLV_DB_SCALE(out_dac_tlv, -7163, 0, 0);\n\nstatic const DECLARE_TLV_DB_SCALE(in_adc_tlv, -7163, 1763, 0);\n\nstatic const DECLARE_TLV_DB_SCALE(out_sidetone_tlv, -3600, 0, 0);\n\nstatic int wm8400_outpga_put_volsw_vu(struct snd_kcontrol *kcontrol,\n        struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_soc_component *component = snd_soc_kcontrol_component(kcontrol);\n\tstruct soc_mixer_control *mc =\n\t\t(struct soc_mixer_control *)kcontrol->private_value;\n\tint reg = mc->reg;\n        int ret;\n        u16 val;\n\n        ret = snd_soc_put_volsw(kcontrol, ucontrol);\n        if (ret < 0)\n                return ret;\n\n         \n\tval = snd_soc_component_read(component, reg);\n        return snd_soc_component_write(component, reg, val | 0x0100);\n}\n\n#define WM8400_OUTPGA_SINGLE_R_TLV(xname, reg, shift, max, invert, tlv_array) \\\n\tSOC_SINGLE_EXT_TLV(xname, reg, shift, max, invert, \\\n\t\tsnd_soc_get_volsw, wm8400_outpga_put_volsw_vu, tlv_array)\n\n\nstatic const char *wm8400_digital_sidetone[] =\n\t{\"None\", \"Left ADC\", \"Right ADC\", \"Reserved\"};\n\nstatic SOC_ENUM_SINGLE_DECL(wm8400_left_digital_sidetone_enum,\n\t\t\t    WM8400_DIGITAL_SIDE_TONE,\n\t\t\t    WM8400_ADC_TO_DACL_SHIFT,\n\t\t\t    wm8400_digital_sidetone);\n\nstatic SOC_ENUM_SINGLE_DECL(wm8400_right_digital_sidetone_enum,\n\t\t\t    WM8400_DIGITAL_SIDE_TONE,\n\t\t\t    WM8400_ADC_TO_DACR_SHIFT,\n\t\t\t    wm8400_digital_sidetone);\n\nstatic const char *wm8400_adcmode[] =\n\t{\"Hi-fi mode\", \"Voice mode 1\", \"Voice mode 2\", \"Voice mode 3\"};\n\nstatic SOC_ENUM_SINGLE_DECL(wm8400_right_adcmode_enum,\n\t\t\t    WM8400_ADC_CTRL,\n\t\t\t    WM8400_ADC_HPF_CUT_SHIFT,\n\t\t\t    wm8400_adcmode);\n\nstatic const struct snd_kcontrol_new wm8400_snd_controls[] = {\n \nSOC_SINGLE(\"LIN12 PGA Boost\", WM8400_INPUT_MIXER3, WM8400_L12MNBST_SHIFT,\n\t   1, 0),\nSOC_SINGLE(\"LIN34 PGA Boost\", WM8400_INPUT_MIXER3, WM8400_L34MNBST_SHIFT,\n\t   1, 0),\n \nSOC_SINGLE(\"RIN12 PGA Boost\", WM8400_INPUT_MIXER3, WM8400_R12MNBST_SHIFT,\n\t   1, 0),\nSOC_SINGLE(\"RIN34 PGA Boost\", WM8400_INPUT_MIXER3, WM8400_R34MNBST_SHIFT,\n\t   1, 0),\n\n \nSOC_SINGLE_TLV(\"LOMIX LIN3 Bypass Volume\", WM8400_OUTPUT_MIXER3,\n\tWM8400_LLI3LOVOL_SHIFT, 7, 0, out_mix_tlv),\nSOC_SINGLE_TLV(\"LOMIX RIN12 PGA Bypass Volume\", WM8400_OUTPUT_MIXER3,\n\tWM8400_LR12LOVOL_SHIFT, 7, 0, out_mix_tlv),\nSOC_SINGLE_TLV(\"LOMIX LIN12 PGA Bypass Volume\", WM8400_OUTPUT_MIXER3,\n\tWM8400_LL12LOVOL_SHIFT, 7, 0, out_mix_tlv),\nSOC_SINGLE_TLV(\"LOMIX RIN3 Bypass Volume\", WM8400_OUTPUT_MIXER5,\n\tWM8400_LRI3LOVOL_SHIFT, 7, 0, out_mix_tlv),\nSOC_SINGLE_TLV(\"LOMIX AINRMUX Bypass Volume\", WM8400_OUTPUT_MIXER5,\n\tWM8400_LRBLOVOL_SHIFT, 7, 0, out_mix_tlv),\nSOC_SINGLE_TLV(\"LOMIX AINLMUX Bypass Volume\", WM8400_OUTPUT_MIXER5,\n\tWM8400_LRBLOVOL_SHIFT, 7, 0, out_mix_tlv),\n\n \nSOC_SINGLE_TLV(\"ROMIX RIN3 Bypass Volume\", WM8400_OUTPUT_MIXER4,\n\tWM8400_RRI3ROVOL_SHIFT, 7, 0, out_mix_tlv),\nSOC_SINGLE_TLV(\"ROMIX LIN12 PGA Bypass Volume\", WM8400_OUTPUT_MIXER4,\n\tWM8400_RL12ROVOL_SHIFT, 7, 0, out_mix_tlv),\nSOC_SINGLE_TLV(\"ROMIX RIN12 PGA Bypass Volume\", WM8400_OUTPUT_MIXER4,\n\tWM8400_RR12ROVOL_SHIFT, 7, 0, out_mix_tlv),\nSOC_SINGLE_TLV(\"ROMIX LIN3 Bypass Volume\", WM8400_OUTPUT_MIXER6,\n\tWM8400_RLI3ROVOL_SHIFT, 7, 0, out_mix_tlv),\nSOC_SINGLE_TLV(\"ROMIX AINLMUX Bypass Volume\", WM8400_OUTPUT_MIXER6,\n\tWM8400_RLBROVOL_SHIFT, 7, 0, out_mix_tlv),\nSOC_SINGLE_TLV(\"ROMIX AINRMUX Bypass Volume\", WM8400_OUTPUT_MIXER6,\n\tWM8400_RRBROVOL_SHIFT, 7, 0, out_mix_tlv),\n\n \nWM8400_OUTPGA_SINGLE_R_TLV(\"LOUT Volume\", WM8400_LEFT_OUTPUT_VOLUME,\n\tWM8400_LOUTVOL_SHIFT, WM8400_LOUTVOL_MASK, 0, out_pga_tlv),\nSOC_SINGLE(\"LOUT ZC\", WM8400_LEFT_OUTPUT_VOLUME, WM8400_LOZC_SHIFT, 1, 0),\n\n \nWM8400_OUTPGA_SINGLE_R_TLV(\"ROUT Volume\", WM8400_RIGHT_OUTPUT_VOLUME,\n\tWM8400_ROUTVOL_SHIFT, WM8400_ROUTVOL_MASK, 0, out_pga_tlv),\nSOC_SINGLE(\"ROUT ZC\", WM8400_RIGHT_OUTPUT_VOLUME, WM8400_ROZC_SHIFT, 1, 0),\n\n \nWM8400_OUTPGA_SINGLE_R_TLV(\"LOPGA Volume\", WM8400_LEFT_OPGA_VOLUME,\n\tWM8400_LOPGAVOL_SHIFT, WM8400_LOPGAVOL_MASK, 0, out_pga_tlv),\nSOC_SINGLE(\"LOPGA ZC Switch\", WM8400_LEFT_OPGA_VOLUME,\n\tWM8400_LOPGAZC_SHIFT, 1, 0),\n\n \nWM8400_OUTPGA_SINGLE_R_TLV(\"ROPGA Volume\", WM8400_RIGHT_OPGA_VOLUME,\n\tWM8400_ROPGAVOL_SHIFT, WM8400_ROPGAVOL_MASK, 0, out_pga_tlv),\nSOC_SINGLE(\"ROPGA ZC Switch\", WM8400_RIGHT_OPGA_VOLUME,\n\tWM8400_ROPGAZC_SHIFT, 1, 0),\n\nSOC_SINGLE(\"LON Mute Switch\", WM8400_LINE_OUTPUTS_VOLUME,\n\tWM8400_LONMUTE_SHIFT, 1, 0),\nSOC_SINGLE(\"LOP Mute Switch\", WM8400_LINE_OUTPUTS_VOLUME,\n\tWM8400_LOPMUTE_SHIFT, 1, 0),\nSOC_SINGLE(\"LOP Attenuation Switch\", WM8400_LINE_OUTPUTS_VOLUME,\n\tWM8400_LOATTN_SHIFT, 1, 0),\nSOC_SINGLE(\"RON Mute Switch\", WM8400_LINE_OUTPUTS_VOLUME,\n\tWM8400_RONMUTE_SHIFT, 1, 0),\nSOC_SINGLE(\"ROP Mute Switch\", WM8400_LINE_OUTPUTS_VOLUME,\n\tWM8400_ROPMUTE_SHIFT, 1, 0),\nSOC_SINGLE(\"ROP Attenuation Switch\", WM8400_LINE_OUTPUTS_VOLUME,\n\tWM8400_ROATTN_SHIFT, 1, 0),\n\nSOC_SINGLE(\"OUT3 Mute Switch\", WM8400_OUT3_4_VOLUME,\n\tWM8400_OUT3MUTE_SHIFT, 1, 0),\nSOC_SINGLE(\"OUT3 Attenuation Switch\", WM8400_OUT3_4_VOLUME,\n\tWM8400_OUT3ATTN_SHIFT, 1, 0),\n\nSOC_SINGLE(\"OUT4 Mute Switch\", WM8400_OUT3_4_VOLUME,\n\tWM8400_OUT4MUTE_SHIFT, 1, 0),\nSOC_SINGLE(\"OUT4 Attenuation Switch\", WM8400_OUT3_4_VOLUME,\n\tWM8400_OUT4ATTN_SHIFT, 1, 0),\n\nSOC_SINGLE(\"Speaker Mode Switch\", WM8400_CLASSD1,\n\tWM8400_CDMODE_SHIFT, 1, 0),\n\nSOC_SINGLE(\"Speaker Output Attenuation Volume\", WM8400_SPEAKER_VOLUME,\n\tWM8400_SPKATTN_SHIFT, WM8400_SPKATTN_MASK, 0),\nSOC_SINGLE(\"Speaker DC Boost Volume\", WM8400_CLASSD3,\n\tWM8400_DCGAIN_SHIFT, 6, 0),\nSOC_SINGLE(\"Speaker AC Boost Volume\", WM8400_CLASSD3,\n\tWM8400_ACGAIN_SHIFT, 6, 0),\n\nWM8400_OUTPGA_SINGLE_R_TLV(\"Left DAC Digital Volume\",\n\tWM8400_LEFT_DAC_DIGITAL_VOLUME, WM8400_DACL_VOL_SHIFT,\n\t127, 0, out_dac_tlv),\n\nWM8400_OUTPGA_SINGLE_R_TLV(\"Right DAC Digital Volume\",\n\tWM8400_RIGHT_DAC_DIGITAL_VOLUME, WM8400_DACR_VOL_SHIFT,\n\t127, 0, out_dac_tlv),\n\nSOC_ENUM(\"Left Digital Sidetone\", wm8400_left_digital_sidetone_enum),\nSOC_ENUM(\"Right Digital Sidetone\", wm8400_right_digital_sidetone_enum),\n\nSOC_SINGLE_TLV(\"Left Digital Sidetone Volume\", WM8400_DIGITAL_SIDE_TONE,\n\tWM8400_ADCL_DAC_SVOL_SHIFT, 15, 0, out_sidetone_tlv),\nSOC_SINGLE_TLV(\"Right Digital Sidetone Volume\", WM8400_DIGITAL_SIDE_TONE,\n\tWM8400_ADCR_DAC_SVOL_SHIFT, 15, 0, out_sidetone_tlv),\n\nSOC_SINGLE(\"ADC Digital High Pass Filter Switch\", WM8400_ADC_CTRL,\n\tWM8400_ADC_HPF_ENA_SHIFT, 1, 0),\n\nSOC_ENUM(\"ADC HPF Mode\", wm8400_right_adcmode_enum),\n\nWM8400_OUTPGA_SINGLE_R_TLV(\"Left ADC Digital Volume\",\n\tWM8400_LEFT_ADC_DIGITAL_VOLUME,\n\tWM8400_ADCL_VOL_SHIFT,\n\tWM8400_ADCL_VOL_MASK,\n\t0,\n\tin_adc_tlv),\n\nWM8400_OUTPGA_SINGLE_R_TLV(\"Right ADC Digital Volume\",\n\tWM8400_RIGHT_ADC_DIGITAL_VOLUME,\n\tWM8400_ADCR_VOL_SHIFT,\n\tWM8400_ADCR_VOL_MASK,\n\t0,\n\tin_adc_tlv),\n\nWM8400_OUTPGA_SINGLE_R_TLV(\"LIN12 Volume\",\n\tWM8400_LEFT_LINE_INPUT_1_2_VOLUME,\n\tWM8400_LIN12VOL_SHIFT,\n\tWM8400_LIN12VOL_MASK,\n\t0,\n\tin_pga_tlv),\n\nSOC_SINGLE(\"LIN12 ZC Switch\", WM8400_LEFT_LINE_INPUT_1_2_VOLUME,\n\tWM8400_LI12ZC_SHIFT, 1, 0),\n\nSOC_SINGLE(\"LIN12 Mute Switch\", WM8400_LEFT_LINE_INPUT_1_2_VOLUME,\n\tWM8400_LI12MUTE_SHIFT, 1, 0),\n\nWM8400_OUTPGA_SINGLE_R_TLV(\"LIN34 Volume\",\n\tWM8400_LEFT_LINE_INPUT_3_4_VOLUME,\n\tWM8400_LIN34VOL_SHIFT,\n\tWM8400_LIN34VOL_MASK,\n\t0,\n\tin_pga_tlv),\n\nSOC_SINGLE(\"LIN34 ZC Switch\", WM8400_LEFT_LINE_INPUT_3_4_VOLUME,\n\tWM8400_LI34ZC_SHIFT, 1, 0),\n\nSOC_SINGLE(\"LIN34 Mute Switch\", WM8400_LEFT_LINE_INPUT_3_4_VOLUME,\n\tWM8400_LI34MUTE_SHIFT, 1, 0),\n\nWM8400_OUTPGA_SINGLE_R_TLV(\"RIN12 Volume\",\n\tWM8400_RIGHT_LINE_INPUT_1_2_VOLUME,\n\tWM8400_RIN12VOL_SHIFT,\n\tWM8400_RIN12VOL_MASK,\n\t0,\n\tin_pga_tlv),\n\nSOC_SINGLE(\"RIN12 ZC Switch\", WM8400_RIGHT_LINE_INPUT_1_2_VOLUME,\n\tWM8400_RI12ZC_SHIFT, 1, 0),\n\nSOC_SINGLE(\"RIN12 Mute Switch\", WM8400_RIGHT_LINE_INPUT_1_2_VOLUME,\n\tWM8400_RI12MUTE_SHIFT, 1, 0),\n\nWM8400_OUTPGA_SINGLE_R_TLV(\"RIN34 Volume\",\n\tWM8400_RIGHT_LINE_INPUT_3_4_VOLUME,\n\tWM8400_RIN34VOL_SHIFT,\n\tWM8400_RIN34VOL_MASK,\n\t0,\n\tin_pga_tlv),\n\nSOC_SINGLE(\"RIN34 ZC Switch\", WM8400_RIGHT_LINE_INPUT_3_4_VOLUME,\n\tWM8400_RI34ZC_SHIFT, 1, 0),\n\nSOC_SINGLE(\"RIN34 Mute Switch\", WM8400_RIGHT_LINE_INPUT_3_4_VOLUME,\n\tWM8400_RI34MUTE_SHIFT, 1, 0),\n\n};\n\n \n\nstatic int outmixer_event (struct snd_soc_dapm_widget *w,\n\tstruct snd_kcontrol * kcontrol, int event)\n{\n\tstruct snd_soc_component *component = snd_soc_dapm_to_component(w->dapm);\n\tstruct soc_mixer_control *mc =\n\t\t(struct soc_mixer_control *)kcontrol->private_value;\n\tu32 reg_shift = mc->shift;\n\tint ret = 0;\n\tu16 reg;\n\n\tswitch (reg_shift) {\n\tcase WM8400_SPEAKER_MIXER | (WM8400_LDSPK << 8) :\n\t\treg = snd_soc_component_read(component, WM8400_OUTPUT_MIXER1);\n\t\tif (reg & WM8400_LDLO) {\n\t\t\tprintk(KERN_WARNING\n\t\t\t\"Cannot set as Output Mixer 1 LDLO Set\\n\");\n\t\t\tret = -1;\n\t\t}\n\t\tbreak;\n\tcase WM8400_SPEAKER_MIXER | (WM8400_RDSPK << 8):\n\t\treg = snd_soc_component_read(component, WM8400_OUTPUT_MIXER2);\n\t\tif (reg & WM8400_RDRO) {\n\t\t\tprintk(KERN_WARNING\n\t\t\t\"Cannot set as Output Mixer 2 RDRO Set\\n\");\n\t\t\tret = -1;\n\t\t}\n\t\tbreak;\n\tcase WM8400_OUTPUT_MIXER1 | (WM8400_LDLO << 8):\n\t\treg = snd_soc_component_read(component, WM8400_SPEAKER_MIXER);\n\t\tif (reg & WM8400_LDSPK) {\n\t\t\tprintk(KERN_WARNING\n\t\t\t\"Cannot set as Speaker Mixer LDSPK Set\\n\");\n\t\t\tret = -1;\n\t\t}\n\t\tbreak;\n\tcase WM8400_OUTPUT_MIXER2 | (WM8400_RDRO << 8):\n\t\treg = snd_soc_component_read(component, WM8400_SPEAKER_MIXER);\n\t\tif (reg & WM8400_RDSPK) {\n\t\t\tprintk(KERN_WARNING\n\t\t\t\"Cannot set as Speaker Mixer RDSPK Set\\n\");\n\t\t\tret = -1;\n\t\t}\n\t\tbreak;\n\t}\n\n\treturn ret;\n}\n\n \nstatic const DECLARE_TLV_DB_SCALE(in_mix_tlv, -1200, 600, 0);\n\n \nstatic const struct snd_kcontrol_new wm8400_dapm_lin12_pga_controls[] = {\nSOC_DAPM_SINGLE(\"LIN1 Switch\", WM8400_INPUT_MIXER2, WM8400_LMN1_SHIFT, 1, 0),\nSOC_DAPM_SINGLE(\"LIN2 Switch\", WM8400_INPUT_MIXER2, WM8400_LMP2_SHIFT, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new wm8400_dapm_lin34_pga_controls[] = {\nSOC_DAPM_SINGLE(\"LIN3 Switch\", WM8400_INPUT_MIXER2, WM8400_LMN3_SHIFT, 1, 0),\nSOC_DAPM_SINGLE(\"LIN4 Switch\", WM8400_INPUT_MIXER2, WM8400_LMP4_SHIFT, 1, 0),\n};\n\n \nstatic const struct snd_kcontrol_new wm8400_dapm_rin12_pga_controls[] = {\nSOC_DAPM_SINGLE(\"RIN1 Switch\", WM8400_INPUT_MIXER2, WM8400_RMN1_SHIFT, 1, 0),\nSOC_DAPM_SINGLE(\"RIN2 Switch\", WM8400_INPUT_MIXER2, WM8400_RMP2_SHIFT, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new wm8400_dapm_rin34_pga_controls[] = {\nSOC_DAPM_SINGLE(\"RIN3 Switch\", WM8400_INPUT_MIXER2, WM8400_RMN3_SHIFT, 1, 0),\nSOC_DAPM_SINGLE(\"RIN4 Switch\", WM8400_INPUT_MIXER2, WM8400_RMP4_SHIFT, 1, 0),\n};\n\n \nstatic const struct snd_kcontrol_new wm8400_dapm_inmixl_controls[] = {\nSOC_DAPM_SINGLE_TLV(\"Record Left Volume\", WM8400_INPUT_MIXER3,\n\tWM8400_LDBVOL_SHIFT, WM8400_LDBVOL_MASK, 0, in_mix_tlv),\nSOC_DAPM_SINGLE_TLV(\"LIN2 Volume\", WM8400_INPUT_MIXER5, WM8400_LI2BVOL_SHIFT,\n\t7, 0, in_mix_tlv),\nSOC_DAPM_SINGLE(\"LINPGA12 Switch\", WM8400_INPUT_MIXER3, WM8400_L12MNB_SHIFT,\n\t\t1, 0),\nSOC_DAPM_SINGLE(\"LINPGA34 Switch\", WM8400_INPUT_MIXER3, WM8400_L34MNB_SHIFT,\n\t\t1, 0),\n};\n\n \nstatic const struct snd_kcontrol_new wm8400_dapm_inmixr_controls[] = {\nSOC_DAPM_SINGLE_TLV(\"Record Right Volume\", WM8400_INPUT_MIXER4,\n\tWM8400_RDBVOL_SHIFT, WM8400_RDBVOL_MASK, 0, in_mix_tlv),\nSOC_DAPM_SINGLE_TLV(\"RIN2 Volume\", WM8400_INPUT_MIXER6, WM8400_RI2BVOL_SHIFT,\n\t7, 0, in_mix_tlv),\nSOC_DAPM_SINGLE(\"RINPGA12 Switch\", WM8400_INPUT_MIXER3, WM8400_L12MNB_SHIFT,\n\t1, 0),\nSOC_DAPM_SINGLE(\"RINPGA34 Switch\", WM8400_INPUT_MIXER3, WM8400_L34MNB_SHIFT,\n\t1, 0),\n};\n\n \nstatic const char *wm8400_ainlmux[] =\n\t{\"INMIXL Mix\", \"RXVOICE Mix\", \"DIFFINL Mix\"};\n\nstatic SOC_ENUM_SINGLE_DECL(wm8400_ainlmux_enum,\n\t\t\t    WM8400_INPUT_MIXER1,\n\t\t\t    WM8400_AINLMODE_SHIFT,\n\t\t\t    wm8400_ainlmux);\n\nstatic const struct snd_kcontrol_new wm8400_dapm_ainlmux_controls =\nSOC_DAPM_ENUM(\"Route\", wm8400_ainlmux_enum);\n\n \n\n \nstatic const char *wm8400_ainrmux[] =\n\t{\"INMIXR Mix\", \"RXVOICE Mix\", \"DIFFINR Mix\"};\n\nstatic SOC_ENUM_SINGLE_DECL(wm8400_ainrmux_enum,\n\t\t\t    WM8400_INPUT_MIXER1,\n\t\t\t    WM8400_AINRMODE_SHIFT,\n\t\t\t    wm8400_ainrmux);\n\nstatic const struct snd_kcontrol_new wm8400_dapm_ainrmux_controls =\nSOC_DAPM_ENUM(\"Route\", wm8400_ainrmux_enum);\n\n \nstatic const struct snd_kcontrol_new wm8400_dapm_lomix_controls[] = {\nSOC_DAPM_SINGLE(\"LOMIX Right ADC Bypass Switch\", WM8400_OUTPUT_MIXER1,\n\tWM8400_LRBLO_SHIFT, 1, 0),\nSOC_DAPM_SINGLE(\"LOMIX Left ADC Bypass Switch\", WM8400_OUTPUT_MIXER1,\n\tWM8400_LLBLO_SHIFT, 1, 0),\nSOC_DAPM_SINGLE(\"LOMIX RIN3 Bypass Switch\", WM8400_OUTPUT_MIXER1,\n\tWM8400_LRI3LO_SHIFT, 1, 0),\nSOC_DAPM_SINGLE(\"LOMIX LIN3 Bypass Switch\", WM8400_OUTPUT_MIXER1,\n\tWM8400_LLI3LO_SHIFT, 1, 0),\nSOC_DAPM_SINGLE(\"LOMIX RIN12 PGA Bypass Switch\", WM8400_OUTPUT_MIXER1,\n\tWM8400_LR12LO_SHIFT, 1, 0),\nSOC_DAPM_SINGLE(\"LOMIX LIN12 PGA Bypass Switch\", WM8400_OUTPUT_MIXER1,\n\tWM8400_LL12LO_SHIFT, 1, 0),\nSOC_DAPM_SINGLE(\"LOMIX Left DAC Switch\", WM8400_OUTPUT_MIXER1,\n\tWM8400_LDLO_SHIFT, 1, 0),\n};\n\n \nstatic const struct snd_kcontrol_new wm8400_dapm_romix_controls[] = {\nSOC_DAPM_SINGLE(\"ROMIX Left ADC Bypass Switch\", WM8400_OUTPUT_MIXER2,\n\tWM8400_RLBRO_SHIFT, 1, 0),\nSOC_DAPM_SINGLE(\"ROMIX Right ADC Bypass Switch\", WM8400_OUTPUT_MIXER2,\n\tWM8400_RRBRO_SHIFT, 1, 0),\nSOC_DAPM_SINGLE(\"ROMIX LIN3 Bypass Switch\", WM8400_OUTPUT_MIXER2,\n\tWM8400_RLI3RO_SHIFT, 1, 0),\nSOC_DAPM_SINGLE(\"ROMIX RIN3 Bypass Switch\", WM8400_OUTPUT_MIXER2,\n\tWM8400_RRI3RO_SHIFT, 1, 0),\nSOC_DAPM_SINGLE(\"ROMIX LIN12 PGA Bypass Switch\", WM8400_OUTPUT_MIXER2,\n\tWM8400_RL12RO_SHIFT, 1, 0),\nSOC_DAPM_SINGLE(\"ROMIX RIN12 PGA Bypass Switch\", WM8400_OUTPUT_MIXER2,\n\tWM8400_RR12RO_SHIFT, 1, 0),\nSOC_DAPM_SINGLE(\"ROMIX Right DAC Switch\", WM8400_OUTPUT_MIXER2,\n\tWM8400_RDRO_SHIFT, 1, 0),\n};\n\n \nstatic const struct snd_kcontrol_new wm8400_dapm_lonmix_controls[] = {\nSOC_DAPM_SINGLE(\"LONMIX Left Mixer PGA Switch\", WM8400_LINE_MIXER1,\n\tWM8400_LLOPGALON_SHIFT, 1, 0),\nSOC_DAPM_SINGLE(\"LONMIX Right Mixer PGA Switch\", WM8400_LINE_MIXER1,\n\tWM8400_LROPGALON_SHIFT, 1, 0),\nSOC_DAPM_SINGLE(\"LONMIX Inverted LOP Switch\", WM8400_LINE_MIXER1,\n\tWM8400_LOPLON_SHIFT, 1, 0),\n};\n\n \nstatic const struct snd_kcontrol_new wm8400_dapm_lopmix_controls[] = {\nSOC_DAPM_SINGLE(\"LOPMIX Right Mic Bypass Switch\", WM8400_LINE_MIXER1,\n\tWM8400_LR12LOP_SHIFT, 1, 0),\nSOC_DAPM_SINGLE(\"LOPMIX Left Mic Bypass Switch\", WM8400_LINE_MIXER1,\n\tWM8400_LL12LOP_SHIFT, 1, 0),\nSOC_DAPM_SINGLE(\"LOPMIX Left Mixer PGA Switch\", WM8400_LINE_MIXER1,\n\tWM8400_LLOPGALOP_SHIFT, 1, 0),\n};\n\n \nstatic const struct snd_kcontrol_new wm8400_dapm_ronmix_controls[] = {\nSOC_DAPM_SINGLE(\"RONMIX Right Mixer PGA Switch\", WM8400_LINE_MIXER2,\n\tWM8400_RROPGARON_SHIFT, 1, 0),\nSOC_DAPM_SINGLE(\"RONMIX Left Mixer PGA Switch\", WM8400_LINE_MIXER2,\n\tWM8400_RLOPGARON_SHIFT, 1, 0),\nSOC_DAPM_SINGLE(\"RONMIX Inverted ROP Switch\", WM8400_LINE_MIXER2,\n\tWM8400_ROPRON_SHIFT, 1, 0),\n};\n\n \nstatic const struct snd_kcontrol_new wm8400_dapm_ropmix_controls[] = {\nSOC_DAPM_SINGLE(\"ROPMIX Left Mic Bypass Switch\", WM8400_LINE_MIXER2,\n\tWM8400_RL12ROP_SHIFT, 1, 0),\nSOC_DAPM_SINGLE(\"ROPMIX Right Mic Bypass Switch\", WM8400_LINE_MIXER2,\n\tWM8400_RR12ROP_SHIFT, 1, 0),\nSOC_DAPM_SINGLE(\"ROPMIX Right Mixer PGA Switch\", WM8400_LINE_MIXER2,\n\tWM8400_RROPGAROP_SHIFT, 1, 0),\n};\n\n \nstatic const struct snd_kcontrol_new wm8400_dapm_out3mix_controls[] = {\nSOC_DAPM_SINGLE(\"OUT3MIX LIN4/RXP Bypass Switch\", WM8400_OUT3_4_MIXER,\n\tWM8400_LI4O3_SHIFT, 1, 0),\nSOC_DAPM_SINGLE(\"OUT3MIX Left Out PGA Switch\", WM8400_OUT3_4_MIXER,\n\tWM8400_LPGAO3_SHIFT, 1, 0),\n};\n\n \nstatic const struct snd_kcontrol_new wm8400_dapm_out4mix_controls[] = {\nSOC_DAPM_SINGLE(\"OUT4MIX Right Out PGA Switch\", WM8400_OUT3_4_MIXER,\n\tWM8400_RPGAO4_SHIFT, 1, 0),\nSOC_DAPM_SINGLE(\"OUT4MIX RIN4/RXP Bypass Switch\", WM8400_OUT3_4_MIXER,\n\tWM8400_RI4O4_SHIFT, 1, 0),\n};\n\n \nstatic const struct snd_kcontrol_new wm8400_dapm_spkmix_controls[] = {\nSOC_DAPM_SINGLE(\"SPKMIX LIN2 Bypass Switch\", WM8400_SPEAKER_MIXER,\n\tWM8400_LI2SPK_SHIFT, 1, 0),\nSOC_DAPM_SINGLE(\"SPKMIX LADC Bypass Switch\", WM8400_SPEAKER_MIXER,\n\tWM8400_LB2SPK_SHIFT, 1, 0),\nSOC_DAPM_SINGLE(\"SPKMIX Left Mixer PGA Switch\", WM8400_SPEAKER_MIXER,\n\tWM8400_LOPGASPK_SHIFT, 1, 0),\nSOC_DAPM_SINGLE(\"SPKMIX Left DAC Switch\", WM8400_SPEAKER_MIXER,\n\tWM8400_LDSPK_SHIFT, 1, 0),\nSOC_DAPM_SINGLE(\"SPKMIX Right DAC Switch\", WM8400_SPEAKER_MIXER,\n\tWM8400_RDSPK_SHIFT, 1, 0),\nSOC_DAPM_SINGLE(\"SPKMIX Right Mixer PGA Switch\", WM8400_SPEAKER_MIXER,\n\tWM8400_ROPGASPK_SHIFT, 1, 0),\nSOC_DAPM_SINGLE(\"SPKMIX RADC Bypass Switch\", WM8400_SPEAKER_MIXER,\n\tWM8400_RL12ROP_SHIFT, 1, 0),\nSOC_DAPM_SINGLE(\"SPKMIX RIN2 Bypass Switch\", WM8400_SPEAKER_MIXER,\n\tWM8400_RI2SPK_SHIFT, 1, 0),\n};\n\nstatic const struct snd_soc_dapm_widget wm8400_dapm_widgets[] = {\n \n \nSND_SOC_DAPM_INPUT(\"LIN1\"),\nSND_SOC_DAPM_INPUT(\"LIN2\"),\nSND_SOC_DAPM_INPUT(\"LIN3\"),\nSND_SOC_DAPM_INPUT(\"LIN4/RXN\"),\nSND_SOC_DAPM_INPUT(\"RIN3\"),\nSND_SOC_DAPM_INPUT(\"RIN4/RXP\"),\nSND_SOC_DAPM_INPUT(\"RIN1\"),\nSND_SOC_DAPM_INPUT(\"RIN2\"),\nSND_SOC_DAPM_INPUT(\"Internal ADC Source\"),\n\n \nSND_SOC_DAPM_ADC(\"Left ADC\", \"Left Capture\", WM8400_POWER_MANAGEMENT_2,\n\tWM8400_ADCL_ENA_SHIFT, 0),\nSND_SOC_DAPM_ADC(\"Right ADC\", \"Right Capture\", WM8400_POWER_MANAGEMENT_2,\n\tWM8400_ADCR_ENA_SHIFT, 0),\n\n \nSND_SOC_DAPM_MIXER(\"LIN12 PGA\", WM8400_POWER_MANAGEMENT_2,\n\t\t   WM8400_LIN12_ENA_SHIFT,\n\t\t   0, &wm8400_dapm_lin12_pga_controls[0],\n\t\t   ARRAY_SIZE(wm8400_dapm_lin12_pga_controls)),\nSND_SOC_DAPM_MIXER(\"LIN34 PGA\", WM8400_POWER_MANAGEMENT_2,\n\t\t   WM8400_LIN34_ENA_SHIFT,\n\t\t   0, &wm8400_dapm_lin34_pga_controls[0],\n\t\t   ARRAY_SIZE(wm8400_dapm_lin34_pga_controls)),\nSND_SOC_DAPM_MIXER(\"RIN12 PGA\", WM8400_POWER_MANAGEMENT_2,\n\t\t   WM8400_RIN12_ENA_SHIFT,\n\t\t   0, &wm8400_dapm_rin12_pga_controls[0],\n\t\t   ARRAY_SIZE(wm8400_dapm_rin12_pga_controls)),\nSND_SOC_DAPM_MIXER(\"RIN34 PGA\", WM8400_POWER_MANAGEMENT_2,\n\t\t   WM8400_RIN34_ENA_SHIFT,\n\t\t   0, &wm8400_dapm_rin34_pga_controls[0],\n\t\t   ARRAY_SIZE(wm8400_dapm_rin34_pga_controls)),\n\nSND_SOC_DAPM_SUPPLY(\"INL\", WM8400_POWER_MANAGEMENT_2, WM8400_AINL_ENA_SHIFT,\n\t\t    0, NULL, 0),\nSND_SOC_DAPM_SUPPLY(\"INR\", WM8400_POWER_MANAGEMENT_2, WM8400_AINR_ENA_SHIFT,\n\t\t    0, NULL, 0),\n\n \nSND_SOC_DAPM_MIXER(\"INMIXL\", SND_SOC_NOPM, 0, 0,\n\t&wm8400_dapm_inmixl_controls[0],\n\tARRAY_SIZE(wm8400_dapm_inmixl_controls)),\n\n \nSND_SOC_DAPM_MUX(\"AILNMUX\", SND_SOC_NOPM, 0, 0, &wm8400_dapm_ainlmux_controls),\n\n \nSND_SOC_DAPM_MIXER(\"INMIXR\", SND_SOC_NOPM, 0, 0,\n\t&wm8400_dapm_inmixr_controls[0],\n\tARRAY_SIZE(wm8400_dapm_inmixr_controls)),\n\n \nSND_SOC_DAPM_MUX(\"AIRNMUX\", SND_SOC_NOPM, 0, 0, &wm8400_dapm_ainrmux_controls),\n\n \n \nSND_SOC_DAPM_DAC(\"Left DAC\", \"Left Playback\", WM8400_POWER_MANAGEMENT_3,\n\tWM8400_DACL_ENA_SHIFT, 0),\nSND_SOC_DAPM_DAC(\"Right DAC\", \"Right Playback\", WM8400_POWER_MANAGEMENT_3,\n\tWM8400_DACR_ENA_SHIFT, 0),\n\n \nSND_SOC_DAPM_MIXER_E(\"LOMIX\", WM8400_POWER_MANAGEMENT_3,\n\t\t     WM8400_LOMIX_ENA_SHIFT,\n\t\t     0, &wm8400_dapm_lomix_controls[0],\n\t\t     ARRAY_SIZE(wm8400_dapm_lomix_controls),\n\t\t     outmixer_event, SND_SOC_DAPM_PRE_REG),\n\n \nSND_SOC_DAPM_MIXER(\"LONMIX\", WM8400_POWER_MANAGEMENT_3, WM8400_LON_ENA_SHIFT,\n\t\t   0, &wm8400_dapm_lonmix_controls[0],\n\t\t   ARRAY_SIZE(wm8400_dapm_lonmix_controls)),\n\n \nSND_SOC_DAPM_MIXER(\"LOPMIX\", WM8400_POWER_MANAGEMENT_3, WM8400_LOP_ENA_SHIFT,\n\t\t   0, &wm8400_dapm_lopmix_controls[0],\n\t\t   ARRAY_SIZE(wm8400_dapm_lopmix_controls)),\n\n \nSND_SOC_DAPM_MIXER(\"OUT3MIX\", WM8400_POWER_MANAGEMENT_1, WM8400_OUT3_ENA_SHIFT,\n\t\t   0, &wm8400_dapm_out3mix_controls[0],\n\t\t   ARRAY_SIZE(wm8400_dapm_out3mix_controls)),\n\n \nSND_SOC_DAPM_MIXER_E(\"SPKMIX\", WM8400_POWER_MANAGEMENT_1, WM8400_SPK_ENA_SHIFT,\n\t\t     0, &wm8400_dapm_spkmix_controls[0],\n\t\t     ARRAY_SIZE(wm8400_dapm_spkmix_controls), outmixer_event,\n\t\t     SND_SOC_DAPM_PRE_REG),\n\n \nSND_SOC_DAPM_MIXER(\"OUT4MIX\", WM8400_POWER_MANAGEMENT_1, WM8400_OUT4_ENA_SHIFT,\n\t0, &wm8400_dapm_out4mix_controls[0],\n\tARRAY_SIZE(wm8400_dapm_out4mix_controls)),\n\n \nSND_SOC_DAPM_MIXER(\"ROPMIX\", WM8400_POWER_MANAGEMENT_3, WM8400_ROP_ENA_SHIFT,\n\t\t   0, &wm8400_dapm_ropmix_controls[0],\n\t\t   ARRAY_SIZE(wm8400_dapm_ropmix_controls)),\n\n \nSND_SOC_DAPM_MIXER(\"RONMIX\", WM8400_POWER_MANAGEMENT_3, WM8400_RON_ENA_SHIFT,\n\t\t   0, &wm8400_dapm_ronmix_controls[0],\n\t\t   ARRAY_SIZE(wm8400_dapm_ronmix_controls)),\n\n \nSND_SOC_DAPM_MIXER_E(\"ROMIX\", WM8400_POWER_MANAGEMENT_3,\n\t\t     WM8400_ROMIX_ENA_SHIFT,\n\t\t     0, &wm8400_dapm_romix_controls[0],\n\t\t     ARRAY_SIZE(wm8400_dapm_romix_controls),\n\t\t     outmixer_event, SND_SOC_DAPM_PRE_REG),\n\n \nSND_SOC_DAPM_PGA(\"LOUT PGA\", WM8400_POWER_MANAGEMENT_1, WM8400_LOUT_ENA_SHIFT,\n\t\t 0, NULL, 0),\n\n \nSND_SOC_DAPM_PGA(\"ROUT PGA\", WM8400_POWER_MANAGEMENT_1, WM8400_ROUT_ENA_SHIFT,\n\t\t 0, NULL, 0),\n\n \nSND_SOC_DAPM_PGA(\"LOPGA\", WM8400_POWER_MANAGEMENT_3, WM8400_LOPGA_ENA_SHIFT, 0,\n\tNULL, 0),\n\n \nSND_SOC_DAPM_PGA(\"ROPGA\", WM8400_POWER_MANAGEMENT_3, WM8400_ROPGA_ENA_SHIFT, 0,\n\tNULL, 0),\n\n \nSND_SOC_DAPM_SUPPLY(\"MICBIAS\", WM8400_POWER_MANAGEMENT_1,\n\t\t    WM8400_MIC1BIAS_ENA_SHIFT, 0, NULL, 0),\n\nSND_SOC_DAPM_OUTPUT(\"LON\"),\nSND_SOC_DAPM_OUTPUT(\"LOP\"),\nSND_SOC_DAPM_OUTPUT(\"OUT3\"),\nSND_SOC_DAPM_OUTPUT(\"LOUT\"),\nSND_SOC_DAPM_OUTPUT(\"SPKN\"),\nSND_SOC_DAPM_OUTPUT(\"SPKP\"),\nSND_SOC_DAPM_OUTPUT(\"ROUT\"),\nSND_SOC_DAPM_OUTPUT(\"OUT4\"),\nSND_SOC_DAPM_OUTPUT(\"ROP\"),\nSND_SOC_DAPM_OUTPUT(\"RON\"),\n\nSND_SOC_DAPM_OUTPUT(\"Internal DAC Sink\"),\n};\n\nstatic const struct snd_soc_dapm_route wm8400_dapm_routes[] = {\n\t \n\t{\"Internal DAC Sink\", NULL, \"Left DAC\"},\n\t{\"Internal DAC Sink\", NULL, \"Right DAC\"},\n\n\t \n\t{\"Left ADC\", NULL, \"Internal ADC Source\"},\n\t{\"Right ADC\", NULL, \"Internal ADC Source\"},\n\n\t \n\t \n\t{\"LIN12 PGA\", \"LIN1 Switch\", \"LIN1\"},\n\t{\"LIN12 PGA\", \"LIN2 Switch\", \"LIN2\"},\n\t \n\t{\"LIN34 PGA\", \"LIN3 Switch\", \"LIN3\"},\n\t{\"LIN34 PGA\", \"LIN4 Switch\", \"LIN4/RXN\"},\n\t \n\t{\"INMIXL\", NULL, \"INL\"},\n\t{\"INMIXL\", \"Record Left Volume\", \"LOMIX\"},\n\t{\"INMIXL\", \"LIN2 Volume\", \"LIN2\"},\n\t{\"INMIXL\", \"LINPGA12 Switch\", \"LIN12 PGA\"},\n\t{\"INMIXL\", \"LINPGA34 Switch\", \"LIN34 PGA\"},\n\t \n\t{\"AILNMUX\", NULL, \"INL\"},\n\t{\"AILNMUX\", \"INMIXL Mix\", \"INMIXL\"},\n\t{\"AILNMUX\", \"DIFFINL Mix\", \"LIN12 PGA\"},\n\t{\"AILNMUX\", \"DIFFINL Mix\", \"LIN34 PGA\"},\n\t{\"AILNMUX\", \"RXVOICE Mix\", \"LIN4/RXN\"},\n\t{\"AILNMUX\", \"RXVOICE Mix\", \"RIN4/RXP\"},\n\t \n\t{\"Left ADC\", NULL, \"AILNMUX\"},\n\n\t \n\t{\"RIN12 PGA\", \"RIN1 Switch\", \"RIN1\"},\n\t{\"RIN12 PGA\", \"RIN2 Switch\", \"RIN2\"},\n\t \n\t{\"RIN34 PGA\", \"RIN3 Switch\", \"RIN3\"},\n\t{\"RIN34 PGA\", \"RIN4 Switch\", \"RIN4/RXP\"},\n\t \n\t{\"INMIXR\", NULL, \"INR\"},\n\t{\"INMIXR\", \"Record Right Volume\", \"ROMIX\"},\n\t{\"INMIXR\", \"RIN2 Volume\", \"RIN2\"},\n\t{\"INMIXR\", \"RINPGA12 Switch\", \"RIN12 PGA\"},\n\t{\"INMIXR\", \"RINPGA34 Switch\", \"RIN34 PGA\"},\n\t \n\t{\"AIRNMUX\", NULL, \"INR\"},\n\t{\"AIRNMUX\", \"INMIXR Mix\", \"INMIXR\"},\n\t{\"AIRNMUX\", \"DIFFINR Mix\", \"RIN12 PGA\"},\n\t{\"AIRNMUX\", \"DIFFINR Mix\", \"RIN34 PGA\"},\n\t{\"AIRNMUX\", \"RXVOICE Mix\", \"LIN4/RXN\"},\n\t{\"AIRNMUX\", \"RXVOICE Mix\", \"RIN4/RXP\"},\n\t \n\t{\"Right ADC\", NULL, \"AIRNMUX\"},\n\n\t \n\t{\"LOMIX\", \"LOMIX RIN3 Bypass Switch\", \"RIN3\"},\n\t{\"LOMIX\", \"LOMIX LIN3 Bypass Switch\", \"LIN3\"},\n\t{\"LOMIX\", \"LOMIX LIN12 PGA Bypass Switch\", \"LIN12 PGA\"},\n\t{\"LOMIX\", \"LOMIX RIN12 PGA Bypass Switch\", \"RIN12 PGA\"},\n\t{\"LOMIX\", \"LOMIX Right ADC Bypass Switch\", \"AIRNMUX\"},\n\t{\"LOMIX\", \"LOMIX Left ADC Bypass Switch\", \"AILNMUX\"},\n\t{\"LOMIX\", \"LOMIX Left DAC Switch\", \"Left DAC\"},\n\n\t \n\t{\"ROMIX\", \"ROMIX RIN3 Bypass Switch\", \"RIN3\"},\n\t{\"ROMIX\", \"ROMIX LIN3 Bypass Switch\", \"LIN3\"},\n\t{\"ROMIX\", \"ROMIX LIN12 PGA Bypass Switch\", \"LIN12 PGA\"},\n\t{\"ROMIX\", \"ROMIX RIN12 PGA Bypass Switch\", \"RIN12 PGA\"},\n\t{\"ROMIX\", \"ROMIX Right ADC Bypass Switch\", \"AIRNMUX\"},\n\t{\"ROMIX\", \"ROMIX Left ADC Bypass Switch\", \"AILNMUX\"},\n\t{\"ROMIX\", \"ROMIX Right DAC Switch\", \"Right DAC\"},\n\n\t \n\t{\"SPKMIX\", \"SPKMIX LIN2 Bypass Switch\", \"LIN2\"},\n\t{\"SPKMIX\", \"SPKMIX RIN2 Bypass Switch\", \"RIN2\"},\n\t{\"SPKMIX\", \"SPKMIX LADC Bypass Switch\", \"AILNMUX\"},\n\t{\"SPKMIX\", \"SPKMIX RADC Bypass Switch\", \"AIRNMUX\"},\n\t{\"SPKMIX\", \"SPKMIX Left Mixer PGA Switch\", \"LOPGA\"},\n\t{\"SPKMIX\", \"SPKMIX Right Mixer PGA Switch\", \"ROPGA\"},\n\t{\"SPKMIX\", \"SPKMIX Right DAC Switch\", \"Right DAC\"},\n\t{\"SPKMIX\", \"SPKMIX Left DAC Switch\", \"Right DAC\"},\n\n\t \n\t{\"LONMIX\", \"LONMIX Left Mixer PGA Switch\", \"LOPGA\"},\n\t{\"LONMIX\", \"LONMIX Right Mixer PGA Switch\", \"ROPGA\"},\n\t{\"LONMIX\", \"LONMIX Inverted LOP Switch\", \"LOPMIX\"},\n\n\t \n\t{\"LOPMIX\", \"LOPMIX Right Mic Bypass Switch\", \"RIN12 PGA\"},\n\t{\"LOPMIX\", \"LOPMIX Left Mic Bypass Switch\", \"LIN12 PGA\"},\n\t{\"LOPMIX\", \"LOPMIX Left Mixer PGA Switch\", \"LOPGA\"},\n\n\t \n\t{\"OUT3MIX\", \"OUT3MIX LIN4/RXP Bypass Switch\", \"LIN4/RXN\"},\n\t{\"OUT3MIX\", \"OUT3MIX Left Out PGA Switch\", \"LOPGA\"},\n\n\t \n\t{\"OUT4MIX\", \"OUT4MIX Right Out PGA Switch\", \"ROPGA\"},\n\t{\"OUT4MIX\", \"OUT4MIX RIN4/RXP Bypass Switch\", \"RIN4/RXP\"},\n\n\t \n\t{\"RONMIX\", \"RONMIX Right Mixer PGA Switch\", \"ROPGA\"},\n\t{\"RONMIX\", \"RONMIX Left Mixer PGA Switch\", \"LOPGA\"},\n\t{\"RONMIX\", \"RONMIX Inverted ROP Switch\", \"ROPMIX\"},\n\n\t \n\t{\"ROPMIX\", \"ROPMIX Left Mic Bypass Switch\", \"LIN12 PGA\"},\n\t{\"ROPMIX\", \"ROPMIX Right Mic Bypass Switch\", \"RIN12 PGA\"},\n\t{\"ROPMIX\", \"ROPMIX Right Mixer PGA Switch\", \"ROPGA\"},\n\n\t \n\t{\"LOPGA\", NULL, \"LOMIX\"},\n\t{\"ROPGA\", NULL, \"ROMIX\"},\n\n\t{\"LOUT PGA\", NULL, \"LOMIX\"},\n\t{\"ROUT PGA\", NULL, \"ROMIX\"},\n\n\t \n\t{\"LON\", NULL, \"LONMIX\"},\n\t{\"LOP\", NULL, \"LOPMIX\"},\n\t{\"OUT3\", NULL, \"OUT3MIX\"},\n\t{\"LOUT\", NULL, \"LOUT PGA\"},\n\t{\"SPKN\", NULL, \"SPKMIX\"},\n\t{\"ROUT\", NULL, \"ROUT PGA\"},\n\t{\"OUT4\", NULL, \"OUT4MIX\"},\n\t{\"ROP\", NULL, \"ROPMIX\"},\n\t{\"RON\", NULL, \"RONMIX\"},\n};\n\n \nstatic int wm8400_set_dai_sysclk(struct snd_soc_dai *codec_dai,\n\t\tint clk_id, unsigned int freq, int dir)\n{\n\tstruct snd_soc_component *component = codec_dai->component;\n\tstruct wm8400_priv *wm8400 = snd_soc_component_get_drvdata(component);\n\n\twm8400->sysclk = freq;\n\treturn 0;\n}\n\nstruct fll_factors {\n\tu16 n;\n\tu16 k;\n\tu16 outdiv;\n\tu16 fratio;\n\tu16 freq_ref;\n};\n\n#define FIXED_FLL_SIZE ((1 << 16) * 10)\n\nstatic int fll_factors(struct wm8400_priv *wm8400, struct fll_factors *factors,\n\t\t       unsigned int Fref, unsigned int Fout)\n{\n\tu64 Kpart;\n\tunsigned int K, Nmod, target;\n\n\tfactors->outdiv = 2;\n\twhile (Fout * factors->outdiv <  90000000 ||\n\t       Fout * factors->outdiv > 100000000) {\n\t\tfactors->outdiv *= 2;\n\t\tif (factors->outdiv > 32) {\n\t\t\tdev_err(wm8400->wm8400->dev,\n\t\t\t\t\"Unsupported FLL output frequency %uHz\\n\",\n\t\t\t\tFout);\n\t\t\treturn -EINVAL;\n\t\t}\n\t}\n\ttarget = Fout * factors->outdiv;\n\tfactors->outdiv = factors->outdiv >> 2;\n\n\tif (Fref < 48000)\n\t\tfactors->freq_ref = 1;\n\telse\n\t\tfactors->freq_ref = 0;\n\n\tif (Fref < 1000000)\n\t\tfactors->fratio = 9;\n\telse\n\t\tfactors->fratio = 0;\n\n\t \n\tdo {\n\t\tif (Fref < 1000000)\n\t\t\tfactors->fratio--;\n\t\telse\n\t\t\tfactors->fratio++;\n\n\t\tif (factors->fratio < 1 || factors->fratio > 8) {\n\t\t\tdev_err(wm8400->wm8400->dev,\n\t\t\t\t\"Unable to calculate FRATIO\\n\");\n\t\t\treturn -EINVAL;\n\t\t}\n\n\t\tfactors->n = target / (Fref * factors->fratio);\n\t\tNmod = target % (Fref * factors->fratio);\n\t} while (Nmod == 0);\n\n\t \n\tKpart = FIXED_FLL_SIZE * (long long)Nmod;\n\n\tdo_div(Kpart, (Fref * factors->fratio));\n\n\tK = Kpart & 0xFFFFFFFF;\n\n\tif ((K % 10) >= 5)\n\t\tK += 5;\n\n\t \n\tfactors->k = K / 10;\n\n\tdev_dbg(wm8400->wm8400->dev,\n\t\t\"FLL: Fref=%u Fout=%u N=%x K=%x, FRATIO=%x OUTDIV=%x\\n\",\n\t\tFref, Fout,\n\t\tfactors->n, factors->k, factors->fratio, factors->outdiv);\n\n\treturn 0;\n}\n\nstatic int wm8400_set_dai_pll(struct snd_soc_dai *codec_dai, int pll_id,\n\t\t\t      int source, unsigned int freq_in,\n\t\t\t      unsigned int freq_out)\n{\n\tstruct snd_soc_component *component = codec_dai->component;\n\tstruct wm8400_priv *wm8400 = snd_soc_component_get_drvdata(component);\n\tstruct fll_factors factors;\n\tint ret;\n\tu16 reg;\n\n\tif (freq_in == wm8400->fll_in && freq_out == wm8400->fll_out)\n\t\treturn 0;\n\n\tif (freq_out) {\n\t\tret = fll_factors(wm8400, &factors, freq_in, freq_out);\n\t\tif (ret != 0)\n\t\t\treturn ret;\n\t} else {\n\t\t \n\t\tmemset(&factors, 0, sizeof(factors));\n\t}\n\n\twm8400->fll_out = freq_out;\n\twm8400->fll_in = freq_in;\n\n\t \n\treg = snd_soc_component_read(component, WM8400_POWER_MANAGEMENT_2);\n\treg &= ~WM8400_FLL_ENA;\n\tsnd_soc_component_write(component, WM8400_POWER_MANAGEMENT_2, reg);\n\n\treg = snd_soc_component_read(component, WM8400_FLL_CONTROL_1);\n\treg &= ~WM8400_FLL_OSC_ENA;\n\tsnd_soc_component_write(component, WM8400_FLL_CONTROL_1, reg);\n\n\tif (!freq_out)\n\t\treturn 0;\n\n\treg &= ~(WM8400_FLL_REF_FREQ | WM8400_FLL_FRATIO_MASK);\n\treg |= WM8400_FLL_FRAC | factors.fratio;\n\treg |= factors.freq_ref << WM8400_FLL_REF_FREQ_SHIFT;\n\tsnd_soc_component_write(component, WM8400_FLL_CONTROL_1, reg);\n\n\tsnd_soc_component_write(component, WM8400_FLL_CONTROL_2, factors.k);\n\tsnd_soc_component_write(component, WM8400_FLL_CONTROL_3, factors.n);\n\n\treg = snd_soc_component_read(component, WM8400_FLL_CONTROL_4);\n\treg &= ~WM8400_FLL_OUTDIV_MASK;\n\treg |= factors.outdiv;\n\tsnd_soc_component_write(component, WM8400_FLL_CONTROL_4, reg);\n\n\treturn 0;\n}\n\n \nstatic int wm8400_set_dai_fmt(struct snd_soc_dai *codec_dai,\n\t\tunsigned int fmt)\n{\n\tstruct snd_soc_component *component = codec_dai->component;\n\tu16 audio1, audio3;\n\n\taudio1 = snd_soc_component_read(component, WM8400_AUDIO_INTERFACE_1);\n\taudio3 = snd_soc_component_read(component, WM8400_AUDIO_INTERFACE_3);\n\n\t \n\tswitch (fmt & SND_SOC_DAIFMT_MASTER_MASK) {\n\tcase SND_SOC_DAIFMT_CBS_CFS:\n\t\taudio3 &= ~WM8400_AIF_MSTR1;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_CBM_CFM:\n\t\taudio3 |= WM8400_AIF_MSTR1;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\taudio1 &= ~WM8400_AIF_FMT_MASK;\n\n\t \n\tswitch (fmt & SND_SOC_DAIFMT_FORMAT_MASK) {\n\tcase SND_SOC_DAIFMT_I2S:\n\t\taudio1 |= WM8400_AIF_FMT_I2S;\n\t\taudio1 &= ~WM8400_AIF_LRCLK_INV;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_RIGHT_J:\n\t\taudio1 |= WM8400_AIF_FMT_RIGHTJ;\n\t\taudio1 &= ~WM8400_AIF_LRCLK_INV;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_LEFT_J:\n\t\taudio1 |= WM8400_AIF_FMT_LEFTJ;\n\t\taudio1 &= ~WM8400_AIF_LRCLK_INV;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_DSP_A:\n\t\taudio1 |= WM8400_AIF_FMT_DSP;\n\t\taudio1 &= ~WM8400_AIF_LRCLK_INV;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_DSP_B:\n\t\taudio1 |= WM8400_AIF_FMT_DSP | WM8400_AIF_LRCLK_INV;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tsnd_soc_component_write(component, WM8400_AUDIO_INTERFACE_1, audio1);\n\tsnd_soc_component_write(component, WM8400_AUDIO_INTERFACE_3, audio3);\n\treturn 0;\n}\n\nstatic int wm8400_set_dai_clkdiv(struct snd_soc_dai *codec_dai,\n\t\tint div_id, int div)\n{\n\tstruct snd_soc_component *component = codec_dai->component;\n\tu16 reg;\n\n\tswitch (div_id) {\n\tcase WM8400_MCLK_DIV:\n\t\treg = snd_soc_component_read(component, WM8400_CLOCKING_2) &\n\t\t\t~WM8400_MCLK_DIV_MASK;\n\t\tsnd_soc_component_write(component, WM8400_CLOCKING_2, reg | div);\n\t\tbreak;\n\tcase WM8400_DACCLK_DIV:\n\t\treg = snd_soc_component_read(component, WM8400_CLOCKING_2) &\n\t\t\t~WM8400_DAC_CLKDIV_MASK;\n\t\tsnd_soc_component_write(component, WM8400_CLOCKING_2, reg | div);\n\t\tbreak;\n\tcase WM8400_ADCCLK_DIV:\n\t\treg = snd_soc_component_read(component, WM8400_CLOCKING_2) &\n\t\t\t~WM8400_ADC_CLKDIV_MASK;\n\t\tsnd_soc_component_write(component, WM8400_CLOCKING_2, reg | div);\n\t\tbreak;\n\tcase WM8400_BCLK_DIV:\n\t\treg = snd_soc_component_read(component, WM8400_CLOCKING_1) &\n\t\t\t~WM8400_BCLK_DIV_MASK;\n\t\tsnd_soc_component_write(component, WM8400_CLOCKING_1, reg | div);\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\treturn 0;\n}\n\n \nstatic int wm8400_hw_params(struct snd_pcm_substream *substream,\n\tstruct snd_pcm_hw_params *params,\n\tstruct snd_soc_dai *dai)\n{\n\tstruct snd_soc_component *component = dai->component;\n\tu16 audio1 = snd_soc_component_read(component, WM8400_AUDIO_INTERFACE_1);\n\n\taudio1 &= ~WM8400_AIF_WL_MASK;\n\t \n\tswitch (params_width(params)) {\n\tcase 16:\n\t\tbreak;\n\tcase 20:\n\t\taudio1 |= WM8400_AIF_WL_20BITS;\n\t\tbreak;\n\tcase 24:\n\t\taudio1 |= WM8400_AIF_WL_24BITS;\n\t\tbreak;\n\tcase 32:\n\t\taudio1 |= WM8400_AIF_WL_32BITS;\n\t\tbreak;\n\t}\n\n\tsnd_soc_component_write(component, WM8400_AUDIO_INTERFACE_1, audio1);\n\treturn 0;\n}\n\nstatic int wm8400_mute(struct snd_soc_dai *dai, int mute, int direction)\n{\n\tstruct snd_soc_component *component = dai->component;\n\tu16 val = snd_soc_component_read(component, WM8400_DAC_CTRL) & ~WM8400_DAC_MUTE;\n\n\tif (mute)\n\t\tsnd_soc_component_write(component, WM8400_DAC_CTRL, val | WM8400_DAC_MUTE);\n\telse\n\t\tsnd_soc_component_write(component, WM8400_DAC_CTRL, val);\n\n\treturn 0;\n}\n\n \nstatic int wm8400_set_bias_level(struct snd_soc_component *component,\n\t\t\t\t enum snd_soc_bias_level level)\n{\n\tstruct wm8400_priv *wm8400 = snd_soc_component_get_drvdata(component);\n\tu16 val;\n\tint ret;\n\n\tswitch (level) {\n\tcase SND_SOC_BIAS_ON:\n\t\tbreak;\n\n\tcase SND_SOC_BIAS_PREPARE:\n\t\t \n\t\tval = snd_soc_component_read(component, WM8400_POWER_MANAGEMENT_1) &\n\t\t\t~WM8400_VMID_MODE_MASK;\n\t\tsnd_soc_component_write(component, WM8400_POWER_MANAGEMENT_1, val | 0x2);\n\t\tbreak;\n\n\tcase SND_SOC_BIAS_STANDBY:\n\t\tif (snd_soc_component_get_bias_level(component) == SND_SOC_BIAS_OFF) {\n\t\t\tret = regulator_bulk_enable(ARRAY_SIZE(power),\n\t\t\t\t\t\t    &power[0]);\n\t\t\tif (ret != 0) {\n\t\t\t\tdev_err(wm8400->wm8400->dev,\n\t\t\t\t\t\"Failed to enable regulators: %d\\n\",\n\t\t\t\t\tret);\n\t\t\t\treturn ret;\n\t\t\t}\n\n\t\t\tsnd_soc_component_write(component, WM8400_POWER_MANAGEMENT_1,\n\t\t\t\t     WM8400_CODEC_ENA | WM8400_SYSCLK_ENA);\n\n\t\t\t \n\t\t\tsnd_soc_component_write(component, WM8400_ANTIPOP2, WM8400_SOFTST |\n\t\t\t\t     WM8400_BUFDCOPEN | WM8400_POBCTRL);\n\n\t\t\tmsleep(50);\n\n\t\t\t \n\t\t\tval = snd_soc_component_read(component, WM8400_POWER_MANAGEMENT_1);\n\t\t\tval |= 0x2 | WM8400_VREF_ENA;\n\t\t\tsnd_soc_component_write(component, WM8400_POWER_MANAGEMENT_1, val);\n\n\t\t\t \n\t\t\tsnd_soc_component_write(component, WM8400_ANTIPOP2, WM8400_SOFTST |\n\t\t\t\t     WM8400_BUFDCOPEN | WM8400_POBCTRL |\n\t\t\t\t     WM8400_BUFIOEN);\n\n\t\t\t \n\t\t\tsnd_soc_component_write(component, WM8400_ANTIPOP2, WM8400_BUFIOEN);\n\t\t}\n\n\t\t \n\t\tval = snd_soc_component_read(component, WM8400_POWER_MANAGEMENT_1) &\n\t\t\t~WM8400_VMID_MODE_MASK;\n\t\tsnd_soc_component_write(component, WM8400_POWER_MANAGEMENT_1, val | 0x4);\n\t\tbreak;\n\n\tcase SND_SOC_BIAS_OFF:\n\t\t \n\t\tsnd_soc_component_write(component, WM8400_ANTIPOP2, WM8400_SOFTST |\n\t\t\tWM8400_POBCTRL | WM8400_BUFIOEN);\n\n\t\t \n\t\tsnd_soc_component_write(component, WM8400_ANTIPOP2, WM8400_SOFTST |\n\t\t\tWM8400_BUFDCOPEN | WM8400_POBCTRL |\n\t\t\tWM8400_BUFIOEN);\n\n\t\t \n\t\tval = snd_soc_component_read(component, WM8400_DAC_CTRL);\n\t\tsnd_soc_component_write(component, WM8400_DAC_CTRL, val | WM8400_DAC_MUTE);\n\n\t\t \n\t\tval = snd_soc_component_read(component, WM8400_POWER_MANAGEMENT_1);\n\t\tval |= WM8400_SPK_ENA | WM8400_OUT3_ENA |\n\t\t\tWM8400_OUT4_ENA | WM8400_LOUT_ENA |\n\t\t\tWM8400_ROUT_ENA;\n\t\tsnd_soc_component_write(component, WM8400_POWER_MANAGEMENT_1, val);\n\n\t\t \n\t\tval &= ~WM8400_VMID_MODE_MASK;\n\t\tsnd_soc_component_write(component, WM8400_POWER_MANAGEMENT_1, val);\n\n\t\tmsleep(300);\n\n\t\t \n\t\tsnd_soc_component_write(component, WM8400_ANTIPOP1, WM8400_DIS_LLINE |\n\t\t\tWM8400_DIS_RLINE | WM8400_DIS_OUT3 |\n\t\t\tWM8400_DIS_OUT4 | WM8400_DIS_LOUT |\n\t\t\tWM8400_DIS_ROUT);\n\n\t\t \n\t\tval &= ~WM8400_VREF_ENA;\n\t\tsnd_soc_component_write(component, WM8400_POWER_MANAGEMENT_1, val);\n\n\t\t \n\t\tsnd_soc_component_write(component, WM8400_ANTIPOP2, 0x0);\n\n\t\tret = regulator_bulk_disable(ARRAY_SIZE(power),\n\t\t\t\t\t     &power[0]);\n\t\tif (ret != 0)\n\t\t\treturn ret;\n\n\t\tbreak;\n\t}\n\n\treturn 0;\n}\n\n#define WM8400_RATES SNDRV_PCM_RATE_8000_96000\n\n#define WM8400_FORMATS (SNDRV_PCM_FMTBIT_S16_LE | SNDRV_PCM_FMTBIT_S20_3LE |\\\n\tSNDRV_PCM_FMTBIT_S24_LE)\n\nstatic const struct snd_soc_dai_ops wm8400_dai_ops = {\n\t.hw_params = wm8400_hw_params,\n\t.mute_stream = wm8400_mute,\n\t.set_fmt = wm8400_set_dai_fmt,\n\t.set_clkdiv = wm8400_set_dai_clkdiv,\n\t.set_sysclk = wm8400_set_dai_sysclk,\n\t.set_pll = wm8400_set_dai_pll,\n\t.no_capture_mute = 1,\n};\n\n \nstatic struct snd_soc_dai_driver wm8400_dai = {\n \n\t.name = \"wm8400-hifi\",\n\t.playback = {\n\t\t.stream_name = \"Playback\",\n\t\t.channels_min = 1,\n\t\t.channels_max = 2,\n\t\t.rates = WM8400_RATES,\n\t\t.formats = WM8400_FORMATS,\n\t},\n\t.capture = {\n\t\t.stream_name = \"Capture\",\n\t\t.channels_min = 1,\n\t\t.channels_max = 2,\n\t\t.rates = WM8400_RATES,\n\t\t.formats = WM8400_FORMATS,\n\t},\n\t.ops = &wm8400_dai_ops,\n};\n\nstatic int wm8400_component_probe(struct snd_soc_component *component)\n{\n\tstruct wm8400 *wm8400 = dev_get_platdata(component->dev);\n\tstruct wm8400_priv *priv;\n\tint ret;\n\tu16 reg;\n\n\tpriv = devm_kzalloc(component->dev, sizeof(struct wm8400_priv),\n\t\t\t    GFP_KERNEL);\n\tif (priv == NULL)\n\t\treturn -ENOMEM;\n\n\tsnd_soc_component_init_regmap(component, wm8400->regmap);\n\tsnd_soc_component_set_drvdata(component, priv);\n\tpriv->wm8400 = wm8400;\n\n\tret = devm_regulator_bulk_get(wm8400->dev,\n\t\t\t\t ARRAY_SIZE(power), &power[0]);\n\tif (ret != 0) {\n\t\tdev_err(component->dev, \"Failed to get regulators: %d\\n\", ret);\n\t\treturn ret;\n\t}\n\n\twm8400_component_reset(component);\n\n\treg = snd_soc_component_read(component, WM8400_POWER_MANAGEMENT_1);\n\tsnd_soc_component_write(component, WM8400_POWER_MANAGEMENT_1, reg | WM8400_CODEC_ENA);\n\n\t \n\treg = snd_soc_component_read(component, WM8400_LEFT_LINE_INPUT_1_2_VOLUME);\n\tsnd_soc_component_write(component, WM8400_LEFT_LINE_INPUT_1_2_VOLUME,\n\t\t     reg & WM8400_IPVU);\n\treg = snd_soc_component_read(component, WM8400_RIGHT_LINE_INPUT_1_2_VOLUME);\n\tsnd_soc_component_write(component, WM8400_RIGHT_LINE_INPUT_1_2_VOLUME,\n\t\t     reg & WM8400_IPVU);\n\n\tsnd_soc_component_write(component, WM8400_LEFT_OUTPUT_VOLUME, 0x50 | (1<<8));\n\tsnd_soc_component_write(component, WM8400_RIGHT_OUTPUT_VOLUME, 0x50 | (1<<8));\n\n\treturn 0;\n}\n\nstatic void  wm8400_component_remove(struct snd_soc_component *component)\n{\n\tu16 reg;\n\n\treg = snd_soc_component_read(component, WM8400_POWER_MANAGEMENT_1);\n\tsnd_soc_component_write(component, WM8400_POWER_MANAGEMENT_1,\n\t\t     reg & (~WM8400_CODEC_ENA));\n}\n\nstatic const struct snd_soc_component_driver soc_component_dev_wm8400 = {\n\t.probe\t\t\t= wm8400_component_probe,\n\t.remove\t\t\t= wm8400_component_remove,\n\t.set_bias_level\t\t= wm8400_set_bias_level,\n\t.controls\t\t= wm8400_snd_controls,\n\t.num_controls\t\t= ARRAY_SIZE(wm8400_snd_controls),\n\t.dapm_widgets\t\t= wm8400_dapm_widgets,\n\t.num_dapm_widgets\t= ARRAY_SIZE(wm8400_dapm_widgets),\n\t.dapm_routes\t\t= wm8400_dapm_routes,\n\t.num_dapm_routes\t= ARRAY_SIZE(wm8400_dapm_routes),\n\t.suspend_bias_off\t= 1,\n\t.idle_bias_on\t\t= 1,\n\t.use_pmdown_time\t= 1,\n\t.endianness\t\t= 1,\n};\n\nstatic int wm8400_probe(struct platform_device *pdev)\n{\n\treturn devm_snd_soc_register_component(&pdev->dev,\n\t\t\t&soc_component_dev_wm8400,\n\t\t\t&wm8400_dai, 1);\n}\n\nstatic struct platform_driver wm8400_codec_driver = {\n\t.driver = {\n\t\t   .name = \"wm8400-codec\",\n\t\t   },\n\t.probe = wm8400_probe,\n};\n\nmodule_platform_driver(wm8400_codec_driver);\n\nMODULE_DESCRIPTION(\"ASoC WM8400 driver\");\nMODULE_AUTHOR(\"Mark Brown\");\nMODULE_LICENSE(\"GPL\");\nMODULE_ALIAS(\"platform:wm8400-codec\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}