{
  "module_name": "wm_hubs.c",
  "hash_id": "dd4c13726e91c005d919a5f0edc3ac4d36ed852598ca02a681050986bfa594e7",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/codecs/wm_hubs.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/moduleparam.h>\n#include <linux/init.h>\n#include <linux/delay.h>\n#include <linux/pm.h>\n#include <linux/i2c.h>\n#include <linux/mfd/wm8994/registers.h>\n#include <sound/core.h>\n#include <sound/pcm.h>\n#include <sound/pcm_params.h>\n#include <sound/soc.h>\n#include <sound/initval.h>\n#include <sound/tlv.h>\n\n#include \"wm8993.h\"\n#include \"wm_hubs.h\"\n\nconst DECLARE_TLV_DB_SCALE(wm_hubs_spkmix_tlv, -300, 300, 0);\nEXPORT_SYMBOL_GPL(wm_hubs_spkmix_tlv);\n\nstatic const DECLARE_TLV_DB_SCALE(inpga_tlv, -1650, 150, 0);\nstatic const DECLARE_TLV_DB_SCALE(inmix_sw_tlv, 0, 3000, 0);\nstatic const DECLARE_TLV_DB_SCALE(inmix_tlv, -1500, 300, 1);\nstatic const DECLARE_TLV_DB_SCALE(earpiece_tlv, -600, 600, 0);\nstatic const DECLARE_TLV_DB_SCALE(outmix_tlv, -2100, 300, 0);\nstatic const DECLARE_TLV_DB_SCALE(spkmixout_tlv, -1800, 600, 1);\nstatic const DECLARE_TLV_DB_SCALE(outpga_tlv, -5700, 100, 0);\nstatic const DECLARE_TLV_DB_RANGE(spkboost_tlv,\n\t0, 6, TLV_DB_SCALE_ITEM(0, 150, 0),\n\t7, 7, TLV_DB_SCALE_ITEM(1200, 0, 0)\n);\nstatic const DECLARE_TLV_DB_SCALE(line_tlv, -600, 600, 0);\n\nstatic const char *speaker_ref_text[] = {\n\t\"SPKVDD/2\",\n\t\"VMID\",\n};\n\nstatic SOC_ENUM_SINGLE_DECL(speaker_ref,\n\t\t\t    WM8993_SPEAKER_MIXER, 8, speaker_ref_text);\n\nstatic const char *speaker_mode_text[] = {\n\t\"Class D\",\n\t\"Class AB\",\n};\n\nstatic SOC_ENUM_SINGLE_DECL(speaker_mode,\n\t\t\t    WM8993_SPKMIXR_ATTENUATION, 8, speaker_mode_text);\n\nstatic void wait_for_dc_servo(struct snd_soc_component *component, unsigned int op)\n{\n\tstruct wm_hubs_data *hubs = snd_soc_component_get_drvdata(component);\n\tunsigned int reg;\n\tint count = 0;\n\tint timeout;\n\tunsigned int val;\n\n\tval = op | WM8993_DCS_ENA_CHAN_0 | WM8993_DCS_ENA_CHAN_1;\n\n\t \n\tsnd_soc_component_write(component, WM8993_DC_SERVO_0, val);\n\n\tdev_dbg(component->dev, \"Waiting for DC servo...\\n\");\n\n\tif (hubs->dcs_done_irq)\n\t\ttimeout = 4;\n\telse\n\t\ttimeout = 400;\n\n\tdo {\n\t\tcount++;\n\n\t\tif (hubs->dcs_done_irq)\n\t\t\twait_for_completion_timeout(&hubs->dcs_done,\n\t\t\t\t\t\t    msecs_to_jiffies(250));\n\t\telse\n\t\t\tmsleep(1);\n\n\t\treg = snd_soc_component_read(component, WM8993_DC_SERVO_0);\n\t\tdev_dbg(component->dev, \"DC servo: %x\\n\", reg);\n\t} while (reg & op && count < timeout);\n\n\tif (reg & op)\n\t\tdev_err(component->dev, \"Timed out waiting for DC Servo %x\\n\",\n\t\t\top);\n}\n\nirqreturn_t wm_hubs_dcs_done(int irq, void *data)\n{\n\tstruct wm_hubs_data *hubs = data;\n\n\tcomplete(&hubs->dcs_done);\n\n\treturn IRQ_HANDLED;\n}\nEXPORT_SYMBOL_GPL(wm_hubs_dcs_done);\n\nstatic bool wm_hubs_dac_hp_direct(struct snd_soc_component *component)\n{\n\tint reg;\n\n\t \n\treg = snd_soc_component_read(component, WM8993_OUTPUT_MIXER1);\n\tif (!(reg & WM8993_DACL_TO_HPOUT1L)) {\n\t\tif (reg & ~WM8993_DACL_TO_MIXOUTL) {\n\t\t\tdev_vdbg(component->dev, \"Analogue paths connected: %x\\n\",\n\t\t\t\t reg & ~WM8993_DACL_TO_HPOUT1L);\n\t\t\treturn false;\n\t\t} else {\n\t\t\tdev_vdbg(component->dev, \"HPL connected to mixer\\n\");\n\t\t}\n\t} else {\n\t\tdev_vdbg(component->dev, \"HPL connected to DAC\\n\");\n\t}\n\n\treg = snd_soc_component_read(component, WM8993_OUTPUT_MIXER2);\n\tif (!(reg & WM8993_DACR_TO_HPOUT1R)) {\n\t\tif (reg & ~WM8993_DACR_TO_MIXOUTR) {\n\t\t\tdev_vdbg(component->dev, \"Analogue paths connected: %x\\n\",\n\t\t\t\t reg & ~WM8993_DACR_TO_HPOUT1R);\n\t\t\treturn false;\n\t\t} else {\n\t\t\tdev_vdbg(component->dev, \"HPR connected to mixer\\n\");\n\t\t}\n\t} else {\n\t\tdev_vdbg(component->dev, \"HPR connected to DAC\\n\");\n\t}\n\n\treturn true;\n}\n\nstruct wm_hubs_dcs_cache {\n\tstruct list_head list;\n\tunsigned int left;\n\tunsigned int right;\n\tu16 dcs_cfg;\n};\n\nstatic bool wm_hubs_dcs_cache_get(struct snd_soc_component *component,\n\t\t\t\t  struct wm_hubs_dcs_cache **entry)\n{\n\tstruct wm_hubs_data *hubs = snd_soc_component_get_drvdata(component);\n\tstruct wm_hubs_dcs_cache *cache;\n\tunsigned int left, right;\n\n\tleft = snd_soc_component_read(component, WM8993_LEFT_OUTPUT_VOLUME);\n\tleft &= WM8993_HPOUT1L_VOL_MASK;\n\n\tright = snd_soc_component_read(component, WM8993_RIGHT_OUTPUT_VOLUME);\n\tright &= WM8993_HPOUT1R_VOL_MASK;\n\n\tlist_for_each_entry(cache, &hubs->dcs_cache, list) {\n\t\tif (cache->left != left || cache->right != right)\n\t\t\tcontinue;\n\n\t\t*entry = cache;\n\t\treturn true;\n\t}\n\n\treturn false;\n}\n\nstatic void wm_hubs_dcs_cache_set(struct snd_soc_component *component, u16 dcs_cfg)\n{\n\tstruct wm_hubs_data *hubs = snd_soc_component_get_drvdata(component);\n\tstruct wm_hubs_dcs_cache *cache;\n\n\tif (hubs->no_cache_dac_hp_direct)\n\t\treturn;\n\n\tcache = devm_kzalloc(component->dev, sizeof(*cache), GFP_KERNEL);\n\tif (!cache)\n\t\treturn;\n\n\tcache->left = snd_soc_component_read(component, WM8993_LEFT_OUTPUT_VOLUME);\n\tcache->left &= WM8993_HPOUT1L_VOL_MASK;\n\n\tcache->right = snd_soc_component_read(component, WM8993_RIGHT_OUTPUT_VOLUME);\n\tcache->right &= WM8993_HPOUT1R_VOL_MASK;\n\n\tcache->dcs_cfg = dcs_cfg;\n\n\tlist_add_tail(&cache->list, &hubs->dcs_cache);\n}\n\nstatic int wm_hubs_read_dc_servo(struct snd_soc_component *component,\n\t\t\t\t  u16 *reg_l, u16 *reg_r)\n{\n\tstruct wm_hubs_data *hubs = snd_soc_component_get_drvdata(component);\n\tu16 dcs_reg, reg;\n\tint ret = 0;\n\n\tswitch (hubs->dcs_readback_mode) {\n\tcase 2:\n\t\tdcs_reg = WM8994_DC_SERVO_4E;\n\t\tbreak;\n\tcase 1:\n\t\tdcs_reg = WM8994_DC_SERVO_READBACK;\n\t\tbreak;\n\tdefault:\n\t\tdcs_reg = WM8993_DC_SERVO_3;\n\t\tbreak;\n\t}\n\n\t \n\tswitch (hubs->dcs_readback_mode) {\n\tcase 0:\n\t\t*reg_l = snd_soc_component_read(component, WM8993_DC_SERVO_READBACK_1)\n\t\t\t& WM8993_DCS_INTEG_CHAN_0_MASK;\n\t\t*reg_r = snd_soc_component_read(component, WM8993_DC_SERVO_READBACK_2)\n\t\t\t& WM8993_DCS_INTEG_CHAN_1_MASK;\n\t\tbreak;\n\tcase 2:\n\tcase 1:\n\t\treg = snd_soc_component_read(component, dcs_reg);\n\t\t*reg_r = (reg & WM8993_DCS_DAC_WR_VAL_1_MASK)\n\t\t\t>> WM8993_DCS_DAC_WR_VAL_1_SHIFT;\n\t\t*reg_l = reg & WM8993_DCS_DAC_WR_VAL_0_MASK;\n\t\tbreak;\n\tdefault:\n\t\tWARN(1, \"Unknown DCS readback method\\n\");\n\t\tret = -1;\n\t}\n\treturn ret;\n}\n\n \nstatic void enable_dc_servo(struct snd_soc_component *component)\n{\n\tstruct wm_hubs_data *hubs = snd_soc_component_get_drvdata(component);\n\tstruct wm_hubs_dcs_cache *cache;\n\ts8 offset;\n\tu16 reg_l, reg_r, dcs_cfg, dcs_reg;\n\n\tswitch (hubs->dcs_readback_mode) {\n\tcase 2:\n\t\tdcs_reg = WM8994_DC_SERVO_4E;\n\t\tbreak;\n\tdefault:\n\t\tdcs_reg = WM8993_DC_SERVO_3;\n\t\tbreak;\n\t}\n\n\t \n\tif (wm_hubs_dac_hp_direct(component) &&\n\t    wm_hubs_dcs_cache_get(component, &cache)) {\n\t\tdev_dbg(component->dev, \"Using cached DCS offset %x for %d,%d\\n\",\n\t\t\tcache->dcs_cfg, cache->left, cache->right);\n\t\tsnd_soc_component_write(component, dcs_reg, cache->dcs_cfg);\n\t\twait_for_dc_servo(component,\n\t\t\t\t  WM8993_DCS_TRIG_DAC_WR_0 |\n\t\t\t\t  WM8993_DCS_TRIG_DAC_WR_1);\n\t\treturn;\n\t}\n\n\tif (hubs->series_startup) {\n\t\t \n\t\tsnd_soc_component_update_bits(component, WM8993_DC_SERVO_1,\n\t\t\t\t    WM8993_DCS_SERIES_NO_01_MASK,\n\t\t\t\t    32 << WM8993_DCS_SERIES_NO_01_SHIFT);\n\t\twait_for_dc_servo(component,\n\t\t\t\t  WM8993_DCS_TRIG_SERIES_0 |\n\t\t\t\t  WM8993_DCS_TRIG_SERIES_1);\n\t} else {\n\t\twait_for_dc_servo(component,\n\t\t\t\t  WM8993_DCS_TRIG_STARTUP_0 |\n\t\t\t\t  WM8993_DCS_TRIG_STARTUP_1);\n\t}\n\n\tif (wm_hubs_read_dc_servo(component, &reg_l, &reg_r) < 0)\n\t\treturn;\n\n\tdev_dbg(component->dev, \"DCS input: %x %x\\n\", reg_l, reg_r);\n\n\t \n\tif (hubs->dcs_codes_l || hubs->dcs_codes_r) {\n\t\tdev_dbg(component->dev,\n\t\t\t\"Applying %d/%d code DC servo correction\\n\",\n\t\t\thubs->dcs_codes_l, hubs->dcs_codes_r);\n\n\t\t \n\t\toffset = (s8)reg_r;\n\t\tdev_dbg(component->dev, \"DCS right %d->%d\\n\", offset,\n\t\t\toffset + hubs->dcs_codes_r);\n\t\toffset += hubs->dcs_codes_r;\n\t\tdcs_cfg = (u8)offset << WM8993_DCS_DAC_WR_VAL_1_SHIFT;\n\n\t\t \n\t\toffset = (s8)reg_l;\n\t\tdev_dbg(component->dev, \"DCS left %d->%d\\n\", offset,\n\t\t\toffset + hubs->dcs_codes_l);\n\t\toffset += hubs->dcs_codes_l;\n\t\tdcs_cfg |= (u8)offset;\n\n\t\tdev_dbg(component->dev, \"DCS result: %x\\n\", dcs_cfg);\n\n\t\t \n\t\tsnd_soc_component_write(component, dcs_reg, dcs_cfg);\n\t\twait_for_dc_servo(component,\n\t\t\t\t  WM8993_DCS_TRIG_DAC_WR_0 |\n\t\t\t\t  WM8993_DCS_TRIG_DAC_WR_1);\n\t} else {\n\t\tdcs_cfg = reg_r << WM8993_DCS_DAC_WR_VAL_1_SHIFT;\n\t\tdcs_cfg |= reg_l;\n\t}\n\n\t \n\tif (wm_hubs_dac_hp_direct(component))\n\t\twm_hubs_dcs_cache_set(component, dcs_cfg);\n}\n\n \nstatic int wm8993_put_dc_servo(struct snd_kcontrol *kcontrol,\n\t\t\t       struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_soc_component *component = snd_soc_kcontrol_component(kcontrol);\n\tstruct wm_hubs_data *hubs = snd_soc_component_get_drvdata(component);\n\tint ret;\n\n\tret = snd_soc_put_volsw(kcontrol, ucontrol);\n\n\t \n\tif (hubs->dcs_codes_l || hubs->dcs_codes_r || hubs->no_series_update)\n\t\treturn ret;\n\n\t \n\tif (snd_soc_component_read(component, WM8993_POWER_MANAGEMENT_1)\n\t    & (WM8993_HPOUT1L_ENA | WM8993_HPOUT1R_ENA))\n\t\tsnd_soc_component_update_bits(component,\n\t\t\t\t    WM8993_DC_SERVO_0,\n\t\t\t\t    WM8993_DCS_TRIG_SINGLE_0 |\n\t\t\t\t    WM8993_DCS_TRIG_SINGLE_1,\n\t\t\t\t    WM8993_DCS_TRIG_SINGLE_0 |\n\t\t\t\t    WM8993_DCS_TRIG_SINGLE_1);\n\n\treturn ret;\n}\n\nstatic const struct snd_kcontrol_new analogue_snd_controls[] = {\nSOC_SINGLE_TLV(\"IN1L Volume\", WM8993_LEFT_LINE_INPUT_1_2_VOLUME, 0, 31, 0,\n\t       inpga_tlv),\nSOC_SINGLE(\"IN1L Switch\", WM8993_LEFT_LINE_INPUT_1_2_VOLUME, 7, 1, 1),\nSOC_SINGLE(\"IN1L ZC Switch\", WM8993_LEFT_LINE_INPUT_1_2_VOLUME, 6, 1, 0),\n\nSOC_SINGLE_TLV(\"IN1R Volume\", WM8993_RIGHT_LINE_INPUT_1_2_VOLUME, 0, 31, 0,\n\t       inpga_tlv),\nSOC_SINGLE(\"IN1R Switch\", WM8993_RIGHT_LINE_INPUT_1_2_VOLUME, 7, 1, 1),\nSOC_SINGLE(\"IN1R ZC Switch\", WM8993_RIGHT_LINE_INPUT_1_2_VOLUME, 6, 1, 0),\n\n\nSOC_SINGLE_TLV(\"IN2L Volume\", WM8993_LEFT_LINE_INPUT_3_4_VOLUME, 0, 31, 0,\n\t       inpga_tlv),\nSOC_SINGLE(\"IN2L Switch\", WM8993_LEFT_LINE_INPUT_3_4_VOLUME, 7, 1, 1),\nSOC_SINGLE(\"IN2L ZC Switch\", WM8993_LEFT_LINE_INPUT_3_4_VOLUME, 6, 1, 0),\n\nSOC_SINGLE_TLV(\"IN2R Volume\", WM8993_RIGHT_LINE_INPUT_3_4_VOLUME, 0, 31, 0,\n\t       inpga_tlv),\nSOC_SINGLE(\"IN2R Switch\", WM8993_RIGHT_LINE_INPUT_3_4_VOLUME, 7, 1, 1),\nSOC_SINGLE(\"IN2R ZC Switch\", WM8993_RIGHT_LINE_INPUT_3_4_VOLUME, 6, 1, 0),\n\nSOC_SINGLE_TLV(\"MIXINL IN2L Volume\", WM8993_INPUT_MIXER3, 7, 1, 0,\n\t       inmix_sw_tlv),\nSOC_SINGLE_TLV(\"MIXINL IN1L Volume\", WM8993_INPUT_MIXER3, 4, 1, 0,\n\t       inmix_sw_tlv),\nSOC_SINGLE_TLV(\"MIXINL Output Record Volume\", WM8993_INPUT_MIXER3, 0, 7, 0,\n\t       inmix_tlv),\nSOC_SINGLE_TLV(\"MIXINL IN1LP Volume\", WM8993_INPUT_MIXER5, 6, 7, 0, inmix_tlv),\nSOC_SINGLE_TLV(\"MIXINL Direct Voice Volume\", WM8993_INPUT_MIXER5, 0, 6, 0,\n\t       inmix_tlv),\n\nSOC_SINGLE_TLV(\"MIXINR IN2R Volume\", WM8993_INPUT_MIXER4, 7, 1, 0,\n\t       inmix_sw_tlv),\nSOC_SINGLE_TLV(\"MIXINR IN1R Volume\", WM8993_INPUT_MIXER4, 4, 1, 0,\n\t       inmix_sw_tlv),\nSOC_SINGLE_TLV(\"MIXINR Output Record Volume\", WM8993_INPUT_MIXER4, 0, 7, 0,\n\t       inmix_tlv),\nSOC_SINGLE_TLV(\"MIXINR IN1RP Volume\", WM8993_INPUT_MIXER6, 6, 7, 0, inmix_tlv),\nSOC_SINGLE_TLV(\"MIXINR Direct Voice Volume\", WM8993_INPUT_MIXER6, 0, 6, 0,\n\t       inmix_tlv),\n\nSOC_SINGLE_TLV(\"Left Output Mixer IN2RN Volume\", WM8993_OUTPUT_MIXER5, 6, 7, 1,\n\t       outmix_tlv),\nSOC_SINGLE_TLV(\"Left Output Mixer IN2LN Volume\", WM8993_OUTPUT_MIXER3, 6, 7, 1,\n\t       outmix_tlv),\nSOC_SINGLE_TLV(\"Left Output Mixer IN2LP Volume\", WM8993_OUTPUT_MIXER3, 9, 7, 1,\n\t       outmix_tlv),\nSOC_SINGLE_TLV(\"Left Output Mixer IN1L Volume\", WM8993_OUTPUT_MIXER3, 0, 7, 1,\n\t       outmix_tlv),\nSOC_SINGLE_TLV(\"Left Output Mixer IN1R Volume\", WM8993_OUTPUT_MIXER3, 3, 7, 1,\n\t       outmix_tlv),\nSOC_SINGLE_TLV(\"Left Output Mixer Right Input Volume\",\n\t       WM8993_OUTPUT_MIXER5, 3, 7, 1, outmix_tlv),\nSOC_SINGLE_TLV(\"Left Output Mixer Left Input Volume\",\n\t       WM8993_OUTPUT_MIXER5, 0, 7, 1, outmix_tlv),\nSOC_SINGLE_TLV(\"Left Output Mixer DAC Volume\", WM8993_OUTPUT_MIXER5, 9, 7, 1,\n\t       outmix_tlv),\n\nSOC_SINGLE_TLV(\"Right Output Mixer IN2LN Volume\",\n\t       WM8993_OUTPUT_MIXER6, 6, 7, 1, outmix_tlv),\nSOC_SINGLE_TLV(\"Right Output Mixer IN2RN Volume\",\n\t       WM8993_OUTPUT_MIXER4, 6, 7, 1, outmix_tlv),\nSOC_SINGLE_TLV(\"Right Output Mixer IN1L Volume\",\n\t       WM8993_OUTPUT_MIXER4, 3, 7, 1, outmix_tlv),\nSOC_SINGLE_TLV(\"Right Output Mixer IN1R Volume\",\n\t       WM8993_OUTPUT_MIXER4, 0, 7, 1, outmix_tlv),\nSOC_SINGLE_TLV(\"Right Output Mixer IN2RP Volume\",\n\t       WM8993_OUTPUT_MIXER4, 9, 7, 1, outmix_tlv),\nSOC_SINGLE_TLV(\"Right Output Mixer Left Input Volume\",\n\t       WM8993_OUTPUT_MIXER6, 3, 7, 1, outmix_tlv),\nSOC_SINGLE_TLV(\"Right Output Mixer Right Input Volume\",\n\t       WM8993_OUTPUT_MIXER6, 6, 7, 1, outmix_tlv),\nSOC_SINGLE_TLV(\"Right Output Mixer DAC Volume\",\n\t       WM8993_OUTPUT_MIXER6, 9, 7, 1, outmix_tlv),\n\nSOC_DOUBLE_R_TLV(\"Output Volume\", WM8993_LEFT_OPGA_VOLUME,\n\t\t WM8993_RIGHT_OPGA_VOLUME, 0, 63, 0, outpga_tlv),\nSOC_DOUBLE_R(\"Output Switch\", WM8993_LEFT_OPGA_VOLUME,\n\t     WM8993_RIGHT_OPGA_VOLUME, 6, 1, 0),\nSOC_DOUBLE_R(\"Output ZC Switch\", WM8993_LEFT_OPGA_VOLUME,\n\t     WM8993_RIGHT_OPGA_VOLUME, 7, 1, 0),\n\nSOC_SINGLE(\"Earpiece Switch\", WM8993_HPOUT2_VOLUME, 5, 1, 1),\nSOC_SINGLE_TLV(\"Earpiece Volume\", WM8993_HPOUT2_VOLUME, 4, 1, 1, earpiece_tlv),\n\nSOC_SINGLE_TLV(\"SPKL Input Volume\", WM8993_SPKMIXL_ATTENUATION,\n\t       5, 1, 1, wm_hubs_spkmix_tlv),\nSOC_SINGLE_TLV(\"SPKL IN1LP Volume\", WM8993_SPKMIXL_ATTENUATION,\n\t       4, 1, 1, wm_hubs_spkmix_tlv),\nSOC_SINGLE_TLV(\"SPKL Output Volume\", WM8993_SPKMIXL_ATTENUATION,\n\t       3, 1, 1, wm_hubs_spkmix_tlv),\n\nSOC_SINGLE_TLV(\"SPKR Input Volume\", WM8993_SPKMIXR_ATTENUATION,\n\t       5, 1, 1, wm_hubs_spkmix_tlv),\nSOC_SINGLE_TLV(\"SPKR IN1RP Volume\", WM8993_SPKMIXR_ATTENUATION,\n\t       4, 1, 1, wm_hubs_spkmix_tlv),\nSOC_SINGLE_TLV(\"SPKR Output Volume\", WM8993_SPKMIXR_ATTENUATION,\n\t       3, 1, 1, wm_hubs_spkmix_tlv),\n\nSOC_DOUBLE_R_TLV(\"Speaker Mixer Volume\",\n\t\t WM8993_SPKMIXL_ATTENUATION, WM8993_SPKMIXR_ATTENUATION,\n\t\t 0, 3, 1, spkmixout_tlv),\nSOC_DOUBLE_R_TLV(\"Speaker Volume\",\n\t\t WM8993_SPEAKER_VOLUME_LEFT, WM8993_SPEAKER_VOLUME_RIGHT,\n\t\t 0, 63, 0, outpga_tlv),\nSOC_DOUBLE_R(\"Speaker Switch\",\n\t     WM8993_SPEAKER_VOLUME_LEFT, WM8993_SPEAKER_VOLUME_RIGHT,\n\t     6, 1, 0),\nSOC_DOUBLE_R(\"Speaker ZC Switch\",\n\t     WM8993_SPEAKER_VOLUME_LEFT, WM8993_SPEAKER_VOLUME_RIGHT,\n\t     7, 1, 0),\nSOC_DOUBLE_TLV(\"Speaker Boost Volume\", WM8993_SPKOUT_BOOST, 3, 0, 7, 0,\n\t       spkboost_tlv),\nSOC_ENUM(\"Speaker Reference\", speaker_ref),\nSOC_ENUM(\"Speaker Mode\", speaker_mode),\n\nSOC_DOUBLE_R_EXT_TLV(\"Headphone Volume\",\n\t\t     WM8993_LEFT_OUTPUT_VOLUME, WM8993_RIGHT_OUTPUT_VOLUME,\n\t\t     0, 63, 0, snd_soc_get_volsw, wm8993_put_dc_servo,\n\t\t     outpga_tlv),\n\nSOC_DOUBLE_R(\"Headphone Switch\", WM8993_LEFT_OUTPUT_VOLUME,\n\t     WM8993_RIGHT_OUTPUT_VOLUME, 6, 1, 0),\nSOC_DOUBLE_R(\"Headphone ZC Switch\", WM8993_LEFT_OUTPUT_VOLUME,\n\t     WM8993_RIGHT_OUTPUT_VOLUME, 7, 1, 0),\n\nSOC_SINGLE(\"LINEOUT1N Switch\", WM8993_LINE_OUTPUTS_VOLUME, 6, 1, 1),\nSOC_SINGLE(\"LINEOUT1P Switch\", WM8993_LINE_OUTPUTS_VOLUME, 5, 1, 1),\nSOC_SINGLE_TLV(\"LINEOUT1 Volume\", WM8993_LINE_OUTPUTS_VOLUME, 4, 1, 1,\n\t       line_tlv),\n\nSOC_SINGLE(\"LINEOUT2N Switch\", WM8993_LINE_OUTPUTS_VOLUME, 2, 1, 1),\nSOC_SINGLE(\"LINEOUT2P Switch\", WM8993_LINE_OUTPUTS_VOLUME, 1, 1, 1),\nSOC_SINGLE_TLV(\"LINEOUT2 Volume\", WM8993_LINE_OUTPUTS_VOLUME, 0, 1, 1,\n\t       line_tlv),\n};\n\nstatic int hp_supply_event(struct snd_soc_dapm_widget *w,\n\t\t\t   struct snd_kcontrol *kcontrol, int event)\n{\n\tstruct snd_soc_component *component = snd_soc_dapm_to_component(w->dapm);\n\tstruct wm_hubs_data *hubs = snd_soc_component_get_drvdata(component);\n\n\tswitch (event) {\n\tcase SND_SOC_DAPM_PRE_PMU:\n\t\tswitch (hubs->hp_startup_mode) {\n\t\tcase 0:\n\t\t\tbreak;\n\t\tcase 1:\n\t\t\t \n\t\t\tsnd_soc_component_update_bits(component, WM8993_POWER_MANAGEMENT_1,\n\t\t\t\t\t    WM8993_HPOUT1L_ENA |\n\t\t\t\t\t    WM8993_HPOUT1R_ENA,\n\t\t\t\t\t    WM8993_HPOUT1L_ENA |\n\t\t\t\t\t    WM8993_HPOUT1R_ENA);\n\n\t\t\t \n\t\t\tsnd_soc_component_update_bits(component, WM8993_ANALOGUE_HP_0,\n\t\t\t\t\t    WM8993_HPOUT1L_DLY |\n\t\t\t\t\t    WM8993_HPOUT1R_DLY,\n\t\t\t\t\t    WM8993_HPOUT1L_DLY |\n\t\t\t\t\t    WM8993_HPOUT1R_DLY);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tdev_err(component->dev, \"Unknown HP startup mode %d\\n\",\n\t\t\t\thubs->hp_startup_mode);\n\t\t\tbreak;\n\t\t}\n\t\tbreak;\n\n\tcase SND_SOC_DAPM_PRE_PMD:\n\t\tsnd_soc_component_update_bits(component, WM8993_CHARGE_PUMP_1,\n\t\t\t\t    WM8993_CP_ENA, 0);\n\t\tbreak;\n\t}\n\n\treturn 0;\n}\n\nstatic int hp_event(struct snd_soc_dapm_widget *w,\n\t\t    struct snd_kcontrol *kcontrol, int event)\n{\n\tstruct snd_soc_component *component = snd_soc_dapm_to_component(w->dapm);\n\tunsigned int reg = snd_soc_component_read(component, WM8993_ANALOGUE_HP_0);\n\n\tswitch (event) {\n\tcase SND_SOC_DAPM_POST_PMU:\n\t\tsnd_soc_component_update_bits(component, WM8993_CHARGE_PUMP_1,\n\t\t\t\t    WM8993_CP_ENA, WM8993_CP_ENA);\n\n\t\tmsleep(5);\n\n\t\tsnd_soc_component_update_bits(component, WM8993_POWER_MANAGEMENT_1,\n\t\t\t\t    WM8993_HPOUT1L_ENA | WM8993_HPOUT1R_ENA,\n\t\t\t\t    WM8993_HPOUT1L_ENA | WM8993_HPOUT1R_ENA);\n\n\t\treg |= WM8993_HPOUT1L_DLY | WM8993_HPOUT1R_DLY;\n\t\tsnd_soc_component_write(component, WM8993_ANALOGUE_HP_0, reg);\n\n\t\tsnd_soc_component_update_bits(component, WM8993_DC_SERVO_1,\n\t\t\t\t    WM8993_DCS_TIMER_PERIOD_01_MASK, 0);\n\n\t\tenable_dc_servo(component);\n\n\t\treg |= WM8993_HPOUT1R_OUTP | WM8993_HPOUT1R_RMV_SHORT |\n\t\t\tWM8993_HPOUT1L_OUTP | WM8993_HPOUT1L_RMV_SHORT;\n\t\tsnd_soc_component_write(component, WM8993_ANALOGUE_HP_0, reg);\n\t\tbreak;\n\n\tcase SND_SOC_DAPM_PRE_PMD:\n\t\tsnd_soc_component_update_bits(component, WM8993_ANALOGUE_HP_0,\n\t\t\t\t    WM8993_HPOUT1L_OUTP |\n\t\t\t\t    WM8993_HPOUT1R_OUTP |\n\t\t\t\t    WM8993_HPOUT1L_RMV_SHORT |\n\t\t\t\t    WM8993_HPOUT1R_RMV_SHORT, 0);\n\n\t\tsnd_soc_component_update_bits(component, WM8993_ANALOGUE_HP_0,\n\t\t\t\t    WM8993_HPOUT1L_DLY |\n\t\t\t\t    WM8993_HPOUT1R_DLY, 0);\n\n\t\tsnd_soc_component_write(component, WM8993_DC_SERVO_0, 0);\n\n\t\tsnd_soc_component_update_bits(component, WM8993_POWER_MANAGEMENT_1,\n\t\t\t\t    WM8993_HPOUT1L_ENA | WM8993_HPOUT1R_ENA,\n\t\t\t\t    0);\n\t\tbreak;\n\t}\n\n\treturn 0;\n}\n\nstatic int earpiece_event(struct snd_soc_dapm_widget *w,\n\t\t\t  struct snd_kcontrol *control, int event)\n{\n\tstruct snd_soc_component *component = snd_soc_dapm_to_component(w->dapm);\n\tu16 reg = snd_soc_component_read(component, WM8993_ANTIPOP1) & ~WM8993_HPOUT2_IN_ENA;\n\n\tswitch (event) {\n\tcase SND_SOC_DAPM_PRE_PMU:\n\t\treg |= WM8993_HPOUT2_IN_ENA;\n\t\tsnd_soc_component_write(component, WM8993_ANTIPOP1, reg);\n\t\tudelay(50);\n\t\tbreak;\n\n\tcase SND_SOC_DAPM_POST_PMD:\n\t\tsnd_soc_component_write(component, WM8993_ANTIPOP1, reg);\n\t\tbreak;\n\n\tdefault:\n\t\tWARN(1, \"Invalid event %d\\n\", event);\n\t\tbreak;\n\t}\n\n\treturn 0;\n}\n\nstatic int lineout_event(struct snd_soc_dapm_widget *w,\n\t\t\t struct snd_kcontrol *control, int event)\n{\n\tstruct snd_soc_component *component = snd_soc_dapm_to_component(w->dapm);\n\tstruct wm_hubs_data *hubs = snd_soc_component_get_drvdata(component);\n\tbool *flag;\n\n\tswitch (w->shift) {\n\tcase WM8993_LINEOUT1N_ENA_SHIFT:\n\t\tflag = &hubs->lineout1n_ena;\n\t\tbreak;\n\tcase WM8993_LINEOUT1P_ENA_SHIFT:\n\t\tflag = &hubs->lineout1p_ena;\n\t\tbreak;\n\tcase WM8993_LINEOUT2N_ENA_SHIFT:\n\t\tflag = &hubs->lineout2n_ena;\n\t\tbreak;\n\tcase WM8993_LINEOUT2P_ENA_SHIFT:\n\t\tflag = &hubs->lineout2p_ena;\n\t\tbreak;\n\tdefault:\n\t\tWARN(1, \"Unknown line output\");\n\t\treturn -EINVAL;\n\t}\n\n\t*flag = SND_SOC_DAPM_EVENT_ON(event);\n\n\treturn 0;\n}\n\nstatic int micbias_event(struct snd_soc_dapm_widget *w,\n\t\t\t struct snd_kcontrol *kcontrol, int event)\n{\n\tstruct snd_soc_component *component = snd_soc_dapm_to_component(w->dapm);\n\tstruct wm_hubs_data *hubs = snd_soc_component_get_drvdata(component);\n\n\tswitch (w->shift) {\n\tcase WM8993_MICB1_ENA_SHIFT:\n\t\tif (hubs->micb1_delay)\n\t\t\tmsleep(hubs->micb1_delay);\n\t\tbreak;\n\tcase WM8993_MICB2_ENA_SHIFT:\n\t\tif (hubs->micb2_delay)\n\t\t\tmsleep(hubs->micb2_delay);\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\treturn 0;\n}\n\nvoid wm_hubs_update_class_w(struct snd_soc_component *component)\n{\n\tstruct wm_hubs_data *hubs = snd_soc_component_get_drvdata(component);\n\tint enable = WM8993_CP_DYN_V | WM8993_CP_DYN_FREQ;\n\n\tif (!wm_hubs_dac_hp_direct(component))\n\t\tenable = false;\n\n\tif (hubs->check_class_w_digital && !hubs->check_class_w_digital(component))\n\t\tenable = false;\n\n\tdev_vdbg(component->dev, \"Class W %s\\n\", enable ? \"enabled\" : \"disabled\");\n\n\tsnd_soc_component_update_bits(component, WM8993_CLASS_W_0,\n\t\t\t    WM8993_CP_DYN_V | WM8993_CP_DYN_FREQ, enable);\n\n\tsnd_soc_component_write(component, WM8993_LEFT_OUTPUT_VOLUME,\n\t\t      snd_soc_component_read(component, WM8993_LEFT_OUTPUT_VOLUME));\n\tsnd_soc_component_write(component, WM8993_RIGHT_OUTPUT_VOLUME,\n\t\t      snd_soc_component_read(component, WM8993_RIGHT_OUTPUT_VOLUME));\n}\nEXPORT_SYMBOL_GPL(wm_hubs_update_class_w);\n\n#define WM_HUBS_SINGLE_W(xname, reg, shift, max, invert) \\\n\tSOC_SINGLE_EXT(xname, reg, shift, max, invert, \\\n\t\tsnd_soc_dapm_get_volsw, class_w_put_volsw)\n\nstatic int class_w_put_volsw(struct snd_kcontrol *kcontrol,\n\t\t\t      struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_soc_component *component = snd_soc_dapm_kcontrol_component(kcontrol);\n\tint ret;\n\n\tret = snd_soc_dapm_put_volsw(kcontrol, ucontrol);\n\n\twm_hubs_update_class_w(component);\n\n\treturn ret;\n}\n\n#define WM_HUBS_ENUM_W(xname, xenum) \\\n{\t.iface = SNDRV_CTL_ELEM_IFACE_MIXER, .name = xname, \\\n\t.info = snd_soc_info_enum_double, \\\n\t.get = snd_soc_dapm_get_enum_double, \\\n\t.put = class_w_put_double, \\\n\t.private_value = (unsigned long)&xenum }\n\nstatic int class_w_put_double(struct snd_kcontrol *kcontrol,\n\t\t\t      struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_soc_component *component = snd_soc_dapm_kcontrol_component(kcontrol);\n\tint ret;\n\n\tret = snd_soc_dapm_put_enum_double(kcontrol, ucontrol);\n\n\twm_hubs_update_class_w(component);\n\n\treturn ret;\n}\n\nstatic const char *hp_mux_text[] = {\n\t\"Mixer\",\n\t\"DAC\",\n};\n\nstatic SOC_ENUM_SINGLE_DECL(hpl_enum,\n\t\t\t    WM8993_OUTPUT_MIXER1, 8, hp_mux_text);\n\nconst struct snd_kcontrol_new wm_hubs_hpl_mux =\n\tWM_HUBS_ENUM_W(\"Left Headphone Mux\", hpl_enum);\nEXPORT_SYMBOL_GPL(wm_hubs_hpl_mux);\n\nstatic SOC_ENUM_SINGLE_DECL(hpr_enum,\n\t\t\t    WM8993_OUTPUT_MIXER2, 8, hp_mux_text);\n\nconst struct snd_kcontrol_new wm_hubs_hpr_mux =\n\tWM_HUBS_ENUM_W(\"Right Headphone Mux\", hpr_enum);\nEXPORT_SYMBOL_GPL(wm_hubs_hpr_mux);\n\nstatic const struct snd_kcontrol_new in1l_pga[] = {\nSOC_DAPM_SINGLE(\"IN1LP Switch\", WM8993_INPUT_MIXER2, 5, 1, 0),\nSOC_DAPM_SINGLE(\"IN1LN Switch\", WM8993_INPUT_MIXER2, 4, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new in1r_pga[] = {\nSOC_DAPM_SINGLE(\"IN1RP Switch\", WM8993_INPUT_MIXER2, 1, 1, 0),\nSOC_DAPM_SINGLE(\"IN1RN Switch\", WM8993_INPUT_MIXER2, 0, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new in2l_pga[] = {\nSOC_DAPM_SINGLE(\"IN2LP Switch\", WM8993_INPUT_MIXER2, 7, 1, 0),\nSOC_DAPM_SINGLE(\"IN2LN Switch\", WM8993_INPUT_MIXER2, 6, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new in2r_pga[] = {\nSOC_DAPM_SINGLE(\"IN2RP Switch\", WM8993_INPUT_MIXER2, 3, 1, 0),\nSOC_DAPM_SINGLE(\"IN2RN Switch\", WM8993_INPUT_MIXER2, 2, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new mixinl[] = {\nSOC_DAPM_SINGLE(\"IN2L Switch\", WM8993_INPUT_MIXER3, 8, 1, 0),\nSOC_DAPM_SINGLE(\"IN1L Switch\", WM8993_INPUT_MIXER3, 5, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new mixinr[] = {\nSOC_DAPM_SINGLE(\"IN2R Switch\", WM8993_INPUT_MIXER4, 8, 1, 0),\nSOC_DAPM_SINGLE(\"IN1R Switch\", WM8993_INPUT_MIXER4, 5, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new left_output_mixer[] = {\nWM_HUBS_SINGLE_W(\"Right Input Switch\", WM8993_OUTPUT_MIXER1, 7, 1, 0),\nWM_HUBS_SINGLE_W(\"Left Input Switch\", WM8993_OUTPUT_MIXER1, 6, 1, 0),\nWM_HUBS_SINGLE_W(\"IN2RN Switch\", WM8993_OUTPUT_MIXER1, 5, 1, 0),\nWM_HUBS_SINGLE_W(\"IN2LN Switch\", WM8993_OUTPUT_MIXER1, 4, 1, 0),\nWM_HUBS_SINGLE_W(\"IN2LP Switch\", WM8993_OUTPUT_MIXER1, 1, 1, 0),\nWM_HUBS_SINGLE_W(\"IN1R Switch\", WM8993_OUTPUT_MIXER1, 3, 1, 0),\nWM_HUBS_SINGLE_W(\"IN1L Switch\", WM8993_OUTPUT_MIXER1, 2, 1, 0),\nWM_HUBS_SINGLE_W(\"DAC Switch\", WM8993_OUTPUT_MIXER1, 0, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new right_output_mixer[] = {\nWM_HUBS_SINGLE_W(\"Left Input Switch\", WM8993_OUTPUT_MIXER2, 7, 1, 0),\nWM_HUBS_SINGLE_W(\"Right Input Switch\", WM8993_OUTPUT_MIXER2, 6, 1, 0),\nWM_HUBS_SINGLE_W(\"IN2LN Switch\", WM8993_OUTPUT_MIXER2, 5, 1, 0),\nWM_HUBS_SINGLE_W(\"IN2RN Switch\", WM8993_OUTPUT_MIXER2, 4, 1, 0),\nWM_HUBS_SINGLE_W(\"IN1L Switch\", WM8993_OUTPUT_MIXER2, 3, 1, 0),\nWM_HUBS_SINGLE_W(\"IN1R Switch\", WM8993_OUTPUT_MIXER2, 2, 1, 0),\nWM_HUBS_SINGLE_W(\"IN2RP Switch\", WM8993_OUTPUT_MIXER2, 1, 1, 0),\nWM_HUBS_SINGLE_W(\"DAC Switch\", WM8993_OUTPUT_MIXER2, 0, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new earpiece_mixer[] = {\nSOC_DAPM_SINGLE(\"Direct Voice Switch\", WM8993_HPOUT2_MIXER, 5, 1, 0),\nSOC_DAPM_SINGLE(\"Left Output Switch\", WM8993_HPOUT2_MIXER, 4, 1, 0),\nSOC_DAPM_SINGLE(\"Right Output Switch\", WM8993_HPOUT2_MIXER, 3, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new left_speaker_boost[] = {\nSOC_DAPM_SINGLE(\"Direct Voice Switch\", WM8993_SPKOUT_MIXERS, 5, 1, 0),\nSOC_DAPM_SINGLE(\"SPKL Switch\", WM8993_SPKOUT_MIXERS, 4, 1, 0),\nSOC_DAPM_SINGLE(\"SPKR Switch\", WM8993_SPKOUT_MIXERS, 3, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new right_speaker_boost[] = {\nSOC_DAPM_SINGLE(\"Direct Voice Switch\", WM8993_SPKOUT_MIXERS, 2, 1, 0),\nSOC_DAPM_SINGLE(\"SPKL Switch\", WM8993_SPKOUT_MIXERS, 1, 1, 0),\nSOC_DAPM_SINGLE(\"SPKR Switch\", WM8993_SPKOUT_MIXERS, 0, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new line1_mix[] = {\nSOC_DAPM_SINGLE(\"IN1R Switch\", WM8993_LINE_MIXER1, 2, 1, 0),\nSOC_DAPM_SINGLE(\"IN1L Switch\", WM8993_LINE_MIXER1, 1, 1, 0),\nSOC_DAPM_SINGLE(\"Output Switch\", WM8993_LINE_MIXER1, 0, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new line1n_mix[] = {\nSOC_DAPM_SINGLE(\"Left Output Switch\", WM8993_LINE_MIXER1, 6, 1, 0),\nSOC_DAPM_SINGLE(\"Right Output Switch\", WM8993_LINE_MIXER1, 5, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new line1p_mix[] = {\nSOC_DAPM_SINGLE(\"Left Output Switch\", WM8993_LINE_MIXER1, 0, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new line2_mix[] = {\nSOC_DAPM_SINGLE(\"IN1L Switch\", WM8993_LINE_MIXER2, 2, 1, 0),\nSOC_DAPM_SINGLE(\"IN1R Switch\", WM8993_LINE_MIXER2, 1, 1, 0),\nSOC_DAPM_SINGLE(\"Output Switch\", WM8993_LINE_MIXER2, 0, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new line2n_mix[] = {\nSOC_DAPM_SINGLE(\"Left Output Switch\", WM8993_LINE_MIXER2, 5, 1, 0),\nSOC_DAPM_SINGLE(\"Right Output Switch\", WM8993_LINE_MIXER2, 6, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new line2p_mix[] = {\nSOC_DAPM_SINGLE(\"Right Output Switch\", WM8993_LINE_MIXER2, 0, 1, 0),\n};\n\nstatic const struct snd_soc_dapm_widget analogue_dapm_widgets[] = {\nSND_SOC_DAPM_INPUT(\"IN1LN\"),\nSND_SOC_DAPM_INPUT(\"IN1LP\"),\nSND_SOC_DAPM_INPUT(\"IN2LN\"),\nSND_SOC_DAPM_INPUT(\"IN2LP:VXRN\"),\nSND_SOC_DAPM_INPUT(\"IN1RN\"),\nSND_SOC_DAPM_INPUT(\"IN1RP\"),\nSND_SOC_DAPM_INPUT(\"IN2RN\"),\nSND_SOC_DAPM_INPUT(\"IN2RP:VXRP\"),\n\nSND_SOC_DAPM_SUPPLY(\"MICBIAS2\", WM8993_POWER_MANAGEMENT_1, 5, 0,\n\t\t    micbias_event, SND_SOC_DAPM_POST_PMU),\nSND_SOC_DAPM_SUPPLY(\"MICBIAS1\", WM8993_POWER_MANAGEMENT_1, 4, 0,\n\t\t    micbias_event, SND_SOC_DAPM_POST_PMU),\n\nSND_SOC_DAPM_MIXER(\"IN1L PGA\", WM8993_POWER_MANAGEMENT_2, 6, 0,\n\t\t   in1l_pga, ARRAY_SIZE(in1l_pga)),\nSND_SOC_DAPM_MIXER(\"IN1R PGA\", WM8993_POWER_MANAGEMENT_2, 4, 0,\n\t\t   in1r_pga, ARRAY_SIZE(in1r_pga)),\n\nSND_SOC_DAPM_MIXER(\"IN2L PGA\", WM8993_POWER_MANAGEMENT_2, 7, 0,\n\t\t   in2l_pga, ARRAY_SIZE(in2l_pga)),\nSND_SOC_DAPM_MIXER(\"IN2R PGA\", WM8993_POWER_MANAGEMENT_2, 5, 0,\n\t\t   in2r_pga, ARRAY_SIZE(in2r_pga)),\n\nSND_SOC_DAPM_MIXER(\"MIXINL\", WM8993_POWER_MANAGEMENT_2, 9, 0,\n\t\t   mixinl, ARRAY_SIZE(mixinl)),\nSND_SOC_DAPM_MIXER(\"MIXINR\", WM8993_POWER_MANAGEMENT_2, 8, 0,\n\t\t   mixinr, ARRAY_SIZE(mixinr)),\n\nSND_SOC_DAPM_MIXER(\"Left Output Mixer\", WM8993_POWER_MANAGEMENT_3, 5, 0,\n\t\t   left_output_mixer, ARRAY_SIZE(left_output_mixer)),\nSND_SOC_DAPM_MIXER(\"Right Output Mixer\", WM8993_POWER_MANAGEMENT_3, 4, 0,\n\t\t   right_output_mixer, ARRAY_SIZE(right_output_mixer)),\n\nSND_SOC_DAPM_PGA(\"Left Output PGA\", WM8993_POWER_MANAGEMENT_3, 7, 0, NULL, 0),\nSND_SOC_DAPM_PGA(\"Right Output PGA\", WM8993_POWER_MANAGEMENT_3, 6, 0, NULL, 0),\n\nSND_SOC_DAPM_SUPPLY(\"Headphone Supply\", SND_SOC_NOPM, 0, 0, hp_supply_event, \n\t\t    SND_SOC_DAPM_PRE_PMU | SND_SOC_DAPM_PRE_PMD),\nSND_SOC_DAPM_OUT_DRV_E(\"Headphone PGA\", SND_SOC_NOPM, 0, 0, NULL, 0,\n\t\t       hp_event, SND_SOC_DAPM_POST_PMU | SND_SOC_DAPM_PRE_PMD),\n\nSND_SOC_DAPM_MIXER(\"Earpiece Mixer\", SND_SOC_NOPM, 0, 0,\n\t\t   earpiece_mixer, ARRAY_SIZE(earpiece_mixer)),\nSND_SOC_DAPM_PGA_E(\"Earpiece Driver\", WM8993_POWER_MANAGEMENT_1, 11, 0,\n\t\t   NULL, 0, earpiece_event,\n\t\t   SND_SOC_DAPM_PRE_PMU | SND_SOC_DAPM_POST_PMD),\n\nSND_SOC_DAPM_MIXER(\"SPKL Boost\", SND_SOC_NOPM, 0, 0,\n\t\t   left_speaker_boost, ARRAY_SIZE(left_speaker_boost)),\nSND_SOC_DAPM_MIXER(\"SPKR Boost\", SND_SOC_NOPM, 0, 0,\n\t\t   right_speaker_boost, ARRAY_SIZE(right_speaker_boost)),\n\nSND_SOC_DAPM_SUPPLY(\"TSHUT\", WM8993_POWER_MANAGEMENT_2, 14, 0, NULL, 0),\nSND_SOC_DAPM_OUT_DRV(\"SPKL Driver\", WM8993_POWER_MANAGEMENT_1, 12, 0,\n\t\t     NULL, 0),\nSND_SOC_DAPM_OUT_DRV(\"SPKR Driver\", WM8993_POWER_MANAGEMENT_1, 13, 0,\n\t\t     NULL, 0),\n\nSND_SOC_DAPM_MIXER(\"LINEOUT1 Mixer\", SND_SOC_NOPM, 0, 0,\n\t\t   line1_mix, ARRAY_SIZE(line1_mix)),\nSND_SOC_DAPM_MIXER(\"LINEOUT2 Mixer\", SND_SOC_NOPM, 0, 0,\n\t\t   line2_mix, ARRAY_SIZE(line2_mix)),\n\nSND_SOC_DAPM_MIXER(\"LINEOUT1N Mixer\", SND_SOC_NOPM, 0, 0,\n\t\t   line1n_mix, ARRAY_SIZE(line1n_mix)),\nSND_SOC_DAPM_MIXER(\"LINEOUT1P Mixer\", SND_SOC_NOPM, 0, 0,\n\t\t   line1p_mix, ARRAY_SIZE(line1p_mix)),\nSND_SOC_DAPM_MIXER(\"LINEOUT2N Mixer\", SND_SOC_NOPM, 0, 0,\n\t\t   line2n_mix, ARRAY_SIZE(line2n_mix)),\nSND_SOC_DAPM_MIXER(\"LINEOUT2P Mixer\", SND_SOC_NOPM, 0, 0,\n\t\t   line2p_mix, ARRAY_SIZE(line2p_mix)),\n\nSND_SOC_DAPM_OUT_DRV_E(\"LINEOUT1N Driver\", WM8993_POWER_MANAGEMENT_3, 13, 0,\n\t\t       NULL, 0, lineout_event,\n\t\t     SND_SOC_DAPM_POST_PMU | SND_SOC_DAPM_PRE_PMD),\nSND_SOC_DAPM_OUT_DRV_E(\"LINEOUT1P Driver\", WM8993_POWER_MANAGEMENT_3, 12, 0,\n\t\t       NULL, 0, lineout_event,\n\t\t       SND_SOC_DAPM_POST_PMU | SND_SOC_DAPM_PRE_PMD),\nSND_SOC_DAPM_OUT_DRV_E(\"LINEOUT2N Driver\", WM8993_POWER_MANAGEMENT_3, 11, 0,\n\t\t       NULL, 0, lineout_event,\n\t\t       SND_SOC_DAPM_POST_PMU | SND_SOC_DAPM_PRE_PMD),\nSND_SOC_DAPM_OUT_DRV_E(\"LINEOUT2P Driver\", WM8993_POWER_MANAGEMENT_3, 10, 0,\n\t\t       NULL, 0, lineout_event,\n\t\t       SND_SOC_DAPM_POST_PMU | SND_SOC_DAPM_PRE_PMD),\n\nSND_SOC_DAPM_OUTPUT(\"SPKOUTLP\"),\nSND_SOC_DAPM_OUTPUT(\"SPKOUTLN\"),\nSND_SOC_DAPM_OUTPUT(\"SPKOUTRP\"),\nSND_SOC_DAPM_OUTPUT(\"SPKOUTRN\"),\nSND_SOC_DAPM_OUTPUT(\"HPOUT1L\"),\nSND_SOC_DAPM_OUTPUT(\"HPOUT1R\"),\nSND_SOC_DAPM_OUTPUT(\"HPOUT2P\"),\nSND_SOC_DAPM_OUTPUT(\"HPOUT2N\"),\nSND_SOC_DAPM_OUTPUT(\"LINEOUT1P\"),\nSND_SOC_DAPM_OUTPUT(\"LINEOUT1N\"),\nSND_SOC_DAPM_OUTPUT(\"LINEOUT2P\"),\nSND_SOC_DAPM_OUTPUT(\"LINEOUT2N\"),\n};\n\nstatic const struct snd_soc_dapm_route analogue_routes[] = {\n\t{ \"MICBIAS1\", NULL, \"CLK_SYS\" },\n\t{ \"MICBIAS2\", NULL, \"CLK_SYS\" },\n\n\t{ \"IN1L PGA\", \"IN1LP Switch\", \"IN1LP\" },\n\t{ \"IN1L PGA\", \"IN1LN Switch\", \"IN1LN\" },\n\n\t{ \"IN1L PGA\", NULL, \"VMID\" },\n\t{ \"IN1R PGA\", NULL, \"VMID\" },\n\t{ \"IN2L PGA\", NULL, \"VMID\" },\n\t{ \"IN2R PGA\", NULL, \"VMID\" },\n\n\t{ \"IN1R PGA\", \"IN1RP Switch\", \"IN1RP\" },\n\t{ \"IN1R PGA\", \"IN1RN Switch\", \"IN1RN\" },\n\n\t{ \"IN2L PGA\", \"IN2LP Switch\", \"IN2LP:VXRN\" },\n\t{ \"IN2L PGA\", \"IN2LN Switch\", \"IN2LN\" },\n\n\t{ \"IN2R PGA\", \"IN2RP Switch\", \"IN2RP:VXRP\" },\n\t{ \"IN2R PGA\", \"IN2RN Switch\", \"IN2RN\" },\n\n\t{ \"Direct Voice\", NULL, \"IN2LP:VXRN\" },\n\t{ \"Direct Voice\", NULL, \"IN2RP:VXRP\" },\n\n\t{ \"MIXINL\", \"IN1L Switch\", \"IN1L PGA\" },\n\t{ \"MIXINL\", \"IN2L Switch\", \"IN2L PGA\" },\n\t{ \"MIXINL\", NULL, \"Direct Voice\" },\n\t{ \"MIXINL\", NULL, \"IN1LP\" },\n\t{ \"MIXINL\", NULL, \"Left Output Mixer\" },\n\t{ \"MIXINL\", NULL, \"VMID\" },\n\n\t{ \"MIXINR\", \"IN1R Switch\", \"IN1R PGA\" },\n\t{ \"MIXINR\", \"IN2R Switch\", \"IN2R PGA\" },\n\t{ \"MIXINR\", NULL, \"Direct Voice\" },\n\t{ \"MIXINR\", NULL, \"IN1RP\" },\n\t{ \"MIXINR\", NULL, \"Right Output Mixer\" },\n\t{ \"MIXINR\", NULL, \"VMID\" },\n\n\t{ \"ADCL\", NULL, \"MIXINL\" },\n\t{ \"ADCR\", NULL, \"MIXINR\" },\n\n\t{ \"Left Output Mixer\", \"Left Input Switch\", \"MIXINL\" },\n\t{ \"Left Output Mixer\", \"Right Input Switch\", \"MIXINR\" },\n\t{ \"Left Output Mixer\", \"IN2RN Switch\", \"IN2RN\" },\n\t{ \"Left Output Mixer\", \"IN2LN Switch\", \"IN2LN\" },\n\t{ \"Left Output Mixer\", \"IN2LP Switch\", \"IN2LP:VXRN\" },\n\t{ \"Left Output Mixer\", \"IN1L Switch\", \"IN1L PGA\" },\n\t{ \"Left Output Mixer\", \"IN1R Switch\", \"IN1R PGA\" },\n\n\t{ \"Right Output Mixer\", \"Left Input Switch\", \"MIXINL\" },\n\t{ \"Right Output Mixer\", \"Right Input Switch\", \"MIXINR\" },\n\t{ \"Right Output Mixer\", \"IN2LN Switch\", \"IN2LN\" },\n\t{ \"Right Output Mixer\", \"IN2RN Switch\", \"IN2RN\" },\n\t{ \"Right Output Mixer\", \"IN2RP Switch\", \"IN2RP:VXRP\" },\n\t{ \"Right Output Mixer\", \"IN1L Switch\", \"IN1L PGA\" },\n\t{ \"Right Output Mixer\", \"IN1R Switch\", \"IN1R PGA\" },\n\n\t{ \"Left Output PGA\", NULL, \"Left Output Mixer\" },\n\t{ \"Left Output PGA\", NULL, \"TOCLK\" },\n\n\t{ \"Right Output PGA\", NULL, \"Right Output Mixer\" },\n\t{ \"Right Output PGA\", NULL, \"TOCLK\" },\n\n\t{ \"Earpiece Mixer\", \"Direct Voice Switch\", \"Direct Voice\" },\n\t{ \"Earpiece Mixer\", \"Left Output Switch\", \"Left Output PGA\" },\n\t{ \"Earpiece Mixer\", \"Right Output Switch\", \"Right Output PGA\" },\n\n\t{ \"Earpiece Driver\", NULL, \"VMID\" },\n\t{ \"Earpiece Driver\", NULL, \"Earpiece Mixer\" },\n\t{ \"HPOUT2N\", NULL, \"Earpiece Driver\" },\n\t{ \"HPOUT2P\", NULL, \"Earpiece Driver\" },\n\n\t{ \"SPKL\", \"Input Switch\", \"MIXINL\" },\n\t{ \"SPKL\", \"IN1LP Switch\", \"IN1LP\" },\n\t{ \"SPKL\", \"Output Switch\", \"Left Output PGA\" },\n\t{ \"SPKL\", NULL, \"TOCLK\" },\n\n\t{ \"SPKR\", \"Input Switch\", \"MIXINR\" },\n\t{ \"SPKR\", \"IN1RP Switch\", \"IN1RP\" },\n\t{ \"SPKR\", \"Output Switch\", \"Right Output PGA\" },\n\t{ \"SPKR\", NULL, \"TOCLK\" },\n\n\t{ \"SPKL Boost\", \"Direct Voice Switch\", \"Direct Voice\" },\n\t{ \"SPKL Boost\", \"SPKL Switch\", \"SPKL\" },\n\t{ \"SPKL Boost\", \"SPKR Switch\", \"SPKR\" },\n\n\t{ \"SPKR Boost\", \"Direct Voice Switch\", \"Direct Voice\" },\n\t{ \"SPKR Boost\", \"SPKR Switch\", \"SPKR\" },\n\t{ \"SPKR Boost\", \"SPKL Switch\", \"SPKL\" },\n\n\t{ \"SPKL Driver\", NULL, \"VMID\" },\n\t{ \"SPKL Driver\", NULL, \"SPKL Boost\" },\n\t{ \"SPKL Driver\", NULL, \"CLK_SYS\" },\n\t{ \"SPKL Driver\", NULL, \"TSHUT\" },\n\n\t{ \"SPKR Driver\", NULL, \"VMID\" },\n\t{ \"SPKR Driver\", NULL, \"SPKR Boost\" },\n\t{ \"SPKR Driver\", NULL, \"CLK_SYS\" },\n\t{ \"SPKR Driver\", NULL, \"TSHUT\" },\n\n\t{ \"SPKOUTLP\", NULL, \"SPKL Driver\" },\n\t{ \"SPKOUTLN\", NULL, \"SPKL Driver\" },\n\t{ \"SPKOUTRP\", NULL, \"SPKR Driver\" },\n\t{ \"SPKOUTRN\", NULL, \"SPKR Driver\" },\n\n\t{ \"Left Headphone Mux\", \"Mixer\", \"Left Output PGA\" },\n\t{ \"Right Headphone Mux\", \"Mixer\", \"Right Output PGA\" },\n\n\t{ \"Headphone PGA\", NULL, \"Left Headphone Mux\" },\n\t{ \"Headphone PGA\", NULL, \"Right Headphone Mux\" },\n\t{ \"Headphone PGA\", NULL, \"VMID\" },\n\t{ \"Headphone PGA\", NULL, \"CLK_SYS\" },\n\t{ \"Headphone PGA\", NULL, \"Headphone Supply\" },\n\n\t{ \"HPOUT1L\", NULL, \"Headphone PGA\" },\n\t{ \"HPOUT1R\", NULL, \"Headphone PGA\" },\n\n\t{ \"LINEOUT1N Driver\", NULL, \"VMID\" },\n\t{ \"LINEOUT1P Driver\", NULL, \"VMID\" },\n\t{ \"LINEOUT2N Driver\", NULL, \"VMID\" },\n\t{ \"LINEOUT2P Driver\", NULL, \"VMID\" },\n\n\t{ \"LINEOUT1N\", NULL, \"LINEOUT1N Driver\" },\n\t{ \"LINEOUT1P\", NULL, \"LINEOUT1P Driver\" },\n\t{ \"LINEOUT2N\", NULL, \"LINEOUT2N Driver\" },\n\t{ \"LINEOUT2P\", NULL, \"LINEOUT2P Driver\" },\n};\n\nstatic const struct snd_soc_dapm_route lineout1_diff_routes[] = {\n\t{ \"LINEOUT1 Mixer\", \"IN1L Switch\", \"IN1L PGA\" },\n\t{ \"LINEOUT1 Mixer\", \"IN1R Switch\", \"IN1R PGA\" },\n\t{ \"LINEOUT1 Mixer\", \"Output Switch\", \"Left Output PGA\" },\n\n\t{ \"LINEOUT1N Driver\", NULL, \"LINEOUT1 Mixer\" },\n\t{ \"LINEOUT1P Driver\", NULL, \"LINEOUT1 Mixer\" },\n};\n\nstatic const struct snd_soc_dapm_route lineout1_se_routes[] = {\n\t{ \"LINEOUT1N Mixer\", \"Left Output Switch\", \"Left Output PGA\" },\n\t{ \"LINEOUT1N Mixer\", \"Right Output Switch\", \"Right Output PGA\" },\n\n\t{ \"LINEOUT1P Mixer\", \"Left Output Switch\", \"Left Output PGA\" },\n\n\t{ \"LINEOUT1N Driver\", NULL, \"LINEOUT1N Mixer\" },\n\t{ \"LINEOUT1P Driver\", NULL, \"LINEOUT1P Mixer\" },\n};\n\nstatic const struct snd_soc_dapm_route lineout2_diff_routes[] = {\n\t{ \"LINEOUT2 Mixer\", \"IN1L Switch\", \"IN1L PGA\" },\n\t{ \"LINEOUT2 Mixer\", \"IN1R Switch\", \"IN1R PGA\" },\n\t{ \"LINEOUT2 Mixer\", \"Output Switch\", \"Right Output PGA\" },\n\n\t{ \"LINEOUT2N Driver\", NULL, \"LINEOUT2 Mixer\" },\n\t{ \"LINEOUT2P Driver\", NULL, \"LINEOUT2 Mixer\" },\n};\n\nstatic const struct snd_soc_dapm_route lineout2_se_routes[] = {\n\t{ \"LINEOUT2N Mixer\", \"Left Output Switch\", \"Left Output PGA\" },\n\t{ \"LINEOUT2N Mixer\", \"Right Output Switch\", \"Right Output PGA\" },\n\n\t{ \"LINEOUT2P Mixer\", \"Right Output Switch\", \"Right Output PGA\" },\n\n\t{ \"LINEOUT2N Driver\", NULL, \"LINEOUT2N Mixer\" },\n\t{ \"LINEOUT2P Driver\", NULL, \"LINEOUT2P Mixer\" },\n};\n\nint wm_hubs_add_analogue_controls(struct snd_soc_component *component)\n{\n\tstruct snd_soc_dapm_context *dapm = snd_soc_component_get_dapm(component);\n\n\t \n\tsnd_soc_component_update_bits(component, WM8993_LEFT_LINE_INPUT_1_2_VOLUME,\n\t\t\t    WM8993_IN1_VU, WM8993_IN1_VU);\n\tsnd_soc_component_update_bits(component, WM8993_RIGHT_LINE_INPUT_1_2_VOLUME,\n\t\t\t    WM8993_IN1_VU, WM8993_IN1_VU);\n\tsnd_soc_component_update_bits(component, WM8993_LEFT_LINE_INPUT_3_4_VOLUME,\n\t\t\t    WM8993_IN2_VU, WM8993_IN2_VU);\n\tsnd_soc_component_update_bits(component, WM8993_RIGHT_LINE_INPUT_3_4_VOLUME,\n\t\t\t    WM8993_IN2_VU, WM8993_IN2_VU);\n\n\tsnd_soc_component_update_bits(component, WM8993_SPEAKER_VOLUME_LEFT,\n\t\t\t    WM8993_SPKOUT_VU, WM8993_SPKOUT_VU);\n\tsnd_soc_component_update_bits(component, WM8993_SPEAKER_VOLUME_RIGHT,\n\t\t\t    WM8993_SPKOUT_VU, WM8993_SPKOUT_VU);\n\n\tsnd_soc_component_update_bits(component, WM8993_LEFT_OUTPUT_VOLUME,\n\t\t\t    WM8993_HPOUT1_VU | WM8993_HPOUT1L_ZC,\n\t\t\t    WM8993_HPOUT1_VU | WM8993_HPOUT1L_ZC);\n\tsnd_soc_component_update_bits(component, WM8993_RIGHT_OUTPUT_VOLUME,\n\t\t\t    WM8993_HPOUT1_VU | WM8993_HPOUT1R_ZC,\n\t\t\t    WM8993_HPOUT1_VU | WM8993_HPOUT1R_ZC);\n\n\tsnd_soc_component_update_bits(component, WM8993_LEFT_OPGA_VOLUME,\n\t\t\t    WM8993_MIXOUTL_ZC | WM8993_MIXOUT_VU,\n\t\t\t    WM8993_MIXOUTL_ZC | WM8993_MIXOUT_VU);\n\tsnd_soc_component_update_bits(component, WM8993_RIGHT_OPGA_VOLUME,\n\t\t\t    WM8993_MIXOUTR_ZC | WM8993_MIXOUT_VU,\n\t\t\t    WM8993_MIXOUTR_ZC | WM8993_MIXOUT_VU);\n\n\tsnd_soc_add_component_controls(component, analogue_snd_controls,\n\t\t\t     ARRAY_SIZE(analogue_snd_controls));\n\n\tsnd_soc_dapm_new_controls(dapm, analogue_dapm_widgets,\n\t\t\t\t  ARRAY_SIZE(analogue_dapm_widgets));\n\treturn 0;\n}\nEXPORT_SYMBOL_GPL(wm_hubs_add_analogue_controls);\n\nint wm_hubs_add_analogue_routes(struct snd_soc_component *component,\n\t\t\t\tint lineout1_diff, int lineout2_diff)\n{\n\tstruct wm_hubs_data *hubs = snd_soc_component_get_drvdata(component);\n\tstruct snd_soc_dapm_context *dapm = snd_soc_component_get_dapm(component);\n\n\thubs->component = component;\n\n\tINIT_LIST_HEAD(&hubs->dcs_cache);\n\tinit_completion(&hubs->dcs_done);\n\n\tsnd_soc_dapm_add_routes(dapm, analogue_routes,\n\t\t\t\tARRAY_SIZE(analogue_routes));\n\n\tif (lineout1_diff)\n\t\tsnd_soc_dapm_add_routes(dapm,\n\t\t\t\t\tlineout1_diff_routes,\n\t\t\t\t\tARRAY_SIZE(lineout1_diff_routes));\n\telse\n\t\tsnd_soc_dapm_add_routes(dapm,\n\t\t\t\t\tlineout1_se_routes,\n\t\t\t\t\tARRAY_SIZE(lineout1_se_routes));\n\n\tif (lineout2_diff)\n\t\tsnd_soc_dapm_add_routes(dapm,\n\t\t\t\t\tlineout2_diff_routes,\n\t\t\t\t\tARRAY_SIZE(lineout2_diff_routes));\n\telse\n\t\tsnd_soc_dapm_add_routes(dapm,\n\t\t\t\t\tlineout2_se_routes,\n\t\t\t\t\tARRAY_SIZE(lineout2_se_routes));\n\n\treturn 0;\n}\nEXPORT_SYMBOL_GPL(wm_hubs_add_analogue_routes);\n\nint wm_hubs_handle_analogue_pdata(struct snd_soc_component *component,\n\t\t\t\t  int lineout1_diff, int lineout2_diff,\n\t\t\t\t  int lineout1fb, int lineout2fb,\n\t\t\t\t  int jd_scthr, int jd_thr,\n\t\t\t\t  int micbias1_delay, int micbias2_delay,\n\t\t\t\t  int micbias1_lvl, int micbias2_lvl)\n{\n\tstruct wm_hubs_data *hubs = snd_soc_component_get_drvdata(component);\n\n\thubs->lineout1_se = !lineout1_diff;\n\thubs->lineout2_se = !lineout2_diff;\n\thubs->micb1_delay = micbias1_delay;\n\thubs->micb2_delay = micbias2_delay;\n\n\tif (!lineout1_diff)\n\t\tsnd_soc_component_update_bits(component, WM8993_LINE_MIXER1,\n\t\t\t\t    WM8993_LINEOUT1_MODE,\n\t\t\t\t    WM8993_LINEOUT1_MODE);\n\tif (!lineout2_diff)\n\t\tsnd_soc_component_update_bits(component, WM8993_LINE_MIXER2,\n\t\t\t\t    WM8993_LINEOUT2_MODE,\n\t\t\t\t    WM8993_LINEOUT2_MODE);\n\n\tif (!lineout1_diff && !lineout2_diff)\n\t\tsnd_soc_component_update_bits(component, WM8993_ANTIPOP1,\n\t\t\t\t    WM8993_LINEOUT_VMID_BUF_ENA,\n\t\t\t\t    WM8993_LINEOUT_VMID_BUF_ENA);\n\n\tif (lineout1fb)\n\t\tsnd_soc_component_update_bits(component, WM8993_ADDITIONAL_CONTROL,\n\t\t\t\t    WM8993_LINEOUT1_FB, WM8993_LINEOUT1_FB);\n\n\tif (lineout2fb)\n\t\tsnd_soc_component_update_bits(component, WM8993_ADDITIONAL_CONTROL,\n\t\t\t\t    WM8993_LINEOUT2_FB, WM8993_LINEOUT2_FB);\n\n\tif (!hubs->micd_scthr)\n\t\treturn 0;\n\n\tsnd_soc_component_update_bits(component, WM8993_MICBIAS,\n\t\t\t    WM8993_JD_SCTHR_MASK | WM8993_JD_THR_MASK |\n\t\t\t    WM8993_MICB1_LVL | WM8993_MICB2_LVL,\n\t\t\t    jd_scthr << WM8993_JD_SCTHR_SHIFT |\n\t\t\t    jd_thr << WM8993_JD_THR_SHIFT |\n\t\t\t    micbias1_lvl |\n\t\t\t    micbias2_lvl << WM8993_MICB2_LVL_SHIFT);\n\n\treturn 0;\n}\nEXPORT_SYMBOL_GPL(wm_hubs_handle_analogue_pdata);\n\nvoid wm_hubs_vmid_ena(struct snd_soc_component *component)\n{\n\tstruct wm_hubs_data *hubs = snd_soc_component_get_drvdata(component);\n\tint val = 0;\n\n\tif (hubs->lineout1_se)\n\t\tval |= WM8993_LINEOUT1N_ENA | WM8993_LINEOUT1P_ENA;\n\n\tif (hubs->lineout2_se)\n\t\tval |= WM8993_LINEOUT2N_ENA | WM8993_LINEOUT2P_ENA;\n\n\t \n\tsnd_soc_component_update_bits(component, WM8993_POWER_MANAGEMENT_3, val, val);\n}\nEXPORT_SYMBOL_GPL(wm_hubs_vmid_ena);\n\nvoid wm_hubs_set_bias_level(struct snd_soc_component *component,\n\t\t\t    enum snd_soc_bias_level level)\n{\n\tstruct wm_hubs_data *hubs = snd_soc_component_get_drvdata(component);\n\tint mask, val;\n\n\tswitch (level) {\n\tcase SND_SOC_BIAS_STANDBY:\n\t\t \n\t\tsnd_soc_component_update_bits(component, WM8993_INPUTS_CLAMP_REG,\n\t\t\t\t    WM8993_INPUTS_CLAMP, WM8993_INPUTS_CLAMP);\n\t\tbreak;\n\n\tcase SND_SOC_BIAS_ON:\n\t\t \n\t\tval = 0;\n\t\tmask = 0;\n\n\t\tif (hubs->lineout1_se)\n\t\t\tmask |= WM8993_LINEOUT1N_ENA | WM8993_LINEOUT1P_ENA;\n\n\t\tif (hubs->lineout2_se)\n\t\t\tmask |= WM8993_LINEOUT2N_ENA | WM8993_LINEOUT2P_ENA;\n\n\t\tif (hubs->lineout1_se && hubs->lineout1n_ena)\n\t\t\tval |= WM8993_LINEOUT1N_ENA;\n\n\t\tif (hubs->lineout1_se && hubs->lineout1p_ena)\n\t\t\tval |= WM8993_LINEOUT1P_ENA;\n\n\t\tif (hubs->lineout2_se && hubs->lineout2n_ena)\n\t\t\tval |= WM8993_LINEOUT2N_ENA;\n\n\t\tif (hubs->lineout2_se && hubs->lineout2p_ena)\n\t\t\tval |= WM8993_LINEOUT2P_ENA;\n\n\t\tsnd_soc_component_update_bits(component, WM8993_POWER_MANAGEMENT_3,\n\t\t\t\t    mask, val);\n\n\t\t \n\t\tsnd_soc_component_update_bits(component, WM8993_INPUTS_CLAMP_REG,\n\t\t\t\t    WM8993_INPUTS_CLAMP, 0);\n\t\tbreak;\n\n\tdefault:\n\t\tbreak;\n\t}\n}\nEXPORT_SYMBOL_GPL(wm_hubs_set_bias_level);\n\nMODULE_DESCRIPTION(\"Shared support for Wolfson hubs products\");\nMODULE_AUTHOR(\"Mark Brown <broonie@opensource.wolfsonmicro.com>\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}