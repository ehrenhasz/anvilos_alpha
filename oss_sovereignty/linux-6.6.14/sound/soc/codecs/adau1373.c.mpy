{
  "module_name": "adau1373.c",
  "hash_id": "c56ce90a2f018313dcc037a2f5b490d84b1282b3ded22e08c80d78a14b859096",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/codecs/adau1373.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/init.h>\n#include <linux/delay.h>\n#include <linux/pm.h>\n#include <linux/i2c.h>\n#include <linux/slab.h>\n\n#include <sound/core.h>\n#include <sound/pcm.h>\n#include <sound/pcm_params.h>\n#include <sound/tlv.h>\n#include <sound/soc.h>\n#include <sound/adau1373.h>\n\n#include \"adau1373.h\"\n#include \"adau-utils.h\"\n\nstruct adau1373_dai {\n\tunsigned int clk_src;\n\tunsigned int sysclk;\n\tbool enable_src;\n\tbool clock_provider;\n};\n\nstruct adau1373 {\n\tstruct regmap *regmap;\n\tstruct adau1373_dai dais[3];\n};\n\n#define ADAU1373_INPUT_MODE\t0x00\n#define ADAU1373_AINL_CTRL(x)\t(0x01 + (x) * 2)\n#define ADAU1373_AINR_CTRL(x)\t(0x02 + (x) * 2)\n#define ADAU1373_LLINE_OUT(x)\t(0x9 + (x) * 2)\n#define ADAU1373_RLINE_OUT(x)\t(0xa + (x) * 2)\n#define ADAU1373_LSPK_OUT\t0x0d\n#define ADAU1373_RSPK_OUT\t0x0e\n#define ADAU1373_LHP_OUT\t0x0f\n#define ADAU1373_RHP_OUT\t0x10\n#define ADAU1373_ADC_GAIN\t0x11\n#define ADAU1373_LADC_MIXER\t0x12\n#define ADAU1373_RADC_MIXER\t0x13\n#define ADAU1373_LLINE1_MIX\t0x14\n#define ADAU1373_RLINE1_MIX\t0x15\n#define ADAU1373_LLINE2_MIX\t0x16\n#define ADAU1373_RLINE2_MIX\t0x17\n#define ADAU1373_LSPK_MIX\t0x18\n#define ADAU1373_RSPK_MIX\t0x19\n#define ADAU1373_LHP_MIX\t0x1a\n#define ADAU1373_RHP_MIX\t0x1b\n#define ADAU1373_EP_MIX\t\t0x1c\n#define ADAU1373_HP_CTRL\t0x1d\n#define ADAU1373_HP_CTRL2\t0x1e\n#define ADAU1373_LS_CTRL\t0x1f\n#define ADAU1373_EP_CTRL\t0x21\n#define ADAU1373_MICBIAS_CTRL1\t0x22\n#define ADAU1373_MICBIAS_CTRL2\t0x23\n#define ADAU1373_OUTPUT_CTRL\t0x24\n#define ADAU1373_PWDN_CTRL1\t0x25\n#define ADAU1373_PWDN_CTRL2\t0x26\n#define ADAU1373_PWDN_CTRL3\t0x27\n#define ADAU1373_DPLL_CTRL(x)\t(0x28 + (x) * 7)\n#define ADAU1373_PLL_CTRL1(x)\t(0x29 + (x) * 7)\n#define ADAU1373_PLL_CTRL2(x)\t(0x2a + (x) * 7)\n#define ADAU1373_PLL_CTRL3(x)\t(0x2b + (x) * 7)\n#define ADAU1373_PLL_CTRL4(x)\t(0x2c + (x) * 7)\n#define ADAU1373_PLL_CTRL5(x)\t(0x2d + (x) * 7)\n#define ADAU1373_PLL_CTRL6(x)\t(0x2e + (x) * 7)\n#define ADAU1373_HEADDECT\t0x36\n#define ADAU1373_ADC_DAC_STATUS\t0x37\n#define ADAU1373_ADC_CTRL\t0x3c\n#define ADAU1373_DAI(x)\t\t(0x44 + (x))\n#define ADAU1373_CLK_SRC_DIV(x)\t(0x40 + (x) * 2)\n#define ADAU1373_BCLKDIV(x)\t(0x47 + (x))\n#define ADAU1373_SRC_RATIOA(x)\t(0x4a + (x) * 2)\n#define ADAU1373_SRC_RATIOB(x)\t(0x4b + (x) * 2)\n#define ADAU1373_DEEMP_CTRL\t0x50\n#define ADAU1373_SRC_DAI_CTRL(x) (0x51 + (x))\n#define ADAU1373_DIN_MIX_CTRL(x) (0x56 + (x))\n#define ADAU1373_DOUT_MIX_CTRL(x) (0x5b + (x))\n#define ADAU1373_DAI_PBL_VOL(x)\t(0x62 + (x) * 2)\n#define ADAU1373_DAI_PBR_VOL(x)\t(0x63 + (x) * 2)\n#define ADAU1373_DAI_RECL_VOL(x) (0x68 + (x) * 2)\n#define ADAU1373_DAI_RECR_VOL(x) (0x69 + (x) * 2)\n#define ADAU1373_DAC1_PBL_VOL\t0x6e\n#define ADAU1373_DAC1_PBR_VOL\t0x6f\n#define ADAU1373_DAC2_PBL_VOL\t0x70\n#define ADAU1373_DAC2_PBR_VOL\t0x71\n#define ADAU1373_ADC_RECL_VOL\t0x72\n#define ADAU1373_ADC_RECR_VOL\t0x73\n#define ADAU1373_DMIC_RECL_VOL\t0x74\n#define ADAU1373_DMIC_RECR_VOL\t0x75\n#define ADAU1373_VOL_GAIN1\t0x76\n#define ADAU1373_VOL_GAIN2\t0x77\n#define ADAU1373_VOL_GAIN3\t0x78\n#define ADAU1373_HPF_CTRL\t0x7d\n#define ADAU1373_BASS1\t\t0x7e\n#define ADAU1373_BASS2\t\t0x7f\n#define ADAU1373_DRC(x)\t\t(0x80 + (x) * 0x10)\n#define ADAU1373_3D_CTRL1\t0xc0\n#define ADAU1373_3D_CTRL2\t0xc1\n#define ADAU1373_FDSP_SEL1\t0xdc\n#define ADAU1373_FDSP_SEL2\t0xdd\n#define ADAU1373_FDSP_SEL3\t0xde\n#define ADAU1373_FDSP_SEL4\t0xdf\n#define ADAU1373_DIGMICCTRL\t0xe2\n#define ADAU1373_DIGEN\t\t0xeb\n#define ADAU1373_SOFT_RESET\t0xff\n\n\n#define ADAU1373_PLL_CTRL6_DPLL_BYPASS\tBIT(1)\n#define ADAU1373_PLL_CTRL6_PLL_EN\tBIT(0)\n\n#define ADAU1373_DAI_INVERT_BCLK\tBIT(7)\n#define ADAU1373_DAI_MASTER\t\tBIT(6)\n#define ADAU1373_DAI_INVERT_LRCLK\tBIT(4)\n#define ADAU1373_DAI_WLEN_16\t\t0x0\n#define ADAU1373_DAI_WLEN_20\t\t0x4\n#define ADAU1373_DAI_WLEN_24\t\t0x8\n#define ADAU1373_DAI_WLEN_32\t\t0xc\n#define ADAU1373_DAI_WLEN_MASK\t\t0xc\n#define ADAU1373_DAI_FORMAT_RIGHT_J\t0x0\n#define ADAU1373_DAI_FORMAT_LEFT_J\t0x1\n#define ADAU1373_DAI_FORMAT_I2S\t\t0x2\n#define ADAU1373_DAI_FORMAT_DSP\t\t0x3\n\n#define ADAU1373_BCLKDIV_SOURCE\t\tBIT(5)\n#define ADAU1373_BCLKDIV_SR_MASK\t(0x07 << 2)\n#define ADAU1373_BCLKDIV_BCLK_MASK\t0x03\n#define ADAU1373_BCLKDIV_32\t\t0x03\n#define ADAU1373_BCLKDIV_64\t\t0x02\n#define ADAU1373_BCLKDIV_128\t\t0x01\n#define ADAU1373_BCLKDIV_256\t\t0x00\n\n#define ADAU1373_ADC_CTRL_PEAK_DETECT\tBIT(0)\n#define ADAU1373_ADC_CTRL_RESET\t\tBIT(1)\n#define ADAU1373_ADC_CTRL_RESET_FORCE\tBIT(2)\n\n#define ADAU1373_OUTPUT_CTRL_LDIFF\tBIT(3)\n#define ADAU1373_OUTPUT_CTRL_LNFBEN\tBIT(2)\n\n#define ADAU1373_PWDN_CTRL3_PWR_EN BIT(0)\n\n#define ADAU1373_EP_CTRL_MICBIAS1_OFFSET 4\n#define ADAU1373_EP_CTRL_MICBIAS2_OFFSET 2\n\nstatic const struct reg_default adau1373_reg_defaults[] = {\n\t{ ADAU1373_INPUT_MODE,\t\t0x00 },\n\t{ ADAU1373_AINL_CTRL(0),\t0x00 },\n\t{ ADAU1373_AINR_CTRL(0),\t0x00 },\n\t{ ADAU1373_AINL_CTRL(1),\t0x00 },\n\t{ ADAU1373_AINR_CTRL(1),\t0x00 },\n\t{ ADAU1373_AINL_CTRL(2),\t0x00 },\n\t{ ADAU1373_AINR_CTRL(2),\t0x00 },\n\t{ ADAU1373_AINL_CTRL(3),\t0x00 },\n\t{ ADAU1373_AINR_CTRL(3),\t0x00 },\n\t{ ADAU1373_LLINE_OUT(0),\t0x00 },\n\t{ ADAU1373_RLINE_OUT(0),\t0x00 },\n\t{ ADAU1373_LLINE_OUT(1),\t0x00 },\n\t{ ADAU1373_RLINE_OUT(1),\t0x00 },\n\t{ ADAU1373_LSPK_OUT,\t\t0x00 },\n\t{ ADAU1373_RSPK_OUT,\t\t0x00 },\n\t{ ADAU1373_LHP_OUT,\t\t0x00 },\n\t{ ADAU1373_RHP_OUT,\t\t0x00 },\n\t{ ADAU1373_ADC_GAIN,\t\t0x00 },\n\t{ ADAU1373_LADC_MIXER,\t\t0x00 },\n\t{ ADAU1373_RADC_MIXER,\t\t0x00 },\n\t{ ADAU1373_LLINE1_MIX,\t\t0x00 },\n\t{ ADAU1373_RLINE1_MIX,\t\t0x00 },\n\t{ ADAU1373_LLINE2_MIX,\t\t0x00 },\n\t{ ADAU1373_RLINE2_MIX,\t\t0x00 },\n\t{ ADAU1373_LSPK_MIX,\t\t0x00 },\n\t{ ADAU1373_RSPK_MIX,\t\t0x00 },\n\t{ ADAU1373_LHP_MIX,\t\t0x00 },\n\t{ ADAU1373_RHP_MIX,\t\t0x00 },\n\t{ ADAU1373_EP_MIX,\t\t0x00 },\n\t{ ADAU1373_HP_CTRL,\t\t0x00 },\n\t{ ADAU1373_HP_CTRL2,\t\t0x00 },\n\t{ ADAU1373_LS_CTRL,\t\t0x00 },\n\t{ ADAU1373_EP_CTRL,\t\t0x00 },\n\t{ ADAU1373_MICBIAS_CTRL1,\t0x00 },\n\t{ ADAU1373_MICBIAS_CTRL2,\t0x00 },\n\t{ ADAU1373_OUTPUT_CTRL,\t\t0x00 },\n\t{ ADAU1373_PWDN_CTRL1,\t\t0x00 },\n\t{ ADAU1373_PWDN_CTRL2,\t\t0x00 },\n\t{ ADAU1373_PWDN_CTRL3,\t\t0x00 },\n\t{ ADAU1373_DPLL_CTRL(0),\t0x00 },\n\t{ ADAU1373_PLL_CTRL1(0),\t0x00 },\n\t{ ADAU1373_PLL_CTRL2(0),\t0x00 },\n\t{ ADAU1373_PLL_CTRL3(0),\t0x00 },\n\t{ ADAU1373_PLL_CTRL4(0),\t0x00 },\n\t{ ADAU1373_PLL_CTRL5(0),\t0x00 },\n\t{ ADAU1373_PLL_CTRL6(0),\t0x02 },\n\t{ ADAU1373_DPLL_CTRL(1),\t0x00 },\n\t{ ADAU1373_PLL_CTRL1(1),\t0x00 },\n\t{ ADAU1373_PLL_CTRL2(1),\t0x00 },\n\t{ ADAU1373_PLL_CTRL3(1),\t0x00 },\n\t{ ADAU1373_PLL_CTRL4(1),\t0x00 },\n\t{ ADAU1373_PLL_CTRL5(1),\t0x00 },\n\t{ ADAU1373_PLL_CTRL6(1),\t0x02 },\n\t{ ADAU1373_HEADDECT,\t\t0x00 },\n\t{ ADAU1373_ADC_CTRL,\t\t0x00 },\n\t{ ADAU1373_CLK_SRC_DIV(0),\t0x00 },\n\t{ ADAU1373_CLK_SRC_DIV(1),\t0x00 },\n\t{ ADAU1373_DAI(0),\t\t0x0a },\n\t{ ADAU1373_DAI(1),\t\t0x0a },\n\t{ ADAU1373_DAI(2),\t\t0x0a },\n\t{ ADAU1373_BCLKDIV(0),\t\t0x00 },\n\t{ ADAU1373_BCLKDIV(1),\t\t0x00 },\n\t{ ADAU1373_BCLKDIV(2),\t\t0x00 },\n\t{ ADAU1373_SRC_RATIOA(0),\t0x00 },\n\t{ ADAU1373_SRC_RATIOB(0),\t0x00 },\n\t{ ADAU1373_SRC_RATIOA(1),\t0x00 },\n\t{ ADAU1373_SRC_RATIOB(1),\t0x00 },\n\t{ ADAU1373_SRC_RATIOA(2),\t0x00 },\n\t{ ADAU1373_SRC_RATIOB(2),\t0x00 },\n\t{ ADAU1373_DEEMP_CTRL,\t\t0x00 },\n\t{ ADAU1373_SRC_DAI_CTRL(0),\t0x08 },\n\t{ ADAU1373_SRC_DAI_CTRL(1),\t0x08 },\n\t{ ADAU1373_SRC_DAI_CTRL(2),\t0x08 },\n\t{ ADAU1373_DIN_MIX_CTRL(0),\t0x00 },\n\t{ ADAU1373_DIN_MIX_CTRL(1),\t0x00 },\n\t{ ADAU1373_DIN_MIX_CTRL(2),\t0x00 },\n\t{ ADAU1373_DIN_MIX_CTRL(3),\t0x00 },\n\t{ ADAU1373_DIN_MIX_CTRL(4),\t0x00 },\n\t{ ADAU1373_DOUT_MIX_CTRL(0),\t0x00 },\n\t{ ADAU1373_DOUT_MIX_CTRL(1),\t0x00 },\n\t{ ADAU1373_DOUT_MIX_CTRL(2),\t0x00 },\n\t{ ADAU1373_DOUT_MIX_CTRL(3),\t0x00 },\n\t{ ADAU1373_DOUT_MIX_CTRL(4),\t0x00 },\n\t{ ADAU1373_DAI_PBL_VOL(0),\t0x00 },\n\t{ ADAU1373_DAI_PBR_VOL(0),\t0x00 },\n\t{ ADAU1373_DAI_PBL_VOL(1),\t0x00 },\n\t{ ADAU1373_DAI_PBR_VOL(1),\t0x00 },\n\t{ ADAU1373_DAI_PBL_VOL(2),\t0x00 },\n\t{ ADAU1373_DAI_PBR_VOL(2),\t0x00 },\n\t{ ADAU1373_DAI_RECL_VOL(0),\t0x00 },\n\t{ ADAU1373_DAI_RECR_VOL(0),\t0x00 },\n\t{ ADAU1373_DAI_RECL_VOL(1),\t0x00 },\n\t{ ADAU1373_DAI_RECR_VOL(1),\t0x00 },\n\t{ ADAU1373_DAI_RECL_VOL(2),\t0x00 },\n\t{ ADAU1373_DAI_RECR_VOL(2),\t0x00 },\n\t{ ADAU1373_DAC1_PBL_VOL,\t0x00 },\n\t{ ADAU1373_DAC1_PBR_VOL,\t0x00 },\n\t{ ADAU1373_DAC2_PBL_VOL,\t0x00 },\n\t{ ADAU1373_DAC2_PBR_VOL,\t0x00 },\n\t{ ADAU1373_ADC_RECL_VOL,\t0x00 },\n\t{ ADAU1373_ADC_RECR_VOL,\t0x00 },\n\t{ ADAU1373_DMIC_RECL_VOL,\t0x00 },\n\t{ ADAU1373_DMIC_RECR_VOL,\t0x00 },\n\t{ ADAU1373_VOL_GAIN1,\t\t0x00 },\n\t{ ADAU1373_VOL_GAIN2,\t\t0x00 },\n\t{ ADAU1373_VOL_GAIN3,\t\t0x00 },\n\t{ ADAU1373_HPF_CTRL,\t\t0x00 },\n\t{ ADAU1373_BASS1,\t\t0x00 },\n\t{ ADAU1373_BASS2,\t\t0x00 },\n\t{ ADAU1373_DRC(0) + 0x0,\t0x78 },\n\t{ ADAU1373_DRC(0) + 0x1,\t0x18 },\n\t{ ADAU1373_DRC(0) + 0x2,\t0x00 },\n\t{ ADAU1373_DRC(0) + 0x3,\t0x00 },\n\t{ ADAU1373_DRC(0) + 0x4,\t0x00 },\n\t{ ADAU1373_DRC(0) + 0x5,\t0xc0 },\n\t{ ADAU1373_DRC(0) + 0x6,\t0x00 },\n\t{ ADAU1373_DRC(0) + 0x7,\t0x00 },\n\t{ ADAU1373_DRC(0) + 0x8,\t0x00 },\n\t{ ADAU1373_DRC(0) + 0x9,\t0xc0 },\n\t{ ADAU1373_DRC(0) + 0xa,\t0x88 },\n\t{ ADAU1373_DRC(0) + 0xb,\t0x7a },\n\t{ ADAU1373_DRC(0) + 0xc,\t0xdf },\n\t{ ADAU1373_DRC(0) + 0xd,\t0x20 },\n\t{ ADAU1373_DRC(0) + 0xe,\t0x00 },\n\t{ ADAU1373_DRC(0) + 0xf,\t0x00 },\n\t{ ADAU1373_DRC(1) + 0x0,\t0x78 },\n\t{ ADAU1373_DRC(1) + 0x1,\t0x18 },\n\t{ ADAU1373_DRC(1) + 0x2,\t0x00 },\n\t{ ADAU1373_DRC(1) + 0x3,\t0x00 },\n\t{ ADAU1373_DRC(1) + 0x4,\t0x00 },\n\t{ ADAU1373_DRC(1) + 0x5,\t0xc0 },\n\t{ ADAU1373_DRC(1) + 0x6,\t0x00 },\n\t{ ADAU1373_DRC(1) + 0x7,\t0x00 },\n\t{ ADAU1373_DRC(1) + 0x8,\t0x00 },\n\t{ ADAU1373_DRC(1) + 0x9,\t0xc0 },\n\t{ ADAU1373_DRC(1) + 0xa,\t0x88 },\n\t{ ADAU1373_DRC(1) + 0xb,\t0x7a },\n\t{ ADAU1373_DRC(1) + 0xc,\t0xdf },\n\t{ ADAU1373_DRC(1) + 0xd,\t0x20 },\n\t{ ADAU1373_DRC(1) + 0xe,\t0x00 },\n\t{ ADAU1373_DRC(1) + 0xf,\t0x00 },\n\t{ ADAU1373_DRC(2) + 0x0,\t0x78 },\n\t{ ADAU1373_DRC(2) + 0x1,\t0x18 },\n\t{ ADAU1373_DRC(2) + 0x2,\t0x00 },\n\t{ ADAU1373_DRC(2) + 0x3,\t0x00 },\n\t{ ADAU1373_DRC(2) + 0x4,\t0x00 },\n\t{ ADAU1373_DRC(2) + 0x5,\t0xc0 },\n\t{ ADAU1373_DRC(2) + 0x6,\t0x00 },\n\t{ ADAU1373_DRC(2) + 0x7,\t0x00 },\n\t{ ADAU1373_DRC(2) + 0x8,\t0x00 },\n\t{ ADAU1373_DRC(2) + 0x9,\t0xc0 },\n\t{ ADAU1373_DRC(2) + 0xa,\t0x88 },\n\t{ ADAU1373_DRC(2) + 0xb,\t0x7a },\n\t{ ADAU1373_DRC(2) + 0xc,\t0xdf },\n\t{ ADAU1373_DRC(2) + 0xd,\t0x20 },\n\t{ ADAU1373_DRC(2) + 0xe,\t0x00 },\n\t{ ADAU1373_DRC(2) + 0xf,\t0x00 },\n\t{ ADAU1373_3D_CTRL1,\t\t0x00 },\n\t{ ADAU1373_3D_CTRL2,\t\t0x00 },\n\t{ ADAU1373_FDSP_SEL1,\t\t0x00 },\n\t{ ADAU1373_FDSP_SEL2,\t\t0x00 },\n\t{ ADAU1373_FDSP_SEL2,\t\t0x00 },\n\t{ ADAU1373_FDSP_SEL4,\t\t0x00 },\n\t{ ADAU1373_DIGMICCTRL,\t\t0x00 },\n\t{ ADAU1373_DIGEN,\t\t0x00 },\n};\n\nstatic const DECLARE_TLV_DB_RANGE(adau1373_out_tlv,\n\t0, 7, TLV_DB_SCALE_ITEM(-7900, 400, 1),\n\t8, 15, TLV_DB_SCALE_ITEM(-4700, 300, 0),\n\t16, 23, TLV_DB_SCALE_ITEM(-2300, 200, 0),\n\t24, 31, TLV_DB_SCALE_ITEM(-700, 100, 0)\n);\n\nstatic const DECLARE_TLV_DB_MINMAX(adau1373_digital_tlv, -9563, 0);\nstatic const DECLARE_TLV_DB_SCALE(adau1373_in_pga_tlv, -1300, 100, 1);\nstatic const DECLARE_TLV_DB_SCALE(adau1373_ep_tlv, -600, 600, 1);\n\nstatic const DECLARE_TLV_DB_SCALE(adau1373_input_boost_tlv, 0, 2000, 0);\nstatic const DECLARE_TLV_DB_SCALE(adau1373_gain_boost_tlv, 0, 600, 0);\nstatic const DECLARE_TLV_DB_SCALE(adau1373_speaker_boost_tlv, 1200, 600, 0);\n\nstatic const char *adau1373_fdsp_sel_text[] = {\n\t\"None\",\n\t\"Channel 1\",\n\t\"Channel 2\",\n\t\"Channel 3\",\n\t\"Channel 4\",\n\t\"Channel 5\",\n};\n\nstatic SOC_ENUM_SINGLE_DECL(adau1373_drc1_channel_enum,\n\tADAU1373_FDSP_SEL1, 4, adau1373_fdsp_sel_text);\nstatic SOC_ENUM_SINGLE_DECL(adau1373_drc2_channel_enum,\n\tADAU1373_FDSP_SEL1, 0, adau1373_fdsp_sel_text);\nstatic SOC_ENUM_SINGLE_DECL(adau1373_drc3_channel_enum,\n\tADAU1373_FDSP_SEL2, 0, adau1373_fdsp_sel_text);\nstatic SOC_ENUM_SINGLE_DECL(adau1373_hpf_channel_enum,\n\tADAU1373_FDSP_SEL3, 0, adau1373_fdsp_sel_text);\nstatic SOC_ENUM_SINGLE_DECL(adau1373_bass_channel_enum,\n\tADAU1373_FDSP_SEL4, 4, adau1373_fdsp_sel_text);\n\nstatic const char *adau1373_hpf_cutoff_text[] = {\n\t\"3.7Hz\", \"50Hz\", \"100Hz\", \"150Hz\", \"200Hz\", \"250Hz\", \"300Hz\", \"350Hz\",\n\t\"400Hz\", \"450Hz\", \"500Hz\", \"550Hz\", \"600Hz\", \"650Hz\", \"700Hz\", \"750Hz\",\n\t\"800Hz\",\n};\n\nstatic SOC_ENUM_SINGLE_DECL(adau1373_hpf_cutoff_enum,\n\tADAU1373_HPF_CTRL, 3, adau1373_hpf_cutoff_text);\n\nstatic const char *adau1373_bass_lpf_cutoff_text[] = {\n\t\"801Hz\", \"1001Hz\",\n};\n\nstatic const char *adau1373_bass_clip_level_text[] = {\n\t\"0.125\", \"0.250\", \"0.370\", \"0.500\", \"0.625\", \"0.750\", \"0.875\",\n};\n\nstatic const unsigned int adau1373_bass_clip_level_values[] = {\n\t1, 2, 3, 4, 5, 6, 7,\n};\n\nstatic const char *adau1373_bass_hpf_cutoff_text[] = {\n\t\"158Hz\", \"232Hz\", \"347Hz\", \"520Hz\",\n};\n\nstatic const DECLARE_TLV_DB_RANGE(adau1373_bass_tlv,\n\t0, 2, TLV_DB_SCALE_ITEM(-600, 600, 1),\n\t3, 4, TLV_DB_SCALE_ITEM(950, 250, 0),\n\t5, 7, TLV_DB_SCALE_ITEM(1400, 150, 0)\n);\n\nstatic SOC_ENUM_SINGLE_DECL(adau1373_bass_lpf_cutoff_enum,\n\tADAU1373_BASS1, 5, adau1373_bass_lpf_cutoff_text);\n\nstatic SOC_VALUE_ENUM_SINGLE_DECL(adau1373_bass_clip_level_enum,\n\tADAU1373_BASS1, 2, 7, adau1373_bass_clip_level_text,\n\tadau1373_bass_clip_level_values);\n\nstatic SOC_ENUM_SINGLE_DECL(adau1373_bass_hpf_cutoff_enum,\n\tADAU1373_BASS1, 0, adau1373_bass_hpf_cutoff_text);\n\nstatic const char *adau1373_3d_level_text[] = {\n\t\"0%\", \"6.67%\", \"13.33%\", \"20%\", \"26.67%\", \"33.33%\",\n\t\"40%\", \"46.67%\", \"53.33%\", \"60%\", \"66.67%\", \"73.33%\",\n\t\"80%\", \"86.67\", \"99.33%\", \"100%\"\n};\n\nstatic const char *adau1373_3d_cutoff_text[] = {\n\t\"No 3D\", \"0.03125 fs\", \"0.04583 fs\", \"0.075 fs\", \"0.11458 fs\",\n\t\"0.16875 fs\", \"0.27083 fs\"\n};\n\nstatic SOC_ENUM_SINGLE_DECL(adau1373_3d_level_enum,\n\tADAU1373_3D_CTRL1, 4, adau1373_3d_level_text);\nstatic SOC_ENUM_SINGLE_DECL(adau1373_3d_cutoff_enum,\n\tADAU1373_3D_CTRL1, 0, adau1373_3d_cutoff_text);\n\nstatic const DECLARE_TLV_DB_RANGE(adau1373_3d_tlv,\n\t0, 0, TLV_DB_SCALE_ITEM(0, 0, 0),\n\t1, 7, TLV_DB_LINEAR_ITEM(-1800, -120)\n);\n\nstatic const char *adau1373_lr_mux_text[] = {\n\t\"Mute\",\n\t\"Right Channel (L+R)\",\n\t\"Left Channel (L+R)\",\n\t\"Stereo\",\n};\n\nstatic SOC_ENUM_SINGLE_DECL(adau1373_lineout1_lr_mux_enum,\n\tADAU1373_OUTPUT_CTRL, 4, adau1373_lr_mux_text);\nstatic SOC_ENUM_SINGLE_DECL(adau1373_lineout2_lr_mux_enum,\n\tADAU1373_OUTPUT_CTRL, 6, adau1373_lr_mux_text);\nstatic SOC_ENUM_SINGLE_DECL(adau1373_speaker_lr_mux_enum,\n\tADAU1373_LS_CTRL, 4, adau1373_lr_mux_text);\n\nstatic const struct snd_kcontrol_new adau1373_controls[] = {\n\tSOC_DOUBLE_R_TLV(\"AIF1 Capture Volume\", ADAU1373_DAI_RECL_VOL(0),\n\t\tADAU1373_DAI_RECR_VOL(0), 0, 0xff, 1, adau1373_digital_tlv),\n\tSOC_DOUBLE_R_TLV(\"AIF2 Capture Volume\", ADAU1373_DAI_RECL_VOL(1),\n\t\tADAU1373_DAI_RECR_VOL(1), 0, 0xff, 1, adau1373_digital_tlv),\n\tSOC_DOUBLE_R_TLV(\"AIF3 Capture Volume\", ADAU1373_DAI_RECL_VOL(2),\n\t\tADAU1373_DAI_RECR_VOL(2), 0, 0xff, 1, adau1373_digital_tlv),\n\n\tSOC_DOUBLE_R_TLV(\"ADC Capture Volume\", ADAU1373_ADC_RECL_VOL,\n\t\tADAU1373_ADC_RECR_VOL, 0, 0xff, 1, adau1373_digital_tlv),\n\tSOC_DOUBLE_R_TLV(\"DMIC Capture Volume\", ADAU1373_DMIC_RECL_VOL,\n\t\tADAU1373_DMIC_RECR_VOL, 0, 0xff, 1, adau1373_digital_tlv),\n\n\tSOC_DOUBLE_R_TLV(\"AIF1 Playback Volume\", ADAU1373_DAI_PBL_VOL(0),\n\t\tADAU1373_DAI_PBR_VOL(0), 0, 0xff, 1, adau1373_digital_tlv),\n\tSOC_DOUBLE_R_TLV(\"AIF2 Playback Volume\", ADAU1373_DAI_PBL_VOL(1),\n\t\tADAU1373_DAI_PBR_VOL(1), 0, 0xff, 1, adau1373_digital_tlv),\n\tSOC_DOUBLE_R_TLV(\"AIF3 Playback Volume\", ADAU1373_DAI_PBL_VOL(2),\n\t\tADAU1373_DAI_PBR_VOL(2), 0, 0xff, 1, adau1373_digital_tlv),\n\n\tSOC_DOUBLE_R_TLV(\"DAC1 Playback Volume\", ADAU1373_DAC1_PBL_VOL,\n\t\tADAU1373_DAC1_PBR_VOL, 0, 0xff, 1, adau1373_digital_tlv),\n\tSOC_DOUBLE_R_TLV(\"DAC2 Playback Volume\", ADAU1373_DAC2_PBL_VOL,\n\t\tADAU1373_DAC2_PBR_VOL, 0, 0xff, 1, adau1373_digital_tlv),\n\n\tSOC_DOUBLE_R_TLV(\"Lineout1 Playback Volume\", ADAU1373_LLINE_OUT(0),\n\t\tADAU1373_RLINE_OUT(0), 0, 0x1f, 0, adau1373_out_tlv),\n\tSOC_DOUBLE_R_TLV(\"Speaker Playback Volume\", ADAU1373_LSPK_OUT,\n\t\tADAU1373_RSPK_OUT, 0, 0x1f, 0, adau1373_out_tlv),\n\tSOC_DOUBLE_R_TLV(\"Headphone Playback Volume\", ADAU1373_LHP_OUT,\n\t\tADAU1373_RHP_OUT, 0, 0x1f, 0, adau1373_out_tlv),\n\n\tSOC_DOUBLE_R_TLV(\"Input 1 Capture Volume\", ADAU1373_AINL_CTRL(0),\n\t\tADAU1373_AINR_CTRL(0), 0, 0x1f, 0, adau1373_in_pga_tlv),\n\tSOC_DOUBLE_R_TLV(\"Input 2 Capture Volume\", ADAU1373_AINL_CTRL(1),\n\t\tADAU1373_AINR_CTRL(1), 0, 0x1f, 0, adau1373_in_pga_tlv),\n\tSOC_DOUBLE_R_TLV(\"Input 3 Capture Volume\", ADAU1373_AINL_CTRL(2),\n\t\tADAU1373_AINR_CTRL(2), 0, 0x1f, 0, adau1373_in_pga_tlv),\n\tSOC_DOUBLE_R_TLV(\"Input 4 Capture Volume\", ADAU1373_AINL_CTRL(3),\n\t\tADAU1373_AINR_CTRL(3), 0, 0x1f, 0, adau1373_in_pga_tlv),\n\n\tSOC_SINGLE_TLV(\"Earpiece Playback Volume\", ADAU1373_EP_CTRL, 0, 3, 0,\n\t\tadau1373_ep_tlv),\n\n\tSOC_DOUBLE_TLV(\"AIF3 Boost Playback Volume\", ADAU1373_VOL_GAIN1, 4, 5,\n\t\t1, 0, adau1373_gain_boost_tlv),\n\tSOC_DOUBLE_TLV(\"AIF2 Boost Playback Volume\", ADAU1373_VOL_GAIN1, 2, 3,\n\t\t1, 0, adau1373_gain_boost_tlv),\n\tSOC_DOUBLE_TLV(\"AIF1 Boost Playback Volume\", ADAU1373_VOL_GAIN1, 0, 1,\n\t\t1, 0, adau1373_gain_boost_tlv),\n\tSOC_DOUBLE_TLV(\"AIF3 Boost Capture Volume\", ADAU1373_VOL_GAIN2, 4, 5,\n\t\t1, 0, adau1373_gain_boost_tlv),\n\tSOC_DOUBLE_TLV(\"AIF2 Boost Capture Volume\", ADAU1373_VOL_GAIN2, 2, 3,\n\t\t1, 0, adau1373_gain_boost_tlv),\n\tSOC_DOUBLE_TLV(\"AIF1 Boost Capture Volume\", ADAU1373_VOL_GAIN2, 0, 1,\n\t\t1, 0, adau1373_gain_boost_tlv),\n\tSOC_DOUBLE_TLV(\"DMIC Boost Capture Volume\", ADAU1373_VOL_GAIN3, 6, 7,\n\t\t1, 0, adau1373_gain_boost_tlv),\n\tSOC_DOUBLE_TLV(\"ADC Boost Capture Volume\", ADAU1373_VOL_GAIN3, 4, 5,\n\t\t1, 0, adau1373_gain_boost_tlv),\n\tSOC_DOUBLE_TLV(\"DAC2 Boost Playback Volume\", ADAU1373_VOL_GAIN3, 2, 3,\n\t\t1, 0, adau1373_gain_boost_tlv),\n\tSOC_DOUBLE_TLV(\"DAC1 Boost Playback Volume\", ADAU1373_VOL_GAIN3, 0, 1,\n\t\t1, 0, adau1373_gain_boost_tlv),\n\n\tSOC_DOUBLE_TLV(\"Input 1 Boost Capture Volume\", ADAU1373_ADC_GAIN, 0, 4,\n\t\t1, 0, adau1373_input_boost_tlv),\n\tSOC_DOUBLE_TLV(\"Input 2 Boost Capture Volume\", ADAU1373_ADC_GAIN, 1, 5,\n\t\t1, 0, adau1373_input_boost_tlv),\n\tSOC_DOUBLE_TLV(\"Input 3 Boost Capture Volume\", ADAU1373_ADC_GAIN, 2, 6,\n\t\t1, 0, adau1373_input_boost_tlv),\n\tSOC_DOUBLE_TLV(\"Input 4 Boost Capture Volume\", ADAU1373_ADC_GAIN, 3, 7,\n\t\t1, 0, adau1373_input_boost_tlv),\n\n\tSOC_DOUBLE_TLV(\"Speaker Boost Playback Volume\", ADAU1373_LS_CTRL, 2, 3,\n\t\t1, 0, adau1373_speaker_boost_tlv),\n\n\tSOC_ENUM(\"Lineout1 LR Mux\", adau1373_lineout1_lr_mux_enum),\n\tSOC_ENUM(\"Speaker LR Mux\", adau1373_speaker_lr_mux_enum),\n\n\tSOC_ENUM(\"HPF Cutoff\", adau1373_hpf_cutoff_enum),\n\tSOC_DOUBLE(\"HPF Switch\", ADAU1373_HPF_CTRL, 1, 0, 1, 0),\n\tSOC_ENUM(\"HPF Channel\", adau1373_hpf_channel_enum),\n\n\tSOC_ENUM(\"Bass HPF Cutoff\", adau1373_bass_hpf_cutoff_enum),\n\tSOC_ENUM(\"Bass Clip Level Threshold\", adau1373_bass_clip_level_enum),\n\tSOC_ENUM(\"Bass LPF Cutoff\", adau1373_bass_lpf_cutoff_enum),\n\tSOC_DOUBLE(\"Bass Playback Switch\", ADAU1373_BASS2, 0, 1, 1, 0),\n\tSOC_SINGLE_TLV(\"Bass Playback Volume\", ADAU1373_BASS2, 2, 7, 0,\n\t    adau1373_bass_tlv),\n\tSOC_ENUM(\"Bass Channel\", adau1373_bass_channel_enum),\n\n\tSOC_ENUM(\"3D Freq\", adau1373_3d_cutoff_enum),\n\tSOC_ENUM(\"3D Level\", adau1373_3d_level_enum),\n\tSOC_SINGLE(\"3D Playback Switch\", ADAU1373_3D_CTRL2, 0, 1, 0),\n\tSOC_SINGLE_TLV(\"3D Playback Volume\", ADAU1373_3D_CTRL2, 2, 7, 0,\n\t\tadau1373_3d_tlv),\n\tSOC_ENUM(\"3D Channel\", adau1373_bass_channel_enum),\n\n\tSOC_SINGLE(\"Zero Cross Switch\", ADAU1373_PWDN_CTRL3, 7, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new adau1373_lineout2_controls[] = {\n\tSOC_DOUBLE_R_TLV(\"Lineout2 Playback Volume\", ADAU1373_LLINE_OUT(1),\n\t\tADAU1373_RLINE_OUT(1), 0, 0x1f, 0, adau1373_out_tlv),\n\tSOC_ENUM(\"Lineout2 LR Mux\", adau1373_lineout2_lr_mux_enum),\n};\n\nstatic const struct snd_kcontrol_new adau1373_drc_controls[] = {\n\tSOC_ENUM(\"DRC1 Channel\", adau1373_drc1_channel_enum),\n\tSOC_ENUM(\"DRC2 Channel\", adau1373_drc2_channel_enum),\n\tSOC_ENUM(\"DRC3 Channel\", adau1373_drc3_channel_enum),\n};\n\nstatic int adau1373_pll_event(struct snd_soc_dapm_widget *w,\n\tstruct snd_kcontrol *kcontrol, int event)\n{\n\tstruct snd_soc_component *component = snd_soc_dapm_to_component(w->dapm);\n\tstruct adau1373 *adau1373 = snd_soc_component_get_drvdata(component);\n\tunsigned int pll_id = w->name[3] - '1';\n\tunsigned int val;\n\n\tif (SND_SOC_DAPM_EVENT_ON(event))\n\t\tval = ADAU1373_PLL_CTRL6_PLL_EN;\n\telse\n\t\tval = 0;\n\n\tregmap_update_bits(adau1373->regmap, ADAU1373_PLL_CTRL6(pll_id),\n\t\tADAU1373_PLL_CTRL6_PLL_EN, val);\n\n\tif (SND_SOC_DAPM_EVENT_ON(event))\n\t\tmdelay(5);\n\n\treturn 0;\n}\n\nstatic const char *adau1373_decimator_text[] = {\n\t\"ADC\",\n\t\"DMIC1\",\n};\n\nstatic SOC_ENUM_SINGLE_VIRT_DECL(adau1373_decimator_enum,\n\tadau1373_decimator_text);\n\nstatic const struct snd_kcontrol_new adau1373_decimator_mux =\n\tSOC_DAPM_ENUM(\"Decimator Mux\", adau1373_decimator_enum);\n\nstatic const struct snd_kcontrol_new adau1373_left_adc_mixer_controls[] = {\n\tSOC_DAPM_SINGLE(\"DAC1 Switch\", ADAU1373_LADC_MIXER, 4, 1, 0),\n\tSOC_DAPM_SINGLE(\"Input 4 Switch\", ADAU1373_LADC_MIXER, 3, 1, 0),\n\tSOC_DAPM_SINGLE(\"Input 3 Switch\", ADAU1373_LADC_MIXER, 2, 1, 0),\n\tSOC_DAPM_SINGLE(\"Input 2 Switch\", ADAU1373_LADC_MIXER, 1, 1, 0),\n\tSOC_DAPM_SINGLE(\"Input 1 Switch\", ADAU1373_LADC_MIXER, 0, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new adau1373_right_adc_mixer_controls[] = {\n\tSOC_DAPM_SINGLE(\"DAC1 Switch\", ADAU1373_RADC_MIXER, 4, 1, 0),\n\tSOC_DAPM_SINGLE(\"Input 4 Switch\", ADAU1373_RADC_MIXER, 3, 1, 0),\n\tSOC_DAPM_SINGLE(\"Input 3 Switch\", ADAU1373_RADC_MIXER, 2, 1, 0),\n\tSOC_DAPM_SINGLE(\"Input 2 Switch\", ADAU1373_RADC_MIXER, 1, 1, 0),\n\tSOC_DAPM_SINGLE(\"Input 1 Switch\", ADAU1373_RADC_MIXER, 0, 1, 0),\n};\n\n#define DECLARE_ADAU1373_OUTPUT_MIXER_CTRLS(_name, _reg) \\\nconst struct snd_kcontrol_new _name[] = { \\\n\tSOC_DAPM_SINGLE(\"Left DAC2 Switch\", _reg, 7, 1, 0), \\\n\tSOC_DAPM_SINGLE(\"Right DAC2 Switch\", _reg, 6, 1, 0), \\\n\tSOC_DAPM_SINGLE(\"Left DAC1 Switch\", _reg, 5, 1, 0), \\\n\tSOC_DAPM_SINGLE(\"Right DAC1 Switch\", _reg, 4, 1, 0), \\\n\tSOC_DAPM_SINGLE(\"Input 4 Bypass Switch\", _reg, 3, 1, 0), \\\n\tSOC_DAPM_SINGLE(\"Input 3 Bypass Switch\", _reg, 2, 1, 0), \\\n\tSOC_DAPM_SINGLE(\"Input 2 Bypass Switch\", _reg, 1, 1, 0), \\\n\tSOC_DAPM_SINGLE(\"Input 1 Bypass Switch\", _reg, 0, 1, 0), \\\n}\n\nstatic DECLARE_ADAU1373_OUTPUT_MIXER_CTRLS(adau1373_left_line1_mixer_controls,\n\tADAU1373_LLINE1_MIX);\nstatic DECLARE_ADAU1373_OUTPUT_MIXER_CTRLS(adau1373_right_line1_mixer_controls,\n\tADAU1373_RLINE1_MIX);\nstatic DECLARE_ADAU1373_OUTPUT_MIXER_CTRLS(adau1373_left_line2_mixer_controls,\n\tADAU1373_LLINE2_MIX);\nstatic DECLARE_ADAU1373_OUTPUT_MIXER_CTRLS(adau1373_right_line2_mixer_controls,\n\tADAU1373_RLINE2_MIX);\nstatic DECLARE_ADAU1373_OUTPUT_MIXER_CTRLS(adau1373_left_spk_mixer_controls,\n\tADAU1373_LSPK_MIX);\nstatic DECLARE_ADAU1373_OUTPUT_MIXER_CTRLS(adau1373_right_spk_mixer_controls,\n\tADAU1373_RSPK_MIX);\nstatic DECLARE_ADAU1373_OUTPUT_MIXER_CTRLS(adau1373_ep_mixer_controls,\n\tADAU1373_EP_MIX);\n\nstatic const struct snd_kcontrol_new adau1373_left_hp_mixer_controls[] = {\n\tSOC_DAPM_SINGLE(\"Left DAC1 Switch\", ADAU1373_LHP_MIX, 5, 1, 0),\n\tSOC_DAPM_SINGLE(\"Left DAC2 Switch\", ADAU1373_LHP_MIX, 4, 1, 0),\n\tSOC_DAPM_SINGLE(\"Input 4 Bypass Switch\", ADAU1373_LHP_MIX, 3, 1, 0),\n\tSOC_DAPM_SINGLE(\"Input 3 Bypass Switch\", ADAU1373_LHP_MIX, 2, 1, 0),\n\tSOC_DAPM_SINGLE(\"Input 2 Bypass Switch\", ADAU1373_LHP_MIX, 1, 1, 0),\n\tSOC_DAPM_SINGLE(\"Input 1 Bypass Switch\", ADAU1373_LHP_MIX, 0, 1, 0),\n};\n\nstatic const struct snd_kcontrol_new adau1373_right_hp_mixer_controls[] = {\n\tSOC_DAPM_SINGLE(\"Right DAC1 Switch\", ADAU1373_RHP_MIX, 5, 1, 0),\n\tSOC_DAPM_SINGLE(\"Right DAC2 Switch\", ADAU1373_RHP_MIX, 4, 1, 0),\n\tSOC_DAPM_SINGLE(\"Input 4 Bypass Switch\", ADAU1373_RHP_MIX, 3, 1, 0),\n\tSOC_DAPM_SINGLE(\"Input 3 Bypass Switch\", ADAU1373_RHP_MIX, 2, 1, 0),\n\tSOC_DAPM_SINGLE(\"Input 2 Bypass Switch\", ADAU1373_RHP_MIX, 1, 1, 0),\n\tSOC_DAPM_SINGLE(\"Input 1 Bypass Switch\", ADAU1373_RHP_MIX, 0, 1, 0),\n};\n\n#define DECLARE_ADAU1373_DSP_CHANNEL_MIXER_CTRLS(_name, _reg) \\\nconst struct snd_kcontrol_new _name[] = { \\\n\tSOC_DAPM_SINGLE(\"DMIC2 Swapped Switch\", _reg, 6, 1, 0), \\\n\tSOC_DAPM_SINGLE(\"DMIC2 Switch\", _reg, 5, 1, 0), \\\n\tSOC_DAPM_SINGLE(\"ADC/DMIC1 Swapped Switch\", _reg, 4, 1, 0), \\\n\tSOC_DAPM_SINGLE(\"ADC/DMIC1 Switch\", _reg, 3, 1, 0), \\\n\tSOC_DAPM_SINGLE(\"AIF3 Switch\", _reg, 2, 1, 0), \\\n\tSOC_DAPM_SINGLE(\"AIF2 Switch\", _reg, 1, 1, 0), \\\n\tSOC_DAPM_SINGLE(\"AIF1 Switch\", _reg, 0, 1, 0), \\\n}\n\nstatic DECLARE_ADAU1373_DSP_CHANNEL_MIXER_CTRLS(adau1373_dsp_channel1_mixer_controls,\n\tADAU1373_DIN_MIX_CTRL(0));\nstatic DECLARE_ADAU1373_DSP_CHANNEL_MIXER_CTRLS(adau1373_dsp_channel2_mixer_controls,\n\tADAU1373_DIN_MIX_CTRL(1));\nstatic DECLARE_ADAU1373_DSP_CHANNEL_MIXER_CTRLS(adau1373_dsp_channel3_mixer_controls,\n\tADAU1373_DIN_MIX_CTRL(2));\nstatic DECLARE_ADAU1373_DSP_CHANNEL_MIXER_CTRLS(adau1373_dsp_channel4_mixer_controls,\n\tADAU1373_DIN_MIX_CTRL(3));\nstatic DECLARE_ADAU1373_DSP_CHANNEL_MIXER_CTRLS(adau1373_dsp_channel5_mixer_controls,\n\tADAU1373_DIN_MIX_CTRL(4));\n\n#define DECLARE_ADAU1373_DSP_OUTPUT_MIXER_CTRLS(_name, _reg) \\\nconst struct snd_kcontrol_new _name[] = { \\\n\tSOC_DAPM_SINGLE(\"DSP Channel5 Switch\", _reg, 4, 1, 0), \\\n\tSOC_DAPM_SINGLE(\"DSP Channel4 Switch\", _reg, 3, 1, 0), \\\n\tSOC_DAPM_SINGLE(\"DSP Channel3 Switch\", _reg, 2, 1, 0), \\\n\tSOC_DAPM_SINGLE(\"DSP Channel2 Switch\", _reg, 1, 1, 0), \\\n\tSOC_DAPM_SINGLE(\"DSP Channel1 Switch\", _reg, 0, 1, 0), \\\n}\n\nstatic DECLARE_ADAU1373_DSP_OUTPUT_MIXER_CTRLS(adau1373_aif1_mixer_controls,\n\tADAU1373_DOUT_MIX_CTRL(0));\nstatic DECLARE_ADAU1373_DSP_OUTPUT_MIXER_CTRLS(adau1373_aif2_mixer_controls,\n\tADAU1373_DOUT_MIX_CTRL(1));\nstatic DECLARE_ADAU1373_DSP_OUTPUT_MIXER_CTRLS(adau1373_aif3_mixer_controls,\n\tADAU1373_DOUT_MIX_CTRL(2));\nstatic DECLARE_ADAU1373_DSP_OUTPUT_MIXER_CTRLS(adau1373_dac1_mixer_controls,\n\tADAU1373_DOUT_MIX_CTRL(3));\nstatic DECLARE_ADAU1373_DSP_OUTPUT_MIXER_CTRLS(adau1373_dac2_mixer_controls,\n\tADAU1373_DOUT_MIX_CTRL(4));\n\nstatic const struct snd_soc_dapm_widget adau1373_dapm_widgets[] = {\n\t \n\tSND_SOC_DAPM_ADC(\"Left ADC\", NULL, ADAU1373_PWDN_CTRL1, 7, 0),\n\tSND_SOC_DAPM_ADC(\"Right ADC\", NULL, ADAU1373_PWDN_CTRL1, 6, 0),\n\n\tSND_SOC_DAPM_ADC(\"DMIC1\", NULL, ADAU1373_DIGMICCTRL, 0, 0),\n\tSND_SOC_DAPM_ADC(\"DMIC2\", NULL, ADAU1373_DIGMICCTRL, 2, 0),\n\n\tSND_SOC_DAPM_MUX(\"Decimator Mux\", SND_SOC_NOPM, 0, 0,\n\t\t&adau1373_decimator_mux),\n\n\tSND_SOC_DAPM_SUPPLY(\"MICBIAS2\", ADAU1373_PWDN_CTRL1, 5, 0, NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"MICBIAS1\", ADAU1373_PWDN_CTRL1, 4, 0, NULL, 0),\n\n\tSND_SOC_DAPM_PGA(\"IN4PGA\", ADAU1373_PWDN_CTRL1, 3, 0, NULL, 0),\n\tSND_SOC_DAPM_PGA(\"IN3PGA\", ADAU1373_PWDN_CTRL1, 2, 0, NULL, 0),\n\tSND_SOC_DAPM_PGA(\"IN2PGA\", ADAU1373_PWDN_CTRL1, 1, 0, NULL, 0),\n\tSND_SOC_DAPM_PGA(\"IN1PGA\", ADAU1373_PWDN_CTRL1, 0, 0, NULL, 0),\n\n\tSND_SOC_DAPM_DAC(\"Left DAC2\", NULL, ADAU1373_PWDN_CTRL2, 7, 0),\n\tSND_SOC_DAPM_DAC(\"Right DAC2\", NULL, ADAU1373_PWDN_CTRL2, 6, 0),\n\tSND_SOC_DAPM_DAC(\"Left DAC1\", NULL, ADAU1373_PWDN_CTRL2, 5, 0),\n\tSND_SOC_DAPM_DAC(\"Right DAC1\", NULL, ADAU1373_PWDN_CTRL2, 4, 0),\n\n\tSOC_MIXER_ARRAY(\"Left ADC Mixer\", SND_SOC_NOPM, 0, 0,\n\t\tadau1373_left_adc_mixer_controls),\n\tSOC_MIXER_ARRAY(\"Right ADC Mixer\", SND_SOC_NOPM, 0, 0,\n\t\tadau1373_right_adc_mixer_controls),\n\n\tSOC_MIXER_ARRAY(\"Left Lineout2 Mixer\", ADAU1373_PWDN_CTRL2, 3, 0,\n\t\tadau1373_left_line2_mixer_controls),\n\tSOC_MIXER_ARRAY(\"Right Lineout2 Mixer\", ADAU1373_PWDN_CTRL2, 2, 0,\n\t\tadau1373_right_line2_mixer_controls),\n\tSOC_MIXER_ARRAY(\"Left Lineout1 Mixer\", ADAU1373_PWDN_CTRL2, 1, 0,\n\t\tadau1373_left_line1_mixer_controls),\n\tSOC_MIXER_ARRAY(\"Right Lineout1 Mixer\", ADAU1373_PWDN_CTRL2, 0, 0,\n\t\tadau1373_right_line1_mixer_controls),\n\n\tSOC_MIXER_ARRAY(\"Earpiece Mixer\", ADAU1373_PWDN_CTRL3, 4, 0,\n\t\tadau1373_ep_mixer_controls),\n\tSOC_MIXER_ARRAY(\"Left Speaker Mixer\", ADAU1373_PWDN_CTRL3, 3, 0,\n\t\tadau1373_left_spk_mixer_controls),\n\tSOC_MIXER_ARRAY(\"Right Speaker Mixer\", ADAU1373_PWDN_CTRL3, 2, 0,\n\t\tadau1373_right_spk_mixer_controls),\n\tSOC_MIXER_ARRAY(\"Left Headphone Mixer\", SND_SOC_NOPM, 0, 0,\n\t\tadau1373_left_hp_mixer_controls),\n\tSOC_MIXER_ARRAY(\"Right Headphone Mixer\", SND_SOC_NOPM, 0, 0,\n\t\tadau1373_right_hp_mixer_controls),\n\tSND_SOC_DAPM_SUPPLY(\"Headphone Enable\", ADAU1373_PWDN_CTRL3, 1, 0,\n\t\tNULL, 0),\n\n\tSND_SOC_DAPM_SUPPLY(\"AIF1 CLK\", ADAU1373_SRC_DAI_CTRL(0), 0, 0,\n\t    NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"AIF2 CLK\", ADAU1373_SRC_DAI_CTRL(1), 0, 0,\n\t    NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"AIF3 CLK\", ADAU1373_SRC_DAI_CTRL(2), 0, 0,\n\t    NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"AIF1 IN SRC\", ADAU1373_SRC_DAI_CTRL(0), 2, 0,\n\t    NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"AIF1 OUT SRC\", ADAU1373_SRC_DAI_CTRL(0), 1, 0,\n\t    NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"AIF2 IN SRC\", ADAU1373_SRC_DAI_CTRL(1), 2, 0,\n\t    NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"AIF2 OUT SRC\", ADAU1373_SRC_DAI_CTRL(1), 1, 0,\n\t    NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"AIF3 IN SRC\", ADAU1373_SRC_DAI_CTRL(2), 2, 0,\n\t    NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"AIF3 OUT SRC\", ADAU1373_SRC_DAI_CTRL(2), 1, 0,\n\t    NULL, 0),\n\n\tSND_SOC_DAPM_AIF_IN(\"AIF1 IN\", \"AIF1 Playback\", 0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"AIF1 OUT\", \"AIF1 Capture\", 0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"AIF2 IN\", \"AIF2 Playback\", 0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"AIF2 OUT\", \"AIF2 Capture\", 0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"AIF3 IN\", \"AIF3 Playback\", 0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"AIF3 OUT\", \"AIF3 Capture\", 0, SND_SOC_NOPM, 0, 0),\n\n\tSOC_MIXER_ARRAY(\"DSP Channel1 Mixer\", SND_SOC_NOPM, 0, 0,\n\t\tadau1373_dsp_channel1_mixer_controls),\n\tSOC_MIXER_ARRAY(\"DSP Channel2 Mixer\", SND_SOC_NOPM, 0, 0,\n\t\tadau1373_dsp_channel2_mixer_controls),\n\tSOC_MIXER_ARRAY(\"DSP Channel3 Mixer\", SND_SOC_NOPM, 0, 0,\n\t\tadau1373_dsp_channel3_mixer_controls),\n\tSOC_MIXER_ARRAY(\"DSP Channel4 Mixer\", SND_SOC_NOPM, 0, 0,\n\t\tadau1373_dsp_channel4_mixer_controls),\n\tSOC_MIXER_ARRAY(\"DSP Channel5 Mixer\", SND_SOC_NOPM, 0, 0,\n\t\tadau1373_dsp_channel5_mixer_controls),\n\n\tSOC_MIXER_ARRAY(\"AIF1 Mixer\", SND_SOC_NOPM, 0, 0,\n\t\tadau1373_aif1_mixer_controls),\n\tSOC_MIXER_ARRAY(\"AIF2 Mixer\", SND_SOC_NOPM, 0, 0,\n\t\tadau1373_aif2_mixer_controls),\n\tSOC_MIXER_ARRAY(\"AIF3 Mixer\", SND_SOC_NOPM, 0, 0,\n\t\tadau1373_aif3_mixer_controls),\n\tSOC_MIXER_ARRAY(\"DAC1 Mixer\", SND_SOC_NOPM, 0, 0,\n\t\tadau1373_dac1_mixer_controls),\n\tSOC_MIXER_ARRAY(\"DAC2 Mixer\", SND_SOC_NOPM, 0, 0,\n\t\tadau1373_dac2_mixer_controls),\n\n\tSND_SOC_DAPM_SUPPLY(\"DSP\", ADAU1373_DIGEN, 4, 0, NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"Recording Engine B\", ADAU1373_DIGEN, 3, 0, NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"Recording Engine A\", ADAU1373_DIGEN, 2, 0, NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"Playback Engine B\", ADAU1373_DIGEN, 1, 0, NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"Playback Engine A\", ADAU1373_DIGEN, 0, 0, NULL, 0),\n\n\tSND_SOC_DAPM_SUPPLY(\"PLL1\", SND_SOC_NOPM, 0, 0, adau1373_pll_event,\n\t\tSND_SOC_DAPM_PRE_PMU | SND_SOC_DAPM_POST_PMD),\n\tSND_SOC_DAPM_SUPPLY(\"PLL2\", SND_SOC_NOPM, 0, 0, adau1373_pll_event,\n\t\tSND_SOC_DAPM_PRE_PMU | SND_SOC_DAPM_POST_PMD),\n\tSND_SOC_DAPM_SUPPLY(\"SYSCLK1\", ADAU1373_CLK_SRC_DIV(0), 7, 0, NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"SYSCLK2\", ADAU1373_CLK_SRC_DIV(1), 7, 0, NULL, 0),\n\n\tSND_SOC_DAPM_INPUT(\"AIN1L\"),\n\tSND_SOC_DAPM_INPUT(\"AIN1R\"),\n\tSND_SOC_DAPM_INPUT(\"AIN2L\"),\n\tSND_SOC_DAPM_INPUT(\"AIN2R\"),\n\tSND_SOC_DAPM_INPUT(\"AIN3L\"),\n\tSND_SOC_DAPM_INPUT(\"AIN3R\"),\n\tSND_SOC_DAPM_INPUT(\"AIN4L\"),\n\tSND_SOC_DAPM_INPUT(\"AIN4R\"),\n\n\tSND_SOC_DAPM_INPUT(\"DMIC1DAT\"),\n\tSND_SOC_DAPM_INPUT(\"DMIC2DAT\"),\n\n\tSND_SOC_DAPM_OUTPUT(\"LOUT1L\"),\n\tSND_SOC_DAPM_OUTPUT(\"LOUT1R\"),\n\tSND_SOC_DAPM_OUTPUT(\"LOUT2L\"),\n\tSND_SOC_DAPM_OUTPUT(\"LOUT2R\"),\n\tSND_SOC_DAPM_OUTPUT(\"HPL\"),\n\tSND_SOC_DAPM_OUTPUT(\"HPR\"),\n\tSND_SOC_DAPM_OUTPUT(\"SPKL\"),\n\tSND_SOC_DAPM_OUTPUT(\"SPKR\"),\n\tSND_SOC_DAPM_OUTPUT(\"EP\"),\n};\n\nstatic int adau1373_check_aif_clk(struct snd_soc_dapm_widget *source,\n\tstruct snd_soc_dapm_widget *sink)\n{\n\tstruct snd_soc_component *component = snd_soc_dapm_to_component(source->dapm);\n\tstruct adau1373 *adau1373 = snd_soc_component_get_drvdata(component);\n\tunsigned int dai;\n\tconst char *clk;\n\n\tdai = sink->name[3] - '1';\n\n\tif (!adau1373->dais[dai].clock_provider)\n\t\treturn 0;\n\n\tif (adau1373->dais[dai].clk_src == ADAU1373_CLK_SRC_PLL1)\n\t\tclk = \"SYSCLK1\";\n\telse\n\t\tclk = \"SYSCLK2\";\n\n\treturn strcmp(source->name, clk) == 0;\n}\n\nstatic int adau1373_check_src(struct snd_soc_dapm_widget *source,\n\tstruct snd_soc_dapm_widget *sink)\n{\n\tstruct snd_soc_component *component = snd_soc_dapm_to_component(source->dapm);\n\tstruct adau1373 *adau1373 = snd_soc_component_get_drvdata(component);\n\tunsigned int dai;\n\n\tdai = sink->name[3] - '1';\n\n\treturn adau1373->dais[dai].enable_src;\n}\n\n#define DSP_CHANNEL_MIXER_ROUTES(_sink) \\\n\t{ _sink, \"DMIC2 Swapped Switch\", \"DMIC2\" }, \\\n\t{ _sink, \"DMIC2 Switch\", \"DMIC2\" }, \\\n\t{ _sink, \"ADC/DMIC1 Swapped Switch\", \"Decimator Mux\" }, \\\n\t{ _sink, \"ADC/DMIC1 Switch\", \"Decimator Mux\" }, \\\n\t{ _sink, \"AIF1 Switch\", \"AIF1 IN\" }, \\\n\t{ _sink, \"AIF2 Switch\", \"AIF2 IN\" }, \\\n\t{ _sink, \"AIF3 Switch\", \"AIF3 IN\" }\n\n#define DSP_OUTPUT_MIXER_ROUTES(_sink) \\\n\t{ _sink, \"DSP Channel1 Switch\", \"DSP Channel1 Mixer\" }, \\\n\t{ _sink, \"DSP Channel2 Switch\", \"DSP Channel2 Mixer\" }, \\\n\t{ _sink, \"DSP Channel3 Switch\", \"DSP Channel3 Mixer\" }, \\\n\t{ _sink, \"DSP Channel4 Switch\", \"DSP Channel4 Mixer\" }, \\\n\t{ _sink, \"DSP Channel5 Switch\", \"DSP Channel5 Mixer\" }\n\n#define LEFT_OUTPUT_MIXER_ROUTES(_sink) \\\n\t{ _sink, \"Right DAC2 Switch\", \"Right DAC2\" }, \\\n\t{ _sink, \"Left DAC2 Switch\", \"Left DAC2\" }, \\\n\t{ _sink, \"Right DAC1 Switch\", \"Right DAC1\" }, \\\n\t{ _sink, \"Left DAC1 Switch\", \"Left DAC1\" }, \\\n\t{ _sink, \"Input 1 Bypass Switch\", \"IN1PGA\" }, \\\n\t{ _sink, \"Input 2 Bypass Switch\", \"IN2PGA\" }, \\\n\t{ _sink, \"Input 3 Bypass Switch\", \"IN3PGA\" }, \\\n\t{ _sink, \"Input 4 Bypass Switch\", \"IN4PGA\" }\n\n#define RIGHT_OUTPUT_MIXER_ROUTES(_sink) \\\n\t{ _sink, \"Right DAC2 Switch\", \"Right DAC2\" }, \\\n\t{ _sink, \"Left DAC2 Switch\", \"Left DAC2\" }, \\\n\t{ _sink, \"Right DAC1 Switch\", \"Right DAC1\" }, \\\n\t{ _sink, \"Left DAC1 Switch\", \"Left DAC1\" }, \\\n\t{ _sink, \"Input 1 Bypass Switch\", \"IN1PGA\" }, \\\n\t{ _sink, \"Input 2 Bypass Switch\", \"IN2PGA\" }, \\\n\t{ _sink, \"Input 3 Bypass Switch\", \"IN3PGA\" }, \\\n\t{ _sink, \"Input 4 Bypass Switch\", \"IN4PGA\" }\n\nstatic const struct snd_soc_dapm_route adau1373_dapm_routes[] = {\n\t{ \"Left ADC Mixer\", \"DAC1 Switch\", \"Left DAC1\" },\n\t{ \"Left ADC Mixer\", \"Input 1 Switch\", \"IN1PGA\" },\n\t{ \"Left ADC Mixer\", \"Input 2 Switch\", \"IN2PGA\" },\n\t{ \"Left ADC Mixer\", \"Input 3 Switch\", \"IN3PGA\" },\n\t{ \"Left ADC Mixer\", \"Input 4 Switch\", \"IN4PGA\" },\n\n\t{ \"Right ADC Mixer\", \"DAC1 Switch\", \"Right DAC1\" },\n\t{ \"Right ADC Mixer\", \"Input 1 Switch\", \"IN1PGA\" },\n\t{ \"Right ADC Mixer\", \"Input 2 Switch\", \"IN2PGA\" },\n\t{ \"Right ADC Mixer\", \"Input 3 Switch\", \"IN3PGA\" },\n\t{ \"Right ADC Mixer\", \"Input 4 Switch\", \"IN4PGA\" },\n\n\t{ \"Left ADC\", NULL, \"Left ADC Mixer\" },\n\t{ \"Right ADC\", NULL, \"Right ADC Mixer\" },\n\n\t{ \"Decimator Mux\", \"ADC\", \"Left ADC\" },\n\t{ \"Decimator Mux\", \"ADC\", \"Right ADC\" },\n\t{ \"Decimator Mux\", \"DMIC1\", \"DMIC1\" },\n\n\tDSP_CHANNEL_MIXER_ROUTES(\"DSP Channel1 Mixer\"),\n\tDSP_CHANNEL_MIXER_ROUTES(\"DSP Channel2 Mixer\"),\n\tDSP_CHANNEL_MIXER_ROUTES(\"DSP Channel3 Mixer\"),\n\tDSP_CHANNEL_MIXER_ROUTES(\"DSP Channel4 Mixer\"),\n\tDSP_CHANNEL_MIXER_ROUTES(\"DSP Channel5 Mixer\"),\n\n\tDSP_OUTPUT_MIXER_ROUTES(\"AIF1 Mixer\"),\n\tDSP_OUTPUT_MIXER_ROUTES(\"AIF2 Mixer\"),\n\tDSP_OUTPUT_MIXER_ROUTES(\"AIF3 Mixer\"),\n\tDSP_OUTPUT_MIXER_ROUTES(\"DAC1 Mixer\"),\n\tDSP_OUTPUT_MIXER_ROUTES(\"DAC2 Mixer\"),\n\n\t{ \"AIF1 OUT\", NULL, \"AIF1 Mixer\" },\n\t{ \"AIF2 OUT\", NULL, \"AIF2 Mixer\" },\n\t{ \"AIF3 OUT\", NULL, \"AIF3 Mixer\" },\n\t{ \"Left DAC1\", NULL, \"DAC1 Mixer\" },\n\t{ \"Right DAC1\", NULL, \"DAC1 Mixer\" },\n\t{ \"Left DAC2\", NULL, \"DAC2 Mixer\" },\n\t{ \"Right DAC2\", NULL, \"DAC2 Mixer\" },\n\n\tLEFT_OUTPUT_MIXER_ROUTES(\"Left Lineout1 Mixer\"),\n\tRIGHT_OUTPUT_MIXER_ROUTES(\"Right Lineout1 Mixer\"),\n\tLEFT_OUTPUT_MIXER_ROUTES(\"Left Lineout2 Mixer\"),\n\tRIGHT_OUTPUT_MIXER_ROUTES(\"Right Lineout2 Mixer\"),\n\tLEFT_OUTPUT_MIXER_ROUTES(\"Left Speaker Mixer\"),\n\tRIGHT_OUTPUT_MIXER_ROUTES(\"Right Speaker Mixer\"),\n\n\t{ \"Left Headphone Mixer\", \"Left DAC2 Switch\", \"Left DAC2\" },\n\t{ \"Left Headphone Mixer\", \"Left DAC1 Switch\", \"Left DAC1\" },\n\t{ \"Left Headphone Mixer\", \"Input 1 Bypass Switch\", \"IN1PGA\" },\n\t{ \"Left Headphone Mixer\", \"Input 2 Bypass Switch\", \"IN2PGA\" },\n\t{ \"Left Headphone Mixer\", \"Input 3 Bypass Switch\", \"IN3PGA\" },\n\t{ \"Left Headphone Mixer\", \"Input 4 Bypass Switch\", \"IN4PGA\" },\n\t{ \"Right Headphone Mixer\", \"Right DAC2 Switch\", \"Right DAC2\" },\n\t{ \"Right Headphone Mixer\", \"Right DAC1 Switch\", \"Right DAC1\" },\n\t{ \"Right Headphone Mixer\", \"Input 1 Bypass Switch\", \"IN1PGA\" },\n\t{ \"Right Headphone Mixer\", \"Input 2 Bypass Switch\", \"IN2PGA\" },\n\t{ \"Right Headphone Mixer\", \"Input 3 Bypass Switch\", \"IN3PGA\" },\n\t{ \"Right Headphone Mixer\", \"Input 4 Bypass Switch\", \"IN4PGA\" },\n\n\t{ \"Left Headphone Mixer\", NULL, \"Headphone Enable\" },\n\t{ \"Right Headphone Mixer\", NULL, \"Headphone Enable\" },\n\n\t{ \"Earpiece Mixer\", \"Right DAC2 Switch\", \"Right DAC2\" },\n\t{ \"Earpiece Mixer\", \"Left DAC2 Switch\", \"Left DAC2\" },\n\t{ \"Earpiece Mixer\", \"Right DAC1 Switch\", \"Right DAC1\" },\n\t{ \"Earpiece Mixer\", \"Left DAC1 Switch\", \"Left DAC1\" },\n\t{ \"Earpiece Mixer\", \"Input 1 Bypass Switch\", \"IN1PGA\" },\n\t{ \"Earpiece Mixer\", \"Input 2 Bypass Switch\", \"IN2PGA\" },\n\t{ \"Earpiece Mixer\", \"Input 3 Bypass Switch\", \"IN3PGA\" },\n\t{ \"Earpiece Mixer\", \"Input 4 Bypass Switch\", \"IN4PGA\" },\n\n\t{ \"LOUT1L\", NULL, \"Left Lineout1 Mixer\" },\n\t{ \"LOUT1R\", NULL, \"Right Lineout1 Mixer\" },\n\t{ \"LOUT2L\", NULL, \"Left Lineout2 Mixer\" },\n\t{ \"LOUT2R\", NULL, \"Right Lineout2 Mixer\" },\n\t{ \"SPKL\", NULL, \"Left Speaker Mixer\" },\n\t{ \"SPKR\", NULL, \"Right Speaker Mixer\" },\n\t{ \"HPL\", NULL, \"Left Headphone Mixer\" },\n\t{ \"HPR\", NULL, \"Right Headphone Mixer\" },\n\t{ \"EP\", NULL, \"Earpiece Mixer\" },\n\n\t{ \"IN1PGA\", NULL, \"AIN1L\" },\n\t{ \"IN2PGA\", NULL, \"AIN2L\" },\n\t{ \"IN3PGA\", NULL, \"AIN3L\" },\n\t{ \"IN4PGA\", NULL, \"AIN4L\" },\n\t{ \"IN1PGA\", NULL, \"AIN1R\" },\n\t{ \"IN2PGA\", NULL, \"AIN2R\" },\n\t{ \"IN3PGA\", NULL, \"AIN3R\" },\n\t{ \"IN4PGA\", NULL, \"AIN4R\" },\n\n\t{ \"SYSCLK1\", NULL, \"PLL1\" },\n\t{ \"SYSCLK2\", NULL, \"PLL2\" },\n\n\t{ \"Left DAC1\", NULL, \"SYSCLK1\" },\n\t{ \"Right DAC1\", NULL, \"SYSCLK1\" },\n\t{ \"Left DAC2\", NULL, \"SYSCLK1\" },\n\t{ \"Right DAC2\", NULL, \"SYSCLK1\" },\n\t{ \"Left ADC\", NULL, \"SYSCLK1\" },\n\t{ \"Right ADC\", NULL, \"SYSCLK1\" },\n\n\t{ \"DSP\", NULL, \"SYSCLK1\" },\n\n\t{ \"AIF1 Mixer\", NULL, \"DSP\" },\n\t{ \"AIF2 Mixer\", NULL, \"DSP\" },\n\t{ \"AIF3 Mixer\", NULL, \"DSP\" },\n\t{ \"DAC1 Mixer\", NULL, \"DSP\" },\n\t{ \"DAC2 Mixer\", NULL, \"DSP\" },\n\t{ \"DAC1 Mixer\", NULL, \"Playback Engine A\" },\n\t{ \"DAC2 Mixer\", NULL, \"Playback Engine B\" },\n\t{ \"Left ADC Mixer\", NULL, \"Recording Engine A\" },\n\t{ \"Right ADC Mixer\", NULL, \"Recording Engine A\" },\n\n\t{ \"AIF1 CLK\", NULL, \"SYSCLK1\", adau1373_check_aif_clk },\n\t{ \"AIF2 CLK\", NULL, \"SYSCLK1\", adau1373_check_aif_clk },\n\t{ \"AIF3 CLK\", NULL, \"SYSCLK1\", adau1373_check_aif_clk },\n\t{ \"AIF1 CLK\", NULL, \"SYSCLK2\", adau1373_check_aif_clk },\n\t{ \"AIF2 CLK\", NULL, \"SYSCLK2\", adau1373_check_aif_clk },\n\t{ \"AIF3 CLK\", NULL, \"SYSCLK2\", adau1373_check_aif_clk },\n\n\t{ \"AIF1 IN\", NULL, \"AIF1 CLK\" },\n\t{ \"AIF1 OUT\", NULL, \"AIF1 CLK\" },\n\t{ \"AIF2 IN\", NULL, \"AIF2 CLK\" },\n\t{ \"AIF2 OUT\", NULL, \"AIF2 CLK\" },\n\t{ \"AIF3 IN\", NULL, \"AIF3 CLK\" },\n\t{ \"AIF3 OUT\", NULL, \"AIF3 CLK\" },\n\t{ \"AIF1 IN\", NULL, \"AIF1 IN SRC\", adau1373_check_src },\n\t{ \"AIF1 OUT\", NULL, \"AIF1 OUT SRC\", adau1373_check_src },\n\t{ \"AIF2 IN\", NULL, \"AIF2 IN SRC\", adau1373_check_src },\n\t{ \"AIF2 OUT\", NULL, \"AIF2 OUT SRC\", adau1373_check_src },\n\t{ \"AIF3 IN\", NULL, \"AIF3 IN SRC\", adau1373_check_src },\n\t{ \"AIF3 OUT\", NULL, \"AIF3 OUT SRC\", adau1373_check_src },\n\n\t{ \"DMIC1\", NULL, \"DMIC1DAT\" },\n\t{ \"DMIC1\", NULL, \"SYSCLK1\" },\n\t{ \"DMIC1\", NULL, \"Recording Engine A\" },\n\t{ \"DMIC2\", NULL, \"DMIC2DAT\" },\n\t{ \"DMIC2\", NULL, \"SYSCLK1\" },\n\t{ \"DMIC2\", NULL, \"Recording Engine B\" },\n};\n\nstatic int adau1373_hw_params(struct snd_pcm_substream *substream,\n\tstruct snd_pcm_hw_params *params, struct snd_soc_dai *dai)\n{\n\tstruct snd_soc_component *component = dai->component;\n\tstruct adau1373 *adau1373 = snd_soc_component_get_drvdata(component);\n\tstruct adau1373_dai *adau1373_dai = &adau1373->dais[dai->id];\n\tunsigned int div;\n\tunsigned int freq;\n\tunsigned int ctrl;\n\n\tfreq = adau1373_dai->sysclk;\n\n\tif (freq % params_rate(params) != 0)\n\t\treturn -EINVAL;\n\n\tswitch (freq / params_rate(params)) {\n\tcase 1024:  \n\t\tdiv = 0;\n\t\tbreak;\n\tcase 1536:  \n\t\tdiv = 1;\n\t\tbreak;\n\tcase 2048:  \n\t\tdiv = 2;\n\t\tbreak;\n\tcase 3072:  \n\t\tdiv = 3;\n\t\tbreak;\n\tcase 4096:  \n\t\tdiv = 4;\n\t\tbreak;\n\tcase 6144:  \n\t\tdiv = 5;\n\t\tbreak;\n\tcase 5632:  \n\t\tdiv = 6;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tadau1373_dai->enable_src = (div != 0);\n\n\tregmap_update_bits(adau1373->regmap, ADAU1373_BCLKDIV(dai->id),\n\t\tADAU1373_BCLKDIV_SR_MASK | ADAU1373_BCLKDIV_BCLK_MASK,\n\t\t(div << 2) | ADAU1373_BCLKDIV_64);\n\n\tswitch (params_width(params)) {\n\tcase 16:\n\t\tctrl = ADAU1373_DAI_WLEN_16;\n\t\tbreak;\n\tcase 20:\n\t\tctrl = ADAU1373_DAI_WLEN_20;\n\t\tbreak;\n\tcase 24:\n\t\tctrl = ADAU1373_DAI_WLEN_24;\n\t\tbreak;\n\tcase 32:\n\t\tctrl = ADAU1373_DAI_WLEN_32;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\treturn regmap_update_bits(adau1373->regmap, ADAU1373_DAI(dai->id),\n\t\t\tADAU1373_DAI_WLEN_MASK, ctrl);\n}\n\nstatic int adau1373_set_dai_fmt(struct snd_soc_dai *dai, unsigned int fmt)\n{\n\tstruct snd_soc_component *component = dai->component;\n\tstruct adau1373 *adau1373 = snd_soc_component_get_drvdata(component);\n\tstruct adau1373_dai *adau1373_dai = &adau1373->dais[dai->id];\n\tunsigned int ctrl;\n\n\tswitch (fmt & SND_SOC_DAIFMT_CLOCK_PROVIDER_MASK) {\n\tcase SND_SOC_DAIFMT_CBP_CFP:\n\t\tctrl = ADAU1373_DAI_MASTER;\n\t\tadau1373_dai->clock_provider = true;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_CBC_CFC:\n\t\tctrl = 0;\n\t\tadau1373_dai->clock_provider = false;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tswitch (fmt & SND_SOC_DAIFMT_FORMAT_MASK) {\n\tcase SND_SOC_DAIFMT_I2S:\n\t\tctrl |= ADAU1373_DAI_FORMAT_I2S;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_LEFT_J:\n\t\tctrl |= ADAU1373_DAI_FORMAT_LEFT_J;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_RIGHT_J:\n\t\tctrl |= ADAU1373_DAI_FORMAT_RIGHT_J;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_DSP_B:\n\t\tctrl |= ADAU1373_DAI_FORMAT_DSP;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tswitch (fmt & SND_SOC_DAIFMT_INV_MASK) {\n\tcase SND_SOC_DAIFMT_NB_NF:\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_IB_NF:\n\t\tctrl |= ADAU1373_DAI_INVERT_BCLK;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_NB_IF:\n\t\tctrl |= ADAU1373_DAI_INVERT_LRCLK;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_IB_IF:\n\t\tctrl |= ADAU1373_DAI_INVERT_LRCLK | ADAU1373_DAI_INVERT_BCLK;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tregmap_update_bits(adau1373->regmap, ADAU1373_DAI(dai->id),\n\t\t~ADAU1373_DAI_WLEN_MASK, ctrl);\n\n\treturn 0;\n}\n\nstatic int adau1373_set_dai_sysclk(struct snd_soc_dai *dai,\n\tint clk_id, unsigned int freq, int dir)\n{\n\tstruct adau1373 *adau1373 = snd_soc_component_get_drvdata(dai->component);\n\tstruct adau1373_dai *adau1373_dai = &adau1373->dais[dai->id];\n\n\tswitch (clk_id) {\n\tcase ADAU1373_CLK_SRC_PLL1:\n\tcase ADAU1373_CLK_SRC_PLL2:\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tadau1373_dai->sysclk = freq;\n\tadau1373_dai->clk_src = clk_id;\n\n\tregmap_update_bits(adau1373->regmap, ADAU1373_BCLKDIV(dai->id),\n\t\tADAU1373_BCLKDIV_SOURCE, clk_id << 5);\n\n\treturn 0;\n}\n\nstatic const struct snd_soc_dai_ops adau1373_dai_ops = {\n\t.hw_params\t= adau1373_hw_params,\n\t.set_sysclk\t= adau1373_set_dai_sysclk,\n\t.set_fmt\t= adau1373_set_dai_fmt,\n};\n\n#define ADAU1373_FORMATS (SNDRV_PCM_FMTBIT_S16_LE | SNDRV_PCM_FMTBIT_S20_3LE | \\\n\tSNDRV_PCM_FMTBIT_S24_LE | SNDRV_PCM_FMTBIT_S32_LE)\n\nstatic struct snd_soc_dai_driver adau1373_dai_driver[] = {\n\t{\n\t\t.id = 0,\n\t\t.name = \"adau1373-aif1\",\n\t\t.playback = {\n\t\t\t.stream_name = \"AIF1 Playback\",\n\t\t\t.channels_min = 2,\n\t\t\t.channels_max = 2,\n\t\t\t.rates = SNDRV_PCM_RATE_8000_48000,\n\t\t\t.formats = ADAU1373_FORMATS,\n\t\t},\n\t\t.capture = {\n\t\t\t.stream_name = \"AIF1 Capture\",\n\t\t\t.channels_min = 2,\n\t\t\t.channels_max = 2,\n\t\t\t.rates = SNDRV_PCM_RATE_8000_48000,\n\t\t\t.formats = ADAU1373_FORMATS,\n\t\t},\n\t\t.ops = &adau1373_dai_ops,\n\t\t.symmetric_rate = 1,\n\t},\n\t{\n\t\t.id = 1,\n\t\t.name = \"adau1373-aif2\",\n\t\t.playback = {\n\t\t\t.stream_name = \"AIF2 Playback\",\n\t\t\t.channels_min = 2,\n\t\t\t.channels_max = 2,\n\t\t\t.rates = SNDRV_PCM_RATE_8000_48000,\n\t\t\t.formats = ADAU1373_FORMATS,\n\t\t},\n\t\t.capture = {\n\t\t\t.stream_name = \"AIF2 Capture\",\n\t\t\t.channels_min = 2,\n\t\t\t.channels_max = 2,\n\t\t\t.rates = SNDRV_PCM_RATE_8000_48000,\n\t\t\t.formats = ADAU1373_FORMATS,\n\t\t},\n\t\t.ops = &adau1373_dai_ops,\n\t\t.symmetric_rate = 1,\n\t},\n\t{\n\t\t.id = 2,\n\t\t.name = \"adau1373-aif3\",\n\t\t.playback = {\n\t\t\t.stream_name = \"AIF3 Playback\",\n\t\t\t.channels_min = 2,\n\t\t\t.channels_max = 2,\n\t\t\t.rates = SNDRV_PCM_RATE_8000_48000,\n\t\t\t.formats = ADAU1373_FORMATS,\n\t\t},\n\t\t.capture = {\n\t\t\t.stream_name = \"AIF3 Capture\",\n\t\t\t.channels_min = 2,\n\t\t\t.channels_max = 2,\n\t\t\t.rates = SNDRV_PCM_RATE_8000_48000,\n\t\t\t.formats = ADAU1373_FORMATS,\n\t\t},\n\t\t.ops = &adau1373_dai_ops,\n\t\t.symmetric_rate = 1,\n\t},\n};\n\nstatic int adau1373_set_pll(struct snd_soc_component *component, int pll_id,\n\tint source, unsigned int freq_in, unsigned int freq_out)\n{\n\tstruct adau1373 *adau1373 = snd_soc_component_get_drvdata(component);\n\tunsigned int dpll_div = 0;\n\tuint8_t pll_regs[5];\n\tint ret;\n\n\tswitch (pll_id) {\n\tcase ADAU1373_PLL1:\n\tcase ADAU1373_PLL2:\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tswitch (source) {\n\tcase ADAU1373_PLL_SRC_BCLK1:\n\tcase ADAU1373_PLL_SRC_BCLK2:\n\tcase ADAU1373_PLL_SRC_BCLK3:\n\tcase ADAU1373_PLL_SRC_LRCLK1:\n\tcase ADAU1373_PLL_SRC_LRCLK2:\n\tcase ADAU1373_PLL_SRC_LRCLK3:\n\tcase ADAU1373_PLL_SRC_MCLK1:\n\tcase ADAU1373_PLL_SRC_MCLK2:\n\tcase ADAU1373_PLL_SRC_GPIO1:\n\tcase ADAU1373_PLL_SRC_GPIO2:\n\tcase ADAU1373_PLL_SRC_GPIO3:\n\tcase ADAU1373_PLL_SRC_GPIO4:\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tif (freq_in < 7813 || freq_in > 27000000)\n\t\treturn -EINVAL;\n\n\tif (freq_out < 45158000 || freq_out > 49152000)\n\t\treturn -EINVAL;\n\n\t \n\twhile (freq_in < 8000000) {\n\t\tfreq_in *= 2;\n\t\tdpll_div++;\n\t}\n\n\tret = adau_calc_pll_cfg(freq_in, freq_out, pll_regs);\n\tif (ret)\n\t\treturn -EINVAL;\n\n\tif (dpll_div) {\n\t\tdpll_div = 11 - dpll_div;\n\t\tregmap_update_bits(adau1373->regmap, ADAU1373_PLL_CTRL6(pll_id),\n\t\t\tADAU1373_PLL_CTRL6_DPLL_BYPASS, 0);\n\t} else {\n\t\tregmap_update_bits(adau1373->regmap, ADAU1373_PLL_CTRL6(pll_id),\n\t\t\tADAU1373_PLL_CTRL6_DPLL_BYPASS,\n\t\t\tADAU1373_PLL_CTRL6_DPLL_BYPASS);\n\t}\n\n\tregmap_write(adau1373->regmap, ADAU1373_DPLL_CTRL(pll_id),\n\t\t(source << 4) | dpll_div);\n\tregmap_write(adau1373->regmap, ADAU1373_PLL_CTRL1(pll_id), pll_regs[0]);\n\tregmap_write(adau1373->regmap, ADAU1373_PLL_CTRL2(pll_id), pll_regs[1]);\n\tregmap_write(adau1373->regmap, ADAU1373_PLL_CTRL3(pll_id), pll_regs[2]);\n\tregmap_write(adau1373->regmap, ADAU1373_PLL_CTRL4(pll_id), pll_regs[3]);\n\tregmap_write(adau1373->regmap, ADAU1373_PLL_CTRL5(pll_id), pll_regs[4]);\n\n\t \n\tregmap_update_bits(adau1373->regmap, ADAU1373_CLK_SRC_DIV(pll_id), 0x3f, 0x09);\n\n\treturn 0;\n}\n\nstatic void adau1373_load_drc_settings(struct adau1373 *adau1373,\n\tunsigned int nr, uint8_t *drc)\n{\n\tunsigned int i;\n\n\tfor (i = 0; i < ADAU1373_DRC_SIZE; ++i)\n\t\tregmap_write(adau1373->regmap, ADAU1373_DRC(nr) + i, drc[i]);\n}\n\nstatic bool adau1373_valid_micbias(enum adau1373_micbias_voltage micbias)\n{\n\tswitch (micbias) {\n\tcase ADAU1373_MICBIAS_2_9V:\n\tcase ADAU1373_MICBIAS_2_2V:\n\tcase ADAU1373_MICBIAS_2_6V:\n\tcase ADAU1373_MICBIAS_1_8V:\n\t\treturn true;\n\tdefault:\n\t\tbreak;\n\t}\n\treturn false;\n}\n\nstatic int adau1373_probe(struct snd_soc_component *component)\n{\n\tstruct adau1373 *adau1373 = snd_soc_component_get_drvdata(component);\n\tstruct adau1373_platform_data *pdata = component->dev->platform_data;\n\tbool lineout_differential = false;\n\tunsigned int val;\n\tint i;\n\n\tif (pdata) {\n\t\tif (pdata->num_drc > ARRAY_SIZE(pdata->drc_setting))\n\t\t\treturn -EINVAL;\n\n\t\tif (!adau1373_valid_micbias(pdata->micbias1) ||\n\t\t\t!adau1373_valid_micbias(pdata->micbias2))\n\t\t\treturn -EINVAL;\n\n\t\tfor (i = 0; i < pdata->num_drc; ++i) {\n\t\t\tadau1373_load_drc_settings(adau1373, i,\n\t\t\t\tpdata->drc_setting[i]);\n\t\t}\n\n\t\tsnd_soc_add_component_controls(component, adau1373_drc_controls,\n\t\t\tpdata->num_drc);\n\n\t\tval = 0;\n\t\tfor (i = 0; i < 4; ++i) {\n\t\t\tif (pdata->input_differential[i])\n\t\t\t\tval |= BIT(i);\n\t\t}\n\t\tregmap_write(adau1373->regmap, ADAU1373_INPUT_MODE, val);\n\n\t\tval = 0;\n\t\tif (pdata->lineout_differential)\n\t\t\tval |= ADAU1373_OUTPUT_CTRL_LDIFF;\n\t\tif (pdata->lineout_ground_sense)\n\t\t\tval |= ADAU1373_OUTPUT_CTRL_LNFBEN;\n\t\tregmap_write(adau1373->regmap, ADAU1373_OUTPUT_CTRL, val);\n\n\t\tlineout_differential = pdata->lineout_differential;\n\n\t\tregmap_write(adau1373->regmap, ADAU1373_EP_CTRL,\n\t\t\t(pdata->micbias1 << ADAU1373_EP_CTRL_MICBIAS1_OFFSET) |\n\t\t\t(pdata->micbias2 << ADAU1373_EP_CTRL_MICBIAS2_OFFSET));\n\t}\n\n\tif (!lineout_differential) {\n\t\tsnd_soc_add_component_controls(component, adau1373_lineout2_controls,\n\t\t\tARRAY_SIZE(adau1373_lineout2_controls));\n\t}\n\n\tregmap_write(adau1373->regmap, ADAU1373_ADC_CTRL,\n\t    ADAU1373_ADC_CTRL_RESET_FORCE | ADAU1373_ADC_CTRL_PEAK_DETECT);\n\n\treturn 0;\n}\n\nstatic int adau1373_set_bias_level(struct snd_soc_component *component,\n\tenum snd_soc_bias_level level)\n{\n\tstruct adau1373 *adau1373 = snd_soc_component_get_drvdata(component);\n\n\tswitch (level) {\n\tcase SND_SOC_BIAS_ON:\n\t\tbreak;\n\tcase SND_SOC_BIAS_PREPARE:\n\t\tbreak;\n\tcase SND_SOC_BIAS_STANDBY:\n\t\tregmap_update_bits(adau1373->regmap, ADAU1373_PWDN_CTRL3,\n\t\t\tADAU1373_PWDN_CTRL3_PWR_EN, ADAU1373_PWDN_CTRL3_PWR_EN);\n\t\tbreak;\n\tcase SND_SOC_BIAS_OFF:\n\t\tregmap_update_bits(adau1373->regmap, ADAU1373_PWDN_CTRL3,\n\t\t\tADAU1373_PWDN_CTRL3_PWR_EN, 0);\n\t\tbreak;\n\t}\n\treturn 0;\n}\n\nstatic int adau1373_resume(struct snd_soc_component *component)\n{\n\tstruct adau1373 *adau1373 = snd_soc_component_get_drvdata(component);\n\n\tregcache_sync(adau1373->regmap);\n\n\treturn 0;\n}\n\nstatic bool adau1373_register_volatile(struct device *dev, unsigned int reg)\n{\n\tswitch (reg) {\n\tcase ADAU1373_SOFT_RESET:\n\tcase ADAU1373_ADC_DAC_STATUS:\n\t\treturn true;\n\tdefault:\n\t\treturn false;\n\t}\n}\n\nstatic const struct regmap_config adau1373_regmap_config = {\n\t.val_bits = 8,\n\t.reg_bits = 8,\n\n\t.volatile_reg = adau1373_register_volatile,\n\t.max_register = ADAU1373_SOFT_RESET,\n\n\t.cache_type = REGCACHE_MAPLE,\n\t.reg_defaults = adau1373_reg_defaults,\n\t.num_reg_defaults = ARRAY_SIZE(adau1373_reg_defaults),\n};\n\nstatic const struct snd_soc_component_driver adau1373_component_driver = {\n\t.probe\t\t\t= adau1373_probe,\n\t.resume\t\t\t= adau1373_resume,\n\t.set_bias_level\t\t= adau1373_set_bias_level,\n\t.set_pll\t\t= adau1373_set_pll,\n\t.controls\t\t= adau1373_controls,\n\t.num_controls\t\t= ARRAY_SIZE(adau1373_controls),\n\t.dapm_widgets\t\t= adau1373_dapm_widgets,\n\t.num_dapm_widgets\t= ARRAY_SIZE(adau1373_dapm_widgets),\n\t.dapm_routes\t\t= adau1373_dapm_routes,\n\t.num_dapm_routes\t= ARRAY_SIZE(adau1373_dapm_routes),\n\t.use_pmdown_time\t= 1,\n\t.endianness\t\t= 1,\n};\n\nstatic int adau1373_i2c_probe(struct i2c_client *client)\n{\n\tstruct adau1373 *adau1373;\n\tint ret;\n\n\tadau1373 = devm_kzalloc(&client->dev, sizeof(*adau1373), GFP_KERNEL);\n\tif (!adau1373)\n\t\treturn -ENOMEM;\n\n\tadau1373->regmap = devm_regmap_init_i2c(client,\n\t\t&adau1373_regmap_config);\n\tif (IS_ERR(adau1373->regmap))\n\t\treturn PTR_ERR(adau1373->regmap);\n\n\tregmap_write(adau1373->regmap, ADAU1373_SOFT_RESET, 0x00);\n\n\tdev_set_drvdata(&client->dev, adau1373);\n\n\tret = devm_snd_soc_register_component(&client->dev,\n\t\t\t&adau1373_component_driver,\n\t\t\tadau1373_dai_driver, ARRAY_SIZE(adau1373_dai_driver));\n\treturn ret;\n}\n\nstatic const struct i2c_device_id adau1373_i2c_id[] = {\n\t{ \"adau1373\", 0 },\n\t{ }\n};\nMODULE_DEVICE_TABLE(i2c, adau1373_i2c_id);\n\nstatic struct i2c_driver adau1373_i2c_driver = {\n\t.driver = {\n\t\t.name = \"adau1373\",\n\t},\n\t.probe = adau1373_i2c_probe,\n\t.id_table = adau1373_i2c_id,\n};\n\nmodule_i2c_driver(adau1373_i2c_driver);\n\nMODULE_DESCRIPTION(\"ASoC ADAU1373 driver\");\nMODULE_AUTHOR(\"Lars-Peter Clausen <lars@metafoo.de>\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}