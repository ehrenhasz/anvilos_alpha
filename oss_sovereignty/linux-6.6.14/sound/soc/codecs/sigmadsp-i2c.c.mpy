{
  "module_name": "sigmadsp-i2c.c",
  "hash_id": "de6b4d5b6b816dc4ff9932130f0f34115c87d970257bb731e002d97e95d972ec",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/codecs/sigmadsp-i2c.c",
  "human_readable_source": "\n \n\n#include <linux/export.h>\n#include <linux/i2c.h>\n#include <linux/module.h>\n#include <linux/slab.h>\n#include <asm/unaligned.h>\n\n#include \"sigmadsp.h\"\n\nstatic int sigmadsp_write_i2c(void *control_data,\n\tunsigned int addr, const uint8_t data[], size_t len)\n{\n\tuint8_t *buf;\n\tint ret;\n\n\tbuf = kzalloc(2 + len, GFP_KERNEL | GFP_DMA);\n\tif (!buf)\n\t\treturn -ENOMEM;\n\n\tput_unaligned_be16(addr, buf);\n\tmemcpy(buf + 2, data, len);\n\n\tret = i2c_master_send(control_data, buf, len + 2);\n\n\tkfree(buf);\n\n\tif (ret < 0)\n\t\treturn ret;\n\n\treturn 0;\n}\n\nstatic int sigmadsp_read_i2c(void *control_data,\n\tunsigned int addr, uint8_t data[], size_t len)\n{\n\tstruct i2c_client *client = control_data;\n\tstruct i2c_msg msgs[2];\n\tuint8_t buf[2];\n\tint ret;\n\n\tput_unaligned_be16(addr, buf);\n\n\tmsgs[0].addr = client->addr;\n\tmsgs[0].len = sizeof(buf);\n\tmsgs[0].buf = buf;\n\tmsgs[0].flags = 0;\n\n\tmsgs[1].addr = client->addr;\n\tmsgs[1].len = len;\n\tmsgs[1].buf = data;\n\tmsgs[1].flags = I2C_M_RD;\n\n\tret = i2c_transfer(client->adapter, msgs, ARRAY_SIZE(msgs));\n\tif (ret < 0)\n\t\treturn ret;\n\telse if (ret != ARRAY_SIZE(msgs))\n\t\treturn -EIO;\n\treturn 0;\n}\n\n \nstruct sigmadsp *devm_sigmadsp_init_i2c(struct i2c_client *client,\n\tconst struct sigmadsp_ops *ops,\tconst char *firmware_name)\n{\n\tstruct sigmadsp *sigmadsp;\n\n\tsigmadsp = devm_sigmadsp_init(&client->dev, ops, firmware_name);\n\tif (IS_ERR(sigmadsp))\n\t\treturn sigmadsp;\n\n\tsigmadsp->control_data = client;\n\tsigmadsp->write = sigmadsp_write_i2c;\n\tsigmadsp->read = sigmadsp_read_i2c;\n\n\treturn sigmadsp;\n}\nEXPORT_SYMBOL_GPL(devm_sigmadsp_init_i2c);\n\nMODULE_AUTHOR(\"Lars-Peter Clausen <lars@metafoo.de>\");\nMODULE_DESCRIPTION(\"SigmaDSP I2C firmware loader\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}