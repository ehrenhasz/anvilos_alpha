{
  "module_name": "max9768.c",
  "hash_id": "c362b0ad32510d77eecd3c474db8fe0f8a82becfb1ef5ea24c7580ab3f146585",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/codecs/max9768.c",
  "human_readable_source": "\n \n\n#include <linux/init.h>\n#include <linux/module.h>\n#include <linux/i2c.h>\n#include <linux/slab.h>\n#include <linux/gpio.h>\n#include <linux/regmap.h>\n\n#include <sound/core.h>\n#include <sound/soc.h>\n#include <sound/tlv.h>\n#include <sound/max9768.h>\n\n \n#define MAX9768_VOL 0\n#define MAX9768_CTRL 3\n\n \n#define MAX9768_CTRL_PWM 0x15\n#define MAX9768_CTRL_FILTERLESS 0x16\n\nstruct max9768 {\n\tstruct regmap *regmap;\n\tint mute_gpio;\n\tint shdn_gpio;\n\tu32 flags;\n};\n\nstatic const struct reg_default max9768_default_regs[] = {\n\t{ 0, 0 },\n\t{ 3,  MAX9768_CTRL_FILTERLESS},\n};\n\nstatic int max9768_get_gpio(struct snd_kcontrol *kcontrol,\n\tstruct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_soc_component *c = snd_soc_kcontrol_component(kcontrol);\n\tstruct max9768 *max9768 = snd_soc_component_get_drvdata(c);\n\tint val = gpio_get_value_cansleep(max9768->mute_gpio);\n\n\tucontrol->value.integer.value[0] = !val;\n\n\treturn 0;\n}\n\nstatic int max9768_set_gpio(struct snd_kcontrol *kcontrol,\n\tstruct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_soc_component *c = snd_soc_kcontrol_component(kcontrol);\n\tstruct max9768 *max9768 = snd_soc_component_get_drvdata(c);\n\n\tgpio_set_value_cansleep(max9768->mute_gpio, !ucontrol->value.integer.value[0]);\n\n\treturn 0;\n}\n\nstatic const DECLARE_TLV_DB_RANGE(volume_tlv,\n\t0, 0, TLV_DB_SCALE_ITEM(-16150, 0, 0),\n\t1, 1, TLV_DB_SCALE_ITEM(-9280, 0, 0),\n\t2, 2, TLV_DB_SCALE_ITEM(-9030, 0, 0),\n\t3, 3, TLV_DB_SCALE_ITEM(-8680, 0, 0),\n\t4, 4, TLV_DB_SCALE_ITEM(-8430, 0, 0),\n\t5, 5, TLV_DB_SCALE_ITEM(-8080, 0, 0),\n\t6, 6, TLV_DB_SCALE_ITEM(-7830, 0, 0),\n\t7, 7, TLV_DB_SCALE_ITEM(-7470, 0, 0),\n\t8, 8, TLV_DB_SCALE_ITEM(-7220, 0, 0),\n\t9, 9, TLV_DB_SCALE_ITEM(-6870, 0, 0),\n\t10, 10, TLV_DB_SCALE_ITEM(-6620, 0, 0),\n\t11, 11, TLV_DB_SCALE_ITEM(-6270, 0, 0),\n\t12, 12, TLV_DB_SCALE_ITEM(-6020, 0, 0),\n\t13, 13, TLV_DB_SCALE_ITEM(-5670, 0, 0),\n\t14, 14, TLV_DB_SCALE_ITEM(-5420, 0, 0),\n\t15, 17, TLV_DB_SCALE_ITEM(-5060, 250, 0),\n\t18, 18, TLV_DB_SCALE_ITEM(-4370, 0, 0),\n\t19, 19, TLV_DB_SCALE_ITEM(-4210, 0, 0),\n\t20, 20, TLV_DB_SCALE_ITEM(-3960, 0, 0),\n\t21, 21, TLV_DB_SCALE_ITEM(-3760, 0, 0),\n\t22, 22, TLV_DB_SCALE_ITEM(-3600, 0, 0),\n\t23, 23, TLV_DB_SCALE_ITEM(-3340, 0, 0),\n\t24, 24, TLV_DB_SCALE_ITEM(-3150, 0, 0),\n\t25, 25, TLV_DB_SCALE_ITEM(-2980, 0, 0),\n\t26, 26, TLV_DB_SCALE_ITEM(-2720, 0, 0),\n\t27, 27, TLV_DB_SCALE_ITEM(-2520, 0, 0),\n\t28, 30, TLV_DB_SCALE_ITEM(-2350, 190, 0),\n\t31, 31, TLV_DB_SCALE_ITEM(-1750, 0, 0),\n\t32, 34, TLV_DB_SCALE_ITEM(-1640, 100, 0),\n\t35, 37, TLV_DB_SCALE_ITEM(-1310, 110, 0),\n\t38, 39, TLV_DB_SCALE_ITEM(-990, 100, 0),\n\t40, 40, TLV_DB_SCALE_ITEM(-710, 0, 0),\n\t41, 41, TLV_DB_SCALE_ITEM(-600, 0, 0),\n\t42, 42, TLV_DB_SCALE_ITEM(-500, 0, 0),\n\t43, 43, TLV_DB_SCALE_ITEM(-340, 0, 0),\n\t44, 44, TLV_DB_SCALE_ITEM(-190, 0, 0),\n\t45, 45, TLV_DB_SCALE_ITEM(-50, 0, 0),\n\t46, 46, TLV_DB_SCALE_ITEM(50, 0, 0),\n\t47, 50, TLV_DB_SCALE_ITEM(120, 40, 0),\n\t51, 57, TLV_DB_SCALE_ITEM(290, 50, 0),\n\t58, 58, TLV_DB_SCALE_ITEM(650, 0, 0),\n\t59, 62, TLV_DB_SCALE_ITEM(700, 60, 0),\n\t63, 63, TLV_DB_SCALE_ITEM(950, 0, 0)\n);\n\nstatic const struct snd_kcontrol_new max9768_volume[] = {\n\tSOC_SINGLE_TLV(\"Playback Volume\", MAX9768_VOL, 0, 63, 0, volume_tlv),\n};\n\nstatic const struct snd_kcontrol_new max9768_mute[] = {\n\tSOC_SINGLE_BOOL_EXT(\"Playback Switch\", 0, max9768_get_gpio, max9768_set_gpio),\n};\n\nstatic const struct snd_soc_dapm_widget max9768_dapm_widgets[] = {\nSND_SOC_DAPM_INPUT(\"IN\"),\n\nSND_SOC_DAPM_OUTPUT(\"OUT+\"),\nSND_SOC_DAPM_OUTPUT(\"OUT-\"),\n};\n\nstatic const struct snd_soc_dapm_route max9768_dapm_routes[] = {\n\t{ \"OUT+\", NULL, \"IN\" },\n\t{ \"OUT-\", NULL, \"IN\" },\n};\n\nstatic int max9768_probe(struct snd_soc_component *component)\n{\n\tstruct max9768 *max9768 = snd_soc_component_get_drvdata(component);\n\tint ret;\n\n\tif (max9768->flags & MAX9768_FLAG_CLASSIC_PWM) {\n\t\tret = regmap_write(max9768->regmap, MAX9768_CTRL,\n\t\t\tMAX9768_CTRL_PWM);\n\t\tif (ret)\n\t\t\treturn ret;\n\t}\n\n\tif (gpio_is_valid(max9768->mute_gpio)) {\n\t\tret = snd_soc_add_component_controls(component, max9768_mute,\n\t\t\t\tARRAY_SIZE(max9768_mute));\n\t\tif (ret)\n\t\t\treturn ret;\n\t}\n\n\treturn 0;\n}\n\nstatic const struct snd_soc_component_driver max9768_component_driver = {\n\t.probe = max9768_probe,\n\t.controls = max9768_volume,\n\t.num_controls = ARRAY_SIZE(max9768_volume),\n\t.dapm_widgets = max9768_dapm_widgets,\n\t.num_dapm_widgets = ARRAY_SIZE(max9768_dapm_widgets),\n\t.dapm_routes = max9768_dapm_routes,\n\t.num_dapm_routes = ARRAY_SIZE(max9768_dapm_routes),\n};\n\nstatic const struct regmap_config max9768_i2c_regmap_config = {\n\t.reg_bits = 2,\n\t.val_bits = 6,\n\t.max_register = 3,\n\t.reg_defaults = max9768_default_regs,\n\t.num_reg_defaults = ARRAY_SIZE(max9768_default_regs),\n\t.cache_type = REGCACHE_RBTREE,\n};\n\nstatic int max9768_i2c_probe(struct i2c_client *client)\n{\n\tstruct max9768 *max9768;\n\tstruct max9768_pdata *pdata = client->dev.platform_data;\n\tint err;\n\n\tmax9768 = devm_kzalloc(&client->dev, sizeof(*max9768), GFP_KERNEL);\n\tif (!max9768)\n\t\treturn -ENOMEM;\n\n\tif (pdata) {\n\t\t \n\t\terr = devm_gpio_request_one(&client->dev, pdata->mute_gpio,\n\t\t\t\tGPIOF_INIT_HIGH, \"MAX9768 Mute\");\n\t\tmax9768->mute_gpio = err ?: pdata->mute_gpio;\n\n\t\t \n\t\terr = devm_gpio_request_one(&client->dev, pdata->shdn_gpio,\n\t\t\t\tGPIOF_INIT_HIGH, \"MAX9768 Shutdown\");\n\t\tmax9768->shdn_gpio = err ?: pdata->shdn_gpio;\n\n\t\tmax9768->flags = pdata->flags;\n\t} else {\n\t\tmax9768->shdn_gpio = -EINVAL;\n\t\tmax9768->mute_gpio = -EINVAL;\n\t}\n\n\ti2c_set_clientdata(client, max9768);\n\n\tmax9768->regmap = devm_regmap_init_i2c(client, &max9768_i2c_regmap_config);\n\tif (IS_ERR(max9768->regmap))\n\t\treturn PTR_ERR(max9768->regmap);\n\n\treturn devm_snd_soc_register_component(&client->dev,\n\t\t&max9768_component_driver, NULL, 0);\n}\n\nstatic const struct i2c_device_id max9768_i2c_id[] = {\n\t{ \"max9768\", 0 },\n\t{ }\n};\nMODULE_DEVICE_TABLE(i2c, max9768_i2c_id);\n\nstatic struct i2c_driver max9768_i2c_driver = {\n\t.driver = {\n\t\t.name = \"max9768\",\n\t},\n\t.probe = max9768_i2c_probe,\n\t.id_table = max9768_i2c_id,\n};\nmodule_i2c_driver(max9768_i2c_driver);\n\nMODULE_AUTHOR(\"Wolfram Sang <kernel@pengutronix.de>\");\nMODULE_DESCRIPTION(\"ASoC MAX9768 amplifier driver\");\nMODULE_LICENSE(\"GPL v2\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}