{
  "module_name": "da9055.c",
  "hash_id": "1085410e4cc5e60a3d78167898457c1d83ff855677f1c57996f90a002acceb71",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/codecs/da9055.c",
  "human_readable_source": "\n \n\n#include <linux/delay.h>\n#include <linux/i2c.h>\n#include <linux/regmap.h>\n#include <linux/slab.h>\n#include <linux/module.h>\n#include <linux/of.h>\n#include <linux/of_device.h>\n#include <sound/pcm.h>\n#include <sound/pcm_params.h>\n#include <sound/soc.h>\n#include <sound/initval.h>\n#include <sound/tlv.h>\n#include <sound/da9055.h>\n\n \n\n \n#define DA9055_STATUS1\t\t\t0x02\n#define DA9055_PLL_STATUS\t\t0x03\n#define DA9055_AUX_L_GAIN_STATUS\t0x04\n#define DA9055_AUX_R_GAIN_STATUS\t0x05\n#define DA9055_MIC_L_GAIN_STATUS\t0x06\n#define DA9055_MIC_R_GAIN_STATUS\t0x07\n#define DA9055_MIXIN_L_GAIN_STATUS\t0x08\n#define DA9055_MIXIN_R_GAIN_STATUS\t0x09\n#define DA9055_ADC_L_GAIN_STATUS\t0x0A\n#define DA9055_ADC_R_GAIN_STATUS\t0x0B\n#define DA9055_DAC_L_GAIN_STATUS\t0x0C\n#define DA9055_DAC_R_GAIN_STATUS\t0x0D\n#define DA9055_HP_L_GAIN_STATUS\t\t0x0E\n#define DA9055_HP_R_GAIN_STATUS\t\t0x0F\n#define DA9055_LINE_GAIN_STATUS\t\t0x10\n\n \n#define DA9055_CIF_CTRL\t\t\t0x20\n#define DA9055_DIG_ROUTING_AIF\t\t0X21\n#define DA9055_SR\t\t\t0x22\n#define DA9055_REFERENCES\t\t0x23\n#define DA9055_PLL_FRAC_TOP\t\t0x24\n#define DA9055_PLL_FRAC_BOT\t\t0x25\n#define DA9055_PLL_INTEGER\t\t0x26\n#define DA9055_PLL_CTRL\t\t\t0x27\n#define DA9055_AIF_CLK_MODE\t\t0x28\n#define DA9055_AIF_CTRL\t\t\t0x29\n#define DA9055_DIG_ROUTING_DAC\t\t0x2A\n#define DA9055_ALC_CTRL1\t\t0x2B\n\n \n#define DA9055_AUX_L_GAIN\t\t0x30\n#define DA9055_AUX_R_GAIN\t\t0x31\n#define DA9055_MIXIN_L_SELECT\t\t0x32\n#define DA9055_MIXIN_R_SELECT\t\t0x33\n#define DA9055_MIXIN_L_GAIN\t\t0x34\n#define DA9055_MIXIN_R_GAIN\t\t0x35\n#define DA9055_ADC_L_GAIN\t\t0x36\n#define DA9055_ADC_R_GAIN\t\t0x37\n#define DA9055_ADC_FILTERS1\t\t0x38\n#define DA9055_MIC_L_GAIN\t\t0x39\n#define DA9055_MIC_R_GAIN\t\t0x3A\n\n \n#define DA9055_DAC_FILTERS5\t\t0x40\n#define DA9055_DAC_FILTERS2\t\t0x41\n#define DA9055_DAC_FILTERS3\t\t0x42\n#define DA9055_DAC_FILTERS4\t\t0x43\n#define DA9055_DAC_FILTERS1\t\t0x44\n#define DA9055_DAC_L_GAIN\t\t0x45\n#define DA9055_DAC_R_GAIN\t\t0x46\n#define DA9055_CP_CTRL\t\t\t0x47\n#define DA9055_HP_L_GAIN\t\t0x48\n#define DA9055_HP_R_GAIN\t\t0x49\n#define DA9055_LINE_GAIN\t\t0x4A\n#define DA9055_MIXOUT_L_SELECT\t\t0x4B\n#define DA9055_MIXOUT_R_SELECT\t\t0x4C\n\n \n#define DA9055_SYSTEM_MODES_INPUT\t0x50\n#define DA9055_SYSTEM_MODES_OUTPUT\t0x51\n\n \n#define DA9055_AUX_L_CTRL\t\t0x60\n#define DA9055_AUX_R_CTRL\t\t0x61\n#define DA9055_MIC_BIAS_CTRL\t\t0x62\n#define DA9055_MIC_L_CTRL\t\t0x63\n#define DA9055_MIC_R_CTRL\t\t0x64\n#define DA9055_MIXIN_L_CTRL\t\t0x65\n#define DA9055_MIXIN_R_CTRL\t\t0x66\n#define DA9055_ADC_L_CTRL\t\t0x67\n#define DA9055_ADC_R_CTRL\t\t0x68\n#define DA9055_DAC_L_CTRL\t\t0x69\n#define DA9055_DAC_R_CTRL\t\t0x6A\n#define DA9055_HP_L_CTRL\t\t0x6B\n#define DA9055_HP_R_CTRL\t\t0x6C\n#define DA9055_LINE_CTRL\t\t0x6D\n#define DA9055_MIXOUT_L_CTRL\t\t0x6E\n#define DA9055_MIXOUT_R_CTRL\t\t0x6F\n\n \n#define DA9055_LDO_CTRL\t\t\t0x90\n#define DA9055_IO_CTRL\t\t\t0x91\n#define DA9055_GAIN_RAMP_CTRL\t\t0x92\n#define DA9055_MIC_CONFIG\t\t0x93\n#define DA9055_PC_COUNT\t\t\t0x94\n#define DA9055_CP_VOL_THRESHOLD1\t0x95\n#define DA9055_CP_DELAY\t\t\t0x96\n#define DA9055_CP_DETECTOR\t\t0x97\n#define DA9055_AIF_OFFSET\t\t0x98\n#define DA9055_DIG_CTRL\t\t\t0x99\n#define DA9055_ALC_CTRL2\t\t0x9A\n#define DA9055_ALC_CTRL3\t\t0x9B\n#define DA9055_ALC_NOISE\t\t0x9C\n#define DA9055_ALC_TARGET_MIN\t\t0x9D\n#define DA9055_ALC_TARGET_MAX\t\t0x9E\n#define DA9055_ALC_GAIN_LIMITS\t\t0x9F\n#define DA9055_ALC_ANA_GAIN_LIMITS\t0xA0\n#define DA9055_ALC_ANTICLIP_CTRL\t0xA1\n#define DA9055_ALC_ANTICLIP_LEVEL\t0xA2\n#define DA9055_ALC_OFFSET_OP2M_L\t0xA6\n#define DA9055_ALC_OFFSET_OP2U_L\t0xA7\n#define DA9055_ALC_OFFSET_OP2M_R\t0xAB\n#define DA9055_ALC_OFFSET_OP2U_R\t0xAC\n#define DA9055_ALC_CIC_OP_LVL_CTRL\t0xAD\n#define DA9055_ALC_CIC_OP_LVL_DATA\t0xAE\n#define DA9055_DAC_NG_SETUP_TIME\t0xAF\n#define DA9055_DAC_NG_OFF_THRESHOLD\t0xB0\n#define DA9055_DAC_NG_ON_THRESHOLD\t0xB1\n#define DA9055_DAC_NG_CTRL\t\t0xB2\n\n \n#define DA9055_SR_8000\t\t\t(0x1 << 0)\n#define DA9055_SR_11025\t\t\t(0x2 << 0)\n#define DA9055_SR_12000\t\t\t(0x3 << 0)\n#define DA9055_SR_16000\t\t\t(0x5 << 0)\n#define DA9055_SR_22050\t\t\t(0x6 << 0)\n#define DA9055_SR_24000\t\t\t(0x7 << 0)\n#define DA9055_SR_32000\t\t\t(0x9 << 0)\n#define DA9055_SR_44100\t\t\t(0xA << 0)\n#define DA9055_SR_48000\t\t\t(0xB << 0)\n#define DA9055_SR_88200\t\t\t(0xE << 0)\n#define DA9055_SR_96000\t\t\t(0xF << 0)\n\n \n#define DA9055_BIAS_EN\t\t\t(1 << 3)\n#define DA9055_VMID_EN\t\t\t(1 << 7)\n\n \n#define DA9055_PLL_INDIV_10_20_MHZ\t(1 << 2)\n#define DA9055_PLL_SRM_EN\t\t(1 << 6)\n#define DA9055_PLL_EN\t\t\t(1 << 7)\n\n \n#define DA9055_AIF_BCLKS_PER_WCLK_32\t(0 << 0)\n#define DA9055_AIF_BCLKS_PER_WCLK_64\t(1 << 0)\n#define DA9055_AIF_BCLKS_PER_WCLK_128\t(2 << 0)\n#define DA9055_AIF_BCLKS_PER_WCLK_256\t(3 << 0)\n#define DA9055_AIF_CLK_EN_SLAVE_MODE\t(0 << 7)\n#define DA9055_AIF_CLK_EN_MASTER_MODE\t(1 << 7)\n\n \n#define DA9055_AIF_FORMAT_I2S_MODE\t(0 << 0)\n#define DA9055_AIF_FORMAT_LEFT_J\t(1 << 0)\n#define DA9055_AIF_FORMAT_RIGHT_J\t(2 << 0)\n#define DA9055_AIF_FORMAT_DSP\t\t(3 << 0)\n#define DA9055_AIF_WORD_S16_LE\t\t(0 << 2)\n#define DA9055_AIF_WORD_S20_3LE\t\t(1 << 2)\n#define DA9055_AIF_WORD_S24_LE\t\t(2 << 2)\n#define DA9055_AIF_WORD_S32_LE\t\t(3 << 2)\n\n \n#define DA9055_MIC_L_MUTE_EN\t\t(1 << 6)\n\n \n#define DA9055_MIC_R_MUTE_EN\t\t(1 << 6)\n\n \n#define DA9055_MIXIN_L_MIX_EN\t\t(1 << 3)\n\n \n#define DA9055_MIXIN_R_MIX_EN\t\t(1 << 3)\n\n \n#define DA9055_ADC_L_EN\t\t\t(1 << 7)\n\n \n#define DA9055_ADC_R_EN\t\t\t(1 << 7)\n\n \n#define DA9055_DAC_L_MUTE_EN\t\t(1 << 6)\n\n \n#define DA9055_DAC_R_MUTE_EN\t\t(1 << 6)\n\n \n#define DA9055_HP_L_AMP_OE\t\t(1 << 3)\n\n \n#define DA9055_HP_R_AMP_OE\t\t(1 << 3)\n\n \n#define DA9055_LINE_AMP_OE\t\t(1 << 3)\n\n \n#define DA9055_MIXOUT_L_MIX_EN\t\t(1 << 3)\n\n \n#define DA9055_MIXOUT_R_MIX_EN\t\t(1 << 3)\n\n \n#define DA9055_MICBIAS2_EN\t\t(1 << 6)\n\n \n#define DA9055_ALC_DATA_MIDDLE\t\t(2 << 0)\n#define DA9055_ALC_DATA_TOP\t\t(3 << 0)\n#define DA9055_ALC_CIC_OP_CHANNEL_LEFT\t(0 << 7)\n#define DA9055_ALC_CIC_OP_CHANNEL_RIGHT\t(1 << 7)\n\n#define DA9055_AIF_BCLK_MASK\t\t(3 << 0)\n#define DA9055_AIF_CLK_MODE_MASK\t(1 << 7)\n#define DA9055_AIF_FORMAT_MASK\t\t(3 << 0)\n#define DA9055_AIF_WORD_LENGTH_MASK\t(3 << 2)\n#define DA9055_GAIN_RAMPING_EN\t\t(1 << 5)\n#define DA9055_MICBIAS_LEVEL_MASK\t(3 << 4)\n\n#define DA9055_ALC_OFFSET_15_8\t\t0x00FF00\n#define DA9055_ALC_OFFSET_17_16\t\t0x030000\n#define DA9055_ALC_AVG_ITERATIONS\t5\n\nstruct pll_div {\n\tint fref;\n\tint fout;\n\tu8 frac_top;\n\tu8 frac_bot;\n\tu8 integer;\n\tu8 mode;\t \n};\n\n \nstatic const struct pll_div da9055_pll_div[] = {\n\t \n\t{11289600, 2822400, 0x00, 0x00, 0x20, 1},\t \n\t{12000000, 2822400, 0x03, 0x61, 0x1E, 1},\t \n\t{12288000, 2822400, 0x0C, 0xCC, 0x1D, 1},\t \n\t{13000000, 2822400, 0x19, 0x45, 0x1B, 1},\t \n\t{13500000, 2822400, 0x18, 0x56, 0x1A, 1},\t \n\t{14400000, 2822400, 0x02, 0xD0, 0x19, 1},\t \n\t{19200000, 2822400, 0x1A, 0x1C, 0x12, 1},\t \n\t{19680000, 2822400, 0x0B, 0x6D, 0x12, 1},\t \n\t{19800000, 2822400, 0x07, 0xDD, 0x12, 1},\t \n\t \n\t{11289600, 3072000, 0x1A, 0x8E, 0x22, 1},\t \n\t{12000000, 3072000, 0x18, 0x93, 0x20, 1},\t \n\t{12288000, 3072000, 0x00, 0x00, 0x20, 1},\t \n\t{13000000, 3072000, 0x07, 0xEA, 0x1E, 1},\t \n\t{13500000, 3072000, 0x04, 0x11, 0x1D, 1},\t \n\t{14400000, 3072000, 0x09, 0xD0, 0x1B, 1},\t \n\t{19200000, 3072000, 0x0F, 0x5C, 0x14, 1},\t \n\t{19680000, 3072000, 0x1F, 0x60, 0x13, 1},\t \n\t{19800000, 3072000, 0x1B, 0x80, 0x13, 1},\t \n\t \n\t{11289600, 2822400, 0x0D, 0x47, 0x21, 0},\t \n\t{12000000, 2822400, 0x0D, 0xFA, 0x1F, 0},\t \n\t{12288000, 2822400, 0x16, 0x66, 0x1E, 0},\t \n\t{13000000, 2822400, 0x00, 0x98, 0x1D, 0},\t \n\t{13500000, 2822400, 0x1E, 0x33, 0x1B, 0},\t \n\t{14400000, 2822400, 0x06, 0x50, 0x1A, 0},\t \n\t{19200000, 2822400, 0x14, 0xBC, 0x13, 0},\t \n\t{19680000, 2822400, 0x05, 0x66, 0x13, 0},\t \n\t{19800000, 2822400, 0x01, 0xAE, 0x13, 0},\t \n};\n\nenum clk_src {\n\tDA9055_CLKSRC_MCLK\n};\n\n \n\nstatic const DECLARE_TLV_DB_RANGE(aux_vol_tlv,\n\t0x0, 0x10, TLV_DB_SCALE_ITEM(-5400, 0, 0),\n\t \n\t0x11, 0x3f, TLV_DB_SCALE_ITEM(-5400, 150, 0)\n);\n\nstatic const DECLARE_TLV_DB_RANGE(digital_gain_tlv,\n\t0x0, 0x07, TLV_DB_SCALE_ITEM(TLV_DB_GAIN_MUTE, 0, 1),\n\t \n\t0x08, 0x7f, TLV_DB_SCALE_ITEM(-7800, 75, 0)\n);\n\nstatic const DECLARE_TLV_DB_RANGE(alc_analog_gain_tlv,\n\t0x0, 0x0, TLV_DB_SCALE_ITEM(TLV_DB_GAIN_MUTE, 0, 1),\n\t \n\t0x01, 0x07, TLV_DB_SCALE_ITEM(0, 600, 0)\n);\n\nstatic const DECLARE_TLV_DB_SCALE(mic_vol_tlv, -600, 600, 0);\nstatic const DECLARE_TLV_DB_SCALE(mixin_gain_tlv, -450, 150, 0);\nstatic const DECLARE_TLV_DB_SCALE(eq_gain_tlv, -1050, 150, 0);\nstatic const DECLARE_TLV_DB_SCALE(hp_vol_tlv, -5700, 100, 0);\nstatic const DECLARE_TLV_DB_SCALE(lineout_vol_tlv, -4800, 100, 0);\nstatic const DECLARE_TLV_DB_SCALE(alc_threshold_tlv, -9450, 150, 0);\nstatic const DECLARE_TLV_DB_SCALE(alc_gain_tlv, 0, 600, 0);\n\n \nstatic const char * const da9055_hpf_cutoff_txt[] = {\n\t\"Fs/24000\", \"Fs/12000\", \"Fs/6000\", \"Fs/3000\"\n};\n\nstatic SOC_ENUM_SINGLE_DECL(da9055_dac_hpf_cutoff,\n\t\t\t    DA9055_DAC_FILTERS1, 4, da9055_hpf_cutoff_txt);\n\nstatic SOC_ENUM_SINGLE_DECL(da9055_adc_hpf_cutoff,\n\t\t\t    DA9055_ADC_FILTERS1, 4, da9055_hpf_cutoff_txt);\n\n \nstatic const char * const da9055_vf_cutoff_txt[] = {\n\t\"2.5Hz\", \"25Hz\", \"50Hz\", \"100Hz\", \"150Hz\", \"200Hz\", \"300Hz\", \"400Hz\"\n};\n\nstatic SOC_ENUM_SINGLE_DECL(da9055_dac_vf_cutoff,\n\t\t\t    DA9055_DAC_FILTERS1, 0, da9055_vf_cutoff_txt);\n\nstatic SOC_ENUM_SINGLE_DECL(da9055_adc_vf_cutoff,\n\t\t\t    DA9055_ADC_FILTERS1, 0, da9055_vf_cutoff_txt);\n\n \nstatic const char * const da9055_gain_ramping_txt[] = {\n\t\"nominal rate\", \"nominal rate * 4\", \"nominal rate * 8\",\n\t\"nominal rate / 8\"\n};\n\nstatic SOC_ENUM_SINGLE_DECL(da9055_gain_ramping_rate,\n\t\t\t    DA9055_GAIN_RAMP_CTRL, 0, da9055_gain_ramping_txt);\n\n \nstatic const char * const da9055_dac_ng_setup_time_txt[] = {\n\t\"256 samples\", \"512 samples\", \"1024 samples\", \"2048 samples\"\n};\n\nstatic SOC_ENUM_SINGLE_DECL(da9055_dac_ng_setup_time,\n\t\t\t    DA9055_DAC_NG_SETUP_TIME, 0,\n\t\t\t    da9055_dac_ng_setup_time_txt);\n\n \nstatic const char * const da9055_dac_ng_rampup_txt[] = {\n\t\"0.02 ms/dB\", \"0.16 ms/dB\"\n};\n\nstatic SOC_ENUM_SINGLE_DECL(da9055_dac_ng_rampup_rate,\n\t\t\t    DA9055_DAC_NG_SETUP_TIME, 2,\n\t\t\t    da9055_dac_ng_rampup_txt);\n\n \nstatic const char * const da9055_dac_ng_rampdown_txt[] = {\n\t\"0.64 ms/dB\", \"20.48 ms/dB\"\n};\n\nstatic SOC_ENUM_SINGLE_DECL(da9055_dac_ng_rampdown_rate,\n\t\t\t    DA9055_DAC_NG_SETUP_TIME, 3,\n\t\t\t    da9055_dac_ng_rampdown_txt);\n\n \nstatic const char * const da9055_dac_soft_mute_rate_txt[] = {\n\t\"1\", \"2\", \"4\", \"8\", \"16\", \"32\", \"64\"\n};\n\nstatic SOC_ENUM_SINGLE_DECL(da9055_dac_soft_mute_rate,\n\t\t\t    DA9055_DAC_FILTERS5, 4,\n\t\t\t    da9055_dac_soft_mute_rate_txt);\n\n \nstatic const char * const da9055_dac_src_txt[] = {\n\t\"ADC output left\", \"ADC output right\", \"AIF input left\",\n\t\"AIF input right\"\n};\n\nstatic SOC_ENUM_SINGLE_DECL(da9055_dac_l_src,\n\t\t\t    DA9055_DIG_ROUTING_DAC, 0, da9055_dac_src_txt);\n\nstatic SOC_ENUM_SINGLE_DECL(da9055_dac_r_src,\n\t\t\t    DA9055_DIG_ROUTING_DAC, 4, da9055_dac_src_txt);\n\n \nstatic const char * const da9055_mic_l_src_txt[] = {\n\t\"MIC1_P_N\", \"MIC1_P\", \"MIC1_N\", \"MIC2_L\"\n};\n\nstatic SOC_ENUM_SINGLE_DECL(da9055_mic_l_src,\n\t\t\t    DA9055_MIXIN_L_SELECT, 4, da9055_mic_l_src_txt);\n\n \nstatic const char * const da9055_mic_r_src_txt[] = {\n\t\"MIC2_R_L\", \"MIC2_R\", \"MIC2_L\"\n};\n\nstatic SOC_ENUM_SINGLE_DECL(da9055_mic_r_src,\n\t\t\t    DA9055_MIXIN_R_SELECT, 4, da9055_mic_r_src_txt);\n\n \nstatic const char * const da9055_signal_tracking_rate_txt[] = {\n\t\"1/4\", \"1/16\", \"1/256\", \"1/65536\"\n};\n\nstatic SOC_ENUM_SINGLE_DECL(da9055_integ_attack_rate,\n\t\t\t    DA9055_ALC_CTRL3, 4,\n\t\t\t    da9055_signal_tracking_rate_txt);\n\nstatic SOC_ENUM_SINGLE_DECL(da9055_integ_release_rate,\n\t\t\t    DA9055_ALC_CTRL3, 6,\n\t\t\t    da9055_signal_tracking_rate_txt);\n\n \nstatic const char * const da9055_attack_rate_txt[] = {\n\t\"44/fs\", \"88/fs\", \"176/fs\", \"352/fs\", \"704/fs\", \"1408/fs\", \"2816/fs\",\n\t\"5632/fs\", \"11264/fs\", \"22528/fs\", \"45056/fs\", \"90112/fs\", \"180224/fs\"\n};\n\nstatic SOC_ENUM_SINGLE_DECL(da9055_attack_rate,\n\t\t\t    DA9055_ALC_CTRL2, 0, da9055_attack_rate_txt);\n\n \nstatic const char * const da9055_release_rate_txt[] = {\n\t\"176/fs\", \"352/fs\", \"704/fs\", \"1408/fs\", \"2816/fs\", \"5632/fs\",\n\t\"11264/fs\", \"22528/fs\", \"45056/fs\", \"90112/fs\", \"180224/fs\"\n};\n\nstatic SOC_ENUM_SINGLE_DECL(da9055_release_rate,\n\t\t\t    DA9055_ALC_CTRL2, 4, da9055_release_rate_txt);\n\n \nstatic const char * const da9055_hold_time_txt[] = {\n\t\"62/fs\", \"124/fs\", \"248/fs\", \"496/fs\", \"992/fs\", \"1984/fs\", \"3968/fs\",\n\t\"7936/fs\", \"15872/fs\", \"31744/fs\", \"63488/fs\", \"126976/fs\",\n\t\"253952/fs\", \"507904/fs\", \"1015808/fs\", \"2031616/fs\"\n};\n\nstatic SOC_ENUM_SINGLE_DECL(da9055_hold_time,\n\t\t\t    DA9055_ALC_CTRL3, 0, da9055_hold_time_txt);\n\nstatic int da9055_get_alc_data(struct snd_soc_component *component, u8 reg_val)\n{\n\tint mid_data, top_data;\n\tint sum = 0;\n\tu8 iteration;\n\n\tfor (iteration = 0; iteration < DA9055_ALC_AVG_ITERATIONS;\n\t     iteration++) {\n\t\t \n\t\tsnd_soc_component_write(component, DA9055_ALC_CIC_OP_LVL_CTRL, reg_val);\n\n\t\t \n\t\tsnd_soc_component_write(component, DA9055_ALC_CIC_OP_LVL_CTRL,\n\t\t\t      reg_val | DA9055_ALC_DATA_MIDDLE);\n\t\tmid_data = snd_soc_component_read(component, DA9055_ALC_CIC_OP_LVL_DATA);\n\n\t\t \n\t\tsnd_soc_component_write(component, DA9055_ALC_CIC_OP_LVL_CTRL,\n\t\t\t      reg_val | DA9055_ALC_DATA_TOP);\n\t\ttop_data = snd_soc_component_read(component, DA9055_ALC_CIC_OP_LVL_DATA);\n\n\t\tsum += ((mid_data << 8) | (top_data << 16));\n\t}\n\n\treturn sum / DA9055_ALC_AVG_ITERATIONS;\n}\n\nstatic int da9055_put_alc_sw(struct snd_kcontrol *kcontrol,\n\t\t\t     struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_soc_component *component = snd_soc_kcontrol_component(kcontrol);\n\tu8 reg_val, adc_left, adc_right, mic_left, mic_right;\n\tint avg_left_data, avg_right_data, offset_l, offset_r;\n\n\tif (ucontrol->value.integer.value[0]) {\n\t\t \n\n\t\t \n\t\tmic_left = snd_soc_component_read(component, DA9055_MIC_L_CTRL);\n\t\tmic_right = snd_soc_component_read(component, DA9055_MIC_R_CTRL);\n\n\t\t \n\t\tsnd_soc_component_update_bits(component, DA9055_MIC_L_CTRL,\n\t\t\t\t    DA9055_MIC_L_MUTE_EN, DA9055_MIC_L_MUTE_EN);\n\t\tsnd_soc_component_update_bits(component, DA9055_MIC_R_CTRL,\n\t\t\t\t    DA9055_MIC_R_MUTE_EN, DA9055_MIC_R_MUTE_EN);\n\n\t\t \n\t\tadc_left = snd_soc_component_read(component, DA9055_ADC_L_CTRL);\n\t\tadc_right = snd_soc_component_read(component, DA9055_ADC_R_CTRL);\n\n\t\t \n\t\tsnd_soc_component_update_bits(component, DA9055_ADC_L_CTRL,\n\t\t\t\t    DA9055_ADC_L_EN, DA9055_ADC_L_EN);\n\t\tsnd_soc_component_update_bits(component, DA9055_ADC_R_CTRL,\n\t\t\t\t    DA9055_ADC_R_EN, DA9055_ADC_R_EN);\n\n\t\t \n\t\t \n\t\tavg_left_data = da9055_get_alc_data(component,\n\t\t\t\tDA9055_ALC_CIC_OP_CHANNEL_LEFT);\n\t\t \n\t\tavg_right_data = da9055_get_alc_data(component,\n\t\t\t\t DA9055_ALC_CIC_OP_CHANNEL_RIGHT);\n\n\t\t \n\t\toffset_l = -avg_left_data;\n\t\toffset_r = -avg_right_data;\n\n\t\treg_val = (offset_l & DA9055_ALC_OFFSET_15_8) >> 8;\n\t\tsnd_soc_component_write(component, DA9055_ALC_OFFSET_OP2M_L, reg_val);\n\t\treg_val = (offset_l & DA9055_ALC_OFFSET_17_16) >> 16;\n\t\tsnd_soc_component_write(component, DA9055_ALC_OFFSET_OP2U_L, reg_val);\n\n\t\treg_val = (offset_r & DA9055_ALC_OFFSET_15_8) >> 8;\n\t\tsnd_soc_component_write(component, DA9055_ALC_OFFSET_OP2M_R, reg_val);\n\t\treg_val = (offset_r & DA9055_ALC_OFFSET_17_16) >> 16;\n\t\tsnd_soc_component_write(component, DA9055_ALC_OFFSET_OP2U_R, reg_val);\n\n\t\t \n\t\tsnd_soc_component_write(component, DA9055_ADC_L_CTRL, adc_left);\n\t\tsnd_soc_component_write(component, DA9055_ADC_R_CTRL, adc_right);\n\n\t\t \n\t\tsnd_soc_component_write(component, DA9055_MIC_L_CTRL, mic_left);\n\t\tsnd_soc_component_write(component, DA9055_MIC_R_CTRL, mic_right);\n\t}\n\n\treturn snd_soc_put_volsw(kcontrol, ucontrol);\n}\n\nstatic const struct snd_kcontrol_new da9055_snd_controls[] = {\n\n\t \n\tSOC_DOUBLE_R_TLV(\"Mic Volume\",\n\t\t\t DA9055_MIC_L_GAIN, DA9055_MIC_R_GAIN,\n\t\t\t 0, 0x7, 0, mic_vol_tlv),\n\tSOC_DOUBLE_R_TLV(\"Aux Volume\",\n\t\t\t DA9055_AUX_L_GAIN, DA9055_AUX_R_GAIN,\n\t\t\t 0, 0x3f, 0, aux_vol_tlv),\n\tSOC_DOUBLE_R_TLV(\"Mixin PGA Volume\",\n\t\t\t DA9055_MIXIN_L_GAIN, DA9055_MIXIN_R_GAIN,\n\t\t\t 0, 0xf, 0, mixin_gain_tlv),\n\tSOC_DOUBLE_R_TLV(\"ADC Volume\",\n\t\t\t DA9055_ADC_L_GAIN, DA9055_ADC_R_GAIN,\n\t\t\t 0, 0x7f, 0, digital_gain_tlv),\n\n\tSOC_DOUBLE_R_TLV(\"DAC Volume\",\n\t\t\t DA9055_DAC_L_GAIN, DA9055_DAC_R_GAIN,\n\t\t\t 0, 0x7f, 0, digital_gain_tlv),\n\tSOC_DOUBLE_R_TLV(\"Headphone Volume\",\n\t\t\t DA9055_HP_L_GAIN, DA9055_HP_R_GAIN,\n\t\t\t 0, 0x3f, 0, hp_vol_tlv),\n\tSOC_SINGLE_TLV(\"Lineout Volume\", DA9055_LINE_GAIN, 0, 0x3f, 0,\n\t\t       lineout_vol_tlv),\n\n\t \n\tSOC_SINGLE(\"DAC EQ Switch\", DA9055_DAC_FILTERS4, 7, 1, 0),\n\tSOC_SINGLE_TLV(\"DAC EQ1 Volume\", DA9055_DAC_FILTERS2, 0, 0xf, 0,\n\t\t       eq_gain_tlv),\n\tSOC_SINGLE_TLV(\"DAC EQ2 Volume\", DA9055_DAC_FILTERS2, 4, 0xf, 0,\n\t\t       eq_gain_tlv),\n\tSOC_SINGLE_TLV(\"DAC EQ3 Volume\", DA9055_DAC_FILTERS3, 0, 0xf, 0,\n\t\t       eq_gain_tlv),\n\tSOC_SINGLE_TLV(\"DAC EQ4 Volume\", DA9055_DAC_FILTERS3, 4, 0xf, 0,\n\t\t       eq_gain_tlv),\n\tSOC_SINGLE_TLV(\"DAC EQ5 Volume\", DA9055_DAC_FILTERS4, 0, 0xf, 0,\n\t\t       eq_gain_tlv),\n\n\t \n\tSOC_SINGLE(\"ADC HPF Switch\", DA9055_ADC_FILTERS1, 7, 1, 0),\n\tSOC_ENUM(\"ADC HPF Cutoff\", da9055_adc_hpf_cutoff),\n\tSOC_SINGLE(\"ADC Voice Mode Switch\", DA9055_ADC_FILTERS1, 3, 1, 0),\n\tSOC_ENUM(\"ADC Voice Cutoff\", da9055_adc_vf_cutoff),\n\n\tSOC_SINGLE(\"DAC HPF Switch\", DA9055_DAC_FILTERS1, 7, 1, 0),\n\tSOC_ENUM(\"DAC HPF Cutoff\", da9055_dac_hpf_cutoff),\n\tSOC_SINGLE(\"DAC Voice Mode Switch\", DA9055_DAC_FILTERS1, 3, 1, 0),\n\tSOC_ENUM(\"DAC Voice Cutoff\", da9055_dac_vf_cutoff),\n\n\t \n\tSOC_DOUBLE_R(\"Mic Switch\", DA9055_MIC_L_CTRL,\n\t\t     DA9055_MIC_R_CTRL, 6, 1, 0),\n\tSOC_DOUBLE_R(\"Aux Switch\", DA9055_AUX_L_CTRL,\n\t\t     DA9055_AUX_R_CTRL, 6, 1, 0),\n\tSOC_DOUBLE_R(\"Mixin PGA Switch\", DA9055_MIXIN_L_CTRL,\n\t\t     DA9055_MIXIN_R_CTRL, 6, 1, 0),\n\tSOC_DOUBLE_R(\"ADC Switch\", DA9055_ADC_L_CTRL,\n\t\t     DA9055_ADC_R_CTRL, 6, 1, 0),\n\tSOC_DOUBLE_R(\"Headphone Switch\", DA9055_HP_L_CTRL,\n\t\t     DA9055_HP_R_CTRL, 6, 1, 0),\n\tSOC_SINGLE(\"Lineout Switch\", DA9055_LINE_CTRL, 6, 1, 0),\n\tSOC_SINGLE(\"DAC Soft Mute Switch\", DA9055_DAC_FILTERS5, 7, 1, 0),\n\tSOC_ENUM(\"DAC Soft Mute Rate\", da9055_dac_soft_mute_rate),\n\n\t \n\tSOC_DOUBLE_R(\"Aux ZC Switch\", DA9055_AUX_L_CTRL,\n\t\t     DA9055_AUX_R_CTRL, 4, 1, 0),\n\tSOC_DOUBLE_R(\"Mixin PGA ZC Switch\", DA9055_MIXIN_L_CTRL,\n\t\t     DA9055_MIXIN_R_CTRL, 4, 1, 0),\n\tSOC_DOUBLE_R(\"Headphone ZC Switch\", DA9055_HP_L_CTRL,\n\t\t     DA9055_HP_R_CTRL, 4, 1, 0),\n\tSOC_SINGLE(\"Lineout ZC Switch\", DA9055_LINE_CTRL, 4, 1, 0),\n\n\t \n\tSOC_DOUBLE_R(\"Aux Gain Ramping Switch\", DA9055_AUX_L_CTRL,\n\t\t     DA9055_AUX_R_CTRL, 5, 1, 0),\n\tSOC_DOUBLE_R(\"Mixin Gain Ramping Switch\", DA9055_MIXIN_L_CTRL,\n\t\t     DA9055_MIXIN_R_CTRL, 5, 1, 0),\n\tSOC_DOUBLE_R(\"ADC Gain Ramping Switch\", DA9055_ADC_L_CTRL,\n\t\t     DA9055_ADC_R_CTRL, 5, 1, 0),\n\tSOC_DOUBLE_R(\"DAC Gain Ramping Switch\", DA9055_DAC_L_CTRL,\n\t\t     DA9055_DAC_R_CTRL, 5, 1, 0),\n\tSOC_DOUBLE_R(\"Headphone Gain Ramping Switch\", DA9055_HP_L_CTRL,\n\t\t     DA9055_HP_R_CTRL, 5, 1, 0),\n\tSOC_SINGLE(\"Lineout Gain Ramping Switch\", DA9055_LINE_CTRL, 5, 1, 0),\n\tSOC_ENUM(\"Gain Ramping Rate\", da9055_gain_ramping_rate),\n\n\t \n\tSOC_SINGLE(\"DAC NG Switch\", DA9055_DAC_NG_CTRL, 7, 1, 0),\n\tSOC_SINGLE(\"DAC NG ON Threshold\", DA9055_DAC_NG_ON_THRESHOLD,\n\t\t   0, 0x7, 0),\n\tSOC_SINGLE(\"DAC NG OFF Threshold\", DA9055_DAC_NG_OFF_THRESHOLD,\n\t\t   0, 0x7, 0),\n\tSOC_ENUM(\"DAC NG Setup Time\", da9055_dac_ng_setup_time),\n\tSOC_ENUM(\"DAC NG Rampup Rate\", da9055_dac_ng_rampup_rate),\n\tSOC_ENUM(\"DAC NG Rampdown Rate\", da9055_dac_ng_rampdown_rate),\n\n\t \n\tSOC_SINGLE(\"DAC Left Invert\", DA9055_DIG_CTRL, 3, 1, 0),\n\tSOC_SINGLE(\"DAC Right Invert\", DA9055_DIG_CTRL, 7, 1, 0),\n\n\t \n\tSOC_DOUBLE_R(\"DMIC Switch\", DA9055_MIXIN_L_SELECT,\n\t\t     DA9055_MIXIN_R_SELECT, 7, 1, 0),\n\n\t \n\tSOC_DOUBLE_EXT(\"ALC Switch\", DA9055_ALC_CTRL1, 3, 7, 1, 0,\n\t\t       snd_soc_get_volsw, da9055_put_alc_sw),\n\tSOC_SINGLE_EXT(\"ALC Sync Mode Switch\", DA9055_ALC_CTRL1, 1, 1, 0,\n\t\t       snd_soc_get_volsw, da9055_put_alc_sw),\n\tSOC_SINGLE(\"ALC Offset Switch\", DA9055_ALC_CTRL1, 0, 1, 0),\n\tSOC_SINGLE(\"ALC Anticlip Mode Switch\", DA9055_ALC_ANTICLIP_CTRL,\n\t\t   7, 1, 0),\n\tSOC_SINGLE(\"ALC Anticlip Level\", DA9055_ALC_ANTICLIP_LEVEL,\n\t\t   0, 0x7f, 0),\n\tSOC_SINGLE_TLV(\"ALC Min Threshold Volume\", DA9055_ALC_TARGET_MIN,\n\t\t       0, 0x3f, 1, alc_threshold_tlv),\n\tSOC_SINGLE_TLV(\"ALC Max Threshold Volume\", DA9055_ALC_TARGET_MAX,\n\t\t       0, 0x3f, 1, alc_threshold_tlv),\n\tSOC_SINGLE_TLV(\"ALC Noise Threshold Volume\", DA9055_ALC_NOISE,\n\t\t       0, 0x3f, 1, alc_threshold_tlv),\n\tSOC_SINGLE_TLV(\"ALC Max Gain Volume\", DA9055_ALC_GAIN_LIMITS,\n\t\t       4, 0xf, 0, alc_gain_tlv),\n\tSOC_SINGLE_TLV(\"ALC Max Attenuation Volume\", DA9055_ALC_GAIN_LIMITS,\n\t\t       0, 0xf, 0, alc_gain_tlv),\n\tSOC_SINGLE_TLV(\"ALC Min Analog Gain Volume\",\n\t\t       DA9055_ALC_ANA_GAIN_LIMITS,\n\t\t       0, 0x7, 0, alc_analog_gain_tlv),\n\tSOC_SINGLE_TLV(\"ALC Max Analog Gain Volume\",\n\t\t       DA9055_ALC_ANA_GAIN_LIMITS,\n\t\t       4, 0x7, 0, alc_analog_gain_tlv),\n\tSOC_ENUM(\"ALC Attack Rate\", da9055_attack_rate),\n\tSOC_ENUM(\"ALC Release Rate\", da9055_release_rate),\n\tSOC_ENUM(\"ALC Hold Time\", da9055_hold_time),\n\t \n\tSOC_ENUM(\"ALC Integ Attack Rate\", da9055_integ_attack_rate),\n\t \n\tSOC_ENUM(\"ALC Integ Release Rate\", da9055_integ_release_rate),\n};\n\n \n\n \nstatic const struct snd_kcontrol_new da9055_mic_l_mux_controls =\nSOC_DAPM_ENUM(\"Route\", da9055_mic_l_src);\n\n \nstatic const struct snd_kcontrol_new da9055_mic_r_mux_controls =\nSOC_DAPM_ENUM(\"Route\", da9055_mic_r_src);\n\n \nstatic const struct snd_kcontrol_new da9055_dapm_mixinl_controls[] = {\n\tSOC_DAPM_SINGLE(\"Aux Left Switch\", DA9055_MIXIN_L_SELECT, 0, 1, 0),\n\tSOC_DAPM_SINGLE(\"Mic Left Switch\", DA9055_MIXIN_L_SELECT, 1, 1, 0),\n\tSOC_DAPM_SINGLE(\"Mic Right Switch\", DA9055_MIXIN_L_SELECT, 2, 1, 0),\n};\n\n \nstatic const struct snd_kcontrol_new da9055_dapm_mixinr_controls[] = {\n\tSOC_DAPM_SINGLE(\"Aux Right Switch\", DA9055_MIXIN_R_SELECT, 0, 1, 0),\n\tSOC_DAPM_SINGLE(\"Mic Right Switch\", DA9055_MIXIN_R_SELECT, 1, 1, 0),\n\tSOC_DAPM_SINGLE(\"Mic Left Switch\", DA9055_MIXIN_R_SELECT, 2, 1, 0),\n\tSOC_DAPM_SINGLE(\"Mixin Left Switch\", DA9055_MIXIN_R_SELECT, 3, 1, 0),\n};\n\n \nstatic const struct snd_kcontrol_new da9055_dac_l_mux_controls =\nSOC_DAPM_ENUM(\"Route\", da9055_dac_l_src);\n\n \nstatic const struct snd_kcontrol_new da9055_dac_r_mux_controls =\nSOC_DAPM_ENUM(\"Route\", da9055_dac_r_src);\n\n \nstatic const struct snd_kcontrol_new da9055_dapm_mixoutl_controls[] = {\n\tSOC_DAPM_SINGLE(\"Aux Left Switch\", DA9055_MIXOUT_L_SELECT, 0, 1, 0),\n\tSOC_DAPM_SINGLE(\"Mixin Left Switch\", DA9055_MIXOUT_L_SELECT, 1, 1, 0),\n\tSOC_DAPM_SINGLE(\"Mixin Right Switch\", DA9055_MIXOUT_L_SELECT, 2, 1, 0),\n\tSOC_DAPM_SINGLE(\"DAC Left Switch\", DA9055_MIXOUT_L_SELECT, 3, 1, 0),\n\tSOC_DAPM_SINGLE(\"Aux Left Invert Switch\", DA9055_MIXOUT_L_SELECT,\n\t\t\t4, 1, 0),\n\tSOC_DAPM_SINGLE(\"Mixin Left Invert Switch\", DA9055_MIXOUT_L_SELECT,\n\t\t\t5, 1, 0),\n\tSOC_DAPM_SINGLE(\"Mixin Right Invert Switch\", DA9055_MIXOUT_L_SELECT,\n\t\t\t6, 1, 0),\n};\n\n \nstatic const struct snd_kcontrol_new da9055_dapm_mixoutr_controls[] = {\n\tSOC_DAPM_SINGLE(\"Aux Right Switch\", DA9055_MIXOUT_R_SELECT, 0, 1, 0),\n\tSOC_DAPM_SINGLE(\"Mixin Right Switch\", DA9055_MIXOUT_R_SELECT, 1, 1, 0),\n\tSOC_DAPM_SINGLE(\"Mixin Left Switch\", DA9055_MIXOUT_R_SELECT, 2, 1, 0),\n\tSOC_DAPM_SINGLE(\"DAC Right Switch\", DA9055_MIXOUT_R_SELECT, 3, 1, 0),\n\tSOC_DAPM_SINGLE(\"Aux Right Invert Switch\", DA9055_MIXOUT_R_SELECT,\n\t\t\t4, 1, 0),\n\tSOC_DAPM_SINGLE(\"Mixin Right Invert Switch\", DA9055_MIXOUT_R_SELECT,\n\t\t\t5, 1, 0),\n\tSOC_DAPM_SINGLE(\"Mixin Left Invert Switch\", DA9055_MIXOUT_R_SELECT,\n\t\t\t6, 1, 0),\n};\n\n \nstatic const struct snd_kcontrol_new da9055_dapm_hp_l_control =\nSOC_DAPM_SINGLE(\"Switch\", DA9055_HP_L_CTRL, 3, 1, 0);\n\nstatic const struct snd_kcontrol_new da9055_dapm_hp_r_control =\nSOC_DAPM_SINGLE(\"Switch\", DA9055_HP_R_CTRL, 3, 1, 0);\n\n \nstatic const struct snd_kcontrol_new da9055_dapm_lineout_control =\nSOC_DAPM_SINGLE(\"Switch\", DA9055_LINE_CTRL, 3, 1, 0);\n\n \nstatic const struct snd_soc_dapm_widget da9055_dapm_widgets[] = {\n\t \n\n\t \n\tSND_SOC_DAPM_INPUT(\"MIC1\"),\n\tSND_SOC_DAPM_INPUT(\"MIC2\"),\n\tSND_SOC_DAPM_INPUT(\"AUXL\"),\n\tSND_SOC_DAPM_INPUT(\"AUXR\"),\n\n\t \n\tSND_SOC_DAPM_MUX(\"Mic Left Source\", SND_SOC_NOPM, 0, 0,\n\t\t\t &da9055_mic_l_mux_controls),\n\tSND_SOC_DAPM_MUX(\"Mic Right Source\", SND_SOC_NOPM, 0, 0,\n\t\t\t &da9055_mic_r_mux_controls),\n\n\t \n\tSND_SOC_DAPM_PGA(\"Mic Left\", DA9055_MIC_L_CTRL, 7, 0, NULL, 0),\n\tSND_SOC_DAPM_PGA(\"Mic Right\", DA9055_MIC_R_CTRL, 7, 0, NULL, 0),\n\tSND_SOC_DAPM_PGA(\"Aux Left\", DA9055_AUX_L_CTRL, 7, 0, NULL, 0),\n\tSND_SOC_DAPM_PGA(\"Aux Right\", DA9055_AUX_R_CTRL, 7, 0, NULL, 0),\n\tSND_SOC_DAPM_PGA(\"MIXIN Left\", DA9055_MIXIN_L_CTRL, 7, 0, NULL, 0),\n\tSND_SOC_DAPM_PGA(\"MIXIN Right\", DA9055_MIXIN_R_CTRL, 7, 0, NULL, 0),\n\n\tSND_SOC_DAPM_SUPPLY(\"Mic Bias\", DA9055_MIC_BIAS_CTRL, 7, 0, NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"AIF\", DA9055_AIF_CTRL, 7, 0, NULL, 0),\n\tSND_SOC_DAPM_SUPPLY(\"Charge Pump\", DA9055_CP_CTRL, 7, 0, NULL, 0),\n\n\t \n\tSND_SOC_DAPM_MIXER(\"In Mixer Left\", SND_SOC_NOPM, 0, 0,\n\t\t\t   &da9055_dapm_mixinl_controls[0],\n\t\t\t   ARRAY_SIZE(da9055_dapm_mixinl_controls)),\n\tSND_SOC_DAPM_MIXER(\"In Mixer Right\", SND_SOC_NOPM, 0, 0,\n\t\t\t   &da9055_dapm_mixinr_controls[0],\n\t\t\t   ARRAY_SIZE(da9055_dapm_mixinr_controls)),\n\n\t \n\tSND_SOC_DAPM_ADC(\"ADC Left\", \"Capture\", DA9055_ADC_L_CTRL, 7, 0),\n\tSND_SOC_DAPM_ADC(\"ADC Right\", \"Capture\", DA9055_ADC_R_CTRL, 7, 0),\n\n\t \n\n\t \n\tSND_SOC_DAPM_MUX(\"DAC Left Source\", SND_SOC_NOPM, 0, 0,\n\t\t\t &da9055_dac_l_mux_controls),\n\tSND_SOC_DAPM_MUX(\"DAC Right Source\", SND_SOC_NOPM, 0, 0,\n\t\t\t &da9055_dac_r_mux_controls),\n\n\t \n\tSND_SOC_DAPM_AIF_IN(\"AIFIN Left\", \"Playback\", 0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"AIFIN Right\", \"Playback\", 0, SND_SOC_NOPM, 0, 0),\n\n\t \n\tSND_SOC_DAPM_DAC(\"DAC Left\", \"Playback\", DA9055_DAC_L_CTRL, 7, 0),\n\tSND_SOC_DAPM_DAC(\"DAC Right\", \"Playback\", DA9055_DAC_R_CTRL, 7, 0),\n\n\t \n\tSND_SOC_DAPM_MIXER(\"Out Mixer Left\", SND_SOC_NOPM, 0, 0,\n\t\t\t   &da9055_dapm_mixoutl_controls[0],\n\t\t\t   ARRAY_SIZE(da9055_dapm_mixoutl_controls)),\n\tSND_SOC_DAPM_MIXER(\"Out Mixer Right\", SND_SOC_NOPM, 0, 0,\n\t\t\t   &da9055_dapm_mixoutr_controls[0],\n\t\t\t   ARRAY_SIZE(da9055_dapm_mixoutr_controls)),\n\n\t \n\tSND_SOC_DAPM_SWITCH(\"Headphone Left Enable\", SND_SOC_NOPM, 0, 0,\n\t\t\t    &da9055_dapm_hp_l_control),\n\tSND_SOC_DAPM_SWITCH(\"Headphone Right Enable\", SND_SOC_NOPM, 0, 0,\n\t\t\t    &da9055_dapm_hp_r_control),\n\tSND_SOC_DAPM_SWITCH(\"Lineout Enable\", SND_SOC_NOPM, 0, 0,\n\t\t\t    &da9055_dapm_lineout_control),\n\n\t \n\tSND_SOC_DAPM_PGA(\"MIXOUT Left\", DA9055_MIXOUT_L_CTRL, 7, 0, NULL, 0),\n\tSND_SOC_DAPM_PGA(\"MIXOUT Right\", DA9055_MIXOUT_R_CTRL, 7, 0, NULL, 0),\n\tSND_SOC_DAPM_PGA(\"Lineout\", DA9055_LINE_CTRL, 7, 0, NULL, 0),\n\tSND_SOC_DAPM_PGA(\"Headphone Left\", DA9055_HP_L_CTRL, 7, 0, NULL, 0),\n\tSND_SOC_DAPM_PGA(\"Headphone Right\", DA9055_HP_R_CTRL, 7, 0, NULL, 0),\n\n\t \n\tSND_SOC_DAPM_OUTPUT(\"HPL\"),\n\tSND_SOC_DAPM_OUTPUT(\"HPR\"),\n\tSND_SOC_DAPM_OUTPUT(\"LINE\"),\n};\n\n \nstatic const struct snd_soc_dapm_route da9055_audio_map[] = {\n\t \n\n\t \n\t{\"Mic Left Source\", \"MIC1_P_N\", \"MIC1\"},\n\t{\"Mic Left Source\", \"MIC1_P\", \"MIC1\"},\n\t{\"Mic Left Source\", \"MIC1_N\", \"MIC1\"},\n\t{\"Mic Left Source\", \"MIC2_L\", \"MIC2\"},\n\n\t{\"Mic Right Source\", \"MIC2_R_L\", \"MIC2\"},\n\t{\"Mic Right Source\", \"MIC2_R\", \"MIC2\"},\n\t{\"Mic Right Source\", \"MIC2_L\", \"MIC2\"},\n\n\t{\"Mic Left\", NULL, \"Mic Left Source\"},\n\t{\"Mic Right\", NULL, \"Mic Right Source\"},\n\n\t{\"Aux Left\", NULL, \"AUXL\"},\n\t{\"Aux Right\", NULL, \"AUXR\"},\n\n\t{\"In Mixer Left\", \"Mic Left Switch\", \"Mic Left\"},\n\t{\"In Mixer Left\", \"Mic Right Switch\", \"Mic Right\"},\n\t{\"In Mixer Left\", \"Aux Left Switch\", \"Aux Left\"},\n\n\t{\"In Mixer Right\", \"Mic Right Switch\", \"Mic Right\"},\n\t{\"In Mixer Right\", \"Mic Left Switch\", \"Mic Left\"},\n\t{\"In Mixer Right\", \"Aux Right Switch\", \"Aux Right\"},\n\t{\"In Mixer Right\", \"Mixin Left Switch\", \"MIXIN Left\"},\n\n\t{\"MIXIN Left\", NULL, \"In Mixer Left\"},\n\t{\"ADC Left\", NULL, \"MIXIN Left\"},\n\n\t{\"MIXIN Right\", NULL, \"In Mixer Right\"},\n\t{\"ADC Right\", NULL, \"MIXIN Right\"},\n\n\t{\"ADC Left\", NULL, \"AIF\"},\n\t{\"ADC Right\", NULL, \"AIF\"},\n\n\t \n\t{\"AIFIN Left\", NULL, \"AIF\"},\n\t{\"AIFIN Right\", NULL, \"AIF\"},\n\n\t{\"DAC Left Source\", \"ADC output left\", \"ADC Left\"},\n\t{\"DAC Left Source\", \"ADC output right\", \"ADC Right\"},\n\t{\"DAC Left Source\", \"AIF input left\", \"AIFIN Left\"},\n\t{\"DAC Left Source\", \"AIF input right\", \"AIFIN Right\"},\n\n\t{\"DAC Right Source\", \"ADC output left\", \"ADC Left\"},\n\t{\"DAC Right Source\", \"ADC output right\", \"ADC Right\"},\n\t{\"DAC Right Source\", \"AIF input left\", \"AIFIN Left\"},\n\t{\"DAC Right Source\", \"AIF input right\", \"AIFIN Right\"},\n\n\t{\"DAC Left\", NULL, \"DAC Left Source\"},\n\t{\"DAC Right\", NULL, \"DAC Right Source\"},\n\n\t{\"Out Mixer Left\", \"Aux Left Switch\", \"Aux Left\"},\n\t{\"Out Mixer Left\", \"Mixin Left Switch\", \"MIXIN Left\"},\n\t{\"Out Mixer Left\", \"Mixin Right Switch\", \"MIXIN Right\"},\n\t{\"Out Mixer Left\", \"Aux Left Invert Switch\", \"Aux Left\"},\n\t{\"Out Mixer Left\", \"Mixin Left Invert Switch\", \"MIXIN Left\"},\n\t{\"Out Mixer Left\", \"Mixin Right Invert Switch\", \"MIXIN Right\"},\n\t{\"Out Mixer Left\", \"DAC Left Switch\", \"DAC Left\"},\n\n\t{\"Out Mixer Right\", \"Aux Right Switch\", \"Aux Right\"},\n\t{\"Out Mixer Right\", \"Mixin Right Switch\", \"MIXIN Right\"},\n\t{\"Out Mixer Right\", \"Mixin Left Switch\", \"MIXIN Left\"},\n\t{\"Out Mixer Right\", \"Aux Right Invert Switch\", \"Aux Right\"},\n\t{\"Out Mixer Right\", \"Mixin Right Invert Switch\", \"MIXIN Right\"},\n\t{\"Out Mixer Right\", \"Mixin Left Invert Switch\", \"MIXIN Left\"},\n\t{\"Out Mixer Right\", \"DAC Right Switch\", \"DAC Right\"},\n\n\t{\"MIXOUT Left\", NULL, \"Out Mixer Left\"},\n\t{\"Headphone Left Enable\", \"Switch\", \"MIXOUT Left\"},\n\t{\"Headphone Left\", NULL, \"Headphone Left Enable\"},\n\t{\"Headphone Left\", NULL, \"Charge Pump\"},\n\t{\"HPL\", NULL, \"Headphone Left\"},\n\n\t{\"MIXOUT Right\", NULL, \"Out Mixer Right\"},\n\t{\"Headphone Right Enable\", \"Switch\", \"MIXOUT Right\"},\n\t{\"Headphone Right\", NULL, \"Headphone Right Enable\"},\n\t{\"Headphone Right\", NULL, \"Charge Pump\"},\n\t{\"HPR\", NULL, \"Headphone Right\"},\n\n\t{\"MIXOUT Right\", NULL, \"Out Mixer Right\"},\n\t{\"Lineout Enable\", \"Switch\", \"MIXOUT Right\"},\n\t{\"Lineout\", NULL, \"Lineout Enable\"},\n\t{\"LINE\", NULL, \"Lineout\"},\n};\n\n \nstruct da9055_priv {\n\tstruct regmap *regmap;\n\tunsigned int mclk_rate;\n\tint master;\n\tstruct da9055_platform_data *pdata;\n};\n\nstatic const struct reg_default da9055_reg_defaults[] = {\n\t{ 0x21, 0x10 },\n\t{ 0x22, 0x0A },\n\t{ 0x23, 0x00 },\n\t{ 0x24, 0x00 },\n\t{ 0x25, 0x00 },\n\t{ 0x26, 0x00 },\n\t{ 0x27, 0x0C },\n\t{ 0x28, 0x01 },\n\t{ 0x29, 0x08 },\n\t{ 0x2A, 0x32 },\n\t{ 0x2B, 0x00 },\n\t{ 0x30, 0x35 },\n\t{ 0x31, 0x35 },\n\t{ 0x32, 0x00 },\n\t{ 0x33, 0x00 },\n\t{ 0x34, 0x03 },\n\t{ 0x35, 0x03 },\n\t{ 0x36, 0x6F },\n\t{ 0x37, 0x6F },\n\t{ 0x38, 0x80 },\n\t{ 0x39, 0x01 },\n\t{ 0x3A, 0x01 },\n\t{ 0x40, 0x00 },\n\t{ 0x41, 0x88 },\n\t{ 0x42, 0x88 },\n\t{ 0x43, 0x08 },\n\t{ 0x44, 0x80 },\n\t{ 0x45, 0x6F },\n\t{ 0x46, 0x6F },\n\t{ 0x47, 0x61 },\n\t{ 0x48, 0x35 },\n\t{ 0x49, 0x35 },\n\t{ 0x4A, 0x35 },\n\t{ 0x4B, 0x00 },\n\t{ 0x4C, 0x00 },\n\t{ 0x60, 0x44 },\n\t{ 0x61, 0x44 },\n\t{ 0x62, 0x00 },\n\t{ 0x63, 0x40 },\n\t{ 0x64, 0x40 },\n\t{ 0x65, 0x40 },\n\t{ 0x66, 0x40 },\n\t{ 0x67, 0x40 },\n\t{ 0x68, 0x40 },\n\t{ 0x69, 0x48 },\n\t{ 0x6A, 0x40 },\n\t{ 0x6B, 0x41 },\n\t{ 0x6C, 0x40 },\n\t{ 0x6D, 0x40 },\n\t{ 0x6E, 0x10 },\n\t{ 0x6F, 0x10 },\n\t{ 0x90, 0x80 },\n\t{ 0x92, 0x02 },\n\t{ 0x93, 0x00 },\n\t{ 0x99, 0x00 },\n\t{ 0x9A, 0x00 },\n\t{ 0x9B, 0x00 },\n\t{ 0x9C, 0x3F },\n\t{ 0x9D, 0x00 },\n\t{ 0x9E, 0x3F },\n\t{ 0x9F, 0xFF },\n\t{ 0xA0, 0x71 },\n\t{ 0xA1, 0x00 },\n\t{ 0xA2, 0x00 },\n\t{ 0xA6, 0x00 },\n\t{ 0xA7, 0x00 },\n\t{ 0xAB, 0x00 },\n\t{ 0xAC, 0x00 },\n\t{ 0xAD, 0x00 },\n\t{ 0xAF, 0x08 },\n\t{ 0xB0, 0x00 },\n\t{ 0xB1, 0x00 },\n\t{ 0xB2, 0x00 },\n};\n\nstatic bool da9055_volatile_register(struct device *dev,\n\t\t\t\t     unsigned int reg)\n{\n\tswitch (reg) {\n\tcase DA9055_STATUS1:\n\tcase DA9055_PLL_STATUS:\n\tcase DA9055_AUX_L_GAIN_STATUS:\n\tcase DA9055_AUX_R_GAIN_STATUS:\n\tcase DA9055_MIC_L_GAIN_STATUS:\n\tcase DA9055_MIC_R_GAIN_STATUS:\n\tcase DA9055_MIXIN_L_GAIN_STATUS:\n\tcase DA9055_MIXIN_R_GAIN_STATUS:\n\tcase DA9055_ADC_L_GAIN_STATUS:\n\tcase DA9055_ADC_R_GAIN_STATUS:\n\tcase DA9055_DAC_L_GAIN_STATUS:\n\tcase DA9055_DAC_R_GAIN_STATUS:\n\tcase DA9055_HP_L_GAIN_STATUS:\n\tcase DA9055_HP_R_GAIN_STATUS:\n\tcase DA9055_LINE_GAIN_STATUS:\n\tcase DA9055_ALC_CIC_OP_LVL_DATA:\n\t\treturn true;\n\tdefault:\n\t\treturn false;\n\t}\n}\n\n \nstatic int da9055_hw_params(struct snd_pcm_substream *substream,\n\t\t\t    struct snd_pcm_hw_params *params,\n\t\t\t    struct snd_soc_dai *dai)\n{\n\tstruct snd_soc_component *component = dai->component;\n\tstruct da9055_priv *da9055 = snd_soc_component_get_drvdata(component);\n\tu8 aif_ctrl, fs;\n\tu32 sysclk;\n\n\tswitch (params_width(params)) {\n\tcase 16:\n\t\taif_ctrl = DA9055_AIF_WORD_S16_LE;\n\t\tbreak;\n\tcase 20:\n\t\taif_ctrl = DA9055_AIF_WORD_S20_3LE;\n\t\tbreak;\n\tcase 24:\n\t\taif_ctrl = DA9055_AIF_WORD_S24_LE;\n\t\tbreak;\n\tcase 32:\n\t\taif_ctrl = DA9055_AIF_WORD_S32_LE;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\t \n\tsnd_soc_component_update_bits(component, DA9055_AIF_CTRL, DA9055_AIF_WORD_LENGTH_MASK,\n\t\t\t    aif_ctrl);\n\n\tswitch (params_rate(params)) {\n\tcase 8000:\n\t\tfs\t\t= DA9055_SR_8000;\n\t\tsysclk\t\t= 3072000;\n\t\tbreak;\n\tcase 11025:\n\t\tfs\t\t= DA9055_SR_11025;\n\t\tsysclk\t\t= 2822400;\n\t\tbreak;\n\tcase 12000:\n\t\tfs\t\t= DA9055_SR_12000;\n\t\tsysclk\t\t= 3072000;\n\t\tbreak;\n\tcase 16000:\n\t\tfs\t\t= DA9055_SR_16000;\n\t\tsysclk\t\t= 3072000;\n\t\tbreak;\n\tcase 22050:\n\t\tfs\t\t= DA9055_SR_22050;\n\t\tsysclk\t\t= 2822400;\n\t\tbreak;\n\tcase 32000:\n\t\tfs\t\t= DA9055_SR_32000;\n\t\tsysclk\t\t= 3072000;\n\t\tbreak;\n\tcase 44100:\n\t\tfs\t\t= DA9055_SR_44100;\n\t\tsysclk\t\t= 2822400;\n\t\tbreak;\n\tcase 48000:\n\t\tfs\t\t= DA9055_SR_48000;\n\t\tsysclk\t\t= 3072000;\n\t\tbreak;\n\tcase 88200:\n\t\tfs\t\t= DA9055_SR_88200;\n\t\tsysclk\t\t= 2822400;\n\t\tbreak;\n\tcase 96000:\n\t\tfs\t\t= DA9055_SR_96000;\n\t\tsysclk\t\t= 3072000;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tif (da9055->mclk_rate) {\n\t\t \n\t\tsnd_soc_component_write(component, DA9055_SR, fs);\n\t} else {\n\t\t \n\t\tsnd_soc_component_write(component, DA9055_SR, DA9055_SR_48000);\n\t}\n\n\tif (da9055->mclk_rate && (da9055->mclk_rate != sysclk)) {\n\t\t \n\t\tif (!da9055->master) {\n\t\t\t \n\t\t\tsnd_soc_component_update_bits(component, DA9055_PLL_CTRL,\n\t\t\t\t\t    DA9055_PLL_EN | DA9055_PLL_SRM_EN,\n\t\t\t\t\t    DA9055_PLL_EN | DA9055_PLL_SRM_EN);\n\t\t} else {\n\t\t\t \n\t\t\tsnd_soc_component_update_bits(component, DA9055_PLL_CTRL,\n\t\t\t\t\t    DA9055_PLL_EN, DA9055_PLL_EN);\n\t\t}\n\t} else {\n\t\t \n\t\tsnd_soc_component_update_bits(component, DA9055_PLL_CTRL, DA9055_PLL_EN, 0);\n\t}\n\n\treturn 0;\n}\n\n \nstatic int da9055_set_dai_fmt(struct snd_soc_dai *codec_dai, unsigned int fmt)\n{\n\tstruct snd_soc_component *component = codec_dai->component;\n\tstruct da9055_priv *da9055 = snd_soc_component_get_drvdata(component);\n\tu8 aif_clk_mode, aif_ctrl, mode;\n\n\tswitch (fmt & SND_SOC_DAIFMT_MASTER_MASK) {\n\tcase SND_SOC_DAIFMT_CBM_CFM:\n\t\t \n\t\tmode = 1;\n\t\taif_clk_mode = DA9055_AIF_CLK_EN_MASTER_MODE;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_CBS_CFS:\n\t\t \n\t\tmode = 0;\n\t\taif_clk_mode = DA9055_AIF_CLK_EN_SLAVE_MODE;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\t \n\tif ((snd_soc_component_read(component, DA9055_PLL_CTRL) & DA9055_PLL_EN) &&\n\t    (da9055->master != mode))\n\t\treturn -EINVAL;\n\n\tda9055->master = mode;\n\n\t \n\tswitch (fmt & SND_SOC_DAIFMT_FORMAT_MASK) {\n\tcase SND_SOC_DAIFMT_I2S:\n\t\taif_ctrl = DA9055_AIF_FORMAT_I2S_MODE;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_LEFT_J:\n\t\taif_ctrl = DA9055_AIF_FORMAT_LEFT_J;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_RIGHT_J:\n\t\taif_ctrl = DA9055_AIF_FORMAT_RIGHT_J;\n\t\tbreak;\n\tcase SND_SOC_DAIFMT_DSP_A:\n\t\taif_ctrl = DA9055_AIF_FORMAT_DSP;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\t \n\taif_clk_mode |= DA9055_AIF_BCLKS_PER_WCLK_32;\n\n\tsnd_soc_component_update_bits(component, DA9055_AIF_CLK_MODE,\n\t\t\t    (DA9055_AIF_CLK_MODE_MASK | DA9055_AIF_BCLK_MASK),\n\t\t\t    aif_clk_mode);\n\tsnd_soc_component_update_bits(component, DA9055_AIF_CTRL, DA9055_AIF_FORMAT_MASK,\n\t\t\t    aif_ctrl);\n\treturn 0;\n}\n\nstatic int da9055_mute(struct snd_soc_dai *dai, int mute, int direction)\n{\n\tstruct snd_soc_component *component = dai->component;\n\n\tif (mute) {\n\t\tsnd_soc_component_update_bits(component, DA9055_DAC_L_CTRL,\n\t\t\t\t    DA9055_DAC_L_MUTE_EN, DA9055_DAC_L_MUTE_EN);\n\t\tsnd_soc_component_update_bits(component, DA9055_DAC_R_CTRL,\n\t\t\t\t    DA9055_DAC_R_MUTE_EN, DA9055_DAC_R_MUTE_EN);\n\t} else {\n\t\tsnd_soc_component_update_bits(component, DA9055_DAC_L_CTRL,\n\t\t\t\t    DA9055_DAC_L_MUTE_EN, 0);\n\t\tsnd_soc_component_update_bits(component, DA9055_DAC_R_CTRL,\n\t\t\t\t    DA9055_DAC_R_MUTE_EN, 0);\n\t}\n\n\treturn 0;\n}\n\n#define DA9055_FORMATS (SNDRV_PCM_FMTBIT_S16_LE | SNDRV_PCM_FMTBIT_S20_3LE |\\\n\t\t\tSNDRV_PCM_FMTBIT_S24_LE | SNDRV_PCM_FMTBIT_S32_LE)\n\nstatic int da9055_set_dai_sysclk(struct snd_soc_dai *codec_dai,\n\t\t\t\t int clk_id, unsigned int freq, int dir)\n{\n\tstruct snd_soc_component *component = codec_dai->component;\n\tstruct da9055_priv *da9055 = snd_soc_component_get_drvdata(component);\n\n\tswitch (clk_id) {\n\tcase DA9055_CLKSRC_MCLK:\n\t\tswitch (freq) {\n\t\tcase 11289600:\n\t\tcase 12000000:\n\t\tcase 12288000:\n\t\tcase 13000000:\n\t\tcase 13500000:\n\t\tcase 14400000:\n\t\tcase 19200000:\n\t\tcase 19680000:\n\t\tcase 19800000:\n\t\t\tda9055->mclk_rate = freq;\n\t\t\treturn 0;\n\t\tdefault:\n\t\t\tdev_err(codec_dai->dev, \"Unsupported MCLK value %d\\n\",\n\t\t\t\tfreq);\n\t\t\treturn -EINVAL;\n\t\t}\n\t\tbreak;\n\tdefault:\n\t\tdev_err(codec_dai->dev, \"Unknown clock source %d\\n\", clk_id);\n\t\treturn -EINVAL;\n\t}\n}\n\n \nstatic int da9055_set_dai_pll(struct snd_soc_dai *codec_dai, int pll_id,\n\t\t\t      int source, unsigned int fref, unsigned int fout)\n{\n\tstruct snd_soc_component *component = codec_dai->component;\n\tstruct da9055_priv *da9055 = snd_soc_component_get_drvdata(component);\n\n\tu8 pll_frac_top, pll_frac_bot, pll_integer, cnt;\n\n\t \n\tsnd_soc_component_update_bits(component, DA9055_PLL_CTRL, DA9055_PLL_EN, 0);\n\n\t \n\tif (!da9055->master && (fout != 2822400))\n\t\tgoto pll_err;\n\n\t \n\tfor (cnt = 0; cnt < ARRAY_SIZE(da9055_pll_div); cnt++) {\n\t\t \n\t\tif ((fref == da9055_pll_div[cnt].fref) &&\n\t\t    (da9055->master ==  da9055_pll_div[cnt].mode) &&\n\t\t    (fout == da9055_pll_div[cnt].fout)) {\n\t\t\t \n\t\t\tpll_frac_top = da9055_pll_div[cnt].frac_top;\n\t\t\tpll_frac_bot = da9055_pll_div[cnt].frac_bot;\n\t\t\tpll_integer = da9055_pll_div[cnt].integer;\n\t\t\tbreak;\n\t\t}\n\t}\n\tif (cnt >= ARRAY_SIZE(da9055_pll_div))\n\t\tgoto pll_err;\n\n\t \n\tsnd_soc_component_write(component, DA9055_PLL_FRAC_TOP, pll_frac_top);\n\tsnd_soc_component_write(component, DA9055_PLL_FRAC_BOT, pll_frac_bot);\n\tsnd_soc_component_write(component, DA9055_PLL_INTEGER, pll_integer);\n\n\treturn 0;\npll_err:\n\tdev_err(codec_dai->dev, \"Error in setting up PLL\\n\");\n\treturn -EINVAL;\n}\n\n \nstatic const struct snd_soc_dai_ops da9055_dai_ops = {\n\t.hw_params\t= da9055_hw_params,\n\t.set_fmt\t= da9055_set_dai_fmt,\n\t.set_sysclk\t= da9055_set_dai_sysclk,\n\t.set_pll\t= da9055_set_dai_pll,\n\t.mute_stream\t= da9055_mute,\n\t.no_capture_mute = 1,\n};\n\nstatic struct snd_soc_dai_driver da9055_dai = {\n\t.name = \"da9055-hifi\",\n\t \n\t.playback = {\n\t\t.stream_name = \"Playback\",\n\t\t.channels_min = 1,\n\t\t.channels_max = 2,\n\t\t.rates = SNDRV_PCM_RATE_8000_96000,\n\t\t.formats = DA9055_FORMATS,\n\t},\n\t \n\t.capture = {\n\t\t.stream_name = \"Capture\",\n\t\t.channels_min = 1,\n\t\t.channels_max = 2,\n\t\t.rates = SNDRV_PCM_RATE_8000_96000,\n\t\t.formats = DA9055_FORMATS,\n\t},\n\t.ops = &da9055_dai_ops,\n\t.symmetric_rate = 1,\n};\n\nstatic int da9055_set_bias_level(struct snd_soc_component *component,\n\t\t\t\t enum snd_soc_bias_level level)\n{\n\tswitch (level) {\n\tcase SND_SOC_BIAS_ON:\n\tcase SND_SOC_BIAS_PREPARE:\n\t\tbreak;\n\tcase SND_SOC_BIAS_STANDBY:\n\t\tif (snd_soc_component_get_bias_level(component) == SND_SOC_BIAS_OFF) {\n\t\t\t \n\t\t\tsnd_soc_component_update_bits(component, DA9055_REFERENCES,\n\t\t\t\t\t    DA9055_VMID_EN | DA9055_BIAS_EN,\n\t\t\t\t\t    DA9055_VMID_EN | DA9055_BIAS_EN);\n\t\t}\n\t\tbreak;\n\tcase SND_SOC_BIAS_OFF:\n\t\t \n\t\tsnd_soc_component_update_bits(component, DA9055_REFERENCES,\n\t\t\t\t    DA9055_VMID_EN | DA9055_BIAS_EN, 0);\n\t\tbreak;\n\t}\n\treturn 0;\n}\n\nstatic int da9055_probe(struct snd_soc_component *component)\n{\n\tstruct da9055_priv *da9055 = snd_soc_component_get_drvdata(component);\n\n\t \n\tsnd_soc_component_update_bits(component, DA9055_AUX_L_CTRL,\n\t\t\t    DA9055_GAIN_RAMPING_EN, DA9055_GAIN_RAMPING_EN);\n\tsnd_soc_component_update_bits(component, DA9055_AUX_R_CTRL,\n\t\t\t    DA9055_GAIN_RAMPING_EN, DA9055_GAIN_RAMPING_EN);\n\tsnd_soc_component_update_bits(component, DA9055_MIXIN_L_CTRL,\n\t\t\t    DA9055_GAIN_RAMPING_EN, DA9055_GAIN_RAMPING_EN);\n\tsnd_soc_component_update_bits(component, DA9055_MIXIN_R_CTRL,\n\t\t\t    DA9055_GAIN_RAMPING_EN, DA9055_GAIN_RAMPING_EN);\n\tsnd_soc_component_update_bits(component, DA9055_ADC_L_CTRL,\n\t\t\t    DA9055_GAIN_RAMPING_EN, DA9055_GAIN_RAMPING_EN);\n\tsnd_soc_component_update_bits(component, DA9055_ADC_R_CTRL,\n\t\t\t    DA9055_GAIN_RAMPING_EN, DA9055_GAIN_RAMPING_EN);\n\tsnd_soc_component_update_bits(component, DA9055_DAC_L_CTRL,\n\t\t\t    DA9055_GAIN_RAMPING_EN, DA9055_GAIN_RAMPING_EN);\n\tsnd_soc_component_update_bits(component, DA9055_DAC_R_CTRL,\n\t\t\t    DA9055_GAIN_RAMPING_EN, DA9055_GAIN_RAMPING_EN);\n\tsnd_soc_component_update_bits(component, DA9055_HP_L_CTRL,\n\t\t\t    DA9055_GAIN_RAMPING_EN, DA9055_GAIN_RAMPING_EN);\n\tsnd_soc_component_update_bits(component, DA9055_HP_R_CTRL,\n\t\t\t    DA9055_GAIN_RAMPING_EN, DA9055_GAIN_RAMPING_EN);\n\tsnd_soc_component_update_bits(component, DA9055_LINE_CTRL,\n\t\t\t    DA9055_GAIN_RAMPING_EN, DA9055_GAIN_RAMPING_EN);\n\n\t \n\tsnd_soc_component_update_bits(component, DA9055_MIXIN_L_CTRL,\n\t\t\t    DA9055_MIXIN_L_MIX_EN, DA9055_MIXIN_L_MIX_EN);\n\tsnd_soc_component_update_bits(component, DA9055_MIXIN_R_CTRL,\n\t\t\t    DA9055_MIXIN_R_MIX_EN, DA9055_MIXIN_R_MIX_EN);\n\n\tsnd_soc_component_update_bits(component, DA9055_MIXOUT_L_CTRL,\n\t\t\t    DA9055_MIXOUT_L_MIX_EN, DA9055_MIXOUT_L_MIX_EN);\n\tsnd_soc_component_update_bits(component, DA9055_MIXOUT_R_CTRL,\n\t\t\t    DA9055_MIXOUT_R_MIX_EN, DA9055_MIXOUT_R_MIX_EN);\n\n\t \n\tsnd_soc_component_write(component, DA9055_PLL_CTRL, DA9055_PLL_INDIV_10_20_MHZ);\n\n\t \n\tif (da9055->pdata) {\n\t\t \n\t\tif (da9055->pdata->micbias_source) {\n\t\t\tsnd_soc_component_update_bits(component, DA9055_MIXIN_R_SELECT,\n\t\t\t\t\t    DA9055_MICBIAS2_EN,\n\t\t\t\t\t    DA9055_MICBIAS2_EN);\n\t\t} else {\n\t\t\tsnd_soc_component_update_bits(component, DA9055_MIXIN_R_SELECT,\n\t\t\t\t\t    DA9055_MICBIAS2_EN, 0);\n\t\t}\n\t\t \n\t\tswitch (da9055->pdata->micbias) {\n\t\tcase DA9055_MICBIAS_2_2V:\n\t\tcase DA9055_MICBIAS_2_1V:\n\t\tcase DA9055_MICBIAS_1_8V:\n\t\tcase DA9055_MICBIAS_1_6V:\n\t\t\tsnd_soc_component_update_bits(component, DA9055_MIC_CONFIG,\n\t\t\t\t\t    DA9055_MICBIAS_LEVEL_MASK,\n\t\t\t\t\t    (da9055->pdata->micbias) << 4);\n\t\t\tbreak;\n\t\t}\n\t}\n\treturn 0;\n}\n\nstatic const struct snd_soc_component_driver soc_component_dev_da9055 = {\n\t.probe\t\t\t= da9055_probe,\n\t.set_bias_level\t\t= da9055_set_bias_level,\n\t.controls\t\t= da9055_snd_controls,\n\t.num_controls\t\t= ARRAY_SIZE(da9055_snd_controls),\n\t.dapm_widgets\t\t= da9055_dapm_widgets,\n\t.num_dapm_widgets\t= ARRAY_SIZE(da9055_dapm_widgets),\n\t.dapm_routes\t\t= da9055_audio_map,\n\t.num_dapm_routes\t= ARRAY_SIZE(da9055_audio_map),\n\t.idle_bias_on\t\t= 1,\n\t.use_pmdown_time\t= 1,\n\t.endianness\t\t= 1,\n};\n\nstatic const struct regmap_config da9055_regmap_config = {\n\t.reg_bits = 8,\n\t.val_bits = 8,\n\n\t.reg_defaults = da9055_reg_defaults,\n\t.num_reg_defaults = ARRAY_SIZE(da9055_reg_defaults),\n\t.volatile_reg = da9055_volatile_register,\n\t.cache_type = REGCACHE_RBTREE,\n};\n\nstatic int da9055_i2c_probe(struct i2c_client *i2c)\n{\n\tstruct da9055_priv *da9055;\n\tstruct da9055_platform_data *pdata = dev_get_platdata(&i2c->dev);\n\tint ret;\n\n\tda9055 = devm_kzalloc(&i2c->dev, sizeof(struct da9055_priv),\n\t\t\t      GFP_KERNEL);\n\tif (!da9055)\n\t\treturn -ENOMEM;\n\n\tif (pdata)\n\t\tda9055->pdata = pdata;\n\n\ti2c_set_clientdata(i2c, da9055);\n\n\tda9055->regmap = devm_regmap_init_i2c(i2c, &da9055_regmap_config);\n\tif (IS_ERR(da9055->regmap)) {\n\t\tret = PTR_ERR(da9055->regmap);\n\t\tdev_err(&i2c->dev, \"regmap_init() failed: %d\\n\", ret);\n\t\treturn ret;\n\t}\n\n\tret = devm_snd_soc_register_component(&i2c->dev,\n\t\t\t&soc_component_dev_da9055, &da9055_dai, 1);\n\tif (ret < 0) {\n\t\tdev_err(&i2c->dev, \"Failed to register da9055 component: %d\\n\",\n\t\t\tret);\n\t}\n\treturn ret;\n}\n\n \nstatic const struct i2c_device_id da9055_i2c_id[] = {\n\t{ \"da9055-codec\", 0 },\n\t{ }\n};\nMODULE_DEVICE_TABLE(i2c, da9055_i2c_id);\n\n#ifdef CONFIG_OF\nstatic const struct of_device_id da9055_of_match[] = {\n\t{ .compatible = \"dlg,da9055-codec\", },\n\t{ }\n};\nMODULE_DEVICE_TABLE(of, da9055_of_match);\n#endif\n\n \nstatic struct i2c_driver da9055_i2c_driver = {\n\t.driver = {\n\t\t.name = \"da9055-codec\",\n\t\t.of_match_table = of_match_ptr(da9055_of_match),\n\t},\n\t.probe\t\t= da9055_i2c_probe,\n\t.id_table\t= da9055_i2c_id,\n};\n\nmodule_i2c_driver(da9055_i2c_driver);\n\nMODULE_DESCRIPTION(\"ASoC DA9055 Codec driver\");\nMODULE_AUTHOR(\"David Chen, Ashish Chavan\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}