{
  "module_name": "simple-amplifier.c",
  "hash_id": "cb63bec978500a8ff6234f2c8e26ffef95f8d439fc66d67cc0692457827d2504",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/codecs/simple-amplifier.c",
  "human_readable_source": "\n \n\n#include <linux/gpio/consumer.h>\n#include <linux/module.h>\n#include <linux/regulator/consumer.h>\n#include <sound/soc.h>\n\n#define DRV_NAME \"simple-amplifier\"\n\nstruct simple_amp {\n\tstruct gpio_desc *gpiod_enable;\n};\n\nstatic int drv_event(struct snd_soc_dapm_widget *w,\n\t\t     struct snd_kcontrol *control, int event)\n{\n\tstruct snd_soc_component *c = snd_soc_dapm_to_component(w->dapm);\n\tstruct simple_amp *priv = snd_soc_component_get_drvdata(c);\n\tint val;\n\n\tswitch (event) {\n\tcase SND_SOC_DAPM_POST_PMU:\n\t\tval = 1;\n\t\tbreak;\n\tcase SND_SOC_DAPM_PRE_PMD:\n\t\tval = 0;\n\t\tbreak;\n\tdefault:\n\t\tWARN(1, \"Unexpected event\");\n\t\treturn -EINVAL;\n\t}\n\n\tgpiod_set_value_cansleep(priv->gpiod_enable, val);\n\n\treturn 0;\n}\n\nstatic const struct snd_soc_dapm_widget simple_amp_dapm_widgets[] = {\n\tSND_SOC_DAPM_INPUT(\"INL\"),\n\tSND_SOC_DAPM_INPUT(\"INR\"),\n\tSND_SOC_DAPM_OUT_DRV_E(\"DRV\", SND_SOC_NOPM, 0, 0, NULL, 0, drv_event,\n\t\t\t       (SND_SOC_DAPM_POST_PMU | SND_SOC_DAPM_PRE_PMD)),\n\tSND_SOC_DAPM_OUTPUT(\"OUTL\"),\n\tSND_SOC_DAPM_OUTPUT(\"OUTR\"),\n\tSND_SOC_DAPM_REGULATOR_SUPPLY(\"VCC\", 20, 0),\n};\n\nstatic const struct snd_soc_dapm_route simple_amp_dapm_routes[] = {\n\t{ \"DRV\", NULL, \"INL\" },\n\t{ \"DRV\", NULL, \"INR\" },\n\t{ \"OUTL\", NULL, \"VCC\" },\n\t{ \"OUTR\", NULL, \"VCC\" },\n\t{ \"OUTL\", NULL, \"DRV\" },\n\t{ \"OUTR\", NULL, \"DRV\" },\n};\n\nstatic const struct snd_soc_component_driver simple_amp_component_driver = {\n\t.dapm_widgets\t\t= simple_amp_dapm_widgets,\n\t.num_dapm_widgets\t= ARRAY_SIZE(simple_amp_dapm_widgets),\n\t.dapm_routes\t\t= simple_amp_dapm_routes,\n\t.num_dapm_routes\t= ARRAY_SIZE(simple_amp_dapm_routes),\n};\n\nstatic int simple_amp_probe(struct platform_device *pdev)\n{\n\tstruct device *dev = &pdev->dev;\n\tstruct simple_amp *priv;\n\n\tpriv = devm_kzalloc(dev, sizeof(*priv), GFP_KERNEL);\n\tif (priv == NULL)\n\t\treturn -ENOMEM;\n\tplatform_set_drvdata(pdev, priv);\n\n\tpriv->gpiod_enable = devm_gpiod_get_optional(dev, \"enable\",\n\t\t\t\t\t\t     GPIOD_OUT_LOW);\n\tif (IS_ERR(priv->gpiod_enable))\n\t\treturn dev_err_probe(dev, PTR_ERR(priv->gpiod_enable),\n\t\t\t\t     \"Failed to get 'enable' gpio\");\n\n\treturn devm_snd_soc_register_component(dev,\n\t\t\t\t\t       &simple_amp_component_driver,\n\t\t\t\t\t       NULL, 0);\n}\n\n#ifdef CONFIG_OF\nstatic const struct of_device_id simple_amp_ids[] = {\n\t{ .compatible = \"dioo,dio2125\", },\n\t{ .compatible = \"simple-audio-amplifier\", },\n\t{ }\n};\nMODULE_DEVICE_TABLE(of, simple_amp_ids);\n#endif\n\nstatic struct platform_driver simple_amp_driver = {\n\t.driver = {\n\t\t.name = DRV_NAME,\n\t\t.of_match_table = of_match_ptr(simple_amp_ids),\n\t},\n\t.probe = simple_amp_probe,\n};\n\nmodule_platform_driver(simple_amp_driver);\n\nMODULE_DESCRIPTION(\"ASoC Simple Audio Amplifier driver\");\nMODULE_AUTHOR(\"Jerome Brunet <jbrunet@baylibre.com>\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}