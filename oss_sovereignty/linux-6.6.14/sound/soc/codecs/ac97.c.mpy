{
  "module_name": "ac97.c",
  "hash_id": "5a6feecd44502a94b4e02acfd68ef524e45ed8a511e3106db4eb31689af0e2ad",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/codecs/ac97.c",
  "human_readable_source": "\n \n\n#include <linux/init.h>\n#include <linux/slab.h>\n#include <linux/kernel.h>\n#include <linux/device.h>\n#include <linux/module.h>\n#include <sound/core.h>\n#include <sound/pcm.h>\n#include <sound/ac97_codec.h>\n#include <sound/initval.h>\n#include <sound/soc.h>\n\nstatic const struct snd_soc_dapm_widget ac97_widgets[] = {\n\tSND_SOC_DAPM_INPUT(\"RX\"),\n\tSND_SOC_DAPM_OUTPUT(\"TX\"),\n};\n\nstatic const struct snd_soc_dapm_route ac97_routes[] = {\n\t{ \"AC97 Capture\", NULL, \"RX\" },\n\t{ \"TX\", NULL, \"AC97 Playback\" },\n};\n\nstatic int ac97_prepare(struct snd_pcm_substream *substream,\n\t\t\tstruct snd_soc_dai *dai)\n{\n\tstruct snd_soc_component *component = dai->component;\n\tstruct snd_ac97 *ac97 = snd_soc_component_get_drvdata(component);\n\n\tint reg = (substream->stream == SNDRV_PCM_STREAM_PLAYBACK) ?\n\t\t  AC97_PCM_FRONT_DAC_RATE : AC97_PCM_LR_ADC_RATE;\n\treturn snd_ac97_set_rate(ac97, reg, substream->runtime->rate);\n}\n\nstatic const struct snd_soc_dai_ops ac97_dai_ops = {\n\t.prepare\t= ac97_prepare,\n};\n\nstatic struct snd_soc_dai_driver ac97_dai = {\n\t.name = \"ac97-hifi\",\n\t.playback = {\n\t\t.stream_name = \"AC97 Playback\",\n\t\t.channels_min = 1,\n\t\t.channels_max = 2,\n\t\t.rates = SNDRV_PCM_RATE_KNOT,\n\t\t.formats = SND_SOC_STD_AC97_FMTS,},\n\t.capture = {\n\t\t.stream_name = \"AC97 Capture\",\n\t\t.channels_min = 1,\n\t\t.channels_max = 2,\n\t\t.rates = SNDRV_PCM_RATE_KNOT,\n\t\t.formats = SND_SOC_STD_AC97_FMTS,},\n\t.ops = &ac97_dai_ops,\n};\n\nstatic int ac97_soc_probe(struct snd_soc_component *component)\n{\n\tstruct snd_ac97 *ac97;\n\tstruct snd_ac97_bus *ac97_bus;\n\tstruct snd_ac97_template ac97_template;\n\tint ret;\n\n\t \n\tret = snd_ac97_bus(component->card->snd_card, 0, soc_ac97_ops,\n\t\t\t   NULL, &ac97_bus);\n\tif (ret < 0)\n\t\treturn ret;\n\n\tmemset(&ac97_template, 0, sizeof(struct snd_ac97_template));\n\tret = snd_ac97_mixer(ac97_bus, &ac97_template, &ac97);\n\tif (ret < 0)\n\t\treturn ret;\n\n\tsnd_soc_component_set_drvdata(component, ac97);\n\n\treturn 0;\n}\n\n#ifdef CONFIG_PM\nstatic int ac97_soc_suspend(struct snd_soc_component *component)\n{\n\tstruct snd_ac97 *ac97 = snd_soc_component_get_drvdata(component);\n\n\tsnd_ac97_suspend(ac97);\n\n\treturn 0;\n}\n\nstatic int ac97_soc_resume(struct snd_soc_component *component)\n{\n\n\tstruct snd_ac97 *ac97 = snd_soc_component_get_drvdata(component);\n\n\tsnd_ac97_resume(ac97);\n\n\treturn 0;\n}\n#else\n#define ac97_soc_suspend NULL\n#define ac97_soc_resume NULL\n#endif\n\nstatic const struct snd_soc_component_driver soc_component_dev_ac97 = {\n\t.probe\t\t\t= ac97_soc_probe,\n\t.suspend\t\t= ac97_soc_suspend,\n\t.resume\t\t\t= ac97_soc_resume,\n\t.dapm_widgets\t\t= ac97_widgets,\n\t.num_dapm_widgets\t= ARRAY_SIZE(ac97_widgets),\n\t.dapm_routes\t\t= ac97_routes,\n\t.num_dapm_routes\t= ARRAY_SIZE(ac97_routes),\n\t.idle_bias_on\t\t= 1,\n\t.use_pmdown_time\t= 1,\n\t.endianness\t\t= 1,\n};\n\nstatic int ac97_probe(struct platform_device *pdev)\n{\n\treturn devm_snd_soc_register_component(&pdev->dev,\n\t\t\t&soc_component_dev_ac97, &ac97_dai, 1);\n}\n\nstatic struct platform_driver ac97_codec_driver = {\n\t.driver = {\n\t\t.name = \"ac97-codec\",\n\t},\n\n\t.probe = ac97_probe,\n};\n\nmodule_platform_driver(ac97_codec_driver);\n\nMODULE_DESCRIPTION(\"Soc Generic AC97 driver\");\nMODULE_AUTHOR(\"Liam Girdwood\");\nMODULE_LICENSE(\"GPL\");\nMODULE_ALIAS(\"platform:ac97-codec\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}