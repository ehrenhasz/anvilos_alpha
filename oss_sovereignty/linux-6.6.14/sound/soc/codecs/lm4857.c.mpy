{
  "module_name": "lm4857.c",
  "hash_id": "22e0bc9e49ebb3c668b926acb27760822176ada9fc61f3a1b8e48f84897ab4df",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/codecs/lm4857.c",
  "human_readable_source": "\n \n\n#include <linux/init.h>\n#include <linux/module.h>\n#include <linux/i2c.h>\n#include <linux/regmap.h>\n#include <linux/slab.h>\n\n#include <sound/core.h>\n#include <sound/soc.h>\n#include <sound/tlv.h>\n\nstatic const struct reg_default lm4857_default_regs[] = {\n\t{ 0x0, 0x00 },\n\t{ 0x1, 0x00 },\n\t{ 0x2, 0x00 },\n\t{ 0x3, 0x00 },\n};\n\n \n#define LM4857_MVOL 0\n#define LM4857_LVOL 1\n#define LM4857_RVOL 2\n#define LM4857_CTRL 3\n\n \n#define LM4857_3D 5\n#define LM4857_WAKEUP 5\n#define LM4857_EPGAIN 4\n\nstatic const unsigned int lm4857_mode_values[] = {\n\t0,\n\t6,\n\t7,\n\t8,\n\t9,\n};\n\nstatic const char * const lm4857_mode_texts[] = {\n\t\"Off\",\n\t\"Earpiece\",\n\t\"Loudspeaker\",\n\t\"Loudspeaker + Headphone\",\n\t\"Headphone\",\n};\n\nstatic SOC_VALUE_ENUM_SINGLE_AUTODISABLE_DECL(lm4857_mode_enum,\n\tLM4857_CTRL, 0, 0xf, lm4857_mode_texts, lm4857_mode_values);\n\nstatic const struct snd_kcontrol_new lm4857_mode_ctrl =\n\tSOC_DAPM_ENUM(\"Mode\", lm4857_mode_enum);\n\nstatic const struct snd_soc_dapm_widget lm4857_dapm_widgets[] = {\n\tSND_SOC_DAPM_INPUT(\"IN\"),\n\n\tSND_SOC_DAPM_DEMUX(\"Mode\", SND_SOC_NOPM, 0, 0, &lm4857_mode_ctrl),\n\n\tSND_SOC_DAPM_OUTPUT(\"LS\"),\n\tSND_SOC_DAPM_OUTPUT(\"HP\"),\n\tSND_SOC_DAPM_OUTPUT(\"EP\"),\n};\n\nstatic const DECLARE_TLV_DB_SCALE(stereo_tlv, -4050, 150, 0);\nstatic const DECLARE_TLV_DB_SCALE(mono_tlv, -3450, 150, 0);\n\nstatic const struct snd_kcontrol_new lm4857_controls[] = {\n\tSOC_SINGLE_TLV(\"Left Playback Volume\", LM4857_LVOL, 0, 31, 0,\n\t\tstereo_tlv),\n\tSOC_SINGLE_TLV(\"Right Playback Volume\", LM4857_RVOL, 0, 31, 0,\n\t\tstereo_tlv),\n\tSOC_SINGLE_TLV(\"Mono Playback Volume\", LM4857_MVOL, 0, 31, 0,\n\t\tmono_tlv),\n\tSOC_SINGLE(\"Spk 3D Playback Switch\", LM4857_LVOL, LM4857_3D, 1, 0),\n\tSOC_SINGLE(\"HP 3D Playback Switch\", LM4857_RVOL, LM4857_3D, 1, 0),\n\tSOC_SINGLE(\"Fast Wakeup Playback Switch\", LM4857_CTRL,\n\t\tLM4857_WAKEUP, 1, 0),\n\tSOC_SINGLE(\"Earpiece 6dB Playback Switch\", LM4857_CTRL,\n\t\tLM4857_EPGAIN, 1, 0),\n};\n\nstatic const struct snd_soc_dapm_route lm4857_routes[] = {\n\t{ \"Mode\", NULL, \"IN\" },\n\t{ \"LS\", \"Loudspeaker\", \"Mode\" },\n\t{ \"LS\", \"Loudspeaker + Headphone\", \"Mode\" },\n\t{ \"HP\", \"Headphone\", \"Mode\" },\n\t{ \"HP\", \"Loudspeaker + Headphone\", \"Mode\" },\n\t{ \"EP\", \"Earpiece\", \"Mode\" },\n};\n\nstatic const struct snd_soc_component_driver lm4857_component_driver = {\n\t.controls = lm4857_controls,\n\t.num_controls = ARRAY_SIZE(lm4857_controls),\n\t.dapm_widgets = lm4857_dapm_widgets,\n\t.num_dapm_widgets = ARRAY_SIZE(lm4857_dapm_widgets),\n\t.dapm_routes = lm4857_routes,\n\t.num_dapm_routes = ARRAY_SIZE(lm4857_routes),\n};\n\nstatic const struct regmap_config lm4857_regmap_config = {\n\t.val_bits = 6,\n\t.reg_bits = 2,\n\n\t.max_register = LM4857_CTRL,\n\n\t.cache_type = REGCACHE_FLAT,\n\t.reg_defaults = lm4857_default_regs,\n\t.num_reg_defaults = ARRAY_SIZE(lm4857_default_regs),\n};\n\nstatic int lm4857_i2c_probe(struct i2c_client *i2c)\n{\n\tstruct regmap *regmap;\n\n\tregmap = devm_regmap_init_i2c(i2c, &lm4857_regmap_config);\n\tif (IS_ERR(regmap))\n\t\treturn PTR_ERR(regmap);\n\n\treturn devm_snd_soc_register_component(&i2c->dev,\n\t\t&lm4857_component_driver, NULL, 0);\n}\n\nstatic const struct i2c_device_id lm4857_i2c_id[] = {\n\t{ \"lm4857\", 0 },\n\t{ }\n};\nMODULE_DEVICE_TABLE(i2c, lm4857_i2c_id);\n\nstatic struct i2c_driver lm4857_i2c_driver = {\n\t.driver = {\n\t\t.name = \"lm4857\",\n\t},\n\t.probe = lm4857_i2c_probe,\n\t.id_table = lm4857_i2c_id,\n};\n\nmodule_i2c_driver(lm4857_i2c_driver);\n\nMODULE_AUTHOR(\"Lars-Peter Clausen <lars@metafoo.de>\");\nMODULE_DESCRIPTION(\"LM4857 amplifier driver\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}