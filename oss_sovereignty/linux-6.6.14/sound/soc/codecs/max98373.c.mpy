{
  "module_name": "max98373.c",
  "hash_id": "a4ca62b57e8953690daa996c0f63fca56728ddf289d2fc76420993f7e3c7df57",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/codecs/max98373.c",
  "human_readable_source": "\n\n\n#include <linux/acpi.h>\n#include <linux/delay.h>\n#include <linux/i2c.h>\n#include <linux/module.h>\n#include <linux/pm_runtime.h>\n#include <linux/regmap.h>\n#include <linux/slab.h>\n#include <linux/cdev.h>\n#include <sound/pcm.h>\n#include <sound/pcm_params.h>\n#include <sound/soc.h>\n#include <linux/gpio.h>\n#include <linux/of.h>\n#include <linux/of_gpio.h>\n#include <sound/tlv.h>\n#include \"max98373.h\"\n\nstatic int max98373_dac_event(struct snd_soc_dapm_widget *w,\n\tstruct snd_kcontrol *kcontrol, int event)\n{\n\tstruct snd_soc_component *component = snd_soc_dapm_to_component(w->dapm);\n\tstruct max98373_priv *max98373 = snd_soc_component_get_drvdata(component);\n\n\tswitch (event) {\n\tcase SND_SOC_DAPM_POST_PMU:\n\t\tregmap_update_bits(max98373->regmap,\n\t\t\tMAX98373_R20FF_GLOBAL_SHDN,\n\t\t\tMAX98373_GLOBAL_EN_MASK, 1);\n\t\tusleep_range(30000, 31000);\n\t\tbreak;\n\tcase SND_SOC_DAPM_PRE_PMD:\n\t\tregmap_update_bits(max98373->regmap,\n\t\t\tMAX98373_R20FF_GLOBAL_SHDN,\n\t\t\tMAX98373_GLOBAL_EN_MASK, 0);\n\t\tusleep_range(30000, 31000);\n\t\tmax98373->tdm_mode = false;\n\t\tbreak;\n\tdefault:\n\t\treturn 0;\n\t}\n\treturn 0;\n}\n\nstatic const char * const max98373_switch_text[] = {\n\t\"Left\", \"Right\", \"LeftRight\"};\n\nstatic const struct soc_enum dai_sel_enum =\n\tSOC_ENUM_SINGLE(MAX98373_R2029_PCM_TO_SPK_MONO_MIX_1,\n\t\tMAX98373_PCM_TO_SPK_MONOMIX_CFG_SHIFT,\n\t\t3, max98373_switch_text);\n\nstatic const struct snd_kcontrol_new max98373_dai_controls =\n\tSOC_DAPM_ENUM(\"DAI Sel\", dai_sel_enum);\n\nstatic const struct snd_kcontrol_new max98373_vi_control =\n\tSOC_DAPM_SINGLE(\"Switch\", MAX98373_R202C_PCM_TX_EN, 0, 1, 0);\n\nstatic const struct snd_kcontrol_new max98373_spkfb_control =\n\tSOC_DAPM_SINGLE(\"Switch\", MAX98373_R2043_AMP_EN, 1, 1, 0);\n\nstatic const struct snd_soc_dapm_widget max98373_dapm_widgets[] = {\nSND_SOC_DAPM_DAC_E(\"Amp Enable\", \"HiFi Playback\",\n\tMAX98373_R202B_PCM_RX_EN, 0, 0, max98373_dac_event,\n\tSND_SOC_DAPM_POST_PMU | SND_SOC_DAPM_PRE_PMD),\nSND_SOC_DAPM_MUX(\"DAI Sel Mux\", SND_SOC_NOPM, 0, 0,\n\t&max98373_dai_controls),\nSND_SOC_DAPM_OUTPUT(\"BE_OUT\"),\nSND_SOC_DAPM_AIF_OUT(\"Voltage Sense\", \"HiFi Capture\", 0,\n\tMAX98373_R2047_IV_SENSE_ADC_EN, 0, 0),\nSND_SOC_DAPM_AIF_OUT(\"Current Sense\", \"HiFi Capture\", 0,\n\tMAX98373_R2047_IV_SENSE_ADC_EN, 1, 0),\nSND_SOC_DAPM_AIF_OUT(\"Speaker FB Sense\", \"HiFi Capture\", 0,\n\tSND_SOC_NOPM, 0, 0),\nSND_SOC_DAPM_SWITCH(\"VI Sense\", SND_SOC_NOPM, 0, 0,\n\t&max98373_vi_control),\nSND_SOC_DAPM_SWITCH(\"SpkFB Sense\", SND_SOC_NOPM, 0, 0,\n\t&max98373_spkfb_control),\nSND_SOC_DAPM_SIGGEN(\"VMON\"),\nSND_SOC_DAPM_SIGGEN(\"IMON\"),\nSND_SOC_DAPM_SIGGEN(\"FBMON\"),\n};\n\nstatic DECLARE_TLV_DB_SCALE(max98373_digital_tlv, -6350, 50, 1);\nstatic const DECLARE_TLV_DB_RANGE(max98373_spk_tlv,\n\t0, 8, TLV_DB_SCALE_ITEM(0, 50, 0),\n\t9, 10, TLV_DB_SCALE_ITEM(500, 100, 0),\n);\nstatic const DECLARE_TLV_DB_RANGE(max98373_spkgain_max_tlv,\n\t0, 9, TLV_DB_SCALE_ITEM(800, 100, 0),\n);\nstatic const DECLARE_TLV_DB_RANGE(max98373_dht_step_size_tlv,\n\t0, 1, TLV_DB_SCALE_ITEM(25, 25, 0),\n\t2, 4, TLV_DB_SCALE_ITEM(100, 100, 0),\n);\nstatic const DECLARE_TLV_DB_RANGE(max98373_dht_spkgain_min_tlv,\n\t0, 9, TLV_DB_SCALE_ITEM(800, 100, 0),\n);\nstatic const DECLARE_TLV_DB_RANGE(max98373_dht_rotation_point_tlv,\n\t0, 1, TLV_DB_SCALE_ITEM(-3000, 500, 0),\n\t2, 4, TLV_DB_SCALE_ITEM(-2200, 200, 0),\n\t5, 6, TLV_DB_SCALE_ITEM(-1500, 300, 0),\n\t7, 9, TLV_DB_SCALE_ITEM(-1000, 200, 0),\n\t10, 13, TLV_DB_SCALE_ITEM(-500, 100, 0),\n\t14, 15, TLV_DB_SCALE_ITEM(-100, 50, 0),\n);\nstatic const DECLARE_TLV_DB_RANGE(max98373_limiter_thresh_tlv,\n\t0, 15, TLV_DB_SCALE_ITEM(-1500, 100, 0),\n);\n\nstatic const DECLARE_TLV_DB_RANGE(max98373_bde_gain_tlv,\n\t0, 60, TLV_DB_SCALE_ITEM(-1500, 25, 0),\n);\n\nstatic const char * const max98373_output_voltage_lvl_text[] = {\n\t\"5.43V\", \"6.09V\", \"6.83V\", \"7.67V\", \"8.60V\",\n\t\"9.65V\", \"10.83V\", \"12.15V\", \"13.63V\", \"15.29V\"\n};\n\nstatic SOC_ENUM_SINGLE_DECL(max98373_out_volt_enum,\n\t\t\t    MAX98373_R203E_AMP_PATH_GAIN, 0,\n\t\t\t    max98373_output_voltage_lvl_text);\n\nstatic const char * const max98373_dht_attack_rate_text[] = {\n\t\"17.5us\", \"35us\", \"70us\", \"140us\",\n\t\"280us\", \"560us\", \"1120us\", \"2240us\"\n};\n\nstatic SOC_ENUM_SINGLE_DECL(max98373_dht_attack_rate_enum,\n\t\t\t    MAX98373_R20D2_DHT_ATTACK_CFG, 0,\n\t\t\t    max98373_dht_attack_rate_text);\n\nstatic const char * const max98373_dht_release_rate_text[] = {\n\t\"45ms\", \"225ms\", \"450ms\", \"1150ms\",\n\t\"2250ms\", \"3100ms\", \"4500ms\", \"6750ms\"\n};\n\nstatic SOC_ENUM_SINGLE_DECL(max98373_dht_release_rate_enum,\n\t\t\t    MAX98373_R20D3_DHT_RELEASE_CFG, 0,\n\t\t\t    max98373_dht_release_rate_text);\n\nstatic const char * const max98373_limiter_attack_rate_text[] = {\n\t\"10us\", \"20us\", \"40us\", \"80us\",\n\t\"160us\", \"320us\", \"640us\", \"1.28ms\",\n\t\"2.56ms\", \"5.12ms\", \"10.24ms\", \"20.48ms\",\n\t\"40.96ms\", \"81.92ms\", \"16.384ms\", \"32.768ms\"\n};\n\nstatic SOC_ENUM_SINGLE_DECL(max98373_limiter_attack_rate_enum,\n\t\t\t    MAX98373_R20E1_LIMITER_ATK_REL_RATES, 4,\n\t\t\t    max98373_limiter_attack_rate_text);\n\nstatic const char * const max98373_limiter_release_rate_text[] = {\n\t\"40us\", \"80us\", \"160us\", \"320us\",\n\t\"640us\", \"1.28ms\", \"2.56ms\", \"5.120ms\",\n\t\"10.24ms\", \"20.48ms\", \"40.96ms\", \"81.92ms\",\n\t\"163.84ms\", \"327.68ms\", \"655.36ms\", \"1310.72ms\"\n};\n\nstatic SOC_ENUM_SINGLE_DECL(max98373_limiter_release_rate_enum,\n\t\t\t    MAX98373_R20E1_LIMITER_ATK_REL_RATES, 0,\n\t\t\t    max98373_limiter_release_rate_text);\n\nstatic const char * const max98373_ADC_samplerate_text[] = {\n\t\"333kHz\", \"192kHz\", \"64kHz\", \"48kHz\"\n};\n\nstatic SOC_ENUM_SINGLE_DECL(max98373_adc_samplerate_enum,\n\t\t\t    MAX98373_R2051_MEAS_ADC_SAMPLING_RATE, 0,\n\t\t\t    max98373_ADC_samplerate_text);\n\nstatic int max98373_feedback_get(struct snd_kcontrol *kcontrol,\n\t\t\t\t struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct snd_soc_component *component = snd_kcontrol_chip(kcontrol);\n\tstruct soc_mixer_control *mc =\n\t\t(struct soc_mixer_control *)kcontrol->private_value;\n\tstruct max98373_priv *max98373 = snd_soc_component_get_drvdata(component);\n\tint i;\n\n\tif (snd_soc_component_get_bias_level(component) == SND_SOC_BIAS_OFF) {\n\t\t \n\t\tfor (i = 0; i < max98373->cache_num; i++) {\n\t\t\tif (mc->reg == max98373->cache[i].reg) {\n\t\t\t\tucontrol->value.integer.value[0] = max98373->cache[i].val;\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn snd_soc_get_volsw(kcontrol, ucontrol);\n}\n\nstatic const struct snd_kcontrol_new max98373_snd_controls[] = {\nSOC_SINGLE(\"Digital Vol Sel Switch\", MAX98373_R203F_AMP_DSP_CFG,\n\tMAX98373_AMP_VOL_SEL_SHIFT, 1, 0),\nSOC_SINGLE(\"Volume Location Switch\", MAX98373_R203F_AMP_DSP_CFG,\n\tMAX98373_AMP_VOL_SEL_SHIFT, 1, 0),\nSOC_SINGLE(\"Ramp Up Switch\", MAX98373_R203F_AMP_DSP_CFG,\n\tMAX98373_AMP_DSP_CFG_RMP_UP_SHIFT, 1, 0),\nSOC_SINGLE(\"Ramp Down Switch\", MAX98373_R203F_AMP_DSP_CFG,\n\tMAX98373_AMP_DSP_CFG_RMP_DN_SHIFT, 1, 0),\n \nSOC_SINGLE(\"OVC Autorestart Switch\", MAX98373_R20FE_DEVICE_AUTO_RESTART_CFG,\n\tMAX98373_OVC_AUTORESTART_SHIFT, 1, 0),\n \nSOC_SINGLE(\"THERM Autorestart Switch\", MAX98373_R20FE_DEVICE_AUTO_RESTART_CFG,\n\tMAX98373_THERM_AUTORESTART_SHIFT, 1, 0),\n \nSOC_SINGLE(\"CMON Autorestart Switch\", MAX98373_R20FE_DEVICE_AUTO_RESTART_CFG,\n\tMAX98373_CMON_AUTORESTART_SHIFT, 1, 0),\nSOC_SINGLE(\"CLK Monitor Switch\", MAX98373_R20FE_DEVICE_AUTO_RESTART_CFG,\n\tMAX98373_CLOCK_MON_SHIFT, 1, 0),\nSOC_SINGLE(\"Dither Switch\", MAX98373_R203F_AMP_DSP_CFG,\n\tMAX98373_AMP_DSP_CFG_DITH_SHIFT, 1, 0),\nSOC_SINGLE(\"DC Blocker Switch\", MAX98373_R203F_AMP_DSP_CFG,\n\tMAX98373_AMP_DSP_CFG_DCBLK_SHIFT, 1, 0),\nSOC_SINGLE_TLV(\"Digital Volume\", MAX98373_R203D_AMP_DIG_VOL_CTRL,\n\t0, 0x7F, 1, max98373_digital_tlv),\nSOC_SINGLE_TLV(\"Speaker Volume\", MAX98373_R203E_AMP_PATH_GAIN,\n\tMAX98373_SPK_DIGI_GAIN_SHIFT, 10, 0, max98373_spk_tlv),\nSOC_SINGLE_TLV(\"FS Max Volume\", MAX98373_R203E_AMP_PATH_GAIN,\n\tMAX98373_FS_GAIN_MAX_SHIFT, 9, 0, max98373_spkgain_max_tlv),\nSOC_ENUM(\"Output Voltage\", max98373_out_volt_enum),\n \nSOC_SINGLE(\"DHT Switch\", MAX98373_R20D4_DHT_EN,\n\tMAX98373_DHT_EN_SHIFT, 1, 0),\nSOC_SINGLE_TLV(\"DHT Min Volume\", MAX98373_R20D1_DHT_CFG,\n\tMAX98373_DHT_SPK_GAIN_MIN_SHIFT, 9, 0, max98373_dht_spkgain_min_tlv),\nSOC_SINGLE_TLV(\"DHT Rot Pnt Volume\", MAX98373_R20D1_DHT_CFG,\n\tMAX98373_DHT_ROT_PNT_SHIFT, 15, 1, max98373_dht_rotation_point_tlv),\nSOC_SINGLE_TLV(\"DHT Attack Step Volume\", MAX98373_R20D2_DHT_ATTACK_CFG,\n\tMAX98373_DHT_ATTACK_STEP_SHIFT, 4, 0, max98373_dht_step_size_tlv),\nSOC_SINGLE_TLV(\"DHT Release Step Volume\", MAX98373_R20D3_DHT_RELEASE_CFG,\n\tMAX98373_DHT_RELEASE_STEP_SHIFT, 4, 0, max98373_dht_step_size_tlv),\nSOC_ENUM(\"DHT Attack Rate\", max98373_dht_attack_rate_enum),\nSOC_ENUM(\"DHT Release Rate\", max98373_dht_release_rate_enum),\n \nSOC_SINGLE(\"ADC PVDD CH Switch\", MAX98373_R2056_MEAS_ADC_PVDD_CH_EN, 0, 1, 0),\nSOC_SINGLE(\"ADC PVDD FLT Switch\", MAX98373_R2052_MEAS_ADC_PVDD_FLT_CFG,\n\tMAX98373_FLT_EN_SHIFT, 1, 0),\nSOC_SINGLE(\"ADC TEMP FLT Switch\", MAX98373_R2053_MEAS_ADC_THERM_FLT_CFG,\n\tMAX98373_FLT_EN_SHIFT, 1, 0),\nSOC_SINGLE_EXT(\"ADC PVDD\", MAX98373_R2054_MEAS_ADC_PVDD_CH_READBACK, 0, 0xFF, 0,\n\tmax98373_feedback_get, NULL),\nSOC_SINGLE_EXT(\"ADC TEMP\", MAX98373_R2055_MEAS_ADC_THERM_CH_READBACK, 0, 0xFF, 0,\n\tmax98373_feedback_get, NULL),\nSOC_SINGLE(\"ADC PVDD FLT Coeff\", MAX98373_R2052_MEAS_ADC_PVDD_FLT_CFG,\n\t0, 0x3, 0),\nSOC_SINGLE(\"ADC TEMP FLT Coeff\", MAX98373_R2053_MEAS_ADC_THERM_FLT_CFG,\n\t0, 0x3, 0),\nSOC_ENUM(\"ADC SampleRate\", max98373_adc_samplerate_enum),\n \nSOC_SINGLE(\"BDE Switch\", MAX98373_R20B5_BDE_EN, MAX98373_BDE_EN_SHIFT, 1, 0),\nSOC_SINGLE(\"BDE LVL4 Mute Switch\", MAX98373_R20B2_BDE_L4_CFG_2,\n\tMAX98373_LVL4_MUTE_EN_SHIFT, 1, 0),\nSOC_SINGLE(\"BDE LVL4 Hold Switch\", MAX98373_R20B2_BDE_L4_CFG_2,\n\tMAX98373_LVL4_HOLD_EN_SHIFT, 1, 0),\nSOC_SINGLE(\"BDE LVL1 Thresh\", MAX98373_R2097_BDE_L1_THRESH, 0, 0xFF, 0),\nSOC_SINGLE(\"BDE LVL2 Thresh\", MAX98373_R2098_BDE_L2_THRESH, 0, 0xFF, 0),\nSOC_SINGLE(\"BDE LVL3 Thresh\", MAX98373_R2099_BDE_L3_THRESH, 0, 0xFF, 0),\nSOC_SINGLE(\"BDE LVL4 Thresh\", MAX98373_R209A_BDE_L4_THRESH, 0, 0xFF, 0),\nSOC_SINGLE_EXT(\"BDE Active Level\", MAX98373_R20B6_BDE_CUR_STATE_READBACK, 0, 8, 0,\n\tmax98373_feedback_get, NULL),\nSOC_SINGLE(\"BDE Clip Mode Switch\", MAX98373_R2092_BDE_CLIPPER_MODE, 0, 1, 0),\nSOC_SINGLE(\"BDE Thresh Hysteresis\", MAX98373_R209B_BDE_THRESH_HYST, 0, 0xFF, 0),\nSOC_SINGLE(\"BDE Hold Time\", MAX98373_R2090_BDE_LVL_HOLD, 0, 0xFF, 0),\nSOC_SINGLE(\"BDE Attack Rate\", MAX98373_R2091_BDE_GAIN_ATK_REL_RATE, 4, 0xF, 0),\nSOC_SINGLE(\"BDE Release Rate\", MAX98373_R2091_BDE_GAIN_ATK_REL_RATE, 0, 0xF, 0),\nSOC_SINGLE_TLV(\"BDE LVL1 Clip Thresh Volume\", MAX98373_R20A9_BDE_L1_CFG_2,\n\t0, 0x3C, 1, max98373_bde_gain_tlv),\nSOC_SINGLE_TLV(\"BDE LVL2 Clip Thresh Volume\", MAX98373_R20AC_BDE_L2_CFG_2,\n\t0, 0x3C, 1, max98373_bde_gain_tlv),\nSOC_SINGLE_TLV(\"BDE LVL3 Clip Thresh Volume\", MAX98373_R20AF_BDE_L3_CFG_2,\n\t0, 0x3C, 1, max98373_bde_gain_tlv),\nSOC_SINGLE_TLV(\"BDE LVL4 Clip Thresh Volume\", MAX98373_R20B2_BDE_L4_CFG_2,\n\t0, 0x3C, 1, max98373_bde_gain_tlv),\nSOC_SINGLE_TLV(\"BDE LVL1 Clip Reduction Volume\", MAX98373_R20AA_BDE_L1_CFG_3,\n\t0, 0x3C, 1, max98373_bde_gain_tlv),\nSOC_SINGLE_TLV(\"BDE LVL2 Clip Reduction Volume\", MAX98373_R20AD_BDE_L2_CFG_3,\n\t0, 0x3C, 1, max98373_bde_gain_tlv),\nSOC_SINGLE_TLV(\"BDE LVL3 Clip Reduction Volume\", MAX98373_R20B0_BDE_L3_CFG_3,\n\t0, 0x3C, 1, max98373_bde_gain_tlv),\nSOC_SINGLE_TLV(\"BDE LVL4 Clip Reduction Volume\", MAX98373_R20B3_BDE_L4_CFG_3,\n\t0, 0x3C, 1, max98373_bde_gain_tlv),\nSOC_SINGLE_TLV(\"BDE LVL1 Limiter Thresh Volume\", MAX98373_R20A8_BDE_L1_CFG_1,\n\t0, 0xF, 1, max98373_limiter_thresh_tlv),\nSOC_SINGLE_TLV(\"BDE LVL2 Limiter Thresh Volume\", MAX98373_R20AB_BDE_L2_CFG_1,\n\t0, 0xF, 1, max98373_limiter_thresh_tlv),\nSOC_SINGLE_TLV(\"BDE LVL3 Limiter Thresh Volume\", MAX98373_R20AE_BDE_L3_CFG_1,\n\t0, 0xF, 1, max98373_limiter_thresh_tlv),\nSOC_SINGLE_TLV(\"BDE LVL4 Limiter Thresh Volume\", MAX98373_R20B1_BDE_L4_CFG_1,\n\t0, 0xF, 1, max98373_limiter_thresh_tlv),\n \nSOC_SINGLE(\"Limiter Switch\", MAX98373_R20E2_LIMITER_EN,\n\tMAX98373_LIMITER_EN_SHIFT, 1, 0),\nSOC_SINGLE(\"Limiter Src Switch\", MAX98373_R20E0_LIMITER_THRESH_CFG,\n\tMAX98373_LIMITER_THRESH_SRC_SHIFT, 1, 0),\nSOC_SINGLE_TLV(\"Limiter Thresh Volume\", MAX98373_R20E0_LIMITER_THRESH_CFG,\n\tMAX98373_LIMITER_THRESH_SHIFT, 15, 0, max98373_limiter_thresh_tlv),\nSOC_ENUM(\"Limiter Attack Rate\", max98373_limiter_attack_rate_enum),\nSOC_ENUM(\"Limiter Release Rate\", max98373_limiter_release_rate_enum),\n};\n\nstatic const struct snd_soc_dapm_route max98373_audio_map[] = {\n\t \n\t{\"DAI Sel Mux\", \"Left\", \"Amp Enable\"},\n\t{\"DAI Sel Mux\", \"Right\", \"Amp Enable\"},\n\t{\"DAI Sel Mux\", \"LeftRight\", \"Amp Enable\"},\n\t{\"BE_OUT\", NULL, \"DAI Sel Mux\"},\n\t \n\t{ \"VI Sense\", \"Switch\", \"VMON\" },\n\t{ \"VI Sense\", \"Switch\", \"IMON\" },\n\t{ \"SpkFB Sense\", \"Switch\", \"FBMON\" },\n\t{ \"Voltage Sense\", NULL, \"VI Sense\" },\n\t{ \"Current Sense\", NULL, \"VI Sense\" },\n\t{ \"Speaker FB Sense\", NULL, \"SpkFB Sense\" },\n};\n\nvoid max98373_reset(struct max98373_priv *max98373, struct device *dev)\n{\n\tint ret, reg, count;\n\n\t \n\tret = regmap_update_bits(max98373->regmap,\n\t\tMAX98373_R2000_SW_RESET,\n\t\tMAX98373_SOFT_RESET,\n\t\tMAX98373_SOFT_RESET);\n\tif (ret)\n\t\tdev_err(dev, \"Reset command failed. (ret:%d)\\n\", ret);\n\n\tcount = 0;\n\twhile (count < 3) {\n\t\tusleep_range(10000, 11000);\n\t\t \n\t\tret = regmap_read(max98373->regmap,\n\t\t\tMAX98373_R21FF_REV_ID, &reg);\n\t\tif (!ret) {\n\t\t\tdev_info(dev, \"Reset completed (retry:%d)\\n\", count);\n\t\t\treturn;\n\t\t}\n\t\tcount++;\n\t}\n\tdev_err(dev, \"Reset failed. (ret:%d)\\n\", ret);\n}\nEXPORT_SYMBOL_GPL(max98373_reset);\n\nstatic int max98373_probe(struct snd_soc_component *component)\n{\n\tstruct max98373_priv *max98373 = snd_soc_component_get_drvdata(component);\n\n\t \n\tmax98373_reset(max98373, component->dev);\n\n\t \n\tregmap_write(max98373->regmap,\n\t\tMAX98373_R2020_PCM_TX_HIZ_EN_1,\n\t\t0xFF);\n\tregmap_write(max98373->regmap,\n\t\tMAX98373_R2021_PCM_TX_HIZ_EN_2,\n\t\t0xFF);\n\t \n\tregmap_write(max98373->regmap,\n\t\tMAX98373_R2029_PCM_TO_SPK_MONO_MIX_1,\n\t\t0x80);\n\tregmap_write(max98373->regmap,\n\t\tMAX98373_R202A_PCM_TO_SPK_MONO_MIX_2,\n\t\t0x1);\n\t \n\tregmap_write(max98373->regmap,\n\t\tMAX98373_R203F_AMP_DSP_CFG,\n\t\t0x3);\n\t \n\tregmap_write(max98373->regmap,\n\t\tMAX98373_R2046_IV_SENSE_ADC_DSP_CFG,\n\t\t0x7);\n\t \n\tregmap_write(max98373->regmap,\n\t\tMAX98373_R2022_PCM_TX_SRC_1,\n\t\t(max98373->i_slot << MAX98373_PCM_TX_CH_SRC_A_I_SHIFT |\n\t\tmax98373->v_slot) & 0xFF);\n\tif (max98373->v_slot < 8)\n\t\tregmap_update_bits(max98373->regmap,\n\t\t\tMAX98373_R2020_PCM_TX_HIZ_EN_1,\n\t\t\t1 << max98373->v_slot, 0);\n\telse\n\t\tregmap_update_bits(max98373->regmap,\n\t\t\tMAX98373_R2021_PCM_TX_HIZ_EN_2,\n\t\t\t1 << (max98373->v_slot - 8), 0);\n\n\tif (max98373->i_slot < 8)\n\t\tregmap_update_bits(max98373->regmap,\n\t\t\tMAX98373_R2020_PCM_TX_HIZ_EN_1,\n\t\t\t1 << max98373->i_slot, 0);\n\telse\n\t\tregmap_update_bits(max98373->regmap,\n\t\t\tMAX98373_R2021_PCM_TX_HIZ_EN_2,\n\t\t\t1 << (max98373->i_slot - 8), 0);\n\n\t \n\tregmap_write(max98373->regmap,\n\t\tMAX98373_R20FE_DEVICE_AUTO_RESTART_CFG,\n\t\t0xF);\n\n\t \n\tregmap_write(max98373->regmap,\n\t\tMAX98373_R2023_PCM_TX_SRC_2,\n\t\tmax98373->spkfb_slot & 0xFF);\n\n\t \n\tif (max98373->interleave_mode)\n\t\tregmap_update_bits(max98373->regmap,\n\t\t\tMAX98373_R2024_PCM_DATA_FMT_CFG,\n\t\t\tMAX98373_PCM_TX_CH_INTERLEAVE_MASK,\n\t\t\tMAX98373_PCM_TX_CH_INTERLEAVE_MASK);\n\n\t \n\tregmap_update_bits(max98373->regmap,\n\t\tMAX98373_R2043_AMP_EN,\n\t\tMAX98373_SPK_EN_MASK, 1);\n\n\treturn 0;\n}\n\nconst struct snd_soc_component_driver soc_codec_dev_max98373 = {\n\t.probe\t\t\t= max98373_probe,\n\t.controls\t\t= max98373_snd_controls,\n\t.num_controls\t\t= ARRAY_SIZE(max98373_snd_controls),\n\t.dapm_widgets\t\t= max98373_dapm_widgets,\n\t.num_dapm_widgets\t= ARRAY_SIZE(max98373_dapm_widgets),\n\t.dapm_routes\t\t= max98373_audio_map,\n\t.num_dapm_routes\t= ARRAY_SIZE(max98373_audio_map),\n\t.use_pmdown_time\t= 1,\n\t.endianness\t\t= 1,\n};\nEXPORT_SYMBOL_GPL(soc_codec_dev_max98373);\n\nstatic int max98373_sdw_probe(struct snd_soc_component *component)\n{\n\tint ret;\n\n\tret = pm_runtime_resume(component->dev);\n\tif (ret < 0 && ret != -EACCES)\n\t\treturn ret;\n\n\treturn 0;\n}\n\nconst struct snd_soc_component_driver soc_codec_dev_max98373_sdw = {\n\t.probe\t\t\t= max98373_sdw_probe,\n\t.controls\t\t= max98373_snd_controls,\n\t.num_controls\t\t= ARRAY_SIZE(max98373_snd_controls),\n\t.dapm_widgets\t\t= max98373_dapm_widgets,\n\t.num_dapm_widgets\t= ARRAY_SIZE(max98373_dapm_widgets),\n\t.dapm_routes\t\t= max98373_audio_map,\n\t.num_dapm_routes\t= ARRAY_SIZE(max98373_audio_map),\n\t.use_pmdown_time\t= 1,\n\t.endianness\t\t= 1,\n};\nEXPORT_SYMBOL_GPL(soc_codec_dev_max98373_sdw);\n\nvoid max98373_slot_config(struct device *dev,\n\t\t\t  struct max98373_priv *max98373)\n{\n\tint value;\n\n\tif (!device_property_read_u32(dev, \"maxim,vmon-slot-no\", &value))\n\t\tmax98373->v_slot = value & 0xF;\n\telse\n\t\tmax98373->v_slot = 0;\n\n\tif (!device_property_read_u32(dev, \"maxim,imon-slot-no\", &value))\n\t\tmax98373->i_slot = value & 0xF;\n\telse\n\t\tmax98373->i_slot = 1;\n\tif (dev->of_node) {\n\t\tmax98373->reset_gpio = of_get_named_gpio(dev->of_node,\n\t\t\t\t\t\t\"maxim,reset-gpio\", 0);\n\t\tif (!gpio_is_valid(max98373->reset_gpio)) {\n\t\t\tdev_err(dev, \"Looking up %s property in node %s failed %d\\n\",\n\t\t\t\t\"maxim,reset-gpio\", dev->of_node->full_name,\n\t\t\t\tmax98373->reset_gpio);\n\t\t} else {\n\t\t\tdev_dbg(dev, \"maxim,reset-gpio=%d\",\n\t\t\t\tmax98373->reset_gpio);\n\t\t}\n\t} else {\n\t\t \n\t\tmax98373->reset_gpio = -1;\n\t}\n\n\tif (!device_property_read_u32(dev, \"maxim,spkfb-slot-no\", &value))\n\t\tmax98373->spkfb_slot = value & 0xF;\n\telse\n\t\tmax98373->spkfb_slot = 2;\n}\nEXPORT_SYMBOL_GPL(max98373_slot_config);\n\nMODULE_DESCRIPTION(\"ALSA SoC MAX98373 driver\");\nMODULE_AUTHOR(\"Ryan Lee <ryans.lee@maximintegrated.com>\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}