{
  "module_name": "hda-dai.c",
  "hash_id": "7799b80e4eb5b7f751004a6855b1deff70c821332b410eeea6d65a6e630a4856",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/codecs/hda-dai.c",
  "human_readable_source": "\n\n\n\n\n\n\n#include <sound/soc.h>\n#include <sound/hda_codec.h>\n#include \"hda.h\"\n\nstatic int hda_codec_dai_startup(struct snd_pcm_substream *substream, struct snd_soc_dai *dai)\n{\n\tstruct hda_pcm_stream *stream_info;\n\tstruct hda_codec *codec;\n\tstruct hda_pcm *pcm;\n\tint ret;\n\n\tcodec = dev_to_hda_codec(dai->dev);\n\tstream_info = snd_soc_dai_get_dma_data(dai, substream);\n\tpcm = container_of(stream_info, struct hda_pcm, stream[substream->stream]);\n\n\tdev_dbg(dai->dev, \"open stream codec: %08x, info: %p, pcm: %p %s substream: %p\\n\",\n\t\tcodec->core.vendor_id, stream_info, pcm, pcm->name, substream);\n\n\tsnd_hda_codec_pcm_get(pcm);\n\n\tret = stream_info->ops.open(stream_info, codec, substream);\n\tif (ret < 0) {\n\t\tdev_err(dai->dev, \"codec open failed: %d\\n\", ret);\n\t\tsnd_hda_codec_pcm_put(pcm);\n\t\treturn ret;\n\t}\n\n\treturn 0;\n}\n\nstatic void hda_codec_dai_shutdown(struct snd_pcm_substream *substream, struct snd_soc_dai *dai)\n{\n\tstruct hda_pcm_stream *stream_info;\n\tstruct hda_codec *codec;\n\tstruct hda_pcm *pcm;\n\tint ret;\n\n\tcodec = dev_to_hda_codec(dai->dev);\n\tstream_info = snd_soc_dai_get_dma_data(dai, substream);\n\tpcm = container_of(stream_info, struct hda_pcm, stream[substream->stream]);\n\n\tdev_dbg(dai->dev, \"close stream codec: %08x, info: %p, pcm: %p %s substream: %p\\n\",\n\t\tcodec->core.vendor_id, stream_info, pcm, pcm->name, substream);\n\n\tret = stream_info->ops.close(stream_info, codec, substream);\n\tif (ret < 0)\n\t\tdev_err(dai->dev, \"codec close failed: %d\\n\", ret);\n\n\tsnd_hda_codec_pcm_put(pcm);\n}\n\nstatic int hda_codec_dai_hw_free(struct snd_pcm_substream *substream, struct snd_soc_dai *dai)\n{\n\tstruct hda_pcm_stream *stream_info;\n\tstruct hda_codec *codec;\n\n\tcodec = dev_to_hda_codec(dai->dev);\n\tstream_info = snd_soc_dai_get_dma_data(dai, substream);\n\n\tsnd_hda_codec_cleanup(codec, stream_info, substream);\n\n\treturn 0;\n}\n\nstatic int hda_codec_dai_prepare(struct snd_pcm_substream *substream, struct snd_soc_dai *dai)\n{\n\tstruct snd_pcm_runtime *runtime = substream->runtime;\n\tstruct hda_pcm_stream *stream_info;\n\tstruct hdac_stream *stream;\n\tstruct hda_codec *codec;\n\tunsigned int format;\n\tint ret;\n\n\tcodec = dev_to_hda_codec(dai->dev);\n\tstream = substream->runtime->private_data;\n\tstream_info = snd_soc_dai_get_dma_data(dai, substream);\n\tformat = snd_hdac_calc_stream_format(runtime->rate, runtime->channels, runtime->format,\n\t\t\t\t\t     runtime->sample_bits, 0);\n\n\tret = snd_hda_codec_prepare(codec, stream_info, stream->stream_tag, format, substream);\n\tif (ret < 0) {\n\t\tdev_err(dai->dev, \"codec prepare failed: %d\\n\", ret);\n\t\treturn ret;\n\t}\n\n\treturn 0;\n}\n\nconst struct snd_soc_dai_ops snd_soc_hda_codec_dai_ops = {\n\t.startup = hda_codec_dai_startup,\n\t.shutdown = hda_codec_dai_shutdown,\n\t.hw_free = hda_codec_dai_hw_free,\n\t.prepare = hda_codec_dai_prepare,\n};\nEXPORT_SYMBOL_GPL(snd_soc_hda_codec_dai_ops);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}