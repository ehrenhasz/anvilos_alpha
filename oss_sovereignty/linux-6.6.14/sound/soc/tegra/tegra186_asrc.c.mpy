{
  "module_name": "tegra186_asrc.c",
  "hash_id": "762d70a2f5c36db4defb39f896efb3b359a90b7ca4b67db8e0f3af00f82ebfb0",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/tegra/tegra186_asrc.c",
  "human_readable_source": "\n\n\n\n\n\n#include <linux/clk.h>\n#include <linux/delay.h>\n#include <linux/device.h>\n#include <linux/io.h>\n#include <linux/module.h>\n#include <linux/of.h>\n#include <linux/of_device.h>\n#include <linux/platform_device.h>\n#include <linux/pm_runtime.h>\n#include <linux/regmap.h>\n#include <sound/core.h>\n#include <sound/pcm.h>\n#include <sound/pcm_params.h>\n#include <sound/soc.h>\n\n#include \"tegra186_asrc.h\"\n#include \"tegra_cif.h\"\n\n#define ASRC_STREAM_SOURCE_SELECT(id)\t\t\t\t\t       \\\n\t(TEGRA186_ASRC_CFG + ((id) * TEGRA186_ASRC_STREAM_STRIDE))\n\n#define ASRC_STREAM_REG(reg, id) ((reg) + ((id) * TEGRA186_ASRC_STREAM_STRIDE))\n\n#define ASRC_STREAM_REG_DEFAULTS(id)\t\t\t\t\t       \\\n\t{ ASRC_STREAM_REG(TEGRA186_ASRC_CFG, id),\t\t\t       \\\n\t  (((id) + 1) << 4) },\t\t\t\t\t\t       \\\n\t{ ASRC_STREAM_REG(TEGRA186_ASRC_RATIO_INT_PART, id),\t\t       \\\n\t  0x1 },\t\t\t\t\t\t\t       \\\n\t{ ASRC_STREAM_REG(TEGRA186_ASRC_RATIO_FRAC_PART, id),\t\t       \\\n\t  0x0 },\t\t\t\t\t\t\t       \\\n\t{ ASRC_STREAM_REG(TEGRA186_ASRC_MUTE_UNMUTE_DURATION, id),\t       \\\n\t  0x400 },\t\t\t\t\t\t\t       \\\n\t{ ASRC_STREAM_REG(TEGRA186_ASRC_RX_CIF_CTRL, id),\t\t       \\\n\t  0x7500 },\t\t\t\t\t\t\t       \\\n\t{ ASRC_STREAM_REG(TEGRA186_ASRC_TX_CIF_CTRL, id),\t\t       \\\n\t  0x7500 }\n\nstatic const struct reg_default tegra186_asrc_reg_defaults[] = {\n\tASRC_STREAM_REG_DEFAULTS(0),\n\tASRC_STREAM_REG_DEFAULTS(1),\n\tASRC_STREAM_REG_DEFAULTS(2),\n\tASRC_STREAM_REG_DEFAULTS(3),\n\tASRC_STREAM_REG_DEFAULTS(4),\n\tASRC_STREAM_REG_DEFAULTS(5),\n\n\t{ TEGRA186_ASRC_GLOBAL_ENB, 0},\n\t{ TEGRA186_ASRC_GLOBAL_SOFT_RESET, 0},\n\t{ TEGRA186_ASRC_GLOBAL_CG, 0x1 },\n\t{ TEGRA186_ASRC_GLOBAL_CFG, 0x0 },\n\t{ TEGRA186_ASRC_GLOBAL_SCRATCH_ADDR, 0},\n\t{ TEGRA186_ASRC_GLOBAL_SCRATCH_CFG, 0x0c207980 },\n\t{ TEGRA186_ASRC_RATIO_UPD_RX_CIF_CTRL, 0x00115500 },\n\t{ TEGRA186_ASRC_GLOBAL_INT_MASK, 0x0},\n\t{ TEGRA186_ASRC_GLOBAL_INT_SET, 0x0},\n\t{ TEGRA186_ASRC_GLOBAL_INT_CLEAR, 0x0},\n\t{ TEGRA186_ASRC_GLOBAL_APR_CTRL, 0x0},\n\t{ TEGRA186_ASRC_GLOBAL_APR_CTRL_ACCESS_CTRL, 0x0},\n\t{ TEGRA186_ASRC_GLOBAL_DISARM_APR, 0x0},\n\t{ TEGRA186_ASRC_GLOBAL_DISARM_APR_ACCESS_CTRL, 0x0},\n\t{ TEGRA186_ASRC_GLOBAL_RATIO_WR_ACCESS, 0x0},\n\t{ TEGRA186_ASRC_GLOBAL_RATIO_WR_ACCESS_CTRL, 0x0},\n\t{ TEGRA186_ASRC_CYA, 0x0},\n};\n\nstatic void tegra186_asrc_lock_stream(struct tegra186_asrc *asrc,\n\t\t\t\t      unsigned int id)\n{\n\tregmap_write(asrc->regmap,\n\t\t     ASRC_STREAM_REG(TEGRA186_ASRC_RATIO_LOCK_STATUS,\n\t\t\t\t     id),\n\t\t     1);\n}\n\nstatic int __maybe_unused tegra186_asrc_runtime_suspend(struct device *dev)\n{\n\tstruct tegra186_asrc *asrc = dev_get_drvdata(dev);\n\n\tregcache_cache_only(asrc->regmap, true);\n\tregcache_mark_dirty(asrc->regmap);\n\n\treturn 0;\n}\n\nstatic int __maybe_unused tegra186_asrc_runtime_resume(struct device *dev)\n{\n\tstruct tegra186_asrc *asrc = dev_get_drvdata(dev);\n\tint id;\n\n\tregcache_cache_only(asrc->regmap, false);\n\n\t \n\tregmap_write(asrc->regmap, TEGRA186_ASRC_GLOBAL_SCRATCH_ADDR,\n\t\t     TEGRA186_ASRC_ARAM_START_ADDR);\n\tregmap_write(asrc->regmap, TEGRA186_ASRC_GLOBAL_ENB,\n\t\t     TEGRA186_ASRC_GLOBAL_EN);\n\n\tregcache_sync(asrc->regmap);\n\n\tfor (id = 0; id < TEGRA186_ASRC_STREAM_MAX; id++) {\n\t\tif (asrc->lane[id].ratio_source !=\n\t\t    TEGRA186_ASRC_RATIO_SOURCE_SW)\n\t\t\tcontinue;\n\n\t\tregmap_write(asrc->regmap,\n\t\t\tASRC_STREAM_REG(TEGRA186_ASRC_RATIO_INT_PART,\n\t\t\t\t\tid),\n\t\t\tasrc->lane[id].int_part);\n\n\t\tregmap_write(asrc->regmap,\n\t\t\tASRC_STREAM_REG(TEGRA186_ASRC_RATIO_FRAC_PART,\n\t\t\t\t\tid),\n\t\t\tasrc->lane[id].frac_part);\n\n\t\ttegra186_asrc_lock_stream(asrc, id);\n\t}\n\n\treturn 0;\n}\n\nstatic int tegra186_asrc_set_audio_cif(struct tegra186_asrc *asrc,\n\t\t\t\t       struct snd_pcm_hw_params *params,\n\t\t\t\t       unsigned int reg)\n{\n\tint channels, audio_bits;\n\tstruct tegra_cif_conf cif_conf;\n\n\tmemset(&cif_conf, 0, sizeof(struct tegra_cif_conf));\n\n\tchannels = params_channels(params);\n\n\tswitch (params_format(params)) {\n\tcase SNDRV_PCM_FORMAT_S16_LE:\n\t\taudio_bits = TEGRA_ACIF_BITS_16;\n\t\tbreak;\n\tcase SNDRV_PCM_FORMAT_S24_LE:\n\tcase SNDRV_PCM_FORMAT_S32_LE:\n\t\taudio_bits = TEGRA_ACIF_BITS_32;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tcif_conf.audio_ch = channels;\n\tcif_conf.client_ch = channels;\n\tcif_conf.audio_bits = audio_bits;\n\tcif_conf.client_bits = TEGRA_ACIF_BITS_24;\n\n\ttegra_set_cif(asrc->regmap, reg, &cif_conf);\n\n\treturn 0;\n}\n\nstatic int tegra186_asrc_in_hw_params(struct snd_pcm_substream *substream,\n\t\t\t\t      struct snd_pcm_hw_params *params,\n\t\t\t\t      struct snd_soc_dai *dai)\n{\n\tstruct device *dev = dai->dev;\n\tstruct tegra186_asrc *asrc = snd_soc_dai_get_drvdata(dai);\n\tint ret, id = dai->id;\n\n\t \n\tregmap_write(asrc->regmap,\n\t\t     ASRC_STREAM_REG(TEGRA186_ASRC_RX_THRESHOLD, dai->id),\n\t\t     asrc->lane[id].input_thresh);\n\n\tret = tegra186_asrc_set_audio_cif(asrc, params,\n\t\tASRC_STREAM_REG(TEGRA186_ASRC_RX_CIF_CTRL, dai->id));\n\tif (ret) {\n\t\tdev_err(dev, \"Can't set ASRC RX%d CIF: %d\\n\", dai->id, ret);\n\t\treturn ret;\n\t}\n\n\treturn ret;\n}\n\nstatic int tegra186_asrc_out_hw_params(struct snd_pcm_substream *substream,\n\t\t\t\t       struct snd_pcm_hw_params *params,\n\t\t\t\t       struct snd_soc_dai *dai)\n{\n\tstruct device *dev = dai->dev;\n\tstruct tegra186_asrc *asrc = snd_soc_dai_get_drvdata(dai);\n\tint ret, id = dai->id - 7;\n\n\t  \n\tregmap_write(asrc->regmap,\n\t\t     ASRC_STREAM_REG(TEGRA186_ASRC_TX_THRESHOLD, id),\n\t\t     asrc->lane[id].output_thresh);\n\n\tret = tegra186_asrc_set_audio_cif(asrc, params,\n\t\tASRC_STREAM_REG(TEGRA186_ASRC_TX_CIF_CTRL, id));\n\tif (ret) {\n\t\tdev_err(dev, \"Can't set ASRC TX%d CIF: %d\\n\", id, ret);\n\t\treturn ret;\n\t}\n\n\t \n\tif (asrc->lane[id].hwcomp_disable) {\n\t\tregmap_update_bits(asrc->regmap,\n\t\t\tASRC_STREAM_REG(TEGRA186_ASRC_CFG, id),\n\t\t\tTEGRA186_ASRC_STREAM_ENABLE_HW_RATIO_COMP_MASK,\n\t\t\tTEGRA186_ASRC_STREAM_ENABLE_HW_RATIO_COMP_DISABLE);\n\t} else {\n\t\tregmap_update_bits(asrc->regmap,\n\t\t\tASRC_STREAM_REG(TEGRA186_ASRC_CFG, id),\n\t\t\tTEGRA186_ASRC_STREAM_ENABLE_HW_RATIO_COMP_MASK,\n\t\t\tTEGRA186_ASRC_STREAM_ENABLE_HW_RATIO_COMP_ENABLE);\n\n\t\tregmap_write(asrc->regmap,\n\t\t\tASRC_STREAM_REG(TEGRA186_ASRC_RATIO_COMP, id),\n\t\t\tTEGRA186_ASRC_STREAM_DEFAULT_HW_COMP_BIAS_VALUE);\n\t}\n\n\t \n\tregmap_update_bits(asrc->regmap,\n\t\t\t   ASRC_STREAM_REG(TEGRA186_ASRC_CFG, id),\n\t\t\t   1, asrc->lane[id].ratio_source);\n\n\tif (asrc->lane[id].ratio_source == TEGRA186_ASRC_RATIO_SOURCE_SW) {\n\t\tregmap_write(asrc->regmap,\n\t\t\tASRC_STREAM_REG(TEGRA186_ASRC_RATIO_INT_PART, id),\n\t\t\tasrc->lane[id].int_part);\n\t\tregmap_write(asrc->regmap,\n\t\t\tASRC_STREAM_REG(TEGRA186_ASRC_RATIO_FRAC_PART, id),\n\t\t\tasrc->lane[id].frac_part);\n\t\ttegra186_asrc_lock_stream(asrc, id);\n\t}\n\n\treturn ret;\n}\n\nstatic int tegra186_asrc_get_ratio_source(struct snd_kcontrol *kcontrol,\n\t\t\t\t\t  struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct soc_enum *asrc_private =\n\t\t(struct soc_enum  *)kcontrol->private_value;\n\tstruct snd_soc_component *cmpnt = snd_soc_kcontrol_component(kcontrol);\n\tstruct tegra186_asrc *asrc = snd_soc_component_get_drvdata(cmpnt);\n\tunsigned int id = asrc_private->reg / TEGRA186_ASRC_STREAM_STRIDE;\n\n\tucontrol->value.enumerated.item[0] = asrc->lane[id].ratio_source;\n\n\treturn 0;\n}\n\nstatic int tegra186_asrc_put_ratio_source(struct snd_kcontrol *kcontrol,\n\t\t\t\t\t  struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct soc_enum *asrc_private =\n\t\t(struct soc_enum  *)kcontrol->private_value;\n\tstruct snd_soc_component *cmpnt = snd_soc_kcontrol_component(kcontrol);\n\tstruct tegra186_asrc *asrc = snd_soc_component_get_drvdata(cmpnt);\n\tunsigned int id = asrc_private->reg / TEGRA186_ASRC_STREAM_STRIDE;\n\tbool change = false;\n\n\tasrc->lane[id].ratio_source = ucontrol->value.enumerated.item[0];\n\n\tregmap_update_bits_check(asrc->regmap, asrc_private->reg,\n\t\t\t\t TEGRA186_ASRC_STREAM_RATIO_TYPE_MASK,\n\t\t\t\t asrc->lane[id].ratio_source,\n\t\t\t\t &change);\n\n\treturn change ? 1 : 0;\n}\n\nstatic int tegra186_asrc_get_ratio_int(struct snd_kcontrol *kcontrol,\n\t\t\t\t       struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct soc_mixer_control *asrc_private =\n\t\t(struct soc_mixer_control *)kcontrol->private_value;\n\tstruct snd_soc_component *cmpnt = snd_soc_kcontrol_component(kcontrol);\n\tstruct tegra186_asrc *asrc = snd_soc_component_get_drvdata(cmpnt);\n\tunsigned int id = asrc_private->reg / TEGRA186_ASRC_STREAM_STRIDE;\n\n\tregmap_read(asrc->regmap,\n\t\t    ASRC_STREAM_REG(TEGRA186_ASRC_RATIO_INT_PART, id),\n\t\t    &asrc->lane[id].int_part);\n\n\tucontrol->value.integer.value[0] = asrc->lane[id].int_part;\n\n\treturn 0;\n}\n\nstatic int tegra186_asrc_put_ratio_int(struct snd_kcontrol *kcontrol,\n\t\t\t\t       struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct soc_mixer_control *asrc_private =\n\t\t(struct soc_mixer_control *)kcontrol->private_value;\n\tstruct snd_soc_component *cmpnt = snd_soc_kcontrol_component(kcontrol);\n\tstruct tegra186_asrc *asrc = snd_soc_component_get_drvdata(cmpnt);\n\tunsigned int id = asrc_private->reg / TEGRA186_ASRC_STREAM_STRIDE;\n\tbool change = false;\n\n\tif (asrc->lane[id].ratio_source == TEGRA186_ASRC_RATIO_SOURCE_ARAD) {\n\t\tdev_err(cmpnt->dev,\n\t\t\t\"Lane %d ratio source is ARAD, invalid SW update\\n\",\n\t\t\tid);\n\t\treturn -EINVAL;\n\t}\n\n\tasrc->lane[id].int_part = ucontrol->value.integer.value[0];\n\n\tregmap_update_bits_check(asrc->regmap,\n\t\t\t\t ASRC_STREAM_REG(TEGRA186_ASRC_RATIO_INT_PART,\n\t\t\t\t\t\t id),\n\t\t\t\t TEGRA186_ASRC_STREAM_RATIO_INT_PART_MASK,\n\t\t\t\t asrc->lane[id].int_part, &change);\n\n\ttegra186_asrc_lock_stream(asrc, id);\n\n\treturn change ? 1 : 0;\n}\n\nstatic int tegra186_asrc_get_ratio_frac(struct snd_kcontrol *kcontrol,\n\t\t\t\t\tstruct snd_ctl_elem_value *ucontrol)\n{\n\tstruct soc_mreg_control *asrc_private =\n\t\t(struct soc_mreg_control *)kcontrol->private_value;\n\tstruct snd_soc_component *cmpnt = snd_soc_kcontrol_component(kcontrol);\n\tstruct tegra186_asrc *asrc = snd_soc_component_get_drvdata(cmpnt);\n\tunsigned int id = asrc_private->regbase / TEGRA186_ASRC_STREAM_STRIDE;\n\n\tregmap_read(asrc->regmap,\n\t\t    ASRC_STREAM_REG(TEGRA186_ASRC_RATIO_FRAC_PART, id),\n\t\t    &asrc->lane[id].frac_part);\n\n\tucontrol->value.integer.value[0] = asrc->lane[id].frac_part;\n\n\treturn 0;\n}\n\nstatic int tegra186_asrc_put_ratio_frac(struct snd_kcontrol *kcontrol,\n\t\t\t\t\tstruct snd_ctl_elem_value *ucontrol)\n{\n\tstruct soc_mreg_control *asrc_private =\n\t\t(struct soc_mreg_control *)kcontrol->private_value;\n\tstruct snd_soc_component *cmpnt = snd_soc_kcontrol_component(kcontrol);\n\tstruct tegra186_asrc *asrc = snd_soc_component_get_drvdata(cmpnt);\n\tunsigned int id = asrc_private->regbase / TEGRA186_ASRC_STREAM_STRIDE;\n\tbool change = false;\n\n\tif (asrc->lane[id].ratio_source == TEGRA186_ASRC_RATIO_SOURCE_ARAD) {\n\t\tdev_err(cmpnt->dev,\n\t\t\t\"Lane %d ratio source is ARAD, invalid SW update\\n\",\n\t\t\tid);\n\t\treturn -EINVAL;\n\t}\n\n\tasrc->lane[id].frac_part = ucontrol->value.integer.value[0];\n\n\tregmap_update_bits_check(asrc->regmap,\n\t\t\t\t ASRC_STREAM_REG(TEGRA186_ASRC_RATIO_FRAC_PART,\n\t\t\t\t\t\t id),\n\t\t\t\t TEGRA186_ASRC_STREAM_RATIO_FRAC_PART_MASK,\n\t\t\t\t asrc->lane[id].frac_part, &change);\n\n\ttegra186_asrc_lock_stream(asrc, id);\n\n\treturn change ? 1 : 0;\n}\n\nstatic int tegra186_asrc_get_hwcomp_disable(struct snd_kcontrol *kcontrol,\n\t\t\t\t\t    struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct soc_mixer_control *asrc_private =\n\t\t(struct soc_mixer_control *)kcontrol->private_value;\n\tstruct snd_soc_component *cmpnt = snd_soc_kcontrol_component(kcontrol);\n\tstruct tegra186_asrc *asrc = snd_soc_component_get_drvdata(cmpnt);\n\tunsigned int id = asrc_private->reg / TEGRA186_ASRC_STREAM_STRIDE;\n\n\tucontrol->value.integer.value[0] = asrc->lane[id].hwcomp_disable;\n\n\treturn 0;\n}\n\nstatic int tegra186_asrc_put_hwcomp_disable(struct snd_kcontrol *kcontrol,\n\t\t\t\t\t    struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct soc_mixer_control *asrc_private =\n\t\t(struct soc_mixer_control *)kcontrol->private_value;\n\tstruct snd_soc_component *cmpnt = snd_soc_kcontrol_component(kcontrol);\n\tstruct tegra186_asrc *asrc = snd_soc_component_get_drvdata(cmpnt);\n\tunsigned int id = asrc_private->reg / TEGRA186_ASRC_STREAM_STRIDE;\n\tint value = ucontrol->value.integer.value[0];\n\n\tif (value == asrc->lane[id].hwcomp_disable)\n\t\treturn 0;\n\n\tasrc->lane[id].hwcomp_disable = value;\n\n\treturn 1;\n}\n\nstatic int tegra186_asrc_get_input_threshold(struct snd_kcontrol *kcontrol,\n\t\t\t\t\t     struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct soc_mixer_control *asrc_private =\n\t\t(struct soc_mixer_control *)kcontrol->private_value;\n\tstruct snd_soc_component *cmpnt = snd_soc_kcontrol_component(kcontrol);\n\tstruct tegra186_asrc *asrc = snd_soc_component_get_drvdata(cmpnt);\n\tunsigned int id = asrc_private->reg / TEGRA186_ASRC_STREAM_STRIDE;\n\n\tucontrol->value.integer.value[0] = (asrc->lane[id].input_thresh & 0x3);\n\n\treturn 0;\n}\n\nstatic int tegra186_asrc_put_input_threshold(struct snd_kcontrol *kcontrol,\n\t\t\t\t\t     struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct soc_mixer_control *asrc_private =\n\t\t(struct soc_mixer_control *)kcontrol->private_value;\n\tstruct snd_soc_component *cmpnt = snd_soc_kcontrol_component(kcontrol);\n\tstruct tegra186_asrc *asrc = snd_soc_component_get_drvdata(cmpnt);\n\tunsigned int id = asrc_private->reg / TEGRA186_ASRC_STREAM_STRIDE;\n\tint value = (asrc->lane[id].input_thresh & ~(0x3)) |\n\t\t    ucontrol->value.integer.value[0];\n\n\tif (value == asrc->lane[id].input_thresh)\n\t\treturn 0;\n\n\tasrc->lane[id].input_thresh = value;\n\n\treturn 1;\n}\n\nstatic int tegra186_asrc_get_output_threshold(struct snd_kcontrol *kcontrol,\n\t\t\t\t\t      struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct soc_mixer_control *asrc_private =\n\t\t(struct soc_mixer_control *)kcontrol->private_value;\n\tstruct snd_soc_component *cmpnt = snd_soc_kcontrol_component(kcontrol);\n\tstruct tegra186_asrc *asrc = snd_soc_component_get_drvdata(cmpnt);\n\tunsigned int id = asrc_private->reg / TEGRA186_ASRC_STREAM_STRIDE;\n\n\tucontrol->value.integer.value[0] = (asrc->lane[id].output_thresh & 0x3);\n\n\treturn 0;\n}\n\nstatic int tegra186_asrc_put_output_threshold(struct snd_kcontrol *kcontrol,\n\t\t\t\t\t      struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct soc_mixer_control *asrc_private =\n\t\t(struct soc_mixer_control *)kcontrol->private_value;\n\tstruct snd_soc_component *cmpnt = snd_soc_kcontrol_component(kcontrol);\n\tstruct tegra186_asrc *asrc = snd_soc_component_get_drvdata(cmpnt);\n\tunsigned int id = asrc_private->reg / TEGRA186_ASRC_STREAM_STRIDE;\n\tint value = (asrc->lane[id].output_thresh & ~(0x3)) |\n\t\t    ucontrol->value.integer.value[0];\n\n\tif (value == asrc->lane[id].output_thresh)\n\t\treturn 0;\n\n\tasrc->lane[id].output_thresh = value;\n\n\treturn 1;\n}\n\nstatic int tegra186_asrc_widget_event(struct snd_soc_dapm_widget *w,\n\t\t\t\t\tstruct snd_kcontrol *kcontrol, int event)\n{\n\tstruct snd_soc_component *cmpnt = snd_soc_dapm_to_component(w->dapm);\n\tstruct tegra186_asrc *asrc = dev_get_drvdata(cmpnt->dev);\n\tunsigned int id =\n\t\t(w->reg - TEGRA186_ASRC_ENABLE) / TEGRA186_ASRC_STREAM_STRIDE;\n\n\tregmap_write(asrc->regmap,\n\t\t     ASRC_STREAM_REG(TEGRA186_ASRC_SOFT_RESET, id),\n\t\t     0x1);\n\n\treturn 0;\n}\n\nstatic const struct snd_soc_dai_ops tegra186_asrc_in_dai_ops = {\n\t.hw_params\t= tegra186_asrc_in_hw_params,\n};\n\nstatic const struct snd_soc_dai_ops tegra186_asrc_out_dai_ops = {\n\t.hw_params\t= tegra186_asrc_out_hw_params,\n};\n\n#define IN_DAI(id)\t\t\t\t\t\t\\\n\t{\t\t\t\t\t\t\t\\\n\t\t.name = \"ASRC-RX-CIF\"#id,\t\t\t\\\n\t\t.playback = {\t\t\t\t\t\\\n\t\t\t.stream_name = \"RX\" #id \"-CIF-Playback\",\\\n\t\t\t.channels_min = 1,\t\t\t\\\n\t\t\t.channels_max = 12,\t\t\t\\\n\t\t\t.rates = SNDRV_PCM_RATE_8000_192000,\t\\\n\t\t\t.formats = SNDRV_PCM_FMTBIT_S8 |\t\\\n\t\t\t\tSNDRV_PCM_FMTBIT_S16_LE |\t\\\n\t\t\t\tSNDRV_PCM_FMTBIT_S24_LE |\t\\\n\t\t\t\tSNDRV_PCM_FMTBIT_S32_LE,\t\\\n\t\t},\t\t\t\t\t\t\\\n\t\t.capture = {\t\t\t\t\t\\\n\t\t\t.stream_name = \"RX\" #id \"-CIF-Capture\", \\\n\t\t\t.channels_min = 1,\t\t\t\\\n\t\t\t.channels_max = 12,\t\t\t\\\n\t\t\t.rates = SNDRV_PCM_RATE_8000_192000,\t\\\n\t\t\t.formats = SNDRV_PCM_FMTBIT_S8 |\t\\\n\t\t\t\tSNDRV_PCM_FMTBIT_S16_LE |\t\\\n\t\t\t\tSNDRV_PCM_FMTBIT_S24_LE |\t\\\n\t\t\t\tSNDRV_PCM_FMTBIT_S32_LE,\t\\\n\t\t},\t\t\t\t\t\t\\\n\t\t.ops = &tegra186_asrc_in_dai_ops,\t\t\\\n\t}\n\n#define OUT_DAI(id)\t\t\t\t\t\t\\\n\t{\t\t\t\t\t\t\t\\\n\t\t.name = \"ASRC-TX-CIF\"#id,\t\t\t\\\n\t\t.playback = {\t\t\t\t\t\\\n\t\t\t.stream_name = \"TX\" #id \"-CIF-Playback\",\\\n\t\t\t.channels_min = 1,\t\t\t\\\n\t\t\t.channels_max = 12,\t\t\t\\\n\t\t\t.rates = SNDRV_PCM_RATE_8000_192000,\t\\\n\t\t\t.formats = SNDRV_PCM_FMTBIT_S8 |\t\\\n\t\t\t\tSNDRV_PCM_FMTBIT_S16_LE |\t\\\n\t\t\t\tSNDRV_PCM_FMTBIT_S24_LE |\t\\\n\t\t\t\tSNDRV_PCM_FMTBIT_S32_LE,\t\\\n\t\t},\t\t\t\t\t\t\\\n\t\t.capture = {\t\t\t\t\t\\\n\t\t\t.stream_name = \"TX\" #id \"-CIF-Capture\",\t\\\n\t\t\t.channels_min = 1,\t\t\t\\\n\t\t\t.channels_max = 12,\t\t\t\\\n\t\t\t.rates = SNDRV_PCM_RATE_8000_192000,\t\\\n\t\t\t.formats = SNDRV_PCM_FMTBIT_S8 |\t\\\n\t\t\t\tSNDRV_PCM_FMTBIT_S16_LE |\t\\\n\t\t\t\tSNDRV_PCM_FMTBIT_S24_LE |\t\\\n\t\t\t\tSNDRV_PCM_FMTBIT_S32_LE,\t\\\n\t\t},\t\t\t\t\t\t\\\n\t\t.ops = &tegra186_asrc_out_dai_ops,\t\t\\\n\t}\n\nstatic struct snd_soc_dai_driver tegra186_asrc_dais[] = {\n\t \n\tIN_DAI(1),\n\tIN_DAI(2),\n\tIN_DAI(3),\n\tIN_DAI(4),\n\tIN_DAI(5),\n\tIN_DAI(6),\n\tIN_DAI(7),\n\t \n\tOUT_DAI(1),\n\tOUT_DAI(2),\n\tOUT_DAI(3),\n\tOUT_DAI(4),\n\tOUT_DAI(5),\n\tOUT_DAI(6),\n};\n\nstatic const struct snd_soc_dapm_widget tegra186_asrc_widgets[] = {\n\tSND_SOC_DAPM_AIF_IN(\"RX1\", NULL, 0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"RX2\", NULL, 0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"RX3\", NULL, 0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"RX4\", NULL, 0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"RX5\", NULL, 0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"RX6\", NULL, 0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"RX7\", NULL, 0, SND_SOC_NOPM, 0, 0),\n\n\tSND_SOC_DAPM_AIF_OUT_E(\"TX1\", NULL, 0,\n\t\t\t       ASRC_STREAM_REG(TEGRA186_ASRC_ENABLE, 0),\n\t\t\t       TEGRA186_ASRC_STREAM_EN_SHIFT, 0,\n\t\t\t       tegra186_asrc_widget_event,\n\t\t\t       SND_SOC_DAPM_POST_PMD),\n\n\tSND_SOC_DAPM_AIF_OUT_E(\"TX2\", NULL, 0,\n\t\t\t       ASRC_STREAM_REG(TEGRA186_ASRC_ENABLE, 1),\n\t\t\t       TEGRA186_ASRC_STREAM_EN_SHIFT, 0,\n\t\t\t       tegra186_asrc_widget_event,\n\t\t\t       SND_SOC_DAPM_POST_PMD),\n\n\tSND_SOC_DAPM_AIF_OUT_E(\"TX3\", NULL, 0,\n\t\t\t       ASRC_STREAM_REG(TEGRA186_ASRC_ENABLE, 2),\n\t\t\t       TEGRA186_ASRC_STREAM_EN_SHIFT, 0,\n\t\t\t       tegra186_asrc_widget_event,\n\t\t\t       SND_SOC_DAPM_POST_PMD),\n\n\tSND_SOC_DAPM_AIF_OUT_E(\"TX4\", NULL, 0,\n\t\t\t       ASRC_STREAM_REG(TEGRA186_ASRC_ENABLE, 3),\n\t\t\t       TEGRA186_ASRC_STREAM_EN_SHIFT, 0,\n\t\t\t       tegra186_asrc_widget_event,\n\t\t\t       SND_SOC_DAPM_POST_PMD),\n\n\tSND_SOC_DAPM_AIF_OUT_E(\"TX5\", NULL, 0,\n\t\t\t       ASRC_STREAM_REG(TEGRA186_ASRC_ENABLE, 4),\n\t\t\t       TEGRA186_ASRC_STREAM_EN_SHIFT, 0,\n\t\t\t       tegra186_asrc_widget_event,\n\t\t\t       SND_SOC_DAPM_POST_PMD),\n\n\tSND_SOC_DAPM_AIF_OUT_E(\"TX6\", NULL, 0,\n\t\t\t       ASRC_STREAM_REG(TEGRA186_ASRC_ENABLE, 5),\n\t\t\t       TEGRA186_ASRC_STREAM_EN_SHIFT, 0,\n\t\t\t       tegra186_asrc_widget_event,\n\t\t\t       SND_SOC_DAPM_POST_PMD),\n\n\tSND_SOC_DAPM_SPK(\"Depacketizer\", NULL),\n};\n\n#define ASRC_STREAM_ROUTE(id, sname)\t\t\t\t\t   \\\n\t{ \"RX\" #id \" XBAR-\" sname,      NULL,   \"RX\" #id \" XBAR-TX\" },\t   \\\n\t{ \"RX\" #id \"-CIF-\" sname,       NULL,   \"RX\" #id \" XBAR-\" sname }, \\\n\t{ \"RX\" #id,                     NULL,   \"RX\" #id \"-CIF-\" sname },  \\\n\t{ \"TX\" #id,\t\t\tNULL,   \"RX\" #id },\t\t   \\\n\t{ \"TX\" #id \"-CIF-\" sname,       NULL,   \"TX\" #id },\t\t   \\\n\t{ \"TX\" #id \" XBAR-\" sname,      NULL,   \"TX\" #id \"-CIF-\" sname },  \\\n\t{ \"TX\" #id \" XBAR-RX\",          NULL,   \"TX\" #id \" XBAR-\" sname },\n\n#define ASRC_ROUTE(id)\t\t\t\t\t\t\t   \\\n\tASRC_STREAM_ROUTE(id, \"Playback\")\t\t\t\t   \\\n\tASRC_STREAM_ROUTE(id, \"Capture\")\n\n#define ASRC_RATIO_ROUTE(sname)\t\t\t\t\t\t   \\\n\t{ \"RX7 XBAR-\" sname,\t\tNULL,\t\"RX7 XBAR-TX\" },\t   \\\n\t{ \"RX7-CIF-\" sname,\t\tNULL,\t\"RX7 XBAR-\" sname },\t   \\\n\t{ \"RX7\",\t\t\tNULL,\t\"RX7-CIF-\" sname },\t   \\\n\t{ \"Depacketizer\",\t\tNULL,\t\"RX7\" },\n\nstatic const struct snd_soc_dapm_route tegra186_asrc_routes[] = {\n\tASRC_ROUTE(1)\n\tASRC_ROUTE(2)\n\tASRC_ROUTE(3)\n\tASRC_ROUTE(4)\n\tASRC_ROUTE(5)\n\tASRC_ROUTE(6)\n\tASRC_RATIO_ROUTE(\"Playback\")\n\tASRC_RATIO_ROUTE(\"Capture\")\n};\n\nstatic const char * const tegra186_asrc_ratio_source_text[] = {\n\t\"ARAD\",\n\t\"SW\",\n};\n\n#define ASRC_SOURCE_DECL(name, id)\t\t\t\t\t\\\n\tstatic const struct soc_enum name =\t\t\t\t\\\n\t\tSOC_ENUM_SINGLE(ASRC_STREAM_SOURCE_SELECT(id),\t\t\\\n\t\t\t\t0, 2, tegra186_asrc_ratio_source_text)\n\nASRC_SOURCE_DECL(src_select1, 0);\nASRC_SOURCE_DECL(src_select2, 1);\nASRC_SOURCE_DECL(src_select3, 2);\nASRC_SOURCE_DECL(src_select4, 3);\nASRC_SOURCE_DECL(src_select5, 4);\nASRC_SOURCE_DECL(src_select6, 5);\n\n#define SOC_SINGLE_EXT_FRAC(xname, xregbase, xmax, xget, xput)\t\t\\\n{\t\t\t\t\t\t\t\t\t\\\n\t.iface\t= SNDRV_CTL_ELEM_IFACE_MIXER,\t\t\t\t\\\n\t.name\t= (xname),\t\t\t\t\t\t\\\n\t.info\t= snd_soc_info_xr_sx,\t\t\t\t\t\\\n\t.get\t= xget,\t\t\t\t\t\t\t\\\n\t.put\t= xput,\t\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\t.private_value = (unsigned long)&(struct soc_mreg_control)\t\\\n\t{\t\t\t\t\t\t\t\t\\\n\t\t.regbase\t= xregbase,\t\t\t\t\\\n\t\t.regcount\t= 1,\t\t\t\t\t\\\n\t\t.nbits\t\t= 32,\t\t\t\t\t\\\n\t\t.invert\t\t= 0,\t\t\t\t\t\\\n\t\t.min\t\t= 0,\t\t\t\t\t\\\n\t\t.max\t\t= xmax\t\t\t\t\t\\\n\t}\t\t\t\t\t\t\t\t\\\n}\n\nstatic const struct snd_kcontrol_new tegra186_asrc_controls[] = {\n\t \n\tSOC_SINGLE_EXT(\"Ratio1 Integer Part\",\n\t\t       ASRC_STREAM_REG(TEGRA186_ASRC_RATIO_INT_PART, 0),\n\t\t       0, TEGRA186_ASRC_STREAM_RATIO_INT_PART_MASK, 0,\n\t\t       tegra186_asrc_get_ratio_int,\n\t\t       tegra186_asrc_put_ratio_int),\n\n\tSOC_SINGLE_EXT(\"Ratio2 Integer Part\",\n\t\t       ASRC_STREAM_REG(TEGRA186_ASRC_RATIO_INT_PART, 1),\n\t\t       0, TEGRA186_ASRC_STREAM_RATIO_INT_PART_MASK, 0,\n\t\t       tegra186_asrc_get_ratio_int,\n\t\t       tegra186_asrc_put_ratio_int),\n\n\tSOC_SINGLE_EXT(\"Ratio3 Integer Part\",\n\t\t       ASRC_STREAM_REG(TEGRA186_ASRC_RATIO_INT_PART, 2),\n\t\t       0, TEGRA186_ASRC_STREAM_RATIO_INT_PART_MASK, 0,\n\t\t       tegra186_asrc_get_ratio_int,\n\t\t       tegra186_asrc_put_ratio_int),\n\n\tSOC_SINGLE_EXT(\"Ratio4 Integer Part\",\n\t\t       ASRC_STREAM_REG(TEGRA186_ASRC_RATIO_INT_PART, 3),\n\t\t       0, TEGRA186_ASRC_STREAM_RATIO_INT_PART_MASK, 0,\n\t\t       tegra186_asrc_get_ratio_int,\n\t\t       tegra186_asrc_put_ratio_int),\n\n\tSOC_SINGLE_EXT(\"Ratio5 Integer Part\",\n\t\t       ASRC_STREAM_REG(TEGRA186_ASRC_RATIO_INT_PART, 4),\n\t\t       0, TEGRA186_ASRC_STREAM_RATIO_INT_PART_MASK, 0,\n\t\t       tegra186_asrc_get_ratio_int,\n\t\t       tegra186_asrc_put_ratio_int),\n\n\tSOC_SINGLE_EXT(\"Ratio6 Integer Part\",\n\t\t       ASRC_STREAM_REG(TEGRA186_ASRC_RATIO_INT_PART, 5),\n\t\t       0, TEGRA186_ASRC_STREAM_RATIO_INT_PART_MASK, 0,\n\t\t       tegra186_asrc_get_ratio_int,\n\t\t       tegra186_asrc_put_ratio_int),\n\n\t \n\tSOC_SINGLE_EXT_FRAC(\"Ratio1 Fractional Part\",\n\t\t\t    ASRC_STREAM_REG(TEGRA186_ASRC_RATIO_FRAC_PART, 0),\n\t\t\t    TEGRA186_ASRC_STREAM_RATIO_FRAC_PART_MASK,\n\t\t\t    tegra186_asrc_get_ratio_frac,\n\t\t\t    tegra186_asrc_put_ratio_frac),\n\n\tSOC_SINGLE_EXT_FRAC(\"Ratio2 Fractional Part\",\n\t\t\t    ASRC_STREAM_REG(TEGRA186_ASRC_RATIO_FRAC_PART, 1),\n\t\t\t    TEGRA186_ASRC_STREAM_RATIO_FRAC_PART_MASK,\n\t\t\t    tegra186_asrc_get_ratio_frac,\n\t\t\t    tegra186_asrc_put_ratio_frac),\n\n\tSOC_SINGLE_EXT_FRAC(\"Ratio3 Fractional Part\",\n\t\t\t    ASRC_STREAM_REG(TEGRA186_ASRC_RATIO_FRAC_PART, 2),\n\t\t\t    TEGRA186_ASRC_STREAM_RATIO_FRAC_PART_MASK,\n\t\t\t    tegra186_asrc_get_ratio_frac,\n\t\t\t    tegra186_asrc_put_ratio_frac),\n\n\tSOC_SINGLE_EXT_FRAC(\"Ratio4 Fractional Part\",\n\t\t\t    ASRC_STREAM_REG(TEGRA186_ASRC_RATIO_FRAC_PART, 3),\n\t\t\t    TEGRA186_ASRC_STREAM_RATIO_FRAC_PART_MASK,\n\t\t\t    tegra186_asrc_get_ratio_frac,\n\t\t\t    tegra186_asrc_put_ratio_frac),\n\n\tSOC_SINGLE_EXT_FRAC(\"Ratio5 Fractional Part\",\n\t\t\t    ASRC_STREAM_REG(TEGRA186_ASRC_RATIO_FRAC_PART, 4),\n\t\t\t    TEGRA186_ASRC_STREAM_RATIO_FRAC_PART_MASK,\n\t\t\t    tegra186_asrc_get_ratio_frac,\n\t\t\t    tegra186_asrc_put_ratio_frac),\n\n\tSOC_SINGLE_EXT_FRAC(\"Ratio6 Fractional Part\",\n\t\t\t    ASRC_STREAM_REG(TEGRA186_ASRC_RATIO_FRAC_PART, 5),\n\t\t\t    TEGRA186_ASRC_STREAM_RATIO_FRAC_PART_MASK,\n\t\t\t    tegra186_asrc_get_ratio_frac,\n\t\t\t    tegra186_asrc_put_ratio_frac),\n\n\t \n\tSOC_ENUM_EXT(\"Ratio1 Source\", src_select1,\n\t\t     tegra186_asrc_get_ratio_source,\n\t\t     tegra186_asrc_put_ratio_source),\n\n\tSOC_ENUM_EXT(\"Ratio2 Source\", src_select2,\n\t\t     tegra186_asrc_get_ratio_source,\n\t\t     tegra186_asrc_put_ratio_source),\n\n\tSOC_ENUM_EXT(\"Ratio3 Source\", src_select3,\n\t\t     tegra186_asrc_get_ratio_source,\n\t\t     tegra186_asrc_put_ratio_source),\n\n\tSOC_ENUM_EXT(\"Ratio4 Source\", src_select4,\n\t\t     tegra186_asrc_get_ratio_source,\n\t\t     tegra186_asrc_put_ratio_source),\n\n\tSOC_ENUM_EXT(\"Ratio5 Source\", src_select5,\n\t\t     tegra186_asrc_get_ratio_source,\n\t\t     tegra186_asrc_put_ratio_source),\n\n\tSOC_ENUM_EXT(\"Ratio6 Source\", src_select6,\n\t\t     tegra186_asrc_get_ratio_source,\n\t\t     tegra186_asrc_put_ratio_source),\n\n\t \n\tSOC_SINGLE_EXT(\"Stream1 HW Component Disable\",\n\t\t       ASRC_STREAM_REG(TEGRA186_ASRC_CFG, 0), 0, 1, 0,\n\t\t       tegra186_asrc_get_hwcomp_disable,\n\t\t       tegra186_asrc_put_hwcomp_disable),\n\n\tSOC_SINGLE_EXT(\"Stream2 HW Component Disable\",\n\t\t       ASRC_STREAM_REG(TEGRA186_ASRC_CFG, 1), 0, 1, 0,\n\t\t       tegra186_asrc_get_hwcomp_disable,\n\t\t       tegra186_asrc_put_hwcomp_disable),\n\n\tSOC_SINGLE_EXT(\"Stream3 HW Component Disable\",\n\t\t       ASRC_STREAM_REG(TEGRA186_ASRC_CFG, 2), 0, 1, 0,\n\t\t       tegra186_asrc_get_hwcomp_disable,\n\t\t       tegra186_asrc_put_hwcomp_disable),\n\n\tSOC_SINGLE_EXT(\"Stream4 HW Component Disable\",\n\t\t       ASRC_STREAM_REG(TEGRA186_ASRC_CFG, 3), 0, 1, 0,\n\t\t       tegra186_asrc_get_hwcomp_disable,\n\t\t       tegra186_asrc_put_hwcomp_disable),\n\n\tSOC_SINGLE_EXT(\"Stream5 HW Component Disable\",\n\t\t       ASRC_STREAM_REG(TEGRA186_ASRC_CFG, 4), 0, 1, 0,\n\t\t       tegra186_asrc_get_hwcomp_disable,\n\t\t       tegra186_asrc_put_hwcomp_disable),\n\n\tSOC_SINGLE_EXT(\"Stream6 HW Component Disable\",\n\t\t       ASRC_STREAM_REG(TEGRA186_ASRC_CFG, 5), 0, 1, 0,\n\t\t       tegra186_asrc_get_hwcomp_disable,\n\t\t       tegra186_asrc_put_hwcomp_disable),\n\n\t \n\tSOC_SINGLE_EXT(\"Stream1 Input Threshold\",\n\t\t       ASRC_STREAM_REG(TEGRA186_ASRC_RX_THRESHOLD, 0), 0, 3, 0,\n\t\t       tegra186_asrc_get_input_threshold,\n\t\t       tegra186_asrc_put_input_threshold),\n\n\tSOC_SINGLE_EXT(\"Stream2 Input Threshold\",\n\t\t       ASRC_STREAM_REG(TEGRA186_ASRC_RX_THRESHOLD, 1), 0, 3, 0,\n\t\t       tegra186_asrc_get_input_threshold,\n\t\t       tegra186_asrc_put_input_threshold),\n\n\tSOC_SINGLE_EXT(\"Stream3 Input Threshold\",\n\t\t       ASRC_STREAM_REG(TEGRA186_ASRC_RX_THRESHOLD, 2), 0, 3, 0,\n\t\t       tegra186_asrc_get_input_threshold,\n\t\t       tegra186_asrc_put_input_threshold),\n\n\tSOC_SINGLE_EXT(\"Stream4 Input Threshold\",\n\t\t       ASRC_STREAM_REG(TEGRA186_ASRC_RX_THRESHOLD, 3), 0, 3, 0,\n\t\t       tegra186_asrc_get_input_threshold,\n\t\t       tegra186_asrc_put_input_threshold),\n\n\tSOC_SINGLE_EXT(\"Stream5 Input Threshold\",\n\t\t       ASRC_STREAM_REG(TEGRA186_ASRC_RX_THRESHOLD, 4), 0, 3, 0,\n\t\t       tegra186_asrc_get_input_threshold,\n\t\t       tegra186_asrc_put_input_threshold),\n\n\tSOC_SINGLE_EXT(\"Stream6 Input Threshold\",\n\t\t       ASRC_STREAM_REG(TEGRA186_ASRC_RX_THRESHOLD, 4), 0, 3, 0,\n\t\t       tegra186_asrc_get_input_threshold,\n\t\t       tegra186_asrc_put_input_threshold),\n\n\t \n\tSOC_SINGLE_EXT(\"Stream1 Output Threshold\",\n\t\t       ASRC_STREAM_REG(TEGRA186_ASRC_TX_THRESHOLD, 0), 0, 3, 0,\n\t\t       tegra186_asrc_get_output_threshold,\n\t\t       tegra186_asrc_put_output_threshold),\n\n\tSOC_SINGLE_EXT(\"Stream2 Output Threshold\",\n\t\t       ASRC_STREAM_REG(TEGRA186_ASRC_TX_THRESHOLD, 1), 0, 3, 0,\n\t\t       tegra186_asrc_get_output_threshold,\n\t\t       tegra186_asrc_put_output_threshold),\n\n\tSOC_SINGLE_EXT(\"Stream3 Output Threshold\",\n\t\t       ASRC_STREAM_REG(TEGRA186_ASRC_TX_THRESHOLD, 2), 0, 3, 0,\n\t\t       tegra186_asrc_get_output_threshold,\n\t\t       tegra186_asrc_put_output_threshold),\n\n\tSOC_SINGLE_EXT(\"Stream4 Output Threshold\",\n\t\t       ASRC_STREAM_REG(TEGRA186_ASRC_TX_THRESHOLD, 3), 0, 3, 0,\n\t\t       tegra186_asrc_get_output_threshold,\n\t\t       tegra186_asrc_put_output_threshold),\n\n\tSOC_SINGLE_EXT(\"Stream5 Output Threshold\",\n\t\t       ASRC_STREAM_REG(TEGRA186_ASRC_TX_THRESHOLD, 4), 0, 3, 0,\n\t\t       tegra186_asrc_get_output_threshold,\n\t\t       tegra186_asrc_put_output_threshold),\n\n\tSOC_SINGLE_EXT(\"Stream6 Output Threshold\",\n\t\t       ASRC_STREAM_REG(TEGRA186_ASRC_TX_THRESHOLD, 5), 0, 3, 0,\n\t\t       tegra186_asrc_get_output_threshold,\n\t\t       tegra186_asrc_put_output_threshold),\n};\n\nstatic const struct snd_soc_component_driver tegra186_asrc_cmpnt = {\n\t.dapm_widgets\t\t= tegra186_asrc_widgets,\n\t.num_dapm_widgets\t= ARRAY_SIZE(tegra186_asrc_widgets),\n\t.dapm_routes\t\t= tegra186_asrc_routes,\n\t.num_dapm_routes\t= ARRAY_SIZE(tegra186_asrc_routes),\n\t.controls\t\t= tegra186_asrc_controls,\n\t.num_controls\t\t= ARRAY_SIZE(tegra186_asrc_controls),\n};\n\nstatic bool tegra186_asrc_wr_reg(struct device *dev, unsigned int reg)\n{\n\tif (reg < TEGRA186_ASRC_STREAM_LIMIT)\n\t\treg %= TEGRA186_ASRC_STREAM_STRIDE;\n\n\tswitch (reg) {\n\tcase TEGRA186_ASRC_CFG ... TEGRA186_ASRC_RATIO_COMP:\n\tcase TEGRA186_ASRC_RX_CIF_CTRL:\n\tcase TEGRA186_ASRC_TX_CIF_CTRL:\n\tcase TEGRA186_ASRC_ENABLE:\n\tcase TEGRA186_ASRC_SOFT_RESET:\n\tcase TEGRA186_ASRC_GLOBAL_ENB ... TEGRA186_ASRC_RATIO_UPD_RX_CIF_CTRL:\n\tcase TEGRA186_ASRC_GLOBAL_INT_MASK ... TEGRA186_ASRC_GLOBAL_INT_CLEAR:\n\tcase TEGRA186_ASRC_GLOBAL_APR_CTRL ... TEGRA186_ASRC_CYA:\n\t\treturn true;\n\tdefault:\n\t\treturn false;\n\t}\n}\n\nstatic bool tegra186_asrc_rd_reg(struct device *dev, unsigned int reg)\n{\n\tif (reg < TEGRA186_ASRC_STREAM_LIMIT)\n\t\treg %= TEGRA186_ASRC_STREAM_STRIDE;\n\n\tif (tegra186_asrc_wr_reg(dev, reg))\n\t\treturn true;\n\n\tswitch (reg) {\n\tcase TEGRA186_ASRC_RX_STATUS:\n\tcase TEGRA186_ASRC_TX_STATUS:\n\tcase TEGRA186_ASRC_STATUS ... TEGRA186_ASRC_OUTSAMPLEBUF_CFG:\n\tcase TEGRA186_ASRC_RATIO_UPD_RX_STATUS:\n\tcase TEGRA186_ASRC_GLOBAL_STATUS ... TEGRA186_ASRC_GLOBAL_INT_STATUS:\n\tcase TEGRA186_ASRC_GLOBAL_TRANSFER_ERROR_LOG:\n\t\treturn true;\n\tdefault:\n\t\treturn false;\n\t}\n}\n\nstatic bool tegra186_asrc_volatile_reg(struct device *dev, unsigned int reg)\n{\n\tif (reg < TEGRA186_ASRC_STREAM_LIMIT)\n\t\treg %= TEGRA186_ASRC_STREAM_STRIDE;\n\n\tswitch (reg) {\n\tcase TEGRA186_ASRC_RX_STATUS:\n\tcase TEGRA186_ASRC_TX_STATUS:\n\tcase TEGRA186_ASRC_SOFT_RESET:\n\tcase TEGRA186_ASRC_RATIO_INT_PART:\n\tcase TEGRA186_ASRC_RATIO_FRAC_PART:\n\tcase TEGRA186_ASRC_STATUS:\n\tcase TEGRA186_ASRC_RATIO_LOCK_STATUS:\n\tcase TEGRA186_ASRC_RATIO_UPD_RX_STATUS:\n\tcase TEGRA186_ASRC_GLOBAL_SOFT_RESET:\n\tcase TEGRA186_ASRC_GLOBAL_STATUS:\n\tcase TEGRA186_ASRC_GLOBAL_STREAM_ENABLE_STATUS:\n\tcase TEGRA186_ASRC_GLOBAL_INT_STATUS:\n\tcase TEGRA186_ASRC_GLOBAL_TRANSFER_ERROR_LOG:\n\t\treturn true;\n\tdefault:\n\t\treturn false;\n\t}\n}\n\nstatic const struct regmap_config tegra186_asrc_regmap_config = {\n\t.reg_bits\t\t= 32,\n\t.reg_stride\t\t= 4,\n\t.val_bits\t\t= 32,\n\t.max_register\t\t= TEGRA186_ASRC_CYA,\n\t.writeable_reg\t\t= tegra186_asrc_wr_reg,\n\t.readable_reg\t\t= tegra186_asrc_rd_reg,\n\t.volatile_reg\t\t= tegra186_asrc_volatile_reg,\n\t.reg_defaults\t\t= tegra186_asrc_reg_defaults,\n\t.num_reg_defaults\t= ARRAY_SIZE(tegra186_asrc_reg_defaults),\n\t.cache_type\t\t= REGCACHE_FLAT,\n};\n\nstatic const struct of_device_id tegra186_asrc_of_match[] = {\n\t{ .compatible = \"nvidia,tegra186-asrc\" },\n\t{},\n};\nMODULE_DEVICE_TABLE(of, tegra186_asrc_of_match);\n\nstatic int tegra186_asrc_platform_probe(struct platform_device *pdev)\n{\n\tstruct device *dev = &pdev->dev;\n\tstruct tegra186_asrc *asrc;\n\tvoid __iomem *regs;\n\tunsigned int i;\n\tint err;\n\n\tasrc = devm_kzalloc(dev, sizeof(*asrc), GFP_KERNEL);\n\tif (!asrc)\n\t\treturn -ENOMEM;\n\n\tdev_set_drvdata(dev, asrc);\n\n\tregs = devm_platform_ioremap_resource(pdev, 0);\n\tif (IS_ERR(regs))\n\t\treturn PTR_ERR(regs);\n\n\tasrc->regmap = devm_regmap_init_mmio(dev, regs,\n\t\t\t\t\t     &tegra186_asrc_regmap_config);\n\tif (IS_ERR(asrc->regmap)) {\n\t\tdev_err(dev, \"regmap init failed\\n\");\n\t\treturn PTR_ERR(asrc->regmap);\n\t}\n\n\tregcache_cache_only(asrc->regmap, true);\n\n\tregmap_write(asrc->regmap, TEGRA186_ASRC_GLOBAL_CFG,\n\t\t     TEGRA186_ASRC_GLOBAL_CFG_FRAC_32BIT_PRECISION);\n\n\t \n\tfor (i = 0; i < TEGRA186_ASRC_STREAM_MAX; i++) {\n\t\tasrc->lane[i].ratio_source = TEGRA186_ASRC_RATIO_SOURCE_SW;\n\t\tasrc->lane[i].int_part = 1;\n\t\tasrc->lane[i].frac_part = 0;\n\t\tasrc->lane[i].hwcomp_disable = 0;\n\t\tasrc->lane[i].input_thresh =\n\t\t\tTEGRA186_ASRC_STREAM_DEFAULT_INPUT_HW_COMP_THRESH_CFG;\n\t\tasrc->lane[i].output_thresh =\n\t\t\tTEGRA186_ASRC_STREAM_DEFAULT_OUTPUT_HW_COMP_THRESH_CFG;\n\t}\n\n\terr = devm_snd_soc_register_component(dev, &tegra186_asrc_cmpnt,\n\t\t\t\t\t      tegra186_asrc_dais,\n\t\t\t\t\t      ARRAY_SIZE(tegra186_asrc_dais));\n\tif (err) {\n\t\tdev_err(dev, \"can't register ASRC component, err: %d\\n\", err);\n\t\treturn err;\n\t}\n\n\tpm_runtime_enable(dev);\n\n\treturn 0;\n}\n\nstatic void tegra186_asrc_platform_remove(struct platform_device *pdev)\n{\n\tpm_runtime_disable(&pdev->dev);\n}\n\nstatic const struct dev_pm_ops tegra186_asrc_pm_ops = {\n\tSET_RUNTIME_PM_OPS(tegra186_asrc_runtime_suspend,\n\t\t\t   tegra186_asrc_runtime_resume, NULL)\n\tSET_SYSTEM_SLEEP_PM_OPS(pm_runtime_force_suspend,\n\t\t\t\tpm_runtime_force_resume)\n};\n\nstatic struct platform_driver tegra186_asrc_driver = {\n\t.driver = {\n\t\t.name = \"tegra186-asrc\",\n\t\t.of_match_table = tegra186_asrc_of_match,\n\t\t.pm = &tegra186_asrc_pm_ops,\n\t},\n\t.probe = tegra186_asrc_platform_probe,\n\t.remove_new = tegra186_asrc_platform_remove,\n};\nmodule_platform_driver(tegra186_asrc_driver)\n\nMODULE_AUTHOR(\"Junghyun Kim <juskim@nvidia.com>\");\nMODULE_DESCRIPTION(\"Tegra186 ASRC ASoC driver\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}