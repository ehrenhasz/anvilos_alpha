{
  "module_name": "tegra210_mixer.c",
  "hash_id": "c680c9f8376e15b720d9e7bdb3541d8cd5dafd277c7838be17dc007e0f10ede6",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/tegra/tegra210_mixer.c",
  "human_readable_source": "\n\n\n\n\n\n#include <linux/clk.h>\n#include <linux/device.h>\n#include <linux/io.h>\n#include <linux/module.h>\n#include <linux/of.h>\n#include <linux/of_device.h>\n#include <linux/platform_device.h>\n#include <linux/pm_runtime.h>\n#include <linux/regmap.h>\n#include <sound/core.h>\n#include <sound/pcm.h>\n#include <sound/pcm_params.h>\n#include <sound/soc.h>\n\n#include \"tegra210_mixer.h\"\n#include \"tegra_cif.h\"\n\n#define MIXER_REG(reg, id)\t((reg) + ((id) * TEGRA210_MIXER_REG_STRIDE))\n#define MIXER_REG_BASE(reg)\t((reg) % TEGRA210_MIXER_REG_STRIDE)\n\n#define MIXER_GAIN_CFG_RAM_ADDR(id)\t\t\t\t\t\\\n\t(TEGRA210_MIXER_GAIN_CFG_RAM_ADDR_0 +\t\t\t\t\\\n\t ((id) * TEGRA210_MIXER_GAIN_CFG_RAM_ADDR_STRIDE))\n\n#define MIXER_RX_REG_DEFAULTS(id)\t\t\t\t\t\\\n\t{ MIXER_REG(TEGRA210_MIXER_RX1_CIF_CTRL, id), 0x00007700},\t\\\n\t{ MIXER_REG(TEGRA210_MIXER_RX1_CTRL, id), 0x00010823},\t\\\n\t{ MIXER_REG(TEGRA210_MIXER_RX1_PEAK_CTRL, id), 0x000012c0}\n\n#define MIXER_TX_REG_DEFAULTS(id)\t\t\t\t\t\\\n\t{ MIXER_REG(TEGRA210_MIXER_TX1_INT_MASK, (id)), 0x00000001},\t\\\n\t{ MIXER_REG(TEGRA210_MIXER_TX1_CIF_CTRL, (id)), 0x00007700}\n\n#define REG_DURATION_PARAM(reg, i) ((reg) + NUM_GAIN_POLY_COEFFS + 1 + (i))\n\nstatic const struct reg_default tegra210_mixer_reg_defaults[] = {\n\t \n\tMIXER_RX_REG_DEFAULTS(0),\n\tMIXER_RX_REG_DEFAULTS(1),\n\tMIXER_RX_REG_DEFAULTS(2),\n\tMIXER_RX_REG_DEFAULTS(3),\n\tMIXER_RX_REG_DEFAULTS(4),\n\tMIXER_RX_REG_DEFAULTS(5),\n\tMIXER_RX_REG_DEFAULTS(6),\n\tMIXER_RX_REG_DEFAULTS(7),\n\tMIXER_RX_REG_DEFAULTS(8),\n\tMIXER_RX_REG_DEFAULTS(9),\n\t \n\tMIXER_TX_REG_DEFAULTS(0),\n\tMIXER_TX_REG_DEFAULTS(1),\n\tMIXER_TX_REG_DEFAULTS(2),\n\tMIXER_TX_REG_DEFAULTS(3),\n\tMIXER_TX_REG_DEFAULTS(4),\n\n\t{ TEGRA210_MIXER_CG, 0x00000001},\n\t{ TEGRA210_MIXER_GAIN_CFG_RAM_CTRL, 0x00004000},\n\t{ TEGRA210_MIXER_PEAKM_RAM_CTRL, 0x00004000},\n\t{ TEGRA210_MIXER_ENABLE, 0x1 },\n};\n\n \nstatic const struct tegra210_mixer_gain_params gain_params = {\n\t \n\t{ 0, 0, 0, 0, 0, 0, 0, 0x1000000, 0 },\n\t \n\t0x10000,\n\t \n\t{ 0, 0, 0x400, 0x8000000 },\n};\n\nstatic int __maybe_unused tegra210_mixer_runtime_suspend(struct device *dev)\n{\n\tstruct tegra210_mixer *mixer = dev_get_drvdata(dev);\n\n\tregcache_cache_only(mixer->regmap, true);\n\tregcache_mark_dirty(mixer->regmap);\n\n\treturn 0;\n}\n\nstatic int __maybe_unused tegra210_mixer_runtime_resume(struct device *dev)\n{\n\tstruct tegra210_mixer *mixer = dev_get_drvdata(dev);\n\n\tregcache_cache_only(mixer->regmap, false);\n\tregcache_sync(mixer->regmap);\n\n\treturn 0;\n}\n\nstatic int tegra210_mixer_write_ram(struct tegra210_mixer *mixer,\n\t\t\t\t    unsigned int addr,\n\t\t\t\t    unsigned int coef)\n{\n\tunsigned int reg, val;\n\tint err;\n\n\t \n\terr = regmap_read_poll_timeout(mixer->regmap,\n\t\t\t\t       TEGRA210_MIXER_GAIN_CFG_RAM_CTRL,\n\t\t\t\t       val, !(val & 0x80000000), 10, 10000);\n\tif (err < 0)\n\t\treturn err;\n\n\treg = (addr << TEGRA210_MIXER_GAIN_CFG_RAM_ADDR_SHIFT) &\n\t      TEGRA210_MIXER_GAIN_CFG_RAM_ADDR_MASK;\n\treg |= TEGRA210_MIXER_GAIN_CFG_RAM_ADDR_INIT_EN;\n\treg |= TEGRA210_MIXER_GAIN_CFG_RAM_RW_WRITE;\n\treg |= TEGRA210_MIXER_GAIN_CFG_RAM_SEQ_ACCESS_EN;\n\n\tregmap_write(mixer->regmap,\n\t\t     TEGRA210_MIXER_GAIN_CFG_RAM_CTRL,\n\t\t     reg);\n\tregmap_write(mixer->regmap,\n\t\t     TEGRA210_MIXER_GAIN_CFG_RAM_DATA,\n\t\t     coef);\n\n\treturn 0;\n}\n\nstatic int tegra210_mixer_configure_gain(struct snd_soc_component *cmpnt,\n\t\t\t\t\t unsigned int id, bool instant_gain)\n{\n\tstruct tegra210_mixer *mixer = snd_soc_component_get_drvdata(cmpnt);\n\tunsigned int reg = MIXER_GAIN_CFG_RAM_ADDR(id);\n\tint err, i;\n\n\tpm_runtime_get_sync(cmpnt->dev);\n\n\t \n\tfor (i = 0; i < NUM_GAIN_POLY_COEFFS; i++) {\n\t\terr = tegra210_mixer_write_ram(mixer, reg + i,\n\t\t\t\t\t       gain_params.poly_coeff[i]);\n\n\t\tif (err < 0)\n\t\t\tgoto rpm_put;\n\t}\n\n\t \n\terr = tegra210_mixer_write_ram(mixer, reg + NUM_GAIN_POLY_COEFFS,\n\t\t\t\t       mixer->gain_value[id]);\n\tif (err < 0)\n\t\tgoto rpm_put;\n\n\t \n\tfor (i = 0; i < NUM_DURATION_PARMS; i++) {\n\t\tint val;\n\n\t\tif (instant_gain)\n\t\t\tval = 1;\n\t\telse\n\t\t\tval = gain_params.duration[i];\n\n\t\terr = tegra210_mixer_write_ram(mixer,\n\t\t\t\t\t       REG_DURATION_PARAM(reg, i),\n\t\t\t\t\t       val);\n\t\tif (err < 0)\n\t\t\tgoto rpm_put;\n\t}\n\n\t \n\terr = tegra210_mixer_write_ram(mixer, reg + REG_CFG_DONE_TRIGGER,\n\t\t\t\t       VAL_CFG_DONE_TRIGGER);\n\nrpm_put:\n\tpm_runtime_put(cmpnt->dev);\n\n\treturn err;\n}\n\nstatic int tegra210_mixer_get_gain(struct snd_kcontrol *kcontrol,\n\t\t\t\t   struct snd_ctl_elem_value *ucontrol)\n{\n\tstruct soc_mixer_control *mc =\n\t\t(struct soc_mixer_control *)kcontrol->private_value;\n\tstruct snd_soc_component *cmpnt = snd_soc_kcontrol_component(kcontrol);\n\tstruct tegra210_mixer *mixer = snd_soc_component_get_drvdata(cmpnt);\n\tunsigned int reg = mc->reg;\n\tunsigned int i;\n\n\ti = (reg - TEGRA210_MIXER_GAIN_CFG_RAM_ADDR_0) /\n\t    TEGRA210_MIXER_GAIN_CFG_RAM_ADDR_STRIDE;\n\n\tucontrol->value.integer.value[0] = mixer->gain_value[i];\n\n\treturn 0;\n}\n\nstatic int tegra210_mixer_apply_gain(struct snd_kcontrol *kcontrol,\n\t\t\t\t     struct snd_ctl_elem_value *ucontrol,\n\t\t\t\t     bool instant_gain)\n{\n\tstruct soc_mixer_control *mc =\n\t\t(struct soc_mixer_control *)kcontrol->private_value;\n\tstruct snd_soc_component *cmpnt = snd_soc_kcontrol_component(kcontrol);\n\tstruct tegra210_mixer *mixer = snd_soc_component_get_drvdata(cmpnt);\n\tunsigned int reg = mc->reg, id;\n\tint err;\n\n\t \n\tid = (reg - TEGRA210_MIXER_GAIN_CFG_RAM_ADDR_0) /\n\t     TEGRA210_MIXER_GAIN_CFG_RAM_ADDR_STRIDE;\n\n\tif (mixer->gain_value[id] == ucontrol->value.integer.value[0])\n\t\treturn 0;\n\n\tmixer->gain_value[id] = ucontrol->value.integer.value[0];\n\n\terr = tegra210_mixer_configure_gain(cmpnt, id, instant_gain);\n\tif (err) {\n\t\tdev_err(cmpnt->dev, \"Failed to apply gain\\n\");\n\t\treturn err;\n\t}\n\n\treturn 1;\n}\n\nstatic int tegra210_mixer_put_gain(struct snd_kcontrol *kcontrol,\n\t\t\t\t   struct snd_ctl_elem_value *ucontrol)\n{\n\treturn tegra210_mixer_apply_gain(kcontrol, ucontrol, false);\n}\n\nstatic int tegra210_mixer_put_instant_gain(struct snd_kcontrol *kcontrol,\n\t\t\t\t\t   struct snd_ctl_elem_value *ucontrol)\n{\n\treturn tegra210_mixer_apply_gain(kcontrol, ucontrol, true);\n}\n\nstatic int tegra210_mixer_set_audio_cif(struct tegra210_mixer *mixer,\n\t\t\t\t\tstruct snd_pcm_hw_params *params,\n\t\t\t\t\tunsigned int reg,\n\t\t\t\t\tunsigned int id)\n{\n\tunsigned int channels, audio_bits;\n\tstruct tegra_cif_conf cif_conf;\n\n\tmemset(&cif_conf, 0, sizeof(struct tegra_cif_conf));\n\n\tchannels = params_channels(params);\n\n\tswitch (params_format(params)) {\n\tcase SNDRV_PCM_FORMAT_S16_LE:\n\t\taudio_bits = TEGRA_ACIF_BITS_16;\n\t\tbreak;\n\tcase SNDRV_PCM_FORMAT_S32_LE:\n\t\taudio_bits = TEGRA_ACIF_BITS_32;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tcif_conf.audio_ch = channels;\n\tcif_conf.client_ch = channels;\n\tcif_conf.audio_bits = audio_bits;\n\tcif_conf.client_bits = audio_bits;\n\n\ttegra_set_cif(mixer->regmap,\n\t\t      reg + (id * TEGRA210_MIXER_REG_STRIDE),\n\t\t      &cif_conf);\n\n\treturn 0;\n}\n\nstatic int tegra210_mixer_in_hw_params(struct snd_pcm_substream *substream,\n\t\t\t\t       struct snd_pcm_hw_params *params,\n\t\t\t\t       struct snd_soc_dai *dai)\n{\n\tstruct tegra210_mixer *mixer = snd_soc_dai_get_drvdata(dai);\n\tint err;\n\n\terr = tegra210_mixer_set_audio_cif(mixer, params,\n\t\t\t\t\t   TEGRA210_MIXER_RX1_CIF_CTRL,\n\t\t\t\t\t   dai->id);\n\tif (err < 0)\n\t\treturn err;\n\n\treturn tegra210_mixer_configure_gain(dai->component, dai->id, false);\n}\n\nstatic int tegra210_mixer_out_hw_params(struct snd_pcm_substream *substream,\n\t\t\t\t\tstruct snd_pcm_hw_params *params,\n\t\t\t\t\tstruct snd_soc_dai *dai)\n{\n\tstruct tegra210_mixer *mixer = snd_soc_dai_get_drvdata(dai);\n\n\treturn tegra210_mixer_set_audio_cif(mixer, params,\n\t\t\t\t\t    TEGRA210_MIXER_TX1_CIF_CTRL,\n\t\t\t\t\t    dai->id - TEGRA210_MIXER_RX_MAX);\n}\n\nstatic const struct snd_soc_dai_ops tegra210_mixer_out_dai_ops = {\n\t.hw_params\t= tegra210_mixer_out_hw_params,\n};\n\nstatic const struct snd_soc_dai_ops tegra210_mixer_in_dai_ops = {\n\t.hw_params\t= tegra210_mixer_in_hw_params,\n};\n\n#define IN_DAI(id)\t\t\t\t\t\t\\\n\t{\t\t\t\t\t\t\t\\\n\t\t.name = \"MIXER-RX-CIF\"#id,\t\t\t\\\n\t\t.playback = {\t\t\t\t\t\\\n\t\t\t.stream_name = \"RX\" #id \"-CIF-Playback\",\\\n\t\t\t.channels_min = 1,\t\t\t\\\n\t\t\t.channels_max = 8,\t\t\t\\\n\t\t\t.rates = SNDRV_PCM_RATE_8000_192000,\t\\\n\t\t\t.formats = SNDRV_PCM_FMTBIT_S8 |\t\\\n\t\t\t\tSNDRV_PCM_FMTBIT_S16_LE |\t\\\n\t\t\t\tSNDRV_PCM_FMTBIT_S32_LE,\t\\\n\t\t},\t\t\t\t\t\t\\\n\t\t.capture = {\t\t\t\t\t\\\n\t\t\t.stream_name = \"RX\" #id \"-CIF-Capture\",\t\\\n\t\t\t.channels_min = 1,\t\t\t\\\n\t\t\t.channels_max = 8,\t\t\t\\\n\t\t\t.rates = SNDRV_PCM_RATE_8000_192000,\t\\\n\t\t\t.formats = SNDRV_PCM_FMTBIT_S8 |\t\\\n\t\t\t\tSNDRV_PCM_FMTBIT_S16_LE |\t\\\n\t\t\t\tSNDRV_PCM_FMTBIT_S32_LE,\t\\\n\t\t},\t\t\t\t\t\t\\\n\t\t.ops = &tegra210_mixer_in_dai_ops,\t\t\\\n\t}\n\n#define OUT_DAI(id)\t\t\t\t\t\t\\\n\t{\t\t\t\t\t\t\t\\\n\t\t.name = \"MIXER-TX-CIF\" #id,\t\t\t\\\n\t\t.playback = {\t\t\t\t\t\\\n\t\t\t.stream_name = \"TX\" #id \"-CIF-Playback\",\\\n\t\t\t.channels_min = 1,\t\t\t\\\n\t\t\t.channels_max = 8,\t\t\t\\\n\t\t\t.rates = SNDRV_PCM_RATE_8000_192000,\t\\\n\t\t\t.formats = SNDRV_PCM_FMTBIT_S8 |\t\\\n\t\t\t\tSNDRV_PCM_FMTBIT_S16_LE |\t\\\n\t\t\t\tSNDRV_PCM_FMTBIT_S32_LE,\t\\\n\t\t},\t\t\t\t\t\t\\\n\t\t.capture = {\t\t\t\t\t\\\n\t\t\t.stream_name = \"TX\" #id \"-CIF-Capture\",\t\\\n\t\t\t.channels_min = 1,\t\t\t\\\n\t\t\t.channels_max = 8,\t\t\t\\\n\t\t\t.rates = SNDRV_PCM_RATE_8000_192000,\t\\\n\t\t\t.formats = SNDRV_PCM_FMTBIT_S8 |\t\\\n\t\t\t\tSNDRV_PCM_FMTBIT_S16_LE |\t\\\n\t\t\t\tSNDRV_PCM_FMTBIT_S32_LE,\t\\\n\t\t},\t\t\t\t\t\t\\\n\t\t.ops = &tegra210_mixer_out_dai_ops,\t\t\\\n\t}\n\nstatic struct snd_soc_dai_driver tegra210_mixer_dais[] = {\n\t \n\tIN_DAI(1),\n\tIN_DAI(2),\n\tIN_DAI(3),\n\tIN_DAI(4),\n\tIN_DAI(5),\n\tIN_DAI(6),\n\tIN_DAI(7),\n\tIN_DAI(8),\n\tIN_DAI(9),\n\tIN_DAI(10),\n\n\t \n\tOUT_DAI(1),\n\tOUT_DAI(2),\n\tOUT_DAI(3),\n\tOUT_DAI(4),\n\tOUT_DAI(5),\n};\n\n#define ADDER_CTRL_DECL(name, reg)\t\t\t\\\n\tstatic const struct snd_kcontrol_new name[] = {\t\\\n\t\tSOC_DAPM_SINGLE(\"RX1\", reg, 0, 1, 0),\t\\\n\t\tSOC_DAPM_SINGLE(\"RX2\", reg, 1, 1, 0),\t\\\n\t\tSOC_DAPM_SINGLE(\"RX3\", reg, 2, 1, 0),\t\\\n\t\tSOC_DAPM_SINGLE(\"RX4\", reg, 3, 1, 0),\t\\\n\t\tSOC_DAPM_SINGLE(\"RX5\", reg, 4, 1, 0),\t\\\n\t\tSOC_DAPM_SINGLE(\"RX6\", reg, 5, 1, 0),\t\\\n\t\tSOC_DAPM_SINGLE(\"RX7\", reg, 6, 1, 0),\t\\\n\t\tSOC_DAPM_SINGLE(\"RX8\", reg, 7, 1, 0),\t\\\n\t\tSOC_DAPM_SINGLE(\"RX9\", reg, 8, 1, 0),\t\\\n\t\tSOC_DAPM_SINGLE(\"RX10\", reg, 9, 1, 0),\t\\\n\t}\n\nADDER_CTRL_DECL(adder1, TEGRA210_MIXER_TX1_ADDER_CONFIG);\nADDER_CTRL_DECL(adder2, TEGRA210_MIXER_TX2_ADDER_CONFIG);\nADDER_CTRL_DECL(adder3, TEGRA210_MIXER_TX3_ADDER_CONFIG);\nADDER_CTRL_DECL(adder4, TEGRA210_MIXER_TX4_ADDER_CONFIG);\nADDER_CTRL_DECL(adder5, TEGRA210_MIXER_TX5_ADDER_CONFIG);\n\n#define GAIN_CTRL(id)\t\\\n\tSOC_SINGLE_EXT(\"RX\" #id \" Gain Volume\",\t\t\t\\\n\t\t       MIXER_GAIN_CFG_RAM_ADDR((id) - 1), 0,\t\\\n\t\t       0x20000, 0, tegra210_mixer_get_gain,\t\\\n\t\t       tegra210_mixer_put_gain),\t\t\\\n\tSOC_SINGLE_EXT(\"RX\" #id \" Instant Gain Volume\",\t\t\\\n\t\t       MIXER_GAIN_CFG_RAM_ADDR((id) - 1), 0,\t\\\n\t\t       0x20000, 0, tegra210_mixer_get_gain,\t\\\n\t\t       tegra210_mixer_put_instant_gain),\n\n \nstatic const struct snd_kcontrol_new tegra210_mixer_gain_ctls[] = {\n\tGAIN_CTRL(1)\n\tGAIN_CTRL(2)\n\tGAIN_CTRL(3)\n\tGAIN_CTRL(4)\n\tGAIN_CTRL(5)\n\tGAIN_CTRL(6)\n\tGAIN_CTRL(7)\n\tGAIN_CTRL(8)\n\tGAIN_CTRL(9)\n\tGAIN_CTRL(10)\n};\n\nstatic const struct snd_soc_dapm_widget tegra210_mixer_widgets[] = {\n\tSND_SOC_DAPM_AIF_IN(\"RX1\", NULL, 0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"RX2\", NULL, 0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"RX3\", NULL, 0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"RX4\", NULL, 0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"RX5\", NULL, 0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"RX6\", NULL, 0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"RX7\", NULL, 0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"RX8\", NULL, 0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"RX9\", NULL, 0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_IN(\"RX10\", NULL, 0, SND_SOC_NOPM, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"TX1\", NULL, 0, TEGRA210_MIXER_TX1_ENABLE, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"TX2\", NULL, 0, TEGRA210_MIXER_TX2_ENABLE, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"TX3\", NULL, 0, TEGRA210_MIXER_TX3_ENABLE, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"TX4\", NULL, 0, TEGRA210_MIXER_TX4_ENABLE, 0, 0),\n\tSND_SOC_DAPM_AIF_OUT(\"TX5\", NULL, 0, TEGRA210_MIXER_TX5_ENABLE, 0, 0),\n\tSND_SOC_DAPM_MIXER(\"Adder1\", SND_SOC_NOPM, 1, 0, adder1,\n\t\t\t   ARRAY_SIZE(adder1)),\n\tSND_SOC_DAPM_MIXER(\"Adder2\", SND_SOC_NOPM, 1, 0, adder2,\n\t\t\t   ARRAY_SIZE(adder2)),\n\tSND_SOC_DAPM_MIXER(\"Adder3\", SND_SOC_NOPM, 1, 0, adder3,\n\t\t\t   ARRAY_SIZE(adder3)),\n\tSND_SOC_DAPM_MIXER(\"Adder4\", SND_SOC_NOPM, 1, 0, adder4,\n\t\t\t   ARRAY_SIZE(adder4)),\n\tSND_SOC_DAPM_MIXER(\"Adder5\", SND_SOC_NOPM, 1, 0, adder5,\n\t\t\t   ARRAY_SIZE(adder5)),\n};\n\n#define RX_ROUTES(id, sname)\t\t\t\t\t\t   \\\n\t{ \"RX\" #id \" XBAR-\" sname,\tNULL,\t\"RX\" #id \" XBAR-TX\" },\t   \\\n\t{ \"RX\" #id \"-CIF-\" sname,\tNULL,\t\"RX\" #id \" XBAR-\" sname }, \\\n\t{ \"RX\" #id,\t\t\tNULL,\t\"RX\" #id \"-CIF-\" sname }\n\n#define MIXER_RX_ROUTES(id)\t\t\\\n\tRX_ROUTES(id, \"Playback\"),\t\\\n\tRX_ROUTES(id, \"Capture\")\n\n#define ADDER_ROUTES(id, sname)\t\t\t\t\t\t  \\\n\t{ \"Adder\" #id,\t\t\t\"RX1\",\t\"RX1\" },\t\t  \\\n\t{ \"Adder\" #id,\t\t\t\"RX2\",\t\"RX2\" },\t\t  \\\n\t{ \"Adder\" #id,\t\t\t\"RX3\",\t\"RX3\" },\t\t  \\\n\t{ \"Adder\" #id,\t\t\t\"RX4\",\t\"RX4\" },\t\t  \\\n\t{ \"Adder\" #id,\t\t\t\"RX5\",\t\"RX5\" },\t\t  \\\n\t{ \"Adder\" #id,\t\t\t\"RX6\",\t\"RX6\" },\t\t  \\\n\t{ \"Adder\" #id,\t\t\t\"RX7\",\t\"RX7\" },\t\t  \\\n\t{ \"Adder\" #id,\t\t\t\"RX8\",\t\"RX8\" },\t\t  \\\n\t{ \"Adder\" #id,\t\t\t\"RX9\",\t\"RX9\" },\t\t  \\\n\t{ \"Adder\" #id,\t\t\t\"RX10\",\t\"RX10\" },\t\t  \\\n\t{ \"TX\" #id,\t\t\tNULL,\t\"Adder\" #id },\t\t  \\\n\t{ \"TX\" #id \"-CIF-\" sname,\tNULL,\t\"TX\" #id },\t\t  \\\n\t{ \"TX\" #id \" XBAR-\" sname,\tNULL,\t\"TX\" #id \"-CIF-\" sname }, \\\n\t{ \"TX\" #id \" XBAR-RX\",\t\tNULL,\t\"TX\" #id \" XBAR-\" sname } \\\n\n#define TX_ROUTES(id, sname)\t\t\\\n\tADDER_ROUTES(1, sname),\t\t\\\n\tADDER_ROUTES(2, sname),\t\t\\\n\tADDER_ROUTES(3, sname),\t\t\\\n\tADDER_ROUTES(4, sname),\t\t\\\n\tADDER_ROUTES(5, sname)\n\n#define MIXER_TX_ROUTES(id)\t\t\\\n\tTX_ROUTES(id, \"Playback\"),\t\\\n\tTX_ROUTES(id, \"Capture\")\n\nstatic const struct snd_soc_dapm_route tegra210_mixer_routes[] = {\n\t \n\tMIXER_RX_ROUTES(1),\n\tMIXER_RX_ROUTES(2),\n\tMIXER_RX_ROUTES(3),\n\tMIXER_RX_ROUTES(4),\n\tMIXER_RX_ROUTES(5),\n\tMIXER_RX_ROUTES(6),\n\tMIXER_RX_ROUTES(7),\n\tMIXER_RX_ROUTES(8),\n\tMIXER_RX_ROUTES(9),\n\tMIXER_RX_ROUTES(10),\n\t \n\tMIXER_TX_ROUTES(1),\n\tMIXER_TX_ROUTES(2),\n\tMIXER_TX_ROUTES(3),\n\tMIXER_TX_ROUTES(4),\n\tMIXER_TX_ROUTES(5),\n};\n\nstatic const struct snd_soc_component_driver tegra210_mixer_cmpnt = {\n\t.dapm_widgets\t\t= tegra210_mixer_widgets,\n\t.num_dapm_widgets\t= ARRAY_SIZE(tegra210_mixer_widgets),\n\t.dapm_routes\t\t= tegra210_mixer_routes,\n\t.num_dapm_routes\t= ARRAY_SIZE(tegra210_mixer_routes),\n\t.controls\t\t= tegra210_mixer_gain_ctls,\n\t.num_controls\t\t= ARRAY_SIZE(tegra210_mixer_gain_ctls),\n};\n\nstatic bool tegra210_mixer_wr_reg(struct device *dev,\n\t\t\t\tunsigned int reg)\n{\n\tif (reg < TEGRA210_MIXER_RX_LIMIT)\n\t\treg = MIXER_REG_BASE(reg);\n\telse if (reg < TEGRA210_MIXER_TX_LIMIT)\n\t\treg = MIXER_REG_BASE(reg) + TEGRA210_MIXER_TX1_ENABLE;\n\n\tswitch (reg) {\n\tcase TEGRA210_MIXER_RX1_SOFT_RESET:\n\tcase TEGRA210_MIXER_RX1_CIF_CTRL ... TEGRA210_MIXER_RX1_PEAK_CTRL:\n\n\tcase TEGRA210_MIXER_TX1_ENABLE:\n\tcase TEGRA210_MIXER_TX1_SOFT_RESET:\n\tcase TEGRA210_MIXER_TX1_INT_MASK ... TEGRA210_MIXER_TX1_ADDER_CONFIG:\n\n\tcase TEGRA210_MIXER_ENABLE ... TEGRA210_MIXER_CG:\n\tcase TEGRA210_MIXER_GAIN_CFG_RAM_CTRL ... TEGRA210_MIXER_CTRL:\n\t\treturn true;\n\tdefault:\n\t\treturn false;\n\t}\n}\n\nstatic bool tegra210_mixer_rd_reg(struct device *dev,\n\t\t\t\tunsigned int reg)\n{\n\tif (reg < TEGRA210_MIXER_RX_LIMIT)\n\t\treg = MIXER_REG_BASE(reg);\n\telse if (reg < TEGRA210_MIXER_TX_LIMIT)\n\t\treg = MIXER_REG_BASE(reg) + TEGRA210_MIXER_TX1_ENABLE;\n\n\tswitch (reg) {\n\tcase TEGRA210_MIXER_RX1_SOFT_RESET ... TEGRA210_MIXER_RX1_SAMPLE_COUNT:\n\tcase TEGRA210_MIXER_TX1_ENABLE ... TEGRA210_MIXER_TX1_ADDER_CONFIG:\n\tcase TEGRA210_MIXER_ENABLE ... TEGRA210_MIXER_CTRL:\n\t\treturn true;\n\tdefault:\n\t\treturn false;\n\t}\n}\n\nstatic bool tegra210_mixer_volatile_reg(struct device *dev,\n\t\t\t\tunsigned int reg)\n{\n\tif (reg < TEGRA210_MIXER_RX_LIMIT)\n\t\treg = MIXER_REG_BASE(reg);\n\telse if (reg < TEGRA210_MIXER_TX_LIMIT)\n\t\treg = MIXER_REG_BASE(reg) + TEGRA210_MIXER_TX1_ENABLE;\n\n\tswitch (reg) {\n\tcase TEGRA210_MIXER_RX1_SOFT_RESET:\n\tcase TEGRA210_MIXER_RX1_STATUS:\n\n\tcase TEGRA210_MIXER_TX1_SOFT_RESET:\n\tcase TEGRA210_MIXER_TX1_STATUS:\n\tcase TEGRA210_MIXER_TX1_INT_STATUS:\n\tcase TEGRA210_MIXER_TX1_INT_SET:\n\n\tcase TEGRA210_MIXER_SOFT_RESET:\n\tcase TEGRA210_MIXER_STATUS:\n\tcase TEGRA210_MIXER_INT_STATUS:\n\tcase TEGRA210_MIXER_GAIN_CFG_RAM_CTRL:\n\tcase TEGRA210_MIXER_GAIN_CFG_RAM_DATA:\n\tcase TEGRA210_MIXER_PEAKM_RAM_CTRL:\n\tcase TEGRA210_MIXER_PEAKM_RAM_DATA:\n\t\treturn true;\n\tdefault:\n\t\treturn false;\n\t}\n}\n\nstatic bool tegra210_mixer_precious_reg(struct device *dev,\n\t\t\t\tunsigned int reg)\n{\n\tswitch (reg) {\n\tcase TEGRA210_MIXER_GAIN_CFG_RAM_DATA:\n\tcase TEGRA210_MIXER_PEAKM_RAM_DATA:\n\t\treturn true;\n\tdefault:\n\t\treturn false;\n\t}\n}\n\nstatic const struct regmap_config tegra210_mixer_regmap_config = {\n\t.reg_bits\t\t= 32,\n\t.reg_stride\t\t= 4,\n\t.val_bits\t\t= 32,\n\t.max_register\t\t= TEGRA210_MIXER_CTRL,\n\t.writeable_reg\t\t= tegra210_mixer_wr_reg,\n\t.readable_reg\t\t= tegra210_mixer_rd_reg,\n\t.volatile_reg\t\t= tegra210_mixer_volatile_reg,\n\t.precious_reg\t\t= tegra210_mixer_precious_reg,\n\t.reg_defaults\t\t= tegra210_mixer_reg_defaults,\n\t.num_reg_defaults\t= ARRAY_SIZE(tegra210_mixer_reg_defaults),\n\t.cache_type\t\t= REGCACHE_FLAT,\n};\n\nstatic const struct of_device_id tegra210_mixer_of_match[] = {\n\t{ .compatible = \"nvidia,tegra210-amixer\" },\n\t{},\n};\nMODULE_DEVICE_TABLE(of, tegra210_mixer_of_match);\n\nstatic int tegra210_mixer_platform_probe(struct platform_device *pdev)\n{\n\tstruct device *dev = &pdev->dev;\n\tstruct tegra210_mixer *mixer;\n\tvoid __iomem *regs;\n\tint err, i;\n\n\tmixer = devm_kzalloc(dev, sizeof(*mixer), GFP_KERNEL);\n\tif (!mixer)\n\t\treturn -ENOMEM;\n\n\tdev_set_drvdata(dev, mixer);\n\n\t \n\tfor (i = 0; i < TEGRA210_MIXER_RX_MAX; i++)\n\t\tmixer->gain_value[i] = gain_params.gain_value;\n\n\tregs = devm_platform_ioremap_resource(pdev, 0);\n\tif (IS_ERR(regs))\n\t\treturn PTR_ERR(regs);\n\n\tmixer->regmap = devm_regmap_init_mmio(dev, regs,\n\t\t\t\t\t      &tegra210_mixer_regmap_config);\n\tif (IS_ERR(mixer->regmap)) {\n\t\tdev_err(dev, \"regmap init failed\\n\");\n\t\treturn PTR_ERR(mixer->regmap);\n\t}\n\n\tregcache_cache_only(mixer->regmap, true);\n\n\terr = devm_snd_soc_register_component(dev, &tegra210_mixer_cmpnt,\n\t\t\t\t\t      tegra210_mixer_dais,\n\t\t\t\t\t      ARRAY_SIZE(tegra210_mixer_dais));\n\tif (err) {\n\t\tdev_err(dev, \"can't register MIXER component, err: %d\\n\", err);\n\t\treturn err;\n\t}\n\n\tpm_runtime_enable(dev);\n\n\treturn 0;\n}\n\nstatic void tegra210_mixer_platform_remove(struct platform_device *pdev)\n{\n\tpm_runtime_disable(&pdev->dev);\n}\n\nstatic const struct dev_pm_ops tegra210_mixer_pm_ops = {\n\tSET_RUNTIME_PM_OPS(tegra210_mixer_runtime_suspend,\n\t\t\t   tegra210_mixer_runtime_resume, NULL)\n\tSET_SYSTEM_SLEEP_PM_OPS(pm_runtime_force_suspend,\n\t\t\t\tpm_runtime_force_resume)\n};\n\nstatic struct platform_driver tegra210_mixer_driver = {\n\t.driver = {\n\t\t.name = \"tegra210_mixer\",\n\t\t.of_match_table = tegra210_mixer_of_match,\n\t\t.pm = &tegra210_mixer_pm_ops,\n\t},\n\t.probe = tegra210_mixer_platform_probe,\n\t.remove_new = tegra210_mixer_platform_remove,\n};\nmodule_platform_driver(tegra210_mixer_driver);\n\nMODULE_AUTHOR(\"Arun Shamanna Lakshmi <aruns@nvidia.com>\");\nMODULE_DESCRIPTION(\"Tegra210 MIXER ASoC driver\");\nMODULE_LICENSE(\"GPL v2\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}