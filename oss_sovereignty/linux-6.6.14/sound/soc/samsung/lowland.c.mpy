{
  "module_name": "lowland.c",
  "hash_id": "cbbe829713becd924ee7b50db67c0f37b01baafd1d56c3792f22dab14d8ba27f",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/samsung/lowland.c",
  "human_readable_source": "\n\n\n\n\n\n#include <sound/soc.h>\n#include <sound/soc-dapm.h>\n#include <sound/jack.h>\n#include <linux/gpio.h>\n#include <linux/module.h>\n\n#include \"../codecs/wm5100.h\"\n#include \"../codecs/wm9081.h\"\n\n#define MCLK1_RATE (44100 * 512)\n#define CLKOUT_RATE (44100 * 256)\n\nstatic struct snd_soc_jack lowland_headset;\n\n \nstatic struct snd_soc_jack_pin lowland_headset_pins[] = {\n\t{\n\t\t.pin = \"Headphone\",\n\t\t.mask = SND_JACK_HEADPHONE,\n\t},\n\t{\n\t\t.pin = \"Headset Mic\",\n\t\t.mask = SND_JACK_MICROPHONE,\n\t},\n\t{\n\t\t.pin = \"Line Out\",\n\t\t.mask = SND_JACK_LINEOUT,\n\t},\n};\n\nstatic int lowland_wm5100_init(struct snd_soc_pcm_runtime *rtd)\n{\n\tstruct snd_soc_component *component = asoc_rtd_to_codec(rtd, 0)->component;\n\tint ret;\n\n\tret = snd_soc_component_set_sysclk(component, WM5100_CLK_SYSCLK,\n\t\t\t\t       WM5100_CLKSRC_MCLK1, MCLK1_RATE,\n\t\t\t\t       SND_SOC_CLOCK_IN);\n\tif (ret < 0) {\n\t\tpr_err(\"Failed to set SYSCLK clock source: %d\\n\", ret);\n\t\treturn ret;\n\t}\n\n\t \n\tret = snd_soc_component_set_sysclk(component, WM5100_CLK_OPCLK, 0,\n\t\t\t\t       CLKOUT_RATE, 0);\n\tif (ret < 0) {\n\t\tpr_err(\"Failed to set OPCLK rate: %d\\n\", ret);\n\t\treturn ret;\n\t}\n\n\tret = snd_soc_card_jack_new_pins(rtd->card, \"Headset\",\n\t\t\t\t\t SND_JACK_LINEOUT | SND_JACK_HEADSET |\n\t\t\t\t\t SND_JACK_BTN_0,\n\t\t\t\t\t &lowland_headset, lowland_headset_pins,\n\t\t\t\t\t ARRAY_SIZE(lowland_headset_pins));\n\tif (ret)\n\t\treturn ret;\n\n\twm5100_detect(component, &lowland_headset);\n\n\treturn 0;\n}\n\nstatic int lowland_wm9081_init(struct snd_soc_pcm_runtime *rtd)\n{\n\tstruct snd_soc_component *component = asoc_rtd_to_codec(rtd, 0)->component;\n\n\tsnd_soc_dapm_nc_pin(&rtd->card->dapm, \"LINEOUT\");\n\n\t \n\treturn snd_soc_component_set_sysclk(component, WM9081_SYSCLK_MCLK, 0,\n\t\t\t\t\tCLKOUT_RATE, 0);\n}\n\nstatic const struct snd_soc_pcm_stream sub_params = {\n\t.formats = SNDRV_PCM_FMTBIT_S32_LE,\n\t.rate_min = 44100,\n\t.rate_max = 44100,\n\t.channels_min = 2,\n\t.channels_max = 2,\n};\n\nSND_SOC_DAILINK_DEFS(cpu,\n\tDAILINK_COMP_ARRAY(COMP_CPU(\"samsung-i2s.0\")),\n\tDAILINK_COMP_ARRAY(COMP_CODEC(\"wm5100.1-001a\", \"wm5100-aif1\")),\n\tDAILINK_COMP_ARRAY(COMP_PLATFORM(\"samsung-i2s.0\")));\n\nSND_SOC_DAILINK_DEFS(baseband,\n\tDAILINK_COMP_ARRAY(COMP_CPU(\"wm5100-aif2\")),\n\tDAILINK_COMP_ARRAY(COMP_CODEC(\"wm1250-ev1.1-0027\", \"wm1250-ev1\")));\n\nSND_SOC_DAILINK_DEFS(speaker,\n\tDAILINK_COMP_ARRAY(COMP_CPU(\"wm5100-aif3\")),\n\tDAILINK_COMP_ARRAY(COMP_CODEC(\"wm9081.1-006c\", \"wm9081-hifi\")));\n\nstatic struct snd_soc_dai_link lowland_dai[] = {\n\t{\n\t\t.name = \"CPU\",\n\t\t.stream_name = \"CPU\",\n\t\t.dai_fmt = SND_SOC_DAIFMT_I2S | SND_SOC_DAIFMT_NB_NF |\n\t\t\t\tSND_SOC_DAIFMT_CBM_CFM,\n\t\t.init = lowland_wm5100_init,\n\t\tSND_SOC_DAILINK_REG(cpu),\n\t},\n\t{\n\t\t.name = \"Baseband\",\n\t\t.stream_name = \"Baseband\",\n\t\t.dai_fmt = SND_SOC_DAIFMT_I2S | SND_SOC_DAIFMT_NB_NF |\n\t\t\t\tSND_SOC_DAIFMT_CBM_CFM,\n\t\t.ignore_suspend = 1,\n\t\tSND_SOC_DAILINK_REG(baseband),\n\t},\n\t{\n\t\t.name = \"Sub Speaker\",\n\t\t.stream_name = \"Sub Speaker\",\n\t\t.dai_fmt = SND_SOC_DAIFMT_I2S | SND_SOC_DAIFMT_NB_NF |\n\t\t\t\tSND_SOC_DAIFMT_CBM_CFM,\n\t\t.ignore_suspend = 1,\n\t\t.c2c_params = &sub_params,\n\t\t.num_c2c_params = 1,\n\t\t.init = lowland_wm9081_init,\n\t\tSND_SOC_DAILINK_REG(speaker),\n\t},\n};\n\nstatic struct snd_soc_codec_conf lowland_codec_conf[] = {\n\t{\n\t\t.dlc = COMP_CODEC_CONF(\"wm9081.1-006c\"),\n\t\t.name_prefix = \"Sub\",\n\t},\n};\n\nstatic const struct snd_kcontrol_new controls[] = {\n\tSOC_DAPM_PIN_SWITCH(\"Main Speaker\"),\n\tSOC_DAPM_PIN_SWITCH(\"Main DMIC\"),\n\tSOC_DAPM_PIN_SWITCH(\"Main AMIC\"),\n\tSOC_DAPM_PIN_SWITCH(\"WM1250 Input\"),\n\tSOC_DAPM_PIN_SWITCH(\"WM1250 Output\"),\n\tSOC_DAPM_PIN_SWITCH(\"Headphone\"),\n\tSOC_DAPM_PIN_SWITCH(\"Line Out\"),\n};\n\nstatic const struct snd_soc_dapm_widget widgets[] = {\n\tSND_SOC_DAPM_HP(\"Headphone\", NULL),\n\tSND_SOC_DAPM_MIC(\"Headset Mic\", NULL),\n\tSND_SOC_DAPM_LINE(\"Line Out\", NULL),\n\n\tSND_SOC_DAPM_SPK(\"Main Speaker\", NULL),\n\n\tSND_SOC_DAPM_MIC(\"Main AMIC\", NULL),\n\tSND_SOC_DAPM_MIC(\"Main DMIC\", NULL),\n};\n\nstatic const struct snd_soc_dapm_route audio_paths[] = {\n\t{ \"Sub IN1\", NULL, \"HPOUT2L\" },\n\t{ \"Sub IN2\", NULL, \"HPOUT2R\" },\n\n\t{ \"Main Speaker\", NULL, \"Sub SPKN\" },\n\t{ \"Main Speaker\", NULL, \"Sub SPKP\" },\n\t{ \"Main Speaker\", NULL, \"SPKDAT1\" },\n};\n\nstatic struct snd_soc_card lowland = {\n\t.name = \"Lowland\",\n\t.owner = THIS_MODULE,\n\t.dai_link = lowland_dai,\n\t.num_links = ARRAY_SIZE(lowland_dai),\n\t.codec_conf = lowland_codec_conf,\n\t.num_configs = ARRAY_SIZE(lowland_codec_conf),\n\n\t.controls = controls,\n\t.num_controls = ARRAY_SIZE(controls),\n\t.dapm_widgets = widgets,\n\t.num_dapm_widgets = ARRAY_SIZE(widgets),\n\t.dapm_routes = audio_paths,\n\t.num_dapm_routes = ARRAY_SIZE(audio_paths),\n};\n\nstatic int lowland_probe(struct platform_device *pdev)\n{\n\tstruct snd_soc_card *card = &lowland;\n\tint ret;\n\n\tcard->dev = &pdev->dev;\n\n\tret = devm_snd_soc_register_card(&pdev->dev, card);\n\tif (ret)\n\t\tdev_err_probe(&pdev->dev, ret, \"snd_soc_register_card() failed\\n\");\n\n\treturn ret;\n}\n\nstatic struct platform_driver lowland_driver = {\n\t.driver = {\n\t\t.name = \"lowland\",\n\t\t.pm = &snd_soc_pm_ops,\n\t},\n\t.probe = lowland_probe,\n};\n\nmodule_platform_driver(lowland_driver);\n\nMODULE_DESCRIPTION(\"Lowland audio support\");\nMODULE_AUTHOR(\"Mark Brown <broonie@opensource.wolfsonmicro.com>\");\nMODULE_LICENSE(\"GPL\");\nMODULE_ALIAS(\"platform:lowland\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}