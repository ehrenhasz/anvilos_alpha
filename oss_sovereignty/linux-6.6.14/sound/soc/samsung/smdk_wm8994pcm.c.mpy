{
  "module_name": "smdk_wm8994pcm.c",
  "hash_id": "3368cc7be2531bb8bed3d2c192a323a7dd0f8bf5fdef8eb535bdbf3f4a73f131",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/samsung/smdk_wm8994pcm.c",
  "human_readable_source": "\n\n\n\n\n#include <linux/module.h>\n#include <sound/soc.h>\n#include <sound/pcm.h>\n#include <sound/pcm_params.h>\n\n#include \"../codecs/wm8994.h\"\n#include \"pcm.h\"\n\n \n\n \n\n \n#define SMDK_WM8994_FREQ 16934400\n\nstatic int smdk_wm8994_pcm_hw_params(struct snd_pcm_substream *substream,\n\t\t\t      struct snd_pcm_hw_params *params)\n{\n\tstruct snd_soc_pcm_runtime *rtd = asoc_substream_to_rtd(substream);\n\tstruct snd_soc_dai *codec_dai = asoc_rtd_to_codec(rtd, 0);\n\tstruct snd_soc_dai *cpu_dai = asoc_rtd_to_cpu(rtd, 0);\n\tunsigned long mclk_freq;\n\tint rfs, ret;\n\n\tswitch(params_rate(params)) {\n\tcase 8000:\n\t\trfs = 512;\n\t\tbreak;\n\tdefault:\n\t\tdev_err(cpu_dai->dev, \"%s:%d Sampling Rate %u not supported!\\n\",\n\t\t__func__, __LINE__, params_rate(params));\n\t\treturn -EINVAL;\n\t}\n\n\tmclk_freq = params_rate(params) * rfs;\n\n\tret = snd_soc_dai_set_sysclk(codec_dai, WM8994_SYSCLK_FLL1,\n\t\t\t\t\tmclk_freq, SND_SOC_CLOCK_IN);\n\tif (ret < 0)\n\t\treturn ret;\n\n\tret = snd_soc_dai_set_pll(codec_dai, WM8994_FLL1, WM8994_FLL_SRC_MCLK1,\n\t\t\t\t\tSMDK_WM8994_FREQ, mclk_freq);\n\tif (ret < 0)\n\t\treturn ret;\n\n\t \n\tret = snd_soc_dai_set_sysclk(cpu_dai, S3C_PCM_CLKSRC_MUX,\n\t\t\t\t\tmclk_freq, SND_SOC_CLOCK_IN);\n\tif (ret < 0)\n\t\treturn ret;\n\n\t \n\tret = snd_soc_dai_set_clkdiv(cpu_dai, S3C_PCM_SCLK_PER_FS, rfs);\n\tif (ret < 0)\n\t\treturn ret;\n\n\treturn 0;\n}\n\nstatic const struct snd_soc_ops smdk_wm8994_pcm_ops = {\n\t.hw_params = smdk_wm8994_pcm_hw_params,\n};\n\nSND_SOC_DAILINK_DEFS(paif_pcm,\n\tDAILINK_COMP_ARRAY(COMP_CPU(\"samsung-pcm.0\")),\n\tDAILINK_COMP_ARRAY(COMP_CODEC(\"wm8994-codec\", \"wm8994-aif1\")),\n\tDAILINK_COMP_ARRAY(COMP_PLATFORM(\"samsung-pcm.0\")));\n\nstatic struct snd_soc_dai_link smdk_dai[] = {\n\t{\n\t\t.name = \"WM8994 PAIF PCM\",\n\t\t.stream_name = \"Primary PCM\",\n\t\t.dai_fmt = SND_SOC_DAIFMT_DSP_B | SND_SOC_DAIFMT_IB_NF |\n\t\t\t   SND_SOC_DAIFMT_CBS_CFS,\n\t\t.ops = &smdk_wm8994_pcm_ops,\n\t\tSND_SOC_DAILINK_REG(paif_pcm),\n\t},\n};\n\nstatic struct snd_soc_card smdk_pcm = {\n\t.name = \"SMDK-PCM\",\n\t.owner = THIS_MODULE,\n\t.dai_link = smdk_dai,\n\t.num_links = 1,\n};\n\nstatic int snd_smdk_probe(struct platform_device *pdev)\n{\n\tint ret = 0;\n\n\tsmdk_pcm.dev = &pdev->dev;\n\tret = devm_snd_soc_register_card(&pdev->dev, &smdk_pcm);\n\tif (ret)\n\t\tdev_err_probe(&pdev->dev, ret, \"snd_soc_register_card failed\\n\");\n\n\treturn ret;\n}\n\nstatic struct platform_driver snd_smdk_driver = {\n\t.driver = {\n\t\t.name = \"samsung-smdk-pcm\",\n\t},\n\t.probe = snd_smdk_probe,\n};\n\nmodule_platform_driver(snd_smdk_driver);\n\nMODULE_AUTHOR(\"Sangbeom Kim, <sbkim73@samsung.com>\");\nMODULE_DESCRIPTION(\"ALSA SoC SMDK WM8994 for PCM\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}