{
  "module_name": "nocodec.c",
  "hash_id": "6d9a7a7de85fa4a471b1c81f8c7ed5abe495334809be271a505dcc85345b5fdd",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/sof/nocodec.c",
  "human_readable_source": "\n\n\n\n\n\n\n\n\n\n#include <linux/module.h>\n#include <sound/sof.h>\n#include \"sof-audio.h\"\n#include \"sof-priv.h\"\n\nstatic struct snd_soc_card sof_nocodec_card = {\n\t.name = \"nocodec\",  \n\t.topology_shortname = \"sof-nocodec\",\n\t.owner = THIS_MODULE\n};\n\nstatic int sof_nocodec_bes_setup(struct device *dev,\n\t\t\t\t struct snd_soc_dai_driver *drv,\n\t\t\t\t struct snd_soc_dai_link *links,\n\t\t\t\t int link_num, struct snd_soc_card *card)\n{\n\tstruct snd_soc_dai_link_component *dlc;\n\tint i;\n\n\tif (!drv || !links || !card)\n\t\treturn -EINVAL;\n\n\t \n\tfor (i = 0; i < link_num; i++) {\n\t\tdlc = devm_kcalloc(dev, 2, sizeof(*dlc), GFP_KERNEL);\n\t\tif (!dlc)\n\t\t\treturn -ENOMEM;\n\n\t\tlinks[i].name = devm_kasprintf(dev, GFP_KERNEL,\n\t\t\t\t\t       \"NoCodec-%d\", i);\n\t\tif (!links[i].name)\n\t\t\treturn -ENOMEM;\n\n\t\tlinks[i].stream_name = links[i].name;\n\n\t\tlinks[i].cpus = &dlc[0];\n\t\tlinks[i].codecs = &asoc_dummy_dlc;\n\t\tlinks[i].platforms = &dlc[1];\n\n\t\tlinks[i].num_cpus = 1;\n\t\tlinks[i].num_codecs = 1;\n\t\tlinks[i].num_platforms = 1;\n\n\t\tlinks[i].id = i;\n\t\tlinks[i].no_pcm = 1;\n\t\tlinks[i].cpus->dai_name = drv[i].name;\n\t\tlinks[i].platforms->name = dev_name(dev->parent);\n\t\tif (drv[i].playback.channels_min)\n\t\t\tlinks[i].dpcm_playback = 1;\n\t\tif (drv[i].capture.channels_min)\n\t\t\tlinks[i].dpcm_capture = 1;\n\n\t\tlinks[i].be_hw_params_fixup = sof_pcm_dai_link_fixup;\n\t}\n\n\tcard->dai_link = links;\n\tcard->num_links = link_num;\n\n\treturn 0;\n}\n\nstatic int sof_nocodec_setup(struct device *dev,\n\t\t\t     u32 num_dai_drivers,\n\t\t\t     struct snd_soc_dai_driver *dai_drivers)\n{\n\tstruct snd_soc_dai_link *links;\n\n\t \n\tlinks = devm_kcalloc(dev, num_dai_drivers, sizeof(struct snd_soc_dai_link), GFP_KERNEL);\n\tif (!links)\n\t\treturn -ENOMEM;\n\n\treturn sof_nocodec_bes_setup(dev, dai_drivers, links, num_dai_drivers, &sof_nocodec_card);\n}\n\nstatic int sof_nocodec_probe(struct platform_device *pdev)\n{\n\tstruct snd_soc_card *card = &sof_nocodec_card;\n\tstruct snd_soc_acpi_mach *mach;\n\tint ret;\n\n\tcard->dev = &pdev->dev;\n\tcard->topology_shortname_created = true;\n\tmach = pdev->dev.platform_data;\n\n\tret = sof_nocodec_setup(card->dev, mach->mach_params.num_dai_drivers,\n\t\t\t\tmach->mach_params.dai_drivers);\n\tif (ret < 0)\n\t\treturn ret;\n\n\treturn devm_snd_soc_register_card(&pdev->dev, card);\n}\n\nstatic struct platform_driver sof_nocodec_audio = {\n\t.probe = sof_nocodec_probe,\n\t.driver = {\n\t\t.name = \"sof-nocodec\",\n\t\t.pm = &snd_soc_pm_ops,\n\t},\n};\nmodule_platform_driver(sof_nocodec_audio)\n\nMODULE_DESCRIPTION(\"ASoC sof nocodec\");\nMODULE_AUTHOR(\"Liam Girdwood\");\nMODULE_LICENSE(\"Dual BSD/GPL\");\nMODULE_ALIAS(\"platform:sof-nocodec\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}