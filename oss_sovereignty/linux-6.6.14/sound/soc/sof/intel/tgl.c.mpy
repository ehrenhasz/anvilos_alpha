{
  "module_name": "tgl.c",
  "hash_id": "5af49c46ddeb92ebfa05d6ef152933842f62cd04730785641a6c3517c56c7d20",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/sof/intel/tgl.c",
  "human_readable_source": "\n\n\n\n\n\n\n \n\n#include <sound/sof/ext_manifest4.h>\n#include \"../ipc4-priv.h\"\n#include \"../ops.h\"\n#include \"hda.h\"\n#include \"hda-ipc.h\"\n#include \"../sof-audio.h\"\n\nstatic const struct snd_sof_debugfs_map tgl_dsp_debugfs[] = {\n\t{\"hda\", HDA_DSP_HDA_BAR, 0, 0x4000, SOF_DEBUGFS_ACCESS_ALWAYS},\n\t{\"pp\", HDA_DSP_PP_BAR,  0, 0x1000, SOF_DEBUGFS_ACCESS_ALWAYS},\n\t{\"dsp\", HDA_DSP_BAR,  0, 0x10000, SOF_DEBUGFS_ACCESS_ALWAYS},\n};\n\nstatic int tgl_dsp_core_get(struct snd_sof_dev *sdev, int core)\n{\n\tconst struct sof_ipc_pm_ops *pm_ops = sdev->ipc->ops->pm;\n\n\t \n\tif (core == SOF_DSP_PRIMARY_CORE)\n\t\treturn hda_dsp_enable_core(sdev, BIT(core));\n\n\tif (pm_ops->set_core_state)\n\t\treturn pm_ops->set_core_state(sdev, core, true);\n\n\treturn 0;\n}\n\nstatic int tgl_dsp_core_put(struct snd_sof_dev *sdev, int core)\n{\n\tconst struct sof_ipc_pm_ops *pm_ops = sdev->ipc->ops->pm;\n\tint ret;\n\n\tif (pm_ops->set_core_state) {\n\t\tret = pm_ops->set_core_state(sdev, core, false);\n\t\tif (ret < 0)\n\t\t\treturn ret;\n\t}\n\n\t \n\tif (core == SOF_DSP_PRIMARY_CORE)\n\t\treturn hda_dsp_core_reset_power_down(sdev, BIT(core));\n\n\treturn 0;\n}\n\n \nstruct snd_sof_dsp_ops sof_tgl_ops;\nEXPORT_SYMBOL_NS(sof_tgl_ops, SND_SOC_SOF_INTEL_HDA_COMMON);\n\nint sof_tgl_ops_init(struct snd_sof_dev *sdev)\n{\n\t \n\tmemcpy(&sof_tgl_ops, &sof_hda_common_ops, sizeof(struct snd_sof_dsp_ops));\n\n\t \n\tsof_tgl_ops.shutdown\t= hda_dsp_shutdown_dma_flush;\n\n\tif (sdev->pdata->ipc_type == SOF_IPC) {\n\t\t \n\t\tsof_tgl_ops.irq_thread\t= cnl_ipc_irq_thread;\n\n\t\t \n\t\tsof_tgl_ops.send_msg\t= cnl_ipc_send_msg;\n\n\t\t \n\t\tsof_tgl_ops.ipc_dump\t= cnl_ipc_dump;\n\n\t\tsof_tgl_ops.set_power_state = hda_dsp_set_power_state_ipc3;\n\t}\n\n\tif (sdev->pdata->ipc_type == SOF_INTEL_IPC4) {\n\t\tstruct sof_ipc4_fw_data *ipc4_data;\n\n\t\tsdev->private = devm_kzalloc(sdev->dev, sizeof(*ipc4_data), GFP_KERNEL);\n\t\tif (!sdev->private)\n\t\t\treturn -ENOMEM;\n\n\t\tipc4_data = sdev->private;\n\t\tipc4_data->manifest_fw_hdr_offset = SOF_MAN4_FW_HDR_OFFSET;\n\n\t\tipc4_data->mtrace_type = SOF_IPC4_MTRACE_INTEL_CAVS_2;\n\n\t\t \n\t\tipc4_data->load_library = hda_dsp_ipc4_load_library;\n\n\t\t \n\t\tsof_tgl_ops.irq_thread\t= cnl_ipc4_irq_thread;\n\n\t\t \n\t\tsof_tgl_ops.send_msg\t= cnl_ipc4_send_msg;\n\n\t\t \n\t\tsof_tgl_ops.ipc_dump\t= cnl_ipc4_dump;\n\n\t\tsof_tgl_ops.set_power_state = hda_dsp_set_power_state_ipc4;\n\t}\n\n\t \n\thda_set_dai_drv_ops(sdev, &sof_tgl_ops);\n\n\t \n\tsof_tgl_ops.debug_map\t= tgl_dsp_debugfs;\n\tsof_tgl_ops.debug_map_count\t= ARRAY_SIZE(tgl_dsp_debugfs);\n\n\t \n\tsof_tgl_ops.post_fw_run = hda_dsp_post_fw_run;\n\n\t \n\tsof_tgl_ops.run = hda_dsp_cl_boot_firmware_iccmax;\n\n\t \n\tsof_tgl_ops.core_get = tgl_dsp_core_get;\n\tsof_tgl_ops.core_put = tgl_dsp_core_put;\n\n\treturn 0;\n};\nEXPORT_SYMBOL_NS(sof_tgl_ops_init, SND_SOC_SOF_INTEL_HDA_COMMON);\n\nconst struct sof_intel_dsp_desc tgl_chip_info = {\n\t \n\t.cores_num = 4,\n\t.init_core_mask = 1,\n\t.host_managed_cores_mask = BIT(0),\n\t.ipc_req = CNL_DSP_REG_HIPCIDR,\n\t.ipc_req_mask = CNL_DSP_REG_HIPCIDR_BUSY,\n\t.ipc_ack = CNL_DSP_REG_HIPCIDA,\n\t.ipc_ack_mask = CNL_DSP_REG_HIPCIDA_DONE,\n\t.ipc_ctl = CNL_DSP_REG_HIPCCTL,\n\t.rom_status_reg = HDA_DSP_SRAM_REG_ROM_STATUS,\n\t.rom_init_timeout\t= 300,\n\t.ssp_count = TGL_SSP_COUNT,\n\t.ssp_base_offset = CNL_SSP_BASE_OFFSET,\n\t.sdw_shim_base = SDW_SHIM_BASE,\n\t.sdw_alh_base = SDW_ALH_BASE,\n\t.d0i3_offset = SOF_HDA_VS_D0I3C,\n\t.read_sdw_lcount =  hda_sdw_check_lcount_common,\n\t.enable_sdw_irq\t= hda_common_enable_sdw_irq,\n\t.check_sdw_irq\t= hda_common_check_sdw_irq,\n\t.check_sdw_wakeen_irq = hda_sdw_check_wakeen_irq_common,\n\t.check_ipc_irq\t= hda_dsp_check_ipc_irq,\n\t.cl_init = cl_dsp_init,\n\t.power_down_dsp = hda_power_down_dsp,\n\t.disable_interrupts = hda_dsp_disable_interrupts,\n\t.hw_ip_version = SOF_INTEL_CAVS_2_5,\n};\nEXPORT_SYMBOL_NS(tgl_chip_info, SND_SOC_SOF_INTEL_HDA_COMMON);\n\nconst struct sof_intel_dsp_desc tglh_chip_info = {\n\t \n\t.cores_num = 2,\n\t.init_core_mask = 1,\n\t.host_managed_cores_mask = BIT(0),\n\t.ipc_req = CNL_DSP_REG_HIPCIDR,\n\t.ipc_req_mask = CNL_DSP_REG_HIPCIDR_BUSY,\n\t.ipc_ack = CNL_DSP_REG_HIPCIDA,\n\t.ipc_ack_mask = CNL_DSP_REG_HIPCIDA_DONE,\n\t.ipc_ctl = CNL_DSP_REG_HIPCCTL,\n\t.rom_status_reg = HDA_DSP_SRAM_REG_ROM_STATUS,\n\t.rom_init_timeout\t= 300,\n\t.ssp_count = TGL_SSP_COUNT,\n\t.ssp_base_offset = CNL_SSP_BASE_OFFSET,\n\t.sdw_shim_base = SDW_SHIM_BASE,\n\t.sdw_alh_base = SDW_ALH_BASE,\n\t.d0i3_offset = SOF_HDA_VS_D0I3C,\n\t.read_sdw_lcount =  hda_sdw_check_lcount_common,\n\t.enable_sdw_irq\t= hda_common_enable_sdw_irq,\n\t.check_sdw_irq\t= hda_common_check_sdw_irq,\n\t.check_sdw_wakeen_irq = hda_sdw_check_wakeen_irq_common,\n\t.check_ipc_irq\t= hda_dsp_check_ipc_irq,\n\t.cl_init = cl_dsp_init,\n\t.power_down_dsp = hda_power_down_dsp,\n\t.disable_interrupts = hda_dsp_disable_interrupts,\n\t.hw_ip_version = SOF_INTEL_CAVS_2_5,\n};\nEXPORT_SYMBOL_NS(tglh_chip_info, SND_SOC_SOF_INTEL_HDA_COMMON);\n\nconst struct sof_intel_dsp_desc ehl_chip_info = {\n\t \n\t.cores_num = 4,\n\t.init_core_mask = 1,\n\t.host_managed_cores_mask = BIT(0),\n\t.ipc_req = CNL_DSP_REG_HIPCIDR,\n\t.ipc_req_mask = CNL_DSP_REG_HIPCIDR_BUSY,\n\t.ipc_ack = CNL_DSP_REG_HIPCIDA,\n\t.ipc_ack_mask = CNL_DSP_REG_HIPCIDA_DONE,\n\t.ipc_ctl = CNL_DSP_REG_HIPCCTL,\n\t.rom_status_reg = HDA_DSP_SRAM_REG_ROM_STATUS,\n\t.rom_init_timeout\t= 300,\n\t.ssp_count = TGL_SSP_COUNT,\n\t.ssp_base_offset = CNL_SSP_BASE_OFFSET,\n\t.sdw_shim_base = SDW_SHIM_BASE,\n\t.sdw_alh_base = SDW_ALH_BASE,\n\t.d0i3_offset = SOF_HDA_VS_D0I3C,\n\t.read_sdw_lcount =  hda_sdw_check_lcount_common,\n\t.enable_sdw_irq\t= hda_common_enable_sdw_irq,\n\t.check_sdw_irq\t= hda_common_check_sdw_irq,\n\t.check_sdw_wakeen_irq = hda_sdw_check_wakeen_irq_common,\n\t.check_ipc_irq\t= hda_dsp_check_ipc_irq,\n\t.cl_init = cl_dsp_init,\n\t.power_down_dsp = hda_power_down_dsp,\n\t.disable_interrupts = hda_dsp_disable_interrupts,\n\t.hw_ip_version = SOF_INTEL_CAVS_2_5,\n};\nEXPORT_SYMBOL_NS(ehl_chip_info, SND_SOC_SOF_INTEL_HDA_COMMON);\n\nconst struct sof_intel_dsp_desc adls_chip_info = {\n\t \n\t.cores_num = 2,\n\t.init_core_mask = BIT(0),\n\t.host_managed_cores_mask = BIT(0),\n\t.ipc_req = CNL_DSP_REG_HIPCIDR,\n\t.ipc_req_mask = CNL_DSP_REG_HIPCIDR_BUSY,\n\t.ipc_ack = CNL_DSP_REG_HIPCIDA,\n\t.ipc_ack_mask = CNL_DSP_REG_HIPCIDA_DONE,\n\t.ipc_ctl = CNL_DSP_REG_HIPCCTL,\n\t.rom_status_reg = HDA_DSP_SRAM_REG_ROM_STATUS,\n\t.rom_init_timeout\t= 300,\n\t.ssp_count = TGL_SSP_COUNT,\n\t.ssp_base_offset = CNL_SSP_BASE_OFFSET,\n\t.sdw_shim_base = SDW_SHIM_BASE,\n\t.sdw_alh_base = SDW_ALH_BASE,\n\t.d0i3_offset = SOF_HDA_VS_D0I3C,\n\t.read_sdw_lcount =  hda_sdw_check_lcount_common,\n\t.enable_sdw_irq\t= hda_common_enable_sdw_irq,\n\t.check_sdw_irq\t= hda_common_check_sdw_irq,\n\t.check_sdw_wakeen_irq = hda_sdw_check_wakeen_irq_common,\n\t.check_ipc_irq\t= hda_dsp_check_ipc_irq,\n\t.cl_init = cl_dsp_init,\n\t.power_down_dsp = hda_power_down_dsp,\n\t.disable_interrupts = hda_dsp_disable_interrupts,\n\t.hw_ip_version = SOF_INTEL_CAVS_2_5,\n};\nEXPORT_SYMBOL_NS(adls_chip_info, SND_SOC_SOF_INTEL_HDA_COMMON);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}