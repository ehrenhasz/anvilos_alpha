{
  "module_name": "hda-bus.c",
  "hash_id": "ca162da31ece79ab1f0ed97320f4950ad3e10d17ab87f9312a3b8271c9c3b1e8",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/sof/intel/hda-bus.c",
  "human_readable_source": "\n\n\n\n\n\n\n\n\n#include <linux/io.h>\n#include <sound/hdaudio.h>\n#include <sound/hda_i915.h>\n#include <sound/hda_codec.h>\n#include <sound/hda_register.h>\n#include \"../sof-priv.h\"\n#include \"hda.h\"\n\n#if IS_ENABLED(CONFIG_SND_SOC_SOF_HDA_AUDIO_CODEC)\n#include \"../../codecs/hdac_hda.h\"\n#define sof_hda_ext_ops\tsnd_soc_hdac_hda_get_ops()\n\nstatic void update_codec_wake_enable(struct hdac_bus *bus, unsigned int addr, bool link_power)\n{\n\tunsigned int mask = snd_hdac_chip_readw(bus, WAKEEN);\n\n\tif (link_power)\n\t\tmask &= ~BIT(addr);\n\telse\n\t\tmask |= BIT(addr);\n\n\tsnd_hdac_chip_updatew(bus, WAKEEN, STATESTS_INT_MASK, mask);\n}\n\nstatic void sof_hda_bus_link_power(struct hdac_device *codec, bool enable)\n{\n\tstruct hdac_bus *bus = codec->bus;\n\tbool oldstate = test_bit(codec->addr, &bus->codec_powered);\n\n\tsnd_hdac_ext_bus_link_power(codec, enable);\n\n\tif (enable == oldstate)\n\t\treturn;\n\n\t \n\tif (codec->addr == HDA_IDISP_ADDR && !enable)\n\t\tsnd_hdac_display_power(bus, HDA_CODEC_IDX_CONTROLLER, false);\n\n\t \n\tupdate_codec_wake_enable(bus, codec->addr, enable);\n}\n\nstatic const struct hdac_bus_ops bus_core_ops = {\n\t.command = snd_hdac_bus_send_cmd,\n\t.get_response = snd_hdac_bus_get_response,\n\t.link_power = sof_hda_bus_link_power,\n};\n#endif\n\n \nvoid sof_hda_bus_init(struct snd_sof_dev *sdev, struct device *dev)\n{\n\tstruct hdac_bus *bus = sof_to_bus(sdev);\n\n#if IS_ENABLED(CONFIG_SND_SOC_SOF_HDA_LINK)\n#if IS_ENABLED(CONFIG_SND_SOC_SOF_HDA_AUDIO_CODEC)\n\tsnd_hdac_ext_bus_init(bus, dev, &bus_core_ops, sof_hda_ext_ops);\n#else\n\tsnd_hdac_ext_bus_init(bus, dev, NULL, NULL);\n#endif\n#else\n\n\tmemset(bus, 0, sizeof(*bus));\n\tbus->dev = dev;\n\n\tINIT_LIST_HEAD(&bus->stream_list);\n\n\tbus->irq = -1;\n\n\t \n\tbus->idx = 0;\n\n\tspin_lock_init(&bus->reg_lock);\n#endif  \n}\n\nvoid sof_hda_bus_exit(struct snd_sof_dev *sdev)\n{\n#if IS_ENABLED(CONFIG_SND_SOC_SOF_HDA_LINK)\n\tstruct hdac_bus *bus = sof_to_bus(sdev);\n\n\tsnd_hdac_ext_bus_exit(bus);\n#endif\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}