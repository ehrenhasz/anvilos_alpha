{
  "module_name": "sof-audio.h",
  "hash_id": "ddafecca3227f22a291521af4745c21c3ade65fedceb5b0a497c008796c5b44f",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/sof/sof-audio.h",
  "human_readable_source": " \n \n\n#ifndef __SOUND_SOC_SOF_AUDIO_H\n#define __SOUND_SOC_SOF_AUDIO_H\n\n#include <linux/workqueue.h>\n\n#include <sound/soc.h>\n#include <sound/control.h>\n#include <sound/sof/stream.h>  \n#include <sound/sof/control.h>\n#include <sound/sof/dai.h>\n#include <sound/sof/topology.h>\n#include \"sof-priv.h\"\n\n#define SOF_AUDIO_PCM_DRV_NAME\t\"sof-audio-component\"\n\n \n#define SOF_WIDGET_MAX_NUM_PINS\t8\n\n \n#define SOF_PIN_TYPE_INPUT\t0\n#define SOF_PIN_TYPE_OUTPUT\t1\n\n \n#define SOF_BE_PCM_BASE\t\t16\n\n#define DMA_CHAN_INVALID\t0xFFFFFFFF\n\n#define WIDGET_IS_DAI(id) ((id) == snd_soc_dapm_dai_in || (id) == snd_soc_dapm_dai_out)\n#define WIDGET_IS_AIF(id) ((id) == snd_soc_dapm_aif_in || (id) == snd_soc_dapm_aif_out)\n#define WIDGET_IS_AIF_OR_DAI(id) (WIDGET_IS_DAI(id) || WIDGET_IS_AIF(id))\n#define WIDGET_IS_COPIER(id) (WIDGET_IS_AIF_OR_DAI(id) || (id) == snd_soc_dapm_buffer)\n\n#define SOF_DAI_CLK_INTEL_SSP_MCLK\t0\n#define SOF_DAI_CLK_INTEL_SSP_BCLK\t1\n\nenum sof_widget_op {\n\tSOF_WIDGET_PREPARE,\n\tSOF_WIDGET_SETUP,\n\tSOF_WIDGET_FREE,\n\tSOF_WIDGET_UNPREPARE,\n};\n\n \n#define VOLUME_FWL\t16\n\n#define SOF_TLV_ITEMS 3\n\nstatic inline u32 mixer_to_ipc(unsigned int value, u32 *volume_map, int size)\n{\n\tif (value >= size)\n\t\treturn volume_map[size - 1];\n\n\treturn volume_map[value];\n}\n\nstatic inline u32 ipc_to_mixer(u32 value, u32 *volume_map, int size)\n{\n\tint i;\n\n\tfor (i = 0; i < size; i++) {\n\t\tif (volume_map[i] >= value)\n\t\t\treturn i;\n\t}\n\n\treturn i - 1;\n}\n\nstruct snd_sof_widget;\nstruct snd_sof_route;\nstruct snd_sof_control;\nstruct snd_sof_dai;\nstruct snd_sof_pcm;\n\nstruct snd_sof_dai_config_data {\n\tint dai_index;\n\tint dai_data;  \n};\n\n \nstruct sof_ipc_pcm_ops {\n\tint (*hw_params)(struct snd_soc_component *component, struct snd_pcm_substream *substream,\n\t\t\t struct snd_pcm_hw_params *params,\n\t\t\t struct snd_sof_platform_stream_params *platform_params);\n\tint (*hw_free)(struct snd_soc_component *component, struct snd_pcm_substream *substream);\n\tint (*trigger)(struct snd_soc_component *component,  struct snd_pcm_substream *substream,\n\t\t       int cmd);\n\tint (*dai_link_fixup)(struct snd_soc_pcm_runtime *rtd, struct snd_pcm_hw_params *params);\n\tint (*pcm_setup)(struct snd_sof_dev *sdev, struct snd_sof_pcm *spcm);\n\tvoid (*pcm_free)(struct snd_sof_dev *sdev, struct snd_sof_pcm *spcm);\n\tsnd_pcm_sframes_t (*delay)(struct snd_soc_component *component,\n\t\t\t\t   struct snd_pcm_substream *substream);\n\tbool reset_hw_params_during_stop;\n\tbool ipc_first_on_start;\n\tbool platform_stop_during_hw_free;\n};\n\n \nstruct sof_ipc_tplg_control_ops {\n\tbool (*volume_put)(struct snd_sof_control *scontrol, struct snd_ctl_elem_value *ucontrol);\n\tint (*volume_get)(struct snd_sof_control *scontrol, struct snd_ctl_elem_value *ucontrol);\n\tbool (*switch_put)(struct snd_sof_control *scontrol, struct snd_ctl_elem_value *ucontrol);\n\tint (*switch_get)(struct snd_sof_control *scontrol, struct snd_ctl_elem_value *ucontrol);\n\tbool (*enum_put)(struct snd_sof_control *scontrol, struct snd_ctl_elem_value *ucontrol);\n\tint (*enum_get)(struct snd_sof_control *scontrol, struct snd_ctl_elem_value *ucontrol);\n\tint (*bytes_put)(struct snd_sof_control *scontrol, struct snd_ctl_elem_value *ucontrol);\n\tint (*bytes_get)(struct snd_sof_control *scontrol, struct snd_ctl_elem_value *ucontrol);\n\tint (*bytes_ext_get)(struct snd_sof_control *scontrol,\n\t\t\t     const unsigned int __user *binary_data, unsigned int size);\n\tint (*bytes_ext_volatile_get)(struct snd_sof_control *scontrol,\n\t\t\t\t      const unsigned int __user *binary_data, unsigned int size);\n\tint (*bytes_ext_put)(struct snd_sof_control *scontrol,\n\t\t\t     const unsigned int __user *binary_data, unsigned int size);\n\t \n\tvoid (*update)(struct snd_sof_dev *sdev, void *ipc_control_message);\n\t \n\tint (*widget_kcontrol_setup)(struct snd_sof_dev *sdev, struct snd_sof_widget *swidget);\n\t \n\tint (*set_up_volume_table)(struct snd_sof_control *scontrol, int tlv[SOF_TLV_ITEMS],\n\t\t\t\t   int size);\n};\n\n \nstruct sof_ipc_tplg_widget_ops {\n\tint (*ipc_setup)(struct snd_sof_widget *swidget);\n\tvoid (*ipc_free)(struct snd_sof_widget *swidget);\n\tenum sof_tokens *token_list;\n\tint token_list_size;\n\tint (*bind_event)(struct snd_soc_component *scomp, struct snd_sof_widget *swidget,\n\t\t\t  u16 event_type);\n\tint (*ipc_prepare)(struct snd_sof_widget *swidget,\n\t\t\t   struct snd_pcm_hw_params *fe_params,\n\t\t\t   struct snd_sof_platform_stream_params *platform_params,\n\t\t\t   struct snd_pcm_hw_params *source_params, int dir);\n\tvoid (*ipc_unprepare)(struct snd_sof_widget *swidget);\n};\n\n \nstruct sof_ipc_tplg_ops {\n\tconst struct sof_ipc_tplg_widget_ops *widget;\n\tconst struct sof_ipc_tplg_control_ops *control;\n\tint (*route_setup)(struct snd_sof_dev *sdev, struct snd_sof_route *sroute);\n\tint (*route_free)(struct snd_sof_dev *sdev, struct snd_sof_route *sroute);\n\tconst struct sof_token_info *token_list;\n\tint (*control_setup)(struct snd_sof_dev *sdev, struct snd_sof_control *scontrol);\n\tint (*control_free)(struct snd_sof_dev *sdev, struct snd_sof_control *scontrol);\n\tint (*pipeline_complete)(struct snd_sof_dev *sdev, struct snd_sof_widget *swidget);\n\tint (*widget_setup)(struct snd_sof_dev *sdev, struct snd_sof_widget *swidget);\n\tint (*widget_free)(struct snd_sof_dev *sdev, struct snd_sof_widget *swidget);\n\tint (*dai_config)(struct snd_sof_dev *sdev, struct snd_sof_widget *swidget,\n\t\t\t  unsigned int flags, struct snd_sof_dai_config_data *data);\n\tint (*dai_get_clk)(struct snd_sof_dev *sdev, struct snd_sof_dai *dai, int clk_type);\n\tint (*set_up_all_pipelines)(struct snd_sof_dev *sdev, bool verify);\n\tint (*tear_down_all_pipelines)(struct snd_sof_dev *sdev, bool verify);\n\tint (*parse_manifest)(struct snd_soc_component *scomp, int index,\n\t\t\t      struct snd_soc_tplg_manifest *man);\n\tint (*link_setup)(struct snd_sof_dev *sdev, struct snd_soc_dai_link *link);\n};\n\n \nstruct snd_sof_tuple {\n\tu32 token;\n\tunion {\n\t\tu32 v;\n\t\tconst char *s;\n\t} value;\n};\n\n \nenum sof_tokens {\n\tSOF_PCM_TOKENS,\n\tSOF_PIPELINE_TOKENS,\n\tSOF_SCHED_TOKENS,\n\tSOF_ASRC_TOKENS,\n\tSOF_SRC_TOKENS,\n\tSOF_COMP_TOKENS,\n\tSOF_BUFFER_TOKENS,\n\tSOF_VOLUME_TOKENS,\n\tSOF_PROCESS_TOKENS,\n\tSOF_DAI_TOKENS,\n\tSOF_DAI_LINK_TOKENS,\n\tSOF_HDA_TOKENS,\n\tSOF_SSP_TOKENS,\n\tSOF_ALH_TOKENS,\n\tSOF_DMIC_TOKENS,\n\tSOF_DMIC_PDM_TOKENS,\n\tSOF_ESAI_TOKENS,\n\tSOF_SAI_TOKENS,\n\tSOF_AFE_TOKENS,\n\tSOF_CORE_TOKENS,\n\tSOF_COMP_EXT_TOKENS,\n\tSOF_IN_AUDIO_FORMAT_TOKENS,\n\tSOF_OUT_AUDIO_FORMAT_TOKENS,\n\tSOF_COPIER_DEEP_BUFFER_TOKENS,\n\tSOF_COPIER_TOKENS,\n\tSOF_AUDIO_FMT_NUM_TOKENS,\n\tSOF_COPIER_FORMAT_TOKENS,\n\tSOF_GAIN_TOKENS,\n\tSOF_ACPDMIC_TOKENS,\n\tSOF_ACPI2S_TOKENS,\n\n\t \n\tSOF_TOKEN_COUNT,\n};\n\n \nstruct sof_topology_token {\n\tu32 token;\n\tu32 type;\n\tint (*get_token)(void *elem, void *object, u32 offset);\n\tu32 offset;\n};\n\nstruct sof_token_info {\n\tconst char *name;\n\tconst struct sof_topology_token *tokens;\n\tint count;\n};\n\n \nstruct snd_sof_pcm_stream_pipeline_list {\n\tu32 count;\n\tstruct snd_sof_pipeline **pipelines;\n};\n\n \nstruct snd_sof_pcm_stream {\n\tu32 comp_id;\n\tstruct snd_dma_buffer page_table;\n\tstruct sof_ipc_stream_posn posn;\n\tstruct snd_pcm_substream *substream;\n\tstruct snd_compr_stream *cstream;\n\tstruct work_struct period_elapsed_work;\n\tstruct snd_soc_dapm_widget_list *list;  \n\tbool d0i3_compatible;  \n\t \n\tbool suspend_ignored;\n\tstruct snd_sof_pcm_stream_pipeline_list pipeline_list;\n\n\t \n\tvoid *private;\n};\n\n \nstruct snd_sof_pcm {\n\tstruct snd_soc_component *scomp;\n\tstruct snd_soc_tplg_pcm pcm;\n\tstruct snd_sof_pcm_stream stream[2];\n\tstruct list_head list;\t \n\tstruct snd_pcm_hw_params params[2];\n\tbool prepared[2];  \n};\n\nstruct snd_sof_led_control {\n\tunsigned int use_led;\n\tunsigned int direction;\n\tint led_value;\n};\n\n \nstruct snd_sof_control {\n\tstruct snd_soc_component *scomp;\n\tconst char *name;\n\tint comp_id;\n\tint min_volume_step;  \n\tint max_volume_step;  \n\tint num_channels;\n\tunsigned int access;\n\tint info_type;\n\tint index;  \n\tvoid *priv;  \n\tsize_t priv_size;  \n\tsize_t max_size;\n\tvoid *ipc_control_data;\n\tvoid *old_ipc_control_data;\n\tint max;  \n\tu32 size;\t \n\tu32 *volume_table;  \n\n\tstruct list_head list;\t \n\n\tstruct snd_sof_led_control led_ctl;\n\n\t \n\tbool comp_data_dirty;\n};\n\n \nstruct snd_sof_dai_link {\n\tstruct snd_sof_tuple *tuples;\n\tint num_tuples;\n\tstruct snd_soc_dai_link *link;\n\tstruct snd_soc_tplg_hw_config *hw_configs;\n\tint num_hw_configs;\n\tint default_hw_cfg_id;\n\tint type;\n\tstruct list_head list;\n};\n\n \nstruct snd_sof_widget {\n\tstruct snd_soc_component *scomp;\n\tint comp_id;\n\tint pipeline_id;\n\t \n\tbool prepared;\n\n\tstruct mutex setup_mutex;  \n\n\t \n\tint use_count;\n\n\tint core;\n\tint id;  \n\t \n\tint instance_id;\n\n\t \n\tbool dynamic_pipeline_widget;\n\n\tstruct snd_soc_dapm_widget *widget;\n\tstruct list_head list;\t \n\tstruct snd_sof_pipeline *spipe;\n\tvoid *module_info;\n\n\tconst guid_t uuid;\n\n\tint num_tuples;\n\tstruct snd_sof_tuple *tuples;\n\n\t \n\tu32 num_input_pins;\n\tu32 num_output_pins;\n\n\t \n\tchar **input_pin_binding;\n\tchar **output_pin_binding;\n\n\tstruct ida output_queue_ida;\n\tstruct ida input_queue_ida;\n\n\tvoid *private;\t\t \n};\n\n \nstruct snd_sof_pipeline {\n\tstruct snd_sof_widget *pipe_widget;\n\tint started_count;\n\tint paused_count;\n\tint complete;\n\tunsigned long core_mask;\n\tstruct list_head list;\n};\n\n \nstruct snd_sof_route {\n\tstruct snd_soc_component *scomp;\n\n\tstruct snd_soc_dapm_route *route;\n\tstruct list_head list;\t \n\tstruct snd_sof_widget *src_widget;\n\tstruct snd_sof_widget *sink_widget;\n\tbool setup;\n\n\tint src_queue_id;\n\tint dst_queue_id;\n\n\tvoid *private;\n};\n\n \nstruct snd_sof_dai {\n\tstruct snd_soc_component *scomp;\n\tconst char *name;\n\n\tint number_configs;\n\tint current_config;\n\tstruct list_head list;\t \n\t \n\tconst void *platform_private;\n\tvoid *private;\n};\n\n \n\nint snd_sof_volume_get(struct snd_kcontrol *kcontrol,\n\t\t       struct snd_ctl_elem_value *ucontrol);\nint snd_sof_volume_put(struct snd_kcontrol *kcontrol,\n\t\t       struct snd_ctl_elem_value *ucontrol);\nint snd_sof_volume_info(struct snd_kcontrol *kcontrol,\n\t\t\tstruct snd_ctl_elem_info *uinfo);\nint snd_sof_switch_get(struct snd_kcontrol *kcontrol,\n\t\t       struct snd_ctl_elem_value *ucontrol);\nint snd_sof_switch_put(struct snd_kcontrol *kcontrol,\n\t\t       struct snd_ctl_elem_value *ucontrol);\nint snd_sof_enum_get(struct snd_kcontrol *kcontrol,\n\t\t     struct snd_ctl_elem_value *ucontrol);\nint snd_sof_enum_put(struct snd_kcontrol *kcontrol,\n\t\t     struct snd_ctl_elem_value *ucontrol);\nint snd_sof_bytes_get(struct snd_kcontrol *kcontrol,\n\t\t      struct snd_ctl_elem_value *ucontrol);\nint snd_sof_bytes_put(struct snd_kcontrol *kcontrol,\n\t\t      struct snd_ctl_elem_value *ucontrol);\nint snd_sof_bytes_ext_put(struct snd_kcontrol *kcontrol,\n\t\t\t  const unsigned int __user *binary_data,\n\t\t\t  unsigned int size);\nint snd_sof_bytes_ext_get(struct snd_kcontrol *kcontrol,\n\t\t\t  unsigned int __user *binary_data,\n\t\t\t  unsigned int size);\nint snd_sof_bytes_ext_volatile_get(struct snd_kcontrol *kcontrol, unsigned int __user *binary_data,\n\t\t\t\t   unsigned int size);\nvoid snd_sof_control_notify(struct snd_sof_dev *sdev,\n\t\t\t    struct sof_ipc_ctrl_data *cdata);\n\n \nint snd_sof_load_topology(struct snd_soc_component *scomp, const char *file);\n\n \nint snd_sof_ipc_stream_posn(struct snd_soc_component *scomp,\n\t\t\t    struct snd_sof_pcm *spcm, int direction,\n\t\t\t    struct sof_ipc_stream_posn *posn);\n\nstruct snd_sof_widget *snd_sof_find_swidget(struct snd_soc_component *scomp,\n\t\t\t\t\t    const char *name);\nstruct snd_sof_widget *\nsnd_sof_find_swidget_sname(struct snd_soc_component *scomp,\n\t\t\t   const char *pcm_name, int dir);\nstruct snd_sof_dai *snd_sof_find_dai(struct snd_soc_component *scomp,\n\t\t\t\t     const char *name);\n\nstatic inline\nstruct snd_sof_pcm *snd_sof_find_spcm_dai(struct snd_soc_component *scomp,\n\t\t\t\t\t  struct snd_soc_pcm_runtime *rtd)\n{\n\tstruct snd_sof_dev *sdev = snd_soc_component_get_drvdata(scomp);\n\tstruct snd_sof_pcm *spcm;\n\n\tlist_for_each_entry(spcm, &sdev->pcm_list, list) {\n\t\tif (le32_to_cpu(spcm->pcm.dai_id) == rtd->dai_link->id)\n\t\t\treturn spcm;\n\t}\n\n\treturn NULL;\n}\n\nstruct snd_sof_pcm *snd_sof_find_spcm_name(struct snd_soc_component *scomp,\n\t\t\t\t\t   const char *name);\nstruct snd_sof_pcm *snd_sof_find_spcm_comp(struct snd_soc_component *scomp,\n\t\t\t\t\t   unsigned int comp_id,\n\t\t\t\t\t   int *direction);\nvoid snd_sof_pcm_period_elapsed(struct snd_pcm_substream *substream);\nvoid snd_sof_pcm_init_elapsed_work(struct work_struct *work);\n\n#if IS_ENABLED(CONFIG_SND_SOC_SOF_COMPRESS)\nvoid snd_sof_compr_fragment_elapsed(struct snd_compr_stream *cstream);\nvoid snd_sof_compr_init_elapsed_work(struct work_struct *work);\n#else\nstatic inline void snd_sof_compr_fragment_elapsed(struct snd_compr_stream *cstream) { }\nstatic inline void snd_sof_compr_init_elapsed_work(struct work_struct *work) { }\n#endif\n\n \nint sof_pcm_dai_link_fixup(struct snd_soc_pcm_runtime *rtd, struct snd_pcm_hw_params *params);\n\n \nbool snd_sof_stream_suspend_ignored(struct snd_sof_dev *sdev);\nbool snd_sof_dsp_only_d0i3_compatible_stream_active(struct snd_sof_dev *sdev);\n\n \nint sof_machine_register(struct snd_sof_dev *sdev, void *pdata);\nvoid sof_machine_unregister(struct snd_sof_dev *sdev, void *pdata);\n\nint sof_widget_setup(struct snd_sof_dev *sdev, struct snd_sof_widget *swidget);\nint sof_widget_free(struct snd_sof_dev *sdev, struct snd_sof_widget *swidget);\nint sof_route_setup(struct snd_sof_dev *sdev, struct snd_soc_dapm_widget *wsource,\n\t\t    struct snd_soc_dapm_widget *wsink);\n\n \nint sof_widget_list_setup(struct snd_sof_dev *sdev, struct snd_sof_pcm *spcm,\n\t\t\t  struct snd_pcm_hw_params *fe_params,\n\t\t\t  struct snd_sof_platform_stream_params *platform_params,\n\t\t\t  int dir);\nint sof_widget_list_free(struct snd_sof_dev *sdev, struct snd_sof_pcm *spcm, int dir);\nint sof_pcm_dsp_pcm_free(struct snd_pcm_substream *substream, struct snd_sof_dev *sdev,\n\t\t\t struct snd_sof_pcm *spcm);\nint sof_pcm_stream_free(struct snd_sof_dev *sdev, struct snd_pcm_substream *substream,\n\t\t\tstruct snd_sof_pcm *spcm, int dir, bool free_widget_list);\nint get_token_u32(void *elem, void *object, u32 offset);\nint get_token_u16(void *elem, void *object, u32 offset);\nint get_token_comp_format(void *elem, void *object, u32 offset);\nint get_token_dai_type(void *elem, void *object, u32 offset);\nint get_token_uuid(void *elem, void *object, u32 offset);\nint get_token_string(void *elem, void *object, u32 offset);\nint sof_update_ipc_object(struct snd_soc_component *scomp, void *object, enum sof_tokens token_id,\n\t\t\t  struct snd_sof_tuple *tuples, int num_tuples,\n\t\t\t  size_t object_size, int token_instance_num);\nu32 vol_compute_gain(u32 value, int *tlv);\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}