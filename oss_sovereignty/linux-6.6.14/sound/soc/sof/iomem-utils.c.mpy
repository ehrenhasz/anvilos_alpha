{
  "module_name": "iomem-utils.c",
  "hash_id": "6a3451594d656038615e9e43418f90201f65452d156e7c56f3fea1a99dc2c7f2",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/sof/iomem-utils.c",
  "human_readable_source": "\n\n\n\n\n\n\n\n\n\n#include <linux/io-64-nonatomic-lo-hi.h>\n#include <linux/platform_device.h>\n#include <asm/unaligned.h>\n#include <sound/soc.h>\n#include <sound/sof.h>\n#include \"sof-priv.h\"\n#include \"ops.h\"\n\n \n\nvoid sof_io_write(struct snd_sof_dev *sdev, void __iomem *addr, u32 value)\n{\n\twritel(value, addr);\n}\nEXPORT_SYMBOL(sof_io_write);\n\nu32 sof_io_read(struct snd_sof_dev *sdev, void __iomem *addr)\n{\n\treturn readl(addr);\n}\nEXPORT_SYMBOL(sof_io_read);\n\nvoid sof_io_write64(struct snd_sof_dev *sdev, void __iomem *addr, u64 value)\n{\n\twriteq(value, addr);\n}\nEXPORT_SYMBOL(sof_io_write64);\n\nu64 sof_io_read64(struct snd_sof_dev *sdev, void __iomem *addr)\n{\n\treturn readq(addr);\n}\nEXPORT_SYMBOL(sof_io_read64);\n\n \n\nvoid sof_mailbox_write(struct snd_sof_dev *sdev, u32 offset,\n\t\t       void *message, size_t bytes)\n{\n\tvoid __iomem *dest = sdev->bar[sdev->mailbox_bar] + offset;\n\n\tmemcpy_toio(dest, message, bytes);\n}\nEXPORT_SYMBOL(sof_mailbox_write);\n\nvoid sof_mailbox_read(struct snd_sof_dev *sdev, u32 offset,\n\t\t      void *message, size_t bytes)\n{\n\tvoid __iomem *src = sdev->bar[sdev->mailbox_bar] + offset;\n\n\tmemcpy_fromio(message, src, bytes);\n}\nEXPORT_SYMBOL(sof_mailbox_read);\n\n \n\nint sof_block_write(struct snd_sof_dev *sdev, enum snd_sof_fw_blk_type blk_type,\n\t\t    u32 offset, void *src, size_t size)\n{\n\tint bar = snd_sof_dsp_get_bar_index(sdev, blk_type);\n\tconst u8 *src_byte = src;\n\tvoid __iomem *dest;\n\tu32 affected_mask;\n\tu32 tmp;\n\tint m, n;\n\n\tif (bar < 0)\n\t\treturn bar;\n\n\tdest = sdev->bar[bar] + offset;\n\n\tm = size / 4;\n\tn = size % 4;\n\n\t \n\t__iowrite32_copy(dest, src, m);\n\n\tif (n) {\n\t\taffected_mask = (1 << (8 * n)) - 1;\n\n\t\t \n\t\ttmp = ioread32(dest + m * 4);\n\t\ttmp &= ~affected_mask;\n\n\t\ttmp |= *(u32 *)(src_byte + m * 4) & affected_mask;\n\t\tiowrite32(tmp, dest + m * 4);\n\t}\n\n\treturn 0;\n}\nEXPORT_SYMBOL(sof_block_write);\n\nint sof_block_read(struct snd_sof_dev *sdev, enum snd_sof_fw_blk_type blk_type,\n\t\t   u32 offset, void *dest, size_t size)\n{\n\tint bar = snd_sof_dsp_get_bar_index(sdev, blk_type);\n\n\tif (bar < 0)\n\t\treturn bar;\n\n\tmemcpy_fromio(dest, sdev->bar[bar] + offset, size);\n\n\treturn 0;\n}\nEXPORT_SYMBOL(sof_block_read);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}