{
  "module_name": "ops.c",
  "hash_id": "bc5b74aa5647d587aac89978ef66f6d43f4364c803331684d7ada3992571e9ed",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/sof/ops.c",
  "human_readable_source": "\n\n\n\n\n\n\n\n\n\n#include <linux/pci.h>\n#include \"ops.h\"\n\nstatic\nbool snd_sof_pci_update_bits_unlocked(struct snd_sof_dev *sdev, u32 offset,\n\t\t\t\t      u32 mask, u32 value)\n{\n\tstruct pci_dev *pci = to_pci_dev(sdev->dev);\n\tunsigned int old, new;\n\tu32 ret = 0;\n\n\tpci_read_config_dword(pci, offset, &ret);\n\told = ret;\n\tdev_dbg(sdev->dev, \"Debug PCIR: %8.8x at  %8.8x\\n\", old & mask, offset);\n\n\tnew = (old & ~mask) | (value & mask);\n\n\tif (old == new)\n\t\treturn false;\n\n\tpci_write_config_dword(pci, offset, new);\n\tdev_dbg(sdev->dev, \"Debug PCIW: %8.8x at  %8.8x\\n\", value,\n\t\toffset);\n\n\treturn true;\n}\n\nbool snd_sof_pci_update_bits(struct snd_sof_dev *sdev, u32 offset,\n\t\t\t     u32 mask, u32 value)\n{\n\tunsigned long flags;\n\tbool change;\n\n\tspin_lock_irqsave(&sdev->hw_lock, flags);\n\tchange = snd_sof_pci_update_bits_unlocked(sdev, offset, mask, value);\n\tspin_unlock_irqrestore(&sdev->hw_lock, flags);\n\treturn change;\n}\nEXPORT_SYMBOL(snd_sof_pci_update_bits);\n\nbool snd_sof_dsp_update_bits_unlocked(struct snd_sof_dev *sdev, u32 bar,\n\t\t\t\t      u32 offset, u32 mask, u32 value)\n{\n\tunsigned int old, new;\n\tu32 ret;\n\n\tret = snd_sof_dsp_read(sdev, bar, offset);\n\n\told = ret;\n\tnew = (old & ~mask) | (value & mask);\n\n\tif (old == new)\n\t\treturn false;\n\n\tsnd_sof_dsp_write(sdev, bar, offset, new);\n\n\treturn true;\n}\nEXPORT_SYMBOL(snd_sof_dsp_update_bits_unlocked);\n\nbool snd_sof_dsp_update_bits64_unlocked(struct snd_sof_dev *sdev, u32 bar,\n\t\t\t\t\tu32 offset, u64 mask, u64 value)\n{\n\tu64 old, new;\n\n\told = snd_sof_dsp_read64(sdev, bar, offset);\n\n\tnew = (old & ~mask) | (value & mask);\n\n\tif (old == new)\n\t\treturn false;\n\n\tsnd_sof_dsp_write64(sdev, bar, offset, new);\n\n\treturn true;\n}\nEXPORT_SYMBOL(snd_sof_dsp_update_bits64_unlocked);\n\n \nbool snd_sof_dsp_update_bits(struct snd_sof_dev *sdev, u32 bar, u32 offset,\n\t\t\t     u32 mask, u32 value)\n{\n\tunsigned long flags;\n\tbool change;\n\n\tspin_lock_irqsave(&sdev->hw_lock, flags);\n\tchange = snd_sof_dsp_update_bits_unlocked(sdev, bar, offset, mask,\n\t\t\t\t\t\t  value);\n\tspin_unlock_irqrestore(&sdev->hw_lock, flags);\n\treturn change;\n}\nEXPORT_SYMBOL(snd_sof_dsp_update_bits);\n\nbool snd_sof_dsp_update_bits64(struct snd_sof_dev *sdev, u32 bar, u32 offset,\n\t\t\t       u64 mask, u64 value)\n{\n\tunsigned long flags;\n\tbool change;\n\n\tspin_lock_irqsave(&sdev->hw_lock, flags);\n\tchange = snd_sof_dsp_update_bits64_unlocked(sdev, bar, offset, mask,\n\t\t\t\t\t\t    value);\n\tspin_unlock_irqrestore(&sdev->hw_lock, flags);\n\treturn change;\n}\nEXPORT_SYMBOL(snd_sof_dsp_update_bits64);\n\nstatic\nvoid snd_sof_dsp_update_bits_forced_unlocked(struct snd_sof_dev *sdev, u32 bar,\n\t\t\t\t\t     u32 offset, u32 mask, u32 value)\n{\n\tunsigned int old, new;\n\tu32 ret;\n\n\tret = snd_sof_dsp_read(sdev, bar, offset);\n\n\told = ret;\n\tnew = (old & ~mask) | (value & mask);\n\n\tsnd_sof_dsp_write(sdev, bar, offset, new);\n}\n\n \nvoid snd_sof_dsp_update_bits_forced(struct snd_sof_dev *sdev, u32 bar,\n\t\t\t\t    u32 offset, u32 mask, u32 value)\n{\n\tunsigned long flags;\n\n\tspin_lock_irqsave(&sdev->hw_lock, flags);\n\tsnd_sof_dsp_update_bits_forced_unlocked(sdev, bar, offset, mask, value);\n\tspin_unlock_irqrestore(&sdev->hw_lock, flags);\n}\nEXPORT_SYMBOL(snd_sof_dsp_update_bits_forced);\n\n \nvoid snd_sof_dsp_panic(struct snd_sof_dev *sdev, u32 offset, bool non_recoverable)\n{\n\t \n\tif (!sdev->dsp_oops_offset)\n\t\tsdev->dsp_oops_offset = offset;\n\n\t \n\tif (sdev->dsp_oops_offset != offset)\n\t\tdev_warn(sdev->dev,\n\t\t\t \"%s: dsp_oops_offset %zu differs from panic offset %u\\n\",\n\t\t\t __func__, sdev->dsp_oops_offset, offset);\n\n\t \n\tsdev->dbg_dump_printed = false;\n\tif (non_recoverable) {\n\t\tsnd_sof_dsp_dbg_dump(sdev, \"DSP panic!\",\n\t\t\t\t     SOF_DBG_DUMP_REGS | SOF_DBG_DUMP_MBOX);\n\t\tsof_set_fw_state(sdev, SOF_FW_CRASHED);\n\t\tsof_fw_trace_fw_crashed(sdev);\n\t} else {\n\t\tsnd_sof_dsp_dbg_dump(sdev,\n\t\t\t\t     \"DSP panic (recovery will be attempted)\",\n\t\t\t\t     SOF_DBG_DUMP_REGS | SOF_DBG_DUMP_MBOX);\n\t}\n}\nEXPORT_SYMBOL(snd_sof_dsp_panic);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}