{
  "module_name": "acp.h",
  "hash_id": "edb227e025655d094777de84387ddc311cae5d95225ebc791670dbfc3fe44cfc",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/sof/amd/acp.h",
  "human_readable_source": " \n \n\n#ifndef __SOF_AMD_ACP_H\n#define __SOF_AMD_ACP_H\n\n#include <linux/dmi.h>\n\n#include \"../sof-priv.h\"\n#include \"../sof-audio.h\"\n\n#define ACP_MAX_STREAM\t8\n\n#define ACP_DSP_BAR\t0\n\n#define ACP_HW_SEM_RETRY_COUNT\t\t\t10000\n#define ACP_REG_POLL_INTERVAL                   500\n#define ACP_REG_POLL_TIMEOUT_US                 2000\n#define ACP_DMA_COMPLETE_TIMEOUT_US\t\t5000\n\n#define ACP_PGFSM_CNTL_POWER_ON_MASK\t\t0x01\n#define ACP_PGFSM_STATUS_MASK\t\t\t0x03\n#define ACP_POWERED_ON\t\t\t\t0x00\n#define ACP_ASSERT_RESET\t\t\t0x01\n#define ACP_RELEASE_RESET\t\t\t0x00\n#define ACP_SOFT_RESET_DONE_MASK\t\t0x00010001\n\n#define ACP_DSP_INTR_EN_MASK\t\t\t0x00000001\n#define ACP3X_SRAM_PTE_OFFSET\t\t\t0x02050000\n#define ACP5X_SRAM_PTE_OFFSET\t\t\t0x02050000\n#define ACP6X_SRAM_PTE_OFFSET\t\t\t0x03800000\n#define PAGE_SIZE_4K_ENABLE\t\t\t0x2\n#define ACP_PAGE_SIZE\t\t\t\t0x1000\n#define ACP_DMA_CH_RUN\t\t\t\t0x02\n#define ACP_MAX_DESC_CNT\t\t\t0x02\n#define DSP_FW_RUN_ENABLE\t\t\t0x01\n#define ACP_SHA_RUN\t\t\t\t0x01\n#define ACP_SHA_RESET\t\t\t\t0x02\n#define ACP_SHA_HEADER\t\t\t\t0x01\n#define ACP_DMA_CH_RST\t\t\t\t0x01\n#define ACP_DMA_CH_GRACEFUL_RST_EN\t\t0x10\n#define ACP_ATU_CACHE_INVALID\t\t\t0x01\n#define ACP_MAX_DESC\t\t\t\t128\n#define ACPBUS_REG_BASE_OFFSET\t\t\tACP_DMA_CNTL_0\n\n#define ACP_DEFAULT_DRAM_LENGTH\t\t\t0x00080000\n#define ACP3X_SCRATCH_MEMORY_ADDRESS\t\t0x02050000\n#define ACP_SYSTEM_MEMORY_WINDOW\t\t0x4000000\n#define ACP_IRAM_BASE_ADDRESS\t\t\t0x000000\n#define ACP_DATA_RAM_BASE_ADDRESS\t\t0x01000000\n#define ACP_DRAM_PAGE_COUNT\t\t\t128\n\n#define ACP_DSP_TO_HOST_IRQ\t\t\t0x04\n\n#define ACP_RN_PCI_ID\t\t\t\t0x01\n#define ACP_VANGOGH_PCI_ID\t\t\t0x50\n#define ACP_RMB_PCI_ID\t\t\t\t0x6F\n\n#define HOST_BRIDGE_CZN\t\t\t\t0x1630\n#define HOST_BRIDGE_VGH\t\t\t\t0x1645\n#define HOST_BRIDGE_RMB\t\t\t\t0x14B5\n#define ACP_SHA_STAT\t\t\t\t0x8000\n#define ACP_PSP_TIMEOUT_US\t\t\t1000000\n#define ACP_EXT_INTR_ERROR_STAT\t\t\t0x20000000\n#define MP0_C2PMSG_114_REG\t\t\t0x3810AC8\n#define MP0_C2PMSG_73_REG\t\t\t0x3810A24\n#define MBOX_ACP_SHA_DMA_COMMAND\t\t0x70000\n#define MBOX_DELAY_US\t\t\t\t1000\n#define MBOX_READY_MASK\t\t\t\t0x80000000\n#define MBOX_STATUS_MASK\t\t\t0xFFFF\n\n#define BOX_SIZE_512\t\t\t\t0x200\n#define BOX_SIZE_1024\t\t\t\t0x400\n\n#define EXCEPT_MAX_HDR_SIZE\t\t\t0x400\n#define AMD_STACK_DUMP_SIZE\t\t\t32\n\n#define SRAM1_SIZE\t\t\t\t0x13A000\n#define PROBE_STATUS_BIT\t\t\tBIT(31)\n\n#define ACP_FIRMWARE_SIGNATURE\t\t\t0x100\n\nenum clock_source {\n\tACP_CLOCK_96M = 0,\n\tACP_CLOCK_48M,\n\tACP_CLOCK_24M,\n\tACP_CLOCK_ACLK,\n\tACP_CLOCK_MCLK,\n};\n\nstruct  acp_atu_grp_pte {\n\tu32 low;\n\tu32 high;\n};\n\nunion dma_tx_cnt {\n\tstruct {\n\t\tunsigned int count : 19;\n\t\tunsigned int reserved : 12;\n\t\tunsigned ioc : 1;\n\t} bitfields, bits;\n\tunsigned int u32_all;\n\tsigned int i32_all;\n};\n\nstruct dma_descriptor {\n\tunsigned int src_addr;\n\tunsigned int dest_addr;\n\tunion dma_tx_cnt tx_cnt;\n\tunsigned int reserved;\n};\n\n \nstruct  scratch_ipc_conf {\n\t \n\tu8 sof_debug_box[1024];\n\t \n\tu8 sof_except_box[1024];\n\t \n\tu8 sof_stream_box[1024];\n\t \n\tu8 sof_trace_box[1024];\n\t \n\tu32 sof_host_msg_write;\n\t \n\tu32 sof_host_ack_write;\n\t \n\tu32 sof_dsp_msg_write;\n\t \n\tu32 sof_dsp_ack_write;\n};\n\nstruct  scratch_reg_conf {\n\tstruct scratch_ipc_conf info;\n\tstruct acp_atu_grp_pte grp1_pte[16];\n\tstruct acp_atu_grp_pte grp2_pte[16];\n\tstruct acp_atu_grp_pte grp3_pte[16];\n\tstruct acp_atu_grp_pte grp4_pte[16];\n\tstruct acp_atu_grp_pte grp5_pte[16];\n\tstruct acp_atu_grp_pte grp6_pte[16];\n\tstruct acp_atu_grp_pte grp7_pte[16];\n\tstruct acp_atu_grp_pte grp8_pte[16];\n\tstruct dma_descriptor dma_desc[64];\n\tunsigned int reg_offset[8];\n\tunsigned int buf_size[8];\n\tu8 acp_tx_fifo_buf[256];\n\tu8 acp_rx_fifo_buf[256];\n\tunsigned int    reserve[];\n};\n\nstruct acp_dsp_stream {\n\tstruct list_head list;\n\tstruct snd_sof_dev *sdev;\n\tstruct snd_pcm_substream *substream;\n\tstruct snd_dma_buffer *dmab;\n\tint num_pages;\n\tint stream_tag;\n\tint active;\n\tunsigned int reg_offset;\n\tsize_t posn_offset;\n\tstruct snd_compr_stream *cstream;\n\tu64 cstream_posn;\n};\n\nstruct sof_amd_acp_desc {\n\tunsigned int rev;\n\tconst char *name;\n\tunsigned int host_bridge_id;\n\tu32 pgfsm_base;\n\tu32 ext_intr_enb;\n\tu32 ext_intr_stat;\n\tu32 dsp_intr_base;\n\tu32 sram_pte_offset;\n\tu32 hw_semaphore_offset;\n\tu32 acp_clkmux_sel;\n\tu32 fusion_dsp_offset;\n\tu32 probe_reg_offset;\n};\n\n \nstruct acp_dev_data {\n\tstruct snd_sof_dev  *dev;\n\tconst struct firmware *fw_dbin;\n\t \n\tstruct platform_device *dmic_dev;\n\tunsigned int fw_bin_size;\n\tunsigned int fw_data_bin_size;\n\tconst char *fw_code_bin;\n\tconst char *fw_data_bin;\n\tu32 fw_bin_page_count;\n\tdma_addr_t sha_dma_addr;\n\tu8 *bin_buf;\n\tdma_addr_t dma_addr;\n\tu8 *data_buf;\n\tbool signed_fw_image;\n\tstruct dma_descriptor dscr_info[ACP_MAX_DESC];\n\tstruct acp_dsp_stream stream_buf[ACP_MAX_STREAM];\n\tstruct acp_dsp_stream *dtrace_stream;\n\tstruct pci_dev *smn_dev;\n\tstruct acp_dsp_stream *probe_stream;\n\tbool enable_fw_debug;\n};\n\nvoid memcpy_to_scratch(struct snd_sof_dev *sdev, u32 offset, unsigned int *src, size_t bytes);\nvoid memcpy_from_scratch(struct snd_sof_dev *sdev, u32 offset, unsigned int *dst, size_t bytes);\n\nint acp_dma_status(struct acp_dev_data *adata, unsigned char ch);\nint configure_and_run_dma(struct acp_dev_data *adata, unsigned int src_addr,\n\t\t\t  unsigned int dest_addr, int dsp_data_size);\nint configure_and_run_sha_dma(struct acp_dev_data *adata, void *image_addr,\n\t\t\t      unsigned int start_addr, unsigned int dest_addr,\n\t\t\t      unsigned int image_length);\n\n \nint amd_sof_acp_probe(struct snd_sof_dev *sdev);\nint amd_sof_acp_remove(struct snd_sof_dev *sdev);\n\n \nint acp_sof_dsp_run(struct snd_sof_dev *sdev);\nint acp_dsp_pre_fw_run(struct snd_sof_dev *sdev);\nint acp_sof_load_signed_firmware(struct snd_sof_dev *sdev);\nint acp_get_bar_index(struct snd_sof_dev *sdev, u32 type);\n\n \nint acp_dsp_block_write(struct snd_sof_dev *sdev, enum snd_sof_fw_blk_type blk_type,\n\t\t\tu32 offset, void *src, size_t size);\nint acp_dsp_block_read(struct snd_sof_dev *sdev, enum snd_sof_fw_blk_type blk_type,\n\t\t       u32 offset, void *dest, size_t size);\n\n \nirqreturn_t acp_sof_ipc_irq_thread(int irq, void *context);\nint acp_sof_ipc_msg_data(struct snd_sof_dev *sdev, struct snd_sof_pcm_stream *sps,\n\t\t\t void *p, size_t sz);\nint acp_set_stream_data_offset(struct snd_sof_dev *sdev,\n\t\t\t       struct snd_sof_pcm_stream *sps,\n\t\t\t       size_t posn_offset);\nint acp_sof_ipc_send_msg(struct snd_sof_dev *sdev,\n\t\t\t struct snd_sof_ipc_msg *msg);\nint acp_sof_ipc_get_mailbox_offset(struct snd_sof_dev *sdev);\nint acp_sof_ipc_get_window_offset(struct snd_sof_dev *sdev, u32 id);\nvoid acp_mailbox_write(struct snd_sof_dev *sdev, u32 offset, void *message, size_t bytes);\nvoid acp_mailbox_read(struct snd_sof_dev *sdev, u32 offset, void *message, size_t bytes);\n\n \nint acp_dsp_stream_config(struct snd_sof_dev *sdev, struct acp_dsp_stream *stream);\nint acp_dsp_stream_init(struct snd_sof_dev *sdev);\nstruct acp_dsp_stream *acp_dsp_stream_get(struct snd_sof_dev *sdev, int tag);\nint acp_dsp_stream_put(struct snd_sof_dev *sdev, struct acp_dsp_stream *acp_stream);\n\n \nint acp_pcm_open(struct snd_sof_dev *sdev, struct snd_pcm_substream *substream);\nint acp_pcm_close(struct snd_sof_dev *sdev, struct snd_pcm_substream *substream);\nint acp_pcm_hw_params(struct snd_sof_dev *sdev, struct snd_pcm_substream *substream,\n\t\t      struct snd_pcm_hw_params *params,\n\t\t      struct snd_sof_platform_stream_params *platform_params);\nsnd_pcm_uframes_t acp_pcm_pointer(struct snd_sof_dev *sdev,\n\t\t\t\t  struct snd_pcm_substream *substream);\n\nextern struct snd_sof_dsp_ops sof_acp_common_ops;\n\nextern struct snd_sof_dsp_ops sof_renoir_ops;\nint sof_renoir_ops_init(struct snd_sof_dev *sdev);\nextern struct snd_sof_dsp_ops sof_vangogh_ops;\nint sof_vangogh_ops_init(struct snd_sof_dev *sdev);\nextern struct snd_sof_dsp_ops sof_rembrandt_ops;\nint sof_rembrandt_ops_init(struct snd_sof_dev *sdev);\n\nstruct snd_soc_acpi_mach *amd_sof_machine_select(struct snd_sof_dev *sdev);\n \nint snd_amd_acp_find_config(struct pci_dev *pci);\n\n \nint acp_sof_trace_init(struct snd_sof_dev *sdev, struct snd_dma_buffer *dmab,\n\t\t       struct sof_ipc_dma_trace_params_ext *dtrace_params);\nint acp_sof_trace_release(struct snd_sof_dev *sdev);\n\n \nint amd_sof_acp_suspend(struct snd_sof_dev *sdev, u32 target_state);\nint amd_sof_acp_resume(struct snd_sof_dev *sdev);\n\nvoid amd_sof_ipc_dump(struct snd_sof_dev *sdev);\nvoid amd_sof_dump(struct snd_sof_dev *sdev, u32 flags);\n\nstatic inline const struct sof_amd_acp_desc *get_chip_info(struct snd_sof_pdata *pdata)\n{\n\tconst struct sof_dev_desc *desc = pdata->desc;\n\n\treturn desc->chip_info;\n}\n\nint acp_probes_register(struct snd_sof_dev *sdev);\nvoid acp_probes_unregister(struct snd_sof_dev *sdev);\n\nextern struct snd_soc_acpi_mach snd_soc_acpi_amd_vangogh_sof_machines[];\nextern const struct dmi_system_id acp_sof_quirk_table[];\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}