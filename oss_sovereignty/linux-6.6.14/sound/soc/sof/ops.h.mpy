{
  "module_name": "ops.h",
  "hash_id": "b19004ca877b06d0494c1b6c636d5e114bddaf1c7ccc759d8532f324b28cdc65",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/sof/ops.h",
  "human_readable_source": " \n \n\n#ifndef __SOUND_SOC_SOF_IO_H\n#define __SOUND_SOC_SOF_IO_H\n\n#include <linux/device.h>\n#include <linux/interrupt.h>\n#include <linux/kernel.h>\n#include <linux/types.h>\n#include <sound/pcm.h>\n#include \"sof-priv.h\"\n\n#define sof_ops(sdev) \\\n\t((sdev)->pdata->desc->ops)\n\nstatic inline int sof_ops_init(struct snd_sof_dev *sdev)\n{\n\tif (sdev->pdata->desc->ops_init)\n\t\treturn sdev->pdata->desc->ops_init(sdev);\n\n\treturn 0;\n}\n\nstatic inline void sof_ops_free(struct snd_sof_dev *sdev)\n{\n\tif (sdev->pdata->desc->ops_free)\n\t\tsdev->pdata->desc->ops_free(sdev);\n}\n\n \n\n \nstatic inline int snd_sof_probe(struct snd_sof_dev *sdev)\n{\n\treturn sof_ops(sdev)->probe(sdev);\n}\n\nstatic inline int snd_sof_remove(struct snd_sof_dev *sdev)\n{\n\tif (sof_ops(sdev)->remove)\n\t\treturn sof_ops(sdev)->remove(sdev);\n\n\treturn 0;\n}\n\nstatic inline int snd_sof_shutdown(struct snd_sof_dev *sdev)\n{\n\tif (sof_ops(sdev)->shutdown)\n\t\treturn sof_ops(sdev)->shutdown(sdev);\n\n\treturn 0;\n}\n\n \n\n \nstatic inline int snd_sof_dsp_run(struct snd_sof_dev *sdev)\n{\n\treturn sof_ops(sdev)->run(sdev);\n}\n\nstatic inline int snd_sof_dsp_stall(struct snd_sof_dev *sdev, unsigned int core_mask)\n{\n\tif (sof_ops(sdev)->stall)\n\t\treturn sof_ops(sdev)->stall(sdev, core_mask);\n\n\treturn 0;\n}\n\nstatic inline int snd_sof_dsp_reset(struct snd_sof_dev *sdev)\n{\n\tif (sof_ops(sdev)->reset)\n\t\treturn sof_ops(sdev)->reset(sdev);\n\n\treturn 0;\n}\n\n \nstatic inline int snd_sof_dsp_core_get(struct snd_sof_dev *sdev, int core)\n{\n\tif (core > sdev->num_cores - 1) {\n\t\tdev_err(sdev->dev, \"invalid core id: %d for num_cores: %d\\n\", core,\n\t\t\tsdev->num_cores);\n\t\treturn -EINVAL;\n\t}\n\n\tif (sof_ops(sdev)->core_get) {\n\t\tint ret;\n\n\t\t \n\t\tif (sdev->dsp_core_ref_count[core] > 0) {\n\t\t\tsdev->dsp_core_ref_count[core]++;\n\t\t\treturn 0;\n\t\t}\n\n\t\t \n\t\tret = sof_ops(sdev)->core_get(sdev, core);\n\t\tif (ret < 0)\n\t\t\treturn ret;\n\n\t\t \n\t\tsdev->dsp_core_ref_count[core]++;\n\n\t\t \n\t\tsdev->enabled_cores_mask |= BIT(core);\n\n\t\tdev_dbg(sdev->dev, \"Core %d powered up\\n\", core);\n\t}\n\n\treturn 0;\n}\n\nstatic inline int snd_sof_dsp_core_put(struct snd_sof_dev *sdev, int core)\n{\n\tif (core > sdev->num_cores - 1) {\n\t\tdev_err(sdev->dev, \"invalid core id: %d for num_cores: %d\\n\", core,\n\t\t\tsdev->num_cores);\n\t\treturn -EINVAL;\n\t}\n\n\tif (sof_ops(sdev)->core_put) {\n\t\tint ret;\n\n\t\t \n\t\tif (--(sdev->dsp_core_ref_count[core]) > 0)\n\t\t\treturn 0;\n\n\t\t \n\t\tret = sof_ops(sdev)->core_put(sdev, core);\n\t\tif (ret < 0)\n\t\t\treturn ret;\n\n\t\t \n\t\tsdev->enabled_cores_mask &= ~BIT(core);\n\n\t\tdev_dbg(sdev->dev, \"Core %d powered down\\n\", core);\n\t}\n\n\treturn 0;\n}\n\n \nstatic inline int snd_sof_dsp_pre_fw_run(struct snd_sof_dev *sdev)\n{\n\tif (sof_ops(sdev)->pre_fw_run)\n\t\treturn sof_ops(sdev)->pre_fw_run(sdev);\n\n\treturn 0;\n}\n\nstatic inline int snd_sof_dsp_post_fw_run(struct snd_sof_dev *sdev)\n{\n\tif (sof_ops(sdev)->post_fw_run)\n\t\treturn sof_ops(sdev)->post_fw_run(sdev);\n\n\treturn 0;\n}\n\n \nstatic inline int snd_sof_dsp_parse_platform_ext_manifest(struct snd_sof_dev *sdev,\n\t\t\t\t\t\t\t  const struct sof_ext_man_elem_header *hdr)\n{\n\tif (sof_ops(sdev)->parse_platform_ext_manifest)\n\t\treturn sof_ops(sdev)->parse_platform_ext_manifest(sdev, hdr);\n\n\treturn 0;\n}\n\n \n\n \nstatic inline int snd_sof_dsp_get_bar_index(struct snd_sof_dev *sdev, u32 type)\n{\n\tif (sof_ops(sdev)->get_bar_index)\n\t\treturn sof_ops(sdev)->get_bar_index(sdev, type);\n\n\treturn sdev->mmio_bar;\n}\n\nstatic inline int snd_sof_dsp_get_mailbox_offset(struct snd_sof_dev *sdev)\n{\n\tif (sof_ops(sdev)->get_mailbox_offset)\n\t\treturn sof_ops(sdev)->get_mailbox_offset(sdev);\n\n\tdev_err(sdev->dev, \"error: %s not defined\\n\", __func__);\n\treturn -ENOTSUPP;\n}\n\nstatic inline int snd_sof_dsp_get_window_offset(struct snd_sof_dev *sdev,\n\t\t\t\t\t\tu32 id)\n{\n\tif (sof_ops(sdev)->get_window_offset)\n\t\treturn sof_ops(sdev)->get_window_offset(sdev, id);\n\n\tdev_err(sdev->dev, \"error: %s not defined\\n\", __func__);\n\treturn -ENOTSUPP;\n}\n \nstatic inline int snd_sof_dsp_resume(struct snd_sof_dev *sdev)\n{\n\tif (sof_ops(sdev)->resume)\n\t\treturn sof_ops(sdev)->resume(sdev);\n\n\treturn 0;\n}\n\nstatic inline int snd_sof_dsp_suspend(struct snd_sof_dev *sdev,\n\t\t\t\t      u32 target_state)\n{\n\tif (sof_ops(sdev)->suspend)\n\t\treturn sof_ops(sdev)->suspend(sdev, target_state);\n\n\treturn 0;\n}\n\nstatic inline int snd_sof_dsp_runtime_resume(struct snd_sof_dev *sdev)\n{\n\tif (sof_ops(sdev)->runtime_resume)\n\t\treturn sof_ops(sdev)->runtime_resume(sdev);\n\n\treturn 0;\n}\n\nstatic inline int snd_sof_dsp_runtime_suspend(struct snd_sof_dev *sdev)\n{\n\tif (sof_ops(sdev)->runtime_suspend)\n\t\treturn sof_ops(sdev)->runtime_suspend(sdev);\n\n\treturn 0;\n}\n\nstatic inline int snd_sof_dsp_runtime_idle(struct snd_sof_dev *sdev)\n{\n\tif (sof_ops(sdev)->runtime_idle)\n\t\treturn sof_ops(sdev)->runtime_idle(sdev);\n\n\treturn 0;\n}\n\nstatic inline int snd_sof_dsp_hw_params_upon_resume(struct snd_sof_dev *sdev)\n{\n\tif (sof_ops(sdev)->set_hw_params_upon_resume)\n\t\treturn sof_ops(sdev)->set_hw_params_upon_resume(sdev);\n\treturn 0;\n}\n\nstatic inline int snd_sof_dsp_set_clk(struct snd_sof_dev *sdev, u32 freq)\n{\n\tif (sof_ops(sdev)->set_clk)\n\t\treturn sof_ops(sdev)->set_clk(sdev, freq);\n\n\treturn 0;\n}\n\nstatic inline int\nsnd_sof_dsp_set_power_state(struct snd_sof_dev *sdev,\n\t\t\t    const struct sof_dsp_power_state *target_state)\n{\n\tint ret = 0;\n\n\tmutex_lock(&sdev->power_state_access);\n\n\tif (sof_ops(sdev)->set_power_state)\n\t\tret = sof_ops(sdev)->set_power_state(sdev, target_state);\n\n\tmutex_unlock(&sdev->power_state_access);\n\n\treturn ret;\n}\n\n \nvoid snd_sof_dsp_dbg_dump(struct snd_sof_dev *sdev, const char *msg, u32 flags);\n\nstatic inline int snd_sof_debugfs_add_region_item(struct snd_sof_dev *sdev,\n\t\tenum snd_sof_fw_blk_type blk_type, u32 offset, size_t size,\n\t\tconst char *name, enum sof_debugfs_access_type access_type)\n{\n\tif (sof_ops(sdev) && sof_ops(sdev)->debugfs_add_region_item)\n\t\treturn sof_ops(sdev)->debugfs_add_region_item(sdev, blk_type, offset,\n\t\t\t\t\t\t\t      size, name, access_type);\n\n\treturn 0;\n}\n\n \nstatic inline void snd_sof_dsp_write8(struct snd_sof_dev *sdev, u32 bar,\n\t\t\t\t      u32 offset, u8 value)\n{\n\tif (sof_ops(sdev)->write8)\n\t\tsof_ops(sdev)->write8(sdev, sdev->bar[bar] + offset, value);\n\telse\n\t\twriteb(value,  sdev->bar[bar] + offset);\n}\n\nstatic inline void snd_sof_dsp_write(struct snd_sof_dev *sdev, u32 bar,\n\t\t\t\t     u32 offset, u32 value)\n{\n\tif (sof_ops(sdev)->write)\n\t\tsof_ops(sdev)->write(sdev, sdev->bar[bar] + offset, value);\n\telse\n\t\twritel(value,  sdev->bar[bar] + offset);\n}\n\nstatic inline void snd_sof_dsp_write64(struct snd_sof_dev *sdev, u32 bar,\n\t\t\t\t       u32 offset, u64 value)\n{\n\tif (sof_ops(sdev)->write64)\n\t\tsof_ops(sdev)->write64(sdev, sdev->bar[bar] + offset, value);\n\telse\n\t\twriteq(value, sdev->bar[bar] + offset);\n}\n\nstatic inline u8 snd_sof_dsp_read8(struct snd_sof_dev *sdev, u32 bar,\n\t\t\t\t   u32 offset)\n{\n\tif (sof_ops(sdev)->read8)\n\t\treturn sof_ops(sdev)->read8(sdev, sdev->bar[bar] + offset);\n\telse\n\t\treturn readb(sdev->bar[bar] + offset);\n}\n\nstatic inline u32 snd_sof_dsp_read(struct snd_sof_dev *sdev, u32 bar,\n\t\t\t\t   u32 offset)\n{\n\tif (sof_ops(sdev)->read)\n\t\treturn sof_ops(sdev)->read(sdev, sdev->bar[bar] + offset);\n\telse\n\t\treturn readl(sdev->bar[bar] + offset);\n}\n\nstatic inline u64 snd_sof_dsp_read64(struct snd_sof_dev *sdev, u32 bar,\n\t\t\t\t     u32 offset)\n{\n\tif (sof_ops(sdev)->read64)\n\t\treturn sof_ops(sdev)->read64(sdev, sdev->bar[bar] + offset);\n\telse\n\t\treturn readq(sdev->bar[bar] + offset);\n}\n\nstatic inline void snd_sof_dsp_update8(struct snd_sof_dev *sdev, u32 bar,\n\t\t\t\t       u32 offset, u8 mask, u8 value)\n{\n\tu8 reg;\n\n\treg = snd_sof_dsp_read8(sdev, bar, offset);\n\treg &= ~mask;\n\treg |= value;\n\tsnd_sof_dsp_write8(sdev, bar, offset, reg);\n}\n\n \nstatic inline int snd_sof_dsp_block_read(struct snd_sof_dev *sdev,\n\t\t\t\t\t enum snd_sof_fw_blk_type blk_type,\n\t\t\t\t\t u32 offset, void *dest, size_t bytes)\n{\n\treturn sof_ops(sdev)->block_read(sdev, blk_type, offset, dest, bytes);\n}\n\nstatic inline int snd_sof_dsp_block_write(struct snd_sof_dev *sdev,\n\t\t\t\t\t  enum snd_sof_fw_blk_type blk_type,\n\t\t\t\t\t  u32 offset, void *src, size_t bytes)\n{\n\treturn sof_ops(sdev)->block_write(sdev, blk_type, offset, src, bytes);\n}\n\n \nstatic inline void snd_sof_dsp_mailbox_read(struct snd_sof_dev *sdev,\n\t\t\t\t\t    u32 offset, void *dest, size_t bytes)\n{\n\tif (sof_ops(sdev)->mailbox_read)\n\t\tsof_ops(sdev)->mailbox_read(sdev, offset, dest, bytes);\n}\n\nstatic inline void snd_sof_dsp_mailbox_write(struct snd_sof_dev *sdev,\n\t\t\t\t\t     u32 offset, void *src, size_t bytes)\n{\n\tif (sof_ops(sdev)->mailbox_write)\n\t\tsof_ops(sdev)->mailbox_write(sdev, offset, src, bytes);\n}\n\n \nstatic inline int snd_sof_dsp_send_msg(struct snd_sof_dev *sdev,\n\t\t\t\t       struct snd_sof_ipc_msg *msg)\n{\n\treturn sof_ops(sdev)->send_msg(sdev, msg);\n}\n\n \nstatic inline int\nsnd_sof_pcm_platform_open(struct snd_sof_dev *sdev,\n\t\t\t  struct snd_pcm_substream *substream)\n{\n\tif (sof_ops(sdev) && sof_ops(sdev)->pcm_open)\n\t\treturn sof_ops(sdev)->pcm_open(sdev, substream);\n\n\treturn 0;\n}\n\n \nstatic inline int\nsnd_sof_pcm_platform_close(struct snd_sof_dev *sdev,\n\t\t\t   struct snd_pcm_substream *substream)\n{\n\tif (sof_ops(sdev) && sof_ops(sdev)->pcm_close)\n\t\treturn sof_ops(sdev)->pcm_close(sdev, substream);\n\n\treturn 0;\n}\n\n \nstatic inline int\nsnd_sof_pcm_platform_hw_params(struct snd_sof_dev *sdev,\n\t\t\t       struct snd_pcm_substream *substream,\n\t\t\t       struct snd_pcm_hw_params *params,\n\t\t\t       struct snd_sof_platform_stream_params *platform_params)\n{\n\tif (sof_ops(sdev) && sof_ops(sdev)->pcm_hw_params)\n\t\treturn sof_ops(sdev)->pcm_hw_params(sdev, substream, params,\n\t\t\t\t\t\t    platform_params);\n\n\treturn 0;\n}\n\n \nstatic inline int\nsnd_sof_pcm_platform_hw_free(struct snd_sof_dev *sdev,\n\t\t\t     struct snd_pcm_substream *substream)\n{\n\tif (sof_ops(sdev) && sof_ops(sdev)->pcm_hw_free)\n\t\treturn sof_ops(sdev)->pcm_hw_free(sdev, substream);\n\n\treturn 0;\n}\n\n \nstatic inline int\nsnd_sof_pcm_platform_trigger(struct snd_sof_dev *sdev,\n\t\t\t     struct snd_pcm_substream *substream, int cmd)\n{\n\tif (sof_ops(sdev) && sof_ops(sdev)->pcm_trigger)\n\t\treturn sof_ops(sdev)->pcm_trigger(sdev, substream, cmd);\n\n\treturn 0;\n}\n\n \nstatic inline int snd_sof_load_firmware(struct snd_sof_dev *sdev)\n{\n\tdev_dbg(sdev->dev, \"loading firmware\\n\");\n\n\treturn sof_ops(sdev)->load_firmware(sdev);\n}\n\n \nstatic inline int snd_sof_ipc_msg_data(struct snd_sof_dev *sdev,\n\t\t\t\t       struct snd_sof_pcm_stream *sps,\n\t\t\t\t       void *p, size_t sz)\n{\n\treturn sof_ops(sdev)->ipc_msg_data(sdev, sps, p, sz);\n}\n \nstatic inline int\nsnd_sof_set_stream_data_offset(struct snd_sof_dev *sdev,\n\t\t\t       struct snd_sof_pcm_stream *sps,\n\t\t\t       size_t posn_offset)\n{\n\tif (sof_ops(sdev) && sof_ops(sdev)->set_stream_data_offset)\n\t\treturn sof_ops(sdev)->set_stream_data_offset(sdev, sps,\n\t\t\t\t\t\t\t     posn_offset);\n\n\treturn 0;\n}\n\n \nstatic inline snd_pcm_uframes_t\nsnd_sof_pcm_platform_pointer(struct snd_sof_dev *sdev,\n\t\t\t     struct snd_pcm_substream *substream)\n{\n\tif (sof_ops(sdev) && sof_ops(sdev)->pcm_pointer)\n\t\treturn sof_ops(sdev)->pcm_pointer(sdev, substream);\n\n\treturn 0;\n}\n\n \nstatic inline int snd_sof_pcm_platform_ack(struct snd_sof_dev *sdev,\n\t\t\t\t\t   struct snd_pcm_substream *substream)\n{\n\tif (sof_ops(sdev) && sof_ops(sdev)->pcm_ack)\n\t\treturn sof_ops(sdev)->pcm_ack(sdev, substream);\n\n\treturn 0;\n}\n\nstatic inline u64 snd_sof_pcm_get_stream_position(struct snd_sof_dev *sdev,\n\t\t\t\t\t\t  struct snd_soc_component *component,\n\t\t\t\t\t\t  struct snd_pcm_substream *substream)\n{\n\tif (sof_ops(sdev) && sof_ops(sdev)->get_stream_position)\n\t\treturn sof_ops(sdev)->get_stream_position(sdev, component, substream);\n\n\treturn 0;\n}\n\n \nstatic inline int\nsnd_sof_machine_register(struct snd_sof_dev *sdev, void *pdata)\n{\n\tif (sof_ops(sdev) && sof_ops(sdev)->machine_register)\n\t\treturn sof_ops(sdev)->machine_register(sdev, pdata);\n\n\treturn 0;\n}\n\nstatic inline void\nsnd_sof_machine_unregister(struct snd_sof_dev *sdev, void *pdata)\n{\n\tif (sof_ops(sdev) && sof_ops(sdev)->machine_unregister)\n\t\tsof_ops(sdev)->machine_unregister(sdev, pdata);\n}\n\nstatic inline struct snd_soc_acpi_mach *\nsnd_sof_machine_select(struct snd_sof_dev *sdev)\n{\n\tif (sof_ops(sdev) && sof_ops(sdev)->machine_select)\n\t\treturn sof_ops(sdev)->machine_select(sdev);\n\n\treturn NULL;\n}\n\nstatic inline void\nsnd_sof_set_mach_params(struct snd_soc_acpi_mach *mach,\n\t\t\tstruct snd_sof_dev *sdev)\n{\n\tif (sof_ops(sdev) && sof_ops(sdev)->set_mach_params)\n\t\tsof_ops(sdev)->set_mach_params(mach, sdev);\n}\n\n \n#define snd_sof_dsp_read_poll_timeout(sdev, bar, offset, val, cond, sleep_us, timeout_us) \\\n({ \\\n\tu64 __timeout_us = (timeout_us); \\\n\tunsigned long __sleep_us = (sleep_us); \\\n\tktime_t __timeout = ktime_add_us(ktime_get(), __timeout_us); \\\n\tmight_sleep_if((__sleep_us) != 0); \\\n\tfor (;;) {\t\t\t\t\t\t\t\\\n\t\t(val) = snd_sof_dsp_read(sdev, bar, offset);\t\t\\\n\t\tif (cond) { \\\n\t\t\tdev_dbg(sdev->dev, \\\n\t\t\t\t\"FW Poll Status: reg[%#x]=%#x successful\\n\", \\\n\t\t\t\t(offset), (val)); \\\n\t\t\tbreak; \\\n\t\t} \\\n\t\tif (__timeout_us && \\\n\t\t    ktime_compare(ktime_get(), __timeout) > 0) { \\\n\t\t\t(val) = snd_sof_dsp_read(sdev, bar, offset); \\\n\t\t\tdev_dbg(sdev->dev, \\\n\t\t\t\t\"FW Poll Status: reg[%#x]=%#x timedout\\n\", \\\n\t\t\t\t(offset), (val)); \\\n\t\t\tbreak; \\\n\t\t} \\\n\t\tif (__sleep_us) \\\n\t\t\tusleep_range((__sleep_us >> 2) + 1, __sleep_us); \\\n\t} \\\n\t(cond) ? 0 : -ETIMEDOUT; \\\n})\n\n \nbool snd_sof_pci_update_bits(struct snd_sof_dev *sdev, u32 offset,\n\t\t\t     u32 mask, u32 value);\n\nbool snd_sof_dsp_update_bits_unlocked(struct snd_sof_dev *sdev, u32 bar,\n\t\t\t\t      u32 offset, u32 mask, u32 value);\n\nbool snd_sof_dsp_update_bits64_unlocked(struct snd_sof_dev *sdev, u32 bar,\n\t\t\t\t\tu32 offset, u64 mask, u64 value);\n\nbool snd_sof_dsp_update_bits(struct snd_sof_dev *sdev, u32 bar, u32 offset,\n\t\t\t     u32 mask, u32 value);\n\nbool snd_sof_dsp_update_bits64(struct snd_sof_dev *sdev, u32 bar,\n\t\t\t       u32 offset, u64 mask, u64 value);\n\nvoid snd_sof_dsp_update_bits_forced(struct snd_sof_dev *sdev, u32 bar,\n\t\t\t\t    u32 offset, u32 mask, u32 value);\n\nint snd_sof_dsp_register_poll(struct snd_sof_dev *sdev, u32 bar, u32 offset,\n\t\t\t      u32 mask, u32 target, u32 timeout_ms,\n\t\t\t      u32 interval_us);\n\nvoid snd_sof_dsp_panic(struct snd_sof_dev *sdev, u32 offset, bool non_recoverable);\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}