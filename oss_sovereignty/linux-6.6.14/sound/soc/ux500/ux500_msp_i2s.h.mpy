{
  "module_name": "ux500_msp_i2s.h",
  "hash_id": "e8d3eb5a0f6b9f10e8a22c95ebd070834320ce77255cbbcc64ec6ec780ab5f1e",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/ux500/ux500_msp_i2s.h",
  "human_readable_source": " \n \n\n\n#ifndef UX500_MSP_I2S_H\n#define UX500_MSP_I2S_H\n\n#include <linux/platform_device.h>\n\n#define MSP_INPUT_FREQ_APB 48000000\n\n \nenum msp_stereo_mode {\n\tMSP_MONO,\n\tMSP_STEREO\n};\n\n \nenum msp_direction {\n\tMSP_TX = 1,\n\tMSP_RX = 2\n};\n\n \n#define MSP_BIG_ENDIAN           0x00000000\n#define MSP_LITTLE_ENDIAN        0x00001000\n#define MSP_UNEXPECTED_FS_ABORT  0x00000000\n#define MSP_UNEXPECTED_FS_IGNORE 0x00008000\n#define MSP_NON_MODE_BIT_MASK    0x00009000\n\n \n#define RX_ENABLE             0x00000001\n#define RX_FIFO_ENABLE        0x00000002\n#define RX_SYNC_SRG           0x00000010\n#define RX_CLK_POL_RISING     0x00000020\n#define RX_CLK_SEL_SRG        0x00000040\n#define TX_ENABLE             0x00000100\n#define TX_FIFO_ENABLE        0x00000200\n#define TX_SYNC_SRG_PROG      0x00001800\n#define TX_SYNC_SRG_AUTO      0x00001000\n#define TX_CLK_POL_RISING     0x00002000\n#define TX_CLK_SEL_SRG        0x00004000\n#define TX_EXTRA_DELAY_ENABLE 0x00008000\n#define SRG_ENABLE            0x00010000\n#define FRAME_GEN_ENABLE      0x00100000\n#define SRG_CLK_SEL_APB       0x00000000\n#define RX_FIFO_SYNC_HI       0x00000000\n#define TX_FIFO_SYNC_HI       0x00000000\n#define SPI_CLK_MODE_NORMAL   0x00000000\n\n#define MSP_FRAME_SIZE_AUTO -1\n\n#define MSP_DR\t\t0x00\n#define MSP_GCR\t\t0x04\n#define MSP_TCF\t\t0x08\n#define MSP_RCF\t\t0x0c\n#define MSP_SRG\t\t0x10\n#define MSP_FLR\t\t0x14\n#define MSP_DMACR\t0x18\n\n#define MSP_IMSC\t0x20\n#define MSP_RIS\t\t0x24\n#define MSP_MIS\t\t0x28\n#define MSP_ICR\t\t0x2c\n#define MSP_MCR\t\t0x30\n#define MSP_RCV\t\t0x34\n#define MSP_RCM\t\t0x38\n\n#define MSP_TCE0\t0x40\n#define MSP_TCE1\t0x44\n#define MSP_TCE2\t0x48\n#define MSP_TCE3\t0x4c\n\n#define MSP_RCE0\t0x60\n#define MSP_RCE1\t0x64\n#define MSP_RCE2\t0x68\n#define MSP_RCE3\t0x6c\n#define MSP_IODLY\t0x70\n\n#define MSP_ITCR\t0x80\n#define MSP_ITIP\t0x84\n#define MSP_ITOP\t0x88\n#define MSP_TSTDR\t0x8c\n\n#define MSP_PID0\t0xfe0\n#define MSP_PID1\t0xfe4\n#define MSP_PID2\t0xfe8\n#define MSP_PID3\t0xfec\n\n#define MSP_CID0\t0xff0\n#define MSP_CID1\t0xff4\n#define MSP_CID2\t0xff8\n#define MSP_CID3\t0xffc\n\n \n#define RX_ENABLE_MASK\t\tBIT(0)\n#define RX_FIFO_ENABLE_MASK\tBIT(1)\n#define RX_FSYNC_MASK\t\tBIT(2)\n#define DIRECT_COMPANDING_MASK\tBIT(3)\n#define RX_SYNC_SEL_MASK\tBIT(4)\n#define RX_CLK_POL_MASK\t\tBIT(5)\n#define RX_CLK_SEL_MASK\t\tBIT(6)\n#define LOOPBACK_MASK\t\tBIT(7)\n#define TX_ENABLE_MASK\t\tBIT(8)\n#define TX_FIFO_ENABLE_MASK\tBIT(9)\n#define TX_FSYNC_MASK\t\tBIT(10)\n#define TX_MSP_TDR_TSR\t\tBIT(11)\n#define TX_SYNC_SEL_MASK\t(BIT(12) | BIT(11))\n#define TX_CLK_POL_MASK\t\tBIT(13)\n#define TX_CLK_SEL_MASK\t\tBIT(14)\n#define TX_EXTRA_DELAY_MASK\tBIT(15)\n#define SRG_ENABLE_MASK\t\tBIT(16)\n#define SRG_CLK_POL_MASK\tBIT(17)\n#define SRG_CLK_SEL_MASK\t(BIT(19) | BIT(18))\n#define FRAME_GEN_EN_MASK\tBIT(20)\n#define SPI_CLK_MODE_MASK\t(BIT(22) | BIT(21))\n#define SPI_BURST_MODE_MASK\tBIT(23)\n\n#define RXEN_SHIFT\t\t0\n#define RFFEN_SHIFT\t\t1\n#define RFSPOL_SHIFT\t\t2\n#define DCM_SHIFT\t\t3\n#define RFSSEL_SHIFT\t\t4\n#define RCKPOL_SHIFT\t\t5\n#define RCKSEL_SHIFT\t\t6\n#define LBM_SHIFT\t\t7\n#define TXEN_SHIFT\t\t8\n#define TFFEN_SHIFT\t\t9\n#define TFSPOL_SHIFT\t\t10\n#define TFSSEL_SHIFT\t\t11\n#define TCKPOL_SHIFT\t\t13\n#define TCKSEL_SHIFT\t\t14\n#define TXDDL_SHIFT\t\t15\n#define SGEN_SHIFT\t\t16\n#define SCKPOL_SHIFT\t\t17\n#define SCKSEL_SHIFT\t\t18\n#define FGEN_SHIFT\t\t20\n#define SPICKM_SHIFT\t\t21\n#define TBSWAP_SHIFT\t\t28\n\n#define RCKPOL_MASK\t\tBIT(0)\n#define TCKPOL_MASK\t\tBIT(0)\n#define SPICKM_MASK\t\t(BIT(1) | BIT(0))\n#define MSP_RX_CLKPOL_BIT(n)     ((n & RCKPOL_MASK) << RCKPOL_SHIFT)\n#define MSP_TX_CLKPOL_BIT(n)     ((n & TCKPOL_MASK) << TCKPOL_SHIFT)\n\n#define P1ELEN_SHIFT\t\t0\n#define P1FLEN_SHIFT\t\t3\n#define DTYP_SHIFT\t\t10\n#define ENDN_SHIFT\t\t12\n#define DDLY_SHIFT\t\t13\n#define FSIG_SHIFT\t\t15\n#define P2ELEN_SHIFT\t\t16\n#define P2FLEN_SHIFT\t\t19\n#define P2SM_SHIFT\t\t26\n#define P2EN_SHIFT\t\t27\n#define FSYNC_SHIFT\t\t15\n\n#define P1ELEN_MASK\t\t0x00000007\n#define P2ELEN_MASK\t\t0x00070000\n#define P1FLEN_MASK\t\t0x00000378\n#define P2FLEN_MASK\t\t0x03780000\n#define DDLY_MASK\t\t0x00003000\n#define DTYP_MASK\t\t0x00000600\n#define P2SM_MASK\t\t0x04000000\n#define P2EN_MASK\t\t0x08000000\n#define ENDN_MASK\t\t0x00001000\n#define TFSPOL_MASK\t\t0x00000400\n#define TBSWAP_MASK\t\t0x30000000\n#define COMPANDING_MODE_MASK\t0x00000c00\n#define FSYNC_MASK\t\t0x00008000\n\n#define MSP_P1_ELEM_LEN_BITS(n)\t\t(n & P1ELEN_MASK)\n#define MSP_P2_ELEM_LEN_BITS(n)\t\t(((n) << P2ELEN_SHIFT) & P2ELEN_MASK)\n#define MSP_P1_FRAME_LEN_BITS(n)\t(((n) << P1FLEN_SHIFT) & P1FLEN_MASK)\n#define MSP_P2_FRAME_LEN_BITS(n)\t(((n) << P2FLEN_SHIFT) & P2FLEN_MASK)\n#define MSP_DATA_DELAY_BITS(n)\t\t(((n) << DDLY_SHIFT) & DDLY_MASK)\n#define MSP_DATA_TYPE_BITS(n)\t\t(((n) << DTYP_SHIFT) & DTYP_MASK)\n#define MSP_P2_START_MODE_BIT(n)\t((n << P2SM_SHIFT) & P2SM_MASK)\n#define MSP_P2_ENABLE_BIT(n)\t\t((n << P2EN_SHIFT) & P2EN_MASK)\n#define MSP_SET_ENDIANNES_BIT(n)\t((n << ENDN_SHIFT) & ENDN_MASK)\n#define MSP_FSYNC_POL(n)\t\t((n << TFSPOL_SHIFT) & TFSPOL_MASK)\n#define MSP_DATA_WORD_SWAP(n)\t\t((n << TBSWAP_SHIFT) & TBSWAP_MASK)\n#define MSP_SET_COMPANDING_MODE(n)\t((n << DTYP_SHIFT) & \\\n\t\t\t\t\t\tCOMPANDING_MODE_MASK)\n#define MSP_SET_FSYNC_IGNORE(n)\t\t((n << FSYNC_SHIFT) & FSYNC_MASK)\n\n \n#define RX_BUSY\t\t\tBIT(0)\n#define RX_FIFO_EMPTY\t\tBIT(1)\n#define RX_FIFO_FULL\t\tBIT(2)\n#define TX_BUSY\t\t\tBIT(3)\n#define TX_FIFO_EMPTY\t\tBIT(4)\n#define TX_FIFO_FULL\t\tBIT(5)\n\n#define RBUSY_SHIFT\t\t0\n#define RFE_SHIFT\t\t1\n#define RFU_SHIFT\t\t2\n#define TBUSY_SHIFT\t\t3\n#define TFE_SHIFT\t\t4\n#define TFU_SHIFT\t\t5\n\n \n#define RMCEN_SHIFT\t\t0\n#define RMCSF_SHIFT\t\t1\n#define RCMPM_SHIFT\t\t3\n#define TMCEN_SHIFT\t\t5\n#define TNCSF_SHIFT\t\t6\n\n \n#define SCKDIV_SHIFT\t\t0\n#define FRWID_SHIFT\t\t10\n#define FRPER_SHIFT\t\t16\n\n#define SCK_DIV_MASK\t\t0x0000003FF\n#define FRAME_WIDTH_BITS(n)\t(((n) << FRWID_SHIFT)  & 0x0000FC00)\n#define FRAME_PERIOD_BITS(n)\t(((n) << FRPER_SHIFT) & 0x1FFF0000)\n\n \n#define RX_DMA_ENABLE\t\tBIT(0)\n#define TX_DMA_ENABLE\t\tBIT(1)\n\n#define RDMAE_SHIFT\t\t0\n#define TDMAE_SHIFT\t\t1\n\n \n#define RX_SERVICE_INT\t\tBIT(0)\n#define RX_OVERRUN_ERROR_INT\tBIT(1)\n#define RX_FSYNC_ERR_INT\tBIT(2)\n#define RX_FSYNC_INT\t\tBIT(3)\n#define TX_SERVICE_INT\t\tBIT(4)\n#define TX_UNDERRUN_ERR_INT\tBIT(5)\n#define TX_FSYNC_ERR_INT\tBIT(6)\n#define TX_FSYNC_INT\t\tBIT(7)\n#define ALL_INT\t\t\t0x000000ff\n\n \n#define MSP_ITCR_ITEN\t\tBIT(0)\n#define MSP_ITCR_TESTFIFO\tBIT(1)\n\n#define RMCEN_BIT   0\n#define RMCSF_BIT   1\n#define RCMPM_BIT   3\n#define TMCEN_BIT   5\n#define TNCSF_BIT   6\n\n \nenum msp_phase_mode {\n\tMSP_SINGLE_PHASE,\n\tMSP_DUAL_PHASE\n};\n\n \nenum msp_frame_length {\n\tMSP_FRAME_LEN_1 = 0,\n\tMSP_FRAME_LEN_2 = 1,\n\tMSP_FRAME_LEN_4 = 3,\n\tMSP_FRAME_LEN_8 = 7,\n\tMSP_FRAME_LEN_12 = 11,\n\tMSP_FRAME_LEN_16 = 15,\n\tMSP_FRAME_LEN_20 = 19,\n\tMSP_FRAME_LEN_32 = 31,\n\tMSP_FRAME_LEN_48 = 47,\n\tMSP_FRAME_LEN_64 = 63\n};\n\n \nenum msp_elem_length {\n\tMSP_ELEM_LEN_8 = 0,\n\tMSP_ELEM_LEN_10 = 1,\n\tMSP_ELEM_LEN_12 = 2,\n\tMSP_ELEM_LEN_14 = 3,\n\tMSP_ELEM_LEN_16 = 4,\n\tMSP_ELEM_LEN_20 = 5,\n\tMSP_ELEM_LEN_24 = 6,\n\tMSP_ELEM_LEN_32 = 7\n};\n\nenum msp_data_xfer_width {\n\tMSP_DATA_TRANSFER_WIDTH_BYTE,\n\tMSP_DATA_TRANSFER_WIDTH_HALFWORD,\n\tMSP_DATA_TRANSFER_WIDTH_WORD\n};\n\nenum msp_frame_sync {\n\tMSP_FSYNC_UNIGNORE = 0,\n\tMSP_FSYNC_IGNORE = 1,\n};\n\nenum msp_phase2_start_mode {\n\tMSP_PHASE2_START_MODE_IMEDIATE,\n\tMSP_PHASE2_START_MODE_FSYNC\n};\n\nenum msp_btf {\n\tMSP_BTF_MS_BIT_FIRST = 0,\n\tMSP_BTF_LS_BIT_FIRST = 1\n};\n\nenum msp_fsync_pol {\n\tMSP_FSYNC_POL_ACT_HI = 0,\n\tMSP_FSYNC_POL_ACT_LO = 1\n};\n\n \nenum msp_delay {\n\tMSP_DELAY_0 = 0,\n\tMSP_DELAY_1 = 1,\n\tMSP_DELAY_2 = 2,\n\tMSP_DELAY_3 = 3\n};\n\n \nenum msp_edge {\n\tMSP_FALLING_EDGE = 0,\n\tMSP_RISING_EDGE = 1,\n};\n\nenum msp_hws {\n\tMSP_SWAP_NONE = 0,\n\tMSP_SWAP_BYTE_PER_WORD = 1,\n\tMSP_SWAP_BYTE_PER_HALF_WORD = 2,\n\tMSP_SWAP_HALF_WORD_PER_WORD = 3\n};\n\nenum msp_compress_mode {\n\tMSP_COMPRESS_MODE_LINEAR = 0,\n\tMSP_COMPRESS_MODE_MU_LAW = 2,\n\tMSP_COMPRESS_MODE_A_LAW = 3\n};\n\nenum msp_expand_mode {\n\tMSP_EXPAND_MODE_LINEAR = 0,\n\tMSP_EXPAND_MODE_LINEAR_SIGNED = 1,\n\tMSP_EXPAND_MODE_MU_LAW = 2,\n\tMSP_EXPAND_MODE_A_LAW = 3\n};\n\n#define MSP_FRAME_PERIOD_IN_MONO_MODE 256\n#define MSP_FRAME_PERIOD_IN_STEREO_MODE 32\n#define MSP_FRAME_WIDTH_IN_STEREO_MODE 16\n\nenum msp_protocol {\n\tMSP_I2S_PROTOCOL,\n\tMSP_PCM_PROTOCOL,\n\tMSP_PCM_COMPAND_PROTOCOL,\n\tMSP_INVALID_PROTOCOL\n};\n\n \n#define MAX_MSP_BACKUP_REGS 36\n\nenum i2s_direction_t {\n\tMSP_DIR_TX = 0x01,\n\tMSP_DIR_RX = 0x02,\n};\n\nenum msp_data_size {\n\tMSP_DATA_BITS_DEFAULT = -1,\n\tMSP_DATA_BITS_8 = 0x00,\n\tMSP_DATA_BITS_10,\n\tMSP_DATA_BITS_12,\n\tMSP_DATA_BITS_14,\n\tMSP_DATA_BITS_16,\n\tMSP_DATA_BITS_20,\n\tMSP_DATA_BITS_24,\n\tMSP_DATA_BITS_32,\n};\n\nenum msp_state {\n\tMSP_STATE_IDLE = 0,\n\tMSP_STATE_CONFIGURED = 1,\n\tMSP_STATE_RUNNING = 2,\n};\n\nenum msp_rx_comparison_enable_mode {\n\tMSP_COMPARISON_DISABLED = 0,\n\tMSP_COMPARISON_NONEQUAL_ENABLED = 2,\n\tMSP_COMPARISON_EQUAL_ENABLED = 3\n};\n\nstruct msp_multichannel_config {\n\tbool rx_multichannel_enable;\n\tbool tx_multichannel_enable;\n\tenum msp_rx_comparison_enable_mode rx_comparison_enable_mode;\n\tu8 padding;\n\tu32 comparison_value;\n\tu32 comparison_mask;\n\tu32 rx_channel_0_enable;\n\tu32 rx_channel_1_enable;\n\tu32 rx_channel_2_enable;\n\tu32 rx_channel_3_enable;\n\tu32 tx_channel_0_enable;\n\tu32 tx_channel_1_enable;\n\tu32 tx_channel_2_enable;\n\tu32 tx_channel_3_enable;\n};\n\nstruct msp_protdesc {\n\tu32 rx_phase_mode;\n\tu32 tx_phase_mode;\n\tu32 rx_phase2_start_mode;\n\tu32 tx_phase2_start_mode;\n\tu32 rx_byte_order;\n\tu32 tx_byte_order;\n\tu32 rx_frame_len_1;\n\tu32 rx_frame_len_2;\n\tu32 tx_frame_len_1;\n\tu32 tx_frame_len_2;\n\tu32 rx_elem_len_1;\n\tu32 rx_elem_len_2;\n\tu32 tx_elem_len_1;\n\tu32 tx_elem_len_2;\n\tu32 rx_data_delay;\n\tu32 tx_data_delay;\n\tu32 rx_clk_pol;\n\tu32 tx_clk_pol;\n\tu32 rx_fsync_pol;\n\tu32 tx_fsync_pol;\n\tu32 rx_half_word_swap;\n\tu32 tx_half_word_swap;\n\tu32 compression_mode;\n\tu32 expansion_mode;\n\tu32 frame_sync_ignore;\n\tu32 frame_period;\n\tu32 frame_width;\n\tu32 clocks_per_frame;\n};\n\nstruct ux500_msp_config {\n\tunsigned int f_inputclk;\n\tunsigned int rx_clk_sel;\n\tunsigned int tx_clk_sel;\n\tunsigned int srg_clk_sel;\n\tunsigned int rx_fsync_pol;\n\tunsigned int tx_fsync_pol;\n\tunsigned int rx_fsync_sel;\n\tunsigned int tx_fsync_sel;\n\tunsigned int rx_fifo_config;\n\tunsigned int tx_fifo_config;\n\tunsigned int loopback_enable;\n\tunsigned int tx_data_enable;\n\tunsigned int default_protdesc;\n\tstruct msp_protdesc protdesc;\n\tint multichannel_configured;\n\tstruct msp_multichannel_config multichannel_config;\n\tunsigned int direction;\n\tunsigned int protocol;\n\tunsigned int frame_freq;\n\tenum msp_data_size data_size;\n\tunsigned int def_elem_len;\n\tunsigned int iodelay;\n};\n\nstruct ux500_msp {\n\tint id;\n\tvoid __iomem *registers;\n\tstruct device *dev;\n\tdma_addr_t tx_rx_addr;\n\tenum msp_state msp_state;\n\tint def_elem_len;\n\tunsigned int dir_busy;\n\tint loopback_enable;\n\tunsigned int f_bitclk;\n};\n\nint ux500_msp_i2s_init_msp(struct platform_device *pdev,\n\t\t\tstruct ux500_msp **msp_p);\nvoid ux500_msp_i2s_cleanup_msp(struct platform_device *pdev,\n\t\t\tstruct ux500_msp *msp);\nint ux500_msp_i2s_open(struct ux500_msp *msp, struct ux500_msp_config *config);\nint ux500_msp_i2s_close(struct ux500_msp *msp,\n\t\t\tunsigned int dir);\nint ux500_msp_i2s_trigger(struct ux500_msp *msp, int cmd,\n\t\t\tint direction);\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}