{
  "module_name": "mop500.c",
  "hash_id": "0c183e74f2b9a61d4769ef393926e21b65ded18e167d46a97c1afcfb53300606",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/ux500/mop500.c",
  "human_readable_source": "\n \n\n#include <asm/mach-types.h>\n\n#include <linux/module.h>\n#include <linux/io.h>\n#include <linux/spi/spi.h>\n#include <linux/of.h>\n\n#include <sound/soc.h>\n#include <sound/initval.h>\n\n#include \"ux500_pcm.h\"\n#include \"ux500_msp_dai.h\"\n\n#include \"mop500_ab8500.h\"\n\n \nSND_SOC_DAILINK_DEFS(link1,\n\tDAILINK_COMP_ARRAY(COMP_CPU(\"ux500-msp-i2s.1\")),\n\tDAILINK_COMP_ARRAY(COMP_CODEC(\"ab8500-codec.0\", \"ab8500-codec-dai.0\")),\n\tDAILINK_COMP_ARRAY(COMP_PLATFORM(\"ux500-msp-i2s.1\")));\n\nSND_SOC_DAILINK_DEFS(link2,\n\tDAILINK_COMP_ARRAY(COMP_CPU(\"ux500-msp-i2s.3\")),\n\tDAILINK_COMP_ARRAY(COMP_CODEC(\"ab8500-codec.0\", \"ab8500-codec-dai.1\")),\n\tDAILINK_COMP_ARRAY(COMP_PLATFORM(\"ux500-msp-i2s.3\")));\n\nstatic struct snd_soc_dai_link mop500_dai_links[] = {\n\t{\n\t\t.name = \"ab8500_0\",\n\t\t.stream_name = \"ab8500_0\",\n\t\t.init = mop500_ab8500_machine_init,\n\t\t.ops = mop500_ab8500_ops,\n\t\tSND_SOC_DAILINK_REG(link1),\n\t},\n\t{\n\t\t.name = \"ab8500_1\",\n\t\t.stream_name = \"ab8500_1\",\n\t\t.init = NULL,\n\t\t.ops = mop500_ab8500_ops,\n\t\tSND_SOC_DAILINK_REG(link2),\n\t},\n};\n\nstatic struct snd_soc_card mop500_card = {\n\t.name = \"MOP500-card\",\n\t.owner = THIS_MODULE,\n\t.probe = NULL,\n\t.dai_link = mop500_dai_links,\n\t.num_links = ARRAY_SIZE(mop500_dai_links),\n};\n\nstatic void mop500_of_node_put(void)\n{\n\tint i;\n\n\tfor (i = 0; i < 2; i++)\n\t\tof_node_put(mop500_dai_links[i].cpus->of_node);\n\n\t \n\tof_node_put(mop500_dai_links[0].codecs->of_node);\n}\n\nstatic int mop500_of_probe(struct platform_device *pdev,\n\t\t\t   struct device_node *np)\n{\n\tstruct device_node *codec_np, *msp_np[2];\n\tint i;\n\n\tmsp_np[0] = of_parse_phandle(np, \"stericsson,cpu-dai\", 0);\n\tmsp_np[1] = of_parse_phandle(np, \"stericsson,cpu-dai\", 1);\n\tcodec_np  = of_parse_phandle(np, \"stericsson,audio-codec\", 0);\n\n\tif (!(msp_np[0] && msp_np[1] && codec_np)) {\n\t\tdev_err(&pdev->dev, \"Phandle missing or invalid\\n\");\n\t\tfor (i = 0; i < 2; i++)\n\t\t\tof_node_put(msp_np[i]);\n\t\tof_node_put(codec_np);\n\t\treturn -EINVAL;\n\t}\n\n\tfor (i = 0; i < 2; i++) {\n\t\tmop500_dai_links[i].cpus->of_node = msp_np[i];\n\t\tmop500_dai_links[i].cpus->dai_name = NULL;\n\t\tmop500_dai_links[i].platforms->of_node = msp_np[i];\n\t\tmop500_dai_links[i].platforms->name = NULL;\n\t\tmop500_dai_links[i].codecs->of_node = codec_np;\n\t\tmop500_dai_links[i].codecs->name = NULL;\n\t}\n\n\tsnd_soc_of_parse_card_name(&mop500_card, \"stericsson,card-name\");\n\n\treturn 0;\n}\n\nstatic int mop500_probe(struct platform_device *pdev)\n{\n\tstruct device_node *np = pdev->dev.of_node;\n\tint ret;\n\n\tdev_dbg(&pdev->dev, \"%s: Enter.\\n\", __func__);\n\n\tmop500_card.dev = &pdev->dev;\n\n\tret = mop500_of_probe(pdev, np);\n\tif (ret)\n\t\treturn ret;\n\n\tdev_dbg(&pdev->dev, \"%s: Card %s: Set platform drvdata.\\n\",\n\t\t__func__, mop500_card.name);\n\n\tsnd_soc_card_set_drvdata(&mop500_card, NULL);\n\n\tdev_dbg(&pdev->dev, \"%s: Card %s: num_links = %d\\n\",\n\t\t__func__, mop500_card.name, mop500_card.num_links);\n\tdev_dbg(&pdev->dev, \"%s: Card %s: DAI-link 0: name = %s\\n\",\n\t\t__func__, mop500_card.name, mop500_card.dai_link[0].name);\n\tdev_dbg(&pdev->dev, \"%s: Card %s: DAI-link 0: stream_name = %s\\n\",\n\t\t__func__, mop500_card.name,\n\t\tmop500_card.dai_link[0].stream_name);\n\n\tret = snd_soc_register_card(&mop500_card);\n\tif (ret)\n\t\tdev_err(&pdev->dev,\n\t\t\t\"Error: snd_soc_register_card failed (%d)!\\n\", ret);\n\n\treturn ret;\n}\n\nstatic void mop500_remove(struct platform_device *pdev)\n{\n\tstruct snd_soc_card *card = platform_get_drvdata(pdev);\n\n\tpr_debug(\"%s: Enter.\\n\", __func__);\n\n\tsnd_soc_unregister_card(card);\n\tmop500_ab8500_remove(card);\n\tmop500_of_node_put();\n}\n\nstatic const struct of_device_id snd_soc_mop500_match[] = {\n\t{ .compatible = \"stericsson,snd-soc-mop500\", },\n\t{},\n};\nMODULE_DEVICE_TABLE(of, snd_soc_mop500_match);\n\nstatic struct platform_driver snd_soc_mop500_driver = {\n\t.driver = {\n\t\t.name = \"snd-soc-mop500\",\n\t\t.of_match_table = snd_soc_mop500_match,\n\t},\n\t.probe = mop500_probe,\n\t.remove_new = mop500_remove,\n};\n\nmodule_platform_driver(snd_soc_mop500_driver);\n\nMODULE_LICENSE(\"GPL v2\");\nMODULE_DESCRIPTION(\"ASoC MOP500 board driver\");\nMODULE_AUTHOR(\"Ola Lilja\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}