{
  "module_name": "rsnd.h",
  "hash_id": "9610dfc7eb18ba4df54ae77bba9ab6ba949f99d0e00baf4216ae9cb43f544872",
  "original_prompt": "Ingested from linux-6.6.14/sound/soc/sh/rcar/rsnd.h",
  "human_readable_source": "\n\n\n\n\n\n\n#ifndef RSND_H\n#define RSND_H\n\n#include <linux/clk.h>\n#include <linux/device.h>\n#include <linux/dma-mapping.h>\n#include <linux/io.h>\n#include <linux/list.h>\n#include <linux/module.h>\n#include <linux/of_device.h>\n#include <linux/of_graph.h>\n#include <linux/of_irq.h>\n#include <linux/sh_dma.h>\n#include <linux/workqueue.h>\n#include <sound/soc.h>\n#include <sound/pcm_params.h>\n\n#define RSND_GEN1_SRU\t0\n#define RSND_GEN1_ADG\t1\n#define RSND_GEN1_SSI\t2\n\n#define RSND_GEN2_SCU\t0\n#define RSND_GEN2_ADG\t1\n#define RSND_GEN2_SSIU\t2\n#define RSND_GEN2_SSI\t3\n\n#define RSND_GEN4_ADG\t0\n#define RSND_GEN4_SSIU\t1\n#define RSND_GEN4_SSI\t2\n#define RSND_GEN4_SDMC\t3\n\n#define RSND_BASE_MAX\t4\n\n \nenum rsnd_reg {\n\t \n\tSRC_I_BUSIF_MODE,\n\tSRC_O_BUSIF_MODE,\n\tSRC_ROUTE_MODE0,\n\tSRC_SWRSR,\n\tSRC_SRCIR,\n\tSRC_ADINR,\n\tSRC_IFSCR,\n\tSRC_IFSVR,\n\tSRC_SRCCR,\n\tSRC_CTRL,\n\tSRC_BSDSR,\n\tSRC_BSISR,\n\tSRC_INT_ENABLE0,\n\tSRC_BUSIF_DALIGN,\n\tSRCIN_TIMSEL0,\n\tSRCIN_TIMSEL1,\n\tSRCIN_TIMSEL2,\n\tSRCIN_TIMSEL3,\n\tSRCIN_TIMSEL4,\n\tSRCOUT_TIMSEL0,\n\tSRCOUT_TIMSEL1,\n\tSRCOUT_TIMSEL2,\n\tSRCOUT_TIMSEL3,\n\tSRCOUT_TIMSEL4,\n\tSCU_SYS_STATUS0,\n\tSCU_SYS_STATUS1,\n\tSCU_SYS_INT_EN0,\n\tSCU_SYS_INT_EN1,\n\tCMD_CTRL,\n\tCMD_BUSIF_MODE,\n\tCMD_BUSIF_DALIGN,\n\tCMD_ROUTE_SLCT,\n\tCMDOUT_TIMSEL,\n\tCTU_SWRSR,\n\tCTU_CTUIR,\n\tCTU_ADINR,\n\tCTU_CPMDR,\n\tCTU_SCMDR,\n\tCTU_SV00R,\n\tCTU_SV01R,\n\tCTU_SV02R,\n\tCTU_SV03R,\n\tCTU_SV04R,\n\tCTU_SV05R,\n\tCTU_SV06R,\n\tCTU_SV07R,\n\tCTU_SV10R,\n\tCTU_SV11R,\n\tCTU_SV12R,\n\tCTU_SV13R,\n\tCTU_SV14R,\n\tCTU_SV15R,\n\tCTU_SV16R,\n\tCTU_SV17R,\n\tCTU_SV20R,\n\tCTU_SV21R,\n\tCTU_SV22R,\n\tCTU_SV23R,\n\tCTU_SV24R,\n\tCTU_SV25R,\n\tCTU_SV26R,\n\tCTU_SV27R,\n\tCTU_SV30R,\n\tCTU_SV31R,\n\tCTU_SV32R,\n\tCTU_SV33R,\n\tCTU_SV34R,\n\tCTU_SV35R,\n\tCTU_SV36R,\n\tCTU_SV37R,\n\tMIX_SWRSR,\n\tMIX_MIXIR,\n\tMIX_ADINR,\n\tMIX_MIXMR,\n\tMIX_MVPDR,\n\tMIX_MDBAR,\n\tMIX_MDBBR,\n\tMIX_MDBCR,\n\tMIX_MDBDR,\n\tMIX_MDBER,\n\tDVC_SWRSR,\n\tDVC_DVUIR,\n\tDVC_ADINR,\n\tDVC_DVUCR,\n\tDVC_ZCMCR,\n\tDVC_VOL0R,\n\tDVC_VOL1R,\n\tDVC_VOL2R,\n\tDVC_VOL3R,\n\tDVC_VOL4R,\n\tDVC_VOL5R,\n\tDVC_VOL6R,\n\tDVC_VOL7R,\n\tDVC_DVUER,\n\tDVC_VRCTR,\n\tDVC_VRPDR,\n\tDVC_VRDBR,\n\n\t \n\tBRRA,\n\tBRRB,\n\tBRGCKR,\n\tDIV_EN,\n\tAUDIO_CLK_SEL0,\n\tAUDIO_CLK_SEL1,\n\tAUDIO_CLK_SEL2,\n\n\t \n\tSSI_MODE,\n\tSSI_MODE0,\n\tSSI_MODE1,\n\tSSI_MODE2,\n\tSSI_CONTROL,\n\tSSI_CTRL,\n\tSSI_BUSIF0_MODE,\n\tSSI_BUSIF1_MODE,\n\tSSI_BUSIF2_MODE,\n\tSSI_BUSIF3_MODE,\n\tSSI_BUSIF4_MODE,\n\tSSI_BUSIF5_MODE,\n\tSSI_BUSIF6_MODE,\n\tSSI_BUSIF7_MODE,\n\tSSI_BUSIF0_ADINR,\n\tSSI_BUSIF1_ADINR,\n\tSSI_BUSIF2_ADINR,\n\tSSI_BUSIF3_ADINR,\n\tSSI_BUSIF4_ADINR,\n\tSSI_BUSIF5_ADINR,\n\tSSI_BUSIF6_ADINR,\n\tSSI_BUSIF7_ADINR,\n\tSSI_BUSIF0_DALIGN,\n\tSSI_BUSIF1_DALIGN,\n\tSSI_BUSIF2_DALIGN,\n\tSSI_BUSIF3_DALIGN,\n\tSSI_BUSIF4_DALIGN,\n\tSSI_BUSIF5_DALIGN,\n\tSSI_BUSIF6_DALIGN,\n\tSSI_BUSIF7_DALIGN,\n\tSSI_INT_ENABLE,\n\tSSI_SYS_STATUS0,\n\tSSI_SYS_STATUS1,\n\tSSI_SYS_STATUS2,\n\tSSI_SYS_STATUS3,\n\tSSI_SYS_STATUS4,\n\tSSI_SYS_STATUS5,\n\tSSI_SYS_STATUS6,\n\tSSI_SYS_STATUS7,\n\tSSI_SYS_INT_ENABLE0,\n\tSSI_SYS_INT_ENABLE1,\n\tSSI_SYS_INT_ENABLE2,\n\tSSI_SYS_INT_ENABLE3,\n\tSSI_SYS_INT_ENABLE4,\n\tSSI_SYS_INT_ENABLE5,\n\tSSI_SYS_INT_ENABLE6,\n\tSSI_SYS_INT_ENABLE7,\n\tSSI_BUSIF,\n\tHDMI0_SEL,\n\tHDMI1_SEL,\n\tSSI9_BUSIF0_MODE,\n\tSSI9_BUSIF1_MODE,\n\tSSI9_BUSIF2_MODE,\n\tSSI9_BUSIF3_MODE,\n\tSSI9_BUSIF4_MODE,\n\tSSI9_BUSIF5_MODE,\n\tSSI9_BUSIF6_MODE,\n\tSSI9_BUSIF7_MODE,\n\tSSI9_BUSIF0_ADINR,\n\tSSI9_BUSIF1_ADINR,\n\tSSI9_BUSIF2_ADINR,\n\tSSI9_BUSIF3_ADINR,\n\tSSI9_BUSIF4_ADINR,\n\tSSI9_BUSIF5_ADINR,\n\tSSI9_BUSIF6_ADINR,\n\tSSI9_BUSIF7_ADINR,\n\tSSI9_BUSIF0_DALIGN,\n\tSSI9_BUSIF1_DALIGN,\n\tSSI9_BUSIF2_DALIGN,\n\tSSI9_BUSIF3_DALIGN,\n\tSSI9_BUSIF4_DALIGN,\n\tSSI9_BUSIF5_DALIGN,\n\tSSI9_BUSIF6_DALIGN,\n\tSSI9_BUSIF7_DALIGN,\n\n\t \n\tSSICR,\n\tSSISR,\n\tSSITDR,\n\tSSIRDR,\n\tSSIWSR,\n\n\tREG_MAX,\n};\n#define SRCIN_TIMSEL(i)\t\t(SRCIN_TIMSEL0 + (i))\n#define SRCOUT_TIMSEL(i)\t(SRCOUT_TIMSEL0 + (i))\n#define CTU_SVxxR(i, j)\t\t(CTU_SV00R + (i * 8) + (j))\n#define DVC_VOLxR(i)\t\t(DVC_VOL0R + (i))\n#define AUDIO_CLK_SEL(i)\t(AUDIO_CLK_SEL0 + (i))\n#define SSI_BUSIF_MODE(i)\t(SSI_BUSIF0_MODE + (i))\n#define SSI_BUSIF_ADINR(i)\t(SSI_BUSIF0_ADINR + (i))\n#define SSI_BUSIF_DALIGN(i)\t(SSI_BUSIF0_DALIGN + (i))\n#define SSI9_BUSIF_MODE(i)\t(SSI9_BUSIF0_MODE + (i))\n#define SSI9_BUSIF_ADINR(i)\t(SSI9_BUSIF0_ADINR + (i))\n#define SSI9_BUSIF_DALIGN(i)\t(SSI9_BUSIF0_DALIGN + (i))\n#define SSI_SYS_STATUS(i)\t(SSI_SYS_STATUS0 + (i))\n#define SSI_SYS_INT_ENABLE(i) (SSI_SYS_INT_ENABLE0 + (i))\n\n\nstruct rsnd_priv;\nstruct rsnd_mod;\nstruct rsnd_dai;\nstruct rsnd_dai_stream;\n\n \nu32 rsnd_mod_read(struct rsnd_mod *mod, enum rsnd_reg reg);\nvoid rsnd_mod_write(struct rsnd_mod *mod, enum rsnd_reg reg, u32 data);\nvoid rsnd_mod_bset(struct rsnd_mod *mod, enum rsnd_reg reg, u32 mask, u32 data);\nu32 rsnd_get_adinr_bit(struct rsnd_mod *mod, struct rsnd_dai_stream *io);\nu32 rsnd_get_dalign(struct rsnd_mod *mod, struct rsnd_dai_stream *io);\nu32 rsnd_get_busif_shift(struct rsnd_dai_stream *io, struct rsnd_mod *mod);\n\n \nint rsnd_dma_attach(struct rsnd_dai_stream *io,\n\t\t    struct rsnd_mod *mod, struct rsnd_mod **dma_mod);\nint rsnd_dma_probe(struct rsnd_priv *priv);\nstruct dma_chan *rsnd_dma_request_channel(struct device_node *of_node, char *name,\n\t\t\t\t\t  struct rsnd_mod *mod, char *x);\n\n \nenum rsnd_mod_type {\n\tRSND_MOD_AUDMAPP,\n\tRSND_MOD_AUDMA,\n\tRSND_MOD_DVC,\n\tRSND_MOD_MIX,\n\tRSND_MOD_CTU,\n\tRSND_MOD_CMD,\n\tRSND_MOD_SRC,\n\tRSND_MOD_SSIM3,\t\t \n\tRSND_MOD_SSIM2,\t\t \n\tRSND_MOD_SSIM1,\t\t \n\tRSND_MOD_SSIP,\t\t \n\tRSND_MOD_SSI,\n\tRSND_MOD_SSIU,\n\tRSND_MOD_MAX,\n};\n\nstruct rsnd_mod_ops {\n\tchar *name;\n\tstruct dma_chan* (*dma_req)(struct rsnd_dai_stream *io,\n\t\t\t\t    struct rsnd_mod *mod);\n\tint (*probe)(struct rsnd_mod *mod,\n\t\t     struct rsnd_dai_stream *io,\n\t\t     struct rsnd_priv *priv);\n\tint (*remove)(struct rsnd_mod *mod,\n\t\t      struct rsnd_dai_stream *io,\n\t\t      struct rsnd_priv *priv);\n\tint (*init)(struct rsnd_mod *mod,\n\t\t    struct rsnd_dai_stream *io,\n\t\t    struct rsnd_priv *priv);\n\tint (*quit)(struct rsnd_mod *mod,\n\t\t    struct rsnd_dai_stream *io,\n\t\t    struct rsnd_priv *priv);\n\tint (*start)(struct rsnd_mod *mod,\n\t\t     struct rsnd_dai_stream *io,\n\t\t     struct rsnd_priv *priv);\n\tint (*stop)(struct rsnd_mod *mod,\n\t\t    struct rsnd_dai_stream *io,\n\t\t    struct rsnd_priv *priv);\n\tint (*irq)(struct rsnd_mod *mod,\n\t\t   struct rsnd_dai_stream *io,\n\t\t   struct rsnd_priv *priv, int enable);\n\tint (*pcm_new)(struct rsnd_mod *mod,\n\t\t       struct rsnd_dai_stream *io,\n\t\t       struct snd_soc_pcm_runtime *rtd);\n\tint (*hw_params)(struct rsnd_mod *mod,\n\t\t\t struct rsnd_dai_stream *io,\n\t\t\t struct snd_pcm_substream *substream,\n\t\t\t struct snd_pcm_hw_params *hw_params);\n\tint (*pointer)(struct rsnd_mod *mod,\n\t\t       struct rsnd_dai_stream *io,\n\t\t       snd_pcm_uframes_t *pointer);\n\tint (*fallback)(struct rsnd_mod *mod,\n\t\t\tstruct rsnd_dai_stream *io,\n\t\t\tstruct rsnd_priv *priv);\n\tint (*prepare)(struct rsnd_mod *mod,\n\t\t       struct rsnd_dai_stream *io,\n\t\t       struct rsnd_priv *priv);\n\tint (*cleanup)(struct rsnd_mod *mod,\n\t\t       struct rsnd_dai_stream *io,\n\t\t       struct rsnd_priv *priv);\n\tint (*hw_free)(struct rsnd_mod *mod,\n\t\t       struct rsnd_dai_stream *io,\n\t\t       struct snd_pcm_substream *substream);\n\tu32 *(*get_status)(struct rsnd_mod *mod,\n\t\t\t   struct rsnd_dai_stream *io,\n\t\t\t   enum rsnd_mod_type type);\n\tint (*id)(struct rsnd_mod *mod);\n\tint (*id_sub)(struct rsnd_mod *mod);\n\tint (*id_cmd)(struct rsnd_mod *mod);\n\n#ifdef CONFIG_DEBUG_FS\n\tvoid (*debug_info)(struct seq_file *m,\n\t\t\t   struct rsnd_dai_stream *io, struct rsnd_mod *mod);\n#endif\n};\n\nstruct rsnd_dai_stream;\nstruct rsnd_mod {\n\tint id;\n\tenum rsnd_mod_type type;\n\tstruct rsnd_mod_ops *ops;\n\tstruct rsnd_priv *priv;\n\tstruct clk *clk;\n\tu32 status;\n};\n \n#define __rsnd_mod_shift_init\t\t4\n#define __rsnd_mod_shift_quit\t\t4\n#define __rsnd_mod_shift_start\t\t8\n#define __rsnd_mod_shift_stop\t\t8\n#define __rsnd_mod_shift_hw_params\t12\n#define __rsnd_mod_shift_hw_free\t12\n#define __rsnd_mod_shift_probe\t\t28  \n#define __rsnd_mod_shift_remove\t\t28  \n#define __rsnd_mod_shift_irq\t\t28  \n#define __rsnd_mod_shift_pcm_new\t28  \n#define __rsnd_mod_shift_fallback\t28  \n#define __rsnd_mod_shift_pointer\t28  \n#define __rsnd_mod_shift_prepare\t28  \n#define __rsnd_mod_shift_cleanup\t28  \n\n#define __rsnd_mod_add_probe\t\t0\n#define __rsnd_mod_add_remove\t\t0\n#define __rsnd_mod_add_prepare\t\t0\n#define __rsnd_mod_add_cleanup\t\t0\n#define __rsnd_mod_add_init\t\t 1  \n#define __rsnd_mod_add_quit\t\t-1  \n#define __rsnd_mod_add_start\t\t 1  \n#define __rsnd_mod_add_stop\t\t-1  \n#define __rsnd_mod_add_hw_params\t 1  \n#define __rsnd_mod_add_hw_free\t\t-1  \n#define __rsnd_mod_add_irq\t\t0\n#define __rsnd_mod_add_pcm_new\t\t0\n#define __rsnd_mod_add_fallback\t\t0\n#define __rsnd_mod_add_pointer\t\t0\n\n#define __rsnd_mod_call_probe\t\t0\n#define __rsnd_mod_call_remove\t\t0\n#define __rsnd_mod_call_prepare\t\t0\n#define __rsnd_mod_call_cleanup\t\t0\n#define __rsnd_mod_call_init\t\t0  \n#define __rsnd_mod_call_quit\t\t1  \n#define __rsnd_mod_call_start\t\t0  \n#define __rsnd_mod_call_stop\t\t1  \n#define __rsnd_mod_call_hw_params\t0  \n#define __rsnd_mod_call_hw_free\t\t1  \n#define __rsnd_mod_call_irq\t\t0\n#define __rsnd_mod_call_pcm_new\t\t0\n#define __rsnd_mod_call_fallback\t0\n#define __rsnd_mod_call_pointer\t\t0\n\n#define rsnd_mod_to_priv(mod)\t((mod)->priv)\n#define rsnd_mod_power_on(mod)\tclk_enable((mod)->clk)\n#define rsnd_mod_power_off(mod)\tclk_disable((mod)->clk)\n#define rsnd_mod_get(ip)\t(&(ip)->mod)\n\nint rsnd_mod_init(struct rsnd_priv *priv,\n\t\t  struct rsnd_mod *mod,\n\t\t  struct rsnd_mod_ops *ops,\n\t\t  struct clk *clk,\n\t\t  enum rsnd_mod_type type,\n\t\t  int id);\nvoid rsnd_mod_quit(struct rsnd_mod *mod);\nstruct dma_chan *rsnd_mod_dma_req(struct rsnd_dai_stream *io,\n\t\t\t\t  struct rsnd_mod *mod);\nvoid rsnd_mod_interrupt(struct rsnd_mod *mod,\n\t\t\tvoid (*callback)(struct rsnd_mod *mod,\n\t\t\t\t\t struct rsnd_dai_stream *io));\nu32 *rsnd_mod_get_status(struct rsnd_mod *mod,\n\t\t\t struct rsnd_dai_stream *io,\n\t\t\t enum rsnd_mod_type type);\nint rsnd_mod_id(struct rsnd_mod *mod);\nint rsnd_mod_id_raw(struct rsnd_mod *mod);\nint rsnd_mod_id_sub(struct rsnd_mod *mod);\nchar *rsnd_mod_name(struct rsnd_mod *mod);\nstruct rsnd_mod *rsnd_mod_next(int *iterator,\n\t\t\t       struct rsnd_dai_stream *io,\n\t\t\t       enum rsnd_mod_type *array,\n\t\t\t       int array_size);\n#define for_each_rsnd_mod(iterator, pos, io)\t\t\t\t\\\n\tfor (iterator = 0;\t\t\t\t\t\t\\\n\t     (pos = rsnd_mod_next(&iterator, io, NULL, 0)); iterator++)\n#define for_each_rsnd_mod_arrays(iterator, pos, io, array, size)\t\\\n\tfor (iterator = 0;\t\t\t\t\t\t\\\n\t     (pos = rsnd_mod_next(&iterator, io, array, size)); iterator++)\n#define for_each_rsnd_mod_array(iterator, pos, io, array)\t\t\\\n\tfor_each_rsnd_mod_arrays(iterator, pos, io, array, ARRAY_SIZE(array))\n\nvoid rsnd_parse_connect_common(struct rsnd_dai *rdai, char *name,\n\t\tstruct rsnd_mod* (*mod_get)(struct rsnd_priv *priv, int id),\n\t\tstruct device_node *node,\n\t\tstruct device_node *playback,\n\t\tstruct device_node *capture);\nint rsnd_node_count(struct rsnd_priv *priv, struct device_node *node, char *name);\nint rsnd_node_fixed_index(struct device *dev, struct device_node *node, char *name, int idx);\n\nint rsnd_channel_normalization(int chan);\n#define rsnd_runtime_channel_original(io) \\\n\trsnd_runtime_channel_original_with_params(io, NULL)\nint rsnd_runtime_channel_original_with_params(struct rsnd_dai_stream *io,\n\t\t\t\tstruct snd_pcm_hw_params *params);\n#define rsnd_runtime_channel_after_ctu(io)\t\t\t\\\n\trsnd_runtime_channel_after_ctu_with_params(io, NULL)\nint rsnd_runtime_channel_after_ctu_with_params(struct rsnd_dai_stream *io,\n\t\t\t\tstruct snd_pcm_hw_params *params);\n#define rsnd_runtime_channel_for_ssi(io) \\\n\trsnd_runtime_channel_for_ssi_with_params(io, NULL)\nint rsnd_runtime_channel_for_ssi_with_params(struct rsnd_dai_stream *io,\n\t\t\t\t struct snd_pcm_hw_params *params);\nint rsnd_runtime_is_multi_ssi(struct rsnd_dai_stream *io);\nint rsnd_runtime_is_tdm(struct rsnd_dai_stream *io);\nint rsnd_runtime_is_tdm_split(struct rsnd_dai_stream *io);\n\n \n#define rsnd_parse_of_node(priv, node)\t\t\t\t\t\\\n\tof_get_child_by_name(rsnd_priv_to_dev(priv)->of_node, node)\n#define RSND_NODE_DAI\t\"rcar_sound,dai\"\n#define RSND_NODE_SSI\t\"rcar_sound,ssi\"\n#define RSND_NODE_SSIU\t\"rcar_sound,ssiu\"\n#define RSND_NODE_SRC\t\"rcar_sound,src\"\n#define RSND_NODE_CTU\t\"rcar_sound,ctu\"\n#define RSND_NODE_MIX\t\"rcar_sound,mix\"\n#define RSND_NODE_DVC\t\"rcar_sound,dvc\"\n\n \n#define RSND_DAI_NAME_SIZE\t16\nstruct rsnd_dai_stream {\n\tchar name[RSND_DAI_NAME_SIZE];\n\tstruct snd_pcm_substream *substream;\n\tstruct rsnd_mod *mod[RSND_MOD_MAX];\n\tstruct rsnd_mod *dma;\n\tstruct rsnd_dai *rdai;\n\tstruct device *dmac_dev;  \n\tu32 converted_rate;       \n\tint converted_chan;       \n\tu32 parent_ssi_status;\n\tu32 flags;\n};\n\n \n#define RSND_STREAM_HDMI0\t(1 << 0)  \n#define RSND_STREAM_HDMI1\t(1 << 1)  \n#define RSND_STREAM_TDM_SPLIT\t(1 << 2)  \n#define RSND_HW_RULE_ERR\t(1 << 3)  \n\n#define rsnd_io_to_mod(io, i)\t((i) < RSND_MOD_MAX ? (io)->mod[(i)] : NULL)\n#define rsnd_io_to_mod_ssi(io)\trsnd_io_to_mod((io), RSND_MOD_SSI)\n#define rsnd_io_to_mod_ssiu(io)\trsnd_io_to_mod((io), RSND_MOD_SSIU)\n#define rsnd_io_to_mod_ssip(io)\trsnd_io_to_mod((io), RSND_MOD_SSIP)\n#define rsnd_io_to_mod_src(io)\trsnd_io_to_mod((io), RSND_MOD_SRC)\n#define rsnd_io_to_mod_ctu(io)\trsnd_io_to_mod((io), RSND_MOD_CTU)\n#define rsnd_io_to_mod_mix(io)\trsnd_io_to_mod((io), RSND_MOD_MIX)\n#define rsnd_io_to_mod_dvc(io)\trsnd_io_to_mod((io), RSND_MOD_DVC)\n#define rsnd_io_to_mod_cmd(io)\trsnd_io_to_mod((io), RSND_MOD_CMD)\n#define rsnd_io_to_rdai(io)\t((io)->rdai)\n#define rsnd_io_to_priv(io)\t(rsnd_rdai_to_priv(rsnd_io_to_rdai(io)))\n#define rsnd_io_is_play(io)\t(&rsnd_io_to_rdai(io)->playback == io)\n#define rsnd_io_to_runtime(io) ((io)->substream ? \\\n\t\t\t\t(io)->substream->runtime : NULL)\n#define rsnd_io_converted_rate(io)\t((io)->converted_rate)\n#define rsnd_io_converted_chan(io)\t((io)->converted_chan)\nint rsnd_io_is_working(struct rsnd_dai_stream *io);\n\nstruct rsnd_dai {\n\tchar name[RSND_DAI_NAME_SIZE];\n\tstruct rsnd_dai_stream playback;\n\tstruct rsnd_dai_stream capture;\n\tstruct rsnd_priv *priv;\n\tstruct snd_pcm_hw_constraint_list constraint;\n\tstruct of_phandle_args dai_args;\n\n\tint max_channels;\t \n\tint ssi_lane;\t\t \n\tint chan_width;\t\t \n\n\tunsigned int clk_master:1;\n\tunsigned int bit_clk_inv:1;\n\tunsigned int frm_clk_inv:1;\n\tunsigned int sys_delay:1;\n\tunsigned int data_alignment:1;\n};\n\n#define rsnd_rdai_nr(priv) ((priv)->rdai_nr)\n#define rsnd_rdai_is_clk_master(rdai) ((rdai)->clk_master)\n#define rsnd_rdai_to_priv(rdai) ((rdai)->priv)\n#define for_each_rsnd_dai(rdai, priv, i)\t\t\\\n\tfor (i = 0;\t\t\t\t\t\\\n\t     (i < rsnd_rdai_nr(priv)) &&\t\t\\\n\t     ((rdai) = rsnd_rdai_get(priv, i));\t\t\\\n\t     i++)\n\nstruct rsnd_dai *rsnd_rdai_get(struct rsnd_priv *priv, int id);\n\n#define rsnd_rdai_channels_set(rdai, max_channels) \\\n\trsnd_rdai_channels_ctrl(rdai, max_channels)\n#define rsnd_rdai_channels_get(rdai) \\\n\trsnd_rdai_channels_ctrl(rdai, 0)\nint rsnd_rdai_channels_ctrl(struct rsnd_dai *rdai,\n\t\t\t    int max_channels);\n\n#define rsnd_rdai_ssi_lane_set(rdai, ssi_lane) \\\n\trsnd_rdai_ssi_lane_ctrl(rdai, ssi_lane)\n#define rsnd_rdai_ssi_lane_get(rdai) \\\n\trsnd_rdai_ssi_lane_ctrl(rdai, 0)\nint rsnd_rdai_ssi_lane_ctrl(struct rsnd_dai *rdai,\n\t\t\t    int ssi_lane);\n\n#define rsnd_rdai_width_set(rdai, width) \\\n\trsnd_rdai_width_ctrl(rdai, width)\n#define rsnd_rdai_width_get(rdai) \\\n\trsnd_rdai_width_ctrl(rdai, 0)\nint rsnd_rdai_width_ctrl(struct rsnd_dai *rdai, int width);\nvoid rsnd_dai_period_elapsed(struct rsnd_dai_stream *io);\nint rsnd_dai_connect(struct rsnd_mod *mod,\n\t\t     struct rsnd_dai_stream *io,\n\t\t     enum rsnd_mod_type type);\n\n \nint rsnd_gen_probe(struct rsnd_priv *priv);\nvoid __iomem *rsnd_gen_reg_get(struct rsnd_priv *priv,\n\t\t\t       struct rsnd_mod *mod,\n\t\t\t       enum rsnd_reg reg);\nphys_addr_t rsnd_gen_get_phy_addr(struct rsnd_priv *priv, int reg_id);\n#ifdef CONFIG_DEBUG_FS\nvoid __iomem *rsnd_gen_get_base_addr(struct rsnd_priv *priv, int reg_id);\n#endif\n\n \nint rsnd_adg_clk_query(struct rsnd_priv *priv, unsigned int rate);\nint rsnd_adg_ssi_clk_stop(struct rsnd_mod *ssi_mod);\nint rsnd_adg_ssi_clk_try_start(struct rsnd_mod *ssi_mod, unsigned int rate);\nint rsnd_adg_probe(struct rsnd_priv *priv);\nvoid rsnd_adg_remove(struct rsnd_priv *priv);\nint rsnd_adg_set_src_timesel_gen2(struct rsnd_mod *src_mod,\n\t\t\t\t  struct rsnd_dai_stream *io,\n\t\t\t\t  unsigned int in_rate,\n\t\t\t\t  unsigned int out_rate);\nint rsnd_adg_set_cmd_timsel_gen2(struct rsnd_mod *cmd_mod,\n\t\t\t\t struct rsnd_dai_stream *io);\n#define rsnd_adg_clk_enable(priv)\trsnd_adg_clk_control(priv, 1)\n#define rsnd_adg_clk_disable(priv)\trsnd_adg_clk_control(priv, 0)\nvoid rsnd_adg_clk_control(struct rsnd_priv *priv, int enable);\nvoid rsnd_adg_clk_dbg_info(struct rsnd_priv *priv, struct seq_file *m);\n\n \nstruct rsnd_priv {\n\n\tstruct platform_device *pdev;\n\tspinlock_t lock;\n\tunsigned long flags;\n#define RSND_GEN_MASK\t(0xF << 0)\n#define RSND_GEN1\t(1 << 0)\n#define RSND_GEN2\t(2 << 0)\n#define RSND_GEN3\t(3 << 0)\n#define RSND_GEN4\t(4 << 0)\n#define RSND_SOC_MASK\t(0xFF << 4)\n#define RSND_SOC_E\t(1 << 4)  \n\n\t \n\tvoid *gen;\n\n\t \n\tvoid *adg;\n\n\t \n\tvoid *dma;\n\n\t \n\tvoid *ssi;\n\tint ssi_nr;\n\n\t \n\tvoid *ssiu;\n\tint ssiu_nr;\n\n\t \n\tvoid *src;\n\tint src_nr;\n\n\t \n\tvoid *ctu;\n\tint ctu_nr;\n\n\t \n\tvoid *mix;\n\tint mix_nr;\n\n\t \n\tvoid *dvc;\n\tint dvc_nr;\n\n\t \n\tvoid *cmd;\n\tint cmd_nr;\n\n\t \n\tstruct snd_soc_dai_driver *daidrv;\n\tstruct rsnd_dai *rdai;\n\tint rdai_nr;\n\n#define RSND_MAX_COMPONENT 3\n\tint component_dais[RSND_MAX_COMPONENT];\n};\n\n#define rsnd_priv_to_pdev(priv)\t((priv)->pdev)\n#define rsnd_priv_to_dev(priv)\t(&(rsnd_priv_to_pdev(priv)->dev))\n\n#define rsnd_is_gen1(priv)\t(((priv)->flags & RSND_GEN_MASK) == RSND_GEN1)\n#define rsnd_is_gen2(priv)\t(((priv)->flags & RSND_GEN_MASK) == RSND_GEN2)\n#define rsnd_is_gen3(priv)\t(((priv)->flags & RSND_GEN_MASK) == RSND_GEN3)\n#define rsnd_is_gen4(priv)\t(((priv)->flags & RSND_GEN_MASK) == RSND_GEN4)\n#define rsnd_is_e3(priv)\t(((priv)->flags & \\\n\t\t\t\t\t(RSND_GEN_MASK | RSND_SOC_MASK)) == \\\n\t\t\t\t\t(RSND_GEN3 | RSND_SOC_E))\n\n#define rsnd_flags_has(p, f) ((p)->flags & (f))\n#define rsnd_flags_set(p, f) ((p)->flags |= (f))\n#define rsnd_flags_del(p, f) ((p)->flags &= ~(f))\n\n \nstruct rsnd_kctrl_cfg {\n\tunsigned int max;\n\tunsigned int size;\n\tu32 *val;\n\tconst char * const *texts;\n\tint (*accept)(struct rsnd_dai_stream *io);\n\tvoid (*update)(struct rsnd_dai_stream *io, struct rsnd_mod *mod);\n\tstruct rsnd_dai_stream *io;\n\tstruct snd_card *card;\n\tstruct snd_kcontrol *kctrl;\n\tstruct rsnd_mod *mod;\n};\n\n#define RSND_MAX_CHANNELS\t8\nstruct rsnd_kctrl_cfg_m {\n\tstruct rsnd_kctrl_cfg cfg;\n\tu32 val[RSND_MAX_CHANNELS];\n};\n\nstruct rsnd_kctrl_cfg_s {\n\tstruct rsnd_kctrl_cfg cfg;\n\tu32 val;\n};\n#define rsnd_kctrl_size(x)\t((x).cfg.size)\n#define rsnd_kctrl_max(x)\t((x).cfg.max)\n#define rsnd_kctrl_valm(x, i)\t((x).val[i])\t \n#define rsnd_kctrl_vals(x)\t((x).val)\t \n\nint rsnd_kctrl_accept_anytime(struct rsnd_dai_stream *io);\nint rsnd_kctrl_accept_runtime(struct rsnd_dai_stream *io);\nstruct rsnd_kctrl_cfg *rsnd_kctrl_init_m(struct rsnd_kctrl_cfg_m *cfg);\nstruct rsnd_kctrl_cfg *rsnd_kctrl_init_s(struct rsnd_kctrl_cfg_s *cfg);\nint rsnd_kctrl_new(struct rsnd_mod *mod,\n\t\t   struct rsnd_dai_stream *io,\n\t\t   struct snd_soc_pcm_runtime *rtd,\n\t\t   const unsigned char *name,\n\t\t   int (*accept)(struct rsnd_dai_stream *io),\n\t\t   void (*update)(struct rsnd_dai_stream *io,\n\t\t\t\t  struct rsnd_mod *mod),\n\t\t   struct rsnd_kctrl_cfg *cfg,\n\t\t   const char * const *texts,\n\t\t   int size,\n\t\t   u32 max);\n\n#define rsnd_kctrl_new_m(mod, io, rtd, name, accept, update, cfg, size, max) \\\n\trsnd_kctrl_new(mod, io, rtd, name, accept, update, rsnd_kctrl_init_m(cfg), \\\n\t\t       NULL, size, max)\n\n#define rsnd_kctrl_new_s(mod, io, rtd, name, accept, update, cfg, max)\t\\\n\trsnd_kctrl_new(mod, io, rtd, name, accept, update, rsnd_kctrl_init_s(cfg), \\\n\t\t       NULL, 1, max)\n\n#define rsnd_kctrl_new_e(mod, io, rtd, name, accept, update, cfg, texts, size) \\\n\trsnd_kctrl_new(mod, io, rtd, name, accept, update, rsnd_kctrl_init_s(cfg), \\\n\t\t       texts, 1, size)\n\nextern const char * const volume_ramp_rate[];\n#define VOLUME_RAMP_MAX_DVC\t(0x17 + 1)\n#define VOLUME_RAMP_MAX_MIX\t(0x0a + 1)\n\n \nint rsnd_ssi_probe(struct rsnd_priv *priv);\nvoid rsnd_ssi_remove(struct rsnd_priv *priv);\nstruct rsnd_mod *rsnd_ssi_mod_get(struct rsnd_priv *priv, int id);\nint rsnd_ssi_use_busif(struct rsnd_dai_stream *io);\nu32 rsnd_ssi_multi_secondaries_runtime(struct rsnd_dai_stream *io);\nint rsnd_ssi_is_dma_mode(struct rsnd_mod *mod);\n\n#define rsnd_ssi_is_pin_sharing(io)\t\\\n\t__rsnd_ssi_is_pin_sharing(rsnd_io_to_mod_ssi(io))\nint __rsnd_ssi_is_pin_sharing(struct rsnd_mod *mod);\n\n#define rsnd_ssi_of_node(priv) rsnd_parse_of_node(priv, RSND_NODE_SSI)\nvoid rsnd_parse_connect_ssi(struct rsnd_dai *rdai,\n\t\t\t    struct device_node *playback,\n\t\t\t    struct device_node *capture);\nunsigned int rsnd_ssi_clk_query(struct rsnd_dai *rdai,\n\t\t       int param1, int param2, int *idx);\n\n \nint rsnd_ssiu_attach(struct rsnd_dai_stream *io,\n\t\t     struct rsnd_mod *mod);\nint rsnd_ssiu_probe(struct rsnd_priv *priv);\nvoid rsnd_ssiu_remove(struct rsnd_priv *priv);\nvoid rsnd_parse_connect_ssiu(struct rsnd_dai *rdai,\n\t\t\t     struct device_node *playback,\n\t\t\t     struct device_node *capture);\n#define rsnd_ssiu_of_node(priv) rsnd_parse_of_node(priv, RSND_NODE_SSIU)\nbool rsnd_ssiu_busif_err_status_clear(struct rsnd_mod *mod);\n\n \nint rsnd_src_probe(struct rsnd_priv *priv);\nvoid rsnd_src_remove(struct rsnd_priv *priv);\nstruct rsnd_mod *rsnd_src_mod_get(struct rsnd_priv *priv, int id);\n\n#define rsnd_src_get_in_rate(priv, io) rsnd_src_get_rate(priv, io, 1)\n#define rsnd_src_get_out_rate(priv, io) rsnd_src_get_rate(priv, io, 0)\nunsigned int rsnd_src_get_rate(struct rsnd_priv *priv,\n\t\t\t       struct rsnd_dai_stream *io,\n\t\t\t       int is_in);\n\n#define rsnd_src_of_node(priv) rsnd_parse_of_node(priv, RSND_NODE_SRC)\n#define rsnd_parse_connect_src(rdai, playback, capture)\t\t\t\\\n\trsnd_parse_connect_common(rdai, \"src\", rsnd_src_mod_get,\t\\\n\t\t\t\t  rsnd_src_of_node(rsnd_rdai_to_priv(rdai)), \\\n\t\t\t\t\t\t   playback, capture)\n\n \nint rsnd_ctu_probe(struct rsnd_priv *priv);\nvoid rsnd_ctu_remove(struct rsnd_priv *priv);\nstruct rsnd_mod *rsnd_ctu_mod_get(struct rsnd_priv *priv, int id);\n#define rsnd_ctu_of_node(priv) rsnd_parse_of_node(priv, RSND_NODE_CTU)\n#define rsnd_parse_connect_ctu(rdai, playback, capture)\t\t\t\\\n\trsnd_parse_connect_common(rdai, \"ctu\", rsnd_ctu_mod_get,\t\\\n\t\t\t\t  rsnd_ctu_of_node(rsnd_rdai_to_priv(rdai)), \\\n\t\t\t\t\t\t   playback, capture)\n\n \nint rsnd_mix_probe(struct rsnd_priv *priv);\nvoid rsnd_mix_remove(struct rsnd_priv *priv);\nstruct rsnd_mod *rsnd_mix_mod_get(struct rsnd_priv *priv, int id);\n#define rsnd_mix_of_node(priv) rsnd_parse_of_node(priv, RSND_NODE_MIX)\n#define rsnd_parse_connect_mix(rdai, playback, capture)\t\t\t\\\n\trsnd_parse_connect_common(rdai, \"mix\", rsnd_mix_mod_get,\t\\\n\t\t\t\t  rsnd_mix_of_node(rsnd_rdai_to_priv(rdai)), \\\n\t\t\t\t\t\t   playback, capture)\n\n \nint rsnd_dvc_probe(struct rsnd_priv *priv);\nvoid rsnd_dvc_remove(struct rsnd_priv *priv);\nstruct rsnd_mod *rsnd_dvc_mod_get(struct rsnd_priv *priv, int id);\n#define rsnd_dvc_of_node(priv) rsnd_parse_of_node(priv, RSND_NODE_DVC)\n#define rsnd_parse_connect_dvc(rdai, playback, capture)\t\t\t\\\n\trsnd_parse_connect_common(rdai, \"dvc\", rsnd_dvc_mod_get,\t\\\n\t\t\t\t  rsnd_dvc_of_node(rsnd_rdai_to_priv(rdai)), \\\n\t\t\t\t\t\t   playback, capture)\n\n \nint rsnd_cmd_probe(struct rsnd_priv *priv);\nvoid rsnd_cmd_remove(struct rsnd_priv *priv);\nint rsnd_cmd_attach(struct rsnd_dai_stream *io, int id);\n\nvoid rsnd_mod_make_sure(struct rsnd_mod *mod, enum rsnd_mod_type type);\n#ifdef DEBUG\n#define rsnd_mod_confirm_ssi(mssi)\trsnd_mod_make_sure(mssi, RSND_MOD_SSI)\n#define rsnd_mod_confirm_src(msrc)\trsnd_mod_make_sure(msrc, RSND_MOD_SRC)\n#define rsnd_mod_confirm_dvc(mdvc)\trsnd_mod_make_sure(mdvc, RSND_MOD_DVC)\n#else\n#define rsnd_mod_confirm_ssi(mssi)\n#define rsnd_mod_confirm_src(msrc)\n#define rsnd_mod_confirm_dvc(mdvc)\n#endif\n\n \n#define rsnd_print_irq_status(dev, param...) do {\t\\\n\tif (!IS_BUILTIN(RSND_DEBUG_NO_IRQ_STATUS))\t\\\n\t\tdev_info(dev, param);\t\t\t\\\n} while (0)\n\n#ifdef CONFIG_DEBUG_FS\nint rsnd_debugfs_probe(struct snd_soc_component *component);\nvoid rsnd_debugfs_reg_show(struct seq_file *m, phys_addr_t _addr,\n\t\t\t   void __iomem *base, int offset, int size);\nvoid rsnd_debugfs_mod_reg_show(struct seq_file *m, struct rsnd_mod *mod,\n\t\t\t       int reg_id, int offset, int size);\n\n#else\n#define rsnd_debugfs_probe  NULL\n#endif\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}