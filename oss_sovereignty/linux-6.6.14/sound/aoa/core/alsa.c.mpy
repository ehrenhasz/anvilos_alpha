{
  "module_name": "alsa.c",
  "hash_id": "ed74d0671c9b29efa09790eaaed2a9d403e821e5404809acd8cf64941cce637c",
  "original_prompt": "Ingested from linux-6.6.14/sound/aoa/core/alsa.c",
  "human_readable_source": "\n \n#include <linux/module.h>\n#include \"alsa.h\"\n\nstatic int index = -1;\nmodule_param(index, int, 0444);\nMODULE_PARM_DESC(index, \"index for AOA sound card.\");\n\nstatic struct aoa_card *aoa_card;\n\nint aoa_alsa_init(char *name, struct module *mod, struct device *dev)\n{\n\tstruct snd_card *alsa_card;\n\tint err;\n\n\tif (aoa_card)\n\t\t \n\t\treturn -EBUSY;\n\n\terr = snd_card_new(dev, index, name, mod, sizeof(struct aoa_card),\n\t\t\t   &alsa_card);\n\tif (err < 0)\n\t\treturn err;\n\taoa_card = alsa_card->private_data;\n\taoa_card->alsa_card = alsa_card;\n\tstrscpy(alsa_card->driver, \"AppleOnbdAudio\", sizeof(alsa_card->driver));\n\tstrscpy(alsa_card->shortname, name, sizeof(alsa_card->shortname));\n\tstrscpy(alsa_card->longname, name, sizeof(alsa_card->longname));\n\tstrscpy(alsa_card->mixername, name, sizeof(alsa_card->mixername));\n\terr = snd_card_register(aoa_card->alsa_card);\n\tif (err < 0) {\n\t\tprintk(KERN_ERR \"snd-aoa: couldn't register alsa card\\n\");\n\t\tsnd_card_free(aoa_card->alsa_card);\n\t\taoa_card = NULL;\n\t\treturn err;\n\t}\n\treturn 0;\n}\n\nstruct snd_card *aoa_get_card(void)\n{\n\tif (aoa_card)\n\t\treturn aoa_card->alsa_card;\n\treturn NULL;\n}\nEXPORT_SYMBOL_GPL(aoa_get_card);\n\nvoid aoa_alsa_cleanup(void)\n{\n\tif (aoa_card) {\n\t\tsnd_card_free(aoa_card->alsa_card);\n\t\taoa_card = NULL;\n\t}\n}\n\nint aoa_snd_device_new(enum snd_device_type type,\n\t\t       void *device_data, const struct snd_device_ops *ops)\n{\n\tstruct snd_card *card = aoa_get_card();\n\tint err;\n\n\tif (!card) return -ENOMEM;\n\n\terr = snd_device_new(card, type, device_data, ops);\n\tif (err) {\n\t\tprintk(KERN_ERR \"snd-aoa: failed to create snd device (%d)\\n\", err);\n\t\treturn err;\n\t}\n\terr = snd_device_register(card, device_data);\n\tif (err) {\n\t\tprintk(KERN_ERR \"snd-aoa: failed to register \"\n\t\t\t\t\"snd device (%d)\\n\", err);\n\t\tprintk(KERN_ERR \"snd-aoa: have you forgotten the \"\n\t\t\t\t\"dev_register callback?\\n\");\n\t\tsnd_device_free(card, device_data);\n\t}\n\treturn err;\n}\nEXPORT_SYMBOL_GPL(aoa_snd_device_new);\n\nint aoa_snd_ctl_add(struct snd_kcontrol* control)\n{\n\tint err;\n\n\tif (!aoa_card) return -ENODEV;\n\n\terr = snd_ctl_add(aoa_card->alsa_card, control);\n\tif (err)\n\t\tprintk(KERN_ERR \"snd-aoa: failed to add alsa control (%d)\\n\",\n\t\t       err);\n\treturn err;\n}\nEXPORT_SYMBOL_GPL(aoa_snd_ctl_add);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}