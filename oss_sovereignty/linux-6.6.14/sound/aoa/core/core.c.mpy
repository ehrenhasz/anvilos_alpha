{
  "module_name": "core.c",
  "hash_id": "914896cbdb4eaeff05ad7f98e2a0e7facea3494ce8d29e1e9d508e82228c9429",
  "original_prompt": "Ingested from linux-6.6.14/sound/aoa/core/core.c",
  "human_readable_source": "\n \n\n#include <linux/init.h>\n#include <linux/module.h>\n#include <linux/list.h>\n#include \"../aoa.h\"\n#include \"alsa.h\"\n\nMODULE_DESCRIPTION(\"Apple Onboard Audio Sound Driver\");\nMODULE_AUTHOR(\"Johannes Berg <johannes@sipsolutions.net>\");\nMODULE_LICENSE(\"GPL\");\n\n \nstatic struct aoa_fabric *fabric;\nstatic LIST_HEAD(codec_list);\n\nstatic int attach_codec_to_fabric(struct aoa_codec *c)\n{\n\tint err;\n\n\tif (!try_module_get(c->owner))\n\t\treturn -EBUSY;\n\t \n\terr = -ENOENT;\n\tif (fabric->found_codec)\n\t\terr = fabric->found_codec(c);\n\tif (err) {\n\t\tmodule_put(c->owner);\n\t\tprintk(KERN_ERR \"snd-aoa: fabric didn't like codec %s\\n\",\n\t\t\t\tc->name);\n\t\treturn err;\n\t}\n\tc->fabric = fabric;\n\n\terr = 0;\n\tif (c->init)\n\t\terr = c->init(c);\n\tif (err) {\n\t\tprintk(KERN_ERR \"snd-aoa: codec %s didn't init\\n\", c->name);\n\t\tc->fabric = NULL;\n\t\tif (fabric->remove_codec)\n\t\t\tfabric->remove_codec(c);\n\t\tmodule_put(c->owner);\n\t\treturn err;\n\t}\n\tif (fabric->attached_codec)\n\t\tfabric->attached_codec(c);\n\treturn 0;\n}\n\nint aoa_codec_register(struct aoa_codec *codec)\n{\n\tint err = 0;\n\n\t \n\tif (fabric)\n\t\terr = attach_codec_to_fabric(codec);\n\tif (!err)\n\t\tlist_add(&codec->list, &codec_list);\n\treturn err;\n}\nEXPORT_SYMBOL_GPL(aoa_codec_register);\n\nvoid aoa_codec_unregister(struct aoa_codec *codec)\n{\n\tlist_del(&codec->list);\n\tif (codec->fabric && codec->exit)\n\t\tcodec->exit(codec);\n\tif (fabric && fabric->remove_codec)\n\t\tfabric->remove_codec(codec);\n\tcodec->fabric = NULL;\n\tmodule_put(codec->owner);\n}\nEXPORT_SYMBOL_GPL(aoa_codec_unregister);\n\nint aoa_fabric_register(struct aoa_fabric *new_fabric, struct device *dev)\n{\n\tstruct aoa_codec *c;\n\tint err;\n\n\t \n\tif (new_fabric == fabric) {\n\t\terr = -EALREADY;\n\t\tgoto attach;\n\t}\n\tif (fabric)\n\t\treturn -EEXIST;\n\tif (!new_fabric)\n\t\treturn -EINVAL;\n\n\terr = aoa_alsa_init(new_fabric->name, new_fabric->owner, dev);\n\tif (err)\n\t\treturn err;\n\n\tfabric = new_fabric;\n\n attach:\n\tlist_for_each_entry(c, &codec_list, list) {\n\t\tif (c->fabric != fabric)\n\t\t\tattach_codec_to_fabric(c);\n\t}\n\treturn err;\n}\nEXPORT_SYMBOL_GPL(aoa_fabric_register);\n\nvoid aoa_fabric_unregister(struct aoa_fabric *old_fabric)\n{\n\tstruct aoa_codec *c;\n\n\tif (fabric != old_fabric)\n\t\treturn;\n\n\tlist_for_each_entry(c, &codec_list, list) {\n\t\tif (c->fabric)\n\t\t\taoa_fabric_unlink_codec(c);\n\t}\n\n\taoa_alsa_cleanup();\n\n\tfabric = NULL;\n}\nEXPORT_SYMBOL_GPL(aoa_fabric_unregister);\n\nvoid aoa_fabric_unlink_codec(struct aoa_codec *codec)\n{\n\tif (!codec->fabric) {\n\t\tprintk(KERN_ERR \"snd-aoa: fabric unassigned \"\n\t\t\t\t\"in aoa_fabric_unlink_codec\\n\");\n\t\tdump_stack();\n\t\treturn;\n\t}\n\tif (codec->exit)\n\t\tcodec->exit(codec);\n\tif (codec->fabric->remove_codec)\n\t\tcodec->fabric->remove_codec(codec);\n\tcodec->fabric = NULL;\n\tmodule_put(codec->owner);\n}\nEXPORT_SYMBOL_GPL(aoa_fabric_unlink_codec);\n\nstatic int __init aoa_init(void)\n{\n\treturn 0;\n}\n\nstatic void __exit aoa_exit(void)\n{\n\taoa_alsa_cleanup();\n}\n\nmodule_init(aoa_init);\nmodule_exit(aoa_exit);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}