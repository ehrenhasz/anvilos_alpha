{
  "module_name": "poly_sin.c",
  "hash_id": "51d64cf013614cc88753720ca3b818294f39441103b31ce1330244a78866b228",
  "original_prompt": "Ingested from linux-6.6.14/arch/x86/math-emu/poly_sin.c",
  "human_readable_source": "\n \n\n#include \"exception.h\"\n#include \"reg_constant.h\"\n#include \"fpu_emu.h\"\n#include \"fpu_system.h\"\n#include \"control_w.h\"\n#include \"poly.h\"\n\n#define\tN_COEFF_P\t4\n#define\tN_COEFF_N\t4\n\nstatic const unsigned long long pos_terms_l[N_COEFF_P] = {\n\t0xaaaaaaaaaaaaaaabLL,\n\t0x00d00d00d00cf906LL,\n\t0x000006b99159a8bbLL,\n\t0x000000000d7392e6LL\n};\n\nstatic const unsigned long long neg_terms_l[N_COEFF_N] = {\n\t0x2222222222222167LL,\n\t0x0002e3bc74aab624LL,\n\t0x0000000b09229062LL,\n\t0x00000000000c7973LL\n};\n\n#define\tN_COEFF_PH\t4\n#define\tN_COEFF_NH\t4\nstatic const unsigned long long pos_terms_h[N_COEFF_PH] = {\n\t0x0000000000000000LL,\n\t0x05b05b05b05b0406LL,\n\t0x000049f93edd91a9LL,\n\t0x00000000c9c9ed62LL\n};\n\nstatic const unsigned long long neg_terms_h[N_COEFF_NH] = {\n\t0xaaaaaaaaaaaaaa98LL,\n\t0x001a01a01a019064LL,\n\t0x0000008f76c68a77LL,\n\t0x0000000000d58f5eLL\n};\n\n \nvoid poly_sine(FPU_REG *st0_ptr)\n{\n\tint exponent, echange;\n\tXsig accumulator, argSqrd, argTo4;\n\tunsigned long fix_up, adj;\n\tunsigned long long fixed_arg;\n\tFPU_REG result;\n\n\texponent = exponent(st0_ptr);\n\n\taccumulator.lsw = accumulator.midw = accumulator.msw = 0;\n\n\t \n\t \n\tif ((exponent < -1)\n\t    || ((exponent == -1) && (st0_ptr->sigh <= 0xe21240aa))) {\n\t\t \n\n\t\targSqrd.msw = st0_ptr->sigh;\n\t\targSqrd.midw = st0_ptr->sigl;\n\t\targSqrd.lsw = 0;\n\t\tmul64_Xsig(&argSqrd, &significand(st0_ptr));\n\t\tshr_Xsig(&argSqrd, 2 * (-1 - exponent));\n\t\targTo4.msw = argSqrd.msw;\n\t\targTo4.midw = argSqrd.midw;\n\t\targTo4.lsw = argSqrd.lsw;\n\t\tmul_Xsig_Xsig(&argTo4, &argTo4);\n\n\t\tpolynomial_Xsig(&accumulator, &XSIG_LL(argTo4), neg_terms_l,\n\t\t\t\tN_COEFF_N - 1);\n\t\tmul_Xsig_Xsig(&accumulator, &argSqrd);\n\t\tnegate_Xsig(&accumulator);\n\n\t\tpolynomial_Xsig(&accumulator, &XSIG_LL(argTo4), pos_terms_l,\n\t\t\t\tN_COEFF_P - 1);\n\n\t\tshr_Xsig(&accumulator, 2);\t \n\t\taccumulator.msw |= 0x80000000;\t \n\n\t\tmul64_Xsig(&accumulator, &significand(st0_ptr));\n\t\tmul64_Xsig(&accumulator, &significand(st0_ptr));\n\t\tmul64_Xsig(&accumulator, &significand(st0_ptr));\n\n\t\t \n\t\texponent = 3 * exponent;\n\n\t\t \n\t\tshr_Xsig(&accumulator, exponent(st0_ptr) - exponent);\n\n\t\tnegate_Xsig(&accumulator);\n\t\tXSIG_LL(accumulator) += significand(st0_ptr);\n\n\t\techange = round_Xsig(&accumulator);\n\n\t\tsetexponentpos(&result, exponent(st0_ptr) + echange);\n\t} else {\n\t\t \n\t\t \n\n\t\tfixed_arg = significand(st0_ptr);\n\n\t\tif (exponent == 0) {\n\t\t\t \n\n\t\t\t \n\t\t\tfixed_arg <<= 1;\n\t\t}\n\t\t \n\t\tfixed_arg = 0x921fb54442d18469LL - fixed_arg;\n\t\t \n\t\tif (fixed_arg == 0xffffffffffffffffLL)\n\t\t\tfixed_arg = 0;\n\n\t\tXSIG_LL(argSqrd) = fixed_arg;\n\t\targSqrd.lsw = 0;\n\t\tmul64_Xsig(&argSqrd, &fixed_arg);\n\n\t\tXSIG_LL(argTo4) = XSIG_LL(argSqrd);\n\t\targTo4.lsw = argSqrd.lsw;\n\t\tmul_Xsig_Xsig(&argTo4, &argTo4);\n\n\t\tpolynomial_Xsig(&accumulator, &XSIG_LL(argTo4), neg_terms_h,\n\t\t\t\tN_COEFF_NH - 1);\n\t\tmul_Xsig_Xsig(&accumulator, &argSqrd);\n\t\tnegate_Xsig(&accumulator);\n\n\t\tpolynomial_Xsig(&accumulator, &XSIG_LL(argTo4), pos_terms_h,\n\t\t\t\tN_COEFF_PH - 1);\n\t\tnegate_Xsig(&accumulator);\n\n\t\tmul64_Xsig(&accumulator, &fixed_arg);\n\t\tmul64_Xsig(&accumulator, &fixed_arg);\n\n\t\tshr_Xsig(&accumulator, 3);\n\t\tnegate_Xsig(&accumulator);\n\n\t\tadd_Xsig_Xsig(&accumulator, &argSqrd);\n\n\t\tshr_Xsig(&accumulator, 1);\n\n\t\taccumulator.lsw |= 1;\t \n\t\tnegate_Xsig(&accumulator);\n\n\t\t \n\n\t\t \n\t\tfix_up = 0x898cc517;\n\t\t \n\t\tif (argSqrd.msw & 0xffc00000) {\n\t\t\t \n\t\t\tfix_up -= mul_32_32(0x898cc517, argSqrd.msw) / 6;\n\t\t}\n\t\tfix_up = mul_32_32(fix_up, LL_MSW(fixed_arg));\n\n\t\tadj = accumulator.lsw;\t \n\t\taccumulator.lsw -= fix_up;\n\t\tif (accumulator.lsw > adj)\n\t\t\tXSIG_LL(accumulator)--;\n\n\t\techange = round_Xsig(&accumulator);\n\n\t\tsetexponentpos(&result, echange - 1);\n\t}\n\n\tsignificand(&result) = XSIG_LL(accumulator);\n\tsetsign(&result, getsign(st0_ptr));\n\tFPU_copy_to_reg0(&result, TAG_Valid);\n\n#ifdef PARANOID\n\tif ((exponent(&result) >= 0)\n\t    && (significand(&result) > 0x8000000000000000LL)) {\n\t\tEXCEPTION(EX_INTERNAL | 0x150);\n\t}\n#endif  \n\n}\n\n \nvoid poly_cos(FPU_REG *st0_ptr)\n{\n\tFPU_REG result;\n\tlong int exponent, exp2, echange;\n\tXsig accumulator, argSqrd, fix_up, argTo4;\n\tunsigned long long fixed_arg;\n\n#ifdef PARANOID\n\tif ((exponent(st0_ptr) > 0)\n\t    || ((exponent(st0_ptr) == 0)\n\t\t&& (significand(st0_ptr) > 0xc90fdaa22168c234LL))) {\n\t\tEXCEPTION(EX_Invalid);\n\t\tFPU_copy_to_reg0(&CONST_QNaN, TAG_Special);\n\t\treturn;\n\t}\n#endif  \n\n\texponent = exponent(st0_ptr);\n\n\taccumulator.lsw = accumulator.midw = accumulator.msw = 0;\n\n\tif ((exponent < -1)\n\t    || ((exponent == -1) && (st0_ptr->sigh <= 0xb00d6f54))) {\n\t\t \n\n\t\targSqrd.msw = st0_ptr->sigh;\n\t\targSqrd.midw = st0_ptr->sigl;\n\t\targSqrd.lsw = 0;\n\t\tmul64_Xsig(&argSqrd, &significand(st0_ptr));\n\n\t\tif (exponent < -1) {\n\t\t\t \n\t\t\tshr_Xsig(&argSqrd, 2 * (-1 - exponent));\n\t\t}\n\n\t\targTo4.msw = argSqrd.msw;\n\t\targTo4.midw = argSqrd.midw;\n\t\targTo4.lsw = argSqrd.lsw;\n\t\tmul_Xsig_Xsig(&argTo4, &argTo4);\n\n\t\tpolynomial_Xsig(&accumulator, &XSIG_LL(argTo4), neg_terms_h,\n\t\t\t\tN_COEFF_NH - 1);\n\t\tmul_Xsig_Xsig(&accumulator, &argSqrd);\n\t\tnegate_Xsig(&accumulator);\n\n\t\tpolynomial_Xsig(&accumulator, &XSIG_LL(argTo4), pos_terms_h,\n\t\t\t\tN_COEFF_PH - 1);\n\t\tnegate_Xsig(&accumulator);\n\n\t\tmul64_Xsig(&accumulator, &significand(st0_ptr));\n\t\tmul64_Xsig(&accumulator, &significand(st0_ptr));\n\t\tshr_Xsig(&accumulator, -2 * (1 + exponent));\n\n\t\tshr_Xsig(&accumulator, 3);\n\t\tnegate_Xsig(&accumulator);\n\n\t\tadd_Xsig_Xsig(&accumulator, &argSqrd);\n\n\t\tshr_Xsig(&accumulator, 1);\n\n\t\t \n\t\tnegate_Xsig(&accumulator);\n\n\t\tif (accumulator.lsw & 0x80000000)\n\t\t\tXSIG_LL(accumulator)++;\n\t\tif (accumulator.msw == 0) {\n\t\t\t \n\t\t\tFPU_copy_to_reg0(&CONST_1, TAG_Valid);\n\t\t\treturn;\n\t\t} else {\n\t\t\tsignificand(&result) = XSIG_LL(accumulator);\n\n\t\t\t \n\t\t\tsetexponentpos(&result, -1);\n\t\t}\n\t} else {\n\t\tfixed_arg = significand(st0_ptr);\n\n\t\tif (exponent == 0) {\n\t\t\t \n\n\t\t\t \n\t\t\tfixed_arg <<= 1;\n\t\t}\n\t\t \n\t\tfixed_arg = 0x921fb54442d18469LL - fixed_arg;\n\t\t \n\t\tif (fixed_arg == 0xffffffffffffffffLL)\n\t\t\tfixed_arg = 0;\n\n\t\texponent = -1;\n\t\texp2 = -1;\n\n\t\t \n\t\tif (!(LL_MSW(fixed_arg) & 0xffff0000)) {\n\t\t\tfixed_arg <<= 16;\n\t\t\texponent -= 16;\n\t\t\texp2 -= 16;\n\t\t}\n\n\t\tXSIG_LL(argSqrd) = fixed_arg;\n\t\targSqrd.lsw = 0;\n\t\tmul64_Xsig(&argSqrd, &fixed_arg);\n\n\t\tif (exponent < -1) {\n\t\t\t \n\t\t\tshr_Xsig(&argSqrd, 2 * (-1 - exponent));\n\t\t}\n\n\t\targTo4.msw = argSqrd.msw;\n\t\targTo4.midw = argSqrd.midw;\n\t\targTo4.lsw = argSqrd.lsw;\n\t\tmul_Xsig_Xsig(&argTo4, &argTo4);\n\n\t\tpolynomial_Xsig(&accumulator, &XSIG_LL(argTo4), neg_terms_l,\n\t\t\t\tN_COEFF_N - 1);\n\t\tmul_Xsig_Xsig(&accumulator, &argSqrd);\n\t\tnegate_Xsig(&accumulator);\n\n\t\tpolynomial_Xsig(&accumulator, &XSIG_LL(argTo4), pos_terms_l,\n\t\t\t\tN_COEFF_P - 1);\n\n\t\tshr_Xsig(&accumulator, 2);\t \n\t\taccumulator.msw |= 0x80000000;\t \n\n\t\tmul64_Xsig(&accumulator, &fixed_arg);\n\t\tmul64_Xsig(&accumulator, &fixed_arg);\n\t\tmul64_Xsig(&accumulator, &fixed_arg);\n\n\t\t \n\t\texponent = 3 * exponent;\n\n\t\t \n\t\tshr_Xsig(&accumulator, exp2 - exponent);\n\n\t\tnegate_Xsig(&accumulator);\n\t\tXSIG_LL(accumulator) += fixed_arg;\n\n\t\t \n\n\t\t \n\t\tXSIG_LL(fix_up) = 0x898cc51701b839a2ll;\n\t\tfix_up.lsw = 0;\n\n\t\t \n\t\tif (argSqrd.msw & 0xffc00000) {\n\t\t\t \n\t\t\tfix_up.msw -= mul_32_32(0x898cc517, argSqrd.msw) / 2;\n\t\t\tfix_up.msw += mul_32_32(0x898cc517, argTo4.msw) / 24;\n\t\t}\n\n\t\texp2 += norm_Xsig(&accumulator);\n\t\tshr_Xsig(&accumulator, 1);\t \n\t\texp2++;\n\t\tshr_Xsig(&fix_up, 65 + exp2);\n\n\t\tadd_Xsig_Xsig(&accumulator, &fix_up);\n\n\t\techange = round_Xsig(&accumulator);\n\n\t\tsetexponentpos(&result, exp2 + echange);\n\t\tsignificand(&result) = XSIG_LL(accumulator);\n\t}\n\n\tFPU_copy_to_reg0(&result, TAG_Valid);\n\n#ifdef PARANOID\n\tif ((exponent(&result) >= 0)\n\t    && (significand(&result) > 0x8000000000000000LL)) {\n\t\tEXCEPTION(EX_INTERNAL | 0x151);\n\t}\n#endif  \n\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}