{
  "module_name": "load_store.c",
  "hash_id": "d89bcf6fa57fdeef4dccbfae57a158dfe225ea5cedaa930cde0116242dca8279",
  "original_prompt": "Ingested from linux-6.6.14/arch/x86/math-emu/load_store.c",
  "human_readable_source": "\n \n\n \n\n#include <linux/uaccess.h>\n\n#include \"fpu_system.h\"\n#include \"exception.h\"\n#include \"fpu_emu.h\"\n#include \"status_w.h\"\n#include \"control_w.h\"\n\n#define _NONE_ 0\t\t \n#define _REG0_ 1\t\t \n#define _PUSH_ 3\t\t \n#define _null_ 4\t\t \n\n#define pop_0()\t{ FPU_settag0(TAG_Empty); top++; }\n\n \nstatic u_char const type_table[32] = {\n\t_PUSH_, _PUSH_, _PUSH_, _PUSH_,  \n\t_null_, _REG0_, _REG0_, _REG0_,  \n\t_REG0_, _REG0_, _REG0_, _REG0_,  \n\t_REG0_, _REG0_, _REG0_, _REG0_,  \n\t_NONE_, _null_, _NONE_, _PUSH_,\n\t_NONE_, _PUSH_, _null_, _PUSH_,\n\t_NONE_, _null_, _NONE_, _REG0_,\n\t_NONE_, _REG0_, _NONE_, _REG0_\n};\n\nu_char const data_sizes_16[32] = {\n\t4, 4, 8, 2,\n\t0, 4, 8, 2,  \n\t4, 4, 8, 2,\n\t4, 4, 8, 2,\n\t14, 0, 94, 10, 2, 10, 0, 8,\n\t14, 0, 94, 10, 2, 10, 2, 8\n};\n\nstatic u_char const data_sizes_32[32] = {\n\t4, 4, 8, 2,\n\t0, 4, 8, 2,  \n\t4, 4, 8, 2,\n\t4, 4, 8, 2,\n\t28, 0, 108, 10, 2, 10, 0, 8,\n\t28, 0, 108, 10, 2, 10, 2, 8\n};\n\nint FPU_load_store(u_char type, fpu_addr_modes addr_modes,\n\t\t   void __user * data_address)\n{\n\tFPU_REG loaded_data;\n\tFPU_REG *st0_ptr;\n\tu_char st0_tag = TAG_Empty;\t \n\tu_char loaded_tag;\n\tint sv_cw;\n\n\tst0_ptr = NULL;\t\t \n\n\tif (addr_modes.default_mode & PROTECTED) {\n\t\tif (addr_modes.default_mode == SEG32) {\n\t\t\tif (access_limit < data_sizes_32[type])\n\t\t\t\tmath_abort(FPU_info, SIGSEGV);\n\t\t} else if (addr_modes.default_mode == PM16) {\n\t\t\tif (access_limit < data_sizes_16[type])\n\t\t\t\tmath_abort(FPU_info, SIGSEGV);\n\t\t}\n#ifdef PARANOID\n\t\telse\n\t\t\tEXCEPTION(EX_INTERNAL | 0x140);\n#endif  \n\t}\n\n\tswitch (type_table[type]) {\n\tcase _NONE_:\n\t\tbreak;\n\tcase _REG0_:\n\t\tst0_ptr = &st(0);\t \n\t\tst0_tag = FPU_gettag0();\n\t\tbreak;\n\tcase _PUSH_:\n\t\t{\n\t\t\tif (FPU_gettagi(-1) != TAG_Empty) {\n\t\t\t\tFPU_stack_overflow();\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t\ttop--;\n\t\t\tst0_ptr = &st(0);\n\t\t}\n\t\tbreak;\n\tcase _null_:\n\t\tFPU_illegal();\n\t\treturn 0;\n#ifdef PARANOID\n\tdefault:\n\t\tEXCEPTION(EX_INTERNAL | 0x141);\n\t\treturn 0;\n#endif  \n\t}\n\n\tswitch (type) {\n\t \n\tcase 000:\t\t \n\t\tclear_C1();\n\t\tloaded_tag =\n\t\t    FPU_load_single((float __user *)data_address, &loaded_data);\n\t\tif ((loaded_tag == TAG_Special)\n\t\t    && isNaN(&loaded_data)\n\t\t    && (real_1op_NaN(&loaded_data) < 0)) {\n\t\t\ttop++;\n\t\t\tbreak;\n\t\t}\n\t\tFPU_copy_to_reg0(&loaded_data, loaded_tag);\n\t\tbreak;\n\tcase 001:\t\t \n\t\tclear_C1();\n\t\tloaded_tag =\n\t\t    FPU_load_int32((long __user *)data_address, &loaded_data);\n\t\tFPU_copy_to_reg0(&loaded_data, loaded_tag);\n\t\tbreak;\n\tcase 002:\t\t \n\t\tclear_C1();\n\t\tloaded_tag =\n\t\t    FPU_load_double((double __user *)data_address,\n\t\t\t\t    &loaded_data);\n\t\tif ((loaded_tag == TAG_Special)\n\t\t    && isNaN(&loaded_data)\n\t\t    && (real_1op_NaN(&loaded_data) < 0)) {\n\t\t\ttop++;\n\t\t\tbreak;\n\t\t}\n\t\tFPU_copy_to_reg0(&loaded_data, loaded_tag);\n\t\tbreak;\n\tcase 003:\t\t \n\t\tclear_C1();\n\t\tloaded_tag =\n\t\t    FPU_load_int16((short __user *)data_address, &loaded_data);\n\t\tFPU_copy_to_reg0(&loaded_data, loaded_tag);\n\t\tbreak;\n\t \n\t \n\tcase 005:\t\t \n\t\tclear_C1();\n\t\tsv_cw = control_word;\n\t\tcontrol_word |= RC_CHOP;\n\t\tif (FPU_store_int32\n\t\t    (st0_ptr, st0_tag, (long __user *)data_address))\n\t\t\tpop_0();\t \n\t\tcontrol_word = sv_cw;\n\t\tbreak;\n\tcase 006:\t\t \n\t\tclear_C1();\n\t\tsv_cw = control_word;\n\t\tcontrol_word |= RC_CHOP;\n\t\tif (FPU_store_int64\n\t\t    (st0_ptr, st0_tag, (long long __user *)data_address))\n\t\t\tpop_0();\t \n\t\tcontrol_word = sv_cw;\n\t\tbreak;\n\tcase 007:\t\t \n\t\tclear_C1();\n\t\tsv_cw = control_word;\n\t\tcontrol_word |= RC_CHOP;\n\t\tif (FPU_store_int16\n\t\t    (st0_ptr, st0_tag, (short __user *)data_address))\n\t\t\tpop_0();\t \n\t\tcontrol_word = sv_cw;\n\t\tbreak;\n\tcase 010:\t\t \n\t\tclear_C1();\n\t\tFPU_store_single(st0_ptr, st0_tag,\n\t\t\t\t (float __user *)data_address);\n\t\tbreak;\n\tcase 011:\t\t \n\t\tclear_C1();\n\t\tFPU_store_int32(st0_ptr, st0_tag, (long __user *)data_address);\n\t\tbreak;\n\tcase 012:\t\t \n\t\tclear_C1();\n\t\tFPU_store_double(st0_ptr, st0_tag,\n\t\t\t\t (double __user *)data_address);\n\t\tbreak;\n\tcase 013:\t\t \n\t\tclear_C1();\n\t\tFPU_store_int16(st0_ptr, st0_tag, (short __user *)data_address);\n\t\tbreak;\n\tcase 014:\t\t \n\t\tclear_C1();\n\t\tif (FPU_store_single\n\t\t    (st0_ptr, st0_tag, (float __user *)data_address))\n\t\t\tpop_0();\t \n\t\tbreak;\n\tcase 015:\t\t \n\t\tclear_C1();\n\t\tif (FPU_store_int32\n\t\t    (st0_ptr, st0_tag, (long __user *)data_address))\n\t\t\tpop_0();\t \n\t\tbreak;\n\tcase 016:\t\t \n\t\tclear_C1();\n\t\tif (FPU_store_double\n\t\t    (st0_ptr, st0_tag, (double __user *)data_address))\n\t\t\tpop_0();\t \n\t\tbreak;\n\tcase 017:\t\t \n\t\tclear_C1();\n\t\tif (FPU_store_int16\n\t\t    (st0_ptr, st0_tag, (short __user *)data_address))\n\t\t\tpop_0();\t \n\t\tbreak;\n\tcase 020:\t\t \n\t\tfldenv(addr_modes, (u_char __user *) data_address);\n\t\t \n\t\treturn 1;\n\tcase 022:\t\t \n\t\tFPU_frstor(addr_modes, (u_char __user *) data_address);\n\t\t \n\t\treturn 1;\n\tcase 023:\t\t \n\t\tclear_C1();\n\t\tloaded_tag = FPU_load_bcd((u_char __user *) data_address);\n\t\tFPU_settag0(loaded_tag);\n\t\tbreak;\n\tcase 024:\t\t \n\t\tRE_ENTRANT_CHECK_OFF;\n\t\tFPU_access_ok(data_address, 2);\n\t\tFPU_get_user(control_word,\n\t\t\t     (unsigned short __user *)data_address);\n\t\tRE_ENTRANT_CHECK_ON;\n\t\tif (partial_status & ~control_word & CW_Exceptions)\n\t\t\tpartial_status |= (SW_Summary | SW_Backward);\n\t\telse\n\t\t\tpartial_status &= ~(SW_Summary | SW_Backward);\n#ifdef PECULIAR_486\n\t\tcontrol_word |= 0x40;\t \n#endif  \n\t\treturn 1;\n\tcase 025:\t\t \n\t\tclear_C1();\n\t\tloaded_tag =\n\t\t    FPU_load_extended((long double __user *)data_address, 0);\n\t\tFPU_settag0(loaded_tag);\n\t\tbreak;\n\tcase 027:\t\t \n\t\tclear_C1();\n\t\tloaded_tag = FPU_load_int64((long long __user *)data_address);\n\t\tif (loaded_tag == TAG_Error)\n\t\t\treturn 0;\n\t\tFPU_settag0(loaded_tag);\n\t\tbreak;\n\tcase 030:\t\t \n\t\tfstenv(addr_modes, (u_char __user *) data_address);\n\t\treturn 1;\n\tcase 032:\t\t \n\t\tfsave(addr_modes, (u_char __user *) data_address);\n\t\treturn 1;\n\tcase 033:\t\t \n\t\tclear_C1();\n\t\tif (FPU_store_bcd\n\t\t    (st0_ptr, st0_tag, (u_char __user *) data_address))\n\t\t\tpop_0();\t \n\t\tbreak;\n\tcase 034:\t\t \n\t\tRE_ENTRANT_CHECK_OFF;\n\t\tFPU_access_ok(data_address, 2);\n\t\tFPU_put_user(control_word,\n\t\t\t     (unsigned short __user *)data_address);\n\t\tRE_ENTRANT_CHECK_ON;\n\t\treturn 1;\n\tcase 035:\t\t \n\t\tclear_C1();\n\t\tif (FPU_store_extended\n\t\t    (st0_ptr, st0_tag, (long double __user *)data_address))\n\t\t\tpop_0();\t \n\t\tbreak;\n\tcase 036:\t\t \n\t\tRE_ENTRANT_CHECK_OFF;\n\t\tFPU_access_ok(data_address, 2);\n\t\tFPU_put_user(status_word(),\n\t\t\t     (unsigned short __user *)data_address);\n\t\tRE_ENTRANT_CHECK_ON;\n\t\treturn 1;\n\tcase 037:\t\t \n\t\tclear_C1();\n\t\tif (FPU_store_int64\n\t\t    (st0_ptr, st0_tag, (long long __user *)data_address))\n\t\t\tpop_0();\t \n\t\tbreak;\n\t}\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}