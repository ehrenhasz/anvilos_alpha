{
  "module_name": "usercopy_32.c",
  "hash_id": "89f886eed9b2800ddc25523735fb5977b6e88fae76b9869b0a21ee8f0d7919e7",
  "original_prompt": "Ingested from linux-6.6.14/arch/x86/lib/usercopy_32.c",
  "human_readable_source": "\n \n#include <linux/export.h>\n#include <linux/uaccess.h>\n#include <asm/asm.h>\n\n#ifdef CONFIG_X86_INTEL_USERCOPY\n \nstruct movsl_mask movsl_mask __read_mostly;\n#endif\n\nstatic inline int __movsl_is_ok(unsigned long a1, unsigned long a2, unsigned long n)\n{\n#ifdef CONFIG_X86_INTEL_USERCOPY\n\tif (n >= 64 && ((a1 ^ a2) & movsl_mask.mask))\n\t\treturn 0;\n#endif\n\treturn 1;\n}\n#define movsl_is_ok(a1, a2, n) \\\n\t__movsl_is_ok((unsigned long)(a1), (unsigned long)(a2), (n))\n\n \n\n#define __do_clear_user(addr,size)\t\t\t\t\t\\\ndo {\t\t\t\t\t\t\t\t\t\\\n\tint __d0;\t\t\t\t\t\t\t\\\n\tmight_fault();\t\t\t\t\t\t\t\\\n\t__asm__ __volatile__(\t\t\t\t\t\t\\\n\t\tASM_STAC \"\\n\"\t\t\t\t\t\t\\\n\t\t\"0:\trep; stosl\\n\"\t\t\t\t\t\\\n\t\t\"\tmovl %2,%0\\n\"\t\t\t\t\t\\\n\t\t\"1:\trep; stosb\\n\"\t\t\t\t\t\\\n\t\t\"2: \" ASM_CLAC \"\\n\"\t\t\t\t\t\\\n\t\t_ASM_EXTABLE_TYPE_REG(0b, 2b, EX_TYPE_UCOPY_LEN4, %2)\t\\\n\t\t_ASM_EXTABLE_UA(1b, 2b)\t\t\t\t\t\\\n\t\t: \"=&c\"(size), \"=&D\" (__d0)\t\t\t\t\\\n\t\t: \"r\"(size & 3), \"0\"(size / 4), \"1\"(addr), \"a\"(0));\t\\\n} while (0)\n\n \nunsigned long\nclear_user(void __user *to, unsigned long n)\n{\n\tmight_fault();\n\tif (access_ok(to, n))\n\t\t__do_clear_user(to, n);\n\treturn n;\n}\nEXPORT_SYMBOL(clear_user);\n\n \nunsigned long\n__clear_user(void __user *to, unsigned long n)\n{\n\t__do_clear_user(to, n);\n\treturn n;\n}\nEXPORT_SYMBOL(__clear_user);\n\n#ifdef CONFIG_X86_INTEL_USERCOPY\nstatic unsigned long\n__copy_user_intel(void __user *to, const void *from, unsigned long size)\n{\n\tint d0, d1;\n\t__asm__ __volatile__(\n\t\t       \"       .align 2,0x90\\n\"\n\t\t       \"1:     movl 32(%4), %%eax\\n\"\n\t\t       \"       cmpl $67, %0\\n\"\n\t\t       \"       jbe 3f\\n\"\n\t\t       \"2:     movl 64(%4), %%eax\\n\"\n\t\t       \"       .align 2,0x90\\n\"\n\t\t       \"3:     movl 0(%4), %%eax\\n\"\n\t\t       \"4:     movl 4(%4), %%edx\\n\"\n\t\t       \"5:     movl %%eax, 0(%3)\\n\"\n\t\t       \"6:     movl %%edx, 4(%3)\\n\"\n\t\t       \"7:     movl 8(%4), %%eax\\n\"\n\t\t       \"8:     movl 12(%4),%%edx\\n\"\n\t\t       \"9:     movl %%eax, 8(%3)\\n\"\n\t\t       \"10:    movl %%edx, 12(%3)\\n\"\n\t\t       \"11:    movl 16(%4), %%eax\\n\"\n\t\t       \"12:    movl 20(%4), %%edx\\n\"\n\t\t       \"13:    movl %%eax, 16(%3)\\n\"\n\t\t       \"14:    movl %%edx, 20(%3)\\n\"\n\t\t       \"15:    movl 24(%4), %%eax\\n\"\n\t\t       \"16:    movl 28(%4), %%edx\\n\"\n\t\t       \"17:    movl %%eax, 24(%3)\\n\"\n\t\t       \"18:    movl %%edx, 28(%3)\\n\"\n\t\t       \"19:    movl 32(%4), %%eax\\n\"\n\t\t       \"20:    movl 36(%4), %%edx\\n\"\n\t\t       \"21:    movl %%eax, 32(%3)\\n\"\n\t\t       \"22:    movl %%edx, 36(%3)\\n\"\n\t\t       \"23:    movl 40(%4), %%eax\\n\"\n\t\t       \"24:    movl 44(%4), %%edx\\n\"\n\t\t       \"25:    movl %%eax, 40(%3)\\n\"\n\t\t       \"26:    movl %%edx, 44(%3)\\n\"\n\t\t       \"27:    movl 48(%4), %%eax\\n\"\n\t\t       \"28:    movl 52(%4), %%edx\\n\"\n\t\t       \"29:    movl %%eax, 48(%3)\\n\"\n\t\t       \"30:    movl %%edx, 52(%3)\\n\"\n\t\t       \"31:    movl 56(%4), %%eax\\n\"\n\t\t       \"32:    movl 60(%4), %%edx\\n\"\n\t\t       \"33:    movl %%eax, 56(%3)\\n\"\n\t\t       \"34:    movl %%edx, 60(%3)\\n\"\n\t\t       \"       addl $-64, %0\\n\"\n\t\t       \"       addl $64, %4\\n\"\n\t\t       \"       addl $64, %3\\n\"\n\t\t       \"       cmpl $63, %0\\n\"\n\t\t       \"       ja  1b\\n\"\n\t\t       \"35:    movl  %0, %%eax\\n\"\n\t\t       \"       shrl  $2, %0\\n\"\n\t\t       \"       andl  $3, %%eax\\n\"\n\t\t       \"       cld\\n\"\n\t\t       \"99:    rep; movsl\\n\"\n\t\t       \"36:    movl %%eax, %0\\n\"\n\t\t       \"37:    rep; movsb\\n\"\n\t\t       \"100:\\n\"\n\t\t       _ASM_EXTABLE_UA(1b, 100b)\n\t\t       _ASM_EXTABLE_UA(2b, 100b)\n\t\t       _ASM_EXTABLE_UA(3b, 100b)\n\t\t       _ASM_EXTABLE_UA(4b, 100b)\n\t\t       _ASM_EXTABLE_UA(5b, 100b)\n\t\t       _ASM_EXTABLE_UA(6b, 100b)\n\t\t       _ASM_EXTABLE_UA(7b, 100b)\n\t\t       _ASM_EXTABLE_UA(8b, 100b)\n\t\t       _ASM_EXTABLE_UA(9b, 100b)\n\t\t       _ASM_EXTABLE_UA(10b, 100b)\n\t\t       _ASM_EXTABLE_UA(11b, 100b)\n\t\t       _ASM_EXTABLE_UA(12b, 100b)\n\t\t       _ASM_EXTABLE_UA(13b, 100b)\n\t\t       _ASM_EXTABLE_UA(14b, 100b)\n\t\t       _ASM_EXTABLE_UA(15b, 100b)\n\t\t       _ASM_EXTABLE_UA(16b, 100b)\n\t\t       _ASM_EXTABLE_UA(17b, 100b)\n\t\t       _ASM_EXTABLE_UA(18b, 100b)\n\t\t       _ASM_EXTABLE_UA(19b, 100b)\n\t\t       _ASM_EXTABLE_UA(20b, 100b)\n\t\t       _ASM_EXTABLE_UA(21b, 100b)\n\t\t       _ASM_EXTABLE_UA(22b, 100b)\n\t\t       _ASM_EXTABLE_UA(23b, 100b)\n\t\t       _ASM_EXTABLE_UA(24b, 100b)\n\t\t       _ASM_EXTABLE_UA(25b, 100b)\n\t\t       _ASM_EXTABLE_UA(26b, 100b)\n\t\t       _ASM_EXTABLE_UA(27b, 100b)\n\t\t       _ASM_EXTABLE_UA(28b, 100b)\n\t\t       _ASM_EXTABLE_UA(29b, 100b)\n\t\t       _ASM_EXTABLE_UA(30b, 100b)\n\t\t       _ASM_EXTABLE_UA(31b, 100b)\n\t\t       _ASM_EXTABLE_UA(32b, 100b)\n\t\t       _ASM_EXTABLE_UA(33b, 100b)\n\t\t       _ASM_EXTABLE_UA(34b, 100b)\n\t\t       _ASM_EXTABLE_UA(35b, 100b)\n\t\t       _ASM_EXTABLE_UA(36b, 100b)\n\t\t       _ASM_EXTABLE_UA(37b, 100b)\n\t\t       _ASM_EXTABLE_TYPE_REG(99b, 100b, EX_TYPE_UCOPY_LEN4, %%eax)\n\t\t       : \"=&c\"(size), \"=&D\" (d0), \"=&S\" (d1)\n\t\t       :  \"1\"(to), \"2\"(from), \"0\"(size)\n\t\t       : \"eax\", \"edx\", \"memory\");\n\treturn size;\n}\n\nstatic unsigned long __copy_user_intel_nocache(void *to,\n\t\t\t\tconst void __user *from, unsigned long size)\n{\n\tint d0, d1;\n\n\t__asm__ __volatile__(\n\t       \"        .align 2,0x90\\n\"\n\t       \"0:      movl 32(%4), %%eax\\n\"\n\t       \"        cmpl $67, %0\\n\"\n\t       \"        jbe 2f\\n\"\n\t       \"1:      movl 64(%4), %%eax\\n\"\n\t       \"        .align 2,0x90\\n\"\n\t       \"2:      movl 0(%4), %%eax\\n\"\n\t       \"21:     movl 4(%4), %%edx\\n\"\n\t       \"        movnti %%eax, 0(%3)\\n\"\n\t       \"        movnti %%edx, 4(%3)\\n\"\n\t       \"3:      movl 8(%4), %%eax\\n\"\n\t       \"31:     movl 12(%4),%%edx\\n\"\n\t       \"        movnti %%eax, 8(%3)\\n\"\n\t       \"        movnti %%edx, 12(%3)\\n\"\n\t       \"4:      movl 16(%4), %%eax\\n\"\n\t       \"41:     movl 20(%4), %%edx\\n\"\n\t       \"        movnti %%eax, 16(%3)\\n\"\n\t       \"        movnti %%edx, 20(%3)\\n\"\n\t       \"10:     movl 24(%4), %%eax\\n\"\n\t       \"51:     movl 28(%4), %%edx\\n\"\n\t       \"        movnti %%eax, 24(%3)\\n\"\n\t       \"        movnti %%edx, 28(%3)\\n\"\n\t       \"11:     movl 32(%4), %%eax\\n\"\n\t       \"61:     movl 36(%4), %%edx\\n\"\n\t       \"        movnti %%eax, 32(%3)\\n\"\n\t       \"        movnti %%edx, 36(%3)\\n\"\n\t       \"12:     movl 40(%4), %%eax\\n\"\n\t       \"71:     movl 44(%4), %%edx\\n\"\n\t       \"        movnti %%eax, 40(%3)\\n\"\n\t       \"        movnti %%edx, 44(%3)\\n\"\n\t       \"13:     movl 48(%4), %%eax\\n\"\n\t       \"81:     movl 52(%4), %%edx\\n\"\n\t       \"        movnti %%eax, 48(%3)\\n\"\n\t       \"        movnti %%edx, 52(%3)\\n\"\n\t       \"14:     movl 56(%4), %%eax\\n\"\n\t       \"91:     movl 60(%4), %%edx\\n\"\n\t       \"        movnti %%eax, 56(%3)\\n\"\n\t       \"        movnti %%edx, 60(%3)\\n\"\n\t       \"        addl $-64, %0\\n\"\n\t       \"        addl $64, %4\\n\"\n\t       \"        addl $64, %3\\n\"\n\t       \"        cmpl $63, %0\\n\"\n\t       \"        ja  0b\\n\"\n\t       \"        sfence \\n\"\n\t       \"5:      movl  %0, %%eax\\n\"\n\t       \"        shrl  $2, %0\\n\"\n\t       \"        andl $3, %%eax\\n\"\n\t       \"        cld\\n\"\n\t       \"6:      rep; movsl\\n\"\n\t       \"        movl %%eax,%0\\n\"\n\t       \"7:      rep; movsb\\n\"\n\t       \"8:\\n\"\n\t       _ASM_EXTABLE_UA(0b, 8b)\n\t       _ASM_EXTABLE_UA(1b, 8b)\n\t       _ASM_EXTABLE_UA(2b, 8b)\n\t       _ASM_EXTABLE_UA(21b, 8b)\n\t       _ASM_EXTABLE_UA(3b, 8b)\n\t       _ASM_EXTABLE_UA(31b, 8b)\n\t       _ASM_EXTABLE_UA(4b, 8b)\n\t       _ASM_EXTABLE_UA(41b, 8b)\n\t       _ASM_EXTABLE_UA(10b, 8b)\n\t       _ASM_EXTABLE_UA(51b, 8b)\n\t       _ASM_EXTABLE_UA(11b, 8b)\n\t       _ASM_EXTABLE_UA(61b, 8b)\n\t       _ASM_EXTABLE_UA(12b, 8b)\n\t       _ASM_EXTABLE_UA(71b, 8b)\n\t       _ASM_EXTABLE_UA(13b, 8b)\n\t       _ASM_EXTABLE_UA(81b, 8b)\n\t       _ASM_EXTABLE_UA(14b, 8b)\n\t       _ASM_EXTABLE_UA(91b, 8b)\n\t       _ASM_EXTABLE_TYPE_REG(6b, 8b, EX_TYPE_UCOPY_LEN4, %%eax)\n\t       _ASM_EXTABLE_UA(7b, 8b)\n\t       : \"=&c\"(size), \"=&D\" (d0), \"=&S\" (d1)\n\t       :  \"1\"(to), \"2\"(from), \"0\"(size)\n\t       : \"eax\", \"edx\", \"memory\");\n\treturn size;\n}\n\n#else\n\n \nunsigned long __copy_user_intel(void __user *to, const void *from,\n\t\t\t\t\tunsigned long size);\n#endif  \n\n \n#define __copy_user(to, from, size)\t\t\t\t\t\\\ndo {\t\t\t\t\t\t\t\t\t\\\n\tint __d0, __d1, __d2;\t\t\t\t\t\t\\\n\t__asm__ __volatile__(\t\t\t\t\t\t\\\n\t\t\"\tcmp  $7,%0\\n\"\t\t\t\t\t\\\n\t\t\"\tjbe  1f\\n\"\t\t\t\t\t\\\n\t\t\"\tmovl %1,%0\\n\"\t\t\t\t\t\\\n\t\t\"\tnegl %0\\n\"\t\t\t\t\t\\\n\t\t\"\tandl $7,%0\\n\"\t\t\t\t\t\\\n\t\t\"\tsubl %0,%3\\n\"\t\t\t\t\t\\\n\t\t\"4:\trep; movsb\\n\"\t\t\t\t\t\\\n\t\t\"\tmovl %3,%0\\n\"\t\t\t\t\t\\\n\t\t\"\tshrl $2,%0\\n\"\t\t\t\t\t\\\n\t\t\"\tandl $3,%3\\n\"\t\t\t\t\t\\\n\t\t\"\t.align 2,0x90\\n\"\t\t\t\t\\\n\t\t\"0:\trep; movsl\\n\"\t\t\t\t\t\\\n\t\t\"\tmovl %3,%0\\n\"\t\t\t\t\t\\\n\t\t\"1:\trep; movsb\\n\"\t\t\t\t\t\\\n\t\t\"2:\\n\"\t\t\t\t\t\t\t\\\n\t\t_ASM_EXTABLE_TYPE_REG(4b, 2b, EX_TYPE_UCOPY_LEN1, %3)\t\\\n\t\t_ASM_EXTABLE_TYPE_REG(0b, 2b, EX_TYPE_UCOPY_LEN4, %3)\t\\\n\t\t_ASM_EXTABLE_UA(1b, 2b)\t\t\t\t\t\\\n\t\t: \"=&c\"(size), \"=&D\" (__d0), \"=&S\" (__d1), \"=r\"(__d2)\t\\\n\t\t: \"3\"(size), \"0\"(size), \"1\"(to), \"2\"(from)\t\t\\\n\t\t: \"memory\");\t\t\t\t\t\t\\\n} while (0)\n\nunsigned long __copy_user_ll(void *to, const void *from, unsigned long n)\n{\n\t__uaccess_begin_nospec();\n\tif (movsl_is_ok(to, from, n))\n\t\t__copy_user(to, from, n);\n\telse\n\t\tn = __copy_user_intel(to, from, n);\n\t__uaccess_end();\n\treturn n;\n}\nEXPORT_SYMBOL(__copy_user_ll);\n\nunsigned long __copy_from_user_ll_nocache_nozero(void *to, const void __user *from,\n\t\t\t\t\tunsigned long n)\n{\n\t__uaccess_begin_nospec();\n#ifdef CONFIG_X86_INTEL_USERCOPY\n\tif (n > 64 && static_cpu_has(X86_FEATURE_XMM2))\n\t\tn = __copy_user_intel_nocache(to, from, n);\n\telse\n\t\t__copy_user(to, from, n);\n#else\n\t__copy_user(to, from, n);\n#endif\n\t__uaccess_end();\n\treturn n;\n}\nEXPORT_SYMBOL(__copy_from_user_ll_nocache_nozero);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}