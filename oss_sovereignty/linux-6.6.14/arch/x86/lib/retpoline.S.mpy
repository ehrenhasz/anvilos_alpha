{
  "module_name": "retpoline.S",
  "hash_id": "637e82dfa74eec953eab233c77e15fa577be393ead3eb78f77d34d333cfba8a9",
  "original_prompt": "Ingested from linux-6.6.14/arch/x86/lib/retpoline.S",
  "human_readable_source": " \n\n#include <linux/stringify.h>\n#include <linux/linkage.h>\n#include <asm/dwarf2.h>\n#include <asm/cpufeatures.h>\n#include <asm/alternative.h>\n#include <asm/asm-offsets.h>\n#include <asm/export.h>\n#include <asm/nospec-branch.h>\n#include <asm/unwind_hints.h>\n#include <asm/percpu.h>\n#include <asm/frame.h>\n#include <asm/nops.h>\n\n\t.section .text..__x86.indirect_thunk\n\n\n.macro POLINE reg\n\tANNOTATE_INTRA_FUNCTION_CALL\n\tcall    .Ldo_rop_\\@\n\tint3\n.Ldo_rop_\\@:\n\tmov     %\\reg, (%_ASM_SP)\n\tUNWIND_HINT_FUNC\n.endm\n\n.macro RETPOLINE reg\n\tPOLINE \\reg\n\tRET\n.endm\n\n.macro THUNK reg\n\n\t.align RETPOLINE_THUNK_SIZE\nSYM_INNER_LABEL(__x86_indirect_thunk_\\reg, SYM_L_GLOBAL)\n\tUNWIND_HINT_UNDEFINED\n\tANNOTATE_NOENDBR\n\n\tALTERNATIVE_2 __stringify(RETPOLINE \\reg), \\\n\t\t      __stringify(lfence; ANNOTATE_RETPOLINE_SAFE; jmp *%\\reg; int3), X86_FEATURE_RETPOLINE_LFENCE, \\\n\t\t      __stringify(ANNOTATE_RETPOLINE_SAFE; jmp *%\\reg), ALT_NOT(X86_FEATURE_RETPOLINE)\n\n.endm\n\n \n\n#define __EXPORT_THUNK(sym)\t_ASM_NOKPROBE(sym); EXPORT_SYMBOL(sym)\n\n\t.align RETPOLINE_THUNK_SIZE\nSYM_CODE_START(__x86_indirect_thunk_array)\n\n#define GEN(reg) THUNK reg\n#include <asm/GEN-for-each-reg.h>\n#undef GEN\n\n\t.align RETPOLINE_THUNK_SIZE\nSYM_CODE_END(__x86_indirect_thunk_array)\n\n#define GEN(reg) __EXPORT_THUNK(__x86_indirect_thunk_ ## reg)\n#include <asm/GEN-for-each-reg.h>\n#undef GEN\n\n#ifdef CONFIG_CALL_DEPTH_TRACKING\n.macro CALL_THUNK reg\n\t.align RETPOLINE_THUNK_SIZE\n\nSYM_INNER_LABEL(__x86_indirect_call_thunk_\\reg, SYM_L_GLOBAL)\n\tUNWIND_HINT_UNDEFINED\n\tANNOTATE_NOENDBR\n\n\tCALL_DEPTH_ACCOUNT\n\tPOLINE \\reg\n\tANNOTATE_UNRET_SAFE\n\tret\n\tint3\n.endm\n\n\t.align RETPOLINE_THUNK_SIZE\nSYM_CODE_START(__x86_indirect_call_thunk_array)\n\n#define GEN(reg) CALL_THUNK reg\n#include <asm/GEN-for-each-reg.h>\n#undef GEN\n\n\t.align RETPOLINE_THUNK_SIZE\nSYM_CODE_END(__x86_indirect_call_thunk_array)\n\n#define GEN(reg) __EXPORT_THUNK(__x86_indirect_call_thunk_ ## reg)\n#include <asm/GEN-for-each-reg.h>\n#undef GEN\n\n.macro JUMP_THUNK reg\n\t.align RETPOLINE_THUNK_SIZE\n\nSYM_INNER_LABEL(__x86_indirect_jump_thunk_\\reg, SYM_L_GLOBAL)\n\tUNWIND_HINT_UNDEFINED\n\tANNOTATE_NOENDBR\n\tPOLINE \\reg\n\tANNOTATE_UNRET_SAFE\n\tret\n\tint3\n.endm\n\n\t.align RETPOLINE_THUNK_SIZE\nSYM_CODE_START(__x86_indirect_jump_thunk_array)\n\n#define GEN(reg) JUMP_THUNK reg\n#include <asm/GEN-for-each-reg.h>\n#undef GEN\n\n\t.align RETPOLINE_THUNK_SIZE\nSYM_CODE_END(__x86_indirect_jump_thunk_array)\n\n#define GEN(reg) __EXPORT_THUNK(__x86_indirect_jump_thunk_ ## reg)\n#include <asm/GEN-for-each-reg.h>\n#undef GEN\n#endif\n \n#ifdef CONFIG_RETHUNK\n\n \n#ifdef CONFIG_CPU_SRSO\n\t.section .text..__x86.rethunk_untrain\n\nSYM_START(srso_alias_untrain_ret, SYM_L_GLOBAL, SYM_A_NONE)\n\tUNWIND_HINT_FUNC\n\tANNOTATE_NOENDBR\n\tASM_NOP2\n\tlfence\n\tjmp srso_alias_return_thunk\nSYM_FUNC_END(srso_alias_untrain_ret)\n__EXPORT_THUNK(srso_alias_untrain_ret)\n\n\t.section .text..__x86.rethunk_safe\n#else\n \nSYM_START(srso_alias_untrain_ret, SYM_L_GLOBAL, SYM_A_NONE)\n\tANNOTATE_UNRET_SAFE\n\tret\n\tint3\nSYM_FUNC_END(srso_alias_untrain_ret)\n#endif\n\nSYM_START(srso_alias_safe_ret, SYM_L_GLOBAL, SYM_A_NONE)\n\tlea 8(%_ASM_SP), %_ASM_SP\n\tUNWIND_HINT_FUNC\n\tANNOTATE_UNRET_SAFE\n\tret\n\tint3\nSYM_FUNC_END(srso_alias_safe_ret)\n\n\t.section .text..__x86.return_thunk\n\nSYM_CODE_START(srso_alias_return_thunk)\n\tUNWIND_HINT_FUNC\n\tANNOTATE_NOENDBR\n\tcall srso_alias_safe_ret\n\tud2\nSYM_CODE_END(srso_alias_return_thunk)\n\n \n\n \n\t.align 64\n\t.skip 64 - (retbleed_return_thunk - retbleed_untrain_ret), 0xcc\nSYM_START(retbleed_untrain_ret, SYM_L_GLOBAL, SYM_A_NONE)\n\tANNOTATE_NOENDBR\n\t \n\t.byte\t0xf6\n\n\t \nSYM_INNER_LABEL(retbleed_return_thunk, SYM_L_GLOBAL)\n\tret\n\tint3\nSYM_CODE_END(retbleed_return_thunk)\n\n\t \n\tlfence\n\n\t \n\tjmp retbleed_return_thunk\n\tint3\nSYM_FUNC_END(retbleed_untrain_ret)\n__EXPORT_THUNK(retbleed_untrain_ret)\n\n \n\t.align 64\n\t.skip 64 - (srso_safe_ret - srso_untrain_ret), 0xcc\nSYM_START(srso_untrain_ret, SYM_L_GLOBAL, SYM_A_NONE)\n\tANNOTATE_NOENDBR\n\t.byte 0x48, 0xb8\n\n \nSYM_INNER_LABEL(srso_safe_ret, SYM_L_GLOBAL)\n\tlea 8(%_ASM_SP), %_ASM_SP\n\tret\n\tint3\n\tint3\n\t \n\tlfence\n\tcall srso_safe_ret\n\tud2\nSYM_CODE_END(srso_safe_ret)\nSYM_FUNC_END(srso_untrain_ret)\n__EXPORT_THUNK(srso_untrain_ret)\n\nSYM_CODE_START(srso_return_thunk)\n\tUNWIND_HINT_FUNC\n\tANNOTATE_NOENDBR\n\tcall srso_safe_ret\n\tud2\nSYM_CODE_END(srso_return_thunk)\n\nSYM_FUNC_START(entry_untrain_ret)\n\tALTERNATIVE_2 \"jmp retbleed_untrain_ret\", \\\n\t\t      \"jmp srso_untrain_ret\", X86_FEATURE_SRSO, \\\n\t\t      \"jmp srso_alias_untrain_ret\", X86_FEATURE_SRSO_ALIAS\nSYM_FUNC_END(entry_untrain_ret)\n__EXPORT_THUNK(entry_untrain_ret)\n\nSYM_CODE_START(__x86_return_thunk)\n\tUNWIND_HINT_FUNC\n\tANNOTATE_NOENDBR\n\tANNOTATE_UNRET_SAFE\n\tret\n\tint3\nSYM_CODE_END(__x86_return_thunk)\nEXPORT_SYMBOL(__x86_return_thunk)\n\n#endif  \n\n#ifdef CONFIG_CALL_DEPTH_TRACKING\n\n\t.align 64\nSYM_FUNC_START(__x86_return_skl)\n\tANNOTATE_NOENDBR\n\t \n\tCALL_THUNKS_DEBUG_INC_RETS\n\tshlq\t$5, PER_CPU_VAR(pcpu_hot + X86_call_depth)\n\tjz\t1f\n\tANNOTATE_UNRET_SAFE\n\tret\n\tint3\n1:\n\tCALL_THUNKS_DEBUG_INC_STUFFS\n\t.rept\t16\n\tANNOTATE_INTRA_FUNCTION_CALL\n\tcall\t2f\n\tint3\n2:\n\t.endr\n\tadd\t$(8*16), %rsp\n\n\tCREDIT_CALL_DEPTH\n\n\tANNOTATE_UNRET_SAFE\n\tret\n\tint3\nSYM_FUNC_END(__x86_return_skl)\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}