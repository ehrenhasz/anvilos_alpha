{
  "module_name": "olpc.c",
  "hash_id": "6cd2acca866da2c626752aa021a6b6083bd01885d20244635153020dc1520c2c",
  "original_prompt": "Ingested from linux-6.6.14/arch/x86/pci/olpc.c",
  "human_readable_source": "\n \n\n#include <linux/pci.h>\n#include <linux/init.h>\n#include <asm/olpc.h>\n#include <asm/geode.h>\n#include <asm/pci_x86.h>\n\n \n\nstatic const uint32_t lxnb_hdr[] = {   \n\t0x0,\t0x0,\t0x0,\t0x0,\n\t0x0,\t0x0,\t0x0,\t0x0,\n\n\t0x281022, 0x2200005, 0x6000021, 0x80f808,\t \n\t0x0,\t0x0,\t0x0,\t0x0,    \n\t0x0,\t0x0,\t0x0,\t0x28100b,\n\t0x0,\t0x0,\t0x0,\t0x0,\n\t0x0,\t0x0,\t0x0,\t0x0,\n\t0x0,\t0x0,\t0x0,\t0x0,\n\t0x0,\t0x0,\t0x0,\t0x0,\n};\n\nstatic const uint32_t gxnb_hdr[] = {   \n\t0xfffffffd, 0x0, 0x0,\t0x0,\n\t0x0,\t0x0,\t0x0,\t0x0,\n\n\t0x28100b, 0x2200005, 0x6000021, 0x80f808,\t \n\t0xac1d,\t0x0,\t0x0,\t0x0,   \n\t0x0,\t0x0,\t0x0,\t0x28100b,\n\t0x0,\t0x0,\t0x0,\t0x0,\n\t0x0,\t0x0,\t0x0,\t0x0,\n\t0x0,\t0x0,\t0x0,\t0x0,\n\t0x0,\t0x0,\t0x0,\t0x0,\n};\n\nstatic const uint32_t lxfb_hdr[] = {   \n\t0xff000008, 0xffffc000, 0xffffc000, 0xffffc000,\n\t0xffffc000,\t0x0,\t0x0,\t0x0,\n\n\t0x20811022, 0x2200003, 0x3000000, 0x0,\t\t \n\t0xfd000000, 0xfe000000, 0xfe004000, 0xfe008000,  \n\t0xfe00c000, 0x0, 0x0,\t0x30100b,\t\t \n\t0x0,\t0x0,\t0x0,\t0x10e,\t    \n\t0x0,\t0x0,\t0x0,\t0x0,\n\t0x3d0,\t0x3c0,\t0xa0000, 0x0,\t     \n\t0x0,\t0x0,\t0x0,\t0x0,\n};\n\nstatic const uint32_t gxfb_hdr[] = {   \n\t0xff800008, 0xffffc000, 0xffffc000, 0xffffc000,\n\t0x0,\t0x0,\t0x0,\t0x0,\n\n\t0x30100b, 0x2200003, 0x3000000, 0x0,\t\t \n\t0xfd000000, 0xfe000000, 0xfe004000, 0xfe008000,\t \n\t0x0,\t0x0,\t0x0,\t0x30100b,\n\t0x0,\t0x0,\t0x0,\t0x0,\n\t0x0,\t0x0,\t0x0,\t0x0,\n\t0x3d0,\t0x3c0,\t0xa0000, 0x0,  \t     \n\t0x0,\t0x0,\t0x0,\t0x0,\n};\n\nstatic const uint32_t aes_hdr[] = {\t \n\t0xffffc000, 0x0, 0x0,\t0x0,\n\t0x0,\t0x0,\t0x0,\t0x0,\n\n\t0x20821022, 0x2a00006, 0x10100000, 0x8,\t\t \n\t0xfe010000, 0x0, 0x0,\t0x0,\t\t\t \n\t0x0,\t0x0,\t0x0,\t0x20821022,\n\t0x0,\t0x0,\t0x0,\t0x0,\n\t0x0,\t0x0,\t0x0,\t0x0,\n\t0x0,\t0x0,\t0x0,\t0x0,\n\t0x0,\t0x0,\t0x0,\t0x0,\n};\n\n\nstatic const uint32_t isa_hdr[] = {   \n\t0xfffffff9, 0xffffff01, 0xffffffc1, 0xffffffe1,\n\t0xffffff81, 0xffffffc1, 0x0, 0x0,\n\n\t0x20901022, 0x2a00049, 0x6010003, 0x802000,\n\t0x18b1,\t0x1001,\t0x1801,\t0x1881,\t \n\t0x1401,\t0x1841,\t0x0,\t0x20901022,\t\t \n\t0x0,\t0x0,\t0x0,\t0x0,\n\t0x0,\t0x0,\t0x0,\t0x0,\n\t0x0,\t0x0,\t0x0,\t0xaa5b,\t\t\t \n\t0x0,\t0x0,\t0x0,\t0x0,\n};\n\nstatic const uint32_t ac97_hdr[] = {   \n\t0xffffff81, 0x0, 0x0,\t0x0,\n\t0x0,\t0x0,\t0x0,\t0x0,\n\n\t0x20931022, 0x2a00041, 0x4010001, 0x0,\n\t0x1481,\t0x0,\t0x0,\t0x0,\t\t\t \n\t0x0,\t0x0,\t0x0,\t0x20931022,\n\t0x0,\t0x0,\t0x0,\t0x205,\t\t\t \n\t0x0,\t0x0,\t0x0,\t0x0,\n\t0x0,\t0x0,\t0x0,\t0x0,\n\t0x0,\t0x0,\t0x0,\t0x0,\n};\n\nstatic const uint32_t ohci_hdr[] = {   \n\t0xfffff000, 0x0, 0x0,\t0x0,\n\t0x0,\t0x0,\t0x0,\t0x0,\n\n\t0x20941022, 0x2300006, 0xc031002, 0x0,\n\t0xfe01a000, 0x0, 0x0,\t0x0,\t\t\t \n\t0x0,\t0x0,\t0x0,\t0x20941022,\n\t0x0,\t0x40,\t0x0,\t0x40a,\t\t\t \n\t0xc8020001, 0x0, 0x0,\t0x0,\t \n\t0x0,\t0x0,\t0x0,\t0x0,\n\t0x0,\t0x0,\t0x0,\t0x0,\n};\n\nstatic const uint32_t ehci_hdr[] = {   \n\t0xfffff000, 0x0, 0x0,\t0x0,\n\t0x0,\t0x0,\t0x0,\t0x0,\n\n\t0x20951022, 0x2300006, 0xc032002, 0x0,\n\t0xfe01b000, 0x0, 0x0,\t0x0,\t\t\t \n\t0x0,\t0x0,\t0x0,\t0x20951022,\n\t0x0,\t0x40,\t0x0,\t0x40a,\t\t\t \n\t0xc8020001, 0x0, 0x0,\t0x0,\t \n#if 0\n\t0x1,\t0x40080000, 0x0, 0x0,\t \n#endif\n\t0x01000001, 0x0, 0x0,\t0x0,\t \n\t0x2020,\t0x0,\t0x0,\t0x0,\t \n};\n\nstatic uint32_t ff_loc = ~0;\nstatic uint32_t zero_loc;\nstatic int bar_probing;\t\t \nstatic int is_lx;\n\n#define NB_SLOT 0x1\t \n#define SB_SLOT 0xf\t \n\nstatic int is_simulated(unsigned int bus, unsigned int devfn)\n{\n\treturn (!bus && ((PCI_SLOT(devfn) == NB_SLOT) ||\n\t\t\t(PCI_SLOT(devfn) == SB_SLOT)));\n}\n\nstatic uint32_t *hdr_addr(const uint32_t *hdr, int reg)\n{\n\tuint32_t addr;\n\n\t \n\n\taddr = (uint32_t)hdr + reg + (bar_probing ? -0x10 : 0x20);\n\n\tbar_probing = 0;\n\treturn (uint32_t *)addr;\n}\n\nstatic int pci_olpc_read(unsigned int seg, unsigned int bus,\n\t\tunsigned int devfn, int reg, int len, uint32_t *value)\n{\n\tuint32_t *addr;\n\n\tWARN_ON(seg);\n\n\t \n\tif (!is_simulated(bus, devfn))\n\t\treturn pci_direct_conf1.read(seg, bus, devfn, reg, len, value);\n\n\t \n\tif (reg >= 0x70)\n\t\taddr = &zero_loc;\n\telse {\n\t\tswitch (devfn) {\n\t\tcase  0x8:\n\t\t\taddr = hdr_addr(is_lx ? lxnb_hdr : gxnb_hdr, reg);\n\t\t\tbreak;\n\t\tcase  0x9:\n\t\t\taddr = hdr_addr(is_lx ? lxfb_hdr : gxfb_hdr, reg);\n\t\t\tbreak;\n\t\tcase  0xa:\n\t\t\taddr = is_lx ? hdr_addr(aes_hdr, reg) : &ff_loc;\n\t\t\tbreak;\n\t\tcase 0x78:\n\t\t\taddr = hdr_addr(isa_hdr, reg);\n\t\t\tbreak;\n\t\tcase 0x7b:\n\t\t\taddr = hdr_addr(ac97_hdr, reg);\n\t\t\tbreak;\n\t\tcase 0x7c:\n\t\t\taddr = hdr_addr(ohci_hdr, reg);\n\t\t\tbreak;\n\t\tcase 0x7d:\n\t\t\taddr = hdr_addr(ehci_hdr, reg);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\taddr = &ff_loc;\n\t\t\tbreak;\n\t\t}\n\t}\n\tswitch (len) {\n\tcase 1:\n\t\t*value = *(uint8_t *)addr;\n\t\tbreak;\n\tcase 2:\n\t\t*value = *(uint16_t *)addr;\n\t\tbreak;\n\tcase 4:\n\t\t*value = *addr;\n\t\tbreak;\n\tdefault:\n\t\tBUG();\n\t}\n\n\treturn 0;\n}\n\nstatic int pci_olpc_write(unsigned int seg, unsigned int bus,\n\t\tunsigned int devfn, int reg, int len, uint32_t value)\n{\n\tWARN_ON(seg);\n\n\t \n\tif (!is_simulated(bus, devfn))\n\t\treturn pci_direct_conf1.write(seg, bus, devfn, reg, len, value);\n\n\t \n\n\t \n\n\tif ((reg >= 0x10) && (reg < 0x2c)) {\n\t\t \n\t\tif (value == ~0)\n\t\t\tbar_probing = 1;\n\t} else {\n\t\t \n\t\tif ((reg != PCI_ROM_ADDRESS) && (reg != PCI_COMMAND_MASTER) &&\n\t\t\t\t(reg != PCI_LATENCY_TIMER) &&\n\t\t\t\t(reg != PCI_CACHE_LINE_SIZE) && (reg != 0x44))\n\t\t\tprintk(KERN_WARNING \"OLPC PCI: Config write to devfn\"\n\t\t\t\t\" %x reg %x value %x\\n\", devfn, reg, value);\n\t}\n\n\treturn 0;\n}\n\nstatic const struct pci_raw_ops pci_olpc_conf = {\n\t.read =\tpci_olpc_read,\n\t.write = pci_olpc_write,\n};\n\nint __init pci_olpc_init(void)\n{\n\tprintk(KERN_INFO \"PCI: Using configuration type OLPC XO-1\\n\");\n\traw_pci_ops = &pci_olpc_conf;\n\tis_lx = is_geode_lx();\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}