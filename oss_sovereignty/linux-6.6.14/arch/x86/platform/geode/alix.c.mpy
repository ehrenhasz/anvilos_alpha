{
  "module_name": "alix.c",
  "hash_id": "ebd7fbe1bbd239d7b6a3184599269c4e2f889b3684365bbc546f309d951908b4",
  "original_prompt": "Ingested from linux-6.6.14/arch/x86/platform/geode/alix.c",
  "human_readable_source": "\n \n\n#include <linux/kernel.h>\n#include <linux/init.h>\n#include <linux/io.h>\n#include <linux/string.h>\n#include <linux/moduleparam.h>\n#include <linux/leds.h>\n#include <linux/platform_device.h>\n#include <linux/input.h>\n#include <linux/gpio_keys.h>\n#include <linux/gpio/machine.h>\n#include <linux/dmi.h>\n\n#include <asm/geode.h>\n\n#define BIOS_SIGNATURE_TINYBIOS\t\t0xf0000\n#define BIOS_SIGNATURE_COREBOOT\t\t0x500\n#define BIOS_REGION_SIZE\t\t0x10000\n\n \nstatic bool force = 0;\nmodule_param(force, bool, 0444);\n \nMODULE_PARM_DESC(force, \"Force detection as ALIX.2/ALIX.3 platform\");\n\nstatic struct gpio_keys_button alix_gpio_buttons[] = {\n\t{\n\t\t.code\t\t\t= KEY_RESTART,\n\t\t.gpio\t\t\t= 24,\n\t\t.active_low\t\t= 1,\n\t\t.desc\t\t\t= \"Reset button\",\n\t\t.type\t\t\t= EV_KEY,\n\t\t.wakeup\t\t\t= 0,\n\t\t.debounce_interval\t= 100,\n\t\t.can_disable\t\t= 0,\n\t}\n};\nstatic struct gpio_keys_platform_data alix_buttons_data = {\n\t.buttons\t\t\t= alix_gpio_buttons,\n\t.nbuttons\t\t\t= ARRAY_SIZE(alix_gpio_buttons),\n\t.poll_interval\t\t\t= 20,\n};\n\nstatic struct platform_device alix_buttons_dev = {\n\t.name\t\t\t\t= \"gpio-keys-polled\",\n\t.id\t\t\t\t= 1,\n\t.dev = {\n\t\t.platform_data\t\t= &alix_buttons_data,\n\t}\n};\n\nstatic struct gpio_led alix_leds[] = {\n\t{\n\t\t.name = \"alix:1\",\n\t\t.default_trigger = \"default-on\",\n\t},\n\t{\n\t\t.name = \"alix:2\",\n\t\t.default_trigger = \"default-off\",\n\t},\n\t{\n\t\t.name = \"alix:3\",\n\t\t.default_trigger = \"default-off\",\n\t},\n};\n\nstatic struct gpio_led_platform_data alix_leds_data = {\n\t.num_leds = ARRAY_SIZE(alix_leds),\n\t.leds = alix_leds,\n};\n\nstatic struct gpiod_lookup_table alix_leds_gpio_table = {\n\t.dev_id = \"leds-gpio\",\n\t.table = {\n\t\t \n\t\tGPIO_LOOKUP_IDX(\"cs5535-gpio\", 6, NULL, 0, GPIO_ACTIVE_LOW),\n\t\tGPIO_LOOKUP_IDX(\"cs5535-gpio\", 25, NULL, 1, GPIO_ACTIVE_LOW),\n\t\tGPIO_LOOKUP_IDX(\"cs5535-gpio\", 27, NULL, 2, GPIO_ACTIVE_LOW),\n\t\t{ }\n\t},\n};\n\nstatic struct platform_device alix_leds_dev = {\n\t.name = \"leds-gpio\",\n\t.id = -1,\n\t.dev.platform_data = &alix_leds_data,\n};\n\nstatic struct platform_device *alix_devs[] __initdata = {\n\t&alix_buttons_dev,\n\t&alix_leds_dev,\n};\n\nstatic void __init register_alix(void)\n{\n\t \n\tgpiod_add_lookup_table(&alix_leds_gpio_table);\n\tplatform_add_devices(alix_devs, ARRAY_SIZE(alix_devs));\n}\n\nstatic bool __init alix_present(unsigned long bios_phys,\n\t\t\t\tconst char *alix_sig,\n\t\t\t\tsize_t alix_sig_len)\n{\n\tconst size_t bios_len = BIOS_REGION_SIZE;\n\tconst char *bios_virt;\n\tconst char *scan_end;\n\tconst char *p;\n\tchar name[64];\n\n\tif (force) {\n\t\tprintk(KERN_NOTICE \"%s: forced to skip BIOS test, \"\n\t\t       \"assume system is ALIX.2/ALIX.3\\n\",\n\t\t       KBUILD_MODNAME);\n\t\treturn true;\n\t}\n\n\tbios_virt = phys_to_virt(bios_phys);\n\tscan_end = bios_virt + bios_len - (alix_sig_len + 2);\n\tfor (p = bios_virt; p < scan_end; p++) {\n\t\tconst char *tail;\n\t\tchar *a;\n\n\t\tif (memcmp(p, alix_sig, alix_sig_len) != 0)\n\t\t\tcontinue;\n\n\t\tmemcpy(name, p, sizeof(name));\n\n\t\t \n\t\ta = strchr(name, '\\0');\n\t\tif (a)\n\t\t\t*a = ' ';\n\n\t\t \n\t\ta = strchr(name, '\\r');\n\t\tif (a)\n\t\t\t*a = '\\0';\n\n\t\ttail = p + alix_sig_len;\n\t\tif ((tail[0] == '2' || tail[0] == '3' || tail[0] == '6')) {\n\t\t\tprintk(KERN_INFO\n\t\t\t       \"%s: system is recognized as \\\"%s\\\"\\n\",\n\t\t\t       KBUILD_MODNAME, name);\n\t\t\treturn true;\n\t\t}\n\t}\n\n\treturn false;\n}\n\nstatic bool __init alix_present_dmi(void)\n{\n\tconst char *vendor, *product;\n\n\tvendor = dmi_get_system_info(DMI_SYS_VENDOR);\n\tif (!vendor || strcmp(vendor, \"PC Engines\"))\n\t\treturn false;\n\n\tproduct = dmi_get_system_info(DMI_PRODUCT_NAME);\n\tif (!product || (strcmp(product, \"ALIX.2D\") && strcmp(product, \"ALIX.6\")))\n\t\treturn false;\n\n\tprintk(KERN_INFO \"%s: system is recognized as \\\"%s %s\\\"\\n\",\n\t       KBUILD_MODNAME, vendor, product);\n\n\treturn true;\n}\n\nstatic int __init alix_init(void)\n{\n\tconst char tinybios_sig[] = \"PC Engines ALIX.\";\n\tconst char coreboot_sig[] = \"PC Engines\\0ALIX.\";\n\n\tif (!is_geode())\n\t\treturn 0;\n\n\tif (alix_present(BIOS_SIGNATURE_TINYBIOS, tinybios_sig, sizeof(tinybios_sig) - 1) ||\n\t    alix_present(BIOS_SIGNATURE_COREBOOT, coreboot_sig, sizeof(coreboot_sig) - 1) ||\n\t    alix_present_dmi())\n\t\tregister_alix();\n\n\treturn 0;\n}\ndevice_initcall(alix_init);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}