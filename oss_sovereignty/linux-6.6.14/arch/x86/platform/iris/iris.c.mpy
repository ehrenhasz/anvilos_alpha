{
  "module_name": "iris.c",
  "hash_id": "17be8cf7a7a7b5614e11cd1b4f93459ce2a55eb56b77ab89b87f522cce2d09d5",
  "original_prompt": "Ingested from linux-6.6.14/arch/x86/platform/iris/iris.c",
  "human_readable_source": "\n \n\n#include <linux/moduleparam.h>\n#include <linux/module.h>\n#include <linux/platform_device.h>\n#include <linux/kernel.h>\n#include <linux/errno.h>\n#include <linux/delay.h>\n#include <linux/pm.h>\n#include <asm/io.h>\n\n#define IRIS_GIO_BASE\t\t0x340\n#define IRIS_GIO_INPUT\t\tIRIS_GIO_BASE\n#define IRIS_GIO_OUTPUT\t\t(IRIS_GIO_BASE + 1)\n#define IRIS_GIO_PULSE\t\t0x80  \n#define IRIS_GIO_REST\t\t0x00  \n#define IRIS_GIO_NODEV\t\t0xff  \n\nMODULE_LICENSE(\"GPL\");\nMODULE_AUTHOR(\"S\u00e9bastien Hinderer <Sebastien.Hinderer@ens-lyon.org>\");\nMODULE_DESCRIPTION(\"A power_off handler for Iris devices from EuroBraille\");\n\nstatic bool force;\n\nmodule_param(force, bool, 0);\nMODULE_PARM_DESC(force, \"Set to one to force poweroff handler installation.\");\n\nstatic void (*old_pm_power_off)(void);\n\nstatic void iris_power_off(void)\n{\n\toutb(IRIS_GIO_PULSE, IRIS_GIO_OUTPUT);\n\tmsleep(850);\n\toutb(IRIS_GIO_REST, IRIS_GIO_OUTPUT);\n}\n\n \nstatic int iris_probe(struct platform_device *pdev)\n{\n\tunsigned char status = inb(IRIS_GIO_INPUT);\n\tif (status == IRIS_GIO_NODEV) {\n\t\tprintk(KERN_ERR \"This machine does not seem to be an Iris. \"\n\t\t\t\"Power off handler not installed.\\n\");\n\t\treturn -ENODEV;\n\t}\n\told_pm_power_off = pm_power_off;\n\tpm_power_off = &iris_power_off;\n\tprintk(KERN_INFO \"Iris power_off handler installed.\\n\");\n\treturn 0;\n}\n\nstatic int iris_remove(struct platform_device *pdev)\n{\n\tpm_power_off = old_pm_power_off;\n\tprintk(KERN_INFO \"Iris power_off handler uninstalled.\\n\");\n\treturn 0;\n}\n\nstatic struct platform_driver iris_driver = {\n\t.driver\t\t= {\n\t\t.name   = \"iris\",\n\t},\n\t.probe          = iris_probe,\n\t.remove         = iris_remove,\n};\n\nstatic struct resource iris_resources[] = {\n\t{\n\t\t.start  = IRIS_GIO_BASE,\n\t\t.end    = IRIS_GIO_OUTPUT,\n\t\t.flags  = IORESOURCE_IO,\n\t\t.name   = \"address\"\n\t}\n};\n\nstatic struct platform_device *iris_device;\n\nstatic int iris_init(void)\n{\n\tint ret;\n\tif (force != 1) {\n\t\tprintk(KERN_ERR \"The force parameter has not been set to 1.\"\n\t\t\t\" The Iris poweroff handler will not be installed.\\n\");\n\t\treturn -ENODEV;\n\t}\n\tret = platform_driver_register(&iris_driver);\n\tif (ret < 0) {\n\t\tprintk(KERN_ERR \"Failed to register iris platform driver: %d\\n\",\n\t\t\tret);\n\t\treturn ret;\n\t}\n\tiris_device = platform_device_register_simple(\"iris\", (-1),\n\t\t\t\tiris_resources, ARRAY_SIZE(iris_resources));\n\tif (IS_ERR(iris_device)) {\n\t\tprintk(KERN_ERR \"Failed to register iris platform device\\n\");\n\t\tplatform_driver_unregister(&iris_driver);\n\t\treturn PTR_ERR(iris_device);\n\t}\n\treturn 0;\n}\n\nstatic void iris_exit(void)\n{\n\tplatform_device_unregister(iris_device);\n\tplatform_driver_unregister(&iris_driver);\n}\n\nmodule_init(iris_init);\nmodule_exit(iris_exit);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}