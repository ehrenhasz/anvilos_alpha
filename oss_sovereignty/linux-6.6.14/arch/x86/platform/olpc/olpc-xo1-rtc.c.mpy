{
  "module_name": "olpc-xo1-rtc.c",
  "hash_id": "22fbdc7b65a93d2076ce2e525b32b69a2477af67bd77d70ad6c571431b466f2c",
  "original_prompt": "Ingested from linux-6.6.14/arch/x86/platform/olpc/olpc-xo1-rtc.c",
  "human_readable_source": "\n \n\n#include <linux/mc146818rtc.h>\n#include <linux/platform_device.h>\n#include <linux/rtc.h>\n#include <linux/of.h>\n\n#include <asm/msr.h>\n#include <asm/olpc.h>\n#include <asm/x86_init.h>\n\nstatic void rtc_wake_on(struct device *dev)\n{\n\tolpc_xo1_pm_wakeup_set(CS5536_PM_RTC);\n}\n\nstatic void rtc_wake_off(struct device *dev)\n{\n\tolpc_xo1_pm_wakeup_clear(CS5536_PM_RTC);\n}\n\nstatic struct resource rtc_platform_resource[] = {\n\t[0] = {\n\t\t.start\t= RTC_PORT(0),\n\t\t.end\t= RTC_PORT(1),\n\t\t.flags\t= IORESOURCE_IO,\n\t},\n\t[1] = {\n\t\t.start\t= RTC_IRQ,\n\t\t.end\t= RTC_IRQ,\n\t\t.flags\t= IORESOURCE_IRQ,\n\t}\n};\n\nstatic struct cmos_rtc_board_info rtc_info = {\n\t.rtc_day_alarm = 0,\n\t.rtc_mon_alarm = 0,\n\t.rtc_century = 0,\n\t.wake_on = rtc_wake_on,\n\t.wake_off = rtc_wake_off,\n};\n\nstatic struct platform_device xo1_rtc_device = {\n\t.name = \"rtc_cmos\",\n\t.id = -1,\n\t.num_resources = ARRAY_SIZE(rtc_platform_resource),\n\t.dev.platform_data = &rtc_info,\n\t.resource = rtc_platform_resource,\n};\n\nstatic int __init xo1_rtc_init(void)\n{\n\tint r;\n\tstruct device_node *node;\n\n\tnode = of_find_compatible_node(NULL, NULL, \"olpc,xo1-rtc\");\n\tif (!node)\n\t\treturn 0;\n\tof_node_put(node);\n\n\tpr_info(\"olpc-xo1-rtc: Initializing OLPC XO-1 RTC\\n\");\n\trdmsrl(MSR_RTC_DOMA_OFFSET, rtc_info.rtc_day_alarm);\n\trdmsrl(MSR_RTC_MONA_OFFSET, rtc_info.rtc_mon_alarm);\n\trdmsrl(MSR_RTC_CEN_OFFSET, rtc_info.rtc_century);\n\n\tr = platform_device_register(&xo1_rtc_device);\n\tif (r)\n\t\treturn r;\n\n\tx86_platform.legacy.rtc = 0;\n\n\tdevice_init_wakeup(&xo1_rtc_device.dev, 1);\n\treturn 0;\n}\narch_initcall(xo1_rtc_init);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}