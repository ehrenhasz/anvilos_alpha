{
  "module_name": "punit_atom_debug.c",
  "hash_id": "17e69e8300e9a033537f21c95d91b6514ac1c00b7cb8972e298fcecfdbb7d58b",
  "original_prompt": "Ingested from linux-6.6.14/arch/x86/platform/atom/punit_atom_debug.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/init.h>\n#include <linux/device.h>\n#include <linux/debugfs.h>\n#include <linux/seq_file.h>\n#include <linux/io.h>\n#include <asm/cpu_device_id.h>\n#include <asm/intel-family.h>\n#include <asm/iosf_mbi.h>\n\n \n#define VED_SS_PM0\t\t0x32\n \n#define ISP_SS_PM0\t\t0x39\n \n#define MIO_SS_PM\t\t0x3B\n \n#define SSS_SHIFT\t\t24\n\n \n#define PWRGT_STATUS\t\t0x61\n \n#define RENDER_POS\t\t0\n \n#define MEDIA_POS\t\t2\n \n#define VLV_DISPLAY_POS\t\t6\n\n \n#define CHT_DSP_SSS\t\t0x36\n \n#define CHT_DSP_SSS_POS\t\t16\n\nstruct punit_device {\n\tchar *name;\n\tint reg;\n\tint sss_pos;\n};\n\nstatic const struct punit_device punit_device_tng[] = {\n\t{ \"DISPLAY\",\tCHT_DSP_SSS,\tSSS_SHIFT },\n\t{ \"VED\",\tVED_SS_PM0,\tSSS_SHIFT },\n\t{ \"ISP\",\tISP_SS_PM0,\tSSS_SHIFT },\n\t{ \"MIO\",\tMIO_SS_PM,\tSSS_SHIFT },\n\t{ NULL }\n};\n\nstatic const struct punit_device punit_device_byt[] = {\n\t{ \"GFX RENDER\",\tPWRGT_STATUS,\tRENDER_POS },\n\t{ \"GFX MEDIA\",\tPWRGT_STATUS,\tMEDIA_POS },\n\t{ \"DISPLAY\",\tPWRGT_STATUS,\tVLV_DISPLAY_POS },\n\t{ \"VED\",\tVED_SS_PM0,\tSSS_SHIFT },\n\t{ \"ISP\",\tISP_SS_PM0,\tSSS_SHIFT },\n\t{ \"MIO\",\tMIO_SS_PM,\tSSS_SHIFT },\n\t{ NULL }\n};\n\nstatic const struct punit_device punit_device_cht[] = {\n\t{ \"GFX RENDER\",\tPWRGT_STATUS,\tRENDER_POS },\n\t{ \"GFX MEDIA\",\tPWRGT_STATUS,\tMEDIA_POS },\n\t{ \"DISPLAY\",\tCHT_DSP_SSS,\tCHT_DSP_SSS_POS },\n\t{ \"VED\",\tVED_SS_PM0,\tSSS_SHIFT },\n\t{ \"ISP\",\tISP_SS_PM0,\tSSS_SHIFT },\n\t{ \"MIO\",\tMIO_SS_PM,\tSSS_SHIFT },\n\t{ NULL }\n};\n\nstatic const char * const dstates[] = {\"D0\", \"D0i1\", \"D0i2\", \"D0i3\"};\n\nstatic int punit_dev_state_show(struct seq_file *seq_file, void *unused)\n{\n\tu32 punit_pwr_status;\n\tstruct punit_device *punit_devp = seq_file->private;\n\tint index;\n\tint status;\n\n\tseq_puts(seq_file, \"\\n\\nPUNIT NORTH COMPLEX DEVICES :\\n\");\n\twhile (punit_devp->name) {\n\t\tstatus = iosf_mbi_read(BT_MBI_UNIT_PMC, MBI_REG_READ,\n\t\t\t\t       punit_devp->reg, &punit_pwr_status);\n\t\tif (status) {\n\t\t\tseq_printf(seq_file, \"%9s : Read Failed\\n\",\n\t\t\t\t   punit_devp->name);\n\t\t} else  {\n\t\t\tindex = (punit_pwr_status >> punit_devp->sss_pos) & 3;\n\t\t\tseq_printf(seq_file, \"%9s : %s\\n\", punit_devp->name,\n\t\t\t\t   dstates[index]);\n\t\t}\n\t\tpunit_devp++;\n\t}\n\n\treturn 0;\n}\nDEFINE_SHOW_ATTRIBUTE(punit_dev_state);\n\nstatic struct dentry *punit_dbg_file;\n\nstatic void punit_dbgfs_register(struct punit_device *punit_device)\n{\n\tpunit_dbg_file = debugfs_create_dir(\"punit_atom\", NULL);\n\n\tdebugfs_create_file(\"dev_power_state\", 0444, punit_dbg_file,\n\t\t\t    punit_device, &punit_dev_state_fops);\n}\n\nstatic void punit_dbgfs_unregister(void)\n{\n\tdebugfs_remove_recursive(punit_dbg_file);\n}\n\n#define X86_MATCH(model, data)\t\t\t\t\t\t \\\n\tX86_MATCH_VENDOR_FAM_MODEL_FEATURE(INTEL, 6, INTEL_FAM6_##model, \\\n\t\t\t\t\t   X86_FEATURE_MWAIT, data)\n\nstatic const struct x86_cpu_id intel_punit_cpu_ids[] = {\n\tX86_MATCH(ATOM_SILVERMONT,\t\t&punit_device_byt),\n\tX86_MATCH(ATOM_SILVERMONT_MID,\t\t&punit_device_tng),\n\tX86_MATCH(ATOM_AIRMONT,\t\t\t&punit_device_cht),\n\t{}\n};\nMODULE_DEVICE_TABLE(x86cpu, intel_punit_cpu_ids);\n\nstatic int __init punit_atom_debug_init(void)\n{\n\tconst struct x86_cpu_id *id;\n\n\tid = x86_match_cpu(intel_punit_cpu_ids);\n\tif (!id)\n\t\treturn -ENODEV;\n\n\tpunit_dbgfs_register((struct punit_device *)id->driver_data);\n\n\treturn 0;\n}\n\nstatic void __exit punit_atom_debug_exit(void)\n{\n\tpunit_dbgfs_unregister();\n}\n\nmodule_init(punit_atom_debug_init);\nmodule_exit(punit_atom_debug_exit);\n\nMODULE_AUTHOR(\"Kumar P, Mahesh <mahesh.kumar.p@intel.com>\");\nMODULE_AUTHOR(\"Srinivas Pandruvada <srinivas.pandruvada@linux.intel.com>\");\nMODULE_DESCRIPTION(\"Driver for Punit devices states debugging\");\nMODULE_LICENSE(\"GPL v2\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}