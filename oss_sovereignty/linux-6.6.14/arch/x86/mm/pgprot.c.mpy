{
  "module_name": "pgprot.c",
  "hash_id": "da239da58c30ff9091132f9594910481a966d10efcb46b2cb25d45b3aa83adca",
  "original_prompt": "Ingested from linux-6.6.14/arch/x86/mm/pgprot.c",
  "human_readable_source": "\n\n#include <linux/export.h>\n#include <linux/mm.h>\n#include <asm/pgtable.h>\n#include <asm/mem_encrypt.h>\n\nstatic pgprot_t protection_map[16] __ro_after_init = {\n\t[VM_NONE]\t\t\t\t\t= PAGE_NONE,\n\t[VM_READ]\t\t\t\t\t= PAGE_READONLY,\n\t[VM_WRITE]\t\t\t\t\t= PAGE_COPY,\n\t[VM_WRITE | VM_READ]\t\t\t\t= PAGE_COPY,\n\t[VM_EXEC]\t\t\t\t\t= PAGE_READONLY_EXEC,\n\t[VM_EXEC | VM_READ]\t\t\t\t= PAGE_READONLY_EXEC,\n\t[VM_EXEC | VM_WRITE]\t\t\t\t= PAGE_COPY_EXEC,\n\t[VM_EXEC | VM_WRITE | VM_READ]\t\t\t= PAGE_COPY_EXEC,\n\t[VM_SHARED]\t\t\t\t\t= PAGE_NONE,\n\t[VM_SHARED | VM_READ]\t\t\t\t= PAGE_READONLY,\n\t[VM_SHARED | VM_WRITE]\t\t\t\t= PAGE_SHARED,\n\t[VM_SHARED | VM_WRITE | VM_READ]\t\t= PAGE_SHARED,\n\t[VM_SHARED | VM_EXEC]\t\t\t\t= PAGE_READONLY_EXEC,\n\t[VM_SHARED | VM_EXEC | VM_READ]\t\t\t= PAGE_READONLY_EXEC,\n\t[VM_SHARED | VM_EXEC | VM_WRITE]\t\t= PAGE_SHARED_EXEC,\n\t[VM_SHARED | VM_EXEC | VM_WRITE | VM_READ]\t= PAGE_SHARED_EXEC\n};\n\nvoid add_encrypt_protection_map(void)\n{\n\tunsigned int i;\n\n\tfor (i = 0; i < ARRAY_SIZE(protection_map); i++)\n\t\tprotection_map[i] = pgprot_encrypted(protection_map[i]);\n}\n\npgprot_t vm_get_page_prot(unsigned long vm_flags)\n{\n\tunsigned long val = pgprot_val(protection_map[vm_flags &\n\t\t\t\t      (VM_READ|VM_WRITE|VM_EXEC|VM_SHARED)]);\n\n#ifdef CONFIG_X86_INTEL_MEMORY_PROTECTION_KEYS\n\t \n\tif (vm_flags & VM_PKEY_BIT0)\n\t\tval |= _PAGE_PKEY_BIT0;\n\tif (vm_flags & VM_PKEY_BIT1)\n\t\tval |= _PAGE_PKEY_BIT1;\n\tif (vm_flags & VM_PKEY_BIT2)\n\t\tval |= _PAGE_PKEY_BIT2;\n\tif (vm_flags & VM_PKEY_BIT3)\n\t\tval |= _PAGE_PKEY_BIT3;\n#endif\n\n\tval = __sme_set(val);\n\tif (val & _PAGE_PRESENT)\n\t\tval &= __supported_pte_mask;\n\treturn __pgprot(val);\n}\nEXPORT_SYMBOL(vm_get_page_prot);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}