{
  "module_name": "srat.c",
  "hash_id": "2c6d93159a4c16e7a2eb05f91965406434afc1e4456bbe3a50e28966f1d5838a",
  "original_prompt": "Ingested from linux-6.6.14/arch/x86/mm/srat.c",
  "human_readable_source": "\n \n\n#include <linux/kernel.h>\n#include <linux/acpi.h>\n#include <linux/mmzone.h>\n#include <linux/bitmap.h>\n#include <linux/init.h>\n#include <linux/topology.h>\n#include <linux/mm.h>\n#include <asm/proto.h>\n#include <asm/numa.h>\n#include <asm/e820/api.h>\n#include <asm/apic.h>\n#include <asm/uv/uv.h>\n\n \nvoid __init\nacpi_numa_x2apic_affinity_init(struct acpi_srat_x2apic_cpu_affinity *pa)\n{\n\tint pxm, node;\n\tint apic_id;\n\n\tif (srat_disabled())\n\t\treturn;\n\tif (pa->header.length < sizeof(struct acpi_srat_x2apic_cpu_affinity)) {\n\t\tbad_srat();\n\t\treturn;\n\t}\n\tif ((pa->flags & ACPI_SRAT_CPU_ENABLED) == 0)\n\t\treturn;\n\tpxm = pa->proximity_domain;\n\tapic_id = pa->apic_id;\n\tif (!apic_id_valid(apic_id)) {\n\t\tpr_info(\"SRAT: PXM %u -> X2APIC 0x%04x ignored\\n\", pxm, apic_id);\n\t\treturn;\n\t}\n\tnode = acpi_map_pxm_to_node(pxm);\n\tif (node < 0) {\n\t\tprintk(KERN_ERR \"SRAT: Too many proximity domains %x\\n\", pxm);\n\t\tbad_srat();\n\t\treturn;\n\t}\n\n\tif (apic_id >= MAX_LOCAL_APIC) {\n\t\tprintk(KERN_INFO \"SRAT: PXM %u -> APIC 0x%04x -> Node %u skipped apicid that is too big\\n\", pxm, apic_id, node);\n\t\treturn;\n\t}\n\tset_apicid_to_node(apic_id, node);\n\tnode_set(node, numa_nodes_parsed);\n\tprintk(KERN_INFO \"SRAT: PXM %u -> APIC 0x%04x -> Node %u\\n\",\n\t       pxm, apic_id, node);\n}\n\n \nvoid __init\nacpi_numa_processor_affinity_init(struct acpi_srat_cpu_affinity *pa)\n{\n\tint pxm, node;\n\tint apic_id;\n\n\tif (srat_disabled())\n\t\treturn;\n\tif (pa->header.length != sizeof(struct acpi_srat_cpu_affinity)) {\n\t\tbad_srat();\n\t\treturn;\n\t}\n\tif ((pa->flags & ACPI_SRAT_CPU_ENABLED) == 0)\n\t\treturn;\n\tpxm = pa->proximity_domain_lo;\n\tif (acpi_srat_revision >= 2)\n\t\tpxm |= *((unsigned int*)pa->proximity_domain_hi) << 8;\n\tnode = acpi_map_pxm_to_node(pxm);\n\tif (node < 0) {\n\t\tprintk(KERN_ERR \"SRAT: Too many proximity domains %x\\n\", pxm);\n\t\tbad_srat();\n\t\treturn;\n\t}\n\n\tif (get_uv_system_type() >= UV_X2APIC)\n\t\tapic_id = (pa->apic_id << 8) | pa->local_sapic_eid;\n\telse\n\t\tapic_id = pa->apic_id;\n\n\tif (apic_id >= MAX_LOCAL_APIC) {\n\t\tprintk(KERN_INFO \"SRAT: PXM %u -> APIC 0x%02x -> Node %u skipped apicid that is too big\\n\", pxm, apic_id, node);\n\t\treturn;\n\t}\n\n\tset_apicid_to_node(apic_id, node);\n\tnode_set(node, numa_nodes_parsed);\n\tprintk(KERN_INFO \"SRAT: PXM %u -> APIC 0x%02x -> Node %u\\n\",\n\t       pxm, apic_id, node);\n}\n\nint __init x86_acpi_numa_init(void)\n{\n\tint ret;\n\n\tret = acpi_numa_init();\n\tif (ret < 0)\n\t\treturn ret;\n\treturn srat_disabled() ? -EINVAL : 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}