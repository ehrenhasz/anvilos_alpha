{
  "module_name": "hypervisor.c",
  "hash_id": "cf48852f0b45f5e30595a1a1c0123faef842fee17edea9db2808d62dc44c8e65",
  "original_prompt": "Ingested from linux-6.6.14/arch/x86/kernel/cpu/hypervisor.c",
  "human_readable_source": " \n\n#include <linux/init.h>\n#include <linux/export.h>\n#include <asm/processor.h>\n#include <asm/hypervisor.h>\n\nstatic const __initconst struct hypervisor_x86 * const hypervisors[] =\n{\n#ifdef CONFIG_XEN_PV\n\t&x86_hyper_xen_pv,\n#endif\n#ifdef CONFIG_XEN_PVHVM\n\t&x86_hyper_xen_hvm,\n#endif\n\t&x86_hyper_vmware,\n\t&x86_hyper_ms_hyperv,\n#ifdef CONFIG_KVM_GUEST\n\t&x86_hyper_kvm,\n#endif\n#ifdef CONFIG_JAILHOUSE_GUEST\n\t&x86_hyper_jailhouse,\n#endif\n#ifdef CONFIG_ACRN_GUEST\n\t&x86_hyper_acrn,\n#endif\n};\n\nenum x86_hypervisor_type x86_hyper_type;\nEXPORT_SYMBOL(x86_hyper_type);\n\nbool __initdata nopv;\nstatic __init int parse_nopv(char *arg)\n{\n\tnopv = true;\n\treturn 0;\n}\nearly_param(\"nopv\", parse_nopv);\n\nstatic inline const struct hypervisor_x86 * __init\ndetect_hypervisor_vendor(void)\n{\n\tconst struct hypervisor_x86 *h = NULL, * const *p;\n\tuint32_t pri, max_pri = 0;\n\n\tfor (p = hypervisors; p < hypervisors + ARRAY_SIZE(hypervisors); p++) {\n\t\tif (unlikely(nopv) && !(*p)->ignore_nopv)\n\t\t\tcontinue;\n\n\t\tpri = (*p)->detect();\n\t\tif (pri > max_pri) {\n\t\t\tmax_pri = pri;\n\t\t\th = *p;\n\t\t}\n\t}\n\n\tif (h)\n\t\tpr_info(\"Hypervisor detected: %s\\n\", h->name);\n\n\treturn h;\n}\n\nstatic void __init copy_array(const void *src, void *target, unsigned int size)\n{\n\tunsigned int i, n = size / sizeof(void *);\n\tconst void * const *from = (const void * const *)src;\n\tconst void **to = (const void **)target;\n\n\tfor (i = 0; i < n; i++)\n\t\tif (from[i])\n\t\t\tto[i] = from[i];\n}\n\nvoid __init init_hypervisor_platform(void)\n{\n\tconst struct hypervisor_x86 *h;\n\n\th = detect_hypervisor_vendor();\n\n\tif (!h)\n\t\treturn;\n\n\tcopy_array(&h->init, &x86_init.hyper, sizeof(h->init));\n\tcopy_array(&h->runtime, &x86_platform.hyper, sizeof(h->runtime));\n\n\tx86_hyper_type = h->type;\n\tx86_init.hyper.init_platform();\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}