{
  "module_name": "mkcapflags.sh",
  "hash_id": "82a345183af1f03544a0ace1e1e87aac66c1855a3087a8d0cd4497d6a2326d1a",
  "original_prompt": "Ingested from linux-6.6.14/arch/x86/kernel/cpu/mkcapflags.sh",
  "human_readable_source": "#!/bin/sh\n# SPDX-License-Identifier: GPL-2.0\n#\n# Generate the x86_cap/bug_flags[] arrays from include/asm/cpufeatures.h\n#\n\nset -e\n\nOUT=$1\n\ndump_array()\n{\n\tARRAY=$1\n\tSIZE=$2\n\tPFX=$3\n\tPOSTFIX=$4\n\tIN=$5\n\n\tPFX_SZ=$(echo $PFX | wc -c)\n\tTABS=\"$(printf '\\t\\t\\t\\t\\t')\"\n\n\techo \"const char * const $ARRAY[$SIZE] = {\"\n\n\t# Iterate through any input lines starting with #define $PFX\n\tsed -n -e 's/\\t/ /g' -e \"s/^ *# *define *$PFX//p\" $IN |\n\twhile read i\n\tdo\n\t\t# Name is everything up to the first whitespace\n\t\tNAME=\"$(echo \"$i\" | sed 's/ .*//')\"\n\n\t\t# If the /* comment */ starts with a quote string, grab that.\n\t\tVALUE=\"$(echo \"$i\" | sed -n 's@.*/\\* *\\(\"[^\"]*\"\\).*\\*/@\\1@p')\"\n\t\t[ -z \"$VALUE\" ] && VALUE=\"\\\"$NAME\\\"\"\n\t\t[ \"$VALUE\" = '\"\"' ] && continue\n\n\t\t# Name is uppercase, VALUE is all lowercase\n\t\tVALUE=\"$(echo \"$VALUE\" | tr A-Z a-z)\"\n\n        if [ -n \"$POSTFIX\" ]; then\n            T=$(( $PFX_SZ + $(echo $POSTFIX | wc -c) + 2 ))\n\t        TABS=\"$(printf '\\t\\t\\t\\t\\t\\t')\"\n\t\t    TABCOUNT=$(( ( 6*8 - ($T + 1) - $(echo \"$NAME\" | wc -c) ) / 8 ))\n\t\t    printf \"\\t[%s - %s]%.*s = %s,\\n\" \"$PFX$NAME\" \"$POSTFIX\" \"$TABCOUNT\" \"$TABS\" \"$VALUE\"\n        else\n\t\t    TABCOUNT=$(( ( 5*8 - ($PFX_SZ + 1) - $(echo \"$NAME\" | wc -c) ) / 8 ))\n            printf \"\\t[%s]%.*s = %s,\\n\" \"$PFX$NAME\" \"$TABCOUNT\" \"$TABS\" \"$VALUE\"\n        fi\n\tdone\n\techo \"};\"\n}\n\ntrap 'rm \"$OUT\"' EXIT\n\n(\n\techo \"#ifndef _ASM_X86_CPUFEATURES_H\"\n\techo \"#include <asm/cpufeatures.h>\"\n\techo \"#endif\"\n\techo \"\"\n\n\tdump_array \"x86_cap_flags\" \"NCAPINTS*32\" \"X86_FEATURE_\" \"\" $2\n\techo \"\"\n\n\tdump_array \"x86_bug_flags\" \"NBUGINTS*32\" \"X86_BUG_\" \"NCAPINTS*32\" $2\n\techo \"\"\n\n\techo \"#ifdef CONFIG_X86_VMX_FEATURE_NAMES\"\n\techo \"#ifndef _ASM_X86_VMXFEATURES_H\"\n\techo \"#include <asm/vmxfeatures.h>\"\n\techo \"#endif\"\n\tdump_array \"x86_vmx_flags\" \"NVMXINTS*32\" \"VMX_FEATURE_\" \"\" $3\n\techo \"#endif /* CONFIG_X86_VMX_FEATURE_NAMES */\"\n) > $OUT\n\ntrap - EXIT\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}