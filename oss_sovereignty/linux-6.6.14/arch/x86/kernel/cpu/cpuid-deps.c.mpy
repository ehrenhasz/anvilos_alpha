{
  "module_name": "cpuid-deps.c",
  "hash_id": "447327a68fa6e630d9ffffb63fbcc38cf338568147a52954d7f226f4635246ec",
  "original_prompt": "Ingested from linux-6.6.14/arch/x86/kernel/cpu/cpuid-deps.c",
  "human_readable_source": " \n#include <linux/kernel.h>\n#include <linux/init.h>\n#include <linux/module.h>\n#include <asm/cpufeature.h>\n\nstruct cpuid_dep {\n\tunsigned int\tfeature;\n\tunsigned int\tdepends;\n};\n\n \nstatic const struct cpuid_dep cpuid_deps[] = {\n\t{ X86_FEATURE_FXSR,\t\t\tX86_FEATURE_FPU\t      },\n\t{ X86_FEATURE_XSAVEOPT,\t\t\tX86_FEATURE_XSAVE     },\n\t{ X86_FEATURE_XSAVEC,\t\t\tX86_FEATURE_XSAVE     },\n\t{ X86_FEATURE_XSAVES,\t\t\tX86_FEATURE_XSAVE     },\n\t{ X86_FEATURE_AVX,\t\t\tX86_FEATURE_XSAVE     },\n\t{ X86_FEATURE_PKU,\t\t\tX86_FEATURE_XSAVE     },\n\t{ X86_FEATURE_MPX,\t\t\tX86_FEATURE_XSAVE     },\n\t{ X86_FEATURE_XGETBV1,\t\t\tX86_FEATURE_XSAVE     },\n\t{ X86_FEATURE_CMOV,\t\t\tX86_FEATURE_FXSR      },\n\t{ X86_FEATURE_MMX,\t\t\tX86_FEATURE_FXSR      },\n\t{ X86_FEATURE_MMXEXT,\t\t\tX86_FEATURE_MMX       },\n\t{ X86_FEATURE_FXSR_OPT,\t\t\tX86_FEATURE_FXSR      },\n\t{ X86_FEATURE_XSAVE,\t\t\tX86_FEATURE_FXSR      },\n\t{ X86_FEATURE_XMM,\t\t\tX86_FEATURE_FXSR      },\n\t{ X86_FEATURE_XMM2,\t\t\tX86_FEATURE_XMM       },\n\t{ X86_FEATURE_XMM3,\t\t\tX86_FEATURE_XMM2      },\n\t{ X86_FEATURE_XMM4_1,\t\t\tX86_FEATURE_XMM2      },\n\t{ X86_FEATURE_XMM4_2,\t\t\tX86_FEATURE_XMM2      },\n\t{ X86_FEATURE_XMM3,\t\t\tX86_FEATURE_XMM2      },\n\t{ X86_FEATURE_PCLMULQDQ,\t\tX86_FEATURE_XMM2      },\n\t{ X86_FEATURE_SSSE3,\t\t\tX86_FEATURE_XMM2,     },\n\t{ X86_FEATURE_F16C,\t\t\tX86_FEATURE_XMM2,     },\n\t{ X86_FEATURE_AES,\t\t\tX86_FEATURE_XMM2      },\n\t{ X86_FEATURE_SHA_NI,\t\t\tX86_FEATURE_XMM2      },\n\t{ X86_FEATURE_FMA,\t\t\tX86_FEATURE_AVX       },\n\t{ X86_FEATURE_AVX2,\t\t\tX86_FEATURE_AVX,      },\n\t{ X86_FEATURE_AVX512F,\t\t\tX86_FEATURE_AVX,      },\n\t{ X86_FEATURE_AVX512IFMA,\t\tX86_FEATURE_AVX512F   },\n\t{ X86_FEATURE_AVX512PF,\t\t\tX86_FEATURE_AVX512F   },\n\t{ X86_FEATURE_AVX512ER,\t\t\tX86_FEATURE_AVX512F   },\n\t{ X86_FEATURE_AVX512CD,\t\t\tX86_FEATURE_AVX512F   },\n\t{ X86_FEATURE_AVX512DQ,\t\t\tX86_FEATURE_AVX512F   },\n\t{ X86_FEATURE_AVX512BW,\t\t\tX86_FEATURE_AVX512F   },\n\t{ X86_FEATURE_AVX512VL,\t\t\tX86_FEATURE_AVX512F   },\n\t{ X86_FEATURE_AVX512VBMI,\t\tX86_FEATURE_AVX512F   },\n\t{ X86_FEATURE_AVX512_VBMI2,\t\tX86_FEATURE_AVX512VL  },\n\t{ X86_FEATURE_GFNI,\t\t\tX86_FEATURE_AVX512VL  },\n\t{ X86_FEATURE_VAES,\t\t\tX86_FEATURE_AVX512VL  },\n\t{ X86_FEATURE_VPCLMULQDQ,\t\tX86_FEATURE_AVX512VL  },\n\t{ X86_FEATURE_AVX512_VNNI,\t\tX86_FEATURE_AVX512VL  },\n\t{ X86_FEATURE_AVX512_BITALG,\t\tX86_FEATURE_AVX512VL  },\n\t{ X86_FEATURE_AVX512_4VNNIW,\t\tX86_FEATURE_AVX512F   },\n\t{ X86_FEATURE_AVX512_4FMAPS,\t\tX86_FEATURE_AVX512F   },\n\t{ X86_FEATURE_AVX512_VPOPCNTDQ,\t\tX86_FEATURE_AVX512F   },\n\t{ X86_FEATURE_AVX512_VP2INTERSECT,\tX86_FEATURE_AVX512VL  },\n\t{ X86_FEATURE_CQM_OCCUP_LLC,\t\tX86_FEATURE_CQM_LLC   },\n\t{ X86_FEATURE_CQM_MBM_TOTAL,\t\tX86_FEATURE_CQM_LLC   },\n\t{ X86_FEATURE_CQM_MBM_LOCAL,\t\tX86_FEATURE_CQM_LLC   },\n\t{ X86_FEATURE_BMEC,\t\t\tX86_FEATURE_CQM_MBM_TOTAL   },\n\t{ X86_FEATURE_BMEC,\t\t\tX86_FEATURE_CQM_MBM_LOCAL   },\n\t{ X86_FEATURE_AVX512_BF16,\t\tX86_FEATURE_AVX512VL  },\n\t{ X86_FEATURE_AVX512_FP16,\t\tX86_FEATURE_AVX512BW  },\n\t{ X86_FEATURE_ENQCMD,\t\t\tX86_FEATURE_XSAVES    },\n\t{ X86_FEATURE_PER_THREAD_MBA,\t\tX86_FEATURE_MBA       },\n\t{ X86_FEATURE_SGX_LC,\t\t\tX86_FEATURE_SGX\t      },\n\t{ X86_FEATURE_SGX1,\t\t\tX86_FEATURE_SGX       },\n\t{ X86_FEATURE_SGX2,\t\t\tX86_FEATURE_SGX1      },\n\t{ X86_FEATURE_SGX_EDECCSSA,\t\tX86_FEATURE_SGX1      },\n\t{ X86_FEATURE_XFD,\t\t\tX86_FEATURE_XSAVES    },\n\t{ X86_FEATURE_XFD,\t\t\tX86_FEATURE_XGETBV1   },\n\t{ X86_FEATURE_AMX_TILE,\t\t\tX86_FEATURE_XFD       },\n\t{ X86_FEATURE_SHSTK,\t\t\tX86_FEATURE_XSAVES    },\n\t{}\n};\n\nstatic inline void clear_feature(struct cpuinfo_x86 *c, unsigned int feature)\n{\n\t \n\tif (!c) {\n\t\tclear_cpu_cap(&boot_cpu_data, feature);\n\t\tset_bit(feature, (unsigned long *)cpu_caps_cleared);\n\t} else {\n\t\tclear_bit(feature, (unsigned long *)c->x86_capability);\n\t}\n}\n\n \n#define MAX_FEATURE_BITS ((NCAPINTS + NBUGINTS) * sizeof(u32) * 8)\n\nstatic void do_clear_cpu_cap(struct cpuinfo_x86 *c, unsigned int feature)\n{\n\tDECLARE_BITMAP(disable, MAX_FEATURE_BITS);\n\tconst struct cpuid_dep *d;\n\tbool changed;\n\n\tif (WARN_ON(feature >= MAX_FEATURE_BITS))\n\t\treturn;\n\n\tclear_feature(c, feature);\n\n\t \n\tmemset(disable, 0, sizeof(disable));\n\t__set_bit(feature, disable);\n\n\t \n\tdo {\n\t\tchanged = false;\n\t\tfor (d = cpuid_deps; d->feature; d++) {\n\t\t\tif (!test_bit(d->depends, disable))\n\t\t\t\tcontinue;\n\t\t\tif (__test_and_set_bit(d->feature, disable))\n\t\t\t\tcontinue;\n\n\t\t\tchanged = true;\n\t\t\tclear_feature(c, d->feature);\n\t\t}\n\t} while (changed);\n}\n\nvoid clear_cpu_cap(struct cpuinfo_x86 *c, unsigned int feature)\n{\n\tdo_clear_cpu_cap(c, feature);\n}\n\nvoid setup_clear_cpu_cap(unsigned int feature)\n{\n\tdo_clear_cpu_cap(NULL, feature);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}