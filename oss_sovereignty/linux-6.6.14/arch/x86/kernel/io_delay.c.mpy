{
  "module_name": "io_delay.c",
  "hash_id": "5a0d7894f379d13aaae754fbb1fe51d9b2733581c6c36b835efed85e835003c4",
  "original_prompt": "Ingested from linux-6.6.14/arch/x86/kernel/io_delay.c",
  "human_readable_source": "\n \n#include <linux/kernel.h>\n#include <linux/export.h>\n#include <linux/delay.h>\n#include <linux/init.h>\n#include <linux/dmi.h>\n#include <linux/io.h>\n\n#define IO_DELAY_TYPE_0X80\t0\n#define IO_DELAY_TYPE_0XED\t1\n#define IO_DELAY_TYPE_UDELAY\t2\n#define IO_DELAY_TYPE_NONE\t3\n\n#if defined(CONFIG_IO_DELAY_0X80)\n#define DEFAULT_IO_DELAY_TYPE\tIO_DELAY_TYPE_0X80\n#elif defined(CONFIG_IO_DELAY_0XED)\n#define DEFAULT_IO_DELAY_TYPE\tIO_DELAY_TYPE_0XED\n#elif defined(CONFIG_IO_DELAY_UDELAY)\n#define DEFAULT_IO_DELAY_TYPE\tIO_DELAY_TYPE_UDELAY\n#elif defined(CONFIG_IO_DELAY_NONE)\n#define DEFAULT_IO_DELAY_TYPE\tIO_DELAY_TYPE_NONE\n#endif\n\nint io_delay_type __read_mostly = DEFAULT_IO_DELAY_TYPE;\n\nstatic int __initdata io_delay_override;\n\n \nvoid native_io_delay(void)\n{\n\tswitch (io_delay_type) {\n\tdefault:\n\tcase IO_DELAY_TYPE_0X80:\n\t\tasm volatile (\"outb %al, $0x80\");\n\t\tbreak;\n\tcase IO_DELAY_TYPE_0XED:\n\t\tasm volatile (\"outb %al, $0xed\");\n\t\tbreak;\n\tcase IO_DELAY_TYPE_UDELAY:\n\t\t \n\t\tudelay(2);\n\t\tbreak;\n\tcase IO_DELAY_TYPE_NONE:\n\t\tbreak;\n\t}\n}\nEXPORT_SYMBOL(native_io_delay);\n\nstatic int __init dmi_io_delay_0xed_port(const struct dmi_system_id *id)\n{\n\tif (io_delay_type == IO_DELAY_TYPE_0X80) {\n\t\tpr_notice(\"%s: using 0xed I/O delay port\\n\", id->ident);\n\t\tio_delay_type = IO_DELAY_TYPE_0XED;\n\t}\n\n\treturn 0;\n}\n\n \nstatic const struct dmi_system_id io_delay_0xed_port_dmi_table[] __initconst = {\n\t{\n\t\t.callback\t= dmi_io_delay_0xed_port,\n\t\t.ident\t\t= \"Compaq Presario V6000\",\n\t\t.matches\t= {\n\t\t\tDMI_MATCH(DMI_BOARD_VENDOR,\t\"Quanta\"),\n\t\t\tDMI_MATCH(DMI_BOARD_NAME,\t\"30B7\")\n\t\t}\n\t},\n\t{\n\t\t.callback\t= dmi_io_delay_0xed_port,\n\t\t.ident\t\t= \"HP Pavilion dv9000z\",\n\t\t.matches\t= {\n\t\t\tDMI_MATCH(DMI_BOARD_VENDOR,\t\"Quanta\"),\n\t\t\tDMI_MATCH(DMI_BOARD_NAME,\t\"30B9\")\n\t\t}\n\t},\n\t{\n\t\t.callback\t= dmi_io_delay_0xed_port,\n\t\t.ident\t\t= \"HP Pavilion dv6000\",\n\t\t.matches\t= {\n\t\t\tDMI_MATCH(DMI_BOARD_VENDOR,\t\"Quanta\"),\n\t\t\tDMI_MATCH(DMI_BOARD_NAME,\t\"30B8\")\n\t\t}\n\t},\n\t{\n\t\t.callback\t= dmi_io_delay_0xed_port,\n\t\t.ident\t\t= \"HP Pavilion tx1000\",\n\t\t.matches\t= {\n\t\t\tDMI_MATCH(DMI_BOARD_VENDOR,\t\"Quanta\"),\n\t\t\tDMI_MATCH(DMI_BOARD_NAME,\t\"30BF\")\n\t\t}\n\t},\n\t{\n\t\t.callback\t= dmi_io_delay_0xed_port,\n\t\t.ident\t\t= \"Presario F700\",\n\t\t.matches\t= {\n\t\t\tDMI_MATCH(DMI_BOARD_VENDOR,\t\"Quanta\"),\n\t\t\tDMI_MATCH(DMI_BOARD_NAME,\t\"30D3\")\n\t\t}\n\t},\n\t{ }\n};\n\nvoid __init io_delay_init(void)\n{\n\tif (!io_delay_override)\n\t\tdmi_check_system(io_delay_0xed_port_dmi_table);\n}\n\nstatic int __init io_delay_param(char *s)\n{\n\tif (!s)\n\t\treturn -EINVAL;\n\n\tif (!strcmp(s, \"0x80\"))\n\t\tio_delay_type = IO_DELAY_TYPE_0X80;\n\telse if (!strcmp(s, \"0xed\"))\n\t\tio_delay_type = IO_DELAY_TYPE_0XED;\n\telse if (!strcmp(s, \"udelay\"))\n\t\tio_delay_type = IO_DELAY_TYPE_UDELAY;\n\telse if (!strcmp(s, \"none\"))\n\t\tio_delay_type = IO_DELAY_TYPE_NONE;\n\telse\n\t\treturn -EINVAL;\n\n\tio_delay_override = 1;\n\treturn 0;\n}\n\nearly_param(\"io_delay\", io_delay_param);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}