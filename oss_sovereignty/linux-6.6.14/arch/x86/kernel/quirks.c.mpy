{
  "module_name": "quirks.c",
  "hash_id": "364e97594418f79fc8449da0053501cf6b36db1343e533881651dc5f9ae8fbaa",
  "original_prompt": "Ingested from linux-6.6.14/arch/x86/kernel/quirks.c",
  "human_readable_source": "\n \n#include <linux/dmi.h>\n#include <linux/pci.h>\n#include <linux/irq.h>\n\n#include <asm/hpet.h>\n#include <asm/setup.h>\n#include <asm/mce.h>\n\n#if defined(CONFIG_X86_IO_APIC) && defined(CONFIG_SMP) && defined(CONFIG_PCI)\n\nstatic void quirk_intel_irqbalance(struct pci_dev *dev)\n{\n\tu8 config;\n\tu16 word;\n\n\t \n\tif (dev->revision > 0x9)\n\t\treturn;\n\n\t \n\tpci_read_config_byte(dev, 0xf4, &config);\n\tpci_write_config_byte(dev, 0xf4, config|0x2);\n\n\t \n\tpci_bus_read_config_word(dev->bus, PCI_DEVFN(8, 0), 0x4c, &word);\n\n\tif (!(word & (1 << 13))) {\n\t\tdev_info(&dev->dev, \"Intel E7520/7320/7525 detected; \"\n\t\t\t\"disabling irq balancing and affinity\\n\");\n\t\tnoirqdebug_setup(\"\");\n#ifdef CONFIG_PROC_FS\n\t\tno_irq_affinity = 1;\n#endif\n\t}\n\n\t \n\tif (!(config & 0x2))\n\t\tpci_write_config_byte(dev, 0xf4, config);\n}\nDECLARE_PCI_FIXUP_FINAL(PCI_VENDOR_ID_INTEL, PCI_DEVICE_ID_INTEL_E7320_MCH,\n\t\t\tquirk_intel_irqbalance);\nDECLARE_PCI_FIXUP_FINAL(PCI_VENDOR_ID_INTEL, PCI_DEVICE_ID_INTEL_E7525_MCH,\n\t\t\tquirk_intel_irqbalance);\nDECLARE_PCI_FIXUP_FINAL(PCI_VENDOR_ID_INTEL, PCI_DEVICE_ID_INTEL_E7520_MCH,\n\t\t\tquirk_intel_irqbalance);\n#endif\n\n#if defined(CONFIG_HPET_TIMER)\nunsigned long force_hpet_address;\n\nstatic enum {\n\tNONE_FORCE_HPET_RESUME,\n\tOLD_ICH_FORCE_HPET_RESUME,\n\tICH_FORCE_HPET_RESUME,\n\tVT8237_FORCE_HPET_RESUME,\n\tNVIDIA_FORCE_HPET_RESUME,\n\tATI_FORCE_HPET_RESUME,\n} force_hpet_resume_type;\n\nstatic void __iomem *rcba_base;\n\nstatic void ich_force_hpet_resume(void)\n{\n\tu32 val;\n\n\tif (!force_hpet_address)\n\t\treturn;\n\n\tBUG_ON(rcba_base == NULL);\n\n\t \n\tval = readl(rcba_base + 0x3404);\n\tif (!(val & 0x80)) {\n\t\t \n\t\twritel(val | 0x80, rcba_base + 0x3404);\n\t}\n\n\tval = readl(rcba_base + 0x3404);\n\tif (!(val & 0x80))\n\t\tBUG();\n\telse\n\t\tprintk(KERN_DEBUG \"Force enabled HPET at resume\\n\");\n}\n\nstatic void ich_force_enable_hpet(struct pci_dev *dev)\n{\n\tu32 val;\n\tu32 rcba;\n\tint err = 0;\n\n\tif (hpet_address || force_hpet_address)\n\t\treturn;\n\n\tpci_read_config_dword(dev, 0xF0, &rcba);\n\trcba &= 0xFFFFC000;\n\tif (rcba == 0) {\n\t\tdev_printk(KERN_DEBUG, &dev->dev, \"RCBA disabled; \"\n\t\t\t\"cannot force enable HPET\\n\");\n\t\treturn;\n\t}\n\n\t \n\trcba_base = ioremap(rcba, 0x4000);\n\tif (rcba_base == NULL) {\n\t\tdev_printk(KERN_DEBUG, &dev->dev, \"ioremap failed; \"\n\t\t\t\"cannot force enable HPET\\n\");\n\t\treturn;\n\t}\n\n\t \n\tval = readl(rcba_base + 0x3404);\n\n\tif (val & 0x80) {\n\t\t \n\t\tval = val & 0x3;\n\t\tforce_hpet_address = 0xFED00000 | (val << 12);\n\t\tdev_printk(KERN_DEBUG, &dev->dev, \"Force enabled HPET at \"\n\t\t\t\"0x%lx\\n\", force_hpet_address);\n\t\tiounmap(rcba_base);\n\t\treturn;\n\t}\n\n\t \n\twritel(val | 0x80, rcba_base + 0x3404);\n\n\tval = readl(rcba_base + 0x3404);\n\tif (!(val & 0x80)) {\n\t\terr = 1;\n\t} else {\n\t\tval = val & 0x3;\n\t\tforce_hpet_address = 0xFED00000 | (val << 12);\n\t}\n\n\tif (err) {\n\t\tforce_hpet_address = 0;\n\t\tiounmap(rcba_base);\n\t\tdev_printk(KERN_DEBUG, &dev->dev,\n\t\t\t\"Failed to force enable HPET\\n\");\n\t} else {\n\t\tforce_hpet_resume_type = ICH_FORCE_HPET_RESUME;\n\t\tdev_printk(KERN_DEBUG, &dev->dev, \"Force enabled HPET at \"\n\t\t\t\"0x%lx\\n\", force_hpet_address);\n\t}\n}\n\nDECLARE_PCI_FIXUP_HEADER(PCI_VENDOR_ID_INTEL, PCI_DEVICE_ID_INTEL_ESB2_0,\n\t\t\t ich_force_enable_hpet);\nDECLARE_PCI_FIXUP_HEADER(PCI_VENDOR_ID_INTEL, PCI_DEVICE_ID_INTEL_ICH6_0,\n\t\t\t ich_force_enable_hpet);\nDECLARE_PCI_FIXUP_HEADER(PCI_VENDOR_ID_INTEL, PCI_DEVICE_ID_INTEL_ICH6_1,\n\t\t\t ich_force_enable_hpet);\nDECLARE_PCI_FIXUP_HEADER(PCI_VENDOR_ID_INTEL, PCI_DEVICE_ID_INTEL_ICH7_0,\n\t\t\t ich_force_enable_hpet);\nDECLARE_PCI_FIXUP_HEADER(PCI_VENDOR_ID_INTEL, PCI_DEVICE_ID_INTEL_ICH7_1,\n\t\t\t ich_force_enable_hpet);\nDECLARE_PCI_FIXUP_HEADER(PCI_VENDOR_ID_INTEL, PCI_DEVICE_ID_INTEL_ICH7_31,\n\t\t\t ich_force_enable_hpet);\nDECLARE_PCI_FIXUP_HEADER(PCI_VENDOR_ID_INTEL, PCI_DEVICE_ID_INTEL_ICH8_1,\n\t\t\t ich_force_enable_hpet);\nDECLARE_PCI_FIXUP_HEADER(PCI_VENDOR_ID_INTEL, PCI_DEVICE_ID_INTEL_ICH8_4,\n\t\t\t ich_force_enable_hpet);\nDECLARE_PCI_FIXUP_HEADER(PCI_VENDOR_ID_INTEL, PCI_DEVICE_ID_INTEL_ICH9_7,\n\t\t\t ich_force_enable_hpet);\nDECLARE_PCI_FIXUP_HEADER(PCI_VENDOR_ID_INTEL, 0x3a16,\t \n\t\t\t ich_force_enable_hpet);\n\nstatic struct pci_dev *cached_dev;\n\nstatic void hpet_print_force_info(void)\n{\n\tprintk(KERN_INFO \"HPET not enabled in BIOS. \"\n\t       \"You might try hpet=force boot option\\n\");\n}\n\nstatic void old_ich_force_hpet_resume(void)\n{\n\tu32 val;\n\tu32 gen_cntl;\n\n\tif (!force_hpet_address || !cached_dev)\n\t\treturn;\n\n\tpci_read_config_dword(cached_dev, 0xD0, &gen_cntl);\n\tgen_cntl &= (~(0x7 << 15));\n\tgen_cntl |= (0x4 << 15);\n\n\tpci_write_config_dword(cached_dev, 0xD0, gen_cntl);\n\tpci_read_config_dword(cached_dev, 0xD0, &gen_cntl);\n\tval = gen_cntl >> 15;\n\tval &= 0x7;\n\tif (val == 0x4)\n\t\tprintk(KERN_DEBUG \"Force enabled HPET at resume\\n\");\n\telse\n\t\tBUG();\n}\n\nstatic void old_ich_force_enable_hpet(struct pci_dev *dev)\n{\n\tu32 val;\n\tu32 gen_cntl;\n\n\tif (hpet_address || force_hpet_address)\n\t\treturn;\n\n\tpci_read_config_dword(dev, 0xD0, &gen_cntl);\n\t \n\tval = gen_cntl >> 15;\n\tval &= 0x7;\n\tif (val & 0x4) {\n\t\tval &= 0x3;\n\t\tforce_hpet_address = 0xFED00000 | (val << 12);\n\t\tdev_printk(KERN_DEBUG, &dev->dev, \"HPET at 0x%lx\\n\",\n\t\t\tforce_hpet_address);\n\t\treturn;\n\t}\n\n\t \n\tgen_cntl &= (~(0x7 << 15));\n\tgen_cntl |= (0x4 << 15);\n\tpci_write_config_dword(dev, 0xD0, gen_cntl);\n\n\tpci_read_config_dword(dev, 0xD0, &gen_cntl);\n\n\tval = gen_cntl >> 15;\n\tval &= 0x7;\n\tif (val & 0x4) {\n\t\t \n\t\tval &= 0x3;\n\t\tforce_hpet_address = 0xFED00000 | (val << 12);\n\t\tdev_printk(KERN_DEBUG, &dev->dev, \"Force enabled HPET at \"\n\t\t\t\"0x%lx\\n\", force_hpet_address);\n\t\tcached_dev = dev;\n\t\tforce_hpet_resume_type = OLD_ICH_FORCE_HPET_RESUME;\n\t\treturn;\n\t}\n\n\tdev_printk(KERN_DEBUG, &dev->dev, \"Failed to force enable HPET\\n\");\n}\n\n \nstatic void old_ich_force_enable_hpet_user(struct pci_dev *dev)\n{\n\tif (hpet_force_user)\n\t\told_ich_force_enable_hpet(dev);\n}\n\nDECLARE_PCI_FIXUP_HEADER(PCI_VENDOR_ID_INTEL, PCI_DEVICE_ID_INTEL_ESB_1,\n\t\t\t old_ich_force_enable_hpet_user);\nDECLARE_PCI_FIXUP_HEADER(PCI_VENDOR_ID_INTEL, PCI_DEVICE_ID_INTEL_82801CA_0,\n\t\t\t old_ich_force_enable_hpet_user);\nDECLARE_PCI_FIXUP_HEADER(PCI_VENDOR_ID_INTEL, PCI_DEVICE_ID_INTEL_82801CA_12,\n\t\t\t old_ich_force_enable_hpet_user);\nDECLARE_PCI_FIXUP_HEADER(PCI_VENDOR_ID_INTEL, PCI_DEVICE_ID_INTEL_82801DB_0,\n\t\t\t old_ich_force_enable_hpet_user);\nDECLARE_PCI_FIXUP_HEADER(PCI_VENDOR_ID_INTEL, PCI_DEVICE_ID_INTEL_82801DB_12,\n\t\t\t old_ich_force_enable_hpet_user);\nDECLARE_PCI_FIXUP_HEADER(PCI_VENDOR_ID_INTEL, PCI_DEVICE_ID_INTEL_82801EB_0,\n\t\t\t old_ich_force_enable_hpet);\nDECLARE_PCI_FIXUP_HEADER(PCI_VENDOR_ID_INTEL, PCI_DEVICE_ID_INTEL_82801EB_12,\n\t\t\t old_ich_force_enable_hpet);\n\n\nstatic void vt8237_force_hpet_resume(void)\n{\n\tu32 val;\n\n\tif (!force_hpet_address || !cached_dev)\n\t\treturn;\n\n\tval = 0xfed00000 | 0x80;\n\tpci_write_config_dword(cached_dev, 0x68, val);\n\n\tpci_read_config_dword(cached_dev, 0x68, &val);\n\tif (val & 0x80)\n\t\tprintk(KERN_DEBUG \"Force enabled HPET at resume\\n\");\n\telse\n\t\tBUG();\n}\n\nstatic void vt8237_force_enable_hpet(struct pci_dev *dev)\n{\n\tu32 val;\n\n\tif (hpet_address || force_hpet_address)\n\t\treturn;\n\n\tif (!hpet_force_user) {\n\t\thpet_print_force_info();\n\t\treturn;\n\t}\n\n\tpci_read_config_dword(dev, 0x68, &val);\n\t \n\tif (val & 0x80) {\n\t\tforce_hpet_address = (val & ~0x3ff);\n\t\tdev_printk(KERN_DEBUG, &dev->dev, \"HPET at 0x%lx\\n\",\n\t\t\tforce_hpet_address);\n\t\treturn;\n\t}\n\n\t \n\tval = 0xfed00000 | 0x80;\n\tpci_write_config_dword(dev, 0x68, val);\n\n\tpci_read_config_dword(dev, 0x68, &val);\n\tif (val & 0x80) {\n\t\tforce_hpet_address = (val & ~0x3ff);\n\t\tdev_printk(KERN_DEBUG, &dev->dev, \"Force enabled HPET at \"\n\t\t\t\"0x%lx\\n\", force_hpet_address);\n\t\tcached_dev = dev;\n\t\tforce_hpet_resume_type = VT8237_FORCE_HPET_RESUME;\n\t\treturn;\n\t}\n\n\tdev_printk(KERN_DEBUG, &dev->dev, \"Failed to force enable HPET\\n\");\n}\n\nDECLARE_PCI_FIXUP_HEADER(PCI_VENDOR_ID_VIA, PCI_DEVICE_ID_VIA_8235,\n\t\t\t vt8237_force_enable_hpet);\nDECLARE_PCI_FIXUP_HEADER(PCI_VENDOR_ID_VIA, PCI_DEVICE_ID_VIA_8237,\n\t\t\t vt8237_force_enable_hpet);\nDECLARE_PCI_FIXUP_HEADER(PCI_VENDOR_ID_VIA, PCI_DEVICE_ID_VIA_CX700,\n\t\t\t vt8237_force_enable_hpet);\n\nstatic void ati_force_hpet_resume(void)\n{\n\tpci_write_config_dword(cached_dev, 0x14, 0xfed00000);\n\tprintk(KERN_DEBUG \"Force enabled HPET at resume\\n\");\n}\n\nstatic u32 ati_ixp4x0_rev(struct pci_dev *dev)\n{\n\tint err = 0;\n\tu32 d = 0;\n\tu8  b = 0;\n\n\terr = pci_read_config_byte(dev, 0xac, &b);\n\tb &= ~(1<<5);\n\terr |= pci_write_config_byte(dev, 0xac, b);\n\terr |= pci_read_config_dword(dev, 0x70, &d);\n\td |= 1<<8;\n\terr |= pci_write_config_dword(dev, 0x70, d);\n\terr |= pci_read_config_dword(dev, 0x8, &d);\n\td &= 0xff;\n\tdev_printk(KERN_DEBUG, &dev->dev, \"SB4X0 revision 0x%x\\n\", d);\n\n\tWARN_ON_ONCE(err);\n\n\treturn d;\n}\n\nstatic void ati_force_enable_hpet(struct pci_dev *dev)\n{\n\tu32 d, val;\n\tu8  b;\n\n\tif (hpet_address || force_hpet_address)\n\t\treturn;\n\n\tif (!hpet_force_user) {\n\t\thpet_print_force_info();\n\t\treturn;\n\t}\n\n\td = ati_ixp4x0_rev(dev);\n\tif (d  < 0x82)\n\t\treturn;\n\n\t \n\tpci_write_config_dword(dev, 0x14, 0xfed00000);\n\tpci_read_config_dword(dev, 0x14, &val);\n\n\t \n\toutb(0x72, 0xcd6); b = inb(0xcd7);\n\tb |= 0x1;\n\toutb(0x72, 0xcd6); outb(b, 0xcd7);\n\toutb(0x72, 0xcd6); b = inb(0xcd7);\n\tif (!(b & 0x1))\n\t\treturn;\n\tpci_read_config_dword(dev, 0x64, &d);\n\td |= (1<<10);\n\tpci_write_config_dword(dev, 0x64, d);\n\tpci_read_config_dword(dev, 0x64, &d);\n\tif (!(d & (1<<10)))\n\t\treturn;\n\n\tforce_hpet_address = val;\n\tforce_hpet_resume_type = ATI_FORCE_HPET_RESUME;\n\tdev_printk(KERN_DEBUG, &dev->dev, \"Force enabled HPET at 0x%lx\\n\",\n\t\t   force_hpet_address);\n\tcached_dev = dev;\n}\nDECLARE_PCI_FIXUP_HEADER(PCI_VENDOR_ID_ATI, PCI_DEVICE_ID_ATI_IXP400_SMBUS,\n\t\t\t ati_force_enable_hpet);\n\n \nstatic void nvidia_force_hpet_resume(void)\n{\n\tpci_write_config_dword(cached_dev, 0x44, 0xfed00001);\n\tprintk(KERN_DEBUG \"Force enabled HPET at resume\\n\");\n}\n\nstatic void nvidia_force_enable_hpet(struct pci_dev *dev)\n{\n\tu32 val;\n\n\tif (hpet_address || force_hpet_address)\n\t\treturn;\n\n\tif (!hpet_force_user) {\n\t\thpet_print_force_info();\n\t\treturn;\n\t}\n\n\tpci_write_config_dword(dev, 0x44, 0xfed00001);\n\tpci_read_config_dword(dev, 0x44, &val);\n\tforce_hpet_address = val & 0xfffffffe;\n\tforce_hpet_resume_type = NVIDIA_FORCE_HPET_RESUME;\n\tdev_printk(KERN_DEBUG, &dev->dev, \"Force enabled HPET at 0x%lx\\n\",\n\t\tforce_hpet_address);\n\tcached_dev = dev;\n}\n\n \nDECLARE_PCI_FIXUP_HEADER(PCI_VENDOR_ID_NVIDIA, 0x0050,\n\t\t\tnvidia_force_enable_hpet);\nDECLARE_PCI_FIXUP_HEADER(PCI_VENDOR_ID_NVIDIA, 0x0051,\n\t\t\tnvidia_force_enable_hpet);\n\n \nDECLARE_PCI_FIXUP_HEADER(PCI_VENDOR_ID_NVIDIA, 0x0260,\n\t\t\tnvidia_force_enable_hpet);\nDECLARE_PCI_FIXUP_HEADER(PCI_VENDOR_ID_NVIDIA, 0x0360,\n\t\t\tnvidia_force_enable_hpet);\nDECLARE_PCI_FIXUP_HEADER(PCI_VENDOR_ID_NVIDIA, 0x0361,\n\t\t\tnvidia_force_enable_hpet);\nDECLARE_PCI_FIXUP_HEADER(PCI_VENDOR_ID_NVIDIA, 0x0362,\n\t\t\tnvidia_force_enable_hpet);\nDECLARE_PCI_FIXUP_HEADER(PCI_VENDOR_ID_NVIDIA, 0x0363,\n\t\t\tnvidia_force_enable_hpet);\nDECLARE_PCI_FIXUP_HEADER(PCI_VENDOR_ID_NVIDIA, 0x0364,\n\t\t\tnvidia_force_enable_hpet);\nDECLARE_PCI_FIXUP_HEADER(PCI_VENDOR_ID_NVIDIA, 0x0365,\n\t\t\tnvidia_force_enable_hpet);\nDECLARE_PCI_FIXUP_HEADER(PCI_VENDOR_ID_NVIDIA, 0x0366,\n\t\t\tnvidia_force_enable_hpet);\nDECLARE_PCI_FIXUP_HEADER(PCI_VENDOR_ID_NVIDIA, 0x0367,\n\t\t\tnvidia_force_enable_hpet);\n\nvoid force_hpet_resume(void)\n{\n\tswitch (force_hpet_resume_type) {\n\tcase ICH_FORCE_HPET_RESUME:\n\t\tich_force_hpet_resume();\n\t\treturn;\n\tcase OLD_ICH_FORCE_HPET_RESUME:\n\t\told_ich_force_hpet_resume();\n\t\treturn;\n\tcase VT8237_FORCE_HPET_RESUME:\n\t\tvt8237_force_hpet_resume();\n\t\treturn;\n\tcase NVIDIA_FORCE_HPET_RESUME:\n\t\tnvidia_force_hpet_resume();\n\t\treturn;\n\tcase ATI_FORCE_HPET_RESUME:\n\t\tati_force_hpet_resume();\n\t\treturn;\n\tdefault:\n\t\tbreak;\n\t}\n}\n\n \nstatic void e6xx_force_enable_hpet(struct pci_dev *dev)\n{\n\tif (hpet_address || force_hpet_address)\n\t\treturn;\n\n\tforce_hpet_address = 0xFED00000;\n\tforce_hpet_resume_type = NONE_FORCE_HPET_RESUME;\n\tdev_printk(KERN_DEBUG, &dev->dev, \"Force enabled HPET at \"\n\t\t\"0x%lx\\n\", force_hpet_address);\n}\nDECLARE_PCI_FIXUP_HEADER(PCI_VENDOR_ID_INTEL, PCI_DEVICE_ID_INTEL_E6XX_CU,\n\t\t\t e6xx_force_enable_hpet);\n\n \nstatic void force_disable_hpet_msi(struct pci_dev *unused)\n{\n\thpet_msi_disable = true;\n}\n\nDECLARE_PCI_FIXUP_HEADER(PCI_VENDOR_ID_ATI, PCI_DEVICE_ID_ATI_SBX00_SMBUS,\n\t\t\t force_disable_hpet_msi);\n\n#endif\n\n#if defined(CONFIG_PCI) && defined(CONFIG_NUMA)\n \nstatic void quirk_amd_nb_node(struct pci_dev *dev)\n{\n\tstruct pci_dev *nb_ht;\n\tunsigned int devfn;\n\tu32 node;\n\tu32 val;\n\n\tdevfn = PCI_DEVFN(PCI_SLOT(dev->devfn), 0);\n\tnb_ht = pci_get_slot(dev->bus, devfn);\n\tif (!nb_ht)\n\t\treturn;\n\n\tpci_read_config_dword(nb_ht, 0x60, &val);\n\tnode = pcibus_to_node(dev->bus) | (val & 7);\n\t \n\tif (node_online(node))\n\t\tset_dev_node(&dev->dev, node);\n\tpci_dev_put(nb_ht);\n}\n\nDECLARE_PCI_FIXUP_FINAL(PCI_VENDOR_ID_AMD, PCI_DEVICE_ID_AMD_K8_NB,\n\t\t\tquirk_amd_nb_node);\nDECLARE_PCI_FIXUP_FINAL(PCI_VENDOR_ID_AMD, PCI_DEVICE_ID_AMD_K8_NB_ADDRMAP,\n\t\t\tquirk_amd_nb_node);\nDECLARE_PCI_FIXUP_FINAL(PCI_VENDOR_ID_AMD, PCI_DEVICE_ID_AMD_K8_NB_MEMCTL,\n\t\t\tquirk_amd_nb_node);\nDECLARE_PCI_FIXUP_FINAL(PCI_VENDOR_ID_AMD, PCI_DEVICE_ID_AMD_K8_NB_MISC,\n\t\t\tquirk_amd_nb_node);\nDECLARE_PCI_FIXUP_FINAL(PCI_VENDOR_ID_AMD, PCI_DEVICE_ID_AMD_10H_NB_HT,\n\t\t\tquirk_amd_nb_node);\nDECLARE_PCI_FIXUP_FINAL(PCI_VENDOR_ID_AMD, PCI_DEVICE_ID_AMD_10H_NB_MAP,\n\t\t\tquirk_amd_nb_node);\nDECLARE_PCI_FIXUP_FINAL(PCI_VENDOR_ID_AMD, PCI_DEVICE_ID_AMD_10H_NB_DRAM,\n\t\t\tquirk_amd_nb_node);\nDECLARE_PCI_FIXUP_FINAL(PCI_VENDOR_ID_AMD, PCI_DEVICE_ID_AMD_10H_NB_MISC,\n\t\t\tquirk_amd_nb_node);\nDECLARE_PCI_FIXUP_FINAL(PCI_VENDOR_ID_AMD, PCI_DEVICE_ID_AMD_10H_NB_LINK,\n\t\t\tquirk_amd_nb_node);\nDECLARE_PCI_FIXUP_FINAL(PCI_VENDOR_ID_AMD, PCI_DEVICE_ID_AMD_15H_NB_F0,\n\t\t\tquirk_amd_nb_node);\nDECLARE_PCI_FIXUP_FINAL(PCI_VENDOR_ID_AMD, PCI_DEVICE_ID_AMD_15H_NB_F1,\n\t\t\tquirk_amd_nb_node);\nDECLARE_PCI_FIXUP_FINAL(PCI_VENDOR_ID_AMD, PCI_DEVICE_ID_AMD_15H_NB_F2,\n\t\t\tquirk_amd_nb_node);\nDECLARE_PCI_FIXUP_FINAL(PCI_VENDOR_ID_AMD, PCI_DEVICE_ID_AMD_15H_NB_F3,\n\t\t\tquirk_amd_nb_node);\nDECLARE_PCI_FIXUP_FINAL(PCI_VENDOR_ID_AMD, PCI_DEVICE_ID_AMD_15H_NB_F4,\n\t\t\tquirk_amd_nb_node);\nDECLARE_PCI_FIXUP_FINAL(PCI_VENDOR_ID_AMD, PCI_DEVICE_ID_AMD_15H_NB_F5,\n\t\t\tquirk_amd_nb_node);\n\n#endif\n\n#ifdef CONFIG_PCI\n \nstatic void amd_disable_seq_and_redirect_scrub(struct pci_dev *dev)\n{\n\tu32 val;\n\n\t \n\tpci_read_config_dword(dev, 0x58, &val);\n\tif (val & 0x1F) {\n\t\tval &= ~(0x1F);\n\t\tpci_write_config_dword(dev, 0x58, val);\n\t}\n\n\tpci_read_config_dword(dev, 0x5C, &val);\n\tif (val & BIT(0)) {\n\t\tval &= ~BIT(0);\n\t\tpci_write_config_dword(dev, 0x5c, val);\n\t}\n}\n\nDECLARE_PCI_FIXUP_FINAL(PCI_VENDOR_ID_AMD, PCI_DEVICE_ID_AMD_16H_NB_F3,\n\t\t\tamd_disable_seq_and_redirect_scrub);\n\n \nstatic void quirk_intel_brickland_xeon_ras_cap(struct pci_dev *pdev)\n{\n\tu32 capid0;\n\n\tpci_read_config_dword(pdev, 0x84, &capid0);\n\n\tif (capid0 & 0x10)\n\t\tenable_copy_mc_fragile();\n}\n\n \nstatic void quirk_intel_purley_xeon_ras_cap(struct pci_dev *pdev)\n{\n\tu32 capid0, capid5;\n\n\tpci_read_config_dword(pdev, 0x84, &capid0);\n\tpci_read_config_dword(pdev, 0x98, &capid5);\n\n\t \n\tif ((capid0 & 0xc0) == 0xc0 || (capid5 & 0x1e0))\n\t\tenable_copy_mc_fragile();\n\n}\nDECLARE_PCI_FIXUP_EARLY(PCI_VENDOR_ID_INTEL, 0x0ec3, quirk_intel_brickland_xeon_ras_cap);\nDECLARE_PCI_FIXUP_EARLY(PCI_VENDOR_ID_INTEL, 0x2fc0, quirk_intel_brickland_xeon_ras_cap);\nDECLARE_PCI_FIXUP_EARLY(PCI_VENDOR_ID_INTEL, 0x6fc0, quirk_intel_brickland_xeon_ras_cap);\nDECLARE_PCI_FIXUP_EARLY(PCI_VENDOR_ID_INTEL, 0x2083, quirk_intel_purley_xeon_ras_cap);\n#endif\n\nbool x86_apple_machine;\nEXPORT_SYMBOL(x86_apple_machine);\n\nvoid __init early_platform_quirks(void)\n{\n\tx86_apple_machine = dmi_match(DMI_SYS_VENDOR, \"Apple Inc.\") ||\n\t\t\t    dmi_match(DMI_SYS_VENDOR, \"Apple Computer, Inc.\");\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}