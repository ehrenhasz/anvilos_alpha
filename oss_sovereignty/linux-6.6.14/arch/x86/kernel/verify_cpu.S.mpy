{
  "module_name": "verify_cpu.S",
  "hash_id": "66bcb8a1f463aac6c833f22df42dca94282162f3bb2b92bf4a88d855bddfa652",
  "original_prompt": "Ingested from linux-6.6.14/arch/x86/kernel/verify_cpu.S",
  "human_readable_source": " \n \n\n#include <asm/cpufeatures.h>\n#include <asm/msr-index.h>\n\nSYM_FUNC_START_LOCAL(verify_cpu)\n\tpushf\t\t\t\t# Save caller passed flags\n\tpush\t$0\t\t\t# Kill any dangerous flags\n\tpopf\n\n#ifndef __x86_64__\n\tpushfl\t\t\t\t# standard way to check for cpuid\n\tpopl\t%eax\n\tmovl\t%eax,%ebx\n\txorl\t$0x200000,%eax\n\tpushl\t%eax\n\tpopfl\n\tpushfl\n\tpopl\t%eax\n\tcmpl\t%eax,%ebx\n\tjz\t.Lverify_cpu_no_longmode\t# cpu has no cpuid\n#endif\n\n\tmovl\t$0x0,%eax\t\t# See if cpuid 1 is implemented\n\tcpuid\n\tcmpl\t$0x1,%eax\n\tjb\t.Lverify_cpu_no_longmode\t# no cpuid 1\n\n\txor\t%di,%di\n\tcmpl\t$0x68747541,%ebx\t# AuthenticAMD\n\tjnz\t.Lverify_cpu_noamd\n\tcmpl\t$0x69746e65,%edx\n\tjnz\t.Lverify_cpu_noamd\n\tcmpl\t$0x444d4163,%ecx\n\tjnz\t.Lverify_cpu_noamd\n\tmov\t$1,%di\t\t\t# cpu is from AMD\n\tjmp\t.Lverify_cpu_check\n\n.Lverify_cpu_noamd:\n\tcmpl\t$0x756e6547,%ebx        # GenuineIntel?\n\tjnz\t.Lverify_cpu_check\n\tcmpl\t$0x49656e69,%edx\n\tjnz\t.Lverify_cpu_check\n\tcmpl\t$0x6c65746e,%ecx\n\tjnz\t.Lverify_cpu_check\n\n\t# only call IA32_MISC_ENABLE when:\n\t# family > 6 || (family == 6 && model >= 0xd)\n\tmovl\t$0x1, %eax\t\t# check CPU family and model\n\tcpuid\n\tmovl\t%eax, %ecx\n\n\tandl\t$0x0ff00f00, %eax\t# mask family and extended family\n\tshrl\t$8, %eax\n\tcmpl\t$6, %eax\n\tja\t.Lverify_cpu_clear_xd\t# family > 6, ok\n\tjb\t.Lverify_cpu_check\t# family < 6, skip\n\n\tandl\t$0x000f00f0, %ecx\t# mask model and extended model\n\tshrl\t$4, %ecx\n\tcmpl\t$0xd, %ecx\n\tjb\t.Lverify_cpu_check\t# family == 6, model < 0xd, skip\n\n.Lverify_cpu_clear_xd:\n\tmovl\t$MSR_IA32_MISC_ENABLE, %ecx\n\trdmsr\n\tbtrl\t$2, %edx\t\t# clear MSR_IA32_MISC_ENABLE_XD_DISABLE\n\tjnc\t.Lverify_cpu_check\t# only write MSR if bit was changed\n\twrmsr\n\n.Lverify_cpu_check:\n\tmovl    $0x1,%eax\t\t# Does the cpu have what it takes\n\tcpuid\n\tandl\t$REQUIRED_MASK0,%edx\n\txorl\t$REQUIRED_MASK0,%edx\n\tjnz\t.Lverify_cpu_no_longmode\n\n\tmovl    $0x80000000,%eax\t# See if extended cpuid is implemented\n\tcpuid\n\tcmpl    $0x80000001,%eax\n\tjb      .Lverify_cpu_no_longmode\t# no extended cpuid\n\n\tmovl    $0x80000001,%eax\t# Does the cpu have what it takes\n\tcpuid\n\tandl    $REQUIRED_MASK1,%edx\n\txorl    $REQUIRED_MASK1,%edx\n\tjnz     .Lverify_cpu_no_longmode\n\n.Lverify_cpu_sse_test:\n\tmovl\t$1,%eax\n\tcpuid\n\tandl\t$SSE_MASK,%edx\n\tcmpl\t$SSE_MASK,%edx\n\tje\t.Lverify_cpu_sse_ok\n\ttest\t%di,%di\n\tjz\t.Lverify_cpu_no_longmode\t# only try to force SSE on AMD\n\tmovl\t$MSR_K7_HWCR,%ecx\n\trdmsr\n\tbtr\t$15,%eax\t\t# enable SSE\n\twrmsr\n\txor\t%di,%di\t\t\t# don't loop\n\tjmp\t.Lverify_cpu_sse_test\t# try again\n\n.Lverify_cpu_no_longmode:\n\tpopf\t\t\t\t# Restore caller passed flags\n\tmovl $1,%eax\n\tRET\n.Lverify_cpu_sse_ok:\n\tpopf\t\t\t\t# Restore caller passed flags\n\txorl %eax, %eax\n\tRET\nSYM_FUNC_END(verify_cpu)\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}