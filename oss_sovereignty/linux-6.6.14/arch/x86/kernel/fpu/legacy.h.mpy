{
  "module_name": "legacy.h",
  "hash_id": "65d8f9c97f509833a75279978c86408d7364eb8d3d36005683a350a251921778",
  "original_prompt": "Ingested from linux-6.6.14/arch/x86/kernel/fpu/legacy.h",
  "human_readable_source": " \n#ifndef __X86_KERNEL_FPU_LEGACY_H\n#define __X86_KERNEL_FPU_LEGACY_H\n\n#include <asm/fpu/types.h>\n\nextern unsigned int mxcsr_feature_mask;\n\nstatic inline void ldmxcsr(u32 mxcsr)\n{\n\tasm volatile(\"ldmxcsr %0\" :: \"m\" (mxcsr));\n}\n\n \n#define user_insn(insn, output, input...)\t\t\t\t\\\n({\t\t\t\t\t\t\t\t\t\\\n\tint err;\t\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\tmight_fault();\t\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\tasm volatile(ASM_STAC \"\\n\"\t\t\t\t\t\\\n\t\t     \"1: \" #insn \"\\n\"\t\t\t\t\t\\\n\t\t     \"2: \" ASM_CLAC \"\\n\"\t\t\t\t\\\n\t\t     _ASM_EXTABLE_TYPE(1b, 2b, EX_TYPE_FAULT_MCE_SAFE)\t\\\n\t\t     : [err] \"=a\" (err), output\t\t\t\t\\\n\t\t     : \"0\"(0), input);\t\t\t\t\t\\\n\terr;\t\t\t\t\t\t\t\t\\\n})\n\n#define kernel_insn_err(insn, output, input...)\t\t\t\t\\\n({\t\t\t\t\t\t\t\t\t\\\n\tint err;\t\t\t\t\t\t\t\\\n\tasm volatile(\"1:\" #insn \"\\n\\t\"\t\t\t\t\t\\\n\t\t     \"2:\\n\"\t\t\t\t\t\t\\\n\t\t     _ASM_EXTABLE_TYPE_REG(1b, 2b, EX_TYPE_EFAULT_REG, %[err]) \\\n\t\t     : [err] \"=r\" (err), output\t\t\t\t\\\n\t\t     : \"0\"(0), input);\t\t\t\t\t\\\n\terr;\t\t\t\t\t\t\t\t\\\n})\n\n#define kernel_insn(insn, output, input...)\t\t\t\t\\\n\tasm volatile(\"1:\" #insn \"\\n\\t\"\t\t\t\t\t\\\n\t\t     \"2:\\n\"\t\t\t\t\t\t\\\n\t\t     _ASM_EXTABLE_TYPE(1b, 2b, EX_TYPE_FPU_RESTORE)\t\\\n\t\t     : output : input)\n\nstatic inline int fnsave_to_user_sigframe(struct fregs_state __user *fx)\n{\n\treturn user_insn(fnsave %[fx]; fwait,  [fx] \"=m\" (*fx), \"m\" (*fx));\n}\n\nstatic inline int fxsave_to_user_sigframe(struct fxregs_state __user *fx)\n{\n\tif (IS_ENABLED(CONFIG_X86_32))\n\t\treturn user_insn(fxsave %[fx], [fx] \"=m\" (*fx), \"m\" (*fx));\n\telse\n\t\treturn user_insn(fxsaveq %[fx], [fx] \"=m\" (*fx), \"m\" (*fx));\n\n}\n\nstatic inline void fxrstor(struct fxregs_state *fx)\n{\n\tif (IS_ENABLED(CONFIG_X86_32))\n\t\tkernel_insn(fxrstor %[fx], \"=m\" (*fx), [fx] \"m\" (*fx));\n\telse\n\t\tkernel_insn(fxrstorq %[fx], \"=m\" (*fx), [fx] \"m\" (*fx));\n}\n\nstatic inline int fxrstor_safe(struct fxregs_state *fx)\n{\n\tif (IS_ENABLED(CONFIG_X86_32))\n\t\treturn kernel_insn_err(fxrstor %[fx], \"=m\" (*fx), [fx] \"m\" (*fx));\n\telse\n\t\treturn kernel_insn_err(fxrstorq %[fx], \"=m\" (*fx), [fx] \"m\" (*fx));\n}\n\nstatic inline int fxrstor_from_user_sigframe(struct fxregs_state __user *fx)\n{\n\tif (IS_ENABLED(CONFIG_X86_32))\n\t\treturn user_insn(fxrstor %[fx], \"=m\" (*fx), [fx] \"m\" (*fx));\n\telse\n\t\treturn user_insn(fxrstorq %[fx], \"=m\" (*fx), [fx] \"m\" (*fx));\n}\n\nstatic inline void frstor(struct fregs_state *fx)\n{\n\tkernel_insn(frstor %[fx], \"=m\" (*fx), [fx] \"m\" (*fx));\n}\n\nstatic inline int frstor_safe(struct fregs_state *fx)\n{\n\treturn kernel_insn_err(frstor %[fx], \"=m\" (*fx), [fx] \"m\" (*fx));\n}\n\nstatic inline int frstor_from_user_sigframe(struct fregs_state __user *fx)\n{\n\treturn user_insn(frstor %[fx], \"=m\" (*fx), [fx] \"m\" (*fx));\n}\n\nstatic inline void fxsave(struct fxregs_state *fx)\n{\n\tif (IS_ENABLED(CONFIG_X86_32))\n\t\tasm volatile( \"fxsave %[fx]\" : [fx] \"=m\" (*fx));\n\telse\n\t\tasm volatile(\"fxsaveq %[fx]\" : [fx] \"=m\" (*fx));\n}\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}