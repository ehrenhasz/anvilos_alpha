{
  "module_name": "sys_ia32.c",
  "hash_id": "81e420aa1f2dadfd28675abcca1eeff1675f28a7970741671e0dd6bf0a44c66f",
  "original_prompt": "Ingested from linux-6.6.14/arch/x86/kernel/sys_ia32.c",
  "human_readable_source": "\n \n\n#include <linux/kernel.h>\n#include <linux/sched.h>\n#include <linux/fs.h>\n#include <linux/file.h>\n#include <linux/signal.h>\n#include <linux/syscalls.h>\n#include <linux/times.h>\n#include <linux/utsname.h>\n#include <linux/mm.h>\n#include <linux/uio.h>\n#include <linux/poll.h>\n#include <linux/personality.h>\n#include <linux/stat.h>\n#include <linux/rwsem.h>\n#include <linux/compat.h>\n#include <linux/vfs.h>\n#include <linux/ptrace.h>\n#include <linux/highuid.h>\n#include <linux/sysctl.h>\n#include <linux/slab.h>\n#include <linux/sched/task.h>\n#include <asm/mman.h>\n#include <asm/types.h>\n#include <linux/uaccess.h>\n#include <linux/atomic.h>\n#include <asm/vgtod.h>\n#include <asm/ia32.h>\n\n#define AA(__x)\t\t((unsigned long)(__x))\n\nSYSCALL_DEFINE3(ia32_truncate64, const char __user *, filename,\n\t\tunsigned long, offset_low, unsigned long, offset_high)\n{\n\treturn ksys_truncate(filename,\n\t\t\t    ((loff_t) offset_high << 32) | offset_low);\n}\n\nSYSCALL_DEFINE3(ia32_ftruncate64, unsigned int, fd,\n\t\tunsigned long, offset_low, unsigned long, offset_high)\n{\n\treturn ksys_ftruncate(fd, ((loff_t) offset_high << 32) | offset_low);\n}\n\n \nSYSCALL_DEFINE5(ia32_pread64, unsigned int, fd, char __user *, ubuf,\n\t\tu32, count, u32, poslo, u32, poshi)\n{\n\treturn ksys_pread64(fd, ubuf, count,\n\t\t\t    ((loff_t)AA(poshi) << 32) | AA(poslo));\n}\n\nSYSCALL_DEFINE5(ia32_pwrite64, unsigned int, fd, const char __user *, ubuf,\n\t\tu32, count, u32, poslo, u32, poshi)\n{\n\treturn ksys_pwrite64(fd, ubuf, count,\n\t\t\t     ((loff_t)AA(poshi) << 32) | AA(poslo));\n}\n\n\n \nSYSCALL_DEFINE6(ia32_fadvise64_64, int, fd, __u32, offset_low,\n\t\t__u32, offset_high, __u32, len_low, __u32, len_high,\n\t\tint, advice)\n{\n\treturn ksys_fadvise64_64(fd,\n\t\t\t\t (((u64)offset_high)<<32) | offset_low,\n\t\t\t\t (((u64)len_high)<<32) | len_low,\n\t\t\t\t advice);\n}\n\nSYSCALL_DEFINE4(ia32_readahead, int, fd, unsigned int, off_lo,\n\t\tunsigned int, off_hi, size_t, count)\n{\n\treturn ksys_readahead(fd, ((u64)off_hi << 32) | off_lo, count);\n}\n\nSYSCALL_DEFINE6(ia32_sync_file_range, int, fd, unsigned int, off_low,\n\t\tunsigned int, off_hi, unsigned int, n_low,\n\t\tunsigned int, n_hi, int, flags)\n{\n\treturn ksys_sync_file_range(fd,\n\t\t\t\t    ((u64)off_hi << 32) | off_low,\n\t\t\t\t    ((u64)n_hi << 32) | n_low, flags);\n}\n\nSYSCALL_DEFINE5(ia32_fadvise64, int, fd, unsigned int, offset_lo,\n\t\tunsigned int, offset_hi, size_t, len, int, advice)\n{\n\treturn ksys_fadvise64_64(fd, ((u64)offset_hi << 32) | offset_lo,\n\t\t\t\t len, advice);\n}\n\nSYSCALL_DEFINE6(ia32_fallocate, int, fd, int, mode,\n\t\tunsigned int, offset_lo, unsigned int, offset_hi,\n\t\tunsigned int, len_lo, unsigned int, len_hi)\n{\n\treturn ksys_fallocate(fd, mode, ((u64)offset_hi << 32) | offset_lo,\n\t\t\t      ((u64)len_hi << 32) | len_lo);\n}\n\n#ifdef CONFIG_IA32_EMULATION\n \nstatic int cp_stat64(struct stat64 __user *ubuf, struct kstat *stat)\n{\n\ttypeof(ubuf->st_uid) uid = 0;\n\ttypeof(ubuf->st_gid) gid = 0;\n\tSET_UID(uid, from_kuid_munged(current_user_ns(), stat->uid));\n\tSET_GID(gid, from_kgid_munged(current_user_ns(), stat->gid));\n\tif (!user_write_access_begin(ubuf, sizeof(struct stat64)))\n\t\treturn -EFAULT;\n\tunsafe_put_user(huge_encode_dev(stat->dev), &ubuf->st_dev, Efault);\n\tunsafe_put_user(stat->ino, &ubuf->__st_ino, Efault);\n\tunsafe_put_user(stat->ino, &ubuf->st_ino, Efault);\n\tunsafe_put_user(stat->mode, &ubuf->st_mode, Efault);\n\tunsafe_put_user(stat->nlink, &ubuf->st_nlink, Efault);\n\tunsafe_put_user(uid, &ubuf->st_uid, Efault);\n\tunsafe_put_user(gid, &ubuf->st_gid, Efault);\n\tunsafe_put_user(huge_encode_dev(stat->rdev), &ubuf->st_rdev, Efault);\n\tunsafe_put_user(stat->size, &ubuf->st_size, Efault);\n\tunsafe_put_user(stat->atime.tv_sec, &ubuf->st_atime, Efault);\n\tunsafe_put_user(stat->atime.tv_nsec, &ubuf->st_atime_nsec, Efault);\n\tunsafe_put_user(stat->mtime.tv_sec, &ubuf->st_mtime, Efault);\n\tunsafe_put_user(stat->mtime.tv_nsec, &ubuf->st_mtime_nsec, Efault);\n\tunsafe_put_user(stat->ctime.tv_sec, &ubuf->st_ctime, Efault);\n\tunsafe_put_user(stat->ctime.tv_nsec, &ubuf->st_ctime_nsec, Efault);\n\tunsafe_put_user(stat->blksize, &ubuf->st_blksize, Efault);\n\tunsafe_put_user(stat->blocks, &ubuf->st_blocks, Efault);\n\tuser_access_end();\n\treturn 0;\nEfault:\n\tuser_write_access_end();\n\treturn -EFAULT;\n}\n\nCOMPAT_SYSCALL_DEFINE2(ia32_stat64, const char __user *, filename,\n\t\t       struct stat64 __user *, statbuf)\n{\n\tstruct kstat stat;\n\tint ret = vfs_stat(filename, &stat);\n\n\tif (!ret)\n\t\tret = cp_stat64(statbuf, &stat);\n\treturn ret;\n}\n\nCOMPAT_SYSCALL_DEFINE2(ia32_lstat64, const char __user *, filename,\n\t\t       struct stat64 __user *, statbuf)\n{\n\tstruct kstat stat;\n\tint ret = vfs_lstat(filename, &stat);\n\tif (!ret)\n\t\tret = cp_stat64(statbuf, &stat);\n\treturn ret;\n}\n\nCOMPAT_SYSCALL_DEFINE2(ia32_fstat64, unsigned int, fd,\n\t\t       struct stat64 __user *, statbuf)\n{\n\tstruct kstat stat;\n\tint ret = vfs_fstat(fd, &stat);\n\tif (!ret)\n\t\tret = cp_stat64(statbuf, &stat);\n\treturn ret;\n}\n\nCOMPAT_SYSCALL_DEFINE4(ia32_fstatat64, unsigned int, dfd,\n\t\t       const char __user *, filename,\n\t\t       struct stat64 __user *, statbuf, int, flag)\n{\n\tstruct kstat stat;\n\tint error;\n\n\terror = vfs_fstatat(dfd, filename, &stat, flag);\n\tif (error)\n\t\treturn error;\n\treturn cp_stat64(statbuf, &stat);\n}\n\n \n\nstruct mmap_arg_struct32 {\n\tunsigned int addr;\n\tunsigned int len;\n\tunsigned int prot;\n\tunsigned int flags;\n\tunsigned int fd;\n\tunsigned int offset;\n};\n\nCOMPAT_SYSCALL_DEFINE1(ia32_mmap, struct mmap_arg_struct32 __user *, arg)\n{\n\tstruct mmap_arg_struct32 a;\n\n\tif (copy_from_user(&a, arg, sizeof(a)))\n\t\treturn -EFAULT;\n\n\tif (a.offset & ~PAGE_MASK)\n\t\treturn -EINVAL;\n\n\treturn ksys_mmap_pgoff(a.addr, a.len, a.prot, a.flags, a.fd,\n\t\t\t       a.offset>>PAGE_SHIFT);\n}\n\n \nCOMPAT_SYSCALL_DEFINE5(ia32_clone, unsigned long, clone_flags,\n\t\t       unsigned long, newsp, int __user *, parent_tidptr,\n\t\t       unsigned long, tls_val, int __user *, child_tidptr)\n{\n\tstruct kernel_clone_args args = {\n\t\t.flags\t\t= (clone_flags & ~CSIGNAL),\n\t\t.pidfd\t\t= parent_tidptr,\n\t\t.child_tid\t= child_tidptr,\n\t\t.parent_tid\t= parent_tidptr,\n\t\t.exit_signal\t= (clone_flags & CSIGNAL),\n\t\t.stack\t\t= newsp,\n\t\t.tls\t\t= tls_val,\n\t};\n\n\treturn kernel_clone(&args);\n}\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}