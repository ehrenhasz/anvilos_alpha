{
  "module_name": "ftrace_64.S",
  "hash_id": "c65c75ff219c6c4b72cf2077ae979e7a1f50a95210eb09ab1f5cc806196a0cfc",
  "original_prompt": "Ingested from linux-6.6.14/arch/x86/kernel/ftrace_64.S",
  "human_readable_source": " \n \n\n#include <linux/cfi_types.h>\n#include <linux/linkage.h>\n#include <asm/asm-offsets.h>\n#include <asm/ptrace.h>\n#include <asm/ftrace.h>\n#include <asm/export.h>\n#include <asm/nospec-branch.h>\n#include <asm/unwind_hints.h>\n#include <asm/frame.h>\n\n\t.code64\n\t.section .text, \"ax\"\n\n#ifdef CONFIG_FRAME_POINTER\n \n#  define MCOUNT_FRAME_SIZE\t(8+16*2)\n#else\n \n# define MCOUNT_FRAME_SIZE\t0\n#endif  \n\n \n#define MCOUNT_REG_SIZE\t\t(FRAME_SIZE + MCOUNT_FRAME_SIZE)\n\n \n\n \n.macro save_mcount_regs added=0\n\n#ifdef CONFIG_FRAME_POINTER\n\t \n\tpushq %rbp\n\n\t \n\n\t \n\tpushq \\added+8*2(%rsp)\n\tpushq %rbp\n\tmovq %rsp, %rbp\n\t \n\tpushq \\added+8*3(%rsp)\n\tpushq %rbp\n\tmovq %rsp, %rbp\n#endif  \n\n\t \n\tsubq $(FRAME_SIZE), %rsp\n\tmovq %rax, RAX(%rsp)\n\tmovq %rcx, RCX(%rsp)\n\tmovq %rdx, RDX(%rsp)\n\tmovq %rsi, RSI(%rsp)\n\tmovq %rdi, RDI(%rsp)\n\tmovq %r8, R8(%rsp)\n\tmovq %r9, R9(%rsp)\n\tmovq $0, ORIG_RAX(%rsp)\n\t \n#ifdef CONFIG_FRAME_POINTER\n\tmovq MCOUNT_REG_SIZE-8(%rsp), %rdx\n#else\n\tmovq %rbp, %rdx\n#endif\n\tmovq %rdx, RBP(%rsp)\n\n\t \n\tmovq MCOUNT_REG_SIZE+8+\\added(%rsp), %rsi\n\n\t  \n\tmovq MCOUNT_REG_SIZE+\\added(%rsp), %rdi\n\tmovq %rdi, RIP(%rsp)\n\n\t \n\tsubq $MCOUNT_INSN_SIZE, %rdi\n\t.endm\n\n.macro restore_mcount_regs save=0\n\n\t \n\tmovq RBP(%rsp), %rbp\n\n\tmovq R9(%rsp), %r9\n\tmovq R8(%rsp), %r8\n\tmovq RDI(%rsp), %rdi\n\tmovq RSI(%rsp), %rsi\n\tmovq RDX(%rsp), %rdx\n\tmovq RCX(%rsp), %rcx\n\tmovq RAX(%rsp), %rax\n\n\taddq $MCOUNT_REG_SIZE-\\save, %rsp\n\n\t.endm\n\nSYM_TYPED_FUNC_START(ftrace_stub)\n\tCALL_DEPTH_ACCOUNT\n\tRET\nSYM_FUNC_END(ftrace_stub)\n\n#ifdef CONFIG_FUNCTION_GRAPH_TRACER\nSYM_TYPED_FUNC_START(ftrace_stub_graph)\n\tCALL_DEPTH_ACCOUNT\n\tRET\nSYM_FUNC_END(ftrace_stub_graph)\n#endif\n\n#ifdef CONFIG_DYNAMIC_FTRACE\n\nSYM_FUNC_START(__fentry__)\n\tCALL_DEPTH_ACCOUNT\n\tRET\nSYM_FUNC_END(__fentry__)\nEXPORT_SYMBOL(__fentry__)\n\nSYM_FUNC_START(ftrace_caller)\n\t \n\tsave_mcount_regs\n\n\tCALL_DEPTH_ACCOUNT\n\n\t \n\tleaq MCOUNT_REG_SIZE+8(%rsp), %rcx\n\tmovq %rcx, RSP(%rsp)\n\nSYM_INNER_LABEL(ftrace_caller_op_ptr, SYM_L_GLOBAL)\n\tANNOTATE_NOENDBR\n\t \n\tmovq function_trace_op(%rip), %rdx\n\n\t \n\tleaq (%rsp), %rcx\n\n\t \n\tmovq $0, CS(%rsp)\n\n\t \n\tCALL_DEPTH_ACCOUNT\n\nSYM_INNER_LABEL(ftrace_call, SYM_L_GLOBAL)\n\tANNOTATE_NOENDBR\n\tcall ftrace_stub\n\n\t \n\tmovq RIP(%rsp), %rax\n\tmovq %rax, MCOUNT_REG_SIZE(%rsp)\n\n\trestore_mcount_regs\n\n\t \nSYM_INNER_LABEL(ftrace_caller_end, SYM_L_GLOBAL)\n\tANNOTATE_NOENDBR\n\tRET\nSYM_FUNC_END(ftrace_caller);\nSTACK_FRAME_NON_STANDARD_FP(ftrace_caller)\n\nSYM_FUNC_START(ftrace_regs_caller)\n\t \n\tpushfq\n\n\t \n\tsave_mcount_regs 8\n\t \n\n\tCALL_DEPTH_ACCOUNT\n\nSYM_INNER_LABEL(ftrace_regs_caller_op_ptr, SYM_L_GLOBAL)\n\tANNOTATE_NOENDBR\n\t \n\tmovq function_trace_op(%rip), %rdx\n\n\t \n\tmovq %r15, R15(%rsp)\n\tmovq %r14, R14(%rsp)\n\tmovq %r13, R13(%rsp)\n\tmovq %r12, R12(%rsp)\n\tmovq %r11, R11(%rsp)\n\tmovq %r10, R10(%rsp)\n\tmovq %rbx, RBX(%rsp)\n\t \n\tmovq MCOUNT_REG_SIZE(%rsp), %rcx\n\tmovq %rcx, EFLAGS(%rsp)\n\t \n\tmovq $__KERNEL_DS, %rcx\n\tmovq %rcx, SS(%rsp)\n\tmovq $__KERNEL_CS, %rcx\n\tmovq %rcx, CS(%rsp)\n\t \n\tleaq MCOUNT_REG_SIZE+8*2(%rsp), %rcx\n\tmovq %rcx, RSP(%rsp)\n\n\tENCODE_FRAME_POINTER\n\n\t \n\tleaq (%rsp), %rcx\n\n\t \n\tCALL_DEPTH_ACCOUNT\n\nSYM_INNER_LABEL(ftrace_regs_call, SYM_L_GLOBAL)\n\tANNOTATE_NOENDBR\n\tcall ftrace_stub\n\n\t \n\tmovq EFLAGS(%rsp), %rax\n\tmovq %rax, MCOUNT_REG_SIZE(%rsp)\n\n\t \n\tmovq RIP(%rsp), %rax\n\tmovq %rax, MCOUNT_REG_SIZE+8(%rsp)\n\n\t \n\tmovq R15(%rsp), %r15\n\tmovq R14(%rsp), %r14\n\tmovq R13(%rsp), %r13\n\tmovq R12(%rsp), %r12\n\tmovq R10(%rsp), %r10\n\tmovq RBX(%rsp), %rbx\n\n\tmovq ORIG_RAX(%rsp), %rax\n\tmovq %rax, MCOUNT_REG_SIZE-8(%rsp)\n\n\t \n\ttestq\t%rax, %rax\nSYM_INNER_LABEL(ftrace_regs_caller_jmp, SYM_L_GLOBAL)\n\tANNOTATE_NOENDBR\n\tjnz\t1f\n\n\trestore_mcount_regs\n\t \n\tpopfq\n\n\t \nSYM_INNER_LABEL(ftrace_regs_caller_end, SYM_L_GLOBAL)\n\tANNOTATE_NOENDBR\n\tRET\n\n\t \n1:\tmovq MCOUNT_REG_SIZE(%rsp), %rdi\n\tmovq %rdi, MCOUNT_REG_SIZE-8(%rsp)\n\tmovq %rax, MCOUNT_REG_SIZE(%rsp)\n\n\trestore_mcount_regs 8\n\t \n\tpopfq\n\tUNWIND_HINT_FUNC\n\n\t \n\tANNOTATE_INTRA_FUNCTION_CALL\n\tCALL .Ldo_rebalance\n\tint3\n.Ldo_rebalance:\n\tadd $8, %rsp\n\tALTERNATIVE __stringify(RET), \\\n\t\t    __stringify(ANNOTATE_UNRET_SAFE; ret; int3), \\\n\t\t    X86_FEATURE_CALL_DEPTH\n\nSYM_FUNC_END(ftrace_regs_caller)\nSTACK_FRAME_NON_STANDARD_FP(ftrace_regs_caller)\n\nSYM_FUNC_START(ftrace_stub_direct_tramp)\n\tCALL_DEPTH_ACCOUNT\n\tRET\nSYM_FUNC_END(ftrace_stub_direct_tramp)\n\n#else  \n\nSYM_FUNC_START(__fentry__)\n\tCALL_DEPTH_ACCOUNT\n\n\tcmpq $ftrace_stub, ftrace_trace_function\n\tjnz trace\n\tRET\n\ntrace:\n\t \n\tsave_mcount_regs\n\n\t \n\tmovq ftrace_trace_function, %r8\n\tCALL_NOSPEC r8\n\trestore_mcount_regs\n\n\tjmp ftrace_stub\nSYM_FUNC_END(__fentry__)\nEXPORT_SYMBOL(__fentry__)\nSTACK_FRAME_NON_STANDARD_FP(__fentry__)\n\n#endif  \n\n#ifdef CONFIG_FUNCTION_GRAPH_TRACER\nSYM_CODE_START(return_to_handler)\n\tUNWIND_HINT_UNDEFINED\n\tANNOTATE_NOENDBR\n\tsubq  $24, %rsp\n\n\t \n\tmovq %rax, (%rsp)\n\tmovq %rdx, 8(%rsp)\n\tmovq %rbp, 16(%rsp)\n\tmovq %rsp, %rdi\n\n\tcall ftrace_return_to_handler\n\n\tmovq %rax, %rdi\n\tmovq 8(%rsp), %rdx\n\tmovq (%rsp), %rax\n\n\taddq $24, %rsp\n\t \n\tANNOTATE_INTRA_FUNCTION_CALL\n\tcall .Ldo_rop\n\tint3\n.Ldo_rop:\n\tmov %rdi, (%rsp)\n\tALTERNATIVE __stringify(RET), \\\n\t\t    __stringify(ANNOTATE_UNRET_SAFE; ret; int3), \\\n\t\t    X86_FEATURE_CALL_DEPTH\nSYM_CODE_END(return_to_handler)\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}