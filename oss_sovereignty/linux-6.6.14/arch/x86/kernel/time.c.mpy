{
  "module_name": "time.c",
  "hash_id": "91e3480980c97f2c183096c6116e283a16728597c9148b204cbb7f12fbc9cb66",
  "original_prompt": "Ingested from linux-6.6.14/arch/x86/kernel/time.c",
  "human_readable_source": "\n \n\n#include <linux/clocksource.h>\n#include <linux/clockchips.h>\n#include <linux/interrupt.h>\n#include <linux/irq.h>\n#include <linux/i8253.h>\n#include <linux/time.h>\n#include <linux/export.h>\n\n#include <asm/vsyscall.h>\n#include <asm/x86_init.h>\n#include <asm/i8259.h>\n#include <asm/timer.h>\n#include <asm/hpet.h>\n#include <asm/time.h>\n\nunsigned long profile_pc(struct pt_regs *regs)\n{\n\tunsigned long pc = instruction_pointer(regs);\n\n\tif (!user_mode(regs) && in_lock_functions(pc)) {\n#ifdef CONFIG_FRAME_POINTER\n\t\treturn *(unsigned long *)(regs->bp + sizeof(long));\n#else\n\t\tunsigned long *sp = (unsigned long *)regs->sp;\n\t\t \n\t\tif (sp[0] >> 22)\n\t\t\treturn sp[0];\n\t\tif (sp[1] >> 22)\n\t\t\treturn sp[1];\n#endif\n\t}\n\treturn pc;\n}\nEXPORT_SYMBOL(profile_pc);\n\n \nstatic irqreturn_t timer_interrupt(int irq, void *dev_id)\n{\n\tglobal_clock_event->event_handler(global_clock_event);\n\treturn IRQ_HANDLED;\n}\n\nstatic void __init setup_default_timer_irq(void)\n{\n\tunsigned long flags = IRQF_NOBALANCING | IRQF_IRQPOLL | IRQF_TIMER;\n\n\t \n\tif (request_irq(0, timer_interrupt, flags, \"timer\", NULL))\n\t\tpr_info(\"Failed to register legacy timer interrupt\\n\");\n}\n\n \nvoid __init hpet_time_init(void)\n{\n\tif (!hpet_enable()) {\n\t\tif (!pit_timer_init())\n\t\t\treturn;\n\t}\n\n\tsetup_default_timer_irq();\n}\n\nstatic __init void x86_late_time_init(void)\n{\n\t \n\tx86_init.irqs.intr_mode_select();\n\n\t \n\tx86_init.timers.timer_init();\n\n\t \n\tx86_init.irqs.intr_mode_init();\n\ttsc_init();\n\n\tif (static_cpu_has(X86_FEATURE_WAITPKG))\n\t\tuse_tpause_delay();\n}\n\n \nvoid __init time_init(void)\n{\n\tlate_time_init = x86_late_time_init;\n}\n\n \nvoid clocksource_arch_init(struct clocksource *cs)\n{\n\tif (cs->vdso_clock_mode == VDSO_CLOCKMODE_NONE)\n\t\treturn;\n\n\tif (cs->mask != CLOCKSOURCE_MASK(64)) {\n\t\tpr_warn(\"clocksource %s registered with invalid mask %016llx for VDSO. Disabling VDSO support.\\n\",\n\t\t\tcs->name, cs->mask);\n\t\tcs->vdso_clock_mode = VDSO_CLOCKMODE_NONE;\n\t}\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}