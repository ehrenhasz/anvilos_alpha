{
  "module_name": "wakeup_asm.S",
  "hash_id": "f31d23362c4640dbbc0a21cf74612f67055272aedc962ea9faf62eccc75b3eb4",
  "original_prompt": "Ingested from linux-6.6.14/arch/x86/realmode/rm/wakeup_asm.S",
  "human_readable_source": " \n \n#include <linux/linkage.h>\n#include <asm/segment.h>\n#include <asm/msr-index.h>\n#include <asm/page_types.h>\n#include <asm/pgtable_types.h>\n#include <asm/processor-flags.h>\n#include \"realmode.h\"\n#include \"wakeup.h\"\n\n\t.code16\n\n \n\t.section \".data\", \"aw\"\n\n\t.balign\t16\nSYM_DATA_START(wakeup_header)\n\tvideo_mode:\t.short\t0\t \n\tpmode_entry:\t.long\t0\n\tpmode_cs:\t.short\t__KERNEL_CS\n\tpmode_cr0:\t.long\t0\t \n\tpmode_cr3:\t.long\t0\t \n\tpmode_cr4:\t.long\t0\t \n\tpmode_efer:\t.quad\t0\t \n\tpmode_gdt:\t.quad\t0\n\tpmode_misc_en:\t.quad\t0\t \n\tpmode_behavior:\t.long\t0\t \n\trealmode_flags:\t.long\t0\n\treal_magic:\t.long\t0\n\tsignature:\t.long\tWAKEUP_HEADER_SIGNATURE\nSYM_DATA_END(wakeup_header)\n\n\t.text\n\t.code16\n\n\t.balign\t16\nSYM_CODE_START(wakeup_start)\n\tcli\n\tcld\n\n\tLJMPW_RM(3f)\n3:\n\t \n\tmovw\t$16, %cx\n\tlgdtl\t%cs:wakeup_gdt\n\tmovl\t%cr0, %eax\n\torb\t$X86_CR0_PE, %al\n\tmovl\t%eax, %cr0\n\tljmpw\t$8, $2f\n2:\n\tmovw\t%cx, %ds\n\tmovw\t%cx, %es\n\tmovw\t%cx, %ss\n\tmovw\t%cx, %fs\n\tmovw\t%cx, %gs\n\n\tandb\t$~X86_CR0_PE, %al\n\tmovl\t%eax, %cr0\n\tLJMPW_RM(3f)\n3:\n\t \n\tmovw\t%cs, %ax\n\tmovw\t%ax, %ss\n\tmovl\t$rm_stack_end, %esp\n\tmovw\t%ax, %ds\n\tmovw\t%ax, %es\n\tmovw\t%ax, %fs\n\tmovw\t%ax, %gs\n\n\tlidtl\t.Lwakeup_idt\n\n\t \n\tpushl $0\n\tpopfl\n\n\t \n\tmovl\tsignature, %eax\n\tcmpl\t$WAKEUP_HEADER_SIGNATURE, %eax\n\tjne\tbogus_real_magic\n\n\t \n\tmovl\tend_signature, %eax\n\tcmpl\t$REALMODE_END_SIGNATURE, %eax\n\tjne\tbogus_real_magic\n\n\t \n\tcalll\tmain\n\n\t \n\tmovl\tpmode_behavior, %edi\n\tbtl\t$WAKEUP_BEHAVIOR_RESTORE_MISC_ENABLE, %edi\n\tjnc\t1f\n\n\tmovl\tpmode_misc_en, %eax\n\tmovl\tpmode_misc_en + 4, %edx\n\tmovl\t$MSR_IA32_MISC_ENABLE, %ecx\n\twrmsr\n1:\n\n\t \n\n#ifndef CONFIG_64BIT\n\t \n\tmovl\tpmode_cr3, %eax\n\tmovl\t%eax, %cr3\n\n\tbtl\t$WAKEUP_BEHAVIOR_RESTORE_CR4, %edi\n\tjnc\t1f\n\tmovl\tpmode_cr4, %eax\n\tmovl\t%eax, %cr4\n1:\n\tbtl\t$WAKEUP_BEHAVIOR_RESTORE_EFER, %edi\n\tjnc\t1f\n\tmovl\tpmode_efer, %eax\n\tmovl\tpmode_efer + 4, %edx\n\tmovl\t$MSR_EFER, %ecx\n\twrmsr\n1:\n\n\tlgdtl\tpmode_gdt\n\n\t \n\tmovl\tpmode_entry, %eax\n\tmovl\tpmode_cr0, %ecx\n\tmovl\t%ecx, %cr0\n\tljmpl\t$__KERNEL_CS, $pa_startup_32\n\t \n#else\n\tjmp\ttrampoline_start\n#endif\nSYM_CODE_END(wakeup_start)\n\nbogus_real_magic:\n1:\n\thlt\n\tjmp\t1b\n\n\t.section \".rodata\",\"a\"\n\n\t \n\n\t.balign\t16\nSYM_DATA_START(wakeup_gdt)\n\t.word\t3*8-1\t\t \n\t.long\tpa_wakeup_gdt\n\t.word\t0\n\n\t.word\t0xffff\t\t \n\t.long\t0x9b000000 + pa_real_mode_base\n\t.word\t0x008f\t\t \n\n\t.word\t0xffff\t\t \n\t.long\t0x93000000 + pa_real_mode_base\n\t.word\t0x008f\t\t \nSYM_DATA_END(wakeup_gdt)\n\n\t.section \".rodata\",\"a\"\n\t.balign\t8\n\n\t \n\t.balign\t16\nSYM_DATA_START_LOCAL(.Lwakeup_idt)\n\t.word\t0xffff\t\t \n\t.long\t0\t\t \n\t.word\t0\nSYM_DATA_END(.Lwakeup_idt)\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}