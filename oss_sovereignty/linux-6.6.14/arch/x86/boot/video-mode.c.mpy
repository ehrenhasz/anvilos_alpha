{
  "module_name": "video-mode.c",
  "hash_id": "a950f267dcdea39aaaae96aba57c800b744fec3dbe95c9e5e8bd0381e3918c6c",
  "original_prompt": "Ingested from linux-6.6.14/arch/x86/boot/video-mode.c",
  "human_readable_source": "\n \n\n \n\n#include \"boot.h\"\n#include \"video.h\"\n#include \"vesa.h\"\n\n#include <uapi/asm/boot.h>\n\n \nint adapter;\t\t \nint force_x, force_y;\t \nint do_restore;\t\t \nint graphic_mode;\t \n\n \nvoid probe_cards(int unsafe)\n{\n\tstruct card_info *card;\n\tstatic u8 probed[2];\n\n\tif (probed[unsafe])\n\t\treturn;\n\n\tprobed[unsafe] = 1;\n\n\tfor (card = video_cards; card < video_cards_end; card++) {\n\t\tif (card->unsafe == unsafe) {\n\t\t\tif (card->probe)\n\t\t\t\tcard->nmodes = card->probe();\n\t\t\telse\n\t\t\t\tcard->nmodes = 0;\n\t\t}\n\t}\n}\n\n \nint mode_defined(u16 mode)\n{\n\tstruct card_info *card;\n\tstruct mode_info *mi;\n\tint i;\n\n\tfor (card = video_cards; card < video_cards_end; card++) {\n\t\tmi = card->modes;\n\t\tfor (i = 0; i < card->nmodes; i++, mi++) {\n\t\t\tif (mi->mode == mode)\n\t\t\t\treturn 1;\n\t\t}\n\t}\n\n\treturn 0;\n}\n\n \nstatic int raw_set_mode(u16 mode, u16 *real_mode)\n{\n\tint nmode, i;\n\tstruct card_info *card;\n\tstruct mode_info *mi;\n\n\t \n\tmode &= ~VIDEO_RECALC;\n\n\t \n\tnmode = 0;\n\tfor (card = video_cards; card < video_cards_end; card++) {\n\t\tmi = card->modes;\n\t\tfor (i = 0; i < card->nmodes; i++, mi++) {\n\t\t\tint visible = mi->x || mi->y;\n\n\t\t\tif ((mode == nmode && visible) ||\n\t\t\t    mode == mi->mode ||\n\t\t\t    mode == (mi->y << 8)+mi->x) {\n\t\t\t\t*real_mode = mi->mode;\n\t\t\t\treturn card->set_mode(mi);\n\t\t\t}\n\n\t\t\tif (visible)\n\t\t\t\tnmode++;\n\t\t}\n\t}\n\n\t \n\tfor (card = video_cards; card < video_cards_end; card++) {\n\t\tif (mode >= card->xmode_first &&\n\t\t    mode < card->xmode_first+card->xmode_n) {\n\t\t\tstruct mode_info mix;\n\t\t\t*real_mode = mix.mode = mode;\n\t\t\tmix.x = mix.y = 0;\n\t\t\treturn card->set_mode(&mix);\n\t\t}\n\t}\n\n\t \n\treturn -1;\n}\n\n \nstatic void vga_recalc_vertical(void)\n{\n\tunsigned int font_size, rows;\n\tu16 crtc;\n\tu8 pt, ov;\n\n\tset_fs(0);\n\tfont_size = rdfs8(0x485);  \n\trows = force_y ? force_y : rdfs8(0x484)+1;  \n\n\trows *= font_size;\t \n\trows--;\t\t\t \n\n\tcrtc = vga_crtc();\n\n\tpt = in_idx(crtc, 0x11);\n\tpt &= ~0x80;\t\t \n\tout_idx(pt, crtc, 0x11);\n\n\tout_idx((u8)rows, crtc, 0x12);  \n\n\tov = in_idx(crtc, 0x07);  \n\tov &= 0xbd;\n\tov |= (rows >> (8-1)) & 0x02;\n\tov |= (rows >> (9-6)) & 0x40;\n\tout_idx(ov, crtc, 0x07);\n}\n\n \nint set_mode(u16 mode)\n{\n\tint rv;\n\tu16 real_mode;\n\n\t \n\tif (mode == VIDEO_CURRENT_MODE)\n\t\treturn 0;\t \n\telse if (mode == NORMAL_VGA)\n\t\tmode = VIDEO_80x25;\n\telse if (mode == EXTENDED_VGA)\n\t\tmode = VIDEO_8POINT;\n\n\trv = raw_set_mode(mode, &real_mode);\n\tif (rv)\n\t\treturn rv;\n\n\tif (mode & VIDEO_RECALC)\n\t\tvga_recalc_vertical();\n\n\t \n#ifndef _WAKEUP\n\tboot_params.hdr.vid_mode = real_mode;\n#endif\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}