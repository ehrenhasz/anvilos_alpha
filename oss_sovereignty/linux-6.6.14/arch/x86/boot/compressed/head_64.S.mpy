{
  "module_name": "head_64.S",
  "hash_id": "bfdccf261085cd0f922648cc37afcaf99f753022d152ec24eb63eeeecf837ee7",
  "original_prompt": "Ingested from linux-6.6.14/arch/x86/boot/compressed/head_64.S",
  "human_readable_source": " \n \n\n \n\n \n\t.code32\n\t.text\n\n#include <linux/init.h>\n#include <linux/linkage.h>\n#include <asm/segment.h>\n#include <asm/boot.h>\n#include <asm/msr.h>\n#include <asm/processor-flags.h>\n#include <asm/asm-offsets.h>\n#include <asm/bootparam.h>\n#include <asm/desc_defs.h>\n#include <asm/trapnr.h>\n#include \"pgtable.h\"\n\n \n#undef __ALIGN\n#define __ALIGN\t\t.balign\t16, 0x90\n\n \n\t.hidden _bss\n\t.hidden _ebss\n\t.hidden _end\n\n\t__HEAD\n\n \n#define rva(X) ((X) - startup_32)\n\n\t.code32\nSYM_FUNC_START(startup_32)\n\t \n\tcld\n\tcli\n\n \n\tleal\t(BP_scratch+4)(%esi), %esp\n\tcall\t1f\n1:\tpopl\t%ebp\n\tsubl\t$ rva(1b), %ebp\n\n\t \n\tleal\trva(gdt)(%ebp), %eax\n\tmovl\t%eax, 2(%eax)\n\tlgdt\t(%eax)\n\n\t \n\tmovl\t$__BOOT_DS, %eax\n\tmovl\t%eax, %ds\n\tmovl\t%eax, %es\n\tmovl\t%eax, %fs\n\tmovl\t%eax, %gs\n\tmovl\t%eax, %ss\n\n\t \n\tleal\trva(boot_stack_end)(%ebp), %esp\n\n\tpushl\t$__KERNEL32_CS\n\tleal\trva(1f)(%ebp), %eax\n\tpushl\t%eax\n\tlretl\n1:\n\n\t \n#ifdef CONFIG_AMD_MEM_ENCRYPT\n\tcall\tstartup32_load_idt\n#endif\n\n\t \n\tcall\tverify_cpu\n\ttestl\t%eax, %eax\n\tjnz\t.Lno_longmode\n\n \n\n#ifdef CONFIG_RELOCATABLE\n\tmovl\t%ebp, %ebx\n\tmovl\tBP_kernel_alignment(%esi), %eax\n\tdecl\t%eax\n\taddl\t%eax, %ebx\n\tnotl\t%eax\n\tandl\t%eax, %ebx\n\tcmpl\t$LOAD_PHYSICAL_ADDR, %ebx\n\tjae\t1f\n#endif\n\tmovl\t$LOAD_PHYSICAL_ADDR, %ebx\n1:\n\n\t \n\taddl\tBP_init_size(%esi), %ebx\n\tsubl\t$ rva(_end), %ebx\n\n \n\n\t \n\tmovl\t%cr4, %eax\n\torl\t$X86_CR4_PAE, %eax\n\tmovl\t%eax, %cr4\n\n  \n\t \n\txorl\t%edx, %edx\n#ifdef\tCONFIG_AMD_MEM_ENCRYPT\n\tcall\tget_sev_encryption_bit\n\txorl\t%edx, %edx\n\ttestl\t%eax, %eax\n\tjz\t1f\n\tsubl\t$32, %eax\t \n\tbts\t%eax, %edx\t \n\t \n\tmovl\t$1, rva(sev_status)(%ebp)\n1:\n#endif\n\n\t \n\tleal\trva(pgtable)(%ebx), %edi\n\txorl\t%eax, %eax\n\tmovl\t$(BOOT_INIT_PGT_SIZE/4), %ecx\n\trep\tstosl\n\n\t \n\tleal\trva(pgtable + 0)(%ebx), %edi\n\tleal\t0x1007 (%edi), %eax\n\tmovl\t%eax, 0(%edi)\n\taddl\t%edx, 4(%edi)\n\n\t \n\tleal\trva(pgtable + 0x1000)(%ebx), %edi\n\tleal\t0x1007(%edi), %eax\n\tmovl\t$4, %ecx\n1:\tmovl\t%eax, 0x00(%edi)\n\taddl\t%edx, 0x04(%edi)\n\taddl\t$0x00001000, %eax\n\taddl\t$8, %edi\n\tdecl\t%ecx\n\tjnz\t1b\n\n\t \n\tleal\trva(pgtable + 0x2000)(%ebx), %edi\n\tmovl\t$0x00000183, %eax\n\tmovl\t$2048, %ecx\n1:\tmovl\t%eax, 0(%edi)\n\taddl\t%edx, 4(%edi)\n\taddl\t$0x00200000, %eax\n\taddl\t$8, %edi\n\tdecl\t%ecx\n\tjnz\t1b\n\n\t \n\tleal\trva(pgtable)(%ebx), %eax\n\tmovl\t%eax, %cr3\n\n\t \n\tmovl\t$MSR_EFER, %ecx\n\trdmsr\n\tbtsl\t$_EFER_LME, %eax\n\twrmsr\n\n\t \n\txorl\t%eax, %eax\n\tlldt\t%ax\n\tmovl    $__BOOT_TSS, %eax\n\tltr\t%ax\n\n#ifdef CONFIG_AMD_MEM_ENCRYPT\n\t \n\tcall\tstartup32_check_sev_cbit\n#endif\n\n\t \n\tleal\trva(startup_64)(%ebp), %eax\n#ifdef CONFIG_EFI_MIXED\n\tcmpb\t$1, rva(efi_is64)(%ebp)\n\tje\t1f\n\tleal\trva(startup_64_mixed_mode)(%ebp), %eax\n1:\n#endif\n\n\tpushl\t$__KERNEL_CS\n\tpushl\t%eax\n\n\t \n\tmovl\t$CR0_STATE, %eax\n\tmovl\t%eax, %cr0\n\n\t \n\tlret\nSYM_FUNC_END(startup_32)\n\n\t.code64\n\t.org 0x200\nSYM_CODE_START(startup_64)\n\t \n\n\tcld\n\tcli\n\n\t \n\txorl\t%eax, %eax\n\tmovl\t%eax, %ds\n\tmovl\t%eax, %es\n\tmovl\t%eax, %ss\n\tmovl\t%eax, %fs\n\tmovl\t%eax, %gs\n\n\t \n\n\t \n#ifdef CONFIG_RELOCATABLE\n\tleaq\tstartup_32(%rip)  , %rbp\n\tmovl\tBP_kernel_alignment(%rsi), %eax\n\tdecl\t%eax\n\taddq\t%rax, %rbp\n\tnotq\t%rax\n\tandq\t%rax, %rbp\n\tcmpq\t$LOAD_PHYSICAL_ADDR, %rbp\n\tjae\t1f\n#endif\n\tmovq\t$LOAD_PHYSICAL_ADDR, %rbp\n1:\n\n\t \n\tmovl\tBP_init_size(%rsi), %ebx\n\tsubl\t$ rva(_end), %ebx\n\taddq\t%rbp, %rbx\n\n\t \n\tleaq\trva(boot_stack_end)(%rbx), %rsp\n\n\t \n\n\t \n\tleaq\tgdt64(%rip), %rax\n\taddq\t%rax, 2(%rax)\n\tlgdt\t(%rax)\n\n\t \n\tpushq\t$__KERNEL_CS\n\tleaq\t.Lon_kernel_cs(%rip), %rax\n\tpushq\t%rax\n\tlretq\n\n.Lon_kernel_cs:\n\t \n\tmovq\t%rsi, %r15\n\n\tcall\tload_stage1_idt\n\n#ifdef CONFIG_AMD_MEM_ENCRYPT\n\t \n\tmovq\t%r15, %rdi\n\tcall\tsev_enable\n#endif\n\n\t \n\tmovq\t%r15, %rdi\n\tleaq\trva(top_pgtable)(%rbx), %rsi\n\tcall\tconfigure_5level_paging\n\n\t \n\tpushq\t$0\n\tpopfq\n\n \n\tleaq\t(_bss-8)(%rip), %rsi\n\tleaq\trva(_bss-8)(%rbx), %rdi\n\tmovl\t$(_bss - startup_32), %ecx\n\tshrl\t$3, %ecx\n\tstd\n\trep\tmovsq\n\tcld\n\n\t \n\tleaq\trva(gdt64)(%rbx), %rax\n\tleaq\trva(gdt)(%rbx), %rdx\n\tmovq\t%rdx, 2(%rax)\n\tlgdt\t(%rax)\n\n \n\tleaq\trva(.Lrelocated)(%rbx), %rax\n\tjmp\t*%rax\nSYM_CODE_END(startup_64)\n\n\t.text\nSYM_FUNC_START_LOCAL_NOALIGN(.Lrelocated)\n\n \n\txorl\t%eax, %eax\n\tleaq    _bss(%rip), %rdi\n\tleaq    _ebss(%rip), %rcx\n\tsubq\t%rdi, %rcx\n\tshrq\t$3, %rcx\n\trep\tstosq\n\n\tcall\tload_stage2_idt\n\n\t \n\tmovq\t%r15, %rdi\n\tcall\tinitialize_identity_maps\n\n \n\t \n\tmovq\t%r15, %rdi\n\tmovq\t%rbp, %rsi\n\tcall\textract_kernel\t\t \n\n \n\tmovq\t%r15, %rsi\n\tjmp\t*%rax\nSYM_FUNC_END(.Lrelocated)\n\n \n\t.section \".rodata\", \"a\", @progbits\nSYM_CODE_START(trampoline_32bit_src)\n\t \n\tpushq\t%r15\n\tpushq\t%r14\n\tpushq\t%r13\n\tpushq\t%r12\n\tpushq\t%rbp\n\tpushq\t%rbx\n\n\t \n\tmovq\t%rsp, %rbx\n\tshrq\t$32, %rbx\n\n\t \n\tpushq\t$__KERNEL32_CS\n\tleaq\t0f(%rip), %rax\n\tpushq\t%rax\n\tlretq\n\n\t \n.Lret:\n\tshlq\t$32, %rbx\n\torq\t%rbx, %rsp\n\n\t \n\tpopq\t%rbx\n\tpopq\t%rbp\n\tpopq\t%r12\n\tpopq\t%r13\n\tpopq\t%r14\n\tpopq\t%r15\n\tretq\n\n\t.code32\n0:\n\t \n\tmovl\t%cr0, %eax\n\tbtrl\t$X86_CR0_PG_BIT, %eax\n\tmovl\t%eax, %cr0\n\n\t \n\tmovl\t%edi, %cr3\n\n\t \n\tmovl\t$MSR_EFER, %ecx\n\trdmsr\n\tbtsl\t$_EFER_LME, %eax\n\t \n\tjc\t1f\n\twrmsr\n1:\n\t \n\tmovl\t%cr4, %eax\n\tbtcl\t$X86_CR4_LA57_BIT, %eax\n\tmovl\t%eax, %cr4\n\n\t \n\tmovl\t%cr0, %eax\n\tbtsl\t$X86_CR0_PG_BIT, %eax\n\tmovl\t%eax, %cr0\n\n\t \n.Ljmp:\tljmpl\t$__KERNEL_CS, $(.Lret - trampoline_32bit_src)\nSYM_CODE_END(trampoline_32bit_src)\n\n \nSYM_DATA(trampoline_ljmp_imm_offset, .word  .Ljmp + 1 - trampoline_32bit_src)\n\n\t \n\t.org\ttrampoline_32bit_src + TRAMPOLINE_32BIT_CODE_SIZE\n\n\t.text\nSYM_FUNC_START_LOCAL_NOALIGN(.Lno_longmode)\n\t \n1:\n\thlt\n\tjmp     1b\nSYM_FUNC_END(.Lno_longmode)\n\n\t.globl\tverify_cpu\n#include \"../../kernel/verify_cpu.S\"\n\n\t.data\nSYM_DATA_START_LOCAL(gdt64)\n\t.word\tgdt_end - gdt - 1\n\t.quad   gdt - gdt64\nSYM_DATA_END(gdt64)\n\t.balign\t8\nSYM_DATA_START_LOCAL(gdt)\n\t.word\tgdt_end - gdt - 1\n\t.long\t0\n\t.word\t0\n\t.quad\t0x00cf9a000000ffff\t \n\t.quad\t0x00af9a000000ffff\t \n\t.quad\t0x00cf92000000ffff\t \n\t.quad\t0x0080890000000000\t \n\t.quad   0x0000000000000000\t \nSYM_DATA_END_LABEL(gdt, SYM_L_LOCAL, gdt_end)\n\nSYM_DATA_START(boot_idt_desc)\n\t.word\tboot_idt_end - boot_idt - 1\n\t.quad\t0\nSYM_DATA_END(boot_idt_desc)\n\t.balign 8\nSYM_DATA_START(boot_idt)\n\t.rept\tBOOT_IDT_ENTRIES\n\t.quad\t0\n\t.quad\t0\n\t.endr\nSYM_DATA_END_LABEL(boot_idt, SYM_L_GLOBAL, boot_idt_end)\n\n \n\t.bss\n\t.balign 4\nSYM_DATA_START_LOCAL(boot_stack)\n\t.fill BOOT_STACK_SIZE, 1, 0\n\t.balign 16\nSYM_DATA_END_LABEL(boot_stack, SYM_L_LOCAL, boot_stack_end)\n\n \n\t.section \".pgtable\",\"aw\",@nobits\n\t.balign 4096\nSYM_DATA_LOCAL(pgtable,\t\t.fill BOOT_PGT_SIZE, 1, 0)\n\n \nSYM_DATA_LOCAL(top_pgtable,\t.fill PAGE_SIZE, 1, 0)\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}