{
  "module_name": "video-vga.c",
  "hash_id": "ccad4b9e94da6b64bdcbff703c63e1c360e1856e5f73949dc934703cd2c1996a",
  "original_prompt": "Ingested from linux-6.6.14/arch/x86/boot/video-vga.c",
  "human_readable_source": "\n \n\n \n\n#include \"boot.h\"\n#include \"video.h\"\n\nstatic struct mode_info vga_modes[] = {\n\t{ VIDEO_80x25,  80, 25, 0 },\n\t{ VIDEO_8POINT, 80, 50, 0 },\n\t{ VIDEO_80x43,  80, 43, 0 },\n\t{ VIDEO_80x28,  80, 28, 0 },\n\t{ VIDEO_80x30,  80, 30, 0 },\n\t{ VIDEO_80x34,  80, 34, 0 },\n\t{ VIDEO_80x60,  80, 60, 0 },\n};\n\nstatic struct mode_info ega_modes[] = {\n\t{ VIDEO_80x25,  80, 25, 0 },\n\t{ VIDEO_8POINT, 80, 43, 0 },\n};\n\nstatic struct mode_info cga_modes[] = {\n\t{ VIDEO_80x25,  80, 25, 0 },\n};\n\nstatic __videocard video_vga;\n\n \nstatic u8 vga_set_basic_mode(void)\n{\n\tstruct biosregs ireg, oreg;\n\tu8 mode;\n\n\tinitregs(&ireg);\n\n\t \n\tireg.ax = 0x0f00;\n\tintcall(0x10, &ireg, &oreg);\n\tmode = oreg.al;\n\n\tif (mode != 3 && mode != 7)\n\t\tmode = 3;\n\n\t \n\tireg.ax = mode;\t\t \n\tintcall(0x10, &ireg, NULL);\n\tdo_restore = 1;\n\treturn mode;\n}\n\nstatic void vga_set_8font(void)\n{\n\t \n\tstruct biosregs ireg;\n\n\tinitregs(&ireg);\n\n\t \n\tireg.ax = 0x1112;\n\t \n\tintcall(0x10, &ireg, NULL);\n\n\t \n\tireg.ax = 0x1200;\n\tireg.bl = 0x20;\n\tintcall(0x10, &ireg, NULL);\n\n\t \n\tireg.ax = 0x1201;\n\tireg.bl = 0x34;\n\tintcall(0x10, &ireg, NULL);\n\n\t \n\tireg.ax = 0x0100;\n\tireg.cx = 0x0607;\n\tintcall(0x10, &ireg, NULL);\n}\n\nstatic void vga_set_14font(void)\n{\n\t \n\tstruct biosregs ireg;\n\n\tinitregs(&ireg);\n\n\t \n\tireg.ax = 0x1111;\n\t \n\tintcall(0x10, &ireg, NULL);\n\n\t \n\tireg.ax = 0x1201;\n\tireg.bl = 0x34;\n\tintcall(0x10, &ireg, NULL);\n\n\t \n\tireg.ax = 0x0100;\n\tireg.cx = 0x0b0c;\n\tintcall(0x10, &ireg, NULL);\n}\n\nstatic void vga_set_80x43(void)\n{\n\t \n\tstruct biosregs ireg;\n\n\tinitregs(&ireg);\n\n\t \n\tireg.ax = 0x1201;\n\tireg.bl = 0x30;\n\tintcall(0x10, &ireg, NULL);\n\n\t \n\tireg.ax = 0x0003;\n\tintcall(0x10, &ireg, NULL);\n\n\tvga_set_8font();\n}\n\n \nu16 vga_crtc(void)\n{\n\treturn (inb(0x3cc) & 1) ? 0x3d4 : 0x3b4;\n}\n\nstatic void vga_set_480_scanlines(void)\n{\n\tu16 crtc;\t\t \n\tu8  csel;\t\t \n\n\tcrtc = vga_crtc();\n\n\tout_idx(0x0c, crtc, 0x11);  \n\tout_idx(0x0b, crtc, 0x06);  \n\tout_idx(0x3e, crtc, 0x07);  \n\tout_idx(0xea, crtc, 0x10);  \n\tout_idx(0xdf, crtc, 0x12);  \n\tout_idx(0xe7, crtc, 0x15);  \n\tout_idx(0x04, crtc, 0x16);  \n\tcsel = inb(0x3cc);\n\tcsel &= 0x0d;\n\tcsel |= 0xe2;\n\toutb(csel, 0x3c2);\n}\n\nstatic void vga_set_vertical_end(int lines)\n{\n\tu16 crtc;\t\t \n\tu8  ovfw;\t\t \n\tint end = lines-1;\n\n\tcrtc = vga_crtc();\n\n\tovfw = 0x3c | ((end >> (8-1)) & 0x02) | ((end >> (9-6)) & 0x40);\n\n\tout_idx(ovfw, crtc, 0x07);  \n\tout_idx(end,  crtc, 0x12);  \n}\n\nstatic void vga_set_80x30(void)\n{\n\tvga_set_480_scanlines();\n\tvga_set_vertical_end(30*16);\n}\n\nstatic void vga_set_80x34(void)\n{\n\tvga_set_480_scanlines();\n\tvga_set_14font();\n\tvga_set_vertical_end(34*14);\n}\n\nstatic void vga_set_80x60(void)\n{\n\tvga_set_480_scanlines();\n\tvga_set_8font();\n\tvga_set_vertical_end(60*8);\n}\n\nstatic int vga_set_mode(struct mode_info *mode)\n{\n\t \n\tvga_set_basic_mode();\n\n\t \n\tforce_x = mode->x;\n\tforce_y = mode->y;\n\n\tswitch (mode->mode) {\n\tcase VIDEO_80x25:\n\t\tbreak;\n\tcase VIDEO_8POINT:\n\t\tvga_set_8font();\n\t\tbreak;\n\tcase VIDEO_80x43:\n\t\tvga_set_80x43();\n\t\tbreak;\n\tcase VIDEO_80x28:\n\t\tvga_set_14font();\n\t\tbreak;\n\tcase VIDEO_80x30:\n\t\tvga_set_80x30();\n\t\tbreak;\n\tcase VIDEO_80x34:\n\t\tvga_set_80x34();\n\t\tbreak;\n\tcase VIDEO_80x60:\n\t\tvga_set_80x60();\n\t\tbreak;\n\t}\n\n\treturn 0;\n}\n\n \nstatic int vga_probe(void)\n{\n\tstatic const char *card_name[] = {\n\t\t\"CGA/MDA/HGC\", \"EGA\", \"VGA\"\n\t};\n\tstatic struct mode_info *mode_lists[] = {\n\t\tcga_modes,\n\t\tega_modes,\n\t\tvga_modes,\n\t};\n\tstatic int mode_count[] = {\n\t\tARRAY_SIZE(cga_modes),\n\t\tARRAY_SIZE(ega_modes),\n\t\tARRAY_SIZE(vga_modes),\n\t};\n\n\tstruct biosregs ireg, oreg;\n\n\tinitregs(&ireg);\n\n\tireg.ax = 0x1200;\n\tireg.bl = 0x10;\t\t \n\tintcall(0x10, &ireg, &oreg);\n\n#ifndef _WAKEUP\n\tboot_params.screen_info.orig_video_ega_bx = oreg.bx;\n#endif\n\n\t \n\tif (oreg.bl != 0x10) {\n\t\t \n\t\tireg.ax = 0x1a00;\n\t\tintcall(0x10, &ireg, &oreg);\n\n\t\tif (oreg.al == 0x1a) {\n\t\t\tadapter = ADAPTER_VGA;\n#ifndef _WAKEUP\n\t\t\tboot_params.screen_info.orig_video_isVGA = 1;\n#endif\n\t\t} else {\n\t\t\tadapter = ADAPTER_EGA;\n\t\t}\n\t} else {\n\t\tadapter = ADAPTER_CGA;\n\t}\n\n\tvideo_vga.modes = mode_lists[adapter];\n\tvideo_vga.card_name = card_name[adapter];\n\treturn mode_count[adapter];\n}\n\nstatic __videocard video_vga = {\n\t.card_name\t= \"VGA\",\n\t.probe\t\t= vga_probe,\n\t.set_mode\t= vga_set_mode,\n};\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}