{
  "module_name": "video-bios.c",
  "hash_id": "71d2d8080396e51ea5ed2fe99e2bcc6d4534618449949ae7649d38fceb7a6c34",
  "original_prompt": "Ingested from linux-6.6.14/arch/x86/boot/video-bios.c",
  "human_readable_source": "\n \n\n \n\n#include \"boot.h\"\n#include \"video.h\"\n\nstatic __videocard video_bios;\n\n \nstatic int set_bios_mode(u8 mode);\n\nstatic int bios_set_mode(struct mode_info *mi)\n{\n\treturn set_bios_mode(mi->mode - VIDEO_FIRST_BIOS);\n}\n\nstatic int set_bios_mode(u8 mode)\n{\n\tstruct biosregs ireg, oreg;\n\tu8 new_mode;\n\n\tinitregs(&ireg);\n\tireg.al = mode;\t\t \n\tintcall(0x10, &ireg, NULL);\n\n\tireg.ah = 0x0f;\t\t \n\tintcall(0x10, &ireg, &oreg);\n\n\tdo_restore = 1;\t\t \n\n\t \n\tnew_mode = oreg.al & 0x7f;\n\n\tif (new_mode == mode)\n\t\treturn 0;\t \n\n#ifndef _WAKEUP\n\tif (new_mode != boot_params.screen_info.orig_video_mode) {\n\t\t \n\t\tireg.ax = boot_params.screen_info.orig_video_mode;\n\t\tintcall(0x10, &ireg, NULL);\n\t}\n#endif\n\treturn -1;\n}\n\nstatic int bios_probe(void)\n{\n\tu8 mode;\n#ifdef _WAKEUP\n\tu8 saved_mode = 0x03;\n#else\n\tu8 saved_mode = boot_params.screen_info.orig_video_mode;\n#endif\n\tu16 crtc;\n\tstruct mode_info *mi;\n\tint nmodes = 0;\n\n\tif (adapter != ADAPTER_EGA && adapter != ADAPTER_VGA)\n\t\treturn 0;\n\n\tset_fs(0);\n\tcrtc = vga_crtc();\n\n\tvideo_bios.modes = GET_HEAP(struct mode_info, 0);\n\n\tfor (mode = 0x14; mode <= 0x7f; mode++) {\n\t\tif (!heap_free(sizeof(struct mode_info)))\n\t\t\tbreak;\n\n\t\tif (mode_defined(VIDEO_FIRST_BIOS+mode))\n\t\t\tcontinue;\n\n\t\tif (set_bios_mode(mode))\n\t\t\tcontinue;\n\n\t\t \n\n\t\t \n\t\tif (in_idx(0x3c0, 0x10) & 0x01)\n\t\t\tcontinue;\n\n\t\t \n\t\tif (in_idx(0x3ce, 0x06) & 0x01)\n\t\t\tcontinue;\n\n\t\t \n\t\tif (in_idx(crtc, 0x0f))\n\t\t\tcontinue;\n\n\t\tmi = GET_HEAP(struct mode_info, 1);\n\t\tmi->mode = VIDEO_FIRST_BIOS+mode;\n\t\tmi->depth = 0;\t \n\t\tmi->x = rdfs16(0x44a);\n\t\tmi->y = rdfs8(0x484)+1;\n\t\tnmodes++;\n\t}\n\n\tset_bios_mode(saved_mode);\n\n\treturn nmodes;\n}\n\nstatic __videocard video_bios =\n{\n\t.card_name\t= \"BIOS\",\n\t.probe\t\t= bios_probe,\n\t.set_mode\t= bios_set_mode,\n\t.unsafe\t\t= 1,\n\t.xmode_first\t= VIDEO_FIRST_BIOS,\n\t.xmode_n\t= 0x80,\n};\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}