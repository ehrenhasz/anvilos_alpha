{
  "module_name": "core.c",
  "hash_id": "e34fbb3b97087c9e5369164f3dba8299634f4903f3174d615688d234cef088a6",
  "original_prompt": "Ingested from linux-6.6.14/arch/x86/coco/core.c",
  "human_readable_source": "\n \n\n#include <linux/export.h>\n#include <linux/cc_platform.h>\n\n#include <asm/coco.h>\n#include <asm/processor.h>\n\nenum cc_vendor cc_vendor __ro_after_init = CC_VENDOR_NONE;\nstatic u64 cc_mask __ro_after_init;\n\nstatic bool noinstr intel_cc_platform_has(enum cc_attr attr)\n{\n\tswitch (attr) {\n\tcase CC_ATTR_GUEST_UNROLL_STRING_IO:\n\tcase CC_ATTR_HOTPLUG_DISABLED:\n\tcase CC_ATTR_GUEST_MEM_ENCRYPT:\n\tcase CC_ATTR_MEM_ENCRYPT:\n\t\treturn true;\n\tdefault:\n\t\treturn false;\n\t}\n}\n\n \nstatic __maybe_unused __always_inline bool amd_cc_platform_vtom(enum cc_attr attr)\n{\n\tswitch (attr) {\n\tcase CC_ATTR_GUEST_MEM_ENCRYPT:\n\tcase CC_ATTR_MEM_ENCRYPT:\n\t\treturn true;\n\tdefault:\n\t\treturn false;\n\t}\n}\n\n \n\nstatic bool noinstr amd_cc_platform_has(enum cc_attr attr)\n{\n#ifdef CONFIG_AMD_MEM_ENCRYPT\n\n\tif (sev_status & MSR_AMD64_SNP_VTOM)\n\t\treturn amd_cc_platform_vtom(attr);\n\n\tswitch (attr) {\n\tcase CC_ATTR_MEM_ENCRYPT:\n\t\treturn sme_me_mask;\n\n\tcase CC_ATTR_HOST_MEM_ENCRYPT:\n\t\treturn sme_me_mask && !(sev_status & MSR_AMD64_SEV_ENABLED);\n\n\tcase CC_ATTR_GUEST_MEM_ENCRYPT:\n\t\treturn sev_status & MSR_AMD64_SEV_ENABLED;\n\n\tcase CC_ATTR_GUEST_STATE_ENCRYPT:\n\t\treturn sev_status & MSR_AMD64_SEV_ES_ENABLED;\n\n\t \n\tcase CC_ATTR_GUEST_UNROLL_STRING_IO:\n\t\treturn (sev_status & MSR_AMD64_SEV_ENABLED) &&\n\t\t\t!(sev_status & MSR_AMD64_SEV_ES_ENABLED);\n\n\tcase CC_ATTR_GUEST_SEV_SNP:\n\t\treturn sev_status & MSR_AMD64_SEV_SNP_ENABLED;\n\n\tdefault:\n\t\treturn false;\n\t}\n#else\n\treturn false;\n#endif\n}\n\nbool noinstr cc_platform_has(enum cc_attr attr)\n{\n\tswitch (cc_vendor) {\n\tcase CC_VENDOR_AMD:\n\t\treturn amd_cc_platform_has(attr);\n\tcase CC_VENDOR_INTEL:\n\t\treturn intel_cc_platform_has(attr);\n\tdefault:\n\t\treturn false;\n\t}\n}\nEXPORT_SYMBOL_GPL(cc_platform_has);\n\nu64 cc_mkenc(u64 val)\n{\n\t \n\tswitch (cc_vendor) {\n\tcase CC_VENDOR_AMD:\n\t\tif (sev_status & MSR_AMD64_SNP_VTOM)\n\t\t\treturn val & ~cc_mask;\n\t\telse\n\t\t\treturn val | cc_mask;\n\tcase CC_VENDOR_INTEL:\n\t\treturn val & ~cc_mask;\n\tdefault:\n\t\treturn val;\n\t}\n}\n\nu64 cc_mkdec(u64 val)\n{\n\t \n\tswitch (cc_vendor) {\n\tcase CC_VENDOR_AMD:\n\t\tif (sev_status & MSR_AMD64_SNP_VTOM)\n\t\t\treturn val | cc_mask;\n\t\telse\n\t\t\treturn val & ~cc_mask;\n\tcase CC_VENDOR_INTEL:\n\t\treturn val | cc_mask;\n\tdefault:\n\t\treturn val;\n\t}\n}\nEXPORT_SYMBOL_GPL(cc_mkdec);\n\n__init void cc_set_mask(u64 mask)\n{\n\tcc_mask = mask;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}