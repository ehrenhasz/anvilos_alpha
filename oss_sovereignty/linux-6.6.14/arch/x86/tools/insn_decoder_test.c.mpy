{
  "module_name": "insn_decoder_test.c",
  "hash_id": "b71af82d23c12738326ab489a141ce510d96d9134174f870cddfde0044b2b1fb",
  "original_prompt": "Ingested from linux-6.6.14/arch/x86/tools/insn_decoder_test.c",
  "human_readable_source": "\n \n\n#include <stdlib.h>\n#include <stdio.h>\n#include <string.h>\n#include <assert.h>\n#include <unistd.h>\n#include <stdarg.h>\n\n#define unlikely(cond) (cond)\n\n#include <asm/insn.h>\n#include <inat.c>\n#include <insn.c>\n\n \n\nconst char *prog;\nstatic int verbose;\nstatic int x86_64;\n\nstatic void usage(void)\n{\n\tfprintf(stderr, \"Usage: objdump -d a.out | awk -f objdump_reformat.awk\"\n\t\t\" | %s [-y|-n] [-v]\\n\", prog);\n\tfprintf(stderr, \"\\t-y\t64bit mode\\n\");\n\tfprintf(stderr, \"\\t-n\t32bit mode\\n\");\n\tfprintf(stderr, \"\\t-v\tverbose mode\\n\");\n\texit(1);\n}\n\nstatic void malformed_line(const char *line, int line_nr)\n{\n\tfprintf(stderr, \"%s: error: malformed line %d:\\n%s\",\n\t\tprog, line_nr, line);\n\texit(3);\n}\n\nstatic void pr_warn(const char *fmt, ...)\n{\n\tva_list ap;\n\n\tfprintf(stderr, \"%s: warning: \", prog);\n\tva_start(ap, fmt);\n\tvfprintf(stderr, fmt, ap);\n\tva_end(ap);\n}\n\nstatic void dump_field(FILE *fp, const char *name, const char *indent,\n\t\t       struct insn_field *field)\n{\n\tfprintf(fp, \"%s.%s = {\\n\", indent, name);\n\tfprintf(fp, \"%s\\t.value = %d, bytes[] = {%x, %x, %x, %x},\\n\",\n\t\tindent, field->value, field->bytes[0], field->bytes[1],\n\t\tfield->bytes[2], field->bytes[3]);\n\tfprintf(fp, \"%s\\t.got = %d, .nbytes = %d},\\n\", indent,\n\t\tfield->got, field->nbytes);\n}\n\nstatic void dump_insn(FILE *fp, struct insn *insn)\n{\n\tfprintf(fp, \"Instruction = {\\n\");\n\tdump_field(fp, \"prefixes\", \"\\t\",\t&insn->prefixes);\n\tdump_field(fp, \"rex_prefix\", \"\\t\",\t&insn->rex_prefix);\n\tdump_field(fp, \"vex_prefix\", \"\\t\",\t&insn->vex_prefix);\n\tdump_field(fp, \"opcode\", \"\\t\",\t\t&insn->opcode);\n\tdump_field(fp, \"modrm\", \"\\t\",\t\t&insn->modrm);\n\tdump_field(fp, \"sib\", \"\\t\",\t\t&insn->sib);\n\tdump_field(fp, \"displacement\", \"\\t\",\t&insn->displacement);\n\tdump_field(fp, \"immediate1\", \"\\t\",\t&insn->immediate1);\n\tdump_field(fp, \"immediate2\", \"\\t\",\t&insn->immediate2);\n\tfprintf(fp, \"\\t.attr = %x, .opnd_bytes = %d, .addr_bytes = %d,\\n\",\n\t\tinsn->attr, insn->opnd_bytes, insn->addr_bytes);\n\tfprintf(fp, \"\\t.length = %d, .x86_64 = %d, .kaddr = %p}\\n\",\n\t\tinsn->length, insn->x86_64, insn->kaddr);\n}\n\nstatic void parse_args(int argc, char **argv)\n{\n\tint c;\n\tprog = argv[0];\n\twhile ((c = getopt(argc, argv, \"ynv\")) != -1) {\n\t\tswitch (c) {\n\t\tcase 'y':\n\t\t\tx86_64 = 1;\n\t\t\tbreak;\n\t\tcase 'n':\n\t\t\tx86_64 = 0;\n\t\t\tbreak;\n\t\tcase 'v':\n\t\t\tverbose = 1;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tusage();\n\t\t}\n\t}\n}\n\n#define BUFSIZE 256\n\nint main(int argc, char **argv)\n{\n\tchar line[BUFSIZE], sym[BUFSIZE] = \"<unknown>\";\n\tunsigned char insn_buff[16];\n\tstruct insn insn;\n\tint insns = 0;\n\tint warnings = 0;\n\n\tparse_args(argc, argv);\n\n\twhile (fgets(line, BUFSIZE, stdin)) {\n\t\tchar copy[BUFSIZE], *s, *tab1, *tab2;\n\t\tint nb = 0, ret;\n\t\tunsigned int b;\n\n\t\tif (line[0] == '<') {\n\t\t\t \n\t\t\tstrcpy(sym, line);\n\t\t\tcontinue;\n\t\t}\n\n\t\tinsns++;\n\t\tmemset(insn_buff, 0, 16);\n\t\tstrcpy(copy, line);\n\t\ttab1 = strchr(copy, '\\t');\n\t\tif (!tab1)\n\t\t\tmalformed_line(line, insns);\n\t\ts = tab1 + 1;\n\t\ts += strspn(s, \" \");\n\t\ttab2 = strchr(s, '\\t');\n\t\tif (!tab2)\n\t\t\tmalformed_line(line, insns);\n\t\t*tab2 = '\\0';\t \n\t\twhile (s < tab2) {\n\t\t\tif (sscanf(s, \"%x\", &b) == 1) {\n\t\t\t\tinsn_buff[nb++] = (unsigned char) b;\n\t\t\t\ts += 3;\n\t\t\t} else\n\t\t\t\tbreak;\n\t\t}\n\n\t\t \n\t\tret = insn_decode(&insn, insn_buff, sizeof(insn_buff),\n\t\t\t\t  x86_64 ? INSN_MODE_64 : INSN_MODE_32);\n\n\t\tif (ret < 0 || insn.length != nb) {\n\t\t\twarnings++;\n\t\t\tpr_warn(\"Found an x86 instruction decoder bug, \"\n\t\t\t\t\"please report this.\\n\", sym);\n\t\t\tpr_warn(\"%s\", line);\n\t\t\tpr_warn(\"objdump says %d bytes, but insn_get_length() \"\n\t\t\t\t\"says %d\\n\", nb, insn.length);\n\t\t\tif (verbose)\n\t\t\t\tdump_insn(stderr, &insn);\n\t\t}\n\t}\n\tif (warnings)\n\t\tpr_warn(\"Decoded and checked %d instructions with %d \"\n\t\t\t\"failures\\n\", insns, warnings);\n\telse\n\t\tfprintf(stdout, \"%s: success: Decoded and checked %d\"\n\t\t\t\" instructions\\n\", prog, insns);\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}