{
  "module_name": "mmu_hvm.c",
  "hash_id": "579f025c144da65f0e3a80f78257d50b0e9eb73119876a024eed09898904fd2f",
  "original_prompt": "Ingested from linux-6.6.14/arch/x86/xen/mmu_hvm.c",
  "human_readable_source": "\n#include <linux/types.h>\n#include <linux/crash_dump.h>\n\n#include <xen/interface/xen.h>\n#include <xen/hvm.h>\n\n#include \"mmu.h\"\n\n#ifdef CONFIG_PROC_VMCORE\n \nstatic bool xen_vmcore_pfn_is_ram(struct vmcore_cb *cb, unsigned long pfn)\n{\n\tstruct xen_hvm_get_mem_type a = {\n\t\t.domid = DOMID_SELF,\n\t\t.pfn = pfn,\n\t};\n\n\tif (HYPERVISOR_hvm_op(HVMOP_get_mem_type, &a)) {\n\t\tpr_warn_once(\"Unexpected HVMOP_get_mem_type failure\\n\");\n\t\treturn true;\n\t}\n\treturn a.mem_type != HVMMEM_mmio_dm;\n}\nstatic struct vmcore_cb xen_vmcore_cb = {\n\t.pfn_is_ram = xen_vmcore_pfn_is_ram,\n};\n#endif\n\nstatic void xen_hvm_exit_mmap(struct mm_struct *mm)\n{\n\tstruct xen_hvm_pagetable_dying a;\n\tint rc;\n\n\ta.domid = DOMID_SELF;\n\ta.gpa = __pa(mm->pgd);\n\trc = HYPERVISOR_hvm_op(HVMOP_pagetable_dying, &a);\n\tWARN_ON_ONCE(rc < 0);\n}\n\nstatic int is_pagetable_dying_supported(void)\n{\n\tstruct xen_hvm_pagetable_dying a;\n\tint rc = 0;\n\n\ta.domid = DOMID_SELF;\n\ta.gpa = 0x00;\n\trc = HYPERVISOR_hvm_op(HVMOP_pagetable_dying, &a);\n\tif (rc < 0) {\n\t\tprintk(KERN_DEBUG \"HVMOP_pagetable_dying not supported\\n\");\n\t\treturn 0;\n\t}\n\treturn 1;\n}\n\nvoid __init xen_hvm_init_mmu_ops(void)\n{\n\tif (is_pagetable_dying_supported())\n\t\tpv_ops.mmu.exit_mmap = xen_hvm_exit_mmap;\n#ifdef CONFIG_PROC_VMCORE\n\tregister_vmcore_cb(&xen_vmcore_cb);\n#endif\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}