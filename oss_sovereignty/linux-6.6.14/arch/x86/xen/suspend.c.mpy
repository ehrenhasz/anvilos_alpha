{
  "module_name": "suspend.c",
  "hash_id": "e54ffa0c5c018a9394a711da4e7082d727fd4e42319aed1eba09688137674591",
  "original_prompt": "Ingested from linux-6.6.14/arch/x86/xen/suspend.c",
  "human_readable_source": "\n#include <linux/types.h>\n#include <linux/tick.h>\n#include <linux/percpu-defs.h>\n\n#include <xen/xen.h>\n#include <xen/interface/xen.h>\n#include <xen/grant_table.h>\n#include <xen/events.h>\n\n#include <asm/cpufeatures.h>\n#include <asm/msr-index.h>\n#include <asm/xen/hypercall.h>\n#include <asm/xen/page.h>\n#include <asm/fixmap.h>\n\n#include \"xen-ops.h\"\n#include \"mmu.h\"\n#include \"pmu.h\"\n\nstatic DEFINE_PER_CPU(u64, spec_ctrl);\n\nvoid xen_arch_pre_suspend(void)\n{\n\txen_save_time_memory_area();\n\n\tif (xen_pv_domain())\n\t\txen_pv_pre_suspend();\n}\n\nvoid xen_arch_post_suspend(int cancelled)\n{\n\tif (xen_pv_domain())\n\t\txen_pv_post_suspend(cancelled);\n\telse\n\t\txen_hvm_post_suspend(cancelled);\n\n\txen_restore_time_memory_area();\n}\n\nstatic void xen_vcpu_notify_restore(void *data)\n{\n\tif (xen_pv_domain() && boot_cpu_has(X86_FEATURE_SPEC_CTRL))\n\t\twrmsrl(MSR_IA32_SPEC_CTRL, this_cpu_read(spec_ctrl));\n\n\t \n\tif (smp_processor_id() == 0)\n\t\treturn;\n\n\ttick_resume_local();\n}\n\nstatic void xen_vcpu_notify_suspend(void *data)\n{\n\tu64 tmp;\n\n\ttick_suspend_local();\n\n\tif (xen_pv_domain() && boot_cpu_has(X86_FEATURE_SPEC_CTRL)) {\n\t\trdmsrl(MSR_IA32_SPEC_CTRL, tmp);\n\t\tthis_cpu_write(spec_ctrl, tmp);\n\t\twrmsrl(MSR_IA32_SPEC_CTRL, 0);\n\t}\n}\n\nvoid xen_arch_resume(void)\n{\n\tint cpu;\n\n\ton_each_cpu(xen_vcpu_notify_restore, NULL, 1);\n\n\tfor_each_online_cpu(cpu)\n\t\txen_pmu_init(cpu);\n}\n\nvoid xen_arch_suspend(void)\n{\n\tint cpu;\n\n\tfor_each_online_cpu(cpu)\n\t\txen_pmu_finish(cpu);\n\n\ton_each_cpu(xen_vcpu_notify_suspend, NULL, 1);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}