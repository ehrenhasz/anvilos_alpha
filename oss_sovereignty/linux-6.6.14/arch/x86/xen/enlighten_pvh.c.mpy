{
  "module_name": "enlighten_pvh.c",
  "hash_id": "b0e6d793d2797e2720ca085a0f576898aa78567c2341bf4b7e65d60c413f1a78",
  "original_prompt": "Ingested from linux-6.6.14/arch/x86/xen/enlighten_pvh.c",
  "human_readable_source": "\n#include <linux/acpi.h>\n#include <linux/export.h>\n\n#include <xen/hvc-console.h>\n\n#include <asm/io_apic.h>\n#include <asm/hypervisor.h>\n#include <asm/e820/api.h>\n\n#include <xen/xen.h>\n#include <asm/xen/interface.h>\n#include <asm/xen/hypercall.h>\n\n#include <xen/interface/memory.h>\n\n#include \"xen-ops.h\"\n\n \nbool __ro_after_init xen_pvh;\nEXPORT_SYMBOL_GPL(xen_pvh);\n\nvoid __init xen_pvh_init(struct boot_params *boot_params)\n{\n\tu32 msr;\n\tu64 pfn;\n\n\txen_pvh = 1;\n\txen_domain_type = XEN_HVM_DOMAIN;\n\txen_start_flags = pvh_start_info.flags;\n\n\tmsr = cpuid_ebx(xen_cpuid_base() + 2);\n\tpfn = __pa(hypercall_page);\n\twrmsr_safe(msr, (u32)pfn, (u32)(pfn >> 32));\n\n\tif (xen_initial_domain())\n\t\tx86_init.oem.arch_setup = xen_add_preferred_consoles;\n\tx86_init.oem.banner = xen_banner;\n\n\txen_efi_init(boot_params);\n\n\tif (xen_initial_domain()) {\n\t\tstruct xen_platform_op op = {\n\t\t\t.cmd = XENPF_get_dom0_console,\n\t\t};\n\t\tint ret = HYPERVISOR_platform_op(&op);\n\n\t\tif (ret > 0)\n\t\t\txen_init_vga(&op.u.dom0_console,\n\t\t\t\t     min(ret * sizeof(char),\n\t\t\t\t\t sizeof(op.u.dom0_console)),\n\t\t\t\t     &boot_params->screen_info);\n\t}\n}\n\nvoid __init mem_map_via_hcall(struct boot_params *boot_params_p)\n{\n\tstruct xen_memory_map memmap;\n\tint rc;\n\n\tmemmap.nr_entries = ARRAY_SIZE(boot_params_p->e820_table);\n\tset_xen_guest_handle(memmap.buffer, boot_params_p->e820_table);\n\trc = HYPERVISOR_memory_op(XENMEM_memory_map, &memmap);\n\tif (rc) {\n\t\txen_raw_printk(\"XENMEM_memory_map failed (%d)\\n\", rc);\n\t\tBUG();\n\t}\n\tboot_params_p->e820_entries = memmap.nr_entries;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}