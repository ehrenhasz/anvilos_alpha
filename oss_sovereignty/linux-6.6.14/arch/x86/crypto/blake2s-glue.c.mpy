{
  "module_name": "blake2s-glue.c",
  "hash_id": "91e2bcc738929964ac7ea4e6ca3f862442cf69439f6b2717314a061fcefa2910",
  "original_prompt": "Ingested from linux-6.6.14/arch/x86/crypto/blake2s-glue.c",
  "human_readable_source": "\n \n\n#include <crypto/internal/blake2s.h>\n\n#include <linux/types.h>\n#include <linux/jump_label.h>\n#include <linux/kernel.h>\n#include <linux/sizes.h>\n\n#include <asm/cpufeature.h>\n#include <asm/fpu/api.h>\n#include <asm/processor.h>\n#include <asm/simd.h>\n\nasmlinkage void blake2s_compress_ssse3(struct blake2s_state *state,\n\t\t\t\t       const u8 *block, const size_t nblocks,\n\t\t\t\t       const u32 inc);\nasmlinkage void blake2s_compress_avx512(struct blake2s_state *state,\n\t\t\t\t\tconst u8 *block, const size_t nblocks,\n\t\t\t\t\tconst u32 inc);\n\nstatic __ro_after_init DEFINE_STATIC_KEY_FALSE(blake2s_use_ssse3);\nstatic __ro_after_init DEFINE_STATIC_KEY_FALSE(blake2s_use_avx512);\n\nvoid blake2s_compress(struct blake2s_state *state, const u8 *block,\n\t\t      size_t nblocks, const u32 inc)\n{\n\t \n\tBUILD_BUG_ON(SZ_4K / BLAKE2S_BLOCK_SIZE < 8);\n\n\tif (!static_branch_likely(&blake2s_use_ssse3) || !may_use_simd()) {\n\t\tblake2s_compress_generic(state, block, nblocks, inc);\n\t\treturn;\n\t}\n\n\tdo {\n\t\tconst size_t blocks = min_t(size_t, nblocks,\n\t\t\t\t\t    SZ_4K / BLAKE2S_BLOCK_SIZE);\n\n\t\tkernel_fpu_begin();\n\t\tif (IS_ENABLED(CONFIG_AS_AVX512) &&\n\t\t    static_branch_likely(&blake2s_use_avx512))\n\t\t\tblake2s_compress_avx512(state, block, blocks, inc);\n\t\telse\n\t\t\tblake2s_compress_ssse3(state, block, blocks, inc);\n\t\tkernel_fpu_end();\n\n\t\tnblocks -= blocks;\n\t\tblock += blocks * BLAKE2S_BLOCK_SIZE;\n\t} while (nblocks);\n}\nEXPORT_SYMBOL(blake2s_compress);\n\nstatic int __init blake2s_mod_init(void)\n{\n\tif (boot_cpu_has(X86_FEATURE_SSSE3))\n\t\tstatic_branch_enable(&blake2s_use_ssse3);\n\n\tif (IS_ENABLED(CONFIG_AS_AVX512) &&\n\t    boot_cpu_has(X86_FEATURE_AVX) &&\n\t    boot_cpu_has(X86_FEATURE_AVX2) &&\n\t    boot_cpu_has(X86_FEATURE_AVX512F) &&\n\t    boot_cpu_has(X86_FEATURE_AVX512VL) &&\n\t    cpu_has_xfeatures(XFEATURE_MASK_SSE | XFEATURE_MASK_YMM |\n\t\t\t      XFEATURE_MASK_AVX512, NULL))\n\t\tstatic_branch_enable(&blake2s_use_avx512);\n\n\treturn 0;\n}\n\nsubsys_initcall(blake2s_mod_init);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}