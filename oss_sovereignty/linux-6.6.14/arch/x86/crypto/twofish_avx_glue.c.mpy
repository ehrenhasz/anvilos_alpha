{
  "module_name": "twofish_avx_glue.c",
  "hash_id": "ae3cc1a487c234038c8a5e9199574212fa93fbf99d2da1ba31d79c9ea97f33b3",
  "original_prompt": "Ingested from linux-6.6.14/arch/x86/crypto/twofish_avx_glue.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/types.h>\n#include <linux/crypto.h>\n#include <linux/err.h>\n#include <crypto/algapi.h>\n#include <crypto/internal/simd.h>\n#include <crypto/twofish.h>\n\n#include \"twofish.h\"\n#include \"ecb_cbc_helpers.h\"\n\n#define TWOFISH_PARALLEL_BLOCKS 8\n\n \nasmlinkage void twofish_ecb_enc_8way(const void *ctx, u8 *dst, const u8 *src);\nasmlinkage void twofish_ecb_dec_8way(const void *ctx, u8 *dst, const u8 *src);\n\nasmlinkage void twofish_cbc_dec_8way(const void *ctx, u8 *dst, const u8 *src);\n\nstatic int twofish_setkey_skcipher(struct crypto_skcipher *tfm,\n\t\t\t\t   const u8 *key, unsigned int keylen)\n{\n\treturn twofish_setkey(&tfm->base, key, keylen);\n}\n\nstatic inline void twofish_enc_blk_3way(const void *ctx, u8 *dst, const u8 *src)\n{\n\t__twofish_enc_blk_3way(ctx, dst, src, false);\n}\n\nstatic int ecb_encrypt(struct skcipher_request *req)\n{\n\tECB_WALK_START(req, TF_BLOCK_SIZE, TWOFISH_PARALLEL_BLOCKS);\n\tECB_BLOCK(TWOFISH_PARALLEL_BLOCKS, twofish_ecb_enc_8way);\n\tECB_BLOCK(3, twofish_enc_blk_3way);\n\tECB_BLOCK(1, twofish_enc_blk);\n\tECB_WALK_END();\n}\n\nstatic int ecb_decrypt(struct skcipher_request *req)\n{\n\tECB_WALK_START(req, TF_BLOCK_SIZE, TWOFISH_PARALLEL_BLOCKS);\n\tECB_BLOCK(TWOFISH_PARALLEL_BLOCKS, twofish_ecb_dec_8way);\n\tECB_BLOCK(3, twofish_dec_blk_3way);\n\tECB_BLOCK(1, twofish_dec_blk);\n\tECB_WALK_END();\n}\n\nstatic int cbc_encrypt(struct skcipher_request *req)\n{\n\tCBC_WALK_START(req, TF_BLOCK_SIZE, -1);\n\tCBC_ENC_BLOCK(twofish_enc_blk);\n\tCBC_WALK_END();\n}\n\nstatic int cbc_decrypt(struct skcipher_request *req)\n{\n\tCBC_WALK_START(req, TF_BLOCK_SIZE, TWOFISH_PARALLEL_BLOCKS);\n\tCBC_DEC_BLOCK(TWOFISH_PARALLEL_BLOCKS, twofish_cbc_dec_8way);\n\tCBC_DEC_BLOCK(3, twofish_dec_blk_cbc_3way);\n\tCBC_DEC_BLOCK(1, twofish_dec_blk);\n\tCBC_WALK_END();\n}\n\nstatic struct skcipher_alg twofish_algs[] = {\n\t{\n\t\t.base.cra_name\t\t= \"__ecb(twofish)\",\n\t\t.base.cra_driver_name\t= \"__ecb-twofish-avx\",\n\t\t.base.cra_priority\t= 400,\n\t\t.base.cra_flags\t\t= CRYPTO_ALG_INTERNAL,\n\t\t.base.cra_blocksize\t= TF_BLOCK_SIZE,\n\t\t.base.cra_ctxsize\t= sizeof(struct twofish_ctx),\n\t\t.base.cra_module\t= THIS_MODULE,\n\t\t.min_keysize\t\t= TF_MIN_KEY_SIZE,\n\t\t.max_keysize\t\t= TF_MAX_KEY_SIZE,\n\t\t.setkey\t\t\t= twofish_setkey_skcipher,\n\t\t.encrypt\t\t= ecb_encrypt,\n\t\t.decrypt\t\t= ecb_decrypt,\n\t}, {\n\t\t.base.cra_name\t\t= \"__cbc(twofish)\",\n\t\t.base.cra_driver_name\t= \"__cbc-twofish-avx\",\n\t\t.base.cra_priority\t= 400,\n\t\t.base.cra_flags\t\t= CRYPTO_ALG_INTERNAL,\n\t\t.base.cra_blocksize\t= TF_BLOCK_SIZE,\n\t\t.base.cra_ctxsize\t= sizeof(struct twofish_ctx),\n\t\t.base.cra_module\t= THIS_MODULE,\n\t\t.min_keysize\t\t= TF_MIN_KEY_SIZE,\n\t\t.max_keysize\t\t= TF_MAX_KEY_SIZE,\n\t\t.ivsize\t\t\t= TF_BLOCK_SIZE,\n\t\t.setkey\t\t\t= twofish_setkey_skcipher,\n\t\t.encrypt\t\t= cbc_encrypt,\n\t\t.decrypt\t\t= cbc_decrypt,\n\t},\n};\n\nstatic struct simd_skcipher_alg *twofish_simd_algs[ARRAY_SIZE(twofish_algs)];\n\nstatic int __init twofish_init(void)\n{\n\tconst char *feature_name;\n\n\tif (!cpu_has_xfeatures(XFEATURE_MASK_SSE | XFEATURE_MASK_YMM, &feature_name)) {\n\t\tpr_info(\"CPU feature '%s' is not supported.\\n\", feature_name);\n\t\treturn -ENODEV;\n\t}\n\n\treturn simd_register_skciphers_compat(twofish_algs,\n\t\t\t\t\t      ARRAY_SIZE(twofish_algs),\n\t\t\t\t\t      twofish_simd_algs);\n}\n\nstatic void __exit twofish_exit(void)\n{\n\tsimd_unregister_skciphers(twofish_algs, ARRAY_SIZE(twofish_algs),\n\t\t\t\t  twofish_simd_algs);\n}\n\nmodule_init(twofish_init);\nmodule_exit(twofish_exit);\n\nMODULE_DESCRIPTION(\"Twofish Cipher Algorithm, AVX optimized\");\nMODULE_LICENSE(\"GPL\");\nMODULE_ALIAS_CRYPTO(\"twofish\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}