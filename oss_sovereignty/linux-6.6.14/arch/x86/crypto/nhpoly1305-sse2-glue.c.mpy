{
  "module_name": "nhpoly1305-sse2-glue.c",
  "hash_id": "a36c088fc321b1022cdedf9c6ec26578fb895cf17098c726ed94c806baae0ebd",
  "original_prompt": "Ingested from linux-6.6.14/arch/x86/crypto/nhpoly1305-sse2-glue.c",
  "human_readable_source": "\n \n\n#include <crypto/internal/hash.h>\n#include <crypto/internal/simd.h>\n#include <crypto/nhpoly1305.h>\n#include <linux/module.h>\n#include <linux/sizes.h>\n#include <asm/simd.h>\n\nasmlinkage void nh_sse2(const u32 *key, const u8 *message, size_t message_len,\n\t\t\t__le64 hash[NH_NUM_PASSES]);\n\nstatic int nhpoly1305_sse2_update(struct shash_desc *desc,\n\t\t\t\t  const u8 *src, unsigned int srclen)\n{\n\tif (srclen < 64 || !crypto_simd_usable())\n\t\treturn crypto_nhpoly1305_update(desc, src, srclen);\n\n\tdo {\n\t\tunsigned int n = min_t(unsigned int, srclen, SZ_4K);\n\n\t\tkernel_fpu_begin();\n\t\tcrypto_nhpoly1305_update_helper(desc, src, n, nh_sse2);\n\t\tkernel_fpu_end();\n\t\tsrc += n;\n\t\tsrclen -= n;\n\t} while (srclen);\n\treturn 0;\n}\n\nstatic struct shash_alg nhpoly1305_alg = {\n\t.base.cra_name\t\t= \"nhpoly1305\",\n\t.base.cra_driver_name\t= \"nhpoly1305-sse2\",\n\t.base.cra_priority\t= 200,\n\t.base.cra_ctxsize\t= sizeof(struct nhpoly1305_key),\n\t.base.cra_module\t= THIS_MODULE,\n\t.digestsize\t\t= POLY1305_DIGEST_SIZE,\n\t.init\t\t\t= crypto_nhpoly1305_init,\n\t.update\t\t\t= nhpoly1305_sse2_update,\n\t.final\t\t\t= crypto_nhpoly1305_final,\n\t.setkey\t\t\t= crypto_nhpoly1305_setkey,\n\t.descsize\t\t= sizeof(struct nhpoly1305_state),\n};\n\nstatic int __init nhpoly1305_mod_init(void)\n{\n\tif (!boot_cpu_has(X86_FEATURE_XMM2))\n\t\treturn -ENODEV;\n\n\treturn crypto_register_shash(&nhpoly1305_alg);\n}\n\nstatic void __exit nhpoly1305_mod_exit(void)\n{\n\tcrypto_unregister_shash(&nhpoly1305_alg);\n}\n\nmodule_init(nhpoly1305_mod_init);\nmodule_exit(nhpoly1305_mod_exit);\n\nMODULE_DESCRIPTION(\"NHPoly1305 \u03b5-almost-\u2206-universal hash function (SSE2-accelerated)\");\nMODULE_LICENSE(\"GPL v2\");\nMODULE_AUTHOR(\"Eric Biggers <ebiggers@google.com>\");\nMODULE_ALIAS_CRYPTO(\"nhpoly1305\");\nMODULE_ALIAS_CRYPTO(\"nhpoly1305-sse2\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}