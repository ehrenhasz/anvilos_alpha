{
  "module_name": "sha256-avx2-asm.S",
  "hash_id": "ad78144ab9c53ff051bd05e6f45cfabf8ffb87731a35e0c00f060dfe69f23094",
  "original_prompt": "Ingested from linux-6.6.14/arch/x86/crypto/sha256-avx2-asm.S",
  "human_readable_source": "########################################################################\n# Implement fast SHA-256 with AVX2 instructions. (x86_64)\n#\n# Copyright (C) 2013 Intel Corporation.\n#\n# Authors:\n#     James Guilford <james.guilford@intel.com>\n#     Kirk Yap <kirk.s.yap@intel.com>\n#     Tim Chen <tim.c.chen@linux.intel.com>\n#\n# This software is available to you under a choice of one of two\n# licenses.  You may choose to be licensed under the terms of the GNU\n# General Public License (GPL) Version 2, available from the file\n# COPYING in the main directory of this source tree, or the\n# OpenIB.org BSD license below:\n#\n#     Redistribution and use in source and binary forms, with or\n#     without modification, are permitted provided that the following\n#     conditions are met:\n#\n#      - Redistributions of source code must retain the above\n#        copyright notice, this list of conditions and the following\n#        disclaimer.\n#\n#      - Redistributions in binary form must reproduce the above\n#        copyright notice, this list of conditions and the following\n#        disclaimer in the documentation and/or other materials\n#        provided with the distribution.\n#\n# THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\n# EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n# NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS\n# BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN\n# ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN\n# CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n# SOFTWARE.\n#\n########################################################################\n#\n# This code is described in an Intel White-Paper:\n# \"Fast SHA-256 Implementations on Intel Architecture Processors\"\n#\n# To find it, surf to http: \n# and search for that title.\n#\n########################################################################\n# This code schedules 2 blocks at a time, with 4 lanes per block\n########################################################################\n\n#include <linux/linkage.h>\n#include <linux/cfi_types.h>\n\n## assume buffers not aligned\n#define\tVMOVDQ vmovdqu\n\n################################ Define Macros\n\n# addm [mem], reg\n# Add reg to mem using reg-mem add and store\n.macro addm p1 p2\n\tadd\t\\p1, \\p2\n\tmov\t\\p2, \\p1\n.endm\n\n################################\n\nX0 = %ymm4\nX1 = %ymm5\nX2 = %ymm6\nX3 = %ymm7\n\n# XMM versions of above\nXWORD0 = %xmm4\nXWORD1 = %xmm5\nXWORD2 = %xmm6\nXWORD3 = %xmm7\n\nXTMP0 = %ymm0\nXTMP1 = %ymm1\nXTMP2 = %ymm2\nXTMP3 = %ymm3\nXTMP4 = %ymm8\nXFER  = %ymm9\nXTMP5 = %ymm11\n\nSHUF_00BA =\t%ymm10 # shuffle xBxA -> 00BA\nSHUF_DC00 =\t%ymm12 # shuffle xDxC -> DC00\nBYTE_FLIP_MASK = %ymm13\n\nX_BYTE_FLIP_MASK = %xmm13 # XMM version of BYTE_FLIP_MASK\n\nNUM_BLKS = %rdx\t# 3rd arg\nINP\t= %rsi  # 2nd arg\nCTX\t= %rdi\t# 1st arg\nc\t= %ecx\nd\t= %r8d\ne       = %edx\t# clobbers NUM_BLKS\ny3\t= %esi\t# clobbers INP\n\nSRND\t= CTX\t# SRND is same register as CTX\n\na = %eax\nb = %ebx\nf = %r9d\ng = %r10d\nh = %r11d\nold_h = %r11d\n\nT1 = %r12d\ny0 = %r13d\ny1 = %r14d\ny2 = %r15d\n\n\n_XFER_SIZE\t= 2*64*4\t# 2 blocks, 64 rounds, 4 bytes/round\n_XMM_SAVE_SIZE\t= 0\n_INP_END_SIZE\t= 8\n_INP_SIZE\t= 8\n_CTX_SIZE\t= 8\n\n_XFER\t\t= 0\n_XMM_SAVE\t= _XFER     + _XFER_SIZE\n_INP_END\t= _XMM_SAVE + _XMM_SAVE_SIZE\n_INP\t\t= _INP_END  + _INP_END_SIZE\n_CTX\t\t= _INP      + _INP_SIZE\nSTACK_SIZE\t= _CTX      + _CTX_SIZE\n\n# rotate_Xs\n# Rotate values of symbols X0...X3\n.macro rotate_Xs\n\tX_ = X0\n\tX0 = X1\n\tX1 = X2\n\tX2 = X3\n\tX3 = X_\n.endm\n\n# ROTATE_ARGS\n# Rotate values of symbols a...h\n.macro ROTATE_ARGS\n\told_h = h\n\tTMP_ = h\n\th = g\n\tg = f\n\tf = e\n\te = d\n\td = c\n\tc = b\n\tb = a\n\ta = TMP_\n.endm\n\n.macro FOUR_ROUNDS_AND_SCHED disp\n################################### RND N + 0 ############################\n\n\tmov\ta, y3\t\t# y3 = a                                # MAJA\n\trorx\t$25, e, y0\t# y0 = e >> 25\t\t\t\t# S1A\n\trorx\t$11, e, y1\t# y1 = e >> 11\t\t\t\t# S1B\n\n\taddl\t\\disp(%rsp, SRND), h\t\t# h = k + w + h         # --\n\tor\tc, y3\t\t# y3 = a|c                              # MAJA\n\tvpalignr $4, X2, X3, XTMP0 # XTMP0 = W[-7]\n\tmov\tf, y2\t\t# y2 = f                                # CH\n\trorx\t$13, a, T1\t# T1 = a >> 13\t\t\t\t# S0B\n\n\txor\ty1, y0\t\t# y0 = (e>>25) ^ (e>>11)\t\t# S1\n\txor\tg, y2\t\t# y2 = f^g                              # CH\n\tvpaddd\tX0, XTMP0, XTMP0 # XTMP0 = W[-7] + W[-16]# y1 = (e >> 6)# S1\n\trorx\t$6, e, y1\t# y1 = (e >> 6)\t\t\t\t# S1\n\n\tand\te, y2\t\t# y2 = (f^g)&e                          # CH\n\txor\ty1, y0\t\t# y0 = (e>>25) ^ (e>>11) ^ (e>>6)\t# S1\n\trorx\t$22, a, y1\t# y1 = a >> 22\t\t\t\t# S0A\n\tadd\th, d\t\t# d = k + w + h + d                     # --\n\n\tand\tb, y3\t\t# y3 = (a|c)&b                          # MAJA\n\tvpalignr $4, X0, X1, XTMP1\t# XTMP1 = W[-15]\n\txor\tT1, y1\t\t# y1 = (a>>22) ^ (a>>13)\t\t# S0\n\trorx\t$2, a, T1\t# T1 = (a >> 2)\t\t\t\t# S0\n\n\txor\tg, y2\t\t# y2 = CH = ((f^g)&e)^g                 # CH\n\tvpsrld\t$7, XTMP1, XTMP2\n\txor\tT1, y1\t\t# y1 = (a>>22) ^ (a>>13) ^ (a>>2)\t# S0\n\tmov\ta, T1\t\t# T1 = a                                # MAJB\n\tand\tc, T1\t\t# T1 = a&c                              # MAJB\n\n\tadd\ty0, y2\t\t# y2 = S1 + CH                          # --\n\tvpslld\t$(32-7), XTMP1, XTMP3\n\tor\tT1, y3\t\t# y3 = MAJ = (a|c)&b)|(a&c)             # MAJ\n\tadd\ty1, h\t\t# h = k + w + h + S0                    # --\n\n\tadd\ty2, d\t\t# d = k + w + h + d + S1 + CH = d + t1  # --\n\tvpor\tXTMP2, XTMP3, XTMP3\t# XTMP3 = W[-15] ror 7\n\n\tvpsrld\t$18, XTMP1, XTMP2\n\tadd\ty2, h\t\t# h = k + w + h + S0 + S1 + CH = t1 + S0# --\n\tadd\ty3, h\t\t# h = t1 + S0 + MAJ                     # --\n\n\n\tROTATE_ARGS\n\n################################### RND N + 1 ############################\n\n\tmov\ta, y3\t\t# y3 = a                                # MAJA\n\trorx\t$25, e, y0\t# y0 = e >> 25\t\t\t\t# S1A\n\trorx\t$11, e, y1\t# y1 = e >> 11\t\t\t\t# S1B\n\toffset = \\disp + 1*4\n\taddl\toffset(%rsp, SRND), h\t# h = k + w + h         # --\n\tor\tc, y3\t\t# y3 = a|c                              # MAJA\n\n\n\tvpsrld\t$3, XTMP1, XTMP4 # XTMP4 = W[-15] >> 3\n\tmov\tf, y2\t\t# y2 = f                                # CH\n\trorx\t$13, a, T1\t# T1 = a >> 13\t\t\t\t# S0B\n\txor\ty1, y0\t\t# y0 = (e>>25) ^ (e>>11)\t\t# S1\n\txor\tg, y2\t\t# y2 = f^g                              # CH\n\n\n\trorx\t$6, e, y1\t# y1 = (e >> 6)\t\t\t\t# S1\n\txor\ty1, y0\t\t# y0 = (e>>25) ^ (e>>11) ^ (e>>6)\t# S1\n\trorx\t$22, a, y1\t# y1 = a >> 22\t\t\t\t# S0A\n\tand\te, y2\t\t# y2 = (f^g)&e                          # CH\n\tadd\th, d\t\t# d = k + w + h + d                     # --\n\n\tvpslld\t$(32-18), XTMP1, XTMP1\n\tand\tb, y3\t\t# y3 = (a|c)&b                          # MAJA\n\txor\tT1, y1\t\t# y1 = (a>>22) ^ (a>>13)\t\t# S0\n\n\tvpxor\tXTMP1, XTMP3, XTMP3\n\trorx\t$2, a, T1\t# T1 = (a >> 2)\t\t\t\t# S0\n\txor\tg, y2\t\t# y2 = CH = ((f^g)&e)^g                 # CH\n\n\tvpxor\tXTMP2, XTMP3, XTMP3\t# XTMP3 = W[-15] ror 7 ^ W[-15] ror 18\n\txor\tT1, y1\t\t# y1 = (a>>22) ^ (a>>13) ^ (a>>2)\t# S0\n\tmov\ta, T1\t\t# T1 = a                                # MAJB\n\tand\tc, T1\t\t# T1 = a&c                              # MAJB\n\tadd\ty0, y2\t\t# y2 = S1 + CH                          # --\n\n\tvpxor\tXTMP4, XTMP3, XTMP1\t# XTMP1 = s0\n\tvpshufd\t$0b11111010, X3, XTMP2\t# XTMP2 = W[-2] {BBAA}\n\tor\tT1, y3\t\t# y3 = MAJ = (a|c)&b)|(a&c)             # MAJ\n\tadd\ty1, h\t\t# h = k + w + h + S0                    # --\n\n\tvpaddd\tXTMP1, XTMP0, XTMP0\t# XTMP0 = W[-16] + W[-7] + s0\n\tadd\ty2, d\t\t# d = k + w + h + d + S1 + CH = d + t1  # --\n\tadd\ty2, h\t\t# h = k + w + h + S0 + S1 + CH = t1 + S0# --\n\tadd\ty3, h\t\t# h = t1 + S0 + MAJ                     # --\n\n\tvpsrld\t$10, XTMP2, XTMP4 # XTMP4 = W[-2] >> 10 {BBAA}\n\n\n\tROTATE_ARGS\n\n################################### RND N + 2 ############################\n\n\tmov\ta, y3\t\t# y3 = a                                # MAJA\n\trorx\t$25, e, y0\t# y0 = e >> 25\t\t\t\t# S1A\n\toffset = \\disp + 2*4\n\taddl\toffset(%rsp, SRND), h\t# h = k + w + h         # --\n\n\tvpsrlq\t$19, XTMP2, XTMP3 # XTMP3 = W[-2] ror 19 {xBxA}\n\trorx\t$11, e, y1\t# y1 = e >> 11\t\t\t\t# S1B\n\tor\tc, y3\t\t# y3 = a|c                              # MAJA\n\tmov\tf, y2\t\t# y2 = f                                # CH\n\txor\tg, y2\t\t# y2 = f^g                              # CH\n\n\trorx\t$13, a, T1\t# T1 = a >> 13\t\t\t\t# S0B\n\txor\ty1, y0\t\t# y0 = (e>>25) ^ (e>>11)\t\t# S1\n\tvpsrlq\t$17, XTMP2, XTMP2\t# XTMP2 = W[-2] ror 17 {xBxA}\n\tand\te, y2\t\t# y2 = (f^g)&e                          # CH\n\n\trorx\t$6, e, y1\t# y1 = (e >> 6)\t\t\t\t# S1\n\tvpxor\tXTMP3, XTMP2, XTMP2\n\tadd\th, d\t\t# d = k + w + h + d                     # --\n\tand\tb, y3\t\t# y3 = (a|c)&b                          # MAJA\n\n\txor\ty1, y0\t\t# y0 = (e>>25) ^ (e>>11) ^ (e>>6)\t# S1\n\trorx\t$22, a, y1\t# y1 = a >> 22\t\t\t\t# S0A\n\tvpxor\tXTMP2, XTMP4, XTMP4\t# XTMP4 = s1 {xBxA}\n\txor\tg, y2\t\t# y2 = CH = ((f^g)&e)^g                 # CH\n\n\tvpshufb\tSHUF_00BA, XTMP4, XTMP4\t# XTMP4 = s1 {00BA}\n\txor\tT1, y1\t\t# y1 = (a>>22) ^ (a>>13)\t\t# S0\n\trorx\t$2, a ,T1\t# T1 = (a >> 2)\t\t\t\t# S0\n\tvpaddd\tXTMP4, XTMP0, XTMP0\t# XTMP0 = {..., ..., W[1], W[0]}\n\n\txor\tT1, y1\t\t# y1 = (a>>22) ^ (a>>13) ^ (a>>2)\t# S0\n\tmov\ta, T1\t\t# T1 = a                                # MAJB\n\tand\tc, T1\t\t# T1 = a&c                              # MAJB\n\tadd\ty0, y2\t\t# y2 = S1 + CH                          # --\n\tvpshufd\t$0b01010000, XTMP0, XTMP2\t# XTMP2 = W[-2] {DDCC}\n\n\tor\tT1, y3\t\t# y3 = MAJ = (a|c)&b)|(a&c)             # MAJ\n\tadd\ty1,h\t\t# h = k + w + h + S0                    # --\n\tadd\ty2,d\t\t# d = k + w + h + d + S1 + CH = d + t1  # --\n\tadd\ty2,h\t\t# h = k + w + h + S0 + S1 + CH = t1 + S0# --\n\n\tadd\ty3,h\t\t# h = t1 + S0 + MAJ                     # --\n\n\n\tROTATE_ARGS\n\n################################### RND N + 3 ############################\n\n\tmov\ta, y3\t\t# y3 = a                                # MAJA\n\trorx\t$25, e, y0\t# y0 = e >> 25\t\t\t\t# S1A\n\trorx\t$11, e, y1\t# y1 = e >> 11\t\t\t\t# S1B\n\toffset = \\disp + 3*4\n\taddl\toffset(%rsp, SRND), h\t# h = k + w + h         # --\n\tor\tc, y3\t\t# y3 = a|c                              # MAJA\n\n\n\tvpsrld\t$10, XTMP2, XTMP5\t# XTMP5 = W[-2] >> 10 {DDCC}\n\tmov\tf, y2\t\t# y2 = f                                # CH\n\trorx\t$13, a, T1\t# T1 = a >> 13\t\t\t\t# S0B\n\txor\ty1, y0\t\t# y0 = (e>>25) ^ (e>>11)\t\t# S1\n\txor\tg, y2\t\t# y2 = f^g                              # CH\n\n\n\tvpsrlq\t$19, XTMP2, XTMP3\t# XTMP3 = W[-2] ror 19 {xDxC}\n\trorx\t$6, e, y1\t# y1 = (e >> 6)\t\t\t\t# S1\n\tand\te, y2\t\t# y2 = (f^g)&e                          # CH\n\tadd\th, d\t\t# d = k + w + h + d                     # --\n\tand\tb, y3\t\t# y3 = (a|c)&b                          # MAJA\n\n\tvpsrlq\t$17, XTMP2, XTMP2\t# XTMP2 = W[-2] ror 17 {xDxC}\n\txor\ty1, y0\t\t# y0 = (e>>25) ^ (e>>11) ^ (e>>6)\t# S1\n\txor\tg, y2\t\t# y2 = CH = ((f^g)&e)^g                 # CH\n\n\tvpxor\tXTMP3, XTMP2, XTMP2\n\trorx\t$22, a, y1\t# y1 = a >> 22\t\t\t\t# S0A\n\tadd\ty0, y2\t\t# y2 = S1 + CH                          # --\n\n\tvpxor\tXTMP2, XTMP5, XTMP5\t# XTMP5 = s1 {xDxC}\n\txor\tT1, y1\t\t# y1 = (a>>22) ^ (a>>13)\t\t# S0\n\tadd\ty2, d\t\t# d = k + w + h + d + S1 + CH = d + t1  # --\n\n\trorx\t$2, a, T1\t# T1 = (a >> 2)\t\t\t\t# S0\n\tvpshufb\tSHUF_DC00, XTMP5, XTMP5\t# XTMP5 = s1 {DC00}\n\n\tvpaddd\tXTMP0, XTMP5, X0\t# X0 = {W[3], W[2], W[1], W[0]}\n\txor\tT1, y1\t\t# y1 = (a>>22) ^ (a>>13) ^ (a>>2)\t# S0\n\tmov\ta, T1\t\t# T1 = a                                # MAJB\n\tand\tc, T1\t\t# T1 = a&c                              # MAJB\n\tor\tT1, y3\t\t# y3 = MAJ = (a|c)&b)|(a&c)             # MAJ\n\n\tadd\ty1, h\t\t# h = k + w + h + S0                    # --\n\tadd\ty2, h\t\t# h = k + w + h + S0 + S1 + CH = t1 + S0# --\n\tadd\ty3, h\t\t# h = t1 + S0 + MAJ                     # --\n\n\tROTATE_ARGS\n\trotate_Xs\n.endm\n\n.macro DO_4ROUNDS disp\n################################### RND N + 0 ###########################\n\n\tmov\tf, y2\t\t# y2 = f                                # CH\n\trorx\t$25, e, y0\t# y0 = e >> 25\t\t\t\t# S1A\n\trorx\t$11, e, y1\t# y1 = e >> 11\t\t\t\t# S1B\n\txor\tg, y2\t\t# y2 = f^g                              # CH\n\n\txor\ty1, y0\t\t# y0 = (e>>25) ^ (e>>11)\t\t# S1\n\trorx\t$6, e, y1\t# y1 = (e >> 6)\t\t\t\t# S1\n\tand\te, y2\t\t# y2 = (f^g)&e                          # CH\n\n\txor\ty1, y0\t\t# y0 = (e>>25) ^ (e>>11) ^ (e>>6)\t# S1\n\trorx\t$13, a, T1\t# T1 = a >> 13\t\t\t\t# S0B\n\txor\tg, y2\t\t# y2 = CH = ((f^g)&e)^g                 # CH\n\trorx\t$22, a, y1\t# y1 = a >> 22\t\t\t\t# S0A\n\tmov\ta, y3\t\t# y3 = a                                # MAJA\n\n\txor\tT1, y1\t\t# y1 = (a>>22) ^ (a>>13)\t\t# S0\n\trorx\t$2, a, T1\t# T1 = (a >> 2)\t\t\t\t# S0\n\taddl\t\\disp(%rsp, SRND), h\t\t# h = k + w + h # --\n\tor\tc, y3\t\t# y3 = a|c                              # MAJA\n\n\txor\tT1, y1\t\t# y1 = (a>>22) ^ (a>>13) ^ (a>>2)\t# S0\n\tmov\ta, T1\t\t# T1 = a                                # MAJB\n\tand\tb, y3\t\t# y3 = (a|c)&b                          # MAJA\n\tand\tc, T1\t\t# T1 = a&c                              # MAJB\n\tadd\ty0, y2\t\t# y2 = S1 + CH                          # --\n\n\n\tadd\th, d\t\t# d = k + w + h + d                     # --\n\tor\tT1, y3\t\t# y3 = MAJ = (a|c)&b)|(a&c)             # MAJ\n\tadd\ty1, h\t\t# h = k + w + h + S0                    # --\n\tadd\ty2, d\t\t# d = k + w + h + d + S1 + CH = d + t1  # --\n\n\tROTATE_ARGS\n\n################################### RND N + 1 ###########################\n\n\tadd\ty2, old_h\t# h = k + w + h + S0 + S1 + CH = t1 + S0# --\n\tmov\tf, y2\t\t# y2 = f                                # CH\n\trorx\t$25, e, y0\t# y0 = e >> 25\t\t\t\t# S1A\n\trorx\t$11, e, y1\t# y1 = e >> 11\t\t\t\t# S1B\n\txor\tg, y2\t\t# y2 = f^g                              # CH\n\n\txor\ty1, y0\t\t# y0 = (e>>25) ^ (e>>11)\t\t# S1\n\trorx\t$6, e, y1\t# y1 = (e >> 6)\t\t\t\t# S1\n\tand\te, y2\t\t# y2 = (f^g)&e                          # CH\n\tadd\ty3, old_h\t# h = t1 + S0 + MAJ                     # --\n\n\txor\ty1, y0\t\t# y0 = (e>>25) ^ (e>>11) ^ (e>>6)\t# S1\n\trorx\t$13, a, T1\t# T1 = a >> 13\t\t\t\t# S0B\n\txor\tg, y2\t\t# y2 = CH = ((f^g)&e)^g                 # CH\n\trorx\t$22, a, y1\t# y1 = a >> 22\t\t\t\t# S0A\n\tmov\ta, y3\t\t# y3 = a                                # MAJA\n\n\txor\tT1, y1\t\t# y1 = (a>>22) ^ (a>>13)\t\t# S0\n\trorx\t$2, a, T1\t# T1 = (a >> 2)\t\t\t\t# S0\n\toffset = 4*1 + \\disp\n\taddl\toffset(%rsp, SRND), h\t\t# h = k + w + h # --\n\tor\tc, y3\t\t# y3 = a|c                              # MAJA\n\n\txor\tT1, y1\t\t# y1 = (a>>22) ^ (a>>13) ^ (a>>2)\t# S0\n\tmov\ta, T1\t\t# T1 = a                                # MAJB\n\tand\tb, y3\t\t# y3 = (a|c)&b                          # MAJA\n\tand\tc, T1\t\t# T1 = a&c                              # MAJB\n\tadd\ty0, y2\t\t# y2 = S1 + CH                          # --\n\n\n\tadd\th, d\t\t# d = k + w + h + d                     # --\n\tor\tT1, y3\t\t# y3 = MAJ = (a|c)&b)|(a&c)             # MAJ\n\tadd\ty1, h\t\t# h = k + w + h + S0                    # --\n\n\tadd\ty2, d\t\t# d = k + w + h + d + S1 + CH = d + t1  # --\n\n\tROTATE_ARGS\n\n################################### RND N + 2 ##############################\n\n\tadd\ty2, old_h\t# h = k + w + h + S0 + S1 + CH = t1 + S0# --\n\tmov\tf, y2\t\t# y2 = f                                # CH\n\trorx\t$25, e, y0\t# y0 = e >> 25\t\t\t\t# S1A\n\trorx\t$11, e, y1\t# y1 = e >> 11\t\t\t\t# S1B\n\txor\tg, y2\t\t# y2 = f^g                              # CH\n\n\txor\ty1, y0\t\t# y0 = (e>>25) ^ (e>>11)\t\t# S1\n\trorx\t$6, e, y1\t# y1 = (e >> 6)\t\t\t\t# S1\n\tand\te, y2\t\t# y2 = (f^g)&e                          # CH\n\tadd\ty3, old_h\t# h = t1 + S0 + MAJ                     # --\n\n\txor\ty1, y0\t\t# y0 = (e>>25) ^ (e>>11) ^ (e>>6)\t# S1\n\trorx\t$13, a, T1\t# T1 = a >> 13\t\t\t\t# S0B\n\txor\tg, y2\t\t# y2 = CH = ((f^g)&e)^g                 # CH\n\trorx\t$22, a, y1\t# y1 = a >> 22\t\t\t\t# S0A\n\tmov\ta, y3\t\t# y3 = a                                # MAJA\n\n\txor\tT1, y1\t\t# y1 = (a>>22) ^ (a>>13)\t\t# S0\n\trorx\t$2, a, T1\t# T1 = (a >> 2)\t\t\t\t# S0\n\toffset = 4*2 + \\disp\n\taddl\toffset(%rsp, SRND), h\t\t# h = k + w + h # --\n\tor\tc, y3\t\t# y3 = a|c                              # MAJA\n\n\txor\tT1, y1\t\t# y1 = (a>>22) ^ (a>>13) ^ (a>>2)\t# S0\n\tmov\ta, T1\t\t# T1 = a                                # MAJB\n\tand\tb, y3\t\t# y3 = (a|c)&b                          # MAJA\n\tand\tc, T1\t\t# T1 = a&c                              # MAJB\n\tadd\ty0, y2\t\t# y2 = S1 + CH                          # --\n\n\n\tadd\th, d\t\t# d = k + w + h + d                     # --\n\tor\tT1, y3\t\t# y3 = MAJ = (a|c)&b)|(a&c)             # MAJ\n\tadd\ty1, h\t\t# h = k + w + h + S0                    # --\n\n\tadd\ty2, d\t\t# d = k + w + h + d + S1 + CH = d + t1  # --\n\n\tROTATE_ARGS\n\n################################### RND N + 3 ###########################\n\n\tadd\ty2, old_h\t# h = k + w + h + S0 + S1 + CH = t1 + S0# --\n\tmov\tf, y2\t\t# y2 = f                                # CH\n\trorx\t$25, e, y0\t# y0 = e >> 25\t\t\t\t# S1A\n\trorx\t$11, e, y1\t# y1 = e >> 11\t\t\t\t# S1B\n\txor\tg, y2\t\t# y2 = f^g                              # CH\n\n\txor\ty1, y0\t\t# y0 = (e>>25) ^ (e>>11)\t\t# S1\n\trorx\t$6, e, y1\t# y1 = (e >> 6)\t\t\t\t# S1\n\tand\te, y2\t\t# y2 = (f^g)&e                          # CH\n\tadd\ty3, old_h\t# h = t1 + S0 + MAJ                     # --\n\n\txor\ty1, y0\t\t# y0 = (e>>25) ^ (e>>11) ^ (e>>6)\t# S1\n\trorx\t$13, a, T1\t# T1 = a >> 13\t\t\t\t# S0B\n\txor\tg, y2\t\t# y2 = CH = ((f^g)&e)^g                 # CH\n\trorx\t$22, a, y1\t# y1 = a >> 22\t\t\t\t# S0A\n\tmov\ta, y3\t\t# y3 = a                                # MAJA\n\n\txor\tT1, y1\t\t# y1 = (a>>22) ^ (a>>13)\t\t# S0\n\trorx\t$2, a, T1\t# T1 = (a >> 2)\t\t\t\t# S0\n\toffset = 4*3 + \\disp\n\taddl\toffset(%rsp, SRND), h\t\t# h = k + w + h # --\n\tor\tc, y3\t\t# y3 = a|c                              # MAJA\n\n\txor\tT1, y1\t\t# y1 = (a>>22) ^ (a>>13) ^ (a>>2)\t# S0\n\tmov\ta, T1\t\t# T1 = a                                # MAJB\n\tand\tb, y3\t\t# y3 = (a|c)&b                          # MAJA\n\tand\tc, T1\t\t# T1 = a&c                              # MAJB\n\tadd\ty0, y2\t\t# y2 = S1 + CH                          # --\n\n\n\tadd\th, d\t\t# d = k + w + h + d                     # --\n\tor\tT1, y3\t\t# y3 = MAJ = (a|c)&b)|(a&c)             # MAJ\n\tadd\ty1, h\t\t# h = k + w + h + S0                    # --\n\n\tadd\ty2, d\t\t# d = k + w + h + d + S1 + CH = d + t1  # --\n\n\n\tadd\ty2, h\t\t# h = k + w + h + S0 + S1 + CH = t1 + S0# --\n\n\tadd\ty3, h\t\t# h = t1 + S0 + MAJ                     # --\n\n\tROTATE_ARGS\n\n.endm\n\n########################################################################\n## void sha256_transform_rorx(struct sha256_state *state, const u8 *data, int blocks)\n## arg 1 : pointer to state\n## arg 2 : pointer to input data\n## arg 3 : Num blocks\n########################################################################\n.text\nSYM_TYPED_FUNC_START(sha256_transform_rorx)\n\tpushq\t%rbx\n\tpushq\t%r12\n\tpushq\t%r13\n\tpushq\t%r14\n\tpushq\t%r15\n\n\tpush\t%rbp\n\tmov\t%rsp, %rbp\n\n\tsubq\t$STACK_SIZE, %rsp\n\tand\t$-32, %rsp\t# align rsp to 32 byte boundary\n\n\tshl\t$6, NUM_BLKS\t# convert to bytes\n\tjz\t.Ldone_hash\n\tlea\t-64(INP, NUM_BLKS), NUM_BLKS # pointer to last block\n\tmov\tNUM_BLKS, _INP_END(%rsp)\n\n\tcmp\tNUM_BLKS, INP\n\tje\t.Lonly_one_block\n\n\t## load initial digest\n\tmov\t(CTX), a\n\tmov\t4*1(CTX), b\n\tmov\t4*2(CTX), c\n\tmov\t4*3(CTX), d\n\tmov\t4*4(CTX), e\n\tmov\t4*5(CTX), f\n\tmov\t4*6(CTX), g\n\tmov\t4*7(CTX), h\n\n\tvmovdqa  PSHUFFLE_BYTE_FLIP_MASK(%rip), BYTE_FLIP_MASK\n\tvmovdqa  _SHUF_00BA(%rip), SHUF_00BA\n\tvmovdqa  _SHUF_DC00(%rip), SHUF_DC00\n\n\tmov\tCTX, _CTX(%rsp)\n\n.Lloop0:\n\t## Load first 16 dwords from two blocks\n\tVMOVDQ\t0*32(INP),XTMP0\n\tVMOVDQ\t1*32(INP),XTMP1\n\tVMOVDQ\t2*32(INP),XTMP2\n\tVMOVDQ\t3*32(INP),XTMP3\n\n\t## byte swap data\n\tvpshufb\tBYTE_FLIP_MASK, XTMP0, XTMP0\n\tvpshufb\tBYTE_FLIP_MASK, XTMP1, XTMP1\n\tvpshufb\tBYTE_FLIP_MASK, XTMP2, XTMP2\n\tvpshufb\tBYTE_FLIP_MASK, XTMP3, XTMP3\n\n\t## transpose data into high/low halves\n\tvperm2i128\t$0x20, XTMP2, XTMP0, X0\n\tvperm2i128\t$0x31, XTMP2, XTMP0, X1\n\tvperm2i128\t$0x20, XTMP3, XTMP1, X2\n\tvperm2i128\t$0x31, XTMP3, XTMP1, X3\n\n.Llast_block_enter:\n\tadd\t$64, INP\n\tmov\tINP, _INP(%rsp)\n\n\t## schedule 48 input dwords, by doing 3 rounds of 12 each\n\txor\tSRND, SRND\n\n.align 16\n.Lloop1:\n\tleaq\tK256+0*32(%rip), INP\t\t## reuse INP as scratch reg\n\tvpaddd\t(INP, SRND), X0, XFER\n\tvmovdqa XFER, 0*32+_XFER(%rsp, SRND)\n\tFOUR_ROUNDS_AND_SCHED\t_XFER + 0*32\n\n\tleaq\tK256+1*32(%rip), INP\n\tvpaddd\t(INP, SRND), X0, XFER\n\tvmovdqa XFER, 1*32+_XFER(%rsp, SRND)\n\tFOUR_ROUNDS_AND_SCHED\t_XFER + 1*32\n\n\tleaq\tK256+2*32(%rip), INP\n\tvpaddd\t(INP, SRND), X0, XFER\n\tvmovdqa XFER, 2*32+_XFER(%rsp, SRND)\n\tFOUR_ROUNDS_AND_SCHED\t_XFER + 2*32\n\n\tleaq\tK256+3*32(%rip), INP\n\tvpaddd\t(INP, SRND), X0, XFER\n\tvmovdqa XFER, 3*32+_XFER(%rsp, SRND)\n\tFOUR_ROUNDS_AND_SCHED\t_XFER + 3*32\n\n\tadd\t$4*32, SRND\n\tcmp\t$3*4*32, SRND\n\tjb\t.Lloop1\n\n.Lloop2:\n\t## Do last 16 rounds with no scheduling\n\tleaq\tK256+0*32(%rip), INP\n\tvpaddd\t(INP, SRND), X0, XFER\n\tvmovdqa XFER, 0*32+_XFER(%rsp, SRND)\n\tDO_4ROUNDS\t_XFER + 0*32\n\n\tleaq\tK256+1*32(%rip), INP\n\tvpaddd\t(INP, SRND), X1, XFER\n\tvmovdqa XFER, 1*32+_XFER(%rsp, SRND)\n\tDO_4ROUNDS\t_XFER + 1*32\n\tadd\t$2*32, SRND\n\n\tvmovdqa\tX2, X0\n\tvmovdqa\tX3, X1\n\n\tcmp\t$4*4*32, SRND\n\tjb\t.Lloop2\n\n\tmov\t_CTX(%rsp), CTX\n\tmov\t_INP(%rsp), INP\n\n\taddm    (4*0)(CTX),a\n\taddm    (4*1)(CTX),b\n\taddm    (4*2)(CTX),c\n\taddm    (4*3)(CTX),d\n\taddm    (4*4)(CTX),e\n\taddm    (4*5)(CTX),f\n\taddm    (4*6)(CTX),g\n\taddm    (4*7)(CTX),h\n\n\tcmp\t_INP_END(%rsp), INP\n\tja\t.Ldone_hash\n\n\t#### Do second block using previously scheduled results\n\txor\tSRND, SRND\n.align 16\n.Lloop3:\n\tDO_4ROUNDS\t _XFER + 0*32 + 16\n\tDO_4ROUNDS\t _XFER + 1*32 + 16\n\tadd\t$2*32, SRND\n\tcmp\t$4*4*32, SRND\n\tjb\t.Lloop3\n\n\tmov\t_CTX(%rsp), CTX\n\tmov\t_INP(%rsp), INP\n\tadd\t$64, INP\n\n\taddm    (4*0)(CTX),a\n\taddm    (4*1)(CTX),b\n\taddm    (4*2)(CTX),c\n\taddm    (4*3)(CTX),d\n\taddm    (4*4)(CTX),e\n\taddm    (4*5)(CTX),f\n\taddm    (4*6)(CTX),g\n\taddm    (4*7)(CTX),h\n\n\tcmp\t_INP_END(%rsp), INP\n\tjb\t.Lloop0\n\tja\t.Ldone_hash\n\n.Ldo_last_block:\n\tVMOVDQ\t0*16(INP),XWORD0\n\tVMOVDQ\t1*16(INP),XWORD1\n\tVMOVDQ\t2*16(INP),XWORD2\n\tVMOVDQ\t3*16(INP),XWORD3\n\n\tvpshufb\tX_BYTE_FLIP_MASK, XWORD0, XWORD0\n\tvpshufb\tX_BYTE_FLIP_MASK, XWORD1, XWORD1\n\tvpshufb\tX_BYTE_FLIP_MASK, XWORD2, XWORD2\n\tvpshufb\tX_BYTE_FLIP_MASK, XWORD3, XWORD3\n\n\tjmp\t.Llast_block_enter\n\n.Lonly_one_block:\n\n\t## load initial digest\n\tmov\t(4*0)(CTX),a\n\tmov\t(4*1)(CTX),b\n\tmov\t(4*2)(CTX),c\n\tmov\t(4*3)(CTX),d\n\tmov\t(4*4)(CTX),e\n\tmov\t(4*5)(CTX),f\n\tmov\t(4*6)(CTX),g\n\tmov\t(4*7)(CTX),h\n\n\tvmovdqa\tPSHUFFLE_BYTE_FLIP_MASK(%rip), BYTE_FLIP_MASK\n\tvmovdqa\t_SHUF_00BA(%rip), SHUF_00BA\n\tvmovdqa\t_SHUF_DC00(%rip), SHUF_DC00\n\n\tmov\tCTX, _CTX(%rsp)\n\tjmp\t.Ldo_last_block\n\n.Ldone_hash:\n\n\tmov\t%rbp, %rsp\n\tpop\t%rbp\n\n\tpopq\t%r15\n\tpopq\t%r14\n\tpopq\t%r13\n\tpopq\t%r12\n\tpopq\t%rbx\n\tRET\nSYM_FUNC_END(sha256_transform_rorx)\n\n.section\t.rodata.cst512.K256, \"aM\", @progbits, 512\n.align 64\nK256:\n\t.long\t0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5\n\t.long\t0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5\n\t.long\t0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5\n\t.long\t0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5\n\t.long\t0xd807aa98,0x12835b01,0x243185be,0x550c7dc3\n\t.long\t0xd807aa98,0x12835b01,0x243185be,0x550c7dc3\n\t.long\t0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174\n\t.long\t0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174\n\t.long\t0xe49b69c1,0xefbe4786,0x0fc19dc6,0x240ca1cc\n\t.long\t0xe49b69c1,0xefbe4786,0x0fc19dc6,0x240ca1cc\n\t.long\t0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da\n\t.long\t0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da\n\t.long\t0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7\n\t.long\t0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7\n\t.long\t0xc6e00bf3,0xd5a79147,0x06ca6351,0x14292967\n\t.long\t0xc6e00bf3,0xd5a79147,0x06ca6351,0x14292967\n\t.long\t0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13\n\t.long\t0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13\n\t.long\t0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85\n\t.long\t0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85\n\t.long\t0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3\n\t.long\t0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3\n\t.long\t0xd192e819,0xd6990624,0xf40e3585,0x106aa070\n\t.long\t0xd192e819,0xd6990624,0xf40e3585,0x106aa070\n\t.long\t0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5\n\t.long\t0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5\n\t.long\t0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3\n\t.long\t0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3\n\t.long\t0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208\n\t.long\t0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208\n\t.long\t0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2\n\t.long\t0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2\n\n.section\t.rodata.cst32.PSHUFFLE_BYTE_FLIP_MASK, \"aM\", @progbits, 32\n.align 32\nPSHUFFLE_BYTE_FLIP_MASK:\n\t.octa 0x0c0d0e0f08090a0b0405060700010203,0x0c0d0e0f08090a0b0405060700010203\n\n# shuffle xBxA -> 00BA\n.section\t.rodata.cst32._SHUF_00BA, \"aM\", @progbits, 32\n.align 32\n_SHUF_00BA:\n\t.octa 0xFFFFFFFFFFFFFFFF0b0a090803020100,0xFFFFFFFFFFFFFFFF0b0a090803020100\n\n# shuffle xDxC -> DC00\n.section\t.rodata.cst32._SHUF_DC00, \"aM\", @progbits, 32\n.align 32\n_SHUF_DC00:\n\t.octa 0x0b0a090803020100FFFFFFFFFFFFFFFF,0x0b0a090803020100FFFFFFFFFFFFFFFF\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}