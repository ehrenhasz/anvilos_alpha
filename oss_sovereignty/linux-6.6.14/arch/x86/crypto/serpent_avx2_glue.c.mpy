{
  "module_name": "serpent_avx2_glue.c",
  "hash_id": "b15f5f88ff1fbbda02f0787f9dc2d09d08dc980bf81390608f2775655ac00017",
  "original_prompt": "Ingested from linux-6.6.14/arch/x86/crypto/serpent_avx2_glue.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/types.h>\n#include <linux/crypto.h>\n#include <linux/err.h>\n#include <crypto/algapi.h>\n#include <crypto/internal/simd.h>\n#include <crypto/serpent.h>\n\n#include \"serpent-avx.h\"\n#include \"ecb_cbc_helpers.h\"\n\n#define SERPENT_AVX2_PARALLEL_BLOCKS 16\n\n \nasmlinkage void serpent_ecb_enc_16way(const void *ctx, u8 *dst, const u8 *src);\nasmlinkage void serpent_ecb_dec_16way(const void *ctx, u8 *dst, const u8 *src);\nasmlinkage void serpent_cbc_dec_16way(const void *ctx, u8 *dst, const u8 *src);\n\nstatic int serpent_setkey_skcipher(struct crypto_skcipher *tfm,\n\t\t\t\t   const u8 *key, unsigned int keylen)\n{\n\treturn __serpent_setkey(crypto_skcipher_ctx(tfm), key, keylen);\n}\n\nstatic int ecb_encrypt(struct skcipher_request *req)\n{\n\tECB_WALK_START(req, SERPENT_BLOCK_SIZE, SERPENT_PARALLEL_BLOCKS);\n\tECB_BLOCK(SERPENT_AVX2_PARALLEL_BLOCKS, serpent_ecb_enc_16way);\n\tECB_BLOCK(SERPENT_PARALLEL_BLOCKS, serpent_ecb_enc_8way_avx);\n\tECB_BLOCK(1, __serpent_encrypt);\n\tECB_WALK_END();\n}\n\nstatic int ecb_decrypt(struct skcipher_request *req)\n{\n\tECB_WALK_START(req, SERPENT_BLOCK_SIZE, SERPENT_PARALLEL_BLOCKS);\n\tECB_BLOCK(SERPENT_AVX2_PARALLEL_BLOCKS, serpent_ecb_dec_16way);\n\tECB_BLOCK(SERPENT_PARALLEL_BLOCKS, serpent_ecb_dec_8way_avx);\n\tECB_BLOCK(1, __serpent_decrypt);\n\tECB_WALK_END();\n}\n\nstatic int cbc_encrypt(struct skcipher_request *req)\n{\n\tCBC_WALK_START(req, SERPENT_BLOCK_SIZE, -1);\n\tCBC_ENC_BLOCK(__serpent_encrypt);\n\tCBC_WALK_END();\n}\n\nstatic int cbc_decrypt(struct skcipher_request *req)\n{\n\tCBC_WALK_START(req, SERPENT_BLOCK_SIZE, SERPENT_PARALLEL_BLOCKS);\n\tCBC_DEC_BLOCK(SERPENT_AVX2_PARALLEL_BLOCKS, serpent_cbc_dec_16way);\n\tCBC_DEC_BLOCK(SERPENT_PARALLEL_BLOCKS, serpent_cbc_dec_8way_avx);\n\tCBC_DEC_BLOCK(1, __serpent_decrypt);\n\tCBC_WALK_END();\n}\n\nstatic struct skcipher_alg serpent_algs[] = {\n\t{\n\t\t.base.cra_name\t\t= \"__ecb(serpent)\",\n\t\t.base.cra_driver_name\t= \"__ecb-serpent-avx2\",\n\t\t.base.cra_priority\t= 600,\n\t\t.base.cra_flags\t\t= CRYPTO_ALG_INTERNAL,\n\t\t.base.cra_blocksize\t= SERPENT_BLOCK_SIZE,\n\t\t.base.cra_ctxsize\t= sizeof(struct serpent_ctx),\n\t\t.base.cra_module\t= THIS_MODULE,\n\t\t.min_keysize\t\t= SERPENT_MIN_KEY_SIZE,\n\t\t.max_keysize\t\t= SERPENT_MAX_KEY_SIZE,\n\t\t.setkey\t\t\t= serpent_setkey_skcipher,\n\t\t.encrypt\t\t= ecb_encrypt,\n\t\t.decrypt\t\t= ecb_decrypt,\n\t}, {\n\t\t.base.cra_name\t\t= \"__cbc(serpent)\",\n\t\t.base.cra_driver_name\t= \"__cbc-serpent-avx2\",\n\t\t.base.cra_priority\t= 600,\n\t\t.base.cra_flags\t\t= CRYPTO_ALG_INTERNAL,\n\t\t.base.cra_blocksize\t= SERPENT_BLOCK_SIZE,\n\t\t.base.cra_ctxsize\t= sizeof(struct serpent_ctx),\n\t\t.base.cra_module\t= THIS_MODULE,\n\t\t.min_keysize\t\t= SERPENT_MIN_KEY_SIZE,\n\t\t.max_keysize\t\t= SERPENT_MAX_KEY_SIZE,\n\t\t.ivsize\t\t\t= SERPENT_BLOCK_SIZE,\n\t\t.setkey\t\t\t= serpent_setkey_skcipher,\n\t\t.encrypt\t\t= cbc_encrypt,\n\t\t.decrypt\t\t= cbc_decrypt,\n\t},\n};\n\nstatic struct simd_skcipher_alg *serpent_simd_algs[ARRAY_SIZE(serpent_algs)];\n\nstatic int __init serpent_avx2_init(void)\n{\n\tconst char *feature_name;\n\n\tif (!boot_cpu_has(X86_FEATURE_AVX2) || !boot_cpu_has(X86_FEATURE_OSXSAVE)) {\n\t\tpr_info(\"AVX2 instructions are not detected.\\n\");\n\t\treturn -ENODEV;\n\t}\n\tif (!cpu_has_xfeatures(XFEATURE_MASK_SSE | XFEATURE_MASK_YMM,\n\t\t\t\t&feature_name)) {\n\t\tpr_info(\"CPU feature '%s' is not supported.\\n\", feature_name);\n\t\treturn -ENODEV;\n\t}\n\n\treturn simd_register_skciphers_compat(serpent_algs,\n\t\t\t\t\t      ARRAY_SIZE(serpent_algs),\n\t\t\t\t\t      serpent_simd_algs);\n}\n\nstatic void __exit serpent_avx2_fini(void)\n{\n\tsimd_unregister_skciphers(serpent_algs, ARRAY_SIZE(serpent_algs),\n\t\t\t\t  serpent_simd_algs);\n}\n\nmodule_init(serpent_avx2_init);\nmodule_exit(serpent_avx2_fini);\n\nMODULE_LICENSE(\"GPL\");\nMODULE_DESCRIPTION(\"Serpent Cipher Algorithm, AVX2 optimized\");\nMODULE_ALIAS_CRYPTO(\"serpent\");\nMODULE_ALIAS_CRYPTO(\"serpent-asm\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}