{
  "module_name": "twofish-avx-x86_64-asm_64.S",
  "hash_id": "f775ee0593e593c516ecf4e3227540c2d5510966a3de538f2f2699fe6ab44b84",
  "original_prompt": "Ingested from linux-6.6.14/arch/x86/crypto/twofish-avx-x86_64-asm_64.S",
  "human_readable_source": " \n \n\n#include <linux/linkage.h>\n#include <asm/frame.h>\n#include \"glue_helper-asm-avx.S\"\n\n.file \"twofish-avx-x86_64-asm_64.S\"\n\n.section\t.rodata.cst16.bswap128_mask, \"aM\", @progbits, 16\n.align 16\n.Lbswap128_mask:\n\t.byte 15, 14, 13, 12, 11, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0\n\n.text\n\n \n#define s0\t0\n#define s1\t1024\n#define s2\t2048\n#define s3\t3072\n#define w\t4096\n#define k\t4128\n\n \n#define CTX %rdi\n\n#define RA1 %xmm0\n#define RB1 %xmm1\n#define RC1 %xmm2\n#define RD1 %xmm3\n\n#define RA2 %xmm4\n#define RB2 %xmm5\n#define RC2 %xmm6\n#define RD2 %xmm7\n\n#define RX0 %xmm8\n#define RY0 %xmm9\n\n#define RX1 %xmm10\n#define RY1 %xmm11\n\n#define RK1 %xmm12\n#define RK2 %xmm13\n\n#define RT %xmm14\n#define RR %xmm15\n\n#define RID1  %r13\n#define RID1d %r13d\n#define RID2  %rsi\n#define RID2d %esi\n\n#define RGI1   %rdx\n#define RGI1bl %dl\n#define RGI1bh %dh\n#define RGI2   %rcx\n#define RGI2bl %cl\n#define RGI2bh %ch\n\n#define RGI3   %rax\n#define RGI3bl %al\n#define RGI3bh %ah\n#define RGI4   %rbx\n#define RGI4bl %bl\n#define RGI4bh %bh\n\n#define RGS1  %r8\n#define RGS1d %r8d\n#define RGS2  %r9\n#define RGS2d %r9d\n#define RGS3  %r10\n#define RGS3d %r10d\n\n\n#define lookup_32bit(t0, t1, t2, t3, src, dst, interleave_op, il_reg) \\\n\tmovzbl\t\tsrc ## bl,        RID1d;     \\\n\tmovzbl\t\tsrc ## bh,        RID2d;     \\\n\tshrq $16,\tsrc;                         \\\n\tmovl\t\tt0(CTX, RID1, 4), dst ## d;  \\\n\tmovl\t\tt1(CTX, RID2, 4), RID2d;     \\\n\tmovzbl\t\tsrc ## bl,        RID1d;     \\\n\txorl\t\tRID2d,            dst ## d;  \\\n\tmovzbl\t\tsrc ## bh,        RID2d;     \\\n\tinterleave_op(il_reg);\t\t\t     \\\n\txorl\t\tt2(CTX, RID1, 4), dst ## d;  \\\n\txorl\t\tt3(CTX, RID2, 4), dst ## d;\n\n#define dummy(d)  \n\n#define shr_next(reg) \\\n\tshrq $16,\treg;\n\n#define G(gi1, gi2, x, t0, t1, t2, t3) \\\n\tlookup_32bit(t0, t1, t2, t3, ##gi1, RGS1, shr_next, ##gi1);  \\\n\tlookup_32bit(t0, t1, t2, t3, ##gi2, RGS3, shr_next, ##gi2);  \\\n\t\\\n\tlookup_32bit(t0, t1, t2, t3, ##gi1, RGS2, dummy, none);      \\\n\tshlq $32,\tRGS2;                                        \\\n\torq\t\tRGS1, RGS2;                                  \\\n\tlookup_32bit(t0, t1, t2, t3, ##gi2, RGS1, dummy, none);      \\\n\tshlq $32,\tRGS1;                                        \\\n\torq\t\tRGS1, RGS3;\n\n#define round_head_2(a, b, x1, y1, x2, y2) \\\n\tvmovq\t\tb ## 1, RGI3;           \\\n\tvpextrq $1,\tb ## 1, RGI4;           \\\n\t\\\n\tG(RGI1, RGI2, x1, s0, s1, s2, s3);      \\\n\tvmovq\t\ta ## 2, RGI1;           \\\n\tvpextrq $1,\ta ## 2, RGI2;           \\\n\tvmovq\t\tRGS2, x1;               \\\n\tvpinsrq $1,\tRGS3, x1, x1;           \\\n\t\\\n\tG(RGI3, RGI4, y1, s1, s2, s3, s0);      \\\n\tvmovq\t\tb ## 2, RGI3;           \\\n\tvpextrq $1,\tb ## 2, RGI4;           \\\n\tvmovq\t\tRGS2, y1;               \\\n\tvpinsrq $1,\tRGS3, y1, y1;           \\\n\t\\\n\tG(RGI1, RGI2, x2, s0, s1, s2, s3);      \\\n\tvmovq\t\tRGS2, x2;               \\\n\tvpinsrq $1,\tRGS3, x2, x2;           \\\n\t\\\n\tG(RGI3, RGI4, y2, s1, s2, s3, s0);      \\\n\tvmovq\t\tRGS2, y2;               \\\n\tvpinsrq $1,\tRGS3, y2, y2;\n\n#define encround_tail(a, b, c, d, x, y, prerotate) \\\n\tvpaddd\t\t\tx, y,   x; \\\n\tvpaddd\t\t\tx, RK1, RT;\\\n\tprerotate(b);\t\t\t   \\\n\tvpxor\t\t\tRT, c,  c; \\\n\tvpaddd\t\t\ty, x,   y; \\\n\tvpaddd\t\t\ty, RK2, y; \\\n\tvpsrld $1,\t\tc, RT;     \\\n\tvpslld $(32 - 1),\tc, c;      \\\n\tvpor\t\t\tc, RT,  c; \\\n\tvpxor\t\t\td, y,   d; \\\n\n#define decround_tail(a, b, c, d, x, y, prerotate) \\\n\tvpaddd\t\t\tx, y,   x; \\\n\tvpaddd\t\t\tx, RK1, RT;\\\n\tprerotate(a);\t\t\t   \\\n\tvpxor\t\t\tRT, c,  c; \\\n\tvpaddd\t\t\ty, x,   y; \\\n\tvpaddd\t\t\ty, RK2, y; \\\n\tvpxor\t\t\td, y,   d; \\\n\tvpsrld $1,\t\td, y;      \\\n\tvpslld $(32 - 1),\td, d;      \\\n\tvpor\t\t\td, y,   d; \\\n\n#define rotate_1l(x) \\\n\tvpslld $1,\t\tx, RR;     \\\n\tvpsrld $(32 - 1),\tx, x;      \\\n\tvpor\t\t\tx, RR,  x;\n\n#define preload_rgi(c) \\\n\tvmovq\t\t\tc, RGI1; \\\n\tvpextrq $1,\t\tc, RGI2;\n\n#define encrypt_round(n, a, b, c, d, preload, prerotate) \\\n\tvbroadcastss (k+4*(2*(n)))(CTX),   RK1;                  \\\n\tvbroadcastss (k+4*(2*(n)+1))(CTX), RK2;                  \\\n\tround_head_2(a, b, RX0, RY0, RX1, RY1);                  \\\n\tencround_tail(a ## 1, b ## 1, c ## 1, d ## 1, RX0, RY0, prerotate); \\\n\tpreload(c ## 1);                                         \\\n\tencround_tail(a ## 2, b ## 2, c ## 2, d ## 2, RX1, RY1, prerotate);\n\n#define decrypt_round(n, a, b, c, d, preload, prerotate) \\\n\tvbroadcastss (k+4*(2*(n)))(CTX),   RK1;                  \\\n\tvbroadcastss (k+4*(2*(n)+1))(CTX), RK2;                  \\\n\tround_head_2(a, b, RX0, RY0, RX1, RY1);                  \\\n\tdecround_tail(a ## 1, b ## 1, c ## 1, d ## 1, RX0, RY0, prerotate); \\\n\tpreload(c ## 1);                                         \\\n\tdecround_tail(a ## 2, b ## 2, c ## 2, d ## 2, RX1, RY1, prerotate);\n\n#define encrypt_cycle(n) \\\n\tencrypt_round((2*n), RA, RB, RC, RD, preload_rgi, rotate_1l); \\\n\tencrypt_round(((2*n) + 1), RC, RD, RA, RB, preload_rgi, rotate_1l);\n\n#define encrypt_cycle_last(n) \\\n\tencrypt_round((2*n), RA, RB, RC, RD, preload_rgi, rotate_1l); \\\n\tencrypt_round(((2*n) + 1), RC, RD, RA, RB, dummy, dummy);\n\n#define decrypt_cycle(n) \\\n\tdecrypt_round(((2*n) + 1), RC, RD, RA, RB, preload_rgi, rotate_1l); \\\n\tdecrypt_round((2*n), RA, RB, RC, RD, preload_rgi, rotate_1l);\n\n#define decrypt_cycle_last(n) \\\n\tdecrypt_round(((2*n) + 1), RC, RD, RA, RB, preload_rgi, rotate_1l); \\\n\tdecrypt_round((2*n), RA, RB, RC, RD, dummy, dummy);\n\n#define transpose_4x4(x0, x1, x2, x3, t0, t1, t2) \\\n\tvpunpckldq\t\tx1, x0, t0; \\\n\tvpunpckhdq\t\tx1, x0, t2; \\\n\tvpunpckldq\t\tx3, x2, t1; \\\n\tvpunpckhdq\t\tx3, x2, x3; \\\n\t\\\n\tvpunpcklqdq\t\tt1, t0, x0; \\\n\tvpunpckhqdq\t\tt1, t0, x1; \\\n\tvpunpcklqdq\t\tx3, t2, x2; \\\n\tvpunpckhqdq\t\tx3, t2, x3;\n\n#define inpack_blocks(x0, x1, x2, x3, wkey, t0, t1, t2) \\\n\tvpxor\t\tx0, wkey, x0; \\\n\tvpxor\t\tx1, wkey, x1; \\\n\tvpxor\t\tx2, wkey, x2; \\\n\tvpxor\t\tx3, wkey, x3; \\\n\t\\\n\ttranspose_4x4(x0, x1, x2, x3, t0, t1, t2)\n\n#define outunpack_blocks(x0, x1, x2, x3, wkey, t0, t1, t2) \\\n\ttranspose_4x4(x0, x1, x2, x3, t0, t1, t2) \\\n\t\\\n\tvpxor\t\tx0, wkey, x0; \\\n\tvpxor\t\tx1, wkey, x1; \\\n\tvpxor\t\tx2, wkey, x2; \\\n\tvpxor\t\tx3, wkey, x3;\n\nSYM_FUNC_START_LOCAL(__twofish_enc_blk8)\n\t \n\n\tvmovdqu w(CTX), RK1;\n\n\tpushq %r13;\n\tpushq %rbx;\n\tpushq %rcx;\n\n\tinpack_blocks(RA1, RB1, RC1, RD1, RK1, RX0, RY0, RK2);\n\tpreload_rgi(RA1);\n\trotate_1l(RD1);\n\tinpack_blocks(RA2, RB2, RC2, RD2, RK1, RX0, RY0, RK2);\n\trotate_1l(RD2);\n\n\tencrypt_cycle(0);\n\tencrypt_cycle(1);\n\tencrypt_cycle(2);\n\tencrypt_cycle(3);\n\tencrypt_cycle(4);\n\tencrypt_cycle(5);\n\tencrypt_cycle(6);\n\tencrypt_cycle_last(7);\n\n\tvmovdqu (w+4*4)(CTX), RK1;\n\n\tpopq %rcx;\n\tpopq %rbx;\n\tpopq %r13;\n\n\toutunpack_blocks(RC1, RD1, RA1, RB1, RK1, RX0, RY0, RK2);\n\toutunpack_blocks(RC2, RD2, RA2, RB2, RK1, RX0, RY0, RK2);\n\n\tRET;\nSYM_FUNC_END(__twofish_enc_blk8)\n\nSYM_FUNC_START_LOCAL(__twofish_dec_blk8)\n\t \n\n\tvmovdqu (w+4*4)(CTX), RK1;\n\n\tpushq %r13;\n\tpushq %rbx;\n\n\tinpack_blocks(RC1, RD1, RA1, RB1, RK1, RX0, RY0, RK2);\n\tpreload_rgi(RC1);\n\trotate_1l(RA1);\n\tinpack_blocks(RC2, RD2, RA2, RB2, RK1, RX0, RY0, RK2);\n\trotate_1l(RA2);\n\n\tdecrypt_cycle(7);\n\tdecrypt_cycle(6);\n\tdecrypt_cycle(5);\n\tdecrypt_cycle(4);\n\tdecrypt_cycle(3);\n\tdecrypt_cycle(2);\n\tdecrypt_cycle(1);\n\tdecrypt_cycle_last(0);\n\n\tvmovdqu (w)(CTX), RK1;\n\n\tpopq %rbx;\n\tpopq %r13;\n\n\toutunpack_blocks(RA1, RB1, RC1, RD1, RK1, RX0, RY0, RK2);\n\toutunpack_blocks(RA2, RB2, RC2, RD2, RK1, RX0, RY0, RK2);\n\n\tRET;\nSYM_FUNC_END(__twofish_dec_blk8)\n\nSYM_FUNC_START(twofish_ecb_enc_8way)\n\t \n\tFRAME_BEGIN\n\n\tmovq %rsi, %r11;\n\n\tload_8way(%rdx, RA1, RB1, RC1, RD1, RA2, RB2, RC2, RD2);\n\n\tcall __twofish_enc_blk8;\n\n\tstore_8way(%r11, RC1, RD1, RA1, RB1, RC2, RD2, RA2, RB2);\n\n\tFRAME_END\n\tRET;\nSYM_FUNC_END(twofish_ecb_enc_8way)\n\nSYM_FUNC_START(twofish_ecb_dec_8way)\n\t \n\tFRAME_BEGIN\n\n\tmovq %rsi, %r11;\n\n\tload_8way(%rdx, RC1, RD1, RA1, RB1, RC2, RD2, RA2, RB2);\n\n\tcall __twofish_dec_blk8;\n\n\tstore_8way(%r11, RA1, RB1, RC1, RD1, RA2, RB2, RC2, RD2);\n\n\tFRAME_END\n\tRET;\nSYM_FUNC_END(twofish_ecb_dec_8way)\n\nSYM_FUNC_START(twofish_cbc_dec_8way)\n\t \n\tFRAME_BEGIN\n\n\tpushq %r12;\n\n\tmovq %rsi, %r11;\n\tmovq %rdx, %r12;\n\n\tload_8way(%rdx, RC1, RD1, RA1, RB1, RC2, RD2, RA2, RB2);\n\n\tcall __twofish_dec_blk8;\n\n\tstore_cbc_8way(%r12, %r11, RA1, RB1, RC1, RD1, RA2, RB2, RC2, RD2);\n\n\tpopq %r12;\n\n\tFRAME_END\n\tRET;\nSYM_FUNC_END(twofish_cbc_dec_8way)\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}