{
  "module_name": "sha512-avx2-asm.S",
  "hash_id": "bbcb0639ea6398bcb11c5478c4eb07270829f514a38f56c95175058750ff5fb0",
  "original_prompt": "Ingested from linux-6.6.14/arch/x86/crypto/sha512-avx2-asm.S",
  "human_readable_source": "########################################################################\n# Implement fast SHA-512 with AVX2 instructions. (x86_64)\n#\n# Copyright (C) 2013 Intel Corporation.\n#\n# Authors:\n#     James Guilford <james.guilford@intel.com>\n#     Kirk Yap <kirk.s.yap@intel.com>\n#     David Cote <david.m.cote@intel.com>\n#     Tim Chen <tim.c.chen@linux.intel.com>\n#\n# This software is available to you under a choice of one of two\n# licenses.  You may choose to be licensed under the terms of the GNU\n# General Public License (GPL) Version 2, available from the file\n# COPYING in the main directory of this source tree, or the\n# OpenIB.org BSD license below:\n#\n#     Redistribution and use in source and binary forms, with or\n#     without modification, are permitted provided that the following\n#     conditions are met:\n#\n#      - Redistributions of source code must retain the above\n#        copyright notice, this list of conditions and the following\n#        disclaimer.\n#\n#      - Redistributions in binary form must reproduce the above\n#        copyright notice, this list of conditions and the following\n#        disclaimer in the documentation and/or other materials\n#        provided with the distribution.\n#\n# THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\n# EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n# NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS\n# BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN\n# ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN\n# CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n# SOFTWARE.\n#\n########################################################################\n#\n# This code is described in an Intel White-Paper:\n# \"Fast SHA-512 Implementations on Intel Architecture Processors\"\n#\n# To find it, surf to http: \n# and search for that title.\n#\n########################################################################\n# This code schedules 1 blocks at a time, with 4 lanes per block\n########################################################################\n\n#include <linux/linkage.h>\n#include <linux/cfi_types.h>\n\n.text\n\n# Virtual Registers\nY_0 = %ymm4\nY_1 = %ymm5\nY_2 = %ymm6\nY_3 = %ymm7\n\nYTMP0 = %ymm0\nYTMP1 = %ymm1\nYTMP2 = %ymm2\nYTMP3 = %ymm3\nYTMP4 = %ymm8\nXFER  = YTMP0\n\nBYTE_FLIP_MASK  = %ymm9\n\n# 1st arg is %rdi, which is saved to the stack and accessed later via %r12\nCTX1        = %rdi\nCTX2        = %r12\n# 2nd arg\nINP         = %rsi\n# 3rd arg\nNUM_BLKS    = %rdx\n\nc           = %rcx\nd           = %r8\ne           = %rdx\ny3          = %rsi\n\nTBL   = %rdi # clobbers CTX1\n\na     = %rax\nb     = %rbx\n\nf     = %r9\ng     = %r10\nh     = %r11\nold_h = %r11\n\nT1    = %r12 # clobbers CTX2\ny0    = %r13\ny1    = %r14\ny2    = %r15\n\n# Local variables (stack frame)\nXFER_SIZE = 4*8\nSRND_SIZE = 1*8\nINP_SIZE = 1*8\nINPEND_SIZE = 1*8\nCTX_SIZE = 1*8\n\nframe_XFER = 0\nframe_SRND = frame_XFER + XFER_SIZE\nframe_INP = frame_SRND + SRND_SIZE\nframe_INPEND = frame_INP + INP_SIZE\nframe_CTX = frame_INPEND + INPEND_SIZE\nframe_size = frame_CTX + CTX_SIZE\n\n## assume buffers not aligned\n#define\tVMOVDQ vmovdqu\n\n# addm [mem], reg\n# Add reg to mem using reg-mem add and store\n.macro addm p1 p2\n\tadd\t\\p1, \\p2\n\tmov\t\\p2, \\p1\n.endm\n\n\n# COPY_YMM_AND_BSWAP ymm, [mem], byte_flip_mask\n# Load ymm with mem and byte swap each dword\n.macro COPY_YMM_AND_BSWAP p1 p2 p3\n\tVMOVDQ \\p2, \\p1\n\tvpshufb \\p3, \\p1, \\p1\n.endm\n# rotate_Ys\n# Rotate values of symbols Y0...Y3\n.macro rotate_Ys\n\tY_ = Y_0\n\tY_0 = Y_1\n\tY_1 = Y_2\n\tY_2 = Y_3\n\tY_3 = Y_\n.endm\n\n# RotateState\n.macro RotateState\n\t# Rotate symbols a..h right\n\told_h  = h\n\tTMP_   = h\n\th      = g\n\tg      = f\n\tf      = e\n\te      = d\n\td      = c\n\tc      = b\n\tb      = a\n\ta      = TMP_\n.endm\n\n# macro MY_VPALIGNR\tYDST, YSRC1, YSRC2, RVAL\n# YDST = {YSRC1, YSRC2} >> RVAL*8\n.macro MY_VPALIGNR YDST YSRC1 YSRC2 RVAL\n\tvperm2f128      $0x3, \\YSRC2, \\YSRC1, \\YDST     # YDST = {YS1_LO, YS2_HI}\n\tvpalignr        $\\RVAL, \\YSRC2, \\YDST, \\YDST    # YDST = {YDS1, YS2} >> RVAL*8\n.endm\n\n.macro FOUR_ROUNDS_AND_SCHED\n################################### RND N + 0 #########################################\n\n\t# Extract w[t-7]\n\tMY_VPALIGNR\tYTMP0, Y_3, Y_2, 8\t\t# YTMP0 = W[-7]\n\t# Calculate w[t-16] + w[t-7]\n\tvpaddq\t\tY_0, YTMP0, YTMP0\t\t# YTMP0 = W[-7] + W[-16]\n\t# Extract w[t-15]\n\tMY_VPALIGNR\tYTMP1, Y_1, Y_0, 8\t\t# YTMP1 = W[-15]\n\n\t# Calculate sigma0\n\n\t# Calculate w[t-15] ror 1\n\tvpsrlq\t\t$1, YTMP1, YTMP2\n\tvpsllq\t\t$(64-1), YTMP1, YTMP3\n\tvpor\t\tYTMP2, YTMP3, YTMP3\t\t# YTMP3 = W[-15] ror 1\n\t# Calculate w[t-15] shr 7\n\tvpsrlq\t\t$7, YTMP1, YTMP4\t\t# YTMP4 = W[-15] >> 7\n\n\tmov\ta, y3\t\t# y3 = a                                # MAJA\n\trorx\t$41, e, y0\t# y0 = e >> 41\t\t\t\t# S1A\n\trorx\t$18, e, y1\t# y1 = e >> 18\t\t\t\t# S1B\n\tadd\tframe_XFER(%rsp),h\t\t# h = k + w + h         # --\n\tor\tc, y3\t\t# y3 = a|c                              # MAJA\n\tmov\tf, y2\t\t# y2 = f                                # CH\n\trorx\t$34, a, T1\t# T1 = a >> 34\t\t\t\t# S0B\n\n\txor\ty1, y0\t\t# y0 = (e>>41) ^ (e>>18)\t\t# S1\n\txor\tg, y2\t\t# y2 = f^g                              # CH\n\trorx\t$14, e, y1\t# y1 = (e >> 14)\t\t\t# S1\n\n\tand\te, y2\t\t# y2 = (f^g)&e                          # CH\n\txor\ty1, y0\t\t# y0 = (e>>41) ^ (e>>18) ^ (e>>14)\t# S1\n\trorx\t$39, a, y1\t# y1 = a >> 39\t\t\t\t# S0A\n\tadd\th, d\t\t# d = k + w + h + d                     # --\n\n\tand\tb, y3\t\t# y3 = (a|c)&b                          # MAJA\n\txor\tT1, y1\t\t# y1 = (a>>39) ^ (a>>34)\t\t# S0\n\trorx\t$28, a, T1\t# T1 = (a >> 28)\t\t\t# S0\n\n\txor\tg, y2\t\t# y2 = CH = ((f^g)&e)^g                 # CH\n\txor\tT1, y1\t\t# y1 = (a>>39) ^ (a>>34) ^ (a>>28)\t# S0\n\tmov\ta, T1\t\t# T1 = a                                # MAJB\n\tand\tc, T1\t\t# T1 = a&c                              # MAJB\n\n\tadd\ty0, y2\t\t# y2 = S1 + CH                          # --\n\tor\tT1, y3\t\t# y3 = MAJ = (a|c)&b)|(a&c)             # MAJ\n\tadd\ty1, h\t\t# h = k + w + h + S0                    # --\n\n\tadd\ty2, d\t\t# d = k + w + h + d + S1 + CH = d + t1  # --\n\n\tadd\ty2, h\t\t# h = k + w + h + S0 + S1 + CH = t1 + S0# --\n\tadd\ty3, h\t\t# h = t1 + S0 + MAJ                     # --\n\n\tRotateState\n\n################################### RND N + 1 #########################################\n\n\t# Calculate w[t-15] ror 8\n\tvpsrlq\t\t$8, YTMP1, YTMP2\n\tvpsllq\t\t$(64-8), YTMP1, YTMP1\n\tvpor\t\tYTMP2, YTMP1, YTMP1\t\t# YTMP1 = W[-15] ror 8\n\t# XOR the three components\n\tvpxor\t\tYTMP4, YTMP3, YTMP3\t\t# YTMP3 = W[-15] ror 1 ^ W[-15] >> 7\n\tvpxor\t\tYTMP1, YTMP3, YTMP1\t\t# YTMP1 = s0\n\n\n\t# Add three components, w[t-16], w[t-7] and sigma0\n\tvpaddq\t\tYTMP1, YTMP0, YTMP0\t\t# YTMP0 = W[-16] + W[-7] + s0\n\t# Move to appropriate lanes for calculating w[16] and w[17]\n\tvperm2f128\t$0x0, YTMP0, YTMP0, Y_0\t\t# Y_0 = W[-16] + W[-7] + s0 {BABA}\n\t# Move to appropriate lanes for calculating w[18] and w[19]\n\tvpand\t\tMASK_YMM_LO(%rip), YTMP0, YTMP0\t# YTMP0 = W[-16] + W[-7] + s0 {DC00}\n\n\t# Calculate w[16] and w[17] in both 128 bit lanes\n\n\t# Calculate sigma1 for w[16] and w[17] on both 128 bit lanes\n\tvperm2f128\t$0x11, Y_3, Y_3, YTMP2\t\t# YTMP2 = W[-2] {BABA}\n\tvpsrlq\t\t$6, YTMP2, YTMP4\t\t# YTMP4 = W[-2] >> 6 {BABA}\n\n\n\tmov\ta, y3\t\t# y3 = a                                # MAJA\n\trorx\t$41, e, y0\t# y0 = e >> 41\t\t\t\t# S1A\n\trorx\t$18, e, y1\t# y1 = e >> 18\t\t\t\t# S1B\n\tadd\t1*8+frame_XFER(%rsp), h\t\t# h = k + w + h         # --\n\tor\tc, y3\t\t# y3 = a|c                              # MAJA\n\n\n\tmov\tf, y2\t\t# y2 = f                                # CH\n\trorx\t$34, a, T1\t# T1 = a >> 34\t\t\t\t# S0B\n\txor\ty1, y0\t\t# y0 = (e>>41) ^ (e>>18)\t\t# S1\n\txor\tg, y2\t\t# y2 = f^g                              # CH\n\n\n\trorx\t$14, e, y1\t# y1 = (e >> 14)\t\t\t# S1\n\txor\ty1, y0\t\t# y0 = (e>>41) ^ (e>>18) ^ (e>>14)\t# S1\n\trorx\t$39, a, y1\t# y1 = a >> 39\t\t\t\t# S0A\n\tand\te, y2\t\t# y2 = (f^g)&e                          # CH\n\tadd\th, d\t\t# d = k + w + h + d                     # --\n\n\tand\tb, y3\t\t# y3 = (a|c)&b                          # MAJA\n\txor\tT1, y1\t\t# y1 = (a>>39) ^ (a>>34)\t\t# S0\n\n\trorx\t$28, a, T1\t# T1 = (a >> 28)\t\t\t# S0\n\txor\tg, y2\t\t# y2 = CH = ((f^g)&e)^g                 # CH\n\n\txor\tT1, y1\t\t# y1 = (a>>39) ^ (a>>34) ^ (a>>28)\t# S0\n\tmov\ta, T1\t\t# T1 = a                                # MAJB\n\tand\tc, T1\t\t# T1 = a&c                              # MAJB\n\tadd\ty0, y2\t\t# y2 = S1 + CH                          # --\n\n\tor\tT1, y3\t\t# y3 = MAJ = (a|c)&b)|(a&c)             # MAJ\n\tadd\ty1, h\t\t# h = k + w + h + S0                    # --\n\n\tadd\ty2, d\t\t# d = k + w + h + d + S1 + CH = d + t1  # --\n\tadd\ty2, h\t\t# h = k + w + h + S0 + S1 + CH = t1 + S0# --\n\tadd\ty3, h\t\t# h = t1 + S0 + MAJ                     # --\n\n\tRotateState\n\n\n################################### RND N + 2 #########################################\n\n\tvpsrlq\t\t$19, YTMP2, YTMP3\t\t# YTMP3 = W[-2] >> 19 {BABA}\n\tvpsllq\t\t$(64-19), YTMP2, YTMP1\t\t# YTMP1 = W[-2] << 19 {BABA}\n\tvpor\t\tYTMP1, YTMP3, YTMP3\t\t# YTMP3 = W[-2] ror 19 {BABA}\n\tvpxor\t\tYTMP3, YTMP4, YTMP4\t\t# YTMP4 = W[-2] ror 19 ^ W[-2] >> 6 {BABA}\n\tvpsrlq\t\t$61, YTMP2, YTMP3\t\t# YTMP3 = W[-2] >> 61 {BABA}\n\tvpsllq\t\t$(64-61), YTMP2, YTMP1\t\t# YTMP1 = W[-2] << 61 {BABA}\n\tvpor\t\tYTMP1, YTMP3, YTMP3\t\t# YTMP3 = W[-2] ror 61 {BABA}\n\tvpxor\t\tYTMP3, YTMP4, YTMP4\t\t# YTMP4 = s1 = (W[-2] ror 19) ^\n\t\t\t\t\t\t\t#  (W[-2] ror 61) ^ (W[-2] >> 6) {BABA}\n\n\t# Add sigma1 to the other compunents to get w[16] and w[17]\n\tvpaddq\t\tYTMP4, Y_0, Y_0\t\t\t# Y_0 = {W[1], W[0], W[1], W[0]}\n\n\t# Calculate sigma1 for w[18] and w[19] for upper 128 bit lane\n\tvpsrlq\t\t$6, Y_0, YTMP4\t\t\t# YTMP4 = W[-2] >> 6 {DC--}\n\n\tmov\ta, y3\t\t# y3 = a                                # MAJA\n\trorx\t$41, e, y0\t# y0 = e >> 41\t\t\t\t# S1A\n\tadd\t2*8+frame_XFER(%rsp), h\t\t# h = k + w + h         # --\n\n\trorx\t$18, e, y1\t# y1 = e >> 18\t\t\t\t# S1B\n\tor\tc, y3\t\t# y3 = a|c                              # MAJA\n\tmov\tf, y2\t\t# y2 = f                                # CH\n\txor\tg, y2\t\t# y2 = f^g                              # CH\n\n\trorx\t$34, a, T1\t# T1 = a >> 34\t\t\t\t# S0B\n\txor\ty1, y0\t\t# y0 = (e>>41) ^ (e>>18)\t\t# S1\n\tand\te, y2\t\t# y2 = (f^g)&e                          # CH\n\n\trorx\t$14, e, y1\t# y1 = (e >> 14)\t\t\t# S1\n\tadd\th, d\t\t# d = k + w + h + d                     # --\n\tand\tb, y3\t\t# y3 = (a|c)&b                          # MAJA\n\n\txor\ty1, y0\t\t# y0 = (e>>41) ^ (e>>18) ^ (e>>14)\t# S1\n\trorx\t$39, a, y1\t# y1 = a >> 39\t\t\t\t# S0A\n\txor\tg, y2\t\t# y2 = CH = ((f^g)&e)^g                 # CH\n\n\txor\tT1, y1\t\t# y1 = (a>>39) ^ (a>>34)\t\t# S0\n\trorx\t$28, a, T1\t# T1 = (a >> 28)\t\t\t# S0\n\n\txor\tT1, y1\t\t# y1 = (a>>39) ^ (a>>34) ^ (a>>28)\t# S0\n\tmov\ta, T1\t\t# T1 = a                                # MAJB\n\tand\tc, T1\t\t# T1 = a&c                              # MAJB\n\tadd\ty0, y2\t\t# y2 = S1 + CH                          # --\n\n\tor\tT1, y3\t\t# y3 = MAJ = (a|c)&b)|(a&c)             # MAJ\n\tadd\ty1, h\t\t# h = k + w + h + S0                    # --\n\tadd\ty2, d\t\t# d = k + w + h + d + S1 + CH = d + t1  # --\n\tadd\ty2, h\t\t# h = k + w + h + S0 + S1 + CH = t1 + S0# --\n\n\tadd\ty3, h\t\t# h = t1 + S0 + MAJ                     # --\n\n\tRotateState\n\n################################### RND N + 3 #########################################\n\n\tvpsrlq\t\t$19, Y_0, YTMP3\t\t\t# YTMP3 = W[-2] >> 19 {DC--}\n\tvpsllq\t\t$(64-19), Y_0, YTMP1\t\t# YTMP1 = W[-2] << 19 {DC--}\n\tvpor\t\tYTMP1, YTMP3, YTMP3\t\t# YTMP3 = W[-2] ror 19 {DC--}\n\tvpxor\t\tYTMP3, YTMP4, YTMP4\t\t# YTMP4 = W[-2] ror 19 ^ W[-2] >> 6 {DC--}\n\tvpsrlq\t\t$61, Y_0, YTMP3\t\t\t# YTMP3 = W[-2] >> 61 {DC--}\n\tvpsllq\t\t$(64-61), Y_0, YTMP1\t\t# YTMP1 = W[-2] << 61 {DC--}\n\tvpor\t\tYTMP1, YTMP3, YTMP3\t\t# YTMP3 = W[-2] ror 61 {DC--}\n\tvpxor\t\tYTMP3, YTMP4, YTMP4\t\t# YTMP4 = s1 = (W[-2] ror 19) ^\n\t\t\t\t\t\t\t#  (W[-2] ror 61) ^ (W[-2] >> 6) {DC--}\n\n\t# Add the sigma0 + w[t-7] + w[t-16] for w[18] and w[19]\n\t# to newly calculated sigma1 to get w[18] and w[19]\n\tvpaddq\t\tYTMP4, YTMP0, YTMP2\t\t# YTMP2 = {W[3], W[2], --, --}\n\n\t# Form w[19, w[18], w17], w[16]\n\tvpblendd\t\t$0xF0, YTMP2, Y_0, Y_0\t\t# Y_0 = {W[3], W[2], W[1], W[0]}\n\n\tmov\ta, y3\t\t# y3 = a                                # MAJA\n\trorx\t$41, e, y0\t# y0 = e >> 41\t\t\t\t# S1A\n\trorx\t$18, e, y1\t# y1 = e >> 18\t\t\t\t# S1B\n\tadd\t3*8+frame_XFER(%rsp), h\t\t# h = k + w + h         # --\n\tor\tc, y3\t\t# y3 = a|c                              # MAJA\n\n\n\tmov\tf, y2\t\t# y2 = f                                # CH\n\trorx\t$34, a, T1\t# T1 = a >> 34\t\t\t\t# S0B\n\txor\ty1, y0\t\t# y0 = (e>>41) ^ (e>>18)\t\t# S1\n\txor\tg, y2\t\t# y2 = f^g                              # CH\n\n\n\trorx\t$14, e, y1\t# y1 = (e >> 14)\t\t\t# S1\n\tand\te, y2\t\t# y2 = (f^g)&e                          # CH\n\tadd\th, d\t\t# d = k + w + h + d                     # --\n\tand\tb, y3\t\t# y3 = (a|c)&b                          # MAJA\n\n\txor\ty1, y0\t\t# y0 = (e>>41) ^ (e>>18) ^ (e>>14)\t# S1\n\txor\tg, y2\t\t# y2 = CH = ((f^g)&e)^g                 # CH\n\n\trorx\t$39, a, y1\t# y1 = a >> 39\t\t\t\t# S0A\n\tadd\ty0, y2\t\t# y2 = S1 + CH                          # --\n\n\txor\tT1, y1\t\t# y1 = (a>>39) ^ (a>>34)\t\t# S0\n\tadd\ty2, d\t\t# d = k + w + h + d + S1 + CH = d + t1  # --\n\n\trorx\t$28, a, T1\t# T1 = (a >> 28)\t\t\t# S0\n\n\txor\tT1, y1\t\t# y1 = (a>>39) ^ (a>>34) ^ (a>>28)\t# S0\n\tmov\ta, T1\t\t# T1 = a                                # MAJB\n\tand\tc, T1\t\t# T1 = a&c                              # MAJB\n\tor\tT1, y3\t\t# y3 = MAJ = (a|c)&b)|(a&c)             # MAJ\n\n\tadd\ty1, h\t\t# h = k + w + h + S0                    # --\n\tadd\ty2, h\t\t# h = k + w + h + S0 + S1 + CH = t1 + S0# --\n\tadd\ty3, h\t\t# h = t1 + S0 + MAJ                     # --\n\n\tRotateState\n\n\trotate_Ys\n.endm\n\n.macro DO_4ROUNDS\n\n################################### RND N + 0 #########################################\n\n\tmov\tf, y2\t\t# y2 = f                                # CH\n\trorx\t$41, e, y0\t# y0 = e >> 41\t\t\t\t# S1A\n\trorx\t$18, e, y1\t# y1 = e >> 18\t\t\t\t# S1B\n\txor\tg, y2\t\t# y2 = f^g                              # CH\n\n\txor\ty1, y0\t\t# y0 = (e>>41) ^ (e>>18)\t\t# S1\n\trorx\t$14, e, y1\t# y1 = (e >> 14)\t\t\t# S1\n\tand\te, y2\t\t# y2 = (f^g)&e                          # CH\n\n\txor\ty1, y0\t\t# y0 = (e>>41) ^ (e>>18) ^ (e>>14)\t# S1\n\trorx\t$34, a, T1\t# T1 = a >> 34\t\t\t\t# S0B\n\txor\tg, y2\t\t# y2 = CH = ((f^g)&e)^g                 # CH\n\trorx\t$39, a, y1\t# y1 = a >> 39\t\t\t\t# S0A\n\tmov\ta, y3\t\t# y3 = a                                # MAJA\n\n\txor\tT1, y1\t\t# y1 = (a>>39) ^ (a>>34)\t\t# S0\n\trorx\t$28, a, T1\t# T1 = (a >> 28)\t\t\t# S0\n\tadd\tframe_XFER(%rsp), h\t\t# h = k + w + h         # --\n\tor\tc, y3\t\t# y3 = a|c                              # MAJA\n\n\txor\tT1, y1\t\t# y1 = (a>>39) ^ (a>>34) ^ (a>>28)\t# S0\n\tmov\ta, T1\t\t# T1 = a                                # MAJB\n\tand\tb, y3\t\t# y3 = (a|c)&b                          # MAJA\n\tand\tc, T1\t\t# T1 = a&c                              # MAJB\n\tadd\ty0, y2\t\t# y2 = S1 + CH                          # --\n\n\tadd\th, d\t\t# d = k + w + h + d                     # --\n\tor\tT1, y3\t\t# y3 = MAJ = (a|c)&b)|(a&c)             # MAJ\n\tadd\ty1, h\t\t# h = k + w + h + S0                    # --\n\n\tadd\ty2, d\t\t# d = k + w + h + d + S1 + CH = d + t1  # --\n\n\tRotateState\n\n################################### RND N + 1 #########################################\n\n\tadd\ty2, old_h\t# h = k + w + h + S0 + S1 + CH = t1 + S0# --\n\tmov\tf, y2\t\t# y2 = f                                # CH\n\trorx\t$41, e, y0\t# y0 = e >> 41\t\t\t\t# S1A\n\trorx\t$18, e, y1\t# y1 = e >> 18\t\t\t\t# S1B\n\txor\tg, y2\t\t# y2 = f^g                              # CH\n\n\txor\ty1, y0\t\t# y0 = (e>>41) ^ (e>>18)\t\t# S1\n\trorx\t$14, e, y1\t# y1 = (e >> 14)\t\t\t# S1\n\tand\te, y2\t\t# y2 = (f^g)&e                          # CH\n\tadd\ty3, old_h\t# h = t1 + S0 + MAJ                     # --\n\n\txor\ty1, y0\t\t# y0 = (e>>41) ^ (e>>18) ^ (e>>14)\t# S1\n\trorx\t$34, a, T1\t# T1 = a >> 34\t\t\t\t# S0B\n\txor\tg, y2\t\t# y2 = CH = ((f^g)&e)^g                 # CH\n\trorx\t$39, a, y1\t# y1 = a >> 39\t\t\t\t# S0A\n\tmov\ta, y3\t\t# y3 = a                                # MAJA\n\n\txor\tT1, y1\t\t# y1 = (a>>39) ^ (a>>34)\t\t# S0\n\trorx\t$28, a, T1\t# T1 = (a >> 28)\t\t\t# S0\n\tadd\t8*1+frame_XFER(%rsp), h\t\t# h = k + w + h         # --\n\tor\tc, y3\t\t# y3 = a|c                              # MAJA\n\n\txor\tT1, y1\t\t# y1 = (a>>39) ^ (a>>34) ^ (a>>28)\t# S0\n\tmov\ta, T1\t\t# T1 = a                                # MAJB\n\tand\tb, y3\t\t# y3 = (a|c)&b                          # MAJA\n\tand\tc, T1\t\t# T1 = a&c                              # MAJB\n\tadd\ty0, y2\t\t# y2 = S1 + CH                          # --\n\n\tadd\th, d\t\t# d = k + w + h + d                     # --\n\tor\tT1, y3\t\t# y3 = MAJ = (a|c)&b)|(a&c)             # MAJ\n\tadd\ty1, h\t\t# h = k + w + h + S0                    # --\n\n\tadd\ty2, d\t\t# d = k + w + h + d + S1 + CH = d + t1  # --\n\n\tRotateState\n\n################################### RND N + 2 #########################################\n\n\tadd\ty2, old_h\t# h = k + w + h + S0 + S1 + CH = t1 + S0# --\n\tmov\tf, y2\t\t# y2 = f                                # CH\n\trorx\t$41, e, y0\t# y0 = e >> 41\t\t\t\t# S1A\n\trorx\t$18, e, y1\t# y1 = e >> 18\t\t\t\t# S1B\n\txor\tg, y2\t\t# y2 = f^g                              # CH\n\n\txor\ty1, y0\t\t# y0 = (e>>41) ^ (e>>18)\t\t# S1\n\trorx\t$14, e, y1\t# y1 = (e >> 14)\t\t\t# S1\n\tand\te, y2\t\t# y2 = (f^g)&e                          # CH\n\tadd\ty3, old_h\t# h = t1 + S0 + MAJ                     # --\n\n\txor\ty1, y0\t\t# y0 = (e>>41) ^ (e>>18) ^ (e>>14)\t# S1\n\trorx\t$34, a, T1\t# T1 = a >> 34\t\t\t\t# S0B\n\txor\tg, y2\t\t# y2 = CH = ((f^g)&e)^g                 # CH\n\trorx\t$39, a, y1\t# y1 = a >> 39\t\t\t\t# S0A\n\tmov\ta, y3\t\t# y3 = a                                # MAJA\n\n\txor\tT1, y1\t\t# y1 = (a>>39) ^ (a>>34)\t\t# S0\n\trorx\t$28, a, T1\t# T1 = (a >> 28)\t\t\t# S0\n\tadd\t8*2+frame_XFER(%rsp), h\t\t# h = k + w + h         # --\n\tor\tc, y3\t\t# y3 = a|c                              # MAJA\n\n\txor\tT1, y1\t\t# y1 = (a>>39) ^ (a>>34) ^ (a>>28)\t# S0\n\tmov\ta, T1\t\t# T1 = a                                # MAJB\n\tand\tb, y3\t\t# y3 = (a|c)&b                          # MAJA\n\tand\tc, T1\t\t# T1 = a&c                              # MAJB\n\tadd\ty0, y2\t\t# y2 = S1 + CH                          # --\n\n\tadd\th, d\t\t# d = k + w + h + d                     # --\n\tor\tT1, y3\t\t# y3 = MAJ = (a|c)&b)|(a&c)             # MAJ\n\tadd\ty1, h\t\t# h = k + w + h + S0                    # --\n\n\tadd\ty2, d\t\t# d = k + w + h + d + S1 + CH = d + t1  # --\n\n\tRotateState\n\n################################### RND N + 3 #########################################\n\n\tadd\ty2, old_h\t# h = k + w + h + S0 + S1 + CH = t1 + S0# --\n\tmov\tf, y2\t\t# y2 = f                                # CH\n\trorx\t$41, e, y0\t# y0 = e >> 41\t\t\t\t# S1A\n\trorx\t$18, e, y1\t# y1 = e >> 18\t\t\t\t# S1B\n\txor\tg, y2\t\t# y2 = f^g                              # CH\n\n\txor\ty1, y0\t\t# y0 = (e>>41) ^ (e>>18)\t\t# S1\n\trorx\t$14, e, y1\t# y1 = (e >> 14)\t\t\t# S1\n\tand\te, y2\t\t# y2 = (f^g)&e                          # CH\n\tadd\ty3, old_h\t# h = t1 + S0 + MAJ                     # --\n\n\txor\ty1, y0\t\t# y0 = (e>>41) ^ (e>>18) ^ (e>>14)\t# S1\n\trorx\t$34, a, T1\t# T1 = a >> 34\t\t\t\t# S0B\n\txor\tg, y2\t\t# y2 = CH = ((f^g)&e)^g                 # CH\n\trorx\t$39, a, y1\t# y1 = a >> 39\t\t\t\t# S0A\n\tmov\ta, y3\t\t# y3 = a                                # MAJA\n\n\txor\tT1, y1\t\t# y1 = (a>>39) ^ (a>>34)\t\t# S0\n\trorx\t$28, a, T1\t# T1 = (a >> 28)\t\t\t# S0\n\tadd\t8*3+frame_XFER(%rsp), h\t\t# h = k + w + h         # --\n\tor\tc, y3\t\t# y3 = a|c                              # MAJA\n\n\txor\tT1, y1\t\t# y1 = (a>>39) ^ (a>>34) ^ (a>>28)\t# S0\n\tmov\ta, T1\t\t# T1 = a                                # MAJB\n\tand\tb, y3\t\t# y3 = (a|c)&b                          # MAJA\n\tand\tc, T1\t\t# T1 = a&c                              # MAJB\n\tadd\ty0, y2\t\t# y2 = S1 + CH                          # --\n\n\n\tadd\th, d\t\t# d = k + w + h + d                     # --\n\tor\tT1, y3\t\t# y3 = MAJ = (a|c)&b)|(a&c)             # MAJ\n\tadd\ty1, h\t\t# h = k + w + h + S0                    # --\n\n\tadd\ty2, d\t\t# d = k + w + h + d + S1 + CH = d + t1  # --\n\n\tadd\ty2, h\t\t# h = k + w + h + S0 + S1 + CH = t1 + S0# --\n\n\tadd\ty3, h\t\t# h = t1 + S0 + MAJ                     # --\n\n\tRotateState\n\n.endm\n\n########################################################################\n# void sha512_transform_rorx(sha512_state *state, const u8 *data, int blocks)\n# Purpose: Updates the SHA512 digest stored at \"state\" with the message\n# stored in \"data\".\n# The size of the message pointed to by \"data\" must be an integer multiple\n# of SHA512 message blocks.\n# \"blocks\" is the message length in SHA512 blocks\n########################################################################\nSYM_TYPED_FUNC_START(sha512_transform_rorx)\n\t# Save GPRs\n\tpush\t%rbx\n\tpush\t%r12\n\tpush\t%r13\n\tpush\t%r14\n\tpush\t%r15\n\n\t# Allocate Stack Space\n\tpush\t%rbp\n\tmov\t%rsp, %rbp\n\tsub\t$frame_size, %rsp\n\tand\t$~(0x20 - 1), %rsp\n\n\tshl\t$7, NUM_BLKS\t# convert to bytes\n\tjz\t.Ldone_hash\n\tadd\tINP, NUM_BLKS\t# pointer to end of data\n\tmov\tNUM_BLKS, frame_INPEND(%rsp)\n\n\t## load initial digest\n\tmov\t8*0(CTX1), a\n\tmov\t8*1(CTX1), b\n\tmov\t8*2(CTX1), c\n\tmov\t8*3(CTX1), d\n\tmov\t8*4(CTX1), e\n\tmov\t8*5(CTX1), f\n\tmov\t8*6(CTX1), g\n\tmov\t8*7(CTX1), h\n\n\t# save %rdi (CTX) before it gets clobbered\n\tmov\t%rdi, frame_CTX(%rsp)\n\n\tvmovdqa\tPSHUFFLE_BYTE_FLIP_MASK(%rip), BYTE_FLIP_MASK\n\n.Lloop0:\n\tlea\tK512(%rip), TBL\n\n\t## byte swap first 16 dwords\n\tCOPY_YMM_AND_BSWAP\tY_0, (INP), BYTE_FLIP_MASK\n\tCOPY_YMM_AND_BSWAP\tY_1, 1*32(INP), BYTE_FLIP_MASK\n\tCOPY_YMM_AND_BSWAP\tY_2, 2*32(INP), BYTE_FLIP_MASK\n\tCOPY_YMM_AND_BSWAP\tY_3, 3*32(INP), BYTE_FLIP_MASK\n\n\tmov\tINP, frame_INP(%rsp)\n\n\t## schedule 64 input dwords, by doing 12 rounds of 4 each\n\tmovq\t$4, frame_SRND(%rsp)\n\n.align 16\n.Lloop1:\n\tvpaddq\t(TBL), Y_0, XFER\n\tvmovdqa XFER, frame_XFER(%rsp)\n\tFOUR_ROUNDS_AND_SCHED\n\n\tvpaddq\t1*32(TBL), Y_0, XFER\n\tvmovdqa XFER, frame_XFER(%rsp)\n\tFOUR_ROUNDS_AND_SCHED\n\n\tvpaddq\t2*32(TBL), Y_0, XFER\n\tvmovdqa XFER, frame_XFER(%rsp)\n\tFOUR_ROUNDS_AND_SCHED\n\n\tvpaddq\t3*32(TBL), Y_0, XFER\n\tvmovdqa XFER, frame_XFER(%rsp)\n\tadd\t$(4*32), TBL\n\tFOUR_ROUNDS_AND_SCHED\n\n\tsubq\t$1, frame_SRND(%rsp)\n\tjne\t.Lloop1\n\n\tmovq\t$2, frame_SRND(%rsp)\n.Lloop2:\n\tvpaddq\t(TBL), Y_0, XFER\n\tvmovdqa XFER, frame_XFER(%rsp)\n\tDO_4ROUNDS\n\tvpaddq\t1*32(TBL), Y_1, XFER\n\tvmovdqa XFER, frame_XFER(%rsp)\n\tadd\t$(2*32), TBL\n\tDO_4ROUNDS\n\n\tvmovdqa\tY_2, Y_0\n\tvmovdqa\tY_3, Y_1\n\n\tsubq\t$1, frame_SRND(%rsp)\n\tjne\t.Lloop2\n\n\tmov\tframe_CTX(%rsp), CTX2\n\taddm\t8*0(CTX2), a\n\taddm\t8*1(CTX2), b\n\taddm\t8*2(CTX2), c\n\taddm\t8*3(CTX2), d\n\taddm\t8*4(CTX2), e\n\taddm\t8*5(CTX2), f\n\taddm\t8*6(CTX2), g\n\taddm\t8*7(CTX2), h\n\n\tmov\tframe_INP(%rsp), INP\n\tadd\t$128, INP\n\tcmp\tframe_INPEND(%rsp), INP\n\tjne\t.Lloop0\n\n.Ldone_hash:\n\n\t# Restore Stack Pointer\n\tmov\t%rbp, %rsp\n\tpop\t%rbp\n\n\t# Restore GPRs\n\tpop\t%r15\n\tpop\t%r14\n\tpop\t%r13\n\tpop\t%r12\n\tpop\t%rbx\n\n\tRET\nSYM_FUNC_END(sha512_transform_rorx)\n\n########################################################################\n### Binary Data\n\n\n# Mergeable 640-byte rodata section. This allows linker to merge the table\n# with other, exactly the same 640-byte fragment of another rodata section\n# (if such section exists).\n.section\t.rodata.cst640.K512, \"aM\", @progbits, 640\n.align 64\n# K[t] used in SHA512 hashing\nK512:\n\t.quad\t0x428a2f98d728ae22,0x7137449123ef65cd\n\t.quad\t0xb5c0fbcfec4d3b2f,0xe9b5dba58189dbbc\n\t.quad\t0x3956c25bf348b538,0x59f111f1b605d019\n\t.quad\t0x923f82a4af194f9b,0xab1c5ed5da6d8118\n\t.quad\t0xd807aa98a3030242,0x12835b0145706fbe\n\t.quad\t0x243185be4ee4b28c,0x550c7dc3d5ffb4e2\n\t.quad\t0x72be5d74f27b896f,0x80deb1fe3b1696b1\n\t.quad\t0x9bdc06a725c71235,0xc19bf174cf692694\n\t.quad\t0xe49b69c19ef14ad2,0xefbe4786384f25e3\n\t.quad\t0x0fc19dc68b8cd5b5,0x240ca1cc77ac9c65\n\t.quad\t0x2de92c6f592b0275,0x4a7484aa6ea6e483\n\t.quad\t0x5cb0a9dcbd41fbd4,0x76f988da831153b5\n\t.quad\t0x983e5152ee66dfab,0xa831c66d2db43210\n\t.quad\t0xb00327c898fb213f,0xbf597fc7beef0ee4\n\t.quad\t0xc6e00bf33da88fc2,0xd5a79147930aa725\n\t.quad\t0x06ca6351e003826f,0x142929670a0e6e70\n\t.quad\t0x27b70a8546d22ffc,0x2e1b21385c26c926\n\t.quad\t0x4d2c6dfc5ac42aed,0x53380d139d95b3df\n\t.quad\t0x650a73548baf63de,0x766a0abb3c77b2a8\n\t.quad\t0x81c2c92e47edaee6,0x92722c851482353b\n\t.quad\t0xa2bfe8a14cf10364,0xa81a664bbc423001\n\t.quad\t0xc24b8b70d0f89791,0xc76c51a30654be30\n\t.quad\t0xd192e819d6ef5218,0xd69906245565a910\n\t.quad\t0xf40e35855771202a,0x106aa07032bbd1b8\n\t.quad\t0x19a4c116b8d2d0c8,0x1e376c085141ab53\n\t.quad\t0x2748774cdf8eeb99,0x34b0bcb5e19b48a8\n\t.quad\t0x391c0cb3c5c95a63,0x4ed8aa4ae3418acb\n\t.quad\t0x5b9cca4f7763e373,0x682e6ff3d6b2b8a3\n\t.quad\t0x748f82ee5defb2fc,0x78a5636f43172f60\n\t.quad\t0x84c87814a1f0ab72,0x8cc702081a6439ec\n\t.quad\t0x90befffa23631e28,0xa4506cebde82bde9\n\t.quad\t0xbef9a3f7b2c67915,0xc67178f2e372532b\n\t.quad\t0xca273eceea26619c,0xd186b8c721c0c207\n\t.quad\t0xeada7dd6cde0eb1e,0xf57d4f7fee6ed178\n\t.quad\t0x06f067aa72176fba,0x0a637dc5a2c898a6\n\t.quad\t0x113f9804bef90dae,0x1b710b35131c471b\n\t.quad\t0x28db77f523047d84,0x32caab7b40c72493\n\t.quad\t0x3c9ebe0a15c9bebc,0x431d67c49c100d4c\n\t.quad\t0x4cc5d4becb3e42b6,0x597f299cfc657e2a\n\t.quad\t0x5fcb6fab3ad6faec,0x6c44198c4a475817\n\n.section\t.rodata.cst32.PSHUFFLE_BYTE_FLIP_MASK, \"aM\", @progbits, 32\n.align 32\n# Mask for byte-swapping a couple of qwords in an XMM register using (v)pshufb.\nPSHUFFLE_BYTE_FLIP_MASK:\n\t.octa 0x08090a0b0c0d0e0f0001020304050607\n\t.octa 0x18191a1b1c1d1e1f1011121314151617\n\n.section\t.rodata.cst32.MASK_YMM_LO, \"aM\", @progbits, 32\n.align 32\nMASK_YMM_LO:\n\t.octa 0x00000000000000000000000000000000\n\t.octa 0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}