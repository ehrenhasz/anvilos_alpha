{
  "module_name": "calling.h",
  "hash_id": "908961330dee8fb9055ed0ffffc48308e06ba3f58f1212da0b31ac0ac682e8ef",
  "original_prompt": "Ingested from linux-6.6.14/arch/x86/entry/calling.h",
  "human_readable_source": " \n#include <linux/jump_label.h>\n#include <asm/unwind_hints.h>\n#include <asm/cpufeatures.h>\n#include <asm/page_types.h>\n#include <asm/percpu.h>\n#include <asm/asm-offsets.h>\n#include <asm/processor-flags.h>\n#include <asm/ptrace-abi.h>\n#include <asm/msr.h>\n#include <asm/nospec-branch.h>\n\n \n\n#ifdef CONFIG_X86_64\n\n \n\n.macro PUSH_REGS rdx=%rdx rcx=%rcx rax=%rax save_ret=0\n\t.if \\save_ret\n\tpushq\t%rsi\t\t \n\tmovq\t8(%rsp), %rsi\t \n\tmovq\t%rdi, 8(%rsp)\t \n\t.else\n\tpushq   %rdi\t\t \n\tpushq   %rsi\t\t \n\t.endif\n\tpushq\t\\rdx\t\t \n\tpushq   \\rcx\t\t \n\tpushq   \\rax\t\t \n\tpushq   %r8\t\t \n\tpushq   %r9\t\t \n\tpushq   %r10\t\t \n\tpushq   %r11\t\t \n\tpushq\t%rbx\t\t \n\tpushq\t%rbp\t\t \n\tpushq\t%r12\t\t \n\tpushq\t%r13\t\t \n\tpushq\t%r14\t\t \n\tpushq\t%r15\t\t \n\tUNWIND_HINT_REGS\n\n\t.if \\save_ret\n\tpushq\t%rsi\t\t \n\t.endif\n.endm\n\n.macro CLEAR_REGS\n\t \n\txorl\t%esi,  %esi\t \n\txorl\t%edx,  %edx\t \n\txorl\t%ecx,  %ecx\t \n\txorl\t%r8d,  %r8d\t \n\txorl\t%r9d,  %r9d\t \n\txorl\t%r10d, %r10d\t \n\txorl\t%r11d, %r11d\t \n\txorl\t%ebx,  %ebx\t \n\txorl\t%ebp,  %ebp\t \n\txorl\t%r12d, %r12d\t \n\txorl\t%r13d, %r13d\t \n\txorl\t%r14d, %r14d\t \n\txorl\t%r15d, %r15d\t \n\n.endm\n\n.macro PUSH_AND_CLEAR_REGS rdx=%rdx rcx=%rcx rax=%rax save_ret=0\n\tPUSH_REGS rdx=\\rdx, rcx=\\rcx, rax=\\rax, save_ret=\\save_ret\n\tCLEAR_REGS\n.endm\n\n.macro POP_REGS pop_rdi=1\n\tpopq %r15\n\tpopq %r14\n\tpopq %r13\n\tpopq %r12\n\tpopq %rbp\n\tpopq %rbx\n\tpopq %r11\n\tpopq %r10\n\tpopq %r9\n\tpopq %r8\n\tpopq %rax\n\tpopq %rcx\n\tpopq %rdx\n\tpopq %rsi\n\t.if \\pop_rdi\n\tpopq %rdi\n\t.endif\n.endm\n\n#ifdef CONFIG_PAGE_TABLE_ISOLATION\n\n \n#define PTI_USER_PGTABLE_BIT\t\tPAGE_SHIFT\n#define PTI_USER_PGTABLE_MASK\t\t(1 << PTI_USER_PGTABLE_BIT)\n#define PTI_USER_PCID_BIT\t\tX86_CR3_PTI_PCID_USER_BIT\n#define PTI_USER_PCID_MASK\t\t(1 << PTI_USER_PCID_BIT)\n#define PTI_USER_PGTABLE_AND_PCID_MASK  (PTI_USER_PCID_MASK | PTI_USER_PGTABLE_MASK)\n\n.macro SET_NOFLUSH_BIT\treg:req\n\tbts\t$X86_CR3_PCID_NOFLUSH_BIT, \\reg\n.endm\n\n.macro ADJUST_KERNEL_CR3 reg:req\n\tALTERNATIVE \"\", \"SET_NOFLUSH_BIT \\reg\", X86_FEATURE_PCID\n\t \n\tandq    $(~PTI_USER_PGTABLE_AND_PCID_MASK), \\reg\n.endm\n\n.macro SWITCH_TO_KERNEL_CR3 scratch_reg:req\n\tALTERNATIVE \"jmp .Lend_\\@\", \"\", X86_FEATURE_PTI\n\tmov\t%cr3, \\scratch_reg\n\tADJUST_KERNEL_CR3 \\scratch_reg\n\tmov\t\\scratch_reg, %cr3\n.Lend_\\@:\n.endm\n\n#define THIS_CPU_user_pcid_flush_mask   \\\n\tPER_CPU_VAR(cpu_tlbstate) + TLB_STATE_user_pcid_flush_mask\n\n.macro SWITCH_TO_USER_CR3_NOSTACK scratch_reg:req scratch_reg2:req\n\tALTERNATIVE \"jmp .Lend_\\@\", \"\", X86_FEATURE_PTI\n\tmov\t%cr3, \\scratch_reg\n\n\tALTERNATIVE \"jmp .Lwrcr3_\\@\", \"\", X86_FEATURE_PCID\n\n\t \n\tmovq\t\\scratch_reg, \\scratch_reg2\n\tandq\t$(0x7FF), \\scratch_reg\t\t \n\tbt\t\\scratch_reg, THIS_CPU_user_pcid_flush_mask\n\tjnc\t.Lnoflush_\\@\n\n\t \n\tbtr\t\\scratch_reg, THIS_CPU_user_pcid_flush_mask\n\tmovq\t\\scratch_reg2, \\scratch_reg\n\tjmp\t.Lwrcr3_pcid_\\@\n\n.Lnoflush_\\@:\n\tmovq\t\\scratch_reg2, \\scratch_reg\n\tSET_NOFLUSH_BIT \\scratch_reg\n\n.Lwrcr3_pcid_\\@:\n\t \n\torq\t$(PTI_USER_PCID_MASK), \\scratch_reg\n\n.Lwrcr3_\\@:\n\t \n\torq     $(PTI_USER_PGTABLE_MASK), \\scratch_reg\n\tmov\t\\scratch_reg, %cr3\n.Lend_\\@:\n.endm\n\n.macro SWITCH_TO_USER_CR3_STACK\tscratch_reg:req\n\tpushq\t%rax\n\tSWITCH_TO_USER_CR3_NOSTACK scratch_reg=\\scratch_reg scratch_reg2=%rax\n\tpopq\t%rax\n.endm\n\n.macro SAVE_AND_SWITCH_TO_KERNEL_CR3 scratch_reg:req save_reg:req\n\tALTERNATIVE \"jmp .Ldone_\\@\", \"\", X86_FEATURE_PTI\n\tmovq\t%cr3, \\scratch_reg\n\tmovq\t\\scratch_reg, \\save_reg\n\t \n\tbt\t$PTI_USER_PGTABLE_BIT, \\scratch_reg\n\tjnc\t.Ldone_\\@\n\n\tADJUST_KERNEL_CR3 \\scratch_reg\n\tmovq\t\\scratch_reg, %cr3\n\n.Ldone_\\@:\n.endm\n\n.macro RESTORE_CR3 scratch_reg:req save_reg:req\n\tALTERNATIVE \"jmp .Lend_\\@\", \"\", X86_FEATURE_PTI\n\n\tALTERNATIVE \"jmp .Lwrcr3_\\@\", \"\", X86_FEATURE_PCID\n\n\t \n\tbt\t$PTI_USER_PGTABLE_BIT, \\save_reg\n\tjnc\t.Lnoflush_\\@\n\n\t \n\tmovq\t\\save_reg, \\scratch_reg\n\tandq\t$(0x7FF), \\scratch_reg\n\tbt\t\\scratch_reg, THIS_CPU_user_pcid_flush_mask\n\tjnc\t.Lnoflush_\\@\n\n\tbtr\t\\scratch_reg, THIS_CPU_user_pcid_flush_mask\n\tjmp\t.Lwrcr3_\\@\n\n.Lnoflush_\\@:\n\tSET_NOFLUSH_BIT \\save_reg\n\n.Lwrcr3_\\@:\n\t \n\tmovq\t\\save_reg, %cr3\n.Lend_\\@:\n.endm\n\n#else  \n\n.macro SWITCH_TO_KERNEL_CR3 scratch_reg:req\n.endm\n.macro SWITCH_TO_USER_CR3_NOSTACK scratch_reg:req scratch_reg2:req\n.endm\n.macro SWITCH_TO_USER_CR3_STACK scratch_reg:req\n.endm\n.macro SAVE_AND_SWITCH_TO_KERNEL_CR3 scratch_reg:req save_reg:req\n.endm\n.macro RESTORE_CR3 scratch_reg:req save_reg:req\n.endm\n\n#endif\n\n \n.macro IBRS_ENTER save_reg\n#ifdef CONFIG_CPU_IBRS_ENTRY\n\tALTERNATIVE \"jmp .Lend_\\@\", \"\", X86_FEATURE_KERNEL_IBRS\n\tmovl\t$MSR_IA32_SPEC_CTRL, %ecx\n\n.ifnb \\save_reg\n\trdmsr\n\tshl\t$32, %rdx\n\tor\t%rdx, %rax\n\tmov\t%rax, \\save_reg\n\ttest\t$SPEC_CTRL_IBRS, %eax\n\tjz\t.Ldo_wrmsr_\\@\n\tlfence\n\tjmp\t.Lend_\\@\n.Ldo_wrmsr_\\@:\n.endif\n\n\tmovq\tPER_CPU_VAR(x86_spec_ctrl_current), %rdx\n\tmovl\t%edx, %eax\n\tshr\t$32, %rdx\n\twrmsr\n.Lend_\\@:\n#endif\n.endm\n\n \n.macro IBRS_EXIT save_reg\n#ifdef CONFIG_CPU_IBRS_ENTRY\n\tALTERNATIVE \"jmp .Lend_\\@\", \"\", X86_FEATURE_KERNEL_IBRS\n\tmovl\t$MSR_IA32_SPEC_CTRL, %ecx\n\n.ifnb \\save_reg\n\tmov\t\\save_reg, %rdx\n.else\n\tmovq\tPER_CPU_VAR(x86_spec_ctrl_current), %rdx\n\tandl\t$(~SPEC_CTRL_IBRS), %edx\n.endif\n\n\tmovl\t%edx, %eax\n\tshr\t$32, %rdx\n\twrmsr\n.Lend_\\@:\n#endif\n.endm\n\n \n.macro FENCE_SWAPGS_USER_ENTRY\n\tALTERNATIVE \"\", \"lfence\", X86_FEATURE_FENCE_SWAPGS_USER\n.endm\n.macro FENCE_SWAPGS_KERNEL_ENTRY\n\tALTERNATIVE \"\", \"lfence\", X86_FEATURE_FENCE_SWAPGS_KERNEL\n.endm\n\n.macro STACKLEAK_ERASE_NOCLOBBER\n#ifdef CONFIG_GCC_PLUGIN_STACKLEAK\n\tPUSH_AND_CLEAR_REGS\n\tcall stackleak_erase\n\tPOP_REGS\n#endif\n.endm\n\n.macro SAVE_AND_SET_GSBASE scratch_reg:req save_reg:req\n\trdgsbase \\save_reg\n\tGET_PERCPU_BASE \\scratch_reg\n\twrgsbase \\scratch_reg\n.endm\n\n#else  \n# undef\t\tUNWIND_HINT_IRET_REGS\n# define\tUNWIND_HINT_IRET_REGS\n#endif  \n\n.macro STACKLEAK_ERASE\n#ifdef CONFIG_GCC_PLUGIN_STACKLEAK\n\tcall stackleak_erase\n#endif\n.endm\n\n#ifdef CONFIG_SMP\n\n \n.macro LOAD_CPU_AND_NODE_SEG_LIMIT reg:req\n\tmovq\t$__CPUNODE_SEG, \\reg\n\tlsl\t\\reg, \\reg\n.endm\n\n \n.macro GET_PERCPU_BASE reg:req\n\tLOAD_CPU_AND_NODE_SEG_LIMIT \\reg\n\tandq\t$VDSO_CPUNODE_MASK, \\reg\n\tmovq\t__per_cpu_offset(, \\reg, 8), \\reg\n.endm\n\n#else\n\n.macro GET_PERCPU_BASE reg:req\n\tmovq\tpcpu_unit_offsets(%rip), \\reg\n.endm\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}