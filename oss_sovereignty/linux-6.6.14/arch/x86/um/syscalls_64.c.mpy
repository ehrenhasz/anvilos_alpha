{
  "module_name": "syscalls_64.c",
  "hash_id": "ca3dc105c191c780865d1120c4d2325a65375687656de53cb2da28b038bcc6f0",
  "original_prompt": "Ingested from linux-6.6.14/arch/x86/um/syscalls_64.c",
  "human_readable_source": " \n\n#include <linux/sched.h>\n#include <linux/sched/mm.h>\n#include <linux/syscalls.h>\n#include <linux/uaccess.h>\n#include <asm/prctl.h>  \n#include <registers.h>\n#include <os.h>\n\nlong arch_prctl(struct task_struct *task, int option,\n\t\tunsigned long __user *arg2)\n{\n\tunsigned long *ptr = arg2, tmp;\n\tlong ret;\n\tint pid = task->mm->context.id.u.pid;\n\n\t \n\tswitch (option) {\n\tcase ARCH_SET_FS:\n\tcase ARCH_SET_GS:\n\t\tret = restore_pid_registers(pid, &current->thread.regs.regs);\n\t\tif (ret)\n\t\t\treturn ret;\n\t\tbreak;\n\tcase ARCH_GET_FS:\n\tcase ARCH_GET_GS:\n\t\t \n\t\tptr = &tmp;\n\t}\n\n\tret = os_arch_prctl(pid, option, ptr);\n\tif (ret)\n\t\treturn ret;\n\n\tswitch (option) {\n\tcase ARCH_SET_FS:\n\t\tcurrent->thread.arch.fs = (unsigned long) ptr;\n\t\tret = save_registers(pid, &current->thread.regs.regs);\n\t\tbreak;\n\tcase ARCH_SET_GS:\n\t\tret = save_registers(pid, &current->thread.regs.regs);\n\t\tbreak;\n\tcase ARCH_GET_FS:\n\t\tret = put_user(tmp, arg2);\n\t\tbreak;\n\tcase ARCH_GET_GS:\n\t\tret = put_user(tmp, arg2);\n\t\tbreak;\n\t}\n\n\treturn ret;\n}\n\nSYSCALL_DEFINE2(arch_prctl, int, option, unsigned long, arg2)\n{\n\treturn arch_prctl(current, option, (unsigned long __user *) arg2);\n}\n\nvoid arch_switch_to(struct task_struct *to)\n{\n\tif ((to->thread.arch.fs == 0) || (to->mm == NULL))\n\t\treturn;\n\n\tarch_prctl(to, ARCH_SET_FS, (void __user *) to->thread.arch.fs);\n}\n\nSYSCALL_DEFINE6(mmap, unsigned long, addr, unsigned long, len,\n\t\tunsigned long, prot, unsigned long, flags,\n\t\tunsigned long, fd, unsigned long, off)\n{\n\tif (off & ~PAGE_MASK)\n\t\treturn -EINVAL;\n\n\treturn ksys_mmap_pgoff(addr, len, prot, flags, fd, off >> PAGE_SHIFT);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}