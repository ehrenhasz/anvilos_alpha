{
  "module_name": "pkeys.h",
  "hash_id": "6815762a0156f53391d936539055a73f0bd0011e928774abfba2c48ff8442944",
  "original_prompt": "Ingested from linux-6.6.14/arch/x86/include/asm/pkeys.h",
  "human_readable_source": " \n#ifndef _ASM_X86_PKEYS_H\n#define _ASM_X86_PKEYS_H\n\n \n#define arch_max_pkey() (cpu_feature_enabled(X86_FEATURE_OSPKE) ? 16 : 1)\n\nextern int arch_set_user_pkey_access(struct task_struct *tsk, int pkey,\n\t\tunsigned long init_val);\n\nstatic inline bool arch_pkeys_enabled(void)\n{\n\treturn cpu_feature_enabled(X86_FEATURE_OSPKE);\n}\n\n \nextern int __execute_only_pkey(struct mm_struct *mm);\nstatic inline int execute_only_pkey(struct mm_struct *mm)\n{\n\tif (!cpu_feature_enabled(X86_FEATURE_OSPKE))\n\t\treturn ARCH_DEFAULT_PKEY;\n\n\treturn __execute_only_pkey(mm);\n}\n\nextern int __arch_override_mprotect_pkey(struct vm_area_struct *vma,\n\t\tint prot, int pkey);\nstatic inline int arch_override_mprotect_pkey(struct vm_area_struct *vma,\n\t\tint prot, int pkey)\n{\n\tif (!cpu_feature_enabled(X86_FEATURE_OSPKE))\n\t\treturn 0;\n\n\treturn __arch_override_mprotect_pkey(vma, prot, pkey);\n}\n\n#define ARCH_VM_PKEY_FLAGS (VM_PKEY_BIT0 | VM_PKEY_BIT1 | VM_PKEY_BIT2 | VM_PKEY_BIT3)\n\n#define mm_pkey_allocation_map(mm)\t(mm->context.pkey_allocation_map)\n#define mm_set_pkey_allocated(mm, pkey) do {\t\t\\\n\tmm_pkey_allocation_map(mm) |= (1U << pkey);\t\\\n} while (0)\n#define mm_set_pkey_free(mm, pkey) do {\t\t\t\\\n\tmm_pkey_allocation_map(mm) &= ~(1U << pkey);\t\\\n} while (0)\n\nstatic inline\nbool mm_pkey_is_allocated(struct mm_struct *mm, int pkey)\n{\n\t \n\tif (pkey < 0)\n\t\treturn false;\n\tif (pkey >= arch_max_pkey())\n\t\treturn false;\n\t \n\tif (pkey == mm->context.execute_only_pkey)\n\t\treturn false;\n\n\treturn mm_pkey_allocation_map(mm) & (1U << pkey);\n}\n\n \nstatic inline\nint mm_pkey_alloc(struct mm_struct *mm)\n{\n\t \n\tu16 all_pkeys_mask = ((1U << arch_max_pkey()) - 1);\n\tint ret;\n\n\t \n\tif (mm_pkey_allocation_map(mm) == all_pkeys_mask)\n\t\treturn -1;\n\n\tret = ffz(mm_pkey_allocation_map(mm));\n\n\tmm_set_pkey_allocated(mm, ret);\n\n\treturn ret;\n}\n\nstatic inline\nint mm_pkey_free(struct mm_struct *mm, int pkey)\n{\n\tif (!mm_pkey_is_allocated(mm, pkey))\n\t\treturn -EINVAL;\n\n\tmm_set_pkey_free(mm, pkey);\n\n\treturn 0;\n}\n\nstatic inline int vma_pkey(struct vm_area_struct *vma)\n{\n\tunsigned long vma_pkey_mask = VM_PKEY_BIT0 | VM_PKEY_BIT1 |\n\t\t\t\t      VM_PKEY_BIT2 | VM_PKEY_BIT3;\n\n\treturn (vma->vm_flags & vma_pkey_mask) >> VM_PKEY_SHIFT;\n}\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}