{
  "module_name": "alternative.h",
  "hash_id": "abedd6a9109ff60c2caf30c291390e66524b3dd56803440afe5c30cbc0d85e71",
  "original_prompt": "Ingested from linux-6.6.14/arch/x86/include/asm/alternative.h",
  "human_readable_source": " \n#ifndef _ASM_X86_ALTERNATIVE_H\n#define _ASM_X86_ALTERNATIVE_H\n\n#include <linux/types.h>\n#include <linux/stringify.h>\n#include <asm/asm.h>\n\n#define ALT_FLAGS_SHIFT\t\t16\n\n#define ALT_FLAG_NOT\t\t(1 << 0)\n#define ALT_NOT(feature)\t((ALT_FLAG_NOT << ALT_FLAGS_SHIFT) | (feature))\n\n#ifndef __ASSEMBLY__\n\n#include <linux/stddef.h>\n\n \n\n#ifdef CONFIG_SMP\n#define LOCK_PREFIX_HERE \\\n\t\t\".pushsection .smp_locks,\\\"a\\\"\\n\"\t\\\n\t\t\".balign 4\\n\"\t\t\t\t\\\n\t\t\".long 671f - .\\n\"  \t\t\\\n\t\t\".popsection\\n\"\t\t\t\t\\\n\t\t\"671:\"\n\n#define LOCK_PREFIX LOCK_PREFIX_HERE \"\\n\\tlock; \"\n\n#else  \n#define LOCK_PREFIX_HERE \"\"\n#define LOCK_PREFIX \"\"\n#endif\n\n \n#define ANNOTATE_IGNORE_ALTERNATIVE\t\t\t\t\\\n\t\"999:\\n\\t\"\t\t\t\t\t\t\\\n\t\".pushsection .discard.ignore_alts\\n\\t\"\t\t\t\\\n\t\".long 999b\\n\\t\"\t\t\t\t\t\\\n\t\".popsection\\n\\t\"\n\n \nstruct alt_instr {\n\ts32 instr_offset;\t \n\ts32 repl_offset;\t \n\n\tunion {\n\t\tstruct {\n\t\t\tu32 cpuid: 16;\t \n\t\t\tu32 flags: 16;\t \n\t\t};\n\t\tu32 ft_flags;\n\t};\n\n\tu8  instrlen;\t\t \n\tu8  replacementlen;\t \n} __packed;\n\n \nextern int alternatives_patched;\n\nextern void alternative_instructions(void);\nextern void apply_alternatives(struct alt_instr *start, struct alt_instr *end);\nextern void apply_retpolines(s32 *start, s32 *end);\nextern void apply_returns(s32 *start, s32 *end);\nextern void apply_seal_endbr(s32 *start, s32 *end);\nextern void apply_fineibt(s32 *start_retpoline, s32 *end_retpoine,\n\t\t\t  s32 *start_cfi, s32 *end_cfi);\n\nstruct module;\nstruct paravirt_patch_site;\n\nstruct callthunk_sites {\n\ts32\t\t\t\t*call_start, *call_end;\n\tstruct paravirt_patch_site\t*pv_start, *pv_end;\n};\n\n#ifdef CONFIG_CALL_THUNKS\nextern void callthunks_patch_builtin_calls(void);\nextern void callthunks_patch_module_calls(struct callthunk_sites *sites,\n\t\t\t\t\t  struct module *mod);\nextern void *callthunks_translate_call_dest(void *dest);\nextern int x86_call_depth_emit_accounting(u8 **pprog, void *func);\n#else\nstatic __always_inline void callthunks_patch_builtin_calls(void) {}\nstatic __always_inline void\ncallthunks_patch_module_calls(struct callthunk_sites *sites,\n\t\t\t      struct module *mod) {}\nstatic __always_inline void *callthunks_translate_call_dest(void *dest)\n{\n\treturn dest;\n}\nstatic __always_inline int x86_call_depth_emit_accounting(u8 **pprog,\n\t\t\t\t\t\t\t  void *func)\n{\n\treturn 0;\n}\n#endif\n\n#ifdef CONFIG_SMP\nextern void alternatives_smp_module_add(struct module *mod, char *name,\n\t\t\t\t\tvoid *locks, void *locks_end,\n\t\t\t\t\tvoid *text, void *text_end);\nextern void alternatives_smp_module_del(struct module *mod);\nextern void alternatives_enable_smp(void);\nextern int alternatives_text_reserved(void *start, void *end);\nextern bool skip_smp_alternatives;\n#else\nstatic inline void alternatives_smp_module_add(struct module *mod, char *name,\n\t\t\t\t\t       void *locks, void *locks_end,\n\t\t\t\t\t       void *text, void *text_end) {}\nstatic inline void alternatives_smp_module_del(struct module *mod) {}\nstatic inline void alternatives_enable_smp(void) {}\nstatic inline int alternatives_text_reserved(void *start, void *end)\n{\n\treturn 0;\n}\n#endif\t \n\n#define b_replacement(num)\t\"664\"#num\n#define e_replacement(num)\t\"665\"#num\n\n#define alt_end_marker\t\t\"663\"\n#define alt_slen\t\t\"662b-661b\"\n#define alt_total_slen\t\talt_end_marker\"b-661b\"\n#define alt_rlen(num)\t\te_replacement(num)\"f-\"b_replacement(num)\"f\"\n\n#define OLDINSTR(oldinstr, num)\t\t\t\t\t\t\\\n\t\"# ALT: oldnstr\\n\"\t\t\t\t\t\t\\\n\t\"661:\\n\\t\" oldinstr \"\\n662:\\n\"\t\t\t\t\t\\\n\t\"# ALT: padding\\n\"\t\t\t\t\t\t\\\n\t\".skip -(((\" alt_rlen(num) \")-(\" alt_slen \")) > 0) * \"\t\t\\\n\t\t\"((\" alt_rlen(num) \")-(\" alt_slen \")),0x90\\n\"\t\t\\\n\talt_end_marker \":\\n\"\n\n \n#define alt_max_short(a, b)\t\"((\" a \") ^ (((\" a \") ^ (\" b \")) & -(-((\" a \") < (\" b \")))))\"\n\n \n#define OLDINSTR_2(oldinstr, num1, num2) \\\n\t\"# ALT: oldinstr2\\n\"\t\t\t\t\t\t\t\t\t\\\n\t\"661:\\n\\t\" oldinstr \"\\n662:\\n\"\t\t\t\t\t\t\t\t\\\n\t\"# ALT: padding2\\n\"\t\t\t\t\t\t\t\t\t\\\n\t\".skip -((\" alt_max_short(alt_rlen(num1), alt_rlen(num2)) \" - (\" alt_slen \")) > 0) * \"\t\\\n\t\t\"(\" alt_max_short(alt_rlen(num1), alt_rlen(num2)) \" - (\" alt_slen \")), 0x90\\n\"\t\\\n\talt_end_marker \":\\n\"\n\n#define OLDINSTR_3(oldinsn, n1, n2, n3)\t\t\t\t\t\t\t\t\\\n\t\"# ALT: oldinstr3\\n\"\t\t\t\t\t\t\t\t\t\\\n\t\"661:\\n\\t\" oldinsn \"\\n662:\\n\"\t\t\t\t\t\t\t\t\\\n\t\"# ALT: padding3\\n\"\t\t\t\t\t\t\t\t\t\\\n\t\".skip -((\" alt_max_short(alt_max_short(alt_rlen(n1), alt_rlen(n2)), alt_rlen(n3))\t\\\n\t\t\" - (\" alt_slen \")) > 0) * \"\t\t\t\t\t\t\t\\\n\t\t\"(\" alt_max_short(alt_max_short(alt_rlen(n1), alt_rlen(n2)), alt_rlen(n3))\t\\\n\t\t\" - (\" alt_slen \")), 0x90\\n\"\t\t\t\t\t\t\t\\\n\talt_end_marker \":\\n\"\n\n#define ALTINSTR_ENTRY(ft_flags, num)\t\t\t\t\t      \\\n\t\" .long 661b - .\\n\"\t\t\t\t  \\\n\t\" .long \" b_replacement(num)\"f - .\\n\"\t\t  \\\n\t\" .4byte \" __stringify(ft_flags) \"\\n\"\t\t  \\\n\t\" .byte \" alt_total_slen \"\\n\"\t\t\t  \\\n\t\" .byte \" alt_rlen(num) \"\\n\"\t\t\t \n\n#define ALTINSTR_REPLACEMENT(newinstr, num)\t\t \t\\\n\t\"# ALT: replacement \" #num \"\\n\"\t\t\t\t\t\t\\\n\tb_replacement(num)\":\\n\\t\" newinstr \"\\n\" e_replacement(num) \":\\n\"\n\n \n#define ALTERNATIVE(oldinstr, newinstr, ft_flags)\t\t\t\\\n\tOLDINSTR(oldinstr, 1)\t\t\t\t\t\t\\\n\t\".pushsection .altinstructions,\\\"a\\\"\\n\"\t\t\t\t\\\n\tALTINSTR_ENTRY(ft_flags, 1)\t\t\t\t\t\\\n\t\".popsection\\n\"\t\t\t\t\t\t\t\\\n\t\".pushsection .altinstr_replacement, \\\"ax\\\"\\n\"\t\t\t\\\n\tALTINSTR_REPLACEMENT(newinstr, 1)\t\t\t\t\\\n\t\".popsection\\n\"\n\n#define ALTERNATIVE_2(oldinstr, newinstr1, ft_flags1, newinstr2, ft_flags2) \\\n\tOLDINSTR_2(oldinstr, 1, 2)\t\t\t\t\t\\\n\t\".pushsection .altinstructions,\\\"a\\\"\\n\"\t\t\t\t\\\n\tALTINSTR_ENTRY(ft_flags1, 1)\t\t\t\t\t\\\n\tALTINSTR_ENTRY(ft_flags2, 2)\t\t\t\t\t\\\n\t\".popsection\\n\"\t\t\t\t\t\t\t\\\n\t\".pushsection .altinstr_replacement, \\\"ax\\\"\\n\"\t\t\t\\\n\tALTINSTR_REPLACEMENT(newinstr1, 1)\t\t\t\t\\\n\tALTINSTR_REPLACEMENT(newinstr2, 2)\t\t\t\t\\\n\t\".popsection\\n\"\n\n \n#define ALTERNATIVE_TERNARY(oldinstr, ft_flags, newinstr_yes, newinstr_no) \\\n\tALTERNATIVE_2(oldinstr, newinstr_no, X86_FEATURE_ALWAYS,\t\\\n\t\t      newinstr_yes, ft_flags)\n\n#define ALTERNATIVE_3(oldinsn, newinsn1, ft_flags1, newinsn2, ft_flags2, \\\n\t\t\tnewinsn3, ft_flags3)\t\t\t\t\\\n\tOLDINSTR_3(oldinsn, 1, 2, 3)\t\t\t\t\t\\\n\t\".pushsection .altinstructions,\\\"a\\\"\\n\"\t\t\t\t\\\n\tALTINSTR_ENTRY(ft_flags1, 1)\t\t\t\t\t\\\n\tALTINSTR_ENTRY(ft_flags2, 2)\t\t\t\t\t\\\n\tALTINSTR_ENTRY(ft_flags3, 3)\t\t\t\t\t\\\n\t\".popsection\\n\"\t\t\t\t\t\t\t\\\n\t\".pushsection .altinstr_replacement, \\\"ax\\\"\\n\"\t\t\t\\\n\tALTINSTR_REPLACEMENT(newinsn1, 1)\t\t\t\t\\\n\tALTINSTR_REPLACEMENT(newinsn2, 2)\t\t\t\t\\\n\tALTINSTR_REPLACEMENT(newinsn3, 3)\t\t\t\t\\\n\t\".popsection\\n\"\n\n \n#define alternative(oldinstr, newinstr, ft_flags)\t\t\t\\\n\tasm_inline volatile (ALTERNATIVE(oldinstr, newinstr, ft_flags) : : : \"memory\")\n\n#define alternative_2(oldinstr, newinstr1, ft_flags1, newinstr2, ft_flags2) \\\n\tasm_inline volatile(ALTERNATIVE_2(oldinstr, newinstr1, ft_flags1, newinstr2, ft_flags2) ::: \"memory\")\n\n#define alternative_ternary(oldinstr, ft_flags, newinstr_yes, newinstr_no) \\\n\tasm_inline volatile(ALTERNATIVE_TERNARY(oldinstr, ft_flags, newinstr_yes, newinstr_no) ::: \"memory\")\n\n \n#define alternative_input(oldinstr, newinstr, ft_flags, input...)\t\\\n\tasm_inline volatile (ALTERNATIVE(oldinstr, newinstr, ft_flags)\t\\\n\t\t: : \"i\" (0), ## input)\n\n \n#define alternative_input_2(oldinstr, newinstr1, ft_flags1, newinstr2,\t     \\\n\t\t\t   ft_flags2, input...)\t\t\t\t     \\\n\tasm_inline volatile(ALTERNATIVE_2(oldinstr, newinstr1, ft_flags1,     \\\n\t\tnewinstr2, ft_flags2)\t\t\t\t\t     \\\n\t\t: : \"i\" (0), ## input)\n\n \n#define alternative_io(oldinstr, newinstr, ft_flags, output, input...)\t\\\n\tasm_inline volatile (ALTERNATIVE(oldinstr, newinstr, ft_flags)\t\\\n\t\t: output : \"i\" (0), ## input)\n\n \n#define alternative_call(oldfunc, newfunc, ft_flags, output, input...)\t\\\n\tasm_inline volatile (ALTERNATIVE(\"call %P[old]\", \"call %P[new]\", ft_flags) \\\n\t\t: output : [old] \"i\" (oldfunc), [new] \"i\" (newfunc), ## input)\n\n \n#define alternative_call_2(oldfunc, newfunc1, ft_flags1, newfunc2, ft_flags2,   \\\n\t\t\t   output, input...)\t\t\t\t      \\\n\tasm_inline volatile (ALTERNATIVE_2(\"call %P[old]\", \"call %P[new1]\", ft_flags1,\\\n\t\t\"call %P[new2]\", ft_flags2)\t\t\t\t      \\\n\t\t: output, ASM_CALL_CONSTRAINT\t\t\t\t      \\\n\t\t: [old] \"i\" (oldfunc), [new1] \"i\" (newfunc1),\t\t      \\\n\t\t  [new2] \"i\" (newfunc2), ## input)\n\n \n#define ASM_OUTPUT2(a...) a\n\n \n#define ASM_NO_INPUT_CLOBBER(clbr...) \"i\" (0) : clbr\n\n#else  \n\n#ifdef CONFIG_SMP\n\t.macro LOCK_PREFIX\n672:\tlock\n\t.pushsection .smp_locks,\"a\"\n\t.balign 4\n\t.long 672b - .\n\t.popsection\n\t.endm\n#else\n\t.macro LOCK_PREFIX\n\t.endm\n#endif\n\n \n.macro ANNOTATE_IGNORE_ALTERNATIVE\n\t.Lannotate_\\@:\n\t.pushsection .discard.ignore_alts\n\t.long .Lannotate_\\@\n\t.popsection\n.endm\n\n \n.macro altinstr_entry orig alt ft_flags orig_len alt_len\n\t.long \\orig - .\n\t.long \\alt - .\n\t.4byte \\ft_flags\n\t.byte \\orig_len\n\t.byte \\alt_len\n.endm\n\n \n.macro ALTERNATIVE oldinstr, newinstr, ft_flags\n140:\n\t\\oldinstr\n141:\n\t.skip -(((144f-143f)-(141b-140b)) > 0) * ((144f-143f)-(141b-140b)),0x90\n142:\n\n\t.pushsection .altinstructions,\"a\"\n\taltinstr_entry 140b,143f,\\ft_flags,142b-140b,144f-143f\n\t.popsection\n\n\t.pushsection .altinstr_replacement,\"ax\"\n143:\n\t\\newinstr\n144:\n\t.popsection\n.endm\n\n#define old_len\t\t\t141b-140b\n#define new_len1\t\t144f-143f\n#define new_len2\t\t145f-144f\n#define new_len3\t\t146f-145f\n\n \n#define alt_max_2(a, b)\t\t((a) ^ (((a) ^ (b)) & -(-((a) < (b)))))\n#define alt_max_3(a, b, c)\t(alt_max_2(alt_max_2(a, b), c))\n\n\n \n.macro ALTERNATIVE_2 oldinstr, newinstr1, ft_flags1, newinstr2, ft_flags2\n140:\n\t\\oldinstr\n141:\n\t.skip -((alt_max_2(new_len1, new_len2) - (old_len)) > 0) * \\\n\t\t(alt_max_2(new_len1, new_len2) - (old_len)),0x90\n142:\n\n\t.pushsection .altinstructions,\"a\"\n\taltinstr_entry 140b,143f,\\ft_flags1,142b-140b,144f-143f\n\taltinstr_entry 140b,144f,\\ft_flags2,142b-140b,145f-144f\n\t.popsection\n\n\t.pushsection .altinstr_replacement,\"ax\"\n143:\n\t\\newinstr1\n144:\n\t\\newinstr2\n145:\n\t.popsection\n.endm\n\n.macro ALTERNATIVE_3 oldinstr, newinstr1, ft_flags1, newinstr2, ft_flags2, newinstr3, ft_flags3\n140:\n\t\\oldinstr\n141:\n\t.skip -((alt_max_3(new_len1, new_len2, new_len3) - (old_len)) > 0) * \\\n\t\t(alt_max_3(new_len1, new_len2, new_len3) - (old_len)),0x90\n142:\n\n\t.pushsection .altinstructions,\"a\"\n\taltinstr_entry 140b,143f,\\ft_flags1,142b-140b,144f-143f\n\taltinstr_entry 140b,144f,\\ft_flags2,142b-140b,145f-144f\n\taltinstr_entry 140b,145f,\\ft_flags3,142b-140b,146f-145f\n\t.popsection\n\n\t.pushsection .altinstr_replacement,\"ax\"\n143:\n\t\\newinstr1\n144:\n\t\\newinstr2\n145:\n\t\\newinstr3\n146:\n\t.popsection\n.endm\n\n \n#define ALTERNATIVE_TERNARY(oldinstr, ft_flags, newinstr_yes, newinstr_no) \\\n\tALTERNATIVE_2 oldinstr, newinstr_no, X86_FEATURE_ALWAYS,\t\\\n\tnewinstr_yes, ft_flags\n\n#endif  \n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}