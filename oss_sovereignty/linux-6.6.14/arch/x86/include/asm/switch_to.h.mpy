{
  "module_name": "switch_to.h",
  "hash_id": "8e8b9c26fdb1dbd9cc415a7b36280adfca5319af93bdbf392696f316b6ae5cc2",
  "original_prompt": "Ingested from linux-6.6.14/arch/x86/include/asm/switch_to.h",
  "human_readable_source": " \n#ifndef _ASM_X86_SWITCH_TO_H\n#define _ASM_X86_SWITCH_TO_H\n\n#include <linux/sched/task_stack.h>\n\nstruct task_struct;  \n\nstruct task_struct *__switch_to_asm(struct task_struct *prev,\n\t\t\t\t    struct task_struct *next);\n\n__visible struct task_struct *__switch_to(struct task_struct *prev,\n\t\t\t\t\t  struct task_struct *next);\n\nasmlinkage void ret_from_fork_asm(void);\n__visible void ret_from_fork(struct task_struct *prev, struct pt_regs *regs,\n\t\t\t     int (*fn)(void *), void *fn_arg);\n\n \nstruct inactive_task_frame {\n#ifdef CONFIG_X86_64\n\tunsigned long r15;\n\tunsigned long r14;\n\tunsigned long r13;\n\tunsigned long r12;\n#else\n\tunsigned long flags;\n\tunsigned long si;\n\tunsigned long di;\n#endif\n\tunsigned long bx;\n\n\t \n\tunsigned long bp;\n\tunsigned long ret_addr;\n};\n\nstruct fork_frame {\n\tstruct inactive_task_frame frame;\n\tstruct pt_regs regs;\n};\n\n#define switch_to(prev, next, last)\t\t\t\t\t\\\ndo {\t\t\t\t\t\t\t\t\t\\\n\t((last) = __switch_to_asm((prev), (next)));\t\t\t\\\n} while (0)\n\n#ifdef CONFIG_X86_32\nstatic inline void refresh_sysenter_cs(struct thread_struct *thread)\n{\n\t \n\tif (unlikely(this_cpu_read(cpu_tss_rw.x86_tss.ss1) == thread->sysenter_cs))\n\t\treturn;\n\n\tthis_cpu_write(cpu_tss_rw.x86_tss.ss1, thread->sysenter_cs);\n\twrmsr(MSR_IA32_SYSENTER_CS, thread->sysenter_cs, 0);\n}\n#endif\n\n \nstatic inline void update_task_stack(struct task_struct *task)\n{\n\t \n#ifdef CONFIG_X86_32\n\tthis_cpu_write(cpu_tss_rw.x86_tss.sp1, task->thread.sp0);\n#else\n\t \n\tif (cpu_feature_enabled(X86_FEATURE_XENPV))\n\t\tload_sp0(task_top_of_stack(task));\n#endif\n}\n\nstatic inline void kthread_frame_init(struct inactive_task_frame *frame,\n\t\t\t\t      int (*fun)(void *), void *arg)\n{\n\tframe->bx = (unsigned long)fun;\n#ifdef CONFIG_X86_32\n\tframe->di = (unsigned long)arg;\n#else\n\tframe->r12 = (unsigned long)arg;\n#endif\n}\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}