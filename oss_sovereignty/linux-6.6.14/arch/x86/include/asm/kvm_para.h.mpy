{
  "module_name": "kvm_para.h",
  "hash_id": "3f7114af7b376e87a9433d20c90636c7b360df557663adc945b3fab600e6b152",
  "original_prompt": "Ingested from linux-6.6.14/arch/x86/include/asm/kvm_para.h",
  "human_readable_source": " \n#ifndef _ASM_X86_KVM_PARA_H\n#define _ASM_X86_KVM_PARA_H\n\n#include <asm/processor.h>\n#include <asm/alternative.h>\n#include <linux/interrupt.h>\n#include <uapi/asm/kvm_para.h>\n\n#include <asm/tdx.h>\n\n#ifdef CONFIG_KVM_GUEST\nbool kvm_check_and_clear_guest_paused(void);\n#else\nstatic inline bool kvm_check_and_clear_guest_paused(void)\n{\n\treturn false;\n}\n#endif  \n\n#define KVM_HYPERCALL \\\n        ALTERNATIVE(\"vmcall\", \"vmmcall\", X86_FEATURE_VMMCALL)\n\n \n\nstatic inline long kvm_hypercall0(unsigned int nr)\n{\n\tlong ret;\n\n\tif (cpu_feature_enabled(X86_FEATURE_TDX_GUEST))\n\t\treturn tdx_kvm_hypercall(nr, 0, 0, 0, 0);\n\n\tasm volatile(KVM_HYPERCALL\n\t\t     : \"=a\"(ret)\n\t\t     : \"a\"(nr)\n\t\t     : \"memory\");\n\treturn ret;\n}\n\nstatic inline long kvm_hypercall1(unsigned int nr, unsigned long p1)\n{\n\tlong ret;\n\n\tif (cpu_feature_enabled(X86_FEATURE_TDX_GUEST))\n\t\treturn tdx_kvm_hypercall(nr, p1, 0, 0, 0);\n\n\tasm volatile(KVM_HYPERCALL\n\t\t     : \"=a\"(ret)\n\t\t     : \"a\"(nr), \"b\"(p1)\n\t\t     : \"memory\");\n\treturn ret;\n}\n\nstatic inline long kvm_hypercall2(unsigned int nr, unsigned long p1,\n\t\t\t\t  unsigned long p2)\n{\n\tlong ret;\n\n\tif (cpu_feature_enabled(X86_FEATURE_TDX_GUEST))\n\t\treturn tdx_kvm_hypercall(nr, p1, p2, 0, 0);\n\n\tasm volatile(KVM_HYPERCALL\n\t\t     : \"=a\"(ret)\n\t\t     : \"a\"(nr), \"b\"(p1), \"c\"(p2)\n\t\t     : \"memory\");\n\treturn ret;\n}\n\nstatic inline long kvm_hypercall3(unsigned int nr, unsigned long p1,\n\t\t\t\t  unsigned long p2, unsigned long p3)\n{\n\tlong ret;\n\n\tif (cpu_feature_enabled(X86_FEATURE_TDX_GUEST))\n\t\treturn tdx_kvm_hypercall(nr, p1, p2, p3, 0);\n\n\tasm volatile(KVM_HYPERCALL\n\t\t     : \"=a\"(ret)\n\t\t     : \"a\"(nr), \"b\"(p1), \"c\"(p2), \"d\"(p3)\n\t\t     : \"memory\");\n\treturn ret;\n}\n\nstatic inline long kvm_hypercall4(unsigned int nr, unsigned long p1,\n\t\t\t\t  unsigned long p2, unsigned long p3,\n\t\t\t\t  unsigned long p4)\n{\n\tlong ret;\n\n\tif (cpu_feature_enabled(X86_FEATURE_TDX_GUEST))\n\t\treturn tdx_kvm_hypercall(nr, p1, p2, p3, p4);\n\n\tasm volatile(KVM_HYPERCALL\n\t\t     : \"=a\"(ret)\n\t\t     : \"a\"(nr), \"b\"(p1), \"c\"(p2), \"d\"(p3), \"S\"(p4)\n\t\t     : \"memory\");\n\treturn ret;\n}\n\nstatic inline long kvm_sev_hypercall3(unsigned int nr, unsigned long p1,\n\t\t\t\t      unsigned long p2, unsigned long p3)\n{\n\tlong ret;\n\n\tasm volatile(\"vmmcall\"\n\t\t     : \"=a\"(ret)\n\t\t     : \"a\"(nr), \"b\"(p1), \"c\"(p2), \"d\"(p3)\n\t\t     : \"memory\");\n\treturn ret;\n}\n\n#ifdef CONFIG_KVM_GUEST\nvoid kvmclock_init(void);\nvoid kvmclock_disable(void);\nbool kvm_para_available(void);\nunsigned int kvm_arch_para_features(void);\nunsigned int kvm_arch_para_hints(void);\nvoid kvm_async_pf_task_wait_schedule(u32 token);\nvoid kvm_async_pf_task_wake(u32 token);\nu32 kvm_read_and_reset_apf_flags(void);\nbool __kvm_handle_async_pf(struct pt_regs *regs, u32 token);\n\nDECLARE_STATIC_KEY_FALSE(kvm_async_pf_enabled);\n\nstatic __always_inline bool kvm_handle_async_pf(struct pt_regs *regs, u32 token)\n{\n\tif (static_branch_unlikely(&kvm_async_pf_enabled))\n\t\treturn __kvm_handle_async_pf(regs, token);\n\telse\n\t\treturn false;\n}\n\n#ifdef CONFIG_PARAVIRT_SPINLOCKS\nvoid __init kvm_spinlock_init(void);\n#else  \nstatic inline void kvm_spinlock_init(void)\n{\n}\n#endif  \n\n#else  \n#define kvm_async_pf_task_wait_schedule(T) do {} while(0)\n#define kvm_async_pf_task_wake(T) do {} while(0)\n\nstatic inline bool kvm_para_available(void)\n{\n\treturn false;\n}\n\nstatic inline unsigned int kvm_arch_para_features(void)\n{\n\treturn 0;\n}\n\nstatic inline unsigned int kvm_arch_para_hints(void)\n{\n\treturn 0;\n}\n\nstatic inline u32 kvm_read_and_reset_apf_flags(void)\n{\n\treturn 0;\n}\n\nstatic __always_inline bool kvm_handle_async_pf(struct pt_regs *regs, u32 token)\n{\n\treturn false;\n}\n#endif\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}