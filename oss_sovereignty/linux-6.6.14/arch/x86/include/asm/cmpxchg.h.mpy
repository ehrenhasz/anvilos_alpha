{
  "module_name": "cmpxchg.h",
  "hash_id": "52111a8f701c4ca5635aaa1ba97bc17539ae3e4e26bc34278299ef0e163ab2ec",
  "original_prompt": "Ingested from linux-6.6.14/arch/x86/include/asm/cmpxchg.h",
  "human_readable_source": " \n#ifndef ASM_X86_CMPXCHG_H\n#define ASM_X86_CMPXCHG_H\n\n#include <linux/compiler.h>\n#include <asm/cpufeatures.h>\n#include <asm/alternative.h>  \n\n \nextern void __xchg_wrong_size(void)\n\t__compiletime_error(\"Bad argument size for xchg\");\nextern void __cmpxchg_wrong_size(void)\n\t__compiletime_error(\"Bad argument size for cmpxchg\");\nextern void __xadd_wrong_size(void)\n\t__compiletime_error(\"Bad argument size for xadd\");\nextern void __add_wrong_size(void)\n\t__compiletime_error(\"Bad argument size for add\");\n\n \n#define __X86_CASE_B\t1\n#define __X86_CASE_W\t2\n#define __X86_CASE_L\t4\n#ifdef CONFIG_64BIT\n#define __X86_CASE_Q\t8\n#else\n#define\t__X86_CASE_Q\t-1\t\t \n#endif\n\n \n#define __xchg_op(ptr, arg, op, lock)\t\t\t\t\t\\\n\t({\t\t\t\t\t\t\t\t\\\n\t        __typeof__ (*(ptr)) __ret = (arg);\t\t\t\\\n\t\tswitch (sizeof(*(ptr))) {\t\t\t\t\\\n\t\tcase __X86_CASE_B:\t\t\t\t\t\\\n\t\t\tasm volatile (lock #op \"b %b0, %1\\n\"\t\t\\\n\t\t\t\t      : \"+q\" (__ret), \"+m\" (*(ptr))\t\\\n\t\t\t\t      : : \"memory\", \"cc\");\t\t\\\n\t\t\tbreak;\t\t\t\t\t\t\\\n\t\tcase __X86_CASE_W:\t\t\t\t\t\\\n\t\t\tasm volatile (lock #op \"w %w0, %1\\n\"\t\t\\\n\t\t\t\t      : \"+r\" (__ret), \"+m\" (*(ptr))\t\\\n\t\t\t\t      : : \"memory\", \"cc\");\t\t\\\n\t\t\tbreak;\t\t\t\t\t\t\\\n\t\tcase __X86_CASE_L:\t\t\t\t\t\\\n\t\t\tasm volatile (lock #op \"l %0, %1\\n\"\t\t\\\n\t\t\t\t      : \"+r\" (__ret), \"+m\" (*(ptr))\t\\\n\t\t\t\t      : : \"memory\", \"cc\");\t\t\\\n\t\t\tbreak;\t\t\t\t\t\t\\\n\t\tcase __X86_CASE_Q:\t\t\t\t\t\\\n\t\t\tasm volatile (lock #op \"q %q0, %1\\n\"\t\t\\\n\t\t\t\t      : \"+r\" (__ret), \"+m\" (*(ptr))\t\\\n\t\t\t\t      : : \"memory\", \"cc\");\t\t\\\n\t\t\tbreak;\t\t\t\t\t\t\\\n\t\tdefault:\t\t\t\t\t\t\\\n\t\t\t__ ## op ## _wrong_size();\t\t\t\\\n\t\t}\t\t\t\t\t\t\t\\\n\t\t__ret;\t\t\t\t\t\t\t\\\n\t})\n\n \n#define arch_xchg(ptr, v)\t__xchg_op((ptr), (v), xchg, \"\")\n\n \n#define __raw_cmpxchg(ptr, old, new, size, lock)\t\t\t\\\n({\t\t\t\t\t\t\t\t\t\\\n\t__typeof__(*(ptr)) __ret;\t\t\t\t\t\\\n\t__typeof__(*(ptr)) __old = (old);\t\t\t\t\\\n\t__typeof__(*(ptr)) __new = (new);\t\t\t\t\\\n\tswitch (size) {\t\t\t\t\t\t\t\\\n\tcase __X86_CASE_B:\t\t\t\t\t\t\\\n\t{\t\t\t\t\t\t\t\t\\\n\t\tvolatile u8 *__ptr = (volatile u8 *)(ptr);\t\t\\\n\t\tasm volatile(lock \"cmpxchgb %2,%1\"\t\t\t\\\n\t\t\t     : \"=a\" (__ret), \"+m\" (*__ptr)\t\t\\\n\t\t\t     : \"q\" (__new), \"0\" (__old)\t\t\t\\\n\t\t\t     : \"memory\");\t\t\t\t\\\n\t\tbreak;\t\t\t\t\t\t\t\\\n\t}\t\t\t\t\t\t\t\t\\\n\tcase __X86_CASE_W:\t\t\t\t\t\t\\\n\t{\t\t\t\t\t\t\t\t\\\n\t\tvolatile u16 *__ptr = (volatile u16 *)(ptr);\t\t\\\n\t\tasm volatile(lock \"cmpxchgw %2,%1\"\t\t\t\\\n\t\t\t     : \"=a\" (__ret), \"+m\" (*__ptr)\t\t\\\n\t\t\t     : \"r\" (__new), \"0\" (__old)\t\t\t\\\n\t\t\t     : \"memory\");\t\t\t\t\\\n\t\tbreak;\t\t\t\t\t\t\t\\\n\t}\t\t\t\t\t\t\t\t\\\n\tcase __X86_CASE_L:\t\t\t\t\t\t\\\n\t{\t\t\t\t\t\t\t\t\\\n\t\tvolatile u32 *__ptr = (volatile u32 *)(ptr);\t\t\\\n\t\tasm volatile(lock \"cmpxchgl %2,%1\"\t\t\t\\\n\t\t\t     : \"=a\" (__ret), \"+m\" (*__ptr)\t\t\\\n\t\t\t     : \"r\" (__new), \"0\" (__old)\t\t\t\\\n\t\t\t     : \"memory\");\t\t\t\t\\\n\t\tbreak;\t\t\t\t\t\t\t\\\n\t}\t\t\t\t\t\t\t\t\\\n\tcase __X86_CASE_Q:\t\t\t\t\t\t\\\n\t{\t\t\t\t\t\t\t\t\\\n\t\tvolatile u64 *__ptr = (volatile u64 *)(ptr);\t\t\\\n\t\tasm volatile(lock \"cmpxchgq %2,%1\"\t\t\t\\\n\t\t\t     : \"=a\" (__ret), \"+m\" (*__ptr)\t\t\\\n\t\t\t     : \"r\" (__new), \"0\" (__old)\t\t\t\\\n\t\t\t     : \"memory\");\t\t\t\t\\\n\t\tbreak;\t\t\t\t\t\t\t\\\n\t}\t\t\t\t\t\t\t\t\\\n\tdefault:\t\t\t\t\t\t\t\\\n\t\t__cmpxchg_wrong_size();\t\t\t\t\t\\\n\t}\t\t\t\t\t\t\t\t\\\n\t__ret;\t\t\t\t\t\t\t\t\\\n})\n\n#define __cmpxchg(ptr, old, new, size)\t\t\t\t\t\\\n\t__raw_cmpxchg((ptr), (old), (new), (size), LOCK_PREFIX)\n\n#define __sync_cmpxchg(ptr, old, new, size)\t\t\t\t\\\n\t__raw_cmpxchg((ptr), (old), (new), (size), \"lock; \")\n\n#define __cmpxchg_local(ptr, old, new, size)\t\t\t\t\\\n\t__raw_cmpxchg((ptr), (old), (new), (size), \"\")\n\n#ifdef CONFIG_X86_32\n# include <asm/cmpxchg_32.h>\n#else\n# include <asm/cmpxchg_64.h>\n#endif\n\n#define arch_cmpxchg(ptr, old, new)\t\t\t\t\t\\\n\t__cmpxchg(ptr, old, new, sizeof(*(ptr)))\n\n#define arch_sync_cmpxchg(ptr, old, new)\t\t\t\t\\\n\t__sync_cmpxchg(ptr, old, new, sizeof(*(ptr)))\n\n#define arch_cmpxchg_local(ptr, old, new)\t\t\t\t\\\n\t__cmpxchg_local(ptr, old, new, sizeof(*(ptr)))\n\n\n#define __raw_try_cmpxchg(_ptr, _pold, _new, size, lock)\t\t\\\n({\t\t\t\t\t\t\t\t\t\\\n\tbool success;\t\t\t\t\t\t\t\\\n\t__typeof__(_ptr) _old = (__typeof__(_ptr))(_pold);\t\t\\\n\t__typeof__(*(_ptr)) __old = *_old;\t\t\t\t\\\n\t__typeof__(*(_ptr)) __new = (_new);\t\t\t\t\\\n\tswitch (size) {\t\t\t\t\t\t\t\\\n\tcase __X86_CASE_B:\t\t\t\t\t\t\\\n\t{\t\t\t\t\t\t\t\t\\\n\t\tvolatile u8 *__ptr = (volatile u8 *)(_ptr);\t\t\\\n\t\tasm volatile(lock \"cmpxchgb %[new], %[ptr]\"\t\t\\\n\t\t\t     CC_SET(z)\t\t\t\t\t\\\n\t\t\t     : CC_OUT(z) (success),\t\t\t\\\n\t\t\t       [ptr] \"+m\" (*__ptr),\t\t\t\\\n\t\t\t       [old] \"+a\" (__old)\t\t\t\\\n\t\t\t     : [new] \"q\" (__new)\t\t\t\\\n\t\t\t     : \"memory\");\t\t\t\t\\\n\t\tbreak;\t\t\t\t\t\t\t\\\n\t}\t\t\t\t\t\t\t\t\\\n\tcase __X86_CASE_W:\t\t\t\t\t\t\\\n\t{\t\t\t\t\t\t\t\t\\\n\t\tvolatile u16 *__ptr = (volatile u16 *)(_ptr);\t\t\\\n\t\tasm volatile(lock \"cmpxchgw %[new], %[ptr]\"\t\t\\\n\t\t\t     CC_SET(z)\t\t\t\t\t\\\n\t\t\t     : CC_OUT(z) (success),\t\t\t\\\n\t\t\t       [ptr] \"+m\" (*__ptr),\t\t\t\\\n\t\t\t       [old] \"+a\" (__old)\t\t\t\\\n\t\t\t     : [new] \"r\" (__new)\t\t\t\\\n\t\t\t     : \"memory\");\t\t\t\t\\\n\t\tbreak;\t\t\t\t\t\t\t\\\n\t}\t\t\t\t\t\t\t\t\\\n\tcase __X86_CASE_L:\t\t\t\t\t\t\\\n\t{\t\t\t\t\t\t\t\t\\\n\t\tvolatile u32 *__ptr = (volatile u32 *)(_ptr);\t\t\\\n\t\tasm volatile(lock \"cmpxchgl %[new], %[ptr]\"\t\t\\\n\t\t\t     CC_SET(z)\t\t\t\t\t\\\n\t\t\t     : CC_OUT(z) (success),\t\t\t\\\n\t\t\t       [ptr] \"+m\" (*__ptr),\t\t\t\\\n\t\t\t       [old] \"+a\" (__old)\t\t\t\\\n\t\t\t     : [new] \"r\" (__new)\t\t\t\\\n\t\t\t     : \"memory\");\t\t\t\t\\\n\t\tbreak;\t\t\t\t\t\t\t\\\n\t}\t\t\t\t\t\t\t\t\\\n\tcase __X86_CASE_Q:\t\t\t\t\t\t\\\n\t{\t\t\t\t\t\t\t\t\\\n\t\tvolatile u64 *__ptr = (volatile u64 *)(_ptr);\t\t\\\n\t\tasm volatile(lock \"cmpxchgq %[new], %[ptr]\"\t\t\\\n\t\t\t     CC_SET(z)\t\t\t\t\t\\\n\t\t\t     : CC_OUT(z) (success),\t\t\t\\\n\t\t\t       [ptr] \"+m\" (*__ptr),\t\t\t\\\n\t\t\t       [old] \"+a\" (__old)\t\t\t\\\n\t\t\t     : [new] \"r\" (__new)\t\t\t\\\n\t\t\t     : \"memory\");\t\t\t\t\\\n\t\tbreak;\t\t\t\t\t\t\t\\\n\t}\t\t\t\t\t\t\t\t\\\n\tdefault:\t\t\t\t\t\t\t\\\n\t\t__cmpxchg_wrong_size();\t\t\t\t\t\\\n\t}\t\t\t\t\t\t\t\t\\\n\tif (unlikely(!success))\t\t\t\t\t\t\\\n\t\t*_old = __old;\t\t\t\t\t\t\\\n\tlikely(success);\t\t\t\t\t\t\\\n})\n\n#define __try_cmpxchg(ptr, pold, new, size)\t\t\t\t\\\n\t__raw_try_cmpxchg((ptr), (pold), (new), (size), LOCK_PREFIX)\n\n#define __try_cmpxchg_local(ptr, pold, new, size)\t\t\t\\\n\t__raw_try_cmpxchg((ptr), (pold), (new), (size), \"\")\n\n#define arch_try_cmpxchg(ptr, pold, new) \t\t\t\t\\\n\t__try_cmpxchg((ptr), (pold), (new), sizeof(*(ptr)))\n\n#define arch_try_cmpxchg_local(ptr, pold, new)\t\t\t\t\\\n\t__try_cmpxchg_local((ptr), (pold), (new), sizeof(*(ptr)))\n\n \n#define __xadd(ptr, inc, lock)\t__xchg_op((ptr), (inc), xadd, lock)\n#define xadd(ptr, inc)\t\t__xadd((ptr), (inc), LOCK_PREFIX)\n\n#endif\t \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}