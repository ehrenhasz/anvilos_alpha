{
  "module_name": "segment.h",
  "hash_id": "c2971cad1b3d0d60eb38f7b73809c52c522d2c739a2a3efed21a503a3f5f6ef6",
  "original_prompt": "Ingested from linux-6.6.14/arch/x86/include/asm/segment.h",
  "human_readable_source": " \n#ifndef _ASM_X86_SEGMENT_H\n#define _ASM_X86_SEGMENT_H\n\n#include <linux/const.h>\n#include <asm/alternative.h>\n#include <asm/ibt.h>\n\n \n#define GDT_ENTRY(flags, base, limit)\t\t\t\\\n\t((((base)  & _AC(0xff000000,ULL)) << (56-24)) |\t\\\n\t (((flags) & _AC(0x0000f0ff,ULL)) << 40) |\t\\\n\t (((limit) & _AC(0x000f0000,ULL)) << (48-16)) |\t\\\n\t (((base)  & _AC(0x00ffffff,ULL)) << 16) |\t\\\n\t (((limit) & _AC(0x0000ffff,ULL))))\n\n \n\n#define GDT_ENTRY_BOOT_CS\t2\n#define GDT_ENTRY_BOOT_DS\t3\n#define GDT_ENTRY_BOOT_TSS\t4\n#define __BOOT_CS\t\t(GDT_ENTRY_BOOT_CS*8)\n#define __BOOT_DS\t\t(GDT_ENTRY_BOOT_DS*8)\n#define __BOOT_TSS\t\t(GDT_ENTRY_BOOT_TSS*8)\n\n \n#define SEGMENT_RPL_MASK\t0x3\n\n \n#define USER_SEGMENT_RPL_MASK\t0x2\n\n \n#define USER_RPL\t\t0x3\n\n \n#define SEGMENT_TI_MASK\t\t0x4\n \n#define SEGMENT_LDT\t\t0x4\n \n#define SEGMENT_GDT\t\t0x0\n\n#define GDT_ENTRY_INVALID_SEG\t0\n\n#if defined(CONFIG_X86_32) && !defined(BUILD_VDSO32_64)\n \n#define GDT_ENTRY_TLS_MIN\t\t6\n#define GDT_ENTRY_TLS_MAX \t\t(GDT_ENTRY_TLS_MIN + GDT_ENTRY_TLS_ENTRIES - 1)\n\n#define GDT_ENTRY_KERNEL_CS\t\t12\n#define GDT_ENTRY_KERNEL_DS\t\t13\n#define GDT_ENTRY_DEFAULT_USER_CS\t14\n#define GDT_ENTRY_DEFAULT_USER_DS\t15\n#define GDT_ENTRY_TSS\t\t\t16\n#define GDT_ENTRY_LDT\t\t\t17\n#define GDT_ENTRY_PNPBIOS_CS32\t\t18\n#define GDT_ENTRY_PNPBIOS_CS16\t\t19\n#define GDT_ENTRY_PNPBIOS_DS\t\t20\n#define GDT_ENTRY_PNPBIOS_TS1\t\t21\n#define GDT_ENTRY_PNPBIOS_TS2\t\t22\n#define GDT_ENTRY_APMBIOS_BASE\t\t23\n\n#define GDT_ENTRY_ESPFIX_SS\t\t26\n#define GDT_ENTRY_PERCPU\t\t27\n#define GDT_ENTRY_CPUNODE\t\t28\n\n#define GDT_ENTRY_DOUBLEFAULT_TSS\t31\n\n \n#define GDT_ENTRIES\t\t\t32\n\n \n\n#define __KERNEL_CS\t\t\t(GDT_ENTRY_KERNEL_CS*8)\n#define __KERNEL_DS\t\t\t(GDT_ENTRY_KERNEL_DS*8)\n#define __USER_DS\t\t\t(GDT_ENTRY_DEFAULT_USER_DS*8 + 3)\n#define __USER_CS\t\t\t(GDT_ENTRY_DEFAULT_USER_CS*8 + 3)\n#define __USER32_CS\t\t\t__USER_CS\n#define __ESPFIX_SS\t\t\t(GDT_ENTRY_ESPFIX_SS*8)\n\n \n#define PNP_CS32\t\t\t(GDT_ENTRY_PNPBIOS_CS32*8)\n \n#define PNP_CS16\t\t\t(GDT_ENTRY_PNPBIOS_CS16*8)\n\n \n#define SEGMENT_IS_PNP_CODE(x)\t\t(((x) & 0xf4) == PNP_CS32)\n\n \n#define PNP_DS\t\t\t\t(GDT_ENTRY_PNPBIOS_DS*8)\n \n#define PNP_TS1\t\t\t\t(GDT_ENTRY_PNPBIOS_TS1*8)\n \n#define PNP_TS2\t\t\t\t(GDT_ENTRY_PNPBIOS_TS2*8)\n\n#ifdef CONFIG_SMP\n# define __KERNEL_PERCPU\t\t(GDT_ENTRY_PERCPU*8)\n#else\n# define __KERNEL_PERCPU\t\t0\n#endif\n\n#define __CPUNODE_SEG\t\t\t(GDT_ENTRY_CPUNODE*8 + 3)\n\n#else  \n\n#include <asm/cache.h>\n\n#define GDT_ENTRY_KERNEL32_CS\t\t1\n#define GDT_ENTRY_KERNEL_CS\t\t2\n#define GDT_ENTRY_KERNEL_DS\t\t3\n\n \n#define GDT_ENTRY_DEFAULT_USER32_CS\t4\n#define GDT_ENTRY_DEFAULT_USER_DS\t5\n#define GDT_ENTRY_DEFAULT_USER_CS\t6\n\n \n#define GDT_ENTRY_TSS\t\t\t8\n \n#define GDT_ENTRY_LDT\t\t\t10\n\n#define GDT_ENTRY_TLS_MIN\t\t12\n#define GDT_ENTRY_TLS_MAX\t\t14\n\n#define GDT_ENTRY_CPUNODE\t\t15\n\n \n#define GDT_ENTRIES\t\t\t16\n\n \n#define __KERNEL32_CS\t\t\t(GDT_ENTRY_KERNEL32_CS*8)\n#define __KERNEL_CS\t\t\t(GDT_ENTRY_KERNEL_CS*8)\n#define __KERNEL_DS\t\t\t(GDT_ENTRY_KERNEL_DS*8)\n#define __USER32_CS\t\t\t(GDT_ENTRY_DEFAULT_USER32_CS*8 + 3)\n#define __USER_DS\t\t\t(GDT_ENTRY_DEFAULT_USER_DS*8 + 3)\n#define __USER_CS\t\t\t(GDT_ENTRY_DEFAULT_USER_CS*8 + 3)\n#define __CPUNODE_SEG\t\t\t(GDT_ENTRY_CPUNODE*8 + 3)\n\n#endif\n\n#define IDT_ENTRIES\t\t\t256\n#define NUM_EXCEPTION_VECTORS\t\t32\n\n \n#define EXCEPTION_ERRCODE_MASK\t\t0x20027d00\n\n#define GDT_SIZE\t\t\t(GDT_ENTRIES*8)\n#define GDT_ENTRY_TLS_ENTRIES\t\t3\n#define TLS_SIZE\t\t\t(GDT_ENTRY_TLS_ENTRIES* 8)\n\n \n#define VDSO_CPUNODE_BITS\t\t12\n#define VDSO_CPUNODE_MASK\t\t0xfff\n\n#ifndef __ASSEMBLY__\n\n \n\nstatic inline unsigned long vdso_encode_cpunode(int cpu, unsigned long node)\n{\n\treturn (node << VDSO_CPUNODE_BITS) | cpu;\n}\n\nstatic inline void vdso_read_cpunode(unsigned *cpu, unsigned *node)\n{\n\tunsigned int p;\n\n\t \n\talternative_io (\"lsl %[seg],%[p]\",\n\t\t\t\".byte 0xf3,0x0f,0xc7,0xf8\",  \n\t\t\tX86_FEATURE_RDPID,\n\t\t\t[p] \"=a\" (p), [seg] \"r\" (__CPUNODE_SEG));\n\n\tif (cpu)\n\t\t*cpu = (p & VDSO_CPUNODE_MASK);\n\tif (node)\n\t\t*node = (p >> VDSO_CPUNODE_BITS);\n}\n\n#endif  \n\n#ifdef __KERNEL__\n\n \n#define EARLY_IDT_HANDLER_SIZE (9 + ENDBR_INSN_SIZE)\n\n \n#define XEN_EARLY_IDT_HANDLER_SIZE (8 + ENDBR_INSN_SIZE)\n\n#ifndef __ASSEMBLY__\n\nextern const char early_idt_handler_array[NUM_EXCEPTION_VECTORS][EARLY_IDT_HANDLER_SIZE];\nextern void early_ignore_irq(void);\n\n#ifdef CONFIG_XEN_PV\nextern const char xen_early_idt_handler_array[NUM_EXCEPTION_VECTORS][XEN_EARLY_IDT_HANDLER_SIZE];\n#endif\n\n \n#define __loadsegment_simple(seg, value)\t\t\t\t\\\ndo {\t\t\t\t\t\t\t\t\t\\\n\tunsigned short __val = (value);\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\tasm volatile(\"\t\t\t\t\t\t\\n\"\t\\\n\t\t     \"1:\tmovl %k0,%%\" #seg \"\t\t\\n\"\t\\\n\t\t     _ASM_EXTABLE_TYPE_REG(1b, 1b, EX_TYPE_ZERO_REG, %k0)\\\n\t\t     : \"+r\" (__val) : : \"memory\");\t\t\t\\\n} while (0)\n\n#define __loadsegment_ss(value) __loadsegment_simple(ss, (value))\n#define __loadsegment_ds(value) __loadsegment_simple(ds, (value))\n#define __loadsegment_es(value) __loadsegment_simple(es, (value))\n\n#ifdef CONFIG_X86_32\n\n \n#define __loadsegment_fs(value) __loadsegment_simple(fs, (value))\n#define __loadsegment_gs(value) __loadsegment_simple(gs, (value))\n\n#else\n\nstatic inline void __loadsegment_fs(unsigned short value)\n{\n\tasm volatile(\"\t\t\t\t\t\t\\n\"\n\t\t     \"1:\tmovw %0, %%fs\t\t\t\\n\"\n\t\t     \"2:\t\t\t\t\t\\n\"\n\n\t\t     _ASM_EXTABLE_TYPE(1b, 2b, EX_TYPE_CLEAR_FS)\n\n\t\t     : : \"rm\" (value) : \"memory\");\n}\n\n \n\n#endif\n\n#define loadsegment(seg, value) __loadsegment_ ## seg (value)\n\n \n#define savesegment(seg, value)\t\t\t\t\\\n\tasm(\"mov %%\" #seg \",%0\":\"=r\" (value) : : \"memory\")\n\n#endif  \n#endif  \n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}