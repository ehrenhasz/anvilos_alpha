{
  "module_name": "cmpxchg_32.h",
  "hash_id": "4e04af6aff6d6ad6d53840111f44b56d311bb755e0724d8cf2f70604cf57ea70",
  "original_prompt": "Ingested from linux-6.6.14/arch/x86/include/asm/cmpxchg_32.h",
  "human_readable_source": " \n#ifndef _ASM_X86_CMPXCHG_32_H\n#define _ASM_X86_CMPXCHG_32_H\n\n \n\n#ifdef CONFIG_X86_CMPXCHG64\n#define arch_cmpxchg64(ptr, o, n)\t\t\t\t\t\\\n\t((__typeof__(*(ptr)))__cmpxchg64((ptr), (unsigned long long)(o), \\\n\t\t\t\t\t (unsigned long long)(n)))\n#define arch_cmpxchg64_local(ptr, o, n)\t\t\t\t\t\\\n\t((__typeof__(*(ptr)))__cmpxchg64_local((ptr), (unsigned long long)(o), \\\n\t\t\t\t\t       (unsigned long long)(n)))\n#define arch_try_cmpxchg64(ptr, po, n)\t\t\t\t\t\\\n\t__try_cmpxchg64((ptr), (unsigned long long *)(po), \\\n\t\t\t(unsigned long long)(n))\n#endif\n\nstatic inline u64 __cmpxchg64(volatile u64 *ptr, u64 old, u64 new)\n{\n\tu64 prev;\n\tasm volatile(LOCK_PREFIX \"cmpxchg8b %1\"\n\t\t     : \"=A\" (prev),\n\t\t       \"+m\" (*ptr)\n\t\t     : \"b\" ((u32)new),\n\t\t       \"c\" ((u32)(new >> 32)),\n\t\t       \"0\" (old)\n\t\t     : \"memory\");\n\treturn prev;\n}\n\nstatic inline u64 __cmpxchg64_local(volatile u64 *ptr, u64 old, u64 new)\n{\n\tu64 prev;\n\tasm volatile(\"cmpxchg8b %1\"\n\t\t     : \"=A\" (prev),\n\t\t       \"+m\" (*ptr)\n\t\t     : \"b\" ((u32)new),\n\t\t       \"c\" ((u32)(new >> 32)),\n\t\t       \"0\" (old)\n\t\t     : \"memory\");\n\treturn prev;\n}\n\nstatic inline bool __try_cmpxchg64(volatile u64 *ptr, u64 *pold, u64 new)\n{\n\tbool success;\n\tu64 old = *pold;\n\tasm volatile(LOCK_PREFIX \"cmpxchg8b %[ptr]\"\n\t\t     CC_SET(z)\n\t\t     : CC_OUT(z) (success),\n\t\t       [ptr] \"+m\" (*ptr),\n\t\t       \"+A\" (old)\n\t\t     : \"b\" ((u32)new),\n\t\t       \"c\" ((u32)(new >> 32))\n\t\t     : \"memory\");\n\n\tif (unlikely(!success))\n\t\t*pold = old;\n\treturn success;\n}\n\n#ifndef CONFIG_X86_CMPXCHG64\n \n\n#define arch_cmpxchg64(ptr, o, n)\t\t\t\t\\\n({\t\t\t\t\t\t\t\t\\\n\t__typeof__(*(ptr)) __ret;\t\t\t\t\\\n\t__typeof__(*(ptr)) __old = (o);\t\t\t\t\\\n\t__typeof__(*(ptr)) __new = (n);\t\t\t\t\\\n\talternative_io(LOCK_PREFIX_HERE\t\t\t\t\\\n\t\t\t\"call cmpxchg8b_emu\",\t\t\t\\\n\t\t\t\"lock; cmpxchg8b (%%esi)\" ,\t\t\\\n\t\t       X86_FEATURE_CX8,\t\t\t\t\\\n\t\t       \"=A\" (__ret),\t\t\t\t\\\n\t\t       \"S\" ((ptr)), \"0\" (__old),\t\t\\\n\t\t       \"b\" ((unsigned int)__new),\t\t\\\n\t\t       \"c\" ((unsigned int)(__new>>32))\t\t\\\n\t\t       : \"memory\");\t\t\t\t\\\n\t__ret; })\n\n\n#define arch_cmpxchg64_local(ptr, o, n)\t\t\t\t\\\n({\t\t\t\t\t\t\t\t\\\n\t__typeof__(*(ptr)) __ret;\t\t\t\t\\\n\t__typeof__(*(ptr)) __old = (o);\t\t\t\t\\\n\t__typeof__(*(ptr)) __new = (n);\t\t\t\t\\\n\talternative_io(\"call cmpxchg8b_emu\",\t\t\t\\\n\t\t       \"cmpxchg8b (%%esi)\" ,\t\t\t\\\n\t\t       X86_FEATURE_CX8,\t\t\t\t\\\n\t\t       \"=A\" (__ret),\t\t\t\t\\\n\t\t       \"S\" ((ptr)), \"0\" (__old),\t\t\\\n\t\t       \"b\" ((unsigned int)__new),\t\t\\\n\t\t       \"c\" ((unsigned int)(__new>>32))\t\t\\\n\t\t       : \"memory\");\t\t\t\t\\\n\t__ret; })\n\n#endif\n\n#define system_has_cmpxchg64()\t\tboot_cpu_has(X86_FEATURE_CX8)\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}