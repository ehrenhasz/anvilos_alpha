{
  "module_name": "debugreg.h",
  "hash_id": "f2d027b99d97bd61ac7f29468248ba51334e26792c4cc83917ed6c50f408727f",
  "original_prompt": "Ingested from linux-6.6.14/arch/x86/include/asm/debugreg.h",
  "human_readable_source": " \n#ifndef _ASM_X86_DEBUGREG_H\n#define _ASM_X86_DEBUGREG_H\n\n#include <linux/bug.h>\n#include <linux/percpu.h>\n#include <uapi/asm/debugreg.h>\n\nDECLARE_PER_CPU(unsigned long, cpu_dr7);\n\n#ifndef CONFIG_PARAVIRT_XXL\n \n#define get_debugreg(var, register)\t\t\t\t\\\n\t(var) = native_get_debugreg(register)\n#define set_debugreg(value, register)\t\t\t\t\\\n\tnative_set_debugreg(register, value)\n#endif\n\nstatic __always_inline unsigned long native_get_debugreg(int regno)\n{\n\tunsigned long val = 0;\t \n\n\tswitch (regno) {\n\tcase 0:\n\t\tasm(\"mov %%db0, %0\" :\"=r\" (val));\n\t\tbreak;\n\tcase 1:\n\t\tasm(\"mov %%db1, %0\" :\"=r\" (val));\n\t\tbreak;\n\tcase 2:\n\t\tasm(\"mov %%db2, %0\" :\"=r\" (val));\n\t\tbreak;\n\tcase 3:\n\t\tasm(\"mov %%db3, %0\" :\"=r\" (val));\n\t\tbreak;\n\tcase 6:\n\t\tasm(\"mov %%db6, %0\" :\"=r\" (val));\n\t\tbreak;\n\tcase 7:\n\t\t \n\t\tasm volatile(\"mov %%db7, %0\" : \"=r\" (val) : __FORCE_ORDER);\n\t\tbreak;\n\tdefault:\n\t\tBUG();\n\t}\n\treturn val;\n}\n\nstatic __always_inline void native_set_debugreg(int regno, unsigned long value)\n{\n\tswitch (regno) {\n\tcase 0:\n\t\tasm(\"mov %0, %%db0\"\t::\"r\" (value));\n\t\tbreak;\n\tcase 1:\n\t\tasm(\"mov %0, %%db1\"\t::\"r\" (value));\n\t\tbreak;\n\tcase 2:\n\t\tasm(\"mov %0, %%db2\"\t::\"r\" (value));\n\t\tbreak;\n\tcase 3:\n\t\tasm(\"mov %0, %%db3\"\t::\"r\" (value));\n\t\tbreak;\n\tcase 6:\n\t\tasm(\"mov %0, %%db6\"\t::\"r\" (value));\n\t\tbreak;\n\tcase 7:\n\t\t \n\t\tasm volatile(\"mov %0, %%db7\"\t::\"r\" (value), __FORCE_ORDER);\n\t\tbreak;\n\tdefault:\n\t\tBUG();\n\t}\n}\n\nstatic inline void hw_breakpoint_disable(void)\n{\n\t \n\tset_debugreg(0UL, 7);\n\n\t \n\tset_debugreg(0UL, 0);\n\tset_debugreg(0UL, 1);\n\tset_debugreg(0UL, 2);\n\tset_debugreg(0UL, 3);\n}\n\nstatic __always_inline bool hw_breakpoint_active(void)\n{\n\treturn __this_cpu_read(cpu_dr7) & DR_GLOBAL_ENABLE_MASK;\n}\n\nextern void hw_breakpoint_restore(void);\n\nstatic __always_inline unsigned long local_db_save(void)\n{\n\tunsigned long dr7;\n\n\tif (static_cpu_has(X86_FEATURE_HYPERVISOR) && !hw_breakpoint_active())\n\t\treturn 0;\n\n\tget_debugreg(dr7, 7);\n\tdr7 &= ~0x400;  \n\tif (dr7)\n\t\tset_debugreg(0, 7);\n\t \n\tbarrier();\n\n\treturn dr7;\n}\n\nstatic __always_inline void local_db_restore(unsigned long dr7)\n{\n\t \n\tbarrier();\n\tif (dr7)\n\t\tset_debugreg(dr7, 7);\n}\n\n#ifdef CONFIG_CPU_SUP_AMD\nextern void amd_set_dr_addr_mask(unsigned long mask, unsigned int dr);\nextern unsigned long amd_get_dr_addr_mask(unsigned int dr);\n#else\nstatic inline void amd_set_dr_addr_mask(unsigned long mask, unsigned int dr) { }\nstatic inline unsigned long amd_get_dr_addr_mask(unsigned int dr)\n{\n\treturn 0;\n}\n#endif\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}