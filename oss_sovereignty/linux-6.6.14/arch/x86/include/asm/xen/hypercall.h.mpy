{
  "module_name": "hypercall.h",
  "hash_id": "ab08c02bffc93f4505c0ecc87cfa7d75d47ffacc6565ac8b2c1ea58d9660d017",
  "original_prompt": "Ingested from linux-6.6.14/arch/x86/include/asm/xen/hypercall.h",
  "human_readable_source": " \n\n#ifndef _ASM_X86_XEN_HYPERCALL_H\n#define _ASM_X86_XEN_HYPERCALL_H\n\n#include <linux/kernel.h>\n#include <linux/spinlock.h>\n#include <linux/errno.h>\n#include <linux/string.h>\n#include <linux/types.h>\n#include <linux/pgtable.h>\n\n#include <trace/events/xen.h>\n\n#include <asm/page.h>\n#include <asm/smap.h>\n#include <asm/nospec-branch.h>\n\n#include <xen/interface/xen.h>\n#include <xen/interface/sched.h>\n#include <xen/interface/physdev.h>\n#include <xen/interface/platform.h>\n#include <xen/interface/xen-mca.h>\n\nstruct xen_dm_op_buf;\n\n \n\nextern struct { char _entry[32]; } hypercall_page[];\n\n#define __HYPERCALL\t\t\"call hypercall_page+%c[offset]\"\n#define __HYPERCALL_ENTRY(x)\t\t\t\t\t\t\\\n\t[offset] \"i\" (__HYPERVISOR_##x * sizeof(hypercall_page[0]))\n\n#ifdef CONFIG_X86_32\n#define __HYPERCALL_RETREG\t\"eax\"\n#define __HYPERCALL_ARG1REG\t\"ebx\"\n#define __HYPERCALL_ARG2REG\t\"ecx\"\n#define __HYPERCALL_ARG3REG\t\"edx\"\n#define __HYPERCALL_ARG4REG\t\"esi\"\n#define __HYPERCALL_ARG5REG\t\"edi\"\n#else\n#define __HYPERCALL_RETREG\t\"rax\"\n#define __HYPERCALL_ARG1REG\t\"rdi\"\n#define __HYPERCALL_ARG2REG\t\"rsi\"\n#define __HYPERCALL_ARG3REG\t\"rdx\"\n#define __HYPERCALL_ARG4REG\t\"r10\"\n#define __HYPERCALL_ARG5REG\t\"r8\"\n#endif\n\n#define __HYPERCALL_DECLS\t\t\t\t\t\t\\\n\tregister unsigned long __res  asm(__HYPERCALL_RETREG);\t\t\\\n\tregister unsigned long __arg1 asm(__HYPERCALL_ARG1REG) = __arg1; \\\n\tregister unsigned long __arg2 asm(__HYPERCALL_ARG2REG) = __arg2; \\\n\tregister unsigned long __arg3 asm(__HYPERCALL_ARG3REG) = __arg3; \\\n\tregister unsigned long __arg4 asm(__HYPERCALL_ARG4REG) = __arg4; \\\n\tregister unsigned long __arg5 asm(__HYPERCALL_ARG5REG) = __arg5;\n\n#define __HYPERCALL_0PARAM\t\"=r\" (__res), ASM_CALL_CONSTRAINT\n#define __HYPERCALL_1PARAM\t__HYPERCALL_0PARAM, \"+r\" (__arg1)\n#define __HYPERCALL_2PARAM\t__HYPERCALL_1PARAM, \"+r\" (__arg2)\n#define __HYPERCALL_3PARAM\t__HYPERCALL_2PARAM, \"+r\" (__arg3)\n#define __HYPERCALL_4PARAM\t__HYPERCALL_3PARAM, \"+r\" (__arg4)\n#define __HYPERCALL_5PARAM\t__HYPERCALL_4PARAM, \"+r\" (__arg5)\n\n#define __HYPERCALL_0ARG()\n#define __HYPERCALL_1ARG(a1)\t\t\t\t\t\t\\\n\t__HYPERCALL_0ARG()\t\t__arg1 = (unsigned long)(a1);\n#define __HYPERCALL_2ARG(a1,a2)\t\t\t\t\t\t\\\n\t__HYPERCALL_1ARG(a1)\t\t__arg2 = (unsigned long)(a2);\n#define __HYPERCALL_3ARG(a1,a2,a3)\t\t\t\t\t\\\n\t__HYPERCALL_2ARG(a1,a2)\t\t__arg3 = (unsigned long)(a3);\n#define __HYPERCALL_4ARG(a1,a2,a3,a4)\t\t\t\t\t\\\n\t__HYPERCALL_3ARG(a1,a2,a3)\t__arg4 = (unsigned long)(a4);\n#define __HYPERCALL_5ARG(a1,a2,a3,a4,a5)\t\t\t\t\\\n\t__HYPERCALL_4ARG(a1,a2,a3,a4)\t__arg5 = (unsigned long)(a5);\n\n#define __HYPERCALL_CLOBBER5\t\"memory\"\n#define __HYPERCALL_CLOBBER4\t__HYPERCALL_CLOBBER5, __HYPERCALL_ARG5REG\n#define __HYPERCALL_CLOBBER3\t__HYPERCALL_CLOBBER4, __HYPERCALL_ARG4REG\n#define __HYPERCALL_CLOBBER2\t__HYPERCALL_CLOBBER3, __HYPERCALL_ARG3REG\n#define __HYPERCALL_CLOBBER1\t__HYPERCALL_CLOBBER2, __HYPERCALL_ARG2REG\n#define __HYPERCALL_CLOBBER0\t__HYPERCALL_CLOBBER1, __HYPERCALL_ARG1REG\n\n#define _hypercall0(type, name)\t\t\t\t\t\t\\\n({\t\t\t\t\t\t\t\t\t\\\n\t__HYPERCALL_DECLS;\t\t\t\t\t\t\\\n\t__HYPERCALL_0ARG();\t\t\t\t\t\t\\\n\tasm volatile (__HYPERCALL\t\t\t\t\t\\\n\t\t      : __HYPERCALL_0PARAM\t\t\t\t\\\n\t\t      : __HYPERCALL_ENTRY(name)\t\t\t\t\\\n\t\t      : __HYPERCALL_CLOBBER0);\t\t\t\t\\\n\t(type)__res;\t\t\t\t\t\t\t\\\n})\n\n#define _hypercall1(type, name, a1)\t\t\t\t\t\\\n({\t\t\t\t\t\t\t\t\t\\\n\t__HYPERCALL_DECLS;\t\t\t\t\t\t\\\n\t__HYPERCALL_1ARG(a1);\t\t\t\t\t\t\\\n\tasm volatile (__HYPERCALL\t\t\t\t\t\\\n\t\t      : __HYPERCALL_1PARAM\t\t\t\t\\\n\t\t      : __HYPERCALL_ENTRY(name)\t\t\t\t\\\n\t\t      : __HYPERCALL_CLOBBER1);\t\t\t\t\\\n\t(type)__res;\t\t\t\t\t\t\t\\\n})\n\n#define _hypercall2(type, name, a1, a2)\t\t\t\t\t\\\n({\t\t\t\t\t\t\t\t\t\\\n\t__HYPERCALL_DECLS;\t\t\t\t\t\t\\\n\t__HYPERCALL_2ARG(a1, a2);\t\t\t\t\t\\\n\tasm volatile (__HYPERCALL\t\t\t\t\t\\\n\t\t      : __HYPERCALL_2PARAM\t\t\t\t\\\n\t\t      : __HYPERCALL_ENTRY(name)\t\t\t\t\\\n\t\t      : __HYPERCALL_CLOBBER2);\t\t\t\t\\\n\t(type)__res;\t\t\t\t\t\t\t\\\n})\n\n#define _hypercall3(type, name, a1, a2, a3)\t\t\t\t\\\n({\t\t\t\t\t\t\t\t\t\\\n\t__HYPERCALL_DECLS;\t\t\t\t\t\t\\\n\t__HYPERCALL_3ARG(a1, a2, a3);\t\t\t\t\t\\\n\tasm volatile (__HYPERCALL\t\t\t\t\t\\\n\t\t      : __HYPERCALL_3PARAM\t\t\t\t\\\n\t\t      : __HYPERCALL_ENTRY(name)\t\t\t\t\\\n\t\t      : __HYPERCALL_CLOBBER3);\t\t\t\t\\\n\t(type)__res;\t\t\t\t\t\t\t\\\n})\n\n#define _hypercall4(type, name, a1, a2, a3, a4)\t\t\t\t\\\n({\t\t\t\t\t\t\t\t\t\\\n\t__HYPERCALL_DECLS;\t\t\t\t\t\t\\\n\t__HYPERCALL_4ARG(a1, a2, a3, a4);\t\t\t\t\\\n\tasm volatile (__HYPERCALL\t\t\t\t\t\\\n\t\t      : __HYPERCALL_4PARAM\t\t\t\t\\\n\t\t      : __HYPERCALL_ENTRY(name)\t\t\t\t\\\n\t\t      : __HYPERCALL_CLOBBER4);\t\t\t\t\\\n\t(type)__res;\t\t\t\t\t\t\t\\\n})\n\nstatic inline long\nxen_single_call(unsigned int call,\n\t\tunsigned long a1, unsigned long a2,\n\t\tunsigned long a3, unsigned long a4,\n\t\tunsigned long a5)\n{\n\t__HYPERCALL_DECLS;\n\t__HYPERCALL_5ARG(a1, a2, a3, a4, a5);\n\n\tif (call >= PAGE_SIZE / sizeof(hypercall_page[0]))\n\t\treturn -EINVAL;\n\n\tasm volatile(CALL_NOSPEC\n\t\t     : __HYPERCALL_5PARAM\n\t\t     : [thunk_target] \"a\" (&hypercall_page[call])\n\t\t     : __HYPERCALL_CLOBBER5);\n\n\treturn (long)__res;\n}\n\nstatic __always_inline void __xen_stac(void)\n{\n\t \n\tasm volatile(ANNOTATE_IGNORE_ALTERNATIVE\n\t\t     ASM_STAC ::: \"memory\", \"flags\");\n}\n\nstatic __always_inline void __xen_clac(void)\n{\n\tasm volatile(ANNOTATE_IGNORE_ALTERNATIVE\n\t\t     ASM_CLAC ::: \"memory\", \"flags\");\n}\n\nstatic inline long\nprivcmd_call(unsigned int call,\n\t     unsigned long a1, unsigned long a2,\n\t     unsigned long a3, unsigned long a4,\n\t     unsigned long a5)\n{\n\tlong res;\n\n\t__xen_stac();\n\tres = xen_single_call(call, a1, a2, a3, a4, a5);\n\t__xen_clac();\n\n\treturn res;\n}\n\n#ifdef CONFIG_XEN_PV\nstatic inline int\nHYPERVISOR_set_trap_table(struct trap_info *table)\n{\n\treturn _hypercall1(int, set_trap_table, table);\n}\n\nstatic inline int\nHYPERVISOR_mmu_update(struct mmu_update *req, int count,\n\t\t      int *success_count, domid_t domid)\n{\n\treturn _hypercall4(int, mmu_update, req, count, success_count, domid);\n}\n\nstatic inline int\nHYPERVISOR_mmuext_op(struct mmuext_op *op, int count,\n\t\t     int *success_count, domid_t domid)\n{\n\treturn _hypercall4(int, mmuext_op, op, count, success_count, domid);\n}\n\nstatic inline int\nHYPERVISOR_set_gdt(unsigned long *frame_list, int entries)\n{\n\treturn _hypercall2(int, set_gdt, frame_list, entries);\n}\n\nstatic inline int\nHYPERVISOR_callback_op(int cmd, void *arg)\n{\n\treturn _hypercall2(int, callback_op, cmd, arg);\n}\n\nstatic __always_inline int\nHYPERVISOR_set_debugreg(int reg, unsigned long value)\n{\n\treturn _hypercall2(int, set_debugreg, reg, value);\n}\n\nstatic __always_inline unsigned long\nHYPERVISOR_get_debugreg(int reg)\n{\n\treturn _hypercall1(unsigned long, get_debugreg, reg);\n}\n\nstatic inline int\nHYPERVISOR_update_descriptor(u64 ma, u64 desc)\n{\n\treturn _hypercall2(int, update_descriptor, ma, desc);\n}\n\nstatic inline int\nHYPERVISOR_update_va_mapping(unsigned long va, pte_t new_val,\n\t\t\t     unsigned long flags)\n{\n\treturn _hypercall3(int, update_va_mapping, va, new_val.pte, flags);\n}\n\nstatic inline int\nHYPERVISOR_set_segment_base(int reg, unsigned long value)\n{\n\treturn _hypercall2(int, set_segment_base, reg, value);\n}\n\nstatic inline void\nMULTI_fpu_taskswitch(struct multicall_entry *mcl, int set)\n{\n\tmcl->op = __HYPERVISOR_fpu_taskswitch;\n\tmcl->args[0] = set;\n\n\ttrace_xen_mc_entry(mcl, 1);\n}\n\nstatic inline void\nMULTI_update_va_mapping(struct multicall_entry *mcl, unsigned long va,\n\t\t\tpte_t new_val, unsigned long flags)\n{\n\tmcl->op = __HYPERVISOR_update_va_mapping;\n\tmcl->args[0] = va;\n\tmcl->args[1] = new_val.pte;\n\tmcl->args[2] = flags;\n\n\ttrace_xen_mc_entry(mcl, 3);\n}\n\nstatic inline void\nMULTI_update_descriptor(struct multicall_entry *mcl, u64 maddr,\n\t\t\tstruct desc_struct desc)\n{\n\tmcl->op = __HYPERVISOR_update_descriptor;\n\tmcl->args[0] = maddr;\n\tmcl->args[1] = *(unsigned long *)&desc;\n\n\ttrace_xen_mc_entry(mcl, 2);\n}\n\nstatic inline void\nMULTI_mmu_update(struct multicall_entry *mcl, struct mmu_update *req,\n\t\t int count, int *success_count, domid_t domid)\n{\n\tmcl->op = __HYPERVISOR_mmu_update;\n\tmcl->args[0] = (unsigned long)req;\n\tmcl->args[1] = count;\n\tmcl->args[2] = (unsigned long)success_count;\n\tmcl->args[3] = domid;\n\n\ttrace_xen_mc_entry(mcl, 4);\n}\n\nstatic inline void\nMULTI_mmuext_op(struct multicall_entry *mcl, struct mmuext_op *op, int count,\n\t\tint *success_count, domid_t domid)\n{\n\tmcl->op = __HYPERVISOR_mmuext_op;\n\tmcl->args[0] = (unsigned long)op;\n\tmcl->args[1] = count;\n\tmcl->args[2] = (unsigned long)success_count;\n\tmcl->args[3] = domid;\n\n\ttrace_xen_mc_entry(mcl, 4);\n}\n\nstatic inline void\nMULTI_stack_switch(struct multicall_entry *mcl,\n\t\t   unsigned long ss, unsigned long esp)\n{\n\tmcl->op = __HYPERVISOR_stack_switch;\n\tmcl->args[0] = ss;\n\tmcl->args[1] = esp;\n\n\ttrace_xen_mc_entry(mcl, 2);\n}\n#endif\n\nstatic __always_inline int\nHYPERVISOR_sched_op(int cmd, void *arg)\n{\n\treturn _hypercall2(int, sched_op, cmd, arg);\n}\n\nstatic inline long\nHYPERVISOR_set_timer_op(u64 timeout)\n{\n\tunsigned long timeout_hi = (unsigned long)(timeout>>32);\n\tunsigned long timeout_lo = (unsigned long)timeout;\n\treturn _hypercall2(long, set_timer_op, timeout_lo, timeout_hi);\n}\n\nstatic inline int\nHYPERVISOR_mca(struct xen_mc *mc_op)\n{\n\tmc_op->interface_version = XEN_MCA_INTERFACE_VERSION;\n\treturn _hypercall1(int, mca, mc_op);\n}\n\nstatic inline int\nHYPERVISOR_platform_op(struct xen_platform_op *op)\n{\n\top->interface_version = XENPF_INTERFACE_VERSION;\n\treturn _hypercall1(int, platform_op, op);\n}\n\nstatic inline long\nHYPERVISOR_memory_op(unsigned int cmd, void *arg)\n{\n\treturn _hypercall2(long, memory_op, cmd, arg);\n}\n\nstatic inline int\nHYPERVISOR_multicall(void *call_list, uint32_t nr_calls)\n{\n\treturn _hypercall2(int, multicall, call_list, nr_calls);\n}\n\nstatic inline int\nHYPERVISOR_event_channel_op(int cmd, void *arg)\n{\n\treturn _hypercall2(int, event_channel_op, cmd, arg);\n}\n\nstatic __always_inline int\nHYPERVISOR_xen_version(int cmd, void *arg)\n{\n\treturn _hypercall2(int, xen_version, cmd, arg);\n}\n\nstatic inline int\nHYPERVISOR_console_io(int cmd, int count, char *str)\n{\n\treturn _hypercall3(int, console_io, cmd, count, str);\n}\n\nstatic inline int\nHYPERVISOR_physdev_op(int cmd, void *arg)\n{\n\treturn _hypercall2(int, physdev_op, cmd, arg);\n}\n\nstatic inline int\nHYPERVISOR_grant_table_op(unsigned int cmd, void *uop, unsigned int count)\n{\n\treturn _hypercall3(int, grant_table_op, cmd, uop, count);\n}\n\nstatic inline int\nHYPERVISOR_vm_assist(unsigned int cmd, unsigned int type)\n{\n\treturn _hypercall2(int, vm_assist, cmd, type);\n}\n\nstatic inline int\nHYPERVISOR_vcpu_op(int cmd, int vcpuid, void *extra_args)\n{\n\treturn _hypercall3(int, vcpu_op, cmd, vcpuid, extra_args);\n}\n\nstatic inline int\nHYPERVISOR_suspend(unsigned long start_info_mfn)\n{\n\tstruct sched_shutdown r = { .reason = SHUTDOWN_suspend };\n\n\t \n\treturn _hypercall3(int, sched_op, SCHEDOP_shutdown, &r, start_info_mfn);\n}\n\nstatic inline unsigned long __must_check\nHYPERVISOR_hvm_op(int op, void *arg)\n{\n       return _hypercall2(unsigned long, hvm_op, op, arg);\n}\n\nstatic inline int\nHYPERVISOR_xenpmu_op(unsigned int op, void *arg)\n{\n\treturn _hypercall2(int, xenpmu_op, op, arg);\n}\n\nstatic inline int\nHYPERVISOR_dm_op(\n\tdomid_t dom, unsigned int nr_bufs, struct xen_dm_op_buf *bufs)\n{\n\tint ret;\n\t__xen_stac();\n\tret = _hypercall3(int, dm_op, dom, nr_bufs, bufs);\n\t__xen_clac();\n\treturn ret;\n}\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}