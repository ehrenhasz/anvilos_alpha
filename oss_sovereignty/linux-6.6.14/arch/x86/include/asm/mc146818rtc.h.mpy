{
  "module_name": "mc146818rtc.h",
  "hash_id": "a90cd42fdfa286c25c8124e10d552218a65e82d5f688c7bb128a956323ea3fe7",
  "original_prompt": "Ingested from linux-6.6.14/arch/x86/include/asm/mc146818rtc.h",
  "human_readable_source": " \n \n#ifndef _ASM_X86_MC146818RTC_H\n#define _ASM_X86_MC146818RTC_H\n\n#include <asm/io.h>\n#include <asm/processor.h>\n\n#ifndef RTC_PORT\n#define RTC_PORT(x)\t(0x70 + (x))\n#define RTC_ALWAYS_BCD\t1\t \n#endif\n\n#if defined(CONFIG_X86_32)\n \n#include <linux/smp.h>\nextern volatile unsigned long cmos_lock;\n\n \n\nstatic inline void lock_cmos(unsigned char reg)\n{\n\tunsigned long new;\n\tnew = ((smp_processor_id() + 1) << 8) | reg;\n\tfor (;;) {\n\t\tif (cmos_lock) {\n\t\t\tcpu_relax();\n\t\t\tcontinue;\n\t\t}\n\t\tif (__cmpxchg(&cmos_lock, 0, new, sizeof(cmos_lock)) == 0)\n\t\t\treturn;\n\t}\n}\n\nstatic inline void unlock_cmos(void)\n{\n\tcmos_lock = 0;\n}\n\nstatic inline int do_i_have_lock_cmos(void)\n{\n\treturn (cmos_lock >> 8) == (smp_processor_id() + 1);\n}\n\nstatic inline unsigned char current_lock_cmos_reg(void)\n{\n\treturn cmos_lock & 0xff;\n}\n\n#define lock_cmos_prefix(reg)\t\t\t\\\n\tdo {\t\t\t\t\t\\\n\t\tunsigned long cmos_flags;\t\\\n\t\tlocal_irq_save(cmos_flags);\t\\\n\t\tlock_cmos(reg)\n\n#define lock_cmos_suffix(reg)\t\t\t\\\n\tunlock_cmos();\t\t\t\t\\\n\tlocal_irq_restore(cmos_flags);\t\t\\\n\t} while (0)\n#else\n#define lock_cmos_prefix(reg) do {} while (0)\n#define lock_cmos_suffix(reg) do {} while (0)\n#define lock_cmos(reg) do { } while (0)\n#define unlock_cmos() do { } while (0)\n#define do_i_have_lock_cmos() 0\n#define current_lock_cmos_reg() 0\n#endif\n\n \n#define CMOS_READ(addr) rtc_cmos_read(addr)\n#define CMOS_WRITE(val, addr) rtc_cmos_write(val, addr)\nunsigned char rtc_cmos_read(unsigned char addr);\nvoid rtc_cmos_write(unsigned char val, unsigned char addr);\n\nextern int mach_set_cmos_time(const struct timespec64 *now);\nextern void mach_get_cmos_time(struct timespec64 *now);\n\n#define RTC_IRQ 8\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}