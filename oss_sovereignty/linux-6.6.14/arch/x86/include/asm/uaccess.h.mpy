{
  "module_name": "uaccess.h",
  "hash_id": "cbf2dd358eea57961d1e9d1d406cfd87df293308de4ab8d4a3a2c6377650d39b",
  "original_prompt": "Ingested from linux-6.6.14/arch/x86/include/asm/uaccess.h",
  "human_readable_source": " \n#ifndef _ASM_X86_UACCESS_H\n#define _ASM_X86_UACCESS_H\n \n#include <linux/compiler.h>\n#include <linux/instrumented.h>\n#include <linux/kasan-checks.h>\n#include <linux/mm_types.h>\n#include <linux/string.h>\n#include <linux/mmap_lock.h>\n#include <asm/asm.h>\n#include <asm/page.h>\n#include <asm/smap.h>\n#include <asm/extable.h>\n#include <asm/tlbflush.h>\n\n#ifdef CONFIG_X86_32\n# include <asm/uaccess_32.h>\n#else\n# include <asm/uaccess_64.h>\n#endif\n\n#include <asm-generic/access_ok.h>\n\nextern int __get_user_1(void);\nextern int __get_user_2(void);\nextern int __get_user_4(void);\nextern int __get_user_8(void);\nextern int __get_user_nocheck_1(void);\nextern int __get_user_nocheck_2(void);\nextern int __get_user_nocheck_4(void);\nextern int __get_user_nocheck_8(void);\nextern int __get_user_bad(void);\n\n#define __uaccess_begin() stac()\n#define __uaccess_end()   clac()\n#define __uaccess_begin_nospec()\t\\\n({\t\t\t\t\t\\\n\tstac();\t\t\t\t\\\n\tbarrier_nospec();\t\t\\\n})\n\n \n#define __inttype(x) __typeof__(\t\t\\\n\t__typefits(x,char,\t\t\t\\\n\t  __typefits(x,short,\t\t\t\\\n\t    __typefits(x,int,\t\t\t\\\n\t      __typefits(x,long,0ULL)))))\n\n#define __typefits(x,type,not) \\\n\t__builtin_choose_expr(sizeof(x)<=sizeof(type),(unsigned type)0,not)\n\n \n#define do_get_user_call(fn,x,ptr)\t\t\t\t\t\\\n({\t\t\t\t\t\t\t\t\t\\\n\tint __ret_gu;\t\t\t\t\t\t\t\\\n\tregister __inttype(*(ptr)) __val_gu asm(\"%\"_ASM_DX);\t\t\\\n\t__chk_user_ptr(ptr);\t\t\t\t\t\t\\\n\tasm volatile(\"call __\" #fn \"_%P4\"\t\t\t\t\\\n\t\t     : \"=a\" (__ret_gu), \"=r\" (__val_gu),\t\t\\\n\t\t\tASM_CALL_CONSTRAINT\t\t\t\t\\\n\t\t     : \"0\" (ptr), \"i\" (sizeof(*(ptr))));\t\t\\\n\tinstrument_get_user(__val_gu);\t\t\t\t\t\\\n\t(x) = (__force __typeof__(*(ptr))) __val_gu;\t\t\t\\\n\t__builtin_expect(__ret_gu, 0);\t\t\t\t\t\\\n})\n\n \n#define get_user(x,ptr) ({ might_fault(); do_get_user_call(get_user,x,ptr); })\n\n \n#define __get_user(x,ptr) do_get_user_call(get_user_nocheck,x,ptr)\n\n\n#ifdef CONFIG_X86_32\n#define __put_user_goto_u64(x, addr, label)\t\t\t\\\n\tasm_volatile_goto(\"\\n\"\t\t\t\t\t\\\n\t\t     \"1:\tmovl %%eax,0(%1)\\n\"\t\t\\\n\t\t     \"2:\tmovl %%edx,4(%1)\\n\"\t\t\\\n\t\t     _ASM_EXTABLE_UA(1b, %l2)\t\t\t\\\n\t\t     _ASM_EXTABLE_UA(2b, %l2)\t\t\t\\\n\t\t     : : \"A\" (x), \"r\" (addr)\t\t\t\\\n\t\t     : : label)\n\n#else\n#define __put_user_goto_u64(x, ptr, label) \\\n\t__put_user_goto(x, ptr, \"q\", \"er\", label)\n#endif\n\nextern void __put_user_bad(void);\n\n \nextern void __put_user_1(void);\nextern void __put_user_2(void);\nextern void __put_user_4(void);\nextern void __put_user_8(void);\nextern void __put_user_nocheck_1(void);\nextern void __put_user_nocheck_2(void);\nextern void __put_user_nocheck_4(void);\nextern void __put_user_nocheck_8(void);\n\n \n#define do_put_user_call(fn,x,ptr)\t\t\t\t\t\\\n({\t\t\t\t\t\t\t\t\t\\\n\tint __ret_pu;\t\t\t\t\t\t\t\\\n\tvoid __user *__ptr_pu;\t\t\t\t\t\t\\\n\tregister __typeof__(*(ptr)) __val_pu asm(\"%\"_ASM_AX);\t\t\\\n\t__typeof__(*(ptr)) __x = (x);  \t\t\t\\\n\t__typeof__(ptr) __ptr = (ptr);  \t\t\\\n\t__chk_user_ptr(__ptr);\t\t\t\t\t\t\\\n\t__ptr_pu = __ptr;\t\t\t\t\t\t\\\n\t__val_pu = __x;\t\t\t\t\t\t\t\\\n\tasm volatile(\"call __\" #fn \"_%P[size]\"\t\t\t\t\\\n\t\t     : \"=c\" (__ret_pu),\t\t\t\t\t\\\n\t\t\tASM_CALL_CONSTRAINT\t\t\t\t\\\n\t\t     : \"0\" (__ptr_pu),\t\t\t\t\t\\\n\t\t       \"r\" (__val_pu),\t\t\t\t\t\\\n\t\t       [size] \"i\" (sizeof(*(ptr)))\t\t\t\\\n\t\t     :\"ebx\");\t\t\t\t\t\t\\\n\tinstrument_put_user(__x, __ptr, sizeof(*(ptr)));\t\t\\\n\t__builtin_expect(__ret_pu, 0);\t\t\t\t\t\\\n})\n\n \n#define put_user(x, ptr) ({ might_fault(); do_put_user_call(put_user,x,ptr); })\n\n \n#define __put_user(x, ptr) do_put_user_call(put_user_nocheck,x,ptr)\n\n#define __put_user_size(x, ptr, size, label)\t\t\t\t\\\ndo {\t\t\t\t\t\t\t\t\t\\\n\t__typeof__(*(ptr)) __x = (x);  \t\t\t\\\n\t__typeof__(ptr) __ptr = (ptr);  \t\t\\\n\t__chk_user_ptr(__ptr);\t\t\t\t\t\t\\\n\tswitch (size) {\t\t\t\t\t\t\t\\\n\tcase 1:\t\t\t\t\t\t\t\t\\\n\t\t__put_user_goto(__x, __ptr, \"b\", \"iq\", label);\t\t\\\n\t\tbreak;\t\t\t\t\t\t\t\\\n\tcase 2:\t\t\t\t\t\t\t\t\\\n\t\t__put_user_goto(__x, __ptr, \"w\", \"ir\", label);\t\t\\\n\t\tbreak;\t\t\t\t\t\t\t\\\n\tcase 4:\t\t\t\t\t\t\t\t\\\n\t\t__put_user_goto(__x, __ptr, \"l\", \"ir\", label);\t\t\\\n\t\tbreak;\t\t\t\t\t\t\t\\\n\tcase 8:\t\t\t\t\t\t\t\t\\\n\t\t__put_user_goto_u64(__x, __ptr, label);\t\t\t\\\n\t\tbreak;\t\t\t\t\t\t\t\\\n\tdefault:\t\t\t\t\t\t\t\\\n\t\t__put_user_bad();\t\t\t\t\t\\\n\t}\t\t\t\t\t\t\t\t\\\n\tinstrument_put_user(__x, __ptr, size);\t\t\t\t\\\n} while (0)\n\n#ifdef CONFIG_CC_HAS_ASM_GOTO_OUTPUT\n\n#ifdef CONFIG_X86_32\n#define __get_user_asm_u64(x, ptr, label) do {\t\t\t\t\\\n\tunsigned int __gu_low, __gu_high;\t\t\t\t\\\n\tconst unsigned int __user *__gu_ptr;\t\t\t\t\\\n\t__gu_ptr = (const void __user *)(ptr);\t\t\t\t\\\n\t__get_user_asm(__gu_low, __gu_ptr, \"l\", \"=r\", label);\t\t\\\n\t__get_user_asm(__gu_high, __gu_ptr+1, \"l\", \"=r\", label);\t\\\n\t(x) = ((unsigned long long)__gu_high << 32) | __gu_low;\t\t\\\n} while (0)\n#else\n#define __get_user_asm_u64(x, ptr, label)\t\t\t\t\\\n\t__get_user_asm(x, ptr, \"q\", \"=r\", label)\n#endif\n\n#define __get_user_size(x, ptr, size, label)\t\t\t\t\\\ndo {\t\t\t\t\t\t\t\t\t\\\n\t__chk_user_ptr(ptr);\t\t\t\t\t\t\\\n\tswitch (size) {\t\t\t\t\t\t\t\\\n\tcase 1:\t{\t\t\t\t\t\t\t\\\n\t\tunsigned char x_u8__;\t\t\t\t\t\\\n\t\t__get_user_asm(x_u8__, ptr, \"b\", \"=q\", label);\t\t\\\n\t\t(x) = x_u8__;\t\t\t\t\t\t\\\n\t\tbreak;\t\t\t\t\t\t\t\\\n\t}\t\t\t\t\t\t\t\t\\\n\tcase 2:\t\t\t\t\t\t\t\t\\\n\t\t__get_user_asm(x, ptr, \"w\", \"=r\", label);\t\t\\\n\t\tbreak;\t\t\t\t\t\t\t\\\n\tcase 4:\t\t\t\t\t\t\t\t\\\n\t\t__get_user_asm(x, ptr, \"l\", \"=r\", label);\t\t\\\n\t\tbreak;\t\t\t\t\t\t\t\\\n\tcase 8:\t\t\t\t\t\t\t\t\\\n\t\t__get_user_asm_u64(x, ptr, label);\t\t\t\\\n\t\tbreak;\t\t\t\t\t\t\t\\\n\tdefault:\t\t\t\t\t\t\t\\\n\t\t(x) = __get_user_bad();\t\t\t\t\t\\\n\t}\t\t\t\t\t\t\t\t\\\n\tinstrument_get_user(x);\t\t\t\t\t\t\\\n} while (0)\n\n#define __get_user_asm(x, addr, itype, ltype, label)\t\t\t\\\n\tasm_volatile_goto(\"\\n\"\t\t\t\t\t\t\\\n\t\t     \"1:\tmov\"itype\" %[umem],%[output]\\n\"\t\t\\\n\t\t     _ASM_EXTABLE_UA(1b, %l2)\t\t\t\t\\\n\t\t     : [output] ltype(x)\t\t\t\t\\\n\t\t     : [umem] \"m\" (__m(addr))\t\t\t\t\\\n\t\t     : : label)\n\n#else \n\n#ifdef CONFIG_X86_32\n#define __get_user_asm_u64(x, ptr, retval)\t\t\t\t\\\n({\t\t\t\t\t\t\t\t\t\\\n\t__typeof__(ptr) __ptr = (ptr);\t\t\t\t\t\\\n\tasm volatile(\"\\n\"\t\t\t\t\t\t\\\n\t\t     \"1:\tmovl %[lowbits],%%eax\\n\"\t\t\\\n\t\t     \"2:\tmovl %[highbits],%%edx\\n\"\t\t\\\n\t\t     \"3:\\n\"\t\t\t\t\t\t\\\n\t\t     _ASM_EXTABLE_TYPE_REG(1b, 3b, EX_TYPE_EFAULT_REG |\t\\\n\t\t\t\t\t   EX_FLAG_CLEAR_AX_DX,\t\t\\\n\t\t\t\t\t   %[errout])\t\t\t\\\n\t\t     _ASM_EXTABLE_TYPE_REG(2b, 3b, EX_TYPE_EFAULT_REG |\t\\\n\t\t\t\t\t   EX_FLAG_CLEAR_AX_DX,\t\t\\\n\t\t\t\t\t   %[errout])\t\t\t\\\n\t\t     : [errout] \"=r\" (retval),\t\t\t\t\\\n\t\t       [output] \"=&A\"(x)\t\t\t\t\\\n\t\t     : [lowbits] \"m\" (__m(__ptr)),\t\t\t\\\n\t\t       [highbits] \"m\" __m(((u32 __user *)(__ptr)) + 1),\t\\\n\t\t       \"0\" (retval));\t\t\t\t\t\\\n})\n\n#else\n#define __get_user_asm_u64(x, ptr, retval) \\\n\t __get_user_asm(x, ptr, retval, \"q\")\n#endif\n\n#define __get_user_size(x, ptr, size, retval)\t\t\t\t\\\ndo {\t\t\t\t\t\t\t\t\t\\\n\tunsigned char x_u8__;\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\tretval = 0;\t\t\t\t\t\t\t\\\n\t__chk_user_ptr(ptr);\t\t\t\t\t\t\\\n\tswitch (size) {\t\t\t\t\t\t\t\\\n\tcase 1:\t\t\t\t\t\t\t\t\\\n\t\t__get_user_asm(x_u8__, ptr, retval, \"b\");\t\t\\\n\t\t(x) = x_u8__;\t\t\t\t\t\t\\\n\t\tbreak;\t\t\t\t\t\t\t\\\n\tcase 2:\t\t\t\t\t\t\t\t\\\n\t\t__get_user_asm(x, ptr, retval, \"w\");\t\t\t\\\n\t\tbreak;\t\t\t\t\t\t\t\\\n\tcase 4:\t\t\t\t\t\t\t\t\\\n\t\t__get_user_asm(x, ptr, retval, \"l\");\t\t\t\\\n\t\tbreak;\t\t\t\t\t\t\t\\\n\tcase 8:\t\t\t\t\t\t\t\t\\\n\t\t__get_user_asm_u64(x, ptr, retval);\t\t\t\\\n\t\tbreak;\t\t\t\t\t\t\t\\\n\tdefault:\t\t\t\t\t\t\t\\\n\t\t(x) = __get_user_bad();\t\t\t\t\t\\\n\t}\t\t\t\t\t\t\t\t\\\n} while (0)\n\n#define __get_user_asm(x, addr, err, itype)\t\t\t\t\\\n\tasm volatile(\"\\n\"\t\t\t\t\t\t\\\n\t\t     \"1:\tmov\"itype\" %[umem],%[output]\\n\"\t\t\\\n\t\t     \"2:\\n\"\t\t\t\t\t\t\\\n\t\t     _ASM_EXTABLE_TYPE_REG(1b, 2b, EX_TYPE_EFAULT_REG | \\\n\t\t\t\t\t   EX_FLAG_CLEAR_AX,\t\t\\\n\t\t\t\t\t   %[errout])\t\t\t\\\n\t\t     : [errout] \"=r\" (err),\t\t\t\t\\\n\t\t       [output] \"=a\" (x)\t\t\t\t\\\n\t\t     : [umem] \"m\" (__m(addr)),\t\t\t\t\\\n\t\t       \"0\" (err))\n\n#endif \n\n#ifdef CONFIG_CC_HAS_ASM_GOTO_TIED_OUTPUT\n#define __try_cmpxchg_user_asm(itype, ltype, _ptr, _pold, _new, label)\t({ \\\n\tbool success;\t\t\t\t\t\t\t\\\n\t__typeof__(_ptr) _old = (__typeof__(_ptr))(_pold);\t\t\\\n\t__typeof__(*(_ptr)) __old = *_old;\t\t\t\t\\\n\t__typeof__(*(_ptr)) __new = (_new);\t\t\t\t\\\n\tasm_volatile_goto(\"\\n\"\t\t\t\t\t\t\\\n\t\t     \"1: \" LOCK_PREFIX \"cmpxchg\"itype\" %[new], %[ptr]\\n\"\\\n\t\t     _ASM_EXTABLE_UA(1b, %l[label])\t\t\t\\\n\t\t     : CC_OUT(z) (success),\t\t\t\t\\\n\t\t       [ptr] \"+m\" (*_ptr),\t\t\t\t\\\n\t\t       [old] \"+a\" (__old)\t\t\t\t\\\n\t\t     : [new] ltype (__new)\t\t\t\t\\\n\t\t     : \"memory\"\t\t\t\t\t\t\\\n\t\t     : label);\t\t\t\t\t\t\\\n\tif (unlikely(!success))\t\t\t\t\t\t\\\n\t\t*_old = __old;\t\t\t\t\t\t\\\n\tlikely(success);\t\t\t\t\t})\n\n#ifdef CONFIG_X86_32\n#define __try_cmpxchg64_user_asm(_ptr, _pold, _new, label)\t({\t\\\n\tbool success;\t\t\t\t\t\t\t\\\n\t__typeof__(_ptr) _old = (__typeof__(_ptr))(_pold);\t\t\\\n\t__typeof__(*(_ptr)) __old = *_old;\t\t\t\t\\\n\t__typeof__(*(_ptr)) __new = (_new);\t\t\t\t\\\n\tasm_volatile_goto(\"\\n\"\t\t\t\t\t\t\\\n\t\t     \"1: \" LOCK_PREFIX \"cmpxchg8b %[ptr]\\n\"\t\t\\\n\t\t     _ASM_EXTABLE_UA(1b, %l[label])\t\t\t\\\n\t\t     : CC_OUT(z) (success),\t\t\t\t\\\n\t\t       \"+A\" (__old),\t\t\t\t\t\\\n\t\t       [ptr] \"+m\" (*_ptr)\t\t\t\t\\\n\t\t     : \"b\" ((u32)__new),\t\t\t\t\\\n\t\t       \"c\" ((u32)((u64)__new >> 32))\t\t\t\\\n\t\t     : \"memory\"\t\t\t\t\t\t\\\n\t\t     : label);\t\t\t\t\t\t\\\n\tif (unlikely(!success))\t\t\t\t\t\t\\\n\t\t*_old = __old;\t\t\t\t\t\t\\\n\tlikely(success);\t\t\t\t\t})\n#endif \n#else  \n#define __try_cmpxchg_user_asm(itype, ltype, _ptr, _pold, _new, label)\t({ \\\n\tint __err = 0;\t\t\t\t\t\t\t\\\n\tbool success;\t\t\t\t\t\t\t\\\n\t__typeof__(_ptr) _old = (__typeof__(_ptr))(_pold);\t\t\\\n\t__typeof__(*(_ptr)) __old = *_old;\t\t\t\t\\\n\t__typeof__(*(_ptr)) __new = (_new);\t\t\t\t\\\n\tasm volatile(\"\\n\"\t\t\t\t\t\t\\\n\t\t     \"1: \" LOCK_PREFIX \"cmpxchg\"itype\" %[new], %[ptr]\\n\"\\\n\t\t     CC_SET(z)\t\t\t\t\t\t\\\n\t\t     \"2:\\n\"\t\t\t\t\t\t\\\n\t\t     _ASM_EXTABLE_TYPE_REG(1b, 2b, EX_TYPE_EFAULT_REG,\t\\\n\t\t\t\t\t   %[errout])\t\t\t\\\n\t\t     : CC_OUT(z) (success),\t\t\t\t\\\n\t\t       [errout] \"+r\" (__err),\t\t\t\t\\\n\t\t       [ptr] \"+m\" (*_ptr),\t\t\t\t\\\n\t\t       [old] \"+a\" (__old)\t\t\t\t\\\n\t\t     : [new] ltype (__new)\t\t\t\t\\\n\t\t     : \"memory\");\t\t\t\t\t\\\n\tif (unlikely(__err))\t\t\t\t\t\t\\\n\t\tgoto label;\t\t\t\t\t\t\\\n\tif (unlikely(!success))\t\t\t\t\t\t\\\n\t\t*_old = __old;\t\t\t\t\t\t\\\n\tlikely(success);\t\t\t\t\t})\n\n#ifdef CONFIG_X86_32\n \n#define __try_cmpxchg64_user_asm(_ptr, _pold, _new, label)\t({\t\\\n\tint __result;\t\t\t\t\t\t\t\\\n\t__typeof__(_ptr) _old = (__typeof__(_ptr))(_pold);\t\t\\\n\t__typeof__(*(_ptr)) __old = *_old;\t\t\t\t\\\n\t__typeof__(*(_ptr)) __new = (_new);\t\t\t\t\\\n\tasm volatile(\"\\n\"\t\t\t\t\t\t\\\n\t\t     \"1: \" LOCK_PREFIX \"cmpxchg8b %[ptr]\\n\"\t\t\\\n\t\t     \"mov $0, %[result]\\n\\t\"\t\t\t\t\\\n\t\t     \"setz %b[result]\\n\"\t\t\t\t\\\n\t\t     \"2:\\n\"\t\t\t\t\t\t\\\n\t\t     _ASM_EXTABLE_TYPE_REG(1b, 2b, EX_TYPE_EFAULT_REG,\t\\\n\t\t\t\t\t   %[result])\t\t\t\\\n\t\t     : [result] \"=q\" (__result),\t\t\t\\\n\t\t       \"+A\" (__old),\t\t\t\t\t\\\n\t\t       [ptr] \"+m\" (*_ptr)\t\t\t\t\\\n\t\t     : \"b\" ((u32)__new),\t\t\t\t\\\n\t\t       \"c\" ((u32)((u64)__new >> 32))\t\t\t\\\n\t\t     : \"memory\", \"cc\");\t\t\t\t\t\\\n\tif (unlikely(__result < 0))\t\t\t\t\t\\\n\t\tgoto label;\t\t\t\t\t\t\\\n\tif (unlikely(!__result))\t\t\t\t\t\\\n\t\t*_old = __old;\t\t\t\t\t\t\\\n\tlikely(__result);\t\t\t\t\t})\n#endif \n#endif \n\n \nstruct __large_struct { unsigned long buf[100]; };\n#define __m(x) (*(struct __large_struct __user *)(x))\n\n \n#define __put_user_goto(x, addr, itype, ltype, label)\t\t\t\\\n\tasm_volatile_goto(\"\\n\"\t\t\t\t\t\t\\\n\t\t\"1:\tmov\"itype\" %0,%1\\n\"\t\t\t\t\\\n\t\t_ASM_EXTABLE_UA(1b, %l2)\t\t\t\t\\\n\t\t: : ltype(x), \"m\" (__m(addr))\t\t\t\t\\\n\t\t: : label)\n\nextern unsigned long\ncopy_from_user_nmi(void *to, const void __user *from, unsigned long n);\nextern __must_check long\nstrncpy_from_user(char *dst, const char __user *src, long count);\n\nextern __must_check long strnlen_user(const char __user *str, long n);\n\n#ifdef CONFIG_ARCH_HAS_COPY_MC\nunsigned long __must_check\ncopy_mc_to_kernel(void *to, const void *from, unsigned len);\n#define copy_mc_to_kernel copy_mc_to_kernel\n\nunsigned long __must_check\ncopy_mc_to_user(void __user *to, const void *from, unsigned len);\n#endif\n\n \n#ifdef CONFIG_X86_INTEL_USERCOPY\nextern struct movsl_mask {\n\tint mask;\n} ____cacheline_aligned_in_smp movsl_mask;\n#endif\n\n#define ARCH_HAS_NOCACHE_UACCESS 1\n\n \nstatic __must_check __always_inline bool user_access_begin(const void __user *ptr, size_t len)\n{\n\tif (unlikely(!access_ok(ptr,len)))\n\t\treturn 0;\n\t__uaccess_begin_nospec();\n\treturn 1;\n}\n#define user_access_begin(a,b)\tuser_access_begin(a,b)\n#define user_access_end()\t__uaccess_end()\n\n#define user_access_save()\tsmap_save()\n#define user_access_restore(x)\tsmap_restore(x)\n\n#define unsafe_put_user(x, ptr, label)\t\\\n\t__put_user_size((__typeof__(*(ptr)))(x), (ptr), sizeof(*(ptr)), label)\n\n#ifdef CONFIG_CC_HAS_ASM_GOTO_OUTPUT\n#define unsafe_get_user(x, ptr, err_label)\t\t\t\t\t\\\ndo {\t\t\t\t\t\t\t\t\t\t\\\n\t__inttype(*(ptr)) __gu_val;\t\t\t\t\t\t\\\n\t__get_user_size(__gu_val, (ptr), sizeof(*(ptr)), err_label);\t\t\\\n\t(x) = (__force __typeof__(*(ptr)))__gu_val;\t\t\t\t\\\n} while (0)\n#else \n#define unsafe_get_user(x, ptr, err_label)\t\t\t\t\t\\\ndo {\t\t\t\t\t\t\t\t\t\t\\\n\tint __gu_err;\t\t\t\t\t\t\t\t\\\n\t__inttype(*(ptr)) __gu_val;\t\t\t\t\t\t\\\n\t__get_user_size(__gu_val, (ptr), sizeof(*(ptr)), __gu_err);\t\t\\\n\t(x) = (__force __typeof__(*(ptr)))__gu_val;\t\t\t\t\\\n\tif (unlikely(__gu_err)) goto err_label;\t\t\t\t\t\\\n} while (0)\n#endif \n\nextern void __try_cmpxchg_user_wrong_size(void);\n\n#ifndef CONFIG_X86_32\n#define __try_cmpxchg64_user_asm(_ptr, _oldp, _nval, _label)\t\t\\\n\t__try_cmpxchg_user_asm(\"q\", \"r\", (_ptr), (_oldp), (_nval), _label)\n#endif\n\n \n#define unsafe_try_cmpxchg_user(_ptr, _oldp, _nval, _label) ({\t\t\t\\\n\tbool __ret;\t\t\t\t\t\t\t\t\\\n\t__chk_user_ptr(_ptr);\t\t\t\t\t\t\t\\\n\tswitch (sizeof(*(_ptr))) {\t\t\t\t\t\t\\\n\tcase 1:\t__ret = __try_cmpxchg_user_asm(\"b\", \"q\",\t\t\t\\\n\t\t\t\t\t       (__force u8 *)(_ptr), (_oldp),\t\\\n\t\t\t\t\t       (_nval), _label);\t\t\\\n\t\tbreak;\t\t\t\t\t\t\t\t\\\n\tcase 2:\t__ret = __try_cmpxchg_user_asm(\"w\", \"r\",\t\t\t\\\n\t\t\t\t\t       (__force u16 *)(_ptr), (_oldp),\t\\\n\t\t\t\t\t       (_nval), _label);\t\t\\\n\t\tbreak;\t\t\t\t\t\t\t\t\\\n\tcase 4:\t__ret = __try_cmpxchg_user_asm(\"l\", \"r\",\t\t\t\\\n\t\t\t\t\t       (__force u32 *)(_ptr), (_oldp),\t\\\n\t\t\t\t\t       (_nval), _label);\t\t\\\n\t\tbreak;\t\t\t\t\t\t\t\t\\\n\tcase 8:\t__ret = __try_cmpxchg64_user_asm((__force u64 *)(_ptr), (_oldp),\\\n\t\t\t\t\t\t (_nval), _label);\t\t\\\n\t\tbreak;\t\t\t\t\t\t\t\t\\\n\tdefault: __try_cmpxchg_user_wrong_size();\t\t\t\t\\\n\t}\t\t\t\t\t\t\t\t\t\\\n\t__ret;\t\t\t\t\t\t})\n\n \n#define __try_cmpxchg_user(_ptr, _oldp, _nval, _label)\t({\t\t\\\n\tint __ret = -EFAULT;\t\t\t\t\t\t\\\n\t__uaccess_begin_nospec();\t\t\t\t\t\\\n\t__ret = !unsafe_try_cmpxchg_user(_ptr, _oldp, _nval, _label);\t\\\n_label:\t\t\t\t\t\t\t\t\t\\\n\t__uaccess_end();\t\t\t\t\t\t\\\n\t__ret;\t\t\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t})\n\n \n#define unsafe_copy_loop(dst, src, len, type, label)\t\t\t\t\\\n\twhile (len >= sizeof(type)) {\t\t\t\t\t\t\\\n\t\tunsafe_put_user(*(type *)(src),(type __user *)(dst),label);\t\\\n\t\tdst += sizeof(type);\t\t\t\t\t\t\\\n\t\tsrc += sizeof(type);\t\t\t\t\t\t\\\n\t\tlen -= sizeof(type);\t\t\t\t\t\t\\\n\t}\n\n#define unsafe_copy_to_user(_dst,_src,_len,label)\t\t\t\\\ndo {\t\t\t\t\t\t\t\t\t\\\n\tchar __user *__ucu_dst = (_dst);\t\t\t\t\\\n\tconst char *__ucu_src = (_src);\t\t\t\t\t\\\n\tsize_t __ucu_len = (_len);\t\t\t\t\t\\\n\tunsafe_copy_loop(__ucu_dst, __ucu_src, __ucu_len, u64, label);\t\\\n\tunsafe_copy_loop(__ucu_dst, __ucu_src, __ucu_len, u32, label);\t\\\n\tunsafe_copy_loop(__ucu_dst, __ucu_src, __ucu_len, u16, label);\t\\\n\tunsafe_copy_loop(__ucu_dst, __ucu_src, __ucu_len, u8, label);\t\\\n} while (0)\n\n#ifdef CONFIG_CC_HAS_ASM_GOTO_OUTPUT\n#define __get_kernel_nofault(dst, src, type, err_label)\t\t\t\\\n\t__get_user_size(*((type *)(dst)), (__force type __user *)(src),\t\\\n\t\t\tsizeof(type), err_label)\n#else \n#define __get_kernel_nofault(dst, src, type, err_label)\t\t\t\\\ndo {\t\t\t\t\t\t\t\t\t\\\n\tint __kr_err;\t\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\t__get_user_size(*((type *)(dst)), (__force type __user *)(src),\t\\\n\t\t\tsizeof(type), __kr_err);\t\t\t\\\n\tif (unlikely(__kr_err))\t\t\t\t\t\t\\\n\t\tgoto err_label;\t\t\t\t\t\t\\\n} while (0)\n#endif \n\n#define __put_kernel_nofault(dst, src, type, err_label)\t\t\t\\\n\t__put_user_size(*((type *)(src)), (__force type __user *)(dst),\t\\\n\t\t\tsizeof(type), err_label)\n\n#endif  \n\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}