{
  "module_name": "mwait.h",
  "hash_id": "a1a88dff9c36bd117b6047e76494d2f91c057ecdeb8d8568b32d2644cad4b517",
  "original_prompt": "Ingested from linux-6.6.14/arch/x86/include/asm/mwait.h",
  "human_readable_source": " \n#ifndef _ASM_X86_MWAIT_H\n#define _ASM_X86_MWAIT_H\n\n#include <linux/sched.h>\n#include <linux/sched/idle.h>\n\n#include <asm/cpufeature.h>\n#include <asm/nospec-branch.h>\n\n#define MWAIT_SUBSTATE_MASK\t\t0xf\n#define MWAIT_CSTATE_MASK\t\t0xf\n#define MWAIT_SUBSTATE_SIZE\t\t4\n#define MWAIT_HINT2CSTATE(hint)\t\t(((hint) >> MWAIT_SUBSTATE_SIZE) & MWAIT_CSTATE_MASK)\n#define MWAIT_HINT2SUBSTATE(hint)\t((hint) & MWAIT_CSTATE_MASK)\n#define MWAIT_C1_SUBSTATE_MASK  0xf0\n\n#define CPUID_MWAIT_LEAF\t\t5\n#define CPUID5_ECX_EXTENSIONS_SUPPORTED 0x1\n#define CPUID5_ECX_INTERRUPT_BREAK\t0x2\n\n#define MWAIT_ECX_INTERRUPT_BREAK\t0x1\n#define MWAITX_ECX_TIMER_ENABLE\t\tBIT(1)\n#define MWAITX_MAX_WAIT_CYCLES\t\tUINT_MAX\n#define MWAITX_DISABLE_CSTATES\t\t0xf0\n#define TPAUSE_C01_STATE\t\t1\n#define TPAUSE_C02_STATE\t\t0\n\nstatic __always_inline void __monitor(const void *eax, unsigned long ecx,\n\t\t\t     unsigned long edx)\n{\n\t \n\tasm volatile(\".byte 0x0f, 0x01, 0xc8;\"\n\t\t     :: \"a\" (eax), \"c\" (ecx), \"d\"(edx));\n}\n\nstatic __always_inline void __monitorx(const void *eax, unsigned long ecx,\n\t\t\t      unsigned long edx)\n{\n\t \n\tasm volatile(\".byte 0x0f, 0x01, 0xfa;\"\n\t\t     :: \"a\" (eax), \"c\" (ecx), \"d\"(edx));\n}\n\nstatic __always_inline void __mwait(unsigned long eax, unsigned long ecx)\n{\n\tmds_idle_clear_cpu_buffers();\n\n\t \n\tasm volatile(\".byte 0x0f, 0x01, 0xc9;\"\n\t\t     :: \"a\" (eax), \"c\" (ecx));\n}\n\n \nstatic __always_inline void __mwaitx(unsigned long eax, unsigned long ebx,\n\t\t\t\t     unsigned long ecx)\n{\n\t \n\n\t \n\tasm volatile(\".byte 0x0f, 0x01, 0xfb;\"\n\t\t     :: \"a\" (eax), \"b\" (ebx), \"c\" (ecx));\n}\n\nstatic __always_inline void __sti_mwait(unsigned long eax, unsigned long ecx)\n{\n\tmds_idle_clear_cpu_buffers();\n\t \n\tasm volatile(\"sti; .byte 0x0f, 0x01, 0xc9;\"\n\t\t     :: \"a\" (eax), \"c\" (ecx));\n}\n\n \nstatic __always_inline void mwait_idle_with_hints(unsigned long eax, unsigned long ecx)\n{\n\tif (static_cpu_has_bug(X86_BUG_MONITOR) || !current_set_polling_and_test()) {\n\t\tif (static_cpu_has_bug(X86_BUG_CLFLUSH_MONITOR)) {\n\t\t\tmb();\n\t\t\tclflush((void *)&current_thread_info()->flags);\n\t\t\tmb();\n\t\t}\n\n\t\t__monitor((void *)&current_thread_info()->flags, 0, 0);\n\n\t\tif (!need_resched()) {\n\t\t\tif (ecx & 1) {\n\t\t\t\t__mwait(eax, ecx);\n\t\t\t} else {\n\t\t\t\t__sti_mwait(eax, ecx);\n\t\t\t\traw_local_irq_disable();\n\t\t\t}\n\t\t}\n\t}\n\tcurrent_clr_polling();\n}\n\n \nstatic inline void __tpause(u32 ecx, u32 edx, u32 eax)\n{\n\t \n\t#ifdef CONFIG_AS_TPAUSE\n\tasm volatile(\"tpause %%ecx\\n\"\n\t\t     :\n\t\t     : \"c\"(ecx), \"d\"(edx), \"a\"(eax));\n\t#else\n\tasm volatile(\".byte 0x66, 0x0f, 0xae, 0xf1\\t\\n\"\n\t\t     :\n\t\t     : \"c\"(ecx), \"d\"(edx), \"a\"(eax));\n\t#endif\n}\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}