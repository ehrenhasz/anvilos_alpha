{
  "module_name": "barrier.h",
  "hash_id": "13d2356118340a4e9290bcb4e69156e5f4f3ff62d9f4c549f554aad3002e3c5d",
  "original_prompt": "Ingested from linux-6.6.14/arch/x86/include/asm/barrier.h",
  "human_readable_source": " \n#ifndef _ASM_X86_BARRIER_H\n#define _ASM_X86_BARRIER_H\n\n#include <asm/alternative.h>\n#include <asm/nops.h>\n\n \n\n#ifdef CONFIG_X86_32\n#define mb() asm volatile(ALTERNATIVE(\"lock; addl $0,-4(%%esp)\", \"mfence\", \\\n\t\t\t\t      X86_FEATURE_XMM2) ::: \"memory\", \"cc\")\n#define rmb() asm volatile(ALTERNATIVE(\"lock; addl $0,-4(%%esp)\", \"lfence\", \\\n\t\t\t\t       X86_FEATURE_XMM2) ::: \"memory\", \"cc\")\n#define wmb() asm volatile(ALTERNATIVE(\"lock; addl $0,-4(%%esp)\", \"sfence\", \\\n\t\t\t\t       X86_FEATURE_XMM2) ::: \"memory\", \"cc\")\n#else\n#define __mb()\tasm volatile(\"mfence\":::\"memory\")\n#define __rmb()\tasm volatile(\"lfence\":::\"memory\")\n#define __wmb()\tasm volatile(\"sfence\" ::: \"memory\")\n#endif\n\n \nstatic inline unsigned long array_index_mask_nospec(unsigned long index,\n\t\tunsigned long size)\n{\n\tunsigned long mask;\n\n\tasm volatile (\"cmp %1,%2; sbb %0,%0;\"\n\t\t\t:\"=r\" (mask)\n\t\t\t:\"g\"(size),\"r\" (index)\n\t\t\t:\"cc\");\n\treturn mask;\n}\n\n \n#define array_index_mask_nospec array_index_mask_nospec\n\n \n#define barrier_nospec() alternative(\"\", \"lfence\", X86_FEATURE_LFENCE_RDTSC)\n\n#define __dma_rmb()\tbarrier()\n#define __dma_wmb()\tbarrier()\n\n#define __smp_mb()\tasm volatile(\"lock; addl $0,-4(%%\" _ASM_SP \")\" ::: \"memory\", \"cc\")\n\n#define __smp_rmb()\tdma_rmb()\n#define __smp_wmb()\tbarrier()\n#define __smp_store_mb(var, value) do { (void)xchg(&var, value); } while (0)\n\n#define __smp_store_release(p, v)\t\t\t\t\t\\\ndo {\t\t\t\t\t\t\t\t\t\\\n\tcompiletime_assert_atomic_type(*p);\t\t\t\t\\\n\tbarrier();\t\t\t\t\t\t\t\\\n\tWRITE_ONCE(*p, v);\t\t\t\t\t\t\\\n} while (0)\n\n#define __smp_load_acquire(p)\t\t\t\t\t\t\\\n({\t\t\t\t\t\t\t\t\t\\\n\ttypeof(*p) ___p1 = READ_ONCE(*p);\t\t\t\t\\\n\tcompiletime_assert_atomic_type(*p);\t\t\t\t\\\n\tbarrier();\t\t\t\t\t\t\t\\\n\t___p1;\t\t\t\t\t\t\t\t\\\n})\n\n \n#define __smp_mb__before_atomic()\tdo { } while (0)\n#define __smp_mb__after_atomic()\tdo { } while (0)\n\n#include <asm-generic/barrier.h>\n\n \nstatic inline void weak_wrmsr_fence(void)\n{\n\tasm volatile(\"mfence; lfence\" : : : \"memory\");\n}\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}