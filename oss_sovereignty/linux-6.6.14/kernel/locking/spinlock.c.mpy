{
  "module_name": "spinlock.c",
  "hash_id": "dc03cac01fb8530175eaf6ae1024e89ee72c7deb09f4eb573d709a5178cbd848",
  "original_prompt": "Ingested from linux-6.6.14/kernel/locking/spinlock.c",
  "human_readable_source": "\n \n\n#include <linux/linkage.h>\n#include <linux/preempt.h>\n#include <linux/spinlock.h>\n#include <linux/interrupt.h>\n#include <linux/debug_locks.h>\n#include <linux/export.h>\n\n#ifdef CONFIG_MMIOWB\n#ifndef arch_mmiowb_state\nDEFINE_PER_CPU(struct mmiowb_state, __mmiowb_state);\nEXPORT_PER_CPU_SYMBOL(__mmiowb_state);\n#endif\n#endif\n\n \n#if !defined(CONFIG_GENERIC_LOCKBREAK) || defined(CONFIG_DEBUG_LOCK_ALLOC)\n \n#else\n\n \n#ifndef arch_read_relax\n# define arch_read_relax(l)\tcpu_relax()\n#endif\n#ifndef arch_write_relax\n# define arch_write_relax(l)\tcpu_relax()\n#endif\n#ifndef arch_spin_relax\n# define arch_spin_relax(l)\tcpu_relax()\n#endif\n\n \n#define BUILD_LOCK_OPS(op, locktype)\t\t\t\t\t\\\nvoid __lockfunc __raw_##op##_lock(locktype##_t *lock)\t\t\t\\\n{\t\t\t\t\t\t\t\t\t\\\n\tfor (;;) {\t\t\t\t\t\t\t\\\n\t\tpreempt_disable();\t\t\t\t\t\\\n\t\tif (likely(do_raw_##op##_trylock(lock)))\t\t\\\n\t\t\tbreak;\t\t\t\t\t\t\\\n\t\tpreempt_enable();\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\t\tarch_##op##_relax(&lock->raw_lock);\t\t\t\\\n\t}\t\t\t\t\t\t\t\t\\\n}\t\t\t\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\nunsigned long __lockfunc __raw_##op##_lock_irqsave(locktype##_t *lock)\t\\\n{\t\t\t\t\t\t\t\t\t\\\n\tunsigned long flags;\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\tfor (;;) {\t\t\t\t\t\t\t\\\n\t\tpreempt_disable();\t\t\t\t\t\\\n\t\tlocal_irq_save(flags);\t\t\t\t\t\\\n\t\tif (likely(do_raw_##op##_trylock(lock)))\t\t\\\n\t\t\tbreak;\t\t\t\t\t\t\\\n\t\tlocal_irq_restore(flags);\t\t\t\t\\\n\t\tpreempt_enable();\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\t\tarch_##op##_relax(&lock->raw_lock);\t\t\t\\\n\t}\t\t\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\treturn flags;\t\t\t\t\t\t\t\\\n}\t\t\t\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\nvoid __lockfunc __raw_##op##_lock_irq(locktype##_t *lock)\t\t\\\n{\t\t\t\t\t\t\t\t\t\\\n\t_raw_##op##_lock_irqsave(lock);\t\t\t\t\t\\\n}\t\t\t\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\nvoid __lockfunc __raw_##op##_lock_bh(locktype##_t *lock)\t\t\\\n{\t\t\t\t\t\t\t\t\t\\\n\tunsigned long flags;\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\t \t\\\n\t \t\\\n\t \t\\\n\t \t\\\n\t \t\t\t\t\t\t\t\t\\\n\tflags = _raw_##op##_lock_irqsave(lock);\t\t\t\t\\\n\tlocal_bh_disable();\t\t\t\t\t\t\\\n\tlocal_irq_restore(flags);\t\t\t\t\t\\\n}\t\t\t\t\t\t\t\t\t\\\n\n \nBUILD_LOCK_OPS(spin, raw_spinlock);\n\n#ifndef CONFIG_PREEMPT_RT\nBUILD_LOCK_OPS(read, rwlock);\nBUILD_LOCK_OPS(write, rwlock);\n#endif\n\n#endif\n\n#ifndef CONFIG_INLINE_SPIN_TRYLOCK\nnoinline int __lockfunc _raw_spin_trylock(raw_spinlock_t *lock)\n{\n\treturn __raw_spin_trylock(lock);\n}\nEXPORT_SYMBOL(_raw_spin_trylock);\n#endif\n\n#ifndef CONFIG_INLINE_SPIN_TRYLOCK_BH\nnoinline int __lockfunc _raw_spin_trylock_bh(raw_spinlock_t *lock)\n{\n\treturn __raw_spin_trylock_bh(lock);\n}\nEXPORT_SYMBOL(_raw_spin_trylock_bh);\n#endif\n\n#ifndef CONFIG_INLINE_SPIN_LOCK\nnoinline void __lockfunc _raw_spin_lock(raw_spinlock_t *lock)\n{\n\t__raw_spin_lock(lock);\n}\nEXPORT_SYMBOL(_raw_spin_lock);\n#endif\n\n#ifndef CONFIG_INLINE_SPIN_LOCK_IRQSAVE\nnoinline unsigned long __lockfunc _raw_spin_lock_irqsave(raw_spinlock_t *lock)\n{\n\treturn __raw_spin_lock_irqsave(lock);\n}\nEXPORT_SYMBOL(_raw_spin_lock_irqsave);\n#endif\n\n#ifndef CONFIG_INLINE_SPIN_LOCK_IRQ\nnoinline void __lockfunc _raw_spin_lock_irq(raw_spinlock_t *lock)\n{\n\t__raw_spin_lock_irq(lock);\n}\nEXPORT_SYMBOL(_raw_spin_lock_irq);\n#endif\n\n#ifndef CONFIG_INLINE_SPIN_LOCK_BH\nnoinline void __lockfunc _raw_spin_lock_bh(raw_spinlock_t *lock)\n{\n\t__raw_spin_lock_bh(lock);\n}\nEXPORT_SYMBOL(_raw_spin_lock_bh);\n#endif\n\n#ifdef CONFIG_UNINLINE_SPIN_UNLOCK\nnoinline void __lockfunc _raw_spin_unlock(raw_spinlock_t *lock)\n{\n\t__raw_spin_unlock(lock);\n}\nEXPORT_SYMBOL(_raw_spin_unlock);\n#endif\n\n#ifndef CONFIG_INLINE_SPIN_UNLOCK_IRQRESTORE\nnoinline void __lockfunc _raw_spin_unlock_irqrestore(raw_spinlock_t *lock, unsigned long flags)\n{\n\t__raw_spin_unlock_irqrestore(lock, flags);\n}\nEXPORT_SYMBOL(_raw_spin_unlock_irqrestore);\n#endif\n\n#ifndef CONFIG_INLINE_SPIN_UNLOCK_IRQ\nnoinline void __lockfunc _raw_spin_unlock_irq(raw_spinlock_t *lock)\n{\n\t__raw_spin_unlock_irq(lock);\n}\nEXPORT_SYMBOL(_raw_spin_unlock_irq);\n#endif\n\n#ifndef CONFIG_INLINE_SPIN_UNLOCK_BH\nnoinline void __lockfunc _raw_spin_unlock_bh(raw_spinlock_t *lock)\n{\n\t__raw_spin_unlock_bh(lock);\n}\nEXPORT_SYMBOL(_raw_spin_unlock_bh);\n#endif\n\n#ifndef CONFIG_PREEMPT_RT\n\n#ifndef CONFIG_INLINE_READ_TRYLOCK\nnoinline int __lockfunc _raw_read_trylock(rwlock_t *lock)\n{\n\treturn __raw_read_trylock(lock);\n}\nEXPORT_SYMBOL(_raw_read_trylock);\n#endif\n\n#ifndef CONFIG_INLINE_READ_LOCK\nnoinline void __lockfunc _raw_read_lock(rwlock_t *lock)\n{\n\t__raw_read_lock(lock);\n}\nEXPORT_SYMBOL(_raw_read_lock);\n#endif\n\n#ifndef CONFIG_INLINE_READ_LOCK_IRQSAVE\nnoinline unsigned long __lockfunc _raw_read_lock_irqsave(rwlock_t *lock)\n{\n\treturn __raw_read_lock_irqsave(lock);\n}\nEXPORT_SYMBOL(_raw_read_lock_irqsave);\n#endif\n\n#ifndef CONFIG_INLINE_READ_LOCK_IRQ\nnoinline void __lockfunc _raw_read_lock_irq(rwlock_t *lock)\n{\n\t__raw_read_lock_irq(lock);\n}\nEXPORT_SYMBOL(_raw_read_lock_irq);\n#endif\n\n#ifndef CONFIG_INLINE_READ_LOCK_BH\nnoinline void __lockfunc _raw_read_lock_bh(rwlock_t *lock)\n{\n\t__raw_read_lock_bh(lock);\n}\nEXPORT_SYMBOL(_raw_read_lock_bh);\n#endif\n\n#ifndef CONFIG_INLINE_READ_UNLOCK\nnoinline void __lockfunc _raw_read_unlock(rwlock_t *lock)\n{\n\t__raw_read_unlock(lock);\n}\nEXPORT_SYMBOL(_raw_read_unlock);\n#endif\n\n#ifndef CONFIG_INLINE_READ_UNLOCK_IRQRESTORE\nnoinline void __lockfunc _raw_read_unlock_irqrestore(rwlock_t *lock, unsigned long flags)\n{\n\t__raw_read_unlock_irqrestore(lock, flags);\n}\nEXPORT_SYMBOL(_raw_read_unlock_irqrestore);\n#endif\n\n#ifndef CONFIG_INLINE_READ_UNLOCK_IRQ\nnoinline void __lockfunc _raw_read_unlock_irq(rwlock_t *lock)\n{\n\t__raw_read_unlock_irq(lock);\n}\nEXPORT_SYMBOL(_raw_read_unlock_irq);\n#endif\n\n#ifndef CONFIG_INLINE_READ_UNLOCK_BH\nnoinline void __lockfunc _raw_read_unlock_bh(rwlock_t *lock)\n{\n\t__raw_read_unlock_bh(lock);\n}\nEXPORT_SYMBOL(_raw_read_unlock_bh);\n#endif\n\n#ifndef CONFIG_INLINE_WRITE_TRYLOCK\nnoinline int __lockfunc _raw_write_trylock(rwlock_t *lock)\n{\n\treturn __raw_write_trylock(lock);\n}\nEXPORT_SYMBOL(_raw_write_trylock);\n#endif\n\n#ifndef CONFIG_INLINE_WRITE_LOCK\nnoinline void __lockfunc _raw_write_lock(rwlock_t *lock)\n{\n\t__raw_write_lock(lock);\n}\nEXPORT_SYMBOL(_raw_write_lock);\n\n#ifndef CONFIG_DEBUG_LOCK_ALLOC\n#define __raw_write_lock_nested(lock, subclass)\t__raw_write_lock(((void)(subclass), (lock)))\n#endif\n\nvoid __lockfunc _raw_write_lock_nested(rwlock_t *lock, int subclass)\n{\n\t__raw_write_lock_nested(lock, subclass);\n}\nEXPORT_SYMBOL(_raw_write_lock_nested);\n#endif\n\n#ifndef CONFIG_INLINE_WRITE_LOCK_IRQSAVE\nnoinline unsigned long __lockfunc _raw_write_lock_irqsave(rwlock_t *lock)\n{\n\treturn __raw_write_lock_irqsave(lock);\n}\nEXPORT_SYMBOL(_raw_write_lock_irqsave);\n#endif\n\n#ifndef CONFIG_INLINE_WRITE_LOCK_IRQ\nnoinline void __lockfunc _raw_write_lock_irq(rwlock_t *lock)\n{\n\t__raw_write_lock_irq(lock);\n}\nEXPORT_SYMBOL(_raw_write_lock_irq);\n#endif\n\n#ifndef CONFIG_INLINE_WRITE_LOCK_BH\nnoinline void __lockfunc _raw_write_lock_bh(rwlock_t *lock)\n{\n\t__raw_write_lock_bh(lock);\n}\nEXPORT_SYMBOL(_raw_write_lock_bh);\n#endif\n\n#ifndef CONFIG_INLINE_WRITE_UNLOCK\nnoinline void __lockfunc _raw_write_unlock(rwlock_t *lock)\n{\n\t__raw_write_unlock(lock);\n}\nEXPORT_SYMBOL(_raw_write_unlock);\n#endif\n\n#ifndef CONFIG_INLINE_WRITE_UNLOCK_IRQRESTORE\nnoinline void __lockfunc _raw_write_unlock_irqrestore(rwlock_t *lock, unsigned long flags)\n{\n\t__raw_write_unlock_irqrestore(lock, flags);\n}\nEXPORT_SYMBOL(_raw_write_unlock_irqrestore);\n#endif\n\n#ifndef CONFIG_INLINE_WRITE_UNLOCK_IRQ\nnoinline void __lockfunc _raw_write_unlock_irq(rwlock_t *lock)\n{\n\t__raw_write_unlock_irq(lock);\n}\nEXPORT_SYMBOL(_raw_write_unlock_irq);\n#endif\n\n#ifndef CONFIG_INLINE_WRITE_UNLOCK_BH\nnoinline void __lockfunc _raw_write_unlock_bh(rwlock_t *lock)\n{\n\t__raw_write_unlock_bh(lock);\n}\nEXPORT_SYMBOL(_raw_write_unlock_bh);\n#endif\n\n#endif  \n\n#ifdef CONFIG_DEBUG_LOCK_ALLOC\n\nvoid __lockfunc _raw_spin_lock_nested(raw_spinlock_t *lock, int subclass)\n{\n\tpreempt_disable();\n\tspin_acquire(&lock->dep_map, subclass, 0, _RET_IP_);\n\tLOCK_CONTENDED(lock, do_raw_spin_trylock, do_raw_spin_lock);\n}\nEXPORT_SYMBOL(_raw_spin_lock_nested);\n\nunsigned long __lockfunc _raw_spin_lock_irqsave_nested(raw_spinlock_t *lock,\n\t\t\t\t\t\t   int subclass)\n{\n\tunsigned long flags;\n\n\tlocal_irq_save(flags);\n\tpreempt_disable();\n\tspin_acquire(&lock->dep_map, subclass, 0, _RET_IP_);\n\tLOCK_CONTENDED(lock, do_raw_spin_trylock, do_raw_spin_lock);\n\treturn flags;\n}\nEXPORT_SYMBOL(_raw_spin_lock_irqsave_nested);\n\nvoid __lockfunc _raw_spin_lock_nest_lock(raw_spinlock_t *lock,\n\t\t\t\t     struct lockdep_map *nest_lock)\n{\n\tpreempt_disable();\n\tspin_acquire_nest(&lock->dep_map, 0, 0, nest_lock, _RET_IP_);\n\tLOCK_CONTENDED(lock, do_raw_spin_trylock, do_raw_spin_lock);\n}\nEXPORT_SYMBOL(_raw_spin_lock_nest_lock);\n\n#endif\n\nnotrace int in_lock_functions(unsigned long addr)\n{\n\t \n\textern char __lock_text_start[], __lock_text_end[];\n\n\treturn addr >= (unsigned long)__lock_text_start\n\t&& addr < (unsigned long)__lock_text_end;\n}\nEXPORT_SYMBOL(in_lock_functions);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}