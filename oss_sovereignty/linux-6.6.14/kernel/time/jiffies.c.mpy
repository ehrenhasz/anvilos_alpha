{
  "module_name": "jiffies.c",
  "hash_id": "fda8bd78aa60141a39a5736baac5502510f32f99be0ac42c03069adffc857a7c",
  "original_prompt": "Ingested from linux-6.6.14/kernel/time/jiffies.c",
  "human_readable_source": "\n \n#include <linux/clocksource.h>\n#include <linux/jiffies.h>\n#include <linux/module.h>\n#include <linux/init.h>\n\n#include \"timekeeping.h\"\n#include \"tick-internal.h\"\n\n\nstatic u64 jiffies_read(struct clocksource *cs)\n{\n\treturn (u64) jiffies;\n}\n\n \nstatic struct clocksource clocksource_jiffies = {\n\t.name\t\t\t= \"jiffies\",\n\t.rating\t\t\t= 1,  \n\t.uncertainty_margin\t= 32 * NSEC_PER_MSEC,\n\t.read\t\t\t= jiffies_read,\n\t.mask\t\t\t= CLOCKSOURCE_MASK(32),\n\t.mult\t\t\t= TICK_NSEC << JIFFIES_SHIFT,  \n\t.shift\t\t\t= JIFFIES_SHIFT,\n\t.max_cycles\t\t= 10,\n};\n\n__cacheline_aligned_in_smp DEFINE_RAW_SPINLOCK(jiffies_lock);\n__cacheline_aligned_in_smp seqcount_raw_spinlock_t jiffies_seq =\n\tSEQCNT_RAW_SPINLOCK_ZERO(jiffies_seq, &jiffies_lock);\n\n#if (BITS_PER_LONG < 64)\nu64 get_jiffies_64(void)\n{\n\tunsigned int seq;\n\tu64 ret;\n\n\tdo {\n\t\tseq = read_seqcount_begin(&jiffies_seq);\n\t\tret = jiffies_64;\n\t} while (read_seqcount_retry(&jiffies_seq, seq));\n\treturn ret;\n}\nEXPORT_SYMBOL(get_jiffies_64);\n#endif\n\nEXPORT_SYMBOL(jiffies);\n\nstatic int __init init_jiffies_clocksource(void)\n{\n\treturn __clocksource_register(&clocksource_jiffies);\n}\n\ncore_initcall(init_jiffies_clocksource);\n\nstruct clocksource * __init __weak clocksource_default_clock(void)\n{\n\treturn &clocksource_jiffies;\n}\n\nstatic struct clocksource refined_jiffies;\n\nint register_refined_jiffies(long cycles_per_second)\n{\n\tu64 nsec_per_tick, shift_hz;\n\tlong cycles_per_tick;\n\n\n\n\trefined_jiffies = clocksource_jiffies;\n\trefined_jiffies.name = \"refined-jiffies\";\n\trefined_jiffies.rating++;\n\n\t \n\tcycles_per_tick = (cycles_per_second + HZ/2)/HZ;\n\t \n\tshift_hz = (u64)cycles_per_second << 8;\n\tshift_hz += cycles_per_tick/2;\n\tdo_div(shift_hz, cycles_per_tick);\n\t \n\tnsec_per_tick = (u64)NSEC_PER_SEC << 8;\n\tnsec_per_tick += (u32)shift_hz/2;\n\tdo_div(nsec_per_tick, (u32)shift_hz);\n\n\trefined_jiffies.mult = ((u32)nsec_per_tick) << JIFFIES_SHIFT;\n\n\t__clocksource_register(&refined_jiffies);\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}