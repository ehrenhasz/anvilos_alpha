{
  "module_name": "tree.h",
  "hash_id": "41b8326b4726f8f29e5383fb988547e479db822ab1bffbc7865d60b56292adb0",
  "original_prompt": "Ingested from linux-6.6.14/kernel/rcu/tree.h",
  "human_readable_source": " \n \n\n#include <linux/cache.h>\n#include <linux/kthread.h>\n#include <linux/spinlock.h>\n#include <linux/rtmutex.h>\n#include <linux/threads.h>\n#include <linux/cpumask.h>\n#include <linux/seqlock.h>\n#include <linux/swait.h>\n#include <linux/rcu_node_tree.h>\n\n#include \"rcu_segcblist.h\"\n\n \nstruct rcu_exp_work {\n\tunsigned long rew_s;\n#ifdef CONFIG_RCU_EXP_KTHREAD\n\tstruct kthread_work rew_work;\n#else\n\tstruct work_struct rew_work;\n#endif  \n};\n\n \n#define RCU_KTHREAD_STOPPED  0\n#define RCU_KTHREAD_RUNNING  1\n#define RCU_KTHREAD_WAITING  2\n#define RCU_KTHREAD_OFFCPU   3\n#define RCU_KTHREAD_YIELDING 4\n#define RCU_KTHREAD_MAX      4\n\n \nstruct rcu_node {\n\traw_spinlock_t __private lock;\t \n\t\t\t\t\t \n\t\t\t\t\t \n\tunsigned long gp_seq;\t \n\tunsigned long gp_seq_needed;  \n\tunsigned long completedqs;  \n\tunsigned long qsmask;\t \n\t\t\t\t \n\t\t\t\t \n\t\t\t\t \n\t\t\t\t \n\t\t\t\t \n\tunsigned long rcu_gp_init_mask;\t \n\tunsigned long qsmaskinit;\n\t\t\t\t \n\t\t\t\t \n\t\t\t\t \n\tunsigned long qsmaskinitnext;\n\tunsigned long expmask;\t \n\t\t\t\t \n\t\t\t\t \n\tunsigned long expmaskinit;\n\t\t\t\t \n\t\t\t\t \n\t\t\t\t \n\tunsigned long expmaskinitnext;\n\t\t\t\t \n\t\t\t\t \n\t\t\t\t \n\tunsigned long cbovldmask;\n\t\t\t\t \n\tunsigned long ffmask;\t \n\tunsigned long grpmask;\t \n\t\t\t\t \n\tint\tgrplo;\t\t \n\tint\tgrphi;\t\t \n\tu8\tgrpnum;\t\t \n\tu8\tlevel;\t\t \n\tbool\twait_blkd_tasks; \n\t\t\t\t \n\t\t\t\t \n\t\t\t\t \n\tstruct rcu_node *parent;\n\tstruct list_head blkd_tasks;\n\t\t\t\t \n\t\t\t\t \n\t\t\t\t \n\tstruct list_head *gp_tasks;\n\t\t\t\t \n\t\t\t\t \n\t\t\t\t \n\tstruct list_head *exp_tasks;\n\t\t\t\t \n\t\t\t\t \n\t\t\t\t \n\t\t\t\t \n\t\t\t\t \n\tstruct list_head *boost_tasks;\n\t\t\t\t \n\t\t\t\t \n\t\t\t\t \n\t\t\t\t \n\t\t\t\t \n\t\t\t\t \n\t\t\t\t \n\tstruct rt_mutex boost_mtx;\n\t\t\t\t \n\t\t\t\t \n\tunsigned long boost_time;\n\t\t\t\t \n\tstruct mutex boost_kthread_mutex;\n\t\t\t\t \n\t\t\t\t \n\tstruct task_struct *boost_kthread_task;\n\t\t\t\t \n\t\t\t\t \n\tunsigned int boost_kthread_status;\n\t\t\t\t \n\tunsigned long n_boosts;\t \n#ifdef CONFIG_RCU_NOCB_CPU\n\tstruct swait_queue_head nocb_gp_wq[2];\n\t\t\t\t \n#endif  \n\traw_spinlock_t fqslock ____cacheline_internodealigned_in_smp;\n\n\tspinlock_t exp_lock ____cacheline_internodealigned_in_smp;\n\tunsigned long exp_seq_rq;\n\twait_queue_head_t exp_wq[4];\n\tstruct rcu_exp_work rew;\n\tbool exp_need_flush;\t \n\traw_spinlock_t exp_poll_lock;\n\t\t\t\t \n\tunsigned long exp_seq_poll_rq;\n\tstruct work_struct exp_poll_wq;\n} ____cacheline_internodealigned_in_smp;\n\n \n#define leaf_node_cpu_bit(rnp, cpu) (BIT((cpu) - (rnp)->grplo))\n\n \nunion rcu_noqs {\n\tstruct {\n\t\tu8 norm;\n\t\tu8 exp;\n\t} b;  \n\tu16 s;  \n};\n\n \nstruct rcu_snap_record {\n\tunsigned long\tgp_seq;\t\t \n\tu64\t\tcputime_irq;\t \n\tu64\t\tcputime_softirq; \n\tu64\t\tcputime_system;  \n\tunsigned long\tnr_hardirqs;\t \n\tunsigned int\tnr_softirqs;\t \n\tunsigned long long nr_csw;\t \n\tunsigned long   jiffies;\t \n};\n\n \nstruct rcu_data {\n\t \n\tunsigned long\tgp_seq;\t\t \n\tunsigned long\tgp_seq_needed;\t \n\tunion rcu_noqs\tcpu_no_qs;\t \n\tbool\t\tcore_needs_qs;\t \n\tbool\t\tbeenonline;\t \n\tbool\t\tgpwrap;\t\t \n\tbool\t\tcpu_started;\t \n\tstruct rcu_node *mynode;\t \n\tunsigned long grpmask;\t\t \n\tunsigned long\tticks_this_gp;\t \n\t\t\t\t\t \n\t\t\t\t\t \n\t\t\t\t\t \n\tstruct irq_work defer_qs_iw;\t \n\tbool defer_qs_iw_pending;\t \n\tstruct work_struct strict_work;\t \n\n\t \n\tstruct rcu_segcblist cblist;\t \n\t\t\t\t\t \n\t\t\t\t\t \n\tlong\t\tqlen_last_fqs_check;\n\t\t\t\t\t \n\tunsigned long\tn_cbs_invoked;\t \n\tunsigned long\tn_force_qs_snap;\n\t\t\t\t\t \n\tlong\t\tblimit;\t\t \n\n\t \n\tint dynticks_snap;\t\t \n\tbool rcu_need_heavy_qs;\t\t \n\tbool rcu_urgent_qs;\t\t \n\tbool rcu_forced_tick;\t\t \n\tbool rcu_forced_tick_exp;\t \n\n\t \n\tunsigned long barrier_seq_snap;\t \n\tstruct rcu_head barrier_head;\n\tint exp_dynticks_snap;\t\t \n\n\t \n#ifdef CONFIG_RCU_NOCB_CPU\n\tstruct swait_queue_head nocb_cb_wq;  \n\tstruct swait_queue_head nocb_state_wq;  \n\tstruct task_struct *nocb_gp_kthread;\n\traw_spinlock_t nocb_lock;\t \n\tatomic_t nocb_lock_contended;\t \n\tint nocb_defer_wakeup;\t\t \n\tstruct timer_list nocb_timer;\t \n\tunsigned long nocb_gp_adv_time;\t \n\tstruct mutex nocb_gp_kthread_mutex;  \n\t\t\t\t\t     \n\n\t \n\traw_spinlock_t nocb_bypass_lock ____cacheline_internodealigned_in_smp;\n\tstruct rcu_cblist nocb_bypass;\t \n\tunsigned long nocb_bypass_first;  \n\tunsigned long nocb_nobypass_last;  \n\tint nocb_nobypass_count;\t \n\n\t \n\traw_spinlock_t nocb_gp_lock ____cacheline_internodealigned_in_smp;\n\tu8 nocb_gp_sleep;\t\t \n\tu8 nocb_gp_bypass;\t\t \n\tu8 nocb_gp_gp;\t\t\t \n\tunsigned long nocb_gp_seq;\t \n\tunsigned long nocb_gp_loops;\t \n\tstruct swait_queue_head nocb_gp_wq;  \n\tbool nocb_cb_sleep;\t\t \n\tstruct task_struct *nocb_cb_kthread;\n\tstruct list_head nocb_head_rdp;  \n\tstruct list_head nocb_entry_rdp;  \n\tstruct rcu_data *nocb_toggling_rdp;  \n\n\t \n\tstruct rcu_data *nocb_gp_rdp ____cacheline_internodealigned_in_smp;\n\t\t\t\t\t \n#endif  \n\n\t \n\tstruct task_struct *rcu_cpu_kthread_task;\n\t\t\t\t\t \n\tunsigned int rcu_cpu_kthread_status;\n\tchar rcu_cpu_has_work;\n\tunsigned long rcuc_activity;\n\n\t \n\tunsigned int softirq_snap;\t \n\t \n\tstruct irq_work rcu_iw;\t\t \n\tbool rcu_iw_pending;\t\t \n\tunsigned long rcu_iw_gp_seq;\t \n\tunsigned long rcu_ofl_gp_seq;\t \n\tshort rcu_ofl_gp_flags;\t\t \n\tunsigned long rcu_onl_gp_seq;\t \n\tshort rcu_onl_gp_flags;\t\t \n\tunsigned long last_fqs_resched;\t \n\tunsigned long last_sched_clock;\t \n\tstruct rcu_snap_record snap_record;  \n\t\t\t\t\t     \n\n\tlong lazy_len;\t\t\t \n\tint cpu;\n};\n\n \n#define RCU_NOCB_WAKE_NOT\t0\n#define RCU_NOCB_WAKE_BYPASS\t1\n#define RCU_NOCB_WAKE_LAZY\t2\n#define RCU_NOCB_WAKE\t\t3\n#define RCU_NOCB_WAKE_FORCE\t4\n\n#define RCU_JIFFIES_TILL_FORCE_QS (1 + (HZ > 250) + (HZ > 500))\n\t\t\t\t\t \n\t\t\t\t\t \n\n#define RCU_JIFFIES_FQS_DIV\t256\t \n\t\t\t\t\t \n\t\t\t\t\t \n\n#define RCU_STALL_RAT_DELAY\t2\t \n\t\t\t\t\t \n\t\t\t\t\t \n\n#define rcu_wait(cond)\t\t\t\t\t\t\t\\\ndo {\t\t\t\t\t\t\t\t\t\\\n\tfor (;;) {\t\t\t\t\t\t\t\\\n\t\tset_current_state(TASK_INTERRUPTIBLE);\t\t\t\\\n\t\tif (cond)\t\t\t\t\t\t\\\n\t\t\tbreak;\t\t\t\t\t\t\\\n\t\tschedule();\t\t\t\t\t\t\\\n\t}\t\t\t\t\t\t\t\t\\\n\t__set_current_state(TASK_RUNNING);\t\t\t\t\\\n} while (0)\n\n \nstruct rcu_state {\n\tstruct rcu_node node[NUM_RCU_NODES];\t \n\tstruct rcu_node *level[RCU_NUM_LVLS + 1];\n\t\t\t\t\t\t \n\t\t\t\t\t\t \n\tint ncpus;\t\t\t\t \n\tint n_online_cpus;\t\t\t \n\n\t \n\n\tunsigned long gp_seq ____cacheline_internodealigned_in_smp;\n\t\t\t\t\t\t \n\tunsigned long gp_max;\t\t\t \n\t\t\t\t\t\t \n\tstruct task_struct *gp_kthread;\t\t \n\tstruct swait_queue_head gp_wq;\t\t \n\tshort gp_flags;\t\t\t\t \n\tshort gp_state;\t\t\t\t \n\tunsigned long gp_wake_time;\t\t \n\tunsigned long gp_wake_seq;\t\t \n\tunsigned long gp_seq_polled;\t\t \n\tunsigned long gp_seq_polled_snap;\t \n\tunsigned long gp_seq_polled_exp_snap;\t \n\n\t \n\n\tstruct mutex barrier_mutex;\t\t \n\tatomic_t barrier_cpu_count;\t\t \n\tstruct completion barrier_completion;\t \n\tunsigned long barrier_sequence;\t\t \n\t\t\t\t\t\t \n\t \n\n\traw_spinlock_t barrier_lock;\t\t \n\n\tstruct mutex exp_mutex;\t\t\t \n\tstruct mutex exp_wake_mutex;\t\t \n\tunsigned long expedited_sequence;\t \n\tatomic_t expedited_need_qs;\t\t \n\tstruct swait_queue_head expedited_wq;\t \n\tint ncpus_snap;\t\t\t\t \n\tu8 cbovld;\t\t\t\t \n\tu8 cbovldnext;\t\t\t\t \n\n\tunsigned long jiffies_force_qs;\t\t \n\t\t\t\t\t\t \n\tunsigned long jiffies_kick_kthreads;\t \n\t\t\t\t\t\t \n\tunsigned long n_force_qs;\t\t \n\t\t\t\t\t\t \n\tunsigned long gp_start;\t\t\t \n\t\t\t\t\t\t \n\tunsigned long gp_end;\t\t\t \n\t\t\t\t\t\t \n\tunsigned long gp_activity;\t\t \n\t\t\t\t\t\t \n\tunsigned long gp_req_activity;\t\t \n\t\t\t\t\t\t \n\tunsigned long jiffies_stall;\t\t \n\t\t\t\t\t\t \n\tint nr_fqs_jiffies_stall;\t\t \n\tunsigned long jiffies_resched;\t\t \n\t\t\t\t\t\t \n\tunsigned long n_force_qs_gpstart;\t \n\t\t\t\t\t\t \n\tconst char *name;\t\t\t \n\tchar abbr;\t\t\t\t \n\n\tarch_spinlock_t ofl_lock ____cacheline_internodealigned_in_smp;\n\t\t\t\t\t\t \n\t\t\t\t\t\t \n\tint nocb_is_setup;\t\t\t \n};\n\n \n#define RCU_GP_FLAG_INIT 0x1\t \n#define RCU_GP_FLAG_FQS  0x2\t \n#define RCU_GP_FLAG_OVLD 0x4\t \n\n \n#define RCU_GP_IDLE\t 0\t \n#define RCU_GP_WAIT_GPS  1\t \n#define RCU_GP_DONE_GPS  2\t \n#define RCU_GP_ONOFF     3\t \n#define RCU_GP_INIT      4\t \n#define RCU_GP_WAIT_FQS  5\t \n#define RCU_GP_DOING_FQS 6\t \n#define RCU_GP_CLEANUP   7\t \n#define RCU_GP_CLEANED   8\t \n\n \n#ifdef CONFIG_PREEMPT_RCU\n#define RCU_ABBR 'p'\n#define RCU_NAME_RAW \"rcu_preempt\"\n#else  \n#define RCU_ABBR 's'\n#define RCU_NAME_RAW \"rcu_sched\"\n#endif  \n#ifndef CONFIG_TRACING\n#define RCU_NAME RCU_NAME_RAW\n#else  \nstatic char rcu_name[] = RCU_NAME_RAW;\nstatic const char *tp_rcu_varname __used __tracepoint_string = rcu_name;\n#define RCU_NAME rcu_name\n#endif  \n\n \nstatic void rcu_bootup_announce(void);\nstatic void rcu_qs(void);\nstatic int rcu_preempt_blocked_readers_cgp(struct rcu_node *rnp);\n#ifdef CONFIG_HOTPLUG_CPU\nstatic bool rcu_preempt_has_tasks(struct rcu_node *rnp);\n#endif  \nstatic int rcu_print_task_exp_stall(struct rcu_node *rnp);\nstatic void rcu_preempt_check_blocked_tasks(struct rcu_node *rnp);\nstatic void rcu_flavor_sched_clock_irq(int user);\nstatic void dump_blkd_tasks(struct rcu_node *rnp, int ncheck);\nstatic void rcu_initiate_boost(struct rcu_node *rnp, unsigned long flags);\nstatic void rcu_preempt_boost_start_gp(struct rcu_node *rnp);\nstatic bool rcu_is_callbacks_kthread(struct rcu_data *rdp);\nstatic void rcu_cpu_kthread_setup(unsigned int cpu);\nstatic void rcu_spawn_one_boost_kthread(struct rcu_node *rnp);\nstatic bool rcu_preempt_has_tasks(struct rcu_node *rnp);\nstatic bool rcu_preempt_need_deferred_qs(struct task_struct *t);\nstatic void zero_cpu_stall_ticks(struct rcu_data *rdp);\nstatic struct swait_queue_head *rcu_nocb_gp_get(struct rcu_node *rnp);\nstatic void rcu_nocb_gp_cleanup(struct swait_queue_head *sq);\nstatic void rcu_init_one_nocb(struct rcu_node *rnp);\nstatic bool wake_nocb_gp(struct rcu_data *rdp, bool force);\nstatic bool rcu_nocb_flush_bypass(struct rcu_data *rdp, struct rcu_head *rhp,\n\t\t\t\t  unsigned long j, bool lazy);\nstatic bool rcu_nocb_try_bypass(struct rcu_data *rdp, struct rcu_head *rhp,\n\t\t\t\tbool *was_alldone, unsigned long flags,\n\t\t\t\tbool lazy);\nstatic void __call_rcu_nocb_wake(struct rcu_data *rdp, bool was_empty,\n\t\t\t\t unsigned long flags);\nstatic int rcu_nocb_need_deferred_wakeup(struct rcu_data *rdp, int level);\nstatic bool do_nocb_deferred_wakeup(struct rcu_data *rdp);\nstatic void rcu_boot_init_nocb_percpu_data(struct rcu_data *rdp);\nstatic void rcu_spawn_cpu_nocb_kthread(int cpu);\nstatic void show_rcu_nocb_state(struct rcu_data *rdp);\nstatic void rcu_nocb_lock(struct rcu_data *rdp);\nstatic void rcu_nocb_unlock(struct rcu_data *rdp);\nstatic void rcu_nocb_unlock_irqrestore(struct rcu_data *rdp,\n\t\t\t\t       unsigned long flags);\nstatic void rcu_lockdep_assert_cblist_protected(struct rcu_data *rdp);\n#ifdef CONFIG_RCU_NOCB_CPU\nstatic void __init rcu_organize_nocb_kthreads(void);\n\n \n#define rcu_nocb_lock_irqsave(rdp, flags)\t\t\t\\\ndo {\t\t\t\t\t\t\t\t\\\n\tlocal_irq_save(flags);\t\t\t\t\t\\\n\tif (rcu_segcblist_is_offloaded(&(rdp)->cblist))\t\\\n\t\traw_spin_lock(&(rdp)->nocb_lock);\t\t\\\n} while (0)\n#else  \n#define rcu_nocb_lock_irqsave(rdp, flags) local_irq_save(flags)\n#endif  \n\nstatic void rcu_bind_gp_kthread(void);\nstatic bool rcu_nohz_full_cpu(void);\n\n \nstatic void record_gp_stall_check_time(void);\nstatic void rcu_iw_handler(struct irq_work *iwp);\nstatic void check_cpu_stall(struct rcu_data *rdp);\nstatic void rcu_check_gp_start_stall(struct rcu_node *rnp, struct rcu_data *rdp,\n\t\t\t\t     const unsigned long gpssdelay);\n\n \nstatic void sync_rcu_do_polled_gp(struct work_struct *wp);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}