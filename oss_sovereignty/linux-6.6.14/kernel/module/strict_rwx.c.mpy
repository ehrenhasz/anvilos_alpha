{
  "module_name": "strict_rwx.c",
  "hash_id": "b2b56c72eb081c09e1b5fa0f131aa31157a3c48e92f020da269965de3bcc32ff",
  "original_prompt": "Ingested from linux-6.6.14/kernel/module/strict_rwx.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/mm.h>\n#include <linux/vmalloc.h>\n#include <linux/set_memory.h>\n#include \"internal.h\"\n\nstatic void module_set_memory(const struct module *mod, enum mod_mem_type type,\n\t\t\t      int (*set_memory)(unsigned long start, int num_pages))\n{\n\tconst struct module_memory *mod_mem = &mod->mem[type];\n\n\tset_vm_flush_reset_perms(mod_mem->base);\n\tset_memory((unsigned long)mod_mem->base, mod_mem->size >> PAGE_SHIFT);\n}\n\n \nvoid module_enable_x(const struct module *mod)\n{\n\tfor_class_mod_mem_type(type, text)\n\t\tmodule_set_memory(mod, type, set_memory_x);\n}\n\nvoid module_enable_ro(const struct module *mod, bool after_init)\n{\n\tif (!IS_ENABLED(CONFIG_STRICT_MODULE_RWX))\n\t\treturn;\n#ifdef CONFIG_STRICT_MODULE_RWX\n\tif (!rodata_enabled)\n\t\treturn;\n#endif\n\n\tmodule_set_memory(mod, MOD_TEXT, set_memory_ro);\n\tmodule_set_memory(mod, MOD_INIT_TEXT, set_memory_ro);\n\tmodule_set_memory(mod, MOD_RODATA, set_memory_ro);\n\tmodule_set_memory(mod, MOD_INIT_RODATA, set_memory_ro);\n\n\tif (after_init)\n\t\tmodule_set_memory(mod, MOD_RO_AFTER_INIT, set_memory_ro);\n}\n\nvoid module_enable_nx(const struct module *mod)\n{\n\tif (!IS_ENABLED(CONFIG_STRICT_MODULE_RWX))\n\t\treturn;\n\n\tfor_class_mod_mem_type(type, data)\n\t\tmodule_set_memory(mod, type, set_memory_nx);\n}\n\nint module_enforce_rwx_sections(Elf_Ehdr *hdr, Elf_Shdr *sechdrs,\n\t\t\t\tchar *secstrings, struct module *mod)\n{\n\tconst unsigned long shf_wx = SHF_WRITE | SHF_EXECINSTR;\n\tint i;\n\n\tif (!IS_ENABLED(CONFIG_STRICT_MODULE_RWX))\n\t\treturn 0;\n\n\tfor (i = 0; i < hdr->e_shnum; i++) {\n\t\tif ((sechdrs[i].sh_flags & shf_wx) == shf_wx) {\n\t\t\tpr_err(\"%s: section %s (index %d) has invalid WRITE|EXEC flags\\n\",\n\t\t\t       mod->name, secstrings + sechdrs[i].sh_name, i);\n\t\t\treturn -ENOEXEC;\n\t\t}\n\t}\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}