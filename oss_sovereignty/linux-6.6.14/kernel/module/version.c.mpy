{
  "module_name": "version.c",
  "hash_id": "ac8522ab87108671c05bd970f12c82a624216f7f3d58613f3d21967cf01c37c5",
  "original_prompt": "Ingested from linux-6.6.14/kernel/module/version.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/string.h>\n#include <linux/printk.h>\n#include \"internal.h\"\n\nint check_version(const struct load_info *info,\n\t\t  const char *symname,\n\t\t\t struct module *mod,\n\t\t\t const s32 *crc)\n{\n\tElf_Shdr *sechdrs = info->sechdrs;\n\tunsigned int versindex = info->index.vers;\n\tunsigned int i, num_versions;\n\tstruct modversion_info *versions;\n\n\t \n\tif (!crc)\n\t\treturn 1;\n\n\t \n\tif (versindex == 0)\n\t\treturn try_to_force_load(mod, symname) == 0;\n\n\tversions = (void *)sechdrs[versindex].sh_addr;\n\tnum_versions = sechdrs[versindex].sh_size\n\t\t/ sizeof(struct modversion_info);\n\n\tfor (i = 0; i < num_versions; i++) {\n\t\tu32 crcval;\n\n\t\tif (strcmp(versions[i].name, symname) != 0)\n\t\t\tcontinue;\n\n\t\tcrcval = *crc;\n\t\tif (versions[i].crc == crcval)\n\t\t\treturn 1;\n\t\tpr_debug(\"Found checksum %X vs module %lX\\n\",\n\t\t\t crcval, versions[i].crc);\n\t\tgoto bad_version;\n\t}\n\n\t \n\tpr_warn_once(\"%s: no symbol version for %s\\n\", info->name, symname);\n\treturn 1;\n\nbad_version:\n\tpr_warn(\"%s: disagrees about version of symbol %s\\n\", info->name, symname);\n\treturn 0;\n}\n\nint check_modstruct_version(const struct load_info *info,\n\t\t\t    struct module *mod)\n{\n\tstruct find_symbol_arg fsa = {\n\t\t.name\t= \"module_layout\",\n\t\t.gplok\t= true,\n\t};\n\n\t \n\tpreempt_disable();\n\tif (!find_symbol(&fsa)) {\n\t\tpreempt_enable();\n\t\tBUG();\n\t}\n\tpreempt_enable();\n\treturn check_version(info, \"module_layout\", mod, fsa.crc);\n}\n\n \nint same_magic(const char *amagic, const char *bmagic,\n\t       bool has_crcs)\n{\n\tif (has_crcs) {\n\t\tamagic += strcspn(amagic, \" \");\n\t\tbmagic += strcspn(bmagic, \" \");\n\t}\n\treturn strcmp(amagic, bmagic) == 0;\n}\n\n \nvoid module_layout(struct module *mod,\n\t\t   struct modversion_info *ver,\n\t\t   struct kernel_param *kp,\n\t\t   struct kernel_symbol *ks,\n\t\t   struct tracepoint * const *tp)\n{\n}\nEXPORT_SYMBOL(module_layout);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}