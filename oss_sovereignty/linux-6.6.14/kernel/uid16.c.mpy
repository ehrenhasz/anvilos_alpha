{
  "module_name": "uid16.c",
  "hash_id": "89fab123ae215a565722c4edb8e08a8e24f1940feaf2f04686117c7e1bffd6ac",
  "original_prompt": "Ingested from linux-6.6.14/kernel/uid16.c",
  "human_readable_source": "\n \n\n#include <linux/mm.h>\n#include <linux/mman.h>\n#include <linux/notifier.h>\n#include <linux/reboot.h>\n#include <linux/prctl.h>\n#include <linux/capability.h>\n#include <linux/init.h>\n#include <linux/highuid.h>\n#include <linux/security.h>\n#include <linux/cred.h>\n#include <linux/syscalls.h>\n\n#include <linux/uaccess.h>\n\n#include \"uid16.h\"\n\nSYSCALL_DEFINE3(chown16, const char __user *, filename, old_uid_t, user, old_gid_t, group)\n{\n\treturn ksys_chown(filename, low2highuid(user), low2highgid(group));\n}\n\nSYSCALL_DEFINE3(lchown16, const char __user *, filename, old_uid_t, user, old_gid_t, group)\n{\n\treturn ksys_lchown(filename, low2highuid(user), low2highgid(group));\n}\n\nSYSCALL_DEFINE3(fchown16, unsigned int, fd, old_uid_t, user, old_gid_t, group)\n{\n\treturn ksys_fchown(fd, low2highuid(user), low2highgid(group));\n}\n\nSYSCALL_DEFINE2(setregid16, old_gid_t, rgid, old_gid_t, egid)\n{\n\treturn __sys_setregid(low2highgid(rgid), low2highgid(egid));\n}\n\nSYSCALL_DEFINE1(setgid16, old_gid_t, gid)\n{\n\treturn __sys_setgid(low2highgid(gid));\n}\n\nSYSCALL_DEFINE2(setreuid16, old_uid_t, ruid, old_uid_t, euid)\n{\n\treturn __sys_setreuid(low2highuid(ruid), low2highuid(euid));\n}\n\nSYSCALL_DEFINE1(setuid16, old_uid_t, uid)\n{\n\treturn __sys_setuid(low2highuid(uid));\n}\n\nSYSCALL_DEFINE3(setresuid16, old_uid_t, ruid, old_uid_t, euid, old_uid_t, suid)\n{\n\treturn __sys_setresuid(low2highuid(ruid), low2highuid(euid),\n\t\t\t\t low2highuid(suid));\n}\n\nSYSCALL_DEFINE3(getresuid16, old_uid_t __user *, ruidp, old_uid_t __user *, euidp, old_uid_t __user *, suidp)\n{\n\tconst struct cred *cred = current_cred();\n\tint retval;\n\told_uid_t ruid, euid, suid;\n\n\truid = high2lowuid(from_kuid_munged(cred->user_ns, cred->uid));\n\teuid = high2lowuid(from_kuid_munged(cred->user_ns, cred->euid));\n\tsuid = high2lowuid(from_kuid_munged(cred->user_ns, cred->suid));\n\n\tif (!(retval   = put_user(ruid, ruidp)) &&\n\t    !(retval   = put_user(euid, euidp)))\n\t\tretval = put_user(suid, suidp);\n\n\treturn retval;\n}\n\nSYSCALL_DEFINE3(setresgid16, old_gid_t, rgid, old_gid_t, egid, old_gid_t, sgid)\n{\n\treturn __sys_setresgid(low2highgid(rgid), low2highgid(egid),\n\t\t\t\t low2highgid(sgid));\n}\n\nSYSCALL_DEFINE3(getresgid16, old_gid_t __user *, rgidp, old_gid_t __user *, egidp, old_gid_t __user *, sgidp)\n{\n\tconst struct cred *cred = current_cred();\n\tint retval;\n\told_gid_t rgid, egid, sgid;\n\n\trgid = high2lowgid(from_kgid_munged(cred->user_ns, cred->gid));\n\tegid = high2lowgid(from_kgid_munged(cred->user_ns, cred->egid));\n\tsgid = high2lowgid(from_kgid_munged(cred->user_ns, cred->sgid));\n\n\tif (!(retval   = put_user(rgid, rgidp)) &&\n\t    !(retval   = put_user(egid, egidp)))\n\t\tretval = put_user(sgid, sgidp);\n\n\treturn retval;\n}\n\nSYSCALL_DEFINE1(setfsuid16, old_uid_t, uid)\n{\n\treturn __sys_setfsuid(low2highuid(uid));\n}\n\nSYSCALL_DEFINE1(setfsgid16, old_gid_t, gid)\n{\n\treturn __sys_setfsgid(low2highgid(gid));\n}\n\nstatic int groups16_to_user(old_gid_t __user *grouplist,\n    struct group_info *group_info)\n{\n\tstruct user_namespace *user_ns = current_user_ns();\n\tint i;\n\told_gid_t group;\n\tkgid_t kgid;\n\n\tfor (i = 0; i < group_info->ngroups; i++) {\n\t\tkgid = group_info->gid[i];\n\t\tgroup = high2lowgid(from_kgid_munged(user_ns, kgid));\n\t\tif (put_user(group, grouplist+i))\n\t\t\treturn -EFAULT;\n\t}\n\n\treturn 0;\n}\n\nstatic int groups16_from_user(struct group_info *group_info,\n    old_gid_t __user *grouplist)\n{\n\tstruct user_namespace *user_ns = current_user_ns();\n\tint i;\n\told_gid_t group;\n\tkgid_t kgid;\n\n\tfor (i = 0; i < group_info->ngroups; i++) {\n\t\tif (get_user(group, grouplist+i))\n\t\t\treturn  -EFAULT;\n\n\t\tkgid = make_kgid(user_ns, low2highgid(group));\n\t\tif (!gid_valid(kgid))\n\t\t\treturn -EINVAL;\n\n\t\tgroup_info->gid[i] = kgid;\n\t}\n\n\treturn 0;\n}\n\nSYSCALL_DEFINE2(getgroups16, int, gidsetsize, old_gid_t __user *, grouplist)\n{\n\tconst struct cred *cred = current_cred();\n\tint i;\n\n\tif (gidsetsize < 0)\n\t\treturn -EINVAL;\n\n\ti = cred->group_info->ngroups;\n\tif (gidsetsize) {\n\t\tif (i > gidsetsize) {\n\t\t\ti = -EINVAL;\n\t\t\tgoto out;\n\t\t}\n\t\tif (groups16_to_user(grouplist, cred->group_info)) {\n\t\t\ti = -EFAULT;\n\t\t\tgoto out;\n\t\t}\n\t}\nout:\n\treturn i;\n}\n\nSYSCALL_DEFINE2(setgroups16, int, gidsetsize, old_gid_t __user *, grouplist)\n{\n\tstruct group_info *group_info;\n\tint retval;\n\n\tif (!may_setgroups())\n\t\treturn -EPERM;\n\tif ((unsigned)gidsetsize > NGROUPS_MAX)\n\t\treturn -EINVAL;\n\n\tgroup_info = groups_alloc(gidsetsize);\n\tif (!group_info)\n\t\treturn -ENOMEM;\n\tretval = groups16_from_user(group_info, grouplist);\n\tif (retval) {\n\t\tput_group_info(group_info);\n\t\treturn retval;\n\t}\n\n\tgroups_sort(group_info);\n\tretval = set_current_groups(group_info);\n\tput_group_info(group_info);\n\n\treturn retval;\n}\n\nSYSCALL_DEFINE0(getuid16)\n{\n\treturn high2lowuid(from_kuid_munged(current_user_ns(), current_uid()));\n}\n\nSYSCALL_DEFINE0(geteuid16)\n{\n\treturn high2lowuid(from_kuid_munged(current_user_ns(), current_euid()));\n}\n\nSYSCALL_DEFINE0(getgid16)\n{\n\treturn high2lowgid(from_kgid_munged(current_user_ns(), current_gid()));\n}\n\nSYSCALL_DEFINE0(getegid16)\n{\n\treturn high2lowgid(from_kgid_munged(current_user_ns(), current_egid()));\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}