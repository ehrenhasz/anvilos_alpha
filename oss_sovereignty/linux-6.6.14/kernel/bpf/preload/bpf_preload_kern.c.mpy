{
  "module_name": "bpf_preload_kern.c",
  "hash_id": "036967ad444e50d37b5641be0a45e9a237c2903655272d56ec76749a14733537",
  "original_prompt": "Ingested from linux-6.6.14/kernel/bpf/preload/bpf_preload_kern.c",
  "human_readable_source": "\n#define pr_fmt(fmt) KBUILD_MODNAME \": \" fmt\n#include <linux/init.h>\n#include <linux/module.h>\n#include \"bpf_preload.h\"\n#if __BYTE_ORDER__ == __ORDER_LITTLE_ENDIAN__\n#include \"iterators/iterators.lskel-little-endian.h\"\n#else\n#include \"iterators/iterators.lskel-big-endian.h\"\n#endif\n\nstatic struct bpf_link *maps_link, *progs_link;\nstatic struct iterators_bpf *skel;\n\nstatic void free_links_and_skel(void)\n{\n\tif (!IS_ERR_OR_NULL(maps_link))\n\t\tbpf_link_put(maps_link);\n\tif (!IS_ERR_OR_NULL(progs_link))\n\t\tbpf_link_put(progs_link);\n\titerators_bpf__destroy(skel);\n}\n\nstatic int preload(struct bpf_preload_info *obj)\n{\n\tstrscpy(obj[0].link_name, \"maps.debug\", sizeof(obj[0].link_name));\n\tobj[0].link = maps_link;\n\tstrscpy(obj[1].link_name, \"progs.debug\", sizeof(obj[1].link_name));\n\tobj[1].link = progs_link;\n\treturn 0;\n}\n\nstatic struct bpf_preload_ops ops = {\n\t.preload = preload,\n\t.owner = THIS_MODULE,\n};\n\nstatic int load_skel(void)\n{\n\tint err;\n\n\tskel = iterators_bpf__open();\n\tif (!skel)\n\t\treturn -ENOMEM;\n\terr = iterators_bpf__load(skel);\n\tif (err)\n\t\tgoto out;\n\terr = iterators_bpf__attach(skel);\n\tif (err)\n\t\tgoto out;\n\tmaps_link = bpf_link_get_from_fd(skel->links.dump_bpf_map_fd);\n\tif (IS_ERR(maps_link)) {\n\t\terr = PTR_ERR(maps_link);\n\t\tgoto out;\n\t}\n\tprogs_link = bpf_link_get_from_fd(skel->links.dump_bpf_prog_fd);\n\tif (IS_ERR(progs_link)) {\n\t\terr = PTR_ERR(progs_link);\n\t\tgoto out;\n\t}\n\t \n\tclose_fd(skel->links.dump_bpf_map_fd);\n\tskel->links.dump_bpf_map_fd = 0;\n\tclose_fd(skel->links.dump_bpf_prog_fd);\n\tskel->links.dump_bpf_prog_fd = 0;\n\treturn 0;\nout:\n\tfree_links_and_skel();\n\treturn err;\n}\n\nstatic int __init load(void)\n{\n\tint err;\n\n\terr = load_skel();\n\tif (err)\n\t\treturn err;\n\tbpf_preload_ops = &ops;\n\treturn err;\n}\n\nstatic void __exit fini(void)\n{\n\tbpf_preload_ops = NULL;\n\tfree_links_and_skel();\n}\nlate_initcall(load);\nmodule_exit(fini);\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}