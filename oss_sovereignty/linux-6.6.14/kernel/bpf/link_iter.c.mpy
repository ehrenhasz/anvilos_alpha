{
  "module_name": "link_iter.c",
  "hash_id": "7d06d3f1e8271fafed95cc393861ecd937957318dfef52d5088b2f12a1262255",
  "original_prompt": "Ingested from linux-6.6.14/kernel/bpf/link_iter.c",
  "human_readable_source": "\n \n#include <linux/bpf.h>\n#include <linux/fs.h>\n#include <linux/filter.h>\n#include <linux/kernel.h>\n#include <linux/btf_ids.h>\n\nstruct bpf_iter_seq_link_info {\n\tu32 link_id;\n};\n\nstatic void *bpf_link_seq_start(struct seq_file *seq, loff_t *pos)\n{\n\tstruct bpf_iter_seq_link_info *info = seq->private;\n\tstruct bpf_link *link;\n\n\tlink = bpf_link_get_curr_or_next(&info->link_id);\n\tif (!link)\n\t\treturn NULL;\n\n\tif (*pos == 0)\n\t\t++*pos;\n\treturn link;\n}\n\nstatic void *bpf_link_seq_next(struct seq_file *seq, void *v, loff_t *pos)\n{\n\tstruct bpf_iter_seq_link_info *info = seq->private;\n\n\t++*pos;\n\t++info->link_id;\n\tbpf_link_put((struct bpf_link *)v);\n\treturn bpf_link_get_curr_or_next(&info->link_id);\n}\n\nstruct bpf_iter__bpf_link {\n\t__bpf_md_ptr(struct bpf_iter_meta *, meta);\n\t__bpf_md_ptr(struct bpf_link *, link);\n};\n\nDEFINE_BPF_ITER_FUNC(bpf_link, struct bpf_iter_meta *meta, struct bpf_link *link)\n\nstatic int __bpf_link_seq_show(struct seq_file *seq, void *v, bool in_stop)\n{\n\tstruct bpf_iter__bpf_link ctx;\n\tstruct bpf_iter_meta meta;\n\tstruct bpf_prog *prog;\n\tint ret = 0;\n\n\tctx.meta = &meta;\n\tctx.link = v;\n\tmeta.seq = seq;\n\tprog = bpf_iter_get_info(&meta, in_stop);\n\tif (prog)\n\t\tret = bpf_iter_run_prog(prog, &ctx);\n\n\treturn ret;\n}\n\nstatic int bpf_link_seq_show(struct seq_file *seq, void *v)\n{\n\treturn __bpf_link_seq_show(seq, v, false);\n}\n\nstatic void bpf_link_seq_stop(struct seq_file *seq, void *v)\n{\n\tif (!v)\n\t\t(void)__bpf_link_seq_show(seq, v, true);\n\telse\n\t\tbpf_link_put((struct bpf_link *)v);\n}\n\nstatic const struct seq_operations bpf_link_seq_ops = {\n\t.start\t= bpf_link_seq_start,\n\t.next\t= bpf_link_seq_next,\n\t.stop\t= bpf_link_seq_stop,\n\t.show\t= bpf_link_seq_show,\n};\n\nBTF_ID_LIST(btf_bpf_link_id)\nBTF_ID(struct, bpf_link)\n\nstatic const struct bpf_iter_seq_info bpf_link_seq_info = {\n\t.seq_ops\t\t= &bpf_link_seq_ops,\n\t.init_seq_private\t= NULL,\n\t.fini_seq_private\t= NULL,\n\t.seq_priv_size\t\t= sizeof(struct bpf_iter_seq_link_info),\n};\n\nstatic struct bpf_iter_reg bpf_link_reg_info = {\n\t.target\t\t\t= \"bpf_link\",\n\t.ctx_arg_info_size\t= 1,\n\t.ctx_arg_info\t\t= {\n\t\t{ offsetof(struct bpf_iter__bpf_link, link),\n\t\t  PTR_TO_BTF_ID_OR_NULL },\n\t},\n\t.seq_info\t\t= &bpf_link_seq_info,\n};\n\nstatic int __init bpf_link_iter_init(void)\n{\n\tbpf_link_reg_info.ctx_arg_info[0].btf_id = *btf_bpf_link_id;\n\treturn bpf_iter_reg_target(&bpf_link_reg_info);\n}\n\nlate_initcall(bpf_link_iter_init);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}