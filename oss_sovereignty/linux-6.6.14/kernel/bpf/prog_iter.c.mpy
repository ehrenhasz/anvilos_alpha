{
  "module_name": "prog_iter.c",
  "hash_id": "30dcde1d670c97afa34dfe06b5bfe0c03990a38115a934a22aeb2267765bafff",
  "original_prompt": "Ingested from linux-6.6.14/kernel/bpf/prog_iter.c",
  "human_readable_source": "\n \n#include <linux/bpf.h>\n#include <linux/fs.h>\n#include <linux/filter.h>\n#include <linux/kernel.h>\n#include <linux/btf_ids.h>\n\nstruct bpf_iter_seq_prog_info {\n\tu32 prog_id;\n};\n\nstatic void *bpf_prog_seq_start(struct seq_file *seq, loff_t *pos)\n{\n\tstruct bpf_iter_seq_prog_info *info = seq->private;\n\tstruct bpf_prog *prog;\n\n\tprog = bpf_prog_get_curr_or_next(&info->prog_id);\n\tif (!prog)\n\t\treturn NULL;\n\n\tif (*pos == 0)\n\t\t++*pos;\n\treturn prog;\n}\n\nstatic void *bpf_prog_seq_next(struct seq_file *seq, void *v, loff_t *pos)\n{\n\tstruct bpf_iter_seq_prog_info *info = seq->private;\n\n\t++*pos;\n\t++info->prog_id;\n\tbpf_prog_put((struct bpf_prog *)v);\n\treturn bpf_prog_get_curr_or_next(&info->prog_id);\n}\n\nstruct bpf_iter__bpf_prog {\n\t__bpf_md_ptr(struct bpf_iter_meta *, meta);\n\t__bpf_md_ptr(struct bpf_prog *, prog);\n};\n\nDEFINE_BPF_ITER_FUNC(bpf_prog, struct bpf_iter_meta *meta, struct bpf_prog *prog)\n\nstatic int __bpf_prog_seq_show(struct seq_file *seq, void *v, bool in_stop)\n{\n\tstruct bpf_iter__bpf_prog ctx;\n\tstruct bpf_iter_meta meta;\n\tstruct bpf_prog *prog;\n\tint ret = 0;\n\n\tctx.meta = &meta;\n\tctx.prog = v;\n\tmeta.seq = seq;\n\tprog = bpf_iter_get_info(&meta, in_stop);\n\tif (prog)\n\t\tret = bpf_iter_run_prog(prog, &ctx);\n\n\treturn ret;\n}\n\nstatic int bpf_prog_seq_show(struct seq_file *seq, void *v)\n{\n\treturn __bpf_prog_seq_show(seq, v, false);\n}\n\nstatic void bpf_prog_seq_stop(struct seq_file *seq, void *v)\n{\n\tif (!v)\n\t\t(void)__bpf_prog_seq_show(seq, v, true);\n\telse\n\t\tbpf_prog_put((struct bpf_prog *)v);\n}\n\nstatic const struct seq_operations bpf_prog_seq_ops = {\n\t.start\t= bpf_prog_seq_start,\n\t.next\t= bpf_prog_seq_next,\n\t.stop\t= bpf_prog_seq_stop,\n\t.show\t= bpf_prog_seq_show,\n};\n\nBTF_ID_LIST(btf_bpf_prog_id)\nBTF_ID(struct, bpf_prog)\n\nstatic const struct bpf_iter_seq_info bpf_prog_seq_info = {\n\t.seq_ops\t\t= &bpf_prog_seq_ops,\n\t.init_seq_private\t= NULL,\n\t.fini_seq_private\t= NULL,\n\t.seq_priv_size\t\t= sizeof(struct bpf_iter_seq_prog_info),\n};\n\nstatic struct bpf_iter_reg bpf_prog_reg_info = {\n\t.target\t\t\t= \"bpf_prog\",\n\t.ctx_arg_info_size\t= 1,\n\t.ctx_arg_info\t\t= {\n\t\t{ offsetof(struct bpf_iter__bpf_prog, prog),\n\t\t  PTR_TO_BTF_ID_OR_NULL },\n\t},\n\t.seq_info\t\t= &bpf_prog_seq_info,\n};\n\nstatic int __init bpf_prog_iter_init(void)\n{\n\tbpf_prog_reg_info.ctx_arg_info[0].btf_id = *btf_bpf_prog_id;\n\treturn bpf_iter_reg_target(&bpf_prog_reg_info);\n}\n\nlate_initcall(bpf_prog_iter_init);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}