{
  "module_name": "utsname_sysctl.c",
  "hash_id": "ecc9c4db5402e264adb2213138095e8f494f090f1dffa0592fc950c26a7d1af4",
  "original_prompt": "Ingested from linux-6.6.14/kernel/utsname_sysctl.c",
  "human_readable_source": "\n \n\n#include <linux/export.h>\n#include <linux/uts.h>\n#include <linux/utsname.h>\n#include <linux/random.h>\n#include <linux/sysctl.h>\n#include <linux/wait.h>\n#include <linux/rwsem.h>\n\n#ifdef CONFIG_PROC_SYSCTL\n\nstatic void *get_uts(struct ctl_table *table)\n{\n\tchar *which = table->data;\n\tstruct uts_namespace *uts_ns;\n\n\tuts_ns = current->nsproxy->uts_ns;\n\twhich = (which - (char *)&init_uts_ns) + (char *)uts_ns;\n\n\treturn which;\n}\n\n \nstatic int proc_do_uts_string(struct ctl_table *table, int write,\n\t\t  void *buffer, size_t *lenp, loff_t *ppos)\n{\n\tstruct ctl_table uts_table;\n\tint r;\n\tchar tmp_data[__NEW_UTS_LEN + 1];\n\n\tmemcpy(&uts_table, table, sizeof(uts_table));\n\tuts_table.data = tmp_data;\n\n\t \n\tdown_read(&uts_sem);\n\tmemcpy(tmp_data, get_uts(table), sizeof(tmp_data));\n\tup_read(&uts_sem);\n\tr = proc_dostring(&uts_table, write, buffer, lenp, ppos);\n\n\tif (write) {\n\t\t \n\t\tadd_device_randomness(tmp_data, sizeof(tmp_data));\n\t\tdown_write(&uts_sem);\n\t\tmemcpy(get_uts(table), tmp_data, sizeof(tmp_data));\n\t\tup_write(&uts_sem);\n\t\tproc_sys_poll_notify(table->poll);\n\t}\n\n\treturn r;\n}\n#else\n#define proc_do_uts_string NULL\n#endif\n\nstatic DEFINE_CTL_TABLE_POLL(hostname_poll);\nstatic DEFINE_CTL_TABLE_POLL(domainname_poll);\n\n\nstatic struct ctl_table uts_kern_table[] = {\n\t{\n\t\t.procname\t= \"arch\",\n\t\t.data\t\t= init_uts_ns.name.machine,\n\t\t.maxlen\t\t= sizeof(init_uts_ns.name.machine),\n\t\t.mode\t\t= 0444,\n\t\t.proc_handler\t= proc_do_uts_string,\n\t},\n\t{\n\t\t.procname\t= \"ostype\",\n\t\t.data\t\t= init_uts_ns.name.sysname,\n\t\t.maxlen\t\t= sizeof(init_uts_ns.name.sysname),\n\t\t.mode\t\t= 0444,\n\t\t.proc_handler\t= proc_do_uts_string,\n\t},\n\t{\n\t\t.procname\t= \"osrelease\",\n\t\t.data\t\t= init_uts_ns.name.release,\n\t\t.maxlen\t\t= sizeof(init_uts_ns.name.release),\n\t\t.mode\t\t= 0444,\n\t\t.proc_handler\t= proc_do_uts_string,\n\t},\n\t{\n\t\t.procname\t= \"version\",\n\t\t.data\t\t= init_uts_ns.name.version,\n\t\t.maxlen\t\t= sizeof(init_uts_ns.name.version),\n\t\t.mode\t\t= 0444,\n\t\t.proc_handler\t= proc_do_uts_string,\n\t},\n\t{\n\t\t.procname\t= \"hostname\",\n\t\t.data\t\t= init_uts_ns.name.nodename,\n\t\t.maxlen\t\t= sizeof(init_uts_ns.name.nodename),\n\t\t.mode\t\t= 0644,\n\t\t.proc_handler\t= proc_do_uts_string,\n\t\t.poll\t\t= &hostname_poll,\n\t},\n\t{\n\t\t.procname\t= \"domainname\",\n\t\t.data\t\t= init_uts_ns.name.domainname,\n\t\t.maxlen\t\t= sizeof(init_uts_ns.name.domainname),\n\t\t.mode\t\t= 0644,\n\t\t.proc_handler\t= proc_do_uts_string,\n\t\t.poll\t\t= &domainname_poll,\n\t},\n\t{}\n};\n\n#ifdef CONFIG_PROC_SYSCTL\n \nvoid uts_proc_notify(enum uts_proc proc)\n{\n\tstruct ctl_table *table = &uts_kern_table[proc];\n\n\tproc_sys_poll_notify(table->poll);\n}\n#endif\n\nstatic int __init utsname_sysctl_init(void)\n{\n\tregister_sysctl(\"kernel\", uts_kern_table);\n\treturn 0;\n}\n\ndevice_initcall(utsname_sysctl_init);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}