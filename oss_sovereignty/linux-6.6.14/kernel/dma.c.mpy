{
  "module_name": "dma.c",
  "hash_id": "814849115db7bab46e82c1eda607e8c59704b1433cdd7f93e8a770161e4f8e9f",
  "original_prompt": "Ingested from linux-6.6.14/kernel/dma.c",
  "human_readable_source": "\n \n#include <linux/export.h>\n#include <linux/kernel.h>\n#include <linux/errno.h>\n#include <linux/spinlock.h>\n#include <linux/string.h>\n#include <linux/seq_file.h>\n#include <linux/proc_fs.h>\n#include <linux/init.h>\n#include <asm/dma.h>\n\n\n\n \n\n\nDEFINE_SPINLOCK(dma_spin_lock);\n\n \n\n#ifdef MAX_DMA_CHANNELS\n\n\n \n\nstruct dma_chan {\n\tint  lock;\n\tconst char *device_id;\n};\n\nstatic struct dma_chan dma_chan_busy[MAX_DMA_CHANNELS] = {\n\t[4] = { 1, \"cascade\" },\n};\n\n\n \nint request_dma(unsigned int dmanr, const char * device_id)\n{\n\tif (dmanr >= MAX_DMA_CHANNELS)\n\t\treturn -EINVAL;\n\n\tif (xchg(&dma_chan_busy[dmanr].lock, 1) != 0)\n\t\treturn -EBUSY;\n\n\tdma_chan_busy[dmanr].device_id = device_id;\n\n\t \n\treturn 0;\n}  \n\n \nvoid free_dma(unsigned int dmanr)\n{\n\tif (dmanr >= MAX_DMA_CHANNELS) {\n\t\tprintk(KERN_WARNING \"Trying to free DMA%d\\n\", dmanr);\n\t\treturn;\n\t}\n\n\tif (xchg(&dma_chan_busy[dmanr].lock, 0) == 0) {\n\t\tprintk(KERN_WARNING \"Trying to free free DMA%d\\n\", dmanr);\n\t\treturn;\n\t}\n\n}  \n\n#else\n\nint request_dma(unsigned int dmanr, const char *device_id)\n{\n\treturn -EINVAL;\n}\n\nvoid free_dma(unsigned int dmanr)\n{\n}\n\n#endif\n\n#ifdef CONFIG_PROC_FS\n\n#ifdef MAX_DMA_CHANNELS\nstatic int proc_dma_show(struct seq_file *m, void *v)\n{\n\tint i;\n\n\tfor (i = 0 ; i < MAX_DMA_CHANNELS ; i++) {\n\t\tif (dma_chan_busy[i].lock) {\n\t\t\tseq_printf(m, \"%2d: %s\\n\", i,\n\t\t\t\t   dma_chan_busy[i].device_id);\n\t\t}\n\t}\n\treturn 0;\n}\n#else\nstatic int proc_dma_show(struct seq_file *m, void *v)\n{\n\tseq_puts(m, \"No DMA\\n\");\n\treturn 0;\n}\n#endif  \n\nstatic int __init proc_dma_init(void)\n{\n\tproc_create_single(\"dma\", 0, NULL, proc_dma_show);\n\treturn 0;\n}\n\n__initcall(proc_dma_init);\n#endif\n\nEXPORT_SYMBOL(request_dma);\nEXPORT_SYMBOL(free_dma);\nEXPORT_SYMBOL(dma_spin_lock);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}