{
  "module_name": "tags.sh",
  "hash_id": "b0d851174c3c03dd06d7d68392d37d08bbb838f4e205526b97db57b78f3be000",
  "original_prompt": "Ingested from linux-6.6.14/scripts/tags.sh",
  "human_readable_source": "#!/bin/bash\n# SPDX-License-Identifier: GPL-2.0-only\n# Generate tags or cscope files\n# Usage tags.sh <mode>\n#\n# mode may be any of: tags, TAGS, cscope\n#\n# Uses the following environment variables:\n# SUBARCH, SRCARCH, srctree\n\nif [[ \"$KBUILD_VERBOSE\" =~ 1 ]]; then\n\tset -x\nfi\n\n# RCS_FIND_IGNORE has escaped ()s -- remove them.\nignore=\"$(echo \"$RCS_FIND_IGNORE\" | sed 's|\\\\||g' )\"\n# tags and cscope files should also ignore MODVERSION *.mod.c files\nignore=\"$ignore ( -name *.mod.c ) -prune -o\"\n\n# ignore arbitrary directories\nif [ -n \"${IGNORE_DIRS}\" ]; then\n\tfor i in ${IGNORE_DIRS}; do\n\t\tignore=\"${ignore} ( -path $i ) -prune -o\"\n\tdone\nfi\n\n# Use make KBUILD_ABS_SRCTREE=1 {tags|cscope}\n# to force full paths for a non-O= build\nif [ \"${srctree}\" = \".\" -o -z \"${srctree}\" ]; then\n\ttree=\nelse\n\ttree=${srctree}/\nfi\n\n# gtags(1) refuses to index any file outside of its current working dir.\n# If gtags indexing is requested and the build output directory is not\n# the kernel source tree, index all files in absolute-path form.\nif [[ \"$1\" == \"gtags\" && -n \"${tree}\" ]]; then\n\ttree=$(realpath \"$tree\")/\nfi\n\n# Detect if ALLSOURCE_ARCHS is set. If not, we assume SRCARCH\nif [ \"${ALLSOURCE_ARCHS}\" = \"\" ]; then\n\tALLSOURCE_ARCHS=${SRCARCH}\nelif [ \"${ALLSOURCE_ARCHS}\" = \"all\" ]; then\n\tALLSOURCE_ARCHS=$(find ${tree}arch/ -mindepth 1 -maxdepth 1 -type d -printf '%f ')\nfi\n\n# find sources in arch/$1\nfind_arch_sources()\n{\n\tfor i in $archincludedir; do\n\t\tprune=\"$prune -wholename $i -prune -o\"\n\tdone\n\tfind ${tree}arch/$1 $ignore $prune -name \"$2\" -not -type l -print;\n}\n\n# find sources in arch/$1/include\nfind_arch_include_sources()\n{\n\tinclude=$(find ${tree}arch/$1/ -name include -type d -print);\n\tif [ -n \"$include\" ]; then\n\t\tarchincludedir=\"$archincludedir $include\"\n\t\tfind $include $ignore -name \"$2\" -not -type l -print;\n\tfi\n}\n\n# find sources in include/\nfind_include_sources()\n{\n\tfind ${tree}include $ignore -name config -prune -o -name \"$1\" \\\n\t\t-not -type l -print;\n}\n\n# find sources in rest of tree\n# we could benefit from a list of dirs to search in here\nfind_other_sources()\n{\n\tfind ${tree}* $ignore \\\n\t     \\( -path ${tree}include -o -path ${tree}arch -o -name '.tmp_*' \\) -prune -o \\\n\t       -name \"$1\" -not -type l -print;\n}\n\nfind_sources()\n{\n\tfind_arch_sources $1 \"$2\"\n}\n\nall_sources()\n{\n\tfind_arch_include_sources ${SRCARCH} '*.[chS]'\n\tif [ ! -z \"$archinclude\" ]; then\n\t\tfind_arch_include_sources $archinclude '*.[chS]'\n\tfi\n\tfind_include_sources '*.[chS]'\n\tfor arch in $ALLSOURCE_ARCHS\n\tdo\n\t\tfind_sources $arch '*.[chS]'\n\tdone\n\tfind_other_sources '*.[chS]'\n}\n\nall_compiled_sources()\n{\n\t{\n\t\techo include/generated/autoconf.h\n\t\tfind $ignore -name \"*.cmd\" -exec \\\n\t\t\tgrep -Poh '(?<=^  )\\S+|(?<== )\\S+[^\\\\](?=$)' {} \\+ |\n\t\tawk '!a[$0]++'\n\t} | xargs realpath -esq $([ -z \"$KBUILD_ABS_SRCTREE\" ] && echo --relative-to=.) |\n\tsort -u\n}\n\nall_target_sources()\n{\n\tif [ -n \"$COMPILED_SOURCE\" ]; then\n\t\tall_compiled_sources\n\telse\n\t\tall_sources\n\tfi\n}\n\nall_kconfigs()\n{\n\tfind ${tree}arch/ -maxdepth 1 $ignore \\\n\t       -name \"Kconfig*\" -not -type l -print;\n\tfor arch in $ALLSOURCE_ARCHS; do\n\t\tfind_sources $arch 'Kconfig*'\n\tdone\n\tfind_other_sources 'Kconfig*'\n}\n\ndocscope()\n{\n\t(echo \\-k; echo \\-q; all_target_sources) > cscope.files\n\tcscope -b -f cscope.out\n}\n\ndogtags()\n{\n\tall_target_sources | gtags -i -C \"${tree:-.}\" -f - \"$PWD\"\n}\n\n# Basic regular expressions with an optional /kind-spec/ for ctags and\n# the following limitations:\n# - No regex modifiers\n# - Use \\{0,1\\} instead of \\?, because etags expects an unescaped ?\n# - \\s is not working with etags, use a space or [ \\t]\n# - \\w works, but does not match underscores in etags\n# - etags regular expressions have to match at the start of a line;\n#   a ^[^#] is prepended by setup_regex unless an anchor is already present\nregex_asm=(\n\t'/^\\(ENTRY\\|_GLOBAL\\)([[:space:]]*\\([[:alnum:]_\\\\]*\\)).*/\\2/'\n)\nregex_c=(\n\t'/^SYSCALL_DEFINE[0-9]([[:space:]]*\\([[:alnum:]_]*\\).*/sys_\\1/'\n\t'/^BPF_CALL_[0-9]([[:space:]]*\\([[:alnum:]_]*\\).*/\\1/'\n\t'/^COMPAT_SYSCALL_DEFINE[0-9]([[:space:]]*\\([[:alnum:]_]*\\).*/compat_sys_\\1/'\n\t'/^TRACE_EVENT([[:space:]]*\\([[:alnum:]_]*\\).*/trace_\\1/'\n\t'/^TRACE_EVENT([[:space:]]*\\([[:alnum:]_]*\\).*/trace_\\1_rcuidle/'\n\t'/^DEFINE_EVENT([^,)]*,[[:space:]]*\\([[:alnum:]_]*\\).*/trace_\\1/'\n\t'/^DEFINE_EVENT([^,)]*,[[:space:]]*\\([[:alnum:]_]*\\).*/trace_\\1_rcuidle/'\n\t'/^DEFINE_INSN_CACHE_OPS([[:space:]]*\\([[:alnum:]_]*\\).*/get_\\1_slot/'\n\t'/^DEFINE_INSN_CACHE_OPS([[:space:]]*\\([[:alnum:]_]*\\).*/free_\\1_slot/'\n\t'/^PAGEFLAG([[:space:]]*\\([[:alnum:]_]*\\).*/Page\\1/'\n\t'/^PAGEFLAG([[:space:]]*\\([[:alnum:]_]*\\).*/SetPage\\1/'\n\t'/^PAGEFLAG([[:space:]]*\\([[:alnum:]_]*\\).*/ClearPage\\1/'\n\t'/^TESTSETFLAG([[:space:]]*\\([[:alnum:]_]*\\).*/TestSetPage\\1/'\n\t'/^TESTPAGEFLAG([[:space:]]*\\([[:alnum:]_]*\\).*/Page\\1/'\n\t'/^SETPAGEFLAG([[:space:]]*\\([[:alnum:]_]*\\).*/SetPage\\1/'\n\t'/\\<__SETPAGEFLAG([[:space:]]*\\([[:alnum:]_]*\\).*/__SetPage\\1/'\n\t'/\\<TESTCLEARFLAG([[:space:]]*\\([[:alnum:]_]*\\).*/TestClearPage\\1/'\n\t'/\\<__TESTCLEARFLAG([[:space:]]*\\([[:alnum:]_]*\\).*/TestClearPage\\1/'\n\t'/\\<CLEARPAGEFLAG([[:space:]]*\\([[:alnum:]_]*\\).*/ClearPage\\1/'\n\t'/\\<__CLEARPAGEFLAG([[:space:]]*\\([[:alnum:]_]*\\).*/__ClearPage\\1/'\n\t'/^__PAGEFLAG([[:space:]]*\\([[:alnum:]_]*\\).*/__SetPage\\1/'\n\t'/^__PAGEFLAG([[:space:]]*\\([[:alnum:]_]*\\).*/__ClearPage\\1/'\n\t'/^PAGEFLAG_FALSE([[:space:]]*\\([[:alnum:]_]*\\).*/Page\\1/'\n\t'/\\<TESTSCFLAG([[:space:]]*\\([[:alnum:]_]*\\).*/TestSetPage\\1/'\n\t'/\\<TESTSCFLAG([[:space:]]*\\([[:alnum:]_]*\\).*/TestClearPage\\1/'\n\t'/\\<SETPAGEFLAG_NOOP([[:space:]]*\\([[:alnum:]_]*\\).*/SetPage\\1/'\n\t'/\\<CLEARPAGEFLAG_NOOP([[:space:]]*\\([[:alnum:]_]*\\).*/ClearPage\\1/'\n\t'/\\<__CLEARPAGEFLAG_NOOP([[:space:]]*\\([[:alnum:]_]*\\).*/__ClearPage\\1/'\n\t'/\\<TESTCLEARFLAG_FALSE([[:space:]]*\\([[:alnum:]_]*\\).*/TestClearPage\\1/'\n\t'/^PAGE_TYPE_OPS([[:space:]]*\\([[:alnum:]_]*\\).*/Page\\1/'\n\t'/^PAGE_TYPE_OPS([[:space:]]*\\([[:alnum:]_]*\\).*/__SetPage\\1/'\n\t'/^PAGE_TYPE_OPS([[:space:]]*\\([[:alnum:]_]*\\).*/__ClearPage\\1/'\n\t'/^TASK_PFA_TEST([^,]*,[[:space:]]*\\([[:alnum:]_]*\\))/task_\\1/'\n\t'/^TASK_PFA_SET([^,]*,[[:space:]]*\\([[:alnum:]_]*\\))/task_set_\\1/'\n\t'/^TASK_PFA_CLEAR([^,]*,[[:space:]]*\\([[:alnum:]_]*\\))/task_clear_\\1/'\n\t'/^DEF_MMIO_\\(IN\\|OUT\\)_[XD]([[:space:]]*\\([[:alnum:]_]*\\),[^)]*)/\\2/'\n\t'/^DEBUGGER_BOILERPLATE([[:space:]]*\\([[:alnum:]_]*\\))/\\1/'\n\t'/^DEF_PCI_AC_\\(\\|NO\\)RET([[:space:]]*\\([[:alnum:]_]*\\).*/\\2/'\n\t'/^PCI_OP_READ([[:space:]]*\\(\\w*\\).*[1-4])/pci_bus_read_config_\\1/'\n\t'/^PCI_OP_WRITE([[:space:]]*\\(\\w*\\).*[1-4])/pci_bus_write_config_\\1/'\n\t'/\\<DEFINE_\\(RT_MUTEX\\|MUTEX\\|SEMAPHORE\\|SPINLOCK\\)([[:space:]]*\\([[:alnum:]_]*\\)/\\2/v/'\n\t'/\\<DEFINE_\\(RAW_SPINLOCK\\|RWLOCK\\|SEQLOCK\\)([[:space:]]*\\([[:alnum:]_]*\\)/\\2/v/'\n\t'/\\<DECLARE_\\(RWSEM\\|COMPLETION\\)([[:space:]]*\\([[:alnum:]_]\\+\\)/\\2/v/'\n\t'/\\<DECLARE_BITMAP([[:space:]]*\\([[:alnum:]_]*\\)/\\1/v/'\n\t'/\\(^\\|\\s\\)\\(\\|L\\|H\\)LIST_HEAD([[:space:]]*\\([[:alnum:]_]*\\)/\\3/v/'\n\t'/\\(^\\|\\s\\)RADIX_TREE([[:space:]]*\\([[:alnum:]_]*\\)/\\2/v/'\n\t'/\\<DEFINE_PER_CPU([^,]*,[[:space:]]*\\([[:alnum:]_]*\\)/\\1/v/'\n\t'/\\<DEFINE_PER_CPU_SHARED_ALIGNED([^,]*,[[:space:]]*\\([[:alnum:]_]*\\)/\\1/v/'\n\t'/\\<DECLARE_WAIT_QUEUE_HEAD([[:space:]]*\\([[:alnum:]_]*\\)/\\1/v/'\n\t'/\\<DECLARE_\\(TASKLET\\|WORK\\|DELAYED_WORK\\)([[:space:]]*\\([[:alnum:]_]*\\)/\\2/v/'\n\t'/\\(^\\s\\)OFFSET([[:space:]]*\\([[:alnum:]_]*\\)/\\2/v/'\n\t'/\\(^\\s\\)DEFINE([[:space:]]*\\([[:alnum:]_]*\\)/\\2/v/'\n\t'/\\<\\(DEFINE\\|DECLARE\\)_HASHTABLE([[:space:]]*\\([[:alnum:]_]*\\)/\\2/v/'\n\t'/\\<DEFINE_ID\\(R\\|A\\)([[:space:]]*\\([[:alnum:]_]\\+\\)/\\2/'\n\t'/\\<DEFINE_WD_CLASS([[:space:]]*\\([[:alnum:]_]\\+\\)/\\1/'\n\t'/\\<ATOMIC_NOTIFIER_HEAD([[:space:]]*\\([[:alnum:]_]\\+\\)/\\1/'\n\t'/\\<RAW_NOTIFIER_HEAD([[:space:]]*\\([[:alnum:]_]\\+\\)/\\1/'\n\t'/\\<DECLARE_FAULT_ATTR([[:space:]]*\\([[:alnum:]_]\\+\\)/\\1/'\n\t'/\\<BLOCKING_NOTIFIER_HEAD([[:space:]]*\\([[:alnum:]_]\\+\\)/\\1/'\n\t'/\\<DEVICE_ATTR_\\(RW\\|RO\\|WO\\)([[:space:]]*\\([[:alnum:]_]\\+\\)/dev_attr_\\2/'\n\t'/\\<DRIVER_ATTR_\\(RW\\|RO\\|WO\\)([[:space:]]*\\([[:alnum:]_]\\+\\)/driver_attr_\\2/'\n\t'/\\<\\(DEFINE\\|DECLARE\\)_STATIC_KEY_\\(TRUE\\|FALSE\\)\\(\\|_RO\\)([[:space:]]*\\([[:alnum:]_]\\+\\)/\\4/'\n\t'/^SEQCOUNT_LOCKTYPE(\\([^,]*\\),[[:space:]]*\\([^,]*\\),[^)]*)/seqcount_\\2_t/'\n\t'/^SEQCOUNT_LOCKTYPE(\\([^,]*\\),[[:space:]]*\\([^,]*\\),[^)]*)/seqcount_\\2_init/'\n)\nregex_kconfig=(\n\t'/^[[:blank:]]*\\(menu\\|\\)config[[:blank:]]\\+\\([[:alnum:]_]\\+\\)/\\2/'\n\t'/^[[:blank:]]*\\(menu\\|\\)config[[:blank:]]\\+\\([[:alnum:]_]\\+\\)/CONFIG_\\2/'\n)\nsetup_regex()\n{\n\tlocal mode=$1 lang tmp=() r\n\tshift\n\n\tregex=()\n\tfor lang; do\n\t\tcase \"$lang\" in\n\t\tasm)       tmp=(\"${regex_asm[@]}\") ;;\n\t\tc)         tmp=(\"${regex_c[@]}\") ;;\n\t\tkconfig)   tmp=(\"${regex_kconfig[@]}\") ;;\n\t\tesac\n\t\tfor r in \"${tmp[@]}\"; do\n\t\t\tif test \"$mode\" = \"exuberant\"; then\n\t\t\t\tregex[${#regex[@]}]=\"--regex-$lang=${r}b\"\n\t\t\telse\n\t\t\t\t# Remove ctags /kind-spec/\n\t\t\t\tcase \"$r\" in\n\t\t\t\t/*/*/?/)\n\t\t\t\t\tr=${r%?/}\n\t\t\t\tesac\n\t\t\t\t# Prepend ^[^#] unless already anchored\n\t\t\t\tcase \"$r\" in\n\t\t\t\t/^*) ;;\n\t\t\t\t*)\n\t\t\t\t\tr=\"/^[^#]*${r#/}\"\n\t\t\t\tesac\n\t\t\t\tregex[${#regex[@]}]=\"--regex=$r\"\n\t\t\tfi\n\t\tdone\n\tdone\n}\n\nexuberant()\n{\n\tCTAGS_EXTRA=\"extra\"\n\tif $1 --version 2>&1 | grep -iq universal; then\n\t    CTAGS_EXTRA=\"extras\"\n\tfi\n\tsetup_regex exuberant asm c\n\tall_target_sources | xargs $1 -a                        \\\n\t-I __initdata,__exitdata,__initconst,__ro_after_init\t\\\n\t-I __initdata_memblock\t\t\t\t\t\\\n\t-I __refdata,__attribute,__maybe_unused,__always_unused \\\n\t-I __acquires,__releases,__deprecated,__always_inline\t\\\n\t-I __read_mostly,__aligned,____cacheline_aligned        \\\n\t-I ____cacheline_aligned_in_smp                         \\\n\t-I __cacheline_aligned,__cacheline_aligned_in_smp\t\\\n\t-I ____cacheline_internodealigned_in_smp                \\\n\t-I __used,__packed,__packed2__,__must_check,__must_hold\t\\\n\t-I EXPORT_SYMBOL,EXPORT_SYMBOL_GPL,ACPI_EXPORT_SYMBOL   \\\n\t-I DEFINE_TRACE,EXPORT_TRACEPOINT_SYMBOL,EXPORT_TRACEPOINT_SYMBOL_GPL \\\n\t-I static,const\t\t\t\t\t\t\\\n\t--$CTAGS_EXTRA=+fq --c-kinds=+px --fields=+iaS --langmap=c:+.h \\\n\t\"${regex[@]}\"\n\n\tKCONFIG_ARGS=()\n\tif ! $1 --list-languages | grep -iq kconfig; then\n\t\tsetup_regex exuberant kconfig\n\t\tKCONFIG_ARGS=(--langdef=kconfig --language-force=kconfig \"${regex[@]}\")\n\tfi\n\tall_kconfigs | xargs $1 -a \"${KCONFIG_ARGS[@]}\"\n}\n\nemacs()\n{\n\tsetup_regex emacs asm c\n\tall_target_sources | xargs $1 -a \"${regex[@]}\"\n\n\tsetup_regex emacs kconfig\n\tall_kconfigs | xargs $1 -a \"${regex[@]}\"\n}\n\nxtags()\n{\n\tif $1 --version 2>&1 | grep -iq exuberant; then\n\t\texuberant $1\n\telif $1 --version 2>&1 | grep -iq emacs; then\n\t\temacs $1\n\telse\n\t\tall_target_sources | xargs $1 -a\n\tfi\n}\n\n# Support um (which uses SUBARCH)\nif [ \"${ARCH}\" = \"um\" ]; then\n\tif [ \"$SUBARCH\" = \"i386\" ]; then\n\t\tarchinclude=x86\n\telif [ \"$SUBARCH\" = \"x86_64\" ]; then\n\t\tarchinclude=x86\n\telse\n\t\tarchinclude=${SUBARCH}\n\tfi\nfi\n\nremove_structs=\ncase \"$1\" in\n\t\"cscope\")\n\t\tdocscope\n\t\t;;\n\n\t\"gtags\")\n\t\tdogtags\n\t\t;;\n\n\t\"tags\")\n\t\trm -f tags\n\t\txtags ctags\n\t\tremove_structs=y\n\t\t;;\n\n\t\"TAGS\")\n\t\trm -f TAGS\n\t\txtags etags\n\t\tremove_structs=y\n\t\t;;\nesac\n\n# Remove structure forward declarations.\nif [ -n \"$remove_structs\" ]; then\n    LC_ALL=C sed -i -e '/^\\([a-zA-Z_][a-zA-Z0-9_]*\\)\\t.*\\t\\/\\^struct \\1;.*\\$\\/;\"\\tx$/d' $1\nfi\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}