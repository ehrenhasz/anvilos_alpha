{
  "module_name": "nsdeps",
  "hash_id": "e7f6d721c04805a5d47c26019ecce33a30ea399c3039794594e7efdbe2052a50",
  "original_prompt": "Ingested from linux-6.6.14/scripts/nsdeps",
  "human_readable_source": "#!/bin/sh\n# SPDX-License-Identifier: GPL-2.0\n# Linux kernel symbol namespace import generator\n#\n# This script requires a minimum spatch version.\nSPATCH_REQ_VERSION=\"1.0.4\"\n\nDIR=\"$(dirname $(readlink -f $0))/..\"\nSPATCH=\"`which ${SPATCH:=spatch}`\"\nif [ ! -x \"$SPATCH\" ]; then\n\techo 'spatch is part of the Coccinelle project and is available at http://coccinelle.lip6.fr/'\n\texit 1\nfi\n\nSPATCH_VERSION=$($SPATCH --version | head -1 | awk '{print $3}')\n\nif ! { echo \"$SPATCH_REQ_VERSION\"; echo \"$SPATCH_VERSION\"; } | sort -CV ; then\n\techo \"spatch needs to be version $SPATCH_REQ_VERSION or higher\"\n\texit 1\nfi\n\nif [ \"$KBUILD_EXTMOD\" ]; then\n\tsrc_prefix=\nelse\n\tsrc_prefix=$srctree/\nfi\n\ngenerate_deps_for_ns() {\n\t$SPATCH --very-quiet --in-place --sp-file \\\n\t\t$srctree/scripts/coccinelle/misc/add_namespace.cocci -D nsdeps -D ns=$1 $2\n}\n\ngenerate_deps() {\n\tlocal mod=${1%.ko:}\n\tshift\n\tlocal namespaces=\"$*\"\n\tlocal mod_source_files=$(sed \"s|^\\(.*\\)\\.o$|${src_prefix}\\1.c|\" $mod.mod)\n\n\tfor ns in $namespaces; do\n\t\techo \"Adding namespace $ns to module $mod.ko.\"\n\t\tgenerate_deps_for_ns $ns \"$mod_source_files\"\n\t\t# sort the imports\n\t\tfor source_file in $mod_source_files; do\n\t\t\tsed '/MODULE_IMPORT_NS/Q' $source_file > ${source_file}.tmp\n\t\t\toffset=$(wc -l ${source_file}.tmp | awk '{print $1;}')\n\t\t\tcat $source_file | grep MODULE_IMPORT_NS | LC_ALL=C sort -u >> ${source_file}.tmp\n\t\t\ttail -n +$((offset +1)) ${source_file} | grep -v MODULE_IMPORT_NS >> ${source_file}.tmp\n\t\t\tif ! diff -q ${source_file} ${source_file}.tmp; then\n\t\t\t\tmv ${source_file}.tmp ${source_file}\n\t\t\telse\n\t\t\t\trm ${source_file}.tmp\n\t\t\tfi\n\t\tdone\n\tdone\n}\n\nwhile read line\ndo\n\tgenerate_deps $line\ndone < $MODULES_NSDEPS\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}