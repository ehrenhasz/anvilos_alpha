{
  "module_name": "Makefile.package",
  "hash_id": "cf4c5977e75c7627f5d66f76995da99a5d45b81c91d9a0462f22100828633596",
  "original_prompt": "Ingested from linux-6.6.14/scripts/Makefile.package",
  "human_readable_source": "# SPDX-License-Identifier: GPL-2.0-only\n# Makefile for the different targets used to generate full packages of a kernel\n\ninclude $(srctree)/scripts/Kbuild.include\ninclude $(srctree)/scripts/Makefile.lib\n\nKERNELPATH := kernel-$(subst -,_,$(KERNELRELEASE))\n# Include only those top-level files that are needed by make, plus the GPL copy\nTAR_CONTENT := Documentation LICENSES arch block certs crypto drivers fs \\\n               include init io_uring ipc kernel lib mm net rust \\\n               samples scripts security sound tools usr virt \\\n               .config Makefile \\\n               Kbuild Kconfig COPYING $(wildcard localversion*)\n\nquiet_cmd_src_tar = TAR     $(2).tar.gz\n      cmd_src_tar = \\\nif test \"$(objtree)\" != \"$(srctree)\"; then \\\n\techo >&2; \\\n\techo >&2 \"  ERROR:\"; \\\n\techo >&2 \"  Building source tarball is not possible outside the\"; \\\n\techo >&2 \"  kernel source tree. Don't set KBUILD_OUTPUT\"; \\\n\techo >&2; \\\n\tfalse; \\\nfi ; \\\ntar -I $(KGZIP) -c $(RCS_TAR_IGNORE) -f $(2).tar.gz \\\n\t--transform 's:^:$(2)/:S' $(TAR_CONTENT) $(3)\n\n# Git\n# ---------------------------------------------------------------------------\n\nfilechk_HEAD = git -C $(srctree) rev-parse --verify HEAD 2>/dev/null\n\n.tmp_HEAD: check-git FORCE\n\t$(call filechk,HEAD)\n\nPHONY += check-git\ncheck-git:\n\t@if ! $(srctree)/scripts/check-git; then \\\n\t\techo >&2 \"error: creating source package requires git repository\"; \\\n\t\tfalse; \\\n\tfi\n\ngit-config-tar.gz   = -c tar.tar.gz.command=\"$(KGZIP)\"\ngit-config-tar.bz2  = -c tar.tar.bz2.command=\"$(KBZIP2)\"\ngit-config-tar.lzma = -c tar.tar.lzma.command=\"$(LZMA)\"\ngit-config-tar.xz   = -c tar.tar.xz.command=\"$(XZ)\"\ngit-config-tar.zst  = -c tar.tar.zst.command=\"$(ZSTD)\"\n\nquiet_cmd_archive = ARCHIVE $@\n      cmd_archive = git -C $(srctree) $(git-config-tar$(suffix $@)) archive \\\n                    --output=$$(realpath $@) $(archive-args)\n\nsuffix-gzip  := .gz\nsuffix-bzip2 := .bz2\nsuffix-lzma  := .lzma\nsuffix-xz    := .xz\n\n# Linux source tarball\n# ---------------------------------------------------------------------------\n\nlinux-tarballs := $(addprefix linux, .tar.gz .tar.bz2 .tar.lzma .tar.xz)\n\ntargets += $(linux-tarballs)\n$(linux-tarballs): archive-args = --prefix=linux/ $$(cat $<)\n$(linux-tarballs): .tmp_HEAD FORCE\n\t$(call if_changed,archive)\n\n# rpm-pkg srcrpm-pkg binrpm-pkg\n# ---------------------------------------------------------------------------\n\nquiet_cmd_mkspec = GEN     $@\n      cmd_mkspec = $(srctree)/scripts/package/mkspec > $@\n\nkernel.spec: FORCE\n\t$(call cmd,mkspec)\n\nPHONY += rpm-sources\nrpm-sources: linux.tar.gz\n\t$(Q)mkdir -p rpmbuild/SOURCES\n\t$(Q)ln -f linux.tar.gz rpmbuild/SOURCES/linux.tar.gz\n\t$(Q)cp $(KCONFIG_CONFIG) rpmbuild/SOURCES/config\n\t$(Q)$(srctree)/scripts/package/gen-diff-patch rpmbuild/SOURCES/diff.patch\n\nPHONY += rpm-pkg srcrpm-pkg binrpm-pkg\n\nrpm-pkg:    private build-type := a\nsrcrpm-pkg: private build-type := s\nbinrpm-pkg: private build-type := b\n\nrpm-pkg srcrpm-pkg: rpm-sources\nrpm-pkg srcrpm-pkg binrpm-pkg: kernel.spec\n\t+$(strip rpmbuild -b$(build-type) kernel.spec \\\n\t--define='_topdir $(abspath rpmbuild)' \\\n\t$(if $(filter a b, $(build-type)), \\\n\t\t--target $(UTS_MACHINE)-linux --build-in-place --noprep --define='_smp_mflags %{nil}' \\\n\t\t$$(rpm -q rpm >/dev/null 2>&1 || echo --nodeps)) \\\n\t$(if $(filter b, $(build-type)), \\\n\t\t--without devel) \\\n\t$(RPMOPTS))\n\n# deb-pkg srcdeb-pkg bindeb-pkg\n# ---------------------------------------------------------------------------\n\nKDEB_SOURCE_COMPRESS ?= gzip\n\nsupported-deb-source-compress := gzip bzip2 lzma xz\n\nPHONY += linux.tar.unsupported-deb-src-compress\nlinux.tar.unsupported-deb-src-compress:\n\t@echo \"error: KDEB_SOURCE_COMPRESS=$(KDEB_SOURCE_COMPRESS) is not supported. The supported values are: $(supported-deb-source-compress)\" >&2\n\t@false\n\ndebian-orig-suffix := \\\n    $(strip $(if $(filter $(supported-deb-source-compress), $(KDEB_SOURCE_COMPRESS)), \\\n    $(suffix-$(KDEB_SOURCE_COMPRESS)),.unsupported-deb-src-compress))\n\nquiet_cmd_debianize = GEN     $@\n      cmd_debianize = $(srctree)/scripts/package/mkdebian $(mkdebian-opts)\n\ndebian: FORCE\n\t$(call cmd,debianize)\n\nPHONY += debian-orig\ndebian-orig: private source = $(shell dpkg-parsechangelog -S Source)\ndebian-orig: private version = $(shell dpkg-parsechangelog -S Version | sed 's/-[^-]*$$//')\ndebian-orig: private orig-name = $(source)_$(version).orig.tar$(debian-orig-suffix)\ndebian-orig: mkdebian-opts = --need-source\ndebian-orig: linux.tar$(debian-orig-suffix) debian\n\t$(Q)if [ \"$(df  --output=target .. 2>/dev/null)\" = \"$(df --output=target $< 2>/dev/null)\" ]; then \\\n\t\tln -f $< ../$(orig-name); \\\n\telse \\\n\t\tcp $< ../$(orig-name); \\\n\tfi\n\nKBUILD_PKG_ROOTCMD ?= 'fakeroot -u'\n\nPHONY += deb-pkg srcdeb-pkg bindeb-pkg\n\ndeb-pkg:    private build-type := source,binary\nsrcdeb-pkg: private build-type := source\nbindeb-pkg: private build-type := binary\n\ndeb-pkg srcdeb-pkg: debian-orig\nbindeb-pkg: debian\ndeb-pkg srcdeb-pkg bindeb-pkg:\n\t+$(strip dpkg-buildpackage \\\n\t--build=$(build-type) --no-pre-clean --unsigned-changes \\\n\t$(if $(findstring source, $(build-type)), \\\n\t\t--unsigned-source --compression=$(KDEB_SOURCE_COMPRESS)) \\\n\t$(if $(findstring binary, $(build-type)), \\\n\t\t--rules-file='$(MAKE) -f debian/rules' --jobs=1 -r$(KBUILD_PKG_ROOTCMD) -a$$(cat debian/arch), \\\n\t\t--no-check-builddeps) \\\n\t$(DPKG_FLAGS))\n\n# snap-pkg\n# ---------------------------------------------------------------------------\nPHONY += snap-pkg\nsnap-pkg:\n\trm -rf $(objtree)/snap\n\tmkdir $(objtree)/snap\n\t$(MAKE) clean\n\t$(call cmd,src_tar,$(KERNELPATH))\n\tsed \"s@KERNELRELEASE@$(KERNELRELEASE)@; \\\n\t\ts@SRCTREE@$(shell realpath $(KERNELPATH).tar.gz)@\" \\\n\t\t$(srctree)/scripts/package/snapcraft.template > \\\n\t\t$(objtree)/snap/snapcraft.yaml\n\tcd $(objtree)/snap && \\\n\tsnapcraft --target-arch=$(UTS_MACHINE)\n\n# dir-pkg tar*-pkg - tarball targets\n# ---------------------------------------------------------------------------\n\ntar-install: FORCE\n\t$(Q)$(MAKE) -f $(srctree)/Makefile\n\t+$(Q)$(srctree)/scripts/package/buildtar $@\n\ncompress-tar.gz  = -I \"$(KGZIP)\"\ncompress-tar.bz2 = -I \"$(KBZIP2)\"\ncompress-tar.xz  = -I \"$(XZ)\"\ncompress-tar.zst = -I \"$(ZSTD)\"\n\nquiet_cmd_tar = TAR     $@\n      cmd_tar = cd $<; tar cf ../$@ $(compress-tar$(suffix $@)) --owner=root --group=root --sort=name *\n\ndir-tarballs := $(addprefix linux-$(KERNELRELEASE)-$(ARCH), .tar .tar.gz .tar.bz2 .tar.xz .tar.zst)\n\n$(dir-tarballs): tar-install\n\t$(call cmd,tar)\n\nPHONY += dir-pkg\ndir-pkg: tar-install\n\t@echo \"Kernel tree successfully created in $<\"\n\nPHONY += tar-pkg\ntar-pkg: linux-$(KERNELRELEASE)-$(ARCH).tar\n\t@:\n\ntar%-pkg: linux-$(KERNELRELEASE)-$(ARCH).tar.% FORCE\n\t@:\n\n# perf-tar*-src-pkg - generate a source tarball with perf source\n# ---------------------------------------------------------------------------\n\n.tmp_perf:\n\t$(Q)mkdir .tmp_perf\n\n.tmp_perf/HEAD: .tmp_HEAD | .tmp_perf\n\t$(call cmd,copy)\n\nquiet_cmd_perf_version_file = GEN     $@\n      cmd_perf_version_file = cd $(srctree)/tools/perf; util/PERF-VERSION-GEN $(dir $(abspath $@))\n\n# PERF-VERSION-FILE and .tmp_HEAD are independent, but this avoids updating the\n# timestamp of PERF-VERSION-FILE.\n# The best is to fix tools/perf/util/PERF-VERSION-GEN.\n.tmp_perf/PERF-VERSION-FILE: .tmp_HEAD $(srctree)/tools/perf/util/PERF-VERSION-GEN | .tmp_perf\n\t$(call cmd,perf_version_file)\n\nperf-archive-args = --add-file=$$(realpath $(word 2, $^)) \\\n\t--add-file=$$(realpath $(word 3, $^)) \\\n\t$$(cat $(word 2, $^))^{tree} $$(cat $<)\n\n\nperf-tarballs := $(addprefix perf-$(KERNELVERSION), .tar .tar.gz .tar.bz2 .tar.xz .tar.zst)\n\ntargets += $(perf-tarballs)\n$(perf-tarballs): archive-args = --prefix=perf-$(KERNELVERSION)/ $(perf-archive-args)\n$(perf-tarballs): tools/perf/MANIFEST .tmp_perf/HEAD .tmp_perf/PERF-VERSION-FILE FORCE\n\t$(call if_changed,archive)\n\nPHONY += perf-tar-src-pkg\nperf-tar-src-pkg: perf-$(KERNELVERSION).tar\n\t@:\n\nperf-tar%-src-pkg: perf-$(KERNELVERSION).tar.% FORCE\n\t@:\n\n# Help text displayed when executing 'make help'\n# ---------------------------------------------------------------------------\nPHONY += help\nhelp:\n\t@echo '  rpm-pkg             - Build both source and binary RPM kernel packages'\n\t@echo '  srcrpm-pkg          - Build only the source kernel RPM package'\n\t@echo '  binrpm-pkg          - Build only the binary kernel RPM package'\n\t@echo '  deb-pkg             - Build both source and binary deb kernel packages'\n\t@echo '  srcdeb-pkg          - Build only the source kernel deb package'\n\t@echo '  bindeb-pkg          - Build only the binary kernel deb package'\n\t@echo '  snap-pkg            - Build only the binary kernel snap package'\n\t@echo '                        (will connect to external hosts)'\n\t@echo '  dir-pkg             - Build the kernel as a plain directory structure'\n\t@echo '  tar-pkg             - Build the kernel as an uncompressed tarball'\n\t@echo '  targz-pkg           - Build the kernel as a gzip compressed tarball'\n\t@echo '  tarbz2-pkg          - Build the kernel as a bzip2 compressed tarball'\n\t@echo '  tarxz-pkg           - Build the kernel as a xz compressed tarball'\n\t@echo '  tarzst-pkg          - Build the kernel as a zstd compressed tarball'\n\t@echo '  perf-tar-src-pkg    - Build the perf source tarball with no compression'\n\t@echo '  perf-targz-src-pkg  - Build the perf source tarball with gzip compression'\n\t@echo '  perf-tarbz2-src-pkg - Build the perf source tarball with bz2 compression'\n\t@echo '  perf-tarxz-src-pkg  - Build the perf source tarball with xz compression'\n\t@echo '  perf-tarzst-src-pkg - Build the perf source tarball with zst compression'\n\nPHONY += FORCE\nFORCE:\n\n# Read all saved command lines and dependencies for the $(targets) we\n# may be building above, using $(if_changed{,_dep}). As an\n# optimization, we don't need to read them if the target does not\n# exist, we will rebuild anyway in that case.\n\nexisting-targets := $(wildcard $(sort $(targets)))\n\n-include $(foreach f,$(existing-targets),$(dir $(f)).$(notdir $(f)).cmd)\n\n.PHONY: $(PHONY)\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}