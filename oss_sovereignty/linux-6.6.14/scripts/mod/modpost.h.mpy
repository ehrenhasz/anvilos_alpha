{
  "module_name": "modpost.h",
  "hash_id": "ae25ff8bd5100049488eba3b803094468659652383a63a9f705b6bba8f208740",
  "original_prompt": "Ingested from linux-6.6.14/scripts/mod/modpost.h",
  "human_readable_source": " \n#include <stdbool.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <string.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/mman.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <elf.h>\n\n#include \"list.h\"\n#include \"elfconfig.h\"\n\n \n#undef ELF_ST_BIND\n#undef ELF_ST_TYPE\n#undef ELF_R_SYM\n#undef ELF_R_TYPE\n\n#if KERNEL_ELFCLASS == ELFCLASS32\n\n#define Elf_Ehdr    Elf32_Ehdr\n#define Elf_Shdr    Elf32_Shdr\n#define Elf_Sym     Elf32_Sym\n#define Elf_Addr    Elf32_Addr\n#define Elf_Section Elf32_Half\n#define ELF_ST_BIND ELF32_ST_BIND\n#define ELF_ST_TYPE ELF32_ST_TYPE\n\n#define Elf_Rel     Elf32_Rel\n#define Elf_Rela    Elf32_Rela\n#define ELF_R_SYM   ELF32_R_SYM\n#define ELF_R_TYPE  ELF32_R_TYPE\n#else\n\n#define Elf_Ehdr    Elf64_Ehdr\n#define Elf_Shdr    Elf64_Shdr\n#define Elf_Sym     Elf64_Sym\n#define Elf_Addr    Elf64_Addr\n#define Elf_Section Elf64_Half\n#define ELF_ST_BIND ELF64_ST_BIND\n#define ELF_ST_TYPE ELF64_ST_TYPE\n\n#define Elf_Rel     Elf64_Rel\n#define Elf_Rela    Elf64_Rela\n#define ELF_R_SYM   ELF64_R_SYM\n#define ELF_R_TYPE  ELF64_R_TYPE\n#endif\n\n#if KERNEL_ELFDATA != HOST_ELFDATA\n\nstatic inline void __endian(const void *src, void *dest, unsigned int size)\n{\n\tunsigned int i;\n\tfor (i = 0; i < size; i++)\n\t\t((unsigned char*)dest)[i] = ((unsigned char*)src)[size - i-1];\n}\n\n#define TO_NATIVE(x)\t\t\t\t\t\t\\\n({\t\t\t\t\t\t\t\t\\\n\ttypeof(x) __x;\t\t\t\t\t\t\\\n\t__endian(&(x), &(__x), sizeof(__x));\t\t\t\\\n\t__x;\t\t\t\t\t\t\t\\\n})\n\n#else  \n\n#define TO_NATIVE(x) (x)\n\n#endif\n\n#define NOFAIL(ptr)   do_nofail((ptr), #ptr)\n\n#define ARRAY_SIZE(arr) (sizeof(arr) / sizeof((arr)[0]))\n\nvoid *do_nofail(void *ptr, const char *expr);\n\nstruct buffer {\n\tchar *p;\n\tint pos;\n\tint size;\n};\n\nvoid __attribute__((format(printf, 2, 3)))\nbuf_printf(struct buffer *buf, const char *fmt, ...);\n\nvoid\nbuf_write(struct buffer *buf, const char *s, int len);\n\nstruct module {\n\tstruct list_head list;\n\tstruct list_head exported_symbols;\n\tstruct list_head unresolved_symbols;\n\tbool is_gpl_compatible;\n\tbool from_dump;\t\t \n\tbool is_vmlinux;\n\tbool seen;\n\tbool has_init;\n\tbool has_cleanup;\n\tstruct buffer dev_table_buf;\n\tchar\t     srcversion[25];\n\t\n\tstruct list_head missing_namespaces;\n\t\n\tstruct list_head imported_namespaces;\n\tchar name[];\n};\n\nstruct elf_info {\n\tsize_t size;\n\tElf_Ehdr     *hdr;\n\tElf_Shdr     *sechdrs;\n\tElf_Sym      *symtab_start;\n\tElf_Sym      *symtab_stop;\n\tunsigned int export_symbol_secndx;\t \n\tchar         *strtab;\n\tchar\t     *modinfo;\n\tunsigned int modinfo_len;\n\n\t \n\n\tunsigned int num_sections;  \n\tunsigned int secindex_strings;\n\t \n\tElf32_Word   *symtab_shndx_start;\n\tElf32_Word   *symtab_shndx_stop;\n};\n\n \nstatic inline unsigned int get_secindex(const struct elf_info *info,\n\t\t\t\t\tconst Elf_Sym *sym)\n{\n\tunsigned int index = sym->st_shndx;\n\n\t \n\tif (index == SHN_XINDEX)\n\t\treturn info->symtab_shndx_start[sym - info->symtab_start];\n\n\t \n\tif (index >= SHN_LORESERVE && index <= SHN_HIRESERVE)\n\t\treturn index - SHN_HIRESERVE - 1;\n\n\treturn index;\n}\n\n \nvoid handle_moddevtable(struct module *mod, struct elf_info *info,\n\t\t\tElf_Sym *sym, const char *symname);\nvoid add_moddevtable(struct buffer *buf, struct module *mod);\n\n \nvoid get_src_version(const char *modname, char sum[], unsigned sumlen);\n\n \nchar *read_text_file(const char *filename);\nchar *get_line(char **stringp);\nvoid *sym_get_data(const struct elf_info *info, const Elf_Sym *sym);\n\nenum loglevel {\n\tLOG_WARN,\n\tLOG_ERROR,\n\tLOG_FATAL\n};\n\nvoid modpost_log(enum loglevel loglevel, const char *fmt, ...);\n\n \n#define warn(fmt, args...)\tmodpost_log(LOG_WARN, fmt, ##args)\n#define error(fmt, args...)\tmodpost_log(LOG_ERROR, fmt, ##args)\n#define fatal(fmt, args...)\tmodpost_log(LOG_FATAL, fmt, ##args)\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}