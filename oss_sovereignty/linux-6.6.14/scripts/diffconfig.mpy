{
  "module_name": "diffconfig",
  "hash_id": "47211de36b2daeeae5b48220951a91a024e6f0d391e046fbdb36c508372285bb",
  "original_prompt": "Ingested from linux-6.6.14/scripts/diffconfig",
  "human_readable_source": "#!/usr/bin/env python3\n# SPDX-License-Identifier: GPL-2.0\n#\n# diffconfig - a tool to compare .config files.\n#\n# originally written in 2006 by Matt Mackall\n#  (at least, this was in his bloatwatch source code)\n# last worked on 2008 by Tim Bird\n#\n\nimport sys, os\n\ndef usage():\n    print(\"\"\"Usage: diffconfig [-h] [-m] [<config1> <config2>]\n\nDiffconfig is a simple utility for comparing two .config files.\nUsing standard diff to compare .config files often includes extraneous and\ndistracting information.  This utility produces sorted output with only the\nchanges in configuration values between the two files.\n\nAdded and removed items are shown with a leading plus or minus, respectively.\nChanged items show the old and new values on a single line.\n\nIf -m is specified, then output will be in \"merge\" style, which has the\nchanged and new values in kernel config option format.\n\nIf no config files are specified, .config and .config.old are used.\n\nExample usage:\n $ diffconfig .config config-with-some-changes\n-EXT2_FS_XATTR  n\n CRAMFS  n -> y\n EXT2_FS  y -> n\n LOG_BUF_SHIFT  14 -> 16\n PRINTK_TIME  n -> y\n\"\"\")\n    sys.exit(0)\n\n# returns a dictionary of name/value pairs for config items in the file\ndef readconfig(config_file):\n    d = {}\n    for line in config_file:\n        line = line[:-1]\n        if line[:7] == \"CONFIG_\":\n            name, val = line[7:].split(\"=\", 1)\n            d[name] = val\n        if line[-11:] == \" is not set\":\n            d[line[9:-11]] = \"n\"\n    return d\n\ndef print_config(op, config, value, new_value):\n    global merge_style\n\n    if merge_style:\n        if new_value:\n            if new_value==\"n\":\n                print(\"# CONFIG_%s is not set\" % config)\n            else:\n                print(\"CONFIG_%s=%s\" % (config, new_value))\n    else:\n        if op==\"-\":\n            print(\"-%s %s\" % (config, value))\n        elif op==\"+\":\n            print(\"+%s %s\" % (config, new_value))\n        else:\n            print(\" %s %s -> %s\" % (config, value, new_value))\n\ndef show_diff():\n    global merge_style\n\n    # parse command line args\n    if (\"-h\" in sys.argv or \"--help\" in sys.argv):\n        usage()\n\n    merge_style = 0\n    if \"-m\" in sys.argv:\n        merge_style = 1\n        sys.argv.remove(\"-m\")\n\n    argc = len(sys.argv)\n    if not (argc==1 or argc == 3):\n        print(\"Error: incorrect number of arguments or unrecognized option\")\n        usage()\n\n    if argc == 1:\n        # if no filenames given, assume .config and .config.old\n        build_dir=\"\"\n        if \"KBUILD_OUTPUT\" in os.environ:\n            build_dir = os.environ[\"KBUILD_OUTPUT\"]+\"/\"\n        configa_filename = build_dir + \".config.old\"\n        configb_filename = build_dir + \".config\"\n    else:\n        configa_filename = sys.argv[1]\n        configb_filename = sys.argv[2]\n\n    try:\n        a = readconfig(open(configa_filename))\n        b = readconfig(open(configb_filename))\n    except (IOError):\n        e = sys.exc_info()[1]\n        print(\"I/O error[%s]: %s\\n\" % (e.args[0],e.args[1]))\n        usage()\n\n    # print items in a but not b (accumulate, sort and print)\n    old = []\n    for config in a:\n        if config not in b:\n            old.append(config)\n    old.sort()\n    for config in old:\n        print_config(\"-\", config, a[config], None)\n        del a[config]\n\n    # print items that changed (accumulate, sort, and print)\n    changed = []\n    for config in a:\n        if a[config] != b[config]:\n            changed.append(config)\n        else:\n            del b[config]\n    changed.sort()\n    for config in changed:\n        print_config(\"->\", config, a[config], b[config])\n        del b[config]\n\n    # now print items in b but not in a\n    # (items from b that were in a were removed above)\n    new = sorted(b.keys())\n    for config in new:\n        print_config(\"+\", config, None, b[config])\n\ndef main():\n    try:\n        show_diff()\n    except BrokenPipeError:\n        # Python flushes standard streams on exit; redirect remaining output\n        # to devnull to avoid another BrokenPipeError at shutdown\n        devnull = os.open(os.devnull, os.O_WRONLY)\n        os.dup2(devnull, sys.stdout.fileno())\n        sys.exit(1)  # Python exits with error code 1 on EPIPE\n\n\nif __name__ == '__main__':\n    main()\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}