{
  "module_name": "headers_install.sh",
  "hash_id": "6d99c943d024413941de30d95b3e6a78d442e329de5ccb67fdbebfd64a69d10d",
  "original_prompt": "Ingested from linux-6.6.14/scripts/headers_install.sh",
  "human_readable_source": "#!/bin/sh\n# SPDX-License-Identifier: GPL-2.0\n\nif [ $# -ne 2 ]\nthen\n\techo \"Usage: headers_install.sh INFILE OUTFILE\"\n\techo\n\techo \"Prepares kernel header files for use by user space, by removing\"\n\techo \"all compiler.h definitions and #includes, removing any\"\n\techo \"#ifdef __KERNEL__ sections, and putting __underscores__ around\"\n\techo \"asm/inline/volatile keywords.\"\n\techo\n\techo \"INFILE: header file to operate on\"\n\techo \"OUTFILE: output file which the processed header is written to\"\n\n\texit 1\nfi\n\n# Grab arguments\nINFILE=$1\nOUTFILE=$2\nTMPFILE=$OUTFILE.tmp\n\ntrap 'rm -f $OUTFILE $TMPFILE' EXIT\n\n# SPDX-License-Identifier with GPL variants must have \"WITH Linux-syscall-note\"\nif [ -n \"$(sed -n -e \"/SPDX-License-Identifier:.*GPL-/{/WITH Linux-syscall-note/!p}\" $INFILE)\" ]; then\n\techo \"error: $INFILE: missing \\\"WITH Linux-syscall-note\\\" for SPDX-License-Identifier\" >&2\n\texit 1\nfi\n\nsed -E -e '\n\ts/([[:space:](])(__user|__force|__iomem)[[:space:]]/\\1/g\n\ts/__attribute_const__([[:space:]]|$)/\\1/g\n\ts@^#include <linux/compiler(|_types).h>@@\n\ts/(^|[^a-zA-Z0-9])__packed([^a-zA-Z0-9_]|$)/\\1__attribute__((packed))\\2/g\n\ts/(^|[[:space:](])(inline|asm|volatile)([[:space:](]|$)/\\1__\\2__\\3/g\n\ts@#(ifndef|define|endif[[:space:]]*/[*])[[:space:]]*_UAPI@#\\1 @\n' $INFILE > $TMPFILE || exit 1\n\nscripts/unifdef -U__KERNEL__ -D__EXPORTED_HEADERS__ $TMPFILE > $OUTFILE\n[ $? -gt 1 ] && exit 1\n\n# Remove /* ... */ style comments, and find CONFIG_ references in code\nconfigs=$(sed -e '\n:comment\n\ts:/\\*[^*][^*]*:/*:\n\ts:/\\*\\*\\**\\([^/]\\):/*\\1:\n\tt comment\n\ts:/\\*\\*/: :\n\tt comment\n\t/\\/\\*/! b check\n\tN\n\tb comment\n:print\n\tP\n\tD\n:check\n\ts:^\\(CONFIG_[[:alnum:]_]*\\):\\1\\n:\n\tt print\n\ts:^[[:alnum:]_][[:alnum:]_]*::\n\ts:^[^[:alnum:]_][^[:alnum:]_]*::\n\tt check\n\td\n' $OUTFILE)\n\n# The entries in the following list do not result in an error.\n# Please do not add a new entry. This list is only for existing ones.\n# The list will be reduced gradually, and deleted eventually. (hopefully)\n#\n# The format is <file-name>:<CONFIG-option> in each line.\nconfig_leak_ignores=\"\narch/arc/include/uapi/asm/page.h:CONFIG_ARC_PAGE_SIZE_16K\narch/arc/include/uapi/asm/page.h:CONFIG_ARC_PAGE_SIZE_4K\narch/arc/include/uapi/asm/swab.h:CONFIG_ARC_HAS_SWAPE\narch/arm/include/uapi/asm/ptrace.h:CONFIG_CPU_ENDIAN_BE8\narch/hexagon/include/uapi/asm/ptrace.h:CONFIG_HEXAGON_ARCH_VERSION\narch/hexagon/include/uapi/asm/user.h:CONFIG_HEXAGON_ARCH_VERSION\narch/m68k/include/uapi/asm/ptrace.h:CONFIG_COLDFIRE\narch/nios2/include/uapi/asm/swab.h:CONFIG_NIOS2_CI_SWAB_NO\narch/nios2/include/uapi/asm/swab.h:CONFIG_NIOS2_CI_SWAB_SUPPORT\narch/x86/include/uapi/asm/auxvec.h:CONFIG_IA32_EMULATION\narch/x86/include/uapi/asm/auxvec.h:CONFIG_X86_64\n\"\n\nfor c in $configs\ndo\n\tleak_error=1\n\n\tfor ignore in $config_leak_ignores\n\tdo\n\t\tif echo \"$INFILE:$c\" | grep -q \"$ignore$\"; then\n\t\t\tleak_error=\n\t\t\tbreak\n\t\tfi\n\tdone\n\n\tif [ \"$leak_error\" = 1 ]; then\n\t\techo \"error: $INFILE: leak $c to user-space\" >&2\n\t\texit 1\n\tfi\ndone\n\nrm -f $TMPFILE\ntrap - EXIT\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}