{
  "module_name": "bootgraph.pl",
  "hash_id": "da9f98931f4f4302e492809a7b3ee3bc8df237e57ff8afb7c59c285738f3d029",
  "original_prompt": "Ingested from linux-6.6.14/scripts/bootgraph.pl",
  "human_readable_source": "#!/usr/bin/env perl\n# SPDX-License-Identifier: GPL-2.0-only\n\n# Copyright 2008, Intel Corporation\n#\n# This file is part of the Linux kernel\n#\n# Authors:\n# \tArjan van de Ven <arjan@linux.intel.com>\n\n\n#\n# This script turns a dmesg output into a SVG graphic that shows which\n# functions take how much time. You can view SVG graphics with various\n# programs, including Inkscape, The Gimp and Firefox.\n#\n#\n# For this script to work, the kernel needs to be compiled with the\n# CONFIG_PRINTK_TIME configuration option enabled, and with\n# \"initcall_debug\" passed on the kernel command line.\n#\n# usage:\n# \tdmesg | perl scripts/bootgraph.pl > output.svg\n#\n\nuse strict;\nuse Getopt::Long;\nmy $header = 0;\n\nsub help {\n\tmy $text = << \"EOM\";\nUsage:\n1) dmesg | perl scripts/bootgraph.pl [OPTION] > output.svg\n2) perl scripts/bootgraph.pl -h\n\nOptions:\n\t-header\tInsert kernel version and date\nEOM\n\tmy $std=shift;\n\tif ($std == 1) {\n\t\tprint STDERR $text;\n\t} else {\n\t\tprint $text;\n\t}\n\texit;\n}\n\nGetOptions(\n\t'h|help'\t=>\\&help,\n\t'header'\t=>\\$header\n);\n\nmy %start;\nmy %end;\nmy %type;\nmy $done = 0;\nmy $maxtime = 0;\nmy $firsttime = 99999;\nmy $count = 0;\nmy %pids;\nmy %pidctr;\n\nmy $headerstep = 20;\nmy $xheader = 15;\nmy $yheader = 25;\nmy $cyheader = 0;\n\nwhile (<>) {\n\tmy $line = $_;\n\tif ($line =~ /([0-9\\.]+)\\] calling  ([a-zA-Z0-9\\_\\.]+)\\+/) {\n\t\tmy $func = $2;\n\t\tif ($done == 0) {\n\t\t\t$start{$func} = $1;\n\t\t\t$type{$func} = 0;\n\t\t\tif ($1 < $firsttime) {\n\t\t\t\t$firsttime = $1;\n\t\t\t}\n\t\t}\n\t\tif ($line =~ /\\@ ([0-9]+)/) {\n\t\t\t$pids{$func} = $1;\n\t\t}\n\t\t$count = $count + 1;\n\t}\n\n\tif ($line =~ /([0-9\\.]+)\\] async_waiting @ ([0-9]+)/) {\n\t\tmy $pid = $2;\n\t\tmy $func;\n\t\tif (!defined($pidctr{$pid})) {\n\t\t\t$func = \"wait_\" . $pid . \"_1\";\n\t\t\t$pidctr{$pid} = 1;\n\t\t} else {\n\t\t\t$pidctr{$pid} = $pidctr{$pid} + 1;\n\t\t\t$func = \"wait_\" . $pid . \"_\" . $pidctr{$pid};\n\t\t}\n\t\tif ($done == 0) {\n\t\t\t$start{$func} = $1;\n\t\t\t$type{$func} = 1;\n\t\t\tif ($1 < $firsttime) {\n\t\t\t\t$firsttime = $1;\n\t\t\t}\n\t\t}\n\t\t$pids{$func} = $pid;\n\t\t$count = $count + 1;\n\t}\n\n\tif ($line =~ /([0-9\\.]+)\\] initcall ([a-zA-Z0-9\\_\\.]+)\\+.*returned/) {\n\t\tif ($done == 0) {\n\t\t\t$end{$2} = $1;\n\t\t\t$maxtime = $1;\n\t\t}\n\t}\n\n\tif ($line =~ /([0-9\\.]+)\\] async_continuing @ ([0-9]+)/) {\n\t\tmy $pid = $2;\n\t\tmy $func =  \"wait_\" . $pid . \"_\" . $pidctr{$pid};\n\t\t$end{$func} = $1;\n\t\t$maxtime = $1;\n\t}\n\tif ($line =~ /Write protecting the/) {\n\t\t$done = 1;\n\t}\n\tif ($line =~ /Freeing unused kernel memory/) {\n\t\t$done = 1;\n\t}\n}\n\nif ($count == 0) {\n    print STDERR <<END;\nNo data found in the dmesg. Make sure that 'printk.time=1' and\n'initcall_debug' are passed on the kernel command line.\nEND\n\thelp(1);\n    exit 1;\n}\n\nprint \"<?xml version=\\\"1.0\\\" standalone=\\\"no\\\"?> \\n\";\nprint \"<svg width=\\\"2000\\\" height=\\\"100%\\\" version=\\\"1.1\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\\n\";\n\n\nif ($header) {\n\tmy $version = `uname -a`;\n\tmy $date = `date`;\n\tprint \"<text transform=\\\"translate($xheader,$yheader)\\\">Kernel version: $version</text>\\n\";\n\t$cyheader = $yheader+$headerstep;\n\tprint \"<text transform=\\\"translate($xheader,$cyheader)\\\">Date: $date</text>\\n\";\n}\n\nmy @styles;\n\n$styles[0] = \"fill:rgb(0,0,255);fill-opacity:0.5;stroke-width:1;stroke:rgb(0,0,0)\";\n$styles[1] = \"fill:rgb(0,255,0);fill-opacity:0.5;stroke-width:1;stroke:rgb(0,0,0)\";\n$styles[2] = \"fill:rgb(255,0,20);fill-opacity:0.5;stroke-width:1;stroke:rgb(0,0,0)\";\n$styles[3] = \"fill:rgb(255,255,20);fill-opacity:0.5;stroke-width:1;stroke:rgb(0,0,0)\";\n$styles[4] = \"fill:rgb(255,0,255);fill-opacity:0.5;stroke-width:1;stroke:rgb(0,0,0)\";\n$styles[5] = \"fill:rgb(0,255,255);fill-opacity:0.5;stroke-width:1;stroke:rgb(0,0,0)\";\n$styles[6] = \"fill:rgb(0,128,255);fill-opacity:0.5;stroke-width:1;stroke:rgb(0,0,0)\";\n$styles[7] = \"fill:rgb(0,255,128);fill-opacity:0.5;stroke-width:1;stroke:rgb(0,0,0)\";\n$styles[8] = \"fill:rgb(255,0,128);fill-opacity:0.5;stroke-width:1;stroke:rgb(0,0,0)\";\n$styles[9] = \"fill:rgb(255,255,128);fill-opacity:0.5;stroke-width:1;stroke:rgb(0,0,0)\";\n$styles[10] = \"fill:rgb(255,128,255);fill-opacity:0.5;stroke-width:1;stroke:rgb(0,0,0)\";\n$styles[11] = \"fill:rgb(128,255,255);fill-opacity:0.5;stroke-width:1;stroke:rgb(0,0,0)\";\n\nmy $style_wait = \"fill:rgb(128,128,128);fill-opacity:0.5;stroke-width:0;stroke:rgb(0,0,0)\";\n\nmy $mult = 1950.0 / ($maxtime - $firsttime);\nmy $threshold2 = ($maxtime - $firsttime) / 120.0;\nmy $threshold = $threshold2/10;\nmy $stylecounter = 0;\nmy %rows;\nmy $rowscount = 1;\nmy @initcalls = sort { $start{$a} <=> $start{$b} } keys(%start);\n\nforeach my $key (@initcalls) {\n\tmy $duration = $end{$key} - $start{$key};\n\n\tif ($duration >= $threshold) {\n\t\tmy ($s, $s2, $s3, $e, $w, $y, $y2, $style);\n\t\tmy $pid = $pids{$key};\n\n\t\tif (!defined($rows{$pid})) {\n\t\t\t$rows{$pid} = $rowscount;\n\t\t\t$rowscount = $rowscount + 1;\n\t\t}\n\t\t$s = ($start{$key} - $firsttime) * $mult;\n\t\t$s2 = $s + 6;\n\t\t$s3 = $s + 1;\n\t\t$e = ($end{$key} - $firsttime) * $mult;\n\t\t$w = $e - $s;\n\n\t\t$y = $rows{$pid} * 150;\n\t\t$y2 = $y + 4;\n\n\t\t$style = $styles[$stylecounter];\n\t\t$stylecounter = $stylecounter + 1;\n\t\tif ($stylecounter > 11) {\n\t\t\t$stylecounter = 0;\n\t\t};\n\n\t\tif ($type{$key} == 1) {\n\t\t\t$y = $y + 15;\n\t\t\tprint \"<rect x=\\\"$s\\\" width=\\\"$w\\\" y=\\\"$y\\\" height=\\\"115\\\" style=\\\"$style_wait\\\"/>\\n\";\n\t\t} else {\n\t\t\tprint \"<rect x=\\\"$s\\\" width=\\\"$w\\\" y=\\\"$y\\\" height=\\\"145\\\" style=\\\"$style\\\"/>\\n\";\n\t\t\tif ($duration >= $threshold2) {\n\t\t\t\tprint \"<text transform=\\\"translate($s2,$y2) rotate(90)\\\">$key</text>\\n\";\n\t\t\t} else {\n\t\t\t\tprint \"<text transform=\\\"translate($s3,$y2) rotate(90)\\\" font-size=\\\"3pt\\\">$key</text>\\n\";\n\t\t\t}\n\t\t}\n\t}\n}\n\n\n# print the time line on top\nmy $time = $firsttime;\nmy $step = ($maxtime - $firsttime) / 15;\nwhile ($time < $maxtime) {\n\tmy $s3 = ($time - $firsttime) * $mult;\n\tmy $tm = int($time * 100) / 100.0;\n\tprint \"<text transform=\\\"translate($s3,89) rotate(90)\\\">$tm</text>\\n\";\n\t$time = $time + $step;\n}\n\nprint \"</svg>\\n\";\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}