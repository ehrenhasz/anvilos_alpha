{
  "module_name": "sancov_plugin.c",
  "hash_id": "516e4cf7f1dece054a6c86ddccea66480d6c866858137f4726d402998dd27f6f",
  "original_prompt": "Ingested from linux-6.6.14/scripts/gcc-plugins/sancov_plugin.c",
  "human_readable_source": " \n\n#include \"gcc-common.h\"\n\n__visible int plugin_is_GPL_compatible;\n\ntree sancov_fndecl;\n\nstatic struct plugin_info sancov_plugin_info = {\n\t.version\t= PLUGIN_VERSION,\n\t.help\t\t= \"sancov plugin\\n\",\n};\n\nstatic unsigned int sancov_execute(void)\n{\n\tbasic_block bb;\n\n\t \n\n\tFOR_EACH_BB_FN(bb, cfun) {\n\t\tconst_gimple stmt;\n\t\tgcall *gcall;\n\t\tgimple_stmt_iterator gsi = gsi_after_labels(bb);\n\n\t\tif (gsi_end_p(gsi))\n\t\t\tcontinue;\n\n\t\tstmt = gsi_stmt(gsi);\n\t\tgcall = as_a_gcall(gimple_build_call(sancov_fndecl, 0));\n\t\tgimple_set_location(gcall, gimple_location(stmt));\n\t\tgsi_insert_before(&gsi, gcall, GSI_SAME_STMT);\n\t}\n\treturn 0;\n}\n\n#define PASS_NAME sancov\n\n#define NO_GATE\n#define TODO_FLAGS_FINISH TODO_dump_func | TODO_verify_stmts | TODO_update_ssa_no_phi | TODO_verify_flow\n\n#include \"gcc-generate-gimple-pass.h\"\n\nstatic void sancov_start_unit(void __unused *gcc_data, void __unused *user_data)\n{\n\ttree leaf_attr, nothrow_attr;\n\ttree BT_FN_VOID = build_function_type_list(void_type_node, NULL_TREE);\n\n\tsancov_fndecl = build_fn_decl(\"__sanitizer_cov_trace_pc\", BT_FN_VOID);\n\n\tDECL_ASSEMBLER_NAME(sancov_fndecl);\n\tTREE_PUBLIC(sancov_fndecl) = 1;\n\tDECL_EXTERNAL(sancov_fndecl) = 1;\n\tDECL_ARTIFICIAL(sancov_fndecl) = 1;\n\tDECL_PRESERVE_P(sancov_fndecl) = 1;\n\tDECL_UNINLINABLE(sancov_fndecl) = 1;\n\tTREE_USED(sancov_fndecl) = 1;\n\n\tnothrow_attr = tree_cons(get_identifier(\"nothrow\"), NULL, NULL);\n\tdecl_attributes(&sancov_fndecl, nothrow_attr, 0);\n\tgcc_assert(TREE_NOTHROW(sancov_fndecl));\n\tleaf_attr = tree_cons(get_identifier(\"leaf\"), NULL, NULL);\n\tdecl_attributes(&sancov_fndecl, leaf_attr, 0);\n}\n\n__visible int plugin_init(struct plugin_name_args *plugin_info, struct plugin_gcc_version *version)\n{\n\tint i;\n\tconst char * const plugin_name = plugin_info->base_name;\n\tconst int argc = plugin_info->argc;\n\tconst struct plugin_argument * const argv = plugin_info->argv;\n\tbool enable = true;\n\n\tstatic const struct ggc_root_tab gt_ggc_r_gt_sancov[] = {\n\t\t{\n\t\t\t.base = &sancov_fndecl,\n\t\t\t.nelt = 1,\n\t\t\t.stride = sizeof(sancov_fndecl),\n\t\t\t.cb = &gt_ggc_mx_tree_node,\n\t\t\t.pchw = &gt_pch_nx_tree_node\n\t\t},\n\t\tLAST_GGC_ROOT_TAB\n\t};\n\n\t \n\tPASS_INFO(sancov, \"asan\", 0, PASS_POS_INSERT_BEFORE);\n\n\tif (!plugin_default_version_check(version, &gcc_version)) {\n\t\terror(G_(\"incompatible gcc/plugin versions\"));\n\t\treturn 1;\n\t}\n\n\tfor (i = 0; i < argc; ++i) {\n\t\tif (!strcmp(argv[i].key, \"no-sancov\")) {\n\t\t\tenable = false;\n\t\t\tcontinue;\n\t\t}\n\t\terror(G_(\"unknown option '-fplugin-arg-%s-%s'\"), plugin_name, argv[i].key);\n\t}\n\n\tregister_callback(plugin_name, PLUGIN_INFO, NULL, &sancov_plugin_info);\n\n\tif (!enable)\n\t\treturn 0;\n\n#if BUILDING_GCC_VERSION < 6000\n\tregister_callback(plugin_name, PLUGIN_START_UNIT, &sancov_start_unit, NULL);\n\tregister_callback(plugin_name, PLUGIN_REGISTER_GGC_ROOTS, NULL, (void *)&gt_ggc_r_gt_sancov);\n\tregister_callback(plugin_name, PLUGIN_PASS_MANAGER_SETUP, NULL, &sancov_pass_info);\n#endif\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}