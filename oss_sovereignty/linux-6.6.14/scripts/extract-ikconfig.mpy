{
  "module_name": "extract-ikconfig",
  "hash_id": "070020a9c5a0b9e6f7e24f5728073e8e62155be49133a9f3f37e8fc19230a9b1",
  "original_prompt": "Ingested from linux-6.6.14/scripts/extract-ikconfig",
  "human_readable_source": "#!/bin/sh\n# ----------------------------------------------------------------------\n# extract-ikconfig - Extract the .config file from a kernel image\n#\n# This will only work when the kernel was compiled with CONFIG_IKCONFIG.\n#\n# The obscure use of the \"tr\" filter is to work around older versions of\n# \"grep\" that report the byte offset of the line instead of the pattern.\n#\n# (c) 2009,2010 Dick Streefland <dick@streefland.net>\n# Licensed under the terms of the GNU General Public License.\n# ----------------------------------------------------------------------\n\ncf1='IKCFG_ST\\037\\213\\010'\ncf2='0123456789'\n\ndump_config()\n{\n\tif\tpos=`tr \"$cf1\\n$cf2\" \"\\n$cf2=\" < \"$1\" | grep -abo \"^$cf2\"`\n\tthen\n\t\tpos=${pos%%:*}\n\t\ttail -c+$(($pos+8)) \"$1\" | zcat > $tmp1 2> /dev/null\n\t\tif\t[ $? != 1 ]\n\t\tthen\t# exit status must be 0 or 2 (trailing garbage warning)\n\t\t\tcat $tmp1\n\t\t\texit 0\n\t\tfi\n\tfi\n}\n\ntry_decompress()\n{\n\tfor\tpos in `tr \"$1\\n$2\" \"\\n$2=\" < \"$img\" | grep -abo \"^$2\"`\n\tdo\n\t\tpos=${pos%%:*}\n\t\ttail -c+$pos \"$img\" | $3 > $tmp2 2> /dev/null\n\t\tdump_config $tmp2\n\tdone\n}\n\n# Check invocation:\nme=${0##*/}\nimg=$1\nif\t[ $# -ne 1 -o ! -s \"$img\" ]\nthen\n\techo \"Usage: $me <kernel-image>\" >&2\n\texit 2\nfi\n\n# Prepare temp files:\ntmp1=/tmp/ikconfig$$.1\ntmp2=/tmp/ikconfig$$.2\ntrap \"rm -f $tmp1 $tmp2\" 0\n\n# Initial attempt for uncompressed images or objects:\ndump_config \"$img\"\n\n# That didn't work, so retry after decompression.\ntry_decompress '\\037\\213\\010' xy    gunzip\ntry_decompress '\\3757zXZ\\000' abcde unxz\ntry_decompress 'BZh'          xy    bunzip2\ntry_decompress '\\135\\0\\0\\0'   xxx   unlzma\ntry_decompress '\\211\\114\\132' xy    'lzop -d'\ntry_decompress '\\002\\041\\114\\030' xyy 'lz4 -d -l'\ntry_decompress '\\050\\265\\057\\375' xxx unzstd\n\n# Bail out:\necho \"$me: Cannot find kernel config.\" >&2\nexit 1\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}