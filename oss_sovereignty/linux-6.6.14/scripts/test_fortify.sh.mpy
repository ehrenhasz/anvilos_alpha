{
  "module_name": "test_fortify.sh",
  "hash_id": "696d95a4acf34e5332c6a904fd04ec4524fb7165fc85a81633725c529558bef4",
  "original_prompt": "Ingested from linux-6.6.14/scripts/test_fortify.sh",
  "human_readable_source": "#!/bin/sh\n# SPDX-License-Identifier: GPL-2.0-only\nset -e\n\n# Argument 1: Source file to build.\nIN=\"$1\"\nshift\n# Extract just the filename for error messages below.\nFILE=\"${IN##*/}\"\n# Extract the function name for error messages below.\nFUNC=\"${FILE#*-}\"\nFUNC=\"${FUNC%%-*}\"\nFUNC=\"${FUNC%%.*}\"\n# Extract the symbol to test for in build/symbol test below.\nWANT=\"__${FILE%%-*}\"\n\n# Argument 2: Where to write the build log.\nOUT=\"$1\"\nshift\nTMP=\"${OUT}.tmp\"\n\n# Argument 3: Path to \"nm\" tool.\nNM=\"$1\"\nshift\n\n# Remaining arguments are: $(CC) $(c_flags)\n\n# Clean up temporary file at exit.\n__cleanup() {\n\trm -f \"$TMP\"\n}\ntrap __cleanup EXIT\n\n# Function names in warnings are wrapped in backticks under UTF-8 locales.\n# Run the commands with LANG=C so that grep output will not change.\nexport LANG=C\n\nstatus=\n# Attempt to build a source that is expected to fail with a specific warning.\nif \"$@\" -Werror -c \"$IN\" -o \"$OUT\".o 2> \"$TMP\" ; then\n\t# If the build succeeds, either the test has failed or the\n\t# warning may only happen at link time (Clang). In that case,\n\t# make sure the expected symbol is unresolved in the symbol list.\n\t# If so, FORTIFY is working for this case.\n\tif ! $NM -A \"$OUT\".o | grep -m1 \"\\bU ${WANT}$\" >>\"$TMP\" ; then\n\t\tstatus=\"warning: unsafe ${FUNC}() usage lacked '$WANT' symbol in $IN\"\n\tfi\nelse\n\t# If the build failed, check for the warning in the stderr.\n\t# GCC:\n\t# ./include/linux/fortify-string.h:316:25: error: call to '__write_overflow_field' declared with attribute warning: detected write beyond size of field (1st parameter); maybe use struct_group()? [-Werror=attribute-warning]\n\t# Clang 14:\n\t# ./include/linux/fortify-string.h:316:4: error: call to __write_overflow_field declared with 'warning' attribute: detected write beyond size of field (1st parameter); maybe use struct_group()? [-Werror,-Wattribute-warning]\n\tif ! grep -Eq -m1 \"error: call to .?\\b${WANT}\\b.?\" \"$TMP\" ; then\n\t\tstatus=\"warning: unsafe ${FUNC}() usage lacked '$WANT' warning in $IN\"\n\tfi\nfi\n\nif [ -n \"$status\" ]; then\n\t# Report on failure results, including compilation warnings.\n\techo \"$status\" | tee \"$OUT\" >&2\nelse\n\t# Report on good results, and save any compilation output to log.\n\techo \"ok: unsafe ${FUNC}() usage correctly detected with '$WANT' in $IN\" >\"$OUT\"\nfi\ncat \"$TMP\" >>\"$OUT\"\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}