{
  "module_name": "syscallhdr.sh",
  "hash_id": "a0faed17e23781d10296eeebe89a7ed35cd80e70ce309c309b95fb916fee779f",
  "original_prompt": "Ingested from linux-6.6.14/scripts/syscallhdr.sh",
  "human_readable_source": "#!/bin/sh\n# SPDX-License-Identifier: GPL-2.0-only\n#\n# Generate a syscall number header.\n#\n# Each line of the syscall table should have the following format:\n#\n# NR ABI NAME [NATIVE] [COMPAT]\n#\n# NR       syscall number\n# ABI      ABI name\n# NAME     syscall name\n# NATIVE   native entry point (optional)\n# COMPAT   compat entry point (optional)\n\nset -e\n\nusage() {\n\techo >&2 \"usage: $0 [--abis ABIS] [--emit-nr] [--offset OFFSET] [--prefix PREFIX] INFILE OUTFILE\" >&2\n\techo >&2\n\techo >&2 \"  INFILE    input syscall table\"\n\techo >&2 \"  OUTFILE   output header file\"\n\techo >&2\n\techo >&2 \"options:\"\n\techo >&2 \"  --abis ABIS        ABI(s) to handle (By default, all lines are handled)\"\n\techo >&2 \"  --emit-nr          Emit the macro of the number of syscalls (__NR_syscalls)\"\n\techo >&2 \"  --offset OFFSET    The offset of syscall numbers\"\n\techo >&2 \"  --prefix PREFIX    The prefix to the macro like __NR_<PREFIX><NAME>\"\n\texit 1\n}\n\n# default unless specified by options\nabis=\nemit_nr=\noffset=\nprefix=\n\nwhile [ $# -gt 0 ]\ndo\n\tcase $1 in\n\t--abis)\n\t\tabis=$(echo \"($2)\" | tr ',' '|')\n\t\tshift 2;;\n\t--emit-nr)\n\t\temit_nr=1\n\t\tshift 1;;\n\t--offset)\n\t\toffset=$2\n\t\tshift 2;;\n\t--prefix)\n\t\tprefix=$2\n\t\tshift 2;;\n\t-*)\n\t\techo \"$1: unknown option\" >&2\n\t\tusage;;\n\t*)\n\t\tbreak;;\n\tesac\ndone\n\nif [ $# -ne 2 ]; then\n\tusage\nfi\n\ninfile=\"$1\"\noutfile=\"$2\"\n\nguard=_UAPI_ASM_$(basename \"$outfile\" |\n\tsed -e 'y/abcdefghijklmnopqrstuvwxyz/ABCDEFGHIJKLMNOPQRSTUVWXYZ/' \\\n\t-e 's/[^A-Z0-9_]/_/g' -e 's/__/_/g')\n\ngrep -E \"^[0-9A-Fa-fXx]+[[:space:]]+$abis\" \"$infile\" | {\n\techo \"#ifndef $guard\"\n\techo \"#define $guard\"\n\techo\n\n\tmax=0\n\twhile read nr abi name native compat ; do\n\n\t\tmax=$nr\n\n\t\tif [ -n \"$offset\" ]; then\n\t\t\tnr=\"($offset + $nr)\"\n\t\tfi\n\n\t\techo \"#define __NR_$prefix$name $nr\"\n\tdone\n\n\tif [ -n \"$emit_nr\" ]; then\n\t\techo\n\t\techo \"#ifdef __KERNEL__\"\n\t\techo \"#define __NR_${prefix}syscalls $(($max + 1))\"\n\t\techo \"#endif\"\n\tfi\n\n\techo\n\techo \"#endif /* $guard */\"\n} > \"$outfile\"\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}