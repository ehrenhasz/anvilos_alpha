{
  "module_name": "objdiff",
  "hash_id": "58e2d79472336cedac7ee248fdb89fc902a6d777c42d29a2b670f99100937251",
  "original_prompt": "Ingested from linux-6.6.14/scripts/objdiff",
  "human_readable_source": "#!/bin/bash\n# SPDX-License-Identifier: GPL-2.0-only\n\n# objdiff - a small script for validating that a commit or series of commits\n# didn't change object code.\n#\n# Copyright 2014, Jason Cooper <jason@lakedaemon.net>\n#\n\n# usage example:\n#\n# $ git checkout COMMIT_A\n# $ <your fancy build command here>\n# $ ./scripts/objdiff record path/to/*.o\n#\n# $ git checkout COMMIT_B\n# $ <your fancy build command here>\n# $ ./scripts/objdiff record path/to/*.o\n#\n# $ ./scripts/objdiff diff COMMIT_A COMMIT_B\n# $\n\n# And to clean up (everything is in .objdiff/*)\n# $ ./scripts/objdiff clean all\n#\n# Note: 'make mrproper' will also remove .objdiff\n\nSRCTREE=$(cd $(git rev-parse --show-toplevel 2>/dev/null); pwd)\n\nif [ -z \"$SRCTREE\" ]; then\n\techo >&2 \"ERROR: Not a git repository.\"\n\texit 1\nfi\n\nTMPD=$SRCTREE/.objdiff\n\nusage() {\n\techo >&2 \"Usage: $0 <command> <args>\"\n\techo >&2 \"  record    <list of object files or directories>\"\n\techo >&2 \"  diff      <commitA> <commitB>\"\n\techo >&2 \"  clean     all | <commit>\"\n\texit 1\n}\n\nget_output_dir() {\n\tdir=${1%/*}\n\n\tif [ \"$dir\" = \"$1\" ]; then\n\t\tdir=.\n\tfi\n\n\tdir=$(cd $dir; pwd)\n\n\techo $TMPD/$CMT${dir#$SRCTREE}\n}\n\ndo_objdump() {\n\tdir=$(get_output_dir $1)\n\tbase=${1##*/}\n\tstripped=$dir/${base%.o}.stripped\n\tdis=$dir/${base%.o}.dis\n\n\t[ ! -d \"$dir\" ] && mkdir -p $dir\n\n\t# remove addresses for a cleaner diff\n\t# http://dummdida.tumblr.com/post/60924060451/binary-diff-between-libc-from-scientificlinux-and\n\t$STRIP -g $1 -R __bug_table -R .note -R .comment -o $stripped\n\t$OBJDUMP -D $stripped | sed -e \"s/^[[:space:]]\\+[0-9a-f]\\+//\" -e \"s:^$stripped:$1:\" > $dis\n}\n\ndorecord() {\n\t[ $# -eq 0 ] && usage\n\n\tFILES=\"$*\"\n\n\tCMT=\"`git rev-parse --short HEAD`\"\n\n\tSTRIP=\"${CROSS_COMPILE}strip\"\n\tOBJDUMP=\"${CROSS_COMPILE}objdump\"\n\n\tfor d in $FILES; do\n\t\tif [ -d \"$d\" ]; then\n\t\t\tfor f in $(find $d -name '*.o')\n\t\t\tdo\n\t\t\t\tdo_objdump $f\n\t\t\tdone\n\t\telse\n\t\t\tdo_objdump $d\n\t\tfi\n\tdone\n}\n\ndodiff() {\n\t[ $# -ne 2 ] && [ $# -ne 0 ] && usage\n\n\tif [ $# -eq 0 ]; then\n\t\tSRC=\"`git rev-parse --short HEAD^`\"\n\t\tDST=\"`git rev-parse --short HEAD`\"\n\telse\n\t\tSRC=\"`git rev-parse --short $1`\"\n\t\tDST=\"`git rev-parse --short $2`\"\n\tfi\n\n\tDIFF=\"`which colordiff`\"\n\n\tif [ ${#DIFF} -eq 0 ] || [ ! -x \"$DIFF\" ]; then\n\t\tDIFF=\"`which diff`\"\n\tfi\n\n\tSRCD=\"$TMPD/$SRC\"\n\tDSTD=\"$TMPD/$DST\"\n\n\tif [ ! -d \"$SRCD\" ]; then\n\t\techo >&2 \"ERROR: $SRCD doesn't exist\"\n\t\texit 1\n\tfi\n\n\tif [ ! -d \"$DSTD\" ]; then\n\t\techo >&2 \"ERROR: $DSTD doesn't exist\"\n\t\texit 1\n\tfi\n\n\t$DIFF -Nurd $SRCD $DSTD\n}\n\ndoclean() {\n\t[ $# -eq 0 ] && usage\n\t[ $# -gt 1 ] && usage\n\n\tif [ \"x$1\" = \"xall\" ]; then\n\t\trm -rf $TMPD/*\n\telse\n\t\tCMT=\"`git rev-parse --short $1`\"\n\n\t\tif [ -d \"$TMPD/$CMT\" ]; then\n\t\t\trm -rf $TMPD/$CMT\n\t\telse\n\t\t\techo >&2 \"$CMT not found\"\n\t\tfi\n\tfi\n}\n\n[ $# -eq 0 ] &&\tusage\n\ncase \"$1\" in\n\trecord)\n\t\tshift\n\t\tdorecord $*\n\t\t;;\n\tdiff)\n\t\tshift\n\t\tdodiff $*\n\t\t;;\n\tclean)\n\t\tshift\n\t\tdoclean $*\n\t\t;;\n\t*)\n\t\techo >&2 \"Unrecognized command '$1'\"\n\t\texit 1\n\t\t;;\nesac\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}