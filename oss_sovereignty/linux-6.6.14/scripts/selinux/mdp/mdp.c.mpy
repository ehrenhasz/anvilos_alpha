{
  "module_name": "mdp.c",
  "hash_id": "b9fbd0a7d45f97d31b0c469e552e03857b20b19e14e93c32d4ce373f701e79a1",
  "original_prompt": "Ingested from linux-6.6.14/scripts/selinux/mdp/mdp.c",
  "human_readable_source": "\n \n\n\n \n#define __EXPORTED_HEADERS__\n\n#include <stdio.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <string.h>\n#include <linux/kconfig.h>\n\nstatic void usage(char *name)\n{\n\tprintf(\"usage: %s [-m] policy_file context_file\\n\", name);\n\texit(1);\n}\n\n \nstruct security_class_mapping {\n\tconst char *name;\n\tconst char *perms[sizeof(unsigned) * 8 + 1];\n};\n\n#include \"classmap.h\"\n#include \"initial_sid_to_string.h\"\n#include \"policycap_names.h\"\n\n#define ARRAY_SIZE(arr) (sizeof(arr) / sizeof((arr)[0]))\n\nint main(int argc, char *argv[])\n{\n\tint i, j, mls = 0;\n\tint initial_sid_to_string_len;\n\tchar **arg, *polout, *ctxout;\n\n\tFILE *fout;\n\n\tif (argc < 3)\n\t\tusage(argv[0]);\n\targ = argv+1;\n\tif (argc==4 && strcmp(argv[1], \"-m\") == 0) {\n\t\tmls = 1;\n\t\targ++;\n\t}\n\tpolout = *arg++;\n\tctxout = *arg;\n\n\tfout = fopen(polout, \"w\");\n\tif (!fout) {\n\t\tprintf(\"Could not open %s for writing\\n\", polout);\n\t\tusage(argv[0]);\n\t}\n\n\t \n\tfor (i = 0; secclass_map[i].name; i++)\n\t\tfprintf(fout, \"class %s\\n\", secclass_map[i].name);\n\tfprintf(fout, \"\\n\");\n\n\tinitial_sid_to_string_len = sizeof(initial_sid_to_string) / sizeof (char *);\n\t \n\tfor (i = 1; i < initial_sid_to_string_len; i++) {\n\t\tconst char *name = initial_sid_to_string[i];\n\n\t\tif (name)\n\t\t\tfprintf(fout, \"sid %s\\n\", name);\n\t\telse\n\t\t\tfprintf(fout, \"sid unused%d\\n\", i);\n\t}\n\tfprintf(fout, \"\\n\");\n\n\t \n\tfor (i = 0; secclass_map[i].name; i++) {\n\t\tconst struct security_class_mapping *map = &secclass_map[i];\n\t\tfprintf(fout, \"class %s\\n\", map->name);\n\t\tfprintf(fout, \"{\\n\");\n\t\tfor (j = 0; map->perms[j]; j++)\n\t\t\tfprintf(fout, \"\\t%s\\n\", map->perms[j]);\n\t\tfprintf(fout, \"}\\n\\n\");\n\t}\n\tfprintf(fout, \"\\n\");\n\n\t \n\tif (mls) {\n\t\tfprintf(fout, \"sensitivity s0;\\n\");\n\t\tfprintf(fout, \"sensitivity s1;\\n\");\n\t\tfprintf(fout, \"dominance { s0 s1 }\\n\");\n\t\tfprintf(fout, \"category c0;\\n\");\n\t\tfprintf(fout, \"category c1;\\n\");\n\t\tfprintf(fout, \"level s0:c0.c1;\\n\");\n\t\tfprintf(fout, \"level s1:c0.c1;\\n\");\n#define SYSTEMLOW \"s0\"\n#define SYSTEMHIGH \"s1:c0.c1\"\n\t\tfor (i = 0; secclass_map[i].name; i++) {\n\t\t\tconst struct security_class_mapping *map = &secclass_map[i];\n\n\t\t\tfprintf(fout, \"mlsconstrain %s {\\n\", map->name);\n\t\t\tfor (j = 0; map->perms[j]; j++)\n\t\t\t\tfprintf(fout, \"\\t%s\\n\", map->perms[j]);\n\t\t\t \n\t\t\tfprintf(fout, \"} (l2 eq h2 and h1 dom h2);\\n\\n\");\n\t\t}\n\t}\n\n\t \n\tfor (i = 0; i < ARRAY_SIZE(selinux_policycap_names); i++)\n\t\tfprintf(fout, \"policycap %s;\\n\", selinux_policycap_names[i]);\n\n\t \n\tfprintf(fout, \"type base_t;\\n\");\n\tfprintf(fout, \"role base_r;\\n\");\n\tfprintf(fout, \"role base_r types { base_t };\\n\");\n\tfor (i = 0; secclass_map[i].name; i++)\n\t\tfprintf(fout, \"allow base_t base_t:%s *;\\n\",\n\t\t\tsecclass_map[i].name);\n\tfprintf(fout, \"user user_u roles { base_r }\");\n\tif (mls)\n\t\tfprintf(fout, \" level %s range %s - %s\", SYSTEMLOW,\n\t\t\tSYSTEMLOW, SYSTEMHIGH);\n\tfprintf(fout, \";\\n\");\n\n#define SUBJUSERROLETYPE \"user_u:base_r:base_t\"\n#define OBJUSERROLETYPE \"user_u:object_r:base_t\"\n\n\t \n\tfor (i = 1; i < initial_sid_to_string_len; i++) {\n\t\tconst char *name = initial_sid_to_string[i];\n\n\t\tif (name)\n\t\t\tfprintf(fout, \"sid %s \", name);\n\t\telse\n\t\t\tfprintf(fout, \"sid unused%d\\n\", i);\n\t\tfprintf(fout, SUBJUSERROLETYPE \"%s\\n\",\n\t\t\tmls ? \":\" SYSTEMLOW : \"\");\n\t}\n\tfprintf(fout, \"\\n\");\n\n#define FS_USE(behavior, fstype)\t\t\t    \\\n\tfprintf(fout, \"fs_use_%s %s \" OBJUSERROLETYPE \"%s;\\n\", \\\n\t\tbehavior, fstype, mls ? \":\" SYSTEMLOW : \"\")\n\n\t \n#ifdef CONFIG_EXT2_FS_SECURITY\n\tFS_USE(\"xattr\", \"ext2\");\n#endif\n#ifdef CONFIG_EXT4_FS_SECURITY\n#ifdef CONFIG_EXT4_USE_FOR_EXT2\n\tFS_USE(\"xattr\", \"ext2\");\n#endif\n\tFS_USE(\"xattr\", \"ext3\");\n\tFS_USE(\"xattr\", \"ext4\");\n#endif\n#ifdef CONFIG_JFS_SECURITY\n\tFS_USE(\"xattr\", \"jfs\");\n#endif\n#ifdef CONFIG_REISERFS_FS_SECURITY\n\tFS_USE(\"xattr\", \"reiserfs\");\n#endif\n#ifdef CONFIG_JFFS2_FS_SECURITY\n\tFS_USE(\"xattr\", \"jffs2\");\n#endif\n#ifdef CONFIG_XFS_FS\n\tFS_USE(\"xattr\", \"xfs\");\n#endif\n#ifdef CONFIG_GFS2_FS\n\tFS_USE(\"xattr\", \"gfs2\");\n#endif\n#ifdef CONFIG_BTRFS_FS\n\tFS_USE(\"xattr\", \"btrfs\");\n#endif\n#ifdef CONFIG_F2FS_FS_SECURITY\n\tFS_USE(\"xattr\", \"f2fs\");\n#endif\n#ifdef CONFIG_OCFS2_FS\n\tFS_USE(\"xattr\", \"ocsfs2\");\n#endif\n#ifdef CONFIG_OVERLAY_FS\n\tFS_USE(\"xattr\", \"overlay\");\n#endif\n#ifdef CONFIG_SQUASHFS_XATTR\n\tFS_USE(\"xattr\", \"squashfs\");\n#endif\n\n\t \n\tFS_USE(\"task\", \"pipefs\");\n\tFS_USE(\"task\", \"sockfs\");\n\n\t \n#ifdef CONFIG_UNIX98_PTYS\n\tFS_USE(\"trans\", \"devpts\");\n#endif\n#ifdef CONFIG_HUGETLBFS\n\tFS_USE(\"trans\", \"hugetlbfs\");\n#endif\n#ifdef CONFIG_TMPFS\n\tFS_USE(\"trans\", \"tmpfs\");\n#endif\n#ifdef CONFIG_DEVTMPFS\n\tFS_USE(\"trans\", \"devtmpfs\");\n#endif\n#ifdef CONFIG_POSIX_MQUEUE\n\tFS_USE(\"trans\", \"mqueue\");\n#endif\n\n#define GENFSCON(fstype, prefix)\t\t\t     \\\n\tfprintf(fout, \"genfscon %s %s \" OBJUSERROLETYPE \"%s\\n\", \\\n\t\tfstype, prefix, mls ? \":\" SYSTEMLOW : \"\")\n\n\t \n#ifdef CONFIG_PROC_FS\n\tGENFSCON(\"proc\", \"/\");\n#endif\n#ifdef CONFIG_SECURITY_SELINUX\n\tGENFSCON(\"selinuxfs\", \"/\");\n#endif\n#ifdef CONFIG_SYSFS\n\tGENFSCON(\"sysfs\", \"/\");\n#endif\n#ifdef CONFIG_DEBUG_FS\n\tGENFSCON(\"debugfs\", \"/\");\n#endif\n#ifdef CONFIG_TRACING\n\tGENFSCON(\"tracefs\", \"/\");\n#endif\n#ifdef CONFIG_PSTORE\n\tGENFSCON(\"pstore\", \"/\");\n#endif\n\tGENFSCON(\"cgroup\", \"/\");\n\tGENFSCON(\"cgroup2\", \"/\");\n\n\tfclose(fout);\n\n\tfout = fopen(ctxout, \"w\");\n\tif (!fout) {\n\t\tprintf(\"Wrote policy, but cannot open %s for writing\\n\", ctxout);\n\t\tusage(argv[0]);\n\t}\n\tfprintf(fout, \"/ \" OBJUSERROLETYPE \"%s\\n\", mls ? \":\" SYSTEMLOW : \"\");\n\tfprintf(fout, \"/.* \" OBJUSERROLETYPE \"%s\\n\", mls ? \":\" SYSTEMLOW : \"\");\n\tfclose(fout);\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}