{
  "module_name": "install_policy.sh",
  "hash_id": "5a99eedd69068efde564c82f85facaf772c2caa406d4b7589602633f9324c049",
  "original_prompt": "Ingested from linux-6.6.14/scripts/selinux/install_policy.sh",
  "human_readable_source": "#!/bin/sh\n# SPDX-License-Identifier: GPL-2.0\nset -e\nif [ `id -u` -ne 0 ]; then\n\techo \"$0: must be root to install the selinux policy\"\n\texit 1\nfi\n\nSF=`which setfiles`\nif [ $? -eq 1 ]; then\n\techo \"Could not find setfiles\"\n\techo \"Do you have policycoreutils installed?\"\n\texit 1\nfi\n\nCP=`which checkpolicy`\nif [ $? -eq 1 ]; then\n\techo \"Could not find checkpolicy\"\n\techo \"Do you have checkpolicy installed?\"\n\texit 1\nfi\nVERS=`$CP -V | awk '{print $1}'`\n\nENABLED=`which selinuxenabled`\nif [ $? -eq 1 ]; then\n\techo \"Could not find selinuxenabled\"\n\techo \"Do you have libselinux-utils installed?\"\n\texit 1\nfi\n\nif selinuxenabled; then\n    echo \"SELinux is already enabled\"\n    echo \"This prevents safely relabeling all files.\"\n    echo \"Boot with selinux=0 on the kernel command-line.\"\n    exit 1\nfi\n\ncd mdp\n./mdp -m policy.conf file_contexts\n$CP -U allow -M -o policy.$VERS policy.conf\n\nmkdir -p /etc/selinux/dummy/policy\nmkdir -p /etc/selinux/dummy/contexts/files\n\necho \"__default__:user_u:s0\" > /etc/selinux/dummy/seusers\necho \"base_r:base_t:s0\" > /etc/selinux/dummy/contexts/failsafe_context\necho \"base_r:base_t:s0 base_r:base_t:s0\" > /etc/selinux/dummy/default_contexts\ncat > /etc/selinux/dummy/contexts/x_contexts <<EOF\nclient * user_u:base_r:base_t:s0\nproperty * user_u:object_r:base_t:s0\nextension * user_u:object_r:base_t:s0\nselection * user_u:object_r:base_t:s0\nevent * user_u:object_r:base_t:s0\nEOF\ntouch /etc/selinux/dummy/contexts/virtual_domain_context\ntouch /etc/selinux/dummy/contexts/virtual_image_context\n\ncp file_contexts /etc/selinux/dummy/contexts/files\ncp dbus_contexts /etc/selinux/dummy/contexts\ncp policy.$VERS /etc/selinux/dummy/policy\nFC_FILE=/etc/selinux/dummy/contexts/files/file_contexts\n\nif [ ! -d /etc/selinux ]; then\n\tmkdir -p /etc/selinux\nfi\nif [ -f /etc/selinux/config ]; then\n    echo \"/etc/selinux/config exists, moving to /etc/selinux/config.bak.\"\n    mv /etc/selinux/config /etc/selinux/config.bak\nfi\necho \"Creating new /etc/selinux/config for dummy policy.\"\ncat > /etc/selinux/config << EOF\nSELINUX=permissive\nSELINUXTYPE=dummy\nEOF\n\ncd /etc/selinux/dummy/contexts/files\n$SF -F file_contexts /\n\nmounts=`cat /proc/$$/mounts | \\\n\tgrep -E \"ext[234]|jfs|xfs|reiserfs|jffs2|gfs2|btrfs|f2fs|ocfs2\" | \\\n\tawk '{ print $2 '}`\n$SF -F file_contexts $mounts\n\necho \"-F\" > /.autorelabel\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}