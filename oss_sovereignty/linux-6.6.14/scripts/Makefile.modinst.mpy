{
  "module_name": "Makefile.modinst",
  "hash_id": "0f075f224dc997f0b566118b7b0d81aa58158da6ed2bf632fe5df0e5c7905880",
  "original_prompt": "Ingested from linux-6.6.14/scripts/Makefile.modinst",
  "human_readable_source": "# SPDX-License-Identifier: GPL-2.0\n# ==========================================================================\n# Installing modules\n# ==========================================================================\n\nPHONY := __modinst\n__modinst:\n\ninclude include/config/auto.conf\ninclude $(srctree)/scripts/Kbuild.include\n\ninstall-y :=\n\nifeq ($(KBUILD_EXTMOD)$(sign-only),)\n\n# remove the old directory and symlink\n$(shell rm -fr $(MODLIB)/kernel $(MODLIB)/build)\n\ninstall-$(CONFIG_MODULES) += $(addprefix $(MODLIB)/, build modules.order)\n\n$(MODLIB)/build: FORCE\n\t$(call cmd,symlink)\n\nquiet_cmd_symlink = SYMLINK $@\n      cmd_symlink = ln -s $(CURDIR) $@\n\n$(MODLIB)/modules.order: modules.order FORCE\n\t$(call cmd,install_modorder)\n\nquiet_cmd_install_modorder = INSTALL $@\n      cmd_install_modorder = sed 's:^\\(.*\\)\\.o$$:kernel/\\1.ko:' $< > $@\n\n# Install modules.builtin(.modinfo) even when CONFIG_MODULES is disabled.\ninstall-y += $(addprefix $(MODLIB)/, modules.builtin modules.builtin.modinfo)\n\n$(addprefix $(MODLIB)/, modules.builtin modules.builtin.modinfo): $(MODLIB)/%: % FORCE\n\t$(call cmd,install)\n\nendif\n\nmodules := $(call read-file, $(MODORDER))\n\nifeq ($(KBUILD_EXTMOD),)\ndst := $(MODLIB)/kernel\nelse\nINSTALL_MOD_DIR ?= updates\ndst := $(MODLIB)/$(INSTALL_MOD_DIR)\nendif\n\n$(foreach x, % :, $(if $(findstring $x, $(dst)), \\\n\t$(error module installation path cannot contain '$x')))\n\nsuffix-y\t\t\t\t:=\nsuffix-$(CONFIG_MODULE_COMPRESS_GZIP)\t:= .gz\nsuffix-$(CONFIG_MODULE_COMPRESS_XZ)\t:= .xz\nsuffix-$(CONFIG_MODULE_COMPRESS_ZSTD)\t:= .zst\n\nmodules := $(patsubst $(extmod_prefix)%.o, $(dst)/%.ko$(suffix-y), $(modules))\ninstall-$(CONFIG_MODULES) += $(modules)\n\n__modinst: $(install-y)\n\t@:\n\n#\n# Installation\n#\nquiet_cmd_install = INSTALL $@\n      cmd_install = cp $< $@\n\n# Strip\n#\n# INSTALL_MOD_STRIP, if defined, will cause modules to be stripped after they\n# are installed. If INSTALL_MOD_STRIP is '1', then the default option\n# --strip-debug will be used. Otherwise, INSTALL_MOD_STRIP value will be used\n# as the options to the strip command.\nifdef INSTALL_MOD_STRIP\n\nifeq ($(INSTALL_MOD_STRIP),1)\nstrip-option := --strip-debug\nelse\nstrip-option := $(INSTALL_MOD_STRIP)\nendif\n\nquiet_cmd_strip = STRIP   $@\n      cmd_strip = $(STRIP) $(strip-option) $@\n\nelse\n\nquiet_cmd_strip =\n      cmd_strip = :\n\nendif\n\n#\n# Signing\n# Don't stop modules_install even if we can't sign external modules.\n#\nifeq ($(filter pkcs11:%, $(CONFIG_MODULE_SIG_KEY)),)\nsig-key := $(if $(wildcard $(CONFIG_MODULE_SIG_KEY)),,$(srctree)/)$(CONFIG_MODULE_SIG_KEY)\nelse\nsig-key := $(CONFIG_MODULE_SIG_KEY)\nendif\nquiet_cmd_sign = SIGN    $@\n      cmd_sign = scripts/sign-file $(CONFIG_MODULE_SIG_HASH) \"$(sig-key)\" certs/signing_key.x509 $@ \\\n                 $(if $(KBUILD_EXTMOD),|| true)\n\nifeq ($(sign-only),)\n\n# During modules_install, modules are signed only when CONFIG_MODULE_SIG_ALL=y.\nifndef CONFIG_MODULE_SIG_ALL\nquiet_cmd_sign :=\n      cmd_sign := :\nendif\n\n# Create necessary directories\n$(foreach dir, $(sort $(dir $(install-y))), $(shell mkdir -p $(dir)))\n\n$(dst)/%.ko: $(extmod_prefix)%.ko FORCE\n\t$(call cmd,install)\n\t$(call cmd,strip)\n\t$(call cmd,sign)\n\nifdef CONFIG_MODULES\n__modinst: depmod\n\nPHONY += depmod\ndepmod: $(install-y)\n\t$(call cmd,depmod)\n\nquiet_cmd_depmod = DEPMOD  $(MODLIB)\n      cmd_depmod = $(srctree)/scripts/depmod.sh $(KERNELRELEASE)\nendif\n\nelse\n\n$(dst)/%.ko: FORCE\n\t$(call cmd,sign)\n\nendif\n\n#\n# Compression\n#\nquiet_cmd_gzip = GZIP    $@\n      cmd_gzip = $(KGZIP) -n -f $<\nquiet_cmd_xz = XZ      $@\n      cmd_xz = $(XZ) --check=crc32 --lzma2=dict=1MiB -f $<\nquiet_cmd_zstd = ZSTD    $@\n      cmd_zstd = $(ZSTD) -T0 --rm -f -q $<\n\n$(dst)/%.ko.gz: $(dst)/%.ko FORCE\n\t$(call cmd,gzip)\n\n$(dst)/%.ko.xz: $(dst)/%.ko FORCE\n\t$(call cmd,xz)\n\n$(dst)/%.ko.zst: $(dst)/%.ko FORCE\n\t$(call cmd,zstd)\n\nPHONY += FORCE\nFORCE:\n\n.PHONY: $(PHONY)\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}