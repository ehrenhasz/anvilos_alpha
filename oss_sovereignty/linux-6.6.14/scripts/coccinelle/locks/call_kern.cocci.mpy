{
  "module_name": "call_kern.cocci",
  "hash_id": "e53846cd55d86a43514f6163db1b739d0b1dd72d53cb57e277b95edf0272d846",
  "original_prompt": "Ingested from linux-6.6.14/scripts/coccinelle/locks/call_kern.cocci",
  "human_readable_source": "// SPDX-License-Identifier: GPL-2.0-only\n/// Find functions that refer to GFP_KERNEL but are called with locks held.\n//# The proposed change of converting the GFP_KERNEL is not necessarily the\n//# correct one.  It may be desired to unlock the lock, or to not call the\n//# function under the lock in the first place.\n///\n// Confidence: Moderate\n// Copyright: (C) 2012 Nicolas Palix.\n// Copyright: (C) 2012 Julia Lawall, INRIA/LIP6.\n// Copyright: (C) 2012 Gilles Muller, INRIA/LiP6.\n// URL: https://coccinelle.gitlabpages.inria.fr/website\n// Comments:\n// Options: --no-includes --include-headers\n\nvirtual patch\nvirtual context\nvirtual org\nvirtual report\n\n@gfp exists@\nidentifier fn;\nposition p;\n@@\n\nfn(...) {\n ... when != read_unlock_irq(...)\n     when != write_unlock_irq(...)\n     when != read_unlock_irqrestore(...)\n     when != write_unlock_irqrestore(...)\n     when != spin_unlock(...)\n     when != spin_unlock_irq(...)\n     when != spin_unlock_irqrestore(...)\n     when != local_irq_enable(...)\n     when any\n GFP_KERNEL@p\n ... when any\n}\n\n@locked exists@\nidentifier gfp.fn;\nposition p1,p2;\n@@\n\n(\nread_lock_irq@p1\n|\nwrite_lock_irq@p1\n|\nread_lock_irqsave@p1\n|\nwrite_lock_irqsave@p1\n|\nspin_lock@p1\n|\nspin_trylock@p1\n|\nspin_lock_irq@p1\n|\nspin_lock_irqsave@p1\n|\nlocal_irq_disable@p1\n)\n (...)\n...  when != read_unlock_irq(...)\n     when != write_unlock_irq(...)\n     when != read_unlock_irqrestore(...)\n     when != write_unlock_irqrestore(...)\n     when != spin_unlock(...)\n     when != spin_unlock_irq(...)\n     when != spin_unlock_irqrestore(...)\n     when != local_irq_enable(...)\nfn@p2(...)\n\n@depends on locked && patch@\nposition gfp.p;\n@@\n\n- GFP_KERNEL@p\n+ GFP_ATOMIC\n\n@depends on locked && !patch@\nposition gfp.p;\n@@\n\n* GFP_KERNEL@p\n\n@script:python depends on !patch && org@\np << gfp.p;\nfn << gfp.fn;\np1 << locked.p1;\np2 << locked.p2;\n@@\n\ncocci.print_main(\"lock\",p1)\ncocci.print_secs(\"call\",p2)\ncocci.print_secs(\"GFP_KERNEL\",p)\n\n@script:python depends on !patch && report@\np << gfp.p;\nfn << gfp.fn;\np1 << locked.p1;\np2 << locked.p2;\n@@\n\nmsg = \"ERROR: function %s called on line %s inside lock on line %s but uses GFP_KERNEL\" % (fn,p2[0].line,p1[0].line)\ncoccilib.report.print_report(p[0], msg)\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}