{
  "module_name": "array_size_dup.cocci",
  "hash_id": "fa7e6993440d43d63341515b12f9a0c62a96dfeeefe7baadce753283abd78136",
  "original_prompt": "Ingested from linux-6.6.14/scripts/coccinelle/misc/array_size_dup.cocci",
  "human_readable_source": "// SPDX-License-Identifier: GPL-2.0-only\n///\n/// Check for array_size(), array3_size(), struct_size() duplicates.\n/// These patterns are detected:\n///  1. An opencoded expression is used before array_size() to compute the same size\n///  2. An opencoded expression is used after array_size() to compute the same size\n/// From security point of view only first case is relevant. These functions\n/// perform arithmetic overflow check. Thus, if we use an opencoded expression\n/// before a call to the *_size() function we can miss an overflow.\n///\n// Confidence: High\n// Copyright: (C) 2020 Denis Efremov ISPRAS\n// Options: --no-includes --include-headers --no-loops\n\nvirtual context\nvirtual report\nvirtual org\n\n@as@\nexpression E1, E2;\n@@\n\narray_size(E1, E2)\n\n@as_next@\nexpression subE1 <= as.E1;\nexpression subE2 <= as.E2;\nexpression as.E1, as.E2, E3;\nassignment operator aop;\nposition p1, p2;\n@@\n\n* E1 * E2@p1\n  ... when != \\(subE1\\|subE2\\) aop E3\n      when != &\\(subE1\\|subE2\\)\n* array_size(E1, E2)@p2\n\n@script:python depends on report@\np1 << as_next.p1;\np2 << as_next.p2;\n@@\n\nmsg = \"WARNING: array_size is used later (line %s) to compute the same size\" % (p2[0].line)\ncoccilib.report.print_report(p1[0], msg)\n\n@script:python depends on org@\np1 << as_next.p1;\np2 << as_next.p2;\n@@\n\nmsg = \"WARNING: array_size is used later (line %s) to compute the same size\" % (p2[0].line)\ncoccilib.org.print_todo(p1[0], msg)\n\n@as_prev@\nexpression subE1 <= as.E1;\nexpression subE2 <= as.E2;\nexpression as.E1, as.E2, E3;\nassignment operator aop;\nposition p1, p2;\n@@\n\n* array_size(E1, E2)@p1\n  ... when != \\(subE1\\|subE2\\) aop E3\n      when != &\\(subE1\\|subE2\\)\n* E1 * E2@p2\n\n@script:python depends on report@\np1 << as_prev.p1;\np2 << as_prev.p2;\n@@\n\nmsg = \"WARNING: array_size is already used (line %s) to compute the same size\" % (p1[0].line)\ncoccilib.report.print_report(p2[0], msg)\n\n@script:python depends on org@\np1 << as_prev.p1;\np2 << as_prev.p2;\n@@\n\nmsg = \"WARNING: array_size is already used (line %s) to compute the same size\" % (p1[0].line)\ncoccilib.org.print_todo(p2[0], msg)\n\n@as3@\nexpression E1, E2, E3;\n@@\n\narray3_size(E1, E2, E3)\n\n@as3_next@\nexpression subE1 <= as3.E1;\nexpression subE2 <= as3.E2;\nexpression subE3 <= as3.E3;\nexpression as3.E1, as3.E2, as3.E3, E4;\nassignment operator aop;\nposition p1, p2;\n@@\n\n* E1 * E2 * E3@p1\n  ... when != \\(subE1\\|subE2\\|subE3\\) aop E4\n      when != &\\(subE1\\|subE2\\|subE3\\)\n* array3_size(E1, E2, E3)@p2\n\n@script:python depends on report@\np1 << as3_next.p1;\np2 << as3_next.p2;\n@@\n\nmsg = \"WARNING: array3_size is used later (line %s) to compute the same size\" % (p2[0].line)\ncoccilib.report.print_report(p1[0], msg)\n\n@script:python depends on org@\np1 << as3_next.p1;\np2 << as3_next.p2;\n@@\n\nmsg = \"WARNING: array3_size is used later (line %s) to compute the same size\" % (p2[0].line)\ncoccilib.org.print_todo(p1[0], msg)\n\n@as3_prev@\nexpression subE1 <= as3.E1;\nexpression subE2 <= as3.E2;\nexpression subE3 <= as3.E3;\nexpression as3.E1, as3.E2, as3.E3, E4;\nassignment operator aop;\nposition p1, p2;\n@@\n\n* array3_size(E1, E2, E3)@p1\n  ... when != \\(subE1\\|subE2\\|subE3\\) aop E4\n      when != &\\(subE1\\|subE2\\|subE3\\)\n* E1 * E2 * E3@p2\n\n@script:python depends on report@\np1 << as3_prev.p1;\np2 << as3_prev.p2;\n@@\n\nmsg = \"WARNING: array3_size is already used (line %s) to compute the same size\" % (p1[0].line)\ncoccilib.report.print_report(p2[0], msg)\n\n@script:python depends on org@\np1 << as3_prev.p1;\np2 << as3_prev.p2;\n@@\n\nmsg = \"WARNING: array3_size is already used (line %s) to compute the same size\" % (p1[0].line)\ncoccilib.org.print_todo(p2[0], msg)\n\n@ss@\nexpression E1, E2, E3;\n@@\n\nstruct_size(E1, E2, E3)\n\n@ss_next@\nexpression subE3 <= ss.E3;\nexpression ss.E1, ss.E2, ss.E3, E4;\nassignment operator aop;\nposition p1, p2;\n@@\n\n* E1 * E2 + E3@p1\n  ... when != subE3 aop E4\n      when != &subE3\n* struct_size(E1, E2, E3)@p2\n\n@script:python depends on report@\np1 << ss_next.p1;\np2 << ss_next.p2;\n@@\n\nmsg = \"WARNING: struct_size is used later (line %s) to compute the same size\" % (p2[0].line)\ncoccilib.report.print_report(p1[0], msg)\n\n@script:python depends on org@\np1 << ss_next.p1;\np2 << ss_next.p2;\n@@\n\nmsg = \"WARNING: struct_size is used later (line %s) to compute the same size\" % (p2[0].line)\ncoccilib.org.print_todo(p1[0], msg)\n\n@ss_prev@\nexpression subE3 <= ss.E3;\nexpression ss.E1, ss.E2, ss.E3, E4;\nassignment operator aop;\nposition p1, p2;\n@@\n\n* struct_size(E1, E2, E3)@p1\n  ... when != subE3 aop E4\n      when != &subE3\n* E1 * E2 + E3@p2\n\n@script:python depends on report@\np1 << ss_prev.p1;\np2 << ss_prev.p2;\n@@\n\nmsg = \"WARNING: struct_size is already used (line %s) to compute the same size\" % (p1[0].line)\ncoccilib.report.print_report(p2[0], msg)\n\n@script:python depends on org@\np1 << ss_prev.p1;\np2 << ss_prev.p2;\n@@\n\nmsg = \"WARNING: struct_size is already used (line %s) to compute the same size\" % (p1[0].line)\ncoccilib.org.print_todo(p2[0], msg)\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}