{
  "module_name": "do_div.cocci",
  "hash_id": "bb55159e488296ada89bc4e0097c71d217a3a810ada4a05c6680cc467c24a9e3",
  "original_prompt": "Ingested from linux-6.6.14/scripts/coccinelle/misc/do_div.cocci",
  "human_readable_source": "// SPDX-License-Identifier: GPL-2.0-only\n/// do_div() does a 64-by-32 division.\n/// When the divisor is long, unsigned long, u64, or s64,\n/// do_div() truncates it to 32 bits, this means it can test\n/// non-zero and be truncated to 0 for division on 64bit platforms.\n///\n//# This makes an effort to find those inappropriate do_div() calls.\n//\n// Confidence: Moderate\n// Copyright: (C) 2020 Wen Yang, Alibaba.\n// Comments:\n// Options: --no-includes --include-headers\n\nvirtual context\nvirtual org\nvirtual report\n\n@initialize:python@\n@@\n\ndef get_digit_type_and_value(str):\n    is_digit = False\n    value = 0\n\n    try:\n        if (str.isdigit()):\n           is_digit = True\n           value =  int(str, 0)\n        elif (str.upper().endswith('ULL')):\n           is_digit = True\n           value = int(str[:-3], 0)\n        elif (str.upper().endswith('LL')):\n           is_digit = True\n           value = int(str[:-2], 0)\n        elif (str.upper().endswith('UL')):\n           is_digit = True\n           value = int(str[:-2], 0)\n        elif (str.upper().endswith('L')):\n           is_digit = True\n           value = int(str[:-1], 0)\n        elif (str.upper().endswith('U')):\n           is_digit = True\n           value = int(str[:-1], 0)\n    except Exception as e:\n          print('Error:',e)\n          is_digit = False\n          value = 0\n    finally:\n        return is_digit, value\n\ndef filter_out_safe_constants(str):\n    is_digit, value = get_digit_type_and_value(str)\n    if (is_digit):\n        if (value >= 0x100000000):\n            return True\n        else:\n            return False\n    else:\n        return True\n\ndef construct_warnings(suggested_fun):\n    msg=\"WARNING: do_div() does a 64-by-32 division, please consider using %s instead.\"\n    return  msg % suggested_fun\n\n@depends on context@\nexpression f;\nlong l: script:python() { filter_out_safe_constants(l) };\nunsigned long ul : script:python() { filter_out_safe_constants(ul) };\nu64 ul64 : script:python() { filter_out_safe_constants(ul64) };\ns64 sl64 : script:python() { filter_out_safe_constants(sl64) };\n\n@@\n(\n* do_div(f, l);\n|\n* do_div(f, ul);\n|\n* do_div(f, ul64);\n|\n* do_div(f, sl64);\n)\n\n@r depends on (org || report)@\nexpression f;\nposition p;\nlong l: script:python() { filter_out_safe_constants(l) };\nunsigned long ul : script:python() { filter_out_safe_constants(ul) };\nu64 ul64 : script:python() { filter_out_safe_constants(ul64) };\ns64 sl64 : script:python() { filter_out_safe_constants(sl64) };\n@@\n(\ndo_div@p(f, l);\n|\ndo_div@p(f, ul);\n|\ndo_div@p(f, ul64);\n|\ndo_div@p(f, sl64);\n)\n\n@script:python depends on org@\np << r.p;\nul << r.ul;\n@@\n\ncoccilib.org.print_todo(p[0], construct_warnings(\"div64_ul\"))\n\n@script:python depends on org@\np << r.p;\nl << r.l;\n@@\n\ncoccilib.org.print_todo(p[0], construct_warnings(\"div64_long\"))\n\n@script:python depends on org@\np << r.p;\nul64 << r.ul64;\n@@\n\ncoccilib.org.print_todo(p[0], construct_warnings(\"div64_u64\"))\n\n@script:python depends on org@\np << r.p;\nsl64 << r.sl64;\n@@\n\ncoccilib.org.print_todo(p[0], construct_warnings(\"div64_s64\"))\n\n@script:python depends on report@\np << r.p;\nul << r.ul;\n@@\n\ncoccilib.report.print_report(p[0], construct_warnings(\"div64_ul\"))\n\n@script:python depends on report@\np << r.p;\nl << r.l;\n@@\n\ncoccilib.report.print_report(p[0], construct_warnings(\"div64_long\"))\n\n@script:python depends on report@\np << r.p;\nsl64 << r.sl64;\n@@\n\ncoccilib.report.print_report(p[0], construct_warnings(\"div64_s64\"))\n\n@script:python depends on report@\np << r.p;\nul64 << r.ul64;\n@@\n\ncoccilib.report.print_report(p[0], construct_warnings(\"div64_u64\"))\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}