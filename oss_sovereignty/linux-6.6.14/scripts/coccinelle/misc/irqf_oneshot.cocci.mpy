{
  "module_name": "irqf_oneshot.cocci",
  "hash_id": "bf3fbf74c26ebc059dc5be48e3f81063f7babe17e9b2fca63479e331d7031a6a",
  "original_prompt": "Ingested from linux-6.6.14/scripts/coccinelle/misc/irqf_oneshot.cocci",
  "human_readable_source": "// SPDX-License-Identifier: GPL-2.0\n/// Since commit 1c6c69525b40 (\"genirq: Reject bogus threaded irq requests\")\n/// threaded IRQs without a primary handler need to be requested with\n/// IRQF_ONESHOT, otherwise the request will fail.\n///\n/// So pass the IRQF_ONESHOT flag in this case.\n///\n//\n// Confidence: Moderate\n// Comments:\n// Options: --no-includes\n\nvirtual patch\nvirtual context\nvirtual org\nvirtual report\n\n@r1@\nexpression dev, irq, thread_fn;\nposition p;\n@@\n(\nrequest_threaded_irq@p(irq, NULL, thread_fn,\n(\nIRQF_ONESHOT | ...\n|\nIRQF_ONESHOT\n)\n, ...)\n|\ndevm_request_threaded_irq@p(dev, irq, NULL, thread_fn,\n(\nIRQF_ONESHOT | ...\n|\nIRQF_ONESHOT\n)\n, ...)\n)\n\n@r2@\nexpression dev, irq, thread_fn, flags, e;\nposition p != r1.p;\n@@\n(\nflags = IRQF_ONESHOT | ...\n|\nflags |= IRQF_ONESHOT | ...\n)\n... when != flags = e\n(\nrequest_threaded_irq@p(irq, NULL, thread_fn, flags, ...);\n|\ndevm_request_threaded_irq@p(dev, irq, NULL, thread_fn, flags, ...);\n)\n\n@depends on patch@\nexpression dev, irq, thread_fn, flags;\nposition p != {r1.p,r2.p};\n@@\n(\nrequest_threaded_irq@p(irq, NULL, thread_fn,\n(\n-0\n+IRQF_ONESHOT\n|\n-flags\n+flags | IRQF_ONESHOT\n)\n, ...)\n|\ndevm_request_threaded_irq@p(dev, irq, NULL, thread_fn,\n(\n-0\n+IRQF_ONESHOT\n|\n-flags\n+flags | IRQF_ONESHOT\n)\n, ...)\n)\n\n@depends on context@\nexpression dev, irq;\nposition p != {r1.p,r2.p};\n@@\n(\n*request_threaded_irq@p(irq, NULL, ...)\n|\n*devm_request_threaded_irq@p(dev, irq, NULL, ...)\n)\n\n\n@match depends on report || org@\nexpression dev, irq;\nposition p != {r1.p,r2.p};\n@@\n(\nrequest_threaded_irq@p(irq, NULL, ...)\n|\ndevm_request_threaded_irq@p(dev, irq, NULL, ...)\n)\n\n@script:python depends on org@\np << match.p;\n@@\nmsg = \"WARNING: Threaded IRQ with no primary handler requested without IRQF_ONESHOT (unless it is nested IRQ)\"\ncoccilib.org.print_todo(p[0],msg)\n\n@script:python depends on report@\np << match.p;\n@@\nmsg = \"WARNING: Threaded IRQ with no primary handler requested without IRQF_ONESHOT (unless it is nested IRQ)\"\ncoccilib.report.print_report(p[0],msg)\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}