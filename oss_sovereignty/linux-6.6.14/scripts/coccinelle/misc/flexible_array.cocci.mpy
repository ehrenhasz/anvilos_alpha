{
  "module_name": "flexible_array.cocci",
  "hash_id": "a014696bd0ce5530398691ffc60533bf1d77369ed9f3e3758445fb24befe8f04",
  "original_prompt": "Ingested from linux-6.6.14/scripts/coccinelle/misc/flexible_array.cocci",
  "human_readable_source": "// SPDX-License-Identifier: GPL-2.0-only\n///\n/// Zero-length and one-element arrays are deprecated, see\n/// Documentation/process/deprecated.rst\n/// Flexible-array members should be used instead.\n///\n//\n// Confidence: High\n// Copyright: (C) 2020 Denis Efremov ISPRAS.\n// Comments:\n// Options: --no-includes --include-headers\n\nvirtual context\nvirtual report\nvirtual org\nvirtual patch\n\n@initialize:python@\n@@\ndef relevant(positions):\n    for p in positions:\n        if \"uapi\" in p.file:\n             return False\n    return True\n\n@r depends on !patch@\nidentifier name, array;\ntype T;\nposition p : script:python() { relevant(p) };\n@@\n\n(\n  struct name {\n    ...\n*   T array@p[\\(0\\|1\\)];\n  };\n|\n  struct {\n    ...\n*   T array@p[\\(0\\|1\\)];\n  };\n|\n  union name {\n    ...\n*   T array@p[\\(0\\|1\\)];\n  };\n|\n  union {\n    ...\n*   T array@p[\\(0\\|1\\)];\n  };\n)\n\n@only_field depends on patch@\nidentifier name, array;\ntype T;\nposition q;\n@@\n\n(\n  struct name {@q\n    T array[0];\n  };\n|\n  struct {@q\n    T array[0];\n  };\n)\n\n@depends on patch@\nidentifier name, array;\ntype T;\nposition p : script:python() { relevant(p) };\n// position @q with rule \"only_field\" simplifies\n// handling of bitfields, arrays, etc.\nposition q != only_field.q;\n@@\n\n(\n  struct name {@q\n    ...\n    T array@p[\n-       0\n    ];\n  };\n|\n  struct {@q\n    ...\n    T array@p[\n-       0\n    ];\n  };\n)\n\n@script: python depends on report@\np << r.p;\n@@\n\nmsg = \"WARNING use flexible-array member instead (https://www.kernel.org/doc/html/latest/process/deprecated.html#zero-length-and-one-element-arrays)\"\ncoccilib.report.print_report(p[0], msg)\n\n@script: python depends on org@\np << r.p;\n@@\n\nmsg = \"WARNING use flexible-array member instead (https://www.kernel.org/doc/html/latest/process/deprecated.html#zero-length-and-one-element-arrays)\"\ncoccilib.org.print_todo(p[0], msg)\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}