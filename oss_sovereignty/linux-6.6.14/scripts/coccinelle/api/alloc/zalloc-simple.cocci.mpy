{
  "module_name": "zalloc-simple.cocci",
  "hash_id": "6db71ad03aef7179a6c97389f76b7d71709aad7df9aa9115b561f5eb3f35700a",
  "original_prompt": "Ingested from linux-6.6.14/scripts/coccinelle/api/alloc/zalloc-simple.cocci",
  "human_readable_source": "// SPDX-License-Identifier: GPL-2.0-only\n///\n/// Use zeroing allocator rather than allocator followed by memset with 0\n///\n/// This considers some simple cases that are common and easy to validate\n/// Note in particular that there are no ...s in the rule, so all of the\n/// matched code has to be contiguous\n///\n// Confidence: High\n// Copyright: (C) 2009-2010 Julia Lawall, Nicolas Palix, DIKU.\n// Copyright: (C) 2009-2010 Gilles Muller, INRIA/LiP6.\n// Copyright: (C) 2017 Himanshu Jha\n// URL: https://coccinelle.gitlabpages.inria.fr/website\n// Options: --no-includes --include-headers\n//\n// Keywords: kmalloc, kzalloc\n// Version min: < 2.6.12 kmalloc\n// Version min:   2.6.14 kzalloc\n//\n\nvirtual context\nvirtual patch\nvirtual org\nvirtual report\n\n//----------------------------------------------------------\n//  For context mode\n//----------------------------------------------------------\n\n@depends on context@\ntype T, T2;\nexpression x;\nexpression E1;\nstatement S;\n@@\n\n* x = (T)\\(kmalloc(E1, ...)\\|vmalloc(E1)\\|dma_alloc_coherent(...,E1,...)\\|\n  kmalloc_node(E1, ...)\\|kmem_cache_alloc(...)\\|kmem_alloc(E1, ...)\\|\n  devm_kmalloc(...,E1,...)\\|kvmalloc(E1, ...)\\|kvmalloc_node(E1,...)\\);\n  if ((x==NULL) || ...) S\n* memset((T2)x,0,E1);\n\n//----------------------------------------------------------\n//  For patch mode\n//----------------------------------------------------------\n\n@depends on patch@\ntype T, T2;\nexpression x;\nexpression E1,E2,E3,E4;\nstatement S;\n@@\n\n(\n- x = kmalloc(E1,E2);\n+ x = kzalloc(E1,E2);\n|\n- x = (T *)kmalloc(E1,E2);\n+ x = kzalloc(E1,E2);\n|\n- x = (T)kmalloc(E1,E2);\n+ x = (T)kzalloc(E1,E2);\n|\n- x = vmalloc(E1);\n+ x = vzalloc(E1);\n|\n- x = (T *)vmalloc(E1);\n+ x = vzalloc(E1);\n|\n- x = (T)vmalloc(E1);\n+ x = (T)vzalloc(E1);\n|\n- x = kmalloc_node(E1,E2,E3);\n+ x = kzalloc_node(E1,E2,E3);\n|\n- x = (T *)kmalloc_node(E1,E2,E3);\n+ x = kzalloc_node(E1,E2,E3);\n|\n- x = (T)kmalloc_node(E1,E2,E3);\n+ x = (T)kzalloc_node(E1,E2,E3);\n|\n- x = kmem_cache_alloc(E3,E4);\n+ x = kmem_cache_zalloc(E3,E4);\n|\n- x = (T *)kmem_cache_alloc(E3,E4);\n+ x = kmem_cache_zalloc(E3,E4);\n|\n- x = (T)kmem_cache_alloc(E3,E4);\n+ x = (T)kmem_cache_zalloc(E3,E4);\n|\n- x = kmem_alloc(E1,E2);\n+ x = kmem_zalloc(E1,E2);\n|\n- x = (T *)kmem_alloc(E1,E2);\n+ x = kmem_zalloc(E1,E2);\n|\n- x = (T)kmem_alloc(E1,E2);\n+ x = (T)kmem_zalloc(E1,E2);\n|\n- x = devm_kmalloc(E2,E1,E3);\n+ x = devm_kzalloc(E2,E1,E3);\n|\n- x = (T *)devm_kmalloc(E2,E1,E3);\n+ x = devm_kzalloc(E2,E1,E3);\n|\n- x = (T)devm_kmalloc(E2,E1,E3);\n+ x = (T)devm_kzalloc(E2,E1,E3);\n|\n- x = kvmalloc(E1,E2);\n+ x = kvzalloc(E1,E2);\n|\n- x = (T *)kvmalloc(E1,E2);\n+ x = kvzalloc(E1,E2);\n|\n- x = (T)kvmalloc(E1,E2);\n+ x = (T)kvzalloc(E1,E2);\n|\n- x = kvmalloc_node(E1,E2,E3);\n+ x = kvzalloc_node(E1,E2,E3);\n|\n- x = (T *)kvmalloc_node(E1,E2,E3);\n+ x = kvzalloc_node(E1,E2,E3);\n|\n- x = (T)kvmalloc_node(E1,E2,E3);\n+ x = (T)kvzalloc_node(E1,E2,E3);\n)\n  if ((x==NULL) || ...) S\n- memset((T2)x,0,E1);\n\n@depends on patch@\ntype T, T2;\nexpression x;\nexpression E1,E2,E3,E4;\nstatement S;\n@@\n  x = (T)dma_alloc_coherent(E1, E2, E3, E4);\n  if ((x==NULL) || ...) S\n- memset((T2)x, 0, E2);\n\n//----------------------------------------------------------\n//  For org mode\n//----------------------------------------------------------\n\n@r depends on org || report@\ntype T, T2;\nexpression x;\nexpression E1,E2;\nstatement S;\nposition p;\n@@\n\n x = (T)kmalloc@p(E1,E2);\n if ((x==NULL) || ...) S\n memset((T2)x,0,E1);\n\n@script:python depends on org@\np << r.p;\nx << r.x;\n@@\n\nmsg=\"%s\" % (x)\nmsg_safe=msg.replace(\"[\",\"@(\").replace(\"]\",\")\")\ncoccilib.org.print_todo(p[0], msg_safe)\n\n@script:python depends on report@\np << r.p;\nx << r.x;\n@@\n\nmsg=\"WARNING: kzalloc should be used for %s, instead of kmalloc/memset\" % (x)\ncoccilib.report.print_report(p[0], msg)\n\n//-----------------------------------------------------------------\n@r1 depends on org || report@\ntype T, T2;\nexpression x;\nexpression E1;\nstatement S;\nposition p;\n@@\n\n x = (T)vmalloc@p(E1);\n if ((x==NULL) || ...) S\n memset((T2)x,0,E1);\n\n@script:python depends on org@\np << r1.p;\nx << r1.x;\n@@\n\nmsg=\"%s\" % (x)\nmsg_safe=msg.replace(\"[\",\"@(\").replace(\"]\",\")\")\ncoccilib.org.print_todo(p[0], msg_safe)\n\n@script:python depends on report@\np << r1.p;\nx << r1.x;\n@@\n\nmsg=\"WARNING: vzalloc should be used for %s, instead of vmalloc/memset\" % (x)\ncoccilib.report.print_report(p[0], msg)\n\n//-----------------------------------------------------------------\n@r2 depends on org || report@\ntype T, T2;\nexpression x;\nexpression E1,E2,E3,E4;\nstatement S;\nposition p;\n@@\n\n x = (T)dma_alloc_coherent@p(E1,E2,E3,E4);\n if ((x==NULL) || ...) S\n memset((T2)x,0,E2);\n\n@script:python depends on org@\np << r2.p;\nx << r2.x;\n@@\n\nmsg=\"%s\" % (x)\nmsg_safe=msg.replace(\"[\",\"@(\").replace(\"]\",\")\")\ncoccilib.org.print_todo(p[0], msg_safe)\n\n@script:python depends on report@\np << r2.p;\nx << r2.x;\n@@\n\nmsg=\"WARNING: dma_alloc_coherent used in %s already zeroes out memory, so memset is not needed\" % (x)\ncoccilib.report.print_report(p[0], msg)\n\n//-----------------------------------------------------------------\n@r3 depends on org || report@\ntype T, T2;\nexpression x;\nexpression E1,E2,E3;\nstatement S;\nposition p;\n@@\n\n x = (T)kmalloc_node@p(E1,E2,E3);\n if ((x==NULL) || ...) S\n memset((T2)x,0,E1);\n\n@script:python depends on org@\np << r3.p;\nx << r3.x;\n@@\n\nmsg=\"%s\" % (x)\nmsg_safe=msg.replace(\"[\",\"@(\").replace(\"]\",\")\")\ncoccilib.org.print_todo(p[0], msg_safe)\n\n@script:python depends on report@\np << r3.p;\nx << r3.x;\n@@\n\nmsg=\"WARNING: kzalloc_node should be used for %s, instead of kmalloc_node/memset\" % (x)\ncoccilib.report.print_report(p[0], msg)\n\n//-----------------------------------------------------------------\n@r4 depends on org || report@\ntype T, T2;\nexpression x;\nexpression E1,E2,E3;\nstatement S;\nposition p;\n@@\n\n x = (T)kmem_cache_alloc@p(E2,E3);\n if ((x==NULL) || ...) S\n memset((T2)x,0,E1);\n\n@script:python depends on org@\np << r4.p;\nx << r4.x;\n@@\n\nmsg=\"%s\" % (x)\nmsg_safe=msg.replace(\"[\",\"@(\").replace(\"]\",\")\")\ncoccilib.org.print_todo(p[0], msg_safe)\n\n@script:python depends on report@\np << r4.p;\nx << r4.x;\n@@\n\nmsg=\"WARNING: kmem_cache_zalloc should be used for %s, instead of kmem_cache_alloc/memset\" % (x)\ncoccilib.report.print_report(p[0], msg)\n\n//-----------------------------------------------------------------\n@r5 depends on org || report@\ntype T, T2;\nexpression x;\nexpression E1,E2;\nstatement S;\nposition p;\n@@\n\n x = (T)kmem_alloc@p(E1,E2);\n if ((x==NULL) || ...) S\n memset((T2)x,0,E1);\n\n@script:python depends on org@\np << r5.p;\nx << r5.x;\n@@\n\nmsg=\"%s\" % (x)\nmsg_safe=msg.replace(\"[\",\"@(\").replace(\"]\",\")\")\ncoccilib.org.print_todo(p[0], msg_safe)\n\n@script:python depends on report@\np << r5.p;\nx << r5.x;\n@@\n\nmsg=\"WARNING: kmem_zalloc should be used for %s, instead of kmem_alloc/memset\" % (x)\ncoccilib.report.print_report(p[0], msg)\n\n//-----------------------------------------------------------------\n@r6 depends on org || report@\ntype T, T2;\nexpression x;\nexpression E1,E2,E3;\nstatement S;\nposition p;\n@@\n\n x = (T)devm_kmalloc@p(E2,E1,E3);\n if ((x==NULL) || ...) S\n memset((T2)x,0,E1);\n\n@script:python depends on org@\np << r6.p;\nx << r6.x;\n@@\n\nmsg=\"%s\" % (x)\nmsg_safe=msg.replace(\"[\",\"@(\").replace(\"]\",\")\")\ncoccilib.org.print_todo(p[0], msg_safe)\n\n@script:python depends on report@\np << r6.p;\nx << r6.x;\n@@\n\nmsg=\"WARNING: devm_kzalloc should be used for %s, instead of devm_kmalloc/memset\" % (x)\ncoccilib.report.print_report(p[0], msg)\n\n//-----------------------------------------------------------------\n@r7 depends on org || report@\ntype T, T2;\nexpression x;\nexpression E1,E2;\nstatement S;\nposition p;\n@@\n\n x = (T)kvmalloc@p(E1,E2);\n if ((x==NULL) || ...) S\n memset((T2)x,0,E1);\n\n@script:python depends on org@\np << r7.p;\nx << r7.x;\n@@\n\nmsg=\"%s\" % (x)\nmsg_safe=msg.replace(\"[\",\"@(\").replace(\"]\",\")\")\ncoccilib.org.print_todo(p[0], msg_safe)\n\n@script:python depends on report@\np << r7.p;\nx << r7.x;\n@@\n\nmsg=\"WARNING: kvzalloc should be used for %s, instead of kvmalloc/memset\" % (x)\ncoccilib.report.print_report(p[0], msg)\n\n//-----------------------------------------------------------------\n@r9 depends on org || report@\ntype T, T2;\nexpression x;\nexpression E1,E2,E3;\nstatement S;\nposition p;\n@@\n\n x = (T)kvmalloc_node@p(E1,E2,E3);\n if ((x==NULL) || ...) S\n memset((T2)x,0,E1);\n\n@script:python depends on org@\np << r9.p;\nx << r9.x;\n@@\n\nmsg=\"%s\" % (x)\nmsg_safe=msg.replace(\"[\",\"@(\").replace(\"]\",\")\")\ncoccilib.org.print_todo(p[0], msg_safe)\n\n@script:python depends on report@\np << r9.p;\nx << r9.x;\n@@\n\nmsg=\"WARNING: kvzalloc_node should be used for %s, instead of kvmalloc_node/memset\" % (x)\ncoccilib.report.print_report(p[0], msg)\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}