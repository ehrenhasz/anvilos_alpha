{
  "module_name": "atomic_as_refcounter.cocci",
  "hash_id": "441f1fed70fad68c5674a96c7d4fd1d5e4f3b2367f8e61be53c2783dfc658477",
  "original_prompt": "Ingested from linux-6.6.14/scripts/coccinelle/api/atomic_as_refcounter.cocci",
  "human_readable_source": "// SPDX-License-Identifier: GPL-2.0-only\n// Check if refcount_t type and API should be used\n// instead of atomic_t type when dealing with refcounters\n//\n// Copyright (c) 2016-2017, Elena Reshetova, Intel Corporation\n//\n// Confidence: Moderate\n// URL: https://coccinelle.gitlabpages.inria.fr/website\n// Options: --include-headers --very-quiet\n\nvirtual report\n\n@r1 exists@\nidentifier a, x;\nposition p1, p2;\nidentifier fname =~ \".*free.*\";\nidentifier fname2 =~ \".*destroy.*\";\nidentifier fname3 =~ \".*del.*\";\nidentifier fname4 =~ \".*queue_work.*\";\nidentifier fname5 =~ \".*schedule_work.*\";\nidentifier fname6 =~ \".*call_rcu.*\";\n\n@@\n\n(\n atomic_dec_and_test@p1(&(a)->x)\n|\n atomic_dec_and_lock@p1(&(a)->x, ...)\n|\n atomic_long_dec_and_lock@p1(&(a)->x, ...)\n|\n atomic_long_dec_and_test@p1(&(a)->x)\n|\n atomic64_dec_and_test@p1(&(a)->x)\n|\n local_dec_and_test@p1(&(a)->x)\n)\n...\n(\n fname@p2(a, ...);\n|\n fname2@p2(...);\n|\n fname3@p2(...);\n|\n fname4@p2(...);\n|\n fname5@p2(...);\n|\n fname6@p2(...);\n)\n\n\n@script:python depends on report@\np1 << r1.p1;\np2 << r1.p2;\n@@\nmsg = \"WARNING: atomic_dec_and_test variation before object free at line %s.\"\ncoccilib.report.print_report(p1[0], msg % (p2[0].line))\n\n@r4 exists@\nidentifier a, x, y;\nposition p1, p2;\nidentifier fname =~ \".*free.*\";\n\n@@\n\n(\n atomic_dec_and_test@p1(&(a)->x)\n|\n atomic_dec_and_lock@p1(&(a)->x, ...)\n|\n atomic_long_dec_and_lock@p1(&(a)->x, ...)\n|\n atomic_long_dec_and_test@p1(&(a)->x)\n|\n atomic64_dec_and_test@p1(&(a)->x)\n|\n local_dec_and_test@p1(&(a)->x)\n)\n...\ny=a\n...\nfname@p2(y, ...);\n\n\n@script:python depends on report@\np1 << r4.p1;\np2 << r4.p2;\n@@\nmsg = \"WARNING: atomic_dec_and_test variation before object free at line %s.\"\ncoccilib.report.print_report(p1[0], msg % (p2[0].line))\n\n@r2 exists@\nidentifier a, x;\nposition p1;\n@@\n\n(\natomic_add_unless(&(a)->x,-1,1)@p1\n|\natomic_long_add_unless(&(a)->x,-1,1)@p1\n|\natomic64_add_unless(&(a)->x,-1,1)@p1\n)\n\n@script:python depends on report@\np1 << r2.p1;\n@@\nmsg = \"WARNING: atomic_add_unless\"\ncoccilib.report.print_report(p1[0], msg)\n\n@r3 exists@\nidentifier x;\nposition p1;\n@@\n\n(\nx = atomic_add_return@p1(-1, ...);\n|\nx = atomic_long_add_return@p1(-1, ...);\n|\nx = atomic64_add_return@p1(-1, ...);\n)\n\n@script:python depends on report@\np1 << r3.p1;\n@@\nmsg = \"WARNING: x = atomic_add_return(-1, ...)\"\ncoccilib.report.print_report(p1[0], msg)\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}