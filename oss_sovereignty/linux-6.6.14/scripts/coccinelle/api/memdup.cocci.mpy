{
  "module_name": "memdup.cocci",
  "hash_id": "c01485f889416c859515004097d016f4bbbfe0d97112fbc2cbc37466e7f5b1b8",
  "original_prompt": "Ingested from linux-6.6.14/scripts/coccinelle/api/memdup.cocci",
  "human_readable_source": "// SPDX-License-Identifier: GPL-2.0-only\n/// Use kmemdup rather than duplicating its implementation\n///\n// Confidence: High\n// Copyright: (C) 2010-2012 Nicolas Palix.\n// Copyright: (C) 2010-2012 Julia Lawall, INRIA/LIP6.\n// Copyright: (C) 2010-2012 Gilles Muller, INRIA/LiP6.\n// URL: https://coccinelle.gitlabpages.inria.fr/website\n// Comments:\n// Options: --no-includes --include-headers\n\nvirtual patch\nvirtual context\nvirtual org\nvirtual report\n\n@r1@\nexpression from,to;\nexpression flag;\nposition p;\n@@\n\n   to = \\(kmalloc@p\\|kzalloc@p\\)(strlen(from) + 1,flag);\n\n@r2@\nexpression x,from,to;\nexpression flag,E1;\nposition p;\n@@\n\n    x = strlen(from) + 1;\n    ... when != \\( x = E1 \\| from = E1 \\)\n    to = \\(kmalloc@p\\|kzalloc@p\\)(x,flag);\n\n@depends on patch@\nexpression from,to,size,flag;\nposition p != {r1.p,r2.p};\nstatement S;\n@@\n\n-  to = \\(kmalloc@p\\|kzalloc@p\\)(size,flag);\n+  to = kmemdup(from,size,flag);\n   if (to==NULL || ...) S\n-  memcpy(to, from, size);\n\n@r depends on !patch@\nexpression from,to,size,flag;\nposition p != {r1.p,r2.p};\nstatement S;\n@@\n\n*  to = \\(kmalloc@p\\|kzalloc@p\\)(size,flag);\n   if (to==NULL || ...) S\n*  memcpy(to, from, size);\n\n@script:python depends on org@\np << r.p;\n@@\n\ncoccilib.org.print_todo(p[0], \"WARNING opportunity for kmemdup\")\n\n@script:python depends on report@\np << r.p;\n@@\n\ncoccilib.report.print_report(p[0], \"WARNING opportunity for kmemdup\")\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}