{
  "module_name": "kfree_sensitive.cocci",
  "hash_id": "409757ff6eecbfa5e6c149218b168116634569098d4908117c3494c60608cff4",
  "original_prompt": "Ingested from linux-6.6.14/scripts/coccinelle/api/kfree_sensitive.cocci",
  "human_readable_source": "// SPDX-License-Identifier: GPL-2.0-only\n///\n/// Use kfree_sensitive, kvfree_sensitive rather than memset or\n/// memzero_explicit followed by kfree.\n///\n// Confidence: High\n// Copyright: (C) 2020 Denis Efremov ISPRAS\n// Options: --no-includes --include-headers\n//\n// Keywords: kfree_sensitive, kvfree_sensitive\n//\n\nvirtual context\nvirtual patch\nvirtual org\nvirtual report\n\n@initialize:python@\n@@\n# kmalloc_oob_in_memset uses memset to explicitly trigger out-of-bounds access\nfilter = frozenset(['kmalloc_oob_in_memset',\n\t\t    'kfree_sensitive', 'kvfree_sensitive'])\n\ndef relevant(p):\n    return not (filter & {el.current_element for el in p})\n\n@cond@\nposition ok;\n@@\n\nif (...)\n  \\(memset@ok\\|memzero_explicit@ok\\)(...);\n\n@r depends on !patch forall@\nexpression E;\nposition p : script:python() { relevant(p) };\nposition m != cond.ok;\ntype T;\n@@\n\n(\n* memset@m((T)E, 0, ...);\n|\n* memzero_explicit@m((T)E, ...);\n)\n  ... when != E\n      when strict\n* \\(kfree\\|vfree\\|kvfree\\)(E)@p;\n\n@rp_memzero depends on patch@\nexpression E, size;\nposition p : script:python() { relevant(p) };\nposition m != cond.ok;\ntype T;\n@@\n\n- memzero_explicit@m((T)E, size);\n  ... when != E\n      when strict\n(\n- kfree(E)@p;\n+ kfree_sensitive(E);\n|\n- \\(vfree\\|kvfree\\)(E)@p;\n+ kvfree_sensitive(E, size);\n)\n\n@rp_memset depends on patch@\nexpression E, size;\nposition p : script:python() { relevant(p) };\nposition m != cond.ok;\ntype T;\n@@\n\n- memset@m((T)E, 0, size);\n  ... when != E\n      when strict\n(\n- kfree(E)@p;\n+ kfree_sensitive(E);\n|\n- \\(vfree\\|kvfree\\)(E)@p;\n+ kvfree_sensitive(E, size);\n)\n\n@script:python depends on report@\np << r.p;\nm << r.m;\n@@\n\nmsg = \"WARNING opportunity for kfree_sensitive/kvfree_sensitive (memset at line %s)\"\ncoccilib.report.print_report(p[0], msg % (m[0].line))\n\n@script:python depends on org@\np << r.p;\nm << r.m;\n@@\n\nmsg = \"WARNING opportunity for kfree_sensitive/kvfree_sensitive (memset at line %s)\"\ncoccilib.org.print_todo(p[0], msg % (m[0].line))\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}