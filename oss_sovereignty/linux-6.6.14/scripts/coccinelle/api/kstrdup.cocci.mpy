{
  "module_name": "kstrdup.cocci",
  "hash_id": "cc64aef22ccbc0c11d836547a5c8e9c757f8e6e28616734fc97afce3ce922199",
  "original_prompt": "Ingested from linux-6.6.14/scripts/coccinelle/api/kstrdup.cocci",
  "human_readable_source": "// SPDX-License-Identifier: GPL-2.0-only\n/// Use kstrdup rather than duplicating its implementation\n///\n// Confidence: High\n// Copyright: (C) 2010-2012 Nicolas Palix.\n// Copyright: (C) 2010-2012 Julia Lawall, INRIA/LIP6.\n// Copyright: (C) 2010-2012 Gilles Muller, INRIA/LiP6.\n// URL: https://coccinelle.gitlabpages.inria.fr/website\n// Comments:\n// Options: --no-includes --include-headers\n\nvirtual patch\nvirtual context\nvirtual org\nvirtual report\n\n@depends on patch@\nexpression from,to;\nexpression flag,E1,E2;\nstatement S;\n@@\n\n-  to = kmalloc(strlen(from) + 1,flag);\n+  to = kstrdup(from, flag);\n   ... when != \\(from = E1 \\| to = E1 \\)\n   if (to==NULL || ...) S\n   ... when != \\(from = E2 \\| to = E2 \\)\n-  strcpy(to, from);\n\n@depends on patch@\nexpression x,from,to;\nexpression flag,E1,E2,E3;\nstatement S;\n@@\n\n-   x = strlen(from) + 1;\n    ... when != \\( x = E1 \\| from = E1 \\)\n-   to = \\(kmalloc\\|kzalloc\\)(x,flag);\n+   to = kstrdup(from, flag);\n    ... when != \\(x = E2 \\| from = E2 \\| to = E2 \\)\n    if (to==NULL || ...) S\n    ... when != \\(x = E3 \\| from = E3 \\| to = E3 \\)\n-   memcpy(to, from, x);\n\n// ---------------------------------------------------------------------\n\n@r1 depends on !patch exists@\nexpression from,to;\nexpression flag,E1,E2;\nstatement S;\nposition p1,p2;\n@@\n\n*  to = kmalloc@p1(strlen(from) + 1,flag);\n   ... when != \\(from = E1 \\| to = E1 \\)\n   if (to==NULL || ...) S\n   ... when != \\(from = E2 \\| to = E2 \\)\n*  strcpy@p2(to, from);\n\n@r2 depends on !patch exists@\nexpression x,from,to;\nexpression flag,E1,E2,E3;\nstatement S;\nposition p1,p2;\n@@\n\n*   x = strlen(from) + 1;\n    ... when != \\( x = E1 \\| from = E1 \\)\n*   to = \\(kmalloc@p1\\|kzalloc@p1\\)(x,flag);\n    ... when != \\(x = E2 \\| from = E2 \\| to = E2 \\)\n    if (to==NULL || ...) S\n    ... when != \\(x = E3 \\| from = E3 \\| to = E3 \\)\n*   memcpy@p2(to, from, x);\n\n@script:python depends on org@\np1 << r1.p1;\np2 << r1.p2;\n@@\n\ncocci.print_main(\"WARNING opportunity for kstrdup\",p1)\ncocci.print_secs(\"strcpy\",p2)\n\n@script:python depends on org@\np1 << r2.p1;\np2 << r2.p2;\n@@\n\ncocci.print_main(\"WARNING opportunity for kstrdup\",p1)\ncocci.print_secs(\"memcpy\",p2)\n\n@script:python depends on report@\np1 << r1.p1;\np2 << r1.p2;\n@@\n\nmsg = \"WARNING opportunity for kstrdup (strcpy on line %s)\" % (p2[0].line)\ncoccilib.report.print_report(p1[0], msg)\n\n@script:python depends on report@\np1 << r2.p1;\np2 << r2.p2;\n@@\n\nmsg = \"WARNING opportunity for kstrdup (memcpy on line %s)\" % (p2[0].line)\ncoccilib.report.print_report(p1[0], msg)\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}