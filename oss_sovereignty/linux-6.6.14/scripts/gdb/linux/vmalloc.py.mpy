{
  "module_name": "vmalloc.py",
  "hash_id": "1950d1852dd4427cf2c4b87b91f9745f8b8618efce9fdef282fd45f8a43bfa0e",
  "original_prompt": "Ingested from linux-6.6.14/scripts/gdb/linux/vmalloc.py",
  "human_readable_source": "# SPDX-License-Identifier: GPL-2.0\n#\n# Copyright (c) 2023 MediaTek Inc.\n#\n# Authors:\n#  Kuan-Ying Lee <Kuan-Ying.Lee@mediatek.com>\n#\n\nimport gdb\nimport re\nfrom linux import lists, utils, stackdepot, constants, mm\n\nif constants.LX_CONFIG_MMU:\n    vmap_area_type = utils.CachedType('struct vmap_area')\n    vmap_area_ptr_type = vmap_area_type.get_type().pointer()\n\ndef is_vmalloc_addr(x):\n    pg_ops = mm.page_ops().ops\n    addr = pg_ops.kasan_reset_tag(x)\n    return addr >= pg_ops.VMALLOC_START and addr < pg_ops.VMALLOC_END\n\nclass LxVmallocInfo(gdb.Command):\n    \"\"\"Show vmallocinfo\"\"\"\n\n    def __init__(self):\n        super(LxVmallocInfo, self).__init__(\"lx-vmallocinfo\", gdb.COMMAND_DATA)\n\n    def invoke(self, arg, from_tty):\n        if not constants.LX_CONFIG_MMU:\n            raise gdb.GdbError(\"Requires MMU support\")\n\n        vmap_area_list = gdb.parse_and_eval('vmap_area_list')\n        for vmap_area in lists.list_for_each_entry(vmap_area_list, vmap_area_ptr_type, \"list\"):\n            if not vmap_area['vm']:\n                gdb.write(\"0x%x-0x%x %10d vm_map_ram\\n\" % (vmap_area['va_start'], vmap_area['va_end'],\n                    vmap_area['va_end'] - vmap_area['va_start']))\n                continue\n            v = vmap_area['vm']\n            gdb.write(\"0x%x-0x%x %10d\" % (v['addr'], v['addr'] + v['size'], v['size']))\n            if v['caller']:\n                gdb.write(\" %s\" % str(v['caller']).split(' ')[-1])\n            if v['nr_pages']:\n                gdb.write(\" pages=%d\" % v['nr_pages'])\n            if v['phys_addr']:\n                gdb.write(\" phys=0x%x\" % v['phys_addr'])\n            if v['flags'] & constants.LX_VM_IOREMAP:\n                gdb.write(\" ioremap\")\n            if v['flags'] & constants.LX_VM_ALLOC:\n                gdb.write(\" vmalloc\")\n            if v['flags'] & constants.LX_VM_MAP:\n                gdb.write(\" vmap\")\n            if v['flags'] & constants.LX_VM_USERMAP:\n                gdb.write(\" user\")\n            if v['flags'] & constants.LX_VM_DMA_COHERENT:\n                gdb.write(\" dma-coherent\")\n            if is_vmalloc_addr(v['pages']):\n                gdb.write(\" vpages\")\n            gdb.write(\"\\n\")\n\nLxVmallocInfo()\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}