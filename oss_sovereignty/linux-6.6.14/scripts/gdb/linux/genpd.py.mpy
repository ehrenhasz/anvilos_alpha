{
  "module_name": "genpd.py",
  "hash_id": "c75fcb78ca055b8e9c68fd70e43ad336eca4bd67ff49209f82ce733b57ea3e50",
  "original_prompt": "Ingested from linux-6.6.14/scripts/gdb/linux/genpd.py",
  "human_readable_source": "# SPDX-License-Identifier: GPL-2.0\n#\n# Copyright (c) NXP 2019\n\nimport gdb\nimport sys\n\nfrom linux.utils import CachedType, gdb_eval_or_none\nfrom linux.lists import list_for_each_entry\n\ngeneric_pm_domain_type = CachedType('struct generic_pm_domain')\npm_domain_data_type = CachedType('struct pm_domain_data')\ndevice_link_type = CachedType('struct device_link')\n\n\ndef kobject_get_path(kobj):\n    path = kobj['name'].string()\n    parent = kobj['parent']\n    if parent:\n        path = kobject_get_path(parent) + '/' + path\n    return path\n\n\ndef rtpm_status_str(dev):\n    if dev['power']['runtime_error']:\n        return 'error'\n    if dev['power']['disable_depth']:\n        return 'unsupported'\n    _RPM_STATUS_LOOKUP = [\n        \"active\",\n        \"resuming\",\n        \"suspended\",\n        \"suspending\"\n    ]\n    return _RPM_STATUS_LOOKUP[dev['power']['runtime_status']]\n\n\nclass LxGenPDSummary(gdb.Command):\n    '''Print genpd summary\n\nOutput is similar to /sys/kernel/debug/pm_genpd/pm_genpd_summary'''\n\n    def __init__(self):\n        super(LxGenPDSummary, self).__init__('lx-genpd-summary', gdb.COMMAND_DATA)\n\n    def summary_one(self, genpd):\n        if genpd['status'] == 0:\n            status_string = 'on'\n        else:\n            status_string = 'off-{}'.format(genpd['state_idx'])\n\n        child_names = []\n        for link in list_for_each_entry(\n                genpd['parent_links'],\n                device_link_type.get_type().pointer(),\n                'parent_node'):\n            child_names.append(link['child']['name'])\n\n        gdb.write('%-30s  %-15s %s\\n' % (\n                genpd['name'].string(),\n                status_string,\n                ', '.join(child_names)))\n\n        # Print devices in domain\n        for pm_data in list_for_each_entry(genpd['dev_list'],\n                        pm_domain_data_type.get_type().pointer(),\n                        'list_node'):\n            dev = pm_data['dev']\n            kobj_path = kobject_get_path(dev['kobj'])\n            gdb.write('    %-50s  %s\\n' % (kobj_path, rtpm_status_str(dev)))\n\n    def invoke(self, arg, from_tty):\n        if gdb_eval_or_none(\"&gpd_list\") is None:\n            raise gdb.GdbError(\"No power domain(s) registered\")\n        gdb.write('domain                          status          children\\n');\n        gdb.write('    /device                                             runtime status\\n');\n        gdb.write('----------------------------------------------------------------------\\n');\n        for genpd in list_for_each_entry(\n                gdb.parse_and_eval('&gpd_list'),\n                generic_pm_domain_type.get_type().pointer(),\n                'gpd_list_node'):\n            self.summary_one(genpd)\n\n\nLxGenPDSummary()\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}