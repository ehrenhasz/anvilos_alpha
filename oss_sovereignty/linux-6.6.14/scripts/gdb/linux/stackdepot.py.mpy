{
  "module_name": "stackdepot.py",
  "hash_id": "60d38a24c6c754ab3735e60f30277b44da3afcfbd29a9051b0f8158209f1301f",
  "original_prompt": "Ingested from linux-6.6.14/scripts/gdb/linux/stackdepot.py",
  "human_readable_source": "# SPDX-License-Identifier: GPL-2.0\n#\n# Copyright (c) 2023 MediaTek Inc.\n#\n# Authors:\n#  Kuan-Ying Lee <Kuan-Ying.Lee@mediatek.com>\n#\n\nimport gdb\nfrom linux import utils, constants\n\nif constants.LX_CONFIG_STACKDEPOT:\n    stack_record_type = utils.CachedType('struct stack_record')\n    DEPOT_STACK_ALIGN = 4\n\ndef stack_depot_fetch(handle):\n    global DEPOT_STACK_ALIGN\n    global stack_record_type\n\n    stack_depot_disabled = gdb.parse_and_eval('stack_depot_disabled')\n\n    if stack_depot_disabled:\n        raise gdb.GdbError(\"stack_depot_disabled\\n\")\n\n    handle_parts_t = gdb.lookup_type(\"union handle_parts\")\n    parts = handle.cast(handle_parts_t)\n    offset = parts['offset'] << DEPOT_STACK_ALIGN\n    pool_index_cached = gdb.parse_and_eval('pool_index')\n\n    if parts['pool_index'] > pool_index_cached:\n        gdb.write(\"pool index %d out of bounds (%d) for stack id 0x%08x\\n\" % (parts['pool_index'], pool_index_cached, handle))\n        return gdb.Value(0), 0\n\n    stack_pools = gdb.parse_and_eval('stack_pools')\n\n    try:\n        pool = stack_pools[parts['pool_index']]\n        stack = (pool + gdb.Value(offset).cast(utils.get_size_t_type())).cast(stack_record_type.get_type().pointer())\n        size = int(stack['size'].cast(utils.get_ulong_type()))\n        return stack['entries'], size\n    except Exception as e:\n        gdb.write(\"%s\\n\" % e)\n        return gdb.Value(0), 0\n\ndef stack_depot_print(handle):\n    if not constants.LX_CONFIG_STACKDEPOT:\n        raise gdb.GdbError(\"CONFIG_STACKDEPOT is not enabled\")\n\n    entries, nr_entries = stack_depot_fetch(handle)\n    if nr_entries > 0:\n        for i in range(0, nr_entries):\n            try:\n                gdb.execute(\"x /i 0x%x\" % (int(entries[i])))\n            except Exception as e:\n                gdb.write(\"%s\\n\" % e)\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}