{
  "module_name": "Makefile.headersinst",
  "hash_id": "a763f07b49b50df48fd47440dd64868874774edba92914ea5fb4fae002564b37",
  "original_prompt": "Ingested from linux-6.6.14/scripts/Makefile.headersinst",
  "human_readable_source": "# SPDX-License-Identifier: GPL-2.0\n# ==========================================================================\n# Installing headers\n#\n# All headers under include/uapi, include/generated/uapi,\n# arch/<arch>/include/uapi and arch/<arch>/include/generated/uapi are\n# exported.\n# They are preprocessed to remove __KERNEL__ section of the file.\n#\n# ==========================================================================\n\nPHONY := __headers\n__headers:\n\ninclude $(srctree)/scripts/Kbuild.include\n\nsrc := $(srctree)/$(obj)\ngen := $(objtree)/$(subst include/,include/generated/,$(obj))\ndst := usr/include\n\n-include $(src)/Kbuild\n\n# $(filter %/, ...) is a workaround for GNU Make <= 4.2.1, where\n# $(wildcard $(src)/*/) contains not only directories but also regular files.\nsrc-subdirs := $(patsubst $(src)/%/,%,$(filter %/, $(wildcard $(src)/*/)))\ngen-subdirs := $(patsubst $(gen)/%/,%,$(filter %/, $(wildcard $(gen)/*/)))\nall-subdirs := $(sort $(src-subdirs) $(gen-subdirs))\n\nsrc-headers := $(if $(src-subdirs), $(shell cd $(src) && find $(src-subdirs) -name '*.h'))\nsrc-headers := $(filter-out $(no-export-headers), $(src-headers))\ngen-headers := $(if $(gen-subdirs), $(shell cd $(gen) && find $(gen-subdirs) -name '*.h'))\ngen-headers := $(filter-out $(no-export-headers), $(gen-headers))\n\n# If the same header is exported from source and generated directories,\n# the former takes precedence, but this should be warned.\nduplicated := $(filter $(gen-headers), $(src-headers))\n$(if $(duplicated), $(warning duplicated header export: $(duplicated)))\n\ngen-headers := $(filter-out $(duplicated), $(gen-headers))\n\n# Add dst path prefix\nall-subdirs := $(addprefix $(dst)/, $(all-subdirs))\nsrc-headers := $(addprefix $(dst)/, $(src-headers))\ngen-headers := $(addprefix $(dst)/, $(gen-headers))\nall-headers := $(src-headers) $(gen-headers)\n\n# Work out what needs to be removed\nold-subdirs := $(wildcard $(all-subdirs))\nold-headers := $(if $(old-subdirs),$(shell find $(old-subdirs) -name '*.h'))\nunwanted    := $(filter-out $(all-headers), $(old-headers))\n\n# Create directories\nexisting-dirs := $(sort $(dir $(old-headers)))\nwanted-dirs   := $(sort $(dir $(all-headers)))\nnew-dirs      := $(filter-out $(existing-dirs), $(wanted-dirs))\n$(if $(new-dirs), $(shell mkdir -p $(new-dirs)))\n\n# Rules\nquiet_cmd_install = HDRINST $@\n      cmd_install = $(CONFIG_SHELL) $(srctree)/scripts/headers_install.sh $< $@\n\n$(src-headers): $(dst)/%.h: $(src)/%.h $(srctree)/scripts/headers_install.sh FORCE\n\t$(call if_changed,install)\n\n$(gen-headers): $(dst)/%.h: $(gen)/%.h $(srctree)/scripts/headers_install.sh FORCE\n\t$(call if_changed,install)\n\nquiet_cmd_remove = REMOVE  $(unwanted)\n      cmd_remove = rm -f $(unwanted)\n\n__headers: $(all-headers)\nifneq ($(unwanted),)\n\t$(call cmd,remove)\nendif\n\t@:\n\nexisting-headers := $(filter $(old-headers), $(all-headers))\n\n-include $(foreach f,$(existing-headers),$(dir $(f)).$(notdir $(f)).cmd)\n\nPHONY += FORCE\nFORCE:\n\n.PHONY: $(PHONY)\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}