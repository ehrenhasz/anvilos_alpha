{
  "module_name": "fdt_addresses.c",
  "hash_id": "2e692c7598bc52c5c391be58a719e6d90e20850078673f0d1c828708205a3d72",
  "original_prompt": "Ingested from linux-6.6.14/scripts/dtc/libfdt/fdt_addresses.c",
  "human_readable_source": "\n \n#include \"libfdt_env.h\"\n\n#include <fdt.h>\n#include <libfdt.h>\n\n#include \"libfdt_internal.h\"\n\nstatic int fdt_cells(const void *fdt, int nodeoffset, const char *name)\n{\n\tconst fdt32_t *c;\n\tuint32_t val;\n\tint len;\n\n\tc = fdt_getprop(fdt, nodeoffset, name, &len);\n\tif (!c)\n\t\treturn len;\n\n\tif (len != sizeof(*c))\n\t\treturn -FDT_ERR_BADNCELLS;\n\n\tval = fdt32_to_cpu(*c);\n\tif (val > FDT_MAX_NCELLS)\n\t\treturn -FDT_ERR_BADNCELLS;\n\n\treturn (int)val;\n}\n\nint fdt_address_cells(const void *fdt, int nodeoffset)\n{\n\tint val;\n\n\tval = fdt_cells(fdt, nodeoffset, \"#address-cells\");\n\tif (val == 0)\n\t\treturn -FDT_ERR_BADNCELLS;\n\tif (val == -FDT_ERR_NOTFOUND)\n\t\treturn 2;\n\treturn val;\n}\n\nint fdt_size_cells(const void *fdt, int nodeoffset)\n{\n\tint val;\n\n\tval = fdt_cells(fdt, nodeoffset, \"#size-cells\");\n\tif (val == -FDT_ERR_NOTFOUND)\n\t\treturn 1;\n\treturn val;\n}\n\n \nint fdt_appendprop_addrrange(void *fdt, int parent, int nodeoffset,\n\t\t\t     const char *name, uint64_t addr, uint64_t size)\n{\n\tint addr_cells, size_cells, ret;\n\tuint8_t data[sizeof(fdt64_t) * 2], *prop;\n\n\tret = fdt_address_cells(fdt, parent);\n\tif (ret < 0)\n\t\treturn ret;\n\taddr_cells = ret;\n\n\tret = fdt_size_cells(fdt, parent);\n\tif (ret < 0)\n\t\treturn ret;\n\tsize_cells = ret;\n\n\t \n\tprop = data;\n\tif (addr_cells == 1) {\n\t\tif ((addr > UINT32_MAX) || (((uint64_t) UINT32_MAX + 1 - addr) < size))\n\t\t\treturn -FDT_ERR_BADVALUE;\n\n\t\tfdt32_st(prop, (uint32_t)addr);\n\t} else if (addr_cells == 2) {\n\t\tfdt64_st(prop, addr);\n\t} else {\n\t\treturn -FDT_ERR_BADNCELLS;\n\t}\n\n\t \n\tprop += addr_cells * sizeof(fdt32_t);\n\tif (size_cells == 1) {\n\t\tif (size > UINT32_MAX)\n\t\t\treturn -FDT_ERR_BADVALUE;\n\n\t\tfdt32_st(prop, (uint32_t)size);\n\t} else if (size_cells == 2) {\n\t\tfdt64_st(prop, size);\n\t} else {\n\t\treturn -FDT_ERR_BADNCELLS;\n\t}\n\n\treturn fdt_appendprop(fdt, nodeoffset, name, data,\n\t\t\t      (addr_cells + size_cells) * sizeof(fdt32_t));\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}