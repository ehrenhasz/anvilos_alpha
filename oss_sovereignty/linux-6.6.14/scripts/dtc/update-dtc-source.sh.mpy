{
  "module_name": "update-dtc-source.sh",
  "hash_id": "5ec5ee71c5cf57114c45374b007d57d32aef621236d1a68ba3d933d9f061c834",
  "original_prompt": "Ingested from linux-6.6.14/scripts/dtc/update-dtc-source.sh",
  "human_readable_source": "#!/bin/sh\n# SPDX-License-Identifier: GPL-2.0\n# Simple script to update the version of DTC carried by the Linux kernel\n#\n# This script assumes that the dtc and the linux git trees are in the\n# same directory. After building dtc in the dtc directory, it copies the\n# source files and generated source file(s) into the scripts/dtc directory\n# in the kernel and creates a git commit updating them to the new\n# version.\n#\n# Usage: from the top level Linux source tree, run:\n# $ ./scripts/dtc/update-dtc-source.sh\n#\n# The script will change into the dtc tree, build and test dtc, copy the\n# relevant files into the kernel tree and create a git commit. The commit\n# message will need to be modified to reflect the version of DTC being\n# imported\n#\n# TODO:\n# This script is pretty basic, but it is seldom used so a few manual tasks\n# aren't a big deal. If anyone is interested in making it more robust, the\n# the following would be nice:\n# * Actually fail to complete if any testcase fails.\n#   - The dtc \"make check\" target needs to return a failure\n# * Extract the version number from the dtc repo for the commit message\n# * Build dtc in the kernel tree\n# * run 'make check\" on dtc built from the kernel tree\n\nset -ev\n\nDTC_UPSTREAM_PATH=`pwd`/../dtc\nDTC_LINUX_PATH=`pwd`/scripts/dtc\n\nDTC_SOURCE=\"checks.c data.c dtc.c dtc.h flattree.c fstree.c livetree.c srcpos.c \\\n\t\tsrcpos.h treesource.c util.c util.h version_gen.h \\\n\t\tdtc-lexer.l dtc-parser.y\"\nLIBFDT_SOURCE=\"fdt.c fdt.h fdt_addresses.c fdt_empty_tree.c \\\n\t\tfdt_overlay.c fdt_ro.c fdt_rw.c fdt_strerror.c fdt_sw.c \\\n\t\tfdt_wip.c libfdt.h libfdt_env.h libfdt_internal.h\"\nFDTOVERLAY_SOURCE=fdtoverlay.c\n\nget_last_dtc_version() {\n\tgit log --oneline scripts/dtc/ | grep 'upstream' | head -1 | sed -e 's/^.* \\(.*\\)/\\1/'\n}\n\nlast_dtc_ver=$(get_last_dtc_version)\n\n# Build DTC\ncd $DTC_UPSTREAM_PATH\nmake clean\nmake check\ndtc_version=$(git describe HEAD)\ndtc_log=$(git log --oneline ${last_dtc_ver}..)\n\n\n# Copy the files into the Linux tree\ncd $DTC_LINUX_PATH\nfor f in $DTC_SOURCE $FDTOVERLAY_SOURCE; do\n\tcp ${DTC_UPSTREAM_PATH}/${f} ${f}\n\tgit add ${f}\ndone\nfor f in $LIBFDT_SOURCE; do\n       cp ${DTC_UPSTREAM_PATH}/libfdt/${f} libfdt/${f}\n       git add libfdt/${f}\ndone\n\nsed -i -- 's/#include <libfdt_env.h>/#include \"libfdt_env.h\"/g' ./libfdt/libfdt.h\nsed -i -- 's/#include <fdt.h>/#include \"fdt.h\"/g' ./libfdt/libfdt.h\ngit add ./libfdt/libfdt.h\n\ncommit_msg=$(cat << EOF\nscripts/dtc: Update to upstream version ${dtc_version}\n\nThis adds the following commits from upstream:\n\n${dtc_log}\nEOF\n)\n\ngit commit -e -v -s -m \"${commit_msg}\"\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}