{
  "module_name": "merge_config.sh",
  "hash_id": "0a25f96fec8b6b91193e22a00a9b781033e459b55780d4d1242189722598a96c",
  "original_prompt": "Ingested from linux-6.6.14/scripts/kconfig/merge_config.sh",
  "human_readable_source": "#!/bin/sh\n# SPDX-License-Identifier: GPL-2.0\n#\n#  merge_config.sh - Takes a list of config fragment values, and merges\n#  them one by one. Provides warnings on overridden values, and specified\n#  values that did not make it to the resulting .config file (due to missed\n#  dependencies or config symbol removal).\n#\n#  Portions reused from kconf_check and generate_cfg:\n#  http://git.yoctoproject.org/cgit/cgit.cgi/yocto-kernel-tools/tree/tools/kconf_check\n#  http://git.yoctoproject.org/cgit/cgit.cgi/yocto-kernel-tools/tree/tools/generate_cfg\n#\n#  Copyright (c) 2009-2010 Wind River Systems, Inc.\n#  Copyright 2011 Linaro\n\nset -e\n\nclean_up() {\n\trm -f $TMP_FILE\n\trm -f $MERGE_FILE\n}\n\nusage() {\n\techo \"Usage: $0 [OPTIONS] [CONFIG [...]]\"\n\techo \"  -h    display this help text\"\n\techo \"  -m    only merge the fragments, do not execute the make command\"\n\techo \"  -n    use allnoconfig instead of alldefconfig\"\n\techo \"  -r    list redundant entries when merging fragments\"\n\techo \"  -y    make builtin have precedence over modules\"\n\techo \"  -O    dir to put generated output files.  Consider setting \\$KCONFIG_CONFIG instead.\"\n\techo \"  -s    strict mode. Fail if the fragment redefines any value.\"\n\techo \"  -Q    disable warning messages for overridden options.\"\n\techo\n\techo \"Used prefix: '$CONFIG_PREFIX'. You can redefine it with \\$CONFIG_ environment variable.\"\n}\n\nRUNMAKE=true\nALLTARGET=alldefconfig\nWARNREDUN=false\nBUILTIN=false\nOUTPUT=.\nSTRICT=false\nCONFIG_PREFIX=${CONFIG_-CONFIG_}\nWARNOVERRIDE=echo\n\nwhile true; do\n\tcase $1 in\n\t\"-n\")\n\t\tALLTARGET=allnoconfig\n\t\tshift\n\t\tcontinue\n\t\t;;\n\t\"-m\")\n\t\tRUNMAKE=false\n\t\tshift\n\t\tcontinue\n\t\t;;\n\t\"-h\")\n\t\tusage\n\t\texit\n\t\t;;\n\t\"-r\")\n\t\tWARNREDUN=true\n\t\tshift\n\t\tcontinue\n\t\t;;\n\t\"-y\")\n\t\tBUILTIN=true\n\t\tshift\n\t\tcontinue\n\t\t;;\n\t\"-O\")\n\t\tif [ -d $2 ];then\n\t\t\tOUTPUT=$(echo $2 | sed 's/\\/*$//')\n\t\telse\n\t\t\techo \"output directory $2 does not exist\" 1>&2\n\t\t\texit 1\n\t\tfi\n\t\tshift 2\n\t\tcontinue\n\t\t;;\n\t\"-s\")\n\t\tSTRICT=true\n\t\tshift\n\t\tcontinue\n\t\t;;\n\t\"-Q\")\n\t\tWARNOVERRIDE=true\n\t\tshift\n\t\tcontinue\n\t\t;;\n\t*)\n\t\tbreak\n\t\t;;\n\tesac\ndone\n\nif [ \"$#\" -lt 1 ] ; then\n\tusage\n\texit\nfi\n\nif [ -z \"$KCONFIG_CONFIG\" ]; then\n\tif [ \"$OUTPUT\" != . ]; then\n\t\tKCONFIG_CONFIG=$(readlink -m -- \"$OUTPUT/.config\")\n\telse\n\t\tKCONFIG_CONFIG=.config\n\tfi\nfi\n\nINITFILE=$1\nshift;\n\nif [ ! -r \"$INITFILE\" ]; then\n\techo \"The base file '$INITFILE' does not exist.  Exit.\" >&2\n\texit 1\nfi\n\nMERGE_LIST=$*\nSED_CONFIG_EXP1=\"s/^\\(${CONFIG_PREFIX}[a-zA-Z0-9_]*\\)=.*/\\1/p\"\nSED_CONFIG_EXP2=\"s/^# \\(${CONFIG_PREFIX}[a-zA-Z0-9_]*\\) is not set$/\\1/p\"\n\nTMP_FILE=$(mktemp ./.tmp.config.XXXXXXXXXX)\nMERGE_FILE=$(mktemp ./.merge_tmp.config.XXXXXXXXXX)\n\necho \"Using $INITFILE as base\"\n\ntrap clean_up EXIT\n\ncat $INITFILE > $TMP_FILE\n\n# Merge files, printing warnings on overridden values\nfor ORIG_MERGE_FILE in $MERGE_LIST ; do\n\techo \"Merging $ORIG_MERGE_FILE\"\n\tif [ ! -r \"$ORIG_MERGE_FILE\" ]; then\n\t\techo \"The merge file '$ORIG_MERGE_FILE' does not exist.  Exit.\" >&2\n\t\texit 1\n\tfi\n\tcat $ORIG_MERGE_FILE > $MERGE_FILE\n\tCFG_LIST=$(sed -n -e \"$SED_CONFIG_EXP1\" -e \"$SED_CONFIG_EXP2\" $MERGE_FILE)\n\n\tfor CFG in $CFG_LIST ; do\n\t\tgrep -q -w $CFG $TMP_FILE || continue\n\t\tPREV_VAL=$(grep -w $CFG $TMP_FILE)\n\t\tNEW_VAL=$(grep -w $CFG $MERGE_FILE)\n\t\tBUILTIN_FLAG=false\n\t\tif [ \"$BUILTIN\" = \"true\" ] && [ \"${NEW_VAL#CONFIG_*=}\" = \"m\" ] && [ \"${PREV_VAL#CONFIG_*=}\" = \"y\" ]; then\n\t\t\t${WARNOVERRIDE} Previous  value: $PREV_VAL\n\t\t\t${WARNOVERRIDE} New value:       $NEW_VAL\n\t\t\t${WARNOVERRIDE} -y passed, will not demote y to m\n\t\t\t${WARNOVERRIDE}\n\t\t\tBUILTIN_FLAG=true\n\t\telif [ \"x$PREV_VAL\" != \"x$NEW_VAL\" ] ; then\n\t\t\t${WARNOVERRIDE} Value of $CFG is redefined by fragment $ORIG_MERGE_FILE:\n\t\t\t${WARNOVERRIDE} Previous  value: $PREV_VAL\n\t\t\t${WARNOVERRIDE} New value:       $NEW_VAL\n\t\t\t${WARNOVERRIDE}\n\t\t\tif [ \"$STRICT\" = \"true\" ]; then\n\t\t\t\tSTRICT_MODE_VIOLATED=true\n\t\t\tfi\n\t\telif [ \"$WARNREDUN\" = \"true\" ]; then\n\t\t\t${WARNOVERRIDE} Value of $CFG is redundant by fragment $ORIG_MERGE_FILE:\n\t\tfi\n\t\tif [ \"$BUILTIN_FLAG\" = \"false\" ]; then\n\t\t\tsed -i \"/$CFG[ =]/d\" $TMP_FILE\n\t\telse\n\t\t\tsed -i \"/$CFG[ =]/d\" $MERGE_FILE\n\t\tfi\n\tdone\n\tcat $MERGE_FILE >> $TMP_FILE\ndone\n\nif [ \"$STRICT_MODE_VIOLATED\" = \"true\" ]; then\n\techo \"The fragment redefined a value and strict mode had been passed.\"\n\texit 1\nfi\n\nif [ \"$RUNMAKE\" = \"false\" ]; then\n\tcp -T -- \"$TMP_FILE\" \"$KCONFIG_CONFIG\"\n\techo \"#\"\n\techo \"# merged configuration written to $KCONFIG_CONFIG (needs make)\"\n\techo \"#\"\n\texit\nfi\n\n# If we have an output dir, setup the O= argument, otherwise leave\n# it blank, since O=. will create an unnecessary ./source softlink\nOUTPUT_ARG=\"\"\nif [ \"$OUTPUT\" != \".\" ] ; then\n\tOUTPUT_ARG=\"O=$OUTPUT\"\nfi\n\n\n# Use the merged file as the starting point for:\n# alldefconfig: Fills in any missing symbols with Kconfig default\n# allnoconfig: Fills in any missing symbols with # CONFIG_* is not set\nmake KCONFIG_ALLCONFIG=$TMP_FILE $OUTPUT_ARG $ALLTARGET\n\n\n# Check all specified config values took (might have missed-dependency issues)\nfor CFG in $(sed -n -e \"$SED_CONFIG_EXP1\" -e \"$SED_CONFIG_EXP2\" $TMP_FILE); do\n\n\tREQUESTED_VAL=$(grep -w -e \"$CFG\" $TMP_FILE)\n\tACTUAL_VAL=$(grep -w -e \"$CFG\" \"$KCONFIG_CONFIG\" || true)\n\tif [ \"x$REQUESTED_VAL\" != \"x$ACTUAL_VAL\" ] ; then\n\t\techo \"Value requested for $CFG not in final .config\"\n\t\techo \"Requested value:  $REQUESTED_VAL\"\n\t\techo \"Actual value:     $ACTUAL_VAL\"\n\t\techo \"\"\n\tfi\ndone\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}