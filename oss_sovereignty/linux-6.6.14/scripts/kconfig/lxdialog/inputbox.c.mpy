{
  "module_name": "inputbox.c",
  "hash_id": "c2700fbddcb26fbf32681ff614938982b98de911d1d51744dae9d0ff920bf846",
  "original_prompt": "Ingested from linux-6.6.14/scripts/kconfig/lxdialog/inputbox.c",
  "human_readable_source": "\n \n\n#include \"dialog.h\"\n\nchar dialog_input_result[MAX_LEN + 1];\n\n \nstatic void print_buttons(WINDOW * dialog, int height, int width, int selected)\n{\n\tint x = width / 2 - 11;\n\tint y = height - 2;\n\n\tprint_button(dialog, \"  Ok  \", y, x, selected == 0);\n\tprint_button(dialog, \" Help \", y, x + 14, selected == 1);\n\n\twmove(dialog, y, x + 1 + 14 * selected);\n\twrefresh(dialog);\n}\n\n \nint dialog_inputbox(const char *title, const char *prompt, int height, int width,\n\t\t    const char *init)\n{\n\tint i, x, y, box_y, box_x, box_width;\n\tint input_x = 0, key = 0, button = -1;\n\tint show_x, len, pos;\n\tchar *instr = dialog_input_result;\n\tWINDOW *dialog;\n\n\tif (!init)\n\t\tinstr[0] = '\\0';\n\telse\n\t\tstrcpy(instr, init);\n\ndo_resize:\n\tif (getmaxy(stdscr) <= (height - INPUTBOX_HEIGTH_MIN))\n\t\treturn -ERRDISPLAYTOOSMALL;\n\tif (getmaxx(stdscr) <= (width - INPUTBOX_WIDTH_MIN))\n\t\treturn -ERRDISPLAYTOOSMALL;\n\n\t \n\tx = (getmaxx(stdscr) - width) / 2;\n\ty = (getmaxy(stdscr) - height) / 2;\n\n\tdraw_shadow(stdscr, y, x, height, width);\n\n\tdialog = newwin(height, width, y, x);\n\tkeypad(dialog, TRUE);\n\n\tdraw_box(dialog, 0, 0, height, width,\n\t\t dlg.dialog.atr, dlg.border.atr);\n\twattrset(dialog, dlg.border.atr);\n\tmvwaddch(dialog, height - 3, 0, ACS_LTEE);\n\tfor (i = 0; i < width - 2; i++)\n\t\twaddch(dialog, ACS_HLINE);\n\twattrset(dialog, dlg.dialog.atr);\n\twaddch(dialog, ACS_RTEE);\n\n\tprint_title(dialog, title, width);\n\n\twattrset(dialog, dlg.dialog.atr);\n\tprint_autowrap(dialog, prompt, width - 2, 1, 3);\n\n\t \n\tbox_width = width - 6;\n\tgetyx(dialog, y, x);\n\tbox_y = y + 2;\n\tbox_x = (width - box_width) / 2;\n\tdraw_box(dialog, y + 1, box_x - 1, 3, box_width + 2,\n\t\t dlg.dialog.atr, dlg.border.atr);\n\n\tprint_buttons(dialog, height, width, 0);\n\n\t \n\twmove(dialog, box_y, box_x);\n\twattrset(dialog, dlg.inputbox.atr);\n\n\tlen = strlen(instr);\n\tpos = len;\n\n\tif (len >= box_width) {\n\t\tshow_x = len - box_width + 1;\n\t\tinput_x = box_width - 1;\n\t\tfor (i = 0; i < box_width - 1; i++)\n\t\t\twaddch(dialog, instr[show_x + i]);\n\t} else {\n\t\tshow_x = 0;\n\t\tinput_x = len;\n\t\twaddstr(dialog, instr);\n\t}\n\n\twmove(dialog, box_y, box_x + input_x);\n\n\twrefresh(dialog);\n\n\twhile (key != KEY_ESC) {\n\t\tkey = wgetch(dialog);\n\n\t\tif (button == -1) {\t \n\t\t\tswitch (key) {\n\t\t\tcase TAB:\n\t\t\tcase KEY_UP:\n\t\t\tcase KEY_DOWN:\n\t\t\t\tbreak;\n\t\t\tcase KEY_BACKSPACE:\n\t\t\tcase 8:    \n\t\t\tcase 127:  \n\t\t\t\tif (pos) {\n\t\t\t\t\twattrset(dialog, dlg.inputbox.atr);\n\t\t\t\t\tif (input_x == 0) {\n\t\t\t\t\t\tshow_x--;\n\t\t\t\t\t} else\n\t\t\t\t\t\tinput_x--;\n\n\t\t\t\t\tif (pos < len) {\n\t\t\t\t\t\tfor (i = pos - 1; i < len; i++) {\n\t\t\t\t\t\t\tinstr[i] = instr[i+1];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tpos--;\n\t\t\t\t\tlen--;\n\t\t\t\t\tinstr[len] = '\\0';\n\t\t\t\t\twmove(dialog, box_y, box_x);\n\t\t\t\t\tfor (i = 0; i < box_width; i++) {\n\t\t\t\t\t\tif (!instr[show_x + i]) {\n\t\t\t\t\t\t\twaddch(dialog, ' ');\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\twaddch(dialog, instr[show_x + i]);\n\t\t\t\t\t}\n\t\t\t\t\twmove(dialog, box_y, input_x + box_x);\n\t\t\t\t\twrefresh(dialog);\n\t\t\t\t}\n\t\t\t\tcontinue;\n\t\t\tcase KEY_LEFT:\n\t\t\t\tif (pos > 0) {\n\t\t\t\t\tif (input_x > 0) {\n\t\t\t\t\t\twmove(dialog, box_y, --input_x + box_x);\n\t\t\t\t\t} else if (input_x == 0) {\n\t\t\t\t\t\tshow_x--;\n\t\t\t\t\t\twmove(dialog, box_y, box_x);\n\t\t\t\t\t\tfor (i = 0; i < box_width; i++) {\n\t\t\t\t\t\t\tif (!instr[show_x + i]) {\n\t\t\t\t\t\t\t\twaddch(dialog, ' ');\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\twaddch(dialog, instr[show_x + i]);\n\t\t\t\t\t\t}\n\t\t\t\t\t\twmove(dialog, box_y, box_x);\n\t\t\t\t\t}\n\t\t\t\t\tpos--;\n\t\t\t\t}\n\t\t\t\tcontinue;\n\t\t\tcase KEY_RIGHT:\n\t\t\t\tif (pos < len) {\n\t\t\t\t\tif (input_x < box_width - 1) {\n\t\t\t\t\t\twmove(dialog, box_y, ++input_x + box_x);\n\t\t\t\t\t} else if (input_x == box_width - 1) {\n\t\t\t\t\t\tshow_x++;\n\t\t\t\t\t\twmove(dialog, box_y, box_x);\n\t\t\t\t\t\tfor (i = 0; i < box_width; i++) {\n\t\t\t\t\t\t\tif (!instr[show_x + i]) {\n\t\t\t\t\t\t\t\twaddch(dialog, ' ');\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\twaddch(dialog, instr[show_x + i]);\n\t\t\t\t\t\t}\n\t\t\t\t\t\twmove(dialog, box_y, input_x + box_x);\n\t\t\t\t\t}\n\t\t\t\t\tpos++;\n\t\t\t\t}\n\t\t\t\tcontinue;\n\t\t\tdefault:\n\t\t\t\tif (key < 0x100 && isprint(key)) {\n\t\t\t\t\tif (len < MAX_LEN) {\n\t\t\t\t\t\twattrset(dialog, dlg.inputbox.atr);\n\t\t\t\t\t\tif (pos < len) {\n\t\t\t\t\t\t\tfor (i = len; i > pos; i--)\n\t\t\t\t\t\t\t\tinstr[i] = instr[i-1];\n\t\t\t\t\t\t\tinstr[pos] = key;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tinstr[len] = key;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tpos++;\n\t\t\t\t\t\tlen++;\n\t\t\t\t\t\tinstr[len] = '\\0';\n\n\t\t\t\t\t\tif (input_x == box_width - 1) {\n\t\t\t\t\t\t\tshow_x++;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tinput_x++;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\twmove(dialog, box_y, box_x);\n\t\t\t\t\t\tfor (i = 0; i < box_width; i++) {\n\t\t\t\t\t\t\tif (!instr[show_x + i]) {\n\t\t\t\t\t\t\t\twaddch(dialog, ' ');\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\twaddch(dialog, instr[show_x + i]);\n\t\t\t\t\t\t}\n\t\t\t\t\t\twmove(dialog, box_y, input_x + box_x);\n\t\t\t\t\t\twrefresh(dialog);\n\t\t\t\t\t} else\n\t\t\t\t\t\tflash();\t \n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tswitch (key) {\n\t\tcase 'O':\n\t\tcase 'o':\n\t\t\tdelwin(dialog);\n\t\t\treturn 0;\n\t\tcase 'H':\n\t\tcase 'h':\n\t\t\tdelwin(dialog);\n\t\t\treturn 1;\n\t\tcase KEY_UP:\n\t\tcase KEY_LEFT:\n\t\t\tswitch (button) {\n\t\t\tcase -1:\n\t\t\t\tbutton = 1;\t \n\t\t\t\tprint_buttons(dialog, height, width, 1);\n\t\t\t\tbreak;\n\t\t\tcase 0:\n\t\t\t\tbutton = -1;\t \n\t\t\t\tprint_buttons(dialog, height, width, 0);\n\t\t\t\twmove(dialog, box_y, box_x + input_x);\n\t\t\t\twrefresh(dialog);\n\t\t\t\tbreak;\n\t\t\tcase 1:\n\t\t\t\tbutton = 0;\t \n\t\t\t\tprint_buttons(dialog, height, width, 0);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tbreak;\n\t\tcase TAB:\n\t\tcase KEY_DOWN:\n\t\tcase KEY_RIGHT:\n\t\t\tswitch (button) {\n\t\t\tcase -1:\n\t\t\t\tbutton = 0;\t \n\t\t\t\tprint_buttons(dialog, height, width, 0);\n\t\t\t\tbreak;\n\t\t\tcase 0:\n\t\t\t\tbutton = 1;\t \n\t\t\t\tprint_buttons(dialog, height, width, 1);\n\t\t\t\tbreak;\n\t\t\tcase 1:\n\t\t\t\tbutton = -1;\t \n\t\t\t\tprint_buttons(dialog, height, width, 0);\n\t\t\t\twmove(dialog, box_y, box_x + input_x);\n\t\t\t\twrefresh(dialog);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tbreak;\n\t\tcase ' ':\n\t\tcase '\\n':\n\t\t\tdelwin(dialog);\n\t\t\treturn (button == -1 ? 0 : button);\n\t\tcase 'X':\n\t\tcase 'x':\n\t\t\tkey = KEY_ESC;\n\t\t\tbreak;\n\t\tcase KEY_ESC:\n\t\t\tkey = on_key_esc(dialog);\n\t\t\tbreak;\n\t\tcase KEY_RESIZE:\n\t\t\tdelwin(dialog);\n\t\t\ton_key_resize();\n\t\t\tgoto do_resize;\n\t\t}\n\t}\n\n\tdelwin(dialog);\n\treturn KEY_ESC;\t\t \n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}