{
  "module_name": "checklist.c",
  "hash_id": "9ec0c15517e9968c25087837f757f13c6399d3baa3f296a0d9906434924458fc",
  "original_prompt": "Ingested from linux-6.6.14/scripts/kconfig/lxdialog/checklist.c",
  "human_readable_source": "\n \n\n#include \"dialog.h\"\n\nstatic int list_width, check_x, item_x;\n\n \nstatic void print_item(WINDOW * win, int choice, int selected)\n{\n\tint i;\n\tchar *list_item = malloc(list_width + 1);\n\n\tstrncpy(list_item, item_str(), list_width - item_x);\n\tlist_item[list_width - item_x] = '\\0';\n\n\t \n\twattrset(win, dlg.menubox.atr);\n\twmove(win, choice, 0);\n\tfor (i = 0; i < list_width; i++)\n\t\twaddch(win, ' ');\n\n\twmove(win, choice, check_x);\n\twattrset(win, selected ? dlg.check_selected.atr\n\t\t : dlg.check.atr);\n\tif (!item_is_tag(':'))\n\t\twprintw(win, \"(%c)\", item_is_tag('X') ? 'X' : ' ');\n\n\twattrset(win, selected ? dlg.tag_selected.atr : dlg.tag.atr);\n\tmvwaddch(win, choice, item_x, list_item[0]);\n\twattrset(win, selected ? dlg.item_selected.atr : dlg.item.atr);\n\twaddstr(win, list_item + 1);\n\tif (selected) {\n\t\twmove(win, choice, check_x + 1);\n\t\twrefresh(win);\n\t}\n\tfree(list_item);\n}\n\n \nstatic void print_arrows(WINDOW * win, int choice, int item_no, int scroll,\n\t     int y, int x, int height)\n{\n\twmove(win, y, x);\n\n\tif (scroll > 0) {\n\t\twattrset(win, dlg.uarrow.atr);\n\t\twaddch(win, ACS_UARROW);\n\t\twaddstr(win, \"(-)\");\n\t} else {\n\t\twattrset(win, dlg.menubox.atr);\n\t\twaddch(win, ACS_HLINE);\n\t\twaddch(win, ACS_HLINE);\n\t\twaddch(win, ACS_HLINE);\n\t\twaddch(win, ACS_HLINE);\n\t}\n\n\ty = y + height + 1;\n\twmove(win, y, x);\n\n\tif ((height < item_no) && (scroll + choice < item_no - 1)) {\n\t\twattrset(win, dlg.darrow.atr);\n\t\twaddch(win, ACS_DARROW);\n\t\twaddstr(win, \"(+)\");\n\t} else {\n\t\twattrset(win, dlg.menubox_border.atr);\n\t\twaddch(win, ACS_HLINE);\n\t\twaddch(win, ACS_HLINE);\n\t\twaddch(win, ACS_HLINE);\n\t\twaddch(win, ACS_HLINE);\n\t}\n}\n\n \nstatic void print_buttons(WINDOW * dialog, int height, int width, int selected)\n{\n\tint x = width / 2 - 11;\n\tint y = height - 2;\n\n\tprint_button(dialog, \"Select\", y, x, selected == 0);\n\tprint_button(dialog, \" Help \", y, x + 14, selected == 1);\n\n\twmove(dialog, y, x + 1 + 14 * selected);\n\twrefresh(dialog);\n}\n\n \nint dialog_checklist(const char *title, const char *prompt, int height,\n\t\t     int width, int list_height)\n{\n\tint i, x, y, box_x, box_y;\n\tint key = 0, button = 0, choice = 0, scroll = 0, max_choice;\n\tWINDOW *dialog, *list;\n\n\t \n\titem_foreach() {\n\t\tif (item_is_tag('X'))\n\t\t\tchoice = item_n();\n\t\tif (item_is_selected()) {\n\t\t\tchoice = item_n();\n\t\t\tbreak;\n\t\t}\n\t}\n\ndo_resize:\n\tif (getmaxy(stdscr) < (height + CHECKLIST_HEIGTH_MIN))\n\t\treturn -ERRDISPLAYTOOSMALL;\n\tif (getmaxx(stdscr) < (width + CHECKLIST_WIDTH_MIN))\n\t\treturn -ERRDISPLAYTOOSMALL;\n\n\tmax_choice = MIN(list_height, item_count());\n\n\t \n\tx = (getmaxx(stdscr) - width) / 2;\n\ty = (getmaxy(stdscr) - height) / 2;\n\n\tdraw_shadow(stdscr, y, x, height, width);\n\n\tdialog = newwin(height, width, y, x);\n\tkeypad(dialog, TRUE);\n\n\tdraw_box(dialog, 0, 0, height, width,\n\t\t dlg.dialog.atr, dlg.border.atr);\n\twattrset(dialog, dlg.border.atr);\n\tmvwaddch(dialog, height - 3, 0, ACS_LTEE);\n\tfor (i = 0; i < width - 2; i++)\n\t\twaddch(dialog, ACS_HLINE);\n\twattrset(dialog, dlg.dialog.atr);\n\twaddch(dialog, ACS_RTEE);\n\n\tprint_title(dialog, title, width);\n\n\twattrset(dialog, dlg.dialog.atr);\n\tprint_autowrap(dialog, prompt, width - 2, 1, 3);\n\n\tlist_width = width - 6;\n\tbox_y = height - list_height - 5;\n\tbox_x = (width - list_width) / 2 - 1;\n\n\t \n\tlist = subwin(dialog, list_height, list_width, y + box_y + 1,\n\t\t      x + box_x + 1);\n\n\tkeypad(list, TRUE);\n\n\t \n\tdraw_box(dialog, box_y, box_x, list_height + 2, list_width + 2,\n\t\t dlg.menubox_border.atr, dlg.menubox.atr);\n\n\t \n\tcheck_x = 0;\n\titem_foreach()\n\t\tcheck_x = MAX(check_x, strlen(item_str()) + 4);\n\tcheck_x = MIN(check_x, list_width);\n\n\tcheck_x = (list_width - check_x) / 2;\n\titem_x = check_x + 4;\n\n\tif (choice >= list_height) {\n\t\tscroll = choice - list_height + 1;\n\t\tchoice -= scroll;\n\t}\n\n\t \n\tfor (i = 0; i < max_choice; i++) {\n\t\titem_set(scroll + i);\n\t\tprint_item(list, i, i == choice);\n\t}\n\n\tprint_arrows(dialog, choice, item_count(), scroll,\n\t\t     box_y, box_x + check_x + 5, list_height);\n\n\tprint_buttons(dialog, height, width, 0);\n\n\twnoutrefresh(dialog);\n\twnoutrefresh(list);\n\tdoupdate();\n\n\twhile (key != KEY_ESC) {\n\t\tkey = wgetch(dialog);\n\n\t\tfor (i = 0; i < max_choice; i++) {\n\t\t\titem_set(i + scroll);\n\t\t\tif (toupper(key) == toupper(item_str()[0]))\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif (i < max_choice || key == KEY_UP || key == KEY_DOWN ||\n\t\t    key == '+' || key == '-') {\n\t\t\tif (key == KEY_UP || key == '-') {\n\t\t\t\tif (!choice) {\n\t\t\t\t\tif (!scroll)\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t \n\t\t\t\t\tif (list_height > 1) {\n\t\t\t\t\t\t \n\t\t\t\t\t\titem_set(scroll);\n\t\t\t\t\t\tprint_item(list, 0, FALSE);\n\t\t\t\t\t\tscrollok(list, TRUE);\n\t\t\t\t\t\twscrl(list, -1);\n\t\t\t\t\t\tscrollok(list, FALSE);\n\t\t\t\t\t}\n\t\t\t\t\tscroll--;\n\t\t\t\t\titem_set(scroll);\n\t\t\t\t\tprint_item(list, 0, TRUE);\n\t\t\t\t\tprint_arrows(dialog, choice, item_count(),\n\t\t\t\t\t\t     scroll, box_y, box_x + check_x + 5, list_height);\n\n\t\t\t\t\twnoutrefresh(dialog);\n\t\t\t\t\twrefresh(list);\n\n\t\t\t\t\tcontinue;\t \n\t\t\t\t} else\n\t\t\t\t\ti = choice - 1;\n\t\t\t} else if (key == KEY_DOWN || key == '+') {\n\t\t\t\tif (choice == max_choice - 1) {\n\t\t\t\t\tif (scroll + choice >= item_count() - 1)\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t \n\t\t\t\t\tif (list_height > 1) {\n\t\t\t\t\t\t \n\t\t\t\t\t\titem_set(scroll + max_choice - 1);\n\t\t\t\t\t\tprint_item(list,\n\t\t\t\t\t\t\t    max_choice - 1,\n\t\t\t\t\t\t\t    FALSE);\n\t\t\t\t\t\tscrollok(list, TRUE);\n\t\t\t\t\t\twscrl(list, 1);\n\t\t\t\t\t\tscrollok(list, FALSE);\n\t\t\t\t\t}\n\t\t\t\t\tscroll++;\n\t\t\t\t\titem_set(scroll + max_choice - 1);\n\t\t\t\t\tprint_item(list, max_choice - 1, TRUE);\n\n\t\t\t\t\tprint_arrows(dialog, choice, item_count(),\n\t\t\t\t\t\t     scroll, box_y, box_x + check_x + 5, list_height);\n\n\t\t\t\t\twnoutrefresh(dialog);\n\t\t\t\t\twrefresh(list);\n\n\t\t\t\t\tcontinue;\t \n\t\t\t\t} else\n\t\t\t\t\ti = choice + 1;\n\t\t\t}\n\t\t\tif (i != choice) {\n\t\t\t\t \n\t\t\t\titem_set(scroll + choice);\n\t\t\t\tprint_item(list, choice, FALSE);\n\t\t\t\t \n\t\t\t\tchoice = i;\n\t\t\t\titem_set(scroll + choice);\n\t\t\t\tprint_item(list, choice, TRUE);\n\t\t\t\twnoutrefresh(dialog);\n\t\t\t\twrefresh(list);\n\t\t\t}\n\t\t\tcontinue;\t \n\t\t}\n\t\tswitch (key) {\n\t\tcase 'H':\n\t\tcase 'h':\n\t\tcase '?':\n\t\t\tbutton = 1;\n\t\t\t \n\t\tcase 'S':\n\t\tcase 's':\n\t\tcase ' ':\n\t\tcase '\\n':\n\t\t\titem_foreach()\n\t\t\t\titem_set_selected(0);\n\t\t\titem_set(scroll + choice);\n\t\t\titem_set_selected(1);\n\t\t\tdelwin(list);\n\t\t\tdelwin(dialog);\n\t\t\treturn button;\n\t\tcase TAB:\n\t\tcase KEY_LEFT:\n\t\tcase KEY_RIGHT:\n\t\t\tbutton = ((key == KEY_LEFT ? --button : ++button) < 0)\n\t\t\t    ? 1 : (button > 1 ? 0 : button);\n\n\t\t\tprint_buttons(dialog, height, width, button);\n\t\t\twrefresh(dialog);\n\t\t\tbreak;\n\t\tcase 'X':\n\t\tcase 'x':\n\t\t\tkey = KEY_ESC;\n\t\t\tbreak;\n\t\tcase KEY_ESC:\n\t\t\tkey = on_key_esc(dialog);\n\t\t\tbreak;\n\t\tcase KEY_RESIZE:\n\t\t\tdelwin(list);\n\t\t\tdelwin(dialog);\n\t\t\ton_key_resize();\n\t\t\tgoto do_resize;\n\t\t}\n\n\t\t \n\t\tdoupdate();\n\t}\n\tdelwin(list);\n\tdelwin(dialog);\n\treturn key;\t\t \n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}