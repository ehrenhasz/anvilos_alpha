{
  "module_name": "menubox.c",
  "hash_id": "46457c110b6de2f55877b0cbb0f8fb4cc29e3a0e912562f4425e9a8da901842a",
  "original_prompt": "Ingested from linux-6.6.14/scripts/kconfig/lxdialog/menubox.c",
  "human_readable_source": "\n \n\n \n\n#include \"dialog.h\"\n\nstatic int menu_width, item_x;\n\n \nstatic void do_print_item(WINDOW * win, const char *item, int line_y,\n\t\t\t  int selected, int hotkey)\n{\n\tint j;\n\tchar *menu_item = malloc(menu_width + 1);\n\n\tstrncpy(menu_item, item, menu_width - item_x);\n\tmenu_item[menu_width - item_x] = '\\0';\n\tj = first_alpha(menu_item, \"YyNnMmHh\");\n\n\t \n\twattrset(win, dlg.menubox.atr);\n\twmove(win, line_y, 0);\n\twclrtoeol(win);\n\twattrset(win, selected ? dlg.item_selected.atr : dlg.item.atr);\n\tmvwaddstr(win, line_y, item_x, menu_item);\n\tif (hotkey) {\n\t\twattrset(win, selected ? dlg.tag_key_selected.atr\n\t\t\t : dlg.tag_key.atr);\n\t\tmvwaddch(win, line_y, item_x + j, menu_item[j]);\n\t}\n\tif (selected) {\n\t\twmove(win, line_y, item_x + 1);\n\t}\n\tfree(menu_item);\n\twrefresh(win);\n}\n\n#define print_item(index, choice, selected)\t\t\t\t\\\ndo {\t\t\t\t\t\t\t\t\t\\\n\titem_set(index);\t\t\t\t\t\t\\\n\tdo_print_item(menu, item_str(), choice, selected, !item_is_tag(':')); \\\n} while (0)\n\n \nstatic void print_arrows(WINDOW * win, int item_no, int scroll, int y, int x,\n\t\t\t int height)\n{\n\tint cur_y, cur_x;\n\n\tgetyx(win, cur_y, cur_x);\n\n\twmove(win, y, x);\n\n\tif (scroll > 0) {\n\t\twattrset(win, dlg.uarrow.atr);\n\t\twaddch(win, ACS_UARROW);\n\t\twaddstr(win, \"(-)\");\n\t} else {\n\t\twattrset(win, dlg.menubox.atr);\n\t\twaddch(win, ACS_HLINE);\n\t\twaddch(win, ACS_HLINE);\n\t\twaddch(win, ACS_HLINE);\n\t\twaddch(win, ACS_HLINE);\n\t}\n\n\ty = y + height + 1;\n\twmove(win, y, x);\n\twrefresh(win);\n\n\tif ((height < item_no) && (scroll + height < item_no)) {\n\t\twattrset(win, dlg.darrow.atr);\n\t\twaddch(win, ACS_DARROW);\n\t\twaddstr(win, \"(+)\");\n\t} else {\n\t\twattrset(win, dlg.menubox_border.atr);\n\t\twaddch(win, ACS_HLINE);\n\t\twaddch(win, ACS_HLINE);\n\t\twaddch(win, ACS_HLINE);\n\t\twaddch(win, ACS_HLINE);\n\t}\n\n\twmove(win, cur_y, cur_x);\n\twrefresh(win);\n}\n\n \nstatic void print_buttons(WINDOW * win, int height, int width, int selected)\n{\n\tint x = width / 2 - 28;\n\tint y = height - 2;\n\n\tprint_button(win, \"Select\", y, x, selected == 0);\n\tprint_button(win, \" Exit \", y, x + 12, selected == 1);\n\tprint_button(win, \" Help \", y, x + 24, selected == 2);\n\tprint_button(win, \" Save \", y, x + 36, selected == 3);\n\tprint_button(win, \" Load \", y, x + 48, selected == 4);\n\n\twmove(win, y, x + 1 + 12 * selected);\n\twrefresh(win);\n}\n\n \nstatic void do_scroll(WINDOW *win, int *scroll, int n)\n{\n\t \n\tscrollok(win, TRUE);\n\twscrl(win, n);\n\tscrollok(win, FALSE);\n\t*scroll = *scroll + n;\n\twrefresh(win);\n}\n\n \nint dialog_menu(const char *title, const char *prompt,\n\t\tconst void *selected, int *s_scroll)\n{\n\tint i, j, x, y, box_x, box_y;\n\tint height, width, menu_height;\n\tint key = 0, button = 0, scroll = 0, choice = 0;\n\tint first_item =  0, max_choice;\n\tWINDOW *dialog, *menu;\n\ndo_resize:\n\theight = getmaxy(stdscr);\n\twidth = getmaxx(stdscr);\n\tif (height < MENUBOX_HEIGTH_MIN || width < MENUBOX_WIDTH_MIN)\n\t\treturn -ERRDISPLAYTOOSMALL;\n\n\theight -= 4;\n\twidth  -= 5;\n\tmenu_height = height - 10;\n\n\tmax_choice = MIN(menu_height, item_count());\n\n\t \n\tx = (getmaxx(stdscr) - width) / 2;\n\ty = (getmaxy(stdscr) - height) / 2;\n\n\tdraw_shadow(stdscr, y, x, height, width);\n\n\tdialog = newwin(height, width, y, x);\n\tkeypad(dialog, TRUE);\n\n\tdraw_box(dialog, 0, 0, height, width,\n\t\t dlg.dialog.atr, dlg.border.atr);\n\twattrset(dialog, dlg.border.atr);\n\tmvwaddch(dialog, height - 3, 0, ACS_LTEE);\n\tfor (i = 0; i < width - 2; i++)\n\t\twaddch(dialog, ACS_HLINE);\n\twattrset(dialog, dlg.dialog.atr);\n\twbkgdset(dialog, dlg.dialog.atr & A_COLOR);\n\twaddch(dialog, ACS_RTEE);\n\n\tprint_title(dialog, title, width);\n\n\twattrset(dialog, dlg.dialog.atr);\n\tprint_autowrap(dialog, prompt, width - 2, 1, 3);\n\n\tmenu_width = width - 6;\n\tbox_y = height - menu_height - 5;\n\tbox_x = (width - menu_width) / 2 - 1;\n\n\t \n\tmenu = subwin(dialog, menu_height, menu_width,\n\t\t      y + box_y + 1, x + box_x + 1);\n\tkeypad(menu, TRUE);\n\n\t \n\tdraw_box(dialog, box_y, box_x, menu_height + 2, menu_width + 2,\n\t\t dlg.menubox_border.atr, dlg.menubox.atr);\n\n\tif (menu_width >= 80)\n\t\titem_x = (menu_width - 70) / 2;\n\telse\n\t\titem_x = 4;\n\n\t \n\titem_foreach()\n\t\tif (selected && (selected == item_data()))\n\t\t\tchoice = item_n();\n\t \n\tscroll = *s_scroll;\n\tif ((scroll <= choice) && (scroll + max_choice > choice) &&\n\t   (scroll >= 0) && (scroll + max_choice <= item_count())) {\n\t\tfirst_item = scroll;\n\t\tchoice = choice - scroll;\n\t} else {\n\t\tscroll = 0;\n\t}\n\tif ((choice >= max_choice)) {\n\t\tif (choice >= item_count() - max_choice / 2)\n\t\t\tscroll = first_item = item_count() - max_choice;\n\t\telse\n\t\t\tscroll = first_item = choice - max_choice / 2;\n\t\tchoice = choice - scroll;\n\t}\n\n\t \n\tfor (i = 0; i < max_choice; i++) {\n\t\tprint_item(first_item + i, i, i == choice);\n\t}\n\n\twnoutrefresh(menu);\n\n\tprint_arrows(dialog, item_count(), scroll,\n\t\t     box_y, box_x + item_x + 1, menu_height);\n\n\tprint_buttons(dialog, height, width, 0);\n\twmove(menu, choice, item_x + 1);\n\twrefresh(menu);\n\n\twhile (key != KEY_ESC) {\n\t\tkey = wgetch(menu);\n\n\t\tif (key < 256 && isalpha(key))\n\t\t\tkey = tolower(key);\n\n\t\tif (strchr(\"ynmh\", key))\n\t\t\ti = max_choice;\n\t\telse {\n\t\t\tfor (i = choice + 1; i < max_choice; i++) {\n\t\t\t\titem_set(scroll + i);\n\t\t\t\tj = first_alpha(item_str(), \"YyNnMmHh\");\n\t\t\t\tif (key == tolower(item_str()[j]))\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif (i == max_choice)\n\t\t\t\tfor (i = 0; i < max_choice; i++) {\n\t\t\t\t\titem_set(scroll + i);\n\t\t\t\t\tj = first_alpha(item_str(), \"YyNnMmHh\");\n\t\t\t\t\tif (key == tolower(item_str()[j]))\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t}\n\n\t\tif (item_count() != 0 &&\n\t\t    (i < max_choice ||\n\t\t     key == KEY_UP || key == KEY_DOWN ||\n\t\t     key == '-' || key == '+' ||\n\t\t     key == KEY_PPAGE || key == KEY_NPAGE)) {\n\t\t\t \n\t\t\tprint_item(scroll + choice, choice, FALSE);\n\n\t\t\tif (key == KEY_UP || key == '-') {\n\t\t\t\tif (choice < 2 && scroll) {\n\t\t\t\t\t \n\t\t\t\t\tdo_scroll(menu, &scroll, -1);\n\n\t\t\t\t\tprint_item(scroll, 0, FALSE);\n\t\t\t\t} else\n\t\t\t\t\tchoice = MAX(choice - 1, 0);\n\n\t\t\t} else if (key == KEY_DOWN || key == '+') {\n\t\t\t\tprint_item(scroll+choice, choice, FALSE);\n\n\t\t\t\tif ((choice > max_choice - 3) &&\n\t\t\t\t    (scroll + max_choice < item_count())) {\n\t\t\t\t\t \n\t\t\t\t\tdo_scroll(menu, &scroll, 1);\n\n\t\t\t\t\tprint_item(scroll+max_choice - 1,\n\t\t\t\t\t\t   max_choice - 1, FALSE);\n\t\t\t\t} else\n\t\t\t\t\tchoice = MIN(choice + 1, max_choice - 1);\n\n\t\t\t} else if (key == KEY_PPAGE) {\n\t\t\t\tscrollok(menu, TRUE);\n\t\t\t\tfor (i = 0; (i < max_choice); i++) {\n\t\t\t\t\tif (scroll > 0) {\n\t\t\t\t\t\tdo_scroll(menu, &scroll, -1);\n\t\t\t\t\t\tprint_item(scroll, 0, FALSE);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (choice > 0)\n\t\t\t\t\t\t\tchoice--;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t} else if (key == KEY_NPAGE) {\n\t\t\t\tfor (i = 0; (i < max_choice); i++) {\n\t\t\t\t\tif (scroll + max_choice < item_count()) {\n\t\t\t\t\t\tdo_scroll(menu, &scroll, 1);\n\t\t\t\t\t\tprint_item(scroll+max_choice-1,\n\t\t\t\t\t\t\t   max_choice - 1, FALSE);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (choice + 1 < max_choice)\n\t\t\t\t\t\t\tchoice++;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else\n\t\t\t\tchoice = i;\n\n\t\t\tprint_item(scroll + choice, choice, TRUE);\n\n\t\t\tprint_arrows(dialog, item_count(), scroll,\n\t\t\t\t     box_y, box_x + item_x + 1, menu_height);\n\n\t\t\twnoutrefresh(dialog);\n\t\t\twrefresh(menu);\n\n\t\t\tcontinue;\t \n\t\t}\n\n\t\tswitch (key) {\n\t\tcase KEY_LEFT:\n\t\tcase TAB:\n\t\tcase KEY_RIGHT:\n\t\t\tbutton = ((key == KEY_LEFT ? --button : ++button) < 0)\n\t\t\t    ? 4 : (button > 4 ? 0 : button);\n\n\t\t\tprint_buttons(dialog, height, width, button);\n\t\t\twrefresh(menu);\n\t\t\tbreak;\n\t\tcase ' ':\n\t\tcase 's':\n\t\tcase 'y':\n\t\tcase 'n':\n\t\tcase 'm':\n\t\tcase '/':\n\t\tcase 'h':\n\t\tcase '?':\n\t\tcase 'z':\n\t\tcase '\\n':\n\t\t\t \n\t\t\t*s_scroll = scroll;\n\t\t\tdelwin(menu);\n\t\t\tdelwin(dialog);\n\t\t\titem_set(scroll + choice);\n\t\t\titem_set_selected(1);\n\t\t\tswitch (key) {\n\t\t\tcase 'h':\n\t\t\tcase '?':\n\t\t\t\treturn 2;\n\t\t\tcase 's':\n\t\t\tcase 'y':\n\t\t\t\treturn 5;\n\t\t\tcase 'n':\n\t\t\t\treturn 6;\n\t\t\tcase 'm':\n\t\t\t\treturn 7;\n\t\t\tcase ' ':\n\t\t\t\treturn 8;\n\t\t\tcase '/':\n\t\t\t\treturn 9;\n\t\t\tcase 'z':\n\t\t\t\treturn 10;\n\t\t\tcase '\\n':\n\t\t\t\treturn button;\n\t\t\t}\n\t\t\treturn 0;\n\t\tcase 'e':\n\t\tcase 'x':\n\t\t\tkey = KEY_ESC;\n\t\t\tbreak;\n\t\tcase KEY_ESC:\n\t\t\tkey = on_key_esc(menu);\n\t\t\tbreak;\n\t\tcase KEY_RESIZE:\n\t\t\ton_key_resize();\n\t\t\tdelwin(menu);\n\t\t\tdelwin(dialog);\n\t\t\tgoto do_resize;\n\t\t}\n\t}\n\tdelwin(menu);\n\tdelwin(dialog);\n\treturn key;\t\t \n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}