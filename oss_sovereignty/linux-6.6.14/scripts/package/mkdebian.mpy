{
  "module_name": "mkdebian",
  "hash_id": "85711c69d031cb89409b374865bf3b29c40cf5e61fb240f5d81eebed6c228a90",
  "original_prompt": "Ingested from linux-6.6.14/scripts/package/mkdebian",
  "human_readable_source": "#!/bin/sh\n#\n# Copyright 2003 Wichert Akkerman <wichert@wiggy.net>\n#\n# Simple script to generate a debian/ directory for a Linux kernel.\n\nset -e\n\nis_enabled() {\n\tgrep -q \"^$1=y\" include/config/auto.conf\n}\n\nif_enabled_echo() {\n\tif is_enabled \"$1\"; then\n\t\techo -n \"$2\"\n\telif [ $# -ge 3 ]; then\n\t\techo -n \"$3\"\n\tfi\n}\n\nset_debarch() {\n\tif [ -n \"$KBUILD_DEBARCH\" ] ; then\n\t\tdebarch=\"$KBUILD_DEBARCH\"\n\t\treturn\n\tfi\n\n\t# Attempt to find the correct Debian architecture\n\tcase \"$UTS_MACHINE\" in\n\ti386|ia64|alpha|m68k|riscv*)\n\t\tdebarch=\"$UTS_MACHINE\" ;;\n\tx86_64)\n\t\tdebarch=amd64 ;;\n\tsparc*)\n\t\tdebarch=sparc$(if_enabled_echo CONFIG_64BIT 64) ;;\n\ts390*)\n\t\tdebarch=s390x ;;\n\tppc*)\n\t\tif is_enabled CONFIG_64BIT; then\n\t\t\tdebarch=ppc64$(if_enabled_echo CONFIG_CPU_LITTLE_ENDIAN el)\n\t\telse\n\t\t\tdebarch=powerpc$(if_enabled_echo CONFIG_SPE spe)\n\t\tfi\n\t\t;;\n\tparisc*)\n\t\tdebarch=hppa ;;\n\tmips*)\n\t\tif is_enabled CONFIG_CPU_LITTLE_ENDIAN; then\n\t\t\tdebarch=mips$(if_enabled_echo CONFIG_64BIT 64)$(if_enabled_echo CONFIG_CPU_MIPSR6 r6)el\n\t\telif is_enabled CONFIG_CPU_MIPSR6; then\n\t\t\tdebarch=mips$(if_enabled_echo CONFIG_64BIT 64)r6\n\t\telse\n\t\t\tdebarch=mips\n\t\tfi\n\t\t;;\n\taarch64|arm64)\n\t\tdebarch=arm64 ;;\n\tarm*)\n\t\tif is_enabled CONFIG_AEABI; then\n\t\t\tdebarch=arm$(if_enabled_echo CONFIG_VFP hf el)\n\t\telse\n\t\t\tdebarch=arm\n\t\tfi\n\t\t;;\n\topenrisc)\n\t\tdebarch=or1k ;;\n\tsh)\n\t\tif is_enabled CONFIG_CPU_SH3; then\n\t\t\tdebarch=sh3$(if_enabled_echo CONFIG_CPU_BIG_ENDIAN eb)\n\t\telif is_enabled CONFIG_CPU_SH4; then\n\t\t\tdebarch=sh4$(if_enabled_echo CONFIG_CPU_BIG_ENDIAN eb)\n\t\tfi\n\t\t;;\n\tesac\n\tif [ -z \"$debarch\" ]; then\n\t\tdebarch=$(dpkg-architecture -qDEB_HOST_ARCH)\n\t\techo \"\" >&2\n\t\techo \"** ** **  WARNING  ** ** **\" >&2\n\t\techo \"\" >&2\n\t\techo \"Your architecture doesn't have its equivalent\" >&2\n\t\techo \"Debian userspace architecture defined!\" >&2\n\t\techo \"Falling back to the current host architecture ($debarch).\" >&2\n\t\techo \"Please add support for $UTS_MACHINE to ${0} ...\" >&2\n\t\techo \"\" >&2\n\tfi\n}\n\n# Create debian/source/ if it is a source package build\ngen_source ()\n{\n\tmkdir -p debian/source\n\n\techo \"3.0 (quilt)\" > debian/source/format\n\n\t{\n\t\techo \"diff-ignore\"\n\t\techo \"extend-diff-ignore = .*\"\n\t} > debian/source/local-options\n\n\t# Add .config as a patch\n\tmkdir -p debian/patches\n\t{\n\t\techo \"Subject: Add .config\"\n\t\techo \"Author: ${maintainer}\"\n\t\techo\n\t\techo \"--- /dev/null\"\n\t\techo \"+++ linux/.config\"\n\t\tdiff -u /dev/null \"${KCONFIG_CONFIG}\" | tail -n +3\n\t} > debian/patches/config.patch\n\techo config.patch > debian/patches/series\n\n\t\"${srctree}/scripts/package/gen-diff-patch\" debian/patches/diff.patch\n\tif [ -s debian/patches/diff.patch ]; then\n\t\tsed -i \"\n\t\t\t1iSubject: Add local diff\n\t\t\t1iAuthor: ${maintainer}\n\t\t\t1i\n\t\t\" debian/patches/diff.patch\n\n\t\techo diff.patch >> debian/patches/series\n\telse\n\t\trm -f debian/patches/diff.patch\n\tfi\n}\n\nrm -rf debian\nmkdir debian\n\nemail=${DEBEMAIL-$EMAIL}\n\n# use email string directly if it contains <email>\nif echo \"${email}\" | grep -q '<.*>'; then\n\tmaintainer=${email}\nelse\n\t# or construct the maintainer string\n\tuser=${KBUILD_BUILD_USER-$(id -nu)}\n\tname=${DEBFULLNAME-${user}}\n\tif [ -z \"${email}\" ]; then\n\t\tbuildhost=${KBUILD_BUILD_HOST-$(hostname -f 2>/dev/null || hostname)}\n\t\temail=\"${user}@${buildhost}\"\n\tfi\n\tmaintainer=\"${name} <${email}>\"\nfi\n\nif [ \"$1\" = --need-source ]; then\n\tgen_source\nfi\n\n# Some variables and settings used throughout the script\nversion=$KERNELRELEASE\nif [ -n \"$KDEB_PKGVERSION\" ]; then\n\tpackageversion=$KDEB_PKGVERSION\nelse\n\tpackageversion=$(${srctree}/scripts/setlocalversion --no-local ${srctree})-$($srctree/init/build-version)\nfi\nsourcename=${KDEB_SOURCENAME:-linux-upstream}\n\nif [ \"$ARCH\" = \"um\" ] ; then\n\tpackagename=user-mode-linux\nelse\n\tpackagename=linux-image\nfi\n\ndebarch=\nset_debarch\n\n# Try to determine distribution\nif [ -n \"$KDEB_CHANGELOG_DIST\" ]; then\n        distribution=$KDEB_CHANGELOG_DIST\n# In some cases lsb_release returns the codename as n/a, which breaks dpkg-parsechangelog\nelif distribution=$(lsb_release -cs 2>/dev/null) && [ -n \"$distribution\" ] && [ \"$distribution\" != \"n/a\" ]; then\n        : # nothing to do in this case\nelse\n        distribution=\"unstable\"\n        echo >&2 \"Using default distribution of 'unstable' in the changelog\"\n        echo >&2 \"Install lsb-release or set \\$KDEB_CHANGELOG_DIST explicitly\"\nfi\n\necho $debarch > debian/arch\nextra_build_depends=\", $(if_enabled_echo CONFIG_UNWINDER_ORC libelf-dev:native)\"\nextra_build_depends=\"$extra_build_depends, $(if_enabled_echo CONFIG_SYSTEM_TRUSTED_KEYRING libssl-dev:native)\"\n\n# Generate a simple changelog template\ncat <<EOF > debian/changelog\n$sourcename ($packageversion) $distribution; urgency=low\n\n  * Custom built Linux kernel.\n\n -- $maintainer  $(date -R)\nEOF\n\n# Generate copyright file\ncat <<EOF > debian/copyright\nThis is a packaged upstream version of the Linux kernel.\n\nThe sources may be found at most Linux archive sites, including:\nhttps://www.kernel.org/pub/linux/kernel\n\nCopyright: 1991 - 2018 Linus Torvalds and others.\n\nThe git repository for mainline kernel development is at:\ngit://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git\n\n    This program is free software; you can redistribute it and/or modify\n    it under the terms of the GNU General Public License as published by\n    the Free Software Foundation; version 2 dated June, 1991.\n\nOn Debian GNU/Linux systems, the complete text of the GNU General Public\nLicense version 2 can be found in \\`/usr/share/common-licenses/GPL-2'.\nEOF\n\n# Generate a control file\ncat <<EOF > debian/control\nSource: $sourcename\nSection: kernel\nPriority: optional\nMaintainer: $maintainer\nRules-Requires-Root: no\nBuild-Depends: bc, debhelper, rsync, kmod, cpio, bison, flex $extra_build_depends\nHomepage: https://www.kernel.org/\n\nPackage: $packagename-$version\nArchitecture: $debarch\nDescription: Linux kernel, version $version\n This package contains the Linux kernel, modules and corresponding other\n files, version: $version.\nEOF\n\nif [ \"${SRCARCH}\" != um ]; then\ncat <<EOF >> debian/control\n\nPackage: linux-libc-dev\nSection: devel\nProvides: linux-kernel-headers\nArchitecture: $debarch\nDescription: Linux support headers for userspace development\n This package provides userspaces headers from the Linux kernel.  These headers\n are used by the installed headers for GNU glibc and other system libraries.\nMulti-Arch: same\nEOF\n\nif is_enabled CONFIG_MODULES; then\ncat <<EOF >> debian/control\n\nPackage: linux-headers-$version\nArchitecture: $debarch\nDescription: Linux kernel headers for $version on $debarch\n This package provides kernel header files for $version on $debarch\n .\n This is useful for people who need to build external modules\nEOF\nfi\nfi\n\nif is_enabled CONFIG_DEBUG_INFO; then\ncat <<EOF >> debian/control\n\nPackage: linux-image-$version-dbg\nSection: debug\nArchitecture: $debarch\nDescription: Linux kernel debugging symbols for $version\n This package will come in handy if you need to debug the kernel. It provides\n all the necessary debug symbols for the kernel and its modules.\nEOF\nfi\n\ncat <<EOF > debian/rules.vars\nARCH := ${ARCH}\nKERNELRELEASE := ${KERNELRELEASE}\nEOF\n\ncp \"${srctree}/scripts/package/debian/rules\" debian/\n\nexit 0\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}