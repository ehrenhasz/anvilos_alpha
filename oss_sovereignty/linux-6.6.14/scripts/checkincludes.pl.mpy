{
  "module_name": "checkincludes.pl",
  "hash_id": "3796d5742aeb48bc3840935524c9312c554c0486eccd228dab12a080e23dc4e7",
  "original_prompt": "Ingested from linux-6.6.14/scripts/checkincludes.pl",
  "human_readable_source": "#!/usr/bin/env perl\n# SPDX-License-Identifier: GPL-2.0\n#\n# checkincludes: find/remove files included more than once\n#\n# Copyright abandoned, 2000, Niels Kristian Bech Jensen <nkbj@image.dk>.\n# Copyright 2009 Luis R. Rodriguez <mcgrof@gmail.com>\n#\n# This script checks for duplicate includes. It also has support\n# to remove them in place. Note that this will not take into\n# consideration macros so you should run this only if you know\n# you do have real dups and do not have them under #ifdef's. You\n# could also just review the results.\n\nuse strict;\n\nsub usage {\n\tprint \"Usage: checkincludes.pl [-r]\\n\";\n\tprint \"By default we just warn of duplicates\\n\";\n\tprint \"To remove duplicated includes in place use -r\\n\";\n\texit 1;\n}\n\nmy $remove = 0;\n\nif ($#ARGV < 0) {\n\tusage();\n}\n\nif ($#ARGV >= 1) {\n\tif ($ARGV[0] =~ /^-/) {\n\t\tif ($ARGV[0] eq \"-r\") {\n\t\t\t$remove = 1;\n\t\t\tshift;\n\t\t} else {\n\t\t\tusage();\n\t\t}\n\t}\n}\n\nmy $dup_counter = 0;\n\nforeach my $file (@ARGV) {\n\topen(my $f, '<', $file)\n\t    or die \"Cannot open $file: $!.\\n\";\n\n\tmy %includedfiles = ();\n\tmy @file_lines = ();\n\n\twhile (<$f>) {\n\t\tif (m/^\\s*#\\s*include\\s*[<\"](\\S*)[>\"]/o) {\n\t\t\t++$includedfiles{$1};\n\t\t}\n\t\tpush(@file_lines, $_);\n\t}\n\n\tclose($f);\n\n\tif (!$remove) {\n\t\tforeach my $filename (keys %includedfiles) {\n\t\t\tif ($includedfiles{$filename} > 1) {\n\t\t\t\tprint \"$file: $filename is included more than once.\\n\";\n\t\t\t\t++$dup_counter;\n\t\t\t}\n\t\t}\n\t\tnext;\n\t}\n\n\topen($f, '>', $file)\n\t    or die(\"Cannot write to $file: $!\");\n\n\tmy $dups = 0;\n\tforeach (@file_lines) {\n\t\tif (m/^\\s*#\\s*include\\s*[<\"](\\S*)[>\"]/o) {\n\t\t\tforeach my $filename (keys %includedfiles) {\n\t\t\t\tif ($1 eq $filename) {\n\t\t\t\t\tif ($includedfiles{$filename} > 1) {\n\t\t\t\t\t\t$includedfiles{$filename}--;\n\t\t\t\t\t\t$dups++;\n\t\t\t\t\t\t++$dup_counter;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tprint {$f} $_;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tprint {$f} $_;\n\t\t}\n\t}\n\tif ($dups > 0) {\n\t\tprint \"$file: removed $dups duplicate includes\\n\";\n\t}\n\tclose($f);\n}\n\nif ($dup_counter == 0) {\n\tprint \"No duplicate includes found.\\n\";\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}