{
  "module_name": "common.h",
  "hash_id": "861781f4bdfe9a47d1241513b7631a01c94bd9ad988caa0da2e6a8cd5632ff69",
  "original_prompt": "Ingested from linux-6.6.14/security/tomoyo/common.h",
  "human_readable_source": " \n \n\n#ifndef _SECURITY_TOMOYO_COMMON_H\n#define _SECURITY_TOMOYO_COMMON_H\n\n#define pr_fmt(fmt) fmt\n\n#include <linux/ctype.h>\n#include <linux/string.h>\n#include <linux/mm.h>\n#include <linux/file.h>\n#include <linux/kmod.h>\n#include <linux/fs.h>\n#include <linux/sched.h>\n#include <linux/namei.h>\n#include <linux/mount.h>\n#include <linux/list.h>\n#include <linux/cred.h>\n#include <linux/poll.h>\n#include <linux/binfmts.h>\n#include <linux/highmem.h>\n#include <linux/net.h>\n#include <linux/inet.h>\n#include <linux/in.h>\n#include <linux/in6.h>\n#include <linux/un.h>\n#include <linux/lsm_hooks.h>\n#include <net/sock.h>\n#include <net/af_unix.h>\n#include <net/ip.h>\n#include <net/ipv6.h>\n#include <net/udp.h>\n\n \n\n \n#define TOMOYO_HASH_BITS  8\n#define TOMOYO_MAX_HASH (1u<<TOMOYO_HASH_BITS)\n\n \n#define TOMOYO_SOCK_MAX 6\n\n#define TOMOYO_EXEC_TMPSIZE     4096\n\n \n#define TOMOYO_GC_IN_PROGRESS -1\n\n \n#define TOMOYO_MAX_PROFILES 256\n\n \n#define TOMOYO_MAX_ACL_GROUPS 256\n\n \nenum tomoyo_conditions_index {\n\tTOMOYO_TASK_UID,              \n\tTOMOYO_TASK_EUID,             \n\tTOMOYO_TASK_SUID,             \n\tTOMOYO_TASK_FSUID,            \n\tTOMOYO_TASK_GID,              \n\tTOMOYO_TASK_EGID,             \n\tTOMOYO_TASK_SGID,             \n\tTOMOYO_TASK_FSGID,            \n\tTOMOYO_TASK_PID,              \n\tTOMOYO_TASK_PPID,             \n\tTOMOYO_EXEC_ARGC,             \n\tTOMOYO_EXEC_ENVC,             \n\tTOMOYO_TYPE_IS_SOCKET,        \n\tTOMOYO_TYPE_IS_SYMLINK,       \n\tTOMOYO_TYPE_IS_FILE,          \n\tTOMOYO_TYPE_IS_BLOCK_DEV,     \n\tTOMOYO_TYPE_IS_DIRECTORY,     \n\tTOMOYO_TYPE_IS_CHAR_DEV,      \n\tTOMOYO_TYPE_IS_FIFO,          \n\tTOMOYO_MODE_SETUID,           \n\tTOMOYO_MODE_SETGID,           \n\tTOMOYO_MODE_STICKY,           \n\tTOMOYO_MODE_OWNER_READ,       \n\tTOMOYO_MODE_OWNER_WRITE,      \n\tTOMOYO_MODE_OWNER_EXECUTE,    \n\tTOMOYO_MODE_GROUP_READ,       \n\tTOMOYO_MODE_GROUP_WRITE,      \n\tTOMOYO_MODE_GROUP_EXECUTE,    \n\tTOMOYO_MODE_OTHERS_READ,      \n\tTOMOYO_MODE_OTHERS_WRITE,     \n\tTOMOYO_MODE_OTHERS_EXECUTE,   \n\tTOMOYO_EXEC_REALPATH,\n\tTOMOYO_SYMLINK_TARGET,\n\tTOMOYO_PATH1_UID,\n\tTOMOYO_PATH1_GID,\n\tTOMOYO_PATH1_INO,\n\tTOMOYO_PATH1_MAJOR,\n\tTOMOYO_PATH1_MINOR,\n\tTOMOYO_PATH1_PERM,\n\tTOMOYO_PATH1_TYPE,\n\tTOMOYO_PATH1_DEV_MAJOR,\n\tTOMOYO_PATH1_DEV_MINOR,\n\tTOMOYO_PATH2_UID,\n\tTOMOYO_PATH2_GID,\n\tTOMOYO_PATH2_INO,\n\tTOMOYO_PATH2_MAJOR,\n\tTOMOYO_PATH2_MINOR,\n\tTOMOYO_PATH2_PERM,\n\tTOMOYO_PATH2_TYPE,\n\tTOMOYO_PATH2_DEV_MAJOR,\n\tTOMOYO_PATH2_DEV_MINOR,\n\tTOMOYO_PATH1_PARENT_UID,\n\tTOMOYO_PATH1_PARENT_GID,\n\tTOMOYO_PATH1_PARENT_INO,\n\tTOMOYO_PATH1_PARENT_PERM,\n\tTOMOYO_PATH2_PARENT_UID,\n\tTOMOYO_PATH2_PARENT_GID,\n\tTOMOYO_PATH2_PARENT_INO,\n\tTOMOYO_PATH2_PARENT_PERM,\n\tTOMOYO_MAX_CONDITION_KEYWORD,\n\tTOMOYO_NUMBER_UNION,\n\tTOMOYO_NAME_UNION,\n\tTOMOYO_ARGV_ENTRY,\n\tTOMOYO_ENVP_ENTRY,\n};\n\n\n \nenum tomoyo_path_stat_index {\n\t \n\tTOMOYO_PATH1,\n\tTOMOYO_PATH1_PARENT,\n\tTOMOYO_PATH2,\n\tTOMOYO_PATH2_PARENT,\n\tTOMOYO_MAX_PATH_STAT\n};\n\n \nenum tomoyo_mode_index {\n\tTOMOYO_CONFIG_DISABLED,\n\tTOMOYO_CONFIG_LEARNING,\n\tTOMOYO_CONFIG_PERMISSIVE,\n\tTOMOYO_CONFIG_ENFORCING,\n\tTOMOYO_CONFIG_MAX_MODE,\n\tTOMOYO_CONFIG_WANT_REJECT_LOG =  64,\n\tTOMOYO_CONFIG_WANT_GRANT_LOG  = 128,\n\tTOMOYO_CONFIG_USE_DEFAULT     = 255,\n};\n\n \nenum tomoyo_policy_id {\n\tTOMOYO_ID_GROUP,\n\tTOMOYO_ID_ADDRESS_GROUP,\n\tTOMOYO_ID_PATH_GROUP,\n\tTOMOYO_ID_NUMBER_GROUP,\n\tTOMOYO_ID_TRANSITION_CONTROL,\n\tTOMOYO_ID_AGGREGATOR,\n\tTOMOYO_ID_MANAGER,\n\tTOMOYO_ID_CONDITION,\n\tTOMOYO_ID_NAME,\n\tTOMOYO_ID_ACL,\n\tTOMOYO_ID_DOMAIN,\n\tTOMOYO_MAX_POLICY\n};\n\n \nenum tomoyo_domain_info_flags_index {\n\t \n\tTOMOYO_DIF_QUOTA_WARNED,\n\t \n\tTOMOYO_DIF_TRANSITION_FAILED,\n\tTOMOYO_MAX_DOMAIN_INFO_FLAGS\n};\n\n \nenum tomoyo_grant_log {\n\t \n\tTOMOYO_GRANTLOG_AUTO,\n\t \n\tTOMOYO_GRANTLOG_NO,\n\t \n\tTOMOYO_GRANTLOG_YES,\n};\n\n \nenum tomoyo_group_id {\n\tTOMOYO_PATH_GROUP,\n\tTOMOYO_NUMBER_GROUP,\n\tTOMOYO_ADDRESS_GROUP,\n\tTOMOYO_MAX_GROUP\n};\n\n \nenum tomoyo_value_type {\n\tTOMOYO_VALUE_TYPE_INVALID,\n\tTOMOYO_VALUE_TYPE_DECIMAL,\n\tTOMOYO_VALUE_TYPE_OCTAL,\n\tTOMOYO_VALUE_TYPE_HEXADECIMAL,\n};\n\n \nenum tomoyo_transition_type {\n\t \n\tTOMOYO_TRANSITION_CONTROL_NO_RESET,\n\tTOMOYO_TRANSITION_CONTROL_RESET,\n\tTOMOYO_TRANSITION_CONTROL_NO_INITIALIZE,\n\tTOMOYO_TRANSITION_CONTROL_INITIALIZE,\n\tTOMOYO_TRANSITION_CONTROL_NO_KEEP,\n\tTOMOYO_TRANSITION_CONTROL_KEEP,\n\tTOMOYO_MAX_TRANSITION_TYPE\n};\n\n \nenum tomoyo_acl_entry_type_index {\n\tTOMOYO_TYPE_PATH_ACL,\n\tTOMOYO_TYPE_PATH2_ACL,\n\tTOMOYO_TYPE_PATH_NUMBER_ACL,\n\tTOMOYO_TYPE_MKDEV_ACL,\n\tTOMOYO_TYPE_MOUNT_ACL,\n\tTOMOYO_TYPE_INET_ACL,\n\tTOMOYO_TYPE_UNIX_ACL,\n\tTOMOYO_TYPE_ENV_ACL,\n\tTOMOYO_TYPE_MANUAL_TASK_ACL,\n};\n\n \nenum tomoyo_path_acl_index {\n\tTOMOYO_TYPE_EXECUTE,\n\tTOMOYO_TYPE_READ,\n\tTOMOYO_TYPE_WRITE,\n\tTOMOYO_TYPE_APPEND,\n\tTOMOYO_TYPE_UNLINK,\n\tTOMOYO_TYPE_GETATTR,\n\tTOMOYO_TYPE_RMDIR,\n\tTOMOYO_TYPE_TRUNCATE,\n\tTOMOYO_TYPE_SYMLINK,\n\tTOMOYO_TYPE_CHROOT,\n\tTOMOYO_TYPE_UMOUNT,\n\tTOMOYO_MAX_PATH_OPERATION\n};\n\n \nenum tomoyo_memory_stat_type {\n\tTOMOYO_MEMORY_POLICY,\n\tTOMOYO_MEMORY_AUDIT,\n\tTOMOYO_MEMORY_QUERY,\n\tTOMOYO_MAX_MEMORY_STAT\n};\n\nenum tomoyo_mkdev_acl_index {\n\tTOMOYO_TYPE_MKBLOCK,\n\tTOMOYO_TYPE_MKCHAR,\n\tTOMOYO_MAX_MKDEV_OPERATION\n};\n\n \nenum tomoyo_network_acl_index {\n\tTOMOYO_NETWORK_BIND,     \n\tTOMOYO_NETWORK_LISTEN,   \n\tTOMOYO_NETWORK_CONNECT,  \n\tTOMOYO_NETWORK_SEND,     \n\tTOMOYO_MAX_NETWORK_OPERATION\n};\n\n \nenum tomoyo_path2_acl_index {\n\tTOMOYO_TYPE_LINK,\n\tTOMOYO_TYPE_RENAME,\n\tTOMOYO_TYPE_PIVOT_ROOT,\n\tTOMOYO_MAX_PATH2_OPERATION\n};\n\n \nenum tomoyo_path_number_acl_index {\n\tTOMOYO_TYPE_CREATE,\n\tTOMOYO_TYPE_MKDIR,\n\tTOMOYO_TYPE_MKFIFO,\n\tTOMOYO_TYPE_MKSOCK,\n\tTOMOYO_TYPE_IOCTL,\n\tTOMOYO_TYPE_CHMOD,\n\tTOMOYO_TYPE_CHOWN,\n\tTOMOYO_TYPE_CHGRP,\n\tTOMOYO_MAX_PATH_NUMBER_OPERATION\n};\n\n \nenum tomoyo_securityfs_interface_index {\n\tTOMOYO_DOMAINPOLICY,\n\tTOMOYO_EXCEPTIONPOLICY,\n\tTOMOYO_PROCESS_STATUS,\n\tTOMOYO_STAT,\n\tTOMOYO_AUDIT,\n\tTOMOYO_VERSION,\n\tTOMOYO_PROFILE,\n\tTOMOYO_QUERY,\n\tTOMOYO_MANAGER\n};\n\n \nenum tomoyo_special_mount {\n\tTOMOYO_MOUNT_BIND,             \n\tTOMOYO_MOUNT_MOVE,             \n\tTOMOYO_MOUNT_REMOUNT,          \n\tTOMOYO_MOUNT_MAKE_UNBINDABLE,  \n\tTOMOYO_MOUNT_MAKE_PRIVATE,     \n\tTOMOYO_MOUNT_MAKE_SLAVE,       \n\tTOMOYO_MOUNT_MAKE_SHARED,      \n\tTOMOYO_MAX_SPECIAL_MOUNT\n};\n\n \nenum tomoyo_mac_index {\n\tTOMOYO_MAC_FILE_EXECUTE,\n\tTOMOYO_MAC_FILE_OPEN,\n\tTOMOYO_MAC_FILE_CREATE,\n\tTOMOYO_MAC_FILE_UNLINK,\n\tTOMOYO_MAC_FILE_GETATTR,\n\tTOMOYO_MAC_FILE_MKDIR,\n\tTOMOYO_MAC_FILE_RMDIR,\n\tTOMOYO_MAC_FILE_MKFIFO,\n\tTOMOYO_MAC_FILE_MKSOCK,\n\tTOMOYO_MAC_FILE_TRUNCATE,\n\tTOMOYO_MAC_FILE_SYMLINK,\n\tTOMOYO_MAC_FILE_MKBLOCK,\n\tTOMOYO_MAC_FILE_MKCHAR,\n\tTOMOYO_MAC_FILE_LINK,\n\tTOMOYO_MAC_FILE_RENAME,\n\tTOMOYO_MAC_FILE_CHMOD,\n\tTOMOYO_MAC_FILE_CHOWN,\n\tTOMOYO_MAC_FILE_CHGRP,\n\tTOMOYO_MAC_FILE_IOCTL,\n\tTOMOYO_MAC_FILE_CHROOT,\n\tTOMOYO_MAC_FILE_MOUNT,\n\tTOMOYO_MAC_FILE_UMOUNT,\n\tTOMOYO_MAC_FILE_PIVOT_ROOT,\n\tTOMOYO_MAC_NETWORK_INET_STREAM_BIND,\n\tTOMOYO_MAC_NETWORK_INET_STREAM_LISTEN,\n\tTOMOYO_MAC_NETWORK_INET_STREAM_CONNECT,\n\tTOMOYO_MAC_NETWORK_INET_DGRAM_BIND,\n\tTOMOYO_MAC_NETWORK_INET_DGRAM_SEND,\n\tTOMOYO_MAC_NETWORK_INET_RAW_BIND,\n\tTOMOYO_MAC_NETWORK_INET_RAW_SEND,\n\tTOMOYO_MAC_NETWORK_UNIX_STREAM_BIND,\n\tTOMOYO_MAC_NETWORK_UNIX_STREAM_LISTEN,\n\tTOMOYO_MAC_NETWORK_UNIX_STREAM_CONNECT,\n\tTOMOYO_MAC_NETWORK_UNIX_DGRAM_BIND,\n\tTOMOYO_MAC_NETWORK_UNIX_DGRAM_SEND,\n\tTOMOYO_MAC_NETWORK_UNIX_SEQPACKET_BIND,\n\tTOMOYO_MAC_NETWORK_UNIX_SEQPACKET_LISTEN,\n\tTOMOYO_MAC_NETWORK_UNIX_SEQPACKET_CONNECT,\n\tTOMOYO_MAC_ENVIRON,\n\tTOMOYO_MAX_MAC_INDEX\n};\n\n \nenum tomoyo_mac_category_index {\n\tTOMOYO_MAC_CATEGORY_FILE,\n\tTOMOYO_MAC_CATEGORY_NETWORK,\n\tTOMOYO_MAC_CATEGORY_MISC,\n\tTOMOYO_MAX_MAC_CATEGORY_INDEX\n};\n\n \n#define TOMOYO_RETRY_REQUEST 1\n\n \nenum tomoyo_policy_stat_type {\n\t \n\tTOMOYO_STAT_POLICY_UPDATES,\n\tTOMOYO_STAT_POLICY_LEARNING,    \n\tTOMOYO_STAT_POLICY_PERMISSIVE,  \n\tTOMOYO_STAT_POLICY_ENFORCING,   \n\tTOMOYO_MAX_POLICY_STAT\n};\n\n \nenum tomoyo_pref_index {\n\tTOMOYO_PREF_MAX_AUDIT_LOG,\n\tTOMOYO_PREF_MAX_LEARNING_ENTRY,\n\tTOMOYO_MAX_PREF\n};\n\n \n\n \nstruct tomoyo_acl_head {\n\tstruct list_head list;\n\ts8 is_deleted;  \n} __packed;\n\n \nstruct tomoyo_shared_acl_head {\n\tstruct list_head list;\n\tatomic_t users;\n} __packed;\n\nstruct tomoyo_policy_namespace;\n\n \nstruct tomoyo_request_info {\n\t \n\tstruct tomoyo_obj_info *obj;\n\t \n\tstruct tomoyo_execve *ee;\n\tstruct tomoyo_domain_info *domain;\n\t \n\tunion {\n\t\tstruct {\n\t\t\tconst struct tomoyo_path_info *filename;\n\t\t\t \n\t\t\tconst struct tomoyo_path_info *matched_path;\n\t\t\t \n\t\t\tu8 operation;\n\t\t} path;\n\t\tstruct {\n\t\t\tconst struct tomoyo_path_info *filename1;\n\t\t\tconst struct tomoyo_path_info *filename2;\n\t\t\t \n\t\t\tu8 operation;\n\t\t} path2;\n\t\tstruct {\n\t\t\tconst struct tomoyo_path_info *filename;\n\t\t\tunsigned int mode;\n\t\t\tunsigned int major;\n\t\t\tunsigned int minor;\n\t\t\t \n\t\t\tu8 operation;\n\t\t} mkdev;\n\t\tstruct {\n\t\t\tconst struct tomoyo_path_info *filename;\n\t\t\tunsigned long number;\n\t\t\t \n\t\t\tu8 operation;\n\t\t} path_number;\n\t\tstruct {\n\t\t\tconst struct tomoyo_path_info *name;\n\t\t} environ;\n\t\tstruct {\n\t\t\tconst __be32 *address;\n\t\t\tu16 port;\n\t\t\t \n\t\t\tu8 protocol;\n\t\t\t \n\t\t\tu8 operation;\n\t\t\tbool is_ipv6;\n\t\t} inet_network;\n\t\tstruct {\n\t\t\tconst struct tomoyo_path_info *address;\n\t\t\t \n\t\t\tu8 protocol;\n\t\t\t \n\t\t\tu8 operation;\n\t\t} unix_network;\n\t\tstruct {\n\t\t\tconst struct tomoyo_path_info *type;\n\t\t\tconst struct tomoyo_path_info *dir;\n\t\t\tconst struct tomoyo_path_info *dev;\n\t\t\tunsigned long flags;\n\t\t\tint need_dev;\n\t\t} mount;\n\t\tstruct {\n\t\t\tconst struct tomoyo_path_info *domainname;\n\t\t} task;\n\t} param;\n\tstruct tomoyo_acl_info *matched_acl;\n\tu8 param_type;\n\tbool granted;\n\tu8 retry;\n\tu8 profile;\n\tu8 mode;  \n\tu8 type;\n};\n\n \nstruct tomoyo_path_info {\n\tconst char *name;\n\tu32 hash;           \n\tu16 const_len;      \n\tbool is_dir;        \n\tbool is_patterned;  \n};\n\n \nstruct tomoyo_name {\n\tstruct tomoyo_shared_acl_head head;\n\tstruct tomoyo_path_info entry;\n};\n\n \nstruct tomoyo_name_union {\n\t \n\tconst struct tomoyo_path_info *filename;\n\tstruct tomoyo_group *group;\n};\n\n \nstruct tomoyo_number_union {\n\tunsigned long values[2];\n\tstruct tomoyo_group *group;  \n\t \n\tu8 value_type[2];\n};\n\n \nstruct tomoyo_ipaddr_union {\n\tstruct in6_addr ip[2];  \n\tstruct tomoyo_group *group;  \n\tbool is_ipv6;  \n};\n\n \nstruct tomoyo_group {\n\tstruct tomoyo_shared_acl_head head;\n\tconst struct tomoyo_path_info *group_name;\n\tstruct list_head member_list;\n};\n\n \nstruct tomoyo_path_group {\n\tstruct tomoyo_acl_head head;\n\tconst struct tomoyo_path_info *member_name;\n};\n\n \nstruct tomoyo_number_group {\n\tstruct tomoyo_acl_head head;\n\tstruct tomoyo_number_union number;\n};\n\n \nstruct tomoyo_address_group {\n\tstruct tomoyo_acl_head head;\n\t \n\tstruct tomoyo_ipaddr_union address;\n};\n\n \nstruct tomoyo_mini_stat {\n\tkuid_t uid;\n\tkgid_t gid;\n\tino_t ino;\n\tumode_t mode;\n\tdev_t dev;\n\tdev_t rdev;\n};\n\n \nstruct tomoyo_page_dump {\n\tstruct page *page;     \n\tchar *data;            \n};\n\n \nstruct tomoyo_obj_info {\n\t \n\tbool validate_done;\n\t \n\tbool stat_valid[TOMOYO_MAX_PATH_STAT];\n\t \n\tstruct path path1;\n\t \n\tstruct path path2;\n\t \n\tstruct tomoyo_mini_stat stat[TOMOYO_MAX_PATH_STAT];\n\t \n\tstruct tomoyo_path_info *symlink_target;\n};\n\n \nstruct tomoyo_argv {\n\tunsigned long index;\n\tconst struct tomoyo_path_info *value;\n\tbool is_not;\n};\n\n \nstruct tomoyo_envp {\n\tconst struct tomoyo_path_info *name;\n\tconst struct tomoyo_path_info *value;\n\tbool is_not;\n};\n\n \nstruct tomoyo_execve {\n\tstruct tomoyo_request_info r;\n\tstruct tomoyo_obj_info obj;\n\tstruct linux_binprm *bprm;\n\tconst struct tomoyo_path_info *transition;\n\t \n\tstruct tomoyo_page_dump dump;\n\t \n\tchar *tmp;  \n};\n\n \nstruct tomoyo_condition_element {\n\t \n\tu8 left;\n\t \n\tu8 right;\n\t \n\tbool equals;\n};\n\n \nstruct tomoyo_condition {\n\tstruct tomoyo_shared_acl_head head;\n\tu32 size;  \n\tu16 condc;  \n\tu16 numbers_count;  \n\tu16 names_count;  \n\tu16 argc;  \n\tu16 envc;  \n\tu8 grant_log;  \n\tconst struct tomoyo_path_info *transit;  \n\t \n};\n\n \nstruct tomoyo_acl_info {\n\tstruct list_head list;\n\tstruct tomoyo_condition *cond;  \n\ts8 is_deleted;  \n\tu8 type;  \n} __packed;\n\n \nstruct tomoyo_domain_info {\n\tstruct list_head list;\n\tstruct list_head acl_info_list;\n\t \n\tconst struct tomoyo_path_info *domainname;\n\t \n\tstruct tomoyo_policy_namespace *ns;\n\t \n\tunsigned long group[TOMOYO_MAX_ACL_GROUPS / BITS_PER_LONG];\n\tu8 profile;         \n\tbool is_deleted;    \n\tbool flags[TOMOYO_MAX_DOMAIN_INFO_FLAGS];\n\tatomic_t users;  \n};\n\n \nstruct tomoyo_task_acl {\n\tstruct tomoyo_acl_info head;  \n\t \n\tconst struct tomoyo_path_info *domainname;\n};\n\n \nstruct tomoyo_path_acl {\n\tstruct tomoyo_acl_info head;  \n\tu16 perm;  \n\tstruct tomoyo_name_union name;\n};\n\n \nstruct tomoyo_path_number_acl {\n\tstruct tomoyo_acl_info head;  \n\t \n\tu8 perm;\n\tstruct tomoyo_name_union name;\n\tstruct tomoyo_number_union number;\n};\n\n \nstruct tomoyo_mkdev_acl {\n\tstruct tomoyo_acl_info head;  \n\tu8 perm;  \n\tstruct tomoyo_name_union name;\n\tstruct tomoyo_number_union mode;\n\tstruct tomoyo_number_union major;\n\tstruct tomoyo_number_union minor;\n};\n\n \nstruct tomoyo_path2_acl {\n\tstruct tomoyo_acl_info head;  \n\tu8 perm;  \n\tstruct tomoyo_name_union name1;\n\tstruct tomoyo_name_union name2;\n};\n\n \nstruct tomoyo_mount_acl {\n\tstruct tomoyo_acl_info head;  \n\tstruct tomoyo_name_union dev_name;\n\tstruct tomoyo_name_union dir_name;\n\tstruct tomoyo_name_union fs_type;\n\tstruct tomoyo_number_union flags;\n};\n\n \nstruct tomoyo_env_acl {\n\tstruct tomoyo_acl_info head;         \n\tconst struct tomoyo_path_info *env;  \n};\n\n \nstruct tomoyo_inet_acl {\n\tstruct tomoyo_acl_info head;  \n\tu8 protocol;\n\tu8 perm;  \n\tstruct tomoyo_ipaddr_union address;\n\tstruct tomoyo_number_union port;\n};\n\n \nstruct tomoyo_unix_acl {\n\tstruct tomoyo_acl_info head;  \n\tu8 protocol;\n\tu8 perm;  \n\tstruct tomoyo_name_union name;\n};\n\n \nstruct tomoyo_acl_param {\n\tchar *data;\n\tstruct list_head *list;\n\tstruct tomoyo_policy_namespace *ns;\n\tbool is_delete;\n};\n\n#define TOMOYO_MAX_IO_READ_QUEUE 64\n\n \nstruct tomoyo_io_buffer {\n\tvoid (*read)(struct tomoyo_io_buffer *head);\n\tint (*write)(struct tomoyo_io_buffer *head);\n\t__poll_t (*poll)(struct file *file, poll_table *wait);\n\t \n\tstruct mutex io_sem;\n\tchar __user *read_user_buf;\n\tsize_t read_user_buf_avail;\n\tstruct {\n\t\tstruct list_head *ns;\n\t\tstruct list_head *domain;\n\t\tstruct list_head *group;\n\t\tstruct list_head *acl;\n\t\tsize_t avail;\n\t\tunsigned int step;\n\t\tunsigned int query_index;\n\t\tu16 index;\n\t\tu16 cond_index;\n\t\tu8 acl_group_index;\n\t\tu8 cond_step;\n\t\tu8 bit;\n\t\tu8 w_pos;\n\t\tbool eof;\n\t\tbool print_this_domain_only;\n\t\tbool print_transition_related_only;\n\t\tbool print_cond_part;\n\t\tconst char *w[TOMOYO_MAX_IO_READ_QUEUE];\n\t} r;\n\tstruct {\n\t\tstruct tomoyo_policy_namespace *ns;\n\t\t \n\t\tstruct tomoyo_domain_info *domain;\n\t\t \n\t\tsize_t avail;\n\t\tbool is_delete;\n\t} w;\n\t \n\tchar *read_buf;\n\t \n\tsize_t readbuf_size;\n\t \n\tchar *write_buf;\n\t \n\tsize_t writebuf_size;\n\t \n\tenum tomoyo_securityfs_interface_index type;\n\t \n\tu8 users;\n\t \n\tstruct list_head list;\n};\n\n \nstruct tomoyo_transition_control {\n\tstruct tomoyo_acl_head head;\n\tu8 type;  \n\t \n\tbool is_last_name;\n\tconst struct tomoyo_path_info *domainname;  \n\tconst struct tomoyo_path_info *program;     \n};\n\n \nstruct tomoyo_aggregator {\n\tstruct tomoyo_acl_head head;\n\tconst struct tomoyo_path_info *original_name;\n\tconst struct tomoyo_path_info *aggregated_name;\n};\n\n \nstruct tomoyo_manager {\n\tstruct tomoyo_acl_head head;\n\t \n\tconst struct tomoyo_path_info *manager;\n};\n\nstruct tomoyo_preference {\n\tunsigned int learning_max_entry;\n\tbool enforcing_verbose;\n\tbool learning_verbose;\n\tbool permissive_verbose;\n};\n\n \nstruct tomoyo_profile {\n\tconst struct tomoyo_path_info *comment;\n\tstruct tomoyo_preference *learning;\n\tstruct tomoyo_preference *permissive;\n\tstruct tomoyo_preference *enforcing;\n\tstruct tomoyo_preference preference;\n\tu8 default_config;\n\tu8 config[TOMOYO_MAX_MAC_INDEX + TOMOYO_MAX_MAC_CATEGORY_INDEX];\n\tunsigned int pref[TOMOYO_MAX_PREF];\n};\n\n \nstruct tomoyo_time {\n\tu16 year;\n\tu8 month;\n\tu8 day;\n\tu8 hour;\n\tu8 min;\n\tu8 sec;\n};\n\n \nstruct tomoyo_policy_namespace {\n\t \n\tstruct tomoyo_profile *profile_ptr[TOMOYO_MAX_PROFILES];\n\t \n\tstruct list_head group_list[TOMOYO_MAX_GROUP];\n\t \n\tstruct list_head policy_list[TOMOYO_MAX_POLICY];\n\t \n\tstruct list_head acl_group[TOMOYO_MAX_ACL_GROUPS];\n\t \n\tstruct list_head namespace_list;\n\t \n\tunsigned int profile_version;\n\t \n\tconst char *name;\n};\n\n \nstruct tomoyo_task {\n\tstruct tomoyo_domain_info *domain_info;\n\tstruct tomoyo_domain_info *old_domain_info;\n};\n\n \n\nbool tomoyo_address_matches_group(const bool is_ipv6, const __be32 *address,\n\t\t\t\t  const struct tomoyo_group *group);\nbool tomoyo_compare_number_union(const unsigned long value,\n\t\t\t\t const struct tomoyo_number_union *ptr);\nbool tomoyo_condition(struct tomoyo_request_info *r,\n\t\t      const struct tomoyo_condition *cond);\nbool tomoyo_correct_domain(const unsigned char *domainname);\nbool tomoyo_correct_path(const char *filename);\nbool tomoyo_correct_word(const char *string);\nbool tomoyo_domain_def(const unsigned char *buffer);\nbool tomoyo_domain_quota_is_ok(struct tomoyo_request_info *r);\nbool tomoyo_dump_page(struct linux_binprm *bprm, unsigned long pos,\n\t\t      struct tomoyo_page_dump *dump);\nbool tomoyo_memory_ok(void *ptr);\nbool tomoyo_number_matches_group(const unsigned long min,\n\t\t\t\t const unsigned long max,\n\t\t\t\t const struct tomoyo_group *group);\nbool tomoyo_parse_ipaddr_union(struct tomoyo_acl_param *param,\n\t\t\t       struct tomoyo_ipaddr_union *ptr);\nbool tomoyo_parse_name_union(struct tomoyo_acl_param *param,\n\t\t\t     struct tomoyo_name_union *ptr);\nbool tomoyo_parse_number_union(struct tomoyo_acl_param *param,\n\t\t\t       struct tomoyo_number_union *ptr);\nbool tomoyo_path_matches_pattern(const struct tomoyo_path_info *filename,\n\t\t\t\t const struct tomoyo_path_info *pattern);\nbool tomoyo_permstr(const char *string, const char *keyword);\nbool tomoyo_str_starts(char **src, const char *find);\nchar *tomoyo_encode(const char *str);\nchar *tomoyo_encode2(const char *str, int str_len);\nchar *tomoyo_init_log(struct tomoyo_request_info *r, int len, const char *fmt,\n\t\t      va_list args) __printf(3, 0);\nchar *tomoyo_read_token(struct tomoyo_acl_param *param);\nchar *tomoyo_realpath_from_path(const struct path *path);\nchar *tomoyo_realpath_nofollow(const char *pathname);\nconst char *tomoyo_get_exe(void);\nconst struct tomoyo_path_info *tomoyo_compare_name_union\n(const struct tomoyo_path_info *name, const struct tomoyo_name_union *ptr);\nconst struct tomoyo_path_info *tomoyo_get_domainname\n(struct tomoyo_acl_param *param);\nconst struct tomoyo_path_info *tomoyo_get_name(const char *name);\nconst struct tomoyo_path_info *tomoyo_path_matches_group\n(const struct tomoyo_path_info *pathname, const struct tomoyo_group *group);\nint tomoyo_check_open_permission(struct tomoyo_domain_info *domain,\n\t\t\t\t const struct path *path, const int flag);\nvoid tomoyo_close_control(struct tomoyo_io_buffer *head);\nint tomoyo_env_perm(struct tomoyo_request_info *r, const char *env);\nint tomoyo_execute_permission(struct tomoyo_request_info *r,\n\t\t\t      const struct tomoyo_path_info *filename);\nint tomoyo_find_next_domain(struct linux_binprm *bprm);\nint tomoyo_get_mode(const struct tomoyo_policy_namespace *ns, const u8 profile,\n\t\t    const u8 index);\nint tomoyo_init_request_info(struct tomoyo_request_info *r,\n\t\t\t     struct tomoyo_domain_info *domain,\n\t\t\t     const u8 index);\nint tomoyo_mkdev_perm(const u8 operation, const struct path *path,\n\t\t      const unsigned int mode, unsigned int dev);\nint tomoyo_mount_permission(const char *dev_name, const struct path *path,\n\t\t\t    const char *type, unsigned long flags,\n\t\t\t    void *data_page);\nint tomoyo_open_control(const u8 type, struct file *file);\nint tomoyo_path2_perm(const u8 operation, const struct path *path1,\n\t\t      const struct path *path2);\nint tomoyo_path_number_perm(const u8 operation, const struct path *path,\n\t\t\t    unsigned long number);\nint tomoyo_path_perm(const u8 operation, const struct path *path,\n\t\t     const char *target);\n__poll_t tomoyo_poll_control(struct file *file, poll_table *wait);\n__poll_t tomoyo_poll_log(struct file *file, poll_table *wait);\nint tomoyo_socket_bind_permission(struct socket *sock, struct sockaddr *addr,\n\t\t\t\t  int addr_len);\nint tomoyo_socket_connect_permission(struct socket *sock,\n\t\t\t\t     struct sockaddr *addr, int addr_len);\nint tomoyo_socket_listen_permission(struct socket *sock);\nint tomoyo_socket_sendmsg_permission(struct socket *sock, struct msghdr *msg,\n\t\t\t\t     int size);\nint tomoyo_supervisor(struct tomoyo_request_info *r, const char *fmt, ...)\n\t__printf(2, 3);\nint tomoyo_update_domain(struct tomoyo_acl_info *new_entry, const int size,\n\t\t\t struct tomoyo_acl_param *param,\n\t\t\t bool (*check_duplicate)\n\t\t\t (const struct tomoyo_acl_info *,\n\t\t\t  const struct tomoyo_acl_info *),\n\t\t\t bool (*merge_duplicate)\n\t\t\t (struct tomoyo_acl_info *, struct tomoyo_acl_info *,\n\t\t\t  const bool));\nint tomoyo_update_policy(struct tomoyo_acl_head *new_entry, const int size,\n\t\t\t struct tomoyo_acl_param *param,\n\t\t\t bool (*check_duplicate)\n\t\t\t (const struct tomoyo_acl_head *,\n\t\t\t  const struct tomoyo_acl_head *));\nint tomoyo_write_aggregator(struct tomoyo_acl_param *param);\nint tomoyo_write_file(struct tomoyo_acl_param *param);\nint tomoyo_write_group(struct tomoyo_acl_param *param, const u8 type);\nint tomoyo_write_misc(struct tomoyo_acl_param *param);\nint tomoyo_write_inet_network(struct tomoyo_acl_param *param);\nint tomoyo_write_transition_control(struct tomoyo_acl_param *param,\n\t\t\t\t    const u8 type);\nint tomoyo_write_unix_network(struct tomoyo_acl_param *param);\nssize_t tomoyo_read_control(struct tomoyo_io_buffer *head, char __user *buffer,\n\t\t\t    const int buffer_len);\nssize_t tomoyo_write_control(struct tomoyo_io_buffer *head,\n\t\t\t     const char __user *buffer, const int buffer_len);\nstruct tomoyo_condition *tomoyo_get_condition(struct tomoyo_acl_param *param);\nstruct tomoyo_domain_info *tomoyo_assign_domain(const char *domainname,\n\t\t\t\t\t\tconst bool transit);\nstruct tomoyo_domain_info *tomoyo_domain(void);\nstruct tomoyo_domain_info *tomoyo_find_domain(const char *domainname);\nstruct tomoyo_group *tomoyo_get_group(struct tomoyo_acl_param *param,\n\t\t\t\t      const u8 idx);\nstruct tomoyo_policy_namespace *tomoyo_assign_namespace\n(const char *domainname);\nstruct tomoyo_profile *tomoyo_profile(const struct tomoyo_policy_namespace *ns,\n\t\t\t\t      const u8 profile);\nu8 tomoyo_parse_ulong(unsigned long *result, char **str);\nvoid *tomoyo_commit_ok(void *data, const unsigned int size);\nvoid __init tomoyo_load_builtin_policy(void);\nvoid __init tomoyo_mm_init(void);\nvoid tomoyo_check_acl(struct tomoyo_request_info *r,\n\t\t      bool (*check_entry)(struct tomoyo_request_info *,\n\t\t\t\t\t  const struct tomoyo_acl_info *));\nvoid tomoyo_check_profile(void);\nvoid tomoyo_convert_time(time64_t time, struct tomoyo_time *stamp);\nvoid tomoyo_del_condition(struct list_head *element);\nvoid tomoyo_fill_path_info(struct tomoyo_path_info *ptr);\nvoid tomoyo_get_attributes(struct tomoyo_obj_info *obj);\nvoid tomoyo_init_policy_namespace(struct tomoyo_policy_namespace *ns);\nvoid tomoyo_load_policy(const char *filename);\nvoid tomoyo_normalize_line(unsigned char *buffer);\nvoid tomoyo_notify_gc(struct tomoyo_io_buffer *head, const bool is_register);\nvoid tomoyo_print_ip(char *buf, const unsigned int size,\n\t\t     const struct tomoyo_ipaddr_union *ptr);\nvoid tomoyo_print_ulong(char *buffer, const int buffer_len,\n\t\t\tconst unsigned long value, const u8 type);\nvoid tomoyo_put_name_union(struct tomoyo_name_union *ptr);\nvoid tomoyo_put_number_union(struct tomoyo_number_union *ptr);\nvoid tomoyo_read_log(struct tomoyo_io_buffer *head);\nvoid tomoyo_update_stat(const u8 index);\nvoid tomoyo_warn_oom(const char *function);\nvoid tomoyo_write_log(struct tomoyo_request_info *r, const char *fmt, ...)\n\t__printf(2, 3);\nvoid tomoyo_write_log2(struct tomoyo_request_info *r, int len, const char *fmt,\n\t\t       va_list args) __printf(3, 0);\n\n \n\nextern bool tomoyo_policy_loaded;\nextern int tomoyo_enabled;\nextern const char * const tomoyo_condition_keyword\n[TOMOYO_MAX_CONDITION_KEYWORD];\nextern const char * const tomoyo_dif[TOMOYO_MAX_DOMAIN_INFO_FLAGS];\nextern const char * const tomoyo_mac_keywords[TOMOYO_MAX_MAC_INDEX\n\t\t\t\t\t      + TOMOYO_MAX_MAC_CATEGORY_INDEX];\nextern const char * const tomoyo_mode[TOMOYO_CONFIG_MAX_MODE];\nextern const char * const tomoyo_path_keyword[TOMOYO_MAX_PATH_OPERATION];\nextern const char * const tomoyo_proto_keyword[TOMOYO_SOCK_MAX];\nextern const char * const tomoyo_socket_keyword[TOMOYO_MAX_NETWORK_OPERATION];\nextern const u8 tomoyo_index2category[TOMOYO_MAX_MAC_INDEX];\nextern const u8 tomoyo_pn2mac[TOMOYO_MAX_PATH_NUMBER_OPERATION];\nextern const u8 tomoyo_pnnn2mac[TOMOYO_MAX_MKDEV_OPERATION];\nextern const u8 tomoyo_pp2mac[TOMOYO_MAX_PATH2_OPERATION];\nextern struct list_head tomoyo_condition_list;\nextern struct list_head tomoyo_domain_list;\nextern struct list_head tomoyo_name_list[TOMOYO_MAX_HASH];\nextern struct list_head tomoyo_namespace_list;\nextern struct mutex tomoyo_policy_lock;\nextern struct srcu_struct tomoyo_ss;\nextern struct tomoyo_domain_info tomoyo_kernel_domain;\nextern struct tomoyo_policy_namespace tomoyo_kernel_namespace;\nextern unsigned int tomoyo_memory_quota[TOMOYO_MAX_MEMORY_STAT];\nextern unsigned int tomoyo_memory_used[TOMOYO_MAX_MEMORY_STAT];\nextern struct lsm_blob_sizes tomoyo_blob_sizes;\n\n \n\n \nstatic inline int tomoyo_read_lock(void)\n{\n\treturn srcu_read_lock(&tomoyo_ss);\n}\n\n \nstatic inline void tomoyo_read_unlock(int idx)\n{\n\tsrcu_read_unlock(&tomoyo_ss, idx);\n}\n\n \nstatic inline pid_t tomoyo_sys_getppid(void)\n{\n\tpid_t pid;\n\n\trcu_read_lock();\n\tpid = task_tgid_vnr(rcu_dereference(current->real_parent));\n\trcu_read_unlock();\n\treturn pid;\n}\n\n \nstatic inline pid_t tomoyo_sys_getpid(void)\n{\n\treturn task_tgid_vnr(current);\n}\n\n \nstatic inline bool tomoyo_pathcmp(const struct tomoyo_path_info *a,\n\t\t\t\t  const struct tomoyo_path_info *b)\n{\n\treturn a->hash != b->hash || strcmp(a->name, b->name);\n}\n\n \nstatic inline void tomoyo_put_name(const struct tomoyo_path_info *name)\n{\n\tif (name) {\n\t\tstruct tomoyo_name *ptr =\n\t\t\tcontainer_of(name, typeof(*ptr), entry);\n\t\tatomic_dec(&ptr->head.users);\n\t}\n}\n\n \nstatic inline void tomoyo_put_condition(struct tomoyo_condition *cond)\n{\n\tif (cond)\n\t\tatomic_dec(&cond->head.users);\n}\n\n \nstatic inline void tomoyo_put_group(struct tomoyo_group *group)\n{\n\tif (group)\n\t\tatomic_dec(&group->head.users);\n}\n\n \nstatic inline struct tomoyo_task *tomoyo_task(struct task_struct *task)\n{\n\treturn task->security + tomoyo_blob_sizes.lbs_task;\n}\n\n \nstatic inline bool tomoyo_same_name_union\n(const struct tomoyo_name_union *a, const struct tomoyo_name_union *b)\n{\n\treturn a->filename == b->filename && a->group == b->group;\n}\n\n \nstatic inline bool tomoyo_same_number_union\n(const struct tomoyo_number_union *a, const struct tomoyo_number_union *b)\n{\n\treturn a->values[0] == b->values[0] && a->values[1] == b->values[1] &&\n\t\ta->group == b->group && a->value_type[0] == b->value_type[0] &&\n\t\ta->value_type[1] == b->value_type[1];\n}\n\n \nstatic inline bool tomoyo_same_ipaddr_union\n(const struct tomoyo_ipaddr_union *a, const struct tomoyo_ipaddr_union *b)\n{\n\treturn !memcmp(a->ip, b->ip, sizeof(a->ip)) && a->group == b->group &&\n\t\ta->is_ipv6 == b->is_ipv6;\n}\n\n \nstatic inline struct tomoyo_policy_namespace *tomoyo_current_namespace(void)\n{\n\treturn tomoyo_domain()->ns;\n}\n\n \n#define list_for_each_cookie(pos, head)\t\t\t\t\t\\\n\tif (!pos)\t\t\t\t\t\t\t\\\n\t\tpos =  srcu_dereference((head)->next, &tomoyo_ss);\t\\\n\tfor ( ; pos != (head); pos = srcu_dereference(pos->next, &tomoyo_ss))\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}