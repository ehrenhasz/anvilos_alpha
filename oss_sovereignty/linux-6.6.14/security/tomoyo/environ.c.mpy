{
  "module_name": "environ.c",
  "hash_id": "e988e82fb31c7ba6214241cf97be51a86128b847c43509f3f6f8ee5ca80e21f5",
  "original_prompt": "Ingested from linux-6.6.14/security/tomoyo/environ.c",
  "human_readable_source": "\n \n\n#include \"common.h\"\n\n \nstatic bool tomoyo_check_env_acl(struct tomoyo_request_info *r,\n\t\t\t\t const struct tomoyo_acl_info *ptr)\n{\n\tconst struct tomoyo_env_acl *acl =\n\t\tcontainer_of(ptr, typeof(*acl), head);\n\n\treturn tomoyo_path_matches_pattern(r->param.environ.name, acl->env);\n}\n\n \nstatic int tomoyo_audit_env_log(struct tomoyo_request_info *r)\n{\n\treturn tomoyo_supervisor(r, \"misc env %s\\n\",\n\t\t\t\t r->param.environ.name->name);\n}\n\n \nint tomoyo_env_perm(struct tomoyo_request_info *r, const char *env)\n{\n\tstruct tomoyo_path_info environ;\n\tint error;\n\n\tif (!env || !*env)\n\t\treturn 0;\n\tenviron.name = env;\n\ttomoyo_fill_path_info(&environ);\n\tr->param_type = TOMOYO_TYPE_ENV_ACL;\n\tr->param.environ.name = &environ;\n\tdo {\n\t\ttomoyo_check_acl(r, tomoyo_check_env_acl);\n\t\terror = tomoyo_audit_env_log(r);\n\t} while (error == TOMOYO_RETRY_REQUEST);\n\treturn error;\n}\n\n \nstatic bool tomoyo_same_env_acl(const struct tomoyo_acl_info *a,\n\t\t\t\tconst struct tomoyo_acl_info *b)\n{\n\tconst struct tomoyo_env_acl *p1 = container_of(a, typeof(*p1), head);\n\tconst struct tomoyo_env_acl *p2 = container_of(b, typeof(*p2), head);\n\n\treturn p1->env == p2->env;\n}\n\n \nstatic int tomoyo_write_env(struct tomoyo_acl_param *param)\n{\n\tstruct tomoyo_env_acl e = { .head.type = TOMOYO_TYPE_ENV_ACL };\n\tint error = -ENOMEM;\n\tconst char *data = tomoyo_read_token(param);\n\n\tif (!tomoyo_correct_word(data) || strchr(data, '='))\n\t\treturn -EINVAL;\n\te.env = tomoyo_get_name(data);\n\tif (!e.env)\n\t\treturn error;\n\terror = tomoyo_update_domain(&e.head, sizeof(e), param,\n\t\t\t\t  tomoyo_same_env_acl, NULL);\n\ttomoyo_put_name(e.env);\n\treturn error;\n}\n\n \nint tomoyo_write_misc(struct tomoyo_acl_param *param)\n{\n\tif (tomoyo_str_starts(&param->data, \"env \"))\n\t\treturn tomoyo_write_env(param);\n\treturn -EINVAL;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}