{
  "module_name": "procattr.c",
  "hash_id": "ea0ce2b953586ac9fb108fdf35320555498c97969e3a093baa02e3d3840e27c2",
  "original_prompt": "Ingested from linux-6.6.14/security/apparmor/procattr.c",
  "human_readable_source": "\n \n\n#include \"include/apparmor.h\"\n#include \"include/cred.h\"\n#include \"include/policy.h\"\n#include \"include/policy_ns.h\"\n#include \"include/domain.h\"\n#include \"include/procattr.h\"\n\n\n \nint aa_getprocattr(struct aa_label *label, char **string)\n{\n\tstruct aa_ns *ns = labels_ns(label);\n\tstruct aa_ns *current_ns = aa_get_current_ns();\n\tint len;\n\n\tif (!aa_ns_visible(current_ns, ns, true)) {\n\t\taa_put_ns(current_ns);\n\t\treturn -EACCES;\n\t}\n\n\tlen = aa_label_snxprint(NULL, 0, current_ns, label,\n\t\t\t\tFLAG_SHOW_MODE | FLAG_VIEW_SUBNS |\n\t\t\t\tFLAG_HIDDEN_UNCONFINED);\n\tAA_BUG(len < 0);\n\n\t*string = kmalloc(len + 2, GFP_KERNEL);\n\tif (!*string) {\n\t\taa_put_ns(current_ns);\n\t\treturn -ENOMEM;\n\t}\n\n\tlen = aa_label_snxprint(*string, len + 2, current_ns, label,\n\t\t\t\tFLAG_SHOW_MODE | FLAG_VIEW_SUBNS |\n\t\t\t\tFLAG_HIDDEN_UNCONFINED);\n\tif (len < 0) {\n\t\taa_put_ns(current_ns);\n\t\treturn len;\n\t}\n\n\t(*string)[len] = '\\n';\n\t(*string)[len + 1] = 0;\n\n\taa_put_ns(current_ns);\n\treturn len + 1;\n}\n\n \nstatic char *split_token_from_name(const char *op, char *args, u64 *token)\n{\n\tchar *name;\n\n\t*token = simple_strtoull(args, &name, 16);\n\tif ((name == args) || *name != '^') {\n\t\tAA_ERROR(\"%s: Invalid input '%s'\", op, args);\n\t\treturn ERR_PTR(-EINVAL);\n\t}\n\n\tname++;\t\t\t \n\tif (!*name)\n\t\tname = NULL;\n\treturn name;\n}\n\n \nint aa_setprocattr_changehat(char *args, size_t size, int flags)\n{\n\tchar *hat;\n\tu64 token;\n\tconst char *hats[16];\t\t \n\tint count = 0;\n\n\that = split_token_from_name(OP_CHANGE_HAT, args, &token);\n\tif (IS_ERR(hat))\n\t\treturn PTR_ERR(hat);\n\n\tif (!hat && !token) {\n\t\tAA_ERROR(\"change_hat: Invalid input, NULL hat and NULL magic\");\n\t\treturn -EINVAL;\n\t}\n\n\tif (hat) {\n\t\t \n\t\tchar *end = args + size;\n\t\tfor (count = 0; (hat < end) && count < 16; ++count) {\n\t\t\tchar *next = hat + strlen(hat) + 1;\n\t\t\thats[count] = hat;\n\t\t\tAA_DEBUG(\"%s: (pid %d) Magic 0x%llx count %d hat '%s'\\n\"\n\t\t\t\t , __func__, current->pid, token, count, hat);\n\t\t\that = next;\n\t\t}\n\t} else\n\t\tAA_DEBUG(\"%s: (pid %d) Magic 0x%llx count %d Hat '%s'\\n\",\n\t\t\t __func__, current->pid, token, count, \"<NULL>\");\n\n\treturn aa_change_hat(hats, count, token, flags);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}