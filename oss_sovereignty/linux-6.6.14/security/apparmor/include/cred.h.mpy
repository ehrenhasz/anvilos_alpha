{
  "module_name": "cred.h",
  "hash_id": "e95405b312551c30970722bfcf4515996c8bf9520b6748c16aaddf84a4f62edf",
  "original_prompt": "Ingested from linux-6.6.14/security/apparmor/include/cred.h",
  "human_readable_source": " \n \n\n#ifndef __AA_CONTEXT_H\n#define __AA_CONTEXT_H\n\n#include <linux/cred.h>\n#include <linux/slab.h>\n#include <linux/sched.h>\n\n#include \"label.h\"\n#include \"policy_ns.h\"\n#include \"task.h\"\n\nstatic inline struct aa_label *cred_label(const struct cred *cred)\n{\n\tstruct aa_label **blob = cred->security + apparmor_blob_sizes.lbs_cred;\n\n\tAA_BUG(!blob);\n\treturn *blob;\n}\n\nstatic inline void set_cred_label(const struct cred *cred,\n\t\t\t\t  struct aa_label *label)\n{\n\tstruct aa_label **blob = cred->security + apparmor_blob_sizes.lbs_cred;\n\n\tAA_BUG(!blob);\n\t*blob = label;\n}\n\n \nstatic inline struct aa_label *aa_cred_raw_label(const struct cred *cred)\n{\n\tstruct aa_label *label = cred_label(cred);\n\n\tAA_BUG(!label);\n\treturn label;\n}\n\n \nstatic inline struct aa_label *aa_get_newest_cred_label(const struct cred *cred)\n{\n\treturn aa_get_newest_label(aa_cred_raw_label(cred));\n}\n\n \nstatic inline struct aa_label *aa_current_raw_label(void)\n{\n\treturn aa_cred_raw_label(current_cred());\n}\n\n \nstatic inline struct aa_label *aa_get_current_label(void)\n{\n\tstruct aa_label *l = aa_current_raw_label();\n\n\tif (label_is_stale(l))\n\t\treturn aa_get_newest_label(l);\n\treturn aa_get_label(l);\n}\n\n#define __end_current_label_crit_section(X) end_current_label_crit_section(X)\n\n \nstatic inline void end_current_label_crit_section(struct aa_label *label)\n{\n\tif (label != aa_current_raw_label())\n\t\taa_put_label(label);\n}\n\n \nstatic inline struct aa_label *__begin_current_label_crit_section(void)\n{\n\tstruct aa_label *label = aa_current_raw_label();\n\n\tif (label_is_stale(label))\n\t\tlabel = aa_get_newest_label(label);\n\n\treturn label;\n}\n\n \nstatic inline struct aa_label *begin_current_label_crit_section(void)\n{\n\tstruct aa_label *label = aa_current_raw_label();\n\n\tmight_sleep();\n\n\tif (label_is_stale(label)) {\n\t\tlabel = aa_get_newest_label(label);\n\t\tif (aa_replace_current_label(label) == 0)\n\t\t\t \n\t\t\taa_put_label(label);\n\t}\n\n\treturn label;\n}\n\nstatic inline struct aa_ns *aa_get_current_ns(void)\n{\n\tstruct aa_label *label;\n\tstruct aa_ns *ns;\n\n\tlabel  = __begin_current_label_crit_section();\n\tns = aa_get_ns(labels_ns(label));\n\t__end_current_label_crit_section(label);\n\n\treturn ns;\n}\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}