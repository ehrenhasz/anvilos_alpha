{
  "module_name": "net.h",
  "hash_id": "bb64d4f7097f77b22926da4da5e476f53a16f241296a0deffd22e6be40567a95",
  "original_prompt": "Ingested from linux-6.6.14/security/apparmor/include/net.h",
  "human_readable_source": " \n \n\n#ifndef __AA_NET_H\n#define __AA_NET_H\n\n#include <net/sock.h>\n#include <linux/path.h>\n\n#include \"apparmorfs.h\"\n#include \"label.h\"\n#include \"perms.h\"\n#include \"policy.h\"\n\n#define AA_MAY_SEND\t\tAA_MAY_WRITE\n#define AA_MAY_RECEIVE\t\tAA_MAY_READ\n\n#define AA_MAY_SHUTDOWN\t\tAA_MAY_DELETE\n\n#define AA_MAY_CONNECT\t\tAA_MAY_OPEN\n#define AA_MAY_ACCEPT\t\t0x00100000\n\n#define AA_MAY_BIND\t\t0x00200000\n#define AA_MAY_LISTEN\t\t0x00400000\n\n#define AA_MAY_SETOPT\t\t0x01000000\n#define AA_MAY_GETOPT\t\t0x02000000\n\n#define NET_PERMS_MASK (AA_MAY_SEND | AA_MAY_RECEIVE | AA_MAY_CREATE |    \\\n\t\t\tAA_MAY_SHUTDOWN | AA_MAY_BIND | AA_MAY_LISTEN |\t  \\\n\t\t\tAA_MAY_CONNECT | AA_MAY_ACCEPT | AA_MAY_SETATTR | \\\n\t\t\tAA_MAY_GETATTR | AA_MAY_SETOPT | AA_MAY_GETOPT)\n\n#define NET_FS_PERMS (AA_MAY_SEND | AA_MAY_RECEIVE | AA_MAY_CREATE |\t\\\n\t\t      AA_MAY_SHUTDOWN | AA_MAY_CONNECT | AA_MAY_RENAME |\\\n\t\t      AA_MAY_SETATTR | AA_MAY_GETATTR | AA_MAY_CHMOD |\t\\\n\t\t      AA_MAY_CHOWN | AA_MAY_CHGRP | AA_MAY_LOCK |\t\\\n\t\t      AA_MAY_MPROT)\n\n#define NET_PEER_MASK (AA_MAY_SEND | AA_MAY_RECEIVE | AA_MAY_CONNECT |\t\\\n\t\t       AA_MAY_ACCEPT)\nstruct aa_sk_ctx {\n\tstruct aa_label *label;\n\tstruct aa_label *peer;\n};\n\n#define SK_CTX(X) ((X)->sk_security)\n#define SOCK_ctx(X) SOCK_INODE(X)->i_security\n#define DEFINE_AUDIT_NET(NAME, OP, SK, F, T, P)\t\t\t\t  \\\n\tstruct lsm_network_audit NAME ## _net = { .sk = (SK),\t\t  \\\n\t\t\t\t\t\t  .family = (F)};\t  \\\n\tDEFINE_AUDIT_DATA(NAME,\t\t\t\t\t\t  \\\n\t\t\t  ((SK) && (F) != AF_UNIX) ? LSM_AUDIT_DATA_NET : \\\n\t\t\t\t\t\t     LSM_AUDIT_DATA_NONE, \\\n\t\t\t\t\t\t     AA_CLASS_NET,        \\\n\t\t\t  OP);\t\t\t\t\t\t  \\\n\tNAME.common.u.net = &(NAME ## _net);\t\t\t\t  \\\n\tNAME.net.type = (T);\t\t\t\t\t\t  \\\n\tNAME.net.protocol = (P)\n\n#define DEFINE_AUDIT_SK(NAME, OP, SK)\t\t\t\t\t\\\n\tDEFINE_AUDIT_NET(NAME, OP, SK, (SK)->sk_family, (SK)->sk_type,\t\\\n\t\t\t (SK)->sk_protocol)\n\n\n#define af_select(FAMILY, FN, DEF_FN)\t\t\\\n({\t\t\t\t\t\t\\\n\tint __e;\t\t\t\t\\\n\tswitch ((FAMILY)) {\t\t\t\\\n\tdefault:\t\t\t\t\\\n\t\t__e = DEF_FN;\t\t\t\\\n\t}\t\t\t\t\t\\\n\t__e;\t\t\t\t\t\\\n})\n\nstruct aa_secmark {\n\tu8 audit;\n\tu8 deny;\n\tu32 secid;\n\tchar *label;\n};\n\nextern struct aa_sfs_entry aa_sfs_entry_network[];\n\nvoid audit_net_cb(struct audit_buffer *ab, void *va);\nint aa_profile_af_perm(struct aa_profile *profile,\n\t\t       struct apparmor_audit_data *ad,\n\t\t       u32 request, u16 family, int type);\nint aa_af_perm(const struct cred *subj_cred, struct aa_label *label,\n\t       const char *op, u32 request, u16 family,\n\t       int type, int protocol);\nstatic inline int aa_profile_af_sk_perm(struct aa_profile *profile,\n\t\t\t\t\tstruct apparmor_audit_data *ad,\n\t\t\t\t\tu32 request,\n\t\t\t\t\tstruct sock *sk)\n{\n\treturn aa_profile_af_perm(profile, ad, request, sk->sk_family,\n\t\t\t\t  sk->sk_type);\n}\nint aa_sk_perm(const char *op, u32 request, struct sock *sk);\n\nint aa_sock_file_perm(const struct cred *subj_cred, struct aa_label *label,\n\t\t      const char *op, u32 request,\n\t\t      struct socket *sock);\n\nint apparmor_secmark_check(struct aa_label *label, char *op, u32 request,\n\t\t\t   u32 secid, const struct sock *sk);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}