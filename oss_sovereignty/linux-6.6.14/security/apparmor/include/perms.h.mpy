{
  "module_name": "perms.h",
  "hash_id": "20df356cbe5196ed2211e4f2807523a541c25fba7a0b5dcd1f05f7b689ab1da5",
  "original_prompt": "Ingested from linux-6.6.14/security/apparmor/include/perms.h",
  "human_readable_source": " \n \n\n#ifndef __AA_PERM_H\n#define __AA_PERM_H\n\n#include <linux/fs.h>\n#include \"label.h\"\n\n#define AA_MAY_EXEC\t\tMAY_EXEC\n#define AA_MAY_WRITE\t\tMAY_WRITE\n#define AA_MAY_READ\t\tMAY_READ\n#define AA_MAY_APPEND\t\tMAY_APPEND\n\n#define AA_MAY_CREATE\t\t0x0010\n#define AA_MAY_DELETE\t\t0x0020\n#define AA_MAY_OPEN\t\t0x0040\n#define AA_MAY_RENAME\t\t0x0080\t\t \n\n#define AA_MAY_SETATTR\t\t0x0100\t\t \n#define AA_MAY_GETATTR\t\t0x0200\t\t \n#define AA_MAY_SETCRED\t\t0x0400\t\t \n#define AA_MAY_GETCRED\t\t0x0800\n\n#define AA_MAY_CHMOD\t\t0x1000\t\t \n#define AA_MAY_CHOWN\t\t0x2000\t\t \n#define AA_MAY_CHGRP\t\t0x4000\t\t \n#define AA_MAY_LOCK\t\t0x8000\t\t \n\n#define AA_EXEC_MMAP\t\t0x00010000\n#define AA_MAY_MPROT\t\t0x00020000\t \n#define AA_MAY_LINK\t\t0x00040000\t \n#define AA_MAY_SNAPSHOT\t\t0x00080000\t \n\n#define AA_MAY_DELEGATE\n#define AA_CONT_MATCH\t\t0x08000000\n\n#define AA_MAY_STACK\t\t0x10000000\n#define AA_MAY_ONEXEC\t\t0x20000000  \n#define AA_MAY_CHANGE_PROFILE\t0x40000000\n#define AA_MAY_CHANGEHAT\t0x80000000\n\n#define AA_LINK_SUBSET\t\tAA_MAY_LOCK\t \n\n\n#define PERMS_CHRS_MASK (MAY_READ | MAY_WRITE | AA_MAY_CREATE |\t\t\\\n\t\t\t AA_MAY_DELETE | AA_MAY_LINK | AA_MAY_LOCK |\t\\\n\t\t\t AA_MAY_EXEC | AA_EXEC_MMAP | AA_MAY_APPEND)\n\n#define PERMS_NAMES_MASK (PERMS_CHRS_MASK | AA_MAY_OPEN | AA_MAY_RENAME |     \\\n\t\t\t  AA_MAY_SETATTR | AA_MAY_GETATTR | AA_MAY_SETCRED | \\\n\t\t\t  AA_MAY_GETCRED | AA_MAY_CHMOD | AA_MAY_CHOWN | \\\n\t\t\t  AA_MAY_CHGRP | AA_MAY_MPROT | AA_MAY_SNAPSHOT | \\\n\t\t\t  AA_MAY_STACK | AA_MAY_ONEXEC |\t\t\\\n\t\t\t  AA_MAY_CHANGE_PROFILE | AA_MAY_CHANGEHAT)\n\nextern const char aa_file_perm_chrs[];\nextern const char *aa_file_perm_names[];\n\nstruct aa_perms {\n\tu32 allow;\n\tu32 deny;\t \n\n\tu32 subtree;\t \n\tu32 cond;\t \n\n\tu32 kill;\t \n\tu32 complain;\t \n\tu32 prompt;\t \n\n\tu32 audit;\t \n\tu32 quiet;\t \n\tu32 hide;\t \n\n\n\tu32 xindex;\n\tu32 tag;\t \n\tu32 label;\t \n};\n\n \n#define AA_INDEX_MASK\t\t\t0x00ffffff\n#define AA_INDEX_FLAG_MASK\t\t0xff000000\n#define AA_INDEX_NONE\t\t\t0\n\n#define ALL_PERMS_MASK 0xffffffff\nextern struct aa_perms nullperms;\nextern struct aa_perms allperms;\n\n \nstatic inline void aa_perms_accum_raw(struct aa_perms *accum,\n\t\t\t\t      struct aa_perms *addend)\n{\n\taccum->deny |= addend->deny;\n\taccum->allow &= addend->allow & ~addend->deny;\n\taccum->audit |= addend->audit & addend->allow;\n\taccum->quiet &= addend->quiet & ~addend->allow;\n\taccum->kill |= addend->kill & ~addend->allow;\n\taccum->complain |= addend->complain & ~addend->allow & ~addend->deny;\n\taccum->cond |= addend->cond & ~addend->allow & ~addend->deny;\n\taccum->hide &= addend->hide & ~addend->allow;\n\taccum->prompt |= addend->prompt & ~addend->allow & ~addend->deny;\n\taccum->subtree |= addend->subtree & ~addend->deny;\n\n\tif (!accum->xindex)\n\t\taccum->xindex = addend->xindex;\n\tif (!accum->tag)\n\t\taccum->tag = addend->tag;\n\tif (!accum->label)\n\t\taccum->label = addend->label;\n}\n\n \nstatic inline void aa_perms_accum(struct aa_perms *accum,\n\t\t\t\t  struct aa_perms *addend)\n{\n\taccum->deny |= addend->deny;\n\taccum->allow &= addend->allow & ~accum->deny;\n\taccum->audit |= addend->audit & accum->allow;\n\taccum->quiet &= addend->quiet & ~accum->allow;\n\taccum->kill |= addend->kill & ~accum->allow;\n\taccum->complain |= addend->complain & ~accum->allow & ~accum->deny;\n\taccum->cond |= addend->cond & ~accum->allow & ~accum->deny;\n\taccum->hide &= addend->hide & ~accum->allow;\n\taccum->prompt |= addend->prompt & ~accum->allow & ~accum->deny;\n\taccum->subtree &= addend->subtree & ~accum->deny;\n\n\tif (!accum->xindex)\n\t\taccum->xindex = addend->xindex;\n\tif (!accum->tag)\n\t\taccum->tag = addend->tag;\n\tif (!accum->label)\n\t\taccum->label = addend->label;\n}\n\n#define xcheck(FN1, FN2)\t\\\n({\t\t\t\t\\\n\tint e, error = FN1;\t\\\n\te = FN2;\t\t\\\n\tif (e)\t\t\t\\\n\t\terror = e;\t\\\n\terror;\t\t\t\\\n})\n\n\n \n#define xcheck_ns_profile_profile(P1, P2, FN, args...)\t\t\\\n({\t\t\t\t\t\t\t\t\\\n\tint ____e = 0;\t\t\t\t\t\t\\\n\tif (P1->ns == P2->ns)\t\t\t\t\t\\\n\t\t____e = FN((P1), (P2), args);\t\t\t\\\n\t(____e);\t\t\t\t\t\t\\\n})\n\n#define xcheck_ns_profile_label(P, L, FN, args...)\t\t\\\n({\t\t\t\t\t\t\t\t\\\n\tstruct aa_profile *__p2;\t\t\t\t\\\n\tfn_for_each((L), __p2,\t\t\t\t\t\\\n\t\t    xcheck_ns_profile_profile((P), __p2, (FN), args));\t\\\n})\n\n#define xcheck_ns_labels(L1, L2, FN, args...)\t\t\t\\\n({\t\t\t\t\t\t\t\t\\\n\tstruct aa_profile *__p1;\t\t\t\t\\\n\tfn_for_each((L1), __p1, FN(__p1, (L2), args));\t\t\\\n})\n\n \n#define xcheck_labels_profiles(L1, L2, FN, args...)\t\t\\\n\txcheck_ns_labels((L1), (L2), xcheck_ns_profile_label, (FN), args)\n\n#define xcheck_labels(L1, L2, P, FN1, FN2)\t\t\t\\\n\txcheck(fn_for_each((L1), (P), (FN1)), fn_for_each((L2), (P), (FN2)))\n\n\nextern struct aa_perms default_perms;\n\n\nvoid aa_perm_mask_to_str(char *str, size_t str_size, const char *chrs,\n\t\t\t u32 mask);\nvoid aa_audit_perm_names(struct audit_buffer *ab, const char * const *names,\n\t\t\t u32 mask);\nvoid aa_audit_perm_mask(struct audit_buffer *ab, u32 mask, const char *chrs,\n\t\t\tu32 chrsmask, const char * const *names, u32 namesmask);\nvoid aa_apply_modes_to_perms(struct aa_profile *profile,\n\t\t\t     struct aa_perms *perms);\nvoid aa_perms_accum(struct aa_perms *accum, struct aa_perms *addend);\nvoid aa_perms_accum_raw(struct aa_perms *accum, struct aa_perms *addend);\nvoid aa_profile_match_label(struct aa_profile *profile,\n\t\t\t    struct aa_ruleset *rules, struct aa_label *label,\n\t\t\t    int type, u32 request, struct aa_perms *perms);\nint aa_profile_label_perm(struct aa_profile *profile, struct aa_profile *target,\n\t\t\t  u32 request, int type, u32 *deny,\n\t\t\t  struct apparmor_audit_data *ad);\nint aa_check_perms(struct aa_profile *profile, struct aa_perms *perms,\n\t\t   u32 request, struct apparmor_audit_data *ad,\n\t\t   void (*cb)(struct audit_buffer *, void *));\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}