{
  "module_name": "policy_unpack_test.c",
  "hash_id": "632a1fb60af99e73764188b278b0fd27ee8e30c9379707efacb837e57c539964",
  "original_prompt": "Ingested from linux-6.6.14/security/apparmor/policy_unpack_test.c",
  "human_readable_source": "\n \n\n#include <kunit/test.h>\n#include <kunit/visibility.h>\n\n#include \"include/policy.h\"\n#include \"include/policy_unpack.h\"\n\n#define TEST_STRING_NAME \"TEST_STRING\"\n#define TEST_STRING_DATA \"testing\"\n#define TEST_STRING_BUF_OFFSET \\\n\t(3 + strlen(TEST_STRING_NAME) + 1)\n\n#define TEST_U32_NAME \"U32_TEST\"\n#define TEST_U32_DATA ((u32)0x01020304)\n#define TEST_NAMED_U32_BUF_OFFSET \\\n\t(TEST_STRING_BUF_OFFSET + 3 + strlen(TEST_STRING_DATA) + 1)\n#define TEST_U32_BUF_OFFSET \\\n\t(TEST_NAMED_U32_BUF_OFFSET + 3 + strlen(TEST_U32_NAME) + 1)\n\n#define TEST_U16_OFFSET (TEST_U32_BUF_OFFSET + 3)\n#define TEST_U16_DATA ((u16)(TEST_U32_DATA >> 16))\n\n#define TEST_U64_NAME \"U64_TEST\"\n#define TEST_U64_DATA ((u64)0x0102030405060708)\n#define TEST_NAMED_U64_BUF_OFFSET (TEST_U32_BUF_OFFSET + sizeof(u32) + 1)\n#define TEST_U64_BUF_OFFSET \\\n\t(TEST_NAMED_U64_BUF_OFFSET + 3 + strlen(TEST_U64_NAME) + 1)\n\n#define TEST_BLOB_NAME \"BLOB_TEST\"\n#define TEST_BLOB_DATA \"\\xde\\xad\\x00\\xbe\\xef\"\n#define TEST_BLOB_DATA_SIZE (ARRAY_SIZE(TEST_BLOB_DATA))\n#define TEST_NAMED_BLOB_BUF_OFFSET (TEST_U64_BUF_OFFSET + sizeof(u64) + 1)\n#define TEST_BLOB_BUF_OFFSET \\\n\t(TEST_NAMED_BLOB_BUF_OFFSET + 3 + strlen(TEST_BLOB_NAME) + 1)\n\n#define TEST_ARRAY_NAME \"ARRAY_TEST\"\n#define TEST_ARRAY_SIZE 16\n#define TEST_NAMED_ARRAY_BUF_OFFSET \\\n\t(TEST_BLOB_BUF_OFFSET + 5 + TEST_BLOB_DATA_SIZE)\n#define TEST_ARRAY_BUF_OFFSET \\\n\t(TEST_NAMED_ARRAY_BUF_OFFSET + 3 + strlen(TEST_ARRAY_NAME) + 1)\n\nMODULE_IMPORT_NS(EXPORTED_FOR_KUNIT_TESTING);\n\nstruct policy_unpack_fixture {\n\tstruct aa_ext *e;\n\tsize_t e_size;\n};\n\nstatic struct aa_ext *build_aa_ext_struct(struct policy_unpack_fixture *puf,\n\t\t\t\t\t  struct kunit *test, size_t buf_size)\n{\n\tchar *buf;\n\tstruct aa_ext *e;\n\n\tbuf = kunit_kzalloc(test, buf_size, GFP_USER);\n\tKUNIT_EXPECT_NOT_ERR_OR_NULL(test, buf);\n\n\te = kunit_kmalloc(test, sizeof(*e), GFP_USER);\n\tKUNIT_EXPECT_NOT_ERR_OR_NULL(test, e);\n\n\te->start = buf;\n\te->end = e->start + buf_size;\n\te->pos = e->start;\n\n\t*buf = AA_NAME;\n\t*(buf + 1) = strlen(TEST_STRING_NAME) + 1;\n\tstrscpy(buf + 3, TEST_STRING_NAME, e->end - (void *)(buf + 3));\n\n\tbuf = e->start + TEST_STRING_BUF_OFFSET;\n\t*buf = AA_STRING;\n\t*(buf + 1) = strlen(TEST_STRING_DATA) + 1;\n\tstrscpy(buf + 3, TEST_STRING_DATA, e->end - (void *)(buf + 3));\n\tbuf = e->start + TEST_NAMED_U32_BUF_OFFSET;\n\t*buf = AA_NAME;\n\t*(buf + 1) = strlen(TEST_U32_NAME) + 1;\n\tstrscpy(buf + 3, TEST_U32_NAME, e->end - (void *)(buf + 3));\n\t*(buf + 3 + strlen(TEST_U32_NAME) + 1) = AA_U32;\n\t*((u32 *)(buf + 3 + strlen(TEST_U32_NAME) + 2)) = TEST_U32_DATA;\n\n\tbuf = e->start + TEST_NAMED_U64_BUF_OFFSET;\n\t*buf = AA_NAME;\n\t*(buf + 1) = strlen(TEST_U64_NAME) + 1;\n\tstrscpy(buf + 3, TEST_U64_NAME, e->end - (void *)(buf + 3));\n\t*(buf + 3 + strlen(TEST_U64_NAME) + 1) = AA_U64;\n\t*((u64 *)(buf + 3 + strlen(TEST_U64_NAME) + 2)) = TEST_U64_DATA;\n\n\tbuf = e->start + TEST_NAMED_BLOB_BUF_OFFSET;\n\t*buf = AA_NAME;\n\t*(buf + 1) = strlen(TEST_BLOB_NAME) + 1;\n\tstrscpy(buf + 3, TEST_BLOB_NAME, e->end - (void *)(buf + 3));\n\t*(buf + 3 + strlen(TEST_BLOB_NAME) + 1) = AA_BLOB;\n\t*(buf + 3 + strlen(TEST_BLOB_NAME) + 2) = TEST_BLOB_DATA_SIZE;\n\tmemcpy(buf + 3 + strlen(TEST_BLOB_NAME) + 6,\n\t\tTEST_BLOB_DATA, TEST_BLOB_DATA_SIZE);\n\n\tbuf = e->start + TEST_NAMED_ARRAY_BUF_OFFSET;\n\t*buf = AA_NAME;\n\t*(buf + 1) = strlen(TEST_ARRAY_NAME) + 1;\n\tstrscpy(buf + 3, TEST_ARRAY_NAME, e->end - (void *)(buf + 3));\n\t*(buf + 3 + strlen(TEST_ARRAY_NAME) + 1) = AA_ARRAY;\n\t*((u16 *)(buf + 3 + strlen(TEST_ARRAY_NAME) + 2)) = TEST_ARRAY_SIZE;\n\n\treturn e;\n}\n\nstatic int policy_unpack_test_init(struct kunit *test)\n{\n\tsize_t e_size = TEST_ARRAY_BUF_OFFSET + sizeof(u16) + 1;\n\tstruct policy_unpack_fixture *puf;\n\n\tpuf = kunit_kmalloc(test, sizeof(*puf), GFP_USER);\n\tKUNIT_EXPECT_NOT_ERR_OR_NULL(test, puf);\n\n\tpuf->e_size = e_size;\n\tpuf->e = build_aa_ext_struct(puf, test, e_size);\n\n\ttest->priv = puf;\n\treturn 0;\n}\n\nstatic void policy_unpack_test_inbounds_when_inbounds(struct kunit *test)\n{\n\tstruct policy_unpack_fixture *puf = test->priv;\n\n\tKUNIT_EXPECT_TRUE(test, aa_inbounds(puf->e, 0));\n\tKUNIT_EXPECT_TRUE(test, aa_inbounds(puf->e, puf->e_size / 2));\n\tKUNIT_EXPECT_TRUE(test, aa_inbounds(puf->e, puf->e_size));\n}\n\nstatic void policy_unpack_test_inbounds_when_out_of_bounds(struct kunit *test)\n{\n\tstruct policy_unpack_fixture *puf = test->priv;\n\n\tKUNIT_EXPECT_FALSE(test, aa_inbounds(puf->e, puf->e_size + 1));\n}\n\nstatic void policy_unpack_test_unpack_array_with_null_name(struct kunit *test)\n{\n\tstruct policy_unpack_fixture *puf = test->priv;\n\tu16 array_size = 0;\n\n\tpuf->e->pos += TEST_ARRAY_BUF_OFFSET;\n\n\tKUNIT_EXPECT_TRUE(test, aa_unpack_array(puf->e, NULL, &array_size));\n\tKUNIT_EXPECT_EQ(test, array_size, (u16)TEST_ARRAY_SIZE);\n\tKUNIT_EXPECT_PTR_EQ(test, puf->e->pos,\n\t\tpuf->e->start + TEST_ARRAY_BUF_OFFSET + sizeof(u16) + 1);\n}\n\nstatic void policy_unpack_test_unpack_array_with_name(struct kunit *test)\n{\n\tstruct policy_unpack_fixture *puf = test->priv;\n\tconst char name[] = TEST_ARRAY_NAME;\n\tu16 array_size = 0;\n\n\tpuf->e->pos += TEST_NAMED_ARRAY_BUF_OFFSET;\n\n\tKUNIT_EXPECT_TRUE(test, aa_unpack_array(puf->e, name, &array_size));\n\tKUNIT_EXPECT_EQ(test, array_size, (u16)TEST_ARRAY_SIZE);\n\tKUNIT_EXPECT_PTR_EQ(test, puf->e->pos,\n\t\tpuf->e->start + TEST_ARRAY_BUF_OFFSET + sizeof(u16) + 1);\n}\n\nstatic void policy_unpack_test_unpack_array_out_of_bounds(struct kunit *test)\n{\n\tstruct policy_unpack_fixture *puf = test->priv;\n\tconst char name[] = TEST_ARRAY_NAME;\n\tu16 array_size;\n\n\tpuf->e->pos += TEST_NAMED_ARRAY_BUF_OFFSET;\n\tpuf->e->end = puf->e->start + TEST_ARRAY_BUF_OFFSET + sizeof(u16);\n\n\tKUNIT_EXPECT_FALSE(test, aa_unpack_array(puf->e, name, &array_size));\n\tKUNIT_EXPECT_PTR_EQ(test, puf->e->pos,\n\t\tpuf->e->start + TEST_NAMED_ARRAY_BUF_OFFSET);\n}\n\nstatic void policy_unpack_test_unpack_blob_with_null_name(struct kunit *test)\n{\n\tstruct policy_unpack_fixture *puf = test->priv;\n\tchar *blob = NULL;\n\tsize_t size;\n\n\tpuf->e->pos += TEST_BLOB_BUF_OFFSET;\n\tsize = aa_unpack_blob(puf->e, &blob, NULL);\n\n\tKUNIT_ASSERT_EQ(test, size, TEST_BLOB_DATA_SIZE);\n\tKUNIT_EXPECT_TRUE(test,\n\t\tmemcmp(blob, TEST_BLOB_DATA, TEST_BLOB_DATA_SIZE) == 0);\n}\n\nstatic void policy_unpack_test_unpack_blob_with_name(struct kunit *test)\n{\n\tstruct policy_unpack_fixture *puf = test->priv;\n\tchar *blob = NULL;\n\tsize_t size;\n\n\tpuf->e->pos += TEST_NAMED_BLOB_BUF_OFFSET;\n\tsize = aa_unpack_blob(puf->e, &blob, TEST_BLOB_NAME);\n\n\tKUNIT_ASSERT_EQ(test, size, TEST_BLOB_DATA_SIZE);\n\tKUNIT_EXPECT_TRUE(test,\n\t\tmemcmp(blob, TEST_BLOB_DATA, TEST_BLOB_DATA_SIZE) == 0);\n}\n\nstatic void policy_unpack_test_unpack_blob_out_of_bounds(struct kunit *test)\n{\n\tstruct policy_unpack_fixture *puf = test->priv;\n\tchar *blob = NULL;\n\tvoid *start;\n\tint size;\n\n\tpuf->e->pos += TEST_NAMED_BLOB_BUF_OFFSET;\n\tstart = puf->e->pos;\n\tpuf->e->end = puf->e->start + TEST_BLOB_BUF_OFFSET\n\t\t+ TEST_BLOB_DATA_SIZE - 1;\n\n\tsize = aa_unpack_blob(puf->e, &blob, TEST_BLOB_NAME);\n\n\tKUNIT_EXPECT_EQ(test, size, 0);\n\tKUNIT_EXPECT_PTR_EQ(test, puf->e->pos, start);\n}\n\nstatic void policy_unpack_test_unpack_str_with_null_name(struct kunit *test)\n{\n\tstruct policy_unpack_fixture *puf = test->priv;\n\tconst char *string = NULL;\n\tsize_t size;\n\n\tpuf->e->pos += TEST_STRING_BUF_OFFSET;\n\tsize = aa_unpack_str(puf->e, &string, NULL);\n\n\tKUNIT_EXPECT_EQ(test, size, strlen(TEST_STRING_DATA) + 1);\n\tKUNIT_EXPECT_STREQ(test, string, TEST_STRING_DATA);\n}\n\nstatic void policy_unpack_test_unpack_str_with_name(struct kunit *test)\n{\n\tstruct policy_unpack_fixture *puf = test->priv;\n\tconst char *string = NULL;\n\tsize_t size;\n\n\tsize = aa_unpack_str(puf->e, &string, TEST_STRING_NAME);\n\n\tKUNIT_EXPECT_EQ(test, size, strlen(TEST_STRING_DATA) + 1);\n\tKUNIT_EXPECT_STREQ(test, string, TEST_STRING_DATA);\n}\n\nstatic void policy_unpack_test_unpack_str_out_of_bounds(struct kunit *test)\n{\n\tstruct policy_unpack_fixture *puf = test->priv;\n\tconst char *string = NULL;\n\tvoid *start = puf->e->pos;\n\tint size;\n\n\tpuf->e->end = puf->e->pos + TEST_STRING_BUF_OFFSET\n\t\t+ strlen(TEST_STRING_DATA) - 1;\n\n\tsize = aa_unpack_str(puf->e, &string, TEST_STRING_NAME);\n\n\tKUNIT_EXPECT_EQ(test, size, 0);\n\tKUNIT_EXPECT_PTR_EQ(test, puf->e->pos, start);\n}\n\nstatic void policy_unpack_test_unpack_strdup_with_null_name(struct kunit *test)\n{\n\tstruct policy_unpack_fixture *puf = test->priv;\n\tchar *string = NULL;\n\tsize_t size;\n\n\tpuf->e->pos += TEST_STRING_BUF_OFFSET;\n\tsize = aa_unpack_strdup(puf->e, &string, NULL);\n\n\tKUNIT_EXPECT_EQ(test, size, strlen(TEST_STRING_DATA) + 1);\n\tKUNIT_EXPECT_FALSE(test,\n\t\t\t   ((uintptr_t)puf->e->start <= (uintptr_t)string)\n\t\t\t   && ((uintptr_t)string <= (uintptr_t)puf->e->end));\n\tKUNIT_EXPECT_STREQ(test, string, TEST_STRING_DATA);\n}\n\nstatic void policy_unpack_test_unpack_strdup_with_name(struct kunit *test)\n{\n\tstruct policy_unpack_fixture *puf = test->priv;\n\tchar *string = NULL;\n\tsize_t size;\n\n\tsize = aa_unpack_strdup(puf->e, &string, TEST_STRING_NAME);\n\n\tKUNIT_EXPECT_EQ(test, size, strlen(TEST_STRING_DATA) + 1);\n\tKUNIT_EXPECT_FALSE(test,\n\t\t\t   ((uintptr_t)puf->e->start <= (uintptr_t)string)\n\t\t\t   && ((uintptr_t)string <= (uintptr_t)puf->e->end));\n\tKUNIT_EXPECT_STREQ(test, string, TEST_STRING_DATA);\n}\n\nstatic void policy_unpack_test_unpack_strdup_out_of_bounds(struct kunit *test)\n{\n\tstruct policy_unpack_fixture *puf = test->priv;\n\tvoid *start = puf->e->pos;\n\tchar *string = NULL;\n\tint size;\n\n\tpuf->e->end = puf->e->pos + TEST_STRING_BUF_OFFSET\n\t\t+ strlen(TEST_STRING_DATA) - 1;\n\n\tsize = aa_unpack_strdup(puf->e, &string, TEST_STRING_NAME);\n\n\tKUNIT_EXPECT_EQ(test, size, 0);\n\tKUNIT_EXPECT_NULL(test, string);\n\tKUNIT_EXPECT_PTR_EQ(test, puf->e->pos, start);\n}\n\nstatic void policy_unpack_test_unpack_nameX_with_null_name(struct kunit *test)\n{\n\tstruct policy_unpack_fixture *puf = test->priv;\n\tbool success;\n\n\tpuf->e->pos += TEST_U32_BUF_OFFSET;\n\n\tsuccess = aa_unpack_nameX(puf->e, AA_U32, NULL);\n\n\tKUNIT_EXPECT_TRUE(test, success);\n\tKUNIT_EXPECT_PTR_EQ(test, puf->e->pos,\n\t\t\t    puf->e->start + TEST_U32_BUF_OFFSET + 1);\n}\n\nstatic void policy_unpack_test_unpack_nameX_with_wrong_code(struct kunit *test)\n{\n\tstruct policy_unpack_fixture *puf = test->priv;\n\tbool success;\n\n\tpuf->e->pos += TEST_U32_BUF_OFFSET;\n\n\tsuccess = aa_unpack_nameX(puf->e, AA_BLOB, NULL);\n\n\tKUNIT_EXPECT_FALSE(test, success);\n\tKUNIT_EXPECT_PTR_EQ(test, puf->e->pos,\n\t\t\t    puf->e->start + TEST_U32_BUF_OFFSET);\n}\n\nstatic void policy_unpack_test_unpack_nameX_with_name(struct kunit *test)\n{\n\tstruct policy_unpack_fixture *puf = test->priv;\n\tconst char name[] = TEST_U32_NAME;\n\tbool success;\n\n\tpuf->e->pos += TEST_NAMED_U32_BUF_OFFSET;\n\n\tsuccess = aa_unpack_nameX(puf->e, AA_U32, name);\n\n\tKUNIT_EXPECT_TRUE(test, success);\n\tKUNIT_EXPECT_PTR_EQ(test, puf->e->pos,\n\t\t\t    puf->e->start + TEST_U32_BUF_OFFSET + 1);\n}\n\nstatic void policy_unpack_test_unpack_nameX_with_wrong_name(struct kunit *test)\n{\n\tstruct policy_unpack_fixture *puf = test->priv;\n\tstatic const char name[] = \"12345678\";\n\tbool success;\n\n\tpuf->e->pos += TEST_NAMED_U32_BUF_OFFSET;\n\n\tsuccess = aa_unpack_nameX(puf->e, AA_U32, name);\n\n\tKUNIT_EXPECT_FALSE(test, success);\n\tKUNIT_EXPECT_PTR_EQ(test, puf->e->pos,\n\t\t\t    puf->e->start + TEST_NAMED_U32_BUF_OFFSET);\n}\n\nstatic void policy_unpack_test_unpack_u16_chunk_basic(struct kunit *test)\n{\n\tstruct policy_unpack_fixture *puf = test->priv;\n\tchar *chunk = NULL;\n\tsize_t size;\n\n\tpuf->e->pos += TEST_U16_OFFSET;\n\t \n\tpuf->e->end += TEST_U16_DATA;\n\n\tsize = aa_unpack_u16_chunk(puf->e, &chunk);\n\n\tKUNIT_EXPECT_PTR_EQ(test, chunk,\n\t\t\t    puf->e->start + TEST_U16_OFFSET + 2);\n\tKUNIT_EXPECT_EQ(test, size, TEST_U16_DATA);\n\tKUNIT_EXPECT_PTR_EQ(test, puf->e->pos, (chunk + TEST_U16_DATA));\n}\n\nstatic void policy_unpack_test_unpack_u16_chunk_out_of_bounds_1(\n\t\tstruct kunit *test)\n{\n\tstruct policy_unpack_fixture *puf = test->priv;\n\tchar *chunk = NULL;\n\tsize_t size;\n\n\tpuf->e->pos = puf->e->end - 1;\n\n\tsize = aa_unpack_u16_chunk(puf->e, &chunk);\n\n\tKUNIT_EXPECT_EQ(test, size, 0);\n\tKUNIT_EXPECT_NULL(test, chunk);\n\tKUNIT_EXPECT_PTR_EQ(test, puf->e->pos, puf->e->end - 1);\n}\n\nstatic void policy_unpack_test_unpack_u16_chunk_out_of_bounds_2(\n\t\tstruct kunit *test)\n{\n\tstruct policy_unpack_fixture *puf = test->priv;\n\tchar *chunk = NULL;\n\tsize_t size;\n\n\tpuf->e->pos += TEST_U16_OFFSET;\n\t \n\tpuf->e->end = puf->e->pos + TEST_U16_DATA - 1;\n\n\tsize = aa_unpack_u16_chunk(puf->e, &chunk);\n\n\tKUNIT_EXPECT_EQ(test, size, 0);\n\tKUNIT_EXPECT_NULL(test, chunk);\n\tKUNIT_EXPECT_PTR_EQ(test, puf->e->pos, puf->e->start + TEST_U16_OFFSET);\n}\n\nstatic void policy_unpack_test_unpack_u32_with_null_name(struct kunit *test)\n{\n\tstruct policy_unpack_fixture *puf = test->priv;\n\tbool success;\n\tu32 data = 0;\n\n\tpuf->e->pos += TEST_U32_BUF_OFFSET;\n\n\tsuccess = aa_unpack_u32(puf->e, &data, NULL);\n\n\tKUNIT_EXPECT_TRUE(test, success);\n\tKUNIT_EXPECT_EQ(test, data, TEST_U32_DATA);\n\tKUNIT_EXPECT_PTR_EQ(test, puf->e->pos,\n\t\t\tpuf->e->start + TEST_U32_BUF_OFFSET + sizeof(u32) + 1);\n}\n\nstatic void policy_unpack_test_unpack_u32_with_name(struct kunit *test)\n{\n\tstruct policy_unpack_fixture *puf = test->priv;\n\tconst char name[] = TEST_U32_NAME;\n\tbool success;\n\tu32 data = 0;\n\n\tpuf->e->pos += TEST_NAMED_U32_BUF_OFFSET;\n\n\tsuccess = aa_unpack_u32(puf->e, &data, name);\n\n\tKUNIT_EXPECT_TRUE(test, success);\n\tKUNIT_EXPECT_EQ(test, data, TEST_U32_DATA);\n\tKUNIT_EXPECT_PTR_EQ(test, puf->e->pos,\n\t\t\tpuf->e->start + TEST_U32_BUF_OFFSET + sizeof(u32) + 1);\n}\n\nstatic void policy_unpack_test_unpack_u32_out_of_bounds(struct kunit *test)\n{\n\tstruct policy_unpack_fixture *puf = test->priv;\n\tconst char name[] = TEST_U32_NAME;\n\tbool success;\n\tu32 data = 0;\n\n\tpuf->e->pos += TEST_NAMED_U32_BUF_OFFSET;\n\tpuf->e->end = puf->e->start + TEST_U32_BUF_OFFSET + sizeof(u32);\n\n\tsuccess = aa_unpack_u32(puf->e, &data, name);\n\n\tKUNIT_EXPECT_FALSE(test, success);\n\tKUNIT_EXPECT_PTR_EQ(test, puf->e->pos,\n\t\t\tpuf->e->start + TEST_NAMED_U32_BUF_OFFSET);\n}\n\nstatic void policy_unpack_test_unpack_u64_with_null_name(struct kunit *test)\n{\n\tstruct policy_unpack_fixture *puf = test->priv;\n\tbool success;\n\tu64 data = 0;\n\n\tpuf->e->pos += TEST_U64_BUF_OFFSET;\n\n\tsuccess = aa_unpack_u64(puf->e, &data, NULL);\n\n\tKUNIT_EXPECT_TRUE(test, success);\n\tKUNIT_EXPECT_EQ(test, data, TEST_U64_DATA);\n\tKUNIT_EXPECT_PTR_EQ(test, puf->e->pos,\n\t\t\tpuf->e->start + TEST_U64_BUF_OFFSET + sizeof(u64) + 1);\n}\n\nstatic void policy_unpack_test_unpack_u64_with_name(struct kunit *test)\n{\n\tstruct policy_unpack_fixture *puf = test->priv;\n\tconst char name[] = TEST_U64_NAME;\n\tbool success;\n\tu64 data = 0;\n\n\tpuf->e->pos += TEST_NAMED_U64_BUF_OFFSET;\n\n\tsuccess = aa_unpack_u64(puf->e, &data, name);\n\n\tKUNIT_EXPECT_TRUE(test, success);\n\tKUNIT_EXPECT_EQ(test, data, TEST_U64_DATA);\n\tKUNIT_EXPECT_PTR_EQ(test, puf->e->pos,\n\t\t\tpuf->e->start + TEST_U64_BUF_OFFSET + sizeof(u64) + 1);\n}\n\nstatic void policy_unpack_test_unpack_u64_out_of_bounds(struct kunit *test)\n{\n\tstruct policy_unpack_fixture *puf = test->priv;\n\tconst char name[] = TEST_U64_NAME;\n\tbool success;\n\tu64 data = 0;\n\n\tpuf->e->pos += TEST_NAMED_U64_BUF_OFFSET;\n\tpuf->e->end = puf->e->start + TEST_U64_BUF_OFFSET + sizeof(u64);\n\n\tsuccess = aa_unpack_u64(puf->e, &data, name);\n\n\tKUNIT_EXPECT_FALSE(test, success);\n\tKUNIT_EXPECT_PTR_EQ(test, puf->e->pos,\n\t\t\tpuf->e->start + TEST_NAMED_U64_BUF_OFFSET);\n}\n\nstatic void policy_unpack_test_unpack_X_code_match(struct kunit *test)\n{\n\tstruct policy_unpack_fixture *puf = test->priv;\n\tbool success = aa_unpack_X(puf->e, AA_NAME);\n\n\tKUNIT_EXPECT_TRUE(test, success);\n\tKUNIT_EXPECT_TRUE(test, puf->e->pos == puf->e->start + 1);\n}\n\nstatic void policy_unpack_test_unpack_X_code_mismatch(struct kunit *test)\n{\n\tstruct policy_unpack_fixture *puf = test->priv;\n\tbool success = aa_unpack_X(puf->e, AA_STRING);\n\n\tKUNIT_EXPECT_FALSE(test, success);\n\tKUNIT_EXPECT_TRUE(test, puf->e->pos == puf->e->start);\n}\n\nstatic void policy_unpack_test_unpack_X_out_of_bounds(struct kunit *test)\n{\n\tstruct policy_unpack_fixture *puf = test->priv;\n\tbool success;\n\n\tpuf->e->pos = puf->e->end;\n\tsuccess = aa_unpack_X(puf->e, AA_NAME);\n\n\tKUNIT_EXPECT_FALSE(test, success);\n}\n\nstatic struct kunit_case apparmor_policy_unpack_test_cases[] = {\n\tKUNIT_CASE(policy_unpack_test_inbounds_when_inbounds),\n\tKUNIT_CASE(policy_unpack_test_inbounds_when_out_of_bounds),\n\tKUNIT_CASE(policy_unpack_test_unpack_array_with_null_name),\n\tKUNIT_CASE(policy_unpack_test_unpack_array_with_name),\n\tKUNIT_CASE(policy_unpack_test_unpack_array_out_of_bounds),\n\tKUNIT_CASE(policy_unpack_test_unpack_blob_with_null_name),\n\tKUNIT_CASE(policy_unpack_test_unpack_blob_with_name),\n\tKUNIT_CASE(policy_unpack_test_unpack_blob_out_of_bounds),\n\tKUNIT_CASE(policy_unpack_test_unpack_nameX_with_null_name),\n\tKUNIT_CASE(policy_unpack_test_unpack_nameX_with_wrong_code),\n\tKUNIT_CASE(policy_unpack_test_unpack_nameX_with_name),\n\tKUNIT_CASE(policy_unpack_test_unpack_nameX_with_wrong_name),\n\tKUNIT_CASE(policy_unpack_test_unpack_str_with_null_name),\n\tKUNIT_CASE(policy_unpack_test_unpack_str_with_name),\n\tKUNIT_CASE(policy_unpack_test_unpack_str_out_of_bounds),\n\tKUNIT_CASE(policy_unpack_test_unpack_strdup_with_null_name),\n\tKUNIT_CASE(policy_unpack_test_unpack_strdup_with_name),\n\tKUNIT_CASE(policy_unpack_test_unpack_strdup_out_of_bounds),\n\tKUNIT_CASE(policy_unpack_test_unpack_u16_chunk_basic),\n\tKUNIT_CASE(policy_unpack_test_unpack_u16_chunk_out_of_bounds_1),\n\tKUNIT_CASE(policy_unpack_test_unpack_u16_chunk_out_of_bounds_2),\n\tKUNIT_CASE(policy_unpack_test_unpack_u32_with_null_name),\n\tKUNIT_CASE(policy_unpack_test_unpack_u32_with_name),\n\tKUNIT_CASE(policy_unpack_test_unpack_u32_out_of_bounds),\n\tKUNIT_CASE(policy_unpack_test_unpack_u64_with_null_name),\n\tKUNIT_CASE(policy_unpack_test_unpack_u64_with_name),\n\tKUNIT_CASE(policy_unpack_test_unpack_u64_out_of_bounds),\n\tKUNIT_CASE(policy_unpack_test_unpack_X_code_match),\n\tKUNIT_CASE(policy_unpack_test_unpack_X_code_mismatch),\n\tKUNIT_CASE(policy_unpack_test_unpack_X_out_of_bounds),\n\t{},\n};\n\nstatic struct kunit_suite apparmor_policy_unpack_test_module = {\n\t.name = \"apparmor_policy_unpack\",\n\t.init = policy_unpack_test_init,\n\t.test_cases = apparmor_policy_unpack_test_cases,\n};\n\nkunit_test_suite(apparmor_policy_unpack_test_module);\n\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}