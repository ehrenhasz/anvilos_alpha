{
  "module_name": "integrity.h",
  "hash_id": "2b9a57e071ab5b8fe55be6a5df96d7602413d3f2c669f62ff5c8e6dcd4e1e754",
  "original_prompt": "Ingested from linux-6.6.14/security/integrity/integrity.h",
  "human_readable_source": " \n \n\n#ifdef pr_fmt\n#undef pr_fmt\n#endif\n\n#define pr_fmt(fmt) KBUILD_MODNAME \": \" fmt\n\n#include <linux/types.h>\n#include <linux/integrity.h>\n#include <crypto/sha1.h>\n#include <crypto/hash.h>\n#include <linux/key.h>\n#include <linux/audit.h>\n\n \n#define IMA_MEASURE\t\t0x00000001\n#define IMA_MEASURED\t\t0x00000002\n#define IMA_APPRAISE\t\t0x00000004\n#define IMA_APPRAISED\t\t0x00000008\n \n#define IMA_COLLECTED\t\t0x00000020\n#define IMA_AUDIT\t\t0x00000040\n#define IMA_AUDITED\t\t0x00000080\n#define IMA_HASH\t\t0x00000100\n#define IMA_HASHED\t\t0x00000200\n\n \n#define IMA_NONACTION_FLAGS\t0xff000000\n#define IMA_DIGSIG_REQUIRED\t0x01000000\n#define IMA_PERMIT_DIRECTIO\t0x02000000\n#define IMA_NEW_FILE\t\t0x04000000\n#define EVM_IMMUTABLE_DIGSIG\t0x08000000\n#define IMA_FAIL_UNVERIFIABLE_SIGS\t0x10000000\n#define IMA_MODSIG_ALLOWED\t0x20000000\n#define IMA_CHECK_BLACKLIST\t0x40000000\n#define IMA_VERITY_REQUIRED\t0x80000000\n\n#define IMA_DO_MASK\t\t(IMA_MEASURE | IMA_APPRAISE | IMA_AUDIT | \\\n\t\t\t\t IMA_HASH | IMA_APPRAISE_SUBMASK)\n#define IMA_DONE_MASK\t\t(IMA_MEASURED | IMA_APPRAISED | IMA_AUDITED | \\\n\t\t\t\t IMA_HASHED | IMA_COLLECTED | \\\n\t\t\t\t IMA_APPRAISED_SUBMASK)\n\n \n#define IMA_FILE_APPRAISE\t0x00001000\n#define IMA_FILE_APPRAISED\t0x00002000\n#define IMA_MMAP_APPRAISE\t0x00004000\n#define IMA_MMAP_APPRAISED\t0x00008000\n#define IMA_BPRM_APPRAISE\t0x00010000\n#define IMA_BPRM_APPRAISED\t0x00020000\n#define IMA_READ_APPRAISE\t0x00040000\n#define IMA_READ_APPRAISED\t0x00080000\n#define IMA_CREDS_APPRAISE\t0x00100000\n#define IMA_CREDS_APPRAISED\t0x00200000\n#define IMA_APPRAISE_SUBMASK\t(IMA_FILE_APPRAISE | IMA_MMAP_APPRAISE | \\\n\t\t\t\t IMA_BPRM_APPRAISE | IMA_READ_APPRAISE | \\\n\t\t\t\t IMA_CREDS_APPRAISE)\n#define IMA_APPRAISED_SUBMASK\t(IMA_FILE_APPRAISED | IMA_MMAP_APPRAISED | \\\n\t\t\t\t IMA_BPRM_APPRAISED | IMA_READ_APPRAISED | \\\n\t\t\t\t IMA_CREDS_APPRAISED)\n\n \n#define IMA_CHANGE_XATTR\t0\n#define IMA_UPDATE_XATTR\t1\n#define IMA_CHANGE_ATTR\t\t2\n#define IMA_DIGSIG\t\t3\n#define IMA_MUST_MEASURE\t4\n\nenum evm_ima_xattr_type {\n\tIMA_XATTR_DIGEST = 0x01,\n\tEVM_XATTR_HMAC,\n\tEVM_IMA_XATTR_DIGSIG,\n\tIMA_XATTR_DIGEST_NG,\n\tEVM_XATTR_PORTABLE_DIGSIG,\n\tIMA_VERITY_DIGSIG,\n\tIMA_XATTR_LAST\n};\n\nstruct evm_ima_xattr_data {\n\tu8 type;\n\tu8 data[];\n} __packed;\n\n \nstruct evm_xattr {\n\tstruct evm_ima_xattr_data data;\n\tu8 digest[SHA1_DIGEST_SIZE];\n} __packed;\n\n#define IMA_MAX_DIGEST_SIZE\tHASH_MAX_DIGESTSIZE\n\nstruct ima_digest_data {\n\tu8 algo;\n\tu8 length;\n\tunion {\n\t\tstruct {\n\t\t\tu8 unused;\n\t\t\tu8 type;\n\t\t} sha1;\n\t\tstruct {\n\t\t\tu8 type;\n\t\t\tu8 algo;\n\t\t} ng;\n\t\tu8 data[2];\n\t} xattr;\n\tu8 digest[];\n} __packed;\n\n \nstruct ima_max_digest_data {\n\tstruct ima_digest_data hdr;\n\tu8 digest[HASH_MAX_DIGESTSIZE];\n} __packed;\n\n \nstruct signature_v2_hdr {\n\tuint8_t type;\t\t \n\tuint8_t version;\t \n\tuint8_t\thash_algo;\t \n\t__be32 keyid;\t\t \n\t__be16 sig_size;\t \n\tuint8_t sig[];\t\t \n} __packed;\n\n \nstruct ima_file_id {\n\t__u8 hash_type;\t\t \n\t__u8 hash_algorithm;\t \n\t__u8 hash[HASH_MAX_DIGESTSIZE];\n} __packed;\n\n \nstruct integrity_iint_cache {\n\tstruct rb_node rb_node;\t \n\tstruct mutex mutex;\t \n\tstruct inode *inode;\t \n\tu64 version;\t\t \n\tunsigned long flags;\n\tunsigned long measured_pcrs;\n\tunsigned long atomic_flags;\n\tunsigned long real_ino;\n\tdev_t real_dev;\n\tenum integrity_status ima_file_status:4;\n\tenum integrity_status ima_mmap_status:4;\n\tenum integrity_status ima_bprm_status:4;\n\tenum integrity_status ima_read_status:4;\n\tenum integrity_status ima_creds_status:4;\n\tenum integrity_status evm_status:4;\n\tstruct ima_digest_data *ima_hash;\n};\n\n \nstruct integrity_iint_cache *integrity_iint_find(struct inode *inode);\n\nint integrity_kernel_read(struct file *file, loff_t offset,\n\t\t\t  void *addr, unsigned long count);\n\n#define INTEGRITY_KEYRING_EVM\t\t0\n#define INTEGRITY_KEYRING_IMA\t\t1\n#define INTEGRITY_KEYRING_PLATFORM\t2\n#define INTEGRITY_KEYRING_MACHINE\t3\n#define INTEGRITY_KEYRING_MAX\t\t4\n\nextern struct dentry *integrity_dir;\n\nstruct modsig;\n\n#ifdef CONFIG_INTEGRITY_SIGNATURE\n\nint integrity_digsig_verify(const unsigned int id, const char *sig, int siglen,\n\t\t\t    const char *digest, int digestlen);\nint integrity_modsig_verify(unsigned int id, const struct modsig *modsig);\n\nint __init integrity_init_keyring(const unsigned int id);\nint __init integrity_load_x509(const unsigned int id, const char *path);\nint __init integrity_load_cert(const unsigned int id, const char *source,\n\t\t\t       const void *data, size_t len, key_perm_t perm);\n#else\n\nstatic inline int integrity_digsig_verify(const unsigned int id,\n\t\t\t\t\t  const char *sig, int siglen,\n\t\t\t\t\t  const char *digest, int digestlen)\n{\n\treturn -EOPNOTSUPP;\n}\n\nstatic inline int integrity_modsig_verify(unsigned int id,\n\t\t\t\t\t  const struct modsig *modsig)\n{\n\treturn -EOPNOTSUPP;\n}\n\nstatic inline int integrity_init_keyring(const unsigned int id)\n{\n\treturn 0;\n}\n\nstatic inline int __init integrity_load_cert(const unsigned int id,\n\t\t\t\t\t     const char *source,\n\t\t\t\t\t     const void *data, size_t len,\n\t\t\t\t\t     key_perm_t perm)\n{\n\treturn 0;\n}\n#endif  \n\n#ifdef CONFIG_INTEGRITY_ASYMMETRIC_KEYS\nint asymmetric_verify(struct key *keyring, const char *sig,\n\t\t      int siglen, const char *data, int datalen);\n#else\nstatic inline int asymmetric_verify(struct key *keyring, const char *sig,\n\t\t\t\t    int siglen, const char *data, int datalen)\n{\n\treturn -EOPNOTSUPP;\n}\n#endif\n\n#ifdef CONFIG_IMA_APPRAISE_MODSIG\nint ima_modsig_verify(struct key *keyring, const struct modsig *modsig);\n#else\nstatic inline int ima_modsig_verify(struct key *keyring,\n\t\t\t\t    const struct modsig *modsig)\n{\n\treturn -EOPNOTSUPP;\n}\n#endif\n\n#ifdef CONFIG_IMA_LOAD_X509\nvoid __init ima_load_x509(void);\n#else\nstatic inline void ima_load_x509(void)\n{\n}\n#endif\n\n#ifdef CONFIG_EVM_LOAD_X509\nvoid __init evm_load_x509(void);\n#else\nstatic inline void evm_load_x509(void)\n{\n}\n#endif\n\n#ifdef CONFIG_INTEGRITY_AUDIT\n \nvoid integrity_audit_msg(int audit_msgno, struct inode *inode,\n\t\t\t const unsigned char *fname, const char *op,\n\t\t\t const char *cause, int result, int info);\n\nvoid integrity_audit_message(int audit_msgno, struct inode *inode,\n\t\t\t     const unsigned char *fname, const char *op,\n\t\t\t     const char *cause, int result, int info,\n\t\t\t     int errno);\n\nstatic inline struct audit_buffer *\nintegrity_audit_log_start(struct audit_context *ctx, gfp_t gfp_mask, int type)\n{\n\treturn audit_log_start(ctx, gfp_mask, type);\n}\n\n#else\nstatic inline void integrity_audit_msg(int audit_msgno, struct inode *inode,\n\t\t\t\t       const unsigned char *fname,\n\t\t\t\t       const char *op, const char *cause,\n\t\t\t\t       int result, int info)\n{\n}\n\nstatic inline void integrity_audit_message(int audit_msgno,\n\t\t\t\t\t   struct inode *inode,\n\t\t\t\t\t   const unsigned char *fname,\n\t\t\t\t\t   const char *op, const char *cause,\n\t\t\t\t\t   int result, int info, int errno)\n{\n}\n\nstatic inline struct audit_buffer *\nintegrity_audit_log_start(struct audit_context *ctx, gfp_t gfp_mask, int type)\n{\n\treturn NULL;\n}\n\n#endif\n\n#ifdef CONFIG_INTEGRITY_PLATFORM_KEYRING\nvoid __init add_to_platform_keyring(const char *source, const void *data,\n\t\t\t\t    size_t len);\n#else\nstatic inline void __init add_to_platform_keyring(const char *source,\n\t\t\t\t\t\t  const void *data, size_t len)\n{\n}\n#endif\n\n#ifdef CONFIG_INTEGRITY_MACHINE_KEYRING\nvoid __init add_to_machine_keyring(const char *source, const void *data, size_t len);\nbool __init imputed_trust_enabled(void);\n#else\nstatic inline void __init add_to_machine_keyring(const char *source,\n\t\t\t\t\t\t  const void *data, size_t len)\n{\n}\n\nstatic inline bool __init imputed_trust_enabled(void)\n{\n\treturn false;\n}\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}