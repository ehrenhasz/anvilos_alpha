{
  "module_name": "integrity_audit.c",
  "hash_id": "18e0c1c89da3657ad69a36a66c8a6c6b82dce89542bae9efd7c1e1859dbb939a",
  "original_prompt": "Ingested from linux-6.6.14/security/integrity/integrity_audit.c",
  "human_readable_source": "\n \n\n#include <linux/fs.h>\n#include <linux/gfp.h>\n#include <linux/audit.h>\n#include \"integrity.h\"\n\nstatic int integrity_audit_info;\n\n \nstatic int __init integrity_audit_setup(char *str)\n{\n\tunsigned long audit;\n\n\tif (!kstrtoul(str, 0, &audit))\n\t\tintegrity_audit_info = audit ? 1 : 0;\n\treturn 1;\n}\n__setup(\"integrity_audit=\", integrity_audit_setup);\n\nvoid integrity_audit_msg(int audit_msgno, struct inode *inode,\n\t\t\t const unsigned char *fname, const char *op,\n\t\t\t const char *cause, int result, int audit_info)\n{\n\tintegrity_audit_message(audit_msgno, inode, fname, op, cause,\n\t\t\t\tresult, audit_info, 0);\n}\n\nvoid integrity_audit_message(int audit_msgno, struct inode *inode,\n\t\t\t     const unsigned char *fname, const char *op,\n\t\t\t     const char *cause, int result, int audit_info,\n\t\t\t     int errno)\n{\n\tstruct audit_buffer *ab;\n\tchar name[TASK_COMM_LEN];\n\n\tif (!integrity_audit_info && audit_info == 1)\t \n\t\treturn;\n\n\tab = audit_log_start(audit_context(), GFP_KERNEL, audit_msgno);\n\tif (!ab)\n\t\treturn;\n\taudit_log_format(ab, \"pid=%d uid=%u auid=%u ses=%u\",\n\t\t\t task_pid_nr(current),\n\t\t\t from_kuid(&init_user_ns, current_uid()),\n\t\t\t from_kuid(&init_user_ns, audit_get_loginuid(current)),\n\t\t\t audit_get_sessionid(current));\n\taudit_log_task_context(ab);\n\taudit_log_format(ab, \" op=%s cause=%s comm=\", op, cause);\n\taudit_log_untrustedstring(ab, get_task_comm(name, current));\n\tif (fname) {\n\t\taudit_log_format(ab, \" name=\");\n\t\taudit_log_untrustedstring(ab, fname);\n\t}\n\tif (inode) {\n\t\taudit_log_format(ab, \" dev=\");\n\t\taudit_log_untrustedstring(ab, inode->i_sb->s_id);\n\t\taudit_log_format(ab, \" ino=%lu\", inode->i_ino);\n\t}\n\taudit_log_format(ab, \" res=%d errno=%d\", !result, errno);\n\taudit_log_end(ab);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}