{
  "module_name": "efi_parser.c",
  "hash_id": "e57c61816016372862d29712f5d9795a332f2e847c5d093cd9d42c72801269d0",
  "original_prompt": "Ingested from linux-6.6.14/security/integrity/platform_certs/efi_parser.c",
  "human_readable_source": "\n \n\n#define pr_fmt(fmt) \"EFI: \"fmt\n#include <linux/module.h>\n#include <linux/printk.h>\n#include <linux/err.h>\n#include <linux/efi.h>\n\n \nint __init parse_efi_signature_list(\n\tconst char *source,\n\tconst void *data, size_t size,\n\tefi_element_handler_t (*get_handler_for_guid)(const efi_guid_t *))\n{\n\tefi_element_handler_t handler;\n\tunsigned int offs = 0;\n\n\tpr_devel(\"-->%s(,%zu)\\n\", __func__, size);\n\n\twhile (size > 0) {\n\t\tconst efi_signature_data_t *elem;\n\t\tefi_signature_list_t list;\n\t\tsize_t lsize, esize, hsize, elsize;\n\n\t\tif (size < sizeof(list))\n\t\t\treturn -EBADMSG;\n\n\t\tmemcpy(&list, data, sizeof(list));\n\t\tpr_devel(\"LIST[%04x] guid=%pUl ls=%x hs=%x ss=%x\\n\",\n\t\t\t offs,\n\t\t\t &list.signature_type, list.signature_list_size,\n\t\t\t list.signature_header_size, list.signature_size);\n\n\t\tlsize = list.signature_list_size;\n\t\thsize = list.signature_header_size;\n\t\tesize = list.signature_size;\n\t\telsize = lsize - sizeof(list) - hsize;\n\n\t\tif (lsize > size) {\n\t\t\tpr_devel(\"<--%s() = -EBADMSG [overrun @%x]\\n\",\n\t\t\t\t __func__, offs);\n\t\t\treturn -EBADMSG;\n\t\t}\n\n\t\tif (lsize < sizeof(list) ||\n\t\t    lsize - sizeof(list) < hsize ||\n\t\t    esize < sizeof(*elem) ||\n\t\t    elsize < esize ||\n\t\t    elsize % esize != 0) {\n\t\t\tpr_devel(\"- bad size combo @%x\\n\", offs);\n\t\t\treturn -EBADMSG;\n\t\t}\n\n\t\thandler = get_handler_for_guid(&list.signature_type);\n\t\tif (!handler) {\n\t\t\tdata += lsize;\n\t\t\tsize -= lsize;\n\t\t\toffs += lsize;\n\t\t\tcontinue;\n\t\t}\n\n\t\tdata += sizeof(list) + hsize;\n\t\tsize -= sizeof(list) + hsize;\n\t\toffs += sizeof(list) + hsize;\n\n\t\tfor (; elsize > 0; elsize -= esize) {\n\t\t\telem = data;\n\n\t\t\tpr_devel(\"ELEM[%04x]\\n\", offs);\n\t\t\thandler(source,\n\t\t\t\t&elem->signature_data,\n\t\t\t\tesize - sizeof(*elem));\n\n\t\t\tdata += esize;\n\t\t\tsize -= esize;\n\t\t\toffs += esize;\n\t\t}\n\t}\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}