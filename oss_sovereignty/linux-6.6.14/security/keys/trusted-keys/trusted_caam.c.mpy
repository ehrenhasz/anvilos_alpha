{
  "module_name": "trusted_caam.c",
  "hash_id": "c716ba57c5d2432555daf9a204d113cd662e0747c32f7fba19687984328b98d1",
  "original_prompt": "Ingested from linux-6.6.14/security/keys/trusted-keys/trusted_caam.c",
  "human_readable_source": "\n \n\n#include <keys/trusted_caam.h>\n#include <keys/trusted-type.h>\n#include <linux/build_bug.h>\n#include <linux/key-type.h>\n#include <soc/fsl/caam-blob.h>\n\nstatic struct caam_blob_priv *blobifier;\n\n#define KEYMOD \"SECURE_KEY\"\n\nstatic_assert(MAX_KEY_SIZE + CAAM_BLOB_OVERHEAD <= CAAM_BLOB_MAX_LEN);\nstatic_assert(MAX_BLOB_SIZE <= CAAM_BLOB_MAX_LEN);\n\nstatic int trusted_caam_seal(struct trusted_key_payload *p, char *datablob)\n{\n\tint ret;\n\tstruct caam_blob_info info = {\n\t\t.input  = p->key,  .input_len   = p->key_len,\n\t\t.output = p->blob, .output_len  = MAX_BLOB_SIZE,\n\t\t.key_mod = KEYMOD, .key_mod_len = sizeof(KEYMOD) - 1,\n\t};\n\n\tret = caam_encap_blob(blobifier, &info);\n\tif (ret)\n\t\treturn ret;\n\n\tp->blob_len = info.output_len;\n\treturn 0;\n}\n\nstatic int trusted_caam_unseal(struct trusted_key_payload *p, char *datablob)\n{\n\tint ret;\n\tstruct caam_blob_info info = {\n\t\t.input   = p->blob,  .input_len  = p->blob_len,\n\t\t.output  = p->key,   .output_len = MAX_KEY_SIZE,\n\t\t.key_mod = KEYMOD,  .key_mod_len = sizeof(KEYMOD) - 1,\n\t};\n\n\tret = caam_decap_blob(blobifier, &info);\n\tif (ret)\n\t\treturn ret;\n\n\tp->key_len = info.output_len;\n\treturn 0;\n}\n\nstatic int trusted_caam_init(void)\n{\n\tint ret;\n\n\tblobifier = caam_blob_gen_init();\n\tif (IS_ERR(blobifier))\n\t\treturn PTR_ERR(blobifier);\n\n\tret = register_key_type(&key_type_trusted);\n\tif (ret)\n\t\tcaam_blob_gen_exit(blobifier);\n\n\treturn ret;\n}\n\nstatic void trusted_caam_exit(void)\n{\n\tunregister_key_type(&key_type_trusted);\n\tcaam_blob_gen_exit(blobifier);\n}\n\nstruct trusted_key_ops trusted_key_caam_ops = {\n\t.migratable = 0,  \n\t.init = trusted_caam_init,\n\t.seal = trusted_caam_seal,\n\t.unseal = trusted_caam_unseal,\n\t.exit = trusted_caam_exit,\n};\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}