{
  "module_name": "sidtab.h",
  "hash_id": "2011ba408298de4c2f137f7746b81eb7df3ea05d3ec4c3a930e9ea33b763a8e6",
  "original_prompt": "Ingested from linux-6.6.14/security/selinux/ss/sidtab.h",
  "human_readable_source": " \n \n#ifndef _SS_SIDTAB_H_\n#define _SS_SIDTAB_H_\n\n#include <linux/spinlock_types.h>\n#include <linux/log2.h>\n#include <linux/hashtable.h>\n\n#include \"context.h\"\n\nstruct sidtab_entry {\n\tu32 sid;\n\tu32 hash;\n\tstruct context context;\n#if CONFIG_SECURITY_SELINUX_SID2STR_CACHE_SIZE > 0\n\tstruct sidtab_str_cache __rcu *cache;\n#endif\n\tstruct hlist_node list;\n};\n\nunion sidtab_entry_inner {\n\tstruct sidtab_node_inner *ptr_inner;\n\tstruct sidtab_node_leaf  *ptr_leaf;\n};\n\n \n#define SIDTAB_NODE_ALLOC_SHIFT PAGE_SHIFT\n#define SIDTAB_NODE_ALLOC_SIZE  PAGE_SIZE\n\n#define size_to_shift(size) ((size) == 1 ? 1 : (const_ilog2((size) - 1) + 1))\n\n#define SIDTAB_INNER_SHIFT \\\n\t(SIDTAB_NODE_ALLOC_SHIFT - size_to_shift(sizeof(union sidtab_entry_inner)))\n#define SIDTAB_INNER_ENTRIES ((size_t)1 << SIDTAB_INNER_SHIFT)\n#define SIDTAB_LEAF_ENTRIES \\\n\t(SIDTAB_NODE_ALLOC_SIZE / sizeof(struct sidtab_entry))\n\n#define SIDTAB_MAX_BITS 32\n#define SIDTAB_MAX U32_MAX\n \n#define SIDTAB_MAX_LEVEL \\\n\tDIV_ROUND_UP(SIDTAB_MAX_BITS - size_to_shift(SIDTAB_LEAF_ENTRIES), \\\n\t\t     SIDTAB_INNER_SHIFT)\n\nstruct sidtab_node_leaf {\n\tstruct sidtab_entry entries[SIDTAB_LEAF_ENTRIES];\n};\n\nstruct sidtab_node_inner {\n\tunion sidtab_entry_inner entries[SIDTAB_INNER_ENTRIES];\n};\n\nstruct sidtab_isid_entry {\n\tint set;\n\tstruct sidtab_entry entry;\n};\n\nstruct sidtab_convert_params {\n\tstruct convert_context_args *args;\n\tstruct sidtab *target;\n};\n\n#define SIDTAB_HASH_BITS CONFIG_SECURITY_SELINUX_SIDTAB_HASH_BITS\n#define SIDTAB_HASH_BUCKETS (1 << SIDTAB_HASH_BITS)\n\nstruct sidtab {\n\t \n\tunion sidtab_entry_inner roots[SIDTAB_MAX_LEVEL + 1];\n\t \n\tu32 count;\n\t \n\tstruct sidtab_convert_params *convert;\n\tbool frozen;\n\tspinlock_t lock;\n\n#if CONFIG_SECURITY_SELINUX_SID2STR_CACHE_SIZE > 0\n\t \n\tu32 cache_free_slots;\n\tstruct list_head cache_lru_list;\n\tspinlock_t cache_lock;\n#endif\n\n\t \n\tstruct sidtab_isid_entry isids[SECINITSID_NUM];\n\n\t \n\tDECLARE_HASHTABLE(context_to_sid, SIDTAB_HASH_BITS);\n};\n\nint sidtab_init(struct sidtab *s);\nint sidtab_set_initial(struct sidtab *s, u32 sid, struct context *context);\nstruct sidtab_entry *sidtab_search_entry(struct sidtab *s, u32 sid);\nstruct sidtab_entry *sidtab_search_entry_force(struct sidtab *s, u32 sid);\n\nstatic inline struct context *sidtab_search(struct sidtab *s, u32 sid)\n{\n\tstruct sidtab_entry *entry = sidtab_search_entry(s, sid);\n\n\treturn entry ? &entry->context : NULL;\n}\n\nstatic inline struct context *sidtab_search_force(struct sidtab *s, u32 sid)\n{\n\tstruct sidtab_entry *entry = sidtab_search_entry_force(s, sid);\n\n\treturn entry ? &entry->context : NULL;\n}\n\nint sidtab_convert(struct sidtab *s, struct sidtab_convert_params *params);\n\nvoid sidtab_cancel_convert(struct sidtab *s);\n\nvoid sidtab_freeze_begin(struct sidtab *s, unsigned long *flags) __acquires(&s->lock);\nvoid sidtab_freeze_end(struct sidtab *s, unsigned long *flags) __releases(&s->lock);\n\nint sidtab_context_to_sid(struct sidtab *s, struct context *context, u32 *sid);\n\nvoid sidtab_destroy(struct sidtab *s);\n\nint sidtab_hash_stats(struct sidtab *sidtab, char *page);\n\n#if CONFIG_SECURITY_SELINUX_SID2STR_CACHE_SIZE > 0\nvoid sidtab_sid2str_put(struct sidtab *s, struct sidtab_entry *entry,\n\t\t\tconst char *str, u32 str_len);\nint sidtab_sid2str_get(struct sidtab *s, struct sidtab_entry *entry,\n\t\t       char **out, u32 *out_len);\n#else\nstatic inline void sidtab_sid2str_put(struct sidtab *s,\n\t\t\t\t      struct sidtab_entry *entry,\n\t\t\t\t      const char *str, u32 str_len)\n{\n}\nstatic inline int sidtab_sid2str_get(struct sidtab *s,\n\t\t\t\t     struct sidtab_entry *entry,\n\t\t\t\t     char **out, u32 *out_len)\n{\n\treturn -ENOENT;\n}\n#endif  \n\n#endif\t \n\n\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}