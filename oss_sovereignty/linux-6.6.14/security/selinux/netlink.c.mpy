{
  "module_name": "netlink.c",
  "hash_id": "5f6ea7076ea31f32914eaf6f59bbabd3059b5c29e816adda276f83e32fce2eaf",
  "original_prompt": "Ingested from linux-6.6.14/security/selinux/netlink.c",
  "human_readable_source": "\n \n#include <linux/init.h>\n#include <linux/types.h>\n#include <linux/slab.h>\n#include <linux/stddef.h>\n#include <linux/kernel.h>\n#include <linux/export.h>\n#include <linux/skbuff.h>\n#include <linux/selinux_netlink.h>\n#include <net/net_namespace.h>\n#include <net/netlink.h>\n\n#include \"security.h\"\n\nstatic struct sock *selnl __ro_after_init;\n\nstatic int selnl_msglen(int msgtype)\n{\n\tint ret = 0;\n\n\tswitch (msgtype) {\n\tcase SELNL_MSG_SETENFORCE:\n\t\tret = sizeof(struct selnl_msg_setenforce);\n\t\tbreak;\n\n\tcase SELNL_MSG_POLICYLOAD:\n\t\tret = sizeof(struct selnl_msg_policyload);\n\t\tbreak;\n\n\tdefault:\n\t\tBUG();\n\t}\n\treturn ret;\n}\n\nstatic void selnl_add_payload(struct nlmsghdr *nlh, int len, int msgtype, void *data)\n{\n\tswitch (msgtype) {\n\tcase SELNL_MSG_SETENFORCE: {\n\t\tstruct selnl_msg_setenforce *msg = nlmsg_data(nlh);\n\n\t\tmemset(msg, 0, len);\n\t\tmsg->val = *((int *)data);\n\t\tbreak;\n\t}\n\n\tcase SELNL_MSG_POLICYLOAD: {\n\t\tstruct selnl_msg_policyload *msg = nlmsg_data(nlh);\n\n\t\tmemset(msg, 0, len);\n\t\tmsg->seqno = *((u32 *)data);\n\t\tbreak;\n\t}\n\n\tdefault:\n\t\tBUG();\n\t}\n}\n\nstatic void selnl_notify(int msgtype, void *data)\n{\n\tint len;\n\tsk_buff_data_t tmp;\n\tstruct sk_buff *skb;\n\tstruct nlmsghdr *nlh;\n\n\tlen = selnl_msglen(msgtype);\n\n\tskb = nlmsg_new(len, GFP_USER);\n\tif (!skb)\n\t\tgoto oom;\n\n\ttmp = skb->tail;\n\tnlh = nlmsg_put(skb, 0, 0, msgtype, len, 0);\n\tif (!nlh)\n\t\tgoto out_kfree_skb;\n\tselnl_add_payload(nlh, len, msgtype, data);\n\tnlh->nlmsg_len = skb->tail - tmp;\n\tNETLINK_CB(skb).dst_group = SELNLGRP_AVC;\n\tnetlink_broadcast(selnl, skb, 0, SELNLGRP_AVC, GFP_USER);\nout:\n\treturn;\n\nout_kfree_skb:\n\tkfree_skb(skb);\noom:\n\tpr_err(\"SELinux:  OOM in %s\\n\", __func__);\n\tgoto out;\n}\n\nvoid selnl_notify_setenforce(int val)\n{\n\tselnl_notify(SELNL_MSG_SETENFORCE, &val);\n}\n\nvoid selnl_notify_policyload(u32 seqno)\n{\n\tselnl_notify(SELNL_MSG_POLICYLOAD, &seqno);\n}\n\nstatic int __init selnl_init(void)\n{\n\tstruct netlink_kernel_cfg cfg = {\n\t\t.groups\t= SELNLGRP_MAX,\n\t\t.flags\t= NL_CFG_F_NONROOT_RECV,\n\t};\n\n\tselnl = netlink_kernel_create(&init_net, NETLINK_SELINUX, &cfg);\n\tif (selnl == NULL)\n\t\tpanic(\"SELinux:  Cannot create netlink socket.\");\n\treturn 0;\n}\n\n__initcall(selnl_init);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}