{
  "module_name": "parse-options.h",
  "hash_id": "931b12c8c34b150126871a3c5ac5c578e27b798be3dce41e07da34114128a73c",
  "original_prompt": "Ingested from linux-6.6.14/tools/lib/subcmd/parse-options.h",
  "human_readable_source": " \n#ifndef __SUBCMD_PARSE_OPTIONS_H\n#define __SUBCMD_PARSE_OPTIONS_H\n\n#include <linux/kernel.h>\n#include <stdbool.h>\n#include <stdint.h>\n\nenum parse_opt_type {\n\t \n\tOPTION_END,\n\tOPTION_ARGUMENT,\n\tOPTION_GROUP,\n\t \n\tOPTION_BIT,\n\tOPTION_BOOLEAN,\n\tOPTION_INCR,\n\tOPTION_SET_UINT,\n\tOPTION_SET_PTR,\n\t \n\tOPTION_STRING,\n\tOPTION_INTEGER,\n\tOPTION_LONG,\n\tOPTION_ULONG,\n\tOPTION_CALLBACK,\n\tOPTION_U64,\n\tOPTION_UINTEGER,\n};\n\nenum parse_opt_flags {\n\tPARSE_OPT_KEEP_DASHDASH = 1,\n\tPARSE_OPT_STOP_AT_NON_OPTION = 2,\n\tPARSE_OPT_KEEP_ARGV0 = 4,\n\tPARSE_OPT_KEEP_UNKNOWN = 8,\n\tPARSE_OPT_NO_INTERNAL_HELP = 16,\n};\n\nenum parse_opt_option_flags {\n\tPARSE_OPT_OPTARG  = 1,\n\tPARSE_OPT_NOARG   = 2,\n\tPARSE_OPT_NONEG   = 4,\n\tPARSE_OPT_HIDDEN  = 8,\n\tPARSE_OPT_LASTARG_DEFAULT = 16,\n\tPARSE_OPT_DISABLED = 32,\n\tPARSE_OPT_EXCLUSIVE = 64,\n\tPARSE_OPT_NOEMPTY  = 128,\n\tPARSE_OPT_NOBUILD  = 256,\n\tPARSE_OPT_CANSKIP  = 512,\n};\n\nstruct option;\ntypedef int parse_opt_cb(const struct option *, const char *arg, int unset);\n\n \nstruct option {\n\tenum parse_opt_type type;\n\tint short_name;\n\tconst char *long_name;\n\tvoid *value;\n\tconst char *argh;\n\tconst char *help;\n\tconst char *build_opt;\n\n\tint flags;\n\tparse_opt_cb *callback;\n\tintptr_t defval;\n\tbool *set;\n\tvoid *data;\n\tconst struct option *parent;\n};\n\n#define check_vtype(v, type) ( BUILD_BUG_ON_ZERO(!__builtin_types_compatible_p(typeof(v), type)) + v )\n\n#define OPT_END()                   { .type = OPTION_END }\n#define OPT_PARENT(p)               { .type = OPTION_END, .parent = (p) }\n#define OPT_ARGUMENT(l, h)          { .type = OPTION_ARGUMENT, .long_name = (l), .help = (h) }\n#define OPT_GROUP(h)                { .type = OPTION_GROUP, .help = (h) }\n#define OPT_BIT(s, l, v, h, b)      { .type = OPTION_BIT, .short_name = (s), .long_name = (l), .value = check_vtype(v, int *), .help = (h), .defval = (b) }\n#define OPT_BOOLEAN(s, l, v, h)     { .type = OPTION_BOOLEAN, .short_name = (s), .long_name = (l), .value = check_vtype(v, bool *), .help = (h) }\n#define OPT_BOOLEAN_FLAG(s, l, v, h, f)     { .type = OPTION_BOOLEAN, .short_name = (s), .long_name = (l), .value = check_vtype(v, bool *), .help = (h), .flags = (f) }\n#define OPT_BOOLEAN_SET(s, l, v, os, h) \\\n\t{ .type = OPTION_BOOLEAN, .short_name = (s), .long_name = (l), \\\n\t.value = check_vtype(v, bool *), .help = (h), \\\n\t.set = check_vtype(os, bool *)}\n#define OPT_INCR(s, l, v, h)        { .type = OPTION_INCR, .short_name = (s), .long_name = (l), .value = check_vtype(v, int *), .help = (h) }\n#define OPT_SET_UINT(s, l, v, h, i)  { .type = OPTION_SET_UINT, .short_name = (s), .long_name = (l), .value = check_vtype(v, unsigned int *), .help = (h), .defval = (i) }\n#define OPT_SET_PTR(s, l, v, h, p)  { .type = OPTION_SET_PTR, .short_name = (s), .long_name = (l), .value = (v), .help = (h), .defval = (p) }\n#define OPT_INTEGER(s, l, v, h)     { .type = OPTION_INTEGER, .short_name = (s), .long_name = (l), .value = check_vtype(v, int *), .help = (h) }\n#define OPT_UINTEGER(s, l, v, h)    { .type = OPTION_UINTEGER, .short_name = (s), .long_name = (l), .value = check_vtype(v, unsigned int *), .help = (h) }\n#define OPT_UINTEGER_OPTARG(s, l, v, d, h)    { .type = OPTION_UINTEGER, .short_name = (s), .long_name = (l), .value = check_vtype(v, unsigned int *), .help = (h), .flags = PARSE_OPT_OPTARG, .defval = (intptr_t)(d) }\n#define OPT_LONG(s, l, v, h)        { .type = OPTION_LONG, .short_name = (s), .long_name = (l), .value = check_vtype(v, long *), .help = (h) }\n#define OPT_ULONG(s, l, v, h)        { .type = OPTION_ULONG, .short_name = (s), .long_name = (l), .value = check_vtype(v, unsigned long *), .help = (h) }\n#define OPT_U64(s, l, v, h)         { .type = OPTION_U64, .short_name = (s), .long_name = (l), .value = check_vtype(v, u64 *), .help = (h) }\n#define OPT_STRING(s, l, v, a, h)   { .type = OPTION_STRING,  .short_name = (s), .long_name = (l), .value = check_vtype(v, const char **), .argh = (a), .help = (h) }\n#define OPT_STRING_OPTARG(s, l, v, a, h, d) \\\n\t{ .type = OPTION_STRING,  .short_name = (s), .long_name = (l), \\\n\t  .value = check_vtype(v, const char **), .argh =(a), .help = (h), \\\n\t  .flags = PARSE_OPT_OPTARG, .defval = (intptr_t)(d) }\n#define OPT_STRING_OPTARG_SET(s, l, v, os, a, h, d) \\\n\t{ .type = OPTION_STRING, .short_name = (s), .long_name = (l), \\\n\t  .value = check_vtype(v, const char **), .argh = (a), .help = (h), \\\n\t  .flags = PARSE_OPT_OPTARG, .defval = (intptr_t)(d), \\\n\t  .set = check_vtype(os, bool *)}\n#define OPT_STRING_NOEMPTY(s, l, v, a, h)   { .type = OPTION_STRING,  .short_name = (s), .long_name = (l), .value = check_vtype(v, const char **), .argh = (a), .help = (h), .flags = PARSE_OPT_NOEMPTY}\n#define OPT_DATE(s, l, v, h) \\\n\t{ .type = OPTION_CALLBACK, .short_name = (s), .long_name = (l), .value = (v), .argh = \"time\", .help = (h), .callback = parse_opt_approxidate_cb }\n#define OPT_CALLBACK(s, l, v, a, h, f) \\\n\t{ .type = OPTION_CALLBACK, .short_name = (s), .long_name = (l), .value = (v), .argh = (a), .help = (h), .callback = (f) }\n#define OPT_CALLBACK_SET(s, l, v, os, a, h, f) \\\n\t{ .type = OPTION_CALLBACK, .short_name = (s), .long_name = (l), .value = (v), .argh = (a), .help = (h), .callback = (f), .set = check_vtype(os, bool *)}\n#define OPT_CALLBACK_NOOPT(s, l, v, a, h, f) \\\n\t{ .type = OPTION_CALLBACK, .short_name = (s), .long_name = (l), .value = (v), .argh = (a), .help = (h), .callback = (f), .flags = PARSE_OPT_NOARG }\n#define OPT_CALLBACK_DEFAULT(s, l, v, a, h, f, d) \\\n\t{ .type = OPTION_CALLBACK, .short_name = (s), .long_name = (l), .value = (v), .argh = (a), .help = (h), .callback = (f), .defval = (intptr_t)d, .flags = PARSE_OPT_LASTARG_DEFAULT }\n#define OPT_CALLBACK_DEFAULT_NOOPT(s, l, v, a, h, f, d) \\\n\t{ .type = OPTION_CALLBACK, .short_name = (s), .long_name = (l),\\\n\t.value = (v), .arg = (a), .help = (h), .callback = (f), .defval = (intptr_t)d,\\\n\t.flags = PARSE_OPT_LASTARG_DEFAULT | PARSE_OPT_NOARG}\n#define OPT_CALLBACK_OPTARG(s, l, v, d, a, h, f) \\\n\t{ .type = OPTION_CALLBACK, .short_name = (s), .long_name = (l), \\\n\t  .value = (v), .argh = (a), .help = (h), .callback = (f), \\\n\t  .flags = PARSE_OPT_OPTARG, .data = (d) }\n\n \nextern int parse_options(int argc, const char **argv,\n                         const struct option *options,\n                         const char * const usagestr[], int flags);\n\nextern int parse_options_subcommand(int argc, const char **argv,\n\t\t\t\tconst struct option *options,\n\t\t\t\tconst char *const subcommands[],\n\t\t\t\tconst char *usagestr[], int flags);\n\nextern __noreturn void usage_with_options(const char * const *usagestr,\n                                        const struct option *options);\nextern __noreturn __attribute__((format(printf,3,4)))\nvoid usage_with_options_msg(const char * const *usagestr,\n\t\t\t    const struct option *options,\n\t\t\t    const char *fmt, ...);\n\n \n\nenum {\n\tPARSE_OPT_HELP = -1,\n\tPARSE_OPT_DONE,\n\tPARSE_OPT_LIST_OPTS,\n\tPARSE_OPT_LIST_SUBCMDS,\n\tPARSE_OPT_UNKNOWN,\n};\n\n \nstruct parse_opt_ctx_t {\n\tconst char **argv;\n\tconst char **out;\n\tint argc, cpidx;\n\tconst char *opt;\n\tconst struct option *excl_opt;\n\tint flags;\n};\n\nextern int parse_options_usage(const char * const *usagestr,\n\t\t\t       const struct option *opts,\n\t\t\t       const char *optstr,\n\t\t\t       bool short_opt);\n\n\n \nextern int parse_opt_abbrev_cb(const struct option *, const char *, int);\nextern int parse_opt_approxidate_cb(const struct option *, const char *, int);\nextern int parse_opt_verbosity_cb(const struct option *, const char *, int);\n\n#define OPT__VERBOSE(var)  OPT_BOOLEAN('v', \"verbose\", (var), \"be verbose\")\n#define OPT__QUIET(var)    OPT_BOOLEAN('q', \"quiet\",   (var), \"be quiet\")\n#define OPT__VERBOSITY(var) \\\n\t{ OPTION_CALLBACK, 'v', \"verbose\", (var), NULL, \"be more verbose\", \\\n\t  PARSE_OPT_NOARG, &parse_opt_verbosity_cb, 0 }, \\\n\t{ OPTION_CALLBACK, 'q', \"quiet\", (var), NULL, \"be more quiet\", \\\n\t  PARSE_OPT_NOARG, &parse_opt_verbosity_cb, 0 }\n#define OPT__DRY_RUN(var)  OPT_BOOLEAN('n', \"dry-run\", (var), \"dry run\")\n#define OPT__ABBREV(var)  \\\n\t{ OPTION_CALLBACK, 0, \"abbrev\", (var), \"n\", \\\n\t  \"use <n> digits to display SHA-1s\", \\\n\t  PARSE_OPT_OPTARG, &parse_opt_abbrev_cb, 0 }\n\nextern const char *parse_options_fix_filename(const char *prefix, const char *file);\n\nvoid set_option_flag(struct option *opts, int sopt, const char *lopt, int flag);\nvoid set_option_nobuild(struct option *opts, int shortopt, const char *longopt,\n\t\t\tconst char *build_opt, bool can_skip);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}