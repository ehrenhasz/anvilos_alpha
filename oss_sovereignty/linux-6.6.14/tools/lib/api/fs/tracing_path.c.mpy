{
  "module_name": "tracing_path.c",
  "hash_id": "9aea4633ef26404e08118c32c8e87755a7f770129c716dc94705c9d3bbf67aee",
  "original_prompt": "Ingested from linux-6.6.14/tools/lib/api/fs/tracing_path.c",
  "human_readable_source": "\n#ifndef _GNU_SOURCE\n# define _GNU_SOURCE\n#endif\n\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <linux/string.h>\n#include <errno.h>\n#include <unistd.h>\n#include \"fs.h\"\n\n#include \"tracing_path.h\"\n\nstatic char tracing_path[PATH_MAX]        = \"/sys/kernel/tracing\";\n\nstatic void __tracing_path_set(const char *tracing, const char *mountpoint)\n{\n\tsnprintf(tracing_path, sizeof(tracing_path), \"%s/%s\",\n\t\t mountpoint, tracing);\n}\n\nstatic const char *tracing_path_tracefs_mount(void)\n{\n\tconst char *mnt;\n\n\tmnt = tracefs__mount();\n\tif (!mnt)\n\t\treturn NULL;\n\n\t__tracing_path_set(\"\", mnt);\n\n\treturn tracing_path;\n}\n\nstatic const char *tracing_path_debugfs_mount(void)\n{\n\tconst char *mnt;\n\n\tmnt = debugfs__mount();\n\tif (!mnt)\n\t\treturn NULL;\n\n\t__tracing_path_set(\"tracing/\", mnt);\n\n\treturn tracing_path;\n}\n\nconst char *tracing_path_mount(void)\n{\n\tconst char *mnt;\n\n\tmnt = tracing_path_tracefs_mount();\n\tif (mnt)\n\t\treturn mnt;\n\n\tmnt = tracing_path_debugfs_mount();\n\n\treturn mnt;\n}\n\nvoid tracing_path_set(const char *mntpt)\n{\n\t__tracing_path_set(\"tracing/\", mntpt);\n}\n\nchar *get_tracing_file(const char *name)\n{\n\tchar *file;\n\n\tif (asprintf(&file, \"%s/%s\", tracing_path_mount(), name) < 0)\n\t\treturn NULL;\n\n\treturn file;\n}\n\nvoid put_tracing_file(char *file)\n{\n\tfree(file);\n}\n\nchar *get_events_file(const char *name)\n{\n\tchar *file;\n\n\tif (asprintf(&file, \"%s/events/%s\", tracing_path_mount(), name) < 0)\n\t\treturn NULL;\n\n\treturn file;\n}\n\nvoid put_events_file(char *file)\n{\n\tfree(file);\n}\n\nDIR *tracing_events__opendir(void)\n{\n\tDIR *dir = NULL;\n\tchar *path = get_tracing_file(\"events\");\n\n\tif (path) {\n\t\tdir = opendir(path);\n\t\tput_events_file(path);\n\t}\n\n\treturn dir;\n}\n\nint tracing_events__scandir_alphasort(struct dirent ***namelist)\n{\n\tchar *path = get_tracing_file(\"events\");\n\tint ret;\n\n\tif (!path) {\n\t\t*namelist = NULL;\n\t\treturn 0;\n\t}\n\n\tret = scandir(path, namelist, NULL, alphasort);\n\tput_events_file(path);\n\n\treturn ret;\n}\n\nint tracing_path__strerror_open_tp(int err, char *buf, size_t size,\n\t\t\t\t   const char *sys, const char *name)\n{\n\tchar sbuf[128];\n\tchar filename[PATH_MAX];\n\n\tsnprintf(filename, PATH_MAX, \"%s/%s\", sys, name ?: \"*\");\n\n\tswitch (err) {\n\tcase ENOENT:\n\t\t \n\t\tif (debugfs__configured() || tracefs__configured()) {\n\t\t\t \n\t\t\tif (!strncmp(filename, \"sdt_\", 4)) {\n\t\t\t\tsnprintf(buf, size,\n\t\t\t\t\t\"Error:\\tFile %s/events/%s not found.\\n\"\n\t\t\t\t\t\"Hint:\\tSDT event cannot be directly recorded on.\\n\"\n\t\t\t\t\t\"\\tPlease first use 'perf probe %s:%s' before recording it.\\n\",\n\t\t\t\t\ttracing_path, filename, sys, name);\n\t\t\t} else {\n\t\t\t\tsnprintf(buf, size,\n\t\t\t\t\t \"Error:\\tFile %s/events/%s not found.\\n\"\n\t\t\t\t\t \"Hint:\\tPerhaps this kernel misses some CONFIG_ setting to enable this feature?.\\n\",\n\t\t\t\t\t tracing_path, filename);\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\t\tsnprintf(buf, size, \"%s\",\n\t\t\t \"Error:\\tUnable to find debugfs/tracefs\\n\"\n\t\t\t \"Hint:\\tWas your kernel compiled with debugfs/tracefs support?\\n\"\n\t\t\t \"Hint:\\tIs the debugfs/tracefs filesystem mounted?\\n\"\n\t\t\t \"Hint:\\tTry 'sudo mount -t debugfs nodev /sys/kernel/debug'\");\n\t\tbreak;\n\tcase EACCES: {\n\t\tsnprintf(buf, size,\n\t\t\t \"Error:\\tNo permissions to read %s/events/%s\\n\"\n\t\t\t \"Hint:\\tTry 'sudo mount -o remount,mode=755 %s'\\n\",\n\t\t\t tracing_path, filename, tracing_path_mount());\n\t}\n\t\tbreak;\n\tdefault:\n\t\tsnprintf(buf, size, \"%s\", str_error_r(err, sbuf, sizeof(sbuf)));\n\t\tbreak;\n\t}\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}