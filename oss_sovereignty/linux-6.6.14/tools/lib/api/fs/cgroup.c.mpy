{
  "module_name": "cgroup.c",
  "hash_id": "5838051c9b680e0511d1f9a6d34e5d08285cb1ef5ebbe995801dfced773f8858",
  "original_prompt": "Ingested from linux-6.6.14/tools/lib/api/fs/cgroup.c",
  "human_readable_source": "\n#include <linux/stringify.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include \"fs.h\"\n\nstruct cgroupfs_cache_entry {\n\tchar\tsubsys[32];\n\tchar\tmountpoint[PATH_MAX];\n};\n\n \nstatic struct cgroupfs_cache_entry *cached;\n\nint cgroupfs_find_mountpoint(char *buf, size_t maxlen, const char *subsys)\n{\n\tFILE *fp;\n\tchar *line = NULL;\n\tsize_t len = 0;\n\tchar *p, *path;\n\tchar mountpoint[PATH_MAX];\n\n\tif (cached && !strcmp(cached->subsys, subsys)) {\n\t\tif (strlen(cached->mountpoint) < maxlen) {\n\t\t\tstrcpy(buf, cached->mountpoint);\n\t\t\treturn 0;\n\t\t}\n\t\treturn -1;\n\t}\n\n\tfp = fopen(\"/proc/mounts\", \"r\");\n\tif (!fp)\n\t\treturn -1;\n\n\t \n\tmountpoint[0] = '\\0';\n\n\t \n\twhile (getline(&line, &len, fp) != -1) {\n\t\t \n\t\tp = strchr(line, ' ');\n\t\tif (p == NULL)\n\t\t\tcontinue;\n\n\t\t \n\t\tpath = ++p;\n\t\tp = strchr(p, ' ');\n\t\tif (p == NULL)\n\t\t\tcontinue;\n\n\t\t*p++ = '\\0';\n\n\t\t \n\t\tif (strncmp(p, \"cgroup\", 6))\n\t\t\tcontinue;\n\n\t\tif (p[6] == '2') {\n\t\t\t \n\t\t\tstrcpy(mountpoint, path);\n\t\t\tcontinue;\n\t\t}\n\n\t\t \n\t\tp += 7;\n\n\t\tp = strstr(p, subsys);\n\t\tif (p == NULL)\n\t\t\tcontinue;\n\n\t\t \n\t\tif (!strchr(\" ,\", p[-1]) || !strchr(\" ,\", p[strlen(subsys)]))\n\t\t\tcontinue;\n\n\t\tstrcpy(mountpoint, path);\n\t\tbreak;\n\t}\n\tfree(line);\n\tfclose(fp);\n\n\tif (!cached)\n\t\tcached = calloc(1, sizeof(*cached));\n\n\tif (cached) {\n\t\tstrncpy(cached->subsys, subsys, sizeof(cached->subsys) - 1);\n\t\tstrcpy(cached->mountpoint, mountpoint);\n\t}\n\n\tif (mountpoint[0] && strlen(mountpoint) < maxlen) {\n\t\tstrcpy(buf, mountpoint);\n\t\treturn 0;\n\t}\n\treturn -1;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}