{
  "module_name": "Makefile",
  "hash_id": "bf824f526ba0a9258107a3d367c7832e1f54bc2a7a17966e5fd9ae92cc288b4d",
  "original_prompt": "Ingested from linux-6.6.14/tools/lib/perf/Makefile",
  "human_readable_source": "# SPDX-License-Identifier: (LGPL-2.1 OR BSD-2-Clause)\n# Most of this file is copied from tools/lib/bpf/Makefile\n\nLIBPERF_VERSION = 0\nLIBPERF_PATCHLEVEL = 0\nLIBPERF_EXTRAVERSION = 1\n\nMAKEFLAGS += --no-print-directory\n\nifeq ($(srctree),)\nsrctree := $(patsubst %/,%,$(dir $(CURDIR)))\nsrctree := $(patsubst %/,%,$(dir $(srctree)))\nsrctree := $(patsubst %/,%,$(dir $(srctree)))\n#$(info Determined 'srctree' to be $(srctree))\nendif\n\nINSTALL = install\n\n# Use DESTDIR for installing into a different root directory.\n# This is useful for building a package. The program will be\n# installed in this directory as if it was the root directory.\n# Then the build tool can move it later.\nDESTDIR ?=\nDESTDIR_SQ = '$(subst ','\\'',$(DESTDIR))'\n\ninclude $(srctree)/tools/scripts/Makefile.include\ninclude $(srctree)/tools/scripts/Makefile.arch\n\nifeq ($(LP64), 1)\n  libdir_relative = lib64\nelse\n  libdir_relative = lib\nendif\n\nprefix ?=\nlibdir = $(prefix)/$(libdir_relative)\n\n# Shell quotes\nlibdir_SQ = $(subst ','\\'',$(libdir))\nlibdir_relative_SQ = $(subst ','\\'',$(libdir_relative))\n\nifeq (\"$(origin V)\", \"command line\")\n  VERBOSE = $(V)\nendif\nifndef VERBOSE\n  VERBOSE = 0\nendif\n\nifeq ($(VERBOSE),1)\n  Q =\nelse\n  Q = @\nendif\n\nTEST_ARGS := $(if $(V),-v)\n\n# Set compile option CFLAGS\nifdef EXTRA_CFLAGS\n  CFLAGS := $(EXTRA_CFLAGS)\nelse\n  CFLAGS := -g -Wall\nendif\n\nINCLUDES = \\\n-I$(srctree)/tools/lib/perf/include \\\n-I$(srctree)/tools/lib/ \\\n-I$(srctree)/tools/include \\\n-I$(srctree)/tools/arch/$(SRCARCH)/include/ \\\n-I$(srctree)/tools/arch/$(SRCARCH)/include/uapi \\\n-I$(srctree)/tools/include/uapi\n\n# Append required CFLAGS\noverride CFLAGS += $(EXTRA_WARNINGS)\noverride CFLAGS += -Werror -Wall\noverride CFLAGS += -fPIC\noverride CFLAGS += $(INCLUDES)\noverride CFLAGS += -fvisibility=hidden\n\nall:\n\nexport srctree OUTPUT CC LD CFLAGS V\nexport DESTDIR DESTDIR_SQ\n\ninclude $(srctree)/tools/build/Makefile.include\n\nVERSION_SCRIPT := libperf.map\n\nPATCHLEVEL    = $(LIBPERF_PATCHLEVEL)\nEXTRAVERSION  = $(LIBPERF_EXTRAVERSION)\nVERSION       = $(LIBPERF_VERSION).$(LIBPERF_PATCHLEVEL).$(LIBPERF_EXTRAVERSION)\n\nLIBPERF_SO := $(OUTPUT)libperf.so.$(VERSION)\nLIBPERF_A  := $(OUTPUT)libperf.a\nLIBPERF_IN := $(OUTPUT)libperf-in.o\nLIBPERF_PC := $(OUTPUT)libperf.pc\n\nLIBPERF_ALL := $(LIBPERF_A) $(OUTPUT)libperf.so*\n\nLIB_DIR := $(srctree)/tools/lib/api/\n\nifneq ($(OUTPUT),)\nifneq ($(subdir),)\n  API_PATH=$(OUTPUT)/../lib/api/\nelse\n  API_PATH=$(OUTPUT)\nendif\nelse\n  API_PATH=$(LIB_DIR)\nendif\n\nLIBAPI = $(API_PATH)libapi.a\nexport LIBAPI\n\n$(LIBAPI): FORCE\n\t$(Q)$(MAKE) -C $(LIB_DIR) O=$(OUTPUT) $(OUTPUT)libapi.a\n\n$(LIBAPI)-clean:\n\t$(call QUIET_CLEAN, libapi)\n\t$(Q)$(MAKE) -C $(LIB_DIR) O=$(OUTPUT) clean >/dev/null\n\n$(LIBPERF_IN): FORCE\n\t$(Q)$(MAKE) $(build)=libperf\n\n$(LIBPERF_A): $(LIBPERF_IN)\n\t$(QUIET_AR)$(RM) $@ && $(AR) rcs $@ $(LIBPERF_IN)\n\n$(LIBPERF_SO): $(LIBPERF_IN) $(LIBAPI)\n\t$(QUIET_LINK)$(CC) --shared -Wl,-soname,libperf.so \\\n                                    -Wl,--version-script=$(VERSION_SCRIPT) $^ -o $@\n\t@ln -sf $(@F) $(OUTPUT)libperf.so\n\t@ln -sf $(@F) $(OUTPUT)libperf.so.$(LIBPERF_VERSION)\n\n\nlibs: $(LIBPERF_A) $(LIBPERF_SO) $(LIBPERF_PC)\n\nall: fixdep\n\t$(Q)$(MAKE) libs\n\nclean: $(LIBAPI)-clean\n\t$(call QUIET_CLEAN, libperf) $(RM) $(LIBPERF_A) \\\n                *.o *~ *.a *.so *.so.$(VERSION) *.so.$(LIBPERF_VERSION) .*.d .*.cmd tests/*.o LIBPERF-CFLAGS $(LIBPERF_PC) \\\n                $(TESTS_STATIC) $(TESTS_SHARED)\n\nTESTS_IN = tests-in.o\n\nTESTS_STATIC = $(OUTPUT)tests-static\nTESTS_SHARED = $(OUTPUT)tests-shared\n\n$(TESTS_IN): FORCE\n\t$(Q)$(MAKE) $(build)=tests\n\n$(TESTS_STATIC): $(TESTS_IN) $(LIBPERF_A) $(LIBAPI)\n\t$(QUIET_LINK)$(CC) -o $@ $^\n\n$(TESTS_SHARED): $(TESTS_IN) $(LIBAPI)\n\t$(QUIET_LINK)$(CC) -o $@ -L$(or $(OUTPUT),.) $^ -lperf\n\nmake-tests: libs $(TESTS_SHARED) $(TESTS_STATIC)\n\ntests: make-tests\n\t@echo \"running static:\"\n\t@./$(TESTS_STATIC) $(TEST_ARGS)\n\t@echo \"running dynamic:\"\n\t@LD_LIBRARY_PATH=. ./$(TESTS_SHARED) $(TEST_ARGS)\n\n$(LIBPERF_PC):\n\t$(QUIET_GEN)sed -e \"s|@PREFIX@|$(prefix)|\" \\\n\t\t-e \"s|@LIBDIR@|$(libdir_SQ)|\" \\\n\t\t-e \"s|@VERSION@|$(VERSION)|\" \\\n\t\t< libperf.pc.template > $@\n\ndefine do_install_mkdir\n\tif [ ! -d '$(DESTDIR_SQ)$1' ]; then             \\\n\t\t$(INSTALL) -d -m 755 '$(DESTDIR_SQ)$1'; \\\n\tfi\nendef\n\ndefine do_install\n\tif [ ! -d '$2' ]; then             \\\n\t\t$(INSTALL) -d -m 755 '$2'; \\\n\tfi;                                \\\n\t$(INSTALL) $1 $(if $3,-m $3,) '$2'\nendef\n\ninstall_lib: libs\n\t$(call QUIET_INSTALL, $(LIBPERF_ALL)) \\\n\t\t$(call do_install_mkdir,$(libdir_SQ)); \\\n\t\tcp -fpR $(LIBPERF_ALL) $(DESTDIR)$(libdir_SQ)\n\nHDRS := bpf_perf.h core.h cpumap.h threadmap.h evlist.h evsel.h event.h mmap.h\nINTERNAL_HDRS := cpumap.h evlist.h evsel.h lib.h mmap.h rc_check.h threadmap.h xyarray.h\n\nINSTALL_HDRS_PFX := $(DESTDIR)$(prefix)/include/perf\nINSTALL_HDRS := $(addprefix $(INSTALL_HDRS_PFX)/, $(HDRS))\nINSTALL_INTERNAL_HDRS_PFX := $(DESTDIR)$(prefix)/include/internal\nINSTALL_INTERNAL_HDRS := $(addprefix $(INSTALL_INTERNAL_HDRS_PFX)/, $(INTERNAL_HDRS))\n\n$(INSTALL_HDRS): $(INSTALL_HDRS_PFX)/%.h: include/perf/%.h\n\t$(call QUIET_INSTALL, $@) \\\n\t\t$(call do_install,$<,$(INSTALL_HDRS_PFX)/,644)\n\n$(INSTALL_INTERNAL_HDRS): $(INSTALL_INTERNAL_HDRS_PFX)/%.h: include/internal/%.h\n\t$(call QUIET_INSTALL, $@) \\\n\t\t$(call do_install,$<,$(INSTALL_INTERNAL_HDRS_PFX)/,644)\n\ninstall_headers: $(INSTALL_HDRS) $(INSTALL_INTERNAL_HDRS)\n\t$(call QUIET_INSTALL, libperf_headers)\n\ninstall_pkgconfig: $(LIBPERF_PC)\n\t$(call QUIET_INSTALL, $(LIBPERF_PC)) \\\n\t\t$(call do_install,$(LIBPERF_PC),$(DESTDIR_SQ)$(libdir_SQ)/pkgconfig,644)\n\ninstall_doc:\n\t$(Q)$(MAKE) -C Documentation install-man install-html install-examples\n\ninstall: install_lib install_headers install_pkgconfig install_doc\n\nFORCE:\n\n.PHONY: all install clean tests FORCE\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}