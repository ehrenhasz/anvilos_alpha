{
  "module_name": "threadmap.c",
  "hash_id": "62452cd6071118d6e340296b186f73bafe498c7bdd0c8ba44835073a166ded55",
  "original_prompt": "Ingested from linux-6.6.14/tools/lib/perf/threadmap.c",
  "human_readable_source": "\n#include <perf/threadmap.h>\n#include <stdlib.h>\n#include <linux/refcount.h>\n#include <internal/threadmap.h>\n#include <string.h>\n#include <asm/bug.h>\n#include <stdio.h>\n\nstatic void perf_thread_map__reset(struct perf_thread_map *map, int start, int nr)\n{\n\tsize_t size = (nr - start) * sizeof(map->map[0]);\n\n\tmemset(&map->map[start], 0, size);\n\tmap->err_thread = -1;\n}\n\nstruct perf_thread_map *perf_thread_map__realloc(struct perf_thread_map *map, int nr)\n{\n\tsize_t size = sizeof(*map) + sizeof(map->map[0]) * nr;\n\tint start = map ? map->nr : 0;\n\n\tmap = realloc(map, size);\n\t \n\tif (map)\n\t\tperf_thread_map__reset(map, start, nr);\n\n\treturn map;\n}\n\n#define thread_map__alloc(__nr) perf_thread_map__realloc(NULL, __nr)\n\nvoid perf_thread_map__set_pid(struct perf_thread_map *map, int idx, pid_t pid)\n{\n\tmap->map[idx].pid = pid;\n}\n\nchar *perf_thread_map__comm(struct perf_thread_map *map, int idx)\n{\n\treturn map->map[idx].comm;\n}\n\nstruct perf_thread_map *perf_thread_map__new_array(int nr_threads, pid_t *array)\n{\n\tstruct perf_thread_map *threads = thread_map__alloc(nr_threads);\n\tint i;\n\n\tif (!threads)\n\t\treturn NULL;\n\n\tfor (i = 0; i < nr_threads; i++)\n\t\tperf_thread_map__set_pid(threads, i, array ? array[i] : -1);\n\n\tthreads->nr = nr_threads;\n\trefcount_set(&threads->refcnt, 1);\n\n\treturn threads;\n}\n\nstruct perf_thread_map *perf_thread_map__new_dummy(void)\n{\n\treturn perf_thread_map__new_array(1, NULL);\n}\n\nstatic void perf_thread_map__delete(struct perf_thread_map *threads)\n{\n\tif (threads) {\n\t\tint i;\n\n\t\tWARN_ONCE(refcount_read(&threads->refcnt) != 0,\n\t\t\t  \"thread map refcnt unbalanced\\n\");\n\t\tfor (i = 0; i < threads->nr; i++)\n\t\t\tfree(perf_thread_map__comm(threads, i));\n\t\tfree(threads);\n\t}\n}\n\nstruct perf_thread_map *perf_thread_map__get(struct perf_thread_map *map)\n{\n\tif (map)\n\t\trefcount_inc(&map->refcnt);\n\treturn map;\n}\n\nvoid perf_thread_map__put(struct perf_thread_map *map)\n{\n\tif (map && refcount_dec_and_test(&map->refcnt))\n\t\tperf_thread_map__delete(map);\n}\n\nint perf_thread_map__nr(struct perf_thread_map *threads)\n{\n\treturn threads ? threads->nr : 1;\n}\n\npid_t perf_thread_map__pid(struct perf_thread_map *map, int idx)\n{\n\treturn map->map[idx].pid;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}