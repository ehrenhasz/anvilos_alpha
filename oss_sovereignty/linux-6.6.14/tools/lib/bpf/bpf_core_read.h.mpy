{
  "module_name": "bpf_core_read.h",
  "hash_id": "9e51d683771b8d8476d45c9d5f75adb753b85cf354ff2a5ecd992fdf9e431225",
  "original_prompt": "Ingested from linux-6.6.14/tools/lib/bpf/bpf_core_read.h",
  "human_readable_source": " \n#ifndef __BPF_CORE_READ_H__\n#define __BPF_CORE_READ_H__\n\n \nenum bpf_field_info_kind {\n\tBPF_FIELD_BYTE_OFFSET = 0,\t \n\tBPF_FIELD_BYTE_SIZE = 1,\n\tBPF_FIELD_EXISTS = 2,\t\t \n\tBPF_FIELD_SIGNED = 3,\n\tBPF_FIELD_LSHIFT_U64 = 4,\n\tBPF_FIELD_RSHIFT_U64 = 5,\n};\n\n \nenum bpf_type_id_kind {\n\tBPF_TYPE_ID_LOCAL = 0,\t\t \n\tBPF_TYPE_ID_TARGET = 1,\t\t \n};\n\n \nenum bpf_type_info_kind {\n\tBPF_TYPE_EXISTS = 0,\t\t \n\tBPF_TYPE_SIZE = 1,\t\t \n\tBPF_TYPE_MATCHES = 2,\t\t \n};\n\n \nenum bpf_enum_value_kind {\n\tBPF_ENUMVAL_EXISTS = 0,\t\t \n\tBPF_ENUMVAL_VALUE = 1,\t\t \n};\n\n#define __CORE_RELO(src, field, info)\t\t\t\t\t      \\\n\t__builtin_preserve_field_info((src)->field, BPF_FIELD_##info)\n\n#if __BYTE_ORDER__ == __ORDER_LITTLE_ENDIAN__\n#define __CORE_BITFIELD_PROBE_READ(dst, src, fld)\t\t\t      \\\n\tbpf_probe_read_kernel(\t\t\t\t\t\t      \\\n\t\t\t(void *)dst,\t\t\t\t      \\\n\t\t\t__CORE_RELO(src, fld, BYTE_SIZE),\t\t      \\\n\t\t\t(const void *)src + __CORE_RELO(src, fld, BYTE_OFFSET))\n#else\n \n#define __CORE_BITFIELD_PROBE_READ(dst, src, fld)\t\t\t      \\\n\tbpf_probe_read_kernel(\t\t\t\t\t\t      \\\n\t\t\t(void *)dst + (8 - __CORE_RELO(src, fld, BYTE_SIZE)), \\\n\t\t\t__CORE_RELO(src, fld, BYTE_SIZE),\t\t      \\\n\t\t\t(const void *)src + __CORE_RELO(src, fld, BYTE_OFFSET))\n#endif\n\n \n#define BPF_CORE_READ_BITFIELD_PROBED(s, field) ({\t\t\t      \\\n\tunsigned long long val = 0;\t\t\t\t\t      \\\n\t\t\t\t\t\t\t\t\t      \\\n\t__CORE_BITFIELD_PROBE_READ(&val, s, field);\t\t\t      \\\n\tval <<= __CORE_RELO(s, field, LSHIFT_U64);\t\t\t      \\\n\tif (__CORE_RELO(s, field, SIGNED))\t\t\t\t      \\\n\t\tval = ((long long)val) >> __CORE_RELO(s, field, RSHIFT_U64);  \\\n\telse\t\t\t\t\t\t\t\t      \\\n\t\tval = val >> __CORE_RELO(s, field, RSHIFT_U64);\t\t      \\\n\tval;\t\t\t\t\t\t\t\t      \\\n})\n\n \n#define BPF_CORE_READ_BITFIELD(s, field) ({\t\t\t\t      \\\n\tconst void *p = (const void *)s + __CORE_RELO(s, field, BYTE_OFFSET); \\\n\tunsigned long long val;\t\t\t\t\t\t      \\\n\t\t\t\t\t\t\t\t\t      \\\n\t \t\t\t\t\t\t\t\t      \\\n\tasm volatile(\"\" : \"=r\"(p) : \"0\"(p));\t\t\t\t      \\\n\t\t\t\t\t\t\t\t\t      \\\n\tswitch (__CORE_RELO(s, field, BYTE_SIZE)) {\t\t\t      \\\n\tcase 1: val = *(const unsigned char *)p; break;\t\t\t      \\\n\tcase 2: val = *(const unsigned short *)p; break;\t\t      \\\n\tcase 4: val = *(const unsigned int *)p; break;\t\t\t      \\\n\tcase 8: val = *(const unsigned long long *)p; break;\t\t      \\\n\t}\t\t\t\t\t\t\t\t      \\\n\tval <<= __CORE_RELO(s, field, LSHIFT_U64);\t\t\t      \\\n\tif (__CORE_RELO(s, field, SIGNED))\t\t\t\t      \\\n\t\tval = ((long long)val) >> __CORE_RELO(s, field, RSHIFT_U64);  \\\n\telse\t\t\t\t\t\t\t\t      \\\n\t\tval = val >> __CORE_RELO(s, field, RSHIFT_U64);\t\t      \\\n\tval;\t\t\t\t\t\t\t\t      \\\n})\n\n#define ___bpf_field_ref1(field)\t(field)\n#define ___bpf_field_ref2(type, field)\t(((typeof(type) *)0)->field)\n#define ___bpf_field_ref(args...)\t\t\t\t\t    \\\n\t___bpf_apply(___bpf_field_ref, ___bpf_narg(args))(args)\n\n \n#define bpf_core_field_exists(field...)\t\t\t\t\t    \\\n\t__builtin_preserve_field_info(___bpf_field_ref(field), BPF_FIELD_EXISTS)\n\n \n#define bpf_core_field_size(field...)\t\t\t\t\t    \\\n\t__builtin_preserve_field_info(___bpf_field_ref(field), BPF_FIELD_BYTE_SIZE)\n\n \n#define bpf_core_field_offset(field...)\t\t\t\t\t    \\\n\t__builtin_preserve_field_info(___bpf_field_ref(field), BPF_FIELD_BYTE_OFFSET)\n\n \n#define bpf_core_type_id_local(type)\t\t\t\t\t    \\\n\t__builtin_btf_type_id(*(typeof(type) *)0, BPF_TYPE_ID_LOCAL)\n\n \n#define bpf_core_type_id_kernel(type)\t\t\t\t\t    \\\n\t__builtin_btf_type_id(*(typeof(type) *)0, BPF_TYPE_ID_TARGET)\n\n \n#define bpf_core_type_exists(type)\t\t\t\t\t    \\\n\t__builtin_preserve_type_info(*(typeof(type) *)0, BPF_TYPE_EXISTS)\n\n \n#define bpf_core_type_matches(type)\t\t\t\t\t    \\\n\t__builtin_preserve_type_info(*(typeof(type) *)0, BPF_TYPE_MATCHES)\n\n \n#define bpf_core_type_size(type)\t\t\t\t\t    \\\n\t__builtin_preserve_type_info(*(typeof(type) *)0, BPF_TYPE_SIZE)\n\n \n#define bpf_core_enum_value_exists(enum_type, enum_value)\t\t    \\\n\t__builtin_preserve_enum_value(*(typeof(enum_type) *)enum_value, BPF_ENUMVAL_EXISTS)\n\n \n#define bpf_core_enum_value(enum_type, enum_value)\t\t\t    \\\n\t__builtin_preserve_enum_value(*(typeof(enum_type) *)enum_value, BPF_ENUMVAL_VALUE)\n\n \n#define bpf_core_read(dst, sz, src)\t\t\t\t\t    \\\n\tbpf_probe_read_kernel(dst, sz, (const void *)__builtin_preserve_access_index(src))\n\n \n#define bpf_core_read_user(dst, sz, src)\t\t\t\t    \\\n\tbpf_probe_read_user(dst, sz, (const void *)__builtin_preserve_access_index(src))\n \n#define bpf_core_read_str(dst, sz, src)\t\t\t\t\t    \\\n\tbpf_probe_read_kernel_str(dst, sz, (const void *)__builtin_preserve_access_index(src))\n\n \n#define bpf_core_read_user_str(dst, sz, src)\t\t\t\t    \\\n\tbpf_probe_read_user_str(dst, sz, (const void *)__builtin_preserve_access_index(src))\n\n#define ___concat(a, b) a ## b\n#define ___apply(fn, n) ___concat(fn, n)\n#define ___nth(_1, _2, _3, _4, _5, _6, _7, _8, _9, _10, __11, N, ...) N\n\n \n#define ___narg(...) ___nth(_, ##__VA_ARGS__, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0)\n \n#define ___empty(...) ___nth(_, ##__VA_ARGS__, N, N, N, N, N, N, N, N, N, N, 0)\n\n#define ___last1(x) x\n#define ___last2(a, x) x\n#define ___last3(a, b, x) x\n#define ___last4(a, b, c, x) x\n#define ___last5(a, b, c, d, x) x\n#define ___last6(a, b, c, d, e, x) x\n#define ___last7(a, b, c, d, e, f, x) x\n#define ___last8(a, b, c, d, e, f, g, x) x\n#define ___last9(a, b, c, d, e, f, g, h, x) x\n#define ___last10(a, b, c, d, e, f, g, h, i, x) x\n#define ___last(...) ___apply(___last, ___narg(__VA_ARGS__))(__VA_ARGS__)\n\n#define ___nolast2(a, _) a\n#define ___nolast3(a, b, _) a, b\n#define ___nolast4(a, b, c, _) a, b, c\n#define ___nolast5(a, b, c, d, _) a, b, c, d\n#define ___nolast6(a, b, c, d, e, _) a, b, c, d, e\n#define ___nolast7(a, b, c, d, e, f, _) a, b, c, d, e, f\n#define ___nolast8(a, b, c, d, e, f, g, _) a, b, c, d, e, f, g\n#define ___nolast9(a, b, c, d, e, f, g, h, _) a, b, c, d, e, f, g, h\n#define ___nolast10(a, b, c, d, e, f, g, h, i, _) a, b, c, d, e, f, g, h, i\n#define ___nolast(...) ___apply(___nolast, ___narg(__VA_ARGS__))(__VA_ARGS__)\n\n#define ___arrow1(a) a\n#define ___arrow2(a, b) a->b\n#define ___arrow3(a, b, c) a->b->c\n#define ___arrow4(a, b, c, d) a->b->c->d\n#define ___arrow5(a, b, c, d, e) a->b->c->d->e\n#define ___arrow6(a, b, c, d, e, f) a->b->c->d->e->f\n#define ___arrow7(a, b, c, d, e, f, g) a->b->c->d->e->f->g\n#define ___arrow8(a, b, c, d, e, f, g, h) a->b->c->d->e->f->g->h\n#define ___arrow9(a, b, c, d, e, f, g, h, i) a->b->c->d->e->f->g->h->i\n#define ___arrow10(a, b, c, d, e, f, g, h, i, j) a->b->c->d->e->f->g->h->i->j\n#define ___arrow(...) ___apply(___arrow, ___narg(__VA_ARGS__))(__VA_ARGS__)\n\n#define ___type(...) typeof(___arrow(__VA_ARGS__))\n\n#define ___read(read_fn, dst, src_type, src, accessor)\t\t\t    \\\n\tread_fn((void *)(dst), sizeof(*(dst)), &((src_type)(src))->accessor)\n\n \n#define ___rd_first(fn, src, a) ___read(fn, &__t, ___type(src), src, a);\n#define ___rd_last(fn, ...)\t\t\t\t\t\t    \\\n\t___read(fn, &__t, ___type(___nolast(__VA_ARGS__)), __t, ___last(__VA_ARGS__));\n#define ___rd_p1(fn, ...) const void *__t; ___rd_first(fn, __VA_ARGS__)\n#define ___rd_p2(fn, ...) ___rd_p1(fn, ___nolast(__VA_ARGS__)) ___rd_last(fn, __VA_ARGS__)\n#define ___rd_p3(fn, ...) ___rd_p2(fn, ___nolast(__VA_ARGS__)) ___rd_last(fn, __VA_ARGS__)\n#define ___rd_p4(fn, ...) ___rd_p3(fn, ___nolast(__VA_ARGS__)) ___rd_last(fn, __VA_ARGS__)\n#define ___rd_p5(fn, ...) ___rd_p4(fn, ___nolast(__VA_ARGS__)) ___rd_last(fn, __VA_ARGS__)\n#define ___rd_p6(fn, ...) ___rd_p5(fn, ___nolast(__VA_ARGS__)) ___rd_last(fn, __VA_ARGS__)\n#define ___rd_p7(fn, ...) ___rd_p6(fn, ___nolast(__VA_ARGS__)) ___rd_last(fn, __VA_ARGS__)\n#define ___rd_p8(fn, ...) ___rd_p7(fn, ___nolast(__VA_ARGS__)) ___rd_last(fn, __VA_ARGS__)\n#define ___rd_p9(fn, ...) ___rd_p8(fn, ___nolast(__VA_ARGS__)) ___rd_last(fn, __VA_ARGS__)\n#define ___read_ptrs(fn, src, ...)\t\t\t\t\t    \\\n\t___apply(___rd_p, ___narg(__VA_ARGS__))(fn, src, __VA_ARGS__)\n\n#define ___core_read0(fn, fn_ptr, dst, src, a)\t\t\t\t    \\\n\t___read(fn, dst, ___type(src), src, a);\n#define ___core_readN(fn, fn_ptr, dst, src, ...)\t\t\t    \\\n\t___read_ptrs(fn_ptr, src, ___nolast(__VA_ARGS__))\t\t    \\\n\t___read(fn, dst, ___type(src, ___nolast(__VA_ARGS__)), __t,\t    \\\n\t\t___last(__VA_ARGS__));\n#define ___core_read(fn, fn_ptr, dst, src, a, ...)\t\t\t    \\\n\t___apply(___core_read, ___empty(__VA_ARGS__))(fn, fn_ptr, dst,\t    \\\n\t\t\t\t\t\t      src, a, ##__VA_ARGS__)\n\n \n#define BPF_CORE_READ_INTO(dst, src, a, ...) ({\t\t\t\t    \\\n\t___core_read(bpf_core_read, bpf_core_read,\t\t\t    \\\n\t\t     dst, (src), a, ##__VA_ARGS__)\t\t\t    \\\n})\n\n \n#define BPF_CORE_READ_USER_INTO(dst, src, a, ...) ({\t\t\t    \\\n\t___core_read(bpf_core_read_user, bpf_core_read_user,\t\t    \\\n\t\t     dst, (src), a, ##__VA_ARGS__)\t\t\t    \\\n})\n\n \n#define BPF_PROBE_READ_INTO(dst, src, a, ...) ({\t\t\t    \\\n\t___core_read(bpf_probe_read_kernel, bpf_probe_read_kernel,\t    \\\n\t\t     dst, (src), a, ##__VA_ARGS__)\t\t\t    \\\n})\n\n \n#define BPF_PROBE_READ_USER_INTO(dst, src, a, ...) ({\t\t\t    \\\n\t___core_read(bpf_probe_read_user, bpf_probe_read_user,\t\t    \\\n\t\t     dst, (src), a, ##__VA_ARGS__)\t\t\t    \\\n})\n\n \n#define BPF_CORE_READ_STR_INTO(dst, src, a, ...) ({\t\t\t    \\\n\t___core_read(bpf_core_read_str, bpf_core_read,\t\t\t    \\\n\t\t     dst, (src), a, ##__VA_ARGS__)\t\t\t    \\\n})\n\n \n#define BPF_CORE_READ_USER_STR_INTO(dst, src, a, ...) ({\t\t    \\\n\t___core_read(bpf_core_read_user_str, bpf_core_read_user,\t    \\\n\t\t     dst, (src), a, ##__VA_ARGS__)\t\t\t    \\\n})\n\n \n#define BPF_PROBE_READ_STR_INTO(dst, src, a, ...) ({\t\t\t    \\\n\t___core_read(bpf_probe_read_kernel_str, bpf_probe_read_kernel,\t    \\\n\t\t     dst, (src), a, ##__VA_ARGS__)\t\t\t    \\\n})\n\n \n#define BPF_PROBE_READ_USER_STR_INTO(dst, src, a, ...) ({\t\t    \\\n\t___core_read(bpf_probe_read_user_str, bpf_probe_read_user,\t    \\\n\t\t     dst, (src), a, ##__VA_ARGS__)\t\t\t    \\\n})\n\n \n#define BPF_CORE_READ(src, a, ...) ({\t\t\t\t\t    \\\n\t___type((src), a, ##__VA_ARGS__) __r;\t\t\t\t    \\\n\tBPF_CORE_READ_INTO(&__r, (src), a, ##__VA_ARGS__);\t\t    \\\n\t__r;\t\t\t\t\t\t\t\t    \\\n})\n\n \n#define BPF_CORE_READ_USER(src, a, ...) ({\t\t\t\t    \\\n\t___type((src), a, ##__VA_ARGS__) __r;\t\t\t\t    \\\n\tBPF_CORE_READ_USER_INTO(&__r, (src), a, ##__VA_ARGS__);\t\t    \\\n\t__r;\t\t\t\t\t\t\t\t    \\\n})\n\n \n#define BPF_PROBE_READ(src, a, ...) ({\t\t\t\t\t    \\\n\t___type((src), a, ##__VA_ARGS__) __r;\t\t\t\t    \\\n\tBPF_PROBE_READ_INTO(&__r, (src), a, ##__VA_ARGS__);\t\t    \\\n\t__r;\t\t\t\t\t\t\t\t    \\\n})\n\n \n#define BPF_PROBE_READ_USER(src, a, ...) ({\t\t\t\t    \\\n\t___type((src), a, ##__VA_ARGS__) __r;\t\t\t\t    \\\n\tBPF_PROBE_READ_USER_INTO(&__r, (src), a, ##__VA_ARGS__);\t    \\\n\t__r;\t\t\t\t\t\t\t\t    \\\n})\n\n#endif\n\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}