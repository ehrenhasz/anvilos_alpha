{
  "module_name": "usdt.bpf.h",
  "hash_id": "1645db74e5a60ba886aff35cfb2112914284751b7a7eb3e01932901683a6532e",
  "original_prompt": "Ingested from linux-6.6.14/tools/lib/bpf/usdt.bpf.h",
  "human_readable_source": " \n \n#ifndef __USDT_BPF_H__\n#define __USDT_BPF_H__\n\n#include <linux/errno.h>\n#include \"bpf_helpers.h\"\n#include \"bpf_tracing.h\"\n\n \n\n \n#ifndef BPF_USDT_MAX_SPEC_CNT\n#define BPF_USDT_MAX_SPEC_CNT 256\n#endif\n \n#ifndef BPF_USDT_MAX_IP_CNT\n#define BPF_USDT_MAX_IP_CNT (4 * BPF_USDT_MAX_SPEC_CNT)\n#endif\n\nenum __bpf_usdt_arg_type {\n\tBPF_USDT_ARG_CONST,\n\tBPF_USDT_ARG_REG,\n\tBPF_USDT_ARG_REG_DEREF,\n};\n\nstruct __bpf_usdt_arg_spec {\n\t \n\t__u64 val_off;\n\t \n\tenum __bpf_usdt_arg_type arg_type;\n\t \n\tshort reg_off;\n\t \n\tbool arg_signed;\n\t \n\tchar arg_bitshift;\n};\n\n \n#define BPF_USDT_MAX_ARG_CNT 12\nstruct __bpf_usdt_spec {\n\tstruct __bpf_usdt_arg_spec args[BPF_USDT_MAX_ARG_CNT];\n\t__u64 usdt_cookie;\n\tshort arg_cnt;\n};\n\nstruct {\n\t__uint(type, BPF_MAP_TYPE_ARRAY);\n\t__uint(max_entries, BPF_USDT_MAX_SPEC_CNT);\n\t__type(key, int);\n\t__type(value, struct __bpf_usdt_spec);\n} __bpf_usdt_specs SEC(\".maps\") __weak;\n\nstruct {\n\t__uint(type, BPF_MAP_TYPE_HASH);\n\t__uint(max_entries, BPF_USDT_MAX_IP_CNT);\n\t__type(key, long);\n\t__type(value, __u32);\n} __bpf_usdt_ip_to_spec_id SEC(\".maps\") __weak;\n\nextern const _Bool LINUX_HAS_BPF_COOKIE __kconfig;\n\nstatic __always_inline\nint __bpf_usdt_spec_id(struct pt_regs *ctx)\n{\n\tif (!LINUX_HAS_BPF_COOKIE) {\n\t\tlong ip = PT_REGS_IP(ctx);\n\t\tint *spec_id_ptr;\n\n\t\tspec_id_ptr = bpf_map_lookup_elem(&__bpf_usdt_ip_to_spec_id, &ip);\n\t\treturn spec_id_ptr ? *spec_id_ptr : -ESRCH;\n\t}\n\n\treturn bpf_get_attach_cookie(ctx);\n}\n\n \n__weak __hidden\nint bpf_usdt_arg_cnt(struct pt_regs *ctx)\n{\n\tstruct __bpf_usdt_spec *spec;\n\tint spec_id;\n\n\tspec_id = __bpf_usdt_spec_id(ctx);\n\tif (spec_id < 0)\n\t\treturn -ESRCH;\n\n\tspec = bpf_map_lookup_elem(&__bpf_usdt_specs, &spec_id);\n\tif (!spec)\n\t\treturn -ESRCH;\n\n\treturn spec->arg_cnt;\n}\n\n \n__weak __hidden\nint bpf_usdt_arg(struct pt_regs *ctx, __u64 arg_num, long *res)\n{\n\tstruct __bpf_usdt_spec *spec;\n\tstruct __bpf_usdt_arg_spec *arg_spec;\n\tunsigned long val;\n\tint err, spec_id;\n\n\t*res = 0;\n\n\tspec_id = __bpf_usdt_spec_id(ctx);\n\tif (spec_id < 0)\n\t\treturn -ESRCH;\n\n\tspec = bpf_map_lookup_elem(&__bpf_usdt_specs, &spec_id);\n\tif (!spec)\n\t\treturn -ESRCH;\n\n\tif (arg_num >= BPF_USDT_MAX_ARG_CNT)\n\t\treturn -ENOENT;\n\tbarrier_var(arg_num);\n\tif (arg_num >= spec->arg_cnt)\n\t\treturn -ENOENT;\n\n\targ_spec = &spec->args[arg_num];\n\tswitch (arg_spec->arg_type) {\n\tcase BPF_USDT_ARG_CONST:\n\t\t \n\t\tval = arg_spec->val_off;\n\t\tbreak;\n\tcase BPF_USDT_ARG_REG:\n\t\t \n\t\terr = bpf_probe_read_kernel(&val, sizeof(val), (void *)ctx + arg_spec->reg_off);\n\t\tif (err)\n\t\t\treturn err;\n\t\tbreak;\n\tcase BPF_USDT_ARG_REG_DEREF:\n\t\t \n\t\terr = bpf_probe_read_kernel(&val, sizeof(val), (void *)ctx + arg_spec->reg_off);\n\t\tif (err)\n\t\t\treturn err;\n\t\terr = bpf_probe_read_user(&val, sizeof(val), (void *)val + arg_spec->val_off);\n\t\tif (err)\n\t\t\treturn err;\n#if __BYTE_ORDER__ == __ORDER_BIG_ENDIAN__\n\t\tval >>= arg_spec->arg_bitshift;\n#endif\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\t \n\tval <<= arg_spec->arg_bitshift;\n\tif (arg_spec->arg_signed)\n\t\tval = ((long)val) >> arg_spec->arg_bitshift;\n\telse\n\t\tval = val >> arg_spec->arg_bitshift;\n\t*res = val;\n\treturn 0;\n}\n\n \n__weak __hidden\nlong bpf_usdt_cookie(struct pt_regs *ctx)\n{\n\tstruct __bpf_usdt_spec *spec;\n\tint spec_id;\n\n\tspec_id = __bpf_usdt_spec_id(ctx);\n\tif (spec_id < 0)\n\t\treturn 0;\n\n\tspec = bpf_map_lookup_elem(&__bpf_usdt_specs, &spec_id);\n\tif (!spec)\n\t\treturn 0;\n\n\treturn spec->usdt_cookie;\n}\n\n \n#define ___bpf_usdt_args0() ctx\n#define ___bpf_usdt_args1(x) ___bpf_usdt_args0(), ({ long _x; bpf_usdt_arg(ctx, 0, &_x); (void *)_x; })\n#define ___bpf_usdt_args2(x, args...) ___bpf_usdt_args1(args), ({ long _x; bpf_usdt_arg(ctx, 1, &_x); (void *)_x; })\n#define ___bpf_usdt_args3(x, args...) ___bpf_usdt_args2(args), ({ long _x; bpf_usdt_arg(ctx, 2, &_x); (void *)_x; })\n#define ___bpf_usdt_args4(x, args...) ___bpf_usdt_args3(args), ({ long _x; bpf_usdt_arg(ctx, 3, &_x); (void *)_x; })\n#define ___bpf_usdt_args5(x, args...) ___bpf_usdt_args4(args), ({ long _x; bpf_usdt_arg(ctx, 4, &_x); (void *)_x; })\n#define ___bpf_usdt_args6(x, args...) ___bpf_usdt_args5(args), ({ long _x; bpf_usdt_arg(ctx, 5, &_x); (void *)_x; })\n#define ___bpf_usdt_args7(x, args...) ___bpf_usdt_args6(args), ({ long _x; bpf_usdt_arg(ctx, 6, &_x); (void *)_x; })\n#define ___bpf_usdt_args8(x, args...) ___bpf_usdt_args7(args), ({ long _x; bpf_usdt_arg(ctx, 7, &_x); (void *)_x; })\n#define ___bpf_usdt_args9(x, args...) ___bpf_usdt_args8(args), ({ long _x; bpf_usdt_arg(ctx, 8, &_x); (void *)_x; })\n#define ___bpf_usdt_args10(x, args...) ___bpf_usdt_args9(args), ({ long _x; bpf_usdt_arg(ctx, 9, &_x); (void *)_x; })\n#define ___bpf_usdt_args11(x, args...) ___bpf_usdt_args10(args), ({ long _x; bpf_usdt_arg(ctx, 10, &_x); (void *)_x; })\n#define ___bpf_usdt_args12(x, args...) ___bpf_usdt_args11(args), ({ long _x; bpf_usdt_arg(ctx, 11, &_x); (void *)_x; })\n#define ___bpf_usdt_args(args...) ___bpf_apply(___bpf_usdt_args, ___bpf_narg(args))(args)\n\n \n#define BPF_USDT(name, args...)\t\t\t\t\t\t    \\\nname(struct pt_regs *ctx);\t\t\t\t\t\t    \\\nstatic __always_inline typeof(name(0))\t\t\t\t\t    \\\n____##name(struct pt_regs *ctx, ##args);\t\t\t\t    \\\ntypeof(name(0)) name(struct pt_regs *ctx)\t\t\t\t    \\\n{\t\t\t\t\t\t\t\t\t    \\\n        _Pragma(\"GCC diagnostic push\")\t\t\t\t\t    \\\n        _Pragma(\"GCC diagnostic ignored \\\"-Wint-conversion\\\"\")\t\t    \\\n        return ____##name(___bpf_usdt_args(args));\t\t\t    \\\n        _Pragma(\"GCC diagnostic pop\")\t\t\t\t\t    \\\n}\t\t\t\t\t\t\t\t\t    \\\nstatic __always_inline typeof(name(0))\t\t\t\t\t    \\\n____##name(struct pt_regs *ctx, ##args)\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}