{
  "module_name": "Makefile",
  "hash_id": "4228722ca107f3bdba919dcfa860834fd8b95d2bb083d1368600dee9dd87cf5c",
  "original_prompt": "Ingested from linux-6.6.14/tools/lib/bpf/Makefile",
  "human_readable_source": "# SPDX-License-Identifier: (LGPL-2.1 OR BSD-2-Clause)\n# Most of this file is copied from tools/lib/traceevent/Makefile\n\nRM ?= rm\nsrctree = $(abs_srctree)\n\nVERSION_SCRIPT := libbpf.map\nLIBBPF_VERSION := $(shell \\\n\tgrep -oE '^LIBBPF_([0-9.]+)' $(VERSION_SCRIPT) | \\\n\tsort -rV | head -n1 | cut -d'_' -f2)\nLIBBPF_MAJOR_VERSION := $(word 1,$(subst ., ,$(LIBBPF_VERSION)))\nLIBBPF_MINOR_VERSION := $(word 2,$(subst ., ,$(LIBBPF_VERSION)))\n\nMAKEFLAGS += --no-print-directory\n\n# This will work when bpf is built in tools env. where srctree\n# isn't set and when invoked from selftests build, where srctree\n# is a \".\". building_out_of_srctree is undefined for in srctree\n# builds\nifndef building_out_of_srctree\nsrctree := $(patsubst %/,%,$(dir $(CURDIR)))\nsrctree := $(patsubst %/,%,$(dir $(srctree)))\nsrctree := $(patsubst %/,%,$(dir $(srctree)))\n#$(info Determined 'srctree' to be $(srctree))\nendif\n\nINSTALL = install\n\n# Use DESTDIR for installing into a different root directory.\n# This is useful for building a package. The program will be\n# installed in this directory as if it was the root directory.\n# Then the build tool can move it later.\nDESTDIR ?=\nDESTDIR_SQ = '$(subst ','\\'',$(DESTDIR))'\n\ninclude $(srctree)/tools/scripts/Makefile.arch\n\nifeq ($(LP64), 1)\n  libdir_relative = lib64\nelse\n  libdir_relative = lib\nendif\n\nprefix ?= /usr/local\nlibdir = $(prefix)/$(libdir_relative)\nman_dir = $(prefix)/share/man\nman_dir_SQ = '$(subst ','\\'',$(man_dir))'\n\nexport man_dir man_dir_SQ INSTALL\nexport DESTDIR DESTDIR_SQ\n\ninclude $(srctree)/tools/scripts/Makefile.include\n\n# copy a bit from Linux kbuild\n\nifeq (\"$(origin V)\", \"command line\")\n  VERBOSE = $(V)\nendif\nifndef VERBOSE\n  VERBOSE = 0\nendif\n\nINCLUDES = -I$(or $(OUTPUT),.) \\\n\t   -I$(srctree)/tools/include -I$(srctree)/tools/include/uapi\n\nexport prefix libdir src obj\n\n# Shell quotes\nlibdir_SQ = $(subst ','\\'',$(libdir))\nlibdir_relative_SQ = $(subst ','\\'',$(libdir_relative))\n\nOBJ\t\t= $@\nN\t\t=\n\nLIB_TARGET\t= libbpf.a libbpf.so.$(LIBBPF_VERSION)\nLIB_FILE\t= libbpf.a libbpf.so*\nPC_FILE\t\t= libbpf.pc\n\n# Set compile option CFLAGS\nifdef EXTRA_CFLAGS\n  CFLAGS := $(EXTRA_CFLAGS)\nelse\n  CFLAGS := -g -O2\nendif\n\n# Append required CFLAGS\noverride CFLAGS += -std=gnu89\noverride CFLAGS += $(EXTRA_WARNINGS) -Wno-switch-enum\noverride CFLAGS += -Werror -Wall\noverride CFLAGS += $(INCLUDES)\noverride CFLAGS += -fvisibility=hidden\noverride CFLAGS += -D_LARGEFILE64_SOURCE -D_FILE_OFFSET_BITS=64\noverride CFLAGS += $(CLANG_CROSS_FLAGS)\n\n# flags specific for shared library\nSHLIB_FLAGS := -DSHARED -fPIC\n\nifeq ($(VERBOSE),1)\n  Q =\nelse\n  Q = @\nendif\n\n# Disable command line variables (CFLAGS) override from top\n# level Makefile (perf), otherwise build Makefile will get\n# the same command line setup.\nMAKEOVERRIDES=\n\nall:\n\nexport srctree OUTPUT CC LD CFLAGS V\ninclude $(srctree)/tools/build/Makefile.include\n\nSHARED_OBJDIR\t:= $(OUTPUT)sharedobjs/\nSTATIC_OBJDIR\t:= $(OUTPUT)staticobjs/\nBPF_IN_SHARED\t:= $(SHARED_OBJDIR)libbpf-in.o\nBPF_IN_STATIC\t:= $(STATIC_OBJDIR)libbpf-in.o\nBPF_HELPER_DEFS\t:= $(OUTPUT)bpf_helper_defs.h\nBPF_GENERATED\t:= $(BPF_HELPER_DEFS)\n\nLIB_TARGET\t:= $(addprefix $(OUTPUT),$(LIB_TARGET))\nLIB_FILE\t:= $(addprefix $(OUTPUT),$(LIB_FILE))\nPC_FILE\t\t:= $(addprefix $(OUTPUT),$(PC_FILE))\n\nTAGS_PROG := $(if $(shell which etags 2>/dev/null),etags,ctags)\n\nGLOBAL_SYM_COUNT = $(shell readelf -s --wide $(BPF_IN_SHARED) | \\\n\t\t\t   cut -d \"@\" -f1 | sed 's/_v[0-9]_[0-9]_[0-9].*//' | \\\n\t\t\t   sed 's/\\[.*\\]//' | \\\n\t\t\t   awk '/GLOBAL/ && /DEFAULT/ && !/UND|ABS/ {print $$NF}' | \\\n\t\t\t   sort -u | wc -l)\nVERSIONED_SYM_COUNT = $(shell readelf --dyn-syms --wide $(OUTPUT)libbpf.so | \\\n\t\t\t      sed 's/\\[.*\\]//' | \\\n\t\t\t      awk '/GLOBAL/ && /DEFAULT/ && !/UND|ABS/ {print $$NF}' | \\\n\t\t\t      grep -Eo '[^ ]+@LIBBPF_' | cut -d@ -f1 | sort -u | wc -l)\n\nCMD_TARGETS = $(LIB_TARGET) $(PC_FILE)\n\nall: fixdep\n\t$(Q)$(MAKE) all_cmd\n\nall_cmd: $(CMD_TARGETS) check\n\n$(BPF_IN_SHARED): force $(BPF_GENERATED)\n\t@(test -f ../../include/uapi/linux/bpf.h -a -f ../../../include/uapi/linux/bpf.h && ( \\\n\t(diff -B ../../include/uapi/linux/bpf.h ../../../include/uapi/linux/bpf.h >/dev/null) || \\\n\techo \"Warning: Kernel ABI header at 'tools/include/uapi/linux/bpf.h' differs from latest version at 'include/uapi/linux/bpf.h'\" >&2 )) || true\n\t@(test -f ../../include/uapi/linux/bpf_common.h -a -f ../../../include/uapi/linux/bpf_common.h && ( \\\n\t(diff -B ../../include/uapi/linux/bpf_common.h ../../../include/uapi/linux/bpf_common.h >/dev/null) || \\\n\techo \"Warning: Kernel ABI header at 'tools/include/uapi/linux/bpf_common.h' differs from latest version at 'include/uapi/linux/bpf_common.h'\" >&2 )) || true\n\t@(test -f ../../include/uapi/linux/if_xdp.h -a -f ../../../include/uapi/linux/if_xdp.h && ( \\\n\t(diff -B ../../include/uapi/linux/if_xdp.h ../../../include/uapi/linux/if_xdp.h >/dev/null) || \\\n\techo \"Warning: Kernel ABI header at 'tools/include/uapi/linux/if_xdp.h' differs from latest version at 'include/uapi/linux/if_xdp.h'\" >&2 )) || true\n\t$(Q)$(MAKE) $(build)=libbpf OUTPUT=$(SHARED_OBJDIR) CFLAGS=\"$(CFLAGS) $(SHLIB_FLAGS)\"\n\n$(BPF_IN_STATIC): force $(BPF_GENERATED)\n\t$(Q)$(MAKE) $(build)=libbpf OUTPUT=$(STATIC_OBJDIR)\n\n$(BPF_HELPER_DEFS): $(srctree)/tools/include/uapi/linux/bpf.h\n\t$(QUIET_GEN)$(srctree)/scripts/bpf_doc.py --header \\\n\t\t--file $(srctree)/tools/include/uapi/linux/bpf.h > $(BPF_HELPER_DEFS)\n\n$(OUTPUT)libbpf.so: $(OUTPUT)libbpf.so.$(LIBBPF_VERSION)\n\n$(OUTPUT)libbpf.so.$(LIBBPF_VERSION): $(BPF_IN_SHARED) $(VERSION_SCRIPT)\n\t$(QUIET_LINK)$(CC) $(CFLAGS) $(LDFLAGS) \\\n\t\t--shared -Wl,-soname,libbpf.so.$(LIBBPF_MAJOR_VERSION) \\\n\t\t-Wl,--version-script=$(VERSION_SCRIPT) $< -lelf -lz -o $@\n\t@ln -sf $(@F) $(OUTPUT)libbpf.so\n\t@ln -sf $(@F) $(OUTPUT)libbpf.so.$(LIBBPF_MAJOR_VERSION)\n\n$(OUTPUT)libbpf.a: $(BPF_IN_STATIC)\n\t$(QUIET_LINK)$(RM) -f $@; $(AR) rcs $@ $^\n\n$(OUTPUT)libbpf.pc:\n\t$(QUIET_GEN)sed -e \"s|@PREFIX@|$(prefix)|\" \\\n\t\t-e \"s|@LIBDIR@|$(libdir_SQ)|\" \\\n\t\t-e \"s|@VERSION@|$(LIBBPF_VERSION)|\" \\\n\t\t< libbpf.pc.template > $@\n\ncheck: check_abi check_version\n\ncheck_abi: $(OUTPUT)libbpf.so $(VERSION_SCRIPT)\n\t@if [ \"$(GLOBAL_SYM_COUNT)\" != \"$(VERSIONED_SYM_COUNT)\" ]; then\t \\\n\t\techo \"Warning: Num of global symbols in $(BPF_IN_SHARED)\"\t \\\n\t\t     \"($(GLOBAL_SYM_COUNT)) does NOT match with num of\"\t \\\n\t\t     \"versioned symbols in $^ ($(VERSIONED_SYM_COUNT)).\" \\\n\t\t     \"Please make sure all LIBBPF_API symbols are\"\t \\\n\t\t     \"versioned in $(VERSION_SCRIPT).\" >&2;\t\t \\\n\t\treadelf -s --wide $(BPF_IN_SHARED) |\t\t\t \\\n\t\t    cut -d \"@\" -f1 | sed 's/_v[0-9]_[0-9]_[0-9].*//' |\t \\\n\t\t    sed 's/\\[.*\\]//' |\t\t\t\t\t \\\n\t\t    awk '/GLOBAL/ && /DEFAULT/ && !/UND/ {print $$NF}'|  \\\n\t\t    sort -u > $(OUTPUT)libbpf_global_syms.tmp;\t\t \\\n\t\treadelf --dyn-syms --wide $(OUTPUT)libbpf.so |\t\t \\\n\t\t    sed 's/\\[.*\\]//' |\t\t\t\t\t \\\n\t\t    awk '/GLOBAL/ && /DEFAULT/ && !/UND|ABS/ {print $$NF}'|  \\\n\t\t    grep -Eo '[^ ]+@LIBBPF_' | cut -d@ -f1 |\t\t \\\n\t\t    sort -u > $(OUTPUT)libbpf_versioned_syms.tmp; \t \\\n\t\tdiff -u $(OUTPUT)libbpf_global_syms.tmp\t\t\t \\\n\t\t     $(OUTPUT)libbpf_versioned_syms.tmp;\t\t \\\n\t\trm $(OUTPUT)libbpf_global_syms.tmp\t\t\t \\\n\t\t   $(OUTPUT)libbpf_versioned_syms.tmp;\t\t\t \\\n\t\texit 1;\t\t\t\t\t\t\t \\\n\tfi\n\nHDR_MAJ_VERSION := $(shell grep -oE '^$(pound)define LIBBPF_MAJOR_VERSION ([0-9]+)$$' libbpf_version.h | cut -d' ' -f3)\nHDR_MIN_VERSION := $(shell grep -oE '^$(pound)define LIBBPF_MINOR_VERSION ([0-9]+)$$' libbpf_version.h | cut -d' ' -f3)\n\ncheck_version: $(VERSION_SCRIPT) libbpf_version.h\n\t@if [ \"$(HDR_MAJ_VERSION)\" != \"$(LIBBPF_MAJOR_VERSION)\" ]; then        \\\n\t\techo \"Error: libbpf major version mismatch detected: \"\t       \\\n\t\t     \"'$(HDR_MAJ_VERSION)' != '$(LIBBPF_MAJOR_VERSION)'\" >&2;  \\\n\t\texit 1;\t\t\t\t\t\t\t       \\\n\tfi\n\t@if [ \"$(HDR_MIN_VERSION)\" != \"$(LIBBPF_MINOR_VERSION)\" ]; then\t       \\\n\t\techo \"Error: libbpf minor version mismatch detected: \"\t       \\\n\t\t     \"'$(HDR_MIN_VERSION)' != '$(LIBBPF_MINOR_VERSION)'\" >&2;  \\\n\t\texit 1;\t\t\t\t\t\t\t       \\\n\tfi\n\ndefine do_install_mkdir\n\tif [ ! -d '$(DESTDIR_SQ)$1' ]; then\t\t\\\n\t\t$(INSTALL) -d -m 755 '$(DESTDIR_SQ)$1';\t\\\n\tfi\nendef\n\ndefine do_install\n\tif [ ! -d '$(DESTDIR_SQ)$2' ]; then\t\t\\\n\t\t$(INSTALL) -d -m 755 '$(DESTDIR_SQ)$2';\t\\\n\tfi;\t\t\t\t\t\t\\\n\t$(INSTALL) $(if $3,-m $3,) $1 '$(DESTDIR_SQ)$2'\nendef\n\ninstall_lib: all_cmd\n\t$(call QUIET_INSTALL, $(LIB_TARGET)) \\\n\t\t$(call do_install_mkdir,$(libdir_SQ)); \\\n\t\tcp -fpR $(LIB_FILE) $(DESTDIR)$(libdir_SQ)\n\nSRC_HDRS := bpf.h libbpf.h btf.h libbpf_common.h libbpf_legacy.h\t     \\\n\t    bpf_helpers.h bpf_tracing.h bpf_endian.h bpf_core_read.h\t     \\\n\t    skel_internal.h libbpf_version.h usdt.bpf.h\nGEN_HDRS := $(BPF_GENERATED)\n\nINSTALL_PFX := $(DESTDIR)$(prefix)/include/bpf\nINSTALL_SRC_HDRS := $(addprefix $(INSTALL_PFX)/, $(SRC_HDRS))\nINSTALL_GEN_HDRS := $(addprefix $(INSTALL_PFX)/, $(notdir $(GEN_HDRS)))\n\n$(INSTALL_SRC_HDRS): $(INSTALL_PFX)/%.h: %.h\n\t$(call QUIET_INSTALL, $@) \\\n\t\t$(call do_install,$<,$(prefix)/include/bpf,644)\n\n$(INSTALL_GEN_HDRS): $(INSTALL_PFX)/%.h: $(OUTPUT)%.h\n\t$(call QUIET_INSTALL, $@) \\\n\t\t$(call do_install,$<,$(prefix)/include/bpf,644)\n\ninstall_headers: $(BPF_GENERATED) $(INSTALL_SRC_HDRS) $(INSTALL_GEN_HDRS)\n\t$(call QUIET_INSTALL, libbpf_headers)\n\ninstall_pkgconfig: $(PC_FILE)\n\t$(call QUIET_INSTALL, $(PC_FILE)) \\\n\t\t$(call do_install,$(PC_FILE),$(libdir_SQ)/pkgconfig,644)\n\ninstall: install_lib install_pkgconfig install_headers\n\nclean:\n\t$(call QUIET_CLEAN, libbpf) $(RM) -rf $(CMD_TARGETS)\t\t     \\\n\t\t*~ .*.d .*.cmd LIBBPF-CFLAGS $(BPF_GENERATED)\t\t     \\\n\t\t$(SHARED_OBJDIR) $(STATIC_OBJDIR)\t\t\t     \\\n\t\t$(addprefix $(OUTPUT),\t\t\t\t\t     \\\n\t\t\t    *.o *.a *.so *.so.$(LIBBPF_MAJOR_VERSION) *.pc)\n\nPHONY += force cscope tags check check_abi check_version\nforce:\n\ncscope:\n\tls *.c *.h > cscope.files\n\tcscope -b -q -I $(srctree)/include -f cscope.out\n\ntags:\n\t$(RM) -f TAGS tags\n\tls *.c *.h | xargs $(TAGS_PROG) -a\n\n# Declare the contents of the .PHONY variable as phony.  We keep that\n# information in a variable so we can use it in if_changed and friends.\n.PHONY: $(PHONY)\n\n# Delete partially updated (corrupted) files on error\n.DELETE_ON_ERROR:\n\nhelp:\n\t@echo 'libbpf common targets:'\n\t@echo '  HINT: use \"V=1\" to enable verbose build'\n\t@echo '  all     - build libraries and pkgconfig'\n\t@echo '  clean   - remove all generated files'\n\t@echo '  check   - check ABI and version info'\n\t@echo ''\n\t@echo 'libbpf install targets:'\n\t@echo '  HINT: use \"prefix\"(defaults to \"/usr/local\") or \"DESTDIR\" (defaults to \"/\")'\n\t@echo '        to adjust target destination, e.g. \"make prefix=/usr/local install\"'\n\t@echo '  install          - build and install all headers, libraries and pkgconfig'\n\t@echo '  install_headers  - install only headers to include/bpf'\n\t@echo ''\n\t@echo 'libbpf make targets:'\n\t@echo '  tags    - use ctags to make tag information for source code browsing'\n\t@echo '  cscope  - use cscope to make interactive source code browsing database'\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}