{
  "module_name": "sampling.c",
  "hash_id": "45eccf963bbbe91f6a8564b42994e387a73f1fecbe029c25703e8086cedee2a6",
  "original_prompt": "Ingested from linux-6.6.14/tools/lib/thermal/sampling.c",
  "human_readable_source": "\n\n#include <errno.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <unistd.h>\n\n#include <thermal.h>\n#include \"thermal_nl.h\"\n\nstatic int handle_thermal_sample(struct nl_msg *n, void *arg)\n{\n\tstruct nlmsghdr *nlh = nlmsg_hdr(n);\n\tstruct genlmsghdr *genlhdr = genlmsg_hdr(nlh);\n\tstruct nlattr *attrs[THERMAL_GENL_ATTR_MAX + 1];\n\tstruct thermal_handler_param *thp = arg;\n\tstruct thermal_handler *th = thp->th;\n\n\tgenlmsg_parse(nlh, 0, attrs, THERMAL_GENL_ATTR_MAX, NULL);\n\n\tswitch (genlhdr->cmd) {\n\n\tcase THERMAL_GENL_SAMPLING_TEMP:\n\t\treturn th->ops->sampling.tz_temp(\n\t\t\tnla_get_u32(attrs[THERMAL_GENL_ATTR_TZ_ID]),\n\t\t\tnla_get_u32(attrs[THERMAL_GENL_ATTR_TZ_TEMP]), arg);\n\tdefault:\n\t\treturn THERMAL_ERROR;\n\t}\n}\n\nthermal_error_t thermal_sampling_handle(struct thermal_handler *th, void *arg)\n{\n\tstruct thermal_handler_param thp = { .th = th, .arg = arg };\n\n\tif (!th)\n\t\treturn THERMAL_ERROR;\n\n\tif (nl_cb_set(th->cb_sampling, NL_CB_VALID, NL_CB_CUSTOM,\n\t\t      handle_thermal_sample, &thp))\n\t\treturn THERMAL_ERROR;\n\n\treturn nl_recvmsgs(th->sk_sampling, th->cb_sampling);\n}\n\nint thermal_sampling_fd(struct thermal_handler *th)\n{\n\tif (!th)\n\t\treturn -1;\n\n\treturn nl_socket_get_fd(th->sk_sampling);\n}\n\nthermal_error_t thermal_sampling_exit(struct thermal_handler *th)\n{\n\tif (nl_unsubscribe_thermal(th->sk_sampling, th->cb_sampling,\n\t\t\t\t   THERMAL_GENL_SAMPLING_GROUP_NAME))\n\t\treturn THERMAL_ERROR;\n\n\tnl_thermal_disconnect(th->sk_sampling, th->cb_sampling);\n\n\treturn THERMAL_SUCCESS;\n}\n\nthermal_error_t thermal_sampling_init(struct thermal_handler *th)\n{\n\tif (nl_thermal_connect(&th->sk_sampling, &th->cb_sampling))\n\t\treturn THERMAL_ERROR;\n\n\tif (nl_subscribe_thermal(th->sk_sampling, th->cb_sampling,\n\t\t\t\t THERMAL_GENL_SAMPLING_GROUP_NAME))\n\t\treturn THERMAL_ERROR;\n\n\treturn THERMAL_SUCCESS;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}