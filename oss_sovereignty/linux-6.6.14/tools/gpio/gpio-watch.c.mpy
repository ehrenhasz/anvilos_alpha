{
  "module_name": "gpio-watch.c",
  "hash_id": "fd1ab813d14c6f405d1ed89e0ac469ee0d06c9d72bbe6d3a341f46f63f77306c",
  "original_prompt": "Ingested from linux-6.6.14/tools/gpio/gpio-watch.c",
  "human_readable_source": "\n \n\n#include <ctype.h>\n#include <errno.h>\n#include <fcntl.h>\n#include <inttypes.h>\n#include <linux/gpio.h>\n#include <poll.h>\n#include <stdbool.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <sys/ioctl.h>\n#include <unistd.h>\n\nint main(int argc, char **argv)\n{\n\tstruct gpio_v2_line_info_changed chg;\n\tstruct gpio_v2_line_info req;\n\tstruct pollfd pfd;\n\tint fd, i, j, ret;\n\tchar *event, *end;\n\tssize_t rd;\n\n\tif (argc < 3)\n\t\tgoto err_usage;\n\n\tfd = open(argv[1], O_RDWR | O_CLOEXEC);\n\tif (fd < 0) {\n\t\tperror(\"unable to open gpiochip\");\n\t\treturn EXIT_FAILURE;\n\t}\n\n\tfor (i = 0, j = 2; i < argc - 2; i++, j++) {\n\t\tmemset(&req, 0, sizeof(req));\n\n\t\treq.offset = strtoul(argv[j], &end, 0);\n\t\tif (*end != '\\0')\n\t\t\tgoto err_usage;\n\n\t\tret = ioctl(fd, GPIO_V2_GET_LINEINFO_WATCH_IOCTL, &req);\n\t\tif (ret) {\n\t\t\tperror(\"unable to set up line watch\");\n\t\t\treturn EXIT_FAILURE;\n\t\t}\n\t}\n\n\tpfd.fd = fd;\n\tpfd.events = POLLIN | POLLPRI;\n\n\tfor (;;) {\n\t\tret = poll(&pfd, 1, 5000);\n\t\tif (ret < 0) {\n\t\t\tperror(\"error polling the linechanged fd\");\n\t\t\treturn EXIT_FAILURE;\n\t\t} else if (ret > 0) {\n\t\t\tmemset(&chg, 0, sizeof(chg));\n\t\t\trd = read(pfd.fd, &chg, sizeof(chg));\n\t\t\tif (rd < 0 || rd != sizeof(chg)) {\n\t\t\t\tif (rd != sizeof(chg))\n\t\t\t\t\terrno = EIO;\n\n\t\t\t\tperror(\"error reading line change event\");\n\t\t\t\treturn EXIT_FAILURE;\n\t\t\t}\n\n\t\t\tswitch (chg.event_type) {\n\t\t\tcase GPIO_V2_LINE_CHANGED_REQUESTED:\n\t\t\t\tevent = \"requested\";\n\t\t\t\tbreak;\n\t\t\tcase GPIO_V2_LINE_CHANGED_RELEASED:\n\t\t\t\tevent = \"released\";\n\t\t\t\tbreak;\n\t\t\tcase GPIO_V2_LINE_CHANGED_CONFIG:\n\t\t\t\tevent = \"config changed\";\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tfprintf(stderr,\n\t\t\t\t\t\"invalid event type received from the kernel\\n\");\n\t\t\t\treturn EXIT_FAILURE;\n\t\t\t}\n\n\t\t\tprintf(\"line %u: %s at %\" PRIu64 \"\\n\",\n\t\t\t       chg.info.offset, event, (uint64_t)chg.timestamp_ns);\n\t\t}\n\t}\n\n\treturn 0;\n\nerr_usage:\n\tprintf(\"%s: <gpiochip> <line0> <line1> ...\\n\", argv[0]);\n\treturn EXIT_FAILURE;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}