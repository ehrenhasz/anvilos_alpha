{
  "module_name": "ioctl.c",
  "hash_id": "0964c4189602959bb8ac282b092f23d43b22ebfd88185322652421f502fef1bb",
  "original_prompt": "Ingested from linux-6.6.14/tools/perf/trace/beauty/ioctl.c",
  "human_readable_source": "\n \n\n#include \"trace/beauty/beauty.h\"\n#include <linux/kernel.h>\n\n \n#include <uapi/asm-generic/ioctls.h>\n\nstatic size_t ioctl__scnprintf_tty_cmd(int nr, int dir, char *bf, size_t size)\n{\n\tstatic const char *ioctl_tty_cmd[] = {\n\t[_IOC_NR(TCGETS)] = \"TCGETS\", \"TCSETS\", \"TCSETSW\", \"TCSETSF\", \"TCGETA\", \"TCSETA\", \"TCSETAW\",\n\t\"TCSETAF\", \"TCSBRK\", \"TCXONC\", \"TCFLSH\", \"TIOCEXCL\", \"TIOCNXCL\", \"TIOCSCTTY\",\n\t\"TIOCGPGRP\", \"TIOCSPGRP\", \"TIOCOUTQ\", \"TIOCSTI\", \"TIOCGWINSZ\", \"TIOCSWINSZ\",\n\t\"TIOCMGET\", \"TIOCMBIS\", \"TIOCMBIC\", \"TIOCMSET\", \"TIOCGSOFTCAR\", \"TIOCSSOFTCAR\",\n\t\"FIONREAD\", \"TIOCLINUX\", \"TIOCCONS\", \"TIOCGSERIAL\", \"TIOCSSERIAL\", \"TIOCPKT\",\n\t\"FIONBIO\", \"TIOCNOTTY\", \"TIOCSETD\", \"TIOCGETD\", \"TCSBRKP\",\n\t[_IOC_NR(TIOCSBRK)] = \"TIOCSBRK\", \"TIOCCBRK\", \"TIOCGSID\", \"TCGETS2\", \"TCSETS2\",\n\t\"TCSETSW2\", \"TCSETSF2\", \"TIOCGRS48\", \"TIOCSRS485\", \"TIOCGPTN\", \"TIOCSPTLCK\",\n\t\"TIOCGDEV\", \"TCSETX\", \"TCSETXF\", \"TCSETXW\", \"TIOCSIG\", \"TIOCVHANGUP\", \"TIOCGPKT\",\n\t\"TIOCGPTLCK\", [_IOC_NR(TIOCGEXCL)] = \"TIOCGEXCL\", \"TIOCGPTPEER\",\n\t\"TIOCGISO7816\", \"TIOCSISO7816\",\n\t[_IOC_NR(FIONCLEX)] = \"FIONCLEX\", \"FIOCLEX\", \"FIOASYNC\", \"TIOCSERCONFIG\",\n\t\"TIOCSERGWILD\", \"TIOCSERSWILD\", \"TIOCGLCKTRMIOS\", \"TIOCSLCKTRMIOS\",\n\t\"TIOCSERGSTRUCT\", \"TIOCSERGETLSR\", \"TIOCSERGETMULTI\", \"TIOCSERSETMULTI\",\n\t\"TIOCMIWAIT\", \"TIOCGICOUNT\", };\n\tstatic DEFINE_STRARRAY(ioctl_tty_cmd, \"\");\n\n\tif (nr < strarray__ioctl_tty_cmd.nr_entries && strarray__ioctl_tty_cmd.entries[nr] != NULL)\n\t\treturn scnprintf(bf, size, \"%s\", strarray__ioctl_tty_cmd.entries[nr]);\n\n\treturn scnprintf(bf, size, \"(%#x, %#x, %#x)\", 'T', nr, dir);\n}\n\nstatic size_t ioctl__scnprintf_drm_cmd(int nr, int dir, char *bf, size_t size)\n{\n#include \"trace/beauty/generated/ioctl/drm_ioctl_array.c\"\n\tstatic DEFINE_STRARRAY(drm_ioctl_cmds, \"\");\n\n\tif (nr < strarray__drm_ioctl_cmds.nr_entries && strarray__drm_ioctl_cmds.entries[nr] != NULL)\n\t\treturn scnprintf(bf, size, \"DRM_%s\", strarray__drm_ioctl_cmds.entries[nr]);\n\n\treturn scnprintf(bf, size, \"(%#x, %#x, %#x)\", 'd', nr, dir);\n}\n\nstatic size_t ioctl__scnprintf_sndrv_pcm_cmd(int nr, int dir, char *bf, size_t size)\n{\n#include \"trace/beauty/generated/ioctl/sndrv_pcm_ioctl_array.c\"\n\tstatic DEFINE_STRARRAY(sndrv_pcm_ioctl_cmds, \"\");\n\n\tif (nr < strarray__sndrv_pcm_ioctl_cmds.nr_entries && strarray__sndrv_pcm_ioctl_cmds.entries[nr] != NULL)\n\t\treturn scnprintf(bf, size, \"SNDRV_PCM_%s\", strarray__sndrv_pcm_ioctl_cmds.entries[nr]);\n\n\treturn scnprintf(bf, size, \"(%#x, %#x, %#x)\", 'A', nr, dir);\n}\n\nstatic size_t ioctl__scnprintf_sndrv_ctl_cmd(int nr, int dir, char *bf, size_t size)\n{\n#include \"trace/beauty/generated/ioctl/sndrv_ctl_ioctl_array.c\"\n\tstatic DEFINE_STRARRAY(sndrv_ctl_ioctl_cmds, \"\");\n\n\tif (nr < strarray__sndrv_ctl_ioctl_cmds.nr_entries && strarray__sndrv_ctl_ioctl_cmds.entries[nr] != NULL)\n\t\treturn scnprintf(bf, size, \"SNDRV_CTL_%s\", strarray__sndrv_ctl_ioctl_cmds.entries[nr]);\n\n\treturn scnprintf(bf, size, \"(%#x, %#x, %#x)\", 'U', nr, dir);\n}\n\nstatic size_t ioctl__scnprintf_kvm_cmd(int nr, int dir, char *bf, size_t size)\n{\n#include \"trace/beauty/generated/ioctl/kvm_ioctl_array.c\"\n\tstatic DEFINE_STRARRAY(kvm_ioctl_cmds, \"\");\n\n\tif (nr < strarray__kvm_ioctl_cmds.nr_entries && strarray__kvm_ioctl_cmds.entries[nr] != NULL)\n\t\treturn scnprintf(bf, size, \"KVM_%s\", strarray__kvm_ioctl_cmds.entries[nr]);\n\n\treturn scnprintf(bf, size, \"(%#x, %#x, %#x)\", 0xAE, nr, dir);\n}\n\nstatic size_t ioctl__scnprintf_vhost_virtio_cmd(int nr, int dir, char *bf, size_t size)\n{\n#include \"trace/beauty/generated/ioctl/vhost_virtio_ioctl_array.c\"\n\tstatic DEFINE_STRARRAY(vhost_virtio_ioctl_cmds, \"\");\n\tstatic DEFINE_STRARRAY(vhost_virtio_ioctl_read_cmds, \"\");\n\tstruct strarray *s = (dir & _IOC_READ) ? &strarray__vhost_virtio_ioctl_read_cmds : &strarray__vhost_virtio_ioctl_cmds;\n\n\tif (nr < s->nr_entries && s->entries[nr] != NULL)\n\t\treturn scnprintf(bf, size, \"VHOST_%s\", s->entries[nr]);\n\n\treturn scnprintf(bf, size, \"(%#x, %#x, %#x)\", 0xAF, nr, dir);\n}\n\nstatic size_t ioctl__scnprintf_perf_cmd(int nr, int dir, char *bf, size_t size)\n{\n#include \"trace/beauty/generated/ioctl/perf_ioctl_array.c\"\n\tstatic DEFINE_STRARRAY(perf_ioctl_cmds, \"\");\n\n\tif (nr < strarray__perf_ioctl_cmds.nr_entries && strarray__perf_ioctl_cmds.entries[nr] != NULL)\n\t\treturn scnprintf(bf, size, \"PERF_%s\", strarray__perf_ioctl_cmds.entries[nr]);\n\n\treturn scnprintf(bf, size, \"(%#x, %#x, %#x)\", 0xAE, nr, dir);\n}\n\nstatic size_t ioctl__scnprintf_usbdevfs_cmd(int nr, int dir, char *bf, size_t size)\n{\n#include \"trace/beauty/generated/ioctl/usbdevfs_ioctl_array.c\"\n\tstatic DEFINE_STRARRAY(usbdevfs_ioctl_cmds, \"\");\n\n\tif (nr < strarray__usbdevfs_ioctl_cmds.nr_entries && strarray__usbdevfs_ioctl_cmds.entries[nr] != NULL)\n\t\treturn scnprintf(bf, size, \"USBDEVFS_%s\", strarray__usbdevfs_ioctl_cmds.entries[nr]);\n\n\treturn scnprintf(bf, size, \"(%c, %#x, %#x)\", 'U', nr, dir);\n}\n\nstatic size_t ioctl__scnprintf_cmd(unsigned long cmd, char *bf, size_t size, bool show_prefix)\n{\n\tconst char *prefix = \"_IOC_\";\n\tint dir\t = _IOC_DIR(cmd),\n\t    type = _IOC_TYPE(cmd),\n\t    nr\t = _IOC_NR(cmd),\n\t    sz\t = _IOC_SIZE(cmd);\n\tint printed = 0;\n\tstatic const struct ioctl_type {\n\t\tint\ttype;\n\t\tsize_t\t(*scnprintf)(int nr, int dir, char *bf, size_t size);\n\t} ioctl_types[] = {  \n\t\t\t      { .type\t= '$', .scnprintf = ioctl__scnprintf_perf_cmd, },\n\t\t['A' - '$'] = { .type\t= 'A', .scnprintf = ioctl__scnprintf_sndrv_pcm_cmd, },\n\t\t['T' - '$'] = { .type\t= 'T', .scnprintf = ioctl__scnprintf_tty_cmd, },\n\t\t['U' - '$'] = { .type\t= 'U', .scnprintf = ioctl__scnprintf_sndrv_ctl_cmd, },\n\t\t['d' - '$'] = { .type\t= 'd', .scnprintf = ioctl__scnprintf_drm_cmd, },\n\t\t[0xAE - '$'] = { .type\t= 0xAE, .scnprintf = ioctl__scnprintf_kvm_cmd, },\n\t\t[0xAF - '$'] = { .type\t= 0xAF, .scnprintf = ioctl__scnprintf_vhost_virtio_cmd, },\n\t};\n\tconst int nr_types = ARRAY_SIZE(ioctl_types);\n\n\tif (type >= ioctl_types[0].type && type <= ioctl_types[nr_types - 1].type) {\n\t\tconst int index = type - ioctl_types[0].type;\n\n\t\tif (ioctl_types[index].scnprintf != NULL)\n\t\t\treturn ioctl_types[index].scnprintf(nr, dir, bf, size);\n\t}\n\n\tprinted += scnprintf(bf + printed, size - printed, \"%c\", '(');\n\n\tif (dir == _IOC_NONE) {\n\t\tprinted += scnprintf(bf + printed, size - printed, \"%s%s\", show_prefix ? prefix : \"\", \"NONE\");\n\t} else {\n\t\tif (dir & _IOC_READ)\n\t\t\tprinted += scnprintf(bf + printed, size - printed, \"%s%s\", show_prefix ? prefix : \"\", \"READ\");\n\t\tif (dir & _IOC_WRITE) {\n\t\t\tprinted += scnprintf(bf + printed, size - printed, \"%s%s%s\", dir & _IOC_READ ? \"|\" : \"\",\n\t\t\t\t\t     show_prefix ? prefix : \"\",  \"WRITE\");\n\t\t}\n\t}\n\n\treturn printed + scnprintf(bf + printed, size - printed, \", %#x, %#x, %#x)\", type, nr, sz);\n}\n\n#ifndef USB_DEVICE_MAJOR\n#define USB_DEVICE_MAJOR 189\n#endif \n\nsize_t syscall_arg__scnprintf_ioctl_cmd(char *bf, size_t size, struct syscall_arg *arg)\n{\n\tunsigned long cmd = arg->val;\n\tint fd = syscall_arg__val(arg, 0);\n\tstruct file *file = thread__files_entry(arg->thread, fd);\n\n\tif (file != NULL) {\n\t\tif (file->dev_maj == USB_DEVICE_MAJOR)\n\t\t\treturn ioctl__scnprintf_usbdevfs_cmd(_IOC_NR(cmd), _IOC_DIR(cmd), bf, size);\n\t}\n\n\treturn ioctl__scnprintf_cmd(cmd, bf, size, arg->show_string_prefix);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}