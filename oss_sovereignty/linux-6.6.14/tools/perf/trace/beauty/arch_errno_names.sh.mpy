{
  "module_name": "arch_errno_names.sh",
  "hash_id": "1bd606abf391a8365219b16166fb60eb619cd065da06d8713bf2943a8a54693a",
  "original_prompt": "Ingested from linux-6.6.14/tools/perf/trace/beauty/arch_errno_names.sh",
  "human_readable_source": "#!/bin/sh\n# SPDX-License-Identifier: GPL-2.0\n#\n# Generate C file mapping errno codes to errno names.\n#\n# Copyright IBM Corp. 2018\n# Author(s):  Hendrik Brueckner <brueckner@linux.vnet.ibm.com>\n\ngcc=\"$1\"\ntoolsdir=\"$2\"\ninclude_path=\"-I$toolsdir/include/uapi\"\n\narch_string()\n{\n\techo \"$1\" |sed -e 'y/- /__/' |tr '[[:upper:]]' '[[:lower:]]'\n}\n\nasm_errno_file()\n{\n\tarch=\"$1\"\n\n\theader=\"$toolsdir/arch/$arch/include/uapi/asm/errno.h\"\n\tif test -r \"$header\"; then\n\t\techo \"$header\"\n\telse\n\t\techo \"$toolsdir/include/uapi/asm-generic/errno.h\"\n\tfi\n}\n\ncreate_errno_lookup_func()\n{\n\tarch=$(arch_string \"$1\")\n\n\tprintf \"static const char *errno_to_name__%s(int err)\\n{\\n\\tswitch (err) {\\n\" $arch\n\n\twhile read name nr; do\n\t\tprintf '\\tcase %d: return \"%s\";\\n' $nr $name\n\tdone\n\n\tprintf '\\tdefault: return \"(unknown)\";\\n\\t}\\n}\\n'\n}\n\nprocess_arch()\n{\n\tarch=\"$1\"\n\tasm_errno=$(asm_errno_file \"$arch\")\n\n\t$gcc $CFLAGS $include_path -E -dM -x c $asm_errno \\\n\t\t|grep -hE '^#define[[:blank:]]+(E[^[:blank:]]+)[[:blank:]]+([[:digit:]]+).*' \\\n\t\t|awk '{ print $2\",\"$3; }' \\\n\t\t|sort -t, -k2 -nu \\\n\t\t|IFS=, create_errno_lookup_func \"$arch\"\n}\n\ncreate_arch_errno_table_func()\n{\n\tarchlist=\"$1\"\n\tdefault=\"$2\"\n\n\tprintf 'const char *arch_syscalls__strerrno(const char *arch, int err)\\n'\n\tprintf '{\\n'\n\tfor arch in $archlist; do\n\t\tprintf '\\tif (!strcmp(arch, \"%s\"))\\n' $(arch_string \"$arch\")\n\t\tprintf '\\t\\treturn errno_to_name__%s(err);\\n' $(arch_string \"$arch\")\n\tdone\n\tprintf '\\treturn errno_to_name__%s(err);\\n' $(arch_string \"$default\")\n\tprintf '}\\n'\n}\n\ncat <<EoHEADER\n/* SPDX-License-Identifier: GPL-2.0 */\n\n#include <string.h>\n\nEoHEADER\n\n# Create list of architectures that have a specific errno.h.\narchlist=\"\"\nfor arch in $(find $toolsdir/arch -maxdepth 1 -mindepth 1 -type d -printf \"%f\\n\" | sort -r); do\n\ttest -f $toolsdir/arch/$arch/include/uapi/asm/errno.h && archlist=\"$archlist $arch\"\ndone\n\nfor arch in generic $archlist; do\n\tprocess_arch \"$arch\"\ndone\ncreate_arch_errno_table_func \"$archlist\" \"generic\"\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}