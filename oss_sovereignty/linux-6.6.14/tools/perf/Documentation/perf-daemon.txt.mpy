{
  "module_name": "perf-daemon.txt",
  "hash_id": "98604ab7e18b914f02f8f7fe355ba1cf50a53e220c34a0c1928b9a3ef9e53819",
  "original_prompt": "Ingested from linux-6.6.14/tools/perf/Documentation/perf-daemon.txt",
  "human_readable_source": "perf-daemon(1)\n==============\n\n\nNAME\n----\nperf-daemon - Run record sessions on background\n\n\nSYNOPSIS\n--------\n[verse]\n'perf daemon'\n'perf daemon' [<options>]\n'perf daemon start'  [<options>]\n'perf daemon stop'   [<options>]\n'perf daemon signal' [<options>]\n'perf daemon ping'   [<options>]\n\n\nDESCRIPTION\n-----------\nThis command allows to run simple daemon process that starts and\nmonitors configured record sessions.\n\nYou can imagine 'perf daemon' of background process with several\n'perf record' child tasks, like:\n\n  # ps axjf\n  ...\n       1  916507 ... perf daemon start\n  916507  916508 ...  \\_ perf record --control=fifo:control,ack -m 10M -e cycles --overwrite --switch-output -a\n  916507  916509 ...  \\_ perf record --control=fifo:control,ack -m 20M -e sched:* --overwrite --switch-output -a\n\nNot every 'perf record' session is suitable for running under daemon.\nUser need perf session that either produces data on query, like the\nflight recorder sessions in above example or session that is configured\nto produce data periodically, like with --switch-output configuration\nfor time and size.\n\nEach session is started with control setup (with perf record --control\noptions).\n\nSessions are configured through config file, see CONFIG FILE section\nwith EXAMPLES.\n\n\nOPTIONS\n-------\n-v::\n--verbose::\n\tBe more verbose.\n\n--config=<PATH>::\n\tConfig file path. If not provided, perf will check system and default\n\tlocations (/etc/perfconfig, $HOME/.perfconfig).\n\n--base=<PATH>::\n\tBase directory path. Each daemon instance is running on top\n\tof base directory. Only one instance of server can run on\n\ttop of one directory at the time.\n\nAll generic options are available also under commands.\n\n\nSTART COMMAND\n-------------\nThe start command creates the daemon process.\n\n-f::\n--foreground::\n\tDo not put the process in background.\n\n\nSTOP COMMAND\n------------\nThe stop command stops all the session and the daemon process.\n\n\nSIGNAL COMMAND\n--------------\nThe signal command sends signal to configured sessions.\n\n--session::\n\tSend signal to specific session.\n\n\nPING COMMAND\n------------\nThe ping command sends control ping to configured sessions.\n\n--session::\n\tSend ping to specific session.\n\n\nCONFIG FILE\n-----------\nThe daemon is configured within standard perf config file by\nfollowing new variables:\n\ndaemon.base:\n\tBase path for daemon data. All sessions data are\n\tstored under this path.\n\nsession-<NAME>.run:\n\tDefines new record session. The value is record's command\n\tline without the 'record' keyword.\n\nEach perf record session is run in daemon.base/<NAME> directory.\n\n\nEXAMPLES\n--------\nExample with 2 record sessions:\n\n  # cat ~/.perfconfig\n  [daemon]\n  base=/opt/perfdata\n\n  [session-cycles]\n  run = -m 10M -e cycles --overwrite --switch-output -a\n\n  [session-sched]\n  run = -m 20M -e sched:* --overwrite --switch-output -a\n\n\nStarting the daemon:\n\n  # perf daemon start\n\n\nCheck sessions:\n\n  # perf daemon\n  [603349:daemon] base: /opt/perfdata\n  [603350:cycles] perf record -m 10M -e cycles --overwrite --switch-output -a\n  [603351:sched] perf record -m 20M -e sched:* --overwrite --switch-output -a\n\nFirst line is daemon process info with configured daemon base.\n\n\nCheck sessions with more info:\n\n  # perf daemon -v\n  [603349:daemon] base: /opt/perfdata\n    output:  /opt/perfdata/output\n    lock:    /opt/perfdata/lock\n    up:      1 minutes\n  [603350:cycles] perf record -m 10M -e cycles --overwrite --switch-output -a\n    base:    /opt/perfdata/session-cycles\n    output:  /opt/perfdata/session-cycles/output\n    control: /opt/perfdata/session-cycles/control\n    ack:     /opt/perfdata/session-cycles/ack\n    up:      1 minutes\n  [603351:sched] perf record -m 20M -e sched:* --overwrite --switch-output -a\n    base:    /opt/perfdata/session-sched\n    output:  /opt/perfdata/session-sched/output\n    control: /opt/perfdata/session-sched/control\n    ack:     /opt/perfdata/session-sched/ack\n    up:      1 minutes\n\nThe 'base' path is daemon/session base.\nThe 'lock' file is daemon's lock file guarding that no other\ndaemon is running on top of the base.\nThe 'output' file is perf record output for specific session.\nThe 'control' and 'ack' files are perf control files.\nThe 'up' number shows minutes daemon/session is running.\n\n\nMake sure control session is online:\n\n  # perf daemon ping\n  OK   cycles\n  OK   sched\n\n\nSend USR2 signal to session 'cycles' to generate perf.data file:\n\n  # perf daemon signal --session cycles\n  signal 12 sent to session 'cycles [603452]'\n\n  # tail -2  /opt/perfdata/session-cycles/output\n  [ perf record: dump data: Woken up 1 times ]\n  [ perf record: Dump perf.data.2020123017013149 ]\n\n\nSend USR2 signal to all sessions:\n\n  # perf daemon signal\n  signal 12 sent to session 'cycles [603452]'\n  signal 12 sent to session 'sched [603453]'\n\n  # tail -2  /opt/perfdata/session-cycles/output\n  [ perf record: dump data: Woken up 1 times ]\n  [ perf record: Dump perf.data.2020123017024689 ]\n  # tail -2  /opt/perfdata/session-sched/output\n  [ perf record: dump data: Woken up 1 times ]\n  [ perf record: Dump perf.data.2020123017024713 ]\n\n\nStop daemon:\n\n  # perf daemon stop\n\n\nSEE ALSO\n--------\nlinkperf:perf-record[1], linkperf:perf-config[1]\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}