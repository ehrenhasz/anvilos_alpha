{
  "module_name": "android.txt",
  "hash_id": "5345a56088a200af37fd130530954ffbeeeae89e540e81cbb07a9854702c99ec",
  "original_prompt": "Ingested from linux-6.6.14/tools/perf/Documentation/android.txt",
  "human_readable_source": "How to compile perf for Android\n=========================================\n\nI. Set the Android NDK environment\n------------------------------------------------\n\n(a). Use the Android NDK\n------------------------------------------------\n1. You need to download and install the Android Native Development Kit (NDK).\nSet the NDK variable to point to the path where you installed the NDK:\n  export NDK=/path/to/android-ndk\n\n2. Set cross-compiling environment variables for NDK toolchain and sysroot.\nFor arm:\n  export NDK_TOOLCHAIN=${NDK}/toolchains/arm-linux-androideabi-4.9/prebuilt/linux-x86_64/bin/arm-linux-androideabi-\n  export NDK_SYSROOT=${NDK}/platforms/android-24/arch-arm\nFor x86:\n  export NDK_TOOLCHAIN=${NDK}/toolchains/x86-4.9/prebuilt/linux-x86_64/bin/i686-linux-android-\n  export NDK_SYSROOT=${NDK}/platforms/android-24/arch-x86\n\nThis method is only tested for Android NDK versions Revision 11b and later.\nperf uses some bionic enhancements that are not included in prior NDK versions.\nYou can use method (b) described below instead.\n\n(b). Use the Android source tree\n-----------------------------------------------\n1. Download the master branch of the Android source tree.\nSet the environment for the target you want using:\n  source build/envsetup.sh\n  lunch\n\n2. Build your own NDK sysroot to contain latest bionic changes and set the\nNDK sysroot environment variable.\n  cd ${ANDROID_BUILD_TOP}/ndk\nFor arm:\n  ./build/tools/build-ndk-sysroot.sh --abi=arm\n  export NDK_SYSROOT=${ANDROID_BUILD_TOP}/ndk/build/platforms/android-3/arch-arm\nFor x86:\n  ./build/tools/build-ndk-sysroot.sh --abi=x86\n  export NDK_SYSROOT=${ANDROID_BUILD_TOP}/ndk/build/platforms/android-3/arch-x86\n\n3. Set the NDK toolchain environment variable.\nFor arm:\n  export NDK_TOOLCHAIN=${ANDROID_TOOLCHAIN}/arm-linux-androideabi-\nFor x86:\n  export NDK_TOOLCHAIN=${ANDROID_TOOLCHAIN}/i686-linux-android-\n\nII. Compile perf for Android\n------------------------------------------------\nYou need to run make with the NDK toolchain and sysroot defined above:\nFor arm:\n  make WERROR=0 ARCH=arm CROSS_COMPILE=${NDK_TOOLCHAIN} EXTRA_CFLAGS=\"-pie --sysroot=${NDK_SYSROOT}\"\nFor x86:\n  make WERROR=0 ARCH=x86 CROSS_COMPILE=${NDK_TOOLCHAIN} EXTRA_CFLAGS=\"-pie --sysroot=${NDK_SYSROOT}\"\n\nIII. Install perf\n-----------------------------------------------\nYou need to connect to your Android device/emulator using adb.\nInstall perf using:\n  adb push perf /data/perf\n\nIf you also want to use perf-archive you need busybox tools for Android.\nFor installing perf-archive, you first need to replace #!/bin/bash with #!/system/bin/sh:\n  sed 's/#!\\/bin\\/bash/#!\\/system\\/bin\\/sh/g' perf-archive >> /tmp/perf-archive\n  chmod +x /tmp/perf-archive\n  adb push /tmp/perf-archive /data/perf-archive\n\nIV. Environment settings for running perf\n------------------------------------------------\nSome perf features need environment variables to run properly.\nYou need to set these before running perf on the target:\n  adb shell\n  # PERF_PAGER=cat\n\nIV. Run perf\n------------------------------------------------\nRun perf on your device/emulator to which you previously connected using adb:\n  # ./data/perf\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}