{
  "module_name": "perf-script-perl.txt",
  "hash_id": "90f054466a3329c37f6084e9bbe1d77116acf7461f982ec2c7d83aca70c2926d",
  "original_prompt": "Ingested from linux-6.6.14/tools/perf/Documentation/perf-script-perl.txt",
  "human_readable_source": "perf-script-perl(1)\n===================\n\nNAME\n----\nperf-script-perl - Process trace data with a Perl script\n\nSYNOPSIS\n--------\n[verse]\n'perf script' [-s [Perl]:script[.pl] ]\n\nDESCRIPTION\n-----------\n\nThis perf script option is used to process perf script data using perf's\nbuilt-in Perl interpreter.  It reads and processes the input file and\ndisplays the results of the trace analysis implemented in the given\nPerl script, if any.\n\nSTARTER SCRIPTS\n---------------\n\nYou can avoid reading the rest of this document by running 'perf script\n-g perl' in the same directory as an existing perf.data trace file.\nThat will generate a starter script containing a handler for each of\nthe event types in the trace file; it simply prints every available\nfield for each event in the trace file.\n\nYou can also look at the existing scripts in\n~/libexec/perf-core/scripts/perl for typical examples showing how to\ndo basic things like aggregate event data, print results, etc.  Also,\nthe check-perf-script.pl script, while not interesting for its results,\nattempts to exercise all of the main scripting features.\n\nEVENT HANDLERS\n--------------\n\nWhen perf script is invoked using a trace script, a user-defined\n'handler function' is called for each event in the trace.  If there's\nno handler function defined for a given event type, the event is\nignored (or passed to a 'trace_unhandled' function, see below) and the\nnext event is processed.\n\nMost of the event's field values are passed as arguments to the\nhandler function; some of the less common ones aren't - those are\navailable as calls back into the perf executable (see below).\n\nAs an example, the following perf record command can be used to record\nall sched_wakeup events in the system:\n\n # perf record -a -e sched:sched_wakeup\n\nTraces meant to be processed using a script should be recorded with\nthe above option: -a to enable system-wide collection.\n\nThe format file for the sched_wakeup event defines the following fields\n(see /sys/kernel/tracing/events/sched/sched_wakeup/format):\n\n----\n format:\n        field:unsigned short common_type;\n        field:unsigned char common_flags;\n        field:unsigned char common_preempt_count;\n        field:int common_pid;\n\n        field:char comm[TASK_COMM_LEN];\n        field:pid_t pid;\n        field:int prio;\n        field:int success;\n        field:int target_cpu;\n----\n\nThe handler function for this event would be defined as:\n\n----\nsub sched::sched_wakeup\n{\n   my ($event_name, $context, $common_cpu, $common_secs,\n       $common_nsecs, $common_pid, $common_comm,\n       $comm, $pid, $prio, $success, $target_cpu) = @_;\n}\n----\n\nThe handler function takes the form subsystem::event_name.\n\nThe $common_* arguments in the handler's argument list are the set of\narguments passed to all event handlers; some of the fields correspond\nto the common_* fields in the format file, but some are synthesized,\nand some of the common_* fields aren't common enough to to be passed\nto every event as arguments but are available as library functions.\n\nHere's a brief description of each of the invariant event args:\n\n $event_name \t  \t    the name of the event as text\n $context\t\t    an opaque 'cookie' used in calls back into perf\n $common_cpu\t\t    the cpu the event occurred on\n $common_secs\t\t    the secs portion of the event timestamp\n $common_nsecs\t\t    the nsecs portion of the event timestamp\n $common_pid\t\t    the pid of the current task\n $common_comm\t\t    the name of the current process\n\nAll of the remaining fields in the event's format file have\ncounterparts as handler function arguments of the same name, as can be\nseen in the example above.\n\nThe above provides the basics needed to directly access every field of\nevery event in a trace, which covers 90% of what you need to know to\nwrite a useful trace script.  The sections below cover the rest.\n\nSCRIPT LAYOUT\n-------------\n\nEvery perf script Perl script should start by setting up a Perl module\nsearch path and 'use'ing a few support modules (see module\ndescriptions below):\n\n----\n use lib \"$ENV{'PERF_EXEC_PATH'}/scripts/perl/Perf-Trace-Util/lib\";\n use lib \"./Perf-Trace-Util/lib\";\n use Perf::Trace::Core;\n use Perf::Trace::Context;\n use Perf::Trace::Util;\n----\n\nThe rest of the script can contain handler functions and support\nfunctions in any order.\n\nAside from the event handler functions discussed above, every script\ncan implement a set of optional functions:\n\n*trace_begin*, if defined, is called before any event is processed and\ngives scripts a chance to do setup tasks:\n\n----\n sub trace_begin\n {\n }\n----\n\n*trace_end*, if defined, is called after all events have been\n processed and gives scripts a chance to do end-of-script tasks, such\n as display results:\n\n----\nsub trace_end\n{\n}\n----\n\n*trace_unhandled*, if defined, is called after for any event that\n doesn't have a handler explicitly defined for it.  The standard set\n of common arguments are passed into it:\n\n----\nsub trace_unhandled\n{\n    my ($event_name, $context, $common_cpu, $common_secs,\n        $common_nsecs, $common_pid, $common_comm) = @_;\n}\n----\n\nThe remaining sections provide descriptions of each of the available\nbuilt-in perf script Perl modules and their associated functions.\n\nAVAILABLE MODULES AND FUNCTIONS\n-------------------------------\n\nThe following sections describe the functions and variables available\nvia the various Perf::Trace::* Perl modules.  To use the functions and\nvariables from the given module, add the corresponding 'use\nPerf::Trace::XXX' line to your perf script script.\n\nPerf::Trace::Core Module\n~~~~~~~~~~~~~~~~~~~~~~~~\n\nThese functions provide some essential functions to user scripts.\n\nThe *flag_str* and *symbol_str* functions provide human-readable\nstrings for flag and symbolic fields.  These correspond to the strings\nand values parsed from the 'print fmt' fields of the event format\nfiles:\n\n  flag_str($event_name, $field_name, $field_value) - returns the string representation corresponding to $field_value for the flag field $field_name of event $event_name\n  symbol_str($event_name, $field_name, $field_value) - returns the string representation corresponding to $field_value for the symbolic field $field_name of event $event_name\n\nPerf::Trace::Context Module\n~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\nSome of the 'common' fields in the event format file aren't all that\ncommon, but need to be made accessible to user scripts nonetheless.\n\nPerf::Trace::Context defines a set of functions that can be used to\naccess this data in the context of the current event.  Each of these\nfunctions expects a $context variable, which is the same as the\n$context variable passed into every event handler as the second\nargument.\n\n common_pc($context) - returns common_preempt count for the current event\n common_flags($context) - returns common_flags for the current event\n common_lock_depth($context) - returns common_lock_depth for the current event\n\nPerf::Trace::Util Module\n~~~~~~~~~~~~~~~~~~~~~~~~\n\nVarious utility functions for use with perf script:\n\n  nsecs($secs, $nsecs) - returns total nsecs given secs/nsecs pair\n  nsecs_secs($nsecs) - returns whole secs portion given nsecs\n  nsecs_nsecs($nsecs) - returns nsecs remainder given nsecs\n  nsecs_str($nsecs) - returns printable string in the form secs.nsecs\n  avg($total, $n) - returns average given a sum and a total number of values\n\nSEE ALSO\n--------\nlinkperf:perf-script[1]\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}