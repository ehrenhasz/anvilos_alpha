{
  "module_name": "perf-c2c.txt",
  "hash_id": "ccb85a26576eefa727c19b24387abdc5cef3244b0452e62d5c5d14a5c230ec6b",
  "original_prompt": "Ingested from linux-6.6.14/tools/perf/Documentation/perf-c2c.txt",
  "human_readable_source": "perf-c2c(1)\n===========\n\nNAME\n----\nperf-c2c - Shared Data C2C/HITM Analyzer.\n\nSYNOPSIS\n--------\n[verse]\n'perf c2c record' [<options>] <command>\n'perf c2c record' [<options>] \\-- [<record command options>] <command>\n'perf c2c report' [<options>]\n\nDESCRIPTION\n-----------\nC2C stands for Cache To Cache.\n\nThe perf c2c tool provides means for Shared Data C2C/HITM analysis. It allows\nyou to track down the cacheline contentions.\n\nOn Intel, the tool is based on load latency and precise store facility events\nprovided by Intel CPUs. On PowerPC, the tool uses random instruction sampling\nwith thresholding feature. On AMD, the tool uses IBS op pmu (due to hardware\nlimitations, perf c2c is not supported on Zen3 cpus). On Arm64 it uses SPE to\nsample load and store operations, therefore hardware and kernel support is\nrequired. See linkperf:perf-arm-spe[1] for a setup guide. Due to the\nstatistical nature of Arm SPE sampling, not every memory operation will be\nsampled.\n\nThese events provide:\n  - memory address of the access\n  - type of the access (load and store details)\n  - latency (in cycles) of the load access\n\nThe c2c tool provide means to record this data and report back access details\nfor cachelines with highest contention - highest number of HITM accesses.\n\nThe basic workflow with this tool follows the standard record/report phase.\nUser uses the record command to record events data and report command to\ndisplay it.\n\n\nRECORD OPTIONS\n--------------\n-e::\n--event=::\n\tSelect the PMU event. Use 'perf c2c record -e list'\n\tto list available events.\n\n-v::\n--verbose::\n\tBe more verbose (show counter open errors, etc).\n\n-l::\n--ldlat::\n\tConfigure mem-loads latency. Supported on Intel and Arm64 processors\n\tonly. Ignored on other archs.\n\n-k::\n--all-kernel::\n\tConfigure all used events to run in kernel space.\n\n-u::\n--all-user::\n\tConfigure all used events to run in user space.\n\nREPORT OPTIONS\n--------------\n-k::\n--vmlinux=<file>::\n\tvmlinux pathname\n\n-v::\n--verbose::\n\tBe more verbose (show counter open errors, etc).\n\n-i::\n--input::\n\tSpecify the input file to process.\n\n-N::\n--node-info::\n\tShow extra node info in report (see NODE INFO section)\n\n-c::\n--coalesce::\n\tSpecify sorting fields for single cacheline display.\n\tFollowing fields are available: tid,pid,iaddr,dso\n\t(see COALESCE)\n\n-g::\n--call-graph::\n\tSetup callchains parameters.\n\tPlease refer to perf-report man page for details.\n\n--stdio::\n\tForce the stdio output (see STDIO OUTPUT)\n\n--stats::\n\tDisplay only statistic tables and force stdio mode.\n\n--full-symbols::\n\tDisplay full length of symbols.\n\n--no-source::\n\tDo not display Source:Line column.\n\n--show-all::\n\tShow all captured HITM lines, with no regard to HITM % 0.0005 limit.\n\n-f::\n--force::\n\tDon't do ownership validation.\n\n-d::\n--display::\n\tSwitch to HITM type (rmt, lcl) or peer snooping type (peer) to display\n\tand sort on. Total HITMs (tot) as default, except Arm64 uses peer mode\n\tas default.\n\n--stitch-lbr::\n\tShow callgraph with stitched LBRs, which may have more complete\n\tcallgraph. The perf.data file must have been obtained using\n\tperf c2c record --call-graph lbr.\n\tDisabled by default. In common cases with call stack overflows,\n\tit can recreate better call stacks than the default lbr call stack\n\toutput. But this approach is not foolproof. There can be cases\n\twhere it creates incorrect call stacks from incorrect matches.\n\tThe known limitations include exception handing such as\n\tsetjmp/longjmp will have calls/returns not match.\n\n--double-cl::\n\tGroup the detection of shared cacheline events into double cacheline\n\tgranularity. Some architectures have an Adjacent Cacheline Prefetch\n\tfeature, which causes cacheline sharing to behave like the cacheline\n\tsize is doubled.\n\nC2C RECORD\n----------\nThe perf c2c record command setup options related to HITM cacheline analysis\nand calls standard perf record command.\n\nFollowing perf record options are configured by default:\n(check perf record man page for details)\n\n  -W,-d,--phys-data,--sample-cpu\n\nUnless specified otherwise with '-e' option, following events are monitored by\ndefault on Intel:\n\n  cpu/mem-loads,ldlat=30/P\n  cpu/mem-stores/P\n\nfollowing on AMD:\n\n  ibs_op//\n\nand following on PowerPC:\n\n  cpu/mem-loads/\n  cpu/mem-stores/\n\nUser can pass any 'perf record' option behind '--' mark, like (to enable\ncallchains and system wide monitoring):\n\n  $ perf c2c record -- -g -a\n\nPlease check RECORD OPTIONS section for specific c2c record options.\n\nC2C REPORT\n----------\nThe perf c2c report command displays shared data analysis.  It comes in two\ndisplay modes: stdio and tui (default).\n\nThe report command workflow is following:\n  - sort all the data based on the cacheline address\n  - store access details for each cacheline\n  - sort all cachelines based on user settings\n  - display data\n\nIn general perf report output consist of 2 basic views:\n  1) most expensive cachelines list\n  2) offsets details for each cacheline\n\nFor each cacheline in the 1) list we display following data:\n(Both stdio and TUI modes follow the same fields output)\n\n  Index\n  - zero based index to identify the cacheline\n\n  Cacheline\n  - cacheline address (hex number)\n\n  Rmt/Lcl Hitm (Display with HITM types)\n  - cacheline percentage of all Remote/Local HITM accesses\n\n  Peer Snoop (Display with peer type)\n  - cacheline percentage of all peer accesses\n\n  LLC Load Hitm - Total, LclHitm, RmtHitm (For display with HITM types)\n  - count of Total/Local/Remote load HITMs\n\n  Load Peer - Total, Local, Remote (For display with peer type)\n  - count of Total/Local/Remote load from peer cache or DRAM\n\n  Total records\n  - sum of all cachelines accesses\n\n  Total loads\n  - sum of all load accesses\n\n  Total stores\n  - sum of all store accesses\n\n  Store Reference - L1Hit, L1Miss, N/A\n    L1Hit - store accesses that hit L1\n    L1Miss - store accesses that missed L1\n    N/A - store accesses with memory level is not available\n\n  Core Load Hit - FB, L1, L2\n  - count of load hits in FB (Fill Buffer), L1 and L2 cache\n\n  LLC Load Hit - LlcHit, LclHitm\n  - count of LLC load accesses, includes LLC hits and LLC HITMs\n\n  RMT Load Hit - RmtHit, RmtHitm\n  - count of remote load accesses, includes remote hits and remote HITMs;\n    on Arm neoverse cores, RmtHit is used to account remote accesses,\n    includes remote DRAM or any upward cache level in remote node\n\n  Load Dram - Lcl, Rmt\n  - count of local and remote DRAM accesses\n\nFor each offset in the 2) list we display following data:\n\n  HITM - Rmt, Lcl (Display with HITM types)\n  - % of Remote/Local HITM accesses for given offset within cacheline\n\n  Peer Snoop - Rmt, Lcl (Display with peer type)\n  - % of Remote/Local peer accesses for given offset within cacheline\n\n  Store Refs - L1 Hit, L1 Miss, N/A\n  - % of store accesses that hit L1, missed L1 and N/A (no available) memory\n    level for given offset within cacheline\n\n  Data address - Offset\n  - offset address\n\n  Pid\n  - pid of the process responsible for the accesses\n\n  Tid\n  - tid of the process responsible for the accesses\n\n  Code address\n  - code address responsible for the accesses\n\n  cycles - rmt hitm, lcl hitm, load (Display with HITM types)\n    - sum of cycles for given accesses - Remote/Local HITM and generic load\n\n  cycles - rmt peer, lcl peer, load (Display with peer type)\n    - sum of cycles for given accesses - Remote/Local peer load and generic load\n\n  cpu cnt\n    - number of cpus that participated on the access\n\n  Symbol\n    - code symbol related to the 'Code address' value\n\n  Shared Object\n    - shared object name related to the 'Code address' value\n\n  Source:Line\n    - source information related to the 'Code address' value\n\n  Node\n    - nodes participating on the access (see NODE INFO section)\n\nNODE INFO\n---------\nThe 'Node' field displays nodes that accesses given cacheline\noffset. Its output comes in 3 flavors:\n  - node IDs separated by ','\n  - node IDs with stats for each ID, in following format:\n      Node{cpus %hitms %stores} (Display with HITM types)\n      Node{cpus %peers %stores} (Display with peer type)\n  - node IDs with list of affected CPUs in following format:\n      Node{cpu list}\n\nUser can switch between above flavors with -N option or\nuse 'n' key to interactively switch in TUI mode.\n\nCOALESCE\n--------\nUser can specify how to sort offsets for cacheline.\n\nFollowing fields are available and governs the final\noutput fields set for cacheline offsets output:\n\n  tid   - coalesced by process TIDs\n  pid   - coalesced by process PIDs\n  iaddr - coalesced by code address, following fields are displayed:\n             Code address, Code symbol, Shared Object, Source line\n  dso   - coalesced by shared object\n\nBy default the coalescing is setup with 'pid,iaddr'.\n\nSTDIO OUTPUT\n------------\nThe stdio output displays data on standard output.\n\nFollowing tables are displayed:\n  Trace Event Information\n  - overall statistics of memory accesses\n\n  Global Shared Cache Line Event Information\n  - overall statistics on shared cachelines\n\n  Shared Data Cache Line Table\n  - list of most expensive cachelines\n\n  Shared Cache Line Distribution Pareto\n  - list of all accessed offsets for each cacheline\n\nTUI OUTPUT\n----------\nThe TUI output provides interactive interface to navigate\nthrough cachelines list and to display offset details.\n\nFor details please refer to the help window by pressing '?' key.\n\nCREDITS\n-------\nAlthough Don Zickus, Dick Fowles and Joe Mario worked together\nto get this implemented, we got lots of early help from Arnaldo\nCarvalho de Melo, Stephane Eranian, Jiri Olsa and Andi Kleen.\n\nC2C BLOG\n--------\nCheck Joe's blog on c2c tool for detailed use case explanation:\n  https://joemario.github.io/blog/2016/09/01/c2c-blog/\n\nSEE ALSO\n--------\nlinkperf:perf-record[1], linkperf:perf-mem[1], linkperf:perf-arm-spe[1]\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}