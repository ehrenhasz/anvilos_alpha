{
  "module_name": "common.c",
  "hash_id": "24660d5313012be9904580fd0cb6aab54376bf2ae320f0072195e1e7f2aa052b",
  "original_prompt": "Ingested from linux-6.6.14/tools/perf/arch/common.c",
  "human_readable_source": "\n#include <limits.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <unistd.h>\n#include \"common.h\"\n#include \"../util/env.h\"\n#include \"../util/debug.h\"\n#include <linux/zalloc.h>\n\nconst char *const arc_triplets[] = {\n\t\"arc-linux-\",\n\t\"arc-snps-linux-uclibc-\",\n\t\"arc-snps-linux-gnu-\",\n\tNULL\n};\n\nconst char *const arm_triplets[] = {\n\t\"arm-eabi-\",\n\t\"arm-linux-androideabi-\",\n\t\"arm-unknown-linux-\",\n\t\"arm-unknown-linux-gnu-\",\n\t\"arm-unknown-linux-gnueabi-\",\n\t\"arm-linux-gnu-\",\n\t\"arm-linux-gnueabihf-\",\n\t\"arm-none-eabi-\",\n\tNULL\n};\n\nconst char *const arm64_triplets[] = {\n\t\"aarch64-linux-android-\",\n\t\"aarch64-linux-gnu-\",\n\tNULL\n};\n\nconst char *const powerpc_triplets[] = {\n\t\"powerpc-unknown-linux-gnu-\",\n\t\"powerpc-linux-gnu-\",\n\t\"powerpc64-unknown-linux-gnu-\",\n\t\"powerpc64-linux-gnu-\",\n\t\"powerpc64le-linux-gnu-\",\n\tNULL\n};\n\nconst char *const riscv32_triplets[] = {\n\t\"riscv32-unknown-linux-gnu-\",\n\t\"riscv32-linux-android-\",\n\t\"riscv32-linux-gnu-\",\n\tNULL\n};\n\nconst char *const riscv64_triplets[] = {\n\t\"riscv64-unknown-linux-gnu-\",\n\t\"riscv64-linux-android-\",\n\t\"riscv64-linux-gnu-\",\n\tNULL\n};\n\nconst char *const s390_triplets[] = {\n\t\"s390-ibm-linux-\",\n\t\"s390x-linux-gnu-\",\n\tNULL\n};\n\nconst char *const sh_triplets[] = {\n\t\"sh-unknown-linux-gnu-\",\n\t\"sh-linux-gnu-\",\n\tNULL\n};\n\nconst char *const sparc_triplets[] = {\n\t\"sparc-unknown-linux-gnu-\",\n\t\"sparc64-unknown-linux-gnu-\",\n\t\"sparc64-linux-gnu-\",\n\tNULL\n};\n\nconst char *const x86_triplets[] = {\n\t\"x86_64-pc-linux-gnu-\",\n\t\"x86_64-unknown-linux-gnu-\",\n\t\"i686-pc-linux-gnu-\",\n\t\"i586-pc-linux-gnu-\",\n\t\"i486-pc-linux-gnu-\",\n\t\"i386-pc-linux-gnu-\",\n\t\"i686-linux-android-\",\n\t\"i686-android-linux-\",\n\t\"x86_64-linux-gnu-\",\n\t\"i586-linux-gnu-\",\n\tNULL\n};\n\nconst char *const mips_triplets[] = {\n\t\"mips-unknown-linux-gnu-\",\n\t\"mipsel-linux-android-\",\n\t\"mips-linux-gnu-\",\n\t\"mips64-linux-gnu-\",\n\t\"mips64el-linux-gnuabi64-\",\n\t\"mips64-linux-gnuabi64-\",\n\t\"mipsel-linux-gnu-\",\n\tNULL\n};\n\nstatic bool lookup_path(char *name)\n{\n\tbool found = false;\n\tchar *path, *tmp = NULL;\n\tchar buf[PATH_MAX];\n\tchar *env = getenv(\"PATH\");\n\n\tif (!env)\n\t\treturn false;\n\n\tenv = strdup(env);\n\tif (!env)\n\t\treturn false;\n\n\tpath = strtok_r(env, \":\", &tmp);\n\twhile (path) {\n\t\tscnprintf(buf, sizeof(buf), \"%s/%s\", path, name);\n\t\tif (access(buf, F_OK) == 0) {\n\t\t\tfound = true;\n\t\t\tbreak;\n\t\t}\n\t\tpath = strtok_r(NULL, \":\", &tmp);\n\t}\n\tfree(env);\n\treturn found;\n}\n\nstatic int lookup_triplets(const char *const *triplets, const char *name)\n{\n\tint i;\n\tchar buf[PATH_MAX];\n\n\tfor (i = 0; triplets[i] != NULL; i++) {\n\t\tscnprintf(buf, sizeof(buf), \"%s%s\", triplets[i], name);\n\t\tif (lookup_path(buf))\n\t\t\treturn i;\n\t}\n\treturn -1;\n}\n\nstatic int perf_env__lookup_binutils_path(struct perf_env *env,\n\t\t\t\t\t  const char *name, char **path)\n{\n\tint idx;\n\tconst char *arch = perf_env__arch(env), *cross_env;\n\tconst char *const *path_list;\n\tchar *buf = NULL;\n\n\t \n\tif (!strcmp(perf_env__arch(NULL), arch))\n\t\tgoto out;\n\n\tcross_env = getenv(\"CROSS_COMPILE\");\n\tif (cross_env) {\n\t\tif (asprintf(&buf, \"%s%s\", cross_env, name) < 0)\n\t\t\tgoto out_error;\n\t\tif (buf[0] == '/') {\n\t\t\tif (access(buf, F_OK) == 0)\n\t\t\t\tgoto out;\n\t\t\tgoto out_error;\n\t\t}\n\t\tif (lookup_path(buf))\n\t\t\tgoto out;\n\t\tzfree(&buf);\n\t}\n\n\tif (!strcmp(arch, \"arc\"))\n\t\tpath_list = arc_triplets;\n\telse if (!strcmp(arch, \"arm\"))\n\t\tpath_list = arm_triplets;\n\telse if (!strcmp(arch, \"arm64\"))\n\t\tpath_list = arm64_triplets;\n\telse if (!strcmp(arch, \"powerpc\"))\n\t\tpath_list = powerpc_triplets;\n\telse if (!strcmp(arch, \"riscv32\"))\n\t\tpath_list = riscv32_triplets;\n\telse if (!strcmp(arch, \"riscv64\"))\n\t\tpath_list = riscv64_triplets;\n\telse if (!strcmp(arch, \"sh\"))\n\t\tpath_list = sh_triplets;\n\telse if (!strcmp(arch, \"s390\"))\n\t\tpath_list = s390_triplets;\n\telse if (!strcmp(arch, \"sparc\"))\n\t\tpath_list = sparc_triplets;\n\telse if (!strcmp(arch, \"x86\"))\n\t\tpath_list = x86_triplets;\n\telse if (!strcmp(arch, \"mips\"))\n\t\tpath_list = mips_triplets;\n\telse {\n\t\tui__error(\"binutils for %s not supported.\\n\", arch);\n\t\tgoto out_error;\n\t}\n\n\tidx = lookup_triplets(path_list, name);\n\tif (idx < 0) {\n\t\tui__error(\"Please install %s for %s.\\n\"\n\t\t\t  \"You can add it to PATH, set CROSS_COMPILE or \"\n\t\t\t  \"override the default using --%s.\\n\",\n\t\t\t  name, arch, name);\n\t\tgoto out_error;\n\t}\n\n\tif (asprintf(&buf, \"%s%s\", path_list[idx], name) < 0)\n\t\tgoto out_error;\n\nout:\n\t*path = buf;\n\treturn 0;\nout_error:\n\tfree(buf);\n\t*path = NULL;\n\treturn -1;\n}\n\nint perf_env__lookup_objdump(struct perf_env *env, char **path)\n{\n\t \n\tif (env->arch == NULL)\n\t\treturn 0;\n\n\treturn perf_env__lookup_binutils_path(env, \"objdump\", path);\n}\n\n \nbool perf_env__single_address_space(struct perf_env *env)\n{\n\treturn strcmp(perf_env__arch(env), \"sparc\");\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}