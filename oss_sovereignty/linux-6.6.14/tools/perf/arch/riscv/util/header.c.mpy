{
  "module_name": "header.c",
  "hash_id": "658d55d3309f599dc4b976df393a53b38260d4d7c875d5f8ee6088566d1a7a2c",
  "original_prompt": "Ingested from linux-6.6.14/tools/perf/arch/riscv/util/header.c",
  "human_readable_source": "\n \n\n#include <stdio.h>\n#include <stdlib.h>\n#include <api/fs/fs.h>\n#include <errno.h>\n#include \"../../util/debug.h\"\n#include \"../../util/header.h\"\n\n#define CPUINFO_MVEN\t\"mvendorid\"\n#define CPUINFO_MARCH\t\"marchid\"\n#define CPUINFO_MIMP\t\"mimpid\"\n#define CPUINFO\t\t\"/proc/cpuinfo\"\n\nstatic char *_get_field(const char *line)\n{\n\tchar *line2, *nl;\n\n\tline2 = strrchr(line, ' ');\n\tif (!line2)\n\t\treturn NULL;\n\n\tline2++;\n\tnl = strrchr(line, '\\n');\n\tif (!nl)\n\t\treturn NULL;\n\n\treturn strndup(line2, nl - line2);\n}\n\nstatic char *_get_cpuid(void)\n{\n\tchar *line = NULL;\n\tchar *mvendorid = NULL;\n\tchar *marchid = NULL;\n\tchar *mimpid = NULL;\n\tchar *cpuid = NULL;\n\tint read;\n\tunsigned long line_sz;\n\tFILE *cpuinfo;\n\n\tcpuinfo = fopen(CPUINFO, \"r\");\n\tif (cpuinfo == NULL)\n\t\treturn cpuid;\n\n\twhile ((read = getline(&line, &line_sz, cpuinfo)) != -1) {\n\t\tif (!strncmp(line, CPUINFO_MVEN, strlen(CPUINFO_MVEN))) {\n\t\t\tmvendorid = _get_field(line);\n\t\t\tif (!mvendorid)\n\t\t\t\tgoto free;\n\t\t} else if (!strncmp(line, CPUINFO_MARCH, strlen(CPUINFO_MARCH))) {\n\t\t\tmarchid = _get_field(line);\n\t\t\tif (!marchid)\n\t\t\t\tgoto free;\n\t\t} else if (!strncmp(line, CPUINFO_MIMP, strlen(CPUINFO_MIMP))) {\n\t\t\tmimpid = _get_field(line);\n\t\t\tif (!mimpid)\n\t\t\t\tgoto free;\n\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tif (!mvendorid || !marchid || !mimpid)\n\t\tgoto free;\n\n\tif (asprintf(&cpuid, \"%s-%s-%s\", mvendorid, marchid, mimpid) < 0)\n\t\tcpuid = NULL;\n\nfree:\n\tfclose(cpuinfo);\n\tfree(mvendorid);\n\tfree(marchid);\n\tfree(mimpid);\n\n\treturn cpuid;\n}\n\nint get_cpuid(char *buffer, size_t sz)\n{\n\tchar *cpuid = _get_cpuid();\n\tint ret = 0;\n\n\tif (sz < strlen(cpuid)) {\n\t\tret = -EINVAL;\n\t\tgoto free;\n\t}\n\n\tscnprintf(buffer, sz, \"%s\", cpuid);\nfree:\n\tfree(cpuid);\n\treturn ret;\n}\n\nchar *\nget_cpuid_str(struct perf_pmu *pmu __maybe_unused)\n{\n\treturn _get_cpuid();\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}