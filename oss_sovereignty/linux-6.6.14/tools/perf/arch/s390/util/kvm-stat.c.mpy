{
  "module_name": "kvm-stat.c",
  "hash_id": "68b459a9a5fa2239f170adbc155bb573561b62cb902a73555f5c906da5174ebf",
  "original_prompt": "Ingested from linux-6.6.14/tools/perf/arch/s390/util/kvm-stat.c",
  "human_readable_source": "\n \n\n#include <errno.h>\n#include <string.h>\n#include \"../../util/kvm-stat.h\"\n#include \"../../util/evsel.h\"\n#include <asm/sie.h>\n\ndefine_exit_reasons_table(sie_exit_reasons, sie_intercept_code);\ndefine_exit_reasons_table(sie_icpt_insn_codes, icpt_insn_codes);\ndefine_exit_reasons_table(sie_sigp_order_codes, sigp_order_codes);\ndefine_exit_reasons_table(sie_diagnose_codes, diagnose_codes);\ndefine_exit_reasons_table(sie_icpt_prog_codes, icpt_prog_codes);\n\nconst char *vcpu_id_str = \"id\";\nconst char *kvm_exit_reason = \"icptcode\";\nconst char *kvm_entry_trace = \"kvm:kvm_s390_sie_enter\";\nconst char *kvm_exit_trace = \"kvm:kvm_s390_sie_exit\";\n\nstatic void event_icpt_insn_get_key(struct evsel *evsel,\n\t\t\t\t    struct perf_sample *sample,\n\t\t\t\t    struct event_key *key)\n{\n\tunsigned long insn;\n\n\tinsn = evsel__intval(evsel, sample, \"instruction\");\n\tkey->key = icpt_insn_decoder(insn);\n\tkey->exit_reasons = sie_icpt_insn_codes;\n}\n\nstatic void event_sigp_get_key(struct evsel *evsel,\n\t\t\t       struct perf_sample *sample,\n\t\t\t       struct event_key *key)\n{\n\tkey->key = evsel__intval(evsel, sample, \"order_code\");\n\tkey->exit_reasons = sie_sigp_order_codes;\n}\n\nstatic void event_diag_get_key(struct evsel *evsel,\n\t\t\t       struct perf_sample *sample,\n\t\t\t       struct event_key *key)\n{\n\tkey->key = evsel__intval(evsel, sample, \"code\");\n\tkey->exit_reasons = sie_diagnose_codes;\n}\n\nstatic void event_icpt_prog_get_key(struct evsel *evsel,\n\t\t\t\t    struct perf_sample *sample,\n\t\t\t\t    struct event_key *key)\n{\n\tkey->key = evsel__intval(evsel, sample, \"code\");\n\tkey->exit_reasons = sie_icpt_prog_codes;\n}\n\nstatic struct child_event_ops child_events[] = {\n\t{ .name = \"kvm:kvm_s390_intercept_instruction\",\n\t  .get_key = event_icpt_insn_get_key },\n\t{ .name = \"kvm:kvm_s390_handle_sigp\",\n\t  .get_key = event_sigp_get_key },\n\t{ .name = \"kvm:kvm_s390_handle_diag\",\n\t  .get_key = event_diag_get_key },\n\t{ .name = \"kvm:kvm_s390_intercept_prog\",\n\t  .get_key = event_icpt_prog_get_key },\n\t{ NULL, NULL },\n};\n\nstatic struct kvm_events_ops exit_events = {\n\t.is_begin_event = exit_event_begin,\n\t.is_end_event = exit_event_end,\n\t.child_ops = child_events,\n\t.decode_key = exit_event_decode_key,\n\t.name = \"VM-EXIT\"\n};\n\nconst char *kvm_events_tp[] = {\n\t\"kvm:kvm_s390_sie_enter\",\n\t\"kvm:kvm_s390_sie_exit\",\n\t\"kvm:kvm_s390_intercept_instruction\",\n\t\"kvm:kvm_s390_handle_sigp\",\n\t\"kvm:kvm_s390_handle_diag\",\n\t\"kvm:kvm_s390_intercept_prog\",\n\tNULL,\n};\n\nstruct kvm_reg_events_ops kvm_reg_events_ops[] = {\n\t{ .name = \"vmexit\", .ops = &exit_events },\n\t{ NULL, NULL },\n};\n\nconst char * const kvm_skip_events[] = {\n\t\"Wait state\",\n\tNULL,\n};\n\nint cpu_isa_init(struct perf_kvm_stat *kvm, const char *cpuid)\n{\n\tif (strstr(cpuid, \"IBM\")) {\n\t\tkvm->exit_reasons = sie_exit_reasons;\n\t\tkvm->exit_reasons_isa = \"SIE\";\n\t} else\n\t\treturn -ENOTSUP;\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}