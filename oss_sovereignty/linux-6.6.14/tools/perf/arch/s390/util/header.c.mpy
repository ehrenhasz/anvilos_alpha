{
  "module_name": "header.c",
  "hash_id": "797f18755147603afccf3336a1aae8fbc2cd8243a04f1c23c383e32f474cb9d9",
  "original_prompt": "Ingested from linux-6.6.14/tools/perf/arch/s390/util/header.c",
  "human_readable_source": "\n \n\n#include <sys/types.h>\n#include <errno.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <string.h>\n#include <linux/ctype.h>\n#include <linux/kernel.h>\n#include <linux/zalloc.h>\n\n#include \"../../util/header.h\"\n\n#define SYSINFO_MANU\t\"Manufacturer:\"\n#define SYSINFO_TYPE\t\"Type:\"\n#define SYSINFO_MODEL\t\"Model:\"\n#define SRVLVL_CPUMF\t\"CPU-MF:\"\n#define SRVLVL_VERSION\t\"version=\"\n#define SRVLVL_AUTHORIZATION\t\"authorization=\"\n#define SYSINFO\t\t\"/proc/sysinfo\"\n#define SRVLVL\t\t\"/proc/service_levels\"\n\nint get_cpuid(char *buffer, size_t sz)\n{\n\tchar *cp, *line = NULL, *line2;\n\tchar type[8], model[33], version[8], manufacturer[32], authorization[8];\n\tint tpsize = 0, mdsize = 0, vssize = 0, mfsize = 0, atsize = 0;\n\tint read;\n\tunsigned long line_sz;\n\tsize_t nbytes;\n\tFILE *sysinfo;\n\n\t \n\tmemset(manufacturer, 0, sizeof(manufacturer));\n\tmemset(type, 0, sizeof(type));\n\tmemset(model, 0, sizeof(model));\n\tmemset(version, 0, sizeof(version));\n\tmemset(authorization, 0, sizeof(authorization));\n\n\tsysinfo = fopen(SYSINFO, \"r\");\n\tif (sysinfo == NULL)\n\t\treturn errno;\n\n\twhile ((read = getline(&line, &line_sz, sysinfo)) != -1) {\n\t\tif (!strncmp(line, SYSINFO_MANU, strlen(SYSINFO_MANU))) {\n\t\t\tline2 = line + strlen(SYSINFO_MANU);\n\n\t\t\twhile ((cp = strtok_r(line2, \"\\n \", &line2))) {\n\t\t\t\tmfsize += scnprintf(manufacturer + mfsize,\n\t\t\t\t\t\t    sizeof(manufacturer) - mfsize, \"%s\", cp);\n\t\t\t}\n\t\t}\n\n\t\tif (!strncmp(line, SYSINFO_TYPE, strlen(SYSINFO_TYPE))) {\n\t\t\tline2 = line + strlen(SYSINFO_TYPE);\n\n\t\t\twhile ((cp = strtok_r(line2, \"\\n \", &line2))) {\n\t\t\t\ttpsize += scnprintf(type + tpsize,\n\t\t\t\t\t\t    sizeof(type) - tpsize, \"%s\", cp);\n\t\t\t}\n\t\t}\n\n\t\tif (!strncmp(line, SYSINFO_MODEL, strlen(SYSINFO_MODEL))) {\n\t\t\tline2 = line + strlen(SYSINFO_MODEL);\n\n\t\t\twhile ((cp = strtok_r(line2, \"\\n \", &line2))) {\n\t\t\t\tmdsize += scnprintf(model + mdsize, sizeof(model) - mdsize,\n\t\t\t\t\t\t    \"%s%s\", model[0] ? \",\" : \"\", cp);\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\t}\n\tfclose(sysinfo);\n\n\t \n\tif (!manufacturer[0] || !type[0] || !model[0])\n\t\treturn EINVAL;\n\n\t \n\tsysinfo = fopen(SRVLVL, \"r\");\n\tif (sysinfo == NULL)\n\t\tgoto skip_sysinfo;\n\twhile ((read = getline(&line, &line_sz, sysinfo)) != -1) {\n\t\tif (strncmp(line, SRVLVL_CPUMF, strlen(SRVLVL_CPUMF)))\n\t\t\tcontinue;\n\n\t\tline2 = line + strlen(SRVLVL_CPUMF);\n\t\twhile ((cp = strtok_r(line2, \"\\n \", &line2))) {\n\t\t\tif (!strncmp(cp, SRVLVL_VERSION,\n\t\t\t\t     strlen(SRVLVL_VERSION))) {\n\t\t\t\tchar *sep = strchr(cp, '=');\n\n\t\t\t\tvssize += scnprintf(version + vssize,\n\t\t\t\t\t\t    sizeof(version) - vssize, \"%s\", sep + 1);\n\t\t\t}\n\t\t\tif (!strncmp(cp, SRVLVL_AUTHORIZATION,\n\t\t\t\t     strlen(SRVLVL_AUTHORIZATION))) {\n\t\t\t\tchar *sep = strchr(cp, '=');\n\n\t\t\t\tatsize += scnprintf(authorization + atsize,\n\t\t\t\t\t\t    sizeof(authorization) - atsize, \"%s\", sep + 1);\n\t\t\t}\n\t\t}\n\t}\n\tfclose(sysinfo);\n\nskip_sysinfo:\n\tfree(line);\n\n\tif (version[0] && authorization[0] )\n\t\tnbytes = snprintf(buffer, sz, \"%s,%s,%s,%s,%s\",\n\t\t\t\t  manufacturer, type, model, version,\n\t\t\t\t  authorization);\n\telse\n\t\tnbytes = snprintf(buffer, sz, \"%s,%s,%s\", manufacturer, type,\n\t\t\t\t  model);\n\treturn (nbytes >= sz) ? ENOBUFS : 0;\n}\n\nchar *get_cpuid_str(struct perf_pmu *pmu __maybe_unused)\n{\n\tchar *buf = malloc(128);\n\n\tif (buf && get_cpuid(buf, 128))\n\t\tzfree(&buf);\n\treturn buf;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}