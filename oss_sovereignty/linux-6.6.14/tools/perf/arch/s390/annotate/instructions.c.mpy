{
  "module_name": "instructions.c",
  "hash_id": "608dad0c32e955a0215f9ba1fc486a40be347dae9f4b301a912beb2b3370d73d",
  "original_prompt": "Ingested from linux-6.6.14/tools/perf/arch/s390/annotate/instructions.c",
  "human_readable_source": "\n#include <linux/compiler.h>\n\nstatic int s390_call__parse(struct arch *arch, struct ins_operands *ops,\n\t\t\t    struct map_symbol *ms)\n{\n\tchar *endptr, *tok, *name;\n\tstruct map *map = ms->map;\n\tstruct addr_map_symbol target = {\n\t\t.ms = { .map = map, },\n\t};\n\n\ttok = strchr(ops->raw, ',');\n\tif (!tok)\n\t\treturn -1;\n\n\tops->target.addr = strtoull(tok + 1, &endptr, 16);\n\n\tname = strchr(endptr, '<');\n\tif (name == NULL)\n\t\treturn -1;\n\n\tname++;\n\n\tif (arch->objdump.skip_functions_char &&\n\t    strchr(name, arch->objdump.skip_functions_char))\n\t\treturn -1;\n\n\ttok = strchr(name, '>');\n\tif (tok == NULL)\n\t\treturn -1;\n\n\t*tok = '\\0';\n\tops->target.name = strdup(name);\n\t*tok = '>';\n\n\tif (ops->target.name == NULL)\n\t\treturn -1;\n\ttarget.addr = map__objdump_2mem(map, ops->target.addr);\n\n\tif (maps__find_ams(ms->maps, &target) == 0 &&\n\t    map__rip_2objdump(target.ms.map, map__map_ip(target.ms.map, target.addr)) == ops->target.addr)\n\t\tops->target.sym = target.ms.sym;\n\n\treturn 0;\n}\n\nstatic struct ins_ops s390_call_ops = {\n\t.parse\t   = s390_call__parse,\n\t.scnprintf = call__scnprintf,\n};\n\nstatic int s390_mov__parse(struct arch *arch __maybe_unused,\n\t\t\t   struct ins_operands *ops,\n\t\t\t   struct map_symbol *ms __maybe_unused)\n{\n\tchar *s = strchr(ops->raw, ','), *target, *endptr;\n\n\tif (s == NULL)\n\t\treturn -1;\n\n\t*s = '\\0';\n\tops->source.raw = strdup(ops->raw);\n\t*s = ',';\n\n\tif (ops->source.raw == NULL)\n\t\treturn -1;\n\n\ttarget = ++s;\n\tops->target.raw = strdup(target);\n\tif (ops->target.raw == NULL)\n\t\tgoto out_free_source;\n\n\tops->target.addr = strtoull(target, &endptr, 16);\n\tif (endptr == target)\n\t\tgoto out_free_target;\n\n\ts = strchr(endptr, '<');\n\tif (s == NULL)\n\t\tgoto out_free_target;\n\tendptr = strchr(s + 1, '>');\n\tif (endptr == NULL)\n\t\tgoto out_free_target;\n\n\t*endptr = '\\0';\n\tops->target.name = strdup(s + 1);\n\t*endptr = '>';\n\tif (ops->target.name == NULL)\n\t\tgoto out_free_target;\n\n\treturn 0;\n\nout_free_target:\n\tzfree(&ops->target.raw);\nout_free_source:\n\tzfree(&ops->source.raw);\n\treturn -1;\n}\n\n\nstatic struct ins_ops s390_mov_ops = {\n\t.parse\t   = s390_mov__parse,\n\t.scnprintf = mov__scnprintf,\n};\n\nstatic struct ins_ops *s390__associate_ins_ops(struct arch *arch, const char *name)\n{\n\tstruct ins_ops *ops = NULL;\n\n\t \n\tif (strchr(name, 'j') ||\n\t    !strncmp(name, \"bct\", 3) ||\n\t    !strncmp(name, \"br\", 2))\n\t\tops = &jump_ops;\n\t \n\tif (!strcmp(name, \"bras\") ||\n\t    !strcmp(name, \"brasl\") ||\n\t    !strcmp(name, \"basr\"))\n\t\tops = &s390_call_ops;\n\tif (!strcmp(name, \"br\"))\n\t\tops = &ret_ops;\n\t \n\tif (!strcmp(name, \"lrl\") ||\n\t    !strcmp(name, \"lgrl\") ||\n\t    !strcmp(name, \"lgfrl\") ||\n\t    !strcmp(name, \"llgfrl\") ||\n\t    !strcmp(name, \"strl\") ||\n\t    !strcmp(name, \"stgrl\"))\n\t\tops = &s390_mov_ops;\n\n\tif (ops)\n\t\tarch__associate_ins_ops(arch, name, ops);\n\treturn ops;\n}\n\nstatic int s390__cpuid_parse(struct arch *arch, char *cpuid)\n{\n\tunsigned int family;\n\tchar model[16], model_c[16], cpumf_v[16], cpumf_a[16];\n\tint ret;\n\n\t \n\tret = sscanf(cpuid, \"%*[^,],%u,%[^,],%[^,],%[^,],%s\", &family, model_c,\n\t\t     model, cpumf_v, cpumf_a);\n\tif (ret >= 2) {\n\t\tarch->family = family;\n\t\tarch->model = 0;\n\t\treturn 0;\n\t}\n\n\treturn -1;\n}\n\nstatic int s390__annotate_init(struct arch *arch, char *cpuid __maybe_unused)\n{\n\tint err = 0;\n\n\tif (!arch->initialized) {\n\t\tarch->initialized = true;\n\t\tarch->associate_instruction_ops = s390__associate_ins_ops;\n\t\tif (cpuid) {\n\t\t\tif (s390__cpuid_parse(arch, cpuid))\n\t\t\t\terr = SYMBOL_ANNOTATE_ERRNO__ARCH_INIT_CPUID_PARSING;\n\t\t}\n\t}\n\n\treturn err;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}