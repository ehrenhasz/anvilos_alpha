{
  "module_name": "evlist.c",
  "hash_id": "7c6c44c0edf267cab7b834f4c8099386ab6c1533024900e495f79f708438a662",
  "original_prompt": "Ingested from linux-6.6.14/tools/perf/arch/x86/util/evlist.c",
  "human_readable_source": "\n#include <stdio.h>\n#include \"util/pmu.h\"\n#include \"util/pmus.h\"\n#include \"util/evlist.h\"\n#include \"util/parse-events.h\"\n#include \"util/event.h\"\n#include \"topdown.h\"\n#include \"evsel.h\"\n\nstatic int ___evlist__add_default_attrs(struct evlist *evlist,\n\t\t\t\t\tstruct perf_event_attr *attrs,\n\t\t\t\t\tsize_t nr_attrs)\n{\n\tLIST_HEAD(head);\n\tsize_t i = 0;\n\n\tfor (i = 0; i < nr_attrs; i++)\n\t\tevent_attr_init(attrs + i);\n\n\tif (perf_pmus__num_core_pmus() == 1)\n\t\treturn evlist__add_attrs(evlist, attrs, nr_attrs);\n\n\tfor (i = 0; i < nr_attrs; i++) {\n\t\tstruct perf_pmu *pmu = NULL;\n\n\t\tif (attrs[i].type == PERF_TYPE_SOFTWARE) {\n\t\t\tstruct evsel *evsel = evsel__new(attrs + i);\n\n\t\t\tif (evsel == NULL)\n\t\t\t\tgoto out_delete_partial_list;\n\t\t\tlist_add_tail(&evsel->core.node, &head);\n\t\t\tcontinue;\n\t\t}\n\n\t\twhile ((pmu = perf_pmus__scan_core(pmu)) != NULL) {\n\t\t\tstruct perf_cpu_map *cpus;\n\t\t\tstruct evsel *evsel;\n\n\t\t\tevsel = evsel__new(attrs + i);\n\t\t\tif (evsel == NULL)\n\t\t\t\tgoto out_delete_partial_list;\n\t\t\tevsel->core.attr.config |= (__u64)pmu->type << PERF_PMU_TYPE_SHIFT;\n\t\t\tcpus = perf_cpu_map__get(pmu->cpus);\n\t\t\tevsel->core.cpus = cpus;\n\t\t\tevsel->core.own_cpus = perf_cpu_map__get(cpus);\n\t\t\tevsel->pmu_name = strdup(pmu->name);\n\t\t\tlist_add_tail(&evsel->core.node, &head);\n\t\t}\n\t}\n\n\tevlist__splice_list_tail(evlist, &head);\n\n\treturn 0;\n\nout_delete_partial_list:\n\t{\n\t\tstruct evsel *evsel, *n;\n\n\t\t__evlist__for_each_entry_safe(&head, n, evsel)\n\t\t\tevsel__delete(evsel);\n\t}\n\treturn -1;\n}\n\nint arch_evlist__add_default_attrs(struct evlist *evlist,\n\t\t\t\t   struct perf_event_attr *attrs,\n\t\t\t\t   size_t nr_attrs)\n{\n\tif (!nr_attrs)\n\t\treturn 0;\n\n\treturn ___evlist__add_default_attrs(evlist, attrs, nr_attrs);\n}\n\nint arch_evlist__cmp(const struct evsel *lhs, const struct evsel *rhs)\n{\n\tif (topdown_sys_has_perf_metrics() &&\n\t    (arch_evsel__must_be_in_group(lhs) || arch_evsel__must_be_in_group(rhs))) {\n\t\t \n\t\tif (strcasestr(lhs->name, \"slots\") && !strcasestr(lhs->name, \"uops_retired.slots\"))\n\t\t\treturn -1;\n\t\tif (strcasestr(rhs->name, \"slots\") && !strcasestr(rhs->name, \"uops_retired.slots\"))\n\t\t\treturn 1;\n\t\t \n\t\tif (strcasestr(lhs->name, \"topdown\") && !strcasestr(rhs->name, \"topdown\"))\n\t\t\treturn -1;\n\t\tif (!strcasestr(lhs->name, \"topdown\") && strcasestr(rhs->name, \"topdown\"))\n\t\t\treturn 1;\n\t}\n\n\t \n\treturn lhs->core.idx - rhs->core.idx;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}