{
  "module_name": "mem-events.c",
  "hash_id": "ee8a323ea05b0a7a8f4f2a129376cd29aae022303cd0a31fcdf9163d87a7d996",
  "original_prompt": "Ingested from linux-6.6.14/tools/perf/arch/x86/util/mem-events.c",
  "human_readable_source": "\n#include \"util/pmu.h\"\n#include \"util/pmus.h\"\n#include \"util/env.h\"\n#include \"map_symbol.h\"\n#include \"mem-events.h\"\n#include \"linux/string.h\"\n#include \"env.h\"\n\nstatic char mem_loads_name[100];\nstatic bool mem_loads_name__init;\nstatic char mem_stores_name[100];\n\n#define MEM_LOADS_AUX\t\t0x8203\n#define MEM_LOADS_AUX_NAME     \"{%s/mem-loads-aux/,%s/mem-loads,ldlat=%u/}:P\"\n\n#define E(t, n, s) { .tag = t, .name = n, .sysfs_name = s }\n\nstatic struct perf_mem_event perf_mem_events_intel[PERF_MEM_EVENTS__MAX] = {\n\tE(\"ldlat-loads\",\t\"%s/mem-loads,ldlat=%u/P\",\t\"%s/events/mem-loads\"),\n\tE(\"ldlat-stores\",\t\"%s/mem-stores/P\",\t\t\"%s/events/mem-stores\"),\n\tE(NULL,\t\t\tNULL,\t\t\t\tNULL),\n};\n\nstatic struct perf_mem_event perf_mem_events_amd[PERF_MEM_EVENTS__MAX] = {\n\tE(NULL,\t\tNULL,\t\tNULL),\n\tE(NULL,\t\tNULL,\t\tNULL),\n\tE(\"mem-ldst\",\t\"ibs_op//\",\t\"ibs_op\"),\n};\n\nstruct perf_mem_event *perf_mem_events__ptr(int i)\n{\n\tif (i >= PERF_MEM_EVENTS__MAX)\n\t\treturn NULL;\n\n\tif (x86__is_amd_cpu())\n\t\treturn &perf_mem_events_amd[i];\n\n\treturn &perf_mem_events_intel[i];\n}\n\nbool is_mem_loads_aux_event(struct evsel *leader)\n{\n\tstruct perf_pmu *pmu = perf_pmus__find(\"cpu\");\n\n\tif (!pmu)\n\t\tpmu = perf_pmus__find(\"cpu_core\");\n\n\tif (pmu && !perf_pmu__have_event(pmu, \"mem-loads-aux\"))\n\t\treturn false;\n\n\treturn leader->core.attr.config == MEM_LOADS_AUX;\n}\n\nconst char *perf_mem_events__name(int i, const char *pmu_name)\n{\n\tstruct perf_mem_event *e = perf_mem_events__ptr(i);\n\n\tif (!e)\n\t\treturn NULL;\n\n\tif (i == PERF_MEM_EVENTS__LOAD) {\n\t\tif (mem_loads_name__init && !pmu_name)\n\t\t\treturn mem_loads_name;\n\n\t\tif (!pmu_name) {\n\t\t\tmem_loads_name__init = true;\n\t\t\tpmu_name = \"cpu\";\n\t\t}\n\n\t\tif (perf_pmus__have_event(pmu_name, \"mem-loads-aux\")) {\n\t\t\tscnprintf(mem_loads_name, sizeof(mem_loads_name),\n\t\t\t\t  MEM_LOADS_AUX_NAME, pmu_name, pmu_name,\n\t\t\t\t  perf_mem_events__loads_ldlat);\n\t\t} else {\n\t\t\tscnprintf(mem_loads_name, sizeof(mem_loads_name),\n\t\t\t\t  e->name, pmu_name,\n\t\t\t\t  perf_mem_events__loads_ldlat);\n\t\t}\n\t\treturn mem_loads_name;\n\t}\n\n\tif (i == PERF_MEM_EVENTS__STORE) {\n\t\tif (!pmu_name)\n\t\t\tpmu_name = \"cpu\";\n\n\t\tscnprintf(mem_stores_name, sizeof(mem_stores_name),\n\t\t\t  e->name, pmu_name);\n\t\treturn mem_stores_name;\n\t}\n\n\treturn e->name;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}