{
  "module_name": "header.c",
  "hash_id": "42f52c372ab3bbb6cba6b1762e98aa6987670c9507cab38cbf4c3fdcb927f5c1",
  "original_prompt": "Ingested from linux-6.6.14/tools/perf/ui/browsers/header.c",
  "human_readable_source": "\n#include \"ui/browser.h\"\n#include \"ui/keysyms.h\"\n#include \"ui/ui.h\"\n#include \"ui/util.h\"\n#include \"ui/libslang.h\"\n#include \"util/header.h\"\n#include \"util/session.h\"\n\n#include <sys/ttydefaults.h>\n\nstatic void ui_browser__argv_write(struct ui_browser *browser,\n\t\t\t\t   void *entry, int row)\n{\n\tchar **arg = entry;\n\tchar *str = *arg;\n\tchar empty[] = \" \";\n\tbool current_entry = ui_browser__is_current_entry(browser, row);\n\tunsigned long offset = (unsigned long)browser->priv;\n\n\tif (offset >= strlen(str))\n\t\tstr = empty;\n\telse\n\t\tstr = str + offset;\n\n\tui_browser__set_color(browser, current_entry ? HE_COLORSET_SELECTED :\n\t\t\t\t\t\t       HE_COLORSET_NORMAL);\n\n\tui_browser__write_nstring(browser, str, browser->width);\n}\n\nstatic int list_menu__run(struct ui_browser *menu)\n{\n\tint key;\n\tunsigned long offset;\n\tstatic const char help[] =\n\t\"h/?/F1        Show this window\\n\"\n\t\"UP/DOWN/PGUP\\n\"\n\t\"PGDN/SPACE\\n\"\n\t\"LEFT/RIGHT    Navigate\\n\"\n\t\"q/ESC/CTRL+C  Exit browser\";\n\n\tif (ui_browser__show(menu, \"Header information\", \"Press 'q' to exit\") < 0)\n\t\treturn -1;\n\n\twhile (1) {\n\t\tkey = ui_browser__run(menu, 0);\n\n\t\tswitch (key) {\n\t\tcase K_RIGHT:\n\t\t\toffset = (unsigned long)menu->priv;\n\t\t\toffset += 10;\n\t\t\tmenu->priv = (void *)offset;\n\t\t\tcontinue;\n\t\tcase K_LEFT:\n\t\t\toffset = (unsigned long)menu->priv;\n\t\t\tif (offset >= 10)\n\t\t\t\toffset -= 10;\n\t\t\tmenu->priv = (void *)offset;\n\t\t\tcontinue;\n\t\tcase K_F1:\n\t\tcase 'h':\n\t\tcase '?':\n\t\t\tui_browser__help_window(menu, help);\n\t\t\tcontinue;\n\t\tcase K_ESC:\n\t\tcase 'q':\n\t\tcase CTRL('c'):\n\t\t\tkey = -1;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tcontinue;\n\t\t}\n\n\t\tbreak;\n\t}\n\n\tui_browser__hide(menu);\n\treturn key;\n}\n\nstatic int ui__list_menu(int argc, char * const argv[])\n{\n\tstruct ui_browser menu = {\n\t\t.entries    = (void *)argv,\n\t\t.refresh    = ui_browser__argv_refresh,\n\t\t.seek\t    = ui_browser__argv_seek,\n\t\t.write\t    = ui_browser__argv_write,\n\t\t.nr_entries = argc,\n\t};\n\n\treturn list_menu__run(&menu);\n}\n\nint tui__header_window(struct perf_env *env)\n{\n\tint i, argc = 0;\n\tchar **argv;\n\tstruct perf_session *session;\n\tchar *ptr, *pos;\n\tsize_t size;\n\tFILE *fp = open_memstream(&ptr, &size);\n\n\tsession = container_of(env, struct perf_session, header.env);\n\tperf_header__fprintf_info(session, fp, true);\n\tfclose(fp);\n\n\tfor (pos = ptr, argc = 0; (pos = strchr(pos, '\\n')) != NULL; pos++)\n\t\targc++;\n\n\targv = calloc(argc + 1, sizeof(*argv));\n\tif (argv == NULL)\n\t\tgoto out;\n\n\targv[0] = pos = ptr;\n\tfor (i = 1; (pos = strchr(pos, '\\n')) != NULL; i++) {\n\t\t*pos++ = '\\0';\n\t\targv[i] = pos;\n\t}\n\n\tBUG_ON(i != argc + 1);\n\n\tui__list_menu(argc, argv);\n\nout:\n\tfree(argv);\n\tfree(ptr);\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}