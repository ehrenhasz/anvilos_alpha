{
  "module_name": "res_sample.c",
  "hash_id": "3a61ba1feb8450ce94feb214d012e0aaf8c392ded75587103c3c3c204fa31b3f",
  "original_prompt": "Ingested from linux-6.6.14/tools/perf/ui/browsers/res_sample.c",
  "human_readable_source": "\n \n#include \"hist.h\"\n#include \"evsel.h\"\n#include \"hists.h\"\n#include \"sort.h\"\n#include \"config.h\"\n#include \"time-utils.h\"\n#include \"../util.h\"\n#include \"../../util/util.h\" \n#include \"../../perf.h\"\n#include <stdlib.h>\n#include <string.h>\n#include <linux/time64.h>\n#include <linux/zalloc.h>\n\nstatic u64 context_len = 10 * NSEC_PER_MSEC;\n\nstatic int res_sample_config(const char *var, const char *value, void *data __maybe_unused)\n{\n\tif (!strcmp(var, \"samples.context\"))\n\t\treturn perf_config_u64(&context_len, var, value);\n\treturn 0;\n}\n\nvoid res_sample_init(void)\n{\n\tperf_config(res_sample_config, NULL);\n}\n\nint res_sample_browse(struct res_sample *res_samples, int num_res,\n\t\t      struct evsel *evsel, enum rstype rstype)\n{\n\tchar **names;\n\tint i, n;\n\tint choice;\n\tchar *cmd;\n\tchar pbuf[256], tidbuf[32], cpubuf[32];\n\tconst char *perf = perf_exe(pbuf, sizeof pbuf);\n\tchar trange[128], tsample[64];\n\tstruct res_sample *r;\n\tchar extra_format[256];\n\n\tnames = calloc(num_res, sizeof(char *));\n\tif (!names)\n\t\treturn -1;\n\tfor (i = 0; i < num_res; i++) {\n\t\tchar tbuf[64];\n\n\t\ttimestamp__scnprintf_nsec(res_samples[i].time, tbuf, sizeof tbuf);\n\t\tif (asprintf(&names[i], \"%s: CPU %d tid %d\", tbuf,\n\t\t\t     res_samples[i].cpu, res_samples[i].tid) < 0) {\n\t\t\twhile (--i >= 0)\n\t\t\t\tzfree(&names[i]);\n\t\t\tfree(names);\n\t\t\treturn -1;\n\t\t}\n\t}\n\tchoice = ui__popup_menu(num_res, names, NULL);\n\tfor (i = 0; i < num_res; i++)\n\t\tzfree(&names[i]);\n\tfree(names);\n\n\tif (choice < 0 || choice >= num_res)\n\t\treturn -1;\n\tr = &res_samples[choice];\n\n\tn = timestamp__scnprintf_nsec(r->time - context_len, trange, sizeof trange);\n\ttrange[n++] = ',';\n\ttimestamp__scnprintf_nsec(r->time + context_len, trange + n, sizeof trange - n);\n\n\ttimestamp__scnprintf_nsec(r->time, tsample, sizeof tsample);\n\n\tattr_to_script(extra_format, &evsel->core.attr);\n\n\tif (asprintf(&cmd, \"%s script %s%s --time %s %s%s %s%s --ns %s %s %s %s %s | less +/%s\",\n\t\t     perf,\n\t\t     input_name ? \"-i \" : \"\",\n\t\t     input_name ? input_name : \"\",\n\t\t     trange,\n\t\t     r->cpu >= 0 ? \"--cpu \" : \"\",\n\t\t     r->cpu >= 0 ? (sprintf(cpubuf, \"%d\", r->cpu), cpubuf) : \"\",\n\t\t     r->tid ? \"--tid \" : \"\",\n\t\t     r->tid ? (sprintf(tidbuf, \"%d\", r->tid), tidbuf) : \"\",\n\t\t     extra_format,\n\t\t     rstype == A_ASM ? \"-F +insn --xed\" :\n\t\t     rstype == A_SOURCE ? \"-F +srcline,+srccode\" : \"\",\n\t\t     symbol_conf.inline_name ? \"--inline\" : \"\",\n\t\t     \"--show-lost-events \",\n\t\t     r->tid ? \"--show-switch-events --show-task-events \" : \"\",\n\t\t     tsample) < 0)\n\t\treturn -1;\n\trun_script(cmd);\n\tfree(cmd);\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}