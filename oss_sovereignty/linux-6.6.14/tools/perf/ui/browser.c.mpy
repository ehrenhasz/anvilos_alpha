{
  "module_name": "browser.c",
  "hash_id": "017c76e1483d365ef9d6b0e867405c830a37fdeb98f37b869e5f9e0febc898a2",
  "original_prompt": "Ingested from linux-6.6.14/tools/perf/ui/browser.c",
  "human_readable_source": "\n#include \"../util/string2.h\"\n#include \"../util/config.h\"\n#include \"libslang.h\"\n#include \"ui.h\"\n#include \"util.h\"\n#include <linux/compiler.h>\n#include <linux/list.h>\n#include <linux/rbtree.h>\n#include <linux/string.h>\n#include <stdlib.h>\n#include <sys/ttydefaults.h>\n#include \"browser.h\"\n#include \"helpline.h\"\n#include \"keysyms.h\"\n#include \"../util/color.h\"\n#include <linux/ctype.h>\n#include <linux/zalloc.h>\n\nstatic int ui_browser__percent_color(struct ui_browser *browser,\n\t\t\t\t     double percent, bool current)\n{\n\tif (current && (!browser->use_navkeypressed || browser->navkeypressed))\n\t\treturn HE_COLORSET_SELECTED;\n\tif (percent >= MIN_RED)\n\t\treturn HE_COLORSET_TOP;\n\tif (percent >= MIN_GREEN)\n\t\treturn HE_COLORSET_MEDIUM;\n\treturn HE_COLORSET_NORMAL;\n}\n\nint ui_browser__set_color(struct ui_browser *browser, int color)\n{\n\tint ret = browser->current_color;\n\tbrowser->current_color = color;\n\tSLsmg_set_color(color);\n\treturn ret;\n}\n\nvoid ui_browser__set_percent_color(struct ui_browser *browser,\n\t\t\t\t   double percent, bool current)\n{\n\t int color = ui_browser__percent_color(browser, percent, current);\n\t ui_browser__set_color(browser, color);\n}\n\nvoid ui_browser__gotorc_title(struct ui_browser *browser, int y, int x)\n{\n\tSLsmg_gotorc(browser->y + y, browser->x + x);\n}\n\nvoid ui_browser__gotorc(struct ui_browser *browser, int y, int x)\n{\n\tSLsmg_gotorc(browser->y + y + browser->extra_title_lines, browser->x + x);\n}\n\nvoid ui_browser__write_nstring(struct ui_browser *browser __maybe_unused, const char *msg,\n\t\t\t       unsigned int width)\n{\n\tSLsmg_write_nstring(msg, width);\n}\n\nvoid ui_browser__vprintf(struct ui_browser *browser __maybe_unused, const char *fmt, va_list args)\n{\n\tSLsmg_vprintf(fmt, args);\n}\n\nvoid ui_browser__printf(struct ui_browser *browser __maybe_unused, const char *fmt, ...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tui_browser__vprintf(browser, fmt, args);\n\tva_end(args);\n}\n\nstatic struct list_head *\nui_browser__list_head_filter_entries(struct ui_browser *browser,\n\t\t\t\t     struct list_head *pos)\n{\n\tdo {\n\t\tif (!browser->filter || !browser->filter(browser, pos))\n\t\t\treturn pos;\n\t\tpos = pos->next;\n\t} while (pos != browser->entries);\n\n\treturn NULL;\n}\n\nstatic struct list_head *\nui_browser__list_head_filter_prev_entries(struct ui_browser *browser,\n\t\t\t\t\t  struct list_head *pos)\n{\n\tdo {\n\t\tif (!browser->filter || !browser->filter(browser, pos))\n\t\t\treturn pos;\n\t\tpos = pos->prev;\n\t} while (pos != browser->entries);\n\n\treturn NULL;\n}\n\nvoid ui_browser__list_head_seek(struct ui_browser *browser, off_t offset, int whence)\n{\n\tstruct list_head *head = browser->entries;\n\tstruct list_head *pos;\n\n\tif (browser->nr_entries == 0)\n\t\treturn;\n\n\tswitch (whence) {\n\tcase SEEK_SET:\n\t\tpos = ui_browser__list_head_filter_entries(browser, head->next);\n\t\tbreak;\n\tcase SEEK_CUR:\n\t\tpos = browser->top;\n\t\tbreak;\n\tcase SEEK_END:\n\t\tpos = ui_browser__list_head_filter_prev_entries(browser, head->prev);\n\t\tbreak;\n\tdefault:\n\t\treturn;\n\t}\n\n\tassert(pos != NULL);\n\n\tif (offset > 0) {\n\t\twhile (offset-- != 0)\n\t\t\tpos = ui_browser__list_head_filter_entries(browser, pos->next);\n\t} else {\n\t\twhile (offset++ != 0)\n\t\t\tpos = ui_browser__list_head_filter_prev_entries(browser, pos->prev);\n\t}\n\n\tbrowser->top = pos;\n}\n\nvoid ui_browser__rb_tree_seek(struct ui_browser *browser, off_t offset, int whence)\n{\n\tstruct rb_root *root = browser->entries;\n\tstruct rb_node *nd;\n\n\tswitch (whence) {\n\tcase SEEK_SET:\n\t\tnd = rb_first(root);\n\t\tbreak;\n\tcase SEEK_CUR:\n\t\tnd = browser->top;\n\t\tbreak;\n\tcase SEEK_END:\n\t\tnd = rb_last(root);\n\t\tbreak;\n\tdefault:\n\t\treturn;\n\t}\n\n\tif (offset > 0) {\n\t\twhile (offset-- != 0)\n\t\t\tnd = rb_next(nd);\n\t} else {\n\t\twhile (offset++ != 0)\n\t\t\tnd = rb_prev(nd);\n\t}\n\n\tbrowser->top = nd;\n}\n\nunsigned int ui_browser__rb_tree_refresh(struct ui_browser *browser)\n{\n\tstruct rb_node *nd;\n\tint row = 0;\n\n\tif (browser->top == NULL)\n                browser->top = rb_first(browser->entries);\n\n\tnd = browser->top;\n\n\twhile (nd != NULL) {\n\t\tui_browser__gotorc(browser, row, 0);\n\t\tbrowser->write(browser, nd, row);\n\t\tif (++row == browser->rows)\n\t\t\tbreak;\n\t\tnd = rb_next(nd);\n\t}\n\n\treturn row;\n}\n\nbool ui_browser__is_current_entry(struct ui_browser *browser, unsigned row)\n{\n\treturn browser->top_idx + row == browser->index;\n}\n\nvoid ui_browser__refresh_dimensions(struct ui_browser *browser)\n{\n\tbrowser->width = SLtt_Screen_Cols - 1;\n\tbrowser->height = browser->rows = SLtt_Screen_Rows - 2;\n\tbrowser->rows -= browser->extra_title_lines;\n\tbrowser->y = 1;\n\tbrowser->x = 0;\n}\n\nvoid ui_browser__handle_resize(struct ui_browser *browser)\n{\n\tui__refresh_dimensions(false);\n\tui_browser__show(browser, browser->title, ui_helpline__current);\n\tui_browser__refresh(browser);\n}\n\nint ui_browser__warning(struct ui_browser *browser, int timeout,\n\t\t\tconst char *format, ...)\n{\n\tva_list args;\n\tchar *text;\n\tint key = 0, err;\n\n\tva_start(args, format);\n\terr = vasprintf(&text, format, args);\n\tva_end(args);\n\n\tif (err < 0) {\n\t\tva_start(args, format);\n\t\tui_helpline__vpush(format, args);\n\t\tva_end(args);\n\t} else {\n\t\twhile ((key = ui__question_window(\"Warning!\", text,\n\t\t\t\t\t\t   \"Press any key...\",\n\t\t\t\t\t\t   timeout)) == K_RESIZE)\n\t\t\tui_browser__handle_resize(browser);\n\t\tfree(text);\n\t}\n\n\treturn key;\n}\n\nint ui_browser__help_window(struct ui_browser *browser, const char *text)\n{\n\tint key;\n\n\twhile ((key = ui__help_window(text)) == K_RESIZE)\n\t\tui_browser__handle_resize(browser);\n\n\treturn key;\n}\n\nbool ui_browser__dialog_yesno(struct ui_browser *browser, const char *text)\n{\n\tint key;\n\n\twhile ((key = ui__dialog_yesno(text)) == K_RESIZE)\n\t\tui_browser__handle_resize(browser);\n\n\treturn key == K_ENTER || toupper(key) == 'Y';\n}\n\nvoid ui_browser__reset_index(struct ui_browser *browser)\n{\n\tbrowser->index = browser->top_idx = 0;\n\tbrowser->seek(browser, 0, SEEK_SET);\n}\n\nvoid __ui_browser__show_title(struct ui_browser *browser, const char *title)\n{\n\tSLsmg_gotorc(0, 0);\n\tui_browser__set_color(browser, HE_COLORSET_ROOT);\n\tui_browser__write_nstring(browser, title, browser->width + 1);\n}\n\nvoid ui_browser__show_title(struct ui_browser *browser, const char *title)\n{\n\tmutex_lock(&ui__lock);\n\t__ui_browser__show_title(browser, title);\n\tmutex_unlock(&ui__lock);\n}\n\nint ui_browser__show(struct ui_browser *browser, const char *title,\n\t\t     const char *helpline, ...)\n{\n\tint err;\n\tva_list ap;\n\n\tif (browser->refresh_dimensions == NULL)\n\t\tbrowser->refresh_dimensions = ui_browser__refresh_dimensions;\n\n\tbrowser->refresh_dimensions(browser);\n\n\tmutex_lock(&ui__lock);\n\t__ui_browser__show_title(browser, title);\n\n\tbrowser->title = title;\n\tzfree(&browser->helpline);\n\n\tva_start(ap, helpline);\n\terr = vasprintf(&browser->helpline, helpline, ap);\n\tva_end(ap);\n\tif (err > 0)\n\t\tui_helpline__push(browser->helpline);\n\tmutex_unlock(&ui__lock);\n\treturn err ? 0 : -1;\n}\n\nvoid ui_browser__hide(struct ui_browser *browser)\n{\n\tmutex_lock(&ui__lock);\n\tui_helpline__pop();\n\tzfree(&browser->helpline);\n\tmutex_unlock(&ui__lock);\n}\n\nstatic void ui_browser__scrollbar_set(struct ui_browser *browser)\n{\n\tint height = browser->height, h = 0, pct = 0,\n\t    col = browser->width,\n\t    row = 0;\n\n\tif (browser->nr_entries > 1) {\n\t\tpct = ((browser->index * (browser->height - 1)) /\n\t\t       (browser->nr_entries - 1));\n\t}\n\n\tSLsmg_set_char_set(1);\n\n\twhile (h < height) {\n\t        ui_browser__gotorc(browser, row++, col);\n\t\tSLsmg_write_char(h == pct ? SLSMG_DIAMOND_CHAR : SLSMG_CKBRD_CHAR);\n\t\t++h;\n\t}\n\n\tSLsmg_set_char_set(0);\n}\n\nstatic int __ui_browser__refresh(struct ui_browser *browser)\n{\n\tint row;\n\tint width = browser->width;\n\n\trow = browser->refresh(browser);\n\tui_browser__set_color(browser, HE_COLORSET_NORMAL);\n\n\tif (!browser->use_navkeypressed || browser->navkeypressed)\n\t\tui_browser__scrollbar_set(browser);\n\telse\n\t\twidth += 1;\n\n\tSLsmg_fill_region(browser->y + row + browser->extra_title_lines, browser->x,\n\t\t\t  browser->rows - row, width, ' ');\n\n\tif (browser->nr_entries == 0 && browser->no_samples_msg)\n\t\t__ui__info_window(NULL, browser->no_samples_msg, NULL);\n\treturn 0;\n}\n\nint ui_browser__refresh(struct ui_browser *browser)\n{\n\tmutex_lock(&ui__lock);\n\t__ui_browser__refresh(browser);\n\tmutex_unlock(&ui__lock);\n\n\treturn 0;\n}\n\n \nvoid ui_browser__update_nr_entries(struct ui_browser *browser, u32 nr_entries)\n{\n\toff_t offset = nr_entries - browser->nr_entries;\n\n\tbrowser->nr_entries = nr_entries;\n\n\tif (offset < 0) {\n\t\tif (browser->top_idx < (u64)-offset)\n\t\t\toffset = -browser->top_idx;\n\n\t\tbrowser->index += offset;\n\t\tbrowser->top_idx += offset;\n\t}\n\n\tbrowser->top = NULL;\n\tbrowser->seek(browser, browser->top_idx, SEEK_SET);\n}\n\nint ui_browser__run(struct ui_browser *browser, int delay_secs)\n{\n\tint err, key;\n\n\twhile (1) {\n\t\toff_t offset;\n\n\t\tmutex_lock(&ui__lock);\n\t\terr = __ui_browser__refresh(browser);\n\t\tSLsmg_refresh();\n\t\tmutex_unlock(&ui__lock);\n\t\tif (err < 0)\n\t\t\tbreak;\n\n\t\tkey = ui__getch(delay_secs);\n\n\t\tif (key == K_RESIZE) {\n\t\t\tui__refresh_dimensions(false);\n\t\t\tbrowser->refresh_dimensions(browser);\n\t\t\t__ui_browser__show_title(browser, browser->title);\n\t\t\tui_helpline__puts(browser->helpline);\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (browser->use_navkeypressed && !browser->navkeypressed) {\n\t\t\tif (key == K_DOWN || key == K_UP ||\n\t\t\t    (browser->columns && (key == K_LEFT || key == K_RIGHT)) ||\n\t\t\t    key == K_PGDN || key == K_PGUP ||\n\t\t\t    key == K_HOME || key == K_END ||\n\t\t\t    key == ' ') {\n\t\t\t\tbrowser->navkeypressed = true;\n\t\t\t\tcontinue;\n\t\t\t} else\n\t\t\t\treturn key;\n\t\t}\n\n\t\tswitch (key) {\n\t\tcase K_DOWN:\n\t\t\tif (browser->index == browser->nr_entries - 1)\n\t\t\t\tbreak;\n\t\t\t++browser->index;\n\t\t\tif (browser->index == browser->top_idx + browser->rows) {\n\t\t\t\t++browser->top_idx;\n\t\t\t\tbrowser->seek(browser, +1, SEEK_CUR);\n\t\t\t}\n\t\t\tbreak;\n\t\tcase K_UP:\n\t\t\tif (browser->index == 0)\n\t\t\t\tbreak;\n\t\t\t--browser->index;\n\t\t\tif (browser->index < browser->top_idx) {\n\t\t\t\t--browser->top_idx;\n\t\t\t\tbrowser->seek(browser, -1, SEEK_CUR);\n\t\t\t}\n\t\t\tbreak;\n\t\tcase K_RIGHT:\n\t\t\tif (!browser->columns)\n\t\t\t\tgoto out;\n\t\t\tif (browser->horiz_scroll < browser->columns - 1)\n\t\t\t\t++browser->horiz_scroll;\n\t\t\tbreak;\n\t\tcase K_LEFT:\n\t\t\tif (!browser->columns)\n\t\t\t\tgoto out;\n\t\t\tif (browser->horiz_scroll != 0)\n\t\t\t\t--browser->horiz_scroll;\n\t\t\tbreak;\n\t\tcase K_PGDN:\n\t\tcase ' ':\n\t\t\tif (browser->top_idx + browser->rows > browser->nr_entries - 1)\n\t\t\t\tbreak;\n\n\t\t\toffset = browser->rows;\n\t\t\tif (browser->index + offset > browser->nr_entries - 1)\n\t\t\t\toffset = browser->nr_entries - 1 - browser->index;\n\t\t\tbrowser->index += offset;\n\t\t\tbrowser->top_idx += offset;\n\t\t\tbrowser->seek(browser, +offset, SEEK_CUR);\n\t\t\tbreak;\n\t\tcase K_PGUP:\n\t\t\tif (browser->top_idx == 0)\n\t\t\t\tbreak;\n\n\t\t\tif (browser->top_idx < browser->rows)\n\t\t\t\toffset = browser->top_idx;\n\t\t\telse\n\t\t\t\toffset = browser->rows;\n\n\t\t\tbrowser->index -= offset;\n\t\t\tbrowser->top_idx -= offset;\n\t\t\tbrowser->seek(browser, -offset, SEEK_CUR);\n\t\t\tbreak;\n\t\tcase K_HOME:\n\t\t\tui_browser__reset_index(browser);\n\t\t\tbreak;\n\t\tcase K_END:\n\t\t\toffset = browser->rows - 1;\n\t\t\tif (offset >= browser->nr_entries)\n\t\t\t\toffset = browser->nr_entries - 1;\n\n\t\t\tbrowser->index = browser->nr_entries - 1;\n\t\t\tbrowser->top_idx = browser->index - offset;\n\t\t\tbrowser->seek(browser, -offset, SEEK_END);\n\t\t\tbreak;\n\t\tdefault:\n\t\tout:\n\t\t\treturn key;\n\t\t}\n\t}\n\treturn -1;\n}\n\nunsigned int ui_browser__list_head_refresh(struct ui_browser *browser)\n{\n\tstruct list_head *pos;\n\tstruct list_head *head = browser->entries;\n\tint row = 0;\n\n\tif (browser->top == NULL || browser->top == browser->entries)\n                browser->top = ui_browser__list_head_filter_entries(browser, head->next);\n\n\tpos = browser->top;\n\n\tlist_for_each_from(pos, head) {\n\t\tif (!browser->filter || !browser->filter(browser, pos)) {\n\t\t\tui_browser__gotorc(browser, row, 0);\n\t\t\tbrowser->write(browser, pos, row);\n\t\t\tif (++row == browser->rows)\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\treturn row;\n}\n\nstatic struct ui_browser_colorset {\n\tconst char *name, *fg, *bg;\n\tint colorset;\n} ui_browser__colorsets[] = {\n\t{\n\t\t.colorset = HE_COLORSET_TOP,\n\t\t.name\t  = \"top\",\n\t\t.fg\t  = \"red\",\n\t\t.bg\t  = \"default\",\n\t},\n\t{\n\t\t.colorset = HE_COLORSET_MEDIUM,\n\t\t.name\t  = \"medium\",\n\t\t.fg\t  = \"green\",\n\t\t.bg\t  = \"default\",\n\t},\n\t{\n\t\t.colorset = HE_COLORSET_NORMAL,\n\t\t.name\t  = \"normal\",\n\t\t.fg\t  = \"default\",\n\t\t.bg\t  = \"default\",\n\t},\n\t{\n\t\t.colorset = HE_COLORSET_SELECTED,\n\t\t.name\t  = \"selected\",\n\t\t.fg\t  = \"black\",\n\t\t.bg\t  = \"yellow\",\n\t},\n\t{\n\t\t.colorset = HE_COLORSET_JUMP_ARROWS,\n\t\t.name\t  = \"jump_arrows\",\n\t\t.fg\t  = \"blue\",\n\t\t.bg\t  = \"default\",\n\t},\n\t{\n\t\t.colorset = HE_COLORSET_ADDR,\n\t\t.name\t  = \"addr\",\n\t\t.fg\t  = \"magenta\",\n\t\t.bg\t  = \"default\",\n\t},\n\t{\n\t\t.colorset = HE_COLORSET_ROOT,\n\t\t.name\t  = \"root\",\n\t\t.fg\t  = \"white\",\n\t\t.bg\t  = \"blue\",\n\t},\n\t{\n\t\t.name = NULL,\n\t}\n};\n\n\nstatic int ui_browser__color_config(const char *var, const char *value,\n\t\t\t\t    void *data __maybe_unused)\n{\n\tchar *fg = NULL, *bg;\n\tint i;\n\n\t \n\tif (!strstarts(var, \"colors.\") != 0)\n\t\treturn 0;\n\n\tfor (i = 0; ui_browser__colorsets[i].name != NULL; ++i) {\n\t\tconst char *name = var + 7;\n\n\t\tif (strcmp(ui_browser__colorsets[i].name, name) != 0)\n\t\t\tcontinue;\n\n\t\tfg = strdup(value);\n\t\tif (fg == NULL)\n\t\t\tbreak;\n\n\t\tbg = strchr(fg, ',');\n\t\tif (bg == NULL)\n\t\t\tbreak;\n\n\t\t*bg = '\\0';\n\t\tbg = skip_spaces(bg + 1);\n\t\tui_browser__colorsets[i].bg = bg;\n\t\tui_browser__colorsets[i].fg = fg;\n\t\treturn 0;\n\t}\n\n\tfree(fg);\n\treturn -1;\n}\n\nvoid ui_browser__argv_seek(struct ui_browser *browser, off_t offset, int whence)\n{\n\tswitch (whence) {\n\tcase SEEK_SET:\n\t\tbrowser->top = browser->entries;\n\t\tbreak;\n\tcase SEEK_CUR:\n\t\tbrowser->top = (char **)browser->top + offset;\n\t\tbreak;\n\tcase SEEK_END:\n\t\tbrowser->top = (char **)browser->entries + browser->nr_entries - 1 + offset;\n\t\tbreak;\n\tdefault:\n\t\treturn;\n\t}\n\tassert((char **)browser->top < (char **)browser->entries + browser->nr_entries);\n\tassert((char **)browser->top >= (char **)browser->entries);\n}\n\nunsigned int ui_browser__argv_refresh(struct ui_browser *browser)\n{\n\tunsigned int row = 0, idx = browser->top_idx;\n\tchar **pos;\n\n\tif (browser->top == NULL)\n\t\tbrowser->top = browser->entries;\n\n\tpos = (char **)browser->top;\n\twhile (idx < browser->nr_entries &&\n\t       row < (unsigned)SLtt_Screen_Rows - 1) {\n\t\tassert(pos < (char **)browser->entries + browser->nr_entries);\n\t\tif (!browser->filter || !browser->filter(browser, *pos)) {\n\t\t\tui_browser__gotorc(browser, row, 0);\n\t\t\tbrowser->write(browser, pos, row);\n\t\t\tif (++row == browser->rows)\n\t\t\t\tbreak;\n\t\t}\n\n\t\t++idx;\n\t\t++pos;\n\t}\n\n\treturn row;\n}\n\nvoid __ui_browser__vline(struct ui_browser *browser, unsigned int column,\n\t\t\t u16 start, u16 end)\n{\n\tSLsmg_set_char_set(1);\n\tui_browser__gotorc(browser, start, column);\n\tSLsmg_draw_vline(end - start + 1);\n\tSLsmg_set_char_set(0);\n}\n\nvoid ui_browser__write_graph(struct ui_browser *browser __maybe_unused,\n\t\t\t     int graph)\n{\n\tSLsmg_set_char_set(1);\n\tSLsmg_write_char(graph);\n\tSLsmg_set_char_set(0);\n}\n\nstatic void __ui_browser__line_arrow_up(struct ui_browser *browser,\n\t\t\t\t\tunsigned int column,\n\t\t\t\t\tu64 start, u64 end)\n{\n\tunsigned int row, end_row;\n\n\tSLsmg_set_char_set(1);\n\n\tif (start < browser->top_idx + browser->rows) {\n\t\trow = start - browser->top_idx;\n\t\tui_browser__gotorc(browser, row, column);\n\t\tSLsmg_write_char(SLSMG_LLCORN_CHAR);\n\t\tui_browser__gotorc(browser, row, column + 1);\n\t\tSLsmg_draw_hline(2);\n\n\t\tif (row-- == 0)\n\t\t\tgoto out;\n\t} else\n\t\trow = browser->rows - 1;\n\n\tif (end > browser->top_idx)\n\t\tend_row = end - browser->top_idx;\n\telse\n\t\tend_row = 0;\n\n\tui_browser__gotorc(browser, end_row, column);\n\tSLsmg_draw_vline(row - end_row + 1);\n\n\tui_browser__gotorc(browser, end_row, column);\n\tif (end >= browser->top_idx) {\n\t\tSLsmg_write_char(SLSMG_ULCORN_CHAR);\n\t\tui_browser__gotorc(browser, end_row, column + 1);\n\t\tSLsmg_write_char(SLSMG_HLINE_CHAR);\n\t\tui_browser__gotorc(browser, end_row, column + 2);\n\t\tSLsmg_write_char(SLSMG_RARROW_CHAR);\n\t}\nout:\n\tSLsmg_set_char_set(0);\n}\n\nstatic void __ui_browser__line_arrow_down(struct ui_browser *browser,\n\t\t\t\t\t  unsigned int column,\n\t\t\t\t\t  u64 start, u64 end)\n{\n\tunsigned int row, end_row;\n\n\tSLsmg_set_char_set(1);\n\n\tif (start >= browser->top_idx) {\n\t\trow = start - browser->top_idx;\n\t\tui_browser__gotorc(browser, row, column);\n\t\tSLsmg_write_char(SLSMG_ULCORN_CHAR);\n\t\tui_browser__gotorc(browser, row, column + 1);\n\t\tSLsmg_draw_hline(2);\n\n\t\tif (++row == 0)\n\t\t\tgoto out;\n\t} else\n\t\trow = 0;\n\n\tif (end >= browser->top_idx + browser->rows)\n\t\tend_row = browser->rows - 1;\n\telse\n\t\tend_row = end - browser->top_idx;\n\n\tui_browser__gotorc(browser, row, column);\n\tSLsmg_draw_vline(end_row - row + 1);\n\n\tui_browser__gotorc(browser, end_row, column);\n\tif (end < browser->top_idx + browser->rows) {\n\t\tSLsmg_write_char(SLSMG_LLCORN_CHAR);\n\t\tui_browser__gotorc(browser, end_row, column + 1);\n\t\tSLsmg_write_char(SLSMG_HLINE_CHAR);\n\t\tui_browser__gotorc(browser, end_row, column + 2);\n\t\tSLsmg_write_char(SLSMG_RARROW_CHAR);\n\t}\nout:\n\tSLsmg_set_char_set(0);\n}\n\nvoid __ui_browser__line_arrow(struct ui_browser *browser, unsigned int column,\n\t\t\t      u64 start, u64 end)\n{\n\tif (start > end)\n\t\t__ui_browser__line_arrow_up(browser, column, start, end);\n\telse\n\t\t__ui_browser__line_arrow_down(browser, column, start, end);\n}\n\nvoid ui_browser__mark_fused(struct ui_browser *browser, unsigned int column,\n\t\t\t    unsigned int row, int diff, bool arrow_down)\n{\n\tint end_row;\n\n\tif (diff <= 0)\n\t\treturn;\n\n\tSLsmg_set_char_set(1);\n\n\tif (arrow_down) {\n\t\tif (row + diff <= browser->top_idx)\n\t\t\treturn;\n\n\t\tend_row = row + diff - browser->top_idx;\n\t\tui_browser__gotorc(browser, end_row, column - 1);\n\t\tSLsmg_write_char(SLSMG_LTEE_CHAR);\n\n\t\twhile (--end_row >= 0 && end_row > (int)(row - browser->top_idx)) {\n\t\t\tui_browser__gotorc(browser, end_row, column - 1);\n\t\t\tSLsmg_draw_vline(1);\n\t\t}\n\n\t\tend_row = (int)(row - browser->top_idx);\n\t\tif (end_row >= 0) {\n\t\t\tui_browser__gotorc(browser, end_row, column - 1);\n\t\t\tSLsmg_write_char(SLSMG_ULCORN_CHAR);\n\t\t\tui_browser__gotorc(browser, end_row, column);\n\t\t\tSLsmg_draw_hline(2);\n\t\t}\n\t} else {\n\t\tif (row < browser->top_idx)\n\t\t\treturn;\n\n\t\tend_row = row - browser->top_idx;\n\t\tui_browser__gotorc(browser, end_row, column - 1);\n\t\tSLsmg_write_char(SLSMG_LTEE_CHAR);\n\t\tui_browser__gotorc(browser, end_row, column);\n\t\tSLsmg_draw_hline(2);\n\t}\n\n\tSLsmg_set_char_set(0);\n}\n\nvoid ui_browser__init(void)\n{\n\tint i = 0;\n\n\tperf_config(ui_browser__color_config, NULL);\n\n\twhile (ui_browser__colorsets[i].name) {\n\t\tstruct ui_browser_colorset *c = &ui_browser__colorsets[i++];\n\t\tSLtt_set_color(c->colorset, c->name, c->fg, c->bg);\n\t}\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}