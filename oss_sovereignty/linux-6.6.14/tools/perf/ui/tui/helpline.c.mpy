{
  "module_name": "helpline.c",
  "hash_id": "ea6e5a22f6a6f4a3de3492ca954b47276166a04f63a9f34829d1d3f2bbc7f115",
  "original_prompt": "Ingested from linux-6.6.14/tools/perf/ui/tui/helpline.c",
  "human_readable_source": "\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <linux/kernel.h>\n#include <linux/string.h>\n\n#include \"../helpline.h\"\n#include \"../ui.h\"\n#include \"../libslang.h\"\n\nchar ui_helpline__last_msg[1024];\nbool tui_helpline__set;\n\nstatic void tui_helpline__pop(void)\n{\n}\n\nstatic void tui_helpline__push(const char *msg)\n{\n\tconst size_t sz = sizeof(ui_helpline__current);\n\n\tSLsmg_gotorc(SLtt_Screen_Rows - 1, 0);\n\tSLsmg_set_color(0);\n\tSLsmg_write_nstring(msg, SLtt_Screen_Cols);\n\tSLsmg_refresh();\n\tstrlcpy(ui_helpline__current, msg, sz);\n}\n\nstatic int tui_helpline__show(const char *format, va_list ap)\n{\n\tint ret;\n\tstatic int backlog;\n\n\tmutex_lock(&ui__lock);\n\tret = vscnprintf(ui_helpline__last_msg + backlog,\n\t\t\tsizeof(ui_helpline__last_msg) - backlog, format, ap);\n\tbacklog += ret;\n\n\ttui_helpline__set = true;\n\n\tif (ui_helpline__last_msg[backlog - 1] == '\\n') {\n\t\tui_helpline__puts(ui_helpline__last_msg);\n\t\tSLsmg_refresh();\n\t\tbacklog = 0;\n\t}\n\tmutex_unlock(&ui__lock);\n\n\treturn ret;\n}\n\nstruct ui_helpline tui_helpline_fns = {\n\t.pop\t= tui_helpline__pop,\n\t.push\t= tui_helpline__push,\n\t.show\t= tui_helpline__show,\n};\n\nvoid ui_helpline__init(void)\n{\n\thelpline_fns = &tui_helpline_fns;\n\tui_helpline__puts(\" \");\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}