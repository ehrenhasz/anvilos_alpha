{
  "module_name": "progress.c",
  "hash_id": "c66bf9541d04c339ce34d99fd8e023e4ca14785e8fafec7627dc9fd5a1653fa9",
  "original_prompt": "Ingested from linux-6.6.14/tools/perf/ui/tui/progress.c",
  "human_readable_source": "\n#include <linux/kernel.h>\n#include \"../progress.h\"\n#include \"../libslang.h\"\n#include \"../ui.h\"\n#include \"tui.h\"\n#include \"units.h\"\n#include \"../browser.h\"\n\nstatic void __tui_progress__init(struct ui_progress *p)\n{\n\tp->next = p->step = p->total / (SLtt_Screen_Cols - 2) ?: 1;\n}\n\nstatic int get_title(struct ui_progress *p, char *buf, size_t size)\n{\n\tchar buf_cur[20];\n\tchar buf_tot[20];\n\tint ret;\n\n\tret  = unit_number__scnprintf(buf_cur, sizeof(buf_cur), p->curr);\n\tret += unit_number__scnprintf(buf_tot, sizeof(buf_tot), p->total);\n\n\treturn ret + scnprintf(buf, size, \"%s [%s/%s]\",\n\t\t\t       p->title, buf_cur, buf_tot);\n}\n\nstatic void tui_progress__update(struct ui_progress *p)\n{\n\tchar buf[100], *title = (char *) p->title;\n\tint bar, y;\n\t \n\tif (use_browser <= 0)\n\t\treturn;\n\n\tif (p->total == 0)\n\t\treturn;\n\n\tif (p->size) {\n\t\tget_title(p, buf, sizeof(buf));\n\t\ttitle = buf;\n\t}\n\n\tui__refresh_dimensions(false);\n\tmutex_lock(&ui__lock);\n\ty = SLtt_Screen_Rows / 2 - 2;\n\tSLsmg_set_color(0);\n\tSLsmg_draw_box(y, 0, 3, SLtt_Screen_Cols);\n\tSLsmg_gotorc(y++, 1);\n\tSLsmg_write_string(title);\n\tSLsmg_fill_region(y, 1, 1, SLtt_Screen_Cols - 2, ' ');\n\tSLsmg_set_color(HE_COLORSET_SELECTED);\n\tbar = ((SLtt_Screen_Cols - 2) * p->curr) / p->total;\n\tSLsmg_fill_region(y, 1, 1, bar, ' ');\n\tSLsmg_refresh();\n\tmutex_unlock(&ui__lock);\n}\n\nstatic void tui_progress__finish(void)\n{\n\tint y;\n\n\tif (use_browser <= 0)\n\t\treturn;\n\n\tui__refresh_dimensions(false);\n\tmutex_lock(&ui__lock);\n\ty = SLtt_Screen_Rows / 2 - 2;\n\tSLsmg_set_color(0);\n\tSLsmg_fill_region(y, 0, 3, SLtt_Screen_Cols, ' ');\n\tSLsmg_refresh();\n\tmutex_unlock(&ui__lock);\n}\n\nstatic struct ui_progress_ops tui_progress__ops = {\n\t.init   = __tui_progress__init,\n\t.update = tui_progress__update,\n\t.finish = tui_progress__finish,\n};\n\nvoid tui_progress__init(void)\n{\n\tui_progress__ops = &tui_progress__ops;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}