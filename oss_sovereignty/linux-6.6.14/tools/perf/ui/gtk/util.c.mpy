{
  "module_name": "util.c",
  "hash_id": "a74d15584573fc2ca826f3e04e26933fff59f66647b0279f37b0d576cf682591",
  "original_prompt": "Ingested from linux-6.6.14/tools/perf/ui/gtk/util.c",
  "human_readable_source": "\n#include \"../util.h\"\n#include \"gtk.h\"\n\n#include <stdlib.h>\n#include <string.h>\n#include <linux/zalloc.h>\n\nstruct perf_gtk_context *pgctx;\n\nstruct perf_gtk_context *perf_gtk__activate_context(GtkWidget *window)\n{\n\tstruct perf_gtk_context *ctx;\n\n\tctx = malloc(sizeof(*pgctx));\n\tif (ctx)\n\t\tctx->main_window = window;\n\n\treturn ctx;\n}\n\nint perf_gtk__deactivate_context(struct perf_gtk_context **ctx)\n{\n\tif (!perf_gtk__is_active_context(*ctx))\n\t\treturn -1;\n\n\tzfree(ctx);\n\treturn 0;\n}\n\nstatic int perf_gtk__error(const char *format, va_list args)\n{\n\tchar *msg;\n\tGtkWidget *dialog;\n\n\tif (!perf_gtk__is_active_context(pgctx) ||\n\t    vasprintf(&msg, format, args) < 0) {\n\t\tfprintf(stderr, \"Error:\\n\");\n\t\tvfprintf(stderr, format, args);\n\t\tfprintf(stderr, \"\\n\");\n\t\treturn -1;\n\t}\n\n\tdialog = gtk_message_dialog_new_with_markup(GTK_WINDOW(pgctx->main_window),\n\t\t\t\t\tGTK_DIALOG_DESTROY_WITH_PARENT,\n\t\t\t\t\tGTK_MESSAGE_ERROR,\n\t\t\t\t\tGTK_BUTTONS_CLOSE,\n\t\t\t\t\t\"<b>Error</b>\\n\\n%s\", msg);\n\tgtk_dialog_run(GTK_DIALOG(dialog));\n\n\tgtk_widget_destroy(dialog);\n\tfree(msg);\n\treturn 0;\n}\n\n#ifdef HAVE_GTK_INFO_BAR_SUPPORT\nstatic int perf_gtk__warning_info_bar(const char *format, va_list args)\n{\n\tchar *msg;\n\n\tif (!perf_gtk__is_active_context(pgctx) ||\n\t    vasprintf(&msg, format, args) < 0) {\n\t\tfprintf(stderr, \"Warning:\\n\");\n\t\tvfprintf(stderr, format, args);\n\t\tfprintf(stderr, \"\\n\");\n\t\treturn -1;\n\t}\n\n\tgtk_label_set_text(GTK_LABEL(pgctx->message_label), msg);\n\tgtk_info_bar_set_message_type(GTK_INFO_BAR(pgctx->info_bar),\n\t\t\t\t      GTK_MESSAGE_WARNING);\n\tgtk_widget_show(pgctx->info_bar);\n\n\tfree(msg);\n\treturn 0;\n}\n#else\nstatic int perf_gtk__warning_statusbar(const char *format, va_list args)\n{\n\tchar *msg, *p;\n\n\tif (!perf_gtk__is_active_context(pgctx) ||\n\t    vasprintf(&msg, format, args) < 0) {\n\t\tfprintf(stderr, \"Warning:\\n\");\n\t\tvfprintf(stderr, format, args);\n\t\tfprintf(stderr, \"\\n\");\n\t\treturn -1;\n\t}\n\n\tgtk_statusbar_pop(GTK_STATUSBAR(pgctx->statbar),\n\t\t\t  pgctx->statbar_ctx_id);\n\n\t \n\tp = strchr(msg, '\\n');\n\tif (p)\n\t\t*p = '\\0';\n\n\tgtk_statusbar_push(GTK_STATUSBAR(pgctx->statbar),\n\t\t\t   pgctx->statbar_ctx_id, msg);\n\n\tfree(msg);\n\treturn 0;\n}\n#endif\n\nstruct perf_error_ops perf_gtk_eops = {\n\t.error\t\t= perf_gtk__error,\n#ifdef HAVE_GTK_INFO_BAR_SUPPORT\n\t.warning\t= perf_gtk__warning_info_bar,\n#else\n\t.warning\t= perf_gtk__warning_statusbar,\n#endif\n};\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}