{
  "module_name": "builtin-data.c",
  "hash_id": "268919b503aed9dc9c81614a0013b38024b89fe9f6f8c85ed5f99ea8f020d269",
  "original_prompt": "Ingested from linux-6.6.14/tools/perf/builtin-data.c",
  "human_readable_source": "\n#include <linux/compiler.h>\n#include <stdio.h>\n#include <string.h>\n#include \"builtin.h\"\n#include \"debug.h\"\n#include <subcmd/parse-options.h>\n#include \"data-convert.h\"\n#include \"util/util.h\"\n\ntypedef int (*data_cmd_fn_t)(int argc, const char **argv);\n\nstruct data_cmd {\n\tconst char\t*name;\n\tconst char\t*summary;\n\tdata_cmd_fn_t\tfn;\n};\n\nstatic struct data_cmd data_cmds[];\n\n#define for_each_cmd(cmd) \\\n\tfor (cmd = data_cmds; cmd && cmd->name; cmd++)\n\nstatic const char * const data_subcommands[] = { \"convert\", NULL };\n\nstatic const char *data_usage[] = {\n\t\"perf data convert [<options>]\",\n\tNULL\n};\n\nconst char *to_json;\nconst char *to_ctf;\nstruct perf_data_convert_opts opts = {\n\t.force = false,\n\t.all = false,\n};\n\nconst struct option data_options[] = {\n\t\tOPT_INCR('v', \"verbose\", &verbose, \"be more verbose\"),\n\t\tOPT_STRING('i', \"input\", &input_name, \"file\", \"input file name\"),\n\t\tOPT_STRING(0, \"to-json\", &to_json, NULL, \"Convert to JSON format\"),\n#ifdef HAVE_LIBBABELTRACE_SUPPORT\n\t\tOPT_STRING(0, \"to-ctf\", &to_ctf, NULL, \"Convert to CTF format\"),\n\t\tOPT_BOOLEAN(0, \"tod\", &opts.tod, \"Convert time to wall clock time\"),\n#endif\n\t\tOPT_BOOLEAN('f', \"force\", &opts.force, \"don't complain, do it\"),\n\t\tOPT_BOOLEAN(0, \"all\", &opts.all, \"Convert all events\"),\n\t\tOPT_END()\n\t};\n\nstatic int cmd_data_convert(int argc, const char **argv)\n{\n\n\targc = parse_options(argc, argv, data_options,\n\t\t\t     data_usage, 0);\n\tif (argc) {\n\t\tusage_with_options(data_usage, data_options);\n\t\treturn -1;\n\t}\n\n\tif (to_json && to_ctf) {\n\t\tpr_err(\"You cannot specify both --to-ctf and --to-json.\\n\");\n\t\treturn -1;\n\t}\n#ifdef HAVE_LIBBABELTRACE_SUPPORT\n\tif (!to_json && !to_ctf) {\n\t\tpr_err(\"You must specify one of --to-ctf or --to-json.\\n\");\n\t\treturn -1;\n\t}\n#else\n\tif (!to_json) {\n\t\tpr_err(\"You must specify --to-json.\\n\");\n\treturn -1;\n}\n#endif\n\n\tif (to_json)\n\t\treturn bt_convert__perf2json(input_name, to_json, &opts);\n\n\tif (to_ctf) {\n#if defined(HAVE_LIBBABELTRACE_SUPPORT) && defined(HAVE_LIBTRACEEVENT)\n\t\treturn bt_convert__perf2ctf(input_name, to_ctf, &opts);\n#else\n\t\tpr_err(\"The libbabeltrace support is not compiled in. perf should be \"\n\t\t       \"compiled with environment variables LIBBABELTRACE=1 and \"\n\t\t       \"LIBBABELTRACE_DIR=/path/to/libbabeltrace/.\\n\"\n\t\t       \"Check also if libbtraceevent devel files are available.\\n\");\n\t\treturn -1;\n#endif\n\t}\n\n\treturn 0;\n}\n\nstatic struct data_cmd data_cmds[] = {\n\t{ \"convert\", \"converts data file between formats\", cmd_data_convert },\n\t{ .name = NULL, },\n};\n\nint cmd_data(int argc, const char **argv)\n{\n\tstruct data_cmd *cmd;\n\tconst char *cmdstr;\n\n\targc = parse_options_subcommand(argc, argv, data_options, data_subcommands, data_usage,\n\t\t\t     PARSE_OPT_STOP_AT_NON_OPTION);\n\n\tif (!argc) {\n\t\tusage_with_options(data_usage, data_options);\n\t\treturn -1;\n\t}\n\n\tcmdstr = argv[0];\n\n\tfor_each_cmd(cmd) {\n\t\tif (strcmp(cmd->name, cmdstr))\n\t\t\tcontinue;\n\n\t\treturn cmd->fn(argc, argv);\n\t}\n\n\tpr_err(\"Unknown command: %s\\n\", cmdstr);\n\tusage_with_options(data_usage, data_options);\n\treturn -1;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}