{
  "module_name": "rw-by-pid.pl",
  "hash_id": "f2fa3d6a5a6f23a64d5f2753696bc2161fa70250c977c823922aabb31e7f25de",
  "original_prompt": "Ingested from linux-6.6.14/tools/perf/scripts/perl/rw-by-pid.pl",
  "human_readable_source": "#!/usr/bin/perl -w\n# SPDX-License-Identifier: GPL-2.0-only\n# (c) 2009, Tom Zanussi <tzanussi@gmail.com>\n\n# Display r/w activity for all processes\n\n# The common_* event handler fields are the most useful fields common to\n# all events.  They don't necessarily correspond to the 'common_*' fields\n# in the status files.  Those fields not available as handler params can\n# be retrieved via script functions of the form get_common_*().\n\nuse 5.010000;\nuse strict;\nuse warnings;\n\nuse lib \"$ENV{'PERF_EXEC_PATH'}/scripts/perl/Perf-Trace-Util/lib\";\nuse lib \"./Perf-Trace-Util/lib\";\nuse Perf::Trace::Core;\nuse Perf::Trace::Util;\n\nmy %reads;\nmy %writes;\n\nsub syscalls::sys_exit_read\n{\n    my ($event_name, $context, $common_cpu, $common_secs, $common_nsecs,\n\t$common_pid, $common_comm, $common_callchain,\n\t$nr, $ret) = @_;\n\n    if ($ret > 0) {\n\t$reads{$common_pid}{bytes_read} += $ret;\n    } else {\n\tif (!defined ($reads{$common_pid}{bytes_read})) {\n\t    $reads{$common_pid}{bytes_read} = 0;\n\t}\n\t$reads{$common_pid}{errors}{$ret}++;\n    }\n}\n\nsub syscalls::sys_enter_read\n{\n    my ($event_name, $context, $common_cpu, $common_secs, $common_nsecs,\n\t$common_pid, $common_comm, $common_callchain,\n\t$nr, $fd, $buf, $count) = @_;\n\n    $reads{$common_pid}{bytes_requested} += $count;\n    $reads{$common_pid}{total_reads}++;\n    $reads{$common_pid}{comm} = $common_comm;\n}\n\nsub syscalls::sys_exit_write\n{\n    my ($event_name, $context, $common_cpu, $common_secs, $common_nsecs,\n\t$common_pid, $common_comm, $common_callchain,\n\t$nr, $ret) = @_;\n\n    if ($ret <= 0) {\n\t$writes{$common_pid}{errors}{$ret}++;\n    }\n}\n\nsub syscalls::sys_enter_write\n{\n    my ($event_name, $context, $common_cpu, $common_secs, $common_nsecs,\n\t$common_pid, $common_comm, $common_callchain,\n\t$nr, $fd, $buf, $count) = @_;\n\n    $writes{$common_pid}{bytes_written} += $count;\n    $writes{$common_pid}{total_writes}++;\n    $writes{$common_pid}{comm} = $common_comm;\n}\n\nsub trace_end\n{\n    printf(\"read counts by pid:\\n\\n\");\n\n    printf(\"%6s  %20s  %10s  %10s  %10s\\n\", \"pid\", \"comm\",\n\t   \"# reads\", \"bytes_requested\", \"bytes_read\");\n    printf(\"%6s  %-20s  %10s  %10s  %10s\\n\", \"------\", \"--------------------\",\n\t   \"-----------\", \"----------\", \"----------\");\n\n    foreach my $pid (sort { ($reads{$b}{bytes_read} || 0) <=>\n\t\t\t\t($reads{$a}{bytes_read} || 0) } keys %reads) {\n\tmy $comm = $reads{$pid}{comm} || \"\";\n\tmy $total_reads = $reads{$pid}{total_reads} || 0;\n\tmy $bytes_requested = $reads{$pid}{bytes_requested} || 0;\n\tmy $bytes_read = $reads{$pid}{bytes_read} || 0;\n\n\tprintf(\"%6s  %-20s  %10s  %10s  %10s\\n\", $pid, $comm,\n\t       $total_reads, $bytes_requested, $bytes_read);\n    }\n\n    printf(\"\\nfailed reads by pid:\\n\\n\");\n\n    printf(\"%6s  %20s  %6s  %10s\\n\", \"pid\", \"comm\", \"error #\", \"# errors\");\n    printf(\"%6s  %20s  %6s  %10s\\n\", \"------\", \"--------------------\",\n\t   \"------\", \"----------\");\n\n    my @errcounts = ();\n\n    foreach my $pid (keys %reads) {\n\tforeach my $error (keys %{$reads{$pid}{errors}}) {\n\t    my $comm = $reads{$pid}{comm} || \"\";\n\t    my $errcount = $reads{$pid}{errors}{$error} || 0;\n\t    push @errcounts, [$pid, $comm, $error, $errcount];\n\t}\n    }\n\n    @errcounts = sort { $b->[3] <=> $a->[3] } @errcounts;\n\n    for my $i (0 .. $#errcounts) {\n\tprintf(\"%6d  %-20s  %6d  %10s\\n\", $errcounts[$i][0],\n\t       $errcounts[$i][1], $errcounts[$i][2], $errcounts[$i][3]);\n    }\n\n    printf(\"\\nwrite counts by pid:\\n\\n\");\n\n    printf(\"%6s  %20s  %10s  %10s\\n\", \"pid\", \"comm\",\n\t   \"# writes\", \"bytes_written\");\n    printf(\"%6s  %-20s  %10s  %10s\\n\", \"------\", \"--------------------\",\n\t   \"-----------\", \"----------\");\n\n    foreach my $pid (sort { ($writes{$b}{bytes_written} || 0) <=>\n\t\t\t($writes{$a}{bytes_written} || 0)} keys %writes) {\n\tmy $comm = $writes{$pid}{comm} || \"\";\n\tmy $total_writes = $writes{$pid}{total_writes} || 0;\n\tmy $bytes_written = $writes{$pid}{bytes_written} || 0;\n\n\tprintf(\"%6s  %-20s  %10s  %10s\\n\", $pid, $comm,\n\t       $total_writes, $bytes_written);\n    }\n\n    printf(\"\\nfailed writes by pid:\\n\\n\");\n\n    printf(\"%6s  %20s  %6s  %10s\\n\", \"pid\", \"comm\", \"error #\", \"# errors\");\n    printf(\"%6s  %20s  %6s  %10s\\n\", \"------\", \"--------------------\",\n\t   \"------\", \"----------\");\n\n    @errcounts = ();\n\n    foreach my $pid (keys %writes) {\n\tforeach my $error (keys %{$writes{$pid}{errors}}) {\n\t    my $comm = $writes{$pid}{comm} || \"\";\n\t    my $errcount = $writes{$pid}{errors}{$error} || 0;\n\t    push @errcounts, [$pid, $comm, $error, $errcount];\n\t}\n    }\n\n    @errcounts = sort { $b->[3] <=> $a->[3] } @errcounts;\n\n    for my $i (0 .. $#errcounts) {\n\tprintf(\"%6d  %-20s  %6d  %10s\\n\", $errcounts[$i][0],\n\t       $errcounts[$i][1], $errcounts[$i][2], $errcounts[$i][3]);\n    }\n\n    print_unhandled();\n}\n\nmy %unhandled;\n\nsub print_unhandled\n{\n    if ((scalar keys %unhandled) == 0) {\n\treturn;\n    }\n\n    print \"\\nunhandled events:\\n\\n\";\n\n    printf(\"%-40s  %10s\\n\", \"event\", \"count\");\n    printf(\"%-40s  %10s\\n\", \"----------------------------------------\",\n\t   \"-----------\");\n\n    foreach my $event_name (keys %unhandled) {\n\tprintf(\"%-40s  %10d\\n\", $event_name, $unhandled{$event_name});\n    }\n}\n\nsub trace_unhandled\n{\n    my ($event_name, $context, $common_cpu, $common_secs, $common_nsecs,\n\t$common_pid, $common_comm, $common_callchain) = @_;\n\n    $unhandled{$event_name}++;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}