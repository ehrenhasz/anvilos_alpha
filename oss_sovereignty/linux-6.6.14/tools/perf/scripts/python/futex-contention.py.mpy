{
  "module_name": "futex-contention.py",
  "hash_id": "531ae5474dd66bba813ca9f82b95b85d2925d76d18ebab3ef9a2adc49a7b83e7",
  "original_prompt": "Ingested from linux-6.6.14/tools/perf/scripts/python/futex-contention.py",
  "human_readable_source": "# futex contention\n# (c) 2010, Arnaldo Carvalho de Melo <acme@redhat.com>\n# Licensed under the terms of the GNU GPL License version 2\n#\n# Translation of:\n#\n# http://sourceware.org/systemtap/wiki/WSFutexContention\n#\n# to perf python scripting.\n#\n# Measures futex contention\n\nfrom __future__ import print_function\n\nimport os\nimport sys\nsys.path.append(os.environ['PERF_EXEC_PATH'] +\n                '/scripts/python/Perf-Trace-Util/lib/Perf/Trace')\nfrom Util import *\n\nprocess_names = {}\nthread_thislock = {}\nthread_blocktime = {}\n\nlock_waits = {}  # long-lived stats on (tid,lock) blockage elapsed time\nprocess_names = {}  # long-lived pid-to-execname mapping\n\n\ndef syscalls__sys_enter_futex(event, ctxt, cpu, s, ns, tid, comm, callchain,\n                              nr, uaddr, op, val, utime, uaddr2, val3):\n    cmd = op & FUTEX_CMD_MASK\n    if cmd != FUTEX_WAIT:\n        return  # we don't care about originators of WAKE events\n\n    process_names[tid] = comm\n    thread_thislock[tid] = uaddr\n    thread_blocktime[tid] = nsecs(s, ns)\n\n\ndef syscalls__sys_exit_futex(event, ctxt, cpu, s, ns, tid, comm, callchain,\n                             nr, ret):\n    if tid in thread_blocktime:\n        elapsed = nsecs(s, ns) - thread_blocktime[tid]\n        add_stats(lock_waits, (tid, thread_thislock[tid]), elapsed)\n        del thread_blocktime[tid]\n        del thread_thislock[tid]\n\n\ndef trace_begin():\n    print(\"Press control+C to stop and show the summary\")\n\n\ndef trace_end():\n    for (tid, lock) in lock_waits:\n        min, max, avg, count = lock_waits[tid, lock]\n        print(\"%s[%d] lock %x contended %d times, %d avg ns [max: %d ns, min %d ns]\" %\n              (process_names[tid], tid, lock, count, avg, max, min))\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}