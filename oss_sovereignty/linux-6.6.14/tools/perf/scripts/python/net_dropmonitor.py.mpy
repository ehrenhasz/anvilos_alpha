{
  "module_name": "net_dropmonitor.py",
  "hash_id": "00ff7af36ff05dce155192918aad0765fbf71d2dcf62c5fc3defe5ecdfa687c1",
  "original_prompt": "Ingested from linux-6.6.14/tools/perf/scripts/python/net_dropmonitor.py",
  "human_readable_source": "# Monitor the system for dropped packets and proudce a report of drop locations and counts\n# SPDX-License-Identifier: GPL-2.0\n\nfrom __future__ import print_function\n\nimport os\nimport sys\n\nsys.path.append(os.environ['PERF_EXEC_PATH'] + \\\n\t'/scripts/python/Perf-Trace-Util/lib/Perf/Trace')\n\nfrom perf_trace_context import *\nfrom Core import *\nfrom Util import *\n\ndrop_log = {}\nkallsyms = []\n\ndef get_kallsyms_table():\n\tglobal kallsyms\n\n\ttry:\n\t\tf = open(\"/proc/kallsyms\", \"r\")\n\texcept:\n\t\treturn\n\n\tfor line in f:\n\t\tloc = int(line.split()[0], 16)\n\t\tname = line.split()[2]\n\t\tkallsyms.append((loc, name))\n\tkallsyms.sort()\n\ndef get_sym(sloc):\n\tloc = int(sloc)\n\n\t# Invariant: kallsyms[i][0] <= loc for all 0 <= i <= start\n\t#            kallsyms[i][0] > loc for all end <= i < len(kallsyms)\n\tstart, end = -1, len(kallsyms)\n\twhile end != start + 1:\n\t\tpivot = (start + end) // 2\n\t\tif loc < kallsyms[pivot][0]:\n\t\t\tend = pivot\n\t\telse:\n\t\t\tstart = pivot\n\n\t# Now (start == -1 or kallsyms[start][0] <= loc)\n\t# and (start == len(kallsyms) - 1 or loc < kallsyms[start + 1][0])\n\tif start >= 0:\n\t\tsymloc, name = kallsyms[start]\n\t\treturn (name, loc - symloc)\n\telse:\n\t\treturn (None, 0)\n\ndef print_drop_table():\n\tprint(\"%25s %25s %25s\" % (\"LOCATION\", \"OFFSET\", \"COUNT\"))\n\tfor i in drop_log.keys():\n\t\t(sym, off) = get_sym(i)\n\t\tif sym == None:\n\t\t\tsym = i\n\t\tprint(\"%25s %25s %25s\" % (sym, off, drop_log[i]))\n\n\ndef trace_begin():\n\tprint(\"Starting trace (Ctrl-C to dump results)\")\n\ndef trace_end():\n\tprint(\"Gathering kallsyms data\")\n\tget_kallsyms_table()\n\tprint_drop_table()\n\n# called from perf, when it finds a corresponding event\ndef skb__kfree_skb(name, context, cpu, sec, nsec, pid, comm, callchain,\n\t\t   skbaddr, location, protocol, reason):\n\tslocation = str(location)\n\ttry:\n\t\tdrop_log[slocation] = drop_log[slocation] + 1\n\texcept:\n\t\tdrop_log[slocation] = 1\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}