{
  "module_name": "EventClass.py",
  "hash_id": "fbf0e8dac328ac678b10c0c24151a3f7f7e62fb7c74a9cf7a1f352b9d513de5e",
  "original_prompt": "Ingested from linux-6.6.14/tools/perf/scripts/python/Perf-Trace-Util/lib/Perf/Trace/EventClass.py",
  "human_readable_source": "# EventClass.py\n# SPDX-License-Identifier: GPL-2.0\n#\n# This is a library defining some events types classes, which could\n# be used by other scripts to analyzing the perf samples.\n#\n# Currently there are just a few classes defined for examples,\n# PerfEvent is the base class for all perf event sample, PebsEvent\n# is a HW base Intel x86 PEBS event, and user could add more SW/HW\n# event classes based on requirements.\nfrom __future__ import print_function\n\nimport struct\n\n# Event types, user could add more here\nEVTYPE_GENERIC  = 0\nEVTYPE_PEBS     = 1     # Basic PEBS event\nEVTYPE_PEBS_LL  = 2     # PEBS event with load latency info\nEVTYPE_IBS      = 3\n\n#\n# Currently we don't have good way to tell the event type, but by\n# the size of raw buffer, raw PEBS event with load latency data's\n# size is 176 bytes, while the pure PEBS event's size is 144 bytes.\n#\ndef create_event(name, comm, dso, symbol, raw_buf):\n        if (len(raw_buf) == 144):\n                event = PebsEvent(name, comm, dso, symbol, raw_buf)\n        elif (len(raw_buf) == 176):\n                event = PebsNHM(name, comm, dso, symbol, raw_buf)\n        else:\n                event = PerfEvent(name, comm, dso, symbol, raw_buf)\n\n        return event\n\nclass PerfEvent(object):\n        event_num = 0\n        def __init__(self, name, comm, dso, symbol, raw_buf, ev_type=EVTYPE_GENERIC):\n                self.name       = name\n                self.comm       = comm\n                self.dso        = dso\n                self.symbol     = symbol\n                self.raw_buf    = raw_buf\n                self.ev_type    = ev_type\n                PerfEvent.event_num += 1\n\n        def show(self):\n                print(\"PMU event: name=%12s, symbol=%24s, comm=%8s, dso=%12s\" %\n                      (self.name, self.symbol, self.comm, self.dso))\n\n#\n# Basic Intel PEBS (Precise Event-based Sampling) event, whose raw buffer\n# contains the context info when that event happened: the EFLAGS and\n# linear IP info, as well as all the registers.\n#\nclass PebsEvent(PerfEvent):\n        pebs_num = 0\n        def __init__(self, name, comm, dso, symbol, raw_buf, ev_type=EVTYPE_PEBS):\n                tmp_buf=raw_buf[0:80]\n                flags, ip, ax, bx, cx, dx, si, di, bp, sp = struct.unpack('QQQQQQQQQQ', tmp_buf)\n                self.flags = flags\n                self.ip    = ip\n                self.ax    = ax\n                self.bx    = bx\n                self.cx    = cx\n                self.dx    = dx\n                self.si    = si\n                self.di    = di\n                self.bp    = bp\n                self.sp    = sp\n\n                PerfEvent.__init__(self, name, comm, dso, symbol, raw_buf, ev_type)\n                PebsEvent.pebs_num += 1\n                del tmp_buf\n\n#\n# Intel Nehalem and Westmere support PEBS plus Load Latency info which lie\n# in the four 64 bit words write after the PEBS data:\n#       Status: records the IA32_PERF_GLOBAL_STATUS register value\n#       DLA:    Data Linear Address (EIP)\n#       DSE:    Data Source Encoding, where the latency happens, hit or miss\n#               in L1/L2/L3 or IO operations\n#       LAT:    the actual latency in cycles\n#\nclass PebsNHM(PebsEvent):\n        pebs_nhm_num = 0\n        def __init__(self, name, comm, dso, symbol, raw_buf, ev_type=EVTYPE_PEBS_LL):\n                tmp_buf=raw_buf[144:176]\n                status, dla, dse, lat = struct.unpack('QQQQ', tmp_buf)\n                self.status = status\n                self.dla = dla\n                self.dse = dse\n                self.lat = lat\n\n                PebsEvent.__init__(self, name, comm, dso, symbol, raw_buf, ev_type)\n                PebsNHM.pebs_nhm_num += 1\n                del tmp_buf\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}