{
  "module_name": "powerpc-hcalls.py",
  "hash_id": "775c32ee190ef9200a007d57d766b0906da04c934e69cc08bca01b2bfc8f076c",
  "original_prompt": "Ingested from linux-6.6.14/tools/perf/scripts/python/powerpc-hcalls.py",
  "human_readable_source": "# SPDX-License-Identifier: GPL-2.0+\n#\n# Copyright (C) 2018 Ravi Bangoria, IBM Corporation\n#\n# Hypervisor call statisics\n\nfrom __future__ import print_function\n\nimport os\nimport sys\n\nsys.path.append(os.environ['PERF_EXEC_PATH'] + \\\n\t'/scripts/python/Perf-Trace-Util/lib/Perf/Trace')\n\nfrom perf_trace_context import *\nfrom Core import *\nfrom Util import *\n\n# output: {\n#\topcode: {\n#\t\t'min': minimum time nsec\n#\t\t'max': maximum time nsec\n#\t\t'time': average time nsec\n#\t\t'cnt': counter\n#\t} ...\n# }\noutput = {}\n\n# d_enter: {\n#\tcpu: {\n#\t\topcode: nsec\n#\t} ...\n# }\nd_enter = {}\n\nhcall_table = {\n\t4: 'H_REMOVE',\n\t8: 'H_ENTER',\n\t12: 'H_READ',\n\t16: 'H_CLEAR_MOD',\n\t20: 'H_CLEAR_REF',\n\t24: 'H_PROTECT',\n\t28: 'H_GET_TCE',\n\t32: 'H_PUT_TCE',\n\t36: 'H_SET_SPRG0',\n\t40: 'H_SET_DABR',\n\t44: 'H_PAGE_INIT',\n\t48: 'H_SET_ASR',\n\t52: 'H_ASR_ON',\n\t56: 'H_ASR_OFF',\n\t60: 'H_LOGICAL_CI_LOAD',\n\t64: 'H_LOGICAL_CI_STORE',\n\t68: 'H_LOGICAL_CACHE_LOAD',\n\t72: 'H_LOGICAL_CACHE_STORE',\n\t76: 'H_LOGICAL_ICBI',\n\t80: 'H_LOGICAL_DCBF',\n\t84: 'H_GET_TERM_CHAR',\n\t88: 'H_PUT_TERM_CHAR',\n\t92: 'H_REAL_TO_LOGICAL',\n\t96: 'H_HYPERVISOR_DATA',\n\t100: 'H_EOI',\n\t104: 'H_CPPR',\n\t108: 'H_IPI',\n\t112: 'H_IPOLL',\n\t116: 'H_XIRR',\n\t120: 'H_MIGRATE_DMA',\n\t124: 'H_PERFMON',\n\t220: 'H_REGISTER_VPA',\n\t224: 'H_CEDE',\n\t228: 'H_CONFER',\n\t232: 'H_PROD',\n\t236: 'H_GET_PPP',\n\t240: 'H_SET_PPP',\n\t244: 'H_PURR',\n\t248: 'H_PIC',\n\t252: 'H_REG_CRQ',\n\t256: 'H_FREE_CRQ',\n\t260: 'H_VIO_SIGNAL',\n\t264: 'H_SEND_CRQ',\n\t272: 'H_COPY_RDMA',\n\t276: 'H_REGISTER_LOGICAL_LAN',\n\t280: 'H_FREE_LOGICAL_LAN',\n\t284: 'H_ADD_LOGICAL_LAN_BUFFER',\n\t288: 'H_SEND_LOGICAL_LAN',\n\t292: 'H_BULK_REMOVE',\n\t304: 'H_MULTICAST_CTRL',\n\t308: 'H_SET_XDABR',\n\t312: 'H_STUFF_TCE',\n\t316: 'H_PUT_TCE_INDIRECT',\n\t332: 'H_CHANGE_LOGICAL_LAN_MAC',\n\t336: 'H_VTERM_PARTNER_INFO',\n\t340: 'H_REGISTER_VTERM',\n\t344: 'H_FREE_VTERM',\n\t348: 'H_RESET_EVENTS',\n\t352: 'H_ALLOC_RESOURCE',\n\t356: 'H_FREE_RESOURCE',\n\t360: 'H_MODIFY_QP',\n\t364: 'H_QUERY_QP',\n\t368: 'H_REREGISTER_PMR',\n\t372: 'H_REGISTER_SMR',\n\t376: 'H_QUERY_MR',\n\t380: 'H_QUERY_MW',\n\t384: 'H_QUERY_HCA',\n\t388: 'H_QUERY_PORT',\n\t392: 'H_MODIFY_PORT',\n\t396: 'H_DEFINE_AQP1',\n\t400: 'H_GET_TRACE_BUFFER',\n\t404: 'H_DEFINE_AQP0',\n\t408: 'H_RESIZE_MR',\n\t412: 'H_ATTACH_MCQP',\n\t416: 'H_DETACH_MCQP',\n\t420: 'H_CREATE_RPT',\n\t424: 'H_REMOVE_RPT',\n\t428: 'H_REGISTER_RPAGES',\n\t432: 'H_DISABLE_AND_GETC',\n\t436: 'H_ERROR_DATA',\n\t440: 'H_GET_HCA_INFO',\n\t444: 'H_GET_PERF_COUNT',\n\t448: 'H_MANAGE_TRACE',\n\t468: 'H_FREE_LOGICAL_LAN_BUFFER',\n\t472: 'H_POLL_PENDING',\n\t484: 'H_QUERY_INT_STATE',\n\t580: 'H_ILLAN_ATTRIBUTES',\n\t592: 'H_MODIFY_HEA_QP',\n\t596: 'H_QUERY_HEA_QP',\n\t600: 'H_QUERY_HEA',\n\t604: 'H_QUERY_HEA_PORT',\n\t608: 'H_MODIFY_HEA_PORT',\n\t612: 'H_REG_BCMC',\n\t616: 'H_DEREG_BCMC',\n\t620: 'H_REGISTER_HEA_RPAGES',\n\t624: 'H_DISABLE_AND_GET_HEA',\n\t628: 'H_GET_HEA_INFO',\n\t632: 'H_ALLOC_HEA_RESOURCE',\n\t644: 'H_ADD_CONN',\n\t648: 'H_DEL_CONN',\n\t664: 'H_JOIN',\n\t676: 'H_VASI_STATE',\n\t688: 'H_ENABLE_CRQ',\n\t696: 'H_GET_EM_PARMS',\n\t720: 'H_SET_MPP',\n\t724: 'H_GET_MPP',\n\t748: 'H_HOME_NODE_ASSOCIATIVITY',\n\t756: 'H_BEST_ENERGY',\n\t764: 'H_XIRR_X',\n\t768: 'H_RANDOM',\n\t772: 'H_COP',\n\t788: 'H_GET_MPP_X',\n\t796: 'H_SET_MODE',\n\t61440: 'H_RTAS',\n}\n\ndef hcall_table_lookup(opcode):\n\tif (opcode in hcall_table):\n\t\treturn hcall_table[opcode]\n\telse:\n\t\treturn opcode\n\nprint_ptrn = '%-28s%10s%10s%10s%10s'\n\ndef trace_end():\n\tprint(print_ptrn % ('hcall', 'count', 'min(ns)', 'max(ns)', 'avg(ns)'))\n\tprint('-' * 68)\n\tfor opcode in output:\n\t\th_name = hcall_table_lookup(opcode)\n\t\ttime = output[opcode]['time']\n\t\tcnt = output[opcode]['cnt']\n\t\tmin_t = output[opcode]['min']\n\t\tmax_t = output[opcode]['max']\n\n\t\tprint(print_ptrn % (h_name, cnt, min_t, max_t, time//cnt))\n\ndef powerpc__hcall_exit(name, context, cpu, sec, nsec, pid, comm, callchain,\n\t\t\topcode, retval):\n\tif (cpu in d_enter and opcode in d_enter[cpu]):\n\t\tdiff = nsecs(sec, nsec) - d_enter[cpu][opcode]\n\n\t\tif (opcode in output):\n\t\t\toutput[opcode]['time'] += diff\n\t\t\toutput[opcode]['cnt'] += 1\n\t\t\tif (output[opcode]['min'] > diff):\n\t\t\t\toutput[opcode]['min'] = diff\n\t\t\tif (output[opcode]['max'] < diff):\n\t\t\t\toutput[opcode]['max'] = diff\n\t\telse:\n\t\t\toutput[opcode] = {\n\t\t\t\t'time': diff,\n\t\t\t\t'cnt': 1,\n\t\t\t\t'min': diff,\n\t\t\t\t'max': diff,\n\t\t\t}\n\n\t\tdel d_enter[cpu][opcode]\n#\telse:\n#\t\tprint(\"Can't find matching hcall_enter event. Ignoring sample\")\n\ndef powerpc__hcall_entry(event_name, context, cpu, sec, nsec, pid, comm,\n\t\t\t callchain, opcode):\n\t\tif (cpu in d_enter):\n\t\t\td_enter[cpu][opcode] = nsecs(sec, nsec)\n\t\telse:\n\t\t\td_enter[cpu] = {opcode: nsecs(sec, nsec)}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}