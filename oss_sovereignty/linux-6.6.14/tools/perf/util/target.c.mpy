{
  "module_name": "target.c",
  "hash_id": "5d3843369e67a02322e8b699071ddfe9c43d43a8950e7def9b5bbd4f6a385fa1",
  "original_prompt": "Ingested from linux-6.6.14/tools/perf/util/target.c",
  "human_readable_source": "\n \n\n#include \"target.h\"\n\n#include <pwd.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <linux/kernel.h>\n#include <linux/string.h>\n\nenum target_errno target__validate(struct target *target)\n{\n\tenum target_errno ret = TARGET_ERRNO__SUCCESS;\n\n\tif (target->pid)\n\t\ttarget->tid = target->pid;\n\n\t \n\tif (target->tid && target->cpu_list) {\n\t\ttarget->cpu_list = NULL;\n\t\tif (ret == TARGET_ERRNO__SUCCESS)\n\t\t\tret = TARGET_ERRNO__PID_OVERRIDE_CPU;\n\t}\n\n\t \n\tif (target->tid && target->uid_str) {\n\t\ttarget->uid_str = NULL;\n\t\tif (ret == TARGET_ERRNO__SUCCESS)\n\t\t\tret = TARGET_ERRNO__PID_OVERRIDE_UID;\n\t}\n\n\t \n\tif (target->uid_str && target->cpu_list) {\n\t\ttarget->cpu_list = NULL;\n\t\tif (ret == TARGET_ERRNO__SUCCESS)\n\t\t\tret = TARGET_ERRNO__UID_OVERRIDE_CPU;\n\t}\n\n\t \n\tif (target->tid && target->system_wide) {\n\t\ttarget->system_wide = false;\n\t\tif (ret == TARGET_ERRNO__SUCCESS)\n\t\t\tret = TARGET_ERRNO__PID_OVERRIDE_SYSTEM;\n\t}\n\n\t \n\tif (target->uid_str && target->system_wide) {\n\t\ttarget->system_wide = false;\n\t\tif (ret == TARGET_ERRNO__SUCCESS)\n\t\t\tret = TARGET_ERRNO__UID_OVERRIDE_SYSTEM;\n\t}\n\n\t \n\tif (target->bpf_str && target->cpu_list) {\n\t\ttarget->cpu_list = NULL;\n\t\tif (ret == TARGET_ERRNO__SUCCESS)\n\t\t\tret = TARGET_ERRNO__BPF_OVERRIDE_CPU;\n\t}\n\n\t \n\tif (target->bpf_str && target->tid) {\n\t\ttarget->tid = NULL;\n\t\tif (ret == TARGET_ERRNO__SUCCESS)\n\t\t\tret = TARGET_ERRNO__BPF_OVERRIDE_PID;\n\t}\n\n\t \n\tif (target->bpf_str && target->uid_str) {\n\t\ttarget->uid_str = NULL;\n\t\tif (ret == TARGET_ERRNO__SUCCESS)\n\t\t\tret = TARGET_ERRNO__BPF_OVERRIDE_UID;\n\t}\n\n\t \n\tif (target->bpf_str && target->per_thread) {\n\t\ttarget->per_thread = false;\n\t\tif (ret == TARGET_ERRNO__SUCCESS)\n\t\t\tret = TARGET_ERRNO__BPF_OVERRIDE_THREAD;\n\t}\n\n\t \n\tif (target->per_thread && (target->system_wide || target->cpu_list)) {\n\t\ttarget->per_thread = false;\n\t\tif (ret == TARGET_ERRNO__SUCCESS)\n\t\t\tret = TARGET_ERRNO__SYSTEM_OVERRIDE_THREAD;\n\t}\n\n\treturn ret;\n}\n\nenum target_errno target__parse_uid(struct target *target)\n{\n\tstruct passwd pwd, *result;\n\tchar buf[1024];\n\tconst char *str = target->uid_str;\n\n\ttarget->uid = UINT_MAX;\n\tif (str == NULL)\n\t\treturn TARGET_ERRNO__SUCCESS;\n\n\t \n\tgetpwnam_r(str, &pwd, buf, sizeof(buf), &result);\n\n\tif (result == NULL) {\n\t\t \n\t\tchar *endptr;\n\t\tint uid = strtol(str, &endptr, 10);\n\n\t\tif (*endptr != '\\0')\n\t\t\treturn TARGET_ERRNO__INVALID_UID;\n\n\t\tgetpwuid_r(uid, &pwd, buf, sizeof(buf), &result);\n\n\t\tif (result == NULL)\n\t\t\treturn TARGET_ERRNO__USER_NOT_FOUND;\n\t}\n\n\ttarget->uid = result->pw_uid;\n\treturn TARGET_ERRNO__SUCCESS;\n}\n\n \nstatic const char *target__error_str[] = {\n\t\"PID/TID switch overriding CPU\",\n\t\"PID/TID switch overriding UID\",\n\t\"UID switch overriding CPU\",\n\t\"PID/TID switch overriding SYSTEM\",\n\t\"UID switch overriding SYSTEM\",\n\t\"SYSTEM/CPU switch overriding PER-THREAD\",\n\t\"BPF switch overriding CPU\",\n\t\"BPF switch overriding PID/TID\",\n\t\"BPF switch overriding UID\",\n\t\"BPF switch overriding THREAD\",\n\t\"Invalid User: %s\",\n\t\"Problems obtaining information for user %s\",\n};\n\nint target__strerror(struct target *target, int errnum,\n\t\t\t  char *buf, size_t buflen)\n{\n\tint idx;\n\tconst char *msg;\n\n\tBUG_ON(buflen == 0);\n\n\tif (errnum >= 0) {\n\t\tstr_error_r(errnum, buf, buflen);\n\t\treturn 0;\n\t}\n\n\tif (errnum <  __TARGET_ERRNO__START || errnum >= __TARGET_ERRNO__END)\n\t\treturn -1;\n\n\tidx = errnum - __TARGET_ERRNO__START;\n\tmsg = target__error_str[idx];\n\n\tswitch (errnum) {\n\tcase TARGET_ERRNO__PID_OVERRIDE_CPU ...\n\t     TARGET_ERRNO__BPF_OVERRIDE_THREAD:\n\t\tsnprintf(buf, buflen, \"%s\", msg);\n\t\tbreak;\n\n\tcase TARGET_ERRNO__INVALID_UID:\n\tcase TARGET_ERRNO__USER_NOT_FOUND:\n\t\tsnprintf(buf, buflen, msg, target->uid_str);\n\t\tbreak;\n\n\tdefault:\n\t\t \n\t\tbreak;\n\t}\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}