{
  "module_name": "mutex.c",
  "hash_id": "1628172080c0a2939e97114b22e8e13b92c96803dd0fae810c5d53fbeb3d33fd",
  "original_prompt": "Ingested from linux-6.6.14/tools/perf/util/mutex.c",
  "human_readable_source": "\n#include \"mutex.h\"\n\n#include \"debug.h\"\n#include <linux/string.h>\n#include <errno.h>\n\nstatic void check_err(const char *fn, int err)\n{\n\tchar sbuf[STRERR_BUFSIZE];\n\n\tif (err == 0)\n\t\treturn;\n\n\tpr_err(\"%s error: '%s'\\n\", fn, str_error_r(err, sbuf, sizeof(sbuf)));\n}\n\n#define CHECK_ERR(err) check_err(__func__, err)\n\nstatic void __mutex_init(struct mutex *mtx, bool pshared)\n{\n\tpthread_mutexattr_t attr;\n\n\tCHECK_ERR(pthread_mutexattr_init(&attr));\n\n#ifndef NDEBUG\n\t \n\tCHECK_ERR(pthread_mutexattr_settype(&attr, PTHREAD_MUTEX_ERRORCHECK));\n#endif\n\tif (pshared)\n\t\tCHECK_ERR(pthread_mutexattr_setpshared(&attr, PTHREAD_PROCESS_SHARED));\n\n\tCHECK_ERR(pthread_mutex_init(&mtx->lock, &attr));\n\tCHECK_ERR(pthread_mutexattr_destroy(&attr));\n}\n\nvoid mutex_init(struct mutex *mtx)\n{\n\t__mutex_init(mtx,  false);\n}\n\nvoid mutex_init_pshared(struct mutex *mtx)\n{\n\t__mutex_init(mtx,  true);\n}\n\nvoid mutex_destroy(struct mutex *mtx)\n{\n\tCHECK_ERR(pthread_mutex_destroy(&mtx->lock));\n}\n\nvoid mutex_lock(struct mutex *mtx)\n\tNO_THREAD_SAFETY_ANALYSIS\n{\n\tCHECK_ERR(pthread_mutex_lock(&mtx->lock));\n}\n\nvoid mutex_unlock(struct mutex *mtx)\n\tNO_THREAD_SAFETY_ANALYSIS\n{\n\tCHECK_ERR(pthread_mutex_unlock(&mtx->lock));\n}\n\nbool mutex_trylock(struct mutex *mtx)\n{\n\tint ret = pthread_mutex_trylock(&mtx->lock);\n\n\tif (ret == 0)\n\t\treturn true;  \n\n\tif (ret == EBUSY)\n\t\treturn false;  \n\n\t \n\tCHECK_ERR(ret);\n\treturn false;\n}\n\nstatic void __cond_init(struct cond *cnd, bool pshared)\n{\n\tpthread_condattr_t attr;\n\n\tCHECK_ERR(pthread_condattr_init(&attr));\n\tif (pshared)\n\t\tCHECK_ERR(pthread_condattr_setpshared(&attr, PTHREAD_PROCESS_SHARED));\n\n\tCHECK_ERR(pthread_cond_init(&cnd->cond, &attr));\n\tCHECK_ERR(pthread_condattr_destroy(&attr));\n}\n\nvoid cond_init(struct cond *cnd)\n{\n\t__cond_init(cnd,  false);\n}\n\nvoid cond_init_pshared(struct cond *cnd)\n{\n\t__cond_init(cnd,  true);\n}\n\nvoid cond_destroy(struct cond *cnd)\n{\n\tCHECK_ERR(pthread_cond_destroy(&cnd->cond));\n}\n\nvoid cond_wait(struct cond *cnd, struct mutex *mtx)\n{\n\tCHECK_ERR(pthread_cond_wait(&cnd->cond, &mtx->lock));\n}\n\nvoid cond_signal(struct cond *cnd)\n{\n\tCHECK_ERR(pthread_cond_signal(&cnd->cond));\n}\n\nvoid cond_broadcast(struct cond *cnd)\n{\n\tCHECK_ERR(pthread_cond_broadcast(&cnd->cond));\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}