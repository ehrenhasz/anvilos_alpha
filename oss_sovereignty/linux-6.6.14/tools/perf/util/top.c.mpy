{
  "module_name": "top.c",
  "hash_id": "7ee6af7be01e49c9d0866a6a689d7b4347cf87ac2cebf91e698d4d547d14d61a",
  "original_prompt": "Ingested from linux-6.6.14/tools/perf/util/top.c",
  "human_readable_source": "\n \n\n#include \"event.h\"\n#include \"evlist.h\"\n#include \"evsel.h\"\n#include \"parse-events.h\"\n#include \"symbol.h\"\n#include \"top.h\"\n#include \"util.h\"\n#include <inttypes.h>\n\n#define SNPRINTF(buf, size, fmt, args...) \\\n({ \\\n\tsize_t r = snprintf(buf, size, fmt, ## args); \\\n\tr > size ?  size : r; \\\n})\n\nsize_t perf_top__header_snprintf(struct perf_top *top, char *bf, size_t size)\n{\n\tfloat samples_per_sec;\n\tfloat ksamples_per_sec;\n\tfloat esamples_percent;\n\tstruct record_opts *opts = &top->record_opts;\n\tstruct target *target = &opts->target;\n\tsize_t ret = 0;\n\n\tif (top->samples) {\n\t\tsamples_per_sec = top->samples / top->delay_secs;\n\t\tksamples_per_sec = top->kernel_samples / top->delay_secs;\n\t\tesamples_percent = (100.0 * top->exact_samples) / top->samples;\n\t} else {\n\t\tsamples_per_sec = ksamples_per_sec = esamples_percent = 0.0;\n\t}\n\n\tif (!perf_guest) {\n\t\tfloat ksamples_percent = 0.0;\n\n\t\tif (samples_per_sec)\n\t\t\tksamples_percent = (100.0 * ksamples_per_sec) /\n\t\t\t\t\t\t\tsamples_per_sec;\n\t\tret = SNPRINTF(bf, size,\n\t\t\t       \"   PerfTop:%8.0f irqs/sec  kernel:%4.1f%%\"\n\t\t\t       \"  exact: %4.1f%% lost: %\" PRIu64 \"/%\" PRIu64 \" drop: %\" PRIu64 \"/%\" PRIu64 \" [\",\n\t\t\t       samples_per_sec, ksamples_percent, esamples_percent,\n\t\t\t       top->lost, top->lost_total, top->drop, top->drop_total);\n\t} else {\n\t\tfloat us_samples_per_sec = top->us_samples / top->delay_secs;\n\t\tfloat guest_kernel_samples_per_sec = top->guest_kernel_samples / top->delay_secs;\n\t\tfloat guest_us_samples_per_sec = top->guest_us_samples / top->delay_secs;\n\n\t\tret = SNPRINTF(bf, size,\n\t\t\t       \"   PerfTop:%8.0f irqs/sec  kernel:%4.1f%% us:%4.1f%%\"\n\t\t\t       \" guest kernel:%4.1f%% guest us:%4.1f%%\"\n\t\t\t       \" exact: %4.1f%% [\", samples_per_sec,\n\t\t\t       100.0 - (100.0 * ((samples_per_sec - ksamples_per_sec) /\n\t\t\t\t\t\t samples_per_sec)),\n\t\t\t       100.0 - (100.0 * ((samples_per_sec - us_samples_per_sec) /\n\t\t\t\t\t\t samples_per_sec)),\n\t\t\t       100.0 - (100.0 * ((samples_per_sec -\n\t\t\t\t\t\t  guest_kernel_samples_per_sec) /\n\t\t\t\t\t\t samples_per_sec)),\n\t\t\t       100.0 - (100.0 * ((samples_per_sec -\n\t\t\t\t\t\t  guest_us_samples_per_sec) /\n\t\t\t\t\t\t samples_per_sec)),\n\t\t\t       esamples_percent);\n\t}\n\n\tif (top->evlist->core.nr_entries == 1) {\n\t\tstruct evsel *first = evlist__first(top->evlist);\n\t\tret += SNPRINTF(bf + ret, size - ret, \"%\" PRIu64 \"%s \",\n\t\t\t\t(uint64_t)first->core.attr.sample_period,\n\t\t\t\topts->freq ? \"Hz\" : \"\");\n\t}\n\n\tret += SNPRINTF(bf + ret, size - ret, \"%s\", evsel__name(top->sym_evsel));\n\n\tret += SNPRINTF(bf + ret, size - ret, \"], \");\n\n\tif (target->pid)\n\t\tret += SNPRINTF(bf + ret, size - ret, \" (target_pid: %s\",\n\t\t\t\ttarget->pid);\n\telse if (target->tid)\n\t\tret += SNPRINTF(bf + ret, size - ret, \" (target_tid: %s\",\n\t\t\t\ttarget->tid);\n\telse if (target->uid_str != NULL)\n\t\tret += SNPRINTF(bf + ret, size - ret, \" (uid: %s\",\n\t\t\t\ttarget->uid_str);\n\telse\n\t\tret += SNPRINTF(bf + ret, size - ret, \" (all\");\n\n\tif (target->cpu_list)\n\t\tret += SNPRINTF(bf + ret, size - ret, \", CPU%s: %s)\",\n\t\t\t\tperf_cpu_map__nr(top->evlist->core.user_requested_cpus) > 1\n\t\t\t\t? \"s\" : \"\",\n\t\t\t\ttarget->cpu_list);\n\telse {\n\t\tif (target->tid)\n\t\t\tret += SNPRINTF(bf + ret, size - ret, \")\");\n\t\telse\n\t\t\tret += SNPRINTF(bf + ret, size - ret, \", %d CPU%s)\",\n\t\t\t\t\tperf_cpu_map__nr(top->evlist->core.user_requested_cpus),\n\t\t\t\t\tperf_cpu_map__nr(top->evlist->core.user_requested_cpus) > 1\n\t\t\t\t\t? \"s\" : \"\");\n\t}\n\n\tperf_top__reset_sample_counters(top);\n\treturn ret;\n}\n\nvoid perf_top__reset_sample_counters(struct perf_top *top)\n{\n\ttop->samples = top->us_samples = top->kernel_samples =\n\ttop->exact_samples = top->guest_kernel_samples =\n\ttop->guest_us_samples = top->lost = top->drop = 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}