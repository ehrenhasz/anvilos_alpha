{
  "module_name": "machine.h",
  "hash_id": "9d4f85dde6f74b944feac9d13161c2be8984f41caa4aee6097b878804adacf82",
  "original_prompt": "Ingested from linux-6.6.14/tools/perf/util/machine.h",
  "human_readable_source": " \n#ifndef __PERF_MACHINE_H\n#define __PERF_MACHINE_H\n\n#include <sys/types.h>\n#include <linux/rbtree.h>\n#include \"maps.h\"\n#include \"dsos.h\"\n#include \"rwsem.h\"\n\nstruct addr_location;\nstruct branch_stack;\nstruct dso;\nstruct dso_id;\nstruct evsel;\nstruct perf_sample;\nstruct symbol;\nstruct target;\nstruct thread;\nunion perf_event;\nstruct machines;\n\n \n#define\tHOST_KERNEL_ID\t\t\t(-1)\n#define\tDEFAULT_GUEST_KERNEL_ID\t\t(0)\n\nextern const char *ref_reloc_sym_names[];\n\nstruct vdso_info;\n\n#define THREADS__TABLE_BITS\t8\n#define THREADS__TABLE_SIZE\t(1 << THREADS__TABLE_BITS)\n\nstruct threads {\n\tstruct rb_root_cached  entries;\n\tstruct rw_semaphore    lock;\n\tunsigned int\t       nr;\n\tstruct list_head       dead;\n\tstruct thread\t       *last_match;\n};\n\nstruct machine {\n\tstruct rb_node\t  rb_node;\n\tpid_t\t\t  pid;\n\tu16\t\t  id_hdr_size;\n\tbool\t\t  comm_exec;\n\tbool\t\t  kptr_restrict_warned;\n\tbool\t\t  single_address_space;\n\tchar\t\t  *root_dir;\n\tchar\t\t  *mmap_name;\n\tchar\t\t  *kallsyms_filename;\n\tstruct threads    threads[THREADS__TABLE_SIZE];\n\tstruct vdso_info  *vdso_info;\n\tstruct perf_env   *env;\n\tstruct dsos\t  dsos;\n\tstruct maps\t  *kmaps;\n\tstruct map\t  *vmlinux_map;\n\tu64\t\t  kernel_start;\n\tstruct {\n\t\tu64\t  text_start;\n\t\tu64\t  text_end;\n\t} sched, lock;\n\tpid_t\t\t  *current_tid;\n\tsize_t\t\t  current_tid_sz;\n\tunion {  \n\t\tvoid\t  *priv;\n\t\tu64\t  db_id;\n\t};\n\tstruct machines   *machines;\n\tbool\t\t  trampolines_mapped;\n};\n\nstatic inline struct threads *machine__threads(struct machine *machine, pid_t tid)\n{\n\t \n\treturn &machine->threads[(unsigned int)tid % THREADS__TABLE_SIZE];\n}\n\n \nstatic inline\nstruct map *machine__kernel_map(struct machine *machine)\n{\n\treturn machine->vmlinux_map;\n}\n\n \nstatic inline\nstruct maps *machine__kernel_maps(struct machine *machine)\n{\n\treturn machine->kmaps;\n}\n\nint machine__get_kernel_start(struct machine *machine);\n\nstatic inline u64 machine__kernel_start(struct machine *machine)\n{\n\tif (!machine->kernel_start)\n\t\tmachine__get_kernel_start(machine);\n\treturn machine->kernel_start;\n}\n\nstatic inline bool machine__kernel_ip(struct machine *machine, u64 ip)\n{\n\tu64 kernel_start = machine__kernel_start(machine);\n\n\treturn ip >= kernel_start;\n}\n\nu8 machine__addr_cpumode(struct machine *machine, u8 cpumode, u64 addr);\n\nstruct thread *machine__find_thread(struct machine *machine, pid_t pid,\n\t\t\t\t    pid_t tid);\nstruct thread *machine__idle_thread(struct machine *machine);\nstruct comm *machine__thread_exec_comm(struct machine *machine,\n\t\t\t\t       struct thread *thread);\n\nint machine__process_comm_event(struct machine *machine, union perf_event *event,\n\t\t\t\tstruct perf_sample *sample);\nint machine__process_exit_event(struct machine *machine, union perf_event *event,\n\t\t\t\tstruct perf_sample *sample);\nint machine__process_fork_event(struct machine *machine, union perf_event *event,\n\t\t\t\tstruct perf_sample *sample);\nint machine__process_lost_event(struct machine *machine, union perf_event *event,\n\t\t\t\tstruct perf_sample *sample);\nint machine__process_lost_samples_event(struct machine *machine, union perf_event *event,\n\t\t\t\t\tstruct perf_sample *sample);\nint machine__process_aux_event(struct machine *machine,\n\t\t\t       union perf_event *event);\nint machine__process_itrace_start_event(struct machine *machine,\n\t\t\t\t\tunion perf_event *event);\nint machine__process_aux_output_hw_id_event(struct machine *machine,\n\t\t\t\t\t    union perf_event *event);\nint machine__process_switch_event(struct machine *machine,\n\t\t\t\t  union perf_event *event);\nint machine__process_namespaces_event(struct machine *machine,\n\t\t\t\t      union perf_event *event,\n\t\t\t\t      struct perf_sample *sample);\nint machine__process_cgroup_event(struct machine *machine,\n\t\t\t\t  union perf_event *event,\n\t\t\t\t  struct perf_sample *sample);\nint machine__process_mmap_event(struct machine *machine, union perf_event *event,\n\t\t\t\tstruct perf_sample *sample);\nint machine__process_mmap2_event(struct machine *machine, union perf_event *event,\n\t\t\t\t struct perf_sample *sample);\nint machine__process_ksymbol(struct machine *machine,\n\t\t\t     union perf_event *event,\n\t\t\t     struct perf_sample *sample);\nint machine__process_text_poke(struct machine *machine,\n\t\t\t       union perf_event *event,\n\t\t\t       struct perf_sample *sample);\nint machine__process_event(struct machine *machine, union perf_event *event,\n\t\t\t\tstruct perf_sample *sample);\n\ntypedef void (*machine__process_t)(struct machine *machine, void *data);\n\nstruct machines {\n\tstruct machine host;\n\tstruct rb_root_cached guests;\n};\n\nvoid machines__init(struct machines *machines);\nvoid machines__exit(struct machines *machines);\n\nvoid machines__process_guests(struct machines *machines,\n\t\t\t      machine__process_t process, void *data);\n\nstruct machine *machines__add(struct machines *machines, pid_t pid,\n\t\t\t      const char *root_dir);\nstruct machine *machines__find(struct machines *machines, pid_t pid);\nstruct machine *machines__findnew(struct machines *machines, pid_t pid);\nstruct machine *machines__find_guest(struct machines *machines, pid_t pid);\nstruct thread *machines__findnew_guest_code(struct machines *machines, pid_t pid);\nstruct thread *machine__findnew_guest_code(struct machine *machine, pid_t pid);\n\nvoid machines__set_id_hdr_size(struct machines *machines, u16 id_hdr_size);\nvoid machines__set_comm_exec(struct machines *machines, bool comm_exec);\n\nstruct machine *machine__new_host(void);\nstruct machine *machine__new_kallsyms(void);\nint machine__init(struct machine *machine, const char *root_dir, pid_t pid);\nvoid machine__exit(struct machine *machine);\nvoid machine__delete_threads(struct machine *machine);\nvoid machine__delete(struct machine *machine);\nvoid machine__remove_thread(struct machine *machine, struct thread *th);\n\nstruct branch_info *sample__resolve_bstack(struct perf_sample *sample,\n\t\t\t\t\t   struct addr_location *al);\nstruct mem_info *sample__resolve_mem(struct perf_sample *sample,\n\t\t\t\t     struct addr_location *al);\n\nstruct callchain_cursor;\n\nint thread__resolve_callchain(struct thread *thread,\n\t\t\t      struct callchain_cursor *cursor,\n\t\t\t      struct evsel *evsel,\n\t\t\t      struct perf_sample *sample,\n\t\t\t      struct symbol **parent,\n\t\t\t      struct addr_location *root_al,\n\t\t\t      int max_stack);\n\n \nstatic inline bool machine__is_default_guest(struct machine *machine)\n{\n\treturn machine ? machine->pid == DEFAULT_GUEST_KERNEL_ID : false;\n}\n\nstatic inline bool machine__is_host(struct machine *machine)\n{\n\treturn machine ? machine->pid == HOST_KERNEL_ID : false;\n}\n\nbool machine__is_lock_function(struct machine *machine, u64 addr);\nbool machine__is(struct machine *machine, const char *arch);\nbool machine__normalized_is(struct machine *machine, const char *arch);\nint machine__nr_cpus_avail(struct machine *machine);\n\nstruct thread *__machine__findnew_thread(struct machine *machine, pid_t pid, pid_t tid);\nstruct thread *machine__findnew_thread(struct machine *machine, pid_t pid, pid_t tid);\n\nstruct dso *machine__findnew_dso_id(struct machine *machine, const char *filename, struct dso_id *id);\nstruct dso *machine__findnew_dso(struct machine *machine, const char *filename);\n\nsize_t machine__fprintf(struct machine *machine, FILE *fp);\n\nstatic inline\nstruct symbol *machine__find_kernel_symbol(struct machine *machine, u64 addr,\n\t\t\t\t\t   struct map **mapp)\n{\n\treturn maps__find_symbol(machine->kmaps, addr, mapp);\n}\n\nstatic inline\nstruct symbol *machine__find_kernel_symbol_by_name(struct machine *machine,\n\t\t\t\t\t\t   const char *name,\n\t\t\t\t\t\t   struct map **mapp)\n{\n\treturn maps__find_symbol_by_name(machine->kmaps, name, mapp);\n}\n\nint arch__fix_module_text_start(u64 *start, u64 *size, const char *name);\n\nint machine__load_kallsyms(struct machine *machine, const char *filename);\n\nint machine__load_vmlinux_path(struct machine *machine);\n\nsize_t machine__fprintf_dsos_buildid(struct machine *machine, FILE *fp,\n\t\t\t\t     bool (skip)(struct dso *dso, int parm), int parm);\nsize_t machines__fprintf_dsos(struct machines *machines, FILE *fp);\nsize_t machines__fprintf_dsos_buildid(struct machines *machines, FILE *fp,\n\t\t\t\t     bool (skip)(struct dso *dso, int parm), int parm);\n\nvoid machine__destroy_kernel_maps(struct machine *machine);\nint machine__create_kernel_maps(struct machine *machine);\n\nint machines__create_kernel_maps(struct machines *machines, pid_t pid);\nint machines__create_guest_kernel_maps(struct machines *machines);\nvoid machines__destroy_kernel_maps(struct machines *machines);\n\nsize_t machine__fprintf_vmlinux_path(struct machine *machine, FILE *fp);\n\ntypedef int (*machine__dso_t)(struct dso *dso, struct machine *machine, void *priv);\n\nint machine__for_each_dso(struct machine *machine, machine__dso_t fn,\n\t\t\t  void *priv);\n\ntypedef int (*machine__map_t)(struct map *map, void *priv);\nint machine__for_each_kernel_map(struct machine *machine, machine__map_t fn,\n\t\t\t\t void *priv);\n\nint machine__for_each_thread(struct machine *machine,\n\t\t\t     int (*fn)(struct thread *thread, void *p),\n\t\t\t     void *priv);\nint machines__for_each_thread(struct machines *machines,\n\t\t\t      int (*fn)(struct thread *thread, void *p),\n\t\t\t      void *priv);\n\npid_t machine__get_current_tid(struct machine *machine, int cpu);\nint machine__set_current_tid(struct machine *machine, int cpu, pid_t pid,\n\t\t\t     pid_t tid);\n \nchar *machine__resolve_kernel_addr(void *vmachine, unsigned long long *addrp, char **modp);\n\nvoid machine__get_kallsyms_filename(struct machine *machine, char *buf,\n\t\t\t\t    size_t bufsz);\n\nint machine__create_extra_kernel_maps(struct machine *machine,\n\t\t\t\t      struct dso *kernel);\n\n \nstruct extra_kernel_map {\n\tu64 start;\n\tu64 end;\n\tu64 pgoff;\n\tchar name[KMAP_NAME_LEN];\n};\n\nint machine__create_extra_kernel_map(struct machine *machine,\n\t\t\t\t     struct dso *kernel,\n\t\t\t\t     struct extra_kernel_map *xm);\n\nint machine__map_x86_64_entry_trampolines(struct machine *machine,\n\t\t\t\t\t  struct dso *kernel);\n\nint machine__resolve(struct machine *machine, struct addr_location *al,\n\t\t     struct perf_sample *sample);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}