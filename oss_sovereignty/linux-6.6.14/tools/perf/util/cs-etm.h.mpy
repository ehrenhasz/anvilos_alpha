{
  "module_name": "cs-etm.h",
  "hash_id": "94236b511287da042078801dd5f7c448e74deae167dedba94da8533d9e041eca",
  "original_prompt": "Ingested from linux-6.6.14/tools/perf/util/cs-etm.h",
  "human_readable_source": " \n \n\n#ifndef INCLUDE__UTIL_PERF_CS_ETM_H__\n#define INCLUDE__UTIL_PERF_CS_ETM_H__\n\n#include \"debug.h\"\n#include \"util/event.h\"\n#include <linux/bits.h>\n\nstruct perf_session;\nstruct perf_pmu;\n\n \nenum {\n\t \n\tCS_HEADER_VERSION,\n\t \n\tCS_PMU_TYPE_CPUS,\n\tCS_ETM_SNAPSHOT,\n\tCS_HEADER_VERSION_MAX,\n};\n\n \n#define CS_HEADER_CURRENT_VERSION\t2\n\n \nenum {\n\tCS_ETM_MAGIC,\n\tCS_ETM_CPU,\n\t \n\tCS_ETM_NR_TRC_PARAMS,\n\tCS_ETM_COMMON_BLK_MAX_V1,\n};\n\n \nenum {\n\t \n\tCS_ETM_ETMCR = CS_ETM_COMMON_BLK_MAX_V1,\n\tCS_ETM_ETMTRACEIDR,\n\t \n\tCS_ETM_ETMCCER,\n\tCS_ETM_ETMIDR,\n\tCS_ETM_PRIV_MAX,\n};\n\n \n#define CS_ETM_NR_TRC_PARAMS_V0 (CS_ETM_ETMIDR - CS_ETM_ETMCR + 1)\n\n \nenum {\n\t \n\tCS_ETMV4_TRCCONFIGR = CS_ETM_COMMON_BLK_MAX_V1,\n\tCS_ETMV4_TRCTRACEIDR,\n\t \n\tCS_ETMV4_TRCIDR0,\n\tCS_ETMV4_TRCIDR1,\n\tCS_ETMV4_TRCIDR2,\n\tCS_ETMV4_TRCIDR8,\n\tCS_ETMV4_TRCAUTHSTATUS,\n\tCS_ETMV4_TS_SOURCE,\n\tCS_ETMV4_PRIV_MAX,\n};\n\n \n#define CS_ETMV4_NR_TRC_PARAMS_V0 (CS_ETMV4_TRCAUTHSTATUS - CS_ETMV4_TRCCONFIGR + 1)\n\n \nenum {\n\t \n\tCS_ETE_TRCCONFIGR = CS_ETM_COMMON_BLK_MAX_V1,\n\tCS_ETE_TRCTRACEIDR,\n\t \n\tCS_ETE_TRCIDR0,\n\tCS_ETE_TRCIDR1,\n\tCS_ETE_TRCIDR2,\n\tCS_ETE_TRCIDR8,\n\tCS_ETE_TRCAUTHSTATUS,\n\tCS_ETE_TRCDEVARCH,\n\tCS_ETE_TS_SOURCE,\n\tCS_ETE_PRIV_MAX\n};\n\n \n#define CS_IS_VALID_TRACE_ID(id) ((id > 0) && (id < 0x70))\n\n \nenum {\n\tCS_ETMV3_EXC_NONE = 0,\n\tCS_ETMV3_EXC_DEBUG_HALT = 1,\n\tCS_ETMV3_EXC_SMC = 2,\n\tCS_ETMV3_EXC_HYP = 3,\n\tCS_ETMV3_EXC_ASYNC_DATA_ABORT = 4,\n\tCS_ETMV3_EXC_JAZELLE_THUMBEE = 5,\n\tCS_ETMV3_EXC_PE_RESET = 8,\n\tCS_ETMV3_EXC_UNDEFINED_INSTR = 9,\n\tCS_ETMV3_EXC_SVC = 10,\n\tCS_ETMV3_EXC_PREFETCH_ABORT = 11,\n\tCS_ETMV3_EXC_DATA_FAULT = 12,\n\tCS_ETMV3_EXC_GENERIC = 13,\n\tCS_ETMV3_EXC_IRQ = 14,\n\tCS_ETMV3_EXC_FIQ = 15,\n};\n\n \nenum {\n\tCS_ETMV4_EXC_RESET = 0,\n\tCS_ETMV4_EXC_DEBUG_HALT = 1,\n\tCS_ETMV4_EXC_CALL = 2,\n\tCS_ETMV4_EXC_TRAP = 3,\n\tCS_ETMV4_EXC_SYSTEM_ERROR = 4,\n\tCS_ETMV4_EXC_INST_DEBUG = 6,\n\tCS_ETMV4_EXC_DATA_DEBUG = 7,\n\tCS_ETMV4_EXC_ALIGNMENT = 10,\n\tCS_ETMV4_EXC_INST_FAULT = 11,\n\tCS_ETMV4_EXC_DATA_FAULT = 12,\n\tCS_ETMV4_EXC_IRQ = 14,\n\tCS_ETMV4_EXC_FIQ = 15,\n\tCS_ETMV4_EXC_END = 31,\n};\n\nenum cs_etm_sample_type {\n\tCS_ETM_EMPTY,\n\tCS_ETM_RANGE,\n\tCS_ETM_DISCONTINUITY,\n\tCS_ETM_EXCEPTION,\n\tCS_ETM_EXCEPTION_RET,\n};\n\nenum cs_etm_isa {\n\tCS_ETM_ISA_UNKNOWN,\n\tCS_ETM_ISA_A64,\n\tCS_ETM_ISA_A32,\n\tCS_ETM_ISA_T32,\n};\n\nstruct cs_etm_queue;\n\nstruct cs_etm_packet {\n\tenum cs_etm_sample_type sample_type;\n\tenum cs_etm_isa isa;\n\tu64 start_addr;\n\tu64 end_addr;\n\tu32 instr_count;\n\tu32 last_instr_type;\n\tu32 last_instr_subtype;\n\tu32 flags;\n\tu32 exception_number;\n\tbool last_instr_cond;\n\tbool last_instr_taken_branch;\n\tu8 last_instr_size;\n\tu8 trace_chan_id;\n\tint cpu;\n};\n\n#define CS_ETM_PACKET_MAX_BUFFER 1024\n\n \n#define CS_ETM_PER_THREAD_TRACEID 0\n\nstruct cs_etm_packet_queue {\n\tu32 packet_count;\n\tu32 head;\n\tu32 tail;\n\tu32 instr_count;\n\tu64 cs_timestamp;  \n\tu64 next_cs_timestamp;\n\tstruct cs_etm_packet packet_buffer[CS_ETM_PACKET_MAX_BUFFER];\n};\n\n#define KiB(x) ((x) * 1024)\n#define MiB(x) ((x) * 1024 * 1024)\n\n#define CS_ETM_INVAL_ADDR 0xdeadbeefdeadbeefUL\n\n#define BMVAL(val, lsb, msb)\t((val & GENMASK(msb, lsb)) >> lsb)\n\n#define CS_ETM_HEADER_SIZE (CS_HEADER_VERSION_MAX * sizeof(u64))\n\n#define __perf_cs_etmv3_magic 0x3030303030303030ULL\n#define __perf_cs_etmv4_magic 0x4040404040404040ULL\n#define __perf_cs_ete_magic   0x5050505050505050ULL\n#define CS_ETMV3_PRIV_SIZE (CS_ETM_PRIV_MAX * sizeof(u64))\n#define CS_ETMV4_PRIV_SIZE (CS_ETMV4_PRIV_MAX * sizeof(u64))\n#define CS_ETE_PRIV_SIZE (CS_ETE_PRIV_MAX * sizeof(u64))\n\n#define INFO_HEADER_SIZE (sizeof(((struct perf_record_auxtrace_info *)0)->type) + \\\n\t\t\t  sizeof(((struct perf_record_auxtrace_info *)0)->reserved__))\n\n \n#define CORESIGHT_TRACE_ID_VAL_MASK\tGENMASK(6, 0)\n\n \n#define CORESIGHT_TRACE_ID_UNUSED_FLAG\tBIT(31)\n\n \n#define CORESIGHT_TRACE_ID_UNUSED_VAL\t0x7F\n\nint cs_etm__process_auxtrace_info(union perf_event *event,\n\t\t\t\t  struct perf_session *session);\nstruct perf_event_attr *cs_etm_get_default_config(struct perf_pmu *pmu);\n\nenum cs_etm_pid_fmt {\n\tCS_ETM_PIDFMT_NONE,\n\tCS_ETM_PIDFMT_CTXTID,\n\tCS_ETM_PIDFMT_CTXTID2\n};\n\n#ifdef HAVE_CSTRACE_SUPPORT\n#include <opencsd/ocsd_if_types.h>\nint cs_etm__get_cpu(u8 trace_chan_id, int *cpu);\nenum cs_etm_pid_fmt cs_etm__get_pid_fmt(struct cs_etm_queue *etmq);\nint cs_etm__etmq_set_tid_el(struct cs_etm_queue *etmq, pid_t tid,\n\t\t\t    u8 trace_chan_id, ocsd_ex_level el);\nbool cs_etm__etmq_is_timeless(struct cs_etm_queue *etmq);\nvoid cs_etm__etmq_set_traceid_queue_timestamp(struct cs_etm_queue *etmq,\n\t\t\t\t\t      u8 trace_chan_id);\nstruct cs_etm_packet_queue\n*cs_etm__etmq_get_packet_queue(struct cs_etm_queue *etmq, u8 trace_chan_id);\nint cs_etm__process_auxtrace_info_full(union perf_event *event __maybe_unused,\n\t\t\t\t       struct perf_session *session __maybe_unused);\nu64 cs_etm__convert_sample_time(struct cs_etm_queue *etmq, u64 cs_timestamp);\n#else\nstatic inline int\ncs_etm__process_auxtrace_info_full(union perf_event *event __maybe_unused,\n\t\t\t\t   struct perf_session *session __maybe_unused)\n{\n\tpr_err(\"\\nCS ETM Trace: OpenCSD is not linked in, please recompile with CORESIGHT=1\\n\");\n\treturn -1;\n}\n#endif\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}