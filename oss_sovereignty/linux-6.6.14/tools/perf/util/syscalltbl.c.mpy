{
  "module_name": "syscalltbl.c",
  "hash_id": "17a45511abf40337cbdc3c6ecafec021420a4cfbfee2d7dafd6846bb5998283e",
  "original_prompt": "Ingested from linux-6.6.14/tools/perf/util/syscalltbl.c",
  "human_readable_source": "\n \n\n#include \"syscalltbl.h\"\n#include <stdlib.h>\n#include <linux/compiler.h>\n#include <linux/zalloc.h>\n\n#ifdef HAVE_SYSCALL_TABLE_SUPPORT\n#include <string.h>\n#include \"string2.h\"\n\n#if defined(__x86_64__)\n#include <asm/syscalls_64.c>\nconst int syscalltbl_native_max_id = SYSCALLTBL_x86_64_MAX_ID;\nstatic const char *const *syscalltbl_native = syscalltbl_x86_64;\n#elif defined(__s390x__)\n#include <asm/syscalls_64.c>\nconst int syscalltbl_native_max_id = SYSCALLTBL_S390_64_MAX_ID;\nstatic const char *const *syscalltbl_native = syscalltbl_s390_64;\n#elif defined(__powerpc64__)\n#include <asm/syscalls_64.c>\nconst int syscalltbl_native_max_id = SYSCALLTBL_POWERPC_64_MAX_ID;\nstatic const char *const *syscalltbl_native = syscalltbl_powerpc_64;\n#elif defined(__powerpc__)\n#include <asm/syscalls_32.c>\nconst int syscalltbl_native_max_id = SYSCALLTBL_POWERPC_32_MAX_ID;\nstatic const char *const *syscalltbl_native = syscalltbl_powerpc_32;\n#elif defined(__aarch64__)\n#include <asm/syscalls.c>\nconst int syscalltbl_native_max_id = SYSCALLTBL_ARM64_MAX_ID;\nstatic const char *const *syscalltbl_native = syscalltbl_arm64;\n#elif defined(__mips__)\n#include <asm/syscalls_n64.c>\nconst int syscalltbl_native_max_id = SYSCALLTBL_MIPS_N64_MAX_ID;\nstatic const char *const *syscalltbl_native = syscalltbl_mips_n64;\n#elif defined(__loongarch__)\n#include <asm/syscalls.c>\nconst int syscalltbl_native_max_id = SYSCALLTBL_LOONGARCH_MAX_ID;\nstatic const char *const *syscalltbl_native = syscalltbl_loongarch;\n#endif\n\nstruct syscall {\n\tint id;\n\tconst char *name;\n};\n\nstatic int syscallcmpname(const void *vkey, const void *ventry)\n{\n\tconst char *key = vkey;\n\tconst struct syscall *entry = ventry;\n\n\treturn strcmp(key, entry->name);\n}\n\nstatic int syscallcmp(const void *va, const void *vb)\n{\n\tconst struct syscall *a = va, *b = vb;\n\n\treturn strcmp(a->name, b->name);\n}\n\nstatic int syscalltbl__init_native(struct syscalltbl *tbl)\n{\n\tint nr_entries = 0, i, j;\n\tstruct syscall *entries;\n\n\tfor (i = 0; i <= syscalltbl_native_max_id; ++i)\n\t\tif (syscalltbl_native[i])\n\t\t\t++nr_entries;\n\n\tentries = tbl->syscalls.entries = malloc(sizeof(struct syscall) * nr_entries);\n\tif (tbl->syscalls.entries == NULL)\n\t\treturn -1;\n\n\tfor (i = 0, j = 0; i <= syscalltbl_native_max_id; ++i) {\n\t\tif (syscalltbl_native[i]) {\n\t\t\tentries[j].name = syscalltbl_native[i];\n\t\t\tentries[j].id = i;\n\t\t\t++j;\n\t\t}\n\t}\n\n\tqsort(tbl->syscalls.entries, nr_entries, sizeof(struct syscall), syscallcmp);\n\ttbl->syscalls.nr_entries = nr_entries;\n\ttbl->syscalls.max_id\t = syscalltbl_native_max_id;\n\treturn 0;\n}\n\nstruct syscalltbl *syscalltbl__new(void)\n{\n\tstruct syscalltbl *tbl = malloc(sizeof(*tbl));\n\tif (tbl) {\n\t\tif (syscalltbl__init_native(tbl)) {\n\t\t\tfree(tbl);\n\t\t\treturn NULL;\n\t\t}\n\t}\n\treturn tbl;\n}\n\nvoid syscalltbl__delete(struct syscalltbl *tbl)\n{\n\tzfree(&tbl->syscalls.entries);\n\tfree(tbl);\n}\n\nconst char *syscalltbl__name(const struct syscalltbl *tbl __maybe_unused, int id)\n{\n\treturn id <= syscalltbl_native_max_id ? syscalltbl_native[id]: NULL;\n}\n\nint syscalltbl__id(struct syscalltbl *tbl, const char *name)\n{\n\tstruct syscall *sc = bsearch(name, tbl->syscalls.entries,\n\t\t\t\t     tbl->syscalls.nr_entries, sizeof(*sc),\n\t\t\t\t     syscallcmpname);\n\n\treturn sc ? sc->id : -1;\n}\n\nint syscalltbl__strglobmatch_next(struct syscalltbl *tbl, const char *syscall_glob, int *idx)\n{\n\tint i;\n\tstruct syscall *syscalls = tbl->syscalls.entries;\n\n\tfor (i = *idx + 1; i < tbl->syscalls.nr_entries; ++i) {\n\t\tif (strglobmatch(syscalls[i].name, syscall_glob)) {\n\t\t\t*idx = i;\n\t\t\treturn syscalls[i].id;\n\t\t}\n\t}\n\n\treturn -1;\n}\n\nint syscalltbl__strglobmatch_first(struct syscalltbl *tbl, const char *syscall_glob, int *idx)\n{\n\t*idx = -1;\n\treturn syscalltbl__strglobmatch_next(tbl, syscall_glob, idx);\n}\n\n#else  \n\n#include <libaudit.h>\n\nstruct syscalltbl *syscalltbl__new(void)\n{\n\tstruct syscalltbl *tbl = zalloc(sizeof(*tbl));\n\tif (tbl)\n\t\ttbl->audit_machine = audit_detect_machine();\n\treturn tbl;\n}\n\nvoid syscalltbl__delete(struct syscalltbl *tbl)\n{\n\tfree(tbl);\n}\n\nconst char *syscalltbl__name(const struct syscalltbl *tbl, int id)\n{\n\treturn audit_syscall_to_name(id, tbl->audit_machine);\n}\n\nint syscalltbl__id(struct syscalltbl *tbl, const char *name)\n{\n\treturn audit_name_to_syscall(name, tbl->audit_machine);\n}\n\nint syscalltbl__strglobmatch_next(struct syscalltbl *tbl __maybe_unused,\n\t\t\t\t  const char *syscall_glob __maybe_unused, int *idx __maybe_unused)\n{\n\treturn -1;\n}\n\nint syscalltbl__strglobmatch_first(struct syscalltbl *tbl, const char *syscall_glob, int *idx)\n{\n\treturn syscalltbl__strglobmatch_next(tbl, syscall_glob, idx);\n}\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}