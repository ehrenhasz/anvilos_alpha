{
  "module_name": "intel-pt-decoder.h",
  "hash_id": "db0050161bbfc587702d065597fa195d9283eb1ddbe3c59fe7ec2da8d2e4b1fc",
  "original_prompt": "Ingested from linux-6.6.14/tools/perf/util/intel-pt-decoder/intel-pt-decoder.h",
  "human_readable_source": " \n \n\n#ifndef INCLUDE__INTEL_PT_DECODER_H__\n#define INCLUDE__INTEL_PT_DECODER_H__\n\n#include <stdint.h>\n#include <stddef.h>\n#include <stdbool.h>\n\n#include <linux/rbtree.h>\n\n#include \"intel-pt-insn-decoder.h\"\n\n#define INTEL_PT_IN_TX\t\t(1 << 0)\n#define INTEL_PT_ABORT_TX\t(1 << 1)\n#define INTEL_PT_IFLAG\t\t(1 << 2)\n#define INTEL_PT_ASYNC\t\t(1 << 2)\n#define INTEL_PT_FUP_IP\t\t(1 << 3)\n#define INTEL_PT_SAMPLE_IPC\t(1 << 4)\n\nenum intel_pt_sample_type {\n\tINTEL_PT_BRANCH\t\t= 1 << 0,\n\tINTEL_PT_INSTRUCTION\t= 1 << 1,\n\tINTEL_PT_TRANSACTION\t= 1 << 2,\n\tINTEL_PT_PTW\t\t= 1 << 3,\n\tINTEL_PT_MWAIT_OP\t= 1 << 4,\n\tINTEL_PT_PWR_ENTRY\t= 1 << 5,\n\tINTEL_PT_EX_STOP\t= 1 << 6,\n\tINTEL_PT_PWR_EXIT\t= 1 << 7,\n\tINTEL_PT_CBR_CHG\t= 1 << 8,\n\tINTEL_PT_TRACE_BEGIN\t= 1 << 9,\n\tINTEL_PT_TRACE_END\t= 1 << 10,\n\tINTEL_PT_BLK_ITEMS\t= 1 << 11,\n\tINTEL_PT_PSB_EVT\t= 1 << 12,\n\tINTEL_PT_EVT\t\t= 1 << 13,\n\tINTEL_PT_IFLAG_CHG\t= 1 << 14,\n};\n\nenum intel_pt_period_type {\n\tINTEL_PT_PERIOD_NONE,\n\tINTEL_PT_PERIOD_INSTRUCTIONS,\n\tINTEL_PT_PERIOD_TICKS,\n\tINTEL_PT_PERIOD_MTC,\n};\n\nenum {\n\tINTEL_PT_ERR_NOMEM = 1,\n\tINTEL_PT_ERR_INTERN,\n\tINTEL_PT_ERR_BADPKT,\n\tINTEL_PT_ERR_NODATA,\n\tINTEL_PT_ERR_NOINSN,\n\tINTEL_PT_ERR_MISMAT,\n\tINTEL_PT_ERR_OVR,\n\tINTEL_PT_ERR_LOST,\n\tINTEL_PT_ERR_UNK,\n\tINTEL_PT_ERR_NELOOP,\n\tINTEL_PT_ERR_EPTW,\n\tINTEL_PT_ERR_MAX,\n};\n\nenum intel_pt_param_flags {\n\t \n\tINTEL_PT_FUP_WITH_NLIP\t= 1 << 0,\n};\n\nenum intel_pt_blk_type {\n\tINTEL_PT_GP_REGS\t= 1,\n\tINTEL_PT_PEBS_BASIC\t= 4,\n\tINTEL_PT_PEBS_MEM\t= 5,\n\tINTEL_PT_LBR_0\t\t= 8,\n\tINTEL_PT_LBR_1\t\t= 9,\n\tINTEL_PT_LBR_2\t\t= 10,\n\tINTEL_PT_XMM\t\t= 16,\n\tINTEL_PT_BLK_TYPE_MAX\n};\n\n \nenum intel_pt_blk_type_pos {\n\tINTEL_PT_GP_REGS_POS,\n\tINTEL_PT_PEBS_BASIC_POS,\n\tINTEL_PT_PEBS_MEM_POS,\n\tINTEL_PT_LBR_0_POS,\n\tINTEL_PT_LBR_1_POS,\n\tINTEL_PT_LBR_2_POS,\n\tINTEL_PT_XMM_POS,\n\tINTEL_PT_BLK_TYPE_CNT\n};\n\n \nstatic inline int intel_pt_blk_type_pos(enum intel_pt_blk_type blk_type)\n{\n#define BLK_TYPE(bt) [INTEL_PT_##bt] = INTEL_PT_##bt##_POS + 1\n\tconst int map[INTEL_PT_BLK_TYPE_MAX] = {\n\t\tBLK_TYPE(GP_REGS),\n\t\tBLK_TYPE(PEBS_BASIC),\n\t\tBLK_TYPE(PEBS_MEM),\n\t\tBLK_TYPE(LBR_0),\n\t\tBLK_TYPE(LBR_1),\n\t\tBLK_TYPE(LBR_2),\n\t\tBLK_TYPE(XMM),\n\t};\n#undef BLK_TYPE\n\n\treturn blk_type < INTEL_PT_BLK_TYPE_MAX ? map[blk_type] - 1 : -1;\n}\n\n#define INTEL_PT_BLK_ITEM_ID_CNT\t32\n\n \nstruct intel_pt_blk_items {\n\tunion {\n\t\tuint32_t mask[INTEL_PT_BLK_TYPE_CNT];\n\t\tstruct {\n\t\t\tuint32_t has_rflags:1;\n\t\t\tuint32_t has_rip:1;\n\t\t\tuint32_t has_rax:1;\n\t\t\tuint32_t has_rcx:1;\n\t\t\tuint32_t has_rdx:1;\n\t\t\tuint32_t has_rbx:1;\n\t\t\tuint32_t has_rsp:1;\n\t\t\tuint32_t has_rbp:1;\n\t\t\tuint32_t has_rsi:1;\n\t\t\tuint32_t has_rdi:1;\n\t\t\tuint32_t has_r8:1;\n\t\t\tuint32_t has_r9:1;\n\t\t\tuint32_t has_r10:1;\n\t\t\tuint32_t has_r11:1;\n\t\t\tuint32_t has_r12:1;\n\t\t\tuint32_t has_r13:1;\n\t\t\tuint32_t has_r14:1;\n\t\t\tuint32_t has_r15:1;\n\t\t\tuint32_t has_unused_0:14;\n\t\t\tuint32_t has_ip:1;\n\t\t\tuint32_t has_applicable_counters:1;\n\t\t\tuint32_t has_timestamp:1;\n\t\t\tuint32_t has_unused_1:29;\n\t\t\tuint32_t has_mem_access_address:1;\n\t\t\tuint32_t has_mem_aux_info:1;\n\t\t\tuint32_t has_mem_access_latency:1;\n\t\t\tuint32_t has_tsx_aux_info:1;\n\t\t\tuint32_t has_unused_2:28;\n\t\t\tuint32_t has_lbr_0;\n\t\t\tuint32_t has_lbr_1;\n\t\t\tuint32_t has_lbr_2;\n\t\t\tuint32_t has_xmm;\n\t\t};\n\t};\n\tunion {\n\t\tuint64_t val[INTEL_PT_BLK_TYPE_CNT][INTEL_PT_BLK_ITEM_ID_CNT];\n\t\tstruct {\n\t\t\tstruct {\n\t\t\t\tuint64_t rflags;\n\t\t\t\tuint64_t rip;\n\t\t\t\tuint64_t rax;\n\t\t\t\tuint64_t rcx;\n\t\t\t\tuint64_t rdx;\n\t\t\t\tuint64_t rbx;\n\t\t\t\tuint64_t rsp;\n\t\t\t\tuint64_t rbp;\n\t\t\t\tuint64_t rsi;\n\t\t\t\tuint64_t rdi;\n\t\t\t\tuint64_t r8;\n\t\t\t\tuint64_t r9;\n\t\t\t\tuint64_t r10;\n\t\t\t\tuint64_t r11;\n\t\t\t\tuint64_t r12;\n\t\t\t\tuint64_t r13;\n\t\t\t\tuint64_t r14;\n\t\t\t\tuint64_t r15;\n\t\t\t\tuint64_t unused_0[INTEL_PT_BLK_ITEM_ID_CNT - 18];\n\t\t\t};\n\t\t\tstruct {\n\t\t\t\tuint64_t ip;\n\t\t\t\tuint64_t applicable_counters;\n\t\t\t\tuint64_t timestamp;\n\t\t\t\tuint64_t unused_1[INTEL_PT_BLK_ITEM_ID_CNT - 3];\n\t\t\t};\n\t\t\tstruct {\n\t\t\t\tuint64_t mem_access_address;\n\t\t\t\tuint64_t mem_aux_info;\n\t\t\t\tuint64_t mem_access_latency;\n\t\t\t\tuint64_t tsx_aux_info;\n\t\t\t\tuint64_t unused_2[INTEL_PT_BLK_ITEM_ID_CNT - 4];\n\t\t\t};\n\t\t\tuint64_t lbr_0[INTEL_PT_BLK_ITEM_ID_CNT];\n\t\t\tuint64_t lbr_1[INTEL_PT_BLK_ITEM_ID_CNT];\n\t\t\tuint64_t lbr_2[INTEL_PT_BLK_ITEM_ID_CNT];\n\t\t\tuint64_t xmm[INTEL_PT_BLK_ITEM_ID_CNT];\n\t\t};\n\t};\n\tbool is_32_bit;\n};\n\nstruct intel_pt_vmcs_info {\n\tstruct rb_node rb_node;\n\tuint64_t vmcs;\n\tuint64_t tsc_offset;\n\tbool reliable;\n\tbool error_printed;\n};\n\n \n#define INTEL_PT_MAX_EVDS 64\n\n \nstruct intel_pt_evd {\n\tint type;\n\tuint64_t payload;\n};\n\nstruct intel_pt_state {\n\tenum intel_pt_sample_type type;\n\tbool from_nr;\n\tbool to_nr;\n\tbool from_iflag;\n\tbool to_iflag;\n\tint err;\n\tuint64_t from_ip;\n\tuint64_t to_ip;\n\tuint64_t tot_insn_cnt;\n\tuint64_t tot_cyc_cnt;\n\tuint64_t cycles;\n\tuint64_t timestamp;\n\tuint64_t est_timestamp;\n\tuint64_t trace_nr;\n\tuint64_t ptw_payload;\n\tuint64_t mwait_payload;\n\tuint64_t pwre_payload;\n\tuint64_t pwrx_payload;\n\tuint64_t cbr_payload;\n\tuint64_t psb_offset;\n\tuint32_t cbr;\n\tuint32_t flags;\n\tenum intel_pt_insn_op insn_op;\n\tint insn_len;\n\tchar insn[INTEL_PT_INSN_BUF_SZ];\n\tstruct intel_pt_blk_items items;\n\tint cfe_type;\n\tint cfe_vector;\n\tint evd_cnt;\n\tstruct intel_pt_evd *evd;\n};\n\nstruct intel_pt_insn;\n\nstruct intel_pt_buffer {\n\tconst unsigned char *buf;\n\tsize_t len;\n\tbool consecutive;\n\tuint64_t ref_timestamp;\n\tuint64_t trace_nr;\n};\n\ntypedef int (*intel_pt_lookahead_cb_t)(struct intel_pt_buffer *, void *);\n\nstruct intel_pt_params {\n\tint (*get_trace)(struct intel_pt_buffer *buffer, void *data);\n\tint (*walk_insn)(struct intel_pt_insn *intel_pt_insn,\n\t\t\t uint64_t *insn_cnt_ptr, uint64_t *ip, uint64_t to_ip,\n\t\t\t uint64_t max_insn_cnt, void *data);\n\tbool (*pgd_ip)(uint64_t ip, void *data);\n\tint (*lookahead)(void *data, intel_pt_lookahead_cb_t cb, void *cb_data);\n\tstruct intel_pt_vmcs_info *(*findnew_vmcs_info)(void *data, uint64_t vmcs);\n\tvoid *data;\n\tbool return_compression;\n\tbool branch_enable;\n\tbool vm_time_correlation;\n\tbool vm_tm_corr_dry_run;\n\tuint64_t first_timestamp;\n\tuint64_t ctl;\n\tuint64_t period;\n\tenum intel_pt_period_type period_type;\n\tunsigned max_non_turbo_ratio;\n\tunsigned int mtc_period;\n\tuint32_t tsc_ctc_ratio_n;\n\tuint32_t tsc_ctc_ratio_d;\n\tenum intel_pt_param_flags flags;\n\tunsigned int quick;\n\tint max_loops;\n};\n\nstruct intel_pt_decoder;\n\nstruct intel_pt_decoder *intel_pt_decoder_new(struct intel_pt_params *params);\nvoid intel_pt_decoder_free(struct intel_pt_decoder *decoder);\n\nconst struct intel_pt_state *intel_pt_decode(struct intel_pt_decoder *decoder);\n\nint intel_pt_fast_forward(struct intel_pt_decoder *decoder, uint64_t timestamp);\n\nunsigned char *intel_pt_find_overlap(unsigned char *buf_a, size_t len_a,\n\t\t\t\t     unsigned char *buf_b, size_t len_b,\n\t\t\t\t     bool have_tsc, bool *consecutive,\n\t\t\t\t     bool ooo_tsc);\n\nint intel_pt__strerror(int code, char *buf, size_t buflen);\n\nvoid intel_pt_set_first_timestamp(struct intel_pt_decoder *decoder,\n\t\t\t\t  uint64_t first_timestamp);\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}