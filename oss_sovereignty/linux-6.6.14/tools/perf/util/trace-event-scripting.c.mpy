{
  "module_name": "trace-event-scripting.c",
  "hash_id": "4f1df749ed2488993ba7b863bae563549ad9cece42b44d6a3180d825bb3d5348",
  "original_prompt": "Ingested from linux-6.6.14/tools/perf/util/trace-event-scripting.c",
  "human_readable_source": "\n \n\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <errno.h>\n#ifdef HAVE_LIBTRACEEVENT\n#include <traceevent/event-parse.h>\n#endif\n\n#include \"debug.h\"\n#include \"trace-event.h\"\n#include \"evsel.h\"\n#include <linux/zalloc.h>\n#include \"util/sample.h\"\n\nstruct scripting_context *scripting_context;\n\nvoid scripting_context__update(struct scripting_context *c,\n\t\t\t       union perf_event *event,\n\t\t\t       struct perf_sample *sample,\n\t\t\t       struct evsel *evsel,\n\t\t\t       struct addr_location *al,\n\t\t\t       struct addr_location *addr_al)\n{\n\tc->event_data = sample->raw_data;\n\tc->pevent = NULL;\n#ifdef HAVE_LIBTRACEEVENT\n\tif (evsel->tp_format)\n\t\tc->pevent = evsel->tp_format->tep;\n#endif\n\tc->event = event;\n\tc->sample = sample;\n\tc->evsel = evsel;\n\tc->al = al;\n\tc->addr_al = addr_al;\n}\n\nstatic int flush_script_unsupported(void)\n{\n\treturn 0;\n}\n\nstatic int stop_script_unsupported(void)\n{\n\treturn 0;\n}\n\nstatic void process_event_unsupported(union perf_event *event __maybe_unused,\n\t\t\t\t      struct perf_sample *sample __maybe_unused,\n\t\t\t\t      struct evsel *evsel __maybe_unused,\n\t\t\t\t      struct addr_location *al __maybe_unused,\n\t\t\t\t      struct addr_location *addr_al __maybe_unused)\n{\n}\n\nstatic void print_python_unsupported_msg(void)\n{\n\tfprintf(stderr, \"Python scripting not supported.\"\n\t\t\"  Install libpython and rebuild perf to enable it.\\n\"\n\t\t\"For example:\\n  # apt-get install python-dev (ubuntu)\"\n\t\t\"\\n  # yum install python-devel (Fedora)\"\n\t\t\"\\n  etc.\\n\");\n}\n\nstatic int python_start_script_unsupported(const char *script __maybe_unused,\n\t\t\t\t\t   int argc __maybe_unused,\n\t\t\t\t\t   const char **argv __maybe_unused,\n\t\t\t\t\t   struct perf_session *session __maybe_unused)\n{\n\tprint_python_unsupported_msg();\n\n\treturn -1;\n}\n\nstatic int python_generate_script_unsupported(struct tep_handle *pevent\n\t\t\t\t\t      __maybe_unused,\n\t\t\t\t\t      const char *outfile\n\t\t\t\t\t      __maybe_unused)\n{\n\tprint_python_unsupported_msg();\n\n\treturn -1;\n}\n\nstruct scripting_ops python_scripting_unsupported_ops = {\n\t.name = \"Python\",\n\t.dirname = \"python\",\n\t.start_script = python_start_script_unsupported,\n\t.flush_script = flush_script_unsupported,\n\t.stop_script = stop_script_unsupported,\n\t.process_event = process_event_unsupported,\n\t.generate_script = python_generate_script_unsupported,\n};\n\nstatic void register_python_scripting(struct scripting_ops *scripting_ops)\n{\n\tif (scripting_context == NULL)\n\t\tscripting_context = malloc(sizeof(*scripting_context));\n\n       if (scripting_context == NULL ||\n\t   script_spec_register(\"Python\", scripting_ops) ||\n\t   script_spec_register(\"py\", scripting_ops)) {\n\t\tpr_err(\"Error registering Python script extension: disabling it\\n\");\n\t\tzfree(&scripting_context);\n\t}\n}\n\n#ifndef HAVE_LIBPYTHON_SUPPORT\nvoid setup_python_scripting(void)\n{\n\tregister_python_scripting(&python_scripting_unsupported_ops);\n}\n#else\nextern struct scripting_ops python_scripting_ops;\n\nvoid setup_python_scripting(void)\n{\n\tregister_python_scripting(&python_scripting_ops);\n}\n#endif\n\n#ifdef HAVE_LIBTRACEEVENT\nstatic void print_perl_unsupported_msg(void)\n{\n\tfprintf(stderr, \"Perl scripting not supported.\"\n\t\t\"  Install libperl and rebuild perf to enable it.\\n\"\n\t\t\"For example:\\n  # apt-get install libperl-dev (ubuntu)\"\n\t\t\"\\n  # yum install 'perl(ExtUtils::Embed)' (Fedora)\"\n\t\t\"\\n  etc.\\n\");\n}\n\nstatic int perl_start_script_unsupported(const char *script __maybe_unused,\n\t\t\t\t\t int argc __maybe_unused,\n\t\t\t\t\t const char **argv __maybe_unused,\n\t\t\t\t\t struct perf_session *session __maybe_unused)\n{\n\tprint_perl_unsupported_msg();\n\n\treturn -1;\n}\n\nstatic int perl_generate_script_unsupported(struct tep_handle *pevent\n\t\t\t\t\t    __maybe_unused,\n\t\t\t\t\t    const char *outfile __maybe_unused)\n{\n\tprint_perl_unsupported_msg();\n\n\treturn -1;\n}\n\nstruct scripting_ops perl_scripting_unsupported_ops = {\n\t.name = \"Perl\",\n\t.dirname = \"perl\",\n\t.start_script = perl_start_script_unsupported,\n\t.flush_script = flush_script_unsupported,\n\t.stop_script = stop_script_unsupported,\n\t.process_event = process_event_unsupported,\n\t.generate_script = perl_generate_script_unsupported,\n};\n\nstatic void register_perl_scripting(struct scripting_ops *scripting_ops)\n{\n\tif (scripting_context == NULL)\n\t\tscripting_context = malloc(sizeof(*scripting_context));\n\n       if (scripting_context == NULL ||\n\t   script_spec_register(\"Perl\", scripting_ops) ||\n\t   script_spec_register(\"pl\", scripting_ops)) {\n\t\tpr_err(\"Error registering Perl script extension: disabling it\\n\");\n\t\tzfree(&scripting_context);\n\t}\n}\n\n#ifndef HAVE_LIBPERL_SUPPORT\nvoid setup_perl_scripting(void)\n{\n\tregister_perl_scripting(&perl_scripting_unsupported_ops);\n}\n#else\nextern struct scripting_ops perl_scripting_ops;\n\nvoid setup_perl_scripting(void)\n{\n\tregister_perl_scripting(&perl_scripting_ops);\n}\n#endif\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}