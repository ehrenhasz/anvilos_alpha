{
  "module_name": "parse-branch-options.c",
  "hash_id": "52fc0f62305672aaab7c2a03a18f91e5cc76b45fa5662837a4026f786fdaa1ab",
  "original_prompt": "Ingested from linux-6.6.14/tools/perf/util/parse-branch-options.c",
  "human_readable_source": "\n#include \"util/debug.h\"\n#include \"util/event.h\"\n#include <subcmd/parse-options.h>\n#include \"util/parse-branch-options.h\"\n#include <stdlib.h>\n#include <string.h>\n\n#define BRANCH_OPT(n, m) \\\n\t{ .name = n, .mode = (m) }\n\n#define BRANCH_END { .name = NULL }\n\nstruct branch_mode {\n\tconst char *name;\n\tint mode;\n};\n\nstatic const struct branch_mode branch_modes[] = {\n\tBRANCH_OPT(\"u\", PERF_SAMPLE_BRANCH_USER),\n\tBRANCH_OPT(\"k\", PERF_SAMPLE_BRANCH_KERNEL),\n\tBRANCH_OPT(\"hv\", PERF_SAMPLE_BRANCH_HV),\n\tBRANCH_OPT(\"any\", PERF_SAMPLE_BRANCH_ANY),\n\tBRANCH_OPT(\"any_call\", PERF_SAMPLE_BRANCH_ANY_CALL),\n\tBRANCH_OPT(\"any_ret\", PERF_SAMPLE_BRANCH_ANY_RETURN),\n\tBRANCH_OPT(\"ind_call\", PERF_SAMPLE_BRANCH_IND_CALL),\n\tBRANCH_OPT(\"abort_tx\", PERF_SAMPLE_BRANCH_ABORT_TX),\n\tBRANCH_OPT(\"in_tx\", PERF_SAMPLE_BRANCH_IN_TX),\n\tBRANCH_OPT(\"no_tx\", PERF_SAMPLE_BRANCH_NO_TX),\n\tBRANCH_OPT(\"cond\", PERF_SAMPLE_BRANCH_COND),\n\tBRANCH_OPT(\"ind_jmp\", PERF_SAMPLE_BRANCH_IND_JUMP),\n\tBRANCH_OPT(\"call\", PERF_SAMPLE_BRANCH_CALL),\n\tBRANCH_OPT(\"no_flags\", PERF_SAMPLE_BRANCH_NO_FLAGS),\n\tBRANCH_OPT(\"no_cycles\", PERF_SAMPLE_BRANCH_NO_CYCLES),\n\tBRANCH_OPT(\"save_type\", PERF_SAMPLE_BRANCH_TYPE_SAVE),\n\tBRANCH_OPT(\"stack\", PERF_SAMPLE_BRANCH_CALL_STACK),\n\tBRANCH_OPT(\"hw_index\", PERF_SAMPLE_BRANCH_HW_INDEX),\n\tBRANCH_OPT(\"priv\", PERF_SAMPLE_BRANCH_PRIV_SAVE),\n\tBRANCH_END\n};\n\nint parse_branch_str(const char *str, __u64 *mode)\n{\n#define ONLY_PLM \\\n\t(PERF_SAMPLE_BRANCH_USER\t|\\\n\t PERF_SAMPLE_BRANCH_KERNEL\t|\\\n\t PERF_SAMPLE_BRANCH_HV)\n\n\tint ret = 0;\n\tchar *p, *s;\n\tchar *os = NULL;\n\tconst struct branch_mode *br;\n\n\tif (str == NULL) {\n\t\t*mode = PERF_SAMPLE_BRANCH_ANY;\n\t\treturn 0;\n\t}\n\n\t \n\ts = os = strdup(str);\n\tif (!s)\n\t\treturn -1;\n\n\tfor (;;) {\n\t\tp = strchr(s, ',');\n\t\tif (p)\n\t\t\t*p = '\\0';\n\n\t\tfor (br = branch_modes; br->name; br++) {\n\t\t\tif (!strcasecmp(s, br->name))\n\t\t\t\tbreak;\n\t\t}\n\t\tif (!br->name) {\n\t\t\tret = -1;\n\t\t\tpr_warning(\"unknown branch filter %s,\"\n\t\t\t\t    \" check man page\\n\", s);\n\t\t\tgoto error;\n\t\t}\n\n\t\t*mode |= br->mode;\n\n\t\tif (!p)\n\t\t\tbreak;\n\n\t\ts = p + 1;\n\t}\n\n\t \n\tif ((*mode & ~ONLY_PLM) == 0) {\n\t\t*mode = PERF_SAMPLE_BRANCH_ANY;\n\t}\nerror:\n\tfree(os);\n\treturn ret;\n}\n\nint\nparse_branch_stack(const struct option *opt, const char *str, int unset)\n{\n\t__u64 *mode = (__u64 *)opt->value;\n\n\tif (unset)\n\t\treturn 0;\n\n\t \n\tif (*mode) {\n\t\tpr_err(\"Error: Can't use --branch-any (-b) with --branch-filter (-j).\\n\");\n\t\treturn -1;\n\t}\n\n\treturn parse_branch_str(str, mode);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}