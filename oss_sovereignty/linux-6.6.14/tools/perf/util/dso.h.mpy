{
  "module_name": "dso.h",
  "hash_id": "9a0cd9846dce3d15112770f6efb6d4adfe8dd16b7fbd5b6673bb1ee22d7db1c7",
  "original_prompt": "Ingested from linux-6.6.14/tools/perf/util/dso.h",
  "human_readable_source": " \n#ifndef __PERF_DSO\n#define __PERF_DSO\n\n#include <linux/refcount.h>\n#include <linux/types.h>\n#include <linux/rbtree.h>\n#include <sys/types.h>\n#include <stdbool.h>\n#include <stdio.h>\n#include <linux/bitops.h>\n#include \"build-id.h\"\n#include \"mutex.h\"\n\nstruct machine;\nstruct map;\nstruct perf_env;\n\n#define DSO__NAME_KALLSYMS\t\"[kernel.kallsyms]\"\n#define DSO__NAME_KCORE\t\t\"[kernel.kcore]\"\n\nenum dso_binary_type {\n\tDSO_BINARY_TYPE__KALLSYMS = 0,\n\tDSO_BINARY_TYPE__GUEST_KALLSYMS,\n\tDSO_BINARY_TYPE__VMLINUX,\n\tDSO_BINARY_TYPE__GUEST_VMLINUX,\n\tDSO_BINARY_TYPE__JAVA_JIT,\n\tDSO_BINARY_TYPE__DEBUGLINK,\n\tDSO_BINARY_TYPE__BUILD_ID_CACHE,\n\tDSO_BINARY_TYPE__BUILD_ID_CACHE_DEBUGINFO,\n\tDSO_BINARY_TYPE__FEDORA_DEBUGINFO,\n\tDSO_BINARY_TYPE__UBUNTU_DEBUGINFO,\n\tDSO_BINARY_TYPE__MIXEDUP_UBUNTU_DEBUGINFO,\n\tDSO_BINARY_TYPE__BUILDID_DEBUGINFO,\n\tDSO_BINARY_TYPE__SYSTEM_PATH_DSO,\n\tDSO_BINARY_TYPE__GUEST_KMODULE,\n\tDSO_BINARY_TYPE__GUEST_KMODULE_COMP,\n\tDSO_BINARY_TYPE__SYSTEM_PATH_KMODULE,\n\tDSO_BINARY_TYPE__SYSTEM_PATH_KMODULE_COMP,\n\tDSO_BINARY_TYPE__KCORE,\n\tDSO_BINARY_TYPE__GUEST_KCORE,\n\tDSO_BINARY_TYPE__OPENEMBEDDED_DEBUGINFO,\n\tDSO_BINARY_TYPE__BPF_PROG_INFO,\n\tDSO_BINARY_TYPE__BPF_IMAGE,\n\tDSO_BINARY_TYPE__OOL,\n\tDSO_BINARY_TYPE__NOT_FOUND,\n};\n\nenum dso_space_type {\n\tDSO_SPACE__USER = 0,\n\tDSO_SPACE__KERNEL,\n\tDSO_SPACE__KERNEL_GUEST\n};\n\nenum dso_swap_type {\n\tDSO_SWAP__UNSET,\n\tDSO_SWAP__NO,\n\tDSO_SWAP__YES,\n};\n\nenum dso_data_status {\n\tDSO_DATA_STATUS_ERROR\t= -1,\n\tDSO_DATA_STATUS_UNKNOWN\t= 0,\n\tDSO_DATA_STATUS_OK\t= 1,\n};\n\nenum dso_data_status_seen {\n\tDSO_DATA_STATUS_SEEN_ITRACE,\n};\n\nenum dso_type {\n\tDSO__TYPE_UNKNOWN,\n\tDSO__TYPE_64BIT,\n\tDSO__TYPE_32BIT,\n\tDSO__TYPE_X32BIT,\n};\n\nenum dso_load_errno {\n\tDSO_LOAD_ERRNO__SUCCESS\t\t= 0,\n\n\t \n\t__DSO_LOAD_ERRNO__START\t\t= -10000,\n\n\tDSO_LOAD_ERRNO__INTERNAL_ERROR\t= __DSO_LOAD_ERRNO__START,\n\n\t \n\tDSO_LOAD_ERRNO__INVALID_ELF,\n\tDSO_LOAD_ERRNO__CANNOT_READ_BUILDID,\n\tDSO_LOAD_ERRNO__MISMATCHING_BUILDID,\n\n\t \n\tDSO_LOAD_ERRNO__DECOMPRESSION_FAILURE,\n\n\t__DSO_LOAD_ERRNO__END,\n};\n\n#define DSO__SWAP(dso, type, val)\t\t\t\\\n({\t\t\t\t\t\t\t\\\n\ttype ____r = val;\t\t\t\t\\\n\tBUG_ON(dso->needs_swap == DSO_SWAP__UNSET);\t\\\n\tif (dso->needs_swap == DSO_SWAP__YES) {\t\t\\\n\t\tswitch (sizeof(____r)) {\t\t\\\n\t\tcase 2:\t\t\t\t\t\\\n\t\t\t____r = bswap_16(val);\t\t\\\n\t\t\tbreak;\t\t\t\t\\\n\t\tcase 4:\t\t\t\t\t\\\n\t\t\t____r = bswap_32(val);\t\t\\\n\t\t\tbreak;\t\t\t\t\\\n\t\tcase 8:\t\t\t\t\t\\\n\t\t\t____r = bswap_64(val);\t\t\\\n\t\t\tbreak;\t\t\t\t\\\n\t\tdefault:\t\t\t\t\\\n\t\t\tBUG_ON(1);\t\t\t\\\n\t\t}\t\t\t\t\t\\\n\t}\t\t\t\t\t\t\\\n\t____r;\t\t\t\t\t\t\\\n})\n\n#define DSO__DATA_CACHE_SIZE 4096\n#define DSO__DATA_CACHE_MASK ~(DSO__DATA_CACHE_SIZE - 1)\n\n \nstruct dso_id {\n\tu32\tmaj;\n\tu32\tmin;\n\tu64\tino;\n\tu64\tino_generation;\n};\n\nstruct dso_cache {\n\tstruct rb_node\trb_node;\n\tu64 offset;\n\tu64 size;\n\tchar data[];\n};\n\nstruct auxtrace_cache;\n\nstruct dso {\n\tstruct mutex\t lock;\n\tstruct list_head node;\n\tstruct rb_node\t rb_node;\t \n\tstruct rb_root\t *root;\t\t \n\tstruct rb_root_cached symbols;\n\tstruct symbol\t **symbol_names;\n\tsize_t\t\t symbol_names_len;\n\tstruct rb_root_cached inlined_nodes;\n\tstruct rb_root_cached srclines;\n\tstruct {\n\t\tu64\t\taddr;\n\t\tstruct symbol\t*symbol;\n\t} last_find_result;\n\tvoid\t\t *a2l;\n\tchar\t\t *symsrc_filename;\n\tunsigned int\t a2l_fails;\n\tenum dso_space_type\tkernel;\n\tenum dso_swap_type\tneeds_swap;\n\tenum dso_binary_type\tsymtab_type;\n\tenum dso_binary_type\tbinary_type;\n\tenum dso_load_errno\tload_errno;\n\tu8\t\t adjust_symbols:1;\n\tu8\t\t has_build_id:1;\n\tu8\t\t header_build_id:1;\n\tu8\t\t has_srcline:1;\n\tu8\t\t hit:1;\n\tu8\t\t annotate_warned:1;\n\tu8\t\t auxtrace_warned:1;\n\tu8\t\t short_name_allocated:1;\n\tu8\t\t long_name_allocated:1;\n\tu8\t\t is_64_bit:1;\n\tbool\t\t sorted_by_name;\n\tbool\t\t loaded;\n\tu8\t\t rel;\n\tstruct build_id\t bid;\n\tu64\t\t text_offset;\n\tconst char\t *short_name;\n\tconst char\t *long_name;\n\tu16\t\t long_name_len;\n\tu16\t\t short_name_len;\n\tvoid\t\t*dwfl;\t\t\t \n\tstruct auxtrace_cache *auxtrace_cache;\n\tint\t\t comp;\n\n\t \n\tstruct {\n\t\tstruct rb_root\t cache;\n\t\tint\t\t fd;\n\t\tint\t\t status;\n\t\tu32\t\t status_seen;\n\t\tu64\t\t file_size;\n\t\tstruct list_head open_entry;\n\t\tu64\t\t elf_base_addr;\n\t\tu64\t\t debug_frame_offset;\n\t\tu64\t\t eh_frame_hdr_addr;\n\t\tu64\t\t eh_frame_hdr_offset;\n\t} data;\n\t \n\tstruct {\n\t\tu32\t\tid;\n\t\tu32\t\tsub_id;\n\t\tstruct perf_env\t*env;\n\t} bpf_prog;\n\n\tunion {  \n\t\tvoid\t *priv;\n\t\tu64\t db_id;\n\t};\n\tstruct nsinfo\t*nsinfo;\n\tstruct dso_id\t id;\n\trefcount_t\t refcnt;\n\tchar\t\t name[];\n};\n\n \n#define dso__for_each_symbol(dso, pos, n)\t\\\n\tsymbols__for_each_entry(&(dso)->symbols, pos, n)\n\n#define dsos__for_each_with_build_id(pos, head)\t\\\n\tlist_for_each_entry(pos, head, node)\t\\\n\t\tif (!pos->has_build_id)\t\t\\\n\t\t\tcontinue;\t\t\\\n\t\telse\n\nstatic inline void dso__set_loaded(struct dso *dso)\n{\n\tdso->loaded = true;\n}\n\nstruct dso *dso__new_id(const char *name, struct dso_id *id);\nstruct dso *dso__new(const char *name);\nvoid dso__delete(struct dso *dso);\n\nint dso__cmp_id(struct dso *a, struct dso *b);\nvoid dso__set_short_name(struct dso *dso, const char *name, bool name_allocated);\nvoid dso__set_long_name(struct dso *dso, const char *name, bool name_allocated);\n\nint dso__name_len(const struct dso *dso);\n\nstruct dso *dso__get(struct dso *dso);\nvoid dso__put(struct dso *dso);\n\nstatic inline void __dso__zput(struct dso **dso)\n{\n\tdso__put(*dso);\n\t*dso = NULL;\n}\n\n#define dso__zput(dso) __dso__zput(&dso)\n\nbool dso__loaded(const struct dso *dso);\n\nstatic inline bool dso__has_symbols(const struct dso *dso)\n{\n\treturn !RB_EMPTY_ROOT(&dso->symbols.rb_root);\n}\n\nchar *dso__filename_with_chroot(const struct dso *dso, const char *filename);\n\nbool dso__sorted_by_name(const struct dso *dso);\nvoid dso__set_sorted_by_name(struct dso *dso);\nvoid dso__sort_by_name(struct dso *dso);\n\nvoid dso__set_build_id(struct dso *dso, struct build_id *bid);\nbool dso__build_id_equal(const struct dso *dso, struct build_id *bid);\nvoid dso__read_running_kernel_build_id(struct dso *dso,\n\t\t\t\t       struct machine *machine);\nint dso__kernel_module_get_build_id(struct dso *dso, const char *root_dir);\n\nchar dso__symtab_origin(const struct dso *dso);\nint dso__read_binary_type_filename(const struct dso *dso, enum dso_binary_type type,\n\t\t\t\t   char *root_dir, char *filename, size_t size);\nbool is_kernel_module(const char *pathname, int cpumode);\nbool dso__needs_decompress(struct dso *dso);\nint dso__decompress_kmodule_fd(struct dso *dso, const char *name);\nint dso__decompress_kmodule_path(struct dso *dso, const char *name,\n\t\t\t\t char *pathname, size_t len);\nint filename__decompress(const char *name, char *pathname,\n\t\t\t size_t len, int comp, int *err);\n\n#define KMOD_DECOMP_NAME  \"/tmp/perf-kmod-XXXXXX\"\n#define KMOD_DECOMP_LEN   sizeof(KMOD_DECOMP_NAME)\n\nstruct kmod_path {\n\tchar *name;\n\tint   comp;\n\tbool  kmod;\n};\n\nint __kmod_path__parse(struct kmod_path *m, const char *path,\n\t\t     bool alloc_name);\n\n#define kmod_path__parse(__m, __p)      __kmod_path__parse(__m, __p, false)\n#define kmod_path__parse_name(__m, __p) __kmod_path__parse(__m, __p, true)\n\nvoid dso__set_module_info(struct dso *dso, struct kmod_path *m,\n\t\t\t  struct machine *machine);\n\n \nint dso__data_get_fd(struct dso *dso, struct machine *machine);\nvoid dso__data_put_fd(struct dso *dso);\nvoid dso__data_close(struct dso *dso);\n\nint dso__data_file_size(struct dso *dso, struct machine *machine);\noff_t dso__data_size(struct dso *dso, struct machine *machine);\nssize_t dso__data_read_offset(struct dso *dso, struct machine *machine,\n\t\t\t      u64 offset, u8 *data, ssize_t size);\nssize_t dso__data_read_addr(struct dso *dso, struct map *map,\n\t\t\t    struct machine *machine, u64 addr,\n\t\t\t    u8 *data, ssize_t size);\nbool dso__data_status_seen(struct dso *dso, enum dso_data_status_seen by);\nssize_t dso__data_write_cache_offs(struct dso *dso, struct machine *machine,\n\t\t\t\t   u64 offset, const u8 *data, ssize_t size);\nssize_t dso__data_write_cache_addr(struct dso *dso, struct map *map,\n\t\t\t\t   struct machine *machine, u64 addr,\n\t\t\t\t   const u8 *data, ssize_t size);\n\nstruct map *dso__new_map(const char *name);\nstruct dso *machine__findnew_kernel(struct machine *machine, const char *name,\n\t\t\t\t    const char *short_name, int dso_type);\n\nvoid dso__reset_find_symbol_cache(struct dso *dso);\n\nsize_t dso__fprintf_symbols_by_name(struct dso *dso, FILE *fp);\nsize_t dso__fprintf(struct dso *dso, FILE *fp);\n\nstatic inline bool dso__is_vmlinux(const struct dso *dso)\n{\n\treturn dso->binary_type == DSO_BINARY_TYPE__VMLINUX ||\n\t       dso->binary_type == DSO_BINARY_TYPE__GUEST_VMLINUX;\n}\n\nstatic inline bool dso__is_kcore(const struct dso *dso)\n{\n\treturn dso->binary_type == DSO_BINARY_TYPE__KCORE ||\n\t       dso->binary_type == DSO_BINARY_TYPE__GUEST_KCORE;\n}\n\nstatic inline bool dso__is_kallsyms(const struct dso *dso)\n{\n\treturn dso->kernel && dso->long_name[0] != '/';\n}\n\nbool dso__is_object_file(const struct dso *dso);\n\nvoid dso__free_a2l(struct dso *dso);\n\nenum dso_type dso__type(struct dso *dso, struct machine *machine);\n\nint dso__strerror_load(struct dso *dso, char *buf, size_t buflen);\n\nvoid reset_fd_limit(void);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}