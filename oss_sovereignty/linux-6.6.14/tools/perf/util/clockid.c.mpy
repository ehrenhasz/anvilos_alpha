{
  "module_name": "clockid.c",
  "hash_id": "00196b4460f5b87d9f62f2dea1de6802aad9235f7417076d5dae54fd8b0e9f45",
  "original_prompt": "Ingested from linux-6.6.14/tools/perf/util/clockid.c",
  "human_readable_source": "\n\n#include <subcmd/parse-options.h>\n#include <stdio.h>\n#include <time.h>\n#include <strings.h>\n#include <linux/time64.h>\n#include \"debug.h\"\n#include \"clockid.h\"\n#include \"record.h\"\n\nstruct clockid_map {\n\tconst char *name;\n\tint clockid;\n};\n\n#define CLOCKID_MAP(n, c)\t\\\n\t{ .name = n, .clockid = (c), }\n\n#define CLOCKID_END\t{ .name = NULL, }\n\n\n \n#ifndef CLOCK_MONOTONIC_RAW\n#define CLOCK_MONOTONIC_RAW 4\n#endif\n#ifndef CLOCK_BOOTTIME\n#define CLOCK_BOOTTIME 7\n#endif\n#ifndef CLOCK_TAI\n#define CLOCK_TAI 11\n#endif\n\nstatic const struct clockid_map clockids[] = {\n\t \n\tCLOCKID_MAP(\"monotonic\", CLOCK_MONOTONIC),\n\tCLOCKID_MAP(\"monotonic_raw\", CLOCK_MONOTONIC_RAW),\n\n\t \n\tCLOCKID_MAP(\"realtime\", CLOCK_REALTIME),\n\tCLOCKID_MAP(\"boottime\", CLOCK_BOOTTIME),\n\tCLOCKID_MAP(\"tai\", CLOCK_TAI),\n\n\t \n\tCLOCKID_MAP(\"mono\", CLOCK_MONOTONIC),\n\tCLOCKID_MAP(\"raw\", CLOCK_MONOTONIC_RAW),\n\tCLOCKID_MAP(\"real\", CLOCK_REALTIME),\n\tCLOCKID_MAP(\"boot\", CLOCK_BOOTTIME),\n\n\tCLOCKID_END,\n};\n\nstatic int get_clockid_res(clockid_t clk_id, u64 *res_ns)\n{\n\tstruct timespec res;\n\n\t*res_ns = 0;\n\tif (!clock_getres(clk_id, &res))\n\t\t*res_ns = res.tv_nsec + res.tv_sec * NSEC_PER_SEC;\n\telse\n\t\tpr_warning(\"WARNING: Failed to determine specified clock resolution.\\n\");\n\n\treturn 0;\n}\n\nint parse_clockid(const struct option *opt, const char *str, int unset)\n{\n\tstruct record_opts *opts = (struct record_opts *)opt->value;\n\tconst struct clockid_map *cm;\n\tconst char *ostr = str;\n\n\tif (unset) {\n\t\topts->use_clockid = 0;\n\t\treturn 0;\n\t}\n\n\t \n\tif (!str)\n\t\treturn 0;\n\n\t \n\tif (opts->use_clockid)\n\t\treturn -1;\n\n\topts->use_clockid = true;\n\n\t \n\tif (sscanf(str, \"%d\", &opts->clockid) == 1)\n\t\treturn get_clockid_res(opts->clockid, &opts->clockid_res_ns);\n\n\t \n\tif (!strncasecmp(str, \"CLOCK_\", 6))\n\t\tstr += 6;\n\n\tfor (cm = clockids; cm->name; cm++) {\n\t\tif (!strcasecmp(str, cm->name)) {\n\t\t\topts->clockid = cm->clockid;\n\t\t\treturn get_clockid_res(opts->clockid,\n\t\t\t\t\t       &opts->clockid_res_ns);\n\t\t}\n\t}\n\n\topts->use_clockid = false;\n\tui__warning(\"unknown clockid %s, check man page\\n\", ostr);\n\treturn -1;\n}\n\nconst char *clockid_name(clockid_t clk_id)\n{\n\tconst struct clockid_map *cm;\n\n\tfor (cm = clockids; cm->name; cm++) {\n\t\tif (cm->clockid == clk_id)\n\t\t\treturn cm->name;\n\t}\n\treturn \"(not found)\";\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}