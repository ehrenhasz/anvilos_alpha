{
  "module_name": "color.c",
  "hash_id": "edb9bbb926cab3b3ce32b1d3e6e5ebf6fc8a2ad2273f6e72c762fbe11e04a40a",
  "original_prompt": "Ingested from linux-6.6.14/tools/perf/util/color.c",
  "human_readable_source": "\n#include <linux/kernel.h>\n#include <subcmd/pager.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <string.h>\n#include \"color.h\"\n#include <math.h>\n#include <unistd.h>\n\nint perf_use_color_default = -1;\n\nstatic int __color_vsnprintf(char *bf, size_t size, const char *color,\n\t\t\t     const char *fmt, va_list args, const char *trail)\n{\n\tint r = 0;\n\n\t \n\tif (perf_use_color_default < 0) {\n\t\tif (isatty(1) || pager_in_use())\n\t\t\tperf_use_color_default = 1;\n\t\telse\n\t\t\tperf_use_color_default = 0;\n\t}\n\n\tif (perf_use_color_default && *color)\n\t\tr += scnprintf(bf, size, \"%s\", color);\n\tr += vscnprintf(bf + r, size - r, fmt, args);\n\tif (perf_use_color_default && *color)\n\t\tr += scnprintf(bf + r, size - r, \"%s\", PERF_COLOR_RESET);\n\tif (trail)\n\t\tr += scnprintf(bf + r, size - r, \"%s\", trail);\n\treturn r;\n}\n\n \nstatic int __color_vfprintf(FILE *fp, const char *color, const char *fmt,\n\t\tva_list args)\n{\n\tint r = 0;\n\n\t \n\tif (perf_use_color_default < 0) {\n\t\tif (isatty(fileno(fp)) || pager_in_use())\n\t\t\tperf_use_color_default = 1;\n\t\telse\n\t\t\tperf_use_color_default = 0;\n\t}\n\n\tif (perf_use_color_default && *color)\n\t\tfprintf(fp, \"%s\", color);\n\tr += vfprintf(fp, fmt, args);\n\tif (perf_use_color_default && *color)\n\t\tfprintf(fp, \"%s\", PERF_COLOR_RESET);\n\treturn r;\n}\n\nint color_vsnprintf(char *bf, size_t size, const char *color,\n\t\t    const char *fmt, va_list args)\n{\n\treturn __color_vsnprintf(bf, size, color, fmt, args, NULL);\n}\n\nint color_vfprintf(FILE *fp, const char *color, const char *fmt, va_list args)\n{\n\treturn __color_vfprintf(fp, color, fmt, args);\n}\n\nint color_snprintf(char *bf, size_t size, const char *color,\n\t\t   const char *fmt, ...)\n{\n\tva_list args;\n\tint r;\n\n\tva_start(args, fmt);\n\tr = color_vsnprintf(bf, size, color, fmt, args);\n\tva_end(args);\n\treturn r;\n}\n\nint color_fprintf(FILE *fp, const char *color, const char *fmt, ...)\n{\n\tva_list args;\n\tint r;\n\n\tva_start(args, fmt);\n\tr = color_vfprintf(fp, color, fmt, args);\n\tva_end(args);\n\treturn r;\n}\n\n \nint color_fwrite_lines(FILE *fp, const char *color,\n\t\tsize_t count, const char *buf)\n{\n\tif (!*color)\n\t\treturn fwrite(buf, count, 1, fp) != 1;\n\n\twhile (count) {\n\t\tchar *p = memchr(buf, '\\n', count);\n\n\t\tif (p != buf && (fputs(color, fp) < 0 ||\n\t\t\t\tfwrite(buf, p ? (size_t)(p - buf) : count, 1, fp) != 1 ||\n\t\t\t\tfputs(PERF_COLOR_RESET, fp) < 0))\n\t\t\treturn -1;\n\t\tif (!p)\n\t\t\treturn 0;\n\t\tif (fputc('\\n', fp) < 0)\n\t\t\treturn -1;\n\t\tcount -= p + 1 - buf;\n\t\tbuf = p + 1;\n\t}\n\treturn 0;\n}\n\nconst char *get_percent_color(double percent)\n{\n\tconst char *color = PERF_COLOR_NORMAL;\n\n\t \n\tif (fabs(percent) >= MIN_RED)\n\t\tcolor = PERF_COLOR_RED;\n\telse {\n\t\tif (fabs(percent) > MIN_GREEN)\n\t\t\tcolor = PERF_COLOR_GREEN;\n\t}\n\treturn color;\n}\n\nint percent_color_fprintf(FILE *fp, const char *fmt, double percent)\n{\n\tint r;\n\tconst char *color;\n\n\tcolor = get_percent_color(percent);\n\tr = color_fprintf(fp, color, fmt, percent);\n\n\treturn r;\n}\n\nint value_color_snprintf(char *bf, size_t size, const char *fmt, double value)\n{\n\tconst char *color = get_percent_color(value);\n\treturn color_snprintf(bf, size, color, fmt, value);\n}\n\nint percent_color_snprintf(char *bf, size_t size, const char *fmt, ...)\n{\n\tva_list args;\n\tdouble percent;\n\n\tva_start(args, fmt);\n\tpercent = va_arg(args, double);\n\tva_end(args);\n\treturn value_color_snprintf(bf, size, fmt, percent);\n}\n\nint percent_color_len_snprintf(char *bf, size_t size, const char *fmt, ...)\n{\n\tva_list args;\n\tint len;\n\tdouble percent;\n\tconst char *color;\n\n\tva_start(args, fmt);\n\tlen = va_arg(args, int);\n\tpercent = va_arg(args, double);\n\tva_end(args);\n\n\tcolor = get_percent_color(percent);\n\treturn color_snprintf(bf, size, color, fmt, len, percent);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}