{
  "module_name": "pstack.c",
  "hash_id": "672e42ac916bafd984aa6b34e1540fad1f2ba6a77f136f322a5c8a842f2f8ec1",
  "original_prompt": "Ingested from linux-6.6.14/tools/perf/util/pstack.c",
  "human_readable_source": "\n \n\n#include \"pstack.h\"\n#include \"debug.h\"\n#include <linux/kernel.h>\n#include <linux/zalloc.h>\n#include <stdlib.h>\n#include <string.h>\n\nstruct pstack {\n\tunsigned short\ttop;\n\tunsigned short\tmax_nr_entries;\n\tvoid\t\t*entries[];\n};\n\nstruct pstack *pstack__new(unsigned short max_nr_entries)\n{\n\tstruct pstack *pstack = zalloc((sizeof(*pstack) +\n\t\t\t\t       max_nr_entries * sizeof(void *)));\n\tif (pstack != NULL)\n\t\tpstack->max_nr_entries = max_nr_entries;\n\treturn pstack;\n}\n\nvoid pstack__delete(struct pstack *pstack)\n{\n\tfree(pstack);\n}\n\nbool pstack__empty(const struct pstack *pstack)\n{\n\treturn pstack->top == 0;\n}\n\nvoid pstack__remove(struct pstack *pstack, void *key)\n{\n\tunsigned short i = pstack->top, last_index = pstack->top - 1;\n\n\twhile (i-- != 0) {\n\t\tif (pstack->entries[i] == key) {\n\t\t\tif (i < last_index)\n\t\t\t\tmemmove(pstack->entries + i,\n\t\t\t\t\tpstack->entries + i + 1,\n\t\t\t\t\t(last_index - i) * sizeof(void *));\n\t\t\t--pstack->top;\n\t\t\treturn;\n\t\t}\n\t}\n\tpr_err(\"%s: %p not on the pstack!\\n\", __func__, key);\n}\n\nvoid pstack__push(struct pstack *pstack, void *key)\n{\n\tif (pstack->top == pstack->max_nr_entries) {\n\t\tpr_err(\"%s: top=%d, overflow!\\n\", __func__, pstack->top);\n\t\treturn;\n\t}\n\tpstack->entries[pstack->top++] = key;\n}\n\nvoid *pstack__pop(struct pstack *pstack)\n{\n\tvoid *ret;\n\n\tif (pstack->top == 0) {\n\t\tpr_err(\"%s: underflow!\\n\", __func__);\n\t\treturn NULL;\n\t}\n\n\tret = pstack->entries[--pstack->top];\n\tpstack->entries[pstack->top] = NULL;\n\treturn ret;\n}\n\nvoid *pstack__peek(struct pstack *pstack)\n{\n\tif (pstack->top == 0)\n\t\treturn NULL;\n\treturn pstack->entries[pstack->top - 1];\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}