{
  "module_name": "perf_event_attr_fprintf.c",
  "hash_id": "b6e2a23b496bfe0ef983b86d691b8e7c30b238be28407a8af0c5cb011998044e",
  "original_prompt": "Ingested from linux-6.6.14/tools/perf/util/perf_event_attr_fprintf.c",
  "human_readable_source": "\n#include <inttypes.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdbool.h>\n#include <linux/kernel.h>\n#include <linux/types.h>\n#include <linux/perf_event.h>\n#include \"util/evsel_fprintf.h\"\n#include \"trace-event.h\"\n\nstruct bit_names {\n\tint bit;\n\tconst char *name;\n};\n\nstatic void __p_bits(char *buf, size_t size, u64 value, struct bit_names *bits)\n{\n\tbool first_bit = true;\n\tint i = 0;\n\n\tdo {\n\t\tif (value & bits[i].bit) {\n\t\t\tbuf += scnprintf(buf, size, \"%s%s\", first_bit ? \"\" : \"|\", bits[i].name);\n\t\t\tfirst_bit = false;\n\t\t}\n\t} while (bits[++i].name != NULL);\n}\n\nstatic void __p_sample_type(char *buf, size_t size, u64 value)\n{\n#define bit_name(n) { PERF_SAMPLE_##n, #n }\n\tstruct bit_names bits[] = {\n\t\tbit_name(IP), bit_name(TID), bit_name(TIME), bit_name(ADDR),\n\t\tbit_name(READ), bit_name(CALLCHAIN), bit_name(ID), bit_name(CPU),\n\t\tbit_name(PERIOD), bit_name(STREAM_ID), bit_name(RAW),\n\t\tbit_name(BRANCH_STACK), bit_name(REGS_USER), bit_name(STACK_USER),\n\t\tbit_name(IDENTIFIER), bit_name(REGS_INTR), bit_name(DATA_SRC),\n\t\tbit_name(WEIGHT), bit_name(PHYS_ADDR), bit_name(AUX),\n\t\tbit_name(CGROUP), bit_name(DATA_PAGE_SIZE), bit_name(CODE_PAGE_SIZE),\n\t\tbit_name(WEIGHT_STRUCT),\n\t\t{ .name = NULL, }\n\t};\n#undef bit_name\n\t__p_bits(buf, size, value, bits);\n}\n\nstatic void __p_branch_sample_type(char *buf, size_t size, u64 value)\n{\n#define bit_name(n) { PERF_SAMPLE_BRANCH_##n, #n }\n\tstruct bit_names bits[] = {\n\t\tbit_name(USER), bit_name(KERNEL), bit_name(HV), bit_name(ANY),\n\t\tbit_name(ANY_CALL), bit_name(ANY_RETURN), bit_name(IND_CALL),\n\t\tbit_name(ABORT_TX), bit_name(IN_TX), bit_name(NO_TX),\n\t\tbit_name(COND), bit_name(CALL_STACK), bit_name(IND_JUMP),\n\t\tbit_name(CALL), bit_name(NO_FLAGS), bit_name(NO_CYCLES),\n\t\tbit_name(TYPE_SAVE), bit_name(HW_INDEX), bit_name(PRIV_SAVE),\n\t\t{ .name = NULL, }\n\t};\n#undef bit_name\n\t__p_bits(buf, size, value, bits);\n}\n\nstatic void __p_read_format(char *buf, size_t size, u64 value)\n{\n#define bit_name(n) { PERF_FORMAT_##n, #n }\n\tstruct bit_names bits[] = {\n\t\tbit_name(TOTAL_TIME_ENABLED), bit_name(TOTAL_TIME_RUNNING),\n\t\tbit_name(ID), bit_name(GROUP), bit_name(LOST),\n\t\t{ .name = NULL, }\n\t};\n#undef bit_name\n\t__p_bits(buf, size, value, bits);\n}\n\n#define ENUM_ID_TO_STR_CASE(x) case x: return (#x);\nstatic const char *stringify_perf_type_id(u64 value)\n{\n\tswitch (value) {\n\tENUM_ID_TO_STR_CASE(PERF_TYPE_HARDWARE)\n\tENUM_ID_TO_STR_CASE(PERF_TYPE_SOFTWARE)\n\tENUM_ID_TO_STR_CASE(PERF_TYPE_TRACEPOINT)\n\tENUM_ID_TO_STR_CASE(PERF_TYPE_HW_CACHE)\n\tENUM_ID_TO_STR_CASE(PERF_TYPE_RAW)\n\tENUM_ID_TO_STR_CASE(PERF_TYPE_BREAKPOINT)\n\tdefault:\n\t\treturn NULL;\n\t}\n}\n\nstatic const char *stringify_perf_hw_id(u64 value)\n{\n\tswitch (value) {\n\tENUM_ID_TO_STR_CASE(PERF_COUNT_HW_CPU_CYCLES)\n\tENUM_ID_TO_STR_CASE(PERF_COUNT_HW_INSTRUCTIONS)\n\tENUM_ID_TO_STR_CASE(PERF_COUNT_HW_CACHE_REFERENCES)\n\tENUM_ID_TO_STR_CASE(PERF_COUNT_HW_CACHE_MISSES)\n\tENUM_ID_TO_STR_CASE(PERF_COUNT_HW_BRANCH_INSTRUCTIONS)\n\tENUM_ID_TO_STR_CASE(PERF_COUNT_HW_BRANCH_MISSES)\n\tENUM_ID_TO_STR_CASE(PERF_COUNT_HW_BUS_CYCLES)\n\tENUM_ID_TO_STR_CASE(PERF_COUNT_HW_STALLED_CYCLES_FRONTEND)\n\tENUM_ID_TO_STR_CASE(PERF_COUNT_HW_STALLED_CYCLES_BACKEND)\n\tENUM_ID_TO_STR_CASE(PERF_COUNT_HW_REF_CPU_CYCLES)\n\tdefault:\n\t\treturn NULL;\n\t}\n}\n\nstatic const char *stringify_perf_hw_cache_id(u64 value)\n{\n\tswitch (value) {\n\tENUM_ID_TO_STR_CASE(PERF_COUNT_HW_CACHE_L1D)\n\tENUM_ID_TO_STR_CASE(PERF_COUNT_HW_CACHE_L1I)\n\tENUM_ID_TO_STR_CASE(PERF_COUNT_HW_CACHE_LL)\n\tENUM_ID_TO_STR_CASE(PERF_COUNT_HW_CACHE_DTLB)\n\tENUM_ID_TO_STR_CASE(PERF_COUNT_HW_CACHE_ITLB)\n\tENUM_ID_TO_STR_CASE(PERF_COUNT_HW_CACHE_BPU)\n\tENUM_ID_TO_STR_CASE(PERF_COUNT_HW_CACHE_NODE)\n\tdefault:\n\t\treturn NULL;\n\t}\n}\n\nstatic const char *stringify_perf_hw_cache_op_id(u64 value)\n{\n\tswitch (value) {\n\tENUM_ID_TO_STR_CASE(PERF_COUNT_HW_CACHE_OP_READ)\n\tENUM_ID_TO_STR_CASE(PERF_COUNT_HW_CACHE_OP_WRITE)\n\tENUM_ID_TO_STR_CASE(PERF_COUNT_HW_CACHE_OP_PREFETCH)\n\tdefault:\n\t\treturn NULL;\n\t}\n}\n\nstatic const char *stringify_perf_hw_cache_op_result_id(u64 value)\n{\n\tswitch (value) {\n\tENUM_ID_TO_STR_CASE(PERF_COUNT_HW_CACHE_RESULT_ACCESS)\n\tENUM_ID_TO_STR_CASE(PERF_COUNT_HW_CACHE_RESULT_MISS)\n\tdefault:\n\t\treturn NULL;\n\t}\n}\n\nstatic const char *stringify_perf_sw_id(u64 value)\n{\n\tswitch (value) {\n\tENUM_ID_TO_STR_CASE(PERF_COUNT_SW_CPU_CLOCK)\n\tENUM_ID_TO_STR_CASE(PERF_COUNT_SW_TASK_CLOCK)\n\tENUM_ID_TO_STR_CASE(PERF_COUNT_SW_PAGE_FAULTS)\n\tENUM_ID_TO_STR_CASE(PERF_COUNT_SW_CONTEXT_SWITCHES)\n\tENUM_ID_TO_STR_CASE(PERF_COUNT_SW_CPU_MIGRATIONS)\n\tENUM_ID_TO_STR_CASE(PERF_COUNT_SW_PAGE_FAULTS_MIN)\n\tENUM_ID_TO_STR_CASE(PERF_COUNT_SW_PAGE_FAULTS_MAJ)\n\tENUM_ID_TO_STR_CASE(PERF_COUNT_SW_ALIGNMENT_FAULTS)\n\tENUM_ID_TO_STR_CASE(PERF_COUNT_SW_EMULATION_FAULTS)\n\tENUM_ID_TO_STR_CASE(PERF_COUNT_SW_DUMMY)\n\tENUM_ID_TO_STR_CASE(PERF_COUNT_SW_BPF_OUTPUT)\n\tENUM_ID_TO_STR_CASE(PERF_COUNT_SW_CGROUP_SWITCHES)\n\tdefault:\n\t\treturn NULL;\n\t}\n}\n#undef ENUM_ID_TO_STR_CASE\n\n#define PRINT_ID(_s, _f)\t\t\t\t\t\\\ndo {\t\t\t\t\t\t\t\t\\\n\tconst char *__s = _s;\t\t\t\t\t\\\n\tif (__s == NULL)\t\t\t\t\t\\\n\t\tsnprintf(buf, size, _f, value);\t\t\t\\\n\telse\t\t\t\t\t\t\t\\\n\t\tsnprintf(buf, size, _f\" (%s)\", value, __s);\t\\\n} while (0)\n#define print_id_unsigned(_s)\tPRINT_ID(_s, \"%\"PRIu64)\n#define print_id_hex(_s)\tPRINT_ID(_s, \"%#\"PRIx64)\n\nstatic void __p_type_id(char *buf, size_t size, u64 value)\n{\n\tprint_id_unsigned(stringify_perf_type_id(value));\n}\n\nstatic void __p_config_hw_id(char *buf, size_t size, u64 value)\n{\n\tprint_id_hex(stringify_perf_hw_id(value));\n}\n\nstatic void __p_config_sw_id(char *buf, size_t size, u64 value)\n{\n\tprint_id_hex(stringify_perf_sw_id(value));\n}\n\nstatic void __p_config_hw_cache_id(char *buf, size_t size, u64 value)\n{\n\tconst char *hw_cache_str = stringify_perf_hw_cache_id(value & 0xff);\n\tconst char *hw_cache_op_str =\n\t\tstringify_perf_hw_cache_op_id((value & 0xff00) >> 8);\n\tconst char *hw_cache_op_result_str =\n\t\tstringify_perf_hw_cache_op_result_id((value & 0xff0000) >> 16);\n\n\tif (hw_cache_str == NULL || hw_cache_op_str == NULL ||\n\t    hw_cache_op_result_str == NULL) {\n\t\tsnprintf(buf, size, \"%#\"PRIx64, value);\n\t} else {\n\t\tsnprintf(buf, size, \"%#\"PRIx64\" (%s | %s | %s)\", value,\n\t\t\t hw_cache_op_result_str, hw_cache_op_str, hw_cache_str);\n\t}\n}\n\n#ifdef HAVE_LIBTRACEEVENT\nstatic void __p_config_tracepoint_id(char *buf, size_t size, u64 value)\n{\n\tchar *str = tracepoint_id_to_name(value);\n\n\tprint_id_hex(str);\n\tfree(str);\n}\n#endif\n\nstatic void __p_config_id(char *buf, size_t size, u32 type, u64 value)\n{\n\tswitch (type) {\n\tcase PERF_TYPE_HARDWARE:\n\t\treturn __p_config_hw_id(buf, size, value);\n\tcase PERF_TYPE_SOFTWARE:\n\t\treturn __p_config_sw_id(buf, size, value);\n\tcase PERF_TYPE_HW_CACHE:\n\t\treturn __p_config_hw_cache_id(buf, size, value);\n\tcase PERF_TYPE_TRACEPOINT:\n#ifdef HAVE_LIBTRACEEVENT\n\t\treturn __p_config_tracepoint_id(buf, size, value);\n#endif\n\tcase PERF_TYPE_RAW:\n\tcase PERF_TYPE_BREAKPOINT:\n\tdefault:\n\t\tsnprintf(buf, size, \"%#\"PRIx64, value);\n\t\treturn;\n\t}\n}\n\n#define BUF_SIZE\t\t1024\n\n#define p_hex(val)\t\tsnprintf(buf, BUF_SIZE, \"%#\"PRIx64, (uint64_t)(val))\n#define p_unsigned(val)\t\tsnprintf(buf, BUF_SIZE, \"%\"PRIu64, (uint64_t)(val))\n#define p_signed(val)\t\tsnprintf(buf, BUF_SIZE, \"%\"PRId64, (int64_t)(val))\n#define p_sample_type(val)\t__p_sample_type(buf, BUF_SIZE, val)\n#define p_branch_sample_type(val) __p_branch_sample_type(buf, BUF_SIZE, val)\n#define p_read_format(val)\t__p_read_format(buf, BUF_SIZE, val)\n#define p_type_id(val)\t\t__p_type_id(buf, BUF_SIZE, val)\n#define p_config_id(val)\t__p_config_id(buf, BUF_SIZE, attr->type, val)\n\n#define PRINT_ATTRn(_n, _f, _p, _a)\t\t\t\\\ndo {\t\t\t\t\t\t\t\\\n\tif (_a || attr->_f) {\t\t\t\t\\\n\t\t_p(attr->_f);\t\t\t\t\\\n\t\tret += attr__fprintf(fp, _n, buf, priv);\\\n\t}\t\t\t\t\t\t\\\n} while (0)\n\n#define PRINT_ATTRf(_f, _p)\tPRINT_ATTRn(#_f, _f, _p, false)\n\nint perf_event_attr__fprintf(FILE *fp, struct perf_event_attr *attr,\n\t\t\t     attr__fprintf_f attr__fprintf, void *priv)\n{\n\tchar buf[BUF_SIZE];\n\tint ret = 0;\n\n\tPRINT_ATTRn(\"type\", type, p_type_id, true);\n\tPRINT_ATTRf(size, p_unsigned);\n\tPRINT_ATTRn(\"config\", config, p_config_id, true);\n\tPRINT_ATTRn(\"{ sample_period, sample_freq }\", sample_period, p_unsigned, false);\n\tPRINT_ATTRf(sample_type, p_sample_type);\n\tPRINT_ATTRf(read_format, p_read_format);\n\n\tPRINT_ATTRf(disabled, p_unsigned);\n\tPRINT_ATTRf(inherit, p_unsigned);\n\tPRINT_ATTRf(pinned, p_unsigned);\n\tPRINT_ATTRf(exclusive, p_unsigned);\n\tPRINT_ATTRf(exclude_user, p_unsigned);\n\tPRINT_ATTRf(exclude_kernel, p_unsigned);\n\tPRINT_ATTRf(exclude_hv, p_unsigned);\n\tPRINT_ATTRf(exclude_idle, p_unsigned);\n\tPRINT_ATTRf(mmap, p_unsigned);\n\tPRINT_ATTRf(comm, p_unsigned);\n\tPRINT_ATTRf(freq, p_unsigned);\n\tPRINT_ATTRf(inherit_stat, p_unsigned);\n\tPRINT_ATTRf(enable_on_exec, p_unsigned);\n\tPRINT_ATTRf(task, p_unsigned);\n\tPRINT_ATTRf(watermark, p_unsigned);\n\tPRINT_ATTRf(precise_ip, p_unsigned);\n\tPRINT_ATTRf(mmap_data, p_unsigned);\n\tPRINT_ATTRf(sample_id_all, p_unsigned);\n\tPRINT_ATTRf(exclude_host, p_unsigned);\n\tPRINT_ATTRf(exclude_guest, p_unsigned);\n\tPRINT_ATTRf(exclude_callchain_kernel, p_unsigned);\n\tPRINT_ATTRf(exclude_callchain_user, p_unsigned);\n\tPRINT_ATTRf(mmap2, p_unsigned);\n\tPRINT_ATTRf(comm_exec, p_unsigned);\n\tPRINT_ATTRf(use_clockid, p_unsigned);\n\tPRINT_ATTRf(context_switch, p_unsigned);\n\tPRINT_ATTRf(write_backward, p_unsigned);\n\tPRINT_ATTRf(namespaces, p_unsigned);\n\tPRINT_ATTRf(ksymbol, p_unsigned);\n\tPRINT_ATTRf(bpf_event, p_unsigned);\n\tPRINT_ATTRf(aux_output, p_unsigned);\n\tPRINT_ATTRf(cgroup, p_unsigned);\n\tPRINT_ATTRf(text_poke, p_unsigned);\n\tPRINT_ATTRf(build_id, p_unsigned);\n\tPRINT_ATTRf(inherit_thread, p_unsigned);\n\tPRINT_ATTRf(remove_on_exec, p_unsigned);\n\tPRINT_ATTRf(sigtrap, p_unsigned);\n\n\tPRINT_ATTRn(\"{ wakeup_events, wakeup_watermark }\", wakeup_events, p_unsigned, false);\n\tPRINT_ATTRf(bp_type, p_unsigned);\n\tPRINT_ATTRn(\"{ bp_addr, config1 }\", bp_addr, p_hex, false);\n\tPRINT_ATTRn(\"{ bp_len, config2 }\", bp_len, p_hex, false);\n\tPRINT_ATTRf(branch_sample_type, p_branch_sample_type);\n\tPRINT_ATTRf(sample_regs_user, p_hex);\n\tPRINT_ATTRf(sample_stack_user, p_unsigned);\n\tPRINT_ATTRf(clockid, p_signed);\n\tPRINT_ATTRf(sample_regs_intr, p_hex);\n\tPRINT_ATTRf(aux_watermark, p_unsigned);\n\tPRINT_ATTRf(sample_max_stack, p_unsigned);\n\tPRINT_ATTRf(aux_sample_size, p_unsigned);\n\tPRINT_ATTRf(sig_data, p_unsigned);\n\n\treturn ret;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}