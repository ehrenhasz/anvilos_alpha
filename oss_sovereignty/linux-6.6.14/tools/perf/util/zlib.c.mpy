{
  "module_name": "zlib.c",
  "hash_id": "6b7d346c4182d8a02e10e1b60986a8651359de53b4f2fbc53a90f32dbe8edab3",
  "original_prompt": "Ingested from linux-6.6.14/tools/perf/util/zlib.c",
  "human_readable_source": "\n#include <fcntl.h>\n#include <stdio.h>\n#include <string.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mman.h>\n#include <zlib.h>\n#include <linux/compiler.h>\n#include <internal/lib.h>\n\n#include \"util/compress.h\"\n\n#define CHUNK_SIZE  16384\n\nint gzip_decompress_to_file(const char *input, int output_fd)\n{\n\tint ret = Z_STREAM_ERROR;\n\tint input_fd;\n\tvoid *ptr;\n\tint len;\n\tstruct stat stbuf;\n\tunsigned char buf[CHUNK_SIZE];\n\tz_stream zs = {\n\t\t.zalloc\t\t= Z_NULL,\n\t\t.zfree\t\t= Z_NULL,\n\t\t.opaque\t\t= Z_NULL,\n\t\t.avail_in\t= 0,\n\t\t.next_in\t= Z_NULL,\n\t};\n\n\tinput_fd = open(input, O_RDONLY);\n\tif (input_fd < 0)\n\t\treturn -1;\n\n\tif (fstat(input_fd, &stbuf) < 0)\n\t\tgoto out_close;\n\n\tptr = mmap(NULL, stbuf.st_size, PROT_READ, MAP_PRIVATE, input_fd, 0);\n\tif (ptr == MAP_FAILED)\n\t\tgoto out_close;\n\n\tif (inflateInit2(&zs, 16 + MAX_WBITS) != Z_OK)\n\t\tgoto out_unmap;\n\n\tzs.next_in = ptr;\n\tzs.avail_in = stbuf.st_size;\n\n\tdo {\n\t\tzs.next_out = buf;\n\t\tzs.avail_out = CHUNK_SIZE;\n\n\t\tret = inflate(&zs, Z_NO_FLUSH);\n\t\tswitch (ret) {\n\t\tcase Z_NEED_DICT:\n\t\t\tret = Z_DATA_ERROR;\n\t\t\t \n\t\tcase Z_DATA_ERROR:\n\t\tcase Z_MEM_ERROR:\n\t\t\tgoto out;\n\t\tdefault:\n\t\t\tbreak;\n\t\t}\n\n\t\tlen = CHUNK_SIZE - zs.avail_out;\n\t\tif (writen(output_fd, buf, len) != len) {\n\t\t\tret = Z_DATA_ERROR;\n\t\t\tgoto out;\n\t\t}\n\n\t} while (ret != Z_STREAM_END);\n\nout:\n\tinflateEnd(&zs);\nout_unmap:\n\tmunmap(ptr, stbuf.st_size);\nout_close:\n\tclose(input_fd);\n\n\treturn ret == Z_STREAM_END ? 0 : -1;\n}\n\nbool gzip_is_compressed(const char *input)\n{\n\tint fd = open(input, O_RDONLY);\n\tconst uint8_t magic[2] = { 0x1f, 0x8b };\n\tchar buf[2] = { 0 };\n\tssize_t rc;\n\n\tif (fd < 0)\n\t\treturn -1;\n\n\trc = read(fd, buf, sizeof(buf));\n\tclose(fd);\n\treturn rc == sizeof(buf) ?\n\t       memcmp(buf, magic, sizeof(buf)) == 0 : false;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}