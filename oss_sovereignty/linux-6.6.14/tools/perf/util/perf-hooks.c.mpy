{
  "module_name": "perf-hooks.c",
  "hash_id": "7ad66b7f9443d453ed1e7a66b460d5629884701416555af50c8facc0e27d8c97",
  "original_prompt": "Ingested from linux-6.6.14/tools/perf/util/perf-hooks.c",
  "human_readable_source": "\n \n\n#include <errno.h>\n#include <stdlib.h>\n#include <string.h>\n#include <setjmp.h>\n#include <linux/err.h>\n#include <linux/kernel.h>\n#include \"util/debug.h\"\n#include \"util/perf-hooks.h\"\n\nstatic sigjmp_buf jmpbuf;\nstatic const struct perf_hook_desc *current_perf_hook;\n\nvoid perf_hooks__invoke(const struct perf_hook_desc *desc)\n{\n\tif (!(desc && desc->p_hook_func && *desc->p_hook_func))\n\t\treturn;\n\n\tif (sigsetjmp(jmpbuf, 1)) {\n\t\tpr_warning(\"Fatal error (SEGFAULT) in perf hook '%s'\\n\",\n\t\t\t   desc->hook_name);\n\t\t*(current_perf_hook->p_hook_func) = NULL;\n\t} else {\n\t\tcurrent_perf_hook = desc;\n\t\t(**desc->p_hook_func)(desc->hook_ctx);\n\t}\n\tcurrent_perf_hook = NULL;\n}\n\nvoid perf_hooks__recover(void)\n{\n\tif (current_perf_hook)\n\t\tsiglongjmp(jmpbuf, 1);\n}\n\n#define PERF_HOOK(name)\t\t\t\t\t\\\nperf_hook_func_t __perf_hook_func_##name = NULL;\t\\\nstruct perf_hook_desc __perf_hook_desc_##name =\t\t\\\n\t{.hook_name = #name,\t\t\t\t\\\n\t .p_hook_func = &__perf_hook_func_##name,\t\\\n\t .hook_ctx = NULL};\n#include \"perf-hooks-list.h\"\n#undef PERF_HOOK\n\n#define PERF_HOOK(name)\t\t\\\n\t&__perf_hook_desc_##name,\n\nstatic struct perf_hook_desc *perf_hooks[] = {\n#include \"perf-hooks-list.h\"\n};\n#undef PERF_HOOK\n\nint perf_hooks__set_hook(const char *hook_name,\n\t\t\t perf_hook_func_t hook_func,\n\t\t\t void *hook_ctx)\n{\n\tunsigned int i;\n\n\tfor (i = 0; i < ARRAY_SIZE(perf_hooks); i++) {\n\t\tif (strcmp(hook_name, perf_hooks[i]->hook_name) != 0)\n\t\t\tcontinue;\n\n\t\tif (*(perf_hooks[i]->p_hook_func))\n\t\t\tpr_warning(\"Overwrite existing hook: %s\\n\", hook_name);\n\t\t*(perf_hooks[i]->p_hook_func) = hook_func;\n\t\tperf_hooks[i]->hook_ctx = hook_ctx;\n\t\treturn 0;\n\t}\n\treturn -ENOENT;\n}\n\nperf_hook_func_t perf_hooks__get_hook(const char *hook_name)\n{\n\tunsigned int i;\n\n\tfor (i = 0; i < ARRAY_SIZE(perf_hooks); i++) {\n\t\tif (strcmp(hook_name, perf_hooks[i]->hook_name) != 0)\n\t\t\tcontinue;\n\n\t\treturn *(perf_hooks[i]->p_hook_func);\n\t}\n\treturn ERR_PTR(-ENOENT);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}