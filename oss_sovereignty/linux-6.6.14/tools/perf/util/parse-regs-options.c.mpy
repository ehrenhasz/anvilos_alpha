{
  "module_name": "parse-regs-options.c",
  "hash_id": "fd17025505f9a9db5397db698b93f1476c6b57c234316e9459ac0fc140e19084",
  "original_prompt": "Ingested from linux-6.6.14/tools/perf/util/parse-regs-options.c",
  "human_readable_source": "\n#include <stdbool.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <string.h>\n#include <stdio.h>\n#include \"util/debug.h\"\n#include <subcmd/parse-options.h>\n#include \"util/perf_regs.h\"\n#include \"util/parse-regs-options.h\"\n\nstatic int\n__parse_regs(const struct option *opt, const char *str, int unset, bool intr)\n{\n\tuint64_t *mode = (uint64_t *)opt->value;\n\tconst struct sample_reg *r = NULL;\n\tchar *s, *os = NULL, *p;\n\tint ret = -1;\n\tuint64_t mask;\n\n\tif (unset)\n\t\treturn 0;\n\n\t \n\tif (*mode)\n\t\treturn -1;\n\n\tif (intr)\n\t\tmask = arch__intr_reg_mask();\n\telse\n\t\tmask = arch__user_reg_mask();\n\n\t \n\tif (str) {\n\t\t \n\t\ts = os = strdup(str);\n\t\tif (!s)\n\t\t\treturn -1;\n\n\t\tfor (;;) {\n\t\t\tp = strchr(s, ',');\n\t\t\tif (p)\n\t\t\t\t*p = '\\0';\n\n\t\t\tif (!strcmp(s, \"?\")) {\n\t\t\t\tfprintf(stderr, \"available registers: \");\n#ifdef HAVE_PERF_REGS_SUPPORT\n\t\t\t\tfor (r = sample_reg_masks; r->name; r++) {\n\t\t\t\t\tif (r->mask & mask)\n\t\t\t\t\t\tfprintf(stderr, \"%s \", r->name);\n\t\t\t\t}\n#endif\n\t\t\t\tfputc('\\n', stderr);\n\t\t\t\t \n\t\t\t\tgoto error;\n\t\t\t}\n#ifdef HAVE_PERF_REGS_SUPPORT\n\t\t\tfor (r = sample_reg_masks; r->name; r++) {\n\t\t\t\tif ((r->mask & mask) && !strcasecmp(s, r->name))\n\t\t\t\t\tbreak;\n\t\t\t}\n#endif\n\t\t\tif (!r || !r->name) {\n\t\t\t\tui__warning(\"Unknown register \\\"%s\\\", check man page or run \\\"perf record %s?\\\"\\n\",\n\t\t\t\t\t    s, intr ? \"-I\" : \"--user-regs=\");\n\t\t\t\tgoto error;\n\t\t\t}\n\n\t\t\t*mode |= r->mask;\n\n\t\t\tif (!p)\n\t\t\t\tbreak;\n\n\t\t\ts = p + 1;\n\t\t}\n\t}\n\tret = 0;\n\n\t \n\tif (*mode == 0)\n\t\t*mode = mask;\nerror:\n\tfree(os);\n\treturn ret;\n}\n\nint\nparse_user_regs(const struct option *opt, const char *str, int unset)\n{\n\treturn __parse_regs(opt, str, unset, false);\n}\n\nint\nparse_intr_regs(const struct option *opt, const char *str, int unset)\n{\n\treturn __parse_regs(opt, str, unset, true);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}