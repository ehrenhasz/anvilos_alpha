{
  "module_name": "trace-event.c",
  "hash_id": "b17621346fc0b1fedd97c29208c30ce3d9a178dac72bad34de05881f913fca29",
  "original_prompt": "Ingested from linux-6.6.14/tools/perf/util/trace-event.c",
  "human_readable_source": "\n#include <stdio.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <linux/kernel.h>\n#include <linux/err.h>\n#include <traceevent/event-parse.h>\n#include <api/fs/tracing_path.h>\n#include <api/fs/fs.h>\n#include \"trace-event.h\"\n#include \"machine.h\"\n\n \nstatic struct trace_event tevent;\nstatic bool tevent_initialized;\n\nint trace_event__init(struct trace_event *t)\n{\n\tstruct tep_handle *pevent = tep_alloc();\n\n\tif (pevent) {\n\t\tt->plugin_list = tep_load_plugins(pevent);\n\t\tt->pevent  = pevent;\n\t}\n\n\treturn pevent ? 0 : -1;\n}\n\nstatic int trace_event__init2(void)\n{\n\tint be = tep_is_bigendian();\n\tstruct tep_handle *pevent;\n\n\tif (trace_event__init(&tevent))\n\t\treturn -1;\n\n\tpevent = tevent.pevent;\n\ttep_set_flag(pevent, TEP_NSEC_OUTPUT);\n\ttep_set_file_bigendian(pevent, be);\n\ttep_set_local_bigendian(pevent, be);\n\ttevent_initialized = true;\n\treturn 0;\n}\n\nint trace_event__register_resolver(struct machine *machine,\n\t\t\t\t   tep_func_resolver_t *func)\n{\n\tif (!tevent_initialized && trace_event__init2())\n\t\treturn -1;\n\n\treturn tep_set_function_resolver(tevent.pevent, func, machine);\n}\n\nvoid trace_event__cleanup(struct trace_event *t)\n{\n\ttep_unload_plugins(t->plugin_list, t->pevent);\n\ttep_free(t->pevent);\n}\n\n \nstatic struct tep_event*\ntp_format(const char *sys, const char *name)\n{\n\tchar *tp_dir = get_events_file(sys);\n\tstruct tep_handle *pevent = tevent.pevent;\n\tstruct tep_event *event = NULL;\n\tchar path[PATH_MAX];\n\tsize_t size;\n\tchar *data;\n\tint err;\n\n\tif (!tp_dir)\n\t\treturn ERR_PTR(-errno);\n\n\tscnprintf(path, PATH_MAX, \"%s/%s/format\", tp_dir, name);\n\tput_events_file(tp_dir);\n\n\terr = filename__read_str(path, &data, &size);\n\tif (err)\n\t\treturn ERR_PTR(err);\n\n\ttep_parse_format(pevent, &event, data, size, sys);\n\n\tfree(data);\n\treturn event;\n}\n\n \nstruct tep_event*\ntrace_event__tp_format(const char *sys, const char *name)\n{\n\tif (!tevent_initialized && trace_event__init2())\n\t\treturn ERR_PTR(-ENOMEM);\n\n\treturn tp_format(sys, name);\n}\n\nstruct tep_event *trace_event__tp_format_id(int id)\n{\n\tif (!tevent_initialized && trace_event__init2())\n\t\treturn ERR_PTR(-ENOMEM);\n\n\treturn tep_find_event(tevent.pevent, id);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}