{
  "module_name": "bpf_prog_profiler.bpf.c",
  "hash_id": "b1c13c82ea0f32b20b4a3f5a1bd195d821df04d86872bd85022b1b8e90dfe2b0",
  "original_prompt": "Ingested from linux-6.6.14/tools/perf/util/bpf_skel/bpf_prog_profiler.bpf.c",
  "human_readable_source": "\n\n#include \"vmlinux.h\"\n#include <bpf/bpf_helpers.h>\n#include <bpf/bpf_tracing.h>\n\n \nstruct {\n\t__uint(type, BPF_MAP_TYPE_PERF_EVENT_ARRAY);\n\t__uint(key_size, sizeof(__u32));\n\t__uint(value_size, sizeof(int));\n} events SEC(\".maps\");\n\n \nstruct {\n\t__uint(type, BPF_MAP_TYPE_PERCPU_ARRAY);\n\t__uint(key_size, sizeof(__u32));\n\t__uint(value_size, sizeof(struct bpf_perf_event_value));\n\t__uint(max_entries, 1);\n} fentry_readings SEC(\".maps\");\n\n \nstruct {\n\t__uint(type, BPF_MAP_TYPE_PERCPU_ARRAY);\n\t__uint(key_size, sizeof(__u32));\n\t__uint(value_size, sizeof(struct bpf_perf_event_value));\n\t__uint(max_entries, 1);\n} accum_readings SEC(\".maps\");\n\nconst volatile __u32 num_cpu = 1;\n\nSEC(\"fentry/XXX\")\nint BPF_PROG(fentry_XXX)\n{\n\t__u32 key = bpf_get_smp_processor_id();\n\tstruct bpf_perf_event_value *ptr;\n\t__u32 zero = 0;\n\tlong err;\n\n\t \n\tptr = bpf_map_lookup_elem(&fentry_readings, &zero);\n\tif (!ptr)\n\t\treturn 0;\n\n\terr = bpf_perf_event_read_value(&events, key, ptr, sizeof(*ptr));\n\tif (err)\n\t\treturn 0;\n\n\treturn 0;\n}\n\nstatic inline void\nfexit_update_maps(struct bpf_perf_event_value *after)\n{\n\tstruct bpf_perf_event_value *before, diff;\n\t__u32 zero = 0;\n\n\tbefore = bpf_map_lookup_elem(&fentry_readings, &zero);\n\t \n\tif (before && before->counter) {\n\t\tstruct bpf_perf_event_value *accum;\n\n\t\tdiff.counter = after->counter - before->counter;\n\t\tdiff.enabled = after->enabled - before->enabled;\n\t\tdiff.running = after->running - before->running;\n\n\t\taccum = bpf_map_lookup_elem(&accum_readings, &zero);\n\t\tif (accum) {\n\t\t\taccum->counter += diff.counter;\n\t\t\taccum->enabled += diff.enabled;\n\t\t\taccum->running += diff.running;\n\t\t}\n\t}\n}\n\nSEC(\"fexit/XXX\")\nint BPF_PROG(fexit_XXX)\n{\n\tstruct bpf_perf_event_value reading;\n\t__u32 cpu = bpf_get_smp_processor_id();\n\tint err;\n\n\t \n\terr = bpf_perf_event_read_value(&events, cpu, &reading, sizeof(reading));\n\tif (err)\n\t\treturn 0;\n\n\tfexit_update_maps(&reading);\n\treturn 0;\n}\n\nchar LICENSE[] SEC(\"license\") = \"Dual BSD/GPL\";\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}