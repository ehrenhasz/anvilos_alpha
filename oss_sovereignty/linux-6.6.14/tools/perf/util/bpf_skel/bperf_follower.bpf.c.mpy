{
  "module_name": "bperf_follower.bpf.c",
  "hash_id": "4d2b1b8992e26828e2a7e99010e1f32567a9e1ab9d43674f2510ada770f1e618",
  "original_prompt": "Ingested from linux-6.6.14/tools/perf/util/bpf_skel/bperf_follower.bpf.c",
  "human_readable_source": "\n\n#include \"vmlinux.h\"\n#include <bpf/bpf_helpers.h>\n#include <bpf/bpf_tracing.h>\n#include \"bperf_u.h\"\n\nstruct {\n\t__uint(type, BPF_MAP_TYPE_PERCPU_ARRAY);\n\t__uint(key_size, sizeof(__u32));\n\t__uint(value_size, sizeof(struct bpf_perf_event_value));\n\t__uint(max_entries, 1);\n} diff_readings SEC(\".maps\");\n\nstruct {\n\t__uint(type, BPF_MAP_TYPE_PERCPU_ARRAY);\n\t__uint(key_size, sizeof(__u32));\n\t__uint(value_size, sizeof(struct bpf_perf_event_value));\n\t__uint(max_entries, 1);\n} accum_readings SEC(\".maps\");\n\nstruct {\n\t__uint(type, BPF_MAP_TYPE_HASH);\n\t__uint(key_size, sizeof(__u32));\n\t__uint(value_size, sizeof(__u32));\n} filter SEC(\".maps\");\n\nenum bperf_filter_type type = 0;\nint enabled = 0;\n\nSEC(\"fexit/XXX\")\nint BPF_PROG(fexit_XXX)\n{\n\tstruct bpf_perf_event_value *diff_val, *accum_val;\n\t__u32 filter_key, zero = 0;\n\t__u32 *accum_key;\n\n\tif (!enabled)\n\t\treturn 0;\n\n\tswitch (type) {\n\tcase BPERF_FILTER_GLOBAL:\n\t\taccum_key = &zero;\n\t\tgoto do_add;\n\tcase BPERF_FILTER_CPU:\n\t\tfilter_key = bpf_get_smp_processor_id();\n\t\tbreak;\n\tcase BPERF_FILTER_PID:\n\t\tfilter_key = bpf_get_current_pid_tgid() & 0xffffffff;\n\t\tbreak;\n\tcase BPERF_FILTER_TGID:\n\t\tfilter_key = bpf_get_current_pid_tgid() >> 32;\n\t\tbreak;\n\tdefault:\n\t\treturn 0;\n\t}\n\n\taccum_key = bpf_map_lookup_elem(&filter, &filter_key);\n\tif (!accum_key)\n\t\treturn 0;\n\ndo_add:\n\tdiff_val = bpf_map_lookup_elem(&diff_readings, &zero);\n\tif (!diff_val)\n\t\treturn 0;\n\n\taccum_val = bpf_map_lookup_elem(&accum_readings, accum_key);\n\tif (!accum_val)\n\t\treturn 0;\n\n\taccum_val->counter += diff_val->counter;\n\taccum_val->enabled += diff_val->enabled;\n\taccum_val->running += diff_val->running;\n\n\treturn 0;\n}\n\nchar LICENSE[] SEC(\"license\") = \"Dual BSD/GPL\";\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}