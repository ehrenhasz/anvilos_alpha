{
  "module_name": "intlist.c",
  "hash_id": "91b2ad0cf61f57ecfb9128b814e97181da4b2233d03b7847bc56bebc4f90e685",
  "original_prompt": "Ingested from linux-6.6.14/tools/perf/util/intlist.c",
  "human_readable_source": "\n \n\n#include <errno.h>\n#include <stdlib.h>\n#include <linux/compiler.h>\n\n#include \"intlist.h\"\n\nstatic struct rb_node *intlist__node_new(struct rblist *rblist __maybe_unused,\n\t\t\t\t\t const void *entry)\n{\n\tunsigned long i = (unsigned long)entry;\n\tstruct rb_node *rc = NULL;\n\tstruct int_node *node = malloc(sizeof(*node));\n\n\tif (node != NULL) {\n\t\tnode->i = i;\n\t\tnode->priv = NULL;\n\t\trc = &node->rb_node;\n\t}\n\n\treturn rc;\n}\n\nstatic void int_node__delete(struct int_node *ilist)\n{\n\tfree(ilist);\n}\n\nstatic void intlist__node_delete(struct rblist *rblist __maybe_unused,\n\t\t\t\t struct rb_node *rb_node)\n{\n\tstruct int_node *node = container_of(rb_node, struct int_node, rb_node);\n\n\tint_node__delete(node);\n}\n\nstatic int intlist__node_cmp(struct rb_node *rb_node, const void *entry)\n{\n\tunsigned long i = (unsigned long)entry;\n\tstruct int_node *node = container_of(rb_node, struct int_node, rb_node);\n\n\tif (node->i > i)\n\t\treturn 1;\n\telse if (node->i < i)\n\t\treturn -1;\n\n\treturn 0;\n}\n\nint intlist__add(struct intlist *ilist, unsigned long i)\n{\n\treturn rblist__add_node(&ilist->rblist, (void *)i);\n}\n\nvoid intlist__remove(struct intlist *ilist, struct int_node *node)\n{\n\trblist__remove_node(&ilist->rblist, &node->rb_node);\n}\n\nstatic struct int_node *__intlist__findnew(struct intlist *ilist,\n\t\t\t\t\t   unsigned long i, bool create)\n{\n\tstruct int_node *node = NULL;\n\tstruct rb_node *rb_node;\n\n\tif (ilist == NULL)\n\t\treturn NULL;\n\n\tif (create)\n\t\trb_node = rblist__findnew(&ilist->rblist, (void *)i);\n\telse\n\t\trb_node = rblist__find(&ilist->rblist, (void *)i);\n\n\tif (rb_node)\n\t\tnode = container_of(rb_node, struct int_node, rb_node);\n\n\treturn node;\n}\n\nstruct int_node *intlist__find(struct intlist *ilist, unsigned long i)\n{\n\treturn __intlist__findnew(ilist, i, false);\n}\n\nstruct int_node *intlist__findnew(struct intlist *ilist, unsigned long i)\n{\n\treturn __intlist__findnew(ilist, i, true);\n}\n\nstatic int intlist__parse_list(struct intlist *ilist, const char *s)\n{\n\tchar *sep;\n\tint err;\n\n\tdo {\n\t\tunsigned long value = strtol(s, &sep, 10);\n\t\terr = -EINVAL;\n\t\tif (*sep != ',' && *sep != '\\0')\n\t\t\tbreak;\n\t\terr = intlist__add(ilist, value);\n\t\tif (err)\n\t\t\tbreak;\n\t\ts = sep + 1;\n\t} while (*sep != '\\0');\n\n\treturn err;\n}\n\nstruct intlist *intlist__new(const char *slist)\n{\n\tstruct intlist *ilist = malloc(sizeof(*ilist));\n\n\tif (ilist != NULL) {\n\t\trblist__init(&ilist->rblist);\n\t\tilist->rblist.node_cmp    = intlist__node_cmp;\n\t\tilist->rblist.node_new    = intlist__node_new;\n\t\tilist->rblist.node_delete = intlist__node_delete;\n\n\t\tif (slist && intlist__parse_list(ilist, slist))\n\t\t\tgoto out_delete;\n\t}\n\n\treturn ilist;\nout_delete:\n\tintlist__delete(ilist);\n\treturn NULL;\n}\n\nvoid intlist__delete(struct intlist *ilist)\n{\n\tif (ilist != NULL)\n\t\trblist__delete(&ilist->rblist);\n}\n\nstruct int_node *intlist__entry(const struct intlist *ilist, unsigned int idx)\n{\n\tstruct int_node *node = NULL;\n\tstruct rb_node *rb_node;\n\n\trb_node = rblist__entry(&ilist->rblist, idx);\n\tif (rb_node)\n\t\tnode = container_of(rb_node, struct int_node, rb_node);\n\n\treturn node;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}