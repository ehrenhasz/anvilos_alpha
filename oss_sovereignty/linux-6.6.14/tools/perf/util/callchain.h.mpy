{
  "module_name": "callchain.h",
  "hash_id": "77a434e683f3969adcc470b0a109323b2030ca3e8b1703b6f96b89bd41dc55e6",
  "original_prompt": "Ingested from linux-6.6.14/tools/perf/util/callchain.h",
  "human_readable_source": " \n#ifndef __PERF_CALLCHAIN_H\n#define __PERF_CALLCHAIN_H\n\n#include <linux/list.h>\n#include <linux/rbtree.h>\n#include \"map_symbol.h\"\n#include \"branch.h\"\n\nstruct addr_location;\nstruct evsel;\nstruct ip_callchain;\nstruct map;\nstruct perf_sample;\nstruct thread;\nstruct hists;\n\n#define HELP_PAD \"\\t\\t\\t\\t\"\n\n#define CALLCHAIN_HELP \"setup and enables call-graph (stack chain/backtrace):\\n\\n\"\n\n# define RECORD_MODE_HELP  HELP_PAD \"record_mode:\\tcall graph recording mode (fp|dwarf|lbr)\\n\"\n\n#define RECORD_SIZE_HELP\t\t\t\t\t\t\\\n\tHELP_PAD \"record_size:\\tif record_mode is 'dwarf', max size of stack recording (<bytes>)\\n\" \\\n\tHELP_PAD \"\\t\\tdefault: 8192 (bytes)\\n\"\n\n#define CALLCHAIN_RECORD_HELP  CALLCHAIN_HELP RECORD_MODE_HELP RECORD_SIZE_HELP\n\n#define CALLCHAIN_REPORT_HELP\t\t\t\t\t\t\\\n\tHELP_PAD \"print_type:\\tcall graph printing style (graph|flat|fractal|folded|none)\\n\" \\\n\tHELP_PAD \"threshold:\\tminimum call graph inclusion threshold (<percent>)\\n\" \\\n\tHELP_PAD \"print_limit:\\tmaximum number of call graph entry (<number>)\\n\" \\\n\tHELP_PAD \"order:\\t\\tcall graph order (caller|callee)\\n\" \\\n\tHELP_PAD \"sort_key:\\tcall graph sort key (function|address)\\n\"\t\\\n\tHELP_PAD \"branch:\\t\\tinclude last branch info to call graph (branch)\\n\" \\\n\tHELP_PAD \"value:\\t\\tcall graph value (percent|period|count)\\n\"\n\nenum perf_call_graph_mode {\n\tCALLCHAIN_NONE,\n\tCALLCHAIN_FP,\n\tCALLCHAIN_DWARF,\n\tCALLCHAIN_LBR,\n\tCALLCHAIN_MAX\n};\n\nenum chain_mode {\n\tCHAIN_NONE,\n\tCHAIN_FLAT,\n\tCHAIN_GRAPH_ABS,\n\tCHAIN_GRAPH_REL,\n\tCHAIN_FOLDED,\n};\n\nenum chain_order {\n\tORDER_CALLER,\n\tORDER_CALLEE\n};\n\nstruct callchain_node {\n\tstruct callchain_node\t*parent;\n\tstruct list_head\tval;\n\tstruct list_head\tparent_val;\n\tstruct rb_node\t\trb_node_in;  \n\tstruct rb_node\t\trb_node;     \n\tstruct rb_root\t\trb_root_in;  \n\tstruct rb_root\t\trb_root;     \n\tunsigned int\t\tval_nr;\n\tunsigned int\t\tcount;\n\tunsigned int\t\tchildren_count;\n\tu64\t\t\thit;\n\tu64\t\t\tchildren_hit;\n};\n\nstruct callchain_root {\n\tu64\t\t\tmax_depth;\n\tstruct callchain_node\tnode;\n};\n\nstruct callchain_param;\n\ntypedef void (*sort_chain_func_t)(struct rb_root *, struct callchain_root *,\n\t\t\t\t u64, struct callchain_param *);\n\nenum chain_key {\n\tCCKEY_FUNCTION,\n\tCCKEY_ADDRESS,\n\tCCKEY_SRCLINE\n};\n\nenum chain_value {\n\tCCVAL_PERCENT,\n\tCCVAL_PERIOD,\n\tCCVAL_COUNT,\n};\n\nextern bool dwarf_callchain_users;\n\nstruct callchain_param {\n\tbool\t\t\tenabled;\n\tenum perf_call_graph_mode record_mode;\n\tu32\t\t\tdump_size;\n\tenum chain_mode \tmode;\n\tu16\t\t\tmax_stack;\n\tu32\t\t\tprint_limit;\n\tdouble\t\t\tmin_percent;\n\tsort_chain_func_t\tsort;\n\tenum chain_order\torder;\n\tbool\t\t\torder_set;\n\tenum chain_key\t\tkey;\n\tbool\t\t\tbranch_callstack;\n\tenum chain_value\tvalue;\n};\n\nextern struct callchain_param callchain_param;\nextern struct callchain_param callchain_param_default;\n\nstruct callchain_list {\n\tu64\t\t\tip;\n\tstruct map_symbol\tms;\n\tstruct   {\n\t\tbool\t\tunfolded;\n\t\tbool\t\thas_children;\n\t};\n\tu64\t\t\tbranch_count;\n\tu64\t\t\tfrom_count;\n\tu64\t\t\tpredicted_count;\n\tu64\t\t\tabort_count;\n\tu64\t\t\tcycles_count;\n\tu64\t\t\titer_count;\n\tu64\t\t\titer_cycles;\n\tstruct branch_type_stat brtype_stat;\n\tconst char\t\t*srcline;\n\tstruct list_head\tlist;\n};\n\n \nstruct callchain_cursor_node {\n\tu64\t\t\t\tip;\n\tstruct map_symbol\t\tms;\n\tconst char\t\t\t*srcline;\n\t \n\tbool\t\t\t\tvalid;\n\n\tbool\t\t\t\tbranch;\n\tstruct branch_flags\t\tbranch_flags;\n\tu64\t\t\t\tbranch_from;\n\tint\t\t\t\tnr_loop_iter;\n\tu64\t\t\t\titer_cycles;\n\tstruct callchain_cursor_node\t*next;\n};\n\nstruct stitch_list {\n\tstruct list_head\t\tnode;\n\tstruct callchain_cursor_node\tcursor;\n};\n\nstruct callchain_cursor {\n\tu64\t\t\t\tnr;\n\tstruct callchain_cursor_node\t*first;\n\tstruct callchain_cursor_node\t**last;\n\tu64\t\t\t\tpos;\n\tstruct callchain_cursor_node\t*curr;\n};\n\nstatic inline void callchain_init(struct callchain_root *root)\n{\n\tINIT_LIST_HEAD(&root->node.val);\n\tINIT_LIST_HEAD(&root->node.parent_val);\n\n\troot->node.parent = NULL;\n\troot->node.hit = 0;\n\troot->node.children_hit = 0;\n\troot->node.rb_root_in = RB_ROOT;\n\troot->max_depth = 0;\n}\n\nstatic inline u64 callchain_cumul_hits(struct callchain_node *node)\n{\n\treturn node->hit + node->children_hit;\n}\n\nstatic inline unsigned callchain_cumul_counts(struct callchain_node *node)\n{\n\treturn node->count + node->children_count;\n}\n\nint callchain_register_param(struct callchain_param *param);\nint callchain_append(struct callchain_root *root,\n\t\t     struct callchain_cursor *cursor,\n\t\t     u64 period);\n\nint callchain_merge(struct callchain_cursor *cursor,\n\t\t    struct callchain_root *dst, struct callchain_root *src);\n\nvoid callchain_cursor_reset(struct callchain_cursor *cursor);\n\nint callchain_cursor_append(struct callchain_cursor *cursor, u64 ip,\n\t\t\t    struct map_symbol *ms,\n\t\t\t    bool branch, struct branch_flags *flags,\n\t\t\t    int nr_loop_iter, u64 iter_cycles, u64 branch_from,\n\t\t\t    const char *srcline);\n\n \nstatic inline void callchain_cursor_commit(struct callchain_cursor *cursor)\n{\n\tif (cursor == NULL)\n\t\treturn;\n\tcursor->curr = cursor->first;\n\tcursor->pos = 0;\n}\n\n \nstatic inline struct callchain_cursor_node *\ncallchain_cursor_current(struct callchain_cursor *cursor)\n{\n\tif (cursor == NULL || cursor->pos == cursor->nr)\n\t\treturn NULL;\n\n\treturn cursor->curr;\n}\n\nstatic inline void callchain_cursor_advance(struct callchain_cursor *cursor)\n{\n\tcursor->curr = cursor->curr->next;\n\tcursor->pos++;\n}\n\nstruct callchain_cursor *get_tls_callchain_cursor(void);\n\nint callchain_cursor__copy(struct callchain_cursor *dst,\n\t\t\t   struct callchain_cursor *src);\n\nstruct option;\nstruct hist_entry;\n\nint record_parse_callchain_opt(const struct option *opt, const char *arg, int unset);\nint record_callchain_opt(const struct option *opt, const char *arg, int unset);\n\nstruct record_opts;\n\nint record_opts__parse_callchain(struct record_opts *record,\n\t\t\t\t struct callchain_param *callchain,\n\t\t\t\t const char *arg, bool unset);\n\nint sample__resolve_callchain(struct perf_sample *sample,\n\t\t\t      struct callchain_cursor *cursor, struct symbol **parent,\n\t\t\t      struct evsel *evsel, struct addr_location *al,\n\t\t\t      int max_stack);\nint hist_entry__append_callchain(struct hist_entry *he, struct perf_sample *sample);\nint fill_callchain_info(struct addr_location *al, struct callchain_cursor_node *node,\n\t\t\tbool hide_unresolved);\n\nextern const char record_callchain_help[];\nint parse_callchain_record(const char *arg, struct callchain_param *param);\nint parse_callchain_record_opt(const char *arg, struct callchain_param *param);\nint parse_callchain_report_opt(const char *arg);\nint parse_callchain_top_opt(const char *arg);\nint perf_callchain_config(const char *var, const char *value);\n\nstatic inline void callchain_cursor_snapshot(struct callchain_cursor *dest,\n\t\t\t\t\t     struct callchain_cursor *src)\n{\n\t*dest = *src;\n\n\tdest->first = src->curr;\n\tdest->nr -= src->pos;\n}\n\n#ifdef HAVE_SKIP_CALLCHAIN_IDX\nint arch_skip_callchain_idx(struct thread *thread, struct ip_callchain *chain);\n#else\nstatic inline int arch_skip_callchain_idx(struct thread *thread __maybe_unused,\n\t\t\tstruct ip_callchain *chain __maybe_unused)\n{\n\treturn -1;\n}\n#endif\n\nvoid arch__add_leaf_frame_record_opts(struct record_opts *opts);\n\nchar *callchain_list__sym_name(struct callchain_list *cl,\n\t\t\t       char *bf, size_t bfsize, bool show_dso);\nchar *callchain_node__scnprintf_value(struct callchain_node *node,\n\t\t\t\t      char *bf, size_t bfsize, u64 total);\nint callchain_node__fprintf_value(struct callchain_node *node,\n\t\t\t\t  FILE *fp, u64 total);\n\nint callchain_list_counts__printf_value(struct callchain_list *clist,\n\t\t\t\t\tFILE *fp, char *bf, int bfsize);\n\nvoid free_callchain(struct callchain_root *root);\nvoid decay_callchain(struct callchain_root *root);\nint callchain_node__make_parent_list(struct callchain_node *node);\n\nint callchain_branch_counts(struct callchain_root *root,\n\t\t\t    u64 *branch_count, u64 *predicted_count,\n\t\t\t    u64 *abort_count, u64 *cycles_count);\n\nvoid callchain_param_setup(u64 sample_type, const char *arch);\n\nbool callchain_cnode_matched(struct callchain_node *base_cnode,\n\t\t\t     struct callchain_node *pair_cnode);\n\nu64 callchain_total_hits(struct hists *hists);\n\ns64 callchain_avg_cycles(struct callchain_node *cnode);\n\n#endif\t \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}