{
  "module_name": "demangle-java.c",
  "hash_id": "8145330653af95028c638dc52906700172bb4f27b0600c4707107eac5faa13d6",
  "original_prompt": "Ingested from linux-6.6.14/tools/perf/util/demangle-java.c",
  "human_readable_source": "\n#include <sys/types.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include \"symbol.h\"\n\n#include \"demangle-java.h\"\n\n#include <linux/ctype.h>\n#include <linux/kernel.h>\n\nenum {\n\tMODE_PREFIX = 0,\n\tMODE_CLASS  = 1,\n\tMODE_FUNC   = 2,\n\tMODE_TYPE   = 3,\n\tMODE_CTYPE  = 4,  \n};\n\n#define BASE_ENT(c, n)\t[c - 'A']=n\nstatic const char *base_types['Z' - 'A' + 1] = {\n\tBASE_ENT('B', \"byte\" ),\n\tBASE_ENT('C', \"char\" ),\n\tBASE_ENT('D', \"double\" ),\n\tBASE_ENT('F', \"float\" ),\n\tBASE_ENT('I', \"int\" ),\n\tBASE_ENT('J', \"long\" ),\n\tBASE_ENT('S', \"short\" ),\n\tBASE_ENT('Z', \"boolean\" ),\n};\n\n \nstatic char *\n__demangle_java_sym(const char *str, const char *end, char *buf, int maxlen, int mode)\n{\n\tint rlen = 0;\n\tint array = 0;\n\tint narg = 0;\n\tconst char *q;\n\n\tif (!end)\n\t\tend = str + strlen(str);\n\n\tfor (q = str; q != end; q++) {\n\n\t\tif (rlen == (maxlen - 1))\n\t\t\tbreak;\n\n\t\tswitch (*q) {\n\t\tcase 'L':\n\t\t\tif (mode == MODE_PREFIX || mode == MODE_TYPE) {\n\t\t\t\tif (mode == MODE_TYPE) {\n\t\t\t\t\tif (narg)\n\t\t\t\t\t\trlen += scnprintf(buf + rlen, maxlen - rlen, \", \");\n\t\t\t\t\tnarg++;\n\t\t\t\t}\n\t\t\t\tif (mode == MODE_PREFIX)\n\t\t\t\t\tmode = MODE_CLASS;\n\t\t\t\telse\n\t\t\t\t\tmode = MODE_CTYPE;\n\t\t\t} else\n\t\t\t\tbuf[rlen++] = *q;\n\t\t\tbreak;\n\t\tcase 'B':\n\t\tcase 'C':\n\t\tcase 'D':\n\t\tcase 'F':\n\t\tcase 'I':\n\t\tcase 'J':\n\t\tcase 'S':\n\t\tcase 'Z':\n\t\t\tif (mode == MODE_TYPE) {\n\t\t\t\tif (narg)\n\t\t\t\t\trlen += scnprintf(buf + rlen, maxlen - rlen, \", \");\n\t\t\t\trlen += scnprintf(buf + rlen, maxlen - rlen, \"%s\", base_types[*q - 'A']);\n\t\t\t\twhile (array--)\n\t\t\t\t\trlen += scnprintf(buf + rlen, maxlen - rlen, \"[]\");\n\t\t\t\tarray = 0;\n\t\t\t\tnarg++;\n\t\t\t} else\n\t\t\t\tbuf[rlen++] = *q;\n\t\t\tbreak;\n\t\tcase 'V':\n\t\t\tif (mode == MODE_TYPE) {\n\t\t\t\trlen += scnprintf(buf + rlen, maxlen - rlen, \"void\");\n\t\t\t\twhile (array--)\n\t\t\t\t\trlen += scnprintf(buf + rlen, maxlen - rlen, \"[]\");\n\t\t\t\tarray = 0;\n\t\t\t} else\n\t\t\t\tbuf[rlen++] = *q;\n\t\t\tbreak;\n\t\tcase '[':\n\t\t\tif (mode != MODE_TYPE)\n\t\t\t\tgoto error;\n\t\t\tarray++;\n\t\t\tbreak;\n\t\tcase '(':\n\t\t\tif (mode != MODE_FUNC)\n\t\t\t\tgoto error;\n\t\t\tbuf[rlen++] = *q;\n\t\t\tmode = MODE_TYPE;\n\t\t\tbreak;\n\t\tcase ')':\n\t\t\tif (mode != MODE_TYPE)\n\t\t\t\tgoto error;\n\t\t\tbuf[rlen++] = *q;\n\t\t\tnarg = 0;\n\t\t\tbreak;\n\t\tcase ';':\n\t\t\tif (mode != MODE_CLASS && mode != MODE_CTYPE)\n\t\t\t\tgoto error;\n\t\t\t \n\t\t\tif (isalpha(*(q + 1)) && mode == MODE_CLASS)\n\t\t\t\trlen += scnprintf(buf + rlen, maxlen - rlen, \".\");\n\t\t\tif (mode == MODE_CLASS)\n\t\t\t\tmode = MODE_FUNC;\n\t\t\telse if (mode == MODE_CTYPE)\n\t\t\t\tmode = MODE_TYPE;\n\t\t\tbreak;\n\t\tcase '/':\n\t\t\tif (mode != MODE_CLASS && mode != MODE_CTYPE)\n\t\t\t\tgoto error;\n\t\t\trlen += scnprintf(buf + rlen, maxlen - rlen, \".\");\n\t\t\tbreak;\n\t\tdefault :\n\t\t\tbuf[rlen++] = *q;\n\t\t}\n\t}\n\tbuf[rlen] = '\\0';\n\treturn buf;\nerror:\n\treturn NULL;\n}\n\n \nchar *\njava_demangle_sym(const char *str, int flags)\n{\n\tchar *buf, *ptr;\n\tchar *p;\n\tsize_t len, l1 = 0;\n\n\tif (!str)\n\t\treturn NULL;\n\n\t \n\tp = strrchr(str, ')');\n\tif (!p)\n\t\treturn NULL;\n\n\t \n\tlen = strlen(str) * 3 + 1;\n\tbuf = malloc(len);\n\tif (!buf)\n\t\treturn NULL;\n\n\tbuf[0] = '\\0';\n\tif (!(flags & JAVA_DEMANGLE_NORET)) {\n\t\t \n\t\tptr = __demangle_java_sym(p + 1, NULL, buf, len, MODE_TYPE);\n\t\tif (!ptr)\n\t\t\tgoto error;\n\n\t\t \n\t\tl1 = strlen(buf);\n\t\tbuf[l1++] = ' ';\n\t}\n\n\t \n\tptr = __demangle_java_sym(str, p + 1, buf + l1, len - l1, MODE_PREFIX);\n\tif (!ptr)\n\t\tgoto error;\n\n\treturn buf;\nerror:\n\tfree(buf);\n\treturn NULL;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}