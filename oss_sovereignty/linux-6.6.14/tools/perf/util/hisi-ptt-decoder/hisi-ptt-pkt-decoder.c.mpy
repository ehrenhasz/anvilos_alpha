{
  "module_name": "hisi-ptt-pkt-decoder.c",
  "hash_id": "57715f6dffd36bcb041a5ff538267c20d93351ffc0cd6f9ec0d7384bbe9faa92",
  "original_prompt": "Ingested from linux-6.6.14/tools/perf/util/hisi-ptt-decoder/hisi-ptt-pkt-decoder.c",
  "human_readable_source": "\n \n\n#include <stdlib.h>\n#include <stdio.h>\n#include <string.h>\n#include <endian.h>\n#include <byteswap.h>\n#include <linux/bitops.h>\n#include <stdarg.h>\n\n#include \"../color.h\"\n#include \"hisi-ptt-pkt-decoder.h\"\n\n \n\nenum hisi_ptt_8dw_pkt_field_type {\n\tHISI_PTT_8DW_CHK_AND_RSV0,\n\tHISI_PTT_8DW_PREFIX,\n\tHISI_PTT_8DW_HEAD0,\n\tHISI_PTT_8DW_HEAD1,\n\tHISI_PTT_8DW_HEAD2,\n\tHISI_PTT_8DW_HEAD3,\n\tHISI_PTT_8DW_RSV1,\n\tHISI_PTT_8DW_TIME,\n\tHISI_PTT_8DW_TYPE_MAX\n};\n\nenum hisi_ptt_4dw_pkt_field_type {\n\tHISI_PTT_4DW_HEAD1,\n\tHISI_PTT_4DW_HEAD2,\n\tHISI_PTT_4DW_HEAD3,\n\tHISI_PTT_4DW_TYPE_MAX\n};\n\nstatic const char * const hisi_ptt_8dw_pkt_field_name[] = {\n\t[HISI_PTT_8DW_PREFIX]\t= \"Prefix\",\n\t[HISI_PTT_8DW_HEAD0]\t= \"Header DW0\",\n\t[HISI_PTT_8DW_HEAD1]\t= \"Header DW1\",\n\t[HISI_PTT_8DW_HEAD2]\t= \"Header DW2\",\n\t[HISI_PTT_8DW_HEAD3]\t= \"Header DW3\",\n\t[HISI_PTT_8DW_TIME]\t= \"Time\"\n};\n\nstatic const char * const hisi_ptt_4dw_pkt_field_name[] = {\n\t[HISI_PTT_4DW_HEAD1]\t= \"Header DW1\",\n\t[HISI_PTT_4DW_HEAD2]\t= \"Header DW2\",\n\t[HISI_PTT_4DW_HEAD3]\t= \"Header DW3\",\n};\n\nunion hisi_ptt_4dw {\n\tstruct {\n\t\tuint32_t format : 2;\n\t\tuint32_t type : 5;\n\t\tuint32_t t9 : 1;\n\t\tuint32_t t8 : 1;\n\t\tuint32_t th : 1;\n\t\tuint32_t so : 1;\n\t\tuint32_t len : 10;\n\t\tuint32_t time : 11;\n\t};\n\tuint32_t value;\n};\n\nstatic void hisi_ptt_print_pkt(const unsigned char *buf, int pos, const char *desc)\n{\n\tconst char *color = PERF_COLOR_BLUE;\n\tint i;\n\n\tprintf(\".\");\n\tcolor_fprintf(stdout, color, \"  %08x: \", pos);\n\tfor (i = 0; i < HISI_PTT_FIELD_LENTH; i++)\n\t\tcolor_fprintf(stdout, color, \"%02x \", buf[pos + i]);\n\tfor (i = 0; i < HISI_PTT_MAX_SPACE_LEN; i++)\n\t\tcolor_fprintf(stdout, color, \"   \");\n\tcolor_fprintf(stdout, color, \"  %s\\n\", desc);\n}\n\nstatic int hisi_ptt_8dw_kpt_desc(const unsigned char *buf, int pos)\n{\n\tint i;\n\n\tfor (i = 0; i < HISI_PTT_8DW_TYPE_MAX; i++) {\n\t\t \n\t\tif (i == HISI_PTT_8DW_CHK_AND_RSV0 || i == HISI_PTT_8DW_RSV1) {\n\t\t\tpos += HISI_PTT_FIELD_LENTH;\n\t\t\tcontinue;\n\t\t}\n\n\t\thisi_ptt_print_pkt(buf, pos, hisi_ptt_8dw_pkt_field_name[i]);\n\t\tpos += HISI_PTT_FIELD_LENTH;\n\t}\n\n\treturn hisi_ptt_pkt_size[HISI_PTT_8DW_PKT];\n}\n\nstatic void hisi_ptt_4dw_print_dw0(const unsigned char *buf, int pos)\n{\n\tconst char *color = PERF_COLOR_BLUE;\n\tunion hisi_ptt_4dw dw0;\n\tint i;\n\n\tdw0.value = *(uint32_t *)(buf + pos);\n\tprintf(\".\");\n\tcolor_fprintf(stdout, color, \"  %08x: \", pos);\n\tfor (i = 0; i < HISI_PTT_FIELD_LENTH; i++)\n\t\tcolor_fprintf(stdout, color, \"%02x \", buf[pos + i]);\n\tfor (i = 0; i < HISI_PTT_MAX_SPACE_LEN; i++)\n\t\tcolor_fprintf(stdout, color, \"   \");\n\n\tcolor_fprintf(stdout, color,\n\t\t      \"  %s %x %s %x %s %x %s %x %s %x %s %x %s %x %s %x\\n\",\n\t\t      \"Format\", dw0.format, \"Type\", dw0.type, \"T9\", dw0.t9,\n\t\t      \"T8\", dw0.t8, \"TH\", dw0.th, \"SO\", dw0.so, \"Length\",\n\t\t      dw0.len, \"Time\", dw0.time);\n}\n\nstatic int hisi_ptt_4dw_kpt_desc(const unsigned char *buf, int pos)\n{\n\tint i;\n\n\thisi_ptt_4dw_print_dw0(buf, pos);\n\tpos += HISI_PTT_FIELD_LENTH;\n\n\tfor (i = 0; i < HISI_PTT_4DW_TYPE_MAX; i++) {\n\t\thisi_ptt_print_pkt(buf, pos, hisi_ptt_4dw_pkt_field_name[i]);\n\t\tpos += HISI_PTT_FIELD_LENTH;\n\t}\n\n\treturn hisi_ptt_pkt_size[HISI_PTT_4DW_PKT];\n}\n\nint hisi_ptt_pkt_desc(const unsigned char *buf, int pos, enum hisi_ptt_pkt_type type)\n{\n\tif (type == HISI_PTT_8DW_PKT)\n\t\treturn hisi_ptt_8dw_kpt_desc(buf, pos);\n\n\treturn hisi_ptt_4dw_kpt_desc(buf, pos);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}