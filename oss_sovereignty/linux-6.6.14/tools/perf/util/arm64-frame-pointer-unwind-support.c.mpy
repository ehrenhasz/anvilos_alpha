{
  "module_name": "arm64-frame-pointer-unwind-support.c",
  "hash_id": "64e3d08f1234d9f98c9a1367722552dcfe7e589f322cc0d5932cafd1b3ca61aa",
  "original_prompt": "Ingested from linux-6.6.14/tools/perf/util/arm64-frame-pointer-unwind-support.c",
  "human_readable_source": "\n#include \"arm64-frame-pointer-unwind-support.h\"\n#include \"callchain.h\"\n#include \"event.h\"\n#include \"perf_regs.h\" \n#include \"unwind.h\"\n\n#define perf_event_arm_regs perf_event_arm64_regs\n#include \"../../arch/arm64/include/uapi/asm/perf_regs.h\"\n#undef perf_event_arm_regs\n\nstruct entries {\n\tu64 stack[2];\n\tsize_t length;\n};\n\nstatic bool get_leaf_frame_caller_enabled(struct perf_sample *sample)\n{\n\treturn callchain_param.record_mode == CALLCHAIN_FP && sample->user_regs.regs\n\t\t&& sample->user_regs.mask & SMPL_REG_MASK(PERF_REG_ARM64_LR);\n}\n\nstatic int add_entry(struct unwind_entry *entry, void *arg)\n{\n\tstruct entries *entries = arg;\n\n\tentries->stack[entries->length++] = entry->ip;\n\treturn 0;\n}\n\nu64 get_leaf_frame_caller_aarch64(struct perf_sample *sample, struct thread *thread, int usr_idx)\n{\n\tint ret;\n\tstruct entries entries = {};\n\tstruct regs_dump old_regs = sample->user_regs;\n\n\tif (!get_leaf_frame_caller_enabled(sample))\n\t\treturn 0;\n\n\t \n\n\tif (!(sample->user_regs.mask & SMPL_REG_MASK(PERF_REG_ARM64_PC))) {\n\t\tsample->user_regs.cache_mask |= SMPL_REG_MASK(PERF_REG_ARM64_PC);\n\t\tsample->user_regs.cache_regs[PERF_REG_ARM64_PC] = sample->callchain->ips[usr_idx+1];\n\t}\n\n\tif (!(sample->user_regs.mask & SMPL_REG_MASK(PERF_REG_ARM64_SP))) {\n\t\tsample->user_regs.cache_mask |= SMPL_REG_MASK(PERF_REG_ARM64_SP);\n\t\tsample->user_regs.cache_regs[PERF_REG_ARM64_SP] = 0;\n\t}\n\n\tret = unwind__get_entries(add_entry, &entries, thread, sample, 2, true);\n\tsample->user_regs = old_regs;\n\n\tif (ret || entries.length != 2)\n\t\treturn ret;\n\n\treturn callchain_param.order == ORDER_CALLER ? entries.stack[0] : entries.stack[1];\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}