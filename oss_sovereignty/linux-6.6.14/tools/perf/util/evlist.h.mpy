{
  "module_name": "evlist.h",
  "hash_id": "332a4dd301013624d52725c1f96fd236d291adb9155adf6099e580609de1e99e",
  "original_prompt": "Ingested from linux-6.6.14/tools/perf/util/evlist.h",
  "human_readable_source": " \n#ifndef __PERF_EVLIST_H\n#define __PERF_EVLIST_H 1\n\n#include <linux/compiler.h>\n#include <linux/kernel.h>\n#include <linux/refcount.h>\n#include <linux/list.h>\n#include <api/fd/array.h>\n#include <internal/evlist.h>\n#include <internal/evsel.h>\n#include <perf/evlist.h>\n#include \"events_stats.h\"\n#include \"evsel.h\"\n#include <pthread.h>\n#include <signal.h>\n#include <unistd.h>\n\nstruct pollfd;\nstruct thread_map;\nstruct perf_cpu_map;\nstruct record_opts;\n\n \nenum bkw_mmap_state {\n\tBKW_MMAP_NOTREADY,\n\tBKW_MMAP_RUNNING,\n\tBKW_MMAP_DATA_PENDING,\n\tBKW_MMAP_EMPTY,\n};\n\nstruct event_enable_timer;\n\nstruct evlist {\n\tstruct perf_evlist core;\n\tbool\t\t enabled;\n\tint\t\t id_pos;\n\tint\t\t is_pos;\n\tu64\t\t combined_sample_type;\n\tenum bkw_mmap_state bkw_mmap_state;\n\tstruct {\n\t\tint\tcork_fd;\n\t\tpid_t\tpid;\n\t} workload;\n\tstruct mmap *mmap;\n\tstruct mmap *overwrite_mmap;\n\tstruct evsel *selected;\n\tstruct events_stats stats;\n\tstruct perf_env\t*env;\n\tvoid (*trace_event_sample_raw)(struct evlist *evlist,\n\t\t\t\t       union perf_event *event,\n\t\t\t\t       struct perf_sample *sample);\n\tu64\t\tfirst_sample_time;\n\tu64\t\tlast_sample_time;\n\tstruct {\n\t\tpthread_t\t\tth;\n\t\tvolatile int\t\tdone;\n\t} thread;\n\tstruct {\n\t\tint\tfd;\t \n\t\tint\tack;\t \n\t\tint\tpos;\t \n\t} ctl_fd;\n\tstruct event_enable_timer *eet;\n};\n\nstruct evsel_str_handler {\n\tconst char *name;\n\tvoid\t   *handler;\n};\n\nstruct evlist *evlist__new(void);\nstruct evlist *evlist__new_default(void);\nstruct evlist *evlist__new_dummy(void);\nvoid evlist__init(struct evlist *evlist, struct perf_cpu_map *cpus,\n\t\t  struct perf_thread_map *threads);\nvoid evlist__exit(struct evlist *evlist);\nvoid evlist__delete(struct evlist *evlist);\n\nvoid evlist__add(struct evlist *evlist, struct evsel *entry);\nvoid evlist__remove(struct evlist *evlist, struct evsel *evsel);\n\nint evlist__add_attrs(struct evlist *evlist, struct perf_event_attr *attrs, size_t nr_attrs);\n\nint __evlist__add_default_attrs(struct evlist *evlist,\n\t\t\t\t     struct perf_event_attr *attrs, size_t nr_attrs);\n\nint arch_evlist__add_default_attrs(struct evlist *evlist,\n\t\t\t\t   struct perf_event_attr *attrs,\n\t\t\t\t   size_t nr_attrs);\n\n#define evlist__add_default_attrs(evlist, array) \\\n\tarch_evlist__add_default_attrs(evlist, array, ARRAY_SIZE(array))\n\nint arch_evlist__cmp(const struct evsel *lhs, const struct evsel *rhs);\n\nint evlist__add_dummy(struct evlist *evlist);\nstruct evsel *evlist__add_aux_dummy(struct evlist *evlist, bool system_wide);\nstatic inline struct evsel *evlist__add_dummy_on_all_cpus(struct evlist *evlist)\n{\n\treturn evlist__add_aux_dummy(evlist, true);\n}\n#ifdef HAVE_LIBTRACEEVENT\nstruct evsel *evlist__add_sched_switch(struct evlist *evlist, bool system_wide);\n#endif\n\nint evlist__add_sb_event(struct evlist *evlist, struct perf_event_attr *attr,\n\t\t\t evsel__sb_cb_t cb, void *data);\nvoid evlist__set_cb(struct evlist *evlist, evsel__sb_cb_t cb, void *data);\nint evlist__start_sb_thread(struct evlist *evlist, struct target *target);\nvoid evlist__stop_sb_thread(struct evlist *evlist);\n\n#ifdef HAVE_LIBTRACEEVENT\nint evlist__add_newtp(struct evlist *evlist, const char *sys, const char *name, void *handler);\n#endif\n\nint __evlist__set_tracepoints_handlers(struct evlist *evlist,\n\t\t\t\t       const struct evsel_str_handler *assocs,\n\t\t\t\t       size_t nr_assocs);\n\n#define evlist__set_tracepoints_handlers(evlist, array) \\\n\t__evlist__set_tracepoints_handlers(evlist, array, ARRAY_SIZE(array))\n\nint evlist__set_tp_filter(struct evlist *evlist, const char *filter);\nint evlist__set_tp_filter_pid(struct evlist *evlist, pid_t pid);\nint evlist__set_tp_filter_pids(struct evlist *evlist, size_t npids, pid_t *pids);\n\nint evlist__append_tp_filter(struct evlist *evlist, const char *filter);\n\nint evlist__append_tp_filter_pid(struct evlist *evlist, pid_t pid);\nint evlist__append_tp_filter_pids(struct evlist *evlist, size_t npids, pid_t *pids);\n\nstruct evsel *evlist__find_tracepoint_by_id(struct evlist *evlist, int id);\nstruct evsel *evlist__find_tracepoint_by_name(struct evlist *evlist, const char *name);\n\nint evlist__add_pollfd(struct evlist *evlist, int fd);\nint evlist__filter_pollfd(struct evlist *evlist, short revents_and_mask);\n\n#ifdef HAVE_EVENTFD_SUPPORT\nint evlist__add_wakeup_eventfd(struct evlist *evlist, int fd);\n#endif\n\nint evlist__poll(struct evlist *evlist, int timeout);\n\nstruct evsel *evlist__id2evsel(struct evlist *evlist, u64 id);\nstruct evsel *evlist__id2evsel_strict(struct evlist *evlist, u64 id);\n\nstruct perf_sample_id *evlist__id2sid(struct evlist *evlist, u64 id);\n\nvoid evlist__toggle_bkw_mmap(struct evlist *evlist, enum bkw_mmap_state state);\n\nvoid evlist__mmap_consume(struct evlist *evlist, int idx);\n\nint evlist__open(struct evlist *evlist);\nvoid evlist__close(struct evlist *evlist);\n\nstruct callchain_param;\n\nvoid evlist__set_id_pos(struct evlist *evlist);\nvoid evlist__config(struct evlist *evlist, struct record_opts *opts, struct callchain_param *callchain);\nint record_opts__config(struct record_opts *opts);\n\nint evlist__prepare_workload(struct evlist *evlist, struct target *target,\n\t\t\t     const char *argv[], bool pipe_output,\n\t\t\t     void (*exec_error)(int signo, siginfo_t *info, void *ucontext));\nint evlist__start_workload(struct evlist *evlist);\n\nstruct option;\n\nint __evlist__parse_mmap_pages(unsigned int *mmap_pages, const char *str);\nint evlist__parse_mmap_pages(const struct option *opt, const char *str, int unset);\n\nunsigned long perf_event_mlock_kb_in_pages(void);\n\nint evlist__mmap_ex(struct evlist *evlist, unsigned int pages,\n\t\t\t unsigned int auxtrace_pages,\n\t\t\t bool auxtrace_overwrite, int nr_cblocks,\n\t\t\t int affinity, int flush, int comp_level);\nint evlist__mmap(struct evlist *evlist, unsigned int pages);\nvoid evlist__munmap(struct evlist *evlist);\n\nsize_t evlist__mmap_size(unsigned long pages);\n\nvoid evlist__disable(struct evlist *evlist);\nvoid evlist__enable(struct evlist *evlist);\nvoid evlist__toggle_enable(struct evlist *evlist);\nvoid evlist__disable_evsel(struct evlist *evlist, char *evsel_name);\nvoid evlist__enable_evsel(struct evlist *evlist, char *evsel_name);\nvoid evlist__disable_non_dummy(struct evlist *evlist);\nvoid evlist__enable_non_dummy(struct evlist *evlist);\n\nvoid evlist__set_selected(struct evlist *evlist, struct evsel *evsel);\n\nint evlist__create_maps(struct evlist *evlist, struct target *target);\nint evlist__apply_filters(struct evlist *evlist, struct evsel **err_evsel);\n\nu64 __evlist__combined_sample_type(struct evlist *evlist);\nu64 evlist__combined_sample_type(struct evlist *evlist);\nu64 evlist__combined_branch_type(struct evlist *evlist);\nbool evlist__sample_id_all(struct evlist *evlist);\nu16 evlist__id_hdr_size(struct evlist *evlist);\n\nint evlist__parse_sample(struct evlist *evlist, union perf_event *event, struct perf_sample *sample);\nint evlist__parse_sample_timestamp(struct evlist *evlist, union perf_event *event, u64 *timestamp);\n\nbool evlist__valid_sample_type(struct evlist *evlist);\nbool evlist__valid_sample_id_all(struct evlist *evlist);\nbool evlist__valid_read_format(struct evlist *evlist);\n\nvoid evlist__splice_list_tail(struct evlist *evlist, struct list_head *list);\n\nstatic inline bool evlist__empty(struct evlist *evlist)\n{\n\treturn list_empty(&evlist->core.entries);\n}\n\nstatic inline struct evsel *evlist__first(struct evlist *evlist)\n{\n\tstruct perf_evsel *evsel = perf_evlist__first(&evlist->core);\n\n\treturn container_of(evsel, struct evsel, core);\n}\n\nstatic inline struct evsel *evlist__last(struct evlist *evlist)\n{\n\tstruct perf_evsel *evsel = perf_evlist__last(&evlist->core);\n\n\treturn container_of(evsel, struct evsel, core);\n}\n\nstatic inline int evlist__nr_groups(struct evlist *evlist)\n{\n\treturn perf_evlist__nr_groups(&evlist->core);\n}\n\nint evlist__strerror_open(struct evlist *evlist, int err, char *buf, size_t size);\nint evlist__strerror_mmap(struct evlist *evlist, int err, char *buf, size_t size);\n\nbool evlist__can_select_event(struct evlist *evlist, const char *str);\nvoid evlist__to_front(struct evlist *evlist, struct evsel *move_evsel);\n\n \n#define __evlist__for_each_entry(list, evsel) \\\n        list_for_each_entry(evsel, list, core.node)\n\n \n#define evlist__for_each_entry(evlist, evsel) \\\n\t__evlist__for_each_entry(&(evlist)->core.entries, evsel)\n\n \n#define __evlist__for_each_entry_continue(list, evsel) \\\n        list_for_each_entry_continue(evsel, list, core.node)\n\n \n#define evlist__for_each_entry_continue(evlist, evsel) \\\n\t__evlist__for_each_entry_continue(&(evlist)->core.entries, evsel)\n\n \n#define __evlist__for_each_entry_from(list, evsel) \\\n\tlist_for_each_entry_from(evsel, list, core.node)\n\n \n#define evlist__for_each_entry_from(evlist, evsel) \\\n\t__evlist__for_each_entry_from(&(evlist)->core.entries, evsel)\n\n \n#define __evlist__for_each_entry_reverse(list, evsel) \\\n        list_for_each_entry_reverse(evsel, list, core.node)\n\n \n#define evlist__for_each_entry_reverse(evlist, evsel) \\\n\t__evlist__for_each_entry_reverse(&(evlist)->core.entries, evsel)\n\n \n#define __evlist__for_each_entry_safe(list, tmp, evsel) \\\n        list_for_each_entry_safe(evsel, tmp, list, core.node)\n\n \n#define evlist__for_each_entry_safe(evlist, tmp, evsel) \\\n\t__evlist__for_each_entry_safe(&(evlist)->core.entries, tmp, evsel)\n\n \nstruct evlist_cpu_iterator {\n\t \n\tstruct evlist *container;\n\t \n\tstruct evsel *evsel;\n\t \n\tint cpu_map_idx;\n\t \n\tint evlist_cpu_map_idx;\n\t \n\tint evlist_cpu_map_nr;\n\t \n\tstruct perf_cpu cpu;\n\t \n\tstruct affinity *affinity;\n};\n\n \n#define evlist__for_each_cpu(evlist_cpu_itr, evlist, affinity)\t\t\\\n\tfor ((evlist_cpu_itr) = evlist__cpu_begin(evlist, affinity);\t\\\n\t     !evlist_cpu_iterator__end(&evlist_cpu_itr);\t\t\\\n\t     evlist_cpu_iterator__next(&evlist_cpu_itr))\n\n \nstruct evlist_cpu_iterator evlist__cpu_begin(struct evlist *evlist, struct affinity *affinity);\n \nvoid evlist_cpu_iterator__next(struct evlist_cpu_iterator *evlist_cpu_itr);\n \nbool evlist_cpu_iterator__end(const struct evlist_cpu_iterator *evlist_cpu_itr);\n\nstruct evsel *evlist__get_tracking_event(struct evlist *evlist);\nvoid evlist__set_tracking_event(struct evlist *evlist, struct evsel *tracking_evsel);\n\nstruct evsel *evlist__find_evsel_by_str(struct evlist *evlist, const char *str);\n\nstruct evsel *evlist__event2evsel(struct evlist *evlist, union perf_event *event);\n\nbool evlist__exclude_kernel(struct evlist *evlist);\n\nvoid evlist__force_leader(struct evlist *evlist);\n\nstruct evsel *evlist__reset_weak_group(struct evlist *evlist, struct evsel *evsel, bool close);\n\n#define EVLIST_CTL_CMD_ENABLE_TAG  \"enable\"\n#define EVLIST_CTL_CMD_DISABLE_TAG \"disable\"\n#define EVLIST_CTL_CMD_ACK_TAG     \"ack\\n\"\n#define EVLIST_CTL_CMD_SNAPSHOT_TAG \"snapshot\"\n#define EVLIST_CTL_CMD_EVLIST_TAG \"evlist\"\n#define EVLIST_CTL_CMD_STOP_TAG \"stop\"\n#define EVLIST_CTL_CMD_PING_TAG \"ping\"\n\n#define EVLIST_CTL_CMD_MAX_LEN 64\n\nenum evlist_ctl_cmd {\n\tEVLIST_CTL_CMD_UNSUPPORTED = 0,\n\tEVLIST_CTL_CMD_ENABLE,\n\tEVLIST_CTL_CMD_DISABLE,\n\tEVLIST_CTL_CMD_ACK,\n\tEVLIST_CTL_CMD_SNAPSHOT,\n\tEVLIST_CTL_CMD_EVLIST,\n\tEVLIST_CTL_CMD_STOP,\n\tEVLIST_CTL_CMD_PING,\n};\n\nint evlist__parse_control(const char *str, int *ctl_fd, int *ctl_fd_ack, bool *ctl_fd_close);\nvoid evlist__close_control(int ctl_fd, int ctl_fd_ack, bool *ctl_fd_close);\nint evlist__initialize_ctlfd(struct evlist *evlist, int ctl_fd, int ctl_fd_ack);\nint evlist__finalize_ctlfd(struct evlist *evlist);\nbool evlist__ctlfd_initialized(struct evlist *evlist);\nint evlist__ctlfd_process(struct evlist *evlist, enum evlist_ctl_cmd *cmd);\nint evlist__ctlfd_ack(struct evlist *evlist);\n\n#define EVLIST_ENABLED_MSG \"Events enabled\\n\"\n#define EVLIST_DISABLED_MSG \"Events disabled\\n\"\n\nint evlist__parse_event_enable_time(struct evlist *evlist, struct record_opts *opts,\n\t\t\t\t    const char *str, int unset);\nint event_enable_timer__start(struct event_enable_timer *eet);\nvoid event_enable_timer__exit(struct event_enable_timer **ep);\nint event_enable_timer__process(struct event_enable_timer *eet);\n\nstruct evsel *evlist__find_evsel(struct evlist *evlist, int idx);\n\nint evlist__scnprintf_evsels(struct evlist *evlist, size_t size, char *bf);\nvoid evlist__check_mem_load_aux(struct evlist *evlist);\nvoid evlist__warn_user_requested_cpus(struct evlist *evlist, const char *cpu_list);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}