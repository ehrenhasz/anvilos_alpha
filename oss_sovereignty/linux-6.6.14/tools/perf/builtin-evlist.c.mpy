{
  "module_name": "builtin-evlist.c",
  "hash_id": "13b7068bbd937d24d9bbf859469335d025c2abe772472345ba96385ffc4f0d4d",
  "original_prompt": "Ingested from linux-6.6.14/tools/perf/builtin-evlist.c",
  "human_readable_source": "\n \n#include \"builtin.h\"\n\n#include <linux/list.h>\n\n#include \"util/evlist.h\"\n#include \"util/evsel.h\"\n#include \"util/evsel_fprintf.h\"\n#include \"util/parse-events.h\"\n#include <subcmd/parse-options.h>\n#include \"util/session.h\"\n#include \"util/data.h\"\n#include \"util/debug.h\"\n#include <linux/err.h>\n#include \"util/tool.h\"\n#include \"util/util.h\"\n\nstatic int process_header_feature(struct perf_session *session __maybe_unused,\n\t\t\t\t  union perf_event *event __maybe_unused)\n{\n\tsession_done = 1;\n\treturn 0;\n}\n\nstatic int __cmd_evlist(const char *file_name, struct perf_attr_details *details)\n{\n\tstruct perf_session *session;\n\tstruct evsel *pos;\n\tstruct perf_data data = {\n\t\t.path      = file_name,\n\t\t.mode      = PERF_DATA_MODE_READ,\n\t\t.force     = details->force,\n\t};\n\tstruct perf_tool tool = {\n\t\t \n\t\t.attr = perf_event__process_attr,\n\t\t.feature = process_header_feature,\n\t};\n\tbool has_tracepoint = false;\n\n\tsession = perf_session__new(&data, &tool);\n\tif (IS_ERR(session))\n\t\treturn PTR_ERR(session);\n\n\tif (data.is_pipe)\n\t\tperf_session__process_events(session);\n\n\tevlist__for_each_entry(session->evlist, pos) {\n\t\tevsel__fprintf(pos, details, stdout);\n\n\t\tif (pos->core.attr.type == PERF_TYPE_TRACEPOINT)\n\t\t\thas_tracepoint = true;\n\t}\n\n\tif (has_tracepoint && !details->trace_fields)\n\t\tprintf(\"# Tip: use 'perf evlist --trace-fields' to show fields for tracepoint events\\n\");\n\n\tperf_session__delete(session);\n\treturn 0;\n}\n\nint cmd_evlist(int argc, const char **argv)\n{\n\tstruct perf_attr_details details = { .verbose = false, };\n\tconst struct option options[] = {\n\tOPT_STRING('i', \"input\", &input_name, \"file\", \"Input file name\"),\n\tOPT_BOOLEAN('F', \"freq\", &details.freq, \"Show the sample frequency\"),\n\tOPT_BOOLEAN('v', \"verbose\", &details.verbose,\n\t\t    \"Show all event attr details\"),\n\tOPT_BOOLEAN('g', \"group\", &details.event_group,\n\t\t    \"Show event group information\"),\n\tOPT_BOOLEAN('f', \"force\", &details.force, \"don't complain, do it\"),\n\tOPT_BOOLEAN(0, \"trace-fields\", &details.trace_fields, \"Show tracepoint fields\"),\n\tOPT_END()\n\t};\n\tconst char * const evlist_usage[] = {\n\t\t\"perf evlist [<options>]\",\n\t\tNULL\n\t};\n\n\targc = parse_options(argc, argv, options, evlist_usage, 0);\n\tif (argc)\n\t\tusage_with_options(evlist_usage, options);\n\n\tif (details.event_group && (details.verbose || details.freq)) {\n\t\tusage_with_options_msg(evlist_usage, options,\n\t\t\t\"--group option is not compatible with other options\\n\");\n\t}\n\n\treturn __cmd_evlist(input_name, &details);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}