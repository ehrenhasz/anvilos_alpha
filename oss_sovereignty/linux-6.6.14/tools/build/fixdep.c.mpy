{
  "module_name": "fixdep.c",
  "hash_id": "b6b1fc0f9ad8743be667b41596f2cf88c5d4f14a1eaddadce79f83cb1bbc9494",
  "original_prompt": "Ingested from linux-6.6.14/tools/build/fixdep.c",
  "human_readable_source": "\n \n\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/mman.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <limits.h>\n\nchar *target;\nchar *depfile;\nchar *cmdline;\n\nstatic void usage(void)\n{\n\tfprintf(stderr, \"Usage: fixdep <depfile> <target> <cmdline>\\n\");\n\texit(1);\n}\n\n \nstatic void print_cmdline(void)\n{\n\tprintf(\"cmd_%s := %s\\n\\n\", target, cmdline);\n}\n\n \nstatic void parse_dep_file(void *map, size_t len)\n{\n\tchar *m = map;\n\tchar *end = m + len;\n\tchar *p;\n\tchar s[PATH_MAX];\n\tint is_target, has_target = 0;\n\tint saw_any_target = 0;\n\tint is_first_dep = 0;\n\n\twhile (m < end) {\n\t\t \n\t\twhile (m < end && (*m == ' ' || *m == '\\\\' || *m == '\\n'))\n\t\t\tm++;\n\t\t \n\t\tp = m;\n\t\twhile (p < end && *p != ' ' && *p != '\\\\' && *p != '\\n')\n\t\t\tp++;\n\t\t \n\t\tis_target = (*(p-1) == ':');\n\t\t \n\t\tif (is_target) {\n\t\t\t \n\t\t\tis_first_dep = 1;\n\t\t\thas_target = 1;\n\t\t} else if (has_target) {\n\t\t\t \n\t\t\tmemcpy(s, m, p-m);\n\t\t\ts[p - m] = 0;\n\n\t\t\t \n\t\t\tif (is_first_dep) {\n\t\t\t\t \n\t\t\t\tif (!saw_any_target) {\n\t\t\t\t\tsaw_any_target = 1;\n\t\t\t\t\tprintf(\"source_%s := %s\\n\\n\",\n\t\t\t\t\t\ttarget, s);\n\t\t\t\t\tprintf(\"deps_%s := \\\\\\n\",\n\t\t\t\t\t\ttarget);\n\t\t\t\t}\n\t\t\t\tis_first_dep = 0;\n\t\t\t} else\n\t\t\t\tprintf(\"  %s \\\\\\n\", s);\n\t\t}\n\t\t \n\t\tm = p + 1;\n\t}\n\n\tif (!saw_any_target) {\n\t\tfprintf(stderr, \"fixdep: parse error; no targets found\\n\");\n\t\texit(1);\n\t}\n\n\tprintf(\"\\n%s: $(deps_%s)\\n\\n\", target, target);\n\tprintf(\"$(deps_%s):\\n\", target);\n}\n\nstatic void print_deps(void)\n{\n\tstruct stat st;\n\tint fd;\n\tvoid *map;\n\n\tfd = open(depfile, O_RDONLY);\n\tif (fd < 0) {\n\t\tfprintf(stderr, \"fixdep: error opening depfile: \");\n\t\tperror(depfile);\n\t\texit(2);\n\t}\n\tif (fstat(fd, &st) < 0) {\n\t\tfprintf(stderr, \"fixdep: error fstat'ing depfile: \");\n\t\tperror(depfile);\n\t\texit(2);\n\t}\n\tif (st.st_size == 0) {\n\t\tfprintf(stderr, \"fixdep: %s is empty\\n\", depfile);\n\t\tclose(fd);\n\t\treturn;\n\t}\n\tmap = mmap(NULL, st.st_size, PROT_READ, MAP_PRIVATE, fd, 0);\n\tif ((long) map == -1) {\n\t\tperror(\"fixdep: mmap\");\n\t\tclose(fd);\n\t\treturn;\n\t}\n\n\tparse_dep_file(map, st.st_size);\n\n\tmunmap(map, st.st_size);\n\n\tclose(fd);\n}\n\nint main(int argc, char **argv)\n{\n\tif (argc != 4)\n\t\tusage();\n\n\tdepfile = argv[1];\n\ttarget  = argv[2];\n\tcmdline = argv[3];\n\n\tprint_cmdline();\n\tprint_deps();\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}