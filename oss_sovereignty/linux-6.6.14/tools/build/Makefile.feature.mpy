{
  "module_name": "Makefile.feature",
  "hash_id": "382104e6f258648ab1dfeee5145428ecf2a639c34e6f623e3fdfc546593765ea",
  "original_prompt": "Ingested from linux-6.6.14/tools/build/Makefile.feature",
  "human_readable_source": "# SPDX-License-Identifier: GPL-2.0-only\nfeature_dir := $(srctree)/tools/build/feature\n\nifneq ($(OUTPUT),)\n  OUTPUT_FEATURES = $(OUTPUT)feature/\n  $(shell mkdir -p $(OUTPUT_FEATURES))\nendif\n\nfeature_check = $(eval $(feature_check_code))\ndefine feature_check_code\n  feature-$(1) := $(shell $(MAKE) OUTPUT=$(OUTPUT_FEATURES) CC=\"$(CC)\" CXX=\"$(CXX)\" CFLAGS=\"$(EXTRA_CFLAGS) $(FEATURE_CHECK_CFLAGS-$(1))\" CXXFLAGS=\"$(EXTRA_CXXFLAGS) $(FEATURE_CHECK_CXXFLAGS-$(1))\" LDFLAGS=\"$(LDFLAGS) $(FEATURE_CHECK_LDFLAGS-$(1))\" -C $(feature_dir) $(OUTPUT_FEATURES)test-$1.bin >/dev/null 2>/dev/null && echo 1 || echo 0)\nendef\n\nfeature_set = $(eval $(feature_set_code))\ndefine feature_set_code\n  feature-$(1) := 1\nendef\n\n#\n# Build the feature check binaries in parallel, ignore errors, ignore return value and suppress output:\n#\n\n#\n# Note that this is not a complete list of all feature tests, just\n# those that are typically built on a fully configured system.\n#\n# [ Feature tests not mentioned here have to be built explicitly in\n#   the rule that uses them - an example for that is the 'bionic'\n#   feature check. ]\n#\nFEATURE_TESTS_BASIC :=                  \\\n        backtrace                       \\\n        dwarf                           \\\n        dwarf_getlocations              \\\n        eventfd                         \\\n        fortify-source                  \\\n        get_current_dir_name            \\\n        gettid\t\t\t\t\\\n        glibc                           \\\n        libbfd                          \\\n        libbfd-buildid\t\t\t\\\n        libcap                          \\\n        libelf                          \\\n        libelf-getphdrnum               \\\n        libelf-gelf_getnote             \\\n        libelf-getshdrstrndx            \\\n        libnuma                         \\\n        numa_num_possible_cpus          \\\n        libperl                         \\\n        libpython                       \\\n        libslang                        \\\n        libslang-include-subdir         \\\n        libtraceevent                   \\\n        libtracefs                      \\\n        libcrypto                       \\\n        libunwind                       \\\n        pthread-attr-setaffinity-np     \\\n        pthread-barrier     \t\t\\\n        reallocarray                    \\\n        stackprotector-all              \\\n        timerfd                         \\\n        libdw-dwarf-unwind              \\\n        zlib                            \\\n        lzma                            \\\n        get_cpuid                       \\\n        bpf                             \\\n        scandirat\t\t\t\\\n        sched_getcpu\t\t\t\\\n        sdt\t\t\t\t\\\n        setns\t\t\t\t\\\n        libaio\t\t\t\t\\\n        libzstd\t\t\t\t\\\n        disassembler-four-args\t\t\\\n        disassembler-init-styled\t\\\n        file-handle\n\n# FEATURE_TESTS_BASIC + FEATURE_TESTS_EXTRA is the complete list\n# of all feature tests\nFEATURE_TESTS_EXTRA :=                  \\\n         bionic                         \\\n         compile-32                     \\\n         compile-x32                    \\\n         cplus-demangle                 \\\n         cxa-demangle                   \\\n         gtk2                           \\\n         gtk2-infobar                   \\\n         hello                          \\\n         libbabeltrace                  \\\n         libbfd-liberty                 \\\n         libbfd-liberty-z               \\\n         libopencsd                     \\\n         libunwind-x86                  \\\n         libunwind-x86_64               \\\n         libunwind-arm                  \\\n         libunwind-aarch64              \\\n         libunwind-debug-frame          \\\n         libunwind-debug-frame-arm      \\\n         libunwind-debug-frame-aarch64  \\\n         cxx                            \\\n         llvm                           \\\n         llvm-version                   \\\n         clang                          \\\n         libbpf                         \\\n         libbpf-btf__load_from_kernel_by_id \\\n         libbpf-bpf_prog_load           \\\n         libbpf-bpf_object__next_program \\\n         libbpf-bpf_object__next_map    \\\n         libbpf-bpf_program__set_insns  \\\n         libbpf-bpf_create_map\t\t\\\n         libpfm4                        \\\n         libdebuginfod\t\t\t\\\n         clang-bpf-co-re\n\n\nFEATURE_TESTS ?= $(FEATURE_TESTS_BASIC)\n\nifeq ($(FEATURE_TESTS),all)\n  FEATURE_TESTS := $(FEATURE_TESTS_BASIC) $(FEATURE_TESTS_EXTRA)\nendif\n\nFEATURE_DISPLAY ?=              \\\n         dwarf                  \\\n         dwarf_getlocations     \\\n         glibc                  \\\n         libbfd                 \\\n         libbfd-buildid\t\t\\\n         libcap                 \\\n         libelf                 \\\n         libnuma                \\\n         numa_num_possible_cpus \\\n         libperl                \\\n         libpython              \\\n         libcrypto              \\\n         libunwind              \\\n         libdw-dwarf-unwind     \\\n         zlib                   \\\n         lzma                   \\\n         get_cpuid              \\\n         bpf\t\t\t\\\n         libaio\t\t\t\\\n         libzstd\n\n#\n# Declare group members of a feature to display the logical OR of the detection\n# result instead of each member result.\n#\nFEATURE_GROUP_MEMBERS-libbfd = libbfd-liberty libbfd-liberty-z\n\n# Set FEATURE_CHECK_(C|LD)FLAGS-all for all FEATURE_TESTS features.\n# If in the future we need per-feature checks/flags for features not\n# mentioned in this list we need to refactor this ;-).\nset_test_all_flags = $(eval $(set_test_all_flags_code))\ndefine set_test_all_flags_code\n  FEATURE_CHECK_CFLAGS-all  += $(FEATURE_CHECK_CFLAGS-$(1))\n  FEATURE_CHECK_LDFLAGS-all += $(FEATURE_CHECK_LDFLAGS-$(1))\nendef\n\n$(foreach feat,$(FEATURE_TESTS),$(call set_test_all_flags,$(feat)))\n\n#\n# Special fast-path for the 'all features are available' case:\n#\n$(call feature_check,all,$(MSG))\n\n#\n# Just in case the build freshly failed, make sure we print the\n# feature matrix:\n#\nifeq ($(feature-all), 1)\n  #\n  # test-all.c passed - just set all the core feature flags to 1:\n  #\n  $(foreach feat,$(FEATURE_TESTS),$(call feature_set,$(feat)))\n  #\n  # test-all.c does not comprise these tests, so we need to\n  # for this case to get features proper values\n  #\n  $(call feature_check,compile-32)\n  $(call feature_check,compile-x32)\n  $(call feature_check,bionic)\n  $(call feature_check,libbabeltrace)\nelse\n  $(foreach feat,$(FEATURE_TESTS),$(call feature_check,$(feat)))\nendif\n\n#\n# Print the result of the feature test:\n#\nfeature_print_status = $(eval $(feature_print_status_code))\n\nfeature_group = $(eval $(feature_gen_group)) $(GROUP)\n\ndefine feature_gen_group\n  GROUP := $(1)\n  ifneq ($(feature_verbose),1)\n    GROUP += $(FEATURE_GROUP_MEMBERS-$(1))\n  endif\nendef\n\ndefine feature_print_status_code\n  ifneq (,$(filter 1,$(foreach feat,$(call feature_group,$(feat)),$(feature-$(feat)))))\n    MSG = $(shell printf '...%40s: [ \\033[32mon\\033[m  ]' $(1))\n  else\n    MSG = $(shell printf '...%40s: [ \\033[31mOFF\\033[m ]' $(1))\n  endif\nendef\n\nfeature_print_text = $(eval $(feature_print_text_code))\ndefine feature_print_text_code\n    MSG = $(shell printf '...%40s: %s' $(1) $(2))\nendef\n\n#\n# generates feature value assignment for name, like:\n#   $(call feature_assign,dwarf) == feature-dwarf=1\n#\nfeature_assign = feature-$(1)=$(feature-$(1))\n\nFEATURE_DUMP_FILENAME = $(OUTPUT)FEATURE-DUMP$(FEATURE_USER)\nFEATURE_DUMP := $(shell touch $(FEATURE_DUMP_FILENAME); cat $(FEATURE_DUMP_FILENAME))\n\nfeature_dump_check = $(eval $(feature_dump_check_code))\ndefine feature_dump_check_code\n  ifeq ($(findstring $(1),$(FEATURE_DUMP)),)\n    $(2) := 1\n  endif\nendef\n\n#\n# First check if any test from FEATURE_DISPLAY\n# and set feature_display := 1 if it does\n$(foreach feat,$(FEATURE_DISPLAY),$(call feature_dump_check,$(call feature_assign,$(feat)),feature_display))\n\n#\n# Now also check if any other test changed,\n# so we force FEATURE-DUMP generation\n$(foreach feat,$(FEATURE_TESTS),$(call feature_dump_check,$(call feature_assign,$(feat)),feature_dump_changed))\n\n# The $(feature_display) controls the default detection message\n# output. It's set if:\n# - detected features differes from stored features from\n#   last build (in $(FEATURE_DUMP_FILENAME) file)\n# - one of the $(FEATURE_DISPLAY) is not detected\n# - VF is enabled\n\nifeq ($(feature_dump_changed),1)\n  $(shell rm -f $(FEATURE_DUMP_FILENAME))\n  $(foreach feat,$(FEATURE_TESTS),$(shell echo \"$(call feature_assign,$(feat))\" >> $(FEATURE_DUMP_FILENAME)))\nendif\n\nfeature_display_check = $(eval $(feature_check_display_code))\ndefine feature_check_display_code\n  ifneq ($(feature-$(1)), 1)\n    feature_display := 1\n  endif\nendef\n\n$(foreach feat,$(FEATURE_DISPLAY),$(call feature_display_check,$(feat)))\n\nifeq ($(VF),1)\n  feature_display := 1\n  feature_verbose := 1\nendif\n\nifneq ($(feature_verbose),1)\n  #\n  # Determine the features to omit from the displayed message, as only the\n  # logical OR of the detection result will be shown.\n  #\n  FEATURE_OMIT := $(foreach feat,$(FEATURE_DISPLAY),$(FEATURE_GROUP_MEMBERS-$(feat)))\nendif\n\nfeature_display_entries = $(eval $(feature_display_entries_code))\ndefine feature_display_entries_code\n  ifeq ($(feature_display),1)\n    $$(info )\n    $$(info Auto-detecting system features:)\n    $(foreach feat,$(filter-out $(FEATURE_OMIT),$(FEATURE_DISPLAY)),$(call feature_print_status,$(feat),) $$(info $(MSG)))\n  endif\n\n  ifeq ($(feature_verbose),1)\n    $(eval TMP := $(filter-out $(FEATURE_DISPLAY),$(FEATURE_TESTS)))\n    $(foreach feat,$(TMP),$(call feature_print_status,$(feat),) $$(info $(MSG)))\n  endif\nendef\n\nifeq ($(FEATURE_DISPLAY_DEFERRED),)\n  $(call feature_display_entries)\n  $(info )\nendif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}