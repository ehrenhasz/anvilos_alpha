{
  "module_name": "spidev_fdx.c",
  "hash_id": "769cf11f69a5e05c0e00b1bd58efc1a324a8b70727d4b033aa47680a5c9737f7",
  "original_prompt": "Ingested from linux-6.6.14/tools/spi/spidev_fdx.c",
  "human_readable_source": "\n#include <stdio.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <fcntl.h>\n#include <string.h>\n\n#include <sys/ioctl.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n\n#include <linux/types.h>\n#include <linux/spi/spidev.h>\n\n\nstatic int verbose;\n\nstatic void do_read(int fd, int len)\n{\n\tunsigned char\tbuf[32], *bp;\n\tint\t\tstatus;\n\n\t \n\tif (len < 2)\n\t\tlen = 2;\n\telse if (len > sizeof(buf))\n\t\tlen = sizeof(buf);\n\tmemset(buf, 0, sizeof buf);\n\n\tstatus = read(fd, buf, len);\n\tif (status < 0) {\n\t\tperror(\"read\");\n\t\treturn;\n\t}\n\tif (status != len) {\n\t\tfprintf(stderr, \"short read\\n\");\n\t\treturn;\n\t}\n\n\tprintf(\"read(%2d, %2d): %02x %02x,\", len, status,\n\t\tbuf[0], buf[1]);\n\tstatus -= 2;\n\tbp = buf + 2;\n\twhile (status-- > 0)\n\t\tprintf(\" %02x\", *bp++);\n\tprintf(\"\\n\");\n}\n\nstatic void do_msg(int fd, int len)\n{\n\tstruct spi_ioc_transfer\txfer[2];\n\tunsigned char\t\tbuf[32], *bp;\n\tint\t\t\tstatus;\n\n\tmemset(xfer, 0, sizeof xfer);\n\tmemset(buf, 0, sizeof buf);\n\n\tif (len > sizeof buf)\n\t\tlen = sizeof buf;\n\n\tbuf[0] = 0xaa;\n\txfer[0].tx_buf = (unsigned long)buf;\n\txfer[0].len = 1;\n\n\txfer[1].rx_buf = (unsigned long) buf;\n\txfer[1].len = len;\n\n\tstatus = ioctl(fd, SPI_IOC_MESSAGE(2), xfer);\n\tif (status < 0) {\n\t\tperror(\"SPI_IOC_MESSAGE\");\n\t\treturn;\n\t}\n\n\tprintf(\"response(%2d, %2d): \", len, status);\n\tfor (bp = buf; len; len--)\n\t\tprintf(\" %02x\", *bp++);\n\tprintf(\"\\n\");\n}\n\nstatic void dumpstat(const char *name, int fd)\n{\n\t__u8\tlsb, bits;\n\t__u32\tmode, speed;\n\n\tif (ioctl(fd, SPI_IOC_RD_MODE32, &mode) < 0) {\n\t\tperror(\"SPI rd_mode\");\n\t\treturn;\n\t}\n\tif (ioctl(fd, SPI_IOC_RD_LSB_FIRST, &lsb) < 0) {\n\t\tperror(\"SPI rd_lsb_fist\");\n\t\treturn;\n\t}\n\tif (ioctl(fd, SPI_IOC_RD_BITS_PER_WORD, &bits) < 0) {\n\t\tperror(\"SPI bits_per_word\");\n\t\treturn;\n\t}\n\tif (ioctl(fd, SPI_IOC_RD_MAX_SPEED_HZ, &speed) < 0) {\n\t\tperror(\"SPI max_speed_hz\");\n\t\treturn;\n\t}\n\n\tprintf(\"%s: spi mode 0x%x, %d bits %sper word, %d Hz max\\n\",\n\t\tname, mode, bits, lsb ? \"(lsb first) \" : \"\", speed);\n}\n\nint main(int argc, char **argv)\n{\n\tint\t\tc;\n\tint\t\treadcount = 0;\n\tint\t\tmsglen = 0;\n\tint\t\tfd;\n\tconst char\t*name;\n\n\twhile ((c = getopt(argc, argv, \"hm:r:v\")) != EOF) {\n\t\tswitch (c) {\n\t\tcase 'm':\n\t\t\tmsglen = atoi(optarg);\n\t\t\tif (msglen < 0)\n\t\t\t\tgoto usage;\n\t\t\tcontinue;\n\t\tcase 'r':\n\t\t\treadcount = atoi(optarg);\n\t\t\tif (readcount < 0)\n\t\t\t\tgoto usage;\n\t\t\tcontinue;\n\t\tcase 'v':\n\t\t\tverbose++;\n\t\t\tcontinue;\n\t\tcase 'h':\n\t\tcase '?':\nusage:\n\t\t\tfprintf(stderr,\n\t\t\t\t\"usage: %s [-h] [-m N] [-r N] /dev/spidevB.D\\n\",\n\t\t\t\targv[0]);\n\t\t\treturn 1;\n\t\t}\n\t}\n\n\tif ((optind + 1) != argc)\n\t\tgoto usage;\n\tname = argv[optind];\n\n\tfd = open(name, O_RDWR);\n\tif (fd < 0) {\n\t\tperror(\"open\");\n\t\treturn 1;\n\t}\n\n\tdumpstat(name, fd);\n\n\tif (msglen)\n\t\tdo_msg(fd, msglen);\n\n\tif (readcount)\n\t\tdo_read(fd, readcount);\n\n\tclose(fd);\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}