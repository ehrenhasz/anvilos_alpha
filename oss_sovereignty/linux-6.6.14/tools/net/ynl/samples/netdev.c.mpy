{
  "module_name": "netdev.c",
  "hash_id": "cdd1e1411c092ec0b3470cf2bb67fae836cefb9873a1b005c2c40d6185933434",
  "original_prompt": "Ingested from linux-6.6.14/tools/net/ynl/samples/netdev.c",
  "human_readable_source": "\n#include <stdio.h>\n#include <string.h>\n\n#include <ynl.h>\n\n#include <net/if.h>\n\n#include \"netdev-user.h\"\n\n \n\nstatic void netdev_print_device(struct netdev_dev_get_rsp *d, unsigned int op)\n{\n\tchar ifname[IF_NAMESIZE];\n\tconst char *name;\n\n\tif (!d->_present.ifindex)\n\t\treturn;\n\n\tname = if_indextoname(d->ifindex, ifname);\n\tif (name)\n\t\tprintf(\"%8s\", name);\n\tprintf(\"[%d]\\t\", d->ifindex);\n\n\tif (!d->_present.xdp_features)\n\t\treturn;\n\n\tprintf(\"%llx:\", d->xdp_features);\n\tfor (int i = 0; d->xdp_features > 1U << i; i++) {\n\t\tif (d->xdp_features & (1U << i))\n\t\t\tprintf(\" %s\", netdev_xdp_act_str(1 << i));\n\t}\n\n\tprintf(\" xdp-zc-max-segs=%u\", d->xdp_zc_max_segs);\n\n\tname = netdev_op_str(op);\n\tif (name)\n\t\tprintf(\" (ntf: %s)\", name);\n\tprintf(\"\\n\");\n}\n\nint main(int argc, char **argv)\n{\n\tstruct netdev_dev_get_list *devs;\n\tstruct ynl_ntf_base_type *ntf;\n\tstruct ynl_error yerr;\n\tstruct ynl_sock *ys;\n\tint ifindex = 0;\n\n\tif (argc > 1)\n\t\tifindex = strtol(argv[1], NULL, 0);\n\n\tys = ynl_sock_create(&ynl_netdev_family, &yerr);\n\tif (!ys) {\n\t\tfprintf(stderr, \"YNL: %s\\n\", yerr.msg);\n\t\treturn 1;\n\t}\n\n\tif (ynl_subscribe(ys, \"mgmt\"))\n\t\tgoto err_close;\n\n\tprintf(\"Select ifc ($ifindex; or 0 = dump; or -2 ntf check): \");\n\tscanf(\"%d\", &ifindex);\n\n\tif (ifindex > 0) {\n\t\tstruct netdev_dev_get_req *req;\n\t\tstruct netdev_dev_get_rsp *d;\n\n\t\treq = netdev_dev_get_req_alloc();\n\t\tnetdev_dev_get_req_set_ifindex(req, ifindex);\n\n\t\td = netdev_dev_get(ys, req);\n\t\tnetdev_dev_get_req_free(req);\n\t\tif (!d)\n\t\t\tgoto err_close;\n\n\t\tnetdev_print_device(d, 0);\n\t\tnetdev_dev_get_rsp_free(d);\n\t} else if (!ifindex) {\n\t\tdevs = netdev_dev_get_dump(ys);\n\t\tif (!devs)\n\t\t\tgoto err_close;\n\n\t\tynl_dump_foreach(devs, d)\n\t\t\tnetdev_print_device(d, 0);\n\t\tnetdev_dev_get_list_free(devs);\n\t} else if (ifindex == -2) {\n\t\tynl_ntf_check(ys);\n\t}\n\twhile ((ntf = ynl_ntf_dequeue(ys))) {\n\t\tnetdev_print_device((struct netdev_dev_get_rsp *)&ntf->data,\n\t\t\t\t    ntf->cmd);\n\t\tynl_ntf_free(ntf);\n\t}\n\n\tynl_sock_destroy(ys);\n\treturn 0;\n\nerr_close:\n\tfprintf(stderr, \"YNL: %s\\n\", ys->err.msg);\n\tynl_sock_destroy(ys);\n\treturn 2;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}