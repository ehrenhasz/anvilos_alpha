{
  "module_name": "ynl.h",
  "hash_id": "aee9c1c400ab5cb95ffc21957df257e77bcb3dad0c2debf5c931a614ec9334f7",
  "original_prompt": "Ingested from linux-6.6.14/tools/net/ynl/lib/ynl.h",
  "human_readable_source": "\n#ifndef __YNL_C_H\n#define __YNL_C_H 1\n\n#include <stddef.h>\n#include <libmnl/libmnl.h>\n#include <linux/genetlink.h>\n#include <linux/types.h>\n\nstruct mnl_socket;\nstruct nlmsghdr;\n\n \n\nstruct ynl_ntf_base_type;\nstruct ynl_ntf_info;\nstruct ynl_sock;\n\nenum ynl_error_code {\n\tYNL_ERROR_NONE = 0,\n\t__YNL_ERRNO_END = 4096,\n\tYNL_ERROR_INTERNAL,\n\tYNL_ERROR_EXPECT_ACK,\n\tYNL_ERROR_EXPECT_MSG,\n\tYNL_ERROR_UNEXPECT_MSG,\n\tYNL_ERROR_ATTR_MISSING,\n\tYNL_ERROR_ATTR_INVALID,\n\tYNL_ERROR_UNKNOWN_NTF,\n\tYNL_ERROR_INV_RESP,\n};\n\n \nstruct ynl_error {\n\tenum ynl_error_code code;\n\tunsigned int attr_offs;\n\tchar msg[512];\n};\n\n \nstruct ynl_family {\n \n\tconst char *name;\n\tconst struct ynl_ntf_info *ntf_info;\n\tunsigned int ntf_info_size;\n};\n\n \nstruct ynl_sock {\n\tstruct ynl_error err;\n\n \n\tconst struct ynl_family *family;\n\tstruct mnl_socket *sock;\n\t__u32 seq;\n\t__u32 portid;\n\t__u16 family_id;\n\n\tunsigned int n_mcast_groups;\n\tstruct {\n\t\tunsigned int id;\n\t\tchar name[GENL_NAMSIZ];\n\t} *mcast_groups;\n\n\tstruct ynl_ntf_base_type *ntf_first;\n\tstruct ynl_ntf_base_type **ntf_last_next;\n\n\tstruct nlmsghdr *nlh;\n\tstruct ynl_policy_nest *req_policy;\n\tunsigned char *tx_buf;\n\tunsigned char *rx_buf;\n\tunsigned char raw_buf[];\n};\n\nstruct ynl_sock *\nynl_sock_create(const struct ynl_family *yf, struct ynl_error *e);\nvoid ynl_sock_destroy(struct ynl_sock *ys);\n\n#define ynl_dump_foreach(dump, iter)\t\t\t\t\t\\\n\tfor (typeof(dump->obj) *iter = &dump->obj;\t\t\t\\\n\t     !ynl_dump_obj_is_last(iter);\t\t\t\t\\\n\t     iter = ynl_dump_obj_next(iter))\n\nint ynl_subscribe(struct ynl_sock *ys, const char *grp_name);\nint ynl_socket_get_fd(struct ynl_sock *ys);\nint ynl_ntf_check(struct ynl_sock *ys);\n\n \nstatic inline bool ynl_has_ntf(struct ynl_sock *ys)\n{\n\treturn ys->ntf_last_next != &ys->ntf_first;\n}\nstruct ynl_ntf_base_type *ynl_ntf_dequeue(struct ynl_sock *ys);\n\nvoid ynl_ntf_free(struct ynl_ntf_base_type *ntf);\n\n \n\n \n\nenum ynl_policy_type {\n\tYNL_PT_REJECT = 1,\n\tYNL_PT_IGNORE,\n\tYNL_PT_NEST,\n\tYNL_PT_FLAG,\n\tYNL_PT_BINARY,\n\tYNL_PT_U8,\n\tYNL_PT_U16,\n\tYNL_PT_U32,\n\tYNL_PT_U64,\n\tYNL_PT_NUL_STR,\n};\n\nstruct ynl_policy_attr {\n\tenum ynl_policy_type type;\n\tunsigned int len;\n\tconst char *name;\n\tstruct ynl_policy_nest *nest;\n};\n\nstruct ynl_policy_nest {\n\tunsigned int max_attr;\n\tstruct ynl_policy_attr *table;\n};\n\nstruct ynl_parse_arg {\n\tstruct ynl_sock *ys;\n\tstruct ynl_policy_nest *rsp_policy;\n\tvoid *data;\n};\n\nstruct ynl_dump_list_type {\n\tstruct ynl_dump_list_type *next;\n\tunsigned char data[] __attribute__ ((aligned (8)));\n};\nextern struct ynl_dump_list_type *YNL_LIST_END;\n\nstatic inline bool ynl_dump_obj_is_last(void *obj)\n{\n\tunsigned long uptr = (unsigned long)obj;\n\n\tuptr -= offsetof(struct ynl_dump_list_type, data);\n\treturn uptr == (unsigned long)YNL_LIST_END;\n}\n\nstatic inline void *ynl_dump_obj_next(void *obj)\n{\n\tunsigned long uptr = (unsigned long)obj;\n\tstruct ynl_dump_list_type *list;\n\n\tuptr -= offsetof(struct ynl_dump_list_type, data);\n\tlist = (void *)uptr;\n\tuptr = (unsigned long)list->next;\n\tuptr += offsetof(struct ynl_dump_list_type, data);\n\n\treturn (void *)uptr;\n}\n\nstruct ynl_ntf_base_type {\n\t__u16 family;\n\t__u8 cmd;\n\tstruct ynl_ntf_base_type *next;\n\tvoid (*free)(struct ynl_ntf_base_type *ntf);\n\tunsigned char data[] __attribute__ ((aligned (8)));\n};\n\nextern mnl_cb_t ynl_cb_array[NLMSG_MIN_TYPE];\n\nstruct nlmsghdr *\nynl_gemsg_start_req(struct ynl_sock *ys, __u32 id, __u8 cmd, __u8 version);\nstruct nlmsghdr *\nynl_gemsg_start_dump(struct ynl_sock *ys, __u32 id, __u8 cmd, __u8 version);\n\nint ynl_attr_validate(struct ynl_parse_arg *yarg, const struct nlattr *attr);\n\nint ynl_recv_ack(struct ynl_sock *ys, int ret);\nint ynl_cb_null(const struct nlmsghdr *nlh, void *data);\n\n \n\nstruct ynl_req_state {\n\tstruct ynl_parse_arg yarg;\n\tmnl_cb_t cb;\n\t__u32 rsp_cmd;\n};\n\nstruct ynl_dump_state {\n\tstruct ynl_sock *ys;\n\tstruct ynl_policy_nest *rsp_policy;\n\tvoid *first;\n\tstruct ynl_dump_list_type *last;\n\tsize_t alloc_sz;\n\tmnl_cb_t cb;\n\t__u32 rsp_cmd;\n};\n\nstruct ynl_ntf_info {\n\tstruct ynl_policy_nest *policy;\n\tmnl_cb_t cb;\n\tsize_t alloc_sz;\n\tvoid (*free)(struct ynl_ntf_base_type *ntf);\n};\n\nint ynl_exec(struct ynl_sock *ys, struct nlmsghdr *req_nlh,\n\t     struct ynl_req_state *yrs);\nint ynl_exec_dump(struct ynl_sock *ys, struct nlmsghdr *req_nlh,\n\t\t  struct ynl_dump_state *yds);\n\nvoid ynl_error_unknown_notification(struct ynl_sock *ys, __u8 cmd);\nint ynl_error_parse(struct ynl_parse_arg *yarg, const char *msg);\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}