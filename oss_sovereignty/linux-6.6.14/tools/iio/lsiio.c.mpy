{
  "module_name": "lsiio.c",
  "hash_id": "72125a773d50a779d7f2363a7ddc62f5cca7d021bbcbe0464286965f3730cbdd",
  "original_prompt": "Ingested from linux-6.6.14/tools/iio/lsiio.c",
  "human_readable_source": "\n \n\n#include <string.h>\n#include <dirent.h>\n#include <stdio.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/dir.h>\n#include \"iio_utils.h\"\n\nstatic enum verbosity {\n\tVERBLEVEL_DEFAULT,\t \n\tVERBLEVEL_SENSORS,\t \n} verblevel = VERBLEVEL_DEFAULT;\n\nconst char *type_device = \"iio:device\";\nconst char *type_trigger = \"trigger\";\n\nstatic inline int check_prefix(const char *str, const char *prefix)\n{\n\treturn strlen(str) > strlen(prefix) &&\n\t       strncmp(str, prefix, strlen(prefix)) == 0;\n}\n\nstatic inline int check_postfix(const char *str, const char *postfix)\n{\n\treturn strlen(str) > strlen(postfix) &&\n\t       strcmp(str + strlen(str) - strlen(postfix), postfix) == 0;\n}\n\nstatic int dump_channels(const char *dev_dir_name)\n{\n\tDIR *dp;\n\tconst struct dirent *ent;\n\n\tdp = opendir(dev_dir_name);\n\tif (!dp)\n\t\treturn -errno;\n\n\twhile (ent = readdir(dp), ent)\n\t\tif (check_prefix(ent->d_name, \"in_\") &&\n\t\t   (check_postfix(ent->d_name, \"_raw\") ||\n\t\t    check_postfix(ent->d_name, \"_input\")))\n\t\t\tprintf(\"   %-10s\\n\", ent->d_name);\n\n\treturn (closedir(dp) == -1) ? -errno : 0;\n}\n\nstatic int dump_one_device(const char *dev_dir_name)\n{\n\tchar name[IIO_MAX_NAME_LENGTH];\n\tint dev_idx;\n\tint ret;\n\n\tret = sscanf(dev_dir_name + strlen(iio_dir) + strlen(type_device), \"%i\",\n\t\t     &dev_idx);\n\tif (ret != 1)\n\t\treturn -EINVAL;\n\n\tret = read_sysfs_string(\"name\", dev_dir_name, name);\n\tif (ret < 0)\n\t\treturn ret;\n\n\tprintf(\"Device %03d: %s\\n\", dev_idx, name);\n\n\tif (verblevel >= VERBLEVEL_SENSORS)\n\t\treturn dump_channels(dev_dir_name);\n\n\treturn 0;\n}\n\nstatic int dump_one_trigger(const char *dev_dir_name)\n{\n\tchar name[IIO_MAX_NAME_LENGTH];\n\tint dev_idx;\n\tint ret;\n\n\tret = sscanf(dev_dir_name + strlen(iio_dir) + strlen(type_trigger),\n\t\t     \"%i\", &dev_idx);\n\tif (ret != 1)\n\t\treturn -EINVAL;\n\n\tret = read_sysfs_string(\"name\", dev_dir_name, name);\n\tif (ret < 0)\n\t\treturn ret;\n\n\tprintf(\"Trigger %03d: %s\\n\", dev_idx, name);\n\n\treturn 0;\n}\n\nstatic int dump_devices(void)\n{\n\tconst struct dirent *ent;\n\tint ret;\n\tDIR *dp;\n\n\tdp = opendir(iio_dir);\n\tif (!dp) {\n\t\tfprintf(stderr, \"No industrial I/O devices available\\n\");\n\t\treturn -ENODEV;\n\t}\n\n\twhile (ent = readdir(dp), ent) {\n\t\tif (check_prefix(ent->d_name, type_device)) {\n\t\t\tchar *dev_dir_name;\n\n\t\t\tif (asprintf(&dev_dir_name, \"%s%s\", iio_dir,\n\t\t\t\t     ent->d_name) < 0) {\n\t\t\t\tret = -ENOMEM;\n\t\t\t\tgoto error_close_dir;\n\t\t\t}\n\n\t\t\tret = dump_one_device(dev_dir_name);\n\t\t\tif (ret) {\n\t\t\t\tfree(dev_dir_name);\n\t\t\t\tgoto error_close_dir;\n\t\t\t}\n\n\t\t\tfree(dev_dir_name);\n\t\t\tif (verblevel >= VERBLEVEL_SENSORS)\n\t\t\t\tprintf(\"\\n\");\n\t\t}\n\t}\n\trewinddir(dp);\n\twhile (ent = readdir(dp), ent) {\n\t\tif (check_prefix(ent->d_name, type_trigger)) {\n\t\t\tchar *dev_dir_name;\n\n\t\t\tif (asprintf(&dev_dir_name, \"%s%s\", iio_dir,\n\t\t\t\t     ent->d_name) < 0) {\n\t\t\t\tret = -ENOMEM;\n\t\t\t\tgoto error_close_dir;\n\t\t\t}\n\n\t\t\tret = dump_one_trigger(dev_dir_name);\n\t\t\tif (ret) {\n\t\t\t\tfree(dev_dir_name);\n\t\t\t\tgoto error_close_dir;\n\t\t\t}\n\n\t\t\tfree(dev_dir_name);\n\t\t}\n\t}\n\n\treturn (closedir(dp) == -1) ? -errno : 0;\n\nerror_close_dir:\n\tif (closedir(dp) == -1)\n\t\tperror(\"dump_devices(): Failed to close directory\");\n\n\treturn ret;\n}\n\nint main(int argc, char **argv)\n{\n\tint c, err = 0;\n\n\twhile ((c = getopt(argc, argv, \"v\")) != EOF) {\n\t\tswitch (c) {\n\t\tcase 'v':\n\t\t\tverblevel++;\n\t\t\tbreak;\n\n\t\tcase '?':\n\t\tdefault:\n\t\t\terr++;\n\t\t\tbreak;\n\t\t}\n\t}\n\tif (err || argc > optind) {\n\t\tfprintf(stderr, \"Usage: lsiio [options]...\\n\"\n\t\t\t\"List industrial I/O devices\\n\"\n\t\t\t\"  -v  Increase verbosity (may be given multiple times)\\n\");\n\t\texit(1);\n\t}\n\n\treturn dump_devices();\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}