{
  "module_name": "getopt.c",
  "hash_id": "b99e7babc837304baf0615201d6760b1020a5caf4e68c0f9daa837b1adf75a39",
  "original_prompt": "Ingested from linux-6.6.14/tools/power/acpi/common/getopt.c",
  "human_readable_source": "\n \n\n \n\n#include <acpi/acpi.h>\n#include \"accommon.h\"\n#include \"acapps.h\"\n\n#define ACPI_OPTION_ERROR(msg, badchar) \\\n\tif (acpi_gbl_opterr) {fprintf (stderr, \"%s%c\\n\", msg, badchar);}\n\nint acpi_gbl_opterr = 1;\nint acpi_gbl_optind = 1;\nint acpi_gbl_sub_opt_char = 0;\nchar *acpi_gbl_optarg;\n\nstatic int current_char_ptr = 1;\n\n \n\nint acpi_getopt_argument(int argc, char **argv)\n{\n\n\tacpi_gbl_optind--;\n\tcurrent_char_ptr++;\n\n\tif (argv[acpi_gbl_optind][(int)(current_char_ptr + 1)] != '\\0') {\n\t\tacpi_gbl_optarg =\n\t\t    &argv[acpi_gbl_optind++][(int)(current_char_ptr + 1)];\n\t} else if (++acpi_gbl_optind >= argc) {\n\t\tACPI_OPTION_ERROR(\"\\nOption requires an argument\", 0);\n\n\t\tcurrent_char_ptr = 1;\n\t\treturn (-1);\n\t} else {\n\t\tacpi_gbl_optarg = argv[acpi_gbl_optind++];\n\t}\n\n\tcurrent_char_ptr = 1;\n\treturn (0);\n}\n\n \n\nint acpi_getopt(int argc, char **argv, char *opts)\n{\n\tint current_char;\n\tchar *opts_ptr;\n\n\tif (current_char_ptr == 1) {\n\t\tif (acpi_gbl_optind >= argc ||\n\t\t    argv[acpi_gbl_optind][0] != '-' ||\n\t\t    argv[acpi_gbl_optind][1] == '\\0') {\n\t\t\treturn (ACPI_OPT_END);\n\t\t} else if (strcmp(argv[acpi_gbl_optind], \"--\") == 0) {\n\t\t\tacpi_gbl_optind++;\n\t\t\treturn (ACPI_OPT_END);\n\t\t}\n\t}\n\n\t \n\n\tcurrent_char = argv[acpi_gbl_optind][current_char_ptr];\n\n\t \n\n\tif (current_char == ':' ||\n\t    (opts_ptr = strchr(opts, current_char)) == NULL) {\n\t\tACPI_OPTION_ERROR(\"Illegal option: -\", current_char);\n\n\t\tif (argv[acpi_gbl_optind][++current_char_ptr] == '\\0') {\n\t\t\tacpi_gbl_optind++;\n\t\t\tcurrent_char_ptr = 1;\n\t\t}\n\n\t\treturn ('?');\n\t}\n\n\t \n\n\tif (*++opts_ptr == ':') {\n\t\tif (argv[acpi_gbl_optind][(int)(current_char_ptr + 1)] != '\\0') {\n\t\t\tacpi_gbl_optarg =\n\t\t\t    &argv[acpi_gbl_optind++][(int)\n\t\t\t\t\t\t     (current_char_ptr + 1)];\n\t\t} else if (++acpi_gbl_optind >= argc) {\n\t\t\tACPI_OPTION_ERROR(\"Option requires an argument: -\",\n\t\t\t\t\t  current_char);\n\n\t\t\tcurrent_char_ptr = 1;\n\t\t\treturn ('?');\n\t\t} else {\n\t\t\tacpi_gbl_optarg = argv[acpi_gbl_optind++];\n\t\t}\n\n\t\tcurrent_char_ptr = 1;\n\t}\n\n\t \n\n\telse if (*opts_ptr == '+') {\n\t\tif (argv[acpi_gbl_optind][(int)(current_char_ptr + 1)] != '\\0') {\n\t\t\tacpi_gbl_optarg =\n\t\t\t    &argv[acpi_gbl_optind++][(int)\n\t\t\t\t\t\t     (current_char_ptr + 1)];\n\t\t} else if (++acpi_gbl_optind >= argc) {\n\t\t\tacpi_gbl_optarg = NULL;\n\t\t} else {\n\t\t\tacpi_gbl_optarg = argv[acpi_gbl_optind++];\n\t\t}\n\n\t\tcurrent_char_ptr = 1;\n\t}\n\n\t \n\n\telse if (*opts_ptr == '^') {\n\t\tif (argv[acpi_gbl_optind][(int)(current_char_ptr + 1)] != '\\0') {\n\t\t\tacpi_gbl_optarg =\n\t\t\t    &argv[acpi_gbl_optind][(int)(current_char_ptr + 1)];\n\t\t} else {\n\t\t\tacpi_gbl_optarg = \"^\";\n\t\t}\n\n\t\tacpi_gbl_sub_opt_char = acpi_gbl_optarg[0];\n\t\tacpi_gbl_optind++;\n\t\tcurrent_char_ptr = 1;\n\t}\n\n\t \n\n\telse if (*opts_ptr == '|') {\n\t\tif (argv[acpi_gbl_optind][(int)(current_char_ptr + 1)] != '\\0') {\n\t\t\tacpi_gbl_optarg =\n\t\t\t    &argv[acpi_gbl_optind][(int)(current_char_ptr + 1)];\n\t\t} else {\n\t\t\tACPI_OPTION_ERROR\n\t\t\t    (\"Option requires a single-character suboption: -\",\n\t\t\t     current_char);\n\n\t\t\tcurrent_char_ptr = 1;\n\t\t\treturn ('?');\n\t\t}\n\n\t\tacpi_gbl_sub_opt_char = acpi_gbl_optarg[0];\n\t\tacpi_gbl_optind++;\n\t\tcurrent_char_ptr = 1;\n\t}\n\n\t \n\n\telse {\n\t\tif (argv[acpi_gbl_optind][++current_char_ptr] == '\\0') {\n\t\t\tcurrent_char_ptr = 1;\n\t\t\tacpi_gbl_optind++;\n\t\t}\n\n\t\tacpi_gbl_optarg = NULL;\n\t}\n\n\treturn (current_char);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}