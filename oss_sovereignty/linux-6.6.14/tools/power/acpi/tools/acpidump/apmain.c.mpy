{
  "module_name": "apmain.c",
  "hash_id": "d1b33a610a3b2525028ba878cd333bb8888cb28388d3a89159ffbcc9856d622a",
  "original_prompt": "Ingested from linux-6.6.14/tools/power/acpi/tools/acpidump/apmain.c",
  "human_readable_source": "\n \n\n#define _DECLARE_GLOBALS\n#include \"acpidump.h\"\n\n \n\n \n\nstatic void ap_display_usage(void);\n\nstatic int ap_do_options(int argc, char **argv);\n\nstatic int ap_insert_action(char *argument, u32 to_be_done);\n\n \n\nstruct ap_dump_action action_table[AP_MAX_ACTIONS];\nu32 current_action = 0;\n\n#define AP_UTILITY_NAME             \"ACPI Binary Table Dump Utility\"\n#define AP_SUPPORTED_OPTIONS        \"?a:bc:f:hn:o:r:sv^xz\"\n\n \n\nstatic void ap_display_usage(void)\n{\n\n\tACPI_USAGE_HEADER(\"acpidump [options]\");\n\n\tACPI_OPTION(\"-b\", \"Dump tables to binary files\");\n\tACPI_OPTION(\"-h -?\", \"This help message\");\n\tACPI_OPTION(\"-o <File>\", \"Redirect output to file\");\n\tACPI_OPTION(\"-r <Address>\", \"Dump tables from specified RSDP\");\n\tACPI_OPTION(\"-s\", \"Print table summaries only\");\n\tACPI_OPTION(\"-v\", \"Display version information\");\n\tACPI_OPTION(\"-vd\", \"Display build date and time\");\n\tACPI_OPTION(\"-z\", \"Verbose mode\");\n\n\tACPI_USAGE_TEXT(\"\\nTable Options:\\n\");\n\n\tACPI_OPTION(\"-a <Address>\", \"Get table via a physical address\");\n\tACPI_OPTION(\"-c <on|off>\", \"Turning on/off customized table dumping\");\n\tACPI_OPTION(\"-f <BinaryFile>\", \"Get table via a binary file\");\n\tACPI_OPTION(\"-n <Signature>\", \"Get table via a name/signature\");\n\tACPI_OPTION(\"-x\", \"Do not use but dump XSDT\");\n\tACPI_OPTION(\"-x -x\", \"Do not use or dump XSDT\");\n\n\tACPI_USAGE_TEXT(\"\\n\"\n\t\t\t\"Invocation without parameters dumps all available tables\\n\"\n\t\t\t\"Multiple mixed instances of -a, -f, and -n are supported\\n\\n\");\n}\n\n \n\nstatic int ap_insert_action(char *argument, u32 to_be_done)\n{\n\n\t \n\n\taction_table[current_action].argument = argument;\n\taction_table[current_action].to_be_done = to_be_done;\n\n\tcurrent_action++;\n\tif (current_action > AP_MAX_ACTIONS) {\n\t\tfprintf(stderr, \"Too many table options (max %d)\\n\",\n\t\t\tAP_MAX_ACTIONS);\n\t\treturn (-1);\n\t}\n\n\treturn (0);\n}\n\n \n\nstatic int ap_do_options(int argc, char **argv)\n{\n\tint j;\n\tacpi_status status;\n\n\t \n\n\twhile ((j =\n\t\tacpi_getopt(argc, argv, AP_SUPPORTED_OPTIONS)) != ACPI_OPT_END)\n\t\tswitch (j) {\n\t\t\t \n\t\tcase 'b':\t \n\n\t\t\tgbl_binary_mode = TRUE;\n\t\t\tcontinue;\n\n\t\tcase 'c':\t \n\n\t\t\tif (!strcmp(acpi_gbl_optarg, \"on\")) {\n\t\t\t\tgbl_dump_customized_tables = TRUE;\n\t\t\t} else if (!strcmp(acpi_gbl_optarg, \"off\")) {\n\t\t\t\tgbl_dump_customized_tables = FALSE;\n\t\t\t} else {\n\t\t\t\tfprintf(stderr,\n\t\t\t\t\t\"%s: Cannot handle this switch, please use on|off\\n\",\n\t\t\t\t\tacpi_gbl_optarg);\n\t\t\t\treturn (-1);\n\t\t\t}\n\t\t\tcontinue;\n\n\t\tcase 'h':\n\t\tcase '?':\n\n\t\t\tap_display_usage();\n\t\t\treturn (1);\n\n\t\tcase 'o':\t \n\n\t\t\tif (ap_open_output_file(acpi_gbl_optarg)) {\n\t\t\t\treturn (-1);\n\t\t\t}\n\t\t\tcontinue;\n\n\t\tcase 'r':\t \n\n\t\t\tstatus =\n\t\t\t    acpi_ut_strtoul64(acpi_gbl_optarg, &gbl_rsdp_base);\n\t\t\tif (ACPI_FAILURE(status)) {\n\t\t\t\tfprintf(stderr,\n\t\t\t\t\t\"%s: Could not convert to a physical address\\n\",\n\t\t\t\t\tacpi_gbl_optarg);\n\t\t\t\treturn (-1);\n\t\t\t}\n\t\t\tcontinue;\n\n\t\tcase 's':\t \n\n\t\t\tgbl_summary_mode = TRUE;\n\t\t\tcontinue;\n\n\t\tcase 'x':\t \n\n\t\t\tif (!acpi_gbl_do_not_use_xsdt) {\n\t\t\t\tacpi_gbl_do_not_use_xsdt = TRUE;\n\t\t\t} else {\n\t\t\t\tgbl_do_not_dump_xsdt = TRUE;\n\t\t\t}\n\t\t\tcontinue;\n\n\t\tcase 'v':\t \n\n\t\t\tswitch (acpi_gbl_optarg[0]) {\n\t\t\tcase '^':\t \n\n\t\t\t\tfprintf(stderr,\n\t\t\t\t\tACPI_COMMON_SIGNON(AP_UTILITY_NAME));\n\t\t\t\treturn (1);\n\n\t\t\tcase 'd':\n\n\t\t\t\tfprintf(stderr,\n\t\t\t\t\tACPI_COMMON_SIGNON(AP_UTILITY_NAME));\n\t\t\t\tprintf(ACPI_COMMON_BUILD_TIME);\n\t\t\t\treturn (1);\n\n\t\t\tdefault:\n\n\t\t\t\tprintf(\"Unknown option: -v%s\\n\",\n\t\t\t\t       acpi_gbl_optarg);\n\t\t\t\treturn (-1);\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase 'z':\t \n\n\t\t\tgbl_verbose_mode = TRUE;\n\t\t\tfprintf(stderr, ACPI_COMMON_SIGNON(AP_UTILITY_NAME));\n\t\t\tcontinue;\n\n\t\t\t \n\t\tcase 'a':\t \n\n\t\t\tif (ap_insert_action\n\t\t\t    (acpi_gbl_optarg, AP_DUMP_TABLE_BY_ADDRESS)) {\n\t\t\t\treturn (-1);\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase 'f':\t \n\n\t\t\tif (ap_insert_action\n\t\t\t    (acpi_gbl_optarg, AP_DUMP_TABLE_BY_FILE)) {\n\t\t\t\treturn (-1);\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase 'n':\t \n\n\t\t\tif (ap_insert_action\n\t\t\t    (acpi_gbl_optarg, AP_DUMP_TABLE_BY_NAME)) {\n\t\t\t\treturn (-1);\n\t\t\t}\n\t\t\tbreak;\n\n\t\tdefault:\n\n\t\t\tap_display_usage();\n\t\t\treturn (-1);\n\t\t}\n\n\t \n\n\tif (current_action == 0) {\n\t\tif (ap_insert_action(NULL, AP_DUMP_ALL_TABLES)) {\n\t\t\treturn (-1);\n\t\t}\n\t}\n\n\treturn (0);\n}\n\n \n\n#if !defined(_GNU_EFI) && !defined(_EDK2_EFI)\nint ACPI_SYSTEM_XFACE main(int argc, char *argv[])\n#else\nint ACPI_SYSTEM_XFACE acpi_main(int argc, char *argv[])\n#endif\n{\n\tint status = 0;\n\tstruct ap_dump_action *action;\n\tu32 file_size;\n\tu32 i;\n\n\tACPI_DEBUG_INITIALIZE();\t \n\tacpi_os_initialize();\n\tgbl_output_file = ACPI_FILE_OUT;\n\tacpi_gbl_integer_byte_width = 8;\n\n\t \n\n\tstatus = ap_do_options(argc, argv);\n\tif (status > 0) {\n\t\treturn (0);\n\t}\n\tif (status < 0) {\n\t\treturn (status);\n\t}\n\n\t \n\n\tfor (i = 0; i < current_action; i++) {\n\t\taction = &action_table[i];\n\t\tswitch (action->to_be_done) {\n\t\tcase AP_DUMP_ALL_TABLES:\n\n\t\t\tstatus = ap_dump_all_tables();\n\t\t\tbreak;\n\n\t\tcase AP_DUMP_TABLE_BY_ADDRESS:\n\n\t\t\tstatus = ap_dump_table_by_address(action->argument);\n\t\t\tbreak;\n\n\t\tcase AP_DUMP_TABLE_BY_NAME:\n\n\t\t\tstatus = ap_dump_table_by_name(action->argument);\n\t\t\tbreak;\n\n\t\tcase AP_DUMP_TABLE_BY_FILE:\n\n\t\t\tstatus = ap_dump_table_from_file(action->argument);\n\t\t\tbreak;\n\n\t\tdefault:\n\n\t\t\tfprintf(stderr,\n\t\t\t\t\"Internal error, invalid action: 0x%X\\n\",\n\t\t\t\taction->to_be_done);\n\t\t\treturn (-1);\n\t\t}\n\n\t\tif (status) {\n\t\t\treturn (status);\n\t\t}\n\t}\n\n\tif (gbl_output_filename) {\n\t\tif (gbl_verbose_mode) {\n\n\t\t\t \n\n\t\t\tfile_size = cm_get_file_size(gbl_output_file);\n\t\t\tfprintf(stderr,\n\t\t\t\t\"Output file %s contains 0x%X (%u) bytes\\n\\n\",\n\t\t\t\tgbl_output_filename, file_size, file_size);\n\t\t}\n\n\t\tfclose(gbl_output_file);\n\t}\n\n\treturn (status);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}