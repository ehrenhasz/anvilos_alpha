{
  "module_name": "apdump.c",
  "hash_id": "68ffbbf49add87b8335186750fd864830564ae9c63129c6e55ebce6b4f465afd",
  "original_prompt": "Ingested from linux-6.6.14/tools/power/acpi/tools/acpidump/apdump.c",
  "human_readable_source": "\n \n\n#include \"acpidump.h\"\n\n \n\nstatic int\nap_dump_table_buffer(struct acpi_table_header *table,\n\t\t     u32 instance, acpi_physical_address address);\n\n \n\nu8 ap_is_valid_header(struct acpi_table_header *table)\n{\n\n\tif (!ACPI_VALIDATE_RSDP_SIG(table->signature)) {\n\n\t\t \n\n\t\tif (!acpi_ut_valid_nameseg(table->signature)) {\n\t\t\tfprintf(stderr,\n\t\t\t\t\"Table signature (0x%8.8X) is invalid\\n\",\n\t\t\t\t*(u32 *)table->signature);\n\t\t\treturn (FALSE);\n\t\t}\n\n\t\t \n\n\t\tif (table->length < sizeof(struct acpi_table_header)) {\n\t\t\tfprintf(stderr, \"Table length (0x%8.8X) is invalid\\n\",\n\t\t\t\ttable->length);\n\t\t\treturn (FALSE);\n\t\t}\n\t}\n\n\treturn (TRUE);\n}\n\n \n\nu8 ap_is_valid_checksum(struct acpi_table_header *table)\n{\n\tacpi_status status;\n\tstruct acpi_table_rsdp *rsdp;\n\n\tif (ACPI_VALIDATE_RSDP_SIG(table->signature)) {\n\t\t \n\t\trsdp = ACPI_CAST_PTR(struct acpi_table_rsdp, table);\n\t\tstatus = acpi_tb_validate_rsdp(rsdp);\n\t} else {\n\t\t \n\n\t\tstatus = acpi_ut_verify_checksum(table, table->length);\n\t}\n\n\tif (ACPI_FAILURE(status)) {\n\t\tfprintf(stderr, \"%4.4s: Warning: wrong checksum in table\\n\",\n\t\t\ttable->signature);\n\t}\n\n\treturn (AE_OK);\n}\n\n \n\nu32 ap_get_table_length(struct acpi_table_header *table)\n{\n\tstruct acpi_table_rsdp *rsdp;\n\n\t \n\n\tif (!ap_is_valid_header(table)) {\n\t\treturn (0);\n\t}\n\n\tif (ACPI_VALIDATE_RSDP_SIG(table->signature)) {\n\t\trsdp = ACPI_CAST_PTR(struct acpi_table_rsdp, table);\n\t\treturn (acpi_tb_get_rsdp_length(rsdp));\n\t}\n\n\t \n\n\treturn (table->length);\n}\n\n \n\nstatic int\nap_dump_table_buffer(struct acpi_table_header *table,\n\t\t     u32 instance, acpi_physical_address address)\n{\n\tu32 table_length;\n\n\ttable_length = ap_get_table_length(table);\n\n\t \n\n\tif (gbl_summary_mode) {\n\t\tacpi_tb_print_table_header(address, table);\n\t\treturn (0);\n\t}\n\n\t \n\n\tif (gbl_binary_mode) {\n\t\treturn (ap_write_to_binary_file(table, instance));\n\t}\n\n\t \n\tfprintf(gbl_output_file, \"%4.4s @ 0x%8.8X%8.8X\\n\",\n\t\ttable->signature, ACPI_FORMAT_UINT64(address));\n\n\tacpi_ut_dump_buffer_to_file(gbl_output_file,\n\t\t\t\t    ACPI_CAST_PTR(u8, table), table_length,\n\t\t\t\t    DB_BYTE_DISPLAY, 0);\n\tfprintf(gbl_output_file, \"\\n\");\n\treturn (0);\n}\n\n \n\nint ap_dump_all_tables(void)\n{\n\tstruct acpi_table_header *table;\n\tu32 instance = 0;\n\tacpi_physical_address address;\n\tacpi_status status;\n\tint table_status;\n\tu32 i;\n\n\t \n\n\tfor (i = 0; i < AP_MAX_ACPI_FILES; i++) {\n\t\tstatus =\n\t\t    acpi_os_get_table_by_index(i, &table, &instance, &address);\n\t\tif (ACPI_FAILURE(status)) {\n\n\t\t\t \n\n\t\t\tif (status == AE_LIMIT) {\n\t\t\t\treturn (0);\n\t\t\t} else if (i == 0) {\n\t\t\t\tfprintf(stderr,\n\t\t\t\t\t\"Could not get ACPI tables, %s\\n\",\n\t\t\t\t\tacpi_format_exception(status));\n\t\t\t\treturn (-1);\n\t\t\t} else {\n\t\t\t\tfprintf(stderr,\n\t\t\t\t\t\"Could not get ACPI table at index %u, %s\\n\",\n\t\t\t\t\ti, acpi_format_exception(status));\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t}\n\n\t\ttable_status = ap_dump_table_buffer(table, instance, address);\n\t\tACPI_FREE(table);\n\n\t\tif (table_status) {\n\t\t\tbreak;\n\t\t}\n\t}\n\n\t \n\n\treturn (-1);\n}\n\n \n\nint ap_dump_table_by_address(char *ascii_address)\n{\n\tacpi_physical_address address;\n\tstruct acpi_table_header *table;\n\tacpi_status status;\n\tint table_status;\n\tu64 long_address;\n\n\t \n\n\tstatus = acpi_ut_strtoul64(ascii_address, &long_address);\n\tif (ACPI_FAILURE(status)) {\n\t\tfprintf(stderr, \"%s: Could not convert to a physical address\\n\",\n\t\t\tascii_address);\n\t\treturn (-1);\n\t}\n\n\taddress = (acpi_physical_address)long_address;\n\tstatus = acpi_os_get_table_by_address(address, &table);\n\tif (ACPI_FAILURE(status)) {\n\t\tfprintf(stderr, \"Could not get table at 0x%8.8X%8.8X, %s\\n\",\n\t\t\tACPI_FORMAT_UINT64(address),\n\t\t\tacpi_format_exception(status));\n\t\treturn (-1);\n\t}\n\n\ttable_status = ap_dump_table_buffer(table, 0, address);\n\tACPI_FREE(table);\n\treturn (table_status);\n}\n\n \n\nint ap_dump_table_by_name(char *signature)\n{\n\tchar local_signature[ACPI_NAMESEG_SIZE + 1];\n\tu32 instance;\n\tstruct acpi_table_header *table;\n\tacpi_physical_address address;\n\tacpi_status status;\n\tint table_status;\n\n\tif (strlen(signature) != ACPI_NAMESEG_SIZE) {\n\t\tfprintf(stderr,\n\t\t\t\"Invalid table signature [%s]: must be exactly 4 characters\\n\",\n\t\t\tsignature);\n\t\treturn (-1);\n\t}\n\n\t \n\n\tstrcpy(local_signature, signature);\n\tacpi_ut_strupr(local_signature);\n\n\t \n\n\tif (ACPI_COMPARE_NAMESEG(local_signature, \"FADT\")) {\n\t\tstrcpy(local_signature, ACPI_SIG_FADT);\n\t} else if (ACPI_COMPARE_NAMESEG(local_signature, \"MADT\")) {\n\t\tstrcpy(local_signature, ACPI_SIG_MADT);\n\t}\n\n\t \n\n\tfor (instance = 0; instance < AP_MAX_ACPI_FILES; instance++) {\n\t\tstatus = acpi_os_get_table_by_name(local_signature, instance,\n\t\t\t\t\t\t   &table, &address);\n\t\tif (ACPI_FAILURE(status)) {\n\n\t\t\t \n\n\t\t\tif (status == AE_LIMIT) {\n\t\t\t\treturn (0);\n\t\t\t}\n\n\t\t\tfprintf(stderr,\n\t\t\t\t\"Could not get ACPI table with signature [%s], %s\\n\",\n\t\t\t\tlocal_signature, acpi_format_exception(status));\n\t\t\treturn (-1);\n\t\t}\n\n\t\ttable_status = ap_dump_table_buffer(table, instance, address);\n\t\tACPI_FREE(table);\n\n\t\tif (table_status) {\n\t\t\tbreak;\n\t\t}\n\t}\n\n\t \n\n\treturn (-1);\n}\n\n \n\nint ap_dump_table_from_file(char *pathname)\n{\n\tstruct acpi_table_header *table;\n\tu32 file_size = 0;\n\tint table_status = -1;\n\n\t \n\n\ttable = ap_get_table_from_file(pathname, &file_size);\n\tif (!table) {\n\t\treturn (-1);\n\t}\n\n\tif (!acpi_ut_valid_nameseg(table->signature)) {\n\t\tfprintf(stderr,\n\t\t\t\"No valid ACPI signature was found in input file %s\\n\",\n\t\t\tpathname);\n\t}\n\n\t \n\n\tif (table->length > file_size) {\n\t\tfprintf(stderr,\n\t\t\t\"Table length (0x%X) is too large for input file (0x%X) %s\\n\",\n\t\t\ttable->length, file_size, pathname);\n\t\tgoto exit;\n\t}\n\n\tif (gbl_verbose_mode) {\n\t\tfprintf(stderr,\n\t\t\t\"Input file:  %s contains table [%4.4s], 0x%X (%u) bytes\\n\",\n\t\t\tpathname, table->signature, file_size, file_size);\n\t}\n\n\ttable_status = ap_dump_table_buffer(table, 0, 0);\n\nexit:\n\tACPI_FREE(table);\n\treturn (table_status);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}