{
  "module_name": "apfiles.c",
  "hash_id": "8e78928d6f998243cbb2889f52c740e9b0e74bcab78d080dd4f5d0f822fdd988",
  "original_prompt": "Ingested from linux-6.6.14/tools/power/acpi/tools/acpidump/apfiles.c",
  "human_readable_source": "\n \n\n#include \"acpidump.h\"\n\n \n\nstatic int ap_is_existing_file(char *pathname);\n\n \n\nstatic int ap_is_existing_file(char *pathname)\n{\n#if !defined(_GNU_EFI) && !defined(_EDK2_EFI)\n\tstruct stat stat_info;\n\tint in_char;\n\n\tif (!stat(pathname, &stat_info)) {\n\t\tfprintf(stderr,\n\t\t\t\"Target path already exists, overwrite? [y|n] \");\n\n\t\tin_char = fgetc(stdin);\n\t\tif (in_char == '\\n') {\n\t\t\tin_char = fgetc(stdin);\n\t\t}\n\n\t\tif (in_char != 'y' && in_char != 'Y') {\n\t\t\treturn (-1);\n\t\t}\n\t}\n#endif\n\n\treturn (0);\n}\n\n \n\nint ap_open_output_file(char *pathname)\n{\n\tACPI_FILE file;\n\n\t \n\n\tif (ap_is_existing_file(pathname) != 0) {\n\t\treturn (-1);\n\t}\n\n\t \n\n\tfile = fopen(pathname, \"w\");\n\tif (!file) {\n\t\tfprintf(stderr, \"Could not open output file: %s\\n\", pathname);\n\t\treturn (-1);\n\t}\n\n\t \n\n\tgbl_output_file = file;\n\tgbl_output_filename = pathname;\n\treturn (0);\n}\n\n \n\nint ap_write_to_binary_file(struct acpi_table_header *table, u32 instance)\n{\n\tchar filename[ACPI_NAMESEG_SIZE + 16];\n\tchar instance_str[16];\n\tACPI_FILE file;\n\tacpi_size actual;\n\tu32 table_length;\n\n\t \n\n\ttable_length = ap_get_table_length(table);\n\n\t \n\n\tif (ACPI_VALIDATE_RSDP_SIG(table->signature)) {\n\t\tACPI_COPY_NAMESEG(filename, ACPI_RSDP_NAME);\n\t} else {\n\t\tACPI_COPY_NAMESEG(filename, table->signature);\n\t}\n\n\tfilename[0] = (char)tolower((int)filename[0]);\n\tfilename[1] = (char)tolower((int)filename[1]);\n\tfilename[2] = (char)tolower((int)filename[2]);\n\tfilename[3] = (char)tolower((int)filename[3]);\n\tfilename[ACPI_NAMESEG_SIZE] = 0;\n\n\t \n\n\tif (instance > 0) {\n\t\tsnprintf(instance_str, sizeof(instance_str), \"%u\", instance);\n\t\tstrcat(filename, instance_str);\n\t}\n\n\tstrcat(filename, FILE_SUFFIX_BINARY_TABLE);\n\n\tif (gbl_verbose_mode) {\n\t\tfprintf(stderr,\n\t\t\t\"Writing [%4.4s] to binary file: %s 0x%X (%u) bytes\\n\",\n\t\t\ttable->signature, filename, table->length,\n\t\t\ttable->length);\n\t}\n\n\t \n\n\tfile = fopen(filename, \"wb\");\n\tif (!file) {\n\t\tfprintf(stderr, \"Could not open output file: %s\\n\", filename);\n\t\treturn (-1);\n\t}\n\n\tactual = fwrite(table, 1, table_length, file);\n\tif (actual != table_length) {\n\t\tfprintf(stderr, \"Error writing binary output file: %s\\n\",\n\t\t\tfilename);\n\t\tfclose(file);\n\t\treturn (-1);\n\t}\n\n\tfclose(file);\n\treturn (0);\n}\n\n \n\nstruct acpi_table_header *ap_get_table_from_file(char *pathname,\n\t\t\t\t\t\t u32 *out_file_size)\n{\n\tstruct acpi_table_header *buffer = NULL;\n\tACPI_FILE file;\n\tu32 file_size;\n\tacpi_size actual;\n\n\t \n\n\tfile = fopen(pathname, \"rb\");\n\tif (!file) {\n\t\tfprintf(stderr, \"Could not open input file: %s\\n\", pathname);\n\t\treturn (NULL);\n\t}\n\n\t \n\n\tfile_size = cm_get_file_size(file);\n\tif (file_size == ACPI_UINT32_MAX) {\n\t\tfprintf(stderr,\n\t\t\t\"Could not get input file size: %s\\n\", pathname);\n\t\tgoto cleanup;\n\t}\n\n\t \n\n\tbuffer = ACPI_ALLOCATE_ZEROED(file_size);\n\tif (!buffer) {\n\t\tfprintf(stderr,\n\t\t\t\"Could not allocate file buffer of size: %u\\n\",\n\t\t\tfile_size);\n\t\tgoto cleanup;\n\t}\n\n\t \n\n\tactual = fread(buffer, 1, file_size, file);\n\tif (actual != file_size) {\n\t\tfprintf(stderr, \"Could not read input file: %s\\n\", pathname);\n\t\tACPI_FREE(buffer);\n\t\tbuffer = NULL;\n\t\tgoto cleanup;\n\t}\n\n\t*out_file_size = file_size;\n\ncleanup:\n\tfclose(file);\n\treturn (buffer);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}