{
  "module_name": "osunixdir.c",
  "hash_id": "d8696203043a0cfd8e17538c5d93613d1ebcc4fcb7c1970ea4285c9cf018226a",
  "original_prompt": "Ingested from linux-6.6.14/tools/power/acpi/os_specific/service_layers/osunixdir.c",
  "human_readable_source": "\n \n\n#include <acpi/acpi.h>\n\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <dirent.h>\n#include <fnmatch.h>\n#include <ctype.h>\n#include <sys/stat.h>\n\n \ntypedef struct external_find_info {\n\tchar *dir_pathname;\n\tDIR *dir_ptr;\n\tchar temp_buffer[256];\n\tchar *wildcard_spec;\n\tchar requested_file_type;\n\n} external_find_info;\n\n \n\nvoid *acpi_os_open_directory(char *dir_pathname,\n\t\t\t     char *wildcard_spec, char requested_file_type)\n{\n\tstruct external_find_info *external_info;\n\tDIR *dir;\n\n\t \n\n\texternal_info = calloc(1, sizeof(struct external_find_info));\n\tif (!external_info) {\n\t\treturn (NULL);\n\t}\n\n\t \n\n\tdir = opendir(dir_pathname);\n\tif (!dir) {\n\t\tfprintf(stderr, \"Cannot open directory - %s\\n\", dir_pathname);\n\t\tfree(external_info);\n\t\treturn (NULL);\n\t}\n\n\t \n\n\texternal_info->wildcard_spec = wildcard_spec;\n\texternal_info->requested_file_type = requested_file_type;\n\texternal_info->dir_pathname = dir_pathname;\n\texternal_info->dir_ptr = dir;\n\treturn (external_info);\n}\n\n \n\nchar *acpi_os_get_next_filename(void *dir_handle)\n{\n\tstruct external_find_info *external_info = dir_handle;\n\tstruct dirent *dir_entry;\n\tchar *temp_str;\n\tint str_len;\n\tstruct stat temp_stat;\n\tint err;\n\n\twhile ((dir_entry = readdir(external_info->dir_ptr))) {\n\t\tif (!fnmatch\n\t\t    (external_info->wildcard_spec, dir_entry->d_name, 0)) {\n\t\t\tif (dir_entry->d_name[0] == '.') {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tstr_len = strlen(dir_entry->d_name) +\n\t\t\t    strlen(external_info->dir_pathname) + 2;\n\n\t\t\ttemp_str = calloc(str_len, 1);\n\t\t\tif (!temp_str) {\n\t\t\t\tfprintf(stderr,\n\t\t\t\t\t\"Could not allocate buffer for temporary string\\n\");\n\t\t\t\treturn (NULL);\n\t\t\t}\n\n\t\t\tstrcpy(temp_str, external_info->dir_pathname);\n\t\t\tstrcat(temp_str, \"/\");\n\t\t\tstrcat(temp_str, dir_entry->d_name);\n\n\t\t\terr = stat(temp_str, &temp_stat);\n\t\t\tif (err == -1) {\n\t\t\t\tfprintf(stderr,\n\t\t\t\t\t\"Cannot stat file (should not happen) - %s\\n\",\n\t\t\t\t\ttemp_str);\n\t\t\t\tfree(temp_str);\n\t\t\t\treturn (NULL);\n\t\t\t}\n\n\t\t\tfree(temp_str);\n\n\t\t\tif ((S_ISDIR(temp_stat.st_mode)\n\t\t\t     && (external_info->requested_file_type ==\n\t\t\t\t REQUEST_DIR_ONLY))\n\t\t\t    || ((!S_ISDIR(temp_stat.st_mode)\n\t\t\t\t && external_info->requested_file_type ==\n\t\t\t\t REQUEST_FILE_ONLY))) {\n\n\t\t\t\t \n\n\t\t\t\tstrcpy(external_info->temp_buffer,\n\t\t\t\t       dir_entry->d_name);\n\t\t\t\treturn (external_info->temp_buffer);\n\t\t\t}\n\t\t}\n\t}\n\n\treturn (NULL);\n}\n\n \n\nvoid acpi_os_close_directory(void *dir_handle)\n{\n\tstruct external_find_info *external_info = dir_handle;\n\n\t \n\n\tclosedir(external_info->dir_ptr);\n\tfree(dir_handle);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}