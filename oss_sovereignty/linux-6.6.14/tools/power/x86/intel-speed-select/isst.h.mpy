{
  "module_name": "isst.h",
  "hash_id": "8be30a71bd0c18b5c6b7310adf10e13b946111c46a5e89464c0f409bdbedefab",
  "original_prompt": "Ingested from linux-6.6.14/tools/power/x86/intel-speed-select/isst.h",
  "human_readable_source": " \n \n\n#ifndef _ISST_H_\n#define _ISST_H_\n\n#include <stdio.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <sched.h>\n#include <sys/stat.h>\n#include <sys/resource.h>\n#include <getopt.h>\n#include <err.h>\n#include <fcntl.h>\n#include <signal.h>\n#include <sys/time.h>\n#include <limits.h>\n#include <stdlib.h>\n#include <string.h>\n#include <cpuid.h>\n#include <dirent.h>\n#include <errno.h>\n\n#include <stdarg.h>\n#include <sys/ioctl.h>\n\n#include <linux/isst_if.h>\n\n#define BIT(x) (1 << (x))\n#define BIT_ULL(nr) (1ULL << (nr))\n#define GENMASK(h, l) (((~0UL) << (l)) & (~0UL >> (sizeof(long) * 8 - 1 - (h))))\n#define GENMASK_ULL(h, l)                                                      \\\n\t(((~0ULL) << (l)) & (~0ULL >> (sizeof(long long) * 8 - 1 - (h))))\n\n#define CONFIG_TDP\t\t\t\t0x7f\n#define CONFIG_TDP_GET_LEVELS_INFO\t\t0x00\n#define CONFIG_TDP_GET_TDP_CONTROL\t\t0x01\n#define CONFIG_TDP_SET_TDP_CONTROL\t\t0x02\n#define CONFIG_TDP_GET_TDP_INFO\t\t\t0x03\n#define CONFIG_TDP_GET_PWR_INFO\t\t\t0x04\n#define CONFIG_TDP_GET_TJMAX_INFO\t\t0x05\n#define CONFIG_TDP_GET_CORE_MASK\t\t0x06\n#define CONFIG_TDP_GET_TURBO_LIMIT_RATIOS\t0x07\n#define CONFIG_TDP_SET_LEVEL\t\t\t0x08\n#define CONFIG_TDP_GET_UNCORE_P0_P1_INFO\t0X09\n#define CONFIG_TDP_GET_P1_INFO\t\t\t0x0a\n#define CONFIG_TDP_GET_MEM_FREQ\t\t\t0x0b\n#define\tCONFIG_TDP_GET_RATIO_INFO\t\t0x0c\n\n#define CONFIG_TDP_GET_FACT_HP_TURBO_LIMIT_NUMCORES\t0x10\n#define CONFIG_TDP_GET_FACT_HP_TURBO_LIMIT_RATIOS\t0x11\n#define CONFIG_TDP_GET_FACT_LP_CLIPPING_RATIO\t\t0x12\n\n#define CONFIG_TDP_PBF_GET_CORE_MASK_INFO\t0x20\n#define CONFIG_TDP_PBF_GET_P1HI_P1LO_INFO\t0x21\n#define CONFIG_TDP_PBF_GET_TJ_MAX_INFO\t\t0x22\n#define CONFIG_TDP_PBF_GET_TDP_INFO\t\t0X23\n\n#define CONFIG_CLOS\t\t\t\t0xd0\n#define CLOS_PQR_ASSOC\t\t\t\t0x00\n#define CLOS_PM_CLOS\t\t\t\t0x01\n#define CLOS_PM_QOS_CONFIG\t\t\t0x02\n#define CLOS_STATUS\t\t\t\t0x03\n\n#define MBOX_CMD_WRITE_BIT\t\t\t0x08\n\n#define PM_QOS_INFO_OFFSET\t\t\t0x00\n#define PM_QOS_CONFIG_OFFSET\t\t\t0x04\n#define PM_CLOS_OFFSET\t\t\t\t0x08\n#define PQR_ASSOC_OFFSET\t\t\t0x20\n\n#define READ_PM_CONFIG\t\t\t\t0x94\n#define WRITE_PM_CONFIG\t\t\t\t0x95\n#define PM_FEATURE\t\t\t\t0x03\n\n#define DISP_FREQ_MULTIPLIER 100\n\n#define MAX_PACKAGE_COUNT\t32\n#define MAX_DIE_PER_PACKAGE\t2\n#define MAX_PUNIT_PER_DIE\t8\n\n \nstruct isst_id {\n\tint cpu;\n\tint pkg;\n\tint die;\n\tint punit;\n};\n\nstruct isst_clos_config {\n\tunsigned int clos_min;\n\tunsigned int clos_max;\n\tunsigned char epp;\n\tunsigned char clos_prop_prio;\n\tunsigned char clos_desired;\n};\n\nstruct isst_fact_bucket_info {\n\tint hp_cores;\n\tint hp_ratios[TRL_MAX_LEVELS];\n};\n\nstruct isst_pbf_info {\n\tint pbf_acticated;\n\tint pbf_available;\n\tsize_t core_cpumask_size;\n\tcpu_set_t *core_cpumask;\n\tint p1_high;\n\tint p1_low;\n\tint t_control;\n\tint t_prochot;\n\tint tdp;\n};\n\n#define ISST_TRL_MAX_ACTIVE_CORES\t8\n#define ISST_FACT_MAX_BUCKETS\t\t8\nstruct isst_fact_info {\n\tint lp_ratios[TRL_MAX_LEVELS];\n\tstruct isst_fact_bucket_info bucket_info[ISST_FACT_MAX_BUCKETS];\n};\n\nstruct isst_pkg_ctdp_level_info {\n\tint processed;\n\tint control_cpu;\n\tint pkg_id;\n\tint die_id;\n\tint level;\n\tint fact_support;\n\tint pbf_support;\n\tint fact_enabled;\n\tint pbf_enabled;\n\tint sst_cp_support;\n\tint sst_cp_enabled;\n\tint tdp_ratio;\n\tint active;\n\tint tdp_control;\n\tint pkg_tdp;\n\tint pkg_min_power;\n\tint pkg_max_power;\n\tint fact;\n\tint t_proc_hot;\n\tint cooling_type;\n\tint uncore_p0;\n\tint uncore_p1;\n\tint uncore_pm;\n\tint sse_p1;\n\tint avx2_p1;\n\tint avx512_p1;\n\tint amx_p1;\n\tint mem_freq;\n\tsize_t core_cpumask_size;\n\tcpu_set_t *core_cpumask;\n\tint cpu_count;\n\tunsigned long long trl_cores;\t \n\tint trl_ratios[TRL_MAX_LEVELS][ISST_TRL_MAX_ACTIVE_CORES];\n\tint kobj_bucket_index;\n\tint active_bucket;\n\tint fact_max_index;\n\tint fact_max_config;\n\tint pbf_found;\n\tint pbf_active;\n\tstruct isst_pbf_info pbf_info;\n\tstruct isst_fact_info fact_info;\n};\n\n#define ISST_MAX_TDP_LEVELS\t(4 + 1)  \nstruct isst_pkg_ctdp {\n\tint locked;\n\tint version;\n\tint processed;\n\tint levels;\n\tint current_level;\n\tint enabled;\n\tstruct isst_pkg_ctdp_level_info ctdp_level[ISST_MAX_TDP_LEVELS];\n};\n\nenum isst_platform_param {\n\tISST_PARAM_MBOX_DELAY,\n\tISST_PARAM_MBOX_RETRIES,\n};\n\nstruct isst_platform_ops {\n\tint (*get_disp_freq_multiplier)(void);\n\tint (*get_trl_max_levels)(void);\n\tchar *(*get_trl_level_name)(int level);\n\tvoid (*update_platform_param)(enum isst_platform_param param, int value);\n\tint (*is_punit_valid)(struct isst_id *id);\n\tint (*read_pm_config)(struct isst_id *id, int *cp_state, int *cp_cap);\n\tint (*get_config_levels)(struct isst_id *id, struct isst_pkg_ctdp *pkg_ctdp);\n\tint (*get_ctdp_control)(struct isst_id *id, int config_index, struct isst_pkg_ctdp_level_info *ctdp_level);\n\tint (*get_tdp_info)(struct isst_id *id, int config_index, struct isst_pkg_ctdp_level_info *ctdp_level);\n\tint (*get_pwr_info)(struct isst_id *id, int config_index, struct isst_pkg_ctdp_level_info *ctdp_level);\n\tint (*get_coremask_info)(struct isst_id *id, int config_index, struct isst_pkg_ctdp_level_info *ctdp_level);\n\tint (*get_get_trl)(struct isst_id *id, int level, int avx_level, int *trl);\n\tint (*get_get_trls)(struct isst_id *id, int level, struct isst_pkg_ctdp_level_info *ctdp_level);\n\tint (*get_trl_bucket_info)(struct isst_id *id, int level, unsigned long long *buckets_info);\n\tint (*set_tdp_level)(struct isst_id *id, int tdp_level);\n\tint (*get_pbf_info)(struct isst_id *id, int level, struct isst_pbf_info *pbf_info);\n\tint (*set_pbf_fact_status)(struct isst_id *id, int pbf, int enable);\n\tint (*get_fact_info)(struct isst_id *id, int level, int fact_bucket, struct isst_fact_info *fact_info);\n\tvoid (*adjust_uncore_freq)(struct isst_id *id, int config_index, struct isst_pkg_ctdp_level_info *ctdp_level);\n\tint (*get_clos_information)(struct isst_id *id, int *enable, int *type);\n\tint (*pm_qos_config)(struct isst_id *id, int enable_clos, int priority_type);\n\tint (*pm_get_clos)(struct isst_id *id, int clos, struct isst_clos_config *clos_config);\n\tint (*set_clos)(struct isst_id *id, int clos, struct isst_clos_config *clos_config);\n\tint (*clos_get_assoc_status)(struct isst_id *id, int *clos_id);\n\tint (*clos_associate)(struct isst_id *id, int clos_id);\n};\n\nextern int is_cpu_in_power_domain(int cpu, struct isst_id *id);\nextern int get_topo_max_cpus(void);\nextern int get_cpu_count(struct isst_id *id);\nextern int get_max_punit_core_id(struct isst_id *id);\nextern int api_version(void);\n\n \nFILE *get_output_file(void);\nextern int is_debug_enabled(void);\nextern void debug_printf(const char *format, ...);\nextern int out_format_is_json(void);\nextern void set_isst_id(struct isst_id *id, int cpu);\nextern size_t alloc_cpu_set(cpu_set_t **cpu_set);\nextern void free_cpu_set(cpu_set_t *cpu_set);\nextern int find_phy_core_num(int logical_cpu);\nextern void set_cpu_mask_from_punit_coremask(struct isst_id *id,\n\t\t\t\t\t     unsigned long long core_mask,\n\t\t\t\t\t     size_t core_cpumask_size,\n\t\t\t\t\t     cpu_set_t *core_cpumask,\n\t\t\t\t\t     int *cpu_cnt);\nextern int isst_send_msr_command(unsigned int cpu, unsigned int command,\n\t\t\t\t int write, unsigned long long *req_resp);\n\nextern int isst_set_platform_ops(int api_version);\nextern void isst_update_platform_param(enum isst_platform_param, int vale);\nextern int isst_get_disp_freq_multiplier(void);\nextern int isst_get_trl_max_levels(void);\nextern char *isst_get_trl_level_name(int level);\nextern int isst_is_punit_valid(struct isst_id *id);\n\nextern int isst_get_ctdp_levels(struct isst_id *id, struct isst_pkg_ctdp *pkg_dev);\nextern int isst_get_ctdp_control(struct isst_id *id, int config_index,\n\t\t\t\t struct isst_pkg_ctdp_level_info *ctdp_level);\nextern int isst_get_coremask_info(struct isst_id *id, int config_index,\n\t\t\t   struct isst_pkg_ctdp_level_info *ctdp_level);\nextern void isst_adjust_uncore_freq(struct isst_id *id, int config_index,\n\t\t\t\t\tstruct isst_pkg_ctdp_level_info *ctdp_level);\nextern int isst_get_process_ctdp(struct isst_id *id, int tdp_level,\n\t\t\t\t struct isst_pkg_ctdp *pkg_dev);\nextern void isst_get_process_ctdp_complete(struct isst_id *id,\n\t\t\t\t\t   struct isst_pkg_ctdp *pkg_dev);\nextern void isst_ctdp_display_information(struct isst_id *id, FILE *outf, int tdp_level,\n\t\t\t\t\t  struct isst_pkg_ctdp *pkg_dev);\nextern void isst_ctdp_display_core_info(struct isst_id *id, FILE *outf, char *prefix,\n\t\t\t\t\tunsigned int val, char *str0, char *str1);\nextern void isst_ctdp_display_information_start(FILE *outf);\nextern void isst_ctdp_display_information_end(FILE *outf);\nextern void isst_pbf_display_information(struct isst_id *id, FILE *outf, int level,\n\t\t\t\t\t struct isst_pbf_info *info);\nextern int isst_set_tdp_level(struct isst_id *id, int tdp_level);\nextern int isst_set_pbf_fact_status(struct isst_id *id, int pbf, int enable);\nextern int isst_get_pbf_info(struct isst_id *id, int level,\n\t\t\t     struct isst_pbf_info *pbf_info);\nextern int isst_get_fact_info(struct isst_id *id, int level, int fact_bucket,\n\t\t\t      struct isst_fact_info *fact_info);\nextern void isst_fact_display_information(struct isst_id *id, FILE *outf, int level,\n\t\t\t\t\t  int fact_bucket, int fact_avx,\n\t\t\t\t\t  struct isst_fact_info *fact_info);\nextern int isst_set_trl(struct isst_id *id, unsigned long long trl);\nextern int isst_get_trl(struct isst_id *id, unsigned long long *trl);\nextern int isst_set_trl_from_current_tdp(struct isst_id *id, unsigned long long trl);\nextern int isst_get_config_tdp_lock_status(struct isst_id *id);\n\nextern int isst_pm_qos_config(struct isst_id *id, int enable_clos, int priority_type);\nextern int isst_pm_get_clos(struct isst_id *id, int clos,\n\t\t\t    struct isst_clos_config *clos_config);\nextern int isst_set_clos(struct isst_id *id, int clos,\n\t\t\t struct isst_clos_config *clos_config);\nextern int isst_clos_associate(struct isst_id *id, int clos);\nextern int isst_clos_get_assoc_status(struct isst_id *id, int *clos_id);\nextern void isst_clos_display_information(struct isst_id *id, FILE *outf, int clos,\n\t\t\t\t\t  struct isst_clos_config *clos_config);\nextern void isst_clos_display_assoc_information(struct isst_id *id, FILE *outf, int clos);\n\nextern void isst_display_result(struct isst_id *id, FILE *outf, char *feature, char *cmd,\n\t\t\t\tint result);\n\nextern int isst_clos_get_clos_information(struct isst_id *id, int *enable, int *type);\nextern void isst_clos_display_clos_information(struct isst_id *id, FILE *outf,\n\t\t\t\t\t       int clos_enable, int type,\n\t\t\t\t\t       int state, int cap);\nextern int is_clx_n_platform(void);\nextern int get_cpufreq_base_freq(int cpu);\nextern int isst_read_pm_config(struct isst_id *id, int *cp_state, int *cp_cap);\nextern void isst_display_error_info_message(int error, char *msg, int arg_valid, int arg);\nextern int is_skx_based_platform(void);\nextern int is_spr_platform(void);\nextern int is_emr_platform(void);\nextern int is_icx_platform(void);\nextern void isst_trl_display_information(struct isst_id *id, FILE *outf, unsigned long long trl);\n\nextern void set_cpu_online_offline(int cpu, int state);\nextern void for_each_online_power_domain_in_set(void (*callback)(struct isst_id *, void *, void *,\n\t\t\t\t\t\t\t    void *, void *),\n\t\t\t\t\t   void *arg1, void *arg2, void *arg3,\n\t\t\t\t\t   void *arg4);\nextern int isst_daemon(int debug_mode, int poll_interval, int no_daemon);\nextern void process_level_change(struct isst_id *id);\nextern int hfi_main(void);\nextern void hfi_exit(void);\n\n \nextern struct isst_platform_ops *mbox_get_platform_ops(void);\nextern struct isst_platform_ops *tpmi_get_platform_ops(void);\n\n \nextern int enable_cpuset_controller(void);\nextern int isolate_cpus(struct isst_id *id, int mask_size, cpu_set_t *cpu_mask, int level);\nextern int use_cgroupv2(void);\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}