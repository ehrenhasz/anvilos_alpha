{
  "module_name": "cpupower-info.c",
  "hash_id": "62530a1e5f031881d1d784757571aae73409fa54f23002b25a51621bb57b1005",
  "original_prompt": "Ingested from linux-6.6.14/tools/power/cpupower/utils/cpupower-info.c",
  "human_readable_source": "\n \n\n\n#include <unistd.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <string.h>\n#include <getopt.h>\n#include <sys/utsname.h>\n\n#include \"helpers/helpers.h\"\n#include \"helpers/sysfs.h\"\n\nstatic struct option set_opts[] = {\n     {\"perf-bias\", optional_argument, NULL, 'b'},\n     { },\n};\n\nstatic void print_wrong_arg_exit(void)\n{\n\tprintf(_(\"invalid or unknown argument\\n\"));\n\texit(EXIT_FAILURE);\n}\n\nint cmd_info(int argc, char **argv)\n{\n\textern char *optarg;\n\textern int optind, opterr, optopt;\n\tunsigned int cpu;\n\tstruct utsname uts;\n\n\tunion {\n\t\tstruct {\n\t\t\tint perf_bias:1;\n\t\t};\n\t\tint params;\n\t} params = {};\n\tint ret = 0;\n\n\tret = uname(&uts);\n\tif (!ret && (!strcmp(uts.machine, \"ppc64le\") ||\n\t\t     !strcmp(uts.machine, \"ppc64\"))) {\n\t\tfprintf(stderr, _(\"Subcommand not supported on POWER.\\n\"));\n\t\treturn ret;\n\t}\n\n\tsetlocale(LC_ALL, \"\");\n\ttextdomain(PACKAGE);\n\n\t \n\twhile ((ret = getopt_long(argc, argv, \"b\", set_opts, NULL)) != -1) {\n\t\tswitch (ret) {\n\t\tcase 'b':\n\t\t\tif (params.perf_bias)\n\t\t\t\tprint_wrong_arg_exit();\n\t\t\tparams.perf_bias = 1;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tprint_wrong_arg_exit();\n\t\t}\n\t}\n\n\tif (!params.params)\n\t\tparams.params = 0x7;\n\n\t \n\tif (bitmask_isallclear(cpus_chosen))\n\t\tbitmask_setbit(cpus_chosen, base_cpu);\n\n\t \n\tif (!params.perf_bias)\n\t\treturn ret;\n\n\tif (params.perf_bias) {\n\t\tif (!run_as_root) {\n\t\t\tparams.perf_bias = 0;\n\t\t\tprintf(_(\"Intel's performance bias setting needs root privileges\\n\"));\n\t\t} else if (!(cpupower_cpu_info.caps & CPUPOWER_CAP_PERF_BIAS)) {\n\t\t\tprintf(_(\"System does not support Intel's performance\"\n\t\t\t\t \" bias setting\\n\"));\n\t\t\tparams.perf_bias = 0;\n\t\t}\n\t}\n\n\t \n\tfor (cpu = bitmask_first(cpus_chosen);\n\t     cpu <= bitmask_last(cpus_chosen); cpu++) {\n\n\t\tif (!bitmask_isbitset(cpus_chosen, cpu))\n\t\t\tcontinue;\n\n\t\tprintf(_(\"analyzing CPU %d:\\n\"), cpu);\n\n\t\tif (sysfs_is_cpu_online(cpu) != 1){\n\t\t\tprintf(_(\" *is offline\\n\"));\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (params.perf_bias) {\n\t\t\tret = cpupower_intel_get_perf_bias(cpu);\n\t\t\tif (ret < 0) {\n\t\t\t\tfprintf(stderr,\n\t\t\t_(\"Could not read perf-bias value[%d]\\n\"), ret);\n\t\t\t\texit(EXIT_FAILURE);\n\t\t\t} else\n\t\t\t\tprintf(_(\"perf-bias: %d\\n\"), ret);\n\t\t}\n\t}\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}