{
  "module_name": "powernow-k8-decode.c",
  "hash_id": "f39ea58691f1e01a0fa544cc973bfa9c45af34afa1336c46f0b2e3144a3b23a4",
  "original_prompt": "Ingested from linux-6.6.14/tools/power/cpupower/debug/i386/powernow-k8-decode.c",
  "human_readable_source": "\n \n\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <unistd.h>\n#include <errno.h>\n#include <fcntl.h>\n\n#include <sys/types.h>\n#include <sys/stat.h>\n\n#define MCPU 32\n\n#define MSR_FIDVID_STATUS\t0xc0010042\n\n#define MSR_S_HI_CURRENT_VID\t0x0000001f\n#define MSR_S_LO_CURRENT_FID\t0x0000003f\n\nstatic int get_fidvid(uint32_t cpu, uint32_t *fid, uint32_t *vid)\n{\n\tint err = 1;\n\tuint64_t msr = 0;\n\tint fd;\n\tchar file[20];\n\n\tif (cpu > MCPU)\n\t\tgoto out;\n\n\tsprintf(file, \"/dev/cpu/%d/msr\", cpu);\n\n\tfd = open(file, O_RDONLY);\n\tif (fd < 0)\n\t\tgoto out;\n\tlseek(fd, MSR_FIDVID_STATUS, SEEK_CUR);\n\tif (read(fd, &msr, 8) != 8)\n\t\tgoto err1;\n\n\t*fid = ((uint32_t )(msr & 0xffffffffull)) & MSR_S_LO_CURRENT_FID;\n\t*vid = ((uint32_t )(msr>>32 & 0xffffffffull)) & MSR_S_HI_CURRENT_VID;\n\terr = 0;\nerr1:\n\tclose(fd);\nout:\n\treturn err;\n}\n\n\n \nstatic uint32_t find_freq_from_fid(uint32_t fid)\n{\n\treturn 800 + (fid * 100);\n}\n\n \nstatic uint32_t find_millivolts_from_vid(uint32_t vid)\n{\n\treturn 1550-vid*25;\n}\n\nint main (int argc, char *argv[])\n{\n\tint err;\n\tint cpu;\n\tuint32_t fid, vid;\n\n\tif (argc < 2)\n\t\tcpu = 0;\n\telse\n\t\tcpu = strtoul(argv[1], NULL, 0);\n\n\terr = get_fidvid(cpu, &fid, &vid);\n\n\tif (err) {\n\t\tprintf(\"can't get fid, vid from MSR\\n\");\n\t\tprintf(\"Possible trouble: you don't run a powernow-k8 capable cpu\\n\");\n\t\tprintf(\"or you are not root, or the msr driver is not present\\n\");\n\t\texit(1);\n\t}\n\n\t\n\tprintf(\"cpu %d currently at %d MHz and %d mV\\n\",\n\t\t\tcpu,\n\t\t\tfind_freq_from_fid(fid),\n\t\t\tfind_millivolts_from_vid(vid));\n\t\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}