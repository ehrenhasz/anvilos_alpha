{
  "module_name": "centrino-decode.c",
  "hash_id": "d988db252eb6afea40c0b8b99269e08aba06f359cc6f56deb739ba7a48adcbf0",
  "original_prompt": "Ingested from linux-6.6.14/tools/power/cpupower/debug/i386/centrino-decode.c",
  "human_readable_source": "\n \n\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <unistd.h>\n#include <errno.h>\n#include <fcntl.h>\n\n#include <sys/types.h>\n#include <sys/stat.h>\n\n#define MCPU\t32\n\n#define MSR_IA32_PERF_STATUS\t0x198\n\nstatic int rdmsr(unsigned int cpu, unsigned int msr,\n\t\t unsigned int *lo, unsigned int *hi)\n{\n\tint fd;\n\tchar file[20];\n\tunsigned long long val;\n\tint retval = -1;\n\n\t*lo = *hi = 0;\n\n\tif (cpu > MCPU)\n\t\tgoto err1;\n\n\tsprintf(file, \"/dev/cpu/%d/msr\", cpu);\n\tfd = open(file, O_RDONLY);\n\n\tif (fd < 0)\n\t\tgoto err1;\n\n\tif (lseek(fd, msr, SEEK_CUR) == -1)\n\t\tgoto err2;\n\n\tif (read(fd, &val, 8) != 8)\n\t\tgoto err2;\n\n\t*lo = (uint32_t )(val & 0xffffffffull);\n\t*hi = (uint32_t )(val>>32 & 0xffffffffull);\n\n\tretval = 0;\nerr2:\n\tclose(fd);\nerr1:\n\treturn retval;\n}\n\nstatic void decode (unsigned int msr)\n{\n\tunsigned int multiplier;\n\tunsigned int mv;\n\n\tmultiplier = ((msr >> 8) & 0xFF);\n\n\tmv = (((msr & 0xFF) * 16) + 700);\n\n\tprintf(\"0x%x means multiplier %d @ %d mV\\n\", msr, multiplier, mv);\n}\n\nstatic int decode_live(unsigned int cpu)\n{\n\tunsigned int lo, hi;\n\tint err;\n\n\terr = rdmsr(cpu, MSR_IA32_PERF_STATUS, &lo, &hi);\n\n\tif (err) {\n\t\tprintf(\"can't get MSR_IA32_PERF_STATUS for cpu %d\\n\", cpu);\n\t\tprintf(\"Possible trouble: you don't run an Enhanced SpeedStep capable cpu\\n\");\n\t\tprintf(\"or you are not root, or the msr driver is not present\\n\");\n\t\treturn 1;\n\t}\n\n\tdecode(lo);\n\n\treturn 0;\n}\n\nint main (int argc, char **argv)\n{\n\tunsigned int cpu, mode = 0;\n\n\tif (argc < 2)\n\t\tcpu = 0;\n\telse {\n\t\tcpu = strtoul(argv[1], NULL, 0);\n\t\tif (cpu >= MCPU)\n\t\t\tmode = 1;\n\t}\n\n\tif (mode)\n\t\tdecode(cpu);\n\telse\n\t\tdecode_live(cpu);\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}