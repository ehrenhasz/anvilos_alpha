{
  "module_name": "cpufreq-test_tsc.c",
  "hash_id": "8a0e8a87efa96a8b165c634d952405a7e02af3e233976ed37314b9244c37b794",
  "original_prompt": "Ingested from linux-6.6.14/tools/power/cpupower/debug/kernel/cpufreq-test_tsc.c",
  "human_readable_source": "\n \n\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/init.h>\n#include <linux/delay.h>\n#include <linux/acpi.h>\n#include <asm/io.h>\n\nstatic int pm_tmr_ioport = 0;\n\n \nstatic u32 read_pmtmr(void)\n{\n\tu32 v1=0,v2=0,v3=0;\n\t \n\tdo {\n\t\tv1 = inl(pm_tmr_ioport);\n\t\tv2 = inl(pm_tmr_ioport);\n\t\tv3 = inl(pm_tmr_ioport);\n\t} while ((v1 > v2 && v1 < v3) || (v2 > v3 && v2 < v1)\n\t\t || (v3 > v1 && v3 < v2));\n\n\t \n\treturn (v2 & 0xFFFFFF);\n}\n\nstatic int __init cpufreq_test_tsc(void)\n{\n\tu32 now, then, diff;\n\tu64 now_tsc, then_tsc, diff_tsc;\n\tint i;\n\n\t \n\n\t \n\tif (acpi_gbl_FADT.header.revision >= FADT2_REVISION_ID) {\n\t\t \n\t\tif (acpi_gbl_FADT.xpm_timer_block.space_id !=\n\t\t    ACPI_ADR_SPACE_SYSTEM_IO)\n\t\t\treturn 0;\n\n\t\tpm_tmr_ioport = acpi_gbl_FADT.xpm_timer_block.address;\n\t\t \n\t\tif (!pm_tmr_ioport)\n\t\t\tpm_tmr_ioport = acpi_gbl_FADT.pm_timer_block;\n\t} else {\n\t\t \n\t\tpm_tmr_ioport = acpi_gbl_FADT.pm_timer_block;\n\t}\n\n\tprintk(KERN_DEBUG \"start--> \\n\");\n\tthen = read_pmtmr();\n\tthen_tsc = rdtsc();\n\tfor (i=0;i<20;i++) {\n\t\tmdelay(100);\n\t\tnow = read_pmtmr();\n\t\tnow_tsc = rdtsc();\n\t\tdiff = (now - then) & 0xFFFFFF;\n\t\tdiff_tsc = now_tsc - then_tsc;\n\t\tprintk(KERN_DEBUG \"t1: %08u t2: %08u diff_pmtmr: %08u diff_tsc: %016llu\\n\", then, now, diff, diff_tsc);\n\t\tthen = now;\n\t\tthen_tsc = now_tsc;\n\t}\n\tprintk(KERN_DEBUG \"<-- end \\n\");\n\treturn -ENODEV;\n}\n\nstatic void __exit cpufreq_none(void)\n{\n\treturn;\n}\n\nmodule_init(cpufreq_test_tsc)\nmodule_exit(cpufreq_none)\n\n\nMODULE_AUTHOR(\"Dominik Brodowski\");\nMODULE_DESCRIPTION(\"Verify the TSC cpufreq notifier working correctly -- needs ACPI-enabled system\");\nMODULE_LICENSE (\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}