{
  "module_name": "cpufreq-bench_script.sh",
  "hash_id": "52e7a44e1c53ce3958cfc115b6772669f597d346311005db5302dd8c13f8a96c",
  "original_prompt": "Ingested from linux-6.6.14/tools/power/cpupower/bench/cpufreq-bench_script.sh",
  "human_readable_source": "#!/bin/bash\n# SPDX-License-Identifier: GPL-2.0-or-later\n\n\n# Author/Copyright(c): 2009, Thomas Renninger <trenn@suse.de>, Novell Inc.\n\n# Ondemand up_threshold and sampling rate test script for cpufreq-bench\n# mircobenchmark.\n# Modify the general variables at the top or extend or copy out parts\n# if you want to test other things\n#\n\n# Default with latest kernels is 95, before micro account patches\n# it was 80, cmp. with git commit 808009131046b62ac434dbc796\nUP_THRESHOLD=\"60 80 95\"\n# Depending on the kernel and the HW sampling rate could be restricted\n# and cannot be set that low...\n# E.g. before git commit cef9615a853ebc4972084f7 one could only set\n# min sampling rate of 80000 if CONFIG_HZ=250\nSAMPLING_RATE=\"20000 80000\"\n\nfunction measure()\n{\n    local -i up_threshold_set\n    local -i sampling_rate_set\n\n    for up_threshold in $UP_THRESHOLD;do\n\tfor sampling_rate in $SAMPLING_RATE;do\n\t    # Set values in sysfs\n\t    echo $up_threshold >/sys/devices/system/cpu/cpu0/cpufreq/ondemand/up_threshold\n\t    echo $sampling_rate >/sys/devices/system/cpu/cpu0/cpufreq/ondemand/sampling_rate\n\t    up_threshold_set=$(cat /sys/devices/system/cpu/cpu0/cpufreq/ondemand/up_threshold)\n\t    sampling_rate_set=$(cat /sys/devices/system/cpu/cpu0/cpufreq/ondemand/sampling_rate)\n\n\t    # Verify set values in sysfs\n\t    if [ ${up_threshold_set} -eq ${up_threshold} ];then\n\t\techo \"up_threshold: $up_threshold, set in sysfs: ${up_threshold_set}\"\n\t    else\n\t\techo \"WARNING: Tried to set up_threshold: $up_threshold, set in sysfs: ${up_threshold_set}\"\n\t    fi\n\t    if [ ${sampling_rate_set} -eq ${sampling_rate} ];then\n\t\techo \"sampling_rate: $sampling_rate, set in sysfs: ${sampling_rate_set}\"\n\t    else\n\t\techo \"WARNING: Tried to set sampling_rate: $sampling_rate, set in sysfs: ${sampling_rate_set}\"\n\t    fi\n\n\t    # Benchmark\n\t    cpufreq-bench -o /var/log/cpufreq-bench/up_threshold_${up_threshold}_sampling_rate_${sampling_rate}\n\tdone\n    done\n}\n\nfunction create_plots()\n{\n    local command\n\n    for up_threshold in $UP_THRESHOLD;do\n\tcommand=\"cpufreq-bench_plot.sh -o \\\"sampling_rate_${SAMPLING_RATE}_up_threshold_${up_threshold}\\\" -t \\\"Ondemand sampling_rate: ${SAMPLING_RATE} comparison - Up_threshold: $up_threshold %\\\"\"\n\tfor sampling_rate in $SAMPLING_RATE;do\n\t    command=\"${command} /var/log/cpufreq-bench/up_threshold_${up_threshold}_sampling_rate_${sampling_rate}/* \\\"sampling_rate = $sampling_rate\\\"\"\n\tdone\n\techo $command\n\teval \"$command\"\n\techo\n    done\n\n    for sampling_rate in $SAMPLING_RATE;do\n\tcommand=\"cpufreq-bench_plot.sh -o \\\"up_threshold_${UP_THRESHOLD}_sampling_rate_${sampling_rate}\\\" -t \\\"Ondemand up_threshold: ${UP_THRESHOLD} % comparison - sampling_rate: $sampling_rate\\\"\"\n\tfor up_threshold in $UP_THRESHOLD;do\n\t    command=\"${command} /var/log/cpufreq-bench/up_threshold_${up_threshold}_sampling_rate_${sampling_rate}/* \\\"up_threshold = $up_threshold\\\"\"\n\tdone\n\techo $command\n\teval \"$command\"\n\techo\n    done\n\n    command=\"cpufreq-bench_plot.sh -o \\\"up_threshold_${UP_THRESHOLD}_sampling_rate_${SAMPLING_RATE}\\\" -t \\\"Ondemand up_threshold: ${UP_THRESHOLD} and sampling_rate ${SAMPLING_RATE} comparison\\\"\"\n    for sampling_rate in $SAMPLING_RATE;do\n\tfor up_threshold in $UP_THRESHOLD;do\n\t    command=\"${command} /var/log/cpufreq-bench/up_threshold_${up_threshold}_sampling_rate_${sampling_rate}/* \\\"up_threshold = $up_threshold - sampling_rate = $sampling_rate\\\"\"\n\tdone\n    done\n    echo \"$command\"\n    eval \"$command\"\n}\n\nmeasure\ncreate_plots\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}