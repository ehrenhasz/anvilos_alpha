{
  "module_name": "main.c",
  "hash_id": "b4ec73355153d82e4afcb6835ec90c7955dd22cdce4d298c472fbd64c94b84db",
  "original_prompt": "Ingested from linux-6.6.14/tools/power/cpupower/bench/main.c",
  "human_readable_source": "\n \n\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <unistd.h>\n#include <getopt.h>\n#include <errno.h>\n\n#include \"config.h\"\n#include \"system.h\"\n#include \"benchmark.h\"\n\nstatic struct option long_options[] = {\n\t{\"output\",\t1,\t0,\t'o'},\n\t{\"sleep\",\t1,\t0,\t's'},\n\t{\"load\",\t1,\t0,\t'l'},\n\t{\"verbose\",\t0,\t0,\t'v'},\n\t{\"cpu\",\t\t1,\t0,\t'c'},\n\t{\"governor\",\t1,\t0,\t'g'},\n\t{\"prio\",\t1,\t0,\t'p'},\n\t{\"file\",\t1,\t0,\t'f'},\n\t{\"cycles\",\t1,\t0,\t'n'},\n\t{\"rounds\",\t1,\t0,\t'r'},\n\t{\"load-step\",\t1,\t0,\t'x'},\n\t{\"sleep-step\",\t1,\t0,\t'y'},\n\t{\"help\",\t0,\t0,\t'h'},\n\t{0, 0, 0, 0}\n};\n\n \n\nvoid usage()\n{\n\tprintf(\"usage: ./bench\\n\");\n\tprintf(\"Options:\\n\");\n\tprintf(\" -l, --load=<long int>\\t\\tinitial load time in us\\n\");\n\tprintf(\" -s, --sleep=<long int>\\t\\tinitial sleep time in us\\n\");\n\tprintf(\" -x, --load-step=<long int>\\ttime to be added to load time, in us\\n\");\n\tprintf(\" -y, --sleep-step=<long int>\\ttime to be added to sleep time, in us\\n\");\n\tprintf(\" -c, --cpu=<cpu #>\\t\\t\\tCPU Nr. to use, starting at 0\\n\");\n\tprintf(\" -p, --prio=<priority>\\t\\t\\tscheduler priority, HIGH, LOW or DEFAULT\\n\");\n\tprintf(\" -g, --governor=<governor>\\t\\tcpufreq governor to test\\n\");\n\tprintf(\" -n, --cycles=<int>\\t\\t\\tload/sleep cycles\\n\");\n\tprintf(\" -r, --rounds<int>\\t\\t\\tload/sleep rounds\\n\");\n\tprintf(\" -f, --file=<configfile>\\t\\tconfig file to use\\n\");\n\tprintf(\" -o, --output=<dir>\\t\\t\\toutput path. Filename will be OUTPUTPATH/benchmark_TIMESTAMP.log\\n\");\n\tprintf(\" -v, --verbose\\t\\t\\t\\tverbose output on/off\\n\");\n\tprintf(\" -h, --help\\t\\t\\t\\tPrint this help screen\\n\");\n\texit(1);\n}\n\n \n\nint main(int argc, char **argv)\n{\n\tint c;\n\tint option_index = 0;\n\tstruct config *config = NULL;\n\n\tconfig = prepare_default_config();\n\n\tif (config == NULL)\n\t\treturn EXIT_FAILURE;\n\n\twhile (1) {\n\t\tc = getopt_long (argc, argv, \"hg:o:s:l:vc:p:f:n:r:x:y:\",\n\t\t\t\tlong_options, &option_index);\n\t\tif (c == -1)\n\t\t\tbreak;\n\n\t\tswitch (c) {\n\t\tcase 'o':\n\t\t\tif (config->output != NULL)\n\t\t\t\tfclose(config->output);\n\n\t\t\tconfig->output = prepare_output(optarg);\n\n\t\t\tif (config->output == NULL)\n\t\t\t\treturn EXIT_FAILURE;\n\n\t\t\tdprintf(\"user output path -> %s\\n\", optarg);\n\t\t\tbreak;\n\t\tcase 's':\n\t\t\tsscanf(optarg, \"%li\", &config->sleep);\n\t\t\tdprintf(\"user sleep time -> %s\\n\", optarg);\n\t\t\tbreak;\n\t\tcase 'l':\n\t\t\tsscanf(optarg, \"%li\", &config->load);\n\t\t\tdprintf(\"user load time -> %s\\n\", optarg);\n\t\t\tbreak;\n\t\tcase 'c':\n\t\t\tsscanf(optarg, \"%u\", &config->cpu);\n\t\t\tdprintf(\"user cpu -> %s\\n\", optarg);\n\t\t\tbreak;\n\t\tcase 'g':\n\t\t\tstrncpy(config->governor, optarg, 14);\n\t\t\tdprintf(\"user governor -> %s\\n\", optarg);\n\t\t\tbreak;\n\t\tcase 'p':\n\t\t\tif (string_to_prio(optarg) != SCHED_ERR) {\n\t\t\t\tconfig->prio = string_to_prio(optarg);\n\t\t\t\tdprintf(\"user prio -> %s\\n\", optarg);\n\t\t\t} else {\n\t\t\t\tif (config != NULL) {\n\t\t\t\t\tif (config->output != NULL)\n\t\t\t\t\t\tfclose(config->output);\n\t\t\t\t\tfree(config);\n\t\t\t\t}\n\t\t\t\tusage();\n\t\t\t}\n\t\t\tbreak;\n\t\tcase 'n':\n\t\t\tsscanf(optarg, \"%u\", &config->cycles);\n\t\t\tdprintf(\"user cycles -> %s\\n\", optarg);\n\t\t\tbreak;\n\t\tcase 'r':\n\t\t\tsscanf(optarg, \"%u\", &config->rounds);\n\t\t\tdprintf(\"user rounds -> %s\\n\", optarg);\n\t\t\tbreak;\n\t\tcase 'x':\n\t\t\tsscanf(optarg, \"%li\", &config->load_step);\n\t\t\tdprintf(\"user load_step -> %s\\n\", optarg);\n\t\t\tbreak;\n\t\tcase 'y':\n\t\t\tsscanf(optarg, \"%li\", &config->sleep_step);\n\t\t\tdprintf(\"user sleep_step -> %s\\n\", optarg);\n\t\t\tbreak;\n\t\tcase 'f':\n\t\t\tif (prepare_config(optarg, config))\n\t\t\t\treturn EXIT_FAILURE;\n\t\t\tbreak;\n\t\tcase 'v':\n\t\t\tconfig->verbose = 1;\n\t\t\tdprintf(\"verbose output enabled\\n\");\n\t\t\tbreak;\n\t\tcase 'h':\n\t\tcase '?':\n\t\tdefault:\n\t\t\tif (config != NULL) {\n\t\t\t\tif (config->output != NULL)\n\t\t\t\t\tfclose(config->output);\n\t\t\t\tfree(config);\n\t\t\t}\n\t\t\tusage();\n\t\t}\n\t}\n\n\tif (config->verbose) {\n\t\tprintf(\"starting benchmark with parameters:\\n\");\n\t\tprintf(\"config:\\n\\t\"\n\t\t       \"sleep=%li\\n\\t\"\n\t\t       \"load=%li\\n\\t\"\n\t\t       \"sleep_step=%li\\n\\t\"\n\t\t       \"load_step=%li\\n\\t\"\n\t\t       \"cpu=%u\\n\\t\"\n\t\t       \"cycles=%u\\n\\t\"\n\t\t       \"rounds=%u\\n\\t\"\n\t\t       \"governor=%s\\n\\n\",\n\t\t       config->sleep,\n\t\t       config->load,\n\t\t       config->sleep_step,\n\t\t       config->load_step,\n\t\t       config->cpu,\n\t\t       config->cycles,\n\t\t       config->rounds,\n\t\t       config->governor);\n\t}\n\n\tprepare_user(config);\n\tprepare_system(config);\n\tstart_benchmark(config);\n\n\tif (config->output != stdout)\n\t\tfclose(config->output);\n\n\tfree(config);\n\n\treturn EXIT_SUCCESS;\n}\n\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}