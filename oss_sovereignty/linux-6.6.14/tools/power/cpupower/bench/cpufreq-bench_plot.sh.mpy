{
  "module_name": "cpufreq-bench_plot.sh",
  "hash_id": "710f646509c1677af35135a563f1599bc1e60b0eec48939cdefe10ae5b563ee5",
  "original_prompt": "Ingested from linux-6.6.14/tools/power/cpupower/bench/cpufreq-bench_plot.sh",
  "human_readable_source": "#!/bin/bash\n# SPDX-License-Identifier: GPL-2.0-or-later\n\n\n# Author/Copyright(c): 2009, Thomas Renninger <trenn@suse.de>, Novell Inc.\n\n# Helper script to easily create nice plots of your cpufreq-bench results\n\ndir=`mktemp -d`\noutput_file=\"cpufreq-bench.png\"\nglobal_title=\"cpufreq-bench plot\"\npicture_type=\"jpeg\"\nfile[0]=\"\"\n\nfunction usage()\n{\n    echo \"cpufreq-bench_plot.sh [OPTIONS] logfile [measure_title] [logfile [measure_title]] ...]\"\n    echo\n    echo \"Options\"\n    echo \"   -o output_file\"\n    echo \"   -t global_title\"\n    echo \"   -p picture_type [jpeg|gif|png|postscript|...]\"\n    exit 1\n}\n\nif [ $# -eq 0 ];then\n\techo \"No benchmark results file provided\"\n\techo\n\tusage\nfi\n\nwhile getopts o:t:p: name ; do\n    case $name in\n\to)\n\t    output_file=\"$OPTARG\".$picture_type\n\t    ;;\n\tt)\n\t    global_title=\"$OPTARG\"\n\t    ;;\n\tp)\n\t    picture_type=\"$OPTARG\"\n\t    ;;\n        ?)\n\t    usage\n\t    ;;\n    esac\ndone\nshift $(($OPTIND -1))\n\nplots=0\nwhile [ \"$1\" ];do\n    if [ ! -f \"$1\" ];then\n\techo \"File $1 does not exist\"\n\tusage\n    fi\n    file[$plots]=\"$1\"\n    title[$plots]=\"$2\"\n    # echo \"File: ${file[$plots]} - ${title[plots]}\"\n    shift;shift\n    plots=$((plots + 1))\ndone\n\necho \"set terminal $picture_type\"\t>> $dir/plot_script.gpl\necho \"set output \\\"$output_file\\\"\"\t>> $dir/plot_script.gpl\necho \"set title \\\"$global_title\\\"\"\t>> $dir/plot_script.gpl\necho \"set xlabel \\\"sleep/load time\\\"\"\t>> $dir/plot_script.gpl\necho \"set ylabel \\\"Performance (%)\\\"\"\t>> $dir/plot_script.gpl\n\nfor((plot=0;plot<$plots;plot++));do\n\n    # Sanity check\n    ###### I am to dump to get this redirected to stderr/stdout in one awk call... #####\n    cat ${file[$plot]} |grep -v \"^#\" |awk '{if ($2 != $3) printf(\"Error in measure %d:Load time %s does not equal sleep time %s, plot will not be correct\\n\", $1, $2, $3); ERR=1}'\n    ###### I am to dump to get this redirected in one awk call... #####\n\n    # Parse out load time (which must be equal to sleep time for a plot), divide it by 1000\n    # to get ms and parse out the performance in percentage and write it to a temp file for plotting\n    cat ${file[$plot]} |grep -v \"^#\" |awk '{printf \"%lu %.1f\\n\",$2/1000, $6}' >$dir/data_$plot\n\n    if [ $plot -eq 0 ];then\n\techo -n \"plot \" >> $dir/plot_script.gpl\n    fi\n    echo -n \"\\\"$dir/data_$plot\\\" title \\\"${title[$plot]}\\\" with lines\" >> $dir/plot_script.gpl\n    if [ $(($plot + 1)) -ne $plots ];then\n\techo -n \", \" >> $dir/plot_script.gpl\n    fi\ndone\necho >> $dir/plot_script.gpl\n\ngnuplot $dir/plot_script.gpl\nrm -r $dir\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}