{
  "module_name": "usbip.c",
  "hash_id": "37b9ce0ef7b144aff9bbee500ed55703347fe29026f47c06e05bda7b2356c3e4",
  "original_prompt": "Ingested from linux-6.6.14/tools/usb/usbip/src/usbip.c",
  "human_readable_source": "\n \n\n#include <stdio.h>\n#include <stdlib.h>\n\n#include <getopt.h>\n#include <syslog.h>\n\n#include \"usbip_common.h\"\n#include \"usbip_network.h\"\n#include \"usbip.h\"\n\nstatic int usbip_help(int argc, char *argv[]);\nstatic int usbip_version(int argc, char *argv[]);\n\nstatic const char usbip_version_string[] = PACKAGE_STRING;\n\nstatic const char usbip_usage_string[] =\n\t\"usbip [--debug] [--log] [--tcp-port PORT] [version]\\n\"\n\t\"             [help] <command> <args>\\n\";\n\nstatic void usbip_usage(void)\n{\n\tprintf(\"usage: %s\", usbip_usage_string);\n}\n\nstruct command {\n\tconst char *name;\n\tint (*fn)(int argc, char *argv[]);\n\tconst char *help;\n\tvoid (*usage)(void);\n};\n\nstatic const struct command cmds[] = {\n\t{\n\t\t.name  = \"help\",\n\t\t.fn    = usbip_help,\n\t\t.help  = NULL,\n\t\t.usage = NULL\n\t},\n\t{\n\t\t.name  = \"version\",\n\t\t.fn    = usbip_version,\n\t\t.help  = NULL,\n\t\t.usage = NULL\n\t},\n\t{\n\t\t.name  = \"attach\",\n\t\t.fn    = usbip_attach,\n\t\t.help  = \"Attach a remote USB device\",\n\t\t.usage = usbip_attach_usage\n\t},\n\t{\n\t\t.name  = \"detach\",\n\t\t.fn    = usbip_detach,\n\t\t.help  = \"Detach a remote USB device\",\n\t\t.usage = usbip_detach_usage\n\t},\n\t{\n\t\t.name  = \"list\",\n\t\t.fn    = usbip_list,\n\t\t.help  = \"List exportable or local USB devices\",\n\t\t.usage = usbip_list_usage\n\t},\n\t{\n\t\t.name  = \"bind\",\n\t\t.fn    = usbip_bind,\n\t\t.help  = \"Bind device to \" USBIP_HOST_DRV_NAME \".ko\",\n\t\t.usage = usbip_bind_usage\n\t},\n\t{\n\t\t.name  = \"unbind\",\n\t\t.fn    = usbip_unbind,\n\t\t.help  = \"Unbind device from \" USBIP_HOST_DRV_NAME \".ko\",\n\t\t.usage = usbip_unbind_usage\n\t},\n\t{\n\t\t.name  = \"port\",\n\t\t.fn    = usbip_port_show,\n\t\t.help  = \"Show imported USB devices\",\n\t\t.usage = NULL\n\t},\n\t{ NULL, NULL, NULL, NULL }\n};\n\nstatic int usbip_help(int argc, char *argv[])\n{\n\tconst struct command *cmd;\n\tint i;\n\tint ret = 0;\n\n\tif (argc > 1 && argv++) {\n\t\tfor (i = 0; cmds[i].name != NULL; i++)\n\t\t\tif (!strcmp(cmds[i].name, argv[0]) && cmds[i].usage) {\n\t\t\t\tcmds[i].usage();\n\t\t\t\tgoto done;\n\t\t\t}\n\t\tret = -1;\n\t}\n\n\tusbip_usage();\n\tprintf(\"\\n\");\n\tfor (cmd = cmds; cmd->name != NULL; cmd++)\n\t\tif (cmd->help != NULL)\n\t\t\tprintf(\"  %-10s %s\\n\", cmd->name, cmd->help);\n\tprintf(\"\\n\");\ndone:\n\treturn ret;\n}\n\nstatic int usbip_version(int argc, char *argv[])\n{\n\t(void) argc;\n\t(void) argv;\n\n\tprintf(PROGNAME \" (%s)\\n\", usbip_version_string);\n\treturn 0;\n}\n\nstatic int run_command(const struct command *cmd, int argc, char *argv[])\n{\n\tdbg(\"running command: `%s'\", cmd->name);\n\treturn cmd->fn(argc, argv);\n}\n\nint main(int argc, char *argv[])\n{\n\tstatic const struct option opts[] = {\n\t\t{ \"debug\",    no_argument,       NULL, 'd' },\n\t\t{ \"log\",      no_argument,       NULL, 'l' },\n\t\t{ \"tcp-port\", required_argument, NULL, 't' },\n\t\t{ NULL,       0,                 NULL,  0  }\n\t};\n\n\tchar *cmd;\n\tint opt;\n\tint i, rc = -1;\n\n\tusbip_use_stderr = 1;\n\topterr = 0;\n\tfor (;;) {\n\t\topt = getopt_long(argc, argv, \"+dlt:\", opts, NULL);\n\n\t\tif (opt == -1)\n\t\t\tbreak;\n\n\t\tswitch (opt) {\n\t\tcase 'd':\n\t\t\tusbip_use_debug = 1;\n\t\t\tbreak;\n\t\tcase 'l':\n\t\t\tusbip_use_syslog = 1;\n\t\t\topenlog(\"\", LOG_PID, LOG_USER);\n\t\t\tbreak;\n\t\tcase 't':\n\t\t\tusbip_setup_port_number(optarg);\n\t\t\tbreak;\n\t\tcase '?':\n\t\t\tprintf(\"usbip: invalid option\\n\");\n\t\t\t \n\t\t\t \n\t\tdefault:\n\t\t\tusbip_usage();\n\t\t\tgoto out;\n\t\t}\n\t}\n\n\tcmd = argv[optind];\n\tif (cmd) {\n\t\tfor (i = 0; cmds[i].name != NULL; i++)\n\t\t\tif (!strcmp(cmds[i].name, cmd)) {\n\t\t\t\targc -= optind;\n\t\t\t\targv += optind;\n\t\t\t\toptind = 0;\n\t\t\t\trc = run_command(&cmds[i], argc, argv);\n\t\t\t\tgoto out;\n\t\t\t}\n\t}\n\n\t \n\tusbip_help(0, NULL);\nout:\n\treturn (rc > -1 ? EXIT_SUCCESS : EXIT_FAILURE);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}