{
  "module_name": "runlitmus.sh",
  "hash_id": "74d921e35d03e0907d1b21a4e34a97dcb2cb4748d16f4578c59653ca37c81950",
  "original_prompt": "Ingested from linux-6.6.14/tools/memory-model/scripts/runlitmus.sh",
  "human_readable_source": "#!/bin/sh\n# SPDX-License-Identifier: GPL-2.0+\n#\n# Without the -hw argument, runs a herd7 test and outputs verification\n# results to a file whose name is that of the specified litmus test,\n# but with \".out\" appended.\n#\n# If the --hw argument is specified, this script translates the .litmus\n# C-language file to the specified type of assembly and verifies that.\n# But in this case, litmus tests using complex synchronization (such as\n# locking, RCU, and SRCU) are cheerfully ignored.\n#\n# Either way, return the status of the herd7 command.\n#\n# Usage:\n#\trunlitmus.sh file.litmus\n#\n# Run this in the directory containing the memory model, specifying the\n# pathname of the litmus test to check.  The caller is expected to have\n# properly set up the LKMM environment variables.\n#\n# Copyright IBM Corporation, 2019\n#\n# Author: Paul E. McKenney <paulmck@linux.ibm.com>\n\nlitmus=$1\nif test -f \"$litmus\" -a -r \"$litmus\"\nthen\n\t:\nelse\n\techo ' !!! ' error: \\\"$litmus\\\" is not a readable file\n\texit 255\nfi\n\nif test -z \"$LKMM_HW_MAP_FILE\" -o ! -e $LKMM_DESTDIR/$litmus.out\nthen\n\t# LKMM run\n\therdoptions=${LKMM_HERD_OPTIONS--conf linux-kernel.cfg}\n\techo Herd options: $herdoptions > $LKMM_DESTDIR/$litmus.out\n\t/usr/bin/time $LKMM_TIMEOUT_CMD herd7 $herdoptions $litmus >> $LKMM_DESTDIR/$litmus.out 2>&1\n\tret=$?\n\tif test -z \"$LKMM_HW_MAP_FILE\"\n\tthen\n\t\texit $ret\n\tfi\n\techo \" --- \" Automatically generated LKMM output for '\"'--hw $LKMM_HW_MAP_FILE'\"' run\nfi\n\n# Hardware run\n\nT=/tmp/checklitmushw.sh.$$\ntrap 'rm -rf $T' 0 2\nmkdir $T\n\n# Generate filenames\nmapfile=\"Linux2${LKMM_HW_MAP_FILE}.map\"\nthemefile=\"$T/${LKMM_HW_MAP_FILE}.theme\"\nherdoptions=\"-model $LKMM_HW_CAT_FILE\"\nhwlitmus=`echo $litmus | sed -e 's/\\.litmus$/.litmus.'${LKMM_HW_MAP_FILE}'/'`\nhwlitmusfile=`echo $hwlitmus | sed -e 's,^.*/,,'`\n\n# Don't run on litmus tests with complex synchronization\nif ! scripts/simpletest.sh $litmus\nthen\n\techo ' --- ' error: \\\"$litmus\\\" contains locking, RCU, or SRCU\n\texit 254\nfi\n\n# Generate the assembly code and run herd7 on it.\ngen_theme7 -n 10 -map $mapfile -call Linux.call > $themefile\njingle7 -v -theme $themefile $litmus > $LKMM_DESTDIR/$hwlitmus 2> $T/$hwlitmusfile.jingle7.out\nif grep -q \"Generated 0 tests\" $T/$hwlitmusfile.jingle7.out\nthen\n\techo ' !!! ' jingle7 failed, errors in $hwlitmus.err\n\tcp $T/$hwlitmusfile.jingle7.out $LKMM_DESTDIR/$hwlitmus.err\n\texit 253\nfi\n/usr/bin/time $LKMM_TIMEOUT_CMD herd7 -unroll 0 $LKMM_DESTDIR/$hwlitmus > $LKMM_DESTDIR/$hwlitmus.out 2>&1\n\nexit $?\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}