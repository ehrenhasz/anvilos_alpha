{
  "module_name": "cmplitmushist.sh",
  "hash_id": "9eec8287215d86a58d9aad147b2570c38b11a5213c3b935b422edfdb668af8d9",
  "original_prompt": "Ingested from linux-6.6.14/tools/memory-model/scripts/cmplitmushist.sh",
  "human_readable_source": "#!/bin/sh\n# SPDX-License-Identifier: GPL-2.0+\n#\n# Compares .out and .out.new files for each name on standard input,\n# one full pathname per line.  Outputs comparison results followed by\n# a summary.\n#\n# sh cmplitmushist.sh\n\nT=/tmp/cmplitmushist.sh.$$\ntrap 'rm -rf $T' 0\nmkdir $T\n\n# comparetest oldpath newpath\nbadmacnam=0\ntimedout=0\nperfect=0\nobsline=0\nnoobsline=0\nobsresult=0\nbadcompare=0\ncomparetest () {\n\tif grep -q ': Unknown macro ' $1 || grep -q ': Unknown macro ' $2\n\tthen\n\t\tif grep -q ': Unknown macro ' $1\n\t\tthen\n\t\t\tbadname=`grep ': Unknown macro ' $1 |\n\t\t\t\tsed -e 's/^.*: Unknown macro //' |\n\t\t\t\tsed -e 's/ (User error).*$//'`\n\t\t\techo 'Current LKMM version does not know \"'$badname'\"' $1\n\t\tfi\n\t\tif grep -q ': Unknown macro ' $2\n\t\tthen\n\t\t\tbadname=`grep ': Unknown macro ' $2 |\n\t\t\t\tsed -e 's/^.*: Unknown macro //' |\n\t\t\t\tsed -e 's/ (User error).*$//'`\n\t\t\techo 'Current LKMM version does not know \"'$badname'\"' $2\n\t\tfi\n\t\tbadmacnam=`expr \"$badmacnam\" + 1`\n\t\treturn 0\n\telif grep -q '^Command exited with non-zero status 124' $1 ||\n\t     grep -q '^Command exited with non-zero status 124' $2\n\tthen\n\t\tif grep -q '^Command exited with non-zero status 124' $1 &&\n\t\t   grep -q '^Command exited with non-zero status 124' $2\n\t\tthen\n\t\t\techo Both runs timed out: $2\n\t\telif grep -q '^Command exited with non-zero status 124' $1\n\t\tthen\n\t\t\techo Old run timed out: $2\n\t\telif grep -q '^Command exited with non-zero status 124' $2\n\t\tthen\n\t\t\techo New run timed out: $2\n\t\tfi\n\t\ttimedout=`expr \"$timedout\" + 1`\n\t\treturn 0\n\tfi\n\tgrep -v 'maxresident)k\\|minor)pagefaults\\|^Time' $1 > $T/oldout\n\tgrep -v 'maxresident)k\\|minor)pagefaults\\|^Time' $2 > $T/newout\n\tif cmp -s $T/oldout $T/newout && grep -q '^Observation' $1\n\tthen\n\t\techo Exact output match: $2\n\t\tperfect=`expr \"$perfect\" + 1`\n\t\treturn 0\n\tfi\n\n\tgrep '^Observation' $1 > $T/oldout\n\tgrep '^Observation' $2 > $T/newout\n\tif test -s $T/oldout -o -s $T/newout\n\tthen\n\t\tif cmp -s $T/oldout $T/newout\n\t\tthen\n\t\t\techo Matching Observation result and counts: $2\n\t\t\tobsline=`expr \"$obsline\" + 1`\n\t\t\treturn 0\n\t\tfi\n\telse\n\t\techo Missing Observation line \"(e.g., syntax error)\": $2\n\t\tnoobsline=`expr \"$noobsline\" + 1`\n\t\treturn 0\n\tfi\n\n\tgrep '^Observation' $1 | awk '{ print $3 }' > $T/oldout\n\tgrep '^Observation' $2 | awk '{ print $3 }' > $T/newout\n\tif cmp -s $T/oldout $T/newout\n\tthen\n\t\techo Matching Observation Always/Sometimes/Never result: $2\n\t\tobsresult=`expr \"$obsresult\" + 1`\n\t\treturn 0\n\tfi\n\techo ' !!!' Result changed: $2\n\tbadcompare=`expr \"$badcompare\" + 1`\n\treturn 1\n}\n\nsed -e 's/^.*$/comparetest &.out &.out.new/' > $T/cmpscript\n. $T/cmpscript > $T/cmpscript.out\ncat $T/cmpscript.out\n\necho ' ---' Summary: 1>&2\ngrep '!!!' $T/cmpscript.out 1>&2\nif test \"$perfect\" -ne 0\nthen\n\techo Exact output matches: $perfect 1>&2\nfi\nif test \"$obsline\" -ne 0\nthen\n\techo Matching Observation result and counts: $obsline 1>&2\nfi\nif test \"$noobsline\" -ne 0\nthen\n\techo Missing Observation line \"(e.g., syntax error)\": $noobsline 1>&2\nfi\nif test \"$obsresult\" -ne 0\nthen\n\techo Matching Observation Always/Sometimes/Never result: $obsresult 1>&2\nfi\nif test \"$timedout\" -ne 0\nthen\n\techo \"!!!\" Timed out: $timedout 1>&2\nfi\nif test \"$badmacnam\" -ne 0\nthen\n\techo \"!!!\" Unknown primitive: $badmacnam 1>&2\nfi\nif test \"$badcompare\" -ne 0\nthen\n\techo \"!!!\" Result changed: $badcompare 1>&2\n\texit 1\nfi\n\nexit 0\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}