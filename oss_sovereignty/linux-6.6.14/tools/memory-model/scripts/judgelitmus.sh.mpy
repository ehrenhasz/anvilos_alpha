{
  "module_name": "judgelitmus.sh",
  "hash_id": "5f77c8535c763c65b4e5a5bad3ecf583fb07ba9bf2dacd18fd84d5c5d2276618",
  "original_prompt": "Ingested from linux-6.6.14/tools/memory-model/scripts/judgelitmus.sh",
  "human_readable_source": "#!/bin/sh\n# SPDX-License-Identifier: GPL-2.0+\n#\n# Given a .litmus test and the corresponding litmus output file, check\n# the .litmus.out file against the \"Result:\" comment to judge whether the\n# test ran correctly.  If the --hw argument is omitted, check against the\n# LKMM output, which is assumed to be in file.litmus.out. If either a\n# \"DATARACE\" marker in the \"Result:\" comment or a \"Flag data-race\" marker\n# in the LKMM output is present, the other must also be as well, at least\n# for litmus tests having a \"Result:\" comment. In this case, a failure of\n# the Always/Sometimes/Never portion of the \"Result:\" prediction will be\n# noted, but forgiven.\n#\n# If the --hw argument is provided, this is assumed to be a hardware\n# test, and the output is assumed to be in file.litmus.HW.out, where\n# \"HW\" is the --hw argument. In addition, non-Sometimes verification\n# results will be noted, but forgiven.  Furthermore, if there is no\n# \"Result:\" comment but there is an LKMM .litmus.out file, the observation\n# in that file will be used to judge the assembly-language verification.\n#\n# Usage:\n#\tjudgelitmus.sh file.litmus\n#\n# Run this in the directory containing the memory model, specifying the\n# pathname of the litmus test to check.\n#\n# Copyright IBM Corporation, 2018\n#\n# Author: Paul E. McKenney <paulmck@linux.ibm.com>\n\nlitmus=$1\n\nif test -f \"$litmus\" -a -r \"$litmus\"\nthen\n\t:\nelse\n\techo ' --- ' error: \\\"$litmus\\\" is not a readable file\n\texit 255\nfi\nif test -z \"$LKMM_HW_MAP_FILE\"\nthen\n\tlitmusout=$litmus.out\n\tlkmmout=\nelse\n\tlitmusout=\"`echo $litmus |\n\t\tsed -e 's/\\.litmus$/.litmus.'${LKMM_HW_MAP_FILE}'/'`.out\"\n\tlkmmout=$litmus.out\nfi\nif test -f \"$LKMM_DESTDIR/$litmusout\" -a -r \"$LKMM_DESTDIR/$litmusout\"\nthen\n\t:\nelse\n\techo ' --- ' error: \\\"$LKMM_DESTDIR/$litmusout is not a readable file\n\texit 255\nfi\nif grep -q '^Flag data-race$' \"$LKMM_DESTDIR/$litmusout\"\nthen\n\tdatarace_modeled=1\nfi\nif grep -q '^[( ]\\* Result: ' $litmus\nthen\n\toutcome=`grep -m 1 '^[( ]\\* Result: ' $litmus | awk '{ print $3 }'`\n\tif grep -m1 '^[( ]\\* Result: .* DATARACE' $litmus\n\tthen\n\t\tdatarace_predicted=1\n\tfi\n\tif test -n \"$datarace_predicted\" -a -z \"$datarace_modeled\" -a -z \"$LKMM_HW_MAP_FILE\"\n\tthen\n\t\techo '!!! Predicted data race not modeled' $litmus\n\t\texit 252\n\telif test -z \"$datarace_predicted\" -a -n \"$datarace_modeled\"\n\tthen\n\t\t# Note that hardware models currently don't model data races\n\t\techo '!!! Unexpected data race modeled' $litmus\n\t\texit 253\n\tfi\nelif test -n \"$LKMM_HW_MAP_FILE\" && grep -q '^Observation' $LKMM_DESTDIR/$lkmmout > /dev/null 2>&1\nthen\n\toutcome=`grep -m 1 '^Observation ' $LKMM_DESTDIR/$lkmmout | awk '{ print $3 }'`\nelse\n\toutcome=specified\nfi\n\ngrep '^Observation' $LKMM_DESTDIR/$litmusout\nif grep -q '^Observation' $LKMM_DESTDIR/$litmusout\nthen\n\t:\nelif grep ': Unknown macro ' $LKMM_DESTDIR/$litmusout\nthen\n\tbadname=`grep ': Unknown macro ' $LKMM_DESTDIR/$litmusout |\n\t\tsed -e 's/^.*: Unknown macro //' |\n\t\tsed -e 's/ (User error).*$//'`\n\tbadmsg=' !!! Current LKMM version does not know \"'$badname'\"'\" $litmus\"\n\techo $badmsg\n\tif ! grep -q '!!!' $LKMM_DESTDIR/$litmusout\n\tthen\n\t\techo ' !!! '$badmsg >> $LKMM_DESTDIR/$litmusout 2>&1\n\tfi\n\texit 254\nelif grep '^Command exited with non-zero status 124' $LKMM_DESTDIR/$litmusout\nthen\n\techo ' !!! Timeout' $litmus\n\tif ! grep -q '!!!' $LKMM_DESTDIR/$litmusout\n\tthen\n\t\techo ' !!! Timeout' >> $LKMM_DESTDIR/$litmusout 2>&1\n\tfi\n\texit 124\nelse\n\techo ' !!! Verification error' $litmus\n\tif ! grep -q '!!!' $LKMM_DESTDIR/$litmusout\n\tthen\n\t\techo ' !!! Verification error' >> $LKMM_DESTDIR/$litmusout 2>&1\n\tfi\n\texit 255\nfi\nif test \"$outcome\" = DEADLOCK\nthen\n\tif grep '^Observation' $LKMM_DESTDIR/$litmusout | grep -q 'Never 0 0$'\n\tthen\n\t\tret=0\n\telse\n\t\techo \" !!! Unexpected non-$outcome verification\" $litmus\n\t\tif ! grep -q '!!!' $LKMM_DESTDIR/$litmusout\n\t\tthen\n\t\t\techo \" !!! Unexpected non-$outcome verification\" >> $LKMM_DESTDIR/$litmusout 2>&1\n\t\tfi\n\t\tret=1\n\tfi\nelif grep '^Observation' $LKMM_DESTDIR/$litmusout | grep -q 'Never 0 0$'\nthen\n\techo \" !!! Unexpected non-$outcome deadlock\" $litmus\n\tif ! grep -q '!!!' $LKMM_DESTDIR/$litmusout\n\tthen\n\t\techo \" !!! Unexpected non-$outcome deadlock\" $litmus >> $LKMM_DESTDIR/$litmusout 2>&1\n\tfi\n\tret=1\nelif grep '^Observation' $LKMM_DESTDIR/$litmusout | grep -q $outcome || test \"$outcome\" = Maybe\nthen\n\tret=0\nelse\n\tif test \\( -n \"$LKMM_HW_MAP_FILE\" -a \"$outcome\" = Sometimes \\) -o -n \"$datarace_modeled\"\n\tthen\n\t\tflag=\"--- Forgiven\"\n\t\tret=0\n\telse\n\t\tflag=\"!!! Unexpected\"\n\t\tret=1\n\tfi\n\techo \" $flag non-$outcome verification\" $litmus\n\tif ! grep -qe \"$flag\" $LKMM_DESTDIR/$litmusout\n\tthen\n\t\techo \" $flag non-$outcome verification\" >> $LKMM_DESTDIR/$litmusout 2>&1\n\tfi\nfi\ntail -2 $LKMM_DESTDIR/$litmusout | head -1\nexit $ret\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}