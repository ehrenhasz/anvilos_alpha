{
  "module_name": "parseargs.sh",
  "hash_id": "37a87839c5449eb8fbd04e9701c9a3df285682cef70b3356813e331e9df0f5ee",
  "original_prompt": "Ingested from linux-6.6.14/tools/memory-model/scripts/parseargs.sh",
  "human_readable_source": "#!/bin/sh\n# SPDX-License-Identifier: GPL-2.0+\n#\n# Parse arguments common to the various scripts.\n#\n# . scripts/parseargs.sh\n#\n# Include into other Linux kernel tools/memory-model scripts.\n#\n# Copyright IBM Corporation, 2018\n#\n# Author: Paul E. McKenney <paulmck@linux.ibm.com>\n\nT=/tmp/parseargs.sh.$$\nmkdir $T\n\n# Initialize one parameter: initparam name default\ninitparam () {\n\techo if test -z '\"$'$1'\"' > $T/s\n\techo then >> $T/s\n\techo\t$1='\"'$2'\"' >> $T/s\n\techo\texport $1 >> $T/s\n\techo fi >> $T/s\n\techo $1_DEF='$'$1  >> $T/s\n\t. $T/s\n}\n\ninitparam LKMM_DESTDIR \".\"\ninitparam LKMM_HERD_OPTIONS \"-conf linux-kernel.cfg\"\ninitparam LKMM_HW_MAP_FILE \"\"\ninitparam LKMM_JOBS `getconf _NPROCESSORS_ONLN`\ninitparam LKMM_PROCS \"3\"\ninitparam LKMM_TIMEOUT \"1m\"\n\nscriptname=$0\n\nusagehelp () {\n\techo \"Usage $scriptname [ arguments ]\"\n\techo \"      --destdir path (place for .litmus.out, default by .litmus)\"\n\techo \"      --herdopts -conf linux-kernel.cfg ...\"\n\techo \"      --hw AArch64\"\n\techo \"      --jobs N (number of jobs, default one per CPU)\"\n\techo \"      --procs N (litmus tests with at most this many processes)\"\n\techo \"      --timeout N (herd7 timeout (e.g., 10s, 1m, 2hr, 1d, '')\"\n\techo \"Defaults: --destdir '$LKMM_DESTDIR_DEF' --herdopts '$LKMM_HERD_OPTIONS_DEF' --hw '$LKMM_HW_MAP_FILE' --jobs '$LKMM_JOBS_DEF' --procs '$LKMM_PROCS_DEF' --timeout '$LKMM_TIMEOUT_DEF'\"\n\texit 1\n}\n\nusage () {\n\tusagehelp 1>&2\n}\n\n# checkarg --argname argtype $# arg mustmatch cannotmatch\ncheckarg () {\n\tif test $3 -le 1\n\tthen\n\t\techo $1 needs argument $2 matching \\\"$5\\\"\n\t\tusage\n\tfi\n\tif echo \"$4\" | grep -q -e \"$5\"\n\tthen\n\t\t:\n\telse\n\t\techo $1 $2 \\\"$4\\\" must match \\\"$5\\\"\n\t\tusage\n\tfi\n\tif echo \"$4\" | grep -q -e \"$6\"\n\tthen\n\t\techo $1 $2 \\\"$4\\\" must not match \\\"$6\\\"\n\t\tusage\n\tfi\n}\n\nwhile test $# -gt 0\ndo\n\tcase \"$1\" in\n\t--destdir)\n\t\tcheckarg --destdir \"(path to directory)\" \"$#\" \"$2\" '.\\+' '^--'\n\t\tLKMM_DESTDIR=\"$2\"\n\t\tmkdir $LKMM_DESTDIR > /dev/null 2>&1\n\t\tif ! test -e \"$LKMM_DESTDIR\"\n\t\tthen\n\t\t\techo \"Cannot create directory --destdir '$LKMM_DESTDIR'\"\n\t\t\tusage\n\t\tfi\n\t\tif test -d \"$LKMM_DESTDIR\" -a -x \"$LKMM_DESTDIR\"\n\t\tthen\n\t\t\t:\n\t\telse\n\t\t\techo \"Directory --destdir '$LKMM_DESTDIR' insufficient permissions to create files\"\n\t\t\tusage\n\t\tfi\n\t\tshift\n\t\t;;\n\t--herdopts|--herdopt)\n\t\tcheckarg --destdir \"(herd7 options)\" \"$#\" \"$2\" '.*' '^--'\n\t\tLKMM_HERD_OPTIONS=\"$2\"\n\t\tshift\n\t\t;;\n\t--hw)\n\t\tcheckarg --hw \"(.map file architecture name)\" \"$#\" \"$2\" '^[A-Za-z0-9_-]\\+' '^--'\n\t\tLKMM_HW_MAP_FILE=\"$2\"\n\t\tshift\n\t\t;;\n\t-j[1-9]*)\n\t\tnjobs=\"`echo $1 | sed -e 's/^-j//'`\"\n\t\ttrailchars=\"`echo $njobs | sed -e 's/[0-9]\\+\\(.*\\)$/\\1/'`\"\n\t\tif test -n \"$trailchars\"\n\t\tthen\n\t\t\techo $1 trailing characters \"'$trailchars'\"\n\t\t\tusagehelp\n\t\tfi\n\t\tLKMM_JOBS=\"`echo $njobs | sed -e 's/^\\([0-9]\\+\\).*$/\\1/'`\"\n\t\t;;\n\t--jobs|--job|-j)\n\t\tcheckarg --jobs \"(number)\" \"$#\" \"$2\" '^[1-9][0-9]*$' '^--'\n\t\tLKMM_JOBS=\"$2\"\n\t\tshift\n\t\t;;\n\t--procs|--proc)\n\t\tcheckarg --procs \"(number)\" \"$#\" \"$2\" '^[0-9]\\+$' '^--'\n\t\tLKMM_PROCS=\"$2\"\n\t\tshift\n\t\t;;\n\t--timeout)\n\t\tcheckarg --timeout \"(timeout spec)\" \"$#\" \"$2\" '^\\([0-9]\\+[smhd]\\?\\|\\)$' '^--'\n\t\tLKMM_TIMEOUT=\"$2\"\n\t\tshift\n\t\t;;\n\t--)\n\t\tshift\n\t\tbreak\n\t\t;;\n\t*)\n\t\techo Unknown argument $1\n\t\tusage\n\t\t;;\n\tesac\n\tshift\ndone\nif test -z \"$LKMM_TIMEOUT\"\nthen\n\tLKMM_TIMEOUT_CMD=\"\"; export LKMM_TIMEOUT_CMD\nelse\n\tLKMM_TIMEOUT_CMD=\"timeout $LKMM_TIMEOUT\"; export LKMM_TIMEOUT_CMD\nfi\nrm -rf $T\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}