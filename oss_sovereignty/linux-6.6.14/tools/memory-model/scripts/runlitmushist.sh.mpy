{
  "module_name": "runlitmushist.sh",
  "hash_id": "fd6360f7e01bd3be15c2357ce69a2ce5f50d986d7493bd8e6878288ea1a01fbb",
  "original_prompt": "Ingested from linux-6.6.14/tools/memory-model/scripts/runlitmushist.sh",
  "human_readable_source": "#!/bin/bash\n# SPDX-License-Identifier: GPL-2.0+\n#\n# Runs the C-language litmus tests specified on standard input, using up\n# to the specified number of CPUs (defaulting to all of them) and placing\n# the results in the specified directory (defaulting to the same place\n# the litmus test came from).\n#\n# sh runlitmushist.sh\n#\n# Run from the Linux kernel tools/memory-model directory.\n# This script uses environment variables produced by parseargs.sh.\n#\n# Copyright IBM Corporation, 2018\n#\n# Author: Paul E. McKenney <paulmck@linux.ibm.com>\n\n. scripts/hwfnseg.sh\n\nT=/tmp/runlitmushist.sh.$$\ntrap 'rm -rf $T' 0\nmkdir $T\n\nif test -d litmus\nthen\n\t:\nelse\n\techo Directory \\\"litmus\\\" missing, aborting run.\n\texit 1\nfi\n\n# Prefixes for per-CPU scripts\nfor ((i=0;i<$LKMM_JOBS;i++))\ndo\n\techo T=$T >> $T/$i.sh\n\tcat << '___EOF___' >> $T/$i.sh\n\truntest () {\n\t\tif scripts/runlitmus.sh $1\n\t\tthen\n\t\t\tif ! grep -q '^Observation ' $LKMM_DESTDIR/$1$2.out\n\t\t\tthen\n\t\t\t\techo ' !!! Herd failed, no Observation:' $1\n\t\t\tfi\n\t\telse\n\t\t\texitcode=$?\n\t\t\tif test \"$exitcode\" -eq 124\n\t\t\tthen\n\t\t\t\texitmsg=\"timed out\"\n\t\t\telif test \"$exitcode\" -eq 253\n\t\t\tthen\n\t\t\t\texitmsg=\n\t\t\telse\n\t\t\t\texitmsg=\"failed, exit code $exitcode\"\n\t\t\tfi\n\t\t\tif test -n \"$exitmsg\"\n\t\t\tthen\n\t\t\t\techo ' !!! Herd' ${exitmsg}: $1\n\t\t\tfi\n\t\tfi\n\t}\n___EOF___\ndone\n\nawk -v q=\"'\" -v b='\\\\' '\n{\n\tprint \"echo `grep \" q \"^P[0-9]\" b \"+(\" q \" \" $0 \" | tail -1 | sed -e \" q \"s/^P\" b \"([0-9]\" b \"+\" b \")(.*$/\" b \"1/\" q \"` \" $0\n}' | sh | sort -k1n |\nawk -v dq='\"' -v hwfnseg=\"$hwfnseg\" -v ncpu=\"$LKMM_JOBS\" -v t=\"$T\" '\n{\n\tprint \"if test -z \" dq hwfnseg dq \" || scripts/simpletest.sh \" dq $2 dq\n\tprint \"then\"\n\tprint \"\\techo runtest \" dq $2 dq \" \" hwfnseg \" >> \" t \"/\" NR % ncpu \".sh\";\n\tprint \"fi\"\n}\n\nEND {\n\tfor (i = 0; i < ncpu; i++) {\n\t\tprint \"sh \" t \"/\" i \".sh > \" t \"/\" i \".sh.out 2>&1 &\";\n\t\tclose(t \"/\" i \".sh\");\n\t}\n\tprint \"wait\";\n}' | sh\ncat $T/*.sh.out\nif grep -q '!!!' $T/*.sh.out\nthen\n\techo ' ---' Summary: 1>&2\n\tgrep '!!!' $T/*.sh.out 1>&2\n\tnfail=\"`grep '!!!' $T/*.sh.out | wc -l`\"\n\techo 'Number of failed herd7 runs (e.g., timeout): ' $nfail 1>&2\n\texit 1\nelse\n\techo All runs completed successfully. 1>&2\n\texit 0\nfi\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}