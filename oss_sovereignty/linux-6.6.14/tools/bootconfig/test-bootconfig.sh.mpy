{
  "module_name": "test-bootconfig.sh",
  "hash_id": "3cedde4cc98f62b03c55b4d0c5e2f599449f02845b1029bd02a9c548deda3efd",
  "original_prompt": "Ingested from linux-6.6.14/tools/bootconfig/test-bootconfig.sh",
  "human_readable_source": "#!/bin/sh\n# SPDX-License-Identifier: GPL-2.0-only\n\necho \"Boot config test script\"\n\nif [ -d \"$1\" ]; then\n  TESTDIR=$1\nelse\n  TESTDIR=.\nfi\nBOOTCONF=${TESTDIR}/bootconfig\nALIGN=4\n\nINITRD=`mktemp ${TESTDIR}/initrd-XXXX`\nTEMPCONF=`mktemp ${TESTDIR}/temp-XXXX.bconf`\nOUTFILE=`mktemp ${TESTDIR}/tempout-XXXX`\nNG=0\n\ncleanup() {\n  rm -f $INITRD $TEMPCONF $OUTFILE\n  exit $NG\n}\n\ntrap cleanup EXIT TERM\n\nNO=1\n\nxpass() { # pass test command\n  echo \"test case $NO ($*)... \"\n  if ! ($@ && echo \"\\t\\t[OK]\"); then\n     echo \"\\t\\t[NG]\"; NG=$((NG + 1))\n  fi\n  NO=$((NO + 1))\n}\n\nxfail() { # fail test command\n  echo \"test case $NO ($*)... \"\n  if ! (! $@ && echo \"\\t\\t[OK]\"); then\n     echo \"\\t\\t[NG]\"; NG=$((NG + 1))\n  fi\n  NO=$((NO + 1))\n}\n\necho \"Basic command test\"\nxpass $BOOTCONF $INITRD\n\necho \"Delete command should success without bootconfig\"\nxpass $BOOTCONF -d $INITRD\n\ndd if=/dev/zero of=$INITRD bs=4096 count=1\necho \"key = value;\" > $TEMPCONF\nbconf_size=$(stat -c %s $TEMPCONF)\ninitrd_size=$(stat -c %s $INITRD)\n\necho \"Apply command test\"\nxpass $BOOTCONF -a $TEMPCONF $INITRD\nnew_size=$(stat -c %s $INITRD)\n\necho \"Show command test\"\nxpass $BOOTCONF $INITRD\n\necho \"File size check\"\ntotal_size=$(expr $bconf_size + $initrd_size + 9 + 12 + $ALIGN - 1 )\ntotal_size=$(expr $total_size / $ALIGN)\ntotal_size=$(expr $total_size \\* $ALIGN)\nxpass test $new_size -eq $total_size\n\necho \"Apply command repeat test\"\nxpass $BOOTCONF -a $TEMPCONF $INITRD\n\necho \"File size check\"\nxpass test $new_size -eq $(stat -c %s $INITRD)\n\necho \"Delete command check\"\nxpass $BOOTCONF -d $INITRD\n\necho \"File size check\"\nnew_size=$(stat -c %s $INITRD)\nxpass test $new_size -eq $initrd_size\n\necho \"No error messge while applying\"\ndd if=/dev/zero of=$INITRD bs=4096 count=1\nprintf \" \\0\\0\\0 \\0\\0\\0\" >> $INITRD\n$BOOTCONF -a $TEMPCONF $INITRD > $OUTFILE 2>&1\nxfail grep -i \"failed\" $OUTFILE\nxfail grep -i \"error\" $OUTFILE\n\necho \"Max node number check\"\n\nawk '\nBEGIN {\n  for (i = 0; i < 26; i += 1)\n      printf(\"%c\\n\", 65 + i % 26)\n  for (i = 26; i < 8192; i += 1)\n      printf(\"%c%c%c\\n\", 65 + i % 26, 65 + (i / 26) % 26, 65 + (i / 26 / 26))\n}\n' > $TEMPCONF\nxpass $BOOTCONF -a $TEMPCONF $INITRD\n\necho \"badnode\" >> $TEMPCONF\nxfail $BOOTCONF -a $TEMPCONF $INITRD\n\necho \"Max filesize check\"\n\n# Max size is 32767 (including terminal byte)\necho -n \"data = \\\"\" > $TEMPCONF\ndd if=/dev/urandom bs=768 count=32 | base64 -w0 >> $TEMPCONF\necho \"\\\"\" >> $TEMPCONF\nxfail $BOOTCONF -a $TEMPCONF $INITRD\n\ntruncate -s 32764 $TEMPCONF\necho \"\\\"\" >> $TEMPCONF\t# add 2 bytes + terminal ('\\\"\\n\\0')\nxpass $BOOTCONF -a $TEMPCONF $INITRD\n\necho \"Adding same-key values\"\ncat > $TEMPCONF << EOF\nkey = bar, baz\nkey += qux\nEOF\necho > $INITRD\n\nxpass $BOOTCONF -a $TEMPCONF $INITRD\n$BOOTCONF $INITRD > $OUTFILE\nxpass grep -q \"bar\" $OUTFILE\nxpass grep -q \"baz\" $OUTFILE\nxpass grep -q \"qux\" $OUTFILE\n\necho \"Override same-key values\"\ncat > $TEMPCONF << EOF\nkey = bar, baz\nkey := qux\nEOF\necho > $INITRD\n\nxpass $BOOTCONF -a $TEMPCONF $INITRD\n$BOOTCONF $INITRD > $OUTFILE\nxfail grep -q \"bar\" $OUTFILE\nxfail grep -q \"baz\" $OUTFILE\nxpass grep -q \"qux\" $OUTFILE\n\necho \"Double/single quotes test\"\necho \"key = '\\\"string\\\"';\" > $TEMPCONF\n$BOOTCONF -a $TEMPCONF $INITRD\n$BOOTCONF $INITRD > $TEMPCONF\ncat $TEMPCONF\nxpass grep \\'\\\"string\\\"\\' $TEMPCONF\n\necho \"Repeat same-key tree\"\ncat > $TEMPCONF << EOF\nfoo\nbar\nfoo { buz }\nEOF\necho > $INITRD\n\nxpass $BOOTCONF -a $TEMPCONF $INITRD\n$BOOTCONF $INITRD > $OUTFILE\nxpass grep -q \"bar\" $OUTFILE\n\n\necho \"Remove/keep tailing spaces\"\ncat > $TEMPCONF << EOF\nfoo = val     # comment\nbar = \"val2 \" # comment\nEOF\necho > $INITRD\n\nxpass $BOOTCONF -a $TEMPCONF $INITRD\n$BOOTCONF $INITRD > $OUTFILE\nxfail grep -q val[[:space:]] $OUTFILE\nxpass grep -q val2[[:space:]] $OUTFILE\n\necho \"=== expected failure cases ===\"\nfor i in samples/bad-* ; do\n  xfail $BOOTCONF -a $i $INITRD\ndone\n\necho \"=== expected success cases ===\"\nfor i in samples/good-* ; do\n  xpass $BOOTCONF -a $i $INITRD\ndone\n\n\necho\necho \"=== Summary ===\"\necho \"# of Passed: $(expr $NO - $NG - 1)\"\necho \"# of Failed: $NG\"\n\necho\nif [ $NG -eq 0 ]; then\n\techo \"All tests passed\"\nelse\n\techo \"$NG tests failed\"\n\texit 1\nfi\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}