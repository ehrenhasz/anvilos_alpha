{
  "module_name": "trace.c",
  "hash_id": "535ba0b6641dd91321805b4f06e1b19b051fbdf209e146f9e80a77709c3e2cd2",
  "original_prompt": "Ingested from linux-6.6.14/tools/verification/rv/src/trace.c",
  "human_readable_source": "\n \n\n#include <sys/sendfile.h>\n#include <tracefs.h>\n#include <signal.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n\n#include <rv.h>\n#include <trace.h>\n#include <utils.h>\n\n \nstatic struct tracefs_instance *create_instance(char *instance_name)\n{\n\treturn tracefs_instance_create(instance_name);\n}\n\n \nstatic void destroy_instance(struct tracefs_instance *inst)\n{\n\ttracefs_instance_destroy(inst);\n\ttracefs_instance_free(inst);\n}\n\n \nint\ncollect_registered_events(struct tep_event *event, struct tep_record *record,\n\t\t\t  int cpu, void *context)\n{\n\tstruct trace_instance *trace = context;\n\tstruct trace_seq *s = trace->seq;\n\n\tif (should_stop())\n\t\treturn 1;\n\n\tif (!event->handler)\n\t\treturn 0;\n\n\tevent->handler(s, record, event, context);\n\n\treturn 0;\n}\n\n \nvoid trace_instance_destroy(struct trace_instance *trace)\n{\n\tif (trace->inst) {\n\t\tdestroy_instance(trace->inst);\n\t\ttrace->inst = NULL;\n\t}\n\n\tif (trace->seq) {\n\t\tfree(trace->seq);\n\t\ttrace->seq = NULL;\n\t}\n\n\tif (trace->tep) {\n\t\ttep_free(trace->tep);\n\t\ttrace->tep = NULL;\n\t}\n}\n\n \nint trace_instance_init(struct trace_instance *trace, char *name)\n{\n\ttrace->seq = calloc(1, sizeof(*trace->seq));\n\tif (!trace->seq)\n\t\tgoto out_err;\n\n\ttrace_seq_init(trace->seq);\n\n\ttrace->inst = create_instance(name);\n\tif (!trace->inst)\n\t\tgoto out_err;\n\n\ttrace->tep = tracefs_local_events(NULL);\n\tif (!trace->tep)\n\t\tgoto out_err;\n\n\t \n\ttracefs_trace_off(trace->inst);\n\n\treturn 0;\n\nout_err:\n\ttrace_instance_destroy(trace);\n\treturn 1;\n}\n\n \nint trace_instance_start(struct trace_instance *trace)\n{\n\treturn tracefs_trace_on(trace->inst);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}