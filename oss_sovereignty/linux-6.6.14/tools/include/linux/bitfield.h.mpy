{
  "module_name": "bitfield.h",
  "hash_id": "213eeb044c2a4b7d06d016feda14dde3581c3bdd2bc1d5ac321ffaf583675ba9",
  "original_prompt": "Ingested from linux-6.6.14/tools/include/linux/bitfield.h",
  "human_readable_source": " \n \n\n#ifndef _LINUX_BITFIELD_H\n#define _LINUX_BITFIELD_H\n\n#include <linux/build_bug.h>\n#include <asm/byteorder.h>\n\n \n\n#define __bf_shf(x) (__builtin_ffsll(x) - 1)\n\n#define __scalar_type_to_unsigned_cases(type)\t\t\t\t\\\n\t\tunsigned type:\t(unsigned type)0,\t\t\t\\\n\t\tsigned type:\t(unsigned type)0\n\n#define __unsigned_scalar_typeof(x) typeof(\t\t\t\t\\\n\t\t_Generic((x),\t\t\t\t\t\t\\\n\t\t\tchar:\t(unsigned char)0,\t\t\t\\\n\t\t\t__scalar_type_to_unsigned_cases(char),\t\t\\\n\t\t\t__scalar_type_to_unsigned_cases(short),\t\t\\\n\t\t\t__scalar_type_to_unsigned_cases(int),\t\t\\\n\t\t\t__scalar_type_to_unsigned_cases(long),\t\t\\\n\t\t\t__scalar_type_to_unsigned_cases(long long),\t\\\n\t\t\tdefault: (x)))\n\n#define __bf_cast_unsigned(type, x)\t((__unsigned_scalar_typeof(type))(x))\n\n#define __BF_FIELD_CHECK(_mask, _reg, _val, _pfx)\t\t\t\\\n\t({\t\t\t\t\t\t\t\t\\\n\t\tBUILD_BUG_ON_MSG(!__builtin_constant_p(_mask),\t\t\\\n\t\t\t\t _pfx \"mask is not constant\");\t\t\\\n\t\tBUILD_BUG_ON_MSG((_mask) == 0, _pfx \"mask is zero\");\t\\\n\t\tBUILD_BUG_ON_MSG(__builtin_constant_p(_val) ?\t\t\\\n\t\t\t\t ~((_mask) >> __bf_shf(_mask)) & (_val) : 0, \\\n\t\t\t\t _pfx \"value too large for the field\"); \\\n\t\tBUILD_BUG_ON_MSG(__bf_cast_unsigned(_mask, _mask) >\t\\\n\t\t\t\t __bf_cast_unsigned(_reg, ~0ull),\t\\\n\t\t\t\t _pfx \"type of reg too small for mask\"); \\\n\t\t__BUILD_BUG_ON_NOT_POWER_OF_2((_mask) +\t\t\t\\\n\t\t\t\t\t      (1ULL << __bf_shf(_mask))); \\\n\t})\n\n \n#define FIELD_MAX(_mask)\t\t\t\t\t\t\\\n\t({\t\t\t\t\t\t\t\t\\\n\t\t__BF_FIELD_CHECK(_mask, 0ULL, 0ULL, \"FIELD_MAX: \");\t\\\n\t\t(typeof(_mask))((_mask) >> __bf_shf(_mask));\t\t\\\n\t})\n\n \n#define FIELD_FIT(_mask, _val)\t\t\t\t\t\t\\\n\t({\t\t\t\t\t\t\t\t\\\n\t\t__BF_FIELD_CHECK(_mask, 0ULL, 0ULL, \"FIELD_FIT: \");\t\\\n\t\t!((((typeof(_mask))_val) << __bf_shf(_mask)) & ~(_mask)); \\\n\t})\n\n \n#define FIELD_PREP(_mask, _val)\t\t\t\t\t\t\\\n\t({\t\t\t\t\t\t\t\t\\\n\t\t__BF_FIELD_CHECK(_mask, 0ULL, _val, \"FIELD_PREP: \");\t\\\n\t\t((typeof(_mask))(_val) << __bf_shf(_mask)) & (_mask);\t\\\n\t})\n\n \n#define FIELD_GET(_mask, _reg)\t\t\t\t\t\t\\\n\t({\t\t\t\t\t\t\t\t\\\n\t\t__BF_FIELD_CHECK(_mask, _reg, 0U, \"FIELD_GET: \");\t\\\n\t\t(typeof(_mask))(((_reg) & (_mask)) >> __bf_shf(_mask));\t\\\n\t})\n\nextern void __compiletime_error(\"value doesn't fit into mask\")\n__field_overflow(void);\nextern void __compiletime_error(\"bad bitfield mask\")\n__bad_mask(void);\nstatic __always_inline u64 field_multiplier(u64 field)\n{\n\tif ((field | (field - 1)) & ((field | (field - 1)) + 1))\n\t\t__bad_mask();\n\treturn field & -field;\n}\nstatic __always_inline u64 field_mask(u64 field)\n{\n\treturn field / field_multiplier(field);\n}\n#define field_max(field)\t((typeof(field))field_mask(field))\n#define ____MAKE_OP(type,base,to,from)\t\t\t\t\t\\\nstatic __always_inline __##type type##_encode_bits(base v, base field)\t\\\n{\t\t\t\t\t\t\t\t\t\\\n\tif (__builtin_constant_p(v) && (v & ~field_mask(field)))\t\\\n\t\t__field_overflow();\t\t\t\t\t\\\n\treturn to((v & field_mask(field)) * field_multiplier(field));\t\\\n}\t\t\t\t\t\t\t\t\t\\\nstatic __always_inline __##type type##_replace_bits(__##type old,\t\\\n\t\t\t\t\tbase val, base field)\t\t\\\n{\t\t\t\t\t\t\t\t\t\\\n\treturn (old & ~to(field)) | type##_encode_bits(val, field);\t\\\n}\t\t\t\t\t\t\t\t\t\\\nstatic __always_inline void type##p_replace_bits(__##type *p,\t\t\\\n\t\t\t\t\tbase val, base field)\t\t\\\n{\t\t\t\t\t\t\t\t\t\\\n\t*p = (*p & ~to(field)) | type##_encode_bits(val, field);\t\\\n}\t\t\t\t\t\t\t\t\t\\\nstatic __always_inline base type##_get_bits(__##type v, base field)\t\\\n{\t\t\t\t\t\t\t\t\t\\\n\treturn (from(v) & field)/field_multiplier(field);\t\t\\\n}\n#define __MAKE_OP(size)\t\t\t\t\t\t\t\\\n\t____MAKE_OP(le##size,u##size,cpu_to_le##size,le##size##_to_cpu)\t\\\n\t____MAKE_OP(be##size,u##size,cpu_to_be##size,be##size##_to_cpu)\t\\\n\t____MAKE_OP(u##size,u##size,,)\n____MAKE_OP(u8,u8,,)\n__MAKE_OP(16)\n__MAKE_OP(32)\n__MAKE_OP(64)\n#undef __MAKE_OP\n#undef ____MAKE_OP\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}