{
  "module_name": "bitmap.h",
  "hash_id": "c905379d2464ff85ecf9608004dabc3a8e392184fd8bdcab58a248655b74ec7c",
  "original_prompt": "Ingested from linux-6.6.14/tools/include/linux/bitmap.h",
  "human_readable_source": " \n#ifndef _TOOLS_LINUX_BITMAP_H\n#define _TOOLS_LINUX_BITMAP_H\n\n#include <string.h>\n#include <linux/bitops.h>\n#include <linux/find.h>\n#include <stdlib.h>\n#include <linux/kernel.h>\n\n#define DECLARE_BITMAP(name,bits) \\\n\tunsigned long name[BITS_TO_LONGS(bits)]\n\nunsigned int __bitmap_weight(const unsigned long *bitmap, int bits);\nvoid __bitmap_or(unsigned long *dst, const unsigned long *bitmap1,\n\t\t const unsigned long *bitmap2, int bits);\nbool __bitmap_and(unsigned long *dst, const unsigned long *bitmap1,\n\t\t const unsigned long *bitmap2, unsigned int bits);\nbool __bitmap_equal(const unsigned long *bitmap1,\n\t\t    const unsigned long *bitmap2, unsigned int bits);\nvoid bitmap_clear(unsigned long *map, unsigned int start, int len);\nbool __bitmap_intersects(const unsigned long *bitmap1,\n\t\t\t const unsigned long *bitmap2, unsigned int bits);\n\n#define BITMAP_FIRST_WORD_MASK(start) (~0UL << ((start) & (BITS_PER_LONG - 1)))\n#define BITMAP_LAST_WORD_MASK(nbits) (~0UL >> (-(nbits) & (BITS_PER_LONG - 1)))\n\nstatic inline void bitmap_zero(unsigned long *dst, unsigned int nbits)\n{\n\tif (small_const_nbits(nbits))\n\t\t*dst = 0UL;\n\telse {\n\t\tint len = BITS_TO_LONGS(nbits) * sizeof(unsigned long);\n\t\tmemset(dst, 0, len);\n\t}\n}\n\nstatic inline void bitmap_fill(unsigned long *dst, unsigned int nbits)\n{\n\tunsigned int nlongs = BITS_TO_LONGS(nbits);\n\tif (!small_const_nbits(nbits)) {\n\t\tunsigned int len = (nlongs - 1) * sizeof(unsigned long);\n\t\tmemset(dst, 0xff,  len);\n\t}\n\tdst[nlongs - 1] = BITMAP_LAST_WORD_MASK(nbits);\n}\n\nstatic inline bool bitmap_empty(const unsigned long *src, unsigned int nbits)\n{\n\tif (small_const_nbits(nbits))\n\t\treturn ! (*src & BITMAP_LAST_WORD_MASK(nbits));\n\n\treturn find_first_bit(src, nbits) == nbits;\n}\n\nstatic inline bool bitmap_full(const unsigned long *src, unsigned int nbits)\n{\n\tif (small_const_nbits(nbits))\n\t\treturn ! (~(*src) & BITMAP_LAST_WORD_MASK(nbits));\n\n\treturn find_first_zero_bit(src, nbits) == nbits;\n}\n\nstatic inline unsigned int bitmap_weight(const unsigned long *src, unsigned int nbits)\n{\n\tif (small_const_nbits(nbits))\n\t\treturn hweight_long(*src & BITMAP_LAST_WORD_MASK(nbits));\n\treturn __bitmap_weight(src, nbits);\n}\n\nstatic inline void bitmap_or(unsigned long *dst, const unsigned long *src1,\n\t\t\t     const unsigned long *src2, unsigned int nbits)\n{\n\tif (small_const_nbits(nbits))\n\t\t*dst = *src1 | *src2;\n\telse\n\t\t__bitmap_or(dst, src1, src2, nbits);\n}\n\n \nstatic inline unsigned long *bitmap_zalloc(int nbits)\n{\n\treturn calloc(1, BITS_TO_LONGS(nbits) * sizeof(unsigned long));\n}\n\n \nstatic inline void bitmap_free(unsigned long *bitmap)\n{\n\tfree(bitmap);\n}\n\n \nsize_t bitmap_scnprintf(unsigned long *bitmap, unsigned int nbits,\n\t\t\tchar *buf, size_t size);\n\n \nstatic inline bool bitmap_and(unsigned long *dst, const unsigned long *src1,\n\t\t\t     const unsigned long *src2, unsigned int nbits)\n{\n\tif (small_const_nbits(nbits))\n\t\treturn (*dst = *src1 & *src2 & BITMAP_LAST_WORD_MASK(nbits)) != 0;\n\treturn __bitmap_and(dst, src1, src2, nbits);\n}\n\n#ifdef __LITTLE_ENDIAN\n#define BITMAP_MEM_ALIGNMENT 8\n#else\n#define BITMAP_MEM_ALIGNMENT (8 * sizeof(unsigned long))\n#endif\n#define BITMAP_MEM_MASK (BITMAP_MEM_ALIGNMENT - 1)\n#define IS_ALIGNED(x, a) (((x) & ((typeof(x))(a) - 1)) == 0)\n\nstatic inline bool bitmap_equal(const unsigned long *src1,\n\t\t\t\tconst unsigned long *src2, unsigned int nbits)\n{\n\tif (small_const_nbits(nbits))\n\t\treturn !((*src1 ^ *src2) & BITMAP_LAST_WORD_MASK(nbits));\n\tif (__builtin_constant_p(nbits & BITMAP_MEM_MASK) &&\n\t    IS_ALIGNED(nbits, BITMAP_MEM_ALIGNMENT))\n\t\treturn !memcmp(src1, src2, nbits / 8);\n\treturn __bitmap_equal(src1, src2, nbits);\n}\n\nstatic inline bool bitmap_intersects(const unsigned long *src1,\n\t\t\t\t     const unsigned long *src2,\n\t\t\t\t     unsigned int nbits)\n{\n\tif (small_const_nbits(nbits))\n\t\treturn ((*src1 & *src2) & BITMAP_LAST_WORD_MASK(nbits)) != 0;\n\telse\n\t\treturn __bitmap_intersects(src1, src2, nbits);\n}\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}