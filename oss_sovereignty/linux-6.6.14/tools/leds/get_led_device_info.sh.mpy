{
  "module_name": "get_led_device_info.sh",
  "hash_id": "b6f0ecdc7930d35cf626ba6b371951fed69db42f3cb9d8a61f541b8056323bdd",
  "original_prompt": "Ingested from linux-6.6.14/tools/leds/get_led_device_info.sh",
  "human_readable_source": "#!/bin/sh\n# SPDX-License-Identifier: GPL-2.0\n\nled_common_defs_path=\"include/dt-bindings/leds/common.h\"\n\nnum_args=$#\nif [ $num_args -eq 1 ]; then\n        linux_top=$(dirname `realpath $0` | awk -F/     \\\n                        '{                              \\\n                                i=1;                    \\\n                                while (i <= NF - 2) {   \\\n                                        printf $i\"/\";   \\\n                                        i++;            \\\n                                };                      \\\n                        }')\n\tled_defs_path=$linux_top/$led_common_defs_path\nelif [ $num_args -eq 2 ]; then\n        led_defs_path=`realpath $2`\nelse\n\techo \"Usage: get_led_device_info.sh LED_CDEV_PATH [LED_COMMON_DEFS_PATH]\"\n\texit 1\nfi\n\nif [ ! -f $led_defs_path ]; then\n\techo \"$led_defs_path doesn't exist\"\n\texit 1\nfi\n\nled_cdev_path=`echo $1 | sed s'/\\/$//'`\n\nls \"$led_cdev_path/brightness\" > /dev/null 2>&1\nif [ $? -ne 0 ]; then\n\techo \"Device \\\"$led_cdev_path\\\" does not exist.\"\n\texit 1\nfi\n\nbus=`readlink $led_cdev_path/device/subsystem | sed s'/.*\\///'`\nusb_subdev=`readlink $led_cdev_path | grep usb | sed s'/\\(.*usb[0-9]*\\/[0-9]*-[0-9]*\\)\\/.*/\\1/'`\nls \"$led_cdev_path/device/of_node/compatible\" > /dev/null 2>&1\nof_node_missing=$?\n\nif [ \"$bus\" = \"input\" ]; then\n\tinput_node=`readlink $led_cdev_path/device | sed s'/.*\\///'`\n\tif [ ! -z \"$usb_subdev\" ]; then\n\t\tbus=\"usb\"\n\tfi\nfi\n\nif [ \"$bus\" = \"usb\" ]; then\n\tusb_interface=`readlink $led_cdev_path | sed s'/.*\\(usb[0-9]*\\)/\\1/' | cut -d\\/ -f3`\n\tcd $led_cdev_path/../$usb_subdev\n\tdriver=`readlink $usb_interface/driver | sed s'/.*\\///'`\n\tif [ -d \"$usb_interface/ieee80211\" ]; then\n\t\twifi_phy=`ls -l $usb_interface/ieee80211 | grep phy | awk '{print $9}'`\n\tfi\n\tidVendor=`cat idVendor`\n\tidProduct=`cat idProduct`\n\tmanufacturer=`cat manufacturer`\n\tproduct=`cat product`\nelif [ \"$bus\" = \"input\" ]; then\n\tcd $led_cdev_path\n\tproduct=`cat device/name`\n\tdriver=`cat device/device/driver/description`\nelif [ $of_node_missing -eq 0 ]; then\n\tcd $led_cdev_path\n\tcompatible=`cat device/of_node/compatible`\n\tif [ \"$compatible\" = \"gpio-leds\" ]; then\n\t\tdriver=\"leds-gpio\"\n\telif [ \"$compatible\" = \"pwm-leds\" ]; then\n\t\tdriver=\"leds-pwm\"\n\telse\n\t\tmanufacturer=`echo $compatible | awk -F, '{print $1}'`\n\t\tproduct=`echo $compatible | awk -F, '{print $2}'`\n\tfi\nelse\n\techo \"Unknown device type.\"\n\texit 1\nfi\n\nprintf \"\\n#####################################\\n\"\nprintf \"# LED class device hardware details #\\n\"\nprintf \"#####################################\\n\\n\"\n\nprintf \"bus:\\t\\t\\t$bus\\n\"\n\nif [ ! -z \"$idVendor\" ]; then\n\tprintf \"idVendor:\\t\\t$idVendor\\n\"\nfi\n\nif [ ! -z \"$idProduct\" ]; then\n\tprintf \"idProduct:\\t\\t$idProduct\\n\"\nfi\n\nif [ ! -z \"$manufacturer\" ]; then\n\tprintf \"manufacturer:\\t\\t$manufacturer\\n\"\nfi\n\nif [ ! -z \"$product\" ]; then\n\tprintf \"product:\\t\\t$product\\n\"\nfi\n\nif [ ! -z \"$driver\" ]; then\n\tprintf \"driver:\\t\\t\\t$driver\\n\"\nfi\n\nif [ ! -z \"$input_node\" ]; then\n\tprintf \"associated input node:\\t$input_node\\n\"\nfi\n\nprintf \"\\n####################################\\n\"\nprintf \"# LED class device name validation #\\n\"\nprintf \"####################################\\n\\n\"\n\nled_name=`echo $led_cdev_path | sed s'/.*\\///'`\n\nnum_sections=`echo $led_name | awk -F: '{print NF}'`\n\nif [ $num_sections -eq 1 ]; then\n\tprintf \"\\\":\\\" delimiter not detected.\\t[ FAILED ]\\n\"\n\texit 1\nelif [ $num_sections -eq 2 ]; then\n\tcolor=`echo $led_name | cut -d: -f1`\n\tfunction=`echo $led_name | cut -d: -f2`\nelif [ $num_sections -eq 3 ]; then\n\tdevicename=`echo $led_name | cut -d: -f1`\n\tcolor=`echo $led_name | cut -d: -f2`\n\tfunction=`echo $led_name | cut -d: -f3`\nelse\n\tprintf \"Detected %d sections in the LED class device name - should the script be updated?\\n\" $num_sections\n\texit 1\nfi\n\nS_DEV=\"devicename\"\nS_CLR=\"color     \"\nS_FUN=\"function  \"\nstatus_tab=20\n\nprint_msg_ok()\n{\n\tlocal section_name=\"$1\"\n\tlocal section_val=\"$2\"\n\tlocal msg=\"$3\"\n\tprintf \"$section_name :\\t%-${status_tab}.${status_tab}s %s %s\\n\" \"$section_val\" \"[ OK ]    \" \"$msg\"\n}\n\nprint_msg_failed()\n{\n\tlocal section_name=\"$1\"\n\tlocal section_val=\"$2\"\n\tlocal msg=\"$3\"\n\tprintf \"$section_name :\\t%-${status_tab}.${status_tab}s %s %s\\n\" \"$section_val\" \"[ FAILED ]\" \"$msg\"\n}\n\nif [ ! -z \"$input_node\" ]; then\n\texpected_devname=$input_node\nelif [ ! -z \"$wifi_phy\" ]; then\n\texpected_devname=$wifi_phy\nfi\n\nif [ ! -z \"$devicename\" ]; then\n\tif [ ! -z \"$expected_devname\" ]; then\n\t\tif [ \"$devicename\" = \"$expected_devname\" ]; then\n\t\t\tprint_msg_ok \"$S_DEV\" \"$devicename\"\n\t\telse\n\t\t\tprint_msg_failed \"$S_DEV\" \"$devicename\" \"Expected: $expected_devname\"\n\t\tfi\n\telse\n\t\tif [ \"$devicename\" = \"$manufacturer\" ]; then\n\t\t\tprint_msg_failed \"$S_DEV\" \"$devicename\" \"Redundant: use of vendor name is discouraged\"\n\t\telif [ \"$devicename\" = \"$product\" ]; then\n\t\t\tprint_msg_failed \"$S_DEV\" \"$devicename\" \"Redundant: use of product name is discouraged\"\n\t\telse\n\t\t\tprint_msg_failed \"$S_DEV\" \"$devicename\" \"Unknown devicename - should the script be updated?\"\n\t\tfi\n\tfi\nelif [ ! -z \"$expected_devname\" ]; then\n\tprint_msg_failed \"$S_DEV\" \"blank\" \"Expected: $expected_devname\"\nfi\n\nif [ ! -z \"$color\" ]; then\n\tcolor_upper=`echo $color | tr [:lower:] [:upper:]`\n\tcolor_id_definition=$(cat $led_defs_path | grep \"_$color_upper\\s\" | awk '{print $2}')\n\tif [ ! -z \"$color_id_definition\" ]; then\n\t\tprint_msg_ok \"$S_CLR\" \"$color\" \"Matching definition: $color_id_definition\"\n\telse\n\t\tprint_msg_failed \"$S_CLR\" \"$color\" \"Definition not found in $led_defs_path\"\n\tfi\n\nfi\n\nif [ ! -z \"$function\" ]; then\n\t# strip optional enumerator\n\tfunction=`echo $function | sed s'/\\(.*\\)-[0-9]*$/\\1/'`\n\tfun_definition=$(cat $led_defs_path | grep \"\\\"$function\\\"\" | awk '{print $2}')\n\tif [ ! -z \"$fun_definition\" ]; then\n\t\tprint_msg_ok \"$S_FUN\" \"$function\" \"Matching definition: $fun_definition\"\n\telse\n\t\tprint_msg_failed \"$S_FUN\" \"$function\" \"Definition not found in $led_defs_path\"\n\tfi\n\nfi\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}