{
  "module_name": "cgroup_event_listener.c",
  "hash_id": "56a0affe5fb6382227abe3c300aff5f6144b295a470db3ad04a82f0fcb401c86",
  "original_prompt": "Ingested from linux-6.6.14/tools/cgroup/cgroup_event_listener.c",
  "human_readable_source": "\n \n\n#include <assert.h>\n#include <err.h>\n#include <errno.h>\n#include <fcntl.h>\n#include <libgen.h>\n#include <limits.h>\n#include <stdio.h>\n#include <string.h>\n#include <unistd.h>\n\n#include <sys/eventfd.h>\n\n#define USAGE_STR \"Usage: cgroup_event_listener <path-to-control-file> <args>\"\n\nint main(int argc, char **argv)\n{\n\tint efd = -1;\n\tint cfd = -1;\n\tint event_control = -1;\n\tchar event_control_path[PATH_MAX];\n\tchar line[LINE_MAX];\n\tint ret;\n\n\tif (argc != 3)\n\t\terrx(1, \"%s\", USAGE_STR);\n\n\tcfd = open(argv[1], O_RDONLY);\n\tif (cfd == -1)\n\t\terr(1, \"Cannot open %s\", argv[1]);\n\n\tret = snprintf(event_control_path, PATH_MAX, \"%s/cgroup.event_control\",\n\t\t\tdirname(argv[1]));\n\tif (ret >= PATH_MAX)\n\t\terrx(1, \"Path to cgroup.event_control is too long\");\n\n\tevent_control = open(event_control_path, O_WRONLY);\n\tif (event_control == -1)\n\t\terr(1, \"Cannot open %s\", event_control_path);\n\n\tefd = eventfd(0, 0);\n\tif (efd == -1)\n\t\terr(1, \"eventfd() failed\");\n\n\tret = snprintf(line, LINE_MAX, \"%d %d %s\", efd, cfd, argv[2]);\n\tif (ret >= LINE_MAX)\n\t\terrx(1, \"Arguments string is too long\");\n\n\tret = write(event_control, line, strlen(line) + 1);\n\tif (ret == -1)\n\t\terr(1, \"Cannot write to cgroup.event_control\");\n\n\twhile (1) {\n\t\tuint64_t result;\n\n\t\tret = read(efd, &result, sizeof(result));\n\t\tif (ret == -1) {\n\t\t\tif (errno == EINTR)\n\t\t\t\tcontinue;\n\t\t\terr(1, \"Cannot read from eventfd\");\n\t\t}\n\t\tassert(ret == sizeof(result));\n\n\t\tret = access(event_control_path, W_OK);\n\t\tif ((ret == -1) && (errno == ENOENT)) {\n\t\t\tputs(\"The cgroup seems to have removed.\");\n\t\t\tbreak;\n\t\t}\n\n\t\tif (ret == -1)\n\t\t\terr(1, \"cgroup.event_control is not accessible any more\");\n\n\t\tprintf(\"%s %s: crossed\\n\", argv[1], argv[2]);\n\t}\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}