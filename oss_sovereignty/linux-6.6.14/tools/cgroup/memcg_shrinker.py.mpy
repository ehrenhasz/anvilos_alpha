{
  "module_name": "memcg_shrinker.py",
  "hash_id": "82fc63bc452c863780ee5583243060c0961b3e93710986b71d2ad0d2b9b460f7",
  "original_prompt": "Ingested from linux-6.6.14/tools/cgroup/memcg_shrinker.py",
  "human_readable_source": "#!/usr/bin/env python3\n#\n# Copyright (C) 2022 Roman Gushchin <roman.gushchin@linux.dev>\n# Copyright (C) 2022 Meta\n\nimport os\nimport argparse\n\n\ndef scan_cgroups(cgroup_root):\n    cgroups = {}\n\n    for root, subdirs, _ in os.walk(cgroup_root):\n        for cgroup in subdirs:\n            path = os.path.join(root, cgroup)\n            ino = os.stat(path).st_ino\n            cgroups[ino] = path\n\n    # (memcg ino, path)\n    return cgroups\n\n\ndef scan_shrinkers(shrinker_debugfs):\n    shrinkers = []\n\n    for root, subdirs, _ in os.walk(shrinker_debugfs):\n        for shrinker in subdirs:\n            count_path = os.path.join(root, shrinker, \"count\")\n            with open(count_path) as f:\n                for line in f.readlines():\n                    items = line.split(' ')\n                    ino = int(items[0])\n                    # (count, shrinker, memcg ino)\n                    shrinkers.append((int(items[1]), shrinker, ino))\n    return shrinkers\n\n\ndef main():\n    parser = argparse.ArgumentParser(description='Display biggest shrinkers')\n    parser.add_argument('-n', '--lines', type=int, help='Number of lines to print')\n\n    args = parser.parse_args()\n\n    cgroups = scan_cgroups(\"/sys/fs/cgroup/\")\n    shrinkers = scan_shrinkers(\"/sys/kernel/debug/shrinker/\")\n    shrinkers.sort(reverse = True, key = lambda x: x[0])\n\n    n = 0\n    for s in shrinkers:\n        count, name, ino = (s[0], s[1], s[2])\n        if count == 0:\n            break\n\n        if ino == 0 or ino == 1:\n            cg = \"/\"\n        else:\n            try:\n                cg = cgroups[ino]\n            except KeyError:\n                cg = \"unknown (%d)\" % ino\n\n        print(\"%-8s %-20s %s\" % (count, name, cg))\n\n        n += 1\n        if args.lines and n >= args.lines:\n            break\n\n\nif __name__ == '__main__':\n    main()\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}