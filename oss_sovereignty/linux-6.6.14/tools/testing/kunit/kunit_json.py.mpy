{
  "module_name": "kunit_json.py",
  "hash_id": "21b0dfeccfdfe7df1ac121cdd705138f97f16fbc49ecf71b552c91d9e020c021",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/kunit/kunit_json.py",
  "human_readable_source": "# SPDX-License-Identifier: GPL-2.0\n#\n# Generates JSON from KUnit results according to\n# KernelCI spec: https://github.com/kernelci/kernelci-doc/wiki/Test-API\n#\n# Copyright (C) 2020, Google LLC.\n# Author: Heidi Fahim <heidifahim@google.com>\n\nfrom dataclasses import dataclass\nimport json\nfrom typing import Any, Dict\n\nfrom kunit_parser import Test, TestStatus\n\n@dataclass\nclass Metadata:\n\t\"\"\"Stores metadata about this run to include in get_json_result().\"\"\"\n\tarch: str = ''\n\tdef_config: str = ''\n\tbuild_dir: str = ''\n\nJsonObj = Dict[str, Any]\n\n_status_map: Dict[TestStatus, str] = {\n\tTestStatus.SUCCESS: \"PASS\",\n\tTestStatus.SKIPPED: \"SKIP\",\n\tTestStatus.TEST_CRASHED: \"ERROR\",\n}\n\ndef _get_group_json(test: Test, common_fields: JsonObj) -> JsonObj:\n\tsub_groups = []  # List[JsonObj]\n\ttest_cases = []  # List[JsonObj]\n\n\tfor subtest in test.subtests:\n\t\tif subtest.subtests:\n\t\t\tsub_group = _get_group_json(subtest, common_fields)\n\t\t\tsub_groups.append(sub_group)\n\t\t\tcontinue\n\t\tstatus = _status_map.get(subtest.status, \"FAIL\")\n\t\ttest_cases.append({\"name\": subtest.name, \"status\": status})\n\n\ttest_group = {\n\t\t\"name\": test.name,\n\t\t\"sub_groups\": sub_groups,\n\t\t\"test_cases\": test_cases,\n\t}\n\ttest_group.update(common_fields)\n\treturn test_group\n\ndef get_json_result(test: Test, metadata: Metadata) -> str:\n\tcommon_fields = {\n\t\t\"arch\": metadata.arch,\n\t\t\"defconfig\": metadata.def_config,\n\t\t\"build_environment\": metadata.build_dir,\n\t\t\"lab_name\": None,\n\t\t\"kernel\": None,\n\t\t\"job\": None,\n\t\t\"git_branch\": \"kselftest\",\n\t}\n\n\ttest_group = _get_group_json(test, common_fields)\n\ttest_group[\"name\"] = \"KUnit Test Group\"\n\treturn json.dumps(test_group, indent=4)\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}