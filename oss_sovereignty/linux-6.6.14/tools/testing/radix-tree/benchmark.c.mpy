{
  "module_name": "benchmark.c",
  "hash_id": "ae1ae87494bfaf7ed5d0eb3d6f33574bb4d480781c6ae512d5afc63a45399b0f",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/radix-tree/benchmark.c",
  "human_readable_source": "\n \n#include <linux/radix-tree.h>\n#include <linux/slab.h>\n#include <linux/errno.h>\n#include <time.h>\n#include \"test.h\"\n\n#define NSEC_PER_SEC\t1000000000L\n\nstatic long long benchmark_iter(struct radix_tree_root *root, bool tagged)\n{\n\tvolatile unsigned long sink = 0;\n\tstruct radix_tree_iter iter;\n\tstruct timespec start, finish;\n\tlong long nsec;\n\tint l, loops = 1;\n\tvoid **slot;\n\n#ifdef BENCHMARK\nagain:\n#endif\n\tclock_gettime(CLOCK_MONOTONIC, &start);\n\tfor (l = 0; l < loops; l++) {\n\t\tif (tagged) {\n\t\t\tradix_tree_for_each_tagged(slot, root, &iter, 0, 0)\n\t\t\t\tsink ^= (unsigned long)slot;\n\t\t} else {\n\t\t\tradix_tree_for_each_slot(slot, root, &iter, 0)\n\t\t\t\tsink ^= (unsigned long)slot;\n\t\t}\n\t}\n\tclock_gettime(CLOCK_MONOTONIC, &finish);\n\n\tnsec = (finish.tv_sec - start.tv_sec) * NSEC_PER_SEC +\n\t       (finish.tv_nsec - start.tv_nsec);\n\n#ifdef BENCHMARK\n\tif (loops == 1 && nsec * 5 < NSEC_PER_SEC) {\n\t\tloops = NSEC_PER_SEC / nsec / 4 + 1;\n\t\tgoto again;\n\t}\n#endif\n\n\tnsec /= loops;\n\treturn nsec;\n}\n\nstatic void benchmark_insert(struct radix_tree_root *root,\n\t\t\t     unsigned long size, unsigned long step)\n{\n\tstruct timespec start, finish;\n\tunsigned long index;\n\tlong long nsec;\n\n\tclock_gettime(CLOCK_MONOTONIC, &start);\n\n\tfor (index = 0 ; index < size ; index += step)\n\t\titem_insert(root, index);\n\n\tclock_gettime(CLOCK_MONOTONIC, &finish);\n\n\tnsec = (finish.tv_sec - start.tv_sec) * NSEC_PER_SEC +\n\t       (finish.tv_nsec - start.tv_nsec);\n\n\tprintv(2, \"Size: %8ld, step: %8ld, insertion: %15lld ns\\n\",\n\t\tsize, step, nsec);\n}\n\nstatic void benchmark_tagging(struct radix_tree_root *root,\n\t\t\t     unsigned long size, unsigned long step)\n{\n\tstruct timespec start, finish;\n\tunsigned long index;\n\tlong long nsec;\n\n\tclock_gettime(CLOCK_MONOTONIC, &start);\n\n\tfor (index = 0 ; index < size ; index += step)\n\t\tradix_tree_tag_set(root, index, 0);\n\n\tclock_gettime(CLOCK_MONOTONIC, &finish);\n\n\tnsec = (finish.tv_sec - start.tv_sec) * NSEC_PER_SEC +\n\t       (finish.tv_nsec - start.tv_nsec);\n\n\tprintv(2, \"Size: %8ld, step: %8ld, tagging: %17lld ns\\n\",\n\t\tsize, step, nsec);\n}\n\nstatic void benchmark_delete(struct radix_tree_root *root,\n\t\t\t     unsigned long size, unsigned long step)\n{\n\tstruct timespec start, finish;\n\tunsigned long index;\n\tlong long nsec;\n\n\tclock_gettime(CLOCK_MONOTONIC, &start);\n\n\tfor (index = 0 ; index < size ; index += step)\n\t\titem_delete(root, index);\n\n\tclock_gettime(CLOCK_MONOTONIC, &finish);\n\n\tnsec = (finish.tv_sec - start.tv_sec) * NSEC_PER_SEC +\n\t       (finish.tv_nsec - start.tv_nsec);\n\n\tprintv(2, \"Size: %8ld, step: %8ld, deletion: %16lld ns\\n\",\n\t\tsize, step, nsec);\n}\n\nstatic void benchmark_size(unsigned long size, unsigned long step)\n{\n\tRADIX_TREE(tree, GFP_KERNEL);\n\tlong long normal, tagged;\n\n\tbenchmark_insert(&tree, size, step);\n\tbenchmark_tagging(&tree, size, step);\n\n\ttagged = benchmark_iter(&tree, true);\n\tnormal = benchmark_iter(&tree, false);\n\n\tprintv(2, \"Size: %8ld, step: %8ld, tagged iteration: %8lld ns\\n\",\n\t\tsize, step, tagged);\n\tprintv(2, \"Size: %8ld, step: %8ld, normal iteration: %8lld ns\\n\",\n\t\tsize, step, normal);\n\n\tbenchmark_delete(&tree, size, step);\n\n\titem_kill_tree(&tree);\n\trcu_barrier();\n}\n\nvoid benchmark(void)\n{\n\tunsigned long size[] = {1 << 10, 1 << 20, 0};\n\tunsigned long step[] = {1, 2, 7, 15, 63, 64, 65,\n\t\t\t\t128, 256, 512, 12345, 0};\n\tint c, s;\n\n\tprintv(1, \"starting benchmarks\\n\");\n\tprintv(1, \"RADIX_TREE_MAP_SHIFT = %d\\n\", RADIX_TREE_MAP_SHIFT);\n\n\tfor (c = 0; size[c]; c++)\n\t\tfor (s = 0; step[s]; s++)\n\t\t\tbenchmark_size(size[c], step[s]);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}