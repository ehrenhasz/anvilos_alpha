{
  "module_name": "regression2.c",
  "hash_id": "f5c4f049274af63c47eb6141ea39ef3feb256be204f12c0bcd25011f4bc2a764",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/radix-tree/regression2.c",
  "human_readable_source": "\n \n#include <linux/kernel.h>\n#include <linux/gfp.h>\n#include <linux/slab.h>\n#include <linux/radix-tree.h>\n#include <stdlib.h>\n#include <stdio.h>\n\n#include \"regression.h\"\n#include \"test.h\"\n\n#define PAGECACHE_TAG_DIRTY     XA_MARK_0\n#define PAGECACHE_TAG_WRITEBACK XA_MARK_1\n#define PAGECACHE_TAG_TOWRITE   XA_MARK_2\n\nstatic RADIX_TREE(mt_tree, GFP_KERNEL);\nunsigned long page_count = 0;\n\nstruct page {\n\tunsigned long index;\n};\n\nstatic struct page *page_alloc(void)\n{\n\tstruct page *p;\n\tp = malloc(sizeof(struct page));\n\tp->index = page_count++;\n\n\treturn p;\n}\n\nvoid regression2_test(void)\n{\n\tint i;\n\tstruct page *p;\n\tint max_slots = RADIX_TREE_MAP_SIZE;\n\tunsigned long int start, end;\n\tstruct page *pages[1];\n\n\tprintv(1, \"running regression test 2 (should take milliseconds)\\n\");\n\t \n\tfor (i = 0; i <= max_slots - 1; i++) {\n\t\tp = page_alloc();\n\t\tradix_tree_insert(&mt_tree, i, p);\n\t}\n\tradix_tree_tag_set(&mt_tree, max_slots - 1, PAGECACHE_TAG_DIRTY);\n\n\t \n\tstart = 0;\n\tend = max_slots - 2;\n\ttag_tagged_items(&mt_tree, start, end, 1,\n\t\t\t\tPAGECACHE_TAG_DIRTY, PAGECACHE_TAG_TOWRITE);\n\n\t \n\tp = page_alloc();\n\tradix_tree_insert(&mt_tree, max_slots, p);\n\n\t \n\tradix_tree_tag_clear(&mt_tree, max_slots - 1, PAGECACHE_TAG_DIRTY);\n\n\t \n\tfor (i = max_slots - 1; i >= 0; i--)\n\t\tfree(radix_tree_delete(&mt_tree, i));\n\n\t \n\t\n\t\n\tstart = 1;\n\tend = max_slots - 2;\n\tradix_tree_gang_lookup_tag_slot(&mt_tree, (void ***)pages, start, end,\n\t\tPAGECACHE_TAG_TOWRITE);\n\n\t \n\tfree(radix_tree_delete(&mt_tree, max_slots));\n\n\tBUG_ON(!radix_tree_empty(&mt_tree));\n\n\tprintv(1, \"regression test 2, done\\n\");\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}