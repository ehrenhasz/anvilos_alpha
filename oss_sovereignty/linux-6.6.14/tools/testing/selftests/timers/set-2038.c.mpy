{
  "module_name": "set-2038.c",
  "hash_id": "53cd0fec5896c81776ad763051ecd5a442843a1ed119fb39b07c846acb33d35d",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/timers/set-2038.c",
  "human_readable_source": " \n\n#include <stdio.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/time.h>\n#include \"../kselftest.h\"\n\n#define NSEC_PER_SEC 1000000000LL\n\n#define KTIME_MAX\t((long long)~((unsigned long long)1 << 63))\n#define KTIME_SEC_MAX\t(KTIME_MAX / NSEC_PER_SEC)\n\n#define YEAR_1901 (-0x7fffffffL)\n#define YEAR_1970 1\n#define YEAR_2038 0x7fffffffL\t\t\t \n#define YEAR_2262 KTIME_SEC_MAX\t\t\t \n#define YEAR_MAX  ((long long)((1ULL<<63)-1))\t \n\nint is32bits(void)\n{\n\treturn (sizeof(long) == 4);\n}\n\nint settime(long long time)\n{\n\tstruct timeval now;\n\tint ret;\n\n\tnow.tv_sec = (time_t)time;\n\tnow.tv_usec  = 0;\n\n\tret = settimeofday(&now, NULL);\n\n\tprintf(\"Setting time to 0x%lx: %d\\n\", (long)time, ret);\n\treturn ret;\n}\n\nint do_tests(void)\n{\n\tint ret;\n\n\tret = system(\"date\");\n\tret = system(\"./inconsistency-check -c 0 -t 20\");\n\tret |= system(\"./nanosleep\");\n\tret |= system(\"./nsleep-lat\");\n\treturn ret;\n\n}\n\nint main(int argc, char *argv[])\n{\n\tint ret = 0;\n\tint opt, dangerous = 0;\n\ttime_t start;\n\n\t \n\twhile ((opt = getopt(argc, argv, \"d\")) != -1) {\n\t\tswitch (opt) {\n\t\tcase 'd':\n\t\t\tdangerous = 1;\n\t\t}\n\t}\n\n\tstart = time(0);\n\n\t \n\tif (!settime(YEAR_1901)) {\n\t\tret = -1;\n\t\tgoto out;\n\t}\n\tif (!settime(YEAR_MAX)) {\n\t\tret = -1;\n\t\tgoto out;\n\t}\n\tif (!is32bits() && !settime(YEAR_2262)) {\n\t\tret = -1;\n\t\tgoto out;\n\t}\n\n\t \n\tsettime(YEAR_1970);\n\tret = do_tests();\n\tif (ret)\n\t\tgoto out;\n\n\tsettime(YEAR_2038 - 600);\n\tret = do_tests();\n\tif (ret)\n\t\tgoto out;\n\n\t \n\tif (is32bits() && !dangerous)\n\t\tgoto out;\n\t \n\tsettime(YEAR_2038 - 10);\n\tret = do_tests();\n\tif (ret)\n\t\tgoto out;\n\n\tsettime(YEAR_2262 - 600);\n\tret = do_tests();\n\nout:\n\t \n\tsettime(start);\n\tif (ret)\n\t\treturn ksft_exit_fail();\n\treturn ksft_exit_pass();\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}