{
  "module_name": "sync_stress_parallelism.c",
  "hash_id": "86db9207363964660e0275e7c480f1a5595abe63975ba7652284f6611ee7dc98",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/sync/sync_stress_parallelism.c",
  "human_readable_source": " \n\n#include <pthread.h>\n\n#include \"sync.h\"\n#include \"sw_sync.h\"\n#include \"synctest.h\"\n\nstatic struct {\n\tint iterations;\n\tint timeline;\n\tint counter;\n} test_data_two_threads;\n\nstatic int test_stress_two_threads_shared_timeline_thread(void *d)\n{\n\tint thread_id = (long)d;\n\tint timeline = test_data_two_threads.timeline;\n\tint iterations = test_data_two_threads.iterations;\n\tint fence, valid, ret, i;\n\n\tfor (i = 0; i < iterations; i++) {\n\t\tfence = sw_sync_fence_create(timeline, \"fence\",\n\t\t\t\t\t     i * 2 + thread_id);\n\t\tvalid = sw_sync_fence_is_valid(fence);\n\t\tASSERT(valid, \"Failure allocating fence\\n\");\n\n\t\t \n\t\tret = sync_wait(fence, -1);\n\t\tASSERT(ret > 0, \"Problem occurred on prior thread\\n\");\n\n\t\t \n\t\tASSERT(test_data_two_threads.counter == i * 2 + thread_id,\n\t\t       \"Counter got damaged!\\n\");\n\t\ttest_data_two_threads.counter++;\n\n\t\t \n\t\tret = sw_sync_timeline_inc(timeline, 1);\n\t\tASSERT(ret == 0, \"Advancing timeline failed\\n\");\n\n\t\tsw_sync_fence_destroy(fence);\n\t}\n\n\treturn 0;\n}\n\nint test_stress_two_threads_shared_timeline(void)\n{\n\tpthread_t a, b;\n\tint valid;\n\tint timeline = sw_sync_timeline_create();\n\n\tvalid = sw_sync_timeline_is_valid(timeline);\n\tASSERT(valid, \"Failure allocating timeline\\n\");\n\n\ttest_data_two_threads.iterations = 1 << 16;\n\ttest_data_two_threads.counter = 0;\n\ttest_data_two_threads.timeline = timeline;\n\n\t \n\n\tpthread_create(&a, NULL, (void *(*)(void *))\n\t\t       test_stress_two_threads_shared_timeline_thread,\n\t\t       (void *)0);\n\tpthread_create(&b, NULL, (void *(*)(void *))\n\t\t       test_stress_two_threads_shared_timeline_thread,\n\t\t       (void *)1);\n\n\tpthread_join(a, NULL);\n\tpthread_join(b, NULL);\n\n\t \n\tASSERT(test_data_two_threads.counter ==\n\t       test_data_two_threads.iterations * 2,\n\t       \"Counter has unexpected value\\n\");\n\n\tsw_sync_timeline_destroy(timeline);\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}