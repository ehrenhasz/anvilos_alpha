{
  "module_name": "sync_test.c",
  "hash_id": "a86f89744cb3ad5d28adaa460b7936ac2d26edd9f1b1745b12b2c3306599c0c1",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/sync/sync_test.c",
  "human_readable_source": " \n\n#include <stdio.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <errno.h>\n#include <string.h>\n\n#include \"../kselftest.h\"\n#include \"synctest.h\"\n\nstatic int run_test(int (*test)(void), char *name)\n{\n\tint result;\n\tpid_t childpid;\n\tint ret;\n\n\tfflush(stdout);\n\tchildpid = fork();\n\n\tif (childpid) {\n\t\twaitpid(childpid, &result, 0);\n\t\tif (WIFEXITED(result)) {\n\t\t\tret = WEXITSTATUS(result);\n\t\t\tif (!ret)\n\t\t\t\tksft_test_result_pass(\"[RUN]\\t%s\\n\", name);\n\t\t\telse\n\t\t\t\tksft_test_result_fail(\"[RUN]\\t%s\\n\", name);\n\t\t\treturn ret;\n\t\t}\n\t\treturn 1;\n\t}\n\n\texit(test());\n}\n\nstatic void sync_api_supported(void)\n{\n\tstruct stat sbuf;\n\tint ret;\n\n\tret = stat(\"/sys/kernel/debug/sync/sw_sync\", &sbuf);\n\tif (!ret)\n\t\treturn;\n\n\tif (errno == ENOENT)\n\t\tksft_exit_skip(\"Sync framework not supported by kernel\\n\");\n\n\tif (errno == EACCES)\n\t\tksft_exit_skip(\"Run Sync test as root.\\n\");\n\n\tksft_exit_fail_msg(\"stat failed on /sys/kernel/debug/sync/sw_sync: %s\",\n\t\t\t\tstrerror(errno));\n}\n\nint main(void)\n{\n\tint err;\n\n\tksft_print_header();\n\n\tsync_api_supported();\n\tksft_set_plan(3 + 7);\n\n\tksft_print_msg(\"[RUN]\\tTesting sync framework\\n\");\n\n\tRUN_TEST(test_alloc_timeline);\n\tRUN_TEST(test_alloc_fence);\n\tRUN_TEST(test_alloc_fence_negative);\n\n\tRUN_TEST(test_fence_one_timeline_wait);\n\tRUN_TEST(test_fence_one_timeline_merge);\n\tRUN_TEST(test_fence_merge_same_fence);\n\tRUN_TEST(test_fence_multi_timeline_wait);\n\tRUN_TEST(test_stress_two_threads_shared_timeline);\n\tRUN_TEST(test_consumer_stress_multi_producer_single_consumer);\n\tRUN_TEST(test_merge_stress_random_merge);\n\n\terr = ksft_get_fail_cnt();\n\tif (err)\n\t\tksft_exit_fail_msg(\"%d out of %d sync tests failed\\n\",\n\t\t\t\t\terr, ksft_test_num());\n\n\t \n\treturn ksft_exit_pass();\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}