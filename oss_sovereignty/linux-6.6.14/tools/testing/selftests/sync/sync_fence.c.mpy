{
  "module_name": "sync_fence.c",
  "hash_id": "095911b7387eda18cd30dbbd9f3bb19cfe9711a9e4fa8f5785d7a72d4a4b4cd0",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/sync/sync_fence.c",
  "human_readable_source": " \n\n#include \"sync.h\"\n#include \"sw_sync.h\"\n#include \"synctest.h\"\n\nint test_fence_one_timeline_wait(void)\n{\n\tint fence, valid, ret;\n\tint timeline = sw_sync_timeline_create();\n\n\tvalid = sw_sync_timeline_is_valid(timeline);\n\tASSERT(valid, \"Failure allocating timeline\\n\");\n\n\tfence = sw_sync_fence_create(timeline, \"allocFence\", 5);\n\tvalid = sw_sync_fence_is_valid(fence);\n\tASSERT(valid, \"Failure allocating fence\\n\");\n\n\t \n\tret = sync_wait(fence, 0);\n\tASSERT(ret == 0, \"Failure waiting on fence until timeout\\n\");\n\n\t \n\tret = sw_sync_timeline_inc(timeline, 1);\n\tASSERT(ret == 0, \"Failure advancing timeline\\n\");\n\n\t \n\tret = sync_wait(fence, 0);\n\tASSERT(ret == 0, \"Failure waiting on fence until timeout\\n\");\n\n\t \n\tret = sw_sync_timeline_inc(timeline, 4);\n\tASSERT(ret == 0, \"Failure signaling the fence\\n\");\n\n\t \n\tret = sync_wait(fence, 0);\n\tASSERT(ret > 0, \"Failure waiting on fence\\n\");\n\n\t \n\tret = sw_sync_timeline_inc(timeline, 10);\n\tASSERT(ret == 0, \"Failure going further\\n\");\n\tret = sync_wait(fence, 0);\n\tASSERT(ret > 0, \"Failure waiting ahead\\n\");\n\n\tsw_sync_fence_destroy(fence);\n\tsw_sync_timeline_destroy(timeline);\n\n\treturn 0;\n}\n\nint test_fence_one_timeline_merge(void)\n{\n\tint a, b, c, d, valid;\n\tint timeline = sw_sync_timeline_create();\n\n\t \n\ta = sw_sync_fence_create(timeline, \"allocFence\", 1);\n\tb = sw_sync_fence_create(timeline, \"allocFence\", 2);\n\tc = sw_sync_fence_create(timeline, \"allocFence\", 3);\n\n\tvalid = sw_sync_fence_is_valid(a) &&\n\t\tsw_sync_fence_is_valid(b) &&\n\t\tsw_sync_fence_is_valid(c);\n\tASSERT(valid, \"Failure allocating fences\\n\");\n\n\td = sync_merge(\"mergeFence\", b, a);\n\td = sync_merge(\"mergeFence\", c, d);\n\tvalid = sw_sync_fence_is_valid(d);\n\tASSERT(valid, \"Failure merging fences\\n\");\n\n\t \n\tASSERT(sync_fence_count_with_status(a, FENCE_STATUS_ACTIVE) == 1,\n\t       \"a has too many active fences!\\n\");\n\tASSERT(sync_fence_count_with_status(a, FENCE_STATUS_ACTIVE) == 1,\n\t       \"b has too many active fences!\\n\");\n\tASSERT(sync_fence_count_with_status(a, FENCE_STATUS_ACTIVE) == 1,\n\t       \"c has too many active fences!\\n\");\n\tASSERT(sync_fence_count_with_status(a, FENCE_STATUS_ACTIVE) == 1,\n\t       \"d has too many active fences!\\n\");\n\n\t \n\tsw_sync_timeline_inc(timeline, 1);\n\tASSERT(sync_fence_count_with_status(a, FENCE_STATUS_SIGNALED) == 1,\n\t       \"a did not signal!\\n\");\n\tASSERT(sync_fence_count_with_status(d, FENCE_STATUS_ACTIVE) == 1,\n\t       \"d signaled too early!\\n\");\n\n\tsw_sync_timeline_inc(timeline, 1);\n\tASSERT(sync_fence_count_with_status(b, FENCE_STATUS_SIGNALED) == 1,\n\t       \"b did not signal!\\n\");\n\tASSERT(sync_fence_count_with_status(d, FENCE_STATUS_ACTIVE) == 1,\n\t       \"d signaled too early!\\n\");\n\n\tsw_sync_timeline_inc(timeline, 1);\n\tASSERT(sync_fence_count_with_status(c, FENCE_STATUS_SIGNALED) == 1,\n\t       \"c did not signal!\\n\");\n\tASSERT(sync_fence_count_with_status(d, FENCE_STATUS_ACTIVE) == 0 &&\n\t       sync_fence_count_with_status(d, FENCE_STATUS_SIGNALED) == 1,\n\t       \"d did not signal!\\n\");\n\n\tsw_sync_fence_destroy(d);\n\tsw_sync_fence_destroy(c);\n\tsw_sync_fence_destroy(b);\n\tsw_sync_fence_destroy(a);\n\tsw_sync_timeline_destroy(timeline);\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}