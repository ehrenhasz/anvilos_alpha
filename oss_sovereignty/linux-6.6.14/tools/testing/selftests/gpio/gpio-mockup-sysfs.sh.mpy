{
  "module_name": "gpio-mockup-sysfs.sh",
  "hash_id": "01da31a74acbda96d933af1c8ee2b762a0409ada5252255319128df818ce2394",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/gpio/gpio-mockup-sysfs.sh",
  "human_readable_source": "\n# SPDX-License-Identifier: GPL-2.0\n\n# Overrides functions in gpio-mockup.sh to test using the GPIO SYSFS uAPI\n\nSYSFS=`grep -w sysfs /proc/mounts | cut -f2 -d' '`\n[ -d \"$SYSFS\" ] || skip \"sysfs is not mounted\"\n\nGPIO_SYSFS=\"${SYSFS}/class/gpio\"\n[ -d \"$GPIO_SYSFS\" ] || skip \"CONFIG_GPIO_SYSFS is not selected\"\n\nPLATFORM_SYSFS=$SYSFS/devices/platform\n\nsysfs_nr=\nsysfs_ldir=\n\n# determine the sysfs GPIO number given the $chip and $offset\n# e.g. gpiochip1:32\nfind_sysfs_nr()\n{\n\t# e.g. /sys/devices/platform/gpio-mockup.1/gpiochip1\n\tlocal platform=$(find $PLATFORM_SYSFS -mindepth 2 -maxdepth 2 -type d -name $chip)\n\t[ \"$platform\" ] || fail \"can't find platform of $chip\"\n\t# e.g. /sys/devices/platform/gpio-mockup.1/gpio/gpiochip508/base\n\tlocal base=$(find ${platform%/*}/gpio/ -mindepth 2 -maxdepth 2 -type f -name base)\n\t[ \"$base\" ] || fail \"can't find base of $chip\"\n\tsysfs_nr=$(($(< \"$base\") + $offset))\n\tsysfs_ldir=\"$GPIO_SYSFS/gpio$sysfs_nr\"\n}\n\nacquire_line()\n{\n\t[ \"$sysfs_nr\" ] && return\n\tfind_sysfs_nr\n\techo \"$sysfs_nr\" > \"$GPIO_SYSFS/export\"\n}\n\n# The helpers being overridden...\nget_line()\n{\n\t[ -e \"$sysfs_ldir/value\" ] && echo $(< \"$sysfs_ldir/value\")\n}\n\nset_line()\n{\n\tacquire_line\n\n\tfor option in $*; do\n\t\tcase $option in\n\t\tactive-high)\n\t\t\techo 0 > \"$sysfs_ldir/active_low\"\n\t\t\t;;\n\t\tactive-low)\n\t\t\techo 1 > \"$sysfs_ldir/active_low\"\n\t\t\t;;\n\t\tinput)\n\t\t\techo \"in\" > \"$sysfs_ldir/direction\"\n\t\t\t;;\n\t\t0)\n\t\t\techo \"out\" > \"$sysfs_ldir/direction\"\n\t\t\techo 0 > \"$sysfs_ldir/value\"\n\t\t\t;;\n\t\t1)\n\t\t\techo \"out\" > \"$sysfs_ldir/direction\"\n\t\t\techo 1 > \"$sysfs_ldir/value\"\n\t\t\t;;\n\t\tesac\n\tdone\n}\n\nrelease_line()\n{\n\t[ \"$sysfs_nr\" ] || return 0\n\techo \"$sysfs_nr\" > \"$GPIO_SYSFS/unexport\"\n\tsysfs_nr=\n\tsysfs_ldir=\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}