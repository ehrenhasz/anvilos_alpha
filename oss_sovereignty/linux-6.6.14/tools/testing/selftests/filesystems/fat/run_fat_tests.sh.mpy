{
  "module_name": "run_fat_tests.sh",
  "hash_id": "2bcd5c225792ee55f4fecb23f082264f3234cb7f5501f31defd2563d6abb38d9",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/filesystems/fat/run_fat_tests.sh",
  "human_readable_source": "#!/bin/bash\n# SPDX-License-Identifier: GPL-2.0\n#\n# Run filesystem operations tests on an 1 MiB disk image that is formatted with\n# a vfat filesystem and mounted in a temporary directory using a loop device.\n#\n# Copyright 2022 Red Hat Inc.\n# Author: Javier Martinez Canillas <javierm@redhat.com>\n\nset -e\nset -u\nset -o pipefail\n\nBASE_DIR=\"$(dirname $0)\"\nTMP_DIR=\"$(mktemp -d /tmp/fat_tests_tmp.XXXXXX)\"\nIMG_PATH=\"${TMP_DIR}/fat.img\"\nMNT_PATH=\"${TMP_DIR}/mnt\"\n\ncleanup()\n{\n    mountpoint -q \"${MNT_PATH}\" && unmount_image\n    rm -rf \"${TMP_DIR}\"\n}\ntrap cleanup SIGINT SIGTERM EXIT\n\ncreate_loopback()\n{\n    touch \"${IMG_PATH}\"\n    chattr +C \"${IMG_PATH}\" >/dev/null 2>&1 || true\n\n    truncate -s 1M \"${IMG_PATH}\"\n    mkfs.vfat \"${IMG_PATH}\" >/dev/null 2>&1\n}\n\nmount_image()\n{\n    mkdir -p \"${MNT_PATH}\"\n    sudo mount -o loop \"${IMG_PATH}\" \"${MNT_PATH}\"\n}\n\nrename_exchange_test()\n{\n    local rename_exchange=\"${BASE_DIR}/rename_exchange\"\n    local old_path=\"${MNT_PATH}/old_file\"\n    local new_path=\"${MNT_PATH}/new_file\"\n\n    echo old | sudo tee \"${old_path}\" >/dev/null 2>&1\n    echo new | sudo tee \"${new_path}\" >/dev/null 2>&1\n    sudo \"${rename_exchange}\" \"${old_path}\" \"${new_path}\" >/dev/null 2>&1\n    sudo sync -f \"${MNT_PATH}\"\n    grep new \"${old_path}\" >/dev/null 2>&1\n    grep old \"${new_path}\" >/dev/null 2>&1\n}\n\nrename_exchange_subdir_test()\n{\n    local rename_exchange=\"${BASE_DIR}/rename_exchange\"\n    local dir_path=\"${MNT_PATH}/subdir\"\n    local old_path=\"${MNT_PATH}/old_file\"\n    local new_path=\"${dir_path}/new_file\"\n\n    sudo mkdir -p \"${dir_path}\"\n    echo old | sudo tee \"${old_path}\" >/dev/null 2>&1\n    echo new | sudo tee \"${new_path}\" >/dev/null 2>&1\n    sudo \"${rename_exchange}\" \"${old_path}\" \"${new_path}\" >/dev/null 2>&1\n    sudo sync -f \"${MNT_PATH}\"\n    grep new \"${old_path}\" >/dev/null 2>&1\n    grep old \"${new_path}\" >/dev/null 2>&1\n}\n\nunmount_image()\n{\n    sudo umount \"${MNT_PATH}\" &> /dev/null\n}\n\ncreate_loopback\nmount_image\nrename_exchange_test\nrename_exchange_subdir_test\nunmount_image\n\nexit 0\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}