{
  "module_name": "udmabuf.c",
  "hash_id": "fce20bac23ea7c3cea2096eeb56d598c1a6e125dd753753fd7c075a79b66e4b7",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/drivers/dma-buf/udmabuf.c",
  "human_readable_source": "\n#define _GNU_SOURCE\n#define __EXPORTED_HEADERS__\n\n#include <stdio.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <string.h>\n#include <errno.h>\n#include <fcntl.h>\n#include <malloc.h>\n\n#include <sys/ioctl.h>\n#include <sys/syscall.h>\n#include <linux/memfd.h>\n#include <linux/udmabuf.h>\n\n#define TEST_PREFIX\t\"drivers/dma-buf/udmabuf\"\n#define NUM_PAGES       4\n\nstatic int memfd_create(const char *name, unsigned int flags)\n{\n\treturn syscall(__NR_memfd_create, name, flags);\n}\n\nint main(int argc, char *argv[])\n{\n\tstruct udmabuf_create create;\n\tint devfd, memfd, buf, ret;\n\toff_t size;\n\tvoid *mem;\n\n\tdevfd = open(\"/dev/udmabuf\", O_RDWR);\n\tif (devfd < 0) {\n\t\tprintf(\"%s: [skip,no-udmabuf: Unable to access DMA buffer device file]\\n\",\n\t\t       TEST_PREFIX);\n\t\texit(77);\n\t}\n\n\tmemfd = memfd_create(\"udmabuf-test\", MFD_ALLOW_SEALING);\n\tif (memfd < 0) {\n\t\tprintf(\"%s: [skip,no-memfd]\\n\", TEST_PREFIX);\n\t\texit(77);\n\t}\n\n\tret = fcntl(memfd, F_ADD_SEALS, F_SEAL_SHRINK);\n\tif (ret < 0) {\n\t\tprintf(\"%s: [skip,fcntl-add-seals]\\n\", TEST_PREFIX);\n\t\texit(77);\n\t}\n\n\n\tsize = getpagesize() * NUM_PAGES;\n\tret = ftruncate(memfd, size);\n\tif (ret == -1) {\n\t\tprintf(\"%s: [FAIL,memfd-truncate]\\n\", TEST_PREFIX);\n\t\texit(1);\n\t}\n\n\tmemset(&create, 0, sizeof(create));\n\n\t \n\tcreate.memfd  = memfd;\n\tcreate.offset = getpagesize()/2;\n\tcreate.size   = getpagesize();\n\tbuf = ioctl(devfd, UDMABUF_CREATE, &create);\n\tif (buf >= 0) {\n\t\tprintf(\"%s: [FAIL,test-1]\\n\", TEST_PREFIX);\n\t\texit(1);\n\t}\n\n\t \n\tcreate.memfd  = memfd;\n\tcreate.offset = 0;\n\tcreate.size   = getpagesize()/2;\n\tbuf = ioctl(devfd, UDMABUF_CREATE, &create);\n\tif (buf >= 0) {\n\t\tprintf(\"%s: [FAIL,test-2]\\n\", TEST_PREFIX);\n\t\texit(1);\n\t}\n\n\t \n\tcreate.memfd  = 0;  \n\tcreate.offset = 0;\n\tcreate.size   = size;\n\tbuf = ioctl(devfd, UDMABUF_CREATE, &create);\n\tif (buf >= 0) {\n\t\tprintf(\"%s: [FAIL,test-3]\\n\", TEST_PREFIX);\n\t\texit(1);\n\t}\n\n\t \n\tcreate.memfd  = memfd;\n\tcreate.offset = 0;\n\tcreate.size   = size;\n\tbuf = ioctl(devfd, UDMABUF_CREATE, &create);\n\tif (buf < 0) {\n\t\tprintf(\"%s: [FAIL,test-4]\\n\", TEST_PREFIX);\n\t\texit(1);\n\t}\n\n\tfprintf(stderr, \"%s: ok\\n\", TEST_PREFIX);\n\tclose(buf);\n\tclose(memfd);\n\tclose(devfd);\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}