{
  "module_name": "usbip_test.sh",
  "hash_id": "04b73d241060ac753cc8bb74f5e4000d24c5da55843a860ce4162860893605a0",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/drivers/usb/usbip/usbip_test.sh",
  "human_readable_source": "#!/bin/bash\n# SPDX-License-Identifier: GPL-2.0\n\n# Kselftest framework requirement - SKIP code is 4.\nksft_skip=4\n\nusage() { echo \"usbip_test.sh -b <busid> -p <usbip tools path>\"; exit 1; }\n\nwhile getopts \"h:b:p:\" arg; do\n    case \"${arg}\" in\n\th)\n\t    usage\n\t    ;;\n\tb)\n\t    busid=${OPTARG}\n\t    ;;\n\tp)\n\t    tools_path=${OPTARG}\n\t    ;;\n\t*)\n\t    usage\n\t    ;;\n    esac\ndone\nshift $((OPTIND-1))\n\nif [ -z \"${busid}\" ]; then\n\tusage\nfi\n\necho \"Running USB over IP Testing on $busid\";\n\ntest_end_msg=\"End of USB over IP Testing on $busid\"\n\nif [ $UID != 0 ]; then\n\techo \"Please run usbip_test as root [SKIP]\"\n\techo $test_end_msg\n\texit $ksft_skip\nfi\n\necho \"Load usbip_host module\"\nif ! /sbin/modprobe -q -n usbip_host; then\n\techo \"usbip_test: module usbip_host is not found [SKIP]\"\n\techo $test_end_msg\n\texit $ksft_skip\nfi\n\nif /sbin/modprobe -q usbip_host; then\n\techo \"usbip_test: module usbip_host is loaded [OK]\"\nelse\n\techo \"usbip_test: module usbip_host failed to load [FAIL]\"\n\techo $test_end_msg\n\texit 1\nfi\n\necho \"Load vhci_hcd module\"\nif /sbin/modprobe -q vhci_hcd; then\n\techo \"usbip_test: module vhci_hcd is loaded [OK]\"\nelse\n\techo \"usbip_test: module vhci_hcd failed to load [FAIL]\"\n\techo $test_end_msg\n\texit 1\nfi\necho \"==============================================================\"\n\ncd $tools_path;\n\nif [ ! -f src/usbip ]; then\n\techo \"Please build usbip tools\"\n\techo $test_end_msg\n\texit $ksft_skip\nfi\n\necho \"Expect to see export-able devices\";\nsrc/usbip list -l;\necho \"==============================================================\"\n\necho \"Run lsusb to see all usb devices\"\nlsusb -t;\necho \"==============================================================\"\n\nsrc/usbipd -D;\n\necho \"Get exported devices from localhost - expect to see none\";\nsrc/usbip list -r localhost;\necho \"==============================================================\"\n\necho \"bind devices\";\nsrc/usbip bind -b $busid;\necho \"==============================================================\"\n\necho \"Run lsusb - bound devices should be under usbip_host control\"\nlsusb -t;\necho \"==============================================================\"\n\necho \"bind devices - expect already bound messages\"\nsrc/usbip bind -b $busid;\necho \"==============================================================\"\n\necho \"Get exported devices from localhost - expect to see exported devices\";\nsrc/usbip list -r localhost;\necho \"==============================================================\"\n\necho \"unbind devices\";\nsrc/usbip unbind -b $busid;\necho \"==============================================================\"\n\necho \"Run lsusb - bound devices should be rebound to original drivers\"\nlsusb -t;\necho \"==============================================================\"\n\necho \"unbind devices - expect no devices bound message\";\nsrc/usbip unbind -b $busid;\necho \"==============================================================\"\n\necho \"Get exported devices from localhost - expect to see none\";\nsrc/usbip list -r localhost;\necho \"==============================================================\"\n\necho \"List imported devices - expect to see none\";\nsrc/usbip port;\necho \"==============================================================\"\n\necho \"Import devices from localhost - should fail with no devices\"\nsrc/usbip attach -r localhost -b $busid;\necho \"==============================================================\"\n\necho \"bind devices\";\nsrc/usbip bind -b $busid;\necho \"==============================================================\"\n\necho \"List imported devices - expect to see exported devices\";\nsrc/usbip list -r localhost;\necho \"==============================================================\"\n\necho \"List imported devices - expect to see none\";\nsrc/usbip port;\necho \"==============================================================\"\n\necho \"Import devices from localhost - should work\"\nsrc/usbip attach -r localhost -b $busid;\necho \"==============================================================\"\n\n# Wait for sysfs file to be updated. Without this sleep, usbip port\n# shows no imported devices.\nsleep 3;\n\necho \"List imported devices - expect to see imported devices\";\nsrc/usbip port;\necho \"==============================================================\"\n\necho \"Import devices from localhost - expect already imported messages\"\nsrc/usbip attach -r localhost -b $busid;\necho \"==============================================================\"\n\necho \"Un-import devices\";\nsrc/usbip detach -p 00;\nsrc/usbip detach -p 01;\necho \"==============================================================\"\n\necho \"List imported devices - expect to see none\";\nsrc/usbip port;\necho \"==============================================================\"\n\necho \"Un-import devices - expect no devices to detach messages\";\nsrc/usbip detach -p 00;\nsrc/usbip detach -p 01;\necho \"==============================================================\"\n\necho \"Detach invalid port tests - expect invalid port error message\";\nsrc/usbip detach -p 100;\necho \"==============================================================\"\n\necho \"Expect to see export-able devices\";\nsrc/usbip list -l;\necho \"==============================================================\"\n\necho \"Remove usbip_host module\";\nrmmod usbip_host;\n\necho \"Run lsusb - bound devices should be rebound to original drivers\"\nlsusb -t;\necho \"==============================================================\"\n\necho \"Run bind without usbip_host - expect fail\"\nsrc/usbip bind -b $busid;\necho \"==============================================================\"\n\necho \"Run lsusb - devices that failed to bind aren't bound to any driver\"\nlsusb -t;\necho \"==============================================================\"\n\necho \"modprobe usbip_host - does it work?\"\n/sbin/modprobe usbip_host\necho \"Should see -busid- is not in match_busid table... skip! dmesg\"\necho \"==============================================================\"\ndmesg | grep \"is not in match_busid table\"\necho \"==============================================================\"\n\necho $test_end_msg\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}