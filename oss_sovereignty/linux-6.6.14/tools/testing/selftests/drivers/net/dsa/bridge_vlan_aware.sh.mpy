{
  "module_name": "bridge_vlan_aware.sh",
  "hash_id": "772f783ac61f10999df5e171790208b73d35cf89fc88a6588a9c512ec16bcbe4",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/drivers/net/dsa/bridge_vlan_aware.sh",
  "human_readable_source": "#!/bin/bash\n# SPDX-License-Identifier: GPL-2.0\n\nALL_TESTS=\"ping_ipv4 ping_ipv6 learning flooding vlan_deletion extern_learn\"\nNUM_NETIFS=4\nCHECK_TC=\"yes\"\nsource lib.sh\n\nh1_create()\n{\n\tsimple_if_init $h1 192.0.2.1/24 2001:db8:1::1/64\n}\n\nh1_destroy()\n{\n\tsimple_if_fini $h1 192.0.2.1/24 2001:db8:1::1/64\n}\n\nh2_create()\n{\n\tsimple_if_init $h2 192.0.2.2/24 2001:db8:1::2/64\n}\n\nh2_destroy()\n{\n\tsimple_if_fini $h2 192.0.2.2/24 2001:db8:1::2/64\n}\n\nswitch_create()\n{\n\tip link add dev br0 type bridge \\\n\t\tvlan_filtering 1 \\\n\t\tageing_time $LOW_AGEING_TIME \\\n\t\tmcast_snooping 0\n\n\tip link set dev $swp1 master br0\n\tip link set dev $swp2 master br0\n\n\tip link set dev br0 up\n\tip link set dev $swp1 up\n\tip link set dev $swp2 up\n}\n\nswitch_destroy()\n{\n\tip link set dev $swp2 down\n\tip link set dev $swp1 down\n\n\tip link del dev br0\n}\n\nsetup_prepare()\n{\n\th1=${NETIFS[p1]}\n\tswp1=${NETIFS[p2]}\n\n\tswp2=${NETIFS[p3]}\n\th2=${NETIFS[p4]}\n\n\tvrf_prepare\n\n\th1_create\n\th2_create\n\n\tswitch_create\n}\n\ncleanup()\n{\n\tpre_cleanup\n\n\tswitch_destroy\n\n\th2_destroy\n\th1_destroy\n\n\tvrf_cleanup\n}\n\nping_ipv4()\n{\n\tping_test $h1 192.0.2.2\n}\n\nping_ipv6()\n{\n\tping6_test $h1 2001:db8:1::2\n}\n\nlearning()\n{\n\tlearning_test \"br0\" $swp1 $h1 $h2\n}\n\nflooding()\n{\n\tflood_test $swp2 $h1 $h2\n}\n\nvlan_deletion()\n{\n\t# Test that the deletion of a VLAN on a bridge port does not affect\n\t# the PVID VLAN\n\tlog_info \"Add and delete a VLAN on bridge port $swp1\"\n\n\tbridge vlan add vid 10 dev $swp1\n\tbridge vlan del vid 10 dev $swp1\n\n\tping_ipv4\n\tping_ipv6\n}\n\nextern_learn()\n{\n\tlocal mac=de:ad:be:ef:13:37\n\tlocal ageing_time\n\n\t# Test that externally learned FDB entries can roam, but not age out\n\tRET=0\n\n\tbridge fdb add de:ad:be:ef:13:37 dev $swp1 master extern_learn vlan 1\n\n\tbridge fdb show brport $swp1 | grep -q de:ad:be:ef:13:37\n\tcheck_err $? \"Did not find FDB entry when should\"\n\n\t# Wait for 10 seconds after the ageing time to make sure the FDB entry\n\t# was not aged out\n\tageing_time=$(bridge_ageing_time_get br0)\n\tsleep $((ageing_time + 10))\n\n\tbridge fdb show brport $swp1 | grep -q de:ad:be:ef:13:37\n\tcheck_err $? \"FDB entry was aged out when should not\"\n\n\t$MZ $h2 -c 1 -p 64 -a $mac -t ip -q\n\n\tbridge fdb show brport $swp2 | grep -q de:ad:be:ef:13:37\n\tcheck_err $? \"FDB entry did not roam when should\"\n\n\tlog_test \"Externally learned FDB entry - ageing & roaming\"\n\n\tbridge fdb del de:ad:be:ef:13:37 dev $swp2 master vlan 1 &> /dev/null\n\tbridge fdb del de:ad:be:ef:13:37 dev $swp1 master vlan 1 &> /dev/null\n}\n\ntrap cleanup EXIT\n\nsetup_prepare\nsetup_wait\n\ntests_run\n\nexit $EXIT_STATUS\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}