{
  "module_name": "dev_addr_lists.sh",
  "hash_id": "deb1fcced2fdd9927ffcc8463debefd28536740379756925ddb4af7561559da0",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/drivers/net/bonding/dev_addr_lists.sh",
  "human_readable_source": "#!/bin/bash\n# SPDX-License-Identifier: GPL-2.0\n#\n# Test bond device handling of addr lists (dev->uc, mc)\n#\n\nALL_TESTS=\"\n\tbond_cleanup_mode1\n\tbond_cleanup_mode4\n\tbond_listen_lacpdu_multicast_case_down\n\tbond_listen_lacpdu_multicast_case_up\n\"\n\nREQUIRE_MZ=no\nNUM_NETIFS=0\nlib_dir=$(dirname \"$0\")\nsource \"$lib_dir\"/net_forwarding_lib.sh\n\nsource \"$lib_dir\"/lag_lib.sh\n\n\ndestroy()\n{\n\tlocal ifnames=(dummy1 dummy2 bond1 mv0)\n\tlocal ifname\n\n\tfor ifname in \"${ifnames[@]}\"; do\n\t\tip link del \"$ifname\" &>/dev/null\n\tdone\n}\n\ncleanup()\n{\n\tpre_cleanup\n\n\tdestroy\n}\n\n\n# bond driver control paths vary between modes that have a primary slave\n# (bond_uses_primary()) and others. Test both kinds of modes.\n\nbond_cleanup_mode1()\n{\n\tRET=0\n\n\ttest_LAG_cleanup \"bonding\" \"active-backup\"\n}\n\nbond_cleanup_mode4() {\n\tRET=0\n\n\ttest_LAG_cleanup \"bonding\" \"802.3ad\"\n}\n\nbond_listen_lacpdu_multicast()\n{\n\t# Initial state of bond device, up | down\n\tlocal init_state=$1\n\tlocal lacpdu_mc=\"01:80:c2:00:00:02\"\n\n\tip link add dummy1 type dummy\n\tip link add bond1 \"$init_state\" type bond mode 802.3ad\n\tip link set dev dummy1 master bond1\n\tif [ \"$init_state\" = \"down\" ]; then\n\t\tip link set dev bond1 up\n\tfi\n\n\tgrep_bridge_fdb \"$lacpdu_mc\" bridge fdb show brport dummy1 >/dev/null\n\tcheck_err $? \"LACPDU multicast address not present on slave (1)\"\n\n\tip link set dev bond1 down\n\n\tnot grep_bridge_fdb \"$lacpdu_mc\" bridge fdb show brport dummy1 >/dev/null\n\tcheck_err $? \"LACPDU multicast address still present on slave\"\n\n\tip link set dev bond1 up\n\n\tgrep_bridge_fdb \"$lacpdu_mc\" bridge fdb show brport dummy1 >/dev/null\n\tcheck_err $? \"LACPDU multicast address not present on slave (2)\"\n\n\tcleanup\n\n\tlog_test \"bonding LACPDU multicast address to slave (from bond $init_state)\"\n}\n\n# The LACPDU mc addr is added by different paths depending on the initial state\n# of the bond when enslaving a device. Test both cases.\n\nbond_listen_lacpdu_multicast_case_down()\n{\n\tRET=0\n\n\tbond_listen_lacpdu_multicast \"down\"\n}\n\nbond_listen_lacpdu_multicast_case_up()\n{\n\tRET=0\n\n\tbond_listen_lacpdu_multicast \"up\"\n}\n\n\ntrap cleanup EXIT\n\ntests_run\n\nexit \"$EXIT_STATUS\"\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}