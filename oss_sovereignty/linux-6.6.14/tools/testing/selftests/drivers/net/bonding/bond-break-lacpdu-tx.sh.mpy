{
  "module_name": "bond-break-lacpdu-tx.sh",
  "hash_id": "2a457762b1cfa333c1e7fe12bd88b5e9b2c9fc1073a9d4637e38ee534a411ff0",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/drivers/net/bonding/bond-break-lacpdu-tx.sh",
  "human_readable_source": "#!/bin/sh\n# SPDX-License-Identifier: GPL-2.0\n\n# Regression Test:\n#   Verify LACPDUs get transmitted after setting the MAC address of\n#   the bond.\n#\n# https://bugzilla.redhat.com/show_bug.cgi?id=2020773\n#\n#       +---------+\n#       | fab-br0 |\n#       +---------+\n#            |\n#       +---------+\n#       |  fbond  |\n#       +---------+\n#        |       |\n#    +------+ +------+\n#    |veth1 | |veth2 |\n#    +------+ +------+\n#\n# We use veths instead of physical interfaces\n\nset -e\ntmp=$(mktemp -q dump.XXXXXX)\ncleanup() {\n\tip link del fab-br0 >/dev/null 2>&1 || :\n\tip link del fbond  >/dev/null 2>&1 || :\n\tip link del veth1-bond  >/dev/null 2>&1 || :\n\tip link del veth2-bond  >/dev/null 2>&1 || :\n\tmodprobe -r bonding  >/dev/null 2>&1 || :\n\trm -f -- ${tmp}\n}\n\ntrap cleanup 0 1 2\ncleanup\nsleep 1\n\n# create the bridge\nip link add fab-br0 address 52:54:00:3B:7C:A6 mtu 1500 type bridge \\\n\tforward_delay 15\n\n# create the bond\nip link add fbond type bond mode 4 miimon 200 xmit_hash_policy 1 \\\n\tad_actor_sys_prio 65535 lacp_rate fast\n\n# set bond address\nip link set fbond address 52:54:00:3B:7C:A6\nip link set fbond up\n\n# set again bond sysfs parameters\nip link set fbond type bond ad_actor_sys_prio 65535\n\n# create veths\nip link add name veth1-bond type veth peer name veth1-end\nip link add name veth2-bond type veth peer name veth2-end\n\n# add ports\nip link set fbond master fab-br0\nip link set veth1-bond master fbond\nip link set veth2-bond master fbond\n\n# bring up\nip link set veth1-end up\nip link set veth2-end up\nip link set fab-br0 up\nip link set fbond up\nip addr add dev fab-br0 10.0.0.3\n\ntcpdump -n -i veth1-end -e ether proto 0x8809 >${tmp} 2>&1 &\nsleep 15\npkill tcpdump >/dev/null 2>&1\nrc=0\nnum=$(grep \"packets captured\" ${tmp} | awk '{print $1}')\nif test \"$num\" -gt 0; then\n\techo \"PASS, captured ${num}\"\nelse\n\techo \"FAIL\"\n\trc=1\nfi\nexit $rc\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}