{
  "module_name": "bond_macvlan.sh",
  "hash_id": "ef6bafb89f9ad3dad71bda7deb950fc099b65ca0fdf4301fb89b28d8d955d087",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/drivers/net/bonding/bond_macvlan.sh",
  "human_readable_source": "#!/bin/bash\n# SPDX-License-Identifier: GPL-2.0\n#\n# Test macvlan over balance-alb\n\nlib_dir=$(dirname \"$0\")\nsource ${lib_dir}/bond_topo_2d1c.sh\n\nm1_ns=\"m1-$(mktemp -u XXXXXX)\"\nm2_ns=\"m1-$(mktemp -u XXXXXX)\"\nm1_ip4=\"192.0.2.11\"\nm1_ip6=\"2001:db8::11\"\nm2_ip4=\"192.0.2.12\"\nm2_ip6=\"2001:db8::12\"\n\ncleanup()\n{\n\tip -n ${m1_ns} link del macv0\n\tip netns del ${m1_ns}\n\tip -n ${m2_ns} link del macv0\n\tip netns del ${m2_ns}\n\n\tclient_destroy\n\tserver_destroy\n\tgateway_destroy\n}\n\ncheck_connection()\n{\n\tlocal ns=${1}\n\tlocal target=${2}\n\tlocal message=${3:-\"macvlan_over_bond\"}\n\tRET=0\n\n\n\tip netns exec ${ns} ping ${target} -c 4 -i 0.1 &>/dev/null\n\tcheck_err $? \"ping failed\"\n\tlog_test \"$mode: $message\"\n}\n\nmacvlan_over_bond()\n{\n\tlocal param=\"$1\"\n\tRET=0\n\n\t# setup new bond mode\n\tbond_reset \"${param}\"\n\n\tip -n ${s_ns} link add link bond0 name macv0 type macvlan mode bridge\n\tip -n ${s_ns} link set macv0 netns ${m1_ns}\n\tip -n ${m1_ns} link set dev macv0 up\n\tip -n ${m1_ns} addr add ${m1_ip4}/24 dev macv0\n\tip -n ${m1_ns} addr add ${m1_ip6}/24 dev macv0\n\n\tip -n ${s_ns} link add link bond0 name macv0 type macvlan mode bridge\n\tip -n ${s_ns} link set macv0 netns ${m2_ns}\n\tip -n ${m2_ns} link set dev macv0 up\n\tip -n ${m2_ns} addr add ${m2_ip4}/24 dev macv0\n\tip -n ${m2_ns} addr add ${m2_ip6}/24 dev macv0\n\n\tsleep 2\n\n\tcheck_connection \"${c_ns}\" \"${s_ip4}\" \"IPv4: client->server\"\n\tcheck_connection \"${c_ns}\" \"${s_ip6}\" \"IPv6: client->server\"\n\tcheck_connection \"${c_ns}\" \"${m1_ip4}\" \"IPv4: client->macvlan_1\"\n\tcheck_connection \"${c_ns}\" \"${m1_ip6}\" \"IPv6: client->macvlan_1\"\n\tcheck_connection \"${c_ns}\" \"${m2_ip4}\" \"IPv4: client->macvlan_2\"\n\tcheck_connection \"${c_ns}\" \"${m2_ip6}\" \"IPv6: client->macvlan_2\"\n\tcheck_connection \"${m1_ns}\" \"${m2_ip4}\" \"IPv4: macvlan_1->macvlan_2\"\n\tcheck_connection \"${m1_ns}\" \"${m2_ip6}\" \"IPv6: macvlan_1->macvlan_2\"\n\n\n\tsleep 5\n\n\tcheck_connection \"${s_ns}\" \"${c_ip4}\" \"IPv4: server->client\"\n\tcheck_connection \"${s_ns}\" \"${c_ip6}\" \"IPv6: server->client\"\n\tcheck_connection \"${m1_ns}\" \"${c_ip4}\" \"IPv4: macvlan_1->client\"\n\tcheck_connection \"${m1_ns}\" \"${c_ip6}\" \"IPv6: macvlan_1->client\"\n\tcheck_connection \"${m2_ns}\" \"${c_ip4}\" \"IPv4: macvlan_2->client\"\n\tcheck_connection \"${m2_ns}\" \"${c_ip6}\" \"IPv6: macvlan_2->client\"\n\tcheck_connection \"${m2_ns}\" \"${m1_ip4}\" \"IPv4: macvlan_2->macvlan_2\"\n\tcheck_connection \"${m2_ns}\" \"${m1_ip6}\" \"IPv6: macvlan_2->macvlan_2\"\n\n\tip -n ${c_ns} neigh flush dev eth0\n}\n\ntrap cleanup EXIT\n\nsetup_prepare\nip netns add ${m1_ns}\nip netns add ${m2_ns}\n\nmodes=\"active-backup balance-tlb balance-alb\"\n\nfor mode in $modes; do\n\tmacvlan_over_bond \"mode $mode\"\ndone\n\nexit $EXIT_STATUS\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}