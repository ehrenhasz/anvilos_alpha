{
  "module_name": "bond-eth-type-change.sh",
  "hash_id": "69ebd2f0d81f9569aaeff1a7591d7d37ce8771cc485d0b00c7250c12540c5924",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/drivers/net/bonding/bond-eth-type-change.sh",
  "human_readable_source": "#!/bin/bash\n# SPDX-License-Identifier: GPL-2.0\n#\n# Test bond device ether type changing\n#\n\nALL_TESTS=\"\n\tbond_test_unsuccessful_enslave_type_change\n\tbond_test_successful_enslave_type_change\n\"\nREQUIRE_MZ=no\nNUM_NETIFS=0\nlib_dir=$(dirname \"$0\")\nsource \"$lib_dir\"/net_forwarding_lib.sh\n\nbond_check_flags()\n{\n\tlocal bonddev=$1\n\n\tip -d l sh dev \"$bonddev\" | grep -q \"MASTER\"\n\tcheck_err $? \"MASTER flag is missing from the bond device\"\n\n\tip -d l sh dev \"$bonddev\" | grep -q \"SLAVE\"\n\tcheck_err $? \"SLAVE flag is missing from the bond device\"\n}\n\n# test enslaved bond dev type change from ARPHRD_ETHER and back\n# this allows us to test both MASTER and SLAVE flags at once\nbond_test_enslave_type_change()\n{\n\tlocal test_success=$1\n\tlocal devbond0=\"test-bond0\"\n\tlocal devbond1=\"test-bond1\"\n\tlocal devbond2=\"test-bond2\"\n\tlocal nonethdev=\"test-noneth0\"\n\n\t# create a non-ARPHRD_ETHER device for testing (e.g. nlmon type)\n\tip link add name \"$nonethdev\" type nlmon\n\tcheck_err $? \"could not create a non-ARPHRD_ETHER device (nlmon)\"\n\tip link add name \"$devbond0\" type bond\n\tif [ $test_success -eq 1 ]; then\n\t\t# we need devbond0 in active-backup mode to successfully enslave nonethdev\n\t\tip link set dev \"$devbond0\" type bond mode active-backup\n\t\tcheck_err $? \"could not change bond mode to active-backup\"\n\tfi\n\tip link add name \"$devbond1\" type bond\n\tip link add name \"$devbond2\" type bond\n\tip link set dev \"$devbond0\" master \"$devbond1\"\n\tcheck_err $? \"could not enslave $devbond0 to $devbond1\"\n\t# change bond type to non-ARPHRD_ETHER\n\tip link set dev \"$nonethdev\" master \"$devbond0\" 1>/dev/null 2>/dev/null\n\tip link set dev \"$nonethdev\" nomaster 1>/dev/null 2>/dev/null\n\t# restore ARPHRD_ETHER type by enslaving such device\n\tip link set dev \"$devbond2\" master \"$devbond0\"\n\tcheck_err $? \"could not enslave $devbond2 to $devbond0\"\n\n\tbond_check_flags \"$devbond0\"\n\n\t# clean up\n\tip link del dev \"$devbond0\"\n\tip link del dev \"$devbond1\"\n\tip link del dev \"$devbond2\"\n\tip link del dev \"$nonethdev\"\n}\n\nbond_test_unsuccessful_enslave_type_change()\n{\n\tRET=0\n\n\tbond_test_enslave_type_change 0\n\tlog_test \"Change ether type of an enslaved bond device with unsuccessful enslave\"\n}\n\nbond_test_successful_enslave_type_change()\n{\n\tRET=0\n\n\tbond_test_enslave_type_change 1\n\tlog_test \"Change ether type of an enslaved bond device with successful enslave\"\n}\n\ntests_run\n\nexit \"$EXIT_STATUS\"\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}