{
  "module_name": "ethtool-fec.sh",
  "hash_id": "115899368ac6dd83ef8703fe93d7d74ed34e401784368d2796e2f9ea14eec767",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/drivers/net/netdevsim/ethtool-fec.sh",
  "human_readable_source": "#!/bin/bash\n# SPDX-License-Identifier: GPL-2.0-only\n\nsource ethtool-common.sh\n\nNSIM_NETDEV=$(make_netdev)\n[ a$ETHTOOL == a ] && ETHTOOL=ethtool\n\nset -o pipefail\n\n# netdevsim starts out with None/None\ns=$($ETHTOOL --show-fec $NSIM_NETDEV | tail -2)\ncheck $? \"$s\" \"Configured FEC encodings: None\nActive FEC encoding: None\"\n\n# Test Auto\n$ETHTOOL --set-fec $NSIM_NETDEV encoding auto\ncheck $?\ns=$($ETHTOOL --show-fec $NSIM_NETDEV | tail -2)\ncheck $? \"$s\" \"Configured FEC encodings: Auto\nActive FEC encoding: Off\"\n\n# Test case in-sensitivity\nfor o in off Off OFF; do\n    $ETHTOOL --set-fec $NSIM_NETDEV encoding $o\n    check $?\n    s=$($ETHTOOL --show-fec $NSIM_NETDEV | tail -2)\n    check $? \"$s\" \"Configured FEC encodings: Off\nActive FEC encoding: Off\"\ndone\n\nfor o in BaseR baser BAser; do\n    $ETHTOOL --set-fec $NSIM_NETDEV encoding $o\n    check $?\n    s=$($ETHTOOL --show-fec $NSIM_NETDEV | tail -2)\n    check $? \"$s\" \"Configured FEC encodings: BaseR\nActive FEC encoding: BaseR\"\ndone\n\nfor o in llrs rs; do\n    $ETHTOOL --set-fec $NSIM_NETDEV encoding $o\n    check $?\n    s=$($ETHTOOL --show-fec $NSIM_NETDEV | tail -2)\n    check $? \"$s\" \"Configured FEC encodings: ${o^^}\nActive FEC encoding: ${o^^}\"\ndone\n\n# Test mutliple bits\n$ETHTOOL --set-fec $NSIM_NETDEV encoding rs llrs\ncheck $?\ns=$($ETHTOOL --show-fec $NSIM_NETDEV | tail -2)\ncheck $? \"$s\" \"Configured FEC encodings: RS LLRS\nActive FEC encoding: LLRS\"\n\n$ETHTOOL --set-fec $NSIM_NETDEV encoding rs off auto\ncheck $?\ns=$($ETHTOOL --show-fec $NSIM_NETDEV | tail -2)\ncheck $? \"$s\" \"Configured FEC encodings: Auto Off RS\nActive FEC encoding: RS\"\n\n# Make sure other link modes are rejected\n$ETHTOOL --set-fec $NSIM_NETDEV encoding FIBRE 2>/dev/null\ncheck $? '' '' 1\n\n$ETHTOOL --set-fec $NSIM_NETDEV encoding bla-bla-bla 2>/dev/null\ncheck $? '' '' 1\n\n# Try JSON\n$ETHTOOL --json --show-fec $NSIM_NETDEV | jq empty >>/dev/null 2>&1\nif [ $? -eq 0 ]; then\n    $ETHTOOL --set-fec $NSIM_NETDEV encoding auto\n    check $?\n\n    s=$($ETHTOOL --json --show-fec $NSIM_NETDEV | jq '.[].config[]')\n    check $? \"$s\" '\"Auto\"'\n    s=$($ETHTOOL --json --show-fec $NSIM_NETDEV | jq '.[].active[]')\n    check $? \"$s\" '\"Off\"'\n\n    $ETHTOOL --set-fec $NSIM_NETDEV encoding auto RS\n    check $?\n\n    s=$($ETHTOOL --json --show-fec $NSIM_NETDEV | jq '.[].config[]')\n    check $? \"$s\" '\"Auto\"\n\"RS\"'\n    s=$($ETHTOOL --json --show-fec $NSIM_NETDEV | jq '.[].active[]')\n    check $? \"$s\" '\"RS\"'\nfi\n\n# Test error injection\necho 11 > $NSIM_DEV_DFS/ethtool/get_err\n\n$ETHTOOL --show-fec $NSIM_NETDEV >>/dev/null 2>&1\ncheck $? '' '' 1\n\necho 0 > $NSIM_DEV_DFS/ethtool/get_err\necho 11 > $NSIM_DEV_DFS/ethtool/set_err\n\n$ETHTOOL --show-fec $NSIM_NETDEV  >>/dev/null 2>&1\ncheck $?\n\n$ETHTOOL --set-fec $NSIM_NETDEV encoding RS 2>/dev/null\ncheck $? '' '' 1\n\nif [ $num_errors -eq 0 ]; then\n    echo \"PASSED all $((num_passes)) checks\"\n    exit 0\nelse\n    echo \"FAILED $num_errors/$((num_errors+num_passes)) checks\"\n    exit 1\nfi\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}