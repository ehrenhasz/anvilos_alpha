{
  "module_name": "tc-mq-visibility.sh",
  "hash_id": "d34a4d516d4b290647b84d45f89d28dbb897e98d9a9236f23cab5e2271e8a331",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/drivers/net/netdevsim/tc-mq-visibility.sh",
  "human_readable_source": "#!/bin/bash\n# SPDX-License-Identifier: GPL-2.0-only\n\nsource ethtool-common.sh\n\nset -o pipefail\n\nn_children() {\n    n=$(tc qdisc show dev $NDEV | grep '^qdisc' | wc -l)\n    echo $((n - 1))\n}\n\ntcq() {\n    tc qdisc $1 dev $NDEV ${@:2}\n}\n\nn_child_assert() {\n    n=$(n_children)\n    if [ $n -ne $1 ]; then\n\techo \"ERROR ($root): ${@:2}, expected $1 have $n\"\n\t((num_errors++))\n    else\n\t((num_passes++))\n    fi\n}\n\n\nfor root in mq mqprio; do\n    NDEV=$(make_netdev 1 4)\n\n    opts=\n    [ $root == \"mqprio\" ] && opts='hw 0 num_tc 1 map 0 0 0 0  queues 1@0'\n\n    tcq add root handle 100: $root $opts\n    n_child_assert 4 'Init'\n\n    # All defaults\n\n    for n in 3 2 1 2 3 4 1 4; do\n\tethtool -L $NDEV combined $n\n\tn_child_assert $n \"Change queues to $n while down\"\n    done\n\n    ip link set dev $NDEV up\n\n    for n in 3 2 1 2 3 4 1 4; do\n\tethtool -L $NDEV combined $n\n\tn_child_assert $n \"Change queues to $n while up\"\n    done\n\n    # One real one\n    tcq replace parent 100:4 handle 204: pfifo_fast\n    n_child_assert 4 \"One real queue\"\n\n    ethtool -L $NDEV combined 1\n    n_child_assert 2 \"One real queue, one default\"\n\n    ethtool -L $NDEV combined 4\n    n_child_assert 4 \"One real queue, rest default\"\n\n    # Graft some\n    tcq replace parent 100:1 handle 204:\n    n_child_assert 3 \"Grafted\"\n\n    ethtool -L $NDEV combined 1\n    n_child_assert 1 \"Grafted, one\"\n\n    cleanup_nsim\ndone\n\nif [ $num_errors -eq 0 ]; then\n    echo \"PASSED all $((num_passes)) checks\"\n    exit 0\nelse\n    echo \"FAILED $num_errors/$((num_errors+num_passes)) checks\"\n    exit 1\nfi\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}