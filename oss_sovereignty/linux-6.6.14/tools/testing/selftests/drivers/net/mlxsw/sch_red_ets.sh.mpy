{
  "module_name": "sch_red_ets.sh",
  "hash_id": "a5651f1566230dbd99c5ec5d11ce3677e617956a4dab7dc0ed54a1f5c768f630",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/drivers/net/mlxsw/sch_red_ets.sh",
  "human_readable_source": "#!/bin/bash\n# SPDX-License-Identifier: GPL-2.0\n\nALL_TESTS=\"\n\tping_ipv4\n\tecn_test\n\tecn_test_perband\n\tecn_nodrop_test\n\tred_test\n\tmc_backlog_test\n\tred_mirror_test\n\tred_trap_test\n\tecn_mirror_test\n\"\n: ${QDISC:=ets}\nsource sch_red_core.sh\n\n# do_ecn_test first build 2/3 of the requested backlog and expects no marking,\n# and then builds 3/2 of it and does expect marking. The values of $BACKLOG1 and\n# $BACKLOG2 are far enough not to overlap, so that we can assume that if we do\n# see (do not see) marking, it is actually due to the configuration of that one\n# TC, and not due to configuration of the other TC leaking over.\nBACKLOG1=200000\nBACKLOG2=500000\n\ninstall_root_qdisc()\n{\n\ttc qdisc add dev $swp3 parent 1: handle 10: $QDISC \\\n\t   bands 8 priomap 7 6 5 4 3 2 1 0\n}\n\ninstall_qdisc_tc0()\n{\n\tlocal -a args=(\"$@\")\n\n\ttc qdisc add dev $swp3 parent 10:8 handle 108: red \\\n\t   limit 1000000 min $BACKLOG1 max $((BACKLOG1 + 1)) \\\n\t   probability 1.0 avpkt 8000 burst 38 \"${args[@]}\"\n}\n\ninstall_qdisc_tc1()\n{\n\tlocal -a args=(\"$@\")\n\n\ttc qdisc add dev $swp3 parent 10:7 handle 107: red \\\n\t   limit 1000000 min $BACKLOG2 max $((BACKLOG2 + 1)) \\\n\t   probability 1.0 avpkt 8000 burst 63 \"${args[@]}\"\n}\n\ninstall_qdisc()\n{\n\tinstall_root_qdisc\n\tinstall_qdisc_tc0 \"$@\"\n\tinstall_qdisc_tc1 \"$@\"\n\tsleep 1\n}\n\nuninstall_qdisc_tc0()\n{\n\ttc qdisc del dev $swp3 parent 10:8\n}\n\nuninstall_qdisc_tc1()\n{\n\ttc qdisc del dev $swp3 parent 10:7\n}\n\nuninstall_root_qdisc()\n{\n\ttc qdisc del dev $swp3 parent 1:\n}\n\nuninstall_qdisc()\n{\n\tuninstall_qdisc_tc0\n\tuninstall_qdisc_tc1\n\tuninstall_root_qdisc\n}\n\necn_test()\n{\n\tinstall_qdisc ecn\n\n\tdo_ecn_test 10 $BACKLOG1\n\tdo_ecn_test 11 $BACKLOG2\n\n\tuninstall_qdisc\n}\n\necn_test_perband()\n{\n\tinstall_qdisc ecn\n\n\tdo_ecn_test_perband 10 $BACKLOG1\n\tdo_ecn_test_perband 11 $BACKLOG2\n\n\tuninstall_qdisc\n}\n\necn_nodrop_test()\n{\n\tinstall_qdisc ecn nodrop\n\n\tdo_ecn_nodrop_test 10 $BACKLOG1\n\tdo_ecn_nodrop_test 11 $BACKLOG2\n\n\tuninstall_qdisc\n}\n\nred_test()\n{\n\tinstall_qdisc\n\n\t# Make sure that we get the non-zero value if there is any.\n\tlocal cur=$(busywait 1100 until_counter_is \"> 0\" \\\n\t\t\t    qdisc_stats_get $swp3 10: .backlog)\n\t(( cur == 0 ))\n\tcheck_err $? \"backlog of $cur observed on non-busy qdisc\"\n\tlog_test \"$QDISC backlog properly cleaned\"\n\n\tdo_red_test 10 $BACKLOG1\n\tdo_red_test 11 $BACKLOG2\n\n\tuninstall_qdisc\n}\n\nmc_backlog_test()\n{\n\tinstall_qdisc\n\n\t# Note that the backlog numbers here do not correspond to RED\n\t# configuration, but are arbitrary.\n\tdo_mc_backlog_test 10 $BACKLOG1\n\tdo_mc_backlog_test 11 $BACKLOG2\n\n\tuninstall_qdisc\n}\n\nred_mirror_test()\n{\n\tinstall_qdisc qevent early_drop block 10\n\n\tdo_drop_mirror_test 10 $BACKLOG1 early_drop\n\tdo_drop_mirror_test 11 $BACKLOG2 early_drop\n\n\tuninstall_qdisc\n}\n\nred_trap_test()\n{\n\tinstall_qdisc qevent early_drop block 10\n\n\tdo_drop_trap_test 10 $BACKLOG1 early_drop\n\tdo_drop_trap_test 11 $BACKLOG2 early_drop\n\n\tuninstall_qdisc\n}\n\necn_mirror_test()\n{\n\tinstall_qdisc ecn qevent mark block 10\n\n\tdo_mark_mirror_test 10 $BACKLOG1\n\tdo_mark_mirror_test 11 $BACKLOG2\n\n\tuninstall_qdisc\n}\n\nbail_on_lldpad \"configure DCB\" \"configure Qdiscs\"\n\ntrap cleanup EXIT\nsetup_prepare\nsetup_wait\ntests_run\n\nexit $EXIT_STATUS\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}