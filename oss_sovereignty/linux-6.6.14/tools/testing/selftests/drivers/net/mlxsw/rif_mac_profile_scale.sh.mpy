{
  "module_name": "rif_mac_profile_scale.sh",
  "hash_id": "ca7d41c8e05486df01c0437c5bc026a21fe562a59ab50b6961369faadc81640f",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/drivers/net/mlxsw/rif_mac_profile_scale.sh",
  "human_readable_source": "#!/bin/bash\n# SPDX-License-Identifier: GPL-2.0\n\n# Test for RIF MAC profiles resource. The test adds VLAN netdevices according to\n# the maximum number of RIF MAC profiles, sets each of them with a random\n# MAC address, and checks that eventually the number of occupied RIF MAC\n# profiles equals the maximum number of RIF MAC profiles.\n\n\nRIF_MAC_PROFILE_NUM_NETIFS=2\n\nrif_mac_profiles_create()\n{\n\tlocal count=$1; shift\n\tlocal should_fail=$1; shift\n\tlocal batch_file=\"$(mktemp)\"\n\n\tfor ((i = 1; i <= count; i++)); do\n\t\tvlan=$(( i*10 ))\n\t\tm=$(( i*11 ))\n\n\t\tcat >> $batch_file <<-EOF\n\t\t\tlink add link $h1 name $h1.$vlan \\\n\t\t\t\taddress 00:$m:$m:$m:$m:$m type vlan id $vlan\n\t\t\taddress add 192.0.$m.1/24 dev $h1.$vlan\n\t\tEOF\n\tdone\n\n\tip -b $batch_file &> /dev/null\n\tcheck_err_fail $should_fail $? \"RIF creation\"\n\n\trm -f $batch_file\n}\n\nrif_mac_profile_test()\n{\n\tlocal count=$1; shift\n\tlocal should_fail=$1; shift\n\n\trif_mac_profiles_create $count $should_fail\n\n\tocc=$(devlink -j resource show $DEVLINK_DEV \\\n\t      | jq '.[][][] | select(.name==\"rif_mac_profiles\") |.[\"occ\"]')\n\n\t[[ $occ -eq $count ]]\n\tcheck_err_fail $should_fail $? \"Attempt to use $count profiles (actual result $occ)\"\n}\n\nrif_mac_profile_setup_prepare()\n{\n\th1=${NETIFS[p1]}\n\th2=${NETIFS[p2]}\n\n\t# Disable IPv6 on the two interfaces to avoid IPv6 link-local addresses\n\t# being generated and RIFs being created.\n\tsysctl_set net.ipv6.conf.$h1.disable_ipv6 1\n\tsysctl_set net.ipv6.conf.$h2.disable_ipv6 1\n\n\tip link set $h1 up\n\tip link set $h2 up\n}\n\nrif_mac_profile_cleanup()\n{\n\tpre_cleanup\n\n\tip link set $h2 down\n\tip link set $h1 down\n\n\tsysctl_restore net.ipv6.conf.$h2.disable_ipv6\n\tsysctl_restore net.ipv6.conf.$h1.disable_ipv6\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}