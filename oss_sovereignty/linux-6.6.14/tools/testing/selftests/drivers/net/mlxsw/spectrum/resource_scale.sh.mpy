{
  "module_name": "resource_scale.sh",
  "hash_id": "c79a528217c791e48b79ee42eacf085280d2fadb1b6052c5698b13377d5af87c",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/drivers/net/mlxsw/spectrum/resource_scale.sh",
  "human_readable_source": "#!/bin/bash\n# SPDX-License-Identifier: GPL-2.0\n\nlib_dir=$(dirname $0)/../../../../net/forwarding\n\nNUM_NETIFS=6\nsource $lib_dir/lib.sh\nsource $lib_dir/tc_common.sh\nsource devlink_lib_spectrum.sh\n\ncurrent_test=\"\"\n\ncleanup()\n{\n\tpre_cleanup\n\tif [ ! -z $current_test ]; then\n\t\t${current_test}_cleanup\n\tfi\n\tdevlink_sp_size_kvd_to_default\n}\n\ndevlink_sp_read_kvd_defaults\ntrap cleanup EXIT\n\nALL_TESTS=\"\n\trouter\n\ttc_flower\n\tmirror_gre\n\ttc_police\n\tport\n\trif_mac_profile\n\trif_counter\n\tport_range\n\"\n\nfor current_test in ${TESTS:-$ALL_TESTS}; do\n\tRET_FIN=0\n\tsource ${current_test}_scale.sh\n\n\tnum_netifs_var=${current_test^^}_NUM_NETIFS\n\tnum_netifs=${!num_netifs_var:-$NUM_NETIFS}\n\n\tfor profile in $KVD_PROFILES; do\n\t\tRET=0\n\t\tdevlink_sp_resource_kvd_profile_set $profile\n\t\tif [[ $RET -gt 0 ]]; then\n\t\t\tlog_test \"'$current_test' [$profile] setting\"\n\t\t\tcontinue\n\t\tfi\n\n\t\tfor should_fail in 0 1; do\n\t\t\tRET=0\n\t\t\ttarget=$(${current_test}_get_target \"$should_fail\")\n\t\t\tif ((target == 0)); then\n\t\t\t\tlog_test_skip \"'$current_test' [$profile] should_fail=$should_fail test\"\n\t\t\t\tcontinue\n\t\t\tfi\n\t\t\t${current_test}_setup_prepare\n\t\t\tsetup_wait $num_netifs\n\t\t\t# Update target in case occupancy of a certain resource\n\t\t\t# changed following the test setup.\n\t\t\ttarget=$(${current_test}_get_target \"$should_fail\")\n\t\t\t${current_test}_test \"$target\" \"$should_fail\"\n\t\t\tif [[ \"$should_fail\" -eq 0 ]]; then\n\t\t\t\tlog_test \"'$current_test' [$profile] $target\"\n\n\t\t\t\tif ((!RET)); then\n\t\t\t\t\ttt=${current_test}_traffic_test\n\t\t\t\t\tif [[ $(type -t $tt) == \"function\" ]]\n\t\t\t\t\tthen\n\t\t\t\t\t\t$tt \"$target\"\n\t\t\t\t\t\tlog_test \"'$current_test' [$profile] $target traffic test\"\n\t\t\t\t\tfi\n\t\t\t\tfi\n\t\t\telse\n\t\t\t\tlog_test \"'$current_test' [$profile] overflow $target\"\n\t\t\tfi\n\t\t\t${current_test}_cleanup $target\n\t\t\tRET_FIN=$(( RET_FIN || RET ))\n\t\tdone\n\tdone\ndone\ncurrent_test=\"\"\n\nexit \"$RET_FIN\"\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}