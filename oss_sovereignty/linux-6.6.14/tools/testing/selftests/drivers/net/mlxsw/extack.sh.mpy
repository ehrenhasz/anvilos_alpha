{
  "module_name": "extack.sh",
  "hash_id": "05641041b068701e26e5300e3c5bab3898fbc6451cbbc0002e50244c200cefef",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/drivers/net/mlxsw/extack.sh",
  "human_readable_source": "#!/bin/bash\n# SPDX-License-Identifier: GPL-2.0\n#\n# Test operations that we expect to report extended ack.\n\nlib_dir=$(dirname $0)/../../../net/forwarding\n\nALL_TESTS=\"\n\tnetdev_pre_up_test\n\tvxlan_vlan_add_test\n\tvxlan_bridge_create_test\n\tbridge_create_test\n\"\nNUM_NETIFS=2\nsource $lib_dir/lib.sh\n\nsetup_prepare()\n{\n\tswp1=${NETIFS[p1]}\n\tswp2=${NETIFS[p2]}\n\n\tip link set dev $swp1 up\n\tip link set dev $swp2 up\n}\n\ncleanup()\n{\n\tpre_cleanup\n\n\tip link set dev $swp2 down\n\tip link set dev $swp1 down\n}\n\nnetdev_pre_up_test()\n{\n\tRET=0\n\n\tip link add name br1 type bridge vlan_filtering 0 mcast_snooping 0\n\tip link set dev br1 addrgenmode none\n\tip link set dev br1 up\n\tip link add name vx1 up type vxlan id 1000 \\\n\t\tlocal 192.0.2.17 remote 192.0.2.18 \\\n\t\tdstport 4789 nolearning noudpcsum tos inherit ttl 100\n\n\tip link set dev vx1 master br1\n\tcheck_err $?\n\n\tip link set dev $swp1 master br1\n\tcheck_err $?\n\n\tip link add name br2 type bridge vlan_filtering 0 mcast_snooping 0\n\tip link set dev br2 addrgenmode none\n\tip link set dev br2 up\n\tip link add name vx2 up type vxlan id 2000 \\\n\t\tlocal 192.0.2.17 remote 192.0.2.18 \\\n\t\tdstport 4789 nolearning noudpcsum tos inherit ttl 100\n\n\tip link set dev vx2 master br2\n\tcheck_err $?\n\n\tip link set dev $swp2 master br2\n\tcheck_err $?\n\n\t# Unsupported configuration: mlxsw demands that all offloaded VXLAN\n\t# devices have the same TTL.\n\tip link set dev vx2 down\n\tip link set dev vx2 type vxlan ttl 200\n\n\tip link set dev vx2 up &>/dev/null\n\tcheck_fail $?\n\n\tip link set dev vx2 up 2>&1 >/dev/null | grep -q mlxsw_spectrum\n\tcheck_err $?\n\n\tlog_test \"extack - NETDEV_PRE_UP\"\n\n\tip link del dev vx2\n\tip link del dev br2\n\n\tip link del dev vx1\n\tip link del dev br1\n}\n\nvxlan_vlan_add_test()\n{\n\tRET=0\n\n\tip link add name br1 type bridge vlan_filtering 1 mcast_snooping 0\n\tip link set dev br1 addrgenmode none\n\tip link set dev br1 up\n\n\t# Unsupported configuration: mlxsw demands VXLAN with \"noudpcsum\".\n\tip link add name vx1 up type vxlan id 1000 \\\n\t\tlocal 192.0.2.17 remote 192.0.2.18 \\\n\t\tdstport 4789 tos inherit ttl 100\n\n\tip link set dev vx1 master br1\n\tcheck_err $?\n\n\tbridge vlan add dev vx1 vid 1\n\tcheck_err $?\n\n\tip link set dev $swp1 master br1\n\tcheck_err $?\n\n\tbridge vlan add dev vx1 vid 1 pvid untagged 2>&1 >/dev/null \\\n\t\t| grep -q mlxsw_spectrum\n\tcheck_err $?\n\n\tlog_test \"extack - map VLAN at VXLAN device\"\n\n\tip link del dev vx1\n\tip link del dev br1\n}\n\nvxlan_bridge_create_test()\n{\n\tRET=0\n\n\t# Unsupported configuration: mlxsw demands VXLAN with \"noudpcsum\".\n\tip link add name vx1 up type vxlan id 1000 \\\n\t\tlocal 192.0.2.17 remote 192.0.2.18 \\\n\t\tdstport 4789 tos inherit ttl 100\n\n\t# Test with VLAN-aware bridge.\n\tip link add name br1 type bridge vlan_filtering 1 mcast_snooping 0\n\tip link set dev br1 addrgenmode none\n\tip link set dev br1 up\n\n\tip link set dev vx1 master br1\n\n\tip link set dev $swp1 master br1 2>&1 > /dev/null \\\n\t\t| grep -q mlxsw_spectrum\n\tcheck_err $?\n\n\t# Test with VLAN-unaware bridge.\n\tip link set dev br1 type bridge vlan_filtering 0\n\n\tip link set dev $swp1 master br1 2>&1 > /dev/null \\\n\t\t| grep -q mlxsw_spectrum\n\tcheck_err $?\n\n\tlog_test \"extack - bridge creation with VXLAN\"\n\n\tip link del dev br1\n\tip link del dev vx1\n}\n\nbridge_create_test()\n{\n\tRET=0\n\n\tip link add name br1 type bridge vlan_filtering 1\n\tip link set dev br1 addrgenmode none\n\tip link set dev br1 up\n\tip link add name br2 type bridge vlan_filtering 1\n\tip link set dev br2 addrgenmode none\n\tip link set dev br2 up\n\n\tip link set dev $swp1 master br1\n\tcheck_err $?\n\n\t# Only one VLAN-aware bridge is supported, so this should fail with\n\t# an extack.\n\tip link set dev $swp2 master br2 2>&1 > /dev/null \\\n\t\t| grep -q mlxsw_spectrum\n\tcheck_err $?\n\n\tlog_test \"extack - multiple VLAN-aware bridges creation\"\n\n\tip link del dev br2\n\tip link del dev br1\n}\n\ntrap cleanup EXIT\n\nsetup_prepare\nsetup_wait\n\ntests_run\n\nexit $EXIT_STATUS\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}