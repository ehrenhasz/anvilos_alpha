{
  "module_name": "devlink_lib_spectrum.sh",
  "hash_id": "6e9aabe95854a9019fa240ea6497b4c930e7b3c3f8a6eaf82c74d5572375c30d",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/drivers/net/mlxsw/spectrum/devlink_lib_spectrum.sh",
  "human_readable_source": "#!/bin/bash\n# SPDX-License-Identifier: GPL-2.0\n\nsource \"../../../../net/forwarding/devlink_lib.sh\"\nsource ../mlxsw_lib.sh\n\nmlxsw_only_on_spectrum 1 || exit 1\n\n# Needed for returning to default\ndeclare -A KVD_DEFAULTS\n\nKVD_CHILDREN=\"linear hash_single hash_double\"\nKVDL_CHILDREN=\"singles chunks large_chunks\"\n\ndevlink_sp_resource_minimize()\n{\n\tlocal size\n\tlocal i\n\n\tfor i in $KVD_CHILDREN; do\n\t\tsize=$(devlink_resource_get kvd \"$i\" | jq '.[\"size_min\"]')\n\t\tdevlink_resource_size_set \"$size\" kvd \"$i\"\n\tdone\n\n\tfor i in $KVDL_CHILDREN; do\n\t\tsize=$(devlink_resource_get kvd linear \"$i\" | \\\n\t\t       jq '.[\"size_min\"]')\n\t\tdevlink_resource_size_set \"$size\" kvd linear \"$i\"\n\tdone\n}\n\ndevlink_sp_size_kvd_to_default()\n{\n\tlocal need_reload=0\n\tlocal i\n\n\tfor i in $KVD_CHILDREN; do\n\t\tlocal size=$(echo \"${KVD_DEFAULTS[kvd_$i]}\" | jq '.[\"size\"]')\n\t\tcurrent_size=$(devlink_resource_size_get kvd \"$i\")\n\n\t\tif [ \"$size\" -ne \"$current_size\" ]; then\n\t\t\tdevlink_resource_size_set \"$size\" kvd \"$i\"\n\t\t\tneed_reload=1\n\t\tfi\n\tdone\n\n\tfor i in $KVDL_CHILDREN; do\n\t\tlocal size=$(echo \"${KVD_DEFAULTS[kvd_linear_$i]}\" | \\\n\t\t\t     jq '.[\"size\"]')\n\t\tcurrent_size=$(devlink_resource_size_get kvd linear \"$i\")\n\n\t\tif [ \"$size\" -ne \"$current_size\" ]; then\n\t\t\tdevlink_resource_size_set \"$size\" kvd linear \"$i\"\n\t\t\tneed_reload=1\n\t\tfi\n\tdone\n\n\tif [ \"$need_reload\" -ne \"0\" ]; then\n\t\tdevlink_reload\n\tfi\n}\n\ndevlink_sp_read_kvd_defaults()\n{\n\tlocal key\n\tlocal i\n\n\tKVD_DEFAULTS[kvd]=$(devlink_resource_get \"kvd\")\n\tfor i in $KVD_CHILDREN; do\n\t\tkey=kvd_$i\n\t\tKVD_DEFAULTS[$key]=$(devlink_resource_get kvd \"$i\")\n\tdone\n\n\tfor i in $KVDL_CHILDREN; do\n\t\tkey=kvd_linear_$i\n\t\tKVD_DEFAULTS[$key]=$(devlink_resource_get kvd linear \"$i\")\n\tdone\n}\n\nKVD_PROFILES=\"default scale ipv4_max\"\n\ndevlink_sp_resource_kvd_profile_set()\n{\n\tlocal profile=$1\n\n\tcase \"$profile\" in\n\tscale)\n\t\tdevlink_resource_size_set 64000 kvd linear\n\t\tdevlink_resource_size_set 15616 kvd linear singles\n\t\tdevlink_resource_size_set 32000 kvd linear chunks\n\t\tdevlink_resource_size_set 16384 kvd linear large_chunks\n\t\tdevlink_resource_size_set 128000 kvd hash_single\n\t\tdevlink_resource_size_set 48000 kvd hash_double\n\t\tdevlink_reload\n\t\t;;\n\tipv4_max)\n\t\tdevlink_resource_size_set 64000 kvd linear\n\t\tdevlink_resource_size_set 15616 kvd linear singles\n\t\tdevlink_resource_size_set 32000 kvd linear chunks\n\t\tdevlink_resource_size_set 16384 kvd linear large_chunks\n\t\tdevlink_resource_size_set 144000 kvd hash_single\n\t\tdevlink_resource_size_set 32768 kvd hash_double\n\t\tdevlink_reload\n\t\t;;\n\tdefault)\n\t\tdevlink_resource_size_set 98304 kvd linear\n\t\tdevlink_resource_size_set 16384 kvd linear singles\n\t\tdevlink_resource_size_set 49152 kvd linear chunks\n\t\tdevlink_resource_size_set 32768 kvd linear large_chunks\n\t\tdevlink_resource_size_set 87040 kvd hash_single\n\t\tdevlink_resource_size_set 60416 kvd hash_double\n\t\tdevlink_reload\n\t\t;;\n\t*)\n\t\tcheck_err 1 \"Unknown profile $profile\"\n\tesac\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}