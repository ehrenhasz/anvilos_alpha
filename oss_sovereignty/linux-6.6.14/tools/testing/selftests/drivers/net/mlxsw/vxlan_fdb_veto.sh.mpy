{
  "module_name": "vxlan_fdb_veto.sh",
  "hash_id": "c483e0e722dc04f39ce19e7b9e32ef5d517742fdf4a1853d8fcb1b27e1e95ac5",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/drivers/net/mlxsw/vxlan_fdb_veto.sh",
  "human_readable_source": "#!/bin/bash\n# SPDX-License-Identifier: GPL-2.0\n#\n# Test vetoing of FDB entries that mlxsw can not offload. This exercises several\n# different veto vectors to test various rollback scenarios in the vxlan driver.\n\n: ${LOCAL_IP:=198.51.100.1}\nexport LOCAL_IP\n\n: ${REMOTE_IP_1:=198.51.100.2}\nexport REMOTE_IP_1\n\n: ${REMOTE_IP_2:=198.51.100.3}\nexport REMOTE_IP_2\n\n: ${UDPCSUM_FLAFS:=noudpcsum}\nexport UDPCSUM_FLAFS\n\n: ${MC_IP:=224.0.0.1}\nexport MC_IP\n\nlib_dir=$(dirname $0)/../../../net/forwarding\n\nALL_TESTS=\"\n\tfdb_create_veto_test\n\tfdb_replace_veto_test\n\tfdb_append_veto_test\n\tfdb_changelink_veto_test\n\"\nNUM_NETIFS=2\nsource $lib_dir/lib.sh\n\nsetup_prepare()\n{\n\tswp1=${NETIFS[p1]}\n\tswp2=${NETIFS[p2]}\n\n\tip link add dev br0 type bridge mcast_snooping 0\n\n\tip link set dev $swp1 up\n\tip link set dev $swp1 master br0\n\tip link set dev $swp2 up\n\n\tip link add name vxlan0 up type vxlan id 10 nolearning $UDPCSUM_FLAFS \\\n\t\tttl 20 tos inherit local $LOCAL_IP dstport 4789\n\tip link set dev vxlan0 master br0\n}\n\ncleanup()\n{\n\tpre_cleanup\n\n\tip link set dev vxlan0 nomaster\n\tip link del dev vxlan0\n\n\tip link set dev $swp2 down\n\tip link set dev $swp1 nomaster\n\tip link set dev $swp1 down\n\n\tip link del dev br0\n}\n\nfdb_create_veto_test()\n{\n\tRET=0\n\n\tbridge fdb add 01:02:03:04:05:06 dev vxlan0 self static \\\n\t       dst $REMOTE_IP_1 2>/dev/null\n\tcheck_fail $? \"multicast MAC not rejected\"\n\n\tbridge fdb add 01:02:03:04:05:06 dev vxlan0 self static \\\n\t       dst $REMOTE_IP_1 2>&1 >/dev/null | grep -q mlxsw_spectrum\n\tcheck_err $? \"multicast MAC rejected without extack\"\n\n\tlog_test \"vxlan FDB veto - create\"\n}\n\nfdb_replace_veto_test()\n{\n\tRET=0\n\n\tbridge fdb add 00:01:02:03:04:05 dev vxlan0 self static \\\n\t       dst $REMOTE_IP_1\n\tcheck_err $? \"valid FDB rejected\"\n\n\tbridge fdb replace 00:01:02:03:04:05 dev vxlan0 self static \\\n\t       dst $REMOTE_IP_1 port 1234 2>/dev/null\n\tcheck_fail $? \"FDB with an explicit port not rejected\"\n\n\tbridge fdb replace 00:01:02:03:04:05 dev vxlan0 self static \\\n\t       dst $REMOTE_IP_1 port 1234 2>&1 >/dev/null \\\n\t    | grep -q mlxsw_spectrum\n\tcheck_err $? \"FDB with an explicit port rejected without extack\"\n\n\tlog_test \"vxlan FDB veto - replace\"\n}\n\nfdb_append_veto_test()\n{\n\tRET=0\n\n\tbridge fdb add 00:00:00:00:00:00 dev vxlan0 self static \\\n\t       dst $REMOTE_IP_1\n\tcheck_err $? \"valid FDB rejected\"\n\n\tbridge fdb append 00:00:00:00:00:00 dev vxlan0 self static \\\n\t       dst $REMOTE_IP_2 port 1234 2>/dev/null\n\tcheck_fail $? \"FDB with an explicit port not rejected\"\n\n\tbridge fdb append 00:00:00:00:00:00 dev vxlan0 self static \\\n\t       dst $REMOTE_IP_2 port 1234 2>&1 >/dev/null \\\n\t    | grep -q mlxsw_spectrum\n\tcheck_err $? \"FDB with an explicit port rejected without extack\"\n\n\tlog_test \"vxlan FDB veto - append\"\n}\n\nfdb_changelink_veto_test()\n{\n\tRET=0\n\n\tip link set dev vxlan0 type vxlan \\\n\t   group $MC_IP dev lo 2>/dev/null\n\tcheck_fail $? \"FDB with a multicast IP not rejected\"\n\n\tip link set dev vxlan0 type vxlan \\\n\t   group $MC_IP dev lo 2>&1 >/dev/null \\\n\t    | grep -q mlxsw_spectrum\n\tcheck_err $? \"FDB with a multicast IP rejected without extack\"\n\n\tlog_test \"vxlan FDB veto - changelink\"\n}\n\ntrap cleanup EXIT\n\nsetup_prepare\nsetup_wait\n\ntests_run\n\nexit $EXIT_STATUS\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}