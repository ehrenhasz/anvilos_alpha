{
  "module_name": "fib.sh",
  "hash_id": "0bdbc040d3caf8868d5422c21f71fe7d10d565472b0945f533c79568e9f761c2",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/drivers/net/mlxsw/fib.sh",
  "human_readable_source": "#!/bin/bash\n# SPDX-License-Identifier: GPL-2.0\n#\n# This test is for checking the FIB offload API on top of mlxsw.\n\nlib_dir=$(dirname $0)/../../../net/forwarding\n\nALL_TESTS=\"\n\tipv4_identical_routes\n\tipv4_tos\n\tipv4_metric\n\tipv4_replace\n\tipv4_delete\n\tipv4_plen\n\tipv4_replay\n\tipv4_flush\n\tipv4_local_replace\n\tipv6_add\n\tipv6_metric\n\tipv6_append_single\n\tipv6_replace_single\n\tipv6_metric_multipath\n\tipv6_append_multipath\n\tipv6_replace_multipath\n\tipv6_append_multipath_to_single\n\tipv6_delete_single\n\tipv6_delete_multipath\n\tipv6_replay_single\n\tipv6_replay_multipath\n\tipv6_local_replace\n\"\nNUM_NETIFS=0\nsource $lib_dir/lib.sh\nsource $lib_dir/devlink_lib.sh\nsource $lib_dir/fib_offload_lib.sh\n\nipv4_identical_routes()\n{\n\tfib_ipv4_identical_routes_test \"testns1\"\n}\n\nipv4_tos()\n{\n\tfib_ipv4_tos_test \"testns1\"\n}\n\nipv4_metric()\n{\n\tfib_ipv4_metric_test \"testns1\"\n}\n\nipv4_replace()\n{\n\tfib_ipv4_replace_test \"testns1\"\n}\n\nipv4_delete()\n{\n\tfib_ipv4_delete_test \"testns1\"\n}\n\nipv4_plen()\n{\n\tfib_ipv4_plen_test \"testns1\"\n}\n\nipv4_replay_metric()\n{\n\tfib_ipv4_replay_metric_test \"testns1\" \"$DEVLINK_DEV\"\n}\n\nipv4_replay_tos()\n{\n\tfib_ipv4_replay_tos_test \"testns1\" \"$DEVLINK_DEV\"\n}\n\nipv4_replay_plen()\n{\n\tfib_ipv4_replay_plen_test \"testns1\" \"$DEVLINK_DEV\"\n}\n\nipv4_replay()\n{\n\tipv4_replay_metric\n\tipv4_replay_tos\n\tipv4_replay_plen\n}\n\nipv4_flush()\n{\n\tfib_ipv4_flush_test \"testns1\"\n}\n\nipv4_local_replace()\n{\n\tlocal ns=\"testns1\"\n\n\tRET=0\n\n\tip -n $ns link add name dummy1 type dummy\n\tip -n $ns link set dev dummy1 up\n\n\tip -n $ns route add table local 192.0.2.1/32 dev dummy1\n\tfib4_trap_check $ns \"table local 192.0.2.1/32 dev dummy1\" false\n\tcheck_err $? \"Local table route not in hardware when should\"\n\n\tip -n $ns route add table main 192.0.2.1/32 dev dummy1\n\tfib4_trap_check $ns \"table main 192.0.2.1/32 dev dummy1\" true\n\tcheck_err $? \"Main table route in hardware when should not\"\n\n\tfib4_trap_check $ns \"table local 192.0.2.1/32 dev dummy1\" false\n\tcheck_err $? \"Local table route was replaced when should not\"\n\n\t# Test that local routes can replace routes in main table.\n\tip -n $ns route add table main 192.0.2.2/32 dev dummy1\n\tfib4_trap_check $ns \"table main 192.0.2.2/32 dev dummy1\" false\n\tcheck_err $? \"Main table route not in hardware when should\"\n\n\tip -n $ns route add table local 192.0.2.2/32 dev dummy1\n\tfib4_trap_check $ns \"table local 192.0.2.2/32 dev dummy1\" false\n\tcheck_err $? \"Local table route did not replace route in main table when should\"\n\n\tfib4_trap_check $ns \"table main 192.0.2.2/32 dev dummy1\" true\n\tcheck_err $? \"Main table route was not replaced when should\"\n\n\tlog_test \"IPv4 local table route replacement\"\n\n\tip -n $ns link del dev dummy1\n}\n\nipv6_add()\n{\n\tfib_ipv6_add_test \"testns1\"\n}\n\nipv6_metric()\n{\n\tfib_ipv6_metric_test \"testns1\"\n}\n\nipv6_append_single()\n{\n\tfib_ipv6_append_single_test \"testns1\"\n}\n\nipv6_replace_single()\n{\n\tfib_ipv6_replace_single_test \"testns1\"\n}\n\nipv6_metric_multipath()\n{\n\tfib_ipv6_metric_multipath_test \"testns1\"\n}\n\nipv6_append_multipath()\n{\n\tfib_ipv6_append_multipath_test \"testns1\"\n}\n\nipv6_replace_multipath()\n{\n\tfib_ipv6_replace_multipath_test \"testns1\"\n}\n\nipv6_append_multipath_to_single()\n{\n\tfib_ipv6_append_multipath_to_single_test \"testns1\"\n}\n\nipv6_delete_single()\n{\n\tfib_ipv6_delete_single_test \"testns1\"\n}\n\nipv6_delete_multipath()\n{\n\tfib_ipv6_delete_multipath_test \"testns1\"\n}\n\nipv6_replay_single()\n{\n\tfib_ipv6_replay_single_test \"testns1\" \"$DEVLINK_DEV\"\n}\n\nipv6_replay_multipath()\n{\n\tfib_ipv6_replay_multipath_test \"testns1\" \"$DEVLINK_DEV\"\n}\n\nipv6_local_replace()\n{\n\tlocal ns=\"testns1\"\n\n\tRET=0\n\n\tip -n $ns link add name dummy1 type dummy\n\tip -n $ns link set dev dummy1 up\n\n\tip -n $ns route add table local 2001:db8:1::1/128 dev dummy1\n\tfib6_trap_check $ns \"table local 2001:db8:1::1/128 dev dummy1\" false\n\tcheck_err $? \"Local table route not in hardware when should\"\n\n\tip -n $ns route add table main 2001:db8:1::1/128 dev dummy1\n\tfib6_trap_check $ns \"table main 2001:db8:1::1/128 dev dummy1\" true\n\tcheck_err $? \"Main table route in hardware when should not\"\n\n\tfib6_trap_check $ns \"table local 2001:db8:1::1/128 dev dummy1\" false\n\tcheck_err $? \"Local table route was replaced when should not\"\n\n\t# Test that local routes can replace routes in main table.\n\tip -n $ns route add table main 2001:db8:1::2/128 dev dummy1\n\tfib6_trap_check $ns \"table main 2001:db8:1::2/128 dev dummy1\" false\n\tcheck_err $? \"Main table route not in hardware when should\"\n\n\tip -n $ns route add table local 2001:db8:1::2/128 dev dummy1\n\tfib6_trap_check $ns \"table local 2001:db8:1::2/128 dev dummy1\" false\n\tcheck_err $? \"Local route route did not replace route in main table when should\"\n\n\tfib6_trap_check $ns \"table main 2001:db8:1::2/128 dev dummy1\" true\n\tcheck_err $? \"Main table route was not replaced when should\"\n\n\tlog_test \"IPv6 local table route replacement\"\n\n\tip -n $ns link del dev dummy1\n}\n\nfib_notify_on_flag_change_set()\n{\n\tlocal notify=$1; shift\n\n\tip netns exec testns1 sysctl -qw net.ipv4.fib_notify_on_flag_change=$notify\n\tip netns exec testns1 sysctl -qw net.ipv6.fib_notify_on_flag_change=$notify\n\n\tlog_info \"Set fib_notify_on_flag_change to $notify\"\n}\n\nsetup_prepare()\n{\n\tip netns add testns1\n\tif [ $? -ne 0 ]; then\n\t\techo \"Failed to add netns \\\"testns1\\\"\"\n\t\texit 1\n\tfi\n\n\tdevlink dev reload $DEVLINK_DEV netns testns1\n\tif [ $? -ne 0 ]; then\n\t\techo \"Failed to reload into netns \\\"testns1\\\"\"\n\t\texit 1\n\tfi\n}\n\ncleanup()\n{\n\tpre_cleanup\n\tdevlink -N testns1 dev reload $DEVLINK_DEV netns $$\n\tip netns del testns1\n}\n\ntrap cleanup EXIT\n\nsetup_prepare\n\nfib_notify_on_flag_change_set 1\ntests_run\n\nfib_notify_on_flag_change_set 0\ntests_run\n\nexit $EXIT_STATUS\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}