{
  "module_name": "resource_scale.sh",
  "hash_id": "11f12541c0d6da44fa420f5ccf1452dac031614810ba68a70544f60277d5ace0",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/drivers/net/mlxsw/spectrum-2/resource_scale.sh",
  "human_readable_source": "#!/bin/bash\n# SPDX-License-Identifier: GPL-2.0\n\nlib_dir=$(dirname $0)/../../../../net/forwarding\n\nNUM_NETIFS=6\nsource $lib_dir/lib.sh\nsource $lib_dir/tc_common.sh\nsource $lib_dir/devlink_lib.sh\nsource ../mlxsw_lib.sh\n\nmlxsw_only_on_spectrum 2+ || exit 1\n\ncurrent_test=\"\"\n\ncleanup()\n{\n\tpre_cleanup\n\tif [ ! -z $current_test ]; then\n\t\t${current_test}_cleanup\n\tfi\n\t# Need to reload in order to avoid router abort.\n\tdevlink_reload\n}\n\ntrap cleanup EXIT\n\nALL_TESTS=\"\n\trouter\n\ttc_flower\n\tmirror_gre\n\ttc_police\n\tport\n\trif_mac_profile\n\trif_counter\n\tport_range\n\"\n\nfor current_test in ${TESTS:-$ALL_TESTS}; do\n\tRET_FIN=0\n\tsource ${current_test}_scale.sh\n\n\tnum_netifs_var=${current_test^^}_NUM_NETIFS\n\tnum_netifs=${!num_netifs_var:-$NUM_NETIFS}\n\n\tfor should_fail in 0 1; do\n\t\tRET=0\n\t\ttarget=$(${current_test}_get_target \"$should_fail\")\n\t\tif ((target == 0)); then\n\t\t\tlog_test_skip \"'$current_test' should_fail=$should_fail test\"\n\t\t\tcontinue\n\t\tfi\n\n\t\t${current_test}_setup_prepare\n\t\tsetup_wait $num_netifs\n\t\t# Update target in case occupancy of a certain resource changed\n\t\t# following the test setup.\n\t\ttarget=$(${current_test}_get_target \"$should_fail\")\n\t\t${current_test}_test \"$target\" \"$should_fail\"\n\t\tif [[ \"$should_fail\" -eq 0 ]]; then\n\t\t\tlog_test \"'$current_test' $target\"\n\n\t\t\tif ((!RET)); then\n\t\t\t\ttt=${current_test}_traffic_test\n\t\t\t\tif [[ $(type -t $tt) == \"function\" ]]; then\n\t\t\t\t\t$tt \"$target\"\n\t\t\t\t\tlog_test \"'$current_test' $target traffic test\"\n\t\t\t\tfi\n\t\t\tfi\n\t\telse\n\t\t\tlog_test \"'$current_test' overflow $target\"\n\t\tfi\n\t\t${current_test}_cleanup $target\n\t\tdevlink_reload\n\t\tRET_FIN=$(( RET_FIN || RET ))\n\tdone\ndone\ncurrent_test=\"\"\n\nexit \"$RET_FIN\"\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}