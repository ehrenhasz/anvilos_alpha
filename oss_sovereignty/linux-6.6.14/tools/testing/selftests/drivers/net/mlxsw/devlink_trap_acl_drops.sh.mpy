{
  "module_name": "devlink_trap_acl_drops.sh",
  "hash_id": "c47b5bd81d9ea872bb7b30f505cb14b3548cdce4008428e0f6ff372ee679ee8c",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/drivers/net/mlxsw/devlink_trap_acl_drops.sh",
  "human_readable_source": "#!/bin/bash\n# SPDX-License-Identifier: GPL-2.0\n#\n# Test devlink-trap ACL drops functionality over mlxsw.\n\nlib_dir=$(dirname $0)/../../../net/forwarding\n\nALL_TESTS=\"\n\tingress_flow_action_drop_test\n\tegress_flow_action_drop_test\n\"\nNUM_NETIFS=4\nsource $lib_dir/tc_common.sh\nsource $lib_dir/lib.sh\nsource $lib_dir/devlink_lib.sh\n\nh1_create()\n{\n\tsimple_if_init $h1\n}\n\nh1_destroy()\n{\n\tsimple_if_fini $h1\n}\n\nh2_create()\n{\n\tsimple_if_init $h2\n}\n\nh2_destroy()\n{\n\tsimple_if_fini $h2\n}\n\nswitch_create()\n{\n\tip link add dev br0 type bridge vlan_filtering 1 mcast_snooping 0\n\n\tip link set dev $swp1 master br0\n\tip link set dev $swp2 master br0\n\n\tip link set dev br0 up\n\tip link set dev $swp1 up\n\tip link set dev $swp2 up\n\n\ttc qdisc add dev $swp1 clsact\n\ttc qdisc add dev $swp2 clsact\n}\n\nswitch_destroy()\n{\n\ttc qdisc del dev $swp2 clsact\n\ttc qdisc del dev $swp1 clsact\n\n\tip link set dev $swp2 down\n\tip link set dev $swp1 down\n\n\tip link del dev br0\n}\n\nsetup_prepare()\n{\n\th1=${NETIFS[p1]}\n\tswp1=${NETIFS[p2]}\n\n\tswp2=${NETIFS[p3]}\n\th2=${NETIFS[p4]}\n\n\th1mac=$(mac_get $h1)\n\th2mac=$(mac_get $h2)\n\n\tvrf_prepare\n\n\th1_create\n\th2_create\n\n\tswitch_create\n}\n\ncleanup()\n{\n\tpre_cleanup\n\n\tswitch_destroy\n\n\th2_destroy\n\th1_destroy\n\n\tvrf_cleanup\n}\n\ningress_flow_action_drop_test()\n{\n\tlocal mz_pid\n\n\ttc filter add dev $swp2 egress protocol ip pref 1 handle 101 \\\n\t\tflower src_mac $h1mac action pass\n\n\ttc filter add dev $swp1 ingress protocol ip pref 1 handle 101 \\\n\t\tflower dst_ip 192.0.2.2 action drop\n\n\t$MZ $h1 -c 0 -p 100 -a $h1mac -b $h2mac -A 192.0.2.1 -B 192.0.2.2 \\\n\t\t-t ip -d 1msec -q &\n\tmz_pid=$!\n\n\tRET=0\n\n\tdevlink_trap_drop_test ingress_flow_action_drop $swp2 101\n\n\tlog_test \"ingress_flow_action_drop\"\n\n\ttc filter del dev $swp1 ingress protocol ip pref 1 handle 101 flower\n\n\tdevlink_trap_drop_cleanup $mz_pid $swp2 ip 1 101\n}\n\negress_flow_action_drop_test()\n{\n\tlocal mz_pid\n\n\ttc filter add dev $swp2 egress protocol ip pref 2 handle 102 \\\n\t\tflower src_mac $h1mac action pass\n\n\ttc filter add dev $swp2 egress protocol ip pref 1 handle 101 \\\n\t\tflower dst_ip 192.0.2.2 action drop\n\n\t$MZ $h1 -c 0 -p 100 -a $h1mac -b $h2mac -A 192.0.2.1 -B 192.0.2.2 \\\n\t\t-t ip -d 1msec -q &\n\tmz_pid=$!\n\n\tRET=0\n\n\tdevlink_trap_drop_test egress_flow_action_drop $swp2 102\n\n\tlog_test \"egress_flow_action_drop\"\n\n\ttc filter del dev $swp2 egress protocol ip pref 1 handle 101 flower\n\n\tdevlink_trap_drop_cleanup $mz_pid $swp2 ip 2 102\n}\n\ntrap cleanup EXIT\n\nsetup_prepare\nsetup_wait\n\ntests_run\n\nexit $EXIT_STATUS\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}