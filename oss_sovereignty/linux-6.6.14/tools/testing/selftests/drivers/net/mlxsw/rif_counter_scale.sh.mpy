{
  "module_name": "rif_counter_scale.sh",
  "hash_id": "f63d286e404f65136fdebbe42c64f443b09ad9858a2b18b6ca3f400fbf998c7f",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/drivers/net/mlxsw/rif_counter_scale.sh",
  "human_readable_source": "# SPDX-License-Identifier: GPL-2.0\n\nRIF_COUNTER_NUM_NETIFS=2\n\nrif_counter_addr4()\n{\n\tlocal i=$1; shift\n\tlocal p=$1; shift\n\n\tprintf 192.0.%d.%d $((i / 64)) $(((4 * i % 256) + p))\n}\n\nrif_counter_addr4pfx()\n{\n\trif_counter_addr4 $@\n\tprintf /30\n}\n\nrif_counter_h1_create()\n{\n\tsimple_if_init $h1\n}\n\nrif_counter_h1_destroy()\n{\n\tsimple_if_fini $h1\n}\n\nrif_counter_h2_create()\n{\n\tsimple_if_init $h2\n}\n\nrif_counter_h2_destroy()\n{\n\tsimple_if_fini $h2\n}\n\nrif_counter_setup_prepare()\n{\n\th1=${NETIFS[p1]}\n\th2=${NETIFS[p2]}\n\n\tvrf_prepare\n\n\trif_counter_h1_create\n\trif_counter_h2_create\n}\n\nrif_counter_cleanup()\n{\n\tlocal count=$1; shift\n\n\tpre_cleanup\n\n\tfor ((i = 1; i <= count; i++)); do\n\t\tvlan_destroy $h2 $i\n\tdone\n\n\trif_counter_h2_destroy\n\trif_counter_h1_destroy\n\n\tvrf_cleanup\n\n\tif [[ -v RIF_COUNTER_BATCH_FILE ]]; then\n\t\trm -f $RIF_COUNTER_BATCH_FILE\n\tfi\n}\n\n\nrif_counter_test()\n{\n\tlocal count=$1; shift\n\tlocal should_fail=$1; shift\n\n\tRIF_COUNTER_BATCH_FILE=\"$(mktemp)\"\n\n\tfor ((i = 1; i <= count; i++)); do\n\t\tvlan_create $h2 $i v$h2 $(rif_counter_addr4pfx $i 2)\n\tdone\n\tfor ((i = 1; i <= count; i++)); do\n\t\tcat >> $RIF_COUNTER_BATCH_FILE <<-EOF\n\t\t\tstats set dev $h2.$i l3_stats on\n\t\tEOF\n\tdone\n\n\tip -b $RIF_COUNTER_BATCH_FILE\n\tcheck_err_fail $should_fail $? \"RIF counter enablement\"\n}\n\nrif_counter_traffic_test()\n{\n\tlocal count=$1; shift\n\tlocal i;\n\n\tfor ((i = count; i > 0; i /= 2)); do\n\t\t$MZ $h1 -Q $i -c 1 -d 20msec -p 100 -a own -b $(mac_get $h2) \\\n\t\t    -A $(rif_counter_addr4 $i 1) \\\n\t\t    -B $(rif_counter_addr4 $i 2) \\\n\t\t    -q -t udp sp=54321,dp=12345\n\tdone\n\tfor ((i = count; i > 0; i /= 2)); do\n\t\tbusywait \"$TC_HIT_TIMEOUT\" until_counter_is \"== 1\" \\\n\t\t\t hw_stats_get l3_stats $h2.$i rx packets > /dev/null\n\t\tcheck_err $? \"Traffic not seen at RIF $h2.$i\"\n\tdone\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}