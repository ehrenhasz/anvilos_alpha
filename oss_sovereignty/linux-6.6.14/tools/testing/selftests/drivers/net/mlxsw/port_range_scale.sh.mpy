{
  "module_name": "port_range_scale.sh",
  "hash_id": "ce8a26b4005b45160ebe994d792db50b53e7179bf6d29527b0aeacaa187527f4",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/drivers/net/mlxsw/port_range_scale.sh",
  "human_readable_source": "# SPDX-License-Identifier: GPL-2.0\n\nPORT_RANGE_NUM_NETIFS=2\n\nport_range_h1_create()\n{\n\tsimple_if_init $h1\n}\n\nport_range_h1_destroy()\n{\n\tsimple_if_fini $h1\n}\n\nport_range_switch_create()\n{\n\tsimple_if_init $swp1\n\ttc qdisc add dev $swp1 clsact\n}\n\nport_range_switch_destroy()\n{\n\ttc qdisc del dev $swp1 clsact\n\tsimple_if_fini $swp1\n}\n\nport_range_rules_create()\n{\n\tlocal count=$1; shift\n\tlocal should_fail=$1; shift\n\tlocal batch_file=\"$(mktemp)\"\n\n\tfor ((i = 0; i < count; ++i)); do\n\t\tcat >> $batch_file <<-EOF\n\t\t\tfilter add dev $swp1 ingress \\\n\t\t\t\tprot ipv4 \\\n\t\t\t\tpref 1000 \\\n\t\t\t\tflower skip_sw \\\n\t\t\t\tip_proto udp dst_port 1-$((100 + i)) \\\n\t\t\t\taction pass\n\t\tEOF\n\tdone\n\n\ttc -b $batch_file\n\tcheck_err_fail $should_fail $? \"Rule insertion\"\n\n\trm -f $batch_file\n}\n\n__port_range_test()\n{\n\tlocal count=$1; shift\n\tlocal should_fail=$1; shift\n\n\tport_range_rules_create $count $should_fail\n\n\toffload_count=$(tc -j filter show dev $swp1 ingress |\n\t\t\tjq \"[.[] | select(.options.in_hw == true)] | length\")\n\t((offload_count == count))\n\tcheck_err_fail $should_fail $? \"port range offload count\"\n}\n\nport_range_test()\n{\n\tlocal count=$1; shift\n\tlocal should_fail=$1; shift\n\n\tif ! tc_offload_check $PORT_RANGE_NUM_NETIFS; then\n\t\tcheck_err 1 \"Could not test offloaded functionality\"\n\t\treturn\n\tfi\n\n\t__port_range_test $count $should_fail\n}\n\nport_range_setup_prepare()\n{\n\th1=${NETIFS[p1]}\n\tswp1=${NETIFS[p2]}\n\n\tvrf_prepare\n\n\tport_range_h1_create\n\tport_range_switch_create\n}\n\nport_range_cleanup()\n{\n\tpre_cleanup\n\n\tport_range_switch_destroy\n\tport_range_h1_destroy\n\n\tvrf_cleanup\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}