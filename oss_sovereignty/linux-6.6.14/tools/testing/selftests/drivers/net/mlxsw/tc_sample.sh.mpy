{
  "module_name": "tc_sample.sh",
  "hash_id": "dfdc82064ac23bfcafb5bcb7c2bbeb5005a5ecc2bd78999ec601d62118ff3956",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/drivers/net/mlxsw/tc_sample.sh",
  "human_readable_source": "#!/bin/bash\n# SPDX-License-Identifier: GPL-2.0\n#\n# Test that packets are sampled when tc-sample is used and that reported\n# metadata is correct. Two sets of hosts (with and without LAG) are used, since\n# metadata extraction in mlxsw is a bit different when LAG is involved.\n#\n# +---------------------------------+       +---------------------------------+\n# | H1 (vrf)                        |       | H3 (vrf)                        |\n# |    + $h1                        |       |    + $h3_lag                    |\n# |    | 192.0.2.1/28               |       |    | 192.0.2.17/28              |\n# |    |                            |       |    |                            |\n# |    |  default via 192.0.2.2     |       |    |  default via 192.0.2.18    |\n# +----|----------------------------+       +----|----------------------------+\n#      |                                         |\n# +----|-----------------------------------------|----------------------------+\n# |    | 192.0.2.2/28                            | 192.0.2.18/28              |\n# |    + $rp1                                    + $rp3_lag                   |\n# |                                                                           |\n# |    + $rp2                                    + $rp4_lag                   |\n# |    | 198.51.100.2/28                         | 198.51.100.18/28           |\n# +----|-----------------------------------------|----------------------------+\n#      |                                         |\n# +----|----------------------------+       +----|----------------------------+\n# |    |  default via 198.51.100.2  |       |    |  default via 198.51.100.18 |\n# |    |                            |       |    |                            |\n# |    | 198.51.100.1/28            |       |    | 198.51.100.17/28           |\n# |    + $h2                        |       |    + $h4_lag                    |\n# | H2 (vrf)                        |       | H4 (vrf)                        |\n# +---------------------------------+       +---------------------------------+\n\nlib_dir=$(dirname $0)/../../../net/forwarding\n\nALL_TESTS=\"\n\ttc_sample_rate_test\n\ttc_sample_max_rate_test\n\ttc_sample_conflict_test\n\ttc_sample_group_conflict_test\n\ttc_sample_md_iif_test\n\ttc_sample_md_lag_iif_test\n\ttc_sample_md_oif_test\n\ttc_sample_md_lag_oif_test\n\ttc_sample_md_out_tc_test\n\ttc_sample_md_out_tc_occ_test\n\ttc_sample_md_latency_test\n\ttc_sample_acl_group_conflict_test\n\ttc_sample_acl_rate_test\n\ttc_sample_acl_max_rate_test\n\"\nNUM_NETIFS=8\nCAPTURE_FILE=$(mktemp)\nsource $lib_dir/lib.sh\nsource $lib_dir/devlink_lib.sh\nsource mlxsw_lib.sh\n\n# Available at https://github.com/Mellanox/libpsample\nrequire_command psample\n\nh1_create()\n{\n\tsimple_if_init $h1 192.0.2.1/28\n\n\tip -4 route add default vrf v$h1 nexthop via 192.0.2.2\n}\n\nh1_destroy()\n{\n\tip -4 route del default vrf v$h1 nexthop via 192.0.2.2\n\n\tsimple_if_fini $h1 192.0.2.1/28\n}\n\nh2_create()\n{\n\tsimple_if_init $h2 198.51.100.1/28\n\n\tip -4 route add default vrf v$h2 nexthop via 198.51.100.2\n}\n\nh2_destroy()\n{\n\tip -4 route del default vrf v$h2 nexthop via 198.51.100.2\n\n\tsimple_if_fini $h2 198.51.100.1/28\n}\n\nh3_create()\n{\n\tip link set dev $h3 down\n\tip link add name ${h3}_bond type bond mode 802.3ad\n\tip link set dev $h3 master ${h3}_bond\n\n\tsimple_if_init ${h3}_bond 192.0.2.17/28\n\n\tip -4 route add default vrf v${h3}_bond nexthop via 192.0.2.18\n}\n\nh3_destroy()\n{\n\tip -4 route del default vrf v${h3}_bond nexthop via 192.0.2.18\n\n\tsimple_if_fini ${h3}_bond 192.0.2.17/28\n\n\tip link set dev $h3 nomaster\n\tip link del dev ${h3}_bond\n}\n\nh4_create()\n{\n\tip link set dev $h4 down\n\tip link add name ${h4}_bond type bond mode 802.3ad\n\tip link set dev $h4 master ${h4}_bond\n\n\tsimple_if_init ${h4}_bond 198.51.100.17/28\n\n\tip -4 route add default vrf v${h4}_bond nexthop via 198.51.100.18\n}\n\nh4_destroy()\n{\n\tip -4 route del default vrf v${h4}_bond nexthop via 198.51.100.18\n\n\tsimple_if_fini ${h4}_bond 198.51.100.17/28\n\n\tip link set dev $h4 nomaster\n\tip link del dev ${h4}_bond\n}\n\nrouter_create()\n{\n\tip link set dev $rp1 up\n\t__addr_add_del $rp1 add 192.0.2.2/28\n\ttc qdisc add dev $rp1 clsact\n\n\tip link set dev $rp2 up\n\t__addr_add_del $rp2 add 198.51.100.2/28\n\ttc qdisc add dev $rp2 clsact\n\n\tip link add name ${rp3}_bond type bond mode 802.3ad\n\tip link set dev $rp3 master ${rp3}_bond\n\t__addr_add_del ${rp3}_bond add 192.0.2.18/28\n\ttc qdisc add dev $rp3 clsact\n\tip link set dev ${rp3}_bond up\n\n\tip link add name ${rp4}_bond type bond mode 802.3ad\n\tip link set dev $rp4 master ${rp4}_bond\n\t__addr_add_del ${rp4}_bond add 198.51.100.18/28\n\ttc qdisc add dev $rp4 clsact\n\tip link set dev ${rp4}_bond up\n}\n\nrouter_destroy()\n{\n\tip link set dev ${rp4}_bond down\n\ttc qdisc del dev $rp4 clsact\n\t__addr_add_del ${rp4}_bond del 198.51.100.18/28\n\tip link set dev $rp4 nomaster\n\tip link del dev ${rp4}_bond\n\n\tip link set dev ${rp3}_bond down\n\ttc qdisc del dev $rp3 clsact\n\t__addr_add_del ${rp3}_bond del 192.0.2.18/28\n\tip link set dev $rp3 nomaster\n\tip link del dev ${rp3}_bond\n\n\ttc qdisc del dev $rp2 clsact\n\t__addr_add_del $rp2 del 198.51.100.2/28\n\tip link set dev $rp2 down\n\n\ttc qdisc del dev $rp1 clsact\n\t__addr_add_del $rp1 del 192.0.2.2/28\n\tip link set dev $rp1 down\n}\n\nsetup_prepare()\n{\n\th1=${NETIFS[p1]}\n\trp1=${NETIFS[p2]}\n\trp2=${NETIFS[p3]}\n\th2=${NETIFS[p4]}\n\th3=${NETIFS[p5]}\n\trp3=${NETIFS[p6]}\n\th4=${NETIFS[p7]}\n\trp4=${NETIFS[p8]}\n\n\tvrf_prepare\n\n\th1_create\n\th2_create\n\th3_create\n\th4_create\n\trouter_create\n}\n\ncleanup()\n{\n\tpre_cleanup\n\n\trm -f $CAPTURE_FILE\n\n\trouter_destroy\n\th4_destroy\n\th3_destroy\n\th2_destroy\n\th1_destroy\n\n\tvrf_cleanup\n}\n\npsample_capture_start()\n{\n\trm -f $CAPTURE_FILE\n\n\tpsample &> $CAPTURE_FILE &\n\n\tsleep 1\n}\n\npsample_capture_stop()\n{\n\t{ kill %% && wait %%; } 2>/dev/null\n}\n\n__tc_sample_rate_test()\n{\n\tlocal desc=$1; shift\n\tlocal dip=$1; shift\n\tlocal pkts pct\n\n\tRET=0\n\n\ttc filter add dev $rp1 ingress protocol all pref 1 handle 101 matchall \\\n\t\tskip_sw action sample rate 32 group 1\n\tcheck_err $? \"Failed to configure sampling rule\"\n\n\tpsample_capture_start\n\n\tip vrf exec v$h1 $MZ $h1 -c 320000 -d 100usec -p 64 -A 192.0.2.1 \\\n\t\t-B $dip -t udp dp=52768,sp=42768 -q\n\n\tpsample_capture_stop\n\n\tpkts=$(grep -e \"group 1 \" $CAPTURE_FILE | wc -l)\n\tpct=$((100 * (pkts - 10000) / 10000))\n\t(( -25 <= pct && pct <= 25))\n\tcheck_err $? \"Expected 10000 packets, got $pkts packets, which is $pct% off. Required accuracy is +-25%\"\n\n\tlog_test \"tc sample rate ($desc)\"\n\n\ttc filter del dev $rp1 ingress protocol all pref 1 handle 101 matchall\n}\n\ntc_sample_rate_test()\n{\n\t__tc_sample_rate_test \"forward\" 198.51.100.1\n\t__tc_sample_rate_test \"local receive\" 192.0.2.2\n}\n\ntc_sample_max_rate_test()\n{\n\tRET=0\n\n\ttc filter add dev $rp1 ingress protocol all pref 1 handle 101 matchall \\\n\t\tskip_sw action sample rate $((35 * 10 ** 8)) group 1\n\tcheck_err $? \"Failed to configure sampling rule with max rate\"\n\n\ttc filter del dev $rp1 ingress protocol all pref 1 handle 101 matchall\n\n\ttc filter add dev $rp1 ingress protocol all pref 1 handle 101 matchall \\\n\t\tskip_sw action sample rate $((35 * 10 ** 8 + 1)) \\\n\t\tgroup 1 &> /dev/null\n\tcheck_fail $? \"Managed to configure sampling rate above maximum\"\n\n\tlog_test \"tc sample maximum rate\"\n}\n\ntc_sample_conflict_test()\n{\n\tRET=0\n\n\t# Test that two sampling rules cannot be configured on the same port,\n\t# even when they share the same parameters.\n\n\ttc filter add dev $rp1 ingress protocol all pref 1 handle 101 matchall \\\n\t\tskip_sw action sample rate 1024 group 1\n\tcheck_err $? \"Failed to configure sampling rule\"\n\n\ttc filter add dev $rp1 ingress protocol all pref 2 handle 102 matchall \\\n\t\tskip_sw action sample rate 1024 group 1 &> /dev/null\n\tcheck_fail $? \"Managed to configure second sampling rule\"\n\n\t# Delete the first rule and make sure the second rule can now be\n\t# configured.\n\n\ttc filter del dev $rp1 ingress protocol all pref 1 handle 101 matchall\n\n\ttc filter add dev $rp1 ingress protocol all pref 2 handle 102 matchall \\\n\t\tskip_sw action sample rate 1024 group 1\n\tcheck_err $? \"Failed to configure sampling rule after deletion\"\n\n\tlog_test \"tc sample conflict test\"\n\n\ttc filter del dev $rp1 ingress protocol all pref 2 handle 102 matchall\n}\n\ntc_sample_group_conflict_test()\n{\n\tRET=0\n\n\t# Test that two sampling rules cannot be configured on the same port\n\t# with different groups.\n\n\ttc filter add dev $rp1 ingress protocol all pref 1 handle 101 matchall \\\n\t\tskip_sw action sample rate 1024 group 1\n\tcheck_err $? \"Failed to configure sampling rule\"\n\n\ttc filter add dev $rp1 ingress protocol all pref 2 handle 102 matchall \\\n\t\tskip_sw action sample rate 1024 group 2 &> /dev/null\n\tcheck_fail $? \"Managed to configure sampling rule with conflicting group\"\n\n\tlog_test \"tc sample group conflict test\"\n\n\ttc filter del dev $rp1 ingress protocol all pref 1 handle 101 matchall\n}\n\ntc_sample_md_iif_test()\n{\n\tlocal rp1_ifindex\n\n\tRET=0\n\n\ttc filter add dev $rp1 ingress protocol all pref 1 handle 101 matchall \\\n\t\tskip_sw action sample rate 5 group 1\n\tcheck_err $? \"Failed to configure sampling rule\"\n\n\tpsample_capture_start\n\n\tip vrf exec v$h1 $MZ $h1 -c 3200 -d 1msec -p 64 -A 192.0.2.1 \\\n\t\t-B 198.51.100.1 -t udp dp=52768,sp=42768 -q\n\n\tpsample_capture_stop\n\n\trp1_ifindex=$(ip -j -p link show dev $rp1 | jq '.[][\"ifindex\"]')\n\tgrep -q -e \"in-ifindex $rp1_ifindex \" $CAPTURE_FILE\n\tcheck_err $? \"Sampled packets do not have expected in-ifindex\"\n\n\tlog_test \"tc sample iif\"\n\n\ttc filter del dev $rp1 ingress protocol all pref 1 handle 101 matchall\n}\n\ntc_sample_md_lag_iif_test()\n{\n\tlocal rp3_ifindex\n\n\tRET=0\n\n\ttc filter add dev $rp3 ingress protocol all pref 1 handle 101 matchall \\\n\t\tskip_sw action sample rate 5 group 1\n\tcheck_err $? \"Failed to configure sampling rule\"\n\n\tpsample_capture_start\n\n\tip vrf exec v${h3}_bond $MZ ${h3}_bond -c 3200 -d 1msec -p 64 \\\n\t\t-A 192.0.2.17 -B 198.51.100.17 -t udp dp=52768,sp=42768 -q\n\n\tpsample_capture_stop\n\n\trp3_ifindex=$(ip -j -p link show dev $rp3 | jq '.[][\"ifindex\"]')\n\tgrep -q -e \"in-ifindex $rp3_ifindex \" $CAPTURE_FILE\n\tcheck_err $? \"Sampled packets do not have expected in-ifindex\"\n\n\tlog_test \"tc sample lag iif\"\n\n\ttc filter del dev $rp3 ingress protocol all pref 1 handle 101 matchall\n}\n\ntc_sample_md_oif_test()\n{\n\tlocal rp2_ifindex\n\n\tRET=0\n\n\ttc filter add dev $rp1 ingress protocol all pref 1 handle 101 matchall \\\n\t\tskip_sw action sample rate 5 group 1\n\tcheck_err $? \"Failed to configure sampling rule\"\n\n\tpsample_capture_start\n\n\tip vrf exec v$h1 $MZ $h1 -c 3200 -d 1msec -p 64 -A 192.0.2.1 \\\n\t\t-B 198.51.100.1 -t udp dp=52768,sp=42768 -q\n\n\tpsample_capture_stop\n\n\trp2_ifindex=$(ip -j -p link show dev $rp2 | jq '.[][\"ifindex\"]')\n\tgrep -q -e \"out-ifindex $rp2_ifindex \" $CAPTURE_FILE\n\tcheck_err $? \"Sampled packets do not have expected out-ifindex\"\n\n\tlog_test \"tc sample oif\"\n\n\ttc filter del dev $rp1 ingress protocol all pref 1 handle 101 matchall\n}\n\ntc_sample_md_lag_oif_test()\n{\n\tlocal rp4_ifindex\n\n\tRET=0\n\n\ttc filter add dev $rp3 ingress protocol all pref 1 handle 101 matchall \\\n\t\tskip_sw action sample rate 5 group 1\n\tcheck_err $? \"Failed to configure sampling rule\"\n\n\tpsample_capture_start\n\n\tip vrf exec v${h3}_bond $MZ ${h3}_bond -c 3200 -d 1msec -p 64 \\\n\t\t-A 192.0.2.17 -B 198.51.100.17 -t udp dp=52768,sp=42768 -q\n\n\tpsample_capture_stop\n\n\trp4_ifindex=$(ip -j -p link show dev $rp4 | jq '.[][\"ifindex\"]')\n\tgrep -q -e \"out-ifindex $rp4_ifindex \" $CAPTURE_FILE\n\tcheck_err $? \"Sampled packets do not have expected out-ifindex\"\n\n\tlog_test \"tc sample lag oif\"\n\n\ttc filter del dev $rp3 ingress protocol all pref 1 handle 101 matchall\n}\n\ntc_sample_md_out_tc_test()\n{\n\tRET=0\n\n\t# Output traffic class is not supported on Spectrum-1.\n\tmlxsw_only_on_spectrum 2+ || return\n\n\ttc filter add dev $rp1 ingress protocol all pref 1 handle 101 matchall \\\n\t\tskip_sw action sample rate 5 group 1\n\tcheck_err $? \"Failed to configure sampling rule\"\n\n\t# By default, all the packets should go to the same traffic class (0).\n\n\tpsample_capture_start\n\n\tip vrf exec v$h1 $MZ $h1 -c 3200 -d 1msec -p 64 -A 192.0.2.1 \\\n\t\t-B 198.51.100.1 -t udp dp=52768,sp=42768 -q\n\n\tpsample_capture_stop\n\n\tgrep -q -e \"out-tc 0 \" $CAPTURE_FILE\n\tcheck_err $? \"Sampled packets do not have expected out-tc (0)\"\n\n\t# Map all priorities to highest traffic class (7) and check reported\n\t# out-tc.\n\ttc qdisc replace dev $rp2 root handle 1: \\\n\t\tprio bands 3 priomap 0 0 0 0 0 0 0 0\n\n\tpsample_capture_start\n\n\tip vrf exec v$h1 $MZ $h1 -c 3200 -d 1msec -p 64 -A 192.0.2.1 \\\n\t\t-B 198.51.100.1 -t udp dp=52768,sp=42768 -q\n\n\tpsample_capture_stop\n\n\tgrep -q -e \"out-tc 7 \" $CAPTURE_FILE\n\tcheck_err $? \"Sampled packets do not have expected out-tc (7)\"\n\n\tlog_test \"tc sample out-tc\"\n\n\ttc qdisc del dev $rp2 root handle 1:\n\ttc filter del dev $rp1 ingress protocol all pref 1 handle 101 matchall\n}\n\ntc_sample_md_out_tc_occ_test()\n{\n\tlocal backlog pct occ\n\n\tRET=0\n\n\t# Output traffic class occupancy is not supported on Spectrum-1.\n\tmlxsw_only_on_spectrum 2+ || return\n\n\ttc filter add dev $rp1 ingress protocol all pref 1 handle 101 matchall \\\n\t\tskip_sw action sample rate 1024 group 1\n\tcheck_err $? \"Failed to configure sampling rule\"\n\n\t# Configure a shaper on egress to create congestion.\n\ttc qdisc replace dev $rp2 root handle 1: \\\n\t\ttbf rate 1Mbit burst 256k limit 1M\n\n\tpsample_capture_start\n\n\tip vrf exec v$h1 $MZ $h1 -c 0 -d 1usec -p 1400 -A 192.0.2.1 \\\n\t\t-B 198.51.100.1 -t udp dp=52768,sp=42768 -q &\n\n\t# Allow congestion to reach steady state.\n\tsleep 10\n\n\tbacklog=$(tc -j -p -s qdisc show dev $rp2 | jq '.[0][\"backlog\"]')\n\n\t# Kill mausezahn.\n\t{ kill %% && wait %%; } 2>/dev/null\n\n\tpsample_capture_stop\n\n\t# Record last congestion sample.\n\tocc=$(grep -e \"out-tc-occ \" $CAPTURE_FILE | tail -n 1 | \\\n\t\tcut -d ' ' -f 16)\n\n\tpct=$((100 * (occ - backlog) / backlog))\n\t(( -1 <= pct && pct <= 1))\n\tcheck_err $? \"Recorded a congestion of $backlog bytes, but sampled congestion is $occ bytes, which is $pct% off. Required accuracy is +-5%\"\n\n\tlog_test \"tc sample out-tc-occ\"\n\n\ttc qdisc del dev $rp2 root handle 1:\n\ttc filter del dev $rp1 ingress protocol all pref 1 handle 101 matchall\n}\n\ntc_sample_md_latency_test()\n{\n\tRET=0\n\n\t# Egress sampling not supported on Spectrum-1.\n\tmlxsw_only_on_spectrum 2+ || return\n\n\ttc filter add dev $rp2 egress protocol all pref 1 handle 101 matchall \\\n\t\tskip_sw action sample rate 5 group 1\n\tcheck_err $? \"Failed to configure sampling rule\"\n\n\tpsample_capture_start\n\n\tip vrf exec v$h1 $MZ $h1 -c 3200 -d 1msec -p 64 -A 192.0.2.1 \\\n\t\t-B 198.51.100.1 -t udp dp=52768,sp=42768 -q\n\n\tpsample_capture_stop\n\n\tgrep -q -e \"latency \" $CAPTURE_FILE\n\tcheck_err $? \"Sampled packets do not have latency attribute\"\n\n\tlog_test \"tc sample latency\"\n\n\ttc filter del dev $rp2 egress protocol all pref 1 handle 101 matchall\n}\n\ntc_sample_acl_group_conflict_test()\n{\n\tRET=0\n\n\t# Test that two flower sampling rules cannot be configured on the same\n\t# port with different groups.\n\n\t# Policy-based sampling is not supported on Spectrum-1.\n\tmlxsw_only_on_spectrum 2+ || return\n\n\ttc filter add dev $rp1 ingress protocol ip pref 1 handle 101 flower \\\n\t\tskip_sw action sample rate 1024 group 1\n\tcheck_err $? \"Failed to configure sampling rule\"\n\n\ttc filter add dev $rp1 ingress protocol ip pref 2 handle 102 flower \\\n\t\tskip_sw action sample rate 1024 group 1\n\tcheck_err $? \"Failed to configure sampling rule with same group\"\n\n\ttc filter add dev $rp1 ingress protocol ip pref 3 handle 103 flower \\\n\t\tskip_sw action sample rate 1024 group 2 &> /dev/null\n\tcheck_fail $? \"Managed to configure sampling rule with conflicting group\"\n\n\tlog_test \"tc sample (w/ flower) group conflict test\"\n\n\ttc filter del dev $rp1 ingress protocol ip pref 2 handle 102 flower\n\ttc filter del dev $rp1 ingress protocol ip pref 1 handle 101 flower\n}\n\n__tc_sample_acl_rate_test()\n{\n\tlocal bind=$1; shift\n\tlocal port=$1; shift\n\tlocal pkts pct\n\n\tRET=0\n\n\t# Policy-based sampling is not supported on Spectrum-1.\n\tmlxsw_only_on_spectrum 2+ || return\n\n\ttc filter add dev $port $bind protocol ip pref 1 handle 101 flower \\\n\t\tskip_sw dst_ip 198.51.100.1 action sample rate 32 group 1\n\tcheck_err $? \"Failed to configure sampling rule\"\n\n\tpsample_capture_start\n\n\tip vrf exec v$h1 $MZ $h1 -c 320000 -d 100usec -p 64 -A 192.0.2.1 \\\n\t\t-B 198.51.100.1 -t udp dp=52768,sp=42768 -q\n\n\tpsample_capture_stop\n\n\tpkts=$(grep -e \"group 1 \" $CAPTURE_FILE | wc -l)\n\tpct=$((100 * (pkts - 10000) / 10000))\n\t(( -25 <= pct && pct <= 25))\n\tcheck_err $? \"Expected 10000 packets, got $pkts packets, which is $pct% off. Required accuracy is +-25%\"\n\n\t# Setup a filter that should not match any packet and make sure packets\n\t# are not sampled.\n\ttc filter del dev $port $bind protocol ip pref 1 handle 101 flower\n\n\ttc filter add dev $port $bind protocol ip pref 1 handle 101 flower \\\n\t\tskip_sw dst_ip 198.51.100.10 action sample rate 32 group 1\n\tcheck_err $? \"Failed to configure sampling rule\"\n\n\tpsample_capture_start\n\n\tip vrf exec v$h1 $MZ $h1 -c 3200 -d 1msec -p 64 -A 192.0.2.1 \\\n\t\t-B 198.51.100.1 -t udp dp=52768,sp=42768 -q\n\n\tpsample_capture_stop\n\n\tgrep -q -e \"group 1 \" $CAPTURE_FILE\n\tcheck_fail $? \"Sampled packets when should not\"\n\n\tlog_test \"tc sample (w/ flower) rate ($bind)\"\n\n\ttc filter del dev $port $bind protocol ip pref 1 handle 101 flower\n}\n\ntc_sample_acl_rate_test()\n{\n\t__tc_sample_acl_rate_test ingress $rp1\n\t__tc_sample_acl_rate_test egress $rp2\n}\n\ntc_sample_acl_max_rate_test()\n{\n\tRET=0\n\n\t# Policy-based sampling is not supported on Spectrum-1.\n\tmlxsw_only_on_spectrum 2+ || return\n\n\ttc filter add dev $rp1 ingress protocol ip pref 1 handle 101 flower \\\n\t\tskip_sw action sample rate $((2 ** 24 - 1)) group 1\n\tcheck_err $? \"Failed to configure sampling rule with max rate\"\n\n\ttc filter del dev $rp1 ingress protocol ip pref 1 handle 101 flower\n\n\ttc filter add dev $rp1 ingress protocol ip pref 1 handle 101 flower \\\n\t\tskip_sw action sample rate $((2 ** 24)) \\\n\t\tgroup 1 &> /dev/null\n\tcheck_fail $? \"Managed to configure sampling rate above maximum\"\n\n\tlog_test \"tc sample (w/ flower) maximum rate\"\n}\n\ntrap cleanup EXIT\n\nsetup_prepare\nsetup_wait\n\ntests_run\n\nexit $EXIT_STATUS\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}