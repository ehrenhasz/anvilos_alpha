{
  "module_name": "setns-dcache.c",
  "hash_id": "9ac1f7f7d8729314eb22ac0c27405f23f18b1e87b272995ccfc8b997224006ed",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/proc/setns-dcache.c",
  "human_readable_source": " \n \n#undef NDEBUG\n#include <assert.h>\n#include <errno.h>\n#include <sched.h>\n#include <signal.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <sys/socket.h>\n\nstatic pid_t pid = -1;\n\nstatic void f(void)\n{\n\tif (pid > 0) {\n\t\tkill(pid, SIGTERM);\n\t}\n}\n\nint main(void)\n{\n\tint fd[2];\n\tchar _ = 0;\n\tint nsfd;\n\n\tatexit(f);\n\n\t \n\tif (unshare(CLONE_NEWNET) == -1) {\n\t\tif (errno == ENOSYS || errno == EPERM) {\n\t\t\treturn 4;\n\t\t}\n\t\treturn 1;\n\t}\n\t \n\tif (socket(AF_UNIX, SOCK_STREAM, 0) == -1) {\n\t\treturn 1;\n\t}\n\n\tif (pipe(fd) == -1) {\n\t\treturn 1;\n\t}\n\n\tpid = fork();\n\tif (pid == -1) {\n\t\treturn 1;\n\t}\n\n\tif (pid == 0) {\n\t\tif (unshare(CLONE_NEWNET) == -1) {\n\t\t\treturn 1;\n\t\t}\n\n\t\tif (write(fd[1], &_, 1) != 1) {\n\t\t\treturn 1;\n\t\t}\n\n\t\tpause();\n\n\t\treturn 0;\n\t}\n\n\tif (read(fd[0], &_, 1) != 1) {\n\t\treturn 1;\n\t}\n\n\t{\n\t\tchar buf[64];\n\t\tsnprintf(buf, sizeof(buf), \"/proc/%u/ns/net\", pid);\n\t\tnsfd = open(buf, O_RDONLY);\n\t\tif (nsfd == -1) {\n\t\t\treturn 1;\n\t\t}\n\t}\n\n\t \n\t(void)open(\"/proc/net/unix\", O_RDONLY);\n\n\tif (setns(nsfd, CLONE_NEWNET) == -1) {\n\t\treturn 1;\n\t}\n\n\tkill(pid, SIGTERM);\n\tpid = 0;\n\n\t{\n\t\tchar buf[4096];\n\t\tssize_t rv;\n\t\tint fd;\n\n\t\tfd = open(\"/proc/net/unix\", O_RDONLY);\n\t\tif (fd == -1) {\n\t\t\treturn 1;\n\t\t}\n\n#define S \"Num       RefCount Protocol Flags    Type St Inode Path\\n\"\n\t\trv = read(fd, buf, sizeof(buf));\n\n\t\tassert(rv == strlen(S));\n\t\tassert(memcmp(buf, S, strlen(S)) == 0);\n\t}\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}