{
  "module_name": "media_device_test.c",
  "hash_id": "dd82a7c009a9dd7d10ce3e2af655f1e44f0592f480abefbcd15293922c1260ca",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/media_tests/media_device_test.c",
  "human_readable_source": "\n\n \n\n \n\n#include <stdio.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <string.h>\n#include <fcntl.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <time.h>\n#include <linux/media.h>\n\n#include \"../kselftest.h\"\n\nint main(int argc, char **argv)\n{\n\tint opt;\n\tchar media_device[256];\n\tint count;\n\tstruct media_device_info mdi;\n\tint ret;\n\tint fd;\n\n\tif (argc < 2) {\n\t\tprintf(\"Usage: %s [-d </dev/mediaX>]\\n\", argv[0]);\n\t\texit(-1);\n\t}\n\n\t \n\twhile ((opt = getopt(argc, argv, \"d:\")) != -1) {\n\t\tswitch (opt) {\n\t\tcase 'd':\n\t\t\tstrncpy(media_device, optarg, sizeof(media_device) - 1);\n\t\t\tmedia_device[sizeof(media_device)-1] = '\\0';\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tprintf(\"Usage: %s [-d </dev/mediaX>]\\n\", argv[0]);\n\t\t\texit(-1);\n\t\t}\n\t}\n\n\tif (getuid() != 0)\n\t\tksft_exit_skip(\"Please run the test as root - Exiting.\\n\");\n\n\t \n\tsrand((unsigned int) time(NULL));\n\tcount = rand();\n\n\t \n\tfd = open(media_device, O_RDWR);\n\tif (fd == -1) {\n\t\tprintf(\"Media Device open errno %s\\n\", strerror(errno));\n\t\texit(-1);\n\t}\n\n\tprintf(\"\\nNote:\\n\"\n\t       \"While test is running, remove the device and\\n\"\n\t       \"ensure there are no use after free errors and\\n\"\n\t       \"other Oops in the dmesg. Enable KaSan kernel\\n\"\n\t       \"config option for use-after-free error detection.\\n\\n\");\n\n\tprintf(\"Running test for %d iterations\\n\", count);\n\n\twhile (count > 0) {\n\t\tret = ioctl(fd, MEDIA_IOC_DEVICE_INFO, &mdi);\n\t\tif (ret < 0)\n\t\t\tprintf(\"Media Device Info errno %s\\n\", strerror(errno));\n\t\telse\n\t\t\tprintf(\"Media device model %s driver %s - count %d\\n\",\n\t\t\t\tmdi.model, mdi.driver, count);\n\t\tsleep(10);\n\t\tcount--;\n\t}\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}