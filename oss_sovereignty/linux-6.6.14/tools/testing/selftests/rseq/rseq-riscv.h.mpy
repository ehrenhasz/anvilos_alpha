{
  "module_name": "rseq-riscv.h",
  "hash_id": "b50e2d7d26c83d7cc1c3cecc4ebd99fcd0510efd5db7d702c9ceeb3261ff2219",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/rseq/rseq-riscv.h",
  "human_readable_source": " \n \n#include <endian.h>\n\n#if defined(__BYTE_ORDER) ? (__BYTE_ORDER == __LITTLE_ENDIAN) : defined(__LITTLE_ENDIAN)\n#define RSEQ_SIG   0xf1401073   \n#else\n#error \"Currently, RSEQ only supports Little-Endian version\"\n#endif\n\n#if __riscv_xlen == 64\n#define __REG_SEL(a, b)\ta\n#elif __riscv_xlen == 32\n#define __REG_SEL(a, b)\tb\n#endif\n\n#define REG_L\t__REG_SEL(\"ld \", \"lw \")\n#define REG_S\t__REG_SEL(\"sd \", \"sw \")\n\n#define RISCV_FENCE(p, s) \\\n\t__asm__ __volatile__ (\"fence \" #p \",\" #s : : : \"memory\")\n#define rseq_smp_mb()\tRISCV_FENCE(rw, rw)\n#define rseq_smp_rmb()\tRISCV_FENCE(r, r)\n#define rseq_smp_wmb()\tRISCV_FENCE(w, w)\n#define RSEQ_ASM_TMP_REG_1\t\"t6\"\n#define RSEQ_ASM_TMP_REG_2\t\"t5\"\n#define RSEQ_ASM_TMP_REG_3\t\"t4\"\n#define RSEQ_ASM_TMP_REG_4\t\"t3\"\n\n#define rseq_smp_load_acquire(p)\t\t\t\t\t\\\n__extension__ ({\t\t\t\t\t\t\t\\\n\trseq_unqual_scalar_typeof(*(p)) ____p1 = RSEQ_READ_ONCE(*(p));\t\\\n\tRISCV_FENCE(r, rw);\t\t\t\t\t\t\\\n\t____p1;\t\t\t\t\t\t\t\t\\\n})\n\n#define rseq_smp_acquire__after_ctrl_dep()\trseq_smp_rmb()\n\n#define rseq_smp_store_release(p, v)\t\t\t\t\t\\\ndo {\t\t\t\t\t\t\t\t\t\\\n\tRISCV_FENCE(rw, w);\t\t\t\t\t\t\\\n\tRSEQ_WRITE_ONCE(*(p), v);\t\t\t\t\t\\\n} while (0)\n\n#define __RSEQ_ASM_DEFINE_TABLE(label, version, flags, start_ip,\t\\\n\t\t\t\tpost_commit_offset, abort_ip)\t\t\\\n\t\".pushsection\t__rseq_cs, \\\"aw\\\"\\n\"\t\t\t\t\\\n\t\".balign\t32\\n\"\t\t\t\t\t\t\\\n\t__rseq_str(label) \":\\n\"\t\t\t\t\t\t\\\n\t\".long\t\" __rseq_str(version) \", \" __rseq_str(flags) \"\\n\"\t\\\n\t\".quad\t\" __rseq_str(start_ip) \", \"\t\t\t\t\\\n\t\t\t  __rseq_str(post_commit_offset) \", \"\t\t\\\n\t\t\t  __rseq_str(abort_ip) \"\\n\"\t\t\t\\\n\t\".popsection\\n\\t\"\t\t\t\t\t\t\\\n\t\".pushsection __rseq_cs_ptr_array, \\\"aw\\\"\\n\"\t\t\t\\\n\t\".quad \" __rseq_str(label) \"b\\n\"\t\t\t\t\\\n\t\".popsection\\n\"\n\n#define RSEQ_ASM_DEFINE_TABLE(label, start_ip, post_commit_ip, abort_ip) \\\n\t__RSEQ_ASM_DEFINE_TABLE(label, 0x0, 0x0, start_ip,\t\t \\\n\t\t\t\t((post_commit_ip) - (start_ip)), abort_ip)\n\n \n#define RSEQ_ASM_DEFINE_EXIT_POINT(start_ip, exit_ip)\t\t\t\\\n\t\".pushsection __rseq_exit_point_array, \\\"aw\\\"\\n\"\t\t\\\n\t\".quad \" __rseq_str(start_ip) \", \" __rseq_str(exit_ip) \"\\n\"\t\\\n\t\".popsection\\n\"\n\n#define RSEQ_ASM_STORE_RSEQ_CS(label, cs_label, rseq_cs)\t\t\\\n\tRSEQ_INJECT_ASM(1)\t\t\t\t\t\t\\\n\t\"la\t\" RSEQ_ASM_TMP_REG_1 \", \" __rseq_str(cs_label) \"\\n\"\t\\\n\tREG_S\tRSEQ_ASM_TMP_REG_1 \", %[\" __rseq_str(rseq_cs) \"]\\n\"\t\\\n\t__rseq_str(label) \":\\n\"\n\n#define RSEQ_ASM_DEFINE_ABORT(label, abort_label)\t\t\t\\\n\t\"j\t222f\\n\"\t\t\t\t\t\t\t\\\n\t\".balign\t4\\n\"\t\t\t\t\t\t\\\n\t\".long \"\t__rseq_str(RSEQ_SIG) \"\\n\"\t\t\t\\\n\t__rseq_str(label) \":\\n\"\t\t\t\t\t\t\\\n\t\"j\t%l[\" __rseq_str(abort_label) \"]\\n\"\t\t\t\\\n\t\"222:\\n\"\n\n#define RSEQ_ASM_OP_STORE(value, var)\t\t\t\t\t\\\n\tREG_S\t\"%[\" __rseq_str(value) \"], %[\" __rseq_str(var) \"]\\n\"\n\n#define RSEQ_ASM_OP_CMPEQ(var, expect, label)\t\t\t\t\\\n\tREG_L\tRSEQ_ASM_TMP_REG_1 \", %[\" __rseq_str(var) \"]\\n\"\t\t\\\n\t\"bne\t\" RSEQ_ASM_TMP_REG_1 \", %[\" __rseq_str(expect) \"] ,\"\t\\\n\t\t  __rseq_str(label) \"\\n\"\n\n#define RSEQ_ASM_OP_CMPEQ32(var, expect, label)\t\t\t\t\\\n\t\"lw\t\" RSEQ_ASM_TMP_REG_1 \", %[\" __rseq_str(var) \"]\\n\"\t\\\n\t\"bne\t\" RSEQ_ASM_TMP_REG_1 \", %[\" __rseq_str(expect) \"] ,\"\t\\\n\t\t  __rseq_str(label) \"\\n\"\n\n#define RSEQ_ASM_OP_CMPNE(var, expect, label)\t\t\t\t\\\n\tREG_L\tRSEQ_ASM_TMP_REG_1 \", %[\" __rseq_str(var) \"]\\n\"\t\t\\\n\t\"beq\t\" RSEQ_ASM_TMP_REG_1 \", %[\" __rseq_str(expect) \"] ,\"\t\\\n\t\t  __rseq_str(label) \"\\n\"\n\n#define RSEQ_ASM_CMP_CPU_ID(cpu_id, current_cpu_id, label)\t\t\\\n\tRSEQ_INJECT_ASM(2)\t\t\t\t\t\t\\\n\tRSEQ_ASM_OP_CMPEQ32(current_cpu_id, cpu_id, label)\n\n#define RSEQ_ASM_OP_R_LOAD(var)\t\t\t\t\t\t\\\n\tREG_L\tRSEQ_ASM_TMP_REG_1 \", %[\" __rseq_str(var) \"]\\n\"\n\n#define RSEQ_ASM_OP_R_STORE(var)\t\t\t\t\t\\\n\tREG_S\tRSEQ_ASM_TMP_REG_1 \", %[\" __rseq_str(var) \"]\\n\"\n\n#define RSEQ_ASM_OP_R_LOAD_OFF(offset)\t\t\t\t\t\\\n\t\"add\t\" RSEQ_ASM_TMP_REG_1 \", %[\" __rseq_str(offset) \"], \"\t\\\n\t\t RSEQ_ASM_TMP_REG_1 \"\\n\"\t\t\t\t\\\n\tREG_L\tRSEQ_ASM_TMP_REG_1 \", (\" RSEQ_ASM_TMP_REG_1 \")\\n\"\n\n#define RSEQ_ASM_OP_R_ADD(count)\t\t\t\t\t\\\n\t\"add\t\" RSEQ_ASM_TMP_REG_1 \", \" RSEQ_ASM_TMP_REG_1\t\t\\\n\t\t\", %[\" __rseq_str(count) \"]\\n\"\n\n#define RSEQ_ASM_OP_FINAL_STORE(value, var, post_commit_label)\t\t\\\n\tRSEQ_ASM_OP_STORE(value, var)\t\t\t\t\t\\\n\t__rseq_str(post_commit_label) \":\\n\"\n\n#define RSEQ_ASM_OP_FINAL_STORE_RELEASE(value, var, post_commit_label)\t\\\n\t\"fence\trw, w\\n\"\t\t\t\t\t\t\\\n\tRSEQ_ASM_OP_STORE(value, var)\t\t\t\t\t\\\n\t__rseq_str(post_commit_label) \":\\n\"\n\n#define RSEQ_ASM_OP_R_FINAL_STORE(var, post_commit_label)\t\t\\\n\tREG_S\tRSEQ_ASM_TMP_REG_1 \", %[\" __rseq_str(var) \"]\\n\"\t\t\\\n\t__rseq_str(post_commit_label) \":\\n\"\n\n#define RSEQ_ASM_OP_R_BAD_MEMCPY(dst, src, len)\t\t\t\t\\\n\t\"beqz\t%[\" __rseq_str(len) \"], 333f\\n\"\t\t\t\t\\\n\t\"mv\t\" RSEQ_ASM_TMP_REG_1 \", %[\" __rseq_str(len) \"]\\n\"\t\\\n\t\"mv\t\" RSEQ_ASM_TMP_REG_2 \", %[\" __rseq_str(src) \"]\\n\"\t\\\n\t\"mv\t\" RSEQ_ASM_TMP_REG_3 \", %[\" __rseq_str(dst) \"]\\n\"\t\\\n\t\"222:\\n\"\t\t\t\t\t\t\t\\\n\t\"lb\t\" RSEQ_ASM_TMP_REG_4 \", 0(\" RSEQ_ASM_TMP_REG_2 \")\\n\"\t\\\n\t\"sb\t\" RSEQ_ASM_TMP_REG_4 \", 0(\" RSEQ_ASM_TMP_REG_3 \")\\n\"\t\\\n\t\"addi\t\" RSEQ_ASM_TMP_REG_1 \", \" RSEQ_ASM_TMP_REG_1 \", -1\\n\"\t\\\n\t\"addi\t\" RSEQ_ASM_TMP_REG_2 \", \" RSEQ_ASM_TMP_REG_2 \", 1\\n\"\t\\\n\t\"addi\t\" RSEQ_ASM_TMP_REG_3 \", \" RSEQ_ASM_TMP_REG_3 \", 1\\n\"\t\\\n\t\"bnez\t\" RSEQ_ASM_TMP_REG_1 \", 222b\\n\"\t\t\t\t\\\n\t\"333:\\n\"\n\n#define RSEQ_ASM_OP_R_DEREF_ADDV(ptr, off, post_commit_label)\t\t\\\n\t\"mv\t\" RSEQ_ASM_TMP_REG_1 \", %[\" __rseq_str(ptr) \"]\\n\"\t\\\n\tRSEQ_ASM_OP_R_ADD(off)\t\t\t\t\t\t\\\n\tREG_L\t  RSEQ_ASM_TMP_REG_1 \", 0(\" RSEQ_ASM_TMP_REG_1 \")\\n\"\t\\\n\tRSEQ_ASM_OP_R_ADD(inc)\t\t\t\t\t\t\\\n\t__rseq_str(post_commit_label) \":\\n\"\n\n \n\n#define RSEQ_TEMPLATE_CPU_ID\n#define RSEQ_TEMPLATE_MO_RELAXED\n#include \"rseq-riscv-bits.h\"\n#undef RSEQ_TEMPLATE_MO_RELAXED\n\n#define RSEQ_TEMPLATE_MO_RELEASE\n#include \"rseq-riscv-bits.h\"\n#undef RSEQ_TEMPLATE_MO_RELEASE\n#undef RSEQ_TEMPLATE_CPU_ID\n\n \n\n#define RSEQ_TEMPLATE_MM_CID\n#define RSEQ_TEMPLATE_MO_RELAXED\n#include \"rseq-riscv-bits.h\"\n#undef RSEQ_TEMPLATE_MO_RELAXED\n\n#define RSEQ_TEMPLATE_MO_RELEASE\n#include \"rseq-riscv-bits.h\"\n#undef RSEQ_TEMPLATE_MO_RELEASE\n#undef RSEQ_TEMPLATE_MM_CID\n\n \n\n#define RSEQ_TEMPLATE_CPU_ID_NONE\n#define RSEQ_TEMPLATE_MO_RELAXED\n#include \"rseq-riscv-bits.h\"\n#undef RSEQ_TEMPLATE_MO_RELAXED\n#undef RSEQ_TEMPLATE_CPU_ID_NONE\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}