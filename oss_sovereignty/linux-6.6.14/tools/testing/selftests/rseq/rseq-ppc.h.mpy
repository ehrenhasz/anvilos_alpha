{
  "module_name": "rseq-ppc.h",
  "hash_id": "38f9e98c679eb14554503fbb7ad10207186f55c15880c4333d9b26f65197b3df",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/rseq/rseq-ppc.h",
  "human_readable_source": " \n \n\n \n\n#define RSEQ_SIG\t0x0fe5000b\n\n#define rseq_smp_mb()\t\t__asm__ __volatile__ (\"sync\"\t::: \"memory\", \"cc\")\n#define rseq_smp_lwsync()\t__asm__ __volatile__ (\"lwsync\"\t::: \"memory\", \"cc\")\n#define rseq_smp_rmb()\t\trseq_smp_lwsync()\n#define rseq_smp_wmb()\t\trseq_smp_lwsync()\n\n#define rseq_smp_load_acquire(p)\t\t\t\t\t\\\n__extension__ ({\t\t\t\t\t\t\t\\\n\trseq_unqual_scalar_typeof(*(p)) ____p1 = RSEQ_READ_ONCE(*(p));\t\\\n\trseq_smp_lwsync();\t\t\t\t\t\t\\\n\t____p1;\t\t\t\t\t\t\t\t\\\n})\n\n#define rseq_smp_acquire__after_ctrl_dep()\trseq_smp_lwsync()\n\n#define rseq_smp_store_release(p, v)\t\t\t\t\t\\\ndo {\t\t\t\t\t\t\t\t\t\\\n\trseq_smp_lwsync();\t\t\t\t\t\t\\\n\tRSEQ_WRITE_ONCE(*(p), v);\t\t\t\t\t\\\n} while (0)\n\n \n\n#ifdef __PPC64__\n\n#define RSEQ_STORE_LONG(arg)\t\"std%U[\" __rseq_str(arg) \"]%X[\" __rseq_str(arg) \"] \"\t \n#define RSEQ_STORE_INT(arg)\t\"stw%U[\" __rseq_str(arg) \"]%X[\" __rseq_str(arg) \"] \"\t \n#define RSEQ_LOAD_LONG(arg)\t\"ld%U[\" __rseq_str(arg) \"]%X[\" __rseq_str(arg) \"] \"\t \n#define RSEQ_LOAD_INT(arg)\t\"lwz%U[\" __rseq_str(arg) \"]%X[\" __rseq_str(arg) \"] \"\t \n#define RSEQ_LOADX_LONG\t\t\"ldx \"\t\t\t\t\t\t\t \n#define RSEQ_CMP_LONG\t\t\"cmpd \"\n#define RSEQ_CMP_LONG_INT\t\"cmpdi \"\n\n#define __RSEQ_ASM_DEFINE_TABLE(label, version, flags,\t\t\t\t\\\n\t\t\tstart_ip, post_commit_offset, abort_ip)\t\t\t\\\n\t\t\".pushsection __rseq_cs, \\\"aw\\\"\\n\\t\"\t\t\t\t\\\n\t\t\".balign 32\\n\\t\"\t\t\t\t\t\t\\\n\t\t__rseq_str(label) \":\\n\\t\"\t\t\t\t\t\\\n\t\t\".long \" __rseq_str(version) \", \" __rseq_str(flags) \"\\n\\t\"\t\\\n\t\t\".quad \" __rseq_str(start_ip) \", \" __rseq_str(post_commit_offset) \", \" __rseq_str(abort_ip) \"\\n\\t\" \\\n\t\t\".popsection\\n\\t\"\t\t\t\t\t\t\\\n\t\t\".pushsection __rseq_cs_ptr_array, \\\"aw\\\"\\n\\t\"\t\t\t\\\n\t\t\".quad \" __rseq_str(label) \"b\\n\\t\"\t\t\t\t\\\n\t\t\".popsection\\n\\t\"\n\n#define RSEQ_ASM_STORE_RSEQ_CS(label, cs_label, rseq_cs)\t\t\t\\\n\t\tRSEQ_INJECT_ASM(1)\t\t\t\t\t\t\\\n\t\t\"lis %%r17, (\" __rseq_str(cs_label) \")@highest\\n\\t\"\t\t\\\n\t\t\"ori %%r17, %%r17, (\" __rseq_str(cs_label) \")@higher\\n\\t\"\t\\\n\t\t\"rldicr %%r17, %%r17, 32, 31\\n\\t\"\t\t\t\t\\\n\t\t\"oris %%r17, %%r17, (\" __rseq_str(cs_label) \")@high\\n\\t\"\t\\\n\t\t\"ori %%r17, %%r17, (\" __rseq_str(cs_label) \")@l\\n\\t\"\t\t\\\n\t\t\"std %%r17, %[\" __rseq_str(rseq_cs) \"]\\n\\t\"\t\t\t\\\n\t\t__rseq_str(label) \":\\n\\t\"\n\n \n#define RSEQ_ASM_DEFINE_EXIT_POINT(start_ip, exit_ip)\t\t\t\\\n\t\t\".pushsection __rseq_exit_point_array, \\\"aw\\\"\\n\\t\"\t\\\n\t\t\".quad \" __rseq_str(start_ip) \", \" __rseq_str(exit_ip) \"\\n\\t\" \\\n\t\t\".popsection\\n\\t\"\n\n#else  \n\n#define RSEQ_STORE_LONG(arg)\t\"stw%U[\" __rseq_str(arg) \"]%X[\" __rseq_str(arg) \"] \"\t \n#define RSEQ_STORE_INT(arg)\tRSEQ_STORE_LONG(arg)\t\t\t\t\t \n#define RSEQ_LOAD_LONG(arg)\t\"lwz%U[\" __rseq_str(arg) \"]%X[\" __rseq_str(arg) \"] \"\t \n#define RSEQ_LOAD_INT(arg)\tRSEQ_LOAD_LONG(arg)\t\t\t\t\t \n#define RSEQ_LOADX_LONG\t\t\"lwzx \"\t\t\t\t\t\t\t \n#define RSEQ_CMP_LONG\t\t\"cmpw \"\n#define RSEQ_CMP_LONG_INT\t\"cmpwi \"\n\n#define __RSEQ_ASM_DEFINE_TABLE(label, version, flags,\t\t\t\t\\\n\t\t\tstart_ip, post_commit_offset, abort_ip)\t\t\t\\\n\t\t\".pushsection __rseq_cs, \\\"aw\\\"\\n\\t\"\t\t\t\t\\\n\t\t\".balign 32\\n\\t\"\t\t\t\t\t\t\\\n\t\t__rseq_str(label) \":\\n\\t\"\t\t\t\t\t\\\n\t\t\".long \" __rseq_str(version) \", \" __rseq_str(flags) \"\\n\\t\"\t\\\n\t\t \t\t\t\t\\\n\t\t\".long 0x0, \" __rseq_str(start_ip) \", 0x0, \" __rseq_str(post_commit_offset) \", 0x0, \" __rseq_str(abort_ip) \"\\n\\t\" \\\n\t\t\".popsection\\n\\t\"\t\t\t\t\t\\\n\t\t\".pushsection __rseq_cs_ptr_array, \\\"aw\\\"\\n\\t\"\t\t\\\n\t\t\".long 0x0, \" __rseq_str(label) \"b\\n\\t\"\t\t\t\\\n\t\t\".popsection\\n\\t\"\n\n \n#define RSEQ_ASM_DEFINE_EXIT_POINT(start_ip, exit_ip)\t\t\t\t\\\n\t\t\".pushsection __rseq_exit_point_array, \\\"aw\\\"\\n\\t\"\t\t\\\n\t\t \t\t\t\t\\\n\t\t\".long 0x0, \" __rseq_str(start_ip) \", 0x0, \" __rseq_str(exit_ip) \"\\n\\t\"\t\\\n\t\t\".popsection\\n\\t\"\n\n#define RSEQ_ASM_STORE_RSEQ_CS(label, cs_label, rseq_cs)\t\t\t\\\n\t\tRSEQ_INJECT_ASM(1)\t\t\t\t\t\t\\\n\t\t\"lis %%r17, (\" __rseq_str(cs_label) \")@ha\\n\\t\"\t\t\t\\\n\t\t\"addi %%r17, %%r17, (\" __rseq_str(cs_label) \")@l\\n\\t\"\t\t\\\n\t\tRSEQ_STORE_INT(rseq_cs) \"%%r17, %[\" __rseq_str(rseq_cs) \"]\\n\\t\"\t\\\n\t\t__rseq_str(label) \":\\n\\t\"\n\n#endif  \n\n#define RSEQ_ASM_DEFINE_TABLE(label, start_ip, post_commit_ip, abort_ip)\t\\\n\t\t__RSEQ_ASM_DEFINE_TABLE(label, 0x0, 0x0, start_ip,\t\t\\\n\t\t\t\t\t(post_commit_ip - start_ip), abort_ip)\n\n#define RSEQ_ASM_CMP_CPU_ID(cpu_id, current_cpu_id, label)\t\t\t\\\n\t\tRSEQ_INJECT_ASM(2)\t\t\t\t\t\t\\\n\t\tRSEQ_LOAD_INT(current_cpu_id) \"%%r17, %[\" __rseq_str(current_cpu_id) \"]\\n\\t\" \\\n\t\t\"cmpw cr7, %[\" __rseq_str(cpu_id) \"], %%r17\\n\\t\"\t\t\\\n\t\t\"bne- cr7, \" __rseq_str(label) \"\\n\\t\"\n\n#define RSEQ_ASM_DEFINE_ABORT(label, abort_label)\t\t\t\t\\\n\t\t\".pushsection __rseq_failure, \\\"ax\\\"\\n\\t\"\t\t\t\\\n\t\t\".long \" __rseq_str(RSEQ_SIG) \"\\n\\t\"\t\t\t\t\\\n\t\t__rseq_str(label) \":\\n\\t\"\t\t\t\t\t\\\n\t\t\"b %l[\" __rseq_str(abort_label) \"]\\n\\t\"\t\t\t\t\\\n\t\t\".popsection\\n\\t\"\n\n \n#define RSEQ_ASM_OP_CMPEQ(var, expect, label)\t\t\t\t\t\\\n\t\tRSEQ_LOAD_LONG(var) \"%%r17, %[\" __rseq_str(var) \"]\\n\\t\"\t\t\\\n\t\tRSEQ_CMP_LONG \"cr7, %%r17, %[\" __rseq_str(expect) \"]\\n\\t\"\t\t\\\n\t\t\"bne- cr7, \" __rseq_str(label) \"\\n\\t\"\n\n#define RSEQ_ASM_OP_CMPNE(var, expectnot, label)\t\t\t\t\\\n\t\tRSEQ_LOAD_LONG(var) \"%%r17, %[\" __rseq_str(var) \"]\\n\\t\"\t\t\\\n\t\tRSEQ_CMP_LONG \"cr7, %%r17, %[\" __rseq_str(expectnot) \"]\\n\\t\"\t\t\\\n\t\t\"beq- cr7, \" __rseq_str(label) \"\\n\\t\"\n\n#define RSEQ_ASM_OP_STORE(value, var)\t\t\t\t\t\t\\\n\t\tRSEQ_STORE_LONG(var) \"%[\" __rseq_str(value) \"], %[\" __rseq_str(var) \"]\\n\\t\"\n\n \n#define RSEQ_ASM_OP_R_LOAD(var)\t\t\t\t\t\t\t\\\n\t\tRSEQ_LOAD_LONG(var) \"%%r17, %[\" __rseq_str(var) \"]\\n\\t\"\n\n \n#define RSEQ_ASM_OP_R_STORE(var)\t\t\t\t\t\t\\\n\t\tRSEQ_STORE_LONG(var) \"%%r17, %[\" __rseq_str(var) \"]\\n\\t\"\n\n \n#define RSEQ_ASM_OP_R_ADD(count)\t\t\t\t\t\t\\\n\t\t\"add %%r17, %[\" __rseq_str(count) \"], %%r17\\n\\t\"\n\n \n#define RSEQ_ASM_OP_R_LOADX(voffp)\t\t\t\t\t\t\\\n\t\tRSEQ_LOADX_LONG \"%%r17, %[\" __rseq_str(voffp) \"], %%r17\\n\\t\"\n\n \n#define RSEQ_ASM_OP_R_MEMCPY() \\\n\t\tRSEQ_CMP_LONG_INT \"%%r19, 0\\n\\t\" \\\n\t\t\"beq 333f\\n\\t\" \\\n\t\t\"addi %%r20, %%r20, -1\\n\\t\" \\\n\t\t\"addi %%r21, %%r21, -1\\n\\t\" \\\n\t\t\"222:\\n\\t\" \\\n\t\t\"lbzu %%r18, 1(%%r20)\\n\\t\" \\\n\t\t\"stbu %%r18, 1(%%r21)\\n\\t\" \\\n\t\t\"addi %%r19, %%r19, -1\\n\\t\" \\\n\t\tRSEQ_CMP_LONG_INT \"%%r19, 0\\n\\t\" \\\n\t\t\"bne 222b\\n\\t\" \\\n\t\t\"333:\\n\\t\" \\\n\n#define RSEQ_ASM_OP_R_FINAL_STORE(var, post_commit_label)\t\t\t\\\n\t\tRSEQ_STORE_LONG(var) \"%%r17, %[\" __rseq_str(var) \"]\\n\\t\"\t\t\t\\\n\t\t__rseq_str(post_commit_label) \":\\n\\t\"\n\n#define RSEQ_ASM_OP_FINAL_STORE(value, var, post_commit_label)\t\t\t\\\n\t\tRSEQ_STORE_LONG(var) \"%[\" __rseq_str(value) \"], %[\" __rseq_str(var) \"]\\n\\t\" \\\n\t\t__rseq_str(post_commit_label) \":\\n\\t\"\n\n \n\n#define RSEQ_TEMPLATE_CPU_ID\n#define RSEQ_TEMPLATE_MO_RELAXED\n#include \"rseq-ppc-bits.h\"\n#undef RSEQ_TEMPLATE_MO_RELAXED\n\n#define RSEQ_TEMPLATE_MO_RELEASE\n#include \"rseq-ppc-bits.h\"\n#undef RSEQ_TEMPLATE_MO_RELEASE\n#undef RSEQ_TEMPLATE_CPU_ID\n\n \n\n#define RSEQ_TEMPLATE_MM_CID\n#define RSEQ_TEMPLATE_MO_RELAXED\n#include \"rseq-ppc-bits.h\"\n#undef RSEQ_TEMPLATE_MO_RELAXED\n\n#define RSEQ_TEMPLATE_MO_RELEASE\n#include \"rseq-ppc-bits.h\"\n#undef RSEQ_TEMPLATE_MO_RELEASE\n#undef RSEQ_TEMPLATE_MM_CID\n\n \n\n#define RSEQ_TEMPLATE_CPU_ID_NONE\n#define RSEQ_TEMPLATE_MO_RELAXED\n#include \"rseq-ppc-bits.h\"\n#undef RSEQ_TEMPLATE_MO_RELAXED\n#undef RSEQ_TEMPLATE_CPU_ID_NONE\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}