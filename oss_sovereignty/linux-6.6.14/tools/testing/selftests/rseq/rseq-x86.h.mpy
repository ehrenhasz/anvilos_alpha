{
  "module_name": "rseq-x86.h",
  "hash_id": "54c3e3a01d45a6e865f10da519d09d180ee670a44c01aecff1dd7d9d2cc62b3b",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/rseq/rseq-x86.h",
  "human_readable_source": " \n \n\n#ifndef RSEQ_H\n#error \"Never use <rseq-x86.h> directly; include <rseq.h> instead.\"\n#endif\n\n#include <stdint.h>\n\n \n#define RSEQ_SIG\t0x53053053\n\n \n\n \n#define RSEQ_CPU_ID_OFFSET\t4\n#define RSEQ_CS_OFFSET\t\t8\n#define RSEQ_MM_CID_OFFSET\t24\n\n#ifdef __x86_64__\n\n#define RSEQ_ASM_TP_SEGMENT\t%%fs\n\n#define rseq_smp_mb()\t\\\n\t__asm__ __volatile__ (\"lock; addl $0,-128(%%rsp)\" ::: \"memory\", \"cc\")\n#define rseq_smp_rmb()\trseq_barrier()\n#define rseq_smp_wmb()\trseq_barrier()\n\n#define rseq_smp_load_acquire(p)\t\t\t\t\t\\\n__extension__ ({\t\t\t\t\t\t\t\\\n\trseq_unqual_scalar_typeof(*(p)) ____p1 = RSEQ_READ_ONCE(*(p));\t\\\n\trseq_barrier();\t\t\t\t\t\t\t\\\n\t____p1;\t\t\t\t\t\t\t\t\\\n})\n\n#define rseq_smp_acquire__after_ctrl_dep()\trseq_smp_rmb()\n\n#define rseq_smp_store_release(p, v)\t\t\t\t\t\\\ndo {\t\t\t\t\t\t\t\t\t\\\n\trseq_barrier();\t\t\t\t\t\t\t\\\n\tRSEQ_WRITE_ONCE(*(p), v);\t\t\t\t\t\\\n} while (0)\n\n#define __RSEQ_ASM_DEFINE_TABLE(label, version, flags,\t\t\t\\\n\t\t\t\tstart_ip, post_commit_offset, abort_ip)\t\\\n\t\t\".pushsection __rseq_cs, \\\"aw\\\"\\n\\t\"\t\t\t\\\n\t\t\".balign 32\\n\\t\"\t\t\t\t\t\\\n\t\t__rseq_str(label) \":\\n\\t\"\t\t\t\t\\\n\t\t\".long \" __rseq_str(version) \", \" __rseq_str(flags) \"\\n\\t\" \\\n\t\t\".quad \" __rseq_str(start_ip) \", \" __rseq_str(post_commit_offset) \", \" __rseq_str(abort_ip) \"\\n\\t\" \\\n\t\t\".popsection\\n\\t\"\t\t\t\t\t\\\n\t\t\".pushsection __rseq_cs_ptr_array, \\\"aw\\\"\\n\\t\"\t\t\\\n\t\t\".quad \" __rseq_str(label) \"b\\n\\t\"\t\t\t\\\n\t\t\".popsection\\n\\t\"\n\n\n#define RSEQ_ASM_DEFINE_TABLE(label, start_ip, post_commit_ip, abort_ip) \\\n\t__RSEQ_ASM_DEFINE_TABLE(label, 0x0, 0x0, start_ip,\t\t\\\n\t\t\t\t(post_commit_ip - start_ip), abort_ip)\n\n \n#define RSEQ_ASM_DEFINE_EXIT_POINT(start_ip, exit_ip)\t\t\t\\\n\t\t\".pushsection __rseq_exit_point_array, \\\"aw\\\"\\n\\t\"\t\\\n\t\t\".quad \" __rseq_str(start_ip) \", \" __rseq_str(exit_ip) \"\\n\\t\" \\\n\t\t\".popsection\\n\\t\"\n\n#define RSEQ_ASM_STORE_RSEQ_CS(label, cs_label, rseq_cs)\t\t\\\n\t\tRSEQ_INJECT_ASM(1)\t\t\t\t\t\\\n\t\t\"leaq \" __rseq_str(cs_label) \"(%%rip), %%rax\\n\\t\"\t\\\n\t\t\"movq %%rax, \" __rseq_str(rseq_cs) \"\\n\\t\"\t\t\\\n\t\t__rseq_str(label) \":\\n\\t\"\n\n#define RSEQ_ASM_CMP_CPU_ID(cpu_id, current_cpu_id, label)\t\t\\\n\t\tRSEQ_INJECT_ASM(2)\t\t\t\t\t\\\n\t\t\"cmpl %[\" __rseq_str(cpu_id) \"], \" __rseq_str(current_cpu_id) \"\\n\\t\" \\\n\t\t\"jnz \" __rseq_str(label) \"\\n\\t\"\n\n#define RSEQ_ASM_DEFINE_ABORT(label, teardown, abort_label)\t\t\\\n\t\t\".pushsection __rseq_failure, \\\"ax\\\"\\n\\t\"\t\t\\\n\t\t  \\\n\t\t\".byte 0x0f, 0xb9, 0x3d\\n\\t\"\t\t\t\t\\\n\t\t\".long \" __rseq_str(RSEQ_SIG) \"\\n\\t\"\t\t\t\\\n\t\t__rseq_str(label) \":\\n\\t\"\t\t\t\t\\\n\t\tteardown\t\t\t\t\t\t\\\n\t\t\"jmp %l[\" __rseq_str(abort_label) \"]\\n\\t\"\t\t\\\n\t\t\".popsection\\n\\t\"\n\n#define RSEQ_ASM_DEFINE_CMPFAIL(label, teardown, cmpfail_label)\t\t\\\n\t\t\".pushsection __rseq_failure, \\\"ax\\\"\\n\\t\"\t\t\\\n\t\t__rseq_str(label) \":\\n\\t\"\t\t\t\t\\\n\t\tteardown\t\t\t\t\t\t\\\n\t\t\"jmp %l[\" __rseq_str(cmpfail_label) \"]\\n\\t\"\t\t\\\n\t\t\".popsection\\n\\t\"\n\n#elif defined(__i386__)\n\n#define RSEQ_ASM_TP_SEGMENT\t%%gs\n\n#define rseq_smp_mb()\t\\\n\t__asm__ __volatile__ (\"lock; addl $0,-128(%%esp)\" ::: \"memory\", \"cc\")\n#define rseq_smp_rmb()\t\\\n\t__asm__ __volatile__ (\"lock; addl $0,-128(%%esp)\" ::: \"memory\", \"cc\")\n#define rseq_smp_wmb()\t\\\n\t__asm__ __volatile__ (\"lock; addl $0,-128(%%esp)\" ::: \"memory\", \"cc\")\n\n#define rseq_smp_load_acquire(p)\t\t\t\t\t\\\n__extension__ ({\t\t\t\t\t\t\t\\\n\t__typeof(*p) ____p1 = RSEQ_READ_ONCE(*p);\t\t\t\\\n\trseq_smp_mb();\t\t\t\t\t\t\t\\\n\t____p1;\t\t\t\t\t\t\t\t\\\n})\n\n#define rseq_smp_acquire__after_ctrl_dep()\trseq_smp_rmb()\n\n#define rseq_smp_store_release(p, v)\t\t\t\t\t\\\ndo {\t\t\t\t\t\t\t\t\t\\\n\trseq_smp_mb();\t\t\t\t\t\t\t\\\n\tRSEQ_WRITE_ONCE(*p, v);\t\t\t\t\t\t\\\n} while (0)\n\n \n#define __RSEQ_ASM_DEFINE_TABLE(label, version, flags,\t\t\t\\\n\t\t\t\tstart_ip, post_commit_offset, abort_ip)\t\\\n\t\t\".pushsection __rseq_cs, \\\"aw\\\"\\n\\t\"\t\t\t\\\n\t\t\".balign 32\\n\\t\"\t\t\t\t\t\\\n\t\t__rseq_str(label) \":\\n\\t\"\t\t\t\t\\\n\t\t\".long \" __rseq_str(version) \", \" __rseq_str(flags) \"\\n\\t\" \\\n\t\t\".long \" __rseq_str(start_ip) \", 0x0, \" __rseq_str(post_commit_offset) \", 0x0, \" __rseq_str(abort_ip) \", 0x0\\n\\t\" \\\n\t\t\".popsection\\n\\t\"\t\t\t\t\t\\\n\t\t\".pushsection __rseq_cs_ptr_array, \\\"aw\\\"\\n\\t\"\t\t\\\n\t\t\".long \" __rseq_str(label) \"b, 0x0\\n\\t\"\t\t\t\\\n\t\t\".popsection\\n\\t\"\n\n#define RSEQ_ASM_DEFINE_TABLE(label, start_ip, post_commit_ip, abort_ip) \\\n\t__RSEQ_ASM_DEFINE_TABLE(label, 0x0, 0x0, start_ip,\t\t\\\n\t\t\t\t(post_commit_ip - start_ip), abort_ip)\n\n \n#define RSEQ_ASM_DEFINE_EXIT_POINT(start_ip, exit_ip)\t\t\t\\\n\t\t\".pushsection __rseq_exit_point_array, \\\"aw\\\"\\n\\t\"\t\\\n\t\t\".long \" __rseq_str(start_ip) \", 0x0, \" __rseq_str(exit_ip) \", 0x0\\n\\t\" \\\n\t\t\".popsection\\n\\t\"\n\n#define RSEQ_ASM_STORE_RSEQ_CS(label, cs_label, rseq_cs)\t\t\\\n\t\tRSEQ_INJECT_ASM(1)\t\t\t\t\t\\\n\t\t\"movl $\" __rseq_str(cs_label) \", \" __rseq_str(rseq_cs) \"\\n\\t\"\t\\\n\t\t__rseq_str(label) \":\\n\\t\"\n\n#define RSEQ_ASM_CMP_CPU_ID(cpu_id, current_cpu_id, label)\t\t\\\n\t\tRSEQ_INJECT_ASM(2)\t\t\t\t\t\\\n\t\t\"cmpl %[\" __rseq_str(cpu_id) \"], \" __rseq_str(current_cpu_id) \"\\n\\t\" \\\n\t\t\"jnz \" __rseq_str(label) \"\\n\\t\"\n\n#define RSEQ_ASM_DEFINE_ABORT(label, teardown, abort_label)\t\t\\\n\t\t\".pushsection __rseq_failure, \\\"ax\\\"\\n\\t\"\t\t\\\n\t\t \t\\\n\t\t\".byte 0x0f, 0xb9, 0x3d\\n\\t\"\t\t\t\t\\\n\t\t\".long \" __rseq_str(RSEQ_SIG) \"\\n\\t\"\t\t\t\\\n\t\t__rseq_str(label) \":\\n\\t\"\t\t\t\t\\\n\t\tteardown\t\t\t\t\t\t\\\n\t\t\"jmp %l[\" __rseq_str(abort_label) \"]\\n\\t\"\t\t\\\n\t\t\".popsection\\n\\t\"\n\n#define RSEQ_ASM_DEFINE_CMPFAIL(label, teardown, cmpfail_label)\t\t\\\n\t\t\".pushsection __rseq_failure, \\\"ax\\\"\\n\\t\"\t\t\\\n\t\t__rseq_str(label) \":\\n\\t\"\t\t\t\t\\\n\t\tteardown\t\t\t\t\t\t\\\n\t\t\"jmp %l[\" __rseq_str(cmpfail_label) \"]\\n\\t\"\t\t\\\n\t\t\".popsection\\n\\t\"\n\n#endif\n\n \n\n#define RSEQ_TEMPLATE_CPU_ID\n#define RSEQ_TEMPLATE_MO_RELAXED\n#include \"rseq-x86-bits.h\"\n#undef RSEQ_TEMPLATE_MO_RELAXED\n\n#define RSEQ_TEMPLATE_MO_RELEASE\n#include \"rseq-x86-bits.h\"\n#undef RSEQ_TEMPLATE_MO_RELEASE\n#undef RSEQ_TEMPLATE_CPU_ID\n\n \n\n#define RSEQ_TEMPLATE_MM_CID\n#define RSEQ_TEMPLATE_MO_RELAXED\n#include \"rseq-x86-bits.h\"\n#undef RSEQ_TEMPLATE_MO_RELAXED\n\n#define RSEQ_TEMPLATE_MO_RELEASE\n#include \"rseq-x86-bits.h\"\n#undef RSEQ_TEMPLATE_MO_RELEASE\n#undef RSEQ_TEMPLATE_MM_CID\n\n \n\n#define RSEQ_TEMPLATE_CPU_ID_NONE\n#define RSEQ_TEMPLATE_MO_RELAXED\n#include \"rseq-x86-bits.h\"\n#undef RSEQ_TEMPLATE_MO_RELAXED\n#undef RSEQ_TEMPLATE_CPU_ID_NONE\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}