{
  "module_name": "zram01.sh",
  "hash_id": "cc37df42c2dba4a1de976aeaf9a91db874d2d8784a03e0206c23e3a233671a68",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/zram/zram01.sh",
  "human_readable_source": "#!/bin/bash\n# SPDX-License-Identifier: GPL-2.0-or-later\n# Copyright (c) 2015 Oracle and/or its affiliates. All Rights Reserved.\n#\n# Test creates several zram devices with different filesystems on them.\n# It fills each device with zeros and checks that compression works.\n#\n# Author: Alexey Kodanev <alexey.kodanev@oracle.com>\n# Modified: Naresh Kamboju <naresh.kamboju@linaro.org>\n\nTCID=\"zram01\"\nERR_CODE=0\n\n. ./zram_lib.sh\n\n# Test will create the following number of zram devices:\ndev_num=1\n# This is a list of parameters for zram devices.\n# Number of items must be equal to 'dev_num' parameter.\nzram_max_streams=\"2\"\n\n# The zram sysfs node 'disksize' value can be either in bytes,\n# or you can use mem suffixes. But in some old kernels, mem\n# suffixes are not supported, for example, in RHEL6.6GA's kernel\n# layer, it uses strict_strtoull() to parse disksize which does\n# not support mem suffixes, in some newer kernels, they use\n# memparse() which supports mem suffixes. So here we just use\n# bytes to make sure everything works correctly.\nzram_sizes=\"2097152\" # 2MB\nzram_mem_limits=\"2M\"\nzram_filesystems=\"ext4\"\nzram_algs=\"lzo\"\n\nzram_fill_fs()\n{\n\tfor i in $(seq $dev_start $dev_end); do\n\t\techo \"fill zram$i...\"\n\t\tlocal b=0\n\t\twhile [ true ]; do\n\t\t\tdd conv=notrunc if=/dev/zero of=zram${i}/file \\\n\t\t\t\toflag=append count=1 bs=1024 status=none \\\n\t\t\t\t> /dev/null 2>&1 || break\n\t\t\tb=$(($b + 1))\n\t\tdone\n\t\techo \"zram$i can be filled with '$b' KB\"\n\n\t\tlocal mem_used_total=`awk '{print $3}' \"/sys/block/zram$i/mm_stat\"`\n\t\tlocal v=$((100 * 1024 * $b / $mem_used_total))\n\t\tif [ \"$v\" -lt 100 ]; then\n\t\t\t echo \"FAIL compression ratio: 0.$v:1\"\n\t\t\t ERR_CODE=-1\n\t\t\t return\n\t\tfi\n\n\t\techo \"zram compression ratio: $(echo \"scale=2; $v / 100 \" | bc):1: OK\"\n\tdone\n}\n\ncheck_prereqs\nzram_load\nzram_max_streams\nzram_compress_alg\nzram_set_disksizes\nzram_set_memlimit\nzram_makefs\nzram_mount\n\nzram_fill_fs\nzram_cleanup\n\nif [ $ERR_CODE -ne 0 ]; then\n\techo \"$TCID : [FAIL]\"\nelse\n\techo \"$TCID : [PASS]\"\nfi\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}