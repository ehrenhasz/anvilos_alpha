{
  "module_name": "lib.mk",
  "hash_id": "40a38d6655ecff9cc31971f4da2c3a52e01d7eeb64b81ab52eb96a7ffdce184c",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/lib.mk",
  "human_readable_source": "# This mimics the top-level Makefile. We do it explicitly here so that this\n# Makefile can operate with or without the kbuild infrastructure.\nifneq ($(LLVM),)\nifneq ($(filter %/,$(LLVM)),)\nLLVM_PREFIX := $(LLVM)\nelse ifneq ($(filter -%,$(LLVM)),)\nLLVM_SUFFIX := $(LLVM)\nendif\n\nCLANG_TARGET_FLAGS_arm          := arm-linux-gnueabi\nCLANG_TARGET_FLAGS_arm64        := aarch64-linux-gnu\nCLANG_TARGET_FLAGS_hexagon      := hexagon-linux-musl\nCLANG_TARGET_FLAGS_i386         := i386-linux-gnu\nCLANG_TARGET_FLAGS_m68k         := m68k-linux-gnu\nCLANG_TARGET_FLAGS_mips         := mipsel-linux-gnu\nCLANG_TARGET_FLAGS_powerpc      := powerpc64le-linux-gnu\nCLANG_TARGET_FLAGS_riscv        := riscv64-linux-gnu\nCLANG_TARGET_FLAGS_s390         := s390x-linux-gnu\nCLANG_TARGET_FLAGS_x86          := x86_64-linux-gnu\nCLANG_TARGET_FLAGS_x86_64       := x86_64-linux-gnu\nCLANG_TARGET_FLAGS              := $(CLANG_TARGET_FLAGS_$(ARCH))\n\nifeq ($(CROSS_COMPILE),)\nifeq ($(CLANG_TARGET_FLAGS),)\n$(error Specify CROSS_COMPILE or add '--target=' option to lib.mk)\nelse\nCLANG_FLAGS     += --target=$(CLANG_TARGET_FLAGS)\nendif # CLANG_TARGET_FLAGS\nelse\nCLANG_FLAGS     += --target=$(notdir $(CROSS_COMPILE:%-=%))\nendif # CROSS_COMPILE\n\nCC := $(LLVM_PREFIX)clang$(LLVM_SUFFIX) $(CLANG_FLAGS) -fintegrated-as\nelse\nCC := $(CROSS_COMPILE)gcc\nendif # LLVM\n\nifeq (0,$(MAKELEVEL))\n    ifeq ($(OUTPUT),)\n\tOUTPUT := $(shell pwd)\n\tDEFAULT_INSTALL_HDR_PATH := 1\n    endif\nendif\nselfdir = $(realpath $(dir $(filter %/lib.mk,$(MAKEFILE_LIST))))\ntop_srcdir = $(selfdir)/../../..\n\nifeq ($(KHDR_INCLUDES),)\nKHDR_INCLUDES := -isystem $(top_srcdir)/usr/include\nendif\n\n# The following are built by lib.mk common compile rules.\n# TEST_CUSTOM_PROGS should be used by tests that require\n# custom build rule and prevent common build rule use.\n# TEST_PROGS are for test shell scripts.\n# TEST_CUSTOM_PROGS and TEST_PROGS will be run by common run_tests\n# and install targets. Common clean doesn't touch them.\nTEST_GEN_PROGS := $(patsubst %,$(OUTPUT)/%,$(TEST_GEN_PROGS))\nTEST_GEN_PROGS_EXTENDED := $(patsubst %,$(OUTPUT)/%,$(TEST_GEN_PROGS_EXTENDED))\nTEST_GEN_FILES := $(patsubst %,$(OUTPUT)/%,$(TEST_GEN_FILES))\n\nall: $(TEST_GEN_PROGS) $(TEST_GEN_PROGS_EXTENDED) $(TEST_GEN_FILES)\n\ndefine RUN_TESTS\n\tBASE_DIR=\"$(selfdir)\";\t\t\t\\\n\t. $(selfdir)/kselftest/runner.sh;\t\\\n\tif [ \"X$(summary)\" != \"X\" ]; then       \\\n\t\tper_test_logging=1;\t\t\\\n\tfi;                                     \\\n\trun_many $(1)\nendef\n\nrun_tests: all\nifdef building_out_of_srctree\n\t@if [ \"X$(TEST_PROGS)$(TEST_PROGS_EXTENDED)$(TEST_FILES)\" != \"X\" ]; then \\\n\t\trsync -aq --copy-unsafe-links $(TEST_PROGS) $(TEST_PROGS_EXTENDED) $(TEST_FILES) $(OUTPUT); \\\n\tfi\n\t@if [ \"X$(TEST_PROGS)\" != \"X\" ]; then \\\n\t\t$(call RUN_TESTS, $(TEST_GEN_PROGS) $(TEST_CUSTOM_PROGS) \\\n\t\t\t\t  $(addprefix $(OUTPUT)/,$(TEST_PROGS))) ; \\\n\telse \\\n\t\t$(call RUN_TESTS, $(TEST_GEN_PROGS) $(TEST_CUSTOM_PROGS)); \\\n\tfi\nelse\n\t@$(call RUN_TESTS, $(TEST_GEN_PROGS) $(TEST_CUSTOM_PROGS) $(TEST_PROGS))\nendif\n\ndefine INSTALL_SINGLE_RULE\n\t$(if $(INSTALL_LIST),@mkdir -p $(INSTALL_PATH))\n\t$(if $(INSTALL_LIST),rsync -a --copy-unsafe-links $(INSTALL_LIST) $(INSTALL_PATH)/)\nendef\n\ndefine INSTALL_RULE\n\t$(eval INSTALL_LIST = $(TEST_PROGS)) $(INSTALL_SINGLE_RULE)\n\t$(eval INSTALL_LIST = $(TEST_PROGS_EXTENDED)) $(INSTALL_SINGLE_RULE)\n\t$(eval INSTALL_LIST = $(TEST_FILES)) $(INSTALL_SINGLE_RULE)\n\t$(eval INSTALL_LIST = $(TEST_GEN_PROGS)) $(INSTALL_SINGLE_RULE)\n\t$(eval INSTALL_LIST = $(TEST_CUSTOM_PROGS)) $(INSTALL_SINGLE_RULE)\n\t$(eval INSTALL_LIST = $(TEST_GEN_PROGS_EXTENDED)) $(INSTALL_SINGLE_RULE)\n\t$(eval INSTALL_LIST = $(TEST_GEN_FILES)) $(INSTALL_SINGLE_RULE)\n\t$(eval INSTALL_LIST = $(wildcard config settings)) $(INSTALL_SINGLE_RULE)\nendef\n\ninstall: all\nifdef INSTALL_PATH\n\t$(INSTALL_RULE)\nelse\n\t$(error Error: set INSTALL_PATH to use install)\nendif\n\nemit_tests:\n\tfor TEST in $(TEST_GEN_PROGS) $(TEST_CUSTOM_PROGS) $(TEST_PROGS); do \\\n\t\tBASENAME_TEST=`basename $$TEST`;\t\\\n\t\techo \"$(COLLECTION):$$BASENAME_TEST\";\t\\\n\tdone\n\n# define if isn't already. It is undefined in make O= case.\nifeq ($(RM),)\nRM := rm -f\nendif\n\ndefine CLEAN\n\t$(RM) -r $(TEST_GEN_PROGS) $(TEST_GEN_PROGS_EXTENDED) $(TEST_GEN_FILES) $(EXTRA_CLEAN)\nendef\n\nclean:\n\t$(CLEAN)\n\n# Enables to extend CFLAGS and LDFLAGS from command line, e.g.\n# make USERCFLAGS=-Werror USERLDFLAGS=-static\nCFLAGS += $(USERCFLAGS)\nLDFLAGS += $(USERLDFLAGS)\n\n# When make O= with kselftest target from main level\n# the following aren't defined.\n#\nifdef building_out_of_srctree\nLINK.c = $(CC) $(CFLAGS) $(CPPFLAGS) $(LDFLAGS) $(TARGET_ARCH)\nCOMPILE.S = $(CC) $(ASFLAGS) $(CPPFLAGS) $(TARGET_ARCH) -c\nLINK.S = $(CC) $(ASFLAGS) $(CPPFLAGS) $(LDFLAGS) $(TARGET_ARCH)\nendif\n\n# Selftest makefiles can override those targets by setting\n# OVERRIDE_TARGETS = 1.\nifeq ($(OVERRIDE_TARGETS),)\nLOCAL_HDRS += $(selfdir)/kselftest_harness.h $(selfdir)/kselftest.h\n$(OUTPUT)/%:%.c $(LOCAL_HDRS)\n\t$(LINK.c) $(filter-out $(LOCAL_HDRS),$^) $(LDLIBS) -o $@\n\n$(OUTPUT)/%.o:%.S\n\t$(COMPILE.S) $^ -o $@\n\n$(OUTPUT)/%:%.S\n\t$(LINK.S) $^ $(LDLIBS) -o $@\nendif\n\n.PHONY: run_tests all clean install emit_tests\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}