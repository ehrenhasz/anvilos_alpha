{
  "module_name": "test-livepatch.sh",
  "hash_id": "84a2fd1425a2cc5df8be856b4333a3f76b769d19b0407acb68e7fa75cb31a34b",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/livepatch/test-livepatch.sh",
  "human_readable_source": "#!/bin/bash\n# SPDX-License-Identifier: GPL-2.0\n# Copyright (C) 2018 Joe Lawrence <joe.lawrence@redhat.com>\n\n. $(dirname $0)/functions.sh\n\nMOD_LIVEPATCH=test_klp_livepatch\nMOD_REPLACE=test_klp_atomic_replace\n\nsetup_config\n\n\n# - load a livepatch that modifies the output from /proc/cmdline and\n#   verify correct behavior\n# - unload the livepatch and make sure the patch was removed\n\nstart_test \"basic function patching\"\n\nload_lp $MOD_LIVEPATCH\n\nif [[ \"$(cat /proc/cmdline)\" != \"$MOD_LIVEPATCH: this has been live patched\" ]] ; then\n\techo -e \"FAIL\\n\\n\"\n\tdie \"livepatch kselftest(s) failed\"\nfi\n\ndisable_lp $MOD_LIVEPATCH\nunload_lp $MOD_LIVEPATCH\n\nif [[ \"$(cat /proc/cmdline)\" == \"$MOD_LIVEPATCH: this has been live patched\" ]] ; then\n\techo -e \"FAIL\\n\\n\"\n\tdie \"livepatch kselftest(s) failed\"\nfi\n\ncheck_result \"% modprobe $MOD_LIVEPATCH\nlivepatch: enabling patch '$MOD_LIVEPATCH'\nlivepatch: '$MOD_LIVEPATCH': initializing patching transition\nlivepatch: '$MOD_LIVEPATCH': starting patching transition\nlivepatch: '$MOD_LIVEPATCH': completing patching transition\nlivepatch: '$MOD_LIVEPATCH': patching complete\n% echo 0 > /sys/kernel/livepatch/$MOD_LIVEPATCH/enabled\nlivepatch: '$MOD_LIVEPATCH': initializing unpatching transition\nlivepatch: '$MOD_LIVEPATCH': starting unpatching transition\nlivepatch: '$MOD_LIVEPATCH': completing unpatching transition\nlivepatch: '$MOD_LIVEPATCH': unpatching complete\n% rmmod $MOD_LIVEPATCH\"\n\n\n# - load a livepatch that modifies the output from /proc/cmdline and\n#   verify correct behavior\n# - load another livepatch and verify that both livepatches are active\n# - unload the second livepatch and verify that the first is still active\n# - unload the first livepatch and verify none are active\n\nstart_test \"multiple livepatches\"\n\nload_lp $MOD_LIVEPATCH\n\ngrep 'live patched' /proc/cmdline > /dev/kmsg\ngrep 'live patched' /proc/meminfo > /dev/kmsg\n\nload_lp $MOD_REPLACE replace=0\n\ngrep 'live patched' /proc/cmdline > /dev/kmsg\ngrep 'live patched' /proc/meminfo > /dev/kmsg\n\ndisable_lp $MOD_REPLACE\nunload_lp $MOD_REPLACE\n\ngrep 'live patched' /proc/cmdline > /dev/kmsg\ngrep 'live patched' /proc/meminfo > /dev/kmsg\n\ndisable_lp $MOD_LIVEPATCH\nunload_lp $MOD_LIVEPATCH\n\ngrep 'live patched' /proc/cmdline > /dev/kmsg\ngrep 'live patched' /proc/meminfo > /dev/kmsg\n\ncheck_result \"% modprobe $MOD_LIVEPATCH\nlivepatch: enabling patch '$MOD_LIVEPATCH'\nlivepatch: '$MOD_LIVEPATCH': initializing patching transition\nlivepatch: '$MOD_LIVEPATCH': starting patching transition\nlivepatch: '$MOD_LIVEPATCH': completing patching transition\nlivepatch: '$MOD_LIVEPATCH': patching complete\n$MOD_LIVEPATCH: this has been live patched\n% modprobe $MOD_REPLACE replace=0\nlivepatch: enabling patch '$MOD_REPLACE'\nlivepatch: '$MOD_REPLACE': initializing patching transition\nlivepatch: '$MOD_REPLACE': starting patching transition\nlivepatch: '$MOD_REPLACE': completing patching transition\nlivepatch: '$MOD_REPLACE': patching complete\n$MOD_LIVEPATCH: this has been live patched\n$MOD_REPLACE: this has been live patched\n% echo 0 > /sys/kernel/livepatch/$MOD_REPLACE/enabled\nlivepatch: '$MOD_REPLACE': initializing unpatching transition\nlivepatch: '$MOD_REPLACE': starting unpatching transition\nlivepatch: '$MOD_REPLACE': completing unpatching transition\nlivepatch: '$MOD_REPLACE': unpatching complete\n% rmmod $MOD_REPLACE\n$MOD_LIVEPATCH: this has been live patched\n% echo 0 > /sys/kernel/livepatch/$MOD_LIVEPATCH/enabled\nlivepatch: '$MOD_LIVEPATCH': initializing unpatching transition\nlivepatch: '$MOD_LIVEPATCH': starting unpatching transition\nlivepatch: '$MOD_LIVEPATCH': completing unpatching transition\nlivepatch: '$MOD_LIVEPATCH': unpatching complete\n% rmmod $MOD_LIVEPATCH\"\n\n\n# - load a livepatch that modifies the output from /proc/cmdline and\n#   verify correct behavior\n# - load an atomic replace livepatch and verify that only the second is active\n# - remove the first livepatch and verify that the atomic replace livepatch\n#   is still active\n# - remove the atomic replace livepatch and verify that none are active\n\nstart_test \"atomic replace livepatch\"\n\nload_lp $MOD_LIVEPATCH\n\ngrep 'live patched' /proc/cmdline > /dev/kmsg\ngrep 'live patched' /proc/meminfo > /dev/kmsg\n\nload_lp $MOD_REPLACE replace=1\n\ngrep 'live patched' /proc/cmdline > /dev/kmsg\ngrep 'live patched' /proc/meminfo > /dev/kmsg\n\nunload_lp $MOD_LIVEPATCH\n\ngrep 'live patched' /proc/cmdline > /dev/kmsg\ngrep 'live patched' /proc/meminfo > /dev/kmsg\n\ndisable_lp $MOD_REPLACE\nunload_lp $MOD_REPLACE\n\ngrep 'live patched' /proc/cmdline > /dev/kmsg\ngrep 'live patched' /proc/meminfo > /dev/kmsg\n\ncheck_result \"% modprobe $MOD_LIVEPATCH\nlivepatch: enabling patch '$MOD_LIVEPATCH'\nlivepatch: '$MOD_LIVEPATCH': initializing patching transition\nlivepatch: '$MOD_LIVEPATCH': starting patching transition\nlivepatch: '$MOD_LIVEPATCH': completing patching transition\nlivepatch: '$MOD_LIVEPATCH': patching complete\n$MOD_LIVEPATCH: this has been live patched\n% modprobe $MOD_REPLACE replace=1\nlivepatch: enabling patch '$MOD_REPLACE'\nlivepatch: '$MOD_REPLACE': initializing patching transition\nlivepatch: '$MOD_REPLACE': starting patching transition\nlivepatch: '$MOD_REPLACE': completing patching transition\nlivepatch: '$MOD_REPLACE': patching complete\n$MOD_REPLACE: this has been live patched\n% rmmod $MOD_LIVEPATCH\n$MOD_REPLACE: this has been live patched\n% echo 0 > /sys/kernel/livepatch/$MOD_REPLACE/enabled\nlivepatch: '$MOD_REPLACE': initializing unpatching transition\nlivepatch: '$MOD_REPLACE': starting unpatching transition\nlivepatch: '$MOD_REPLACE': completing unpatching transition\nlivepatch: '$MOD_REPLACE': unpatching complete\n% rmmod $MOD_REPLACE\"\n\n\nexit 0\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}