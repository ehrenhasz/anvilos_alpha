{
  "module_name": "test-sysfs.sh",
  "hash_id": "35450c70bfa82744f7ab6031fa2258aad03d5f478adf9f88dd78a98d95033ac5",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/livepatch/test-sysfs.sh",
  "human_readable_source": "#!/bin/bash\n# SPDX-License-Identifier: GPL-2.0\n# Copyright (C) 2022 Song Liu <song@kernel.org>\n\n. $(dirname $0)/functions.sh\n\nMOD_LIVEPATCH=test_klp_livepatch\n\nsetup_config\n\n# - load a livepatch and verifies the sysfs entries work as expected\n\nstart_test \"sysfs test\"\n\nload_lp $MOD_LIVEPATCH\n\ncheck_sysfs_rights \"$MOD_LIVEPATCH\" \"\" \"drwxr-xr-x\"\ncheck_sysfs_rights \"$MOD_LIVEPATCH\" \"enabled\" \"-rw-r--r--\"\ncheck_sysfs_value  \"$MOD_LIVEPATCH\" \"enabled\" \"1\"\ncheck_sysfs_rights \"$MOD_LIVEPATCH\" \"force\" \"--w-------\"\ncheck_sysfs_rights \"$MOD_LIVEPATCH\" \"transition\" \"-r--r--r--\"\ncheck_sysfs_value  \"$MOD_LIVEPATCH\" \"transition\" \"0\"\ncheck_sysfs_rights \"$MOD_LIVEPATCH\" \"vmlinux/patched\" \"-r--r--r--\"\ncheck_sysfs_value  \"$MOD_LIVEPATCH\" \"vmlinux/patched\" \"1\"\n\ndisable_lp $MOD_LIVEPATCH\n\nunload_lp $MOD_LIVEPATCH\n\ncheck_result \"% modprobe $MOD_LIVEPATCH\nlivepatch: enabling patch '$MOD_LIVEPATCH'\nlivepatch: '$MOD_LIVEPATCH': initializing patching transition\nlivepatch: '$MOD_LIVEPATCH': starting patching transition\nlivepatch: '$MOD_LIVEPATCH': completing patching transition\nlivepatch: '$MOD_LIVEPATCH': patching complete\n% echo 0 > /sys/kernel/livepatch/$MOD_LIVEPATCH/enabled\nlivepatch: '$MOD_LIVEPATCH': initializing unpatching transition\nlivepatch: '$MOD_LIVEPATCH': starting unpatching transition\nlivepatch: '$MOD_LIVEPATCH': completing unpatching transition\nlivepatch: '$MOD_LIVEPATCH': unpatching complete\n% rmmod $MOD_LIVEPATCH\"\n\nstart_test \"sysfs test object/patched\"\n\nMOD_LIVEPATCH=test_klp_callbacks_demo\nMOD_TARGET=test_klp_callbacks_mod\nload_lp $MOD_LIVEPATCH\n\n# check the \"patch\" file changes as target module loads/unloads\ncheck_sysfs_value  \"$MOD_LIVEPATCH\" \"$MOD_TARGET/patched\" \"0\"\nload_mod $MOD_TARGET\ncheck_sysfs_value  \"$MOD_LIVEPATCH\" \"$MOD_TARGET/patched\" \"1\"\nunload_mod $MOD_TARGET\ncheck_sysfs_value  \"$MOD_LIVEPATCH\" \"$MOD_TARGET/patched\" \"0\"\n\ndisable_lp $MOD_LIVEPATCH\nunload_lp $MOD_LIVEPATCH\n\ncheck_result \"% modprobe test_klp_callbacks_demo\nlivepatch: enabling patch 'test_klp_callbacks_demo'\nlivepatch: 'test_klp_callbacks_demo': initializing patching transition\ntest_klp_callbacks_demo: pre_patch_callback: vmlinux\nlivepatch: 'test_klp_callbacks_demo': starting patching transition\nlivepatch: 'test_klp_callbacks_demo': completing patching transition\ntest_klp_callbacks_demo: post_patch_callback: vmlinux\nlivepatch: 'test_klp_callbacks_demo': patching complete\n% modprobe test_klp_callbacks_mod\nlivepatch: applying patch 'test_klp_callbacks_demo' to loading module 'test_klp_callbacks_mod'\ntest_klp_callbacks_demo: pre_patch_callback: test_klp_callbacks_mod -> [MODULE_STATE_COMING] Full formed, running module_init\ntest_klp_callbacks_demo: post_patch_callback: test_klp_callbacks_mod -> [MODULE_STATE_COMING] Full formed, running module_init\ntest_klp_callbacks_mod: test_klp_callbacks_mod_init\n% rmmod test_klp_callbacks_mod\ntest_klp_callbacks_mod: test_klp_callbacks_mod_exit\ntest_klp_callbacks_demo: pre_unpatch_callback: test_klp_callbacks_mod -> [MODULE_STATE_GOING] Going away\nlivepatch: reverting patch 'test_klp_callbacks_demo' on unloading module 'test_klp_callbacks_mod'\ntest_klp_callbacks_demo: post_unpatch_callback: test_klp_callbacks_mod -> [MODULE_STATE_GOING] Going away\n% echo 0 > /sys/kernel/livepatch/test_klp_callbacks_demo/enabled\nlivepatch: 'test_klp_callbacks_demo': initializing unpatching transition\ntest_klp_callbacks_demo: pre_unpatch_callback: vmlinux\nlivepatch: 'test_klp_callbacks_demo': starting unpatching transition\nlivepatch: 'test_klp_callbacks_demo': completing unpatching transition\ntest_klp_callbacks_demo: post_unpatch_callback: vmlinux\nlivepatch: 'test_klp_callbacks_demo': unpatching complete\n% rmmod test_klp_callbacks_demo\"\n\nexit 0\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}