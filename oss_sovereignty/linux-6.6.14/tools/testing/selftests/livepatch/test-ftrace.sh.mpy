{
  "module_name": "test-ftrace.sh",
  "hash_id": "d583559dc6a5f03a4e5f8f0f63537b8dc786b97dca167eefd6407b9edafc441a",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/livepatch/test-ftrace.sh",
  "human_readable_source": "#!/bin/bash\n# SPDX-License-Identifier: GPL-2.0\n# Copyright (C) 2019 Joe Lawrence <joe.lawrence@redhat.com>\n\n. $(dirname $0)/functions.sh\n\nMOD_LIVEPATCH=test_klp_livepatch\n\nsetup_config\n\n\n# - turn ftrace_enabled OFF and verify livepatches can't load\n# - turn ftrace_enabled ON and verify livepatch can load\n# - verify that ftrace_enabled can't be turned OFF while a livepatch is loaded\n\nstart_test \"livepatch interaction with ftrace_enabled sysctl\"\n\nset_ftrace_enabled 0\nload_failing_mod $MOD_LIVEPATCH\n\nset_ftrace_enabled 1\nload_lp $MOD_LIVEPATCH\nif [[ \"$(cat /proc/cmdline)\" != \"$MOD_LIVEPATCH: this has been live patched\" ]] ; then\n\techo -e \"FAIL\\n\\n\"\n\tdie \"livepatch kselftest(s) failed\"\nfi\n\n# Check that ftrace could not get disabled when a livepatch is enabled\nset_ftrace_enabled --fail 0\nif [[ \"$(cat /proc/cmdline)\" != \"$MOD_LIVEPATCH: this has been live patched\" ]] ; then\n\techo -e \"FAIL\\n\\n\"\n\tdie \"livepatch kselftest(s) failed\"\nfi\ndisable_lp $MOD_LIVEPATCH\nunload_lp $MOD_LIVEPATCH\n\ncheck_result \"livepatch: kernel.ftrace_enabled = 0\n% modprobe $MOD_LIVEPATCH\nlivepatch: enabling patch '$MOD_LIVEPATCH'\nlivepatch: '$MOD_LIVEPATCH': initializing patching transition\nlivepatch: failed to register ftrace handler for function 'cmdline_proc_show' (-16)\nlivepatch: failed to patch object 'vmlinux'\nlivepatch: failed to enable patch '$MOD_LIVEPATCH'\nlivepatch: '$MOD_LIVEPATCH': canceling patching transition, going to unpatch\nlivepatch: '$MOD_LIVEPATCH': completing unpatching transition\nlivepatch: '$MOD_LIVEPATCH': unpatching complete\nmodprobe: ERROR: could not insert '$MOD_LIVEPATCH': Device or resource busy\nlivepatch: kernel.ftrace_enabled = 1\n% modprobe $MOD_LIVEPATCH\nlivepatch: enabling patch '$MOD_LIVEPATCH'\nlivepatch: '$MOD_LIVEPATCH': initializing patching transition\nlivepatch: '$MOD_LIVEPATCH': starting patching transition\nlivepatch: '$MOD_LIVEPATCH': completing patching transition\nlivepatch: '$MOD_LIVEPATCH': patching complete\nlivepatch: sysctl: setting key \\\"kernel.ftrace_enabled\\\": Device or resource busy\n% echo 0 > /sys/kernel/livepatch/$MOD_LIVEPATCH/enabled\nlivepatch: '$MOD_LIVEPATCH': initializing unpatching transition\nlivepatch: '$MOD_LIVEPATCH': starting unpatching transition\nlivepatch: '$MOD_LIVEPATCH': completing unpatching transition\nlivepatch: '$MOD_LIVEPATCH': unpatching complete\n% rmmod $MOD_LIVEPATCH\"\n\n\nexit 0\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}