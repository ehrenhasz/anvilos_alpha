{
  "module_name": "test-state.sh",
  "hash_id": "297e044430e1b4df074c2f9084b9686b18518d45fa92b9d67bd920e666850051",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/livepatch/test-state.sh",
  "human_readable_source": "#!/bin/bash\n# SPDX-License-Identifier: GPL-2.0\n# Copyright (C) 2019 SUSE\n\n. $(dirname $0)/functions.sh\n\nMOD_LIVEPATCH=test_klp_state\nMOD_LIVEPATCH2=test_klp_state2\nMOD_LIVEPATCH3=test_klp_state3\n\nsetup_config\n\n\n# Load and remove a module that modifies the system state\n\nstart_test \"system state modification\"\n\nload_lp $MOD_LIVEPATCH\ndisable_lp $MOD_LIVEPATCH\nunload_lp $MOD_LIVEPATCH\n\ncheck_result \"% modprobe $MOD_LIVEPATCH\nlivepatch: enabling patch '$MOD_LIVEPATCH'\nlivepatch: '$MOD_LIVEPATCH': initializing patching transition\n$MOD_LIVEPATCH: pre_patch_callback: vmlinux\n$MOD_LIVEPATCH: allocate_loglevel_state: allocating space to store console_loglevel\nlivepatch: '$MOD_LIVEPATCH': starting patching transition\nlivepatch: '$MOD_LIVEPATCH': completing patching transition\n$MOD_LIVEPATCH: post_patch_callback: vmlinux\n$MOD_LIVEPATCH: fix_console_loglevel: fixing console_loglevel\nlivepatch: '$MOD_LIVEPATCH': patching complete\n% echo 0 > /sys/kernel/livepatch/$MOD_LIVEPATCH/enabled\nlivepatch: '$MOD_LIVEPATCH': initializing unpatching transition\n$MOD_LIVEPATCH: pre_unpatch_callback: vmlinux\n$MOD_LIVEPATCH: restore_console_loglevel: restoring console_loglevel\nlivepatch: '$MOD_LIVEPATCH': starting unpatching transition\nlivepatch: '$MOD_LIVEPATCH': completing unpatching transition\n$MOD_LIVEPATCH: post_unpatch_callback: vmlinux\n$MOD_LIVEPATCH: free_loglevel_state: freeing space for the stored console_loglevel\nlivepatch: '$MOD_LIVEPATCH': unpatching complete\n% rmmod $MOD_LIVEPATCH\"\n\n\n# Take over system state change by a cumulative patch\n\nstart_test \"taking over system state modification\"\n\nload_lp $MOD_LIVEPATCH\nload_lp $MOD_LIVEPATCH2\nunload_lp $MOD_LIVEPATCH\ndisable_lp $MOD_LIVEPATCH2\nunload_lp $MOD_LIVEPATCH2\n\ncheck_result \"% modprobe $MOD_LIVEPATCH\nlivepatch: enabling patch '$MOD_LIVEPATCH'\nlivepatch: '$MOD_LIVEPATCH': initializing patching transition\n$MOD_LIVEPATCH: pre_patch_callback: vmlinux\n$MOD_LIVEPATCH: allocate_loglevel_state: allocating space to store console_loglevel\nlivepatch: '$MOD_LIVEPATCH': starting patching transition\nlivepatch: '$MOD_LIVEPATCH': completing patching transition\n$MOD_LIVEPATCH: post_patch_callback: vmlinux\n$MOD_LIVEPATCH: fix_console_loglevel: fixing console_loglevel\nlivepatch: '$MOD_LIVEPATCH': patching complete\n% modprobe $MOD_LIVEPATCH2\nlivepatch: enabling patch '$MOD_LIVEPATCH2'\nlivepatch: '$MOD_LIVEPATCH2': initializing patching transition\n$MOD_LIVEPATCH2: pre_patch_callback: vmlinux\n$MOD_LIVEPATCH2: allocate_loglevel_state: space to store console_loglevel already allocated\nlivepatch: '$MOD_LIVEPATCH2': starting patching transition\nlivepatch: '$MOD_LIVEPATCH2': completing patching transition\n$MOD_LIVEPATCH2: post_patch_callback: vmlinux\n$MOD_LIVEPATCH2: fix_console_loglevel: taking over the console_loglevel change\nlivepatch: '$MOD_LIVEPATCH2': patching complete\n% rmmod $MOD_LIVEPATCH\n% echo 0 > /sys/kernel/livepatch/$MOD_LIVEPATCH2/enabled\nlivepatch: '$MOD_LIVEPATCH2': initializing unpatching transition\n$MOD_LIVEPATCH2: pre_unpatch_callback: vmlinux\n$MOD_LIVEPATCH2: restore_console_loglevel: restoring console_loglevel\nlivepatch: '$MOD_LIVEPATCH2': starting unpatching transition\nlivepatch: '$MOD_LIVEPATCH2': completing unpatching transition\n$MOD_LIVEPATCH2: post_unpatch_callback: vmlinux\n$MOD_LIVEPATCH2: free_loglevel_state: freeing space for the stored console_loglevel\nlivepatch: '$MOD_LIVEPATCH2': unpatching complete\n% rmmod $MOD_LIVEPATCH2\"\n\n\n# Take over system state change by a cumulative patch\n\nstart_test \"compatible cumulative livepatches\"\n\nload_lp $MOD_LIVEPATCH2\nload_lp $MOD_LIVEPATCH3\nunload_lp $MOD_LIVEPATCH2\nload_lp $MOD_LIVEPATCH2\ndisable_lp $MOD_LIVEPATCH2\nunload_lp $MOD_LIVEPATCH2\nunload_lp $MOD_LIVEPATCH3\n\ncheck_result \"% modprobe $MOD_LIVEPATCH2\nlivepatch: enabling patch '$MOD_LIVEPATCH2'\nlivepatch: '$MOD_LIVEPATCH2': initializing patching transition\n$MOD_LIVEPATCH2: pre_patch_callback: vmlinux\n$MOD_LIVEPATCH2: allocate_loglevel_state: allocating space to store console_loglevel\nlivepatch: '$MOD_LIVEPATCH2': starting patching transition\nlivepatch: '$MOD_LIVEPATCH2': completing patching transition\n$MOD_LIVEPATCH2: post_patch_callback: vmlinux\n$MOD_LIVEPATCH2: fix_console_loglevel: fixing console_loglevel\nlivepatch: '$MOD_LIVEPATCH2': patching complete\n% modprobe $MOD_LIVEPATCH3\nlivepatch: enabling patch '$MOD_LIVEPATCH3'\nlivepatch: '$MOD_LIVEPATCH3': initializing patching transition\n$MOD_LIVEPATCH3: pre_patch_callback: vmlinux\n$MOD_LIVEPATCH3: allocate_loglevel_state: space to store console_loglevel already allocated\nlivepatch: '$MOD_LIVEPATCH3': starting patching transition\nlivepatch: '$MOD_LIVEPATCH3': completing patching transition\n$MOD_LIVEPATCH3: post_patch_callback: vmlinux\n$MOD_LIVEPATCH3: fix_console_loglevel: taking over the console_loglevel change\nlivepatch: '$MOD_LIVEPATCH3': patching complete\n% rmmod $MOD_LIVEPATCH2\n% modprobe $MOD_LIVEPATCH2\nlivepatch: enabling patch '$MOD_LIVEPATCH2'\nlivepatch: '$MOD_LIVEPATCH2': initializing patching transition\n$MOD_LIVEPATCH2: pre_patch_callback: vmlinux\n$MOD_LIVEPATCH2: allocate_loglevel_state: space to store console_loglevel already allocated\nlivepatch: '$MOD_LIVEPATCH2': starting patching transition\nlivepatch: '$MOD_LIVEPATCH2': completing patching transition\n$MOD_LIVEPATCH2: post_patch_callback: vmlinux\n$MOD_LIVEPATCH2: fix_console_loglevel: taking over the console_loglevel change\nlivepatch: '$MOD_LIVEPATCH2': patching complete\n% echo 0 > /sys/kernel/livepatch/$MOD_LIVEPATCH2/enabled\nlivepatch: '$MOD_LIVEPATCH2': initializing unpatching transition\n$MOD_LIVEPATCH2: pre_unpatch_callback: vmlinux\n$MOD_LIVEPATCH2: restore_console_loglevel: restoring console_loglevel\nlivepatch: '$MOD_LIVEPATCH2': starting unpatching transition\nlivepatch: '$MOD_LIVEPATCH2': completing unpatching transition\n$MOD_LIVEPATCH2: post_unpatch_callback: vmlinux\n$MOD_LIVEPATCH2: free_loglevel_state: freeing space for the stored console_loglevel\nlivepatch: '$MOD_LIVEPATCH2': unpatching complete\n% rmmod $MOD_LIVEPATCH2\n% rmmod $MOD_LIVEPATCH3\"\n\n\n# Failure caused by incompatible cumulative livepatches\n\nstart_test \"incompatible cumulative livepatches\"\n\nload_lp $MOD_LIVEPATCH2\nload_failing_mod $MOD_LIVEPATCH\ndisable_lp $MOD_LIVEPATCH2\nunload_lp $MOD_LIVEPATCH2\n\ncheck_result \"% modprobe $MOD_LIVEPATCH2\nlivepatch: enabling patch '$MOD_LIVEPATCH2'\nlivepatch: '$MOD_LIVEPATCH2': initializing patching transition\n$MOD_LIVEPATCH2: pre_patch_callback: vmlinux\n$MOD_LIVEPATCH2: allocate_loglevel_state: allocating space to store console_loglevel\nlivepatch: '$MOD_LIVEPATCH2': starting patching transition\nlivepatch: '$MOD_LIVEPATCH2': completing patching transition\n$MOD_LIVEPATCH2: post_patch_callback: vmlinux\n$MOD_LIVEPATCH2: fix_console_loglevel: fixing console_loglevel\nlivepatch: '$MOD_LIVEPATCH2': patching complete\n% modprobe $MOD_LIVEPATCH\nlivepatch: Livepatch patch ($MOD_LIVEPATCH) is not compatible with the already installed livepatches.\nmodprobe: ERROR: could not insert '$MOD_LIVEPATCH': Invalid argument\n% echo 0 > /sys/kernel/livepatch/$MOD_LIVEPATCH2/enabled\nlivepatch: '$MOD_LIVEPATCH2': initializing unpatching transition\n$MOD_LIVEPATCH2: pre_unpatch_callback: vmlinux\n$MOD_LIVEPATCH2: restore_console_loglevel: restoring console_loglevel\nlivepatch: '$MOD_LIVEPATCH2': starting unpatching transition\nlivepatch: '$MOD_LIVEPATCH2': completing unpatching transition\n$MOD_LIVEPATCH2: post_unpatch_callback: vmlinux\n$MOD_LIVEPATCH2: free_loglevel_state: freeing space for the stored console_loglevel\nlivepatch: '$MOD_LIVEPATCH2': unpatching complete\n% rmmod $MOD_LIVEPATCH2\"\n\nexit 0\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}