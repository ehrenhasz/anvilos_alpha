{
  "module_name": "futex_wait_private_mapped_file.c",
  "hash_id": "2d192bf6d48155c3b98ec3d29d5d930d85fa15ad2b9ba8778dd4cf33925ed208",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/futex/functional/futex_wait_private_mapped_file.c",
  "human_readable_source": "\n \n\n#include <stdio.h>\n#include <stdlib.h>\n#include <syscall.h>\n#include <unistd.h>\n#include <errno.h>\n#include <linux/futex.h>\n#include <pthread.h>\n#include <libgen.h>\n#include <signal.h>\n\n#include \"logging.h\"\n#include \"futextest.h\"\n\n#define TEST_NAME \"futex-wait-private-mapped-file\"\n#define PAGE_SZ 4096\n\nchar pad[PAGE_SZ] = {1};\nfutex_t val = 1;\nchar pad2[PAGE_SZ] = {1};\n\n#define WAKE_WAIT_US 3000000\nstruct timespec wait_timeout = { .tv_sec = 5, .tv_nsec = 0};\n\nvoid usage(char *prog)\n{\n\tprintf(\"Usage: %s\\n\", prog);\n\tprintf(\"  -c\tUse color\\n\");\n\tprintf(\"  -h\tDisplay this help message\\n\");\n\tprintf(\"  -v L\tVerbosity level: %d=QUIET %d=CRITICAL %d=INFO\\n\",\n\t       VQUIET, VCRITICAL, VINFO);\n}\n\nvoid *thr_futex_wait(void *arg)\n{\n\tint ret;\n\n\tinfo(\"futex wait\\n\");\n\tret = futex_wait(&val, 1, &wait_timeout, 0);\n\tif (ret && errno != EWOULDBLOCK && errno != ETIMEDOUT) {\n\t\terror(\"futex error.\\n\", errno);\n\t\tprint_result(TEST_NAME, RET_ERROR);\n\t\texit(RET_ERROR);\n\t}\n\n\tif (ret && errno == ETIMEDOUT)\n\t\tfail(\"waiter timedout\\n\");\n\n\tinfo(\"futex_wait: ret = %d, errno = %d\\n\", ret, errno);\n\n\treturn NULL;\n}\n\nint main(int argc, char **argv)\n{\n\tpthread_t thr;\n\tint ret = RET_PASS;\n\tint res;\n\tint c;\n\n\twhile ((c = getopt(argc, argv, \"chv:\")) != -1) {\n\t\tswitch (c) {\n\t\tcase 'c':\n\t\t\tlog_color(1);\n\t\t\tbreak;\n\t\tcase 'h':\n\t\t\tusage(basename(argv[0]));\n\t\t\texit(0);\n\t\tcase 'v':\n\t\t\tlog_verbosity(atoi(optarg));\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tusage(basename(argv[0]));\n\t\t\texit(1);\n\t\t}\n\t}\n\n\tksft_print_header();\n\tksft_set_plan(1);\n\tksft_print_msg(\n\t\t\"%s: Test the futex value of private file mappings in FUTEX_WAIT\\n\",\n\t\tbasename(argv[0]));\n\n\tret = pthread_create(&thr, NULL, thr_futex_wait, NULL);\n\tif (ret < 0) {\n\t\tfprintf(stderr, \"pthread_create error\\n\");\n\t\tret = RET_ERROR;\n\t\tgoto out;\n\t}\n\n\tinfo(\"wait a while\\n\");\n\tusleep(WAKE_WAIT_US);\n\tval = 2;\n\tres = futex_wake(&val, 1, 0);\n\tinfo(\"futex_wake %d\\n\", res);\n\tif (res != 1) {\n\t\tfail(\"FUTEX_WAKE didn't find the waiting thread.\\n\");\n\t\tret = RET_FAIL;\n\t}\n\n\tinfo(\"join\\n\");\n\tpthread_join(thr, NULL);\n\n out:\n\tprint_result(TEST_NAME, ret);\n\treturn ret;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}