{
  "module_name": "futex_wait_wouldblock.c",
  "hash_id": "0aa6560df714483c70d12ee9b16dd15cecdc56c6250ef8dead9be1adafefe2eb",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/futex/functional/futex_wait_wouldblock.c",
  "human_readable_source": "\n \n\n#include <errno.h>\n#include <getopt.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <time.h>\n#include \"futextest.h\"\n#include \"futex2test.h\"\n#include \"logging.h\"\n\n#define TEST_NAME \"futex-wait-wouldblock\"\n#define timeout_ns 100000\n\nvoid usage(char *prog)\n{\n\tprintf(\"Usage: %s\\n\", prog);\n\tprintf(\"  -c\tUse color\\n\");\n\tprintf(\"  -h\tDisplay this help message\\n\");\n\tprintf(\"  -v L\tVerbosity level: %d=QUIET %d=CRITICAL %d=INFO\\n\",\n\t       VQUIET, VCRITICAL, VINFO);\n}\n\nint main(int argc, char *argv[])\n{\n\tstruct timespec to = {.tv_sec = 0, .tv_nsec = timeout_ns};\n\tfutex_t f1 = FUTEX_INITIALIZER;\n\tint res, ret = RET_PASS;\n\tint c;\n\tstruct futex_waitv waitv = {\n\t\t\t.uaddr = (uintptr_t)&f1,\n\t\t\t.val = f1+1,\n\t\t\t.flags = FUTEX_32,\n\t\t\t.__reserved = 0\n\t\t};\n\n\twhile ((c = getopt(argc, argv, \"cht:v:\")) != -1) {\n\t\tswitch (c) {\n\t\tcase 'c':\n\t\t\tlog_color(1);\n\t\t\tbreak;\n\t\tcase 'h':\n\t\t\tusage(basename(argv[0]));\n\t\t\texit(0);\n\t\tcase 'v':\n\t\t\tlog_verbosity(atoi(optarg));\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tusage(basename(argv[0]));\n\t\t\texit(1);\n\t\t}\n\t}\n\n\tksft_print_header();\n\tksft_set_plan(2);\n\tksft_print_msg(\"%s: Test the unexpected futex value in FUTEX_WAIT\\n\",\n\t       basename(argv[0]));\n\n\tinfo(\"Calling futex_wait on f1: %u @ %p with val=%u\\n\", f1, &f1, f1+1);\n\tres = futex_wait(&f1, f1+1, &to, FUTEX_PRIVATE_FLAG);\n\tif (!res || errno != EWOULDBLOCK) {\n\t\tksft_test_result_fail(\"futex_wait returned: %d %s\\n\",\n\t\t\t\t      res ? errno : res,\n\t\t\t\t      res ? strerror(errno) : \"\");\n\t\tret = RET_FAIL;\n\t} else {\n\t\tksft_test_result_pass(\"futex_wait\\n\");\n\t}\n\n\tif (clock_gettime(CLOCK_MONOTONIC, &to)) {\n\t\terror(\"clock_gettime failed\\n\", errno);\n\t\treturn errno;\n\t}\n\n\tto.tv_nsec += timeout_ns;\n\n\tif (to.tv_nsec >= 1000000000) {\n\t\tto.tv_sec++;\n\t\tto.tv_nsec -= 1000000000;\n\t}\n\n\tinfo(\"Calling futex_waitv on f1: %u @ %p with val=%u\\n\", f1, &f1, f1+1);\n\tres = futex_waitv(&waitv, 1, 0, &to, CLOCK_MONOTONIC);\n\tif (!res || errno != EWOULDBLOCK) {\n\t\tksft_test_result_pass(\"futex_waitv returned: %d %s\\n\",\n\t\t\t\t      res ? errno : res,\n\t\t\t\t      res ? strerror(errno) : \"\");\n\t\tret = RET_FAIL;\n\t} else {\n\t\tksft_test_result_pass(\"futex_waitv\\n\");\n\t}\n\n\tksft_print_cnts();\n\treturn ret;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}