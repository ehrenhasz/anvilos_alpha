{
  "module_name": "disable-tsc-test.c",
  "hash_id": "9a22f3bec472f7d41d00d2c44c6fc3b62dd2e1a6ff5212600052b3764e1f6265",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/prctl/disable-tsc-test.c",
  "human_readable_source": "\n \n\n#include <stdio.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <signal.h>\n#include <inttypes.h>\n\n\n#include <sys/prctl.h>\n#include <linux/prctl.h>\n\n \n#ifndef PR_GET_TSC\n#define PR_GET_TSC 25\n#define PR_SET_TSC 26\n# define PR_TSC_ENABLE\t\t1    \n# define PR_TSC_SIGSEGV\t\t2    \n#endif\n\nconst char *tsc_names[] =\n{\n\t[0] = \"[not set]\",\n\t[PR_TSC_ENABLE] = \"PR_TSC_ENABLE\",\n\t[PR_TSC_SIGSEGV] = \"PR_TSC_SIGSEGV\",\n};\n\nstatic uint64_t rdtsc(void)\n{\nuint32_t lo, hi;\n \n__asm__ __volatile__ (\"rdtsc\" : \"=a\" (lo), \"=d\" (hi));\nreturn (uint64_t)hi << 32 | lo;\n}\n\nstatic void sigsegv_cb(int sig)\n{\n\tint tsc_val = 0;\n\n\tprintf(\"[ SIG_SEGV ]\\n\");\n\tprintf(\"prctl(PR_GET_TSC, &tsc_val); \");\n\tfflush(stdout);\n\n\tif ( prctl(PR_GET_TSC, &tsc_val) == -1)\n\t\tperror(\"prctl\");\n\n\tprintf(\"tsc_val == %s\\n\", tsc_names[tsc_val]);\n\tprintf(\"prctl(PR_SET_TSC, PR_TSC_ENABLE)\\n\");\n\tfflush(stdout);\n\tif ( prctl(PR_SET_TSC, PR_TSC_ENABLE) == -1)\n\t\tperror(\"prctl\");\n\n\tprintf(\"rdtsc() == \");\n}\n\nint main(void)\n{\n\tint tsc_val = 0;\n\n\tsignal(SIGSEGV, sigsegv_cb);\n\n\tprintf(\"rdtsc() == %llu\\n\", (unsigned long long)rdtsc());\n\tprintf(\"prctl(PR_GET_TSC, &tsc_val); \");\n\tfflush(stdout);\n\n\tif ( prctl(PR_GET_TSC, &tsc_val) == -1)\n\t\tperror(\"prctl\");\n\n\tprintf(\"tsc_val == %s\\n\", tsc_names[tsc_val]);\n\tprintf(\"rdtsc() == %llu\\n\", (unsigned long long)rdtsc());\n\tprintf(\"prctl(PR_SET_TSC, PR_TSC_ENABLE)\\n\");\n\tfflush(stdout);\n\n\tif ( prctl(PR_SET_TSC, PR_TSC_ENABLE) == -1)\n\t\tperror(\"prctl\");\n\n\tprintf(\"rdtsc() == %llu\\n\", (unsigned long long)rdtsc());\n\tprintf(\"prctl(PR_SET_TSC, PR_TSC_SIGSEGV)\\n\");\n\tfflush(stdout);\n\n\tif ( prctl(PR_SET_TSC, PR_TSC_SIGSEGV) == -1)\n\t\tperror(\"prctl\");\n\n\tprintf(\"rdtsc() == \");\n\tfflush(stdout);\n\tprintf(\"%llu\\n\", (unsigned long long)rdtsc());\n\tfflush(stdout);\n\n\texit(EXIT_SUCCESS);\n}\n\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}