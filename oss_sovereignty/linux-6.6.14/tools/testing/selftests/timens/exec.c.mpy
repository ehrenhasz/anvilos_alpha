{
  "module_name": "exec.c",
  "hash_id": "dd4d8f113116dc6a06e171252d714423d0e597a9b3495f6b50547d4e0db24929",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/timens/exec.c",
  "human_readable_source": "\n#define _GNU_SOURCE\n#include <errno.h>\n#include <fcntl.h>\n#include <sched.h>\n#include <stdio.h>\n#include <stdbool.h>\n#include <sys/stat.h>\n#include <sys/syscall.h>\n#include <sys/types.h>\n#include <sys/wait.h>\n#include <time.h>\n#include <unistd.h>\n#include <string.h>\n\n#include \"log.h\"\n#include \"timens.h\"\n\n#define OFFSET (36000)\n\nint main(int argc, char *argv[])\n{\n\tstruct timespec now, tst;\n\tint status, i;\n\tpid_t pid;\n\n\tif (argc > 1) {\n\t\tif (sscanf(argv[1], \"%ld\", &now.tv_sec) != 1)\n\t\t\treturn pr_perror(\"sscanf\");\n\n\t\tfor (i = 0; i < 2; i++) {\n\t\t\t_gettime(CLOCK_MONOTONIC, &tst, i);\n\t\t\tif (abs(tst.tv_sec - now.tv_sec) > 5)\n\t\t\t\treturn pr_fail(\"%ld %ld\\n\", now.tv_sec, tst.tv_sec);\n\t\t}\n\t\treturn 0;\n\t}\n\n\tnscheck();\n\n\tksft_set_plan(1);\n\n\tclock_gettime(CLOCK_MONOTONIC, &now);\n\n\tif (unshare_timens())\n\t\treturn 1;\n\n\tif (_settime(CLOCK_MONOTONIC, OFFSET))\n\t\treturn 1;\n\n\tfor (i = 0; i < 2; i++) {\n\t\t_gettime(CLOCK_MONOTONIC, &tst, i);\n\t\tif (abs(tst.tv_sec - now.tv_sec) > 5)\n\t\t\treturn pr_fail(\"%ld %ld\\n\",\n\t\t\t\t\tnow.tv_sec, tst.tv_sec);\n\t}\n\n\tif (argc > 1)\n\t\treturn 0;\n\n\tpid = fork();\n\tif (pid < 0)\n\t\treturn pr_perror(\"fork\");\n\n\tif (pid == 0) {\n\t\tchar now_str[64];\n\t\tchar *cargv[] = {\"exec\", now_str, NULL};\n\t\tchar *cenv[] = {NULL};\n\n\t\t \n\t\tfor (i = 0; i < 2; i++) {\n\t\t\t_gettime(CLOCK_MONOTONIC, &tst, i);\n\t\t\tif (abs(tst.tv_sec - now.tv_sec - OFFSET) > 5)\n\t\t\t\treturn pr_fail(\"%ld %ld\\n\",\n\t\t\t\t\t\tnow.tv_sec + OFFSET, tst.tv_sec);\n\t\t}\n\n\t\t \n\t\tsnprintf(now_str, sizeof(now_str), \"%ld\", now.tv_sec + OFFSET);\n\t\texecve(\"/proc/self/exe\", cargv, cenv);\n\t\treturn pr_perror(\"execve\");\n\t}\n\n\tif (waitpid(pid, &status, 0) != pid)\n\t\treturn pr_perror(\"waitpid\");\n\n\tif (status)\n\t\tksft_exit_fail();\n\n\tksft_test_result_pass(\"exec\\n\");\n\tksft_exit_pass();\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}