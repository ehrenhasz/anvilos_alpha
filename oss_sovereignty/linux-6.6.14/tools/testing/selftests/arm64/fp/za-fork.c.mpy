{
  "module_name": "za-fork.c",
  "hash_id": "22d66c1ce3f1a8ffc0499c33b26891b25a72eeec824542b4f861f88eb0c99b2d",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/arm64/fp/za-fork.c",
  "human_readable_source": "\n \n\n\n\n#include <linux/sched.h>\n#include <linux/wait.h>\n\n#include \"kselftest.h\"\n\n#define EXPECTED_TESTS 1\n\nint fork_test(void);\nint verify_fork(void);\n\n \nint fork_test_c(void)\n{\n\tpid_t newpid, waiting;\n\tint child_status, parent_result;\n\n\tnewpid = fork();\n\tif (newpid == 0) {\n\t\t \n\t\tif (!verify_fork()) {\n\t\t\tksft_print_msg(\"ZA state invalid in child\\n\");\n\t\t\texit(0);\n\t\t} else {\n\t\t\texit(1);\n\t\t}\n\t}\n\tif (newpid < 0) {\n\t\tksft_print_msg(\"fork() failed: %d\\n\", newpid);\n\n\t\treturn 0;\n\t}\n\n\tparent_result = verify_fork();\n\tif (!parent_result)\n\t\tksft_print_msg(\"ZA state invalid in parent\\n\");\n\n\tfor (;;) {\n\t\twaiting = waitpid(newpid, &child_status, 0);\n\n\t\tif (waiting < 0) {\n\t\t\tif (errno == EINTR)\n\t\t\t\tcontinue;\n\t\t\tksft_print_msg(\"waitpid() failed: %d\\n\", errno);\n\t\t\treturn 0;\n\t\t}\n\t\tif (waiting != newpid) {\n\t\t\tksft_print_msg(\"waitpid() returned wrong PID\\n\");\n\t\t\treturn 0;\n\t\t}\n\n\t\tif (!WIFEXITED(child_status)) {\n\t\t\tksft_print_msg(\"child did not exit\\n\");\n\t\t\treturn 0;\n\t\t}\n\n\t\treturn WEXITSTATUS(child_status) && parent_result;\n\t}\n}\n\nint main(int argc, char **argv)\n{\n\tint ret, i;\n\n\tksft_print_header();\n\tksft_set_plan(EXPECTED_TESTS);\n\n\tksft_print_msg(\"PID: %d\\n\", getpid());\n\n\t \n\tret = open(\"/proc/sys/abi/sme_default_vector_length\", O_RDONLY, 0);\n\tif (ret >= 0) {\n\t\tksft_test_result(fork_test(), \"fork_test\\n\");\n\n\t} else {\n\t\tksft_print_msg(\"SME not supported\\n\");\n\t\tfor (i = 0; i < EXPECTED_TESTS; i++) {\n\t\t\tksft_test_result_skip(\"fork_test\\n\");\n\t\t}\n\t}\n\n\tksft_finished();\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}