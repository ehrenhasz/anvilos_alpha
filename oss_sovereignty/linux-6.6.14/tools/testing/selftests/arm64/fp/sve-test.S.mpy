{
  "module_name": "sve-test.S",
  "hash_id": "fbec4847538521b44781596f9d026df702790fab91563a3f0178322f502e8216",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/arm64/fp/sve-test.S",
  "human_readable_source": " \n \n \n \n \n \n \n \n \n \n \n\n#include <asm/unistd.h>\n#include \"assembler.h\"\n#include \"asm-offsets.h\"\n#include \"sme-inst.h\"\n\n#define NZR\t32\n#define NPR\t16\n#define MAXVL_B\t(2048 / 8)\n\n.arch_extension sve\n\n.macro _sve_ldr_v zt, xn\n\tldr\tz\\zt, [x\\xn]\n.endm\n\n.macro _sve_str_v zt, xn\n\tstr\tz\\zt, [x\\xn]\n.endm\n\n.macro _sve_ldr_p pt, xn\n\tldr\tp\\pt, [x\\xn]\n.endm\n\n.macro _sve_str_p pt, xn\n\tstr\tp\\pt, [x\\xn]\n.endm\n\n \n \n \n \n \ndefine_accessor setz, NZR, _sve_ldr_v\ndefine_accessor getz, NZR, _sve_str_v\ndefine_accessor setp, NPR, _sve_ldr_p\ndefine_accessor getp, NPR, _sve_str_p\n\n \n.pushsection .text\n.data\n.align 4\nzref:\n\t.space\tMAXVL_B * NZR\npref:\n\t.space\tMAXVL_B / 8 * NPR\nffrref:\n\t.space\tMAXVL_B / 8\nscratch:\n\t.space\tMAXVL_B\n.popsection\n\n \n \n \n \n\n \n \n \n \n \n \n\nfunction pattern\n\torr\tw1, w0, w1, lsl #16\n\torr\tw2, w1, w2, lsl #28\n\n\tldr\tx0, =scratch\n\tmov\tw1, #MAXVL_B / 4\n\n0:\tstr\tw2, [x0], #4\n\tadd\tw2, w2, #(1 << 22)\n\tsubs\tw1, w1, #1\n\tbne\t0b\n\n\tret\nendfunction\n\n \n.macro _adrz xd, xn, nrtmp\n\tldr\t\\xd, =zref\n\trdvl\tx\\nrtmp, #1\n\tmadd\t\\xd, x\\nrtmp, \\xn, \\xd\n.endm\n\n \n.macro _adrp xd, xn, nrtmp\n\tldr\t\\xd, =pref\n\trdvl\tx\\nrtmp, #1\n\tlsr\tx\\nrtmp, x\\nrtmp, #3\n\tsub\t\\xn, \\xn, #NZR\n\tmadd\t\\xd, x\\nrtmp, \\xn, \\xd\n.endm\n\n \n \n \n \nfunction setup_zreg\n\tmov\tx4, x30\n\n\tmov\tx6, x1\n\tbl\tpattern\n\t_adrz\tx0, x6, 2\n\tmov\tx5, x0\n\tldr\tx1, =scratch\n\tbl\tmemcpy\n\n\tmov\tx0, x6\n\tmov\tx1, x5\n\tbl\tsetz\n\n\tret\tx4\nendfunction\n\n \n \n \n \nfunction setup_preg\n\tmov\tx4, x30\n\n\tmov\tx6, x1\n\tbl\tpattern\n\t_adrp\tx0, x6, 2\n\tmov\tx5, x0\n\tldr\tx1, =scratch\n\tbl\tmemcpy\n\n\tmov\tx0, x6\n\tmov\tx1, x5\n\tbl\tsetp\n\n\tret\tx4\nendfunction\n\n \n \n \n \n \n \n \n \n \n \nfunction setup_ffr\n#ifndef SSVE\n\tmov\tx4, x30\n\n\tand\tw0, w0, #0x3\n\tbfi\tw0, w2, #2, #2\n\tmov\tw1, #1\n\tlsl\tw1, w1, w0\n\tsub\tw1, w1, #1\n\n\tldr\tx0, =ffrref\n\tstrh\tw1, [x0], 2\n\trdvl\tx1, #1\n\tlsr\tx1, x1, #3\n\tsub\tx1, x1, #2\n\tbl\tmemclr\n\n\tmov\tx0, #0\n\tldr\tx1, =ffrref\n\tbl\tsetp\n\n\twrffr\tp0.b\n\n\tret\tx4\n#else\n\tret\n#endif\nendfunction\n\n \n \n \n \nfunction memcmp\n\tcbz\tx2, 2f\n\n\tstp\tx0, x1, [sp, #-0x20]!\n\tstr\tx2, [sp, #0x10]\n\n\tmov\tx5, #0\n0:\tldrb\tw3, [x0, x5]\n\tldrb\tw4, [x1, x5]\n\tadd\tx5, x5, #1\n\tcmp\tw3, w4\n\tb.ne\t1f\n\tsubs\tx2, x2, #1\n\tb.ne\t0b\n\n1:\tldr\tx2, [sp, #0x10]\n\tldp\tx0, x1, [sp], #0x20\n\tb.ne\tbarf\n\n2:\tret\nendfunction\n\n \n \n \nfunction check_zreg\n\tmov\tx3, x30\n\n\t_adrz\tx5, x0, 6\n\tmov\tx4, x0\n\tldr\tx7, =scratch\n\n\tmov\tx0, x7\n\tmov\tx1, x6\n\tbl\tmemfill_ae\n\n\tmov\tx0, x4\n\tmov\tx1, x7\n\tbl\tgetz\n\n\tmov\tx0, x5\n\tmov\tx1, x7\n\tmov\tx2, x6\n\tmov\tx30, x3\n\tb\tmemcmp\nendfunction\n\n \n \n \nfunction check_preg\n\tmov\tx3, x30\n\n\t_adrp\tx5, x0, 6\n\tmov\tx4, x0\n\tldr\tx7, =scratch\n\n\tmov\tx0, x7\n\tmov\tx1, x6\n\tbl\tmemfill_ae\n\n\tmov\tx0, x4\n\tmov\tx1, x7\n\tbl\tgetp\n\n\tmov\tx0, x5\n\tmov\tx1, x7\n\tmov\tx2, x6\n\tmov\tx30, x3\n\tb\tmemcmp\nendfunction\n\n \n \n \nfunction check_ffr\n#ifndef SSVE\n\tmov\tx3, x30\n\n\tldr\tx4, =scratch\n\trdvl\tx5, #1\n\tlsr\tx5, x5, #3\n\n\tmov\tx0, x4\n\tmov\tx1, x5\n\tbl\tmemfill_ae\n\n\trdffr\tp0.b\n\tmov\tx0, #0\n\tmov\tx1, x4\n\tbl\tgetp\n\n\tldr\tx0, =ffrref\n\tmov\tx1, x4\n\tmov\tx2, x5\n\tmov\tx30, x3\n\tb\tmemcmp\n#else\n\tret\n#endif\nendfunction\n\n \n \nfunction irritator_handler\n\t \n\tldr\tx0, [x2, #ucontext_regs + 8 * 23]\n\tadd\tx0, x0, #1\n\tstr\tx0, [x2, #ucontext_regs + 8 * 23]\n\n\t \n\tadr\tx0, .text + (irritator_handler - .text) / 16 * 16\n\tmovi\tv0.8b, #1\n\tmovi\tv9.16b, #2\n\tmovi\tv31.8b, #3\n#ifndef SSVE\n\t \n\trdffr\tp0.b\n\t \n\twrffr\tp15.b\n#endif\n\n\tret\nendfunction\n\nfunction tickle_handler\n\t \n\tldr\tx0, [x2, #ucontext_regs + 8 * 23]\n\tadd\tx0, x0, #1\n\tstr\tx0, [x2, #ucontext_regs + 8 * 23]\n\n\tret\nendfunction\n\nfunction terminate_handler\n\tmov\tw21, w0\n\tmov\tx20, x2\n\n\tputs\t\"Terminated by signal \"\n\tmov\tw0, w21\n\tbl\tputdec\n\tputs\t\", no error, iterations=\"\n\tldr\tx0, [x20, #ucontext_regs + 8 * 22]\n\tbl\tputdec\n\tputs\t\", signals=\"\n\tldr\tx0, [x20, #ucontext_regs + 8 * 23]\n\tbl\tputdecn\n\n\tmov\tx0, #0\n\tmov\tx8, #__NR_exit\n\tsvc\t#0\nendfunction\n\n \n \n \n \nfunction setsignal\n\tstr\tx30, [sp, #-((sa_sz + 15) / 16 * 16 + 16)]!\n\n\tmov\tw4, w0\n\tmov\tx5, x1\n\tmov\tw6, w2\n\n\tadd\tx0, sp, #16\n\tmov\tx1, #sa_sz\n\tbl\tmemclr\n\n\tmov\tw0, w4\n\tadd\tx1, sp, #16\n\tstr\tw6, [x1, #sa_flags]\n\tstr\tx5, [x1, #sa_handler]\n\tmov\tx2, #0\n\tmov\tx3, #sa_mask_sz\n\tmov\tx8, #__NR_rt_sigaction\n\tsvc\t#0\n\n\tcbz\tw0, 1f\n\n\tputs\t\"sigaction failure\\n\"\n\tb\t.Labort\n\n1:\tldr\tx30, [sp], #((sa_sz + 15) / 16 * 16 + 16)\n\tret\nendfunction\n\n \n.globl _start\nfunction _start\n\tmov\tx23, #0\t\t \n\n\tmov\tw0, #SIGINT\n\tadr\tx1, terminate_handler\n\tmov\tw2, #SA_SIGINFO\n\tbl\tsetsignal\n\n\tmov\tw0, #SIGTERM\n\tadr\tx1, terminate_handler\n\tmov\tw2, #SA_SIGINFO\n\tbl\tsetsignal\n\n\tmov\tw0, #SIGUSR1\n\tadr\tx1, irritator_handler\n\tmov\tw2, #SA_SIGINFO\n\torr\tw2, w2, #SA_NODEFER\n\tbl\tsetsignal\n\n\tmov\tw0, #SIGUSR2\n\tadr\tx1, tickle_handler\n\tmov\tw2, #SA_SIGINFO\n\torr\tw2, w2, #SA_NODEFER\n\tbl\tsetsignal\n\n#ifdef SSVE\n\tputs\t\"Streaming mode \"\n\tsmstart_sm\n#endif\n\n\t \n\n\trdvl\tx19, #8\n\tcmp\tx19, #128\n\tb.lo\t1f\n\tcmp\tx19, #2048\n\tb.hi\t1f\n\ttst\tx19, #(8 - 1)\n\tb.eq\t2f\n\n1:\tputs\t\"Bad vector length: \"\n\tmov\tx0, x19\n\tbl\tputdecn\n\tb\t.Labort\n\n2:\tputs\t\"Vector length:\\t\"\n\tmov\tx0, x19\n\tbl\tputdec\n\tputs\t\" bits\\n\"\n\n\t \n\n\tmov\tx8, #__NR_getpid\n\tsvc\t#0\n\tmov\tx20, x0\n\n\tputs\t\"PID:\\t\"\n\tmov\tx0, x20\n\tbl\tputdecn\n\n#ifdef SSVE\n\tsmstart_sm\t\t \n#endif\n\n\tmov\tx22, #0\t\t \n.Ltest_loop:\n\trdvl\tx0, #8\n\tcmp\tx0, x19\n\tb.ne\tvl_barf\n\n\tmov\tx21, #0\t\t \n0:\tmov\tx0, x20\n\tmov\tx1, x21\n\tand\tx2, x22, #0xf\n\tbl\tsetup_zreg\n\tadd\tx21, x21, #1\n\tcmp\tx21, #NZR\n\tb.lo\t0b\n\n\tmov\tx0, x20\t\t \n\tmov\tx1, #NZR + NPR\n\tand\tx2, x22, #0xf\n\tbl\tsetup_ffr\n\n0:\tmov\tx0, x20\t\t \n\tmov\tx1, x21\n\tand\tx2, x22, #0xf\n\tbl\tsetup_preg\n\tadd\tx21, x21, #1\n\tcmp\tx21, #NZR + NPR\n\tb.lo\t0b\n\n \n \n \n\n\tmov\tx21, #0\n0:\tmov\tx0, x21\n\tbl\tcheck_zreg\n\tadd\tx21, x21, #1\n\tcmp\tx21, #NZR\n\tb.lo\t0b\n\n0:\tmov\tx0, x21\n\tbl\tcheck_preg\n\tadd\tx21, x21, #1\n\tcmp\tx21, #NZR + NPR\n\tb.lo\t0b\n\n\tbl\tcheck_ffr\n\n\tadd\tx22, x22, #1\n\tb\t.Ltest_loop\n\n.Labort:\n\tmov\tx0, #0\n\tmov\tx1, #SIGABRT\n\tmov\tx8, #__NR_kill\n\tsvc\t#0\nendfunction\n\nfunction barf\n \n \n \n \n \n\tmov\tx10, x0\t \n\tmov\tx11, x1\t \n\tmov\tx12, x2\t \n\n\tputs\t\"Mismatch: PID=\"\n\tmov\tx0, x20\n\tbl\tputdec\n\tputs\t\", iteration=\"\n\tmov\tx0, x22\n\tbl\tputdec\n\tputs\t\", reg=\"\n\tmov\tx0, x21\n\tbl\tputdecn\n\tputs\t\"\\tExpected [\"\n\tmov\tx0, x10\n\tmov\tx1, x12\n\tbl\tdumphex\n\tputs\t\"]\\n\\tGot      [\"\n\tmov\tx0, x11\n\tmov\tx1, x12\n\tbl\tdumphex\n\tputs\t\"]\\n\"\n\n\tmov\tx8, #__NR_getpid\n\tsvc\t#0\n \n \n \n \n \n\tmov\tx1, #SIGABRT\n\tmov\tx8, #__NR_kill\n\tsvc\t#0\n \n \n \nendfunction\n\nfunction vl_barf\n\tmov\tx10, x0\n\n\tputs\t\"Bad active VL: \"\n\tmov\tx0, x10\n\tbl\tputdecn\n\n\tmov\tx8, #__NR_exit\n\tmov\tx1, #1\n\tsvc\t#0\nendfunction\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}