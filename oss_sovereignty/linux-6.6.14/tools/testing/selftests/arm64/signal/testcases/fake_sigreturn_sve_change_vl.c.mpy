{
  "module_name": "fake_sigreturn_sve_change_vl.c",
  "hash_id": "2da7c6d230fbea271c07e34260f50009a031dd8183ff0c3267949422be70e27e",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/arm64/signal/testcases/fake_sigreturn_sve_change_vl.c",
  "human_readable_source": "\n \n\n#include <kselftest.h>\n#include <signal.h>\n#include <ucontext.h>\n#include <sys/prctl.h>\n\n#include \"test_signals_utils.h\"\n#include \"testcases.h\"\n\nstruct fake_sigframe sf;\nstatic unsigned int vls[SVE_VQ_MAX];\nunsigned int nvls = 0;\n\nstatic bool sve_get_vls(struct tdescr *td)\n{\n\tint vq, vl;\n\n\t \n\tfor (vq = SVE_VQ_MAX; vq > 0; --vq) {\n\t\tvl = prctl(PR_SVE_SET_VL, vq * 16);\n\t\tif (vl == -1)\n\t\t\treturn false;\n\n\t\tvl &= PR_SVE_VL_LEN_MASK;\n\n\t\t \n\t\tvq = sve_vq_from_vl(vl);\n\n\t\tvls[nvls++] = vl;\n\t}\n\n\t \n\tif (nvls < 2) {\n\t\tfprintf(stderr, \"Only %d VL supported\\n\", nvls);\n\t\ttd->result = KSFT_SKIP;\n\t\treturn false;\n\t}\n\n\treturn true;\n}\n\nstatic int fake_sigreturn_sve_change_vl(struct tdescr *td,\n\t\t\t\t\tsiginfo_t *si, ucontext_t *uc)\n{\n\tsize_t resv_sz, offset;\n\tstruct _aarch64_ctx *head = GET_SF_RESV_HEAD(sf);\n\tstruct sve_context *sve;\n\n\t \n\tif (!get_current_context(td, &sf.uc, sizeof(sf.uc)))\n\t\treturn 1;\n\n\tresv_sz = GET_SF_RESV_SIZE(sf);\n\thead = get_header(head, SVE_MAGIC, resv_sz, &offset);\n\tif (!head) {\n\t\tfprintf(stderr, \"No SVE context\\n\");\n\t\treturn 1;\n\t}\n\n\tif (head->size != sizeof(struct sve_context)) {\n\t\tfprintf(stderr, \"SVE register state active, skipping\\n\");\n\t\treturn 1;\n\t}\n\n\tsve = (struct sve_context *)head;\n\n\t \n\tfprintf(stderr, \"Attempting to change VL from %d to %d\\n\",\n\t\tsve->vl, vls[0]);\n\tsve->vl = vls[0];\n\n\tfake_sigreturn(&sf, sizeof(sf), 0);\n\n\treturn 1;\n}\n\nstruct tdescr tde = {\n\t.name = \"FAKE_SIGRETURN_SVE_CHANGE\",\n\t.descr = \"Attempt to change SVE VL\",\n\t.feats_required = FEAT_SVE,\n\t.sig_ok = SIGSEGV,\n\t.timeout = 3,\n\t.init = sve_get_vls,\n\t.run = fake_sigreturn_sve_change_vl,\n};\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}