{
  "module_name": "check_prctl.c",
  "hash_id": "ca89ff9328949ac946448c59773c43a329260c70298e21c4493864c60b5c1a9d",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/arm64/mte/check_prctl.c",
  "human_readable_source": "\n\n\n#include <stdbool.h>\n#include <stdio.h>\n#include <string.h>\n\n#include <sys/auxv.h>\n#include <sys/prctl.h>\n\n#include <asm/hwcap.h>\n\n#include \"kselftest.h\"\n\nstatic int set_tagged_addr_ctrl(int val)\n{\n\tint ret;\n\n\tret = prctl(PR_SET_TAGGED_ADDR_CTRL, val, 0, 0, 0);\n\tif (ret < 0)\n\t\tksft_print_msg(\"PR_SET_TAGGED_ADDR_CTRL: failed %d %d (%s)\\n\",\n\t\t\t       ret, errno, strerror(errno));\n\treturn ret;\n}\n\nstatic int get_tagged_addr_ctrl(void)\n{\n\tint ret;\n\n\tret = prctl(PR_GET_TAGGED_ADDR_CTRL, 0, 0, 0, 0);\n\tif (ret < 0)\n\t\tksft_print_msg(\"PR_GET_TAGGED_ADDR_CTRL failed: %d %d (%s)\\n\",\n\t\t\t       ret, errno, strerror(errno));\n\treturn ret;\n}\n\n \nvoid check_basic_read(void)\n{\n\tint ret;\n\n\tret = get_tagged_addr_ctrl();\n\tif (ret < 0) {\n\t\tksft_test_result_fail(\"check_basic_read\\n\");\n\t\treturn;\n\t}\n\n\tif (ret & PR_MTE_TCF_SYNC)\n\t\tksft_print_msg(\"SYNC enabled\\n\");\n\tif (ret & PR_MTE_TCF_ASYNC)\n\t\tksft_print_msg(\"ASYNC enabled\\n\");\n\n\t \n\tksft_test_result_pass(\"check_basic_read\\n\");\n}\n\n \nvoid set_mode_test(const char *name, int hwcap2, int mask)\n{\n\tint ret;\n\n\tif ((getauxval(AT_HWCAP2) & hwcap2) != hwcap2) {\n\t\tksft_test_result_skip(\"%s\\n\", name);\n\t\treturn;\n\t}\n\n\tret = set_tagged_addr_ctrl(mask);\n\tif (ret < 0) {\n\t\tksft_test_result_fail(\"%s\\n\", name);\n\t\treturn;\n\t}\n\n\tret = get_tagged_addr_ctrl();\n\tif (ret < 0) {\n\t\tksft_test_result_fail(\"%s\\n\", name);\n\t\treturn;\n\t}\n\n\tif ((ret & PR_MTE_TCF_MASK) == mask) {\n\t\tksft_test_result_pass(\"%s\\n\", name);\n\t} else {\n\t\tksft_print_msg(\"Got %x, expected %x\\n\",\n\t\t\t       (ret & PR_MTE_TCF_MASK), mask);\n\t\tksft_test_result_fail(\"%s\\n\", name);\n\t}\n}\n\nstruct mte_mode {\n\tint mask;\n\tint hwcap2;\n\tconst char *name;\n} mte_modes[] = {\n\t{ PR_MTE_TCF_NONE,  0,          \"NONE\"  },\n\t{ PR_MTE_TCF_SYNC,  HWCAP2_MTE, \"SYNC\"  },\n\t{ PR_MTE_TCF_ASYNC, HWCAP2_MTE, \"ASYNC\" },\n\t{ PR_MTE_TCF_SYNC | PR_MTE_TCF_ASYNC,  HWCAP2_MTE, \"SYNC+ASYNC\"  },\n};\n\nint main(void)\n{\n\tint i;\n\n\tksft_print_header();\n\tksft_set_plan(5);\n\n\tcheck_basic_read();\n\tfor (i = 0; i < ARRAY_SIZE(mte_modes); i++)\n\t\tset_mode_test(mte_modes[i].name, mte_modes[i].hwcap2,\n\t\t\t      mte_modes[i].mask);\n\n\tksft_print_cnts();\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}