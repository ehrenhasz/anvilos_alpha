{
  "module_name": "test_FCOMI.c",
  "hash_id": "fefe39d0241ad3c6f9f4f3b5266a0634d7e85658670eaff3be4ffccae98c3686",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/x86/test_FCOMI.c",
  "human_readable_source": "\n#undef _GNU_SOURCE\n#define _GNU_SOURCE 1\n#undef __USE_GNU\n#define __USE_GNU 1\n#include <unistd.h>\n#include <stdlib.h>\n#include <string.h>\n#include <stdio.h>\n#include <signal.h>\n#include <sys/types.h>\n#include <sys/select.h>\n#include <sys/time.h>\n#include <sys/wait.h>\n#include <fenv.h>\n\nenum {\n\tCF = 1 << 0,\n\tPF = 1 << 2,\n\tZF = 1 << 6,\n\tARITH = CF | PF | ZF,\n};\n\nlong res_fcomi_pi_1;\nlong res_fcomi_1_pi;\nlong res_fcomi_1_1;\nlong res_fcomi_nan_1;\n \n \nint snan = 0x7fc11111;\nint qnan = 0x7f811111;\nunsigned short snan1[5];\n \nunsigned short snan80[5] = { 0x1111, 0x1111, 0x1111, 0x8111, 0x7fff };\n\nint test(long flags)\n{\n\tfeclearexcept(FE_DIVBYZERO|FE_INEXACT|FE_INVALID|FE_OVERFLOW|FE_UNDERFLOW);\n\n\tasm (\"\\n\"\n\n\t\"\tpush\t%0\"\"\\n\"\n\t\"\tpopf\"\"\\n\"\n\t\"\tfld1\"\"\\n\"\n\t\"\tfldpi\"\"\\n\"\n\t\"\tfcomi\t%%st(1), %%st\" \"\\n\"\n\t\"\tffree\t%%st(0)\" \"\\n\"\n\t\"\tffree\t%%st(1)\" \"\\n\"\n\t\"\tpushf\"\"\\n\"\n\t\"\tpop\tres_fcomi_1_pi\"\"\\n\"\n\n\t\"\tpush\t%0\"\"\\n\"\n\t\"\tpopf\"\"\\n\"\n\t\"\tfldpi\"\"\\n\"\n\t\"\tfld1\"\"\\n\"\n\t\"\tfcomi\t%%st(1), %%st\" \"\\n\"\n\t\"\tffree\t%%st(0)\" \"\\n\"\n\t\"\tffree\t%%st(1)\" \"\\n\"\n\t\"\tpushf\"\"\\n\"\n\t\"\tpop\tres_fcomi_pi_1\"\"\\n\"\n\n\t\"\tpush\t%0\"\"\\n\"\n\t\"\tpopf\"\"\\n\"\n\t\"\tfld1\"\"\\n\"\n\t\"\tfld1\"\"\\n\"\n\t\"\tfcomi\t%%st(1), %%st\" \"\\n\"\n\t\"\tffree\t%%st(0)\" \"\\n\"\n\t\"\tffree\t%%st(1)\" \"\\n\"\n\t\"\tpushf\"\"\\n\"\n\t\"\tpop\tres_fcomi_1_1\"\"\\n\"\n\t:\n\t: \"r\" (flags)\n\t);\n\tif ((res_fcomi_1_pi & ARITH) != (0)) {\n\t\tprintf(\"[BAD]\\tfcomi_1_pi with flags:%lx\\n\", flags);\n\t\treturn 1;\n\t}\n\tif ((res_fcomi_pi_1 & ARITH) != (CF)) {\n\t\tprintf(\"[BAD]\\tfcomi_pi_1 with flags:%lx->%lx\\n\", flags, res_fcomi_pi_1 & ARITH);\n\t\treturn 1;\n\t}\n\tif ((res_fcomi_1_1 & ARITH) != (ZF)) {\n\t\tprintf(\"[BAD]\\tfcomi_1_1 with flags:%lx\\n\", flags);\n\t\treturn 1;\n\t}\n\tif (fetestexcept(FE_INVALID) != 0) {\n\t\tprintf(\"[BAD]\\tFE_INVALID is set in %s\\n\", __func__);\n\t\treturn 1;\n\t}\n\treturn 0;\n}\n\nint test_qnan(long flags)\n{\n\tfeclearexcept(FE_DIVBYZERO|FE_INEXACT|FE_INVALID|FE_OVERFLOW|FE_UNDERFLOW);\n\n\tasm (\"\\n\"\n\t\"\tpush\t%0\"\"\\n\"\n\t\"\tpopf\"\"\\n\"\n\t\"\tflds\tqnan\"\"\\n\"\n\t\"\tfld1\"\"\\n\"\n\t\"\tfnclex\"\"\\n\"\t\t\n\t\"\tfcomi\t%%st(1), %%st\" \"\\n\"\n\t\"\tffree\t%%st(0)\" \"\\n\"\n\t\"\tffree\t%%st(1)\" \"\\n\"\n\t\"\tpushf\"\"\\n\"\n\t\"\tpop\tres_fcomi_nan_1\"\"\\n\"\n\t:\n\t: \"r\" (flags)\n\t);\n\tif ((res_fcomi_nan_1 & ARITH) != (ZF|CF|PF)) {\n\t\tprintf(\"[BAD]\\tfcomi_qnan_1 with flags:%lx\\n\", flags);\n\t\treturn 1;\n\t}\n\tif (fetestexcept(FE_INVALID) != FE_INVALID) {\n\t\tprintf(\"[BAD]\\tFE_INVALID is not set in %s\\n\", __func__);\n\t\treturn 1;\n\t}\n\treturn 0;\n}\n\nint testu_qnan(long flags)\n{\n\tfeclearexcept(FE_DIVBYZERO|FE_INEXACT|FE_INVALID|FE_OVERFLOW|FE_UNDERFLOW);\n\n\tasm (\"\\n\"\n\t\"\tpush\t%0\"\"\\n\"\n\t\"\tpopf\"\"\\n\"\n\t\"\tflds\tqnan\"\"\\n\"\n\t\"\tfld1\"\"\\n\"\n\t\"\tfnclex\"\"\\n\"\t\t\n\t\"\tfucomi\t%%st(1), %%st\" \"\\n\"\n\t\"\tffree\t%%st(0)\" \"\\n\"\n\t\"\tffree\t%%st(1)\" \"\\n\"\n\t\"\tpushf\"\"\\n\"\n\t\"\tpop\tres_fcomi_nan_1\"\"\\n\"\n\t:\n\t: \"r\" (flags)\n\t);\n\tif ((res_fcomi_nan_1 & ARITH) != (ZF|CF|PF)) {\n\t\tprintf(\"[BAD]\\tfcomi_qnan_1 with flags:%lx\\n\", flags);\n\t\treturn 1;\n\t}\n\tif (fetestexcept(FE_INVALID) != 0) {\n\t\tprintf(\"[BAD]\\tFE_INVALID is set in %s\\n\", __func__);\n\t\treturn 1;\n\t}\n\treturn 0;\n}\n\nint testu_snan(long flags)\n{\n\tfeclearexcept(FE_DIVBYZERO|FE_INEXACT|FE_INVALID|FE_OVERFLOW|FE_UNDERFLOW);\n\n\tasm (\"\\n\"\n\t\"\tpush\t%0\"\"\\n\"\n\t\"\tpopf\"\"\\n\"\n\n\n\n\t\"\tfldt\tsnan80\"\"\\n\"\t\n\t\"\tfld1\"\"\\n\"\n\t\"\tfucomi\t%%st(1), %%st\" \"\\n\"\n\t\"\tffree\t%%st(0)\" \"\\n\"\n\t\"\tffree\t%%st(1)\" \"\\n\"\n\t\"\tpushf\"\"\\n\"\n\t\"\tpop\tres_fcomi_nan_1\"\"\\n\"\n\t:\n\t: \"r\" (flags)\n\t);\n\tif ((res_fcomi_nan_1 & ARITH) != (ZF|CF|PF)) {\n\t\tprintf(\"[BAD]\\tfcomi_qnan_1 with flags:%lx\\n\", flags);\n\t\treturn 1;\n\t}\n\n\tif (fetestexcept(FE_INVALID) != FE_INVALID) {\n\t\tprintf(\"[BAD]\\tFE_INVALID is not set in %s\\n\", __func__);\n\t\treturn 1;\n\t}\n\treturn 0;\n}\n\nint testp(long flags)\n{\n\tfeclearexcept(FE_DIVBYZERO|FE_INEXACT|FE_INVALID|FE_OVERFLOW|FE_UNDERFLOW);\n\n\tasm (\"\\n\"\n\n\t\"\tpush\t%0\"\"\\n\"\n\t\"\tpopf\"\"\\n\"\n\t\"\tfld1\"\"\\n\"\n\t\"\tfldpi\"\"\\n\"\n\t\"\tfcomip\t%%st(1), %%st\" \"\\n\"\n\t\"\tffree\t%%st(0)\" \"\\n\"\n\t\"\tpushf\"\"\\n\"\n\t\"\tpop\tres_fcomi_1_pi\"\"\\n\"\n\n\t\"\tpush\t%0\"\"\\n\"\n\t\"\tpopf\"\"\\n\"\n\t\"\tfldpi\"\"\\n\"\n\t\"\tfld1\"\"\\n\"\n\t\"\tfcomip\t%%st(1), %%st\" \"\\n\"\n\t\"\tffree\t%%st(0)\" \"\\n\"\n\t\"\tpushf\"\"\\n\"\n\t\"\tpop\tres_fcomi_pi_1\"\"\\n\"\n\n\t\"\tpush\t%0\"\"\\n\"\n\t\"\tpopf\"\"\\n\"\n\t\"\tfld1\"\"\\n\"\n\t\"\tfld1\"\"\\n\"\n\t\"\tfcomip\t%%st(1), %%st\" \"\\n\"\n\t\"\tffree\t%%st(0)\" \"\\n\"\n\t\"\tpushf\"\"\\n\"\n\t\"\tpop\tres_fcomi_1_1\"\"\\n\"\n\t:\n\t: \"r\" (flags)\n\t);\n\tif ((res_fcomi_1_pi & ARITH) != (0)) {\n\t\tprintf(\"[BAD]\\tfcomi_1_pi with flags:%lx\\n\", flags);\n\t\treturn 1;\n\t}\n\tif ((res_fcomi_pi_1 & ARITH) != (CF)) {\n\t\tprintf(\"[BAD]\\tfcomi_pi_1 with flags:%lx->%lx\\n\", flags, res_fcomi_pi_1 & ARITH);\n\t\treturn 1;\n\t}\n\tif ((res_fcomi_1_1 & ARITH) != (ZF)) {\n\t\tprintf(\"[BAD]\\tfcomi_1_1 with flags:%lx\\n\", flags);\n\t\treturn 1;\n\t}\n\tif (fetestexcept(FE_INVALID) != 0) {\n\t\tprintf(\"[BAD]\\tFE_INVALID is set in %s\\n\", __func__);\n\t\treturn 1;\n\t}\n\treturn 0;\n}\n\nint testp_qnan(long flags)\n{\n\tfeclearexcept(FE_DIVBYZERO|FE_INEXACT|FE_INVALID|FE_OVERFLOW|FE_UNDERFLOW);\n\n\tasm (\"\\n\"\n\t\"\tpush\t%0\"\"\\n\"\n\t\"\tpopf\"\"\\n\"\n\t\"\tflds\tqnan\"\"\\n\"\n\t\"\tfld1\"\"\\n\"\n\t\"\tfnclex\"\"\\n\"\t\t\n\t\"\tfcomip\t%%st(1), %%st\" \"\\n\"\n\t\"\tffree\t%%st(0)\" \"\\n\"\n\t\"\tpushf\"\"\\n\"\n\t\"\tpop\tres_fcomi_nan_1\"\"\\n\"\n\t:\n\t: \"r\" (flags)\n\t);\n\tif ((res_fcomi_nan_1 & ARITH) != (ZF|CF|PF)) {\n\t\tprintf(\"[BAD]\\tfcomi_qnan_1 with flags:%lx\\n\", flags);\n\t\treturn 1;\n\t}\n\tif (fetestexcept(FE_INVALID) != FE_INVALID) {\n\t\tprintf(\"[BAD]\\tFE_INVALID is not set in %s\\n\", __func__);\n\t\treturn 1;\n\t}\n\treturn 0;\n}\n\nint testup_qnan(long flags)\n{\n\tfeclearexcept(FE_DIVBYZERO|FE_INEXACT|FE_INVALID|FE_OVERFLOW|FE_UNDERFLOW);\n\n\tasm (\"\\n\"\n\t\"\tpush\t%0\"\"\\n\"\n\t\"\tpopf\"\"\\n\"\n\t\"\tflds\tqnan\"\"\\n\"\n\t\"\tfld1\"\"\\n\"\n\t\"\tfnclex\"\"\\n\"\t\t\n\t\"\tfucomip\t%%st(1), %%st\" \"\\n\"\n\t\"\tffree\t%%st(0)\" \"\\n\"\n\t\"\tpushf\"\"\\n\"\n\t\"\tpop\tres_fcomi_nan_1\"\"\\n\"\n\t:\n\t: \"r\" (flags)\n\t);\n\tif ((res_fcomi_nan_1 & ARITH) != (ZF|CF|PF)) {\n\t\tprintf(\"[BAD]\\tfcomi_qnan_1 with flags:%lx\\n\", flags);\n\t\treturn 1;\n\t}\n\tif (fetestexcept(FE_INVALID) != 0) {\n\t\tprintf(\"[BAD]\\tFE_INVALID is set in %s\\n\", __func__);\n\t\treturn 1;\n\t}\n\treturn 0;\n}\n\nvoid sighandler(int sig)\n{\n\tprintf(\"[FAIL]\\tGot signal %d, exiting\\n\", sig);\n\texit(1);\n}\n\nint main(int argc, char **argv, char **envp)\n{\n\tint err = 0;\n\n\t \n\tsignal(SIGILL, sighandler);\n\tsignal(SIGFPE, sighandler);\n\tsignal(SIGSEGV, sighandler);\n\n\tprintf(\"[RUN]\\tTesting f[u]comi[p] instructions\\n\");\n\terr |= test(0);\n\terr |= test_qnan(0);\n\terr |= testu_qnan(0);\n\terr |= testu_snan(0);\n\terr |= test(CF|ZF|PF);\n\terr |= test_qnan(CF|ZF|PF);\n\terr |= testu_qnan(CF|ZF|PF);\n\terr |= testu_snan(CF|ZF|PF);\n\terr |= testp(0);\n\terr |= testp_qnan(0);\n\terr |= testup_qnan(0);\n\terr |= testp(CF|ZF|PF);\n\terr |= testp_qnan(CF|ZF|PF);\n\terr |= testup_qnan(CF|ZF|PF);\n\tif (!err)\n\t\tprintf(\"[OK]\\tf[u]comi[p]\\n\");\n\telse\n\t\tprintf(\"[FAIL]\\tf[u]comi[p] errors: %d\\n\", err);\n\n\treturn err;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}