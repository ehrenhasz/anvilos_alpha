{
  "module_name": "syscall_nt.c",
  "hash_id": "6d1f46531897afa9653d3d8d58c941951076ec88c3eab7eef1ad4d612a41bb70",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/x86/syscall_nt.c",
  "human_readable_source": "\n \n\n#include <stdio.h>\n#include <unistd.h>\n#include <string.h>\n#include <signal.h>\n#include <err.h>\n#include <sys/syscall.h>\n\n#include \"helpers.h\"\n\nstatic unsigned int nerrs;\n\nstatic void sethandler(int sig, void (*handler)(int, siginfo_t *, void *),\n\t\t       int flags)\n{\n\tstruct sigaction sa;\n\tmemset(&sa, 0, sizeof(sa));\n\tsa.sa_sigaction = handler;\n\tsa.sa_flags = SA_SIGINFO | flags;\n\tsigemptyset(&sa.sa_mask);\n\tif (sigaction(sig, &sa, 0))\n\t\terr(1, \"sigaction\");\n}\n\nstatic void sigtrap(int sig, siginfo_t *si, void *ctx_void)\n{\n}\n\nstatic void do_it(unsigned long extraflags)\n{\n\tunsigned long flags;\n\n\tset_eflags(get_eflags() | extraflags);\n\tsyscall(SYS_getpid);\n\tflags = get_eflags();\n\tset_eflags(X86_EFLAGS_IF | X86_EFLAGS_FIXED);\n\tif ((flags & extraflags) == extraflags) {\n\t\tprintf(\"[OK]\\tThe syscall worked and flags are still set\\n\");\n\t} else {\n\t\tprintf(\"[FAIL]\\tThe syscall worked but flags were cleared (flags = 0x%lx but expected 0x%lx set)\\n\",\n\t\t       flags, extraflags);\n\t\tnerrs++;\n\t}\n}\n\nint main(void)\n{\n\tprintf(\"[RUN]\\tSet NT and issue a syscall\\n\");\n\tdo_it(X86_EFLAGS_NT);\n\n\tprintf(\"[RUN]\\tSet AC and issue a syscall\\n\");\n\tdo_it(X86_EFLAGS_AC);\n\n\tprintf(\"[RUN]\\tSet NT|AC and issue a syscall\\n\");\n\tdo_it(X86_EFLAGS_NT | X86_EFLAGS_AC);\n\n\t \n\n\tsethandler(SIGTRAP, sigtrap, 0);\n\n\tprintf(\"[RUN]\\tSet TF and issue a syscall\\n\");\n\tdo_it(X86_EFLAGS_TF);\n\n\tprintf(\"[RUN]\\tSet NT|TF and issue a syscall\\n\");\n\tdo_it(X86_EFLAGS_NT | X86_EFLAGS_TF);\n\n\tprintf(\"[RUN]\\tSet AC|TF and issue a syscall\\n\");\n\tdo_it(X86_EFLAGS_AC | X86_EFLAGS_TF);\n\n\tprintf(\"[RUN]\\tSet NT|AC|TF and issue a syscall\\n\");\n\tdo_it(X86_EFLAGS_NT | X86_EFLAGS_AC | X86_EFLAGS_TF);\n\n\t \n\tprintf(\"[RUN]\\tSet DF and issue a syscall\\n\");\n\tdo_it(X86_EFLAGS_DF);\n\n\tprintf(\"[RUN]\\tSet TF|DF and issue a syscall\\n\");\n\tdo_it(X86_EFLAGS_TF | X86_EFLAGS_DF);\n\n\treturn nerrs == 0 ? 0 : 1;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}