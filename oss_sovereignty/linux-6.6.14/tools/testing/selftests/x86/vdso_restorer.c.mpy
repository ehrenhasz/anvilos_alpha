{
  "module_name": "vdso_restorer.c",
  "hash_id": "1ed515edec3f947d8ac2c4c48b8ae1237b8163d8d8b568847737a4e242d4c993",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/x86/vdso_restorer.c",
  "human_readable_source": "\n \n\n#define _GNU_SOURCE\n\n#include <err.h>\n#include <stdio.h>\n#include <dlfcn.h>\n#include <string.h>\n#include <signal.h>\n#include <unistd.h>\n#include <syscall.h>\n#include <sys/syscall.h>\n\n \nstruct real_sigaction {\n\tvoid *handler;\n\tunsigned long flags;\n\tvoid *restorer;\n\tunsigned int mask[2];\n};\n\nstatic volatile sig_atomic_t handler_called;\n\nstatic void handler_with_siginfo(int sig, siginfo_t *info, void *ctx_void)\n{\n\thandler_called = 1;\n}\n\nstatic void handler_without_siginfo(int sig)\n{\n\thandler_called = 1;\n}\n\nint main()\n{\n\tint nerrs = 0;\n\tstruct real_sigaction sa;\n\n\tvoid *vdso = dlopen(\"linux-vdso.so.1\",\n\t\t\t    RTLD_LAZY | RTLD_LOCAL | RTLD_NOLOAD);\n\tif (!vdso)\n\t\tvdso = dlopen(\"linux-gate.so.1\",\n\t\t\t      RTLD_LAZY | RTLD_LOCAL | RTLD_NOLOAD);\n\tif (!vdso) {\n\t\tprintf(\"[SKIP]\\tFailed to find vDSO.  Tests are not expected to work.\\n\");\n\t\treturn 0;\n\t}\n\n\tmemset(&sa, 0, sizeof(sa));\n\tsa.handler = handler_with_siginfo;\n\tsa.flags = SA_SIGINFO;\n\tsa.restorer = NULL;\t \n\n\tprintf(\"[RUN]\\tRaise a signal, SA_SIGINFO, sa.restorer == NULL\\n\");\n\n\tif (syscall(SYS_rt_sigaction, SIGUSR1, &sa, NULL, 8) != 0)\n\t\terr(1, \"raw rt_sigaction syscall\");\n\n\traise(SIGUSR1);\n\n\tif (handler_called) {\n\t\tprintf(\"[OK]\\tSA_SIGINFO handler returned successfully\\n\");\n\t} else {\n\t\tprintf(\"[FAIL]\\tSA_SIGINFO handler was not called\\n\");\n\t\tnerrs++;\n\t}\n\n\tprintf(\"[RUN]\\tRaise a signal, !SA_SIGINFO, sa.restorer == NULL\\n\");\n\n\tsa.flags = 0;\n\tsa.handler = handler_without_siginfo;\n\tif (syscall(SYS_sigaction, SIGUSR1, &sa, 0) != 0)\n\t\terr(1, \"raw sigaction syscall\");\n\thandler_called = 0;\n\n\traise(SIGUSR1);\n\n\tif (handler_called) {\n\t\tprintf(\"[OK]\\t!SA_SIGINFO handler returned successfully\\n\");\n\t} else {\n\t\tprintf(\"[FAIL]\\t!SA_SIGINFO handler was not called\\n\");\n\t\tnerrs++;\n\t}\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}