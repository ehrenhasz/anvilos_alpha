{
  "module_name": "corrupt_xstate_header.c",
  "hash_id": "81f6f69bf039db6202485026780cdd1241ec272ec9b8272284a7a595d7115688",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/x86/corrupt_xstate_header.c",
  "human_readable_source": "\n \n\n#define _GNU_SOURCE\n\n#include <stdlib.h>\n#include <stdio.h>\n#include <string.h>\n#include <sched.h>\n#include <signal.h>\n#include <err.h>\n#include <unistd.h>\n#include <stdint.h>\n#include <sys/wait.h>\n\n#include \"../kselftest.h\"  \n\nstatic inline int xsave_enabled(void)\n{\n\tunsigned int eax, ebx, ecx, edx;\n\n\t__cpuid_count(0x1, 0x0, eax, ebx, ecx, edx);\n\n\t \n\treturn ecx & (1U << 27);\n}\n\nstatic void sethandler(int sig, void (*handler)(int, siginfo_t *, void *),\n\t\t       int flags)\n{\n\tstruct sigaction sa;\n\n\tmemset(&sa, 0, sizeof(sa));\n\tsa.sa_sigaction = handler;\n\tsa.sa_flags = SA_SIGINFO | flags;\n\tsigemptyset(&sa.sa_mask);\n\tif (sigaction(sig, &sa, 0))\n\t\terr(1, \"sigaction\");\n}\n\nstatic void sigusr1(int sig, siginfo_t *info, void *uc_void)\n{\n\tucontext_t *uc = uc_void;\n\tuint8_t *fpstate = (uint8_t *)uc->uc_mcontext.fpregs;\n\tuint64_t *xfeatures = (uint64_t *)(fpstate + 512);\n\n\tprintf(\"\\tWreck XSTATE header\\n\");\n\t \n\t*(xfeatures + 2) = 0xfffffff;\n}\n\nstatic void sigsegv(int sig, siginfo_t *info, void *uc_void)\n{\n\tprintf(\"\\tGot SIGSEGV\\n\");\n}\n\nint main(void)\n{\n\tcpu_set_t set;\n\n\tsethandler(SIGUSR1, sigusr1, 0);\n\tsethandler(SIGSEGV, sigsegv, 0);\n\n\tif (!xsave_enabled()) {\n\t\tprintf(\"[SKIP] CR4.OSXSAVE disabled.\\n\");\n\t\treturn 0;\n\t}\n\n\tCPU_ZERO(&set);\n\tCPU_SET(0, &set);\n\n\t \n\tsched_setaffinity(getpid(), sizeof(set), &set);\n\n\tprintf(\"[RUN]\\tSend ourselves a signal\\n\");\n\traise(SIGUSR1);\n\n\tprintf(\"[OK]\\tBack from the signal.  Now schedule.\\n\");\n\tpid_t child = fork();\n\tif (child < 0)\n\t\terr(1, \"fork\");\n\tif (child == 0)\n\t\treturn 0;\n\tif (child)\n\t\twaitpid(child, NULL, 0);\n\tprintf(\"[OK]\\tBack in the main thread.\\n\");\n\n\t \n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}