{
  "module_name": "ip_defrag.sh",
  "hash_id": "13206fe053dbbf3e1009fabd714c3e0ac04a7ac568ab90a950878e4a08c40438",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/net/ip_defrag.sh",
  "human_readable_source": "#!/bin/sh\n# SPDX-License-Identifier: GPL-2.0\n#\n# Run a couple of IP defragmentation tests.\n\nset +x\nset -e\n\nmodprobe -q nf_defrag_ipv6\n\nreadonly NETNS=\"ns-$(mktemp -u XXXXXX)\"\n\nsetup() {\n\tip netns add \"${NETNS}\"\n\tip -netns \"${NETNS}\" link set lo up\n\n\tip netns exec \"${NETNS}\" sysctl -w net.ipv4.ipfrag_high_thresh=9000000 >/dev/null 2>&1\n\tip netns exec \"${NETNS}\" sysctl -w net.ipv4.ipfrag_low_thresh=7000000 >/dev/null 2>&1\n\tip netns exec \"${NETNS}\" sysctl -w net.ipv4.ipfrag_time=1 >/dev/null 2>&1\n\n\tip netns exec \"${NETNS}\" sysctl -w net.ipv6.ip6frag_high_thresh=9000000 >/dev/null 2>&1\n\tip netns exec \"${NETNS}\" sysctl -w net.ipv6.ip6frag_low_thresh=7000000 >/dev/null 2>&1\n\tip netns exec \"${NETNS}\" sysctl -w net.ipv6.ip6frag_time=1 >/dev/null 2>&1\n\n\tip netns exec \"${NETNS}\" sysctl -w net.netfilter.nf_conntrack_frag6_high_thresh=9000000 >/dev/null 2>&1\n\tip netns exec \"${NETNS}\" sysctl -w net.netfilter.nf_conntrack_frag6_low_thresh=7000000  >/dev/null 2>&1\n\tip netns exec \"${NETNS}\" sysctl -w net.netfilter.nf_conntrack_frag6_timeout=1 >/dev/null 2>&1\n\n\t# DST cache can get full with a lot of frags, with GC not keeping up with the test.\n\tip netns exec \"${NETNS}\" sysctl -w net.ipv6.route.max_size=65536 >/dev/null 2>&1\n}\n\ncleanup() {\n\tip netns del \"${NETNS}\"\n}\n\ntrap cleanup EXIT\nsetup\n\necho \"ipv4 defrag\"\nip netns exec \"${NETNS}\" ./ip_defrag -4\n\necho \"ipv4 defrag with overlaps\"\nip netns exec \"${NETNS}\" ./ip_defrag -4o\n\necho \"ipv6 defrag\"\nip netns exec \"${NETNS}\" ./ip_defrag -6\n\necho \"ipv6 defrag with overlaps\"\nip netns exec \"${NETNS}\" ./ip_defrag -6o\n\n# insert an nf_conntrack rule so that the codepath in nf_conntrack_reasm.c taken\nip netns exec \"${NETNS}\" ip6tables -A INPUT  -m conntrack --ctstate INVALID -j ACCEPT\n\necho \"ipv6 nf_conntrack defrag\"\nip netns exec \"${NETNS}\" ./ip_defrag -6\n\necho \"ipv6 nf_conntrack defrag with overlaps\"\n# netfilter will drop some invalid packets, so we run the test in\n# permissive mode: i.e. pass the test if the packet is correctly assembled\n# even if we sent an overlap\nip netns exec \"${NETNS}\" ./ip_defrag -6op\n\necho \"all tests done\"\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}