{
  "module_name": "socket.c",
  "hash_id": "8e4d66ae715dd4bbf1fdc6b91d7925e230a3d7c3ca99428f8624aee1103e05e5",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/net/socket.c",
  "human_readable_source": "\n#include <stdio.h>\n#include <errno.h>\n#include <unistd.h>\n#include <string.h>\n#include <sys/types.h>\n#include <sys/socket.h>\n#include <netinet/in.h>\n\n#include \"../kselftest.h\"\n\nstruct socket_testcase {\n\tint\tdomain;\n\tint\ttype;\n\tint\tprotocol;\n\n\t \n\tint\texpect;\n\n\t \n\tint\tnosupport_ok;\n};\n\nstatic struct socket_testcase tests[] = {\n\t{ AF_MAX,  0,           0,           -EAFNOSUPPORT,    0 },\n\t{ AF_INET, SOCK_STREAM, IPPROTO_TCP, 0,                1  },\n\t{ AF_INET, SOCK_DGRAM,  IPPROTO_TCP, -EPROTONOSUPPORT, 1  },\n\t{ AF_INET, SOCK_DGRAM,  IPPROTO_UDP, 0,                1  },\n\t{ AF_INET, SOCK_STREAM, IPPROTO_UDP, -EPROTONOSUPPORT, 1  },\n};\n\n#define ERR_STRING_SZ\t64\n\nstatic int run_tests(void)\n{\n\tchar err_string1[ERR_STRING_SZ];\n\tchar err_string2[ERR_STRING_SZ];\n\tint i, err;\n\n\terr = 0;\n\tfor (i = 0; i < ARRAY_SIZE(tests); i++) {\n\t\tstruct socket_testcase *s = &tests[i];\n\t\tint fd;\n\n\t\tfd = socket(s->domain, s->type, s->protocol);\n\t\tif (fd < 0) {\n\t\t\tif (s->nosupport_ok &&\n\t\t\t    errno == EAFNOSUPPORT)\n\t\t\t\tcontinue;\n\n\t\t\tif (s->expect < 0 &&\n\t\t\t    errno == -s->expect)\n\t\t\t\tcontinue;\n\n\t\t\tstrerror_r(-s->expect, err_string1, ERR_STRING_SZ);\n\t\t\tstrerror_r(errno, err_string2, ERR_STRING_SZ);\n\n\t\t\tfprintf(stderr, \"socket(%d, %d, %d) expected \"\n\t\t\t\t\"err (%s) got (%s)\\n\",\n\t\t\t\ts->domain, s->type, s->protocol,\n\t\t\t\terr_string1, err_string2);\n\n\t\t\terr = -1;\n\t\t\tbreak;\n\t\t} else {\n\t\t\tclose(fd);\n\n\t\t\tif (s->expect < 0) {\n\t\t\t\tstrerror_r(errno, err_string1, ERR_STRING_SZ);\n\n\t\t\t\tfprintf(stderr, \"socket(%d, %d, %d) expected \"\n\t\t\t\t\t\"success got err (%s)\\n\",\n\t\t\t\t\ts->domain, s->type, s->protocol,\n\t\t\t\t\terr_string1);\n\n\t\t\t\terr = -1;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn err;\n}\n\nint main(void)\n{\n\tint err = run_tests();\n\n\treturn err;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}