{
  "module_name": "big_tcp.sh",
  "hash_id": "b69d23ce50e0b411c9e6580c9cb4f0b9c8d9bc884cbdc846a759f8d0b1517dfe",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/net/big_tcp.sh",
  "human_readable_source": "#!/bin/bash\n# SPDX-License-Identifier: GPL-2.0\n#\n# Testing For IPv4 and IPv6 BIG TCP.\n# TOPO: CLIENT_NS (link0)<--->(link1) ROUTER_NS (link2)<--->(link3) SERVER_NS\n\nCLIENT_NS=$(mktemp -u client-XXXXXXXX)\nCLIENT_IP4=\"198.51.100.1\"\nCLIENT_IP6=\"2001:db8:1::1\"\n\nSERVER_NS=$(mktemp -u server-XXXXXXXX)\nSERVER_IP4=\"203.0.113.1\"\nSERVER_IP6=\"2001:db8:2::1\"\n\nROUTER_NS=$(mktemp -u router-XXXXXXXX)\nSERVER_GW4=\"203.0.113.2\"\nCLIENT_GW4=\"198.51.100.2\"\nSERVER_GW6=\"2001:db8:2::2\"\nCLIENT_GW6=\"2001:db8:1::2\"\n\nMAX_SIZE=128000\nCHK_SIZE=65535\n\n# Kselftest framework requirement - SKIP code is 4.\nksft_skip=4\n\nsetup() {\n\tip netns add $CLIENT_NS\n\tip netns add $SERVER_NS\n\tip netns add $ROUTER_NS\n\tip -net $ROUTER_NS link add link1 type veth peer name link0 netns $CLIENT_NS\n\tip -net $ROUTER_NS link add link2 type veth peer name link3 netns $SERVER_NS\n\n\tip -net $CLIENT_NS link set link0 up\n\tip -net $CLIENT_NS link set link0 mtu 1442\n\tip -net $CLIENT_NS addr add $CLIENT_IP4/24 dev link0\n\tip -net $CLIENT_NS addr add $CLIENT_IP6/64 dev link0 nodad\n\tip -net $CLIENT_NS route add $SERVER_IP4 dev link0 via $CLIENT_GW4\n\tip -net $CLIENT_NS route add $SERVER_IP6 dev link0 via $CLIENT_GW6\n\tip -net $CLIENT_NS link set dev link0 \\\n\t\tgro_ipv4_max_size $MAX_SIZE gso_ipv4_max_size $MAX_SIZE\n\tip -net $CLIENT_NS link set dev link0 \\\n\t\tgro_max_size $MAX_SIZE gso_max_size $MAX_SIZE\n\tip net exec $CLIENT_NS sysctl -wq net.ipv4.tcp_window_scaling=10\n\n\tip -net $ROUTER_NS link set link1 up\n\tip -net $ROUTER_NS link set link2 up\n\tip -net $ROUTER_NS addr add $CLIENT_GW4/24 dev link1\n\tip -net $ROUTER_NS addr add $CLIENT_GW6/64 dev link1 nodad\n\tip -net $ROUTER_NS addr add $SERVER_GW4/24 dev link2\n\tip -net $ROUTER_NS addr add $SERVER_GW6/64 dev link2 nodad\n\tip -net $ROUTER_NS link set dev link1 \\\n\t\tgro_ipv4_max_size $MAX_SIZE gso_ipv4_max_size $MAX_SIZE\n\tip -net $ROUTER_NS link set dev link2 \\\n\t\tgro_ipv4_max_size $MAX_SIZE gso_ipv4_max_size $MAX_SIZE\n\tip -net $ROUTER_NS link set dev link1 \\\n\t\tgro_max_size $MAX_SIZE gso_max_size $MAX_SIZE\n\tip -net $ROUTER_NS link set dev link2 \\\n\t\tgro_max_size $MAX_SIZE gso_max_size $MAX_SIZE\n\t# test for nf_ct_skb_network_trim in nf_conntrack_ovs used by TC ct action.\n\tip net exec $ROUTER_NS tc qdisc add dev link1 ingress\n\tip net exec $ROUTER_NS tc filter add dev link1 ingress \\\n\t\tproto ip flower ip_proto tcp action ct\n\tip net exec $ROUTER_NS tc filter add dev link1 ingress \\\n\t\tproto ipv6 flower ip_proto tcp action ct\n\tip net exec $ROUTER_NS sysctl -wq net.ipv4.ip_forward=1\n\tip net exec $ROUTER_NS sysctl -wq net.ipv6.conf.all.forwarding=1\n\n\tip -net $SERVER_NS link set link3 up\n\tip -net $SERVER_NS addr add $SERVER_IP4/24 dev link3\n\tip -net $SERVER_NS addr add $SERVER_IP6/64 dev link3 nodad\n\tip -net $SERVER_NS route add $CLIENT_IP4 dev link3 via $SERVER_GW4\n\tip -net $SERVER_NS route add $CLIENT_IP6 dev link3 via $SERVER_GW6\n\tip -net $SERVER_NS link set dev link3 \\\n\t\tgro_ipv4_max_size $MAX_SIZE gso_ipv4_max_size $MAX_SIZE\n\tip -net $SERVER_NS link set dev link3 \\\n\t\tgro_max_size $MAX_SIZE gso_max_size $MAX_SIZE\n\tip net exec $SERVER_NS sysctl -wq net.ipv4.tcp_window_scaling=10\n\tip net exec $SERVER_NS netserver 2>&1 >/dev/null\n}\n\ncleanup() {\n\tip net exec $SERVER_NS pkill netserver\n\tip -net $ROUTER_NS link del link1\n\tip -net $ROUTER_NS link del link2\n\tip netns del \"$CLIENT_NS\"\n\tip netns del \"$SERVER_NS\"\n\tip netns del \"$ROUTER_NS\"\n}\n\nstart_counter() {\n\tlocal ipt=\"iptables\"\n\tlocal iface=$1\n\tlocal netns=$2\n\n\t[ \"$NF\" = \"6\" ] && ipt=\"ip6tables\"\n\tip net exec $netns $ipt -t raw -A PREROUTING -i $iface \\\n\t\t-m length ! --length 0:$CHK_SIZE -j ACCEPT\n}\n\ncheck_counter() {\n\tlocal ipt=\"iptables\"\n\tlocal iface=$1\n\tlocal netns=$2\n\n\t[ \"$NF\" = \"6\" ] && ipt=\"ip6tables\"\n\ttest `ip net exec $netns $ipt -t raw -L -v |grep $iface | awk '{print $1}'` != \"0\"\n}\n\nstop_counter() {\n\tlocal ipt=\"iptables\"\n\tlocal iface=$1\n\tlocal netns=$2\n\n\t[ \"$NF\" = \"6\" ] && ipt=\"ip6tables\"\n\tip net exec $netns $ipt -t raw -D PREROUTING -i $iface \\\n\t\t-m length ! --length 0:$CHK_SIZE -j ACCEPT\n}\n\ndo_netperf() {\n\tlocal serip=$SERVER_IP4\n\tlocal netns=$1\n\n\t[ \"$NF\" = \"6\" ] && serip=$SERVER_IP6\n\tip net exec $netns netperf -$NF -t TCP_STREAM -H $serip 2>&1 >/dev/null\n}\n\ndo_test() {\n\tlocal cli_tso=$1\n\tlocal gw_gro=$2\n\tlocal gw_tso=$3\n\tlocal ser_gro=$4\n\tlocal ret=\"PASS\"\n\n\tip net exec $CLIENT_NS ethtool -K link0 tso $cli_tso\n\tip net exec $ROUTER_NS ethtool -K link1 gro $gw_gro\n\tip net exec $ROUTER_NS ethtool -K link2 tso $gw_tso\n\tip net exec $SERVER_NS ethtool -K link3 gro $ser_gro\n\n\tstart_counter link1 $ROUTER_NS\n\tstart_counter link3 $SERVER_NS\n\tdo_netperf $CLIENT_NS\n\n\tif check_counter link1 $ROUTER_NS; then\n\t\tcheck_counter link3 $SERVER_NS || ret=\"FAIL_on_link3\"\n\telse\n\t\tret=\"FAIL_on_link1\"\n\tfi\n\n\tstop_counter link1 $ROUTER_NS\n\tstop_counter link3 $SERVER_NS\n\tprintf \"%-9s %-8s %-8s %-8s: [%s]\\n\" \\\n\t\t$cli_tso $gw_gro $gw_tso $ser_gro $ret\n\ttest $ret = \"PASS\"\n}\n\ntestup() {\n\techo \"CLI GSO | GW GRO | GW GSO | SER GRO\" && \\\n\tdo_test \"on\"  \"on\"  \"on\"  \"on\"  && \\\n\tdo_test \"on\"  \"off\" \"on\"  \"off\" && \\\n\tdo_test \"off\" \"on\"  \"on\"  \"on\"  && \\\n\tdo_test \"on\"  \"on\"  \"off\" \"on\"  && \\\n\tdo_test \"off\" \"on\"  \"off\" \"on\"\n}\n\nif ! netperf -V &> /dev/null; then\n\techo \"SKIP: Could not run test without netperf tool\"\n\texit $ksft_skip\nfi\n\nif ! ip link help 2>&1 | grep gso_ipv4_max_size &> /dev/null; then\n\techo \"SKIP: Could not run test without gso/gro_ipv4_max_size supported in ip-link\"\n\texit $ksft_skip\nfi\n\ntrap cleanup EXIT\nsetup && echo \"Testing for BIG TCP:\" && \\\nNF=4 testup && echo \"***v4 Tests Done***\" && \\\nNF=6 testup && echo \"***v6 Tests Done***\"\nexit $?\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}