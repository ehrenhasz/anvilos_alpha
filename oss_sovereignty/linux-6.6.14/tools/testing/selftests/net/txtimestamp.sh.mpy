{
  "module_name": "txtimestamp.sh",
  "hash_id": "e659f2655223e2571500ca303af55490611b8f41b06b616b86911b6811df8fa4",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/net/txtimestamp.sh",
  "human_readable_source": "#!/bin/bash\n# SPDX-License-Identifier: GPL-2.0\n#\n# Send packets with transmit timestamps over loopback with netem\n# Verify that timestamps correspond to netem delay\n\nset -e\n\nsetup() {\n\t# set 1ms delay on lo egress\n\ttc qdisc add dev lo root netem delay 1ms\n\n\t# set 2ms delay on ifb0 egress\n\tmodprobe ifb\n\tip link add ifb_netem0 type ifb\n\tip link set dev ifb_netem0 up\n\ttc qdisc add dev ifb_netem0 root netem delay 2ms\n\n\t# redirect lo ingress through ifb0 egress\n\ttc qdisc add dev lo handle ffff: ingress\n\ttc filter add dev lo parent ffff: \\\n\t\tu32 match mark 0 0xffff \\\n\t\taction mirred egress redirect dev ifb_netem0\n}\n\nrun_test_v4v6() {\n\t# SND will be delayed 1000us\n\t# ACK will be delayed 6000us: 1 + 2 ms round-trip\n\tlocal -r args=\"$@ -v 1000 -V 6000\"\n\n\t./txtimestamp ${args} -4 -L 127.0.0.1\n\t./txtimestamp ${args} -6 -L ::1\n}\n\nrun_test_tcpudpraw() {\n\tlocal -r args=$@\n\n\trun_test_v4v6 ${args}\t\t# tcp\n\trun_test_v4v6 ${args} -u\t# udp\n\trun_test_v4v6 ${args} -r\t# raw\n\trun_test_v4v6 ${args} -R\t# raw (IPPROTO_RAW)\n\trun_test_v4v6 ${args} -P\t# pf_packet\n}\n\nrun_test_all() {\n\tsetup\n\trun_test_tcpudpraw\t\t# setsockopt\n\trun_test_tcpudpraw -C\t\t# cmsg\n\trun_test_tcpudpraw -n\t\t# timestamp w/o data\n\techo \"OK. All tests passed\"\n}\n\nrun_test_one() {\n\tsetup\n\t./txtimestamp $@\n}\n\nusage() {\n\techo \"Usage: $0 [ -r | --run ] <txtimestamp args> | [ -h | --help ]\"\n\techo \"  (no args)  Run all tests\"\n\techo \"  -r|--run  Run an individual test with arguments\"\n\techo \"  -h|--help Help\"\n}\n\nmain() {\n\tif [[ $# -eq 0 ]]; then\n\t\trun_test_all\n\telse\n\t\tif [[ \"$1\" = \"-r\" || \"$1\" == \"--run\" ]]; then\n\t\t\tshift\n\t\t\trun_test_one $@\n\t\telse\n\t\t\tusage\n\t\tfi\n\tfi\n}\n\nif [[ -z \"$(ip netns identify)\" ]]; then\n\t./in_netns.sh $0 $@\nelse\n\tmain $@\nfi\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}