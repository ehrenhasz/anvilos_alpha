{
  "module_name": "bind_timewait.c",
  "hash_id": "f212bb9d05cf4ad5225e70a09fd988e17bc2a2e941ab76a076a2888f2e13d852",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/net/bind_timewait.c",
  "human_readable_source": "\n \n\n#include <sys/socket.h>\n#include <netinet/in.h>\n\n#include \"../kselftest_harness.h\"\n\nFIXTURE(bind_timewait)\n{\n\tstruct sockaddr_in addr;\n\tsocklen_t addrlen;\n};\n\nFIXTURE_VARIANT(bind_timewait)\n{\n\t__u32 addr_const;\n};\n\nFIXTURE_VARIANT_ADD(bind_timewait, localhost)\n{\n\t.addr_const = INADDR_LOOPBACK\n};\n\nFIXTURE_VARIANT_ADD(bind_timewait, addrany)\n{\n\t.addr_const = INADDR_ANY\n};\n\nFIXTURE_SETUP(bind_timewait)\n{\n\tself->addr.sin_family = AF_INET;\n\tself->addr.sin_port = 0;\n\tself->addr.sin_addr.s_addr = htonl(variant->addr_const);\n\tself->addrlen = sizeof(self->addr);\n}\n\nFIXTURE_TEARDOWN(bind_timewait)\n{\n}\n\nvoid create_timewait_socket(struct __test_metadata *_metadata,\n\t\t\t    FIXTURE_DATA(bind_timewait) *self)\n{\n\tint server_fd, client_fd, child_fd, ret;\n\tstruct sockaddr_in addr;\n\tsocklen_t addrlen;\n\n\tserver_fd = socket(AF_INET, SOCK_STREAM, 0);\n\tASSERT_GT(server_fd, 0);\n\n\tret = bind(server_fd, (struct sockaddr *)&self->addr, self->addrlen);\n\tASSERT_EQ(ret, 0);\n\n\tret = listen(server_fd, 1);\n\tASSERT_EQ(ret, 0);\n\n\tret = getsockname(server_fd, (struct sockaddr *)&self->addr, &self->addrlen);\n\tASSERT_EQ(ret, 0);\n\n\tclient_fd = socket(AF_INET, SOCK_STREAM, 0);\n\tASSERT_GT(client_fd, 0);\n\n\tret = connect(client_fd, (struct sockaddr *)&self->addr, self->addrlen);\n\tASSERT_EQ(ret, 0);\n\n\taddrlen = sizeof(addr);\n\tchild_fd = accept(server_fd, (struct sockaddr *)&addr, &addrlen);\n\tASSERT_GT(child_fd, 0);\n\n\tclose(child_fd);\n\tclose(client_fd);\n\tclose(server_fd);\n}\n\nTEST_F(bind_timewait, 1)\n{\n\tint fd, ret;\n\n\tcreate_timewait_socket(_metadata, self);\n\n\tfd = socket(AF_INET, SOCK_STREAM, 0);\n\tASSERT_GT(fd, 0);\n\n\tret = bind(fd, (struct sockaddr *)&self->addr, self->addrlen);\n\tASSERT_EQ(ret, -1);\n\tASSERT_EQ(errno, EADDRINUSE);\n\n\tclose(fd);\n}\n\nTEST_HARNESS_MAIN\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}