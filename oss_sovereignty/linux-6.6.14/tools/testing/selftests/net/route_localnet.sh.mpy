{
  "module_name": "route_localnet.sh",
  "hash_id": "74f6a1f2deea32d3978e40684d62a675a879da82aed231593d7417f9e5eb9bfc",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/net/route_localnet.sh",
  "human_readable_source": "#!/bin/bash\n# SPDX-License-Identifier: GPL-2.0\n#\n# Run a couple of tests when route_localnet = 1.\n\nreadonly PEER_NS=\"ns-peer-$(mktemp -u XXXXXX)\"\n\nsetup() {\n    ip netns add \"${PEER_NS}\"\n    ip -netns \"${PEER_NS}\" link set dev lo up\n    ip link add name veth0 type veth peer name veth1\n    ip link set dev veth0 up\n    ip link set dev veth1 netns \"${PEER_NS}\"\n\n    # Enable route_localnet and delete useless route 127.0.0.0/8.\n    sysctl -w net.ipv4.conf.veth0.route_localnet=1\n    ip netns exec \"${PEER_NS}\" sysctl -w net.ipv4.conf.veth1.route_localnet=1\n    ip route del 127.0.0.0/8 dev lo table local\n    ip netns exec \"${PEER_NS}\" ip route del 127.0.0.0/8 dev lo table local\n\n    ifconfig veth0 127.25.3.4/24 up\n    ip netns exec \"${PEER_NS}\" ifconfig veth1 127.25.3.14/24 up\n\n    ip route flush cache\n    ip netns exec \"${PEER_NS}\" ip route flush cache\n}\n\ncleanup() {\n    ip link del veth0\n    ip route add local 127.0.0.0/8 dev lo proto kernel scope host src 127.0.0.1\n    local -r ns=\"$(ip netns list|grep $PEER_NS)\"\n    [ -n \"$ns\" ] && ip netns del $ns 2>/dev/null\n}\n\n# Run test when arp_announce = 2.\nrun_arp_announce_test() {\n    echo \"run arp_announce test\"\n    setup\n\n    sysctl -w net.ipv4.conf.veth0.arp_announce=2\n    ip netns exec \"${PEER_NS}\" sysctl -w net.ipv4.conf.veth1.arp_announce=2\n    ping -c5 -I veth0 127.25.3.14\n    if [ $? -ne 0 ];then\n        echo \"failed\"\n    else\n        echo \"ok\"\n    fi\n\n    cleanup\n}\n\n# Run test when arp_ignore = 3.\nrun_arp_ignore_test() {\n    echo \"run arp_ignore test\"\n    setup\n\n    sysctl -w net.ipv4.conf.veth0.arp_ignore=3\n    ip netns exec \"${PEER_NS}\" sysctl -w net.ipv4.conf.veth1.arp_ignore=3\n    ping -c5 -I veth0 127.25.3.14\n    if [ $? -ne 0 ];then\n        echo \"failed\"\n    else\n        echo \"ok\"\n    fi\n\n    cleanup\n}\n\nrun_all_tests() {\n    run_arp_announce_test\n    run_arp_ignore_test\n}\n\nrun_all_tests\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}