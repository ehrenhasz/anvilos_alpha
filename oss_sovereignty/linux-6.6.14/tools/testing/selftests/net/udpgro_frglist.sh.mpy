{
  "module_name": "udpgro_frglist.sh",
  "hash_id": "76e985be9aeccf1b3b256ad7bd95e5501b3cc1d2b80df2dcc2c624b26b528a17",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/net/udpgro_frglist.sh",
  "human_readable_source": "#!/bin/bash\n# SPDX-License-Identifier: GPL-2.0\n#\n# Run a series of udpgro benchmarks\n\nreadonly PEER_NS=\"ns-peer-$(mktemp -u XXXXXX)\"\n\nBPF_FILE=\"../bpf/xdp_dummy.bpf.o\"\n\ncleanup() {\n\tlocal -r jobs=\"$(jobs -p)\"\n\tlocal -r ns=\"$(ip netns list|grep $PEER_NS)\"\n\n\t[ -n \"${jobs}\" ] && kill -INT ${jobs} 2>/dev/null\n\t[ -n \"$ns\" ] && ip netns del $ns 2>/dev/null\n}\ntrap cleanup EXIT\n\nrun_one() {\n\t# use 'rx' as separator between sender args and receiver args\n\tlocal -r all=\"$@\"\n\tlocal -r tx_args=${all%rx*}\n\tlocal rx_args=${all#*rx}\n\n\n\n\tip netns add \"${PEER_NS}\"\n\tip -netns \"${PEER_NS}\" link set lo up\n\tip link add type veth\n\tip link set dev veth0 up\n\tip addr add dev veth0 192.168.1.2/24\n\tip addr add dev veth0 2001:db8::2/64 nodad\n\n\tip link set dev veth1 netns \"${PEER_NS}\"\n\tip -netns \"${PEER_NS}\" addr add dev veth1 192.168.1.1/24\n\tip -netns \"${PEER_NS}\" addr add dev veth1 2001:db8::1/64 nodad\n\tip -netns \"${PEER_NS}\" link set dev veth1 up\n\tip netns exec \"${PEER_NS}\" ethtool -K veth1 rx-gro-list on\n\n\n\tip -n \"${PEER_NS}\" link set veth1 xdp object ${BPF_FILE} section xdp\n\ttc -n \"${PEER_NS}\" qdisc add dev veth1 clsact\n\ttc -n \"${PEER_NS}\" filter add dev veth1 ingress prio 4 protocol ipv6 bpf object-file nat6to4.o section schedcls/ingress6/nat_6  direct-action\n\ttc -n \"${PEER_NS}\" filter add dev veth1 egress prio 4 protocol ip bpf object-file nat6to4.o section schedcls/egress4/snat4 direct-action\n        echo ${rx_args}\n\tip netns exec \"${PEER_NS}\" ./udpgso_bench_rx ${rx_args} -r &\n\n\t# Hack: let bg programs complete the startup\n\tsleep 0.2\n\t./udpgso_bench_tx ${tx_args}\n}\n\nrun_in_netns() {\n\tlocal -r args=$@\n  echo ${args}\n\t./in_netns.sh $0 __subprocess ${args}\n}\n\nrun_udp() {\n\tlocal -r args=$@\n\n\techo \"udp gso - over veth touching data\"\n\trun_in_netns ${args} -u -S 0 rx -4 -v\n\n\techo \"udp gso and gro - over veth touching data\"\n\trun_in_netns ${args} -S 0 rx -4 -G\n}\n\nrun_tcp() {\n\tlocal -r args=$@\n\n\techo \"tcp - over veth touching data\"\n\trun_in_netns ${args} -t rx -4 -t\n}\n\nrun_all() {\n\tlocal -r core_args=\"-l 4\"\n\tlocal -r ipv4_args=\"${core_args} -4  -D 192.168.1.1\"\n\tlocal -r ipv6_args=\"${core_args} -6  -D 2001:db8::1\"\n\n\techo \"ipv6\"\n\trun_tcp \"${ipv6_args}\"\n\trun_udp \"${ipv6_args}\"\n}\n\nif [ ! -f ${BPF_FILE} ]; then\n\techo \"Missing ${BPF_FILE}. Build bpf selftest first\"\n\texit -1\nfi\n\nif [ ! -f nat6to4.o ]; then\n\techo \"Missing nat6to4 helper. Build bpf nat6to4.o selftest first\"\n\texit -1\nfi\n\nif [[ $# -eq 0 ]]; then\n\trun_all\nelif [[ $1 == \"__subprocess\" ]]; then\n\tshift\n\trun_one $@\nelse\n\trun_in_netns $@\nfi\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}