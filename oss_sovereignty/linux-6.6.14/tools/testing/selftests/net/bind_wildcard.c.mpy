{
  "module_name": "bind_wildcard.c",
  "hash_id": "42c8ec2db182b88e2e70b8c6793ee157b4cdf309816943ee8f897dbb5d6fa622",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/net/bind_wildcard.c",
  "human_readable_source": "\n \n\n#include <sys/socket.h>\n#include <netinet/in.h>\n\n#include \"../kselftest_harness.h\"\n\nstruct in6_addr in6addr_v4mapped_any = {\n\t.s6_addr = {\n\t\t0, 0, 0, 0,\n\t\t0, 0, 0, 0,\n\t\t0, 0, 255, 255,\n\t\t0, 0, 0, 0\n\t}\n};\n\nstruct in6_addr in6addr_v4mapped_loopback = {\n\t.s6_addr = {\n\t\t0, 0, 0, 0,\n\t\t0, 0, 0, 0,\n\t\t0, 0, 255, 255,\n\t\t127, 0, 0, 1\n\t}\n};\n\nFIXTURE(bind_wildcard)\n{\n\tstruct sockaddr_in addr4;\n\tstruct sockaddr_in6 addr6;\n};\n\nFIXTURE_VARIANT(bind_wildcard)\n{\n\tconst __u32 addr4_const;\n\tconst struct in6_addr *addr6_const;\n\tint expected_errno;\n};\n\nFIXTURE_VARIANT_ADD(bind_wildcard, v4_any_v6_any)\n{\n\t.addr4_const = INADDR_ANY,\n\t.addr6_const = &in6addr_any,\n\t.expected_errno = EADDRINUSE,\n};\n\nFIXTURE_VARIANT_ADD(bind_wildcard, v4_any_v6_local)\n{\n\t.addr4_const = INADDR_ANY,\n\t.addr6_const = &in6addr_loopback,\n\t.expected_errno = 0,\n};\n\nFIXTURE_VARIANT_ADD(bind_wildcard, v4_any_v6_v4mapped_any)\n{\n\t.addr4_const = INADDR_ANY,\n\t.addr6_const = &in6addr_v4mapped_any,\n\t.expected_errno = EADDRINUSE,\n};\n\nFIXTURE_VARIANT_ADD(bind_wildcard, v4_any_v6_v4mapped_local)\n{\n\t.addr4_const = INADDR_ANY,\n\t.addr6_const = &in6addr_v4mapped_loopback,\n\t.expected_errno = EADDRINUSE,\n};\n\nFIXTURE_VARIANT_ADD(bind_wildcard, v4_local_v6_any)\n{\n\t.addr4_const = INADDR_LOOPBACK,\n\t.addr6_const = &in6addr_any,\n\t.expected_errno = EADDRINUSE,\n};\n\nFIXTURE_VARIANT_ADD(bind_wildcard, v4_local_v6_local)\n{\n\t.addr4_const = INADDR_LOOPBACK,\n\t.addr6_const = &in6addr_loopback,\n\t.expected_errno = 0,\n};\n\nFIXTURE_VARIANT_ADD(bind_wildcard, v4_local_v6_v4mapped_any)\n{\n\t.addr4_const = INADDR_LOOPBACK,\n\t.addr6_const = &in6addr_v4mapped_any,\n\t.expected_errno = EADDRINUSE,\n};\n\nFIXTURE_VARIANT_ADD(bind_wildcard, v4_local_v6_v4mapped_local)\n{\n\t.addr4_const = INADDR_LOOPBACK,\n\t.addr6_const = &in6addr_v4mapped_loopback,\n\t.expected_errno = EADDRINUSE,\n};\n\nFIXTURE_SETUP(bind_wildcard)\n{\n\tself->addr4.sin_family = AF_INET;\n\tself->addr4.sin_port = htons(0);\n\tself->addr4.sin_addr.s_addr = htonl(variant->addr4_const);\n\n\tself->addr6.sin6_family = AF_INET6;\n\tself->addr6.sin6_port = htons(0);\n\tself->addr6.sin6_addr = *variant->addr6_const;\n}\n\nFIXTURE_TEARDOWN(bind_wildcard)\n{\n}\n\nvoid bind_sockets(struct __test_metadata *_metadata,\n\t\t  FIXTURE_DATA(bind_wildcard) *self,\n\t\t  int expected_errno,\n\t\t  struct sockaddr *addr1, socklen_t addrlen1,\n\t\t  struct sockaddr *addr2, socklen_t addrlen2)\n{\n\tint fd[2];\n\tint ret;\n\n\tfd[0] = socket(addr1->sa_family, SOCK_STREAM, 0);\n\tASSERT_GT(fd[0], 0);\n\n\tret = bind(fd[0], addr1, addrlen1);\n\tASSERT_EQ(ret, 0);\n\n\tret = getsockname(fd[0], addr1, &addrlen1);\n\tASSERT_EQ(ret, 0);\n\n\t((struct sockaddr_in *)addr2)->sin_port = ((struct sockaddr_in *)addr1)->sin_port;\n\n\tfd[1] = socket(addr2->sa_family, SOCK_STREAM, 0);\n\tASSERT_GT(fd[1], 0);\n\n\tret = bind(fd[1], addr2, addrlen2);\n\tif (expected_errno) {\n\t\tASSERT_EQ(ret, -1);\n\t\tASSERT_EQ(errno, expected_errno);\n\t} else {\n\t\tASSERT_EQ(ret, 0);\n\t}\n\n\tclose(fd[1]);\n\tclose(fd[0]);\n}\n\nTEST_F(bind_wildcard, v4_v6)\n{\n\tbind_sockets(_metadata, self, variant->expected_errno,\n\t\t     (struct sockaddr *)&self->addr4, sizeof(self->addr4),\n\t\t     (struct sockaddr *)&self->addr6, sizeof(self->addr6));\n}\n\nTEST_F(bind_wildcard, v6_v4)\n{\n\tbind_sockets(_metadata, self, variant->expected_errno,\n\t\t     (struct sockaddr *)&self->addr6, sizeof(self->addr6),\n\t\t     (struct sockaddr *)&self->addr4, sizeof(self->addr4));\n}\n\nTEST_HARNESS_MAIN\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}