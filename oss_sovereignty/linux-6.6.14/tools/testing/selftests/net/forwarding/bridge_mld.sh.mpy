{
  "module_name": "bridge_mld.sh",
  "hash_id": "65ba6bce1da399e847a8c7ac661e70f87432724bf2af08e14eca1dce634b6025",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/net/forwarding/bridge_mld.sh",
  "human_readable_source": "#!/bin/bash\n# SPDX-License-Identifier: GPL-2.0\n\nALL_TESTS=\"mldv2include_test mldv2inc_allow_test mldv2inc_is_include_test mldv2inc_is_exclude_test \\\n\t   mldv2inc_to_exclude_test mldv2exc_allow_test mldv2exc_is_include_test \\\n\t   mldv2exc_is_exclude_test mldv2exc_to_exclude_test mldv2inc_block_test \\\n\t   mldv2exc_block_test mldv2exc_timeout_test mldv2star_ex_auto_add_test\"\nNUM_NETIFS=4\nCHECK_TC=\"yes\"\nTEST_GROUP=\"ff02::cc\"\nTEST_GROUP_MAC=\"33:33:00:00:00:cc\"\n\n# MLDv2 is_in report: grp ff02::cc is_include 2001:db8:1::1,2001:db8:1::2,2001:db8:1::3\nMZPKT_IS_INC=\"33:33:00:00:00:01:fe:54:00:04:5e:ba:86:dd:60:0a:2d:ae:00:54:00:01:fe:80:00:\\\n00:00:00:00:00:fc:54:00:ff:fe:04:5e:ba:ff:02:00:00:00:00:00:00:00:00:00:00:00:00:00:01:3a:\\\n00:05:02:00:00:00:00:8f:00:8e:d9:00:00:00:01:01:00:00:03:ff:02:00:00:00:00:00:00:00:00:00:\\\n00:00:00:00:cc:20:01:0d:b8:00:01:00:00:00:00:00:00:00:00:00:01:20:01:0d:b8:00:01:00:00:00:\\\n00:00:00:00:00:00:02:20:01:0d:b8:00:01:00:00:00:00:00:00:00:00:00:03\"\n# MLDv2 is_in report: grp ff02::cc is_include 2001:db8:1::10,2001:db8:1::11,2001:db8:1::12\nMZPKT_IS_INC2=\"33:33:00:00:00:01:fe:54:00:04:5e:ba:86:dd:60:0a:2d:ae:00:54:00:01:fe:80:00:\\\n00:00:00:00:00:fc:54:00:ff:fe:04:5e:ba:ff:02:00:00:00:00:00:00:00:00:00:00:00:00:00:01:3a:00:\\\n05:02:00:00:00:00:8f:00:8e:ac:00:00:00:01:01:00:00:03:ff:02:00:00:00:00:00:00:00:00:00:00:00:\\\n00:00:cc:20:01:0d:b8:00:01:00:00:00:00:00:00:00:00:00:10:20:01:0d:b8:00:01:00:00:00:00:00:00:\\\n00:00:00:11:20:01:0d:b8:00:01:00:00:00:00:00:00:00:00:00:12\"\n# MLDv2 is_in report: grp ff02::cc is_include 2001:db8:1::20,2001:db8:1::30\nMZPKT_IS_INC3=\"33:33:00:00:00:01:fe:54:00:04:5e:ba:86:dd:60:0a:2d:ae:00:44:00:01:fe:80:00:00:00:\\\n00:00:00:fc:54:00:ff:fe:04:5e:ba:ff:02:00:00:00:00:00:00:00:00:00:00:00:00:00:01:3a:00:05:02:00:\\\n00:00:00:8f:00:bc:5a:00:00:00:01:01:00:00:02:ff:02:00:00:00:00:00:00:00:00:00:00:00:00:00:cc:20:\\\n01:0d:b8:00:01:00:00:00:00:00:00:00:00:00:20:20:01:0d:b8:00:01:00:00:00:00:00:00:00:00:00:30\"\n# MLDv2 allow report: grp ff02::cc allow 2001:db8:1::10,2001:db8:1::11,2001:db8:1::12\nMZPKT_ALLOW=\"33:33:00:00:00:01:fe:54:00:04:5e:ba:86:dd:60:0a:2d:ae:00:54:00:01:fe:80:00:00:\\\n00:00:00:00:fc:54:00:ff:fe:04:5e:ba:ff:02:00:00:00:00:00:00:00:00:00:00:00:00:00:01:3a:00:05:\\\n02:00:00:00:00:8f:00:8a:ac:00:00:00:01:05:00:00:03:ff:02:00:00:00:00:00:00:00:00:00:00:00:00:\\\n00:cc:20:01:0d:b8:00:01:00:00:00:00:00:00:00:00:00:10:20:01:0d:b8:00:01:00:00:00:00:00:00:00:\\\n00:00:11:20:01:0d:b8:00:01:00:00:00:00:00:00:00:00:00:12\"\n# MLDv2 allow report: grp ff02::cc allow 2001:db8:1::20,2001:db8:1::30\nMZPKT_ALLOW2=\"33:33:00:00:00:01:fe:54:00:04:5e:ba:86:dd:60:0a:2d:ae:00:44:00:01:fe:80:00:00:00:\\\n00:00:00:fc:54:00:ff:fe:04:5e:ba:ff:02:00:00:00:00:00:00:00:00:00:00:00:00:00:01:3a:00:05:02:00:\\\n00:00:00:8f:00:b8:5a:00:00:00:01:05:00:00:02:ff:02:00:00:00:00:00:00:00:00:00:00:00:00:00:cc:20:\\\n01:0d:b8:00:01:00:00:00:00:00:00:00:00:00:20:20:01:0d:b8:00:01:00:00:00:00:00:00:00:00:00:30\"\n# MLDv2 is_ex report: grp ff02::cc is_exclude 2001:db8:1::1,2001:db8:1::2,2001:db8:1::20,2001:db8:1::21\nMZPKT_IS_EXC=\"33:33:00:00:00:01:fe:54:00:04:5e:ba:86:dd:60:0a:2d:ae:00:64:00:01:fe:80:00:00:00:\\\n00:00:00:fc:54:00:ff:fe:04:5e:ba:ff:02:00:00:00:00:00:00:00:00:00:00:00:00:00:01:3a:00:05:02:00:\\\n00:00:00:8f:00:5f:d0:00:00:00:01:02:00:00:04:ff:02:00:00:00:00:00:00:00:00:00:00:00:00:00:cc:20:\\\n01:0d:b8:00:01:00:00:00:00:00:00:00:00:00:01:20:01:0d:b8:00:01:00:00:00:00:00:00:00:00:00:02:20:\\\n01:0d:b8:00:01:00:00:00:00:00:00:00:00:00:20:20:01:0d:b8:00:01:00:00:00:00:00:00:00:00:00:21\"\n# MLDv2 is_ex report: grp ff02::cc is_exclude 2001:db8:1::20,2001:db8:1::30\nMZPKT_IS_EXC2=\"33:33:00:00:00:01:fe:54:00:04:5e:ba:86:dd:60:0a:2d:ae:00:44:00:01:fe:80:00:00:00:\\\n00:00:00:fc:54:00:ff:fe:04:5e:ba:ff:02:00:00:00:00:00:00:00:00:00:00:00:00:00:01:3a:00:05:02:00:\\\n00:00:00:8f:00:bb:5a:00:00:00:01:02:00:00:02:ff:02:00:00:00:00:00:00:00:00:00:00:00:00:00:cc:20:\\\n01:0d:b8:00:01:00:00:00:00:00:00:00:00:00:20:20:01:0d:b8:00:01:00:00:00:00:00:00:00:00:00:30\"\n# MLDv2 to_ex report: grp ff02::cc to_exclude 2001:db8:1::1,2001:db8:1::20,2001:db8:1::30\nMZPKT_TO_EXC=\"33:33:00:00:00:01:fe:54:00:04:5e:ba:86:dd:60:0a:2d:ae:00:54:00:01:fe:80:00:00:00:\\\n00:00:00:fc:54:00:ff:fe:04:5e:ba:ff:02:00:00:00:00:00:00:00:00:00:00:00:00:00:01:3a:00:05:02:00:\\\n00:00:00:8f:00:8b:8e:00:00:00:01:04:00:00:03:ff:02:00:00:00:00:00:00:00:00:00:00:00:00:00:cc:20:\\\n01:0d:b8:00:01:00:00:00:00:00:00:00:00:00:01:20:01:0d:b8:00:01:00:00:00:00:00:00:00:00:00:20:20:\\\n01:0d:b8:00:01:00:00:00:00:00:00:00:00:00:30\"\n# MLDv2 block report: grp ff02::cc block 2001:db8:1::1,2001:db8:1::20,2001:db8:1::30\nMZPKT_BLOCK=\"33:33:00:00:00:01:fe:54:00:04:5e:ba:86:dd:60:0a:2d:ae:00:54:00:01:fe:80:00:00:00:00:\\\n00:00:fc:54:00:ff:fe:04:5e:ba:ff:02:00:00:00:00:00:00:00:00:00:00:00:00:00:01:3a:00:05:02:00:00:\\\n00:00:8f:00:89:8e:00:00:00:01:06:00:00:03:ff:02:00:00:00:00:00:00:00:00:00:00:00:00:00:cc:20:01:\\\n0d:b8:00:01:00:00:00:00:00:00:00:00:00:01:20:01:0d:b8:00:01:00:00:00:00:00:00:00:00:00:20:20:01:\\\n0d:b8:00:01:00:00:00:00:00:00:00:00:00:30\"\n\nsource lib.sh\n\nh1_create()\n{\n\tsimple_if_init $h1 2001:db8:1::1/64\n}\n\nh1_destroy()\n{\n\tsimple_if_fini $h1 2001:db8:1::1/64\n}\n\nh2_create()\n{\n\tsimple_if_init $h2 2001:db8:1::2/64\n}\n\nh2_destroy()\n{\n\tsimple_if_fini $h2 2001:db8:1::2/64\n}\n\nswitch_create()\n{\n\tip link add dev br0 type bridge mcast_snooping 1 mcast_query_response_interval 100 \\\n\t\t\t\t\tmcast_mld_version 2 mcast_startup_query_interval 300 \\\n\t\t\t\t\tmcast_querier 1\n\n\tip link set dev $swp1 master br0\n\tip link set dev $swp2 master br0\n\n\tip link set dev br0 up\n\tip link set dev $swp1 up\n\tip link set dev $swp2 up\n\n\t# make sure a query has been generated\n\tsleep 5\n}\n\nswitch_destroy()\n{\n\tip link set dev $swp2 down\n\tip link set dev $swp1 down\n\n\tip link del dev br0\n}\n\nsetup_prepare()\n{\n\th1=${NETIFS[p1]}\n\tswp1=${NETIFS[p2]}\n\n\tswp2=${NETIFS[p3]}\n\th2=${NETIFS[p4]}\n\n\tvrf_prepare\n\n\th1_create\n\th2_create\n\n\tswitch_create\n}\n\ncleanup()\n{\n\tpre_cleanup\n\n\tswitch_destroy\n\n\th2_destroy\n\th1_destroy\n\n\tvrf_cleanup\n}\n\nmldv2include_prepare()\n{\n\tlocal host1_if=$1\n\tlocal X=(\"2001:db8:1::1\" \"2001:db8:1::2\" \"2001:db8:1::3\")\n\n\tip link set dev br0 type bridge mcast_mld_version 2\n\tcheck_err $? \"Could not change bridge MLD version to 2\"\n\n\t$MZ $host1_if $MZPKT_IS_INC -q\n\tsleep 1\n\tbridge -j -d -s mdb show dev br0 \\\n\t\t| jq -e \".[].mdb[] | \\\n\t\t\t select(.grp == \\\"$TEST_GROUP\\\" and .source_list != null)\" &>/dev/null\n\tcheck_err $? \"Missing *,G entry with source list\"\n\tbridge -j -d -s mdb show dev br0 \\\n\t\t| jq -e \".[].mdb[] | \\\n\t\t\t select(.grp == \\\"$TEST_GROUP\\\" and \\\n\t\t\t\t.source_list != null and .filter_mode == \\\"include\\\")\" &>/dev/null\n\tcheck_err $? \"Wrong *,G entry filter mode\"\n\tbrmcast_check_sg_entries \"is_include\" \"${X[@]}\"\n}\n\nmldv2exclude_prepare()\n{\n\tlocal host1_if=$1\n\tlocal mac=$2\n\tlocal group=$3\n\tlocal pkt=$4\n\tlocal X=(\"2001:db8:1::1\" \"2001:db8:1::2\")\n\tlocal Y=(\"2001:db8:1::20\" \"2001:db8:1::21\")\n\n\tmldv2include_prepare $h1\n\n\t$MZ $host1_if -c 1 $MZPKT_IS_EXC -q\n\tsleep 1\n\tbridge -j -d -s mdb show dev br0 \\\n\t\t| jq -e \".[].mdb[] | \\\n\t\t\t select(.grp == \\\"$TEST_GROUP\\\" and \\\n\t\t\t .source_list != null and .filter_mode == \\\"exclude\\\")\" &>/dev/null\n\tcheck_err $? \"Wrong *,G entry filter mode\"\n\n\tbrmcast_check_sg_entries \"is_exclude\" \"${X[@]}\" \"${Y[@]}\"\n\n\tbrmcast_check_sg_state 0 \"${X[@]}\"\n\tbrmcast_check_sg_state 1 \"${Y[@]}\"\n\n\tbridge -j -d -s mdb show dev br0 \\\n\t\t| jq -e \".[].mdb[] | \\\n\t\t\t select(.grp == \\\"$TEST_GROUP\\\" and \\\n\t\t\t\t.source_list != null and\n\t\t\t\t.source_list[].address == \\\"2001:db8:1::3\\\")\" &>/dev/null\n\tcheck_fail $? \"Wrong *,G entry source list, 2001:db8:1::3 entry still exists\"\n}\n\nmldv2cleanup()\n{\n\tlocal port=$1\n\n\tbridge mdb del dev br0 port $port grp $TEST_GROUP\n\tip link set dev br0 type bridge mcast_mld_version 1\n}\n\nmldv2include_test()\n{\n\tRET=0\n\tlocal X=(\"2001:db8:1::1\" \"2001:db8:1::2\" \"2001:db8:1::3\")\n\n\tmldv2include_prepare $h1\n\n\tbrmcast_check_sg_state 0 \"${X[@]}\"\n\n\tbrmcast_check_sg_fwding 1 \"${X[@]}\"\n\tbrmcast_check_sg_fwding 0 \"2001:db8:1::100\"\n\n\tlog_test \"MLDv2 report $TEST_GROUP is_include\"\n\n\tmldv2cleanup $swp1\n}\n\nmldv2inc_allow_test()\n{\n\tRET=0\n\tlocal X=(\"2001:db8:1::10\" \"2001:db8:1::11\" \"2001:db8:1::12\")\n\n\tmldv2include_prepare $h1\n\n\t$MZ $h1 -c 1 $MZPKT_ALLOW -q\n\tsleep 1\n\tbrmcast_check_sg_entries \"allow\" \"${X[@]}\"\n\n\tbrmcast_check_sg_state 0 \"${X[@]}\"\n\n\tbrmcast_check_sg_fwding 1 \"${X[@]}\"\n\tbrmcast_check_sg_fwding 0 \"2001:db8:1::100\"\n\n\tlog_test \"MLDv2 report $TEST_GROUP include -> allow\"\n\n\tmldv2cleanup $swp1\n}\n\nmldv2inc_is_include_test()\n{\n\tRET=0\n\tlocal X=(\"2001:db8:1::10\" \"2001:db8:1::11\" \"2001:db8:1::12\")\n\n\tmldv2include_prepare $h1\n\n\t$MZ $h1 -c 1 $MZPKT_IS_INC2 -q\n\tsleep 1\n\tbrmcast_check_sg_entries \"is_include\" \"${X[@]}\"\n\n\tbrmcast_check_sg_state 0 \"${X[@]}\"\n\n\tbrmcast_check_sg_fwding 1 \"${X[@]}\"\n\tbrmcast_check_sg_fwding 0 \"2001:db8:1::100\"\n\n\tlog_test \"MLDv2 report $TEST_GROUP include -> is_include\"\n\n\tmldv2cleanup $swp1\n}\n\nmldv2inc_is_exclude_test()\n{\n\tRET=0\n\n\tmldv2exclude_prepare $h1\n\n\tbrmcast_check_sg_fwding 1 \"${X[@]}\" 2001:db8:1::100\n\tbrmcast_check_sg_fwding 0 \"${Y[@]}\"\n\n\tlog_test \"MLDv2 report $TEST_GROUP include -> is_exclude\"\n\n\tmldv2cleanup $swp1\n}\n\nmldv2inc_to_exclude_test()\n{\n\tRET=0\n\tlocal X=(\"2001:db8:1::1\")\n\tlocal Y=(\"2001:db8:1::20\" \"2001:db8:1::30\")\n\n\tmldv2include_prepare $h1\n\n\tip link set dev br0 type bridge mcast_last_member_interval 500\n\tcheck_err $? \"Could not change mcast_last_member_interval to 5s\"\n\n\t$MZ $h1 -c 1 $MZPKT_TO_EXC -q\n\tsleep 1\n\tbridge -j -d -s mdb show dev br0 \\\n\t\t| jq -e \".[].mdb[] | \\\n\t\t\t select(.grp == \\\"$TEST_GROUP\\\" and \\\n\t\t\t\t.source_list != null and .filter_mode == \\\"exclude\\\")\" &>/dev/null\n\tcheck_err $? \"Wrong *,G entry filter mode\"\n\n\tbrmcast_check_sg_entries \"to_exclude\" \"${X[@]}\" \"${Y[@]}\"\n\n\tbrmcast_check_sg_state 0 \"${X[@]}\"\n\tbrmcast_check_sg_state 1 \"${Y[@]}\"\n\n\tbridge -j -d -s mdb show dev br0 \\\n\t\t| jq -e \".[].mdb[] | \\\n\t\t\t select(.grp == \\\"$TEST_GROUP\\\" and \\\n\t\t\t\t.source_list != null and\n\t\t\t\t.source_list[].address == \\\"2001:db8:1::2\\\")\" &>/dev/null\n\tcheck_fail $? \"Wrong *,G entry source list, 2001:db8:1::2 entry still exists\"\n\tbridge -j -d -s mdb show dev br0 \\\n\t\t| jq -e \".[].mdb[] | \\\n\t\t\t select(.grp == \\\"$TEST_GROUP\\\" and \\\n\t\t\t\t.source_list != null and\n\t\t\t\t.source_list[].address == \\\"2001:db8:1::21\\\")\" &>/dev/null\n\tcheck_fail $? \"Wrong *,G entry source list, 2001:db8:1::21 entry still exists\"\n\n\tbrmcast_check_sg_fwding 1 \"${X[@]}\" 2001:db8:1::100\n\tbrmcast_check_sg_fwding 0 \"${Y[@]}\"\n\n\tlog_test \"MLDv2 report $TEST_GROUP include -> to_exclude\"\n\n\tip link set dev br0 type bridge mcast_last_member_interval 100\n\n\tmldv2cleanup $swp1\n}\n\nmldv2exc_allow_test()\n{\n\tRET=0\n\tlocal X=(\"2001:db8:1::1\" \"2001:db8:1::2\" \"2001:db8:1::20\" \"2001:db8:1::30\")\n\tlocal Y=(\"2001:db8:1::21\")\n\n\tmldv2exclude_prepare $h1\n\n\t$MZ $h1 -c 1 $MZPKT_ALLOW2 -q\n\tsleep 1\n\tbrmcast_check_sg_entries \"allow\" \"${X[@]}\" \"${Y[@]}\"\n\n\tbrmcast_check_sg_state 0 \"${X[@]}\"\n\tbrmcast_check_sg_state 1 \"${Y[@]}\"\n\n\tbrmcast_check_sg_fwding 1 \"${X[@]}\" 2001:db8:1::100\n\tbrmcast_check_sg_fwding 0 \"${Y[@]}\"\n\n\tlog_test \"MLDv2 report $TEST_GROUP exclude -> allow\"\n\n\tmldv2cleanup $swp1\n}\n\nmldv2exc_is_include_test()\n{\n\tRET=0\n\tlocal X=(\"2001:db8:1::1\" \"2001:db8:1::2\" \"2001:db8:1::20\" \"2001:db8:1::30\")\n\tlocal Y=(\"2001:db8:1::21\")\n\n\tmldv2exclude_prepare $h1\n\n\t$MZ $h1 -c 1 $MZPKT_IS_INC3 -q\n\tsleep 1\n\tbrmcast_check_sg_entries \"is_include\" \"${X[@]}\" \"${Y[@]}\"\n\n\tbrmcast_check_sg_state 0 \"${X[@]}\"\n\tbrmcast_check_sg_state 1 \"${Y[@]}\"\n\n\tbrmcast_check_sg_fwding 1 \"${X[@]}\" 2001:db8:1::100\n\tbrmcast_check_sg_fwding 0 \"${Y[@]}\"\n\n\tlog_test \"MLDv2 report $TEST_GROUP exclude -> is_include\"\n\n\tmldv2cleanup $swp1\n}\n\nmldv2exc_is_exclude_test()\n{\n\tRET=0\n\tlocal X=(\"2001:db8:1::30\")\n\tlocal Y=(\"2001:db8:1::20\")\n\n\tmldv2exclude_prepare $h1\n\n\t$MZ $h1 -c 1 $MZPKT_IS_EXC2 -q\n\tsleep 1\n\tbrmcast_check_sg_entries \"is_exclude\" \"${X[@]}\" \"${Y[@]}\"\n\n\tbrmcast_check_sg_state 0 \"${X[@]}\"\n\tbrmcast_check_sg_state 1 \"${Y[@]}\"\n\n\tbrmcast_check_sg_fwding 1 \"${X[@]}\" 2001:db8:1::100\n\tbrmcast_check_sg_fwding 0 \"${Y[@]}\"\n\n\tlog_test \"MLDv2 report $TEST_GROUP exclude -> is_exclude\"\n\n\tmldv2cleanup $swp1\n}\n\nmldv2exc_to_exclude_test()\n{\n\tRET=0\n\tlocal X=(\"2001:db8:1::1\" \"2001:db8:1::30\")\n\tlocal Y=(\"2001:db8:1::20\")\n\n\tmldv2exclude_prepare $h1\n\n\tip link set dev br0 type bridge mcast_last_member_interval 500\n\tcheck_err $? \"Could not change mcast_last_member_interval to 5s\"\n\n\t$MZ $h1 -c 1 $MZPKT_TO_EXC -q\n\tsleep 1\n\tbrmcast_check_sg_entries \"to_exclude\" \"${X[@]}\" \"${Y[@]}\"\n\n\tbrmcast_check_sg_state 0 \"${X[@]}\"\n\tbrmcast_check_sg_state 1 \"${Y[@]}\"\n\n\tbrmcast_check_sg_fwding 1 \"${X[@]}\" 2001:db8:1::100\n\tbrmcast_check_sg_fwding 0 \"${Y[@]}\"\n\n\tlog_test \"MLDv2 report $TEST_GROUP exclude -> to_exclude\"\n\n\tip link set dev br0 type bridge mcast_last_member_interval 100\n\n\tmldv2cleanup $swp1\n}\n\nmldv2inc_block_test()\n{\n\tRET=0\n\tlocal X=(\"2001:db8:1::2\" \"2001:db8:1::3\")\n\n\tmldv2include_prepare $h1\n\n\t$MZ $h1 -c 1 $MZPKT_BLOCK -q\n\t# make sure the lowered timers have expired (by default 2 seconds)\n\tsleep 3\n\tbrmcast_check_sg_entries \"block\" \"${X[@]}\"\n\n\tbrmcast_check_sg_state 0 \"${X[@]}\"\n\n\tbridge -j -d -s mdb show dev br0 \\\n\t\t| jq -e \".[].mdb[] | \\\n\t\t\t select(.grp == \\\"$TEST_GROUP\\\" and \\\n\t\t\t\t.source_list != null and\n\t\t\t\t.source_list[].address == \\\"2001:db8:1::1\\\")\" &>/dev/null\n\tcheck_fail $? \"Wrong *,G entry source list, 2001:db8:1::1 entry still exists\"\n\n\tbrmcast_check_sg_fwding 1 \"${X[@]}\"\n\tbrmcast_check_sg_fwding 0 2001:db8:1::100\n\n\tlog_test \"MLDv2 report $TEST_GROUP include -> block\"\n\n\tmldv2cleanup $swp1\n}\n\nmldv2exc_block_test()\n{\n\tRET=0\n\tlocal X=(\"2001:db8:1::1\" \"2001:db8:1::2\" \"2001:db8:1::30\")\n\tlocal Y=(\"2001:db8:1::20\" \"2001:db8:1::21\")\n\n\tmldv2exclude_prepare $h1\n\n\tip link set dev br0 type bridge mcast_last_member_interval 500\n\tcheck_err $? \"Could not change mcast_last_member_interval to 5s\"\n\n\t$MZ $h1 -c 1 $MZPKT_BLOCK -q\n\tsleep 1\n\tbrmcast_check_sg_entries \"block\" \"${X[@]}\" \"${Y[@]}\"\n\n\tbrmcast_check_sg_state 0 \"${X[@]}\"\n\tbrmcast_check_sg_state 1 \"${Y[@]}\"\n\n\tbrmcast_check_sg_fwding 1 \"${X[@]}\" 2001:db8:1::100\n\tbrmcast_check_sg_fwding 0 \"${Y[@]}\"\n\n\tlog_test \"MLDv2 report $TEST_GROUP exclude -> block\"\n\n\tip link set dev br0 type bridge mcast_last_member_interval 100\n\n\tmldv2cleanup $swp1\n}\n\nmldv2exc_timeout_test()\n{\n\tRET=0\n\tlocal X=(\"2001:db8:1::20\" \"2001:db8:1::30\")\n\n\t# GMI should be 3 seconds\n\tip link set dev br0 type bridge mcast_query_interval 100 \\\n\t\t\t\t\tmcast_query_response_interval 100 \\\n\t\t\t\t\tmcast_membership_interval 300\n\n\tmldv2exclude_prepare $h1\n\tip link set dev br0 type bridge mcast_query_interval 500 \\\n\t\t\t\t\tmcast_query_response_interval 500 \\\n\t\t\t\t\tmcast_membership_interval 1500\n\n\t$MZ $h1 -c 1 $MZPKT_ALLOW2 -q\n\tsleep 3\n\tbridge -j -d -s mdb show dev br0 \\\n\t\t| jq -e \".[].mdb[] | \\\n\t\t\t select(.grp == \\\"$TEST_GROUP\\\" and \\\n\t\t\t\t.source_list != null and .filter_mode == \\\"include\\\")\" &>/dev/null\n\tcheck_err $? \"Wrong *,G entry filter mode\"\n\n\tbridge -j -d -s mdb show dev br0 \\\n\t\t| jq -e \".[].mdb[] | \\\n\t\t\t select(.grp == \\\"$TEST_GROUP\\\" and \\\n\t\t\t\t.source_list != null and\n\t\t\t\t.source_list[].address == \\\"2001:db8:1::1\\\")\" &>/dev/null\n\tcheck_fail $? \"Wrong *,G entry source list, 2001:db8:1::1 entry still exists\"\n\tbridge -j -d -s mdb show dev br0 \\\n\t\t| jq -e \".[].mdb[] | \\\n\t\t\t select(.grp == \\\"$TEST_GROUP\\\" and \\\n\t\t\t\t.source_list != null and\n\t\t\t\t.source_list[].address == \\\"2001:db8:1::2\\\")\" &>/dev/null\n\tcheck_fail $? \"Wrong *,G entry source list, 2001:db8:1::2 entry still exists\"\n\n\tbrmcast_check_sg_entries \"allow\" \"${X[@]}\"\n\n\tbrmcast_check_sg_state 0 \"${X[@]}\"\n\n\tbrmcast_check_sg_fwding 1 \"${X[@]}\"\n\tbrmcast_check_sg_fwding 0 2001:db8:1::100\n\n\tlog_test \"MLDv2 group $TEST_GROUP exclude timeout\"\n\n\tip link set dev br0 type bridge mcast_query_interval 12500 \\\n\t\t\t\t\tmcast_query_response_interval 1000 \\\n\t\t\t\t\tmcast_membership_interval 26000\n\n\tmldv2cleanup $swp1\n}\n\nmldv2star_ex_auto_add_test()\n{\n\tRET=0\n\n\tmldv2exclude_prepare $h1\n\n\t$MZ $h2 -c 1 $MZPKT_IS_INC -q\n\tsleep 1\n\tbridge -j -d -s mdb show dev br0 \\\n\t\t| jq -e \".[].mdb[] | \\\n\t\t\t select(.grp == \\\"$TEST_GROUP\\\" and .src == \\\"2001:db8:1::3\\\" and \\\n\t\t\t\t.port == \\\"$swp1\\\")\" &>/dev/null\n\tcheck_err $? \"S,G entry for *,G port doesn't exist\"\n\n\tbridge -j -d -s mdb show dev br0 \\\n\t\t| jq -e \".[].mdb[] | \\\n\t\t\t select(.grp == \\\"$TEST_GROUP\\\" and .src == \\\"2001:db8:1::3\\\" and \\\n\t\t\t\t.port == \\\"$swp1\\\" and \\\n\t\t\t\t.flags[] == \\\"added_by_star_ex\\\")\" &>/dev/null\n\tcheck_err $? \"Auto-added S,G entry doesn't have added_by_star_ex flag\"\n\n\tbrmcast_check_sg_fwding 1 2001:db8:1::3\n\n\tlog_test \"MLDv2 S,G port entry automatic add to a *,G port\"\n\n\tmldv2cleanup $swp1\n\tmldv2cleanup $swp2\n}\n\ntrap cleanup EXIT\n\nsetup_prepare\nsetup_wait\n\ntests_run\n\nexit $EXIT_STATUS\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}