{
  "module_name": "bridge_mdb_host.sh",
  "hash_id": "4990ec7cbe66171922d49a5078b24f5af94c47dba9590547da9dd552910c4b37",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/net/forwarding/bridge_mdb_host.sh",
  "human_readable_source": "#!/bin/bash\n# SPDX-License-Identifier: GPL-2.0\n#\n# Verify that adding host mdb entries work as intended for all types of\n# multicast filters: ipv4, ipv6, and mac\n\nALL_TESTS=\"mdb_add_del_test\"\nNUM_NETIFS=2\n\nTEST_GROUP_IP4=\"225.1.2.3\"\nTEST_GROUP_IP6=\"ff02::42\"\nTEST_GROUP_MAC=\"01:00:01:c0:ff:ee\"\n\nsource lib.sh\n\nh1_create()\n{\n\tsimple_if_init $h1 192.0.2.1/24 2001:db8:1::1/64\n}\n\nh1_destroy()\n{\n\tsimple_if_fini $h1 192.0.2.1/24 2001:db8:1::1/64\n}\n\nswitch_create()\n{\n\t# Enable multicast filtering\n\tip link add dev br0 type bridge mcast_snooping 1\n\n\tip link set dev $swp1 master br0\n\n\tip link set dev br0 up\n\tip link set dev $swp1 up\n}\n\nswitch_destroy()\n{\n\tip link set dev $swp1 down\n\tip link del dev br0\n}\n\nsetup_prepare()\n{\n\th1=${NETIFS[p1]}\n\tswp1=${NETIFS[p2]}\n\n\tvrf_prepare\n\n\th1_create\n\tswitch_create\n}\n\ncleanup()\n{\n\tpre_cleanup\n\n\tswitch_destroy\n\th1_destroy\n\n\tvrf_cleanup\n}\n\ndo_mdb_add_del()\n{\n\tlocal group=$1\n\tlocal flag=$2\n\n\tRET=0\n\tbridge mdb add dev br0 port br0 grp $group $flag 2>/dev/null\n\tcheck_err $? \"Failed adding $group to br0, port br0\"\n\n\tif [ -z \"$flag\" ]; then\n\t    flag=\"temp\"\n\tfi\n\n\tbridge mdb show dev br0 | grep $group | grep -q $flag 2>/dev/null\n\tcheck_err $? \"$group not added with $flag flag\"\n\n\tbridge mdb del dev br0 port br0 grp $group 2>/dev/null\n\tcheck_err $? \"Failed deleting $group from br0, port br0\"\n\n\tbridge mdb show dev br0 | grep -q $group >/dev/null\n\tcheck_err_fail 1 $? \"$group still in mdb after delete\"\n\n\tlog_test \"MDB add/del group $group to bridge port br0\"\n}\n\nmdb_add_del_test()\n{\n\tdo_mdb_add_del $TEST_GROUP_MAC permanent\n\tdo_mdb_add_del $TEST_GROUP_IP4\n\tdo_mdb_add_del $TEST_GROUP_IP6\n}\n\ntrap cleanup EXIT\n\nsetup_prepare\nsetup_wait\n\ntests_run\n\nexit $EXIT_STATUS\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}