{
  "module_name": "bridge_igmp.sh",
  "hash_id": "3978eebfa3fb4971bcabba3853116e50902663d4e66728a09cdb1d6e1bf4fbc8",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/net/forwarding/bridge_igmp.sh",
  "human_readable_source": "#!/bin/bash\n# SPDX-License-Identifier: GPL-2.0\n\nALL_TESTS=\"v2reportleave_test v3include_test v3inc_allow_test v3inc_is_include_test \\\n\t   v3inc_is_exclude_test v3inc_to_exclude_test v3exc_allow_test v3exc_is_include_test \\\n\t   v3exc_is_exclude_test v3exc_to_exclude_test v3inc_block_test v3exc_block_test \\\n\t   v3exc_timeout_test v3star_ex_auto_add_test\"\nNUM_NETIFS=4\nCHECK_TC=\"yes\"\nTEST_GROUP=\"239.10.10.10\"\nTEST_GROUP_MAC=\"01:00:5e:0a:0a:0a\"\n\nALL_GROUP=\"224.0.0.1\"\nALL_MAC=\"01:00:5e:00:00:01\"\n\n# IGMPv3 is_in report: grp 239.10.10.10 is_include 192.0.2.1,192.0.2.2,192.0.2.3\nMZPKT_IS_INC=\"22:00:9d:de:00:00:00:01:01:00:00:03:ef:0a:0a:0a:c0:00:02:01:c0:00:02:02:c0:00:02:03\"\n# IGMPv3 is_in report: grp 239.10.10.10 is_include 192.0.2.10,192.0.2.11,192.0.2.12\nMZPKT_IS_INC2=\"22:00:9d:c3:00:00:00:01:01:00:00:03:ef:0a:0a:0a:c0:00:02:0a:c0:00:02:0b:c0:00:02:0c\"\n# IGMPv3 is_in report: grp 239.10.10.10 is_include 192.0.2.20,192.0.2.30\nMZPKT_IS_INC3=\"22:00:5f:b4:00:00:00:01:01:00:00:02:ef:0a:0a:0a:c0:00:02:14:c0:00:02:1e\"\n# IGMPv3 allow report: grp 239.10.10.10 allow 192.0.2.10,192.0.2.11,192.0.2.12\nMZPKT_ALLOW=\"22:00:99:c3:00:00:00:01:05:00:00:03:ef:0a:0a:0a:c0:00:02:0a:c0:00:02:0b:c0:00:02:0c\"\n# IGMPv3 allow report: grp 239.10.10.10 allow 192.0.2.20,192.0.2.30\nMZPKT_ALLOW2=\"22:00:5b:b4:00:00:00:01:05:00:00:02:ef:0a:0a:0a:c0:00:02:14:c0:00:02:1e\"\n# IGMPv3 is_ex report: grp 239.10.10.10 is_exclude 192.0.2.1,192.0.2.2,192.0.2.20,192.0.2.21\nMZPKT_IS_EXC=\"22:00:da:b6:00:00:00:01:02:00:00:04:ef:0a:0a:0a:c0:00:02:01:c0:00:02:02:c0:00:02:14:c0:00:02:15\"\n# IGMPv3 is_ex report: grp 239.10.10.10 is_exclude 192.0.2.20,192.0.2.30\nMZPKT_IS_EXC2=\"22:00:5e:b4:00:00:00:01:02:00:00:02:ef:0a:0a:0a:c0:00:02:14:c0:00:02:1e\"\n# IGMPv3 to_ex report: grp 239.10.10.10 to_exclude 192.0.2.1,192.0.2.20,192.0.2.30\nMZPKT_TO_EXC=\"22:00:9a:b1:00:00:00:01:04:00:00:03:ef:0a:0a:0a:c0:00:02:01:c0:00:02:14:c0:00:02:1e\"\n# IGMPv3 block report: grp 239.10.10.10 block 192.0.2.1,192.0.2.20,192.0.2.30\nMZPKT_BLOCK=\"22:00:98:b1:00:00:00:01:06:00:00:03:ef:0a:0a:0a:c0:00:02:01:c0:00:02:14:c0:00:02:1e\"\n\nsource lib.sh\n\nh1_create()\n{\n\tsimple_if_init $h1 192.0.2.1/24 2001:db8:1::1/64\n}\n\nh1_destroy()\n{\n\tsimple_if_fini $h1 192.0.2.1/24 2001:db8:1::1/64\n}\n\nh2_create()\n{\n\tsimple_if_init $h2 192.0.2.2/24 2001:db8:1::2/64\n}\n\nh2_destroy()\n{\n\tsimple_if_fini $h2 192.0.2.2/24 2001:db8:1::2/64\n}\n\nswitch_create()\n{\n\tip link add dev br0 type bridge mcast_snooping 1 mcast_querier 1\n\n\tip link set dev $swp1 master br0\n\tip link set dev $swp2 master br0\n\n\tip link set dev br0 up\n\tip link set dev $swp1 up\n\tip link set dev $swp2 up\n}\n\nswitch_destroy()\n{\n\tip link set dev $swp2 down\n\tip link set dev $swp1 down\n\n\tip link del dev br0\n}\n\nsetup_prepare()\n{\n\th1=${NETIFS[p1]}\n\tswp1=${NETIFS[p2]}\n\n\tswp2=${NETIFS[p3]}\n\th2=${NETIFS[p4]}\n\n\tvrf_prepare\n\n\th1_create\n\th2_create\n\n\tswitch_create\n}\n\ncleanup()\n{\n\tpre_cleanup\n\n\tswitch_destroy\n\n\th2_destroy\n\th1_destroy\n\n\tvrf_cleanup\n}\n\nv2reportleave_test()\n{\n\tRET=0\n\tip address add dev $h2 $TEST_GROUP/32 autojoin\n\tcheck_err $? \"Could not join $TEST_GROUP\"\n\n\tsleep 5\n\tbridge mdb show dev br0 | grep $TEST_GROUP 1>/dev/null\n\tcheck_err $? \"IGMPv2 report didn't create mdb entry for $TEST_GROUP\"\n\n\tmcast_packet_test $TEST_GROUP_MAC 192.0.2.1 $TEST_GROUP $h1 $h2\n\tcheck_fail $? \"Traffic to $TEST_GROUP wasn't forwarded\"\n\n\tlog_test \"IGMPv2 report $TEST_GROUP\"\n\n\tRET=0\n\tbridge mdb show dev br0 | grep $TEST_GROUP 1>/dev/null\n\tcheck_err $? \"mdb entry for $TEST_GROUP is missing\"\n\n\tip address del dev $h2 $TEST_GROUP/32\n\tcheck_err $? \"Could not leave $TEST_GROUP\"\n\n\tsleep 5\n\tbridge mdb show dev br0 | grep $TEST_GROUP 1>/dev/null\n\tcheck_fail $? \"Leave didn't delete mdb entry for $TEST_GROUP\"\n\n\tmcast_packet_test $TEST_GROUP_MAC 192.0.2.1 $TEST_GROUP $h1 $h2\n\tcheck_err $? \"Traffic to $TEST_GROUP was forwarded without mdb entry\"\n\n\tlog_test \"IGMPv2 leave $TEST_GROUP\"\n}\n\nv3include_prepare()\n{\n\tlocal host1_if=$1\n\tlocal mac=$2\n\tlocal group=$3\n\tlocal X=(\"192.0.2.1\" \"192.0.2.2\" \"192.0.2.3\")\n\n\tip link set dev br0 type bridge mcast_igmp_version 3\n\tcheck_err $? \"Could not change bridge IGMP version to 3\"\n\n\t$MZ $host1_if -b $mac -c 1 -B $group -t ip \"proto=2,p=$MZPKT_IS_INC\" -q\n\tsleep 1\n\tbridge -j -d -s mdb show dev br0 \\\n\t\t| jq -e \".[].mdb[] | \\\n\t\t\t select(.grp == \\\"$TEST_GROUP\\\" and .source_list != null)\" &>/dev/null\n\tcheck_err $? \"Missing *,G entry with source list\"\n\tbridge -j -d -s mdb show dev br0 \\\n\t\t| jq -e \".[].mdb[] | \\\n\t\t\t select(.grp == \\\"$TEST_GROUP\\\" and \\\n\t\t\t\t.source_list != null and .filter_mode == \\\"include\\\")\" &>/dev/null\n\tcheck_err $? \"Wrong *,G entry filter mode\"\n\tbrmcast_check_sg_entries \"is_include\" \"${X[@]}\"\n}\n\nv3exclude_prepare()\n{\n\tlocal host1_if=$1\n\tlocal mac=$2\n\tlocal group=$3\n\tlocal pkt=$4\n\tlocal X=(\"192.0.2.1\" \"192.0.2.2\")\n\tlocal Y=(\"192.0.2.20\" \"192.0.2.21\")\n\n\tv3include_prepare $host1_if $mac $group\n\n\t$MZ $host1_if -c 1 -b $mac -B $group -t ip \"proto=2,p=$MZPKT_IS_EXC\" -q\n\tsleep 1\n\tbridge -j -d -s mdb show dev br0 \\\n\t\t| jq -e \".[].mdb[] | \\\n\t\t\t select(.grp == \\\"$TEST_GROUP\\\" and \\\n\t\t\t\t.source_list != null and .filter_mode == \\\"exclude\\\")\" &>/dev/null\n\tcheck_err $? \"Wrong *,G entry filter mode\"\n\n\tbrmcast_check_sg_entries \"is_exclude\" \"${X[@]}\" \"${Y[@]}\"\n\n\tbrmcast_check_sg_state 0 \"${X[@]}\"\n\tbrmcast_check_sg_state 1 \"${Y[@]}\"\n\n\tbridge -j -d -s mdb show dev br0 \\\n\t\t| jq -e \".[].mdb[] | \\\n\t\t\t select(.grp == \\\"$TEST_GROUP\\\" and \\\n\t\t\t\t.source_list != null and\n\t\t\t\t.source_list[].address == \\\"192.0.2.3\\\")\" &>/dev/null\n\tcheck_fail $? \"Wrong *,G entry source list, 192.0.2.3 entry still exists\"\n}\n\nv3cleanup()\n{\n\tlocal port=$1\n\tlocal group=$2\n\n\tbridge mdb del dev br0 port $port grp $group\n\tip link set dev br0 type bridge mcast_igmp_version 2\n}\n\nv3include_test()\n{\n\tRET=0\n\tlocal X=(\"192.0.2.1\" \"192.0.2.2\" \"192.0.2.3\")\n\n\tv3include_prepare $h1 $ALL_MAC $ALL_GROUP\n\n\tbrmcast_check_sg_state 0 \"${X[@]}\"\n\n\tbrmcast_check_sg_fwding 1 \"${X[@]}\"\n\tbrmcast_check_sg_fwding 0 \"192.0.2.100\"\n\n\tlog_test \"IGMPv3 report $TEST_GROUP is_include\"\n\n\tv3cleanup $swp1 $TEST_GROUP\n}\n\nv3inc_allow_test()\n{\n\tRET=0\n\tlocal X=(\"192.0.2.10\" \"192.0.2.11\" \"192.0.2.12\")\n\n\tv3include_prepare $h1 $ALL_MAC $ALL_GROUP\n\n\t$MZ $h1 -c 1 -b $ALL_MAC -B $ALL_GROUP -t ip \"proto=2,p=$MZPKT_ALLOW\" -q\n\tsleep 1\n\tbrmcast_check_sg_entries \"allow\" \"${X[@]}\"\n\n\tbrmcast_check_sg_state 0 \"${X[@]}\"\n\n\tbrmcast_check_sg_fwding 1 \"${X[@]}\"\n\tbrmcast_check_sg_fwding 0 \"192.0.2.100\"\n\n\tlog_test \"IGMPv3 report $TEST_GROUP include -> allow\"\n\n\tv3cleanup $swp1 $TEST_GROUP\n}\n\nv3inc_is_include_test()\n{\n\tRET=0\n\tlocal X=(\"192.0.2.10\" \"192.0.2.11\" \"192.0.2.12\")\n\n\tv3include_prepare $h1 $ALL_MAC $ALL_GROUP\n\n\t$MZ $h1 -c 1 -b $ALL_MAC -B $ALL_GROUP -t ip \"proto=2,p=$MZPKT_IS_INC2\" -q\n\tsleep 1\n\tbrmcast_check_sg_entries \"is_include\" \"${X[@]}\"\n\n\tbrmcast_check_sg_state 0 \"${X[@]}\"\n\n\tbrmcast_check_sg_fwding 1 \"${X[@]}\"\n\tbrmcast_check_sg_fwding 0 \"192.0.2.100\"\n\n\tlog_test \"IGMPv3 report $TEST_GROUP include -> is_include\"\n\n\tv3cleanup $swp1 $TEST_GROUP\n}\n\nv3inc_is_exclude_test()\n{\n\tRET=0\n\n\tv3exclude_prepare $h1 $ALL_MAC $ALL_GROUP\n\n\tbrmcast_check_sg_fwding 1 \"${X[@]}\" 192.0.2.100\n\tbrmcast_check_sg_fwding 0 \"${Y[@]}\"\n\n\tlog_test \"IGMPv3 report $TEST_GROUP include -> is_exclude\"\n\n\tv3cleanup $swp1 $TEST_GROUP\n}\n\nv3inc_to_exclude_test()\n{\n\tRET=0\n\tlocal X=(\"192.0.2.1\")\n\tlocal Y=(\"192.0.2.20\" \"192.0.2.30\")\n\n\tv3include_prepare $h1 $ALL_MAC $ALL_GROUP\n\n\tip link set dev br0 type bridge mcast_last_member_interval 500\n\tcheck_err $? \"Could not change mcast_last_member_interval to 5s\"\n\n\t$MZ $h1 -c 1 -b $ALL_MAC -B $ALL_GROUP -t ip \"proto=2,p=$MZPKT_TO_EXC\" -q\n\tsleep 1\n\tbridge -j -d -s mdb show dev br0 \\\n\t\t| jq -e \".[].mdb[] | \\\n\t\t\t select(.grp == \\\"$TEST_GROUP\\\" and \\\n\t\t\t\t.source_list != null and .filter_mode == \\\"exclude\\\")\" &>/dev/null\n\tcheck_err $? \"Wrong *,G entry filter mode\"\n\n\tbrmcast_check_sg_entries \"to_exclude\" \"${X[@]}\" \"${Y[@]}\"\n\n\tbrmcast_check_sg_state 0 \"${X[@]}\"\n\tbrmcast_check_sg_state 1 \"${Y[@]}\"\n\n\tbridge -j -d -s mdb show dev br0 \\\n\t\t| jq -e \".[].mdb[] | \\\n\t\t\t select(.grp == \\\"$TEST_GROUP\\\" and \\\n\t\t\t\t.source_list != null and\n\t\t\t\t.source_list[].address == \\\"192.0.2.2\\\")\" &>/dev/null\n\tcheck_fail $? \"Wrong *,G entry source list, 192.0.2.2 entry still exists\"\n\tbridge -j -d -s mdb show dev br0 \\\n\t\t| jq -e \".[].mdb[] | \\\n\t\t\t select(.grp == \\\"$TEST_GROUP\\\" and \\\n\t\t\t\t.source_list != null and\n\t\t\t\t.source_list[].address == \\\"192.0.2.21\\\")\" &>/dev/null\n\tcheck_fail $? \"Wrong *,G entry source list, 192.0.2.21 entry still exists\"\n\n\tbrmcast_check_sg_fwding 1 \"${X[@]}\" 192.0.2.100\n\tbrmcast_check_sg_fwding 0 \"${Y[@]}\"\n\n\tlog_test \"IGMPv3 report $TEST_GROUP include -> to_exclude\"\n\n\tip link set dev br0 type bridge mcast_last_member_interval 100\n\n\tv3cleanup $swp1 $TEST_GROUP\n}\n\nv3exc_allow_test()\n{\n\tRET=0\n\tlocal X=(\"192.0.2.1\" \"192.0.2.2\" \"192.0.2.20\" \"192.0.2.30\")\n\tlocal Y=(\"192.0.2.21\")\n\n\tv3exclude_prepare $h1 $ALL_MAC $ALL_GROUP\n\n\t$MZ $h1 -c 1 -b $ALL_MAC -B $ALL_GROUP -t ip \"proto=2,p=$MZPKT_ALLOW2\" -q\n\tsleep 1\n\tbrmcast_check_sg_entries \"allow\" \"${X[@]}\" \"${Y[@]}\"\n\n\tbrmcast_check_sg_state 0 \"${X[@]}\"\n\tbrmcast_check_sg_state 1 \"${Y[@]}\"\n\n\tbrmcast_check_sg_fwding 1 \"${X[@]}\" 192.0.2.100\n\tbrmcast_check_sg_fwding 0 \"${Y[@]}\"\n\n\tlog_test \"IGMPv3 report $TEST_GROUP exclude -> allow\"\n\n\tv3cleanup $swp1 $TEST_GROUP\n}\n\nv3exc_is_include_test()\n{\n\tRET=0\n\tlocal X=(\"192.0.2.1\" \"192.0.2.2\" \"192.0.2.20\" \"192.0.2.30\")\n\tlocal Y=(\"192.0.2.21\")\n\n\tv3exclude_prepare $h1 $ALL_MAC $ALL_GROUP\n\n\t$MZ $h1 -c 1 -b $ALL_MAC -B $ALL_GROUP -t ip \"proto=2,p=$MZPKT_IS_INC3\" -q\n\tsleep 1\n\tbrmcast_check_sg_entries \"is_include\" \"${X[@]}\" \"${Y[@]}\"\n\n\tbrmcast_check_sg_state 0 \"${X[@]}\"\n\tbrmcast_check_sg_state 1 \"${Y[@]}\"\n\n\tbrmcast_check_sg_fwding 1 \"${X[@]}\" 192.0.2.100\n\tbrmcast_check_sg_fwding 0 \"${Y[@]}\"\n\n\tlog_test \"IGMPv3 report $TEST_GROUP exclude -> is_include\"\n\n\tv3cleanup $swp1 $TEST_GROUP\n}\n\nv3exc_is_exclude_test()\n{\n\tRET=0\n\tlocal X=(\"192.0.2.30\")\n\tlocal Y=(\"192.0.2.20\")\n\n\tv3exclude_prepare $h1 $ALL_MAC $ALL_GROUP\n\n\t$MZ $h1 -c 1 -b $ALL_MAC -B $ALL_GROUP -t ip \"proto=2,p=$MZPKT_IS_EXC2\" -q\n\tsleep 1\n\tbrmcast_check_sg_entries \"is_exclude\" \"${X[@]}\" \"${Y[@]}\"\n\n\tbrmcast_check_sg_state 0 \"${X[@]}\"\n\tbrmcast_check_sg_state 1 \"${Y[@]}\"\n\n\tbrmcast_check_sg_fwding 1 \"${X[@]}\" 192.0.2.100\n\tbrmcast_check_sg_fwding 0 \"${Y[@]}\"\n\n\tlog_test \"IGMPv3 report $TEST_GROUP exclude -> is_exclude\"\n\n\tv3cleanup $swp1 $TEST_GROUP\n}\n\nv3exc_to_exclude_test()\n{\n\tRET=0\n\tlocal X=(\"192.0.2.1\" \"192.0.2.30\")\n\tlocal Y=(\"192.0.2.20\")\n\n\tv3exclude_prepare $h1 $ALL_MAC $ALL_GROUP\n\n\tip link set dev br0 type bridge mcast_last_member_interval 500\n\tcheck_err $? \"Could not change mcast_last_member_interval to 5s\"\n\n\t$MZ $h1 -c 1 -b $ALL_MAC -B $ALL_GROUP -t ip \"proto=2,p=$MZPKT_TO_EXC\" -q\n\tsleep 1\n\tbrmcast_check_sg_entries \"to_exclude\" \"${X[@]}\" \"${Y[@]}\"\n\n\tbrmcast_check_sg_state 0 \"${X[@]}\"\n\tbrmcast_check_sg_state 1 \"${Y[@]}\"\n\n\tbrmcast_check_sg_fwding 1 \"${X[@]}\" 192.0.2.100\n\tbrmcast_check_sg_fwding 0 \"${Y[@]}\"\n\n\tlog_test \"IGMPv3 report $TEST_GROUP exclude -> to_exclude\"\n\n\tip link set dev br0 type bridge mcast_last_member_interval 100\n\n\tv3cleanup $swp1 $TEST_GROUP\n}\n\nv3inc_block_test()\n{\n\tRET=0\n\tlocal X=(\"192.0.2.2\" \"192.0.2.3\")\n\n\tv3include_prepare $h1 $ALL_MAC $ALL_GROUP\n\n\t$MZ $h1 -c 1 -b $ALL_MAC -B $ALL_GROUP -t ip \"proto=2,p=$MZPKT_BLOCK\" -q\n\t# make sure the lowered timers have expired (by default 2 seconds)\n\tsleep 3\n\tbrmcast_check_sg_entries \"block\" \"${X[@]}\"\n\n\tbrmcast_check_sg_state 0 \"${X[@]}\"\n\n\tbridge -j -d -s mdb show dev br0 \\\n\t\t| jq -e \".[].mdb[] | \\\n\t\t\t select(.grp == \\\"$TEST_GROUP\\\" and \\\n\t\t\t\t.source_list != null and\n\t\t\t\t.source_list[].address == \\\"192.0.2.1\\\")\" &>/dev/null\n\tcheck_fail $? \"Wrong *,G entry source list, 192.0.2.1 entry still exists\"\n\n\tbrmcast_check_sg_fwding 1 \"${X[@]}\"\n\tbrmcast_check_sg_fwding 0 \"192.0.2.100\"\n\n\tlog_test \"IGMPv3 report $TEST_GROUP include -> block\"\n\n\tv3cleanup $swp1 $TEST_GROUP\n}\n\nv3exc_block_test()\n{\n\tRET=0\n\tlocal X=(\"192.0.2.1\" \"192.0.2.2\" \"192.0.2.30\")\n\tlocal Y=(\"192.0.2.20\" \"192.0.2.21\")\n\n\tv3exclude_prepare $h1 $ALL_MAC $ALL_GROUP\n\n\tip link set dev br0 type bridge mcast_last_member_interval 500\n\tcheck_err $? \"Could not change mcast_last_member_interval to 5s\"\n\n\t$MZ $h1 -c 1 -b $ALL_MAC -B $ALL_GROUP -t ip \"proto=2,p=$MZPKT_BLOCK\" -q\n\tsleep 1\n\tbrmcast_check_sg_entries \"block\" \"${X[@]}\" \"${Y[@]}\"\n\n\tbrmcast_check_sg_state 0 \"${X[@]}\"\n\tbrmcast_check_sg_state 1 \"${Y[@]}\"\n\n\tbrmcast_check_sg_fwding 1 \"${X[@]}\" 192.0.2.100\n\tbrmcast_check_sg_fwding 0 \"${Y[@]}\"\n\n\tlog_test \"IGMPv3 report $TEST_GROUP exclude -> block\"\n\n\tip link set dev br0 type bridge mcast_last_member_interval 100\n\n\tv3cleanup $swp1 $TEST_GROUP\n}\n\nv3exc_timeout_test()\n{\n\tRET=0\n\tlocal X=(\"192.0.2.20\" \"192.0.2.30\")\n\n\t# GMI should be 3 seconds\n\tip link set dev br0 type bridge mcast_query_interval 100 \\\n\t\t\t\t\tmcast_query_response_interval 100 \\\n\t\t\t\t\tmcast_membership_interval 300\n\n\tv3exclude_prepare $h1 $ALL_MAC $ALL_GROUP\n\tip link set dev br0 type bridge mcast_query_interval 500 \\\n\t\t\t\t\tmcast_query_response_interval 500 \\\n\t\t\t\t\tmcast_membership_interval 1500\n\n\t$MZ $h1 -c 1 -b $ALL_MAC -B $ALL_GROUP -t ip \"proto=2,p=$MZPKT_ALLOW2\" -q\n\tsleep 3\n\tbridge -j -d -s mdb show dev br0 \\\n\t\t| jq -e \".[].mdb[] | \\\n\t\t\t select(.grp == \\\"$TEST_GROUP\\\" and \\\n\t\t\t\t.source_list != null and .filter_mode == \\\"include\\\")\" &>/dev/null\n\tcheck_err $? \"Wrong *,G entry filter mode\"\n\n\tbridge -j -d -s mdb show dev br0 \\\n\t\t| jq -e \".[].mdb[] | \\\n\t\t\t select(.grp == \\\"$TEST_GROUP\\\" and \\\n\t\t\t\t.source_list != null and\n\t\t\t\t.source_list[].address == \\\"192.0.2.1\\\")\" &>/dev/null\n\tcheck_fail $? \"Wrong *,G entry source list, 192.0.2.1 entry still exists\"\n\tbridge -j -d -s mdb show dev br0 \\\n\t\t| jq -e \".[].mdb[] | \\\n\t\t\t select(.grp == \\\"$TEST_GROUP\\\" and \\\n\t\t\t\t.source_list != null and\n\t\t\t\t.source_list[].address == \\\"192.0.2.2\\\")\" &>/dev/null\n\tcheck_fail $? \"Wrong *,G entry source list, 192.0.2.2 entry still exists\"\n\n\tbrmcast_check_sg_entries \"allow\" \"${X[@]}\"\n\n\tbrmcast_check_sg_state 0 \"${X[@]}\"\n\n\tbrmcast_check_sg_fwding 1 \"${X[@]}\"\n\tbrmcast_check_sg_fwding 0 192.0.2.100\n\n\tlog_test \"IGMPv3 group $TEST_GROUP exclude timeout\"\n\n\tip link set dev br0 type bridge mcast_query_interval 12500 \\\n\t\t\t\t\tmcast_query_response_interval 1000 \\\n\t\t\t\t\tmcast_membership_interval 26000\n\n\tv3cleanup $swp1 $TEST_GROUP\n}\n\nv3star_ex_auto_add_test()\n{\n\tRET=0\n\n\tv3exclude_prepare $h1 $ALL_MAC $ALL_GROUP\n\n\t$MZ $h2 -c 1 -b $ALL_MAC -B $ALL_GROUP -t ip \"proto=2,p=$MZPKT_IS_INC\" -q\n\tsleep 1\n\tbridge -j -d -s mdb show dev br0 \\\n\t\t| jq -e \".[].mdb[] | \\\n\t\t\t select(.grp == \\\"$TEST_GROUP\\\" and .src == \\\"192.0.2.3\\\" and \\\n\t\t\t\t.port == \\\"$swp1\\\")\" &>/dev/null\n\tcheck_err $? \"S,G entry for *,G port doesn't exist\"\n\n\tbridge -j -d -s mdb show dev br0 \\\n\t\t| jq -e \".[].mdb[] | \\\n\t\t\t select(.grp == \\\"$TEST_GROUP\\\" and .src == \\\"192.0.2.3\\\" and \\\n\t\t\t\t.port == \\\"$swp1\\\" and \\\n\t\t\t\t.flags[] == \\\"added_by_star_ex\\\")\" &>/dev/null\n\tcheck_err $? \"Auto-added S,G entry doesn't have added_by_star_ex flag\"\n\n\tbrmcast_check_sg_fwding 1 192.0.2.3\n\n\tlog_test \"IGMPv3 S,G port entry automatic add to a *,G port\"\n\n\tv3cleanup $swp1 $TEST_GROUP\n\tv3cleanup $swp2 $TEST_GROUP\n}\n\ntrap cleanup EXIT\n\nsetup_prepare\nsetup_wait\n\ntests_run\n\nexit $EXIT_STATUS\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}