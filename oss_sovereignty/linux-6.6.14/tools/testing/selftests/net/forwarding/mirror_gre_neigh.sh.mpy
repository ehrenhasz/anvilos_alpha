{
  "module_name": "mirror_gre_neigh.sh",
  "hash_id": "bd31becc68c6e9bf2a96311abb8143e84797cf5f1b18638b460a8ab6b82cf5df",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/net/forwarding/mirror_gre_neigh.sh",
  "human_readable_source": "#!/bin/bash\n# SPDX-License-Identifier: GPL-2.0\n\n# This test uses standard topology for testing gretap. See\n# mirror_gre_topo_lib.sh for more details.\n#\n# Test for mirroring to gretap and ip6gretap, such that the neighbor entry for\n# the tunnel remote address has invalid address at the time that the mirroring\n# is set up. Later on, the neighbor is deleted and it is expected to be\n# reinitialized using the usual ARP process, and the mirroring offload updated.\n\nALL_TESTS=\"\n\ttest_gretap\n\ttest_ip6gretap\n\"\n\nNUM_NETIFS=6\nsource lib.sh\nsource mirror_lib.sh\nsource mirror_gre_lib.sh\nsource mirror_gre_topo_lib.sh\n\nsetup_prepare()\n{\n\th1=${NETIFS[p1]}\n\tswp1=${NETIFS[p2]}\n\n\tswp2=${NETIFS[p3]}\n\th2=${NETIFS[p4]}\n\n\tswp3=${NETIFS[p5]}\n\th3=${NETIFS[p6]}\n\n\tvrf_prepare\n\tmirror_gre_topo_create\n\n\tip address add dev $swp3 192.0.2.129/28\n\tip address add dev $h3 192.0.2.130/28\n\n\tip address add dev $swp3 2001:db8:2::1/64\n\tip address add dev $h3 2001:db8:2::2/64\n}\n\ncleanup()\n{\n\tpre_cleanup\n\n\tip address del dev $h3 2001:db8:2::2/64\n\tip address del dev $swp3 2001:db8:2::1/64\n\n\tip address del dev $h3 192.0.2.130/28\n\tip address del dev $swp3 192.0.2.129/28\n\n\tmirror_gre_topo_destroy\n\tvrf_cleanup\n}\n\ntest_span_gre_neigh()\n{\n\tlocal addr=$1; shift\n\tlocal tundev=$1; shift\n\tlocal direction=$1; shift\n\tlocal what=$1; shift\n\n\tRET=0\n\n\tip neigh replace dev $swp3 $addr lladdr 00:11:22:33:44:55\n\tmirror_install $swp1 $direction $tundev \"matchall $tcflags\"\n\tfail_test_span_gre_dir $tundev ingress\n\tip neigh del dev $swp3 $addr\n\tquick_test_span_gre_dir $tundev ingress\n\tmirror_uninstall $swp1 $direction\n\n\tlog_test \"$direction $what: neighbor change ($tcflags)\"\n}\n\ntest_gretap()\n{\n\ttest_span_gre_neigh 192.0.2.130 gt4 ingress \"mirror to gretap\"\n\ttest_span_gre_neigh 192.0.2.130 gt4 egress \"mirror to gretap\"\n}\n\ntest_ip6gretap()\n{\n\ttest_span_gre_neigh 2001:db8:2::2 gt6 ingress \"mirror to ip6gretap\"\n\ttest_span_gre_neigh 2001:db8:2::2 gt6 egress \"mirror to ip6gretap\"\n}\n\ntest_all()\n{\n\tslow_path_trap_install $swp1 ingress\n\tslow_path_trap_install $swp1 egress\n\n\ttests_run\n\n\tslow_path_trap_uninstall $swp1 egress\n\tslow_path_trap_uninstall $swp1 ingress\n}\n\ntrap cleanup EXIT\n\nsetup_prepare\nsetup_wait\n\ntcflags=\"skip_hw\"\ntest_all\n\nif ! tc_offload_check; then\n\techo \"WARN: Could not test offloaded functionality\"\nelse\n\ttcflags=\"skip_sw\"\n\ttest_all\nfi\n\nexit $EXIT_STATUS\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}