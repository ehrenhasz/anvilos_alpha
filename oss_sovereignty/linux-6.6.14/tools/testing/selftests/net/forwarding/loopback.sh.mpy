{
  "module_name": "loopback.sh",
  "hash_id": "af0499067f580ad5d97838c0f9a770bf79c80d2190f69b5270b0ab28eadb51bb",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/net/forwarding/loopback.sh",
  "human_readable_source": "#!/bin/bash\n# SPDX-License-Identifier: GPL-2.0\n\n# Kselftest framework requirement - SKIP code is 4.\nksft_skip=4\n\nALL_TESTS=\"loopback_test\"\nNUM_NETIFS=2\nsource tc_common.sh\nsource lib.sh\n\nh1_create()\n{\n\tsimple_if_init $h1 192.0.2.1/24\n\ttc qdisc add dev $h1 clsact\n}\n\nh1_destroy()\n{\n\ttc qdisc del dev $h1 clsact\n\tsimple_if_fini $h1 192.0.2.1/24\n}\n\nh2_create()\n{\n\tsimple_if_init $h2\n}\n\nh2_destroy()\n{\n\tsimple_if_fini $h2\n}\n\nloopback_test()\n{\n\tRET=0\n\n\ttc filter add dev $h1 ingress protocol arp pref 1 handle 101 flower \\\n\t\tskip_hw arp_op reply arp_tip 192.0.2.1 action drop\n\n\t$MZ $h1 -c 1 -t arp -q\n\n\ttc_check_packets \"dev $h1 ingress\" 101 1\n\tcheck_fail $? \"Matched on a filter without loopback setup\"\n\n\tethtool -K $h1 loopback on\n\tcheck_err $? \"Failed to enable loopback\"\n\n\tsetup_wait_dev $h1\n\n\t$MZ $h1 -c 1 -t arp -q\n\n\ttc_check_packets \"dev $h1 ingress\" 101 1\n\tcheck_err $? \"Did not match on filter with loopback\"\n\n\tethtool -K $h1 loopback off\n\tcheck_err $? \"Failed to disable loopback\"\n\n\t$MZ $h1 -c 1 -t arp -q\n\n\ttc_check_packets \"dev $h1 ingress\" 101 2\n\tcheck_fail $? \"Matched on a filter after loopback was removed\"\n\n\ttc filter del dev $h1 ingress protocol arp pref 1 handle 101 flower\n\n\tlog_test \"loopback\"\n}\n\nsetup_prepare()\n{\n\th1=${NETIFS[p1]}\n\th2=${NETIFS[p2]}\n\n\tvrf_prepare\n\n\th1_create\n\th2_create\n\n\tif ethtool -k $h1 | grep loopback | grep -q fixed; then\n\t\tlog_test \"SKIP: dev $h1 does not support loopback feature\"\n\t\texit $ksft_skip\n\tfi\n}\n\ncleanup()\n{\n\tpre_cleanup\n\n\th2_destroy\n\th1_destroy\n\n\tvrf_cleanup\n}\n\ntrap cleanup EXIT\n\nsetup_prepare\nsetup_wait\n\ntests_run\n\nexit $EXIT_STATUS\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}