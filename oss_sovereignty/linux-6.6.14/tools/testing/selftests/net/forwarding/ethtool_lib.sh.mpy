{
  "module_name": "ethtool_lib.sh",
  "hash_id": "4472a5ae60ae2ef2bf9f607ff38f01d173bd2c9a0539f555249be55a240d2c8f",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/net/forwarding/ethtool_lib.sh",
  "human_readable_source": "#!/bin/bash\n# SPDX-License-Identifier: GPL-2.0\n\nspeeds_arr_get()\n{\n\tcmd='/ETHTOOL_LINK_MODE_[^[:space:]]*_BIT[[:space:]]+=[[:space:]]+/ \\\n\t\t{sub(/,$/, \"\") \\\n\t\tsub(/ETHTOOL_LINK_MODE_/,\"\") \\\n\t\tsub(/_BIT/,\"\") \\\n\t\tsub(/_Full/,\"/Full\") \\\n\t\tsub(/_Half/,\"/Half\");\\\n\t\tprint \"[\"$1\"]=\"$3}'\n\n\tawk \"${cmd}\" /usr/include/linux/ethtool.h\n}\n\nethtool_set()\n{\n\tlocal cmd=\"$@\"\n\tlocal out=$(ethtool -s $cmd 2>&1 | wc -l)\n\n\tcheck_err $out \"error in configuration. $cmd\"\n}\n\ndev_linkmodes_params_get()\n{\n\tlocal dev=$1; shift\n\tlocal adver=$1; shift\n\tlocal -a linkmodes_params\n\tlocal param_count\n\tlocal arr\n\n\tif (($adver)); then\n\t\tmode=\"Advertised link modes\"\n\telse\n\t\tmode=\"Supported link modes\"\n\tfi\n\n\tlocal -a dev_linkmodes=($(dev_speeds_get $dev 1 $adver))\n\tfor ((i=0; i<${#dev_linkmodes[@]}; i++)); do\n\t\tlinkmodes_params[$i]=$(echo -e \"${dev_linkmodes[$i]}\" | \\\n\t\t\t# Replaces all non numbers with spaces\n\t\t\tsed -e 's/[^0-9]/ /g' | \\\n\t\t\t# Squeeze spaces in sequence to 1 space\n\t\t\ttr -s ' ')\n\t\t# Count how many numbers were found in the linkmode\n\t\tparam_count=$(echo \"${linkmodes_params[$i]}\" | wc -w)\n\t\tif [[ $param_count -eq 1 ]]; then\n\t\t\tlinkmodes_params[$i]=\"${linkmodes_params[$i]} 1\"\n\t\telif [[ $param_count -ge 3 ]]; then\n\t\t\tarr=(${linkmodes_params[$i]})\n\t\t\t# Take only first two params\n\t\t\tlinkmodes_params[$i]=$(echo \"${arr[@]:0:2}\")\n\t\tfi\n\tdone\n\techo ${linkmodes_params[@]}\n}\n\ndev_speeds_get()\n{\n\tlocal dev=$1; shift\n\tlocal with_mode=$1; shift\n\tlocal adver=$1; shift\n\tlocal speeds_str\n\n\tif (($adver)); then\n\t\tmode=\"Advertised link modes\"\n\telse\n\t\tmode=\"Supported link modes\"\n\tfi\n\n\tspeeds_str=$(ethtool \"$dev\" | \\\n\t\t# Snip everything before the link modes section.\n\t\tsed -n '/'\"$mode\"':/,$p' | \\\n\t\t# Quit processing the rest at the start of the next section.\n\t\t# When checking, skip the header of this section (hence the 2,).\n\t\tsed -n '2,${/^[\\t][^ \\t]/q};p' | \\\n\t\t# Drop the section header of the current section.\n\t\tcut -d':' -f2)\n\n\tlocal -a speeds_arr=($speeds_str)\n\tif [[ $with_mode -eq 0 ]]; then\n\t\tfor ((i=0; i<${#speeds_arr[@]}; i++)); do\n\t\t\tspeeds_arr[$i]=${speeds_arr[$i]%base*}\n\t\tdone\n\tfi\n\techo ${speeds_arr[@]}\n}\n\ncommon_speeds_get()\n{\n\tdev1=$1; shift\n\tdev2=$1; shift\n\twith_mode=$1; shift\n\tadver=$1; shift\n\n\tlocal -a dev1_speeds=($(dev_speeds_get $dev1 $with_mode $adver))\n\tlocal -a dev2_speeds=($(dev_speeds_get $dev2 $with_mode $adver))\n\n\tcomm -12 \\\n\t\t<(printf '%s\\n' \"${dev1_speeds[@]}\" | sort -u) \\\n\t\t<(printf '%s\\n' \"${dev2_speeds[@]}\" | sort -u)\n}\n\ndifferent_speeds_get()\n{\n\tlocal dev1=$1; shift\n\tlocal dev2=$1; shift\n\tlocal with_mode=$1; shift\n\tlocal adver=$1; shift\n\n\tlocal -a speeds_arr\n\n\tspeeds_arr=($(common_speeds_get $dev1 $dev2 $with_mode $adver))\n\tif [[ ${#speeds_arr[@]} < 2 ]]; then\n\t\tcheck_err 1 \"cannot check different speeds. There are not enough speeds\"\n\tfi\n\n\techo ${speeds_arr[0]} ${speeds_arr[1]}\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}