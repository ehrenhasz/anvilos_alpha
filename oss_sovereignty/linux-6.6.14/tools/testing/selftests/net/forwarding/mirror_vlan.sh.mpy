{
  "module_name": "mirror_vlan.sh",
  "hash_id": "286fb1d04181b023dc3eb22d078a247a2438c0ac013ef680ee3773e0a534aaae",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/net/forwarding/mirror_vlan.sh",
  "human_readable_source": "#!/bin/bash\n# SPDX-License-Identifier: GPL-2.0\n\n# This test uses standard topology for testing mirroring. See mirror_topo_lib.sh\n# for more details.\n#\n# Test for \"tc action mirred egress mirror\" that mirrors to a vlan device.\n\nALL_TESTS=\"\n\ttest_vlan\n\ttest_tagged_vlan\n\"\n\nNUM_NETIFS=6\nsource lib.sh\nsource mirror_lib.sh\nsource mirror_topo_lib.sh\n\nsetup_prepare()\n{\n\th1=${NETIFS[p1]}\n\tswp1=${NETIFS[p2]}\n\n\tswp2=${NETIFS[p3]}\n\th2=${NETIFS[p4]}\n\n\tswp3=${NETIFS[p5]}\n\th3=${NETIFS[p6]}\n\n\tvrf_prepare\n\tmirror_topo_create\n\n\tvlan_create $swp3 555\n\n\tvlan_create $h3 555 v$h3\n\tmatchall_sink_create $h3.555\n\n\tvlan_create $h1 111 v$h1 192.0.2.17/28\n\tbridge vlan add dev $swp1 vid 111\n\n\tvlan_create $h2 111 v$h2 192.0.2.18/28\n\tbridge vlan add dev $swp2 vid 111\n}\n\ncleanup()\n{\n\tpre_cleanup\n\n\tvlan_destroy $h2 111\n\tvlan_destroy $h1 111\n\tvlan_destroy $h3 555\n\tvlan_destroy $swp3 555\n\n\tmirror_topo_destroy\n\tvrf_cleanup\n}\n\ntest_vlan_dir()\n{\n\tlocal direction=$1; shift\n\tlocal forward_type=$1; shift\n\tlocal backward_type=$1; shift\n\n\tRET=0\n\n\tmirror_install $swp1 $direction $swp3.555 \"matchall $tcflags\"\n\ttest_span_dir \"$h3.555\" \"$direction\" \"$forward_type\" \"$backward_type\"\n\tmirror_uninstall $swp1 $direction\n\n\tlog_test \"$direction mirror to vlan ($tcflags)\"\n}\n\ntest_vlan()\n{\n\ttest_vlan_dir ingress 8 0\n\ttest_vlan_dir egress 0 8\n}\n\ntest_tagged_vlan_dir()\n{\n\tlocal direction=$1; shift\n\tlocal forward_type=$1; shift\n\tlocal backward_type=$1; shift\n\n\tRET=0\n\n\tmirror_install $swp1 $direction $swp3.555 \"matchall $tcflags\"\n\tdo_test_span_vlan_dir_ips 10 \"$h3.555\" 111 \"$direction\" ip \\\n\t\t\t\t  192.0.2.17 192.0.2.18\n\tdo_test_span_vlan_dir_ips  0 \"$h3.555\" 555 \"$direction\" ip \\\n\t\t\t\t  192.0.2.17 192.0.2.18\n\tmirror_uninstall $swp1 $direction\n\n\tlog_test \"$direction mirror tagged to vlan ($tcflags)\"\n}\n\ntest_tagged_vlan()\n{\n\ttest_tagged_vlan_dir ingress 8 0\n\ttest_tagged_vlan_dir egress 0 8\n}\n\ntest_all()\n{\n\tslow_path_trap_install $swp1 ingress\n\tslow_path_trap_install $swp1 egress\n\ttrap_install $h3 ingress\n\n\ttests_run\n\n\ttrap_uninstall $h3 ingress\n\tslow_path_trap_uninstall $swp1 egress\n\tslow_path_trap_uninstall $swp1 ingress\n}\n\ntrap cleanup EXIT\n\nsetup_prepare\nsetup_wait\n\ntcflags=\"skip_hw\"\ntest_all\n\nif ! tc_offload_check; then\n\techo \"WARN: Could not test offloaded functionality\"\nelse\n\ttcflags=\"skip_sw\"\n\ttest_all\nfi\n\nexit $EXIT_STATUS\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}