{
  "module_name": "mirror_topo_lib.sh",
  "hash_id": "8a33f278eeef6ea443fad58bd06507956e2a73f1d9aae3cc61d4f4172ce64f96",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/net/forwarding/mirror_topo_lib.sh",
  "human_readable_source": "# SPDX-License-Identifier: GPL-2.0\n\n# This is the standard topology for testing mirroring. The tests that use it\n# tweak it in one way or another--typically add more devices to the topology.\n#\n#   +---------------------+                             +---------------------+\n#   | H1                  |                             |                  H2 |\n#   |     + $h1           |                             |           $h2 +     |\n#   |     | 192.0.2.1/28  |                             |  192.0.2.2/28 |     |\n#   +-----|---------------+                             +---------------|-----+\n#         |                                                             |\n#   +-----|-------------------------------------------------------------|-----+\n#   | SW  o--> mirror                                                   |     |\n#   | +---|-------------------------------------------------------------|---+ |\n#   | |   + $swp1                    BR                           $swp2 +   | |\n#   | +---------------------------------------------------------------------+ |\n#   |                                                                         |\n#   |     + $swp3                                                             |\n#   +-----|-------------------------------------------------------------------+\n#         |\n#   +-----|-------------------------------------------------------------------+\n#   | H3  + $h3                                                               |\n#   |                                                                         |\n#   +-------------------------------------------------------------------------+\n\nmirror_topo_h1_create()\n{\n\tsimple_if_init $h1 192.0.2.1/28\n}\n\nmirror_topo_h1_destroy()\n{\n\tsimple_if_fini $h1 192.0.2.1/28\n}\n\nmirror_topo_h2_create()\n{\n\tsimple_if_init $h2 192.0.2.2/28\n}\n\nmirror_topo_h2_destroy()\n{\n\tsimple_if_fini $h2 192.0.2.2/28\n}\n\nmirror_topo_h3_create()\n{\n\tsimple_if_init $h3\n\ttc qdisc add dev $h3 clsact\n}\n\nmirror_topo_h3_destroy()\n{\n\ttc qdisc del dev $h3 clsact\n\tsimple_if_fini $h3\n}\n\nmirror_topo_switch_create()\n{\n\tip link set dev $swp3 up\n\n\tip link add name br1 type bridge vlan_filtering 1\n\tip link set dev br1 addrgenmode none\n\tip link set dev br1 up\n\n\tip link set dev $swp1 master br1\n\tip link set dev $swp1 up\n\n\tip link set dev $swp2 master br1\n\tip link set dev $swp2 up\n\n\ttc qdisc add dev $swp1 clsact\n}\n\nmirror_topo_switch_destroy()\n{\n\ttc qdisc del dev $swp1 clsact\n\n\tip link set dev $swp1 down\n\tip link set dev $swp2 down\n\tip link del dev br1\n\n\tip link set dev $swp3 down\n}\n\nmirror_topo_create()\n{\n\tmirror_topo_h1_create\n\tmirror_topo_h2_create\n\tmirror_topo_h3_create\n\n\tmirror_topo_switch_create\n}\n\nmirror_topo_destroy()\n{\n\tmirror_topo_switch_destroy\n\n\tmirror_topo_h3_destroy\n\tmirror_topo_h2_destroy\n\tmirror_topo_h1_destroy\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}