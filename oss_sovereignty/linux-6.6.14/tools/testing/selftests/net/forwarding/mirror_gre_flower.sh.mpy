{
  "module_name": "mirror_gre_flower.sh",
  "hash_id": "a650b719f731a5cb2f0c065354a93188b3a448166131e28124bb0f8344f10904",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/net/forwarding/mirror_gre_flower.sh",
  "human_readable_source": "#!/bin/bash\n# SPDX-License-Identifier: GPL-2.0\n\n# This test uses standard topology for testing gretap. See\n# mirror_gre_topo_lib.sh for more details.\n#\n# This tests flower-triggered mirroring to gretap and ip6gretap netdevices. The\n# interfaces on H1 and H2 have two addresses each. Flower match on one of the\n# addresses is configured with mirror action. It is expected that when pinging\n# this address, mirroring takes place, whereas when pinging the other one,\n# there's no mirroring.\n\nALL_TESTS=\"\n\ttest_gretap\n\ttest_ip6gretap\n\"\n\nNUM_NETIFS=6\nsource lib.sh\nsource mirror_lib.sh\nsource mirror_gre_lib.sh\nsource mirror_gre_topo_lib.sh\n\nsetup_prepare()\n{\n\th1=${NETIFS[p1]}\n\tswp1=${NETIFS[p2]}\n\n\tswp2=${NETIFS[p3]}\n\th2=${NETIFS[p4]}\n\n\tswp3=${NETIFS[p5]}\n\th3=${NETIFS[p6]}\n\n\tvrf_prepare\n\tmirror_gre_topo_create\n\n\tip address add dev $swp3 192.0.2.129/28\n\tip address add dev $h3 192.0.2.130/28\n\n\tip address add dev $swp3 2001:db8:2::1/64\n\tip address add dev $h3 2001:db8:2::2/64\n\n\tip address add dev $h1 192.0.2.3/28\n\tip address add dev $h2 192.0.2.4/28\n}\n\ncleanup()\n{\n\tpre_cleanup\n\n\tip address del dev $h2 192.0.2.4/28\n\tip address del dev $h1 192.0.2.3/28\n\n\tip address del dev $h3 2001:db8:2::2/64\n\tip address del dev $swp3 2001:db8:2::1/64\n\n\tip address del dev $h3 192.0.2.130/28\n\tip address del dev $swp3 192.0.2.129/28\n\n\tmirror_gre_topo_destroy\n\tvrf_cleanup\n}\n\ntest_span_gre_dir_acl()\n{\n\ttest_span_gre_dir_ips \"$@\" 192.0.2.3 192.0.2.4\n}\n\nfail_test_span_gre_dir_acl()\n{\n\tfail_test_span_gre_dir_ips \"$@\" 192.0.2.3 192.0.2.4\n}\n\nfull_test_span_gre_dir_acl()\n{\n\tlocal tundev=$1; shift\n\tlocal direction=$1; shift\n\tlocal forward_type=$1; shift\n\tlocal backward_type=$1; shift\n\tlocal match_dip=$1; shift\n\tlocal what=$1; shift\n\n\tRET=0\n\n\tmirror_install $swp1 $direction $tundev \\\n\t\t       \"protocol ip flower $tcflags dst_ip $match_dip\"\n\tfail_test_span_gre_dir $tundev $direction\n\ttest_span_gre_dir_acl \"$tundev\" \"$direction\" \\\n\t\t\t  \"$forward_type\" \"$backward_type\"\n\tmirror_uninstall $swp1 $direction\n\n\t# Test lack of mirroring after ACL mirror is uninstalled.\n\tfail_test_span_gre_dir_acl \"$tundev\" \"$direction\"\n\n\tlog_test \"$direction $what ($tcflags)\"\n}\n\ntest_gretap()\n{\n\tfull_test_span_gre_dir_acl gt4 ingress 8 0 192.0.2.4 \"ACL mirror to gretap\"\n\tfull_test_span_gre_dir_acl gt4 egress 0 8 192.0.2.3 \"ACL mirror to gretap\"\n}\n\ntest_ip6gretap()\n{\n\tfull_test_span_gre_dir_acl gt6 ingress 8 0 192.0.2.4 \"ACL mirror to ip6gretap\"\n\tfull_test_span_gre_dir_acl gt6 egress 0 8 192.0.2.3 \"ACL mirror to ip6gretap\"\n}\n\ntest_all()\n{\n\tslow_path_trap_install $swp1 ingress\n\tslow_path_trap_install $swp1 egress\n\n\ttests_run\n\n\tslow_path_trap_uninstall $swp1 egress\n\tslow_path_trap_uninstall $swp1 ingress\n}\n\ntrap cleanup EXIT\n\nsetup_prepare\nsetup_wait\n\ntcflags=\"skip_hw\"\ntest_all\n\nif ! tc_offload_check; then\n\techo \"WARN: Could not test offloaded functionality\"\nelse\n\ttcflags=\"skip_sw\"\n\ttest_all\nfi\n\nexit $EXIT_STATUS\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}