{
  "module_name": "router_vid_1.sh",
  "hash_id": "286bbf4eae63f494e5839c5df15ffc802fb595a62a9f7dfc7fa3cdc8aec03dd1",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/net/forwarding/router_vid_1.sh",
  "human_readable_source": "#!/bin/bash\n# SPDX-License-Identifier: GPL-2.0\n\n# +--------------------+                     +----------------------+\n# | H1                 |                     |                   H2 |\n# |                    |                     |                      |\n# |            $h1.1 + |                     | + $h2.1              |\n# |     192.0.2.2/24 | |                     | | 198.51.100.2/24    |\n# | 2001:db8:1::2/64 | |                     | | 2001:db8:2::2/64   |\n# |                  | |                     | |                    |\n# |              $h1 + |                     | + $h2                |\n# |                  | |                     | |                    |\n# +------------------|-+                     +-|--------------------+\n#                    |                         |\n# +------------------|-------------------------|--------------------+\n# | SW               |                         |                    |\n# |                  |                         |                    |\n# |             $rp1 +                         + $rp2               |\n# |                  |                         |                    |\n# |           $rp1.1 +                         + $rp2.1             |\n# |     192.0.2.1/24                             198.51.100.1/24    |\n# | 2001:db8:1::1/64                             2001:db8:2::1/64   |\n# |                                                                 |\n# +-----------------------------------------------------------------+\n\nALL_TESTS=\"\n\tping_ipv4\n\tping_ipv6\n\"\nNUM_NETIFS=4\nsource lib.sh\n\nh1_create()\n{\n\tvrf_create \"vrf-h1\"\n\tip link set dev vrf-h1 up\n\n\tip link set dev $h1 up\n\tvlan_create $h1 1 vrf-h1 192.0.2.2/24 2001:db8:1::2/64\n\n\tip route add 198.51.100.0/24 vrf vrf-h1 nexthop via 192.0.2.1\n\tip route add 2001:db8:2::/64 vrf vrf-h1 nexthop via 2001:db8:1::1\n}\n\nh1_destroy()\n{\n\tip route del 2001:db8:2::/64 vrf vrf-h1\n\tip route del 198.51.100.0/24 vrf vrf-h1\n\n\tvlan_destroy $h1 1\n\tip link set dev $h1 down\n\n\tip link set dev vrf-h1 down\n\tvrf_destroy \"vrf-h1\"\n}\n\nh2_create()\n{\n\tvrf_create \"vrf-h2\"\n\tip link set dev vrf-h2 up\n\n\tip link set dev $h2 up\n\tvlan_create $h2 1 vrf-h2 198.51.100.2/24 2001:db8:2::2/64\n\n\tip route add 192.0.2.0/24 vrf vrf-h2 nexthop via 198.51.100.1\n\tip route add 2001:db8:1::/64 vrf vrf-h2 nexthop via 2001:db8:2::1\n}\n\nh2_destroy()\n{\n\tip route del 2001:db8:1::/64 vrf vrf-h2\n\tip route del 192.0.2.0/24 vrf vrf-h2\n\n\tvlan_destroy $h2 1\n\tip link set dev $h2 down\n\n\tip link set dev vrf-h2 down\n\tvrf_destroy \"vrf-h2\"\n}\n\nrouter_create()\n{\n\tip link set dev $rp1 up\n\tip link add link $rp1 name $rp1.1 up type vlan id 1\n\n\tip address add 192.0.2.1/24 dev $rp1.1\n\tip address add 2001:db8:1::1/64 dev $rp1.1\n\n\tip link set dev $rp2 up\n\tip link add link $rp2 name $rp2.1 up type vlan id 1\n\n\tip address add 198.51.100.1/24 dev $rp2.1\n\tip address add 2001:db8:2::1/64 dev $rp2.1\n}\n\nrouter_destroy()\n{\n\tip address del 2001:db8:2::1/64 dev $rp2.1\n\tip address del 198.51.100.1/24 dev $rp2.1\n\n\tip link del dev $rp2.1\n\tip link set dev $rp2 down\n\n\tip address del 2001:db8:1::1/64 dev $rp1.1\n\tip address del 192.0.2.1/24 dev $rp1.1\n\n\tip link del dev $rp1.1\n\tip link set dev $rp1 down\n}\n\nsetup_prepare()\n{\n\th1=${NETIFS[p1]}\n\trp1=${NETIFS[p2]}\n\n\trp2=${NETIFS[p3]}\n\th2=${NETIFS[p4]}\n\n\tvrf_prepare\n\n\th1_create\n\th2_create\n\n\trouter_create\n\n\tforwarding_enable\n}\n\ncleanup()\n{\n\tpre_cleanup\n\n\tforwarding_restore\n\n\trouter_destroy\n\n\th2_destroy\n\th1_destroy\n\n\tvrf_cleanup\n}\n\nping_ipv4()\n{\n\tping_test $h1.1 198.51.100.2\n}\n\nping_ipv6()\n{\n\tping6_test $h1.1 2001:db8:2::2\n}\n\ntrap cleanup EXIT\n\nsetup_prepare\nsetup_wait\n\ntests_run\n\nexit $EXIT_STATUS\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}