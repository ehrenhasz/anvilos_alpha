{
  "module_name": "tc_vlan_modify.sh",
  "hash_id": "91b692478a9c1506ad0fc57561b9ddd804cbc5a983b6a3001a35370e8b600ea9",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/net/forwarding/tc_vlan_modify.sh",
  "human_readable_source": "#!/bin/bash\n# SPDX-License-Identifier: GPL-2.0\n\nALL_TESTS=\"\n\tvlan_modify_ingress\n\tvlan_modify_egress\n\"\n\nNUM_NETIFS=4\nCHECK_TC=\"yes\"\nsource lib.sh\n\nh1_create()\n{\n\tsimple_if_init $h1 192.0.2.1/28 2001:db8:1::1/64\n\tvlan_create $h1 85 v$h1 192.0.2.17/28 2001:db8:2::1/64\n}\n\nh1_destroy()\n{\n\tvlan_destroy $h1 85\n\tsimple_if_fini $h1 192.0.2.1/28 2001:db8:1::1/64\n}\n\nh2_create()\n{\n\tsimple_if_init $h2 192.0.2.2/28 2001:db8:1::2/64\n\tvlan_create $h2 65 v$h2 192.0.2.18/28 2001:db8:2::2/64\n}\n\nh2_destroy()\n{\n\tvlan_destroy $h2 65\n\tsimple_if_fini $h2 192.0.2.2/28 2001:db8:1::2/64\n}\n\nswitch_create()\n{\n\tip link add dev br0 type bridge vlan_filtering 1 mcast_snooping 0\n\n\tip link set dev $swp1 master br0\n\tip link set dev $swp2 master br0\n\n\tip link set dev br0 up\n\tip link set dev $swp1 up\n\tip link set dev $swp2 up\n\n\tbridge vlan add dev $swp1 vid 85\n\tbridge vlan add dev $swp2 vid 65\n\n\tbridge vlan add dev $swp2 vid 85\n\tbridge vlan add dev $swp1 vid 65\n\n\ttc qdisc add dev $swp1 clsact\n\ttc qdisc add dev $swp2 clsact\n}\n\nswitch_destroy()\n{\n\ttc qdisc del dev $swp2 clsact\n\ttc qdisc del dev $swp1 clsact\n\n\tbridge vlan del vid 65 dev $swp1\n\tbridge vlan del vid 85 dev $swp2\n\n\tbridge vlan del vid 65 dev $swp2\n\tbridge vlan del vid 85 dev $swp1\n\n\tip link set dev $swp2 down\n\tip link set dev $swp1 down\n\n\tip link del dev br0\n}\n\nsetup_prepare()\n{\n\th1=${NETIFS[p1]}\n\tswp1=${NETIFS[p2]}\n\n\tswp2=${NETIFS[p3]}\n\th2=${NETIFS[p4]}\n\n\tvrf_prepare\n\n\th1_create\n\th2_create\n\n\tswitch_create\n}\n\ncleanup()\n{\n\tpre_cleanup\n\n\tswitch_destroy\n\n\th2_destroy\n\th1_destroy\n\n\tvrf_cleanup\n}\n\nvlan_modify_ingress()\n{\n\tRET=0\n\n\tping_do $h1.85 192.0.2.18\n\tcheck_fail $? \"ping between two different vlans passed when should not\"\n\n\tping6_do $h1.85 2001:db8:2::2\n\tcheck_fail $? \"ping6 between two different vlans passed when should not\"\n\n\ttc filter add dev $swp1 ingress protocol all pref 1 handle 1 \\\n\t\tflower action vlan modify id 65\n\ttc filter add dev $swp2 ingress protocol all pref 1 handle 1 \\\n\t\tflower action vlan modify id 85\n\n\tping_do $h1.85 192.0.2.18\n\tcheck_err $? \"ping between two different vlans failed when should not\"\n\n\tping6_do $h1.85 2001:db8:2::2\n\tcheck_err $? \"ping6 between two different vlans failed when should not\"\n\n\tlog_test \"VLAN modify at ingress\"\n\n\ttc filter del dev $swp2 ingress protocol all pref 1 handle 1 flower\n\ttc filter del dev $swp1 ingress protocol all pref 1 handle 1 flower\n}\n\nvlan_modify_egress()\n{\n\tRET=0\n\n\tping_do $h1.85 192.0.2.18\n\tcheck_fail $? \"ping between two different vlans passed when should not\"\n\n\tping6_do $h1.85 2001:db8:2::2\n\tcheck_fail $? \"ping6 between two different vlans passed when should not\"\n\n\ttc filter add dev $swp1 egress protocol all pref 1 handle 1 \\\n\t\tflower action vlan modify id 85\n\ttc filter add dev $swp2 egress protocol all pref 1 handle 1 \\\n\t\tflower action vlan modify id 65\n\n\tping_do $h1.85 192.0.2.18\n\tcheck_err $? \"ping between two different vlans failed when should not\"\n\n\tping6_do $h1.85 2001:db8:2::2\n\tcheck_err $? \"ping6 between two different vlans failed when should not\"\n\n\tlog_test \"VLAN modify at egress\"\n\n\ttc filter del dev $swp2 egress protocol all pref 1 handle 1 flower\n\ttc filter del dev $swp1 egress protocol all pref 1 handle 1 flower\n}\n\ntrap cleanup EXIT\n\nsetup_prepare\nsetup_wait\n\ntests_run\n\nexit $EXIT_STATUS\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}