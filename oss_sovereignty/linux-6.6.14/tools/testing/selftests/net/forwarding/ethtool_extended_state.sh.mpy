{
  "module_name": "ethtool_extended_state.sh",
  "hash_id": "23048cab2e3da809395f8b68a55e6f664259c6e2a66a796042c0ddd6daaf8fa0",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/net/forwarding/ethtool_extended_state.sh",
  "human_readable_source": "#!/bin/bash\n# SPDX-License-Identifier: GPL-2.0\n\nALL_TESTS=\"\n\tautoneg\n\tautoneg_force_mode\n\tno_cable\n\"\n\nNUM_NETIFS=2\nsource lib.sh\nsource ethtool_lib.sh\n\nTIMEOUT=$((WAIT_TIMEOUT * 1000)) # ms\n\nsetup_prepare()\n{\n\tswp1=${NETIFS[p1]}\n\tswp2=${NETIFS[p2]}\n\tswp3=$NETIF_NO_CABLE\n}\n\nethtool_ext_state()\n{\n\tlocal dev=$1; shift\n\tlocal expected_ext_state=$1; shift\n\tlocal expected_ext_substate=${1:-\"\"}; shift\n\n\tlocal ext_state=$(ethtool $dev | grep \"Link detected\" \\\n\t\t| cut -d \"(\" -f2 | cut -d \")\" -f1)\n\tlocal ext_substate=$(echo $ext_state | cut -sd \",\" -f2 \\\n\t\t| sed -e 's/^[[:space:]]*//')\n\text_state=$(echo $ext_state | cut -d \",\" -f1)\n\n\tif [[ $ext_state != $expected_ext_state ]]; then\n\t\techo \"Expected \\\"$expected_ext_state\\\", got \\\"$ext_state\\\"\"\n\t\treturn 1\n\tfi\n\tif [[ $ext_substate != $expected_ext_substate ]]; then\n\t\techo \"Expected \\\"$expected_ext_substate\\\", got \\\"$ext_substate\\\"\"\n\t\treturn 1\n\tfi\n}\n\nautoneg()\n{\n\tlocal msg\n\n\tRET=0\n\n\tip link set dev $swp1 up\n\n\tmsg=$(busywait $TIMEOUT ethtool_ext_state $swp1 \\\n\t\t\t\"Autoneg\" \"No partner detected\")\n\tcheck_err $? \"$msg\"\n\n\tlog_test \"Autoneg, No partner detected\"\n\n\tip link set dev $swp1 down\n}\n\nautoneg_force_mode()\n{\n\tlocal msg\n\n\tRET=0\n\n\tip link set dev $swp1 up\n\tip link set dev $swp2 up\n\n\tlocal -a speeds_arr=($(different_speeds_get $swp1 $swp2 0 0))\n\tlocal speed1=${speeds_arr[0]}\n\tlocal speed2=${speeds_arr[1]}\n\n\tethtool_set $swp1 speed $speed1 autoneg off\n\tethtool_set $swp2 speed $speed2 autoneg off\n\n\tmsg=$(busywait $TIMEOUT ethtool_ext_state $swp1 \\\n\t\t\t\"Autoneg\" \"No partner detected during force mode\")\n\tcheck_err $? \"$msg\"\n\n\tmsg=$(busywait $TIMEOUT ethtool_ext_state $swp2 \\\n\t\t\t\"Autoneg\" \"No partner detected during force mode\")\n\tcheck_err $? \"$msg\"\n\n\tlog_test \"Autoneg, No partner detected during force mode\"\n\n\tethtool -s $swp2 autoneg on\n\tethtool -s $swp1 autoneg on\n\n\tip link set dev $swp2 down\n\tip link set dev $swp1 down\n}\n\nno_cable()\n{\n\tlocal msg\n\n\tRET=0\n\n\tip link set dev $swp3 up\n\n\tmsg=$(busywait $TIMEOUT ethtool_ext_state $swp3 \"No cable\")\n\tcheck_err $? \"$msg\"\n\n\tlog_test \"No cable\"\n\n\tip link set dev $swp3 down\n}\n\nskip_on_veth\n\nsetup_prepare\n\ntests_run\n\nexit $EXIT_STATUS\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}