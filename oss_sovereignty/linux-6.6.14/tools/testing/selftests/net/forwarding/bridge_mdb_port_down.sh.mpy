{
  "module_name": "bridge_mdb_port_down.sh",
  "hash_id": "3dc7b3a99690579aa20bc15494e5b6032d517a6ee6eb02c55ac87242c82437ca",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/net/forwarding/bridge_mdb_port_down.sh",
  "human_readable_source": "#!/bin/bash\n# SPDX-License-Identifier: GPL-2.0\n#\n# Verify that permanent mdb entries can be added to and deleted from bridge\n# interfaces that are down, and works correctly when done so.\n\nALL_TESTS=\"add_del_to_port_down\"\nNUM_NETIFS=4\n\nTEST_GROUP=\"239.10.10.10\"\nTEST_GROUP_MAC=\"01:00:5e:0a:0a:0a\"\n\nsource lib.sh\n\n\nadd_del_to_port_down() {\n\tRET=0\n\n\tip link set dev $swp2 down\n\tbridge mdb add dev br0 port \"$swp2\" grp $TEST_GROUP permanent 2>/dev/null\n\tcheck_err $? \"Failed adding mdb entry\"\n\n\tip link set dev $swp2 up\n\tsetup_wait_dev $swp2\n\tmcast_packet_test $TEST_GROUP_MAC 192.0.2.1 $TEST_GROUP $h1 $h2\n\tcheck_fail $? \"Traffic to $TEST_GROUP wasn't forwarded\"\n\n\tip link set dev $swp2 down\n\tbridge mdb show dev br0 | grep -q \"$TEST_GROUP permanent\" 2>/dev/null\n\tcheck_err $? \"MDB entry did not persist after link up/down\"\n\n\tbridge mdb del dev br0 port \"$swp2\" grp $TEST_GROUP 2>/dev/null\n\tcheck_err $? \"Failed deleting mdb entry\"\n\n\tip link set dev $swp2 up\n\tsetup_wait_dev $swp2\n\tmcast_packet_test $TEST_GROUP_MAC 192.0.2.1 $TEST_GROUP $h1 $h2\n\tcheck_err $? \"Traffic to $TEST_GROUP was forwarded after entry removed\"\n\n\tlog_test \"MDB add/del entry to port with state down \"\n}\n\nh1_create()\n{\n\tsimple_if_init $h1 192.0.2.1/24 2001:db8:1::1/64\n}\n\nh1_destroy()\n{\n\tsimple_if_fini $h1 192.0.2.1/24 2001:db8:1::1/64\n}\n\nh2_create()\n{\n\tsimple_if_init $h2 192.0.2.2/24 2001:db8:1::2/64\n}\n\nh2_destroy()\n{\n\tsimple_if_fini $h2 192.0.2.2/24 2001:db8:1::2/64\n}\n\nswitch_create()\n{\n\t# Enable multicast filtering\n\tip link add dev br0 type bridge mcast_snooping 1 mcast_querier 1\n\n\tip link set dev $swp1 master br0\n\tip link set dev $swp2 master br0\n\n\tip link set dev br0 up\n\tip link set dev $swp1 up\n\n\tbridge link set dev $swp2 mcast_flood off\n\t# Bridge currently has a \"grace time\" at creation time before it\n\t# forwards multicast according to the mdb. Since we disable the\n\t# mcast_flood setting per port\n\tsleep 10\n}\n\nswitch_destroy()\n{\n\tip link set dev $swp1 down\n\tip link set dev $swp2 down\n\tip link del dev br0\n}\n\nsetup_prepare()\n{\n\th1=${NETIFS[p1]}\n\tswp1=${NETIFS[p2]}\n\n\tswp2=${NETIFS[p3]}\n\th2=${NETIFS[p4]}\n\n\tvrf_prepare\n\n\th1_create\n\th2_create\n\tswitch_create\n}\n\ncleanup()\n{\n\tpre_cleanup\n\n\tswitch_destroy\n\th1_destroy\n\th2_destroy\n\n\tvrf_cleanup\n}\n\ntrap cleanup EXIT\n\nsetup_prepare\ntests_run\nexit $EXIT_STATUS\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}