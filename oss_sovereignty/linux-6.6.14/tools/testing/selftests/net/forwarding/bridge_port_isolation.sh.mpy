{
  "module_name": "bridge_port_isolation.sh",
  "hash_id": "3317822a3c0343a65984dfab885a74ecd90cb2064bb9900b6d1f36993a59025c",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/net/forwarding/bridge_port_isolation.sh",
  "human_readable_source": "#!/bin/bash\n# SPDX-License-Identifier: GPL-2.0\n\nALL_TESTS=\"ping_ipv4 ping_ipv6 flooding\"\nNUM_NETIFS=6\nCHECK_TC=\"yes\"\nsource lib.sh\n\nh1_create()\n{\n\tsimple_if_init $h1 192.0.2.1/24 2001:db8:1::1/64\n}\n\nh1_destroy()\n{\n\tsimple_if_fini $h1 192.0.2.1/24 2001:db8:1::1/64\n}\n\nh2_create()\n{\n\tsimple_if_init $h2 192.0.2.2/24 2001:db8:1::2/64\n}\n\nh2_destroy()\n{\n\tsimple_if_fini $h2 192.0.2.2/24 2001:db8:1::2/64\n}\n\nh3_create()\n{\n\tsimple_if_init $h3 192.0.2.3/24 2001:db8:1::3/64\n}\n\nh3_destroy()\n{\n\tsimple_if_fini $h3 192.0.2.3/24 2001:db8:1::3/64\n}\n\nswitch_create()\n{\n\tip link add dev br0 type bridge\n\n\tip link set dev $swp1 master br0\n\tip link set dev $swp2 master br0\n\tip link set dev $swp3 master br0\n\n\tip link set dev $swp1 type bridge_slave isolated on\n\tcheck_err $? \"Can't set isolation on port $swp1\"\n\tip link set dev $swp2 type bridge_slave isolated on\n\tcheck_err $? \"Can't set isolation on port $swp2\"\n\tip link set dev $swp3 type bridge_slave isolated off\n\tcheck_err $? \"Can't disable isolation on port $swp3\"\n\n\tip link set dev br0 up\n\tip link set dev $swp1 up\n\tip link set dev $swp2 up\n\tip link set dev $swp3 up\n}\n\nswitch_destroy()\n{\n\tip link set dev $swp3 down\n\tip link set dev $swp2 down\n\tip link set dev $swp1 down\n\n\tip link del dev br0\n}\n\nsetup_prepare()\n{\n\th1=${NETIFS[p1]}\n\tswp1=${NETIFS[p2]}\n\n\tswp2=${NETIFS[p3]}\n\th2=${NETIFS[p4]}\n\n\tswp3=${NETIFS[p5]}\n\th3=${NETIFS[p6]}\n\n\tvrf_prepare\n\n\th1_create\n\th2_create\n\th3_create\n\n\tswitch_create\n}\n\ncleanup()\n{\n\tpre_cleanup\n\n\tswitch_destroy\n\n\th3_destroy\n\th2_destroy\n\th1_destroy\n\n\tvrf_cleanup\n}\n\nping_ipv4()\n{\n\tRET=0\n\tping_do $h1 192.0.2.2\n\tcheck_fail $? \"Ping worked when it should not have\"\n\n\tRET=0\n\tping_do $h3 192.0.2.2\n\tcheck_err $? \"Ping didn't work when it should have\"\n\n\tlog_test \"Isolated port ping\"\n}\n\nping_ipv6()\n{\n\tRET=0\n\tping6_do $h1 2001:db8:1::2\n\tcheck_fail $? \"Ping6 worked when it should not have\"\n\n\tRET=0\n\tping6_do $h3 2001:db8:1::2\n\tcheck_err $? \"Ping6 didn't work when it should have\"\n\n\tlog_test \"Isolated port ping6\"\n}\n\nflooding()\n{\n\tlocal mac=de:ad:be:ef:13:37\n\tlocal ip=192.0.2.100\n\n\tRET=0\n\tflood_test_do false $mac $ip $h1 $h2\n\tcheck_err $? \"Packet was flooded when it should not have been\"\n\n\tRET=0\n\tflood_test_do true $mac $ip $h3 $h2\n\tcheck_err $? \"Packet was not flooded when it should have been\"\n\n\tlog_test \"Isolated port flooding\"\n}\n\ntrap cleanup EXIT\n\nsetup_prepare\nsetup_wait\n\ntests_run\n\nexit $EXIT_STATUS\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}