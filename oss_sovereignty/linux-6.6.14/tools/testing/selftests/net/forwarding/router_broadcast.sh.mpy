{
  "module_name": "router_broadcast.sh",
  "hash_id": "a6629eed98c085b0029bca52bd19231ff404fb8d4578f67bc2b93489853dfdc6",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/net/forwarding/router_broadcast.sh",
  "human_readable_source": "#!/bin/bash\n# SPDX-License-Identifier: GPL-2.0\n\nALL_TESTS=\"ping_ipv4\"\nNUM_NETIFS=6\nsource lib.sh\n\nh1_create()\n{\n\tvrf_create \"vrf-h1\"\n\tip link set dev $h1 master vrf-h1\n\n\tip link set dev vrf-h1 up\n\tip link set dev $h1 up\n\n\tip address add 192.0.2.2/24 dev $h1\n\n\tip route add 198.51.100.0/24 vrf vrf-h1 nexthop via 192.0.2.1\n\tip route add 198.51.200.0/24 vrf vrf-h1 nexthop via 192.0.2.1\n}\n\nh1_destroy()\n{\n\tip route del 198.51.200.0/24 vrf vrf-h1\n\tip route del 198.51.100.0/24 vrf vrf-h1\n\n\tip address del 192.0.2.2/24 dev $h1\n\n\tip link set dev $h1 down\n\tvrf_destroy \"vrf-h1\"\n}\n\nh2_create()\n{\n\tvrf_create \"vrf-h2\"\n\tip link set dev $h2 master vrf-h2\n\n\tip link set dev vrf-h2 up\n\tip link set dev $h2 up\n\n\tip address add 198.51.100.2/24 dev $h2\n\n\tip route add 192.0.2.0/24 vrf vrf-h2 nexthop via 198.51.100.1\n\tip route add 198.51.200.0/24 vrf vrf-h2 nexthop via 198.51.100.1\n}\n\nh2_destroy()\n{\n\tip route del 198.51.200.0/24 vrf vrf-h2\n\tip route del 192.0.2.0/24 vrf vrf-h2\n\n\tip address del 198.51.100.2/24 dev $h2\n\n\tip link set dev $h2 down\n\tvrf_destroy \"vrf-h2\"\n}\n\nh3_create()\n{\n\tvrf_create \"vrf-h3\"\n\tip link set dev $h3 master vrf-h3\n\n\tip link set dev vrf-h3 up\n\tip link set dev $h3 up\n\n\tip address add 198.51.200.2/24 dev $h3\n\n\tip route add 192.0.2.0/24 vrf vrf-h3 nexthop via 198.51.200.1\n\tip route add 198.51.100.0/24 vrf vrf-h3 nexthop via 198.51.200.1\n}\n\nh3_destroy()\n{\n\tip route del 198.51.100.0/24 vrf vrf-h3\n\tip route del 192.0.2.0/24 vrf vrf-h3\n\n\tip address del 198.51.200.2/24 dev $h3\n\n\tip link set dev $h3 down\n\tvrf_destroy \"vrf-h3\"\n}\n\nrouter_create()\n{\n\tip link set dev $rp1 up\n\tip link set dev $rp2 up\n\tip link set dev $rp3 up\n\n\tip address add 192.0.2.1/24 dev $rp1\n\n\tip address add 198.51.100.1/24 dev $rp2\n\tip address add 198.51.200.1/24 dev $rp3\n}\n\nrouter_destroy()\n{\n\tip address del 198.51.200.1/24 dev $rp3\n\tip address del 198.51.100.1/24 dev $rp2\n\n\tip address del 192.0.2.1/24 dev $rp1\n\n\tip link set dev $rp3 down\n\tip link set dev $rp2 down\n\tip link set dev $rp1 down\n}\n\nsetup_prepare()\n{\n\th1=${NETIFS[p1]}\n\trp1=${NETIFS[p2]}\n\n\trp2=${NETIFS[p3]}\n\th2=${NETIFS[p4]}\n\n\trp3=${NETIFS[p5]}\n\th3=${NETIFS[p6]}\n\n\tvrf_prepare\n\n\th1_create\n\th2_create\n\th3_create\n\n\trouter_create\n\n\tforwarding_enable\n}\n\ncleanup()\n{\n\tpre_cleanup\n\n\tforwarding_restore\n\n\trouter_destroy\n\n\th3_destroy\n\th2_destroy\n\th1_destroy\n\n\tvrf_cleanup\n}\n\nbc_forwarding_disable()\n{\n\tsysctl_set net.ipv4.conf.all.bc_forwarding 0\n\tsysctl_set net.ipv4.conf.$rp1.bc_forwarding 0\n\tsysctl_set net.ipv4.conf.$rp2.bc_forwarding 0\n}\n\nbc_forwarding_enable()\n{\n\tsysctl_set net.ipv4.conf.all.bc_forwarding 1\n\tsysctl_set net.ipv4.conf.$rp1.bc_forwarding 1\n\tsysctl_set net.ipv4.conf.$rp2.bc_forwarding 1\n}\n\nbc_forwarding_restore()\n{\n\tsysctl_restore net.ipv4.conf.$rp2.bc_forwarding\n\tsysctl_restore net.ipv4.conf.$rp1.bc_forwarding\n\tsysctl_restore net.ipv4.conf.all.bc_forwarding\n}\n\nping_test_from()\n{\n\tlocal oif=$1\n\tlocal dip=$2\n\tlocal from=$3\n\tlocal fail=${4:-0}\n\n\tRET=0\n\n\tlog_info \"ping $dip, expected reply from $from\"\n\tip vrf exec $(master_name_get $oif) \\\n\t\t$PING -I $oif $dip -c 10 -i 0.1 -w $PING_TIMEOUT -b 2>&1 \\\n\t\t| grep \"bytes from $from\" > /dev/null\n\tcheck_err_fail $fail $?\n}\n\nping_ipv4()\n{\n\tsysctl_set net.ipv4.icmp_echo_ignore_broadcasts 0\n\n\tbc_forwarding_disable\n\tlog_info \"bc_forwarding disabled on r1 =>\"\n\tping_test_from $h1 198.51.100.255 192.0.2.1\n\tlog_test \"h1 -> net2: reply from r1 (not forwarding)\"\n\tping_test_from $h1 198.51.200.255 192.0.2.1\n\tlog_test \"h1 -> net3: reply from r1 (not forwarding)\"\n\tping_test_from $h1 192.0.2.255 192.0.2.1\n\tlog_test \"h1 -> net1: reply from r1 (not dropping)\"\n\tping_test_from $h1 255.255.255.255 192.0.2.1\n\tlog_test \"h1 -> 255.255.255.255: reply from r1 (not forwarding)\"\n\n\tping_test_from $h2 192.0.2.255 198.51.100.1\n\tlog_test \"h2 -> net1: reply from r1 (not forwarding)\"\n\tping_test_from $h2 198.51.200.255 198.51.100.1\n\tlog_test \"h2 -> net3: reply from r1 (not forwarding)\"\n\tping_test_from $h2 198.51.100.255 198.51.100.1\n\tlog_test \"h2 -> net2: reply from r1 (not dropping)\"\n\tping_test_from $h2 255.255.255.255 198.51.100.1\n\tlog_test \"h2 -> 255.255.255.255: reply from r1 (not forwarding)\"\n\tbc_forwarding_restore\n\n\tbc_forwarding_enable\n\tlog_info \"bc_forwarding enabled on r1 =>\"\n\tping_test_from $h1 198.51.100.255 198.51.100.2\n\tlog_test \"h1 -> net2: reply from h2 (forwarding)\"\n\tping_test_from $h1 198.51.200.255 198.51.200.2\n\tlog_test \"h1 -> net3: reply from h3 (forwarding)\"\n\tping_test_from $h1 192.0.2.255 192.0.2.1 1\n\tlog_test \"h1 -> net1: no reply (dropping)\"\n\tping_test_from $h1 255.255.255.255 192.0.2.1\n\tlog_test \"h1 -> 255.255.255.255: reply from r1 (not forwarding)\"\n\n\tping_test_from $h2 192.0.2.255 192.0.2.2\n\tlog_test \"h2 -> net1: reply from h1 (forwarding)\"\n\tping_test_from $h2 198.51.200.255 198.51.200.2\n\tlog_test \"h2 -> net3: reply from h3 (forwarding)\"\n\tping_test_from $h2 198.51.100.255 198.51.100.1 1\n\tlog_test \"h2 -> net2: no reply (dropping)\"\n\tping_test_from $h2 255.255.255.255 198.51.100.1\n\tlog_test \"h2 -> 255.255.255.255: reply from r1 (not forwarding)\"\n\tbc_forwarding_restore\n\n\tsysctl_restore net.ipv4.icmp_echo_ignore_broadcasts\n}\n\ntrap cleanup EXIT\n\nsetup_prepare\nsetup_wait\n\ntests_run\n\nexit $EXIT_STATUS\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}