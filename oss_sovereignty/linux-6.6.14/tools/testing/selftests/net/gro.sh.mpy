{
  "module_name": "gro.sh",
  "hash_id": "664c14404e8aa7d6f13074566c85d435326055b422e5df155cffc1a8fc07f617",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/net/gro.sh",
  "human_readable_source": "#!/bin/bash\n# SPDX-License-Identifier: GPL-2.0\n\nreadonly SERVER_MAC=\"aa:00:00:00:00:02\"\nreadonly CLIENT_MAC=\"aa:00:00:00:00:01\"\nreadonly TESTS=(\"data\" \"ack\" \"flags\" \"tcp\" \"ip\" \"large\")\nreadonly PROTOS=(\"ipv4\" \"ipv6\")\ndev=\"\"\ntest=\"all\"\nproto=\"ipv4\"\n\nrun_test() {\n  local server_pid=0\n  local exit_code=0\n  local protocol=$1\n  local test=$2\n  local ARGS=( \"--${protocol}\" \"--dmac\" \"${SERVER_MAC}\" \\\n  \"--smac\" \"${CLIENT_MAC}\" \"--test\" \"${test}\" \"--verbose\" )\n\n  setup_ns\n  # Each test is run 3 times to deflake, because given the receive timing,\n  # not all packets that should coalesce will be considered in the same flow\n  # on every try.\n  for tries in {1..3}; do\n    # Actual test starts here\n    ip netns exec server_ns ./gro \"${ARGS[@]}\" \"--rx\" \"--iface\" \"server\" \\\n      1>>log.txt &\n    server_pid=$!\n    sleep 0.5  # to allow for socket init\n    ip netns exec client_ns ./gro \"${ARGS[@]}\" \"--iface\" \"client\" \\\n      1>>log.txt\n    wait \"${server_pid}\"\n    exit_code=$?\n    if [[ \"${exit_code}\" -eq 0 ]]; then\n        break;\n    fi\n  done\n  cleanup_ns\n  echo ${exit_code}\n}\n\nrun_all_tests() {\n  local failed_tests=()\n  for proto in \"${PROTOS[@]}\"; do\n    for test in \"${TESTS[@]}\"; do\n      echo \"running test ${proto} ${test}\" >&2\n      exit_code=$(run_test $proto $test)\n      if [[ \"${exit_code}\" -ne 0 ]]; then\n        failed_tests+=(\"${proto}_${test}\")\n      fi;\n    done;\n  done\n  if [[ ${#failed_tests[@]} -ne 0 ]]; then\n    echo \"failed tests: ${failed_tests[*]}. \\\n    Please see log.txt for more logs\"\n    exit 1\n  else\n    echo \"All Tests Succeeded!\"\n  fi;\n}\n\nusage() {\n  echo \"Usage: $0 \\\n  [-i <DEV>] \\\n  [-t data|ack|flags|tcp|ip|large] \\\n  [-p <ipv4|ipv6>]\" 1>&2;\n  exit 1;\n}\n\nwhile getopts \"i:t:p:\" opt; do\n  case \"${opt}\" in\n    i)\n      dev=\"${OPTARG}\"\n      ;;\n    t)\n      test=\"${OPTARG}\"\n      ;;\n    p)\n      proto=\"${OPTARG}\"\n      ;;\n    *)\n      usage\n      ;;\n  esac\ndone\n\nif [ -n \"$dev\" ]; then\n\tsource setup_loopback.sh\nelse\n\tsource setup_veth.sh\nfi\n\nsetup\ntrap cleanup EXIT\nif [[ \"${test}\" == \"all\" ]]; then\n  run_all_tests\nelse\n  run_test \"${proto}\" \"${test}\"\nfi;\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}