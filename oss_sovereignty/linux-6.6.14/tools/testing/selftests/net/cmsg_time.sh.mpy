{
  "module_name": "cmsg_time.sh",
  "hash_id": "f54d68fbc86166654caf6951d2009ffda863173c8bc4d544759935025bf8f3c4",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/net/cmsg_time.sh",
  "human_readable_source": "#!/bin/bash\n# SPDX-License-Identifier: GPL-2.0\n\nNS=ns\nIP4=172.16.0.1/24\nTGT4=172.16.0.2\nIP6=2001:db8:1::1/64\nTGT6=2001:db8:1::2\n\ncleanup()\n{\n    ip netns del $NS\n}\n\ntrap cleanup EXIT\n\n# Namespaces\nip netns add $NS\n\nip netns exec $NS sysctl -w net.ipv4.ping_group_range='0 2147483647' > /dev/null\n\n# Connectivity\nip -netns $NS link add type dummy\nip -netns $NS link set dev dummy0 up\nip -netns $NS addr add $IP4 dev dummy0\nip -netns $NS addr add $IP6 dev dummy0\n\n# Need FQ for TXTIME\nip netns exec $NS tc qdisc replace dev dummy0 root fq\n\n# Test\nBAD=0\nTOTAL=0\n\ncheck_result() {\n    ((TOTAL++))\n    if [ $1 -ne 0 ]; then\n\techo \"  Case $4 returned $1, expected 0\"\n\t((BAD++))\n    elif [ \"$2\" != \"$3\" ]; then\n\techo \"  Case $4 returned '$2', expected '$3'\"\n\t((BAD++))\n    fi\n}\n\nfor i in \"-4 $TGT4\" \"-6 $TGT6\"; do\n    for p in u i r; do\n\t[ $p == \"u\" ] && prot=UDPv${i:1:2}\n\t[ $p == \"i\" ] && prot=ICMPv${i:1:2}\n\t[ $p == \"r\" ] && prot=RAWv${i:1:2}\n\n\tts=$(ip netns exec $NS ./cmsg_sender -p $p $i 1234)\n\tcheck_result $? \"$ts\" \"\" \"$prot - no options\"\n\n\tts=$(ip netns exec $NS ./cmsg_sender -p $p $i 1234 -t | wc -l)\n\tcheck_result $? \"$ts\" \"2\" \"$prot - ts cnt\"\n\tts=$(ip netns exec $NS ./cmsg_sender -p $p $i 1234 -t |\n\t\t sed -n \"s/.*SCHED ts0 [0-9].*/OK/p\")\n\tcheck_result $? \"$ts\" \"OK\" \"$prot - ts0 SCHED\"\n\tts=$(ip netns exec $NS ./cmsg_sender -p $p $i 1234 -t |\n\t\t sed -n \"s/.*SND ts0 [0-9].*/OK/p\")\n\tcheck_result $? \"$ts\" \"OK\" \"$prot - ts0 SND\"\n\n\tts=$(ip netns exec $NS ./cmsg_sender -p $p $i 1234 -t -d 1000 |\n\t\t awk '/SND/ { if ($3 > 1000) print \"OK\"; }')\n\tcheck_result $? \"$ts\" \"OK\" \"$prot - TXTIME abs\"\n\n\tts=$(ip netns exec $NS ./cmsg_sender -p $p $i 1234 -t -d 1000 |\n\t\t awk '/SND/ {snd=$3}\n\t\t      /SCHED/ {sch=$3}\n\t\t      END { if (snd - sch > 500) print \"OK\"; }')\n\tcheck_result $? \"$ts\" \"OK\" \"$prot - TXTIME rel\"\n    done\ndone\n\n# Summary\nif [ $BAD -ne 0 ]; then\n    echo \"FAIL - $BAD/$TOTAL cases failed\"\n    exit 1\nelse\n    echo \"OK\"\n    exit 0\nfi\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}