{
  "module_name": "hwtstamp_config.c",
  "hash_id": "3f8e2a0a28cb2651c4484c5310a39414431744396a0626958132a4f1e7e0cee2",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/net/hwtstamp_config.c",
  "human_readable_source": "\n \n\n#include <errno.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n\n#include <sys/socket.h>\n#include <sys/ioctl.h>\n\n#include <linux/if.h>\n#include <linux/net_tstamp.h>\n#include <linux/sockios.h>\n\n#include \"kselftest.h\"\n\nstatic int\nlookup_value(const char **names, int size, const char *name)\n{\n\tint value;\n\n\tfor (value = 0; value < size; value++)\n\t\tif (names[value] && strcasecmp(names[value], name) == 0)\n\t\t\treturn value;\n\n\treturn -1;\n}\n\nstatic const char *\nlookup_name(const char **names, int size, int value)\n{\n\treturn (value >= 0 && value < size) ? names[value] : NULL;\n}\n\nstatic void list_names(FILE *f, const char **names, int size)\n{\n\tint value;\n\n\tfor (value = 0; value < size; value++)\n\t\tif (names[value])\n\t\t\tfprintf(f, \"    %s\\n\", names[value]);\n}\n\nstatic const char *tx_types[] = {\n#define TX_TYPE(name) [HWTSTAMP_TX_ ## name] = #name\n\tTX_TYPE(OFF),\n\tTX_TYPE(ON),\n\tTX_TYPE(ONESTEP_SYNC)\n#undef TX_TYPE\n};\n#define N_TX_TYPES ((int)(ARRAY_SIZE(tx_types)))\n\nstatic const char *rx_filters[] = {\n#define RX_FILTER(name) [HWTSTAMP_FILTER_ ## name] = #name\n\tRX_FILTER(NONE),\n\tRX_FILTER(ALL),\n\tRX_FILTER(SOME),\n\tRX_FILTER(PTP_V1_L4_EVENT),\n\tRX_FILTER(PTP_V1_L4_SYNC),\n\tRX_FILTER(PTP_V1_L4_DELAY_REQ),\n\tRX_FILTER(PTP_V2_L4_EVENT),\n\tRX_FILTER(PTP_V2_L4_SYNC),\n\tRX_FILTER(PTP_V2_L4_DELAY_REQ),\n\tRX_FILTER(PTP_V2_L2_EVENT),\n\tRX_FILTER(PTP_V2_L2_SYNC),\n\tRX_FILTER(PTP_V2_L2_DELAY_REQ),\n\tRX_FILTER(PTP_V2_EVENT),\n\tRX_FILTER(PTP_V2_SYNC),\n\tRX_FILTER(PTP_V2_DELAY_REQ),\n#undef RX_FILTER\n};\n#define N_RX_FILTERS ((int)(ARRAY_SIZE(rx_filters)))\n\nstatic void usage(void)\n{\n\tfputs(\"Usage: hwtstamp_config if_name [tx_type rx_filter]\\n\"\n\t      \"tx_type is any of (case-insensitive):\\n\",\n\t      stderr);\n\tlist_names(stderr, tx_types, N_TX_TYPES);\n\tfputs(\"rx_filter is any of (case-insensitive):\\n\", stderr);\n\tlist_names(stderr, rx_filters, N_RX_FILTERS);\n}\n\nint main(int argc, char **argv)\n{\n\tstruct ifreq ifr;\n\tstruct hwtstamp_config config;\n\tconst char *name;\n\tint sock;\n\n\tif ((argc != 2 && argc != 4) || (strlen(argv[1]) >= IFNAMSIZ)) {\n\t\tusage();\n\t\treturn 2;\n\t}\n\n\tif (argc == 4) {\n\t\tconfig.flags = 0;\n\t\tconfig.tx_type = lookup_value(tx_types, N_TX_TYPES, argv[2]);\n\t\tconfig.rx_filter = lookup_value(rx_filters, N_RX_FILTERS, argv[3]);\n\t\tif (config.tx_type < 0 || config.rx_filter < 0) {\n\t\t\tusage();\n\t\t\treturn 2;\n\t\t}\n\t}\n\n\tsock = socket(AF_INET, SOCK_DGRAM, 0);\n\tif (sock < 0) {\n\t\tperror(\"socket\");\n\t\treturn 1;\n\t}\n\n\tstrcpy(ifr.ifr_name, argv[1]);\n\tifr.ifr_data = (caddr_t)&config;\n\n\tif (ioctl(sock, (argc == 2) ? SIOCGHWTSTAMP : SIOCSHWTSTAMP, &ifr)) {\n\t\tperror(\"ioctl\");\n\t\treturn 1;\n\t}\n\n\tprintf(\"flags = %#x\\n\", config.flags);\n\tname = lookup_name(tx_types, N_TX_TYPES, config.tx_type);\n\tif (name)\n\t\tprintf(\"tx_type = %s\\n\", name);\n\telse\n\t\tprintf(\"tx_type = %d\\n\", config.tx_type);\n\tname = lookup_name(rx_filters, N_RX_FILTERS, config.rx_filter);\n\tif (name)\n\t\tprintf(\"rx_filter = %s\\n\", name);\n\telse\n\t\tprintf(\"rx_filter = %d\\n\", config.rx_filter);\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}