{
  "module_name": "io_uring_zerocopy_tx.sh",
  "hash_id": "2c65f14fdfcf386190b16f547b38727ce64960a7d407bee819732135fa187c6c",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/net/io_uring_zerocopy_tx.sh",
  "human_readable_source": "#!/bin/bash\n#\n# Send data between two processes across namespaces\n# Run twice: once without and once with zerocopy\n\nset -e\n\nreadonly DEV=\"veth0\"\nreadonly DEV_MTU=65535\nreadonly BIN_TX=\"./io_uring_zerocopy_tx\"\nreadonly BIN_RX=\"./msg_zerocopy\"\n\nreadonly RAND=\"$(mktemp -u XXXXXX)\"\nreadonly NSPREFIX=\"ns-${RAND}\"\nreadonly NS1=\"${NSPREFIX}1\"\nreadonly NS2=\"${NSPREFIX}2\"\n\nreadonly SADDR4='192.168.1.1'\nreadonly DADDR4='192.168.1.2'\nreadonly SADDR6='fd::1'\nreadonly DADDR6='fd::2'\n\nreadonly path_sysctl_mem=\"net.core.optmem_max\"\n\n# No arguments: automated test\nif [[ \"$#\" -eq \"0\" ]]; then\n\tIPs=( \"4\" \"6\" )\n\n\tfor IP in \"${IPs[@]}\"; do\n\t\tfor mode in $(seq 1 3); do\n\t\t\t$0 \"$IP\" udp -m \"$mode\" -t 1 -n 32\n\t\t\t$0 \"$IP\" tcp -m \"$mode\" -t 1 -n 1\n\t\tdone\n\tdone\n\n\techo \"OK. All tests passed\"\n\texit 0\nfi\n\n# Argument parsing\nif [[ \"$#\" -lt \"2\" ]]; then\n\techo \"Usage: $0 [4|6] [tcp|udp|raw|raw_hdrincl|packet|packet_dgram] <args>\"\n\texit 1\nfi\n\nreadonly IP=\"$1\"\nshift\nreadonly TXMODE=\"$1\"\nshift\nreadonly EXTRA_ARGS=\"$@\"\n\n# Argument parsing: configure addresses\nif [[ \"${IP}\" == \"4\" ]]; then\n\treadonly SADDR=\"${SADDR4}\"\n\treadonly DADDR=\"${DADDR4}\"\nelif [[ \"${IP}\" == \"6\" ]]; then\n\treadonly SADDR=\"${SADDR6}\"\n\treadonly DADDR=\"${DADDR6}\"\nelse\n\techo \"Invalid IP version ${IP}\"\n\texit 1\nfi\n\n# Argument parsing: select receive mode\n#\n# This differs from send mode for\n# - packet:\tuse raw recv, because packet receives skb clones\n# - raw_hdrinc: use raw recv, because hdrincl is a tx-only option\ncase \"${TXMODE}\" in\n'packet' | 'packet_dgram' | 'raw_hdrincl')\n\tRXMODE='raw'\n\t;;\n*)\n\tRXMODE=\"${TXMODE}\"\n\t;;\nesac\n\n# Start of state changes: install cleanup handler\nsave_sysctl_mem=\"$(sysctl -n ${path_sysctl_mem})\"\n\ncleanup() {\n\tip netns del \"${NS2}\"\n\tip netns del \"${NS1}\"\n\tsysctl -w -q \"${path_sysctl_mem}=${save_sysctl_mem}\"\n}\n\ntrap cleanup EXIT\n\n# Configure system settings\nsysctl -w -q \"${path_sysctl_mem}=1000000\"\n\n# Create virtual ethernet pair between network namespaces\nip netns add \"${NS1}\"\nip netns add \"${NS2}\"\n\nip link add \"${DEV}\" mtu \"${DEV_MTU}\" netns \"${NS1}\" type veth \\\n  peer name \"${DEV}\" mtu \"${DEV_MTU}\" netns \"${NS2}\"\n\n# Bring the devices up\nip -netns \"${NS1}\" link set \"${DEV}\" up\nip -netns \"${NS2}\" link set \"${DEV}\" up\n\n# Set fixed MAC addresses on the devices\nip -netns \"${NS1}\" link set dev \"${DEV}\" address 02:02:02:02:02:02\nip -netns \"${NS2}\" link set dev \"${DEV}\" address 06:06:06:06:06:06\n\n# Add fixed IP addresses to the devices\nip -netns \"${NS1}\" addr add 192.168.1.1/24 dev \"${DEV}\"\nip -netns \"${NS2}\" addr add 192.168.1.2/24 dev \"${DEV}\"\nip -netns \"${NS1}\" addr add       fd::1/64 dev \"${DEV}\" nodad\nip -netns \"${NS2}\" addr add       fd::2/64 dev \"${DEV}\" nodad\n\n# Optionally disable sg or csum offload to test edge cases\n# ip netns exec \"${NS1}\" ethtool -K \"${DEV}\" sg off\n\ndo_test() {\n\tlocal readonly ARGS=\"$1\"\n\n\techo \"ipv${IP} ${TXMODE} ${ARGS}\"\n\tip netns exec \"${NS2}\" \"${BIN_RX}\" \"-${IP}\" -t 2 -C 2 -S \"${SADDR}\" -D \"${DADDR}\" -r \"${RXMODE}\" &\n\tsleep 0.2\n\tip netns exec \"${NS1}\" \"${BIN_TX}\" \"-${IP}\" -t 1 -D \"${DADDR}\" ${ARGS} \"${TXMODE}\"\n\twait\n}\n\ndo_test \"${EXTRA_ARGS}\"\necho ok\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}