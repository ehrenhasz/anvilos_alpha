{
  "module_name": "test_ingress_egress_chaining.sh",
  "hash_id": "08a13dd74b9295ad062be940be2da24634d7ac7e069a04d87bda9ed6a33da59d",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/net/test_ingress_egress_chaining.sh",
  "human_readable_source": "#!/bin/bash\n# SPDX-License-Identifier: GPL-2.0\n\n# This test runs a simple ingress tc setup between two veth pairs,\n# and chains a single egress rule to test ingress chaining to egress.\n#\n# Kselftest framework requirement - SKIP code is 4.\nksft_skip=4\n\nif [ \"$(id -u)\" -ne 0 ];then\n\techo \"SKIP: Need root privileges\"\n\texit $ksft_skip\nfi\n\nneeded_mods=\"act_mirred cls_flower sch_ingress\"\nfor mod in $needed_mods; do\n\tmodinfo $mod &>/dev/null || { echo \"SKIP: Need act_mirred module\"; exit $ksft_skip; }\ndone\n\nns=\"ns$((RANDOM%899+100))\"\nveth1=\"veth1$((RANDOM%899+100))\"\nveth2=\"veth2$((RANDOM%899+100))\"\npeer1=\"peer1$((RANDOM%899+100))\"\npeer2=\"peer2$((RANDOM%899+100))\"\nip_peer1=198.51.100.5\nip_peer2=198.51.100.6\n\nfunction fail() {\n\techo \"FAIL: $@\" >> /dev/stderr\n\texit 1\n}\n\nfunction cleanup() {\n\tkillall -q -9 udpgso_bench_rx\n\tip link del $veth1 &> /dev/null\n\tip link del $veth2 &> /dev/null\n\tip netns del $ns &> /dev/null\n}\ntrap cleanup EXIT\n\nfunction config() {\n\techo \"Setup veth pairs [$veth1, $peer1], and veth pair [$veth2, $peer2]\"\n\tip link add $veth1 type veth peer name $peer1\n\tip link add $veth2 type veth peer name $peer2\n\tip addr add $ip_peer1/24 dev $peer1\n\tip link set $peer1 up\n\tip netns add $ns\n\tip link set dev $peer2 netns $ns\n\tip netns exec $ns ip addr add $ip_peer2/24 dev $peer2\n\tip netns exec $ns ip link set $peer2 up\n\tip link set $veth1 up\n\tip link set $veth2 up\n\n\techo \"Add tc filter ingress->egress forwarding $veth1 <-> $veth2\"\n\ttc qdisc add dev $veth2 ingress\n\ttc qdisc add dev $veth1 ingress\n\ttc filter add dev $veth2 ingress prio 1 proto all flower \\\n\t\taction mirred egress redirect dev $veth1\n\ttc filter add dev $veth1 ingress prio 1 proto all flower \\\n\t\taction mirred egress redirect dev $veth2\n\n\techo \"Add tc filter egress->ingress forwarding $peer1 -> $veth1, bypassing the veth pipe\"\n\ttc qdisc add dev $peer1 clsact\n\ttc filter add dev $peer1 egress prio 20 proto ip flower \\\n\t\taction mirred ingress redirect dev $veth1\n}\n\nfunction test_run() {\n\techo \"Run tcp traffic\"\n\t./udpgso_bench_rx -t &\n\tsleep 1\n\tip netns exec $ns timeout -k 2 10 ./udpgso_bench_tx -t -l 2 -4 -D $ip_peer1 || fail \"traffic failed\"\n\techo \"Test passed\"\n}\n\nconfig\ntest_run\ntrap - EXIT\ncleanup\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}