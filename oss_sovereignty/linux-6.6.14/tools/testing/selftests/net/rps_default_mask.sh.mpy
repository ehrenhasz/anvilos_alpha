{
  "module_name": "rps_default_mask.sh",
  "hash_id": "fd05b018dcb784a5216e2750d18133274626c55f7edc83b74839fb7396784c2b",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/net/rps_default_mask.sh",
  "human_readable_source": "#!/bin/sh\n# SPDX-License-Identifier: GPL-2.0\n\nreadonly ksft_skip=4\nreadonly cpus=$(nproc)\nret=0\n\n[ $cpus -gt 2 ] || exit $ksft_skip\n\nreadonly INITIAL_RPS_DEFAULT_MASK=$(cat /proc/sys/net/core/rps_default_mask)\nreadonly TAG=\"$(mktemp -u XXXXXX)\"\nreadonly VETH=\"veth${TAG}\"\nreadonly NETNS=\"ns-${TAG}\"\n\nsetup() {\n\tip netns add \"${NETNS}\"\n\tip -netns \"${NETNS}\" link set lo up\n}\n\ncleanup() {\n\techo $INITIAL_RPS_DEFAULT_MASK > /proc/sys/net/core/rps_default_mask\n\tip netns del $NETNS\n}\n\nchk_rps() {\n\tlocal rps_mask expected_rps_mask=$4\n\tlocal dev_name=$3\n\tlocal netns=$2\n\tlocal cmd=\"cat\"\n\tlocal msg=$1\n\n\t[ -n \"$netns\" ] && cmd=\"ip netns exec $netns $cmd\"\n\n\trps_mask=$($cmd /sys/class/net/$dev_name/queues/rx-0/rps_cpus)\n\tprintf \"%-60s\" \"$msg\"\n\tif [ $rps_mask -eq $expected_rps_mask ]; then\n\t\techo \"[ ok ]\"\n\telse\n\t\techo \"[fail] expected $expected_rps_mask found $rps_mask\"\n\t\tret=1\n\tfi\n}\n\ntrap cleanup EXIT\n\necho 0 > /proc/sys/net/core/rps_default_mask\nsetup\nchk_rps \"empty rps_default_mask\" $NETNS lo 0\ncleanup\n\necho 1 > /proc/sys/net/core/rps_default_mask\nsetup\nchk_rps \"changing rps_default_mask dont affect existing devices\" \"\" lo $INITIAL_RPS_DEFAULT_MASK\n\necho 3 > /proc/sys/net/core/rps_default_mask\nchk_rps \"changing rps_default_mask dont affect existing netns\" $NETNS lo 0\n\nip link add name $VETH type veth peer netns $NETNS name $VETH\nip link set dev $VETH up\nip -n $NETNS link set dev $VETH up\nchk_rps \"changing rps_default_mask affect newly created devices\" \"\" $VETH 3\nchk_rps \"changing rps_default_mask don't affect newly child netns[II]\" $NETNS $VETH 0\nip link del dev $VETH\nip netns del $NETNS\n\nsetup\nchk_rps \"rps_default_mask is 0 by default in child netns\" \"$NETNS\" lo 0\n\nip netns exec $NETNS sysctl -qw net.core.rps_default_mask=1\nip link add name $VETH type veth peer netns $NETNS name $VETH\nchk_rps \"changing rps_default_mask in child ns don't affect the main one\" \"\" lo $INITIAL_RPS_DEFAULT_MASK\nchk_rps \"changing rps_default_mask in child ns affects new childns devices\" $NETNS $VETH 1\nchk_rps \"changing rps_default_mask in child ns don't affect existing devices\" $NETNS lo 0\n\nexit $ret\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}