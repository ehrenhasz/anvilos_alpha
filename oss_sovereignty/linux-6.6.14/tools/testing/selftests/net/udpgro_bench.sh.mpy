{
  "module_name": "udpgro_bench.sh",
  "hash_id": "b2c2a28b858d8de4b9d78fb1e435f37c3ead4a63543735129eae0b464203e39d",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/net/udpgro_bench.sh",
  "human_readable_source": "#!/bin/bash\n# SPDX-License-Identifier: GPL-2.0\n#\n# Run a series of udpgro benchmarks\n\nreadonly PEER_NS=\"ns-peer-$(mktemp -u XXXXXX)\"\n\nBPF_FILE=\"../bpf/xdp_dummy.bpf.o\"\n\ncleanup() {\n\tlocal -r jobs=\"$(jobs -p)\"\n\tlocal -r ns=\"$(ip netns list|grep $PEER_NS)\"\n\n\t[ -n \"${jobs}\" ] && kill -INT ${jobs} 2>/dev/null\n\t[ -n \"$ns\" ] && ip netns del $ns 2>/dev/null\n}\ntrap cleanup EXIT\n\nrun_one() {\n\t# use 'rx' as separator between sender args and receiver args\n\tlocal -r all=\"$@\"\n\tlocal -r tx_args=${all%rx*}\n\tlocal rx_args=${all#*rx}\n\n\t[[ \"${tx_args}\" == *\"-4\"* ]] && rx_args=\"${rx_args} -4\"\n\n\tip netns add \"${PEER_NS}\"\n\tip -netns \"${PEER_NS}\" link set lo up\n\tip link add type veth\n\tip link set dev veth0 up\n\tip addr add dev veth0 192.168.1.2/24\n\tip addr add dev veth0 2001:db8::2/64 nodad\n\n\tip link set dev veth1 netns \"${PEER_NS}\"\n\tip -netns \"${PEER_NS}\" addr add dev veth1 192.168.1.1/24\n\tip -netns \"${PEER_NS}\" addr add dev veth1 2001:db8::1/64 nodad\n\tip -netns \"${PEER_NS}\" link set dev veth1 up\n\n\tip -n \"${PEER_NS}\" link set veth1 xdp object ${BPF_FILE} section xdp\n\tip netns exec \"${PEER_NS}\" ./udpgso_bench_rx ${rx_args} -r &\n\tip netns exec \"${PEER_NS}\" ./udpgso_bench_rx -t ${rx_args} -r &\n\n\t# Hack: let bg programs complete the startup\n\tsleep 0.2\n\t./udpgso_bench_tx ${tx_args}\n}\n\nrun_in_netns() {\n\tlocal -r args=$@\n\n\t./in_netns.sh $0 __subprocess ${args}\n}\n\nrun_udp() {\n\tlocal -r args=$@\n\n\techo \"udp gso - over veth touching data\"\n\trun_in_netns ${args} -S 0 rx\n\n\techo \"udp gso and gro - over veth touching data\"\n\trun_in_netns ${args} -S 0 rx -G\n}\n\nrun_tcp() {\n\tlocal -r args=$@\n\n\techo \"tcp - over veth touching data\"\n\trun_in_netns ${args} -t rx\n}\n\nrun_all() {\n\tlocal -r core_args=\"-l 4\"\n\tlocal -r ipv4_args=\"${core_args} -4 -D 192.168.1.1\"\n\tlocal -r ipv6_args=\"${core_args} -6 -D 2001:db8::1\"\n\n\techo \"ipv4\"\n\trun_tcp \"${ipv4_args}\"\n\trun_udp \"${ipv4_args}\"\n\n\techo \"ipv6\"\n\trun_tcp \"${ipv4_args}\"\n\trun_udp \"${ipv6_args}\"\n}\n\nif [ ! -f ${BPF_FILE} ]; then\n\techo \"Missing ${BPF_FILE}. Build bpf selftest first\"\n\texit -1\nfi\n\nif [[ $# -eq 0 ]]; then\n\trun_all\nelif [[ $1 == \"__subprocess\" ]]; then\n\tshift\n\trun_one $@\nelse\n\trun_in_netns $@\nfi\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}