{
  "module_name": "cmsg_so_mark.sh",
  "hash_id": "c6beea37c4359d908e6cef6fbda219e164d096e473465a347ef187923230a0e9",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/net/cmsg_so_mark.sh",
  "human_readable_source": "#!/bin/bash\n# SPDX-License-Identifier: GPL-2.0\n\nNS=ns\nIP4=172.16.0.1/24\nTGT4=172.16.0.2\nIP6=2001:db8:1::1/64\nTGT6=2001:db8:1::2\nMARK=1000\n\ncleanup()\n{\n    ip netns del $NS\n}\n\ntrap cleanup EXIT\n\n# Namespaces\nip netns add $NS\n\nip netns exec $NS sysctl -w net.ipv4.ping_group_range='0 2147483647' > /dev/null\n\n# Connectivity\nip -netns $NS link add type dummy\nip -netns $NS link set dev dummy0 up\nip -netns $NS addr add $IP4 dev dummy0\nip -netns $NS addr add $IP6 dev dummy0\n\nip -netns $NS rule add fwmark $MARK lookup 300\nip -6 -netns $NS rule add fwmark $MARK lookup 300\nip -netns $NS route add prohibit any table 300\nip -6 -netns $NS route add prohibit any table 300\n\n# Test\nBAD=0\nTOTAL=0\n\ncheck_result() {\n    ((TOTAL++))\n    if [ $1 -ne $2 ]; then\n\techo \"  Case $3 returned $1, expected $2\"\n\t((BAD++))\n    fi\n}\n\nfor ovr in setsock cmsg both; do\n    for i in 4 6; do\n\t[ $i == 4 ] && TGT=$TGT4 || TGT=$TGT6\n\n\tfor p in u i r; do\n\t    [ $p == \"u\" ] && prot=UDP\n\t    [ $p == \"i\" ] && prot=ICMP\n\t    [ $p == \"r\" ] && prot=RAW\n\n\t    [ $ovr == \"setsock\" ] && m=\"-M\"\n\t    [ $ovr == \"cmsg\" ]    && m=\"-m\"\n\t    [ $ovr == \"both\" ]    && m=\"-M $MARK -m\"\n\n\t    ip netns exec $NS ./cmsg_sender -$i -p $p $m $((MARK + 1)) $TGT 1234\n\t    check_result $? 0 \"$prot $ovr - pass\"\n\n\t    [ $ovr == \"diff\" ] && m=\"-M $((MARK + 1)) -m\"\n\n\t    ip netns exec $NS ./cmsg_sender -$i -p $p $m $MARK -s $TGT 1234\n\t    check_result $? 1 \"$prot $ovr - rejection\"\n\tdone\n    done\ndone\n\n# Summary\nif [ $BAD -ne 0 ]; then\n    echo \"FAIL - $BAD/$TOTAL cases failed\"\n    exit 1\nelse\n    echo \"OK\"\n    exit 0\nfi\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}