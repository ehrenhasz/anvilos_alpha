{
  "module_name": "pm_netlink.sh",
  "hash_id": "f48b5ab4abefd59210643750730adcb0413a2fbbe93b37d78f9590b604612718",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/net/mptcp/pm_netlink.sh",
  "human_readable_source": "#!/bin/bash\n# SPDX-License-Identifier: GPL-2.0\n\n. \"$(dirname \"${0}\")/mptcp_lib.sh\"\n\nksft_skip=4\nret=0\n\nusage() {\n\techo \"Usage: $0 [ -h ]\"\n}\n\n\nwhile getopts \"$optstring\" option;do\n\tcase \"$option\" in\n\t\"h\")\n\t\tusage $0\n\t\texit 0\n\t\t;;\n\t\"?\")\n\t\tusage $0\n\t\texit 1\n\t\t;;\n\tesac\ndone\n\nsec=$(date +%s)\nrndh=$(printf %x $sec)-$(mktemp -u XXXXXX)\nns1=\"ns1-$rndh\"\nerr=$(mktemp)\nret=0\n\ncleanup()\n{\n\trm -f $err\n\tip netns del $ns1\n}\n\nmptcp_lib_check_mptcp\n\nip -Version > /dev/null 2>&1\nif [ $? -ne 0 ];then\n\techo \"SKIP: Could not run test without ip tool\"\n\texit $ksft_skip\nfi\n\ntrap cleanup EXIT\n\nip netns add $ns1 || exit $ksft_skip\nip -net $ns1 link set lo up\nip netns exec $ns1 sysctl -q net.mptcp.enabled=1\n\ncheck()\n{\n\tlocal cmd=\"$1\"\n\tlocal expected=\"$2\"\n\tlocal msg=\"$3\"\n\tlocal out=`$cmd 2>$err`\n\tlocal cmd_ret=$?\n\n\tprintf \"%-50s\" \"$msg\"\n\tif [ $cmd_ret -ne 0 ]; then\n\t\techo \"[FAIL] command execution '$cmd' stderr \"\n\t\tcat $err\n\t\tmptcp_lib_result_fail \"${msg} # error ${cmd_ret}\"\n\t\tret=1\n\telif [ \"$out\" = \"$expected\" ]; then\n\t\techo \"[ OK ]\"\n\t\tmptcp_lib_result_pass \"${msg}\"\n\telse\n\t\techo -n \"[FAIL] \"\n\t\techo \"expected '$expected' got '$out'\"\n\t\tmptcp_lib_result_fail \"${msg} # different output\"\n\t\tret=1\n\tfi\n}\n\ncheck \"ip netns exec $ns1 ./pm_nl_ctl dump\" \"\" \"defaults addr list\"\n\ndefault_limits=\"$(ip netns exec $ns1 ./pm_nl_ctl limits)\"\nif mptcp_lib_expect_all_features; then\n\tcheck \"ip netns exec $ns1 ./pm_nl_ctl limits\" \"accept 0\nsubflows 2\" \"defaults limits\"\nfi\n\nip netns exec $ns1 ./pm_nl_ctl add 10.0.1.1\nip netns exec $ns1 ./pm_nl_ctl add 10.0.1.2 flags subflow dev lo\nip netns exec $ns1 ./pm_nl_ctl add 10.0.1.3 flags signal,backup\ncheck \"ip netns exec $ns1 ./pm_nl_ctl get 1\" \"id 1 flags  10.0.1.1\" \"simple add/get addr\"\n\ncheck \"ip netns exec $ns1 ./pm_nl_ctl dump\" \\\n\"id 1 flags  10.0.1.1\nid 2 flags subflow dev lo 10.0.1.2\nid 3 flags signal,backup 10.0.1.3\" \"dump addrs\"\n\nip netns exec $ns1 ./pm_nl_ctl del 2\ncheck \"ip netns exec $ns1 ./pm_nl_ctl get 2\" \"\" \"simple del addr\"\ncheck \"ip netns exec $ns1 ./pm_nl_ctl dump\" \\\n\"id 1 flags  10.0.1.1\nid 3 flags signal,backup 10.0.1.3\" \"dump addrs after del\"\n\nip netns exec $ns1 ./pm_nl_ctl add 10.0.1.3 2>/dev/null\ncheck \"ip netns exec $ns1 ./pm_nl_ctl get 4\" \"\" \"duplicate addr\"\n\nip netns exec $ns1 ./pm_nl_ctl add 10.0.1.4 flags signal\ncheck \"ip netns exec $ns1 ./pm_nl_ctl get 4\" \"id 4 flags signal 10.0.1.4\" \"id addr increment\"\n\nfor i in `seq 5 9`; do\n\tip netns exec $ns1 ./pm_nl_ctl add 10.0.1.$i flags signal >/dev/null 2>&1\ndone\ncheck \"ip netns exec $ns1 ./pm_nl_ctl get 9\" \"id 9 flags signal 10.0.1.9\" \"hard addr limit\"\ncheck \"ip netns exec $ns1 ./pm_nl_ctl get 10\" \"\" \"above hard addr limit\"\n\nip netns exec $ns1 ./pm_nl_ctl del 9\nfor i in `seq 10 255`; do\n\tip netns exec $ns1 ./pm_nl_ctl add 10.0.0.9 id $i\n\tip netns exec $ns1 ./pm_nl_ctl del $i\ndone\ncheck \"ip netns exec $ns1 ./pm_nl_ctl dump\" \"id 1 flags  10.0.1.1\nid 3 flags signal,backup 10.0.1.3\nid 4 flags signal 10.0.1.4\nid 5 flags signal 10.0.1.5\nid 6 flags signal 10.0.1.6\nid 7 flags signal 10.0.1.7\nid 8 flags signal 10.0.1.8\" \"id limit\"\n\nip netns exec $ns1 ./pm_nl_ctl flush\ncheck \"ip netns exec $ns1 ./pm_nl_ctl dump\" \"\" \"flush addrs\"\n\nip netns exec $ns1 ./pm_nl_ctl limits 9 1 2>/dev/null\ncheck \"ip netns exec $ns1 ./pm_nl_ctl limits\" \"$default_limits\" \"rcv addrs above hard limit\"\n\nip netns exec $ns1 ./pm_nl_ctl limits 1 9 2>/dev/null\ncheck \"ip netns exec $ns1 ./pm_nl_ctl limits\" \"$default_limits\" \"subflows above hard limit\"\n\nip netns exec $ns1 ./pm_nl_ctl limits 8 8\ncheck \"ip netns exec $ns1 ./pm_nl_ctl limits\" \"accept 8\nsubflows 8\" \"set limits\"\n\nip netns exec $ns1 ./pm_nl_ctl flush\nip netns exec $ns1 ./pm_nl_ctl add 10.0.1.1\nip netns exec $ns1 ./pm_nl_ctl add 10.0.1.2\nip netns exec $ns1 ./pm_nl_ctl add 10.0.1.3 id 100\nip netns exec $ns1 ./pm_nl_ctl add 10.0.1.4\nip netns exec $ns1 ./pm_nl_ctl add 10.0.1.5 id 254\nip netns exec $ns1 ./pm_nl_ctl add 10.0.1.6\nip netns exec $ns1 ./pm_nl_ctl add 10.0.1.7\nip netns exec $ns1 ./pm_nl_ctl add 10.0.1.8\ncheck \"ip netns exec $ns1 ./pm_nl_ctl dump\" \"id 1 flags  10.0.1.1\nid 2 flags  10.0.1.2\nid 3 flags  10.0.1.7\nid 4 flags  10.0.1.8\nid 100 flags  10.0.1.3\nid 101 flags  10.0.1.4\nid 254 flags  10.0.1.5\nid 255 flags  10.0.1.6\" \"set ids\"\n\nip netns exec $ns1 ./pm_nl_ctl flush\nip netns exec $ns1 ./pm_nl_ctl add 10.0.0.1\nip netns exec $ns1 ./pm_nl_ctl add 10.0.0.2 id 254\nip netns exec $ns1 ./pm_nl_ctl add 10.0.0.3\nip netns exec $ns1 ./pm_nl_ctl add 10.0.0.4\nip netns exec $ns1 ./pm_nl_ctl add 10.0.0.5 id 253\nip netns exec $ns1 ./pm_nl_ctl add 10.0.0.6\nip netns exec $ns1 ./pm_nl_ctl add 10.0.0.7\nip netns exec $ns1 ./pm_nl_ctl add 10.0.0.8\ncheck \"ip netns exec $ns1 ./pm_nl_ctl dump\" \"id 1 flags  10.0.0.1\nid 2 flags  10.0.0.4\nid 3 flags  10.0.0.6\nid 4 flags  10.0.0.7\nid 5 flags  10.0.0.8\nid 253 flags  10.0.0.5\nid 254 flags  10.0.0.2\nid 255 flags  10.0.0.3\" \"wrap-around ids\"\n\nip netns exec $ns1 ./pm_nl_ctl flush\nip netns exec $ns1 ./pm_nl_ctl add 10.0.1.1 flags subflow\nip netns exec $ns1 ./pm_nl_ctl set 10.0.1.1 flags backup\ncheck \"ip netns exec $ns1 ./pm_nl_ctl dump\" \"id 1 flags \\\nsubflow,backup 10.0.1.1\" \"set flags (backup)\"\nip netns exec $ns1 ./pm_nl_ctl set 10.0.1.1 flags nobackup\ncheck \"ip netns exec $ns1 ./pm_nl_ctl dump\" \"id 1 flags \\\nsubflow 10.0.1.1\" \"          (nobackup)\"\n\n# fullmesh support has been added later\nip netns exec $ns1 ./pm_nl_ctl set id 1 flags fullmesh\nif ip netns exec $ns1 ./pm_nl_ctl dump | grep -q \"fullmesh\" ||\n   mptcp_lib_expect_all_features; then\n\tcheck \"ip netns exec $ns1 ./pm_nl_ctl dump\" \"id 1 flags \\\nsubflow,fullmesh 10.0.1.1\" \"          (fullmesh)\"\n\tip netns exec $ns1 ./pm_nl_ctl set id 1 flags nofullmesh\n\tcheck \"ip netns exec $ns1 ./pm_nl_ctl dump\" \"id 1 flags \\\nsubflow 10.0.1.1\" \"          (nofullmesh)\"\n\tip netns exec $ns1 ./pm_nl_ctl set id 1 flags backup,fullmesh\n\tcheck \"ip netns exec $ns1 ./pm_nl_ctl dump\" \"id 1 flags \\\nsubflow,backup,fullmesh 10.0.1.1\" \"          (backup,fullmesh)\"\nfi\n\nmptcp_lib_result_print_all_tap\nexit $ret\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}