{
  "module_name": "sctp_hello.c",
  "hash_id": "0bc0ccc7c1128de346a1f1361e8440f6634ecb6f22fb2795fdaa6a2e647d1b77",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/net/sctp_hello.c",
  "human_readable_source": "\n\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <netinet/in.h>\n#include <arpa/inet.h>\n\nstatic void set_addr(struct sockaddr_storage *ss, char *ip, char *port, int *len)\n{\n\tif (ss->ss_family == AF_INET) {\n\t\tstruct sockaddr_in *a = (struct sockaddr_in *)ss;\n\n\t\ta->sin_addr.s_addr = inet_addr(ip);\n\t\ta->sin_port = htons(atoi(port));\n\t\t*len = sizeof(*a);\n\t} else {\n\t\tstruct sockaddr_in6 *a = (struct sockaddr_in6 *)ss;\n\n\t\ta->sin6_family = AF_INET6;\n\t\tinet_pton(AF_INET6, ip, &a->sin6_addr);\n\t\ta->sin6_port = htons(atoi(port));\n\t\t*len = sizeof(*a);\n\t}\n}\n\nstatic int do_client(int argc, char *argv[])\n{\n\tstruct sockaddr_storage ss;\n\tchar buf[] = \"hello\";\n\tint csk, ret, len;\n\n\tif (argc < 5) {\n\t\tprintf(\"%s client -4|6 IP PORT [IP PORT]\\n\", argv[0]);\n\t\treturn -1;\n\t}\n\n\tbzero((void *)&ss, sizeof(ss));\n\tss.ss_family = !strcmp(argv[2], \"-4\") ? AF_INET : AF_INET6;\n\tcsk = socket(ss.ss_family, SOCK_STREAM, IPPROTO_SCTP);\n\tif (csk < 0) {\n\t\tprintf(\"failed to create socket\\n\");\n\t\treturn -1;\n\t}\n\n\tif (argc >= 7) {\n\t\tset_addr(&ss, argv[5], argv[6], &len);\n\t\tret = bind(csk, (struct sockaddr *)&ss, len);\n\t\tif (ret < 0) {\n\t\t\tprintf(\"failed to bind to address\\n\");\n\t\t\treturn -1;\n\t\t}\n\t}\n\n\tset_addr(&ss, argv[3], argv[4], &len);\n\tret = connect(csk, (struct sockaddr *)&ss, len);\n\tif (ret < 0) {\n\t\tprintf(\"failed to connect to peer\\n\");\n\t\treturn -1;\n\t}\n\n\tret = send(csk, buf, strlen(buf) + 1, 0);\n\tif (ret < 0) {\n\t\tprintf(\"failed to send msg %d\\n\", ret);\n\t\treturn -1;\n\t}\n\tclose(csk);\n\n\treturn 0;\n}\n\nint main(int argc, char *argv[])\n{\n\tstruct sockaddr_storage ss;\n\tint lsk, csk, ret, len;\n\tchar buf[20];\n\n\tif (argc < 2 || (strcmp(argv[1], \"server\") && strcmp(argv[1], \"client\"))) {\n\t\tprintf(\"%s server|client ...\\n\", argv[0]);\n\t\treturn -1;\n\t}\n\n\tif (!strcmp(argv[1], \"client\"))\n\t\treturn do_client(argc, argv);\n\n\tif (argc < 5) {\n\t\tprintf(\"%s server -4|6 IP PORT [IFACE]\\n\", argv[0]);\n\t\treturn -1;\n\t}\n\n\tss.ss_family = !strcmp(argv[2], \"-4\") ? AF_INET : AF_INET6;\n\tlsk = socket(ss.ss_family, SOCK_STREAM, IPPROTO_SCTP);\n\tif (lsk < 0) {\n\t\tprintf(\"failed to create lsk\\n\");\n\t\treturn -1;\n\t}\n\n\tif (argc >= 6) {\n\t\tret = setsockopt(lsk, SOL_SOCKET, SO_BINDTODEVICE,\n\t\t\t\t argv[5], strlen(argv[5]) + 1);\n\t\tif (ret < 0) {\n\t\t\tprintf(\"failed to bind to device\\n\");\n\t\t\treturn -1;\n\t\t}\n\t}\n\n\tset_addr(&ss, argv[3], argv[4], &len);\n\tret = bind(lsk, (struct sockaddr *)&ss, len);\n\tif (ret < 0) {\n\t\tprintf(\"failed to bind to address\\n\");\n\t\treturn -1;\n\t}\n\n\tret = listen(lsk, 5);\n\tif (ret < 0) {\n\t\tprintf(\"failed to listen on port\\n\");\n\t\treturn -1;\n\t}\n\n\tcsk = accept(lsk, (struct sockaddr *)NULL, (socklen_t *)NULL);\n\tif (csk < 0) {\n\t\tprintf(\"failed to accept new client\\n\");\n\t\treturn -1;\n\t}\n\n\tret = recv(csk, buf, sizeof(buf), 0);\n\tif (ret <= 0) {\n\t\tprintf(\"failed to recv msg %d\\n\", ret);\n\t\treturn -1;\n\t}\n\tclose(csk);\n\tclose(lsk);\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}