{
  "module_name": "kselftest.h",
  "hash_id": "bd9cc8433a60237492125d5448e05d4dba747b28cec9051a6bea44582acc2eac",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/kselftest.h",
  "human_readable_source": " \n \n#ifndef __KSELFTEST_H\n#define __KSELFTEST_H\n\n#ifndef NOLIBC\n#include <errno.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <stdarg.h>\n#include <stdio.h>\n#endif\n\n#ifndef ARRAY_SIZE\n#define ARRAY_SIZE(arr) (sizeof(arr) / sizeof((arr)[0]))\n#endif\n\n \n#ifndef __cpuid_count\n#define __cpuid_count(level, count, a, b, c, d)\t\t\t\t\\\n\t__asm__ __volatile__ (\"cpuid\\n\\t\"\t\t\t\t\\\n\t\t\t      : \"=a\" (a), \"=b\" (b), \"=c\" (c), \"=d\" (d)\t\\\n\t\t\t      : \"0\" (level), \"2\" (count))\n#endif\n\n \n#define KSFT_PASS  0\n#define KSFT_FAIL  1\n#define KSFT_XFAIL 2\n#define KSFT_XPASS 3\n#define KSFT_SKIP  4\n\n \nstruct ksft_count {\n\tunsigned int ksft_pass;\n\tunsigned int ksft_fail;\n\tunsigned int ksft_xfail;\n\tunsigned int ksft_xpass;\n\tunsigned int ksft_xskip;\n\tunsigned int ksft_error;\n};\n\nstatic struct ksft_count ksft_cnt;\nstatic unsigned int ksft_plan;\n\nstatic inline unsigned int ksft_test_num(void)\n{\n\treturn ksft_cnt.ksft_pass + ksft_cnt.ksft_fail +\n\t\tksft_cnt.ksft_xfail + ksft_cnt.ksft_xpass +\n\t\tksft_cnt.ksft_xskip + ksft_cnt.ksft_error;\n}\n\nstatic inline void ksft_inc_pass_cnt(void) { ksft_cnt.ksft_pass++; }\nstatic inline void ksft_inc_fail_cnt(void) { ksft_cnt.ksft_fail++; }\nstatic inline void ksft_inc_xfail_cnt(void) { ksft_cnt.ksft_xfail++; }\nstatic inline void ksft_inc_xpass_cnt(void) { ksft_cnt.ksft_xpass++; }\nstatic inline void ksft_inc_xskip_cnt(void) { ksft_cnt.ksft_xskip++; }\nstatic inline void ksft_inc_error_cnt(void) { ksft_cnt.ksft_error++; }\n\nstatic inline int ksft_get_pass_cnt(void) { return ksft_cnt.ksft_pass; }\nstatic inline int ksft_get_fail_cnt(void) { return ksft_cnt.ksft_fail; }\nstatic inline int ksft_get_xfail_cnt(void) { return ksft_cnt.ksft_xfail; }\nstatic inline int ksft_get_xpass_cnt(void) { return ksft_cnt.ksft_xpass; }\nstatic inline int ksft_get_xskip_cnt(void) { return ksft_cnt.ksft_xskip; }\nstatic inline int ksft_get_error_cnt(void) { return ksft_cnt.ksft_error; }\n\nstatic inline void ksft_print_header(void)\n{\n\t \n\tsetvbuf(stdout, NULL, _IOLBF, 0);\n\n\tif (!(getenv(\"KSFT_TAP_LEVEL\")))\n\t\tprintf(\"TAP version 13\\n\");\n}\n\nstatic inline void ksft_set_plan(unsigned int plan)\n{\n\tksft_plan = plan;\n\tprintf(\"1..%d\\n\", ksft_plan);\n}\n\nstatic inline void ksft_print_cnts(void)\n{\n\tif (ksft_plan != ksft_test_num())\n\t\tprintf(\"# Planned tests != run tests (%u != %u)\\n\",\n\t\t\tksft_plan, ksft_test_num());\n\tprintf(\"# Totals: pass:%d fail:%d xfail:%d xpass:%d skip:%d error:%d\\n\",\n\t\tksft_cnt.ksft_pass, ksft_cnt.ksft_fail,\n\t\tksft_cnt.ksft_xfail, ksft_cnt.ksft_xpass,\n\t\tksft_cnt.ksft_xskip, ksft_cnt.ksft_error);\n}\n\nstatic inline void ksft_print_msg(const char *msg, ...)\n{\n\tint saved_errno = errno;\n\tva_list args;\n\n\tva_start(args, msg);\n\tprintf(\"# \");\n\terrno = saved_errno;\n\tvprintf(msg, args);\n\tva_end(args);\n}\n\nstatic inline void ksft_test_result_pass(const char *msg, ...)\n{\n\tint saved_errno = errno;\n\tva_list args;\n\n\tksft_cnt.ksft_pass++;\n\n\tva_start(args, msg);\n\tprintf(\"ok %d \", ksft_test_num());\n\terrno = saved_errno;\n\tvprintf(msg, args);\n\tva_end(args);\n}\n\nstatic inline void ksft_test_result_fail(const char *msg, ...)\n{\n\tint saved_errno = errno;\n\tva_list args;\n\n\tksft_cnt.ksft_fail++;\n\n\tva_start(args, msg);\n\tprintf(\"not ok %d \", ksft_test_num());\n\terrno = saved_errno;\n\tvprintf(msg, args);\n\tva_end(args);\n}\n\n \n#define ksft_test_result(condition, fmt, ...) do {\t\\\n\tif (!!(condition))\t\t\t\t\\\n\t\tksft_test_result_pass(fmt, ##__VA_ARGS__);\\\n\telse\t\t\t\t\t\t\\\n\t\tksft_test_result_fail(fmt, ##__VA_ARGS__);\\\n\t} while (0)\n\nstatic inline void ksft_test_result_xfail(const char *msg, ...)\n{\n\tint saved_errno = errno;\n\tva_list args;\n\n\tksft_cnt.ksft_xfail++;\n\n\tva_start(args, msg);\n\tprintf(\"ok %d # XFAIL \", ksft_test_num());\n\terrno = saved_errno;\n\tvprintf(msg, args);\n\tva_end(args);\n}\n\nstatic inline void ksft_test_result_skip(const char *msg, ...)\n{\n\tint saved_errno = errno;\n\tva_list args;\n\n\tksft_cnt.ksft_xskip++;\n\n\tva_start(args, msg);\n\tprintf(\"ok %d # SKIP \", ksft_test_num());\n\terrno = saved_errno;\n\tvprintf(msg, args);\n\tva_end(args);\n}\n\n \nstatic inline void ksft_test_result_error(const char *msg, ...)\n{\n\tint saved_errno = errno;\n\tva_list args;\n\n\tksft_cnt.ksft_error++;\n\n\tva_start(args, msg);\n\tprintf(\"not ok %d # error \", ksft_test_num());\n\terrno = saved_errno;\n\tvprintf(msg, args);\n\tva_end(args);\n}\n\nstatic inline int ksft_exit_pass(void)\n{\n\tksft_print_cnts();\n\texit(KSFT_PASS);\n}\n\nstatic inline int ksft_exit_fail(void)\n{\n\tksft_print_cnts();\n\texit(KSFT_FAIL);\n}\n\n \n#define ksft_exit(condition) do {\t\\\n\tif (!!(condition))\t\t\\\n\t\tksft_exit_pass();\t\\\n\telse\t\t\t\t\\\n\t\tksft_exit_fail();\t\\\n\t} while (0)\n\n \n#define ksft_finished()\t\t\t\\\n\tksft_exit(ksft_plan ==\t\t\\\n\t\t  ksft_cnt.ksft_pass +\t\\\n\t\t  ksft_cnt.ksft_xfail +\t\\\n\t\t  ksft_cnt.ksft_xskip)\n\nstatic inline int ksft_exit_fail_msg(const char *msg, ...)\n{\n\tint saved_errno = errno;\n\tva_list args;\n\n\tva_start(args, msg);\n\tprintf(\"Bail out! \");\n\terrno = saved_errno;\n\tvprintf(msg, args);\n\tva_end(args);\n\n\tksft_print_cnts();\n\texit(KSFT_FAIL);\n}\n\nstatic inline int ksft_exit_xfail(void)\n{\n\tksft_print_cnts();\n\texit(KSFT_XFAIL);\n}\n\nstatic inline int ksft_exit_xpass(void)\n{\n\tksft_print_cnts();\n\texit(KSFT_XPASS);\n}\n\nstatic inline int ksft_exit_skip(const char *msg, ...)\n{\n\tint saved_errno = errno;\n\tva_list args;\n\n\tva_start(args, msg);\n\n\t \n\tif (ksft_plan || ksft_test_num()) {\n\t\tksft_cnt.ksft_xskip++;\n\t\tprintf(\"ok %d # SKIP \", 1 + ksft_test_num());\n\t} else {\n\t\tprintf(\"1..0 # SKIP \");\n\t}\n\tif (msg) {\n\t\terrno = saved_errno;\n\t\tvprintf(msg, args);\n\t\tva_end(args);\n\t}\n\tif (ksft_test_num())\n\t\tksft_print_cnts();\n\texit(KSFT_SKIP);\n}\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}