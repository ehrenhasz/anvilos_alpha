{
  "module_name": "run_kselftest.sh",
  "hash_id": "8f3d8471c2abaab0fb223dc5d2dad19b97281cd0c34fe9d0556b943cf970d6ff",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/run_kselftest.sh",
  "human_readable_source": "#!/bin/sh\n# SPDX-License-Identifier: GPL-2.0\n#\n# Run installed kselftest tests.\n#\nBASE_DIR=$(realpath $(dirname $0))\ncd $BASE_DIR\nTESTS=\"$BASE_DIR\"/kselftest-list.txt\nif [ ! -r \"$TESTS\" ] ; then\n\techo \"$0: Could not find list of tests to run ($TESTS)\" >&2\n\tavailable=\"\"\nelse\n\tavailable=\"$(cat \"$TESTS\")\"\nfi\n\n. ./kselftest/runner.sh\nROOT=$PWD\n\nusage()\n{\n\tcat <<EOF\nUsage: $0 [OPTIONS]\n  -s | --summary\t\tPrint summary with detailed log in output.log\n  -t | --test COLLECTION:TEST\tRun TEST from COLLECTION\n  -c | --collection COLLECTION\tRun all tests from COLLECTION\n  -l | --list\t\t\tList the available collection:test entries\n  -d | --dry-run\t\tDon't actually run any tests\n  -h | --help\t\t\tShow this usage info\n  -o | --override-timeout\tNumber of seconds after which we timeout\nEOF\n\texit $1\n}\n\nCOLLECTIONS=\"\"\nTESTS=\"\"\ndryrun=\"\"\nkselftest_override_timeout=\"\"\nwhile true; do\n\tcase \"$1\" in\n\t\t-s | --summary)\n\t\t\tlogfile=\"$BASE_DIR\"/output.log\n\t\t\tcat /dev/null > $logfile\n\t\t\tshift ;;\n\t\t-t | --test)\n\t\t\tTESTS=\"$TESTS $2\"\n\t\t\tshift 2 ;;\n\t\t-c | --collection)\n\t\t\tCOLLECTIONS=\"$COLLECTIONS $2\"\n\t\t\tshift 2 ;;\n\t\t-l | --list)\n\t\t\techo \"$available\"\n\t\t\texit 0 ;;\n\t\t-d | --dry-run)\n\t\t\tdryrun=\"echo\"\n\t\t\tshift ;;\n\t\t-o | --override-timeout)\n\t\t\tkselftest_override_timeout=\"$2\"\n\t\t\tshift 2 ;;\n\t\t-h | --help)\n\t\t\tusage 0 ;;\n\t\t\"\")\n\t\t\tbreak ;;\n\t\t*)\n\t\t\tusage 1 ;;\n\tesac\ndone\n\n# Add all selected collections to the explicit test list.\nif [ -n \"$COLLECTIONS\" ]; then\n\tfor collection in $COLLECTIONS ; do\n\t\tfound=\"$(echo \"$available\" | grep \"^$collection:\")\"\n\t\tif [ -z \"$found\" ] ; then\n\t\t\techo \"No such collection '$collection'\" >&2\n\t\t\texit 1\n\t\tfi\n\t\tTESTS=\"$TESTS $found\"\n\tdone\nfi\n# Replace available test list with explicitly selected tests.\nif [ -n \"$TESTS\" ]; then\n\tvalid=\"\"\n\tfor test in $TESTS ; do\n\t\tfound=\"$(echo \"$available\" | grep \"^${test}$\")\"\n\t\tif [ -z \"$found\" ] ; then\n\t\t\techo \"No such test '$test'\" >&2\n\t\t\texit 1\n\t\tfi\n\t\tvalid=\"$valid $found\"\n\tdone\n\tavailable=\"$(echo \"$valid\" | sed -e 's/ /\\n/g')\"\nfi\n\ncollections=$(echo \"$available\" | cut -d: -f1 | sort | uniq)\nfor collection in $collections ; do\n\t[ -w /dev/kmsg ] && echo \"kselftest: Running tests in $collection\" >> /dev/kmsg\n\ttests=$(echo \"$available\" | grep \"^$collection:\" | cut -d: -f2)\n\t($dryrun cd \"$collection\" && $dryrun run_many $tests)\ndone\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}