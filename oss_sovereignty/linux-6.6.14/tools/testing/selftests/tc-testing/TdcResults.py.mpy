{
  "module_name": "TdcResults.py",
  "hash_id": "6c2b995c310d59ff4d71de47ea27a7b82c03e0412fd258e75aecb3dc1a5c4fad",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/tc-testing/TdcResults.py",
  "human_readable_source": "#!/usr/bin/env python3\n\nfrom enum import Enum\n\nclass ResultState(Enum):\n    noresult = -1\n    skip = 0\n    success = 1\n    fail = 2\n\nclass TestResult:\n    def __init__(self, test_id=\"\", test_name=\"\"):\n       self.test_id = test_id\n       self.test_name = test_name\n       self.result = ResultState.noresult\n       self.failmsg = \"\"\n       self.errormsg = \"\"\n       self.steps = []\n\n    def set_result(self, result):\n        if (isinstance(result, ResultState)):\n            self.result = result\n            return True\n        else:\n            raise TypeError('Unknown result type, must be type ResultState')\n\n    def get_result(self):\n        return self.result\n\n    def set_errormsg(self, errormsg):\n        self.errormsg = errormsg\n        return True\n\n    def append_errormsg(self, errormsg):\n        self.errormsg = '{}\\n{}'.format(self.errormsg, errormsg)\n\n    def get_errormsg(self):\n        return self.errormsg\n\n    def set_failmsg(self, failmsg):\n        self.failmsg = failmsg\n        return True\n\n    def append_failmsg(self, failmsg):\n        self.failmsg = '{}\\n{}'.format(self.failmsg, failmsg)\n\n    def get_failmsg(self):\n        return self.failmsg\n\n    def add_steps(self, newstep):\n        if type(newstep) == list:\n            self.steps.extend(newstep)\n        elif type(newstep) == str:\n            self.steps.append(step)\n        else:\n            raise TypeError('TdcResults.add_steps() requires a list or str')\n\n    def get_executed_steps(self):\n        return self.steps\n\nclass TestSuiteReport():\n    _testsuite = []\n\n    def add_resultdata(self, result_data):\n        if isinstance(result_data, TestResult):\n            self._testsuite.append(result_data)\n            return True\n\n    def count_tests(self):\n        return len(self._testsuite)\n\n    def count_failures(self):\n        return sum(1 for t in self._testsuite if t.result == ResultState.fail)\n\n    def count_skips(self):\n        return sum(1 for t in self._testsuite if t.result == ResultState.skip)\n\n    def find_result(self, test_id):\n        return next((tr for tr in self._testsuite if tr.test_id == test_id), None)\n\n    def update_result(self, result_data):\n        orig = self.find_result(result_data.test_id)\n        if orig != None:\n            idx = self._testsuite.index(orig)\n            self._testsuite[idx] = result_data\n        else:\n            self.add_resultdata(result_data)\n\n    def format_tap(self):\n        ftap = \"\"\n        ftap += '1..{}\\n'.format(self.count_tests())\n        index = 1\n        for t in self._testsuite:\n            if t.result == ResultState.fail:\n                ftap += 'not '\n            ftap += 'ok {} {} - {}'.format(str(index), t.test_id, t.test_name)\n            if t.result == ResultState.skip or t.result == ResultState.noresult:\n                ftap += ' # skipped - {}\\n'.format(t.errormsg)\n            elif t.result == ResultState.fail:\n                if len(t.steps) > 0:\n                    ftap += '\\tCommands executed in this test case:'\n                    for step in t.steps:\n                        ftap += '\\n\\t\\t{}'.format(step)\n                ftap += '\\n\\t{}'.format(t.failmsg)\n            ftap += '\\n'\n            index += 1\n        return ftap\n\n    def format_xunit(self):\n        from xml.sax.saxutils import escape\n        xunit = \"<testsuites>\\n\"\n        xunit += '\\t<testsuite tests=\\\"{}\\\" skips=\\\"{}\\\">\\n'.format(self.count_tests(), self.count_skips())\n        for t in self._testsuite:\n            xunit += '\\t\\t<testcase classname=\\\"{}\\\" '.format(escape(t.test_id))\n            xunit += 'name=\\\"{}\\\">\\n'.format(escape(t.test_name))\n            if t.failmsg:\n                xunit += '\\t\\t\\t<failure>\\n'\n                if len(t.steps) > 0:\n                    xunit += 'Commands executed in this test case:\\n'\n                    for step in t.steps:\n                        xunit += '\\t{}\\n'.format(escape(step))\n                xunit += 'FAILURE: {}\\n'.format(escape(t.failmsg))\n                xunit += '\\t\\t\\t</failure>\\n'\n            if t.errormsg:\n                xunit += '\\t\\t\\t<error>\\n{}\\n'.format(escape(t.errormsg))\n                xunit += '\\t\\t\\t</error>\\n'\n            if t.result == ResultState.skip:\n                xunit += '\\t\\t\\t<skipped/>\\n'\n            xunit += '\\t\\t</testcase>\\n'\n        xunit += '\\t</testsuite>\\n'\n        xunit += '</testsuites>\\n'\n        return xunit\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}