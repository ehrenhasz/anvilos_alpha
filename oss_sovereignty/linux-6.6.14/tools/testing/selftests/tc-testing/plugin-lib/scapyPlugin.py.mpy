{
  "module_name": "scapyPlugin.py",
  "hash_id": "028949826d538b2ce063ea4721d32f1e6cb6d291f9d04b844d6813624e1d7298",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/tc-testing/plugin-lib/scapyPlugin.py",
  "human_readable_source": "#!/usr/bin/env python3\n\nimport os\nimport signal\nfrom string import Template\nimport subprocess\nimport time\nfrom TdcPlugin import TdcPlugin\n\nfrom tdc_config import *\n\ntry:\n    from scapy.all import *\nexcept ImportError:\n    print(\"Unable to import the scapy python module.\")\n    print(\"\\nIf not already installed, you may do so with:\")\n    print(\"\\t\\tpip3 install scapy==2.4.2\")\n    exit(1)\n\nclass SubPlugin(TdcPlugin):\n    def __init__(self):\n        self.sub_class = 'scapy/SubPlugin'\n        super().__init__()\n\n    def post_execute(self):\n        if 'scapy' not in self.args.caseinfo:\n            if self.args.verbose:\n                print('{}.post_execute: no scapy info in test case'.format(self.sub_class))\n            return\n\n        # Check for required fields\n        lscapyinfo = self.args.caseinfo['scapy']\n        if type(lscapyinfo) != list:\n            lscapyinfo = [ lscapyinfo, ]\n\n        for scapyinfo in lscapyinfo:\n            scapy_keys = ['iface', 'count', 'packet']\n            missing_keys = []\n            keyfail = False\n            for k in scapy_keys:\n                if k not in scapyinfo:\n                    keyfail = True\n                    missing_keys.append(k)\n            if keyfail:\n                print('{}: Scapy block present in the test, but is missing info:'\n                    .format(self.sub_class))\n                print('{}'.format(missing_keys))\n\n            pkt = eval(scapyinfo['packet'])\n            if '$' in scapyinfo['iface']:\n                tpl = Template(scapyinfo['iface'])\n                scapyinfo['iface'] = tpl.safe_substitute(NAMES)\n            for count in range(scapyinfo['count']):\n                sendp(pkt, iface=scapyinfo['iface'])\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}