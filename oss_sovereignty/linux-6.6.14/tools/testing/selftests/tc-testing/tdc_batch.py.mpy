{
  "module_name": "tdc_batch.py",
  "hash_id": "7de57ed23e0448b52c41f93c987c10c57dddca56b220aac26164ee36afe88961",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/tc-testing/tdc_batch.py",
  "human_readable_source": "#!/usr/bin/env python3\n\n\"\"\"\ntdc_batch.py - a script to generate TC batch file\n\nCopyright (C) 2017 Chris Mi <chrism@mellanox.com>\n\"\"\"\n\nimport argparse\n\nparser = argparse.ArgumentParser(description='TC batch file generator')\nparser.add_argument(\"device\", help=\"device name\")\nparser.add_argument(\"file\", help=\"batch file name\")\nparser.add_argument(\"-n\", \"--number\", type=int,\n                    help=\"how many lines in batch file\")\nparser.add_argument(\n    \"-a\",\n    \"--handle_start\",\n    type=int,\n    default=1,\n    help=\"start handle range from (default: 1)\")\nparser.add_argument(\"-o\", \"--skip_sw\",\n                    help=\"skip_sw (offload), by default skip_hw\",\n                    action=\"store_true\")\nparser.add_argument(\"-s\", \"--share_action\",\n                    help=\"all filters share the same action\",\n                    action=\"store_true\")\nparser.add_argument(\"-p\", \"--prio\",\n                    help=\"all filters have different prio\",\n                    action=\"store_true\")\nparser.add_argument(\n    \"-e\",\n    \"--operation\",\n    choices=['add', 'del', 'replace'],\n    default='add',\n    help=\"operation to perform on filters\"\n    \"(default: add filter)\")\nparser.add_argument(\n    \"-m\",\n    \"--mac_prefix\",\n    type=int,\n    default=0,\n    choices=range(0, 256),\n    help=\"third byte of source MAC address of flower filter\"\n    \"(default: 0)\")\nargs = parser.parse_args()\n\ndevice = args.device\nfile = open(args.file, 'w')\n\nnumber = 1\nif args.number:\n    number = args.number\n\nhandle_start = args.handle_start\n\nskip = \"skip_hw\"\nif args.skip_sw:\n    skip = \"skip_sw\"\n\nshare_action = \"\"\nif args.share_action:\n    share_action = \"index 1\"\n\nprio = \"prio 1\"\nif args.prio:\n    prio = \"\"\n    if number > 0x4000:\n        number = 0x4000\n\nmac_prefix = args.mac_prefix\n\ndef format_add_filter(device, prio, handle, skip, src_mac, dst_mac,\n                      share_action):\n    return (\"filter add dev {} {} protocol ip ingress handle {} \"\n            \" flower {} src_mac {} dst_mac {} action drop {}\".format(\n                device, prio, handle, skip, src_mac, dst_mac, share_action))\n\n\ndef format_rep_filter(device, prio, handle, skip, src_mac, dst_mac,\n                      share_action):\n    return (\"filter replace dev {} {} protocol ip ingress handle {} \"\n            \" flower {} src_mac {} dst_mac {} action drop {}\".format(\n                device, prio, handle, skip, src_mac, dst_mac, share_action))\n\n\ndef format_del_filter(device, prio, handle, skip, src_mac, dst_mac,\n                      share_action):\n    return (\"filter del dev {} {} protocol ip ingress handle {} \"\n            \"flower\".format(device, prio, handle))\n\n\nformatter = format_add_filter\nif args.operation == \"del\":\n    formatter = format_del_filter\nelif args.operation == \"replace\":\n    formatter = format_rep_filter\n\nindex = 0\nfor i in range(0x100):\n    for j in range(0x100):\n        for k in range(0x100):\n            mac = (\"{:02x}:{:02x}:{:02x}\".format(i, j, k))\n            src_mac = \"e4:11:{:02x}:{}\".format(mac_prefix, mac)\n            dst_mac = \"e4:12:00:\" + mac\n            cmd = formatter(device, prio, handle_start + index, skip, src_mac,\n                            dst_mac, share_action)\n            file.write(\"{}\\n\".format(cmd))\n            index += 1\n            if index >= number:\n                file.close()\n                exit(0)\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}