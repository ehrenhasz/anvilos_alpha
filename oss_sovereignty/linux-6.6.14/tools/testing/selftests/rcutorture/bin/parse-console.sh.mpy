{
  "module_name": "parse-console.sh",
  "hash_id": "6d22822bb27dd6b17307c207f612fcfb6b5e38b447bf50d906a6c7072fab5497",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/rcutorture/bin/parse-console.sh",
  "human_readable_source": "#!/bin/bash\n# SPDX-License-Identifier: GPL-2.0+\n#\n# Check the console output from an rcutorture run for oopses.\n# The \"file\" is a pathname on the local system, and \"title\" is\n# a text string for error-message purposes.\n#\n# Usage: parse-console.sh file title\n#\n# Copyright (C) IBM Corporation, 2011\n#\n# Authors: Paul E. McKenney <paulmck@linux.ibm.com>\n\nT=${TMPDIR-/tmp}/parse-console.sh.$$\nfile=\"$1\"\ntitle=\"$2\"\n\ntrap 'rm -f $T.seq $T.diags' 0\n\n. functions.sh\n\n# Check for presence and readability of console output file\nif test -f \"$file\" -a -r \"$file\"\nthen\n\t:\nelse\n\techo $title unreadable console output file: $file\n\texit 1\nfi\nif grep -Pq '\\x00' < $file\nthen\n\tprint_warning Console output contains nul bytes, old qemu still running?\nfi\ncat /dev/null > $file.diags\n\n# Check for proper termination, except for rcuscale and refscale.\nif test \"$TORTURE_SUITE\" != rcuscale && test \"$TORTURE_SUITE\" != refscale\nthen\n\t# check for abject failure\n\n\tif grep -q FAILURE $file || grep -q -e '-torture.*!!!' $file\n\tthen\n\t\tnerrs=`grep --binary-files=text '!!!' $file |\n\t\ttail -1 |\n\t\tawk '\n\t\t{\n\t\t\tnormalexit = 1;\n\t\t\tfor (i=NF-8;i<=NF;i++) {\n\t\t\t\tif (i <= 0 || i !~ /^[0-9]*$/) {\n\t\t\t\t\tbangstring = $0;\n\t\t\t\t\tgsub(/^\\[[^]]*] /, \"\", bangstring);\n\t\t\t\t\tprint bangstring;\n\t\t\t\t\tnormalexit = 0;\n\t\t\t\t\texit 0;\n\t\t\t\t}\n\t\t\t\tsum+=$i;\n\t\t\t}\n\t\t}\n\t\tEND {\n\t\t\tif (normalexit)\n\t\t\t\tprint sum \" instances\"\n\t\t}'`\n\t\tprint_bug $title FAILURE, $nerrs\n\t\texit\n\tfi\n\n\tgrep --binary-files=text 'torture:.*ver:' $file |\n\tgrep -E --binary-files=text -v '\\(null\\)|rtc: 000000000* ' |\n\tsed -e 's/^(initramfs)[^]]*] //' -e 's/^\\[[^]]*] //' |\n\tsed -e 's/^.*ver: //' |\n\tawk '\n\tBEGIN\t{\n\t\tver = 0;\n\t\tbadseq = 0;\n\t\t}\n\n\t\t{\n\t\tif (!badseq && ($1 + 0 != $1 || $1 <= ver)) {\n\t\t\tbadseqno1 = ver;\n\t\t\tbadseqno2 = $1;\n\t\t\tbadseqnr = NR;\n\t\t\tbadseq = 1;\n\t\t}\n\t\tver = $1\n\t\t}\n\n\tEND\t{\n\t\tif (badseq) {\n\t\t\tif (badseqno1 == badseqno2 && badseqno2 == ver)\n\t\t\t\tprint \"GP HANG at \" ver \" torture stat \" badseqnr;\n\t\t\telse\n\t\t\t\tprint \"BAD SEQ \" badseqno1 \":\" badseqno2 \" last:\" ver \" version \" badseqnr;\n\t\t}\n\t\t}' > $T.seq\n\n\tif grep -q SUCCESS $file\n\tthen\n\t\tif test -s $T.seq\n\t\tthen\n\t\t\tprint_warning $title `cat $T.seq`\n\t\t\techo \"   \" $file\n\t\t\texit 2\n\t\tfi\n\telse\n\t\tif grep -q \"_HOTPLUG:\" $file\n\t\tthen\n\t\t\tprint_warning HOTPLUG FAILURES $title `cat $T.seq`\n\t\t\techo \"   \" $file\n\t\t\texit 3\n\t\tfi\n\t\techo $title no success message, `grep --binary-files=text 'ver:' $file | wc -l` successful version messages\n\t\tif test -s $T.seq\n\t\tthen\n\t\t\tprint_warning $title `cat $T.seq`\n\t\tfi\n\t\texit 2\n\tfi\nfi | tee -a $file.diags\n\nconsole-badness.sh < $file > $T.diags\nif test -s $T.diags\nthen\n\tprint_warning \"Assertion failure in $file $title\"\n\t# cat $T.diags\n\tsummary=\"\"\n\tn_badness=`grep -c Badness $file`\n\tif test \"$n_badness\" -ne 0\n\tthen\n\t\tsummary=\"$summary  Badness: $n_badness\"\n\tfi\n\tn_warn=`grep -v 'Warning: unable to open an initial console' $file | grep -v 'Warning: Failed to add ttynull console. No stdin, stdout, and stderr for the init process' | grep -E -c 'WARNING:|Warn'`\n\tif test \"$n_warn\" -ne 0\n\tthen\n\t\tsummary=\"$summary  Warnings: $n_warn\"\n\tfi\n\tn_bugs=`grep -E -c '\\bBUG|Oops:' $file`\n\tif test \"$n_bugs\" -ne 0\n\tthen\n\t\tsummary=\"$summary  Bugs: $n_bugs\"\n\tfi\n\tn_kcsan=`grep -E -c 'BUG: KCSAN: ' $file`\n\tif test \"$n_kcsan\" -ne 0\n\tthen\n\t\tif test \"$n_bugs\" = \"$n_kcsan\"\n\t\tthen\n\t\t\tsummary=\"$summary (all bugs kcsan)\"\n\t\telse\n\t\t\tsummary=\"$summary  KCSAN: $n_kcsan\"\n\t\tfi\n\tfi\n\tn_calltrace=`grep -c 'Call Trace:' $file`\n\tif test \"$n_calltrace\" -ne 0\n\tthen\n\t\tsummary=\"$summary  Call Traces: $n_calltrace\"\n\tfi\n\tn_lockdep=`grep -c =========== $file`\n\tif test \"$n_badness\" -ne 0\n\tthen\n\t\tsummary=\"$summary  lockdep: $n_badness\"\n\tfi\n\tn_stalls=`grep -E -c 'detected stalls on CPUs/tasks:|self-detected stall on CPU|Stall ended before state dump start|\\?\\?\\? Writer stall state' $file`\n\tif test \"$n_stalls\" -ne 0\n\tthen\n\t\tsummary=\"$summary  Stalls: $n_stalls\"\n\tfi\n\tn_starves=`grep -c 'rcu_.*kthread starved for' $file`\n\tif test \"$n_starves\" -ne 0\n\tthen\n\t\tsummary=\"$summary  Starves: $n_starves\"\n\tfi\n\tprint_warning Summary: $summary\n\tcat $T.diags >> $file.diags\nfi\nfor i in $file.*.diags\ndo\n\tif test -f \"$i\"\n\tthen\n\t\tcat $i >> $file.diags\n\tfi\ndone\nif ! test -s $file.diags\nthen\n\trm -f $file.diags\nfi\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}