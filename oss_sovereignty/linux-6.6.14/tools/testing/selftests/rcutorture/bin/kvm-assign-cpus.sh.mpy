{
  "module_name": "kvm-assign-cpus.sh",
  "hash_id": "66eb75bb2386c7c69f545bb4f2f0291cab5338c6d7b25aa083e8ff6f1cb72b30",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/rcutorture/bin/kvm-assign-cpus.sh",
  "human_readable_source": "#!/bin/sh\n# SPDX-License-Identifier: GPL-2.0+\n#\n# Produce awk statements roughly depicting the system's CPU and cache\n# layout.  If the required information is not available, produce\n# error messages as awk comments.  Successful exit regardless.\n#\n# Usage: kvm-assign-cpus.sh /path/to/sysfs\n\nT=\"`mktemp -d ${TMPDIR-/tmp}/kvm-assign-cpus.sh.XXXXXX`\"\ntrap 'rm -rf $T' 0 2\n\nsysfsdir=${1-/sys/devices/system/node}\nif ! cd \"$sysfsdir\" > $T/msg 2>&1\nthen\n\tsed -e 's/^/# /' < $T/msg\n\texit 0\nfi\nnodelist=\"`ls -d node*`\"\nfor i in node*\ndo\n\tif ! test -d $i/\n\tthen\n\t\techo \"# Not a directory: $sysfsdir/node*\"\n\t\texit 0\n\tfi\n\tfor j in $i/cpu*/cache/index*\n\tdo\n\t\tif ! test -d $j/\n\t\tthen\n\t\t\techo \"# Not a directory: $sysfsdir/$j\"\n\t\t\texit 0\n\t\telse\n\t\t\tbreak\n\t\tfi\n\tdone\n\tindexlist=\"`ls -d $i/cpu* | grep 'cpu[0-9][0-9]*' | head -1 | sed -e 's,^.*$,ls -d &/cache/index*,' | sh | sed -e 's,^.*/,,'`\"\n\tbreak\ndone\nfor i in node*/cpu*/cache/index*/shared_cpu_list\ndo\n\tif ! test -f $i\n\tthen\n\t\techo \"# Not a file: $sysfsdir/$i\"\n\t\texit 0\n\telse\n\t\tbreak\n\tfi\ndone\nfirstshared=\nfor i in $indexlist\ndo\n\trm -f $T/cpulist\n\tfor n in node*\n\tdo\n\t\tf=\"$n/cpu*/cache/$i/shared_cpu_list\"\n\t\tif ! cat $f > $T/msg 2>&1\n\t\tthen\n\t\t\tsed -e 's/^/# /' < $T/msg\n\t\t\texit 0\n\t\tfi\n\t\tcat $f >> $T/cpulist\n\tdone\n\tif grep -q '[-,]' $T/cpulist\n\tthen\n\t\tif test -z \"$firstshared\"\n\t\tthen\n\t\t\tfirstshared=\"$i\"\n\t\tfi\n\tfi\ndone\nif test -z \"$firstshared\"\nthen\n\tsplitindex=\"`echo $indexlist | sed -e 's/ .*$//'`\"\nelse\n\tsplitindex=\"$firstshared\"\nfi\nnodenum=0\nfor n in node*\ndo\n\tcat $n/cpu*/cache/$splitindex/shared_cpu_list | sort -u -k1n |\n\tawk -v nodenum=\"$nodenum\" '\n\tBEGIN {\n\t\tidx = 0;\n\t}\n\n\t{\n\t\tnlists = split($0, cpulists, \",\");\n\t\tfor (i = 1; i <= nlists; i++) {\n\t\t\tlistsize = split(cpulists[i], cpus, \"-\");\n\t\t\tif (listsize == 1)\n\t\t\t\tcpus[2] = cpus[1];\n\t\t\tfor (j = cpus[1]; j <= cpus[2]; j++) {\n\t\t\t\tprint \"cpu[\" nodenum \"][\" idx \"] = \" j \";\";\n\t\t\t\tidx++;\n\t\t\t}\n\t\t}\n\t}\n\n\tEND {\n\t\tprint \"nodecpus[\" nodenum \"] = \" idx \";\";\n\t}'\n\tnodenum=`expr $nodenum + 1`\ndone\necho \"numnodes = $nodenum;\"\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}