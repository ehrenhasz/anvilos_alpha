{
  "module_name": "kvm-recheck-rcuscale.sh",
  "hash_id": "baa0194d0628ba5d508b885cb7ee263b18277bee32d61d242c86ebb30b91da75",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/rcutorture/bin/kvm-recheck-rcuscale.sh",
  "human_readable_source": "#!/bin/bash\n# SPDX-License-Identifier: GPL-2.0+\n#\n# Analyze a given results directory for rcuscale scalability measurements.\n#\n# Usage: kvm-recheck-rcuscale.sh resdir\n#\n# Copyright (C) IBM Corporation, 2016\n#\n# Authors: Paul E. McKenney <paulmck@linux.ibm.com>\n\ni=\"$1\"\nif test -d \"$i\" -a -r \"$i\"\nthen\n\t:\nelse\n\techo Unreadable results directory: $i\n\texit 1\nfi\nPATH=`pwd`/tools/testing/selftests/rcutorture/bin:$PATH; export PATH\n. functions.sh\n\nif kvm-recheck-rcuscale-ftrace.sh $i\nthen\n\t# ftrace data was successfully analyzed, call it good!\n\texit 0\nfi\n\nconfigfile=`echo $i | sed -e 's/^.*\\///'`\n\nsed -e 's/^\\[[^]]*]//' < $i/console.log |\nawk '\n/-scale: .* gps: .* batches:/ {\n\tngps = $9;\n\tnbatches = 1;\n}\n\n/-scale: .*writer-duration/ {\n\tgptimes[++n] = $5 / 1000.;\n\tsum += $5 / 1000.;\n}\n\n/rcu_scale: Grace-period kthread CPU time/ {\n\tcputime = $6;\n}\n\nEND {\n\tnewNR = asort(gptimes);\n\tif (newNR <= 0) {\n\t\tprint \"No rcuscale records found???\"\n\t\texit;\n\t}\n\tpct50 = int(newNR * 50 / 100);\n\tif (pct50 < 1)\n\t\tpct50 = 1;\n\tpct90 = int(newNR * 90 / 100);\n\tif (pct90 < 1)\n\t\tpct90 = 1;\n\tpct99 = int(newNR * 99 / 100);\n\tif (pct99 < 1)\n\t\tpct99 = 1;\n\tdiv = 10 ** int(log(gptimes[pct90]) / log(10) + .5) / 100;\n\tprint \"Histogram bucket size: \" div;\n\tlast = gptimes[1] - 10;\n\tcount = 0;\n\tfor (i = 1; i <= newNR; i++) {\n\t\tcurrent = div * int(gptimes[i] / div);\n\t\tif (last == current) {\n\t\t\tcount++;\n\t\t} else {\n\t\t\tif (count > 0)\n\t\t\t\tprint last, count;\n\t\t\tcount = 1;\n\t\t\tlast = current;\n\t\t}\n\t}\n\tif (count > 0)\n\t\tprint last, count;\n\tprint \"Average grace-period duration: \" sum / newNR \" microseconds\";\n\tprint \"Minimum grace-period duration: \" gptimes[1];\n\tprint \"50th percentile grace-period duration: \" gptimes[pct50];\n\tprint \"90th percentile grace-period duration: \" gptimes[pct90];\n\tprint \"99th percentile grace-period duration: \" gptimes[pct99];\n\tprint \"Maximum grace-period duration: \" gptimes[newNR];\n\tif (cputime != \"\")\n\t\tcpustr = \" CPU: \" cputime;\n\tprint \"Grace periods: \" ngps + 0 \" Batches: \" nbatches + 0 \" Ratio: \" ngps / nbatches cpustr;\n\tprint \"Computed from rcuscale printk output.\";\n}'\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}