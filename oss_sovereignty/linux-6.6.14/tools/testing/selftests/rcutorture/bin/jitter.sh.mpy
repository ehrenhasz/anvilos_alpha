{
  "module_name": "jitter.sh",
  "hash_id": "0c77738d8652220a004b2c8fe99416ac675d6aa3e664594e71c281e2417a5341",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/rcutorture/bin/jitter.sh",
  "human_readable_source": "#!/bin/bash\n# SPDX-License-Identifier: GPL-2.0+\n#\n# Alternate sleeping and spinning on randomly selected CPUs.  The purpose\n# of this script is to inflict random OS jitter on a concurrently running\n# test.\n#\n# Usage: jitter.sh me jittering-path duration [ sleepmax [ spinmax ] ]\n#\n# me: Random-number-generator seed salt.\n# duration: Time to run in seconds.\n# jittering-path: Path to file whose removal will stop this script.\n# sleepmax: Maximum microseconds to sleep, defaults to one second.\n# spinmax: Maximum microseconds to spin, defaults to one millisecond.\n#\n# Copyright (C) IBM Corporation, 2016\n#\n# Authors: Paul E. McKenney <paulmck@linux.ibm.com>\n\nme=$(($1 * 1000))\njittering=$2\nduration=$3\nsleepmax=${4-1000000}\nspinmax=${5-1000}\n\nn=1\n\nstarttime=`gawk 'BEGIN { print systime(); }' < /dev/null`\n\nnohotplugcpus=\nfor i in /sys/devices/system/cpu/cpu[0-9]*\ndo\n\tif test -f $i/online\n\tthen\n\t\t:\n\telse\n\t\tcurcpu=`echo $i | sed -e 's/^[^0-9]*//'`\n\t\tnohotplugcpus=\"$nohotplugcpus $curcpu\"\n\tfi\ndone\n\nwhile :\ndo\n\t# Check for done.\n\tt=`gawk -v s=$starttime 'BEGIN { print systime() - s; }' < /dev/null`\n\tif test \"$t\" -gt \"$duration\"\n\tthen\n\t\texit 0;\n\tfi\n\n\t# Check for stop request.\n\tif ! test -f \"$jittering\"\n\tthen\n\t\texit 1;\n\tfi\n\n\t# Set affinity to randomly selected online CPU\n\tif cpus=`grep 1 /sys/devices/system/cpu/*/online 2>&1 |\n\t\t sed -e 's,/[^/]*$,,' -e 's/^[^0-9]*//'`\n\tthen\n\t\t:\n\telse\n\t\tcpus=\n\tfi\n\t# Do not leave out non-hot-pluggable CPUs\n\tcpus=\"$cpus $nohotplugcpus\"\n\n\tcpumask=`awk -v cpus=\"$cpus\" -v me=$me -v n=$n 'BEGIN {\n\t\tsrand(n + me + systime());\n\t\tncpus = split(cpus, ca);\n\t\tprint ca[int(rand() * ncpus + 1)];\n\t}' < /dev/null`\n\tn=$(($n+1))\n\tif ! taskset -c -p $cpumask $$ > /dev/null 2>&1\n\tthen\n\t\techo taskset failure: '\"taskset -c -p ' $cpumask $$ '\"'\n\t\texit 1\n\tfi\n\n\t# Sleep a random duration\n\tsleeptime=`awk -v me=$me -v n=$n -v sleepmax=$sleepmax 'BEGIN {\n\t\tsrand(n + me + systime());\n\t\tprintf(\"%06d\", int(rand() * sleepmax));\n\t}' < /dev/null`\n\tn=$(($n+1))\n\tsleep .$sleeptime\n\n\t# Spin a random duration\n\tlimit=`awk -v me=$me -v n=$n -v spinmax=$spinmax 'BEGIN {\n\t\tsrand(n + me + systime());\n\t\tprintf(\"%06d\", int(rand() * spinmax));\n\t}' < /dev/null`\n\tn=$(($n+1))\n\tfor i in {1..$limit}\n\tdo\n\t\techo > /dev/null\n\tdone\ndone\n\nexit 1\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}