{
  "module_name": "tm-poison.c",
  "hash_id": "9aa6bdab044b3f6f288652180869d55b7105886d9cb5bef8ba83cc9a98344fae",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/powerpc/tm/tm-poison.c",
  "human_readable_source": "\n \n\n#define _GNU_SOURCE\n#include <stdio.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <inttypes.h>\n#include <sched.h>\n#include <sys/types.h>\n#include <signal.h>\n\n#include \"tm.h\"\n\nint tm_poison_test(void)\n{\n\tint cpu, pid;\n\tcpu_set_t cpuset;\n\tuint64_t poison = 0xdeadbeefc0dec0fe;\n\tuint64_t unknown = 0;\n\tbool fail_fp = false;\n\tbool fail_vr = false;\n\n\tSKIP_IF(!have_htm());\n\tSKIP_IF(htm_is_synthetic());\n\n\tcpu = pick_online_cpu();\n\tFAIL_IF(cpu < 0);\n\n\t \n\tCPU_ZERO(&cpuset);\n\tCPU_SET(cpu, &cpuset);\n\tFAIL_IF(sched_setaffinity(0, sizeof(cpuset), &cpuset) != 0);\n\n\tpid = fork();\n\tif (!pid) {\n\t\t \n\t\twhile (1) {\n\t\t\tsched_yield();\n\t\t\tasm (\n\t\t\t\t\"mtvsrd 31, %[poison];\"  \n\t\t\t\t\"mtvsrd 63, %[poison];\"  \n\n\t\t\t\t: : [poison] \"r\" (poison) : );\n\t\t}\n\t}\n\n\t \n\tasm (\n\t\t \n\t\t\"       li      3, 0x1          ;\"\n\t\t\"       li      4, 0x1          ;\"\n\t\t\"       mtvsrd  31, 4           ;\"\n\n\t\t \n\t\t\"       lis     5, 14           ;\"\n\t\t\"       ori     5, 5, 19996     ;\"\n\t\t\"       sldi    5, 5, 16        ;\"  \n\n\t\t\"       mfspr   6, 268          ;\"  \n\t\t\"1:     mfspr   7, 268          ;\"  \n\t\t\"       subf    7, 6, 7         ;\"  \n\t\t\"       cmpd    7, 5            ;\"\n\t\t\"       bgt     3f              ;\"  \n\n\t\t \n\t\t\"       tbegin.                 ;\"  \n\t\t\"       beq     1b              ;\"  \n\t\t\"       mfvsrd  3, 31           ;\"  \n\t\t\"       cmpd    3, 4            ;\"  \n\t\t\"       bne     2f              ;\"  \n\t\t\"       tabort. 3               ;\"  \n\t\t\"2:     tend.                   ;\"  \n\t\t\"3:     mr    %[unknown], 3     ;\"  \n\n\t\t: [unknown] \"=r\" (unknown)\n\t\t:\n\t\t: \"cr0\", \"r3\", \"r4\", \"r5\", \"r6\", \"r7\", \"vs31\"\n\n\t\t);\n\n\t \n\tfail_fp = unknown != 0x1;\n\tif (fail_fp)\n\t\tprintf(\"Unknown value %#\"PRIx64\" leaked into f31!\\n\", unknown);\n\telse\n\t\tprintf(\"Good, no poison or leaked value into FP registers\\n\");\n\n\tasm (\n\t\t \n\t\t\"       li      3, 0x1          ;\"\n\t\t\"       li      4, 0x1          ;\"\n\t\t\"       mtvsrd  63, 4           ;\"\n\n\t\t\"       lis     5, 14           ;\"\n\t\t\"       ori     5, 5, 19996     ;\"\n\t\t\"       sldi    5, 5, 16        ;\" \n\n\t\t\"       mfspr   6, 268          ;\" \n\t\t\"1:     mfspr   7, 268          ;\" \n\t\t\"       subf    7, 6, 7         ;\" \n\t\t\"       cmpd    7, 5            ;\"\n\t\t\"       bgt     3f              ;\" \n\n\t\t \n\t\t\"       tbegin.                 ;\" \n\t\t\"       beq     1b              ;\" \n\t\t\"       mfvsrd  3, 63           ;\" \n\t\t\"       cmpd    3, 4            ;\" \n\t\t\"       bne     2f              ;\" \n\t\t\"       tabort. 3               ;\" \n\t\t\"2:     tend.                   ;\" \n\t\t\"3:     mr    %[unknown], 3     ;\" \n\n\t\t: [unknown] \"=r\" (unknown)\n\t\t:\n\t\t: \"cr0\", \"r3\", \"r4\", \"r5\", \"r6\", \"r7\", \"vs63\"\n\n\t\t);\n\n\t \n\tfail_vr = unknown != 0x1;\n\tif (fail_vr)\n\t\tprintf(\"Unknown value %#\"PRIx64\" leaked into vr31!\\n\", unknown);\n\telse\n\t\tprintf(\"Good, no poison or leaked value into VEC registers\\n\");\n\n\tkill(pid, SIGKILL);\n\n\treturn (fail_fp | fail_vr);\n}\n\nint main(int argc, char *argv[])\n{\n\t \n\ttest_harness_set_timeout(250);\n\treturn test_harness(tm_poison_test, \"tm_poison_test\");\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}