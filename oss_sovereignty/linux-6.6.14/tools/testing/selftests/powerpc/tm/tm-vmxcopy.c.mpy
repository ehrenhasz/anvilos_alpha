{
  "module_name": "tm-vmxcopy.c",
  "hash_id": "4151e106f6f088dbbf7786df8c8233238d2fe6e0f184540363bdcdbc6808e843",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/powerpc/tm/tm-vmxcopy.c",
  "human_readable_source": "\n \n\n#include <inttypes.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <sys/mman.h>\n#include <string.h>\n#include <assert.h>\n\n#include \"tm.h\"\n#include \"utils.h\"\n\nint test_vmxcopy()\n{\n\tlong double vecin = 1.3;\n\tlong double vecout;\n\tunsigned long pgsize = getpagesize();\n\tint i;\n\tint fd;\n\tint size = pgsize*16;\n\tchar tmpfile[] = \"/tmp/page_faultXXXXXX\";\n\tchar buf[pgsize];\n\tchar *a;\n\tuint64_t aborted = 0;\n\n\tSKIP_IF(!have_htm());\n\tSKIP_IF(htm_is_synthetic());\n\tSKIP_IF(!is_ppc64le());\n\n\tfd = mkstemp(tmpfile);\n\tassert(fd >= 0);\n\n\tmemset(buf, 0, pgsize);\n\tfor (i = 0; i < size; i += pgsize)\n\t\tassert(write(fd, buf, pgsize) == pgsize);\n\n\tunlink(tmpfile);\n\n\ta = mmap(NULL, size, PROT_READ|PROT_WRITE, MAP_PRIVATE, fd, 0);\n\tassert(a != MAP_FAILED);\n\n\tasm __volatile__(\n\t\t\"lxvd2x 40,0,%[vecinptr];\"\t \n\t\t\"tbegin.;\"\n\t\t\"beq\t3f;\"\n\t\t\"tsuspend.;\"\n\t\t\"xxlxor 40,40,40;\"\t\t \n\t\t\"std\t5, 0(%[map]);\"\t\t \n\t\t\"tabort. 0;\"\n\t\t\"tresume.;\"\n\t\t\"tend.;\"\n\t\t\"li\t%[res], 0;\"\n\t\t\"b\t5f;\"\n\n\t\t \n\t\t\"3:;\"\n\t\t\"li\t%[res], 1;\"\n\n\t\t\"5:;\"\n\t\t\"stxvd2x 40,0,%[vecoutptr];\"\n\t\t: [res]\"=&r\"(aborted)\n\t\t: [vecinptr]\"r\"(&vecin),\n\t\t  [vecoutptr]\"r\"(&vecout),\n\t\t  [map]\"r\"(a)\n\t\t: \"memory\", \"r0\", \"r3\", \"r4\", \"r5\", \"r6\", \"r7\");\n\n\tif (aborted && (vecin != vecout)){\n\t\tprintf(\"FAILED: vector state leaked on abort %f != %f\\n\",\n\t\t       (double)vecin, (double)vecout);\n\t\treturn 1;\n\t}\n\n\tmunmap(a, size);\n\n\tclose(fd);\n\n\treturn 0;\n}\n\nint main(void)\n{\n\treturn test_harness(test_vmxcopy, \"tm_vmxcopy\");\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}