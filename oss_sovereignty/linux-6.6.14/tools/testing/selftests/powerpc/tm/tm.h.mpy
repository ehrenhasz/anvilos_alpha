{
  "module_name": "tm.h",
  "hash_id": "12dfb9bc572f788499c34ae588edd751b635d4624b6df49a7b41d6931f253482",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/powerpc/tm/tm.h",
  "human_readable_source": " \n \n\n#ifndef _SELFTESTS_POWERPC_TM_TM_H\n#define _SELFTESTS_POWERPC_TM_TM_H\n\n#include <stdbool.h>\n#include <asm/tm.h>\n\n#include \"utils.h\"\n#include \"reg.h\"\n\n#define TM_RETRIES 100\n\nstatic inline bool have_htm(void)\n{\n#ifdef PPC_FEATURE2_HTM\n\treturn have_hwcap2(PPC_FEATURE2_HTM);\n#else\n\tprintf(\"PPC_FEATURE2_HTM not defined, can't check AT_HWCAP2\\n\");\n\treturn false;\n#endif\n}\n\nstatic inline bool have_htm_nosc(void)\n{\n#ifdef PPC_FEATURE2_HTM_NOSC\n\treturn have_hwcap2(PPC_FEATURE2_HTM_NOSC);\n#else\n\tprintf(\"PPC_FEATURE2_HTM_NOSC not defined, can't check AT_HWCAP2\\n\");\n\treturn false;\n#endif\n}\n\n \nstatic inline bool htm_is_synthetic(void)\n{\n\tint i;\n\n\t \n\tfor (i = 0; i < TM_RETRIES; i++) {\n\t\tasm volatile(\n\t\t\"tbegin.;\"\n\t\t\"beq 1f;\"\n\t\t\"tend.;\"\n\t\t\"1:\"\n\t\t:\n\t\t:\n\t\t: \"memory\");\n\n\t\tif ((__builtin_get_texasr() & (TEXASR_FP | TEXASR_IC)) !=\n\t\t    (TEXASR_FP | TEXASR_IC))\n\t\t\tbreak;\n\t}\n\treturn i == TM_RETRIES;\n}\n\nstatic inline long failure_code(void)\n{\n\treturn __builtin_get_texasru() >> 24;\n}\n\nstatic inline bool failure_is_persistent(void)\n{\n\treturn (failure_code() & TM_CAUSE_PERSISTENT) == TM_CAUSE_PERSISTENT;\n}\n\nstatic inline bool failure_is_syscall(void)\n{\n\treturn (failure_code() & TM_CAUSE_SYSCALL) == TM_CAUSE_SYSCALL;\n}\n\nstatic inline bool failure_is_unavailable(void)\n{\n\treturn (failure_code() & TM_CAUSE_FAC_UNAV) == TM_CAUSE_FAC_UNAV;\n}\n\nstatic inline bool failure_is_reschedule(void)\n{\n\tif ((failure_code() & TM_CAUSE_RESCHED) == TM_CAUSE_RESCHED ||\n\t    (failure_code() & TM_CAUSE_KVM_RESCHED) == TM_CAUSE_KVM_RESCHED ||\n\t    (failure_code() & TM_CAUSE_KVM_FAC_UNAV) == TM_CAUSE_KVM_FAC_UNAV)\n\t\treturn true;\n\n\treturn false;\n}\n\nstatic inline bool failure_is_nesting(void)\n{\n\treturn (__builtin_get_texasru() & 0x400000);\n}\n\nstatic inline int tcheck(void)\n{\n\tlong cr;\n\tasm volatile (\"tcheck 0\" : \"=r\"(cr) : : \"cr0\");\n\treturn (cr >> 28) & 4;\n}\n\nstatic inline bool tcheck_doomed(void)\n{\n\treturn tcheck() & 8;\n}\n\nstatic inline bool tcheck_active(void)\n{\n\treturn tcheck() & 4;\n}\n\nstatic inline bool tcheck_suspended(void)\n{\n\treturn tcheck() & 2;\n}\n\nstatic inline bool tcheck_transactional(void)\n{\n\treturn tcheck() & 6;\n}\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}