{
  "module_name": "tm-vmx-unavail.c",
  "hash_id": "9a9b8860154f2983e6627147e1548c8722e3e0c9a60d242ef9bc9dfc716c6f31",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/powerpc/tm/tm-vmx-unavail.c",
  "human_readable_source": "\n \n\n#include <inttypes.h>\n#include <htmintrin.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <pthread.h>\n#include <sys/mman.h>\n#include <unistd.h>\n\n#include \"tm.h\"\n#include \"utils.h\"\n\nint passed;\n\nvoid *worker(void *unused)\n{\n\t__int128 vmx0;\n\tuint64_t texasr;\n\n\tasm goto (\n\t\t\"li       3, 1;\"   \n\t\t\"std      3, 0(%[vmx0_ptr]);\"\n\t\t\"lvx      0, 0, %[vmx0_ptr];\"\n\n\t\t \n\t\t\"lis      3, 0x3fff;\"\n\t\t\"1: ;\"\n\t\t\"addi     3, 3, -1;\"\n\t\t\"cmpdi    3, 0;\"\n\t\t\"bne      1b;\"\n\n\t\t \n\n\t\t\"tbegin. ;\"\n\t\t\"beq      failure;\"\n\n\t\t \n\t\t\"vaddcuw  0,0,0;\"\n\n\t\t\"tend. ;\"\n\t\t\"b        %l[success];\"\n\n\t\t \n\t\t\"failure: ;\"\n\t\t\"lvx       1,  0, %[vmx0_ptr];\"\n\t\t\"vcmpequb. 2,  0, 1;\"\n\t\t\"bc        4, 24, %l[value_mismatch];\"\n\t\t\"b        %l[value_match];\"\n\t\t:\n\t\t: [vmx0_ptr] \"r\"(&vmx0)\n\t\t: \"r3\"\n\t\t: success, value_match, value_mismatch\n\t\t);\n\n\t \nvalue_mismatch:\n\ttexasr = __builtin_get_texasr();\n\n\tprintf(\"\\n\\n==============\\n\\n\");\n\tprintf(\"Failure with error: %lx\\n\",   _TEXASR_FAILURE_CODE(texasr));\n\tprintf(\"Summary error     : %lx\\n\",   _TEXASR_FAILURE_SUMMARY(texasr));\n\tprintf(\"TFIAR exact       : %lx\\n\\n\", _TEXASR_TFIAR_EXACT(texasr));\n\n\tpassed = 0;\n\treturn NULL;\n\n\t \nvalue_match:\n\n\treturn NULL;\n\nsuccess:\n\n\treturn NULL;\n}\n\nint tm_vmx_unavail_test()\n{\n\tint threads;\n\tpthread_t *thread;\n\n\tSKIP_IF(!have_htm());\n\tSKIP_IF(htm_is_synthetic());\n\n\tpassed = 1;\n\n\tthreads = sysconf(_SC_NPROCESSORS_ONLN) * 4;\n\tthread = malloc(sizeof(pthread_t)*threads);\n\tif (!thread)\n\t\treturn EXIT_FAILURE;\n\n\tfor (uint64_t i = 0; i < threads; i++)\n\t\tpthread_create(&thread[i], NULL, &worker, NULL);\n\n\tfor (uint64_t i = 0; i < threads; i++)\n\t\tpthread_join(thread[i], NULL);\n\n\tfree(thread);\n\n\treturn passed ? EXIT_SUCCESS : EXIT_FAILURE;\n}\n\n\nint main(int argc, char **argv)\n{\n\treturn test_harness(tm_vmx_unavail_test, \"tm_vmx_unavail_test\");\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}