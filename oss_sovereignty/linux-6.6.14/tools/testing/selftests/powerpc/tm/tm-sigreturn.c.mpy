{
  "module_name": "tm-sigreturn.c",
  "hash_id": "bd4b1c28e3957d813d6598267c8749ee06152b1febebced3268859e40f7c4920",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/powerpc/tm/tm-sigreturn.c",
  "human_readable_source": "\n\n \n\n#include <signal.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <sys/types.h>\n#include <sys/wait.h>\n#include <unistd.h>\n\n#include \"tm.h\"\n#include \"utils.h\"\n\n\nvoid handler(int sig)\n{\n\tuint64_t ret;\n\n\tasm __volatile__(\n\t\t\"li             3,1             ;\"\n\t\t\"tbegin.                        ;\"\n\t\t\"beq            1f              ;\"\n\t\t\"li             3,0             ;\"\n\t\t\"tsuspend.                      ;\"\n\t\t\"1:                             ;\"\n\t\t\"std%X[ret]     3, %[ret]       ;\"\n\t\t: [ret] \"=m\"(ret)\n\t\t:\n\t\t: \"memory\", \"3\", \"cr0\");\n\n\tif (ret)\n\t\texit(1);\n\n\t \n}\n\n\nint tm_sigreturn(void)\n{\n\tstruct sigaction sa;\n\tuint64_t ret = 0;\n\n\tSKIP_IF(!have_htm());\n\tSKIP_IF(htm_is_synthetic());\n\tSKIP_IF(!is_ppc64le());\n\n\tmemset(&sa, 0, sizeof(sa));\n\tsa.sa_handler = handler;\n\tsigemptyset(&sa.sa_mask);\n\n\tif (sigaction(SIGSEGV, &sa, NULL))\n\t\texit(1);\n\n\tasm __volatile__(\n\t\t\"tbegin.                        ;\"\n\t\t\"beq            1f              ;\"\n\t\t\"li             3,0             ;\"\n\t\t\"std            3,0(3)          ;\"  \n\t\t\"li             3,1             ;\"\n\t\t\"std%X[ret]     3,%[ret]        ;\"\n\t\t\"tend.                          ;\"\n\t\t\"b              2f              ;\"\n\t\t\"1:                             ;\"\n\t\t\"li             3,2             ;\"\n\t\t\"std%X[ret]     3,%[ret]        ;\"\n\t\t\"2:                             ;\"\n\t\t: [ret] \"=m\"(ret)\n\t\t:\n\t\t: \"memory\", \"3\", \"cr0\");\n\n\tif (ret != 2)\n\t\texit(1);\n\n\texit(0);\n}\n\nint main(void)\n{\n\treturn test_harness(tm_sigreturn, \"tm_sigreturn\");\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}