{
  "module_name": "ptrace.h",
  "hash_id": "2b628fb2b38e8bfe006fd1314ddf7abf11322fd749399c413de997c2230b3a0f",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/powerpc/ptrace/ptrace.h",
  "human_readable_source": " \n \n\n#define __SANE_USERSPACE_TYPES__\n\n#include <inttypes.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <string.h>\n#include <malloc.h>\n#include <errno.h>\n#include <time.h>\n#include <sys/ptrace.h>\n#include <sys/ioctl.h>\n#include <sys/uio.h>\n#include <sys/types.h>\n#include <sys/wait.h>\n#include <sys/signal.h>\n#include <sys/ipc.h>\n#include <sys/shm.h>\n#include <sys/user.h>\n#include <sys/syscall.h>\n#include <linux/elf.h>\n#include <linux/types.h>\n#include <linux/auxvec.h>\n#include \"reg.h\"\n#include \"utils.h\"\n\n#define TEST_PASS 0\n#define TEST_FAIL 1\n\nstruct fpr_regs {\n\t__u64 fpr[32];\n\t__u64 fpscr;\n};\n\nstruct tm_spr_regs {\n\tunsigned long tm_tfhar;\n\tunsigned long tm_texasr;\n\tunsigned long tm_tfiar;\n};\n\n#ifndef NT_PPC_TAR\n#define NT_PPC_TAR\t0x103\n#define NT_PPC_PPR\t0x104\n#define NT_PPC_DSCR\t0x105\n#define NT_PPC_EBB\t0x106\n#define NT_PPC_PMU\t0x107\n#define NT_PPC_TM_CGPR\t0x108\n#define NT_PPC_TM_CFPR\t0x109\n#define NT_PPC_TM_CVMX\t0x10a\n#define NT_PPC_TM_CVSX\t0x10b\n#define NT_PPC_TM_SPR\t0x10c\n#define NT_PPC_TM_CTAR\t0x10d\n#define NT_PPC_TM_CPPR\t0x10e\n#define NT_PPC_TM_CDSCR\t0x10f\n#endif\n\n \nint start_trace(pid_t child)\n{\n\tint ret;\n\n\tret = ptrace(PTRACE_ATTACH, child, NULL, NULL);\n\tif (ret) {\n\t\tperror(\"ptrace(PTRACE_ATTACH) failed\");\n\t\treturn TEST_FAIL;\n\t}\n\tret = waitpid(child, NULL, 0);\n\tif (ret != child) {\n\t\tperror(\"waitpid() failed\");\n\t\treturn TEST_FAIL;\n\t}\n\treturn TEST_PASS;\n}\n\nint stop_trace(pid_t child)\n{\n\tint ret;\n\n\tret = ptrace(PTRACE_DETACH, child, NULL, NULL);\n\tif (ret) {\n\t\tperror(\"ptrace(PTRACE_DETACH) failed\");\n\t\treturn TEST_FAIL;\n\t}\n\treturn TEST_PASS;\n}\n\nint cont_trace(pid_t child)\n{\n\tint ret;\n\n\tret = ptrace(PTRACE_CONT, child, NULL, NULL);\n\tif (ret) {\n\t\tperror(\"ptrace(PTRACE_CONT) failed\");\n\t\treturn TEST_FAIL;\n\t}\n\treturn TEST_PASS;\n}\n\nint ptrace_read_regs(pid_t child, unsigned long type, unsigned long regs[],\n\t\t     int n)\n{\n\tstruct iovec iov;\n\tlong ret;\n\n\tFAIL_IF(start_trace(child));\n\n\tiov.iov_base = regs;\n\tiov.iov_len = n * sizeof(unsigned long);\n\n\tret = ptrace(PTRACE_GETREGSET, child, type, &iov);\n\tif (ret)\n\t\treturn ret;\n\n\tFAIL_IF(stop_trace(child));\n\n\treturn TEST_PASS;\n}\n\nlong ptrace_write_regs(pid_t child, unsigned long type, unsigned long regs[],\n\t\t       int n)\n{\n\tstruct iovec iov;\n\tlong ret;\n\n\tFAIL_IF(start_trace(child));\n\n\tiov.iov_base = regs;\n\tiov.iov_len = n * sizeof(unsigned long);\n\n\tret = ptrace(PTRACE_SETREGSET, child, type, &iov);\n\n\tFAIL_IF(stop_trace(child));\n\n\treturn ret;\n}\n\n \nint show_tar_registers(pid_t child, unsigned long *out)\n{\n\tstruct iovec iov;\n\tunsigned long *reg;\n\tint ret;\n\n\treg = malloc(sizeof(unsigned long));\n\tif (!reg) {\n\t\tperror(\"malloc() failed\");\n\t\treturn TEST_FAIL;\n\t}\n\tiov.iov_base = (u64 *) reg;\n\tiov.iov_len = sizeof(unsigned long);\n\n\tret = ptrace(PTRACE_GETREGSET, child, NT_PPC_TAR, &iov);\n\tif (ret) {\n\t\tperror(\"ptrace(PTRACE_GETREGSET) failed\");\n\t\tgoto fail;\n\t}\n\tif (out)\n\t\tout[0] = *reg;\n\n\tret = ptrace(PTRACE_GETREGSET, child, NT_PPC_PPR, &iov);\n\tif (ret) {\n\t\tperror(\"ptrace(PTRACE_GETREGSET) failed\");\n\t\tgoto fail;\n\t}\n\tif (out)\n\t\tout[1] = *reg;\n\n\tret = ptrace(PTRACE_GETREGSET, child, NT_PPC_DSCR, &iov);\n\tif (ret) {\n\t\tperror(\"ptrace(PTRACE_GETREGSET) failed\");\n\t\tgoto fail;\n\t}\n\tif (out)\n\t\tout[2] = *reg;\n\n\tfree(reg);\n\treturn TEST_PASS;\nfail:\n\tfree(reg);\n\treturn TEST_FAIL;\n}\n\nint write_tar_registers(pid_t child, unsigned long tar,\n\t\tunsigned long ppr, unsigned long dscr)\n{\n\tstruct iovec iov;\n\tunsigned long *reg;\n\tint ret;\n\n\treg = malloc(sizeof(unsigned long));\n\tif (!reg) {\n\t\tperror(\"malloc() failed\");\n\t\treturn TEST_FAIL;\n\t}\n\n\tiov.iov_base = (u64 *) reg;\n\tiov.iov_len = sizeof(unsigned long);\n\n\t*reg = tar;\n\tret = ptrace(PTRACE_SETREGSET, child, NT_PPC_TAR, &iov);\n\tif (ret) {\n\t\tperror(\"ptrace(PTRACE_SETREGSET) failed\");\n\t\tgoto fail;\n\t}\n\n\t*reg = ppr;\n\tret = ptrace(PTRACE_SETREGSET, child, NT_PPC_PPR, &iov);\n\tif (ret) {\n\t\tperror(\"ptrace(PTRACE_SETREGSET) failed\");\n\t\tgoto fail;\n\t}\n\n\t*reg = dscr;\n\tret = ptrace(PTRACE_SETREGSET, child, NT_PPC_DSCR, &iov);\n\tif (ret) {\n\t\tperror(\"ptrace(PTRACE_SETREGSET) failed\");\n\t\tgoto fail;\n\t}\n\n\tfree(reg);\n\treturn TEST_PASS;\nfail:\n\tfree(reg);\n\treturn TEST_FAIL;\n}\n\nint show_tm_checkpointed_state(pid_t child, unsigned long *out)\n{\n\tstruct iovec iov;\n\tunsigned long *reg;\n\tint ret;\n\n\treg = malloc(sizeof(unsigned long));\n\tif (!reg) {\n\t\tperror(\"malloc() failed\");\n\t\treturn TEST_FAIL;\n\t}\n\n\tiov.iov_base = (u64 *) reg;\n\tiov.iov_len = sizeof(unsigned long);\n\n\tret = ptrace(PTRACE_GETREGSET, child, NT_PPC_TM_CTAR, &iov);\n\tif (ret) {\n\t\tperror(\"ptrace(PTRACE_GETREGSET) failed\");\n\t\tgoto fail;\n\t}\n\tif (out)\n\t\tout[0] = *reg;\n\n\tret = ptrace(PTRACE_GETREGSET, child, NT_PPC_TM_CPPR, &iov);\n\tif (ret) {\n\t\tperror(\"ptrace(PTRACE_GETREGSET) failed\");\n\t\tgoto fail;\n\t}\n\tif (out)\n\t\tout[1] = *reg;\n\n\tret = ptrace(PTRACE_GETREGSET, child, NT_PPC_TM_CDSCR, &iov);\n\tif (ret) {\n\t\tperror(\"ptrace(PTRACE_GETREGSET) failed\");\n\t\tgoto fail;\n\t}\n\tif (out)\n\t\tout[2] = *reg;\n\n\tfree(reg);\n\treturn TEST_PASS;\n\nfail:\n\tfree(reg);\n\treturn TEST_FAIL;\n}\n\nint write_ckpt_tar_registers(pid_t child, unsigned long tar,\n\t\tunsigned long ppr, unsigned long dscr)\n{\n\tstruct iovec iov;\n\tunsigned long *reg;\n\tint ret;\n\n\treg = malloc(sizeof(unsigned long));\n\tif (!reg) {\n\t\tperror(\"malloc() failed\");\n\t\treturn TEST_FAIL;\n\t}\n\n\tiov.iov_base = (u64 *) reg;\n\tiov.iov_len = sizeof(unsigned long);\n\n\t*reg = tar;\n\tret = ptrace(PTRACE_SETREGSET, child, NT_PPC_TM_CTAR, &iov);\n\tif (ret) {\n\t\tperror(\"ptrace(PTRACE_GETREGSET) failed\");\n\t\tgoto fail;\n\t}\n\n\t*reg = ppr;\n\tret = ptrace(PTRACE_SETREGSET, child, NT_PPC_TM_CPPR, &iov);\n\tif (ret) {\n\t\tperror(\"ptrace(PTRACE_GETREGSET) failed\");\n\t\tgoto fail;\n\t}\n\n\t*reg = dscr;\n\tret = ptrace(PTRACE_SETREGSET, child, NT_PPC_TM_CDSCR, &iov);\n\tif (ret) {\n\t\tperror(\"ptrace(PTRACE_GETREGSET) failed\");\n\t\tgoto fail;\n\t}\n\n\tfree(reg);\n\treturn TEST_PASS;\nfail:\n\tfree(reg);\n\treturn TEST_FAIL;\n}\n\n \nint show_fpr(pid_t child, __u64 *fpr)\n{\n\tstruct fpr_regs *regs;\n\tint ret, i;\n\n\tregs = (struct fpr_regs *) malloc(sizeof(struct fpr_regs));\n\tret = ptrace(PTRACE_GETFPREGS, child, NULL, regs);\n\tif (ret) {\n\t\tperror(\"ptrace(PTRACE_GETREGSET) failed\");\n\t\treturn TEST_FAIL;\n\t}\n\n\tif (fpr) {\n\t\tfor (i = 0; i < 32; i++)\n\t\t\tfpr[i] = regs->fpr[i];\n\t}\n\treturn TEST_PASS;\n}\n\nint write_fpr(pid_t child, __u64 val)\n{\n\tstruct fpr_regs *regs;\n\tint ret, i;\n\n\tregs = (struct fpr_regs *) malloc(sizeof(struct fpr_regs));\n\tret = ptrace(PTRACE_GETFPREGS, child, NULL, regs);\n\tif (ret) {\n\t\tperror(\"ptrace(PTRACE_GETREGSET) failed\");\n\t\treturn TEST_FAIL;\n\t}\n\n\tfor (i = 0; i < 32; i++)\n\t\tregs->fpr[i] = val;\n\n\tret = ptrace(PTRACE_SETFPREGS, child, NULL, regs);\n\tif (ret) {\n\t\tperror(\"ptrace(PTRACE_GETREGSET) failed\");\n\t\treturn TEST_FAIL;\n\t}\n\treturn TEST_PASS;\n}\n\nint show_ckpt_fpr(pid_t child, __u64 *fpr)\n{\n\tstruct fpr_regs *regs;\n\tstruct iovec iov;\n\tint ret, i;\n\n\tregs = (struct fpr_regs *) malloc(sizeof(struct fpr_regs));\n\tiov.iov_base = regs;\n\tiov.iov_len = sizeof(struct fpr_regs);\n\n\tret = ptrace(PTRACE_GETREGSET, child, NT_PPC_TM_CFPR, &iov);\n\tif (ret) {\n\t\tperror(\"ptrace(PTRACE_GETREGSET) failed\");\n\t\treturn TEST_FAIL;\n\t}\n\n\tif (fpr) {\n\t\tfor (i = 0; i < 32; i++)\n\t\t\tfpr[i] = regs->fpr[i];\n\t}\n\n\treturn TEST_PASS;\n}\n\nint write_ckpt_fpr(pid_t child, unsigned long val)\n{\n\tstruct fpr_regs *regs;\n\tstruct iovec iov;\n\tint ret, i;\n\n\tregs = (struct fpr_regs *) malloc(sizeof(struct fpr_regs));\n\tiov.iov_base = regs;\n\tiov.iov_len = sizeof(struct fpr_regs);\n\n\tret = ptrace(PTRACE_GETREGSET, child, NT_PPC_TM_CFPR, &iov);\n\tif (ret) {\n\t\tperror(\"ptrace(PTRACE_GETREGSET) failed\");\n\t\treturn TEST_FAIL;\n\t}\n\n\tfor (i = 0; i < 32; i++)\n\t\tregs->fpr[i] = val;\n\n\tret = ptrace(PTRACE_SETREGSET, child, NT_PPC_TM_CFPR, &iov);\n\tif (ret) {\n\t\tperror(\"ptrace(PTRACE_GETREGSET) failed\");\n\t\treturn TEST_FAIL;\n\t}\n\treturn TEST_PASS;\n}\n\n \nint show_gpr(pid_t child, unsigned long *gpr)\n{\n\tstruct pt_regs *regs;\n\tint ret, i;\n\n\tregs = (struct pt_regs *) malloc(sizeof(struct pt_regs));\n\tif (!regs) {\n\t\tperror(\"malloc() failed\");\n\t\treturn TEST_FAIL;\n\t}\n\n\tret = ptrace(PTRACE_GETREGS, child, NULL, regs);\n\tif (ret) {\n\t\tperror(\"ptrace(PTRACE_GETREGSET) failed\");\n\t\treturn TEST_FAIL;\n\t}\n\n\tif (gpr) {\n\t\tfor (i = 14; i < 32; i++)\n\t\t\tgpr[i-14] = regs->gpr[i];\n\t}\n\n\treturn TEST_PASS;\n}\n\nlong sys_ptrace(enum __ptrace_request request, pid_t pid, unsigned long addr, unsigned long data)\n{\n\treturn syscall(__NR_ptrace, request, pid, (void *)addr, data);\n}\n\n\n#define PT_NUM_FPRS\t(33 * (sizeof(__u64) / sizeof(unsigned long)))\n\n__u64 *peek_fprs(pid_t child)\n{\n\tunsigned long *fprs, *p, addr;\n\tlong ret;\n\tint i;\n\n\tfprs = malloc(sizeof(unsigned long) * PT_NUM_FPRS);\n\tif (!fprs) {\n\t\tperror(\"malloc() failed\");\n\t\treturn NULL;\n\t}\n\n\tfor (i = 0, p = fprs; i < PT_NUM_FPRS; i++, p++) {\n\t\taddr = sizeof(unsigned long) * (PT_FPR0 + i);\n\t\tret = sys_ptrace(PTRACE_PEEKUSER, child, addr, (unsigned long)p);\n\t\tif (ret) {\n\t\t\tperror(\"ptrace(PTRACE_PEEKUSR) failed\");\n\t\t\treturn NULL;\n\t\t}\n\t}\n\n\taddr = sizeof(unsigned long) * (PT_FPR0 + i);\n\tret = sys_ptrace(PTRACE_PEEKUSER, child, addr, (unsigned long)&addr);\n\tif (!ret) {\n\t\tprintf(\"ptrace(PTRACE_PEEKUSR) succeeded unexpectedly!\\n\");\n\t\treturn NULL;\n\t}\n\n\treturn (__u64 *)fprs;\n}\n\nint poke_fprs(pid_t child, unsigned long *fprs)\n{\n\tunsigned long *p, addr;\n\tlong ret;\n\tint i;\n\n\tfor (i = 0, p = fprs; i < PT_NUM_FPRS; i++, p++) {\n\t\taddr = sizeof(unsigned long) * (PT_FPR0 + i);\n\t\tret = sys_ptrace(PTRACE_POKEUSER, child, addr, *p);\n\t\tif (ret) {\n\t\t\tperror(\"ptrace(PTRACE_POKEUSR) failed\");\n\t\t\treturn -1;\n\t\t}\n\t}\n\n\taddr = sizeof(unsigned long) * (PT_FPR0 + i);\n\tret = sys_ptrace(PTRACE_POKEUSER, child, addr, addr);\n\tif (!ret) {\n\t\tprintf(\"ptrace(PTRACE_POKEUSR) succeeded unexpectedly!\\n\");\n\t\treturn -1;\n\t}\n\n\treturn 0;\n}\n\nint write_gpr(pid_t child, unsigned long val)\n{\n\tstruct pt_regs *regs;\n\tint i, ret;\n\n\tregs = (struct pt_regs *) malloc(sizeof(struct pt_regs));\n\tif (!regs) {\n\t\tperror(\"malloc() failed\");\n\t\treturn TEST_FAIL;\n\t}\n\n\tret = ptrace(PTRACE_GETREGS, child, NULL, regs);\n\tif (ret) {\n\t\tperror(\"ptrace(PTRACE_GETREGSET) failed\");\n\t\treturn TEST_FAIL;\n\t}\n\n\tfor (i = 14; i < 32; i++)\n\t\tregs->gpr[i] = val;\n\n\tret = ptrace(PTRACE_SETREGS, child, NULL, regs);\n\tif (ret) {\n\t\tperror(\"ptrace(PTRACE_GETREGSET) failed\");\n\t\treturn TEST_FAIL;\n\t}\n\treturn TEST_PASS;\n}\n\nint show_ckpt_gpr(pid_t child, unsigned long *gpr)\n{\n\tstruct pt_regs *regs;\n\tstruct iovec iov;\n\tint ret, i;\n\n\tregs = (struct pt_regs *) malloc(sizeof(struct pt_regs));\n\tif (!regs) {\n\t\tperror(\"malloc() failed\");\n\t\treturn TEST_FAIL;\n\t}\n\n\tiov.iov_base = (u64 *) regs;\n\tiov.iov_len = sizeof(struct pt_regs);\n\n\tret = ptrace(PTRACE_GETREGSET, child, NT_PPC_TM_CGPR, &iov);\n\tif (ret) {\n\t\tperror(\"ptrace(PTRACE_GETREGSET) failed\");\n\t\treturn TEST_FAIL;\n\t}\n\n\tif (gpr) {\n\t\tfor (i = 14; i < 32; i++)\n\t\t\tgpr[i-14] = regs->gpr[i];\n\t}\n\n\treturn TEST_PASS;\n}\n\nint write_ckpt_gpr(pid_t child, unsigned long val)\n{\n\tstruct pt_regs *regs;\n\tstruct iovec iov;\n\tint ret, i;\n\n\tregs = (struct pt_regs *) malloc(sizeof(struct pt_regs));\n\tif (!regs) {\n\t\tperror(\"malloc() failed\\n\");\n\t\treturn TEST_FAIL;\n\t}\n\tiov.iov_base = (u64 *) regs;\n\tiov.iov_len = sizeof(struct pt_regs);\n\n\tret = ptrace(PTRACE_GETREGSET, child, NT_PPC_TM_CGPR, &iov);\n\tif (ret) {\n\t\tperror(\"ptrace(PTRACE_GETREGSET) failed\");\n\t\treturn TEST_FAIL;\n\t}\n\n\tfor (i = 14; i < 32; i++)\n\t\tregs->gpr[i] = val;\n\n\tret = ptrace(PTRACE_SETREGSET, child, NT_PPC_TM_CGPR, &iov);\n\tif (ret) {\n\t\tperror(\"ptrace(PTRACE_GETREGSET) failed\");\n\t\treturn TEST_FAIL;\n\t}\n\treturn TEST_PASS;\n}\n\n \nint show_vmx(pid_t child, unsigned long vmx[][2])\n{\n\tint ret;\n\n\tret = ptrace(PTRACE_GETVRREGS, child, 0, vmx);\n\tif (ret) {\n\t\tperror(\"ptrace(PTRACE_GETVRREGS) failed\");\n\t\treturn TEST_FAIL;\n\t}\n\treturn TEST_PASS;\n}\n\nint show_vmx_ckpt(pid_t child, unsigned long vmx[][2])\n{\n\tunsigned long regs[34][2];\n\tstruct iovec iov;\n\tint ret;\n\n\tiov.iov_base = (u64 *) regs;\n\tiov.iov_len = sizeof(regs);\n\tret = ptrace(PTRACE_GETREGSET, child, NT_PPC_TM_CVMX, &iov);\n\tif (ret) {\n\t\tperror(\"ptrace(PTRACE_GETREGSET, NT_PPC_TM_CVMX) failed\");\n\t\treturn TEST_FAIL;\n\t}\n\tmemcpy(vmx, regs, sizeof(regs));\n\treturn TEST_PASS;\n}\n\n\nint write_vmx(pid_t child, unsigned long vmx[][2])\n{\n\tint ret;\n\n\tret = ptrace(PTRACE_SETVRREGS, child, 0, vmx);\n\tif (ret) {\n\t\tperror(\"ptrace(PTRACE_SETVRREGS) failed\");\n\t\treturn TEST_FAIL;\n\t}\n\treturn TEST_PASS;\n}\n\nint write_vmx_ckpt(pid_t child, unsigned long vmx[][2])\n{\n\tunsigned long regs[34][2];\n\tstruct iovec iov;\n\tint ret;\n\n\tmemcpy(regs, vmx, sizeof(regs));\n\tiov.iov_base = (u64 *) regs;\n\tiov.iov_len = sizeof(regs);\n\tret = ptrace(PTRACE_SETREGSET, child, NT_PPC_TM_CVMX, &iov);\n\tif (ret) {\n\t\tperror(\"ptrace(PTRACE_SETREGSET, NT_PPC_TM_CVMX) failed\");\n\t\treturn TEST_FAIL;\n\t}\n\treturn TEST_PASS;\n}\n\n \nint show_vsx(pid_t child, unsigned long *vsx)\n{\n\tint ret;\n\n\tret = ptrace(PTRACE_GETVSRREGS, child, 0, vsx);\n\tif (ret) {\n\t\tperror(\"ptrace(PTRACE_GETVSRREGS) failed\");\n\t\treturn TEST_FAIL;\n\t}\n\treturn TEST_PASS;\n}\n\nint show_vsx_ckpt(pid_t child, unsigned long *vsx)\n{\n\tunsigned long regs[32];\n\tstruct iovec iov;\n\tint ret;\n\n\tiov.iov_base = (u64 *) regs;\n\tiov.iov_len = sizeof(regs);\n\tret = ptrace(PTRACE_GETREGSET, child, NT_PPC_TM_CVSX, &iov);\n\tif (ret) {\n\t\tperror(\"ptrace(PTRACE_GETREGSET, NT_PPC_TM_CVSX) failed\");\n\t\treturn TEST_FAIL;\n\t}\n\tmemcpy(vsx, regs, sizeof(regs));\n\treturn TEST_PASS;\n}\n\nint write_vsx(pid_t child, unsigned long *vsx)\n{\n\tint ret;\n\n\tret = ptrace(PTRACE_SETVSRREGS, child, 0, vsx);\n\tif (ret) {\n\t\tperror(\"ptrace(PTRACE_SETVSRREGS) failed\");\n\t\treturn TEST_FAIL;\n\t}\n\treturn TEST_PASS;\n}\n\nint write_vsx_ckpt(pid_t child, unsigned long *vsx)\n{\n\tunsigned long regs[32];\n\tstruct iovec iov;\n\tint ret;\n\n\tmemcpy(regs, vsx, sizeof(regs));\n\tiov.iov_base = (u64 *) regs;\n\tiov.iov_len = sizeof(regs);\n\tret = ptrace(PTRACE_SETREGSET, child, NT_PPC_TM_CVSX, &iov);\n\tif (ret) {\n\t\tperror(\"ptrace(PTRACE_SETREGSET, NT_PPC_TM_CVSX) failed\");\n\t\treturn TEST_FAIL;\n\t}\n\treturn TEST_PASS;\n}\n\n \nint show_tm_spr(pid_t child, struct tm_spr_regs *out)\n{\n\tstruct tm_spr_regs *regs;\n\tstruct iovec iov;\n\tint ret;\n\n\tregs = (struct tm_spr_regs *) malloc(sizeof(struct tm_spr_regs));\n\tif (!regs) {\n\t\tperror(\"malloc() failed\");\n\t\treturn TEST_FAIL;\n\t}\n\n\tiov.iov_base = (u64 *) regs;\n\tiov.iov_len = sizeof(struct tm_spr_regs);\n\n\tret = ptrace(PTRACE_GETREGSET, child, NT_PPC_TM_SPR, &iov);\n\tif (ret) {\n\t\tperror(\"ptrace(PTRACE_GETREGSET) failed\");\n\t\treturn TEST_FAIL;\n\t}\n\n\tif (out)\n\t\tmemcpy(out, regs, sizeof(struct tm_spr_regs));\n\n\treturn TEST_PASS;\n}\n\n\n\n \ninline unsigned long get_tfiar(void)\n{\n\treturn mfspr(SPRN_TFIAR);\n}\n\nvoid analyse_texasr(unsigned long texasr)\n{\n\tprintf(\"TEXASR: %16lx\\t\", texasr);\n\n\tif (texasr & TEXASR_FP)\n\t\tprintf(\"TEXASR_FP  \");\n\n\tif (texasr & TEXASR_DA)\n\t\tprintf(\"TEXASR_DA  \");\n\n\tif (texasr & TEXASR_NO)\n\t\tprintf(\"TEXASR_NO  \");\n\n\tif (texasr & TEXASR_FO)\n\t\tprintf(\"TEXASR_FO  \");\n\n\tif (texasr & TEXASR_SIC)\n\t\tprintf(\"TEXASR_SIC  \");\n\n\tif (texasr & TEXASR_NTC)\n\t\tprintf(\"TEXASR_NTC  \");\n\n\tif (texasr & TEXASR_TC)\n\t\tprintf(\"TEXASR_TC  \");\n\n\tif (texasr & TEXASR_TIC)\n\t\tprintf(\"TEXASR_TIC  \");\n\n\tif (texasr & TEXASR_IC)\n\t\tprintf(\"TEXASR_IC  \");\n\n\tif (texasr & TEXASR_IFC)\n\t\tprintf(\"TEXASR_IFC  \");\n\n\tif (texasr & TEXASR_ABT)\n\t\tprintf(\"TEXASR_ABT  \");\n\n\tif (texasr & TEXASR_SPD)\n\t\tprintf(\"TEXASR_SPD  \");\n\n\tif (texasr & TEXASR_HV)\n\t\tprintf(\"TEXASR_HV  \");\n\n\tif (texasr & TEXASR_PR)\n\t\tprintf(\"TEXASR_PR  \");\n\n\tif (texasr & TEXASR_FS)\n\t\tprintf(\"TEXASR_FS  \");\n\n\tif (texasr & TEXASR_TE)\n\t\tprintf(\"TEXASR_TE  \");\n\n\tif (texasr & TEXASR_ROT)\n\t\tprintf(\"TEXASR_ROT  \");\n\n\tprintf(\"TFIAR :%lx\\n\", get_tfiar());\n}\n\nvoid store_gpr(unsigned long *addr);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}