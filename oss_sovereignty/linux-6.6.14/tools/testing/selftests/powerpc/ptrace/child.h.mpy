{
  "module_name": "child.h",
  "hash_id": "4e990312d7fea0ea430906f3261a90fc933e7b57a44606402dc4857d3d614041",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/powerpc/ptrace/child.h",
  "human_readable_source": "\n \n#include <stdio.h>\n#include <stdbool.h>\n#include <semaphore.h>\n\n \nstruct child_sync {\n\t \n\tsem_t sem_parent;\n\n\t \n\tbool parent_gave_up;\n\n\t \n\tsem_t sem_child;\n\n\t \n\tbool child_gave_up;\n};\n\n#define CHILD_FAIL_IF(x, sync)\t\t\t\t\t\t\\\n\tdo {\t\t\t\t\t\t\t\t\\\n\t\tif (x) {\t\t\t\t\t\t\\\n\t\t\tfprintf(stderr,\t\t\t\t\t\\\n\t\t\t\t\"[FAIL] Test FAILED on line %d\\n\", __LINE__); \\\n\t\t\t(sync)->child_gave_up = true;\t\t\t\\\n\t\t\tprod_parent(sync);\t\t\t\t\\\n\t\t\treturn 1;\t\t\t\t\t\\\n\t\t}\t\t\t\t\t\t\t\\\n\t} while (0)\n\n#define PARENT_FAIL_IF(x, sync)\t\t\t\t\t\t\\\n\tdo {\t\t\t\t\t\t\t\t\\\n\t\tif (x) {\t\t\t\t\t\t\\\n\t\t\tfprintf(stderr,\t\t\t\t\t\\\n\t\t\t\t\"[FAIL] Test FAILED on line %d\\n\", __LINE__); \\\n\t\t\t(sync)->parent_gave_up = true;\t\t\t\\\n\t\t\tprod_child(sync);\t\t\t\t\\\n\t\t\treturn 1;\t\t\t\t\t\\\n\t\t}\t\t\t\t\t\t\t\\\n\t} while (0)\n\n#define PARENT_SKIP_IF_UNSUPPORTED(x, sync, msg)\t\t\t\\\n\tdo {\t\t\t\t\t\t\t\t\\\n\t\tif ((x) == -1 && (errno == ENODEV || errno == EINVAL)) { \\\n\t\t\t(sync)->parent_gave_up = true;\t\t\t\\\n\t\t\tprod_child(sync);\t\t\t\t\\\n\t\t\tSKIP_IF_MSG(1, msg);\t\t\t\t\\\n\t\t}\t\t\t\t\t\t\t\\\n\t} while (0)\n\nint init_child_sync(struct child_sync *sync)\n{\n\tint ret;\n\n\tret = sem_init(&sync->sem_parent, 1, 0);\n\tif (ret) {\n\t\tperror(\"Semaphore initialization failed\");\n\t\treturn 1;\n\t}\n\n\tret = sem_init(&sync->sem_child, 1, 0);\n\tif (ret) {\n\t\tperror(\"Semaphore initialization failed\");\n\t\treturn 1;\n\t}\n\n\treturn 0;\n}\n\nvoid destroy_child_sync(struct child_sync *sync)\n{\n\tsem_destroy(&sync->sem_parent);\n\tsem_destroy(&sync->sem_child);\n}\n\nint wait_child(struct child_sync *sync)\n{\n\tint ret;\n\n\t \n\tret = sem_wait(&sync->sem_parent);\n\tif (ret) {\n\t\tperror(\"Error waiting for child\");\n\t\treturn 1;\n\t}\n\n\treturn sync->child_gave_up;\n}\n\nint prod_child(struct child_sync *sync)\n{\n\tint ret;\n\n\t \n\tret = sem_post(&sync->sem_child);\n\tif (ret) {\n\t\tperror(\"Error prodding child\");\n\t\treturn 1;\n\t}\n\n\treturn 0;\n}\n\nint wait_parent(struct child_sync *sync)\n{\n\tint ret;\n\n\t \n\tret = sem_wait(&sync->sem_child);\n\tif (ret) {\n\t\tperror(\"Error waiting for parent\");\n\t\treturn 1;\n\t}\n\n\treturn sync->parent_gave_up;\n}\n\nint prod_parent(struct child_sync *sync)\n{\n\tint ret;\n\n\t \n\tret = sem_post(&sync->sem_parent);\n\tif (ret) {\n\t\tperror(\"Error prodding parent\");\n\t\treturn 1;\n\t}\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}