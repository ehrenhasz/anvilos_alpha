{
  "module_name": "signal.c",
  "hash_id": "e29a6879917ee16a6fa1061067e4ef6a3aab8d1dd21660660b1425e0eac0a142",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/powerpc/signal/signal.c",
  "human_readable_source": "\n \n\n#include <signal.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <sys/types.h>\n#include <sys/wait.h>\n#include <unistd.h>\n\n#include <altivec.h>\n\n#include \"utils.h\"\n\n#define MAX_ATTEMPT 500000\n#define TIMEOUT 5\n\nextern long signal_self(pid_t pid, int sig);\n\nstatic sig_atomic_t signaled;\nstatic sig_atomic_t fail;\n\nstatic void signal_handler(int sig)\n{\n\tif (sig == SIGUSR1)\n\t\tsignaled = 1;\n\telse\n\t\tfail = 1;\n}\n\nstatic int test_signal()\n{\n\tint i;\n\tstruct sigaction act;\n\tpid_t ppid = getpid();\n\tpid_t pid;\n\n\tact.sa_handler = signal_handler;\n\tact.sa_flags = 0;\n\tsigemptyset(&act.sa_mask);\n\tif (sigaction(SIGUSR1, &act, NULL) < 0) {\n\t\tperror(\"sigaction SIGUSR1\");\n\t\texit(1);\n\t}\n\tif (sigaction(SIGALRM, &act, NULL) < 0) {\n\t\tperror(\"sigaction SIGALRM\");\n\t\texit(1);\n\t}\n\n\t \n\tfor(i  = 0; i < 1000; i++) {\n\t\tpid = fork();\n\t\tif (pid == -1) {\n\t\t\tperror(\"fork\");\n\t\t\texit(1);\n\t\t}\n\t\tif (pid == 0) {\n\t\t\tsignal_self(ppid, SIGUSR1);\n\t\t\texit(1);\n\t\t} else {\n\t\t\talarm(0);  \n\t\t\talarm(2);\n\t\t\twhile (!signaled && !fail)\n\t\t\t\tasm volatile(\"\": : :\"memory\");\n\t\t\tif (!signaled) {\n\t\t\t\tfprintf(stderr, \"Didn't get signal from child\\n\");\n\t\t\t\tFAIL_IF(1);  \n\t\t\t}\n\t\t\t \n\t\t\twaitpid(pid, NULL, 0);\n\t\t}\n\t}\n\n\tfor (i = 0; i < MAX_ATTEMPT; i++) {\n\t\tlong rc;\n\n\t\talarm(0);  \n\t\tsignaled = 0;\n\t\talarm(TIMEOUT);\n\t\trc = signal_self(ppid, SIGUSR1);\n\t\tif (rc) {\n\t\t\tfprintf(stderr, \"(%d) Fail reason: %d rc=0x%lx\",\n\t\t\t\t\ti, fail, rc);\n\t\t\tFAIL_IF(1);  \n\t\t}\n\t\twhile (!signaled && !fail)\n\t\t\tasm volatile(\"\": : :\"memory\");\n\t\tif (!signaled) {\n\t\t\tfprintf(stderr, \"(%d) Fail reason: %d rc=0x%lx\",\n\t\t\t\t\ti, fail, rc);\n\t\t\tFAIL_IF(1);  \n\t\t}\n\t}\n\n\treturn 0;\n}\n\nint main(void)\n{\n\ttest_harness_set_timeout(300);\n\treturn test_harness(test_signal, \"signal\");\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}