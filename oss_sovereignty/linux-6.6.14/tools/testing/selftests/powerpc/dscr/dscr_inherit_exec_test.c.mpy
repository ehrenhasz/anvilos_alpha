{
  "module_name": "dscr_inherit_exec_test.c",
  "hash_id": "7f8b69333346ddb2fd20404a812858f61bbd2e3fc0fc12079c903cf8c9876d0f",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/powerpc/dscr/dscr_inherit_exec_test.c",
  "human_readable_source": "\n \n#include \"dscr.h\"\n\nstatic char *prog;\n\nstatic void do_exec(unsigned long parent_dscr)\n{\n\tunsigned long cur_dscr, cur_dscr_usr;\n\n\tcur_dscr = get_dscr();\n\tcur_dscr_usr = get_dscr_usr();\n\n\tif (cur_dscr != parent_dscr) {\n\t\tfprintf(stderr, \"Parent DSCR %ld was not inherited \"\n\t\t\t\t\"over exec (kernel value)\\n\", parent_dscr);\n\t\texit(1);\n\t}\n\n\tif (cur_dscr_usr != parent_dscr) {\n\t\tfprintf(stderr, \"Parent DSCR %ld was not inherited \"\n\t\t\t\t\"over exec (user value)\\n\", parent_dscr);\n\t\texit(1);\n\t}\n\texit(0);\n}\n\nint dscr_inherit_exec(void)\n{\n\tunsigned long i, dscr = 0;\n\tpid_t pid;\n\n\tSKIP_IF(!have_hwcap2(PPC_FEATURE2_DSCR));\n\n\tfor (i = 0; i < COUNT; i++) {\n\t\tdscr++;\n\t\tif (dscr > DSCR_MAX)\n\t\t\tdscr = 0;\n\n\t\tif (dscr == get_default_dscr())\n\t\t\tcontinue;\n\n\t\tif (i % 2 == 0)\n\t\t\tset_dscr_usr(dscr);\n\t\telse\n\t\t\tset_dscr(dscr);\n\n\t\tpid = fork();\n\t\tif (pid == -1) {\n\t\t\tperror(\"fork() failed\");\n\t\t\texit(1);\n\t\t} else if (pid) {\n\t\t\tint status;\n\n\t\t\tif (waitpid(pid, &status, 0) == -1) {\n\t\t\t\tperror(\"waitpid() failed\");\n\t\t\t\texit(1);\n\t\t\t}\n\n\t\t\tif (!WIFEXITED(status)) {\n\t\t\t\tfprintf(stderr, \"Child didn't exit cleanly\\n\");\n\t\t\t\texit(1);\n\t\t\t}\n\n\t\t\tif (WEXITSTATUS(status) != 0) {\n\t\t\t\tfprintf(stderr, \"Child didn't exit cleanly\\n\");\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t} else {\n\t\t\tchar dscr_str[16];\n\n\t\t\tsprintf(dscr_str, \"%ld\", dscr);\n\t\t\texeclp(prog, prog, \"exec\", dscr_str, NULL);\n\t\t\texit(1);\n\t\t}\n\t}\n\treturn 0;\n}\n\nint main(int argc, char *argv[])\n{\n\tif (argc == 3 && !strcmp(argv[1], \"exec\")) {\n\t\tunsigned long parent_dscr;\n\n\t\tparent_dscr = atoi(argv[2]);\n\t\tdo_exec(parent_dscr);\n\t} else if (argc != 1) {\n\t\tfprintf(stderr, \"Usage: %s\\n\", argv[0]);\n\t\texit(1);\n\t}\n\n\tprog = argv[0];\n\treturn test_harness(dscr_inherit_exec, \"dscr_inherit_exec_test\");\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}