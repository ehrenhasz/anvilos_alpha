{
  "module_name": "dscr_sysfs_test.c",
  "hash_id": "9c615a25d879310acfac17ad2c6714831fcc9c9e44005647c24d7826083d0eaf",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/powerpc/dscr/dscr_sysfs_test.c",
  "human_readable_source": "\n \n#include \"dscr.h\"\n\nstatic int check_cpu_dscr_default(char *file, unsigned long val)\n{\n\tunsigned long cpu_dscr;\n\tint err;\n\n\terr = read_ulong(file, &cpu_dscr, 16);\n\tif (err)\n\t\treturn err;\n\n\tif (cpu_dscr != val) {\n\t\tprintf(\"DSCR match failed: %ld (system) %ld (cpu)\\n\",\n\t\t\t\t\tval, cpu_dscr);\n\t\treturn 1;\n\t}\n\treturn 0;\n}\n\nstatic int check_all_cpu_dscr_defaults(unsigned long val)\n{\n\tDIR *sysfs;\n\tstruct dirent *dp;\n\tchar file[LEN_MAX];\n\n\tsysfs = opendir(CPU_PATH);\n\tif (!sysfs) {\n\t\tperror(\"opendir() failed\");\n\t\treturn 1;\n\t}\n\n\twhile ((dp = readdir(sysfs))) {\n\t\tint len;\n\n\t\tif (!(dp->d_type & DT_DIR))\n\t\t\tcontinue;\n\t\tif (!strcmp(dp->d_name, \"cpuidle\"))\n\t\t\tcontinue;\n\t\tif (!strstr(dp->d_name, \"cpu\"))\n\t\t\tcontinue;\n\n\t\tlen = snprintf(file, LEN_MAX, \"%s%s/dscr\", CPU_PATH, dp->d_name);\n\t\tif (len >= LEN_MAX)\n\t\t\tcontinue;\n\t\tif (access(file, F_OK))\n\t\t\tcontinue;\n\n\t\tif (check_cpu_dscr_default(file, val)) {\n\t\t\tclosedir(sysfs);\n\t\t\treturn 1;\n\t\t}\n\t}\n\tclosedir(sysfs);\n\treturn 0;\n}\n\nint dscr_sysfs(void)\n{\n\tunsigned long orig_dscr_default;\n\n\tSKIP_IF(!have_hwcap2(PPC_FEATURE2_DSCR));\n\n\torig_dscr_default = get_default_dscr();\n\tfor (int i = 0; i < DSCR_MAX; i++) {\n\t\tset_default_dscr(i);\n\t\tif (check_all_cpu_dscr_defaults(i))\n\t\t\tgoto fail;\n\t}\n\tset_default_dscr(orig_dscr_default);\n\treturn 0;\nfail:\n\tset_default_dscr(orig_dscr_default);\n\treturn 1;\n}\n\nint main(int argc, char *argv[])\n{\n\treturn test_harness(dscr_sysfs, \"dscr_sysfs_test\");\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}