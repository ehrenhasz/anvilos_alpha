{
  "module_name": "attr_test.c",
  "hash_id": "9006125799656beee840fab562ba870ff46ce6026ee068d4402a0d4a415abb37",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/powerpc/papr_attributes/attr_test.c",
  "human_readable_source": "\n \n\n#include <errno.h>\n#include <stdio.h>\n#include <string.h>\n#include <dirent.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <unistd.h>\n#include <stdlib.h>\n\n#include \"utils.h\"\n\nenum energy_freq_attrs {\n\tPOWER_PERFORMANCE_MODE = 1,\n\tIDLE_POWER_SAVER_STATUS = 2,\n\tMIN_FREQ = 3,\n\tSTAT_FREQ = 4,\n\tMAX_FREQ = 6,\n\tPROC_FOLDING_STATUS = 8\n};\n\nenum type {\n\tINVALID,\n\tSTR_VAL,\n\tNUM_VAL\n};\n\nstatic int value_type(int id)\n{\n\tint val_type;\n\n\tswitch (id) {\n\tcase POWER_PERFORMANCE_MODE:\n\tcase IDLE_POWER_SAVER_STATUS:\n\t\tval_type = STR_VAL;\n\t\tbreak;\n\tcase MIN_FREQ:\n\tcase STAT_FREQ:\n\tcase MAX_FREQ:\n\tcase PROC_FOLDING_STATUS:\n\t\tval_type = NUM_VAL;\n\t\tbreak;\n\tdefault:\n\t\tval_type = INVALID;\n\t}\n\n\treturn val_type;\n}\n\nstatic int verify_energy_info(void)\n{\n\tconst char *path = \"/sys/firmware/papr/energy_scale_info\";\n\tstruct dirent *entry;\n\tstruct stat s;\n\tDIR *dirp;\n\n\terrno = 0;\n\tif (stat(path, &s)) {\n\t\tSKIP_IF(errno == ENOENT);\n\t\tFAIL_IF(errno);\n\t}\n\n\tFAIL_IF(!S_ISDIR(s.st_mode));\n\n\tdirp = opendir(path);\n\n\twhile ((entry = readdir(dirp)) != NULL) {\n\t\tchar file_name[64];\n\t\tint id, attr_type;\n\t\tFILE *f;\n\n\t\tif (strcmp(entry->d_name, \".\") == 0 ||\n\t\t    strcmp(entry->d_name, \"..\") == 0)\n\t\t\tcontinue;\n\n\t\tid = atoi(entry->d_name);\n\t\tattr_type = value_type(id);\n\t\tFAIL_IF(attr_type == INVALID);\n\n\t\t \n\t\tsprintf(file_name, \"%s/%d/desc\", path, id);\n\t\tf = fopen(file_name, \"r\");\n\t\tFAIL_IF(!f);\n\t\tFAIL_IF(fgetc(f) == EOF);\n\n\t\tsprintf(file_name, \"%s/%d/value\", path, id);\n\t\tf = fopen(file_name, \"r\");\n\t\tFAIL_IF(!f);\n\t\tFAIL_IF(fgetc(f) == EOF);\n\n\t\tif (attr_type == STR_VAL) {\n\t\t\tsprintf(file_name, \"%s/%d/value_desc\", path, id);\n\t\t\tf = fopen(file_name, \"r\");\n\t\t\tFAIL_IF(!f);\n\t\t\tFAIL_IF(fgetc(f) == EOF);\n\t\t}\n\t}\n\n\treturn 0;\n}\n\nint main(void)\n{\n\treturn test_harness(verify_energy_info, \"papr_attributes\");\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}