{
  "module_name": "vmx_preempt.c",
  "hash_id": "83f90f036e88e494a5d20b54138b729fae20934db077bb13fbfa84a624de3471",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/powerpc/math/vmx_preempt.c",
  "human_readable_source": "\n \n\n#include <stdio.h>\n#include <unistd.h>\n#include <sys/syscall.h>\n#include <sys/time.h>\n#include <sys/types.h>\n#include <sys/wait.h>\n#include <stdlib.h>\n#include <pthread.h>\n\n#include \"utils.h\"\n\n \n#define PREEMPT_TIME 20\n \n#define THREAD_FACTOR 8\n\n__thread vector int varray[] = {{1, 2, 3, 4}, {5, 6, 7, 8}, {9, 10,11,12},\n\t{13,14,15,16},{17,18,19,20},{21,22,23,24},\n\t{25,26,27,28},{29,30,31,32},{33,34,35,36},\n\t{37,38,39,40},{41,42,43,44},{45,46,47,48}};\n\nint threads_starting;\nint running;\n\nextern int preempt_vmx(vector int *varray, int *threads_starting, int *running);\n\nvoid *preempt_vmx_c(void *p)\n{\n\tint i, j;\n\tlong rc;\n\n\tsrand(pthread_self());\n\tfor (i = 0; i < 12; i++)\n\t\tfor (j = 0; j < 4; j++)\n\t\t\tvarray[i][j] = rand();\n\n\trc = preempt_vmx(varray, &threads_starting, &running);\n\n\treturn (void *)rc;\n}\n\nint test_preempt_vmx(void)\n{\n\tint i, rc, threads;\n\tpthread_t *tids;\n\n\t \n\tSKIP_IF(!have_hwcap2(PPC_FEATURE2_ARCH_2_07));\n\n\tthreads = sysconf(_SC_NPROCESSORS_ONLN) * THREAD_FACTOR;\n\ttids = malloc(threads * sizeof(pthread_t));\n\tFAIL_IF(!tids);\n\n\trunning = true;\n\tthreads_starting = threads;\n\tfor (i = 0; i < threads; i++) {\n\t\trc = pthread_create(&tids[i], NULL, preempt_vmx_c, NULL);\n\t\tFAIL_IF(rc);\n\t}\n\n\tsetbuf(stdout, NULL);\n\t \n\tprintf(\"\\tWaiting for all workers to start...\");\n\twhile(threads_starting)\n\t\tasm volatile(\"\": : :\"memory\");\n\tprintf(\"done\\n\");\n\n\tprintf(\"\\tWaiting for %d seconds to let some workers get preempted...\", PREEMPT_TIME);\n\tsleep(PREEMPT_TIME);\n\tprintf(\"done\\n\");\n\n\tprintf(\"\\tStopping workers...\");\n\t \n\trunning = 0;\n\tfor (i = 0; i < threads; i++) {\n\t\tvoid *rc_p;\n\t\tpthread_join(tids[i], &rc_p);\n\n\t\t \n\t\tif ((long) rc_p)\n\t\t\tprintf(\"oops\\n\");\n\t\tFAIL_IF((long) rc_p);\n\t}\n\tprintf(\"done\\n\");\n\n\treturn 0;\n}\n\nint main(int argc, char *argv[])\n{\n\treturn test_harness(test_preempt_vmx, \"vmx_preempt\");\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}