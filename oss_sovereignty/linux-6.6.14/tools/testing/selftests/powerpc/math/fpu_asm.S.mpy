{
  "module_name": "fpu_asm.S",
  "hash_id": "80dba9d056dbc4c41a28fad5bf509247d41ad43445c1e5b0080844230b82eed4",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/powerpc/math/fpu_asm.S",
  "human_readable_source": " \n \n\n#include \"basic_asm.h\"\n#include \"fpu_asm.h\"\n\nFUNC_START(check_fpu)\n\tmr r4,r3\n\tli\tr3,1 # assume a bad result\n\tlfd\tf0,0(r4)\n\tfcmpu\tcr1,f0,f14\n\tbne\tcr1,1f\n\tlfd\tf0,8(r4)\n\tfcmpu\tcr1,f0,f15\n\tbne\tcr1,1f\n\tlfd\tf0,16(r4)\n\tfcmpu\tcr1,f0,f16\n\tbne\tcr1,1f\n\tlfd\tf0,24(r4)\n\tfcmpu\tcr1,f0,f17\n\tbne\tcr1,1f\n\tlfd\tf0,32(r4)\n\tfcmpu\tcr1,f0,f18\n\tbne\tcr1,1f\n\tlfd\tf0,40(r4)\n\tfcmpu\tcr1,f0,f19\n\tbne\tcr1,1f\n\tlfd\tf0,48(r4)\n\tfcmpu\tcr1,f0,f20\n\tbne\tcr1,1f\n\tlfd\tf0,56(r4)\n\tfcmpu\tcr1,f0,f21\n\tbne\tcr1,1f\n\tlfd\tf0,64(r4)\n\tfcmpu\tcr1,f0,f22\n\tbne\tcr1,1f\n\tlfd\tf0,72(r4)\n\tfcmpu\tcr1,f0,f23\n\tbne\tcr1,1f\n\tlfd\tf0,80(r4)\n\tfcmpu\tcr1,f0,f24\n\tbne\tcr1,1f\n\tlfd\tf0,88(r4)\n\tfcmpu\tcr1,f0,f25\n\tbne\tcr1,1f\n\tlfd\tf0,96(r4)\n\tfcmpu\tcr1,f0,f26\n\tbne\tcr1,1f\n\tlfd\tf0,104(r4)\n\tfcmpu\tcr1,f0,f27\n\tbne\tcr1,1f\n\tlfd\tf0,112(r4)\n\tfcmpu\tcr1,f0,f28\n\tbne\tcr1,1f\n\tlfd\tf0,120(r4)\n\tfcmpu\tcr1,f0,f29\n\tbne\tcr1,1f\n\tlfd\tf0,128(r4)\n\tfcmpu\tcr1,f0,f30\n\tbne\tcr1,1f\n\tlfd\tf0,136(r4)\n\tfcmpu\tcr1,f0,f31\n\tbne\tcr1,1f\n\tli\tr3,0 # Success!!!\n1:\tblr\n\nFUNC_START(test_fpu)\n\t# r3 holds pointer to where to put the result of fork\n\t# r4 holds pointer to the pid\n\t# f14-f31 are non volatiles\n\tPUSH_BASIC_STACK(256)\n\tPUSH_FPU(256)\n\tstd\tr3,STACK_FRAME_PARAM(0)(sp) # Address of darray\n\tstd r4,STACK_FRAME_PARAM(1)(sp) # Address of pid\n\n\tbl load_fpu\n\tnop\n\tli\tr0,__NR_fork\n\tsc\n\n\t# pass the result of the fork to the caller\n\tld\tr9,STACK_FRAME_PARAM(1)(sp)\n\tstd\tr3,0(r9)\n\n\tld r3,STACK_FRAME_PARAM(0)(sp)\n\tbl check_fpu\n\tnop\n\n\tPOP_FPU(256)\n\tPOP_BASIC_STACK(256)\n\tblr\nFUNC_END(test_fpu)\n\n# int preempt_fpu(double *darray, int *threads_running, int *running)\n# On starting will (atomically) decrement not_ready as a signal that the FPU\n# has been loaded with darray. Will proceed to check the validity of the FPU\n# registers while running is not zero.\nFUNC_START(preempt_fpu)\n\tPUSH_BASIC_STACK(256)\n\tPUSH_FPU(256)\n\tstd r3,STACK_FRAME_PARAM(0)(sp) # double *darray\n\tstd r4,STACK_FRAME_PARAM(1)(sp) # int *threads_starting\n\tstd r5,STACK_FRAME_PARAM(2)(sp) # int *running\n\n\tbl load_fpu\n\tnop\n\n\tsync\n\t# Atomic DEC\n\tld r3,STACK_FRAME_PARAM(1)(sp)\n1:\tlwarx r4,0,r3\n\taddi r4,r4,-1\n\tstwcx. r4,0,r3\n\tbne- 1b\n\n2:\tld r3,STACK_FRAME_PARAM(0)(sp)\n\tbl check_fpu\n\tnop\n\tcmpdi r3,0\n\tbne 3f\n\tld r4,STACK_FRAME_PARAM(2)(sp)\n\tld r5,0(r4)\n\tcmpwi r5,0\n\tbne 2b\n\n3:\tPOP_FPU(256)\n\tPOP_BASIC_STACK(256)\n\tblr\nFUNC_END(preempt_fpu)\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}