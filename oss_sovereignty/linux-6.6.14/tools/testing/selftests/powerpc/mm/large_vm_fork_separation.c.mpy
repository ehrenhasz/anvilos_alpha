{
  "module_name": "large_vm_fork_separation.c",
  "hash_id": "32e17f5304e3cb299b5506d5bf97c57f84ae59192942263a587c0fe04a0107ca",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/powerpc/mm/large_vm_fork_separation.c",
  "human_readable_source": "\n\n\n\n\n\n\n\n#include <stdio.h>\n#include <stdlib.h>\n#include <sys/mman.h>\n#include <sys/types.h>\n#include <sys/wait.h>\n#include <unistd.h>\n\n#include \"utils.h\"\n\n\n#ifndef MAP_FIXED_NOREPLACE\n#define MAP_FIXED_NOREPLACE\tMAP_FIXED\t\n#endif\n\n\nstatic int test(void)\n{\n\tint p2c[2], c2p[2], rc, status, c, *p;\n\tunsigned long page_size;\n\tpid_t pid;\n\n\tpage_size = sysconf(_SC_PAGESIZE);\n\tSKIP_IF(page_size != 65536);\n\n\t\n\tp = mmap((void *)(512ul << 40), page_size, PROT_READ | PROT_WRITE,\n\t\tMAP_PRIVATE | MAP_ANONYMOUS | MAP_FIXED_NOREPLACE, -1, 0);\n\tif (p == MAP_FAILED) {\n\t\tperror(\"mmap\");\n\t\tprintf(\"Error: couldn't mmap(), confirm kernel has 4TB support?\\n\");\n\t\treturn 1;\n\t}\n\n\tprintf(\"parent writing %p = 1\\n\", p);\n\t*p = 1;\n\n\tFAIL_IF(pipe(p2c) == -1 || pipe(c2p) == -1);\n\n\tpid = fork();\n\tif (pid == 0) {\n\t\tFAIL_IF(read(p2c[0], &c, 1) != 1);\n\n\t\tpid = getpid();\n\t\tprintf(\"child writing  %p = %d\\n\", p, pid);\n\t\t*p = pid;\n\n\t\tFAIL_IF(write(c2p[1], &c, 1) != 1);\n\t\tFAIL_IF(read(p2c[0], &c, 1) != 1);\n\t\texit(0);\n\t}\n\n\tc = 0;\n\tFAIL_IF(write(p2c[1], &c, 1) != 1);\n\tFAIL_IF(read(c2p[0], &c, 1) != 1);\n\n\t\n\tbarrier();\n\n\trc = 0;\n\tprintf(\"parent reading %p = %d\\n\", p, *p);\n\tif (*p != 1) {\n\t\tprintf(\"Error: BUG! parent saw child's write! *p = %d\\n\", *p);\n\t\trc = 1;\n\t}\n\n\tFAIL_IF(write(p2c[1], &c, 1) != 1);\n\tFAIL_IF(waitpid(pid, &status, 0) == -1);\n\tFAIL_IF(!WIFEXITED(status) || WEXITSTATUS(status));\n\n\tif (rc == 0)\n\t\tprintf(\"success: test completed OK\\n\");\n\n\treturn rc;\n}\n\nint main(void)\n{\n\treturn test_harness(test, \"large_vm_fork_separation\");\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}