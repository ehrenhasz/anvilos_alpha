{
  "module_name": "mmap_bench.c",
  "hash_id": "bda4fc10caedf4a724913a64b4741caa9934126c7b015f570866648b3f9b96b2",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/powerpc/benchmarks/mmap_bench.c",
  "human_readable_source": "\n \n\n#include <stdio.h>\n#include <stdlib.h>\n#include <sys/mman.h>\n#include <time.h>\n#include <getopt.h>\n\n#include \"utils.h\"\n\n#define ITERATIONS 5000000\n\n#define MEMSIZE (1UL << 27)\n#define PAGE_SIZE (1UL << 16)\n#define CHUNK_COUNT (MEMSIZE/PAGE_SIZE)\n\nstatic int pg_fault;\nstatic int iterations = ITERATIONS;\n\nstatic struct option options[] = {\n\t{ \"pgfault\", no_argument, &pg_fault, 1 },\n\t{ \"iterations\", required_argument, 0, 'i' },\n\t{ 0, },\n};\n\nstatic void usage(void)\n{\n\tprintf(\"mmap_bench <--pgfault> <--iterations count>\\n\");\n}\n\nint test_mmap(void)\n{\n\tstruct timespec ts_start, ts_end;\n\tunsigned long i = iterations;\n\n\tclock_gettime(CLOCK_MONOTONIC, &ts_start);\n\n\twhile (i--) {\n\t\tchar *c = mmap(NULL, MEMSIZE, PROT_READ|PROT_WRITE,\n\t\t\t       MAP_PRIVATE|MAP_ANONYMOUS, -1, 0);\n\t\tFAIL_IF(c == MAP_FAILED);\n\t\tif (pg_fault) {\n\t\t\tint count;\n\t\t\tfor (count = 0; count < CHUNK_COUNT; count++)\n\t\t\t\tc[count << 16] = 'c';\n\t\t}\n\t\tmunmap(c, MEMSIZE);\n\t}\n\n\tclock_gettime(CLOCK_MONOTONIC, &ts_end);\n\n\tprintf(\"time = %.6f\\n\", ts_end.tv_sec - ts_start.tv_sec + (ts_end.tv_nsec - ts_start.tv_nsec) / 1e9);\n\n\treturn 0;\n}\n\nint main(int argc, char *argv[])\n{\n\tsigned char c;\n\twhile (1) {\n\t\tint option_index = 0;\n\n\t\tc = getopt_long(argc, argv, \"\", options, &option_index);\n\n\t\tif (c == -1)\n\t\t\tbreak;\n\n\t\tswitch (c) {\n\t\tcase 0:\n\t\t\tif (options[option_index].flag != 0)\n\t\t\t\tbreak;\n\n\t\t\tusage();\n\t\t\texit(1);\n\t\t\tbreak;\n\t\tcase 'i':\n\t\t\titerations = atoi(optarg);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tusage();\n\t\t\texit(1);\n\t\t}\n\t}\n\n\ttest_harness_set_timeout(300);\n\treturn test_harness(test_mmap, \"mmap_bench\");\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}