{
  "module_name": "utils.h",
  "hash_id": "9656558b63be587da8160955d94cdaeba949684a3884fc4646ce05edcffe2014",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/powerpc/include/utils.h",
  "human_readable_source": " \n \n\n#ifndef _SELFTESTS_POWERPC_UTILS_H\n#define _SELFTESTS_POWERPC_UTILS_H\n\n#define __cacheline_aligned __attribute__((aligned(128)))\n\n#include <stdint.h>\n#include <stdio.h>\n#include <stdbool.h>\n#include <sys/signal.h>\n#include <linux/auxvec.h>\n#include <linux/perf_event.h>\n#include <asm/cputable.h>\n#include \"reg.h\"\n#include <unistd.h>\n\n#ifndef ARRAY_SIZE\n# define ARRAY_SIZE(x) (sizeof(x) / sizeof((x)[0]))\n#endif\n\n \ntypedef unsigned long long u64;\ntypedef   signed long long s64;\n\n \ntypedef uint32_t u32;\ntypedef uint16_t u16;\ntypedef uint8_t u8;\n\nvoid test_harness_set_timeout(uint64_t time);\nint test_harness(int (test_function)(void), const char *name);\n\nint read_auxv(char *buf, ssize_t buf_size);\nvoid *find_auxv_entry(int type, char *auxv);\nvoid *get_auxv_entry(int type);\n\n#define BIND_CPU_ANY\t(-1)\n\nint pick_online_cpu(void);\nint bind_to_cpu(int cpu);\n\nint parse_intmax(const char *buffer, size_t count, intmax_t *result, int base);\nint parse_uintmax(const char *buffer, size_t count, uintmax_t *result, int base);\nint parse_int(const char *buffer, size_t count, int *result, int base);\nint parse_uint(const char *buffer, size_t count, unsigned int *result, int base);\nint parse_long(const char *buffer, size_t count, long *result, int base);\nint parse_ulong(const char *buffer, size_t count, unsigned long *result, int base);\n\nint read_file(const char *path, char *buf, size_t count, size_t *len);\nint write_file(const char *path, const char *buf, size_t count);\nint read_file_alloc(const char *path, char **buf, size_t *len);\nint read_long(const char *path, long *result, int base);\nint write_long(const char *path, long result, int base);\nint read_ulong(const char *path, unsigned long *result, int base);\nint write_ulong(const char *path, unsigned long result, int base);\nint read_debugfs_file(const char *debugfs_file, char *buf, size_t count);\nint write_debugfs_file(const char *debugfs_file, const char *buf, size_t count);\nint read_debugfs_int(const char *debugfs_file, int *result);\nint write_debugfs_int(const char *debugfs_file, int result);\nint read_sysfs_file(char *debugfs_file, char *result, size_t result_size);\nint perf_event_open_counter(unsigned int type,\n\t\t\t    unsigned long config, int group_fd);\nint perf_event_enable(int fd);\nint perf_event_disable(int fd);\nint perf_event_reset(int fd);\n\nstruct perf_event_read {\n\t__u64 nr;\n\t__u64 l1d_misses;\n};\n\n#if !defined(__GLIBC_PREREQ) || !__GLIBC_PREREQ(2, 30)\n#include <sys/syscall.h>\n\nstatic inline pid_t gettid(void)\n{\n\treturn syscall(SYS_gettid);\n}\n#endif\n\nstatic inline bool have_hwcap(unsigned long ftr)\n{\n\treturn ((unsigned long)get_auxv_entry(AT_HWCAP) & ftr) == ftr;\n}\n\n#ifdef AT_HWCAP2\nstatic inline bool have_hwcap2(unsigned long ftr2)\n{\n\treturn ((unsigned long)get_auxv_entry(AT_HWCAP2) & ftr2) == ftr2;\n}\n#else\nstatic inline bool have_hwcap2(unsigned long ftr2)\n{\n\treturn false;\n}\n#endif\n\nstatic inline char *auxv_base_platform(void)\n{\n\treturn ((char *)get_auxv_entry(AT_BASE_PLATFORM));\n}\n\nstatic inline char *auxv_platform(void)\n{\n\treturn ((char *)get_auxv_entry(AT_PLATFORM));\n}\n\nbool is_ppc64le(void);\nint using_hash_mmu(bool *using_hash);\n\nstruct sigaction push_signal_handler(int sig, void (*fn)(int, siginfo_t *, void *));\nstruct sigaction pop_signal_handler(int sig, struct sigaction old_handler);\n\n \n#define FAIL_IF(x)\t\t\t\t\t\t\\\ndo {\t\t\t\t\t\t\t\t\\\n\tif ((x)) {\t\t\t\t\t\t\\\n\t\tfprintf(stderr,\t\t\t\t\t\\\n\t\t\"[FAIL] Test FAILED on line %d\\n\", __LINE__);\t\\\n\t\treturn 1;\t\t\t\t\t\\\n\t}\t\t\t\t\t\t\t\\\n} while (0)\n\n#define FAIL_IF_MSG(x, msg)\t\t\t\t\t\\\ndo {\t\t\t\t\t\t\t\t\\\n\tif ((x)) {\t\t\t\t\t\t\\\n\t\tfprintf(stderr,\t\t\t\t\t\\\n\t\t\"[FAIL] Test FAILED on line %d: %s\\n\", \t\t\\\n\t\t__LINE__, msg);\t\t\t\t\t\\\n\t\treturn 1;\t\t\t\t\t\\\n\t}\t\t\t\t\t\t\t\\\n} while (0)\n\n#define FAIL_IF_EXIT(x)\t\t\t\t\t\t\\\ndo {\t\t\t\t\t\t\t\t\\\n\tif ((x)) {\t\t\t\t\t\t\\\n\t\tfprintf(stderr,\t\t\t\t\t\\\n\t\t\"[FAIL] Test FAILED on line %d\\n\", __LINE__);\t\\\n\t\t_exit(1);\t\t\t\t\t\\\n\t}\t\t\t\t\t\t\t\\\n} while (0)\n\n#define FAIL_IF_EXIT_MSG(x, msg)\t\t\t\t\\\ndo {\t\t\t\t\t\t\t\t\\\n\tif ((x)) {\t\t\t\t\t\t\\\n\t\tfprintf(stderr,\t\t\t\t\t\\\n\t\t\"[FAIL] Test FAILED on line %d: %s\\n\", \t\t\\\n\t\t__LINE__, msg);\t\t\t\t\t\\\n\t\t_exit(1);\t\t\t\t\t\\\n\t}\t\t\t\t\t\t\t\\\n} while (0)\n\n \n#define MAGIC_SKIP_RETURN_VALUE\t99\n\n#define SKIP_IF(x)\t\t\t\t\t\t\\\ndo {\t\t\t\t\t\t\t\t\\\n\tif ((x)) {\t\t\t\t\t\t\\\n\t\tfprintf(stderr,\t\t\t\t\t\\\n\t\t\"[SKIP] Test skipped on line %d\\n\", __LINE__);\t\\\n\t\treturn MAGIC_SKIP_RETURN_VALUE;\t\t\t\\\n\t}\t\t\t\t\t\t\t\\\n} while (0)\n\n#define SKIP_IF_MSG(x, msg)\t\t\t\t\t\\\ndo {\t\t\t\t\t\t\t\t\\\n\tif ((x)) {\t\t\t\t\t\t\\\n\t\tfprintf(stderr,\t\t\t\t\t\\\n\t\t\"[SKIP] Test skipped on line %d: %s\\n\",\t\t\\\n\t\t __LINE__, msg);\t\t\t\t\\\n\t\treturn MAGIC_SKIP_RETURN_VALUE;\t\t\t\\\n\t}\t\t\t\t\t\t\t\\\n} while (0)\n\n#define _str(s) #s\n#define str(s) _str(s)\n\n#define sigsafe_err(msg)\t({ \\\n\t\tssize_t nbytes __attribute__((unused)); \\\n\t\tnbytes = write(STDERR_FILENO, msg, strlen(msg)); })\n\n \n#ifndef PPC_FEATURE2_ARCH_3_00\n#define PPC_FEATURE2_ARCH_3_00 0x00800000\n#endif\n\n \n#ifndef PPC_FEATURE2_ARCH_3_1\n#define PPC_FEATURE2_ARCH_3_1 0x00040000\n#endif\n\n \n#ifndef PPC_FEATURE2_MMA\n#define PPC_FEATURE2_MMA 0x00020000\n#endif\n\n#if defined(__powerpc64__)\n#define UCONTEXT_NIA(UC)\t(UC)->uc_mcontext.gp_regs[PT_NIP]\n#define UCONTEXT_MSR(UC)\t(UC)->uc_mcontext.gp_regs[PT_MSR]\n#elif defined(__powerpc__)\n#define UCONTEXT_NIA(UC)\t(UC)->uc_mcontext.uc_regs->gregs[PT_NIP]\n#define UCONTEXT_MSR(UC)\t(UC)->uc_mcontext.uc_regs->gregs[PT_MSR]\n#else\n#error implement UCONTEXT_NIA\n#endif\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}