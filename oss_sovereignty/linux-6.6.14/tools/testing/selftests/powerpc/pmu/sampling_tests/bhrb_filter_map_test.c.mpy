{
  "module_name": "bhrb_filter_map_test.c",
  "hash_id": "1d51a0521aabf8216f212489204299d15062dcdfccc3c7fb03f83adf08d9aa60",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/powerpc/pmu/sampling_tests/bhrb_filter_map_test.c",
  "human_readable_source": "\n \n\n#include <stdio.h>\n#include <stdlib.h>\n\n#include \"../event.h\"\n#include \"misc.h\"\n#include \"utils.h\"\n\n \n\n \n \nint bhrb_filter_map_valid_common[] = {\n\tPERF_SAMPLE_BRANCH_ANY,\n\tPERF_SAMPLE_BRANCH_ANY_CALL,\n};\n\n \nint bhrb_filter_map_valid_p10[] = {\n\tPERF_SAMPLE_BRANCH_IND_CALL,\n\tPERF_SAMPLE_BRANCH_COND,\n};\n\n#define EventCode 0x1001e\n\nstatic int bhrb_filter_map_test(void)\n{\n\tstruct event event;\n\tint i;\n\n\t \n\tSKIP_IF(platform_check_for_tests());\n\n\t \n\tSKIP_IF(check_for_generic_compat_pmu());\n\n\t \n\tevent_init(&event, EventCode);\n\n\tevent.attr.sample_period = 1000;\n\tevent.attr.sample_type = PERF_SAMPLE_BRANCH_STACK;\n\tevent.attr.disabled = 1;\n\n\t \n\tfor (i = PERF_SAMPLE_BRANCH_USER_SHIFT; i < PERF_SAMPLE_BRANCH_MAX_SHIFT; i++) {\n\t\t \n\t\tif (i == PERF_SAMPLE_BRANCH_ANY_SHIFT || i == PERF_SAMPLE_BRANCH_ANY_CALL_SHIFT \\\n\t\t\t|| i == PERF_SAMPLE_BRANCH_IND_CALL_SHIFT || i == PERF_SAMPLE_BRANCH_COND_SHIFT)\n\t\t\tcontinue;\n\t\tevent.attr.branch_sample_type = 1U << i;\n\t\tFAIL_IF(!event_open(&event));\n\t}\n\n\t \n\tfor (i = 0; i < ARRAY_SIZE(bhrb_filter_map_valid_common); i++) {\n\t\tevent.attr.branch_sample_type = bhrb_filter_map_valid_common[i];\n\t\tFAIL_IF(event_open(&event));\n\t\tevent_close(&event);\n\t}\n\n\t \n\tif (PVR_VER(mfspr(SPRN_PVR)) == POWER10) {\n\t\tfor (i = 0; i < ARRAY_SIZE(bhrb_filter_map_valid_p10); i++) {\n\t\t\tevent.attr.branch_sample_type = bhrb_filter_map_valid_p10[i];\n\t\t\tFAIL_IF(event_open(&event));\n\t\t\tevent_close(&event);\n\t\t}\n\t} else {\n\t\tfor (i = 0; i < ARRAY_SIZE(bhrb_filter_map_valid_p10); i++) {\n\t\t\tevent.attr.branch_sample_type = bhrb_filter_map_valid_p10[i];\n\t\t\tFAIL_IF(!event_open(&event));\n\t\t}\n\t}\n\n\t \n\tevent.attr.branch_sample_type = PERF_SAMPLE_BRANCH_ANY | PERF_SAMPLE_BRANCH_ANY_CALL;\n\tFAIL_IF(!event_open(&event));\n\n\treturn 0;\n}\n\nint main(void)\n{\n\treturn test_harness(bhrb_filter_map_test, \"bhrb_filter_map_test\");\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}