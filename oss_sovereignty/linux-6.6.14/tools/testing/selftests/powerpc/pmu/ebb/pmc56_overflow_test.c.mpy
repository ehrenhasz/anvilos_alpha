{
  "module_name": "pmc56_overflow_test.c",
  "hash_id": "fca77410f658ffcc75a330f5122e2a47224ef988ccf8d06db7552da86d5f5f1f",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/powerpc/pmu/ebb/pmc56_overflow_test.c",
  "human_readable_source": "\n \n\n#include <stdio.h>\n#include <stdlib.h>\n\n#include \"ebb.h\"\n\n\n \n\nstatic int pmc56_overflowed;\n\nstatic void ebb_callee(void)\n{\n\tuint64_t val;\n\n\tval = mfspr(SPRN_BESCR);\n\tif (!(val & BESCR_PMEO)) {\n\t\tebb_state.stats.spurious++;\n\t\tgoto out;\n\t}\n\n\tebb_state.stats.ebb_count++;\n\tcount_pmc(2, sample_period);\n\n\tval = mfspr(SPRN_PMC5);\n\tif (val >= COUNTER_OVERFLOW)\n\t\tpmc56_overflowed++;\n\n\tcount_pmc(5, COUNTER_OVERFLOW);\n\n\tval = mfspr(SPRN_PMC6);\n\tif (val >= COUNTER_OVERFLOW)\n\t\tpmc56_overflowed++;\n\n\tcount_pmc(6, COUNTER_OVERFLOW);\n\nout:\n\treset_ebb();\n}\n\nint pmc56_overflow(void)\n{\n\tstruct event event;\n\n\tSKIP_IF(!ebb_is_supported());\n\n\t \n\tevent_init(&event, 0x2001e);\n\tevent_leader_ebb_init(&event);\n\n\tevent.attr.exclude_kernel = 1;\n\tevent.attr.exclude_hv = 1;\n\tevent.attr.exclude_idle = 1;\n\n\tFAIL_IF(event_open(&event));\n\n\tsetup_ebb_handler(ebb_callee);\n\tebb_global_enable();\n\n\tFAIL_IF(ebb_event_enable(&event));\n\n\tmtspr(SPRN_PMC2, pmc_sample_period(sample_period));\n\tmtspr(SPRN_PMC5, 0);\n\tmtspr(SPRN_PMC6, 0);\n\n\twhile (ebb_state.stats.ebb_count < 10)\n\t\tFAIL_IF(core_busy_loop());\n\n\tebb_global_disable();\n\tebb_freeze_pmcs();\n\n\tdump_ebb_state();\n\n\tprintf(\"PMC5/6 overflow %d\\n\", pmc56_overflowed);\n\n\tevent_close(&event);\n\n\tFAIL_IF(ebb_state.stats.ebb_count == 0 || pmc56_overflowed != 0);\n\n\treturn 0;\n}\n\nint main(void)\n{\n\treturn test_harness(pmc56_overflow, \"pmc56_overflow\");\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}