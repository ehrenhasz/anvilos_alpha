{
  "module_name": "multi_ebb_procs_test.c",
  "hash_id": "11018e526380918d44f410e87296e0d7cf05f50788a8f9c65db9d79892fcd0e5",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/powerpc/pmu/ebb/multi_ebb_procs_test.c",
  "human_readable_source": "\n \n\n#include <stdbool.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n\n#include \"ebb.h\"\n\n\n \n\nstatic bool child_should_exit;\n\nstatic void sigint_handler(int signal)\n{\n\tchild_should_exit = true;\n}\n\nstruct sigaction sigint_action = {\n\t.sa_handler = sigint_handler,\n};\n\nstatic int cycles_child(void)\n{\n\tstruct event event;\n\n\tif (sigaction(SIGINT, &sigint_action, NULL)) {\n\t\tperror(\"sigaction\");\n\t\treturn 1;\n\t}\n\n\tevent_init_named(&event, 0x1001e, \"cycles\");\n\tevent_leader_ebb_init(&event);\n\n\tevent.attr.exclude_kernel = 1;\n\tevent.attr.exclude_hv = 1;\n\tevent.attr.exclude_idle = 1;\n\n\tFAIL_IF(event_open(&event));\n\n\tebb_enable_pmc_counting(1);\n\tsetup_ebb_handler(standard_ebb_callee);\n\tebb_global_enable();\n\n\tFAIL_IF(ebb_event_enable(&event));\n\n\tmtspr(SPRN_PMC1, pmc_sample_period(sample_period));\n\n\twhile (!child_should_exit) {\n\t\tFAIL_IF(core_busy_loop());\n\t\tFAIL_IF(ebb_check_mmcr0());\n\t}\n\n\tebb_global_disable();\n\tebb_freeze_pmcs();\n\n\tdump_summary_ebb_state();\n\n\tevent_close(&event);\n\n\tFAIL_IF(ebb_state.stats.ebb_count == 0);\n\n\treturn 0;\n}\n\n#define NR_CHILDREN\t4\n\nint multi_ebb_procs(void)\n{\n\tpid_t pids[NR_CHILDREN];\n\tint rc, i;\n\n\tSKIP_IF(!ebb_is_supported());\n\n\tFAIL_IF(bind_to_cpu(BIND_CPU_ANY) < 0);\n\n\tfor (i = 0; i < NR_CHILDREN; i++) {\n\t\tpids[i] = fork();\n\t\tif (pids[i] == 0)\n\t\t\texit(cycles_child());\n\t}\n\n\t \n\tsleep(10);\n\n\trc = 0;\n\tfor (i = 0; i < NR_CHILDREN; i++) {\n\t\t \n\t\tkill(pids[i], SIGINT);\n\t\t \n\t\trc |= wait_for_child(pids[i]);\n\t}\n\n\treturn rc;\n}\n\nint main(void)\n{\n\treturn test_harness(multi_ebb_procs, \"multi_ebb_procs\");\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}