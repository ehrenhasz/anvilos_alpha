{
  "module_name": "ebb_on_child_test.c",
  "hash_id": "2b0f23c96ea5482b26d74e1955fb7da182c0ddaa823c50a5a934476bc117e116",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/powerpc/pmu/ebb/ebb_on_child_test.c",
  "human_readable_source": "\n \n\n#include <signal.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdbool.h>\n#include <sys/types.h>\n#include <sys/wait.h>\n#include <unistd.h>\n\n#include \"ebb.h\"\n\n\n \n\nstatic int victim_child(union pipe read_pipe, union pipe write_pipe)\n{\n\tint i;\n\n\tFAIL_IF(wait_for_parent(read_pipe));\n\tFAIL_IF(notify_parent(write_pipe));\n\n\t \n\n\tFAIL_IF(wait_for_parent(read_pipe));\n\tFAIL_IF(notify_parent(write_pipe));\n\n\t \n\twrite_pmc1();\n\n\t \n\tfor (i = 0; i < 1000000; i++) ;\n\n\treturn 0;\n}\n\nint ebb_on_child(void)\n{\n\tunion pipe read_pipe, write_pipe;\n\tstruct event event;\n\tpid_t pid;\n\n\tSKIP_IF(!ebb_is_supported());\n\n\tFAIL_IF(pipe(read_pipe.fds) == -1);\n\tFAIL_IF(pipe(write_pipe.fds) == -1);\n\n\tpid = fork();\n\tif (pid == 0) {\n\t\t \n\t\texit(victim_child(write_pipe, read_pipe));\n\t}\n\n\tFAIL_IF(sync_with_child(read_pipe, write_pipe));\n\n\t \n\n\tevent_init_named(&event, 0x1001e, \"cycles\");\n\tevent_leader_ebb_init(&event);\n\n\tevent.attr.exclude_kernel = 1;\n\tevent.attr.exclude_hv = 1;\n\tevent.attr.exclude_idle = 1;\n\n\tFAIL_IF(event_open_with_pid(&event, pid));\n\tFAIL_IF(ebb_event_enable(&event));\n\n\tFAIL_IF(sync_with_child(read_pipe, write_pipe));\n\n\t \n\tFAIL_IF(wait_for_child(pid));\n\n\tevent_close(&event);\n\n\treturn 0;\n}\n\nint main(void)\n{\n\treturn test_harness(ebb_on_child, \"ebb_on_child\");\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}