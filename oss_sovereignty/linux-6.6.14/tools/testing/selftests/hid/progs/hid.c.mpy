{
  "module_name": "hid.c",
  "hash_id": "290f62da7437aacc82e1860ceddf891bd5e6293ef97778f0d3c31f6e7224bc5f",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/hid/progs/hid.c",
  "human_readable_source": "\n \n#include \"vmlinux.h\"\n#include <bpf/bpf_helpers.h>\n#include <bpf/bpf_tracing.h>\n#include \"hid_bpf_helpers.h\"\n\nchar _license[] SEC(\"license\") = \"GPL\";\n\nstruct attach_prog_args {\n\tint prog_fd;\n\tunsigned int hid;\n\tint retval;\n\tint insert_head;\n};\n\n__u64 callback_check = 52;\n__u64 callback2_check = 52;\n\nSEC(\"?fmod_ret/hid_bpf_device_event\")\nint BPF_PROG(hid_first_event, struct hid_bpf_ctx *hid_ctx)\n{\n\t__u8 *rw_data = hid_bpf_get_data(hid_ctx, 0  , 3  );\n\n\tif (!rw_data)\n\t\treturn 0;  \n\n\tcallback_check = rw_data[1];\n\n\trw_data[2] = rw_data[1] + 5;\n\n\treturn hid_ctx->size;\n}\n\nSEC(\"?fmod_ret/hid_bpf_device_event\")\nint BPF_PROG(hid_second_event, struct hid_bpf_ctx *hid_ctx)\n{\n\t__u8 *rw_data = hid_bpf_get_data(hid_ctx, 0  , 4  );\n\n\tif (!rw_data)\n\t\treturn 0;  \n\n\trw_data[3] = rw_data[2] + 5;\n\n\treturn hid_ctx->size;\n}\n\nSEC(\"?fmod_ret/hid_bpf_device_event\")\nint BPF_PROG(hid_change_report_id, struct hid_bpf_ctx *hid_ctx)\n{\n\t__u8 *rw_data = hid_bpf_get_data(hid_ctx, 0  , 3  );\n\n\tif (!rw_data)\n\t\treturn 0;  \n\n\trw_data[0] = 2;\n\n\treturn 9;\n}\n\nSEC(\"syscall\")\nint attach_prog(struct attach_prog_args *ctx)\n{\n\tctx->retval = hid_bpf_attach_prog(ctx->hid,\n\t\t\t\t\t  ctx->prog_fd,\n\t\t\t\t\t  ctx->insert_head ? HID_BPF_FLAG_INSERT_HEAD :\n\t\t\t\t\t\t\t     HID_BPF_FLAG_NONE);\n\treturn 0;\n}\n\nstruct hid_hw_request_syscall_args {\n\t \n\t__u8 data[10];\n\tunsigned int hid;\n\tint retval;\n\tsize_t size;\n\tenum hid_report_type type;\n\t__u8 request_type;\n};\n\nSEC(\"syscall\")\nint hid_user_raw_request(struct hid_hw_request_syscall_args *args)\n{\n\tstruct hid_bpf_ctx *ctx;\n\tconst size_t size = args->size;\n\tint i, ret = 0;\n\n\tif (size > sizeof(args->data))\n\t\treturn -7;  \n\n\tctx = hid_bpf_allocate_context(args->hid);\n\tif (!ctx)\n\t\treturn -1;  \n\n\tret = hid_bpf_hw_request(ctx,\n\t\t\t\t args->data,\n\t\t\t\t size,\n\t\t\t\t args->type,\n\t\t\t\t args->request_type);\n\targs->retval = ret;\n\n\thid_bpf_release_context(ctx);\n\n\treturn 0;\n}\n\nstatic const __u8 rdesc[] = {\n\t0x05, 0x01,\t\t\t\t \n\t0x09, 0x32,\t\t\t\t \n\t0x95, 0x01,\t\t\t\t \n\t0x81, 0x06,\t\t\t\t \n\n\t0x06, 0x00, 0xff,\t\t\t \n\t0x19, 0x01,\t\t\t\t \n\t0x29, 0x03,\t\t\t\t \n\t0x15, 0x00,\t\t\t\t \n\t0x25, 0x01,\t\t\t\t \n\t0x95, 0x03,\t\t\t\t \n\t0x75, 0x01,\t\t\t\t \n\t0x91, 0x02,\t\t\t\t \n\t0x95, 0x01,\t\t\t\t \n\t0x75, 0x05,\t\t\t\t \n\t0x91, 0x01,\t\t\t\t \n\n\t0x06, 0x00, 0xff,\t\t\t \n\t0x19, 0x06,\t\t\t\t \n\t0x29, 0x08,\t\t\t\t \n\t0x15, 0x00,\t\t\t\t \n\t0x25, 0x01,\t\t\t\t \n\t0x95, 0x03,\t\t\t\t \n\t0x75, 0x01,\t\t\t\t \n\t0xb1, 0x02,\t\t\t\t \n\t0x95, 0x01,\t\t\t\t \n\t0x75, 0x05,\t\t\t\t \n\t0x91, 0x01,\t\t\t\t \n\n\t0xc0,\t\t\t\t \n\t0xc0,\t\t\t \n};\n\nSEC(\"?fmod_ret/hid_bpf_rdesc_fixup\")\nint BPF_PROG(hid_rdesc_fixup, struct hid_bpf_ctx *hid_ctx)\n{\n\t__u8 *data = hid_bpf_get_data(hid_ctx, 0  , 4096  );\n\n\tif (!data)\n\t\treturn 0;  \n\n\tcallback2_check = data[4];\n\n\t \n\t__builtin_memcpy(&data[73], rdesc, sizeof(rdesc));\n\n\t \n\tdata[4] = 0x42;\n\n\treturn sizeof(rdesc) + 73;\n}\n\nSEC(\"?fmod_ret/hid_bpf_device_event\")\nint BPF_PROG(hid_test_insert1, struct hid_bpf_ctx *hid_ctx)\n{\n\t__u8 *data = hid_bpf_get_data(hid_ctx, 0  , 4  );\n\n\tif (!data)\n\t\treturn 0;  \n\n\t \n\tif (data[2] || data[3])\n\t\treturn -1;\n\n\tdata[1] = 1;\n\n\treturn 0;\n}\n\nSEC(\"?fmod_ret/hid_bpf_device_event\")\nint BPF_PROG(hid_test_insert2, struct hid_bpf_ctx *hid_ctx)\n{\n\t__u8 *data = hid_bpf_get_data(hid_ctx, 0  , 4  );\n\n\tif (!data)\n\t\treturn 0;  \n\n\t \n\tif (!data[1] || data[3])\n\t\treturn -1;\n\n\tdata[2] = 2;\n\n\treturn 0;\n}\n\nSEC(\"?fmod_ret/hid_bpf_device_event\")\nint BPF_PROG(hid_test_insert3, struct hid_bpf_ctx *hid_ctx)\n{\n\t__u8 *data = hid_bpf_get_data(hid_ctx, 0  , 4  );\n\n\tif (!data)\n\t\treturn 0;  \n\n\t \n\tif (!data[1] || !data[2])\n\t\treturn -1;\n\n\tdata[3] = 3;\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}