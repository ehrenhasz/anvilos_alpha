{
  "module_name": "Makefile",
  "hash_id": "7456d5828274a7d6618ddd39318f60c4f85586a5256b1a9cc84ade1dee186592",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/hid/Makefile",
  "human_readable_source": "# SPDX-License-Identifier: GPL-2.0\n\n# based on tools/testing/selftest/bpf/Makefile\ninclude ../../../build/Build.include\ninclude ../../../scripts/Makefile.arch\ninclude ../../../scripts/Makefile.include\n\nTEST_PROGS := hid-core.sh\nTEST_PROGS += hid-apple.sh\nTEST_PROGS += hid-gamepad.sh\nTEST_PROGS += hid-ite.sh\nTEST_PROGS += hid-keyboard.sh\nTEST_PROGS += hid-mouse.sh\nTEST_PROGS += hid-multitouch.sh\nTEST_PROGS += hid-sony.sh\nTEST_PROGS += hid-tablet.sh\nTEST_PROGS += hid-usb_crash.sh\nTEST_PROGS += hid-wacom.sh\n\nCXX ?= $(CROSS_COMPILE)g++\n\nHOSTPKG_CONFIG := pkg-config\n\nCFLAGS += -g -O0 -rdynamic -Wall -Werror -I$(KHDR_INCLUDES) -I$(OUTPUT)\nLDLIBS += -lelf -lz -lrt -lpthread\n\n# Silence some warnings when compiled with clang\nifneq ($(LLVM),)\nCFLAGS += -Wno-unused-command-line-argument\nendif\n\n# Order correspond to 'make run_tests' order\nTEST_GEN_PROGS = hid_bpf\n\n# Emit succinct information message describing current building step\n# $1 - generic step name (e.g., CC, LINK, etc);\n# $2 - optional \"flavor\" specifier; if provided, will be emitted as [flavor];\n# $3 - target (assumed to be file); only file name will be emitted;\n# $4 - optional extra arg, emitted as-is, if provided.\nifeq ($(V),1)\nQ =\nmsg =\nelse\nQ = @\nmsg = @printf '  %-8s%s %s%s\\n' \"$(1)\" \"$(if $(2), [$(2)])\" \"$(notdir $(3))\" \"$(if $(4), $(4))\";\nMAKEFLAGS += --no-print-directory\nsubmake_extras := feature_display=0\nendif\n\n# override lib.mk's default rules\nOVERRIDE_TARGETS := 1\noverride define CLEAN\n\t$(call msg,CLEAN)\n\t$(Q)$(RM) -r $(TEST_GEN_PROGS)\n\t$(Q)$(RM) -r $(EXTRA_CLEAN)\nendef\n\ninclude ../lib.mk\n\nTOOLSDIR := $(top_srcdir)/tools\nLIBDIR := $(TOOLSDIR)/lib\nBPFDIR := $(LIBDIR)/bpf\nTOOLSINCDIR := $(TOOLSDIR)/include\nBPFTOOLDIR := $(TOOLSDIR)/bpf/bpftool\nSCRATCH_DIR := $(OUTPUT)/tools\nBUILD_DIR := $(SCRATCH_DIR)/build\nINCLUDE_DIR := $(SCRATCH_DIR)/include\nKHDR_INCLUDES := $(SCRATCH_DIR)/uapi/include\nBPFOBJ := $(BUILD_DIR)/libbpf/libbpf.a\nifneq ($(CROSS_COMPILE),)\nHOST_BUILD_DIR\t\t:= $(BUILD_DIR)/host\nHOST_SCRATCH_DIR\t:= $(OUTPUT)/host-tools\nHOST_INCLUDE_DIR\t:= $(HOST_SCRATCH_DIR)/include\nelse\nHOST_BUILD_DIR\t\t:= $(BUILD_DIR)\nHOST_SCRATCH_DIR\t:= $(SCRATCH_DIR)\nHOST_INCLUDE_DIR\t:= $(INCLUDE_DIR)\nendif\nHOST_BPFOBJ := $(HOST_BUILD_DIR)/libbpf/libbpf.a\nRESOLVE_BTFIDS := $(HOST_BUILD_DIR)/resolve_btfids/resolve_btfids\n\nVMLINUX_BTF_PATHS ?= $(if $(O),$(O)/vmlinux)\t\t\t\t\\\n\t\t     $(if $(KBUILD_OUTPUT),$(KBUILD_OUTPUT)/vmlinux)\t\\\n\t\t     ../../../../vmlinux\t\t\t\t\\\n\t\t     /sys/kernel/btf/vmlinux\t\t\t\t\\\n\t\t     /boot/vmlinux-$(shell uname -r)\nVMLINUX_BTF ?= $(abspath $(firstword $(wildcard $(VMLINUX_BTF_PATHS))))\nifeq ($(VMLINUX_BTF),)\n$(error Cannot find a vmlinux for VMLINUX_BTF at any of \"$(VMLINUX_BTF_PATHS)\")\nendif\n\n# Define simple and short `make test_progs`, `make test_sysctl`, etc targets\n# to build individual tests.\n# NOTE: Semicolon at the end is critical to override lib.mk's default static\n# rule for binaries.\n$(notdir $(TEST_GEN_PROGS)): %: $(OUTPUT)/% ;\n\n# sort removes libbpf duplicates when not cross-building\nMAKE_DIRS := $(sort $(BUILD_DIR)/libbpf $(HOST_BUILD_DIR)/libbpf\t\t\\\n\t       $(HOST_BUILD_DIR)/bpftool $(HOST_BUILD_DIR)/resolve_btfids\t\\\n\t       $(INCLUDE_DIR))\n$(MAKE_DIRS):\n\t$(call msg,MKDIR,,$@)\n\t$(Q)mkdir -p $@\n\n# LLVM's ld.lld doesn't support all the architectures, so use it only on x86\nifeq ($(SRCARCH),x86)\nLLD := lld\nelse\nLLD := ld\nendif\n\nDEFAULT_BPFTOOL := $(HOST_SCRATCH_DIR)/sbin/bpftool\n\nTEST_GEN_PROGS_EXTENDED += $(DEFAULT_BPFTOOL)\n\n$(TEST_GEN_PROGS) $(TEST_GEN_PROGS_EXTENDED): $(BPFOBJ)\n\nBPFTOOL ?= $(DEFAULT_BPFTOOL)\n$(DEFAULT_BPFTOOL): $(wildcard $(BPFTOOLDIR)/*.[ch] $(BPFTOOLDIR)/Makefile)    \\\n\t\t    $(HOST_BPFOBJ) | $(HOST_BUILD_DIR)/bpftool\n\t$(Q)$(MAKE) $(submake_extras)  -C $(BPFTOOLDIR)\t\t\t       \\\n\t\t    ARCH= CROSS_COMPILE= CC=$(HOSTCC) LD=$(HOSTLD) \t       \\\n\t\t    EXTRA_CFLAGS='-g -O0'\t\t\t\t       \\\n\t\t    OUTPUT=$(HOST_BUILD_DIR)/bpftool/\t\t\t       \\\n\t\t    LIBBPF_OUTPUT=$(HOST_BUILD_DIR)/libbpf/\t\t       \\\n\t\t    LIBBPF_DESTDIR=$(HOST_SCRATCH_DIR)/\t\t\t       \\\n\t\t    prefix= DESTDIR=$(HOST_SCRATCH_DIR)/ install-bin\n\n$(BPFOBJ): $(wildcard $(BPFDIR)/*.[ch] $(BPFDIR)/Makefile)\t\t       \\\n\t   | $(BUILD_DIR)/libbpf\n\t$(Q)$(MAKE) $(submake_extras) -C $(BPFDIR) OUTPUT=$(BUILD_DIR)/libbpf/ \\\n\t\t    EXTRA_CFLAGS='-g -O0'\t\t\t\t       \\\n\t\t    DESTDIR=$(SCRATCH_DIR) prefix= all install_headers\n\nifneq ($(BPFOBJ),$(HOST_BPFOBJ))\n$(HOST_BPFOBJ): $(wildcard $(BPFDIR)/*.[ch] $(BPFDIR)/Makefile)\t\t       \\\n\t\t| $(HOST_BUILD_DIR)/libbpf\n\t$(Q)$(MAKE) $(submake_extras) -C $(BPFDIR)                             \\\n\t\t    EXTRA_CFLAGS='-g -O0' ARCH= CROSS_COMPILE=\t\t       \\\n\t\t    OUTPUT=$(HOST_BUILD_DIR)/libbpf/ CC=$(HOSTCC) LD=$(HOSTLD) \\\n\t\t    DESTDIR=$(HOST_SCRATCH_DIR)/ prefix= all install_headers\nendif\n\n$(INCLUDE_DIR)/vmlinux.h: $(VMLINUX_BTF) $(BPFTOOL) | $(INCLUDE_DIR)\nifeq ($(VMLINUX_H),)\n\t$(call msg,GEN,,$@)\n\t$(Q)$(BPFTOOL) btf dump file $(VMLINUX_BTF) format c > $@\nelse\n\t$(call msg,CP,,$@)\n\t$(Q)cp \"$(VMLINUX_H)\" $@\nendif\n\n$(KHDR_INCLUDES)/linux/hid.h: $(top_srcdir)/include/uapi/linux/hid.h\n\t$(MAKE) -C $(top_srcdir) INSTALL_HDR_PATH=$(SCRATCH_DIR)/uapi headers_install\n\n$(RESOLVE_BTFIDS): $(HOST_BPFOBJ) | $(HOST_BUILD_DIR)/resolve_btfids\t\\\n\t\t       $(TOOLSDIR)/bpf/resolve_btfids/main.c\t\\\n\t\t       $(TOOLSDIR)/lib/rbtree.c\t\t\t\\\n\t\t       $(TOOLSDIR)/lib/zalloc.c\t\t\t\\\n\t\t       $(TOOLSDIR)/lib/string.c\t\t\t\\\n\t\t       $(TOOLSDIR)/lib/ctype.c\t\t\t\\\n\t\t       $(TOOLSDIR)/lib/str_error_r.c\n\t$(Q)$(MAKE) $(submake_extras) -C $(TOOLSDIR)/bpf/resolve_btfids\t\\\n\t\tCC=$(HOSTCC) LD=$(HOSTLD) AR=$(HOSTAR) \\\n\t\tLIBBPF_INCLUDE=$(HOST_INCLUDE_DIR) \\\n\t\tOUTPUT=$(HOST_BUILD_DIR)/resolve_btfids/ BPFOBJ=$(HOST_BPFOBJ)\n\n# Get Clang's default includes on this system, as opposed to those seen by\n# '--target=bpf'. This fixes \"missing\" files on some architectures/distros,\n# such as asm/byteorder.h, asm/socket.h, asm/sockios.h, sys/cdefs.h etc.\n#\n# Use '-idirafter': Don't interfere with include mechanics except where the\n# build would have failed anyways.\ndefine get_sys_includes\n$(shell $(1) -v -E - </dev/null 2>&1 \\\n\t| sed -n '/<...> search starts here:/,/End of search list./{ s| \\(/.*\\)|-idirafter \\1|p }') \\\n$(shell $(1) -dM -E - </dev/null | grep '__riscv_xlen ' | awk '{printf(\"-D__riscv_xlen=%d -D__BITS_PER_LONG=%d\", $$3, $$3)}')\nendef\n\n# Determine target endianness.\nIS_LITTLE_ENDIAN = $(shell $(CC) -dM -E - </dev/null | \\\n\t\t\tgrep 'define __BYTE_ORDER__ __ORDER_LITTLE_ENDIAN__')\nMENDIAN=$(if $(IS_LITTLE_ENDIAN),-mlittle-endian,-mbig-endian)\n\nCLANG_SYS_INCLUDES = $(call get_sys_includes,$(CLANG))\nBPF_CFLAGS = -g -Werror -D__TARGET_ARCH_$(SRCARCH) $(MENDIAN) \t\t\\\n\t     -I$(INCLUDE_DIR)\n\nCLANG_CFLAGS = $(CLANG_SYS_INCLUDES) \\\n\t       -Wno-compare-distinct-pointer-types\n\n# Build BPF object using Clang\n# $1 - input .c file\n# $2 - output .o file\n# $3 - CFLAGS\ndefine CLANG_BPF_BUILD_RULE\n\t$(call msg,CLNG-BPF,$(TRUNNER_BINARY),$2)\n\t$(Q)$(CLANG) $3 -O2 --target=bpf -c $1 -mcpu=v3 -o $2\nendef\n# Similar to CLANG_BPF_BUILD_RULE, but with disabled alu32\ndefine CLANG_NOALU32_BPF_BUILD_RULE\n\t$(call msg,CLNG-BPF,$(TRUNNER_BINARY),$2)\n\t$(Q)$(CLANG) $3 -O2 --target=bpf -c $1 -mcpu=v2 -o $2\nendef\n# Build BPF object using GCC\ndefine GCC_BPF_BUILD_RULE\n\t$(call msg,GCC-BPF,$(TRUNNER_BINARY),$2)\n\t$(Q)$(BPF_GCC) $3 -O2 -c $1 -o $2\nendef\n\nBPF_PROGS_DIR := progs\nBPF_BUILD_RULE := CLANG_BPF_BUILD_RULE\nBPF_SRCS := $(notdir $(wildcard $(BPF_PROGS_DIR)/*.c))\nBPF_OBJS := $(patsubst %.c,$(OUTPUT)/%.bpf.o, $(BPF_SRCS))\nBPF_SKELS := $(patsubst %.c,$(OUTPUT)/%.skel.h, $(BPF_SRCS))\nTEST_GEN_FILES += $(BPF_OBJS)\n\n$(BPF_PROGS_DIR)-bpfobjs := y\n$(BPF_OBJS): $(OUTPUT)/%.bpf.o:\t\t\t\t\\\n\t     $(BPF_PROGS_DIR)/%.c\t\t\t\\\n\t     $(wildcard $(BPF_PROGS_DIR)/*.h)\t\t\\\n\t     $(INCLUDE_DIR)/vmlinux.h\t\t\t\t\\\n\t     $(wildcard $(BPFDIR)/hid_bpf_*.h)\t\t\t\\\n\t     $(wildcard $(BPFDIR)/*.bpf.h)\t\t\t\\\n\t     | $(OUTPUT) $(BPFOBJ)\n\t$(call $(BPF_BUILD_RULE),$<,$@, $(BPF_CFLAGS))\n\n$(BPF_SKELS): %.skel.h: %.bpf.o $(BPFTOOL) | $(OUTPUT)\n\t$(call msg,GEN-SKEL,$(BINARY),$@)\n\t$(Q)$(BPFTOOL) gen object $(<:.o=.linked1.o) $<\n\t$(Q)$(BPFTOOL) gen skeleton $(<:.o=.linked1.o) name $(notdir $(<:.bpf.o=)) > $@\n\n$(OUTPUT)/%.o: %.c $(BPF_SKELS) $(KHDR_INCLUDES)/linux/hid.h\n\t$(call msg,CC,,$@)\n\t$(Q)$(CC) $(CFLAGS) -c $(filter %.c,$^) $(LDLIBS) -o $@\n\n$(OUTPUT)/%: $(OUTPUT)/%.o\n\t$(call msg,BINARY,,$@)\n\t$(Q)$(LINK.c) $^ $(LDLIBS) -o $@\n\nEXTRA_CLEAN := $(SCRATCH_DIR) $(HOST_SCRATCH_DIR) feature bpftool\t\\\n\t$(addprefix $(OUTPUT)/,*.o *.skel.h no_alu32)\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}