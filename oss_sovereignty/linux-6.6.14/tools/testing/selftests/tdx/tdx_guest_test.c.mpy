{
  "module_name": "tdx_guest_test.c",
  "hash_id": "0477930d20090ed42fc0ebdc80d75c6d87eadb56f95165d2ec6c4ddee1f784d7",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/tdx/tdx_guest_test.c",
  "human_readable_source": "\n \n\n#include <sys/ioctl.h>\n\n#include <errno.h>\n#include <fcntl.h>\n\n#include <linux/tdx-guest.h>\n#include \"../kselftest_harness.h\"\n\n#define TDX_GUEST_DEVNAME \"/dev/tdx_guest\"\n#define HEX_DUMP_SIZE 8\n#define DEBUG 0\n\n \nstruct tdreport_type {\n\t__u8 type;\n\t__u8 sub_type;\n\t__u8 version;\n\t__u8 reserved;\n};\n\n \nstruct reportmac {\n\tstruct tdreport_type type;\n\t__u8 reserved1[12];\n\t__u8 cpu_svn[16];\n\t__u8 tee_tcb_info_hash[48];\n\t__u8 tee_td_info_hash[48];\n\t__u8 reportdata[64];\n\t__u8 reserved2[32];\n\t__u8 mac[32];\n};\n\n \nstruct td_info {\n\t__u8 attr[8];\n\t__u64 xfam;\n\t__u64 mrtd[6];\n\t__u64 mrconfigid[6];\n\t__u64 mrowner[6];\n\t__u64 mrownerconfig[6];\n\t__u64 rtmr[24];\n\t__u64 reserved[14];\n};\n\n \nstruct tdreport {\n\tstruct reportmac reportmac;\n\t__u8 tee_tcb_info[239];\n\t__u8 reserved[17];\n\tstruct td_info tdinfo;\n};\n\nstatic void print_array_hex(const char *title, const char *prefix_str,\n\t\t\t    const void *buf, int len)\n{\n\tint i, j, line_len, rowsize = HEX_DUMP_SIZE;\n\tconst __u8 *ptr = buf;\n\n\tprintf(\"\\t\\t%s\", title);\n\n\tfor (j = 0; j < len; j += rowsize) {\n\t\tline_len = rowsize < (len - j) ? rowsize : (len - j);\n\t\tprintf(\"%s%.8x:\", prefix_str, j);\n\t\tfor (i = 0; i < line_len; i++)\n\t\t\tprintf(\" %.2x\", ptr[j + i]);\n\t\tprintf(\"\\n\");\n\t}\n\n\tprintf(\"\\n\");\n}\n\nTEST(verify_report)\n{\n\tstruct tdx_report_req req;\n\tstruct tdreport *tdreport;\n\tint devfd, i;\n\n\tdevfd = open(TDX_GUEST_DEVNAME, O_RDWR | O_SYNC);\n\tASSERT_LT(0, devfd);\n\n\t \n\tfor (i = 0; i < TDX_REPORTDATA_LEN; i++)\n\t\treq.reportdata[i] = i;\n\n\t \n\tASSERT_EQ(0, ioctl(devfd, TDX_CMD_GET_REPORT0, &req));\n\n\tif (DEBUG) {\n\t\tprint_array_hex(\"\\n\\t\\tTDX report data\\n\", \"\",\n\t\t\t\treq.reportdata, sizeof(req.reportdata));\n\n\t\tprint_array_hex(\"\\n\\t\\tTDX tdreport data\\n\", \"\",\n\t\t\t\treq.tdreport, sizeof(req.tdreport));\n\t}\n\n\t \n\ttdreport = (struct tdreport *)req.tdreport;\n\tASSERT_EQ(0, memcmp(&tdreport->reportmac.reportdata[0],\n\t\t\t    req.reportdata, sizeof(req.reportdata)));\n\n\tASSERT_EQ(0, close(devfd));\n}\n\nTEST_HARNESS_MAIN\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}