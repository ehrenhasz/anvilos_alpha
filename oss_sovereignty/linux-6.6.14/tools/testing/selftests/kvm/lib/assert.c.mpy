{
  "module_name": "assert.c",
  "hash_id": "107cc7c8e2d6cc01eeb1341f2a56187b91d2ef956c28bffe608dd3db971c40ad",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/kvm/lib/assert.c",
  "human_readable_source": "\n \n\n#define _GNU_SOURCE  \n\n#include \"test_util.h\"\n\n#include <execinfo.h>\n#include <sys/syscall.h>\n\n#include \"kselftest.h\"\n\n \nstatic void __attribute__((noinline)) test_dump_stack(void);\nstatic void test_dump_stack(void)\n{\n\t \n\tsize_t i;\n\tsize_t n = 20;\n\tvoid *stack[n];\n\tconst char *addr2line = \"addr2line -s -e /proc/$PPID/exe -fpai\";\n\tconst char *pipeline = \"|cat -n 1>&2\";\n\tchar cmd[strlen(addr2line) + strlen(pipeline) +\n\t\t  \n\t\t n * (((sizeof(void *)) * 2) + 1) +\n\t\t  \n\t\t 1];\n\tchar *c = cmd;\n\n\tn = backtrace(stack, n);\n\t \n\tif (n <= 2) {\n\t\tfputs(\"  (stack trace empty)\\n\", stderr);\n\t\treturn;\n\t}\n\n\tc += sprintf(c, \"%s\", addr2line);\n\tfor (i = 2; i < n; i++)\n\t\tc += sprintf(c, \" %lx\", ((unsigned long) stack[i]) - 1);\n\n\tc += sprintf(c, \"%s\", pipeline);\n#pragma GCC diagnostic push\n#pragma GCC diagnostic ignored \"-Wunused-result\"\n\tsystem(cmd);\n#pragma GCC diagnostic pop\n}\n\nstatic pid_t _gettid(void)\n{\n\treturn syscall(SYS_gettid);\n}\n\nvoid __attribute__((noinline))\ntest_assert(bool exp, const char *exp_str,\n\tconst char *file, unsigned int line, const char *fmt, ...)\n{\n\tva_list ap;\n\n\tif (!(exp)) {\n\t\tva_start(ap, fmt);\n\n\t\tfprintf(stderr, \"==== Test Assertion Failure ====\\n\"\n\t\t\t\"  %s:%u: %s\\n\"\n\t\t\t\"  pid=%d tid=%d errno=%d - %s\\n\",\n\t\t\tfile, line, exp_str, getpid(), _gettid(),\n\t\t\terrno, strerror(errno));\n\t\ttest_dump_stack();\n\t\tif (fmt) {\n\t\t\tfputs(\"  \", stderr);\n\t\t\tvfprintf(stderr, fmt, ap);\n\t\t\tfputs(\"\\n\", stderr);\n\t\t}\n\t\tva_end(ap);\n\n\t\tif (errno == EACCES) {\n\t\t\tprint_skip(\"Access denied - Exiting\");\n\t\t\texit(KSFT_SKIP);\n\t\t}\n\t\texit(254);\n\t}\n\n\treturn;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}