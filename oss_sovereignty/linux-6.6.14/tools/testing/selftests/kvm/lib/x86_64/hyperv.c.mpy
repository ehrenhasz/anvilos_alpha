{
  "module_name": "hyperv.c",
  "hash_id": "83e22d0ce6e68923cc317e8dc4589b49d7b07ac1bac0dd5357967aacd5f76003",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/kvm/lib/x86_64/hyperv.c",
  "human_readable_source": "\n \n#include <stdint.h>\n#include \"processor.h\"\n#include \"hyperv.h\"\n\nstruct hyperv_test_pages *vcpu_alloc_hyperv_test_pages(struct kvm_vm *vm,\n\t\t\t\t\t\t       vm_vaddr_t *p_hv_pages_gva)\n{\n\tvm_vaddr_t hv_pages_gva = vm_vaddr_alloc_page(vm);\n\tstruct hyperv_test_pages *hv = addr_gva2hva(vm, hv_pages_gva);\n\n\t \n\thv->vp_assist = (void *)vm_vaddr_alloc_page(vm);\n\thv->vp_assist_hva = addr_gva2hva(vm, (uintptr_t)hv->vp_assist);\n\thv->vp_assist_gpa = addr_gva2gpa(vm, (uintptr_t)hv->vp_assist);\n\n\t \n\thv->partition_assist = (void *)vm_vaddr_alloc_page(vm);\n\thv->partition_assist_hva = addr_gva2hva(vm, (uintptr_t)hv->partition_assist);\n\thv->partition_assist_gpa = addr_gva2gpa(vm, (uintptr_t)hv->partition_assist);\n\n\t \n\thv->enlightened_vmcs = (void *)vm_vaddr_alloc_page(vm);\n\thv->enlightened_vmcs_hva = addr_gva2hva(vm, (uintptr_t)hv->enlightened_vmcs);\n\thv->enlightened_vmcs_gpa = addr_gva2gpa(vm, (uintptr_t)hv->enlightened_vmcs);\n\n\t*p_hv_pages_gva = hv_pages_gva;\n\treturn hv;\n}\n\nint enable_vp_assist(uint64_t vp_assist_pa, void *vp_assist)\n{\n\tuint64_t val = (vp_assist_pa & HV_X64_MSR_VP_ASSIST_PAGE_ADDRESS_MASK) |\n\t\tHV_X64_MSR_VP_ASSIST_PAGE_ENABLE;\n\n\twrmsr(HV_X64_MSR_VP_ASSIST_PAGE, val);\n\n\tcurrent_vp_assist = vp_assist;\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}