{
  "module_name": "gic.c",
  "hash_id": "efdcb9f40966f35476fff95c886c6475d69e6aae055c8a20d4a97f5401eaaec2",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/kvm/lib/aarch64/gic.c",
  "human_readable_source": "\n \n\n#include <errno.h>\n#include <linux/bits.h>\n#include <linux/sizes.h>\n\n#include \"kvm_util.h\"\n\n#include <gic.h>\n#include \"gic_private.h\"\n#include \"processor.h\"\n#include \"spinlock.h\"\n\nstatic const struct gic_common_ops *gic_common_ops;\nstatic struct spinlock gic_lock;\n\nstatic void gic_cpu_init(unsigned int cpu, void *redist_base)\n{\n\tgic_common_ops->gic_cpu_init(cpu, redist_base);\n}\n\nstatic void\ngic_dist_init(enum gic_type type, unsigned int nr_cpus, void *dist_base)\n{\n\tconst struct gic_common_ops *gic_ops = NULL;\n\n\tspin_lock(&gic_lock);\n\n\t \n\tif (gic_common_ops) {\n\t\tspin_unlock(&gic_lock);\n\t\treturn;\n\t}\n\n\tif (type == GIC_V3)\n\t\tgic_ops = &gicv3_ops;\n\n\tGUEST_ASSERT(gic_ops);\n\n\tgic_ops->gic_init(nr_cpus, dist_base);\n\tgic_common_ops = gic_ops;\n\n\t \n\tdsb(sy);\n\n\tspin_unlock(&gic_lock);\n}\n\nvoid gic_init(enum gic_type type, unsigned int nr_cpus,\n\t\tvoid *dist_base, void *redist_base)\n{\n\tuint32_t cpu = guest_get_vcpuid();\n\n\tGUEST_ASSERT(type < GIC_TYPE_MAX);\n\tGUEST_ASSERT(dist_base);\n\tGUEST_ASSERT(redist_base);\n\tGUEST_ASSERT(nr_cpus);\n\n\tgic_dist_init(type, nr_cpus, dist_base);\n\tgic_cpu_init(cpu, redist_base);\n}\n\nvoid gic_irq_enable(unsigned int intid)\n{\n\tGUEST_ASSERT(gic_common_ops);\n\tgic_common_ops->gic_irq_enable(intid);\n}\n\nvoid gic_irq_disable(unsigned int intid)\n{\n\tGUEST_ASSERT(gic_common_ops);\n\tgic_common_ops->gic_irq_disable(intid);\n}\n\nunsigned int gic_get_and_ack_irq(void)\n{\n\tuint64_t irqstat;\n\tunsigned int intid;\n\n\tGUEST_ASSERT(gic_common_ops);\n\n\tirqstat = gic_common_ops->gic_read_iar();\n\tintid = irqstat & GENMASK(23, 0);\n\n\treturn intid;\n}\n\nvoid gic_set_eoi(unsigned int intid)\n{\n\tGUEST_ASSERT(gic_common_ops);\n\tgic_common_ops->gic_write_eoir(intid);\n}\n\nvoid gic_set_dir(unsigned int intid)\n{\n\tGUEST_ASSERT(gic_common_ops);\n\tgic_common_ops->gic_write_dir(intid);\n}\n\nvoid gic_set_eoi_split(bool split)\n{\n\tGUEST_ASSERT(gic_common_ops);\n\tgic_common_ops->gic_set_eoi_split(split);\n}\n\nvoid gic_set_priority_mask(uint64_t pmr)\n{\n\tGUEST_ASSERT(gic_common_ops);\n\tgic_common_ops->gic_set_priority_mask(pmr);\n}\n\nvoid gic_set_priority(unsigned int intid, unsigned int prio)\n{\n\tGUEST_ASSERT(gic_common_ops);\n\tgic_common_ops->gic_set_priority(intid, prio);\n}\n\nvoid gic_irq_set_active(unsigned int intid)\n{\n\tGUEST_ASSERT(gic_common_ops);\n\tgic_common_ops->gic_irq_set_active(intid);\n}\n\nvoid gic_irq_clear_active(unsigned int intid)\n{\n\tGUEST_ASSERT(gic_common_ops);\n\tgic_common_ops->gic_irq_clear_active(intid);\n}\n\nbool gic_irq_get_active(unsigned int intid)\n{\n\tGUEST_ASSERT(gic_common_ops);\n\treturn gic_common_ops->gic_irq_get_active(intid);\n}\n\nvoid gic_irq_set_pending(unsigned int intid)\n{\n\tGUEST_ASSERT(gic_common_ops);\n\tgic_common_ops->gic_irq_set_pending(intid);\n}\n\nvoid gic_irq_clear_pending(unsigned int intid)\n{\n\tGUEST_ASSERT(gic_common_ops);\n\tgic_common_ops->gic_irq_clear_pending(intid);\n}\n\nbool gic_irq_get_pending(unsigned int intid)\n{\n\tGUEST_ASSERT(gic_common_ops);\n\treturn gic_common_ops->gic_irq_get_pending(intid);\n}\n\nvoid gic_irq_set_config(unsigned int intid, bool is_edge)\n{\n\tGUEST_ASSERT(gic_common_ops);\n\tgic_common_ops->gic_irq_set_config(intid, is_edge);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}