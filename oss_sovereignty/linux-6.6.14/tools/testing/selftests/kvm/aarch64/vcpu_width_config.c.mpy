{
  "module_name": "vcpu_width_config.c",
  "hash_id": "02057259921ffce5d09df3b0adf3cfab04eeb7618255f244e7ca2ba6b310e58e",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/kvm/aarch64/vcpu_width_config.c",
  "human_readable_source": "\n \n\n#include \"kvm_util.h\"\n#include \"processor.h\"\n#include \"test_util.h\"\n\n\n \nstatic int add_init_2vcpus(struct kvm_vcpu_init *init0,\n\t\t\t   struct kvm_vcpu_init *init1)\n{\n\tstruct kvm_vcpu *vcpu0, *vcpu1;\n\tstruct kvm_vm *vm;\n\tint ret;\n\n\tvm = vm_create_barebones();\n\n\tvcpu0 = __vm_vcpu_add(vm, 0);\n\tret = __vcpu_ioctl(vcpu0, KVM_ARM_VCPU_INIT, init0);\n\tif (ret)\n\t\tgoto free_exit;\n\n\tvcpu1 = __vm_vcpu_add(vm, 1);\n\tret = __vcpu_ioctl(vcpu1, KVM_ARM_VCPU_INIT, init1);\n\nfree_exit:\n\tkvm_vm_free(vm);\n\treturn ret;\n}\n\n \nstatic int add_2vcpus_init_2vcpus(struct kvm_vcpu_init *init0,\n\t\t\t\t  struct kvm_vcpu_init *init1)\n{\n\tstruct kvm_vcpu *vcpu0, *vcpu1;\n\tstruct kvm_vm *vm;\n\tint ret;\n\n\tvm = vm_create_barebones();\n\n\tvcpu0 = __vm_vcpu_add(vm, 0);\n\tvcpu1 = __vm_vcpu_add(vm, 1);\n\n\tret = __vcpu_ioctl(vcpu0, KVM_ARM_VCPU_INIT, init0);\n\tif (ret)\n\t\tgoto free_exit;\n\n\tret = __vcpu_ioctl(vcpu1, KVM_ARM_VCPU_INIT, init1);\n\nfree_exit:\n\tkvm_vm_free(vm);\n\treturn ret;\n}\n\n \nint main(void)\n{\n\tstruct kvm_vcpu_init init0, init1;\n\tstruct kvm_vm *vm;\n\tint ret;\n\n\tTEST_REQUIRE(kvm_has_cap(KVM_CAP_ARM_EL1_32BIT));\n\n\t \n\tvm = vm_create_barebones();\n\tvm_ioctl(vm, KVM_ARM_PREFERRED_TARGET, &init0);\n\tkvm_vm_free(vm);\n\tinit1 = init0;\n\n\t \n\tret = add_init_2vcpus(&init0, &init0);\n\tTEST_ASSERT(ret == 0,\n\t\t    \"Configuring 64bit EL1 vCPUs failed unexpectedly\");\n\tret = add_2vcpus_init_2vcpus(&init0, &init0);\n\tTEST_ASSERT(ret == 0,\n\t\t    \"Configuring 64bit EL1 vCPUs failed unexpectedly\");\n\n\t \n\tinit0.features[0] = (1 << KVM_ARM_VCPU_EL1_32BIT);\n\tret = add_init_2vcpus(&init0, &init0);\n\tTEST_ASSERT(ret == 0,\n\t\t    \"Configuring 32bit EL1 vCPUs failed unexpectedly\");\n\tret = add_2vcpus_init_2vcpus(&init0, &init0);\n\tTEST_ASSERT(ret == 0,\n\t\t    \"Configuring 32bit EL1 vCPUs failed unexpectedly\");\n\n\t \n\tinit0.features[0] = 0;\n\tinit1.features[0] = (1 << KVM_ARM_VCPU_EL1_32BIT);\n\tret = add_init_2vcpus(&init0, &init1);\n\tTEST_ASSERT(ret != 0,\n\t\t    \"Configuring mixed-width vCPUs worked unexpectedly\");\n\tret = add_2vcpus_init_2vcpus(&init0, &init1);\n\tTEST_ASSERT(ret != 0,\n\t\t    \"Configuring mixed-width vCPUs worked unexpectedly\");\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}