{
  "module_name": "evmcs.h",
  "hash_id": "6b584c7ce7766e195ef15da251d22162860f7e1b6c675087f93853e7980a49ab",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/kvm/include/x86_64/evmcs.h",
  "human_readable_source": " \n \n\n#ifndef SELFTEST_KVM_EVMCS_H\n#define SELFTEST_KVM_EVMCS_H\n\n#include <stdint.h>\n#include \"hyperv.h\"\n#include \"vmx.h\"\n\n#define u16 uint16_t\n#define u32 uint32_t\n#define u64 uint64_t\n\n#define EVMCS_VERSION 1\n\nextern bool enable_evmcs;\n\nstruct hv_enlightened_vmcs {\n\tu32 revision_id;\n\tu32 abort;\n\n\tu16 host_es_selector;\n\tu16 host_cs_selector;\n\tu16 host_ss_selector;\n\tu16 host_ds_selector;\n\tu16 host_fs_selector;\n\tu16 host_gs_selector;\n\tu16 host_tr_selector;\n\n\tu16 padding16_1;\n\n\tu64 host_ia32_pat;\n\tu64 host_ia32_efer;\n\n\tu64 host_cr0;\n\tu64 host_cr3;\n\tu64 host_cr4;\n\n\tu64 host_ia32_sysenter_esp;\n\tu64 host_ia32_sysenter_eip;\n\tu64 host_rip;\n\tu32 host_ia32_sysenter_cs;\n\n\tu32 pin_based_vm_exec_control;\n\tu32 vm_exit_controls;\n\tu32 secondary_vm_exec_control;\n\n\tu64 io_bitmap_a;\n\tu64 io_bitmap_b;\n\tu64 msr_bitmap;\n\n\tu16 guest_es_selector;\n\tu16 guest_cs_selector;\n\tu16 guest_ss_selector;\n\tu16 guest_ds_selector;\n\tu16 guest_fs_selector;\n\tu16 guest_gs_selector;\n\tu16 guest_ldtr_selector;\n\tu16 guest_tr_selector;\n\n\tu32 guest_es_limit;\n\tu32 guest_cs_limit;\n\tu32 guest_ss_limit;\n\tu32 guest_ds_limit;\n\tu32 guest_fs_limit;\n\tu32 guest_gs_limit;\n\tu32 guest_ldtr_limit;\n\tu32 guest_tr_limit;\n\tu32 guest_gdtr_limit;\n\tu32 guest_idtr_limit;\n\n\tu32 guest_es_ar_bytes;\n\tu32 guest_cs_ar_bytes;\n\tu32 guest_ss_ar_bytes;\n\tu32 guest_ds_ar_bytes;\n\tu32 guest_fs_ar_bytes;\n\tu32 guest_gs_ar_bytes;\n\tu32 guest_ldtr_ar_bytes;\n\tu32 guest_tr_ar_bytes;\n\n\tu64 guest_es_base;\n\tu64 guest_cs_base;\n\tu64 guest_ss_base;\n\tu64 guest_ds_base;\n\tu64 guest_fs_base;\n\tu64 guest_gs_base;\n\tu64 guest_ldtr_base;\n\tu64 guest_tr_base;\n\tu64 guest_gdtr_base;\n\tu64 guest_idtr_base;\n\n\tu64 padding64_1[3];\n\n\tu64 vm_exit_msr_store_addr;\n\tu64 vm_exit_msr_load_addr;\n\tu64 vm_entry_msr_load_addr;\n\n\tu64 cr3_target_value0;\n\tu64 cr3_target_value1;\n\tu64 cr3_target_value2;\n\tu64 cr3_target_value3;\n\n\tu32 page_fault_error_code_mask;\n\tu32 page_fault_error_code_match;\n\n\tu32 cr3_target_count;\n\tu32 vm_exit_msr_store_count;\n\tu32 vm_exit_msr_load_count;\n\tu32 vm_entry_msr_load_count;\n\n\tu64 tsc_offset;\n\tu64 virtual_apic_page_addr;\n\tu64 vmcs_link_pointer;\n\n\tu64 guest_ia32_debugctl;\n\tu64 guest_ia32_pat;\n\tu64 guest_ia32_efer;\n\n\tu64 guest_pdptr0;\n\tu64 guest_pdptr1;\n\tu64 guest_pdptr2;\n\tu64 guest_pdptr3;\n\n\tu64 guest_pending_dbg_exceptions;\n\tu64 guest_sysenter_esp;\n\tu64 guest_sysenter_eip;\n\n\tu32 guest_activity_state;\n\tu32 guest_sysenter_cs;\n\n\tu64 cr0_guest_host_mask;\n\tu64 cr4_guest_host_mask;\n\tu64 cr0_read_shadow;\n\tu64 cr4_read_shadow;\n\tu64 guest_cr0;\n\tu64 guest_cr3;\n\tu64 guest_cr4;\n\tu64 guest_dr7;\n\n\tu64 host_fs_base;\n\tu64 host_gs_base;\n\tu64 host_tr_base;\n\tu64 host_gdtr_base;\n\tu64 host_idtr_base;\n\tu64 host_rsp;\n\n\tu64 ept_pointer;\n\n\tu16 virtual_processor_id;\n\tu16 padding16_2[3];\n\n\tu64 padding64_2[5];\n\tu64 guest_physical_address;\n\n\tu32 vm_instruction_error;\n\tu32 vm_exit_reason;\n\tu32 vm_exit_intr_info;\n\tu32 vm_exit_intr_error_code;\n\tu32 idt_vectoring_info_field;\n\tu32 idt_vectoring_error_code;\n\tu32 vm_exit_instruction_len;\n\tu32 vmx_instruction_info;\n\n\tu64 exit_qualification;\n\tu64 exit_io_instruction_ecx;\n\tu64 exit_io_instruction_esi;\n\tu64 exit_io_instruction_edi;\n\tu64 exit_io_instruction_eip;\n\n\tu64 guest_linear_address;\n\tu64 guest_rsp;\n\tu64 guest_rflags;\n\n\tu32 guest_interruptibility_info;\n\tu32 cpu_based_vm_exec_control;\n\tu32 exception_bitmap;\n\tu32 vm_entry_controls;\n\tu32 vm_entry_intr_info_field;\n\tu32 vm_entry_exception_error_code;\n\tu32 vm_entry_instruction_len;\n\tu32 tpr_threshold;\n\n\tu64 guest_rip;\n\n\tu32 hv_clean_fields;\n\tu32 padding32_1;\n\tu32 hv_synthetic_controls;\n\tstruct {\n\t\tu32 nested_flush_hypercall:1;\n\t\tu32 msr_bitmap:1;\n\t\tu32 reserved:30;\n\t}  __packed hv_enlightenments_control;\n\tu32 hv_vp_id;\n\tu32 padding32_2;\n\tu64 hv_vm_id;\n\tu64 partition_assist_page;\n\tu64 padding64_4[4];\n\tu64 guest_bndcfgs;\n\tu64 guest_ia32_perf_global_ctrl;\n\tu64 guest_ia32_s_cet;\n\tu64 guest_ssp;\n\tu64 guest_ia32_int_ssp_table_addr;\n\tu64 guest_ia32_lbr_ctl;\n\tu64 padding64_5[2];\n\tu64 xss_exit_bitmap;\n\tu64 encls_exiting_bitmap;\n\tu64 host_ia32_perf_global_ctrl;\n\tu64 tsc_multiplier;\n\tu64 host_ia32_s_cet;\n\tu64 host_ssp;\n\tu64 host_ia32_int_ssp_table_addr;\n\tu64 padding64_6;\n} __packed;\n\n#define HV_VMX_ENLIGHTENED_CLEAN_FIELD_NONE                     0\n#define HV_VMX_ENLIGHTENED_CLEAN_FIELD_IO_BITMAP                BIT(0)\n#define HV_VMX_ENLIGHTENED_CLEAN_FIELD_MSR_BITMAP               BIT(1)\n#define HV_VMX_ENLIGHTENED_CLEAN_FIELD_CONTROL_GRP2             BIT(2)\n#define HV_VMX_ENLIGHTENED_CLEAN_FIELD_CONTROL_GRP1             BIT(3)\n#define HV_VMX_ENLIGHTENED_CLEAN_FIELD_CONTROL_PROC             BIT(4)\n#define HV_VMX_ENLIGHTENED_CLEAN_FIELD_CONTROL_EVENT            BIT(5)\n#define HV_VMX_ENLIGHTENED_CLEAN_FIELD_CONTROL_ENTRY            BIT(6)\n#define HV_VMX_ENLIGHTENED_CLEAN_FIELD_CONTROL_EXCPN            BIT(7)\n#define HV_VMX_ENLIGHTENED_CLEAN_FIELD_CRDR                     BIT(8)\n#define HV_VMX_ENLIGHTENED_CLEAN_FIELD_CONTROL_XLAT             BIT(9)\n#define HV_VMX_ENLIGHTENED_CLEAN_FIELD_GUEST_BASIC              BIT(10)\n#define HV_VMX_ENLIGHTENED_CLEAN_FIELD_GUEST_GRP1               BIT(11)\n#define HV_VMX_ENLIGHTENED_CLEAN_FIELD_GUEST_GRP2               BIT(12)\n#define HV_VMX_ENLIGHTENED_CLEAN_FIELD_HOST_POINTER             BIT(13)\n#define HV_VMX_ENLIGHTENED_CLEAN_FIELD_HOST_GRP1                BIT(14)\n#define HV_VMX_ENLIGHTENED_CLEAN_FIELD_ENLIGHTENMENTSCONTROL    BIT(15)\n#define HV_VMX_ENLIGHTENED_CLEAN_FIELD_ALL                      0xFFFF\n\n#define HV_VMX_SYNTHETIC_EXIT_REASON_TRAP_AFTER_FLUSH 0x10000031\n\nextern struct hv_enlightened_vmcs *current_evmcs;\n\nint vcpu_enable_evmcs(struct kvm_vcpu *vcpu);\n\nstatic inline void evmcs_enable(void)\n{\n\tenable_evmcs = true;\n}\n\nstatic inline int evmcs_vmptrld(uint64_t vmcs_pa, void *vmcs)\n{\n\tcurrent_vp_assist->current_nested_vmcs = vmcs_pa;\n\tcurrent_vp_assist->enlighten_vmentry = 1;\n\n\tcurrent_evmcs = vmcs;\n\n\treturn 0;\n}\n\nstatic inline bool load_evmcs(struct hyperv_test_pages *hv)\n{\n\tif (evmcs_vmptrld(hv->enlightened_vmcs_gpa, hv->enlightened_vmcs))\n\t\treturn false;\n\n\tcurrent_evmcs->revision_id = EVMCS_VERSION;\n\n\treturn true;\n}\n\nstatic inline int evmcs_vmptrst(uint64_t *value)\n{\n\t*value = current_vp_assist->current_nested_vmcs &\n\t\t~HV_X64_MSR_VP_ASSIST_PAGE_ENABLE;\n\n\treturn 0;\n}\n\nstatic inline int evmcs_vmread(uint64_t encoding, uint64_t *value)\n{\n\tswitch (encoding) {\n\tcase GUEST_RIP:\n\t\t*value = current_evmcs->guest_rip;\n\t\tbreak;\n\tcase GUEST_RSP:\n\t\t*value = current_evmcs->guest_rsp;\n\t\tbreak;\n\tcase GUEST_RFLAGS:\n\t\t*value = current_evmcs->guest_rflags;\n\t\tbreak;\n\tcase HOST_IA32_PAT:\n\t\t*value = current_evmcs->host_ia32_pat;\n\t\tbreak;\n\tcase HOST_IA32_EFER:\n\t\t*value = current_evmcs->host_ia32_efer;\n\t\tbreak;\n\tcase HOST_CR0:\n\t\t*value = current_evmcs->host_cr0;\n\t\tbreak;\n\tcase HOST_CR3:\n\t\t*value = current_evmcs->host_cr3;\n\t\tbreak;\n\tcase HOST_CR4:\n\t\t*value = current_evmcs->host_cr4;\n\t\tbreak;\n\tcase HOST_IA32_SYSENTER_ESP:\n\t\t*value = current_evmcs->host_ia32_sysenter_esp;\n\t\tbreak;\n\tcase HOST_IA32_SYSENTER_EIP:\n\t\t*value = current_evmcs->host_ia32_sysenter_eip;\n\t\tbreak;\n\tcase HOST_RIP:\n\t\t*value = current_evmcs->host_rip;\n\t\tbreak;\n\tcase IO_BITMAP_A:\n\t\t*value = current_evmcs->io_bitmap_a;\n\t\tbreak;\n\tcase IO_BITMAP_B:\n\t\t*value = current_evmcs->io_bitmap_b;\n\t\tbreak;\n\tcase MSR_BITMAP:\n\t\t*value = current_evmcs->msr_bitmap;\n\t\tbreak;\n\tcase GUEST_ES_BASE:\n\t\t*value = current_evmcs->guest_es_base;\n\t\tbreak;\n\tcase GUEST_CS_BASE:\n\t\t*value = current_evmcs->guest_cs_base;\n\t\tbreak;\n\tcase GUEST_SS_BASE:\n\t\t*value = current_evmcs->guest_ss_base;\n\t\tbreak;\n\tcase GUEST_DS_BASE:\n\t\t*value = current_evmcs->guest_ds_base;\n\t\tbreak;\n\tcase GUEST_FS_BASE:\n\t\t*value = current_evmcs->guest_fs_base;\n\t\tbreak;\n\tcase GUEST_GS_BASE:\n\t\t*value = current_evmcs->guest_gs_base;\n\t\tbreak;\n\tcase GUEST_LDTR_BASE:\n\t\t*value = current_evmcs->guest_ldtr_base;\n\t\tbreak;\n\tcase GUEST_TR_BASE:\n\t\t*value = current_evmcs->guest_tr_base;\n\t\tbreak;\n\tcase GUEST_GDTR_BASE:\n\t\t*value = current_evmcs->guest_gdtr_base;\n\t\tbreak;\n\tcase GUEST_IDTR_BASE:\n\t\t*value = current_evmcs->guest_idtr_base;\n\t\tbreak;\n\tcase TSC_OFFSET:\n\t\t*value = current_evmcs->tsc_offset;\n\t\tbreak;\n\tcase VIRTUAL_APIC_PAGE_ADDR:\n\t\t*value = current_evmcs->virtual_apic_page_addr;\n\t\tbreak;\n\tcase VMCS_LINK_POINTER:\n\t\t*value = current_evmcs->vmcs_link_pointer;\n\t\tbreak;\n\tcase GUEST_IA32_DEBUGCTL:\n\t\t*value = current_evmcs->guest_ia32_debugctl;\n\t\tbreak;\n\tcase GUEST_IA32_PAT:\n\t\t*value = current_evmcs->guest_ia32_pat;\n\t\tbreak;\n\tcase GUEST_IA32_EFER:\n\t\t*value = current_evmcs->guest_ia32_efer;\n\t\tbreak;\n\tcase GUEST_PDPTR0:\n\t\t*value = current_evmcs->guest_pdptr0;\n\t\tbreak;\n\tcase GUEST_PDPTR1:\n\t\t*value = current_evmcs->guest_pdptr1;\n\t\tbreak;\n\tcase GUEST_PDPTR2:\n\t\t*value = current_evmcs->guest_pdptr2;\n\t\tbreak;\n\tcase GUEST_PDPTR3:\n\t\t*value = current_evmcs->guest_pdptr3;\n\t\tbreak;\n\tcase GUEST_PENDING_DBG_EXCEPTIONS:\n\t\t*value = current_evmcs->guest_pending_dbg_exceptions;\n\t\tbreak;\n\tcase GUEST_SYSENTER_ESP:\n\t\t*value = current_evmcs->guest_sysenter_esp;\n\t\tbreak;\n\tcase GUEST_SYSENTER_EIP:\n\t\t*value = current_evmcs->guest_sysenter_eip;\n\t\tbreak;\n\tcase CR0_GUEST_HOST_MASK:\n\t\t*value = current_evmcs->cr0_guest_host_mask;\n\t\tbreak;\n\tcase CR4_GUEST_HOST_MASK:\n\t\t*value = current_evmcs->cr4_guest_host_mask;\n\t\tbreak;\n\tcase CR0_READ_SHADOW:\n\t\t*value = current_evmcs->cr0_read_shadow;\n\t\tbreak;\n\tcase CR4_READ_SHADOW:\n\t\t*value = current_evmcs->cr4_read_shadow;\n\t\tbreak;\n\tcase GUEST_CR0:\n\t\t*value = current_evmcs->guest_cr0;\n\t\tbreak;\n\tcase GUEST_CR3:\n\t\t*value = current_evmcs->guest_cr3;\n\t\tbreak;\n\tcase GUEST_CR4:\n\t\t*value = current_evmcs->guest_cr4;\n\t\tbreak;\n\tcase GUEST_DR7:\n\t\t*value = current_evmcs->guest_dr7;\n\t\tbreak;\n\tcase HOST_FS_BASE:\n\t\t*value = current_evmcs->host_fs_base;\n\t\tbreak;\n\tcase HOST_GS_BASE:\n\t\t*value = current_evmcs->host_gs_base;\n\t\tbreak;\n\tcase HOST_TR_BASE:\n\t\t*value = current_evmcs->host_tr_base;\n\t\tbreak;\n\tcase HOST_GDTR_BASE:\n\t\t*value = current_evmcs->host_gdtr_base;\n\t\tbreak;\n\tcase HOST_IDTR_BASE:\n\t\t*value = current_evmcs->host_idtr_base;\n\t\tbreak;\n\tcase HOST_RSP:\n\t\t*value = current_evmcs->host_rsp;\n\t\tbreak;\n\tcase EPT_POINTER:\n\t\t*value = current_evmcs->ept_pointer;\n\t\tbreak;\n\tcase GUEST_BNDCFGS:\n\t\t*value = current_evmcs->guest_bndcfgs;\n\t\tbreak;\n\tcase XSS_EXIT_BITMAP:\n\t\t*value = current_evmcs->xss_exit_bitmap;\n\t\tbreak;\n\tcase GUEST_PHYSICAL_ADDRESS:\n\t\t*value = current_evmcs->guest_physical_address;\n\t\tbreak;\n\tcase EXIT_QUALIFICATION:\n\t\t*value = current_evmcs->exit_qualification;\n\t\tbreak;\n\tcase GUEST_LINEAR_ADDRESS:\n\t\t*value = current_evmcs->guest_linear_address;\n\t\tbreak;\n\tcase VM_EXIT_MSR_STORE_ADDR:\n\t\t*value = current_evmcs->vm_exit_msr_store_addr;\n\t\tbreak;\n\tcase VM_EXIT_MSR_LOAD_ADDR:\n\t\t*value = current_evmcs->vm_exit_msr_load_addr;\n\t\tbreak;\n\tcase VM_ENTRY_MSR_LOAD_ADDR:\n\t\t*value = current_evmcs->vm_entry_msr_load_addr;\n\t\tbreak;\n\tcase CR3_TARGET_VALUE0:\n\t\t*value = current_evmcs->cr3_target_value0;\n\t\tbreak;\n\tcase CR3_TARGET_VALUE1:\n\t\t*value = current_evmcs->cr3_target_value1;\n\t\tbreak;\n\tcase CR3_TARGET_VALUE2:\n\t\t*value = current_evmcs->cr3_target_value2;\n\t\tbreak;\n\tcase CR3_TARGET_VALUE3:\n\t\t*value = current_evmcs->cr3_target_value3;\n\t\tbreak;\n\tcase TPR_THRESHOLD:\n\t\t*value = current_evmcs->tpr_threshold;\n\t\tbreak;\n\tcase GUEST_INTERRUPTIBILITY_INFO:\n\t\t*value = current_evmcs->guest_interruptibility_info;\n\t\tbreak;\n\tcase CPU_BASED_VM_EXEC_CONTROL:\n\t\t*value = current_evmcs->cpu_based_vm_exec_control;\n\t\tbreak;\n\tcase EXCEPTION_BITMAP:\n\t\t*value = current_evmcs->exception_bitmap;\n\t\tbreak;\n\tcase VM_ENTRY_CONTROLS:\n\t\t*value = current_evmcs->vm_entry_controls;\n\t\tbreak;\n\tcase VM_ENTRY_INTR_INFO_FIELD:\n\t\t*value = current_evmcs->vm_entry_intr_info_field;\n\t\tbreak;\n\tcase VM_ENTRY_EXCEPTION_ERROR_CODE:\n\t\t*value = current_evmcs->vm_entry_exception_error_code;\n\t\tbreak;\n\tcase VM_ENTRY_INSTRUCTION_LEN:\n\t\t*value = current_evmcs->vm_entry_instruction_len;\n\t\tbreak;\n\tcase HOST_IA32_SYSENTER_CS:\n\t\t*value = current_evmcs->host_ia32_sysenter_cs;\n\t\tbreak;\n\tcase PIN_BASED_VM_EXEC_CONTROL:\n\t\t*value = current_evmcs->pin_based_vm_exec_control;\n\t\tbreak;\n\tcase VM_EXIT_CONTROLS:\n\t\t*value = current_evmcs->vm_exit_controls;\n\t\tbreak;\n\tcase SECONDARY_VM_EXEC_CONTROL:\n\t\t*value = current_evmcs->secondary_vm_exec_control;\n\t\tbreak;\n\tcase GUEST_ES_LIMIT:\n\t\t*value = current_evmcs->guest_es_limit;\n\t\tbreak;\n\tcase GUEST_CS_LIMIT:\n\t\t*value = current_evmcs->guest_cs_limit;\n\t\tbreak;\n\tcase GUEST_SS_LIMIT:\n\t\t*value = current_evmcs->guest_ss_limit;\n\t\tbreak;\n\tcase GUEST_DS_LIMIT:\n\t\t*value = current_evmcs->guest_ds_limit;\n\t\tbreak;\n\tcase GUEST_FS_LIMIT:\n\t\t*value = current_evmcs->guest_fs_limit;\n\t\tbreak;\n\tcase GUEST_GS_LIMIT:\n\t\t*value = current_evmcs->guest_gs_limit;\n\t\tbreak;\n\tcase GUEST_LDTR_LIMIT:\n\t\t*value = current_evmcs->guest_ldtr_limit;\n\t\tbreak;\n\tcase GUEST_TR_LIMIT:\n\t\t*value = current_evmcs->guest_tr_limit;\n\t\tbreak;\n\tcase GUEST_GDTR_LIMIT:\n\t\t*value = current_evmcs->guest_gdtr_limit;\n\t\tbreak;\n\tcase GUEST_IDTR_LIMIT:\n\t\t*value = current_evmcs->guest_idtr_limit;\n\t\tbreak;\n\tcase GUEST_ES_AR_BYTES:\n\t\t*value = current_evmcs->guest_es_ar_bytes;\n\t\tbreak;\n\tcase GUEST_CS_AR_BYTES:\n\t\t*value = current_evmcs->guest_cs_ar_bytes;\n\t\tbreak;\n\tcase GUEST_SS_AR_BYTES:\n\t\t*value = current_evmcs->guest_ss_ar_bytes;\n\t\tbreak;\n\tcase GUEST_DS_AR_BYTES:\n\t\t*value = current_evmcs->guest_ds_ar_bytes;\n\t\tbreak;\n\tcase GUEST_FS_AR_BYTES:\n\t\t*value = current_evmcs->guest_fs_ar_bytes;\n\t\tbreak;\n\tcase GUEST_GS_AR_BYTES:\n\t\t*value = current_evmcs->guest_gs_ar_bytes;\n\t\tbreak;\n\tcase GUEST_LDTR_AR_BYTES:\n\t\t*value = current_evmcs->guest_ldtr_ar_bytes;\n\t\tbreak;\n\tcase GUEST_TR_AR_BYTES:\n\t\t*value = current_evmcs->guest_tr_ar_bytes;\n\t\tbreak;\n\tcase GUEST_ACTIVITY_STATE:\n\t\t*value = current_evmcs->guest_activity_state;\n\t\tbreak;\n\tcase GUEST_SYSENTER_CS:\n\t\t*value = current_evmcs->guest_sysenter_cs;\n\t\tbreak;\n\tcase VM_INSTRUCTION_ERROR:\n\t\t*value = current_evmcs->vm_instruction_error;\n\t\tbreak;\n\tcase VM_EXIT_REASON:\n\t\t*value = current_evmcs->vm_exit_reason;\n\t\tbreak;\n\tcase VM_EXIT_INTR_INFO:\n\t\t*value = current_evmcs->vm_exit_intr_info;\n\t\tbreak;\n\tcase VM_EXIT_INTR_ERROR_CODE:\n\t\t*value = current_evmcs->vm_exit_intr_error_code;\n\t\tbreak;\n\tcase IDT_VECTORING_INFO_FIELD:\n\t\t*value = current_evmcs->idt_vectoring_info_field;\n\t\tbreak;\n\tcase IDT_VECTORING_ERROR_CODE:\n\t\t*value = current_evmcs->idt_vectoring_error_code;\n\t\tbreak;\n\tcase VM_EXIT_INSTRUCTION_LEN:\n\t\t*value = current_evmcs->vm_exit_instruction_len;\n\t\tbreak;\n\tcase VMX_INSTRUCTION_INFO:\n\t\t*value = current_evmcs->vmx_instruction_info;\n\t\tbreak;\n\tcase PAGE_FAULT_ERROR_CODE_MASK:\n\t\t*value = current_evmcs->page_fault_error_code_mask;\n\t\tbreak;\n\tcase PAGE_FAULT_ERROR_CODE_MATCH:\n\t\t*value = current_evmcs->page_fault_error_code_match;\n\t\tbreak;\n\tcase CR3_TARGET_COUNT:\n\t\t*value = current_evmcs->cr3_target_count;\n\t\tbreak;\n\tcase VM_EXIT_MSR_STORE_COUNT:\n\t\t*value = current_evmcs->vm_exit_msr_store_count;\n\t\tbreak;\n\tcase VM_EXIT_MSR_LOAD_COUNT:\n\t\t*value = current_evmcs->vm_exit_msr_load_count;\n\t\tbreak;\n\tcase VM_ENTRY_MSR_LOAD_COUNT:\n\t\t*value = current_evmcs->vm_entry_msr_load_count;\n\t\tbreak;\n\tcase HOST_ES_SELECTOR:\n\t\t*value = current_evmcs->host_es_selector;\n\t\tbreak;\n\tcase HOST_CS_SELECTOR:\n\t\t*value = current_evmcs->host_cs_selector;\n\t\tbreak;\n\tcase HOST_SS_SELECTOR:\n\t\t*value = current_evmcs->host_ss_selector;\n\t\tbreak;\n\tcase HOST_DS_SELECTOR:\n\t\t*value = current_evmcs->host_ds_selector;\n\t\tbreak;\n\tcase HOST_FS_SELECTOR:\n\t\t*value = current_evmcs->host_fs_selector;\n\t\tbreak;\n\tcase HOST_GS_SELECTOR:\n\t\t*value = current_evmcs->host_gs_selector;\n\t\tbreak;\n\tcase HOST_TR_SELECTOR:\n\t\t*value = current_evmcs->host_tr_selector;\n\t\tbreak;\n\tcase GUEST_ES_SELECTOR:\n\t\t*value = current_evmcs->guest_es_selector;\n\t\tbreak;\n\tcase GUEST_CS_SELECTOR:\n\t\t*value = current_evmcs->guest_cs_selector;\n\t\tbreak;\n\tcase GUEST_SS_SELECTOR:\n\t\t*value = current_evmcs->guest_ss_selector;\n\t\tbreak;\n\tcase GUEST_DS_SELECTOR:\n\t\t*value = current_evmcs->guest_ds_selector;\n\t\tbreak;\n\tcase GUEST_FS_SELECTOR:\n\t\t*value = current_evmcs->guest_fs_selector;\n\t\tbreak;\n\tcase GUEST_GS_SELECTOR:\n\t\t*value = current_evmcs->guest_gs_selector;\n\t\tbreak;\n\tcase GUEST_LDTR_SELECTOR:\n\t\t*value = current_evmcs->guest_ldtr_selector;\n\t\tbreak;\n\tcase GUEST_TR_SELECTOR:\n\t\t*value = current_evmcs->guest_tr_selector;\n\t\tbreak;\n\tcase VIRTUAL_PROCESSOR_ID:\n\t\t*value = current_evmcs->virtual_processor_id;\n\t\tbreak;\n\tcase HOST_IA32_PERF_GLOBAL_CTRL:\n\t\t*value = current_evmcs->host_ia32_perf_global_ctrl;\n\t\tbreak;\n\tcase GUEST_IA32_PERF_GLOBAL_CTRL:\n\t\t*value = current_evmcs->guest_ia32_perf_global_ctrl;\n\t\tbreak;\n\tcase ENCLS_EXITING_BITMAP:\n\t\t*value = current_evmcs->encls_exiting_bitmap;\n\t\tbreak;\n\tcase TSC_MULTIPLIER:\n\t\t*value = current_evmcs->tsc_multiplier;\n\t\tbreak;\n\tdefault: return 1;\n\t}\n\n\treturn 0;\n}\n\nstatic inline int evmcs_vmwrite(uint64_t encoding, uint64_t value)\n{\n\tswitch (encoding) {\n\tcase GUEST_RIP:\n\t\tcurrent_evmcs->guest_rip = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_NONE;\n\t\tbreak;\n\tcase GUEST_RSP:\n\t\tcurrent_evmcs->guest_rsp = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_GUEST_BASIC;\n\t\tbreak;\n\tcase GUEST_RFLAGS:\n\t\tcurrent_evmcs->guest_rflags = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_GUEST_BASIC;\n\t\tbreak;\n\tcase HOST_IA32_PAT:\n\t\tcurrent_evmcs->host_ia32_pat = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_HOST_GRP1;\n\t\tbreak;\n\tcase HOST_IA32_EFER:\n\t\tcurrent_evmcs->host_ia32_efer = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_HOST_GRP1;\n\t\tbreak;\n\tcase HOST_CR0:\n\t\tcurrent_evmcs->host_cr0 = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_HOST_GRP1;\n\t\tbreak;\n\tcase HOST_CR3:\n\t\tcurrent_evmcs->host_cr3 = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_HOST_GRP1;\n\t\tbreak;\n\tcase HOST_CR4:\n\t\tcurrent_evmcs->host_cr4 = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_HOST_GRP1;\n\t\tbreak;\n\tcase HOST_IA32_SYSENTER_ESP:\n\t\tcurrent_evmcs->host_ia32_sysenter_esp = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_HOST_GRP1;\n\t\tbreak;\n\tcase HOST_IA32_SYSENTER_EIP:\n\t\tcurrent_evmcs->host_ia32_sysenter_eip = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_HOST_GRP1;\n\t\tbreak;\n\tcase HOST_RIP:\n\t\tcurrent_evmcs->host_rip = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_HOST_GRP1;\n\t\tbreak;\n\tcase IO_BITMAP_A:\n\t\tcurrent_evmcs->io_bitmap_a = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_IO_BITMAP;\n\t\tbreak;\n\tcase IO_BITMAP_B:\n\t\tcurrent_evmcs->io_bitmap_b = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_IO_BITMAP;\n\t\tbreak;\n\tcase MSR_BITMAP:\n\t\tcurrent_evmcs->msr_bitmap = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_MSR_BITMAP;\n\t\tbreak;\n\tcase GUEST_ES_BASE:\n\t\tcurrent_evmcs->guest_es_base = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_GUEST_GRP2;\n\t\tbreak;\n\tcase GUEST_CS_BASE:\n\t\tcurrent_evmcs->guest_cs_base = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_GUEST_GRP2;\n\t\tbreak;\n\tcase GUEST_SS_BASE:\n\t\tcurrent_evmcs->guest_ss_base = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_GUEST_GRP2;\n\t\tbreak;\n\tcase GUEST_DS_BASE:\n\t\tcurrent_evmcs->guest_ds_base = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_GUEST_GRP2;\n\t\tbreak;\n\tcase GUEST_FS_BASE:\n\t\tcurrent_evmcs->guest_fs_base = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_GUEST_GRP2;\n\t\tbreak;\n\tcase GUEST_GS_BASE:\n\t\tcurrent_evmcs->guest_gs_base = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_GUEST_GRP2;\n\t\tbreak;\n\tcase GUEST_LDTR_BASE:\n\t\tcurrent_evmcs->guest_ldtr_base = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_GUEST_GRP2;\n\t\tbreak;\n\tcase GUEST_TR_BASE:\n\t\tcurrent_evmcs->guest_tr_base = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_GUEST_GRP2;\n\t\tbreak;\n\tcase GUEST_GDTR_BASE:\n\t\tcurrent_evmcs->guest_gdtr_base = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_GUEST_GRP2;\n\t\tbreak;\n\tcase GUEST_IDTR_BASE:\n\t\tcurrent_evmcs->guest_idtr_base = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_GUEST_GRP2;\n\t\tbreak;\n\tcase TSC_OFFSET:\n\t\tcurrent_evmcs->tsc_offset = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_CONTROL_GRP2;\n\t\tbreak;\n\tcase VIRTUAL_APIC_PAGE_ADDR:\n\t\tcurrent_evmcs->virtual_apic_page_addr = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_CONTROL_GRP2;\n\t\tbreak;\n\tcase VMCS_LINK_POINTER:\n\t\tcurrent_evmcs->vmcs_link_pointer = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_GUEST_GRP1;\n\t\tbreak;\n\tcase GUEST_IA32_DEBUGCTL:\n\t\tcurrent_evmcs->guest_ia32_debugctl = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_GUEST_GRP1;\n\t\tbreak;\n\tcase GUEST_IA32_PAT:\n\t\tcurrent_evmcs->guest_ia32_pat = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_GUEST_GRP1;\n\t\tbreak;\n\tcase GUEST_IA32_EFER:\n\t\tcurrent_evmcs->guest_ia32_efer = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_GUEST_GRP1;\n\t\tbreak;\n\tcase GUEST_PDPTR0:\n\t\tcurrent_evmcs->guest_pdptr0 = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_GUEST_GRP1;\n\t\tbreak;\n\tcase GUEST_PDPTR1:\n\t\tcurrent_evmcs->guest_pdptr1 = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_GUEST_GRP1;\n\t\tbreak;\n\tcase GUEST_PDPTR2:\n\t\tcurrent_evmcs->guest_pdptr2 = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_GUEST_GRP1;\n\t\tbreak;\n\tcase GUEST_PDPTR3:\n\t\tcurrent_evmcs->guest_pdptr3 = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_GUEST_GRP1;\n\t\tbreak;\n\tcase GUEST_PENDING_DBG_EXCEPTIONS:\n\t\tcurrent_evmcs->guest_pending_dbg_exceptions = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_GUEST_GRP1;\n\t\tbreak;\n\tcase GUEST_SYSENTER_ESP:\n\t\tcurrent_evmcs->guest_sysenter_esp = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_GUEST_GRP1;\n\t\tbreak;\n\tcase GUEST_SYSENTER_EIP:\n\t\tcurrent_evmcs->guest_sysenter_eip = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_GUEST_GRP1;\n\t\tbreak;\n\tcase CR0_GUEST_HOST_MASK:\n\t\tcurrent_evmcs->cr0_guest_host_mask = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_CRDR;\n\t\tbreak;\n\tcase CR4_GUEST_HOST_MASK:\n\t\tcurrent_evmcs->cr4_guest_host_mask = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_CRDR;\n\t\tbreak;\n\tcase CR0_READ_SHADOW:\n\t\tcurrent_evmcs->cr0_read_shadow = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_CRDR;\n\t\tbreak;\n\tcase CR4_READ_SHADOW:\n\t\tcurrent_evmcs->cr4_read_shadow = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_CRDR;\n\t\tbreak;\n\tcase GUEST_CR0:\n\t\tcurrent_evmcs->guest_cr0 = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_CRDR;\n\t\tbreak;\n\tcase GUEST_CR3:\n\t\tcurrent_evmcs->guest_cr3 = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_CRDR;\n\t\tbreak;\n\tcase GUEST_CR4:\n\t\tcurrent_evmcs->guest_cr4 = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_CRDR;\n\t\tbreak;\n\tcase GUEST_DR7:\n\t\tcurrent_evmcs->guest_dr7 = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_CRDR;\n\t\tbreak;\n\tcase HOST_FS_BASE:\n\t\tcurrent_evmcs->host_fs_base = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_HOST_POINTER;\n\t\tbreak;\n\tcase HOST_GS_BASE:\n\t\tcurrent_evmcs->host_gs_base = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_HOST_POINTER;\n\t\tbreak;\n\tcase HOST_TR_BASE:\n\t\tcurrent_evmcs->host_tr_base = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_HOST_POINTER;\n\t\tbreak;\n\tcase HOST_GDTR_BASE:\n\t\tcurrent_evmcs->host_gdtr_base = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_HOST_POINTER;\n\t\tbreak;\n\tcase HOST_IDTR_BASE:\n\t\tcurrent_evmcs->host_idtr_base = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_HOST_POINTER;\n\t\tbreak;\n\tcase HOST_RSP:\n\t\tcurrent_evmcs->host_rsp = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_HOST_POINTER;\n\t\tbreak;\n\tcase EPT_POINTER:\n\t\tcurrent_evmcs->ept_pointer = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_CONTROL_XLAT;\n\t\tbreak;\n\tcase GUEST_BNDCFGS:\n\t\tcurrent_evmcs->guest_bndcfgs = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_GUEST_GRP1;\n\t\tbreak;\n\tcase XSS_EXIT_BITMAP:\n\t\tcurrent_evmcs->xss_exit_bitmap = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_CONTROL_GRP2;\n\t\tbreak;\n\tcase GUEST_PHYSICAL_ADDRESS:\n\t\tcurrent_evmcs->guest_physical_address = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_NONE;\n\t\tbreak;\n\tcase EXIT_QUALIFICATION:\n\t\tcurrent_evmcs->exit_qualification = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_NONE;\n\t\tbreak;\n\tcase GUEST_LINEAR_ADDRESS:\n\t\tcurrent_evmcs->guest_linear_address = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_NONE;\n\t\tbreak;\n\tcase VM_EXIT_MSR_STORE_ADDR:\n\t\tcurrent_evmcs->vm_exit_msr_store_addr = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_ALL;\n\t\tbreak;\n\tcase VM_EXIT_MSR_LOAD_ADDR:\n\t\tcurrent_evmcs->vm_exit_msr_load_addr = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_ALL;\n\t\tbreak;\n\tcase VM_ENTRY_MSR_LOAD_ADDR:\n\t\tcurrent_evmcs->vm_entry_msr_load_addr = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_ALL;\n\t\tbreak;\n\tcase CR3_TARGET_VALUE0:\n\t\tcurrent_evmcs->cr3_target_value0 = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_ALL;\n\t\tbreak;\n\tcase CR3_TARGET_VALUE1:\n\t\tcurrent_evmcs->cr3_target_value1 = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_ALL;\n\t\tbreak;\n\tcase CR3_TARGET_VALUE2:\n\t\tcurrent_evmcs->cr3_target_value2 = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_ALL;\n\t\tbreak;\n\tcase CR3_TARGET_VALUE3:\n\t\tcurrent_evmcs->cr3_target_value3 = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_ALL;\n\t\tbreak;\n\tcase TPR_THRESHOLD:\n\t\tcurrent_evmcs->tpr_threshold = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_NONE;\n\t\tbreak;\n\tcase GUEST_INTERRUPTIBILITY_INFO:\n\t\tcurrent_evmcs->guest_interruptibility_info = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_GUEST_BASIC;\n\t\tbreak;\n\tcase CPU_BASED_VM_EXEC_CONTROL:\n\t\tcurrent_evmcs->cpu_based_vm_exec_control = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_CONTROL_PROC;\n\t\tbreak;\n\tcase EXCEPTION_BITMAP:\n\t\tcurrent_evmcs->exception_bitmap = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_CONTROL_EXCPN;\n\t\tbreak;\n\tcase VM_ENTRY_CONTROLS:\n\t\tcurrent_evmcs->vm_entry_controls = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_CONTROL_ENTRY;\n\t\tbreak;\n\tcase VM_ENTRY_INTR_INFO_FIELD:\n\t\tcurrent_evmcs->vm_entry_intr_info_field = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_CONTROL_EVENT;\n\t\tbreak;\n\tcase VM_ENTRY_EXCEPTION_ERROR_CODE:\n\t\tcurrent_evmcs->vm_entry_exception_error_code = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_CONTROL_EVENT;\n\t\tbreak;\n\tcase VM_ENTRY_INSTRUCTION_LEN:\n\t\tcurrent_evmcs->vm_entry_instruction_len = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_CONTROL_EVENT;\n\t\tbreak;\n\tcase HOST_IA32_SYSENTER_CS:\n\t\tcurrent_evmcs->host_ia32_sysenter_cs = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_HOST_GRP1;\n\t\tbreak;\n\tcase PIN_BASED_VM_EXEC_CONTROL:\n\t\tcurrent_evmcs->pin_based_vm_exec_control = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_CONTROL_GRP1;\n\t\tbreak;\n\tcase VM_EXIT_CONTROLS:\n\t\tcurrent_evmcs->vm_exit_controls = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_CONTROL_GRP1;\n\t\tbreak;\n\tcase SECONDARY_VM_EXEC_CONTROL:\n\t\tcurrent_evmcs->secondary_vm_exec_control = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_CONTROL_GRP1;\n\t\tbreak;\n\tcase GUEST_ES_LIMIT:\n\t\tcurrent_evmcs->guest_es_limit = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_GUEST_GRP2;\n\t\tbreak;\n\tcase GUEST_CS_LIMIT:\n\t\tcurrent_evmcs->guest_cs_limit = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_GUEST_GRP2;\n\t\tbreak;\n\tcase GUEST_SS_LIMIT:\n\t\tcurrent_evmcs->guest_ss_limit = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_GUEST_GRP2;\n\t\tbreak;\n\tcase GUEST_DS_LIMIT:\n\t\tcurrent_evmcs->guest_ds_limit = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_GUEST_GRP2;\n\t\tbreak;\n\tcase GUEST_FS_LIMIT:\n\t\tcurrent_evmcs->guest_fs_limit = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_GUEST_GRP2;\n\t\tbreak;\n\tcase GUEST_GS_LIMIT:\n\t\tcurrent_evmcs->guest_gs_limit = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_GUEST_GRP2;\n\t\tbreak;\n\tcase GUEST_LDTR_LIMIT:\n\t\tcurrent_evmcs->guest_ldtr_limit = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_GUEST_GRP2;\n\t\tbreak;\n\tcase GUEST_TR_LIMIT:\n\t\tcurrent_evmcs->guest_tr_limit = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_GUEST_GRP2;\n\t\tbreak;\n\tcase GUEST_GDTR_LIMIT:\n\t\tcurrent_evmcs->guest_gdtr_limit = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_GUEST_GRP2;\n\t\tbreak;\n\tcase GUEST_IDTR_LIMIT:\n\t\tcurrent_evmcs->guest_idtr_limit = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_GUEST_GRP2;\n\t\tbreak;\n\tcase GUEST_ES_AR_BYTES:\n\t\tcurrent_evmcs->guest_es_ar_bytes = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_GUEST_GRP2;\n\t\tbreak;\n\tcase GUEST_CS_AR_BYTES:\n\t\tcurrent_evmcs->guest_cs_ar_bytes = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_GUEST_GRP2;\n\t\tbreak;\n\tcase GUEST_SS_AR_BYTES:\n\t\tcurrent_evmcs->guest_ss_ar_bytes = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_GUEST_GRP2;\n\t\tbreak;\n\tcase GUEST_DS_AR_BYTES:\n\t\tcurrent_evmcs->guest_ds_ar_bytes = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_GUEST_GRP2;\n\t\tbreak;\n\tcase GUEST_FS_AR_BYTES:\n\t\tcurrent_evmcs->guest_fs_ar_bytes = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_GUEST_GRP2;\n\t\tbreak;\n\tcase GUEST_GS_AR_BYTES:\n\t\tcurrent_evmcs->guest_gs_ar_bytes = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_GUEST_GRP2;\n\t\tbreak;\n\tcase GUEST_LDTR_AR_BYTES:\n\t\tcurrent_evmcs->guest_ldtr_ar_bytes = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_GUEST_GRP2;\n\t\tbreak;\n\tcase GUEST_TR_AR_BYTES:\n\t\tcurrent_evmcs->guest_tr_ar_bytes = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_GUEST_GRP2;\n\t\tbreak;\n\tcase GUEST_ACTIVITY_STATE:\n\t\tcurrent_evmcs->guest_activity_state = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_GUEST_GRP1;\n\t\tbreak;\n\tcase GUEST_SYSENTER_CS:\n\t\tcurrent_evmcs->guest_sysenter_cs = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_GUEST_GRP1;\n\t\tbreak;\n\tcase VM_INSTRUCTION_ERROR:\n\t\tcurrent_evmcs->vm_instruction_error = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_NONE;\n\t\tbreak;\n\tcase VM_EXIT_REASON:\n\t\tcurrent_evmcs->vm_exit_reason = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_NONE;\n\t\tbreak;\n\tcase VM_EXIT_INTR_INFO:\n\t\tcurrent_evmcs->vm_exit_intr_info = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_NONE;\n\t\tbreak;\n\tcase VM_EXIT_INTR_ERROR_CODE:\n\t\tcurrent_evmcs->vm_exit_intr_error_code = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_NONE;\n\t\tbreak;\n\tcase IDT_VECTORING_INFO_FIELD:\n\t\tcurrent_evmcs->idt_vectoring_info_field = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_NONE;\n\t\tbreak;\n\tcase IDT_VECTORING_ERROR_CODE:\n\t\tcurrent_evmcs->idt_vectoring_error_code = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_NONE;\n\t\tbreak;\n\tcase VM_EXIT_INSTRUCTION_LEN:\n\t\tcurrent_evmcs->vm_exit_instruction_len = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_NONE;\n\t\tbreak;\n\tcase VMX_INSTRUCTION_INFO:\n\t\tcurrent_evmcs->vmx_instruction_info = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_NONE;\n\t\tbreak;\n\tcase PAGE_FAULT_ERROR_CODE_MASK:\n\t\tcurrent_evmcs->page_fault_error_code_mask = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_ALL;\n\t\tbreak;\n\tcase PAGE_FAULT_ERROR_CODE_MATCH:\n\t\tcurrent_evmcs->page_fault_error_code_match = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_ALL;\n\t\tbreak;\n\tcase CR3_TARGET_COUNT:\n\t\tcurrent_evmcs->cr3_target_count = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_ALL;\n\t\tbreak;\n\tcase VM_EXIT_MSR_STORE_COUNT:\n\t\tcurrent_evmcs->vm_exit_msr_store_count = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_ALL;\n\t\tbreak;\n\tcase VM_EXIT_MSR_LOAD_COUNT:\n\t\tcurrent_evmcs->vm_exit_msr_load_count = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_ALL;\n\t\tbreak;\n\tcase VM_ENTRY_MSR_LOAD_COUNT:\n\t\tcurrent_evmcs->vm_entry_msr_load_count = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_ALL;\n\t\tbreak;\n\tcase HOST_ES_SELECTOR:\n\t\tcurrent_evmcs->host_es_selector = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_HOST_GRP1;\n\t\tbreak;\n\tcase HOST_CS_SELECTOR:\n\t\tcurrent_evmcs->host_cs_selector = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_HOST_GRP1;\n\t\tbreak;\n\tcase HOST_SS_SELECTOR:\n\t\tcurrent_evmcs->host_ss_selector = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_HOST_GRP1;\n\t\tbreak;\n\tcase HOST_DS_SELECTOR:\n\t\tcurrent_evmcs->host_ds_selector = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_HOST_GRP1;\n\t\tbreak;\n\tcase HOST_FS_SELECTOR:\n\t\tcurrent_evmcs->host_fs_selector = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_HOST_GRP1;\n\t\tbreak;\n\tcase HOST_GS_SELECTOR:\n\t\tcurrent_evmcs->host_gs_selector = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_HOST_GRP1;\n\t\tbreak;\n\tcase HOST_TR_SELECTOR:\n\t\tcurrent_evmcs->host_tr_selector = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_HOST_GRP1;\n\t\tbreak;\n\tcase GUEST_ES_SELECTOR:\n\t\tcurrent_evmcs->guest_es_selector = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_GUEST_GRP2;\n\t\tbreak;\n\tcase GUEST_CS_SELECTOR:\n\t\tcurrent_evmcs->guest_cs_selector = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_GUEST_GRP2;\n\t\tbreak;\n\tcase GUEST_SS_SELECTOR:\n\t\tcurrent_evmcs->guest_ss_selector = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_GUEST_GRP2;\n\t\tbreak;\n\tcase GUEST_DS_SELECTOR:\n\t\tcurrent_evmcs->guest_ds_selector = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_GUEST_GRP2;\n\t\tbreak;\n\tcase GUEST_FS_SELECTOR:\n\t\tcurrent_evmcs->guest_fs_selector = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_GUEST_GRP2;\n\t\tbreak;\n\tcase GUEST_GS_SELECTOR:\n\t\tcurrent_evmcs->guest_gs_selector = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_GUEST_GRP2;\n\t\tbreak;\n\tcase GUEST_LDTR_SELECTOR:\n\t\tcurrent_evmcs->guest_ldtr_selector = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_GUEST_GRP2;\n\t\tbreak;\n\tcase GUEST_TR_SELECTOR:\n\t\tcurrent_evmcs->guest_tr_selector = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_GUEST_GRP2;\n\t\tbreak;\n\tcase VIRTUAL_PROCESSOR_ID:\n\t\tcurrent_evmcs->virtual_processor_id = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_CONTROL_XLAT;\n\t\tbreak;\n\tcase HOST_IA32_PERF_GLOBAL_CTRL:\n\t\tcurrent_evmcs->host_ia32_perf_global_ctrl = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_HOST_GRP1;\n\t\tbreak;\n\tcase GUEST_IA32_PERF_GLOBAL_CTRL:\n\t\tcurrent_evmcs->guest_ia32_perf_global_ctrl = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_GUEST_GRP1;\n\t\tbreak;\n\tcase ENCLS_EXITING_BITMAP:\n\t\tcurrent_evmcs->encls_exiting_bitmap = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_CONTROL_GRP2;\n\t\tbreak;\n\tcase TSC_MULTIPLIER:\n\t\tcurrent_evmcs->tsc_multiplier = value;\n\t\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_CONTROL_GRP2;\n\t\tbreak;\n\tdefault: return 1;\n\t}\n\n\treturn 0;\n}\n\nstatic inline int evmcs_vmlaunch(void)\n{\n\tint ret;\n\n\tcurrent_evmcs->hv_clean_fields = 0;\n\n\t__asm__ __volatile__(\"push %%rbp;\"\n\t\t\t     \"push %%rcx;\"\n\t\t\t     \"push %%rdx;\"\n\t\t\t     \"push %%rsi;\"\n\t\t\t     \"push %%rdi;\"\n\t\t\t     \"push $0;\"\n\t\t\t     \"mov %%rsp, (%[host_rsp]);\"\n\t\t\t     \"lea 1f(%%rip), %%rax;\"\n\t\t\t     \"mov %%rax, (%[host_rip]);\"\n\t\t\t     \"vmlaunch;\"\n\t\t\t     \"incq (%%rsp);\"\n\t\t\t     \"1: pop %%rax;\"\n\t\t\t     \"pop %%rdi;\"\n\t\t\t     \"pop %%rsi;\"\n\t\t\t     \"pop %%rdx;\"\n\t\t\t     \"pop %%rcx;\"\n\t\t\t     \"pop %%rbp;\"\n\t\t\t     : [ret]\"=&a\"(ret)\n\t\t\t     : [host_rsp]\"r\"\n\t\t\t       ((uint64_t)&current_evmcs->host_rsp),\n\t\t\t       [host_rip]\"r\"\n\t\t\t       ((uint64_t)&current_evmcs->host_rip)\n\t\t\t     : \"memory\", \"cc\", \"rbx\", \"r8\", \"r9\", \"r10\",\n\t\t\t       \"r11\", \"r12\", \"r13\", \"r14\", \"r15\");\n\treturn ret;\n}\n\n \nstatic inline int evmcs_vmresume(void)\n{\n\tint ret;\n\n\t \n\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_HOST_GRP1;\n\t \n\tcurrent_evmcs->hv_clean_fields &= ~HV_VMX_ENLIGHTENED_CLEAN_FIELD_HOST_POINTER;\n\n\t__asm__ __volatile__(\"push %%rbp;\"\n\t\t\t     \"push %%rcx;\"\n\t\t\t     \"push %%rdx;\"\n\t\t\t     \"push %%rsi;\"\n\t\t\t     \"push %%rdi;\"\n\t\t\t     \"push $0;\"\n\t\t\t     \"mov %%rsp, (%[host_rsp]);\"\n\t\t\t     \"lea 1f(%%rip), %%rax;\"\n\t\t\t     \"mov %%rax, (%[host_rip]);\"\n\t\t\t     \"vmresume;\"\n\t\t\t     \"incq (%%rsp);\"\n\t\t\t     \"1: pop %%rax;\"\n\t\t\t     \"pop %%rdi;\"\n\t\t\t     \"pop %%rsi;\"\n\t\t\t     \"pop %%rdx;\"\n\t\t\t     \"pop %%rcx;\"\n\t\t\t     \"pop %%rbp;\"\n\t\t\t     : [ret]\"=&a\"(ret)\n\t\t\t     : [host_rsp]\"r\"\n\t\t\t       ((uint64_t)&current_evmcs->host_rsp),\n\t\t\t       [host_rip]\"r\"\n\t\t\t       ((uint64_t)&current_evmcs->host_rip)\n\t\t\t     : \"memory\", \"cc\", \"rbx\", \"r8\", \"r9\", \"r10\",\n\t\t\t       \"r11\", \"r12\", \"r13\", \"r14\", \"r15\");\n\treturn ret;\n}\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}