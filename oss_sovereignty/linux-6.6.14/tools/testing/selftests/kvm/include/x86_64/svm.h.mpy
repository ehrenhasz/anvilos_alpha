{
  "module_name": "svm.h",
  "hash_id": "f6de47ce684e7a30d875645d4bae6b9e095bb4a5e22fade5da7dbdf024150a30",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/kvm/include/x86_64/svm.h",
  "human_readable_source": " \n \n\n#ifndef SELFTEST_KVM_SVM_H\n#define SELFTEST_KVM_SVM_H\n\nenum {\n\tINTERCEPT_INTR,\n\tINTERCEPT_NMI,\n\tINTERCEPT_SMI,\n\tINTERCEPT_INIT,\n\tINTERCEPT_VINTR,\n\tINTERCEPT_SELECTIVE_CR0,\n\tINTERCEPT_STORE_IDTR,\n\tINTERCEPT_STORE_GDTR,\n\tINTERCEPT_STORE_LDTR,\n\tINTERCEPT_STORE_TR,\n\tINTERCEPT_LOAD_IDTR,\n\tINTERCEPT_LOAD_GDTR,\n\tINTERCEPT_LOAD_LDTR,\n\tINTERCEPT_LOAD_TR,\n\tINTERCEPT_RDTSC,\n\tINTERCEPT_RDPMC,\n\tINTERCEPT_PUSHF,\n\tINTERCEPT_POPF,\n\tINTERCEPT_CPUID,\n\tINTERCEPT_RSM,\n\tINTERCEPT_IRET,\n\tINTERCEPT_INTn,\n\tINTERCEPT_INVD,\n\tINTERCEPT_PAUSE,\n\tINTERCEPT_HLT,\n\tINTERCEPT_INVLPG,\n\tINTERCEPT_INVLPGA,\n\tINTERCEPT_IOIO_PROT,\n\tINTERCEPT_MSR_PROT,\n\tINTERCEPT_TASK_SWITCH,\n\tINTERCEPT_FERR_FREEZE,\n\tINTERCEPT_SHUTDOWN,\n\tINTERCEPT_VMRUN,\n\tINTERCEPT_VMMCALL,\n\tINTERCEPT_VMLOAD,\n\tINTERCEPT_VMSAVE,\n\tINTERCEPT_STGI,\n\tINTERCEPT_CLGI,\n\tINTERCEPT_SKINIT,\n\tINTERCEPT_RDTSCP,\n\tINTERCEPT_ICEBP,\n\tINTERCEPT_WBINVD,\n\tINTERCEPT_MONITOR,\n\tINTERCEPT_MWAIT,\n\tINTERCEPT_MWAIT_COND,\n\tINTERCEPT_XSETBV,\n\tINTERCEPT_RDPRU,\n};\n\nstruct hv_vmcb_enlightenments {\n\tstruct __packed hv_enlightenments_control {\n\t\tu32 nested_flush_hypercall:1;\n\t\tu32 msr_bitmap:1;\n\t\tu32 enlightened_npt_tlb: 1;\n\t\tu32 reserved:29;\n\t} __packed hv_enlightenments_control;\n\tu32 hv_vp_id;\n\tu64 hv_vm_id;\n\tu64 partition_assist_page;\n\tu64 reserved;\n} __packed;\n\n \n#define HV_VMCB_NESTED_ENLIGHTENMENTS (1U << 31)\n\n \n#define HV_SVM_EXITCODE_ENL\t\t\t0xf0000000\n#define HV_SVM_ENL_EXITCODE_TRAP_AFTER_FLUSH\t(1)\n\nstruct __attribute__ ((__packed__)) vmcb_control_area {\n\tu32 intercept_cr;\n\tu32 intercept_dr;\n\tu32 intercept_exceptions;\n\tu64 intercept;\n\tu8 reserved_1[40];\n\tu16 pause_filter_thresh;\n\tu16 pause_filter_count;\n\tu64 iopm_base_pa;\n\tu64 msrpm_base_pa;\n\tu64 tsc_offset;\n\tu32 asid;\n\tu8 tlb_ctl;\n\tu8 reserved_2[3];\n\tu32 int_ctl;\n\tu32 int_vector;\n\tu32 int_state;\n\tu8 reserved_3[4];\n\tu32 exit_code;\n\tu32 exit_code_hi;\n\tu64 exit_info_1;\n\tu64 exit_info_2;\n\tu32 exit_int_info;\n\tu32 exit_int_info_err;\n\tu64 nested_ctl;\n\tu64 avic_vapic_bar;\n\tu8 reserved_4[8];\n\tu32 event_inj;\n\tu32 event_inj_err;\n\tu64 nested_cr3;\n\tu64 virt_ext;\n\tu32 clean;\n\tu32 reserved_5;\n\tu64 next_rip;\n\tu8 insn_len;\n\tu8 insn_bytes[15];\n\tu64 avic_backing_page;\t \n\tu8 reserved_6[8];\t \n\tu64 avic_logical_id;\t \n\tu64 avic_physical_id;\t \n\tu8 reserved_7[8];\n\tu64 vmsa_pa;\t\t \n\tu8 reserved_8[720];\n\t \n\tunion {\n\t\tstruct hv_vmcb_enlightenments hv_enlightenments;\n\t\tu8 reserved_sw[32];\n\t};\n};\n\n\n#define TLB_CONTROL_DO_NOTHING 0\n#define TLB_CONTROL_FLUSH_ALL_ASID 1\n#define TLB_CONTROL_FLUSH_ASID 3\n#define TLB_CONTROL_FLUSH_ASID_LOCAL 7\n\n#define V_TPR_MASK 0x0f\n\n#define V_IRQ_SHIFT 8\n#define V_IRQ_MASK (1 << V_IRQ_SHIFT)\n\n#define V_GIF_SHIFT 9\n#define V_GIF_MASK (1 << V_GIF_SHIFT)\n\n#define V_INTR_PRIO_SHIFT 16\n#define V_INTR_PRIO_MASK (0x0f << V_INTR_PRIO_SHIFT)\n\n#define V_IGN_TPR_SHIFT 20\n#define V_IGN_TPR_MASK (1 << V_IGN_TPR_SHIFT)\n\n#define V_INTR_MASKING_SHIFT 24\n#define V_INTR_MASKING_MASK (1 << V_INTR_MASKING_SHIFT)\n\n#define V_GIF_ENABLE_SHIFT 25\n#define V_GIF_ENABLE_MASK (1 << V_GIF_ENABLE_SHIFT)\n\n#define AVIC_ENABLE_SHIFT 31\n#define AVIC_ENABLE_MASK (1 << AVIC_ENABLE_SHIFT)\n\n#define LBR_CTL_ENABLE_MASK BIT_ULL(0)\n#define VIRTUAL_VMLOAD_VMSAVE_ENABLE_MASK BIT_ULL(1)\n\n#define SVM_INTERRUPT_SHADOW_MASK 1\n\n#define SVM_IOIO_STR_SHIFT 2\n#define SVM_IOIO_REP_SHIFT 3\n#define SVM_IOIO_SIZE_SHIFT 4\n#define SVM_IOIO_ASIZE_SHIFT 7\n\n#define SVM_IOIO_TYPE_MASK 1\n#define SVM_IOIO_STR_MASK (1 << SVM_IOIO_STR_SHIFT)\n#define SVM_IOIO_REP_MASK (1 << SVM_IOIO_REP_SHIFT)\n#define SVM_IOIO_SIZE_MASK (7 << SVM_IOIO_SIZE_SHIFT)\n#define SVM_IOIO_ASIZE_MASK (7 << SVM_IOIO_ASIZE_SHIFT)\n\n#define SVM_VM_CR_VALID_MASK\t0x001fULL\n#define SVM_VM_CR_SVM_LOCK_MASK 0x0008ULL\n#define SVM_VM_CR_SVM_DIS_MASK  0x0010ULL\n\n#define SVM_NESTED_CTL_NP_ENABLE\tBIT(0)\n#define SVM_NESTED_CTL_SEV_ENABLE\tBIT(1)\n\nstruct __attribute__ ((__packed__)) vmcb_seg {\n\tu16 selector;\n\tu16 attrib;\n\tu32 limit;\n\tu64 base;\n};\n\nstruct __attribute__ ((__packed__)) vmcb_save_area {\n\tstruct vmcb_seg es;\n\tstruct vmcb_seg cs;\n\tstruct vmcb_seg ss;\n\tstruct vmcb_seg ds;\n\tstruct vmcb_seg fs;\n\tstruct vmcb_seg gs;\n\tstruct vmcb_seg gdtr;\n\tstruct vmcb_seg ldtr;\n\tstruct vmcb_seg idtr;\n\tstruct vmcb_seg tr;\n\tu8 reserved_1[43];\n\tu8 cpl;\n\tu8 reserved_2[4];\n\tu64 efer;\n\tu8 reserved_3[112];\n\tu64 cr4;\n\tu64 cr3;\n\tu64 cr0;\n\tu64 dr7;\n\tu64 dr6;\n\tu64 rflags;\n\tu64 rip;\n\tu8 reserved_4[88];\n\tu64 rsp;\n\tu8 reserved_5[24];\n\tu64 rax;\n\tu64 star;\n\tu64 lstar;\n\tu64 cstar;\n\tu64 sfmask;\n\tu64 kernel_gs_base;\n\tu64 sysenter_cs;\n\tu64 sysenter_esp;\n\tu64 sysenter_eip;\n\tu64 cr2;\n\tu8 reserved_6[32];\n\tu64 g_pat;\n\tu64 dbgctl;\n\tu64 br_from;\n\tu64 br_to;\n\tu64 last_excp_from;\n\tu64 last_excp_to;\n};\n\nstruct __attribute__ ((__packed__)) vmcb {\n\tstruct vmcb_control_area control;\n\tstruct vmcb_save_area save;\n};\n\n#define SVM_VM_CR_SVM_DISABLE 4\n\n#define SVM_SELECTOR_S_SHIFT 4\n#define SVM_SELECTOR_DPL_SHIFT 5\n#define SVM_SELECTOR_P_SHIFT 7\n#define SVM_SELECTOR_AVL_SHIFT 8\n#define SVM_SELECTOR_L_SHIFT 9\n#define SVM_SELECTOR_DB_SHIFT 10\n#define SVM_SELECTOR_G_SHIFT 11\n\n#define SVM_SELECTOR_TYPE_MASK (0xf)\n#define SVM_SELECTOR_S_MASK (1 << SVM_SELECTOR_S_SHIFT)\n#define SVM_SELECTOR_DPL_MASK (3 << SVM_SELECTOR_DPL_SHIFT)\n#define SVM_SELECTOR_P_MASK (1 << SVM_SELECTOR_P_SHIFT)\n#define SVM_SELECTOR_AVL_MASK (1 << SVM_SELECTOR_AVL_SHIFT)\n#define SVM_SELECTOR_L_MASK (1 << SVM_SELECTOR_L_SHIFT)\n#define SVM_SELECTOR_DB_MASK (1 << SVM_SELECTOR_DB_SHIFT)\n#define SVM_SELECTOR_G_MASK (1 << SVM_SELECTOR_G_SHIFT)\n\n#define SVM_SELECTOR_WRITE_MASK (1 << 1)\n#define SVM_SELECTOR_READ_MASK SVM_SELECTOR_WRITE_MASK\n#define SVM_SELECTOR_CODE_MASK (1 << 3)\n\n#define INTERCEPT_CR0_READ\t0\n#define INTERCEPT_CR3_READ\t3\n#define INTERCEPT_CR4_READ\t4\n#define INTERCEPT_CR8_READ\t8\n#define INTERCEPT_CR0_WRITE\t(16 + 0)\n#define INTERCEPT_CR3_WRITE\t(16 + 3)\n#define INTERCEPT_CR4_WRITE\t(16 + 4)\n#define INTERCEPT_CR8_WRITE\t(16 + 8)\n\n#define INTERCEPT_DR0_READ\t0\n#define INTERCEPT_DR1_READ\t1\n#define INTERCEPT_DR2_READ\t2\n#define INTERCEPT_DR3_READ\t3\n#define INTERCEPT_DR4_READ\t4\n#define INTERCEPT_DR5_READ\t5\n#define INTERCEPT_DR6_READ\t6\n#define INTERCEPT_DR7_READ\t7\n#define INTERCEPT_DR0_WRITE\t(16 + 0)\n#define INTERCEPT_DR1_WRITE\t(16 + 1)\n#define INTERCEPT_DR2_WRITE\t(16 + 2)\n#define INTERCEPT_DR3_WRITE\t(16 + 3)\n#define INTERCEPT_DR4_WRITE\t(16 + 4)\n#define INTERCEPT_DR5_WRITE\t(16 + 5)\n#define INTERCEPT_DR6_WRITE\t(16 + 6)\n#define INTERCEPT_DR7_WRITE\t(16 + 7)\n\n#define SVM_EVTINJ_VEC_MASK 0xff\n\n#define SVM_EVTINJ_TYPE_SHIFT 8\n#define SVM_EVTINJ_TYPE_MASK (7 << SVM_EVTINJ_TYPE_SHIFT)\n\n#define SVM_EVTINJ_TYPE_INTR (0 << SVM_EVTINJ_TYPE_SHIFT)\n#define SVM_EVTINJ_TYPE_NMI (2 << SVM_EVTINJ_TYPE_SHIFT)\n#define SVM_EVTINJ_TYPE_EXEPT (3 << SVM_EVTINJ_TYPE_SHIFT)\n#define SVM_EVTINJ_TYPE_SOFT (4 << SVM_EVTINJ_TYPE_SHIFT)\n\n#define SVM_EVTINJ_VALID (1 << 31)\n#define SVM_EVTINJ_VALID_ERR (1 << 11)\n\n#define SVM_EXITINTINFO_VEC_MASK SVM_EVTINJ_VEC_MASK\n#define SVM_EXITINTINFO_TYPE_MASK SVM_EVTINJ_TYPE_MASK\n\n#define\tSVM_EXITINTINFO_TYPE_INTR SVM_EVTINJ_TYPE_INTR\n#define\tSVM_EXITINTINFO_TYPE_NMI SVM_EVTINJ_TYPE_NMI\n#define\tSVM_EXITINTINFO_TYPE_EXEPT SVM_EVTINJ_TYPE_EXEPT\n#define\tSVM_EXITINTINFO_TYPE_SOFT SVM_EVTINJ_TYPE_SOFT\n\n#define SVM_EXITINTINFO_VALID SVM_EVTINJ_VALID\n#define SVM_EXITINTINFO_VALID_ERR SVM_EVTINJ_VALID_ERR\n\n#define SVM_EXITINFOSHIFT_TS_REASON_IRET 36\n#define SVM_EXITINFOSHIFT_TS_REASON_JMP 38\n#define SVM_EXITINFOSHIFT_TS_HAS_ERROR_CODE 44\n\n#define SVM_EXITINFO_REG_MASK 0x0F\n\n#define SVM_CR0_SELECTIVE_MASK (X86_CR0_TS | X86_CR0_MP)\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}