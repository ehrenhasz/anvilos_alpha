{
  "module_name": "hyperv.h",
  "hash_id": "fc4b3a000767ed414db0b6dc0ccc116fb154eaf16c4b5a0de4504f02d37cb886",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/kvm/include/x86_64/hyperv.h",
  "human_readable_source": " \n \n\n#ifndef SELFTEST_KVM_HYPERV_H\n#define SELFTEST_KVM_HYPERV_H\n\n#include \"processor.h\"\n\n#define HYPERV_CPUID_VENDOR_AND_MAX_FUNCTIONS\t0x40000000\n#define HYPERV_CPUID_INTERFACE\t\t\t0x40000001\n#define HYPERV_CPUID_VERSION\t\t\t0x40000002\n#define HYPERV_CPUID_FEATURES\t\t\t0x40000003\n#define HYPERV_CPUID_ENLIGHTMENT_INFO\t\t0x40000004\n#define HYPERV_CPUID_IMPLEMENT_LIMITS\t\t0x40000005\n#define HYPERV_CPUID_CPU_MANAGEMENT_FEATURES\t0x40000007\n#define HYPERV_CPUID_NESTED_FEATURES\t\t0x4000000A\n#define HYPERV_CPUID_SYNDBG_VENDOR_AND_MAX_FUNCTIONS\t0x40000080\n#define HYPERV_CPUID_SYNDBG_INTERFACE\t\t\t0x40000081\n#define HYPERV_CPUID_SYNDBG_PLATFORM_CAPABILITIES\t0x40000082\n\n#define HV_X64_MSR_GUEST_OS_ID\t\t\t0x40000000\n#define HV_X64_MSR_HYPERCALL\t\t\t0x40000001\n#define HV_X64_MSR_VP_INDEX\t\t\t0x40000002\n#define HV_X64_MSR_RESET\t\t\t0x40000003\n#define HV_X64_MSR_VP_RUNTIME\t\t\t0x40000010\n#define HV_X64_MSR_TIME_REF_COUNT\t\t0x40000020\n#define HV_X64_MSR_REFERENCE_TSC\t\t0x40000021\n#define HV_X64_MSR_TSC_FREQUENCY\t\t0x40000022\n#define HV_X64_MSR_APIC_FREQUENCY\t\t0x40000023\n#define HV_X64_MSR_EOI\t\t\t\t0x40000070\n#define HV_X64_MSR_ICR\t\t\t\t0x40000071\n#define HV_X64_MSR_TPR\t\t\t\t0x40000072\n#define HV_X64_MSR_VP_ASSIST_PAGE\t\t0x40000073\n#define HV_X64_MSR_SCONTROL\t\t\t0x40000080\n#define HV_X64_MSR_SVERSION\t\t\t0x40000081\n#define HV_X64_MSR_SIEFP\t\t\t0x40000082\n#define HV_X64_MSR_SIMP\t\t\t\t0x40000083\n#define HV_X64_MSR_EOM\t\t\t\t0x40000084\n#define HV_X64_MSR_SINT0\t\t\t0x40000090\n#define HV_X64_MSR_SINT1\t\t\t0x40000091\n#define HV_X64_MSR_SINT2\t\t\t0x40000092\n#define HV_X64_MSR_SINT3\t\t\t0x40000093\n#define HV_X64_MSR_SINT4\t\t\t0x40000094\n#define HV_X64_MSR_SINT5\t\t\t0x40000095\n#define HV_X64_MSR_SINT6\t\t\t0x40000096\n#define HV_X64_MSR_SINT7\t\t\t0x40000097\n#define HV_X64_MSR_SINT8\t\t\t0x40000098\n#define HV_X64_MSR_SINT9\t\t\t0x40000099\n#define HV_X64_MSR_SINT10\t\t\t0x4000009A\n#define HV_X64_MSR_SINT11\t\t\t0x4000009B\n#define HV_X64_MSR_SINT12\t\t\t0x4000009C\n#define HV_X64_MSR_SINT13\t\t\t0x4000009D\n#define HV_X64_MSR_SINT14\t\t\t0x4000009E\n#define HV_X64_MSR_SINT15\t\t\t0x4000009F\n#define HV_X64_MSR_STIMER0_CONFIG\t\t0x400000B0\n#define HV_X64_MSR_STIMER0_COUNT\t\t0x400000B1\n#define HV_X64_MSR_STIMER1_CONFIG\t\t0x400000B2\n#define HV_X64_MSR_STIMER1_COUNT\t\t0x400000B3\n#define HV_X64_MSR_STIMER2_CONFIG\t\t0x400000B4\n#define HV_X64_MSR_STIMER2_COUNT\t\t0x400000B5\n#define HV_X64_MSR_STIMER3_CONFIG\t\t0x400000B6\n#define HV_X64_MSR_STIMER3_COUNT\t\t0x400000B7\n#define HV_X64_MSR_GUEST_IDLE\t\t\t0x400000F0\n#define HV_X64_MSR_CRASH_P0\t\t\t0x40000100\n#define HV_X64_MSR_CRASH_P1\t\t\t0x40000101\n#define HV_X64_MSR_CRASH_P2\t\t\t0x40000102\n#define HV_X64_MSR_CRASH_P3\t\t\t0x40000103\n#define HV_X64_MSR_CRASH_P4\t\t\t0x40000104\n#define HV_X64_MSR_CRASH_CTL\t\t\t0x40000105\n#define HV_X64_MSR_REENLIGHTENMENT_CONTROL\t0x40000106\n#define HV_X64_MSR_TSC_EMULATION_CONTROL\t0x40000107\n#define HV_X64_MSR_TSC_EMULATION_STATUS\t\t0x40000108\n#define HV_X64_MSR_TSC_INVARIANT_CONTROL\t0x40000118\n\n#define HV_X64_MSR_SYNDBG_CONTROL\t\t0x400000F1\n#define HV_X64_MSR_SYNDBG_STATUS\t\t0x400000F2\n#define HV_X64_MSR_SYNDBG_SEND_BUFFER\t\t0x400000F3\n#define HV_X64_MSR_SYNDBG_RECV_BUFFER\t\t0x400000F4\n#define HV_X64_MSR_SYNDBG_PENDING_BUFFER\t0x400000F5\n#define HV_X64_MSR_SYNDBG_OPTIONS\t\t0x400000FF\n\n \n#define HV_MSR_VP_RUNTIME_AVAILABLE\t\t\\\n\tKVM_X86_CPU_FEATURE(HYPERV_CPUID_FEATURES, 0, EAX, 0)\n#define HV_MSR_TIME_REF_COUNT_AVAILABLE\t\t\\\n\tKVM_X86_CPU_FEATURE(HYPERV_CPUID_FEATURES, 0, EAX, 1)\n#define HV_MSR_SYNIC_AVAILABLE\t\t\t\\\n\tKVM_X86_CPU_FEATURE(HYPERV_CPUID_FEATURES, 0, EAX, 2)\n#define HV_MSR_SYNTIMER_AVAILABLE\t\t\\\n\tKVM_X86_CPU_FEATURE(HYPERV_CPUID_FEATURES, 0, EAX, 3)\n#define HV_MSR_APIC_ACCESS_AVAILABLE\t\t\\\n\tKVM_X86_CPU_FEATURE(HYPERV_CPUID_FEATURES, 0, EAX, 4)\n#define HV_MSR_HYPERCALL_AVAILABLE\t\t\\\n\tKVM_X86_CPU_FEATURE(HYPERV_CPUID_FEATURES, 0, EAX, 5)\n#define HV_MSR_VP_INDEX_AVAILABLE\t\t\\\n\tKVM_X86_CPU_FEATURE(HYPERV_CPUID_FEATURES, 0, EAX, 6)\n#define HV_MSR_RESET_AVAILABLE\t\t\t\\\n\tKVM_X86_CPU_FEATURE(HYPERV_CPUID_FEATURES, 0, EAX, 7)\n#define HV_MSR_STAT_PAGES_AVAILABLE\t\t\\\n\tKVM_X86_CPU_FEATURE(HYPERV_CPUID_FEATURES, 0, EAX, 8)\n#define HV_MSR_REFERENCE_TSC_AVAILABLE\t\t\\\n\tKVM_X86_CPU_FEATURE(HYPERV_CPUID_FEATURES, 0, EAX, 9)\n#define HV_MSR_GUEST_IDLE_AVAILABLE\t\t\\\n\tKVM_X86_CPU_FEATURE(HYPERV_CPUID_FEATURES, 0, EAX, 10)\n#define HV_ACCESS_FREQUENCY_MSRS\t\t\\\n\tKVM_X86_CPU_FEATURE(HYPERV_CPUID_FEATURES, 0, EAX, 11)\n#define HV_ACCESS_REENLIGHTENMENT\t\t\\\n\tKVM_X86_CPU_FEATURE(HYPERV_CPUID_FEATURES, 0, EAX, 13)\n#define HV_ACCESS_TSC_INVARIANT\t\t\t\\\n\tKVM_X86_CPU_FEATURE(HYPERV_CPUID_FEATURES, 0, EAX, 15)\n\n \n#define HV_CREATE_PARTITIONS\t\t        \\\n\tKVM_X86_CPU_FEATURE(HYPERV_CPUID_FEATURES, 0, EBX, 0)\n#define HV_ACCESS_PARTITION_ID\t\t\t\\\n\tKVM_X86_CPU_FEATURE(HYPERV_CPUID_FEATURES, 0, EBX, 1)\n#define HV_ACCESS_MEMORY_POOL\t\t\t\\\n\tKVM_X86_CPU_FEATURE(HYPERV_CPUID_FEATURES, 0, EBX, 2)\n#define HV_ADJUST_MESSAGE_BUFFERS\t\t\\\n\tKVM_X86_CPU_FEATURE(HYPERV_CPUID_FEATURES, 0, EBX, 3)\n#define HV_POST_MESSAGES\t\t\t\\\n\tKVM_X86_CPU_FEATURE(HYPERV_CPUID_FEATURES, 0, EBX, 4)\n#define HV_SIGNAL_EVENTS\t\t\t\\\n\tKVM_X86_CPU_FEATURE(HYPERV_CPUID_FEATURES, 0, EBX, 5)\n#define HV_CREATE_PORT\t\t\t\t\\\n\tKVM_X86_CPU_FEATURE(HYPERV_CPUID_FEATURES, 0, EBX, 6)\n#define HV_CONNECT_PORT\t\t\t\t\\\n\tKVM_X86_CPU_FEATURE(HYPERV_CPUID_FEATURES, 0, EBX, 7)\n#define HV_ACCESS_STATS\t\t\t\t\\\n\tKVM_X86_CPU_FEATURE(HYPERV_CPUID_FEATURES, 0, EBX, 8)\n#define HV_DEBUGGING\t\t\t\t\\\n\tKVM_X86_CPU_FEATURE(HYPERV_CPUID_FEATURES, 0, EBX, 11)\n#define HV_CPU_MANAGEMENT\t\t\t\\\n\tKVM_X86_CPU_FEATURE(HYPERV_CPUID_FEATURES, 0, EBX, 12)\n#define HV_ENABLE_EXTENDED_HYPERCALLS\t\t\\\n\tKVM_X86_CPU_FEATURE(HYPERV_CPUID_FEATURES, 0, EBX, 20)\n#define HV_ISOLATION\t\t\t\t\\\n\tKVM_X86_CPU_FEATURE(HYPERV_CPUID_FEATURES, 0, EBX, 22)\n\n \n#define HV_X64_MWAIT_AVAILABLE\t\t\t\t\\\n\tKVM_X86_CPU_FEATURE(HYPERV_CPUID_FEATURES, 0, EDX, 0)\n#define HV_X64_GUEST_DEBUGGING_AVAILABLE\t\t\\\n\tKVM_X86_CPU_FEATURE(HYPERV_CPUID_FEATURES, 0, EDX, 1)\n#define HV_X64_PERF_MONITOR_AVAILABLE\t\t\t\\\n\tKVM_X86_CPU_FEATURE(HYPERV_CPUID_FEATURES, 0, EDX, 2)\n#define HV_X64_CPU_DYNAMIC_PARTITIONING_AVAILABLE\t\\\n\tKVM_X86_CPU_FEATURE(HYPERV_CPUID_FEATURES, 0, EDX, 3)\n#define HV_X64_HYPERCALL_XMM_INPUT_AVAILABLE\t\t\\\n\tKVM_X86_CPU_FEATURE(HYPERV_CPUID_FEATURES, 0, EDX, 4)\n#define HV_X64_GUEST_IDLE_STATE_AVAILABLE\t\t\\\n\tKVM_X86_CPU_FEATURE(HYPERV_CPUID_FEATURES, 0, EDX, 5)\n#define HV_FEATURE_FREQUENCY_MSRS_AVAILABLE\t\t\\\n\tKVM_X86_CPU_FEATURE(HYPERV_CPUID_FEATURES, 0, EDX, 8)\n#define HV_FEATURE_GUEST_CRASH_MSR_AVAILABLE\t\t\\\n\tKVM_X86_CPU_FEATURE(HYPERV_CPUID_FEATURES, 0, EDX, 10)\n#define HV_FEATURE_DEBUG_MSRS_AVAILABLE\t\t\t\\\n\tKVM_X86_CPU_FEATURE(HYPERV_CPUID_FEATURES, 0, EDX, 11)\n#define HV_STIMER_DIRECT_MODE_AVAILABLE\t\t\t\\\n\tKVM_X86_CPU_FEATURE(HYPERV_CPUID_FEATURES, 0, EDX, 19)\n\n \n#define HV_X64_AS_SWITCH_RECOMMENDED\t\t\t\\\n\tKVM_X86_CPU_FEATURE(HYPERV_CPUID_ENLIGHTMENT_INFO, 0, EAX, 0)\n#define HV_X64_LOCAL_TLB_FLUSH_RECOMMENDED\t\t\\\n\tKVM_X86_CPU_FEATURE(HYPERV_CPUID_ENLIGHTMENT_INFO, 0, EAX, 1)\n#define HV_X64_REMOTE_TLB_FLUSH_RECOMMENDED\t\t\\\n\tKVM_X86_CPU_FEATURE(HYPERV_CPUID_ENLIGHTMENT_INFO, 0, EAX, 2)\n#define HV_X64_APIC_ACCESS_RECOMMENDED\t\t\t\\\n\tKVM_X86_CPU_FEATURE(HYPERV_CPUID_ENLIGHTMENT_INFO, 0, EAX, 3)\n#define HV_X64_SYSTEM_RESET_RECOMMENDED\t\t\t\\\n\tKVM_X86_CPU_FEATURE(HYPERV_CPUID_ENLIGHTMENT_INFO, 0, EAX, 4)\n#define HV_X64_RELAXED_TIMING_RECOMMENDED\t\t\\\n\tKVM_X86_CPU_FEATURE(HYPERV_CPUID_ENLIGHTMENT_INFO, 0, EAX, 5)\n#define HV_DEPRECATING_AEOI_RECOMMENDED\t\t\t\\\n\tKVM_X86_CPU_FEATURE(HYPERV_CPUID_ENLIGHTMENT_INFO, 0, EAX, 9)\n#define HV_X64_CLUSTER_IPI_RECOMMENDED\t\t\t\\\n\tKVM_X86_CPU_FEATURE(HYPERV_CPUID_ENLIGHTMENT_INFO, 0, EAX, 10)\n#define HV_X64_EX_PROCESSOR_MASKS_RECOMMENDED\t\t\\\n\tKVM_X86_CPU_FEATURE(HYPERV_CPUID_ENLIGHTMENT_INFO, 0, EAX, 11)\n#define HV_X64_ENLIGHTENED_VMCS_RECOMMENDED\t\t\\\n\tKVM_X86_CPU_FEATURE(HYPERV_CPUID_ENLIGHTMENT_INFO, 0, EAX, 14)\n\n \n#define HV_X64_SYNDBG_CAP_ALLOW_KERNEL_DEBUGGING\t\\\n\tKVM_X86_CPU_FEATURE(HYPERV_CPUID_SYNDBG_PLATFORM_CAPABILITIES, 0, EAX, 1)\n\n \n#define HVCALL_FLUSH_VIRTUAL_ADDRESS_SPACE\t0x0002\n#define HVCALL_FLUSH_VIRTUAL_ADDRESS_LIST\t0x0003\n#define HVCALL_NOTIFY_LONG_SPIN_WAIT\t\t0x0008\n#define HVCALL_SEND_IPI\t\t\t\t0x000b\n#define HVCALL_FLUSH_VIRTUAL_ADDRESS_SPACE_EX\t0x0013\n#define HVCALL_FLUSH_VIRTUAL_ADDRESS_LIST_EX\t0x0014\n#define HVCALL_SEND_IPI_EX\t\t\t0x0015\n#define HVCALL_GET_PARTITION_ID\t\t\t0x0046\n#define HVCALL_DEPOSIT_MEMORY\t\t\t0x0048\n#define HVCALL_CREATE_VP\t\t\t0x004e\n#define HVCALL_GET_VP_REGISTERS\t\t\t0x0050\n#define HVCALL_SET_VP_REGISTERS\t\t\t0x0051\n#define HVCALL_POST_MESSAGE\t\t\t0x005c\n#define HVCALL_SIGNAL_EVENT\t\t\t0x005d\n#define HVCALL_POST_DEBUG_DATA\t\t\t0x0069\n#define HVCALL_RETRIEVE_DEBUG_DATA\t\t0x006a\n#define HVCALL_RESET_DEBUG_SESSION\t\t0x006b\n#define HVCALL_ADD_LOGICAL_PROCESSOR\t\t0x0076\n#define HVCALL_MAP_DEVICE_INTERRUPT\t\t0x007c\n#define HVCALL_UNMAP_DEVICE_INTERRUPT\t\t0x007d\n#define HVCALL_RETARGET_INTERRUPT\t\t0x007e\n#define HVCALL_FLUSH_GUEST_PHYSICAL_ADDRESS_SPACE 0x00af\n#define HVCALL_FLUSH_GUEST_PHYSICAL_ADDRESS_LIST 0x00b0\n\n \n#define HV_EXT_CALL_QUERY_CAPABILITIES\t\t0x8001\n\n#define HV_FLUSH_ALL_PROCESSORS\t\t\tBIT(0)\n#define HV_FLUSH_ALL_VIRTUAL_ADDRESS_SPACES\tBIT(1)\n#define HV_FLUSH_NON_GLOBAL_MAPPINGS_ONLY\tBIT(2)\n#define HV_FLUSH_USE_EXTENDED_RANGE_FORMAT\tBIT(3)\n\n \n#define HV_STATUS_SUCCESS\t\t\t0\n#define HV_STATUS_INVALID_HYPERCALL_CODE\t2\n#define HV_STATUS_INVALID_HYPERCALL_INPUT\t3\n#define HV_STATUS_INVALID_ALIGNMENT\t\t4\n#define HV_STATUS_INVALID_PARAMETER\t\t5\n#define HV_STATUS_ACCESS_DENIED\t\t\t6\n#define HV_STATUS_OPERATION_DENIED\t\t8\n#define HV_STATUS_INSUFFICIENT_MEMORY\t\t11\n#define HV_STATUS_INVALID_PORT_ID\t\t17\n#define HV_STATUS_INVALID_CONNECTION_ID\t\t18\n#define HV_STATUS_INSUFFICIENT_BUFFERS\t\t19\n\n \n#define HV_HYPERCALL_FAST_BIT\t\tBIT(16)\n#define HV_HYPERCALL_VARHEAD_OFFSET\t17\n#define HV_HYPERCALL_REP_COMP_OFFSET\t32\n\n \nstatic inline uint8_t __hyperv_hypercall(u64 control, vm_vaddr_t input_address,\n\t\t\t\t\t vm_vaddr_t output_address,\n\t\t\t\t\t uint64_t *hv_status)\n{\n\tuint64_t error_code;\n\tuint8_t vector;\n\n\t \n\tasm volatile(\"mov %[output_address], %%r8\\n\\t\"\n\t\t     KVM_ASM_SAFE(\"vmcall\")\n\t\t     : \"=a\" (*hv_status),\n\t\t       \"+c\" (control), \"+d\" (input_address),\n\t\t       KVM_ASM_SAFE_OUTPUTS(vector, error_code)\n\t\t     : [output_address] \"r\"(output_address),\n\t\t       \"a\" (-EFAULT)\n\t\t     : \"cc\", \"memory\", \"r8\", KVM_ASM_SAFE_CLOBBERS);\n\treturn vector;\n}\n\n \nstatic inline void hyperv_hypercall(u64 control, vm_vaddr_t input_address,\n\t\t\t\t    vm_vaddr_t output_address)\n{\n\tuint64_t hv_status;\n\tuint8_t vector;\n\n\tvector = __hyperv_hypercall(control, input_address, output_address, &hv_status);\n\n\tGUEST_ASSERT(!vector);\n\tGUEST_ASSERT((hv_status & 0xffff) == 0);\n}\n\n \nstatic inline void hyperv_write_xmm_input(void *data, int n_sse_regs)\n{\n\tint i;\n\n\tfor (i = 0; i < n_sse_regs; i++)\n\t\twrite_sse_reg(i, (sse128_t *)(data + sizeof(sse128_t) * i));\n}\n\n \n#define HYPERV_LINUX_OS_ID ((u64)0x8100 << 48)\n\n#define HV_X64_MSR_VP_ASSIST_PAGE\t\t0x40000073\n#define HV_X64_MSR_VP_ASSIST_PAGE_ENABLE\t0x00000001\n#define HV_X64_MSR_VP_ASSIST_PAGE_ADDRESS_SHIFT\t12\n#define HV_X64_MSR_VP_ASSIST_PAGE_ADDRESS_MASK\t\\\n\t\t(~((1ull << HV_X64_MSR_VP_ASSIST_PAGE_ADDRESS_SHIFT) - 1))\n\nstruct hv_nested_enlightenments_control {\n\tstruct {\n\t\t__u32 directhypercall:1;\n\t\t__u32 reserved:31;\n\t} features;\n\tstruct {\n\t\t__u32 reserved;\n\t} hypercallControls;\n} __packed;\n\n \nstruct hv_vp_assist_page {\n\t__u32 apic_assist;\n\t__u32 reserved1;\n\t__u64 vtl_control[3];\n\tstruct hv_nested_enlightenments_control nested_control;\n\t__u8 enlighten_vmentry;\n\t__u8 reserved2[7];\n\t__u64 current_nested_vmcs;\n} __packed;\n\nextern struct hv_vp_assist_page *current_vp_assist;\n\nint enable_vp_assist(uint64_t vp_assist_pa, void *vp_assist);\n\nstruct hyperv_test_pages {\n\t \n\tvoid *vp_assist_hva;\n\tuint64_t vp_assist_gpa;\n\tvoid *vp_assist;\n\n\t \n\tvoid *partition_assist_hva;\n\tuint64_t partition_assist_gpa;\n\tvoid *partition_assist;\n\n\t \n\tvoid *enlightened_vmcs_hva;\n\tuint64_t enlightened_vmcs_gpa;\n\tvoid *enlightened_vmcs;\n};\n\nstruct hyperv_test_pages *vcpu_alloc_hyperv_test_pages(struct kvm_vm *vm,\n\t\t\t\t\t\t       vm_vaddr_t *p_hv_pages_gva);\n\n \n#define HV_INVARIANT_TSC_EXPOSED               BIT_ULL(0)\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}