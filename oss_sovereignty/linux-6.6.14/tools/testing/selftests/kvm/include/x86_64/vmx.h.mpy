{
  "module_name": "vmx.h",
  "hash_id": "f9a88b5618a5a1e81befa6158072594d6bbc3546f0b50585fb566b4bc1dd8b4f",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/kvm/include/x86_64/vmx.h",
  "human_readable_source": " \n \n\n#ifndef SELFTEST_KVM_VMX_H\n#define SELFTEST_KVM_VMX_H\n\n#include <asm/vmx.h>\n\n#include <stdint.h>\n#include \"processor.h\"\n#include \"apic.h\"\n\n \n#define CPU_BASED_INTR_WINDOW_EXITING\t\t0x00000004\n#define CPU_BASED_USE_TSC_OFFSETTING\t\t0x00000008\n#define CPU_BASED_HLT_EXITING\t\t\t0x00000080\n#define CPU_BASED_INVLPG_EXITING\t\t0x00000200\n#define CPU_BASED_MWAIT_EXITING\t\t\t0x00000400\n#define CPU_BASED_RDPMC_EXITING\t\t\t0x00000800\n#define CPU_BASED_RDTSC_EXITING\t\t\t0x00001000\n#define CPU_BASED_CR3_LOAD_EXITING\t\t0x00008000\n#define CPU_BASED_CR3_STORE_EXITING\t\t0x00010000\n#define CPU_BASED_CR8_LOAD_EXITING\t\t0x00080000\n#define CPU_BASED_CR8_STORE_EXITING\t\t0x00100000\n#define CPU_BASED_TPR_SHADOW\t\t\t0x00200000\n#define CPU_BASED_NMI_WINDOW_EXITING\t\t0x00400000\n#define CPU_BASED_MOV_DR_EXITING\t\t0x00800000\n#define CPU_BASED_UNCOND_IO_EXITING\t\t0x01000000\n#define CPU_BASED_USE_IO_BITMAPS\t\t0x02000000\n#define CPU_BASED_MONITOR_TRAP\t\t\t0x08000000\n#define CPU_BASED_USE_MSR_BITMAPS\t\t0x10000000\n#define CPU_BASED_MONITOR_EXITING\t\t0x20000000\n#define CPU_BASED_PAUSE_EXITING\t\t\t0x40000000\n#define CPU_BASED_ACTIVATE_SECONDARY_CONTROLS\t0x80000000\n\n#define CPU_BASED_ALWAYSON_WITHOUT_TRUE_MSR\t0x0401e172\n\n \n#define SECONDARY_EXEC_VIRTUALIZE_APIC_ACCESSES 0x00000001\n#define SECONDARY_EXEC_ENABLE_EPT\t\t0x00000002\n#define SECONDARY_EXEC_DESC\t\t\t0x00000004\n#define SECONDARY_EXEC_ENABLE_RDTSCP\t\t0x00000008\n#define SECONDARY_EXEC_VIRTUALIZE_X2APIC_MODE\t0x00000010\n#define SECONDARY_EXEC_ENABLE_VPID\t\t0x00000020\n#define SECONDARY_EXEC_WBINVD_EXITING\t\t0x00000040\n#define SECONDARY_EXEC_UNRESTRICTED_GUEST\t0x00000080\n#define SECONDARY_EXEC_APIC_REGISTER_VIRT\t0x00000100\n#define SECONDARY_EXEC_VIRTUAL_INTR_DELIVERY\t0x00000200\n#define SECONDARY_EXEC_PAUSE_LOOP_EXITING\t0x00000400\n#define SECONDARY_EXEC_RDRAND_EXITING\t\t0x00000800\n#define SECONDARY_EXEC_ENABLE_INVPCID\t\t0x00001000\n#define SECONDARY_EXEC_ENABLE_VMFUNC\t\t0x00002000\n#define SECONDARY_EXEC_SHADOW_VMCS\t\t0x00004000\n#define SECONDARY_EXEC_RDSEED_EXITING\t\t0x00010000\n#define SECONDARY_EXEC_ENABLE_PML\t\t0x00020000\n#define SECONDARY_EPT_VE\t\t\t0x00040000\n#define SECONDARY_ENABLE_XSAV_RESTORE\t\t0x00100000\n#define SECONDARY_EXEC_TSC_SCALING\t\t0x02000000\n\n#define PIN_BASED_EXT_INTR_MASK\t\t\t0x00000001\n#define PIN_BASED_NMI_EXITING\t\t\t0x00000008\n#define PIN_BASED_VIRTUAL_NMIS\t\t\t0x00000020\n#define PIN_BASED_VMX_PREEMPTION_TIMER\t\t0x00000040\n#define PIN_BASED_POSTED_INTR\t\t\t0x00000080\n\n#define PIN_BASED_ALWAYSON_WITHOUT_TRUE_MSR\t0x00000016\n\n#define VM_EXIT_SAVE_DEBUG_CONTROLS\t\t0x00000004\n#define VM_EXIT_HOST_ADDR_SPACE_SIZE\t\t0x00000200\n#define VM_EXIT_LOAD_IA32_PERF_GLOBAL_CTRL\t0x00001000\n#define VM_EXIT_ACK_INTR_ON_EXIT\t\t0x00008000\n#define VM_EXIT_SAVE_IA32_PAT\t\t\t0x00040000\n#define VM_EXIT_LOAD_IA32_PAT\t\t\t0x00080000\n#define VM_EXIT_SAVE_IA32_EFER\t\t\t0x00100000\n#define VM_EXIT_LOAD_IA32_EFER\t\t\t0x00200000\n#define VM_EXIT_SAVE_VMX_PREEMPTION_TIMER\t0x00400000\n\n#define VM_EXIT_ALWAYSON_WITHOUT_TRUE_MSR\t0x00036dff\n\n#define VM_ENTRY_LOAD_DEBUG_CONTROLS\t\t0x00000004\n#define VM_ENTRY_IA32E_MODE\t\t\t0x00000200\n#define VM_ENTRY_SMM\t\t\t\t0x00000400\n#define VM_ENTRY_DEACT_DUAL_MONITOR\t\t0x00000800\n#define VM_ENTRY_LOAD_IA32_PERF_GLOBAL_CTRL\t0x00002000\n#define VM_ENTRY_LOAD_IA32_PAT\t\t\t0x00004000\n#define VM_ENTRY_LOAD_IA32_EFER\t\t\t0x00008000\n\n#define VM_ENTRY_ALWAYSON_WITHOUT_TRUE_MSR\t0x000011ff\n\n#define VMX_MISC_PREEMPTION_TIMER_RATE_MASK\t0x0000001f\n#define VMX_MISC_SAVE_EFER_LMA\t\t\t0x00000020\n\n#define VMX_EPT_VPID_CAP_1G_PAGES\t\t0x00020000\n#define VMX_EPT_VPID_CAP_AD_BITS\t\t0x00200000\n\n#define EXIT_REASON_FAILED_VMENTRY\t0x80000000\n\nenum vmcs_field {\n\tVIRTUAL_PROCESSOR_ID\t\t= 0x00000000,\n\tPOSTED_INTR_NV\t\t\t= 0x00000002,\n\tGUEST_ES_SELECTOR\t\t= 0x00000800,\n\tGUEST_CS_SELECTOR\t\t= 0x00000802,\n\tGUEST_SS_SELECTOR\t\t= 0x00000804,\n\tGUEST_DS_SELECTOR\t\t= 0x00000806,\n\tGUEST_FS_SELECTOR\t\t= 0x00000808,\n\tGUEST_GS_SELECTOR\t\t= 0x0000080a,\n\tGUEST_LDTR_SELECTOR\t\t= 0x0000080c,\n\tGUEST_TR_SELECTOR\t\t= 0x0000080e,\n\tGUEST_INTR_STATUS\t\t= 0x00000810,\n\tGUEST_PML_INDEX\t\t\t= 0x00000812,\n\tHOST_ES_SELECTOR\t\t= 0x00000c00,\n\tHOST_CS_SELECTOR\t\t= 0x00000c02,\n\tHOST_SS_SELECTOR\t\t= 0x00000c04,\n\tHOST_DS_SELECTOR\t\t= 0x00000c06,\n\tHOST_FS_SELECTOR\t\t= 0x00000c08,\n\tHOST_GS_SELECTOR\t\t= 0x00000c0a,\n\tHOST_TR_SELECTOR\t\t= 0x00000c0c,\n\tIO_BITMAP_A\t\t\t= 0x00002000,\n\tIO_BITMAP_A_HIGH\t\t= 0x00002001,\n\tIO_BITMAP_B\t\t\t= 0x00002002,\n\tIO_BITMAP_B_HIGH\t\t= 0x00002003,\n\tMSR_BITMAP\t\t\t= 0x00002004,\n\tMSR_BITMAP_HIGH\t\t\t= 0x00002005,\n\tVM_EXIT_MSR_STORE_ADDR\t\t= 0x00002006,\n\tVM_EXIT_MSR_STORE_ADDR_HIGH\t= 0x00002007,\n\tVM_EXIT_MSR_LOAD_ADDR\t\t= 0x00002008,\n\tVM_EXIT_MSR_LOAD_ADDR_HIGH\t= 0x00002009,\n\tVM_ENTRY_MSR_LOAD_ADDR\t\t= 0x0000200a,\n\tVM_ENTRY_MSR_LOAD_ADDR_HIGH\t= 0x0000200b,\n\tPML_ADDRESS\t\t\t= 0x0000200e,\n\tPML_ADDRESS_HIGH\t\t= 0x0000200f,\n\tTSC_OFFSET\t\t\t= 0x00002010,\n\tTSC_OFFSET_HIGH\t\t\t= 0x00002011,\n\tVIRTUAL_APIC_PAGE_ADDR\t\t= 0x00002012,\n\tVIRTUAL_APIC_PAGE_ADDR_HIGH\t= 0x00002013,\n\tAPIC_ACCESS_ADDR\t\t= 0x00002014,\n\tAPIC_ACCESS_ADDR_HIGH\t\t= 0x00002015,\n\tPOSTED_INTR_DESC_ADDR\t\t= 0x00002016,\n\tPOSTED_INTR_DESC_ADDR_HIGH\t= 0x00002017,\n\tEPT_POINTER\t\t\t= 0x0000201a,\n\tEPT_POINTER_HIGH\t\t= 0x0000201b,\n\tEOI_EXIT_BITMAP0\t\t= 0x0000201c,\n\tEOI_EXIT_BITMAP0_HIGH\t\t= 0x0000201d,\n\tEOI_EXIT_BITMAP1\t\t= 0x0000201e,\n\tEOI_EXIT_BITMAP1_HIGH\t\t= 0x0000201f,\n\tEOI_EXIT_BITMAP2\t\t= 0x00002020,\n\tEOI_EXIT_BITMAP2_HIGH\t\t= 0x00002021,\n\tEOI_EXIT_BITMAP3\t\t= 0x00002022,\n\tEOI_EXIT_BITMAP3_HIGH\t\t= 0x00002023,\n\tVMREAD_BITMAP\t\t\t= 0x00002026,\n\tVMREAD_BITMAP_HIGH\t\t= 0x00002027,\n\tVMWRITE_BITMAP\t\t\t= 0x00002028,\n\tVMWRITE_BITMAP_HIGH\t\t= 0x00002029,\n\tXSS_EXIT_BITMAP\t\t\t= 0x0000202C,\n\tXSS_EXIT_BITMAP_HIGH\t\t= 0x0000202D,\n\tENCLS_EXITING_BITMAP\t\t= 0x0000202E,\n\tENCLS_EXITING_BITMAP_HIGH\t= 0x0000202F,\n\tTSC_MULTIPLIER\t\t\t= 0x00002032,\n\tTSC_MULTIPLIER_HIGH\t\t= 0x00002033,\n\tGUEST_PHYSICAL_ADDRESS\t\t= 0x00002400,\n\tGUEST_PHYSICAL_ADDRESS_HIGH\t= 0x00002401,\n\tVMCS_LINK_POINTER\t\t= 0x00002800,\n\tVMCS_LINK_POINTER_HIGH\t\t= 0x00002801,\n\tGUEST_IA32_DEBUGCTL\t\t= 0x00002802,\n\tGUEST_IA32_DEBUGCTL_HIGH\t= 0x00002803,\n\tGUEST_IA32_PAT\t\t\t= 0x00002804,\n\tGUEST_IA32_PAT_HIGH\t\t= 0x00002805,\n\tGUEST_IA32_EFER\t\t\t= 0x00002806,\n\tGUEST_IA32_EFER_HIGH\t\t= 0x00002807,\n\tGUEST_IA32_PERF_GLOBAL_CTRL\t= 0x00002808,\n\tGUEST_IA32_PERF_GLOBAL_CTRL_HIGH= 0x00002809,\n\tGUEST_PDPTR0\t\t\t= 0x0000280a,\n\tGUEST_PDPTR0_HIGH\t\t= 0x0000280b,\n\tGUEST_PDPTR1\t\t\t= 0x0000280c,\n\tGUEST_PDPTR1_HIGH\t\t= 0x0000280d,\n\tGUEST_PDPTR2\t\t\t= 0x0000280e,\n\tGUEST_PDPTR2_HIGH\t\t= 0x0000280f,\n\tGUEST_PDPTR3\t\t\t= 0x00002810,\n\tGUEST_PDPTR3_HIGH\t\t= 0x00002811,\n\tGUEST_BNDCFGS\t\t\t= 0x00002812,\n\tGUEST_BNDCFGS_HIGH\t\t= 0x00002813,\n\tHOST_IA32_PAT\t\t\t= 0x00002c00,\n\tHOST_IA32_PAT_HIGH\t\t= 0x00002c01,\n\tHOST_IA32_EFER\t\t\t= 0x00002c02,\n\tHOST_IA32_EFER_HIGH\t\t= 0x00002c03,\n\tHOST_IA32_PERF_GLOBAL_CTRL\t= 0x00002c04,\n\tHOST_IA32_PERF_GLOBAL_CTRL_HIGH\t= 0x00002c05,\n\tPIN_BASED_VM_EXEC_CONTROL\t= 0x00004000,\n\tCPU_BASED_VM_EXEC_CONTROL\t= 0x00004002,\n\tEXCEPTION_BITMAP\t\t= 0x00004004,\n\tPAGE_FAULT_ERROR_CODE_MASK\t= 0x00004006,\n\tPAGE_FAULT_ERROR_CODE_MATCH\t= 0x00004008,\n\tCR3_TARGET_COUNT\t\t= 0x0000400a,\n\tVM_EXIT_CONTROLS\t\t= 0x0000400c,\n\tVM_EXIT_MSR_STORE_COUNT\t\t= 0x0000400e,\n\tVM_EXIT_MSR_LOAD_COUNT\t\t= 0x00004010,\n\tVM_ENTRY_CONTROLS\t\t= 0x00004012,\n\tVM_ENTRY_MSR_LOAD_COUNT\t\t= 0x00004014,\n\tVM_ENTRY_INTR_INFO_FIELD\t= 0x00004016,\n\tVM_ENTRY_EXCEPTION_ERROR_CODE\t= 0x00004018,\n\tVM_ENTRY_INSTRUCTION_LEN\t= 0x0000401a,\n\tTPR_THRESHOLD\t\t\t= 0x0000401c,\n\tSECONDARY_VM_EXEC_CONTROL\t= 0x0000401e,\n\tPLE_GAP\t\t\t\t= 0x00004020,\n\tPLE_WINDOW\t\t\t= 0x00004022,\n\tVM_INSTRUCTION_ERROR\t\t= 0x00004400,\n\tVM_EXIT_REASON\t\t\t= 0x00004402,\n\tVM_EXIT_INTR_INFO\t\t= 0x00004404,\n\tVM_EXIT_INTR_ERROR_CODE\t\t= 0x00004406,\n\tIDT_VECTORING_INFO_FIELD\t= 0x00004408,\n\tIDT_VECTORING_ERROR_CODE\t= 0x0000440a,\n\tVM_EXIT_INSTRUCTION_LEN\t\t= 0x0000440c,\n\tVMX_INSTRUCTION_INFO\t\t= 0x0000440e,\n\tGUEST_ES_LIMIT\t\t\t= 0x00004800,\n\tGUEST_CS_LIMIT\t\t\t= 0x00004802,\n\tGUEST_SS_LIMIT\t\t\t= 0x00004804,\n\tGUEST_DS_LIMIT\t\t\t= 0x00004806,\n\tGUEST_FS_LIMIT\t\t\t= 0x00004808,\n\tGUEST_GS_LIMIT\t\t\t= 0x0000480a,\n\tGUEST_LDTR_LIMIT\t\t= 0x0000480c,\n\tGUEST_TR_LIMIT\t\t\t= 0x0000480e,\n\tGUEST_GDTR_LIMIT\t\t= 0x00004810,\n\tGUEST_IDTR_LIMIT\t\t= 0x00004812,\n\tGUEST_ES_AR_BYTES\t\t= 0x00004814,\n\tGUEST_CS_AR_BYTES\t\t= 0x00004816,\n\tGUEST_SS_AR_BYTES\t\t= 0x00004818,\n\tGUEST_DS_AR_BYTES\t\t= 0x0000481a,\n\tGUEST_FS_AR_BYTES\t\t= 0x0000481c,\n\tGUEST_GS_AR_BYTES\t\t= 0x0000481e,\n\tGUEST_LDTR_AR_BYTES\t\t= 0x00004820,\n\tGUEST_TR_AR_BYTES\t\t= 0x00004822,\n\tGUEST_INTERRUPTIBILITY_INFO\t= 0x00004824,\n\tGUEST_ACTIVITY_STATE\t\t= 0X00004826,\n\tGUEST_SYSENTER_CS\t\t= 0x0000482A,\n\tVMX_PREEMPTION_TIMER_VALUE\t= 0x0000482E,\n\tHOST_IA32_SYSENTER_CS\t\t= 0x00004c00,\n\tCR0_GUEST_HOST_MASK\t\t= 0x00006000,\n\tCR4_GUEST_HOST_MASK\t\t= 0x00006002,\n\tCR0_READ_SHADOW\t\t\t= 0x00006004,\n\tCR4_READ_SHADOW\t\t\t= 0x00006006,\n\tCR3_TARGET_VALUE0\t\t= 0x00006008,\n\tCR3_TARGET_VALUE1\t\t= 0x0000600a,\n\tCR3_TARGET_VALUE2\t\t= 0x0000600c,\n\tCR3_TARGET_VALUE3\t\t= 0x0000600e,\n\tEXIT_QUALIFICATION\t\t= 0x00006400,\n\tGUEST_LINEAR_ADDRESS\t\t= 0x0000640a,\n\tGUEST_CR0\t\t\t= 0x00006800,\n\tGUEST_CR3\t\t\t= 0x00006802,\n\tGUEST_CR4\t\t\t= 0x00006804,\n\tGUEST_ES_BASE\t\t\t= 0x00006806,\n\tGUEST_CS_BASE\t\t\t= 0x00006808,\n\tGUEST_SS_BASE\t\t\t= 0x0000680a,\n\tGUEST_DS_BASE\t\t\t= 0x0000680c,\n\tGUEST_FS_BASE\t\t\t= 0x0000680e,\n\tGUEST_GS_BASE\t\t\t= 0x00006810,\n\tGUEST_LDTR_BASE\t\t\t= 0x00006812,\n\tGUEST_TR_BASE\t\t\t= 0x00006814,\n\tGUEST_GDTR_BASE\t\t\t= 0x00006816,\n\tGUEST_IDTR_BASE\t\t\t= 0x00006818,\n\tGUEST_DR7\t\t\t= 0x0000681a,\n\tGUEST_RSP\t\t\t= 0x0000681c,\n\tGUEST_RIP\t\t\t= 0x0000681e,\n\tGUEST_RFLAGS\t\t\t= 0x00006820,\n\tGUEST_PENDING_DBG_EXCEPTIONS\t= 0x00006822,\n\tGUEST_SYSENTER_ESP\t\t= 0x00006824,\n\tGUEST_SYSENTER_EIP\t\t= 0x00006826,\n\tHOST_CR0\t\t\t= 0x00006c00,\n\tHOST_CR3\t\t\t= 0x00006c02,\n\tHOST_CR4\t\t\t= 0x00006c04,\n\tHOST_FS_BASE\t\t\t= 0x00006c06,\n\tHOST_GS_BASE\t\t\t= 0x00006c08,\n\tHOST_TR_BASE\t\t\t= 0x00006c0a,\n\tHOST_GDTR_BASE\t\t\t= 0x00006c0c,\n\tHOST_IDTR_BASE\t\t\t= 0x00006c0e,\n\tHOST_IA32_SYSENTER_ESP\t\t= 0x00006c10,\n\tHOST_IA32_SYSENTER_EIP\t\t= 0x00006c12,\n\tHOST_RSP\t\t\t= 0x00006c14,\n\tHOST_RIP\t\t\t= 0x00006c16,\n};\n\nstruct vmx_msr_entry {\n\tuint32_t index;\n\tuint32_t reserved;\n\tuint64_t value;\n} __attribute__ ((aligned(16)));\n\n#include \"evmcs.h\"\n\nstatic inline int vmxon(uint64_t phys)\n{\n\tuint8_t ret;\n\n\t__asm__ __volatile__ (\"vmxon %[pa]; setna %[ret]\"\n\t\t: [ret]\"=rm\"(ret)\n\t\t: [pa]\"m\"(phys)\n\t\t: \"cc\", \"memory\");\n\n\treturn ret;\n}\n\nstatic inline void vmxoff(void)\n{\n\t__asm__ __volatile__(\"vmxoff\");\n}\n\nstatic inline int vmclear(uint64_t vmcs_pa)\n{\n\tuint8_t ret;\n\n\t__asm__ __volatile__ (\"vmclear %[pa]; setna %[ret]\"\n\t\t: [ret]\"=rm\"(ret)\n\t\t: [pa]\"m\"(vmcs_pa)\n\t\t: \"cc\", \"memory\");\n\n\treturn ret;\n}\n\nstatic inline int vmptrld(uint64_t vmcs_pa)\n{\n\tuint8_t ret;\n\n\tif (enable_evmcs)\n\t\treturn -1;\n\n\t__asm__ __volatile__ (\"vmptrld %[pa]; setna %[ret]\"\n\t\t: [ret]\"=rm\"(ret)\n\t\t: [pa]\"m\"(vmcs_pa)\n\t\t: \"cc\", \"memory\");\n\n\treturn ret;\n}\n\nstatic inline int vmptrst(uint64_t *value)\n{\n\tuint64_t tmp;\n\tuint8_t ret;\n\n\tif (enable_evmcs)\n\t\treturn evmcs_vmptrst(value);\n\n\t__asm__ __volatile__(\"vmptrst %[value]; setna %[ret]\"\n\t\t: [value]\"=m\"(tmp), [ret]\"=rm\"(ret)\n\t\t: : \"cc\", \"memory\");\n\n\t*value = tmp;\n\treturn ret;\n}\n\n \nstatic inline uint64_t vmptrstz(void)\n{\n\tuint64_t value = 0;\n\tvmptrst(&value);\n\treturn value;\n}\n\n \nstatic inline int vmlaunch(void)\n{\n\tint ret;\n\n\tif (enable_evmcs)\n\t\treturn evmcs_vmlaunch();\n\n\t__asm__ __volatile__(\"push %%rbp;\"\n\t\t\t     \"push %%rcx;\"\n\t\t\t     \"push %%rdx;\"\n\t\t\t     \"push %%rsi;\"\n\t\t\t     \"push %%rdi;\"\n\t\t\t     \"push $0;\"\n\t\t\t     \"vmwrite %%rsp, %[host_rsp];\"\n\t\t\t     \"lea 1f(%%rip), %%rax;\"\n\t\t\t     \"vmwrite %%rax, %[host_rip];\"\n\t\t\t     \"vmlaunch;\"\n\t\t\t     \"incq (%%rsp);\"\n\t\t\t     \"1: pop %%rax;\"\n\t\t\t     \"pop %%rdi;\"\n\t\t\t     \"pop %%rsi;\"\n\t\t\t     \"pop %%rdx;\"\n\t\t\t     \"pop %%rcx;\"\n\t\t\t     \"pop %%rbp;\"\n\t\t\t     : [ret]\"=&a\"(ret)\n\t\t\t     : [host_rsp]\"r\"((uint64_t)HOST_RSP),\n\t\t\t       [host_rip]\"r\"((uint64_t)HOST_RIP)\n\t\t\t     : \"memory\", \"cc\", \"rbx\", \"r8\", \"r9\", \"r10\",\n\t\t\t       \"r11\", \"r12\", \"r13\", \"r14\", \"r15\");\n\treturn ret;\n}\n\n \nstatic inline int vmresume(void)\n{\n\tint ret;\n\n\tif (enable_evmcs)\n\t\treturn evmcs_vmresume();\n\n\t__asm__ __volatile__(\"push %%rbp;\"\n\t\t\t     \"push %%rcx;\"\n\t\t\t     \"push %%rdx;\"\n\t\t\t     \"push %%rsi;\"\n\t\t\t     \"push %%rdi;\"\n\t\t\t     \"push $0;\"\n\t\t\t     \"vmwrite %%rsp, %[host_rsp];\"\n\t\t\t     \"lea 1f(%%rip), %%rax;\"\n\t\t\t     \"vmwrite %%rax, %[host_rip];\"\n\t\t\t     \"vmresume;\"\n\t\t\t     \"incq (%%rsp);\"\n\t\t\t     \"1: pop %%rax;\"\n\t\t\t     \"pop %%rdi;\"\n\t\t\t     \"pop %%rsi;\"\n\t\t\t     \"pop %%rdx;\"\n\t\t\t     \"pop %%rcx;\"\n\t\t\t     \"pop %%rbp;\"\n\t\t\t     : [ret]\"=&a\"(ret)\n\t\t\t     : [host_rsp]\"r\"((uint64_t)HOST_RSP),\n\t\t\t       [host_rip]\"r\"((uint64_t)HOST_RIP)\n\t\t\t     : \"memory\", \"cc\", \"rbx\", \"r8\", \"r9\", \"r10\",\n\t\t\t       \"r11\", \"r12\", \"r13\", \"r14\", \"r15\");\n\treturn ret;\n}\n\nstatic inline void vmcall(void)\n{\n\t \n\t__asm__ __volatile__(\"push %%rbp; vmcall; pop %%rbp\"\n\t\t\t     : : \"a\"(0xdeadbeef), \"c\"(0xbeefdead)\n\t\t\t     : \"rbx\", \"rdx\", \"rsi\", \"rdi\", \"r8\", \"r9\",\n\t\t\t       \"r10\", \"r11\", \"r12\", \"r13\", \"r14\", \"r15\");\n}\n\nstatic inline int vmread(uint64_t encoding, uint64_t *value)\n{\n\tuint64_t tmp;\n\tuint8_t ret;\n\n\tif (enable_evmcs)\n\t\treturn evmcs_vmread(encoding, value);\n\n\t__asm__ __volatile__(\"vmread %[encoding], %[value]; setna %[ret]\"\n\t\t: [value]\"=rm\"(tmp), [ret]\"=rm\"(ret)\n\t\t: [encoding]\"r\"(encoding)\n\t\t: \"cc\", \"memory\");\n\n\t*value = tmp;\n\treturn ret;\n}\n\n \nstatic inline uint64_t vmreadz(uint64_t encoding)\n{\n\tuint64_t value = 0;\n\tvmread(encoding, &value);\n\treturn value;\n}\n\nstatic inline int vmwrite(uint64_t encoding, uint64_t value)\n{\n\tuint8_t ret;\n\n\tif (enable_evmcs)\n\t\treturn evmcs_vmwrite(encoding, value);\n\n\t__asm__ __volatile__ (\"vmwrite %[value], %[encoding]; setna %[ret]\"\n\t\t: [ret]\"=rm\"(ret)\n\t\t: [value]\"rm\"(value), [encoding]\"r\"(encoding)\n\t\t: \"cc\", \"memory\");\n\n\treturn ret;\n}\n\nstatic inline uint32_t vmcs_revision(void)\n{\n\treturn rdmsr(MSR_IA32_VMX_BASIC);\n}\n\nstruct vmx_pages {\n\tvoid *vmxon_hva;\n\tuint64_t vmxon_gpa;\n\tvoid *vmxon;\n\n\tvoid *vmcs_hva;\n\tuint64_t vmcs_gpa;\n\tvoid *vmcs;\n\n\tvoid *msr_hva;\n\tuint64_t msr_gpa;\n\tvoid *msr;\n\n\tvoid *shadow_vmcs_hva;\n\tuint64_t shadow_vmcs_gpa;\n\tvoid *shadow_vmcs;\n\n\tvoid *vmread_hva;\n\tuint64_t vmread_gpa;\n\tvoid *vmread;\n\n\tvoid *vmwrite_hva;\n\tuint64_t vmwrite_gpa;\n\tvoid *vmwrite;\n\n\tvoid *eptp_hva;\n\tuint64_t eptp_gpa;\n\tvoid *eptp;\n\n\tvoid *apic_access_hva;\n\tuint64_t apic_access_gpa;\n\tvoid *apic_access;\n};\n\nunion vmx_basic {\n\tu64 val;\n\tstruct {\n\t\tu32 revision;\n\t\tu32\tsize:13,\n\t\t\treserved1:3,\n\t\t\twidth:1,\n\t\t\tdual:1,\n\t\t\ttype:4,\n\t\t\tinsouts:1,\n\t\t\tctrl:1,\n\t\t\tvm_entry_exception_ctrl:1,\n\t\t\treserved2:7;\n\t};\n};\n\nunion vmx_ctrl_msr {\n\tu64 val;\n\tstruct {\n\t\tu32 set, clr;\n\t};\n};\n\nstruct vmx_pages *vcpu_alloc_vmx(struct kvm_vm *vm, vm_vaddr_t *p_vmx_gva);\nbool prepare_for_vmx_operation(struct vmx_pages *vmx);\nvoid prepare_vmcs(struct vmx_pages *vmx, void *guest_rip, void *guest_rsp);\nbool load_vmcs(struct vmx_pages *vmx);\n\nbool ept_1g_pages_supported(void);\n\nvoid nested_pg_map(struct vmx_pages *vmx, struct kvm_vm *vm,\n\t\t   uint64_t nested_paddr, uint64_t paddr);\nvoid nested_map(struct vmx_pages *vmx, struct kvm_vm *vm,\n\t\t uint64_t nested_paddr, uint64_t paddr, uint64_t size);\nvoid nested_map_memslot(struct vmx_pages *vmx, struct kvm_vm *vm,\n\t\t\tuint32_t memslot);\nvoid nested_identity_map_1g(struct vmx_pages *vmx, struct kvm_vm *vm,\n\t\t\t    uint64_t addr, uint64_t size);\nbool kvm_cpu_has_ept(void);\nvoid prepare_eptp(struct vmx_pages *vmx, struct kvm_vm *vm,\n\t\t  uint32_t eptp_memslot);\nvoid prepare_virtualize_apic_accesses(struct vmx_pages *vmx, struct kvm_vm *vm);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}