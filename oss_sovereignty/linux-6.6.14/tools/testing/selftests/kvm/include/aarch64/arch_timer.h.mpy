{
  "module_name": "arch_timer.h",
  "hash_id": "dae92aa3c81bba267376d31b585ced4810aeba9364f248d727211e6964caa31c",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/kvm/include/aarch64/arch_timer.h",
  "human_readable_source": " \n \n\n#ifndef SELFTEST_KVM_ARCH_TIMER_H\n#define SELFTEST_KVM_ARCH_TIMER_H\n\n#include \"processor.h\"\n\nenum arch_timer {\n\tVIRTUAL,\n\tPHYSICAL,\n};\n\n#define CTL_ENABLE\t(1 << 0)\n#define CTL_IMASK\t(1 << 1)\n#define CTL_ISTATUS\t(1 << 2)\n\n#define msec_to_cycles(msec)\t\\\n\t(timer_get_cntfrq() * (uint64_t)(msec) / 1000)\n\n#define usec_to_cycles(usec)\t\\\n\t(timer_get_cntfrq() * (uint64_t)(usec) / 1000000)\n\n#define cycles_to_usec(cycles) \\\n\t((uint64_t)(cycles) * 1000000 / timer_get_cntfrq())\n\nstatic inline uint32_t timer_get_cntfrq(void)\n{\n\treturn read_sysreg(cntfrq_el0);\n}\n\nstatic inline uint64_t timer_get_cntct(enum arch_timer timer)\n{\n\tisb();\n\n\tswitch (timer) {\n\tcase VIRTUAL:\n\t\treturn read_sysreg(cntvct_el0);\n\tcase PHYSICAL:\n\t\treturn read_sysreg(cntpct_el0);\n\tdefault:\n\t\tGUEST_FAIL(\"Unexpected timer type = %u\", timer);\n\t}\n\n\t \n\treturn 0;\n}\n\nstatic inline void timer_set_cval(enum arch_timer timer, uint64_t cval)\n{\n\tswitch (timer) {\n\tcase VIRTUAL:\n\t\twrite_sysreg(cval, cntv_cval_el0);\n\t\tbreak;\n\tcase PHYSICAL:\n\t\twrite_sysreg(cval, cntp_cval_el0);\n\t\tbreak;\n\tdefault:\n\t\tGUEST_FAIL(\"Unexpected timer type = %u\", timer);\n\t}\n\n\tisb();\n}\n\nstatic inline uint64_t timer_get_cval(enum arch_timer timer)\n{\n\tswitch (timer) {\n\tcase VIRTUAL:\n\t\treturn read_sysreg(cntv_cval_el0);\n\tcase PHYSICAL:\n\t\treturn read_sysreg(cntp_cval_el0);\n\tdefault:\n\t\tGUEST_FAIL(\"Unexpected timer type = %u\", timer);\n\t}\n\n\t \n\treturn 0;\n}\n\nstatic inline void timer_set_tval(enum arch_timer timer, uint32_t tval)\n{\n\tswitch (timer) {\n\tcase VIRTUAL:\n\t\twrite_sysreg(tval, cntv_tval_el0);\n\t\tbreak;\n\tcase PHYSICAL:\n\t\twrite_sysreg(tval, cntp_tval_el0);\n\t\tbreak;\n\tdefault:\n\t\tGUEST_FAIL(\"Unexpected timer type = %u\", timer);\n\t}\n\n\tisb();\n}\n\nstatic inline void timer_set_ctl(enum arch_timer timer, uint32_t ctl)\n{\n\tswitch (timer) {\n\tcase VIRTUAL:\n\t\twrite_sysreg(ctl, cntv_ctl_el0);\n\t\tbreak;\n\tcase PHYSICAL:\n\t\twrite_sysreg(ctl, cntp_ctl_el0);\n\t\tbreak;\n\tdefault:\n\t\tGUEST_FAIL(\"Unexpected timer type = %u\", timer);\n\t}\n\n\tisb();\n}\n\nstatic inline uint32_t timer_get_ctl(enum arch_timer timer)\n{\n\tswitch (timer) {\n\tcase VIRTUAL:\n\t\treturn read_sysreg(cntv_ctl_el0);\n\tcase PHYSICAL:\n\t\treturn read_sysreg(cntp_ctl_el0);\n\tdefault:\n\t\tGUEST_FAIL(\"Unexpected timer type = %u\", timer);\n\t}\n\n\t \n\treturn 0;\n}\n\nstatic inline void timer_set_next_cval_ms(enum arch_timer timer, uint32_t msec)\n{\n\tuint64_t now_ct = timer_get_cntct(timer);\n\tuint64_t next_ct = now_ct + msec_to_cycles(msec);\n\n\ttimer_set_cval(timer, next_ct);\n}\n\nstatic inline void timer_set_next_tval_ms(enum arch_timer timer, uint32_t msec)\n{\n\ttimer_set_tval(timer, msec_to_cycles(msec));\n}\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}