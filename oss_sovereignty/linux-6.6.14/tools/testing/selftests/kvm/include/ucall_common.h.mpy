{
  "module_name": "ucall_common.h",
  "hash_id": "7088295b9372a83f984d79c5879f53c7b54a312a4e977e7f2e652b92dac13727",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/kvm/include/ucall_common.h",
  "human_readable_source": " \n \n#ifndef SELFTEST_KVM_UCALL_COMMON_H\n#define SELFTEST_KVM_UCALL_COMMON_H\n#include \"test_util.h\"\n#include \"ucall.h\"\n\n \nenum {\n\tUCALL_NONE,\n\tUCALL_SYNC,\n\tUCALL_ABORT,\n\tUCALL_PRINTF,\n\tUCALL_DONE,\n\tUCALL_UNHANDLED,\n};\n\n#define UCALL_MAX_ARGS 7\n#define UCALL_BUFFER_LEN 1024\n\nstruct ucall {\n\tuint64_t cmd;\n\tuint64_t args[UCALL_MAX_ARGS];\n\tchar buffer[UCALL_BUFFER_LEN];\n\n\t \n\tstruct ucall *hva;\n};\n\nvoid ucall_arch_init(struct kvm_vm *vm, vm_paddr_t mmio_gpa);\nvoid ucall_arch_do_ucall(vm_vaddr_t uc);\nvoid *ucall_arch_get_ucall(struct kvm_vcpu *vcpu);\n\nvoid ucall(uint64_t cmd, int nargs, ...);\nvoid ucall_fmt(uint64_t cmd, const char *fmt, ...);\nvoid ucall_assert(uint64_t cmd, const char *exp, const char *file,\n\t\t  unsigned int line, const char *fmt, ...);\nuint64_t get_ucall(struct kvm_vcpu *vcpu, struct ucall *uc);\nvoid ucall_init(struct kvm_vm *vm, vm_paddr_t mmio_gpa);\nint ucall_nr_pages_required(uint64_t page_size);\n\n \n#define GUEST_UCALL_NONE()\tucall_arch_do_ucall((vm_vaddr_t)NULL)\n\n#define GUEST_SYNC_ARGS(stage, arg1, arg2, arg3, arg4)\t\\\n\t\t\t\tucall(UCALL_SYNC, 6, \"hello\", stage, arg1, arg2, arg3, arg4)\n#define GUEST_SYNC(stage)\tucall(UCALL_SYNC, 2, \"hello\", stage)\n#define GUEST_PRINTF(_fmt, _args...) ucall_fmt(UCALL_PRINTF, _fmt, ##_args)\n#define GUEST_DONE()\t\tucall(UCALL_DONE, 0)\n\n#define REPORT_GUEST_PRINTF(ucall) pr_info(\"%s\", (ucall).buffer)\n\nenum guest_assert_builtin_args {\n\tGUEST_ERROR_STRING,\n\tGUEST_FILE,\n\tGUEST_LINE,\n\tGUEST_ASSERT_BUILTIN_NARGS\n};\n\n#define ____GUEST_ASSERT(_condition, _exp, _fmt, _args...)\t\t\t\t\\\ndo {\t\t\t\t\t\t\t\t\t\t\t\\\n\tif (!(_condition))\t\t\t\t\t\t\t\t\\\n\t\tucall_assert(UCALL_ABORT, _exp, __FILE__, __LINE__, _fmt, ##_args);\t\\\n} while (0)\n\n#define __GUEST_ASSERT(_condition, _fmt, _args...)\t\t\t\t\\\n\t____GUEST_ASSERT(_condition, #_condition, _fmt, ##_args)\n\n#define GUEST_ASSERT(_condition)\t\t\t\t\t\t\\\n\t__GUEST_ASSERT(_condition, #_condition)\n\n#define GUEST_FAIL(_fmt, _args...)\t\t\t\t\t\t\\\n\tucall_assert(UCALL_ABORT, \"Unconditional guest failure\",\t\t\\\n\t\t     __FILE__, __LINE__, _fmt, ##_args)\n\n#define GUEST_ASSERT_EQ(a, b)\t\t\t\t\t\t\t\\\ndo {\t\t\t\t\t\t\t\t\t\t\\\n\ttypeof(a) __a = (a);\t\t\t\t\t\t\t\\\n\ttypeof(b) __b = (b);\t\t\t\t\t\t\t\\\n\t____GUEST_ASSERT(__a == __b, #a \" == \" #b, \"%#lx != %#lx (%s != %s)\",\t\\\n\t\t\t (unsigned long)(__a), (unsigned long)(__b), #a, #b);\t\\\n} while (0)\n\n#define GUEST_ASSERT_NE(a, b)\t\t\t\t\t\t\t\\\ndo {\t\t\t\t\t\t\t\t\t\t\\\n\ttypeof(a) __a = (a);\t\t\t\t\t\t\t\\\n\ttypeof(b) __b = (b);\t\t\t\t\t\t\t\\\n\t____GUEST_ASSERT(__a != __b, #a \" != \" #b, \"%#lx == %#lx (%s == %s)\",\t\\\n\t\t\t (unsigned long)(__a), (unsigned long)(__b), #a, #b);\t\\\n} while (0)\n\n#define REPORT_GUEST_ASSERT(ucall)\t\t\t\t\t\t\\\n\ttest_assert(false, (const char *)(ucall).args[GUEST_ERROR_STRING],\t\\\n\t\t    (const char *)(ucall).args[GUEST_FILE],\t\t\t\\\n\t\t    (ucall).args[GUEST_LINE], \"%s\", (ucall).buffer)\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}