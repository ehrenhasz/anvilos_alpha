{
  "module_name": "validate_cap.c",
  "hash_id": "b0a2569096ff9dfb44e76d41fea588927607d8692997c1927d118da812851e61",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/capabilities/validate_cap.c",
  "human_readable_source": "\n#include <cap-ng.h>\n#include <linux/capability.h>\n#include <stdbool.h>\n#include <string.h>\n#include <stdio.h>\n#include <sys/prctl.h>\n#include <sys/auxv.h>\n\n#include \"../kselftest.h\"\n\n#ifndef PR_CAP_AMBIENT\n#define PR_CAP_AMBIENT\t\t\t47\n# define PR_CAP_AMBIENT_IS_SET\t\t1\n# define PR_CAP_AMBIENT_RAISE\t\t2\n# define PR_CAP_AMBIENT_LOWER\t\t3\n# define PR_CAP_AMBIENT_CLEAR_ALL\t4\n#endif\n\n#if __GLIBC__ > 2 || (__GLIBC__ == 2 && __GLIBC_MINOR__ >= 19)\n# define HAVE_GETAUXVAL\n#endif\n\nstatic bool bool_arg(char **argv, int i)\n{\n\tif (!strcmp(argv[i], \"0\"))\n\t\treturn false;\n\telse if (!strcmp(argv[i], \"1\"))\n\t\treturn true;\n\telse {\n\t\tksft_exit_fail_msg(\"wrong argv[%d]\\n\", i);\n\t\treturn false;\n\t}\n}\n\nint main(int argc, char **argv)\n{\n\tconst char *atsec = \"\";\n\n\t \n\n\tif (argc != 5)\n\t\tksft_exit_fail_msg(\"wrong argc\\n\");\n\n#ifdef HAVE_GETAUXVAL\n\tif (getauxval(AT_SECURE))\n\t\tatsec = \" (AT_SECURE is set)\";\n\telse\n\t\tatsec = \" (AT_SECURE is not set)\";\n#endif\n\n\tcapng_get_caps_process();\n\n\tif (capng_have_capability(CAPNG_EFFECTIVE, CAP_NET_BIND_SERVICE) != bool_arg(argv, 1)) {\n\t\tksft_print_msg(\"Wrong effective state%s\\n\", atsec);\n\t\treturn 1;\n\t}\n\n\tif (capng_have_capability(CAPNG_PERMITTED, CAP_NET_BIND_SERVICE) != bool_arg(argv, 2)) {\n\t\tksft_print_msg(\"Wrong permitted state%s\\n\", atsec);\n\t\treturn 1;\n\t}\n\n\tif (capng_have_capability(CAPNG_INHERITABLE, CAP_NET_BIND_SERVICE) != bool_arg(argv, 3)) {\n\t\tksft_print_msg(\"Wrong inheritable state%s\\n\", atsec);\n\t\treturn 1;\n\t}\n\n\tif (prctl(PR_CAP_AMBIENT, PR_CAP_AMBIENT_IS_SET, CAP_NET_BIND_SERVICE, 0, 0, 0) != bool_arg(argv, 4)) {\n\t\tksft_print_msg(\"Wrong ambient state%s\\n\", atsec);\n\t\treturn 1;\n\t}\n\n\tksft_print_msg(\"%s: Capabilities after execve were correct\\n\",\n\t\t\t\"validate_cap:\");\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}