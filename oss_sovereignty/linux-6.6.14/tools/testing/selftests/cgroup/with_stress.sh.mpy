{
  "module_name": "with_stress.sh",
  "hash_id": "8fcce45e89dca1ced64e1349e85f47b046d7acbe3445b0345a4b844d832b19e0",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/cgroup/with_stress.sh",
  "human_readable_source": "#!/bin/bash\n# SPDX-License-Identifier: GPL-2.0\n\n# Kselftest framework requirement - SKIP code is 4.\nksft_skip=4\n\nstress_fork()\n{\n\twhile true ; do\n\t\t/usr/bin/true\n\t\tsleep 0.01\n\tdone\n}\n\nstress_subsys()\n{\n\tlocal verb=+\n\twhile true ; do\n\t\techo $verb$subsys_ctrl >$sysfs/cgroup.subtree_control\n\t\t[ $verb = \"+\" ] && verb=- || verb=+\n\t\t# incommensurable period with other stresses\n\t\tsleep 0.011\n\tdone\n}\n\ninit_and_check()\n{\n\tsysfs=`mount -t cgroup2 | head -1 | awk '{ print $3 }'`\n\tif [ ! -d \"$sysfs\" ]; then\n\t\techo \"Skipping: cgroup2 is not mounted\" >&2\n\t\texit $ksft_skip\n\tfi\n\n\tif ! echo +$subsys_ctrl >$sysfs/cgroup.subtree_control ; then\n\t\techo \"Skipping: cannot enable $subsys_ctrl in $sysfs\" >&2\n\t\texit $ksft_skip\n\tfi\n\n\tif ! echo -$subsys_ctrl >$sysfs/cgroup.subtree_control ; then\n\t\techo \"Skipping: cannot disable $subsys_ctrl in $sysfs\" >&2\n\t\texit $ksft_skip\n\tfi\n}\n\ndeclare -a stresses\ndeclare -a stress_pids\nduration=5\nrc=0\nsubsys_ctrl=cpuset\nsysfs=\n\nwhile getopts c:d:hs: opt; do\n\tcase $opt in\n\tc)\n\t\tsubsys_ctrl=$OPTARG\n\t\t;;\n\td)\n\t\tduration=$OPTARG\n\t\t;;\n\th)\n\t\techo \"Usage $0 [ -s stress ] ... [ -d duration ] [-c controller] cmd args ..\"\n\t\techo -e \"\\t default duration $duration seconds\"\n\t\techo -e \"\\t default controller $subsys_ctrl\"\n\t\texit\n\t\t;;\n\ts)\n\t\tfunc=stress_$OPTARG\n\t\tif [ \"x$(type -t $func)\" != \"xfunction\" ] ; then\n\t\t\techo \"Unknown stress $OPTARG\"\n\t\t\texit 1\n\t\tfi\n\t\tstresses+=($func)\n\t\t;;\n\tesac\ndone\nshift $((OPTIND - 1))\n\ninit_and_check\n\nfor s in ${stresses[*]} ; do\n\t$s &\n\tstress_pids+=($!)\ndone\n\n\ntime=0\nstart=$(date +%s)\n\nwhile [ $time -lt $duration ] ; do\n\t$*\n\trc=$?\n\t[ $rc -eq 0 ] || break\n\ttime=$(($(date +%s) - $start))\ndone\n\nfor pid in ${stress_pids[*]} ; do\n\tkill -SIGTERM $pid\n\twait $pid\ndone\n\nexit $rc\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}