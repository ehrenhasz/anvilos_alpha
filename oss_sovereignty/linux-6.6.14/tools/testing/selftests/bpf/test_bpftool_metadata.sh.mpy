{
  "module_name": "test_bpftool_metadata.sh",
  "hash_id": "f9edb1bd10532c51d10b77a0a5a2b1d62c71c6dd227890de7915b85c2ed5865c",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/bpf/test_bpftool_metadata.sh",
  "human_readable_source": "#!/bin/sh\n# SPDX-License-Identifier: GPL-2.0\n\n# Kselftest framework requirement - SKIP code is 4.\nksft_skip=4\n\nBPF_FILE_USED=\"metadata_used.bpf.o\"\nBPF_FILE_UNUSED=\"metadata_unused.bpf.o\"\n\nTESTNAME=bpftool_metadata\nBPF_FS=$(awk '$3 == \"bpf\" {print $2; exit}' /proc/mounts)\nBPF_DIR=$BPF_FS/test_$TESTNAME\n\n_cleanup()\n{\n\tset +e\n\trm -rf $BPF_DIR 2> /dev/null\n}\n\ncleanup_skip()\n{\n\techo \"selftests: $TESTNAME [SKIP]\"\n\t_cleanup\n\n\texit $ksft_skip\n}\n\ncleanup()\n{\n\tif [ \"$?\" = 0 ]; then\n\t\techo \"selftests: $TESTNAME [PASS]\"\n\telse\n\t\techo \"selftests: $TESTNAME [FAILED]\"\n\tfi\n\t_cleanup\n}\n\nif [ $(id -u) -ne 0 ]; then\n\techo \"selftests: $TESTNAME [SKIP] Need root privileges\"\n\texit $ksft_skip\nfi\n\nif [ -z \"$BPF_FS\" ]; then\n\techo \"selftests: $TESTNAME [SKIP] Could not run test without bpffs mounted\"\n\texit $ksft_skip\nfi\n\nif ! bpftool version > /dev/null 2>&1; then\n\techo \"selftests: $TESTNAME [SKIP] Could not run test without bpftool\"\n\texit $ksft_skip\nfi\n\nset -e\n\ntrap cleanup_skip EXIT\n\nmkdir $BPF_DIR\n\ntrap cleanup EXIT\n\nbpftool prog load $BPF_FILE_UNUSED $BPF_DIR/unused\n\nMETADATA_PLAIN=\"$(bpftool prog)\"\necho \"$METADATA_PLAIN\" | grep 'a = \"foo\"' > /dev/null\necho \"$METADATA_PLAIN\" | grep 'b = 1' > /dev/null\n\nbpftool prog --json | grep '\"metadata\":{\"a\":\"foo\",\"b\":1}' > /dev/null\n\nbpftool map | grep 'metadata.rodata' > /dev/null\n\nrm $BPF_DIR/unused\n\nbpftool prog load $BPF_FILE_USED $BPF_DIR/used\n\nMETADATA_PLAIN=\"$(bpftool prog)\"\necho \"$METADATA_PLAIN\" | grep 'a = \"bar\"' > /dev/null\necho \"$METADATA_PLAIN\" | grep 'b = 2' > /dev/null\n\nbpftool prog --json | grep '\"metadata\":{\"a\":\"bar\",\"b\":2}' > /dev/null\n\nbpftool map | grep 'metadata.rodata' > /dev/null\n\nrm $BPF_DIR/used\n\nexit 0\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}