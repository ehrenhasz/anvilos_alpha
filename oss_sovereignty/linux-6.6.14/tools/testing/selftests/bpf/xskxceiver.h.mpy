{
  "module_name": "xskxceiver.h",
  "hash_id": "5543135a96ce0bc2b62f0db4a400c482a6ec12119803a2a3d875ed699a136e25",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/bpf/xskxceiver.h",
  "human_readable_source": " \n\n#ifndef XSKXCEIVER_H_\n#define XSKXCEIVER_H_\n\n#include \"xsk_xdp_progs.skel.h\"\n\n#ifndef SOL_XDP\n#define SOL_XDP 283\n#endif\n\n#ifndef AF_XDP\n#define AF_XDP 44\n#endif\n\n#ifndef PF_XDP\n#define PF_XDP AF_XDP\n#endif\n\n#ifndef SO_BUSY_POLL_BUDGET\n#define SO_BUSY_POLL_BUDGET 70\n#endif\n\n#ifndef SO_PREFER_BUSY_POLL\n#define SO_PREFER_BUSY_POLL 69\n#endif\n\n#define TEST_PASS 0\n#define TEST_FAILURE -1\n#define TEST_CONTINUE 1\n#define TEST_SKIP 2\n#define MAX_INTERFACES 2\n#define MAX_INTERFACE_NAME_CHARS 16\n#define MAX_SOCKETS 2\n#define MAX_TEST_NAME_SIZE 32\n#define MAX_TEARDOWN_ITER 10\n#define PKT_HDR_SIZE (sizeof(struct ethhdr) + 2)  \n#define MIN_PKT_SIZE 64\n#define MAX_ETH_PKT_SIZE 1518\n#define MAX_ETH_JUMBO_SIZE 9000\n#define USLEEP_MAX 10000\n#define SOCK_RECONF_CTR 10\n#define BATCH_SIZE 64\n#define POLL_TMOUT 1000\n#define THREAD_TMOUT 3\n#define DEFAULT_PKT_CNT (4 * 1024)\n#define DEFAULT_UMEM_BUFFERS (DEFAULT_PKT_CNT / 4)\n#define RX_FULL_RXQSIZE 32\n#define UMEM_HEADROOM_TEST_SIZE 128\n#define XSK_UMEM__INVALID_FRAME_SIZE (MAX_ETH_JUMBO_SIZE + 1)\n#define XSK_UMEM__LARGE_FRAME_SIZE (3 * 1024)\n#define XSK_UMEM__MAX_FRAME_SIZE (4 * 1024)\n#define XSK_DESC__INVALID_OPTION (0xffff)\n#define XSK_DESC__MAX_SKB_FRAGS 18\n#define HUGEPAGE_SIZE (2 * 1024 * 1024)\n#define PKT_DUMP_NB_TO_PRINT 16\n\n#define print_verbose(x...) do { if (opt_verbose) ksft_print_msg(x); } while (0)\n\nenum test_mode {\n\tTEST_MODE_SKB,\n\tTEST_MODE_DRV,\n\tTEST_MODE_ZC,\n\tTEST_MODE_MAX\n};\n\nenum test_type {\n\tTEST_TYPE_RUN_TO_COMPLETION,\n\tTEST_TYPE_RUN_TO_COMPLETION_2K_FRAME,\n\tTEST_TYPE_RUN_TO_COMPLETION_SINGLE_PKT,\n\tTEST_TYPE_RX_POLL,\n\tTEST_TYPE_TX_POLL,\n\tTEST_TYPE_POLL_RXQ_TMOUT,\n\tTEST_TYPE_POLL_TXQ_TMOUT,\n\tTEST_TYPE_UNALIGNED,\n\tTEST_TYPE_ALIGNED_INV_DESC,\n\tTEST_TYPE_ALIGNED_INV_DESC_2K_FRAME,\n\tTEST_TYPE_UNALIGNED_INV_DESC,\n\tTEST_TYPE_UNALIGNED_INV_DESC_4K1_FRAME,\n\tTEST_TYPE_HEADROOM,\n\tTEST_TYPE_TEARDOWN,\n\tTEST_TYPE_BIDI,\n\tTEST_TYPE_STATS_RX_DROPPED,\n\tTEST_TYPE_STATS_TX_INVALID_DESCS,\n\tTEST_TYPE_STATS_RX_FULL,\n\tTEST_TYPE_STATS_FILL_EMPTY,\n\tTEST_TYPE_BPF_RES,\n\tTEST_TYPE_XDP_DROP_HALF,\n\tTEST_TYPE_XDP_METADATA_COUNT,\n\tTEST_TYPE_XDP_METADATA_COUNT_MB,\n\tTEST_TYPE_RUN_TO_COMPLETION_MB,\n\tTEST_TYPE_UNALIGNED_MB,\n\tTEST_TYPE_ALIGNED_INV_DESC_MB,\n\tTEST_TYPE_UNALIGNED_INV_DESC_MB,\n\tTEST_TYPE_TOO_MANY_FRAGS,\n\tTEST_TYPE_MAX\n};\n\nstatic bool opt_verbose;\n\nstruct xsk_umem_info {\n\tstruct xsk_ring_prod fq;\n\tstruct xsk_ring_cons cq;\n\tstruct xsk_umem *umem;\n\tu64 next_buffer;\n\tu32 num_frames;\n\tu32 frame_headroom;\n\tvoid *buffer;\n\tu32 frame_size;\n\tu32 base_addr;\n\tbool unaligned_mode;\n};\n\nstruct xsk_socket_info {\n\tstruct xsk_ring_cons rx;\n\tstruct xsk_ring_prod tx;\n\tstruct xsk_umem_info *umem;\n\tstruct xsk_socket *xsk;\n\tu32 outstanding_tx;\n\tu32 rxqsize;\n};\n\nstruct pkt {\n\tint offset;\n\tu32 len;\n\tu32 pkt_nb;\n\tbool valid;\n\tu16 options;\n};\n\nstruct pkt_stream {\n\tu32 nb_pkts;\n\tu32 current_pkt_nb;\n\tstruct pkt *pkts;\n\tu32 max_pkt_len;\n\tbool verbatim;\n};\n\nstruct ifobject;\ntypedef int (*validation_func_t)(struct ifobject *ifobj);\ntypedef void *(*thread_func_t)(void *arg);\n\nstruct ifobject {\n\tchar ifname[MAX_INTERFACE_NAME_CHARS];\n\tstruct xsk_socket_info *xsk;\n\tstruct xsk_socket_info *xsk_arr;\n\tstruct xsk_umem_info *umem;\n\tthread_func_t func_ptr;\n\tvalidation_func_t validation_func;\n\tstruct pkt_stream *pkt_stream;\n\tstruct xsk_xdp_progs *xdp_progs;\n\tstruct bpf_map *xskmap;\n\tstruct bpf_program *xdp_prog;\n\tenum test_mode mode;\n\tint ifindex;\n\tint mtu;\n\tu32 bind_flags;\n\tu32 xdp_zc_max_segs;\n\tbool tx_on;\n\tbool rx_on;\n\tbool use_poll;\n\tbool busy_poll;\n\tbool use_fill_ring;\n\tbool release_rx;\n\tbool shared_umem;\n\tbool use_metadata;\n\tbool unaligned_supp;\n\tbool multi_buff_supp;\n\tbool multi_buff_zc_supp;\n\tu8 dst_mac[ETH_ALEN];\n\tu8 src_mac[ETH_ALEN];\n};\n\nstruct test_spec {\n\tstruct ifobject *ifobj_tx;\n\tstruct ifobject *ifobj_rx;\n\tstruct pkt_stream *tx_pkt_stream_default;\n\tstruct pkt_stream *rx_pkt_stream_default;\n\tstruct bpf_program *xdp_prog_rx;\n\tstruct bpf_program *xdp_prog_tx;\n\tstruct bpf_map *xskmap_rx;\n\tstruct bpf_map *xskmap_tx;\n\tint mtu;\n\tu16 total_steps;\n\tu16 current_step;\n\tu16 nb_sockets;\n\tbool fail;\n\tenum test_mode mode;\n\tchar name[MAX_TEST_NAME_SIZE];\n};\n\npthread_barrier_t barr;\npthread_mutex_t pacing_mutex = PTHREAD_MUTEX_INITIALIZER;\n\nint pkts_in_flight;\n\n#endif\t\t\t\t \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}