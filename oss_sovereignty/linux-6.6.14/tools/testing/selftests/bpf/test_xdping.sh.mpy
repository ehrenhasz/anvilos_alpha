{
  "module_name": "test_xdping.sh",
  "hash_id": "e493ed8edaa1bdcce79ccae69f878e3e250d314c54adc7d06039fd7bfa1926c8",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/bpf/test_xdping.sh",
  "human_readable_source": "#!/bin/bash\n# SPDX-License-Identifier: GPL-2.0\n\n# xdping tests\n#   Here we setup and teardown configuration required to run\n#   xdping, exercising its options.\n#\n#   Setup is similar to test_tunnel tests but without the tunnel.\n#\n# Topology:\n# ---------\n#     root namespace   |     tc_ns0 namespace\n#                      |\n#      ----------      |     ----------\n#      |  veth1  | --------- |  veth0  |\n#      ----------    peer    ----------\n#\n# Device Configuration\n# --------------------\n# Root namespace with BPF\n# Device names and addresses:\n#\tveth1 IP: 10.1.1.200\n#\txdp added to veth1, xdpings originate from here.\n#\n# Namespace tc_ns0 with BPF\n# Device names and addresses:\n#       veth0 IPv4: 10.1.1.100\n#\tFor some tests xdping run in server mode here.\n#\n\nreadonly TARGET_IP=\"10.1.1.100\"\nreadonly TARGET_NS=\"xdp_ns0\"\n\nreadonly LOCAL_IP=\"10.1.1.200\"\n\nsetup()\n{\n\tip netns add $TARGET_NS\n\tip link add veth0 type veth peer name veth1\n\tip link set veth0 netns $TARGET_NS\n\tip netns exec $TARGET_NS ip addr add ${TARGET_IP}/24 dev veth0\n\tip addr add ${LOCAL_IP}/24 dev veth1\n\tip netns exec $TARGET_NS ip link set veth0 up\n\tip link set veth1 up\n}\n\ncleanup()\n{\n\tset +e\n\tip netns delete $TARGET_NS 2>/dev/null\n\tip link del veth1 2>/dev/null\n\tif [[ $server_pid -ne 0 ]]; then\n\t\tkill -TERM $server_pid\n\tfi\n}\n\ntest()\n{\n\tclient_args=\"$1\"\n\tserver_args=\"$2\"\n\n\techo \"Test client args '$client_args'; server args '$server_args'\"\n\n\tserver_pid=0\n\tif [[ -n \"$server_args\" ]]; then\n\t\tip netns exec $TARGET_NS ./xdping $server_args &\n\t\tserver_pid=$!\n\t\tsleep 10\n\tfi\n\t./xdping $client_args $TARGET_IP\n\n\tif [[ $server_pid -ne 0 ]]; then\n\t\tkill -TERM $server_pid\n\t\tserver_pid=0\n\tfi\n\n\techo \"Test client args '$client_args'; server args '$server_args': PASS\"\n}\n\nset -e\n\nserver_pid=0\n\ntrap cleanup EXIT\n\nsetup\n\nfor server_args in \"\" \"-I veth0 -s -S\" ; do\n\t# client in skb mode\n\tclient_args=\"-I veth1 -S\"\n\ttest \"$client_args\" \"$server_args\"\n\n\t# client with count of 10 RTT measurements.\n\tclient_args=\"-I veth1 -S -c 10\"\n\ttest \"$client_args\" \"$server_args\"\ndone\n\n# Test drv mode\ntest \"-I veth1 -N\" \"-I veth0 -s -N\"\ntest \"-I veth1 -N -c 10\" \"-I veth0 -s -N\"\n\necho \"OK. All tests passed\"\nexit 0\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}