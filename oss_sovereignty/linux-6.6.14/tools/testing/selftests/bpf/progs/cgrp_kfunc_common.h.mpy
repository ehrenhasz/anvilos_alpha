{
  "module_name": "cgrp_kfunc_common.h",
  "hash_id": "6b4a63bb9959a7a0cdfad3ae72b21a4f88d24d64b64c05b5076f33322524bd4d",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/bpf/progs/cgrp_kfunc_common.h",
  "human_readable_source": " \n \n\n#ifndef _CGRP_KFUNC_COMMON_H\n#define _CGRP_KFUNC_COMMON_H\n\n#include <errno.h>\n#include <vmlinux.h>\n#include <bpf/bpf_helpers.h>\n#include <bpf/bpf_tracing.h>\n\nstruct __cgrps_kfunc_map_value {\n\tstruct cgroup __kptr * cgrp;\n};\n\nstruct hash_map {\n\t__uint(type, BPF_MAP_TYPE_HASH);\n\t__type(key, int);\n\t__type(value, struct __cgrps_kfunc_map_value);\n\t__uint(max_entries, 1);\n} __cgrps_kfunc_map SEC(\".maps\");\n\nstruct cgroup *bpf_cgroup_acquire(struct cgroup *p) __ksym;\nvoid bpf_cgroup_release(struct cgroup *p) __ksym;\nstruct cgroup *bpf_cgroup_ancestor(struct cgroup *cgrp, int level) __ksym;\nstruct cgroup *bpf_cgroup_from_id(u64 cgid) __ksym;\nvoid bpf_rcu_read_lock(void) __ksym;\nvoid bpf_rcu_read_unlock(void) __ksym;\n\nstatic inline struct __cgrps_kfunc_map_value *cgrps_kfunc_map_value_lookup(struct cgroup *cgrp)\n{\n\ts32 id;\n\tlong status;\n\n\tstatus = bpf_probe_read_kernel(&id, sizeof(id), &cgrp->self.id);\n\tif (status)\n\t\treturn NULL;\n\n\treturn bpf_map_lookup_elem(&__cgrps_kfunc_map, &id);\n}\n\nstatic inline int cgrps_kfunc_map_insert(struct cgroup *cgrp)\n{\n\tstruct __cgrps_kfunc_map_value local, *v;\n\tlong status;\n\tstruct cgroup *acquired, *old;\n\ts32 id;\n\n\tstatus = bpf_probe_read_kernel(&id, sizeof(id), &cgrp->self.id);\n\tif (status)\n\t\treturn status;\n\n\tlocal.cgrp = NULL;\n\tstatus = bpf_map_update_elem(&__cgrps_kfunc_map, &id, &local, BPF_NOEXIST);\n\tif (status)\n\t\treturn status;\n\n\tv = bpf_map_lookup_elem(&__cgrps_kfunc_map, &id);\n\tif (!v) {\n\t\tbpf_map_delete_elem(&__cgrps_kfunc_map, &id);\n\t\treturn -ENOENT;\n\t}\n\n\tacquired = bpf_cgroup_acquire(cgrp);\n\tif (!acquired) {\n\t\tbpf_map_delete_elem(&__cgrps_kfunc_map, &id);\n\t\treturn -ENOENT;\n\t}\n\n\told = bpf_kptr_xchg(&v->cgrp, acquired);\n\tif (old) {\n\t\tbpf_cgroup_release(old);\n\t\treturn -EEXIST;\n\t}\n\n\treturn 0;\n}\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}