{
  "module_name": "test_map_lookup_percpu_elem.c",
  "hash_id": "0c0e5677a128ae6a079c3a0edc4469f759b905369e71404192a949245de511ef",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/bpf/progs/test_map_lookup_percpu_elem.c",
  "human_readable_source": "\n \n\n#include \"vmlinux.h\"\n#include <bpf/bpf_helpers.h>\n\n__u64 percpu_array_elem_sum = 0;\n__u64 percpu_hash_elem_sum = 0;\n__u64 percpu_lru_hash_elem_sum = 0;\nconst volatile int nr_cpus;\nconst volatile int my_pid;\n\nstruct {\n\t__uint(type, BPF_MAP_TYPE_PERCPU_ARRAY);\n\t__uint(max_entries, 1);\n\t__type(key, __u32);\n\t__type(value, __u64);\n} percpu_array_map SEC(\".maps\");\n\nstruct {\n\t__uint(type, BPF_MAP_TYPE_PERCPU_HASH);\n\t__uint(max_entries, 1);\n\t__type(key, __u64);\n\t__type(value, __u64);\n} percpu_hash_map SEC(\".maps\");\n\nstruct {\n\t__uint(type, BPF_MAP_TYPE_LRU_PERCPU_HASH);\n\t__uint(max_entries, 1);\n\t__type(key, __u64);\n\t__type(value, __u64);\n} percpu_lru_hash_map SEC(\".maps\");\n\nstruct read_percpu_elem_ctx {\n\tvoid *map;\n\t__u64 sum;\n};\n\nstatic int read_percpu_elem_callback(__u32 index, struct read_percpu_elem_ctx *ctx)\n{\n\t__u64 key = 0;\n\t__u64 *value;\n\n\tvalue = bpf_map_lookup_percpu_elem(ctx->map, &key, index);\n\tif (value)\n\t\tctx->sum += *value;\n\treturn 0;\n}\n\nSEC(\"tp/syscalls/sys_enter_getuid\")\nint sysenter_getuid(const void *ctx)\n{\n\tstruct read_percpu_elem_ctx map_ctx;\n\n\tif (my_pid != (bpf_get_current_pid_tgid() >> 32))\n\t\treturn 0;\n\n\tmap_ctx.map = &percpu_array_map;\n\tmap_ctx.sum = 0;\n\tbpf_loop(nr_cpus, read_percpu_elem_callback, &map_ctx, 0);\n\tpercpu_array_elem_sum = map_ctx.sum;\n\n\tmap_ctx.map = &percpu_hash_map;\n\tmap_ctx.sum = 0;\n\tbpf_loop(nr_cpus, read_percpu_elem_callback, &map_ctx, 0);\n\tpercpu_hash_elem_sum = map_ctx.sum;\n\n\tmap_ctx.map = &percpu_lru_hash_map;\n\tmap_ctx.sum = 0;\n\tbpf_loop(nr_cpus, read_percpu_elem_callback, &map_ctx, 0);\n\tpercpu_lru_hash_elem_sum = map_ctx.sum;\n\n\treturn 0;\n}\n\nchar _license[] SEC(\"license\") = \"GPL\";\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}