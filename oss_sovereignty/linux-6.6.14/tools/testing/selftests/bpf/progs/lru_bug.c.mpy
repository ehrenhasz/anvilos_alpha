{
  "module_name": "lru_bug.c",
  "hash_id": "027c8ed7b18be7055959154ae1002a78e07df4609331a4f330d9bb9784350b8f",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/bpf/progs/lru_bug.c",
  "human_readable_source": "\n#include <vmlinux.h>\n#include <bpf/bpf_tracing.h>\n#include <bpf/bpf_helpers.h>\n\nstruct map_value {\n\tstruct task_struct __kptr_untrusted *ptr;\n};\n\nstruct {\n\t__uint(type, BPF_MAP_TYPE_LRU_HASH);\n\t__uint(max_entries, 1);\n\t__type(key, int);\n\t__type(value, struct map_value);\n} lru_map SEC(\".maps\");\n\nint pid = 0;\nint result = 1;\n\nSEC(\"fentry/bpf_ktime_get_ns\")\nint printk(void *ctx)\n{\n\tstruct map_value v = {};\n\n\tif (pid == bpf_get_current_task_btf()->pid)\n\t\tbpf_map_update_elem(&lru_map, &(int){0}, &v, 0);\n\treturn 0;\n}\n\nSEC(\"fentry/do_nanosleep\")\nint nanosleep(void *ctx)\n{\n\tstruct map_value val = {}, *v;\n\tstruct task_struct *current;\n\n\tbpf_map_update_elem(&lru_map, &(int){0}, &val, 0);\n\tv = bpf_map_lookup_elem(&lru_map, &(int){0});\n\tif (!v)\n\t\treturn 0;\n\tbpf_map_delete_elem(&lru_map, &(int){0});\n\tcurrent = bpf_get_current_task_btf();\n\tv->ptr = current;\n\tpid = current->pid;\n\tbpf_ktime_get_ns();\n\tresult = !v->ptr;\n\treturn 0;\n}\n\nchar _license[] SEC(\"license\") = \"GPL\";\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}