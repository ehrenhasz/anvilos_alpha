{
  "module_name": "verifier_subprog_precision.c",
  "hash_id": "ba7ca03d1b6f262a26e0155b91ef551e9553647ea571c7808eec8d958b5dc05f",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/bpf/progs/verifier_subprog_precision.c",
  "human_readable_source": "\n \n\n#include <errno.h>\n#include <string.h>\n#include <linux/bpf.h>\n#include <bpf/bpf_helpers.h>\n#include \"bpf_misc.h\"\n\n#define ARRAY_SIZE(x) (sizeof(x) / sizeof(x[0]))\n\nint vals[] SEC(\".data.vals\") = {1, 2, 3, 4};\n\n__naked __noinline __used\nstatic unsigned long identity_subprog()\n{\n\t \n\tasm volatile (\n\t\t\"r0 = r1;\"\n\t\t\"exit;\"\n\t);\n}\n\n__noinline __used\nunsigned long global_identity_subprog(__u64 x)\n{\n\t \n\treturn x;\n}\n\n__naked __noinline __used\nstatic unsigned long callback_subprog()\n{\n\t \n\tasm volatile (\n\t\t\"r0 = 0;\"\n\t\t\"exit;\"\n\t);\n}\n\nSEC(\"?raw_tp\")\n__success __log_level(2)\n__msg(\"7: (0f) r1 += r0\")\n__msg(\"mark_precise: frame0: regs=r0 stack= before 6: (bf) r1 = r7\")\n__msg(\"mark_precise: frame0: regs=r0 stack= before 5: (27) r0 *= 4\")\n__msg(\"mark_precise: frame0: regs=r0 stack= before 11: (95) exit\")\n__msg(\"mark_precise: frame1: regs=r0 stack= before 10: (bf) r0 = r1\")\n__msg(\"mark_precise: frame1: regs=r1 stack= before 4: (85) call pc+5\")\n__msg(\"mark_precise: frame0: regs=r1 stack= before 3: (bf) r1 = r6\")\n__msg(\"mark_precise: frame0: regs=r6 stack= before 2: (b7) r6 = 3\")\n__naked int subprog_result_precise(void)\n{\n\tasm volatile (\n\t\t\"r6 = 3;\"\n\t\t \n\t\t\"r1 = r6;\"\n\t\t\"call identity_subprog;\"\n\t\t \n\t\t\"r0 *= 4;\"\n\t\t\"r1 = %[vals];\"\n\t\t \n\t\t\"r1 += r0;\"\n\t\t\"r0 = *(u32 *)(r1 + 0);\"\n\t\t\"exit;\"\n\t\t:\n\t\t: __imm_ptr(vals)\n\t\t: __clobber_common, \"r6\"\n\t);\n}\n\nSEC(\"?raw_tp\")\n__success __log_level(2)\n__msg(\"9: (0f) r1 += r0\")\n__msg(\"mark_precise: frame0: last_idx 9 first_idx 0\")\n__msg(\"mark_precise: frame0: regs=r0 stack= before 8: (bf) r1 = r7\")\n__msg(\"mark_precise: frame0: regs=r0 stack= before 7: (27) r0 *= 4\")\n__msg(\"mark_precise: frame0: regs=r0 stack= before 5: (a5) if r0 < 0x4 goto pc+1\")\n__msg(\"mark_precise: frame0: regs=r0 stack= before 4: (85) call pc+7\")\n__naked int global_subprog_result_precise(void)\n{\n\tasm volatile (\n\t\t\"r6 = 3;\"\n\t\t \n\t\t\"r1 = r6;\"\n\t\t\"call global_identity_subprog;\"\n\t\t \n\t\t\"if r0 < %[vals_arr_sz] goto 1f;\"\n\t\t\"r0 = %[vals_arr_sz] - 1;\"\n\t\"1:\"\n\t\t\"r0 *= 4;\"\n\t\t\"r1 = %[vals];\"\n\t\t \n\t\t\"r1 += r0;\"\n\t\t\"r0 = *(u32 *)(r1 + 0);\"\n\t\t\"exit;\"\n\t\t:\n\t\t: __imm_ptr(vals),\n\t\t  __imm_const(vals_arr_sz, ARRAY_SIZE(vals))\n\t\t: __clobber_common, \"r6\"\n\t);\n}\n\nSEC(\"?raw_tp\")\n__success __log_level(2)\n__msg(\"14: (0f) r1 += r6\")\n__msg(\"mark_precise: frame0: last_idx 14 first_idx 10\")\n__msg(\"mark_precise: frame0: regs=r6 stack= before 13: (bf) r1 = r7\")\n__msg(\"mark_precise: frame0: regs=r6 stack= before 12: (27) r6 *= 4\")\n__msg(\"mark_precise: frame0: regs=r6 stack= before 11: (25) if r6 > 0x3 goto pc+4\")\n__msg(\"mark_precise: frame0: regs=r6 stack= before 10: (bf) r6 = r0\")\n__msg(\"mark_precise: frame0: parent state regs=r0 stack=:\")\n__msg(\"mark_precise: frame0: last_idx 18 first_idx 0\")\n__msg(\"mark_precise: frame0: regs=r0 stack= before 18: (95) exit\")\n__naked int callback_result_precise(void)\n{\n\tasm volatile (\n\t\t\"r6 = 3;\"\n\n\t\t \n\t\t\"r1 = r6;\"\t\t\t \n\t\t\"r2 = %[callback_subprog];\"\t \n\t\t\"r3 = 0;\"\t\t\t \n\t\t\"r4 = 0;\"\t\t\t \n\t\t\"call %[bpf_loop];\"\n\n\t\t\"r6 = r0;\"\n\t\t\"if r6 > 3 goto 1f;\"\n\t\t\"r6 *= 4;\"\n\t\t\"r1 = %[vals];\"\n\t\t \n\t\t\"r1 += r6;\"\n\t\t\"r0 = *(u32 *)(r1 + 0);\"\n\t\"1:\"\n\t\t\"exit;\"\n\t\t:\n\t\t: __imm_ptr(vals),\n\t\t  __imm_ptr(callback_subprog),\n\t\t  __imm(bpf_loop)\n\t\t: __clobber_common, \"r6\"\n\t);\n}\n\nSEC(\"?raw_tp\")\n__success __log_level(2)\n__msg(\"7: (0f) r1 += r6\")\n__msg(\"mark_precise: frame0: last_idx 7 first_idx 0\")\n__msg(\"mark_precise: frame0: regs=r6 stack= before 6: (bf) r1 = r7\")\n__msg(\"mark_precise: frame0: regs=r6 stack= before 5: (27) r6 *= 4\")\n__msg(\"mark_precise: frame0: regs=r6 stack= before 11: (95) exit\")\n__msg(\"mark_precise: frame1: regs= stack= before 10: (bf) r0 = r1\")\n__msg(\"mark_precise: frame1: regs= stack= before 4: (85) call pc+5\")\n__msg(\"mark_precise: frame0: regs=r6 stack= before 3: (b7) r1 = 0\")\n__msg(\"mark_precise: frame0: regs=r6 stack= before 2: (b7) r6 = 3\")\n__naked int parent_callee_saved_reg_precise(void)\n{\n\tasm volatile (\n\t\t\"r6 = 3;\"\n\n\t\t \n\t\t\"r1 = 0;\"\n\t\t\"call identity_subprog;\"\n\n\t\t\"r6 *= 4;\"\n\t\t\"r1 = %[vals];\"\n\t\t \n\t\t\"r1 += r6;\"\n\t\t\"r0 = *(u32 *)(r1 + 0);\"\n\t\t\"exit;\"\n\t\t:\n\t\t: __imm_ptr(vals)\n\t\t: __clobber_common, \"r6\"\n\t);\n}\n\nSEC(\"?raw_tp\")\n__success __log_level(2)\n__msg(\"7: (0f) r1 += r6\")\n__msg(\"mark_precise: frame0: last_idx 7 first_idx 0\")\n__msg(\"mark_precise: frame0: regs=r6 stack= before 6: (bf) r1 = r7\")\n__msg(\"mark_precise: frame0: regs=r6 stack= before 5: (27) r6 *= 4\")\n__msg(\"mark_precise: frame0: regs=r6 stack= before 4: (85) call pc+5\")\n__msg(\"mark_precise: frame0: regs=r6 stack= before 3: (b7) r1 = 0\")\n__msg(\"mark_precise: frame0: regs=r6 stack= before 2: (b7) r6 = 3\")\n__naked int parent_callee_saved_reg_precise_global(void)\n{\n\tasm volatile (\n\t\t\"r6 = 3;\"\n\n\t\t \n\t\t\"r1 = 0;\"\n\t\t\"call global_identity_subprog;\"\n\n\t\t\"r6 *= 4;\"\n\t\t\"r1 = %[vals];\"\n\t\t \n\t\t\"r1 += r6;\"\n\t\t\"r0 = *(u32 *)(r1 + 0);\"\n\t\t\"exit;\"\n\t\t:\n\t\t: __imm_ptr(vals)\n\t\t: __clobber_common, \"r6\"\n\t);\n}\n\nSEC(\"?raw_tp\")\n__success __log_level(2)\n__msg(\"12: (0f) r1 += r6\")\n__msg(\"mark_precise: frame0: last_idx 12 first_idx 10\")\n__msg(\"mark_precise: frame0: regs=r6 stack= before 11: (bf) r1 = r7\")\n__msg(\"mark_precise: frame0: regs=r6 stack= before 10: (27) r6 *= 4\")\n__msg(\"mark_precise: frame0: parent state regs=r6 stack=:\")\n__msg(\"mark_precise: frame0: last_idx 16 first_idx 0\")\n__msg(\"mark_precise: frame0: regs=r6 stack= before 16: (95) exit\")\n__msg(\"mark_precise: frame1: regs= stack= before 15: (b7) r0 = 0\")\n__msg(\"mark_precise: frame1: regs= stack= before 9: (85) call bpf_loop#181\")\n__msg(\"mark_precise: frame0: regs=r6 stack= before 8: (b7) r4 = 0\")\n__msg(\"mark_precise: frame0: regs=r6 stack= before 7: (b7) r3 = 0\")\n__msg(\"mark_precise: frame0: regs=r6 stack= before 6: (bf) r2 = r8\")\n__msg(\"mark_precise: frame0: regs=r6 stack= before 5: (b7) r1 = 1\")\n__msg(\"mark_precise: frame0: regs=r6 stack= before 4: (b7) r6 = 3\")\n__naked int parent_callee_saved_reg_precise_with_callback(void)\n{\n\tasm volatile (\n\t\t\"r6 = 3;\"\n\n\t\t \n\t\t\"r1 = 1;\"\t\t\t \n\t\t\"r2 = %[callback_subprog];\"\t \n\t\t\"r3 = 0;\"\t\t\t \n\t\t\"r4 = 0;\"\t\t\t \n\t\t\"call %[bpf_loop];\"\n\n\t\t\"r6 *= 4;\"\n\t\t\"r1 = %[vals];\"\n\t\t \n\t\t\"r1 += r6;\"\n\t\t\"r0 = *(u32 *)(r1 + 0);\"\n\t\t\"exit;\"\n\t\t:\n\t\t: __imm_ptr(vals),\n\t\t  __imm_ptr(callback_subprog),\n\t\t  __imm(bpf_loop)\n\t\t: __clobber_common, \"r6\"\n\t);\n}\n\nSEC(\"?raw_tp\")\n__success __log_level(2)\n__msg(\"9: (0f) r1 += r6\")\n__msg(\"mark_precise: frame0: last_idx 9 first_idx 6\")\n__msg(\"mark_precise: frame0: regs=r6 stack= before 8: (bf) r1 = r7\")\n__msg(\"mark_precise: frame0: regs=r6 stack= before 7: (27) r6 *= 4\")\n__msg(\"mark_precise: frame0: regs=r6 stack= before 6: (79) r6 = *(u64 *)(r10 -8)\")\n__msg(\"mark_precise: frame0: parent state regs= stack=-8:\")\n__msg(\"mark_precise: frame0: last_idx 13 first_idx 0\")\n__msg(\"mark_precise: frame0: regs= stack=-8 before 13: (95) exit\")\n__msg(\"mark_precise: frame1: regs= stack= before 12: (bf) r0 = r1\")\n__msg(\"mark_precise: frame1: regs= stack= before 5: (85) call pc+6\")\n__msg(\"mark_precise: frame0: regs= stack=-8 before 4: (b7) r1 = 0\")\n__msg(\"mark_precise: frame0: regs= stack=-8 before 3: (7b) *(u64 *)(r10 -8) = r6\")\n__msg(\"mark_precise: frame0: regs=r6 stack= before 2: (b7) r6 = 3\")\n__naked int parent_stack_slot_precise(void)\n{\n\tasm volatile (\n\t\t \n\t\t\"r6 = 3;\"\n\t\t\"*(u64 *)(r10 - 8) = r6;\"\n\n\t\t \n\t\t\"r1 = 0;\"\n\t\t\"call identity_subprog;\"\n\n\t\t \n\t\t\"r6 = *(u64 *)(r10 - 8);\"\n\n\t\t\"r6 *= 4;\"\n\t\t\"r1 = %[vals];\"\n\t\t \n\t\t\"r1 += r6;\"\n\t\t\"r0 = *(u32 *)(r1 + 0);\"\n\t\t\"exit;\"\n\t\t:\n\t\t: __imm_ptr(vals)\n\t\t: __clobber_common, \"r6\"\n\t);\n}\n\nSEC(\"?raw_tp\")\n__success __log_level(2)\n__msg(\"9: (0f) r1 += r6\")\n__msg(\"mark_precise: frame0: last_idx 9 first_idx 6\")\n__msg(\"mark_precise: frame0: regs=r6 stack= before 8: (bf) r1 = r7\")\n__msg(\"mark_precise: frame0: regs=r6 stack= before 7: (27) r6 *= 4\")\n__msg(\"mark_precise: frame0: regs=r6 stack= before 6: (79) r6 = *(u64 *)(r10 -8)\")\n__msg(\"mark_precise: frame0: parent state regs= stack=-8:\")\n__msg(\"mark_precise: frame0: last_idx 5 first_idx 0\")\n__msg(\"mark_precise: frame0: regs= stack=-8 before 5: (85) call pc+6\")\n__msg(\"mark_precise: frame0: regs= stack=-8 before 4: (b7) r1 = 0\")\n__msg(\"mark_precise: frame0: regs= stack=-8 before 3: (7b) *(u64 *)(r10 -8) = r6\")\n__msg(\"mark_precise: frame0: regs=r6 stack= before 2: (b7) r6 = 3\")\n__naked int parent_stack_slot_precise_global(void)\n{\n\tasm volatile (\n\t\t \n\t\t\"r6 = 3;\"\n\t\t\"*(u64 *)(r10 - 8) = r6;\"\n\n\t\t \n\t\t\"r1 = 0;\"\n\t\t\"call global_identity_subprog;\"\n\n\t\t \n\t\t\"r6 = *(u64 *)(r10 - 8);\"\n\n\t\t\"r6 *= 4;\"\n\t\t\"r1 = %[vals];\"\n\t\t \n\t\t\"r1 += r6;\"\n\t\t\"r0 = *(u32 *)(r1 + 0);\"\n\t\t\"exit;\"\n\t\t:\n\t\t: __imm_ptr(vals)\n\t\t: __clobber_common, \"r6\"\n\t);\n}\n\nSEC(\"?raw_tp\")\n__success __log_level(2)\n__msg(\"14: (0f) r1 += r6\")\n__msg(\"mark_precise: frame0: last_idx 14 first_idx 11\")\n__msg(\"mark_precise: frame0: regs=r6 stack= before 13: (bf) r1 = r7\")\n__msg(\"mark_precise: frame0: regs=r6 stack= before 12: (27) r6 *= 4\")\n__msg(\"mark_precise: frame0: regs=r6 stack= before 11: (79) r6 = *(u64 *)(r10 -8)\")\n__msg(\"mark_precise: frame0: parent state regs= stack=-8:\")\n__msg(\"mark_precise: frame0: last_idx 18 first_idx 0\")\n__msg(\"mark_precise: frame0: regs= stack=-8 before 18: (95) exit\")\n__msg(\"mark_precise: frame1: regs= stack= before 17: (b7) r0 = 0\")\n__msg(\"mark_precise: frame1: regs= stack= before 10: (85) call bpf_loop#181\")\n__msg(\"mark_precise: frame0: regs= stack=-8 before 9: (b7) r4 = 0\")\n__msg(\"mark_precise: frame0: regs= stack=-8 before 8: (b7) r3 = 0\")\n__msg(\"mark_precise: frame0: regs= stack=-8 before 7: (bf) r2 = r8\")\n__msg(\"mark_precise: frame0: regs= stack=-8 before 6: (bf) r1 = r6\")\n__msg(\"mark_precise: frame0: regs= stack=-8 before 5: (7b) *(u64 *)(r10 -8) = r6\")\n__msg(\"mark_precise: frame0: regs=r6 stack= before 4: (b7) r6 = 3\")\n__naked int parent_stack_slot_precise_with_callback(void)\n{\n\tasm volatile (\n\t\t \n\t\t\"r6 = 3;\"\n\t\t\"*(u64 *)(r10 - 8) = r6;\"\n\n\t\t \n\t\t\"r1 = r6;\"\t\t\t \n\t\t\"r2 = %[callback_subprog];\"\t \n\t\t\"r3 = 0;\"\t\t\t \n\t\t\"r4 = 0;\"\t\t\t \n\t\t\"call %[bpf_loop];\"\n\n\t\t \n\t\t\"r6 = *(u64 *)(r10 - 8);\"\n\n\t\t\"r6 *= 4;\"\n\t\t\"r1 = %[vals];\"\n\t\t \n\t\t\"r1 += r6;\"\n\t\t\"r0 = *(u32 *)(r1 + 0);\"\n\t\t\"exit;\"\n\t\t:\n\t\t: __imm_ptr(vals),\n\t\t  __imm_ptr(callback_subprog),\n\t\t  __imm(bpf_loop)\n\t\t: __clobber_common, \"r6\"\n\t);\n}\n\n__noinline __used\nstatic __u64 subprog_with_precise_arg(__u64 x)\n{\n\treturn vals[x];  \n}\n\nSEC(\"?raw_tp\")\n__success __log_level(2)\n__msg(\"8: (0f) r2 += r1\")\n__msg(\"mark_precise: frame1: last_idx 8 first_idx 0\")\n__msg(\"mark_precise: frame1: regs=r1 stack= before 6: (18) r2 = \")\n__msg(\"mark_precise: frame1: regs=r1 stack= before 5: (67) r1 <<= 2\")\n__msg(\"mark_precise: frame1: regs=r1 stack= before 2: (85) call pc+2\")\n__msg(\"mark_precise: frame0: regs=r1 stack= before 1: (bf) r1 = r6\")\n__msg(\"mark_precise: frame0: regs=r6 stack= before 0: (b7) r6 = 3\")\n__naked int subprog_arg_precise(void)\n{\n\tasm volatile (\n\t\t\"r6 = 3;\"\n\t\t\"r1 = r6;\"\n\t\t \n\t\t\"call subprog_with_precise_arg;\"\n\t\t\"r0 += r6;\"\n\t\t\"exit;\"\n\t\t:\n\t\t:\n\t\t: __clobber_common, \"r6\"\n\t);\n}\n\n \n__naked __noinline __used\nstatic __u64 subprog_spill_reg_precise(void)\n{\n\tasm volatile (\n\t\t \n\t\t\"*(u64 *)(r1 + 0) = r2;\"\n\t\t \n\t\t\"*(u64 *)(r10 - 16) = r2;\"\n\t\t \n\t\t\"r0 = *(u64 *)(r10 - 16);\"\n\t\t\"r2 = *(u64 *)(r1 + 0);\"\n\t\t\"r0 += r2;\"\n\t\t\"exit;\"\n\t);\n}\n\nSEC(\"?raw_tp\")\n__success __log_level(2)\n \n__msg(\"mark_precise: frame0: falling back to forcing all scalars precise\")\n__naked int subprog_spill_into_parent_stack_slot_precise(void)\n{\n\tasm volatile (\n\t\t\"r6 = 1;\"\n\n\t\t \n\t\t\"r1 = r10;\"\n\t\t\"r1 += -8;\"\n\t\t\"r2 = r6;\"\n\t\t\"call subprog_spill_reg_precise;\"\n\n\t\t \n\t\t\"r7 = *(u64 *)(r10 - 8);\"\n\n\t\t\"r7 *= 4;\"\n\t\t\"r1 = %[vals];\"\n\t\t \n\t\t\"r1 += r7;\"\n\t\t\"r0 = *(u32 *)(r1 + 0);\"\n\t\t\"exit;\"\n\t\t:\n\t\t: __imm_ptr(vals)\n\t\t: __clobber_common, \"r6\", \"r7\"\n\t);\n}\n\n__naked __noinline __used\nstatic __u64 subprog_with_checkpoint(void)\n{\n\tasm volatile (\n\t\t\"r0 = 0;\"\n\t\t \n\t\t\"goto +0;\"\n\t\t\"exit;\"\n\t);\n}\n\nchar _license[] SEC(\"license\") = \"GPL\";\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}