{
  "module_name": "verifier_map_in_map.c",
  "hash_id": "7080e8e637227d13add48e0ebb7f5851b0f7e6e5da23feca626fcbf5e320709d",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/bpf/progs/verifier_map_in_map.c",
  "human_readable_source": "\n \n\n#include <linux/bpf.h>\n#include <bpf/bpf_helpers.h>\n#include \"bpf_misc.h\"\n\nstruct {\n\t__uint(type, BPF_MAP_TYPE_ARRAY_OF_MAPS);\n\t__uint(max_entries, 1);\n\t__type(key, int);\n\t__type(value, int);\n\t__array(values, struct {\n\t\t__uint(type, BPF_MAP_TYPE_ARRAY);\n\t\t__uint(max_entries, 1);\n\t\t__type(key, int);\n\t\t__type(value, int);\n\t});\n} map_in_map SEC(\".maps\");\n\nSEC(\"socket\")\n__description(\"map in map access\")\n__success __success_unpriv __retval(0)\n__naked void map_in_map_access(void)\n{\n\tasm volatile (\"\t\t\t\t\t\\\n\tr1 = 0;\t\t\t\t\t\t\\\n\t*(u32*)(r10 - 4) = r1;\t\t\t\t\\\n\tr2 = r10;\t\t\t\t\t\\\n\tr2 += -4;\t\t\t\t\t\\\n\tr1 = %[map_in_map] ll;\t\t\t\t\\\n\tcall %[bpf_map_lookup_elem];\t\t\t\\\n\tif r0 == 0 goto l0_%=;\t\t\t\t\\\n\tr1 = 0;\t\t\t\t\t\t\\\n\t*(u32*)(r10 - 4) = r1;\t\t\t\t\\\n\tr2 = r10;\t\t\t\t\t\\\n\tr2 += -4;\t\t\t\t\t\\\n\tr1 = r0;\t\t\t\t\t\\\n\tcall %[bpf_map_lookup_elem];\t\t\t\\\nl0_%=:\tr0 = 0;\t\t\t\t\t\t\\\n\texit;\t\t\t\t\t\t\\\n\"\t:\n\t: __imm(bpf_map_lookup_elem),\n\t  __imm_addr(map_in_map)\n\t: __clobber_all);\n}\n\nSEC(\"xdp\")\n__description(\"map in map state pruning\")\n__success __msg(\"processed 26 insns\")\n__log_level(2) __retval(0) __flag(BPF_F_TEST_STATE_FREQ)\n__naked void map_in_map_state_pruning(void)\n{\n\tasm volatile (\"\t\t\t\t\t\\\n\tr1 = 0;\t\t\t\t\t\t\\\n\t*(u32*)(r10 - 4) = r1;\t\t\t\t\\\n\tr6 = r10;\t\t\t\t\t\\\n\tr6 += -4;\t\t\t\t\t\\\n\tr2 = r6;\t\t\t\t\t\\\n\tr1 = %[map_in_map] ll;\t\t\t\t\\\n\tcall %[bpf_map_lookup_elem];\t\t\t\\\n\tif r0 != 0 goto l0_%=;\t\t\t\t\\\n\texit;\t\t\t\t\t\t\\\nl0_%=:\tr2 = r6;\t\t\t\t\t\\\n\tr1 = r0;\t\t\t\t\t\\\n\tcall %[bpf_map_lookup_elem];\t\t\t\\\n\tif r0 != 0 goto l1_%=;\t\t\t\t\\\n\tr2 = r6;\t\t\t\t\t\\\n\tr1 = %[map_in_map] ll;\t\t\t\t\\\n\tcall %[bpf_map_lookup_elem];\t\t\t\\\n\tif r0 != 0 goto l2_%=;\t\t\t\t\\\n\texit;\t\t\t\t\t\t\\\nl2_%=:\tr2 = r6;\t\t\t\t\t\\\n\tr1 = r0;\t\t\t\t\t\\\n\tcall %[bpf_map_lookup_elem];\t\t\t\\\n\tif r0 != 0 goto l1_%=;\t\t\t\t\\\n\texit;\t\t\t\t\t\t\\\nl1_%=:\tr0 = *(u32*)(r0 + 0);\t\t\t\t\\\n\texit;\t\t\t\t\t\t\\\n\"\t:\n\t: __imm(bpf_map_lookup_elem),\n\t  __imm_addr(map_in_map)\n\t: __clobber_all);\n}\n\nSEC(\"socket\")\n__description(\"invalid inner map pointer\")\n__failure __msg(\"R1 pointer arithmetic on map_ptr prohibited\")\n__failure_unpriv\n__naked void invalid_inner_map_pointer(void)\n{\n\tasm volatile (\"\t\t\t\t\t\\\n\tr1 = 0;\t\t\t\t\t\t\\\n\t*(u32*)(r10 - 4) = r1;\t\t\t\t\\\n\tr2 = r10;\t\t\t\t\t\\\n\tr2 += -4;\t\t\t\t\t\\\n\tr1 = %[map_in_map] ll;\t\t\t\t\\\n\tcall %[bpf_map_lookup_elem];\t\t\t\\\n\tif r0 == 0 goto l0_%=;\t\t\t\t\\\n\tr1 = 0;\t\t\t\t\t\t\\\n\t*(u32*)(r10 - 4) = r1;\t\t\t\t\\\n\tr2 = r10;\t\t\t\t\t\\\n\tr2 += -4;\t\t\t\t\t\\\n\tr1 = r0;\t\t\t\t\t\\\n\tr1 += 8;\t\t\t\t\t\\\n\tcall %[bpf_map_lookup_elem];\t\t\t\\\nl0_%=:\tr0 = 0;\t\t\t\t\t\t\\\n\texit;\t\t\t\t\t\t\\\n\"\t:\n\t: __imm(bpf_map_lookup_elem),\n\t  __imm_addr(map_in_map)\n\t: __clobber_all);\n}\n\nSEC(\"socket\")\n__description(\"forgot null checking on the inner map pointer\")\n__failure __msg(\"R1 type=map_value_or_null expected=map_ptr\")\n__failure_unpriv\n__naked void on_the_inner_map_pointer(void)\n{\n\tasm volatile (\"\t\t\t\t\t\\\n\tr1 = 0;\t\t\t\t\t\t\\\n\t*(u32*)(r10 - 4) = r1;\t\t\t\t\\\n\tr2 = r10;\t\t\t\t\t\\\n\tr2 += -4;\t\t\t\t\t\\\n\tr1 = %[map_in_map] ll;\t\t\t\t\\\n\tcall %[bpf_map_lookup_elem];\t\t\t\\\n\tr1 = 0;\t\t\t\t\t\t\\\n\t*(u32*)(r10 - 4) = r1;\t\t\t\t\\\n\tr2 = r10;\t\t\t\t\t\\\n\tr2 += -4;\t\t\t\t\t\\\n\tr1 = r0;\t\t\t\t\t\\\n\tcall %[bpf_map_lookup_elem];\t\t\t\\\n\tr0 = 0;\t\t\t\t\t\t\\\n\texit;\t\t\t\t\t\t\\\n\"\t:\n\t: __imm(bpf_map_lookup_elem),\n\t  __imm_addr(map_in_map)\n\t: __clobber_all);\n}\n\nchar _license[] SEC(\"license\") = \"GPL\";\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}