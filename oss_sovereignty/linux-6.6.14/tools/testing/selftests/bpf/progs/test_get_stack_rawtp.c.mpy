{
  "module_name": "test_get_stack_rawtp.c",
  "hash_id": "a3ac6641470c630fe6a05876589e15f7dd43e66bd0e9debb394d6880ae37a9fb",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/bpf/progs/test_get_stack_rawtp.c",
  "human_readable_source": "\n\n#include <linux/bpf.h>\n#include <bpf/bpf_helpers.h>\n\n \n#define MAX_STACK_RAWTP 100\nstruct stack_trace_t {\n\tint pid;\n\tint kern_stack_size;\n\tint user_stack_size;\n\tint user_stack_buildid_size;\n\t__u64 kern_stack[MAX_STACK_RAWTP];\n\t__u64 user_stack[MAX_STACK_RAWTP];\n\tstruct bpf_stack_build_id user_stack_buildid[MAX_STACK_RAWTP];\n};\n\nstruct {\n\t__uint(type, BPF_MAP_TYPE_PERF_EVENT_ARRAY);\n\t__uint(max_entries, 2);\n\t__uint(key_size, sizeof(int));\n\t__uint(value_size, sizeof(__u32));\n} perfmap SEC(\".maps\");\n\nstruct {\n\t__uint(type, BPF_MAP_TYPE_PERCPU_ARRAY);\n\t__uint(max_entries, 1);\n\t__type(key, __u32);\n\t__type(value, struct stack_trace_t);\n} stackdata_map SEC(\".maps\");\n\n \nstruct {\n\t__uint(type, BPF_MAP_TYPE_PERCPU_ARRAY);\n\t__uint(max_entries, 1);\n\t__type(key, __u32);\n\t__type(value, __u64[2 * MAX_STACK_RAWTP]);\n} rawdata_map SEC(\".maps\");\n\nSEC(\"raw_tracepoint/sys_enter\")\nint bpf_prog1(void *ctx)\n{\n\tint max_len, max_buildid_len, total_size;\n\tstruct stack_trace_t *data;\n\tlong usize, ksize;\n\tvoid *raw_data;\n\t__u32 key = 0;\n\n\tdata = bpf_map_lookup_elem(&stackdata_map, &key);\n\tif (!data)\n\t\treturn 0;\n\n\tmax_len = MAX_STACK_RAWTP * sizeof(__u64);\n\tmax_buildid_len = MAX_STACK_RAWTP * sizeof(struct bpf_stack_build_id);\n\tdata->pid = bpf_get_current_pid_tgid();\n\tdata->kern_stack_size = bpf_get_stack(ctx, data->kern_stack,\n\t\t\t\t\t      max_len, 0);\n\tdata->user_stack_size = bpf_get_stack(ctx, data->user_stack, max_len,\n\t\t\t\t\t    BPF_F_USER_STACK);\n\tdata->user_stack_buildid_size = bpf_get_stack(\n\t\tctx, data->user_stack_buildid, max_buildid_len,\n\t\tBPF_F_USER_STACK | BPF_F_USER_BUILD_ID);\n\tbpf_perf_event_output(ctx, &perfmap, 0, data, sizeof(*data));\n\n\t \n\traw_data = bpf_map_lookup_elem(&rawdata_map, &key);\n\tif (!raw_data)\n\t\treturn 0;\n\n\tusize = bpf_get_stack(ctx, raw_data, max_len, BPF_F_USER_STACK);\n\tif (usize < 0)\n\t\treturn 0;\n\n\tksize = bpf_get_stack(ctx, raw_data + usize, max_len - usize, 0);\n\tif (ksize < 0)\n\t\treturn 0;\n\n\ttotal_size = usize + ksize;\n\tif (total_size > 0 && total_size <= max_len)\n\t\tbpf_perf_event_output(ctx, &perfmap, 0, raw_data, total_size);\n\n\treturn 0;\n}\n\nchar _license[] SEC(\"license\") = \"GPL\";\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}