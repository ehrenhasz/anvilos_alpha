{
  "module_name": "test_ringbuf_map_key.c",
  "hash_id": "e908ede1149cc00dd758882597128054d349c68cecbcd602635858a87b94e93a",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/bpf/progs/test_ringbuf_map_key.c",
  "human_readable_source": "\n \n\n#include <linux/bpf.h>\n#include <bpf/bpf_helpers.h>\n#include \"bpf_misc.h\"\n\nchar _license[] SEC(\"license\") = \"GPL\";\n\nstruct sample {\n\tint pid;\n\tint seq;\n\tlong value;\n\tchar comm[16];\n};\n\nstruct {\n\t__uint(type, BPF_MAP_TYPE_RINGBUF);\n} ringbuf SEC(\".maps\");\n\nstruct {\n\t__uint(type, BPF_MAP_TYPE_HASH);\n\t__uint(max_entries, 1000);\n\t__type(key, struct sample);\n\t__type(value, int);\n} hash_map SEC(\".maps\");\n\n \nint pid = 0;\n\n \nlong seq = 0;\n\nSEC(\"fentry/\" SYS_PREFIX \"sys_getpgid\")\nint test_ringbuf_mem_map_key(void *ctx)\n{\n\tint cur_pid = bpf_get_current_pid_tgid() >> 32;\n\tstruct sample *sample, sample_copy;\n\tint *lookup_val;\n\n\tif (cur_pid != pid)\n\t\treturn 0;\n\n\tsample = bpf_ringbuf_reserve(&ringbuf, sizeof(*sample), 0);\n\tif (!sample)\n\t\treturn 0;\n\n\tsample->pid = pid;\n\tbpf_get_current_comm(sample->comm, sizeof(sample->comm));\n\tsample->seq = ++seq;\n\tsample->value = 42;\n\n\t \n\tlookup_val = (int *)bpf_map_lookup_elem(&hash_map, sample);\n\t__sink(lookup_val);\n\n\t \n\t__builtin_memcpy(&sample_copy, sample, sizeof(struct sample));\n\tbpf_map_update_elem(&hash_map, &sample_copy, &sample->seq, BPF_ANY);\n\n\tbpf_ringbuf_submit(sample, 0);\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}