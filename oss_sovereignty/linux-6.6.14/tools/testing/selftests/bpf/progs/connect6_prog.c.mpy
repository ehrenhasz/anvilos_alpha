{
  "module_name": "connect6_prog.c",
  "hash_id": "96aa103d14cb6eaa11dc5a541223517d00c27c362831ee3386e33b72add65390",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/bpf/progs/connect6_prog.c",
  "human_readable_source": "\n\n\n#include <string.h>\n\n#include <linux/stddef.h>\n#include <linux/bpf.h>\n#include <linux/in.h>\n#include <linux/in6.h>\n#include <sys/socket.h>\n\n#include <bpf/bpf_helpers.h>\n#include <bpf/bpf_endian.h>\n\n#define SRC_REWRITE_IP6_0\t0\n#define SRC_REWRITE_IP6_1\t0\n#define SRC_REWRITE_IP6_2\t0\n#define SRC_REWRITE_IP6_3\t6\n\n#define DST_REWRITE_IP6_0\t0\n#define DST_REWRITE_IP6_1\t0\n#define DST_REWRITE_IP6_2\t0\n#define DST_REWRITE_IP6_3\t1\n\n#define DST_REWRITE_PORT6\t6666\n\nSEC(\"cgroup/connect6\")\nint connect_v6_prog(struct bpf_sock_addr *ctx)\n{\n\tstruct bpf_sock_tuple tuple = {};\n\tstruct sockaddr_in6 sa;\n\tstruct bpf_sock *sk;\n\n\t \n\tmemset(&tuple.ipv6.saddr, 0, sizeof(tuple.ipv6.saddr));\n\tmemset(&tuple.ipv6.sport, 0, sizeof(tuple.ipv6.sport));\n\n\ttuple.ipv6.daddr[0] = bpf_htonl(DST_REWRITE_IP6_0);\n\ttuple.ipv6.daddr[1] = bpf_htonl(DST_REWRITE_IP6_1);\n\ttuple.ipv6.daddr[2] = bpf_htonl(DST_REWRITE_IP6_2);\n\ttuple.ipv6.daddr[3] = bpf_htonl(DST_REWRITE_IP6_3);\n\n\ttuple.ipv6.dport = bpf_htons(DST_REWRITE_PORT6);\n\n\tif (ctx->type != SOCK_STREAM && ctx->type != SOCK_DGRAM)\n\t\treturn 0;\n\telse if (ctx->type == SOCK_STREAM)\n\t\tsk = bpf_sk_lookup_tcp(ctx, &tuple, sizeof(tuple.ipv6),\n\t\t\t\t       BPF_F_CURRENT_NETNS, 0);\n\telse\n\t\tsk = bpf_sk_lookup_udp(ctx, &tuple, sizeof(tuple.ipv6),\n\t\t\t\t       BPF_F_CURRENT_NETNS, 0);\n\n\tif (!sk)\n\t\treturn 0;\n\n\tif (sk->src_ip6[0] != tuple.ipv6.daddr[0] ||\n\t    sk->src_ip6[1] != tuple.ipv6.daddr[1] ||\n\t    sk->src_ip6[2] != tuple.ipv6.daddr[2] ||\n\t    sk->src_ip6[3] != tuple.ipv6.daddr[3] ||\n\t    sk->src_port != DST_REWRITE_PORT6) {\n\t\tbpf_sk_release(sk);\n\t\treturn 0;\n\t}\n\n\tbpf_sk_release(sk);\n\n\t \n\tctx->user_ip6[0] = bpf_htonl(DST_REWRITE_IP6_0);\n\tctx->user_ip6[1] = bpf_htonl(DST_REWRITE_IP6_1);\n\tctx->user_ip6[2] = bpf_htonl(DST_REWRITE_IP6_2);\n\tctx->user_ip6[3] = bpf_htonl(DST_REWRITE_IP6_3);\n\n\tctx->user_port = bpf_htons(DST_REWRITE_PORT6);\n\n\t \n\tmemset(&sa, 0, sizeof(sa));\n\n\tsa.sin6_family = AF_INET6;\n\tsa.sin6_port = bpf_htons(0);\n\n\tsa.sin6_addr.s6_addr32[0] = bpf_htonl(SRC_REWRITE_IP6_0);\n\tsa.sin6_addr.s6_addr32[1] = bpf_htonl(SRC_REWRITE_IP6_1);\n\tsa.sin6_addr.s6_addr32[2] = bpf_htonl(SRC_REWRITE_IP6_2);\n\tsa.sin6_addr.s6_addr32[3] = bpf_htonl(SRC_REWRITE_IP6_3);\n\n\tif (bpf_bind(ctx, (struct sockaddr *)&sa, sizeof(sa)) != 0)\n\t\treturn 0;\n\n\treturn 1;\n}\n\nchar _license[] SEC(\"license\") = \"GPL\";\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}