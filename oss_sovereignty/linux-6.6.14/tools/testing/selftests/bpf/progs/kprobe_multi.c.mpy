{
  "module_name": "kprobe_multi.c",
  "hash_id": "2bbb37ce697fa42efcc7b412dfb4dfea8c19119652abba00a9d2ff4e39141f10",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/bpf/progs/kprobe_multi.c",
  "human_readable_source": "\n#include <linux/bpf.h>\n#include <bpf/bpf_helpers.h>\n#include <bpf/bpf_tracing.h>\n#include <stdbool.h>\n\nchar _license[] SEC(\"license\") = \"GPL\";\n\nextern const void bpf_fentry_test1 __ksym;\nextern const void bpf_fentry_test2 __ksym;\nextern const void bpf_fentry_test3 __ksym;\nextern const void bpf_fentry_test4 __ksym;\nextern const void bpf_fentry_test5 __ksym;\nextern const void bpf_fentry_test6 __ksym;\nextern const void bpf_fentry_test7 __ksym;\nextern const void bpf_fentry_test8 __ksym;\n\nint pid = 0;\nbool test_cookie = false;\n\n__u64 kprobe_test1_result = 0;\n__u64 kprobe_test2_result = 0;\n__u64 kprobe_test3_result = 0;\n__u64 kprobe_test4_result = 0;\n__u64 kprobe_test5_result = 0;\n__u64 kprobe_test6_result = 0;\n__u64 kprobe_test7_result = 0;\n__u64 kprobe_test8_result = 0;\n\n__u64 kretprobe_test1_result = 0;\n__u64 kretprobe_test2_result = 0;\n__u64 kretprobe_test3_result = 0;\n__u64 kretprobe_test4_result = 0;\n__u64 kretprobe_test5_result = 0;\n__u64 kretprobe_test6_result = 0;\n__u64 kretprobe_test7_result = 0;\n__u64 kretprobe_test8_result = 0;\n\nstatic void kprobe_multi_check(void *ctx, bool is_return)\n{\n\tif (bpf_get_current_pid_tgid() >> 32 != pid)\n\t\treturn;\n\n\t__u64 cookie = test_cookie ? bpf_get_attach_cookie(ctx) : 0;\n\t__u64 addr = bpf_get_func_ip(ctx);\n\n#define SET(__var, __addr, __cookie) ({\t\t\t\\\n\tif (((const void *) addr == __addr) &&\t\t\\\n\t     (!test_cookie || (cookie == __cookie)))\t\\\n\t\t__var = 1;\t\t\t\t\\\n})\n\n\tif (is_return) {\n\t\tSET(kretprobe_test1_result, &bpf_fentry_test1, 8);\n\t\tSET(kretprobe_test2_result, &bpf_fentry_test2, 2);\n\t\tSET(kretprobe_test3_result, &bpf_fentry_test3, 7);\n\t\tSET(kretprobe_test4_result, &bpf_fentry_test4, 6);\n\t\tSET(kretprobe_test5_result, &bpf_fentry_test5, 5);\n\t\tSET(kretprobe_test6_result, &bpf_fentry_test6, 4);\n\t\tSET(kretprobe_test7_result, &bpf_fentry_test7, 3);\n\t\tSET(kretprobe_test8_result, &bpf_fentry_test8, 1);\n\t} else {\n\t\tSET(kprobe_test1_result, &bpf_fentry_test1, 1);\n\t\tSET(kprobe_test2_result, &bpf_fentry_test2, 7);\n\t\tSET(kprobe_test3_result, &bpf_fentry_test3, 2);\n\t\tSET(kprobe_test4_result, &bpf_fentry_test4, 3);\n\t\tSET(kprobe_test5_result, &bpf_fentry_test5, 4);\n\t\tSET(kprobe_test6_result, &bpf_fentry_test6, 5);\n\t\tSET(kprobe_test7_result, &bpf_fentry_test7, 6);\n\t\tSET(kprobe_test8_result, &bpf_fentry_test8, 8);\n\t}\n\n#undef SET\n}\n\n \nSEC(\"fentry/bpf_modify_return_test\")\nint BPF_PROG(trigger)\n{\n\treturn 0;\n}\n\nSEC(\"kprobe.multi/bpf_fentry_tes??\")\nint test_kprobe(struct pt_regs *ctx)\n{\n\tkprobe_multi_check(ctx, false);\n\treturn 0;\n}\n\nSEC(\"kretprobe.multi/bpf_fentry_test*\")\nint test_kretprobe(struct pt_regs *ctx)\n{\n\tkprobe_multi_check(ctx, true);\n\treturn 0;\n}\n\nSEC(\"kprobe.multi\")\nint test_kprobe_manual(struct pt_regs *ctx)\n{\n\tkprobe_multi_check(ctx, false);\n\treturn 0;\n}\n\nSEC(\"kretprobe.multi\")\nint test_kretprobe_manual(struct pt_regs *ctx)\n{\n\tkprobe_multi_check(ctx, true);\n\treturn 0;\n}\n\nextern const void bpf_testmod_fentry_test1 __ksym;\nextern const void bpf_testmod_fentry_test2 __ksym;\nextern const void bpf_testmod_fentry_test3 __ksym;\n\n__u64 kprobe_testmod_test1_result = 0;\n__u64 kprobe_testmod_test2_result = 0;\n__u64 kprobe_testmod_test3_result = 0;\n\n__u64 kretprobe_testmod_test1_result = 0;\n__u64 kretprobe_testmod_test2_result = 0;\n__u64 kretprobe_testmod_test3_result = 0;\n\nstatic void kprobe_multi_testmod_check(void *ctx, bool is_return)\n{\n\tif (bpf_get_current_pid_tgid() >> 32 != pid)\n\t\treturn;\n\n\t__u64 addr = bpf_get_func_ip(ctx);\n\n\tif (is_return) {\n\t\tif ((const void *) addr == &bpf_testmod_fentry_test1)\n\t\t\tkretprobe_testmod_test1_result = 1;\n\t\tif ((const void *) addr == &bpf_testmod_fentry_test2)\n\t\t\tkretprobe_testmod_test2_result = 1;\n\t\tif ((const void *) addr == &bpf_testmod_fentry_test3)\n\t\t\tkretprobe_testmod_test3_result = 1;\n\t} else {\n\t\tif ((const void *) addr == &bpf_testmod_fentry_test1)\n\t\t\tkprobe_testmod_test1_result = 1;\n\t\tif ((const void *) addr == &bpf_testmod_fentry_test2)\n\t\t\tkprobe_testmod_test2_result = 1;\n\t\tif ((const void *) addr == &bpf_testmod_fentry_test3)\n\t\t\tkprobe_testmod_test3_result = 1;\n\t}\n}\n\nSEC(\"kprobe.multi\")\nint test_kprobe_testmod(struct pt_regs *ctx)\n{\n\tkprobe_multi_testmod_check(ctx, false);\n\treturn 0;\n}\n\nSEC(\"kretprobe.multi\")\nint test_kretprobe_testmod(struct pt_regs *ctx)\n{\n\tkprobe_multi_testmod_check(ctx, true);\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}