{
  "module_name": "test_core_reloc_kernel.c",
  "hash_id": "24426759786768e50a476cf19d2a57a5109de648fd9ff115ba20463733244135",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/bpf/progs/test_core_reloc_kernel.c",
  "human_readable_source": "\n\n\n#include <linux/bpf.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <bpf/bpf_helpers.h>\n#include <bpf/bpf_core_read.h>\n\nchar _license[] SEC(\"license\") = \"GPL\";\n\nstruct {\n\tchar in[256];\n\tchar out[256];\n\tbool skip;\n\tuint64_t my_pid_tgid;\n} data = {};\n\nstruct core_reloc_kernel_output {\n\tint valid[10];\n\t \n\tchar comm[sizeof(\"test_progs\")];\n\tint comm_len;\n\tbool local_task_struct_matches;\n};\n\nstruct task_struct {\n\tint pid;\n\tint tgid;\n\tchar comm[16];\n\tstruct task_struct *group_leader;\n};\n\nstruct mm_struct___wrong {\n    int abc_whatever_should_not_exist;\n};\n\nstruct task_struct___local {\n    int pid;\n    struct mm_struct___wrong *mm;\n};\n\n#define CORE_READ(dst, src) bpf_core_read(dst, sizeof(*(dst)), src)\n\nSEC(\"raw_tracepoint/sys_enter\")\nint test_core_kernel(void *ctx)\n{\n\t \n#if __has_builtin(__builtin_preserve_type_info) && __clang_major__ >= 15\n\tstruct task_struct *task = (void *)bpf_get_current_task();\n\tstruct core_reloc_kernel_output *out = (void *)&data.out;\n\tuint64_t pid_tgid = bpf_get_current_pid_tgid();\n\tuint32_t real_tgid = (uint32_t)pid_tgid;\n\tint pid, tgid;\n\n\tif (data.my_pid_tgid != pid_tgid)\n\t\treturn 0;\n\n\tif (CORE_READ(&pid, &task->pid) ||\n\t    CORE_READ(&tgid, &task->tgid))\n\t\treturn 1;\n\n\t \n\tout->valid[0] = (((uint64_t)pid << 32) | tgid) == pid_tgid;\n\n\t \n\tout->valid[1] = BPF_CORE_READ(task,\n\t\t\t\t      tgid) == real_tgid;\n\tout->valid[2] = BPF_CORE_READ(task,\n\t\t\t\t      group_leader,\n\t\t\t\t      tgid) == real_tgid;\n\tout->valid[3] = BPF_CORE_READ(task,\n\t\t\t\t      group_leader, group_leader,\n\t\t\t\t      tgid) == real_tgid;\n\tout->valid[4] = BPF_CORE_READ(task,\n\t\t\t\t      group_leader, group_leader, group_leader,\n\t\t\t\t      tgid) == real_tgid;\n\tout->valid[5] = BPF_CORE_READ(task,\n\t\t\t\t      group_leader, group_leader, group_leader,\n\t\t\t\t      group_leader,\n\t\t\t\t      tgid) == real_tgid;\n\tout->valid[6] = BPF_CORE_READ(task,\n\t\t\t\t      group_leader, group_leader, group_leader,\n\t\t\t\t      group_leader, group_leader,\n\t\t\t\t      tgid) == real_tgid;\n\tout->valid[7] = BPF_CORE_READ(task,\n\t\t\t\t      group_leader, group_leader, group_leader,\n\t\t\t\t      group_leader, group_leader, group_leader,\n\t\t\t\t      tgid) == real_tgid;\n\tout->valid[8] = BPF_CORE_READ(task,\n\t\t\t\t      group_leader, group_leader, group_leader,\n\t\t\t\t      group_leader, group_leader, group_leader,\n\t\t\t\t      group_leader,\n\t\t\t\t      tgid) == real_tgid;\n\tout->valid[9] = BPF_CORE_READ(task,\n\t\t\t\t      group_leader, group_leader, group_leader,\n\t\t\t\t      group_leader, group_leader, group_leader,\n\t\t\t\t      group_leader, group_leader,\n\t\t\t\t      tgid) == real_tgid;\n\n\t \n\tout->comm_len = BPF_CORE_READ_STR_INTO(\n\t\t&out->comm, task,\n\t\tgroup_leader, group_leader, group_leader, group_leader,\n\t\tgroup_leader, group_leader, group_leader, group_leader,\n\t\tcomm);\n\n\tout->local_task_struct_matches = bpf_core_type_matches(struct task_struct___local);\n#else\n\tdata.skip = true;\n#endif\n\treturn 0;\n}\n\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}