{
  "module_name": "test_tcpnotify_kern.c",
  "hash_id": "4cdb1944702f82a80c0b48b999b71f944f39916acf92cb9ce2b90524be4a8dec",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/bpf/progs/test_tcpnotify_kern.c",
  "human_readable_source": "\n#include <stddef.h>\n#include <string.h>\n#include <netinet/in.h>\n#include <linux/bpf.h>\n#include <linux/if_ether.h>\n#include <linux/if_packet.h>\n#include <linux/ip.h>\n#include <linux/ipv6.h>\n#include <linux/types.h>\n#include <linux/socket.h>\n#include <linux/tcp.h>\n#include <bpf/bpf_helpers.h>\n#include <bpf/bpf_endian.h>\n#include \"test_tcpnotify.h\"\n\nstruct {\n\t__uint(type, BPF_MAP_TYPE_ARRAY);\n\t__uint(max_entries, 4);\n\t__type(key, __u32);\n\t__type(value, struct tcpnotify_globals);\n} global_map SEC(\".maps\");\n\nstruct {\n\t__uint(type, BPF_MAP_TYPE_PERF_EVENT_ARRAY);\n\t__uint(max_entries, 2);\n\t__type(key, int);\n\t__type(value, __u32);\n} perf_event_map SEC(\".maps\");\n\nSEC(\"sockops\")\nint bpf_testcb(struct bpf_sock_ops *skops)\n{\n\tint rv = -1;\n\tint op;\n\n\top = (int) skops->op;\n\n\tif (bpf_ntohl(skops->remote_port) != TESTPORT) {\n\t\tskops->reply = -1;\n\t\treturn 0;\n\t}\n\n\tswitch (op) {\n\tcase BPF_SOCK_OPS_TIMEOUT_INIT:\n\tcase BPF_SOCK_OPS_RWND_INIT:\n\tcase BPF_SOCK_OPS_NEEDS_ECN:\n\tcase BPF_SOCK_OPS_BASE_RTT:\n\tcase BPF_SOCK_OPS_RTO_CB:\n\t\trv = 1;\n\t\tbreak;\n\n\tcase BPF_SOCK_OPS_TCP_CONNECT_CB:\n\tcase BPF_SOCK_OPS_TCP_LISTEN_CB:\n\tcase BPF_SOCK_OPS_ACTIVE_ESTABLISHED_CB:\n\tcase BPF_SOCK_OPS_PASSIVE_ESTABLISHED_CB:\n\t\tbpf_sock_ops_cb_flags_set(skops, (BPF_SOCK_OPS_RETRANS_CB_FLAG|\n\t\t\t\t\t  BPF_SOCK_OPS_RTO_CB_FLAG));\n\t\trv = 1;\n\t\tbreak;\n\tcase BPF_SOCK_OPS_RETRANS_CB: {\n\t\t\t__u32 key = 0;\n\t\t\tstruct tcpnotify_globals g, *gp;\n\t\t\tstruct tcp_notifier msg = {\n\t\t\t\t.type = 0xde,\n\t\t\t\t.subtype = 0xad,\n\t\t\t\t.source = 0xbe,\n\t\t\t\t.hash = 0xef,\n\t\t\t};\n\n\t\t\trv = 1;\n\n\t\t\t \n\t\t\tgp = bpf_map_lookup_elem(&global_map, &key);\n\t\t\tif (!gp)\n\t\t\t\tbreak;\n\t\t\tg = *gp;\n\t\t\tg.total_retrans = skops->total_retrans;\n\t\t\tg.ncalls++;\n\t\t\tbpf_map_update_elem(&global_map, &key, &g,\n\t\t\t\t\t    BPF_ANY);\n\t\t\tbpf_perf_event_output(skops, &perf_event_map,\n\t\t\t\t\t      BPF_F_CURRENT_CPU,\n\t\t\t\t\t      &msg, sizeof(msg));\n\t\t}\n\t\tbreak;\n\tdefault:\n\t\trv = -1;\n\t}\n\tskops->reply = rv;\n\treturn 1;\n}\nchar _license[] SEC(\"license\") = \"GPL\";\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}