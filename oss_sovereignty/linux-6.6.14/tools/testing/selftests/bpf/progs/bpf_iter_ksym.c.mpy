{
  "module_name": "bpf_iter_ksym.c",
  "hash_id": "4cae66dbfc0e4de1355a46f60950420522396ebb197197950a30325c7d00ac2c",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/bpf/progs/bpf_iter_ksym.c",
  "human_readable_source": "\n \n#include \"bpf_iter.h\"\n#include <bpf/bpf_helpers.h>\n\nchar _license[] SEC(\"license\") = \"GPL\";\n\nunsigned long last_sym_value = 0;\n\nstatic inline char to_lower(char c)\n{\n\tif (c >= 'A' && c <= 'Z')\n\t\tc += ('a' - 'A');\n\treturn c;\n}\n\nstatic inline char to_upper(char c)\n{\n\tif (c >= 'a' && c <= 'z')\n\t\tc -= ('a' - 'A');\n\treturn c;\n}\n\n \nSEC(\"iter/ksym\")\nint dump_ksym(struct bpf_iter__ksym *ctx)\n{\n\tstruct seq_file *seq = ctx->meta->seq;\n\tstruct kallsym_iter *iter = ctx->ksym;\n\t__u32 seq_num = ctx->meta->seq_num;\n\tunsigned long value;\n\tchar type;\n\n\tif (!iter)\n\t\treturn 0;\n\n\tif (seq_num == 0) {\n\t\tBPF_SEQ_PRINTF(seq, \"ADDR TYPE NAME MODULE_NAME KIND MAX_SIZE\\n\");\n\t\treturn 0;\n\t}\n\tif (last_sym_value)\n\t\tBPF_SEQ_PRINTF(seq, \"0x%x\\n\", iter->value - last_sym_value);\n\telse\n\t\tBPF_SEQ_PRINTF(seq, \"\\n\");\n\n\tvalue = iter->show_value ? iter->value : 0;\n\n\tlast_sym_value = value;\n\n\ttype = iter->type;\n\n\tif (iter->module_name[0]) {\n\t\ttype = iter->exported ? to_upper(type) : to_lower(type);\n\t\tBPF_SEQ_PRINTF(seq, \"0x%llx %c %s [ %s ] \",\n\t\t\t       value, type, iter->name, iter->module_name);\n\t} else {\n\t\tBPF_SEQ_PRINTF(seq, \"0x%llx %c %s \", value, type, iter->name);\n\t}\n\tif (!iter->pos_mod_end || iter->pos_mod_end > iter->pos)\n\t\tBPF_SEQ_PRINTF(seq, \"MOD \");\n\telse if (!iter->pos_ftrace_mod_end || iter->pos_ftrace_mod_end > iter->pos)\n\t\tBPF_SEQ_PRINTF(seq, \"FTRACE_MOD \");\n\telse if (!iter->pos_bpf_end || iter->pos_bpf_end > iter->pos)\n\t\tBPF_SEQ_PRINTF(seq, \"BPF \");\n\telse\n\t\tBPF_SEQ_PRINTF(seq, \"KPROBE \");\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}