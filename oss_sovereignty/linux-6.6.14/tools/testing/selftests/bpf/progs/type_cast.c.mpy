{
  "module_name": "type_cast.c",
  "hash_id": "4d030917b50bf0fee5454957c06854baf60c8c4fa077e39624d241f509baeb82",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/bpf/progs/type_cast.c",
  "human_readable_source": "\n \n#include \"vmlinux.h\"\n#include <bpf/bpf_helpers.h>\n#include <bpf/bpf_tracing.h>\n#include <bpf/bpf_core_read.h>\n\nstruct {\n\t__uint(type, BPF_MAP_TYPE_TASK_STORAGE);\n\t__uint(map_flags, BPF_F_NO_PREALLOC);\n\t__type(key, int);\n\t__type(value, long);\n} enter_id SEC(\".maps\");\n\n#define\tIFNAMSIZ 16\n\nint ifindex, ingress_ifindex;\nchar name[IFNAMSIZ];\nunsigned int inum;\nunsigned int meta_len, frag0_len, kskb_len, kskb2_len;\n\nvoid *bpf_cast_to_kern_ctx(void *) __ksym;\nvoid *bpf_rdonly_cast(void *, __u32) __ksym;\n\nSEC(\"?xdp\")\nint md_xdp(struct xdp_md *ctx)\n{\n\tstruct xdp_buff *kctx = bpf_cast_to_kern_ctx(ctx);\n\tstruct net_device *dev;\n\n\tdev = kctx->rxq->dev;\n\tifindex = dev->ifindex;\n\tinum = dev->nd_net.net->ns.inum;\n\t__builtin_memcpy(name, dev->name, IFNAMSIZ);\n\tingress_ifindex = ctx->ingress_ifindex;\n\treturn XDP_PASS;\n}\n\nSEC(\"?tc\")\nint md_skb(struct __sk_buff *skb)\n{\n\tstruct sk_buff *kskb = bpf_cast_to_kern_ctx(skb);\n\tstruct skb_shared_info *shared_info;\n\tstruct sk_buff *kskb2;\n\n\tkskb_len = kskb->len;\n\n\t \n\tshared_info = bpf_rdonly_cast(kskb->head + kskb->end,\n\t\tbpf_core_type_id_kernel(struct skb_shared_info));\n\tmeta_len = shared_info->meta_len;\n\tfrag0_len = shared_info->frag_list->len;\n\n\t \n\tkskb2 = bpf_rdonly_cast(kskb, bpf_core_type_id_kernel(struct sk_buff));\n\tkskb2_len = kskb2->len;\n\treturn 0;\n}\n\nSEC(\"?tp_btf/sys_enter\")\nint BPF_PROG(untrusted_ptr, struct pt_regs *regs, long id)\n{\n\tstruct task_struct *task, *task_dup;\n\n\ttask = bpf_get_current_task_btf();\n\ttask_dup = bpf_rdonly_cast(task, bpf_core_type_id_kernel(struct task_struct));\n\t(void)bpf_task_storage_get(&enter_id, task_dup, 0, 0);\n\treturn 0;\n}\n\nSEC(\"?tracepoint/syscalls/sys_enter_nanosleep\")\nint kctx_u64(void *ctx)\n{\n\tu64 *kctx = bpf_rdonly_cast(ctx, bpf_core_type_id_kernel(u64));\n\n\t(void)kctx;\n\treturn 0;\n}\n\nchar _license[] SEC(\"license\") = \"GPL\";\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}