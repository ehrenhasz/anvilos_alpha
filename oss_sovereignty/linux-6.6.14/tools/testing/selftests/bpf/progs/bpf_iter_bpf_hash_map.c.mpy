{
  "module_name": "bpf_iter_bpf_hash_map.c",
  "hash_id": "bed1571dae6dd40bcba37fe8107c637ef608f4101062a6cbf820faf4d2743cca",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/bpf/progs/bpf_iter_bpf_hash_map.c",
  "human_readable_source": "\n \n#include \"bpf_iter.h\"\n#include <bpf/bpf_helpers.h>\n\nchar _license[] SEC(\"license\") = \"GPL\";\n\nstruct key_t {\n\tint a;\n\tint b;\n\tint c;\n};\n\nstruct {\n\t__uint(type, BPF_MAP_TYPE_HASH);\n\t__uint(max_entries, 3);\n\t__type(key, struct key_t);\n\t__type(value, __u64);\n} hashmap1 SEC(\".maps\");\n\nstruct {\n\t__uint(type, BPF_MAP_TYPE_HASH);\n\t__uint(max_entries, 3);\n\t__type(key, __u64);\n\t__type(value, __u64);\n} hashmap2 SEC(\".maps\");\n\nstruct {\n\t__uint(type, BPF_MAP_TYPE_HASH);\n\t__uint(max_entries, 3);\n\t__type(key, struct key_t);\n\t__type(value, __u32);\n} hashmap3 SEC(\".maps\");\n\n \nbool in_test_mode = 0;\n\n \n__u32 key_sum_a = 0, key_sum_b = 0, key_sum_c = 0;\n__u64 val_sum = 0;\n\nSEC(\"iter/bpf_map_elem\")\nint dump_bpf_hash_map(struct bpf_iter__bpf_map_elem *ctx)\n{\n\tstruct seq_file *seq = ctx->meta->seq;\n\t__u32 seq_num = ctx->meta->seq_num;\n\tstruct bpf_map *map = ctx->map;\n\tstruct key_t *key = ctx->key;\n\tstruct key_t tmp_key;\n\t__u64 *val = ctx->value;\n\t__u64 tmp_val = 0;\n\tint ret;\n\n\tif (in_test_mode) {\n\t\t \n\t\tif (key == (void *)0 || val == (void *)0)\n\t\t\treturn 0;\n\n\t\t \n\t\t__builtin_memcpy(&tmp_key, key, sizeof(struct key_t));\n\t\tret = bpf_map_update_elem(&hashmap1, &tmp_key, &tmp_val, 0);\n\t\tif (ret)\n\t\t\treturn 0;\n\t\tret = bpf_map_delete_elem(&hashmap1, &tmp_key);\n\t\tif (ret)\n\t\t\treturn 0;\n\n\t\tkey_sum_a += key->a;\n\t\tkey_sum_b += key->b;\n\t\tkey_sum_c += key->c;\n\t\tval_sum += *val;\n\t\treturn 0;\n\t}\n\n\t \n\tif (seq_num == 0)\n\t\tBPF_SEQ_PRINTF(seq, \"map dump starts\\n\");\n\n\tif (key == (void *)0 || val == (void *)0) {\n\t\tBPF_SEQ_PRINTF(seq, \"map dump ends\\n\");\n\t\treturn 0;\n\t}\n\n\tBPF_SEQ_PRINTF(seq, \"%d: (%x %d %x) (%llx)\\n\", map->id,\n\t\t       key->a, key->b, key->c, *val);\n\n\treturn 0;\n}\n\nSEC(\"iter.s/bpf_map_elem\")\nint sleepable_dummy_dump(struct bpf_iter__bpf_map_elem *ctx)\n{\n\tif (ctx->meta->seq_num == 0)\n\t\tBPF_SEQ_PRINTF(ctx->meta->seq, \"map dump starts\\n\");\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}