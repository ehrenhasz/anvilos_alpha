{
  "module_name": "bpf_iter_task_vma.c",
  "hash_id": "26ca65d01ea84e1cef1341b2586818e5cf7b42d1acbc0bca4693e2f3bfc4a241",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/bpf/progs/bpf_iter_task_vma.c",
  "human_readable_source": "\n \n#include \"bpf_iter.h\"\n#include <bpf/bpf_helpers.h>\n\nchar _license[] SEC(\"license\") = \"GPL\";\n\n \n#define VM_READ\t\t0x00000001\n#define VM_WRITE\t0x00000002\n#define VM_EXEC\t\t0x00000004\n#define VM_MAYSHARE\t0x00000080\n\n \n#define MINORBITS\t20\n#define MINORMASK\t((1U << MINORBITS) - 1)\n#define MAJOR(dev)\t((unsigned int) ((dev) >> MINORBITS))\n#define MINOR(dev)\t((unsigned int) ((dev) & MINORMASK))\n\n#define D_PATH_BUF_SIZE 1024\nchar d_path_buf[D_PATH_BUF_SIZE] = {};\n__u32 pid = 0;\n__u32 one_task = 0;\n__u32 one_task_error = 0;\n\nSEC(\"iter/task_vma\") int proc_maps(struct bpf_iter__task_vma *ctx)\n{\n\tstruct vm_area_struct *vma = ctx->vma;\n\tstruct seq_file *seq = ctx->meta->seq;\n\tstruct task_struct *task = ctx->task;\n\tstruct file *file;\n\tchar perm_str[] = \"----\";\n\n\tif (task == (void *)0 || vma == (void *)0)\n\t\treturn 0;\n\n\tfile = vma->vm_file;\n\tif (task->tgid != pid) {\n\t\tif (one_task)\n\t\t\tone_task_error = 1;\n\t\treturn 0;\n\t}\n\tperm_str[0] = (vma->vm_flags & VM_READ) ? 'r' : '-';\n\tperm_str[1] = (vma->vm_flags & VM_WRITE) ? 'w' : '-';\n\tperm_str[2] = (vma->vm_flags & VM_EXEC) ? 'x' : '-';\n\tperm_str[3] = (vma->vm_flags & VM_MAYSHARE) ? 's' : 'p';\n\tBPF_SEQ_PRINTF(seq, \"%08llx-%08llx %s \", vma->vm_start, vma->vm_end, perm_str);\n\n\tif (file) {\n\t\t__u32 dev = file->f_inode->i_sb->s_dev;\n\n\t\tbpf_d_path(&file->f_path, d_path_buf, D_PATH_BUF_SIZE);\n\n\t\tBPF_SEQ_PRINTF(seq, \"%08llx \", vma->vm_pgoff << 12);\n\t\tBPF_SEQ_PRINTF(seq, \"%02x:%02x %u\", MAJOR(dev), MINOR(dev),\n\t\t\t       file->f_inode->i_ino);\n\t\tBPF_SEQ_PRINTF(seq, \"\\t%s\\n\", d_path_buf);\n\t} else {\n\t\tBPF_SEQ_PRINTF(seq, \"%08llx 00:00 0\\n\", 0ULL);\n\t}\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}