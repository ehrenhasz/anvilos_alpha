{
  "module_name": "kfunc_call_fail.c",
  "hash_id": "84fa5e152380eb08edcfe45fa6282d4660a0938d39932c73d7c9921131f8d122",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/bpf/progs/kfunc_call_fail.c",
  "human_readable_source": "\n \n#include <vmlinux.h>\n#include <bpf/bpf_helpers.h>\n#include \"../bpf_testmod/bpf_testmod_kfunc.h\"\n\nstruct syscall_test_args {\n\t__u8 data[16];\n\tsize_t size;\n};\n\nSEC(\"?syscall\")\nint kfunc_syscall_test_fail(struct syscall_test_args *args)\n{\n\tbpf_kfunc_call_test_mem_len_pass1(&args->data, sizeof(*args) + 1);\n\n\treturn 0;\n}\n\nSEC(\"?syscall\")\nint kfunc_syscall_test_null_fail(struct syscall_test_args *args)\n{\n\t \n\n\tbpf_kfunc_call_test_mem_len_pass1(args, sizeof(*args));\n\n\treturn 0;\n}\n\nSEC(\"?tc\")\nint kfunc_call_test_get_mem_fail_rdonly(struct __sk_buff *skb)\n{\n\tstruct prog_test_ref_kfunc *pt;\n\tunsigned long s = 0;\n\tint *p = NULL;\n\tint ret = 0;\n\n\tpt = bpf_kfunc_call_test_acquire(&s);\n\tif (pt) {\n\t\tp = bpf_kfunc_call_test_get_rdonly_mem(pt, 2 * sizeof(int));\n\t\tif (p)\n\t\t\tp[0] = 42;  \n\t\telse\n\t\t\tret = -1;\n\n\t\tbpf_kfunc_call_test_release(pt);\n\t}\n\treturn ret;\n}\n\nSEC(\"?tc\")\nint kfunc_call_test_get_mem_fail_use_after_free(struct __sk_buff *skb)\n{\n\tstruct prog_test_ref_kfunc *pt;\n\tunsigned long s = 0;\n\tint *p = NULL;\n\tint ret = 0;\n\n\tpt = bpf_kfunc_call_test_acquire(&s);\n\tif (pt) {\n\t\tp = bpf_kfunc_call_test_get_rdwr_mem(pt, 2 * sizeof(int));\n\t\tif (p) {\n\t\t\tp[0] = 42;\n\t\t\tret = p[1];  \n\t\t} else {\n\t\t\tret = -1;\n\t\t}\n\n\t\tbpf_kfunc_call_test_release(pt);\n\t}\n\tif (p)\n\t\tret = p[0];  \n\n\treturn ret;\n}\n\nSEC(\"?tc\")\nint kfunc_call_test_get_mem_fail_oob(struct __sk_buff *skb)\n{\n\tstruct prog_test_ref_kfunc *pt;\n\tunsigned long s = 0;\n\tint *p = NULL;\n\tint ret = 0;\n\n\tpt = bpf_kfunc_call_test_acquire(&s);\n\tif (pt) {\n\t\tp = bpf_kfunc_call_test_get_rdonly_mem(pt, 2 * sizeof(int));\n\t\tif (p)\n\t\t\tret = p[2 * sizeof(int)];  \n\t\telse\n\t\t\tret = -1;\n\n\t\tbpf_kfunc_call_test_release(pt);\n\t}\n\treturn ret;\n}\n\nint not_const_size = 2 * sizeof(int);\n\nSEC(\"?tc\")\nint kfunc_call_test_get_mem_fail_not_const(struct __sk_buff *skb)\n{\n\tstruct prog_test_ref_kfunc *pt;\n\tunsigned long s = 0;\n\tint *p = NULL;\n\tint ret = 0;\n\n\tpt = bpf_kfunc_call_test_acquire(&s);\n\tif (pt) {\n\t\tp = bpf_kfunc_call_test_get_rdonly_mem(pt, not_const_size);  \n\t\tif (p)\n\t\t\tret = p[0];\n\t\telse\n\t\t\tret = -1;\n\n\t\tbpf_kfunc_call_test_release(pt);\n\t}\n\treturn ret;\n}\n\nSEC(\"?tc\")\nint kfunc_call_test_mem_acquire_fail(struct __sk_buff *skb)\n{\n\tstruct prog_test_ref_kfunc *pt;\n\tunsigned long s = 0;\n\tint *p = NULL;\n\tint ret = 0;\n\n\tpt = bpf_kfunc_call_test_acquire(&s);\n\tif (pt) {\n\t\t \n\t\tp = bpf_kfunc_call_test_acq_rdonly_mem(pt, 2 * sizeof(int));\n\t\tif (p)\n\t\t\tret = p[0];\n\t\telse\n\t\t\tret = -1;\n\n\t\tbpf_kfunc_call_int_mem_release(p);\n\n\t\tbpf_kfunc_call_test_release(pt);\n\t}\n\treturn ret;\n}\n\nchar _license[] SEC(\"license\") = \"GPL\";\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}