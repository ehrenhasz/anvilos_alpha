{
  "module_name": "bpf_iter_task.c",
  "hash_id": "df66904ddbcdca3fc79cb2e889a90e7c46c51031e5c95d9f173ad24af26e2ed6",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/bpf/progs/bpf_iter_task.c",
  "human_readable_source": "\n \n#include \"bpf_iter.h\"\n#include <bpf/bpf_helpers.h>\n#include <bpf/bpf_tracing.h>\n\nchar _license[] SEC(\"license\") = \"GPL\";\n\nuint32_t tid = 0;\nint num_unknown_tid = 0;\nint num_known_tid = 0;\n\nSEC(\"iter/task\")\nint dump_task(struct bpf_iter__task *ctx)\n{\n\tstruct seq_file *seq = ctx->meta->seq;\n\tstruct task_struct *task = ctx->task;\n\tstatic char info[] = \"    === END ===\";\n\n\tif (task == (void *)0) {\n\t\tBPF_SEQ_PRINTF(seq, \"%s\\n\", info);\n\t\treturn 0;\n\t}\n\n\tif (task->pid != tid)\n\t\tnum_unknown_tid++;\n\telse\n\t\tnum_known_tid++;\n\n\tif (ctx->meta->seq_num == 0)\n\t\tBPF_SEQ_PRINTF(seq, \"    tgid      gid\\n\");\n\n\tBPF_SEQ_PRINTF(seq, \"%8d %8d\\n\", task->tgid, task->pid);\n\treturn 0;\n}\n\nint num_expected_failure_copy_from_user_task = 0;\nint num_success_copy_from_user_task = 0;\n\nSEC(\"iter.s/task\")\nint dump_task_sleepable(struct bpf_iter__task *ctx)\n{\n\tstruct seq_file *seq = ctx->meta->seq;\n\tstruct task_struct *task = ctx->task;\n\tstatic const char info[] = \"    === END ===\";\n\tstruct pt_regs *regs;\n\tvoid *ptr;\n\tuint32_t user_data = 0;\n\tint ret;\n\n\tif (task == (void *)0) {\n\t\tBPF_SEQ_PRINTF(seq, \"%s\\n\", info);\n\t\treturn 0;\n\t}\n\n\t \n\tptr = NULL;\n\tret = bpf_copy_from_user_task(&user_data, sizeof(uint32_t), ptr, task, 0);\n\tif (ret) {\n\t\t++num_expected_failure_copy_from_user_task;\n\t} else {\n\t\tBPF_SEQ_PRINTF(seq, \"%s\\n\", info);\n\t\treturn 0;\n\t}\n\n\t \n\tregs = (struct pt_regs *)bpf_task_pt_regs(task);\n\tif (regs == (void *)0) {\n\t\tBPF_SEQ_PRINTF(seq, \"%s\\n\", info);\n\t\treturn 0;\n\t}\n\tptr = (void *)PT_REGS_IP(regs);\n\n\tret = bpf_copy_from_user_task(&user_data, sizeof(uint32_t), ptr, task, 0);\n\tif (ret) {\n\t\tBPF_SEQ_PRINTF(seq, \"%s\\n\", info);\n\t\treturn 0;\n\t}\n\t++num_success_copy_from_user_task;\n\n\tif (ctx->meta->seq_num == 0)\n\t\tBPF_SEQ_PRINTF(seq, \"    tgid      gid     data\\n\");\n\n\tBPF_SEQ_PRINTF(seq, \"%8d %8d %8d\\n\", task->tgid, task->pid, user_data);\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}