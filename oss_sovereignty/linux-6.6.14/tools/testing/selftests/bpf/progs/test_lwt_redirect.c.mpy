{
  "module_name": "test_lwt_redirect.c",
  "hash_id": "37382b71f40178c073c2f3566e913fe9fceba6560f30b90337f0a2f6ee6b5587",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/bpf/progs/test_lwt_redirect.c",
  "human_readable_source": "\n#include <linux/bpf.h>\n#include <bpf/bpf_endian.h>\n#include <bpf/bpf_helpers.h>\n#include <linux/ip.h>\n#include \"bpf_tracing_net.h\"\n\n \nstatic int prepend_dummy_mac(struct __sk_buff *skb)\n{\n\tchar mac[] = {0x1, 0x2, 0x3, 0x4, 0x5, 0x6, 0xf,\n\t\t      0xe, 0xd, 0xc, 0xb, 0xa, 0x08, 0x00};\n\n\tif (bpf_skb_change_head(skb, ETH_HLEN, 0))\n\t\treturn -1;\n\n\tif (bpf_skb_store_bytes(skb, 0, mac, sizeof(mac), 0))\n\t\treturn -1;\n\n\treturn 0;\n}\n\n \nstatic int get_redirect_target(struct __sk_buff *skb)\n{\n\tstruct iphdr *iph = NULL;\n\tvoid *start = (void *)(long)skb->data;\n\tvoid *end = (void *)(long)skb->data_end;\n\n\tif (start + sizeof(*iph) > end)\n\t\treturn -1;\n\n\tiph = (struct iphdr *)start;\n\treturn bpf_ntohl(iph->daddr) & 0xff;\n}\n\nSEC(\"redir_ingress\")\nint test_lwt_redirect_in(struct __sk_buff *skb)\n{\n\tint target = get_redirect_target(skb);\n\n\tif (target < 0)\n\t\treturn BPF_OK;\n\n\tif (prepend_dummy_mac(skb))\n\t\treturn BPF_DROP;\n\n\treturn bpf_redirect(target, BPF_F_INGRESS);\n}\n\nSEC(\"redir_egress\")\nint test_lwt_redirect_out(struct __sk_buff *skb)\n{\n\tint target = get_redirect_target(skb);\n\n\tif (target < 0)\n\t\treturn BPF_OK;\n\n\tif (prepend_dummy_mac(skb))\n\t\treturn BPF_DROP;\n\n\treturn bpf_redirect(target, 0);\n}\n\nSEC(\"redir_egress_nomac\")\nint test_lwt_redirect_out_nomac(struct __sk_buff *skb)\n{\n\tint target = get_redirect_target(skb);\n\n\tif (target < 0)\n\t\treturn BPF_OK;\n\n\treturn bpf_redirect(target, 0);\n}\n\nSEC(\"redir_ingress_nomac\")\nint test_lwt_redirect_in_nomac(struct __sk_buff *skb)\n{\n\tint target = get_redirect_target(skb);\n\n\tif (target < 0)\n\t\treturn BPF_OK;\n\n\treturn bpf_redirect(target, BPF_F_INGRESS);\n}\n\nchar _license[] SEC(\"license\") = \"GPL\";\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}