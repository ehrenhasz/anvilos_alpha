{
  "module_name": "bpf_iter_udp4.c",
  "hash_id": "4db929d12f111b6ca26cf3ffe3525efcea056b4b30f16aaf32bf284a8e2228fa",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/bpf/progs/bpf_iter_udp4.c",
  "human_readable_source": "\n \n#include \"bpf_iter.h\"\n#include \"bpf_tracing_net.h\"\n#include <bpf/bpf_helpers.h>\n#include <bpf/bpf_endian.h>\n\nchar _license[] SEC(\"license\") = \"GPL\";\n\nstatic long sock_i_ino(const struct sock *sk)\n{\n\tconst struct socket *sk_socket = sk->sk_socket;\n\tconst struct inode *inode;\n\tunsigned long ino;\n\n\tif (!sk_socket)\n\t\treturn 0;\n\n\tinode = &container_of(sk_socket, struct socket_alloc, socket)->vfs_inode;\n\tbpf_probe_read_kernel(&ino, sizeof(ino), &inode->i_ino);\n\treturn ino;\n}\n\nSEC(\"iter/udp\")\nint dump_udp4(struct bpf_iter__udp *ctx)\n{\n\tstruct seq_file *seq = ctx->meta->seq;\n\tstruct udp_sock *udp_sk = ctx->udp_sk;\n\tstruct inet_sock *inet;\n\t__u16 srcp, destp;\n\t__be32 dest, src;\n\t__u32 seq_num;\n\tint rqueue;\n\n\tif (udp_sk == (void *)0)\n\t\treturn 0;\n\n\tseq_num = ctx->meta->seq_num;\n\tif (seq_num == 0)\n\t\tBPF_SEQ_PRINTF(seq,\n\t\t\t       \"  sl  local_address rem_address   st tx_queue \"\n\t\t\t       \"rx_queue tr tm->when retrnsmt   uid  timeout \"\n\t\t\t       \"inode ref pointer drops\\n\");\n\n\t \n\tinet = &udp_sk->inet;\n\tif (inet->sk.sk_family == AF_INET6)\n\t\treturn 0;\n\n\tinet = &udp_sk->inet;\n\tdest = inet->inet_daddr;\n\tsrc = inet->inet_rcv_saddr;\n\tsrcp = bpf_ntohs(inet->inet_sport);\n\tdestp = bpf_ntohs(inet->inet_dport);\n\trqueue = inet->sk.sk_rmem_alloc.counter - udp_sk->forward_deficit;\n\n\tBPF_SEQ_PRINTF(seq, \"%5d: %08X:%04X %08X:%04X \",\n\t\t       ctx->bucket, src, srcp, dest, destp);\n\n\tBPF_SEQ_PRINTF(seq, \"%02X %08X:%08X %02X:%08lX %08X %5u %8d %lu %d %pK %u\\n\",\n\t\t       inet->sk.sk_state,\n\t\t       inet->sk.sk_wmem_alloc.refs.counter - 1,\n\t\t       rqueue,\n\t\t       0, 0L, 0, ctx->uid, 0,\n\t\t       sock_i_ino(&inet->sk),\n\t\t       inet->sk.sk_refcnt.refs.counter, udp_sk,\n\t\t       inet->sk.sk_drops.counter);\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}