{
  "module_name": "verifier_ctx.c",
  "hash_id": "1640551b3afface852990b0f700028fe0c2d1e5d2a3fbdf621566af0c5bd94b6",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/bpf/progs/verifier_ctx.c",
  "human_readable_source": "\n \n\n#include <linux/bpf.h>\n#include <bpf/bpf_helpers.h>\n#include \"bpf_misc.h\"\n\nSEC(\"tc\")\n__description(\"context stores via BPF_ATOMIC\")\n__failure __msg(\"BPF_ATOMIC stores into R1 ctx is not allowed\")\n__naked void context_stores_via_bpf_atomic(void)\n{\n\tasm volatile (\"\t\t\t\t\t\\\n\tr0 = 0;\t\t\t\t\t\t\\\n\tlock *(u32 *)(r1 + %[__sk_buff_mark]) += w0;\t\\\n\texit;\t\t\t\t\t\t\\\n\"\t:\n\t: __imm_const(__sk_buff_mark, offsetof(struct __sk_buff, mark))\n\t: __clobber_all);\n}\n\nSEC(\"tc\")\n__description(\"arithmetic ops make PTR_TO_CTX unusable\")\n__failure __msg(\"dereference of modified ctx ptr\")\n__naked void make_ptr_to_ctx_unusable(void)\n{\n\tasm volatile (\"\t\t\t\t\t\\\n\tr1 += %[__imm_0];\t\t\t\t\\\n\tr0 = *(u32*)(r1 + %[__sk_buff_mark]);\t\t\\\n\texit;\t\t\t\t\t\t\\\n\"\t:\n\t: __imm_const(__imm_0,\n\t\t      offsetof(struct __sk_buff, data) - offsetof(struct __sk_buff, mark)),\n\t  __imm_const(__sk_buff_mark, offsetof(struct __sk_buff, mark))\n\t: __clobber_all);\n}\n\nSEC(\"tc\")\n__description(\"pass unmodified ctx pointer to helper\")\n__success __retval(0)\n__naked void unmodified_ctx_pointer_to_helper(void)\n{\n\tasm volatile (\"\t\t\t\t\t\\\n\tr2 = 0;\t\t\t\t\t\t\\\n\tcall %[bpf_csum_update];\t\t\t\\\n\tr0 = 0;\t\t\t\t\t\t\\\n\texit;\t\t\t\t\t\t\\\n\"\t:\n\t: __imm(bpf_csum_update)\n\t: __clobber_all);\n}\n\nSEC(\"tc\")\n__description(\"pass modified ctx pointer to helper, 1\")\n__failure __msg(\"negative offset ctx ptr R1 off=-612 disallowed\")\n__naked void ctx_pointer_to_helper_1(void)\n{\n\tasm volatile (\"\t\t\t\t\t\\\n\tr1 += -612;\t\t\t\t\t\\\n\tr2 = 0;\t\t\t\t\t\t\\\n\tcall %[bpf_csum_update];\t\t\t\\\n\tr0 = 0;\t\t\t\t\t\t\\\n\texit;\t\t\t\t\t\t\\\n\"\t:\n\t: __imm(bpf_csum_update)\n\t: __clobber_all);\n}\n\nSEC(\"socket\")\n__description(\"pass modified ctx pointer to helper, 2\")\n__failure __msg(\"negative offset ctx ptr R1 off=-612 disallowed\")\n__failure_unpriv __msg_unpriv(\"negative offset ctx ptr R1 off=-612 disallowed\")\n__naked void ctx_pointer_to_helper_2(void)\n{\n\tasm volatile (\"\t\t\t\t\t\\\n\tr1 += -612;\t\t\t\t\t\\\n\tcall %[bpf_get_socket_cookie];\t\t\t\\\n\tr0 = 0;\t\t\t\t\t\t\\\n\texit;\t\t\t\t\t\t\\\n\"\t:\n\t: __imm(bpf_get_socket_cookie)\n\t: __clobber_all);\n}\n\nSEC(\"tc\")\n__description(\"pass modified ctx pointer to helper, 3\")\n__failure __msg(\"variable ctx access var_off=(0x0; 0x4)\")\n__naked void ctx_pointer_to_helper_3(void)\n{\n\tasm volatile (\"\t\t\t\t\t\\\n\tr3 = *(u32*)(r1 + 0);\t\t\t\t\\\n\tr3 &= 4;\t\t\t\t\t\\\n\tr1 += r3;\t\t\t\t\t\\\n\tr2 = 0;\t\t\t\t\t\t\\\n\tcall %[bpf_csum_update];\t\t\t\\\n\tr0 = 0;\t\t\t\t\t\t\\\n\texit;\t\t\t\t\t\t\\\n\"\t:\n\t: __imm(bpf_csum_update)\n\t: __clobber_all);\n}\n\nSEC(\"cgroup/sendmsg6\")\n__description(\"pass ctx or null check, 1: ctx\")\n__success\n__naked void or_null_check_1_ctx(void)\n{\n\tasm volatile (\"\t\t\t\t\t\\\n\tcall %[bpf_get_netns_cookie];\t\t\t\\\n\tr0 = 0;\t\t\t\t\t\t\\\n\texit;\t\t\t\t\t\t\\\n\"\t:\n\t: __imm(bpf_get_netns_cookie)\n\t: __clobber_all);\n}\n\nSEC(\"cgroup/sendmsg6\")\n__description(\"pass ctx or null check, 2: null\")\n__success\n__naked void or_null_check_2_null(void)\n{\n\tasm volatile (\"\t\t\t\t\t\\\n\tr1 = 0;\t\t\t\t\t\t\\\n\tcall %[bpf_get_netns_cookie];\t\t\t\\\n\tr0 = 0;\t\t\t\t\t\t\\\n\texit;\t\t\t\t\t\t\\\n\"\t:\n\t: __imm(bpf_get_netns_cookie)\n\t: __clobber_all);\n}\n\nSEC(\"cgroup/sendmsg6\")\n__description(\"pass ctx or null check, 3: 1\")\n__failure __msg(\"R1 type=scalar expected=ctx\")\n__naked void or_null_check_3_1(void)\n{\n\tasm volatile (\"\t\t\t\t\t\\\n\tr1 = 1;\t\t\t\t\t\t\\\n\tcall %[bpf_get_netns_cookie];\t\t\t\\\n\tr0 = 0;\t\t\t\t\t\t\\\n\texit;\t\t\t\t\t\t\\\n\"\t:\n\t: __imm(bpf_get_netns_cookie)\n\t: __clobber_all);\n}\n\nSEC(\"cgroup/sendmsg6\")\n__description(\"pass ctx or null check, 4: ctx - const\")\n__failure __msg(\"negative offset ctx ptr R1 off=-612 disallowed\")\n__naked void null_check_4_ctx_const(void)\n{\n\tasm volatile (\"\t\t\t\t\t\\\n\tr1 += -612;\t\t\t\t\t\\\n\tcall %[bpf_get_netns_cookie];\t\t\t\\\n\tr0 = 0;\t\t\t\t\t\t\\\n\texit;\t\t\t\t\t\t\\\n\"\t:\n\t: __imm(bpf_get_netns_cookie)\n\t: __clobber_all);\n}\n\nSEC(\"cgroup/connect4\")\n__description(\"pass ctx or null check, 5: null (connect)\")\n__success\n__naked void null_check_5_null_connect(void)\n{\n\tasm volatile (\"\t\t\t\t\t\\\n\tr1 = 0;\t\t\t\t\t\t\\\n\tcall %[bpf_get_netns_cookie];\t\t\t\\\n\tr0 = 0;\t\t\t\t\t\t\\\n\texit;\t\t\t\t\t\t\\\n\"\t:\n\t: __imm(bpf_get_netns_cookie)\n\t: __clobber_all);\n}\n\nSEC(\"cgroup/post_bind4\")\n__description(\"pass ctx or null check, 6: null (bind)\")\n__success\n__naked void null_check_6_null_bind(void)\n{\n\tasm volatile (\"\t\t\t\t\t\\\n\tr1 = 0;\t\t\t\t\t\t\\\n\tcall %[bpf_get_netns_cookie];\t\t\t\\\n\tr0 = 0;\t\t\t\t\t\t\\\n\texit;\t\t\t\t\t\t\\\n\"\t:\n\t: __imm(bpf_get_netns_cookie)\n\t: __clobber_all);\n}\n\nSEC(\"cgroup/post_bind4\")\n__description(\"pass ctx or null check, 7: ctx (bind)\")\n__success\n__naked void null_check_7_ctx_bind(void)\n{\n\tasm volatile (\"\t\t\t\t\t\\\n\tcall %[bpf_get_socket_cookie];\t\t\t\\\n\tr0 = 0;\t\t\t\t\t\t\\\n\texit;\t\t\t\t\t\t\\\n\"\t:\n\t: __imm(bpf_get_socket_cookie)\n\t: __clobber_all);\n}\n\nSEC(\"cgroup/post_bind4\")\n__description(\"pass ctx or null check, 8: null (bind)\")\n__failure __msg(\"R1 type=scalar expected=ctx\")\n__naked void null_check_8_null_bind(void)\n{\n\tasm volatile (\"\t\t\t\t\t\\\n\tr1 = 0;\t\t\t\t\t\t\\\n\tcall %[bpf_get_socket_cookie];\t\t\t\\\n\tr0 = 0;\t\t\t\t\t\t\\\n\texit;\t\t\t\t\t\t\\\n\"\t:\n\t: __imm(bpf_get_socket_cookie)\n\t: __clobber_all);\n}\n\nchar _license[] SEC(\"license\") = \"GPL\";\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}