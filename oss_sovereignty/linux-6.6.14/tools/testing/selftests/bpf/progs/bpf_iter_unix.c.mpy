{
  "module_name": "bpf_iter_unix.c",
  "hash_id": "72b98f776ddc51a9580b0bc5664b765717758b5d2086c5f150452339ae397df6",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/bpf/progs/bpf_iter_unix.c",
  "human_readable_source": "\n \n#include \"bpf_iter.h\"\n#include \"bpf_tracing_net.h\"\n#include <bpf/bpf_helpers.h>\n#include <bpf/bpf_endian.h>\n\nchar _license[] SEC(\"license\") = \"GPL\";\n\nstatic long sock_i_ino(const struct sock *sk)\n{\n\tconst struct socket *sk_socket = sk->sk_socket;\n\tconst struct inode *inode;\n\tunsigned long ino;\n\n\tif (!sk_socket)\n\t\treturn 0;\n\n\tinode = &container_of(sk_socket, struct socket_alloc, socket)->vfs_inode;\n\tbpf_probe_read_kernel(&ino, sizeof(ino), &inode->i_ino);\n\treturn ino;\n}\n\nSEC(\"iter/unix\")\nint dump_unix(struct bpf_iter__unix *ctx)\n{\n\tstruct unix_sock *unix_sk = ctx->unix_sk;\n\tstruct sock *sk = (struct sock *)unix_sk;\n\tstruct seq_file *seq;\n\t__u32 seq_num;\n\n\tif (!unix_sk)\n\t\treturn 0;\n\n\tseq = ctx->meta->seq;\n\tseq_num = ctx->meta->seq_num;\n\tif (seq_num == 0)\n\t\tBPF_SEQ_PRINTF(seq, \"Num               RefCount Protocol Flags    Type St    Inode Path\\n\");\n\n\tBPF_SEQ_PRINTF(seq, \"%pK: %08X %08X %08X %04X %02X %8lu\",\n\t\t       unix_sk,\n\t\t       sk->sk_refcnt.refs.counter,\n\t\t       0,\n\t\t       sk->sk_state == TCP_LISTEN ? __SO_ACCEPTCON : 0,\n\t\t       sk->sk_type,\n\t\t       sk->sk_socket ?\n\t\t       (sk->sk_state == TCP_ESTABLISHED ? SS_CONNECTED : SS_UNCONNECTED) :\n\t\t       (sk->sk_state == TCP_ESTABLISHED ? SS_CONNECTING : SS_DISCONNECTING),\n\t\t       sock_i_ino(sk));\n\n\tif (unix_sk->addr) {\n\t\tif (unix_sk->addr->name->sun_path[0]) {\n\t\t\tBPF_SEQ_PRINTF(seq, \" %s\", unix_sk->addr->name->sun_path);\n\t\t} else {\n\t\t\t \n\t\t\t__u64 i, len;\n\n\t\t\tlen = unix_sk->addr->len - sizeof(short);\n\n\t\t\tBPF_SEQ_PRINTF(seq, \" @\");\n\n\t\t\tfor (i = 1; i < len; i++) {\n\t\t\t\t \n\t\t\t\tif (i >= sizeof(struct sockaddr_un))\n\t\t\t\t\tbreak;\n\n\t\t\t\tBPF_SEQ_PRINTF(seq, \"%c\",\n\t\t\t\t\t       unix_sk->addr->name->sun_path[i] ?:\n\t\t\t\t\t       '@');\n\t\t\t}\n\t\t}\n\t}\n\n\tBPF_SEQ_PRINTF(seq, \"\\n\");\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}