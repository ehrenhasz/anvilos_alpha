{
  "module_name": "kfunc_call_test.c",
  "hash_id": "250e30f55e31dca8679250056ad405a897a91d35ec2c1df298aa9dfd6f7b9219",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/bpf/progs/kfunc_call_test.c",
  "human_readable_source": "\n \n#include <vmlinux.h>\n#include <bpf/bpf_helpers.h>\n#include \"../bpf_testmod/bpf_testmod_kfunc.h\"\n\nSEC(\"tc\")\nint kfunc_call_test4(struct __sk_buff *skb)\n{\n\tstruct bpf_sock *sk = skb->sk;\n\tlong tmp;\n\n\tif (!sk)\n\t\treturn -1;\n\n\tsk = bpf_sk_fullsock(sk);\n\tif (!sk)\n\t\treturn -1;\n\n\ttmp = bpf_kfunc_call_test4(-3, -30, -200, -1000);\n\treturn (tmp >> 32) + tmp;\n}\n\nSEC(\"tc\")\nint kfunc_call_test2(struct __sk_buff *skb)\n{\n\tstruct bpf_sock *sk = skb->sk;\n\n\tif (!sk)\n\t\treturn -1;\n\n\tsk = bpf_sk_fullsock(sk);\n\tif (!sk)\n\t\treturn -1;\n\n\treturn bpf_kfunc_call_test2((struct sock *)sk, 1, 2);\n}\n\nSEC(\"tc\")\nint kfunc_call_test1(struct __sk_buff *skb)\n{\n\tstruct bpf_sock *sk = skb->sk;\n\t__u64 a = 1ULL << 32;\n\t__u32 ret;\n\n\tif (!sk)\n\t\treturn -1;\n\n\tsk = bpf_sk_fullsock(sk);\n\tif (!sk)\n\t\treturn -1;\n\n\ta = bpf_kfunc_call_test1((struct sock *)sk, 1, a | 2, 3, a | 4);\n\tret = a >> 32;    \n\tret += (__u32)a;  \n\n\treturn ret;\n}\n\nSEC(\"tc\")\nint kfunc_call_test_ref_btf_id(struct __sk_buff *skb)\n{\n\tstruct prog_test_ref_kfunc *pt;\n\tunsigned long s = 0;\n\tint ret = 0;\n\n\tpt = bpf_kfunc_call_test_acquire(&s);\n\tif (pt) {\n\t\tif (pt->a != 42 || pt->b != 108)\n\t\t\tret = -1;\n\t\tbpf_kfunc_call_test_release(pt);\n\t}\n\treturn ret;\n}\n\nSEC(\"tc\")\nint kfunc_call_test_pass(struct __sk_buff *skb)\n{\n\tstruct prog_test_pass1 p1 = {};\n\tstruct prog_test_pass2 p2 = {};\n\tshort a = 0;\n\t__u64 b = 0;\n\tlong c = 0;\n\tchar d = 0;\n\tint e = 0;\n\n\tbpf_kfunc_call_test_pass_ctx(skb);\n\tbpf_kfunc_call_test_pass1(&p1);\n\tbpf_kfunc_call_test_pass2(&p2);\n\n\tbpf_kfunc_call_test_mem_len_pass1(&a, sizeof(a));\n\tbpf_kfunc_call_test_mem_len_pass1(&b, sizeof(b));\n\tbpf_kfunc_call_test_mem_len_pass1(&c, sizeof(c));\n\tbpf_kfunc_call_test_mem_len_pass1(&d, sizeof(d));\n\tbpf_kfunc_call_test_mem_len_pass1(&e, sizeof(e));\n\tbpf_kfunc_call_test_mem_len_fail2(&b, -1);\n\n\treturn 0;\n}\n\nstruct syscall_test_args {\n\t__u8 data[16];\n\tsize_t size;\n};\n\nSEC(\"syscall\")\nint kfunc_syscall_test(struct syscall_test_args *args)\n{\n\tconst long size = args->size;\n\n\tif (size > sizeof(args->data))\n\t\treturn -7;  \n\n\tbpf_kfunc_call_test_mem_len_pass1(&args->data, sizeof(args->data));\n\tbpf_kfunc_call_test_mem_len_pass1(&args->data, sizeof(*args));\n\tbpf_kfunc_call_test_mem_len_pass1(&args->data, size);\n\n\treturn 0;\n}\n\nSEC(\"syscall\")\nint kfunc_syscall_test_null(struct syscall_test_args *args)\n{\n\t \n\n\tbpf_kfunc_call_test_mem_len_pass1(args, 0);\n\n\treturn 0;\n}\n\nSEC(\"tc\")\nint kfunc_call_test_get_mem(struct __sk_buff *skb)\n{\n\tstruct prog_test_ref_kfunc *pt;\n\tunsigned long s = 0;\n\tint *p = NULL;\n\tint ret = 0;\n\n\tpt = bpf_kfunc_call_test_acquire(&s);\n\tif (pt) {\n\t\tp = bpf_kfunc_call_test_get_rdwr_mem(pt, 2 * sizeof(int));\n\t\tif (p) {\n\t\t\tp[0] = 42;\n\t\t\tret = p[1];  \n\t\t} else {\n\t\t\tret = -1;\n\t\t}\n\n\t\tif (ret >= 0) {\n\t\t\tp = bpf_kfunc_call_test_get_rdonly_mem(pt, 2 * sizeof(int));\n\t\t\tif (p)\n\t\t\t\tret = p[0];  \n\t\t\telse\n\t\t\t\tret = -1;\n\t\t}\n\n\t\tbpf_kfunc_call_test_release(pt);\n\t}\n\treturn ret;\n}\n\nSEC(\"tc\")\nint kfunc_call_test_static_unused_arg(struct __sk_buff *skb)\n{\n\n\tu32 expected = 5, actual;\n\n\tactual = bpf_kfunc_call_test_static_unused_arg(expected, 0xdeadbeef);\n\treturn actual != expected ? -1 : 0;\n}\n\nchar _license[] SEC(\"license\") = \"GPL\";\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}