{
  "module_name": "verifier_helper_restricted.c",
  "hash_id": "1f4cb913ef68f279ffa7bbd7b2515b46c6d31137a63ec9c92b0462b1da0c3117",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/bpf/progs/verifier_helper_restricted.c",
  "human_readable_source": "\n \n\n#include <linux/bpf.h>\n#include <bpf/bpf_helpers.h>\n#include \"bpf_misc.h\"\n\nstruct val {\n\tint cnt;\n\tstruct bpf_spin_lock l;\n};\n\nstruct {\n\t__uint(type, BPF_MAP_TYPE_ARRAY);\n\t__uint(max_entries, 1);\n\t__type(key, int);\n\t__type(value, struct val);\n} map_spin_lock SEC(\".maps\");\n\nstruct timer {\n\tstruct bpf_timer t;\n};\n\nstruct {\n\t__uint(type, BPF_MAP_TYPE_ARRAY);\n\t__uint(max_entries, 1);\n\t__type(key, int);\n\t__type(value, struct timer);\n} map_timer SEC(\".maps\");\n\nSEC(\"kprobe\")\n__description(\"bpf_ktime_get_coarse_ns is forbidden in BPF_PROG_TYPE_KPROBE\")\n__failure __msg(\"unknown func bpf_ktime_get_coarse_ns\")\n__naked void in_bpf_prog_type_kprobe_1(void)\n{\n\tasm volatile (\"\t\t\t\t\t\\\n\tcall %[bpf_ktime_get_coarse_ns];\t\t\\\n\tr0 = 0;\t\t\t\t\t\t\\\n\texit;\t\t\t\t\t\t\\\n\"\t:\n\t: __imm(bpf_ktime_get_coarse_ns)\n\t: __clobber_all);\n}\n\nSEC(\"tracepoint\")\n__description(\"bpf_ktime_get_coarse_ns is forbidden in BPF_PROG_TYPE_TRACEPOINT\")\n__failure __msg(\"unknown func bpf_ktime_get_coarse_ns\")\n__naked void in_bpf_prog_type_tracepoint_1(void)\n{\n\tasm volatile (\"\t\t\t\t\t\\\n\tcall %[bpf_ktime_get_coarse_ns];\t\t\\\n\tr0 = 0;\t\t\t\t\t\t\\\n\texit;\t\t\t\t\t\t\\\n\"\t:\n\t: __imm(bpf_ktime_get_coarse_ns)\n\t: __clobber_all);\n}\n\nSEC(\"perf_event\")\n__description(\"bpf_ktime_get_coarse_ns is forbidden in BPF_PROG_TYPE_PERF_EVENT\")\n__failure __msg(\"unknown func bpf_ktime_get_coarse_ns\")\n__naked void bpf_prog_type_perf_event_1(void)\n{\n\tasm volatile (\"\t\t\t\t\t\\\n\tcall %[bpf_ktime_get_coarse_ns];\t\t\\\n\tr0 = 0;\t\t\t\t\t\t\\\n\texit;\t\t\t\t\t\t\\\n\"\t:\n\t: __imm(bpf_ktime_get_coarse_ns)\n\t: __clobber_all);\n}\n\nSEC(\"raw_tracepoint\")\n__description(\"bpf_ktime_get_coarse_ns is forbidden in BPF_PROG_TYPE_RAW_TRACEPOINT\")\n__failure __msg(\"unknown func bpf_ktime_get_coarse_ns\")\n__naked void bpf_prog_type_raw_tracepoint_1(void)\n{\n\tasm volatile (\"\t\t\t\t\t\\\n\tcall %[bpf_ktime_get_coarse_ns];\t\t\\\n\tr0 = 0;\t\t\t\t\t\t\\\n\texit;\t\t\t\t\t\t\\\n\"\t:\n\t: __imm(bpf_ktime_get_coarse_ns)\n\t: __clobber_all);\n}\n\nSEC(\"kprobe\")\n__description(\"bpf_timer_init isn restricted in BPF_PROG_TYPE_KPROBE\")\n__failure __msg(\"tracing progs cannot use bpf_timer yet\")\n__naked void in_bpf_prog_type_kprobe_2(void)\n{\n\tasm volatile (\"\t\t\t\t\t\\\n\tr2 = r10;\t\t\t\t\t\\\n\tr2 += -8;\t\t\t\t\t\\\n\tr1 = 0;\t\t\t\t\t\t\\\n\t*(u64*)(r2 + 0) = r1;\t\t\t\t\\\n\tr1 = %[map_timer] ll;\t\t\t\t\\\n\tcall %[bpf_map_lookup_elem];\t\t\t\\\n\tif r0 == 0 goto l0_%=;\t\t\t\t\\\n\tr1 = r0;\t\t\t\t\t\\\n\tr2 = %[map_timer] ll;\t\t\t\t\\\n\tr3 = 1;\t\t\t\t\t\t\\\nl0_%=:\tcall %[bpf_timer_init];\t\t\t\t\\\n\texit;\t\t\t\t\t\t\\\n\"\t:\n\t: __imm(bpf_map_lookup_elem),\n\t  __imm(bpf_timer_init),\n\t  __imm_addr(map_timer)\n\t: __clobber_all);\n}\n\nSEC(\"perf_event\")\n__description(\"bpf_timer_init is forbidden in BPF_PROG_TYPE_PERF_EVENT\")\n__failure __msg(\"tracing progs cannot use bpf_timer yet\")\n__naked void bpf_prog_type_perf_event_2(void)\n{\n\tasm volatile (\"\t\t\t\t\t\\\n\tr2 = r10;\t\t\t\t\t\\\n\tr2 += -8;\t\t\t\t\t\\\n\tr1 = 0;\t\t\t\t\t\t\\\n\t*(u64*)(r2 + 0) = r1;\t\t\t\t\\\n\tr1 = %[map_timer] ll;\t\t\t\t\\\n\tcall %[bpf_map_lookup_elem];\t\t\t\\\n\tif r0 == 0 goto l0_%=;\t\t\t\t\\\n\tr1 = r0;\t\t\t\t\t\\\n\tr2 = %[map_timer] ll;\t\t\t\t\\\n\tr3 = 1;\t\t\t\t\t\t\\\nl0_%=:\tcall %[bpf_timer_init];\t\t\t\t\\\n\texit;\t\t\t\t\t\t\\\n\"\t:\n\t: __imm(bpf_map_lookup_elem),\n\t  __imm(bpf_timer_init),\n\t  __imm_addr(map_timer)\n\t: __clobber_all);\n}\n\nSEC(\"tracepoint\")\n__description(\"bpf_timer_init is forbidden in BPF_PROG_TYPE_TRACEPOINT\")\n__failure __msg(\"tracing progs cannot use bpf_timer yet\")\n__naked void in_bpf_prog_type_tracepoint_2(void)\n{\n\tasm volatile (\"\t\t\t\t\t\\\n\tr2 = r10;\t\t\t\t\t\\\n\tr2 += -8;\t\t\t\t\t\\\n\tr1 = 0;\t\t\t\t\t\t\\\n\t*(u64*)(r2 + 0) = r1;\t\t\t\t\\\n\tr1 = %[map_timer] ll;\t\t\t\t\\\n\tcall %[bpf_map_lookup_elem];\t\t\t\\\n\tif r0 == 0 goto l0_%=;\t\t\t\t\\\n\tr1 = r0;\t\t\t\t\t\\\n\tr2 = %[map_timer] ll;\t\t\t\t\\\n\tr3 = 1;\t\t\t\t\t\t\\\nl0_%=:\tcall %[bpf_timer_init];\t\t\t\t\\\n\texit;\t\t\t\t\t\t\\\n\"\t:\n\t: __imm(bpf_map_lookup_elem),\n\t  __imm(bpf_timer_init),\n\t  __imm_addr(map_timer)\n\t: __clobber_all);\n}\n\nSEC(\"raw_tracepoint\")\n__description(\"bpf_timer_init is forbidden in BPF_PROG_TYPE_RAW_TRACEPOINT\")\n__failure __msg(\"tracing progs cannot use bpf_timer yet\")\n__naked void bpf_prog_type_raw_tracepoint_2(void)\n{\n\tasm volatile (\"\t\t\t\t\t\\\n\tr2 = r10;\t\t\t\t\t\\\n\tr2 += -8;\t\t\t\t\t\\\n\tr1 = 0;\t\t\t\t\t\t\\\n\t*(u64*)(r2 + 0) = r1;\t\t\t\t\\\n\tr1 = %[map_timer] ll;\t\t\t\t\\\n\tcall %[bpf_map_lookup_elem];\t\t\t\\\n\tif r0 == 0 goto l0_%=;\t\t\t\t\\\n\tr1 = r0;\t\t\t\t\t\\\n\tr2 = %[map_timer] ll;\t\t\t\t\\\n\tr3 = 1;\t\t\t\t\t\t\\\nl0_%=:\tcall %[bpf_timer_init];\t\t\t\t\\\n\texit;\t\t\t\t\t\t\\\n\"\t:\n\t: __imm(bpf_map_lookup_elem),\n\t  __imm(bpf_timer_init),\n\t  __imm_addr(map_timer)\n\t: __clobber_all);\n}\n\nSEC(\"kprobe\")\n__description(\"bpf_spin_lock is forbidden in BPF_PROG_TYPE_KPROBE\")\n__failure __msg(\"tracing progs cannot use bpf_spin_lock yet\")\n__naked void in_bpf_prog_type_kprobe_3(void)\n{\n\tasm volatile (\"\t\t\t\t\t\\\n\tr2 = r10;\t\t\t\t\t\\\n\tr2 += -8;\t\t\t\t\t\\\n\tr1 = 0;\t\t\t\t\t\t\\\n\t*(u64*)(r2 + 0) = r1;\t\t\t\t\\\n\tr1 = %[map_spin_lock] ll;\t\t\t\\\n\tcall %[bpf_map_lookup_elem];\t\t\t\\\n\tif r0 == 0 goto l0_%=;\t\t\t\t\\\n\tr1 = r0;\t\t\t\t\t\\\n\tcall %[bpf_spin_lock];\t\t\t\t\\\nl0_%=:\texit;\t\t\t\t\t\t\\\n\"\t:\n\t: __imm(bpf_map_lookup_elem),\n\t  __imm(bpf_spin_lock),\n\t  __imm_addr(map_spin_lock)\n\t: __clobber_all);\n}\n\nSEC(\"tracepoint\")\n__description(\"bpf_spin_lock is forbidden in BPF_PROG_TYPE_TRACEPOINT\")\n__failure __msg(\"tracing progs cannot use bpf_spin_lock yet\")\n__naked void in_bpf_prog_type_tracepoint_3(void)\n{\n\tasm volatile (\"\t\t\t\t\t\\\n\tr2 = r10;\t\t\t\t\t\\\n\tr2 += -8;\t\t\t\t\t\\\n\tr1 = 0;\t\t\t\t\t\t\\\n\t*(u64*)(r2 + 0) = r1;\t\t\t\t\\\n\tr1 = %[map_spin_lock] ll;\t\t\t\\\n\tcall %[bpf_map_lookup_elem];\t\t\t\\\n\tif r0 == 0 goto l0_%=;\t\t\t\t\\\n\tr1 = r0;\t\t\t\t\t\\\n\tcall %[bpf_spin_lock];\t\t\t\t\\\nl0_%=:\texit;\t\t\t\t\t\t\\\n\"\t:\n\t: __imm(bpf_map_lookup_elem),\n\t  __imm(bpf_spin_lock),\n\t  __imm_addr(map_spin_lock)\n\t: __clobber_all);\n}\n\nSEC(\"perf_event\")\n__description(\"bpf_spin_lock is forbidden in BPF_PROG_TYPE_PERF_EVENT\")\n__failure __msg(\"tracing progs cannot use bpf_spin_lock yet\")\n__naked void bpf_prog_type_perf_event_3(void)\n{\n\tasm volatile (\"\t\t\t\t\t\\\n\tr2 = r10;\t\t\t\t\t\\\n\tr2 += -8;\t\t\t\t\t\\\n\tr1 = 0;\t\t\t\t\t\t\\\n\t*(u64*)(r2 + 0) = r1;\t\t\t\t\\\n\tr1 = %[map_spin_lock] ll;\t\t\t\\\n\tcall %[bpf_map_lookup_elem];\t\t\t\\\n\tif r0 == 0 goto l0_%=;\t\t\t\t\\\n\tr1 = r0;\t\t\t\t\t\\\n\tcall %[bpf_spin_lock];\t\t\t\t\\\nl0_%=:\texit;\t\t\t\t\t\t\\\n\"\t:\n\t: __imm(bpf_map_lookup_elem),\n\t  __imm(bpf_spin_lock),\n\t  __imm_addr(map_spin_lock)\n\t: __clobber_all);\n}\n\nSEC(\"raw_tracepoint\")\n__description(\"bpf_spin_lock is forbidden in BPF_PROG_TYPE_RAW_TRACEPOINT\")\n__failure __msg(\"tracing progs cannot use bpf_spin_lock yet\")\n__naked void bpf_prog_type_raw_tracepoint_3(void)\n{\n\tasm volatile (\"\t\t\t\t\t\\\n\tr2 = r10;\t\t\t\t\t\\\n\tr2 += -8;\t\t\t\t\t\\\n\tr1 = 0;\t\t\t\t\t\t\\\n\t*(u64*)(r2 + 0) = r1;\t\t\t\t\\\n\tr1 = %[map_spin_lock] ll;\t\t\t\\\n\tcall %[bpf_map_lookup_elem];\t\t\t\\\n\tif r0 == 0 goto l0_%=;\t\t\t\t\\\n\tr1 = r0;\t\t\t\t\t\\\n\tcall %[bpf_spin_lock];\t\t\t\t\\\nl0_%=:\texit;\t\t\t\t\t\t\\\n\"\t:\n\t: __imm(bpf_map_lookup_elem),\n\t  __imm(bpf_spin_lock),\n\t  __imm_addr(map_spin_lock)\n\t: __clobber_all);\n}\n\nchar _license[] SEC(\"license\") = \"GPL\";\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}