{
  "module_name": "test_tcp_check_syncookie.sh",
  "hash_id": "04d7fb43edd176c0dafafefc1eb2719bf279d10cab9de0f3fc63c722ba40f5e3",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/bpf/test_tcp_check_syncookie.sh",
  "human_readable_source": "#!/bin/sh\n# SPDX-License-Identifier: GPL-2.0\n# Copyright (c) 2018 Facebook\n# Copyright (c) 2019 Cloudflare\n\nset -eu\nreadonly NS1=\"ns1-$(mktemp -u XXXXXX)\"\n\nwait_for_ip()\n{\n\tlocal _i\n\tprintf \"Wait for IP %s to become available \" \"$1\"\n\tfor _i in $(seq ${MAX_PING_TRIES}); do\n\t\tprintf \".\"\n\t\tif ns1_exec ping -c 1 -W 1 \"$1\" >/dev/null 2>&1; then\n\t\t\techo \" OK\"\n\t\t\treturn\n\t\tfi\n\t\tsleep 1\n\tdone\n\techo 1>&2 \"ERROR: Timeout waiting for test IP to become available.\"\n\texit 1\n}\n\nget_prog_id()\n{\n\tawk '/ id / {sub(/.* id /, \"\", $0); print($1)}'\n}\n\nns1_exec()\n{\n\tip netns exec ${NS1} \"$@\"\n}\n\nsetup()\n{\n\tip netns add ${NS1}\n\tns1_exec ip link set lo up\n\n\tns1_exec sysctl -w net.ipv4.tcp_syncookies=2\n\tns1_exec sysctl -w net.ipv4.tcp_window_scaling=0\n\tns1_exec sysctl -w net.ipv4.tcp_timestamps=0\n\tns1_exec sysctl -w net.ipv4.tcp_sack=0\n\n\twait_for_ip 127.0.0.1\n\twait_for_ip ::1\n}\n\ncleanup()\n{\n\tip netns del ns1 2>/dev/null || :\n}\n\nmain()\n{\n\ttrap cleanup EXIT 2 3 6 15\n\tsetup\n\n\tprintf \"Testing clsact...\"\n\tns1_exec tc qdisc add dev \"${TEST_IF}\" clsact\n\tns1_exec tc filter add dev \"${TEST_IF}\" ingress \\\n\t\tbpf obj \"${BPF_PROG_OBJ}\" sec \"${CLSACT_SECTION}\" da\n\n\tBPF_PROG_ID=$(ns1_exec tc filter show dev \"${TEST_IF}\" ingress | \\\n\t\t      get_prog_id)\n\tns1_exec \"${PROG}\" \"${BPF_PROG_ID}\"\n\tns1_exec tc qdisc del dev \"${TEST_IF}\" clsact\n\n\tprintf \"Testing XDP...\"\n\tns1_exec ip link set \"${TEST_IF}\" xdp \\\n\t\tobject \"${BPF_PROG_OBJ}\" section \"${XDP_SECTION}\"\n\tBPF_PROG_ID=$(ns1_exec ip link show \"${TEST_IF}\" | get_prog_id)\n\tns1_exec \"${PROG}\" \"${BPF_PROG_ID}\"\n}\n\nDIR=$(dirname $0)\nTEST_IF=lo\nMAX_PING_TRIES=5\nBPF_PROG_OBJ=\"${DIR}/test_tcp_check_syncookie_kern.bpf.o\"\nCLSACT_SECTION=\"tc\"\nXDP_SECTION=\"xdp\"\nBPF_PROG_ID=0\nPROG=\"${DIR}/test_tcp_check_syncookie_user\"\n\nmain\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}