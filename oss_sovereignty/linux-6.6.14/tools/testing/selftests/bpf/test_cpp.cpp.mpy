{
  "module_name": "test_cpp.cpp",
  "hash_id": "7f550fccb2b4c62f90d103e9db147e4f88e292a2da0f9515870ea83a798fa54f",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/bpf/test_cpp.cpp",
  "human_readable_source": " \n#include <iostream>\n#include <unistd.h>\n#include <linux/bpf.h>\n#include <linux/btf.h>\n#include <bpf/libbpf.h>\n#include <bpf/bpf.h>\n#include <bpf/btf.h>\n#include \"test_core_extern.skel.h\"\n\ntemplate <typename T>\nclass Skeleton {\nprivate:\n\tT *skel;\npublic:\n\tSkeleton(): skel(nullptr) { }\n\n\t~Skeleton() { if (skel) T::destroy(skel); }\n\n\tint open(const struct bpf_object_open_opts *opts = nullptr)\n\t{\n\t\tint err;\n\n\t\tif (skel)\n\t\t\treturn -EBUSY;\n\n\t\tskel = T::open(opts);\n\t\terr = libbpf_get_error(skel);\n\t\tif (err) {\n\t\t\tskel = nullptr;\n\t\t\treturn err;\n\t\t}\n\n\t\treturn 0;\n\t}\n\n\tint load() { return T::load(skel); }\n\n\tint attach() { return T::attach(skel); }\n\n\tvoid detach() { return T::detach(skel); }\n\n\tconst T* operator->() const { return skel; }\n\n\tT* operator->() { return skel; }\n\n\tconst T *get() const { return skel; }\n};\n\nstatic void dump_printf(void *ctx, const char *fmt, va_list args)\n{\n}\n\nstatic void try_skeleton_template()\n{\n\tSkeleton<test_core_extern> skel;\n\tstd::string prog_name;\n\tint err;\n\tLIBBPF_OPTS(bpf_object_open_opts, opts);\n\n\terr = skel.open(&opts);\n\tif (err) {\n\t\tfprintf(stderr, \"Skeleton open failed: %d\\n\", err);\n\t\treturn;\n\t}\n\n\tskel->data->kern_ver = 123;\n\tskel->data->int_val = skel->data->ushort_val;\n\n\terr = skel.load();\n\tif (err) {\n\t\tfprintf(stderr, \"Skeleton load failed: %d\\n\", err);\n\t\treturn;\n\t}\n\n\tif (!skel->kconfig->CONFIG_BPF_SYSCALL)\n\t\tfprintf(stderr, \"Seems like CONFIG_BPF_SYSCALL isn't set?!\\n\");\n\n\terr = skel.attach();\n\tif (err) {\n\t\tfprintf(stderr, \"Skeleton attach failed: %d\\n\", err);\n\t\treturn;\n\t}\n\n\tprog_name = bpf_program__name(skel->progs.handle_sys_enter);\n\tif (prog_name != \"handle_sys_enter\")\n\t\tfprintf(stderr, \"Unexpected program name: %s\\n\", prog_name.c_str());\n\n\tbpf_link__destroy(skel->links.handle_sys_enter);\n\tskel->links.handle_sys_enter = bpf_program__attach(skel->progs.handle_sys_enter);\n\n\tskel.detach();\n\n\t \n}\n\nint main(int argc, char *argv[])\n{\n\tstruct btf_dump_opts opts = { };\n\tstruct test_core_extern *skel;\n\tstruct btf *btf;\n\tint fd;\n\n\ttry_skeleton_template();\n\n\t \n\tlibbpf_set_print(NULL);\n\n\t \n\tbpf_prog_get_fd_by_id(0);\n\n\t \n\tbtf = btf__new(NULL, 0);\n\tif (!libbpf_get_error(btf))\n\t\tbtf_dump__new(btf, dump_printf, nullptr, &opts);\n\n\t \n\tskel = test_core_extern__open_and_load();\n\ttest_core_extern__destroy(skel);\n\n\tfd = bpf_enable_stats(BPF_STATS_RUN_TIME);\n\tif (fd < 0)\n\t\tstd::cout << \"FAILED to enable stats: \" << fd << std::endl;\n\telse\n\t\t::close(fd);\n\n\tstd::cout << \"DONE!\" << std::endl;\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}