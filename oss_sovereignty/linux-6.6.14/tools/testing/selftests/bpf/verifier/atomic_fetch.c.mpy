{
  "module_name": "atomic_fetch.c",
  "hash_id": "9cb2c79ebaea18c28d7799b22e5491b3fcccaf8babf6d6e4031df93ff83318f1",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/bpf/verifier/atomic_fetch.c",
  "human_readable_source": "{\n\t\"atomic dw/fetch and address leakage of (map ptr & -1) via stack slot\",\n\t.insns = {\n\t\tBPF_LD_IMM64(BPF_REG_1, -1),\n\t\tBPF_LD_MAP_FD(BPF_REG_8, 0),\n\t\tBPF_LD_MAP_FD(BPF_REG_9, 0),\n\t\tBPF_MOV64_REG(BPF_REG_2, BPF_REG_10),\n\t\tBPF_ALU64_IMM(BPF_ADD, BPF_REG_2, -8),\n\t\tBPF_STX_MEM(BPF_DW, BPF_REG_2, BPF_REG_9, 0),\n\t\tBPF_ATOMIC_OP(BPF_DW, BPF_AND | BPF_FETCH, BPF_REG_2, BPF_REG_1, 0),\n\t\tBPF_LDX_MEM(BPF_DW, BPF_REG_9, BPF_REG_2, 0),\n\t\tBPF_ST_MEM(BPF_DW, BPF_REG_2, 0, 0),\n\t\tBPF_MOV64_REG(BPF_REG_1, BPF_REG_8),\n\t\tBPF_EMIT_CALL(BPF_FUNC_map_lookup_elem),\n\t\tBPF_JMP_IMM(BPF_JEQ, BPF_REG_0, 0, 1),\n\t\tBPF_STX_MEM(BPF_DW, BPF_REG_0, BPF_REG_9, 0),\n\t\tBPF_MOV64_IMM(BPF_REG_0, 0),\n\t\tBPF_EXIT_INSN(),\n\t},\n\t.fixup_map_array_48b = { 2, 4 },\n\t.result = ACCEPT,\n\t.result_unpriv = REJECT,\n\t.errstr_unpriv = \"leaking pointer from stack off -8\",\n},\n{\n\t\"atomic dw/fetch and address leakage of (map ptr & -1) via returned value\",\n\t.insns = {\n\t\tBPF_LD_IMM64(BPF_REG_1, -1),\n\t\tBPF_LD_MAP_FD(BPF_REG_8, 0),\n\t\tBPF_LD_MAP_FD(BPF_REG_9, 0),\n\t\tBPF_MOV64_REG(BPF_REG_2, BPF_REG_10),\n\t\tBPF_ALU64_IMM(BPF_ADD, BPF_REG_2, -8),\n\t\tBPF_STX_MEM(BPF_DW, BPF_REG_2, BPF_REG_9, 0),\n\t\tBPF_ATOMIC_OP(BPF_DW, BPF_AND | BPF_FETCH, BPF_REG_2, BPF_REG_1, 0),\n\t\tBPF_MOV64_REG(BPF_REG_9, BPF_REG_1),\n\t\tBPF_ST_MEM(BPF_DW, BPF_REG_2, 0, 0),\n\t\tBPF_MOV64_REG(BPF_REG_1, BPF_REG_8),\n\t\tBPF_EMIT_CALL(BPF_FUNC_map_lookup_elem),\n\t\tBPF_JMP_IMM(BPF_JEQ, BPF_REG_0, 0, 1),\n\t\tBPF_STX_MEM(BPF_DW, BPF_REG_0, BPF_REG_9, 0),\n\t\tBPF_MOV64_IMM(BPF_REG_0, 0),\n\t\tBPF_EXIT_INSN(),\n\t},\n\t.fixup_map_array_48b = { 2, 4 },\n\t.result = ACCEPT,\n\t.result_unpriv = REJECT,\n\t.errstr_unpriv = \"leaking pointer from stack off -8\",\n},\n{\n\t\"atomic w/fetch and address leakage of (map ptr & -1) via stack slot\",\n\t.insns = {\n\t\tBPF_LD_IMM64(BPF_REG_1, -1),\n\t\tBPF_LD_MAP_FD(BPF_REG_8, 0),\n\t\tBPF_LD_MAP_FD(BPF_REG_9, 0),\n\t\tBPF_MOV64_REG(BPF_REG_2, BPF_REG_10),\n\t\tBPF_ALU64_IMM(BPF_ADD, BPF_REG_2, -8),\n\t\tBPF_STX_MEM(BPF_DW, BPF_REG_2, BPF_REG_9, 0),\n\t\tBPF_ATOMIC_OP(BPF_W, BPF_AND | BPF_FETCH, BPF_REG_2, BPF_REG_1, 0),\n\t\tBPF_LDX_MEM(BPF_DW, BPF_REG_9, BPF_REG_2, 0),\n\t\tBPF_ST_MEM(BPF_DW, BPF_REG_2, 0, 0),\n\t\tBPF_MOV64_REG(BPF_REG_1, BPF_REG_8),\n\t\tBPF_EMIT_CALL(BPF_FUNC_map_lookup_elem),\n\t\tBPF_JMP_IMM(BPF_JEQ, BPF_REG_0, 0, 1),\n\t\tBPF_STX_MEM(BPF_DW, BPF_REG_0, BPF_REG_9, 0),\n\t\tBPF_MOV64_IMM(BPF_REG_0, 0),\n\t\tBPF_EXIT_INSN(),\n\t},\n\t.fixup_map_array_48b = { 2, 4 },\n\t.result = REJECT,\n\t.errstr = \"invalid size of register fill\",\n},\n{\n\t\"atomic w/fetch and address leakage of (map ptr & -1) via returned value\",\n\t.insns = {\n\t\tBPF_LD_IMM64(BPF_REG_1, -1),\n\t\tBPF_LD_MAP_FD(BPF_REG_8, 0),\n\t\tBPF_LD_MAP_FD(BPF_REG_9, 0),\n\t\tBPF_MOV64_REG(BPF_REG_2, BPF_REG_10),\n\t\tBPF_ALU64_IMM(BPF_ADD, BPF_REG_2, -8),\n\t\tBPF_STX_MEM(BPF_DW, BPF_REG_2, BPF_REG_9, 0),\n\t\tBPF_ATOMIC_OP(BPF_W, BPF_AND | BPF_FETCH, BPF_REG_2, BPF_REG_1, 0),\n\t\tBPF_MOV64_REG(BPF_REG_9, BPF_REG_1),\n\t\tBPF_ST_MEM(BPF_DW, BPF_REG_2, 0, 0),\n\t\tBPF_MOV64_REG(BPF_REG_1, BPF_REG_8),\n\t\tBPF_EMIT_CALL(BPF_FUNC_map_lookup_elem),\n\t\tBPF_JMP_IMM(BPF_JEQ, BPF_REG_0, 0, 1),\n\t\tBPF_STX_MEM(BPF_DW, BPF_REG_0, BPF_REG_9, 0),\n\t\tBPF_MOV64_IMM(BPF_REG_0, 0),\n\t\tBPF_EXIT_INSN(),\n\t},\n\t.fixup_map_array_48b = { 2, 4 },\n\t.result = REJECT,\n\t.errstr = \"invalid size of register fill\",\n},\n#define __ATOMIC_FETCH_OP_TEST(src_reg, dst_reg, operand1, op, operand2, expect) \\\n\t{\t\t\t\t\t\t\t\t\\\n\t\t\"atomic fetch \" #op \", src=\" #dst_reg \" dst=\" #dst_reg,\t\\\n\t\t.insns = {\t\t\t\t\t\t\\\n\t\t\t \t\t\t\\\n\t\t\tBPF_ST_MEM(BPF_DW, BPF_REG_10, -8, operand1),\t\\\n\t\t\t  \\\n\t\t\tBPF_MOV64_REG(dst_reg, BPF_REG_10),\t\t\\\n\t\t\tBPF_MOV64_IMM(src_reg, operand2),\t\t\\\n\t\t\tBPF_ATOMIC_OP(BPF_DW, op,\t\t\t\\\n\t\t\t\t      dst_reg, src_reg, -8),\t\t\\\n\t\t\t \t\t\\\n\t\t\tBPF_JMP_IMM(BPF_JEQ, src_reg, operand1, 2),\t\\\n\t\t\tBPF_MOV64_IMM(BPF_REG_0, 1),\t\t\t\\\n\t\t\tBPF_EXIT_INSN(),\t\t\t\t\\\n\t\t\t \t\t\\\n\t\t\tBPF_LDX_MEM(BPF_DW, BPF_REG_1, BPF_REG_10, -8),\t\\\n\t\t\tBPF_JMP_IMM(BPF_JEQ, BPF_REG_1, expect, 2),\t\\\n\t\t\tBPF_MOV64_IMM(BPF_REG_0, 2),\t\t\t\\\n\t\t\tBPF_EXIT_INSN(),\t\t\t\t\\\n\t\t\t \t\t\t\t\t\\\n\t\t\tBPF_MOV64_IMM(BPF_REG_0, 0),\t\t\t\\\n\t\t\tBPF_EXIT_INSN(),\t\t\t\t\\\n\t\t},\t\t\t\t\t\t\t\\\n\t\t.result = ACCEPT,\t\t\t\t\t\\\n\t}\n__ATOMIC_FETCH_OP_TEST(BPF_REG_1, BPF_REG_2, 1, BPF_ADD | BPF_FETCH, 2, 3),\n__ATOMIC_FETCH_OP_TEST(BPF_REG_0, BPF_REG_1, 1, BPF_ADD | BPF_FETCH, 2, 3),\n__ATOMIC_FETCH_OP_TEST(BPF_REG_1, BPF_REG_0, 1, BPF_ADD | BPF_FETCH, 2, 3),\n__ATOMIC_FETCH_OP_TEST(BPF_REG_2, BPF_REG_3, 1, BPF_ADD | BPF_FETCH, 2, 3),\n__ATOMIC_FETCH_OP_TEST(BPF_REG_4, BPF_REG_5, 1, BPF_ADD | BPF_FETCH, 2, 3),\n__ATOMIC_FETCH_OP_TEST(BPF_REG_9, BPF_REG_8, 1, BPF_ADD | BPF_FETCH, 2, 3),\n__ATOMIC_FETCH_OP_TEST(BPF_REG_1, BPF_REG_2, 0x010, BPF_AND | BPF_FETCH, 0x011, 0x010),\n__ATOMIC_FETCH_OP_TEST(BPF_REG_0, BPF_REG_1, 0x010, BPF_AND | BPF_FETCH, 0x011, 0x010),\n__ATOMIC_FETCH_OP_TEST(BPF_REG_1, BPF_REG_0, 0x010, BPF_AND | BPF_FETCH, 0x011, 0x010),\n__ATOMIC_FETCH_OP_TEST(BPF_REG_2, BPF_REG_3, 0x010, BPF_AND | BPF_FETCH, 0x011, 0x010),\n__ATOMIC_FETCH_OP_TEST(BPF_REG_4, BPF_REG_5, 0x010, BPF_AND | BPF_FETCH, 0x011, 0x010),\n__ATOMIC_FETCH_OP_TEST(BPF_REG_9, BPF_REG_8, 0x010, BPF_AND | BPF_FETCH, 0x011, 0x010),\n__ATOMIC_FETCH_OP_TEST(BPF_REG_1, BPF_REG_2, 0x010, BPF_OR | BPF_FETCH, 0x011, 0x011),\n__ATOMIC_FETCH_OP_TEST(BPF_REG_0, BPF_REG_1, 0x010, BPF_OR | BPF_FETCH, 0x011, 0x011),\n__ATOMIC_FETCH_OP_TEST(BPF_REG_1, BPF_REG_0, 0x010, BPF_OR | BPF_FETCH, 0x011, 0x011),\n__ATOMIC_FETCH_OP_TEST(BPF_REG_2, BPF_REG_3, 0x010, BPF_OR | BPF_FETCH, 0x011, 0x011),\n__ATOMIC_FETCH_OP_TEST(BPF_REG_4, BPF_REG_5, 0x010, BPF_OR | BPF_FETCH, 0x011, 0x011),\n__ATOMIC_FETCH_OP_TEST(BPF_REG_9, BPF_REG_8, 0x010, BPF_OR | BPF_FETCH, 0x011, 0x011),\n__ATOMIC_FETCH_OP_TEST(BPF_REG_1, BPF_REG_2, 0x010, BPF_XOR | BPF_FETCH, 0x011, 0x001),\n__ATOMIC_FETCH_OP_TEST(BPF_REG_0, BPF_REG_1, 0x010, BPF_XOR | BPF_FETCH, 0x011, 0x001),\n__ATOMIC_FETCH_OP_TEST(BPF_REG_1, BPF_REG_0, 0x010, BPF_XOR | BPF_FETCH, 0x011, 0x001),\n__ATOMIC_FETCH_OP_TEST(BPF_REG_2, BPF_REG_3, 0x010, BPF_XOR | BPF_FETCH, 0x011, 0x001),\n__ATOMIC_FETCH_OP_TEST(BPF_REG_4, BPF_REG_5, 0x010, BPF_XOR | BPF_FETCH, 0x011, 0x001),\n__ATOMIC_FETCH_OP_TEST(BPF_REG_9, BPF_REG_8, 0x010, BPF_XOR | BPF_FETCH, 0x011, 0x001),\n__ATOMIC_FETCH_OP_TEST(BPF_REG_1, BPF_REG_2, 0x010, BPF_XCHG, 0x011, 0x011),\n__ATOMIC_FETCH_OP_TEST(BPF_REG_0, BPF_REG_1, 0x010, BPF_XCHG, 0x011, 0x011),\n__ATOMIC_FETCH_OP_TEST(BPF_REG_1, BPF_REG_0, 0x010, BPF_XCHG, 0x011, 0x011),\n__ATOMIC_FETCH_OP_TEST(BPF_REG_2, BPF_REG_3, 0x010, BPF_XCHG, 0x011, 0x011),\n__ATOMIC_FETCH_OP_TEST(BPF_REG_4, BPF_REG_5, 0x010, BPF_XCHG, 0x011, 0x011),\n__ATOMIC_FETCH_OP_TEST(BPF_REG_9, BPF_REG_8, 0x010, BPF_XCHG, 0x011, 0x011),\n#undef __ATOMIC_FETCH_OP_TEST\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}