{
  "module_name": "atomic_cmpxchg.c",
  "hash_id": "d3bf1b4493ffb4bf843703d753cbaf8365d916b78002799025783cd265192d91",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/bpf/verifier/atomic_cmpxchg.c",
  "human_readable_source": "{\n\t\"atomic compare-and-exchange smoketest - 64bit\",\n\t.insns = {\n\t\t \n\t\tBPF_ST_MEM(BPF_DW, BPF_REG_10, -8, 3),\n\t\t \n\t\tBPF_MOV64_IMM(BPF_REG_1, 4),\n\t\tBPF_MOV64_IMM(BPF_REG_0, 2),\n\t\tBPF_ATOMIC_OP(BPF_DW, BPF_CMPXCHG, BPF_REG_10, BPF_REG_1, -8),\n\t\t \n\t\tBPF_JMP_IMM(BPF_JEQ, BPF_REG_0, 3, 2),\n\t\tBPF_MOV64_IMM(BPF_REG_0, 2),\n\t\tBPF_EXIT_INSN(),\n\t\t \n\t\tBPF_LDX_MEM(BPF_DW, BPF_REG_0, BPF_REG_10, -8),\n\t\tBPF_JMP_IMM(BPF_JEQ, BPF_REG_0, 3, 2),\n\t\tBPF_MOV64_IMM(BPF_REG_0, 3),\n\t\tBPF_EXIT_INSN(),\n\t\t \n\t\tBPF_MOV64_IMM(BPF_REG_1, 4),\n\t\tBPF_MOV64_IMM(BPF_REG_0, 3),\n\t\tBPF_ATOMIC_OP(BPF_DW, BPF_CMPXCHG, BPF_REG_10, BPF_REG_1, -8),\n\t\t \n\t\tBPF_JMP_IMM(BPF_JEQ, BPF_REG_0, 3, 2),\n\t\tBPF_MOV64_IMM(BPF_REG_0, 4),\n\t\tBPF_EXIT_INSN(),\n\t\t \n\t\tBPF_LDX_MEM(BPF_DW, BPF_REG_0, BPF_REG_10, -8),\n\t\tBPF_JMP_IMM(BPF_JEQ, BPF_REG_0, 4, 2),\n\t\tBPF_MOV64_IMM(BPF_REG_0, 5),\n\t\tBPF_EXIT_INSN(),\n\t\t \n\t\tBPF_MOV64_IMM(BPF_REG_0, 0),\n\t\tBPF_EXIT_INSN(),\n\t},\n\t.result = ACCEPT,\n},\n{\n\t\"atomic compare-and-exchange smoketest - 32bit\",\n\t.insns = {\n\t\t \n\t\tBPF_ST_MEM(BPF_W, BPF_REG_10, -4, 3),\n\t\t \n\t\tBPF_MOV32_IMM(BPF_REG_1, 4),\n\t\tBPF_MOV32_IMM(BPF_REG_0, 2),\n\t\tBPF_ATOMIC_OP(BPF_W, BPF_CMPXCHG, BPF_REG_10, BPF_REG_1, -4),\n\t\t \n\t\tBPF_JMP32_IMM(BPF_JEQ, BPF_REG_0, 3, 2),\n\t\tBPF_MOV32_IMM(BPF_REG_0, 2),\n\t\tBPF_EXIT_INSN(),\n\t\t \n\t\tBPF_LDX_MEM(BPF_W, BPF_REG_0, BPF_REG_10, -4),\n\t\tBPF_JMP32_IMM(BPF_JEQ, BPF_REG_0, 3, 2),\n\t\tBPF_MOV32_IMM(BPF_REG_0, 3),\n\t\tBPF_EXIT_INSN(),\n\t\t \n\t\tBPF_MOV32_IMM(BPF_REG_1, 4),\n\t\tBPF_MOV32_IMM(BPF_REG_0, 3),\n\t\tBPF_ATOMIC_OP(BPF_W, BPF_CMPXCHG, BPF_REG_10, BPF_REG_1, -4),\n\t\t \n\t\tBPF_JMP32_IMM(BPF_JEQ, BPF_REG_0, 3, 2),\n\t\tBPF_MOV32_IMM(BPF_REG_0, 4),\n\t\tBPF_EXIT_INSN(),\n\t\t \n\t\tBPF_LDX_MEM(BPF_W, BPF_REG_0, BPF_REG_10, -4),\n\t\tBPF_JMP32_IMM(BPF_JEQ, BPF_REG_0, 4, 2),\n\t\tBPF_MOV32_IMM(BPF_REG_0, 5),\n\t\tBPF_EXIT_INSN(),\n\t\t \n\t\tBPF_MOV32_IMM(BPF_REG_0, 0),\n\t\tBPF_EXIT_INSN(),\n\t},\n\t.result = ACCEPT,\n},\n{\n\t\"Can't use cmpxchg on uninit src reg\",\n\t.insns = {\n\t\tBPF_ST_MEM(BPF_DW, BPF_REG_10, -8, 3),\n\t\tBPF_MOV64_IMM(BPF_REG_0, 3),\n\t\tBPF_ATOMIC_OP(BPF_DW, BPF_CMPXCHG, BPF_REG_10, BPF_REG_2, -8),\n\t\tBPF_EXIT_INSN(),\n\t},\n\t.result = REJECT,\n\t.errstr = \"!read_ok\",\n},\n{\n\t\"BPF_W cmpxchg should zero top 32 bits\",\n\t.insns = {\n\t\t \n\t\tBPF_MOV64_IMM(BPF_REG_0, 0),\n\t\tBPF_ALU64_IMM(BPF_SUB, BPF_REG_0, 1),\n\t\t \n\t\tBPF_STX_MEM(BPF_DW, BPF_REG_10, BPF_REG_0, -8),\n\t\t \n\t\tBPF_MOV32_IMM(BPF_REG_1, 1),\n\t\tBPF_ATOMIC_OP(BPF_W, BPF_CMPXCHG, BPF_REG_10, BPF_REG_1, -8),\n\t\t \n\t\tBPF_MOV64_IMM(BPF_REG_1, 1),\n\t\tBPF_ALU64_IMM(BPF_LSH, BPF_REG_1, 32),\n\t\tBPF_ALU64_IMM(BPF_SUB, BPF_REG_1, 1),\n\t\t \n\t\tBPF_JMP_REG(BPF_JEQ, BPF_REG_0, BPF_REG_1, 2),\n\t\tBPF_MOV32_IMM(BPF_REG_0, 1),\n\t\tBPF_EXIT_INSN(),\n\t\t \n\t\tBPF_MOV32_IMM(BPF_REG_0, 0),\n\t\tBPF_EXIT_INSN(),\n\t},\n\t.result = ACCEPT,\n},\n{\n\t\"Dest pointer in r0 - fail\",\n\t.insns = {\n\t\t \n\t\tBPF_ST_MEM(BPF_DW, BPF_REG_10, -8, 0),\n\t\t \n\t\tBPF_MOV64_REG(BPF_REG_0, BPF_REG_10),\n\t\t \n\t\tBPF_MOV64_IMM(BPF_REG_1, 1),\n\t\tBPF_ATOMIC_OP(BPF_DW, BPF_CMPXCHG, BPF_REG_10, BPF_REG_1, -8),\n\t\t \n\t\tBPF_JMP_IMM(BPF_JEQ, BPF_REG_0, 0, 2),\n\t\tBPF_MOV64_IMM(BPF_REG_0, 1),\n\t\tBPF_EXIT_INSN(),\n\t\t \n\t\tBPF_MOV64_IMM(BPF_REG_0, 0),\n\t\tBPF_EXIT_INSN(),\n\t},\n\t.result = ACCEPT,\n\t.result_unpriv = REJECT,\n\t.errstr_unpriv = \"R0 leaks addr into mem\",\n},\n{\n\t\"Dest pointer in r0 - succeed\",\n\t.insns = {\n\t\t \n\t\tBPF_MOV64_REG(BPF_REG_0, BPF_REG_10),\n\t\t \n\t\tBPF_STX_MEM(BPF_DW, BPF_REG_10, BPF_REG_0, -8),\n\t\t \n\t\tBPF_MOV64_IMM(BPF_REG_1, 0),\n\t\tBPF_ATOMIC_OP(BPF_DW, BPF_CMPXCHG, BPF_REG_10, BPF_REG_1, -8),\n\t\t \n\t\tBPF_LDX_MEM(BPF_DW, BPF_REG_1, BPF_REG_0, -8),\n\t\t \n\t\tBPF_MOV64_IMM(BPF_REG_0, 0),\n\t\tBPF_EXIT_INSN(),\n\t},\n\t.result = ACCEPT,\n\t.result_unpriv = REJECT,\n\t.errstr_unpriv = \"R0 leaks addr into mem\",\n},\n{\n\t\"Dest pointer in r0 - succeed, check 2\",\n\t.insns = {\n\t\t \n\t\tBPF_MOV64_REG(BPF_REG_0, BPF_REG_10),\n\t\t \n\t\tBPF_STX_MEM(BPF_DW, BPF_REG_10, BPF_REG_0, -8),\n\t\t \n\t\tBPF_MOV64_REG(BPF_REG_5, BPF_REG_10),\n\t\t \n\t\tBPF_ATOMIC_OP(BPF_DW, BPF_CMPXCHG, BPF_REG_10, BPF_REG_5, -8),\n\t\t \n\t\tBPF_LDX_MEM(BPF_DW, BPF_REG_1, BPF_REG_0, -8),\n\t\t \n\t\tBPF_MOV64_IMM(BPF_REG_0, 0),\n\t\tBPF_EXIT_INSN(),\n\t},\n\t.result = ACCEPT,\n\t.result_unpriv = REJECT,\n\t.errstr_unpriv = \"R0 leaks addr into mem\",\n},\n{\n\t\"Dest pointer in r0 - succeed, check 3\",\n\t.insns = {\n\t\t \n\t\tBPF_MOV64_REG(BPF_REG_0, BPF_REG_10),\n\t\t \n\t\tBPF_STX_MEM(BPF_DW, BPF_REG_10, BPF_REG_0, -8),\n\t\t \n\t\tBPF_MOV64_REG(BPF_REG_5, BPF_REG_10),\n\t\t \n\t\tBPF_ATOMIC_OP(BPF_W, BPF_CMPXCHG, BPF_REG_10, BPF_REG_5, -8),\n\t\t \n\t\tBPF_MOV64_IMM(BPF_REG_0, 0),\n\t\tBPF_EXIT_INSN(),\n\t},\n\t.result = REJECT,\n\t.errstr = \"invalid size of register fill\",\n\t.errstr_unpriv = \"R0 leaks addr into mem\",\n},\n{\n\t\"Dest pointer in r0 - succeed, check 4\",\n\t.insns = {\n\t\t \n\t\tBPF_MOV32_REG(BPF_REG_0, BPF_REG_10),\n\t\t \n\t\tBPF_STX_MEM(BPF_W, BPF_REG_10, BPF_REG_0, -8),\n\t\t \n\t\tBPF_MOV32_REG(BPF_REG_5, BPF_REG_10),\n\t\t \n\t\tBPF_ATOMIC_OP(BPF_W, BPF_CMPXCHG, BPF_REG_10, BPF_REG_5, -8),\n\t\t \n\t\tBPF_LDX_MEM(BPF_W, BPF_REG_1, BPF_REG_10, -8),\n\t\t \n\t\tBPF_MOV64_IMM(BPF_REG_0, 0),\n\t\tBPF_EXIT_INSN(),\n\t},\n\t.result = ACCEPT,\n\t.result_unpriv = REJECT,\n\t.errstr_unpriv = \"R10 partial copy of pointer\",\n},\n{\n\t\"Dest pointer in r0 - succeed, check 5\",\n\t.insns = {\n\t\t \n\t\tBPF_MOV32_REG(BPF_REG_0, BPF_REG_10),\n\t\t \n\t\tBPF_STX_MEM(BPF_W, BPF_REG_10, BPF_REG_0, -8),\n\t\t \n\t\tBPF_MOV32_REG(BPF_REG_5, BPF_REG_10),\n\t\t \n\t\tBPF_ATOMIC_OP(BPF_W, BPF_CMPXCHG, BPF_REG_10, BPF_REG_5, -8),\n\t\t \n\t\tBPF_LDX_MEM(BPF_W, BPF_REG_1, BPF_REG_0, -8),\n\t\t \n\t\tBPF_MOV64_IMM(BPF_REG_0, 0),\n\t\tBPF_EXIT_INSN(),\n\t},\n\t.result = REJECT,\n\t.errstr = \"R0 invalid mem access\",\n\t.errstr_unpriv = \"R10 partial copy of pointer\",\n\t.flags = F_NEEDS_EFFICIENT_UNALIGNED_ACCESS,\n},\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}