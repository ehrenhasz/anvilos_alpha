{
  "module_name": "flow_dissector_load.c",
  "hash_id": "dab2f49166c60e601fc5fdbf332cd877d75b3ecde8ea22775bde1a9b420371d0",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/bpf/flow_dissector_load.c",
  "human_readable_source": "\n#include <error.h>\n#include <errno.h>\n#include <getopt.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <bpf/bpf.h>\n#include <bpf/libbpf.h>\n\n#include \"flow_dissector_load.h\"\n\nconst char *cfg_pin_path = \"/sys/fs/bpf/flow_dissector\";\nconst char *cfg_map_name = \"jmp_table\";\nbool cfg_attach = true;\nchar *cfg_prog_name;\nchar *cfg_path_name;\n\nstatic void load_and_attach_program(void)\n{\n\tint prog_fd, ret;\n\tstruct bpf_object *obj;\n\n\t \n\tlibbpf_set_strict_mode(LIBBPF_STRICT_ALL);\n\n\tret = bpf_flow_load(&obj, cfg_path_name, cfg_prog_name,\n\t\t\t    cfg_map_name, NULL, &prog_fd, NULL);\n\tif (ret)\n\t\terror(1, 0, \"bpf_flow_load %s\", cfg_path_name);\n\n\tret = bpf_prog_attach(prog_fd, 0  , BPF_FLOW_DISSECTOR, 0);\n\tif (ret)\n\t\terror(1, 0, \"bpf_prog_attach %s\", cfg_path_name);\n\n\tret = bpf_object__pin(obj, cfg_pin_path);\n\tif (ret)\n\t\terror(1, 0, \"bpf_object__pin %s\", cfg_pin_path);\n}\n\nstatic void detach_program(void)\n{\n\tchar command[64];\n\tint ret;\n\n\tret = bpf_prog_detach(0, BPF_FLOW_DISSECTOR);\n\tif (ret)\n\t\terror(1, 0, \"bpf_prog_detach\");\n\n\t \n\tsprintf(command, \"rm -r %s\", cfg_pin_path);\n\tret = system(command);\n\tif (ret)\n\t\terror(1, errno, \"%s\", command);\n}\n\nstatic void parse_opts(int argc, char **argv)\n{\n\tbool attach = false;\n\tbool detach = false;\n\tint c;\n\n\twhile ((c = getopt(argc, argv, \"adp:s:\")) != -1) {\n\t\tswitch (c) {\n\t\tcase 'a':\n\t\t\tif (detach)\n\t\t\t\terror(1, 0, \"attach/detach are exclusive\");\n\t\t\tattach = true;\n\t\t\tbreak;\n\t\tcase 'd':\n\t\t\tif (attach)\n\t\t\t\terror(1, 0, \"attach/detach are exclusive\");\n\t\t\tdetach = true;\n\t\t\tbreak;\n\t\tcase 'p':\n\t\t\tif (cfg_path_name)\n\t\t\t\terror(1, 0, \"only one path can be given\");\n\n\t\t\tcfg_path_name = optarg;\n\t\t\tbreak;\n\t\tcase 's':\n\t\t\tif (cfg_prog_name)\n\t\t\t\terror(1, 0, \"only one prog can be given\");\n\n\t\t\tcfg_prog_name = optarg;\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tif (detach)\n\t\tcfg_attach = false;\n\n\tif (cfg_attach && !cfg_path_name)\n\t\terror(1, 0, \"must provide a path to the BPF program\");\n\n\tif (cfg_attach && !cfg_prog_name)\n\t\terror(1, 0, \"must provide a section name\");\n}\n\nint main(int argc, char **argv)\n{\n\tparse_opts(argc, argv);\n\tif (cfg_attach)\n\t\tload_and_attach_program();\n\telse\n\t\tdetach_program();\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}