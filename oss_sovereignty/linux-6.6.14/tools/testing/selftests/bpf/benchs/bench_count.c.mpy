{
  "module_name": "bench_count.c",
  "hash_id": "30e434671dbbf5796986f21a5b8fddbe2c33c8bd02f21ee3ecc3d220d013bd8a",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/bpf/benchs/bench_count.c",
  "human_readable_source": "\n \n#include \"bench.h\"\n\n \n\nstatic struct count_global_ctx {\n\tstruct counter hits;\n} count_global_ctx;\n\nstatic void *count_global_producer(void *input)\n{\n\tstruct count_global_ctx *ctx = &count_global_ctx;\n\n\twhile (true) {\n\t\tatomic_inc(&ctx->hits.value);\n\t}\n\treturn NULL;\n}\n\nstatic void count_global_measure(struct bench_res *res)\n{\n\tstruct count_global_ctx *ctx = &count_global_ctx;\n\n\tres->hits = atomic_swap(&ctx->hits.value, 0);\n}\n\n \n\nstatic struct count_local_ctx {\n\tstruct counter *hits;\n} count_local_ctx;\n\nstatic void count_local_setup(void)\n{\n\tstruct count_local_ctx *ctx = &count_local_ctx;\n\n\tctx->hits = calloc(env.producer_cnt, sizeof(*ctx->hits));\n\tif (!ctx->hits)\n\t\texit(1);\n}\n\nstatic void *count_local_producer(void *input)\n{\n\tstruct count_local_ctx *ctx = &count_local_ctx;\n\tint idx = (long)input;\n\n\twhile (true) {\n\t\tatomic_inc(&ctx->hits[idx].value);\n\t}\n\treturn NULL;\n}\n\nstatic void count_local_measure(struct bench_res *res)\n{\n\tstruct count_local_ctx *ctx = &count_local_ctx;\n\tint i;\n\n\tfor (i = 0; i < env.producer_cnt; i++) {\n\t\tres->hits += atomic_swap(&ctx->hits[i].value, 0);\n\t}\n}\n\nconst struct bench bench_count_global = {\n\t.name = \"count-global\",\n\t.producer_thread = count_global_producer,\n\t.measure = count_global_measure,\n\t.report_progress = hits_drops_report_progress,\n\t.report_final = hits_drops_report_final,\n};\n\nconst struct bench bench_count_local = {\n\t.name = \"count-local\",\n\t.setup = count_local_setup,\n\t.producer_thread = count_local_producer,\n\t.measure = count_local_measure,\n\t.report_progress = hits_drops_report_progress,\n\t.report_final = hits_drops_report_final,\n};\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}