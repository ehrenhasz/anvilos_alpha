{
  "module_name": "json_writer.c",
  "hash_id": "838a74d6691d94221f44ad46182944ec232209db72b9d977d04929559e3566b7",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/bpf/json_writer.c",
  "human_readable_source": "\n \n\n#include <stdio.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <assert.h>\n#include <malloc.h>\n#include <inttypes.h>\n#include <stdint.h>\n\n#include \"json_writer.h\"\n\nstruct json_writer {\n\tFILE\t\t*out;\t \n\tunsigned\tdepth;   \n\tbool\t\tpretty;  \n\tchar\t\tsep;\t \n};\n\n \nstatic void jsonw_indent(json_writer_t *self)\n{\n\tunsigned i;\n\tfor (i = 0; i < self->depth; ++i)\n\t\tfputs(\"    \", self->out);\n}\n\n \nstatic void jsonw_eol(json_writer_t *self)\n{\n\tif (!self->pretty)\n\t\treturn;\n\n\tputc('\\n', self->out);\n\tjsonw_indent(self);\n}\n\n \nstatic void jsonw_eor(json_writer_t *self)\n{\n\tif (self->sep != '\\0')\n\t\tputc(self->sep, self->out);\n\tself->sep = ',';\n}\n\n\n \n \nstatic void jsonw_puts(json_writer_t *self, const char *str)\n{\n\tputc('\"', self->out);\n\tfor (; *str; ++str)\n\t\tswitch (*str) {\n\t\tcase '\\t':\n\t\t\tfputs(\"\\\\t\", self->out);\n\t\t\tbreak;\n\t\tcase '\\n':\n\t\t\tfputs(\"\\\\n\", self->out);\n\t\t\tbreak;\n\t\tcase '\\r':\n\t\t\tfputs(\"\\\\r\", self->out);\n\t\t\tbreak;\n\t\tcase '\\f':\n\t\t\tfputs(\"\\\\f\", self->out);\n\t\t\tbreak;\n\t\tcase '\\b':\n\t\t\tfputs(\"\\\\b\", self->out);\n\t\t\tbreak;\n\t\tcase '\\\\':\n\t\t\tfputs(\"\\\\\\\\\", self->out);\n\t\t\tbreak;\n\t\tcase '\"':\n\t\t\tfputs(\"\\\\\\\"\", self->out);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tputc(*str, self->out);\n\t\t}\n\tputc('\"', self->out);\n}\n\n \njson_writer_t *jsonw_new(FILE *f)\n{\n\tjson_writer_t *self = malloc(sizeof(*self));\n\tif (self) {\n\t\tself->out = f;\n\t\tself->depth = 0;\n\t\tself->pretty = false;\n\t\tself->sep = '\\0';\n\t}\n\treturn self;\n}\n\n \nvoid jsonw_destroy(json_writer_t **self_p)\n{\n\tjson_writer_t *self = *self_p;\n\n\tassert(self->depth == 0);\n\tfputs(\"\\n\", self->out);\n\tfflush(self->out);\n\tfree(self);\n\t*self_p = NULL;\n}\n\nvoid jsonw_pretty(json_writer_t *self, bool on)\n{\n\tself->pretty = on;\n}\n\nvoid jsonw_reset(json_writer_t *self)\n{\n\tassert(self->depth == 0);\n\tself->sep = '\\0';\n}\n\n \nstatic void jsonw_begin(json_writer_t *self, int c)\n{\n\tjsonw_eor(self);\n\tputc(c, self->out);\n\t++self->depth;\n\tself->sep = '\\0';\n}\n\nstatic void jsonw_end(json_writer_t *self, int c)\n{\n\tassert(self->depth > 0);\n\n\t--self->depth;\n\tif (self->sep != '\\0')\n\t\tjsonw_eol(self);\n\tputc(c, self->out);\n\tself->sep = ',';\n}\n\n\n \nvoid jsonw_name(json_writer_t *self, const char *name)\n{\n\tjsonw_eor(self);\n\tjsonw_eol(self);\n\tself->sep = '\\0';\n\tjsonw_puts(self, name);\n\tputc(':', self->out);\n\tif (self->pretty)\n\t\tputc(' ', self->out);\n}\n\nvoid jsonw_vprintf_enquote(json_writer_t *self, const char *fmt, va_list ap)\n{\n\tjsonw_eor(self);\n\tputc('\"', self->out);\n\tvfprintf(self->out, fmt, ap);\n\tputc('\"', self->out);\n}\n\nvoid jsonw_printf(json_writer_t *self, const char *fmt, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, fmt);\n\tjsonw_eor(self);\n\tvfprintf(self->out, fmt, ap);\n\tva_end(ap);\n}\n\n \nvoid jsonw_start_object(json_writer_t *self)\n{\n\tjsonw_begin(self, '{');\n}\n\nvoid jsonw_end_object(json_writer_t *self)\n{\n\tjsonw_end(self, '}');\n}\n\nvoid jsonw_start_array(json_writer_t *self)\n{\n\tjsonw_begin(self, '[');\n}\n\nvoid jsonw_end_array(json_writer_t *self)\n{\n\tjsonw_end(self, ']');\n}\n\n \nvoid jsonw_string(json_writer_t *self, const char *value)\n{\n\tjsonw_eor(self);\n\tjsonw_puts(self, value);\n}\n\nvoid jsonw_bool(json_writer_t *self, bool val)\n{\n\tjsonw_printf(self, \"%s\", val ? \"true\" : \"false\");\n}\n\nvoid jsonw_null(json_writer_t *self)\n{\n\tjsonw_printf(self, \"null\");\n}\n\nvoid jsonw_float_fmt(json_writer_t *self, const char *fmt, double num)\n{\n\tjsonw_printf(self, fmt, num);\n}\n\n#ifdef notused\nvoid jsonw_float(json_writer_t *self, double num)\n{\n\tjsonw_printf(self, \"%g\", num);\n}\n#endif\n\nvoid jsonw_hu(json_writer_t *self, unsigned short num)\n{\n\tjsonw_printf(self, \"%hu\", num);\n}\n\nvoid jsonw_uint(json_writer_t *self, uint64_t num)\n{\n\tjsonw_printf(self, \"%\"PRIu64, num);\n}\n\nvoid jsonw_lluint(json_writer_t *self, unsigned long long int num)\n{\n\tjsonw_printf(self, \"%llu\", num);\n}\n\nvoid jsonw_int(json_writer_t *self, int64_t num)\n{\n\tjsonw_printf(self, \"%\"PRId64, num);\n}\n\n \nvoid jsonw_string_field(json_writer_t *self, const char *prop, const char *val)\n{\n\tjsonw_name(self, prop);\n\tjsonw_string(self, val);\n}\n\nvoid jsonw_bool_field(json_writer_t *self, const char *prop, bool val)\n{\n\tjsonw_name(self, prop);\n\tjsonw_bool(self, val);\n}\n\n#ifdef notused\nvoid jsonw_float_field(json_writer_t *self, const char *prop, double val)\n{\n\tjsonw_name(self, prop);\n\tjsonw_float(self, val);\n}\n#endif\n\nvoid jsonw_float_field_fmt(json_writer_t *self,\n\t\t\t   const char *prop,\n\t\t\t   const char *fmt,\n\t\t\t   double val)\n{\n\tjsonw_name(self, prop);\n\tjsonw_float_fmt(self, fmt, val);\n}\n\nvoid jsonw_uint_field(json_writer_t *self, const char *prop, uint64_t num)\n{\n\tjsonw_name(self, prop);\n\tjsonw_uint(self, num);\n}\n\nvoid jsonw_hu_field(json_writer_t *self, const char *prop, unsigned short num)\n{\n\tjsonw_name(self, prop);\n\tjsonw_hu(self, num);\n}\n\nvoid jsonw_lluint_field(json_writer_t *self,\n\t\t\tconst char *prop,\n\t\t\tunsigned long long int num)\n{\n\tjsonw_name(self, prop);\n\tjsonw_lluint(self, num);\n}\n\nvoid jsonw_int_field(json_writer_t *self, const char *prop, int64_t num)\n{\n\tjsonw_name(self, prop);\n\tjsonw_int(self, num);\n}\n\nvoid jsonw_null_field(json_writer_t *self, const char *prop)\n{\n\tjsonw_name(self, prop);\n\tjsonw_null(self);\n}\n\n#ifdef TEST\nint main(int argc, char **argv)\n{\n\tjson_writer_t *wr = jsonw_new(stdout);\n\n\tjsonw_start_object(wr);\n\tjsonw_pretty(wr, true);\n\tjsonw_name(wr, \"Vyatta\");\n\tjsonw_start_object(wr);\n\tjsonw_string_field(wr, \"url\", \"http://vyatta.com\");\n\tjsonw_uint_field(wr, \"downloads\", 2000000ul);\n\tjsonw_float_field(wr, \"stock\", 8.16);\n\n\tjsonw_name(wr, \"ARGV\");\n\tjsonw_start_array(wr);\n\twhile (--argc)\n\t\tjsonw_string(wr, *++argv);\n\tjsonw_end_array(wr);\n\n\tjsonw_name(wr, \"empty\");\n\tjsonw_start_array(wr);\n\tjsonw_end_array(wr);\n\n\tjsonw_name(wr, \"NIL\");\n\tjsonw_start_object(wr);\n\tjsonw_end_object(wr);\n\n\tjsonw_null_field(wr, \"my_null\");\n\n\tjsonw_name(wr, \"special chars\");\n\tjsonw_start_array(wr);\n\tjsonw_string_field(wr, \"slash\", \"/\");\n\tjsonw_string_field(wr, \"newline\", \"\\n\");\n\tjsonw_string_field(wr, \"tab\", \"\\t\");\n\tjsonw_string_field(wr, \"ff\", \"\\f\");\n\tjsonw_string_field(wr, \"quote\", \"\\\"\");\n\tjsonw_string_field(wr, \"tick\", \"\\'\");\n\tjsonw_string_field(wr, \"backslash\", \"\\\\\");\n\tjsonw_end_array(wr);\n\n\tjsonw_end_object(wr);\n\n\tjsonw_end_object(wr);\n\tjsonw_destroy(&wr);\n\treturn 0;\n}\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}