{
  "module_name": "xdp.c",
  "hash_id": "2e76000f09d6bdd1eee00b29a2a40d3c10a69d16ad2eaf40ef9a968d314eb50e",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/bpf/prog_tests/xdp.c",
  "human_readable_source": "\n#include <test_progs.h>\n#include <network_helpers.h>\n\nvoid test_xdp(void)\n{\n\tstruct vip key4 = {.protocol = 6, .family = AF_INET};\n\tstruct vip key6 = {.protocol = 6, .family = AF_INET6};\n\tstruct iptnl_info value4 = {.family = AF_INET};\n\tstruct iptnl_info value6 = {.family = AF_INET6};\n\tconst char *file = \"./test_xdp.bpf.o\";\n\tstruct bpf_object *obj;\n\tchar buf[128];\n\tstruct ipv6hdr iph6;\n\tstruct iphdr iph;\n\tint err, prog_fd, map_fd;\n\tLIBBPF_OPTS(bpf_test_run_opts, topts,\n\t\t.data_in = &pkt_v4,\n\t\t.data_size_in = sizeof(pkt_v4),\n\t\t.data_out = buf,\n\t\t.data_size_out = sizeof(buf),\n\t\t.repeat = 1,\n\t);\n\n\terr = bpf_prog_test_load(file, BPF_PROG_TYPE_XDP, &obj, &prog_fd);\n\tif (CHECK_FAIL(err))\n\t\treturn;\n\n\tmap_fd = bpf_find_map(__func__, obj, \"vip2tnl\");\n\tif (map_fd < 0)\n\t\tgoto out;\n\tbpf_map_update_elem(map_fd, &key4, &value4, 0);\n\tbpf_map_update_elem(map_fd, &key6, &value6, 0);\n\n\terr = bpf_prog_test_run_opts(prog_fd, &topts);\n\tmemcpy(&iph, buf + sizeof(struct ethhdr), sizeof(iph));\n\tASSERT_OK(err, \"test_run\");\n\tASSERT_EQ(topts.retval, XDP_TX, \"ipv4 test_run retval\");\n\tASSERT_EQ(topts.data_size_out, 74, \"ipv4 test_run data_size_out\");\n\tASSERT_EQ(iph.protocol, IPPROTO_IPIP, \"ipv4 test_run iph.protocol\");\n\n\ttopts.data_in = &pkt_v6;\n\ttopts.data_size_in = sizeof(pkt_v6);\n\ttopts.data_size_out = sizeof(buf);\n\n\terr = bpf_prog_test_run_opts(prog_fd, &topts);\n\tmemcpy(&iph6, buf + sizeof(struct ethhdr), sizeof(iph6));\n\tASSERT_OK(err, \"test_run\");\n\tASSERT_EQ(topts.retval, XDP_TX, \"ipv6 test_run retval\");\n\tASSERT_EQ(topts.data_size_out, 114, \"ipv6 test_run data_size_out\");\n\tASSERT_EQ(iph6.nexthdr, IPPROTO_IPV6, \"ipv6 test_run iph6.nexthdr\");\nout:\n\tbpf_object__close(obj);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}