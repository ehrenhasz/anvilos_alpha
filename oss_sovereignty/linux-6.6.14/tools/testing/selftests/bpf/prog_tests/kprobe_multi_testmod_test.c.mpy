{
  "module_name": "kprobe_multi_testmod_test.c",
  "hash_id": "4b587370931fa22d07c8b5ca066578f08bdd9306295b9b3427150f165bf3afef",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/bpf/prog_tests/kprobe_multi_testmod_test.c",
  "human_readable_source": "\n#include <test_progs.h>\n#include \"kprobe_multi.skel.h\"\n#include \"trace_helpers.h\"\n#include \"bpf/libbpf_internal.h\"\n\nstatic void kprobe_multi_testmod_check(struct kprobe_multi *skel)\n{\n\tASSERT_EQ(skel->bss->kprobe_testmod_test1_result, 1, \"kprobe_test1_result\");\n\tASSERT_EQ(skel->bss->kprobe_testmod_test2_result, 1, \"kprobe_test2_result\");\n\tASSERT_EQ(skel->bss->kprobe_testmod_test3_result, 1, \"kprobe_test3_result\");\n\n\tASSERT_EQ(skel->bss->kretprobe_testmod_test1_result, 1, \"kretprobe_test1_result\");\n\tASSERT_EQ(skel->bss->kretprobe_testmod_test2_result, 1, \"kretprobe_test2_result\");\n\tASSERT_EQ(skel->bss->kretprobe_testmod_test3_result, 1, \"kretprobe_test3_result\");\n}\n\nstatic void test_testmod_attach_api(struct bpf_kprobe_multi_opts *opts)\n{\n\tstruct kprobe_multi *skel = NULL;\n\n\tskel = kprobe_multi__open_and_load();\n\tif (!ASSERT_OK_PTR(skel, \"fentry_raw_skel_load\"))\n\t\treturn;\n\n\tskel->bss->pid = getpid();\n\n\tskel->links.test_kprobe_testmod = bpf_program__attach_kprobe_multi_opts(\n\t\t\t\t\t\tskel->progs.test_kprobe_testmod,\n\t\t\t\t\t\tNULL, opts);\n\tif (!skel->links.test_kprobe_testmod)\n\t\tgoto cleanup;\n\n\topts->retprobe = true;\n\tskel->links.test_kretprobe_testmod = bpf_program__attach_kprobe_multi_opts(\n\t\t\t\t\t\tskel->progs.test_kretprobe_testmod,\n\t\t\t\t\t\tNULL, opts);\n\tif (!skel->links.test_kretprobe_testmod)\n\t\tgoto cleanup;\n\n\tASSERT_OK(trigger_module_test_read(1), \"trigger_read\");\n\tkprobe_multi_testmod_check(skel);\n\ncleanup:\n\tkprobe_multi__destroy(skel);\n}\n\nstatic void test_testmod_attach_api_addrs(void)\n{\n\tLIBBPF_OPTS(bpf_kprobe_multi_opts, opts);\n\tunsigned long long addrs[3];\n\n\taddrs[0] = ksym_get_addr(\"bpf_testmod_fentry_test1\");\n\tASSERT_NEQ(addrs[0], 0, \"ksym_get_addr\");\n\taddrs[1] = ksym_get_addr(\"bpf_testmod_fentry_test2\");\n\tASSERT_NEQ(addrs[1], 0, \"ksym_get_addr\");\n\taddrs[2] = ksym_get_addr(\"bpf_testmod_fentry_test3\");\n\tASSERT_NEQ(addrs[2], 0, \"ksym_get_addr\");\n\n\topts.addrs = (const unsigned long *) addrs;\n\topts.cnt = ARRAY_SIZE(addrs);\n\n\ttest_testmod_attach_api(&opts);\n}\n\nstatic void test_testmod_attach_api_syms(void)\n{\n\tLIBBPF_OPTS(bpf_kprobe_multi_opts, opts);\n\tconst char *syms[3] = {\n\t\t\"bpf_testmod_fentry_test1\",\n\t\t\"bpf_testmod_fentry_test2\",\n\t\t\"bpf_testmod_fentry_test3\",\n\t};\n\n\topts.syms = syms;\n\topts.cnt = ARRAY_SIZE(syms);\n\ttest_testmod_attach_api(&opts);\n}\n\nvoid serial_test_kprobe_multi_testmod_test(void)\n{\n\tif (!ASSERT_OK(load_kallsyms_refresh(), \"load_kallsyms_refresh\"))\n\t\treturn;\n\n\tif (test__start_subtest(\"testmod_attach_api_syms\"))\n\t\ttest_testmod_attach_api_syms();\n\tif (test__start_subtest(\"testmod_attach_api_addrs\"))\n\t\ttest_testmod_attach_api_addrs();\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}