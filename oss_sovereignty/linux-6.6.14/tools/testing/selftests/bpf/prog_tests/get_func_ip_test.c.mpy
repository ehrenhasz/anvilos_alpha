{
  "module_name": "get_func_ip_test.c",
  "hash_id": "cd339b7d92be9292a92d72f243dc93d457959b12c77f1d89a52221bdcd5d8c97",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/bpf/prog_tests/get_func_ip_test.c",
  "human_readable_source": "\n#include <test_progs.h>\n#include \"get_func_ip_test.skel.h\"\n#include \"get_func_ip_uprobe_test.skel.h\"\n\nstatic noinline void uprobe_trigger(void)\n{\n}\n\nstatic void test_function_entry(void)\n{\n\tstruct get_func_ip_test *skel = NULL;\n\tint err, prog_fd;\n\tLIBBPF_OPTS(bpf_test_run_opts, topts);\n\n\tskel = get_func_ip_test__open();\n\tif (!ASSERT_OK_PTR(skel, \"get_func_ip_test__open\"))\n\t\treturn;\n\n\terr = get_func_ip_test__load(skel);\n\tif (!ASSERT_OK(err, \"get_func_ip_test__load\"))\n\t\tgoto cleanup;\n\n\terr = get_func_ip_test__attach(skel);\n\tif (!ASSERT_OK(err, \"get_func_ip_test__attach\"))\n\t\tgoto cleanup;\n\n\tskel->bss->uprobe_trigger = (unsigned long) uprobe_trigger;\n\n\tprog_fd = bpf_program__fd(skel->progs.test1);\n\terr = bpf_prog_test_run_opts(prog_fd, &topts);\n\tASSERT_OK(err, \"test_run\");\n\tASSERT_EQ(topts.retval, 0, \"test_run\");\n\n\tprog_fd = bpf_program__fd(skel->progs.test5);\n\terr = bpf_prog_test_run_opts(prog_fd, &topts);\n\n\tASSERT_OK(err, \"test_run\");\n\n\tuprobe_trigger();\n\n\tASSERT_EQ(skel->bss->test1_result, 1, \"test1_result\");\n\tASSERT_EQ(skel->bss->test2_result, 1, \"test2_result\");\n\tASSERT_EQ(skel->bss->test3_result, 1, \"test3_result\");\n\tASSERT_EQ(skel->bss->test4_result, 1, \"test4_result\");\n\tASSERT_EQ(skel->bss->test5_result, 1, \"test5_result\");\n\tASSERT_EQ(skel->bss->test7_result, 1, \"test7_result\");\n\tASSERT_EQ(skel->bss->test8_result, 1, \"test8_result\");\n\ncleanup:\n\tget_func_ip_test__destroy(skel);\n}\n\n#ifdef __x86_64__\nextern void uprobe_trigger_body(void);\nasm(\n\".globl uprobe_trigger_body\\n\"\n\".type uprobe_trigger_body, @function\\n\"\n\"uprobe_trigger_body:\\n\"\n\"\tnop\\n\"\n\"\tret\\n\"\n);\n\nstatic void test_function_body_kprobe(void)\n{\n\tstruct get_func_ip_test *skel = NULL;\n\tLIBBPF_OPTS(bpf_test_run_opts, topts);\n\tLIBBPF_OPTS(bpf_kprobe_opts, kopts);\n\tstruct bpf_link *link6 = NULL;\n\tint err, prog_fd;\n\n\tskel = get_func_ip_test__open();\n\tif (!ASSERT_OK_PTR(skel, \"get_func_ip_test__open\"))\n\t\treturn;\n\n\t \n\tbpf_program__set_autoload(skel->progs.test6, true);\n\n\terr = get_func_ip_test__load(skel);\n\tif (!ASSERT_OK(err, \"get_func_ip_test__load\"))\n\t\tgoto cleanup;\n\n\tkopts.offset = skel->kconfig->CONFIG_X86_KERNEL_IBT ? 9 : 5;\n\n\tlink6 = bpf_program__attach_kprobe_opts(skel->progs.test6, \"bpf_fentry_test6\", &kopts);\n\tif (!ASSERT_OK_PTR(link6, \"link6\"))\n\t\tgoto cleanup;\n\n\tprog_fd = bpf_program__fd(skel->progs.test1);\n\terr = bpf_prog_test_run_opts(prog_fd, &topts);\n\tASSERT_OK(err, \"test_run\");\n\tASSERT_EQ(topts.retval, 0, \"test_run\");\n\n\tASSERT_EQ(skel->bss->test6_result, 1, \"test6_result\");\n\ncleanup:\n\tbpf_link__destroy(link6);\n\tget_func_ip_test__destroy(skel);\n}\n\nstatic void test_function_body_uprobe(void)\n{\n\tstruct get_func_ip_uprobe_test *skel = NULL;\n\tint err;\n\n\tskel = get_func_ip_uprobe_test__open_and_load();\n\tif (!ASSERT_OK_PTR(skel, \"get_func_ip_uprobe_test__open_and_load\"))\n\t\treturn;\n\n\terr = get_func_ip_uprobe_test__attach(skel);\n\tif (!ASSERT_OK(err, \"get_func_ip_test__attach\"))\n\t\tgoto cleanup;\n\n\tskel->bss->uprobe_trigger_body = (unsigned long) uprobe_trigger_body;\n\n\tuprobe_trigger_body();\n\n\tASSERT_EQ(skel->bss->test1_result, 1, \"test1_result\");\n\ncleanup:\n\tget_func_ip_uprobe_test__destroy(skel);\n}\n\nstatic void test_function_body(void)\n{\n\ttest_function_body_kprobe();\n\ttest_function_body_uprobe();\n}\n#else\n#define test_function_body()\n#endif\n\nvoid test_get_func_ip_test(void)\n{\n\ttest_function_entry();\n\ttest_function_body();\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}