{
  "module_name": "timer_mim.c",
  "hash_id": "555ca018e468c676e5e4bfe0dc0ff41330e10bda1f28277132fdf28d8a6595aa",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/bpf/prog_tests/timer_mim.c",
  "human_readable_source": "\n \n#include <test_progs.h>\n#include \"timer_mim.skel.h\"\n#include \"timer_mim_reject.skel.h\"\n\nstatic int timer_mim(struct timer_mim *timer_skel)\n{\n\t__u64 cnt1, cnt2;\n\tint err, prog_fd, key1 = 1;\n\tLIBBPF_OPTS(bpf_test_run_opts, topts);\n\n\terr = timer_mim__attach(timer_skel);\n\tif (!ASSERT_OK(err, \"timer_attach\"))\n\t\treturn err;\n\n\tprog_fd = bpf_program__fd(timer_skel->progs.test1);\n\terr = bpf_prog_test_run_opts(prog_fd, &topts);\n\tASSERT_OK(err, \"test_run\");\n\tASSERT_EQ(topts.retval, 0, \"test_run\");\n\ttimer_mim__detach(timer_skel);\n\n\t \n\tcnt1 = READ_ONCE(timer_skel->bss->cnt);\n\tfor (int i = 0; i < 100; i++) {\n\t\tcnt2 = READ_ONCE(timer_skel->bss->cnt);\n\t\tif (cnt2 != cnt1)\n\t\t\tbreak;\n\t\tusleep(200);  \n\t}\n\tASSERT_GT(cnt2, cnt1, \"cnt\");\n\n\tASSERT_EQ(timer_skel->bss->err, 0, \"err\");\n\t \n\tASSERT_EQ(timer_skel->bss->ok, 1 | 2, \"ok\");\n\n\tclose(bpf_map__fd(timer_skel->maps.inner_htab));\n\terr = bpf_map__delete_elem(timer_skel->maps.outer_arr, &key1, sizeof(key1), 0);\n\tASSERT_EQ(err, 0, \"delete inner map\");\n\n\t \n\tcnt1 = READ_ONCE(timer_skel->bss->cnt);\n\tfor (int i = 0; i < 100; i++) {\n\t\tusleep(200);  \n\t\tcnt2 = READ_ONCE(timer_skel->bss->cnt);\n\t\tif (cnt2 == cnt1)\n\t\t\tbreak;\n\t}\n\tASSERT_EQ(cnt2, cnt1, \"cnt\");\n\n\treturn 0;\n}\n\nvoid serial_test_timer_mim(void)\n{\n\tstruct timer_mim_reject *timer_reject_skel = NULL;\n\tlibbpf_print_fn_t old_print_fn = NULL;\n\tstruct timer_mim *timer_skel = NULL;\n\tint err;\n\n\told_print_fn = libbpf_set_print(NULL);\n\ttimer_reject_skel = timer_mim_reject__open_and_load();\n\tlibbpf_set_print(old_print_fn);\n\tif (!ASSERT_ERR_PTR(timer_reject_skel, \"timer_reject_skel_load\"))\n\t\tgoto cleanup;\n\n\ttimer_skel = timer_mim__open_and_load();\n\tif (!ASSERT_OK_PTR(timer_skel, \"timer_skel_load\"))\n\t\tgoto cleanup;\n\n\terr = timer_mim(timer_skel);\n\tASSERT_OK(err, \"timer_mim\");\ncleanup:\n\ttimer_mim__destroy(timer_skel);\n\ttimer_mim_reject__destroy(timer_reject_skel);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}