{
  "module_name": "test_strncmp.c",
  "hash_id": "723efe193001ecf2cc83478877bbd8a22be859747641237cf9fe7aa81551e676",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/bpf/prog_tests/test_strncmp.c",
  "human_readable_source": "\n \n#include <test_progs.h>\n#include \"strncmp_test.skel.h\"\n\nstatic int trigger_strncmp(const struct strncmp_test *skel)\n{\n\tint cmp;\n\n\tusleep(1);\n\n\tcmp = skel->bss->cmp_ret;\n\tif (cmp > 0)\n\t\treturn 1;\n\tif (cmp < 0)\n\t\treturn -1;\n\treturn 0;\n}\n\n \nstatic void strncmp_full_str_cmp(struct strncmp_test *skel, const char *name,\n\t\t\t\t int exp)\n{\n\tsize_t nr = sizeof(skel->bss->str);\n\tchar *str = skel->bss->str;\n\tint delta = exp;\n\tint got;\n\tsize_t i;\n\n\tmemcpy(str, skel->rodata->target, nr);\n\tfor (i = 0; i < nr - 1; i++) {\n\t\tstr[i] += delta;\n\n\t\tgot = trigger_strncmp(skel);\n\t\tASSERT_EQ(got, exp, name);\n\n\t\tstr[i] -= delta;\n\t}\n}\n\nstatic void test_strncmp_ret(void)\n{\n\tstruct strncmp_test *skel;\n\tint err, got;\n\n\tskel = strncmp_test__open();\n\tif (!ASSERT_OK_PTR(skel, \"strncmp_test open\"))\n\t\treturn;\n\n\tbpf_program__set_autoload(skel->progs.do_strncmp, true);\n\n\terr = strncmp_test__load(skel);\n\tif (!ASSERT_EQ(err, 0, \"strncmp_test load\"))\n\t\tgoto out;\n\n\terr = strncmp_test__attach(skel);\n\tif (!ASSERT_EQ(err, 0, \"strncmp_test attach\"))\n\t\tgoto out;\n\n\tskel->bss->target_pid = getpid();\n\n\t \n\tskel->bss->str[0] = '\\0';\n\tgot = trigger_strncmp(skel);\n\tASSERT_EQ(got, -1, \"strncmp: empty str\");\n\n\t \n\tmemcpy(skel->bss->str, skel->rodata->target, sizeof(skel->bss->str));\n\tgot = trigger_strncmp(skel);\n\tASSERT_EQ(got, 0, \"strncmp: same str\");\n\n\t \n\tmemcpy(skel->bss->str, skel->rodata->target, sizeof(skel->bss->str));\n\tskel->bss->str[sizeof(skel->bss->str) - 1] = 'A';\n\tgot = trigger_strncmp(skel);\n\tASSERT_EQ(got, 1, \"strncmp: not-null-term str\");\n\n\tstrncmp_full_str_cmp(skel, \"strncmp: less than\", -1);\n\tstrncmp_full_str_cmp(skel, \"strncmp: greater than\", 1);\nout:\n\tstrncmp_test__destroy(skel);\n}\n\nstatic void test_strncmp_bad_not_const_str_size(void)\n{\n\tstruct strncmp_test *skel;\n\tint err;\n\n\tskel = strncmp_test__open();\n\tif (!ASSERT_OK_PTR(skel, \"strncmp_test open\"))\n\t\treturn;\n\n\tbpf_program__set_autoload(skel->progs.strncmp_bad_not_const_str_size, true);\n\n\terr = strncmp_test__load(skel);\n\tASSERT_ERR(err, \"strncmp_test load bad_not_const_str_size\");\n\n\tstrncmp_test__destroy(skel);\n}\n\nstatic void test_strncmp_bad_writable_target(void)\n{\n\tstruct strncmp_test *skel;\n\tint err;\n\n\tskel = strncmp_test__open();\n\tif (!ASSERT_OK_PTR(skel, \"strncmp_test open\"))\n\t\treturn;\n\n\tbpf_program__set_autoload(skel->progs.strncmp_bad_writable_target, true);\n\n\terr = strncmp_test__load(skel);\n\tASSERT_ERR(err, \"strncmp_test load bad_writable_target\");\n\n\tstrncmp_test__destroy(skel);\n}\n\nstatic void test_strncmp_bad_not_null_term_target(void)\n{\n\tstruct strncmp_test *skel;\n\tint err;\n\n\tskel = strncmp_test__open();\n\tif (!ASSERT_OK_PTR(skel, \"strncmp_test open\"))\n\t\treturn;\n\n\tbpf_program__set_autoload(skel->progs.strncmp_bad_not_null_term_target, true);\n\n\terr = strncmp_test__load(skel);\n\tASSERT_ERR(err, \"strncmp_test load bad_not_null_term_target\");\n\n\tstrncmp_test__destroy(skel);\n}\n\nvoid test_test_strncmp(void)\n{\n\tif (test__start_subtest(\"strncmp_ret\"))\n\t\ttest_strncmp_ret();\n\tif (test__start_subtest(\"strncmp_bad_not_const_str_size\"))\n\t\ttest_strncmp_bad_not_const_str_size();\n\tif (test__start_subtest(\"strncmp_bad_writable_target\"))\n\t\ttest_strncmp_bad_writable_target();\n\tif (test__start_subtest(\"strncmp_bad_not_null_term_target\"))\n\t\ttest_strncmp_bad_not_null_term_target();\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}