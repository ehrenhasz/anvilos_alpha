{
  "module_name": "verifier.c",
  "hash_id": "1d89d8572ea357af6f5f1dd4a8f6664c31c3ac523309d0b5b7929bb3109a6bfe",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/bpf/prog_tests/verifier.c",
  "human_readable_source": "\n\n#include <test_progs.h>\n\n#include \"cap_helpers.h\"\n#include \"verifier_and.skel.h\"\n#include \"verifier_array_access.skel.h\"\n#include \"verifier_basic_stack.skel.h\"\n#include \"verifier_bounds.skel.h\"\n#include \"verifier_bounds_deduction.skel.h\"\n#include \"verifier_bounds_deduction_non_const.skel.h\"\n#include \"verifier_bounds_mix_sign_unsign.skel.h\"\n#include \"verifier_bpf_get_stack.skel.h\"\n#include \"verifier_bswap.skel.h\"\n#include \"verifier_btf_ctx_access.skel.h\"\n#include \"verifier_cfg.skel.h\"\n#include \"verifier_cgroup_inv_retcode.skel.h\"\n#include \"verifier_cgroup_skb.skel.h\"\n#include \"verifier_cgroup_storage.skel.h\"\n#include \"verifier_const_or.skel.h\"\n#include \"verifier_ctx.skel.h\"\n#include \"verifier_ctx_sk_msg.skel.h\"\n#include \"verifier_d_path.skel.h\"\n#include \"verifier_direct_packet_access.skel.h\"\n#include \"verifier_direct_stack_access_wraparound.skel.h\"\n#include \"verifier_div0.skel.h\"\n#include \"verifier_div_overflow.skel.h\"\n#include \"verifier_gotol.skel.h\"\n#include \"verifier_helper_access_var_len.skel.h\"\n#include \"verifier_helper_packet_access.skel.h\"\n#include \"verifier_helper_restricted.skel.h\"\n#include \"verifier_helper_value_access.skel.h\"\n#include \"verifier_int_ptr.skel.h\"\n#include \"verifier_jeq_infer_not_null.skel.h\"\n#include \"verifier_ld_ind.skel.h\"\n#include \"verifier_ldsx.skel.h\"\n#include \"verifier_leak_ptr.skel.h\"\n#include \"verifier_loops1.skel.h\"\n#include \"verifier_lwt.skel.h\"\n#include \"verifier_map_in_map.skel.h\"\n#include \"verifier_map_ptr.skel.h\"\n#include \"verifier_map_ptr_mixing.skel.h\"\n#include \"verifier_map_ret_val.skel.h\"\n#include \"verifier_masking.skel.h\"\n#include \"verifier_meta_access.skel.h\"\n#include \"verifier_movsx.skel.h\"\n#include \"verifier_netfilter_ctx.skel.h\"\n#include \"verifier_netfilter_retcode.skel.h\"\n#include \"verifier_prevent_map_lookup.skel.h\"\n#include \"verifier_raw_stack.skel.h\"\n#include \"verifier_raw_tp_writable.skel.h\"\n#include \"verifier_reg_equal.skel.h\"\n#include \"verifier_ref_tracking.skel.h\"\n#include \"verifier_regalloc.skel.h\"\n#include \"verifier_ringbuf.skel.h\"\n#include \"verifier_runtime_jit.skel.h\"\n#include \"verifier_scalar_ids.skel.h\"\n#include \"verifier_sdiv.skel.h\"\n#include \"verifier_search_pruning.skel.h\"\n#include \"verifier_sock.skel.h\"\n#include \"verifier_spill_fill.skel.h\"\n#include \"verifier_spin_lock.skel.h\"\n#include \"verifier_stack_ptr.skel.h\"\n#include \"verifier_subprog_precision.skel.h\"\n#include \"verifier_subreg.skel.h\"\n#include \"verifier_typedef.skel.h\"\n#include \"verifier_uninit.skel.h\"\n#include \"verifier_unpriv.skel.h\"\n#include \"verifier_unpriv_perf.skel.h\"\n#include \"verifier_value_adj_spill.skel.h\"\n#include \"verifier_value.skel.h\"\n#include \"verifier_value_illegal_alu.skel.h\"\n#include \"verifier_value_or_null.skel.h\"\n#include \"verifier_value_ptr_arith.skel.h\"\n#include \"verifier_var_off.skel.h\"\n#include \"verifier_xadd.skel.h\"\n#include \"verifier_xdp.skel.h\"\n#include \"verifier_xdp_direct_packet_access.skel.h\"\n\n#define MAX_ENTRIES 11\n\nstruct test_val {\n\tunsigned int index;\n\tint foo[MAX_ENTRIES];\n};\n\n__maybe_unused\nstatic void run_tests_aux(const char *skel_name,\n\t\t\t  skel_elf_bytes_fn elf_bytes_factory,\n\t\t\t  pre_execution_cb pre_execution_cb)\n{\n\tstruct test_loader tester = {};\n\t__u64 old_caps;\n\tint err;\n\n\t \n\terr = cap_disable_effective(1ULL << CAP_SYS_ADMIN, &old_caps);\n\tif (err) {\n\t\tPRINT_FAIL(\"failed to drop CAP_SYS_ADMIN: %i, %s\\n\", err, strerror(err));\n\t\treturn;\n\t}\n\n\ttest_loader__set_pre_execution_cb(&tester, pre_execution_cb);\n\ttest_loader__run_subtests(&tester, skel_name, elf_bytes_factory);\n\ttest_loader_fini(&tester);\n\n\terr = cap_enable_effective(old_caps, NULL);\n\tif (err)\n\t\tPRINT_FAIL(\"failed to restore CAP_SYS_ADMIN: %i, %s\\n\", err, strerror(err));\n}\n\n#define RUN(skel) run_tests_aux(#skel, skel##__elf_bytes, NULL)\n\nvoid test_verifier_and(void)                  { RUN(verifier_and); }\nvoid test_verifier_basic_stack(void)          { RUN(verifier_basic_stack); }\nvoid test_verifier_bounds(void)               { RUN(verifier_bounds); }\nvoid test_verifier_bounds_deduction(void)     { RUN(verifier_bounds_deduction); }\nvoid test_verifier_bounds_deduction_non_const(void)     { RUN(verifier_bounds_deduction_non_const); }\nvoid test_verifier_bounds_mix_sign_unsign(void) { RUN(verifier_bounds_mix_sign_unsign); }\nvoid test_verifier_bpf_get_stack(void)        { RUN(verifier_bpf_get_stack); }\nvoid test_verifier_bswap(void)                { RUN(verifier_bswap); }\nvoid test_verifier_btf_ctx_access(void)       { RUN(verifier_btf_ctx_access); }\nvoid test_verifier_cfg(void)                  { RUN(verifier_cfg); }\nvoid test_verifier_cgroup_inv_retcode(void)   { RUN(verifier_cgroup_inv_retcode); }\nvoid test_verifier_cgroup_skb(void)           { RUN(verifier_cgroup_skb); }\nvoid test_verifier_cgroup_storage(void)       { RUN(verifier_cgroup_storage); }\nvoid test_verifier_const_or(void)             { RUN(verifier_const_or); }\nvoid test_verifier_ctx(void)                  { RUN(verifier_ctx); }\nvoid test_verifier_ctx_sk_msg(void)           { RUN(verifier_ctx_sk_msg); }\nvoid test_verifier_d_path(void)               { RUN(verifier_d_path); }\nvoid test_verifier_direct_packet_access(void) { RUN(verifier_direct_packet_access); }\nvoid test_verifier_direct_stack_access_wraparound(void) { RUN(verifier_direct_stack_access_wraparound); }\nvoid test_verifier_div0(void)                 { RUN(verifier_div0); }\nvoid test_verifier_div_overflow(void)         { RUN(verifier_div_overflow); }\nvoid test_verifier_gotol(void)                { RUN(verifier_gotol); }\nvoid test_verifier_helper_access_var_len(void) { RUN(verifier_helper_access_var_len); }\nvoid test_verifier_helper_packet_access(void) { RUN(verifier_helper_packet_access); }\nvoid test_verifier_helper_restricted(void)    { RUN(verifier_helper_restricted); }\nvoid test_verifier_helper_value_access(void)  { RUN(verifier_helper_value_access); }\nvoid test_verifier_int_ptr(void)              { RUN(verifier_int_ptr); }\nvoid test_verifier_jeq_infer_not_null(void)   { RUN(verifier_jeq_infer_not_null); }\nvoid test_verifier_ld_ind(void)               { RUN(verifier_ld_ind); }\nvoid test_verifier_ldsx(void)                  { RUN(verifier_ldsx); }\nvoid test_verifier_leak_ptr(void)             { RUN(verifier_leak_ptr); }\nvoid test_verifier_loops1(void)               { RUN(verifier_loops1); }\nvoid test_verifier_lwt(void)                  { RUN(verifier_lwt); }\nvoid test_verifier_map_in_map(void)           { RUN(verifier_map_in_map); }\nvoid test_verifier_map_ptr(void)              { RUN(verifier_map_ptr); }\nvoid test_verifier_map_ptr_mixing(void)       { RUN(verifier_map_ptr_mixing); }\nvoid test_verifier_map_ret_val(void)          { RUN(verifier_map_ret_val); }\nvoid test_verifier_masking(void)              { RUN(verifier_masking); }\nvoid test_verifier_meta_access(void)          { RUN(verifier_meta_access); }\nvoid test_verifier_movsx(void)                 { RUN(verifier_movsx); }\nvoid test_verifier_netfilter_ctx(void)        { RUN(verifier_netfilter_ctx); }\nvoid test_verifier_netfilter_retcode(void)    { RUN(verifier_netfilter_retcode); }\nvoid test_verifier_prevent_map_lookup(void)   { RUN(verifier_prevent_map_lookup); }\nvoid test_verifier_raw_stack(void)            { RUN(verifier_raw_stack); }\nvoid test_verifier_raw_tp_writable(void)      { RUN(verifier_raw_tp_writable); }\nvoid test_verifier_reg_equal(void)            { RUN(verifier_reg_equal); }\nvoid test_verifier_ref_tracking(void)         { RUN(verifier_ref_tracking); }\nvoid test_verifier_regalloc(void)             { RUN(verifier_regalloc); }\nvoid test_verifier_ringbuf(void)              { RUN(verifier_ringbuf); }\nvoid test_verifier_runtime_jit(void)          { RUN(verifier_runtime_jit); }\nvoid test_verifier_scalar_ids(void)           { RUN(verifier_scalar_ids); }\nvoid test_verifier_sdiv(void)                 { RUN(verifier_sdiv); }\nvoid test_verifier_search_pruning(void)       { RUN(verifier_search_pruning); }\nvoid test_verifier_sock(void)                 { RUN(verifier_sock); }\nvoid test_verifier_spill_fill(void)           { RUN(verifier_spill_fill); }\nvoid test_verifier_spin_lock(void)            { RUN(verifier_spin_lock); }\nvoid test_verifier_stack_ptr(void)            { RUN(verifier_stack_ptr); }\nvoid test_verifier_subprog_precision(void)    { RUN(verifier_subprog_precision); }\nvoid test_verifier_subreg(void)               { RUN(verifier_subreg); }\nvoid test_verifier_typedef(void)              { RUN(verifier_typedef); }\nvoid test_verifier_uninit(void)               { RUN(verifier_uninit); }\nvoid test_verifier_unpriv(void)               { RUN(verifier_unpriv); }\nvoid test_verifier_unpriv_perf(void)          { RUN(verifier_unpriv_perf); }\nvoid test_verifier_value_adj_spill(void)      { RUN(verifier_value_adj_spill); }\nvoid test_verifier_value(void)                { RUN(verifier_value); }\nvoid test_verifier_value_illegal_alu(void)    { RUN(verifier_value_illegal_alu); }\nvoid test_verifier_value_or_null(void)        { RUN(verifier_value_or_null); }\nvoid test_verifier_var_off(void)              { RUN(verifier_var_off); }\nvoid test_verifier_xadd(void)                 { RUN(verifier_xadd); }\nvoid test_verifier_xdp(void)                  { RUN(verifier_xdp); }\nvoid test_verifier_xdp_direct_packet_access(void) { RUN(verifier_xdp_direct_packet_access); }\n\nstatic int init_test_val_map(struct bpf_object *obj, char *map_name)\n{\n\tstruct test_val value = {\n\t\t.index = (6 + 1) * sizeof(int),\n\t\t.foo[6] = 0xabcdef12,\n\t};\n\tstruct bpf_map *map;\n\tint err, key = 0;\n\n\tmap = bpf_object__find_map_by_name(obj, map_name);\n\tif (!map) {\n\t\tPRINT_FAIL(\"Can't find map '%s'\\n\", map_name);\n\t\treturn -EINVAL;\n\t}\n\n\terr = bpf_map_update_elem(bpf_map__fd(map), &key, &value, 0);\n\tif (err) {\n\t\tPRINT_FAIL(\"Error while updating map '%s': %d\\n\", map_name, err);\n\t\treturn err;\n\t}\n\n\treturn 0;\n}\n\nstatic int init_array_access_maps(struct bpf_object *obj)\n{\n\treturn init_test_val_map(obj, \"map_array_ro\");\n}\n\nvoid test_verifier_array_access(void)\n{\n\trun_tests_aux(\"verifier_array_access\",\n\t\t      verifier_array_access__elf_bytes,\n\t\t      init_array_access_maps);\n}\n\nstatic int init_value_ptr_arith_maps(struct bpf_object *obj)\n{\n\treturn init_test_val_map(obj, \"map_array_48b\");\n}\n\nvoid test_verifier_value_ptr_arith(void)\n{\n\trun_tests_aux(\"verifier_value_ptr_arith\",\n\t\t      verifier_value_ptr_arith__elf_bytes,\n\t\t      init_value_ptr_arith_maps);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}