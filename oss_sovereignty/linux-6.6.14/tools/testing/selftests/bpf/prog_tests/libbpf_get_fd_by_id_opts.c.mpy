{
  "module_name": "libbpf_get_fd_by_id_opts.c",
  "hash_id": "5a197cf3df7dfa3f781307d2049bb17c256bccf74548b833cd3b45b0f47de55a",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/bpf/prog_tests/libbpf_get_fd_by_id_opts.c",
  "human_readable_source": "\n\n \n\n#include <test_progs.h>\n\n#include \"test_libbpf_get_fd_by_id_opts.skel.h\"\n\nvoid test_libbpf_get_fd_by_id_opts(void)\n{\n\tstruct test_libbpf_get_fd_by_id_opts *skel;\n\tstruct bpf_map_info info_m = {};\n\t__u32 len = sizeof(info_m), value;\n\tint ret, zero = 0, fd = -1;\n\tLIBBPF_OPTS(bpf_get_fd_by_id_opts, fd_opts_rdonly,\n\t\t.open_flags = BPF_F_RDONLY,\n\t);\n\n\tskel = test_libbpf_get_fd_by_id_opts__open_and_load();\n\tif (!ASSERT_OK_PTR(skel,\n\t\t\t   \"test_libbpf_get_fd_by_id_opts__open_and_load\"))\n\t\treturn;\n\n\tret = test_libbpf_get_fd_by_id_opts__attach(skel);\n\tif (!ASSERT_OK(ret, \"test_libbpf_get_fd_by_id_opts__attach\"))\n\t\tgoto close_prog;\n\n\tret = bpf_map_get_info_by_fd(bpf_map__fd(skel->maps.data_input),\n\t\t\t\t     &info_m, &len);\n\tif (!ASSERT_OK(ret, \"bpf_map_get_info_by_fd\"))\n\t\tgoto close_prog;\n\n\tfd = bpf_map_get_fd_by_id(info_m.id);\n\tif (!ASSERT_LT(fd, 0, \"bpf_map_get_fd_by_id\"))\n\t\tgoto close_prog;\n\n\tfd = bpf_map_get_fd_by_id_opts(info_m.id, NULL);\n\tif (!ASSERT_LT(fd, 0, \"bpf_map_get_fd_by_id_opts\"))\n\t\tgoto close_prog;\n\n\tfd = bpf_map_get_fd_by_id_opts(info_m.id, &fd_opts_rdonly);\n\tif (!ASSERT_GE(fd, 0, \"bpf_map_get_fd_by_id_opts\"))\n\t\tgoto close_prog;\n\n\t \n\tret = bpf_map_lookup_elem(fd, &zero, &value);\n\tif (!ASSERT_OK(ret, \"bpf_map_lookup_elem\"))\n\t\tgoto close_prog;\n\n\tif (!ASSERT_EQ(value, 0, \"map value mismatch\"))\n\t\tgoto close_prog;\n\n\t \n\tret = bpf_map_update_elem(fd, &zero, &len, BPF_ANY);\n\tif (!ASSERT_LT(ret, 0, \"bpf_map_update_elem\"))\n\t\tgoto close_prog;\n\n\t \n\tret = bpf_map_update_elem(bpf_map__fd(skel->maps.data_input), &zero,\n\t\t\t\t  &len, BPF_ANY);\n\tif (!ASSERT_OK(ret, \"bpf_map_update_elem\"))\n\t\tgoto close_prog;\n\n\t \n\tret = bpf_prog_get_fd_by_id_opts(0, &fd_opts_rdonly);\n\tif (!ASSERT_EQ(ret, -EINVAL, \"bpf_prog_get_fd_by_id_opts\"))\n\t\tgoto close_prog;\n\n\t \n\tret = bpf_link_get_fd_by_id_opts(0, &fd_opts_rdonly);\n\tif (!ASSERT_EQ(ret, -EINVAL, \"bpf_link_get_fd_by_id_opts\"))\n\t\tgoto close_prog;\n\n\t \n\tret = bpf_btf_get_fd_by_id_opts(0, &fd_opts_rdonly);\n\tASSERT_EQ(ret, -EINVAL, \"bpf_btf_get_fd_by_id_opts\");\n\nclose_prog:\n\tif (fd >= 0)\n\t\tclose(fd);\n\n\ttest_libbpf_get_fd_by_id_opts__destroy(skel);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}