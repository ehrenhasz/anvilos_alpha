{
  "module_name": "map_lookup_percpu_elem.c",
  "hash_id": "cfe97e92c213f9687880b54ec320331e4c0ee8ccfe38ca0b0252ddb3f9908a34",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/bpf/prog_tests/map_lookup_percpu_elem.c",
  "human_readable_source": "\n \n\n#include <test_progs.h>\n#include \"test_map_lookup_percpu_elem.skel.h\"\n\nvoid test_map_lookup_percpu_elem(void)\n{\n\tstruct test_map_lookup_percpu_elem *skel;\n\t__u64 key = 0, sum;\n\tint ret, i, nr_cpus = libbpf_num_possible_cpus();\n\t__u64 *buf;\n\n\tbuf = malloc(nr_cpus*sizeof(__u64));\n\tif (!ASSERT_OK_PTR(buf, \"malloc\"))\n\t\treturn;\n\n\tfor (i = 0; i < nr_cpus; i++)\n\t\tbuf[i] = i;\n\tsum = (nr_cpus - 1) * nr_cpus / 2;\n\n\tskel = test_map_lookup_percpu_elem__open();\n\tif (!ASSERT_OK_PTR(skel, \"test_map_lookup_percpu_elem__open\"))\n\t\tgoto exit;\n\n\tskel->rodata->my_pid = getpid();\n\tskel->rodata->nr_cpus = nr_cpus;\n\n\tret = test_map_lookup_percpu_elem__load(skel);\n\tif (!ASSERT_OK(ret, \"test_map_lookup_percpu_elem__load\"))\n\t\tgoto cleanup;\n\n\tret = test_map_lookup_percpu_elem__attach(skel);\n\tif (!ASSERT_OK(ret, \"test_map_lookup_percpu_elem__attach\"))\n\t\tgoto cleanup;\n\n\tret = bpf_map_update_elem(bpf_map__fd(skel->maps.percpu_array_map), &key, buf, 0);\n\tASSERT_OK(ret, \"percpu_array_map update\");\n\n\tret = bpf_map_update_elem(bpf_map__fd(skel->maps.percpu_hash_map), &key, buf, 0);\n\tASSERT_OK(ret, \"percpu_hash_map update\");\n\n\tret = bpf_map_update_elem(bpf_map__fd(skel->maps.percpu_lru_hash_map), &key, buf, 0);\n\tASSERT_OK(ret, \"percpu_lru_hash_map update\");\n\n\tsyscall(__NR_getuid);\n\n\ttest_map_lookup_percpu_elem__detach(skel);\n\n\tASSERT_EQ(skel->bss->percpu_array_elem_sum, sum, \"percpu_array lookup percpu elem\");\n\tASSERT_EQ(skel->bss->percpu_hash_elem_sum, sum, \"percpu_hash lookup percpu elem\");\n\tASSERT_EQ(skel->bss->percpu_lru_hash_elem_sum, sum, \"percpu_lru_hash lookup percpu elem\");\n\ncleanup:\n\ttest_map_lookup_percpu_elem__destroy(skel);\nexit:\n\tfree(buf);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}