{
  "module_name": "global_func_args.c",
  "hash_id": "b77f755d3b1f09b541c310b627413da097460afa8ff7b7a7b9c598743bed86c4",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/bpf/prog_tests/global_func_args.c",
  "human_readable_source": "\n#include \"test_progs.h\"\n#include \"network_helpers.h\"\n\nstatic __u32 duration;\n\nstatic void test_global_func_args0(struct bpf_object *obj)\n{\n\tint err, i, map_fd, actual_value;\n\tconst char *map_name = \"values\";\n\n\tmap_fd = bpf_find_map(__func__, obj, map_name);\n\tif (CHECK(map_fd < 0, \"bpf_find_map\", \"cannot find BPF map %s: %s\\n\",\n\t\tmap_name, strerror(errno)))\n\t\treturn;\n\n\tstruct {\n\t\tconst char *descr;\n\t\tint expected_value;\n\t} tests[] = {\n\t\t{\"passing NULL pointer\", 0},\n\t\t{\"returning value\", 1},\n\t\t{\"reading local variable\", 100 },\n\t\t{\"writing local variable\", 101 },\n\t\t{\"reading global variable\", 42 },\n\t\t{\"writing global variable\", 43 },\n\t\t{\"writing to pointer-to-pointer\", 1 },\n\t};\n\n\tfor (i = 0; i < ARRAY_SIZE(tests); ++i) {\n\t\tconst int expected_value = tests[i].expected_value;\n\n\t\terr = bpf_map_lookup_elem(map_fd, &i, &actual_value);\n\n\t\tCHECK(err || actual_value != expected_value, tests[i].descr,\n\t\t\t \"err %d result %d expected %d\\n\", err, actual_value, expected_value);\n\t}\n}\n\nvoid test_global_func_args(void)\n{\n\tconst char *file = \"./test_global_func_args.bpf.o\";\n\tstruct bpf_object *obj;\n\tint err, prog_fd;\n\tLIBBPF_OPTS(bpf_test_run_opts, topts,\n\t\t.data_in = &pkt_v4,\n\t\t.data_size_in = sizeof(pkt_v4),\n\t\t.repeat = 1,\n\t);\n\n\terr = bpf_prog_test_load(file, BPF_PROG_TYPE_CGROUP_SKB, &obj, &prog_fd);\n\tif (CHECK(err, \"load program\", \"error %d loading %s\\n\", err, file))\n\t\treturn;\n\n\terr = bpf_prog_test_run_opts(prog_fd, &topts);\n\tASSERT_OK(err, \"test_run\");\n\tASSERT_OK(topts.retval, \"test_run retval\");\n\n\ttest_global_func_args0(obj);\n\n\tbpf_object__close(obj);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}