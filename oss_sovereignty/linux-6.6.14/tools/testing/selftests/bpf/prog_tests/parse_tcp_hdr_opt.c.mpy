{
  "module_name": "parse_tcp_hdr_opt.c",
  "hash_id": "70c326223c5c1f197b0f5c7d1a7e4a00985337d12b41f1bce6d81a8bff0e3c44",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/bpf/prog_tests/parse_tcp_hdr_opt.c",
  "human_readable_source": "\n\n#include <test_progs.h>\n#include <network_helpers.h>\n#include \"test_parse_tcp_hdr_opt.skel.h\"\n#include \"test_parse_tcp_hdr_opt_dynptr.skel.h\"\n#include \"test_tcp_hdr_options.h\"\n\nstruct test_pkt {\n\tstruct ipv6_packet pk6_v6;\n\tu8 options[16];\n} __packed;\n\nstruct test_pkt pkt = {\n\t.pk6_v6.eth.h_proto = __bpf_constant_htons(ETH_P_IPV6),\n\t.pk6_v6.iph.nexthdr = IPPROTO_TCP,\n\t.pk6_v6.iph.payload_len = __bpf_constant_htons(MAGIC_BYTES),\n\t.pk6_v6.tcp.urg_ptr = 123,\n\t.pk6_v6.tcp.doff = 9,  \n\n\t.options = {\n\t\tTCPOPT_MSS, 4, 0x05, 0xB4, TCPOPT_NOP, TCPOPT_NOP,\n\t\t0, 6, 0xBB, 0xBB, 0xBB, 0xBB, TCPOPT_EOL\n\t},\n};\n\nstatic void test_parse_opt(void)\n{\n\tstruct test_parse_tcp_hdr_opt *skel;\n\tstruct bpf_program *prog;\n\tchar buf[128];\n\tint err;\n\n\tLIBBPF_OPTS(bpf_test_run_opts, topts,\n\t\t    .data_in = &pkt,\n\t\t    .data_size_in = sizeof(pkt),\n\t\t    .data_out = buf,\n\t\t    .data_size_out = sizeof(buf),\n\t\t    .repeat = 3,\n\t);\n\n\tskel = test_parse_tcp_hdr_opt__open_and_load();\n\tif (!ASSERT_OK_PTR(skel, \"skel_open_and_load\"))\n\t\treturn;\n\n\tpkt.options[6] = skel->rodata->tcp_hdr_opt_kind_tpr;\n\tprog = skel->progs.xdp_ingress_v6;\n\n\terr = bpf_prog_test_run_opts(bpf_program__fd(prog), &topts);\n\tASSERT_OK(err, \"ipv6 test_run\");\n\tASSERT_EQ(topts.retval, XDP_PASS, \"ipv6 test_run retval\");\n\tASSERT_EQ(skel->bss->server_id, 0xBBBBBBBB, \"server id\");\n\n\ttest_parse_tcp_hdr_opt__destroy(skel);\n}\n\nstatic void test_parse_opt_dynptr(void)\n{\n\tstruct test_parse_tcp_hdr_opt_dynptr *skel;\n\tstruct bpf_program *prog;\n\tchar buf[128];\n\tint err;\n\n\tLIBBPF_OPTS(bpf_test_run_opts, topts,\n\t\t    .data_in = &pkt,\n\t\t    .data_size_in = sizeof(pkt),\n\t\t    .data_out = buf,\n\t\t    .data_size_out = sizeof(buf),\n\t\t    .repeat = 3,\n\t);\n\n\tskel = test_parse_tcp_hdr_opt_dynptr__open_and_load();\n\tif (!ASSERT_OK_PTR(skel, \"skel_open_and_load\"))\n\t\treturn;\n\n\tpkt.options[6] = skel->rodata->tcp_hdr_opt_kind_tpr;\n\tprog = skel->progs.xdp_ingress_v6;\n\n\terr = bpf_prog_test_run_opts(bpf_program__fd(prog), &topts);\n\tASSERT_OK(err, \"ipv6 test_run\");\n\tASSERT_EQ(topts.retval, XDP_PASS, \"ipv6 test_run retval\");\n\tASSERT_EQ(skel->bss->server_id, 0xBBBBBBBB, \"server id\");\n\n\ttest_parse_tcp_hdr_opt_dynptr__destroy(skel);\n}\n\nvoid test_parse_tcp_hdr_opt(void)\n{\n\tif (test__start_subtest(\"parse_tcp_hdr_opt\"))\n\t\ttest_parse_opt();\n\tif (test__start_subtest(\"parse_tcp_hdr_opt_dynptr\"))\n\t\ttest_parse_opt_dynptr();\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}