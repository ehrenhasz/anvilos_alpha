{
  "module_name": "load_bytes_relative.c",
  "hash_id": "458a4e7c34806343d365fd7d012ee46a1db7780afae5a59d84bf02f50059d5ee",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/bpf/prog_tests/load_bytes_relative.c",
  "human_readable_source": "\n\n \n\n#include <test_progs.h>\n#include <network_helpers.h>\n\nvoid test_load_bytes_relative(void)\n{\n\tint server_fd, cgroup_fd, prog_fd, map_fd, client_fd;\n\tint err;\n\tstruct bpf_object *obj;\n\tstruct bpf_program *prog;\n\tstruct bpf_map *test_result;\n\t__u32 duration = 0;\n\n\t__u32 map_key = 0;\n\t__u32 map_value = 0;\n\n\tcgroup_fd = test__join_cgroup(\"/load_bytes_relative\");\n\tif (CHECK_FAIL(cgroup_fd < 0))\n\t\treturn;\n\n\tserver_fd = start_server(AF_INET, SOCK_STREAM, NULL, 0, 0);\n\tif (CHECK_FAIL(server_fd < 0))\n\t\tgoto close_cgroup_fd;\n\n\terr = bpf_prog_test_load(\"./load_bytes_relative.bpf.o\", BPF_PROG_TYPE_CGROUP_SKB,\n\t\t\t\t &obj, &prog_fd);\n\tif (CHECK_FAIL(err))\n\t\tgoto close_server_fd;\n\n\ttest_result = bpf_object__find_map_by_name(obj, \"test_result\");\n\tif (CHECK_FAIL(!test_result))\n\t\tgoto close_bpf_object;\n\n\tmap_fd = bpf_map__fd(test_result);\n\tif (map_fd < 0)\n\t\tgoto close_bpf_object;\n\n\tprog = bpf_object__find_program_by_name(obj, \"load_bytes_relative\");\n\tif (CHECK_FAIL(!prog))\n\t\tgoto close_bpf_object;\n\n\terr = bpf_prog_attach(prog_fd, cgroup_fd, BPF_CGROUP_INET_EGRESS,\n\t\t\t      BPF_F_ALLOW_MULTI);\n\tif (CHECK_FAIL(err))\n\t\tgoto close_bpf_object;\n\n\tclient_fd = connect_to_fd(server_fd, 0);\n\tif (CHECK_FAIL(client_fd < 0))\n\t\tgoto close_bpf_object;\n\tclose(client_fd);\n\n\terr = bpf_map_lookup_elem(map_fd, &map_key, &map_value);\n\tif (CHECK_FAIL(err))\n\t\tgoto close_bpf_object;\n\n\tCHECK(map_value != 1, \"bpf\", \"bpf program returned failure\");\n\nclose_bpf_object:\n\tbpf_object__close(obj);\n\nclose_server_fd:\n\tclose(server_fd);\n\nclose_cgroup_fd:\n\tclose(cgroup_fd);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}