{
  "module_name": "trace_vprintk.c",
  "hash_id": "9d50caad6d7f835cbc22ddff5ef6e3b4697bbef06a001104d7ad38c9cb13cf63",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/bpf/prog_tests/trace_vprintk.c",
  "human_readable_source": "\n \n\n#include <test_progs.h>\n\n#include \"trace_vprintk.lskel.h\"\n\n#define TRACEFS_PIPE\t\"/sys/kernel/tracing/trace_pipe\"\n#define DEBUGFS_PIPE\t\"/sys/kernel/debug/tracing/trace_pipe\"\n#define SEARCHMSG\t\"1,2,3,4,5,6,7,8,9,10\"\n\nvoid serial_test_trace_vprintk(void)\n{\n\tstruct trace_vprintk_lskel__bss *bss;\n\tint err = 0, iter = 0, found = 0;\n\tstruct trace_vprintk_lskel *skel;\n\tchar *buf = NULL;\n\tFILE *fp = NULL;\n\tsize_t buflen;\n\n\tskel = trace_vprintk_lskel__open_and_load();\n\tif (!ASSERT_OK_PTR(skel, \"trace_vprintk__open_and_load\"))\n\t\tgoto cleanup;\n\n\tbss = skel->bss;\n\n\terr = trace_vprintk_lskel__attach(skel);\n\tif (!ASSERT_OK(err, \"trace_vprintk__attach\"))\n\t\tgoto cleanup;\n\n\tif (access(TRACEFS_PIPE, F_OK) == 0)\n\t\tfp = fopen(TRACEFS_PIPE, \"r\");\n\telse\n\t\tfp = fopen(DEBUGFS_PIPE, \"r\");\n\tif (!ASSERT_OK_PTR(fp, \"fopen(TRACE_PIPE)\"))\n\t\tgoto cleanup;\n\n\t \n\tfcntl(fileno(fp), F_SETFL, O_NONBLOCK);\n\n\t \n\tusleep(1);\n\ttrace_vprintk_lskel__detach(skel);\n\n\tif (!ASSERT_GT(bss->trace_vprintk_ran, 0, \"bss->trace_vprintk_ran\"))\n\t\tgoto cleanup;\n\n\tif (!ASSERT_GT(bss->trace_vprintk_ret, 0, \"bss->trace_vprintk_ret\"))\n\t\tgoto cleanup;\n\n\t \n\twhile (getline(&buf, &buflen, fp) >= 0 || errno == EAGAIN) {\n\t\tif (strstr(buf, SEARCHMSG) != NULL)\n\t\t\tfound++;\n\t\tif (found == bss->trace_vprintk_ran)\n\t\t\tbreak;\n\t\tif (++iter > 1000)\n\t\t\tbreak;\n\t}\n\n\tif (!ASSERT_EQ(found, bss->trace_vprintk_ran, \"found\"))\n\t\tgoto cleanup;\n\n\tif (!ASSERT_LT(bss->null_data_vprintk_ret, 0, \"bss->null_data_vprintk_ret\"))\n\t\tgoto cleanup;\n\ncleanup:\n\ttrace_vprintk_lskel__destroy(skel);\n\tfree(buf);\n\tif (fp)\n\t\tfclose(fp);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}