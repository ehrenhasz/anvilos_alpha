{
  "module_name": "core_extern.c",
  "hash_id": "b7bf0e7780204eb35337adf15fc4a33bcf9699e24f0f099f0a12ab2fe529e810",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/bpf/prog_tests/core_extern.c",
  "human_readable_source": "\n \n\n#include <test_progs.h>\n#include <sys/mman.h>\n#include <sys/utsname.h>\n#include <linux/version.h>\n#include \"test_core_extern.skel.h\"\n\nstatic uint32_t get_kernel_version(void)\n{\n\tuint32_t major, minor, patch;\n\tstruct utsname info;\n\n\tuname(&info);\n\tif (sscanf(info.release, \"%u.%u.%u\", &major, &minor, &patch) != 3)\n\t\treturn 0;\n\treturn KERNEL_VERSION(major, minor, patch);\n}\n\n#define CFG \"CONFIG_BPF_SYSCALL=n\\n\"\n\nstatic struct test_case {\n\tconst char *name;\n\tconst char *cfg;\n\tbool fails;\n\tstruct test_core_extern__data data;\n} test_cases[] = {\n\t{ .name = \"default search path\", .data = { .bpf_syscall = true } },\n\t{\n\t\t.name = \"custom values\",\n\t\t.cfg = \"CONFIG_BPF_SYSCALL=n\\n\"\n\t\t       \"CONFIG_TRISTATE=m\\n\"\n\t\t       \"CONFIG_BOOL=y\\n\"\n\t\t       \"CONFIG_CHAR=100\\n\"\n\t\t       \"CONFIG_USHORT=30000\\n\"\n\t\t       \"CONFIG_INT=123456\\n\"\n\t\t       \"CONFIG_ULONG=0xDEADBEEFC0DE\\n\"\n\t\t       \"CONFIG_STR=\\\"abracad\\\"\\n\"\n\t\t       \"CONFIG_MISSING=0\",\n\t\t.data = {\n\t\t\t.unkn_virt_val = 0,\n\t\t\t.bpf_syscall = false,\n\t\t\t.tristate_val = TRI_MODULE,\n\t\t\t.bool_val = true,\n\t\t\t.char_val = 100,\n\t\t\t.ushort_val = 30000,\n\t\t\t.int_val = 123456,\n\t\t\t.ulong_val = 0xDEADBEEFC0DE,\n\t\t\t.str_val = \"abracad\",\n\t\t},\n\t},\n\t \n\t{ .name = \"tristate (y)\", .cfg = CFG\"CONFIG_TRISTATE=y\\n\",\n\t  .data = { .tristate_val = TRI_YES } },\n\t{ .name = \"tristate (n)\", .cfg = CFG\"CONFIG_TRISTATE=n\\n\",\n\t  .data = { .tristate_val = TRI_NO } },\n\t{ .name = \"tristate (m)\", .cfg = CFG\"CONFIG_TRISTATE=m\\n\",\n\t  .data = { .tristate_val = TRI_MODULE } },\n\t{ .name = \"tristate (int)\", .fails = 1, .cfg = CFG\"CONFIG_TRISTATE=1\" },\n\t{ .name = \"tristate (bad)\", .fails = 1, .cfg = CFG\"CONFIG_TRISTATE=M\" },\n\t \n\t{ .name = \"bool (y)\", .cfg = CFG\"CONFIG_BOOL=y\\n\",\n\t  .data = { .bool_val = true } },\n\t{ .name = \"bool (n)\", .cfg = CFG\"CONFIG_BOOL=n\\n\",\n\t  .data = { .bool_val = false } },\n\t{ .name = \"bool (tristate)\", .fails = 1, .cfg = CFG\"CONFIG_BOOL=m\" },\n\t{ .name = \"bool (int)\", .fails = 1, .cfg = CFG\"CONFIG_BOOL=1\" },\n\t \n\t{ .name = \"char (tristate)\", .cfg = CFG\"CONFIG_CHAR=m\\n\",\n\t  .data = { .char_val = 'm' } },\n\t{ .name = \"char (bad)\", .fails = 1, .cfg = CFG\"CONFIG_CHAR=q\\n\" },\n\t{ .name = \"char (empty)\", .fails = 1, .cfg = CFG\"CONFIG_CHAR=\\n\" },\n\t{ .name = \"char (str)\", .fails = 1, .cfg = CFG\"CONFIG_CHAR=\\\"y\\\"\\n\" },\n\t \n\t{ .name = \"str (empty)\", .cfg = CFG\"CONFIG_STR=\\\"\\\"\\n\",\n\t  .data = { .str_val = \"\\0\\0\\0\\0\\0\\0\\0\" } },\n\t{ .name = \"str (padded)\", .cfg = CFG\"CONFIG_STR=\\\"abra\\\"\\n\",\n\t  .data = { .str_val = \"abra\\0\\0\\0\" } },\n\t{ .name = \"str (too long)\", .cfg = CFG\"CONFIG_STR=\\\"abracada\\\"\\n\",\n\t  .data = { .str_val = \"abracad\" } },\n\t{ .name = \"str (no value)\", .fails = 1, .cfg = CFG\"CONFIG_STR=\\n\" },\n\t{ .name = \"str (bad value)\", .fails = 1, .cfg = CFG\"CONFIG_STR=bla\\n\" },\n\t \n\t{\n\t\t.name = \"integer forms\",\n\t\t.cfg = CFG\n\t\t       \"CONFIG_CHAR=0xA\\n\"\n\t\t       \"CONFIG_USHORT=0462\\n\"\n\t\t       \"CONFIG_INT=-100\\n\"\n\t\t       \"CONFIG_ULONG=+1000000000000\",\n\t\t.data = {\n\t\t\t.char_val = 0xA,\n\t\t\t.ushort_val = 0462,\n\t\t\t.int_val = -100,\n\t\t\t.ulong_val = 1000000000000,\n\t\t},\n\t},\n\t{ .name = \"int (bad)\", .fails = 1, .cfg = CFG\"CONFIG_INT=abc\" },\n\t{ .name = \"int (str)\", .fails = 1, .cfg = CFG\"CONFIG_INT=\\\"abc\\\"\" },\n\t{ .name = \"int (empty)\", .fails = 1, .cfg = CFG\"CONFIG_INT=\" },\n\t{ .name = \"int (mixed)\", .fails = 1, .cfg = CFG\"CONFIG_INT=123abc\" },\n\t{ .name = \"int (max)\", .cfg = CFG\"CONFIG_INT=2147483647\",\n\t  .data = { .int_val = 2147483647 } },\n\t{ .name = \"int (min)\", .cfg = CFG\"CONFIG_INT=-2147483648\",\n\t  .data = { .int_val = -2147483648 } },\n\t{ .name = \"int (max+1)\", .fails = 1, .cfg = CFG\"CONFIG_INT=2147483648\" },\n\t{ .name = \"int (min-1)\", .fails = 1, .cfg = CFG\"CONFIG_INT=-2147483649\" },\n\t{ .name = \"ushort (max)\", .cfg = CFG\"CONFIG_USHORT=65535\",\n\t  .data = { .ushort_val = 65535 } },\n\t{ .name = \"ushort (min)\", .cfg = CFG\"CONFIG_USHORT=0\",\n\t  .data = { .ushort_val = 0 } },\n\t{ .name = \"ushort (max+1)\", .fails = 1, .cfg = CFG\"CONFIG_USHORT=65536\" },\n\t{ .name = \"ushort (min-1)\", .fails = 1, .cfg = CFG\"CONFIG_USHORT=-1\" },\n\t{ .name = \"u64 (max)\", .cfg = CFG\"CONFIG_ULONG=0xffffffffffffffff\",\n\t  .data = { .ulong_val = 0xffffffffffffffff } },\n\t{ .name = \"u64 (min)\", .cfg = CFG\"CONFIG_ULONG=0\",\n\t  .data = { .ulong_val = 0 } },\n\t{ .name = \"u64 (max+1)\", .fails = 1, .cfg = CFG\"CONFIG_ULONG=0x10000000000000000\" },\n};\n\nvoid test_core_extern(void)\n{\n\tconst uint32_t kern_ver = get_kernel_version();\n\tint err, i, j;\n\tstruct test_core_extern *skel = NULL;\n\tuint64_t *got, *exp;\n\tint n = sizeof(*skel->data) / sizeof(uint64_t);\n\n\tfor (i = 0; i < ARRAY_SIZE(test_cases); i++) {\n\t\tstruct test_case *t = &test_cases[i];\n\t\tDECLARE_LIBBPF_OPTS(bpf_object_open_opts, opts,\n\t\t\t.kconfig = t->cfg,\n\t\t);\n\n\t\tif (!test__start_subtest(t->name))\n\t\t\tcontinue;\n\n\t\tskel = test_core_extern__open_opts(&opts);\n\t\tif (!ASSERT_OK_PTR(skel, \"skel_open\"))\n\t\t\tgoto cleanup;\n\t\terr = test_core_extern__load(skel);\n\t\tif (t->fails) {\n\t\t\tASSERT_ERR(err, \"skel_load_should_fail\");\n\t\t\tgoto cleanup;\n\t\t} else if (!ASSERT_OK(err, \"skel_load\")) {\n\t\t\tgoto cleanup;\n\t\t}\n\t\terr = test_core_extern__attach(skel);\n\t\tif (!ASSERT_OK(err, \"attach_raw_tp\"))\n\t\t\tgoto cleanup;\n\n\t\tusleep(1);\n\n\t\tt->data.kern_ver = kern_ver;\n\t\tt->data.missing_val = 0xDEADC0DE;\n\t\tgot = (uint64_t *)skel->data;\n\t\texp = (uint64_t *)&t->data;\n\t\tfor (j = 0; j < n; j++) {\n\t\t\tASSERT_EQ(got[j], exp[j], \"result\");\n\t\t}\ncleanup:\n\t\ttest_core_extern__destroy(skel);\n\t\tskel = NULL;\n\t}\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}