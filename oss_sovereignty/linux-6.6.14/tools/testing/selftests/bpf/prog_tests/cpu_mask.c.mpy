{
  "module_name": "cpu_mask.c",
  "hash_id": "5a60c67f676f8dc5e85cbf396488619e600de0b0014f0ea12be7a70cfc34d8ef",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/bpf/prog_tests/cpu_mask.c",
  "human_readable_source": "\n#include <test_progs.h>\n#include <bpf/btf.h>\n#include \"bpf/libbpf_internal.h\"\n\nstatic int duration = 0;\n\nstatic void validate_mask(int case_nr, const char *exp, bool *mask, int n)\n{\n\tint i;\n\n\tfor (i = 0; exp[i]; i++) {\n\t\tif (exp[i] == '1') {\n\t\t\tif (CHECK(i + 1 > n, \"mask_short\",\n\t\t\t\t  \"case #%d: mask too short, got n=%d, need at least %d\\n\",\n\t\t\t\t  case_nr, n, i + 1))\n\t\t\t\treturn;\n\t\t\tCHECK(!mask[i], \"cpu_not_set\",\n\t\t\t      \"case #%d: mask differs, expected cpu#%d SET\\n\",\n\t\t\t      case_nr, i);\n\t\t} else {\n\t\t\tCHECK(i < n && mask[i], \"cpu_set\",\n\t\t\t      \"case #%d: mask differs, expected cpu#%d UNSET\\n\",\n\t\t\t      case_nr, i);\n\t\t}\n\t}\n\tCHECK(i < n, \"mask_long\",\n\t      \"case #%d: mask too long, got n=%d, expected at most %d\\n\",\n\t      case_nr, n, i);\n}\n\nstatic struct {\n\tconst char *cpu_mask;\n\tconst char *expect;\n\tbool fails;\n} test_cases[] = {\n\t{ \"0\\n\", \"1\", false },\n\t{ \"0,2\\n\", \"101\", false },\n\t{ \"0-2\\n\", \"111\", false },\n\t{ \"0-2,3-4\\n\", \"11111\", false },\n\t{ \"0\", \"1\", false },\n\t{ \"0-2\", \"111\", false },\n\t{ \"0,2\", \"101\", false },\n\t{ \"0,1-3\", \"1111\", false },\n\t{ \"0,1,2,3\", \"1111\", false },\n\t{ \"0,2-3,5\", \"101101\", false },\n\t{ \"3-3\", \"0001\", false },\n\t{ \"2-4,6,9-10\", \"00111010011\", false },\n\t \n\t{ \"\", \"\", true },\n\t{ \"0-\", \"\", true },\n\t{ \"0 \", \"\", true },\n\t{ \"0_1\", \"\", true },\n\t{ \"1-0\", \"\", true },\n\t{ \"-1\", \"\", true },\n};\n\nvoid test_cpu_mask()\n{\n\tint i, err, n;\n\tbool *mask;\n\n\tfor (i = 0; i < ARRAY_SIZE(test_cases); i++) {\n\t\tmask = NULL;\n\t\terr = parse_cpu_mask_str(test_cases[i].cpu_mask, &mask, &n);\n\t\tif (test_cases[i].fails) {\n\t\t\tCHECK(!err, \"should_fail\",\n\t\t\t      \"case #%d: parsing should fail!\\n\", i + 1);\n\t\t} else {\n\t\t\tif (CHECK(err, \"parse_err\",\n\t\t\t\t  \"case #%d: cpu mask parsing failed: %d\\n\",\n\t\t\t\t  i + 1, err))\n\t\t\t\tcontinue;\n\t\t\tvalidate_mask(i + 1, test_cases[i].expect, mask, n);\n\t\t}\n\t\tfree(mask);\n\t}\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}