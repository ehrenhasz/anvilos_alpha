{
  "module_name": "fexit_test.c",
  "hash_id": "46e24559e3f2f5360fb651efba6b5fa1ee255547daf869ea27202d8895cd4544",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/bpf/prog_tests/fexit_test.c",
  "human_readable_source": "\n \n#include <test_progs.h>\n#include \"fexit_test.lskel.h\"\n#include \"fexit_many_args.skel.h\"\n\nstatic int fexit_test_common(struct fexit_test_lskel *fexit_skel)\n{\n\tint err, prog_fd, i;\n\tint link_fd;\n\t__u64 *result;\n\tLIBBPF_OPTS(bpf_test_run_opts, topts);\n\n\terr = fexit_test_lskel__attach(fexit_skel);\n\tif (!ASSERT_OK(err, \"fexit_attach\"))\n\t\treturn err;\n\n\t \n\tlink_fd = fexit_test_lskel__test1__attach(fexit_skel);\n\tif (!ASSERT_LT(link_fd, 0, \"fexit_attach_link\"))\n\t\treturn -1;\n\n\tprog_fd = fexit_skel->progs.test1.prog_fd;\n\terr = bpf_prog_test_run_opts(prog_fd, &topts);\n\tASSERT_OK(err, \"test_run\");\n\tASSERT_EQ(topts.retval, 0, \"test_run\");\n\n\tresult = (__u64 *)fexit_skel->bss;\n\tfor (i = 0; i < sizeof(*fexit_skel->bss) / sizeof(__u64); i++) {\n\t\tif (!ASSERT_EQ(result[i], 1, \"fexit_result\"))\n\t\t\treturn -1;\n\t}\n\n\tfexit_test_lskel__detach(fexit_skel);\n\n\t \n\tmemset(fexit_skel->bss, 0, sizeof(*fexit_skel->bss));\n\treturn 0;\n}\n\nstatic void fexit_test(void)\n{\n\tstruct fexit_test_lskel *fexit_skel = NULL;\n\tint err;\n\n\tfexit_skel = fexit_test_lskel__open_and_load();\n\tif (!ASSERT_OK_PTR(fexit_skel, \"fexit_skel_load\"))\n\t\tgoto cleanup;\n\n\terr = fexit_test_common(fexit_skel);\n\tif (!ASSERT_OK(err, \"fexit_first_attach\"))\n\t\tgoto cleanup;\n\n\terr = fexit_test_common(fexit_skel);\n\tASSERT_OK(err, \"fexit_second_attach\");\n\ncleanup:\n\tfexit_test_lskel__destroy(fexit_skel);\n}\n\nstatic void fexit_many_args(void)\n{\n\tstruct fexit_many_args *fexit_skel = NULL;\n\tint err;\n\n\tfexit_skel = fexit_many_args__open_and_load();\n\tif (!ASSERT_OK_PTR(fexit_skel, \"fexit_many_args_skel_load\"))\n\t\tgoto cleanup;\n\n\terr = fexit_many_args__attach(fexit_skel);\n\tif (!ASSERT_OK(err, \"fexit_many_args_attach\"))\n\t\tgoto cleanup;\n\n\tASSERT_OK(trigger_module_test_read(1), \"trigger_read\");\n\n\tASSERT_EQ(fexit_skel->bss->test1_result, 1,\n\t\t  \"fexit_many_args_result1\");\n\tASSERT_EQ(fexit_skel->bss->test2_result, 1,\n\t\t  \"fexit_many_args_result2\");\n\tASSERT_EQ(fexit_skel->bss->test3_result, 1,\n\t\t  \"fexit_many_args_result3\");\n\ncleanup:\n\tfexit_many_args__destroy(fexit_skel);\n}\n\nvoid test_fexit_test(void)\n{\n\tif (test__start_subtest(\"fexit\"))\n\t\tfexit_test();\n\tif (test__start_subtest(\"fexit_many_args\"))\n\t\tfexit_many_args();\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}