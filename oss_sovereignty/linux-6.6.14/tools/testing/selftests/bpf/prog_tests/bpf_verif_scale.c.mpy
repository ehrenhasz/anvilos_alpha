{
  "module_name": "bpf_verif_scale.c",
  "hash_id": "f2df0d5ad9d9e9982b180809a50f739d834e0eca4a664d05c0bc25da009492a9",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/bpf/prog_tests/bpf_verif_scale.c",
  "human_readable_source": "\n\n#include <test_progs.h>\nstatic int libbpf_debug_print(enum libbpf_print_level level,\n\t\t\t      const char *format, va_list args)\n{\n\tif (level != LIBBPF_DEBUG) {\n\t\tvprintf(format, args);\n\t\treturn 0;\n\t}\n\n\tif (!strstr(format, \"verifier log\"))\n\t\treturn 0;\n\tvprintf(\"%s\", args);\n\treturn 0;\n}\n\nextern int extra_prog_load_log_flags;\n\nstatic int check_load(const char *file, enum bpf_prog_type type)\n{\n\tstruct bpf_object *obj = NULL;\n\tstruct bpf_program *prog;\n\tint err;\n\n\tobj = bpf_object__open_file(file, NULL);\n\terr = libbpf_get_error(obj);\n\tif (err)\n\t\treturn err;\n\n\tprog = bpf_object__next_program(obj, NULL);\n\tif (!prog) {\n\t\terr = -ENOENT;\n\t\tgoto err_out;\n\t}\n\n\tbpf_program__set_type(prog, type);\n\tbpf_program__set_flags(prog, BPF_F_TEST_RND_HI32);\n\tbpf_program__set_log_level(prog, 4 | extra_prog_load_log_flags);\n\n\terr = bpf_object__load(obj);\n\nerr_out:\n\tbpf_object__close(obj);\n\treturn err;\n}\n\nstruct scale_test_def {\n\tconst char *file;\n\tenum bpf_prog_type attach_type;\n\tbool fails;\n};\n\nstatic void scale_test(const char *file,\n\t\t       enum bpf_prog_type attach_type,\n\t\t       bool should_fail)\n{\n\tlibbpf_print_fn_t old_print_fn = NULL;\n\tint err;\n\n\tif (env.verifier_stats) {\n\t\ttest__force_log();\n\t\told_print_fn = libbpf_set_print(libbpf_debug_print);\n\t}\n\n\terr = check_load(file, attach_type);\n\tif (should_fail)\n\t\tASSERT_ERR(err, \"expect_error\");\n\telse\n\t\tASSERT_OK(err, \"expect_success\");\n\n\tif (env.verifier_stats)\n\t\tlibbpf_set_print(old_print_fn);\n}\n\nvoid test_verif_scale1()\n{\n\tscale_test(\"test_verif_scale1.bpf.o\", BPF_PROG_TYPE_SCHED_CLS, false);\n}\n\nvoid test_verif_scale2()\n{\n\tscale_test(\"test_verif_scale2.bpf.o\", BPF_PROG_TYPE_SCHED_CLS, false);\n}\n\nvoid test_verif_scale3()\n{\n\tscale_test(\"test_verif_scale3.bpf.o\", BPF_PROG_TYPE_SCHED_CLS, false);\n}\n\nvoid test_verif_scale_pyperf_global()\n{\n\tscale_test(\"pyperf_global.bpf.o\", BPF_PROG_TYPE_RAW_TRACEPOINT, false);\n}\n\nvoid test_verif_scale_pyperf_subprogs()\n{\n\tscale_test(\"pyperf_subprogs.bpf.o\", BPF_PROG_TYPE_RAW_TRACEPOINT, false);\n}\n\nvoid test_verif_scale_pyperf50()\n{\n\t \n\tscale_test(\"pyperf50.bpf.o\", BPF_PROG_TYPE_RAW_TRACEPOINT, false);\n}\n\nvoid test_verif_scale_pyperf100()\n{\n\t \n\tscale_test(\"pyperf100.bpf.o\", BPF_PROG_TYPE_RAW_TRACEPOINT, false);\n}\n\nvoid test_verif_scale_pyperf180()\n{\n\t \n\tscale_test(\"pyperf180.bpf.o\", BPF_PROG_TYPE_RAW_TRACEPOINT, false);\n}\n\nvoid test_verif_scale_pyperf600()\n{\n\t \n\tscale_test(\"pyperf600.bpf.o\", BPF_PROG_TYPE_RAW_TRACEPOINT, false);\n}\n\nvoid test_verif_scale_pyperf600_bpf_loop(void)\n{\n\t \n\tscale_test(\"pyperf600_bpf_loop.bpf.o\", BPF_PROG_TYPE_RAW_TRACEPOINT, false);\n}\n\nvoid test_verif_scale_pyperf600_nounroll()\n{\n\t \n\tscale_test(\"pyperf600_nounroll.bpf.o\", BPF_PROG_TYPE_RAW_TRACEPOINT, false);\n}\n\nvoid test_verif_scale_pyperf600_iter()\n{\n\t \n\tscale_test(\"pyperf600_iter.bpf.o\", BPF_PROG_TYPE_RAW_TRACEPOINT, false);\n}\n\nvoid test_verif_scale_loop1()\n{\n\tscale_test(\"loop1.bpf.o\", BPF_PROG_TYPE_RAW_TRACEPOINT, false);\n}\n\nvoid test_verif_scale_loop2()\n{\n\tscale_test(\"loop2.bpf.o\", BPF_PROG_TYPE_RAW_TRACEPOINT, false);\n}\n\nvoid test_verif_scale_loop3_fail()\n{\n\tscale_test(\"loop3.bpf.o\", BPF_PROG_TYPE_RAW_TRACEPOINT, true  );\n}\n\nvoid test_verif_scale_loop4()\n{\n\tscale_test(\"loop4.bpf.o\", BPF_PROG_TYPE_SCHED_CLS, false);\n}\n\nvoid test_verif_scale_loop5()\n{\n\tscale_test(\"loop5.bpf.o\", BPF_PROG_TYPE_SCHED_CLS, false);\n}\n\nvoid test_verif_scale_loop6()\n{\n\tscale_test(\"loop6.bpf.o\", BPF_PROG_TYPE_KPROBE, false);\n}\n\nvoid test_verif_scale_strobemeta()\n{\n\t \n\tscale_test(\"strobemeta.bpf.o\", BPF_PROG_TYPE_RAW_TRACEPOINT, false);\n}\n\nvoid test_verif_scale_strobemeta_bpf_loop(void)\n{\n\t \n\tscale_test(\"strobemeta_bpf_loop.bpf.o\", BPF_PROG_TYPE_RAW_TRACEPOINT, false);\n}\n\nvoid test_verif_scale_strobemeta_nounroll1()\n{\n\t \n\tscale_test(\"strobemeta_nounroll1.bpf.o\", BPF_PROG_TYPE_RAW_TRACEPOINT, false);\n}\n\nvoid test_verif_scale_strobemeta_nounroll2()\n{\n\t \n\tscale_test(\"strobemeta_nounroll2.bpf.o\", BPF_PROG_TYPE_RAW_TRACEPOINT, false);\n}\n\nvoid test_verif_scale_strobemeta_subprogs()\n{\n\t \n\tscale_test(\"strobemeta_subprogs.bpf.o\", BPF_PROG_TYPE_RAW_TRACEPOINT, false);\n}\n\nvoid test_verif_scale_sysctl_loop1()\n{\n\tscale_test(\"test_sysctl_loop1.bpf.o\", BPF_PROG_TYPE_CGROUP_SYSCTL, false);\n}\n\nvoid test_verif_scale_sysctl_loop2()\n{\n\tscale_test(\"test_sysctl_loop2.bpf.o\", BPF_PROG_TYPE_CGROUP_SYSCTL, false);\n}\n\nvoid test_verif_scale_xdp_loop()\n{\n\tscale_test(\"test_xdp_loop.bpf.o\", BPF_PROG_TYPE_XDP, false);\n}\n\nvoid test_verif_scale_seg6_loop()\n{\n\tscale_test(\"test_seg6_loop.bpf.o\", BPF_PROG_TYPE_LWT_SEG6LOCAL, false);\n}\n\nvoid test_verif_twfw()\n{\n\tscale_test(\"twfw.bpf.o\", BPF_PROG_TYPE_CGROUP_SKB, false);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}