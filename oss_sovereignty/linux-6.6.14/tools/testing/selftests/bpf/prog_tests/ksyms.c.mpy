{
  "module_name": "ksyms.c",
  "hash_id": "51b6446508fac645fb1049294384fdfe58431eec5a4cde6627eae6b38d6c38bb",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/bpf/prog_tests/ksyms.c",
  "human_readable_source": "\n \n\n#include <test_progs.h>\n#include \"test_ksyms.skel.h\"\n#include <sys/stat.h>\n\nstatic int duration;\n\nvoid test_ksyms(void)\n{\n\tconst char *btf_path = \"/sys/kernel/btf/vmlinux\";\n\tstruct test_ksyms *skel;\n\tstruct test_ksyms__data *data;\n\t__u64 link_fops_addr, per_cpu_start_addr;\n\tstruct stat st;\n\t__u64 btf_size;\n\tint err;\n\n\terr = kallsyms_find(\"bpf_link_fops\", &link_fops_addr);\n\tif (CHECK(err == -EINVAL, \"kallsyms_fopen\", \"failed to open: %d\\n\", errno))\n\t\treturn;\n\tif (CHECK(err == -ENOENT, \"ksym_find\", \"symbol 'bpf_link_fops' not found\\n\"))\n\t\treturn;\n\n\terr = kallsyms_find(\"__per_cpu_start\", &per_cpu_start_addr);\n\tif (CHECK(err == -EINVAL, \"kallsyms_fopen\", \"failed to open: %d\\n\", errno))\n\t\treturn;\n\tif (CHECK(err == -ENOENT, \"ksym_find\", \"symbol 'per_cpu_start' not found\\n\"))\n\t\treturn;\n\n\tif (CHECK(stat(btf_path, &st), \"stat_btf\", \"err %d\\n\", errno))\n\t\treturn;\n\tbtf_size = st.st_size;\n\n\tskel = test_ksyms__open_and_load();\n\tif (CHECK(!skel, \"skel_open\", \"failed to open and load skeleton\\n\"))\n\t\treturn;\n\n\terr = test_ksyms__attach(skel);\n\tif (CHECK(err, \"skel_attach\", \"skeleton attach failed: %d\\n\", err))\n\t\tgoto cleanup;\n\n\t \n\tusleep(1);\n\n\tdata = skel->data;\n\tCHECK(data->out__bpf_link_fops != link_fops_addr, \"bpf_link_fops\",\n\t      \"got 0x%llx, exp 0x%llx\\n\",\n\t      data->out__bpf_link_fops, link_fops_addr);\n\tCHECK(data->out__bpf_link_fops1 != 0, \"bpf_link_fops1\",\n\t      \"got %llu, exp %llu\\n\", data->out__bpf_link_fops1, (__u64)0);\n\tCHECK(data->out__btf_size != btf_size, \"btf_size\",\n\t      \"got %llu, exp %llu\\n\", data->out__btf_size, btf_size);\n\tCHECK(data->out__per_cpu_start != per_cpu_start_addr, \"__per_cpu_start\",\n\t      \"got %llu, exp %llu\\n\", data->out__per_cpu_start,\n\t      per_cpu_start_addr);\n\ncleanup:\n\ttest_ksyms__destroy(skel);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}