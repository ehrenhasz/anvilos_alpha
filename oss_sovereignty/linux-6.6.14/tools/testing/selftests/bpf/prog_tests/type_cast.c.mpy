{
  "module_name": "type_cast.c",
  "hash_id": "741fb62005d4aa7e02622a3a2fa39f20d378bb111ac19611a868a286ef000482",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/bpf/prog_tests/type_cast.c",
  "human_readable_source": "\n \n#include <test_progs.h>\n#include <network_helpers.h>\n#include \"type_cast.skel.h\"\n\nstatic void test_xdp(void)\n{\n\tstruct type_cast *skel;\n\tint err, prog_fd;\n\tchar buf[128];\n\n\tLIBBPF_OPTS(bpf_test_run_opts, topts,\n\t\t.data_in = &pkt_v4,\n\t\t.data_size_in = sizeof(pkt_v4),\n\t\t.data_out = buf,\n\t\t.data_size_out = sizeof(buf),\n\t\t.repeat = 1,\n\t);\n\n\tskel = type_cast__open();\n\tif (!ASSERT_OK_PTR(skel, \"skel_open\"))\n\t\treturn;\n\n\tbpf_program__set_autoload(skel->progs.md_xdp, true);\n\terr = type_cast__load(skel);\n\tif (!ASSERT_OK(err, \"skel_load\"))\n\t\tgoto out;\n\n\tprog_fd = bpf_program__fd(skel->progs.md_xdp);\n\terr = bpf_prog_test_run_opts(prog_fd, &topts);\n\tASSERT_OK(err, \"test_run\");\n\tASSERT_EQ(topts.retval, XDP_PASS, \"xdp test_run retval\");\n\n\tASSERT_EQ(skel->bss->ifindex, 1, \"xdp_md ifindex\");\n\tASSERT_EQ(skel->bss->ifindex, skel->bss->ingress_ifindex, \"xdp_md ingress_ifindex\");\n\tASSERT_STREQ(skel->bss->name, \"lo\", \"xdp_md name\");\n\tASSERT_NEQ(skel->bss->inum, 0, \"xdp_md inum\");\n\nout:\n\ttype_cast__destroy(skel);\n}\n\nstatic void test_tc(void)\n{\n\tstruct type_cast *skel;\n\tint err, prog_fd;\n\n\tLIBBPF_OPTS(bpf_test_run_opts, topts,\n\t\t.data_in = &pkt_v4,\n\t\t.data_size_in = sizeof(pkt_v4),\n\t\t.repeat = 1,\n\t);\n\n\tskel = type_cast__open();\n\tif (!ASSERT_OK_PTR(skel, \"skel_open\"))\n\t\treturn;\n\n\tbpf_program__set_autoload(skel->progs.md_skb, true);\n\terr = type_cast__load(skel);\n\tif (!ASSERT_OK(err, \"skel_load\"))\n\t\tgoto out;\n\n\tprog_fd = bpf_program__fd(skel->progs.md_skb);\n\terr = bpf_prog_test_run_opts(prog_fd, &topts);\n\tASSERT_OK(err, \"test_run\");\n\tASSERT_EQ(topts.retval, 0, \"tc test_run retval\");\n\n\tASSERT_EQ(skel->bss->meta_len, 0, \"skb meta_len\");\n\tASSERT_EQ(skel->bss->frag0_len, 0, \"skb frag0_len\");\n\tASSERT_NEQ(skel->bss->kskb_len, 0, \"skb len\");\n\tASSERT_NEQ(skel->bss->kskb2_len, 0, \"skb2 len\");\n\tASSERT_EQ(skel->bss->kskb_len, skel->bss->kskb2_len, \"skb len compare\");\n\nout:\n\ttype_cast__destroy(skel);\n}\n\nstatic const char * const negative_tests[] = {\n\t\"untrusted_ptr\",\n\t\"kctx_u64\",\n};\n\nstatic void test_negative(void)\n{\n\tstruct bpf_program *prog;\n\tstruct type_cast *skel;\n\tint i, err;\n\n\tfor (i = 0; i < ARRAY_SIZE(negative_tests); i++) {\n\t\tskel = type_cast__open();\n\t\tif (!ASSERT_OK_PTR(skel, \"skel_open\"))\n\t\t\treturn;\n\n\t\tprog = bpf_object__find_program_by_name(skel->obj, negative_tests[i]);\n\t\tif (!ASSERT_OK_PTR(prog, \"bpf_object__find_program_by_name\"))\n\t\t\tgoto out;\n\t\tbpf_program__set_autoload(prog, true);\n\t\terr = type_cast__load(skel);\n\t\tASSERT_ERR(err, \"skel_load\");\nout:\n\t\ttype_cast__destroy(skel);\n\t}\n}\n\nvoid test_type_cast(void)\n{\n\tif (test__start_subtest(\"xdp\"))\n\t\ttest_xdp();\n\tif (test__start_subtest(\"tc\"))\n\t\ttest_tc();\n\tif (test__start_subtest(\"negative\"))\n\t\ttest_negative();\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}