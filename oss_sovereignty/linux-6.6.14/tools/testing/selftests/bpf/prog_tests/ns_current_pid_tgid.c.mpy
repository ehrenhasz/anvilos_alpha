{
  "module_name": "ns_current_pid_tgid.c",
  "hash_id": "bcc748f19399c4742cbe8a9bbe6ea1e95c39d68451fa83149701e94135eeb658",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/bpf/prog_tests/ns_current_pid_tgid.c",
  "human_readable_source": "\n \n\n#define _GNU_SOURCE\n#include <test_progs.h>\n#include \"test_ns_current_pid_tgid.skel.h\"\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <unistd.h>\n#include <sys/syscall.h>\n#include <sched.h>\n#include <sys/wait.h>\n#include <sys/mount.h>\n#include <sys/fcntl.h>\n\n#define STACK_SIZE (1024 * 1024)\nstatic char child_stack[STACK_SIZE];\n\nstatic int test_current_pid_tgid(void *args)\n{\n\tstruct test_ns_current_pid_tgid__bss  *bss;\n\tstruct test_ns_current_pid_tgid *skel;\n\tint err = -1, duration = 0;\n\tpid_t tgid, pid;\n\tstruct stat st;\n\n\tskel = test_ns_current_pid_tgid__open_and_load();\n\tif (CHECK(!skel, \"skel_open_load\", \"failed to load skeleton\\n\"))\n\t\tgoto cleanup;\n\n\tpid = syscall(SYS_gettid);\n\ttgid = getpid();\n\n\terr = stat(\"/proc/self/ns/pid\", &st);\n\tif (CHECK(err, \"stat\", \"failed /proc/self/ns/pid: %d\\n\", err))\n\t\tgoto cleanup;\n\n\tbss = skel->bss;\n\tbss->dev = st.st_dev;\n\tbss->ino = st.st_ino;\n\tbss->user_pid = 0;\n\tbss->user_tgid = 0;\n\n\terr = test_ns_current_pid_tgid__attach(skel);\n\tif (CHECK(err, \"skel_attach\", \"skeleton attach failed: %d\\n\", err))\n\t\tgoto cleanup;\n\n\t \n\tusleep(1);\n\tASSERT_EQ(bss->user_pid, pid, \"pid\");\n\tASSERT_EQ(bss->user_tgid, tgid, \"tgid\");\n\terr = 0;\n\ncleanup:\n\t test_ns_current_pid_tgid__destroy(skel);\n\n\treturn err;\n}\n\nstatic void test_ns_current_pid_tgid_new_ns(void)\n{\n\tint wstatus, duration = 0;\n\tpid_t cpid;\n\n\t \n\tcpid = clone(test_current_pid_tgid, child_stack + STACK_SIZE,\n\t\t     CLONE_NEWPID | SIGCHLD, NULL);\n\n\tif (CHECK(cpid == -1, \"clone\", \"%s\\n\", strerror(errno)))\n\t\treturn;\n\n\tif (CHECK(waitpid(cpid, &wstatus, 0) == -1, \"waitpid\", \"%s\\n\", strerror(errno)))\n\t\treturn;\n\n\tif (CHECK(WEXITSTATUS(wstatus) != 0, \"newns_pidtgid\", \"failed\"))\n\t\treturn;\n}\n\n \nvoid serial_test_ns_current_pid_tgid(void)\n{\n\tif (test__start_subtest(\"ns_current_pid_tgid_root_ns\"))\n\t\ttest_current_pid_tgid(NULL);\n\tif (test__start_subtest(\"ns_current_pid_tgid_new_ns\"))\n\t\ttest_ns_current_pid_tgid_new_ns();\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}