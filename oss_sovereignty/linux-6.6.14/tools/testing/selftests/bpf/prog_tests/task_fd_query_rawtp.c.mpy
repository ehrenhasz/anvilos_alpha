{
  "module_name": "task_fd_query_rawtp.c",
  "hash_id": "88afb515ca9d983e6a6cc1cb949a08cbc5863849384ce0d2f12c48a15e95813a",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/bpf/prog_tests/task_fd_query_rawtp.c",
  "human_readable_source": "\n#include <test_progs.h>\n\nvoid test_task_fd_query_rawtp(void)\n{\n\tconst char *file = \"./test_get_stack_rawtp.bpf.o\";\n\t__u64 probe_offset, probe_addr;\n\t__u32 len, prog_id, fd_type;\n\tstruct bpf_object *obj;\n\tint efd, err, prog_fd;\n\t__u32 duration = 0;\n\tchar buf[256];\n\n\terr = bpf_prog_test_load(file, BPF_PROG_TYPE_RAW_TRACEPOINT, &obj, &prog_fd);\n\tif (CHECK(err, \"prog_load raw tp\", \"err %d errno %d\\n\", err, errno))\n\t\treturn;\n\n\tefd = bpf_raw_tracepoint_open(\"sys_enter\", prog_fd);\n\tif (CHECK(efd < 0, \"raw_tp_open\", \"err %d errno %d\\n\", efd, errno))\n\t\tgoto close_prog;\n\n\t \n\tlen = sizeof(buf);\n\terr = bpf_task_fd_query(getpid(), efd, 0, buf, &len, &prog_id,\n\t\t\t\t&fd_type, &probe_offset, &probe_addr);\n\tif (CHECK(err < 0, \"bpf_task_fd_query\", \"err %d errno %d\\n\", err,\n\t\t  errno))\n\t\tgoto close_prog;\n\n\terr = fd_type == BPF_FD_TYPE_RAW_TRACEPOINT &&\n\t      strcmp(buf, \"sys_enter\") == 0;\n\tif (CHECK(!err, \"check_results\", \"fd_type %d tp_name %s\\n\",\n\t\t  fd_type, buf))\n\t\tgoto close_prog;\n\n\t \n\tlen = 0;\n\terr = bpf_task_fd_query(getpid(), efd, 0, buf, &len, &prog_id,\n\t\t\t\t&fd_type, &probe_offset, &probe_addr);\n\tif (CHECK(err < 0, \"bpf_task_fd_query (len = 0)\", \"err %d errno %d\\n\",\n\t\t  err, errno))\n\t\tgoto close_prog;\n\terr = fd_type == BPF_FD_TYPE_RAW_TRACEPOINT &&\n\t      len == strlen(\"sys_enter\");\n\tif (CHECK(!err, \"check_results\", \"fd_type %d len %u\\n\", fd_type, len))\n\t\tgoto close_prog;\n\n\t \n\tlen = sizeof(buf);\n\terr = bpf_task_fd_query(getpid(), efd, 0, 0, &len, &prog_id,\n\t\t\t\t&fd_type, &probe_offset, &probe_addr);\n\tif (CHECK(err < 0, \"bpf_task_fd_query (buf = 0)\", \"err %d errno %d\\n\",\n\t\t  err, errno))\n\t\tgoto close_prog;\n\terr = fd_type == BPF_FD_TYPE_RAW_TRACEPOINT &&\n\t      len == strlen(\"sys_enter\");\n\tif (CHECK(!err, \"check_results\", \"fd_type %d len %u\\n\", fd_type, len))\n\t\tgoto close_prog;\n\n\t \n\tlen = 3;\n\terr = bpf_task_fd_query(getpid(), efd, 0, buf, &len, &prog_id,\n\t\t\t\t&fd_type, &probe_offset, &probe_addr);\n\tif (CHECK(err >= 0 || errno != ENOSPC, \"bpf_task_fd_query (len = 3)\",\n\t\t  \"err %d errno %d\\n\", err, errno))\n\t\tgoto close_prog;\n\terr = fd_type == BPF_FD_TYPE_RAW_TRACEPOINT &&\n\t      len == strlen(\"sys_enter\") &&\n\t      strcmp(buf, \"sy\") == 0;\n\tif (CHECK(!err, \"check_results\", \"fd_type %d len %u\\n\", fd_type, len))\n\t\tgoto close_prog;\n\nclose_prog:\n\tbpf_object__close(obj);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}