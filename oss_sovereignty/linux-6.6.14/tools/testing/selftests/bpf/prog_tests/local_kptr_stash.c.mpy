{
  "module_name": "local_kptr_stash.c",
  "hash_id": "9b0b6a7bd0a23ccf88cbc00ef55d50d4f32e70392169acdc38cc8f0173904362",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/bpf/prog_tests/local_kptr_stash.c",
  "human_readable_source": "\n \n\n#include <test_progs.h>\n#include <network_helpers.h>\n\n#include \"local_kptr_stash.skel.h\"\n#include \"local_kptr_stash_fail.skel.h\"\nstatic void test_local_kptr_stash_simple(void)\n{\n\tLIBBPF_OPTS(bpf_test_run_opts, opts,\n\t\t    .data_in = &pkt_v4,\n\t\t    .data_size_in = sizeof(pkt_v4),\n\t\t    .repeat = 1,\n\t);\n\tstruct local_kptr_stash *skel;\n\tint ret;\n\n\tskel = local_kptr_stash__open_and_load();\n\tif (!ASSERT_OK_PTR(skel, \"local_kptr_stash__open_and_load\"))\n\t\treturn;\n\n\tret = bpf_prog_test_run_opts(bpf_program__fd(skel->progs.stash_rb_nodes), &opts);\n\tASSERT_OK(ret, \"local_kptr_stash_add_nodes run\");\n\tASSERT_OK(opts.retval, \"local_kptr_stash_add_nodes retval\");\n\n\tlocal_kptr_stash__destroy(skel);\n}\n\nstatic void test_local_kptr_stash_plain(void)\n{\n\tLIBBPF_OPTS(bpf_test_run_opts, opts,\n\t\t    .data_in = &pkt_v4,\n\t\t    .data_size_in = sizeof(pkt_v4),\n\t\t    .repeat = 1,\n\t);\n\tstruct local_kptr_stash *skel;\n\tint ret;\n\n\tskel = local_kptr_stash__open_and_load();\n\tif (!ASSERT_OK_PTR(skel, \"local_kptr_stash__open_and_load\"))\n\t\treturn;\n\n\tret = bpf_prog_test_run_opts(bpf_program__fd(skel->progs.stash_plain), &opts);\n\tASSERT_OK(ret, \"local_kptr_stash_add_plain run\");\n\tASSERT_OK(opts.retval, \"local_kptr_stash_add_plain retval\");\n\n\tlocal_kptr_stash__destroy(skel);\n}\n\nstatic void test_local_kptr_stash_unstash(void)\n{\n\tLIBBPF_OPTS(bpf_test_run_opts, opts,\n\t\t    .data_in = &pkt_v4,\n\t\t    .data_size_in = sizeof(pkt_v4),\n\t\t    .repeat = 1,\n\t);\n\tstruct local_kptr_stash *skel;\n\tint ret;\n\n\tskel = local_kptr_stash__open_and_load();\n\tif (!ASSERT_OK_PTR(skel, \"local_kptr_stash__open_and_load\"))\n\t\treturn;\n\n\tret = bpf_prog_test_run_opts(bpf_program__fd(skel->progs.stash_rb_nodes), &opts);\n\tASSERT_OK(ret, \"local_kptr_stash_add_nodes run\");\n\tASSERT_OK(opts.retval, \"local_kptr_stash_add_nodes retval\");\n\n\tret = bpf_prog_test_run_opts(bpf_program__fd(skel->progs.unstash_rb_node), &opts);\n\tASSERT_OK(ret, \"local_kptr_stash_add_nodes run\");\n\tASSERT_EQ(opts.retval, 42, \"local_kptr_stash_add_nodes retval\");\n\n\tlocal_kptr_stash__destroy(skel);\n}\n\nstatic void test_local_kptr_stash_fail(void)\n{\n\tRUN_TESTS(local_kptr_stash_fail);\n}\n\nvoid test_local_kptr_stash(void)\n{\n\tif (test__start_subtest(\"local_kptr_stash_simple\"))\n\t\ttest_local_kptr_stash_simple();\n\tif (test__start_subtest(\"local_kptr_stash_plain\"))\n\t\ttest_local_kptr_stash_plain();\n\tif (test__start_subtest(\"local_kptr_stash_unstash\"))\n\t\ttest_local_kptr_stash_unstash();\n\tif (test__start_subtest(\"local_kptr_stash_fail\"))\n\t\ttest_local_kptr_stash_fail();\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}