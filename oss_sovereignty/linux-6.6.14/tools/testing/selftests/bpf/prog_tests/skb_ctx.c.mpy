{
  "module_name": "skb_ctx.c",
  "hash_id": "5185eaa88ee95fcdc9eb94e8b2dfddef8eb03721a70d483d7eeb50806030c392",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/bpf/prog_tests/skb_ctx.c",
  "human_readable_source": "\n#include <test_progs.h>\n#include <network_helpers.h>\n\nvoid test_skb_ctx(void)\n{\n\tstruct __sk_buff skb = {\n\t\t.cb[0] = 1,\n\t\t.cb[1] = 2,\n\t\t.cb[2] = 3,\n\t\t.cb[3] = 4,\n\t\t.cb[4] = 5,\n\t\t.priority = 6,\n\t\t.ingress_ifindex = 11,\n\t\t.ifindex = 1,\n\t\t.tstamp = 7,\n\t\t.wire_len = 100,\n\t\t.gso_segs = 8,\n\t\t.mark = 9,\n\t\t.gso_size = 10,\n\t\t.hwtstamp = 11,\n\t};\n\tLIBBPF_OPTS(bpf_test_run_opts, tattr,\n\t\t.data_in = &pkt_v4,\n\t\t.data_size_in = sizeof(pkt_v4),\n\t\t.ctx_in = &skb,\n\t\t.ctx_size_in = sizeof(skb),\n\t\t.ctx_out = &skb,\n\t\t.ctx_size_out = sizeof(skb),\n\t);\n\tstruct bpf_object *obj;\n\tint err, prog_fd, i;\n\n\terr = bpf_prog_test_load(\"./test_skb_ctx.bpf.o\", BPF_PROG_TYPE_SCHED_CLS,\n\t\t\t\t &obj, &prog_fd);\n\tif (!ASSERT_OK(err, \"load\"))\n\t\treturn;\n\n\t \n\n\ttattr.ctx_size_in = 0;\n\terr = bpf_prog_test_run_opts(prog_fd, &tattr);\n\tASSERT_NEQ(err, 0, \"ctx_size_in\");\n\ttattr.ctx_size_in = sizeof(skb);\n\n\t \n\n\ttattr.ctx_size_out = 0;\n\terr = bpf_prog_test_run_opts(prog_fd, &tattr);\n\tASSERT_NEQ(err, 0, \"ctx_size_out\");\n\ttattr.ctx_size_out = sizeof(skb);\n\n\t \n\n\tskb.len = 1;\n\terr = bpf_prog_test_run_opts(prog_fd, &tattr);\n\tASSERT_NEQ(err, 0, \"len\");\n\tskb.len = 0;\n\n\tskb.tc_index = 1;\n\terr = bpf_prog_test_run_opts(prog_fd, &tattr);\n\tASSERT_NEQ(err, 0, \"tc_index\");\n\tskb.tc_index = 0;\n\n\t \n\n\tskb.hash = 1;\n\terr = bpf_prog_test_run_opts(prog_fd, &tattr);\n\tASSERT_NEQ(err, 0, \"hash\");\n\tskb.hash = 0;\n\n\tskb.sk = (struct bpf_sock *)1;\n\terr = bpf_prog_test_run_opts(prog_fd, &tattr);\n\tASSERT_NEQ(err, 0, \"sk\");\n\tskb.sk = 0;\n\n\terr = bpf_prog_test_run_opts(prog_fd, &tattr);\n\tASSERT_OK(err, \"test_run\");\n\tASSERT_OK(tattr.retval, \"test_run retval\");\n\tASSERT_EQ(tattr.ctx_size_out, sizeof(skb), \"ctx_size_out\");\n\n\tfor (i = 0; i < 5; i++)\n\t\tASSERT_EQ(skb.cb[i], i + 2, \"ctx_out_cb\");\n\tASSERT_EQ(skb.priority, 7, \"ctx_out_priority\");\n\tASSERT_EQ(skb.ifindex, 1, \"ctx_out_ifindex\");\n\tASSERT_EQ(skb.ingress_ifindex, 11, \"ctx_out_ingress_ifindex\");\n\tASSERT_EQ(skb.tstamp, 8, \"ctx_out_tstamp\");\n\tASSERT_EQ(skb.mark, 10, \"ctx_out_mark\");\n\n\tbpf_object__close(obj);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}