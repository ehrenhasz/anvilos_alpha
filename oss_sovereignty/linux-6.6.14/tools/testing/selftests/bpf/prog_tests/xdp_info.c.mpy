{
  "module_name": "xdp_info.c",
  "hash_id": "10ad2e0d0a50a4bdf2963a07b6f213bfe0cb068649586cbdc22e6aec5ddce5c4",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/bpf/prog_tests/xdp_info.c",
  "human_readable_source": "\n#include <linux/if_link.h>\n#include <test_progs.h>\n\n#define IFINDEX_LO 1\n\nvoid serial_test_xdp_info(void)\n{\n\t__u32 len = sizeof(struct bpf_prog_info), duration = 0, prog_id;\n\tconst char *file = \"./xdp_dummy.bpf.o\";\n\tLIBBPF_OPTS(bpf_xdp_query_opts, opts);\n\tstruct bpf_prog_info info = {};\n\tstruct bpf_object *obj;\n\tint err, prog_fd;\n\n\t \n\n\terr = bpf_xdp_query_id(IFINDEX_LO, 0, &prog_id);\n\tif (CHECK(err, \"get_xdp_none\", \"errno=%d\\n\", errno))\n\t\treturn;\n\tif (CHECK(prog_id, \"prog_id_none\", \"unexpected prog_id=%u\\n\", prog_id))\n\t\treturn;\n\n\terr = bpf_xdp_query_id(IFINDEX_LO, XDP_FLAGS_SKB_MODE, &prog_id);\n\tif (CHECK(err, \"get_xdp_none_skb\", \"errno=%d\\n\", errno))\n\t\treturn;\n\tif (CHECK(prog_id, \"prog_id_none_skb\", \"unexpected prog_id=%u\\n\",\n\t\t  prog_id))\n\t\treturn;\n\n\t \n\n\terr = bpf_prog_test_load(file, BPF_PROG_TYPE_XDP, &obj, &prog_fd);\n\tif (CHECK_FAIL(err))\n\t\treturn;\n\n\terr = bpf_prog_get_info_by_fd(prog_fd, &info, &len);\n\tif (CHECK(err, \"get_prog_info\", \"errno=%d\\n\", errno))\n\t\tgoto out_close;\n\n\terr = bpf_xdp_attach(IFINDEX_LO, prog_fd, XDP_FLAGS_SKB_MODE, NULL);\n\tif (CHECK(err, \"set_xdp_skb\", \"errno=%d\\n\", errno))\n\t\tgoto out_close;\n\n\t \n\n\terr = bpf_xdp_query_id(IFINDEX_LO, 0, &prog_id);\n\tif (CHECK(err, \"get_xdp\", \"errno=%d\\n\", errno))\n\t\tgoto out;\n\tif (CHECK(prog_id != info.id, \"prog_id\", \"prog_id not available\\n\"))\n\t\tgoto out;\n\n\terr = bpf_xdp_query_id(IFINDEX_LO, XDP_FLAGS_SKB_MODE, &prog_id);\n\tif (CHECK(err, \"get_xdp_skb\", \"errno=%d\\n\", errno))\n\t\tgoto out;\n\tif (CHECK(prog_id != info.id, \"prog_id_skb\", \"prog_id not available\\n\"))\n\t\tgoto out;\n\n\terr = bpf_xdp_query_id(IFINDEX_LO, XDP_FLAGS_DRV_MODE, &prog_id);\n\tif (CHECK(err, \"get_xdp_drv\", \"errno=%d\\n\", errno))\n\t\tgoto out;\n\tif (CHECK(prog_id, \"prog_id_drv\", \"unexpected prog_id=%u\\n\", prog_id))\n\t\tgoto out;\n\n\t \n\topts.feature_flags = ~0;\n\terr = bpf_xdp_query(IFINDEX_LO, XDP_FLAGS_DRV_MODE, &opts);\n\tif (!ASSERT_OK(err, \"bpf_xdp_query\"))\n\t\tgoto out;\n\n\tASSERT_EQ(opts.feature_flags, 0, \"opts.feature_flags\");\nout:\n\tbpf_xdp_detach(IFINDEX_LO, 0, NULL);\nout_close:\n\tbpf_object__close(obj);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}