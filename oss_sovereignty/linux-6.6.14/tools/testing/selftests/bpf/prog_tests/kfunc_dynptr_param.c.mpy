{
  "module_name": "kfunc_dynptr_param.c",
  "hash_id": "a9bc8f3d4ce39c0eb3bdd5da77b29d0c897d682a2103c850a9c17ad176f1f7b3",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/bpf/prog_tests/kfunc_dynptr_param.c",
  "human_readable_source": "\n\n \n\n#include <test_progs.h>\n#include \"test_kfunc_dynptr_param.skel.h\"\n\nstatic struct {\n\tconst char *prog_name;\n\tint expected_runtime_err;\n} kfunc_dynptr_tests[] = {\n\t{\"dynptr_data_null\", -EBADMSG},\n};\n\nstatic bool kfunc_not_supported;\n\nstatic int libbpf_print_cb(enum libbpf_print_level level, const char *fmt,\n\t\t\t   va_list args)\n{\n\tif (strcmp(fmt, \"libbpf: extern (func ksym) '%s': not found in kernel or module BTFs\\n\"))\n\t\treturn 0;\n\n\tif (strcmp(va_arg(args, char *), \"bpf_verify_pkcs7_signature\"))\n\t\treturn 0;\n\n\tkfunc_not_supported = true;\n\treturn 0;\n}\n\nstatic bool has_pkcs7_kfunc_support(void)\n{\n\tstruct test_kfunc_dynptr_param *skel;\n\tlibbpf_print_fn_t old_print_cb;\n\tint err;\n\n\tskel = test_kfunc_dynptr_param__open();\n\tif (!ASSERT_OK_PTR(skel, \"test_kfunc_dynptr_param__open\"))\n\t\treturn false;\n\n\tkfunc_not_supported = false;\n\n\told_print_cb = libbpf_set_print(libbpf_print_cb);\n\terr = test_kfunc_dynptr_param__load(skel);\n\tlibbpf_set_print(old_print_cb);\n\n\tif (err < 0 && kfunc_not_supported) {\n\t\tfprintf(stderr,\n\t\t  \"%s:SKIP:bpf_verify_pkcs7_signature() kfunc not supported\\n\",\n\t\t  __func__);\n\t\ttest_kfunc_dynptr_param__destroy(skel);\n\t\treturn false;\n\t}\n\n\ttest_kfunc_dynptr_param__destroy(skel);\n\n\treturn true;\n}\n\nstatic void verify_success(const char *prog_name, int expected_runtime_err)\n{\n\tstruct test_kfunc_dynptr_param *skel;\n\tstruct bpf_program *prog;\n\tstruct bpf_link *link;\n\t__u32 next_id;\n\tint err;\n\n\tskel = test_kfunc_dynptr_param__open();\n\tif (!ASSERT_OK_PTR(skel, \"test_kfunc_dynptr_param__open\"))\n\t\treturn;\n\n\tskel->bss->pid = getpid();\n\n\terr = test_kfunc_dynptr_param__load(skel);\n\n\tif (!ASSERT_OK(err, \"test_kfunc_dynptr_param__load\"))\n\t\tgoto cleanup;\n\n\tprog = bpf_object__find_program_by_name(skel->obj, prog_name);\n\tif (!ASSERT_OK_PTR(prog, \"bpf_object__find_program_by_name\"))\n\t\tgoto cleanup;\n\n\tlink = bpf_program__attach(prog);\n\tif (!ASSERT_OK_PTR(link, \"bpf_program__attach\"))\n\t\tgoto cleanup;\n\n\terr = bpf_prog_get_next_id(0, &next_id);\n\n\tbpf_link__destroy(link);\n\n\tif (!ASSERT_OK(err, \"bpf_prog_get_next_id\"))\n\t\tgoto cleanup;\n\n\tASSERT_EQ(skel->bss->err, expected_runtime_err, \"err\");\n\ncleanup:\n\ttest_kfunc_dynptr_param__destroy(skel);\n}\n\nvoid test_kfunc_dynptr_param(void)\n{\n\tint i;\n\n\tif (!has_pkcs7_kfunc_support())\n\t\treturn;\n\n\tfor (i = 0; i < ARRAY_SIZE(kfunc_dynptr_tests); i++) {\n\t\tif (!test__start_subtest(kfunc_dynptr_tests[i].prog_name))\n\t\t\tcontinue;\n\n\t\tverify_success(kfunc_dynptr_tests[i].prog_name,\n\t\t\tkfunc_dynptr_tests[i].expected_runtime_err);\n\t}\n\tRUN_TESTS(test_kfunc_dynptr_param);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}