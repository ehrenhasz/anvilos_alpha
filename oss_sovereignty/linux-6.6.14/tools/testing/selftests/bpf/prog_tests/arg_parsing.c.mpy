{
  "module_name": "arg_parsing.c",
  "hash_id": "8efadd48b6284048494ce5d259b346069bd5b787d43c1a77f530820c6b3f44d2",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/bpf/prog_tests/arg_parsing.c",
  "human_readable_source": "\n\n#include \"test_progs.h\"\n#include \"testing_helpers.h\"\n\nstatic void init_test_filter_set(struct test_filter_set *set)\n{\n\tset->cnt = 0;\n\tset->tests = NULL;\n}\n\nstatic void free_test_filter_set(struct test_filter_set *set)\n{\n\tint i, j;\n\n\tfor (i = 0; i < set->cnt; i++) {\n\t\tfor (j = 0; j < set->tests[i].subtest_cnt; j++)\n\t\t\tfree((void *)set->tests[i].subtests[j]);\n\t\tfree(set->tests[i].subtests);\n\t\tfree(set->tests[i].name);\n\t}\n\n\tfree(set->tests);\n\tinit_test_filter_set(set);\n}\n\nstatic void test_parse_test_list(void)\n{\n\tstruct test_filter_set set;\n\n\tinit_test_filter_set(&set);\n\n\tASSERT_OK(parse_test_list(\"arg_parsing\", &set, true), \"parsing\");\n\tif (!ASSERT_EQ(set.cnt, 1, \"test filters count\"))\n\t\tgoto error;\n\tif (!ASSERT_OK_PTR(set.tests, \"test filters initialized\"))\n\t\tgoto error;\n\tASSERT_EQ(set.tests[0].subtest_cnt, 0, \"subtest filters count\");\n\tASSERT_OK(strcmp(\"arg_parsing\", set.tests[0].name), \"subtest name\");\n\tfree_test_filter_set(&set);\n\n\tASSERT_OK(parse_test_list(\"arg_parsing,bpf_cookie\", &set, true),\n\t\t  \"parsing\");\n\tif (!ASSERT_EQ(set.cnt, 2, \"count of test filters\"))\n\t\tgoto error;\n\tif (!ASSERT_OK_PTR(set.tests, \"test filters initialized\"))\n\t\tgoto error;\n\tASSERT_EQ(set.tests[0].subtest_cnt, 0, \"subtest filters count\");\n\tASSERT_EQ(set.tests[1].subtest_cnt, 0, \"subtest filters count\");\n\tASSERT_OK(strcmp(\"arg_parsing\", set.tests[0].name), \"test name\");\n\tASSERT_OK(strcmp(\"bpf_cookie\", set.tests[1].name), \"test name\");\n\tfree_test_filter_set(&set);\n\n\tASSERT_OK(parse_test_list(\"arg_parsing/arg_parsing,bpf_cookie\",\n\t\t\t\t  &set,\n\t\t\t\t  true),\n\t\t  \"parsing\");\n\tif (!ASSERT_EQ(set.cnt, 2, \"count of test filters\"))\n\t\tgoto error;\n\tif (!ASSERT_OK_PTR(set.tests, \"test filters initialized\"))\n\t\tgoto error;\n\tif (!ASSERT_EQ(set.tests[0].subtest_cnt, 1, \"subtest filters count\"))\n\t\tgoto error;\n\tASSERT_EQ(set.tests[1].subtest_cnt, 0, \"subtest filters count\");\n\tASSERT_OK(strcmp(\"arg_parsing\", set.tests[0].name), \"test name\");\n\tASSERT_OK(strcmp(\"arg_parsing\", set.tests[0].subtests[0]),\n\t\t  \"subtest name\");\n\tASSERT_OK(strcmp(\"bpf_cookie\", set.tests[1].name), \"test name\");\n\tfree_test_filter_set(&set);\n\n\tASSERT_OK(parse_test_list(\"arg_parsing/arg_parsing\", &set, true),\n\t\t  \"parsing\");\n\tASSERT_OK(parse_test_list(\"bpf_cookie\", &set, true), \"parsing\");\n\tASSERT_OK(parse_test_list(\"send_signal\", &set, true), \"parsing\");\n\tif (!ASSERT_EQ(set.cnt, 3, \"count of test filters\"))\n\t\tgoto error;\n\tif (!ASSERT_OK_PTR(set.tests, \"test filters initialized\"))\n\t\tgoto error;\n\tif (!ASSERT_EQ(set.tests[0].subtest_cnt, 1, \"subtest filters count\"))\n\t\tgoto error;\n\tASSERT_EQ(set.tests[1].subtest_cnt, 0, \"subtest filters count\");\n\tASSERT_EQ(set.tests[2].subtest_cnt, 0, \"subtest filters count\");\n\tASSERT_OK(strcmp(\"arg_parsing\", set.tests[0].name), \"test name\");\n\tASSERT_OK(strcmp(\"arg_parsing\", set.tests[0].subtests[0]),\n\t\t  \"subtest name\");\n\tASSERT_OK(strcmp(\"bpf_cookie\", set.tests[1].name), \"test name\");\n\tASSERT_OK(strcmp(\"send_signal\", set.tests[2].name), \"test name\");\n\tfree_test_filter_set(&set);\n\n\tASSERT_OK(parse_test_list(\"bpf_cookie/trace\", &set, false), \"parsing\");\n\tif (!ASSERT_EQ(set.cnt, 1, \"count of test filters\"))\n\t\tgoto error;\n\tif (!ASSERT_OK_PTR(set.tests, \"test filters initialized\"))\n\t\tgoto error;\n\tif (!ASSERT_EQ(set.tests[0].subtest_cnt, 1, \"subtest filters count\"))\n\t\tgoto error;\n\tASSERT_OK(strcmp(\"*bpf_cookie*\", set.tests[0].name), \"test name\");\n\tASSERT_OK(strcmp(\"*trace*\", set.tests[0].subtests[0]), \"subtest name\");\n\tfree_test_filter_set(&set);\n\n\tASSERT_OK(parse_test_list(\"t/subtest1,t/subtest2\", &set, true),\n\t\t  \"parsing\");\n\tif (!ASSERT_EQ(set.cnt, 1, \"count of test filters\"))\n\t\tgoto error;\n\tif (!ASSERT_OK_PTR(set.tests, \"test filters initialized\"))\n\t\tgoto error;\n\tif (!ASSERT_EQ(set.tests[0].subtest_cnt, 2, \"subtest filters count\"))\n\t\tgoto error;\n\tASSERT_OK(strcmp(\"t\", set.tests[0].name), \"test name\");\n\tASSERT_OK(strcmp(\"subtest1\", set.tests[0].subtests[0]), \"subtest name\");\n\tASSERT_OK(strcmp(\"subtest2\", set.tests[0].subtests[1]), \"subtest name\");\nerror:\n\tfree_test_filter_set(&set);\n}\n\nstatic void test_parse_test_list_file(void)\n{\n\tstruct test_filter_set set;\n\tchar tmpfile[80];\n\tFILE *fp;\n\tint fd;\n\n\tsnprintf(tmpfile, sizeof(tmpfile), \"/tmp/bpf_arg_parsing_test.XXXXXX\");\n\tfd = mkstemp(tmpfile);\n\tif (!ASSERT_GE(fd, 0, \"create tmp\"))\n\t\treturn;\n\n\tfp = fdopen(fd, \"w\");\n\tif (!ASSERT_NEQ(fp, NULL, \"fdopen tmp\")) {\n\t\tclose(fd);\n\t\tgoto out_remove;\n\t}\n\n\tfprintf(fp, \"# comment\\n\");\n\tfprintf(fp, \"  test_with_spaces    \\n\");\n\tfprintf(fp, \"testA/subtest    # comment\\n\");\n\tfprintf(fp, \"testB#comment with no space\\n\");\n\tfprintf(fp, \"testB # duplicate\\n\");\n\tfprintf(fp, \"testA/subtest # subtest duplicate\\n\");\n\tfprintf(fp, \"testA/subtest2\\n\");\n\tfprintf(fp, \"testC_no_eof_newline\");\n\tfflush(fp);\n\n\tif (!ASSERT_OK(ferror(fp), \"prepare tmp\"))\n\t\tgoto out_fclose;\n\n\tinit_test_filter_set(&set);\n\n\tASSERT_OK(parse_test_list_file(tmpfile, &set, true), \"parse file\");\n\n\tASSERT_EQ(set.cnt, 4, \"test  count\");\n\tASSERT_OK(strcmp(\"test_with_spaces\", set.tests[0].name), \"test 0 name\");\n\tASSERT_EQ(set.tests[0].subtest_cnt, 0, \"test 0 subtest count\");\n\tASSERT_OK(strcmp(\"testA\", set.tests[1].name), \"test 1 name\");\n\tASSERT_EQ(set.tests[1].subtest_cnt, 2, \"test 1 subtest count\");\n\tASSERT_OK(strcmp(\"subtest\", set.tests[1].subtests[0]), \"test 1 subtest 0\");\n\tASSERT_OK(strcmp(\"subtest2\", set.tests[1].subtests[1]), \"test 1 subtest 1\");\n\tASSERT_OK(strcmp(\"testB\", set.tests[2].name), \"test 2 name\");\n\tASSERT_OK(strcmp(\"testC_no_eof_newline\", set.tests[3].name), \"test 3 name\");\n\n\tfree_test_filter_set(&set);\n\nout_fclose:\n\tfclose(fp);\nout_remove:\n\tremove(tmpfile);\n}\n\nvoid test_arg_parsing(void)\n{\n\tif (test__start_subtest(\"test_parse_test_list\"))\n\t\ttest_parse_test_list();\n\tif (test__start_subtest(\"test_parse_test_list_file\"))\n\t\ttest_parse_test_list_file();\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}