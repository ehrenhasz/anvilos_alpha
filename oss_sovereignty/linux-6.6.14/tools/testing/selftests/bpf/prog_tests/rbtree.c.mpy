{
  "module_name": "rbtree.c",
  "hash_id": "a0bb7b1d25c4e095ff024d4a1007db55573c358f6ed650021f516daaa74bf270",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/bpf/prog_tests/rbtree.c",
  "human_readable_source": "\n \n\n#include <test_progs.h>\n#include <network_helpers.h>\n\n#include \"rbtree.skel.h\"\n#include \"rbtree_fail.skel.h\"\n#include \"rbtree_btf_fail__wrong_node_type.skel.h\"\n#include \"rbtree_btf_fail__add_wrong_type.skel.h\"\n\nstatic void test_rbtree_add_nodes(void)\n{\n\tLIBBPF_OPTS(bpf_test_run_opts, opts,\n\t\t    .data_in = &pkt_v4,\n\t\t    .data_size_in = sizeof(pkt_v4),\n\t\t    .repeat = 1,\n\t);\n\tstruct rbtree *skel;\n\tint ret;\n\n\tskel = rbtree__open_and_load();\n\tif (!ASSERT_OK_PTR(skel, \"rbtree__open_and_load\"))\n\t\treturn;\n\n\tret = bpf_prog_test_run_opts(bpf_program__fd(skel->progs.rbtree_add_nodes), &opts);\n\tASSERT_OK(ret, \"rbtree_add_nodes run\");\n\tASSERT_OK(opts.retval, \"rbtree_add_nodes retval\");\n\tASSERT_EQ(skel->data->less_callback_ran, 1, \"rbtree_add_nodes less_callback_ran\");\n\n\trbtree__destroy(skel);\n}\n\nstatic void test_rbtree_add_and_remove(void)\n{\n\tLIBBPF_OPTS(bpf_test_run_opts, opts,\n\t\t    .data_in = &pkt_v4,\n\t\t    .data_size_in = sizeof(pkt_v4),\n\t\t    .repeat = 1,\n\t);\n\tstruct rbtree *skel;\n\tint ret;\n\n\tskel = rbtree__open_and_load();\n\tif (!ASSERT_OK_PTR(skel, \"rbtree__open_and_load\"))\n\t\treturn;\n\n\tret = bpf_prog_test_run_opts(bpf_program__fd(skel->progs.rbtree_add_and_remove), &opts);\n\tASSERT_OK(ret, \"rbtree_add_and_remove\");\n\tASSERT_OK(opts.retval, \"rbtree_add_and_remove retval\");\n\tASSERT_EQ(skel->data->removed_key, 5, \"rbtree_add_and_remove first removed key\");\n\n\trbtree__destroy(skel);\n}\n\nstatic void test_rbtree_first_and_remove(void)\n{\n\tLIBBPF_OPTS(bpf_test_run_opts, opts,\n\t\t    .data_in = &pkt_v4,\n\t\t    .data_size_in = sizeof(pkt_v4),\n\t\t    .repeat = 1,\n\t);\n\tstruct rbtree *skel;\n\tint ret;\n\n\tskel = rbtree__open_and_load();\n\tif (!ASSERT_OK_PTR(skel, \"rbtree__open_and_load\"))\n\t\treturn;\n\n\tret = bpf_prog_test_run_opts(bpf_program__fd(skel->progs.rbtree_first_and_remove), &opts);\n\tASSERT_OK(ret, \"rbtree_first_and_remove\");\n\tASSERT_OK(opts.retval, \"rbtree_first_and_remove retval\");\n\tASSERT_EQ(skel->data->first_data[0], 2, \"rbtree_first_and_remove first rbtree_first()\");\n\tASSERT_EQ(skel->data->removed_key, 1, \"rbtree_first_and_remove first removed key\");\n\tASSERT_EQ(skel->data->first_data[1], 4, \"rbtree_first_and_remove second rbtree_first()\");\n\n\trbtree__destroy(skel);\n}\n\nstatic void test_rbtree_api_release_aliasing(void)\n{\n\tLIBBPF_OPTS(bpf_test_run_opts, opts,\n\t\t    .data_in = &pkt_v4,\n\t\t    .data_size_in = sizeof(pkt_v4),\n\t\t    .repeat = 1,\n\t);\n\tstruct rbtree *skel;\n\tint ret;\n\n\tskel = rbtree__open_and_load();\n\tif (!ASSERT_OK_PTR(skel, \"rbtree__open_and_load\"))\n\t\treturn;\n\n\tret = bpf_prog_test_run_opts(bpf_program__fd(skel->progs.rbtree_api_release_aliasing), &opts);\n\tASSERT_OK(ret, \"rbtree_api_release_aliasing\");\n\tASSERT_OK(opts.retval, \"rbtree_api_release_aliasing retval\");\n\tASSERT_EQ(skel->data->first_data[0], 42, \"rbtree_api_release_aliasing first rbtree_remove()\");\n\tASSERT_EQ(skel->data->first_data[1], -1, \"rbtree_api_release_aliasing second rbtree_remove()\");\n\n\trbtree__destroy(skel);\n}\n\nvoid test_rbtree_success(void)\n{\n\tif (test__start_subtest(\"rbtree_add_nodes\"))\n\t\ttest_rbtree_add_nodes();\n\tif (test__start_subtest(\"rbtree_add_and_remove\"))\n\t\ttest_rbtree_add_and_remove();\n\tif (test__start_subtest(\"rbtree_first_and_remove\"))\n\t\ttest_rbtree_first_and_remove();\n\tif (test__start_subtest(\"rbtree_api_release_aliasing\"))\n\t\ttest_rbtree_api_release_aliasing();\n}\n\n#define BTF_FAIL_TEST(suffix)\t\t\t\t\t\t\t\t\t\\\nvoid test_rbtree_btf_fail__##suffix(void)\t\t\t\t\t\t\t\\\n{\t\t\t\t\t\t\t\t\t\t\t\t\\\n\tstruct rbtree_btf_fail__##suffix *skel;\t\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\t\t\t\\\n\tskel = rbtree_btf_fail__##suffix##__open_and_load();\t\t\t\t\t\\\n\tif (!ASSERT_ERR_PTR(skel,\t\t\t\t\t\t\t\t\\\n\t\t\t    \"rbtree_btf_fail__\" #suffix \"__open_and_load unexpected success\"))\t\\\n\t\trbtree_btf_fail__##suffix##__destroy(skel);\t\t\t\t\t\\\n}\n\n#define RUN_BTF_FAIL_TEST(suffix)\t\t\t\t\\\n\tif (test__start_subtest(\"rbtree_btf_fail__\" #suffix))\t\\\n\t\ttest_rbtree_btf_fail__##suffix();\n\nBTF_FAIL_TEST(wrong_node_type);\nBTF_FAIL_TEST(add_wrong_type);\n\nvoid test_rbtree_btf_fail(void)\n{\n\tRUN_BTF_FAIL_TEST(wrong_node_type);\n\tRUN_BTF_FAIL_TEST(add_wrong_type);\n}\n\nvoid test_rbtree_fail(void)\n{\n\tRUN_TESTS(rbtree_fail);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}