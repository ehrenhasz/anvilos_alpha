{
  "module_name": "sockopt_qos_to_cc.c",
  "hash_id": "a31f405a911bc9f082c4fa49a552291cf12e19ba5c82ce7d7d50f6f7e787fc8c",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/bpf/prog_tests/sockopt_qos_to_cc.c",
  "human_readable_source": "\n \n#include <test_progs.h>\n#include <netinet/tcp.h>\n#include \"sockopt_qos_to_cc.skel.h\"\n\nstatic void run_setsockopt_test(int cg_fd, int sock_fd)\n{\n\tsocklen_t optlen;\n\tchar cc[16];  \n\tint buf;\n\tint err = -1;\n\n\tbuf = 0x2D;\n\terr = setsockopt(sock_fd, SOL_IPV6, IPV6_TCLASS, &buf, sizeof(buf));\n\tif (!ASSERT_OK(err, \"setsockopt(sock_fd, IPV6_TCLASS)\"))\n\t\treturn;\n\n\t \n\toptlen = sizeof(cc);\n\terr = getsockopt(sock_fd, SOL_TCP, TCP_CONGESTION, cc, &optlen);\n\tif (!ASSERT_OK(err, \"getsockopt(sock_fd, TCP_CONGESTION)\"))\n\t\treturn;\n\n\tif (!ASSERT_STREQ(cc, \"reno\", \"getsockopt(sock_fd, TCP_CONGESTION)\"))\n\t\treturn;\n}\n\nvoid test_sockopt_qos_to_cc(void)\n{\n\tstruct sockopt_qos_to_cc *skel;\n\tchar cc_cubic[16] = \"cubic\";  \n\tint cg_fd = -1;\n\tint sock_fd = -1;\n\tint err;\n\n\tcg_fd = test__join_cgroup(\"/sockopt_qos_to_cc\");\n\tif (!ASSERT_GE(cg_fd, 0, \"cg-join(sockopt_qos_to_cc)\"))\n\t\treturn;\n\n\tskel = sockopt_qos_to_cc__open_and_load();\n\tif (!ASSERT_OK_PTR(skel, \"skel\"))\n\t\tgoto done;\n\n\tskel->bss->page_size = sysconf(_SC_PAGESIZE);\n\n\tsock_fd = socket(AF_INET6, SOCK_STREAM, 0);\n\tif (!ASSERT_GE(sock_fd, 0, \"v6 socket open\"))\n\t\tgoto done;\n\n\terr = setsockopt(sock_fd, SOL_TCP, TCP_CONGESTION, &cc_cubic,\n\t\t\t sizeof(cc_cubic));\n\tif (!ASSERT_OK(err, \"setsockopt(sock_fd, TCP_CONGESTION)\"))\n\t\tgoto done;\n\n\tskel->links.sockopt_qos_to_cc =\n\t\tbpf_program__attach_cgroup(skel->progs.sockopt_qos_to_cc,\n\t\t\t\t\t   cg_fd);\n\tif (!ASSERT_OK_PTR(skel->links.sockopt_qos_to_cc,\n\t\t\t   \"prog_attach(sockopt_qos_to_cc)\"))\n\t\tgoto done;\n\n\trun_setsockopt_test(cg_fd, sock_fd);\n\ndone:\n\tif (sock_fd != -1)\n\t\tclose(sock_fd);\n\tif (cg_fd != -1)\n\t\tclose(cg_fd);\n\t \n\tsockopt_qos_to_cc__destroy(skel);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}