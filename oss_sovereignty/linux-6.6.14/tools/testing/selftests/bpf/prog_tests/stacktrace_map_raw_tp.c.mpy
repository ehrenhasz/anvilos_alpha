{
  "module_name": "stacktrace_map_raw_tp.c",
  "hash_id": "964efe42ee778c18bee58b18a871355e4004227b4b8d180794f35962db2cf640",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/bpf/prog_tests/stacktrace_map_raw_tp.c",
  "human_readable_source": "\n#include <test_progs.h>\n\nvoid test_stacktrace_map_raw_tp(void)\n{\n\tconst char *prog_name = \"oncpu\";\n\tint control_map_fd, stackid_hmap_fd, stackmap_fd;\n\tconst char *file = \"./test_stacktrace_map.bpf.o\";\n\t__u32 key, val, duration = 0;\n\tint err, prog_fd;\n\tstruct bpf_program *prog;\n\tstruct bpf_object *obj;\n\tstruct bpf_link *link = NULL;\n\n\terr = bpf_prog_test_load(file, BPF_PROG_TYPE_RAW_TRACEPOINT, &obj, &prog_fd);\n\tif (CHECK(err, \"prog_load raw tp\", \"err %d errno %d\\n\", err, errno))\n\t\treturn;\n\n\tprog = bpf_object__find_program_by_name(obj, prog_name);\n\tif (CHECK(!prog, \"find_prog\", \"prog '%s' not found\\n\", prog_name))\n\t\tgoto close_prog;\n\n\tlink = bpf_program__attach_raw_tracepoint(prog, \"sched_switch\");\n\tif (!ASSERT_OK_PTR(link, \"attach_raw_tp\"))\n\t\tgoto close_prog;\n\n\t \n\tcontrol_map_fd = bpf_find_map(__func__, obj, \"control_map\");\n\tif (CHECK_FAIL(control_map_fd < 0))\n\t\tgoto close_prog;\n\n\tstackid_hmap_fd = bpf_find_map(__func__, obj, \"stackid_hmap\");\n\tif (CHECK_FAIL(stackid_hmap_fd < 0))\n\t\tgoto close_prog;\n\n\tstackmap_fd = bpf_find_map(__func__, obj, \"stackmap\");\n\tif (CHECK_FAIL(stackmap_fd < 0))\n\t\tgoto close_prog;\n\n\t \n\tsleep(1);\n\n\t \n\tkey = 0;\n\tval = 1;\n\tbpf_map_update_elem(control_map_fd, &key, &val, 0);\n\n\t \n\terr = compare_map_keys(stackid_hmap_fd, stackmap_fd);\n\tif (CHECK(err, \"compare_map_keys stackid_hmap vs. stackmap\",\n\t\t  \"err %d errno %d\\n\", err, errno))\n\t\tgoto close_prog;\n\n\terr = compare_map_keys(stackmap_fd, stackid_hmap_fd);\n\tif (CHECK(err, \"compare_map_keys stackmap vs. stackid_hmap\",\n\t\t  \"err %d errno %d\\n\", err, errno))\n\t\tgoto close_prog;\n\nclose_prog:\n\tbpf_link__destroy(link);\n\tbpf_object__close(obj);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}