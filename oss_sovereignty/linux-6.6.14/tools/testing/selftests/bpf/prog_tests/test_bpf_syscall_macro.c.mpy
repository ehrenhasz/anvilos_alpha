{
  "module_name": "test_bpf_syscall_macro.c",
  "hash_id": "a9d59f62201bdec8c3a5d06c9b8c2db699b905a57b7b8ec03302bd9dff7bda68",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/bpf/prog_tests/test_bpf_syscall_macro.c",
  "human_readable_source": "\n \n#define _GNU_SOURCE\n#include <fcntl.h>\n#include <sys/prctl.h>\n#include <test_progs.h>\n#include \"bpf_syscall_macro.skel.h\"\n\nvoid test_bpf_syscall_macro(void)\n{\n\tstruct bpf_syscall_macro *skel = NULL;\n\tint err;\n\tint exp_arg1 = 1001;\n\tunsigned long exp_arg2 = 12;\n\tunsigned long exp_arg3 = 13;\n\tunsigned long exp_arg4 = 14;\n\tunsigned long exp_arg5 = 15;\n\tloff_t off_in, off_out;\n\tssize_t r;\n\n\t \n\tskel = bpf_syscall_macro__open();\n\tif (!ASSERT_OK_PTR(skel, \"bpf_syscall_macro__open\"))\n\t\treturn;\n\n\tskel->rodata->filter_pid = getpid();\n\n\t \n\terr = bpf_syscall_macro__load(skel);\n\tif (!ASSERT_OK(err, \"bpf_syscall_macro__load\"))\n\t\tgoto cleanup;\n\n\t \n\terr = bpf_syscall_macro__attach(skel);\n\tif (!ASSERT_OK(err, \"bpf_syscall_macro__attach\"))\n\t\tgoto cleanup;\n\n\t \n\tprctl(exp_arg1, exp_arg2, exp_arg3, exp_arg4, exp_arg5);\n\n#if defined(__aarch64__) || defined(__s390__)\n\tASSERT_NEQ(skel->bss->arg1, exp_arg1, \"syscall_arg1\");\n#else\n\tASSERT_EQ(skel->bss->arg1, exp_arg1, \"syscall_arg1\");\n#endif\n\tASSERT_EQ(skel->bss->arg2, exp_arg2, \"syscall_arg2\");\n\tASSERT_EQ(skel->bss->arg3, exp_arg3, \"syscall_arg3\");\n\t \n#ifdef __x86_64__\n\tASSERT_NEQ(skel->bss->arg4_cx, exp_arg4, \"syscall_arg4_from_cx\");\n#else\n\tASSERT_EQ(skel->bss->arg4_cx, exp_arg4, \"syscall_arg4_from_cx\");\n#endif\n\tASSERT_EQ(skel->bss->arg4, exp_arg4, \"syscall_arg4\");\n\tASSERT_EQ(skel->bss->arg5, exp_arg5, \"syscall_arg5\");\n\n\t \n\tASSERT_EQ(skel->bss->arg1_core, exp_arg1, \"syscall_arg1_core_variant\");\n\tASSERT_EQ(skel->bss->arg2_core, exp_arg2, \"syscall_arg2_core_variant\");\n\tASSERT_EQ(skel->bss->arg3_core, exp_arg3, \"syscall_arg3_core_variant\");\n\t \n#ifdef __x86_64__\n\tASSERT_NEQ(skel->bss->arg4_core_cx, exp_arg4, \"syscall_arg4_from_cx_core_variant\");\n#else\n\tASSERT_EQ(skel->bss->arg4_core_cx, exp_arg4, \"syscall_arg4_from_cx_core_variant\");\n#endif\n\tASSERT_EQ(skel->bss->arg4_core, exp_arg4, \"syscall_arg4_core_variant\");\n\tASSERT_EQ(skel->bss->arg5_core, exp_arg5, \"syscall_arg5_core_variant\");\n\n\tASSERT_EQ(skel->bss->option_syscall, exp_arg1, \"BPF_KPROBE_SYSCALL_option\");\n\tASSERT_EQ(skel->bss->arg2_syscall, exp_arg2, \"BPF_KPROBE_SYSCALL_arg2\");\n\tASSERT_EQ(skel->bss->arg3_syscall, exp_arg3, \"BPF_KPROBE_SYSCALL_arg3\");\n\tASSERT_EQ(skel->bss->arg4_syscall, exp_arg4, \"BPF_KPROBE_SYSCALL_arg4\");\n\tASSERT_EQ(skel->bss->arg5_syscall, exp_arg5, \"BPF_KPROBE_SYSCALL_arg5\");\n\n\tr = splice(-42, &off_in, 42, &off_out, 0x12340000, SPLICE_F_NONBLOCK);\n\terr = -errno;\n\tASSERT_EQ(r, -1, \"splice_res\");\n\tASSERT_EQ(err, -EBADF, \"splice_err\");\n\n\tASSERT_EQ(skel->bss->splice_fd_in, -42, \"splice_arg1\");\n\tASSERT_EQ(skel->bss->splice_off_in, (__u64)&off_in, \"splice_arg2\");\n\tASSERT_EQ(skel->bss->splice_fd_out, 42, \"splice_arg3\");\n\tASSERT_EQ(skel->bss->splice_off_out, (__u64)&off_out, \"splice_arg4\");\n\tASSERT_EQ(skel->bss->splice_len, 0x12340000, \"splice_arg5\");\n\tASSERT_EQ(skel->bss->splice_flags, SPLICE_F_NONBLOCK, \"splice_arg6\");\n\ncleanup:\n\tbpf_syscall_macro__destroy(skel);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}