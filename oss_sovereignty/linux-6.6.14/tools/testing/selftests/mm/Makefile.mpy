{
  "module_name": "Makefile",
  "hash_id": "8fa27378f6d28e4f16afac47d39c61fcf25312352cf35d0686b0d81f0a00d42f",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/mm/Makefile",
  "human_readable_source": "# SPDX-License-Identifier: GPL-2.0\n# Makefile for mm selftests\n\nLOCAL_HDRS += $(selfdir)/mm/local_config.h $(top_srcdir)/mm/gup_test.h\n\ninclude local_config.mk\n\nifeq ($(ARCH),)\n\nifeq ($(CROSS_COMPILE),)\nuname_M := $(shell uname -m 2>/dev/null || echo not)\nelse\nuname_M := $(shell echo $(CROSS_COMPILE) | grep -o '^[a-z0-9]\\+')\nendif\nARCH ?= $(shell echo $(uname_M) | sed -e 's/aarch64.*/arm64/' -e 's/ppc64.*/ppc64/')\nendif\n\n# Without this, failed build products remain, with up-to-date timestamps,\n# thus tricking Make (and you!) into believing that All Is Well, in subsequent\n# make invocations:\n.DELETE_ON_ERROR:\n\n# Avoid accidental wrong builds, due to built-in rules working just a little\n# bit too well--but not quite as well as required for our situation here.\n#\n# In other words, \"make $SOME_TEST\" is supposed to fail to build at all,\n# because this Makefile only supports either \"make\" (all), or \"make /full/path\".\n# However,  the built-in rules, if not suppressed, will pick up CFLAGS and the\n# initial LDLIBS (but not the target-specific LDLIBS, because those are only\n# set for the full path target!). This causes it to get pretty far into building\n# things despite using incorrect values such as an *occasionally* incomplete\n# LDLIBS.\nMAKEFLAGS += --no-builtin-rules\n\nCFLAGS = -Wall -I $(top_srcdir) $(EXTRA_CFLAGS) $(KHDR_INCLUDES)\nLDLIBS = -lrt -lpthread\n\nTEST_GEN_FILES = cow\nTEST_GEN_FILES += compaction_test\nTEST_GEN_FILES += gup_longterm\nTEST_GEN_FILES += gup_test\nTEST_GEN_FILES += hmm-tests\nTEST_GEN_FILES += hugetlb-madvise\nTEST_GEN_FILES += hugetlb-read-hwpoison\nTEST_GEN_FILES += hugepage-mmap\nTEST_GEN_FILES += hugepage-mremap\nTEST_GEN_FILES += hugepage-shm\nTEST_GEN_FILES += hugepage-vmemmap\nTEST_GEN_FILES += khugepaged\nTEST_GEN_FILES += madv_populate\nTEST_GEN_FILES += map_fixed_noreplace\nTEST_GEN_FILES += map_hugetlb\nTEST_GEN_FILES += map_populate\nTEST_GEN_FILES += memfd_secret\nTEST_GEN_FILES += migration\nTEST_GEN_FILES += mkdirty\nTEST_GEN_FILES += mlock-random-test\nTEST_GEN_FILES += mlock2-tests\nTEST_GEN_FILES += mrelease_test\nTEST_GEN_FILES += mremap_dontunmap\nTEST_GEN_FILES += mremap_test\nTEST_GEN_FILES += on-fault-limit\nTEST_GEN_FILES += thuge-gen\nTEST_GEN_FILES += transhuge-stress\nTEST_GEN_FILES += uffd-stress\nTEST_GEN_FILES += uffd-unit-tests\nTEST_GEN_FILES += split_huge_page_test\nTEST_GEN_FILES += ksm_tests\nTEST_GEN_FILES += ksm_functional_tests\nTEST_GEN_FILES += mdwe_test\n\nifneq ($(ARCH),arm64)\nTEST_GEN_PROGS += soft-dirty\nendif\n\nifeq ($(ARCH),x86_64)\nCAN_BUILD_I386 := $(shell ./../x86/check_cc.sh \"$(CC)\" ../x86/trivial_32bit_program.c -m32)\nCAN_BUILD_X86_64 := $(shell ./../x86/check_cc.sh \"$(CC)\" ../x86/trivial_64bit_program.c)\nCAN_BUILD_WITH_NOPIE := $(shell ./../x86/check_cc.sh \"$(CC)\" ../x86/trivial_program.c -no-pie)\n\nVMTARGETS := protection_keys\nBINARIES_32 := $(VMTARGETS:%=%_32)\nBINARIES_64 := $(VMTARGETS:%=%_64)\n\nifeq ($(CAN_BUILD_WITH_NOPIE),1)\nCFLAGS += -no-pie\nendif\n\nifeq ($(CAN_BUILD_I386),1)\nTEST_GEN_FILES += $(BINARIES_32)\nendif\n\nifeq ($(CAN_BUILD_X86_64),1)\nTEST_GEN_FILES += $(BINARIES_64)\nendif\nelse\n\nifneq (,$(findstring $(ARCH),ppc64))\nTEST_GEN_FILES += protection_keys\nendif\n\nendif\n\nifneq (,$(filter $(ARCH),arm64 ia64 mips64 parisc64 ppc64 riscv64 s390x sparc64 x86_64))\nTEST_GEN_FILES += va_high_addr_switch\nTEST_GEN_FILES += virtual_address_range\nTEST_GEN_FILES += write_to_hugetlbfs\nendif\n\nTEST_PROGS := run_vmtests.sh\n\nTEST_FILES := test_vmalloc.sh\nTEST_FILES += test_hmm.sh\nTEST_FILES += va_high_addr_switch.sh\n\ninclude ../lib.mk\n\n$(TEST_GEN_PROGS): vm_util.c\n$(TEST_GEN_FILES): vm_util.c\n\n$(OUTPUT)/uffd-stress: uffd-common.c\n$(OUTPUT)/uffd-unit-tests: uffd-common.c\n\nifeq ($(ARCH),x86_64)\nBINARIES_32 := $(patsubst %,$(OUTPUT)/%,$(BINARIES_32))\nBINARIES_64 := $(patsubst %,$(OUTPUT)/%,$(BINARIES_64))\n\ndefine gen-target-rule-32\n$(1) $(1)_32: $(OUTPUT)/$(1)_32\n.PHONY: $(1) $(1)_32\nendef\n\ndefine gen-target-rule-64\n$(1) $(1)_64: $(OUTPUT)/$(1)_64\n.PHONY: $(1) $(1)_64\nendef\n\nifeq ($(CAN_BUILD_I386),1)\n$(BINARIES_32): CFLAGS += -m32 -mxsave\n$(BINARIES_32): LDLIBS += -lrt -ldl -lm\n$(BINARIES_32): $(OUTPUT)/%_32: %.c\n\t$(CC) $(CFLAGS) $(EXTRA_CFLAGS) $(notdir $^) $(LDLIBS) -o $@\n$(foreach t,$(VMTARGETS),$(eval $(call gen-target-rule-32,$(t))))\nendif\n\nifeq ($(CAN_BUILD_X86_64),1)\n$(BINARIES_64): CFLAGS += -m64 -mxsave\n$(BINARIES_64): LDLIBS += -lrt -ldl\n$(BINARIES_64): $(OUTPUT)/%_64: %.c\n\t$(CC) $(CFLAGS) $(EXTRA_CFLAGS) $(notdir $^) $(LDLIBS) -o $@\n$(foreach t,$(VMTARGETS),$(eval $(call gen-target-rule-64,$(t))))\nendif\n\n# x86_64 users should be encouraged to install 32-bit libraries\nifeq ($(CAN_BUILD_I386)$(CAN_BUILD_X86_64),01)\nall: warn_32bit_failure\n\nwarn_32bit_failure:\n\t@echo \"Warning: you seem to have a broken 32-bit build\" 2>&1;\t\t\\\n\techo  \"environment. This will reduce test coverage of 64-bit\" 2>&1;\t\\\n\techo  \"kernels. If you are using a Debian-like distribution,\" 2>&1;\t\\\n\techo  \"try:\"; 2>&1;\t\t\t\t\t\t\t\\\n\techo  \"\";\t\t\t\t\t\t\t\t\\\n\techo  \"  apt-get install gcc-multilib libc6-i386 libc6-dev-i386\";\t\\\n\techo  \"\";\t\t\t\t\t\t\t\t\\\n\techo  \"If you are using a Fedora-like distribution, try:\";\t\t\\\n\techo  \"\";\t\t\t\t\t\t\t\t\\\n\techo  \"  yum install glibc-devel.*i686\";\t\t\t\t\\\n\texit 0;\nendif\nendif\n\n# IOURING_EXTRA_LIBS may get set in local_config.mk, or it may be left empty.\n$(OUTPUT)/cow: LDLIBS += $(IOURING_EXTRA_LIBS)\n\n$(OUTPUT)/gup_longterm: LDLIBS += $(IOURING_EXTRA_LIBS)\n\n$(OUTPUT)/mlock-random-test $(OUTPUT)/memfd_secret: LDLIBS += -lcap\n\n$(OUTPUT)/ksm_tests: LDLIBS += -lnuma\n\n$(OUTPUT)/migration: LDLIBS += -lnuma\n\nlocal_config.mk local_config.h: check_config.sh\n\t/bin/sh ./check_config.sh $(CC)\n\nEXTRA_CLEAN += local_config.mk local_config.h\n\nifeq ($(IOURING_EXTRA_LIBS),)\nall: warn_missing_liburing\n\nwarn_missing_liburing:\n\t@echo ; \\\n\techo \"Warning: missing liburing support. Some tests will be skipped.\" ; \\\n\techo\nendif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}