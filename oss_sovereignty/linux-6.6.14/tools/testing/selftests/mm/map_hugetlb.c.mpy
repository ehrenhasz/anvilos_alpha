{
  "module_name": "map_hugetlb.c",
  "hash_id": "adb358dbf9363b7ff566db6501a0eee921d43b09cb06e55de7f0fcc7d2dff53a",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/mm/map_hugetlb.c",
  "human_readable_source": "\n \n#include <stdlib.h>\n#include <stdio.h>\n#include <unistd.h>\n#include <sys/mman.h>\n#include <fcntl.h>\n\n#define LENGTH (256UL*1024*1024)\n#define PROTECTION (PROT_READ | PROT_WRITE)\n\n \n#ifdef __ia64__\n#define ADDR (void *)(0x8000000000000000UL)\n#define FLAGS (MAP_PRIVATE | MAP_ANONYMOUS | MAP_HUGETLB | MAP_FIXED)\n#else\n#define ADDR (void *)(0x0UL)\n#define FLAGS (MAP_PRIVATE | MAP_ANONYMOUS | MAP_HUGETLB)\n#endif\n\nstatic void check_bytes(char *addr)\n{\n\tprintf(\"First hex is %x\\n\", *((unsigned int *)addr));\n}\n\nstatic void write_bytes(char *addr, size_t length)\n{\n\tunsigned long i;\n\n\tfor (i = 0; i < length; i++)\n\t\t*(addr + i) = (char)i;\n}\n\nstatic int read_bytes(char *addr, size_t length)\n{\n\tunsigned long i;\n\n\tcheck_bytes(addr);\n\tfor (i = 0; i < length; i++)\n\t\tif (*(addr + i) != (char)i) {\n\t\t\tprintf(\"Mismatch at %lu\\n\", i);\n\t\t\treturn 1;\n\t\t}\n\treturn 0;\n}\n\nint main(int argc, char **argv)\n{\n\tvoid *addr;\n\tint ret;\n\tsize_t length = LENGTH;\n\tint flags = FLAGS;\n\tint shift = 0;\n\n\tif (argc > 1)\n\t\tlength = atol(argv[1]) << 20;\n\tif (argc > 2) {\n\t\tshift = atoi(argv[2]);\n\t\tif (shift)\n\t\t\tflags |= (shift & MAP_HUGE_MASK) << MAP_HUGE_SHIFT;\n\t}\n\n\tif (shift)\n\t\tprintf(\"%u kB hugepages\\n\", 1 << (shift - 10));\n\telse\n\t\tprintf(\"Default size hugepages\\n\");\n\tprintf(\"Mapping %lu Mbytes\\n\", (unsigned long)length >> 20);\n\n\taddr = mmap(ADDR, length, PROTECTION, flags, -1, 0);\n\tif (addr == MAP_FAILED) {\n\t\tperror(\"mmap\");\n\t\texit(1);\n\t}\n\n\tprintf(\"Returned address is %p\\n\", addr);\n\tcheck_bytes(addr);\n\twrite_bytes(addr, length);\n\tret = read_bytes(addr, length);\n\n\t \n\tif (munmap(addr, length)) {\n\t\tperror(\"munmap\");\n\t\texit(1);\n\t}\n\n\treturn ret;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}