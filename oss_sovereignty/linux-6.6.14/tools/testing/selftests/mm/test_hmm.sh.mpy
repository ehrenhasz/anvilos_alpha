{
  "module_name": "test_hmm.sh",
  "hash_id": "15ec5a84ba3dacf4819d537c71c30469d99a061c72024b70548b67e66159ab50",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/mm/test_hmm.sh",
  "human_readable_source": "#!/bin/bash\n# SPDX-License-Identifier: GPL-2.0\n#\n# Copyright (C) 2018 Uladzislau Rezki (Sony) <urezki@gmail.com>\n#\n# This is a test script for the kernel test driver to analyse vmalloc\n# allocator. Therefore it is just a kernel module loader. You can specify\n# and pass different parameters in order to:\n#     a) analyse performance of vmalloc allocations;\n#     b) stressing and stability check of vmalloc subsystem.\n\nTEST_NAME=\"test_hmm\"\nDRIVER=\"test_hmm\"\n\n# 1 if fails\nexitcode=1\n\n# Kselftest framework requirement - SKIP code is 4.\nksft_skip=4\n\ncheck_test_requirements()\n{\n\tuid=$(id -u)\n\tif [ $uid -ne 0 ]; then\n\t\techo \"$0: Must be run as root\"\n\t\texit $ksft_skip\n\tfi\n\n\tif ! which modprobe > /dev/null 2>&1; then\n\t\techo \"$0: You need modprobe installed\"\n\t\texit $ksft_skip\n\tfi\n\n\tif ! modinfo $DRIVER > /dev/null 2>&1; then\n\t\techo \"$0: You must have the following enabled in your kernel:\"\n\t\techo \"CONFIG_TEST_HMM=m\"\n\t\texit $ksft_skip\n\tfi\n}\n\nload_driver()\n{\n\tif [ $# -eq 0 ]; then\n\t\tmodprobe $DRIVER > /dev/null 2>&1\n\telse\n\t\tif [ $# -eq 2 ]; then\n\t\t\tmodprobe $DRIVER spm_addr_dev0=$1 spm_addr_dev1=$2\n\t\t\t\t> /dev/null 2>&1\n\t\telse\n\t\t\techo \"Missing module parameters. Make sure pass\"\\\n\t\t\t\"spm_addr_dev0 and spm_addr_dev1\"\n\t\t\tusage\n\t\tfi\n\tfi\n}\n\nunload_driver()\n{\n\tmodprobe -r $DRIVER > /dev/null 2>&1\n}\n\nrun_smoke()\n{\n\techo \"Running smoke test. Note, this test provides basic coverage.\"\n\n\tload_driver $1 $2\n\t$(dirname \"${BASH_SOURCE[0]}\")/hmm-tests\n\tunload_driver\n}\n\nusage()\n{\n\techo -n \"Usage: $0\"\n\techo\n\techo \"Example usage:\"\n\techo\n\techo \"# Shows help message\"\n\techo \"./${TEST_NAME}.sh\"\n\techo\n\techo \"# Smoke testing\"\n\techo \"./${TEST_NAME}.sh smoke\"\n\techo\n\techo \"# Smoke testing with SPM enabled\"\n\techo \"./${TEST_NAME}.sh smoke <spm_addr_dev0> <spm_addr_dev1>\"\n\techo\n\texit 0\n}\n\nfunction run_test()\n{\n\tif [ $# -eq 0 ]; then\n\t\tusage\n\telse\n\t\tif [ \"$1\" = \"smoke\" ]; then\n\t\t\trun_smoke $2 $3\n\t\telse\n\t\t\tusage\n\t\tfi\n\tfi\n}\n\ncheck_test_requirements\nrun_test $@\n\nexit 0\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}