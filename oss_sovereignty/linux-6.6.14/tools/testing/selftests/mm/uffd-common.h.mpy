{
  "module_name": "uffd-common.h",
  "hash_id": "4e8d53b1c27cc522037f347e587199fc100e132b58fefa7416c8ad66ad7d5373",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/mm/uffd-common.h",
  "human_readable_source": "\n \n#ifndef __UFFD_COMMON_H__\n#define __UFFD_COMMON_H__\n\n#define _GNU_SOURCE\n#include <stdio.h>\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <time.h>\n#include <signal.h>\n#include <poll.h>\n#include <string.h>\n#include <linux/mman.h>\n#include <sys/mman.h>\n#include <sys/syscall.h>\n#include <sys/ioctl.h>\n#include <sys/wait.h>\n#include <pthread.h>\n#include <linux/userfaultfd.h>\n#include <setjmp.h>\n#include <stdbool.h>\n#include <assert.h>\n#include <inttypes.h>\n#include <stdint.h>\n#include <sys/random.h>\n\n#include \"../kselftest.h\"\n#include \"vm_util.h\"\n\n#define UFFD_FLAGS\t(O_CLOEXEC | O_NONBLOCK | UFFD_USER_MODE_ONLY)\n\n#define _err(fmt, ...)\t\t\t\t\t\t\\\n\tdo {\t\t\t\t\t\t\t\\\n\t\tint ret = errno;\t\t\t\t\\\n\t\tfprintf(stderr, \"ERROR: \" fmt, ##__VA_ARGS__);\t\\\n\t\tfprintf(stderr, \" (errno=%d, @%s:%d)\\n\",\t\\\n\t\t\tret, __FILE__, __LINE__);\t\t\\\n\t} while (0)\n\n#define errexit(exitcode, fmt, ...)\t\t\\\n\tdo {\t\t\t\t\t\\\n\t\t_err(fmt, ##__VA_ARGS__);\t\\\n\t\texit(exitcode);\t\t\t\\\n\t} while (0)\n\n#define err(fmt, ...) errexit(1, fmt, ##__VA_ARGS__)\n\n \n#define area_mutex(___area, ___nr)\t\t\t\t\t\\\n\t((pthread_mutex_t *) ((___area) + (___nr)*page_size))\n \n#define area_count(___area, ___nr)\t\t\t\t\t\\\n\t((volatile unsigned long long *) ((unsigned long)\t\t\\\n\t\t\t\t ((___area) + (___nr)*page_size +\t\\\n\t\t\t\t  sizeof(pthread_mutex_t) +\t\t\\\n\t\t\t\t  sizeof(unsigned long long) - 1) &\t\\\n\t\t\t\t ~(unsigned long)(sizeof(unsigned long long) \\\n\t\t\t\t\t\t  -  1)))\n\n \nstruct uffd_args {\n\tint cpu;\n\t \n\tbool apply_wp;\n\tunsigned long missing_faults;\n\tunsigned long wp_faults;\n\tunsigned long minor_faults;\n\n\t \n\tvoid (*handle_fault)(struct uffd_msg *msg, struct uffd_args *args);\n};\n\nstruct uffd_test_ops {\n\tint (*allocate_area)(void **alloc_area, bool is_src);\n\tvoid (*release_pages)(char *rel_area);\n\tvoid (*alias_mapping)(__u64 *start, size_t len, unsigned long offset);\n\tvoid (*check_pmd_mapping)(void *p, int expect_nr_hpages);\n};\ntypedef struct uffd_test_ops uffd_test_ops_t;\n\nextern unsigned long nr_cpus, nr_pages, nr_pages_per_cpu, page_size;\nextern char *area_src, *area_src_alias, *area_dst, *area_dst_alias, *area_remap;\nextern int uffd, uffd_flags, finished, *pipefd, test_type;\nextern bool map_shared;\nextern bool test_uffdio_wp;\nextern unsigned long long *count_verify;\nextern volatile bool test_uffdio_copy_eexist;\n\nextern uffd_test_ops_t anon_uffd_test_ops;\nextern uffd_test_ops_t shmem_uffd_test_ops;\nextern uffd_test_ops_t hugetlb_uffd_test_ops;\nextern uffd_test_ops_t *uffd_test_ops;\n\nvoid uffd_stats_report(struct uffd_args *args, int n_cpus);\nint uffd_test_ctx_init(uint64_t features, const char **errmsg);\nint userfaultfd_open(uint64_t *features);\nint uffd_read_msg(int ufd, struct uffd_msg *msg);\nvoid wp_range(int ufd, __u64 start, __u64 len, bool wp);\nvoid uffd_handle_page_fault(struct uffd_msg *msg, struct uffd_args *args);\nint __copy_page(int ufd, unsigned long offset, bool retry, bool wp);\nint copy_page(int ufd, unsigned long offset, bool wp);\nvoid *uffd_poll_thread(void *arg);\n\nint uffd_open_dev(unsigned int flags);\nint uffd_open_sys(unsigned int flags);\nint uffd_open(unsigned int flags);\nint uffd_get_features(uint64_t *features);\n\n#define TEST_ANON\t1\n#define TEST_HUGETLB\t2\n#define TEST_SHMEM\t3\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}