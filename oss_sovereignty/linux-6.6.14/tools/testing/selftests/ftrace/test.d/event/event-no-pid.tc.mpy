{
  "module_name": "event-no-pid.tc",
  "hash_id": "0fa7838c9b695c052807e46fbb756841dab4ac4ead53d82cd738768be86ff67a",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/ftrace/test.d/event/event-no-pid.tc",
  "human_readable_source": "#!/bin/sh\n# SPDX-License-Identifier: GPL-2.0\n# description: event tracing - restricts events based on pid notrace filtering\n# requires: set_event events/sched set_event_pid set_event_notrace_pid\n# flags: instance\n\ndo_reset() {\n    echo > set_event\n    echo > set_event_pid\n    echo > set_event_notrace_pid\n    echo 0 > options/event-fork\n    echo 0 > events/enable\n    clear_trace\n    echo 1 > tracing_on\n}\n\nfail() { #msg\n    cat trace\n    do_reset\n    echo $1\n    exit_fail\n}\n\ncount_pid() {\n    pid=$@\n    cat trace | grep -v '^#' | sed -e 's/[^-]*-\\([0-9]*\\).*/\\1/' | grep $pid | wc -l\n}\n\ncount_no_pid() {\n    pid=$1\n    cat trace | grep -v '^#' | sed -e 's/[^-]*-\\([0-9]*\\).*/\\1/' | grep -v $pid | wc -l\n}\n\nenable_system() {\n    system=$1\n\n    if [ -d events/$system ]; then\n\techo 1 > events/$system/enable\n    fi\n}\n\nenable_events() {\n    echo 0 > tracing_on\n    # Enable common groups of events, as all events can allow for\n    # events to be traced via scheduling that we don't care to test.\n    enable_system syscalls\n    enable_system rcu\n    enable_system block\n    enable_system exceptions\n    enable_system irq\n    enable_system net\n    enable_system power\n    enable_system signal\n    enable_system sock\n    enable_system timer\n    enable_system thermal\n    echo 1 > tracing_on\n}\n\nother_task() {\n    sleep .001 || usleep 1 || sleep 1\n}\n\necho 0 > options/event-fork\n\ndo_reset\n\nread mypid rest < /proc/self/stat\n\necho $mypid > set_event_notrace_pid\ngrep -q $mypid set_event_notrace_pid\n\nenable_events\n\nyield\n\necho 0 > tracing_on\n\ncnt=`count_pid $mypid`\nif [ $cnt -ne 0 ]; then\n    fail \"Filtered out task has events\"\nfi\n\ncnt=`count_no_pid $mypid`\nif [ $cnt -eq 0 ]; then\n    fail \"No other events were recorded\"\nfi\n\ndo_reset\n\necho $mypid > set_event_notrace_pid\necho 1 > options/event-fork\n\nenable_events\n\nyield &\nchild=$!\necho \"child = $child\"\nwait $child\n\n# Be sure some other events will happen for small systems (e.g. 1 core)\nother_task\n\necho 0 > tracing_on\n\ncnt=`count_pid $mypid`\nif [ $cnt -ne 0 ]; then\n    fail \"Filtered out task has events\"\nfi\n\ncnt=`count_pid $child`\nif [ $cnt -ne 0 ]; then\n    fail \"Child of filtered out taskhas events\"\nfi\n\ncnt=`count_no_pid $mypid`\nif [ $cnt -eq 0 ]; then\n    fail \"No other events were recorded\"\nfi\n\ndo_reset\n\nexit 0\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}