{
  "module_name": "func_event_triggers.tc",
  "hash_id": "ee211895acb64278dfb46f0b056d842e74394534b9146f1e55d5f3972ff2dc99",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/ftrace/test.d/ftrace/func_event_triggers.tc",
  "human_readable_source": "#!/bin/sh\n# SPDX-License-Identifier: GPL-2.0\n# description: ftrace - test for function event triggers\n# flags: instance\n#\n# The triggers are set within the set_ftrace_filter file\n# requires: set_ftrace_filter\n#\n# Ftrace allows to add triggers to functions, such as enabling or disabling\n# tracing, enabling or disabling trace events, or recording a stack trace\n# within the ring buffer.\n#\n# This test is designed to test event triggers\n\ndo_reset() {\n    reset_ftrace_filter\n    reset_tracer\n    disable_events\n    clear_trace\n    enable_tracing\n}\n\nfail() { # mesg\n    echo $1\n    exit_fail\n}\n\nSLEEP_TIME=\".1\"\n\necho \"Testing function probes with events:\"\n\nEVENT=\"sched:sched_switch\"\nEVENT_ENABLE=\"events/sched/sched_switch/enable\"\n\ncnt_trace() {\n    grep -v '^#' trace | wc -l\n}\n\ntest_event_enabled() {\n    val=$1\n    check_times=10\t\t# wait for 10 * SLEEP_TIME at most\n\n    while [ $check_times -ne 0 ]; do\n\te=`cat $EVENT_ENABLE`\n\tif [ \"$e\" = $val ]; then\n\t    return 0\n\tfi\n\tsleep $SLEEP_TIME\n\tcheck_times=$((check_times - 1))\n    done\n\n    fail \"Expected $val but found $e\"\n}\n\nrun_enable_disable() {\n    enable=$1\t\t\t# enable\n    Enable=$2\t\t\t# Enable\n    check_disable=$3\t\t# 0\n    check_enable_star=$4\t# 1*\n    check_disable_star=$5\t# 0*\n\n    cnt=`cnt_trace`\n    if [ $cnt -ne 0 ]; then\n\tfail \"Found junk in trace file\"\n    fi\n\n    echo \"$Enable event all the time\"\n\n    echo $check_disable > $EVENT_ENABLE\n    sleep $SLEEP_TIME\n\n    test_event_enabled $check_disable\n\n    echo \"schedule:${enable}_event:$EVENT\" > set_ftrace_filter\n    if [ -d ../../instances ]; then # Check instances\n\tcur=`cat set_ftrace_filter`\n\ttop=`cat ../../set_ftrace_filter`\n\tif [ \"$cur\" = \"$top\" ]; then\n\t    echo \"This kernel is too old to support per instance filter\"\n\t    reset_ftrace_filter\n\t    exit_unsupported\n\tfi\n    fi\n\n    echo \" make sure it works 5 times\"\n\n    for i in `seq 5`; do\n\tsleep $SLEEP_TIME\n\techo \"  test $i\"\n\ttest_event_enabled $check_enable_star\n\n\techo $check_disable > $EVENT_ENABLE\n    done\n    sleep $SLEEP_TIME\n    echo \" make sure it still works\"\n    test_event_enabled $check_enable_star\n\n    reset_ftrace_filter\n\n    echo \" make sure it only works 3 times\"\n\n    echo $check_disable > $EVENT_ENABLE\n    sleep $SLEEP_TIME\n\n    echo \"schedule:${enable}_event:$EVENT:3\" > set_ftrace_filter\n\n    for i in `seq 3`; do\n\tsleep $SLEEP_TIME\n\techo \"  test $i\"\n\ttest_event_enabled $check_enable_star\n\n\techo $check_disable > $EVENT_ENABLE\n    done\n\n    sleep $SLEEP_TIME\n    echo \" make sure it stop working\"\n    test_event_enabled $check_disable_star\n\n    do_reset\n}\n\nrun_enable_disable enable Enable 0 \"1*\" \"0*\"\nrun_enable_disable disable Disable 1 \"0*\" \"1*\"\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}