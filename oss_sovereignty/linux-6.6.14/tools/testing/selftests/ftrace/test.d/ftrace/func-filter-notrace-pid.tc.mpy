{
  "module_name": "func-filter-notrace-pid.tc",
  "hash_id": "29d367f9d1be756bfde612f226fcf615ab2416c2b24269ad465be32baaf94048",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/ftrace/test.d/ftrace/func-filter-notrace-pid.tc",
  "human_readable_source": "#!/bin/sh\n# SPDX-License-Identifier: GPL-2.0\n# description: ftrace - function pid notrace filters\n# requires: set_ftrace_notrace_pid set_ftrace_filter function:tracer\n# flags: instance\n\n# Make sure that function pid matching filter with notrace works.\n\ndo_function_fork=1\n\nif [ ! -f options/function-fork ]; then\n    do_function_fork=0\n    echo \"no option for function-fork found. Option will not be tested.\"\nfi\n\nread PID _ < /proc/self/stat\n\nif [ $do_function_fork -eq 1 ]; then\n    # default value of function-fork option\n    orig_value=`grep function-fork trace_options`\nfi\n\ndo_reset() {\n    if [ $do_function_fork -eq 0 ]; then\n\treturn\n    fi\n\n    echo > set_ftrace_notrace_pid\n    echo $orig_value > trace_options\n}\n\nfail() { # msg\n    do_reset\n    echo $1\n    exit_fail\n}\n\ndo_test() {\n    disable_tracing\n\n    echo do_execve* > set_ftrace_filter\n    echo $FUNCTION_FORK >> set_ftrace_filter\n\n    echo $PID > set_ftrace_notrace_pid\n    echo function > current_tracer\n\n    if [ $do_function_fork -eq 1 ]; then\n\t# don't allow children to be traced\n\techo nofunction-fork > trace_options\n    fi\n\n    enable_tracing\n    yield\n\n    count_pid=`cat trace | grep -v ^# | grep $PID | wc -l`\n    count_other=`cat trace | grep -v ^# | grep -v $PID | wc -l`\n\n    # count_pid should be 0\n    if [ $count_pid -ne 0 -o $count_other -eq 0 ]; then\n\tfail \"PID filtering not working? traced task = $count_pid; other tasks = $count_other \"\n    fi\n\n    disable_tracing\n    clear_trace\n\n    if [ $do_function_fork -eq 0 ]; then\n\treturn\n    fi\n\n    # allow children to be traced\n    echo function-fork > trace_options\n\n    # With pid in both set_ftrace_pid and set_ftrace_notrace_pid\n    # there should not be any tasks traced.\n\n    echo $PID > set_ftrace_pid\n\n    enable_tracing\n    yield\n\n    count_pid=`cat trace | grep -v ^# | grep $PID | wc -l`\n    count_other=`cat trace | grep -v ^# | grep -v $PID | wc -l`\n\n    # both should be zero\n    if [ $count_pid -ne 0 -o $count_other -ne 0 ]; then\n\tfail \"PID filtering not following fork? traced task = $count_pid; other tasks = $count_other \"\n    fi\n}\n\ndo_test\n\ndo_reset\n\nexit 0\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}