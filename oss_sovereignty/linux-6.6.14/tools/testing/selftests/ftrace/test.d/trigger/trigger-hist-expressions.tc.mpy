{
  "module_name": "trigger-hist-expressions.tc",
  "hash_id": "29b78adc234e820c4a27509cc51c0a82046d402d6c2d5abf9070e1647b11b962",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/ftrace/test.d/trigger/trigger-hist-expressions.tc",
  "human_readable_source": "#!/bin/sh\n# SPDX-License-Identifier: GPL-2.0\n# description: event trigger - test histogram expression parsing\n# requires: set_event events/sched/sched_process_fork/trigger events/sched/sched_process_fork/hist error_log \"<var1>=<field|var_ref|numeric_literal>\":README\n\n\nfail() { #msg\n    echo $1\n    exit_fail\n}\n\ntest_hist_expr() { # test_name expression expected_val\n    trigger=\"events/sched/sched_process_fork/trigger\"\n\n    reset_trigger_file $trigger\n\n    echo \"Test hist trigger expressions - $1\"\n\n    echo \"hist:keys=common_pid:x=$2\" > $trigger\n\n    for i in `seq 1 10` ; do ( echo \"forked\" > /dev/null); done\n\n    actual=`grep -o 'x=[[:digit:]]*' $trigger | awk -F= '{ print $2 }'`\n\n    if [ $actual != $3 ]; then\n        fail \"Failed hist trigger expression evaluation: Expression: $2 Expected: $3, Actual: $actual\"\n    fi\n\n    reset_trigger_file $trigger\n}\n\ncheck_error() { # test_name command-with-error-pos-by-^\n    trigger=\"events/sched/sched_process_fork/trigger\"\n\n    echo \"Test hist trigger expressions - $1\"\n    ftrace_errlog_check 'hist:sched:sched_process_fork' \"$2\" $trigger\n}\n\ntest_hist_expr \"Variable assignment\" \"123\" \"123\"\n\ntest_hist_expr \"Subtraction not associative\" \"16-8-4-2\" \"2\"\n\ntest_hist_expr \"Division not associative\" \"64/8/4/2\" \"1\"\n\ntest_hist_expr \"Same precedence operators (+,-) evaluated left to right\" \"16-8+4+2\" \"14\"\n\ntest_hist_expr \"Same precedence operators (*,/) evaluated left to right\" \"4*3/2*2\" \"12\"\n\ntest_hist_expr \"Multiplication evaluated before addition/subtraction\" \"4+3*2-2\" \"8\"\n\ntest_hist_expr \"Division evaluated before addition/subtraction\" \"4+6/2-2\" \"5\"\n\n# err pos for \"too many subexpressions\" is dependent on where\n# the last subexpression was detected. This can vary depending\n# on how the expression tree was generated.\ncheck_error \"Too many subexpressions\" 'hist:keys=common_pid:x=32+^10*3/20-4'\ncheck_error \"Too many subexpressions\" 'hist:keys=common_pid:x=^1+2+3+4+5'\n\ncheck_error \"Unary minus not supported in subexpression\" 'hist:keys=common_pid:x=-(^1)+2'\n\ncheck_error \"Division by zero\" 'hist:keys=common_pid:x=3/^0'\n\nexit 0\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}