{
  "module_name": "clone3_selftests.h",
  "hash_id": "cdf59f4a231b24e37d019fd7985f941c7b6d1be22c0519b4be6b0c64c40829ea",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/clone3/clone3_selftests.h",
  "human_readable_source": " \n\n#ifndef _CLONE3_SELFTESTS_H\n#define _CLONE3_SELFTESTS_H\n\n#define _GNU_SOURCE\n#include <sched.h>\n#include <linux/sched.h>\n#include <linux/types.h>\n#include <stdint.h>\n#include <syscall.h>\n#include <sys/wait.h>\n\n#include \"../kselftest.h\"\n\n#define ptr_to_u64(ptr) ((__u64)((uintptr_t)(ptr)))\n\n#ifndef CLONE_INTO_CGROUP\n#define CLONE_INTO_CGROUP 0x200000000ULL  \n#endif\n\n#ifndef __NR_clone3\n#define __NR_clone3 -1\n#endif\n\nstruct __clone_args {\n\t__aligned_u64 flags;\n\t__aligned_u64 pidfd;\n\t__aligned_u64 child_tid;\n\t__aligned_u64 parent_tid;\n\t__aligned_u64 exit_signal;\n\t__aligned_u64 stack;\n\t__aligned_u64 stack_size;\n\t__aligned_u64 tls;\n#ifndef CLONE_ARGS_SIZE_VER0\n#define CLONE_ARGS_SIZE_VER0 64\t \n#endif\n\t__aligned_u64 set_tid;\n\t__aligned_u64 set_tid_size;\n#ifndef CLONE_ARGS_SIZE_VER1\n#define CLONE_ARGS_SIZE_VER1 80\t \n#endif\n\t__aligned_u64 cgroup;\n#ifndef CLONE_ARGS_SIZE_VER2\n#define CLONE_ARGS_SIZE_VER2 88\t \n#endif\n};\n\nstatic pid_t sys_clone3(struct __clone_args *args, size_t size)\n{\n\tfflush(stdout);\n\tfflush(stderr);\n\treturn syscall(__NR_clone3, args, size);\n}\n\nstatic inline void test_clone3_supported(void)\n{\n\tpid_t pid;\n\tstruct __clone_args args = {};\n\n\tif (__NR_clone3 < 0)\n\t\tksft_exit_skip(\"clone3() syscall is not supported\\n\");\n\n\t \n\targs.exit_signal = -1;\n\tpid = sys_clone3(&args, sizeof(args));\n\tif (!pid)\n\t\texit(EXIT_SUCCESS);\n\n\tif (pid > 0) {\n\t\twait(NULL);\n\t\tksft_exit_fail_msg(\n\t\t\t\"Managed to create child process with invalid exit_signal\\n\");\n\t}\n\n\tif (errno == ENOSYS)\n\t\tksft_exit_skip(\"clone3() syscall is not supported\\n\");\n\n\tksft_print_msg(\"clone3() syscall supported\\n\");\n}\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}