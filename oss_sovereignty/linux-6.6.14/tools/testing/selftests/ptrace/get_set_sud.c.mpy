{
  "module_name": "get_set_sud.c",
  "hash_id": "b3145535beef1cf2b415673a72f403edb9b9a5245524a79025b0131abbca937e",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/ptrace/get_set_sud.c",
  "human_readable_source": "\n#define _GNU_SOURCE\n#include \"../kselftest_harness.h\"\n#include <stdio.h>\n#include <string.h>\n#include <errno.h>\n#include <sys/wait.h>\n#include <sys/syscall.h>\n#include <sys/prctl.h>\n\n#include \"linux/ptrace.h\"\n\nstatic int sys_ptrace(int request, pid_t pid, void *addr, void *data)\n{\n\treturn syscall(SYS_ptrace, request, pid, addr, data);\n}\n\nTEST(get_set_sud)\n{\n\tstruct ptrace_sud_config config;\n\tpid_t child;\n\tint ret = 0;\n\tint status;\n\n\tchild = fork();\n\tASSERT_GE(child, 0);\n\tif (child == 0) {\n\t\tASSERT_EQ(0, sys_ptrace(PTRACE_TRACEME, 0, 0, 0)) {\n\t\t\tTH_LOG(\"PTRACE_TRACEME: %m\");\n\t\t}\n\t\tkill(getpid(), SIGSTOP);\n\t\t_exit(1);\n\t}\n\n\twaitpid(child, &status, 0);\n\n\tmemset(&config, 0xff, sizeof(config));\n\tconfig.mode = PR_SYS_DISPATCH_ON;\n\n\tret = sys_ptrace(PTRACE_GET_SYSCALL_USER_DISPATCH_CONFIG, child,\n\t\t\t (void *)sizeof(config), &config);\n\n\tASSERT_EQ(ret, 0);\n\tASSERT_EQ(config.mode, PR_SYS_DISPATCH_OFF);\n\tASSERT_EQ(config.selector, 0);\n\tASSERT_EQ(config.offset, 0);\n\tASSERT_EQ(config.len, 0);\n\n\tconfig.mode = PR_SYS_DISPATCH_ON;\n\tconfig.selector = 0;\n\tconfig.offset = 0x400000;\n\tconfig.len = 0x1000;\n\n\tret = sys_ptrace(PTRACE_SET_SYSCALL_USER_DISPATCH_CONFIG, child,\n\t\t\t (void *)sizeof(config), &config);\n\n\tASSERT_EQ(ret, 0);\n\n\tmemset(&config, 1, sizeof(config));\n\tret = sys_ptrace(PTRACE_GET_SYSCALL_USER_DISPATCH_CONFIG, child,\n\t\t\t (void *)sizeof(config), &config);\n\n\tASSERT_EQ(ret, 0);\n\tASSERT_EQ(config.mode, PR_SYS_DISPATCH_ON);\n\tASSERT_EQ(config.selector, 0);\n\tASSERT_EQ(config.offset, 0x400000);\n\tASSERT_EQ(config.len, 0x1000);\n\n\tkill(child, SIGKILL);\n}\n\nTEST_HARNESS_MAIN\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}