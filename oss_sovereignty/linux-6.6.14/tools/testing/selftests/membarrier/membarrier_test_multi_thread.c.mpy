{
  "module_name": "membarrier_test_multi_thread.c",
  "hash_id": "05b0f8a5b8197ddb8e6efb2ca90838c9ed0714c3dc522eb11214deb2d912219a",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/membarrier/membarrier_test_multi_thread.c",
  "human_readable_source": "\n#define _GNU_SOURCE\n#include <linux/membarrier.h>\n#include <syscall.h>\n#include <stdio.h>\n#include <errno.h>\n#include <string.h>\n#include <pthread.h>\n\n#include \"membarrier_test_impl.h\"\n\nstatic int thread_ready, thread_quit;\nstatic pthread_mutex_t test_membarrier_thread_mutex =\n\tPTHREAD_MUTEX_INITIALIZER;\nstatic pthread_cond_t test_membarrier_thread_cond =\n\tPTHREAD_COND_INITIALIZER;\n\nvoid *test_membarrier_thread(void *arg)\n{\n\tpthread_mutex_lock(&test_membarrier_thread_mutex);\n\tthread_ready = 1;\n\tpthread_cond_broadcast(&test_membarrier_thread_cond);\n\tpthread_mutex_unlock(&test_membarrier_thread_mutex);\n\n\tpthread_mutex_lock(&test_membarrier_thread_mutex);\n\twhile (!thread_quit)\n\t\tpthread_cond_wait(&test_membarrier_thread_cond,\n\t\t\t\t  &test_membarrier_thread_mutex);\n\tpthread_mutex_unlock(&test_membarrier_thread_mutex);\n\n\treturn NULL;\n}\n\nstatic int test_mt_membarrier(void)\n{\n\tint i;\n\tpthread_t test_thread;\n\n\tpthread_create(&test_thread, NULL,\n\t\t       test_membarrier_thread, NULL);\n\n\tpthread_mutex_lock(&test_membarrier_thread_mutex);\n\twhile (!thread_ready)\n\t\tpthread_cond_wait(&test_membarrier_thread_cond,\n\t\t\t\t  &test_membarrier_thread_mutex);\n\tpthread_mutex_unlock(&test_membarrier_thread_mutex);\n\n\ttest_membarrier_fail();\n\n\ttest_membarrier_success();\n\n\tpthread_mutex_lock(&test_membarrier_thread_mutex);\n\tthread_quit = 1;\n\tpthread_cond_broadcast(&test_membarrier_thread_cond);\n\tpthread_mutex_unlock(&test_membarrier_thread_mutex);\n\n\tpthread_join(test_thread, NULL);\n\n\treturn 0;\n}\n\nint main(int argc, char **argv)\n{\n\tksft_print_header();\n\tksft_set_plan(16);\n\n\ttest_membarrier_query();\n\n\t \n\ttest_mt_membarrier();\n\n\treturn ksft_exit_pass();\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}