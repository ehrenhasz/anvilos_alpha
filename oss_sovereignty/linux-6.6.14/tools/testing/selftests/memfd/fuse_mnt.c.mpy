{
  "module_name": "fuse_mnt.c",
  "hash_id": "42925f59343827b6afcc4b24c929a3cd05085c9267566af04f8064f04e2f9161",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/memfd/fuse_mnt.c",
  "human_readable_source": "\n \n\n#define FUSE_USE_VERSION 26\n\n#include <fuse.h>\n#include <stdio.h>\n#include <string.h>\n#include <errno.h>\n#include <fcntl.h>\n#include <unistd.h>\n\nstatic const char memfd_content[] = \"memfd-example-content\";\nstatic const char memfd_path[] = \"/memfd\";\n\nstatic int memfd_getattr(const char *path, struct stat *st)\n{\n\tmemset(st, 0, sizeof(*st));\n\n\tif (!strcmp(path, \"/\")) {\n\t\tst->st_mode = S_IFDIR | 0755;\n\t\tst->st_nlink = 2;\n\t} else if (!strcmp(path, memfd_path)) {\n\t\tst->st_mode = S_IFREG | 0444;\n\t\tst->st_nlink = 1;\n\t\tst->st_size = strlen(memfd_content);\n\t} else {\n\t\treturn -ENOENT;\n\t}\n\n\treturn 0;\n}\n\nstatic int memfd_readdir(const char *path,\n\t\t\t void *buf,\n\t\t\t fuse_fill_dir_t filler,\n\t\t\t off_t offset,\n\t\t\t struct fuse_file_info *fi)\n{\n\tif (strcmp(path, \"/\"))\n\t\treturn -ENOENT;\n\n\tfiller(buf, \".\", NULL, 0);\n\tfiller(buf, \"..\", NULL, 0);\n\tfiller(buf, memfd_path + 1, NULL, 0);\n\n\treturn 0;\n}\n\nstatic int memfd_open(const char *path, struct fuse_file_info *fi)\n{\n\tif (strcmp(path, memfd_path))\n\t\treturn -ENOENT;\n\n\tif ((fi->flags & 3) != O_RDONLY)\n\t\treturn -EACCES;\n\n\t \n\tfi->direct_io = 1;\n\n\treturn 0;\n}\n\nstatic int memfd_read(const char *path,\n\t\t      char *buf,\n\t\t      size_t size,\n\t\t      off_t offset,\n\t\t      struct fuse_file_info *fi)\n{\n\tsize_t len;\n\n\tif (strcmp(path, memfd_path) != 0)\n\t\treturn -ENOENT;\n\n\tsleep(1);\n\n\tlen = strlen(memfd_content);\n\tif (offset < len) {\n\t\tif (offset + size > len)\n\t\t\tsize = len - offset;\n\n\t\tmemcpy(buf, memfd_content + offset, size);\n\t} else {\n\t\tsize = 0;\n\t}\n\n\treturn size;\n}\n\nstatic struct fuse_operations memfd_ops = {\n\t.getattr\t= memfd_getattr,\n\t.readdir\t= memfd_readdir,\n\t.open\t\t= memfd_open,\n\t.read\t\t= memfd_read,\n};\n\nint main(int argc, char *argv[])\n{\n\treturn fuse_main(argc, argv, &memfd_ops, NULL);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}