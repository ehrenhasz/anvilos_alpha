{
  "module_name": "run_hugetlbfs_test.sh",
  "hash_id": "60f37325326ae5af12c871f7a0d58b1d2435d06e90d4ce3dbf5319508ba3ba4d",
  "original_prompt": "Ingested from linux-6.6.14/tools/testing/selftests/memfd/run_hugetlbfs_test.sh",
  "human_readable_source": "#!/bin/bash\n# please run as root\n\n# Kselftest framework requirement - SKIP code is 4.\nksft_skip=4\n\n#\n# To test memfd_create with hugetlbfs, there needs to be hpages_test\n# huge pages free.  Attempt to allocate enough pages to test.\n#\nhpages_test=8\n\n#\n# Get count of free huge pages from /proc/meminfo\n#\nwhile read name size unit; do\n        if [ \"$name\" = \"HugePages_Free:\" ]; then\n                freepgs=$size\n        fi\ndone < /proc/meminfo\n\n#\n# If not enough free huge pages for test, attempt to increase\n#\nif [ -n \"$freepgs\" ] && [ $freepgs -lt $hpages_test ]; then\n\tnr_hugepgs=`cat /proc/sys/vm/nr_hugepages`\n\thpages_needed=`expr $hpages_test - $freepgs`\n\n\tif [ $UID != 0 ]; then\n\t\techo \"Please run memfd with hugetlbfs test as root\"\n\t\texit $ksft_skip\n\tfi\n\n\techo 3 > /proc/sys/vm/drop_caches\n\techo $(( $hpages_needed + $nr_hugepgs )) > /proc/sys/vm/nr_hugepages\n\twhile read name size unit; do\n\t\tif [ \"$name\" = \"HugePages_Free:\" ]; then\n\t\t\tfreepgs=$size\n\t\tfi\n\tdone < /proc/meminfo\nfi\n\n#\n# If still not enough huge pages available, exit.  But, give back any huge\n# pages potentially allocated above.\n#\nif [ $freepgs -lt $hpages_test ]; then\n\t# nr_hugepgs non-zero only if we attempted to increase\n\tif [ -n \"$nr_hugepgs\" ]; then\n\t\techo $nr_hugepgs > /proc/sys/vm/nr_hugepages\n\tfi\n\tprintf \"Not enough huge pages available (%d < %d)\\n\" \\\n\t\t$freepgs $needpgs\n\texit $ksft_skip\nfi\n\n#\n# Run the hugetlbfs test\n#\n./memfd_test hugetlbfs\n./run_fuse_test.sh hugetlbfs\n\n#\n# Give back any huge pages allocated for the test\n#\nif [ -n \"$nr_hugepgs\" ]; then\n\techo $nr_hugepgs > /proc/sys/vm/nr_hugepages\nfi\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}