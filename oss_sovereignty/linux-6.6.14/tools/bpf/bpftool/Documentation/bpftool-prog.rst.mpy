{
  "module_name": "bpftool-prog.rst",
  "hash_id": "56cf3f96f3e8ca637a88550a8ea1f55e67d074a575fd0aecdb7739af3ad2e6da",
  "original_prompt": "Ingested from linux-6.6.14/tools/bpf/bpftool/Documentation/bpftool-prog.rst",
  "human_readable_source": ".. SPDX-License-Identifier: (GPL-2.0-only OR BSD-2-Clause)\n\n================\nbpftool-prog\n================\n-------------------------------------------------------------------------------\ntool for inspection and simple manipulation of eBPF progs\n-------------------------------------------------------------------------------\n\n:Manual section: 8\n\n.. include:: substitutions.rst\n\nSYNOPSIS\n========\n\n\t**bpftool** [*OPTIONS*] **prog** *COMMAND*\n\n\t*OPTIONS* := { |COMMON_OPTIONS| |\n\t{ **-f** | **--bpffs** } | { **-m** | **--mapcompat** } | { **-n** | **--nomount** } |\n\t{ **-L** | **--use-loader** } }\n\n\t*COMMANDS* :=\n\t{ **show** | **list** | **dump xlated** | **dump jited** | **pin** | **load** |\n\t**loadall** | **help** }\n\nPROG COMMANDS\n=============\n\n|\t**bpftool** **prog** { **show** | **list** } [*PROG*]\n|\t**bpftool** **prog dump xlated** *PROG* [{ **file** *FILE* | [**opcodes**] [**linum**] [**visual**] }]\n|\t**bpftool** **prog dump jited**  *PROG* [{ **file** *FILE* | [**opcodes**] [**linum**] }]\n|\t**bpftool** **prog pin** *PROG* *FILE*\n|\t**bpftool** **prog** { **load** | **loadall** } *OBJ* *PATH* [**type** *TYPE*] [**map** { **idx** *IDX* | **name** *NAME* } *MAP*] [{ **offload_dev** | **xdpmeta_dev** } *NAME*] [**pinmaps** *MAP_DIR*] [**autoattach**]\n|\t**bpftool** **prog attach** *PROG* *ATTACH_TYPE* [*MAP*]\n|\t**bpftool** **prog detach** *PROG* *ATTACH_TYPE* [*MAP*]\n|\t**bpftool** **prog tracelog**\n|\t**bpftool** **prog run** *PROG* **data_in** *FILE* [**data_out** *FILE* [**data_size_out** *L*]] [**ctx_in** *FILE* [**ctx_out** *FILE* [**ctx_size_out** *M*]]] [**repeat** *N*]\n|\t**bpftool** **prog profile** *PROG* [**duration** *DURATION*] *METRICs*\n|\t**bpftool** **prog help**\n|\n|\t*MAP* := { **id** *MAP_ID* | **pinned** *FILE* }\n|\t*PROG* := { **id** *PROG_ID* | **pinned** *FILE* | **tag** *PROG_TAG* | **name** *PROG_NAME* }\n|\t*TYPE* := {\n|\t\t**socket** | **kprobe** | **kretprobe** | **classifier** | **action** |\n|\t\t**tracepoint** | **raw_tracepoint** | **xdp** | **perf_event** | **cgroup/skb** |\n|\t\t**cgroup/sock** | **cgroup/dev** | **lwt_in** | **lwt_out** | **lwt_xmit** |\n|\t\t**lwt_seg6local** | **sockops** | **sk_skb** | **sk_msg** | **lirc_mode2** |\n|\t\t**cgroup/bind4** | **cgroup/bind6** | **cgroup/post_bind4** | **cgroup/post_bind6** |\n|\t\t**cgroup/connect4** | **cgroup/connect6** | **cgroup/getpeername4** | **cgroup/getpeername6** |\n|               **cgroup/getsockname4** | **cgroup/getsockname6** | **cgroup/sendmsg4** | **cgroup/sendmsg6** |\n|\t\t**cgroup/recvmsg4** | **cgroup/recvmsg6** | **cgroup/sysctl** |\n|\t\t**cgroup/getsockopt** | **cgroup/setsockopt** | **cgroup/sock_release** |\n|\t\t**struct_ops** | **fentry** | **fexit** | **freplace** | **sk_lookup**\n|\t}\n|\t*ATTACH_TYPE* := {\n|\t\t**sk_msg_verdict** | **sk_skb_verdict** | **sk_skb_stream_verdict** |\n|\t\t**sk_skb_stream_parser** | **flow_dissector**\n|\t}\n|\t*METRICs* := {\n|\t\t**cycles** | **instructions** | **l1d_loads** | **llc_misses** |\n|\t\t**itlb_misses** | **dtlb_misses**\n|\t}\n\n\nDESCRIPTION\n===========\n\t**bpftool prog { show | list }** [*PROG*]\n\t\t  Show information about loaded programs.  If *PROG* is\n\t\t  specified show information only about given programs,\n\t\t  otherwise list all programs currently loaded on the system.\n\t\t  In case of **tag** or **name**, *PROG* may match several\n\t\t  programs which will all be shown.\n\n\t\t  Output will start with program ID followed by program type and\n\t\t  zero or more named attributes (depending on kernel version).\n\n\t\t  Since Linux 5.1 the kernel can collect statistics on BPF\n\t\t  programs (such as the total time spent running the program,\n\t\t  and the number of times it was run). If available, bpftool\n\t\t  shows such statistics. However, the kernel does not collect\n\t\t  them by defaults, as it slightly impacts performance on each\n\t\t  program run. Activation or deactivation of the feature is\n\t\t  performed via the **kernel.bpf_stats_enabled** sysctl knob.\n\n\t\t  Since Linux 5.8 bpftool is able to discover information about\n\t\t  processes that hold open file descriptors (FDs) against BPF\n\t\t  programs. On such kernels bpftool will automatically emit this\n\t\t  information as well.\n\n\t**bpftool prog dump xlated** *PROG* [{ **file** *FILE* | [**opcodes**] [**linum**] [**visual**] }]\n\t\t  Dump eBPF instructions of the programs from the kernel. By\n\t\t  default, eBPF will be disassembled and printed to standard\n\t\t  output in human-readable format. In this case, **opcodes**\n\t\t  controls if raw opcodes should be printed as well.\n\n\t\t  In case of **tag** or **name**, *PROG* may match several\n\t\t  programs which will all be dumped.  However, if **file** or\n\t\t  **visual** is specified, *PROG* must match a single program.\n\n\t\t  If **file** is specified, the binary image will instead be\n\t\t  written to *FILE*.\n\n\t\t  If **visual** is specified, control flow graph (CFG) will be\n\t\t  built instead, and eBPF instructions will be presented with\n\t\t  CFG in DOT format, on standard output.\n\n\t\t  If the programs have line_info available, the source line will\n\t\t  be displayed.  If **linum** is specified, the filename, line\n\t\t  number and line column will also be displayed.\n\n\t**bpftool prog dump jited**  *PROG* [{ **file** *FILE* | [**opcodes**] [**linum**] }]\n\t\t  Dump jited image (host machine code) of the program.\n\n\t\t  If *FILE* is specified image will be written to a file,\n\t\t  otherwise it will be disassembled and printed to stdout.\n\t\t  *PROG* must match a single program when **file** is specified.\n\n\t\t  **opcodes** controls if raw opcodes will be printed.\n\n\t\t  If the prog has line_info available, the source line will\n\t\t  be displayed.  If **linum** is specified, the filename, line\n\t\t  number and line column will also be displayed.\n\n\t**bpftool prog pin** *PROG* *FILE*\n\t\t  Pin program *PROG* as *FILE*.\n\n\t\t  Note: *FILE* must be located in *bpffs* mount. It must not\n\t\t  contain a dot character ('.'), which is reserved for future\n\t\t  extensions of *bpffs*.\n\n\t**bpftool prog { load | loadall }** *OBJ* *PATH* [**type** *TYPE*] [**map** { **idx** *IDX* | **name** *NAME* } *MAP*] [{ **offload_dev** | **xdpmeta_dev** } *NAME*] [**pinmaps** *MAP_DIR*] [**autoattach**]\n\t\t  Load bpf program(s) from binary *OBJ* and pin as *PATH*.\n\t\t  **bpftool prog load** pins only the first program from the\n\t\t  *OBJ* as *PATH*. **bpftool prog loadall** pins all programs\n\t\t  from the *OBJ* under *PATH* directory.\n\t\t  **type** is optional, if not specified program type will be\n\t\t  inferred from section names.\n\t\t  By default bpftool will create new maps as declared in the ELF\n\t\t  object being loaded.  **map** parameter allows for the reuse\n\t\t  of existing maps.  It can be specified multiple times, each\n\t\t  time for a different map.  *IDX* refers to index of the map\n\t\t  to be replaced in the ELF file counting from 0, while *NAME*\n\t\t  allows to replace a map by name.  *MAP* specifies the map to\n\t\t  use, referring to it by **id** or through a **pinned** file.\n\t\t  If **offload_dev** *NAME* is specified program will be loaded\n\t\t  onto given networking device (offload).\n\t\t  If **xdpmeta_dev** *NAME* is specified program will become\n\t\t  device-bound without offloading, this facilitates access\n\t\t  to XDP metadata.\n\t\t  Optional **pinmaps** argument can be provided to pin all\n\t\t  maps under *MAP_DIR* directory.\n\n\t\t  If **autoattach** is specified program will be attached\n\t\t  before pin. In that case, only the link (representing the\n\t\t  program attached to its hook) is pinned, not the program as\n\t\t  such, so the path won't show in **bpftool prog show -f**,\n\t\t  only show in **bpftool link show -f**. Also, this only works\n\t\t  when bpftool (libbpf) is able to infer all necessary\n\t\t  information from the object file, in particular, it's not\n\t\t  supported for all program types. If a program does not\n\t\t  support autoattach, bpftool falls back to regular pinning\n\t\t  for that program instead.\n\n\t\t  Note: *PATH* must be located in *bpffs* mount. It must not\n\t\t  contain a dot character ('.'), which is reserved for future\n\t\t  extensions of *bpffs*.\n\n\t**bpftool prog attach** *PROG* *ATTACH_TYPE* [*MAP*]\n\t\t  Attach bpf program *PROG* (with type specified by\n\t\t  *ATTACH_TYPE*). Most *ATTACH_TYPEs* require a *MAP*\n\t\t  parameter, with the exception of *flow_dissector* which is\n\t\t  attached to current networking name space.\n\n\t**bpftool prog detach** *PROG* *ATTACH_TYPE* [*MAP*]\n\t\t  Detach bpf program *PROG* (with type specified by\n\t\t  *ATTACH_TYPE*). Most *ATTACH_TYPEs* require a *MAP*\n\t\t  parameter, with the exception of *flow_dissector* which is\n\t\t  detached from the current networking name space.\n\n\t**bpftool prog tracelog**\n\t\t  Dump the trace pipe of the system to the console (stdout).\n\t\t  Hit <Ctrl+C> to stop printing. BPF programs can write to this\n\t\t  trace pipe at runtime with the **bpf_trace_printk**\\ () helper.\n\t\t  This should be used only for debugging purposes. For\n\t\t  streaming data from BPF programs to user space, one can use\n\t\t  perf events (see also **bpftool-map**\\ (8)).\n\n\t**bpftool prog run** *PROG* **data_in** *FILE* [**data_out** *FILE* [**data_size_out** *L*]] [**ctx_in** *FILE* [**ctx_out** *FILE* [**ctx_size_out** *M*]]] [**repeat** *N*]\n\t\t  Run BPF program *PROG* in the kernel testing infrastructure\n\t\t  for BPF, meaning that the program works on the data and\n\t\t  context provided by the user, and not on actual packets or\n\t\t  monitored functions etc. Return value and duration for the\n\t\t  test run are printed out to the console.\n\n\t\t  Input data is read from the *FILE* passed with **data_in**.\n\t\t  If this *FILE* is \"**-**\", input data is read from standard\n\t\t  input. Input context, if any, is read from *FILE* passed with\n\t\t  **ctx_in**. Again, \"**-**\" can be used to read from standard\n\t\t  input, but only if standard input is not already in use for\n\t\t  input data. If a *FILE* is passed with **data_out**, output\n\t\t  data is written to that file. Similarly, output context is\n\t\t  written to the *FILE* passed with **ctx_out**. For both\n\t\t  output flows, \"**-**\" can be used to print to the standard\n\t\t  output (as plain text, or JSON if relevant option was\n\t\t  passed). If output keywords are omitted, output data and\n\t\t  context are discarded. Keywords **data_size_out** and\n\t\t  **ctx_size_out** are used to pass the size (in bytes) for the\n\t\t  output buffers to the kernel, although the default of 32 kB\n\t\t  should be more than enough for most cases.\n\n\t\t  Keyword **repeat** is used to indicate the number of\n\t\t  consecutive runs to perform. Note that output data and\n\t\t  context printed to files correspond to the last of those\n\t\t  runs. The duration printed out at the end of the runs is an\n\t\t  average over all runs performed by the command.\n\n\t\t  Not all program types support test run. Among those which do,\n\t\t  not all of them can take the **ctx_in**/**ctx_out**\n\t\t  arguments. bpftool does not perform checks on program types.\n\n\t**bpftool prog profile** *PROG* [**duration** *DURATION*] *METRICs*\n\t\t  Profile *METRICs* for bpf program *PROG* for *DURATION*\n\t\t  seconds or until user hits <Ctrl+C>. *DURATION* is optional.\n\t\t  If *DURATION* is not specified, the profiling will run up to\n\t\t  **UINT_MAX** seconds.\n\n\t**bpftool prog help**\n\t\t  Print short help message.\n\nOPTIONS\n=======\n\t.. include:: common_options.rst\n\n\t-f, --bpffs\n\t\t  When showing BPF programs, show file names of pinned\n\t\t  programs.\n\n\t-m, --mapcompat\n\t\t  Allow loading maps with unknown map definitions.\n\n\t-n, --nomount\n\t\t  Do not automatically attempt to mount any virtual file system\n\t\t  (such as tracefs or BPF virtual file system) when necessary.\n\n\t-L, --use-loader\n\t\t  Load program as a \"loader\" program. This is useful to debug\n\t\t  the generation of such programs. When this option is in\n\t\t  use, bpftool attempts to load the programs from the object\n\t\t  file into the kernel, but does not pin them (therefore, the\n\t\t  *PATH* must not be provided).\n\n\t\t  When combined with the **-d**\\ \\|\\ **--debug** option,\n\t\t  additional debug messages are generated, and the execution\n\t\t  of the loader program will use the **bpf_trace_printk**\\ ()\n\t\t  helper to log each step of loading BTF, creating the maps,\n\t\t  and loading the programs (see **bpftool prog tracelog** as\n\t\t  a way to dump those messages).\n\nEXAMPLES\n========\n**# bpftool prog show**\n\n::\n\n    10: xdp  name some_prog  tag 005a3d2123620c8b  gpl run_time_ns 81632 run_cnt 10\n            loaded_at 2017-09-29T20:11:00+0000  uid 0\n            xlated 528B  jited 370B  memlock 4096B  map_ids 10\n            pids systemd(1)\n\n**# bpftool --json --pretty prog show**\n\n::\n\n    [{\n            \"id\": 10,\n            \"type\": \"xdp\",\n            \"tag\": \"005a3d2123620c8b\",\n            \"gpl_compatible\": true,\n            \"run_time_ns\": 81632,\n            \"run_cnt\": 10,\n            \"loaded_at\": 1506715860,\n            \"uid\": 0,\n            \"bytes_xlated\": 528,\n            \"jited\": true,\n            \"bytes_jited\": 370,\n            \"bytes_memlock\": 4096,\n            \"map_ids\": [10\n            ],\n            \"pids\": [{\n                    \"pid\": 1,\n                    \"comm\": \"systemd\"\n                }\n            ]\n        }\n    ]\n\n|\n| **# bpftool prog dump xlated id 10 file /tmp/t**\n| **$ ls -l /tmp/t**\n\n::\n\n    -rw------- 1 root root 560 Jul 22 01:42 /tmp/t\n\n**# bpftool prog dump jited tag 005a3d2123620c8b**\n\n::\n\n    0:   push   %rbp\n    1:   mov    %rsp,%rbp\n    2:   sub    $0x228,%rsp\n    3:   sub    $0x28,%rbp\n    4:   mov    %rbx,0x0(%rbp)\n\n|\n| **# mount -t bpf none /sys/fs/bpf/**\n| **# bpftool prog pin id 10 /sys/fs/bpf/prog**\n| **# bpftool prog load ./my_prog.o /sys/fs/bpf/prog2**\n| **# ls -l /sys/fs/bpf/**\n\n::\n\n    -rw------- 1 root root 0 Jul 22 01:43 prog\n    -rw------- 1 root root 0 Jul 22 01:44 prog2\n\n**# bpftool prog dump jited pinned /sys/fs/bpf/prog opcodes**\n\n::\n\n   0:   push   %rbp\n        55\n   1:   mov    %rsp,%rbp\n        48 89 e5\n   4:   sub    $0x228,%rsp\n        48 81 ec 28 02 00 00\n   b:   sub    $0x28,%rbp\n        48 83 ed 28\n   f:   mov    %rbx,0x0(%rbp)\n        48 89 5d 00\n\n|\n| **# bpftool prog load xdp1_kern.o /sys/fs/bpf/xdp1 type xdp map name rxcnt id 7**\n| **# bpftool prog show pinned /sys/fs/bpf/xdp1**\n\n::\n\n    9: xdp  name xdp_prog1  tag 539ec6ce11b52f98  gpl\n            loaded_at 2018-06-25T16:17:31-0700  uid 0\n            xlated 488B  jited 336B  memlock 4096B  map_ids 7\n\n**# rm /sys/fs/bpf/xdp1**\n\n|\n| **# bpftool prog profile id 337 duration 10 cycles instructions llc_misses**\n\n::\n\n         51397 run_cnt\n      40176203 cycles                                                 (83.05%)\n      42518139 instructions    #   1.06 insns per cycle               (83.39%)\n           123 llc_misses      #   2.89 LLC misses per million insns  (83.15%)\n\n|\n| Output below is for the trace logs.\n| Run in separate terminals:\n| **# bpftool prog tracelog**\n| **# bpftool prog load -L -d file.o**\n\n::\n\n    bpftool-620059  [004] d... 2634685.517903: bpf_trace_printk: btf_load size 665 r=5\n    bpftool-620059  [004] d... 2634685.517912: bpf_trace_printk: map_create sample_map idx 0 type 2 value_size 4 value_btf_id 0 r=6\n    bpftool-620059  [004] d... 2634685.517997: bpf_trace_printk: prog_load sample insn_cnt 13 r=7\n    bpftool-620059  [004] d... 2634685.517999: bpf_trace_printk: close(5) = 0\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}