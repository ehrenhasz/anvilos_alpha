{
  "module_name": "Makefile",
  "hash_id": "4a5f73230ca5c5af331d582792b50af37a222374230eec91c48437be8cbc1c42",
  "original_prompt": "Ingested from linux-6.6.14/tools/bpf/bpftool/Makefile",
  "human_readable_source": "# SPDX-License-Identifier: (GPL-2.0-only OR BSD-2-Clause)\ninclude ../../scripts/Makefile.include\n\nifeq ($(srctree),)\nsrctree := $(patsubst %/,%,$(dir $(CURDIR)))\nsrctree := $(patsubst %/,%,$(dir $(srctree)))\nsrctree := $(patsubst %/,%,$(dir $(srctree)))\nendif\n\nifeq ($(V),1)\n  Q =\nelse\n  Q = @\nendif\n\nBPF_DIR = $(srctree)/tools/lib/bpf\n\nifneq ($(OUTPUT),)\n  _OUTPUT := $(OUTPUT)\nelse\n  _OUTPUT := $(CURDIR)/\nendif\nBOOTSTRAP_OUTPUT := $(_OUTPUT)bootstrap/\n\nLIBBPF_OUTPUT := $(_OUTPUT)libbpf/\nLIBBPF_DESTDIR := $(LIBBPF_OUTPUT)\nLIBBPF_INCLUDE := $(LIBBPF_DESTDIR)include\nLIBBPF_HDRS_DIR := $(LIBBPF_INCLUDE)/bpf\nLIBBPF := $(LIBBPF_OUTPUT)libbpf.a\n\nLIBBPF_BOOTSTRAP_OUTPUT := $(BOOTSTRAP_OUTPUT)libbpf/\nLIBBPF_BOOTSTRAP_DESTDIR := $(LIBBPF_BOOTSTRAP_OUTPUT)\nLIBBPF_BOOTSTRAP_INCLUDE := $(LIBBPF_BOOTSTRAP_DESTDIR)include\nLIBBPF_BOOTSTRAP_HDRS_DIR := $(LIBBPF_BOOTSTRAP_INCLUDE)/bpf\nLIBBPF_BOOTSTRAP := $(LIBBPF_BOOTSTRAP_OUTPUT)libbpf.a\n\n# We need to copy hashmap.h, nlattr.h, relo_core.h and libbpf_internal.h\n# which are not otherwise exported by libbpf, but still required by bpftool.\nLIBBPF_INTERNAL_HDRS := $(addprefix $(LIBBPF_HDRS_DIR)/,hashmap.h nlattr.h relo_core.h libbpf_internal.h)\nLIBBPF_BOOTSTRAP_INTERNAL_HDRS := $(addprefix $(LIBBPF_BOOTSTRAP_HDRS_DIR)/,hashmap.h relo_core.h libbpf_internal.h)\n\n$(LIBBPF_OUTPUT) $(BOOTSTRAP_OUTPUT) $(LIBBPF_BOOTSTRAP_OUTPUT) $(LIBBPF_HDRS_DIR) $(LIBBPF_BOOTSTRAP_HDRS_DIR):\n\t$(QUIET_MKDIR)mkdir -p $@\n\n$(LIBBPF): $(wildcard $(BPF_DIR)/*.[ch] $(BPF_DIR)/Makefile) | $(LIBBPF_OUTPUT)\n\t$(Q)$(MAKE) -C $(BPF_DIR) OUTPUT=$(LIBBPF_OUTPUT) \\\n\t\tDESTDIR=$(LIBBPF_DESTDIR:/=) prefix= $(LIBBPF) install_headers\n\n$(LIBBPF_INTERNAL_HDRS): $(LIBBPF_HDRS_DIR)/%.h: $(BPF_DIR)/%.h | $(LIBBPF_HDRS_DIR)\n\t$(call QUIET_INSTALL, $@)\n\t$(Q)install -m 644 -t $(LIBBPF_HDRS_DIR) $<\n\n$(LIBBPF_BOOTSTRAP): $(wildcard $(BPF_DIR)/*.[ch] $(BPF_DIR)/Makefile) | $(LIBBPF_BOOTSTRAP_OUTPUT)\n\t$(Q)$(MAKE) -C $(BPF_DIR) OUTPUT=$(LIBBPF_BOOTSTRAP_OUTPUT) \\\n\t\tDESTDIR=$(LIBBPF_BOOTSTRAP_DESTDIR:/=) prefix= \\\n\t\tARCH= CROSS_COMPILE= CC=\"$(HOSTCC)\" LD=\"$(HOSTLD)\" AR=\"$(HOSTAR)\" $@ install_headers\n\n$(LIBBPF_BOOTSTRAP_INTERNAL_HDRS): $(LIBBPF_BOOTSTRAP_HDRS_DIR)/%.h: $(BPF_DIR)/%.h | $(LIBBPF_BOOTSTRAP_HDRS_DIR)\n\t$(call QUIET_INSTALL, $@)\n\t$(Q)install -m 644 -t $(LIBBPF_BOOTSTRAP_HDRS_DIR) $<\n\n$(LIBBPF)-clean: FORCE | $(LIBBPF_OUTPUT)\n\t$(call QUIET_CLEAN, libbpf)\n\t$(Q)$(MAKE) -C $(BPF_DIR) OUTPUT=$(LIBBPF_OUTPUT) clean >/dev/null\n\n$(LIBBPF_BOOTSTRAP)-clean: FORCE | $(LIBBPF_BOOTSTRAP_OUTPUT)\n\t$(call QUIET_CLEAN, libbpf-bootstrap)\n\t$(Q)$(MAKE) -C $(BPF_DIR) OUTPUT=$(LIBBPF_BOOTSTRAP_OUTPUT) clean >/dev/null\n\nprefix ?= /usr/local\nbash_compdir ?= /usr/share/bash-completion/completions\n\nCFLAGS += -O2\nCFLAGS += -W -Wall -Wextra -Wno-unused-parameter -Wno-missing-field-initializers\nCFLAGS += $(filter-out -Wswitch-enum -Wnested-externs,$(EXTRA_WARNINGS))\nCFLAGS += -DPACKAGE='\"bpftool\"' -D__EXPORTED_HEADERS__ \\\n\t-I$(or $(OUTPUT),.) \\\n\t-I$(LIBBPF_INCLUDE) \\\n\t-I$(srctree)/kernel/bpf/ \\\n\t-I$(srctree)/tools/include \\\n\t-I$(srctree)/tools/include/uapi\nifneq ($(BPFTOOL_VERSION),)\nCFLAGS += -DBPFTOOL_VERSION='\"$(BPFTOOL_VERSION)\"'\nendif\nifneq ($(EXTRA_CFLAGS),)\nCFLAGS += $(EXTRA_CFLAGS)\nendif\nifneq ($(EXTRA_LDFLAGS),)\nLDFLAGS += $(EXTRA_LDFLAGS)\nendif\n\nINSTALL ?= install\nRM ?= rm -f\n\nFEATURE_USER = .bpftool\n\nFEATURE_TESTS := clang-bpf-co-re\nFEATURE_TESTS += llvm\nFEATURE_TESTS += libcap\nFEATURE_TESTS += libbfd\nFEATURE_TESTS += libbfd-liberty\nFEATURE_TESTS += libbfd-liberty-z\nFEATURE_TESTS += disassembler-four-args\nFEATURE_TESTS += disassembler-init-styled\n\nFEATURE_DISPLAY := clang-bpf-co-re\nFEATURE_DISPLAY += llvm\nFEATURE_DISPLAY += libcap\nFEATURE_DISPLAY += libbfd\nFEATURE_DISPLAY += libbfd-liberty\nFEATURE_DISPLAY += libbfd-liberty-z\n\ncheck_feat := 1\nNON_CHECK_FEAT_TARGETS := clean uninstall doc doc-clean doc-install doc-uninstall\nifdef MAKECMDGOALS\nifeq ($(filter-out $(NON_CHECK_FEAT_TARGETS),$(MAKECMDGOALS)),)\n  check_feat := 0\nendif\nendif\n\nifeq ($(check_feat),1)\nifeq ($(FEATURES_DUMP),)\ninclude $(srctree)/tools/build/Makefile.feature\nelse\ninclude $(FEATURES_DUMP)\nendif\nendif\n\nLIBS = $(LIBBPF) -lelf -lz\nLIBS_BOOTSTRAP = $(LIBBPF_BOOTSTRAP) -lelf -lz\nifeq ($(feature-libcap), 1)\nCFLAGS += -DUSE_LIBCAP\nLIBS += -lcap\nendif\n\ninclude $(wildcard $(OUTPUT)*.d)\n\nall: $(OUTPUT)bpftool\n\nSRCS := $(wildcard *.c)\n\nifeq ($(feature-llvm),1)\n  # If LLVM is available, use it for JIT disassembly\n  CFLAGS  += -DHAVE_LLVM_SUPPORT\n  LLVM_CONFIG_LIB_COMPONENTS := mcdisassembler all-targets\n  CFLAGS  += $(shell $(LLVM_CONFIG) --cflags --libs $(LLVM_CONFIG_LIB_COMPONENTS))\n  LIBS    += $(shell $(LLVM_CONFIG) --libs $(LLVM_CONFIG_LIB_COMPONENTS))\n  ifeq ($(shell $(LLVM_CONFIG) --shared-mode),static)\n    LIBS += $(shell $(LLVM_CONFIG) --system-libs $(LLVM_CONFIG_LIB_COMPONENTS))\n    LIBS += -lstdc++\n  endif\n  LDFLAGS += $(shell $(LLVM_CONFIG) --ldflags)\nelse\n  # Fall back on libbfd\n  ifeq ($(feature-libbfd),1)\n    LIBS += -lbfd -ldl -lopcodes\n  else ifeq ($(feature-libbfd-liberty),1)\n    LIBS += -lbfd -ldl -lopcodes -liberty\n  else ifeq ($(feature-libbfd-liberty-z),1)\n    LIBS += -lbfd -ldl -lopcodes -liberty -lz\n  endif\n\n  # If one of the above feature combinations is set, we support libbfd\n  ifneq ($(filter -lbfd,$(LIBS)),)\n    CFLAGS += -DHAVE_LIBBFD_SUPPORT\n\n    # Libbfd interface changed over time, figure out what we need\n    ifeq ($(feature-disassembler-four-args), 1)\n      CFLAGS += -DDISASM_FOUR_ARGS_SIGNATURE\n    endif\n    ifeq ($(feature-disassembler-init-styled), 1)\n      CFLAGS += -DDISASM_INIT_STYLED\n    endif\n  endif\nendif\nifeq ($(filter -DHAVE_LLVM_SUPPORT -DHAVE_LIBBFD_SUPPORT,$(CFLAGS)),)\n  # No support for JIT disassembly\n  SRCS := $(filter-out jit_disasm.c,$(SRCS))\nendif\n\nHOST_CFLAGS = $(subst -I$(LIBBPF_INCLUDE),-I$(LIBBPF_BOOTSTRAP_INCLUDE),\\\n\t\t$(subst $(CLANG_CROSS_FLAGS),,$(CFLAGS)))\n\nBPFTOOL_BOOTSTRAP := $(BOOTSTRAP_OUTPUT)bpftool\n\nBOOTSTRAP_OBJS = $(addprefix $(BOOTSTRAP_OUTPUT),main.o common.o json_writer.o gen.o btf.o xlated_dumper.o btf_dumper.o disasm.o)\n$(BOOTSTRAP_OBJS): $(LIBBPF_BOOTSTRAP)\n\nOBJS = $(patsubst %.c,$(OUTPUT)%.o,$(SRCS)) $(OUTPUT)disasm.o\n$(OBJS): $(LIBBPF) $(LIBBPF_INTERNAL_HDRS)\n\nVMLINUX_BTF_PATHS ?= $(if $(O),$(O)/vmlinux)\t\t\t\t\\\n\t\t     $(if $(KBUILD_OUTPUT),$(KBUILD_OUTPUT)/vmlinux)\t\\\n\t\t     ../../../vmlinux\t\t\t\t\t\\\n\t\t     /sys/kernel/btf/vmlinux\t\t\t\t\\\n\t\t     /boot/vmlinux-$(shell uname -r)\nVMLINUX_BTF ?= $(abspath $(firstword $(wildcard $(VMLINUX_BTF_PATHS))))\n\nbootstrap: $(BPFTOOL_BOOTSTRAP)\n\nifneq ($(VMLINUX_BTF)$(VMLINUX_H),)\nifeq ($(feature-clang-bpf-co-re),1)\n\nBUILD_BPF_SKELS := 1\n\n$(OUTPUT)vmlinux.h: $(VMLINUX_BTF) $(BPFTOOL_BOOTSTRAP)\nifeq ($(VMLINUX_H),)\n\t$(QUIET_GEN)$(BPFTOOL_BOOTSTRAP) btf dump file $< format c > $@\nelse\n\t$(Q)cp \"$(VMLINUX_H)\" $@\nendif\n\n$(OUTPUT)%.bpf.o: skeleton/%.bpf.c $(OUTPUT)vmlinux.h $(LIBBPF_BOOTSTRAP)\n\t$(QUIET_CLANG)$(CLANG) \\\n\t\t-I$(or $(OUTPUT),.) \\\n\t\t-I$(srctree)/tools/include/uapi/ \\\n\t\t-I$(LIBBPF_BOOTSTRAP_INCLUDE) \\\n\t\t-g -O2 -Wall -fno-stack-protector \\\n\t\t--target=bpf -c $< -o $@\n\t$(Q)$(LLVM_STRIP) -g $@\n\n$(OUTPUT)%.skel.h: $(OUTPUT)%.bpf.o $(BPFTOOL_BOOTSTRAP)\n\t$(QUIET_GEN)$(BPFTOOL_BOOTSTRAP) gen skeleton $< > $@\n\n$(OUTPUT)prog.o: $(OUTPUT)profiler.skel.h\n\n$(OUTPUT)pids.o: $(OUTPUT)pid_iter.skel.h\n\nendif\nendif\n\nCFLAGS += $(if $(BUILD_BPF_SKELS),,-DBPFTOOL_WITHOUT_SKELETONS)\n\n$(BOOTSTRAP_OUTPUT)disasm.o: $(srctree)/kernel/bpf/disasm.c\n\t$(QUIET_CC)$(HOSTCC) $(HOST_CFLAGS) -c -MMD $< -o $@\n\n$(OUTPUT)disasm.o: $(srctree)/kernel/bpf/disasm.c\n\t$(QUIET_CC)$(CC) $(CFLAGS) -c -MMD $< -o $@\n\n$(BPFTOOL_BOOTSTRAP): $(BOOTSTRAP_OBJS) $(LIBBPF_BOOTSTRAP)\n\t$(QUIET_LINK)$(HOSTCC) $(HOST_CFLAGS) $(LDFLAGS) $(BOOTSTRAP_OBJS) $(LIBS_BOOTSTRAP) -o $@\n\n$(OUTPUT)bpftool: $(OBJS) $(LIBBPF)\n\t$(QUIET_LINK)$(CC) $(CFLAGS) $(LDFLAGS) $(OBJS) $(LIBS) -o $@\n\n$(BOOTSTRAP_OUTPUT)%.o: %.c $(LIBBPF_BOOTSTRAP_INTERNAL_HDRS) | $(BOOTSTRAP_OUTPUT)\n\t$(QUIET_CC)$(HOSTCC) $(HOST_CFLAGS) -c -MMD $< -o $@\n\n$(OUTPUT)%.o: %.c\n\t$(QUIET_CC)$(CC) $(CFLAGS) -c -MMD $< -o $@\n\nfeature-detect-clean:\n\t$(call QUIET_CLEAN, feature-detect)\n\t$(Q)$(MAKE) -C $(srctree)/tools/build/feature/ clean >/dev/null\n\nclean: $(LIBBPF)-clean $(LIBBPF_BOOTSTRAP)-clean feature-detect-clean\n\t$(call QUIET_CLEAN, bpftool)\n\t$(Q)$(RM) -- $(OUTPUT)bpftool $(OUTPUT)*.o $(OUTPUT)*.d\n\t$(Q)$(RM) -- $(OUTPUT)*.skel.h $(OUTPUT)vmlinux.h\n\t$(Q)$(RM) -r -- $(LIBBPF_OUTPUT) $(BOOTSTRAP_OUTPUT)\n\t$(call QUIET_CLEAN, core-gen)\n\t$(Q)$(RM) -- $(OUTPUT)FEATURE-DUMP.bpftool\n\t$(Q)$(RM) -r -- $(OUTPUT)feature/\n\ninstall-bin: $(OUTPUT)bpftool\n\t$(call QUIET_INSTALL, bpftool)\n\t$(Q)$(INSTALL) -m 0755 -d $(DESTDIR)$(prefix)/sbin\n\t$(Q)$(INSTALL) $(OUTPUT)bpftool $(DESTDIR)$(prefix)/sbin/bpftool\n\ninstall: install-bin\n\t$(Q)$(INSTALL) -m 0755 -d $(DESTDIR)$(bash_compdir)\n\t$(Q)$(INSTALL) -m 0644 bash-completion/bpftool $(DESTDIR)$(bash_compdir)\n\nuninstall:\n\t$(call QUIET_UNINST, bpftool)\n\t$(Q)$(RM) -- $(DESTDIR)$(prefix)/sbin/bpftool\n\t$(Q)$(RM) -- $(DESTDIR)$(bash_compdir)/bpftool\n\ndoc:\n\t$(call descend,Documentation)\n\ndoc-clean:\n\t$(call descend,Documentation,clean)\n\ndoc-install:\n\t$(call descend,Documentation,install)\n\ndoc-uninstall:\n\t$(call descend,Documentation,uninstall)\n\nFORCE:\n\n.SECONDARY:\n.PHONY: all FORCE bootstrap clean install-bin install uninstall\n.PHONY: doc doc-clean doc-install doc-uninstall\n.DEFAULT_GOAL := all\n\n# Delete partially updated (corrupted) files on error\n.DELETE_ON_ERROR:\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}