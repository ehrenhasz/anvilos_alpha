{
  "module_name": "scatterlist.h",
  "hash_id": "91f49ed285f061afb43a925540c704f6cf12cdd6cecc64c2a1bb162be701ca3f",
  "original_prompt": "Ingested from linux-6.6.14/tools/virtio/linux/scatterlist.h",
  "human_readable_source": " \n#ifndef SCATTERLIST_H\n#define SCATTERLIST_H\n#include <linux/kernel.h>\n#include <linux/bug.h>\n\nstruct scatterlist {\n\tunsigned long\tpage_link;\n\tunsigned int\toffset;\n\tunsigned int\tlength;\n\tdma_addr_t\tdma_address;\n};\n\n \n#define sg_is_chain(sg)\t\t((sg)->page_link & 0x01)\n#define sg_is_last(sg)\t\t((sg)->page_link & 0x02)\n#define sg_chain_ptr(sg)\t\\\n\t((struct scatterlist *) ((sg)->page_link & ~0x03))\n\n \nstatic inline void sg_assign_page(struct scatterlist *sg, struct page *page)\n{\n\tunsigned long page_link = sg->page_link & 0x3;\n\n\t \n\tBUG_ON((unsigned long) page & 0x03);\n#ifdef CONFIG_DEBUG_SG\n\tBUG_ON(sg_is_chain(sg));\n#endif\n\tsg->page_link = page_link | (unsigned long) page;\n}\n\n \nstatic inline void sg_set_page(struct scatterlist *sg, struct page *page,\n\t\t\t       unsigned int len, unsigned int offset)\n{\n\tsg_assign_page(sg, page);\n\tsg->offset = offset;\n\tsg->length = len;\n}\n\nstatic inline struct page *sg_page(struct scatterlist *sg)\n{\n#ifdef CONFIG_DEBUG_SG\n\tBUG_ON(sg_is_chain(sg));\n#endif\n\treturn (struct page *)((sg)->page_link & ~0x3);\n}\n\n \n#define for_each_sg(sglist, sg, nr, __i)\t\\\n\tfor (__i = 0, sg = (sglist); __i < (nr); __i++, sg = sg_next(sg))\n\n \nstatic inline void sg_chain(struct scatterlist *prv, unsigned int prv_nents,\n\t\t\t    struct scatterlist *sgl)\n{\n\t \n\tprv[prv_nents - 1].offset = 0;\n\tprv[prv_nents - 1].length = 0;\n\n\t \n\tprv[prv_nents - 1].page_link = ((unsigned long) sgl | 0x01) & ~0x02;\n}\n\n \nstatic inline void sg_mark_end(struct scatterlist *sg)\n{\n\t \n\tsg->page_link |= 0x02;\n\tsg->page_link &= ~0x01;\n}\n\n \nstatic inline void sg_unmark_end(struct scatterlist *sg)\n{\n\tsg->page_link &= ~0x02;\n}\n\nstatic inline struct scatterlist *sg_next(struct scatterlist *sg)\n{\n\tif (sg_is_last(sg))\n\t\treturn NULL;\n\n\tsg++;\n\tif (unlikely(sg_is_chain(sg)))\n\t\tsg = sg_chain_ptr(sg);\n\n\treturn sg;\n}\n\nstatic inline void sg_init_table(struct scatterlist *sgl, unsigned int nents)\n{\n\tmemset(sgl, 0, sizeof(*sgl) * nents);\n\tsg_mark_end(&sgl[nents - 1]);\n}\n\nstatic inline dma_addr_t sg_phys(struct scatterlist *sg)\n{\n\treturn page_to_phys(sg_page(sg)) + sg->offset;\n}\n\nstatic inline void sg_set_buf(struct scatterlist *sg, const void *buf,\n\t\t\t      unsigned int buflen)\n{\n\tsg_set_page(sg, virt_to_page(buf), buflen, offset_in_page(buf));\n}\n\nstatic inline void sg_init_one(struct scatterlist *sg,\n\t\t\t       const void *buf, unsigned int buflen)\n{\n\tsg_init_table(sg, 1);\n\tsg_set_buf(sg, buf, buflen);\n}\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}