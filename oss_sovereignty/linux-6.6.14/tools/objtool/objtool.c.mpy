{
  "module_name": "objtool.c",
  "hash_id": "cfa0677de7a228e174044e1f46ed94bd24b46190501faaabc12f10fc60a6a4b0",
  "original_prompt": "Ingested from linux-6.6.14/tools/objtool/objtool.c",
  "human_readable_source": "\n \n\n#include <stdio.h>\n#include <stdbool.h>\n#include <string.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <subcmd/exec-cmd.h>\n#include <subcmd/pager.h>\n#include <linux/kernel.h>\n\n#include <objtool/builtin.h>\n#include <objtool/objtool.h>\n#include <objtool/warn.h>\n\nbool help;\n\nconst char *objname;\nstatic struct objtool_file file;\n\nstatic bool objtool_create_backup(const char *_objname)\n{\n\tint len = strlen(_objname);\n\tchar *buf, *base, *name = malloc(len+6);\n\tint s, d, l, t;\n\n\tif (!name) {\n\t\tperror(\"failed backup name malloc\");\n\t\treturn false;\n\t}\n\n\tstrcpy(name, _objname);\n\tstrcpy(name + len, \".orig\");\n\n\td = open(name, O_CREAT|O_WRONLY|O_TRUNC, 0644);\n\tif (d < 0) {\n\t\tperror(\"failed to create backup file\");\n\t\treturn false;\n\t}\n\n\ts = open(_objname, O_RDONLY);\n\tif (s < 0) {\n\t\tperror(\"failed to open orig file\");\n\t\treturn false;\n\t}\n\n\tbuf = malloc(4096);\n\tif (!buf) {\n\t\tperror(\"failed backup data malloc\");\n\t\treturn false;\n\t}\n\n\twhile ((l = read(s, buf, 4096)) > 0) {\n\t\tbase = buf;\n\t\tdo {\n\t\t\tt = write(d, base, l);\n\t\t\tif (t < 0) {\n\t\t\t\tperror(\"failed backup write\");\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tbase += t;\n\t\t\tl -= t;\n\t\t} while (l);\n\t}\n\n\tif (l < 0) {\n\t\tperror(\"failed backup read\");\n\t\treturn false;\n\t}\n\n\tfree(name);\n\tfree(buf);\n\tclose(d);\n\tclose(s);\n\n\treturn true;\n}\n\nstruct objtool_file *objtool_open_read(const char *_objname)\n{\n\tif (objname) {\n\t\tif (strcmp(objname, _objname)) {\n\t\t\tWARN(\"won't handle more than one file at a time\");\n\t\t\treturn NULL;\n\t\t}\n\t\treturn &file;\n\t}\n\tobjname = _objname;\n\n\tfile.elf = elf_open_read(objname, O_RDWR);\n\tif (!file.elf)\n\t\treturn NULL;\n\n\tif (opts.backup && !objtool_create_backup(objname)) {\n\t\tWARN(\"can't create backup file\");\n\t\treturn NULL;\n\t}\n\n\thash_init(file.insn_hash);\n\tINIT_LIST_HEAD(&file.retpoline_call_list);\n\tINIT_LIST_HEAD(&file.return_thunk_list);\n\tINIT_LIST_HEAD(&file.static_call_list);\n\tINIT_LIST_HEAD(&file.mcount_loc_list);\n\tINIT_LIST_HEAD(&file.endbr_list);\n\tINIT_LIST_HEAD(&file.call_list);\n\tfile.ignore_unreachables = opts.no_unreachable;\n\tfile.hints = false;\n\n\treturn &file;\n}\n\nvoid objtool_pv_add(struct objtool_file *f, int idx, struct symbol *func)\n{\n\tif (!opts.noinstr)\n\t\treturn;\n\n\tif (!f->pv_ops) {\n\t\tWARN(\"paravirt confusion\");\n\t\treturn;\n\t}\n\n\t \n\tif (!strcmp(func->name, \"_paravirt_nop\") ||\n\t    !strcmp(func->name, \"_paravirt_ident_64\"))\n\t\treturn;\n\n\t \n\tif (!list_empty(&func->pv_target))\n\t\treturn;\n\n\tlist_add(&func->pv_target, &f->pv_ops[idx].targets);\n\tf->pv_ops[idx].clean = false;\n}\n\nint main(int argc, const char **argv)\n{\n\tstatic const char *UNUSED = \"OBJTOOL_NOT_IMPLEMENTED\";\n\n\t \n\texec_cmd_init(\"objtool\", UNUSED, UNUSED, UNUSED);\n\tpager_init(UNUSED);\n\n\treturn objtool_run(argc, argv);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}