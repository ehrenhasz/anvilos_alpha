{
  "module_name": "lsvmbus",
  "hash_id": "74ecd885852ffd336d0dcce7ef3340bfe0c19df9b349d0fbf26d194503e20cc5",
  "original_prompt": "Ingested from linux-6.6.14/tools/hv/lsvmbus",
  "human_readable_source": "#!/usr/bin/env python\n# SPDX-License-Identifier: GPL-2.0\n\nimport os\nfrom optparse import OptionParser\n\nhelp_msg = \"print verbose messages. Try -vv, -vvv for  more verbose messages\"\nparser = OptionParser()\nparser.add_option(\n\t\"-v\", \"--verbose\", dest=\"verbose\", help=help_msg, action=\"count\")\n\n(options, args) = parser.parse_args()\n\nverbose = 0\nif options.verbose is not None:\n\tverbose = options.verbose\n\nvmbus_sys_path = '/sys/bus/vmbus/devices'\nif not os.path.isdir(vmbus_sys_path):\n\tprint(\"%s doesn't exist: exiting...\" % vmbus_sys_path)\n\texit(-1)\n\nvmbus_dev_dict = {\n\t'{0e0b6031-5213-4934-818b-38d90ced39db}': '[Operating system shutdown]',\n\t'{9527e630-d0ae-497b-adce-e80ab0175caf}': '[Time Synchronization]',\n\t'{57164f39-9115-4e78-ab55-382f3bd5422d}': '[Heartbeat]',\n\t'{a9a0f4e7-5a45-4d96-b827-8a841e8c03e6}': '[Data Exchange]',\n\t'{35fa2e29-ea23-4236-96ae-3a6ebacba440}': '[Backup (volume checkpoint)]',\n\t'{34d14be3-dee4-41c8-9ae7-6b174977c192}': '[Guest services]',\n\t'{525074dc-8985-46e2-8057-a307dc18a502}': '[Dynamic Memory]',\n\t'{cfa8b69e-5b4a-4cc0-b98b-8ba1a1f3f95a}': 'Synthetic mouse',\n\t'{f912ad6d-2b17-48ea-bd65-f927a61c7684}': 'Synthetic keyboard',\n\t'{da0a7802-e377-4aac-8e77-0558eb1073f8}': 'Synthetic framebuffer adapter',\n\t'{f8615163-df3e-46c5-913f-f2d2f965ed0e}': 'Synthetic network adapter',\n\t'{32412632-86cb-44a2-9b5c-50d1417354f5}': 'Synthetic IDE Controller',\n\t'{ba6163d9-04a1-4d29-b605-72e2ffb1dc7f}': 'Synthetic SCSI Controller',\n\t'{2f9bcc4a-0069-4af3-b76b-6fd0be528cda}': 'Synthetic fiber channel adapter',\n\t'{8c2eaf3d-32a7-4b09-ab99-bd1f1c86b501}': 'Synthetic RDMA adapter',\n\t'{44c4f61d-4444-4400-9d52-802e27ede19f}': 'PCI Express pass-through',\n\t'{276aacf4-ac15-426c-98dd-7521ad3f01fe}': '[Reserved system device]',\n\t'{f8e65716-3cb3-4a06-9a60-1889c5cccab5}': '[Reserved system device]',\n\t'{3375baf4-9e15-4b30-b765-67acb10d607b}': '[Reserved system device]',\n}\n\n\ndef get_vmbus_dev_attr(dev_name, attr):\n\ttry:\n\t\tf = open('%s/%s/%s' % (vmbus_sys_path, dev_name, attr), 'r')\n\t\tlines = f.readlines()\n\t\tf.close()\n\texcept IOError:\n\t\tlines = []\n\n\treturn lines\n\n\nclass VMBus_Dev:\n\tpass\n\n\nvmbus_dev_list = []\n\nfor f in os.listdir(vmbus_sys_path):\n\tvmbus_id = get_vmbus_dev_attr(f, 'id')[0].strip()\n\tclass_id = get_vmbus_dev_attr(f, 'class_id')[0].strip()\n\tdevice_id = get_vmbus_dev_attr(f, 'device_id')[0].strip()\n\tdev_desc = vmbus_dev_dict.get(class_id, 'Unknown')\n\n\tchn_vp_mapping = get_vmbus_dev_attr(f, 'channel_vp_mapping')\n\tchn_vp_mapping = [c.strip() for c in chn_vp_mapping]\n\tchn_vp_mapping = sorted(\n\t\tchn_vp_mapping, key=lambda c: int(c.split(':')[0]))\n\n\tchn_vp_mapping = [\n\t\t'\\tRel_ID=%s, target_cpu=%s' %\n\t\t(c.split(':')[0], c.split(':')[1]) for c in chn_vp_mapping\n\t]\n\td = VMBus_Dev()\n\td.sysfs_path = '%s/%s' % (vmbus_sys_path, f)\n\td.vmbus_id = vmbus_id\n\td.class_id = class_id\n\td.device_id = device_id\n\td.dev_desc = dev_desc\n\td.chn_vp_mapping = '\\n'.join(chn_vp_mapping)\n\tif d.chn_vp_mapping:\n\t\td.chn_vp_mapping += '\\n'\n\n\tvmbus_dev_list.append(d)\n\n\nvmbus_dev_list = sorted(vmbus_dev_list, key=lambda d: int(d.vmbus_id))\n\nformat0 = '%2s: %s'\nformat1 = '%2s: Class_ID = %s - %s\\n%s'\nformat2 = '%2s: Class_ID = %s - %s\\n\\tDevice_ID = %s\\n\\tSysfs path: %s\\n%s'\n\nfor d in vmbus_dev_list:\n\tif verbose == 0:\n\t\tprint(('VMBUS ID ' + format0) % (d.vmbus_id, d.dev_desc))\n\telif verbose == 1:\n\t\tprint(\n\t\t\t('VMBUS ID ' + format1) %\n\t\t\t(d.vmbus_id, d.class_id, d.dev_desc, d.chn_vp_mapping)\n\t\t)\n\telse:\n\t\tprint(\n\t\t\t('VMBUS ID ' + format2) %\n\t\t\t(\n\t\t\t\td.vmbus_id, d.class_id, d.dev_desc,\n\t\t\t\td.device_id, d.sysfs_path, d.chn_vp_mapping\n\t\t\t)\n\t\t)\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}