{
  "module_name": "scatterwalk.c",
  "hash_id": "131fc10bc21eda266812e795c89d70581345a4c823820b9f2b0aadb86e443621",
  "original_prompt": "Ingested from linux-6.6.14/crypto/scatterwalk.c",
  "human_readable_source": "\n \n\n#include <crypto/scatterwalk.h>\n#include <linux/kernel.h>\n#include <linux/mm.h>\n#include <linux/module.h>\n#include <linux/scatterlist.h>\n\nstatic inline void memcpy_dir(void *buf, void *sgdata, size_t nbytes, int out)\n{\n\tvoid *src = out ? buf : sgdata;\n\tvoid *dst = out ? sgdata : buf;\n\n\tmemcpy(dst, src, nbytes);\n}\n\nvoid scatterwalk_copychunks(void *buf, struct scatter_walk *walk,\n\t\t\t    size_t nbytes, int out)\n{\n\tfor (;;) {\n\t\tunsigned int len_this_page = scatterwalk_pagelen(walk);\n\t\tu8 *vaddr;\n\n\t\tif (len_this_page > nbytes)\n\t\t\tlen_this_page = nbytes;\n\n\t\tif (out != 2) {\n\t\t\tvaddr = scatterwalk_map(walk);\n\t\t\tmemcpy_dir(buf, vaddr, len_this_page, out);\n\t\t\tscatterwalk_unmap(vaddr);\n\t\t}\n\n\t\tscatterwalk_advance(walk, len_this_page);\n\n\t\tif (nbytes == len_this_page)\n\t\t\tbreak;\n\n\t\tbuf += len_this_page;\n\t\tnbytes -= len_this_page;\n\n\t\tscatterwalk_pagedone(walk, out & 1, 1);\n\t}\n}\nEXPORT_SYMBOL_GPL(scatterwalk_copychunks);\n\nvoid scatterwalk_map_and_copy(void *buf, struct scatterlist *sg,\n\t\t\t      unsigned int start, unsigned int nbytes, int out)\n{\n\tstruct scatter_walk walk;\n\tstruct scatterlist tmp[2];\n\n\tif (!nbytes)\n\t\treturn;\n\n\tsg = scatterwalk_ffwd(tmp, sg, start);\n\n\tscatterwalk_start(&walk, sg);\n\tscatterwalk_copychunks(buf, &walk, nbytes, out);\n\tscatterwalk_done(&walk, out, 0);\n}\nEXPORT_SYMBOL_GPL(scatterwalk_map_and_copy);\n\nstruct scatterlist *scatterwalk_ffwd(struct scatterlist dst[2],\n\t\t\t\t     struct scatterlist *src,\n\t\t\t\t     unsigned int len)\n{\n\tfor (;;) {\n\t\tif (!len)\n\t\t\treturn src;\n\n\t\tif (src->length > len)\n\t\t\tbreak;\n\n\t\tlen -= src->length;\n\t\tsrc = sg_next(src);\n\t}\n\n\tsg_init_table(dst, 2);\n\tsg_set_page(dst, sg_page(src), src->length - len, src->offset + len);\n\tscatterwalk_crypto_chain(dst, sg_next(src), 2);\n\n\treturn dst;\n}\nEXPORT_SYMBOL_GPL(scatterwalk_ffwd);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}