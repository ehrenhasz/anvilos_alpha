{
  "module_name": "ecdh_helper.c",
  "hash_id": "a614629fec3e11d7d10addce4a37b413e88cc6dd64892135de1133ad551d3a85",
  "original_prompt": "Ingested from linux-6.6.14/crypto/ecdh_helper.c",
  "human_readable_source": "\n \n#include <linux/kernel.h>\n#include <linux/export.h>\n#include <linux/err.h>\n#include <linux/string.h>\n#include <crypto/ecdh.h>\n#include <crypto/kpp.h>\n\n#define ECDH_KPP_SECRET_MIN_SIZE (sizeof(struct kpp_secret) + sizeof(short))\n\nstatic inline u8 *ecdh_pack_data(void *dst, const void *src, size_t sz)\n{\n\tmemcpy(dst, src, sz);\n\treturn dst + sz;\n}\n\nstatic inline const u8 *ecdh_unpack_data(void *dst, const void *src, size_t sz)\n{\n\tmemcpy(dst, src, sz);\n\treturn src + sz;\n}\n\nunsigned int crypto_ecdh_key_len(const struct ecdh *params)\n{\n\treturn ECDH_KPP_SECRET_MIN_SIZE + params->key_size;\n}\nEXPORT_SYMBOL_GPL(crypto_ecdh_key_len);\n\nint crypto_ecdh_encode_key(char *buf, unsigned int len,\n\t\t\t   const struct ecdh *params)\n{\n\tu8 *ptr = buf;\n\tstruct kpp_secret secret = {\n\t\t.type = CRYPTO_KPP_SECRET_TYPE_ECDH,\n\t\t.len = len\n\t};\n\n\tif (unlikely(!buf))\n\t\treturn -EINVAL;\n\n\tif (len != crypto_ecdh_key_len(params))\n\t\treturn -EINVAL;\n\n\tptr = ecdh_pack_data(ptr, &secret, sizeof(secret));\n\tptr = ecdh_pack_data(ptr, &params->key_size, sizeof(params->key_size));\n\tecdh_pack_data(ptr, params->key, params->key_size);\n\n\treturn 0;\n}\nEXPORT_SYMBOL_GPL(crypto_ecdh_encode_key);\n\nint crypto_ecdh_decode_key(const char *buf, unsigned int len,\n\t\t\t   struct ecdh *params)\n{\n\tconst u8 *ptr = buf;\n\tstruct kpp_secret secret;\n\n\tif (unlikely(!buf || len < ECDH_KPP_SECRET_MIN_SIZE))\n\t\treturn -EINVAL;\n\n\tptr = ecdh_unpack_data(&secret, ptr, sizeof(secret));\n\tif (secret.type != CRYPTO_KPP_SECRET_TYPE_ECDH)\n\t\treturn -EINVAL;\n\n\tif (unlikely(len < secret.len))\n\t\treturn -EINVAL;\n\n\tptr = ecdh_unpack_data(&params->key_size, ptr, sizeof(params->key_size));\n\tif (secret.len != crypto_ecdh_key_len(params))\n\t\treturn -EINVAL;\n\n\t \n\tparams->key = (void *)ptr;\n\n\treturn 0;\n}\nEXPORT_SYMBOL_GPL(crypto_ecdh_decode_key);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}