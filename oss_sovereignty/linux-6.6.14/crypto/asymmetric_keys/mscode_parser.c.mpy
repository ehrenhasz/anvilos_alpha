{
  "module_name": "mscode_parser.c",
  "hash_id": "f0cd61a6e21aa5d84e587c89360dc9891b07a314f6d011643b2fc08bca8aebd8",
  "original_prompt": "Ingested from linux-6.6.14/crypto/asymmetric_keys/mscode_parser.c",
  "human_readable_source": "\n \n\n#define pr_fmt(fmt) \"MSCODE: \"fmt\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/err.h>\n#include <linux/oid_registry.h>\n#include <crypto/pkcs7.h>\n#include \"verify_pefile.h\"\n#include \"mscode.asn1.h\"\n\n \nint mscode_parse(void *_ctx, const void *content_data, size_t data_len,\n\t\t size_t asn1hdrlen)\n{\n\tstruct pefile_context *ctx = _ctx;\n\n\tcontent_data -= asn1hdrlen;\n\tdata_len += asn1hdrlen;\n\tpr_devel(\"Data: %zu [%*ph]\\n\", data_len, (unsigned)(data_len),\n\t\t content_data);\n\n\treturn asn1_ber_decoder(&mscode_decoder, ctx, content_data, data_len);\n}\n\n \nint mscode_note_content_type(void *context, size_t hdrlen,\n\t\t\t     unsigned char tag,\n\t\t\t     const void *value, size_t vlen)\n{\n\tenum OID oid;\n\n\toid = look_up_OID(value, vlen);\n\tif (oid == OID__NR) {\n\t\tchar buffer[50];\n\n\t\tsprint_oid(value, vlen, buffer, sizeof(buffer));\n\t\tpr_err(\"Unknown OID: %s\\n\", buffer);\n\t\treturn -EBADMSG;\n\t}\n\n\t \n\tif (oid != OID_msPeImageDataObjId &&\n\t    oid != OID_msIndividualSPKeyPurpose) {\n\t\tpr_err(\"Unexpected content type OID %u\\n\", oid);\n\t\treturn -EBADMSG;\n\t}\n\n\treturn 0;\n}\n\n \nint mscode_note_digest_algo(void *context, size_t hdrlen,\n\t\t\t    unsigned char tag,\n\t\t\t    const void *value, size_t vlen)\n{\n\tstruct pefile_context *ctx = context;\n\tchar buffer[50];\n\tenum OID oid;\n\n\toid = look_up_OID(value, vlen);\n\tswitch (oid) {\n\tcase OID_md4:\n\t\tctx->digest_algo = \"md4\";\n\t\tbreak;\n\tcase OID_md5:\n\t\tctx->digest_algo = \"md5\";\n\t\tbreak;\n\tcase OID_sha1:\n\t\tctx->digest_algo = \"sha1\";\n\t\tbreak;\n\tcase OID_sha256:\n\t\tctx->digest_algo = \"sha256\";\n\t\tbreak;\n\tcase OID_sha384:\n\t\tctx->digest_algo = \"sha384\";\n\t\tbreak;\n\tcase OID_sha512:\n\t\tctx->digest_algo = \"sha512\";\n\t\tbreak;\n\tcase OID_sha224:\n\t\tctx->digest_algo = \"sha224\";\n\t\tbreak;\n\n\tcase OID__NR:\n\t\tsprint_oid(value, vlen, buffer, sizeof(buffer));\n\t\tpr_err(\"Unknown OID: %s\\n\", buffer);\n\t\treturn -EBADMSG;\n\n\tdefault:\n\t\tpr_err(\"Unsupported content type: %u\\n\", oid);\n\t\treturn -ENOPKG;\n\t}\n\n\treturn 0;\n}\n\n \nint mscode_note_digest(void *context, size_t hdrlen,\n\t\t       unsigned char tag,\n\t\t       const void *value, size_t vlen)\n{\n\tstruct pefile_context *ctx = context;\n\n\tctx->digest = kmemdup(value, vlen, GFP_KERNEL);\n\tif (!ctx->digest)\n\t\treturn -ENOMEM;\n\n\tctx->digest_len = vlen;\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}