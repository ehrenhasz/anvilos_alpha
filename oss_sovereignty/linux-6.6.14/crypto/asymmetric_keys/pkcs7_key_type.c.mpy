{
  "module_name": "pkcs7_key_type.c",
  "hash_id": "c414ce2191579f060755d0b761e3dec2e2f64b0269a530c1bdc71f4e1e0e6293",
  "original_prompt": "Ingested from linux-6.6.14/crypto/asymmetric_keys/pkcs7_key_type.c",
  "human_readable_source": "\n \n\n#define pr_fmt(fmt) \"PKCS7key: \"fmt\n#include <linux/key.h>\n#include <linux/err.h>\n#include <linux/module.h>\n#include <linux/verification.h>\n#include <linux/key-type.h>\n#include <keys/user-type.h>\n\nMODULE_LICENSE(\"GPL\");\nMODULE_DESCRIPTION(\"PKCS#7 testing key type\");\nMODULE_AUTHOR(\"Red Hat, Inc.\");\n\nstatic unsigned pkcs7_usage;\nmodule_param_named(usage, pkcs7_usage, uint, S_IWUSR | S_IRUGO);\nMODULE_PARM_DESC(pkcs7_usage,\n\t\t \"Usage to specify when verifying the PKCS#7 message\");\n\n \nstatic int pkcs7_view_content(void *ctx, const void *data, size_t len,\n\t\t\t      size_t asn1hdrlen)\n{\n\tstruct key_preparsed_payload *prep = ctx;\n\tconst void *saved_prep_data;\n\tsize_t saved_prep_datalen;\n\tint ret;\n\n\tsaved_prep_data = prep->data;\n\tsaved_prep_datalen = prep->datalen;\n\tprep->data = data;\n\tprep->datalen = len;\n\n\tret = user_preparse(prep);\n\n\tprep->data = saved_prep_data;\n\tprep->datalen = saved_prep_datalen;\n\treturn ret;\n}\n\n \nstatic int pkcs7_preparse(struct key_preparsed_payload *prep)\n{\n\tenum key_being_used_for usage = pkcs7_usage;\n\n\tif (usage >= NR__KEY_BEING_USED_FOR) {\n\t\tpr_err(\"Invalid usage type %d\\n\", usage);\n\t\treturn -EINVAL;\n\t}\n\n\treturn verify_pkcs7_signature(NULL, 0,\n\t\t\t\t      prep->data, prep->datalen,\n\t\t\t\t      VERIFY_USE_SECONDARY_KEYRING, usage,\n\t\t\t\t      pkcs7_view_content, prep);\n}\n\n \nstatic struct key_type key_type_pkcs7 = {\n\t.name\t\t\t= \"pkcs7_test\",\n\t.preparse\t\t= pkcs7_preparse,\n\t.free_preparse\t\t= user_free_preparse,\n\t.instantiate\t\t= generic_key_instantiate,\n\t.revoke\t\t\t= user_revoke,\n\t.destroy\t\t= user_destroy,\n\t.describe\t\t= user_describe,\n\t.read\t\t\t= user_read,\n};\n\n \nstatic int __init pkcs7_key_init(void)\n{\n\treturn register_key_type(&key_type_pkcs7);\n}\n\nstatic void __exit pkcs7_key_cleanup(void)\n{\n\tunregister_key_type(&key_type_pkcs7);\n}\n\nmodule_init(pkcs7_key_init);\nmodule_exit(pkcs7_key_cleanup);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}