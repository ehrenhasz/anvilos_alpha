{
  "module_name": "async_memcpy.c",
  "hash_id": "c00de7c6cc0c3a0a70876105723b43a7f61f066234d495a4304e1d1c8937fdb7",
  "original_prompt": "Ingested from linux-6.6.14/crypto/async_tx/async_memcpy.c",
  "human_readable_source": "\n \n#include <linux/kernel.h>\n#include <linux/highmem.h>\n#include <linux/module.h>\n#include <linux/mm.h>\n#include <linux/dma-mapping.h>\n#include <linux/async_tx.h>\n\n \nstruct dma_async_tx_descriptor *\nasync_memcpy(struct page *dest, struct page *src, unsigned int dest_offset,\n\t     unsigned int src_offset, size_t len,\n\t     struct async_submit_ctl *submit)\n{\n\tstruct dma_chan *chan = async_tx_find_channel(submit, DMA_MEMCPY,\n\t\t\t\t\t\t      &dest, 1, &src, 1, len);\n\tstruct dma_device *device = chan ? chan->device : NULL;\n\tstruct dma_async_tx_descriptor *tx = NULL;\n\tstruct dmaengine_unmap_data *unmap = NULL;\n\n\tif (device)\n\t\tunmap = dmaengine_get_unmap_data(device->dev, 2, GFP_NOWAIT);\n\n\tif (unmap && is_dma_copy_aligned(device, src_offset, dest_offset, len)) {\n\t\tunsigned long dma_prep_flags = 0;\n\n\t\tif (submit->cb_fn)\n\t\t\tdma_prep_flags |= DMA_PREP_INTERRUPT;\n\t\tif (submit->flags & ASYNC_TX_FENCE)\n\t\t\tdma_prep_flags |= DMA_PREP_FENCE;\n\n\t\tunmap->to_cnt = 1;\n\t\tunmap->addr[0] = dma_map_page(device->dev, src, src_offset, len,\n\t\t\t\t\t      DMA_TO_DEVICE);\n\t\tunmap->from_cnt = 1;\n\t\tunmap->addr[1] = dma_map_page(device->dev, dest, dest_offset, len,\n\t\t\t\t\t      DMA_FROM_DEVICE);\n\t\tunmap->len = len;\n\n\t\ttx = device->device_prep_dma_memcpy(chan, unmap->addr[1],\n\t\t\t\t\t\t    unmap->addr[0], len,\n\t\t\t\t\t\t    dma_prep_flags);\n\t}\n\n\tif (tx) {\n\t\tpr_debug(\"%s: (async) len: %zu\\n\", __func__, len);\n\n\t\tdma_set_unmap(tx, unmap);\n\t\tasync_tx_submit(chan, tx, submit);\n\t} else {\n\t\tvoid *dest_buf, *src_buf;\n\t\tpr_debug(\"%s: (sync) len: %zu\\n\", __func__, len);\n\n\t\t \n\t\tasync_tx_quiesce(&submit->depend_tx);\n\n\t\tdest_buf = kmap_atomic(dest) + dest_offset;\n\t\tsrc_buf = kmap_atomic(src) + src_offset;\n\n\t\tmemcpy(dest_buf, src_buf, len);\n\n\t\tkunmap_atomic(src_buf);\n\t\tkunmap_atomic(dest_buf);\n\n\t\tasync_tx_sync_epilog(submit);\n\t}\n\n\tdmaengine_unmap_put(unmap);\n\n\treturn tx;\n}\nEXPORT_SYMBOL_GPL(async_memcpy);\n\nMODULE_AUTHOR(\"Intel Corporation\");\nMODULE_DESCRIPTION(\"asynchronous memcpy api\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}