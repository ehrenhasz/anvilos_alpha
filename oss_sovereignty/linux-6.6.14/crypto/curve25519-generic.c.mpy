{
  "module_name": "curve25519-generic.c",
  "hash_id": "c86a615527d684cf5c9cfdee3ae82cd20bd85489960b3c90293a399930058a2e",
  "original_prompt": "Ingested from linux-6.6.14/crypto/curve25519-generic.c",
  "human_readable_source": "\n\n#include <crypto/curve25519.h>\n#include <crypto/internal/kpp.h>\n#include <crypto/kpp.h>\n#include <linux/module.h>\n#include <linux/scatterlist.h>\n\nstatic int curve25519_set_secret(struct crypto_kpp *tfm, const void *buf,\n\t\t\t\t unsigned int len)\n{\n\tu8 *secret = kpp_tfm_ctx(tfm);\n\n\tif (!len)\n\t\tcurve25519_generate_secret(secret);\n\telse if (len == CURVE25519_KEY_SIZE &&\n\t\t crypto_memneq(buf, curve25519_null_point, CURVE25519_KEY_SIZE))\n\t\tmemcpy(secret, buf, CURVE25519_KEY_SIZE);\n\telse\n\t\treturn -EINVAL;\n\treturn 0;\n}\n\nstatic int curve25519_compute_value(struct kpp_request *req)\n{\n\tstruct crypto_kpp *tfm = crypto_kpp_reqtfm(req);\n\tconst u8 *secret = kpp_tfm_ctx(tfm);\n\tu8 public_key[CURVE25519_KEY_SIZE];\n\tu8 buf[CURVE25519_KEY_SIZE];\n\tint copied, nbytes;\n\tu8 const *bp;\n\n\tif (req->src) {\n\t\tcopied = sg_copy_to_buffer(req->src,\n\t\t\t\t\t   sg_nents_for_len(req->src,\n\t\t\t\t\t\t\t    CURVE25519_KEY_SIZE),\n\t\t\t\t\t   public_key, CURVE25519_KEY_SIZE);\n\t\tif (copied != CURVE25519_KEY_SIZE)\n\t\t\treturn -EINVAL;\n\t\tbp = public_key;\n\t} else {\n\t\tbp = curve25519_base_point;\n\t}\n\n\tcurve25519_generic(buf, secret, bp);\n\n\t \n\tnbytes = min_t(size_t, CURVE25519_KEY_SIZE, req->dst_len);\n\tcopied = sg_copy_from_buffer(req->dst, sg_nents_for_len(req->dst,\n\t\t\t\t\t\t\t\tnbytes),\n\t\t\t\t     buf, nbytes);\n\tif (copied != nbytes)\n\t\treturn -EINVAL;\n\treturn 0;\n}\n\nstatic unsigned int curve25519_max_size(struct crypto_kpp *tfm)\n{\n\treturn CURVE25519_KEY_SIZE;\n}\n\nstatic struct kpp_alg curve25519_alg = {\n\t.base.cra_name\t\t= \"curve25519\",\n\t.base.cra_driver_name\t= \"curve25519-generic\",\n\t.base.cra_priority\t= 100,\n\t.base.cra_module\t= THIS_MODULE,\n\t.base.cra_ctxsize\t= CURVE25519_KEY_SIZE,\n\n\t.set_secret\t\t= curve25519_set_secret,\n\t.generate_public_key\t= curve25519_compute_value,\n\t.compute_shared_secret\t= curve25519_compute_value,\n\t.max_size\t\t= curve25519_max_size,\n};\n\nstatic int __init curve25519_init(void)\n{\n\treturn crypto_register_kpp(&curve25519_alg);\n}\n\nstatic void __exit curve25519_exit(void)\n{\n\tcrypto_unregister_kpp(&curve25519_alg);\n}\n\nsubsys_initcall(curve25519_init);\nmodule_exit(curve25519_exit);\n\nMODULE_ALIAS_CRYPTO(\"curve25519\");\nMODULE_ALIAS_CRYPTO(\"curve25519-generic\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}