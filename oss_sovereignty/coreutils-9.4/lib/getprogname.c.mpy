{
  "module_name": "getprogname.c",
  "hash_id": "0274111b006e1e5585878f1665cd2cc8cc5c33706d93c2dfa5d1a1cb712827fe",
  "original_prompt": "Ingested from coreutils-9.4/lib/getprogname.c",
  "human_readable_source": " \n#include <stdlib.h>\n\n#include <errno.h>  \n\n#ifdef _AIX\n# include <unistd.h>\n# include <procinfo.h>\n# include <string.h>\n#endif\n\n#ifdef __MVS__\n# ifndef _OPEN_SYS\n#  define _OPEN_SYS\n# endif\n# include <string.h>\n# include <sys/ps.h>\n#endif\n\n#ifdef __hpux\n# include <unistd.h>\n# include <sys/param.h>\n# include <sys/pstat.h>\n# include <string.h>\n#endif\n\n#if defined __sgi || defined __osf__\n# include <string.h>\n# include <unistd.h>\n# include <stdio.h>\n# include <fcntl.h>\n# include <sys/procfs.h>\n#endif\n\n#if defined __SCO_VERSION__ || defined __sysv5__\n# include <fcntl.h>\n# include <string.h>\n#endif\n\n#include \"basename-lgpl.h\"\n\n#ifndef HAVE_GETPROGNAME   \nchar const *\ngetprogname (void)\n{\n# if HAVE_DECL_PROGRAM_INVOCATION_SHORT_NAME                 \n   \n   \n   \n   \n   \n  extern char *__progname;\n  const char *p = __progname;\n#  if defined __ANDROID__\n  return last_component (p);\n#  else\n  return p && p[0] ? p : \"?\";\n#  endif\n# elif _AIX                                                  \n   \n  static char *p;\n  static int first = 1;\n  if (first)\n    {\n      first = 0;\n      pid_t pid = getpid ();\n      struct procentry64 procs;\n      p = (0 < getprocs64 (&procs, sizeof procs, NULL, 0, &pid, 1)\n           ? strdup (procs.pi_comm)\n           : NULL);\n      if (!p)\n        p = \"?\";\n    }\n  return p;\n# elif defined __hpux\n  static char *p;\n  static int first = 1;\n  if (first)\n    {\n      first = 0;\n      pid_t pid = getpid ();\n      struct pst_status status;\n      if (pstat_getproc (&status, sizeof status, 0, pid) > 0)\n        {\n          char *ucomm = status.pst_ucomm;\n          char *cmd = status.pst_cmd;\n          if (strlen (ucomm) < PST_UCOMMLEN - 1)\n            p = ucomm;\n          else\n            {\n               \n              char *space = strchr (cmd, ' ');\n              if (space != NULL)\n                *space = '\\0';\n              p = strrchr (cmd, '/');\n              if (p != NULL)\n                p++;\n              else\n                p = cmd;\n              if (strlen (p) > PST_UCOMMLEN - 1\n                  && memcmp (p, ucomm, PST_UCOMMLEN - 1) == 0)\n                 \n                ;\n              else\n                p = ucomm;\n            }\n          p = strdup (p);\n        }\n      else\n        {\n#  if !defined __LP64__\n           \n          char status64[1216];\n          if (__pstat_getproc64 (status64, sizeof status64, 0, pid) > 0)\n            {\n              char *ucomm = status64 + 288;\n              char *cmd = status64 + 168;\n              if (strlen (ucomm) < PST_UCOMMLEN - 1)\n                p = ucomm;\n              else\n                {\n                   \n                  char *space = strchr (cmd, ' ');\n                  if (space != NULL)\n                    *space = '\\0';\n                  p = strrchr (cmd, '/');\n                  if (p != NULL)\n                    p++;\n                  else\n                    p = cmd;\n                  if (strlen (p) > PST_UCOMMLEN - 1\n                      && memcmp (p, ucomm, PST_UCOMMLEN - 1) == 0)\n                     \n                    ;\n                  else\n                    p = ucomm;\n                }\n              p = strdup (p);\n            }\n          else\n#  endif\n            p = NULL;\n        }\n      if (!p)\n        p = \"?\";\n    }\n  return p;\n# elif __MVS__                                               \n   \n  char filename[50];\n  int fd;\n\n  # if defined __sgi\n    sprintf (filename, \"/proc/pinfo/%d\", (int) getpid ());\n  # else\n    sprintf (filename, \"/proc/%d\", (int) getpid ());\n  # endif\n  fd = open (filename, O_RDONLY | O_CLOEXEC);\n  if (0 <= fd)\n    {\n      prpsinfo_t buf;\n      int ioctl_ok = 0 <= ioctl (fd, PIOCPSINFO, &buf);\n      close (fd);\n      if (ioctl_ok)\n        {\n          char *name = buf.pr_fname;\n          size_t namesize = sizeof buf.pr_fname;\n           \n          char *namenul = memchr (name, '\\0', namesize);\n          size_t namelen = namenul ? namenul - name : namesize;\n          char *namecopy = malloc (namelen + 1);\n          if (namecopy)\n            {\n              namecopy[namelen] = '\\0';\n              return memcpy (namecopy, name, namelen);\n            }\n        }\n    }\n  return NULL;\n# elif defined __SCO_VERSION__ || defined __sysv5__                 \n  char buf[80];\n  int fd;\n  sprintf (buf, \"/proc/%d/cmdline\", getpid());\n  fd = open (buf, O_RDONLY);\n  if (0 <= fd)\n    {\n      size_t n = read (fd, buf, 79);\n      if (n > 0)\n        {\n          buf[n] = '\\0';  \n          char *progname;\n          progname = strrchr (buf, '/');\n          if (progname)\n            {\n              progname = progname + 1;  \n            }\n          else\n            {\n              progname = buf;\n            }\n          char *ret;\n          ret = malloc (strlen (progname) + 1);\n          if (ret)\n            {\n              strcpy (ret, progname);\n              return ret;\n            }\n        }\n      close (fd);\n    }\n  return \"?\";\n# else\n#  error \"getprogname module not ported to this OS\"\n# endif\n}\n\n#endif\n\n \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}