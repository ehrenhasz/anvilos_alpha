{
  "module_name": "priv-set.c",
  "hash_id": "a24941c0ae242e8a81d4f259d4216d6ebfff22410810c65b83dfc09ca3159e6b",
  "original_prompt": "Ingested from coreutils-9.4/lib/priv-set.c",
  "human_readable_source": " \n\n#include <config.h>\n\n#define PRIV_SET_INLINE _GL_EXTERN_INLINE\n\n#include \"priv-set.h\"\n\n#if HAVE_GETPPRIV && HAVE_PRIV_H\n\n# include <errno.h>\n# include <priv.h>\n\n \nstatic priv_set_t *eff_set;\n\n \nstatic priv_set_t *rem_set;\n\nstatic bool initialized;\n\nstatic int\npriv_set_initialize (void)\n{\n  if (! initialized)\n    {\n      eff_set = priv_allocset ();\n      if (!eff_set)\n        {\n          return -1;\n        }\n      rem_set = priv_allocset ();\n      if (!rem_set)\n        {\n          priv_freeset (eff_set);\n          return -1;\n        }\n      if (getppriv (PRIV_EFFECTIVE, eff_set) != 0)\n        {\n          priv_freeset (eff_set);\n          priv_freeset (rem_set);\n          return -1;\n        }\n      priv_emptyset (rem_set);\n      initialized = true;\n    }\n\n  return 0;\n}\n\n\n \nint\npriv_set_ismember (const char *priv)\n{\n  if (! initialized && priv_set_initialize () != 0)\n    return -1;\n\n  return priv_ismember (eff_set, priv);\n}\n\n\n \nint\npriv_set_remove (const char *priv)\n{\n  if (! initialized && priv_set_initialize () != 0)\n    return -1;\n\n  if (priv_ismember (eff_set, priv))\n    {\n       \n      priv_delset (eff_set, priv);\n      if (setppriv (PRIV_SET, PRIV_EFFECTIVE, eff_set) != 0)\n        {\n          priv_addset (eff_set, priv);\n          return -1;\n        }\n      priv_addset (rem_set, priv);\n    }\n  else\n    {\n      errno = EINVAL;\n      return -1;\n    }\n\n  return 0;\n}\n\n\n \nint\npriv_set_restore (const char *priv)\n{\n  if (! initialized && priv_set_initialize () != 0)\n    return -1;\n\n  if (priv_ismember (rem_set, priv))\n    {\n       \n      priv_addset (eff_set, priv);\n      if (setppriv (PRIV_SET, PRIV_EFFECTIVE, eff_set) != 0)\n        {\n          priv_delset (eff_set, priv);\n          return -1;\n        }\n      priv_delset (rem_set, priv);\n    }\n  else\n    {\n      errno = EINVAL;\n      return -1;\n    }\n\n  return 0;\n}\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}