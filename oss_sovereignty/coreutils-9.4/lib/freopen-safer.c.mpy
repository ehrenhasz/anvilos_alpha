{
  "module_name": "freopen-safer.c",
  "hash_id": "5696ce23341473c13de7aff9e5d6395fed133e63c130c1f14a497cd37725b5f8",
  "original_prompt": "Ingested from coreutils-9.4/lib/freopen-safer.c",
  "human_readable_source": " \n\n#include <config.h>\n\n#include \"stdio-safer.h\"\n\n#include \"attribute.h\"\n\n#include <errno.h>\n#include <fcntl.h>\n#include <unistd.h>\n\n \n#if 13 <= __GNUC__\n# pragma GCC diagnostic ignored \"-Wanalyzer-fd-leak\"\n#endif\n\n \nstatic bool\nprotect_fd (int fd)\n{\n  int value = open (\"/dev/null\", O_RDONLY);\n  if (value != fd)\n    {\n      if (0 <= value)\n        {\n          close (value);\n          errno = EBADF;  \n        }\n      return false;\n    }\n  return true;\n}\n\n \n\nFILE *\nfreopen_safer (char const *name, char const *mode, FILE *f)\n{\n   \n  bool protect_in = false;\n  bool protect_out = false;\n  bool protect_err = false;\n  int saved_errno;\n\n  switch (fileno (f))\n    {\n    default:  \n      if (dup2 (STDERR_FILENO, STDERR_FILENO) != STDERR_FILENO)\n        protect_err = true;\n      FALLTHROUGH;\n    case STDERR_FILENO:\n      if (dup2 (STDOUT_FILENO, STDOUT_FILENO) != STDOUT_FILENO)\n        protect_out = true;\n      FALLTHROUGH;\n    case STDOUT_FILENO:\n      if (dup2 (STDIN_FILENO, STDIN_FILENO) != STDIN_FILENO)\n        protect_in = true;\n      FALLTHROUGH;\n    case STDIN_FILENO:\n       \n      break;\n    }\n  if (protect_in && !protect_fd (STDIN_FILENO))\n    f = NULL;\n  else if (protect_out && !protect_fd (STDOUT_FILENO))\n    f = NULL;\n  else if (protect_err && !protect_fd (STDERR_FILENO))\n    f = NULL;\n  else\n    f = freopen (name, mode, f);\n  saved_errno = errno;\n  if (protect_err)\n    close (STDERR_FILENO);\n  if (protect_out)\n    close (STDOUT_FILENO);\n  if (protect_in)\n    close (STDIN_FILENO);\n  if (!f)\n    errno = saved_errno;\n  return f;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}