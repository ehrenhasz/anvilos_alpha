{
  "module_name": "msvc-inval.c",
  "hash_id": "83f39c2bb2ee7daa7227310e00b34032fcb22ed6176f1eedb6d5c2526558d98c",
  "original_prompt": "Ingested from coreutils-9.4/lib/msvc-inval.c",
  "human_readable_source": " \n#include \"msvc-inval.h\"\n\n#if HAVE_MSVC_INVALID_PARAMETER_HANDLER \\\n    && !(MSVC_INVALID_PARAMETER_HANDLING == SANE_LIBRARY_HANDLING)\n\n \n# include <stdlib.h>\n\n# if MSVC_INVALID_PARAMETER_HANDLING == DEFAULT_HANDLING\n\nstatic void __cdecl\ngl_msvc_invalid_parameter_handler (const wchar_t *expression,\n                                   const wchar_t *function,\n                                   const wchar_t *file,\n                                   unsigned int line,\n                                   uintptr_t dummy)\n{\n}\n\n# else\n\n \n#  define WIN32_LEAN_AND_MEAN\n#  include <windows.h>\n\n#  if defined _MSC_VER\n\nstatic void __cdecl\ngl_msvc_invalid_parameter_handler (const wchar_t *expression,\n                                   const wchar_t *function,\n                                   const wchar_t *file,\n                                   unsigned int line,\n                                   uintptr_t dummy)\n{\n  RaiseException (STATUS_GNULIB_INVALID_PARAMETER, 0, 0, NULL);\n}\n\n#  else\n\n \nstatic DWORD tls_index;\nstatic int tls_initialized  ;\n\n \nstatic struct gl_msvc_inval_per_thread not_per_thread;\n\nstruct gl_msvc_inval_per_thread *\ngl_msvc_inval_current (void)\n{\n  if (!tls_initialized)\n    {\n      tls_index = TlsAlloc ();\n      tls_initialized = 1;\n    }\n  if (tls_index == TLS_OUT_OF_INDEXES)\n     \n    return &not_per_thread;\n  else\n    {\n      struct gl_msvc_inval_per_thread *pointer =\n        (struct gl_msvc_inval_per_thread *) TlsGetValue (tls_index);\n      if (pointer == NULL)\n        {\n           \n          pointer =\n            (struct gl_msvc_inval_per_thread *)\n            malloc (sizeof (struct gl_msvc_inval_per_thread));\n          if (pointer == NULL)\n             \n            pointer = &not_per_thread;\n          TlsSetValue (tls_index, pointer);\n        }\n      return pointer;\n    }\n}\n\nstatic void __cdecl\ngl_msvc_invalid_parameter_handler (const wchar_t *expression,\n                                   const wchar_t *function,\n                                   const wchar_t *file,\n                                   unsigned int line,\n                                   uintptr_t dummy)\n{\n  struct gl_msvc_inval_per_thread *current = gl_msvc_inval_current ();\n  if (current->restart_valid)\n    longjmp (current->restart, 1);\n  else\n     \n    RaiseException (STATUS_GNULIB_INVALID_PARAMETER, 0, 0, NULL);\n}\n\n#  endif\n\n# endif\n\nstatic int gl_msvc_inval_initialized  ;\n\nvoid\ngl_msvc_inval_ensure_handler (void)\n{\n  if (gl_msvc_inval_initialized == 0)\n    {\n      _set_invalid_parameter_handler (gl_msvc_invalid_parameter_handler);\n      gl_msvc_inval_initialized = 1;\n    }\n}\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}