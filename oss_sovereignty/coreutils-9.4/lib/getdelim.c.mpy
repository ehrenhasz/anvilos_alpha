{
  "module_name": "getdelim.c",
  "hash_id": "a2c9d41a94ea149b34bbca72c51dab2c1e7655dbd2378e029c71a854bedf4346",
  "original_prompt": "Ingested from coreutils-9.4/lib/getdelim.c",
  "human_readable_source": " \n\n \n#define _GL_ARG_NONNULL(params)\n\n#include <config.h>\n\n#include <stdio.h>\n\n#include <limits.h>\n#include <stdint.h>\n#include <stdlib.h>\n#include <errno.h>\n\n#if USE_UNLOCKED_IO\n# include \"unlocked-io.h\"\n# define getc_maybe_unlocked(fp)        getc(fp)\n#elif !HAVE_FLOCKFILE || !HAVE_FUNLOCKFILE || !HAVE_DECL_GETC_UNLOCKED\n# undef flockfile\n# undef funlockfile\n# define flockfile(x) ((void) 0)\n# define funlockfile(x) ((void) 0)\n# define getc_maybe_unlocked(fp)        getc(fp)\n#else\n# define getc_maybe_unlocked(fp)        getc_unlocked(fp)\n#endif\n\nstatic void\nalloc_failed (void)\n{\n#if defined _WIN32 && ! defined __CYGWIN__\n   \n  errno = ENOMEM;\n#endif\n}\n\n \n\nssize_t\ngetdelim (char **lineptr, size_t *n, int delimiter, FILE *fp)\n{\n  ssize_t result;\n  size_t cur_len = 0;\n\n  if (lineptr == NULL || n == NULL || fp == NULL)\n    {\n      errno = EINVAL;\n      return -1;\n    }\n\n  flockfile (fp);\n\n  if (*lineptr == NULL || *n == 0)\n    {\n      char *new_lineptr;\n      *n = 120;\n      new_lineptr = (char *) realloc (*lineptr, *n);\n      if (new_lineptr == NULL)\n        {\n          alloc_failed ();\n          result = -1;\n          goto unlock_return;\n        }\n      *lineptr = new_lineptr;\n    }\n\n  for (;;)\n    {\n      int i;\n\n      i = getc_maybe_unlocked (fp);\n      if (i == EOF)\n        {\n          result = -1;\n          break;\n        }\n\n       \n      if (cur_len + 1 >= *n)\n        {\n          size_t needed_max =\n            SSIZE_MAX < SIZE_MAX ? (size_t) SSIZE_MAX + 1 : SIZE_MAX;\n          size_t needed = 2 * *n + 1;    \n          char *new_lineptr;\n\n          if (needed_max < needed)\n            needed = needed_max;\n          if (cur_len + 1 >= needed)\n            {\n              result = -1;\n              errno = EOVERFLOW;\n              goto unlock_return;\n            }\n\n          new_lineptr = (char *) realloc (*lineptr, needed);\n          if (new_lineptr == NULL)\n            {\n              alloc_failed ();\n              result = -1;\n              goto unlock_return;\n            }\n\n          *lineptr = new_lineptr;\n          *n = needed;\n        }\n\n      (*lineptr)[cur_len] = i;\n      cur_len++;\n\n      if (i == delimiter)\n        break;\n    }\n  (*lineptr)[cur_len] = '\\0';\n  result = cur_len ? cur_len : result;\n\n unlock_return:\n  funlockfile (fp);  \n\n  return result;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}