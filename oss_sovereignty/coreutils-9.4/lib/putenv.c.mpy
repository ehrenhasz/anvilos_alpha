{
  "module_name": "putenv.c",
  "hash_id": "4c761073cc44e87410954da9a6db494eeb8c1efbeed3865581f5a2e1b351699a",
  "original_prompt": "Ingested from coreutils-9.4/lib/putenv.c",
  "human_readable_source": " \n#include <stdlib.h>\n\n#include <stddef.h>\n\n \n#include <errno.h>\n#ifndef __set_errno\n# define __set_errno(ev) ((errno) = (ev))\n#endif\n\n#include <string.h>\n#include <unistd.h>\n\n#if defined _WIN32 && ! defined __CYGWIN__\n# define WIN32_LEAN_AND_MEAN\n# include <windows.h>\n#endif\n\n#if _LIBC\n# if HAVE_GNU_LD\n#  define environ __environ\n# else\nextern char **environ;\n# endif\n#endif\n\n#if _LIBC\n \n# include <bits/libc-lock.h>\n__libc_lock_define_initialized (static, envlock)\n# define LOCK   __libc_lock_lock (envlock)\n# define UNLOCK __libc_lock_unlock (envlock)\n#else\n# define LOCK\n# define UNLOCK\n#endif\n\n#if defined _WIN32 && ! defined __CYGWIN__\n \n# undef SetEnvironmentVariable\n# define SetEnvironmentVariable SetEnvironmentVariableA\n#endif\n\nstatic int\n_unsetenv (const char *name)\n{\n  size_t len;\n#if !HAVE_DECL__PUTENV\n  char **ep;\n#endif\n\n  if (name == NULL || *name == '\\0' || strchr (name, '=') != NULL)\n    {\n      __set_errno (EINVAL);\n      return -1;\n    }\n\n  len = strlen (name);\n\n#if HAVE_DECL__PUTENV\n  {\n    int putenv_result;\n    char *name_ = malloc (len + 2);\n    memcpy (name_, name, len);\n    name_[len] = '=';\n    name_[len + 1] = 0;\n    putenv_result = _putenv (name_);\n    free (name_);\n    return putenv_result;\n  }\n#else\n\n  LOCK;\n\n  ep = environ;\n  while (*ep != NULL)\n    if (!strncmp (*ep, name, len) && (*ep)[len] == '=')\n      {\n         \n        char **dp = ep;\n\n        do\n          dp[0] = dp[1];\n        while (*dp++);\n         \n      }\n    else\n      ++ep;\n\n  UNLOCK;\n\n  return 0;\n#endif\n}\n\n\n \nint\nputenv (char *string)\n{\n  const char *name_end = strchr (string, '=');\n  char **ep;\n\n  if (name_end == NULL)\n    {\n       \n      return _unsetenv (string);\n    }\n\n#if HAVE_DECL__PUTENV\n   \n  if (name_end[1])\n    return _putenv (string);\n  else\n    {\n       \n      int putenv_result;\n      char *name_x = malloc (name_end - string + sizeof \"= \");\n      if (!name_x)\n        return -1;\n      memcpy (name_x, string, name_end - string + 1);\n      name_x[name_end - string + 1] = ' ';\n      name_x[name_end - string + 2] = 0;\n      putenv_result = _putenv (name_x);\n      for (ep = environ; *ep; ep++)\n        if (strcmp (*ep, name_x) == 0)\n          {\n            *ep = string;\n            break;\n          }\n# if defined _WIN32 && ! defined __CYGWIN__\n      if (putenv_result == 0)\n        {\n           \n          name_x[name_end - string] = 0;\n          putenv_result = SetEnvironmentVariable (name_x, \"\") ? 0 : -1;\n          errno = ENOMEM;  \n        }\n# endif\n      free (name_x);\n      return putenv_result;\n    }\n#else\n  for (ep = environ; *ep; ep++)\n    if (strncmp (*ep, string, name_end - string) == 0\n        && (*ep)[name_end - string] == '=')\n      break;\n\n  if (*ep)\n    *ep = string;\n  else\n    {\n      static char **last_environ = NULL;\n      size_t size = ep - environ;\n      char **new_environ = malloc ((size + 2) * sizeof *new_environ);\n      if (! new_environ)\n        return -1;\n      new_environ[0] = string;\n      memcpy (new_environ + 1, environ, (size + 1) * sizeof *new_environ);\n      free (last_environ);\n      last_environ = new_environ;\n      environ = new_environ;\n    }\n\n  return 0;\n#endif\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}