{
  "module_name": "tls.h",
  "hash_id": "8b386897635c2ba7d41152098a96761e697c041371fed1e66e340bda22d2972c",
  "original_prompt": "Ingested from coreutils-9.4/lib/glthread/tls.h",
  "human_readable_source": " \n\n \n\n\n#ifndef _TLS_H\n#define _TLS_H\n\n \n#if !_GL_CONFIG_H_INCLUDED\n #error \"Please include config.h first.\"\n#endif\n\n#include <errno.h>\n#include <stdlib.h>\n\n#if !defined c11_threads_in_use\n# if HAVE_THREADS_H && USE_POSIX_THREADS_FROM_LIBC\n#  define c11_threads_in_use() 1\n# elif HAVE_THREADS_H && USE_POSIX_THREADS_WEAK\n#  include <threads.h>\n#  pragma weak thrd_exit\n#  define c11_threads_in_use() (thrd_exit != NULL)\n# else\n#  define c11_threads_in_use() 0\n# endif\n#endif\n\n \n\n#if USE_ISOC_THREADS || USE_ISOC_AND_POSIX_THREADS\n\n \n\n# include <threads.h>\n\n \n\ntypedef tss_t gl_tls_key_t;\n# define glthread_tls_key_init(KEY, DESTRUCTOR) \\\n    (tss_create (KEY, DESTRUCTOR) != thrd_success ? EAGAIN : 0)\n# define gl_tls_get(NAME) \\\n    tss_get (NAME)\n# define glthread_tls_set(KEY, POINTER) \\\n    (tss_set (*(KEY), (POINTER)) != thrd_success ? ENOMEM : 0)\n# define glthread_tls_key_destroy(KEY) \\\n    (tss_delete (*(KEY)), 0)\n\n#endif\n\n \n\n#if USE_POSIX_THREADS\n\n \n\n# include <pthread.h>\n\n# if PTHREAD_IN_USE_DETECTION_HARD\n\n \n#  define pthread_in_use() \\\n     glthread_in_use ()\nextern int glthread_in_use (void);\n\n# endif\n\n# if USE_POSIX_THREADS_WEAK\n\n \n\n#  pragma weak pthread_key_create\n#  pragma weak pthread_getspecific\n#  pragma weak pthread_setspecific\n#  pragma weak pthread_key_delete\n#  ifndef pthread_self\n#   pragma weak pthread_self\n#  endif\n\n#  if !PTHREAD_IN_USE_DETECTION_HARD\n#   pragma weak pthread_mutexattr_gettype\n#   define pthread_in_use() \\\n      (pthread_mutexattr_gettype != NULL || c11_threads_in_use ())\n#  endif\n\n# else\n\n#  if !PTHREAD_IN_USE_DETECTION_HARD\n#   define pthread_in_use() 1\n#  endif\n\n# endif\n\n \n\ntypedef union\n        {\n          void *singlethread_value;\n          pthread_key_t key;\n        }\n        gl_tls_key_t;\n# define glthread_tls_key_init(KEY, DESTRUCTOR) \\\n    (pthread_in_use ()                              \\\n     ? pthread_key_create (&(KEY)->key, DESTRUCTOR) \\\n     : ((KEY)->singlethread_value = NULL, 0))\n# define gl_tls_get(NAME) \\\n    (pthread_in_use ()                  \\\n     ? pthread_getspecific ((NAME).key) \\\n     : (NAME).singlethread_value)\n# define glthread_tls_set(KEY, POINTER) \\\n    (pthread_in_use ()                             \\\n     ? pthread_setspecific ((KEY)->key, (POINTER)) \\\n     : ((KEY)->singlethread_value = (POINTER), 0))\n# define glthread_tls_key_destroy(KEY) \\\n    (pthread_in_use () ? pthread_key_delete ((KEY)->key) : 0)\n\n#endif\n\n \n\n#if USE_WINDOWS_THREADS\n\n# define WIN32_LEAN_AND_MEAN   \n# include <windows.h>\n\n# include \"windows-tls.h\"\n\n \n\ntypedef glwthread_tls_key_t gl_tls_key_t;\n# define glthread_tls_key_init(KEY, DESTRUCTOR) \\\n    glwthread_tls_key_create (KEY, DESTRUCTOR)\n# define gl_tls_get(NAME) \\\n    TlsGetValue (NAME)\n# define glthread_tls_set(KEY, POINTER) \\\n    (!TlsSetValue (*(KEY), POINTER) ? EINVAL : 0)\n# define glthread_tls_key_destroy(KEY) \\\n    glwthread_tls_key_delete (*(KEY))\n\n#endif\n\n \n\n#if !(USE_ISOC_THREADS || USE_POSIX_THREADS || USE_ISOC_AND_POSIX_THREADS || USE_WINDOWS_THREADS)\n\n \n\n \n\ntypedef struct\n        {\n          void *singlethread_value;\n        }\n        gl_tls_key_t;\n# define glthread_tls_key_init(KEY, DESTRUCTOR) \\\n    ((KEY)->singlethread_value = NULL, \\\n     (void) (DESTRUCTOR),              \\\n     0)\n# define gl_tls_get(NAME) \\\n    (NAME).singlethread_value\n# define glthread_tls_set(KEY, POINTER) \\\n    ((KEY)->singlethread_value = (POINTER), 0)\n# define glthread_tls_key_destroy(KEY) \\\n    0\n\n#endif\n\n \n\n \n\n \n\n#define gl_tls_key_init(NAME, DESTRUCTOR) \\\n   do                                                 \\\n     {                                                \\\n       if (glthread_tls_key_init (&NAME, DESTRUCTOR)) \\\n         abort ();                                    \\\n     }                                                \\\n   while (0)\n#define gl_tls_set(NAME, POINTER) \\\n   do                                         \\\n     {                                        \\\n       if (glthread_tls_set (&NAME, POINTER)) \\\n         abort ();                            \\\n     }                                        \\\n   while (0)\n#define gl_tls_key_destroy(NAME) \\\n   do                                        \\\n     {                                       \\\n       if (glthread_tls_key_destroy (&NAME)) \\\n         abort ();                           \\\n     }                                       \\\n   while (0)\n\n \n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}