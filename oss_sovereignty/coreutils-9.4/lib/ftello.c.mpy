{
  "module_name": "ftello.c",
  "hash_id": "b63001d0dbc44d899df31641a7b0811ff05f0c5c79bd331eb3f245fa651df46c",
  "original_prompt": "Ingested from coreutils-9.4/lib/ftello.c",
  "human_readable_source": " \n#include <stdio.h>\n\n#include <errno.h>\n#include \"intprops.h\"\n\n \n#include <unistd.h>\n\n#include \"stdio-impl.h\"\n\noff_t\nftello (FILE *fp)\n#undef ftello\n#if !HAVE_FTELLO\n# undef ftell\n# define ftello ftell\n#endif\n#if _GL_WINDOWS_64_BIT_OFF_T\n# undef ftello\n# if HAVE__FTELLI64  \n#  define ftello _ftelli64\n# else  \n#  define ftello ftello64\n# endif\n#endif\n{\n#if FTELLO_BROKEN_AFTER_UNGETC  \n   \n\n   \n  if (fp->_file < 0 || fp->_seek == NULL)\n    {\n      errno = ESPIPE;\n      return -1;\n    }\n\n   \n  off_t pos;\n\n  if (fp->_flags & __SOFF)\n    pos = fp->_offset;\n  else\n    {\n      pos = fp->_seek (fp->_cookie, 0, SEEK_CUR);\n      if (pos < 0)\n        return -1;\n      if (fp->_flags & __SOPT)\n        {\n          fp->_offset = pos;\n          fp->_flags |= __SOFF;\n        }\n    }\n\n  if (fp->_flags & __SRD)\n    {\n       \n      if (fp->_ub._base != NULL)\n         \n        pos = pos - fp->_ur - fp->_r;\n      else\n         \n        pos = pos - fp->_r;\n      if (pos < 0)\n        {\n          errno = EIO;\n          return -1;\n        }\n    }\n  else if ((fp->_flags & __SWR) && fp->_p != NULL)\n    {\n       \n      off_t buffered = fp->_p - fp->_bf._base;\n\n       \n      off_t sum;\n      if (! INT_ADD_OK (pos, buffered, &sum))\n        {\n          errno = EOVERFLOW;\n          return -1;\n        }\n      pos = sum;\n    }\n\n  return pos;\n\n#else\n\n# if LSEEK_PIPE_BROKEN\n   \n  if (lseek (fileno (fp), 0, SEEK_CUR) == -1)\n    return -1;\n# endif\n\n# if FTELLO_BROKEN_AFTER_SWITCHING_FROM_READ_TO_WRITE  \n   \n  if (fp_->_flag & _IOWRT)\n    {\n      off_t pos;\n\n       \n      ftello (fp);\n\n       \n      pos = lseek (fileno (fp), (off_t) 0, SEEK_CUR);\n      if (pos >= 0)\n        {\n          if ((fp_->_flag & _IONBF) == 0 && fp_->_base != NULL)\n            pos += fp_->_ptr - fp_->_base;\n        }\n      return pos;\n    }\n# endif\n\n# if defined __SL64 && defined __SCLE  \n  if ((fp->_flags & __SL64) == 0)\n    {\n       \n      FILE *tmp = fopen (\"/dev/null\", \"r\");\n      if (!tmp)\n        return -1;\n      fp->_flags |= __SL64;\n      fp->_seek64 = tmp->_seek64;\n      fclose (tmp);\n    }\n# endif\n\n  return ftello (fp);\n\n#endif\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}