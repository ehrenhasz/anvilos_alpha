{
  "module_name": "fstatat.c",
  "hash_id": "ecc54d8baa54ae58a69a68703832ce79d01fdda0bb5d5aa1e7405a833f7df7f8",
  "original_prompt": "Ingested from coreutils-9.4/lib/fstatat.c",
  "human_readable_source": " \n\n \n#define __need_system_sys_stat_h\n#include <config.h>\n\n \n#include <sys/types.h>\n#include <sys/stat.h>\n#undef __need_system_sys_stat_h\n\n#if HAVE_FSTATAT && HAVE_WORKING_FSTATAT_ZERO_FLAG\nstatic int\norig_fstatat (int fd, char const *filename, struct stat *buf, int flags)\n{\n  return fstatat (fd, filename, buf, flags);\n}\n#endif\n\n#ifdef __osf__\n \n# include \"sys/stat.h\"\n#else\n# include <sys/stat.h>\n#endif\n\n#include \"stat-time.h\"\n\n#include <errno.h>\n#include <fcntl.h>\n#include <stdlib.h>\n#include <string.h>\n\n#if HAVE_FSTATAT && HAVE_WORKING_FSTATAT_ZERO_FLAG\n\n# ifndef LSTAT_FOLLOWS_SLASHED_SYMLINK\n#  define LSTAT_FOLLOWS_SLASHED_SYMLINK 0\n# endif\n\nstatic int\nnormal_fstatat (int fd, char const *file, struct stat *st, int flag)\n{\n  return stat_time_normalize (orig_fstatat (fd, file, st, flag), st);\n}\n\n \n\nint\nrpl_fstatat (int fd, char const *file, struct stat *st, int flag)\n{\n  int result = normal_fstatat (fd, file, st, flag);\n  size_t len;\n\n  if (LSTAT_FOLLOWS_SLASHED_SYMLINK || result != 0)\n    return result;\n  len = strlen (file);\n  if (flag & AT_SYMLINK_NOFOLLOW)\n    {\n       \n      if (file[len - 1] != '/' || S_ISDIR (st->st_mode))\n        return 0;\n      if (!S_ISLNK (st->st_mode))\n        {\n          errno = ENOTDIR;\n          return -1;\n        }\n      result = normal_fstatat (fd, file, st, flag & ~AT_SYMLINK_NOFOLLOW);\n    }\n   \n  if (result == 0 && !S_ISDIR (st->st_mode) && file[len - 1] == '/')\n    {\n      errno = ENOTDIR;\n      return -1;\n    }\n  return result;\n}\n\n#else  \n\n \nstatic int\nstat_func (char const *name, struct stat *st)\n{\n  return stat (name, st);\n}\n\n \n# if !HAVE_LSTAT\n#  undef lstat\n#  define lstat stat_func\n# endif\n\n \n\n# define AT_FUNC_NAME fstatat\n# define AT_FUNC_F1 lstat\n# define AT_FUNC_F2 stat_func\n# define AT_FUNC_USE_F1_COND AT_SYMLINK_NOFOLLOW\n# define AT_FUNC_POST_FILE_PARAM_DECLS , struct stat *st, int flag\n# define AT_FUNC_POST_FILE_ARGS        , st\n# include \"at-func.c\"\n# undef AT_FUNC_NAME\n# undef AT_FUNC_F1\n# undef AT_FUNC_F2\n# undef AT_FUNC_USE_F1_COND\n# undef AT_FUNC_POST_FILE_PARAM_DECLS\n# undef AT_FUNC_POST_FILE_ARGS\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}