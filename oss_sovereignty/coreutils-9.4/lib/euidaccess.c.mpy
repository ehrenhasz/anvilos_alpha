{
  "module_name": "euidaccess.c",
  "hash_id": "479a77cfb48f6722df1e671c78f90c1b0b0e20ee903f473ebc7985aa64fedcbd",
  "original_prompt": "Ingested from coreutils-9.4/lib/euidaccess.c",
  "human_readable_source": " \n\n#ifndef _LIBC\n# include <config.h>\n#endif\n\n#include <fcntl.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <unistd.h>\n#if defined _WIN32 && ! defined __CYGWIN__\n# include <io.h>\n#else\n# include \"root-uid.h\"\n#endif\n\n#if HAVE_LIBGEN_H\n# include <libgen.h>\n#endif\n\n#include <errno.h>\n#ifndef __set_errno\n# define __set_errno(val) errno = (val)\n#endif\n\n#if defined EACCES && !defined EACCESS\n# define EACCESS EACCES\n#endif\n\n#ifndef F_OK\n# define F_OK 0\n# define X_OK 1\n# define W_OK 2\n# define R_OK 4\n#endif\n\n\n#ifdef _LIBC\n\n# define access __access\n# define getuid __getuid\n# define getgid __getgid\n# define geteuid __geteuid\n# define getegid __getegid\n# define group_member __group_member\n# define euidaccess __euidaccess\n# undef stat\n# define stat stat64\n\n#endif\n\n \n\nint\neuidaccess (const char *file, int mode)\n{\n#if HAVE_FACCESSAT                    \n  return faccessat (AT_FDCWD, file, mode, AT_EACCESS);\n#elif defined EFF_ONLY_OK                \n  return access (file, mode | EFF_ONLY_OK);\n#elif defined ACC_SELF                   \n  return accessx (file, mode, ACC_SELF);\n#elif HAVE_EACCESS                       \n  return eaccess (file, mode);\n#elif defined _WIN32 && ! defined __CYGWIN__   \n  return _access (file, mode);\n#else               \n\n  uid_t uid = getuid ();\n  gid_t gid = getgid ();\n  uid_t euid = geteuid ();\n  gid_t egid = getegid ();\n  struct stat stats;\n\n# if HAVE_DECL_SETREGID && PREFER_NONREENTRANT_EUIDACCESS\n\n   \n\n  if (mode == F_OK)\n    {\n      int result = stat (file, &stats);\n      return result != 0 && errno == EOVERFLOW ? 0 : result;\n    }\n  else\n    {\n      int result;\n      int saved_errno;\n\n      if (uid != euid)\n        setreuid (euid, uid);\n      if (gid != egid)\n        setregid (egid, gid);\n\n      result = access (file, mode);\n      saved_errno = errno;\n\n       \n      if (uid != euid)\n        setreuid (uid, euid);\n      if (gid != egid)\n        setregid (gid, egid);\n\n      errno = saved_errno;\n      return result;\n    }\n\n# else\n\n   \n\n  unsigned int granted;\n  if (uid == euid && gid == egid)\n     \n    return access (file, mode);\n\n  if (stat (file, &stats) == -1)\n    return mode == F_OK && errno == EOVERFLOW ? 0 : -1;\n\n   \n  if (euid == ROOT_UID\n      && ((mode & X_OK) == 0\n          || (stats.st_mode & (S_IXUSR | S_IXGRP | S_IXOTH))))\n    return 0;\n\n   \n  if (R_OK == 4 && W_OK == 2 && X_OK == 1 && F_OK == 0)\n    mode &= 7;\n  else\n    mode = ((mode & R_OK ? 4 : 0)\n            + (mode & W_OK ? 2 : 0)\n            + (mode & X_OK ? 1 : 0));\n\n  if (mode == 0)\n    return 0;                    \n\n   \n  if (S_IRUSR == (4 << 6) && S_IWUSR == (2 << 6) && S_IXUSR == (1 << 6)\n      && S_IRGRP == (4 << 3) && S_IWGRP == (2 << 3) && S_IXGRP == (1 << 3)\n      && S_IROTH == (4 << 0) && S_IWOTH == (2 << 0) && S_IXOTH == (1 << 0))\n    granted = stats.st_mode;\n  else\n    granted = ((stats.st_mode & S_IRUSR ? 4 << 6 : 0)\n               + (stats.st_mode & S_IWUSR ? 2 << 6 : 0)\n               + (stats.st_mode & S_IXUSR ? 1 << 6 : 0)\n               + (stats.st_mode & S_IRGRP ? 4 << 3 : 0)\n               + (stats.st_mode & S_IWGRP ? 2 << 3 : 0)\n               + (stats.st_mode & S_IXGRP ? 1 << 3 : 0)\n               + (stats.st_mode & S_IROTH ? 4 << 0 : 0)\n               + (stats.st_mode & S_IWOTH ? 2 << 0 : 0)\n               + (stats.st_mode & S_IXOTH ? 1 << 0 : 0));\n\n  if (euid == stats.st_uid)\n    granted >>= 6;\n  else if (egid == stats.st_gid || group_member (stats.st_gid))\n    granted >>= 3;\n\n  if ((mode & ~granted) == 0)\n    return 0;\n  __set_errno (EACCESS);\n  return -1;\n\n# endif\n#endif\n}\n#undef euidaccess\n#ifdef weak_alias\nweak_alias (__euidaccess, euidaccess)\n#endif\n\f\n#ifdef TEST\n# include <error.h>\n# include <stdio.h>\n# include <stdlib.h>\n\nint\nmain (int argc, char **argv)\n{\n  char *file;\n  int mode;\n  int err;\n\n  if (argc < 3)\n    abort ();\n  file = argv[1];\n  mode = atoi (argv[2]);\n\n  err = euidaccess (file, mode);\n  printf (\"%d\\n\", err);\n  if (err != 0)\n    error (0, errno, \"%s\", file);\n  exit (0);\n}\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}