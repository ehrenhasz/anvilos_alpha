{
  "module_name": "isapipe.c",
  "hash_id": "4f141a71a909adee74d5e5915fc6a6db25f293797108342ccd3ab233579f6058",
  "original_prompt": "Ingested from coreutils-9.4/lib/isapipe.c",
  "human_readable_source": " \n\n#include <config.h>\n\n#include \"isapipe.h\"\n\n#include <errno.h>\n\n#if defined _WIN32 && ! defined __CYGWIN__\n \n\n \n# include <windows.h>\n\n \n# if GNULIB_MSVC_NOTHROW\n#  include \"msvc-nothrow.h\"\n# else\n#  include <io.h>\n# endif\n\nint\nisapipe (int fd)\n{\n  HANDLE h = (HANDLE) _get_osfhandle (fd);\n\n  if (h == INVALID_HANDLE_VALUE)\n    {\n      errno = EBADF;\n      return -1;\n    }\n\n  return (GetFileType (h) == FILE_TYPE_PIPE);\n}\n\n#else\n \n\n# include <sys/types.h>\n# include <sys/stat.h>\n# include <unistd.h>\n\n \n# ifndef PIPE_LINK_COUNT_MAX\n#  define PIPE_LINK_COUNT_MAX ((nlink_t) (-1))\n# endif\n\n \n\nint\nisapipe (int fd)\n{\n  nlink_t pipe_link_count_max = PIPE_LINK_COUNT_MAX;\n  bool check_for_fifo = (HAVE_FIFO_PIPES == 1);\n  struct stat st;\n  int fstat_result = fstat (fd, &st);\n\n  if (fstat_result != 0)\n    return fstat_result;\n\n   \n\n  if (! ((HAVE_FIFO_PIPES == 0 || HAVE_FIFO_PIPES == 1)\n         && PIPE_LINK_COUNT_MAX != (nlink_t) -1)\n      && (S_ISFIFO (st.st_mode) | S_ISSOCK (st.st_mode)))\n    {\n      int fd_pair[2];\n      int pipe_result = pipe (fd_pair);\n      if (pipe_result != 0)\n        return pipe_result;\n      else\n        {\n          struct stat pipe_st;\n          int fstat_pipe_result = fstat (fd_pair[0], &pipe_st);\n          int fstat_pipe_errno = errno;\n          close (fd_pair[0]);\n          close (fd_pair[1]);\n          if (fstat_pipe_result != 0)\n            {\n              errno = fstat_pipe_errno;\n              return fstat_pipe_result;\n            }\n          check_for_fifo = (S_ISFIFO (pipe_st.st_mode) != 0);\n          pipe_link_count_max = pipe_st.st_nlink;\n        }\n    }\n\n  return\n    (st.st_nlink <= pipe_link_count_max\n     && (check_for_fifo ? S_ISFIFO (st.st_mode) : S_ISSOCK (st.st_mode)));\n}\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}