{
  "module_name": "isatty.c",
  "hash_id": "0a76e1852a9475c5b0f7d31252e87ec054b4171b1d054ef3f518a23511fc1455",
  "original_prompt": "Ingested from coreutils-9.4/lib/isatty.c",
  "human_readable_source": " \n#include <unistd.h>\n\n \n\n#include <errno.h>\n#include <string.h>\n\n \n#define WIN32_LEAN_AND_MEAN\n#include <windows.h>\n\n#if HAVE_MSVC_INVALID_PARAMETER_HANDLER\n# include \"msvc-inval.h\"\n#endif\n\n \n#if GNULIB_MSVC_NOTHROW\n# include \"msvc-nothrow.h\"\n#else\n# include <io.h>\n#endif\n\n \n#undef LoadLibrary\n#define LoadLibrary LoadLibraryA\n#undef QueryFullProcessImageName\n#define QueryFullProcessImageName QueryFullProcessImageNameA\n\n#if !(_WIN32_WINNT >= _WIN32_WINNT_VISTA)\n\n \n# define GetProcAddress \\\n   (void *) GetProcAddress\n\n \ntypedef BOOL (WINAPI * GetNamedPipeClientProcessIdFuncType) (HANDLE hPipe,\n                                                             PULONG pClientProcessId);\nstatic GetNamedPipeClientProcessIdFuncType GetNamedPipeClientProcessIdFunc = NULL;\n \ntypedef BOOL (WINAPI * QueryFullProcessImageNameFuncType) (HANDLE hProcess,\n                                                           DWORD dwFlags,\n                                                           LPSTR lpExeName,\n                                                           PDWORD pdwSize);\nstatic QueryFullProcessImageNameFuncType QueryFullProcessImageNameFunc = NULL;\nstatic BOOL initialized = FALSE;\n\nstatic void\ninitialize (void)\n{\n  HMODULE kernel32 = LoadLibrary (\"kernel32.dll\");\n  if (kernel32 != NULL)\n    {\n      GetNamedPipeClientProcessIdFunc =\n        (GetNamedPipeClientProcessIdFuncType) GetProcAddress (kernel32, \"GetNamedPipeClientProcessId\");\n      QueryFullProcessImageNameFunc =\n        (QueryFullProcessImageNameFuncType) GetProcAddress (kernel32, \"QueryFullProcessImageNameA\");\n    }\n  initialized = TRUE;\n}\n\n#else\n\n# define GetNamedPipeClientProcessIdFunc GetNamedPipeClientProcessId\n# define QueryFullProcessImageNameFunc QueryFullProcessImageName\n\n#endif\n\nstatic BOOL IsConsoleHandle (HANDLE h)\n{\n  DWORD mode;\n   \n  BOOL result = FALSE;\n  ULONG processId;\n\n#if !(_WIN32_WINNT >= _WIN32_WINNT_VISTA)\n  if (!initialized)\n    initialize ();\n#endif\n\n   \n  if (GetNamedPipeClientProcessIdFunc && QueryFullProcessImageNameFunc\n      && GetNamedPipeClientProcessIdFunc (h, &processId))\n    {\n       \n          if (QueryFullProcessImageNameFunc (processHandle, 0, buf, &bufsize))\n            {\n              if (strlen (buf) >= 11\n                  && strcmp (buf + strlen (buf) - 11, \"\\\\mintty.exe\") == 0)\n                result = TRUE;\n            }\n          CloseHandle (processHandle);\n        }\n    }\n  return result;\n}\n\n#if HAVE_MSVC_INVALID_PARAMETER_HANDLER\nstatic int\n_isatty_nothrow (int fd)\n{\n  int result;\n\n  TRY_MSVC_INVAL\n    {\n      result = _isatty (fd);\n    }\n  CATCH_MSVC_INVAL\n    {\n      result = 0;\n    }\n  DONE_MSVC_INVAL;\n\n  return result;\n}\n#else\n# define _isatty_nothrow _isatty\n#endif\n\n \nint\nisatty (int fd)\n{\n  HANDLE h = (HANDLE) _get_osfhandle (fd);\n  if (h == INVALID_HANDLE_VALUE)\n    {\n      errno = EBADF;\n      return 0;\n    }\n   \n  if (_isatty_nothrow (fd))\n    {\n      if (IsConsoleHandle (h))\n        return 1;\n    }\n  if (IsCygwinConsoleHandle (h))\n    return 1;\n  errno = ENOTTY;\n  return 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}