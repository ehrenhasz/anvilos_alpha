{
  "module_name": "openat-proc.c",
  "hash_id": "36e026a5a1b653ec0466917803232259aea33b20282d4edadf508341e9fdea8d",
  "original_prompt": "Ingested from coreutils-9.4/lib/openat-proc.c",
  "human_readable_source": " \n\n#include <config.h>\n\n#include \"openat-priv.h\"\n\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <unistd.h>\n\n#ifdef __KLIBC__  \n# include <InnoTekLIBC/backend.h>\n#endif\n#ifdef __MVS__  \n# include <termios.h>\n#endif\n\n#include \"intprops.h\"\n\n \nchar *\nopenat_proc_name (char buf[OPENAT_BUFFER_SIZE], int fd, char const *file)\n{\n  char *result = buf;\n  int dirlen;\n\n   \n  if (!*file)\n    {\n      buf[0] = '\\0';\n      return buf;\n    }\n\n#if !(defined __KLIBC__ || defined __MVS__)\n   \n# define PROC_SELF_FD_FORMAT \"/proc/self/fd/%d/\"\n  {\n    enum {\n      PROC_SELF_FD_DIR_SIZE_BOUND\n        = (sizeof PROC_SELF_FD_FORMAT - (sizeof \"%d\" - 1)\n           + INT_STRLEN_BOUND (int))\n    };\n\n    static int proc_status = 0;\n    if (! proc_status)\n      {\n         \n\n        int proc_self_fd =\n          open (\"/proc/self/fd\",\n                O_SEARCH | O_DIRECTORY | O_NOCTTY | O_NONBLOCK | O_CLOEXEC);\n        if (proc_self_fd < 0)\n          proc_status = -1;\n        else\n          {\n             \n            char dotdot_buf[PROC_SELF_FD_DIR_SIZE_BOUND + sizeof \"../fd\" - 1];\n            sprintf (dotdot_buf, PROC_SELF_FD_FORMAT \"../fd\", proc_self_fd);\n            proc_status = access (dotdot_buf, F_OK) ? -1 : 1;\n            close (proc_self_fd);\n          }\n      }\n\n    if (proc_status < 0)\n      return NULL;\n    else\n      {\n        size_t bufsize = PROC_SELF_FD_DIR_SIZE_BOUND + strlen (file);\n        if (OPENAT_BUFFER_SIZE < bufsize)\n          {\n            result = malloc (bufsize);\n            if (! result)\n              return NULL;\n          }\n\n        dirlen = sprintf (result, PROC_SELF_FD_FORMAT, fd);\n      }\n  }\n#else  \n   \n  {\n    size_t bufsize;\n\n# ifdef __KLIBC__\n    char dir[_MAX_PATH];\n    if (__libc_Back_ioFHToPath (fd, dir, sizeof dir))\n      return NULL;\n# endif\n# ifdef __MVS__\n    char dir[_XOPEN_PATH_MAX];\n     \n    if (OPENAT_BUFFER_SIZE < bufsize)\n      {\n        result = malloc (bufsize);\n        if (! result)\n          return NULL;\n      }\n\n    strcpy (result, dir);\n    result[dirlen++] = '/';\n  }\n#endif\n\n  strcpy (result + dirlen, file);\n  return result;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}