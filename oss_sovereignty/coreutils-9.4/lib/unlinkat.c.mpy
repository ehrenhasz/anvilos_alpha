{
  "module_name": "unlinkat.c",
  "hash_id": "96b1fbc499ad01db64e796ff6c3d88f639cef3022eab67d008989d749b8252e3",
  "original_prompt": "Ingested from coreutils-9.4/lib/unlinkat.c",
  "human_readable_source": " \n\n#include <config.h>\n\n#include <unistd.h>\n\n#include <errno.h>\n#include <fcntl.h>\n#include <string.h>\n#include <sys/stat.h>\n\n#include <stdlib.h>\n\n#include \"filename.h\"\n#include \"openat.h\"\n\n#if HAVE_UNLINKAT\n\n# undef unlinkat\n\n \n\nint\nrpl_unlinkat (int fd, char const *name, int flag)\n{\n  size_t len;\n  int result = 0;\n   \n  if (flag & AT_REMOVEDIR)\n    return unlinkat (fd, name, flag);\n\n  len = strlen (name);\n  if (len && ISSLASH (name[len - 1]))\n    {\n       \n      struct stat st;\n      result = fstatat (fd, name, &st, AT_SYMLINK_NOFOLLOW);\n      if (result == 0 || errno == EOVERFLOW)\n        {\n           \n          char *short_name = malloc (len);\n          if (!short_name)\n            {\n              errno = EPERM;\n              return -1;\n            }\n          memcpy (short_name, name, len);\n          while (len && ISSLASH (short_name[len - 1]))\n            short_name[--len] = '\\0';\n          if (len && (fstatat (fd, short_name, &st, AT_SYMLINK_NOFOLLOW)\n                      || S_ISLNK (st.st_mode)))\n            {\n              free (short_name);\n              errno = EPERM;\n              return -1;\n            }\n          free (short_name);\n          result = 0;\n        }\n    }\n  if (!result)\n    {\n# if UNLINK_PARENT_BUG\n      if (len >= 2 && name[len - 1] == '.' && name[len - 2] == '.'\n          && (len == 2 || ISSLASH (name[len - 3])))\n        {\n          errno = EISDIR;  \n          return -1;\n        }\n# endif\n      result = unlinkat (fd, name, flag);\n    }\n  return result;\n}\n\n#else  \n\n \n\n# define AT_FUNC_NAME unlinkat\n# define AT_FUNC_F1 rmdir\n# define AT_FUNC_F2 unlink\n# define AT_FUNC_USE_F1_COND AT_REMOVEDIR\n# define AT_FUNC_POST_FILE_PARAM_DECLS , int flag\n# define AT_FUNC_POST_FILE_ARGS         \n# include \"at-func.c\"\n# undef AT_FUNC_NAME\n# undef AT_FUNC_F1\n# undef AT_FUNC_F2\n# undef AT_FUNC_USE_F1_COND\n# undef AT_FUNC_POST_FILE_PARAM_DECLS\n# undef AT_FUNC_POST_FILE_ARGS\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}