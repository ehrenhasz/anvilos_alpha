{
  "module_name": "pselect.c",
  "hash_id": "23fefb96e5792d9022d068d0b6e0015846e15457cfa9f3dc7366c2689517d01c",
  "original_prompt": "Ingested from coreutils-9.4/lib/pselect.c",
  "human_readable_source": " \n\n#include <config.h>\n\n#include <sys/select.h>\n\n#include <errno.h>\n#include <signal.h>\n\n \n\n#if !HAVE_PSELECT\n\nint\npselect (int nfds, fd_set *restrict rfds,\n         fd_set *restrict wfds, fd_set *restrict xfds,\n         struct timespec const *restrict timeout,\n         sigset_t const *restrict sigmask)\n{\n  int select_result;\n  sigset_t origmask;\n  struct timeval tv, *tvp;\n\n  if (nfds < 0 || nfds > FD_SETSIZE)\n    {\n      errno = EINVAL;\n      return -1;\n    }\n\n  if (timeout)\n    {\n      if (! (0 <= timeout->tv_nsec && timeout->tv_nsec < 1000000000))\n        {\n          errno = EINVAL;\n          return -1;\n        }\n\n      tv = (struct timeval) {\n        .tv_sec = timeout->tv_sec,\n        .tv_usec = (timeout->tv_nsec + 999) / 1000\n      };\n      tvp = &tv;\n    }\n  else\n    tvp = NULL;\n\n   \n  if (sigmask)\n    pthread_sigmask (SIG_SETMASK, sigmask, &origmask);\n\n  select_result = select (nfds, rfds, wfds, xfds, tvp);\n\n  if (sigmask)\n    {\n      int select_errno = errno;\n      pthread_sigmask (SIG_SETMASK, &origmask, NULL);\n      errno = select_errno;\n    }\n\n  return select_result;\n}\n\n#else  \n# include <unistd.h>\n# undef pselect\n\nint\nrpl_pselect (int nfds, fd_set *restrict rfds,\n             fd_set *restrict wfds, fd_set *restrict xfds,\n             struct timespec const *restrict timeout,\n             sigset_t const *restrict sigmask)\n{\n  int i;\n\n   \n  if (nfds < 0 || nfds > FD_SETSIZE)\n    {\n      errno = EINVAL;\n      return -1;\n    }\n  for (i = 0; i < nfds; i++)\n    {\n      if (((rfds && FD_ISSET (i, rfds))\n           || (wfds && FD_ISSET (i, wfds))\n           || (xfds && FD_ISSET (i, xfds)))\n          && dup2 (i, i) != i)\n        return -1;\n    }\n\n  return pselect (nfds, rfds, wfds, xfds, timeout, sigmask);\n}\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}