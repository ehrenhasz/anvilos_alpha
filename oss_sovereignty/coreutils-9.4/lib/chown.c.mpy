{
  "module_name": "chown.c",
  "hash_id": "11c5877df963b15bf3f5981b40426bfa8ef20165f4fd219279a38b67dc639d8a",
  "original_prompt": "Ingested from coreutils-9.4/lib/chown.c",
  "human_readable_source": " \n\n \n\n#include <config.h>\n\n \n#include <unistd.h>\n\n#include <errno.h>\n#include <fcntl.h>\n#include <string.h>\n#include <sys/stat.h>\n\n#if !HAVE_CHOWN\n\n \nint\nchown (_GL_UNUSED const char *file, _GL_UNUSED uid_t uid,\n       _GL_UNUSED gid_t gid)\n{\n  errno = ENOSYS;\n  return -1;\n}\n\n#else  \n\n \n# undef chown\n\n \n\nint\nrpl_chown (const char *file, uid_t uid, gid_t gid)\n{\n  struct stat st;\n  bool stat_valid = false;\n  int result;\n\n# if CHOWN_CHANGE_TIME_BUG\n  if (gid != (gid_t) -1 || uid != (uid_t) -1)\n    {\n      if (stat (file, &st))\n        return -1;\n      stat_valid = true;\n    }\n# endif\n\n# if CHOWN_FAILS_TO_HONOR_ID_OF_NEGATIVE_ONE\n  if (gid == (gid_t) -1 || uid == (uid_t) -1)\n    {\n       \n      if (!stat_valid && stat (file, &st))\n        return -1;\n      if (gid == (gid_t) -1)\n        gid = st.st_gid;\n      if (uid == (uid_t) -1)\n        uid = st.st_uid;\n    }\n# endif\n\n# if CHOWN_MODIFIES_SYMLINK\n  {\n     \n    int open_flags = O_NONBLOCK | O_NOCTTY | O_CLOEXEC;\n    int fd = open (file, O_RDONLY | open_flags);\n    if (0 <= fd\n        || (errno == EACCES\n            && 0 <= (fd = open (file, O_WRONLY | open_flags))))\n      {\n        int saved_errno;\n        bool fchown_socket_failure;\n\n        result = fchown (fd, uid, gid);\n        saved_errno = errno;\n\n         \n        fchown_socket_failure =\n          (result != 0 && saved_errno == EINVAL\n           && fstat (fd, &st) == 0\n           && (S_ISFIFO (st.st_mode) || S_ISSOCK (st.st_mode)));\n\n        close (fd);\n\n        if (! fchown_socket_failure)\n          {\n            errno = saved_errno;\n            return result;\n          }\n      }\n    else if (errno != EACCES)\n      return -1;\n  }\n# endif\n\n# if CHOWN_TRAILING_SLASH_BUG\n  if (!stat_valid)\n    {\n      size_t len = strlen (file);\n      if (len && file[len - 1] == '/' && stat (file, &st))\n        return -1;\n    }\n# endif\n\n  result = chown (file, uid, gid);\n\n# if CHOWN_CHANGE_TIME_BUG\n  if (result == 0 && stat_valid\n      && (uid == st.st_uid || uid == (uid_t) -1)\n      && (gid == st.st_gid || gid == (gid_t) -1))\n    {\n       \n      result = chmod (file, st.st_mode & (S_IRWXU | S_IRWXG | S_IRWXO\n                                          | S_ISUID | S_ISGID | S_ISVTX));\n    }\n# endif\n\n  return result;\n}\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}