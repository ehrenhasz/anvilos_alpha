{
  "module_name": "sockets.c",
  "hash_id": "6fc7359735afc2d8fef378dafdc7348af67444fd6a8d75144a104cebc6cb112b",
  "original_prompt": "Ingested from coreutils-9.4/lib/sockets.c",
  "human_readable_source": " \n\n#include <config.h>\n\n \n#include \"sockets.h\"\n\n#if WINDOWS_SOCKETS\n\n \n# include <sys/socket.h>\n\n# include \"fd-hook.h\"\n# if GNULIB_MSVC_NOTHROW\n#  include \"msvc-nothrow.h\"\n# else\n#  include <io.h>\n# endif\n\n \n# include \"w32sock.h\"\n\nstatic int\nclose_fd_maybe_socket (const struct fd_hook *remaining_list,\n                       gl_close_fn primary,\n                       int fd)\n{\n   \n  SOCKET sock;\n  WSANETWORKEVENTS ev;\n\n   \n  sock = FD_TO_SOCKET (fd);\n  ev.lNetworkEvents = 0xDEADBEEF;\n  WSAEnumNetworkEvents (sock, NULL, &ev);\n  if (ev.lNetworkEvents != 0xDEADBEEF)\n    {\n       \n       \n      if (closesocket (sock))\n        {\n          set_winsock_errno ();\n          return -1;\n        }\n      else\n        {\n           \n          _close (fd);\n          return 0;\n        }\n    }\n  else\n     \n    return execute_close_hooks (remaining_list, primary, fd);\n}\n\nstatic int\nioctl_fd_maybe_socket (const struct fd_hook *remaining_list,\n                       gl_ioctl_fn primary,\n                       int fd, int request, void *arg)\n{\n  SOCKET sock;\n  WSANETWORKEVENTS ev;\n\n   \n  sock = FD_TO_SOCKET (fd);\n  ev.lNetworkEvents = 0xDEADBEEF;\n  WSAEnumNetworkEvents (sock, NULL, &ev);\n  if (ev.lNetworkEvents != 0xDEADBEEF)\n    {\n       \n      if (ioctlsocket (sock, request, arg) < 0)\n        {\n          set_winsock_errno ();\n          return -1;\n        }\n      else\n        return 0;\n    }\n  else\n     \n    return execute_ioctl_hooks (remaining_list, primary, fd, request, arg);\n}\n\nstatic struct fd_hook fd_sockets_hook;\n\nstatic int initialized_sockets_version  ;\n\n#endif  \n\nint\ngl_sockets_startup (_GL_UNUSED int version)\n{\n#if WINDOWS_SOCKETS\n  if (version > initialized_sockets_version)\n    {\n      WSADATA data;\n      int err;\n\n      err = WSAStartup (version, &data);\n      if (err != 0)\n        return 1;\n\n      if (data.wVersion != version)\n        {\n          WSACleanup ();\n          return 2;\n        }\n\n      if (initialized_sockets_version == 0)\n        register_fd_hook (close_fd_maybe_socket, ioctl_fd_maybe_socket,\n                          &fd_sockets_hook);\n\n      initialized_sockets_version = version;\n    }\n#endif\n\n  return 0;\n}\n\nint\ngl_sockets_cleanup (void)\n{\n#if WINDOWS_SOCKETS\n  int err;\n\n  initialized_sockets_version = 0;\n\n  unregister_fd_hook (&fd_sockets_hook);\n\n  err = WSACleanup ();\n  if (err != 0)\n    return 1;\n#endif\n\n  return 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}