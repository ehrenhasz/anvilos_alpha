{
  "module_name": "nl_langinfo-lock.c",
  "hash_id": "03bb67f4f21912069c22ace13435011c6b8be58ab7d667c4e0ecd6201581f2d2",
  "original_prompt": "Ingested from coreutils-9.4/lib/nl_langinfo-lock.c",
  "human_readable_source": " \n\n#include <config.h>\n\n \n#if OMIT_NL_LANGINFO_LOCK\n\n \ntypedef int dummy;\n\n#else\n\n \n\n \n# undef gl_get_nl_langinfo_lock\n\n \n# ifndef DLL_EXPORTED\n#  if HAVE_VISIBILITY\n   \n#   define DLL_EXPORTED __attribute__((__visibility__(\"default\")))\n#  elif defined _WIN32 || defined __CYGWIN__\n#   define DLL_EXPORTED __declspec(dllexport)\n#  else\n#   define DLL_EXPORTED\n#  endif\n# endif\n\n# if defined _WIN32 && !defined __CYGWIN__\n\n#  define WIN32_LEAN_AND_MEAN   \n#  include <windows.h>\n\n#  include \"windows-initguard.h\"\n\n \n\n \nDLL_EXPORTED CRITICAL_SECTION *gl_get_nl_langinfo_lock (void);\n\nstatic glwthread_initguard_t guard = GLWTHREAD_INITGUARD_INIT;\nstatic CRITICAL_SECTION lock;\n\n \nCRITICAL_SECTION *\ngl_get_nl_langinfo_lock (void)\n{\n  if (!guard.done)\n    {\n      if (InterlockedIncrement (&guard.started) == 0)\n        {\n           \n          InitializeCriticalSection (&lock);\n          guard.done = 1;\n        }\n      else\n        {\n           \n          InterlockedDecrement (&guard.started);\n           \n          while (!guard.done)\n            Sleep (0);\n        }\n    }\n  return &lock;\n}\n\n# elif HAVE_PTHREAD_API\n\n#  include <pthread.h>\n\nstatic pthread_mutex_t mutex = PTHREAD_MUTEX_INITIALIZER;\n\n \nDLL_EXPORTED pthread_mutex_t *gl_get_nl_langinfo_lock (void);\n\n \npthread_mutex_t *\ngl_get_nl_langinfo_lock (void)\n{\n  return &mutex;\n}\n\n# elif HAVE_THREADS_H\n\n#  include <threads.h>\n#  include <stdlib.h>\n\nstatic int volatile init_needed = 1;\nstatic once_flag init_once = ONCE_FLAG_INIT;\nstatic mtx_t mutex;\n\nstatic void\natomic_init (void)\n{\n  if (mtx_init (&mutex, mtx_plain) != thrd_success)\n    abort ();\n  init_needed = 0;\n}\n\n \nDLL_EXPORTED mtx_t *gl_get_nl_langinfo_lock (void);\n\n \nmtx_t *\ngl_get_nl_langinfo_lock (void)\n{\n  if (init_needed)\n    call_once (&init_once, atomic_init);\n  return &mutex;\n}\n\n# endif\n\n# if (defined _WIN32 || defined __CYGWIN__) && !defined _MSC_VER\n \n#  if defined _WIN64 || defined _LP64\n#   define IMP(x) __imp_##x\n#  else\n#   define IMP(x) _imp__##x\n#  endif\nvoid * IMP(gl_get_nl_langinfo_lock) = &gl_get_nl_langinfo_lock;\n# endif\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}