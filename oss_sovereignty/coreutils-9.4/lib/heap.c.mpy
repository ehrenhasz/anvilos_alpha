{
  "module_name": "heap.c",
  "hash_id": "927af4eafbd325bae930003cb39e8cd530d7f3654e641abe88dcb5fee9e96a1a",
  "original_prompt": "Ingested from coreutils-9.4/lib/heap.c",
  "human_readable_source": " \n\n#include <config.h>\n\n#include \"heap.h\"\n#include \"stdlib--.h\"\n#include \"xalloc.h\"\n\nstatic int heap_default_compare (void const *, void const *);\nstatic size_t heapify_down (void **, size_t, size_t,\n                            int (*) (void const *, void const *));\nstatic void heapify_up (void **, size_t,\n                        int (*) (void const *, void const *));\n\nstruct heap\n{\n  void **array;      \n  size_t capacity;   \n  size_t count;      \n  int (*compare) (void const *, void const *);\n};\n\n \n\nstruct heap *\nheap_alloc (int (*compare) (void const *, void const *), size_t n_reserve)\n{\n  struct heap *heap = xmalloc (sizeof *heap);\n\n  if (n_reserve == 0)\n    n_reserve = 1;\n\n  heap->array = xnmalloc (n_reserve, sizeof *(heap->array));\n\n  heap->array[0] = nullptr;\n  heap->capacity = n_reserve;\n  heap->count = 0;\n  heap->compare = compare ? compare : heap_default_compare;\n\n  return heap;\n}\n\n\nstatic int\nheap_default_compare (void const *a, void const *b)\n{\n  return 0;\n}\n\n\nvoid\nheap_free (struct heap *heap)\n{\n  free (heap->array);\n  free (heap);\n}\n\n \n\nint\nheap_insert (struct heap *heap, void *item)\n{\n  if (heap->capacity - 1 <= heap->count)\n    heap->array = x2nrealloc (heap->array, &heap->capacity,\n                              sizeof *(heap->array));\n\n  heap->array[++heap->count] = item;\n  heapify_up (heap->array, heap->count, heap->compare);\n\n  return 0;\n}\n\n \n\nvoid *\nheap_remove_top (struct heap *heap)\n{\n  void *top;\n\n  if (heap->count == 0)\n    return nullptr;\n\n  top = heap->array[1];\n  heap->array[1] = heap->array[heap->count--];\n  heapify_down (heap->array, heap->count, 1, heap->compare);\n\n  return top;\n}\n\n \n\nstatic size_t\nheapify_down (void **array, size_t count, size_t initial,\n              int (*compare) (void const *, void const *))\n{\n  void *element = array[initial];\n\n  size_t parent = initial;\n  while (parent <= count / 2)\n    {\n      size_t child = 2 * parent;\n\n      if (child < count && compare (array[child], array[child + 1]) < 0)\n        child++;\n\n      if (compare (array[child], element) <= 0)\n        break;\n\n      array[parent] = array[child];\n      parent = child;\n    }\n\n  array[parent] = element;\n  return parent;\n}\n\n \n\nstatic void\nheapify_up (void **array, size_t count,\n            int (*compare) (void const *, void const *))\n{\n  size_t k = count;\n  void *new_element = array[k];\n\n  while (k != 1 && compare (array[k / 2], new_element) <= 0)\n    {\n      array[k] = array[k / 2];\n      k /= 2;\n    }\n\n  array[k] = new_element;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}