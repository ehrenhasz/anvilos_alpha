{
  "module_name": "argmatch.h",
  "hash_id": "959edfb571d2285144f429601e4200b23bca5f146bb3e94577b79d2159b66fcb",
  "original_prompt": "Ingested from coreutils-9.4/lib/argmatch.h",
  "human_readable_source": " \n\n#ifndef ARGMATCH_H_\n# define ARGMATCH_H_ 1\n\n \n# if !_GL_CONFIG_H_INCLUDED\n#  error \"Please include config.h first.\"\n# endif\n\n# include <limits.h>\n# include <stddef.h>\n# include <stdio.h>\n# include <string.h>  \n\n# include \"gettext.h\"\n# include \"quote.h\"\n\n# ifdef  __cplusplus\nextern \"C\" {\n# endif\n\n# define ARRAY_CARDINALITY(Array) (sizeof (Array) / sizeof *(Array))\n\n \n\n# define ARGMATCH_VERIFY(Arglist, Vallist) \\\n    static_assert (ARRAY_CARDINALITY (Arglist) \\\n                   == ARRAY_CARDINALITY (Vallist) + 1)\n\n \n\nptrdiff_t argmatch (char const *arg, char const *const *arglist,\n                    void const *vallist, size_t valsize) _GL_ATTRIBUTE_PURE;\n\nptrdiff_t argmatch_exact (char const *arg, char const *const *arglist)\n  _GL_ATTRIBUTE_PURE;\n\n# define ARGMATCH(Arg, Arglist, Vallist) \\\n  argmatch (Arg, Arglist, (void const *) (Vallist), sizeof *(Vallist))\n\n# define ARGMATCH_EXACT(Arg, Arglist) \\\n  argmatch_exact (Arg, Arglist)\n\n \ntypedef void (*argmatch_exit_fn) (void);\nextern argmatch_exit_fn argmatch_die;\n\n \n\nvoid argmatch_invalid (char const *context, char const *value,\n                       ptrdiff_t problem);\n\n \n\n# define invalid_arg(Context, Value, Problem) \\\n  argmatch_invalid (Context, Value, Problem)\n\n\n\n \n\nvoid argmatch_valid (char const *const *arglist,\n                     void const *vallist, size_t valsize);\n\n# define ARGMATCH_VALID(Arglist, Vallist) \\\n  argmatch_valid (Arglist, (void const *) (Vallist), sizeof *(Vallist))\n\n\n\n \n\nptrdiff_t __xargmatch_internal (char const *context,\n                                char const *arg, char const *const *arglist,\n                                void const *vallist, size_t valsize,\n                                argmatch_exit_fn exit_fn,\n                                bool allow_abbreviation);\n\n \n\n# define XARGMATCH(Context, Arg, Arglist, Vallist)              \\\n  ((Vallist) [__xargmatch_internal (Context, Arg, Arglist,      \\\n                                    (void const *) (Vallist),   \\\n                                    sizeof *(Vallist),          \\\n                                    argmatch_die,               \\\n                                    true)])\n\n# define XARGMATCH_EXACT(Context, Arg, Arglist, Vallist)        \\\n  ((Vallist) [__xargmatch_internal (Context, Arg, Arglist,      \\\n                                    (void const *) (Vallist),   \\\n                                    sizeof *(Vallist),          \\\n                                    argmatch_die,               \\\n                                    false)])\n\n \n\nchar const *argmatch_to_argument (void const *value,\n                                  char const *const *arglist,\n                                  void const *vallist, size_t valsize)\n  _GL_ATTRIBUTE_PURE;\n\n# define ARGMATCH_TO_ARGUMENT(Value, Arglist, Vallist)                  \\\n  argmatch_to_argument (Value, Arglist,                                 \\\n                        (void const *) (Vallist), sizeof *(Vallist))\n\n# define ARGMATCH_DEFINE_GROUP(Name, Type)                              \\\n                             \\\n  typedef Type argmatch_##Name##_type;                                  \\\n                                                                        \\\n                  \\\n  enum argmatch_##Name##_size_enum                                      \\\n  {                                                                     \\\n    argmatch_##Name##_size = sizeof (argmatch_##Name##_type)            \\\n  };                                                                    \\\n                                                                        \\\n                                   \\\n  typedef struct                                                        \\\n  {                                                                     \\\n                                        \\\n    const char *arg;                                                    \\\n                                     \\\n    const argmatch_##Name##_type val;                                   \\\n  } argmatch_##Name##_arg;                                              \\\n                                                                        \\\n                                      \\\n  typedef struct                                                        \\\n  {                                                                     \\\n                                        \\\n    const char *arg;                                                    \\\n           \\\n    const char *doc;                                                    \\\n  } argmatch_##Name##_doc;                                              \\\n                                                                        \\\n                            \\\n  typedef struct                                                        \\\n  {                                                                     \\\n    const argmatch_##Name##_arg* args;                                  \\\n    const argmatch_##Name##_doc* docs;                                  \\\n                                                                        \\\n                                 \\\n    const char *doc_pre;                                                \\\n                                  \\\n    const char *doc_post;                                               \\\n  } argmatch_##Name##_group_type;                                       \\\n                                                                        \\\n                                \\\n  extern const argmatch_##Name##_group_type argmatch_##Name##_group;    \\\n                                                                        \\\n                            \\\n  void argmatch_##Name##_usage (FILE *out);                             \\\n                                                                        \\\n         \\\n  ptrdiff_t argmatch_##Name##_choice (const char *arg);                 \\\n                                                                        \\\n                                                    \\\n  const argmatch_##Name##_type*                                         \\\n  argmatch_##Name##_value (const char *context, const char *arg);       \\\n                                                                        \\\n      \\\n  const char *                                                          \\\n  argmatch_##Name##_argument (const argmatch_##Name##_type *val);       \\\n                                                                        \\\n  ptrdiff_t                                                             \\\n  argmatch_##Name##_choice (const char *arg)                            \\\n  {                                                                     \\\n    const argmatch_##Name##_group_type *g = &argmatch_##Name##_group;   \\\n    size_t size = argmatch_##Name##_size;                               \\\n    ptrdiff_t res = -1;             \\\n    bool ambiguous = false;    \\\n    size_t arglen = strlen (arg);                                       \\\n                                                                        \\\n                                                          \\\n    for (size_t i = 0; g->args[i].arg; i++)                             \\\n      if (!strncmp (g->args[i].arg, arg, arglen))                       \\\n        {                                                               \\\n          if (strlen (g->args[i].arg) == arglen)                        \\\n                                                \\\n            return i;                                                   \\\n          else if (res == -1)                                           \\\n                                       \\\n            res = i;                                                    \\\n          else if (memcmp (&g->args[res].val, &g->args[i].val, size))   \\\n                                      \\\n                                                      \\\n            ambiguous = true;                                           \\\n        }                                                               \\\n    return ambiguous ? -2 : res;                                        \\\n  }                                                                     \\\n                                                                        \\\n  const char *                                                          \\\n  argmatch_##Name##_argument (const argmatch_##Name##_type *val)        \\\n  {                                                                     \\\n    const argmatch_##Name##_group_type *g = &argmatch_##Name##_group;   \\\n    size_t size = argmatch_##Name##_size;                               \\\n    for (size_t i = 0; g->args[i].arg; i++)                             \\\n      if (!memcmp (val, &g->args[i].val, size))                         \\\n        return g->args[i].arg;                                          \\\n    return NULL;                                                        \\\n  }                                                                     \\\n                                                                        \\\n                               \\\n  static void                                                           \\\n  argmatch_##Name##_valid (FILE *out)                                   \\\n  {                                                                     \\\n    const argmatch_##Name##_group_type *g = &argmatch_##Name##_group;   \\\n    size_t size = argmatch_##Name##_size;                               \\\n                                                                        \\\n                                              \\\n    fputs (gettext (\"Valid arguments are:\"), out);                      \\\n    for (int i = 0; g->args[i].arg; i++)                                \\\n      if (i == 0                                                        \\\n          || memcmp (&g->args[i-1].val, &g->args[i].val, size))         \\\n        fprintf (out, \"\\n  - %s\", quote (g->args[i].arg));              \\\n      else                                                              \\\n        fprintf (out, \", %s\", quote (g->args[i].arg));                  \\\n    putc ('\\n', out);                                                   \\\n  }                                                                     \\\n                                                                        \\\n  const argmatch_##Name##_type*                                         \\\n  argmatch_##Name##_value (const char *context, const char *arg)        \\\n  {                                                                     \\\n    const argmatch_##Name##_group_type *g = &argmatch_##Name##_group;   \\\n    ptrdiff_t res = argmatch_##Name##_choice (arg);                     \\\n    if (res < 0)                                                        \\\n      {                                                                 \\\n        argmatch_invalid (context, arg, res);                           \\\n        argmatch_##Name##_valid (stderr);                               \\\n        argmatch_die ();                                                \\\n      }                                                                 \\\n    return &g->args[res].val;                                           \\\n  }                                                                     \\\n                                                                        \\\n                        \\\n  static int                                                            \\\n  argmatch_##Name##_doc_col (void)                                      \\\n  {                                                                     \\\n    const argmatch_##Name##_group_type *g = &argmatch_##Name##_group;   \\\n    size_t size = argmatch_##Name##_size;                               \\\n    int res = 0;                                                        \\\n    for (int i = 0; g->docs[i].arg; ++i)                                \\\n      {                                                                 \\\n        int col = 4;                                                    \\\n        int ival = argmatch_##Name##_choice (g->docs[i].arg);           \\\n        if (ival < 0)                                                   \\\n                                       \\\n          col += strlen (g->docs[i].arg);                               \\\n        else                                                            \\\n                    \\\n          for (int j = 0; g->args[j].arg; ++j)                          \\\n            if (! memcmp (&g->args[ival].val, &g->args[j].val, size))   \\\n              col += (col == 4 ? 0 : 2) + strlen (g->args[j].arg);      \\\n        if (res <= col)                                                 \\\n          res = col <= 20 ? col : 20;                                   \\\n      }                                                                 \\\n    return res ? res : 20;                                              \\\n  }                                                                     \\\n                                                                        \\\n  void                                                                  \\\n  argmatch_##Name##_usage (FILE *out)                                   \\\n  {                                                                     \\\n    const argmatch_##Name##_group_type *g = &argmatch_##Name##_group;   \\\n    size_t size = argmatch_##Name##_size;                               \\\n                                                       \\\n    const int screen_width = getenv (\"HELP2MAN\") ? INT_MAX : 80;        \\\n    if (g->doc_pre)                                                     \\\n      fprintf (out, \"%s\\n\", gettext (g->doc_pre));                      \\\n    int doc_col = argmatch_##Name##_doc_col ();                         \\\n    for (int i = 0; g->docs[i].arg; ++i)                                \\\n      {                                                                 \\\n        int col = 0;                                                    \\\n        bool first = true;                                              \\\n        int ival = argmatch_##Name##_choice (g->docs[i].arg);           \\\n        if (ival < 0)                                                   \\\n                                       \\\n          col += fprintf (out,  \"  %s\", g->docs[i].arg);                \\\n        else                                                            \\\n                    \\\n          for (int j = 0; g->args[j].arg; ++j)                          \\\n            if (! memcmp (&g->args[ival].val, &g->args[j].val, size))   \\\n              {                                                         \\\n                if (!first                                              \\\n                    && screen_width < col + 2 + strlen (g->args[j].arg)) \\\n                  {                                                     \\\n                    fprintf (out, \",\\n\");                               \\\n                    col = 0;                                            \\\n                    first = true;                                       \\\n                  }                                                     \\\n                if (first)                                              \\\n                  {                                                     \\\n                    col += fprintf (out, \" \");                          \\\n                    first = false;                                      \\\n                  }                                                     \\\n                else                                                    \\\n                  col += fprintf (out, \",\");                            \\\n                col += fprintf (out,  \" %s\", g->args[j].arg);           \\\n              }                                                         \\\n                        \\\n        if (doc_col < col + 2)                                          \\\n          {                                                             \\\n            fprintf (out, \"\\n\");                                        \\\n            col = 0;                                                    \\\n          }                                                             \\\n        fprintf (out, \"%*s%s\\n\",                                        \\\n                 doc_col - col, \"\", gettext (g->docs[i].doc));          \\\n      }                                                                 \\\n    if (g->doc_post)                                                    \\\n      fprintf (out, \"%s\\n\", gettext (g->doc_post));                     \\\n  }\n\n# ifdef  __cplusplus\n}\n# endif\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}