{
  "module_name": "fflush.c",
  "hash_id": "539c8c4a1508f861188e0f62b6ddf5cefa1f7ce799cc5c808f610448364328e0",
  "original_prompt": "Ingested from coreutils-9.4/lib/fflush.c",
  "human_readable_source": " \n\n#include <config.h>\n\n \n#include <stdio.h>\n\n#include <errno.h>\n#include <unistd.h>\n\n#include \"freading.h\"\n\n#include \"stdio-impl.h\"\n\n#undef fflush\n\n\n#if defined _IO_EOF_SEEN || defined _IO_ftrylockfile || __GNU_LIBRARY__ == 1\n \n\n \nstatic void\nclear_ungetc_buffer_preserving_position (FILE *fp)\n{\n  if (fp->_flags & _IO_IN_BACKUP)\n     \n    fseeko (fp, 0, SEEK_CUR);\n}\n\n#else\n\n \nstatic void\nclear_ungetc_buffer (FILE *fp)\n{\n# if defined __sferror || defined __DragonFly__ || defined __ANDROID__\n   \n  if (HASUB (fp))\n    {\n      fp_->_p += fp_->_r;\n      fp_->_r = 0;\n    }\n# elif defined __EMX__               \n  if (fp->_ungetc_count > 0)\n    {\n      fp->_ungetc_count = 0;\n      fp->_rcount = - fp->_rcount;\n    }\n# elif defined _IOERR                \n   \n# else                               \n  fseeko (fp, 0, SEEK_CUR);\n# endif\n}\n\n#endif\n\n#if ! (defined _IO_EOF_SEEN || defined _IO_ftrylockfile || __GNU_LIBRARY__ == 1)\n \n\n# if (defined __sferror || defined __DragonFly__ || defined __ANDROID__) && defined __SNPT\n \n\nstatic int\ndisable_seek_optimization (FILE *fp)\n{\n  int saved_flags = fp_->_flags & (__SOPT | __SNPT);\n  fp_->_flags = (fp_->_flags & ~__SOPT) | __SNPT;\n  return saved_flags;\n}\n\nstatic void\nrestore_seek_optimization (FILE *fp, int saved_flags)\n{\n  fp_->_flags = (fp_->_flags & ~(__SOPT | __SNPT)) | saved_flags;\n}\n\n# else\n\nstatic void\nupdate_fpos_cache (_GL_ATTRIBUTE_MAYBE_UNUSED FILE *fp,\n                   _GL_ATTRIBUTE_MAYBE_UNUSED off_t pos)\n{\n#  if defined __sferror || defined __DragonFly__ || defined __ANDROID__\n   \n#   if defined __CYGWIN__ || defined __ANDROID__\n   \n  fp_->_offset = pos;\n#   else\n   \n   \n  union\n    {\n      fpos_t f;\n      off_t o;\n    } u;\n  u.o = pos;\n  fp_->_offset = u.f;\n#   endif\n  fp_->_flags |= __SOFF;\n#  endif\n}\n# endif\n#endif\n\n \nint\nrpl_fflush (FILE *stream)\n{\n   \n  if (stream == NULL || ! freading (stream))\n    return fflush (stream);\n\n#if defined _IO_EOF_SEEN || defined _IO_ftrylockfile || __GNU_LIBRARY__ == 1\n   \n\n  clear_ungetc_buffer_preserving_position (stream);\n\n  return fflush (stream);\n\n#else\n  {\n     \n\n     \n    off_t pos = ftello (stream);\n    if (pos == -1)\n      {\n        errno = EBADF;\n        return EOF;\n      }\n\n     \n    clear_ungetc_buffer (stream);\n\n     \n    {\n      int result = fpurge (stream);\n      if (result != 0)\n        return result;\n    }\n\n# if (defined __sferror || defined __DragonFly__ || defined __ANDROID__) && defined __SNPT\n     \n\n    {\n       \n      int saved_flags = disable_seek_optimization (stream);\n      int result = fseeko (stream, pos, SEEK_SET);\n\n      restore_seek_optimization (stream, saved_flags);\n      return result;\n    }\n\n# else\n\n    pos = lseek (fileno (stream), pos, SEEK_SET);\n    if (pos == -1)\n      return EOF;\n     \n    update_fpos_cache (stream, pos);\n\n    return 0;\n\n# endif\n  }\n#endif\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}