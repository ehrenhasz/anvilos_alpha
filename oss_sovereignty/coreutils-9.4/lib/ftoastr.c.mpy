{
  "module_name": "ftoastr.c",
  "hash_id": "659cb3572f00e80ddd871d0743e345581f9cd1b71d3068a523f361a7610809f9",
  "original_prompt": "Ingested from coreutils-9.4/lib/ftoastr.c",
  "human_readable_source": " \n\n \n\n#include <config.h>\n\n#include \"ftoastr.h\"\n\n#include <float.h>\n#include <stdio.h>\n#include <stdlib.h>\n\n#ifdef C_LOCALE\n# include \"c-snprintf.h\"\n# include \"c-strtod.h\"\n# define PREFIX(name) c_ ## name\n#else\n# define PREFIX(name) name\n#endif\n\n#if LENGTH == 3\n# define FLOAT long double\n# define FLOAT_DIG LDBL_DIG\n# define FLOAT_MIN LDBL_MIN\n# define FLOAT_PREC_BOUND _GL_LDBL_PREC_BOUND\n# define FTOASTR PREFIX (ldtoastr)\n# define PROMOTED_FLOAT long double\n# define STRTOF PREFIX (strtold)\n#elif LENGTH == 2\n# define FLOAT double\n# define FLOAT_DIG DBL_DIG\n# define FLOAT_MIN DBL_MIN\n# define FLOAT_PREC_BOUND _GL_DBL_PREC_BOUND\n# define FTOASTR PREFIX (dtoastr)\n# define PROMOTED_FLOAT double\n#else\n# define LENGTH 1\n# define FLOAT float\n# define FLOAT_DIG FLT_DIG\n# define FLOAT_MIN FLT_MIN\n# define FLOAT_PREC_BOUND _GL_FLT_PREC_BOUND\n# define FTOASTR PREFIX (ftoastr)\n# define PROMOTED_FLOAT double\n# if HAVE_STRTOF\n#  define STRTOF strtof\n# endif\n#endif\n\n \n#ifndef STRTOF\n# define STRTOF PREFIX (strtod)\n#endif\n\n \n#ifdef C_LOCALE\n# undef snprintf\n# define snprintf c_snprintf\n#elif ! GNULIB_SNPRINTF\n# undef snprintf\n# define snprintf ftoastr_snprintf\nstatic int\nftoastr_snprintf (char *buf, size_t bufsize, char const *format,\n                  int width, int prec, FLOAT x)\n{\n  PROMOTED_FLOAT promoted_x = x;\n  char width_0_buffer[LENGTH == 1 ? FLT_BUFSIZE_BOUND\n                      : LENGTH == 2 ? DBL_BUFSIZE_BOUND\n                      : LDBL_BUFSIZE_BOUND];\n  int n = width;\n  if (bufsize < sizeof width_0_buffer)\n    {\n      n = sprintf (width_0_buffer, format, 0, prec, promoted_x);\n      if (n < 0)\n        return n;\n      if (n < width)\n        n = width;\n    }\n  if (n < bufsize)\n    n = sprintf (buf, format, width, prec, promoted_x);\n  return n;\n}\n#endif\n\nint\nFTOASTR (char *buf, size_t bufsize, int flags, int width, FLOAT x)\n{\n   \n\n  PROMOTED_FLOAT promoted_x = x;\n  char format[sizeof \"%-+ 0*.*Lg\"];\n  FLOAT abs_x = x < 0 ? -x : x;\n  int prec;\n\n  char *p = format;\n  *p++ = '%';\n\n   \n  *p = '-'; p += (flags & FTOASTR_LEFT_JUSTIFY  ) != 0;\n  *p = '+'; p += (flags & FTOASTR_ALWAYS_SIGNED ) != 0;\n  *p = ' '; p += (flags & FTOASTR_SPACE_POSITIVE) != 0;\n  *p = '0'; p += (flags & FTOASTR_ZERO_PAD      ) != 0;\n\n  *p++ = '*';\n  *p++ = '.';\n  *p++ = '*';\n  *p = 'L'; p += 2 < LENGTH;\n  *p++ = flags & FTOASTR_UPPER_E ? 'G' : 'g';\n  *p = '\\0';\n\n  for (prec = abs_x < FLOAT_MIN ? 1 : FLOAT_DIG; ; prec++)\n    {\n      int n = snprintf (buf, bufsize, format, width, prec, promoted_x);\n      if (n < 0\n          || FLOAT_PREC_BOUND <= prec\n          || (n < bufsize && STRTOF (buf, NULL) == x))\n        return n;\n    }\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}