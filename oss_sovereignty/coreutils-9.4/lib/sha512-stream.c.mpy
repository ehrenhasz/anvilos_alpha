{
  "module_name": "sha512-stream.c",
  "hash_id": "99dc627a2b533c25b6441e9ed691e89cf54d55ed5a90d8dfe964628ab90d75cf",
  "original_prompt": "Ingested from coreutils-9.4/lib/sha512-stream.c",
  "human_readable_source": " \n\n#include <config.h>\n\n \n#if HAVE_OPENSSL_SHA512\n# define GL_OPENSSL_INLINE _GL_EXTERN_INLINE\n#endif\n#include \"sha512.h\"\n\n#include <stdlib.h>\n\n#if USE_UNLOCKED_IO\n# include \"unlocked-io.h\"\n#endif\n\n#include \"af_alg.h\"\n\n#define BLOCKSIZE 32768\n#if BLOCKSIZE % 128 != 0\n# error \"invalid BLOCKSIZE\"\n#endif\n\n \nstatic int\nshaxxx_stream (FILE *stream, char const *alg, void *resblock,\n               ssize_t hashlen, void (*init_ctx) (struct sha512_ctx *),\n               void *(*finish_ctx) (struct sha512_ctx *, void *))\n{\n  switch (afalg_stream (stream, alg, resblock, hashlen))\n    {\n    case 0: return 0;\n    case -EIO: return 1;\n    }\n\n  char *buffer = malloc (BLOCKSIZE + 72);\n  if (!buffer)\n    return 1;\n\n  struct sha512_ctx ctx;\n  init_ctx (&ctx);\n  size_t sum;\n\n   \n  while (1)\n    {\n       \n      size_t n;\n      sum = 0;\n\n       \n      while (1)\n        {\n           \n          if (feof (stream))\n            goto process_partial_block;\n\n          n = fread (buffer + sum, 1, BLOCKSIZE - sum, stream);\n\n          sum += n;\n\n          if (sum == BLOCKSIZE)\n            break;\n\n          if (n == 0)\n            {\n               \n              if (ferror (stream))\n                {\n                  free (buffer);\n                  return 1;\n                }\n              goto process_partial_block;\n            }\n        }\n\n       \n      sha512_process_block (buffer, BLOCKSIZE, &ctx);\n    }\n\n process_partial_block:;\n\n   \n  if (sum > 0)\n    sha512_process_bytes (buffer, sum, &ctx);\n\n   \n  finish_ctx (&ctx, resblock);\n  free (buffer);\n  return 0;\n}\n\nint\nsha512_stream (FILE *stream, void *resblock)\n{\n  return shaxxx_stream (stream, \"sha512\", resblock, SHA512_DIGEST_SIZE,\n                        sha512_init_ctx, sha512_finish_ctx);\n}\n\nint\nsha384_stream (FILE *stream, void *resblock)\n{\n  return shaxxx_stream (stream, \"sha384\", resblock, SHA384_DIGEST_SIZE,\n                        sha384_init_ctx, sha384_finish_ctx);\n}\n\n \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}