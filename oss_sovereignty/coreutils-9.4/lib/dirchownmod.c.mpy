{
  "module_name": "dirchownmod.c",
  "hash_id": "d79ae7f55fc2f64a7626bdff32dbc26070a342f7c3d45af66ca49c1417744649",
  "original_prompt": "Ingested from coreutils-9.4/lib/dirchownmod.c",
  "human_readable_source": " \n\n#include <config.h>\n\n#include \"dirchownmod.h\"\n\n#include <errno.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <unistd.h>\n\n#include \"stat-macros.h\"\n\n#ifndef HAVE_FCHMOD\n# define HAVE_FCHMOD 0\n# undef fchmod\n# define fchmod(fd, mode) (-1)\n#endif\n\n \n\nint\ndirchownmod (int fd, char const *dir, mode_t mkdir_mode,\n             uid_t owner, gid_t group,\n             mode_t mode, mode_t mode_bits)\n{\n  struct stat st;\n  int result = (fd < 0 ? stat (dir, &st) : fstat (fd, &st));\n\n  if (result == 0)\n    {\n      mode_t dir_mode = st.st_mode;\n\n       \n      if (! S_ISDIR (dir_mode))\n        {\n          errno = ENOTDIR;\n          result = -1;\n        }\n      else\n        {\n           \n          mode_t indeterminate = 0;\n\n           \n\n          if ((owner != (uid_t) -1 && owner != st.st_uid)\n              || (group != (gid_t) -1 && group != st.st_gid))\n            {\n              result = (0 <= fd\n                        ? fchown (fd, owner, group)\n                        : mkdir_mode != (mode_t) -1\n                        ? lchown (dir, owner, group)\n                        : chown (dir, owner, group));\n\n               \n\n              if (result == 0 && (dir_mode & S_IXUGO))\n                indeterminate = dir_mode & (S_ISUID | S_ISGID);\n            }\n\n           \n          if (result == 0 && (((dir_mode ^ mode) | indeterminate) & mode_bits))\n            {\n              mode_t chmod_mode =\n                mode | (dir_mode & CHMOD_MODE_BITS & ~mode_bits);\n              result = (HAVE_FCHMOD && 0 <= fd\n                        ? fchmod (fd, chmod_mode)\n                        : mkdir_mode != (mode_t) -1\n                        ? lchmod (dir, chmod_mode)\n                        : chmod (dir, chmod_mode));\n            }\n        }\n    }\n\n  if (0 <= fd)\n    {\n      if (result == 0)\n        result = close (fd);\n      else\n        {\n          int e = errno;\n          close (fd);\n          errno = e;\n        }\n    }\n\n  return result;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}