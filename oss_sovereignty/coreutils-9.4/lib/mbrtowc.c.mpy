{
  "module_name": "mbrtowc.c",
  "hash_id": "c56faed6cd4f6bd832c67ebc10244972f64ff5cf971d4b399259ee9e37077652",
  "original_prompt": "Ingested from coreutils-9.4/lib/mbrtowc.c",
  "human_readable_source": " \n#include <wchar.h>\n\n#if GNULIB_defined_mbstate_t\n \n\n# include <errno.h>\n# include <stdint.h>\n# include <stdlib.h>\n\n# if defined _WIN32 && !defined __CYGWIN__\n\n#  define WIN32_LEAN_AND_MEAN   \n#  include <windows.h>\n\n# elif HAVE_PTHREAD_API\n\n#  include <pthread.h>\n#  if HAVE_THREADS_H && HAVE_WEAK_SYMBOLS\n#   include <threads.h>\n#   pragma weak thrd_exit\n#   define c11_threads_in_use() (thrd_exit != NULL)\n#  else\n#   define c11_threads_in_use() 0\n#  endif\n\n# elif HAVE_THREADS_H\n\n#  include <threads.h>\n\n# endif\n\n# include \"attribute.h\"\n# include \"lc-charset-dispatch.h\"\n# include \"mbtowc-lock.h\"\n\nstatic_assert (sizeof (mbstate_t) >= 4);\nstatic char internal_state[4];\n\nsize_t\nmbrtowc (wchar_t *pwc, const char *s, size_t n, mbstate_t *ps)\n{\n# define FITS_IN_CHAR_TYPE(wc)  ((wc) <= WCHAR_MAX)\n# include \"mbrtowc-impl.h\"\n}\n\n#else\n \n\n# if MBRTOWC_IN_C_LOCALE_MAYBE_EILSEQ\n#  include \"hard-locale.h\"\n#  include <locale.h>\n# endif\n\n# undef mbrtowc\n\nsize_t\nrpl_mbrtowc (wchar_t *pwc, const char *s, size_t n, mbstate_t *ps)\n{\n  size_t ret;\n  wchar_t wc;\n\n# if MBRTOWC_NULL_ARG2_BUG || MBRTOWC_RETVAL_BUG || MBRTOWC_EMPTY_INPUT_BUG\n  if (s == NULL)\n    {\n      pwc = NULL;\n      s = \"\";\n      n = 1;\n    }\n# endif\n\n# if MBRTOWC_EMPTY_INPUT_BUG\n  if (n == 0)\n    return (size_t) -2;\n# endif\n\n  if (! pwc)\n    pwc = &wc;\n\n# if MBRTOWC_RETVAL_BUG\n  {\n    static mbstate_t internal_state;\n\n     \n    if (ps == NULL)\n      ps = &internal_state;\n\n    if (!mbsinit (ps))\n      {\n         \n        size_t count = 0;\n        for (; n > 0; s++, n--)\n          {\n            ret = mbrtowc (&wc, s, 1, ps);\n\n            if (ret == (size_t)(-1))\n              return (size_t)(-1);\n            count++;\n            if (ret != (size_t)(-2))\n              {\n                 \n                *pwc = wc;\n                return (wc == 0 ? 0 : count);\n              }\n          }\n        return (size_t)(-2);\n      }\n  }\n# endif\n\n# if MBRTOWC_STORES_INCOMPLETE_BUG\n  ret = mbrtowc (&wc, s, n, ps);\n  if (ret < (size_t) -2 && pwc != NULL)\n    *pwc = wc;\n# else\n  ret = mbrtowc (pwc, s, n, ps);\n# endif\n\n# if MBRTOWC_NUL_RETVAL_BUG\n  if (ret < (size_t) -2 && !*pwc)\n    return 0;\n# endif\n\n# if MBRTOWC_IN_C_LOCALE_MAYBE_EILSEQ\n  if ((size_t) -2 <= ret && n != 0 && ! hard_locale (LC_CTYPE))\n    {\n      unsigned char uc = *s;\n      *pwc = uc;\n      return 1;\n    }\n# endif\n\n  return ret;\n}\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}