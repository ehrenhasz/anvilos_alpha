{
  "module_name": "gen-single-binary.sh",
  "hash_id": "9795b4145b635ed3217e39c85c8533cb5d827bae9557ec5ebdc41feb62c1dd74",
  "original_prompt": "Ingested from coreutils-9.4/build-aux/gen-single-binary.sh",
  "human_readable_source": "#!/bin/sh\n\n# Generate the list of rules for the single-binary option based on all the other\n# binaries found in src/local.mk.\n#\n# We need to duplicate the specific rules to build each program into a new\n# static library target. We can't reuse the existing target since we need to\n# create a .a file instead of linking the program. We can't do this at\n# ./configure since the file names need to be available when automake runs\n# to let it generate all the required rules in Makefile.in.  The configure\n# step will select which ones will be used to build, but they need to be\n# generated beforehand.\n#\n# Instead of maintaining a duplicated list of rules, we generate the\n# single-binary required rules based on the normal configuration found on\n# src/local.mk with this script.\n\nif test \"x$1\" = \"x\"; then\n  echo \"Usage: $0 path/to/src/local.mk\" >&2\n  exit 1\nfi\n\nset -e\n\nLOCAL_MK=$1\nGEN_LISTS_OF_PROGRAMS=\"`dirname \"$0\"`/gen-lists-of-programs.sh\"\n\nALL_PROGRAMS=$($GEN_LISTS_OF_PROGRAMS --list-progs \\\n    | grep -v -F -e coreutils -e libstdbuf.so \\\n    | tr '[' '_')\n\n# Compute default SOURCES. automake will assume the source file for the\n# src_${cmd} target to be src/${cmd}.c, but we will add rules to generate\n# the lib src_libsinglebin_${cmd}_a which won't match the autogenerated source\n# file. This loop will initialize the default source file and will be reset\n# later if needed.\nfor cmd in $ALL_PROGRAMS; do\n  eval \"src_${cmd}_SOURCES=src/${cmd}.c\"\ndone\n\n# Load actual values from src/local.mk. This will read all the variables from\n# the local.mk matching the src_${cmd}_... case.\nwhile read l; do\n  if echo \"$l\" | grep -E '^src_[_[:alnum:]]+ +\\+?=' > /dev/null; then\n    var=$(echo $l | cut -f 1 -d ' ')\n    value=$(echo $l | cut -f 2- -d =)\n    if [ \"$value\" != \" \\$(LDADD)\" ]; then\n      oldvalue=\"\"\n      if echo $l | grep -F '+=' >/dev/null; then\n        eval \"oldvalue=\\${$var}\"\n      fi\n      value=$(echo \"$value\" | sed \"s/'/'\\\"'\\\"'/g\")\n      eval \"$var='$oldvalue \"$value\"'\"\n    fi\n  fi\ndone < $LOCAL_MK\n\nme=`echo \"$0\" | sed 's,.*/,,'`\necho \"## Automatically generated by $me.  DO NOT EDIT BY HAND!\"\n\n# Override the sources for some tools, to use smaller variants\noverride_single() {\n  from=\"$1\"; to=\"$2\";\n\n  eval \"src_${from}_SOURCES='src/coreutils-${from}.c'\"\n  eval \"src_from_LDADD=\\$src_${from}_LDADD\"\n  eval \"src_${from}_LDADD='$src_from_LDADD src/libsinglebin_${to}.a'\"\n  eval \"src_libsinglebin_${from}_a_DEPENDENCIES='src/libsinglebin_${to}.a'\"\n  echo \"src_libsinglebin_${from}_a_DEPENDENCIES = src/libsinglebin_${to}.a\"\n}\noverride_single dir ls\noverride_single vdir ls\noverride_single arch uname\n\nfor cmd in $ALL_PROGRAMS; do\n  echo \"# Command $cmd\"\n  echo noinst_LIBRARIES += src/libsinglebin_${cmd}.a\n  base=\"src_libsinglebin_${cmd}_a\"\n  # SOURCES\n  var=src_${cmd}_SOURCES\n  eval \"value=\\$$var\"\n  echo \"${base}_SOURCES = $value\"\n\n  # LDADD\n  var=src_${cmd}_LDADD\n  eval \"value=\\$$var\"\n  if [ \"x$value\" != \"x\" ]; then\n    echo \"${base}_ldadd = $value\"\n  fi\n\n  # DEPENDENCIES\n  var=src_libsinglebin_${cmd}_a_DEPENDENCIES\n  eval \"value=\\$$var\"\n  if [ \"x$value\" = \"x\" ]; then\n    echo \"$var = \\$(src_${cmd}_DEPENDENCIES)\"\n  fi\n\n  # CFLAGS\n  # Hack any other program defining a main() replacing its main by\n  # single_binary_main_$PROGRAM_NAME.\n  echo \"${base}_CFLAGS = \\\"-Dmain=single_binary_main_${cmd} (int, char **);\" \\\n       \" int single_binary_main_${cmd}\\\" \" \\\n       \"-Dusage=_usage_${cmd} \\$(src_coreutils_CFLAGS)\"\n  var=src_${cmd}_CFLAGS\n  eval \"value=\\$$var\"\n  if [ \"x$value\" != \"x\" ]; then\n    echo \"${base}_CFLAGS += $value\"\n  fi\n\n  # CPPFLAGS\n  var=src_${cmd}_CPPFLAGS\n  eval \"value=\\$$var\"\n  if [ \"x$value\" != \"x\" ]; then\n    echo \"${base}_CPPFLAGS = $value\"\n  fi\ndone\n\nexit 0\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}