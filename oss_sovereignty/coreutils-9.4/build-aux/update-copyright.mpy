{
  "module_name": "update-copyright",
  "hash_id": "e43ca78b807a35981d95179ecd29ac3197aabf7da70e3e8138975dcff569f493",
  "original_prompt": "Ingested from coreutils-9.4/build-aux/update-copyright",
  "human_readable_source": "#!/bin/sh\n#! -*-perl-*-\n\n# Update an FSF copyright year list to include the current year.\n\n# Copyright (C) 2009-2023 Free Software Foundation, Inc.\n#\n# This program is free software: you can redistribute it and/or modify\n# it under the terms of the GNU General Public License as published by\n# the Free Software Foundation, either version 3, or (at your option)\n# any later version.\n#\n# This program is distributed in the hope that it will be useful,\n# but WITHOUT ANY WARRANTY; without even the implied warranty of\n# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n# GNU General Public License for more details.\n#\n# You should have received a copy of the GNU General Public License\n# along with this program.  If not, see <https://www.gnu.org/licenses/>.\n#\n# Written by Jim Meyering and Joel E. Denny\n\n# This script updates an FSF copyright year list to include the current year.\n# Usage: update-copyright [FILE...]\n#\n# The arguments to this script should be names of files that contain\n# copyright statements to be updated.  The copyright holder's name\n# defaults to \"Free Software Foundation, Inc.\" but may be changed to\n# any other name by using the \"UPDATE_COPYRIGHT_HOLDER\" environment\n# variable.\n#\n# For example, you might wish to use the update-copyright target rule\n# in maint.mk from gnulib's maintainer-makefile module.\n#\n# Iff a copyright statement is recognized in a file and the final\n# year is not the current year, then the statement is updated for the\n# new year and it is reformatted to:\n#\n#   1. Fit within 72 columns.\n#   2. Convert 2-digit years to 4-digit years by prepending \"19\".\n#   3. Expand copyright year intervals.  (See \"Environment variables\"\n#      below.)\n#\n# A warning is printed for every file for which no copyright\n# statement is recognized.\n#\n# Each file's copyright statement must be formatted correctly in\n# order to be recognized.  For example, each of these is fine:\n#\n#   Copyright @copyright{} 1990-2005, 2007-2009 Free Software\n#   Foundation, Inc.\n#\n#   # Copyright (C) 1990-2005, 2007-2009 Free Software\n#   # Foundation, Inc.\n#\n#   /*\n#    * Copyright &copy; 90,2005,2007-2009\n#    * Free Software Foundation, Inc.\n#    */\n#\n# However, the following format is not recognized because the line\n# prefix changes after the first line:\n#\n#   ## Copyright (C) 1990-2005, 2007-2009 Free Software\n#   #  Foundation, Inc.\n#\n# However, any correctly formatted copyright statement following\n# a non-matching copyright statements would be recognized.\n#\n# The exact conditions that a file's copyright statement must meet\n# to be recognized are:\n#\n#   1. It is the first copyright statement that meets all of the\n#      following conditions.  Subsequent copyright statements are\n#      ignored.\n#   2. Its format is \"Copyright (C)\", then a list of copyright years,\n#      and then the name of the copyright holder.\n#   3. The \"(C)\" takes one of the following forms or is omitted\n#      entirely:\n#\n#        A. (C)\n#        B. (c)\n#        C. @copyright{}\n#        D. &copy;\n#        E. \u00a9\n#\n#   4. The \"Copyright\" appears at the beginning of a line, except that it\n#      may be prefixed by any sequence (e.g., a comment) of no more than\n#      5 characters -- including white space.\n#   5. Iff such a prefix is present, the same prefix appears at the\n#      beginning of each remaining line within the FSF copyright\n#      statement.  There is one exception in order to support C-style\n#      comments: if the first line's prefix contains nothing but\n#      whitespace surrounding a \"/*\", then the prefix for all subsequent\n#      lines is the same as the first line's prefix except with each of\n#      \"/\" and possibly \"*\" replaced by a \" \".  The replacement of \"*\"\n#      by \" \" is consistent throughout all subsequent lines.\n#   6. Blank lines, even if preceded by the prefix, do not appear\n#      within the FSF copyright statement.\n#   7. Each copyright year is 2 or 4 digits, and years are separated by\n#      commas, \"-\", \"--\", or \"\\(en\" (for troff).  Whitespace may appear\n#      after commas.\n#\n# Environment variables:\n#\n#   1. If UPDATE_COPYRIGHT_FORCE=1, a recognized FSF copyright statement\n#      is reformatted even if it does not need updating for the new\n#      year.  If unset or set to 0, only updated FSF copyright\n#      statements are reformatted.\n#   2. If UPDATE_COPYRIGHT_USE_INTERVALS=1, every series of consecutive\n#      copyright years (such as 90, 1991, 1992-2007, 2008) in a\n#      reformatted FSF copyright statement is collapsed to a single\n#      interval (such as 1990-2008).  If unset or set to 0, all existing\n#      copyright year intervals in a reformatted FSF copyright statement\n#      are expanded instead.\n#      If UPDATE_COPYRIGHT_USE_INTERVALS=2, convert a sequence with gaps\n#      to the minimal containing range.  For example, convert\n#      2000, 2004-2007, 2009 to 2000-2009.\n#   3. For testing purposes, you can set the assumed current year in\n#      UPDATE_COPYRIGHT_YEAR.\n#   4. The default maximum line length for a copyright line is 72.\n#      Set UPDATE_COPYRIGHT_MAX_LINE_LENGTH to use a different length.\n#   5. Set UPDATE_COPYRIGHT_HOLDER if the copyright holder is other\n#      than \"Free Software Foundation, Inc.\".\n\n# This is a prologue that allows to run a perl script as an executable\n# on systems that are compliant to a POSIX version before POSIX:2017.\n# On such systems, the usual invocation of an executable through execlp()\n# or execvp() fails with ENOEXEC if it is a script that does not start\n# with a #! line.  The script interpreter mentioned in the #! line has\n# to be /bin/sh, because on GuixSD systems that is the only program that\n# has a fixed file name.  The second line is essential for perl and is\n# also useful for editing this file in Emacs.  The next two lines below\n# are valid code in both sh and perl.  When executed by sh, they re-execute\n# the script through the perl program found in $PATH.  The '-x' option\n# is essential as well; without it, perl would re-execute the script\n# through /bin/sh.  When executed by perl, the next two lines are a no-op.\neval 'exec perl -wSx -0777 -pi \"$0\" \"$@\"'\n     if 0;\n\nmy $VERSION = '2023-06-18.01:14'; # UTC\n# The definition above must lie within the first 8 lines in order\n# for the Emacs time-stamp write hook (at end) to update it.\n# If you change this file with Emacs, please let the write hook\n# do its job.  Otherwise, update this string manually.\n\nuse strict;\nuse warnings;\n\nmy $copyright_re = 'Copyright';\nmy $circle_c_re = '(?:\\([cC]\\)|@copyright\\{}|\\\\\\\\\\(co|&copy;|\u00a9)';\nmy $ndash_re = '(?:--?|\\\\\\\\\\(en)';\nmy $holder = $ENV{UPDATE_COPYRIGHT_HOLDER};\n$holder ||= 'Free Software Foundation, Inc.';\nmy $prefix_max = 5;\nmy $margin = $ENV{UPDATE_COPYRIGHT_MAX_LINE_LENGTH};\n!$margin || $margin !~ m/^\\d+$/\n  and $margin = 72;\n\nmy $tab_width = 8;\n\nmy $this_year = $ENV{UPDATE_COPYRIGHT_YEAR};\nif (!$this_year || $this_year !~ m/^\\d{4}$/)\n  {\n    my ($sec, $min, $hour, $mday, $month, $year) = localtime (time ());\n    $this_year = $year + 1900;\n  }\n\n# Unless the file consistently uses \"\\r\\n\" as the EOL, use \"\\n\" instead.\nmy $eol = /(?:^|[^\\r])\\n/ ? \"\\n\" : \"\\r\\n\";\n\nmy $leading;\nmy $prefix;\nmy $ws_re;\nmy $stmt_re;\nwhile (/(^|\\n)(.{0,$prefix_max})$copyright_re/g)\n  {\n    $leading = \"$1$2\";\n    $prefix = $2;\n    if ($prefix =~ /^(\\s*\\/)\\*(\\s*)$/)\n      {\n        $prefix =~ s,/, ,;\n        my $prefix_ws = $prefix;\n        $prefix_ws =~ s/\\*/ /; # Only whitespace.\n        if (/\\G(?:[^*\\n]|\\*[^\\/\\n])*\\*?\\n$prefix_ws/)\n          {\n            $prefix = $prefix_ws;\n          }\n      }\n    $ws_re = '[ \\t\\r\\f]'; # \\s without \\n\n    $ws_re =\n      \"(?:$ws_re*(?:$ws_re|\\\\n\" . quotemeta($prefix) . \")$ws_re*)\";\n    my $holder_re = $holder;\n    $holder_re =~ s/\\s/$ws_re/g;\n    my $stmt_remainder_re =\n      \"(?:$ws_re$circle_c_re)?\"\n      . \"$ws_re(?:(?:\\\\d\\\\d)?\\\\d\\\\d(?:,$ws_re?|$ndash_re))*\"\n      . \"((?:\\\\d\\\\d)?\\\\d\\\\d)$ws_re$holder_re\";\n    if (/\\G$stmt_remainder_re/)\n      {\n        $stmt_re =\n          quotemeta($leading) . \"($copyright_re$stmt_remainder_re)\";\n        last;\n      }\n  }\nif (defined $stmt_re)\n  {\n    /$stmt_re/ or die; # Should never die.\n    my $stmt = $1;\n    my $final_year_orig = $2;\n\n    # Handle two-digit year numbers like \"98\" and \"99\".\n    my $final_year = $final_year_orig;\n    $final_year <= 99\n      and $final_year += 1900;\n\n    if ($final_year != $this_year)\n      {\n        # Update the year.\n        $stmt =~ s/(^|[^\\d])$final_year_orig\\b/$1$final_year, $this_year/;\n      }\n    if ($final_year != $this_year || $ENV{'UPDATE_COPYRIGHT_FORCE'})\n      {\n        # Normalize all whitespace including newline-prefix sequences.\n        $stmt =~ s/$ws_re/ /g;\n\n        # Put spaces after commas.\n        $stmt =~ s/, ?/, /g;\n\n        # Convert 2-digit to 4-digit years.\n        $stmt =~ s/(\\b\\d\\d\\b)/19$1/g;\n\n        # Make the use of intervals consistent.\n        if (!$ENV{UPDATE_COPYRIGHT_USE_INTERVALS})\n          {\n            $stmt =~ s/(\\d{4})$ndash_re(\\d{4})/join(', ', $1..$2)/eg;\n          }\n        else\n          {\n            my $ndash = ($ARGV =~ /\\.tex(i(nfo)?)?$/ ? \"--\"\n                         : $ARGV =~ /\\.(\\d[a-z]*|man)$/ ? \"\\\\(en\"\n                         : \"-\");\n\n            $stmt =~\n              s/\n                (\\d{4})\n                (?:\n                  (,\\ |$ndash_re)\n                  ((??{\n                    if   ($2 ne ', ') { '\\d{4}'; }\n                    elsif (!$3)       { $1 + 1;  }\n                    else              { $3 + 1;  }\n                  }))\n                )+\n              /$1$ndash$3/gx;\n\n            # When it's 2, emit a single range encompassing all year numbers.\n            $ENV{UPDATE_COPYRIGHT_USE_INTERVALS} == 2\n              and $stmt =~ s/(^|[^\\d])(\\d{4})\\b.*(?:[^\\d])(\\d{4})\\b/$1$2$ndash$3/;\n          }\n\n        # Format within margin.\n        my $stmt_wrapped;\n        my $text_margin = $margin - length($prefix);\n        if ($prefix =~ /^(\\t+)/)\n          {\n            $text_margin -= length($1) * ($tab_width - 1);\n          }\n        while (length $stmt)\n          {\n            if (($stmt =~ s/^(.{1,$text_margin})(?: |$)//)\n                || ($stmt =~ s/^([\\S]+)(?: |$)//))\n              {\n                my $line = $1;\n                $stmt_wrapped .= $stmt_wrapped ? \"$eol$prefix\" : $leading;\n                $stmt_wrapped .= $line;\n              }\n            else\n              {\n                # Should be unreachable, but we don't want an infinite\n                # loop if it can be reached.\n                die;\n              }\n          }\n\n        # Replace the old copyright statement.\n        s/$stmt_re/$stmt_wrapped/g;\n      }\n  }\nelse\n  {\n    print STDERR \"$ARGV: warning: copyright statement not found\\n\";\n  }\n\n# Hey Emacs!\n# Local variables:\n# coding: utf-8\n# mode: perl\n# indent-tabs-mode: nil\n# eval: (add-hook 'before-save-hook 'time-stamp)\n# time-stamp-line-limit: 200\n# time-stamp-start: \"my $VERSION = '\"\n# time-stamp-format: \"%:y-%02m-%02d.%02H:%02M\"\n# time-stamp-time-zone: \"UTC0\"\n# time-stamp-end: \"'; # UTC\"\n# End:\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}