{
  "module_name": "test-canonicalize.c",
  "hash_id": "fd4f6000229de7d711f29c4b1b961a4ec637fa8799e6b070a028be3bd6506cea",
  "original_prompt": "Ingested from coreutils-9.4/gnulib-tests/test-canonicalize.c",
  "human_readable_source": " \n\n \n#define _GL_ARG_NONNULL(params)\n\n#include <config.h>\n\n#include \"canonicalize.h\"\n\n#include <errno.h>\n#include <fcntl.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <sys/stat.h>\n#include <unistd.h>\n\n#include \"same-inode.h\"\n#include \"ignore-value.h\"\n\n#if GNULIB_defined_canonicalize_file_name\n# include \"null-ptr.h\"\n#endif\n\n#include \"macros.h\"\n\n#define BASE \"t-can.tmp\"\n\nint\nmain (void)\n{\n   \n  {\n    int fd;\n    ignore_value (system (\"rm -rf \" BASE \" ise\"));\n    ASSERT (mkdir (BASE, 0700) == 0);\n    fd = creat (BASE \"/tra\", 0600);\n    ASSERT (0 <= fd);\n    ASSERT (close (fd) == 0);\n  }\n\n   \n  {\n    char *result0 = canonicalize_file_name (\"/etc/passwd\");\n    if (result0 != NULL)  \n      {\n        char *result;\n\n        result = canonicalize_filename_mode (\"/etc/passwd\", CAN_MISSING);\n        ASSERT (result != NULL && strcmp (result, result0) == 0);\n\n        result = canonicalize_filename_mode (\"/etc//passwd\", CAN_MISSING);\n        ASSERT (result != NULL && strcmp (result, result0) == 0);\n\n        result = canonicalize_filename_mode (\"/etc///passwd\", CAN_MISSING);\n        ASSERT (result != NULL && strcmp (result, result0) == 0);\n\n         \n#if !(defined _WIN32 || defined __CYGWIN__)\n        result = canonicalize_filename_mode (\"//etc/passwd\", CAN_MISSING);\n        ASSERT (result != NULL && strcmp (result, result0) == 0);\n\n        result = canonicalize_filename_mode (\"//etc//passwd\", CAN_MISSING);\n        ASSERT (result != NULL && strcmp (result, result0) == 0);\n\n        result = canonicalize_filename_mode (\"//etc///passwd\", CAN_MISSING);\n        ASSERT (result != NULL && strcmp (result, result0) == 0);\n#endif\n\n        result = canonicalize_filename_mode (\"///etc/passwd\", CAN_MISSING);\n        ASSERT (result != NULL && strcmp (result, result0) == 0);\n\n        result = canonicalize_filename_mode (\"///etc//passwd\", CAN_MISSING);\n        ASSERT (result != NULL && strcmp (result, result0) == 0);\n\n        result = canonicalize_filename_mode (\"///etc///passwd\", CAN_MISSING);\n        ASSERT (result != NULL && strcmp (result, result0) == 0);\n      }\n  }\n\n   \n  {\n    char *result1;\n    char *result2;\n    errno = 0;\n    result1 = canonicalize_file_name (BASE \"/tra/\");\n    ASSERT (result1 == NULL);\n    ASSERT (errno == ENOTDIR);\n    errno = 0;\n    result2 = canonicalize_filename_mode (BASE \"/tra/\", CAN_EXISTING);\n    ASSERT (result2 == NULL);\n    ASSERT (errno == ENOTDIR);\n  }\n\n   \n  {\n    char *result1;\n    char *result2;\n    errno = 0;\n    result1 = canonicalize_file_name (BASE \"/zzz/..\");\n    ASSERT (result1 == NULL);\n    ASSERT (errno == ENOENT);\n    errno = 0;\n    result2 = canonicalize_filename_mode (BASE \"/zzz/..\", CAN_EXISTING);\n    ASSERT (result2 == NULL);\n    ASSERT (errno == ENOENT);\n  }\n\n   \n  if (symlink (BASE \"/ket\", \"ise\") != 0)\n    {\n      ASSERT (remove (BASE \"/tra\") == 0);\n      ASSERT (rmdir (BASE) == 0);\n      fputs (\"skipping test: symlinks not supported on this file system\\n\",\n             stderr);\n      return 77;\n    }\n  ASSERT (symlink (\"bef\", BASE \"/plo\") == 0);\n  ASSERT (symlink (\"tra\", BASE \"/huk\") == 0);\n  ASSERT (symlink (\"lum\", BASE \"/bef\") == 0);\n  ASSERT (symlink (\"wum\", BASE \"/ouk\") == 0);\n  ASSERT (symlink (\"../ise\", BASE \"/ket\") == 0);\n  ASSERT (mkdir (BASE \"/lum\", 0700) == 0);\n  ASSERT (symlink (\"s\", BASE \"/p\") == 0);\n  ASSERT (symlink (\"d\", BASE \"/s\") == 0);\n  ASSERT (mkdir (BASE \"/d\", 0700) == 0);\n  ASSERT (close (creat (BASE \"/d/2\", 0600)) == 0);\n  ASSERT (symlink (\"../s/2\", BASE \"/d/1\") == 0);\n  ASSERT (symlink (\"//.//../..\", BASE \"/droot\") == 0);\n\n   \n  {\n    char *result1 = canonicalize_filename_mode (BASE \"/huk\", CAN_NOLINKS);\n    ASSERT (result1 != NULL);\n    ASSERT (strcmp (result1 + strlen (result1) - strlen (\"/\" BASE \"/huk\"),\n                    \"/\" BASE \"/huk\") == 0);\n    free (result1);\n  }\n\n   \n  {\n    char *result1 = canonicalize_file_name (BASE \"/huk\");\n    char *result2 = canonicalize_file_name (BASE \"/tra\");\n    char *result3 = canonicalize_filename_mode (BASE \"/huk\", CAN_EXISTING);\n    ASSERT (result1 != NULL);\n    ASSERT (result2 != NULL);\n    ASSERT (result3 != NULL);\n    ASSERT (strcmp (result1, result2) == 0);\n    ASSERT (strcmp (result2, result3) == 0);\n    ASSERT (strcmp (result1 + strlen (result1) - strlen (\"/\" BASE \"/tra\"),\n                    \"/\" BASE \"/tra\") == 0);\n    free (result1);\n    free (result2);\n    free (result3);\n  }\n\n   \n  {\n    char *result1 = canonicalize_file_name (BASE \"/plo\");\n    char *result2 = canonicalize_file_name (BASE \"/bef\");\n    char *result3 = canonicalize_file_name (BASE \"/lum\");\n    char *result4 = canonicalize_filename_mode (BASE \"/plo\", CAN_EXISTING);\n    ASSERT (result1 != NULL);\n    ASSERT (result2 != NULL);\n    ASSERT (result3 != NULL);\n    ASSERT (result4 != NULL);\n    ASSERT (strcmp (result1, result2) == 0);\n    ASSERT (strcmp (result2, result3) == 0);\n    ASSERT (strcmp (result3, result4) == 0);\n    ASSERT (strcmp (result1 + strlen (result1) - strlen (\"/\" BASE \"/lum\"),\n                    \"/\" BASE \"/lum\") == 0);\n    free (result1);\n    free (result2);\n    free (result3);\n    free (result4);\n  }\n\n   \n  {\n    char *result1;\n    char *result2;\n    errno = 0;\n    result1 = canonicalize_file_name (BASE \"/ouk\");\n    ASSERT (result1 == NULL);\n    ASSERT (errno == ENOENT);\n    errno = 0;\n    result2 = canonicalize_filename_mode (BASE \"/ouk\", CAN_EXISTING);\n    ASSERT (result2 == NULL);\n    ASSERT (errno == ENOENT);\n  }\n\n   \n  {\n    char const *const file_name[]\n      = {\n         BASE \"/huk/\",\n         BASE \"/huk/.\",\n         BASE \"/huk/./\",\n         BASE \"/huk/./.\",\n         BASE \"/huk/x\",\n         BASE \"/huk/..\",\n         BASE \"/huk/../\",\n         BASE \"/huk/../.\",\n         BASE \"/huk/../x\",\n         BASE \"/huk/./..\",\n         BASE \"/huk/././../x\",\n        };\n    for (int i = 0; i < sizeof file_name / sizeof *file_name; i++)\n      {\n        errno = 0;\n        ASSERT (!canonicalize_file_name (file_name[i]));\n        ASSERT (errno == ENOTDIR);\n        errno = 0;\n        ASSERT (!canonicalize_filename_mode (file_name[i], CAN_EXISTING));\n        ASSERT (errno == ENOTDIR);\n      }\n  }\n\n   \n  {\n    char *result1;\n    char *result2;\n    errno = 0;\n    result1 = canonicalize_file_name (BASE \"/ouk/..\");\n    ASSERT (result1 == NULL);\n    ASSERT (errno == ENOENT);\n    errno = 0;\n    result2 = canonicalize_filename_mode (BASE \"/ouk/..\", CAN_EXISTING);\n    ASSERT (result2 == NULL);\n    ASSERT (errno == ENOENT);\n  }\n\n   \n  {\n    char *result1;\n    char *result2;\n    errno = 0;\n    result1 = canonicalize_file_name (\"ise\");\n    ASSERT (result1 == NULL);\n    ASSERT (errno == ELOOP);\n    errno = 0;\n    result2 = canonicalize_filename_mode (\"ise\", CAN_EXISTING);\n    ASSERT (result2 == NULL);\n    ASSERT (errno == ELOOP);\n  }\n\n   \n  {\n    char *result1 = canonicalize_filename_mode (BASE \"/zzz\", CAN_ALL_BUT_LAST);\n    char *result2 = canonicalize_filename_mode (BASE \"/zzz\", CAN_MISSING);\n    char *result3 = canonicalize_filename_mode (BASE \"/zzz/\", CAN_ALL_BUT_LAST);\n    char *result4 = canonicalize_filename_mode (BASE \"/zzz/\", CAN_MISSING);\n    ASSERT (result1 != NULL);\n    ASSERT (result2 != NULL);\n    ASSERT (result3 != NULL);\n    ASSERT (result4 != NULL);\n    ASSERT (strcmp (result1, result2) == 0);\n    ASSERT (strcmp (result2, result3) == 0);\n    ASSERT (strcmp (result3, result4) == 0);\n    ASSERT (strcmp (result1 + strlen (result1) - strlen (\"/\" BASE \"/zzz\"),\n                    \"/\" BASE \"/zzz\") == 0);\n    free (result1);\n    free (result2);\n    free (result3);\n    free (result4);\n  }\n\n   \n  {\n    char *result1 = canonicalize_filename_mode (BASE \"/ouk\", CAN_ALL_BUT_LAST);\n    char *result2 = canonicalize_filename_mode (BASE \"/ouk\", CAN_MISSING);\n    char *result3 = canonicalize_filename_mode (BASE \"/ouk/\", CAN_ALL_BUT_LAST);\n    char *result4 = canonicalize_filename_mode (BASE \"/ouk/\", CAN_MISSING);\n    ASSERT (result1 != NULL);\n    ASSERT (result2 != NULL);\n    ASSERT (result3 != NULL);\n    ASSERT (result4 != NULL);\n    ASSERT (strcmp (result1, result2) == 0);\n    ASSERT (strcmp (result2, result3) == 0);\n    ASSERT (strcmp (result3, result4) == 0);\n    ASSERT (strcmp (result1 + strlen (result1) - strlen (\"/\" BASE \"/wum\"),\n                    \"/\" BASE \"/wum\") == 0);\n    free (result1);\n    free (result2);\n    free (result3);\n    free (result4);\n  }\n\n   \n  {\n    char *result1 = canonicalize_filename_mode (\"t-can.zzz/zzz\", CAN_ALL_BUT_LAST);\n    char *result2 = canonicalize_filename_mode (\"t-can.zzz/zzz\", CAN_MISSING);\n    ASSERT (result1 == NULL);\n    ASSERT (result2 != NULL);\n    ASSERT (strcmp (result2 + strlen (result2) - 14, \"/t-can.zzz/zzz\") == 0);\n    free (result2);\n  }\n\n   \n  {\n    char *result1 = canonicalize_filename_mode (BASE, CAN_EXISTING);\n    char *result2 = canonicalize_filename_mode (BASE \"/p/1\", CAN_EXISTING);\n    ASSERT (result1 != NULL);\n    ASSERT (result2 != NULL);\n    ASSERT (strcmp (result2 + strlen (result1), \"/d/2\") == 0);\n    free (result1);\n    free (result2);\n  }\n\n   \n  ASSERT (remove (BASE \"/droot\") == 0);\n  ASSERT (remove (BASE \"/d/1\") == 0);\n  ASSERT (remove (BASE \"/d/2\") == 0);\n  ASSERT (remove (BASE \"/d\") == 0);\n  ASSERT (remove (BASE \"/s\") == 0);\n  ASSERT (remove (BASE \"/p\") == 0);\n  ASSERT (remove (BASE \"/plo\") == 0);\n  ASSERT (remove (BASE \"/huk\") == 0);\n  ASSERT (remove (BASE \"/bef\") == 0);\n  ASSERT (remove (BASE \"/ouk\") == 0);\n  ASSERT (remove (BASE \"/ket\") == 0);\n  ASSERT (remove (BASE \"/lum\") == 0);\n  ASSERT (remove (BASE \"/tra\") == 0);\n  ASSERT (remove (BASE) == 0);\n  ASSERT (remove (\"ise\") == 0);\n\n  return 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}