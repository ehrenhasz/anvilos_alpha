{
  "module_name": "test-rwlock1.c",
  "hash_id": "f22293a09cafad8225fdafb339abc481c4705917670e5601d32b75f219e723d1",
  "original_prompt": "Ingested from coreutils-9.4/gnulib-tests/test-rwlock1.c",
  "human_readable_source": " \n\n#include <config.h>\n\n#if USE_ISOC_THREADS || USE_POSIX_THREADS || USE_ISOC_AND_POSIX_THREADS || USE_WINDOWS_THREADS\n\n#include \"glthread/lock.h\"\n\n#include <errno.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <unistd.h>\n\n#include \"glthread/thread.h\"\n\n \n\n#define SUCCEED() exit (0)\n#define FAILURE() exit (1)\n#define UNEXPECTED(n) (fprintf (stderr, \"Unexpected outcome %d\\n\", n), abort ())\n\n \n\nstatic gl_rwlock_t lock;\nstatic gl_thread_t reader1;\nstatic gl_thread_t writer;\nstatic gl_thread_t reader2;\nstatic gl_thread_t timer;\n \nstatic gl_lock_t baton;\n\nstatic void *\ntimer_func (void *ignored)\n{\n   \n  if (glthread_lock_lock (&baton))\n    UNEXPECTED (13);\n  usleep (100000);\n   \n  SUCCEED ();\n}\n\nstatic void *\nreader2_func (void *ignored)\n{\n  int err;\n\n   \n  if (glthread_lock_lock (&baton))\n    UNEXPECTED (8);\n  usleep (100000);\n   \n   \n  if (glthread_create (&timer, timer_func, NULL))\n    UNEXPECTED (10);\n   \n  if (glthread_lock_unlock (&baton))\n    UNEXPECTED (11);\n   \n  err = glthread_rwlock_rdlock (&lock);\n  if (err == 0)\n    FAILURE ();\n  else\n    UNEXPECTED (12);\n}\n\nstatic void *\nwriter_func (void *ignored)\n{\n   \n  if (glthread_lock_lock (&baton))\n    UNEXPECTED (4);\n   \n  if (glthread_create (&reader2, reader2_func, NULL))\n    UNEXPECTED (5);\n   \n  if (glthread_lock_unlock (&baton))\n    UNEXPECTED (6);\n   \n  if (glthread_rwlock_wrlock (&lock))\n    UNEXPECTED (7);\n  return NULL;\n}\n\nint\nmain ()\n{\n  reader1 = gl_thread_self ();\n\n   \n  if (glthread_rwlock_init (&lock))\n    UNEXPECTED (1);\n  if (glthread_lock_init (&baton))\n    UNEXPECTED (1);\n   \n  if (glthread_rwlock_rdlock (&lock))\n    UNEXPECTED (2);\n   \n  if (glthread_create (&writer, writer_func, NULL))\n    UNEXPECTED (3);\n   \n  for (;;)\n    {\n      sleep (1);\n    }\n}\n\n#else\n\n \n\n#include <stdio.h>\n\nint\nmain ()\n{\n  fputs (\"Skipping test: multithreading not enabled\\n\", stderr);\n  return 77;\n}\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}