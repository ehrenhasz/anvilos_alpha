{
  "module_name": "test-iconv.c",
  "hash_id": "e43e40a101006581a85942209b2a8dcec52953fdf52dc39fbab1264b9842742b",
  "original_prompt": "Ingested from coreutils-9.4/gnulib-tests/test-iconv.c",
  "human_readable_source": " \n\n#include <config.h>\n\n#if HAVE_ICONV\n# include <iconv.h>\n\n# ifndef ICONV_CONST\n#  define ICONV_CONST  \n# endif\n\n#include \"signature.h\"\nSIGNATURE_CHECK (iconv, size_t, (iconv_t, ICONV_CONST char **, size_t *,\n                                 char **, size_t *));\nSIGNATURE_CHECK (iconv_close, int, (iconv_t x));\nSIGNATURE_CHECK (iconv_open, iconv_t, (char const *, char const *));\n\n#endif\n\n#include <errno.h>\n#include <string.h>\n\n#include \"macros.h\"\n\nint\nmain ()\n{\n#if HAVE_ICONV\n   \n  iconv_t cd_88591_to_utf8 = iconv_open (\"UTF-8\", \"ISO-8859-1\");\n  iconv_t cd_utf8_to_88591 = iconv_open (\"ISO-8859-1\", \"UTF-8\");\n\n#if defined __MVS__ && defined __IBMC__\n   \n# pragma convert(\"ISO8859-1\")\n# define CONVERT_ENABLED\n#endif\n\n  ASSERT (cd_88591_to_utf8 != (iconv_t)(-1));\n  ASSERT (cd_utf8_to_88591 != (iconv_t)(-1));\n\n   \n  {\n    static const char input[] = \"\\304rger mit b\\366sen B\\374bchen ohne Augenma\\337\";\n    static const char expected[] = \"\\303\\204rger mit b\\303\\266sen B\\303\\274bchen ohne Augenma\\303\\237\";\n    char buf[50];\n    const char *inptr = input;\n    size_t inbytesleft = strlen (input);\n    char *outptr = buf;\n    size_t outbytesleft = sizeof (buf);\n    size_t res = iconv (cd_88591_to_utf8,\n                        (ICONV_CONST char **) &inptr, &inbytesleft,\n                        &outptr, &outbytesleft);\n    ASSERT (res == 0 && inbytesleft == 0);\n    ASSERT (outptr == buf + strlen (expected));\n    ASSERT (memcmp (buf, expected, strlen (expected)) == 0);\n  }\n\n   \n  {\n    static const char input[] = \"\\304\";\n    static char buf[2] = { (char)0xDE, (char)0xAD };\n    const char *inptr = input;\n    size_t inbytesleft = 1;\n    char *outptr = buf;\n    size_t outbytesleft = 1;\n    size_t res = iconv (cd_88591_to_utf8,\n                        (ICONV_CONST char **) &inptr, &inbytesleft,\n                        &outptr, &outbytesleft);\n    ASSERT (res == (size_t)(-1) && errno == E2BIG);\n    ASSERT (inbytesleft == 1);\n    ASSERT (outbytesleft == 1);\n    ASSERT ((unsigned char) buf[1] == 0xAD);\n    ASSERT ((unsigned char) buf[0] == 0xDE);\n  }\n\n   \n  {\n    static const char input[] = \"\\303\\204rger mit b\\303\\266sen B\\303\\274bchen ohne Augenma\\303\\237\";\n    static const char expected[] = \"\\304rger mit b\\366sen B\\374bchen ohne Augenma\\337\";\n    char buf[50];\n    const char *inptr = input;\n    size_t inbytesleft = strlen (input);\n    char *outptr = buf;\n    size_t outbytesleft = sizeof (buf);\n    size_t res = iconv (cd_utf8_to_88591,\n                        (ICONV_CONST char **) &inptr, &inbytesleft,\n                        &outptr, &outbytesleft);\n    ASSERT (res == 0 && inbytesleft == 0);\n    ASSERT (outptr == buf + strlen (expected));\n    ASSERT (memcmp (buf, expected, strlen (expected)) == 0);\n  }\n\n   \n  {\n    static const char input[] = \"\\342\\202\\254\";  \n    char buf[10];\n    const char *inptr = input;\n    size_t inbytesleft = strlen (input);\n    char *outptr = buf;\n    size_t outbytesleft = sizeof (buf);\n    size_t res = iconv (cd_utf8_to_88591,\n                        (ICONV_CONST char **) &inptr, &inbytesleft,\n                        &outptr, &outbytesleft);\n    if (res == (size_t)(-1))\n      {\n        ASSERT (errno == EILSEQ);\n        ASSERT (inbytesleft == strlen (input) && outptr == buf);\n      }\n    else\n      {\n        ASSERT (res == 1);\n        ASSERT (inbytesleft == 0);\n      }\n  }\n\n   \n  {\n    static const char input[] = \"\\342\";\n    char buf[10];\n    const char *inptr = input;\n    size_t inbytesleft = 1;\n    char *outptr = buf;\n    size_t outbytesleft = sizeof (buf);\n    size_t res = iconv (cd_utf8_to_88591,\n                        (ICONV_CONST char **) &inptr, &inbytesleft,\n                        &outptr, &outbytesleft);\n    ASSERT (res == (size_t)(-1) && errno == EINVAL);\n    ASSERT (inbytesleft == 1 && outptr == buf);\n  }\n\n  iconv_close (cd_88591_to_utf8);\n  iconv_close (cd_utf8_to_88591);\n\n#ifdef CONVERT_ENABLED\n# pragma convert(pop)\n#endif\n\n#endif  \n\n  return 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}