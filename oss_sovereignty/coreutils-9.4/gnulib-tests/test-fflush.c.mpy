{
  "module_name": "test-fflush.c",
  "hash_id": "297c6f0010ae8d2af6a3b5c206a336cdccebcf231695d88bde2b0046e5627298",
  "original_prompt": "Ingested from coreutils-9.4/gnulib-tests/test-fflush.c",
  "human_readable_source": " \n\n#include <config.h>\n\n \n#define _GL_NO_LARGE_FILES\n#include <stdio.h>\n\n#include \"signature.h\"\nSIGNATURE_CHECK (fflush, int, (FILE *));\n\n#include <errno.h>\n#include <unistd.h>\n\n#include \"macros.h\"\n\nint\nmain (void)\n{\n  FILE *f;\n  char buffer[10];\n  int fd;\n\n   \n  f = fopen (\"test-fflush.txt\", \"w\");\n  if (!f || fwrite (\"1234567890ABCDEFG\", 1, 17, f) != 17 || fclose (f) != 0)\n    {\n      fputs (\"Failed to create sample file.\\n\", stderr);\n      unlink (\"test-fflush.txt\");\n      return 1;\n    }\n\n   \n  f = fopen (\"test-fflush.txt\", \"r\");\n  ASSERT (f != NULL);\n  fd = fileno (f);\n  if (!f || 0 > fd || fread (buffer, 1, 5, f) != 5)\n    {\n      fputs (\"Failed initial read of sample file.\\n\", stderr);\n      if (f)\n        fclose (f);\n      unlink (\"test-fflush.txt\");\n      return 1;\n    }\n   \n#if !(defined __BEOS__ || defined __UCLIBC__)\n  if (lseek (fd, 0, SEEK_CUR) == 5)\n    {\n      fputs (\"Sample file was not buffered after fread.\\n\", stderr);\n      fclose (f);\n      unlink (\"test-fflush.txt\");\n      return 1;\n    }\n#endif\n   \n  if (fflush (f) != 0 || fseeko (f, 0, SEEK_CUR) != 0)\n    {\n      fputs (\"Failed to flush-fseek sample file.\\n\", stderr);\n      fclose (f);\n      unlink (\"test-fflush.txt\");\n      return 1;\n    }\n   \n  if (lseek (fd, 0, SEEK_CUR) != 5)\n    {\n      fprintf (stderr, \"File offset is wrong after fseek: %ld.\\n\",\n               (long) lseek (fd, 0, SEEK_CUR));\n      fclose (f);\n      unlink (\"test-fflush.txt\");\n      return 1;\n    }\n  if (ftell (f) != 5)\n    {\n      fprintf (stderr, \"ftell result is wrong after fseek: %ld.\\n\",\n               (long) ftell (f));\n      fclose (f);\n      unlink (\"test-fflush.txt\");\n      return 1;\n    }\n   \n  if (fgetc (f) != '6')\n    {\n      fputs (\"Failed to read next byte after fseek.\\n\", stderr);\n      fclose (f);\n      unlink (\"test-fflush.txt\");\n      return 1;\n    }\n   \n  if (lseek (fd, 0, SEEK_CUR) == 6)\n    {\n      fputs (\"Sample file was not buffered after fgetc.\\n\", stderr);\n      fclose (f);\n      unlink (\"test-fflush.txt\");\n      return 1;\n    }\n   \n  if (fflush (f) != 0 || fseeko (f, 0, SEEK_CUR) != 0)\n    {\n      fputs (\"Failed to flush-fseeko sample file.\\n\", stderr);\n      fclose (f);\n      unlink (\"test-fflush.txt\");\n      return 1;\n    }\n   \n  if (lseek (fd, 0, SEEK_CUR) != 6)\n    {\n      fprintf (stderr, \"File offset is wrong after fseeko: %ld.\\n\",\n               (long) lseek (fd, 0, SEEK_CUR));\n      fclose (f);\n      unlink (\"test-fflush.txt\");\n      return 1;\n    }\n  if (ftell (f) != 6)\n    {\n      fprintf (stderr, \"ftell result is wrong after fseeko: %ld.\\n\",\n               (long) ftell (f));\n      fclose (f);\n      unlink (\"test-fflush.txt\");\n      return 1;\n    }\n   \n  if (fgetc (f) != '7')\n    {\n      fputs (\"Failed to read next byte after fseeko.\\n\", stderr);\n      fclose (f);\n      unlink (\"test-fflush.txt\");\n      return 1;\n    }\n  fclose (f);\n\n   \n  #if !defined __ANDROID__  \n  {\n    FILE *fp = fopen (\"test-fflush.txt\", \"w\");\n    ASSERT (fp != NULL);\n    fputc ('x', fp);\n    ASSERT (close (fileno (fp)) == 0);\n    errno = 0;\n    ASSERT (fflush (fp) == EOF);\n    ASSERT (errno == EBADF);\n    fclose (fp);\n  }\n  #endif\n\n   \n  {\n    FILE *fp = fdopen (-1, \"w\");\n    if (fp != NULL)\n      {\n        fputc ('x', fp);\n        errno = 0;\n        ASSERT (fflush (fp) == EOF);\n        ASSERT (errno == EBADF);\n      }\n  }\n  {\n    FILE *fp;\n    close (99);\n    fp = fdopen (99, \"w\");\n    if (fp != NULL)\n      {\n        fputc ('x', fp);\n        errno = 0;\n        ASSERT (fflush (fp) == EOF);\n        ASSERT (errno == EBADF);\n      }\n  }\n\n   \n  unlink (\"test-fflush.txt\");\n\n  return 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}