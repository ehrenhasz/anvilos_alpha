{
  "module_name": "test-readlinkat.c",
  "hash_id": "ff323751d8ed3ef092c09a0d157b00a853ae83a7230acce94cdc976a0d1d5b37",
  "original_prompt": "Ingested from coreutils-9.4/gnulib-tests/test-readlinkat.c",
  "human_readable_source": " \n\n#include <config.h>\n\n#include <unistd.h>\n\n#include \"signature.h\"\nSIGNATURE_CHECK (readlinkat, ssize_t, (int, char const *, char *, size_t));\n\n#include <fcntl.h>\n#include <errno.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <sys/stat.h>\n\n#include \"ignore-value.h\"\n#include \"macros.h\"\n\n#ifndef HAVE_SYMLINK\n# define HAVE_SYMLINK 0\n#endif\n\n#define BASE \"test-readlinkat.t\"\n\n#include \"test-readlink.h\"\n\nstatic int dfd = AT_FDCWD;\n\nstatic ssize_t\ndo_readlink (char const *name, char *buf, size_t len)\n{\n  return readlinkat (dfd, name, buf, len);\n}\n\nint\nmain (void)\n{\n  char buf[80];\n  int result;\n\n   \n  ignore_value (system (\"rm -rf \" BASE \"*\"));\n\n   \n  {\n    errno = 0;\n    ASSERT (readlinkat (-1, \"foo\", buf, sizeof buf) == -1);\n    ASSERT (errno == EBADF);\n  }\n  {\n    close (99);\n    errno = 0;\n    ASSERT (readlinkat (99, \"foo\", buf, sizeof buf) == -1);\n    ASSERT (errno == EBADF);\n  }\n\n   \n  result = test_readlink (do_readlink, false);\n  dfd = openat (AT_FDCWD, \".\", O_RDONLY);\n  ASSERT (0 <= dfd);\n  ASSERT (test_readlink (do_readlink, false) == result);\n\n   \n  if (HAVE_SYMLINK)\n    {\n      const char *contents = \"don't matter!\";\n      ssize_t exp = strlen (contents);\n\n       \n      ASSERT (symlinkat (contents, AT_FDCWD, BASE \"link\") == 0);\n      errno = 0;\n      ASSERT (symlinkat (contents, dfd, BASE \"link\") == -1);\n      ASSERT (errno == EEXIST);\n      ASSERT (chdir (\"..\") == 0);\n      errno = 0;\n      ASSERT (readlinkat (AT_FDCWD, BASE \"link\", buf, sizeof buf) == -1);\n      ASSERT (errno == ENOENT);\n      ASSERT (readlinkat (dfd, BASE \"link\", buf, sizeof buf) == exp);\n      ASSERT (strncmp (contents, buf, exp) == 0);\n      ASSERT (unlinkat (dfd, BASE \"link\", 0) == 0);\n\n       \n      ASSERT (symlinkat (contents, dfd, BASE \"link\") == 0);\n      ASSERT (fchdir (dfd) == 0);\n      errno = 0;\n      ASSERT (symlinkat (contents, AT_FDCWD, BASE \"link\") == -1);\n      ASSERT (errno == EEXIST);\n      buf[0] = '\\0';\n      ASSERT (readlinkat (AT_FDCWD, BASE \"link\", buf, sizeof buf) == exp);\n      ASSERT (strncmp (contents, buf, exp) == 0);\n      buf[0] = '\\0';\n      ASSERT (readlinkat (dfd, BASE \"link\", buf, sizeof buf) == exp);\n      ASSERT (strncmp (contents, buf, exp) == 0);\n      ASSERT (unlink (BASE \"link\") == 0);\n    }\n\n  ASSERT (close (dfd) == 0);\n  if (result == 77)\n    fputs (\"skipping test: symlinks not supported on this file system\\n\",\n           stderr);\n  return result;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}