{
  "module_name": "test-stat-time.c",
  "hash_id": "306f37249f9c1cf96c0fd157ffa4f83629aa428699fde4dadc976cf74204a6bf",
  "original_prompt": "Ingested from coreutils-9.4/gnulib-tests/test-stat-time.c",
  "human_readable_source": " \n\n#include <config.h>\n\n#include \"stat-time.h\"\n\n#include <fcntl.h>\n#include <signal.h>\n#include <stdio.h>\n#include <sys/stat.h>\n#include <unistd.h>\n#include <time.h>\n\n#include \"macros.h\"\n\n#define BASE \"test-stat-time.t\"\n#include \"nap.h\"\n\nenum { NFILES = 4 };\n\nstatic char filename_stamp1[50];\nstatic char filename_testfile[50];\nstatic char filename_stamp2[50];\nstatic char filename_stamp3[50];\n\n \n  chmod (filename, 0600);\n  return unlink (filename);\n}\n\nstatic void\ncleanup (int sig)\n{\n   \n  force_unlink (filename_stamp1);\n  force_unlink (filename_testfile);\n  force_unlink (filename_stamp2);\n  force_unlink (filename_stamp3);\n\n  if (sig != 0)\n    _exit (1);\n}\n\nstatic int\nopen_file (const char *filename, int flags)\n{\n  int fd = open (filename, flags | O_WRONLY, 0500);\n  if (fd >= 0)\n    {\n      close (fd);\n      return 1;\n    }\n  else\n    {\n      return 0;\n    }\n}\n\nstatic void\ncreate_file (const char *filename)\n{\n  ASSERT (open_file (filename, O_CREAT | O_EXCL));\n}\n\nstatic void\ndo_stat (const char *filename, struct stat *p)\n{\n  ASSERT (stat (filename, p) == 0);\n}\n\nstatic void\nprepare_test (struct stat *statinfo, struct timespec *modtimes)\n{\n  int i;\n\n  create_file (filename_stamp1);\n  nap ();\n  create_file (filename_testfile);\n  nap ();\n  create_file (filename_stamp2);\n  nap ();\n  ASSERT (chmod (filename_testfile, 0400) == 0);\n  nap ();\n  create_file (filename_stamp3);\n\n  do_stat (filename_stamp1,   &statinfo[0]);\n  do_stat (filename_testfile, &statinfo[1]);\n  do_stat (filename_stamp2,   &statinfo[2]);\n  do_stat (filename_stamp3,   &statinfo[3]);\n\n   \n  for (i = 0; i < NFILES; ++i)\n    {\n      modtimes[i] = get_stat_mtime (&statinfo[i]);\n    }\n}\n\nstatic void\ntest_mtime (const struct stat *statinfo, struct timespec *modtimes)\n{\n  int i;\n\n   \n   \n  ASSERT (statinfo[0].st_mtime < statinfo[2].st_mtime\n          || (statinfo[0].st_mtime == statinfo[2].st_mtime\n              && (get_stat_mtime_ns (&statinfo[0])\n                  < get_stat_mtime_ns (&statinfo[2]))));\n   \n  ASSERT (statinfo[2].st_mtime < statinfo[3].st_mtime\n          || (statinfo[2].st_mtime == statinfo[3].st_mtime\n              && (get_stat_mtime_ns (&statinfo[2])\n                  < get_stat_mtime_ns (&statinfo[3]))));\n\n   \n   \n  ASSERT (modtimes[0].tv_sec < modtimes[2].tv_sec\n          || (modtimes[0].tv_sec == modtimes[2].tv_sec\n              && modtimes[0].tv_nsec < modtimes[2].tv_nsec));\n   \n  ASSERT (modtimes[2].tv_sec < modtimes[3].tv_sec\n          || (modtimes[2].tv_sec == modtimes[3].tv_sec\n              && modtimes[2].tv_nsec < modtimes[3].tv_nsec));\n\n   \n  for (i = 0; i < NFILES; ++i)\n    {\n      struct timespec ts;\n      ts = get_stat_mtime (&statinfo[i]);\n      ASSERT (ts.tv_sec == statinfo[i].st_mtime);\n    }\n}\n\n#if defined _WIN32 && !defined __CYGWIN__\n \n# define test_ctime(ignored) ((void) 0)\n#else\nstatic void\ntest_ctime (const struct stat *statinfo)\n{\n   \n  if (statinfo[0].st_mtime != statinfo[0].st_ctime)\n    return;\n\n   \n  ASSERT (statinfo[2].st_mtime < statinfo[1].st_ctime\n          || (statinfo[2].st_mtime == statinfo[1].st_ctime\n              && (get_stat_mtime_ns (&statinfo[2])\n                  < get_stat_ctime_ns (&statinfo[1]))));\n}\n#endif\n\nstatic void\ntest_birthtime (const struct stat *statinfo,\n                const struct timespec *modtimes,\n                struct timespec *birthtimes)\n{\n  int i;\n\n   \n  for (i = 0; i < NFILES; ++i)\n    {\n      birthtimes[i] = get_stat_birthtime (&statinfo[i]);\n      if (birthtimes[i].tv_nsec < 0)\n        return;\n    }\n\n   \n  ASSERT (modtimes[0].tv_sec < birthtimes[1].tv_sec\n          || (modtimes[0].tv_sec == birthtimes[1].tv_sec\n              && modtimes[0].tv_nsec < birthtimes[1].tv_nsec));\n   \n  ASSERT (birthtimes[1].tv_sec < modtimes[2].tv_sec\n          || (birthtimes[1].tv_sec == modtimes[2].tv_sec\n              && birthtimes[1].tv_nsec < modtimes[2].tv_nsec));\n}\n\nint\nmain (void)\n{\n  struct stat statinfo[NFILES];\n  struct timespec modtimes[NFILES];\n  struct timespec birthtimes[NFILES];\n\n  initialize_filenames ();\n\n#ifdef SIGHUP\n  signal (SIGHUP, cleanup);\n#endif\n#ifdef SIGINT\n  signal (SIGINT, cleanup);\n#endif\n#ifdef SIGQUIT\n  signal (SIGQUIT, cleanup);\n#endif\n#ifdef SIGTERM\n  signal (SIGTERM, cleanup);\n#endif\n\n  cleanup (0);\n  prepare_test (statinfo, modtimes);\n  test_mtime (statinfo, modtimes);\n  test_ctime (statinfo);\n  test_birthtime (statinfo, modtimes, birthtimes);\n\n  cleanup (0);\n  return 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}