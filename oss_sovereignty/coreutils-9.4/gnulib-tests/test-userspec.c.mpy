{
  "module_name": "test-userspec.c",
  "hash_id": "9f5cc9059526c9e1312ac6e5b22b3f6deb1da467bb972c5542014e3a68a89cc0",
  "original_prompt": "Ingested from coreutils-9.4/gnulib-tests/test-userspec.c",
  "human_readable_source": " \n\n#include <config.h>\n\n#include \"userspec.h\"\n\n#include <stdio.h>\n#include <assert.h>\n#include <string.h>\n#include <stdlib.h>\n#include <sys/types.h>\n#include <pwd.h>\n#include <grp.h>\n\n#include \"xalloc.h\"\n\n#define ARRAY_CARDINALITY(Array) (sizeof (Array) / sizeof *(Array))\n\nstruct test\n{\n  char in[100];\n  uid_t uid;\n  gid_t gid;\n  const char *user_name;\n  const char *group_name;\n  const char *result;\n};\n\nstatic struct test T[] =\n  {\n    { \"\",                       -1, -1, \"\",   \"\",   NULL},\n    { \":\",                      -1, -1, \"\",   \"\",   NULL},\n    { \"+0:+0\",                   0,  0, \"\",   \"\",   NULL},\n    { \"+0:+0\",                   0,  0, \"\",   \"\",   NULL},\n    { \":+1\",                    -1,  1, \"\",   \"\",   NULL},\n    { \"+1\",                      1, -1, \"\",   \"\",   NULL},\n    { \":+0\",                    -1,  0, \"\",   \"\",   NULL},\n    { \"+22:+42\",                22, 42, \"\",   \"\",   NULL},\n     \n    { \"+4294967295:+4294967295\", 0,  0, NULL, NULL, \"invalid user\"},\n     \n    { \"+0:+4294967295\",          0,  0, NULL, NULL, \"invalid group\"},\n    { \":+4294967295\",            0,  0, NULL, NULL, \"invalid group\"},\n     \n    { \"+4294967295:+0\",          0,  0, NULL, NULL, \"invalid user\"},\n     \n    { \"+4294967296:+4294967296\", 0,  0, NULL, NULL, \"invalid user\"},\n    { \"+0:+4294967296\",          0,  0, NULL, NULL, \"invalid group\"},\n    { \":+4294967296\",            0,  0, NULL, NULL, \"invalid group\"},\n    { \"+4294967296:+0\",          0,  0, NULL, NULL, \"invalid user\"},\n     \n    { \"+4294967295:\",            0,  0, NULL, NULL, \"invalid spec\"},\n    { \"+4294967296:\",            0,  0, NULL, NULL, \"invalid spec\"},\n    { \"+1:\",                     0,  0, NULL, NULL, \"invalid spec\"},\n    { \"+0:\",                     0,  0, NULL, NULL, \"invalid spec\"},\n\n     \n     \n    { \"\"  ,    -1, -1,     \"\",     \"\", NULL},\n  };\n\n#define STREQ(a, b) (strcmp (a, b) == 0)\n\nstatic char const *\nmaybe_null (char const *s)\n{\n  return s ? s : \"NULL\";\n}\n\nstatic bool\nsame_diag (char const *s, char const *t)\n{\n  if (s == NULL && t == NULL)\n    return true;\n  if (s == NULL || t == NULL)\n    return false;\n  return STREQ (s, t);\n}\n\nint\nmain (void)\n{\n  unsigned int i;\n  int fail = 0;\n\n   \n  {\n    uid_t uid;\n    for (uid = 1200; 0 < uid; uid--)\n      {\n        struct group *gr;\n        struct passwd *pw = getpwuid (uid);\n        unsigned int j;\n        size_t len;\n        if (!pw || !pw->pw_name || !(gr = getgrgid (pw->pw_gid)) || !gr->gr_name)\n          continue;\n        j = ARRAY_CARDINALITY (T) - 1;\n        len = strlen (pw->pw_name);\n        if (sizeof T[j].in - 2 < len)\n          continue;\n\n         \n        memcpy(T[j].in, pw->pw_name, len);\n        strcpy(T[j].in + len, \":\");\n\n        T[j].uid = uid;\n        T[j].gid = gr->gr_gid;\n        T[j].user_name = xstrdup (pw->pw_name);\n        T[j].group_name = xstrdup (gr->gr_name);\n        T[j].result = NULL;\n        break;\n      }\n  }\n\n  char *user_name = NULL;\n  char *group_name = NULL;\n\n  for (i = 0; i < ARRAY_CARDINALITY (T); i++)\n    {\n      uid_t uid = (uid_t) -1;\n      gid_t gid = (gid_t) -1;\n      free (user_name);\n      free (group_name);\n      char const *diag = parse_user_spec (T[i].in, &uid, &gid,\n                                          &user_name, &group_name);\n      if (!same_diag (diag, T[i].result))\n        {\n          printf (\"%s return value mismatch: got %s, expected %s\\n\",\n                  T[i].in, maybe_null (diag), maybe_null (T[i].result));\n          fail = 1;\n          continue;\n        }\n\n      if (diag)\n        continue;\n\n      if (uid != T[i].uid || gid != T[i].gid)\n        {\n          printf (\"%s mismatch (-: expected uid,gid; +:actual)\\n\"\n                  \"-%3lu,%3lu\\n+%3lu,%3lu\\n\",\n                  T[i].in,\n                  (unsigned long int) T[i].uid,\n                  (unsigned long int) T[i].gid,\n                  (unsigned long int) uid,\n                  (unsigned long int) gid);\n          fail = 1;\n        }\n\n      if (T[i].result)\n        {\n           \n          diag = \"NULL\";\n          printf (\"%s diagnostic mismatch (-: expected diagnostic; +:actual)\\n\"\n                  \"-%s\\n+%s\\n\", T[i].in, T[i].result, diag);\n          fail = 1;\n        }\n      else\n        {\n           \n          char *colon = strchr (T[i].in, ':');\n          if (colon)\n            {\n              *colon = '.';\n              uid_t uid2 = -1;\n              gid_t gid2 = -1;\n              char *user_name2 = NULL;\n              char *group_name2 = NULL;\n              bool warn;\n              if (! (parse_user_spec_warn (T[i].in, &uid2, &gid2,\n                                           &user_name2, &group_name2, &warn)\n                     && warn))\n                printf (\"%s did not warn\\n\", T[i].in);\n              else if (! (uid == uid2 && gid == gid2\n                          && !!user_name == !!user_name2\n                          && (!user_name || STREQ (user_name, user_name2))\n                          && !!group_name == !!group_name2\n                          && (!group_name || STREQ (group_name, group_name2))))\n                printf (\"%s treated differently than with colon\\n\", T[i].in);\n\n              free (user_name2);\n              free (group_name2);\n            }\n        }\n    }\n\n   \n  {\n    uid_t uid = (uid_t) -1;\n    char const *diag = parse_user_spec (\"\", &uid, NULL, NULL, NULL);\n    if (diag)\n      {\n        printf (\"unexpected error: %s\\n\", diag);\n        fail = 1;\n      }\n  }\n\n  return fail;\n}\n\n \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}