{
  "module_name": "test-fchdir.c",
  "hash_id": "35696a7acee1c94b1db496537f5c451e3dbe3d4e2e2c2d7f29bfecddf9fe7c15",
  "original_prompt": "Ingested from coreutils-9.4/gnulib-tests/test-fchdir.c",
  "human_readable_source": " \n\n#include <config.h>\n\n#include <unistd.h>\n\n#include \"signature.h\"\nSIGNATURE_CHECK (fchdir, int, (int));\n\n#include <errno.h>\n#include <fcntl.h>\n#include <stdlib.h>\n#include <string.h>\n\n#include \"cloexec.h\"\n#include \"macros.h\"\n\nint\nmain (void)\n{\n  char *cwd;\n  int fd;\n  int i;\n\n  cwd = getcwd (NULL, 0);\n  ASSERT (cwd);\n\n  fd = open (\".\", O_RDONLY);\n  ASSERT (0 <= fd);\n\n   \n  {\n    errno = 0;\n    ASSERT (fchdir (-1) == -1);\n    ASSERT (errno == EBADF);\n  }\n  {\n    close (99);\n    errno = 0;\n    ASSERT (fchdir (99) == -1);\n    ASSERT (errno == EBADF);\n  }\n\n   \n  {\n    int bad_fd = open (\"/dev/null\", O_RDONLY);\n    ASSERT (0 <= bad_fd);\n    errno = 0;\n    ASSERT (fchdir (bad_fd) == -1);\n    ASSERT (errno == ENOTDIR);\n    ASSERT (close (bad_fd) == 0);\n  }\n\n   \n  for (i = 0; i < 2; i++)\n    {\n      ASSERT (chdir (&\"..\"[1 - i]) == 0);\n      ASSERT (fchdir (fd) == 0);\n      {\n        size_t len = strlen (cwd) + 1;\n        char *new_dir = malloc (len);\n        ASSERT (new_dir);\n        ASSERT (getcwd (new_dir, len) == new_dir);\n        ASSERT (strcmp (cwd, new_dir) == 0);\n        free (new_dir);\n      }\n\n       \n      if (!i)\n        {\n          int new_fd = dup (fd);\n          ASSERT (0 <= new_fd);\n          ASSERT (close (fd) == 0);\n          ASSERT (dup2 (new_fd, fd) == fd);\n          ASSERT (close (new_fd) == 0);\n          ASSERT (dup_cloexec (fd) == new_fd);\n          ASSERT (dup2 (new_fd, fd) == fd);\n          ASSERT (close (new_fd) == 0);\n          ASSERT (fcntl (fd, F_DUPFD_CLOEXEC, new_fd) == new_fd);\n          ASSERT (close (fd) == 0);\n          ASSERT (fcntl (new_fd, F_DUPFD, fd) == fd);\n          ASSERT (close (new_fd) == 0);\n#if GNULIB_TEST_DUP3\n          ASSERT (dup3 (fd, new_fd, 0) == new_fd);\n          ASSERT (dup3 (new_fd, fd, 0) == fd);\n          ASSERT (close (new_fd) == 0);\n#endif\n        }\n    }\n\n  free (cwd);\n  return 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}