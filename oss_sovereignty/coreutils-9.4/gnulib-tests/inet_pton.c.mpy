{
  "module_name": "inet_pton.c",
  "hash_id": "f627f51d8415ff4a5b91b9d78d3089da7d088df11ffc99ee0672cdfb7b809d73",
  "original_prompt": "Ingested from coreutils-9.4/gnulib-tests/inet_pton.c",
  "human_readable_source": " \n\n#include <config.h>\n\n \n#include <arpa/inet.h>\n\n#if HAVE_DECL_INET_PTON\n\n# undef inet_pton\n\nint\nrpl_inet_pton (int af, const char *restrict src, void *restrict dst)\n{\n  return inet_pton (af, src, dst);\n}\n\n#else\n\n# include <c-ctype.h>\n# include <string.h>\n# include <errno.h>\n\n# define NS_INADDRSZ 4\n# define NS_IN6ADDRSZ 16\n# define NS_INT16SZ 2\n\n \n\nstatic int inet_pton4 (const char *src, unsigned char *dst);\n# if HAVE_IPV6\nstatic int inet_pton6 (const char *src, unsigned char *dst);\n# endif\n\n \nint\ninet_pton (int af, const char *restrict src, void *restrict dst)\n{\n  switch (af)\n    {\n    case AF_INET:\n      return (inet_pton4 (src, dst));\n\n# if HAVE_IPV6\n    case AF_INET6:\n      return (inet_pton6 (src, dst));\n# endif\n\n    default:\n      errno = EAFNOSUPPORT;\n      return (-1);\n    }\n   \n}\n\n \nstatic int\ninet_pton4 (const char *restrict src, unsigned char *restrict dst)\n{\n  int saw_digit, octets, ch;\n  unsigned char tmp[NS_INADDRSZ], *tp;\n\n  saw_digit = 0;\n  octets = 0;\n  *(tp = tmp) = 0;\n  while ((ch = *src++) != '\\0')\n    {\n\n      if (ch >= '0' && ch <= '9')\n        {\n          unsigned new = *tp * 10 + (ch - '0');\n\n          if (saw_digit && *tp == 0)\n            return (0);\n          if (new > 255)\n            return (0);\n          *tp = new;\n          if (!saw_digit)\n            {\n              if (++octets > 4)\n                return (0);\n              saw_digit = 1;\n            }\n        }\n      else if (ch == '.' && saw_digit)\n        {\n          if (octets == 4)\n            return (0);\n          *++tp = 0;\n          saw_digit = 0;\n        }\n      else\n        return (0);\n    }\n  if (octets < 4)\n    return (0);\n  memcpy (dst, tmp, NS_INADDRSZ);\n  return (1);\n}\n\n# if HAVE_IPV6\n\n \nstatic int\ninet_pton6 (const char *restrict src, unsigned char *restrict dst)\n{\n  static const char xdigits[] = \"0123456789abcdef\";\n  unsigned char tmp[NS_IN6ADDRSZ], *tp, *endp, *colonp;\n  const char *curtok;\n  int ch, saw_xdigit;\n  unsigned val;\n\n  tp = memset (tmp, '\\0', NS_IN6ADDRSZ);\n  endp = tp + NS_IN6ADDRSZ;\n  colonp = NULL;\n   \n  if (*src == ':')\n    if (*++src != ':')\n      return (0);\n  curtok = src;\n  saw_xdigit = 0;\n  val = 0;\n  while ((ch = c_tolower (*src++)) != '\\0')\n    {\n      const char *pch;\n\n      pch = strchr (xdigits, ch);\n      if (pch != NULL)\n        {\n          val <<= 4;\n          val |= (pch - xdigits);\n          if (val > 0xffff)\n            return (0);\n          saw_xdigit = 1;\n          continue;\n        }\n      if (ch == ':')\n        {\n          curtok = src;\n          if (!saw_xdigit)\n            {\n              if (colonp)\n                return (0);\n              colonp = tp;\n              continue;\n            }\n          else if (*src == '\\0')\n            {\n              return (0);\n            }\n          if (tp + NS_INT16SZ > endp)\n            return (0);\n          *tp++ = (u_char) (val >> 8) & 0xff;\n          *tp++ = (u_char) val & 0xff;\n          saw_xdigit = 0;\n          val = 0;\n          continue;\n        }\n      if (ch == '.' && ((tp + NS_INADDRSZ) <= endp) &&\n          inet_pton4 (curtok, tp) > 0)\n        {\n          tp += NS_INADDRSZ;\n          saw_xdigit = 0;\n          break;                 \n        }\n      return (0);\n    }\n  if (saw_xdigit)\n    {\n      if (tp + NS_INT16SZ > endp)\n        return (0);\n      *tp++ = (u_char) (val >> 8) & 0xff;\n      *tp++ = (u_char) val & 0xff;\n    }\n  if (colonp != NULL)\n    {\n       \n      const int n = tp - colonp;\n      int i;\n\n      if (tp == endp)\n        return (0);\n      for (i = 1; i <= n; i++)\n        {\n          endp[-i] = colonp[n - i];\n          colonp[n - i] = 0;\n        }\n      tp = endp;\n    }\n  if (tp != endp)\n    return (0);\n  memcpy (dst, tmp, NS_IN6ADDRSZ);\n  return (1);\n}\n\n# endif\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}