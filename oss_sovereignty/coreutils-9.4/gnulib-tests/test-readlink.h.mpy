{
  "module_name": "test-readlink.h",
  "hash_id": "535c931b7512105502b6dc06d144dd772863816f4348b0223dd65b4ee61b0615",
  "original_prompt": "Ingested from coreutils-9.4/gnulib-tests/test-readlink.h",
  "human_readable_source": " \n\n \n\nstatic int\ntest_readlink (ssize_t (*func) (char const *, char *, size_t), bool print)\n{\n  char buf[80];\n\n   \n  memset (buf, 0xff, sizeof buf);\n  errno = 0;\n  ASSERT (func (\"no_such\", buf, sizeof buf) == -1);\n  ASSERT (errno == ENOENT);\n  errno = 0;\n  ASSERT (func (\"no_such/\", buf, sizeof buf) == -1);\n  ASSERT (errno == ENOENT);\n  errno = 0;\n  ASSERT (func (\"\", buf, sizeof buf) == -1);\n  ASSERT (errno == ENOENT || errno == EINVAL);\n  errno = 0;\n  ASSERT (func (\".\", buf, sizeof buf) == -1);\n  ASSERT (errno == EINVAL);\n  errno = 0;\n  ASSERT (func (\"./\", buf, sizeof buf) == -1);\n  ASSERT (errno == EINVAL);\n  ASSERT (close (creat (BASE \"file\", 0600)) == 0);\n  errno = 0;\n  ASSERT (func (BASE \"file\", buf, sizeof buf) == -1);\n  ASSERT (errno == EINVAL);\n  errno = 0;\n  ASSERT (func (BASE \"file/\", buf, sizeof buf) == -1);\n  ASSERT (errno == ENOTDIR || errno == EINVAL);  \n\n   \n  if (symlink (BASE \"dir\", BASE \"link\"))\n    {\n      ASSERT (unlink (BASE \"file\") == 0);\n      if (print)\n        fputs (\"skipping test: symlinks not supported on this file system\\n\",\n               stderr);\n      return 77;\n    }\n  ASSERT (mkdir (BASE \"dir\", 0700) == 0);\n  errno = 0;\n  ASSERT (func (BASE \"link/\", buf, sizeof buf) == -1);\n  ASSERT (errno == EINVAL);\n  ASSERT (symlink (BASE \"link\", BASE \"link2\") == 0);\n  errno = 0;\n  ASSERT (func (BASE \"link2/\", buf, sizeof buf) == -1);\n  ASSERT (errno == EINVAL);\n  ASSERT (unlink (BASE \"link2\") == 0);\n  ASSERT (symlink (BASE \"file\", BASE \"link2\") == 0);\n  errno = 0;\n  ASSERT (func (BASE \"link2/\", buf, sizeof buf) == -1);\n  ASSERT (errno == ENOTDIR || errno == EINVAL);  \n  ASSERT (unlink (BASE \"file\") == 0);\n  ASSERT (unlink (BASE \"link2\") == 0);\n  {\n     \n    int i;\n    for (i = 0; i < sizeof buf; i++)\n      ASSERT (buf[i] == (char) 0xff);\n  }\n  {\n    size_t len = strlen (BASE \"dir\");\n     \n    ssize_t result;\n    errno = 0;\n    result = readlink (BASE \"link\", buf, 1);\n    if (result == -1)\n      {\n        ASSERT (errno == ERANGE);\n        ASSERT (buf[0] == (char) 0xff);\n      }\n    else\n      {\n        ASSERT (result == 1);\n        ASSERT (buf[0] == BASE[0]);\n      }\n    ASSERT (buf[1] == (char) 0xff);\n    ASSERT (func (BASE \"link\", buf, len) == len);\n    ASSERT (strncmp (buf, BASE \"dir\", len) == 0);\n    ASSERT (buf[len] == (char) 0xff);\n    ASSERT (func (BASE \"link\", buf, sizeof buf) == len);\n    ASSERT (strncmp (buf, BASE \"dir\", len) == 0);\n     \n    ASSERT (buf[len] == '\\0' || buf[len] == (char) 0xff);\n  }\n  ASSERT (rmdir (BASE \"dir\") == 0);\n  ASSERT (unlink (BASE \"link\") == 0);\n\n  return 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}