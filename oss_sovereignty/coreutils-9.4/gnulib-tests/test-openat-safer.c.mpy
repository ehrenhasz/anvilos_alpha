{
  "module_name": "test-openat-safer.c",
  "hash_id": "6d5b09b6ef5547b16b2d7c1873b523f4560999c1baa7e2cf3c6c092e344c40ea",
  "original_prompt": "Ingested from coreutils-9.4/gnulib-tests/test-openat-safer.c",
  "human_readable_source": " \n\n#include <config.h>\n\n#include \"fcntl--.h\"\n\n#include <errno.h>\n#include <stdio.h>\n#include <sys/stat.h>\n#include <unistd.h>\n\n \n\n#define BACKUP_STDERR_FILENO 10\n#define ASSERT_STREAM myerr\n#include \"macros.h\"\n\nstatic FILE *myerr;\n\n#define witness \"test-openat-safer.txt\"\n\nint\nmain (void)\n{\n  int i;\n  int j;\n  int dfd;\n  int fd;\n  char buf[2];\n\n   \n  if (dup2 (STDERR_FILENO, BACKUP_STDERR_FILENO) != BACKUP_STDERR_FILENO\n      || (myerr = fdopen (BACKUP_STDERR_FILENO, \"w\")) == NULL)\n    return 2;\n\n   \n  dfd = openat (AT_FDCWD, \".\", O_RDONLY);\n  ASSERT (STDERR_FILENO < dfd);\n\n   \n  remove (witness);\n  fd = openat (dfd, witness, O_WRONLY | O_CREAT | O_EXCL, 0600);\n  ASSERT (STDERR_FILENO < fd);\n  ASSERT (write (fd, \"hi\", 2) == 2);\n  ASSERT (close (fd) == 0);\n\n   \n  for (i = -1; i <= STDERR_FILENO; i++)\n    {\n      ASSERT (fchdir (dfd) == 0);\n      if (0 <= i)\n        ASSERT (close (i) == 0);\n\n       \n      for (j = 0; j <= 1; j++)\n        {\n          if (j)\n            ASSERT (chdir (\"..\") == 0);\n\n           \n          errno = 0;\n          ASSERT (openat (AT_FDCWD, \"\", O_RDONLY) == -1);\n          ASSERT (errno == ENOENT);\n          errno = 0;\n          ASSERT (openat (dfd, \"\", O_RDONLY) == -1);\n          ASSERT (errno == ENOENT);\n          errno = 0;\n          ASSERT (openat (-1, \".\", O_RDONLY) == -1);\n          ASSERT (errno == EBADF);\n\n           \n          errno = 0;\n          ASSERT (openat (dfd, \"nonexist.ent/\", O_CREAT | O_RDONLY,\n                          S_IRUSR | S_IWUSR) == -1);\n          ASSERT (errno == ENOTDIR || errno == EISDIR || errno == ENOENT\n                  || errno == EINVAL);\n          errno = 0;\n          ASSERT (openat (dfd, witness \"/\", O_RDONLY) == -1);\n          ASSERT (errno == ENOTDIR || errno == EISDIR || errno == EINVAL);\n#if defined __linux__ || defined __ANDROID__\n           \n          fd = openat (-1, \"/dev/null\", O_WRONLY);\n          ASSERT (STDERR_FILENO < fd);\n#endif\n           \n          errno = 0;\n          fd = open (\"/dev/null\", O_RDONLY);\n          ASSERT (STDERR_FILENO < fd);\n          ASSERT (openat (fd, \".\", O_RDONLY) == -1);\n          ASSERT (errno == EBADF || errno == ENOTDIR);\n          ASSERT (close (fd) == 0);\n\n           \n          fd = openat (dfd, witness, O_RDONLY | O_NOFOLLOW);\n          ASSERT (STDERR_FILENO < fd);\n          ASSERT (read (fd, buf, 2) == 2);\n          ASSERT (buf[0] == 'h' && buf[1] == 'i');\n          ASSERT (close (fd) == 0);\n        }\n    }\n  ASSERT (fchdir (dfd) == 0);\n  ASSERT (unlink (witness) == 0);\n  ASSERT (close (dfd) == 0);\n\n  return 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}