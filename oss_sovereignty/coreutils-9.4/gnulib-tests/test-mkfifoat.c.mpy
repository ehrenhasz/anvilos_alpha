{
  "module_name": "test-mkfifoat.c",
  "hash_id": "c21e5e33e3e78d67e1f0c185495f117257ba47db511e96abea6c28bb7072dbab",
  "original_prompt": "Ingested from coreutils-9.4/gnulib-tests/test-mkfifoat.c",
  "human_readable_source": " \n\n#include <config.h>\n\n#include <sys/stat.h>\n\n#include \"signature.h\"\nSIGNATURE_CHECK (mkfifoat, int, (int, char const *, mode_t));\nSIGNATURE_CHECK (mknodat, int, (int, char const *, mode_t, dev_t));\n\n#include <fcntl.h>\n#include <errno.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <unistd.h>\n\n#include \"ignore-value.h\"\n#include \"macros.h\"\n\n#define BASE \"test-mkfifoat.t\"\n\n#include \"test-mkfifo.h\"\n\ntypedef int (*test_func) (int, char const *, mode_t);\n\nstatic int dfd = AT_FDCWD;\n\n \nstatic int\ntest_mknodat (int fd, char const *name, mode_t mode)\n{\n   \n  return mknodat (fd, name, mode | S_IFIFO, 0);\n}\n\n \nstatic int\ndo_mkfifoat (char const *name, mode_t mode)\n{\n  return mkfifoat (dfd, name, mode);\n}\n\n \nstatic int\ndo_mknodat (char const *name, mode_t mode)\n{\n  return mknodat (dfd, name, mode | S_IFIFO, 0);\n}\n\nint\nmain (void)\n{\n  int i;\n  test_func funcs[2] = { mkfifoat, test_mknodat };\n  int result;\n\n   \n  ignore_value (system (\"rm -rf \" BASE \"*\"));\n\n   \n  result = test_mkfifo (do_mkfifoat, true);\n  ASSERT (test_mkfifo (do_mknodat, false) == result);\n  dfd = open (\".\", O_RDONLY);\n  ASSERT (0 <= dfd);\n  ASSERT (test_mkfifo (do_mkfifoat, false) == result);\n  ASSERT (test_mkfifo (do_mknodat, false) == result);\n\n   \n  for (i = 0; i < 2; i++)\n    {\n      struct stat st;\n      test_func func = funcs[i];\n\n       \n      {\n        errno = 0;\n        ASSERT (func (-1, \"foo\", 0600) == -1);\n        ASSERT (errno == EBADF\n                || errno == ENOSYS  \n               );\n      }\n      {\n        close (99);\n        errno = 0;\n        ASSERT (func (99, \"foo\", 0600) == -1);\n        ASSERT (errno == EBADF\n                || errno == ENOSYS  \n               );\n      }\n\n       \n      if (func (AT_FDCWD, BASE \"fifo\", 0600) != 0)\n        ASSERT (errno == ENOSYS);  \n      else\n        {\n          errno = 0;\n          ASSERT (func (dfd, BASE \"fifo\", 0600) == -1);\n          ASSERT (errno == EEXIST);\n          ASSERT (chdir (\"..\") == 0);\n          errno = 0;\n          ASSERT (fstatat (AT_FDCWD, BASE \"fifo\", &st, 0) == -1);\n          ASSERT (errno == ENOENT);\n          memset (&st, 0, sizeof st);\n          ASSERT (fstatat (dfd, BASE \"fifo\", &st, 0) == 0);\n          ASSERT (S_ISFIFO (st.st_mode));\n          ASSERT (unlinkat (dfd, BASE \"fifo\", 0) == 0);\n        }\n\n       \n      if (func (dfd, BASE \"fifo\", 0600) != 0)\n        ASSERT (errno == ENOSYS);  \n      else\n        {\n          ASSERT (fchdir (dfd) == 0);\n          errno = 0;\n          ASSERT (func (AT_FDCWD, BASE \"fifo\", 0600) == -1);\n          ASSERT (errno == EEXIST);\n          memset (&st, 0, sizeof st);\n          ASSERT (fstatat (AT_FDCWD, BASE \"fifo\", &st, AT_SYMLINK_NOFOLLOW)\n                  == 0);\n          ASSERT (S_ISFIFO (st.st_mode));\n          memset (&st, 0, sizeof st);\n          ASSERT (fstatat (dfd, BASE \"fifo\", &st, AT_SYMLINK_NOFOLLOW) == 0);\n          ASSERT (S_ISFIFO (st.st_mode));\n          ASSERT (unlink (BASE \"fifo\") == 0);\n        }\n    }\n\n  ASSERT (close (dfd) == 0);\n\n  return 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}