{
  "module_name": "tmpfile.c",
  "hash_id": "19cf049ee890f2e9606d443a8adb4c40f1ec70a416ee81bb21b82c2ff577ee3a",
  "original_prompt": "Ingested from coreutils-9.4/gnulib-tests/tmpfile.c",
  "human_readable_source": " \n\n#include <config.h>\n\n \n#include <stdio.h>\n\n#include <errno.h>\n\n#if defined _WIN32 && ! defined __CYGWIN__\n \n\n# include <fcntl.h>\n# include <string.h>\n# include <sys/stat.h>\n\n# include <io.h>\n\n# define WIN32_LEAN_AND_MEAN   \n# include <windows.h>\n\n#else\n\n# include <unistd.h>\n\n#endif\n\n#include \"pathmax.h\"\n#include \"tempname.h\"\n#include \"tmpdir.h\"\n\n \n\n#if defined _WIN32 && ! defined __CYGWIN__\n \n\n \n# undef OSVERSIONINFO\n# define OSVERSIONINFO OSVERSIONINFOA\n# undef GetVersionEx\n# define GetVersionEx GetVersionExA\n# undef GetTempPath\n# define GetTempPath GetTempPathA\n\n \n\nstatic bool\nsupports_delete_on_close ()\n{\n  static int known;  \n  if (!known)\n    {\n      OSVERSIONINFO v;\n\n       \n      v.dwOSVersionInfoSize = sizeof (OSVERSIONINFO);\n\n      if (GetVersionEx (&v))\n        known = (v.dwPlatformId == VER_PLATFORM_WIN32_NT ? 1 : -1);\n      else\n        known = -1;\n    }\n  return (known > 0);\n}\n\nFILE *\ntmpfile (void)\n{\n  char dir[PATH_MAX];\n  DWORD retval;\n\n   \n  retval = GetTempPath (PATH_MAX, dir);\n  if (retval > 0 && retval < PATH_MAX)\n    {\n      char xtemplate[PATH_MAX];\n\n      if (path_search (xtemplate, PATH_MAX, dir, NULL, true) >= 0)\n        {\n          size_t len = strlen (xtemplate);\n          int o_temporary = (supports_delete_on_close () ? _O_TEMPORARY : 0);\n          int fd;\n\n          do\n            {\n              memcpy (&xtemplate[len - 6], \"XXXXXX\", 6);\n              if (gen_tempname (xtemplate, 0, 0, GT_NOCREATE) < 0)\n                {\n                  fd = -1;\n                  break;\n                }\n\n              fd = _open (xtemplate,\n                          _O_CREAT | _O_EXCL | o_temporary\n                          | _O_RDWR | _O_BINARY,\n                          _S_IREAD | _S_IWRITE);\n            }\n          while (fd < 0 && errno == EEXIST);\n\n          if (fd >= 0)\n            {\n              FILE *fp = _fdopen (fd, \"w+b\");\n\n              if (fp != NULL)\n                return fp;\n              else\n                {\n                  int saved_errno = errno;\n                  _close (fd);\n                  errno = saved_errno;\n                }\n            }\n        }\n    }\n  else\n    {\n      if (retval > 0)\n        errno = ENAMETOOLONG;\n      else\n         \n        errno = ENOENT;\n    }\n\n  return NULL;\n}\n\n#else\n\nFILE *\ntmpfile (void)\n{\n  char buf[PATH_MAX];\n  int fd;\n  FILE *fp;\n\n   \n\n  if (path_search (buf, sizeof buf, NULL, \"tmpf\", true))\n    return NULL;\n\n  fd = gen_tempname (buf, 0, 0, GT_FILE);\n  if (fd < 0)\n    return NULL;\n\n   \n  (void) unlink (buf);\n\n  if ((fp = fdopen (fd, \"w+b\")) == NULL)\n    {\n      int saved_errno = errno;\n      close (fd);\n      errno = saved_errno;\n    }\n\n  return fp;\n}\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}