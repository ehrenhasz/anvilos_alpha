{
  "module_name": "setlocale.c",
  "hash_id": "78f1c0b71563963d8cfbd2a69749c39e0e2f5ebaf9ff0202d4ca00f2e947d598",
  "original_prompt": "Ingested from coreutils-9.4/gnulib-tests/setlocale.c",
  "human_readable_source": " \n\n#include <config.h>\n\n \n\n \n\n \n#include <locale.h>\n\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n\n#include \"localename.h\"\n\n#if HAVE_CFLOCALECOPYPREFERREDLANGUAGES || HAVE_CFPREFERENCESCOPYAPPVALUE\n# if HAVE_CFLOCALECOPYPREFERREDLANGUAGES\n#  include <CoreFoundation/CFLocale.h>\n# elif HAVE_CFPREFERENCESCOPYAPPVALUE\n#  include <CoreFoundation/CFPreferences.h>\n# endif\n# include <CoreFoundation/CFPropertyList.h>\n# include <CoreFoundation/CFArray.h>\n# include <CoreFoundation/CFString.h>\nextern void gl_locale_name_canonicalize (char *name);\n#endif\n\n#if 1\n\n# undef setlocale\n\n \n# if NEED_SETLOCALE_IMPROVED\n#  define setlocale_improved rpl_setlocale\n# elif NEED_SETLOCALE_MTSAFE\n#  define setlocale_mtsafe rpl_setlocale\n# else\n#  error \"This file should only be compiled if NEED_SETLOCALE_IMPROVED || NEED_SETLOCALE_MTSAFE.\"\n# endif\n\n \n# if !SETLOCALE_NULL_ALL_MTSAFE || !SETLOCALE_NULL_ONE_MTSAFE  \n\n#  if NEED_SETLOCALE_IMPROVED\nstatic\n#  endif\nchar *\nsetlocale_mtsafe (int category, const char *locale)\n{\n  if (locale == NULL)\n    return (char *) setlocale_null (category);\n  else\n    return setlocale (category, locale);\n}\n# else  \n\n#  define setlocale_mtsafe setlocale\n\n# endif  \n\n# if NEED_SETLOCALE_IMPROVED\n\n \nstatic const char *\ncategory_to_name (int category)\n{\n  const char *retval;\n\n  switch (category)\n  {\n  case LC_COLLATE:\n    retval = \"LC_COLLATE\";\n    break;\n  case LC_CTYPE:\n    retval = \"LC_CTYPE\";\n    break;\n  case LC_MONETARY:\n    retval = \"LC_MONETARY\";\n    break;\n  case LC_NUMERIC:\n    retval = \"LC_NUMERIC\";\n    break;\n  case LC_TIME:\n    retval = \"LC_TIME\";\n    break;\n  case LC_MESSAGES:\n    retval = \"LC_MESSAGES\";\n    break;\n  default:\n     \n    retval = \"LC_XXX\";\n  }\n\n  return retval;\n}\n\n#  if defined _WIN32 && ! defined __CYGWIN__\n\n \n\n \nstruct table_entry\n{\n  const char *code;\n  const char *english;\n};\nstatic const struct table_entry language_table[] =\n  {\n    { \"af\", \"Afrikaans\" },\n    { \"am\", \"Amharic\" },\n    { \"ar\", \"Arabic\" },\n    { \"arn\", \"Mapudungun\" },\n    { \"as\", \"Assamese\" },\n    { \"az@cyrillic\", \"Azeri (Cyrillic)\" },\n    { \"az@latin\", \"Azeri (Latin)\" },\n    { \"ba\", \"Bashkir\" },\n    { \"be\", \"Belarusian\" },\n    { \"ber\", \"Tamazight\" },\n    { \"ber@arabic\", \"Tamazight (Arabic)\" },\n    { \"ber@latin\", \"Tamazight (Latin)\" },\n    { \"bg\", \"Bulgarian\" },\n    { \"bin\", \"Edo\" },\n    { \"bn\", \"Bengali\" },\n    { \"bn_BD\", \"Bengali (Bangladesh)\" },\n    { \"bn_IN\", \"Bengali (India)\" },\n    { \"bnt\", \"Sutu\" },\n    { \"bo\", \"Tibetan\" },\n    { \"br\", \"Breton\" },\n    { \"bs\", \"BSB\" },  \n    { \"bs@cyrillic\", \"BSC\" },  \n    { \"ca\", \"Catalan\" },\n    { \"chr\", \"Cherokee\" },\n    { \"co\", \"Corsican\" },\n    { \"cpe\", \"Hawaiian\" },\n    { \"cs\", \"Czech\" },\n    { \"cy\", \"Welsh\" },\n    { \"da\", \"Danish\" },\n    { \"de\", \"German\" },\n    { \"dsb\", \"Lower Sorbian\" },\n    { \"dv\", \"Divehi\" },\n    { \"el\", \"Greek\" },\n    { \"en\", \"English\" },\n    { \"es\", \"Spanish\" },\n    { \"et\", \"Estonian\" },\n    { \"eu\", \"Basque\" },\n    { \"fa\", \"Farsi\" },\n    { \"ff\", \"Fulfulde\" },\n    { \"fi\", \"Finnish\" },\n    { \"fo\", \"Faroese\" },  \n    { \"fr\", \"French\" },\n    { \"fy\", \"Frisian\" },\n    { \"ga\", \"IRE\" },  \n    { \"gd\", \"Gaelic (Scotland)\" },\n    { \"gd\", \"Scottish Gaelic\" },\n    { \"gl\", \"Galician\" },\n    { \"gn\", \"Guarani\" },\n    { \"gsw\", \"Alsatian\" },\n    { \"gu\", \"Gujarati\" },\n    { \"ha\", \"Hausa\" },\n    { \"he\", \"Hebrew\" },\n    { \"hi\", \"Hindi\" },\n    { \"hr\", \"Croatian\" },\n    { \"hsb\", \"Upper Sorbian\" },\n    { \"hu\", \"Hungarian\" },\n    { \"hy\", \"Armenian\" },\n    { \"id\", \"Indonesian\" },\n    { \"ig\", \"Igbo\" },\n    { \"ii\", \"Yi\" },\n    { \"is\", \"Icelandic\" },\n    { \"it\", \"Italian\" },\n    { \"iu\", \"IUK\" },  \n    { \"ja\", \"Japanese\" },\n    { \"ka\", \"Georgian\" },\n    { \"kk\", \"Kazakh\" },\n    { \"kl\", \"Greenlandic\" },\n    { \"km\", \"Cambodian\" },\n    { \"km\", \"Khmer\" },\n    { \"kn\", \"Kannada\" },\n    { \"ko\", \"Korean\" },\n    { \"kok\", \"Konkani\" },\n    { \"kr\", \"Kanuri\" },\n    { \"ks\", \"Kashmiri\" },\n    { \"ks_IN\", \"Kashmiri_India\" },\n    { \"ks_PK\", \"Kashmiri (Arabic)_Pakistan\" },\n    { \"ky\", \"Kyrgyz\" },\n    { \"la\", \"Latin\" },\n    { \"lb\", \"Luxembourgish\" },\n    { \"lo\", \"Lao\" },\n    { \"lt\", \"Lithuanian\" },\n    { \"lv\", \"Latvian\" },\n    { \"mi\", \"Maori\" },\n    { \"mk\", \"FYRO Macedonian\" },\n    { \"mk\", \"Macedonian\" },\n    { \"ml\", \"Malayalam\" },\n    { \"mn\", \"Mongolian\" },\n    { \"mni\", \"Manipuri\" },\n    { \"moh\", \"Mohawk\" },\n    { \"mr\", \"Marathi\" },\n    { \"ms\", \"Malay\" },\n    { \"mt\", \"Maltese\" },\n    { \"my\", \"Burmese\" },\n    { \"nb\", \"NOR\" },  \n    { \"ne\", \"Nepali\" },\n    { \"nic\", \"Ibibio\" },\n    { \"nl\", \"Dutch\" },\n    { \"nn\", \"NON\" },  \n    { \"no\", \"Norwegian\" },\n    { \"nso\", \"Northern Sotho\" },\n    { \"nso\", \"Sepedi\" },\n    { \"oc\", \"Occitan\" },\n    { \"om\", \"Oromo\" },\n    { \"or\", \"Oriya\" },\n    { \"pa\", \"Punjabi\" },\n    { \"pap\", \"Papiamentu\" },\n    { \"pl\", \"Polish\" },\n    { \"prs\", \"Dari\" },\n    { \"ps\", \"Pashto\" },\n    { \"pt\", \"Portuguese\" },\n    { \"qu\", \"Quechua\" },\n    { \"qut\", \"K'iche'\" },\n    { \"rm\", \"Romansh\" },\n    { \"ro\", \"Romanian\" },\n    { \"ru\", \"Russian\" },\n    { \"rw\", \"Kinyarwanda\" },\n    { \"sa\", \"Sanskrit\" },\n    { \"sah\", \"Yakut\" },\n    { \"sd\", \"Sindhi\" },\n    { \"se\", \"Sami (Northern)\" },\n    { \"se\", \"Northern Sami\" },\n    { \"si\", \"Sinhalese\" },\n    { \"sk\", \"Slovak\" },\n    { \"sl\", \"Slovenian\" },\n    { \"sma\", \"Sami (Southern)\" },\n    { \"sma\", \"Southern Sami\" },\n    { \"smj\", \"Sami (Lule)\" },\n    { \"smj\", \"Lule Sami\" },\n    { \"smn\", \"Sami (Inari)\" },\n    { \"smn\", \"Inari Sami\" },\n    { \"sms\", \"Sami (Skolt)\" },\n    { \"sms\", \"Skolt Sami\" },\n    { \"so\", \"Somali\" },\n    { \"sq\", \"Albanian\" },\n    { \"sr\", \"Serbian (Latin)\" },\n    { \"sr@cyrillic\", \"SRB\" },  \n    { \"sv\", \"Swedish\" },\n    { \"sw\", \"Swahili\" },\n    { \"syr\", \"Syriac\" },\n    { \"ta\", \"Tamil\" },\n    { \"te\", \"Telugu\" },\n    { \"tg\", \"Tajik\" },\n    { \"th\", \"Thai\" },\n    { \"ti\", \"Tigrinya\" },\n    { \"tk\", \"Turkmen\" },\n    { \"tl\", \"Filipino\" },\n    { \"tn\", \"Tswana\" },\n    { \"tr\", \"Turkish\" },\n    { \"ts\", \"Tsonga\" },\n    { \"tt\", \"Tatar\" },\n    { \"ug\", \"Uighur\" },\n    { \"uk\", \"Ukrainian\" },\n    { \"ur\", \"Urdu\" },\n    { \"uz\", \"Uzbek\" },\n    { \"uz\", \"Uzbek (Latin)\" },\n    { \"uz@cyrillic\", \"Uzbek (Cyrillic)\" },\n    { \"ve\", \"Venda\" },\n    { \"vi\", \"Vietnamese\" },\n    { \"wen\", \"Sorbian\" },\n    { \"wo\", \"Wolof\" },\n    { \"xh\", \"Xhosa\" },\n    { \"yi\", \"Yiddish\" },\n    { \"yo\", \"Yoruba\" },\n    { \"zh\", \"Chinese\" },\n    { \"zu\", \"Zulu\" }\n  };\n\n \nstatic const struct table_entry country_table[] =\n  {\n    { \"AE\", \"U.A.E.\" },\n    { \"AF\", \"Afghanistan\" },\n    { \"AL\", \"Albania\" },\n    { \"AM\", \"Armenia\" },\n    { \"AN\", \"Netherlands Antilles\" },\n    { \"AR\", \"Argentina\" },\n    { \"AT\", \"Austria\" },\n    { \"AU\", \"Australia\" },\n    { \"AZ\", \"Azerbaijan\" },\n    { \"BA\", \"Bosnia and Herzegovina\" },\n    { \"BD\", \"Bangladesh\" },\n    { \"BE\", \"Belgium\" },\n    { \"BG\", \"Bulgaria\" },\n    { \"BH\", \"Bahrain\" },\n    { \"BN\", \"Brunei Darussalam\" },\n    { \"BO\", \"Bolivia\" },\n    { \"BR\", \"Brazil\" },\n    { \"BT\", \"Bhutan\" },\n    { \"BY\", \"Belarus\" },\n    { \"BZ\", \"Belize\" },\n    { \"CA\", \"Canada\" },\n    { \"CG\", \"Congo\" },\n    { \"CH\", \"Switzerland\" },\n    { \"CI\", \"Cote d'Ivoire\" },\n    { \"CL\", \"Chile\" },\n    { \"CM\", \"Cameroon\" },\n    { \"CN\", \"People's Republic of China\" },\n    { \"CO\", \"Colombia\" },\n    { \"CR\", \"Costa Rica\" },\n    { \"CS\", \"Serbia and Montenegro\" },\n    { \"CZ\", \"Czech Republic\" },\n    { \"DE\", \"Germany\" },\n    { \"DK\", \"Denmark\" },\n    { \"DO\", \"Dominican Republic\" },\n    { \"DZ\", \"Algeria\" },\n    { \"EC\", \"Ecuador\" },\n    { \"EE\", \"Estonia\" },\n    { \"EG\", \"Egypt\" },\n    { \"ER\", \"Eritrea\" },\n    { \"ES\", \"Spain\" },\n    { \"ET\", \"Ethiopia\" },\n    { \"FI\", \"Finland\" },\n    { \"FO\", \"Faroe Islands\" },\n    { \"FR\", \"France\" },\n    { \"GB\", \"United Kingdom\" },\n    { \"GD\", \"Caribbean\" },\n    { \"GE\", \"Georgia\" },\n    { \"GL\", \"Greenland\" },\n    { \"GR\", \"Greece\" },\n    { \"GT\", \"Guatemala\" },\n    { \"HK\", \"Hong Kong\" },\n    { \"HK\", \"Hong Kong S.A.R.\" },\n    { \"HN\", \"Honduras\" },\n    { \"HR\", \"Croatia\" },\n    { \"HT\", \"Haiti\" },\n    { \"HU\", \"Hungary\" },\n    { \"ID\", \"Indonesia\" },\n    { \"IE\", \"Ireland\" },\n    { \"IL\", \"Israel\" },\n    { \"IN\", \"India\" },\n    { \"IQ\", \"Iraq\" },\n    { \"IR\", \"Iran\" },\n    { \"IS\", \"Iceland\" },\n    { \"IT\", \"Italy\" },\n    { \"JM\", \"Jamaica\" },\n    { \"JO\", \"Jordan\" },\n    { \"JP\", \"Japan\" },\n    { \"KE\", \"Kenya\" },\n    { \"KG\", \"Kyrgyzstan\" },\n    { \"KH\", \"Cambodia\" },\n    { \"KR\", \"South Korea\" },\n    { \"KW\", \"Kuwait\" },\n    { \"KZ\", \"Kazakhstan\" },\n    { \"LA\", \"Laos\" },\n    { \"LB\", \"Lebanon\" },\n    { \"LI\", \"Liechtenstein\" },\n    { \"LK\", \"Sri Lanka\" },\n    { \"LT\", \"Lithuania\" },\n    { \"LU\", \"Luxembourg\" },\n    { \"LV\", \"Latvia\" },\n    { \"LY\", \"Libya\" },\n    { \"MA\", \"Morocco\" },\n    { \"MC\", \"Principality of Monaco\" },\n    { \"MD\", \"Moldava\" },\n    { \"MD\", \"Moldova\" },\n    { \"ME\", \"Montenegro\" },\n    { \"MK\", \"Former Yugoslav Republic of Macedonia\" },\n    { \"ML\", \"Mali\" },\n    { \"MM\", \"Myanmar\" },\n    { \"MN\", \"Mongolia\" },\n    { \"MO\", \"Macau S.A.R.\" },\n    { \"MT\", \"Malta\" },\n    { \"MV\", \"Maldives\" },\n    { \"MX\", \"Mexico\" },\n    { \"MY\", \"Malaysia\" },\n    { \"NG\", \"Nigeria\" },\n    { \"NI\", \"Nicaragua\" },\n    { \"NL\", \"Netherlands\" },\n    { \"NO\", \"Norway\" },\n    { \"NP\", \"Nepal\" },\n    { \"NZ\", \"New Zealand\" },\n    { \"OM\", \"Oman\" },\n    { \"PA\", \"Panama\" },\n    { \"PE\", \"Peru\" },\n    { \"PH\", \"Philippines\" },\n    { \"PK\", \"Islamic Republic of Pakistan\" },\n    { \"PL\", \"Poland\" },\n    { \"PR\", \"Puerto Rico\" },\n    { \"PT\", \"Portugal\" },\n    { \"PY\", \"Paraguay\" },\n    { \"QA\", \"Qatar\" },\n    { \"RE\", \"Reunion\" },\n    { \"RO\", \"Romania\" },\n    { \"RS\", \"Serbia\" },\n    { \"RU\", \"Russia\" },\n    { \"RW\", \"Rwanda\" },\n    { \"SA\", \"Saudi Arabia\" },\n    { \"SE\", \"Sweden\" },\n    { \"SG\", \"Singapore\" },\n    { \"SI\", \"Slovenia\" },\n    { \"SK\", \"Slovak\" },\n    { \"SN\", \"Senegal\" },\n    { \"SO\", \"Somalia\" },\n    { \"SR\", \"Suriname\" },\n    { \"SV\", \"El Salvador\" },\n    { \"SY\", \"Syria\" },\n    { \"TH\", \"Thailand\" },\n    { \"TJ\", \"Tajikistan\" },\n    { \"TM\", \"Turkmenistan\" },\n    { \"TN\", \"Tunisia\" },\n    { \"TR\", \"Turkey\" },\n    { \"TT\", \"Trinidad and Tobago\" },\n    { \"TW\", \"Taiwan\" },\n    { \"TZ\", \"Tanzania\" },\n    { \"UA\", \"Ukraine\" },\n    { \"US\", \"United States\" },\n    { \"UY\", \"Uruguay\" },\n    { \"VA\", \"Vatican\" },\n    { \"VE\", \"Venezuela\" },\n    { \"VN\", \"Viet Nam\" },\n    { \"YE\", \"Yemen\" },\n    { \"ZA\", \"South Africa\" },\n    { \"ZW\", \"Zimbabwe\" }\n  };\n\n \ntypedef struct { size_t lo; size_t hi; } range_t;\nstatic void\nsearch (const struct table_entry *table, size_t table_size, const char *string,\n        range_t *result)\n{\n   \n  size_t hi = table_size;\n  size_t lo = 0;\n  while (lo < hi)\n    {\n       \n      size_t mid = (hi + lo) >> 1;  \n      int cmp = strcmp (table[mid].code, string);\n      if (cmp < 0)\n        lo = mid + 1;\n      else if (cmp > 0)\n        hi = mid;\n      else\n        {\n           \n          {\n            size_t i;\n\n            for (i = mid; i > lo; )\n              {\n                i--;\n                if (strcmp (table[i].code, string) < 0)\n                  {\n                    lo = i + 1;\n                    break;\n                  }\n              }\n          }\n          {\n            size_t i;\n\n            for (i = mid + 1; i < hi; i++)\n              {\n                if (strcmp (table[i].code, string) > 0)\n                  {\n                    hi = i;\n                    break;\n                  }\n              }\n          }\n           \n          break;\n        }\n    }\n  result->lo = lo;\n  result->hi = hi;\n}\n\n \nstatic char *\nsetlocale_unixlike (int category, const char *locale)\n{\n  char *result;\n  char llCC_buf[64];\n  char ll_buf[64];\n  char CC_buf[64];\n\n   \n  if (locale != NULL && strcmp (locale, \"POSIX\") == 0)\n    locale = \"C\";\n\n   \n  result = setlocale_mtsafe (category, locale);\n  if (result != NULL)\n    return result;\n\n   \n  if (strlen (locale) < sizeof (llCC_buf))\n    {\n       \n      {\n        const char *p = locale;\n        char *q = llCC_buf;\n\n         \n        for (; *p != '\\0' && *p != '.'; p++, q++)\n          *q = *p;\n        if (*p == '.')\n           \n          for (; *p != '\\0' && *p != '@'; p++)\n            ;\n         \n        for (; *p != '\\0'; p++, q++)\n          *q = *p;\n        *q = '\\0';\n      }\n       \n      if (strcmp (llCC_buf, locale) != 0)\n        {\n          result = setlocale (category, llCC_buf);\n          if (result != NULL)\n            return result;\n        }\n       \n      {\n        range_t range;\n        size_t i;\n\n        search (language_table,\n                sizeof (language_table) / sizeof (language_table[0]),\n                llCC_buf,\n                &range);\n\n        for (i = range.lo; i < range.hi; i++)\n          {\n             \n            result = setlocale (category, language_table[i].english);\n            if (result != NULL)\n              return result;\n          }\n      }\n       \n      {\n        const char *underscore = strchr (llCC_buf, '_');\n        if (underscore != NULL)\n          {\n            const char *territory_start = underscore + 1;\n            const char *territory_end = strchr (territory_start, '@');\n            if (territory_end == NULL)\n              territory_end = territory_start + strlen (territory_start);\n\n            memcpy (ll_buf, llCC_buf, underscore - llCC_buf);\n            strcpy (ll_buf + (underscore - llCC_buf), territory_end);\n\n            memcpy (CC_buf, territory_start, territory_end - territory_start);\n            CC_buf[territory_end - territory_start] = '\\0';\n\n            {\n               \n              range_t language_range;\n\n              search (language_table,\n                      sizeof (language_table) / sizeof (language_table[0]),\n                      ll_buf,\n                      &language_range);\n              if (language_range.lo < language_range.hi)\n                {\n                  range_t country_range;\n\n                  search (country_table,\n                          sizeof (country_table) / sizeof (country_table[0]),\n                          CC_buf,\n                          &country_range);\n                  if (country_range.lo < country_range.hi)\n                    {\n                      size_t i;\n                      size_t j;\n\n                      for (i = language_range.lo; i < language_range.hi; i++)\n                        for (j = country_range.lo; j < country_range.hi; j++)\n                          {\n                             \n                            const char *part1 = language_table[i].english;\n                            size_t part1_len = strlen (part1);\n                            const char *part2 = country_table[j].english;\n                            size_t part2_len = strlen (part2) + 1;\n                            char buf[64+64];\n\n                            if (!(part1_len + 1 + part2_len <= sizeof (buf)))\n                              abort ();\n                            memcpy (buf, part1, part1_len);\n                            buf[part1_len] = '_';\n                            memcpy (buf + part1_len + 1, part2, part2_len);\n\n                             \n                            result = setlocale (category, buf);\n                            if (result != NULL)\n                              return result;\n                          }\n                    }\n\n                   \n                  {\n                    size_t i;\n\n                    for (i = language_range.lo; i < language_range.hi; i++)\n                      {\n                         \n                        result =\n                          setlocale (category, language_table[i].english);\n                        if (result != NULL)\n                          return result;\n                      }\n                  }\n                }\n            }\n          }\n      }\n    }\n\n   \n  return NULL;\n}\n\n#  elif defined __ANDROID__\n\n \nstatic char *\nsetlocale_unixlike (int category, const char *locale)\n{\n  char *result = setlocale_mtsafe (category, locale);\n  if (result == NULL)\n    switch (category)\n      {\n      case LC_CTYPE:\n      case LC_NUMERIC:\n      case LC_TIME:\n      case LC_COLLATE:\n      case LC_MONETARY:\n      case LC_MESSAGES:\n      case LC_ALL:\n      case LC_PAPER:\n      case LC_NAME:\n      case LC_ADDRESS:\n      case LC_TELEPHONE:\n      case LC_MEASUREMENT:\n        if (locale == NULL\n            || strcmp (locale, \"C\") == 0 || strcmp (locale, \"POSIX\") == 0)\n          result = (char *) \"C\";\n        break;\n      default:\n        break;\n      }\n  return result;\n}\n#   define setlocale setlocale_unixlike\n\n#  else\n#   define setlocale_unixlike setlocale_mtsafe\n#  endif\n\n#  if LC_MESSAGES == 1729\n\n \nstatic char lc_messages_name[64] = \"C\";\n\n \nstatic char *\nsetlocale_single (int category, const char *locale)\n{\n  if (category == LC_MESSAGES)\n    {\n      if (locale != NULL)\n        {\n          lc_messages_name[sizeof (lc_messages_name) - 1] = '\\0';\n          strncpy (lc_messages_name, locale, sizeof (lc_messages_name) - 1);\n        }\n      return lc_messages_name;\n    }\n  else\n    return setlocale_unixlike (category, locale);\n}\n\n#  else\n#   define setlocale_single setlocale_unixlike\n#  endif\n\n#  if defined __APPLE__ && defined __MACH__\n\n \nstatic char const locales_with_principal_territory[][6 + 1] =\n  {\n                 \n    \"ace_ID\",    \n    \"af_ZA\",     \n    \"ak_GH\",     \n    \"am_ET\",     \n    \"an_ES\",     \n    \"ang_GB\",    \n    \"arn_CL\",    \n    \"as_IN\",     \n    \"ast_ES\",    \n    \"av_RU\",     \n    \"awa_IN\",    \n    \"az_AZ\",     \n    \"ban_ID\",    \n    \"be_BY\",     \n    \"bej_SD\",    \n    \"bem_ZM\",    \n    \"bg_BG\",     \n    \"bho_IN\",    \n    \"bi_VU\",     \n    \"bik_PH\",    \n    \"bin_NG\",    \n    \"bm_ML\",     \n    \"bn_IN\",     \n    \"bo_CN\",     \n    \"br_FR\",     \n    \"bs_BA\",     \n    \"bug_ID\",    \n    \"ca_ES\",     \n    \"ce_RU\",     \n    \"ceb_PH\",    \n    \"co_FR\",     \n    \"cr_CA\",     \n     \n    \"cs_CZ\",     \n    \"csb_PL\",    \n    \"cy_GB\",     \n    \"da_DK\",     \n    \"de_DE\",     \n    \"din_SD\",    \n    \"doi_IN\",    \n    \"dsb_DE\",    \n    \"dv_MV\",     \n    \"dz_BT\",     \n    \"ee_GH\",     \n    \"el_GR\",     \n     \n    \"es_ES\",     \n    \"et_EE\",     \n    \"fa_IR\",     \n    \"fi_FI\",     \n    \"fil_PH\",    \n    \"fj_FJ\",     \n    \"fo_FO\",     \n    \"fon_BJ\",    \n    \"fr_FR\",     \n    \"fur_IT\",    \n    \"fy_NL\",     \n    \"ga_IE\",     \n    \"gd_GB\",     \n    \"gon_IN\",    \n    \"gsw_CH\",    \n    \"gu_IN\",     \n    \"he_IL\",     \n    \"hi_IN\",     \n    \"hil_PH\",    \n    \"hr_HR\",     \n    \"hsb_DE\",    \n    \"ht_HT\",     \n    \"hu_HU\",     \n    \"hy_AM\",     \n    \"id_ID\",     \n    \"ig_NG\",     \n    \"ii_CN\",     \n    \"ilo_PH\",    \n    \"is_IS\",     \n    \"it_IT\",     \n    \"ja_JP\",     \n    \"jab_NG\",    \n    \"jv_ID\",     \n    \"ka_GE\",     \n    \"kab_DZ\",    \n    \"kaj_NG\",    \n    \"kam_KE\",    \n    \"kmb_AO\",    \n    \"kcg_NG\",    \n    \"kdm_NG\",    \n    \"kg_CD\",     \n    \"kk_KZ\",     \n    \"kl_GL\",     \n    \"km_KH\",     \n    \"kn_IN\",     \n    \"ko_KR\",     \n    \"kok_IN\",    \n    \"kr_NG\",     \n    \"kru_IN\",    \n    \"ky_KG\",     \n    \"lg_UG\",     \n    \"li_BE\",     \n    \"lo_LA\",     \n    \"lt_LT\",     \n    \"lu_CD\",     \n    \"lua_CD\",    \n    \"luo_KE\",    \n    \"lv_LV\",     \n    \"mad_ID\",    \n    \"mag_IN\",    \n    \"mai_IN\",    \n    \"mak_ID\",    \n    \"man_ML\",    \n    \"men_SL\",    \n    \"mfe_MU\",    \n    \"mg_MG\",     \n    \"mi_NZ\",     \n    \"min_ID\",    \n    \"mk_MK\",     \n    \"ml_IN\",     \n    \"mn_MN\",     \n    \"mni_IN\",    \n    \"mos_BF\",    \n    \"mr_IN\",     \n    \"ms_MY\",     \n    \"mt_MT\",     \n    \"mwr_IN\",    \n    \"my_MM\",     \n    \"na_NR\",     \n    \"nah_MX\",    \n    \"nap_IT\",    \n    \"nb_NO\",     \n    \"nds_DE\",    \n    \"ne_NP\",     \n    \"nl_NL\",     \n    \"nn_NO\",     \n    \"no_NO\",     \n    \"nr_ZA\",     \n    \"nso_ZA\",    \n    \"ny_MW\",     \n    \"nym_TZ\",    \n    \"nyn_UG\",    \n    \"oc_FR\",     \n    \"oj_CA\",     \n    \"or_IN\",     \n    \"pa_IN\",     \n    \"pag_PH\",    \n    \"pam_PH\",    \n    \"pap_AN\",    \n    \"pbb_CO\",    \n    \"pl_PL\",     \n    \"ps_AF\",     \n    \"pt_PT\",     \n    \"raj_IN\",    \n    \"rm_CH\",     \n    \"rn_BI\",     \n    \"ro_RO\",     \n    \"ru_RU\",     \n    \"rw_RW\",     \n    \"sa_IN\",     \n    \"sah_RU\",    \n    \"sas_ID\",    \n    \"sat_IN\",    \n    \"sc_IT\",     \n    \"scn_IT\",    \n    \"sg_CF\",     \n    \"shn_MM\",    \n    \"si_LK\",     \n    \"sid_ET\",    \n    \"sk_SK\",     \n    \"sl_SI\",     \n    \"sm_WS\",     \n    \"smn_FI\",    \n    \"sms_FI\",    \n    \"so_SO\",     \n    \"sq_AL\",     \n    \"sr_RS\",     \n    \"srr_SN\",    \n    \"suk_TZ\",    \n    \"sus_GN\",    \n    \"sv_SE\",     \n    \"te_IN\",     \n    \"tem_SL\",    \n    \"tet_ID\",    \n    \"tg_TJ\",     \n    \"th_TH\",     \n    \"ti_ER\",     \n    \"tiv_NG\",    \n    \"tk_TM\",     \n    \"tl_PH\",     \n    \"to_TO\",     \n    \"tpi_PG\",    \n    \"tr_TR\",     \n    \"tum_MW\",    \n    \"ug_CN\",     \n    \"uk_UA\",     \n    \"umb_AO\",    \n    \"ur_PK\",     \n    \"uz_UZ\",     \n    \"ve_ZA\",     \n    \"vi_VN\",     \n    \"wa_BE\",     \n    \"wal_ET\",    \n    \"war_PH\",    \n    \"wen_DE\",    \n    \"yao_MW\",    \n    \"zap_MX\"     \n  };\n\n \nstatic int\nlangcmp (const char *locale1, const char *locale2)\n{\n  size_t locale1_len;\n  size_t locale2_len;\n  int cmp;\n\n  {\n    const char *locale1_end = strchr (locale1, '_');\n    if (locale1_end != NULL)\n      locale1_len = locale1_end - locale1;\n    else\n      locale1_len = strlen (locale1);\n  }\n  {\n    const char *locale2_end = strchr (locale2, '_');\n    if (locale2_end != NULL)\n      locale2_len = locale2_end - locale2;\n    else\n      locale2_len = strlen (locale2);\n  }\n\n  if (locale1_len < locale2_len)\n    {\n      cmp = memcmp (locale1, locale2, locale1_len);\n      if (cmp == 0)\n        cmp = -1;\n    }\n  else\n    {\n      cmp = memcmp (locale1, locale2, locale2_len);\n      if (locale1_len > locale2_len && cmp == 0)\n        cmp = 1;\n    }\n\n  return cmp;\n}\n\n \nstatic const char *\nget_main_locale_with_same_language (const char *locale)\n{\n#   define table locales_with_principal_territory\n   \n  size_t hi = sizeof (table) / sizeof (table[0]);\n  size_t lo = 0;\n  while (lo < hi)\n    {\n       \n      size_t mid = (hi + lo) >> 1;  \n      int cmp = langcmp (table[mid], locale);\n      if (cmp < 0)\n        lo = mid + 1;\n      else if (cmp > 0)\n        hi = mid;\n      else\n        {\n           \n          if (mid > lo && langcmp (table[mid - 1], locale) >= 0)\n            abort ();\n          if (mid + 1 < hi && langcmp (table[mid + 1], locale) <= 0)\n            abort ();\n          return table[mid];\n        }\n    }\n#   undef table\n  return NULL;\n}\n\n \nstatic char const locales_with_principal_language[][6 + 1] =\n  {\n     \n     \n               \n    \"ca_AD\",     \n    \"ar_AE\",     \n    \"ps_AF\",     \n    \"en_AG\",     \n    \"sq_AL\",     \n    \"hy_AM\",     \n    \"pap_AN\",    \n    \"pt_AO\",     \n    \"es_AR\",     \n    \"de_AT\",     \n    \"en_AU\",     \n     \n    \"az_AZ\",     \n    \"bs_BA\",     \n    \"bn_BD\",     \n    \"nl_BE\",     \n    \"fr_BF\",     \n    \"bg_BG\",     \n    \"ar_BH\",     \n    \"rn_BI\",     \n    \"fr_BJ\",     \n    \"es_BO\",     \n    \"pt_BR\",     \n    \"dz_BT\",     \n    \"en_BW\",     \n    \"be_BY\",     \n    \"en_CA\",     \n    \"fr_CD\",     \n    \"sg_CF\",     \n    \"de_CH\",     \n    \"es_CL\",     \n    \"zh_CN\",     \n    \"es_CO\",     \n    \"es_CR\",     \n    \"es_CU\",     \n     \n    \"el_CY\",     \n    \"cs_CZ\",     \n    \"de_DE\",     \n     \n    \"da_DK\",     \n    \"es_DO\",     \n    \"ar_DZ\",     \n    \"es_EC\",     \n    \"et_EE\",     \n    \"ar_EG\",     \n    \"ti_ER\",     \n    \"es_ES\",     \n    \"am_ET\",     \n    \"fi_FI\",     \n     \n    \"fo_FO\",     \n    \"fr_FR\",     \n    \"en_GB\",     \n    \"ka_GE\",     \n    \"en_GH\",     \n    \"kl_GL\",     \n    \"fr_GN\",     \n    \"el_GR\",     \n    \"es_GT\",     \n    \"zh_HK\",     \n    \"es_HN\",     \n    \"hr_HR\",     \n    \"ht_HT\",     \n    \"hu_HU\",     \n    \"id_ID\",     \n    \"en_IE\",     \n    \"he_IL\",     \n    \"hi_IN\",     \n    \"ar_IQ\",     \n    \"fa_IR\",     \n    \"is_IS\",     \n    \"it_IT\",     \n    \"ar_JO\",     \n    \"ja_JP\",     \n    \"sw_KE\",     \n    \"ky_KG\",     \n    \"km_KH\",     \n    \"ko_KR\",     \n    \"ar_KW\",     \n    \"kk_KZ\",     \n    \"lo_LA\",     \n    \"ar_LB\",     \n    \"de_LI\",     \n    \"si_LK\",     \n    \"lt_LT\",     \n     \n    \"lv_LV\",     \n    \"ar_LY\",     \n    \"ar_MA\",     \n    \"sr_ME\",     \n    \"mg_MG\",     \n    \"mk_MK\",     \n    \"fr_ML\",     \n    \"my_MM\",     \n    \"mn_MN\",     \n    \"mt_MT\",     \n    \"mfe_MU\",    \n    \"dv_MV\",     \n    \"ny_MW\",     \n    \"es_MX\",     \n    \"ms_MY\",     \n    \"en_NG\",     \n    \"es_NI\",     \n    \"nl_NL\",     \n    \"no_NO\",     \n    \"ne_NP\",     \n    \"na_NR\",     \n    \"niu_NU\",    \n    \"en_NZ\",     \n    \"ar_OM\",     \n    \"es_PA\",     \n    \"es_PE\",     \n    \"tpi_PG\",    \n    \"fil_PH\",    \n    \"pa_PK\",     \n    \"pl_PL\",     \n    \"es_PR\",     \n    \"pt_PT\",     \n    \"es_PY\",     \n    \"ar_QA\",     \n    \"ro_RO\",     \n    \"sr_RS\",     \n    \"ru_RU\",     \n    \"rw_RW\",     \n    \"ar_SA\",     \n    \"en_SC\",     \n    \"ar_SD\",     \n    \"sv_SE\",     \n    \"en_SG\",     \n    \"sl_SI\",     \n    \"sk_SK\",     \n    \"en_SL\",     \n    \"fr_SN\",     \n    \"so_SO\",     \n    \"ar_SS\",     \n    \"es_SV\",     \n    \"ar_SY\",     \n    \"th_TH\",     \n    \"tg_TJ\",     \n    \"tk_TM\",     \n    \"ar_TN\",     \n    \"to_TO\",     \n    \"tr_TR\",     \n    \"zh_TW\",     \n    \"sw_TZ\",     \n    \"uk_UA\",     \n    \"lg_UG\",     \n    \"en_US\",     \n    \"es_UY\",     \n    \"uz_UZ\",     \n    \"es_VE\",     \n    \"vi_VN\",     \n    \"bi_VU\",     \n    \"sm_WS\",     \n    \"ar_YE\",     \n    \"en_ZA\",     \n    \"en_ZM\",     \n    \"en_ZW\"      \n  };\n\n \nstatic int\nterrcmp (const char *locale1, const char *locale2)\n{\n  const char *territory1 = strrchr (locale1, '_') + 1;\n  const char *territory2 = strrchr (locale2, '_') + 1;\n\n  return strcmp (territory1, territory2);\n}\n\n \nstatic const char *\nget_main_locale_with_same_territory (const char *locale)\n{\n  if (strrchr (locale, '_') != NULL)\n    {\n#   define table locales_with_principal_language\n       \n      size_t hi = sizeof (table) / sizeof (table[0]);\n      size_t lo = 0;\n      while (lo < hi)\n        {\n           \n          size_t mid = (hi + lo) >> 1;  \n          int cmp = terrcmp (table[mid], locale);\n          if (cmp < 0)\n            lo = mid + 1;\n          else if (cmp > 0)\n            hi = mid;\n          else\n            {\n               \n              if (mid > lo && terrcmp (table[mid - 1], locale) >= 0)\n                abort ();\n              if (mid + 1 < hi && terrcmp (table[mid + 1], locale) <= 0)\n                abort ();\n              return table[mid];\n            }\n        }\n#   undef table\n    }\n  return NULL;\n}\n\n#  endif\n\nchar *\nsetlocale_improved (int category, const char *locale)\n{\n  if (locale != NULL && locale[0] == '\\0')\n    {\n       \n      if (category == LC_ALL)\n        {\n           \n          static int const categories[] =\n            {\n              LC_CTYPE,\n              LC_NUMERIC,\n              LC_TIME,\n              LC_COLLATE,\n              LC_MONETARY,\n              LC_MESSAGES\n            };\n          char *saved_locale;\n          const char *base_name;\n          unsigned int i;\n\n           \n          saved_locale = setlocale (LC_ALL, NULL);\n          if (saved_locale == NULL)\n            return NULL;\n          saved_locale = strdup (saved_locale);\n          if (saved_locale == NULL)\n            return NULL;\n\n           \n          base_name =\n            gl_locale_name_environ (LC_CTYPE, category_to_name (LC_CTYPE));\n          if (base_name == NULL)\n            base_name = gl_locale_name_default ();\n\n          if (setlocale_unixlike (LC_ALL, base_name) != NULL)\n            {\n               \n              i = 1;\n            }\n          else\n            {\n               \n              base_name = \"C\";\n              if (setlocale_unixlike (LC_ALL, base_name) == NULL)\n                goto fail;\n              i = 0;\n            }\n#  if defined _WIN32 && ! defined __CYGWIN__\n           \n          if (strchr (base_name, '.') != NULL\n              && strcmp (setlocale (LC_CTYPE, NULL), \"C\") == 0)\n            goto fail;\n#  endif\n\n          for (; i < sizeof (categories) / sizeof (categories[0]); i++)\n            {\n              int cat = categories[i];\n              const char *name;\n\n              name = gl_locale_name_environ (cat, category_to_name (cat));\n              if (name == NULL)\n                name = gl_locale_name_default ();\n\n               \n              if (strcmp (name, base_name) != 0\n#  if LC_MESSAGES == 1729\n                  || cat == LC_MESSAGES\n#  endif\n                 )\n                if (setlocale_single (cat, name) == NULL)\n#  if defined __APPLE__ && defined __MACH__\n                  {\n                     \n                    int warn = 0;\n\n                    if (cat == LC_CTYPE)\n                      warn = (setlocale_single (cat, \"UTF-8\") == NULL);\n                    else if (cat == LC_MESSAGES)\n                      {\n#   if HAVE_CFLOCALECOPYPREFERREDLANGUAGES || HAVE_CFPREFERENCESCOPYAPPVALUE  \n                         \n#    if HAVE_CFLOCALECOPYPREFERREDLANGUAGES  \n                        CFArrayRef prefArray = CFLocaleCopyPreferredLanguages ();\n#    elif HAVE_CFPREFERENCESCOPYAPPVALUE  \n                        CFTypeRef preferences =\n                          CFPreferencesCopyAppValue (CFSTR (\"AppleLanguages\"),\n                                                     kCFPreferencesCurrentApplication);\n                        if (preferences != NULL\n                            && CFGetTypeID (preferences) == CFArrayGetTypeID ())\n                          {\n                            CFArrayRef prefArray = (CFArrayRef)preferences;\n#    endif\n                            int n = CFArrayGetCount (prefArray);\n                            if (n > 0)\n                              {\n                                char buf[256];\n                                CFTypeRef element = CFArrayGetValueAtIndex (prefArray, 0);\n                                if (element != NULL\n                                    && CFGetTypeID (element) == CFStringGetTypeID ()\n                                    && CFStringGetCString ((CFStringRef)element,\n                                                           buf, sizeof (buf),\n                                                           kCFStringEncodingASCII))\n                                  {\n                                     \n                                    char *last_minus = strrchr (buf, '-');\n                                    if (last_minus != NULL)\n                                      *last_minus = '\\0';\n\n                                     \n                                    gl_locale_name_canonicalize (buf);\n\n                                     \n                                    if (setlocale_single (cat, buf) == NULL)\n                                      {\n                                        const char *last_try =\n                                          get_main_locale_with_same_language (buf);\n\n                                        if (last_try == NULL\n                                            || setlocale_single (cat, last_try) == NULL)\n                                          warn = 1;\n                                      }\n                                  }\n                              }\n#    if HAVE_CFLOCALECOPYPREFERREDLANGUAGES  \n                        CFRelease (prefArray);\n#    elif HAVE_CFPREFERENCESCOPYAPPVALUE  \n                          }\n#    endif\n#   else\n                        const char *last_try =\n                          get_main_locale_with_same_language (name);\n\n                        if (last_try == NULL\n                            || setlocale_single (cat, last_try) == NULL)\n                          warn = 1;\n#   endif\n                      }\n                    else\n                      {\n                         \n                        const char *last_try =\n                          get_main_locale_with_same_territory (name);\n\n                        if (last_try == NULL\n                            || setlocale_single (cat, last_try) == NULL)\n                          warn = 1;\n                      }\n\n                    if (warn)\n                      {\n                         \n                        const char *verbose = getenv (\"SETLOCALE_VERBOSE\");\n                        if (verbose != NULL && verbose[0] != '\\0')\n                          fprintf (stderr,\n                                   \"Warning: Failed to set locale category %s to %s.\\n\",\n                                   category_to_name (cat), name);\n                      }\n                  }\n#  else\n                  goto fail;\n#  endif\n            }\n\n           \n          free (saved_locale);\n          return setlocale (LC_ALL, NULL);\n\n        fail:\n          if (saved_locale[0] != '\\0')  \n            setlocale (LC_ALL, saved_locale);\n          free (saved_locale);\n          return NULL;\n        }\n      else\n        {\n          const char *name =\n            gl_locale_name_environ (category, category_to_name (category));\n          if (name == NULL)\n            name = gl_locale_name_default ();\n\n          return setlocale_single (category, name);\n        }\n    }\n  else\n    {\n#  if defined _WIN32 && ! defined __CYGWIN__\n      if (category == LC_ALL && locale != NULL && strchr (locale, '.') != NULL)\n        {\n          char *saved_locale;\n\n           \n          saved_locale = setlocale (LC_ALL, NULL);\n          if (saved_locale == NULL)\n            return NULL;\n          saved_locale = strdup (saved_locale);\n          if (saved_locale == NULL)\n            return NULL;\n\n          if (setlocale_unixlike (LC_ALL, locale) == NULL)\n            {\n              free (saved_locale);\n              return NULL;\n            }\n\n           \n          if (strcmp (setlocale (LC_CTYPE, NULL), \"C\") == 0)\n            {\n              if (saved_locale[0] != '\\0')  \n                setlocale (LC_ALL, saved_locale);\n              free (saved_locale);\n              return NULL;\n            }\n\n           \n          free (saved_locale);\n          return setlocale (LC_ALL, NULL);\n        }\n      else\n#  endif\n        return setlocale_single (category, locale);\n    }\n}\n\n# endif  \n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}