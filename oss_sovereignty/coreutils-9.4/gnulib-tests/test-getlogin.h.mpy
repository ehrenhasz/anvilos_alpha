{
  "module_name": "test-getlogin.h",
  "hash_id": "24ee22a1204b0f260dc7f32750b61b56b5778f1fbde41db12962ef3cdcc90db6",
  "original_prompt": "Ingested from coreutils-9.4/gnulib-tests/test-getlogin.h",
  "human_readable_source": " \n\n#include <errno.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <unistd.h>\n#if !(defined _WIN32 && !defined __CYGWIN__)\n# include <pwd.h>\n#endif\n\n#include <sys/stat.h>\n#include <sys/types.h>\n\n#include \"macros.h\"\n\nstatic void\ntest_getlogin_result (const char *buf, int err)\n{\n  if (err != 0)\n    {\n      if (err == ENOENT)\n        {\n           \n          fprintf (stderr, \"Skipping test: no entry in utmp file.\\n\");\n          exit (77);\n        }\n\n      ASSERT (err == ENOTTY\n              || err == EINVAL  \n              || err == ENXIO\n             );\n\n#if defined __linux__\n       \n      bool loginuid_undefined = false;\n       \n      FILE *fp = fopen (\"/proc/self/loginuid\", \"r\");\n      if (fp != NULL)\n        {\n          char fread_buf[21];\n          size_t n = fread (fread_buf, 1, sizeof fread_buf, fp);\n          if (n > 0 && n < sizeof fread_buf)\n            {\n              fread_buf[n] = '\\0';\n              errno = 0;\n              char *endptr;\n              unsigned long value = strtoul (fread_buf, &endptr, 10);\n              if (*endptr == '\\0' && errno == 0)\n                loginuid_undefined = ((uid_t) value == (uid_t)(-1));\n            }\n          fclose (fp);\n        }\n      if (loginuid_undefined)\n        {\n          fprintf (stderr, \"Skipping test: loginuid is undefined.\\n\");\n          exit (77);\n        }\n#endif\n\n       \n#if !defined __hpux  \n      ASSERT (! isatty (0));\n#endif\n      fprintf (stderr, \"Skipping test: stdin is not a tty.\\n\");\n      exit (77);\n    }\n\n   \n#if !(defined _WIN32 && !defined __CYGWIN__)\n   \n  {\n    struct stat stat_buf;\n    struct passwd *pwd;\n\n    if (!isatty (STDIN_FILENO))\n      {\n         \n        fprintf (stderr, \"Skipping test: stdin is not a tty.\\n\");\n        exit (77);\n      }\n\n    ASSERT (fstat (STDIN_FILENO, &stat_buf) == 0);\n\n    pwd = getpwnam (buf);\n    if (! pwd)\n      {\n        fprintf (stderr, \"Skipping test: %s: no such user\\n\", buf);\n        exit (77);\n      }\n\n    ASSERT (pwd->pw_uid == stat_buf.st_uid);\n  }\n#endif\n#if defined _WIN32 && !defined __CYGWIN__\n   \n  {\n    const char *name = getenv (\"USERNAME\");\n    if (name != NULL && name[0] != '\\0')\n      ASSERT (strcmp (buf, name) == 0);\n  }\n#endif\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}