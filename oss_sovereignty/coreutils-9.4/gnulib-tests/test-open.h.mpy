{
  "module_name": "test-open.h",
  "hash_id": "e7b36b4d6d17bac7a6edb4936d53b851dbd4cdcced69f3225dce0c89d8fb330b",
  "original_prompt": "Ingested from coreutils-9.4/gnulib-tests/test-open.h",
  "human_readable_source": " \n\n \n#if __GNUC__ >= 13\n# pragma GCC diagnostic ignored \"-Wanalyzer-fd-leak\"\n#endif\n\n \n\n#if __GLIBC__ && defined __always_inline\n# define ALWAYS_INLINE __always_inline\n#else\n# define ALWAYS_INLINE\n#endif\n\n \n\nstatic ALWAYS_INLINE int\ntest_open (int (*func) (char const *, int, ...), bool print)\n{\n  int fd;\n\n   \n  unlink (BASE \"file\");\n  unlink (BASE \"e.exe\");\n  unlink (BASE \"link\");\n\n   \n  errno = 0;\n  ASSERT (func (\"nonexist.ent/\", O_CREAT | O_RDONLY, 0600) == -1);\n  ASSERT (errno == ENOTDIR || errno == EISDIR || errno == ENOENT\n          || errno == EINVAL);\n\n   \n  fd = func (BASE \"file\", O_CREAT | O_RDONLY, 0600);\n  ASSERT (0 <= fd);\n  ASSERT (close (fd) == 0);\n\n   \n  fd = func (BASE \"e.exe\", O_CREAT | O_RDONLY, 0700);\n  ASSERT (0 <= fd);\n  ASSERT (close (fd) == 0);\n\n   \n  errno = 0;\n  ASSERT (func (BASE \"file/\", O_RDONLY) == -1);\n  ASSERT (errno == ENOTDIR || errno == EISDIR || errno == EINVAL);\n\n   \n  errno = 0;\n  ASSERT (func (\".\", O_WRONLY) == -1);\n  ASSERT (errno == EISDIR || errno == EACCES);\n\n   \n  fd = func (\"/dev/null\", O_RDONLY);\n  ASSERT (0 <= fd);\n  {\n    char c;\n    ASSERT (read (fd, &c, 1) == 0);\n  }\n  ASSERT (close (fd) == 0);\n  fd = func (\"/dev/null\", O_WRONLY);\n  ASSERT (0 <= fd);\n  ASSERT (write (fd, \"c\", 1) == 1);\n  ASSERT (close (fd) == 0);\n\n   \n  fd = func (BASE \"file\", O_NONBLOCK | O_RDONLY);\n  ASSERT (0 <= fd);\n  ASSERT (close (fd) == 0);\n\n   \n  if (O_CLOEXEC)\n    {\n       \n      int i;\n\n      for (i = 0; i < 2; i++)\n        {\n          int flags;\n\n          fd = func (BASE \"file\", O_CLOEXEC | O_RDONLY);\n          ASSERT (0 <= fd);\n          flags = fcntl (fd, F_GETFD);\n          ASSERT (flags >= 0);\n          ASSERT ((flags & FD_CLOEXEC) != 0);\n          ASSERT (close (fd) == 0);\n        }\n    }\n\n   \n  if (symlink (BASE \"file\", BASE \"link\") != 0)\n    {\n      ASSERT (unlink (BASE \"file\") == 0);\n      if (print)\n        fputs (\"skipping test: symlinks not supported on this file system\\n\",\n               stderr);\n      return 77;\n    }\n  errno = 0;\n  ASSERT (func (BASE \"link/\", O_RDONLY) == -1);\n  ASSERT (errno == ENOTDIR);\n  fd = func (BASE \"link\", O_RDONLY);\n  ASSERT (0 <= fd);\n  ASSERT (close (fd) == 0);\n\n   \n  ASSERT (unlink (BASE \"file\") == 0);\n  ASSERT (unlink (BASE \"e.exe\") == 0);\n  ASSERT (unlink (BASE \"link\") == 0);\n\n  return 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}