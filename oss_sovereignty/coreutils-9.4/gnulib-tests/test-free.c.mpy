{
  "module_name": "test-free.c",
  "hash_id": "9c8717e231068cf9b191a34b15603951901e7e9be0d5fc8e8925e73f59ea6d3d",
  "original_prompt": "Ingested from coreutils-9.4/gnulib-tests/test-free.c",
  "human_readable_source": " \n\n#include <config.h>\n\n \n#include <stdlib.h>\n\n#include <errno.h>\n#include <string.h>\n#include <unistd.h>\n#if defined __linux__\n# include <fcntl.h>\n# include <stdint.h>\n# include <string.h>\n# include <sys/mman.h>\n#endif\n\n#include \"macros.h\"\n\n \nstatic int\nget_errno (void)\n{\n  volatile int err = errno;\n  return err;\n}\n\nstatic int (* volatile get_errno_func) (void) = get_errno;\n\nint\nmain ()\n{\n   \n  {\n    errno = 1789;  \n    free (NULL);\n    ASSERT_NO_STDIO (get_errno_func () == 1789);\n  }\n  {  \n    #define N 10000\n    void * volatile ptrs[N];\n    size_t i;\n    for (i = 0; i < N; i++)\n      ptrs[i] = malloc (15);\n    for (i = 0; i < N; i++)\n      {\n        errno = 1789;\n        free (ptrs[i]);\n        ASSERT_NO_STDIO (get_errno_func () == 1789);\n      }\n    #undef N\n  }\n  {  \n    #define N 1000\n    void * volatile ptrs[N];\n    size_t i;\n    for (i = 0; i < N; i++)\n      ptrs[i] = malloc (729);\n    for (i = 0; i < N; i++)\n      {\n        errno = 1789;\n        free (ptrs[i]);\n        ASSERT_NO_STDIO (get_errno_func () == 1789);\n      }\n    #undef N\n  }\n  {  \n    #define N 10\n    void * volatile ptrs[N];\n    size_t i;\n    for (i = 0; i < N; i++)\n      ptrs[i] = malloc (5318153);\n    for (i = 0; i < N; i++)\n      {\n        errno = 1789;\n        free (ptrs[i]);\n        ASSERT_NO_STDIO (get_errno_func () == 1789);\n      }\n    #undef N\n  }\n\n   \n  #if defined __linux__ && !(__GLIBC__ == 2 && __GLIBC_MINOR__ < 15)\n  if (open (\"/proc/sys/vm/max_map_count\", O_RDONLY) >= 0)\n    {\n       \n      size_t pagesize = getpagesize ();\n      void *firstpage_backup = malloc (pagesize);\n      void *lastpage_backup = malloc (pagesize);\n       \n      void *bumper_region =\n        mmap (NULL, 0x1000000, PROT_READ, MAP_ANONYMOUS | MAP_PRIVATE, -1, 0);\n       \n      int fd = open (\"test-free\", O_RDONLY);\n\n      if (firstpage_backup != NULL && lastpage_backup != NULL\n          && bumper_region != (void *)(-1)\n          && fd >= 0)\n        {\n           \n          size_t big_size = 0x1000000;\n          void * volatile ptr = malloc (big_size - 0x100);\n          char *ptr_aligned = (char *) ((uintptr_t) ptr & ~(pagesize - 1));\n           \n          memcpy (firstpage_backup, ptr_aligned, pagesize);\n          memcpy (lastpage_backup, ptr_aligned + big_size - pagesize, pagesize);\n          if (mmap (ptr_aligned - pagesize, pagesize + big_size + pagesize,\n                    PROT_READ | PROT_WRITE,\n                    MAP_ANONYMOUS | MAP_PRIVATE | MAP_FIXED, -1, 0)\n              != (void *)(-1))\n            {\n              memcpy (ptr_aligned, firstpage_backup, pagesize);\n              memcpy (ptr_aligned + big_size - pagesize, lastpage_backup, pagesize);\n\n               \n              size_t i;\n              for (i = 0; i < 65536; i++)\n                if (mmap (NULL, pagesize, PROT_READ, MAP_FILE | MAP_PRIVATE, fd, 0)\n                    == (void *)(-1))\n                  break;\n               \n\n              errno = 1789;\n               \n              free (ptr);\n              ASSERT_NO_STDIO (get_errno_func () == 1789);\n            }\n        }\n    }\n  #endif\n\n  return 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}