{
  "module_name": "test-fdutimensat.c",
  "hash_id": "b57ae63f36f5feca1fe71ea25e3664b7736300fbd261bfda992ddb94b00dbf69",
  "original_prompt": "Ingested from coreutils-9.4/gnulib-tests/test-fdutimensat.c",
  "human_readable_source": " \n\n#include <config.h>\n\n#include \"utimens.h\"\n\n#include <fcntl.h>\n#include <stdio.h>\n#include <stdlib.h>\n\n#include \"ignore-value.h\"\n#include \"macros.h\"\n\n#define BASE \"test-fdutimensat.t\"\n\n#include \"test-futimens.h\"\n#include \"test-lutimens.h\"\n#include \"test-utimens.h\"\n\nstatic int dfd = AT_FDCWD;\n\n \nstatic int\ndo_futimens (int fd, struct timespec const times[2])\n{\n  return fdutimensat (fd, dfd, NULL, times, 0);\n}\n\n \nstatic int\ndo_fdutimens (char const *name, struct timespec const times[2])\n{\n  int result;\n  int nofollow_result;\n  int nofollow_errno;\n  int fd = openat (dfd, name, O_WRONLY);\n  if (fd < 0)\n    fd = openat (dfd, name, O_RDONLY);\n  errno = 0;\n  nofollow_result = fdutimensat (fd, dfd, name, times, AT_SYMLINK_NOFOLLOW);\n  nofollow_errno = errno;\n  result = fdutimensat (fd, dfd, name, times, 0);\n  ASSERT (result == nofollow_result\n          || (nofollow_result == -1 && nofollow_errno == ENOSYS));\n  if (0 <= fd)\n    {\n      int saved_errno = errno;\n      close (fd);\n      errno = saved_errno;\n    }\n  return result;\n}\n\n \nstatic int\ndo_lutimens (const char *name, struct timespec const times[2])\n{\n  return lutimensat (dfd, name, times);\n}\n\n \nstatic int\ndo_lutimens1 (const char *name, struct timespec const times[2])\n{\n  return fdutimensat (-1, dfd, name, times, AT_SYMLINK_NOFOLLOW);\n}\n\n \nstatic int\ndo_utimens (const char *name, struct timespec const times[2])\n{\n  return fdutimensat (-1, dfd, name, times, 0);\n}\n\nint\nmain (void)\n{\n  int result1;  \n  int result2;  \n  int result3;  \n  int fd;\n\n   \n  ignore_value (system (\"rm -rf \" BASE \"*\"));\n\n   \n  result1 = test_utimens (do_utimens, true);\n  ASSERT (test_utimens (do_fdutimens, false) == result1);\n  result2 = test_futimens (do_futimens, result1 == 0);\n  result3 = test_lutimens (do_lutimens, (result1 + result2) == 0);\n   \n  ASSERT (result1 <= result3);\n  ASSERT (test_lutimens (do_lutimens1, (result1 + result2) == 0) == result3);\n  dfd = open (\".\", O_RDONLY);\n  ASSERT (0 <= dfd);\n  ASSERT (test_utimens (do_utimens, false) == result1);\n  ASSERT (test_utimens (do_fdutimens, false) == result1);\n  ASSERT (test_futimens (do_futimens, false) == result2);\n  ASSERT (test_lutimens (do_lutimens, false) == result3);\n  ASSERT (test_lutimens (do_lutimens1, false) == result3);\n\n   \n  ASSERT (mkdir (BASE \"dir\", 0700) == 0);\n  ASSERT (chdir (BASE \"dir\") == 0);\n  fd = creat (\"file\", 0600);\n  ASSERT (0 <= fd);\n  errno = 0;\n  ASSERT (fdutimensat (AT_FDCWD, fd, \".\", NULL, 0) == -1);\n  ASSERT (errno == ENOTDIR);\n  {\n    struct timespec ts[2];\n    struct stat st;\n    ts[0].tv_sec = Y2K;\n    ts[0].tv_nsec = 0;\n    ts[1] = ts[0];\n    ASSERT (fdutimensat (fd, dfd, BASE \"dir/file\", ts, 0) == 0);\n    ASSERT (stat (\"file\", &st) == 0);\n    ASSERT (st.st_atime == Y2K);\n    ASSERT (get_stat_atime_ns (&st) == 0);\n    ASSERT (st.st_mtime == Y2K);\n    ASSERT (get_stat_mtime_ns (&st) == 0);\n  }\n  ASSERT (close (fd) == 0);\n  ASSERT (close (dfd) == 0);\n  errno = 0;\n  ASSERT (fdutimensat (-1, dfd, \".\", NULL, 0) == -1);\n  ASSERT (errno == EBADF);\n\n   \n  ASSERT (chdir (\"..\") == 0);\n  ASSERT (unlink (BASE \"dir/file\") == 0);\n  ASSERT (rmdir (BASE \"dir\") == 0);\n  return result1 | result2 | result3;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}