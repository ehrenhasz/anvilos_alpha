{
  "module_name": "test-link.h",
  "hash_id": "f2240a9959ed4e59fadffcc808491f30f4d17375acf5e3be7731f5cf1f7b5c85",
  "original_prompt": "Ingested from coreutils-9.4/gnulib-tests/test-link.h",
  "human_readable_source": " \n\nstatic int\ntest_link (int (*func) (char const *, char const *), bool print)\n{\n  int fd;\n  int ret;\n\n   \n  fd = open (BASE \"a\", O_CREAT | O_EXCL | O_WRONLY, 0600);\n  ASSERT (0 <= fd);\n  ASSERT (write (fd, \"hello\", 5) == 5);\n  ASSERT (close (fd) == 0);\n\n   \n  ret = func (BASE \"a\", BASE \"b\");\n  if (!ret)\n    {\n      struct stat st;\n      ASSERT (stat (BASE \"b\", &st) == 0);\n      if (st.st_ino && st.st_nlink != 2)\n        {\n          ASSERT (unlink (BASE \"b\") == 0);\n          errno = EPERM;\n          ret = -1;\n        }\n    }\n  if (ret == -1)\n    {\n       \n      switch (errno)\n        {\n        case EPERM:\n        case EOPNOTSUPP:\n        #if defined __ANDROID__\n        case EACCES:\n        #endif\n          if (print)\n            fputs (\"skipping test: \"\n                   \"hard links not supported on this file system\\n\",\n                   stderr);\n          ASSERT (unlink (BASE \"a\") == 0);\n          return 77;\n        default:\n          perror (\"link\");\n          return 1;\n        }\n    }\n  ASSERT (ret == 0);\n\n   \n  fd = open (BASE \"b\", O_APPEND | O_WRONLY);\n  ASSERT (0 <= fd);\n  ASSERT (write (fd, \"world\", 5) == 5);\n  ASSERT (close (fd) == 0);\n  {\n    char buf[11] = { 0 };\n    fd = open (BASE \"a\", O_RDONLY);\n    ASSERT (0 <= fd);\n    ASSERT (read (fd, buf, 10) == 10);\n    ASSERT (strcmp (buf, \"helloworld\") == 0);\n    ASSERT (close (fd) == 0);\n    ASSERT (unlink (BASE \"b\") == 0);\n    fd = open (BASE \"a\", O_RDONLY);\n    ASSERT (0 <= fd);\n    ASSERT (read (fd, buf, 10) == 10);\n    ASSERT (strcmp (buf, \"helloworld\") == 0);\n    ASSERT (close (fd) == 0);\n  }\n\n   \n  ASSERT (mkdir (BASE \"d\", 0700) == 0);\n  errno = 0;\n  ASSERT (func (BASE \"a\", \".\") == -1);\n  ASSERT (errno == EEXIST || errno == EINVAL);\n  errno = 0;\n  ASSERT (func (BASE \"a\", BASE \"a\") == -1);\n  ASSERT (errno == EEXIST);\n  ASSERT (func (BASE \"a\", BASE \"b\") == 0);\n  errno = 0;\n  ASSERT (func (BASE \"a\", BASE \"b\") == -1);\n  ASSERT (errno == EEXIST);\n  errno = 0;\n  ASSERT (func (BASE \"a\", BASE \"d\") == -1);\n  ASSERT (errno == EEXIST);\n  errno = 0;\n  ASSERT (func (BASE \"c\", BASE \"e\") == -1);\n  ASSERT (errno == ENOENT);\n  errno = 0;\n  ASSERT (func (BASE \"a\", BASE \"c/.\") == -1);\n  ASSERT (errno == ENOENT);\n  errno = 0;\n  ASSERT (func (BASE \"a/\", BASE \"c\") == -1);\n  ASSERT (errno == ENOTDIR || errno == EINVAL);\n  errno = 0;\n  ASSERT (func (BASE \"a\", BASE \"c/\") == -1);\n  ASSERT (errno == ENOTDIR || errno == ENOENT || errno == EINVAL);\n\n   \n  {\n    int result;\n    errno = 0;\n    result = func (BASE \"d\", BASE \"c\");\n    if (result == 0)\n      {\n         \n        ASSERT (unlink (BASE \"c\") == 0);\n      }\n    else\n      {\n         \n        ASSERT (errno == EPERM || errno == EACCES || errno == EISDIR);\n        errno = 0;\n        ASSERT (func (BASE \"d/.\", BASE \"c\") == -1);\n        ASSERT (errno == EPERM || errno == EACCES || errno == EISDIR\n                || errno == EINVAL);\n        errno = 0;\n        ASSERT (func (BASE \"d/.//\", BASE \"c\") == -1);\n        ASSERT (errno == EPERM || errno == EACCES || errno == EISDIR\n                || errno == EINVAL);\n      }\n  }\n  ASSERT (unlink (BASE \"a\") == 0);\n  errno = 0;\n  ASSERT (unlink (BASE \"c\") == -1);\n  ASSERT (errno == ENOENT);\n  ASSERT (rmdir (BASE \"d\") == 0);\n\n   \n  if (symlink (BASE \"a\", BASE \"link\") != 0)\n    {\n      ASSERT (unlink (BASE \"b\") == 0);\n      if (print)\n        fputs (\"skipping test: symlinks not supported on this file system\\n\",\n               stderr);\n      return 77;\n    }\n  errno = 0;\n  ASSERT (func (BASE \"b\", BASE \"link/\") == -1);\n  ASSERT (errno == ENOTDIR || errno == ENOENT || errno == EEXIST\n          || errno == EINVAL);\n  errno = 0;\n  ASSERT (func (BASE \"b\", BASE \"link\") == -1);\n  ASSERT (errno == EEXIST);\n  ASSERT (rename (BASE \"b\", BASE \"a\") == 0);\n  errno = 0;\n  ASSERT (func (BASE \"link/\", BASE \"b\") == -1);\n  ASSERT (errno == ENOTDIR || errno == EEXIST || errno == EINVAL);\n\n   \n  ASSERT (unlink (BASE \"a\") == 0);\n  ASSERT (unlink (BASE \"link\") == 0);\n\n  return 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}