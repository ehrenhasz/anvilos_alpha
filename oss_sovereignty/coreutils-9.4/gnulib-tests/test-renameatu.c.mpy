{
  "module_name": "test-renameatu.c",
  "hash_id": "55c979967405cd23d66949689f165fe32445184a2bb3f04c38ee1001d9d948c2",
  "original_prompt": "Ingested from coreutils-9.4/gnulib-tests/test-renameatu.c",
  "human_readable_source": " \n\n#include <config.h>\n\n#include <renameatu.h>\n\n#include <stdio.h>\n\n#include \"signature.h\"\nSIGNATURE_CHECK (renameatu, int,\n                 (int, char const *, int, char const *, unsigned int));\n\n#include <dirent.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <string.h>\n#include <unistd.h>\n#include <sys/stat.h>\n\n#include \"filenamecat.h\"\n#include \"ignore-value.h\"\n#include \"macros.h\"\n\n#define BASE \"test-renameatu.t\"\n\n#include \"test-rename.h\"\n\nstatic int dfd1 = AT_FDCWD;\nstatic int dfd2 = AT_FDCWD;\n\n \nstatic int\ndo_rename (char const *name1, char const *name2)\n{\n  return renameatu (dfd1, name1, dfd2, name2, 0);\n}\n\nint\nmain (void)\n{\n  int i;\n  int dfd;\n  char *cwd;\n  int result;\n\n   \n  ignore_value (system (\"rm -rf \" BASE \"*\"));\n\n   \n  {\n    errno = 0;\n    ASSERT (renameatu (-1, \"foo\", AT_FDCWD, \"bar\", 0) == -1);\n    ASSERT (errno == EBADF);\n  }\n  {\n    close (99);\n    errno = 0;\n    ASSERT (renameatu (99, \"foo\", AT_FDCWD, \"bar\", 0) == -1);\n    ASSERT (errno == EBADF);\n  }\n  ASSERT (close (creat (BASE \"oo\", 0600)) == 0);\n  {\n    errno = 0;\n    ASSERT (renameatu (AT_FDCWD, BASE \"oo\", -1, \"bar\", 0) == -1);\n    ASSERT (errno == EBADF);\n  }\n  {\n    errno = 0;\n    ASSERT (renameatu (AT_FDCWD, BASE \"oo\", 99, \"bar\", 0) == -1);\n    ASSERT (errno == EBADF);\n  }\n  ASSERT (unlink (BASE \"oo\") == 0);\n\n   \n  result = test_rename (do_rename, false);\n  dfd1 = open (\".\", O_RDONLY);\n  ASSERT (0 <= dfd1);\n  ASSERT (test_rename (do_rename, false) == result);\n  dfd2 = dfd1;\n  ASSERT (test_rename (do_rename, false) == result);\n  dfd1 = AT_FDCWD;\n  ASSERT (test_rename (do_rename, false) == result);\n  ASSERT (close (dfd2) == 0);\n\n   \n  ASSERT (mkdir (BASE \"sub1\", 0700) == 0);\n  ASSERT (mkdir (BASE \"sub2\", 0700) == 0);\n  dfd = creat (BASE \"00\", 0600);\n  ASSERT (0 <= dfd);\n  ASSERT (close (dfd) == 0);\n  cwd = getcwd (NULL, 0);\n  ASSERT (cwd);\n\n  dfd = open (BASE \"sub1\", O_RDONLY);\n  ASSERT (0 <= dfd);\n  ASSERT (chdir (BASE \"sub2\") == 0);\n\n   \n  for (i = 0; i < 16; i++)\n    {\n      int fd1 = (i & 8) ? dfd : AT_FDCWD;\n      char *file1 = file_name_concat ((i & 4) ? \"..\" : cwd, BASE \"xx\", NULL);\n      int fd2 = (i & 2) ? dfd : AT_FDCWD;\n      char *file2 = file_name_concat ((i & 1) ? \"..\" : cwd, BASE \"xx\", NULL);\n\n      ASSERT (sprintf (strchr (file1, '\\0') - 2, \"%02d\", i) == 2);\n      ASSERT (sprintf (strchr (file2, '\\0') - 2, \"%02d\", i + 1) == 2);\n      ASSERT (renameatu (fd1, file1, fd2, file2, 0) == 0);\n      free (file1);\n      free (file2);\n    }\n  dfd2 = open (\"..\", O_RDONLY);\n  ASSERT (0 <= dfd2);\n  ASSERT (renameatu (dfd, \"../\" BASE \"16\", dfd2, BASE \"17\", 0) == 0);\n  ASSERT (close (dfd2) == 0);\n\n   \n  ASSERT (chdir (\"..\") == 0);\n  ASSERT (close (dfd) == 0);\n  dfd = open (\".\", O_RDONLY);\n  ASSERT (0 <= dfd);\n\n  ASSERT (close (creat (BASE \"sub2/file\", 0600)) == 0);\n  errno = 0;\n  ASSERT (renameatu (dfd, BASE \"sub1\", dfd, BASE \"sub2\", 0) == -1);\n  ASSERT (errno == EEXIST || errno == ENOTEMPTY);\n  ASSERT (unlink (BASE \"sub2/file\") == 0);\n  errno = 0;\n  ASSERT (renameatu (dfd, BASE \"sub2\", dfd, BASE \"sub1/.\", 0) == -1);\n  ASSERT (errno == EINVAL || errno == EISDIR || errno == EBUSY\n          || errno == ENOTEMPTY || errno == EEXIST\n          || errno == ENOENT  );\n  errno = 0;\n  ASSERT (renameatu (dfd, BASE \"sub2/.\", dfd, BASE \"sub1\", 0) == -1);\n  ASSERT (errno == EINVAL || errno == EBUSY || errno == EEXIST\n          || errno == ENOENT  );\n  errno = 0;\n  ASSERT (renameatu (dfd, BASE \"17\", dfd, BASE \"sub1\", 0) == -1);\n  ASSERT (errno == EISDIR);\n  errno = 0;\n  ASSERT (renameatu (dfd, BASE \"nosuch\", dfd, BASE \"18\", 0) == -1);\n  ASSERT (errno == ENOENT);\n  errno = 0;\n  ASSERT (renameatu (dfd, \"\", dfd, BASE \"17\", 0) == -1);\n  ASSERT (errno == ENOENT);\n  errno = 0;\n  ASSERT (renameatu (dfd, BASE \"17\", dfd, \"\", 0) == -1);\n  ASSERT (errno == ENOENT);\n  errno = 0;\n  ASSERT (renameatu (dfd, BASE \"sub2\", dfd, BASE \"17\", 0) == -1);\n  ASSERT (errno == ENOTDIR);\n  errno = 0;\n  ASSERT (renameatu (dfd, BASE \"17/\", dfd, BASE \"18\", 0) == -1);\n  ASSERT (errno == ENOTDIR);\n  errno = 0;\n  ASSERT (renameatu (dfd, BASE \"17\", dfd, BASE \"18/\", 0) == -1);\n  ASSERT (errno == ENOTDIR || errno == ENOENT);\n\n   \n  ASSERT (close (creat (BASE \"sub2/file\", 0600)) == 0);\n  errno = 0;\n  ASSERT ((renameatu (dfd, BASE \"sub2/file\", dfd, BASE \"sub2/file\",\n                      RENAME_NOREPLACE)\n           == -1)\n          && errno == EEXIST);\n  errno = 0;\n  ASSERT ((renameatu (dfd, BASE \"sub2\", dfd, BASE \"sub2\", RENAME_NOREPLACE)\n           == -1)\n          && errno == EEXIST);\n  errno = 0;\n  ASSERT ((renameatu (dfd, BASE \"sub2\", dfd, BASE \"sub1\", RENAME_NOREPLACE)\n           == -1)\n          && errno == EEXIST);\n  errno = 0;\n  ASSERT ((renameatu (dfd, BASE \"sub2/file\", dfd, BASE \"17\", RENAME_NOREPLACE)\n           == -1)\n          && errno == EEXIST);\n\n   \n  ASSERT (close (dfd) == 0);\n  ASSERT (unlink (BASE \"sub2/file\") == 0);\n  ASSERT (unlink (BASE \"17\") == 0);\n  ASSERT (rmdir (BASE \"sub1\") == 0);\n  ASSERT (rmdir (BASE \"sub2\") == 0);\n  free (cwd);\n\n  if (result)\n    fputs (\"skipping test: symlinks not supported on this file system\\n\",\n           stderr);\n  return result;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}