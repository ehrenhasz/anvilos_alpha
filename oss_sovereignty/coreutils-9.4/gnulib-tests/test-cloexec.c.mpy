{
  "module_name": "test-cloexec.c",
  "hash_id": "8ebf6c620b56c331d90de3a3e9351a5ae1272269c9637670c6cbdd24d655bd2a",
  "original_prompt": "Ingested from coreutils-9.4/gnulib-tests/test-cloexec.c",
  "human_readable_source": " \n\n#include <config.h>\n\n#include \"cloexec.h\"\n\n#include <errno.h>\n#include <fcntl.h>\n#include <unistd.h>\n\n#if defined _WIN32 && ! defined __CYGWIN__\n \n# define WIN32_LEAN_AND_MEAN\n# include <windows.h>\n \n# if GNULIB_MSVC_NOTHROW\n#  include \"msvc-nothrow.h\"\n# else\n#  include <io.h>\n# endif\n#endif\n\n#include \"binary-io.h\"\n#include \"macros.h\"\n\n \nstatic int\nis_inheritable (int fd)\n{\n#if defined _WIN32 && ! defined __CYGWIN__\n   \n  HANDLE h = (HANDLE) _get_osfhandle (fd);\n  DWORD flags;\n  if (h == INVALID_HANDLE_VALUE || GetHandleInformation (h, &flags) == 0)\n    return 0;\n  return (flags & HANDLE_FLAG_INHERIT) != 0;\n#else\n# ifndef F_GETFD\n#  error Please port fcntl to your platform\n# endif\n  int i = fcntl (fd, F_GETFD);\n  return 0 <= i && (i & FD_CLOEXEC) == 0;\n#endif\n}\n\n#if !O_BINARY\n# define set_binary_mode(f,m) zero ()\nstatic int zero (void) { return 0; }\n#endif\n\n \nstatic int\nis_mode (int fd, int mode)\n{\n  int value = set_binary_mode (fd, O_BINARY);\n  set_binary_mode (fd, value);\n  return mode == value;\n}\n\nint\nmain (void)\n{\n  const char *file = \"test-cloexec.tmp\";\n  int fd = creat (file, 0600);\n  int fd2;\n  int bad_fd = getdtablesize ();\n\n   \n  ASSERT (STDERR_FILENO < fd);\n  ASSERT (is_inheritable (fd));\n\n   \n  ASSERT (set_cloexec_flag (fd, true) == 0);\n#if !(defined _WIN32 && ! defined __CYGWIN__)\n  ASSERT (!is_inheritable (fd));\n#endif\n  ASSERT (set_cloexec_flag (fd, false) == 0);\n  ASSERT (is_inheritable (fd));\n\n   \n  fd2 = dup_cloexec (fd);\n  ASSERT (fd < fd2);\n  ASSERT (!is_inheritable (fd2));\n  ASSERT (close (fd) == 0);\n  ASSERT (dup_cloexec (fd2) == fd);\n  ASSERT (!is_inheritable (fd));\n  ASSERT (close (fd2) == 0);\n\n   \n  set_binary_mode (fd, O_BINARY);\n  ASSERT (is_mode (fd, O_BINARY));\n  fd2 = dup_cloexec (fd);\n  ASSERT (fd < fd2);\n  ASSERT (is_mode (fd2, O_BINARY));\n  ASSERT (close (fd2) == 0);\n  set_binary_mode (fd, O_TEXT);\n  ASSERT (is_mode (fd, O_TEXT));\n  fd2 = dup_cloexec (fd);\n  ASSERT (fd < fd2);\n  ASSERT (is_mode (fd2, O_TEXT));\n  ASSERT (close (fd2) == 0);\n\n   \n  errno = 0;\n  ASSERT (set_cloexec_flag (-1, false) == -1);\n  ASSERT (errno == EBADF);\n  errno = 0;\n  ASSERT (set_cloexec_flag (bad_fd, false) == -1);\n  ASSERT (errno == EBADF);\n  errno = 0;\n  ASSERT (set_cloexec_flag (fd2, false) == -1);\n  ASSERT (errno == EBADF);\n  errno = 0;\n  ASSERT (dup_cloexec (-1) == -1);\n  ASSERT (errno == EBADF);\n  errno = 0;\n  ASSERT (dup_cloexec (bad_fd) == -1);\n  ASSERT (errno == EBADF);\n  errno = 0;\n  ASSERT (dup_cloexec (fd2) == -1);\n  ASSERT (errno == EBADF);\n\n   \n  ASSERT (close (fd) == 0);\n  ASSERT (unlink (file) == 0);\n\n  return 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}