{
  "module_name": "test-fpurge.c",
  "hash_id": "a9e244007b1b46aa7783a88724c51226e84876459e651bd795877913343098a0",
  "original_prompt": "Ingested from coreutils-9.4/gnulib-tests/test-fpurge.c",
  "human_readable_source": " \n\n#include <config.h>\n\n \n#define _GL_NO_LARGE_FILES\n#include <stdio.h>\n\n#include <string.h>\n\n#include \"macros.h\"\n\n#define TESTFILE \"t-fpurge.tmp\"\n\nint\nmain (void)\n{\n  int check_filepos;\n\n  for (check_filepos = 0; check_filepos <= 1; check_filepos++)\n    {\n      FILE *fp;\n\n       \n      fp = fopen (TESTFILE, \"w\");\n      if (fp == NULL)\n        goto skip;\n      if (fwrite (\"foobarsh\", 1, 8, fp) < 8)\n        goto skip;\n      if (fclose (fp))\n        goto skip;\n\n       \n\n       \n      fp = fopen (TESTFILE, \"r+\");\n      if (fp == NULL)\n        goto skip;\n      if (fseek (fp, 3, SEEK_CUR))\n        goto skip;\n      if (fwrite (\"g\", 1, 1, fp) < 1)\n        goto skip;\n      if (fflush (fp))\n        goto skip;\n      if (fwrite (\"bz\", 1, 2, fp) < 2)\n        goto skip;\n       \n      ASSERT (fpurge (fp) == 0);\n       \n      if (check_filepos)\n        ASSERT (ftell (fp) == 4);\n      ASSERT (fclose (fp) == 0);\n\n       \n      fp = fopen (TESTFILE, \"r\");\n      if (fp == NULL)\n        goto skip;\n       \n      {\n        char buf[8];\n        if (fread (buf, 1, 7, fp) < 7)\n          goto skip;\n        ASSERT (memcmp (buf, \"foogars\", 7) == 0);\n      }\n       \n      if (check_filepos)\n        ASSERT (ftell (fp) == 7);\n      ASSERT (fpurge (fp) == 0);\n       \n      if (check_filepos)\n        ASSERT (ftell (fp) == 8);\n      ASSERT (getc (fp) == EOF);\n      ASSERT (fclose (fp) == 0);\n\n       \n\n       \n      fp = fopen (TESTFILE, \"r+\");\n      if (fp == NULL)\n        goto skip;\n      if (fseek (fp, -1, SEEK_END))\n        goto skip;\n      ASSERT (getc (fp) == 'h');\n      ASSERT (getc (fp) == EOF);\n      if (check_filepos)\n        ASSERT (ftell (fp) == 8);\n      ASSERT (fpurge (fp) == 0);\n      if (check_filepos)\n        ASSERT (ftell (fp) == 8);\n      ASSERT (putc ('!', fp) == '!');\n      if (check_filepos)\n        ASSERT (ftell (fp) == 9);\n      ASSERT (fclose (fp) == 0);\n      fp = fopen (TESTFILE, \"r\");\n      if (fp == NULL)\n        goto skip;\n      {\n        char buf[10];\n        ASSERT (fread (buf, 1, 10, fp) == 9);\n        ASSERT (memcmp (buf, \"foogarsh!\", 9) == 0);\n      }\n      ASSERT (fclose (fp) == 0);\n\n       \n    }\n\n  remove (TESTFILE);\n  return 0;\n\n skip:\n  fprintf (stderr, \"Skipping test: prerequisite file operations failed.\\n\");\n  remove (TESTFILE);\n  return 77;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}