{
  "module_name": "cksum.c",
  "hash_id": "971ba178a4b5080860a3d70aefaf64568e59d09e36f31cfef945710e84754d4e",
  "original_prompt": "Ingested from coreutils-9.4/src/cksum.c",
  "human_readable_source": " \n\n#include <config.h>\n\n#include <stdio.h>\n#include <sys/types.h>\n#include <stdint.h>\n#include \"system.h\"\n\n#include <byteswap.h>\n#ifdef WORDS_BIGENDIAN\n# define SWAP(n) (n)\n#else\n# define SWAP(n) bswap_32 (n)\n#endif\n\n#ifdef CRCTAB\n\n# define BIT(x)\t((uint_fast32_t) 1 << (x))\n# define SBIT\tBIT (31)\n\n \n\n# define GEN\t(BIT (26) | BIT (23) | BIT (22) | BIT (16) | BIT (12) \\\n                 | BIT (11) | BIT (10) | BIT (8) | BIT (7) | BIT (5) \\\n                 | BIT (4) | BIT (2) | BIT (1) | BIT (0))\n\nstatic uint_fast32_t r[8];\n\nstatic void\nfill_r (void)\n{\n  r[0] = GEN;\n  for (int i = 1; i < 8; i++)\n    r[i] = (r[i - 1] << 1) ^ ((r[i - 1] & SBIT) ? GEN : 0);\n}\n\nstatic uint_fast32_t\ncrc_remainder (int m)\n{\n  uint_fast32_t rem = 0;\n\n  for (int i = 0; i < 8; i++)\n    if (BIT (i) & m)\n      rem ^= r[i];\n\n  return rem & 0xFFFFFFFF;\t \n}\n\nint\nmain (void)\n{\n  int i;\n  static uint_fast32_t crctab[8][256];\n\n  fill_r ();\n\n  for (i = 0; i < 256; i++)\n    {\n      crctab[0][i] = crc_remainder (i);\n    }\n\n   \n  for (i = 0; i < 256; i++)\n    {\n      uint32_t crc = 0;\n\n      crc = (crc << 8) ^ crctab[0][((crc >> 24) ^ (i & 0xFF)) & 0xFF];\n      for (idx_t offset = 1; offset < 8; offset++)\n        {\n          crc = (crc << 8) ^ crctab[0][((crc >> 24) ^ 0x00) & 0xFF];\n          crctab[offset][i] = crc;\n        }\n    }\n\n  printf (\"#include <config.h>\\n\");\n  printf (\"#include <stdint.h>\\n\");\n  printf (\"\\nuint_fast32_t const crctab[8][256] = {\\n\");\n  for (int y = 0; y < 8; y++)\n    {\n      printf (\"{\\n  0x%08x\", crctab[y][0]);\n      for (i = 0; i < 51; i++)\n        {\n          printf (\",\\n  0x%08x, 0x%08x, 0x%08x, 0x%08x, 0x%08x\",\n                  crctab[y][i * 5 + 1], crctab[y][i * 5 + 2],\n                  crctab[y][i * 5 + 3], crctab[y][i * 5 + 4],\n                  crctab[y][i * 5 + 5]);\n        }\n        printf (\"\\n},\\n\");\n    }\n  printf (\"};\\n\");\n  return EXIT_SUCCESS;\n}\n\n#else  \n\n# include \"cksum.h\"\n\n \n# define BUFLEN (1 << 16)\n\n# if USE_PCLMUL_CRC32\nstatic bool\npclmul_supported (void)\n{\n  bool pclmul_enabled = (0 < __builtin_cpu_supports (\"pclmul\")\n                         && 0 < __builtin_cpu_supports (\"avx\"));\n\n  if (cksum_debug)\n    error (0, 0, \"%s\",\n           (pclmul_enabled\n            ? _(\"using pclmul hardware support\")\n            : _(\"pclmul support not detected\")));\n\n  return pclmul_enabled;\n}\n# endif  \n\nstatic bool\ncksum_slice8 (FILE *fp, uint_fast32_t *crc_out, uintmax_t *length_out)\n{\n  uint32_t buf[BUFLEN / sizeof (uint32_t)];\n  uint_fast32_t crc = 0;\n  uintmax_t length = 0;\n  size_t bytes_read;\n\n  if (!fp || !crc_out || !length_out)\n    return false;\n\n  while ((bytes_read = fread (buf, 1, BUFLEN, fp)) > 0)\n    {\n      uint32_t *datap;\n\n      if (length + bytes_read < length)\n        {\n          errno = EOVERFLOW;\n          return false;\n        }\n      length += bytes_read;\n\n       \n      datap = (uint32_t *)buf;\n      while (bytes_read >= 8)\n        {\n          uint32_t first = *datap++, second = *datap++;\n          crc ^= SWAP (first);\n          second = SWAP (second);\n          crc = (crctab[7][(crc >> 24) & 0xFF]\n                 ^ crctab[6][(crc >> 16) & 0xFF]\n                 ^ crctab[5][(crc >> 8) & 0xFF]\n                 ^ crctab[4][(crc) & 0xFF]\n                 ^ crctab[3][(second >> 24) & 0xFF]\n                 ^ crctab[2][(second >> 16) & 0xFF]\n                 ^ crctab[1][(second >> 8) & 0xFF]\n                 ^ crctab[0][(second) & 0xFF]);\n          bytes_read -= 8;\n        }\n\n       \n      unsigned char *cp = (unsigned char *)datap;\n      while (bytes_read--)\n        crc = (crc << 8) ^ crctab[0][((crc >> 24) ^ *cp++) & 0xFF];\n      if (feof (fp))\n        break;\n    }\n\n  *crc_out = crc;\n  *length_out = length;\n\n  return !ferror (fp);\n}\n\n \n\nint\ncrc_sum_stream (FILE *stream, void *resstream, uintmax_t *length)\n{\n  uintmax_t total_bytes = 0;\n  uint_fast32_t crc = 0;\n\n# if USE_PCLMUL_CRC32\n  static bool (*cksum_fp) (FILE *, uint_fast32_t *, uintmax_t *);\n  if (! cksum_fp)\n    cksum_fp = pclmul_supported () ? cksum_pclmul : cksum_slice8;\n# else\n  bool (*cksum_fp) (FILE *, uint_fast32_t *, uintmax_t *) = cksum_slice8;\n# endif\n\n  if (! cksum_fp (stream, &crc, &total_bytes))\n    return -1;\n\n  *length = total_bytes;\n\n  for (; total_bytes; total_bytes >>= 8)\n    crc = (crc << 8) ^ crctab[0][((crc >> 24) ^ total_bytes) & 0xFF];\n  crc = ~crc & 0xFFFFFFFF;\n\n  unsigned int crc_out = crc;\n  memcpy (resstream, &crc_out, sizeof crc_out);\n\n  return 0;\n}\n\n \n\nvoid\noutput_crc (char const *file, int binary_file, void const *digest, bool raw,\n            bool tagged, unsigned char delim, bool args, uintmax_t length)\n{\n  if (raw)\n    {\n       \n      uint32_t out_int = SWAP (*(uint32_t *)digest);\n      fwrite (&out_int, 1, 32/8, stdout);\n      return;\n    }\n\n  char length_buf[INT_BUFSIZE_BOUND (uintmax_t)];\n  printf (\"%u %s\", *(unsigned int *)digest, umaxtostr (length, length_buf));\n  if (args)\n    printf (\" %s\", file);\n  putchar (delim);\n}\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}