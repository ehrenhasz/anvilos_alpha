{
  "module_name": "wc_avx2.c",
  "hash_id": "d984c75e3ae4e419af490d9d38e9191c8f6cc034d688ef4f3080c61f2298eccd",
  "original_prompt": "Ingested from coreutils-9.4/src/wc_avx2.c",
  "human_readable_source": " \n#define BUFSIZE (16320)\n\nextern bool\nwc_lines_avx2 (char const *file, int fd, uintmax_t *lines_out,\n               uintmax_t *bytes_out);\n\nextern bool\nwc_lines_avx2 (char const *file, int fd, uintmax_t *lines_out,\n               uintmax_t *bytes_out)\n{\n  __m256i accumulator;\n  __m256i accumulator2;\n  __m256i zeroes;\n  __m256i endlines;\n  __m256i avx_buf[BUFSIZE / sizeof (__m256i)];\n  __m256i *datap;\n  uintmax_t lines = 0;\n  uintmax_t bytes = 0;\n  size_t bytes_read = 0;\n\n\n  if (!lines_out || !bytes_out)\n    return false;\n\n   \n  accumulator = _mm256_setzero_si256 ();\n  accumulator2 = _mm256_setzero_si256 ();\n  zeroes = _mm256_setzero_si256 ();\n  endlines = _mm256_set1_epi8 ('\\n');\n\n  while ((bytes_read = safe_read (fd, avx_buf, sizeof (avx_buf))) > 0)\n    {\n      __m256i to_match;\n      __m256i to_match2;\n      __m256i matches;\n      __m256i matches2;\n\n      if (bytes_read == SAFE_READ_ERROR)\n        {\n          error (0, errno, \"%s\", quotef (file));\n          return false;\n        }\n\n      bytes += bytes_read;\n\n      datap = avx_buf;\n      char *end = ((char *)avx_buf) + bytes_read;\n\n      while (bytes_read >= 64)\n        {\n          to_match = _mm256_load_si256 (datap);\n          to_match2 = _mm256_load_si256 (datap + 1);\n\n          matches = _mm256_cmpeq_epi8 (to_match, endlines);\n          matches2 = _mm256_cmpeq_epi8 (to_match2, endlines);\n           \n          accumulator = _mm256_sub_epi8 (accumulator, matches);\n          accumulator2 = _mm256_sub_epi8 (accumulator2, matches2);\n\n          datap += 2;\n          bytes_read -= 64;\n        }\n\n       \n      accumulator = _mm256_sad_epu8 (accumulator, zeroes);\n      lines +=   _mm256_extract_epi16 (accumulator, 0)\n               + _mm256_extract_epi16 (accumulator, 4)\n               + _mm256_extract_epi16 (accumulator, 8)\n               + _mm256_extract_epi16 (accumulator, 12);\n      accumulator = _mm256_setzero_si256 ();\n\n      accumulator2 = _mm256_sad_epu8 (accumulator2, zeroes);\n      lines +=   _mm256_extract_epi16 (accumulator2, 0)\n               + _mm256_extract_epi16 (accumulator2, 4)\n               + _mm256_extract_epi16 (accumulator2, 8)\n               + _mm256_extract_epi16 (accumulator2, 12);\n      accumulator2 = _mm256_setzero_si256 ();\n\n       \n      char *p = (char *)datap;\n      while (p != end)\n        lines += *p++ == '\\n';\n    }\n\n  *lines_out = lines;\n  *bytes_out = bytes;\n\n  return true;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}