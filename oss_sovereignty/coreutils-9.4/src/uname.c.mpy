{
  "module_name": "uname.c",
  "hash_id": "743dd71ef3d3289301f89ede6650b1549a105cdbcc16fa4961f90c25d29759db",
  "original_prompt": "Ingested from coreutils-9.4/src/uname.c",
  "human_readable_source": " \n\n#include <config.h>\n#include <stdio.h>\n#include <sys/types.h>\n#include <sys/utsname.h>\n#include <getopt.h>\n\n#if HAVE_SYSINFO && HAVE_SYS_SYSTEMINFO_H\n# include <sys/systeminfo.h>\n#endif\n\n#if HAVE_SYS_SYSCTL_H && ! defined __GLIBC__ && ! defined __APPLE__\n# if HAVE_SYS_PARAM_H\n#  include <sys/param.h>  \n# endif\n# include <sys/sysctl.h>\n# ifdef HW_MODEL\n#  ifdef HW_MACHINE_ARCH\n \n#   define UNAME_HARDWARE_PLATFORM HW_MODEL\n#   define UNAME_PROCESSOR HW_MACHINE_ARCH\n#  else\n \n#   define UNAME_PROCESSOR HW_MODEL\n#  endif\n# endif\n#endif\n\n#include \"system.h\"\n#include \"quote.h\"\n#include \"uname.h\"\n\n \n#define PROGRAM_NAME (uname_mode == UNAME_UNAME ? \"uname\" : \"arch\")\n\n#define AUTHORS proper_name (\"David MacKenzie\")\n#define ARCH_AUTHORS \"David MacKenzie\", \"Karel Zak\"\n\n \n \n#define PRINT_KERNEL_NAME 1\n\n \n#define PRINT_NODENAME 2\n\n \n#define PRINT_KERNEL_RELEASE 4\n\n \n#define PRINT_KERNEL_VERSION 8\n\n \n#define PRINT_MACHINE 16\n\n \n#define PRINT_PROCESSOR 32\n\n \n#define PRINT_HARDWARE_PLATFORM 64\n\n \n#define PRINT_OPERATING_SYSTEM 128\n\nstatic struct option const uname_long_options[] =\n{\n  {\"all\", no_argument, nullptr, 'a'},\n  {\"kernel-name\", no_argument, nullptr, 's'},\n  {\"sysname\", no_argument, nullptr, 's'},\t \n  {\"nodename\", no_argument, nullptr, 'n'},\n  {\"kernel-release\", no_argument, nullptr, 'r'},\n  {\"release\", no_argument, nullptr, 'r'},   \n  {\"kernel-version\", no_argument, nullptr, 'v'},\n  {\"machine\", no_argument, nullptr, 'm'},\n  {\"processor\", no_argument, nullptr, 'p'},\n  {\"hardware-platform\", no_argument, nullptr, 'i'},\n  {\"operating-system\", no_argument, nullptr, 'o'},\n  {GETOPT_HELP_OPTION_DECL},\n  {GETOPT_VERSION_OPTION_DECL},\n  {nullptr, 0, nullptr, 0}\n};\n\nstatic struct option const arch_long_options[] =\n{\n  {GETOPT_HELP_OPTION_DECL},\n  {GETOPT_VERSION_OPTION_DECL},\n  {nullptr, 0, nullptr, 0}\n};\n\nvoid\nusage (int status)\n{\n  if (status != EXIT_SUCCESS)\n    emit_try_help ();\n  else\n    {\n      printf (_(\"Usage: %s [OPTION]...\\n\"), program_name);\n\n      if (uname_mode == UNAME_UNAME)\n        {\n          fputs (_(\"\\\nPrint certain system information.  With no OPTION, same as -s.\\n\\\n\\n\\\n  -a, --all                print all information, in the following order,\\n\\\n                             except omit -p and -i if unknown:\\n\\\n  -s, --kernel-name        print the kernel name\\n\\\n  -n, --nodename           print the network node hostname\\n\\\n  -r, --kernel-release     print the kernel release\\n\\\n\"), stdout);\n          fputs (_(\"\\\n  -v, --kernel-version     print the kernel version\\n\\\n  -m, --machine            print the machine hardware name\\n\\\n  -p, --processor          print the processor type (non-portable)\\n\\\n  -i, --hardware-platform  print the hardware platform (non-portable)\\n\\\n  -o, --operating-system   print the operating system\\n\\\n\"), stdout);\n        }\n      else\n        {\n          fputs (_(\"\\\nPrint machine architecture.\\n\\\n\\n\\\n\"), stdout);\n        }\n\n      fputs (HELP_OPTION_DESCRIPTION, stdout);\n      fputs (VERSION_OPTION_DESCRIPTION, stdout);\n      emit_ancillary_info (PROGRAM_NAME);\n    }\n  exit (status);\n}\n\n/* Print ELEMENT, preceded by a space if something has already been\n   printed.  */\n\nstatic void\nprint_element (char const *element)\n{\n  static bool printed;\n  if (printed)\n    putchar (' ');\n  printed = true;\n  fputs (element, stdout);\n}\n\n/* Print ELEMENT, preceded by a space if something has already been\n   printed.  But if the environment variable ENVVAR is set, print its\n   value instead of ELEMENT.  */\n\nstatic void\nprint_element_env (char const *element, MAYBE_UNUSED char const *envvar)\n{\n#ifdef __APPLE__\n  if (envvar)\n    {\n      char const *val = getenv (envvar);\n      if (val)\n        element = val;\n    }\n#endif\n  print_element (element);\n}\n\n\n/* Set all the option flags according to the switches specified.\n   Return the mask indicating which elements to print.  */\n\nstatic int\ndecode_switches (int argc, char **argv)\n{\n  int c;\n  unsigned int toprint = 0;\n\n  if (uname_mode == UNAME_ARCH)\n    {\n      while ((c = getopt_long (argc, argv, \"\",\n                               arch_long_options, nullptr))\n             != -1)\n        {\n          switch (c)\n            {\n            case_GETOPT_HELP_CHAR;\n\n            case_GETOPT_VERSION_CHAR (PROGRAM_NAME, ARCH_AUTHORS);\n\n            default:\n              usage (EXIT_FAILURE);\n            }\n        }\n      toprint = PRINT_MACHINE;\n    }\n  else\n    {\n      while ((c = getopt_long (argc, argv, \"asnrvmpio\",\n                               uname_long_options, nullptr))\n             != -1)\n        {\n          switch (c)\n            {\n            case 'a':\n              toprint = UINT_MAX;\n              break;\n\n            case 's':\n              toprint |= PRINT_KERNEL_NAME;\n              break;\n\n            case 'n':\n              toprint |= PRINT_NODENAME;\n              break;\n\n            case 'r':\n              toprint |= PRINT_KERNEL_RELEASE;\n              break;\n\n            case 'v':\n              toprint |= PRINT_KERNEL_VERSION;\n              break;\n\n            case 'm':\n              toprint |= PRINT_MACHINE;\n              break;\n\n            case 'p':\n              toprint |= PRINT_PROCESSOR;\n              break;\n\n            case 'i':\n              toprint |= PRINT_HARDWARE_PLATFORM;\n              break;\n\n            case 'o':\n              toprint |= PRINT_OPERATING_SYSTEM;\n              break;\n\n            case_GETOPT_HELP_CHAR;\n\n            case_GETOPT_VERSION_CHAR (PROGRAM_NAME, AUTHORS);\n\n            default:\n              usage (EXIT_FAILURE);\n            }\n        }\n    }\n\n  if (argc != optind)\n    {\n      error (0, 0, _(\"extra operand %s\"), quote (argv[optind]));\n      usage (EXIT_FAILURE);\n    }\n\n  return toprint;\n}\n\nint\nmain (int argc, char **argv)\n{\n  static char const unknown[] = \"unknown\";\n\n  /* Mask indicating which elements to print. */\n  unsigned int toprint = 0;\n\n  initialize_main (&argc, &argv);\n  set_program_name (argv[0]);\n  setlocale (LC_ALL, \"\");\n  bindtextdomain (PACKAGE, LOCALEDIR);\n  textdomain (PACKAGE);\n\n  atexit (close_stdout);\n\n  toprint = decode_switches (argc, argv);\n\n  if (toprint == 0)\n    toprint = PRINT_KERNEL_NAME;\n\n  if (toprint\n       & (PRINT_KERNEL_NAME | PRINT_NODENAME | PRINT_KERNEL_RELEASE\n          | PRINT_KERNEL_VERSION | PRINT_MACHINE))\n    {\n      struct utsname name;\n\n      if (uname (&name) == -1)\n        error (EXIT_FAILURE, errno, _(\"cannot get system name\"));\n\n      if (toprint & PRINT_KERNEL_NAME)\n        print_element_env (name.sysname, \"UNAME_SYSNAME\");\n      if (toprint & PRINT_NODENAME)\n        print_element_env (name.nodename, \"UNAME_NODENAME\");\n      if (toprint & PRINT_KERNEL_RELEASE)\n        print_element_env (name.release, \"UNAME_RELEASE\");\n      if (toprint & PRINT_KERNEL_VERSION)\n        print_element_env (name.version, \"UNAME_VERSION\");\n      if (toprint & PRINT_MACHINE)\n        print_element_env (name.machine, \"UNAME_MACHINE\");\n    }\n\n  if (toprint & PRINT_PROCESSOR)\n    {\n      char const *element = unknown;\n#ifdef __APPLE__\n# if defined __arm__ || defined __arm64__\n      element = \"arm\";\n# elif defined __i386__ || defined __x86_64__\n      element = \"i386\";\n# elif defined __ppc__ || defined __ppc64__\n      element = \"powerpc\";\n# endif\n#endif\n#if HAVE_SYSINFO && defined SI_ARCHITECTURE\n      if (element == unknown)\n        {\n          static char processor[257];\n          if (0 <= sysinfo (SI_ARCHITECTURE, processor, sizeof processor))\n            element = processor;\n        }\n#endif\n#ifdef UNAME_PROCESSOR\n      if (element == unknown)\n        {\n          static char processor[257];\n          size_t s = sizeof processor;\n          static int mib[] = { CTL_HW, UNAME_PROCESSOR };\n          if (sysctl (mib, 2, processor, &s, 0, 0) >= 0)\n            element = processor;\n        }\n#endif\n      if (! (toprint == UINT_MAX && element == unknown))\n        print_element (element);\n    }\n\n  if (toprint & PRINT_HARDWARE_PLATFORM)\n    {\n      char const *element = unknown;\n#if HAVE_SYSINFO && defined SI_PLATFORM\n      {\n        static char hardware_platform[257];\n        if (0 <= sysinfo (SI_PLATFORM,\n                          hardware_platform, sizeof hardware_platform))\n          element = hardware_platform;\n      }\n#endif\n#ifdef UNAME_HARDWARE_PLATFORM\n      if (element == unknown)\n        {\n          static char hardware_platform[257];\n          size_t s = sizeof hardware_platform;\n          static int mib[] = { CTL_HW, UNAME_HARDWARE_PLATFORM };\n          if (sysctl (mib, 2, hardware_platform, &s, 0, 0) >= 0)\n            element = hardware_platform;\n        }\n#endif\n      if (! (toprint == UINT_MAX && element == unknown))\n        print_element (element);\n    }\n\n  if (toprint & PRINT_OPERATING_SYSTEM)\n    print_element (HOST_OPERATING_SYSTEM);\n\n  putchar ('\\n');\n\n  return EXIT_SUCCESS;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}