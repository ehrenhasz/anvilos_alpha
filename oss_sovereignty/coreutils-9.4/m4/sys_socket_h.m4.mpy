{
  "module_name": "sys_socket_h.m4",
  "hash_id": "a0917bc58e1bde1673240e61e86be50b70f59658cdc4244606b4f241124abde5",
  "original_prompt": "Ingested from coreutils-9.4/m4/sys_socket_h.m4",
  "human_readable_source": "# sys_socket_h.m4 serial 29\ndnl Copyright (C) 2005-2023 Free Software Foundation, Inc.\ndnl This file is free software; the Free Software Foundation\ndnl gives unlimited permission to copy and/or distribute it,\ndnl with or without modifications, as long as this notice is preserved.\n\ndnl From Simon Josefsson.\n\nAC_DEFUN_ONCE([gl_SYS_SOCKET_H],\n[\n  AC_REQUIRE([gl_SYS_SOCKET_H_DEFAULTS])\n  AC_REQUIRE([AC_CANONICAL_HOST])\n\n  dnl On OSF/1, the functions recv(), send(), recvfrom(), sendto() have\n  dnl old-style declarations (with return type 'int' instead of 'ssize_t')\n  dnl unless _POSIX_PII_SOCKET is defined.\n  case \"$host_os\" in\n    osf*)\n      AC_DEFINE([_POSIX_PII_SOCKET], [1],\n        [Define to 1 in order to get the POSIX compatible declarations\n         of socket functions.])\n      ;;\n  esac\n\n  GL_GENERATE_SYS_SOCKET_H=false\n  AC_CACHE_CHECK([whether <sys/socket.h> is self-contained],\n    [gl_cv_header_sys_socket_h_selfcontained],\n    [\n      AC_COMPILE_IFELSE([AC_LANG_PROGRAM([[#include <sys/socket.h>]], [[]])],\n        [gl_cv_header_sys_socket_h_selfcontained=yes],\n        [gl_cv_header_sys_socket_h_selfcontained=no])\n    ])\n  if test $gl_cv_header_sys_socket_h_selfcontained = yes; then\n    dnl If the shutdown function exists, <sys/socket.h> should define\n    dnl SHUT_RD, SHUT_WR, SHUT_RDWR.\n    AC_CHECK_FUNCS([shutdown])\n    if test $ac_cv_func_shutdown = yes; then\n      AC_CACHE_CHECK([whether <sys/socket.h> defines the SHUT_* macros],\n        [gl_cv_header_sys_socket_h_shut],\n        [\n          AC_COMPILE_IFELSE(\n            [AC_LANG_PROGRAM([[#include <sys/socket.h>]],\n               [[int a[] = { SHUT_RD, SHUT_WR, SHUT_RDWR };]])],\n            [gl_cv_header_sys_socket_h_shut=yes],\n            [gl_cv_header_sys_socket_h_shut=no])\n        ])\n      if test $gl_cv_header_sys_socket_h_shut = no; then\n        GL_GENERATE_SYS_SOCKET_H=true\n      fi\n    fi\n  fi\n  # We need to check for ws2tcpip.h now.\n  gl_PREREQ_SYS_H_SOCKET\n  AC_CHECK_TYPES([struct sockaddr_storage, sa_family_t],,,[\n  /* sys/types.h is not needed according to POSIX, but the\n     sys/socket.h in i386-unknown-freebsd4.10 and\n     powerpc-apple-darwin5.5 required it. */\n#include <sys/types.h>\n#ifdef HAVE_SYS_SOCKET_H\n#include <sys/socket.h>\n#endif\n#ifdef HAVE_WS2TCPIP_H\n#include <ws2tcpip.h>\n#endif\n])\n  if test $ac_cv_type_struct_sockaddr_storage = no; then\n    HAVE_STRUCT_SOCKADDR_STORAGE=0\n  fi\n  if test $ac_cv_type_sa_family_t = no; then\n    HAVE_SA_FAMILY_T=0\n  fi\n  if test $ac_cv_type_struct_sockaddr_storage != no; then\n    AC_CHECK_MEMBERS([struct sockaddr_storage.ss_family],\n      [],\n      [HAVE_STRUCT_SOCKADDR_STORAGE_SS_FAMILY=0],\n      [#include <sys/types.h>\n       #ifdef HAVE_SYS_SOCKET_H\n       #include <sys/socket.h>\n       #endif\n       #ifdef HAVE_WS2TCPIP_H\n       #include <ws2tcpip.h>\n       #endif\n      ])\n  fi\n  if test $HAVE_STRUCT_SOCKADDR_STORAGE = 0 || test $HAVE_SA_FAMILY_T = 0 \\\n     || test $HAVE_STRUCT_SOCKADDR_STORAGE_SS_FAMILY = 0; then\n    GL_GENERATE_SYS_SOCKET_H=true\n  fi\n  gl_PREREQ_SYS_H_WINSOCK2\n\n  dnl Check for declarations of anything we want to poison if the\n  dnl corresponding gnulib module is not in use.\n  gl_WARN_ON_USE_PREPARE([[\n/* Some systems require prerequisite headers.  */\n#include <sys/types.h>\n#include <sys/socket.h>\n    ]], [socket connect accept bind getpeername getsockname getsockopt\n    listen recv send recvfrom sendto setsockopt shutdown accept4])\n\n  AC_REQUIRE([AC_C_RESTRICT])\n])\n\nAC_DEFUN([gl_PREREQ_SYS_H_SOCKET],\n[\n  dnl Check prerequisites of the <sys/socket.h> replacement.\n  AC_REQUIRE([gl_CHECK_SOCKET_HEADERS])\n  gl_CHECK_NEXT_HEADERS([sys/socket.h])\n  if test $ac_cv_header_sys_socket_h = yes; then\n    HAVE_SYS_SOCKET_H=1\n  else\n    HAVE_SYS_SOCKET_H=0\n  fi\n  AC_SUBST([HAVE_SYS_SOCKET_H])\n  gl_PREREQ_SYS_H_WS2TCPIP\n])\n\n# Common prerequisites of the <sys/socket.h> replacement and of the\n# <sys/select.h> replacement.\n# Sets and substitutes HAVE_WINSOCK2_H.\nAC_DEFUN([gl_PREREQ_SYS_H_WINSOCK2],\n[\n  m4_ifdef([gl_UNISTD_H_DEFAULTS], [AC_REQUIRE([gl_UNISTD_H_DEFAULTS])])\n  m4_ifdef([gl_SYS_IOCTL_H_DEFAULTS], [AC_REQUIRE([gl_SYS_IOCTL_H_DEFAULTS])])\n  AC_CHECK_HEADERS_ONCE([sys/socket.h])\n  if test $ac_cv_header_sys_socket_h != yes; then\n    dnl We cannot use AC_CHECK_HEADERS_ONCE here, because that would make\n    dnl the check for those headers unconditional; yet cygwin reports\n    dnl that the headers are present but cannot be compiled (since on\n    dnl cygwin, all socket information should come from sys/socket.h).\n    AC_CHECK_HEADERS([winsock2.h])\n  fi\n  if test \"$ac_cv_header_winsock2_h\" = yes; then\n    HAVE_WINSOCK2_H=1\n    UNISTD_H_HAVE_WINSOCK2_H=1\n    SYS_IOCTL_H_HAVE_WINSOCK2_H=1\n  else\n    HAVE_WINSOCK2_H=0\n  fi\n  AC_SUBST([HAVE_WINSOCK2_H])\n])\n\n# Common prerequisites of the <sys/socket.h> replacement and of the\n# <arpa/inet.h> replacement.\n# Sets and substitutes HAVE_WS2TCPIP_H.\nAC_DEFUN([gl_PREREQ_SYS_H_WS2TCPIP],\n[\n  AC_REQUIRE([gl_CHECK_SOCKET_HEADERS])\n  if test $ac_cv_header_sys_socket_h = yes; then\n    HAVE_WS2TCPIP_H=0\n  else\n    if test $ac_cv_header_ws2tcpip_h = yes; then\n      HAVE_WS2TCPIP_H=1\n    else\n      HAVE_WS2TCPIP_H=0\n    fi\n  fi\n  AC_SUBST([HAVE_WS2TCPIP_H])\n])\n\n# gl_SYS_SOCKET_MODULE_INDICATOR([modulename])\n# sets the shell variable that indicates the presence of the given module\n# to a C preprocessor expression that will evaluate to 1.\n# This macro invocation must not occur in macros that are AC_REQUIREd.\nAC_DEFUN([gl_SYS_SOCKET_MODULE_INDICATOR],\n[\n  dnl Ensure to expand the default settings once only.\n  gl_SYS_SOCKET_H_REQUIRE_DEFAULTS\n  gl_MODULE_INDICATOR_SET_VARIABLE([$1])\n  dnl Define it also as a C macro, for the benefit of the unit tests.\n  gl_MODULE_INDICATOR_FOR_TESTS([$1])\n])\n\n# Initializes the default values for AC_SUBSTed shell variables.\n# This macro must not be AC_REQUIREd.  It must only be invoked, and only\n# outside of macros or in macros that are not AC_REQUIREd.\nAC_DEFUN([gl_SYS_SOCKET_H_REQUIRE_DEFAULTS],\n[\n  m4_defun(GL_MODULE_INDICATOR_PREFIX[_SYS_SOCKET_H_MODULE_INDICATOR_DEFAULTS], [\n    gl_MODULE_INDICATOR_INIT_VARIABLE([GNULIB_SOCKET])\n    gl_MODULE_INDICATOR_INIT_VARIABLE([GNULIB_CONNECT])\n    gl_MODULE_INDICATOR_INIT_VARIABLE([GNULIB_ACCEPT])\n    gl_MODULE_INDICATOR_INIT_VARIABLE([GNULIB_BIND])\n    gl_MODULE_INDICATOR_INIT_VARIABLE([GNULIB_GETPEERNAME])\n    gl_MODULE_INDICATOR_INIT_VARIABLE([GNULIB_GETSOCKNAME])\n    gl_MODULE_INDICATOR_INIT_VARIABLE([GNULIB_GETSOCKOPT])\n    gl_MODULE_INDICATOR_INIT_VARIABLE([GNULIB_LISTEN])\n    gl_MODULE_INDICATOR_INIT_VARIABLE([GNULIB_RECV])\n    gl_MODULE_INDICATOR_INIT_VARIABLE([GNULIB_SEND])\n    gl_MODULE_INDICATOR_INIT_VARIABLE([GNULIB_RECVFROM])\n    gl_MODULE_INDICATOR_INIT_VARIABLE([GNULIB_SENDTO])\n    gl_MODULE_INDICATOR_INIT_VARIABLE([GNULIB_SETSOCKOPT])\n    gl_MODULE_INDICATOR_INIT_VARIABLE([GNULIB_SHUTDOWN])\n    gl_MODULE_INDICATOR_INIT_VARIABLE([GNULIB_ACCEPT4])\n  ])\n  m4_require(GL_MODULE_INDICATOR_PREFIX[_SYS_SOCKET_H_MODULE_INDICATOR_DEFAULTS])\n  AC_REQUIRE([gl_SYS_SOCKET_H_DEFAULTS])\n])\n\nAC_DEFUN([gl_SYS_SOCKET_H_DEFAULTS],\n[\n  HAVE_STRUCT_SOCKADDR_STORAGE=1; AC_SUBST([HAVE_STRUCT_SOCKADDR_STORAGE])\n  HAVE_STRUCT_SOCKADDR_STORAGE_SS_FAMILY=1;\n                        AC_SUBST([HAVE_STRUCT_SOCKADDR_STORAGE_SS_FAMILY])\n  HAVE_SA_FAMILY_T=1;   AC_SUBST([HAVE_SA_FAMILY_T])\n  HAVE_ACCEPT4=1;       AC_SUBST([HAVE_ACCEPT4])\n])\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}