{
  "module_name": "rename.m4",
  "hash_id": "d0613b8bb8c9e0327469191486f4f5e59489f60ddf53638214943c54c90354b2",
  "original_prompt": "Ingested from coreutils-9.4/m4/rename.m4",
  "human_readable_source": "# serial 35\n\n# Copyright (C) 2001, 2003, 2005-2006, 2009-2023 Free Software Foundation, Inc.\n# This file is free software; the Free Software Foundation\n# gives unlimited permission to copy and/or distribute it,\n# with or without modifications, as long as this notice is preserved.\n\ndnl From Volker Borchert.\ndnl Determine whether rename works for source file names with a trailing slash.\ndnl The rename from SunOS 4.1.1_U1 doesn't.\ndnl\ndnl If it doesn't, then define RENAME_TRAILING_SLASH_BUG and arrange\ndnl to compile the wrapper function.\ndnl\n\nAC_DEFUN([gl_FUNC_RENAME],\n[\n  AC_REQUIRE([AC_CANONICAL_HOST])\n  AC_REQUIRE([gl_STDIO_H_DEFAULTS])\n  AC_CHECK_FUNCS_ONCE([lstat])\n\n  dnl Solaris 11.3, AIX 7.1 mistakenly allow rename(\"file\",\"name/\").\n  dnl NetBSD 1.6 mistakenly forbids rename(\"dir\",\"name/\").\n  dnl FreeBSD 7.2 mistakenly allows rename(\"file\",\"link-to-file/\").\n  dnl The Solaris bug can be worked around without stripping\n  dnl trailing slash, while the NetBSD bug requires stripping;\n  dnl the two conditions can be distinguished by whether hard\n  dnl links are also broken.\n  AC_CACHE_CHECK([whether rename honors trailing slash on destination],\n    [gl_cv_func_rename_slash_dst_works],\n    [rm -rf conftest.f conftest.f1 conftest.f2 conftest.d1 conftest.d2 conftest.lnk\n    touch conftest.f && touch conftest.f1 && mkdir conftest.d1 ||\n      AC_MSG_ERROR([cannot create temporary files])\n    # Assume that if we have lstat, we can also check symlinks.\n    if test $ac_cv_func_lstat = yes; then\n      ln -s conftest.f conftest.lnk\n    fi\n    AC_RUN_IFELSE(\n      [AC_LANG_PROGRAM([[\n#        include <stdio.h>\n#        include <stdlib.h>\n         ]],\n         [[int result = 0;\n           if (rename (\"conftest.f1\", \"conftest.f2/\") == 0)\n             result |= 1;\n           if (rename (\"conftest.d1\", \"conftest.d2/\") != 0)\n             result |= 2;\n#if HAVE_LSTAT\n           if (rename (\"conftest.f\", \"conftest.lnk/\") == 0)\n             result |= 4;\n#endif\n           return result;\n         ]])],\n      [gl_cv_func_rename_slash_dst_works=yes],\n      [gl_cv_func_rename_slash_dst_works=no],\n      dnl When crosscompiling, assume rename is broken.\n      [case \"$host_os\" in\n                            # Guess yes on Linux systems.\n         linux-* | linux)   gl_cv_func_rename_slash_dst_works=\"guessing yes\" ;;\n                            # Guess yes on systems that emulate the Linux system calls.\n         midipix*)          gl_cv_func_rename_slash_dst_works=\"guessing yes\" ;;\n                            # Guess yes on glibc systems.\n         *-gnu*)            gl_cv_func_rename_slash_dst_works=\"guessing yes\" ;;\n                            # Guess no on native Windows.\n         mingw* | windows*) gl_cv_func_rename_slash_dst_works=\"guessing no\" ;;\n                            # If we don't know, obey --enable-cross-guesses.\n         *)                 gl_cv_func_rename_slash_dst_works=\"$gl_cross_guess_normal\" ;;\n       esac\n      ])\n    rm -rf conftest.f conftest.f1 conftest.f2 conftest.d1 conftest.d2 conftest.lnk\n  ])\n  case \"$gl_cv_func_rename_slash_dst_works\" in\n    *yes) ;;\n    *)\n      REPLACE_RENAME=1\n      AC_DEFINE([RENAME_TRAILING_SLASH_DEST_BUG], [1],\n        [Define if rename does not correctly handle slashes on the destination\n         argument, such as on Solaris 11 or NetBSD 1.6.])\n      ;;\n  esac\n\n  dnl SunOS 4.1.1_U1 mistakenly forbids rename(\"dir/\",\"name\").\n  dnl Solaris 9 mistakenly allows rename(\"file/\",\"name\").\n  dnl FreeBSD 7.2 mistakenly allows rename(\"link-to-file/\",\"name\").\n  dnl These bugs require stripping trailing slash to avoid corrupting\n  dnl symlinks with a trailing slash.\n  AC_CACHE_CHECK([whether rename honors trailing slash on source],\n    [gl_cv_func_rename_slash_src_works],\n    [rm -rf conftest.f conftest.f1 conftest.d1 conftest.d2 conftest.d3 conftest.lnk\n    touch conftest.f && touch conftest.f1 && mkdir conftest.d1 ||\n      AC_MSG_ERROR([cannot create temporary files])\n    # Assume that if we have lstat, we can also check symlinks.\n    if test $ac_cv_func_lstat = yes; then\n      ln -s conftest.f conftest.lnk\n    fi\n    AC_RUN_IFELSE(\n      [AC_LANG_PROGRAM([[\n#        include <stdio.h>\n#        include <stdlib.h>\n         ]],\n         [[int result = 0;\n           if (rename (\"conftest.f1/\", \"conftest.d3\") == 0)\n             result |= 1;\n           if (rename (\"conftest.d1/\", \"conftest.d2\") != 0)\n             result |= 2;\n#if HAVE_LSTAT\n           if (rename (\"conftest.lnk/\", \"conftest.f\") == 0)\n             result |= 4;\n#endif\n           return result;\n         ]])],\n      [gl_cv_func_rename_slash_src_works=yes],\n      [gl_cv_func_rename_slash_src_works=no],\n      dnl When crosscompiling, assume rename is broken.\n      [case \"$host_os\" in\n                            # Guess yes on Linux systems.\n         linux-* | linux)   gl_cv_func_rename_slash_src_works=\"guessing yes\" ;;\n                            # Guess yes on systems that emulate the Linux system calls.\n         midipix*)          gl_cv_func_rename_slash_src_works=\"guessing yes\" ;;\n                            # Guess yes on glibc systems.\n         *-gnu*)            gl_cv_func_rename_slash_src_works=\"guessing yes\" ;;\n                            # Guess yes on native Windows.\n         mingw* | windows*) gl_cv_func_rename_slash_src_works=\"guessing yes\" ;;\n                            # If we don't know, obey --enable-cross-guesses.\n         *)                 gl_cv_func_rename_slash_src_works=\"$gl_cross_guess_normal\" ;;\n       esac\n      ])\n    rm -rf conftest.f conftest.f1 conftest.d1 conftest.d2 conftest.d3 conftest.lnk\n  ])\n  case \"$gl_cv_func_rename_slash_src_works\" in\n    *yes) ;;\n    *)\n      REPLACE_RENAME=1\n      AC_DEFINE([RENAME_TRAILING_SLASH_SOURCE_BUG], [1],\n        [Define if rename does not correctly handle slashes on the source\n         argument, such as on Solaris 9 or cygwin 1.5.])\n      ;;\n  esac\n\n  dnl NetBSD 1.6 and cygwin 1.5.x mistakenly reduce hard link count\n  dnl on rename(\"h1\",\"h2\").\n  dnl This bug requires stat'ting targets prior to attempting rename.\n  AC_CHECK_FUNCS_ONCE([link])\n  AC_CACHE_CHECK([whether rename manages hard links correctly],\n    [gl_cv_func_rename_link_works],\n    [if test $ac_cv_func_link = yes; then\n       if test $cross_compiling != yes; then\n         rm -rf conftest.f conftest.f1 conftest.f2\n         if touch conftest.f conftest.f2 && ln conftest.f conftest.f1 &&\n             set x `ls -i conftest.f conftest.f1` && test \"$2\" = \"$4\"; then\n           AC_RUN_IFELSE(\n             [AC_LANG_PROGRAM([[\n#               include <errno.h>\n#               include <stdio.h>\n#               include <stdlib.h>\n#               include <unistd.h>\n                ]GL_MDA_DEFINES],\n                [[int result = 0;\n                  if (rename (\"conftest.f\", \"conftest.f1\"))\n                    result |= 1;\n                  if (unlink (\"conftest.f1\"))\n                    result |= 2;\n\n                  /* Allow either the POSIX-required behavior, where the\n                     previous rename kept conftest.f, or the (better) NetBSD\n                     behavior, where it removed conftest.f.  */\n                  if (rename (\"conftest.f\", \"conftest.f\") != 0\n                      && errno != ENOENT)\n                    result |= 4;\n\n                  if (rename (\"conftest.f1\", \"conftest.f1\") == 0)\n                    result |= 8;\n                  if (rename (\"conftest.f2\", \"conftest.f2\") != 0)\n                    result |= 16;\n                  return result;\n                ]])],\n             [gl_cv_func_rename_link_works=yes],\n             [gl_cv_func_rename_link_works=no],\n             [dnl We don't get here.\n              :\n             ])\n         else\n           gl_cv_func_rename_link_works=\"guessing no\"\n         fi\n         rm -rf conftest.f conftest.f1 conftest.f2\n       else\n         dnl When crosscompiling, assume rename is broken.\n         case \"$host_os\" in\n                              # Guess yes on Linux systems.\n           linux-* | linux)   gl_cv_func_rename_link_works=\"guessing yes\" ;;\n                              # Guess yes on systems that emulate the Linux system calls.\n           midipix*)          gl_cv_func_rename_link_works=\"guessing yes\" ;;\n                              # Guess yes on glibc systems.\n           *-gnu*)            gl_cv_func_rename_link_works=\"guessing yes\" ;;\n                              # Guess yes on native Windows.\n           mingw* | windows*) gl_cv_func_rename_link_works=\"guessing yes\" ;;\n                              # If we don't know, obey --enable-cross-guesses.\n           *)                 gl_cv_func_rename_link_works=\"$gl_cross_guess_normal\" ;;\n         esac\n       fi\n     else\n       gl_cv_func_rename_link_works=yes\n     fi\n    ])\n  case \"$gl_cv_func_rename_link_works\" in\n    *yes) ;;\n    *)\n      REPLACE_RENAME=1\n      AC_DEFINE([RENAME_HARD_LINK_BUG], [1],\n        [Define if rename fails to leave hard links alone, as on NetBSD 1.6\n         or Cygwin 1.5.])\n      ;;\n  esac\n\n  dnl Cygwin 1.5.x mistakenly allows rename(\"dir\",\"file\").\n  dnl mingw mistakenly forbids rename(\"dir1\",\"dir2\").\n  dnl These bugs require stripping trailing slash to avoid corrupting\n  dnl symlinks with a trailing slash.\n  AC_CACHE_CHECK([whether rename manages existing destinations correctly],\n    [gl_cv_func_rename_dest_works],\n    [rm -rf conftest.f conftest.d1 conftest.d2\n    touch conftest.f && mkdir conftest.d1 conftest.d2 ||\n      AC_MSG_ERROR([cannot create temporary files])\n    AC_RUN_IFELSE(\n      [AC_LANG_PROGRAM([[\n#        include <stdio.h>\n#        include <stdlib.h>\n         ]],\n         [[int result = 0;\n           if (rename (\"conftest.d1\", \"conftest.d2\") != 0)\n             result |= 1;\n           if (rename (\"conftest.d2\", \"conftest.f\") == 0)\n             result |= 2;\n           return result;\n         ]])],\n      [gl_cv_func_rename_dest_works=yes],\n      [gl_cv_func_rename_dest_works=no],\n      dnl When crosscompiling, assume rename is broken.\n      [case \"$host_os\" in\n                            # Guess yes on Linux systems.\n         linux-* | linux)   gl_cv_func_rename_dest_works=\"guessing yes\" ;;\n                            # Guess yes on glibc systems.\n         *-gnu*)            gl_cv_func_rename_dest_works=\"guessing yes\" ;;\n                            # Guess no on native Windows.\n         mingw* | windows*) gl_cv_func_rename_dest_works=\"guessing no\" ;;\n                            # If we don't know, obey --enable-cross-guesses.\n         *)                 gl_cv_func_rename_dest_works=\"$gl_cross_guess_normal\" ;;\n       esac\n      ])\n    rm -rf conftest.f conftest.d1 conftest.d2\n  ])\n  case \"$gl_cv_func_rename_dest_works\" in\n    *yes) ;;\n    *)\n      REPLACE_RENAME=1\n      AC_DEFINE([RENAME_DEST_EXISTS_BUG], [1],\n        [Define if rename does not work when the destination file exists,\n         as on Cygwin 1.5 or Windows.])\n      ;;\n  esac\n])\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}