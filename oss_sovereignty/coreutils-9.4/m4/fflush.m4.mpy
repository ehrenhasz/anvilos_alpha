{
  "module_name": "fflush.m4",
  "hash_id": "4419d92e510e25731c35c13cc86512cb5210dc747f1eafdbe02c019dc2c7e3af",
  "original_prompt": "Ingested from coreutils-9.4/m4/fflush.m4",
  "human_readable_source": "# fflush.m4 serial 19\n\n# Copyright (C) 2007-2023 Free Software Foundation, Inc.\n# This file is free software; the Free Software Foundation\n# gives unlimited permission to copy and/or distribute it,\n# with or without modifications, as long as this notice is preserved.\n\ndnl From Eric Blake\n\ndnl Find out how to obey POSIX semantics of fflush(stdin) discarding\ndnl unread input on seekable streams, rather than C99 undefined semantics.\n\nAC_DEFUN([gl_FUNC_FFLUSH],\n[\n  AC_REQUIRE([gl_STDIO_H_DEFAULTS])\n  gl_FUNC_FFLUSH_STDIN\n  case \"$gl_cv_func_fflush_stdin\" in\n    *yes) ;;\n    *) REPLACE_FFLUSH=1 ;;\n  esac\n])\n\ndnl Determine whether fflush works on input streams.\ndnl Sets gl_cv_func_fflush_stdin.\n\nAC_DEFUN([gl_FUNC_FFLUSH_STDIN],\n[\n  AC_REQUIRE([AC_CANONICAL_HOST]) dnl for cross-compiles\n  AC_CHECK_HEADERS_ONCE([unistd.h])\n  AC_CACHE_CHECK([whether fflush works on input streams],\n    [gl_cv_func_fflush_stdin],\n    [echo hello world > conftest.txt\n     AC_RUN_IFELSE([AC_LANG_PROGRAM(\n       [[\n#include <stdio.h>\n#if HAVE_UNISTD_H\n# include <unistd.h>\n#else /* on Windows with MSVC */\n# include <io.h>\n#endif\n       ]GL_MDA_DEFINES],\n       [[FILE *f = fopen (\"conftest.txt\", \"r\");\n         char buffer[10];\n         int fd;\n         int c;\n         if (f == NULL)\n           return 1;\n         fd = fileno (f);\n         if (fd < 0 || fread (buffer, 1, 5, f) != 5)\n           { fclose (f); return 2; }\n         /* For deterministic results, ensure f read a bigger buffer.  */\n         if (lseek (fd, 0, SEEK_CUR) == 5)\n           { fclose (f); return 3; }\n         /* POSIX requires fflush-fseek to set file offset of fd.  This fails\n            on BSD systems and on mingw.  */\n         if (fflush (f) != 0 || fseek (f, 0, SEEK_CUR) != 0)\n           { fclose (f); return 4; }\n         if (lseek (fd, 0, SEEK_CUR) != 5)\n           { fclose (f); return 5; }\n         /* Verify behaviour of fflush after ungetc. See\n            <https://www.opengroup.org/austin/aardvark/latest/xshbug3.txt>  */\n         /* Verify behaviour of fflush after a backup ungetc.  This fails on\n            mingw.  */\n         c = fgetc (f);\n         ungetc (c, f);\n         fflush (f);\n         if (fgetc (f) != c)\n           { fclose (f); return 6; }\n         /* Verify behaviour of fflush after a non-backup ungetc.  This fails\n            on glibc 2.8 and on BSD systems.  */\n         c = fgetc (f);\n         ungetc ('@', f);\n         fflush (f);\n         if (fgetc (f) != c)\n           { fclose (f); return 7; }\n         fclose (f);\n         return 0;\n       ]])],\n       [gl_cv_func_fflush_stdin=yes],\n       [gl_cv_func_fflush_stdin=no],\n       [case \"$host_os\" in\n                             # Guess no on native Windows.\n          mingw* | windows*) gl_cv_func_fflush_stdin=\"guessing no\" ;;\n          *)                 gl_cv_func_fflush_stdin=cross ;;\n        esac\n       ])\n     rm conftest.txt\n    ])\n  case \"$gl_cv_func_fflush_stdin\" in\n    *yes) gl_func_fflush_stdin=1 ;;\n    *no)  gl_func_fflush_stdin=0 ;;\n    *)    gl_func_fflush_stdin='(-1)' ;;\n  esac\n  AC_DEFINE_UNQUOTED([FUNC_FFLUSH_STDIN], [$gl_func_fflush_stdin],\n    [Define to 1 if fflush is known to work on stdin as per POSIX.1-2008,\n     0 if fflush is known to not work, -1 if unknown.])\n])\n\n# Prerequisites of lib/fflush.c.\nAC_DEFUN([gl_PREREQ_FFLUSH], [:])\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}