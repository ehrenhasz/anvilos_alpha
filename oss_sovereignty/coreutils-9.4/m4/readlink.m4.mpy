{
  "module_name": "readlink.m4",
  "hash_id": "566ae6ca762f8dcc48be90ebc3b86cd771f159c98cce4eeb0c34ffcffd87e63a",
  "original_prompt": "Ingested from coreutils-9.4/m4/readlink.m4",
  "human_readable_source": "# readlink.m4 serial 17\ndnl Copyright (C) 2003, 2007, 2009-2023 Free Software Foundation, Inc.\ndnl This file is free software; the Free Software Foundation\ndnl gives unlimited permission to copy and/or distribute it,\ndnl with or without modifications, as long as this notice is preserved.\n\nAC_DEFUN([gl_FUNC_READLINK],\n[\n  AC_REQUIRE([gl_UNISTD_H_DEFAULTS])\n  AC_REQUIRE([AC_CANONICAL_HOST]) dnl for cross-compiles\n  AC_CHECK_FUNCS_ONCE([readlink])\n  if test $ac_cv_func_readlink = no; then\n    HAVE_READLINK=0\n  else\n    AC_CACHE_CHECK([whether readlink signature is correct],\n      [gl_cv_decl_readlink_works],\n      [AC_COMPILE_IFELSE(\n         [AC_LANG_PROGRAM(\n           [[#include <unistd.h>\n      /* Cause compilation failure if original declaration has wrong type.  */\n      ssize_t readlink (const char *, char *, size_t);]])],\n         [gl_cv_decl_readlink_works=yes], [gl_cv_decl_readlink_works=no])])\n    dnl Solaris 9 ignores trailing slash.\n    dnl FreeBSD 7.2 dereferences only one level of links with trailing slash.\n    AC_CACHE_CHECK([whether readlink handles trailing slash correctly],\n      [gl_cv_func_readlink_trailing_slash],\n      [# We have readlink, so assume ln -s works.\n       ln -s conftest.no-such conftest.link\n       ln -s conftest.link conftest.lnk2\n       AC_RUN_IFELSE(\n         [AC_LANG_PROGRAM(\n           [[#include <unistd.h>\n]], [[char buf[20];\n      return readlink (\"conftest.lnk2/\", buf, sizeof buf) != -1;]])],\n         [gl_cv_func_readlink_trailing_slash=yes],\n         [gl_cv_func_readlink_trailing_slash=no],\n         [case \"$host_os\" in\n            # Guess yes on Linux or glibc systems.\n            linux-* | linux | *-gnu* | gnu*)\n              gl_cv_func_readlink_trailing_slash=\"guessing yes\" ;;\n            # Guess yes on systems that emulate the Linux system calls.\n            midipix*)\n              gl_cv_func_readlink_trailing_slash=\"guessing yes\" ;;\n            # Guess no on AIX or HP-UX.\n            aix* | hpux*)\n              gl_cv_func_readlink_trailing_slash=\"guessing no\" ;;\n            # If we don't know, obey --enable-cross-guesses.\n            *)\n              gl_cv_func_readlink_trailing_slash=\"$gl_cross_guess_normal\" ;;\n          esac\n         ])\n      rm -f conftest.link conftest.lnk2])\n    case \"$gl_cv_func_readlink_trailing_slash\" in\n      *yes)\n        if test \"$gl_cv_decl_readlink_works\" != yes; then\n          REPLACE_READLINK=1\n        fi\n        ;;\n      *)\n        AC_DEFINE([READLINK_TRAILING_SLASH_BUG], [1], [Define to 1 if readlink\n          fails to recognize a trailing slash.])\n        REPLACE_READLINK=1\n        ;;\n    esac\n\n    AC_CACHE_CHECK([whether readlink truncates results correctly],\n      [gl_cv_func_readlink_truncate],\n      [# We have readlink, so assume ln -s works.\n       ln -s ab conftest.link\n       AC_RUN_IFELSE(\n         [AC_LANG_PROGRAM(\n           [[#include <unistd.h>\n]], [[char c;\n      return readlink (\"conftest.link\", &c, 1) != 1;]])],\n         [gl_cv_func_readlink_truncate=yes],\n         [gl_cv_func_readlink_truncate=no],\n         [case \"$host_os\" in\n            # Guess yes on Linux or glibc systems.\n            linux-* | linux | *-gnu* | gnu*)\n              gl_cv_func_readlink_truncate=\"guessing yes\" ;;\n            # Guess yes on systems that emulate the Linux system calls.\n            midipix*)\n              gl_cv_func_readlink_truncate=\"guessing yes\" ;;\n            # Guess no on AIX or HP-UX.\n            aix* | hpux*)\n              gl_cv_func_readlink_truncate=\"guessing no\" ;;\n            # If we don't know, obey --enable-cross-guesses.\n            *)\n              gl_cv_func_readlink_truncate=\"$gl_cross_guess_normal\" ;;\n          esac\n         ])\n      rm -f conftest.link conftest.lnk2])\n    case $gl_cv_func_readlink_truncate in\n      *yes)\n        if test \"$gl_cv_decl_readlink_works\" != yes; then\n          REPLACE_READLINK=1\n        fi\n        ;;\n      *)\n        AC_DEFINE([READLINK_TRUNCATE_BUG], [1], [Define to 1 if readlink\n          sets errno instead of truncating a too-long link.])\n        REPLACE_READLINK=1\n        ;;\n    esac\n  fi\n])\n\n# Like gl_FUNC_READLINK, except prepare for separate compilation\n# (no REPLACE_READLINK, no AC_LIBOBJ).\nAC_DEFUN([gl_FUNC_READLINK_SEPARATE],\n[\n  AC_CHECK_FUNCS_ONCE([readlink])\n  gl_PREREQ_READLINK\n])\n\n# Prerequisites of lib/readlink.c.\nAC_DEFUN([gl_PREREQ_READLINK],\n[\n  :\n])\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}