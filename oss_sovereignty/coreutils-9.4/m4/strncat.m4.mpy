{
  "module_name": "strncat.m4",
  "hash_id": "463642e7249df8b956b66d4e46c96240fd1add34333758078e2ba2e5815b269f",
  "original_prompt": "Ingested from coreutils-9.4/m4/strncat.m4",
  "human_readable_source": "# strncat.m4 serial 8\ndnl Copyright (C) 2002-2004, 2009-2023 Free Software Foundation, Inc.\ndnl This file is free software; the Free Software Foundation\ndnl gives unlimited permission to copy and/or distribute it,\ndnl with or without modifications, as long as this notice is preserved.\n\nAC_DEFUN_ONCE([gl_FUNC_STRNCAT],\n[\n  AC_REQUIRE([gl_STRING_H_DEFAULTS])\n  AC_REQUIRE([AC_PROG_CC])\n  AC_REQUIRE([AC_CANONICAL_HOST]) dnl for cross-compiles\n\n  dnl Check for prerequisites for memory fence checks.\n  gl_FUNC_MMAP_ANON\n  AC_CHECK_HEADERS_ONCE([sys/mman.h])\n  AC_CHECK_FUNCS_ONCE([mprotect])\n\n  dnl Detect bug in Solaris 8..11.4 on SPARC and Solaris 11.0 on x86:\n  dnl strncat should not dereference more than n bytes, but always dereferences\n  dnl n+1 bytes if the first n bytes don't contain a NUL byte.\n  dnl Assume that strncat works on platforms that lack mprotect.\n  AC_CACHE_CHECK([whether strncat works], [gl_cv_func_strncat_works],\n    [AC_RUN_IFELSE([AC_LANG_PROGRAM([[\n#include <string.h>\n#if HAVE_SYS_MMAN_H\n# include <fcntl.h>\n# include <unistd.h>\n# include <sys/types.h>\n# include <sys/mman.h>\n# ifndef MAP_FILE\n#  define MAP_FILE 0\n# endif\n#endif\n]GL_MDA_DEFINES],\n[[\n  char *fence = NULL;\n#if HAVE_SYS_MMAN_H && HAVE_MPROTECT\n# if HAVE_MAP_ANONYMOUS\n  const int flags = MAP_ANONYMOUS | MAP_PRIVATE;\n  const int fd = -1;\n# else /* !HAVE_MAP_ANONYMOUS */\n  const int flags = MAP_FILE | MAP_PRIVATE;\n  int fd = open (\"/dev/zero\", O_RDONLY, 0666);\n  if (fd >= 0)\n# endif\n    {\n      int pagesize = getpagesize ();\n      char *two_pages =\n        (char *) mmap (NULL, 2 * pagesize, PROT_READ | PROT_WRITE,\n                       flags, fd, 0);\n      if (two_pages != (char *)(-1)\n          && mprotect (two_pages + pagesize, pagesize, PROT_NONE) == 0)\n        fence = two_pages + pagesize;\n    }\n#endif\n  if (fence)\n    {\n      char dest[8];\n\n      dest[0] = '*';\n      dest[1] = 'a';\n      dest[2] = '\\0';\n      dest[3] = 'w';\n      dest[4] = 'x';\n      dest[5] = 'y';\n      dest[6] = 'z';\n\n      *(fence - 3) = '7';\n      *(fence - 2) = '2';\n      *(fence - 1) = '9';\n\n      if (strncat (dest + 1, fence - 3, 3) != dest + 1)\n        return 1;\n      if (dest[0] != '*')\n        return 2;\n      if (dest[1] != 'a'\n          || dest[2] != '7' || dest[3] != '2' || dest[4] != '9'\n          || dest[5] != '\\0')\n        return 3;\n      if (dest[6] != 'z')\n        return 4;\n    }\n  return 0;\n]])], [gl_cv_func_strncat_works=yes], [gl_cv_func_strncat_works=no],\n       [\n        case \"$host_os\" in\n                             # Guess no on Solaris.\n          solaris*)          gl_cv_func_strncat_works=\"guessing no\" ;;\n                             # Guess yes on native Windows.\n          mingw* | windows*) gl_cv_func_strncat_works=\"guessing yes\" ;;\n                             # Guess yes otherwise.\n          *)                 gl_cv_func_strncat_works=\"guessing yes\" ;;\n        esac\n       ])\n    ])\n  case \"$gl_cv_func_strncat_works\" in\n    *yes) ;;\n    *) REPLACE_STRNCAT=1 ;;\n  esac\n])\n\n# Prerequisites of lib/strncat.c.\nAC_DEFUN([gl_PREREQ_STRNCAT], [\n  :\n])\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}