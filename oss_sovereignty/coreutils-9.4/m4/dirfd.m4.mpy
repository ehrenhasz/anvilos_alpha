{
  "module_name": "dirfd.m4",
  "hash_id": "81a9dab01740b171c1c994509daecf7071b4a6e412788e55f7b43e6555f785b4",
  "original_prompt": "Ingested from coreutils-9.4/m4/dirfd.m4",
  "human_readable_source": "# serial 28   -*- Autoconf -*-\n\ndnl Find out how to get the file descriptor associated with an open DIR*.\n\n# Copyright (C) 2001-2006, 2008-2023 Free Software Foundation, Inc.\n# This file is free software; the Free Software Foundation\n# gives unlimited permission to copy and/or distribute it,\n# with or without modifications, as long as this notice is preserved.\n\ndnl From Jim Meyering\n\nAC_DEFUN([gl_FUNC_DIRFD],\n[\n  AC_REQUIRE([gl_DIRENT_H_DEFAULTS])\n  AC_REQUIRE([AC_CANONICAL_HOST])\n\n  dnl Persuade glibc <dirent.h> to declare dirfd().\n  AC_REQUIRE([AC_USE_SYSTEM_EXTENSIONS])\n\n  AC_CHECK_FUNCS([dirfd])\n  AC_CHECK_DECLS([dirfd], , ,\n    [[#include <sys/types.h>\n      #include <dirent.h>]])\n  if test $ac_cv_have_decl_dirfd = no; then\n    HAVE_DECL_DIRFD=0\n  fi\n\n  AC_CACHE_CHECK([whether dirfd is a macro],\n    [gl_cv_func_dirfd_macro],\n    [AC_EGREP_CPP([dirent_header_defines_dirfd], [\n#include <sys/types.h>\n#include <dirent.h>\n#ifdef dirfd\n dirent_header_defines_dirfd\n#endif],\n       [gl_cv_func_dirfd_macro=yes],\n       [gl_cv_func_dirfd_macro=no])])\n\n  if test $ac_cv_func_dirfd = no && test $gl_cv_func_dirfd_macro = no; then\n    HAVE_DIRFD=0\n  else\n    HAVE_DIRFD=1\n    dnl Replace dirfd() on native Windows, to support fdopendir().\n    AC_REQUIRE([gl_DIRENT_DIR])\n    if test $DIR_HAS_FD_MEMBER = 0; then\n      REPLACE_DIRFD=1\n    fi\n    dnl OS/2 kLIBC dirfd() does not work.\n    case \"$host_os\" in\n      os2*) REPLACE_DIRFD=1 ;;\n    esac\n  fi\n])\n\ndnl Prerequisites of lib/dirfd.c.\nAC_DEFUN([gl_PREREQ_DIRFD],\n[\n  AC_CACHE_CHECK([how to get the file descriptor associated with an open DIR*],\n                 [gl_cv_sys_dir_fd_member_name],\n    [\n      dirfd_save_CFLAGS=$CFLAGS\n      for ac_expr in d_fd dd_fd; do\n\n        CFLAGS=\"$CFLAGS -DDIR_FD_MEMBER_NAME=$ac_expr\"\n        AC_COMPILE_IFELSE([AC_LANG_PROGRAM([[\n           #include <sys/types.h>\n           #include <dirent.h>]],\n          [[DIR *dir_p = opendir(\".\"); (void) dir_p->DIR_FD_MEMBER_NAME;]])],\n          [dir_fd_found=yes]\n        )\n        CFLAGS=$dirfd_save_CFLAGS\n        test \"$dir_fd_found\" = yes && break\n      done\n      test \"$dir_fd_found\" = yes || ac_expr=no_such_member\n\n      gl_cv_sys_dir_fd_member_name=$ac_expr\n    ]\n  )\n  if test $gl_cv_sys_dir_fd_member_name != no_such_member; then\n    AC_DEFINE_UNQUOTED([DIR_FD_MEMBER_NAME],\n      [$gl_cv_sys_dir_fd_member_name],\n      [the name of the file descriptor member of DIR])\n  fi\n  AH_VERBATIM([DIR_TO_FD],\n              [#ifdef DIR_FD_MEMBER_NAME\n# define DIR_TO_FD(Dir_p) ((Dir_p)->DIR_FD_MEMBER_NAME)\n#else\n# define DIR_TO_FD(Dir_p) -1\n#endif\n])\n])\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}