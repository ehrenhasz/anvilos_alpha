{
  "module_name": "canonicalize.m4",
  "hash_id": "d2734dfbd05a7422ca0ef8460c87aca54e985b84011bdaf879c6c00f7706d609",
  "original_prompt": "Ingested from coreutils-9.4/m4/canonicalize.m4",
  "human_readable_source": "# canonicalize.m4 serial 39\n\ndnl Copyright (C) 2003-2007, 2009-2023 Free Software Foundation, Inc.\n\ndnl This file is free software; the Free Software Foundation\ndnl gives unlimited permission to copy and/or distribute it,\ndnl with or without modifications, as long as this notice is preserved.\n\n# Provides canonicalize_file_name and canonicalize_filename_mode, but does\n# not provide or fix realpath.\nAC_DEFUN([gl_FUNC_CANONICALIZE_FILENAME_MODE],\n[\n  AC_REQUIRE([gl_USE_SYSTEM_EXTENSIONS])\n  AC_REQUIRE([gl_FUNC_LSTAT_FOLLOWS_SLASHED_SYMLINK])\n  AC_CHECK_FUNCS_ONCE([canonicalize_file_name])\n  gl_CHECK_FUNCS_ANDROID([faccessat], [[#include <unistd.h>]])\n  AC_REQUIRE([gl_DOUBLE_SLASH_ROOT])\n  AC_REQUIRE([gl_FUNC_REALPATH_WORKS])\n  if test $ac_cv_func_canonicalize_file_name = no; then\n    HAVE_CANONICALIZE_FILE_NAME=0\n  else\n    case \"$gl_cv_func_realpath_works\" in\n      *yes) ;;\n      *)    REPLACE_CANONICALIZE_FILE_NAME=1 ;;\n    esac\n  fi\n])\n\n# Provides canonicalize_file_name and realpath.\nAC_DEFUN([gl_CANONICALIZE_LGPL],\n[\n  AC_REQUIRE([gl_STDLIB_H_DEFAULTS])\n  AC_REQUIRE([gl_CANONICALIZE_LGPL_SEPARATE])\n  if test $ac_cv_func_canonicalize_file_name = no; then\n    HAVE_CANONICALIZE_FILE_NAME=0\n    if test $ac_cv_func_realpath = no; then\n      HAVE_REALPATH=0\n    else\n      case \"$gl_cv_func_realpath_works\" in\n        *yes) ;;\n        *)    REPLACE_REALPATH=1 ;;\n      esac\n    fi\n  else\n    case \"$gl_cv_func_realpath_works\" in\n      *yes)\n        ;;\n      *)\n        REPLACE_CANONICALIZE_FILE_NAME=1\n        REPLACE_REALPATH=1\n        ;;\n    esac\n  fi\n])\n\n# Like gl_CANONICALIZE_LGPL, except prepare for separate compilation\n# (no REPLACE_CANONICALIZE_FILE_NAME, no REPLACE_REALPATH, no AC_LIBOBJ).\nAC_DEFUN([gl_CANONICALIZE_LGPL_SEPARATE],\n[\n  AC_REQUIRE([gl_USE_SYSTEM_EXTENSIONS])\n  AC_REQUIRE([gl_FUNC_LSTAT_FOLLOWS_SLASHED_SYMLINK])\n  AC_CHECK_FUNCS_ONCE([canonicalize_file_name])\n  gl_CHECK_FUNCS_ANDROID([faccessat], [[#include <unistd.h>]])\n\n  dnl On native Windows, we use _getcwd(), regardless whether getcwd() is\n  dnl available through the linker option '-loldnames'.\n  AC_REQUIRE([AC_CANONICAL_HOST])\n  case \"$host_os\" in\n    mingw* | windows*) ;;\n    *) AC_CHECK_FUNCS([getcwd]) ;;\n  esac\n\n  AC_REQUIRE([gl_DOUBLE_SLASH_ROOT])\n  AC_REQUIRE([gl_FUNC_REALPATH_WORKS])\n  AC_CHECK_HEADERS_ONCE([sys/param.h])\n])\n\n# Check whether realpath works.  Assume that if a platform has both\n# realpath and canonicalize_file_name, but the former is broken, then\n# so is the latter.\nAC_DEFUN([gl_FUNC_REALPATH_WORKS],\n[\n  AC_CHECK_FUNCS_ONCE([realpath lstat])\n  AC_REQUIRE([AC_CANONICAL_HOST]) dnl for cross-compiles\n  AC_CACHE_CHECK([whether realpath works], [gl_cv_func_realpath_works], [\n    rm -rf conftest.a conftest.d\n    touch conftest.a\n    # Assume that if we have lstat, we can also check symlinks.\n    if test $ac_cv_func_lstat = yes; then\n      ln -s conftest.a conftest.l\n    fi\n    mkdir conftest.d\n    AC_RUN_IFELSE([\n      AC_LANG_PROGRAM([[\n        ]GL_NOCRASH[\n        #include <errno.h>\n        #include <stdlib.h>\n        #include <string.h>\n      ]], [[\n        int result = 0;\n        /* This test fails on Solaris 10.  */\n        {\n          char *name = realpath (\"conftest.a\", NULL);\n          if (!(name && *name == '/'))\n            result |= 1;\n          free (name);\n        }\n        /* This test fails on older versions of Cygwin.  */\n        {\n          char *name = realpath (\"conftest.b/../conftest.a\", NULL);\n          if (name != NULL)\n            result |= 2;\n          free (name);\n        }\n        /* This test fails on Cygwin 2.9.  */\n        #if HAVE_LSTAT\n        {\n          char *name = realpath (\"conftest.l/../conftest.a\", NULL);\n          if (name != NULL || errno != ENOTDIR)\n            result |= 4;\n          free (name);\n        }\n        #endif\n        /* This test fails on Mac OS X 10.13, OpenBSD 6.0.  */\n        {\n          char *name = realpath (\"conftest.a/\", NULL);\n          if (name != NULL)\n            result |= 8;\n          free (name);\n        }\n        /* This test fails on AIX 7, Solaris 10.  */\n        {\n          char *name1 = realpath (\".\", NULL);\n          char *name2 = realpath (\"conftest.d//./..\", NULL);\n          if (! name1 || ! name2 || strcmp (name1, name2))\n            result |= 16;\n          free (name1);\n          free (name2);\n        }\n        #ifdef __linux__\n        /* On Linux, // is the same as /. See also double-slash-root.m4.\n           realpath() should respect this.\n           This test fails on musl libc 1.2.2.  */\n        {\n          char *name = realpath (\"//\", NULL);\n          if (! name || strcmp (name, \"/\"))\n            result |= 32;\n          free (name);\n        }\n        #endif\n        return result;\n      ]])\n     ],\n     [gl_cv_func_realpath_works=yes],\n     [case $? in\n        32) gl_cv_func_realpath_works=nearly ;;\n        *)  gl_cv_func_realpath_works=no ;;\n      esac\n     ],\n     [case \"$host_os\" in\n                           # Guess yes on glibc systems.\n        *-gnu* | gnu*)     gl_cv_func_realpath_works=\"guessing yes\" ;;\n                           # Guess 'nearly' on musl systems.\n        *-musl*)           gl_cv_func_realpath_works=\"guessing nearly\" ;;\n                           # Guess no on Cygwin.\n        cygwin*)           gl_cv_func_realpath_works=\"guessing no\" ;;\n                           # Guess no on native Windows.\n        mingw* | windows*) gl_cv_func_realpath_works=\"guessing no\" ;;\n                           # If we don't know, obey --enable-cross-guesses.\n        *)                 gl_cv_func_realpath_works=\"$gl_cross_guess_normal\" ;;\n      esac\n     ])\n    rm -rf conftest.a conftest.l conftest.d\n  ])\n  case \"$gl_cv_func_realpath_works\" in\n    *yes)\n      AC_DEFINE([FUNC_REALPATH_WORKS], [1],\n        [Define to 1 if realpath() can malloc memory, always gives an absolute path, and handles leading slashes and a trailing slash correctly.])\n      ;;\n    *nearly)\n      AC_DEFINE([FUNC_REALPATH_NEARLY_WORKS], [1],\n        [Define to 1 if realpath() can malloc memory, always gives an absolute path, and handles a trailing slash correctly.])\n      ;;\n  esac\n])\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}