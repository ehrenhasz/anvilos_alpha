{
  "module_name": "locale-zh.m4",
  "hash_id": "b9b3e0d90bc1af86dfb0d24383b25ccb2467b82f47af56809d2811c7f159f8e4",
  "original_prompt": "Ingested from coreutils-9.4/m4/locale-zh.m4",
  "human_readable_source": "# locale-zh.m4 serial 18\ndnl Copyright (C) 2003, 2005-2023 Free Software Foundation, Inc.\ndnl This file is free software; the Free Software Foundation\ndnl gives unlimited permission to copy and/or distribute it,\ndnl with or without modifications, as long as this notice is preserved.\n\ndnl From Bruno Haible.\n\ndnl Determine the name of a chinese locale with GB18030 encoding.\nAC_DEFUN_ONCE([gt_LOCALE_ZH_CN],\n[\n  AC_REQUIRE([AC_CANONICAL_HOST])\n  AC_REQUIRE([AM_LANGINFO_CODESET])\n  AC_CACHE_CHECK([for a transitional chinese locale], [gt_cv_locale_zh_CN], [\n    AC_LANG_CONFTEST([AC_LANG_SOURCE([[\n#include <locale.h>\n#include <stdlib.h>\n#include <time.h>\n#if HAVE_LANGINFO_CODESET\n# include <langinfo.h>\n#endif\n#include <stdlib.h>\n#include <string.h>\nstruct tm t;\nchar buf[16];\nint main ()\n{\n  /* On BeOS and Haiku, locales are not implemented in libc.  Rather, libintl\n     imitates locale dependent behaviour by looking at the environment\n     variables, and all locales use the UTF-8 encoding.  */\n#if defined __BEOS__ || defined __HAIKU__\n  return 1;\n#else\n  /* Check whether the given locale name is recognized by the system.  */\n# if defined _WIN32 && !defined __CYGWIN__\n  /* On native Windows, setlocale(category, \"\") looks at the system settings,\n     not at the environment variables.  Also, when an encoding suffix such\n     as \".65001\" or \".54936\" is specified, it succeeds but sets the LC_CTYPE\n     category of the locale to \"C\".  */\n  if (setlocale (LC_ALL, getenv (\"LC_ALL\")) == NULL\n      || strcmp (setlocale (LC_CTYPE, NULL), \"C\") == 0)\n    return 1;\n# else\n  if (setlocale (LC_ALL, \"\") == NULL) return 1;\n# endif\n  /* Check whether nl_langinfo(CODESET) is nonempty and not \"ASCII\" or \"646\".\n     On Mac OS X 10.3.5 (Darwin 7.5) in the fr_FR locale, nl_langinfo(CODESET)\n     is empty, and the behaviour of Tcl 8.4 in this locale is not useful.\n     On OpenBSD 4.0, when an unsupported locale is specified, setlocale()\n     succeeds but then nl_langinfo(CODESET) is \"646\". In this situation,\n     some unit tests fail.\n     On MirBSD 10, when an unsupported locale is specified, setlocale()\n     succeeds but then nl_langinfo(CODESET) is \"UTF-8\".  */\n# if HAVE_LANGINFO_CODESET\n  {\n    const char *cs = nl_langinfo (CODESET);\n    if (cs[0] == '\\0' || strcmp (cs, \"ASCII\") == 0 || strcmp (cs, \"646\") == 0\n        || strcmp (cs, \"UTF-8\") == 0)\n      return 1;\n  }\n# endif\n# ifdef __CYGWIN__\n  /* On Cygwin, avoid locale names without encoding suffix, because the\n     locale_charset() function relies on the encoding suffix.  Note that\n     LC_ALL is set on the command line.  */\n  if (strchr (getenv (\"LC_ALL\"), '.') == NULL) return 1;\n# endif\n  /* Check whether in a month name, no byte in the range 0x80..0x9F occurs.\n     This excludes the UTF-8 encoding (except on MirBSD).  */\n  {\n    const char *p;\n    t.tm_year = 1975 - 1900; t.tm_mon = 2 - 1; t.tm_mday = 4;\n    if (strftime (buf, sizeof (buf), \"%B\", &t) < 2) return 1;\n    for (p = buf; *p != '\\0'; p++)\n      if ((unsigned char) *p >= 0x80 && (unsigned char) *p < 0xa0)\n        return 1;\n  }\n  /* Check whether a typical GB18030 multibyte sequence is recognized as a\n     single wide character.  This excludes the GB2312 and GBK encodings.  */\n  if (mblen (\"\\203\\062\\332\\066\", 5) != 4)\n    return 1;\n  return 0;\n#endif\n}\n      ]])])\n    if AC_TRY_EVAL([ac_link]) && test -s conftest$ac_exeext; then\n      case \"$host_os\" in\n        # Handle native Windows specially, because there setlocale() interprets\n        # \"ar\" as \"Arabic\" or \"Arabic_Saudi Arabia.1256\",\n        # \"fr\" or \"fra\" as \"French\" or \"French_France.1252\",\n        # \"ge\"(!) or \"deu\"(!) as \"German\" or \"German_Germany.1252\",\n        # \"ja\" as \"Japanese\" or \"Japanese_Japan.932\",\n        # and similar.\n        mingw* | windows*)\n          # Test for the hypothetical native Windows locale name.\n          if (LC_ALL=Chinese_China.54936 LC_TIME= LC_CTYPE= ./conftest; exit) 2>/dev/null; then\n            gt_cv_locale_zh_CN=Chinese_China.54936\n          else\n            # None found.\n            gt_cv_locale_zh_CN=none\n          fi\n          ;;\n        solaris2.8)\n          # On Solaris 8, the locales zh_CN.GB18030, zh_CN.GBK, zh.GBK are\n          # broken. One witness is the test case in gl_MBRTOWC_SANITYCHECK.\n          # Another witness is that \"LC_ALL=zh_CN.GB18030 bash -c true\" dumps core.\n          gt_cv_locale_zh_CN=none\n          ;;\n        *)\n          # Setting LC_ALL is not enough. Need to set LC_TIME to empty, because\n          # otherwise on Mac OS X 10.3.5 the LC_TIME=C from the beginning of the\n          # configure script would override the LC_ALL setting. Likewise for\n          # LC_CTYPE, which is also set at the beginning of the configure script.\n          # Test for the locale name without encoding suffix.\n          if (LC_ALL=zh_CN LC_TIME= LC_CTYPE= ./conftest; exit) 2>/dev/null; then\n            gt_cv_locale_zh_CN=zh_CN\n          else\n            # Test for the locale name with explicit encoding suffix.\n            if (LC_ALL=zh_CN.GB18030 LC_TIME= LC_CTYPE= ./conftest; exit) 2>/dev/null; then\n              gt_cv_locale_zh_CN=zh_CN.GB18030\n            else\n              # None found.\n              gt_cv_locale_zh_CN=none\n            fi\n          fi\n          ;;\n      esac\n    else\n      # If there was a link error, due to mblen(), the system is so old that\n      # it certainly doesn't have a chinese locale.\n      gt_cv_locale_zh_CN=none\n    fi\n    rm -fr conftest*\n  ])\n  LOCALE_ZH_CN=$gt_cv_locale_zh_CN\n  case $LOCALE_ZH_CN in #(\n    '' | *[[[:space:]\\\"\\$\\'*@<:@]]*)\n      dnl This locale name might cause trouble with sh or make.\n      AC_MSG_WARN([invalid locale \"$LOCALE_ZH_CN\"; assuming \"none\"])\n      LOCALE_ZH_CN=none;;\n  esac\n  AC_SUBST([LOCALE_ZH_CN])\n])\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}