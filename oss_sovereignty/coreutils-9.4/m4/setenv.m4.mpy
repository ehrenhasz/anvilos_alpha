{
  "module_name": "setenv.m4",
  "hash_id": "1e25e1c85e70e97c6a86cc2e138ee1ce055ee37b1a665596340f6036738cabd4",
  "original_prompt": "Ingested from coreutils-9.4/m4/setenv.m4",
  "human_readable_source": "# setenv.m4 serial 33\ndnl Copyright (C) 2001-2004, 2006-2023 Free Software Foundation, Inc.\ndnl This file is free software; the Free Software Foundation\ndnl gives unlimited permission to copy and/or distribute it,\ndnl with or without modifications, as long as this notice is preserved.\n\nAC_DEFUN([gl_FUNC_SETENV],\n[\n  AC_REQUIRE([gl_FUNC_SETENV_SEPARATE])\n  AC_REQUIRE([AC_CANONICAL_HOST]) dnl for cross-compiles\n  if test $ac_cv_func_setenv = no; then\n    HAVE_SETENV=0\n  else\n    AC_CACHE_CHECK([whether setenv validates arguments],\n      [gl_cv_func_setenv_works],\n      [AC_RUN_IFELSE([AC_LANG_PROGRAM([[\n       #include <stdlib.h>\n       #include <errno.h>\n       #include <string.h>\n      ]], [[\n       int result = 0;\n       {\n         if (setenv (\"\", \"\", 0) != -1)\n           result |= 1;\n         else if (errno != EINVAL)\n           result |= 2;\n       }\n       {\n         if (setenv (\"a\", \"=\", 1) != 0)\n           result |= 4;\n         else if (strcmp (getenv (\"a\"), \"=\") != 0)\n           result |= 8;\n       }\n       return result;\n      ]])],\n      [gl_cv_func_setenv_works=yes], [gl_cv_func_setenv_works=no],\n      [case \"$host_os\" in\n                             # Guess yes on glibc systems.\n         *-gnu* | gnu*)      gl_cv_func_setenv_works=\"guessing yes\" ;;\n                             # Guess yes on musl systems.\n         *-musl* | midipix*) gl_cv_func_setenv_works=\"guessing yes\" ;;\n                             # If we don't know, obey --enable-cross-guesses.\n         *)                  gl_cv_func_setenv_works=\"$gl_cross_guess_normal\" ;;\n       esac\n      ])])\n    case \"$gl_cv_func_setenv_works\" in\n      *yes) ;;\n      *)\n        REPLACE_SETENV=1\n        ;;\n    esac\n  fi\n])\n\n# Like gl_FUNC_SETENV, except prepare for separate compilation\n# (no REPLACE_SETENV, no AC_LIBOBJ).\nAC_DEFUN([gl_FUNC_SETENV_SEPARATE],\n[\n  AC_REQUIRE([gl_STDLIB_H_DEFAULTS])\n  AC_CHECK_DECLS_ONCE([setenv])\n  if test $ac_cv_have_decl_setenv = no; then\n    HAVE_DECL_SETENV=0\n  fi\n  AC_CHECK_FUNCS_ONCE([setenv])\n  gl_PREREQ_SETENV\n])\n\nAC_DEFUN([gl_FUNC_UNSETENV],\n[\n  AC_REQUIRE([gl_STDLIB_H_DEFAULTS])\n  AC_REQUIRE([AC_CANONICAL_HOST]) dnl for cross-compiles\n  AC_CHECK_DECLS_ONCE([unsetenv])\n  if test $ac_cv_have_decl_unsetenv = no; then\n    HAVE_DECL_UNSETENV=0\n  fi\n  AC_CHECK_FUNCS([unsetenv])\n  if test $ac_cv_func_unsetenv = no; then\n    HAVE_UNSETENV=0\n  else\n    HAVE_UNSETENV=1\n    dnl Some BSDs return void, failing to do error checking.\n    AC_CACHE_CHECK([for unsetenv() return type], [gt_cv_func_unsetenv_ret],\n      [AC_COMPILE_IFELSE(\n         [AC_LANG_PROGRAM(\n            [[\n#undef _BSD\n#define _BSD 1 /* unhide unsetenv declaration in OSF/1 5.1 <stdlib.h> */\n#include <stdlib.h>\nextern\n#ifdef __cplusplus\n\"C\"\n#endif\nint unsetenv (const char *name);\n            ]],\n            [[]])],\n         [gt_cv_func_unsetenv_ret='int'],\n         [gt_cv_func_unsetenv_ret='void'])])\n    if test $gt_cv_func_unsetenv_ret = 'void'; then\n      AC_DEFINE([VOID_UNSETENV], [1], [Define to 1 if unsetenv returns void\n       instead of int.])\n      REPLACE_UNSETENV=1\n    fi\n\n    dnl Solaris 10 unsetenv does not remove all copies of a name.\n    dnl Haiku alpha 2 unsetenv gets confused by assignment to environ.\n    dnl OpenBSD 4.7 unsetenv(\"\") does not fail.\n    AC_CACHE_CHECK([whether unsetenv obeys POSIX],\n      [gl_cv_func_unsetenv_works],\n      [AC_RUN_IFELSE(\n         [AC_LANG_PROGRAM([[\n            #include <stdlib.h>\n            #include <errno.h>\n            extern char **environ;\n           ]GL_MDA_DEFINES],\n           [[\n            char entry1[] = \"a=1\";\n            char entry2[] = \"b=2\";\n            char *env[] = { entry1, entry2, NULL };\n            if (putenv ((char *) \"a=1\")) return 1;\n            if (putenv (entry2)) return 2;\n            entry2[0] = 'a';\n            unsetenv (\"a\");\n            if (getenv (\"a\")) return 3;\n            if (!unsetenv (\"\") || errno != EINVAL) return 4;\n            entry2[0] = 'b';\n            environ = env;\n            if (!getenv (\"a\")) return 5;\n            entry2[0] = 'a';\n            unsetenv (\"a\");\n            if (getenv (\"a\")) return 6;\n           ]])],\n         [gl_cv_func_unsetenv_works=yes],\n         [gl_cv_func_unsetenv_works=no],\n         [case \"$host_os\" in\n                    # Guess yes on glibc systems.\n            *-gnu*) gl_cv_func_unsetenv_works=\"guessing yes\" ;;\n                    # If we don't know, obey --enable-cross-guesses.\n            *)      gl_cv_func_unsetenv_works=\"$gl_cross_guess_normal\" ;;\n          esac\n         ])\n      ])\n    case \"$gl_cv_func_unsetenv_works\" in\n      *yes) ;;\n      *)\n        REPLACE_UNSETENV=1\n        ;;\n    esac\n  fi\n])\n\n# Prerequisites of lib/setenv.c.\nAC_DEFUN([gl_PREREQ_SETENV],\n[\n  AC_REQUIRE([gl_ENVIRON])\n  AC_CHECK_HEADERS_ONCE([unistd.h])\n  AC_CHECK_HEADERS([search.h])\n  gl_CHECK_FUNCS_ANDROID([tsearch], [[#include <search.h>]])\n])\n\n# Prerequisites of lib/unsetenv.c.\nAC_DEFUN([gl_PREREQ_UNSETENV],\n[\n  AC_REQUIRE([gl_ENVIRON])\n  AC_CHECK_HEADERS_ONCE([unistd.h])\n])\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}