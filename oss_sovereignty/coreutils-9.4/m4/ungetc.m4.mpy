{
  "module_name": "ungetc.m4",
  "hash_id": "1a627f64c2b69e411980b257d208e1a00399e66a971dd52f0b3c03427cbbf9c5",
  "original_prompt": "Ingested from coreutils-9.4/m4/ungetc.m4",
  "human_readable_source": "# ungetc.m4 serial 12\ndnl Copyright (C) 2009-2023 Free Software Foundation, Inc.\ndnl This file is free software; the Free Software Foundation\ndnl gives unlimited permission to copy and/or distribute it,\ndnl with or without modifications, as long as this notice is preserved.\n\nAC_DEFUN_ONCE([gl_FUNC_UNGETC_WORKS],\n[\n  AC_REQUIRE([AC_PROG_CC])\n  AC_REQUIRE([AC_CANONICAL_HOST]) dnl for cross-compiles\n\n  AC_CACHE_CHECK([whether ungetc works on arbitrary bytes],\n    [gl_cv_func_ungetc_works],\n    [AC_RUN_IFELSE([AC_LANG_PROGRAM([[\n#include <stdio.h>\n      ]], [[FILE *f;\n            if (!(f = fopen (\"conftest.tmp\", \"w+\")))\n              return 1;\n            if (fputs (\"abc\", f) < 0)\n              { fclose (f); return 2; }\n            rewind (f);\n            if (fgetc (f) != 'a')\n              { fclose (f); return 3; }\n            if (fgetc (f) != 'b')\n              { fclose (f); return 4; }\n            if (ungetc ('d', f) != 'd')\n              { fclose (f); return 5; }\n            if (ftell (f) != 1)\n              { fclose (f); return 6; }\n            if (fgetc (f) != 'd')\n              { fclose (f); return 7; }\n            if (ftell (f) != 2)\n              { fclose (f); return 8; }\n            if (fseek (f, 0, SEEK_CUR) != 0)\n              { fclose (f); return 9; }\n            if (ftell (f) != 2)\n              { fclose (f); return 10; }\n            if (fgetc (f) != 'c')\n              { fclose (f); return 11; }\n            fclose (f);\n            remove (\"conftest.tmp\");\n          ]])],\n        [gl_cv_func_ungetc_works=yes], [gl_cv_func_ungetc_works=no],\n        [case \"$host_os\" in\n                               # Guess yes on glibc systems.\n           *-gnu* | gnu*)      gl_cv_func_ungetc_works=\"guessing yes\" ;;\n                               # Guess yes on musl systems.\n           *-musl* | midipix*) gl_cv_func_ungetc_works=\"guessing yes\" ;;\n                               # Guess yes on bionic systems.\n           *-android*)         gl_cv_func_ungetc_works=\"guessing yes\" ;;\n                               # Guess yes on native Windows.\n           mingw* | windows*)  gl_cv_func_ungetc_works=\"guessing yes\" ;;\n                               # If we don't know, obey --enable-cross-guesses.\n           *)                  gl_cv_func_ungetc_works=\"$gl_cross_guess_normal\" ;;\n         esac\n        ])\n    ])\n  gl_ftello_broken_after_ungetc=no\n  case \"$gl_cv_func_ungetc_works\" in\n    *yes) ;;\n    *)\n      dnl On macOS >= 10.15, where the above program fails with exit code 6,\n      dnl we fix it through an ftello override.\n      case \"$host_os\" in\n        darwin*) gl_ftello_broken_after_ungetc=yes ;;\n        *)\n          AC_DEFINE([FUNC_UNGETC_BROKEN], [1],\n            [Define to 1 if ungetc is broken when used on arbitrary bytes.])\n          ;;\n      esac\n      ;;\n  esac\n])\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}