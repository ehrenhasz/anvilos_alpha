{
  "module_name": "mountlist.m4",
  "hash_id": "665ff20ba68ba1d6539a42bdc3c3a5247ba0b22f484e66c2714f7bd2e7214efe",
  "original_prompt": "Ingested from coreutils-9.4/m4/mountlist.m4",
  "human_readable_source": "# serial 17\ndnl Copyright (C) 2002-2006, 2009-2023 Free Software Foundation, Inc.\ndnl This file is free software; the Free Software Foundation\ndnl gives unlimited permission to copy and/or distribute it,\ndnl with or without modifications, as long as this notice is preserved.\n\ndnl From Jim Meyering.\n\nAC_PREREQ([2.60])\n\nAC_DEFUN([gl_MOUNTLIST],\n[\n  AC_REQUIRE([AC_CANONICAL_HOST])\n  AC_CHECK_FUNCS([listmntent])\n  AC_CHECK_HEADERS_ONCE([sys/param.h sys/statvfs.h])\n\n  # We must include grp.h before ucred.h on OSF V4.0, since ucred.h uses\n  # NGROUPS (as the array dimension for a struct member) without a definition.\n  AC_CHECK_HEADERS([sys/ucred.h], [], [], [#include <grp.h>])\n\n  AC_CHECK_HEADERS([sys/mount.h], [], [],\n    [AC_INCLUDES_DEFAULT\n     [#if HAVE_SYS_PARAM_H\n       #include <sys/param.h>\n      #endif\n    ]])\n\n  AC_CHECK_HEADERS([mntent.h sys/fs_types.h])\n  getfsstat_includes=\"\\\n$ac_includes_default\n#if HAVE_SYS_PARAM_H\n# include <sys/param.h> /* needed by powerpc-apple-darwin1.3.7 */\n#endif\n#if HAVE_SYS_UCRED_H\n# include <grp.h> /* needed for definition of NGROUPS */\n# include <sys/ucred.h> /* needed by powerpc-apple-darwin1.3.7 */\n#endif\n#if HAVE_SYS_MOUNT_H\n# include <sys/mount.h>\n#endif\n#if HAVE_SYS_FS_TYPES_H\n# include <sys/fs_types.h> /* needed by powerpc-apple-darwin1.3.7 */\n#endif\n\"\n  AC_CHECK_MEMBERS([struct fsstat.f_fstypename],,,[$getfsstat_includes])\n\n  # Determine how to get the list of mounted file systems.\n  ac_list_mounted_fs=\n\n  # If the getmntent function is available but not in the standard library,\n  # make sure LIBS contains the appropriate -l option.\n  AC_FUNC_GETMNTENT\n\n  if test -z \"$ac_list_mounted_fs\"; then\n    # AIX.\n    AC_CACHE_CHECK([for mntctl function and struct vmount],\n      [fu_cv_sys_mounted_vmount],\n      [AC_PREPROC_IFELSE([AC_LANG_SOURCE([[#include <fshelp.h>]])],\n         [fu_cv_sys_mounted_vmount=yes],\n         [fu_cv_sys_mounted_vmount=no])])\n    if test $fu_cv_sys_mounted_vmount = yes; then\n      ac_list_mounted_fs=found\n      AC_DEFINE([MOUNTED_VMOUNT], [1],\n        [Define if there is a function named mntctl that can be used to read\n         the list of mounted file systems, and there is a system header file\n         that declares 'struct vmount'.  (AIX)])\n    fi\n  fi\n\n  if test $ac_cv_func_getmntent = yes; then\n\n    # This system has the getmntent function.\n    # Determine whether it's the one-argument variant or the two-argument one.\n\n    if test -z \"$ac_list_mounted_fs\"; then\n      # glibc, HP-UX, IRIX, Cygwin, Android, also (obsolete) 4.3BSD, SunOS.\n      AC_CACHE_CHECK([for one-argument getmntent function],\n        [fu_cv_sys_mounted_getmntent1],\n        [AC_COMPILE_IFELSE(\n           [AC_LANG_PROGRAM([[\n/* SunOS 4.1.x /usr/include/mntent.h needs this for FILE */\n#include <stdio.h>\n\n#include <mntent.h>\n#if defined __ANDROID__        /* Android */\n# undef MOUNTED\n# define MOUNTED \"/proc/mounts\"\n#elif !defined MOUNTED\n# if defined _PATH_MOUNTED     /* GNU libc  */\n#  define MOUNTED _PATH_MOUNTED\n# endif\n# if defined MNT_MNTTAB        /* HP-UX.  */\n#  define MOUNTED MNT_MNTTAB\n# endif\n#endif\n]],\n              [[struct mntent *mnt = 0; char *table = MOUNTED;\n                if (sizeof mnt && sizeof table) return 0;\n              ]])],\n           [fu_cv_sys_mounted_getmntent1=yes],\n           [fu_cv_sys_mounted_getmntent1=no])\n        ])\n      if test $fu_cv_sys_mounted_getmntent1 = yes; then\n        ac_list_mounted_fs=found\n        AC_DEFINE([MOUNTED_GETMNTENT1], [1],\n          [Define if there is a function named getmntent for reading the list\n           of mounted file systems, and that function takes a single argument.\n           (4.3BSD, SunOS, HP-UX, Irix)])\n        gl_CHECK_FUNCS_ANDROID([setmntent],\n          [[#include <stdio.h>\n            #include <mntent.h>\n          ]])\n        gl_CHECK_FUNCS_ANDROID([endmntent],\n          [[#include <stdio.h>\n            #include <mntent.h>\n          ]])\n        gl_CHECK_FUNCS_ANDROID([hasmntopt],\n          [[#include <stdio.h>\n            #include <mntent.h>\n          ]])\n      fi\n    fi\n\n    if test -z \"$ac_list_mounted_fs\"; then\n      # Solaris >= 8.\n      AC_CACHE_CHECK([for getextmntent function],\n        [fu_cv_sys_mounted_getextmntent],\n        [AC_EGREP_HEADER([getextmntent], [sys/mnttab.h],\n           [fu_cv_sys_mounted_getextmntent=yes],\n           [fu_cv_sys_mounted_getextmntent=no])])\n      if test $fu_cv_sys_mounted_getextmntent = yes; then\n        ac_list_mounted_fs=found\n        AC_DEFINE([MOUNTED_GETEXTMNTENT], [1],\n          [Define if there is a function named getextmntent for reading the list\n           of mounted file systems.  (Solaris)])\n      fi\n    fi\n\n    if test -z \"$ac_list_mounted_fs\"; then\n      # Solaris < 8, also (obsolete) SVR4.\n      # Solaris >= 8 has the two-argument getmntent but is already handled above.\n      AC_CACHE_CHECK([for two-argument getmntent function],\n        [fu_cv_sys_mounted_getmntent2],\n        [AC_EGREP_HEADER([getmntent], [sys/mnttab.h],\n           [fu_cv_sys_mounted_getmntent2=yes],\n           [fu_cv_sys_mounted_getmntent2=no])\n        ])\n      if test $fu_cv_sys_mounted_getmntent2 = yes; then\n        ac_list_mounted_fs=found\n        AC_DEFINE([MOUNTED_GETMNTENT2], [1],\n          [Define if there is a function named getmntent for reading the list of\n           mounted file systems, and that function takes two arguments.  (SVR4)])\n        AC_CHECK_FUNCS([hasmntopt])\n      fi\n    fi\n\n  fi\n\n  if test -z \"$ac_list_mounted_fs\"; then\n    # OSF/1, also (obsolete) Apple Darwin 1.3.\n    # powerpc-apple-darwin1.3.7 needs sys/param.h sys/ucred.h sys/fs_types.h\n\n    AC_CACHE_CHECK([for getfsstat function],\n      [fu_cv_sys_mounted_getfsstat],\n      [AC_LINK_IFELSE(\n         [AC_LANG_PROGRAM([[\n#include <sys/types.h>\n#if HAVE_STRUCT_FSSTAT_F_FSTYPENAME\n# define FS_TYPE(Ent) ((Ent).f_fstypename)\n#else\n# define FS_TYPE(Ent) mnt_names[(Ent).f_type]\n#endif\n$getfsstat_includes\n            ]],\n            [[struct statfs *stats;\n              int numsys = getfsstat ((struct statfs *)0, 0L, MNT_WAIT);\n              char *t = FS_TYPE (*stats);\n            ]])],\n         [fu_cv_sys_mounted_getfsstat=yes],\n         [fu_cv_sys_mounted_getfsstat=no])\n      ])\n    if test $fu_cv_sys_mounted_getfsstat = yes; then\n      ac_list_mounted_fs=found\n      AC_DEFINE([MOUNTED_GETFSSTAT], [1],\n        [Define if there is a function named getfsstat for reading the\n         list of mounted file systems.  (DEC Alpha running OSF/1)])\n    fi\n  fi\n\n  if test -z \"$ac_list_mounted_fs\"; then\n    # (obsolete) SVR3\n    AC_CACHE_CHECK([for FIXME existence of three headers],\n      [fu_cv_sys_mounted_fread_fstyp],\n      [AC_PREPROC_IFELSE([AC_LANG_SOURCE([[\n#include <sys/statfs.h>\n#include <sys/fstyp.h>\n#include <mnttab.h>\n]])],\n         [fu_cv_sys_mounted_fread_fstyp=yes],\n         [fu_cv_sys_mounted_fread_fstyp=no])\n      ])\n    if test $fu_cv_sys_mounted_fread_fstyp = yes; then\n      ac_list_mounted_fs=found\n      AC_DEFINE([MOUNTED_FREAD_FSTYP], [1],\n        [Define if (like SVR2) there is no specific function for reading the\n         list of mounted file systems, and your system has these header files:\n         <sys/fstyp.h> and <sys/statfs.h>.  (SVR3)])\n    fi\n  fi\n\n  if test -z \"$ac_list_mounted_fs\"; then\n    # Mac OS X, FreeBSD, NetBSD, OpenBSD, Minix, also (obsolete) 4.4BSD.\n    # OSF/1 also has getmntinfo but is already handled above.\n    # We cannot use AC_CHECK_FUNCS([getmntinfo]) here, because at the linker\n    # level the function is sometimes called getmntinfo64 or getmntinfo$INODE64\n    # on Mac OS X, __getmntinfo13 on NetBSD and Minix, _F64_getmntinfo on OSF/1.\n    AC_CACHE_CHECK([for getmntinfo function],\n      [fu_cv_sys_mounted_getmntinfo],\n      [AC_LINK_IFELSE(\n         [AC_LANG_PROGRAM([[\n#if HAVE_SYS_PARAM_H\n# include <sys/param.h>\n#endif\n#include <sys/types.h>\n#if HAVE_SYS_MOUNT_H\n# include <sys/mount.h>\n#endif\n#if HAVE_SYS_STATVFS_H\n# include <sys/statvfs.h>\n#endif\n#include <stdlib.h>\n            ]],\n            [[int count = getmntinfo (NULL, MNT_WAIT);\n            ]])],\n         [fu_cv_sys_mounted_getmntinfo=yes],\n         [fu_cv_sys_mounted_getmntinfo=no])\n      ])\n    if test $fu_cv_sys_mounted_getmntinfo = yes; then\n      AC_CACHE_CHECK([whether getmntinfo returns statvfs structures],\n        [fu_cv_sys_mounted_getmntinfo2],\n        [AC_COMPILE_IFELSE(\n           [AC_LANG_PROGRAM([[\n#if HAVE_SYS_PARAM_H\n# include <sys/param.h>\n#endif\n#include <sys/types.h>\n#if HAVE_SYS_MOUNT_H\n# include <sys/mount.h>\n#endif\n#if HAVE_SYS_STATVFS_H\n# include <sys/statvfs.h>\n#endif\nextern\n#ifdef __cplusplus\n\"C\"\n#endif\nint getmntinfo (struct statfs **, int);\n              ]], [[]])],\n           [fu_cv_sys_mounted_getmntinfo2=no],\n           [fu_cv_sys_mounted_getmntinfo2=yes])\n        ])\n      if test $fu_cv_sys_mounted_getmntinfo2 = no; then\n        # Mac OS X, FreeBSD, OpenBSD, also (obsolete) 4.4BSD.\n        ac_list_mounted_fs=found\n        AC_DEFINE([MOUNTED_GETMNTINFO], [1],\n          [Define if there is a function named getmntinfo for reading the\n           list of mounted file systems and it returns an array of\n           'struct statfs'.  (4.4BSD, Darwin)])\n      else\n        # NetBSD, Minix.\n        ac_list_mounted_fs=found\n        AC_DEFINE([MOUNTED_GETMNTINFO2], [1],\n          [Define if there is a function named getmntinfo for reading the\n           list of mounted file systems and it returns an array of\n           'struct statvfs'.  (NetBSD 3.0)])\n      fi\n    fi\n  fi\n\n  if test -z \"$ac_list_mounted_fs\"; then\n    # Haiku, also (obsolete) BeOS.\n    AC_CHECK_FUNCS([next_dev fs_stat_dev])\n    AC_CHECK_HEADERS([fs_info.h])\n    AC_CACHE_CHECK([for BEOS mounted file system support functions],\n      [fu_cv_sys_mounted_fs_stat_dev],\n      [if test $ac_cv_header_fs_info_h = yes \\\n          && test $ac_cv_func_next_dev = yes \\\n          && test $ac_cv_func_fs_stat_dev = yes; then\n         fu_cv_sys_mounted_fs_stat_dev=yes\n       else\n         fu_cv_sys_mounted_fs_stat_dev=no\n       fi\n      ])\n    if test $fu_cv_sys_mounted_fs_stat_dev = yes; then\n      ac_list_mounted_fs=found\n      AC_DEFINE([MOUNTED_FS_STAT_DEV], [1],\n        [Define if there are functions named next_dev and fs_stat_dev for\n         reading the list of mounted file systems.  (BeOS)])\n    fi\n  fi\n\n  if test -z \"$ac_list_mounted_fs\"; then\n    # Interix / BSD alike statvfs\n    # the code is really interix specific, so make sure, we're on it.\n    case \"$host\" in\n      *-interix*)\n        AC_CHECK_FUNCS([statvfs])\n        if test $ac_cv_func_statvfs = yes; then\n          ac_list_mounted_fs=found\n          AC_DEFINE([MOUNTED_INTERIX_STATVFS], [1],\n            [Define if we are on interix, and ought to use statvfs plus\n             some special knowledge on where mounted file systems can be\n             found. (Interix)])\n        fi\n        ;;\n    esac\n  fi\n\n  if test -z \"$ac_list_mounted_fs\"; then\n    AC_MSG_ERROR([could not determine how to read list of mounted file systems])\n    # FIXME -- no need to abort building the whole package\n    # Can't build mountlist.c or anything that needs its functions\n  fi\n\n  if test $ac_list_mounted_fs = found; then\n    gl_cv_list_mounted_fs=yes\n  else\n    gl_cv_list_mounted_fs=no\n  fi\n])\n\n# Prerequisites of lib/mountlist.c not done by gl_MOUNTLIST.\nAC_DEFUN([gl_PREREQ_MOUNTLIST_EXTRA],\n[\n  dnl Note gl_MOUNTLIST checks for mntent.h, not sys/mntent.h.\n  AC_CHECK_HEADERS([sys/mntent.h])\n  AC_HEADER_MAJOR()dnl for use of makedev ()\n  gl_FSTYPENAME\n])\n\n# Replace Autoconf's AC_FUNC_GETMNTENT to omit checks that are unnecessary\n# nowadays.\nAC_DEFUN([AC_FUNC_GETMNTENT],\n[\n  # getmntent is in the standard C library on most systems, but in -lgen on\n  # Unixware.\n  AC_SEARCH_LIBS([getmntent], [gen])\n  AC_CHECK_FUNCS([getmntent])\n])\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}