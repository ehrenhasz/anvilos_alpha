{
  "module_name": "select.m4",
  "hash_id": "bd3844fa667fdfbba7ffdae690f28912ef897e26c8c132e392d96eb3be402385",
  "original_prompt": "Ingested from coreutils-9.4/m4/select.m4",
  "human_readable_source": "# select.m4 serial 16\ndnl Copyright (C) 2009-2023 Free Software Foundation, Inc.\ndnl This file is free software; the Free Software Foundation\ndnl gives unlimited permission to copy and/or distribute it,\ndnl with or without modifications, as long as this notice is preserved.\n\nAC_DEFUN([gl_FUNC_SELECT],\n[\n  AC_REQUIRE([gl_SYS_SELECT_H])\n  AC_REQUIRE([AC_C_RESTRICT])\n  AC_REQUIRE([AC_CANONICAL_HOST]) dnl for cross-compiles\n  AC_REQUIRE([gl_SOCKETS])\n  if test \"$ac_cv_header_winsock2_h\" = yes; then\n    REPLACE_SELECT=1\n  else\n    dnl On Interix 3.5, select(0, NULL, NULL, NULL, timeout) fails with error\n    dnl EFAULT.\n    AC_CHECK_HEADERS_ONCE([sys/select.h])\n    AC_CACHE_CHECK([whether select supports a 0 argument],\n      [gl_cv_func_select_supports0],\n      [\n        AC_RUN_IFELSE([AC_LANG_SOURCE([[\n#include <sys/types.h>\n#include <sys/time.h>\n#if HAVE_SYS_SELECT_H\n#include <sys/select.h>\n#endif\nint main ()\n{\n  struct timeval timeout;\n  timeout.tv_sec = 0;\n  timeout.tv_usec = 5;\n  return select (0, (fd_set *)0, (fd_set *)0, (fd_set *)0, &timeout) < 0;\n}]])], [gl_cv_func_select_supports0=yes], [gl_cv_func_select_supports0=no],\n          [\nchangequote(,)dnl\n           case \"$host_os\" in\n                       # Guess no on Interix.\n             interix*) gl_cv_func_select_supports0=\"guessing no\";;\n                       # Guess yes otherwise.\n             *)        gl_cv_func_select_supports0=\"guessing yes\";;\n           esac\nchangequote([,])dnl\n          ])\n      ])\n    case \"$gl_cv_func_select_supports0\" in\n      *yes) ;;\n      *) REPLACE_SELECT=1 ;;\n    esac\n\n    dnl On FreeBSD 8.2, select() doesn't always reject bad fds.\n    AC_CACHE_CHECK([whether select detects invalid fds],\n      [gl_cv_func_select_detects_ebadf],\n      [\n        AC_RUN_IFELSE([AC_LANG_PROGRAM([[\n#include <sys/types.h>\n#include <sys/time.h>\n#if HAVE_SYS_SELECT_H\n# include <sys/select.h>\n#endif\n#include <unistd.h>\n#include <errno.h>\n]GL_MDA_DEFINES],\n[[\n  fd_set set;\n  dup2(0, 16);\n  FD_ZERO(&set);\n  FD_SET(16, &set);\n  close(16);\n  struct timeval timeout;\n  timeout.tv_sec = 0;\n  timeout.tv_usec = 5;\n  return select (17, &set, NULL, NULL, &timeout) != -1 || errno != EBADF;\n]])], [gl_cv_func_select_detects_ebadf=yes],\n      [gl_cv_func_select_detects_ebadf=no],\n          [\n           case \"$host_os\" in\n                             # Guess yes on Linux systems.\n            linux-* | linux) gl_cv_func_select_detects_ebadf=\"guessing yes\" ;;\n                             # Guess yes on systems that emulate the Linux system calls.\n            midipix*)        gl_cv_func_select_detects_ebadf=\"guessing yes\" ;;\n                             # Guess yes on glibc systems.\n            *-gnu* | gnu*)   gl_cv_func_select_detects_ebadf=\"guessing yes\" ;;\n                             # If we don't know, obey --enable-cross-guesses.\n            *)               gl_cv_func_select_detects_ebadf=\"$gl_cross_guess_normal\" ;;\n           esac\n          ])\n      ])\n    case $gl_cv_func_select_detects_ebadf in\n      *yes) ;;\n      *) REPLACE_SELECT=1 ;;\n    esac\n  fi\n\n  dnl Determine the needed libraries.\n  SELECT_LIB=\"$LIBSOCKET\"\n  if test $REPLACE_SELECT = 1; then\n    case \"$host_os\" in\n      mingw* | windows*)\n        dnl On the MSVC platform, the function MsgWaitForMultipleObjects\n        dnl (used in lib/select.c) requires linking with -luser32. On mingw,\n        dnl it is implicit.\n        AC_LINK_IFELSE(\n          [AC_LANG_SOURCE([[\n#define WIN32_LEAN_AND_MEAN\n#include <windows.h>\nint\nmain ()\n{\n  MsgWaitForMultipleObjects (0, NULL, 0, 0, 0);\n  return 0;\n}]])],\n          [],\n          [SELECT_LIB=\"$SELECT_LIB -luser32\"])\n        ;;\n    esac\n  fi\n  AC_SUBST([SELECT_LIB])\n  dnl For backward compatibility.\n  LIB_SELECT=\"$LIB_SELECT\"\n  AC_SUBST([LIB_SELECT])\n])\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}