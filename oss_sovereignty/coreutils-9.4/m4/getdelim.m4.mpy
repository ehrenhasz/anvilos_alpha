{
  "module_name": "getdelim.m4",
  "hash_id": "3130c5d82b44ce8907dd52a4ebec2d6ca4d59fdad18882926a3f1825ff95e026",
  "original_prompt": "Ingested from coreutils-9.4/m4/getdelim.m4",
  "human_readable_source": "# getdelim.m4 serial 19\n\ndnl Copyright (C) 2005-2007, 2009-2023 Free Software Foundation, Inc.\ndnl\ndnl This file is free software; the Free Software Foundation\ndnl gives unlimited permission to copy and/or distribute it,\ndnl with or without modifications, as long as this notice is preserved.\n\nAC_PREREQ([2.59])\n\nAC_DEFUN([gl_FUNC_GETDELIM],\n[\n  AC_REQUIRE([gl_STDIO_H_DEFAULTS])\n  AC_REQUIRE([AC_CANONICAL_HOST])\n\n  dnl Persuade glibc <stdio.h> to declare getdelim().\n  AC_REQUIRE([AC_USE_SYSTEM_EXTENSIONS])\n\n  AC_CHECK_DECLS_ONCE([getdelim])\n\n  gl_CHECK_FUNCS_ANDROID([getdelim], [[#include <stdio.h>]])\n  if test $ac_cv_func_getdelim = yes; then\n    HAVE_GETDELIM=1\n    dnl Found it in some library.  Verify that it works.\n    AC_CACHE_CHECK([for working getdelim function],\n      [gl_cv_func_working_getdelim],\n      [case \"$host_os\" in\n         darwin*)\n           dnl On macOS 10.13, valgrind detected an out-of-bounds read during\n           dnl the GNU sed test suite:\n           dnl   Invalid read of size 16\n           dnl      at 0x100EE6A05: _platform_memchr$VARIANT$Base (in /usr/lib/system/libsystem_platform.dylib)\n           dnl      by 0x100B7B0BD: getdelim (in /usr/lib/system/libsystem_c.dylib)\n           dnl      by 0x10000B0BE: ck_getdelim (utils.c:254)\n           gl_cv_func_working_getdelim=no ;;\n         *)\n           echo fooNbarN | tr -d '\\012' | tr N '\\012' > conftest.data\n           AC_RUN_IFELSE([AC_LANG_SOURCE([[\n#    include <stdio.h>\n#    include <stdlib.h>\n#    include <string.h>\n    int main ()\n    {\n      FILE *in = fopen (\"./conftest.data\", \"r\");\n      if (!in)\n        return 1;\n      {\n        /* Test result for a NULL buffer and a zero size.\n           Based on a test program from Karl Heuer.  */\n        char *line = NULL;\n        size_t siz = 0;\n        int len = getdelim (&line, &siz, '\\n', in);\n        if (!(len == 4 && line && strcmp (line, \"foo\\n\") == 0))\n          { free (line); fclose (in); return 2; }\n        free (line);\n      }\n      {\n        /* Test result for a NULL buffer and a non-zero size.\n           This crashes on FreeBSD 8.0.  */\n        char *line = NULL;\n        size_t siz = (size_t)(~0) / 4;\n        if (getdelim (&line, &siz, '\\n', in) == -1)\n          { fclose (in); return 3; }\n        free (line);\n      }\n      fclose (in);\n      return 0;\n    }\n    ]])],\n             [gl_cv_func_working_getdelim=yes],\n             [gl_cv_func_working_getdelim=no],\n             [dnl We're cross compiling.\n              dnl Guess it works on glibc2 systems and musl systems.\n              AC_EGREP_CPP([Lucky GNU user],\n                [\n#include <features.h>\n#ifdef __GNU_LIBRARY__\n #if (__GLIBC__ >= 2) && !defined __UCLIBC__\n  Lucky GNU user\n #endif\n#endif\n                ],\n                [gl_cv_func_working_getdelim=\"guessing yes\"],\n                [case \"$host_os\" in\n                   *-musl* | midipix*) gl_cv_func_working_getdelim=\"guessing yes\" ;;\n                   *)                  gl_cv_func_working_getdelim=\"$gl_cross_guess_normal\" ;;\n                 esac\n                ])\n             ])\n           ;;\n       esac\n      ])\n    case \"$gl_cv_func_working_getdelim\" in\n      *yes) ;;\n      *) REPLACE_GETDELIM=1 ;;\n    esac\n  else\n    HAVE_GETDELIM=0\n    case \"$gl_cv_onwards_func_getdelim\" in\n      future*) REPLACE_GETDELIM=1 ;;\n    esac\n  fi\n\n  if test $ac_cv_have_decl_getdelim = no; then\n    HAVE_DECL_GETDELIM=0\n  fi\n])\n\n# Prerequisites of lib/getdelim.c.\nAC_DEFUN([gl_PREREQ_GETDELIM],\n[\n  AC_CHECK_FUNCS([flockfile funlockfile])\n  AC_CHECK_DECLS([getc_unlocked])\n])\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}