{
  "module_name": "mbsrtowcs.m4",
  "hash_id": "dad965a9a531cd37e5899b71c5fdc6d7351278e5ab43376de92d8511d875042d",
  "original_prompt": "Ingested from coreutils-9.4/m4/mbsrtowcs.m4",
  "human_readable_source": "# mbsrtowcs.m4 serial 17\ndnl Copyright (C) 2008-2023 Free Software Foundation, Inc.\ndnl This file is free software; the Free Software Foundation\ndnl gives unlimited permission to copy and/or distribute it,\ndnl with or without modifications, as long as this notice is preserved.\n\nAC_DEFUN([gl_FUNC_MBSRTOWCS],\n[\n  AC_REQUIRE([gl_WCHAR_H_DEFAULTS])\n\n  AC_REQUIRE([AC_TYPE_MBSTATE_T])\n  gl_MBSTATE_T_BROKEN\n\n  AC_CHECK_FUNCS_ONCE([mbsrtowcs])\n  if test $ac_cv_func_mbsrtowcs = no; then\n    HAVE_MBSRTOWCS=0\n    AC_CHECK_DECLS([mbsrtowcs],,, [[\n      #include <wchar.h>\n    ]])\n    if test $ac_cv_have_decl_mbsrtowcs = yes; then\n      dnl On Minix 3.1.8, the system's <wchar.h> declares mbsrtowcs() although\n      dnl it does not have the function. Avoid a collision with gnulib's\n      dnl replacement.\n      REPLACE_MBSRTOWCS=1\n    fi\n  else\n    if test $REPLACE_MBSTATE_T = 1; then\n      REPLACE_MBSRTOWCS=1\n    else\n      gl_MBSRTOWCS_WORKS\n      case \"$gl_cv_func_mbsrtowcs_works\" in\n        *yes) ;;\n        *) REPLACE_MBSRTOWCS=1 ;;\n      esac\n      if test $REPLACE_MBSRTOWCS = 0; then\n        gl_MBRTOWC_C_LOCALE\n        case \"$gl_cv_func_mbrtowc_C_locale_sans_EILSEQ\" in\n          *yes) ;;\n          *) REPLACE_MBSRTOWCS=1 ;;\n        esac\n      fi\n    fi\n  fi\n])\n\ndnl Test whether mbsrtowcs works.\ndnl Result is gl_cv_func_mbsrtowcs_works.\n\nAC_DEFUN([gl_MBSRTOWCS_WORKS],\n[\n  AC_REQUIRE([AC_PROG_CC])\n  AC_REQUIRE([gt_LOCALE_FR])\n  AC_REQUIRE([gt_LOCALE_FR_UTF8])\n  AC_REQUIRE([gt_LOCALE_JA])\n  AC_REQUIRE([gt_LOCALE_ZH_CN])\n  AC_REQUIRE([AC_CANONICAL_HOST]) dnl for cross-compiles\n  AC_CACHE_CHECK([whether mbsrtowcs works],\n    [gl_cv_func_mbsrtowcs_works],\n    [\n      dnl Initial guess, used when cross-compiling or when no suitable locale\n      dnl is present.\nchangequote(,)dnl\n      case \"$host_os\" in\n          # Guess no on HP-UX, Solaris, mingw.\n        hpux* | solaris* | mingw* | windows*)\n          gl_cv_func_mbsrtowcs_works=\"guessing no\" ;;\n          # Guess yes otherwise.\n        *)\n          gl_cv_func_mbsrtowcs_works=\"guessing yes\" ;;\n      esac\nchangequote([,])dnl\n      if test $LOCALE_FR != none || test $LOCALE_FR_UTF8 != none || test $LOCALE_JA != none || test $LOCALE_ZH_CN != none; then\n        AC_RUN_IFELSE(\n          [AC_LANG_SOURCE([[\n#include <locale.h>\n#include <string.h>\n#include <wchar.h>\nint main ()\n{\n  int result = 0;\n  /* Test whether the function supports a NULL destination argument.\n     This fails on native Windows.  */\n  if (strcmp (\"$LOCALE_FR\", \"none\") != 0\n      && setlocale (LC_ALL, \"$LOCALE_FR\") != NULL)\n    {\n      const char input[] = \"\\337er\";\n      const char *src = input;\n      mbstate_t state;\n\n      memset (&state, '\\0', sizeof (mbstate_t));\n      if (mbsrtowcs (NULL, &src, 1, &state) != 3\n          || src != input)\n        result |= 1;\n    }\n  /* Test whether the function works when started with a conversion state\n     in non-initial state.  This fails on HP-UX 11.11 and Solaris 10.  */\n  if (strcmp (\"$LOCALE_FR_UTF8\", \"none\") != 0\n      && setlocale (LC_ALL, \"$LOCALE_FR_UTF8\") != NULL)\n    {\n      const char input[] = \"B\\303\\274\\303\\237er\";\n      mbstate_t state;\n\n      memset (&state, '\\0', sizeof (mbstate_t));\n      if (mbrtowc (NULL, input + 1, 1, &state) == (size_t)(-2))\n        if (!mbsinit (&state))\n          {\n            const char *src = input + 2;\n            if (mbsrtowcs (NULL, &src, 10, &state) != 4)\n              result |= 2;\n          }\n    }\n  if (strcmp (\"$LOCALE_JA\", \"none\") != 0\n      && setlocale (LC_ALL, \"$LOCALE_JA\") != NULL)\n    {\n      const char input[] = \"<\\306\\374\\313\\334\\270\\354>\";\n      mbstate_t state;\n\n      memset (&state, '\\0', sizeof (mbstate_t));\n      if (mbrtowc (NULL, input + 3, 1, &state) == (size_t)(-2))\n        if (!mbsinit (&state))\n          {\n            const char *src = input + 4;\n            if (mbsrtowcs (NULL, &src, 10, &state) != 3)\n              result |= 4;\n          }\n    }\n  if (strcmp (\"$LOCALE_ZH_CN\", \"none\") != 0\n      && setlocale (LC_ALL, \"$LOCALE_ZH_CN\") != NULL)\n    {\n      const char input[] = \"B\\250\\271\\201\\060\\211\\070er\";\n      mbstate_t state;\n\n      memset (&state, '\\0', sizeof (mbstate_t));\n      if (mbrtowc (NULL, input + 1, 1, &state) == (size_t)(-2))\n        if (!mbsinit (&state))\n          {\n            const char *src = input + 2;\n            if (mbsrtowcs (NULL, &src, 10, &state) != 4)\n              result |= 8;\n          }\n    }\n  return result;\n}]])],\n          [gl_cv_func_mbsrtowcs_works=yes],\n          [gl_cv_func_mbsrtowcs_works=no],\n          [:])\n      fi\n    ])\n])\n\n# Prerequisites of lib/mbsrtowcs.c.\nAC_DEFUN([gl_PREREQ_MBSRTOWCS], [\n  :\n])\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}