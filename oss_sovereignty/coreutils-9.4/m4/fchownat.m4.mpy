{
  "module_name": "fchownat.m4",
  "hash_id": "755a456b55e8109bbfe6484cc4fe5b2b14587ce1c30adeda28c53b9eaabc445d",
  "original_prompt": "Ingested from coreutils-9.4/m4/fchownat.m4",
  "human_readable_source": "# fchownat.m4 serial 7\ndnl Copyright (C) 2004-2023 Free Software Foundation, Inc.\ndnl This file is free software; the Free Software Foundation\ndnl gives unlimited permission to copy and/or distribute it,\ndnl with or without modifications, as long as this notice is preserved.\n\n# Written by Jim Meyering.\n\n# If we have the fchownat function, and it has the bug (in glibc-2.4)\n# that it dereferences symlinks even with AT_SYMLINK_NOFOLLOW, then\n# use the replacement function.\n# Also if the fchownat function, like chown, has the trailing slash bug,\n# use the replacement function.\n# Also use the replacement function if fchownat is simply not available.\nAC_DEFUN([gl_FUNC_FCHOWNAT],\n[\n  AC_REQUIRE([gl_UNISTD_H_DEFAULTS])\n  AC_REQUIRE([gl_USE_SYSTEM_EXTENSIONS])\n  AC_REQUIRE([gl_FUNC_CHOWN])\n  AC_CHECK_FUNC([fchownat],\n    [gl_FUNC_FCHOWNAT_DEREF_BUG(\n       [REPLACE_FCHOWNAT=1\n        AC_DEFINE([FCHOWNAT_NOFOLLOW_BUG], [1],\n                  [Define to 1 if your platform has fchownat, but it cannot\n                   perform lchown tasks.])\n       ])\n     gl_FUNC_FCHOWNAT_EMPTY_FILENAME_BUG(\n       [REPLACE_FCHOWNAT=1\n        AC_DEFINE([FCHOWNAT_EMPTY_FILENAME_BUG], [1],\n                  [Define to 1 if your platform has fchownat, but it does\n                   not reject an empty file name.])\n       ])\n     if test $REPLACE_CHOWN = 1; then\n       REPLACE_FCHOWNAT=1\n     fi],\n    [HAVE_FCHOWNAT=0])\n])\n\n# gl_FUNC_FCHOWNAT_DEREF_BUG([ACTION-IF-BUGGY[, ACTION-IF-NOT_BUGGY]])\nAC_DEFUN([gl_FUNC_FCHOWNAT_DEREF_BUG],\n[\n  dnl Persuade glibc's <unistd.h> to declare fchownat().\n  AC_REQUIRE([gl_USE_SYSTEM_EXTENSIONS])\n\n  AC_CACHE_CHECK([whether fchownat works with AT_SYMLINK_NOFOLLOW],\n    [gl_cv_func_fchownat_nofollow_works],\n    [\n     gl_dangle=conftest.dangle\n     # Remove any remnants of a previous test.\n     rm -f $gl_dangle\n     # Arrange for deletion of the temporary file this test creates.\n     ac_clean_files=\"$ac_clean_files $gl_dangle\"\n     ln -s conftest.no-such $gl_dangle\n     AC_RUN_IFELSE(\n       [AC_LANG_SOURCE(\n          [[\n#include <fcntl.h>\n#include <unistd.h>\n/* Android 4.3 declares fchownat() in <sys/stat.h> instead.  */\n#include <sys/stat.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <sys/types.h>\nint\nmain ()\n{\n  return (fchownat (AT_FDCWD, \"$gl_dangle\", (uid_t)(-1), getgid (),\n                    AT_SYMLINK_NOFOLLOW) != 0\n          && errno == ENOENT);\n}\n          ]])],\n       [gl_cv_func_fchownat_nofollow_works=yes],\n       [gl_cv_func_fchownat_nofollow_works=no],\n       [gl_cv_func_fchownat_nofollow_works=\"$gl_cross_guess_normal\"])\n  ])\n  AS_IF([test \"$gl_cv_func_fchownat_nofollow_works\" != yes], [$1], [$2])\n])\n\n# gl_FUNC_FCHOWNAT_EMPTY_FILENAME_BUG([ACTION-IF-BUGGY[, ACTION-IF-NOT_BUGGY]])\nAC_DEFUN([gl_FUNC_FCHOWNAT_EMPTY_FILENAME_BUG],\n[\n  dnl Persuade glibc's <unistd.h> to declare fchownat().\n  AC_REQUIRE([gl_USE_SYSTEM_EXTENSIONS])\n\n  AC_CACHE_CHECK([whether fchownat works with an empty file name],\n    [gl_cv_func_fchownat_empty_filename_works],\n    [AC_RUN_IFELSE(\n       [AC_LANG_PROGRAM(\n          [[#include <unistd.h>\n            #include <fcntl.h>\n            /* Android 4.3 declares fchownat() in <sys/stat.h> instead.  */\n            #include <sys/stat.h>\n          ]GL_MDA_DEFINES],\n          [[int fd;\n            int ret;\n            if (mkdir (\"conftestdir\", 0700) < 0)\n              return 2;\n            fd = open (\"conftestdir\", O_RDONLY);\n            if (fd < 0)\n              return 3;\n            ret = fchownat (fd, \"\", (uid_t)(-1), (gid_t)(-1), 0);\n            close (fd);\n            rmdir (\"conftestdir\");\n            return ret == 0;\n          ]])],\n       [gl_cv_func_fchownat_empty_filename_works=yes],\n       [gl_cv_func_fchownat_empty_filename_works=no],\n       [gl_cv_func_fchownat_empty_filename_works=\"$gl_cross_guess_normal\"])\n    ])\n  AS_IF([test \"$gl_cv_func_fchownat_empty_filename_works\" != yes], [$1], [$2])\n])\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}