{
  "module_name": "btowc.m4",
  "hash_id": "cc72028e43e8c54e7bd24f7456487748a993066f2f14445bf31ce21378101620",
  "original_prompt": "Ingested from coreutils-9.4/m4/btowc.m4",
  "human_readable_source": "# btowc.m4 serial 14\ndnl Copyright (C) 2008-2023 Free Software Foundation, Inc.\ndnl This file is free software; the Free Software Foundation\ndnl gives unlimited permission to copy and/or distribute it,\ndnl with or without modifications, as long as this notice is preserved.\n\nAC_DEFUN([gl_FUNC_BTOWC],\n[\n  AC_REQUIRE([gl_WCHAR_H_DEFAULTS])\n\n  dnl Check whether <wchar.h> is usable at all, first. Otherwise the test\n  dnl program below may lead to an endless loop. See\n  dnl <https://gcc.gnu.org/bugzilla/show_bug.cgi?id=42440>.\n  AC_REQUIRE([gl_WCHAR_H_INLINE_OK])\n\n  AC_CHECK_FUNCS_ONCE([btowc])\n  if test $ac_cv_func_btowc = no; then\n    HAVE_BTOWC=0\n  else\n\n    AC_REQUIRE([AC_PROG_CC])\n    AC_REQUIRE([gt_LOCALE_FR])\n    AC_REQUIRE([AC_CANONICAL_HOST]) dnl for cross-compiles\n\n    dnl Cygwin 1.7.2 btowc('\\0') is WEOF, not 0.\n    AC_CACHE_CHECK([whether btowc(0) is correct],\n      [gl_cv_func_btowc_nul],\n      [\n        AC_RUN_IFELSE(\n          [AC_LANG_SOURCE([[\n#include <wchar.h>\nint main ()\n{\n  if (btowc ('\\0') != 0)\n    return 1;\n  return 0;\n}]])],\n          [gl_cv_func_btowc_nul=yes],\n          [gl_cv_func_btowc_nul=no],\n          [\nchangequote(,)dnl\n           case \"$host_os\" in\n                                # Guess no on Cygwin.\n             cygwin*)           gl_cv_func_btowc_nul=\"guessing no\" ;;\n                                # Guess yes on native Windows.\n             mingw* | windows*) gl_cv_func_btowc_nul=\"guessing yes\" ;;\n                                # Guess yes otherwise.\n             *)                 gl_cv_func_btowc_nul=\"guessing yes\" ;;\n           esac\nchangequote([,])dnl\n          ])\n      ])\n\n    dnl IRIX 6.5 btowc(EOF) is 0xFF, not WEOF.\n    AC_CACHE_CHECK([whether btowc(EOF) is correct],\n      [gl_cv_func_btowc_eof],\n      [\n        dnl Initial guess, used when cross-compiling or when no suitable locale\n        dnl is present.\nchangequote(,)dnl\n        case \"$host_os\" in\n                             # Guess no on IRIX.\n          irix*)             gl_cv_func_btowc_eof=\"guessing no\" ;;\n                             # Guess yes on native Windows.\n          mingw* | windows*) gl_cv_func_btowc_eof=\"guessing yes\" ;;\n                             # Guess yes otherwise.\n          *)                 gl_cv_func_btowc_eof=\"guessing yes\" ;;\n        esac\nchangequote([,])dnl\n        if test $LOCALE_FR != none; then\n          AC_RUN_IFELSE(\n            [AC_LANG_SOURCE([[\n#include <locale.h>\n#include <stdio.h>\n#include <wchar.h>\nint main ()\n{\n  if (setlocale (LC_ALL, \"$LOCALE_FR\") != NULL)\n    {\n      if (btowc (EOF) != WEOF)\n        return 1;\n    }\n  return 0;\n}]])],\n            [gl_cv_func_btowc_eof=yes],\n            [gl_cv_func_btowc_eof=no],\n            [:])\n        fi\n      ])\n\n    dnl On mingw, in the C locale, btowc is inconsistent with mbrtowc:\n    dnl mbrtowc avoids calling MultiByteToWideChar when MB_CUR_MAX is 1 and\n    dnl ___lc_codepage_func() is 0, but btowc is lacking this special case.\n    AC_CHECK_FUNCS_ONCE([mbrtowc])\n    AC_CACHE_CHECK([whether btowc is consistent with mbrtowc in the C locale],\n      [gl_cv_func_btowc_consistent],\n      [\n        AC_RUN_IFELSE(\n          [AC_LANG_SOURCE([[\n#include <stdlib.h>\n#include <string.h>\n#include <wchar.h>\nint main ()\n{\n#if HAVE_MBRTOWC\n  wint_t wc1 = btowc (0x80);\n  wchar_t wc2 = (wchar_t) 0xbadface;\n  char buf[1] = { 0x80 };\n  mbstate_t state;\n  memset (&state, 0, sizeof (mbstate_t));\n  if (mbrtowc (&wc2, buf, 1, &state) != 1 || wc1 != wc2)\n    return 1;\n#endif\n  return 0;\n}]])],\n          [gl_cv_func_btowc_consistent=yes],\n          [gl_cv_func_btowc_consistent=no],\n          [case \"$host_os\" in\n               # Guess no on mingw.\n             mingw* | windows*)\n               AC_EGREP_CPP([Problem], [\n#ifdef __MINGW32__\n Problem\n#endif\n                 ],\n                 [gl_cv_func_btowc_consistent=\"guessing no\"],\n                 [gl_cv_func_btowc_consistent=\"guessing yes\"])\n               ;;\n               # Guess yes otherwise.\n             *) gl_cv_func_btowc_consistent=\"guessing yes\" ;;\n           esac\n          ])\n      ])\n\n    case \"$gl_cv_func_btowc_nul\" in\n      *yes) ;;\n      *) REPLACE_BTOWC=1 ;;\n    esac\n    case \"$gl_cv_func_btowc_eof\" in\n      *yes) ;;\n      *) REPLACE_BTOWC=1 ;;\n    esac\n    case \"$gl_cv_func_btowc_consistent\" in\n      *yes) ;;\n      *) REPLACE_BTOWC=1 ;;\n    esac\n    if test $REPLACE_BTOWC = 0; then\n      gl_MBRTOWC_C_LOCALE\n      case \"$gl_cv_func_mbrtowc_C_locale_sans_EILSEQ\" in\n        *yes) ;;\n        *) REPLACE_BTOWC=1 ;;\n      esac\n    fi\n  fi\n])\n\n# Prerequisites of lib/btowc.c.\nAC_DEFUN([gl_PREREQ_BTOWC], [\n  :\n  AC_CHECK_FUNCS_ONCE([mbrtowc])\n])\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}