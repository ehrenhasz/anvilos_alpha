{
  "module_name": "unlink.m4",
  "hash_id": "d490ce2802a1266eba2105cd85460a48ef7c0dd35b8a29c297a80f9b8e8c9fae",
  "original_prompt": "Ingested from coreutils-9.4/m4/unlink.m4",
  "human_readable_source": "# unlink.m4 serial 17\ndnl Copyright (C) 2009-2023 Free Software Foundation, Inc.\ndnl This file is free software; the Free Software Foundation\ndnl gives unlimited permission to copy and/or distribute it,\ndnl with or without modifications, as long as this notice is preserved.\n\nAC_DEFUN([gl_FUNC_UNLINK],\n[\n  AC_REQUIRE([gl_UNISTD_H_DEFAULTS])\n  AC_REQUIRE([AC_CANONICAL_HOST])\n  AC_CHECK_HEADERS_ONCE([unistd.h])\n\n  dnl Detect FreeBSD 7.2, AIX 7.1, Solaris 9 bug.\n  AC_CACHE_CHECK([whether unlink honors trailing slashes],\n    [gl_cv_func_unlink_honors_slashes],\n    [touch conftest.file\n     # Assume that if we have lstat, we can also check symlinks.\n     if test $ac_cv_func_lstat = yes; then\n       ln -s conftest.file conftest.lnk\n     fi\n     AC_RUN_IFELSE(\n       [AC_LANG_PROGRAM(\n         [[#if HAVE_UNISTD_H\n           # include <unistd.h>\n           #else /* on Windows with MSVC */\n           # include <io.h>\n           #endif\n           #include <errno.h>\n         ]GL_MDA_DEFINES],\n         [[int result = 0;\n           if (!unlink (\"conftest.file/\"))\n             result |= 1;\n           else if (errno != ENOTDIR)\n             result |= 2;\n#if HAVE_LSTAT\n           if (!unlink (\"conftest.lnk/\"))\n             result |= 4;\n           else if (errno != ENOTDIR)\n             result |= 8;\n#endif\n           return result;\n         ]])],\n      [gl_cv_func_unlink_honors_slashes=yes],\n      [gl_cv_func_unlink_honors_slashes=no],\n      [case \"$host_os\" in\n                            # Guess yes on Linux systems.\n         linux-* | linux)   gl_cv_func_unlink_honors_slashes=\"guessing yes\" ;;\n                            # Guess yes on systems that emulate the Linux system calls.\n         midipix*)          gl_cv_func_unlink_honors_slashes=\"guessing yes\" ;;\n                            # Guess yes on glibc systems.\n         *-gnu*)            gl_cv_func_unlink_honors_slashes=\"guessing yes\" ;;\n                            # Guess no on native Windows.\n         mingw* | windows*) gl_cv_func_unlink_honors_slashes=\"guessing no\" ;;\n                            # If we don't know, obey --enable-cross-guesses.\n         *)                 gl_cv_func_unlink_honors_slashes=\"$gl_cross_guess_normal\" ;;\n       esac\n      ])\n     rm -f conftest.file conftest.lnk])\n  case \"$gl_cv_func_unlink_honors_slashes\" in\n    *no)\n      REPLACE_UNLINK=1\n      ;;\n  esac\n\n  dnl Detect Mac OS X 10.5.6 bug: On read-write HFS mounts, unlink(\"..\") or\n  dnl unlink(\"../..\") succeeds without doing anything.\n  AC_CACHE_CHECK([whether unlink of a parent directory fails as it should],\n    [gl_cv_func_unlink_parent_fails],\n    [case \"$host_os\" in\n       darwin*)\n         dnl Try to unlink a subdirectory of /tmp, because /tmp is usually on a\n         dnl HFS mount on Mac OS X. Use a subdirectory, owned by the current\n         dnl user, because otherwise unlink() may fail due to permissions\n         dnl reasons, and because when running as root we don't want to risk\n         dnl destroying the entire /tmp.\n         if {\n              # Use the mktemp program if available. If not available, hide the error\n              # message.\n              tmp=`(umask 077 && mktemp -d /tmp/gtXXXXXX) 2>/dev/null` &&\n              test -n \"$tmp\" && test -d \"$tmp\"\n            } ||\n            {\n              # Use a simple mkdir command. It is guaranteed to fail if the directory\n              # already exists.  $RANDOM is bash specific and expands to empty in shells\n              # other than bash, ksh and zsh.  Its use does not increase security;\n              # rather, it minimizes the probability of failure in a very cluttered /tmp\n              # directory.\n              tmp=/tmp/gt$$-$RANDOM\n              (umask 077 && mkdir \"$tmp\")\n            }; then\n           mkdir \"$tmp/subdir\"\n           GL_SUBDIR_FOR_UNLINK=\"$tmp/subdir\"\n           export GL_SUBDIR_FOR_UNLINK\n           AC_RUN_IFELSE(\n             [AC_LANG_SOURCE([[\n                #include <stdlib.h>\n                #if HAVE_UNISTD_H\n                # include <unistd.h>\n                #else /* on Windows with MSVC */\n                # include <direct.h>\n                # include <io.h>\n                #endif\n                ]GL_MDA_DEFINES[\n                int main ()\n                {\n                  int result = 0;\n                  if (chdir (getenv (\"GL_SUBDIR_FOR_UNLINK\")) != 0)\n                    result |= 1;\n                  else if (unlink (\"..\") == 0)\n                    result |= 2;\n                  return result;\n                }\n              ]])],\n             [gl_cv_func_unlink_parent_fails=yes],\n             [gl_cv_func_unlink_parent_fails=no],\n             [# If we don't know, obey --enable-cross-guesses.\n              gl_cv_func_unlink_parent_fails=\"$gl_cross_guess_normal\"\n             ])\n           unset GL_SUBDIR_FOR_UNLINK\n           rm -rf \"$tmp\"\n         else\n           gl_cv_func_unlink_parent_fails=\"guessing no\"\n         fi\n         ;;\n       *)\n         gl_cv_func_unlink_parent_fails=\"guessing yes\"\n         ;;\n     esac\n    ])\n  case \"$gl_cv_func_unlink_parent_fails\" in\n    *no)\n      REPLACE_UNLINK=1\n      AC_DEFINE([UNLINK_PARENT_BUG], [1],\n        [Define to 1 if unlink() on a parent directory may succeed])\n      ;;\n  esac\n])\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}