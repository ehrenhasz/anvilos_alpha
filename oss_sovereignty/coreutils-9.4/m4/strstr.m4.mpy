{
  "module_name": "strstr.m4",
  "hash_id": "342df029d9d0be117a51e9017c15936ddfa43a7b160effd212c46cc5237f33cd",
  "original_prompt": "Ingested from coreutils-9.4/m4/strstr.m4",
  "human_readable_source": "# strstr.m4 serial 24\ndnl Copyright (C) 2008-2023 Free Software Foundation, Inc.\ndnl This file is free software; the Free Software Foundation\ndnl gives unlimited permission to copy and/or distribute it,\ndnl with or without modifications, as long as this notice is preserved.\n\ndnl Check that strstr works.\nAC_DEFUN([gl_FUNC_STRSTR_SIMPLE],\n[\n  AC_REQUIRE([gl_STRING_H_DEFAULTS])\n  AC_REQUIRE([gl_FUNC_MEMCHR])\n  if test $REPLACE_MEMCHR = 1; then\n    REPLACE_STRSTR=1\n  else\n    dnl Detect https://sourceware.org/bugzilla/show_bug.cgi?id=12092\n    dnl and https://sourceware.org/bugzilla/show_bug.cgi?id=23637.\n    AC_CACHE_CHECK([whether strstr works],\n      [gl_cv_func_strstr_works_always],\n      [AC_RUN_IFELSE(\n         [AC_LANG_PROGRAM([[\n#include <string.h> /* for __GNU_LIBRARY__, strstr */\n#ifdef __GNU_LIBRARY__\n #include <features.h>\n #if __GLIBC__ == 2 && __GLIBC_MINOR__ == 28\n  Unlucky user\n #endif\n#endif\n#define P \"_EF_BF_BD\"\n#define HAYSTACK \"F_BD_CE_BD\" P P P P \"_C3_88_20\" P P P \"_C3_A7_20\" P\n#define NEEDLE P P P P P\n]],\n            [[return !!strstr (HAYSTACK, NEEDLE);\n            ]])],\n         [gl_cv_func_strstr_works_always=yes],\n         [gl_cv_func_strstr_works_always=no],\n         [dnl glibc 2.12 and cygwin 1.7.7 have a known bug.  uClibc is not\n          dnl affected, since it uses different source code for strstr than\n          dnl glibc.\n          dnl Assume that it works on all other platforms, even if it is not\n          dnl linear.\n          AC_EGREP_CPP([Lucky user],\n            [\n#include <string.h> /* for __GNU_LIBRARY__ */\n#ifdef __GNU_LIBRARY__\n #include <features.h>\n #if ((__GLIBC__ == 2 && __GLIBC_MINOR__ > 12) || (__GLIBC__ > 2)) \\\n     || defined __UCLIBC__\n  Lucky user\n #endif\n#elif defined __CYGWIN__\n #include <cygwin/version.h>\n #if CYGWIN_VERSION_DLL_COMBINED > CYGWIN_VERSION_DLL_MAKE_COMBINED (1007, 7)\n  Lucky user\n #endif\n#else\n  Lucky user\n#endif\n            ],\n            [gl_cv_func_strstr_works_always=\"guessing yes\"],\n            [gl_cv_func_strstr_works_always=\"$gl_cross_guess_normal\"])\n         ])\n      ])\n    case \"$gl_cv_func_strstr_works_always\" in\n      *yes) ;;\n      *)\n        REPLACE_STRSTR=1\n        ;;\n    esac\n  fi\n]) # gl_FUNC_STRSTR_SIMPLE\n\ndnl Additionally, check that strstr is efficient.\nAC_DEFUN([gl_FUNC_STRSTR],\n[\n  AC_REQUIRE([gl_FUNC_STRSTR_SIMPLE])\n  if test $REPLACE_STRSTR = 0; then\n    AC_CACHE_CHECK([whether strstr works in linear time],\n      [gl_cv_func_strstr_linear],\n      [AC_RUN_IFELSE([AC_LANG_PROGRAM([[\n#ifdef __MVS__\n/* z/OS does not deliver signals while strstr() is running (thanks to\n   restrictions on its LE runtime), which prevents us from limiting the\n   running time of this test.  */\n# error \"This test does not work properly on z/OS\"\n#endif\n#include <signal.h> /* for signal */\n#include <string.h> /* for strstr */\n#include <stdlib.h> /* for malloc */\n#include <unistd.h> /* for alarm */\nstatic void quit (int sig) { _exit (sig + 128); }\n]], [[\n    int result = 0;\n    size_t m = 1000000;\n    char *haystack = (char *) malloc (2 * m + 2);\n    char *needle = (char *) malloc (m + 2);\n    /* Failure to compile this test due to missing alarm is okay,\n       since all such platforms (mingw) also have quadratic strstr.  */\n    signal (SIGALRM, quit);\n    alarm (5);\n    /* Check for quadratic performance.  */\n    if (haystack && needle)\n      {\n        memset (haystack, 'A', 2 * m);\n        haystack[2 * m] = 'B';\n        haystack[2 * m + 1] = 0;\n        memset (needle, 'A', m);\n        needle[m] = 'B';\n        needle[m + 1] = 0;\n        if (!strstr (haystack, needle))\n          result |= 1;\n      }\n    /* Free allocated memory, in case some sanitizer is watching.  */\n    free (haystack);\n    free (needle);\n    return result;\n    ]])],\n        [gl_cv_func_strstr_linear=yes], [gl_cv_func_strstr_linear=no],\n        [dnl Only glibc > 2.12 on processors without SSE 4.2 instructions and\n         dnl cygwin > 1.7.7 are known to have a bug-free strstr that works in\n         dnl linear time.\n         AC_EGREP_CPP([Lucky user],\n           [\n#include <features.h>\n#ifdef __GNU_LIBRARY__\n #if ((__GLIBC__ == 2 && __GLIBC_MINOR__ > 12) || (__GLIBC__ > 2)) \\\n     && !(defined __i386__ || defined __x86_64__) \\\n     && !defined __UCLIBC__\n  Lucky user\n #endif\n#endif\n#ifdef __CYGWIN__\n #include <cygwin/version.h>\n #if CYGWIN_VERSION_DLL_COMBINED > CYGWIN_VERSION_DLL_MAKE_COMBINED (1007, 7)\n  Lucky user\n #endif\n#endif\n           ],\n           [gl_cv_func_strstr_linear=\"guessing yes\"],\n           [gl_cv_func_strstr_linear=\"$gl_cross_guess_normal\"])\n        ])\n      ])\n    case \"$gl_cv_func_strstr_linear\" in\n      *yes) ;;\n      *)\n        REPLACE_STRSTR=1\n        ;;\n    esac\n  fi\n]) # gl_FUNC_STRSTR\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}