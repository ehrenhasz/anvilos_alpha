{
  "module_name": "fchmodat.m4",
  "hash_id": "7b8780bf70e76dfedb3574932f297e2e381d0445998d117c10271fb19a7c650e",
  "original_prompt": "Ingested from coreutils-9.4/m4/fchmodat.m4",
  "human_readable_source": "# fchmodat.m4 serial 8\ndnl Copyright (C) 2004-2023 Free Software Foundation, Inc.\ndnl This file is free software; the Free Software Foundation\ndnl gives unlimited permission to copy and/or distribute it,\ndnl with or without modifications, as long as this notice is preserved.\n\n# Written by Jim Meyering.\n\nAC_DEFUN([gl_FUNC_FCHMODAT],\n[\n  AC_REQUIRE([gl_SYS_STAT_H_DEFAULTS])\n  AC_REQUIRE([gl_USE_SYSTEM_EXTENSIONS])\n  AC_REQUIRE([AC_CANONICAL_HOST]) dnl for cross-compiles\n  AC_CHECK_FUNCS_ONCE([fchmodat lchmod])\n  if test $ac_cv_func_fchmodat != yes; then\n    HAVE_FCHMODAT=0\n  else\n    AC_CACHE_CHECK(\n      [whether fchmodat works],\n      [gl_cv_func_fchmodat_works],\n      [AC_RUN_IFELSE(\n         [AC_LANG_PROGRAM(\n            [\n              AC_INCLUDES_DEFAULT[\n              #include <fcntl.h>\n              #ifndef S_IRUSR\n               #define S_IRUSR 0400\n              #endif\n              #ifndef S_IWUSR\n               #define S_IWUSR 0200\n              #endif\n              #ifndef S_IRWXU\n               #define S_IRWXU 0700\n              #endif\n              #ifndef S_IRWXG\n               #define S_IRWXG 0070\n              #endif\n              #ifndef S_IRWXO\n               #define S_IRWXO 0007\n              #endif\n            ]GL_MDA_DEFINES],\n            [[\n              int permissive = S_IRWXU | S_IRWXG | S_IRWXO;\n              int desired = S_IRUSR | S_IWUSR;\n              int result = 0;\n              #define file \"conftest.fchmodat\"\n              struct stat st;\n              if (creat (file, permissive) < 0)\n                return 1;\n              /* Test whether fchmodat rejects a trailing slash on a non-directory.\n                 This test fails on AIX 7.2.  */\n              if (fchmodat (AT_FDCWD, file \"/\", desired, 0) == 0)\n                result |= 2;\n              /* Test whether fchmodat+AT_SYMLINK_NOFOLLOW works on non-symlinks.\n                 This test fails on GNU/Linux with glibc 2.31 (but not on\n                 GNU/kFreeBSD nor GNU/Hurd) and Cygwin 2.9.  */\n              if (fchmodat (AT_FDCWD, file, desired, AT_SYMLINK_NOFOLLOW) != 0)\n                result |= 4;\n              if (stat (file, &st) != 0)\n                return 1;\n              if ((st.st_mode & permissive) != desired)\n                result |= 4;\n              return result;\n            ]])],\n         [gl_cv_func_fchmodat_works=yes],\n         [case $? in\n            2) gl_cv_func_fchmodat_works='nearly' ;;\n            *) gl_cv_func_fchmodat_works=no ;;\n          esac\n         ],\n         [case \"$host_os\" in\n                                  # Guess no on Linux with glibc and Cygwin.\n            linux-gnu* | cygwin*) gl_cv_func_fchmodat_works=\"guessing no\" ;;\n                                  # Guess 'nearly' on AIX.\n            aix*)                 gl_cv_func_fchmodat_works=\"guessing nearly\" ;;\n                                  # If we don't know, obey --enable-cross-guesses.\n            *)                    gl_cv_func_fchmodat_works=\"$gl_cross_guess_normal\" ;;\n          esac\n         ])\n       rm -f conftest.fchmodat])\n    case \"$gl_cv_func_fchmodat_works\" in\n      *yes) ;;\n      *nearly)\n        AC_DEFINE([HAVE_NEARLY_WORKING_FCHMODAT], [1],\n          [Define to 1 if fchmodat works, except for the trailing slash handling.])\n        REPLACE_FCHMODAT=1\n        ;;\n      *)\n        AC_DEFINE([NEED_FCHMODAT_NONSYMLINK_FIX], [1],\n          [Define to 1 if fchmodat+AT_SYMLINK_NOFOLLOW does not work right on non-symlinks.])\n        REPLACE_FCHMODAT=1\n        ;;\n    esac\n  fi\n])\n\n# Prerequisites of lib/fchmodat.c.\nAC_DEFUN([gl_PREREQ_FCHMODAT],\n[\n  gl_CHECK_FUNCS_ANDROID([readlinkat], [[#include <unistd.h>]])\n  :\n])\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}