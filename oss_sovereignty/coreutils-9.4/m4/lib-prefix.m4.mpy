{
  "module_name": "lib-prefix.m4",
  "hash_id": "b0e1be44e545bd807c2a5e8827ebf5d53df0ac2831734a8c1011da3a54f391c3",
  "original_prompt": "Ingested from coreutils-9.4/m4/lib-prefix.m4",
  "human_readable_source": "# lib-prefix.m4 serial 20\ndnl Copyright (C) 2001-2005, 2008-2023 Free Software Foundation, Inc.\ndnl This file is free software; the Free Software Foundation\ndnl gives unlimited permission to copy and/or distribute it,\ndnl with or without modifications, as long as this notice is preserved.\n\ndnl From Bruno Haible.\n\ndnl AC_LIB_PREFIX adds to the CPPFLAGS and LDFLAGS the flags that are needed\ndnl to access previously installed libraries. The basic assumption is that\ndnl a user will want packages to use other packages he previously installed\ndnl with the same --prefix option.\ndnl This macro is not needed if only AC_LIB_LINKFLAGS is used to locate\ndnl libraries, but is otherwise very convenient.\nAC_DEFUN([AC_LIB_PREFIX],\n[\n  AC_BEFORE([$0], [AC_LIB_LINKFLAGS])\n  AC_REQUIRE([AC_PROG_CC])\n  AC_REQUIRE([AC_CANONICAL_HOST])\n  AC_REQUIRE([AC_LIB_PREPARE_MULTILIB])\n  AC_REQUIRE([AC_LIB_PREPARE_PREFIX])\n  dnl By default, look in $includedir and $libdir.\n  use_additional=yes\n  AC_LIB_WITH_FINAL_PREFIX([\n    eval additional_includedir=\\\"$includedir\\\"\n    eval additional_libdir=\\\"$libdir\\\"\n  ])\n  AC_ARG_WITH([lib-prefix],\n[[  --with-lib-prefix[=DIR] search for libraries in DIR/include and DIR/lib\n  --without-lib-prefix    don't search for libraries in includedir and libdir]],\n[\n    if test \"X$withval\" = \"Xno\"; then\n      use_additional=no\n    else\n      if test \"X$withval\" = \"X\"; then\n        AC_LIB_WITH_FINAL_PREFIX([\n          eval additional_includedir=\\\"$includedir\\\"\n          eval additional_libdir=\\\"$libdir\\\"\n        ])\n      else\n        additional_includedir=\"$withval/include\"\n        additional_libdir=\"$withval/$acl_libdirstem\"\n      fi\n    fi\n])\n  if test $use_additional = yes; then\n    dnl Potentially add $additional_includedir to $CPPFLAGS.\n    dnl But don't add it\n    dnl   1. if it's the standard /usr/include,\n    dnl   2. if it's already present in $CPPFLAGS,\n    dnl   3. if it's /usr/local/include and we are using GCC on Linux,\n    dnl   4. if it doesn't exist as a directory.\n    if test \"X$additional_includedir\" != \"X/usr/include\"; then\n      haveit=\n      for x in $CPPFLAGS; do\n        AC_LIB_WITH_FINAL_PREFIX([eval x=\\\"$x\\\"])\n        if test \"X$x\" = \"X-I$additional_includedir\"; then\n          haveit=yes\n          break\n        fi\n      done\n      if test -z \"$haveit\"; then\n        if test \"X$additional_includedir\" = \"X/usr/local/include\"; then\n          if test -n \"$GCC\"; then\n            case $host_os in\n              linux* | gnu* | k*bsd*-gnu) haveit=yes;;\n            esac\n          fi\n        fi\n        if test -z \"$haveit\"; then\n          if test -d \"$additional_includedir\"; then\n            dnl Really add $additional_includedir to $CPPFLAGS.\n            CPPFLAGS=\"${CPPFLAGS}${CPPFLAGS:+ }-I$additional_includedir\"\n          fi\n        fi\n      fi\n    fi\n    dnl Potentially add $additional_libdir to $LDFLAGS.\n    dnl But don't add it\n    dnl   1. if it's the standard /usr/lib,\n    dnl   2. if it's already present in $LDFLAGS,\n    dnl   3. if it's /usr/local/lib and we are using GCC on Linux,\n    dnl   4. if it doesn't exist as a directory.\n    if test \"X$additional_libdir\" != \"X/usr/$acl_libdirstem\"; then\n      haveit=\n      for x in $LDFLAGS; do\n        AC_LIB_WITH_FINAL_PREFIX([eval x=\\\"$x\\\"])\n        if test \"X$x\" = \"X-L$additional_libdir\"; then\n          haveit=yes\n          break\n        fi\n      done\n      if test -z \"$haveit\"; then\n        if test \"X$additional_libdir\" = \"X/usr/local/$acl_libdirstem\"; then\n          if test -n \"$GCC\"; then\n            case $host_os in\n              linux*) haveit=yes;;\n            esac\n          fi\n        fi\n        if test -z \"$haveit\"; then\n          if test -d \"$additional_libdir\"; then\n            dnl Really add $additional_libdir to $LDFLAGS.\n            LDFLAGS=\"${LDFLAGS}${LDFLAGS:+ }-L$additional_libdir\"\n          fi\n        fi\n      fi\n    fi\n  fi\n])\n\ndnl AC_LIB_PREPARE_PREFIX creates variables acl_final_prefix,\ndnl acl_final_exec_prefix, containing the values to which $prefix and\ndnl $exec_prefix will expand at the end of the configure script.\nAC_DEFUN([AC_LIB_PREPARE_PREFIX],\n[\n  dnl Unfortunately, prefix and exec_prefix get only finally determined\n  dnl at the end of configure.\n  if test \"X$prefix\" = \"XNONE\"; then\n    acl_final_prefix=\"$ac_default_prefix\"\n  else\n    acl_final_prefix=\"$prefix\"\n  fi\n  if test \"X$exec_prefix\" = \"XNONE\"; then\n    acl_final_exec_prefix='${prefix}'\n  else\n    acl_final_exec_prefix=\"$exec_prefix\"\n  fi\n  acl_save_prefix=\"$prefix\"\n  prefix=\"$acl_final_prefix\"\n  eval acl_final_exec_prefix=\\\"$acl_final_exec_prefix\\\"\n  prefix=\"$acl_save_prefix\"\n])\n\ndnl AC_LIB_WITH_FINAL_PREFIX([statement]) evaluates statement, with the\ndnl variables prefix and exec_prefix bound to the values they will have\ndnl at the end of the configure script.\nAC_DEFUN([AC_LIB_WITH_FINAL_PREFIX],\n[\n  acl_save_prefix=\"$prefix\"\n  prefix=\"$acl_final_prefix\"\n  acl_save_exec_prefix=\"$exec_prefix\"\n  exec_prefix=\"$acl_final_exec_prefix\"\n  $1\n  exec_prefix=\"$acl_save_exec_prefix\"\n  prefix=\"$acl_save_prefix\"\n])\n\ndnl AC_LIB_PREPARE_MULTILIB creates\ndnl - a function acl_is_expected_elfclass, that tests whether standard input\ndn;   has a 32-bit or 64-bit ELF header, depending on the host CPU ABI,\ndnl - 3 variables acl_libdirstem, acl_libdirstem2, acl_libdirstem3, containing\ndnl   the basename of the libdir to try in turn, either \"lib\" or \"lib64\" or\ndnl   \"lib/64\" or \"lib32\" or \"lib/sparcv9\" or \"lib/amd64\" or similar.\nAC_DEFUN([AC_LIB_PREPARE_MULTILIB],\n[\n  dnl There is no formal standard regarding lib, lib32, and lib64.\n  dnl On most glibc systems, the current practice is that on a system supporting\n  dnl 32-bit and 64-bit instruction sets or ABIs, 64-bit libraries go under\n  dnl $prefix/lib64 and 32-bit libraries go under $prefix/lib. However, on\n  dnl Arch Linux based distributions, it's the opposite: 32-bit libraries go\n  dnl under $prefix/lib32 and 64-bit libraries go under $prefix/lib.\n  dnl We determine the compiler's default mode by looking at the compiler's\n  dnl library search path. If at least one of its elements ends in /lib64 or\n  dnl points to a directory whose absolute pathname ends in /lib64, we use that\n  dnl for 64-bit ABIs. Similarly for 32-bit ABIs. Otherwise we use the default,\n  dnl namely \"lib\".\n  dnl On Solaris systems, the current practice is that on a system supporting\n  dnl 32-bit and 64-bit instruction sets or ABIs, 64-bit libraries go under\n  dnl $prefix/lib/64 (which is a symlink to either $prefix/lib/sparcv9 or\n  dnl $prefix/lib/amd64) and 32-bit libraries go under $prefix/lib.\n  AC_REQUIRE([AC_CANONICAL_HOST])\n  AC_REQUIRE([gl_HOST_CPU_C_ABI_32BIT])\n\n  AC_CACHE_CHECK([for ELF binary format], [gl_cv_elf],\n    [AC_EGREP_CPP([Extensible Linking Format],\n       [#if defined __ELF__ || (defined __linux__ && defined __EDG__)\n        Extensible Linking Format\n        #endif\n       ],\n       [gl_cv_elf=yes],\n       [gl_cv_elf=no])\n    ])\n  if test $gl_cv_elf = yes; then\n    # Extract the ELF class of a file (5th byte) in decimal.\n    # Cf. https://en.wikipedia.org/wiki/Executable_and_Linkable_Format#File_header\n    if od -A x < /dev/null >/dev/null 2>/dev/null; then\n      # Use POSIX od.\n      func_elfclass ()\n      {\n        od -A n -t d1 -j 4 -N 1\n      }\n    else\n      # Use BSD hexdump.\n      func_elfclass ()\n      {\n        dd bs=1 count=1 skip=4 2>/dev/null | hexdump -e '1/1 \"%3d \"'\n        echo\n      }\n    fi\n    # Use 'expr', not 'test', to compare the values of func_elfclass, because on\n    # Solaris 11 OpenIndiana and Solaris 11 OmniOS, the result is 001 or 002,\n    # not 1 or 2.\nchangequote(,)dnl\n    case $HOST_CPU_C_ABI_32BIT in\n      yes)\n        # 32-bit ABI.\n        acl_is_expected_elfclass ()\n        {\n          expr \"`func_elfclass | sed -e 's/[ \t]//g'`\" = 1 > /dev/null\n        }\n        ;;\n      no)\n        # 64-bit ABI.\n        acl_is_expected_elfclass ()\n        {\n          expr \"`func_elfclass | sed -e 's/[ \t]//g'`\" = 2 > /dev/null\n        }\n        ;;\n      *)\n        # Unknown.\n        acl_is_expected_elfclass ()\n        {\n          :\n        }\n        ;;\n    esac\nchangequote([,])dnl\n  else\n    acl_is_expected_elfclass ()\n    {\n      :\n    }\n  fi\n\n  dnl Allow the user to override the result by setting acl_cv_libdirstems.\n  AC_CACHE_CHECK([for the common suffixes of directories in the library search path],\n    [acl_cv_libdirstems],\n    [dnl Try 'lib' first, because that's the default for libdir in GNU, see\n     dnl <https://www.gnu.org/prep/standards/html_node/Directory-Variables.html>.\n     acl_libdirstem=lib\n     acl_libdirstem2=\n     acl_libdirstem3=\n     case \"$host_os\" in\n       solaris*)\n         dnl See Solaris 10 Software Developer Collection > Solaris 64-bit Developer's Guide > The Development Environment\n         dnl <https://docs.oracle.com/cd/E19253-01/816-5138/dev-env/index.html>.\n         dnl \"Portable Makefiles should refer to any library directories using the 64 symbolic link.\"\n         dnl But we want to recognize the sparcv9 or amd64 subdirectory also if the\n         dnl symlink is missing, so we set acl_libdirstem2 too.\n         if test $HOST_CPU_C_ABI_32BIT = no; then\n           acl_libdirstem2=lib/64\n           case \"$host_cpu\" in\n             sparc*)        acl_libdirstem3=lib/sparcv9 ;;\n             i*86 | x86_64) acl_libdirstem3=lib/amd64 ;;\n           esac\n         fi\n         ;;\n       *)\n         dnl If $CC generates code for a 32-bit ABI, the libraries are\n         dnl surely under $prefix/lib or $prefix/lib32, not $prefix/lib64.\n         dnl Similarly, if $CC generates code for a 64-bit ABI, the libraries\n         dnl are surely under $prefix/lib or $prefix/lib64, not $prefix/lib32.\n         dnl Find the compiler's search path. However, non-system compilers\n         dnl sometimes have odd library search paths. But we can't simply invoke\n         dnl '/usr/bin/gcc -print-search-dirs' because that would not take into\n         dnl account the -m32/-m31 or -m64 options from the $CC or $CFLAGS.\n         searchpath=`(LC_ALL=C $CC $CPPFLAGS $CFLAGS -print-search-dirs) 2>/dev/null \\\n                     | sed -n -e 's,^libraries: ,,p' | sed -e 's,^=,,'`\n         if test $HOST_CPU_C_ABI_32BIT != no; then\n           # 32-bit or unknown ABI.\n           if test -d /usr/lib32; then\n             acl_libdirstem2=lib32\n           fi\n         fi\n         if test $HOST_CPU_C_ABI_32BIT != yes; then\n           # 64-bit or unknown ABI.\n           if test -d /usr/lib64; then\n             acl_libdirstem3=lib64\n           fi\n         fi\n         if test -n \"$searchpath\"; then\n           acl_save_IFS=\"${IFS= \t}\"; IFS=\":\"\n           for searchdir in $searchpath; do\n             if test -d \"$searchdir\"; then\n               case \"$searchdir\" in\n                 */lib32/ | */lib32 ) acl_libdirstem2=lib32 ;;\n                 */lib64/ | */lib64 ) acl_libdirstem3=lib64 ;;\n                 */../ | */.. )\n                   # Better ignore directories of this form. They are misleading.\n                   ;;\n                 *) searchdir=`cd \"$searchdir\" && pwd`\n                    case \"$searchdir\" in\n                      */lib32 ) acl_libdirstem2=lib32 ;;\n                      */lib64 ) acl_libdirstem3=lib64 ;;\n                    esac ;;\n               esac\n             fi\n           done\n           IFS=\"$acl_save_IFS\"\n           if test $HOST_CPU_C_ABI_32BIT = yes; then\n             # 32-bit ABI.\n             acl_libdirstem3=\n           fi\n           if test $HOST_CPU_C_ABI_32BIT = no; then\n             # 64-bit ABI.\n             acl_libdirstem2=\n           fi\n         fi\n         ;;\n     esac\n     test -n \"$acl_libdirstem2\" || acl_libdirstem2=\"$acl_libdirstem\"\n     test -n \"$acl_libdirstem3\" || acl_libdirstem3=\"$acl_libdirstem\"\n     acl_cv_libdirstems=\"$acl_libdirstem,$acl_libdirstem2,$acl_libdirstem3\"\n    ])\n  dnl Decompose acl_cv_libdirstems into acl_libdirstem, acl_libdirstem2, and\n  dnl acl_libdirstem3.\nchangequote(,)dnl\n  acl_libdirstem=`echo \"$acl_cv_libdirstems\" | sed -e 's/,.*//'`\n  acl_libdirstem2=`echo \"$acl_cv_libdirstems\" | sed -e 's/^[^,]*,//' -e 's/,.*//'`\n  acl_libdirstem3=`echo \"$acl_cv_libdirstems\" | sed -e 's/^[^,]*,[^,]*,//' -e 's/,.*//'`\nchangequote([,])dnl\n])\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}