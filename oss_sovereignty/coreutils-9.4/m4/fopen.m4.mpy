{
  "module_name": "fopen.m4",
  "hash_id": "035e19e0476ba3e5aeea334a07e470cea1f0e282f90dda87130d04b4bf902619",
  "original_prompt": "Ingested from coreutils-9.4/m4/fopen.m4",
  "human_readable_source": "# fopen.m4 serial 16\ndnl Copyright (C) 2007-2023 Free Software Foundation, Inc.\ndnl This file is free software; the Free Software Foundation\ndnl gives unlimited permission to copy and/or distribute it,\ndnl with or without modifications, as long as this notice is preserved.\n\nAC_DEFUN([gl_FUNC_FOPEN_ITSELF],\n[\n  AC_REQUIRE([gl_STDIO_H_DEFAULTS])\n  AC_REQUIRE([AC_CANONICAL_HOST])\n  case \"$host_os\" in\n    mingw* | windows* | pw*)\n      dnl Replace fopen, for handling of \"/dev/null\".\n      REPLACE_FOPEN=1\n      dnl fopen on mingw also has the trailing slash bug.\n      gl_cv_func_fopen_slash=\"guessing no\"\n      ;;\n    *)\n      dnl fopen(\"foo/\", \"w\") should not create a file when the file name has a\n      dnl trailing slash.\n      AC_CACHE_CHECK([whether fopen recognizes a trailing slash],\n        [gl_cv_func_fopen_slash],\n        [\n          AC_RUN_IFELSE(\n            [AC_LANG_SOURCE([[\n#include <stddef.h>\n#include <stdio.h>\nint main ()\n{\n  FILE *fp = fopen (\"conftest.sl/\", \"w\");\n  int result = (fp != NULL);\n  if (fp != NULL)\n    fclose (fp);\n  return result;\n}]])],\n            [gl_cv_func_fopen_slash=yes],\n            [gl_cv_func_fopen_slash=no],\n            [\nchangequote(,)dnl\n             case \"$host_os\" in\n               aix* | hpux* | solaris2.[0-9] | solaris2.[0-9].*)\n                 gl_cv_func_fopen_slash=\"guessing no\" ;;\n               *)\n                 gl_cv_func_fopen_slash=\"guessing yes\" ;;\n             esac\nchangequote([,])dnl\n            ])\n          rm -f conftest.sl\n        ])\n      ;;\n  esac\n  case \"$gl_cv_func_fopen_slash\" in\n    *no)\n      AC_DEFINE([FOPEN_TRAILING_SLASH_BUG], [1],\n        [Define to 1 if fopen() fails to recognize a trailing slash.])\n      REPLACE_FOPEN=1\n      ;;\n  esac\n])\n\nAC_DEFUN([gl_FUNC_FOPEN],\n[\n  AC_REQUIRE([gl_FUNC_FOPEN_ITSELF])\n  AC_REQUIRE([gl_FUNC_FCLOSE])\n  if test $REPLACE_FCLOSE = 1; then\n    REPLACE_FOPEN=1\n  fi\n])\n\nAC_DEFUN([gl_FUNC_FOPEN_GNU],\n[\n  AC_REQUIRE([gl_FUNC_FOPEN])\n  AC_CACHE_CHECK([whether fopen supports the mode character 'x'],\n    [gl_cv_func_fopen_mode_x],\n    [rm -f conftest.x\n     AC_RUN_IFELSE(\n       [AC_LANG_SOURCE([[\n#include <stdio.h>\n#include <errno.h>\nint main ()\n{\n  FILE *fp;\n  fp = fopen (\"conftest.x\", \"w\");\n  fclose (fp);\n  fp = fopen (\"conftest.x\", \"wx\");\n  if (fp != NULL)\n    /* 'x' ignored */\n    return 1;\n  else if (errno == EEXIST)\n    return 0;\n  else\n    /* 'x' rejected */\n    return 2;\n}]])],\n       [gl_cv_func_fopen_mode_x=yes],\n       [gl_cv_func_fopen_mode_x=no],\n       [case \"$host_os\" in\n          # Guess yes on glibc and musl systems.\n          linux*-gnu* | gnu* | kfreebsd*-gnu | *-musl* | midipix*)\n            gl_cv_func_fopen_mode_x=\"guessing yes\" ;;\n          # If we don't know, obey --enable-cross-guesses.\n          *)\n            gl_cv_func_fopen_mode_x=\"$gl_cross_guess_normal\" ;;\n        esac\n       ])\n     rm -f conftest.x\n    ])\n  AC_CACHE_CHECK([whether fopen supports the mode character 'e'],\n    [gl_cv_func_fopen_mode_e],\n    [echo foo > conftest.x\n     AC_RUN_IFELSE(\n       [AC_LANG_SOURCE([[\n#include <stdio.h>\n#include <errno.h>\n#include <fcntl.h>\n]GL_MDA_DEFINES[\nint main ()\n{\n  FILE *fp = fopen (\"conftest.x\", \"re\");\n  if (fp != NULL)\n    {\n      if (fcntl (fileno (fp), F_GETFD) & FD_CLOEXEC)\n        return 0;\n      else\n        /* 'e' ignored */\n        return 1;\n    }\n  else\n    /* 'e' rejected */\n    return 2;\n}]])],\n       [gl_cv_func_fopen_mode_e=yes],\n       [gl_cv_func_fopen_mode_e=no],\n       [case \"$host_os\" in\n          # Guess yes on glibc and musl systems.\n          linux*-gnu* | gnu* | kfreebsd*-gnu | *-musl* | midipix*)\n            gl_cv_func_fopen_mode_e=\"guessing yes\" ;;\n          # Guess no on native Windows.\n          mingw* | windows*)\n            gl_cv_func_fopen_mode_e=\"guessing no\" ;;\n          # If we don't know, obey --enable-cross-guesses.\n          *)\n            gl_cv_func_fopen_mode_e=\"$gl_cross_guess_normal\" ;;\n        esac\n       ])\n     rm -f conftest.x\n    ])\n  REPLACE_FOPEN_FOR_FOPEN_GNU=\"$REPLACE_FOPEN\"\n  case \"$gl_cv_func_fopen_mode_x\" in\n    *no) REPLACE_FOPEN_FOR_FOPEN_GNU=1 ;;\n  esac\n  case \"$gl_cv_func_fopen_mode_e\" in\n    *no) REPLACE_FOPEN_FOR_FOPEN_GNU=1 ;;\n  esac\n])\n\n# Prerequisites of lib/fopen.c.\nAC_DEFUN([gl_PREREQ_FOPEN], [:])\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}