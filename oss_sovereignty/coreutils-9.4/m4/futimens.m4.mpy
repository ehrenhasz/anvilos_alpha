{
  "module_name": "futimens.m4",
  "hash_id": "e809302d5b41cf0d65c62ef75b46f9a2fbf42abb2af9edb390f6d1eef35bf14f",
  "original_prompt": "Ingested from coreutils-9.4/m4/futimens.m4",
  "human_readable_source": "# serial 11\n# See if we need to provide futimens replacement.\n\ndnl Copyright (C) 2009-2023 Free Software Foundation, Inc.\ndnl This file is free software; the Free Software Foundation\ndnl gives unlimited permission to copy and/or distribute it,\ndnl with or without modifications, as long as this notice is preserved.\n\n# Written by Eric Blake.\n\nAC_DEFUN([gl_FUNC_FUTIMENS],\n[\n  AC_REQUIRE([gl_SYS_STAT_H_DEFAULTS])\n  AC_REQUIRE([AC_CANONICAL_HOST]) dnl for cross-compiles\n  AC_REQUIRE([gl_USE_SYSTEM_EXTENSIONS])\n  gl_CHECK_FUNCS_ANDROID([futimens], [[#include <sys/stat.h>]])\n  if test $ac_cv_func_futimens = no; then\n    HAVE_FUTIMENS=0\n    case \"$gl_cv_onwards_func_futimens\" in\n      future*) REPLACE_FUTIMENS=1 ;;\n    esac\n  else\n    AC_CACHE_CHECK([whether futimens works],\n      [gl_cv_func_futimens_works],\n      [AC_RUN_IFELSE([AC_LANG_PROGRAM([[\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <unistd.h>\n#include <errno.h>\n]GL_MDA_DEFINES],\n     [[struct timespec ts[2];\n      int fd = creat (\"conftest.file\", 0600);\n      struct stat st;\n      if (fd < 0) return 1;\n      ts[0].tv_sec = 1;\n      ts[0].tv_nsec = UTIME_OMIT;\n      ts[1].tv_sec = 1;\n      ts[1].tv_nsec = UTIME_NOW;\n      errno = 0;\n      if (futimens (AT_FDCWD, NULL) == 0) return 2;\n      if (errno != EBADF) return 3;\n      if (futimens (fd, ts)) return 4;\n      sleep (1);\n      ts[0].tv_nsec = UTIME_NOW;\n      ts[1].tv_nsec = UTIME_OMIT;\n      if (futimens (fd, ts)) return 5;\n      if (fstat (fd, &st)) return 6;\n      if (st.st_ctime < st.st_atime) return 7;\n      ]])],\n         [gl_cv_func_futimens_works=yes],\n         [gl_cv_func_futimens_works=no],\n         [case \"$host_os\" in\n                           # Guess no on glibc systems.\n            *-gnu* | gnu*) gl_cv_func_futimens_works=\"guessing no\" ;;\n                           # Guess no on musl systems.\n            *-musl*)       gl_cv_func_futimens_works=\"guessing no\" ;;\n                           # Guess yes otherwise.\n            *)             gl_cv_func_futimens_works=\"guessing yes\" ;;\n          esac\n         ])\n      rm -f conftest.file])\n    case \"$gl_cv_func_futimens_works\" in\n      *yes) ;;\n      *)\n        REPLACE_FUTIMENS=1\n        ;;\n    esac\n  fi\n])\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}