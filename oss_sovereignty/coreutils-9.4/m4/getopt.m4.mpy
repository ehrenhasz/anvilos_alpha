{
  "module_name": "getopt.m4",
  "hash_id": "7e0c8c3b25d2ba766daa811aaac6176cf0ce6e8efbd0ce4a27ef6b9cc3a83810",
  "original_prompt": "Ingested from coreutils-9.4/m4/getopt.m4",
  "human_readable_source": "# getopt.m4 serial 49\ndnl Copyright (C) 2002-2006, 2008-2023 Free Software Foundation, Inc.\ndnl This file is free software; the Free Software Foundation\ndnl gives unlimited permission to copy and/or distribute it,\ndnl with or without modifications, as long as this notice is preserved.\n\n# Request a POSIX compliant getopt function.\nAC_DEFUN([gl_FUNC_GETOPT_POSIX],\n[\n  m4_divert_text([DEFAULTS], [gl_getopt_required=POSIX])\n  AC_REQUIRE([gl_UNISTD_H_DEFAULTS])\n  AC_REQUIRE([gl_GETOPT_CHECK_HEADERS])\n  dnl Other modules can request the gnulib implementation of the getopt\n  dnl functions unconditionally, by defining gl_REPLACE_GETOPT_ALWAYS.\n  dnl argp.m4 does this.\n  m4_ifdef([gl_REPLACE_GETOPT_ALWAYS], [\n    REPLACE_GETOPT=1\n  ], [\n    REPLACE_GETOPT=0\n    if test -n \"$gl_replace_getopt\"; then\n      REPLACE_GETOPT=1\n    fi\n  ])\n  GL_GENERATE_GETOPT_H=false\n  GL_GENERATE_GETOPT_CDEFS_H=false\n  if test $REPLACE_GETOPT = 1; then\n    dnl Arrange for getopt.h to be created.\n    gl_GETOPT_SUBSTITUTE_HEADER\n  fi\n])\n\n# Request a POSIX compliant getopt function with GNU extensions (such as\n# options with optional arguments) and the functions getopt_long,\n# getopt_long_only.\nAC_DEFUN([gl_FUNC_GETOPT_GNU],\n[\n  dnl Set the variable gl_getopt_required, so that all invocations of\n  dnl gl_GETOPT_CHECK_HEADERS in the scope of the current configure file\n  dnl will check for getopt with GNU extensions.\n  dnl This means that if one gnulib-tool invocation requests getopt-posix\n  dnl and another gnulib-tool invocation requests getopt-gnu, it is as if\n  dnl both had requested getopt-gnu.\n  m4_divert_text([INIT_PREPARE], [gl_getopt_required=GNU])\n\n  dnl No need to invoke gl_FUNC_GETOPT_POSIX here; this is automatically\n  dnl done through the module dependency getopt-gnu -> getopt-posix.\n])\n\n# Determine whether to replace the entire getopt facility.\nAC_DEFUN([gl_GETOPT_CHECK_HEADERS],\n[\n  AC_REQUIRE([AC_CANONICAL_HOST]) dnl for cross-compiles\n  AC_REQUIRE([AC_PROG_AWK]) dnl for awk that supports ENVIRON\n\n  dnl Persuade Solaris <unistd.h> to declare optarg, optind, opterr, optopt.\n  AC_REQUIRE([AC_USE_SYSTEM_EXTENSIONS])\n\n  gl_CHECK_NEXT_HEADERS([getopt.h])\n  if test $ac_cv_header_getopt_h = yes; then\n    HAVE_GETOPT_H=1\n  else\n    HAVE_GETOPT_H=0\n  fi\n  AC_SUBST([HAVE_GETOPT_H])\n\n  gl_replace_getopt=\n\n  dnl Test whether <getopt.h> is available.\n  if test -z \"$gl_replace_getopt\" && test $gl_getopt_required = GNU; then\n    AC_CHECK_HEADERS([getopt.h], [], [gl_replace_getopt=yes])\n  fi\n\n  dnl Test whether the function getopt_long is available.\n  if test -z \"$gl_replace_getopt\" && test $gl_getopt_required = GNU; then\n    AC_CHECK_FUNCS([getopt_long_only], [], [gl_replace_getopt=yes])\n  fi\n\n  dnl POSIX 2008 does not specify leading '+' behavior, but see\n  dnl http://austingroupbugs.net/view.php?id=191 for a recommendation on\n  dnl the next version of POSIX.  For now, we only guarantee leading '+'\n  dnl behavior with getopt-gnu.\n  if test -z \"$gl_replace_getopt\"; then\n    AC_CACHE_CHECK([whether getopt is POSIX compatible],\n      [gl_cv_func_getopt_posix],\n      [\n        dnl Merging these three different test programs into a single one\n        dnl would require a reset mechanism. On BSD systems, it can be done\n        dnl through 'optreset'; on some others (glibc), it can be done by\n        dnl setting 'optind' to 0; on others again (HP-UX, IRIX, OSF/1,\n        dnl Solaris 9, musl libc), there is no such mechanism.\n        if test $cross_compiling = no; then\n          dnl Sanity check. Succeeds everywhere (except on MSVC,\n          dnl which lacks <unistd.h> and getopt() entirely).\n          AC_RUN_IFELSE(\n            [AC_LANG_SOURCE([[\n#include <unistd.h>\n#include <stdlib.h>\n#include <string.h>\n\nint\nmain ()\n{\n  static char program[] = \"program\";\n  static char a[] = \"-a\";\n  static char foo[] = \"foo\";\n  static char bar[] = \"bar\";\n  char *argv[] = { program, a, foo, bar, NULL };\n  int c;\n\n  c = getopt (4, argv, \"ab\");\n  if (!(c == 'a'))\n    return 1;\n  c = getopt (4, argv, \"ab\");\n  if (!(c == -1))\n    return 2;\n  if (!(optind == 2))\n    return 3;\n  return 0;\n}\n]])],\n            [gl_cv_func_getopt_posix=maybe],\n            [gl_cv_func_getopt_posix=no])\n          if test $gl_cv_func_getopt_posix = maybe; then\n            dnl Sanity check with '+'. Succeeds everywhere (except on MSVC,\n            dnl which lacks <unistd.h> and getopt() entirely).\n            AC_RUN_IFELSE(\n              [AC_LANG_SOURCE([[\n#include <unistd.h>\n#include <stdlib.h>\n#include <string.h>\n\nint\nmain ()\n{\n  static char program[] = \"program\";\n  static char donald[] = \"donald\";\n  static char p[] = \"-p\";\n  static char billy[] = \"billy\";\n  static char duck[] = \"duck\";\n  static char a[] = \"-a\";\n  static char bar[] = \"bar\";\n  char *argv[] = { program, donald, p, billy, duck, a, bar, NULL };\n  int c;\n\n  c = getopt (7, argv, \"+abp:q:\");\n  if (!(c == -1))\n    return 4;\n  if (!(strcmp (argv[0], \"program\") == 0))\n    return 5;\n  if (!(strcmp (argv[1], \"donald\") == 0))\n    return 6;\n  if (!(strcmp (argv[2], \"-p\") == 0))\n    return 7;\n  if (!(strcmp (argv[3], \"billy\") == 0))\n    return 8;\n  if (!(strcmp (argv[4], \"duck\") == 0))\n    return 9;\n  if (!(strcmp (argv[5], \"-a\") == 0))\n    return 10;\n  if (!(strcmp (argv[6], \"bar\") == 0))\n    return 11;\n  if (!(optind == 1))\n    return 12;\n  return 0;\n}\n]])],\n              [gl_cv_func_getopt_posix=maybe],\n              [gl_cv_func_getopt_posix=no])\n          fi\n          if test $gl_cv_func_getopt_posix = maybe; then\n            dnl Detect Mac OS X 10.5, AIX 7.1, mingw bug.\n            AC_RUN_IFELSE(\n              [AC_LANG_SOURCE([[\n#include <unistd.h>\n#include <stdlib.h>\n#include <string.h>\n\nint\nmain ()\n{\n  static char program[] = \"program\";\n  static char ab[] = \"-ab\";\n  char *argv[3] = { program, ab, NULL };\n  if (getopt (2, argv, \"ab:\") != 'a')\n    return 13;\n  if (getopt (2, argv, \"ab:\") != '?')\n    return 14;\n  if (optopt != 'b')\n    return 15;\n  if (optind != 2)\n    return 16;\n  return 0;\n}\n]])],\n              [gl_cv_func_getopt_posix=yes],\n              [gl_cv_func_getopt_posix=no])\n          fi\n        else\n          case \"$host_os\" in\n            darwin* | aix* | mingw* | windows*) gl_cv_func_getopt_posix=\"guessing no\";;\n            *)                                  gl_cv_func_getopt_posix=\"guessing yes\";;\n          esac\n        fi\n      ])\n    case \"$gl_cv_func_getopt_posix\" in\n      *no) gl_replace_getopt=yes ;;\n    esac\n  fi\n\n  if test -z \"$gl_replace_getopt\" && test $gl_getopt_required = GNU; then\n    AC_CACHE_CHECK([for working GNU getopt function], [gl_cv_func_getopt_gnu],\n      [# Even with POSIXLY_CORRECT, the GNU extension of leading '-' in the\n       # optstring is necessary for programs like m4 that have POSIX-mandated\n       # semantics for supporting options interspersed with files.\n       # Also, since getopt_long is a GNU extension, we require optind=0.\n       # Bash ties 'set -o posix' to a non-exported POSIXLY_CORRECT;\n       # so take care to revert to the correct (non-)export state.\ndnl GNU Coding Standards currently allow awk but not env; besides, env\ndnl is ambiguous with environment values that contain newlines.\n       gl_awk_probe='BEGIN { if (\"POSIXLY_CORRECT\" in ENVIRON) print \"x\" }'\n       case ${POSIXLY_CORRECT+x}`$AWK \"$gl_awk_probe\" </dev/null` in\n         xx) gl_had_POSIXLY_CORRECT=exported ;;\n         x)  gl_had_POSIXLY_CORRECT=yes      ;;\n         *)  gl_had_POSIXLY_CORRECT=         ;;\n       esac\n       POSIXLY_CORRECT=1\n       export POSIXLY_CORRECT\n       AC_RUN_IFELSE(\n        [AC_LANG_PROGRAM([[#include <getopt.h>\n                           #include <stddef.h>\n                           #include <string.h>\n           ]GL_NOCRASH[\n           ]], [[\n             int result = 0;\n\n             nocrash_init();\n\n             /* This code succeeds on glibc 2.8, OpenBSD 4.0, Cygwin, mingw,\n                and fails on Mac OS X 10.5, AIX 5.2, HP-UX 11, IRIX 6.5,\n                OSF/1 5.1, Solaris 10.  */\n             {\n               static char conftest[] = \"conftest\";\n               static char plus[] = \"-+\";\n               char *argv[3] = { conftest, plus, NULL };\n               opterr = 0;\n               if (getopt (2, argv, \"+a\") != '?')\n                 result |= 1;\n             }\n             /* This code succeeds on glibc 2.8, mingw,\n                and fails on Mac OS X 10.5, OpenBSD 4.0, AIX 5.2, HP-UX 11,\n                IRIX 6.5, OSF/1 5.1, Solaris 10, Cygwin 1.5.x.  */\n             {\n               static char program[] = \"program\";\n               static char p[] = \"-p\";\n               static char foo[] = \"foo\";\n               static char bar[] = \"bar\";\n               char *argv[] = { program, p, foo, bar, NULL };\n\n               optind = 1;\n               if (getopt (4, argv, \"p::\") != 'p')\n                 result |= 2;\n               else if (optarg != NULL)\n                 result |= 4;\n               else if (getopt (4, argv, \"p::\") != -1)\n                 result |= 6;\n               else if (optind != 2)\n                 result |= 8;\n             }\n             /* This code succeeds on glibc 2.8 and fails on Cygwin 1.7.0.  */\n             {\n               static char program[] = \"program\";\n               static char foo[] = \"foo\";\n               static char p[] = \"-p\";\n               char *argv[] = { program, foo, p, NULL };\n               optind = 0;\n               if (getopt (3, argv, \"-p\") != 1)\n                 result |= 16;\n               else if (getopt (3, argv, \"-p\") != 'p')\n                 result |= 16;\n             }\n             /* This code fails on glibc 2.11.  */\n             {\n               static char program[] = \"program\";\n               static char b[] = \"-b\";\n               static char a[] = \"-a\";\n               char *argv[] = { program, b, a, NULL };\n               optind = opterr = 0;\n               if (getopt (3, argv, \"+:a:b\") != 'b')\n                 result |= 32;\n               else if (getopt (3, argv, \"+:a:b\") != ':')\n                 result |= 32;\n             }\n             /* This code dumps core on glibc 2.14.  */\n             {\n               static char program[] = \"program\";\n               static char w[] = \"-W\";\n               static char dummy[] = \"dummy\";\n               char *argv[] = { program, w, dummy, NULL };\n               optind = opterr = 1;\n               if (getopt (3, argv, \"W;\") != 'W')\n                 result |= 64;\n             }\n             return result;\n           ]])],\n        [gl_cv_func_getopt_gnu=yes],\n        [gl_cv_func_getopt_gnu=no],\n        [dnl Cross compiling.\n         dnl Assume the worst, even on glibc platforms.\n         dnl But obey --enable-cross-guesses.\n         gl_cv_func_getopt_gnu=\"$gl_cross_guess_normal\"\n        ])\n       case $gl_had_POSIXLY_CORRECT in\n         exported) ;;\n         yes) AS_UNSET([POSIXLY_CORRECT]); POSIXLY_CORRECT=1 ;;\n         *) AS_UNSET([POSIXLY_CORRECT]) ;;\n       esac\n      ])\n    if test \"$gl_cv_func_getopt_gnu\" != yes; then\n      gl_replace_getopt=yes\n    else\n      AC_CACHE_CHECK([for working GNU getopt_long function],\n        [gl_cv_func_getopt_long_gnu],\n        [AC_RUN_IFELSE(\n           [AC_LANG_PROGRAM(\n              [[#include <getopt.h>\n                #include <stddef.h>\n                #include <string.h>\n              ]],\n              [[static const struct option long_options[] =\n                  {\n                    { \"xtremely-\",no_argument,       NULL, 1003 },\n                    { \"xtra\",     no_argument,       NULL, 1001 },\n                    { \"xtreme\",   no_argument,       NULL, 1002 },\n                    { \"xtremely\", no_argument,       NULL, 1003 },\n                    { NULL,       0,                 NULL, 0 }\n                  };\n                /* This code fails on OpenBSD 5.0.  */\n                {\n                  static char program[] = \"program\";\n                  static char xtremel[] = \"--xtremel\";\n                  char *argv[] = { program, xtremel, NULL };\n                  int option_index;\n                  optind = 1; opterr = 0;\n                  if (getopt_long (2, argv, \"\", long_options, &option_index) != 1003)\n                    return 1;\n                }\n                return 0;\n              ]])],\n           [gl_cv_func_getopt_long_gnu=yes],\n           [gl_cv_func_getopt_long_gnu=no],\n           [dnl Cross compiling. Guess no on OpenBSD, yes otherwise.\n            case \"$host_os\" in\n              openbsd*) gl_cv_func_getopt_long_gnu=\"guessing no\";;\n              *)        gl_cv_func_getopt_long_gnu=\"guessing yes\";;\n            esac\n           ])\n        ])\n      case \"$gl_cv_func_getopt_long_gnu\" in\n        *yes) ;;\n        *) gl_replace_getopt=yes ;;\n      esac\n    fi\n  fi\n])\n\nAC_DEFUN([gl_GETOPT_SUBSTITUTE_HEADER],\n[\n  AC_CHECK_HEADERS_ONCE([sys/cdefs.h])\n  if test $ac_cv_header_sys_cdefs_h = yes; then\n    HAVE_SYS_CDEFS_H=1\n  else\n    HAVE_SYS_CDEFS_H=0\n  fi\n  AC_SUBST([HAVE_SYS_CDEFS_H])\n\n  AC_DEFINE([__GETOPT_PREFIX], [[rpl_]],\n    [Define to rpl_ if the getopt replacement functions and variables\n     should be used.])\n  GL_GENERATE_GETOPT_H=true\n  GL_GENERATE_GETOPT_CDEFS_H=true\n])\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}