{
  "module_name": "isnanf.m4",
  "hash_id": "eb2ec0d558b936ff7f21abcbd712cdfafaaf32f513013b3cfb0a4605b0925db6",
  "original_prompt": "Ingested from coreutils-9.4/m4/isnanf.m4",
  "human_readable_source": "# isnanf.m4 serial 19\ndnl Copyright (C) 2007-2023 Free Software Foundation, Inc.\ndnl This file is free software; the Free Software Foundation\ndnl gives unlimited permission to copy and/or distribute it,\ndnl with or without modifications, as long as this notice is preserved.\n\ndnl Check how to get or define isnanf().\n\nAC_DEFUN([gl_FUNC_ISNANF],\n[\n  AC_REQUIRE([gl_MATH_H_DEFAULTS])\n  ISNANF_LIBM=\n  gl_HAVE_ISNANF_NO_LIBM\n  if test $gl_cv_func_isnanf_no_libm = no; then\n    gl_HAVE_ISNANF_IN_LIBM\n    if test $gl_cv_func_isnanf_in_libm = yes; then\n      ISNANF_LIBM=-lm\n    fi\n  fi\n  dnl The variable gl_func_isnanf set here is used by isnan.m4.\n  if test $gl_cv_func_isnanf_no_libm = yes \\\n     || test $gl_cv_func_isnanf_in_libm = yes; then\n    save_LIBS=\"$LIBS\"\n    LIBS=\"$LIBS $ISNANF_LIBM\"\n    gl_ISNANF_WORKS\n    LIBS=\"$save_LIBS\"\n    case \"$gl_cv_func_isnanf_works\" in\n      *yes) gl_func_isnanf=yes ;;\n      *)    gl_func_isnanf=no; ISNANF_LIBM= ;;\n    esac\n  else\n    gl_func_isnanf=no\n  fi\n  if test $gl_func_isnanf != yes; then\n    HAVE_ISNANF=0\n  fi\n  AC_SUBST([ISNANF_LIBM])\n])\n\ndnl Check how to get or define isnanf() without linking with libm.\n\nAC_DEFUN([gl_FUNC_ISNANF_NO_LIBM],\n[\n  gl_HAVE_ISNANF_NO_LIBM\n  if test $gl_cv_func_isnanf_no_libm = yes; then\n    gl_ISNANF_WORKS\n  fi\n  if test $gl_cv_func_isnanf_no_libm = yes \\\n     && { case \"$gl_cv_func_isnanf_works\" in\n            *yes) true;;\n            *) false;;\n          esac\n        }; then\n    gl_func_isnanf_no_libm=yes\n    AC_DEFINE([HAVE_ISNANF_IN_LIBC], [1],\n      [Define if the isnan(float) function is available in libc.])\n  else\n    gl_func_isnanf_no_libm=no\n  fi\n])\n\ndnl Prerequisites of replacement isnanf definition. It does not need -lm.\nAC_DEFUN([gl_PREREQ_ISNANF],\n[\n  gl_FLOAT_EXPONENT_LOCATION\n])\n\ndnl Test whether isnanf() can be used without libm.\nAC_DEFUN([gl_HAVE_ISNANF_NO_LIBM],\n[\n  AC_CACHE_CHECK([whether isnan(float) can be used without linking with libm],\n    [gl_cv_func_isnanf_no_libm],\n    [\n      AC_LINK_IFELSE(\n        [AC_LANG_PROGRAM(\n           [[#include <math.h>\n             #if (__GNUC__ >= 4) || (__clang_major__ >= 4)\n             # undef isnanf\n             # define isnanf(x) __builtin_isnan ((float)(x))\n             #elif defined isnan\n             # undef isnanf\n             # define isnanf(x) isnan ((float)(x))\n             #endif\n             float x;]],\n           [[return isnanf (x);]])],\n        [gl_cv_func_isnanf_no_libm=yes],\n        [gl_cv_func_isnanf_no_libm=no])\n    ])\n])\n\ndnl Test whether isnanf() can be used with libm.\nAC_DEFUN([gl_HAVE_ISNANF_IN_LIBM],\n[\n  AC_CACHE_CHECK([whether isnan(float) can be used with libm],\n    [gl_cv_func_isnanf_in_libm],\n    [\n      save_LIBS=\"$LIBS\"\n      LIBS=\"$LIBS -lm\"\n      AC_LINK_IFELSE(\n        [AC_LANG_PROGRAM(\n           [[#include <math.h>\n             #if (__GNUC__ >= 4) || (__clang_major__ >= 4)\n             # undef isnanf\n             # define isnanf(x) __builtin_isnan ((float)(x))\n             #elif defined isnan\n             # undef isnanf\n             # define isnanf(x) isnan ((float)(x))\n             #endif\n             float x;]],\n           [[return isnanf (x);]])],\n        [gl_cv_func_isnanf_in_libm=yes],\n        [gl_cv_func_isnanf_in_libm=no])\n      LIBS=\"$save_LIBS\"\n    ])\n])\n\ndnl Test whether isnanf() rejects Infinity (this fails on Solaris 2.5.1),\ndnl recognizes a NaN (this fails on IRIX 6.5 with cc), and recognizes a NaN\ndnl with in-memory representation 0x7fbfffff (this fails on IRIX 6.5).\nAC_DEFUN([gl_ISNANF_WORKS],\n[\n  AC_REQUIRE([AC_PROG_CC])\n  AC_REQUIRE([AC_CANONICAL_HOST]) dnl for cross-compiles\n  AC_REQUIRE([gl_FLOAT_EXPONENT_LOCATION])\n  AC_CACHE_CHECK([whether isnan(float) works], [gl_cv_func_isnanf_works],\n    [\n      AC_RUN_IFELSE(\n        [AC_LANG_SOURCE([[\n#include <math.h>\n#if (__GNUC__ >= 4) || (__clang_major__ >= 4)\n# undef isnanf\n# define isnanf(x) __builtin_isnan ((float)(x))\n#elif defined isnan\n# undef isnanf\n# define isnanf(x) isnan ((float)(x))\n#endif\n/* The Compaq (ex-DEC) C 6.4 compiler chokes on the expression 0.0 / 0.0.  */\n#ifdef __DECC\nstatic float\nNaN ()\n{\n  static float zero = 0.0f;\n  return zero / zero;\n}\n#else\n# define NaN() (0.0f / 0.0f)\n#endif\n#define NWORDS \\\n  ((sizeof (float) + sizeof (unsigned int) - 1) / sizeof (unsigned int))\ntypedef union { unsigned int word[NWORDS]; float value; } memory_float;\nint main()\n{\n  int result = 0;\n\n  if (isnanf (1.0f / 0.0f))\n    result |= 1;\n\n  if (!isnanf (NaN ()))\n    result |= 2;\n\n#if defined FLT_EXPBIT0_WORD && defined FLT_EXPBIT0_BIT\n  /* The isnanf function should be immune against changes in the sign bit and\n     in the mantissa bits.  The xor operation twiddles a bit that can only be\n     a sign bit or a mantissa bit.  */\n  if (FLT_EXPBIT0_WORD == 0 && FLT_EXPBIT0_BIT > 0)\n    {\n      memory_float m;\n\n      m.value = NaN ();\n      /* Set the bits below the exponent to 01111...111.  */\n      m.word[0] &= -1U << FLT_EXPBIT0_BIT;\n      m.word[0] |= (1U << (FLT_EXPBIT0_BIT - 1)) - 1;\n      if (!isnanf (m.value))\n        result |= 4;\n    }\n#endif\n\n  return result;\n}]])],\n        [gl_cv_func_isnanf_works=yes],\n        [gl_cv_func_isnanf_works=no],\n        [case \"$host_os\" in\n           irix* | solaris*) gl_cv_func_isnanf_works=\"guessing no\" ;;\n           mingw* | windows*) # Guess yes on mingw, no on MSVC.\n             AC_EGREP_CPP([Known], [\n#ifdef __MINGW32__\n Known\n#endif\n               ],\n               [gl_cv_func_isnanf_works=\"guessing yes\"],\n               [gl_cv_func_isnanf_works=\"guessing no\"])\n             ;;\n           *) gl_cv_func_isnanf_works=\"guessing yes\" ;;\n         esac\n        ])\n    ])\n])\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}