{
  "module_name": "lseek.m4",
  "hash_id": "157552cd0efb1cdb0ac381aeacb5624fb4ca0109dff9665327fce0b89a5b353e",
  "original_prompt": "Ingested from coreutils-9.4/m4/lseek.m4",
  "human_readable_source": "# lseek.m4 serial 15\ndnl Copyright (C) 2007, 2009-2023 Free Software Foundation, Inc.\ndnl This file is free software; the Free Software Foundation\ndnl gives unlimited permission to copy and/or distribute it,\ndnl with or without modifications, as long as this notice is preserved.\n\nAC_DEFUN([gl_FUNC_LSEEK],\n[\n  AC_REQUIRE([gl_UNISTD_H_DEFAULTS])\n\n  AC_REQUIRE([AC_CANONICAL_HOST])\n  AC_REQUIRE([AC_PROG_CC])\n  AC_CHECK_HEADERS_ONCE([unistd.h])\n  AC_CACHE_CHECK([whether lseek detects pipes], [gl_cv_func_lseek_pipe],\n    [case \"$host_os\" in\n       mingw* | windows*)\n         dnl Native Windows.\n         dnl The result of lseek (fd, (off_t)0, SEEK_CUR) or\n         dnl SetFilePointer(handle, 0, NULL, FILE_CURRENT)\n         dnl for a pipe depends on the environment:\n         dnl In a Cygwin 1.5 environment it succeeds (wrong);\n         dnl in a Cygwin 1.7 environment it fails with a wrong errno value;\n         dnl in a Cygwin 2.9.0 environment it fails correctly;\n         dnl in a Cygwin 3.4.6 environment it succeeds again (wrong).\n         gl_cv_func_lseek_pipe=no\n         ;;\n       *)\n         if test $cross_compiling = no; then\n           AC_LINK_IFELSE([AC_LANG_PROGRAM([[\n#include <sys/types.h> /* for off_t */\n#include <stdio.h> /* for SEEK_CUR */\n#if HAVE_UNISTD_H\n# include <unistd.h>\n#else /* on Windows with MSVC */\n# include <io.h>\n#endif\n]GL_MDA_DEFINES],\n[[\n  /* Exit with success only if stdin is seekable.  */\n  return lseek (0, (off_t)0, SEEK_CUR) < 0;\n]])],\n             [if test -s conftest$ac_exeext \\\n                 && ./conftest$ac_exeext < conftest.$ac_ext \\\n                 && test 1 = \"`echo hi \\\n                   | { ./conftest$ac_exeext; echo $?; cat >/dev/null; }`\"; then\n                gl_cv_func_lseek_pipe=yes\n              else\n                gl_cv_func_lseek_pipe=no\n              fi\n             ],\n             [gl_cv_func_lseek_pipe=no])\n         else\n           AC_COMPILE_IFELSE(\n             [AC_LANG_SOURCE([[\n#if defined __BEOS__\n/* BeOS mistakenly return 0 when trying to seek on pipes.  */\n  Choke me.\n#endif]])],\n             [gl_cv_func_lseek_pipe=yes], [gl_cv_func_lseek_pipe=no])\n         fi\n         ;;\n     esac\n    ])\n  if test \"$gl_cv_func_lseek_pipe\" = no; then\n    REPLACE_LSEEK=1\n    AC_DEFINE([LSEEK_PIPE_BROKEN], [1],\n      [Define to 1 if lseek does not detect pipes.])\n  fi\n\n  AC_REQUIRE([gl_SYS_TYPES_H])\n  if test $WINDOWS_64_BIT_OFF_T = 1; then\n    REPLACE_LSEEK=1\n  fi\n\n  AS_IF([test $REPLACE_LSEEK = 0],\n    [AC_CACHE_CHECK([whether SEEK_DATA works but is incompatible with GNU],\n       [gl_cv_func_lseek_works_but_incompatible],\n       [AC_PREPROC_IFELSE(\n          [AC_LANG_SOURCE(\n             dnl Use macOS \"9999\" to stand for a future fixed macOS version.\n             dnl See ../lib/unistd.in.h and <https://bugs.gnu.org/61386>.\n             [[#include <unistd.h>\n               #if defined __APPLE__ && defined __MACH__ && defined SEEK_DATA\n               # ifdef __ENVIRONMENT_MAC_OS_X_VERSION_MIN_REQUIRED__\n               #  include <AvailabilityMacros.h>\n               # endif\n               # if 99990000 <= MAC_OS_X_VERSION_MIN_REQUIRED\n               #  define LSEEK_WORKS_BUT_IS_INCOMPATIBLE_WITH_GNU\n               # endif\n               #endif\n               #ifndef LSEEK_WORKS_BUT_IS_INCOMPATIBLE_WITH_GNU\n                #error \"No need to work around the bug\"\n               #endif\n             ]])],\n          [gl_cv_func_lseek_works_but_incompatible=yes],\n          [gl_cv_func_lseek_works_but_incompatible=no])])\n     if test \"$gl_cv_func_lseek_works_but_incompatible\" = yes; then\n       REPLACE_LSEEK=1\n     fi])\n])\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}