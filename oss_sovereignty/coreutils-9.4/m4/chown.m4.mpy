{
  "module_name": "chown.m4",
  "hash_id": "927bd05a580fb55acc826f24641dc23bfb652debe76dc1990051eafdcbd1c628",
  "original_prompt": "Ingested from coreutils-9.4/m4/chown.m4",
  "human_readable_source": "# serial 36\n# Determine whether we need the chown wrapper.\n\ndnl Copyright (C) 1997-2001, 2003-2005, 2007, 2009-2023 Free Software\ndnl Foundation, Inc.\n\ndnl This file is free software; the Free Software Foundation\ndnl gives unlimited permission to copy and/or distribute it,\ndnl with or without modifications, as long as this notice is preserved.\n\n# chown should accept arguments of -1 for uid and gid, and it should\n# dereference symlinks.  If it doesn't, arrange to use the replacement\n# function.\n\n# From Jim Meyering.\n\n# This is taken from the following Autoconf patch:\n# https://git.savannah.gnu.org/gitweb/?p=autoconf.git;a=commitdiff;h=7fbb553727ed7e0e689a17594b58559ecf3ea6e9\nAC_DEFUN([AC_FUNC_CHOWN],\n[\n  AC_REQUIRE([AC_TYPE_UID_T])dnl\n  AC_REQUIRE([AC_CANONICAL_HOST])dnl for cross-compiles\n  AC_CHECK_HEADERS([unistd.h])\n  AC_CACHE_CHECK([for working chown],\n    [ac_cv_func_chown_works],\n    [AC_RUN_IFELSE(\n       [AC_LANG_PROGRAM(\n          [AC_INCLUDES_DEFAULT\n           [#include <fcntl.h>\n          ]GL_MDA_DEFINES],\n          [[\n            char *f = \"conftest.chown\";\n            struct stat before, after;\n\n            if (creat (f, 0600) < 0)\n              return 1;\n            if (stat (f, &before) < 0)\n              return 1;\n            if (chown (f, (uid_t) -1, (gid_t) -1) == -1)\n              return 1;\n            if (stat (f, &after) < 0)\n              return 1;\n            return ! (before.st_uid == after.st_uid && before.st_gid == after.st_gid);\n          ]])\n       ],\n       [ac_cv_func_chown_works=yes],\n       [ac_cv_func_chown_works=no],\n       [case \"$host_os\" in # ((\n                             # Guess yes on Linux systems.\n          linux-* | linux)   ac_cv_func_chown_works=\"guessing yes\" ;;\n                             # Guess yes on glibc systems.\n          *-gnu* | gnu*)     ac_cv_func_chown_works=\"guessing yes\" ;;\n                             # Guess no on native Windows.\n          mingw* | windows*) ac_cv_func_chown_works=\"guessing no\" ;;\n                             # If we don't know, obey --enable-cross-guesses.\n          *)                 ac_cv_func_chown_works=\"$gl_cross_guess_normal\" ;;\n        esac\n       ])\n     rm -f conftest.chown\n    ])\n  case \"$ac_cv_func_chown_works\" in\n    *yes)\n      AC_DEFINE([HAVE_CHOWN], [1],\n        [Define to 1 if your system has a working `chown' function.])\n      ;;\n  esac\n])# AC_FUNC_CHOWN\n\nAC_DEFUN_ONCE([gl_FUNC_CHOWN],\n[\n  AC_REQUIRE([gl_UNISTD_H_DEFAULTS])\n  AC_REQUIRE([AC_TYPE_UID_T])\n  AC_REQUIRE([AC_FUNC_CHOWN])\n  AC_REQUIRE([gl_FUNC_CHOWN_FOLLOWS_SYMLINK])\n  AC_REQUIRE([AC_CANONICAL_HOST]) dnl for cross-compiles\n  AC_CHECK_FUNCS_ONCE([chown fchown])\n\n  dnl mingw lacks chown altogether.\n  if test $ac_cv_func_chown = no; then\n    HAVE_CHOWN=0\n  else\n    dnl Some old systems treated chown like lchown.\n    case \"$gl_cv_func_chown_follows_symlink\" in\n      *yes) ;;\n      *) REPLACE_CHOWN=1 ;;\n    esac\n\n    dnl Some old systems tried to use uid/gid -1 literally.\n    case \"$ac_cv_func_chown_works\" in\n      *no)\n        AC_DEFINE([CHOWN_FAILS_TO_HONOR_ID_OF_NEGATIVE_ONE], [1],\n          [Define if chown is not POSIX compliant regarding IDs of -1.])\n        REPLACE_CHOWN=1\n        ;;\n    esac\n\n    dnl Solaris 9 ignores trailing slash.\n    dnl FreeBSD 7.2 mishandles trailing slash on symlinks.\n    dnl Likewise for AIX 7.1.\n    AC_CACHE_CHECK([whether chown honors trailing slash],\n      [gl_cv_func_chown_slash_works],\n      [touch conftest.file && rm -f conftest.link\n       AC_RUN_IFELSE([AC_LANG_PROGRAM([[\n#include <unistd.h>\n#include <stdlib.h>\n#include <errno.h>\n]GL_MDA_DEFINES],\n        [[if (symlink (\"conftest.file\", \"conftest.link\")) return 1;\n          if (chown (\"conftest.link/\", getuid (), getgid ()) == 0) return 2;\n        ]])],\n        [gl_cv_func_chown_slash_works=yes],\n        [gl_cv_func_chown_slash_works=no],\n        [case \"$host_os\" in\n                    # Guess yes on glibc systems.\n           *-gnu*)  gl_cv_func_chown_slash_works=\"guessing yes\" ;;\n                    # Guess yes on musl systems.\n           *-musl*) gl_cv_func_chown_slash_works=\"guessing yes\" ;;\n                    # If we don't know, obey --enable-cross-guesses.\n           *)       gl_cv_func_chown_slash_works=\"$gl_cross_guess_normal\" ;;\n         esac\n        ])\n      rm -f conftest.link conftest.file])\n    case \"$gl_cv_func_chown_slash_works\" in\n      *yes) ;;\n      *)\n        AC_DEFINE([CHOWN_TRAILING_SLASH_BUG], [1],\n          [Define to 1 if chown mishandles trailing slash.])\n        REPLACE_CHOWN=1\n        ;;\n    esac\n\n    dnl OpenBSD fails to update ctime if ownership does not change.\n    AC_CACHE_CHECK([whether chown always updates ctime],\n      [gl_cv_func_chown_ctime_works],\n      [AC_RUN_IFELSE([AC_LANG_PROGRAM([[\n#include <unistd.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n]GL_MDA_DEFINES],\n        [[struct stat st1, st2;\n          if (close (creat (\"conftest.file\", 0600))) return 1;\n          if (stat (\"conftest.file\", &st1)) return 2;\n          sleep (1);\n          if (chown (\"conftest.file\", st1.st_uid, st1.st_gid)) return 3;\n          if (stat (\"conftest.file\", &st2)) return 4;\n          if (st2.st_ctime <= st1.st_ctime) return 5;\n        ]])],\n        [gl_cv_func_chown_ctime_works=yes],\n        [gl_cv_func_chown_ctime_works=no],\n        [case \"$host_os\" in\n                    # Guess yes on glibc systems.\n           *-gnu*)  gl_cv_func_chown_ctime_works=\"guessing yes\" ;;\n                    # Guess yes on musl systems.\n           *-musl*) gl_cv_func_chown_ctime_works=\"guessing yes\" ;;\n                    # If we don't know, obey --enable-cross-guesses.\n           *)       gl_cv_func_chown_ctime_works=\"$gl_cross_guess_normal\" ;;\n         esac\n        ])\n      rm -f conftest.file])\n    case \"$gl_cv_func_chown_ctime_works\" in\n      *yes) ;;\n      *)\n        AC_DEFINE([CHOWN_CHANGE_TIME_BUG], [1], [Define to 1 if chown fails\n          to change ctime when at least one argument was not -1.])\n        REPLACE_CHOWN=1\n        ;;\n    esac\n  fi\n])\n\n# Determine whether chown follows symlinks (it should).\nAC_DEFUN_ONCE([gl_FUNC_CHOWN_FOLLOWS_SYMLINK],\n[\n  AC_CACHE_CHECK(\n    [whether chown dereferences symlinks],\n    [gl_cv_func_chown_follows_symlink],\n    [\n      AC_RUN_IFELSE([AC_LANG_SOURCE([[\n#include <unistd.h>\n#include <stdlib.h>\n#include <errno.h>\n]GL_MDA_DEFINES[\n        int\n        main ()\n        {\n          int result = 0;\n          char const *dangling_symlink = \"conftest.dangle\";\n\n          unlink (dangling_symlink);\n          if (symlink (\"conftest.no-such\", dangling_symlink))\n            abort ();\n\n          /* Exit successfully on a conforming system,\n             i.e., where chown must fail with ENOENT.  */\n          if (chown (dangling_symlink, getuid (), getgid ()) == 0)\n            result |= 1;\n          if (errno != ENOENT)\n            result |= 2;\n          return result;\n        }\n        ]])],\n        [gl_cv_func_chown_follows_symlink=yes],\n        [gl_cv_func_chown_follows_symlink=no],\n        [gl_cv_func_chown_follows_symlink=\"guessing yes\"]\n      )\n    ]\n  )\n\n  case \"$gl_cv_func_chown_follows_symlink\" in\n    *yes) ;;\n    *)\n      AC_DEFINE([CHOWN_MODIFIES_SYMLINK], [1],\n        [Define if chown modifies symlinks.])\n      ;;\n  esac\n])\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}