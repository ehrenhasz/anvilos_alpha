{
  "module_name": "utimensat.m4",
  "hash_id": "d471e463d6524c318a31de624cd551a5cb537667cd980fea73f7212c1ba7bdcc",
  "original_prompt": "Ingested from coreutils-9.4/m4/utimensat.m4",
  "human_readable_source": "# serial 11\n# See if we need to provide utimensat replacement.\n\ndnl Copyright (C) 2009-2023 Free Software Foundation, Inc.\ndnl This file is free software; the Free Software Foundation\ndnl gives unlimited permission to copy and/or distribute it,\ndnl with or without modifications, as long as this notice is preserved.\n\n# Written by Eric Blake.\n\nAC_DEFUN([gl_FUNC_UTIMENSAT],\n[\n  AC_REQUIRE([gl_SYS_STAT_H_DEFAULTS])\n  AC_REQUIRE([gl_USE_SYSTEM_EXTENSIONS])\n  AC_REQUIRE([AC_CANONICAL_HOST]) dnl for cross-compiles\n  gl_CHECK_FUNCS_ANDROID([utimensat], [[#include <sys/stat.h>]])\n  if test $ac_cv_func_utimensat = no; then\n    HAVE_UTIMENSAT=0\n    case \"$gl_cv_onwards_func_utimensat\" in\n      future*) REPLACE_UTIMENSAT=1 ;;\n    esac\n  else\n    AC_CACHE_CHECK([whether utimensat works],\n      [gl_cv_func_utimensat_works],\n      [AC_RUN_IFELSE(\n         [AC_LANG_PROGRAM([[\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <unistd.h>\n]GL_MDA_DEFINES],\n            [[int result = 0;\n              const char *f = \"conftest.file\";\n              if (close (creat (f, 0600)))\n                return 1;\n              /* Test whether a trailing slash is handled correctly.\n                 This fails on AIX 7.2.  */\n              {\n                struct timespec ts[2];\n                ts[0].tv_sec = 345183300; ts[0].tv_nsec = 0;\n                ts[1] = ts[0];\n                if (utimensat (AT_FDCWD, \"conftest.file/\", ts, 0) == 0)\n                  result |= 2;\n              }\n              /* Test whether the AT_SYMLINK_NOFOLLOW flag is supported.  */\n              {\n                if (utimensat (AT_FDCWD, f, NULL, AT_SYMLINK_NOFOLLOW))\n                  result |= 4;\n              }\n              /* Test whether UTIME_NOW and UTIME_OMIT work.  */\n              {\n                struct timespec ts[2];\n                ts[0].tv_sec = 1;\n                ts[0].tv_nsec = UTIME_OMIT;\n                ts[1].tv_sec = 1;\n                ts[1].tv_nsec = UTIME_NOW;\n                if (utimensat (AT_FDCWD, f, ts, 0))\n                  result |= 8;\n              }\n              sleep (1);\n              {\n                struct stat st;\n                struct timespec ts[2];\n                ts[0].tv_sec = 1;\n                ts[0].tv_nsec = UTIME_NOW;\n                ts[1].tv_sec = 1;\n                ts[1].tv_nsec = UTIME_OMIT;\n                if (utimensat (AT_FDCWD, f, ts, 0))\n                  result |= 16;\n                if (stat (f, &st))\n                  result |= 32;\n                else if (st.st_ctime < st.st_atime)\n                  result |= 64;\n              }\n              return result;\n            ]])],\n         [gl_cv_func_utimensat_works=yes],\n         [case $? in\n            2) gl_cv_func_utimensat_works='nearly' ;;\n            *) gl_cv_func_utimensat_works=no ;;\n          esac\n         ],\n         [case \"$host_os\" in\n            # Guess yes on Linux or glibc systems.\n            linux-* | linux | *-gnu* | gnu*)\n              gl_cv_func_utimensat_works=\"guessing yes\" ;;\n            # Guess 'nearly' on AIX.\n            aix*)\n              gl_cv_func_utimensat_works=\"guessing nearly\" ;;\n            # If we don't know, obey --enable-cross-guesses.\n            *)\n              gl_cv_func_utimensat_works=\"$gl_cross_guess_normal\" ;;\n          esac\n         ])\n      ])\n    case \"$gl_cv_func_utimensat_works\" in\n      *yes)\n        ;;\n      *nearly)\n        AC_DEFINE([HAVE_NEARLY_WORKING_UTIMENSAT], [1],\n          [Define to 1 if utimensat works, except for the trailing slash handling.])\n        REPLACE_UTIMENSAT=1\n        ;;\n      *)\n        REPLACE_UTIMENSAT=1\n        ;;\n    esac\n  fi\n])\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}