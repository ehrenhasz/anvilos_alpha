{
  "module_name": "getline.m4",
  "hash_id": "3552f124fec87876e8278ba16088addbdad3253a0de988afb438fa452246bfef",
  "original_prompt": "Ingested from coreutils-9.4/m4/getline.m4",
  "human_readable_source": "# getline.m4 serial 33\n\ndnl Copyright (C) 1998-2003, 2005-2007, 2009-2023 Free Software Foundation,\ndnl Inc.\ndnl\ndnl This file is free software; the Free Software Foundation\ndnl gives unlimited permission to copy and/or distribute it,\ndnl with or without modifications, as long as this notice is preserved.\n\nAC_PREREQ([2.59])\n\ndnl See if there's a working, system-supplied version of the getline function.\ndnl We can't just do AC_REPLACE_FUNCS([getline]) because some systems\ndnl have a function by that name in -linet that doesn't have anything\ndnl to do with the function we need.\nAC_DEFUN([gl_FUNC_GETLINE],\n[\n  AC_REQUIRE([gl_STDIO_H_DEFAULTS])\n  AC_REQUIRE([AC_CANONICAL_HOST]) dnl for cross-compiles\n\n  dnl Persuade glibc <stdio.h> to declare getline().\n  AC_REQUIRE([AC_USE_SYSTEM_EXTENSIONS])\n\n  AC_CHECK_DECLS_ONCE([getline])\n\n  gl_CHECK_FUNCS_ANDROID([getline], [[#include <stdio.h>]])\n  if test $ac_cv_func_getline = yes; then\n    dnl Found it in some library.  Verify that it works.\n    AC_CACHE_CHECK([for working getline function],\n      [am_cv_func_working_getline],\n      [echo fooNbarN | tr -d '\\012' | tr N '\\012' > conftest.data\n       AC_RUN_IFELSE([AC_LANG_SOURCE([[\n#    include <stdio.h>\n#    include <stdlib.h>\n#    include <string.h>\n    int main ()\n    {\n      FILE *in = fopen (\"./conftest.data\", \"r\");\n      if (!in)\n        return 1;\n      {\n        /* Test result for a NULL buffer and a zero size.\n           Based on a test program from Karl Heuer.  */\n        char *line = NULL;\n        size_t siz = 0;\n        int len = getline (&line, &siz, in);\n        if (!(len == 4 && line && strcmp (line, \"foo\\n\") == 0))\n          { free (line); fclose (in); return 2; }\n        free (line);\n      }\n      {\n        /* Test result for a NULL buffer and a non-zero size.\n           This crashes on FreeBSD 8.0.  */\n        char *line = NULL;\n        size_t siz = (size_t)(~0) / 4;\n        if (getline (&line, &siz, in) == -1)\n          { fclose (in); return 3; }\n        free (line);\n      }\n      fclose (in);\n      return 0;\n    }\n    ]])],\n         [am_cv_func_working_getline=yes],\n         [am_cv_func_working_getline=no],\n         [dnl We're cross compiling.\n          dnl Guess it works on glibc2 systems and musl systems.\n          AC_EGREP_CPP([Lucky GNU user],\n            [\n#include <features.h>\n#ifdef __GNU_LIBRARY__\n #if (__GLIBC__ >= 2) && !defined __UCLIBC__\n  Lucky GNU user\n #endif\n#endif\n            ],\n            [am_cv_func_working_getline=\"guessing yes\"],\n            [case \"$host_os\" in\n               *-musl* | midipix*) am_cv_func_working_getline=\"guessing yes\" ;;\n               *)                  am_cv_func_working_getline=\"$gl_cross_guess_normal\" ;;\n             esac\n            ])\n         ])\n      ])\n  else\n    am_cv_func_working_getline=no\n    case \"$gl_cv_onwards_func_getline\" in\n      future*) REPLACE_GETLINE=1 ;;\n    esac\n  fi\n\n  if test $ac_cv_have_decl_getline = no; then\n    HAVE_DECL_GETLINE=0\n  fi\n\n  case \"$am_cv_func_working_getline\" in\n    *yes) ;;\n    *)\n      dnl Set REPLACE_GETLINE always: Even if we have not found the broken\n      dnl getline function among $LIBS, it may exist in libinet and the\n      dnl executable may be linked with -linet.\n      REPLACE_GETLINE=1\n      ;;\n  esac\n])\n\n# Prerequisites of lib/getline.c.\nAC_DEFUN([gl_PREREQ_GETLINE],\n[\n  :\n])\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}