{
  "module_name": "vasnprintf.m4",
  "hash_id": "86633fe30a3413e8d594f4b697445dc60f95112324d7611727f2109e89cf45fc",
  "original_prompt": "Ingested from coreutils-9.4/m4/vasnprintf.m4",
  "human_readable_source": "# vasnprintf.m4 serial 50\ndnl Copyright (C) 2002-2004, 2006-2023 Free Software Foundation, Inc.\ndnl This file is free software; the Free Software Foundation\ndnl gives unlimited permission to copy and/or distribute it,\ndnl with or without modifications, as long as this notice is preserved.\n\nAC_DEFUN([gl_FUNC_VASNPRINTF],\n[\n  AC_CHECK_FUNCS_ONCE([vasnprintf])\n  if test $ac_cv_func_vasnprintf = no; then\n    gl_REPLACE_VASNPRINTF\n  fi\n])\n\nAC_DEFUN([gl_REPLACE_VASNPRINTF],\n[\n  AC_CHECK_FUNCS_ONCE([vasnprintf])\n  AC_LIBOBJ([vasnprintf])\n  AC_LIBOBJ([printf-args])\n  AC_LIBOBJ([printf-parse])\n  AC_LIBOBJ([asnprintf])\n  if test $ac_cv_func_vasnprintf = yes; then\n    AC_DEFINE([REPLACE_VASNPRINTF], [1],\n      [Define if vasnprintf exists but is overridden by gnulib.])\n  fi\n  gl_PREREQ_PRINTF_ARGS\n  gl_PREREQ_PRINTF_PARSE\n  gl_PREREQ_VASNPRINTF\n  gl_PREREQ_ASNPRINTF\n])\n\nAC_DEFUN([gl_FUNC_VASNWPRINTF],\n[\n  AC_LIBOBJ([printf-args])\n  gl_PREREQ_PRINTF_ARGS\n  gl_PREREQ_PRINTF_PARSE\n  gl_PREREQ_VASNWPRINTF\n  gl_PREREQ_ASNPRINTF\n])\n\n# Prerequisites of lib/printf-args.h, lib/printf-args.c.\nAC_DEFUN([gl_PREREQ_PRINTF_ARGS],\n[\n  AC_REQUIRE([gt_TYPE_WCHAR_T])\n  AC_REQUIRE([gt_TYPE_WINT_T])\n])\n\n# Prerequisites of lib/printf-parse.h, lib/printf-parse.c.\n# Prerequisites of lib/wprintf-parse.h, lib/wprintf-parse.c.\nAC_DEFUN([gl_PREREQ_PRINTF_PARSE],\n[\n  AC_REQUIRE([gl_FEATURES_H])\n  AC_REQUIRE([gt_TYPE_WCHAR_T])\n  AC_REQUIRE([gt_TYPE_WINT_T])\n  AC_REQUIRE([AC_TYPE_SIZE_T])\n  AC_CHECK_TYPE([ptrdiff_t], ,\n    [AC_DEFINE([ptrdiff_t], [long],\n       [Define as the type of the result of subtracting two pointers, if the system doesn't define it.])\n    ])\n  AC_REQUIRE([gt_AC_TYPE_INTMAX_T])\n])\n\n# Prerequisites of lib/vasnprintf.c if !WIDE_CHAR_VERSION.\nAC_DEFUN_ONCE([gl_PREREQ_VASNPRINTF],\n[\n  AC_CHECK_FUNCS([snprintf strnlen wcrtomb])\n  dnl Use the _snprintf function only if it is declared (because on NetBSD it\n  dnl is defined as a weak alias of snprintf; we prefer to use the latter).\n  AC_CHECK_DECLS([_snprintf], , , [[#include <stdio.h>]])\n  dnl We can avoid a lot of code by assuming that snprintf's return value\n  dnl conforms to ISO C99. So check that.\n  AC_REQUIRE([gl_SNPRINTF_RETVAL_C99])\n  case \"$gl_cv_func_snprintf_retval_c99\" in\n    *yes)\n      AC_DEFINE([HAVE_SNPRINTF_RETVAL_C99], [1],\n        [Define if the return value of the snprintf function is the number of\n         of bytes (excluding the terminating NUL) that would have been produced\n         if the buffer had been large enough.])\n      ;;\n  esac\n  dnl Additionally, the use of %n can be eliminated by assuming that snprintf\n  dnl always produces NUL-terminated strings (no truncation).\n  AC_REQUIRE([gl_SNPRINTF_TRUNCATION_C99])\n  case \"$gl_cv_func_snprintf_truncation_c99\" in\n    *yes)\n      AC_DEFINE([HAVE_SNPRINTF_TRUNCATION_C99], [1],\n        [Define if the string produced by the snprintf function is always NUL\n         terminated.])\n      ;;\n  esac\n  gl_PREREQ_VASNXPRINTF\n])\n\n# Prerequisites of lib/vasnwprintf.c.\nAC_DEFUN_ONCE([gl_PREREQ_VASNWPRINTF],\n[\n  AC_CHECK_FUNCS_ONCE([swprintf wcsnlen mbrtowc])\n  AC_CHECK_DECLS([_snwprintf], , , [[#include <stdio.h>]])\n  AC_CHECK_DECLS([wcsnlen], , , [[#include <wchar.h>]])\n  gl_SWPRINTF_WORKS\n  case \"$gl_cv_func_swprintf_works\" in\n    *yes)\n      AC_DEFINE([HAVE_WORKING_SWPRINTF], [1],\n        [Define if the swprintf function works correctly when it produces output\n         that contains null wide characters.])\n      ;;\n  esac\n  gl_MBRTOWC_C_LOCALE\n  case \"$gl_cv_func_mbrtowc_C_locale_sans_EILSEQ\" in\n    *yes)\n      AC_CACHE_CHECK([whether swprintf in the C locale is free of encoding errors],\n        [gl_cv_func_swprintf_C_locale_sans_EILSEQ],\n        [\n          AC_RUN_IFELSE(\n            [AC_LANG_SOURCE([[\n#ifndef __USE_MINGW_ANSI_STDIO\n# define __USE_MINGW_ANSI_STDIO 1\n#endif\n#include <stdio.h>\n#include <wchar.h>\nint main()\n{\n  int result = 0;\n  { /* This test fails on glibc 2.35, musl libc 1.2.4, FreeBSD 13.2, NetBSD 9.3,\n       OpenBSD 7.2, Cygwin 2.9.0.\n       Reported at <https://www.openwall.com/lists/musl/2023/06/12/2>.  */\n    wchar_t buf[12];\n    int ret = swprintf (buf, 12, L\"%c\", '\\377');\n    if (ret < 0)\n      result |= 1;\n  }\n  return result;\n}]])],\n            [gl_cv_func_swprintf_C_locale_sans_EILSEQ=yes],\n            [gl_cv_func_swprintf_C_locale_sans_EILSEQ=no],\n            [case \"$host_os\" in\n                                   # Guess no on glibc systems.\n               *-gnu* | gnu*)      gl_cv_func_swprintf_C_locale_sans_EILSEQ=\"guessing yes\";;\n                                   # Guess no on musl systems.\n               *-musl* | midipix*) gl_cv_func_swprintf_C_locale_sans_EILSEQ=\"guessing no\";;\n                                   # If we don't know, obey --enable-cross-guesses.\n               *)                  gl_cv_func_swprintf_C_locale_sans_EILSEQ=\"$gl_cross_guess_normal\";;\n             esac\n            ])\n        ])\n      ;;\n  esac\n  if case \"$gl_cv_func_mbrtowc_C_locale_sans_EILSEQ\" in\n       *yes) false ;;\n       *) true ;;\n     esac \\\n     || case \"$gl_cv_func_swprintf_C_locale_sans_EILSEQ\" in\n          *yes) false ;;\n          *) true ;;\n        esac; then\n    AC_DEFINE([NEED_WPRINTF_DIRECTIVE_C], [1],\n      [Define if the vasnwprintf implementation needs special code for\n       the 'c' directive.])\n  fi\n  gl_SWPRINTF_DIRECTIVE_LA\n  case \"$gl_cv_func_swprintf_directive_la\" in\n    *yes) ;;\n    *)\n      AC_DEFINE([NEED_WPRINTF_DIRECTIVE_LA], [1],\n        [Define if the vasnwprintf implementation needs special code for\n         the 'a' directive with 'long double' arguments.])\n      ;;\n  esac\n  gl_SWPRINTF_DIRECTIVE_LC\n  case \"$gl_cv_func_swprintf_directive_lc\" in\n    *yes) ;;\n    *)\n      AC_DEFINE([NEED_WPRINTF_DIRECTIVE_LC], [1],\n        [Define if the vasnwprintf implementation needs special code for\n         the 'lc' directive.])\n      ;;\n  esac\n  gl_MUSL_LIBC\n  gl_PREREQ_VASNXPRINTF\n])\n\n# Common prerequisites of lib/vasnprintf.c and lib/vasnwprintf.c.\nAC_DEFUN_ONCE([gl_PREREQ_VASNXPRINTF],\n[\n  AC_REQUIRE([AC_FUNC_ALLOCA])\n  AC_REQUIRE([gt_TYPE_WCHAR_T])\n  AC_REQUIRE([gt_TYPE_WINT_T])\n  AC_CHECK_FUNCS([wcslen])\n  dnl Knowing DBL_EXPBIT0_WORD and DBL_EXPBIT0_BIT enables an optimization\n  dnl in the code for NEED_PRINTF_LONG_DOUBLE || NEED_PRINTF_DOUBLE.\n  AC_REQUIRE([gl_DOUBLE_EXPONENT_LOCATION])\n])\n\n# Extra prerequisites of lib/vasnprintf.c for supporting 'long double'\n# arguments.\nAC_DEFUN_ONCE([gl_PREREQ_VASNPRINTF_LONG_DOUBLE],\n[\n  AC_REQUIRE([gl_PRINTF_LONG_DOUBLE])\n  case \"$gl_cv_func_printf_long_double\" in\n    *yes)\n      ;;\n    *)\n      AC_DEFINE([NEED_PRINTF_LONG_DOUBLE], [1],\n        [Define if the vasnprintf implementation needs special code for\n         'long double' arguments.])\n      ;;\n  esac\n])\n\n# Extra prerequisites of lib/vasnprintf.c for supporting infinite 'double'\n# arguments.\nAC_DEFUN([gl_PREREQ_VASNPRINTF_INFINITE_DOUBLE],\n[\n  AC_REQUIRE([gl_PRINTF_INFINITE])\n  case \"$gl_cv_func_printf_infinite\" in\n    *yes)\n      ;;\n    *)\n      AC_DEFINE([NEED_PRINTF_INFINITE_DOUBLE], [1],\n        [Define if the vasnprintf implementation needs special code for\n         infinite 'double' arguments.])\n      ;;\n  esac\n])\n\n# Extra prerequisites of lib/vasnprintf.c for supporting infinite 'long double'\n# arguments.\nAC_DEFUN([gl_PREREQ_VASNPRINTF_INFINITE_LONG_DOUBLE],\n[\n  AC_REQUIRE([gl_PRINTF_INFINITE_LONG_DOUBLE])\n  dnl There is no need to set NEED_PRINTF_INFINITE_LONG_DOUBLE if\n  dnl NEED_PRINTF_LONG_DOUBLE is already set.\n  AC_REQUIRE([gl_PREREQ_VASNPRINTF_LONG_DOUBLE])\n  case \"$gl_cv_func_printf_long_double\" in\n    *yes)\n      case \"$gl_cv_func_printf_infinite_long_double\" in\n        *yes)\n          ;;\n        *)\n          AC_DEFINE([NEED_PRINTF_INFINITE_LONG_DOUBLE], [1],\n            [Define if the vasnprintf implementation needs special code for\n             infinite 'long double' arguments.])\n          ;;\n      esac\n      ;;\n  esac\n])\n\n# Extra prerequisites of lib/vasnprintf.c for supporting the 'a' directive.\nAC_DEFUN([gl_PREREQ_VASNPRINTF_DIRECTIVE_A],\n[\n  AC_REQUIRE([gl_PRINTF_DIRECTIVE_A])\n  case \"$gl_cv_func_printf_directive_a\" in\n    *yes)\n      ;;\n    *)\n      AC_DEFINE([NEED_PRINTF_DIRECTIVE_A], [1],\n        [Define if the vasnprintf implementation needs special code for\n         the 'a' and 'A' directives.])\n      gl_CHECK_FUNCS_ANDROID([nl_langinfo], [[#include <langinfo.h>]])\n      ;;\n  esac\n])\n\n# Extra prerequisites of lib/vasnprintf.c for supporting the 'b' directive.\nAC_DEFUN([gl_PREREQ_VASNPRINTF_DIRECTIVE_B],\n[\n  AC_REQUIRE([gl_PRINTF_DIRECTIVE_B])\n  case \"$gl_cv_func_printf_directive_b\" in\n    *yes)\n      ;;\n    *)\n      AC_DEFINE([NEED_PRINTF_DIRECTIVE_B], [1],\n        [Define if the vasnprintf implementation needs special code for\n         the 'b' directive.])\n      ;;\n  esac\n])\n\n# Extra prerequisites of lib/vasnprintf.c for supporting the 'F' directive.\nAC_DEFUN([gl_PREREQ_VASNPRINTF_DIRECTIVE_F],\n[\n  AC_REQUIRE([gl_PRINTF_DIRECTIVE_F])\n  case \"$gl_cv_func_printf_directive_f\" in\n    *yes)\n      ;;\n    *)\n      AC_DEFINE([NEED_PRINTF_DIRECTIVE_F], [1],\n        [Define if the vasnprintf implementation needs special code for\n         the 'F' directive.])\n      ;;\n  esac\n])\n\n# Extra prerequisites of lib/vasnprintf.c for supporting the 'ls' directive.\nAC_DEFUN([gl_PREREQ_VASNPRINTF_DIRECTIVE_LS],\n[\n  AC_REQUIRE([gl_PRINTF_DIRECTIVE_LS])\n  case \"$gl_cv_func_printf_directive_ls\" in\n    *yes)\n      ;;\n    *)\n      AC_DEFINE([NEED_PRINTF_DIRECTIVE_LS], [1],\n        [Define if the vasnprintf implementation needs special code for\n         the 'ls' directive.])\n      ;;\n  esac\n])\n\n# Extra prerequisites of lib/vasnprintf.c for supporting the 'lc' directive.\nAC_DEFUN([gl_PREREQ_VASNPRINTF_DIRECTIVE_LC],\n[\n  AC_REQUIRE([gl_PRINTF_DIRECTIVE_LC])\n  case \"$gl_cv_func_printf_directive_lc\" in\n    *yes)\n      ;;\n    *)\n      AC_DEFINE([NEED_PRINTF_DIRECTIVE_LC], [1],\n        [Define if the vasnprintf implementation needs special code for\n         the 'lc' directive.])\n      ;;\n  esac\n])\n\n# Extra prerequisites of lib/vasnprintf.c for supporting the ' flag.\nAC_DEFUN([gl_PREREQ_VASNPRINTF_FLAG_GROUPING],\n[\n  AC_REQUIRE([gl_PRINTF_FLAG_GROUPING])\n  case \"$gl_cv_func_printf_flag_grouping\" in\n    *yes)\n      ;;\n    *)\n      AC_DEFINE([NEED_PRINTF_FLAG_GROUPING], [1],\n        [Define if the vasnprintf implementation needs special code for the\n         ' flag.])\n      ;;\n  esac\n])\n\n# Extra prerequisites of lib/vasnprintf.c for supporting the '-' flag.\nAC_DEFUN([gl_PREREQ_VASNPRINTF_FLAG_LEFTADJUST],\n[\n  AC_REQUIRE([gl_PRINTF_FLAG_LEFTADJUST])\n  case \"$gl_cv_func_printf_flag_leftadjust\" in\n    *yes)\n      ;;\n    *)\n      AC_DEFINE([NEED_PRINTF_FLAG_LEFTADJUST], [1],\n        [Define if the vasnprintf implementation needs special code for the\n         '-' flag.])\n      ;;\n  esac\n])\n\n# Extra prerequisites of lib/vasnprintf.c for supporting the 0 flag.\nAC_DEFUN([gl_PREREQ_VASNPRINTF_FLAG_ZERO],\n[\n  AC_REQUIRE([gl_PRINTF_FLAG_ZERO])\n  case \"$gl_cv_func_printf_flag_zero\" in\n    *yes)\n      ;;\n    *)\n      AC_DEFINE([NEED_PRINTF_FLAG_ZERO], [1],\n        [Define if the vasnprintf implementation needs special code for the\n         0 flag.])\n      ;;\n  esac\n])\n\n# Extra prerequisites of lib/vasnprintf.c for supporting large precisions.\nAC_DEFUN([gl_PREREQ_VASNPRINTF_PRECISION],\n[\n  AC_REQUIRE([gl_PRINTF_PRECISION])\n  case \"$gl_cv_func_printf_precision\" in\n    *yes)\n      ;;\n    *)\n      AC_DEFINE([NEED_PRINTF_UNBOUNDED_PRECISION], [1],\n        [Define if the vasnprintf implementation needs special code for\n         supporting large precisions without arbitrary bounds.])\n      AC_DEFINE([NEED_PRINTF_DOUBLE], [1],\n        [Define if the vasnprintf implementation needs special code for\n         'double' arguments.])\n      AC_DEFINE([NEED_PRINTF_LONG_DOUBLE], [1],\n        [Define if the vasnprintf implementation needs special code for\n         'long double' arguments.])\n      ;;\n  esac\n])\n\n# Extra prerequisites of lib/vasnprintf.c for surviving out-of-memory\n# conditions.\nAC_DEFUN([gl_PREREQ_VASNPRINTF_ENOMEM],\n[\n  AC_REQUIRE([gl_PRINTF_ENOMEM])\n  case \"$gl_cv_func_printf_enomem\" in\n    *yes)\n      ;;\n    *)\n      AC_DEFINE([NEED_PRINTF_ENOMEM], [1],\n        [Define if the vasnprintf implementation needs special code for\n         surviving out-of-memory conditions.])\n      AC_DEFINE([NEED_PRINTF_DOUBLE], [1],\n        [Define if the vasnprintf implementation needs special code for\n         'double' arguments.])\n      AC_DEFINE([NEED_PRINTF_LONG_DOUBLE], [1],\n        [Define if the vasnprintf implementation needs special code for\n         'long double' arguments.])\n      ;;\n  esac\n])\n\n# Prerequisites of lib/vasnprintf.c including all extras for POSIX compliance.\nAC_DEFUN([gl_PREREQ_VASNPRINTF_WITH_POSIX_EXTRAS],\n[\n  AC_REQUIRE([gl_PREREQ_VASNPRINTF])\n  gl_PREREQ_VASNPRINTF_LONG_DOUBLE\n  gl_PREREQ_VASNPRINTF_INFINITE_DOUBLE\n  gl_PREREQ_VASNPRINTF_INFINITE_LONG_DOUBLE\n  gl_PREREQ_VASNPRINTF_DIRECTIVE_A\n  gl_PREREQ_VASNPRINTF_DIRECTIVE_B\n  gl_PREREQ_VASNPRINTF_DIRECTIVE_F\n  gl_PREREQ_VASNPRINTF_DIRECTIVE_LS\n  gl_PREREQ_VASNPRINTF_DIRECTIVE_LC\n  gl_PREREQ_VASNPRINTF_FLAG_GROUPING\n  gl_PREREQ_VASNPRINTF_FLAG_LEFTADJUST\n  gl_PREREQ_VASNPRINTF_FLAG_ZERO\n  gl_PREREQ_VASNPRINTF_PRECISION\n  gl_PREREQ_VASNPRINTF_ENOMEM\n])\n\n# Extra prerequisites of lib/vasnprintf.c for supporting the 'B' directive.\nAC_DEFUN([gl_PREREQ_VASNPRINTF_DIRECTIVE_UPPERCASE_B],\n[\n  AC_REQUIRE([gl_PRINTF_DIRECTIVE_UPPERCASE_B])\n  case \"$gl_cv_func_printf_directive_uppercase_b\" in\n    *yes)\n      ;;\n    *)\n      AC_DEFINE([NEED_PRINTF_DIRECTIVE_UPPERCASE_B], [1],\n        [Define if the vasnprintf implementation needs special code for\n         the 'B' directive.])\n      ;;\n  esac\n])\n\n# Prerequisites of lib/vasnprintf.c including all extras for POSIX compliance\n# and GNU compatibility.\nAC_DEFUN([gl_PREREQ_VASNPRINTF_WITH_GNU_EXTRAS],\n[\n  gl_PREREQ_VASNPRINTF_WITH_POSIX_EXTRAS\n  AC_DEFINE([SUPPORT_GNU_PRINTF_DIRECTIVES], [1],\n    [Define if the vasnprintf implementation should support GNU compatible\n     printf directives.])\n  gl_PREREQ_VASNPRINTF_DIRECTIVE_UPPERCASE_B\n])\n\n# Prerequisites of lib/asnprintf.c.\n# Prerequisites of lib/asnwprintf.c.\nAC_DEFUN([gl_PREREQ_ASNPRINTF],\n[\n])\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}