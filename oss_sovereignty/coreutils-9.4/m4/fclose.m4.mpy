{
  "module_name": "fclose.m4",
  "hash_id": "44df52eef15d3d24a1e66973079383ceaeb0874f9d36f5d74e2ad1aa679af779",
  "original_prompt": "Ingested from coreutils-9.4/m4/fclose.m4",
  "human_readable_source": "# fclose.m4 serial 12\ndnl Copyright (C) 2008-2023 Free Software Foundation, Inc.\ndnl This file is free software; the Free Software Foundation\ndnl gives unlimited permission to copy and/or distribute it,\ndnl with or without modifications, as long as this notice is preserved.\n\nAC_DEFUN_ONCE([gl_FUNC_FCLOSE],\n[\n  AC_REQUIRE([gl_STDIO_H_DEFAULTS])\n  AC_REQUIRE([AC_CANONICAL_HOST])\n\n  gl_FUNC_FFLUSH_STDIN\n  case \"$gl_cv_func_fflush_stdin\" in\n    *yes) ;;\n    *) REPLACE_FCLOSE=1 ;;\n  esac\n\n  AC_REQUIRE([gl_FUNC_CLOSE])\n  if test $REPLACE_CLOSE = 1; then\n    REPLACE_FCLOSE=1\n  fi\n\n  case \"$host_os\" in\n    openedition) REPLACE_FCLOSE=1 ;;\n  esac\n\n  if test $REPLACE_FCLOSE = 0; then\n    gl_FUNC_FCLOSE_STDIN\n    case \"$gl_cv_func_fclose_stdin\" in\n      *yes) ;;\n      *) REPLACE_FCLOSE=1 ;;\n    esac\n  fi\n])\n\ndnl Determine whether fclose works on input streams.\ndnl Sets gl_cv_func_fclose_stdin.\n\nAC_DEFUN([gl_FUNC_FCLOSE_STDIN],\n[\n  AC_REQUIRE([AC_CANONICAL_HOST]) dnl for cross-compiles\n  AC_CHECK_HEADERS_ONCE([unistd.h])\n  AC_CACHE_CHECK([whether fclose works on input streams],\n    [gl_cv_func_fclose_stdin],\n    [echo hello world > conftest.txt\n     AC_RUN_IFELSE(\n       [AC_LANG_PROGRAM(\n          [[#include <fcntl.h>\n            #include <stdio.h>\n            #if HAVE_UNISTD_H\n            # include <unistd.h>\n            #else /* on Windows with MSVC */\n            # include <io.h>\n            #endif\n           ]GL_MDA_DEFINES],\n          [[int fd;\n            int fd2;\n            FILE *fp;\n            fd = open (\"conftest.txt\", O_RDONLY);\n            if (fd < 0)\n              return 1;\n            if (lseek (fd, 1, SEEK_SET) != 1)\n              return 2;\n            fd2 = dup (fd);\n            if (fd2 < 0)\n              return 3;\n            fp = fdopen (fd2, \"r\");\n            if (fp == NULL)\n              return 4;\n            if (fgetc (fp) != 'e')\n              { fclose (fp); return 5; }\n            /* This fclose() call should reposition the underlying file\n               descriptor.  */\n            if (fclose (fp) != 0)\n              return 6;\n            if (lseek (fd2, 0, SEEK_CUR) != -1) /* should fail with EBADF */\n              return 7;\n            /* Verify the file position.  */\n            if (lseek (fd, 0, SEEK_CUR) != 2)\n              return 8;\n            return 0;\n          ]])],\n       [gl_cv_func_fclose_stdin=yes],\n       [gl_cv_func_fclose_stdin=no],\n       [case \"$host_os\" in\n                              # Guess no on glibc systems.\n          *-gnu* | gnu*)      gl_cv_func_fclose_stdin=\"guessing no\" ;;\n                              # Guess yes on musl systems.\n          *-musl* | midipix*) gl_cv_func_fclose_stdin=\"guessing yes\" ;;\n                              # Guess no on native Windows.\n          mingw* | windows*)  gl_cv_func_fclose_stdin=\"guessing no\" ;;\n                              # If we don't know, obey --enable-cross-guesses.\n          *)                  gl_cv_func_fclose_stdin=\"$gl_cross_guess_normal\" ;;\n        esac\n       ])\n     rm conftest.txt\n    ])\n])\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}