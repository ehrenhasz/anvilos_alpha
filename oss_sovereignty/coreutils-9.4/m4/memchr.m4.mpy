{
  "module_name": "memchr.m4",
  "hash_id": "10ecfbe9ae0b62062911b64aa68d4e0624e5d0f354f1420ce901e3304910082d",
  "original_prompt": "Ingested from coreutils-9.4/m4/memchr.m4",
  "human_readable_source": "# memchr.m4 serial 19\ndnl Copyright (C) 2002-2004, 2009-2023 Free Software Foundation, Inc.\ndnl This file is free software; the Free Software Foundation\ndnl gives unlimited permission to copy and/or distribute it,\ndnl with or without modifications, as long as this notice is preserved.\n\nAC_DEFUN_ONCE([gl_FUNC_MEMCHR],\n[\n  AC_REQUIRE([AC_CANONICAL_HOST]) dnl for cross-compiles\n\n  dnl Check for prerequisites for memory fence checks.\n  gl_FUNC_MMAP_ANON\n  AC_CHECK_HEADERS_ONCE([sys/mman.h])\n  AC_CHECK_FUNCS_ONCE([mprotect])\n\n  AC_REQUIRE([gl_STRING_H_DEFAULTS])\n  # Detect platform-specific bugs in some versions of glibc:\n  # memchr should not dereference anything with length 0\n  #   https://bugzilla.redhat.com/show_bug.cgi?id=499689\n  # memchr should not dereference overestimated length after a match\n  #   https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=521737\n  #   https://sourceware.org/bugzilla/show_bug.cgi?id=10162\n  # memchr should cast the second argument to 'unsigned char'.\n  #   This bug exists in Android 4.3.\n  # Assume that memchr works on platforms that lack mprotect.\n  AC_CACHE_CHECK([whether memchr works], [gl_cv_func_memchr_works],\n    [AC_RUN_IFELSE([AC_LANG_PROGRAM([[\n#include <string.h>\n#if HAVE_SYS_MMAN_H\n# include <fcntl.h>\n# include <unistd.h>\n# include <sys/types.h>\n# include <sys/mman.h>\n# ifndef MAP_FILE\n#  define MAP_FILE 0\n# endif\n#endif\n]], [[\n  int result = 0;\n  char *fence = NULL;\n#if HAVE_SYS_MMAN_H && HAVE_MPROTECT\n# if HAVE_MAP_ANONYMOUS\n  const int flags = MAP_ANONYMOUS | MAP_PRIVATE;\n  const int fd = -1;\n# else /* !HAVE_MAP_ANONYMOUS */\n  const int flags = MAP_FILE | MAP_PRIVATE;\n  int fd = open (\"/dev/zero\", O_RDONLY, 0666);\n  if (fd >= 0)\n# endif\n    {\n      int pagesize = getpagesize ();\n      char *two_pages =\n        (char *) mmap (NULL, 2 * pagesize, PROT_READ | PROT_WRITE,\n                       flags, fd, 0);\n      if (two_pages != (char *)(-1)\n          && mprotect (two_pages + pagesize, pagesize, PROT_NONE) == 0)\n        fence = two_pages + pagesize;\n    }\n#endif\n  if (fence)\n    {\n      /* Test against bugs on glibc systems.  */\n      if (memchr (fence, 0, 0))\n        result |= 1;\n      strcpy (fence - 9, \"12345678\");\n      if (memchr (fence - 9, 0, 79) != fence - 1)\n        result |= 2;\n      if (memchr (fence - 1, 0, 3) != fence - 1)\n        result |= 4;\n      /* Test against bug on AIX 7.2.  */\n      if (memchr (fence - 4, '6', 16) != fence - 4)\n        result |= 8;\n    }\n  /* Test against bug on Android 4.3.  */\n  {\n    char input[3];\n    input[0] = 'a';\n    input[1] = 'b';\n    input[2] = 'c';\n    if (memchr (input, 0x789abc00 | 'b', 3) != input + 1)\n      result |= 16;\n  }\n  return result;\n]])],\n       [gl_cv_func_memchr_works=yes],\n       [gl_cv_func_memchr_works=no],\n       [case \"$host_os\" in\n                             # Guess no on Android.\n          linux*-android*)   gl_cv_func_memchr_works=\"guessing no\" ;;\n                             # Guess yes on native Windows.\n          mingw* | windows*) gl_cv_func_memchr_works=\"guessing yes\" ;;\n                             # If we don't know, obey --enable-cross-guesses.\n          *)                 gl_cv_func_memchr_works=\"$gl_cross_guess_normal\" ;;\n        esac\n       ])\n    ])\n  case \"$gl_cv_func_memchr_works\" in\n    *yes) ;;\n    *) REPLACE_MEMCHR=1 ;;\n  esac\n])\n\n# Prerequisites of lib/memchr.c.\nAC_DEFUN([gl_PREREQ_MEMCHR], [\n  AC_CHECK_HEADERS([bp-sym.h])\n])\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}