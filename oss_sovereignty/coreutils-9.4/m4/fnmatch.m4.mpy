{
  "module_name": "fnmatch.m4",
  "hash_id": "ee5c04207df5574e3697f5b866fe032e0ef514ef4a334e1dde2433d0a3c789d3",
  "original_prompt": "Ingested from coreutils-9.4/m4/fnmatch.m4",
  "human_readable_source": "# Check for fnmatch - serial 20  -*- coding: utf-8 -*-\n\n# Copyright (C) 2000-2007, 2009-2023 Free Software Foundation, Inc.\n# This file is free software; the Free Software Foundation\n# gives unlimited permission to copy and/or distribute it,\n# with or without modifications, as long as this notice is preserved.\n\n# Autoconf defines AC_FUNC_FNMATCH, but that is obsolescent.\n# New applications should use the macros below instead.\n\n# Request a POSIX compliant fnmatch function.\nAC_DEFUN([gl_FUNC_FNMATCH_POSIX],\n[\n  m4_divert_text([DEFAULTS], [gl_fnmatch_required=POSIX])\n\n  AC_REQUIRE([gl_FNMATCH_H])\n  AC_REQUIRE([AC_CANONICAL_HOST])\n  gl_fnmatch_required_lowercase=`\n    echo $gl_fnmatch_required | LC_ALL=C tr '[[A-Z]]' '[[a-z]]'\n  `\n  AC_CHECK_FUNCS_ONCE([fnmatch])\n  if test $ac_cv_func_fnmatch = no; then\n    HAVE_FNMATCH=0\n  else\n    gl_fnmatch_cache_var=\"gl_cv_func_fnmatch_${gl_fnmatch_required_lowercase}\"\n    AC_CACHE_CHECK([for working $gl_fnmatch_required fnmatch],\n      [$gl_fnmatch_cache_var],\n      [dnl Some versions of Solaris, SCO, and the GNU C Library\n       dnl have a broken or incompatible fnmatch.\n       dnl So we run a test program.  If we are cross-compiling, take no chance.\n       dnl Thanks to John Oleynick, Fran\u00e7ois Pinard, and Paul Eggert for this\n       dnl test.\n       if test $gl_fnmatch_required = GNU; then\n         gl_fnmatch_gnu_start=\n         gl_fnmatch_gnu_end=\n       else\n         gl_fnmatch_gnu_start='#if 0'\n         gl_fnmatch_gnu_end='#endif'\n       fi\n       AC_RUN_IFELSE(\n         [AC_LANG_PROGRAM(\n            [[#include <fnmatch.h>\n              #include <locale.h>\n              #include <stddef.h>\n              static int\n              y (char const *pattern, char const *string, int flags)\n              {\n                return fnmatch (pattern, string, flags) == 0;\n              }\n              static int\n              n (char const *pattern, char const *string, int flags)\n              {\n                return fnmatch (pattern, string, flags) == FNM_NOMATCH;\n              }\n            ]],\n            [[char const *Apat = 'A' < '\\\\\\\\' ? \"[A-\\\\\\\\\\\\\\\\]\" : \"[\\\\\\\\\\\\\\\\-A]\";\n              char const *apat = 'a' < '\\\\\\\\' ? \"[a-\\\\\\\\\\\\\\\\]\" : \"[\\\\\\\\\\\\\\\\-a]\";\n              static char const A_1[] = { 'A' - 1, 0 };\n              static char const A01[] = { 'A' + 1, 0 };\n              static char const a_1[] = { 'a' - 1, 0 };\n              static char const a01[] = { 'a' + 1, 0 };\n              static char const bs_1[] = { '\\\\\\\\' - 1, 0 };\n              static char const bs01[] = { '\\\\\\\\' + 1, 0 };\n              int result = 0;\n              /* ==== Start of tests in the \"C\" locale ==== */\n              /* These are sanity checks. They all succeed on current platforms.  */\n              if (!n (\"a*\", \"\", 0))\n                return 1;\n              if (!y (\"a*\", \"abc\", 0))\n                return 1;\n              if (!n (\"d*/*1\", \"d/s/1\", FNM_PATHNAME))\n                return 1;\n              if (!y (\"a\\\\\\\\bc\", \"abc\", 0))\n                return 1;\n              if (!n (\"a\\\\\\\\bc\", \"abc\", FNM_NOESCAPE))\n                return 1;\n              if (!y (\"*x\", \".x\", 0))\n                return 1;\n              if (!n (\"*x\", \".x\", FNM_PERIOD))\n                return 1;\n              /* glibc bug <https://sourceware.org/bugzilla/show_bug.cgi?id=361>\n                 exists in glibc 2.3.3, fixed in glibc 2.5.  */\n              if (!y (Apat, \"\\\\\\\\\", 0))\n                result |= 2;\n              if (!y (Apat, \"A\", 0))\n                result |= 2;\n              if (!y (apat, \"\\\\\\\\\", 0))\n                result |= 2;\n              if (!y (apat, \"a\", 0))\n                result |= 2;\n              if (!(n (Apat, A_1, 0) == ('A' < '\\\\\\\\')))\n                result |= 2;\n              if (!(n (apat, a_1, 0) == ('a' < '\\\\\\\\')))\n                result |= 2;\n              if (!(y (Apat, A01, 0) == ('A' < '\\\\\\\\')))\n                result |= 2;\n              if (!(y (apat, a01, 0) == ('a' < '\\\\\\\\')))\n                result |= 2;\n              if (!(y (Apat, bs_1, 0) == ('A' < '\\\\\\\\')))\n                result |= 2;\n              if (!(y (apat, bs_1, 0) == ('a' < '\\\\\\\\')))\n                result |= 2;\n              if (!(n (Apat, bs01, 0) == ('A' < '\\\\\\\\')))\n                result |= 2;\n              if (!(n (apat, bs01, 0) == ('a' < '\\\\\\\\')))\n                result |= 2;\n              /* glibc bug <https://sourceware.org/bugzilla/show_bug.cgi?id=12378>\n                 exists in glibc 2.12, fixed in glibc 2.13.  */\n              if (!y (\"[/b\", \"[/b\", 0)) /*\"]]\"*/\n                result |= 4;\n              /* glibc bug <https://sourceware.org/bugzilla/show_bug.cgi?id=17062>\n                 is fixed in glibc 2.20.\n                 glibc bugs <https://sourceware.org/bugzilla/show_bug.cgi?id=18032>\n                            <https://sourceware.org/bugzilla/show_bug.cgi?id=18036>\n                 are fixed in glibc 2.22.\n                 These bugs are not easy to test for reliably (without mmap),\n                 therefore test the glibc version.  */\n              #if defined __GLIBC__\n              if (__GLIBC__ == 2 && __GLIBC_MINOR__ < 22)\n                result |= 4;\n              #endif\n              /* This test fails on FreeBSD 13.2, NetBSD 9.3, Cygwin 3.4.6.  */\n              if (!y (\"[[:alnum:]]\", \"a\", 0))\n                result |= 8;\n              $gl_fnmatch_gnu_start /* ==== Start of GNU extensions tests ==== */\n              /* Sanity checks, mainly to check the presence of the FNM_* macros.  */\n              if (!y (\"xxXX\", \"xXxX\", FNM_CASEFOLD))\n                result |= 64;\n              if (!y (\"a++(x|yy)b\", \"a+xyyyyxb\", FNM_EXTMATCH))\n                result |= 64;\n              if (!n (\"d*/*1\", \"d/s/1\", FNM_FILE_NAME))\n                result |= 64;\n              if (!y (\"*\", \"x\", FNM_FILE_NAME | FNM_LEADING_DIR))\n                result |= 64;\n              if (!y (\"x*\", \"x/y/z\", FNM_FILE_NAME | FNM_LEADING_DIR))\n                result |= 64;\n              if (!y (\"*c*\", \"c/x\", FNM_FILE_NAME | FNM_LEADING_DIR))\n                result |= 64;\n              $gl_fnmatch_gnu_end /* ==== End of GNU extensions tests ==== */\n              /* ==== End of tests in the \"C\" locale ==== */\n              /* ==== Start of tests that require a specific locale ==== */\n              /* This test fails on Solaris 11.4.  */\n              if (setlocale (LC_ALL, \"en_US.UTF-8\") != NULL)\n                {\n                  if (!n (\"[!a-z]\", \"\", 0))\n                    result |= 16;\n                }\n              /* This test fails on NetBSD 9.3, Android 13.  */\n              if (setlocale (LC_ALL, \"C.UTF-8\") != NULL)\n                {\n                  if (!y (\"x?y\", \"x\\\\303\\\\274y\", 0))\n                    result |= 32;\n                }\n              /* ==== End of tests that require a specific locale ==== */\n              return result;\n            ]])],\n         [eval \"$gl_fnmatch_cache_var=yes\"],\n         [eval \"$gl_fnmatch_cache_var=no\"],\n         [case \"$host_os\" in\n                                # Guess yes on musl systems.\n            *-musl* | midipix*) eval \"$gl_fnmatch_cache_var=\\\"guessing yes\\\"\" ;;\n                                # Guess no otherwise, even on glibc systems.\n            *)                  eval \"$gl_fnmatch_cache_var=\\\"guessing no\\\"\" ;;\n          esac\n         ])\n      ])\n    eval \"gl_fnmatch_result=\\\"\\$$gl_fnmatch_cache_var\\\"\"\n    case \"$gl_fnmatch_result\" in\n      *yes) ;;\n      *) REPLACE_FNMATCH=1 ;;\n    esac\n    dnl On AIX 7.2 in 32-bit mode, fnmatch()'s only POSIX compliance problem is\n    dnl that is does not support characters outside the Unicode BMP correctly.\n    dnl Test case: fnmatch (\"x?y\", \"x\\360\\237\\230\\213y\", 0) == 0\n    dnl This is due to wchar_t being only 16 bits wide.\n    AC_REQUIRE([gl_UCHAR_H])\n    if test $SMALL_WCHAR_T = 1; then\n      case \"$host_os\" in\n        cygwin*)\n          dnl On Cygwin < 3.5.0, the above $gl_fnmatch_result came out as 'no',\n          dnl On Cygwin >= 3.5.0, fnmatch supports all Unicode characters,\n          dnl despite wchar_t being only 16 bits wide (because internally it\n          dnl works on wint_t values).\n          ;;\n        *)\n          REPLACE_FNMATCH=1\n          ;;\n      esac\n    fi\n  fi\n  if test $HAVE_FNMATCH = 0 || test $REPLACE_FNMATCH = 1; then\n    gl_REPLACE_FNMATCH_H\n  fi\n])\n\n# Request a POSIX compliant fnmatch function with GNU extensions.\nAC_DEFUN([gl_FUNC_FNMATCH_GNU],\n[\n  m4_divert_text([INIT_PREPARE], [gl_fnmatch_required=GNU])\n\n  AC_REQUIRE([gl_FUNC_FNMATCH_POSIX])\n])\n\nAC_DEFUN([gl_PREREQ_FNMATCH],\n[\n  dnl Prerequisites of lib/fnmatch.c.\n  AC_REQUIRE([AC_TYPE_MBSTATE_T])\n  AC_CHECK_FUNCS_ONCE([mbsrtowcs])\n])\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}