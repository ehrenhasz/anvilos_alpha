{
  "module_name": "dist-check.mk",
  "hash_id": "1d59b396e9fb4efb8ba64f4c0bd5e19173537995bc0f1a94c4675144e17c20ae",
  "original_prompt": "Ingested from coreutils-9.4/dist-check.mk",
  "human_readable_source": "# Most of this is probably too coreutils-centric to be useful to other packages.\n\nbin=bin-$$$$\n\nwrite_loser = printf '\\#!%s\\necho $$0: bad path 1>&2; exit 1\\n' '$(SHELL)'\n\ntmpdir = $(abs_top_builddir)/tests/torture\n\nt=$(tmpdir)/$(PACKAGE)/test\npfx=$(t)/i\n\nbuilt_programs := $(sort $(patsubst src/%$(EXEEXT),%,$(bin_PROGRAMS)))\n\n# More than once, tainted build and source directory names would\n# have caused at least one \"make check\" test to apply \"chmod 700\"\n# to all directories under $HOME.  Make sure it doesn't happen again.\ntp = $(tmpdir)/taint\nt_prefix = $(tp)/a\nt_taint = '$(t_prefix) b'\nfake_home = $(tp)/home\n\n# When extracting from a distribution tarball, extract using the fastest\n# method possible.  With dist-xz, that means using the *.xz file.\nifneq ('', $(filter *.xz, $(DIST_ARCHIVES)))\n  tar_decompress_opt_ = J\n  suffix_ = xz\nelse\n  ifneq ('', $(filter *.gz, $(DIST_ARCHIVES)))\n    tar_decompress_opt_ = z\n    suffix_ = gz\n  else\n    tar_decompress_opt_ = j\n    suffix_ = bz2\n  endif\nendif\namtar_extract_ = $(AMTAR) -$(tar_decompress_opt_)xf\npreferred_tarball_ = $(distdir).tar.$(suffix_)\n\n# Ensure that tests run from tainted build and src dir names work,\n# and don't affect anything in $HOME.  Create witness files in $HOME,\n# record their attributes, and build/test.  Then ensure that the\n# witnesses were not affected.\n# Skip this test when using libtool, since libtool-generated scripts\n# cannot deal with a space-tainted srcdir.\nALL_RECURSIVE_TARGETS += taint-distcheck\ntaint-distcheck: $(DIST_ARCHIVES)\n\tgrep '^[\t ]*LT_INIT' configure.ac >/dev/null && exit 0 || :\n\ttest -d $(t_taint) && chmod -R 700 $(t_taint) || :\n\t-rm -rf $(t_taint) $(fake_home)\n\tmkdir -p $(t_prefix) $(t_taint) $(fake_home)\n\t$(amtar_extract_) $(preferred_tarball_) -C $(t_taint)\n\tmkfifo $(fake_home)/fifo\n\ttouch $(fake_home)/f\n\tmkdir -p $(fake_home)/d/e\n\tls -lR $(fake_home) $(t_prefix) > $(tp)/.ls-before\n\tHOME=$(fake_home); export HOME;\t\t\t\\\n\tcd $(t_taint)/$(distdir)\t\t\t\\\n\t  && ./configure\t\t\t\t\\\n\t  && $(MAKE)\t\t\t\t\t\\\n\t  && $(MAKE) check\t\t\t\t\\\n\t  && ls -lR $(fake_home) $(t_prefix) > $(tp)/.ls-after \\\n\t  && diff $(tp)/.ls-before $(tp)/.ls-after\t\\\n\t  && test -d $(t_prefix)\n\trm -rf $(tp)\n\n# Verify that a twisted use of --program-transform-name=PROGRAM works.\ndefine install-transform-check\n  echo running install-transform-check\t\t\t\\\n    && rm -rf $(pfx)\t\t\t\t\t\\\n    && $(MAKE) program_transform_name='s/.*/zyx/'\t\\\n      prefix=$(pfx) install\t\t\t\t\\\n    && test \"$$(echo $(pfx)/bin/*)\" = \"$(pfx)/bin/zyx\"\t\\\n    && test \"$$(find $(pfx)/share/man -type f|sed 's,.*/,,;s,\\..*,,')\" = \"zyx\"\nendef\n\n# Install, then verify that all binaries and man pages are in place.\n# Note that neither the binary, ginstall, nor the [.1 man page is installed.\ndefine my-instcheck\n  echo running my-instcheck;\t\t\t\t\\\n  $(MAKE) prefix=$(pfx) install\t\t\t\t\\\n    && test ! -f $(pfx)/bin/ginstall\t\t\t\\\n    && { fail=0;\t\t\t\t\t\\\n      for i in $(built_programs); do\t\t\t\\\n        test \"$$i\" = ginstall && i=install;\t\t\\\n        for j in \"$(pfx)/bin/$$i\"\t\t\t\\\n                 \"$(pfx)/share/man/man1/$$i.1\"; do\t\\\n          case $$j in *'[.1') continue;; esac;\t\t\\\n          test -f \"$$j\" && :\t\t\t\t\\\n            || { echo \"$$j not installed\"; fail=1; };\t\\\n        done;\t\t\t\t\t\t\\\n      done;\t\t\t\t\t\t\\\n      test $$fail = 1 && exit 1 || :;\t\t\t\\\n    }\nendef\n\n# Use this to make sure we don't run these programs when building\n# from a virgin compressed tarball file, below.\nnull_AM_MAKEFLAGS ?= \\\n  ACLOCAL=false \\\n  AUTOCONF=false \\\n  AUTOMAKE=false \\\n  AUTOHEADER=false \\\n  GPERF=false \\\n  MAKEINFO=false\n\nALL_RECURSIVE_TARGETS += my-distcheck\nmy-distcheck: $(DIST_ARCHIVES) $(local-check)\n\t$(MAKE) syntax-check\n\t$(MAKE) check\n\t-rm -rf $(t)\n\tmkdir -p $(t)\n\t$(amtar_extract_) $(preferred_tarball_) -C $(t)\n\t(set -e; cd $(t)/$(distdir);\t\t\t\\\n\t  ./configure --quiet --enable-gcc-warnings --disable-nls; \\\n\t  $(MAKE) AM_MAKEFLAGS='$(null_AM_MAKEFLAGS)';\t\\\n\t  $(MAKE) dvi;\t\t\t\t\t\\\n\t  $(install-transform-check);\t\t\t\\\n\t  $(my-instcheck);\t\t\t\t\\\n\t  $(MAKE) distclean\t\t\t\t\\\n\t)\n\t(cd $(t) && mv $(distdir) $(distdir).old\t\\\n\t  && $(amtar_extract_) - ) < $(preferred_tarball_)\n# With post-v1.15 automake, \"distclean\" would fail to remove .deps\n# directories, leading to a spurious failure of the following recursive diff.\n# FIXME: remove this, once automake is fixed.\n\tfind $(t)/$(distdir).old $(t)/$(distdir) -name .deps | xargs -r rmdir\n\tdiff -ur $(t)/$(distdir).old $(t)/$(distdir)\n\t-rm -rf $(t)\n\trmdir $(tmpdir)/$(PACKAGE) $(tmpdir)\n\t@echo \"========================\"; \\\n\techo \"ready for distribution:\"; \\\n\tfor i in $(DIST_ARCHIVES); do echo \"  $$i\"; done; \\\n\techo \"========================\"\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}