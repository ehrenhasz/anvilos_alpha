{
  "module_name": "anvil.build.sh",
  "hash_id": "d2fef385df45105db9d7d13acdd2402455d339e2cfcd40bb8ea4637f41355a37",
  "original_prompt": "Ingested from sys_09_Anvil/anvil.build.sh",
  "human_readable_source": "#!/bin/bash\nset -e\n\n# ANVIL BUILD SCRIPT\n# Target: x86_64-unknown-linux-musl (Sovereign Toolchain)\n# Goal: Produce a hermetic, static 'anvil' binary with subprocess capabilities.\n\nPROJECT_ROOT=\"$( cd \"$( dirname \"${BASH_SOURCE[0]}\" )/../..\" && pwd )\"\nSOURCE_DIR=\"$PROJECT_ROOT/oss_sovereignty/sys_09_Anvil/source\"\nTOOLCHAIN_BIN=\"$PROJECT_ROOT/ext/toolchain/bin/x86_64-unknown-linux-musl-\"\nOUTPUT_DIR=\"$PROJECT_ROOT/oss_sovereignty/sys_09_Anvil/build\"\n\n# Set Sovereign Toolchain for cross-compilation context\nexport CROSS_COMPILE=\"${TOOLCHAIN_BIN}\"\n# Ensure standard variables are set for Makefiles that might ignore CROSS_COMPILE\nexport CC=\"${TOOLCHAIN_BIN}gcc\"\nexport CXX=\"${TOOLCHAIN_BIN}g++\"\nexport AR=\"${TOOLCHAIN_BIN}ar\"\nexport LD=\"${TOOLCHAIN_BIN}ld\"\nexport STRIP=\"${TOOLCHAIN_BIN}strip\"\n\nmkdir -p \"$OUTPUT_DIR\"\n\necho \">> [BUILD] Phase 0: Building mpy-cross (Sovereign Static)...\"\ncd \"$SOURCE_DIR/mpy-cross\"\nmake clean\n# Build static mpy-cross using sovereign toolchain.\n# CFLAGS_EXTRA=\"-static\" ensures it's a static binary executable on the host.\nmake -j$(nproc) CC=\"$CC\" CFLAGS_EXTRA=\"-static\" LDFLAGS_EXTRA=\"-static\"\n\necho \">> [BUILD] Configuring MicroPython for Static Musl Build...\"\ncd \"$SOURCE_DIR/ports/unix\"\nmake clean\n\n# Create manifest to freeze anvil.py\necho \"freeze('$SOURCE_DIR', 'anvil.py')\" > \"$SOURCE_DIR/manifest.py\"\n\necho \">> [BUILD] Running Make (Static)...\"\n# We invoke make. Since we exported CROSS_COMPILE and CC, it should be fine.\n# We pass CFLAGS_EXTRA=\"-static\" for the runtime.\nmake -j$(nproc) \\\n    MICROPY_PY_BTREE=0 \\\n    MICROPY_PY_TERMIOS=0 \\\n    MICROPY_PY_SOCKET=0 \\\n    MICROPY_PY_NETWORK=0 \\\n    MICROPY_PY_SSL=0 \\\n    MICROPY_PY_AXTLS=0 \\\n    MICROPY_PY_FFI=0 \\\n    MICROPY_PY_JNI=0 \\\n    MICROPY_PY_BLUETOOTH=0 \\\n    MPY_LIB_DIR=../.. \\\n    MICROPY_USE_READLINE=1 \\\n    CFLAGS_EXTRA=\"-static -Wno-error=unterminated-string-initialization\" \\\n    LDFLAGS_EXTRA=\"-static\" \\\n    FROZEN_MANIFEST=\"$SOURCE_DIR/manifest.py\"\n\necho \">> [BUILD] Build Complete.\"\ncp build-standard/micropython \"$OUTPUT_DIR/anvil\"\necho \">> [BUILD] Artifact: $OUTPUT_DIR/anvil\"\n\n\"$STRIP\" \"$OUTPUT_DIR/anvil\"\necho \">> [BUILD] Binary stripped.\"",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}