{
  "module_name": "spiflash.h",
  "hash_id": "92b68f393e6cbbf62a48126b863d4af5f0b765b9bed319f741bd91b37c2c1676",
  "original_prompt": "Ingested from sys_09_Anvil/source/drivers/memory/spiflash.h",
  "human_readable_source": " \n#ifndef MICROPY_INCLUDED_DRIVERS_MEMORY_SPIFLASH_H\n#define MICROPY_INCLUDED_DRIVERS_MEMORY_SPIFLASH_H\n\n#include \"drivers/bus/spi.h\"\n#include \"drivers/bus/qspi.h\"\n\n#define MP_SPIFLASH_ERASE_BLOCK_SIZE (4096) \n\nenum {\n    MP_SPIFLASH_BUS_SPI,\n    MP_SPIFLASH_BUS_QSPI,\n};\n\nstruct _mp_spiflash_t;\n\n#if MICROPY_HW_SPIFLASH_ENABLE_CACHE\n\n\ntypedef struct _mp_spiflash_cache_t {\n    uint8_t buf[MP_SPIFLASH_ERASE_BLOCK_SIZE] __attribute__((aligned(4)));\n    struct _mp_spiflash_t *user; \n    uint32_t block; \n} mp_spiflash_cache_t;\n#endif\n\ntypedef struct _mp_spiflash_config_t {\n    uint32_t bus_kind;\n    union {\n        struct {\n            mp_hal_pin_obj_t cs;\n            void *data;\n            const mp_spi_proto_t *proto;\n        } u_spi;\n        struct {\n            void *data;\n            const mp_qspi_proto_t *proto;\n        } u_qspi;\n    } bus;\n    #if MICROPY_HW_SPIFLASH_ENABLE_CACHE\n    mp_spiflash_cache_t *cache; \n    #endif\n} mp_spiflash_config_t;\n\ntypedef struct _mp_spiflash_t {\n    const mp_spiflash_config_t *config;\n    volatile uint32_t flags;\n} mp_spiflash_t;\n\nvoid mp_spiflash_init(mp_spiflash_t *self);\nvoid mp_spiflash_deepsleep(mp_spiflash_t *self, int value);\n\n\nint mp_spiflash_erase_block(mp_spiflash_t *self, uint32_t addr);\nint mp_spiflash_read(mp_spiflash_t *self, uint32_t addr, size_t len, uint8_t *dest);\nint mp_spiflash_write(mp_spiflash_t *self, uint32_t addr, size_t len, const uint8_t *src);\n\n#if MICROPY_HW_SPIFLASH_ENABLE_CACHE\n\nint mp_spiflash_cache_flush(mp_spiflash_t *self);\nint mp_spiflash_cached_read(mp_spiflash_t *self, uint32_t addr, size_t len, uint8_t *dest);\nint mp_spiflash_cached_write(mp_spiflash_t *self, uint32_t addr, size_t len, const uint8_t *src);\n#endif\n\n#endif \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}