{
  "module_name": "asmbase.c",
  "hash_id": "01faea827120aace9b875700cd733cf056076992075d1b50df1b7f6196afabdb",
  "original_prompt": "Ingested from sys_09_Anvil/source/py/asmbase.c",
  "human_readable_source": " \n\n#include <assert.h>\n#include <string.h>\n\n#include \"py/obj.h\"\n#include \"py/misc.h\"\n#include \"py/asmbase.h\"\n\n#if MICROPY_EMIT_MACHINE_CODE\n\nvoid mp_asm_base_init(mp_asm_base_t *as, size_t max_num_labels) {\n    as->max_num_labels = max_num_labels;\n    as->label_offsets = m_new(size_t, max_num_labels);\n}\n\nvoid mp_asm_base_deinit(mp_asm_base_t *as, bool free_code) {\n    if (free_code) {\n        MP_PLAT_FREE_EXEC(as->code_base, as->code_size);\n    }\n    m_del(size_t, as->label_offsets, as->max_num_labels);\n}\n\nvoid mp_asm_base_start_pass(mp_asm_base_t *as, int pass) {\n    if (pass < MP_ASM_PASS_EMIT) {\n        \n        memset(as->label_offsets, -1, as->max_num_labels * sizeof(size_t));\n    } else {\n        \n        MP_PLAT_ALLOC_EXEC(as->code_offset, (void **)&as->code_base, &as->code_size);\n        assert(as->code_base != NULL);\n    }\n    as->pass = pass;\n    as->suppress = false;\n    as->code_offset = 0;\n}\n\n\n\n\n\nuint8_t *mp_asm_base_get_cur_to_write_bytes(void *as_in, size_t num_bytes_to_write) {\n    mp_asm_base_t *as = as_in;\n    uint8_t *c = NULL;\n    if (as->suppress) {\n        return c;\n    }\n    if (as->pass == MP_ASM_PASS_EMIT) {\n        assert(as->code_offset + num_bytes_to_write <= as->code_size);\n        c = as->code_base + as->code_offset;\n    }\n    as->code_offset += num_bytes_to_write;\n    return c;\n}\n\nvoid mp_asm_base_label_assign(mp_asm_base_t *as, size_t label) {\n    assert(label < as->max_num_labels);\n\n    \n    \n    as->suppress = false;\n\n    if (as->pass < MP_ASM_PASS_EMIT) {\n        \n        assert(as->label_offsets[label] == (size_t)-1);\n        as->label_offsets[label] = as->code_offset;\n    } else {\n        \n        assert(as->label_offsets[label] == as->code_offset);\n    }\n}\n\n\nvoid mp_asm_base_align(mp_asm_base_t *as, unsigned int align) {\n    as->code_offset = (as->code_offset + align - 1) & (~(align - 1));\n}\n\n\nvoid mp_asm_base_data(mp_asm_base_t *as, unsigned int bytesize, uintptr_t val) {\n    uint8_t *c = mp_asm_base_get_cur_to_write_bytes(as, bytesize);\n    if (c != NULL) {\n        for (unsigned int i = 0; i < bytesize; i++) {\n            *c++ = val;\n            val >>= 8;\n        }\n    }\n}\n\n#endif \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}