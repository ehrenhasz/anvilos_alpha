{
  "module_name": "pystack.h",
  "hash_id": "aebe7fa072b8601f39530264faaab71b9b14c8a425e6298a7d16642d8c6ecaba",
  "original_prompt": "Ingested from sys_09_Anvil/source/py/pystack.h",
  "human_readable_source": " \n#ifndef MICROPY_INCLUDED_PY_PYSTACK_H\n#define MICROPY_INCLUDED_PY_PYSTACK_H\n\n#include \"py/mpstate.h\"\n\n\n\n#define MP_PYSTACK_DEBUG (0)\n\n#if MICROPY_ENABLE_PYSTACK\n\nvoid mp_pystack_init(void *start, void *end);\nvoid *mp_pystack_alloc(size_t n_bytes);\n\n\n\n\nstatic inline void mp_pystack_free(void *ptr) {\n    assert((uint8_t *)ptr >= MP_STATE_THREAD(pystack_start));\n    assert((uint8_t *)ptr <= MP_STATE_THREAD(pystack_cur));\n    #if MP_PYSTACK_DEBUG\n    size_t n_bytes_to_free = MP_STATE_THREAD(pystack_cur) - (uint8_t *)ptr;\n    size_t n_bytes = *(size_t *)(MP_STATE_THREAD(pystack_cur) - MICROPY_PYSTACK_ALIGN);\n    while (n_bytes < n_bytes_to_free) {\n        n_bytes += *(size_t *)(MP_STATE_THREAD(pystack_cur) - n_bytes - MICROPY_PYSTACK_ALIGN);\n    }\n    if (n_bytes != n_bytes_to_free) {\n        mp_printf(&mp_plat_print, \"mp_pystack_free() failed: %u != %u\\n\", (uint)n_bytes_to_free,\n            (uint)*(size_t *)(MP_STATE_THREAD(pystack_cur) - MICROPY_PYSTACK_ALIGN));\n        assert(0);\n    }\n    #endif\n    MP_STATE_THREAD(pystack_cur) = (uint8_t *)ptr;\n}\n\nstatic inline void mp_pystack_realloc(void *ptr, size_t n_bytes) {\n    mp_pystack_free(ptr);\n    mp_pystack_alloc(n_bytes);\n}\n\nstatic inline size_t mp_pystack_usage(void) {\n    return MP_STATE_THREAD(pystack_cur) - MP_STATE_THREAD(pystack_start);\n}\n\nstatic inline size_t mp_pystack_limit(void) {\n    return MP_STATE_THREAD(pystack_end) - MP_STATE_THREAD(pystack_start);\n}\n\n#endif\n\n#if !MICROPY_ENABLE_PYSTACK\n\n#define mp_local_alloc(n_bytes) alloca(n_bytes)\n\nstatic inline void mp_local_free(void *ptr) {\n    (void)ptr;\n}\n\nstatic inline void *mp_nonlocal_alloc(size_t n_bytes) {\n    return m_new(uint8_t, n_bytes);\n}\n\nstatic inline void *mp_nonlocal_realloc(void *ptr, size_t old_n_bytes, size_t new_n_bytes) {\n    return m_renew(uint8_t, ptr, old_n_bytes, new_n_bytes);\n}\n\nstatic inline void mp_nonlocal_free(void *ptr, size_t n_bytes) {\n    m_del(uint8_t, ptr, n_bytes);\n}\n\n#else\n\nstatic inline void *mp_local_alloc(size_t n_bytes) {\n    return mp_pystack_alloc(n_bytes);\n}\n\nstatic inline void mp_local_free(void *ptr) {\n    mp_pystack_free(ptr);\n}\n\nstatic inline void *mp_nonlocal_alloc(size_t n_bytes) {\n    return mp_pystack_alloc(n_bytes);\n}\n\nstatic inline void *mp_nonlocal_realloc(void *ptr, size_t old_n_bytes, size_t new_n_bytes) {\n    (void)old_n_bytes;\n    mp_pystack_realloc(ptr, new_n_bytes);\n    return ptr;\n}\n\nstatic inline void mp_nonlocal_free(void *ptr, size_t n_bytes) {\n    (void)n_bytes;\n    mp_pystack_free(ptr);\n}\n\n#endif\n\n#endif \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}