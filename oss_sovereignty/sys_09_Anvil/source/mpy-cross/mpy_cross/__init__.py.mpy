{
  "module_name": "__init__.py",
  "hash_id": "52b928c2d81017475d6f63aa66ff23691ea0de641fdfbc7bb20f8dc53909bab0",
  "original_prompt": "Ingested from sys_09_Anvil/source/mpy-cross/mpy_cross/__init__.py",
  "human_readable_source": "#!/usr/bin/env python3\n#\n# This file is part of the MicroPython project, http://micropython.org/\n#\n# The MIT License (MIT)\n#\n# Copyright (c) 2022 Andrew Leech\n# Copyright (c) 2022 Jim Mussared\n#\n# Permission is hereby granted, free of charge, to any person obtaining a copy\n# of this software and associated documentation files (the \"Software\"), to deal\n# in the Software without restriction, including without limitation the rights\n# to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n# copies of the Software, and to permit persons to whom the Software is\n# furnished to do so, subject to the following conditions:\n#\n# The above copyright notice and this permission notice shall be included in\n# all copies or substantial portions of the Software.\n#\n# THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n# IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n# FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n# AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n# LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n# OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n# THE SOFTWARE.\n\nfrom __future__ import print_function\nimport os\nimport re\nimport stat\nimport subprocess\n\nNATIVE_ARCHS = {\n    \"NATIVE_ARCH_NONE\": \"\",\n    \"NATIVE_ARCH_X86\": \"x86\",\n    \"NATIVE_ARCH_X64\": \"x64\",\n    \"NATIVE_ARCH_ARMV6\": \"armv6\",\n    \"NATIVE_ARCH_ARMV6M\": \"armv6m\",\n    \"NATIVE_ARCH_ARMV7M\": \"armv7m\",\n    \"NATIVE_ARCH_ARMV7EM\": \"armv7em\",\n    \"NATIVE_ARCH_ARMV7EMSP\": \"armv7emsp\",\n    \"NATIVE_ARCH_ARMV7EMDP\": \"armv7emdp\",\n    \"NATIVE_ARCH_XTENSA\": \"xtensa\",\n    \"NATIVE_ARCH_XTENSAWIN\": \"xtensawin\",\n}\n\nglobals().update(NATIVE_ARCHS)\n\n__all__ = [\"version\", \"compile\", \"run\", \"CrossCompileError\"] + list(NATIVE_ARCHS.keys())\n\n\nclass CrossCompileError(Exception):\n    pass\n\n\n_VERSION_RE = re.compile(\"mpy-cross emitting mpy v([0-9]+)(?:.([0-9]+))?\")\n\n\ndef _find_mpy_cross_binary(mpy_cross):\n    if mpy_cross:\n        return mpy_cross\n    return os.path.abspath(os.path.join(os.path.dirname(__file__), \"../build/mpy-cross\"))\n\n\ndef mpy_version(mpy_cross=None):\n    \"\"\"\n    Get the version and sub-version of the .mpy file format generated by this version of mpy-cross.\n\n    Returns: A tuple of `(mpy_version, mpy_sub_version)`\n    Optional keyword arguments:\n     - mpy_cross: Specific mpy-cross binary to use\n    \"\"\"\n    version_info = run([\"--version\"], mpy_cross=mpy_cross)\n    match = re.search(_VERSION_RE, version_info)\n    mpy_version, mpy_sub_version = int(match.group(1)), int(match.group(2) or \"0\")\n    return (\n        mpy_version,\n        mpy_sub_version,\n    )\n\n\ndef compile(src, dest=None, src_path=None, opt=None, march=None, mpy_cross=None, extra_args=None):\n    \"\"\"\n    Compile the specified .py file with mpy-cross.\n\n    Returns: Standard output from mpy-cross as a string.\n\n    Required arguments:\n     - src:        The path to the .py file\n\n    Optional keyword arguments:\n     - dest:       The output .mpy file. Defaults to `src` (with .mpy extension)\n     - src_path:   The path to embed in the .mpy file (defaults to `src`)\n     - opt:        Optimisation level (0-3, default 0)\n     - march:      One of the `NATIVE_ARCH_*` constants (defaults to NATIVE_ARCH_NONE)\n     - mpy_cross:  Specific mpy-cross binary to use\n     - extra_args: Additional arguments to pass to mpy-cross (e.g. `[\"-X\", \"emit=native\"]`)\n    \"\"\"\n    if not src:\n        raise ValueError(\"src is required\")\n    if not os.path.exists(src):\n        raise CrossCompileError(\"Input .py file not found: {}.\".format(src))\n\n    args = []\n\n    if src_path:\n        args += [\"-s\", src_path]\n\n    if dest:\n        args += [\"-o\", dest]\n\n    if march:\n        args += [\"-march=\" + march]\n\n    if opt is not None:\n        args += [\"-O{}\".format(opt)]\n\n    if extra_args:\n        args += extra_args\n\n    args += [src]\n\n    run(args, mpy_cross)\n\n\ndef run(args, mpy_cross=None):\n    \"\"\"\n    Run mpy-cross with the specified command line arguments.\n    Prefer to use `compile()` instead.\n\n    Returns: Standard output from mpy-cross as a string.\n\n    Optional keyword arguments:\n     - mpy_cross: Specific mpy-cross binary to use\n    \"\"\"\n    mpy_cross = _find_mpy_cross_binary(mpy_cross)\n\n    if not os.path.exists(mpy_cross):\n        raise CrossCompileError(\"mpy-cross binary not found at {}.\".format(mpy_cross))\n\n    try:\n        st = os.stat(mpy_cross)\n        os.chmod(mpy_cross, st.st_mode | stat.S_IEXEC)\n    except OSError:\n        pass\n\n    try:\n        return subprocess.check_output([mpy_cross] + args, stderr=subprocess.STDOUT).decode()\n    except subprocess.CalledProcessError as er:\n        raise CrossCompileError(er.output.decode())\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}