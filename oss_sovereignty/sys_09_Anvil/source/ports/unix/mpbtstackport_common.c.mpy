{
  "module_name": "mpbtstackport_common.c",
  "hash_id": "e4071f16a33c8e95b6b766eab27b1e70ec0fb39ee865d151162f1ffea30e78b0",
  "original_prompt": "Ingested from sys_09_Anvil/source/ports/unix/mpbtstackport_common.c",
  "human_readable_source": " \n\n#include \"py/runtime.h\"\n#include \"py/mperrno.h\"\n#include \"py/mphal.h\"\n\n#if MICROPY_PY_BLUETOOTH && MICROPY_BLUETOOTH_BTSTACK\n\n#include \"lib/btstack/src/btstack.h\"\n\n#include \"lib/btstack/platform/embedded/btstack_run_loop_embedded.h\"\n#include \"lib/btstack/platform/embedded/hal_cpu.h\"\n#include \"lib/btstack/platform/embedded/hal_time_ms.h\"\n#include \"lib/btstack/platform/embedded/hci_dump_embedded_stdout.h\"\n\n#include \"extmod/btstack/modbluetooth_btstack.h\"\n\n#include \"mpbtstackport.h\"\n\n\nbool mp_bluetooth_hci_poll(void) {\n    if (mp_bluetooth_btstack_state == MP_BLUETOOTH_BTSTACK_STATE_STARTING || mp_bluetooth_btstack_state == MP_BLUETOOTH_BTSTACK_STATE_ACTIVE || mp_bluetooth_btstack_state == MP_BLUETOOTH_BTSTACK_STATE_HALTING) {\n        \n        mp_uint_t atomic_state = MICROPY_BEGIN_ATOMIC_SECTION();\n        #if MICROPY_BLUETOOTH_BTSTACK_H4\n        mp_bluetooth_hci_poll_h4();\n        #endif\n        btstack_run_loop_embedded_execute_once();\n        MICROPY_END_ATOMIC_SECTION(atomic_state);\n\n        return true;\n    }\n\n    return false;\n}\n\nbool mp_bluetooth_hci_active(void) {\n    return mp_bluetooth_btstack_state != MP_BLUETOOTH_BTSTACK_STATE_OFF\n           && mp_bluetooth_btstack_state != MP_BLUETOOTH_BTSTACK_STATE_TIMEOUT;\n}\n\n\n\n\nvoid hal_cpu_disable_irqs(void) {\n}\n\nvoid hal_cpu_enable_irqs(void) {\n}\n\nvoid hal_cpu_enable_irqs_and_sleep(void) {\n}\n\nuint32_t hal_time_ms(void) {\n    return mp_hal_ticks_ms();\n}\n\nvoid mp_bluetooth_btstack_port_init(void) {\n    btstack_run_loop_init(btstack_run_loop_embedded_get_instance());\n\n    \n\n    #if MICROPY_BLUETOOTH_BTSTACK_H4\n    mp_bluetooth_btstack_port_init_h4();\n    #endif\n\n    #if MICROPY_BLUETOOTH_BTSTACK_USB\n    mp_bluetooth_btstack_port_init_usb();\n    #endif\n}\n\n#endif \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}