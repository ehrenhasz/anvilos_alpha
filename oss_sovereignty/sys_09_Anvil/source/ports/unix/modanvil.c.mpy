{
  "module_name": "modanvil.c",
  "hash_id": "30e03ae3e35a0617b8a90420c6b9622ba270a286866a0983591b02ce42f4eb74",
  "original_prompt": "Ingested from sys_09_Anvil/source/ports/unix/modanvil.c",
  "human_readable_source": "#include <stdio.h>\n#include <string.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <sys/wait.h>\n\n#include \"py/runtime.h\"\n#include \"py/mphal.h\"\n#include \"py/objstr.h\"\n\n\n\nstatic mp_obj_t anvil_check_output(mp_obj_t cmd_in) {\n    const char *cmd = mp_obj_str_get_str(cmd_in);\n\n    \n    \n    FILE *fp = popen(cmd, \"r\");\n    if (fp == NULL) {\n        mp_raise_OSError(errno);\n    }\n\n    vstr_t vstr;\n    vstr_init(&vstr, 128);\n\n    char buf[1024];\n    while (fgets(buf, sizeof(buf), fp) != NULL) {\n        vstr_add_str(&vstr, buf);\n    }\n\n    int status = pclose(fp);\n    if (status == -1) {\n        vstr_clear(&vstr);\n        mp_raise_OSError(errno);\n    }\n\n    int exit_code = 0;\n    if (WIFEXITED(status)) {\n        exit_code = WEXITSTATUS(status);\n    } else {\n        exit_code = -1; \n    }\n\n    if (exit_code != 0) {\n        vstr_clear(&vstr);\n        \n        mp_raise_OSError(exit_code);\n    }\n\n    return mp_obj_new_bytes_from_vstr(&vstr);\n}\nstatic MP_DEFINE_CONST_FUN_OBJ_1(anvil_check_output_obj, anvil_check_output);\n\nstatic const mp_rom_map_elem_t anvil_module_globals_table[] = {\n    { MP_ROM_QSTR(MP_QSTR___name__), MP_ROM_QSTR(MP_QSTR_anvil) },\n    { MP_ROM_QSTR(MP_QSTR_check_output), MP_ROM_PTR(&anvil_check_output_obj) },\n};\nstatic MP_DEFINE_CONST_DICT(anvil_module_globals, anvil_module_globals_table);\n\nconst mp_obj_module_t mp_module_anvil = {\n    .base = { &mp_type_module },\n    .globals = (mp_obj_dict_t *)&anvil_module_globals,\n};\n\nMP_REGISTER_MODULE(MP_QSTR_anvil, mp_module_anvil);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}