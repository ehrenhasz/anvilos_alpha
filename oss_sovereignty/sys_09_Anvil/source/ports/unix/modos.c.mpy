{
  "module_name": "modos.c",
  "hash_id": "3212d0419deeb562e6b35f7cd212e6c60041dd388c7ef3a131aaee2fdacc1257",
  "original_prompt": "Ingested from sys_09_Anvil/source/ports/unix/modos.c",
  "human_readable_source": " \n\n#include <errno.h>\n#include <stdlib.h>\n#include <string.h>\n\n#include \"py/runtime.h\"\n#include \"py/mphal.h\"\n\nstatic mp_obj_t mp_os_getenv(size_t n_args, const mp_obj_t *args) {\n    const char *s = getenv(mp_obj_str_get_str(args[0]));\n    if (s == NULL) {\n        if (n_args == 2) {\n            return args[1];\n        }\n        return mp_const_none;\n    }\n    return mp_obj_new_str(s, strlen(s));\n}\nstatic MP_DEFINE_CONST_FUN_OBJ_VAR_BETWEEN(mp_os_getenv_obj, 1, 2, mp_os_getenv);\n\nstatic mp_obj_t mp_os_putenv(mp_obj_t key_in, mp_obj_t value_in) {\n    const char *key = mp_obj_str_get_str(key_in);\n    const char *value = mp_obj_str_get_str(value_in);\n    int ret;\n\n    #if _WIN32\n    ret = _putenv_s(key, value);\n    #else\n    ret = setenv(key, value, 1);\n    #endif\n\n    if (ret == -1) {\n        mp_raise_OSError(errno);\n    }\n    return mp_const_none;\n}\nstatic MP_DEFINE_CONST_FUN_OBJ_2(mp_os_putenv_obj, mp_os_putenv);\n\nstatic mp_obj_t mp_os_unsetenv(mp_obj_t key_in) {\n    const char *key = mp_obj_str_get_str(key_in);\n    int ret;\n\n    #if _WIN32\n    ret = _putenv_s(key, \"\");\n    #else\n    ret = unsetenv(key);\n    #endif\n\n    if (ret == -1) {\n        mp_raise_OSError(errno);\n    }\n    return mp_const_none;\n}\nstatic MP_DEFINE_CONST_FUN_OBJ_1(mp_os_unsetenv_obj, mp_os_unsetenv);\n\nstatic mp_obj_t mp_os_system(mp_obj_t cmd_in) {\n    const char *cmd = mp_obj_str_get_str(cmd_in);\n\n    MP_THREAD_GIL_EXIT();\n    int r = system(cmd);\n    MP_THREAD_GIL_ENTER();\n\n    RAISE_ERRNO(r, errno);\n\n    return MP_OBJ_NEW_SMALL_INT(r);\n}\nstatic MP_DEFINE_CONST_FUN_OBJ_1(mp_os_system_obj, mp_os_system);\n\nstatic mp_obj_t mp_os_urandom(mp_obj_t num) {\n    mp_int_t n = mp_obj_get_int(num);\n    vstr_t vstr;\n    vstr_init_len(&vstr, n);\n    mp_hal_get_random(n, vstr.buf);\n    return mp_obj_new_bytes_from_vstr(&vstr);\n}\nstatic MP_DEFINE_CONST_FUN_OBJ_1(mp_os_urandom_obj, mp_os_urandom);\n\nstatic mp_obj_t mp_os_errno(size_t n_args, const mp_obj_t *args) {\n    if (n_args == 0) {\n        return MP_OBJ_NEW_SMALL_INT(errno);\n    }\n\n    errno = mp_obj_get_int(args[0]);\n    return mp_const_none;\n}\nstatic MP_DEFINE_CONST_FUN_OBJ_VAR_BETWEEN(mp_os_errno_obj, 0, 1, mp_os_errno);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}