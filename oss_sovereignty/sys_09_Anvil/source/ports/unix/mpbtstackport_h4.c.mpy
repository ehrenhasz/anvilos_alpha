{
  "module_name": "mpbtstackport_h4.c",
  "hash_id": "2b84084ae569e5f3f79281dadb1d38ced0dd671a4e5c52ba19d4968f1a818309",
  "original_prompt": "Ingested from sys_09_Anvil/source/ports/unix/mpbtstackport_h4.c",
  "human_readable_source": " \n\n#include \"py/mpconfig.h\"\n\n#if MICROPY_PY_BLUETOOTH && MICROPY_BLUETOOTH_BTSTACK && MICROPY_BLUETOOTH_BTSTACK_H4\n\n#include <pthread.h>\n\n#include \"py/runtime.h\"\n#include \"py/mperrno.h\"\n#include \"py/mphal.h\"\n\n#include \"lib/btstack/src/hci_transport_h4.h\"\n#include \"lib/btstack/chipset/zephyr/btstack_chipset_zephyr.h\"\n\n#include \"extmod/btstack/btstack_hci_uart.h\"\n#include \"extmod/btstack/modbluetooth_btstack.h\"\n\n#include \"mpbtstackport.h\"\n\n#define DEBUG_printf(...) \n\nstatic hci_transport_config_uart_t hci_transport_config_uart = {\n    .type = HCI_TRANSPORT_CONFIG_UART,\n    .baudrate_init = 1000000,\n    .baudrate_main = 0,\n    .flowcontrol = 1,\n    .device_name = NULL,\n    .parity = BTSTACK_UART_PARITY_OFF,\n};\n\nvoid mp_bluetooth_hci_poll_h4(void) {\n    if (mp_bluetooth_btstack_state == MP_BLUETOOTH_BTSTACK_STATE_STARTING || mp_bluetooth_btstack_state == MP_BLUETOOTH_BTSTACK_STATE_ACTIVE) {\n        mp_bluetooth_btstack_hci_uart_process();\n    }\n}\n\nvoid mp_bluetooth_btstack_port_init_h4(void) {\n    DEBUG_printf(\"mp_bluetooth_btstack_port_init_h4\\n\");\n\n    const hci_transport_t *transport = hci_transport_h4_instance_for_uart(&mp_bluetooth_btstack_hci_uart_block);\n    hci_init(transport, &hci_transport_config_uart);\n\n    hci_set_chipset(btstack_chipset_zephyr_instance());\n}\n\nvoid mp_bluetooth_btstack_port_deinit(void) {\n    DEBUG_printf(\"mp_bluetooth_btstack_port_deinit\\n\");\n\n    hci_power_control(HCI_POWER_OFF);\n    hci_close();\n}\n\nvoid mp_bluetooth_btstack_port_start(void) {\n    DEBUG_printf(\"mp_bluetooth_btstack_port_start\\n\");\n\n    hci_power_control(HCI_POWER_ON);\n}\n\n#endif \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}