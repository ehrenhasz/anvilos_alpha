{
  "module_name": "lz77.c",
  "hash_id": "f4776b934c7ab7d4337ffbba762a6245a7ea73cd5212c46dbfdab83a9ae5f973",
  "original_prompt": "Ingested from sys_09_Anvil/source/lib/uzlib/lz77.c",
  "human_readable_source": " \n\n#include \"uzlib.h\"\n\n#include \"defl_static.c\"\n\n#define MATCH_LEN_MIN (3)\n#define MATCH_LEN_MAX (258)\n\n\n\n\n\nvoid uzlib_lz77_init(uzlib_lz77_state_t *state, uint8_t *hist, size_t hist_max) {\n    memset(state, 0, sizeof(uzlib_lz77_state_t));\n    state->hist_buf = hist;\n    state->hist_max = hist_max;\n    state->hist_start = 0;\n    state->hist_len = 0;\n}\n\n\n\n\nstatic size_t uzlib_lz77_search_max_match(uzlib_lz77_state_t *state, const uint8_t *src, size_t len, size_t *longest_offset) {\n    size_t longest_len = 0;\n    for (size_t hist_search = 0; hist_search < state->hist_len; ++hist_search) {\n        \n        size_t match_len;\n        for (match_len = 0; match_len <= MATCH_LEN_MAX && match_len < len; ++match_len) {\n            uint8_t hist;\n            if (hist_search + match_len < state->hist_len) {\n                hist = state->hist_buf[(state->hist_start + hist_search + match_len) & (state->hist_max - 1)];\n            } else {\n                hist = src[hist_search + match_len - state->hist_len];\n            }\n            if (src[match_len] != hist) {\n                break;\n            }\n        }\n\n        \n        \n        \n        if (match_len >= MATCH_LEN_MIN && match_len >= longest_len) {\n            longest_len = match_len;\n            *longest_offset = state->hist_len - hist_search;\n        }\n    }\n\n    return longest_len;\n}\n\n\nvoid uzlib_lz77_compress(uzlib_lz77_state_t *state, const uint8_t *src, unsigned len) {\n    const uint8_t *top = src + len;\n    while (src < top) {\n        \n        size_t match_offset = 0;\n        size_t match_len = uzlib_lz77_search_max_match(state, src, top - src, &match_offset);\n\n        \n        if (match_len == 0) {\n            uzlib_literal(state, *src);\n            match_len = 1;\n        } else {\n            uzlib_match(state, match_offset, match_len);\n        }\n\n        \n        size_t mask = state->hist_max - 1;\n        while (match_len--) {\n            uint8_t b = *src++;\n            state->hist_buf[(state->hist_start + state->hist_len) & mask] = b;\n            if (state->hist_len == state->hist_max) {\n                state->hist_start = (state->hist_start + 1) & mask;\n            } else {\n                ++state->hist_len;\n            }\n        }\n    }\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}