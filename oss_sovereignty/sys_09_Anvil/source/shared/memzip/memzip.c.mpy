{
  "module_name": "memzip.c",
  "hash_id": "c1e948a9a8f1f2abbc376ecf0568852a0a232bd363918724fc189665135a75db",
  "original_prompt": "Ingested from sys_09_Anvil/source/shared/memzip/memzip.c",
  "human_readable_source": "#include <stdint.h>\n#include <stdlib.h>\n#include <string.h>\n#include \"py/mpconfig.h\"\n#include \"py/misc.h\"\n#include \"memzip.h\"\n\nextern uint8_t memzip_data[];\n\nconst MEMZIP_FILE_HDR *memzip_find_file_header(const char *filename) {\n\n    const MEMZIP_FILE_HDR *file_hdr = (const MEMZIP_FILE_HDR *)memzip_data;\n    uint8_t *mem_data;\n\n     \n\n    if (*filename == '/') {\n        filename++;\n    }\n    while (file_hdr->signature == MEMZIP_FILE_HEADER_SIGNATURE) {\n        const char *file_hdr_filename = (const char *)&file_hdr[1];\n        mem_data = (uint8_t *)file_hdr_filename;\n        mem_data += file_hdr->filename_len;\n        mem_data += file_hdr->extra_len;\n        if (!strncmp(file_hdr_filename, filename, file_hdr->filename_len)) {\n             \n            return file_hdr;\n        }\n        mem_data += file_hdr->uncompressed_size;\n        file_hdr = (const MEMZIP_FILE_HDR *)mem_data;\n    }\n    return NULL;\n}\n\nbool memzip_is_dir(const char *filename) {\n    const MEMZIP_FILE_HDR *file_hdr = (const MEMZIP_FILE_HDR *)memzip_data;\n    uint8_t *mem_data;\n\n    if (strcmp(filename, \"/\") == 0) {\n         \n        return true;\n    }\n\n     \n    if (*filename == '/') {\n        filename++;\n    }\n    size_t filename_len = strlen(filename);\n\n    while (file_hdr->signature == MEMZIP_FILE_HEADER_SIGNATURE) {\n        const char *file_hdr_filename = (const char *)&file_hdr[1];\n        if (filename_len < file_hdr->filename_len &&\n            strncmp(file_hdr_filename, filename, filename_len) == 0 &&\n            file_hdr_filename[filename_len] == '/') {\n            return true;\n        }\n\n        mem_data = (uint8_t *)file_hdr_filename;\n        mem_data += file_hdr->filename_len;\n        mem_data += file_hdr->extra_len;\n        mem_data += file_hdr->uncompressed_size;\n        file_hdr = (const MEMZIP_FILE_HDR *)mem_data;\n    }\n    return NULL;\n\n}\n\nMEMZIP_RESULT memzip_locate(const char *filename, void **data, size_t *len)\n{\n    const MEMZIP_FILE_HDR *file_hdr = memzip_find_file_header(filename);\n    if (file_hdr == NULL) {\n        return MZ_NO_FILE;\n    }\n    if (file_hdr->compression_method != 0) {\n        return MZ_FILE_COMPRESSED;\n    }\n\n    uint8_t *mem_data;\n    mem_data = (uint8_t *)&file_hdr[1];\n    mem_data += file_hdr->filename_len;\n    mem_data += file_hdr->extra_len;\n\n    *data = mem_data;\n    *len = file_hdr->uncompressed_size;\n    return MZ_OK;\n}\n\nMEMZIP_RESULT memzip_stat(const char *path, MEMZIP_FILE_INFO *info) {\n    const MEMZIP_FILE_HDR *file_hdr = memzip_find_file_header(path);\n    if (file_hdr == NULL) {\n        if (memzip_is_dir(path)) {\n            info->file_size = 0;\n            info->last_mod_date = 0;\n            info->last_mod_time = 0;\n            info->is_dir = 1;\n            return MZ_OK;\n        }\n        return MZ_NO_FILE;\n    }\n    info->file_size = file_hdr->uncompressed_size;\n    info->last_mod_date = file_hdr->last_mod_date;\n    info->last_mod_time = file_hdr->last_mod_time;\n    info->is_dir = 0;\n\n    return MZ_OK;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}