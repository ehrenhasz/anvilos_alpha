{
  "module_name": "make-memzip.py",
  "hash_id": "f38a177b1c5799ec84c812ff11abfea664dead1e182e8ce4eb0a6e94e835ac78",
  "original_prompt": "Ingested from sys_09_Anvil/source/shared/memzip/make-memzip.py",
  "human_readable_source": "#!/usr/bin/env python\n#\n# Takes a directory of files and zips them up (as uncompressed files).\n# This then gets converted into a C data structure which can be read\n# like a filesystem at runtime.\n#\n# This is somewhat like frozen modules in python, but allows arbitrary files\n# to be used.\n\nfrom __future__ import print_function\n\nimport argparse\nimport os\nimport subprocess\nimport sys\nimport types\n\n\ndef create_zip(zip_filename, zip_dir):\n    abs_zip_filename = os.path.abspath(zip_filename)\n    save_cwd = os.getcwd()\n    os.chdir(zip_dir)\n    if os.path.exists(abs_zip_filename):\n        os.remove(abs_zip_filename)\n    subprocess.check_call([\"zip\", \"-0\", \"-r\", \"-D\", abs_zip_filename, \".\"])\n    os.chdir(save_cwd)\n\n\ndef create_c_from_file(c_filename, zip_filename):\n    with open(zip_filename, \"rb\") as zip_file:\n        with open(c_filename, \"wb\") as c_file:\n            print(\"#include <stdint.h>\", file=c_file)\n            print(\"\", file=c_file)\n            print(\"const uint8_t memzip_data[] = {\", file=c_file)\n            while True:\n                buf = zip_file.read(16)\n                if not buf:\n                    break\n                print(\"   \", end=\"\", file=c_file)\n                for byte in buf:\n                    if isinstance(byte, types.StringType):\n                        print(\" 0x{:02x},\".format(ord(byte)), end=\"\", file=c_file)\n                    else:\n                        print(\" 0x{:02x},\".format(byte), end=\"\", file=c_file)\n                print(\"\", file=c_file)\n            print(\"};\", file=c_file)\n\n\ndef main():\n    parser = argparse.ArgumentParser(\n        prog=\"make-memzip.py\",\n        usage=\"%(prog)s [options] [command]\",\n        description=\"Generates a C source memzip file.\",\n    )\n    parser.add_argument(\n        \"-z\",\n        \"--zip-file\",\n        dest=\"zip_filename\",\n        help=\"Specifies the name of the created zip file.\",\n        default=\"memzip_files.zip\",\n    )\n    parser.add_argument(\n        \"-c\",\n        \"--c-file\",\n        dest=\"c_filename\",\n        help=\"Specifies the name of the created C source file.\",\n        default=\"memzip_files.c\",\n    )\n    parser.add_argument(dest=\"source_dir\", default=\"memzip_files\")\n    args = parser.parse_args(sys.argv[1:])\n\n    print(\"args.zip_filename =\", args.zip_filename)\n    print(\"args.c_filename =\", args.c_filename)\n    print(\"args.source_dir =\", args.source_dir)\n\n    create_zip(args.zip_filename, args.source_dir)\n    create_c_from_file(args.c_filename, args.zip_filename)\n\n\nif __name__ == \"__main__\":\n    main()\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}