{
  "module_name": "printf.c",
  "hash_id": "c53792e94612e025c53eda70f0a4b57422b1a15f5df6ef2a2384cb2d943ef109",
  "original_prompt": "Ingested from sys_09_Anvil/source/shared/libc/printf.c",
  "human_readable_source": " \n\n#include \"py/mpconfig.h\"\n\n#include <stdint.h>\n#include <string.h>\n#include <stdarg.h>\n\n#include \"py/obj.h\"\n#include \"py/mphal.h\"\n\n#if MICROPY_PY_BUILTINS_FLOAT\n#include \"py/formatfloat.h\"\n#endif\n\n#if MICROPY_DEBUG_PRINTERS\nint DEBUG_printf(const char *fmt, ...) {\n    va_list ap;\n    va_start(ap, fmt);\n    int ret = mp_vprintf(MICROPY_DEBUG_PRINTER, fmt, ap);\n    va_end(ap);\n    return ret;\n}\n#endif\n\n#if MICROPY_USE_INTERNAL_PRINTF\n\n#undef putchar  \nint printf(const char *fmt, ...);\nint vprintf(const char *fmt, va_list ap);\nint putchar(int c);\nint puts(const char *s);\nint vsnprintf(char *str, size_t size, const char *fmt, va_list ap);\nint snprintf(char *str, size_t size, const char *fmt, ...);\n\nint printf(const char *fmt, ...) {\n    va_list ap;\n    va_start(ap, fmt);\n    int ret = mp_vprintf(MICROPY_INTERNAL_PRINTF_PRINTER, fmt, ap);\n    va_end(ap);\n    return ret;\n}\n\nint vprintf(const char *fmt, va_list ap) {\n    return mp_vprintf(MICROPY_INTERNAL_PRINTF_PRINTER, fmt, ap);\n}\n\n\nint putchar(int c) {\n    char chr = c;\n    MICROPY_INTERNAL_PRINTF_PRINTER->print_strn(MICROPY_INTERNAL_PRINTF_PRINTER->data, &chr, 1);\n    return chr;\n}\n\n\nint puts(const char *s) {\n    MICROPY_INTERNAL_PRINTF_PRINTER->print_strn(MICROPY_INTERNAL_PRINTF_PRINTER->data, s, strlen(s));\n    return putchar('\\n'); \n}\n\ntypedef struct _strn_print_env_t {\n    char *cur;\n    size_t remain;\n} strn_print_env_t;\n\nstatic void strn_print_strn(void *data, const char *str, size_t len) {\n    strn_print_env_t *strn_print_env = data;\n    if (len > strn_print_env->remain) {\n        len = strn_print_env->remain;\n    }\n    memcpy(strn_print_env->cur, str, len);\n    strn_print_env->cur += len;\n    strn_print_env->remain -= len;\n}\n\n#if defined(__GNUC__) && !defined(__clang__) && __GNUC__ < 9\n\n\n\n\nint __GI_vsnprintf(char *str, size_t size, const char *fmt, va_list ap) __attribute__((weak, alias(\"vsnprintf\")));\n#endif\n\nint vsnprintf(char *str, size_t size, const char *fmt, va_list ap) {\n    strn_print_env_t strn_print_env = {str, size};\n    mp_print_t print = {&strn_print_env, strn_print_strn};\n    int len = mp_vprintf(&print, fmt, ap);\n    \n    if (size > 0) {\n        if (strn_print_env.remain == 0) {\n            strn_print_env.cur[-1] = 0;\n        } else {\n            strn_print_env.cur[0] = 0;\n        }\n    }\n    return len;\n}\n\nint snprintf(char *str, size_t size, const char *fmt, ...) {\n    va_list ap;\n    va_start(ap, fmt);\n    int ret = vsnprintf(str, size, fmt, ap);\n    va_end(ap);\n    return ret;\n}\n\n#endif \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}