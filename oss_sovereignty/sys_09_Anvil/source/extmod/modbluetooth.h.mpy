{
  "module_name": "modbluetooth.h",
  "hash_id": "3f23edda6782a70c6b53c7439197a2a916a44229e966d1e62bfd0f392e0a2c64",
  "original_prompt": "Ingested from sys_09_Anvil/source/extmod/modbluetooth.h",
  "human_readable_source": " \n\n#ifndef MICROPY_INCLUDED_EXTMOD_MODBLUETOOTH_H\n#define MICROPY_INCLUDED_EXTMOD_MODBLUETOOTH_H\n\n#include <stdbool.h>\n\n#include \"py/obj.h\"\n#include \"py/objlist.h\"\n#include \"py/ringbuf.h\"\n\n\n#ifndef MICROPY_PY_BLUETOOTH_RINGBUF_SIZE\n#define MICROPY_PY_BLUETOOTH_RINGBUF_SIZE (128)\n#endif\n\n#ifndef MICROPY_PY_BLUETOOTH_ENABLE_CENTRAL_MODE\n#define MICROPY_PY_BLUETOOTH_ENABLE_CENTRAL_MODE (0)\n#endif\n\n#ifndef MICROPY_PY_BLUETOOTH_ENABLE_GATT_CLIENT\n\n\n#define MICROPY_PY_BLUETOOTH_ENABLE_GATT_CLIENT (MICROPY_PY_BLUETOOTH_ENABLE_CENTRAL_MODE)\n#endif\n\n#ifndef MICROPY_PY_BLUETOOTH_USE_SYNC_EVENTS\n\n\n#define MICROPY_PY_BLUETOOTH_USE_SYNC_EVENTS (0)\n#endif\n\n\n#ifndef MICROPY_PY_BLUETOOTH_ENABLE_L2CAP_CHANNELS\n#define MICROPY_PY_BLUETOOTH_ENABLE_L2CAP_CHANNELS (0)\n#endif\n\n\n\n#ifndef MICROPY_PY_BLUETOOTH_ENABLE_PAIRING_BONDING\n#define MICROPY_PY_BLUETOOTH_ENABLE_PAIRING_BONDING (0)\n#endif\n\n\n\n#ifndef MICROPY_PY_BLUETOOTH_ENABLE_HCI_CMD\n#define MICROPY_PY_BLUETOOTH_ENABLE_HCI_CMD (0)\n#endif\n\n\n\n#ifndef MICROPY_PY_BLUETOOTH_ENTER\n#define MICROPY_PY_BLUETOOTH_ENTER mp_uint_t atomic_state = MICROPY_BEGIN_ATOMIC_SECTION();\n#define MICROPY_PY_BLUETOOTH_EXIT MICROPY_END_ATOMIC_SECTION(atomic_state);\n#endif\n\n\n#ifndef MP_BLUETOOTH_DEFAULT_ATTR_LEN\n#define MP_BLUETOOTH_DEFAULT_ATTR_LEN (20)\n#endif\n\n#define MP_BLUETOOTH_CCCD_LEN (2)\n\n\n#define MP_BLUETOOTH_GAP_ADV_MAX_LEN (32)\n\n\n\n#define MP_BLUETOOTH_CHARACTERISTIC_FLAG_BROADCAST                  (0x0001)\n#define MP_BLUETOOTH_CHARACTERISTIC_FLAG_READ                       (0x0002)\n#define MP_BLUETOOTH_CHARACTERISTIC_FLAG_WRITE_NO_RESPONSE          (0x0004)\n#define MP_BLUETOOTH_CHARACTERISTIC_FLAG_WRITE                      (0x0008)\n#define MP_BLUETOOTH_CHARACTERISTIC_FLAG_NOTIFY                     (0x0010)\n#define MP_BLUETOOTH_CHARACTERISTIC_FLAG_INDICATE                   (0x0020)\n#define MP_BLUETOOTH_CHARACTERISTIC_FLAG_AUTHENTICATED_SIGNED_WRITE (0x0040)\n\n\n\n\n\n\n#define MP_BLUETOOTH_CHARACTERISTIC_FLAG_AUX_WRITE                  (0x0100)\n#define MP_BLUETOOTH_CHARACTERISTIC_FLAG_READ_ENCRYPTED             (0x0200)\n#define MP_BLUETOOTH_CHARACTERISTIC_FLAG_READ_AUTHENTICATED         (0x0400)\n#define MP_BLUETOOTH_CHARACTERISTIC_FLAG_READ_AUTHORIZED            (0x0800)\n#define MP_BLUETOOTH_CHARACTERISTIC_FLAG_WRITE_ENCRYPTED            (0x1000)\n#define MP_BLUETOOTH_CHARACTERISTIC_FLAG_WRITE_AUTHENTICATED        (0x2000)\n#define MP_BLUETOOTH_CHARACTERISTIC_FLAG_WRITE_AUTHORIZED           (0x4000)\n\n\n#define MP_BLUETOOTH_GATTS_NO_ERROR                           (0x00)\n#define MP_BLUETOOTH_GATTS_ERROR_READ_NOT_PERMITTED           (0x02)\n#define MP_BLUETOOTH_GATTS_ERROR_WRITE_NOT_PERMITTED          (0x03)\n#define MP_BLUETOOTH_GATTS_ERROR_INSUFFICIENT_AUTHENTICATION  (0x05)\n#define MP_BLUETOOTH_GATTS_ERROR_INSUFFICIENT_AUTHORIZATION   (0x08)\n#define MP_BLUETOOTH_GATTS_ERROR_INSUFFICIENT_ENCRYPTION      (0x0f)\n\n\n#define MP_BLUETOOTH_WRITE_MODE_NO_RESPONSE     (0)\n#define MP_BLUETOOTH_WRITE_MODE_WITH_RESPONSE   (1)\n\n\n#define MP_BLUETOOTH_UUID_TYPE_16  (2)\n#define MP_BLUETOOTH_UUID_TYPE_32  (4)\n#define MP_BLUETOOTH_UUID_TYPE_128 (16)\n\n\n#define MP_BLUETOOTH_IRQ_CENTRAL_CONNECT                (1)\n#define MP_BLUETOOTH_IRQ_CENTRAL_DISCONNECT             (2)\n#define MP_BLUETOOTH_IRQ_GATTS_WRITE                    (3)\n#define MP_BLUETOOTH_IRQ_GATTS_READ_REQUEST             (4)\n#define MP_BLUETOOTH_IRQ_SCAN_RESULT                    (5)\n#define MP_BLUETOOTH_IRQ_SCAN_DONE                      (6)\n#define MP_BLUETOOTH_IRQ_PERIPHERAL_CONNECT             (7)\n#define MP_BLUETOOTH_IRQ_PERIPHERAL_DISCONNECT          (8)\n#define MP_BLUETOOTH_IRQ_GATTC_SERVICE_RESULT           (9)\n#define MP_BLUETOOTH_IRQ_GATTC_SERVICE_DONE             (10)\n#define MP_BLUETOOTH_IRQ_GATTC_CHARACTERISTIC_RESULT    (11)\n#define MP_BLUETOOTH_IRQ_GATTC_CHARACTERISTIC_DONE      (12)\n#define MP_BLUETOOTH_IRQ_GATTC_DESCRIPTOR_RESULT        (13)\n#define MP_BLUETOOTH_IRQ_GATTC_DESCRIPTOR_DONE          (14)\n#define MP_BLUETOOTH_IRQ_GATTC_READ_RESULT              (15)\n#define MP_BLUETOOTH_IRQ_GATTC_READ_DONE                (16)\n#define MP_BLUETOOTH_IRQ_GATTC_WRITE_DONE               (17)\n#define MP_BLUETOOTH_IRQ_GATTC_NOTIFY                   (18)\n#define MP_BLUETOOTH_IRQ_GATTC_INDICATE                 (19)\n#define MP_BLUETOOTH_IRQ_GATTS_INDICATE_DONE            (20)\n#define MP_BLUETOOTH_IRQ_MTU_EXCHANGED                  (21)\n#define MP_BLUETOOTH_IRQ_L2CAP_ACCEPT                   (22)\n#define MP_BLUETOOTH_IRQ_L2CAP_CONNECT                  (23)\n#define MP_BLUETOOTH_IRQ_L2CAP_DISCONNECT               (24)\n#define MP_BLUETOOTH_IRQ_L2CAP_RECV                     (25)\n#define MP_BLUETOOTH_IRQ_L2CAP_SEND_READY               (26)\n#define MP_BLUETOOTH_IRQ_CONNECTION_UPDATE              (27)\n#define MP_BLUETOOTH_IRQ_ENCRYPTION_UPDATE              (28)\n#define MP_BLUETOOTH_IRQ_GET_SECRET                     (29)\n#define MP_BLUETOOTH_IRQ_SET_SECRET                     (30)\n#define MP_BLUETOOTH_IRQ_PASSKEY_ACTION                 (31)\n\n#define MP_BLUETOOTH_ADDRESS_MODE_PUBLIC (0)\n#define MP_BLUETOOTH_ADDRESS_MODE_RANDOM (1)\n#define MP_BLUETOOTH_ADDRESS_MODE_RPA (2)\n#define MP_BLUETOOTH_ADDRESS_MODE_NRPA (3)\n\n\n#define MP_BLUETOOTH_IO_CAPABILITY_DISPLAY_ONLY        (0)\n#define MP_BLUETOOTH_IO_CAPABILITY_DISPLAY_YESNO       (1)\n#define MP_BLUETOOTH_IO_CAPABILITY_KEYBOARD_ONLY       (2)\n#define MP_BLUETOOTH_IO_CAPABILITY_NO_INPUT_OUTPUT     (3)\n#define MP_BLUETOOTH_IO_CAPABILITY_KEYBOARD_DISPLAY    (4)\n\n\n#define MP_BLUETOOTH_PASSKEY_ACTION_NONE                (0)\n#define MP_BLUETOOTH_PASSKEY_ACTION_INPUT               (2)\n#define MP_BLUETOOTH_PASSKEY_ACTION_DISPLAY             (3)\n#define MP_BLUETOOTH_PASSKEY_ACTION_NUMERIC_COMPARISON  (4)\n\n\n#define MP_BLUETOOTH_PASSKEY_ACTION_NONE                (0)\n#define MP_BLUETOOTH_PASSKEY_ACTION_INPUT               (2)\n#define MP_BLUETOOTH_PASSKEY_ACTION_DISPLAY             (3)\n#define MP_BLUETOOTH_PASSKEY_ACTION_NUMERIC_COMPARISON  (4)\n\n\n#define MP_BLUETOOTH_GATTS_OP_NOTIFY                    (1)\n#define MP_BLUETOOTH_GATTS_OP_INDICATE                  (2)\n\n \n\n \n \n \n \n \n \ntypedef struct {\n    mp_obj_base_t base;\n    uint8_t type;\n    uint8_t data[16];\n} mp_obj_bluetooth_uuid_t;\n\nextern const mp_obj_type_t mp_type_bluetooth_uuid;\n\n \n \n\n \n \n\n\n\n\n\n\n\n\n\n\n\nint mp_bluetooth_init(void);\n\n\nvoid mp_bluetooth_deinit(void);\n\n\nbool mp_bluetooth_is_active(void);\n\n\nvoid mp_bluetooth_get_current_address(uint8_t *addr_type, uint8_t *addr);\n\n\nvoid mp_bluetooth_set_address_mode(uint8_t addr_mode);\n\n#if MICROPY_PY_BLUETOOTH_ENABLE_PAIRING_BONDING\n\nvoid mp_bluetooth_set_bonding(bool enabled);\n\nvoid mp_bluetooth_set_mitm_protection(bool enabled);\n\nvoid mp_bluetooth_set_le_secure(bool enabled);\n\nvoid mp_bluetooth_set_io_capability(uint8_t capability);\n#endif \n\n\nsize_t mp_bluetooth_gap_get_device_name(const uint8_t **buf);\nint mp_bluetooth_gap_set_device_name(const uint8_t *buf, size_t len);\n\n\n\nint mp_bluetooth_gap_advertise_start(bool connectable, int32_t interval_us, const uint8_t *adv_data, size_t adv_data_len, const uint8_t *sr_data, size_t sr_data_len);\n\n\nvoid mp_bluetooth_gap_advertise_stop(void);\n\n\nint mp_bluetooth_gatts_register_service_begin(bool append);\n\n\nint mp_bluetooth_gatts_register_service(mp_obj_bluetooth_uuid_t *service_uuid, mp_obj_bluetooth_uuid_t **characteristic_uuids, uint16_t *characteristic_flags, mp_obj_bluetooth_uuid_t **descriptor_uuids, uint16_t *descriptor_flags, uint8_t *num_descriptors, uint16_t *handles, size_t num_characteristics);\n\nint mp_bluetooth_gatts_register_service_end(void);\n\n\nint mp_bluetooth_gatts_read(uint16_t value_handle, const uint8_t **value, size_t *value_len);\n\nint mp_bluetooth_gatts_write(uint16_t value_handle, const uint8_t *value, size_t value_len, bool send_update);\n\nint mp_bluetooth_gatts_notify_indicate(uint16_t conn_handle, uint16_t value_handle, int gatts_op, const uint8_t *value, size_t value_len);\n\n\n\nint mp_bluetooth_gatts_set_buffer(uint16_t value_handle, size_t len, bool append);\n\n\nint mp_bluetooth_gap_disconnect(uint16_t conn_handle);\n\n\nint mp_bluetooth_get_preferred_mtu(void);\nint mp_bluetooth_set_preferred_mtu(uint16_t mtu);\n\n#if MICROPY_PY_BLUETOOTH_ENABLE_PAIRING_BONDING\n\nint mp_bluetooth_gap_pair(uint16_t conn_handle);\n\n\nint mp_bluetooth_gap_passkey(uint16_t conn_handle, uint8_t action, mp_int_t passkey);\n#endif \n\n#if MICROPY_PY_BLUETOOTH_ENABLE_CENTRAL_MODE\n\nint mp_bluetooth_gap_scan_start(int32_t duration_ms, int32_t interval_us, int32_t window_us, bool active_scan);\n\n\nint mp_bluetooth_gap_scan_stop(void);\n\n\nint mp_bluetooth_gap_peripheral_connect(uint8_t addr_type, const uint8_t *addr, int32_t duration_ms, int32_t min_conn_interval_us, int32_t max_conn_interval_us);\n\n\nint mp_bluetooth_gap_peripheral_connect_cancel(void);\n#endif\n\n#if MICROPY_PY_BLUETOOTH_ENABLE_GATT_CLIENT\n\n\nint mp_bluetooth_gattc_discover_primary_services(uint16_t conn_handle, const mp_obj_bluetooth_uuid_t *uuid);\n\n\nint mp_bluetooth_gattc_discover_characteristics(uint16_t conn_handle, uint16_t start_handle, uint16_t end_handle, const mp_obj_bluetooth_uuid_t *uuid);\n\n\nint mp_bluetooth_gattc_discover_descriptors(uint16_t conn_handle, uint16_t start_handle, uint16_t end_handle);\n\n\nint mp_bluetooth_gattc_read(uint16_t conn_handle, uint16_t value_handle);\n\n\nint mp_bluetooth_gattc_write(uint16_t conn_handle, uint16_t value_handle, const uint8_t *value, size_t value_len, unsigned int mode);\n\n\nint mp_bluetooth_gattc_exchange_mtu(uint16_t conn_handle);\n#endif \n\n#if MICROPY_PY_BLUETOOTH_ENABLE_L2CAP_CHANNELS\nint mp_bluetooth_l2cap_listen(uint16_t psm, uint16_t mtu);\nint mp_bluetooth_l2cap_connect(uint16_t conn_handle, uint16_t psm, uint16_t mtu);\nint mp_bluetooth_l2cap_disconnect(uint16_t conn_handle, uint16_t cid);\nint mp_bluetooth_l2cap_send(uint16_t conn_handle, uint16_t cid, const uint8_t *buf, size_t len, bool *stalled);\nint mp_bluetooth_l2cap_recvinto(uint16_t conn_handle, uint16_t cid, uint8_t *buf, size_t *len);\n#endif \n\n#if MICROPY_PY_BLUETOOTH_ENABLE_HCI_CMD\nint mp_bluetooth_hci_cmd(uint16_t ogf, uint16_t ocf, const uint8_t *req, size_t req_len, uint8_t *resp, size_t resp_len, uint8_t *status);\n#endif \n\n\n\n\n\nvoid mp_bluetooth_gap_on_connected_disconnected(uint8_t event, uint16_t conn_handle, uint8_t addr_type, const uint8_t *addr);\n\n\nvoid mp_bluetooth_gap_on_connection_update(uint16_t conn_handle, uint16_t conn_interval, uint16_t conn_latency, uint16_t supervision_timeout, uint16_t status);\n\n#if MICROPY_PY_BLUETOOTH_ENABLE_PAIRING_BONDING\n\nvoid mp_bluetooth_gatts_on_encryption_update(uint16_t conn_handle, bool encrypted, bool authenticated, bool bonded, uint8_t key_size);\n\n\n\n\n\nbool mp_bluetooth_gap_on_get_secret(uint8_t type, uint8_t index, const uint8_t *key, uint16_t key_len, const uint8_t **value, size_t *value_len);\nbool mp_bluetooth_gap_on_set_secret(uint8_t type, const uint8_t *key, size_t key_len, const uint8_t *value, size_t value_len);\n\n\nvoid mp_bluetooth_gap_on_passkey_action(uint16_t conn_handle, uint8_t action, mp_int_t passkey);\n#endif \n\n\nvoid mp_bluetooth_gatts_on_write(uint16_t conn_handle, uint16_t value_handle);\n\n\nvoid mp_bluetooth_gatts_on_indicate_complete(uint16_t conn_handle, uint16_t value_handle, uint8_t status);\n\n\n\nmp_int_t mp_bluetooth_gatts_on_read_request(uint16_t conn_handle, uint16_t value_handle);\n\n\nvoid mp_bluetooth_gatts_on_mtu_exchanged(uint16_t conn_handle, uint16_t value);\n\n#if MICROPY_PY_BLUETOOTH_ENABLE_CENTRAL_MODE\n\nvoid mp_bluetooth_gap_on_scan_complete(void);\n\n\nvoid mp_bluetooth_gap_on_scan_result(uint8_t addr_type, const uint8_t *addr, uint8_t adv_type, const int8_t rssi, const uint8_t *data, uint16_t data_len);\n#endif \n\n#if MICROPY_PY_BLUETOOTH_ENABLE_GATT_CLIENT\n\nvoid mp_bluetooth_gattc_on_primary_service_result(uint16_t conn_handle, uint16_t start_handle, uint16_t end_handle, mp_obj_bluetooth_uuid_t *service_uuid);\n\n\nvoid mp_bluetooth_gattc_on_characteristic_result(uint16_t conn_handle, uint16_t value_handle, uint16_t end_handle, uint8_t properties, mp_obj_bluetooth_uuid_t *characteristic_uuid);\n\n\nvoid mp_bluetooth_gattc_on_descriptor_result(uint16_t conn_handle, uint16_t handle, mp_obj_bluetooth_uuid_t *descriptor_uuid);\n\n\nvoid mp_bluetooth_gattc_on_discover_complete(uint8_t event, uint16_t conn_handle, uint16_t status);\n\n\nvoid mp_bluetooth_gattc_on_data_available(uint8_t event, uint16_t conn_handle, uint16_t value_handle, const uint8_t **data, uint16_t *data_len, size_t num);\n\n\nvoid mp_bluetooth_gattc_on_read_write_status(uint8_t event, uint16_t conn_handle, uint16_t value_handle, uint16_t status);\n#endif \n\n#if MICROPY_PY_BLUETOOTH_ENABLE_L2CAP_CHANNELS\nmp_int_t mp_bluetooth_on_l2cap_accept(uint16_t conn_handle, uint16_t cid, uint16_t psm, uint16_t our_mtu, uint16_t peer_mtu);\nvoid mp_bluetooth_on_l2cap_connect(uint16_t conn_handle, uint16_t cid, uint16_t psm, uint16_t our_mtu, uint16_t peer_mtu);\nvoid mp_bluetooth_on_l2cap_disconnect(uint16_t conn_handle, uint16_t cid, uint16_t psm, uint16_t status);\nvoid mp_bluetooth_on_l2cap_send_ready(uint16_t conn_handle, uint16_t cid, uint8_t status);\nvoid mp_bluetooth_on_l2cap_recv(uint16_t conn_handle, uint16_t cid);\n#endif \n\n\n\n\ntypedef struct {\n    \n    uint8_t *data;\n    \n    size_t data_alloc;\n    \n    size_t data_len;\n    \n    bool append;\n} mp_bluetooth_gatts_db_entry_t;\n\ntypedef mp_map_t *mp_gatts_db_t;\n\nstatic inline void mp_bluetooth_gatts_db_create(mp_gatts_db_t *db) {\n    *db = m_new(mp_map_t, 1);\n}\n\nstatic inline void mp_bluetooth_gatts_db_reset(mp_gatts_db_t db) {\n    mp_map_init(db, 0);\n}\n\nvoid mp_bluetooth_gatts_db_create_entry(mp_gatts_db_t db, uint16_t handle, size_t len);\nmp_bluetooth_gatts_db_entry_t *mp_bluetooth_gatts_db_lookup(mp_gatts_db_t db, uint16_t handle);\nint mp_bluetooth_gatts_db_read(mp_gatts_db_t db, uint16_t handle, const uint8_t **value, size_t *value_len);\nint mp_bluetooth_gatts_db_write(mp_gatts_db_t db, uint16_t handle, const uint8_t *value, size_t value_len);\nint mp_bluetooth_gatts_db_resize(mp_gatts_db_t db, uint16_t handle, size_t len, bool append);\n\n#endif \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}