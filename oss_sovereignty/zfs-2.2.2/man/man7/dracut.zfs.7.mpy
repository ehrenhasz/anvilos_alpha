{
  "module_name": "dracut.zfs.7",
  "hash_id": "49045822731876790b1f9b0ee92737f8d3002498bb1533775c95f06918e6237c",
  "original_prompt": "Ingested from zfs-2.2.2/man/man7/dracut.zfs.7",
  "human_readable_source": ".\\\" SPDX-License-Identifier: 0BSD\n.\\\"\n.Dd March 28, 2023\n.Dt DRACUT.ZFS 7\n.Os\n.\n.Sh NAME\n.Nm dracut.zfs\n.Nd overview of ZFS dracut hooks\n.\n.Sh SYNOPSIS\n.Bd -literal -compact\n                      parse-zfs.sh \\(-> dracut-cmdline.service\n                          |                     \\(da\n                          |                     \u2026\n                          |                     \\(da\n                          \\e\\(em\\(em\\(em\\(em\\(em\\(em\\(em\\(em\\(-> dracut-initqueue.service\n                                                |                      zfs-import-opts.sh\n   zfs-load-module.service                      \\(da                          |       |\n     |                  |                sysinit.target                    \\(da       |\n     \\(da                  |                       |        zfs-import-scan.service   \\(da\nzfs-import-scan.service \\(da                       \\(da           | zfs-import-cache.service\n     |   zfs-import-cache.service         basic.target      |     |\n     \\e__________________|                       |           \\(da     \\(da\n                        \\(da                       |     zfs-load-key.sh\n     zfs-env-bootfs.service                     |         |\n                        \\(da                       \\(da         \\(da\n                 zfs-import.target \\(-> dracut-pre-mount.service\n                        |          \\(ua            |\n                        | dracut-zfs-generator  |\n                        | _____________________/|\n                        |/                      \\(da\n                        |                   sysroot.mount \\(<-\\(em\\(em\\(em dracut-zfs-generator\n                        |                       |\n                        |                       \\(da\n                        |             initrd-root-fs.target \\(<-\\(em zfs-nonroot-necessities.service\n                        |                       |                                 |\n                        |                       \\(da                                 |\n                        \\(da             dracut-mount.service                        |\n       zfs-snapshot-bootfs.service              |                                 |\n                        |                       \\(da                                 |\n                        \\(da                       \u2026                                 |\n       zfs-rollback-bootfs.service              |                                 |\n                        |                       \\(da                                 |\n                        |          /sysroot/{usr,etc,lib,&c.} \\(<-\\(em\\(em\\(em\\(em\\(em\\(em\\(em\\(em\\(em\\(em\\(em\\(em\\(em\\(em\\(em\\(em\\(em\\(em\\(em/\n                        |                       |\n                        |                       \\(da\n                        |                initrd-fs.target\n                        \\e______________________ |\n                                               \\e|\n                                                \\(da\n        export-zfs.sh                      initrd.target\n              |                                 |\n              \\(da                                 \\(da\n   dracut-shutdown.service                      \u2026\n                                                |\n                                                \\(da\n                 zfs-needshutdown.sh \\(-> initrd-cleanup.service\n.Ed\n.Pp\nCompare\n.Xr dracut.bootup 7\nfor the full flowchart.\n.\n.Sh DESCRIPTION\nUnder dracut, booting with\n.No ZFS-on- Ns Pa /\nis facilitated by a number of hooks in the\n.Nm 90zfs\nmodule.\n.Pp\nBooting into a ZFS dataset requires\n.Sy mountpoint Ns = Ns Pa /\nto be set on the dataset containing the root filesystem (henceforth \"the boot\ndataset\") and at the very least either the\n.Sy bootfs\nproperty to be set to that dataset, or the\n.Sy root=\nkernel cmdline (or dracut drop-in) argument to specify it.\n.Pp\nAll children of the boot dataset with\n.Sy canmount Ns = Ns Sy on\nwith\n.Sy mountpoint Ns s\nmatching\n.Pa /etc , /bin , /lib , /lib?? , /libx32 , No and Pa /usr\nglobs are deemed essential and will be mounted as well.\n.Pp\n.Xr zfs-mount-generator 8\nis recommended for proper functioning of the system afterward (correct mount\nproperties, remounting, &c.).\n.\n.Sh CMDLINE\n.Ss Standard\n.Bl -tag -compact -width \".Sy root=zfs:AUTO , root=zfs: , root=zfs , Op Sy root=\"\n.It Sy root=zfs:\\& Ns Ar dataset , Sy root=ZFS= Ns Ar dataset\nUse\n.Ar dataset\nas the boot dataset.\nAll pluses\n.Pq Sq +\nare replaced with spaces\n.Pq Sq \\  .\n.\n.It Sy root=zfs:AUTO , root=zfs:\\& , root=zfs , Op Sy root=\nAfter import, search for the first pool with the\n.Sy bootfs\nproperty set, use its value as-if specified as the\n.Ar dataset\nabove.\n.\n.It Sy rootfstype=zfs root= Ns Ar dataset\nEquivalent to\n.Sy root=zfs:\\& Ns Ar dataset .\n.\n.It Sy rootfstype=zfs Op Sy root=\nEquivalent to\n.Sy root=zfs:AUTO .\n.\n.It Sy rootflags= Ns Ar flags\nMount the boot dataset with\n.Fl o Ar flags ;\ncf.\\&\n.Sx Temporary Mount Point Properties\nin\n.Xr zfsprops 7 .\nThese properties will not last, since all filesystems will be re-mounted from\nthe real root.\n.\n.It Sy debug\nIf specified,\n.Nm dracut-zfs-generator\nlogs to the journal.\n.El\n.Pp\nBe careful about setting neither\n.Sy rootfstype=zfs\nnor\n.Sy root=zfs:\\& Ns Ar dataset\n\\(em other automatic boot selection methods, like\n.Nm systemd-gpt-auto-generator\nand\n.Nm systemd-fstab-generator\nmight take precedent.\n.\n.Ss ZFS-specific\n.Bl -tag -compact -width \".Sy bootfs.snapshot Ns Op Sy = Ns Ar snapshot-name\"\n.It Sy bootfs.snapshot Ns Op Sy = Ns Ar snapshot-name\nExecute\n.Nm zfs Cm snapshot Ar boot-dataset Ns Sy @ Ns Ar snapshot-name\nbefore pivoting to the real root.\n.Ar snapshot-name\ndefaults to the current kernel release.\n.\n.It Sy bootfs.rollback Ns Op Sy = Ns Ar snapshot-name\nExecute\n.Nm zfs Cm snapshot Fl Rf Ar boot-dataset Ns Sy @ Ns Ar snapshot-name\nbefore pivoting to the real root.\n.Ar snapshot-name\ndefaults to the current kernel release.\n.\n.It Sy spl_hostid= Ns Ar host-id\nUse\n.Xr zgenhostid 8\nto set the host ID to\n.Ar host-id ;\notherwise,\n.Pa /etc/hostid\ninherited from the real root is used.\n.\n.It Sy zfs_force , zfs.force , zfsforce\nAppends\n.Fl f\nto all\n.Nm zpool Cm import\ninvocations; primarily useful in conjunction with\n.Sy spl_hostid= ,\nor if no host ID was inherited.\n.El\n.\n.Sh FILES\n.Bl -tag -width 0\n.It Pa parse-zfs.sh Pq Sy cmdline\nProcesses\n.Sy spl_hostid= .\nIf\n.Sy root=\nmatches a known pattern, above, provides\n.Pa /dev/root\nand delays the initqueue until\n.Xr zfs 4\nis loaded,\n.\n.It Pa zfs-import-opts.sh Pq Nm systemd No environment generator\nTurns\n.Sy zfs_force , zfs.force , No or Sy zfsforce\ninto\n.Ev ZPOOL_IMPORT_OPTS Ns = Ns Fl f\nfor\n.Pa zfs-import-scan.service\nor\n.Pa zfs-import-cache.service .\n.\n.It Pa zfs-load-key.sh Pq Sy pre-mount\nLoads encryption keys for the boot dataset and its essential descendants.\n.Bl -tag -compact -offset 4n -width \".Sy keylocation Ns = Ns Sy https:// Ns Ar URL , Sy keylocation Ns = Ns Sy http:// Ns Ar URL\"\n.It Sy keylocation Ns = Ns Sy prompt\nIs prompted for via\n.Nm systemd-ask-password\nthrice.\n.\n.It Sy keylocation Ns = Ns Sy https:// Ns Ar URL , Sy keylocation Ns = Ns Sy http:// Ns Ar URL\n.Pa network-online.target\nis started before loading.\n.\n.It Sy keylocation Ns = Ns Sy file:// Ns Ar path\nIf\n.Ar path\ndoesn't exist,\n.Nm udevadm No is Cm settle Ns d .\nIf it still doesn't, it's waited for for up to\n.Sy 10 Ns s .\n.El\n.\n.It Pa zfs-env-bootfs.service Pq Nm systemd No service\nAfter pool import, sets\n.Ev BOOTFS Ns =\nin the systemd environment to the first non-null\n.Sy bootfs\nvalue in iteration order.\n.\n.It Pa dracut-zfs-generator Pq Nm systemd No generator\nGenerates\n.Pa sysroot.mount Pq using Sy rootflags= , No if any .\nIf an explicit boot dataset was specified, also generates essential mountpoints\n.Pq Pa sysroot-etc.mount , sysroot-bin.mount , No &c.\\& ,\notherwise generates\n.Pa zfs-nonroot-necessities.service\nwhich mounts them explicitly after\n.Pa /sysroot\nusing\n.Ev BOOTFS Ns = .\n.\n.It Pa zfs-snapshot-bootfs.service , zfs-rollback-bootfs.service Pq Nm systemd No services\nConsume\n.Sy bootfs.snapshot\nand\n.Sy bootfs.rollback\nas described in\n.Sx CMDLINE  .\nUse\n.Ev BOOTFS Ns =\nif no explicit boot dataset was specified.\n.\n.It Pa zfs-needshutdown.sh Pq Sy cleanup\nIf any pools were imported, signals that shutdown hooks are required.\n.\n.It Pa export-zfs.sh Pq Sy shutdown\nForcibly exports all pools.\n.\n.It Pa /etc/hostid , /etc/zfs/zpool.cache , /etc/zfs/vdev_id.conf Pq regular files\nIncluded verbatim, hostonly.\n.\n.It Pa mount-zfs.sh Pq Sy mount\nDoes nothing on\n.Nm systemd\nsystems\n.Pq if Pa dracut-zfs-generator No succeeded .\nOtherwise, loads encryption key for the boot dataset from the console or via\nplymouth.\nIt may not work at all!\n.El\n.\n.Sh SEE ALSO\n.Xr dracut.bootup 7 ,\n.Xr zfsprops 7 ,\n.Xr zpoolprops 7 ,\n.Xr dracut-shutdown.service 8 ,\n.Xr systemd-fstab-generator 8 ,\n.Xr systemd-gpt-auto-generator 8 ,\n.Xr zfs-mount-generator 8 ,\n.Xr zgenhostid 8\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}