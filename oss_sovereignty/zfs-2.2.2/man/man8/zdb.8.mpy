{
  "module_name": "zdb.8",
  "hash_id": "7db95f28124b573326fd3f6dedf6e65584ebdb7df0653da72af56d758159d4a0",
  "original_prompt": "Ingested from zfs-2.2.2/man/man8/zdb.8",
  "human_readable_source": ".\\\"\n.\\\" This file and its contents are supplied under the terms of the\n.\\\" Common Development and Distribution License (\"CDDL\"), version 1.0.\n.\\\" You may only use this file in accordance with the terms of version\n.\\\" 1.0 of the CDDL.\n.\\\"\n.\\\" A full copy of the text of the CDDL should have accompanied this\n.\\\" source.  A copy of the CDDL is also available via the Internet at\n.\\\" http://www.illumos.org/license/CDDL.\n.\\\"\n.\\\" Copyright 2012, Richard Lowe.\n.\\\" Copyright (c) 2012, 2019 by Delphix. All rights reserved.\n.\\\" Copyright 2017 Nexenta Systems, Inc.\n.\\\" Copyright (c) 2017 Lawrence Livermore National Security, LLC.\n.\\\" Copyright (c) 2017 Intel Corporation.\n.\\\"\n.Dd November 18, 2023\n.Dt ZDB 8\n.Os\n.\n.Sh NAME\n.Nm zdb\n.Nd display ZFS storage pool debugging and consistency information\n.Sh SYNOPSIS\n.Nm\n.Op Fl AbcdDFGhikLMNPsTvXYy\n.Op Fl e Oo Fl V Oc Oo Fl p Ar path Oc Ns \u2026\n.Op Fl I Ar inflight-I/O-ops\n.Oo Fl o Ar var Ns = Ns Ar value Oc Ns \u2026\n.Op Fl t Ar txg\n.Op Fl U Ar cache\n.Op Fl x Ar dumpdir\n.Op Fl K Ar key\n.Op Ar poolname Ns Op / Ns Ar dataset Ns | Ns Ar objset-ID\n.Op Ar object Ns | Ns Ar range Ns \u2026\n.Nm\n.Op Fl AdiPv\n.Op Fl e Oo Fl V Oc Oo Fl p Ar path Oc Ns \u2026\n.Op Fl U Ar cache\n.Op Fl K Ar key\n.Ar poolname Ns Op Ar / Ns Ar dataset Ns | Ns Ar objset-ID\n.Op Ar object Ns | Ns Ar range Ns \u2026\n.Nm\n.Fl B\n.Op Fl e Oo Fl V Oc Oo Fl p Ar path Oc Ns \u2026\n.Op Fl U Ar cache\n.Op Fl K Ar key\n.Ar poolname Ns Ar / Ns Ar objset-ID\n.Op Ar backup-flags\n.Nm\n.Fl C\n.Op Fl A\n.Op Fl U Ar cache\n.Op Ar poolname\n.Nm\n.Fl E\n.Op Fl A\n.Ar word0 : Ns Ar word1 Ns :\u2026: Ns Ar word15\n.Nm\n.Fl l\n.Op Fl Aqu\n.Ar device\n.Nm\n.Fl m\n.Op Fl AFLPXY\n.Op Fl e Oo Fl V Oc Oo Fl p Ar path Oc Ns \u2026\n.Op Fl t Ar txg\n.Op Fl U Ar cache\n.Ar poolname Op Ar vdev Oo Ar metaslab Oc Ns \u2026\n.Nm\n.Fl O\n.Op Fl K Ar key\n.Ar dataset path\n.Nm\n.Fl r\n.Op Fl K Ar key\n.Ar dataset path destination\n.Nm\n.Fl R\n.Op Fl A\n.Op Fl e Oo Fl V Oc Oo Fl p Ar path Oc Ns \u2026\n.Op Fl U Ar cache\n.Ar poolname vdev : Ns Ar offset : Ns Oo Ar lsize Ns / Oc Ns Ar psize Ns Op : Ns Ar flags\n.Nm\n.Fl S\n.Op Fl AP\n.Op Fl e Oo Fl V Oc Oo Fl p Ar path Oc Ns \u2026\n.Op Fl U Ar cache\n.Ar poolname\n.\n.Sh DESCRIPTION\nThe\n.Nm\nutility displays information about a ZFS pool useful for debugging and performs\nsome amount of consistency checking.\nIt is a not a general purpose tool and options\n.Pq and facilities\nmay change.\nIt is not a\n.Xr fsck 8\nutility.\n.Pp\nThe output of this command in general reflects the on-disk structure of a ZFS\npool, and is inherently unstable.\nThe precise output of most invocations is not documented, a knowledge of ZFS\ninternals is assumed.\n.Pp\nIf the\n.Ar dataset\nargument does not contain any\n.Qq Sy /\nor\n.Qq Sy @\ncharacters, it is interpreted as a pool name.\nThe root dataset can be specified as\n.Qq Ar pool Ns / .\n.Pp\n.Nm\nis an\n.Qq offline\ntool; it accesses the block devices underneath the pools directly from\nuserspace and does not care if the pool is imported or datasets are mounted\n(or even if the system understands ZFS at all).\nWhen operating on an imported and active pool it is possible, though unlikely,\nthat zdb may interpret inconsistent pool data and behave erratically.\n.\n.Sh OPTIONS\nDisplay options:\n.Bl -tag -width Ds\n.It Fl b , -block-stats\nDisplay statistics regarding the number, size\n.Pq logical, physical and allocated\nand deduplication of blocks.\n.It Fl B , -backup\nGenerate a backup stream, similar to\n.Nm zfs Cm send ,\nbut for the numeric objset ID, and without opening the dataset.\nThis can be useful in recovery scenarios if dataset metadata has become\ncorrupted but the dataset itself is readable.\nThe optional\n.Ar flags\nargument is a string of one or more of the letters\n.Sy e ,\n.Sy L ,\n.Sy c ,\nand\n.Sy w ,\nwhich correspond to the same flags in\n.Xr zfs-send 8 .\n.It Fl c , -checksum\nVerify the checksum of all metadata blocks while printing block statistics\n.Po see\n.Fl b\n.Pc .\n.Pp\nIf specified multiple times, verify the checksums of all blocks.\n.It Fl C , -config\nDisplay information about the configuration.\nIf specified with no other options, instead display information about the cache\nfile\n.Pq Pa /etc/zfs/zpool.cache .\nTo specify the cache file to display, see\n.Fl U .\n.Pp\nIf specified multiple times, and a pool name is also specified display both the\ncached configuration and the on-disk configuration.\nIf specified multiple times with\n.Fl e\nalso display the configuration that would be used were the pool to be imported.\n.It Fl d , -datasets\nDisplay information about datasets.\nSpecified once, displays basic dataset information: ID, create transaction,\nsize, and object count.\nSee\n.Fl N\nfor determining if\n.Ar poolname Ns Op / Ns Ar dataset Ns | Ns Ar objset-ID\nis to use the specified\n.Ar dataset Ns | Ns Ar objset-ID\nas a string (dataset name) or a number (objset ID) when\ndatasets have numeric names.\n.Pp\nIf specified multiple times provides greater and greater verbosity.\n.Pp\nIf object IDs or object ID ranges are specified, display information about\nthose specific objects or ranges only.\n.Pp\nAn object ID range is specified in terms of a colon-separated tuple of\nthe form\n.Ao start Ac : Ns Ao end Ac Ns Op : Ns Ao flags Ac .\nThe fields\n.Ar start\nand\n.Ar end\nare integer object identifiers that denote the upper and lower bounds\nof the range.\nAn\n.Ar end\nvalue of -1 specifies a range with no upper bound.\nThe\n.Ar flags\nfield optionally specifies a set of flags, described below, that control\nwhich object types are dumped.\nBy default, all object types are dumped.\nA minus sign\n.Pq -\nnegates the effect of the flag that follows it and has no effect unless\npreceded by the\n.Ar A\nflag.\nFor example, the range 0:-1:A-d will dump all object types except for\ndirectories.\n.Pp\n.Bl -tag -compact -width Ds\n.It Sy A\nDump all objects (this is the default)\n.It Sy d\nDump ZFS directory objects\n.It Sy f\nDump ZFS plain file objects\n.It Sy m\nDump SPA space map objects\n.It Sy z\nDump ZAP objects\n.It Sy -\nNegate the effect of next flag\n.El\n.It Fl D , -dedup-stats\nDisplay deduplication statistics, including the deduplication ratio\n.Pq Sy dedup ,\ncompression ratio\n.Pq Sy compress ,\ninflation due to the zfs copies property\n.Pq Sy copies ,\nand an overall effective ratio\n.Pq Sy dedup No \\(mu Sy compress No / Sy copies .\n.It Fl DD\nDisplay a histogram of deduplication statistics, showing the allocated\n.Pq physically present on disk\nand referenced\n.Pq logically referenced in the pool\nblock counts and sizes by reference count.\n.It Fl DDD\nDisplay the statistics independently for each deduplication table.\n.It Fl DDDD\nDump the contents of the deduplication tables describing duplicate blocks.\n.It Fl DDDDD\nAlso dump the contents of the deduplication tables describing unique blocks.\n.It Fl E , -embedded-block-pointer Ns = Ns Ar word0 : Ns Ar word1 Ns :\u2026: Ns Ar word15\nDecode and display block from an embedded block pointer specified by the\n.Ar word\narguments.\n.It Fl h , -history\nDisplay pool history similar to\n.Nm zpool Cm history ,\nbut include internal changes, transaction, and dataset information.\n.It Fl i , -intent-logs\nDisplay information about intent log\n.Pq ZIL\nentries relating to each dataset.\nIf specified multiple times, display counts of each intent log transaction type.\n.It Fl k , -checkpointed-state\nExamine the checkpointed state of the pool.\nNote, the on disk format of the pool is not reverted to the checkpointed state.\n.It Fl l , -label Ns = Ns Ar device\nRead the vdev labels and L2ARC header from the specified device.\n.Nm Fl l\nwill return 0 if valid label was found, 1 if error occurred, and 2 if no valid\nlabels were found.\nThe presence of L2ARC header is indicated by a specific\nsequence (L2ARC_DEV_HDR_MAGIC).\nIf there is an accounting error in the size or the number of L2ARC log blocks\n.Nm Fl l\nwill return 1.\nEach unique configuration is displayed only once.\n.It Fl ll Ar device\nIn addition display label space usage stats.\nIf a valid L2ARC header was found\nalso display the properties of log blocks used for restoring L2ARC contents\n(persistent L2ARC).\n.It Fl lll Ar device\nDisplay every configuration, unique or not.\nIf a valid L2ARC header was found\nalso display the properties of log entries in log blocks used for restoring\nL2ARC contents (persistent L2ARC).\n.Pp\nIf the\n.Fl q\noption is also specified, don't print the labels or the L2ARC header.\n.Pp\nIf the\n.Fl u\noption is also specified, also display the uberblocks on this device.\nSpecify multiple times to increase verbosity.\n.It Fl L , -disable-leak-tracking\nDisable leak detection and the loading of space maps.\nBy default,\n.Nm\nverifies that all non-free blocks are referenced, which can be very expensive.\n.It Fl m , -metaslabs\nDisplay the offset, spacemap, free space of each metaslab, all the log\nspacemaps and their obsolete entry statistics.\n.It Fl mm\nAlso display information about the on-disk free space histogram associated with\neach metaslab.\n.It Fl mmm\nDisplay the maximum contiguous free space, the in-core free space histogram, and\nthe percentage of free space in each space map.\n.It Fl mmmm\nDisplay every spacemap record.\n.It Fl M , -metaslab-groups\nDisplay all \"normal\" vdev metaslab group information - per-vdev metaslab count,\nfragmentation,\nand free space histogram, as well as overall pool fragmentation and histogram.\n.It Fl MM\n\"Special\" vdevs are added to -M's normal output.\n.It Fl O , -object-lookups Ns = Ns Ar dataset path\nAlso display information about the maximum contiguous free space and the\npercentage of free space in each space map.\n.It Fl MMM\nDisplay every spacemap record.\n.It Fl N\nSame as\n.Fl d\nbut force zdb to interpret the\n.Op Ar dataset Ns | Ns Ar objset-ID\nin\n.Op Ar poolname Ns Op / Ns Ar dataset Ns | Ns Ar objset-ID\nas a numeric objset ID.\n.It Fl O Ar dataset path\nLook up the specified\n.Ar path\ninside of the\n.Ar dataset\nand display its metadata and indirect blocks.\nSpecified\n.Ar path\nmust be relative to the root of\n.Ar dataset .\nThis option can be combined with\n.Fl v\nfor increasing verbosity.\n.It Fl r , -copy-object Ns = Ns Ar dataset path destination\nCopy the specified\n.Ar path\ninside of the\n.Ar dataset\nto the specified destination.\nSpecified\n.Ar path\nmust be relative to the root of\n.Ar dataset .\nThis option can be combined with\n.Fl v\nfor increasing verbosity.\n.It Xo\n.Fl R , -read-block Ns = Ns Ar poolname vdev : Ns Ar offset : Ns Oo Ar lsize Ns / Oc Ns Ar psize Ns Op : Ns Ar flags\n.Xc\nRead and display a block from the specified device.\nBy default the block is displayed as a hex dump, but see the description of the\n.Sy r\nflag, below.\n.Pp\nThe block is specified in terms of a colon-separated tuple\n.Ar vdev\n.Pq an integer vdev identifier\n.Ar offset\n.Pq the offset within the vdev\n.Ar size\n.Pq the physical size, or logical size / physical size\nof the block to read and, optionally,\n.Ar flags\n.Pq a set of flags, described below .\n.Pp\n.Bl -tag -compact -width \"b offset\"\n.It Sy b Ar offset\nPrint block pointer at hex offset\n.It Sy c\nCalculate and display checksums\n.It Sy d\nDecompress the block.\nSet environment variable\n.Nm ZDB_NO_ZLE\nto skip zle when guessing.\n.It Sy e\nByte swap the block\n.It Sy g\nDump gang block header\n.It Sy i\nDump indirect block\n.It Sy r\nDump raw uninterpreted block data\n.It Sy v\nVerbose output for guessing compression algorithm\n.El\n.It Fl s , -io-stats\nReport statistics on\n.Nm zdb\nI/O.\nDisplay operation counts, bandwidth, and error counts of I/O to the pool from\n.Nm .\n.It Fl S , -simulate-dedup\nSimulate the effects of deduplication, constructing a DDT and then display\nthat DDT as with\n.Fl DD .\n.It Fl T , -brt-stats\nDisplay block reference table (BRT) statistics, including the size of uniques\nblocks cloned, the space saving as a result of cloning, and the saving ratio.\n.It Fl TT\nDisplay the per-vdev BRT statistics, including total references.\n.It Fl TTT\nDump the contents of the block reference tables.\n.It Fl u , -uberblock\nDisplay the current uberblock.\n.El\n.Pp\nOther options:\n.Bl -tag -width Ds\n.It Fl A , -ignore-assertions\nDo not abort should any assertion fail.\n.It Fl AA\nEnable panic recovery, certain errors which would otherwise be fatal are\ndemoted to warnings.\n.It Fl AAA\nDo not abort if asserts fail and also enable panic recovery.\n.It Fl e , -exported Ns = Ns Oo Fl p Ar path Oc Ns \u2026\nOperate on an exported pool, not present in\n.Pa /etc/zfs/zpool.cache .\nThe\n.Fl p\nflag specifies the path under which devices are to be searched.\n.It Fl x , -dump-blocks Ns = Ns Ar dumpdir\nAll blocks accessed will be copied to files in the specified directory.\nThe blocks will be placed in sparse files whose name is the same as\nthat of the file or device read.\n.Nm\ncan be then run on the generated files.\nNote that the\n.Fl bbc\nflags are sufficient to access\n.Pq and thus copy\nall metadata on the pool.\n.It Fl F , -automatic-rewind\nAttempt to make an unreadable pool readable by trying progressively older\ntransactions.\n.It Fl G , -dump-debug-msg\nDump the contents of the zfs_dbgmsg buffer before exiting\n.Nm .\nzfs_dbgmsg is a buffer used by ZFS to dump advanced debug information.\n.It Fl I , -inflight Ns = Ns Ar inflight-I/O-ops\nLimit the number of outstanding checksum I/O operations to the specified value.\nThe default value is 200.\nThis option affects the performance of the\n.Fl c\noption.\n.It Fl K , -key Ns = Ns Ar key\nDecryption key needed to access an encrypted dataset.\nThis will cause\n.Nm\nto attempt to unlock the dataset using the encryption root, key format and other\nencryption parameters on the given dataset.\n.Nm\ncan still inspect pool and dataset structures on encrypted datasets without\nunlocking them, but will not be able to access file names and attributes and\nobject contents. \\fBWARNING:\\fP The raw decryption key and any decrypted data\nwill be in user memory while\n.Nm\nis running.\nOther user programs may be able to extract it by inspecting\n.Nm\nas it runs.\nExercise extreme caution when using this option in shared or uncontrolled\nenvironments.\n.It Fl o , -option Ns = Ns Ar var Ns = Ns Ar value Ns \u2026\nSet the given global libzpool variable to the provided value.\nThe value must be an unsigned 32-bit integer.\nCurrently only little-endian systems are supported to avoid accidentally setting\nthe high 32 bits of 64-bit variables.\n.It Fl P , -parseable\nPrint numbers in an unscaled form more amenable to parsing, e.g.\\&\n.Sy 1000000\nrather than\n.Sy 1M .\n.It Fl t , -txg Ns = Ns Ar transaction\nSpecify the highest transaction to use when searching for uberblocks.\nSee also the\n.Fl u\nand\n.Fl l\noptions for a means to see the available uberblocks and their associated\ntransaction numbers.\n.It Fl U , -cachefile Ns = Ns Ar cachefile\nUse a cache file other than\n.Pa /etc/zfs/zpool.cache .\n.It Fl v , -verbose\nEnable verbosity.\nSpecify multiple times for increased verbosity.\n.It Fl V , -verbatim\nAttempt verbatim import.\nThis mimics the behavior of the kernel when loading a pool from a cachefile.\nOnly usable with\n.Fl e .\n.It Fl X , -extreme-rewind\nAttempt\n.Qq extreme\ntransaction rewind, that is attempt the same recovery as\n.Fl F\nbut read transactions otherwise deemed too old.\n.It Fl Y , -all-reconstruction\nAttempt all possible combinations when reconstructing indirect split blocks.\nThis flag disables the individual I/O deadman timer in order to allow as\nmuch time as required for the attempted reconstruction.\n.It Fl y , -livelist\nPerform validation for livelists that are being deleted.\nScans through the livelist and metaslabs, checking for duplicate entries\nand compares the two, checking for potential double frees.\nIf it encounters issues, warnings will be printed, but the command will not\nnecessarily fail.\n.El\n.Pp\nSpecifying a display option more than once enables verbosity for only that\noption, with more occurrences enabling more verbosity.\n.Pp\nIf no options are specified, all information about the named pool will be\ndisplayed at default verbosity.\n.\n.Sh EXAMPLES\n.Ss Example 1 : No Display the configuration of imported pool Ar rpool\n.Bd -literal\n.No # Nm zdb Fl C Ar rpool\nMOS Configuration:\n        version: 28\n        name: 'rpool'\n \u2026\n.Ed\n.\n.Ss Example 2 : No Display basic dataset information about Ar rpool\n.Bd -literal\n.No # Nm zdb Fl d Ar rpool\nDataset mos [META], ID 0, cr_txg 4, 26.9M, 1051 objects\nDataset rpool/swap [ZVOL], ID 59, cr_txg 356, 486M, 2 objects\n \u2026\n.Ed\n.\n.Ss Example 3 : No Display basic information about object 0 in Ar rpool/export/home\n.Bd -literal\n.No # Nm zdb Fl d Ar rpool/export/home 0\nDataset rpool/export/home [ZPL], ID 137, cr_txg 1546, 32K, 8 objects\n\n    Object  lvl   iblk   dblk  dsize  lsize   %full  type\n         0    7    16K    16K  15.0K    16K   25.00  DMU dnode\n.Ed\n.\n.Ss Example 4 : No Display the predicted effect of enabling deduplication on Ar rpool\n.Bd -literal\n.No # Nm zdb Fl S Ar rpool\nSimulated DDT histogram:\n\nbucket              allocated                       referenced\n______   ______________________________   ______________________________\nrefcnt   blocks   LSIZE   PSIZE   DSIZE   blocks   LSIZE   PSIZE   DSIZE\n------   ------   -----   -----   -----   ------   -----   -----   -----\n     1     694K   27.1G   15.0G   15.0G     694K   27.1G   15.0G   15.0G\n     2    35.0K   1.33G    699M    699M    74.7K   2.79G   1.45G   1.45G\n \u2026\ndedup = 1.11, compress = 1.80, copies = 1.00, dedup * compress / copies = 2.00\n.Ed\n.\n.Sh SEE ALSO\n.Xr zfs 8 ,\n.Xr zpool 8\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}