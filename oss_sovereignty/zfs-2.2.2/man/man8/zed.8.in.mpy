{
  "module_name": "zed.8.in",
  "hash_id": "77820739e7ab83c1b7ee81b230a9f6f0a17e7d6161b872a00cbce19712c005ab",
  "original_prompt": "Ingested from zfs-2.2.2/man/man8/zed.8.in",
  "human_readable_source": ".\\\"\n.\\\" This file is part of the ZFS Event Daemon (ZED).\n.\\\" Developed at Lawrence Livermore National Laboratory (LLNL-CODE-403049).\n.\\\" Copyright (C) 2013-2014 Lawrence Livermore National Security, LLC.\n.\\\" Refer to the OpenZFS git commit log for authoritative copyright attribution.\n.\\\"\n.\\\" The contents of this file are subject to the terms of the\n.\\\" Common Development and Distribution License Version 1.0 (CDDL-1.0).\n.\\\" You can obtain a copy of the license from the top-level file\n.\\\" \"OPENSOLARIS.LICENSE\" or at <http://opensource.org/licenses/CDDL-1.0>.\n.\\\" You may not use this file except in compliance with the license.\n.\\\"\n.\\\" Developed at Lawrence Livermore National Laboratory (LLNL-CODE-403049)\n.\\\"\n.Dd May 26, 2021\n.Dt ZED 8\n.Os\n.\n.Sh NAME\n.Nm ZED\n.Nd ZFS Event Daemon\n.Sh SYNOPSIS\n.Nm\n.Op Fl fFhILMvVZ\n.Op Fl d Ar zedletdir\n.Op Fl p Ar pidfile\n.Op Fl P Ar path\n.Op Fl s Ar statefile\n.Op Fl j Ar jobs\n.Op Fl b Ar buflen\n.\n.Sh DESCRIPTION\nThe\n.Nm\n(ZFS Event Daemon) monitors events generated by the ZFS kernel\nmodule.\nWhen a zevent (ZFS Event) is posted, the\n.Nm\nwill run any ZEDLETs (ZFS Event Daemon Linkage for Executable Tasks)\nthat have been enabled for the corresponding zevent class.\n.\n.Sh OPTIONS\n.Bl -tag -width \"-h\"\n.It Fl h\nDisplay a summary of the command-line options.\n.It Fl L\nDisplay license information.\n.It Fl V\nDisplay version information.\n.It Fl v\nBe verbose.\n.It Fl f\nForce the daemon to run if at all possible, disabling security checks and\nthrowing caution to the wind.\nNot recommended for use in production.\n.It Fl F\nDon't daemonise: remain attached to the controlling terminal,\nlog to the standard I/O streams.\n.It Fl M\nLock all current and future pages in the virtual memory address space.\nThis may help the daemon remain responsive when the system is under heavy\nmemory pressure.\n.It Fl I\nRequest that the daemon idle rather than exit when the kernel modules are not\nloaded.\nProcessing of events will start, or resume, when the kernel modules are\n(re)loaded.\nUnder Linux the kernel modules cannot be unloaded while the daemon is running.\n.It Fl Z\nZero the daemon's state, thereby allowing zevents still within the kernel\nto be reprocessed.\n.It Fl d Ar zedletdir\nRead the enabled ZEDLETs from the specified directory.\n.It Fl p Ar pidfile\nWrite the daemon's process ID to the specified file.\n.It Fl P Ar path\nCustom\n.Ev $PATH\nfor zedlets to use.\nNormally zedlets run in a locked-down environment, with hardcoded paths to the\nZFS commands\n.Pq Ev $ZFS , $ZPOOL , $ZED , \u2026 ,\nand a hard-coded\n.Ev $PATH .\nThis is done for security reasons.\nHowever, the ZFS test suite uses a custom PATH for its ZFS commands, and passes\nit to\n.Nm\nwith\n.Fl P .\nIn short,\n.Fl P\nis only to be used by the ZFS test suite; never use\nit in production!\n.It Fl s Ar statefile\nWrite the daemon's state to the specified file.\n.It Fl j Ar jobs\nAllow at most\n.Ar jobs\nZEDLETs to run concurrently,\ndelaying execution of new ones until they finish.\nDefaults to\n.Sy 16 .\n.It Fl b Ar buflen\nCap kernel event buffer growth to\n.Ar buflen\nentries.\nThis buffer is grown when the daemon misses an event, but results in\nunreclaimable memory use in the kernel.\nA value of\n.Sy 0\nremoves the cap.\nDefaults to\n.Sy 1048576 .\n.El\n.Sh ZEVENTS\nA zevent is comprised of a list of nvpairs (name/value pairs).\nEach zevent contains an EID (Event IDentifier) that uniquely identifies it\nthroughout\nthe lifetime of the loaded ZFS kernel module; this EID is a monotonically\nincreasing integer that resets to 1 each time the kernel module is loaded.\nEach zevent also contains a class string that identifies the type of event.\nFor brevity, a subclass string is defined that omits the leading components\nof the class string.\nAdditional nvpairs exist to provide event details.\n.Pp\nThe kernel maintains a list of recent zevents that can be viewed (along with\ntheir associated lists of nvpairs) using the\n.Nm zpool Cm events Fl v\ncommand.\n.\n.Sh CONFIGURATION\nZEDLETs to be invoked in response to zevents are located in the\n.Em enabled-zedlets\ndirectory\n.Pq Ar zedletdir .\nThese can be symlinked or copied from the\n.Em installed-zedlets\ndirectory; symlinks allow for automatic updates\nfrom the installed ZEDLETs, whereas copies preserve local modifications.\nAs a security measure, since ownership change is a privileged operation,\nZEDLETs must be owned by root.\nThey must have execute permissions for the user,\nbut they must not have write permissions for group or other.\nDotfiles are ignored.\n.Pp\nZEDLETs are named after the zevent class for which they should be invoked.\nIn particular, a ZEDLET will be invoked for a given zevent if either its\nclass or subclass string is a prefix of its filename (and is followed by\na non-alphabetic character).\nAs a special case, the prefix\n.Sy all\nmatches all zevents.\nMultiple ZEDLETs may be invoked for a given zevent.\n.\n.Sh ZEDLETS\nZEDLETs are executables invoked by the ZED in response to a given zevent.\nThey should be written under the presumption they can be invoked concurrently,\nand they should use appropriate locking to access any shared resources.\nCommon variables used by ZEDLETs can be stored in the default rc file which\nis sourced by scripts; these variables should be prefixed with\n.Sy ZED_ .\n.Pp\nThe zevent nvpairs are passed to ZEDLETs as environment variables.\nEach nvpair name is converted to an environment variable in the following\nmanner:\n.Bl -enum -compact\n.It\nit is prefixed with\n.Sy ZEVENT_ ,\n.It\nit is converted to uppercase, and\n.It\neach non-alphanumeric character is converted to an underscore.\n.El\n.Pp\nSome additional environment variables have been defined to present certain\nnvpair values in a more convenient form.\nAn incomplete list of zevent environment variables is as follows:\n.Bl -tag -compact -width \"ZEVENT_TIME_STRING\"\n.It Sy ZEVENT_EID\nThe Event IDentifier.\n.It Sy ZEVENT_CLASS\nThe zevent class string.\n.It Sy ZEVENT_SUBCLASS\nThe zevent subclass string.\n.It Sy ZEVENT_TIME\nThe time at which the zevent was posted as\n.Dq Em seconds nanoseconds\nsince the Epoch.\n.It Sy ZEVENT_TIME_SECS\nThe\n.Em seconds\ncomponent of\n.Sy ZEVENT_TIME .\n.It Sy ZEVENT_TIME_NSECS\nThe\n.Em nanoseconds\ncomponent of\n.Sy ZEVENT_TIME .\n.It Sy ZEVENT_TIME_STRING\nAn almost-RFC3339-compliant string for\n.Sy ZEVENT_TIME .\n.El\n.Pp\nAdditionally, the following ZED & ZFS variables are defined:\n.Bl -tag -compact -width \"ZEVENT_TIME_STRING\"\n.It Sy ZED_PID\nThe daemon's process ID.\n.It Sy ZED_ZEDLET_DIR\nThe daemon's current\n.Em enabled-zedlets\ndirectory.\n.It Sy ZFS_ALIAS\nThe alias\n.Pq Dq Em name Ns - Ns Em version Ns - Ns Em release\nstring of the ZFS distribution the daemon is part of.\n.It Sy ZFS_VERSION\nThe ZFS version the daemon is part of.\n.It Sy ZFS_RELEASE\nThe ZFS release the daemon is part of.\n.El\n.Pp\nZEDLETs may need to call other ZFS commands.\nThe installation paths of the following executables are defined as environment\nvariables:\n.Sy ZDB ,\n.Sy ZED ,\n.Sy ZFS ,\n.Sy ZINJECT ,\nand\n.Sy ZPOOL .\nThese variables may be overridden in the rc file.\n.\n.Sh FILES\n.Bl -tag -width \"-c\"\n.It Pa @sysconfdir@/zfs/zed.d\nThe default directory for enabled ZEDLETs.\n.It Pa @sysconfdir@/zfs/zed.d/zed.rc\nThe default rc file for common variables used by ZEDLETs.\n.It Pa @zfsexecdir@/zed.d\nThe default directory for installed ZEDLETs.\n.It Pa @runstatedir@/zed.pid\nThe default file containing the daemon's process ID.\n.It Pa @runstatedir@/zed.state\nThe default file containing the daemon's state.\n.El\n.\n.Sh SIGNALS\n.Bl -tag -width \"-c\"\n.It Sy SIGHUP\nReconfigure the daemon and rescan the directory for enabled ZEDLETs.\n.It Sy SIGTERM , SIGINT\nTerminate the daemon.\n.El\n.\n.Sh SEE ALSO\n.Xr zfs 8 ,\n.Xr zpool 8 ,\n.Xr zpool-events 8\n.\n.Sh NOTES\nThe\n.Nm\nrequires root privileges.\n.Pp\nDo not taunt the\n.Nm .\n.\n.Sh BUGS\nZEDLETs are unable to return state/status information to the kernel.\n.Pp\nInternationalization support via gettext has not been added.\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}