{
  "module_name": "zfs-recv.8",
  "hash_id": "556869f6a8c31e642563be61289525f0b85346e678fc9b171a04cddd69c31436",
  "original_prompt": "Ingested from zfs-2.2.2/man/man8/zfs-recv.8",
  "human_readable_source": ".\\\"\n.\\\" CDDL HEADER START\n.\\\"\n.\\\" The contents of this file are subject to the terms of the\n.\\\" Common Development and Distribution License (the \"License\").\n.\\\" You may not use this file except in compliance with the License.\n.\\\"\n.\\\" You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE\n.\\\" or https://opensource.org/licenses/CDDL-1.0.\n.\\\" See the License for the specific language governing permissions\n.\\\" and limitations under the License.\n.\\\"\n.\\\" When distributing Covered Code, include this CDDL HEADER in each\n.\\\" file and include the License file at usr/src/OPENSOLARIS.LICENSE.\n.\\\" If applicable, add the following below this CDDL HEADER, with the\n.\\\" fields enclosed by brackets \"[]\" replaced with your own identifying\n.\\\" information: Portions Copyright [yyyy] [name of copyright owner]\n.\\\"\n.\\\" CDDL HEADER END\n.\\\"\n.\\\" Copyright (c) 2009 Sun Microsystems, Inc. All Rights Reserved.\n.\\\" Copyright 2011 Joshua M. Clulow <josh@sysmgr.org>\n.\\\" Copyright (c) 2011, 2019 by Delphix. All rights reserved.\n.\\\" Copyright (c) 2013 by Saso Kiselkov. All rights reserved.\n.\\\" Copyright (c) 2014, Joyent, Inc. All rights reserved.\n.\\\" Copyright (c) 2014 by Adam Stevko. All rights reserved.\n.\\\" Copyright (c) 2014 Integros [integros.com]\n.\\\" Copyright 2019 Richard Laager. All rights reserved.\n.\\\" Copyright 2018 Nexenta Systems, Inc.\n.\\\" Copyright 2019 Joyent, Inc.\n.\\\"\n.Dd March 12, 2023\n.Dt ZFS-RECEIVE 8\n.Os\n.\n.Sh NAME\n.Nm zfs-receive\n.Nd create snapshot from backup stream\n.Sh SYNOPSIS\n.Nm zfs\n.Cm receive\n.Op Fl FhMnsuv\n.Op Fl o Sy origin Ns = Ns Ar snapshot\n.Op Fl o Ar property Ns = Ns Ar value\n.Op Fl x Ar property\n.Ar filesystem Ns | Ns Ar volume Ns | Ns Ar snapshot\n.Nm zfs\n.Cm receive\n.Op Fl FhMnsuv\n.Op Fl d Ns | Ns Fl e\n.Op Fl o Sy origin Ns = Ns Ar snapshot\n.Op Fl o Ar property Ns = Ns Ar value\n.Op Fl x Ar property\n.Ar filesystem\n.Nm zfs\n.Cm receive\n.Fl A\n.Ar filesystem Ns | Ns Ar volume\n.Nm zfs\n.Cm receive\n.Fl c\n.Op Fl vn\n.Ar filesystem Ns | Ns Ar snapshot\n.\n.Sh DESCRIPTION\n.Bl -tag -width \"\"\n.It Xo\n.Nm zfs\n.Cm receive\n.Op Fl FhMnsuv\n.Op Fl o Sy origin Ns = Ns Ar snapshot\n.Op Fl o Ar property Ns = Ns Ar value\n.Op Fl x Ar property\n.Ar filesystem Ns | Ns Ar volume Ns | Ns Ar snapshot\n.Xc\n.It Xo\n.Nm zfs\n.Cm receive\n.Op Fl FhMnsuv\n.Op Fl d Ns | Ns Fl e\n.Op Fl o Sy origin Ns = Ns Ar snapshot\n.Op Fl o Ar property Ns = Ns Ar value\n.Op Fl x Ar property\n.Ar filesystem\n.Xc\nCreates a snapshot whose contents are as specified in the stream provided on\nstandard input.\nIf a full stream is received, then a new file system is created as well.\nStreams are created using the\n.Nm zfs Cm send\nsubcommand, which by default creates a full stream.\n.Nm zfs Cm recv\ncan be used as an alias for\n.Nm zfs Cm receive .\n.Pp\nIf an incremental stream is received, then the destination file system must\nalready exist, and its most recent snapshot must match the incremental stream's\nsource.\nFor\n.Sy zvols ,\nthe destination device link is destroyed and recreated, which means the\n.Sy zvol\ncannot be accessed during the\n.Cm receive\noperation.\n.Pp\nWhen a snapshot replication package stream that is generated by using the\n.Nm zfs Cm send Fl R\ncommand is received, any snapshots that do not exist on the sending location are\ndestroyed by using the\n.Nm zfs Cm destroy Fl d\ncommand.\n.Pp\nThe ability to send and receive deduplicated send streams has been removed.\nHowever, a deduplicated send stream created with older software can be converted\nto a regular (non-deduplicated) stream by using the\n.Nm zstream Cm redup\ncommand.\n.Pp\nIf\n.Fl o Em property Ns = Ns Ar value\nor\n.Fl x Em property\nis specified, it applies to the effective value of the property throughout\nthe entire subtree of replicated datasets.\nEffective property values will be set\n.Pq Fl o\nor inherited\n.Pq Fl x\non the topmost in the replicated subtree.\nIn descendant datasets, if the\nproperty is set by the send stream, it will be overridden by forcing the\nproperty to be inherited from the top\u2010most file system.\nReceived properties are retained in spite of being overridden\nand may be restored with\n.Nm zfs Cm inherit Fl S .\nSpecifying\n.Fl o Sy origin Ns = Ns Em snapshot\nis a special case because, even if\n.Sy origin\nis a read-only property and cannot be set, it's allowed to receive the send\nstream as a clone of the given snapshot.\n.Pp\nRaw encrypted send streams (created with\n.Nm zfs Cm send Fl w )\nmay only be received as is, and cannot be re-encrypted, decrypted, or\nrecompressed by the receive process.\nUnencrypted streams can be received as\nencrypted datasets, either through inheritance or by specifying encryption\nparameters with the\n.Fl o\noptions.\nNote that the\n.Sy keylocation\nproperty cannot be overridden to\n.Sy prompt\nduring a receive.\nThis is because the receive process itself is already using\nthe standard input for the send stream.\nInstead, the property can be overridden after the receive completes.\n.Pp\nThe added security provided by raw sends adds some restrictions to the send\nand receive process.\nZFS will not allow a mix of raw receives and non-raw receives.\nSpecifically, any raw incremental receives that are attempted after\na non-raw receive will fail.\nNon-raw receives do not have this restriction and,\ntherefore, are always possible.\nBecause of this, it is best practice to always\nuse either raw sends for their security benefits or non-raw sends for their\nflexibility when working with encrypted datasets, but not a combination.\n.Pp\nThe reason for this restriction stems from the inherent restrictions of the\nAEAD ciphers that ZFS uses to encrypt data.\nWhen using ZFS native encryption,\neach block of data is encrypted against a randomly generated number known as\nthe \"initialization vector\" (IV), which is stored in the filesystem metadata.\nThis number is required by the encryption algorithms whenever the data is to\nbe decrypted.\nTogether, all of the IVs provided for all of the blocks in a\ngiven snapshot are collectively called an \"IV set\".\nWhen ZFS performs a raw send, the IV set is transferred from the source\nto the destination in the send stream.\nWhen ZFS performs a non-raw send, the data is decrypted by the source\nsystem and re-encrypted by the destination system, creating a snapshot with\neffectively the same data, but a different IV set.\nIn order for decryption to work after a raw send, ZFS must ensure that\nthe IV set used on both the source and destination side match.\nWhen an incremental raw receive is performed on\ntop of an existing snapshot, ZFS will check to confirm that the \"from\"\nsnapshot on both the source and destination were using the same IV set,\nensuring the new IV set is consistent.\n.Pp\nThe name of the snapshot\n.Pq and file system, if a full stream is received\nthat this subcommand creates depends on the argument type and the use of the\n.Fl d\nor\n.Fl e\noptions.\n.Pp\nIf the argument is a snapshot name, the specified\n.Ar snapshot\nis created.\nIf the argument is a file system or volume name, a snapshot with the same name\nas the sent snapshot is created within the specified\n.Ar filesystem\nor\n.Ar volume .\nIf neither of the\n.Fl d\nor\n.Fl e\noptions are specified, the provided target snapshot name is used exactly as\nprovided.\n.Pp\nThe\n.Fl d\nand\n.Fl e\noptions cause the file system name of the target snapshot to be determined by\nappending a portion of the sent snapshot's name to the specified target\n.Ar filesystem .\nIf the\n.Fl d\noption is specified, all but the first element of the sent snapshot's file\nsystem path\n.Pq usually the pool name\nis used and any required intermediate file systems within the specified one are\ncreated.\nIf the\n.Fl e\noption is specified, then only the last element of the sent snapshot's file\nsystem name\n.Pq i.e. the name of the source file system itself\nis used as the target file system name.\n.Bl -tag -width \"-F\"\n.It Fl F\nForce a rollback of the file system to the most recent snapshot before\nperforming the receive operation.\nIf receiving an incremental replication stream\n.Po for example, one generated by\n.Nm zfs Cm send Fl R Op Fl i Ns | Ns Fl I\n.Pc ,\ndestroy snapshots and file systems that do not exist on the sending side.\n.It Fl d\nDiscard the first element of the sent snapshot's file system name, using the\nremaining elements to determine the name of the target file system for the new\nsnapshot as described in the paragraph above.\n.It Fl e\nDiscard all but the last element of the sent snapshot's file system name, using\nthat element to determine the name of the target file system for the new\nsnapshot as described in the paragraph above.\n.It Fl h\nSkip the receive of holds.\nThere is no effect if holds are not sent.\n.It Fl M\nForce an unmount of the file system while receiving a snapshot.\nThis option is not supported on Linux.\n.It Fl n\nDo not actually receive the stream.\nThis can be useful in conjunction with the\n.Fl v\noption to verify the name the receive operation would use.\n.It Fl o Sy origin Ns = Ns Ar snapshot\nForces the stream to be received as a clone of the given snapshot.\nIf the stream is a full send stream, this will create the filesystem\ndescribed by the stream as a clone of the specified snapshot.\nWhich snapshot was specified will not affect the success or failure of the\nreceive, as long as the snapshot does exist.\nIf the stream is an incremental send stream, all the normal verification will be\nperformed.\n.It Fl o Em property Ns = Ns Ar value\nSets the specified property as if the command\n.Nm zfs Cm set Em property Ns = Ns Ar value\nwas invoked immediately before the receive.\nWhen receiving a stream from\n.Nm zfs Cm send Fl R ,\ncauses the property to be inherited by all descendant datasets, as through\n.Nm zfs Cm inherit Em property\nwas run on any descendant datasets that have this property set on the\nsending system.\n.Pp\nIf the send stream was sent with\n.Fl c\nthen overriding the\n.Sy compression\nproperty will have no effect on received data but the\n.Sy compression\nproperty will be set.\nTo have the data recompressed on receive remove the\n.Fl c\nflag from the send stream.\n.Pp\nAny editable property can be set at receive time.\nSet-once properties bound\nto the received data, such as\n.Sy normalization\nand\n.Sy casesensitivity ,\ncannot be set at receive time even when the datasets are newly created by\n.Nm zfs Cm receive .\nAdditionally both settable properties\n.Sy version\nand\n.Sy volsize\ncannot be set at receive time.\n.Pp\nThe\n.Fl o\noption may be specified multiple times, for different properties.\nAn error results if the same property is specified in multiple\n.Fl o\nor\n.Fl x\noptions.\n.Pp\nThe\n.Fl o\noption may also be used to override encryption properties upon initial receive.\nThis allows unencrypted streams to be received as encrypted datasets.\nTo cause the received dataset (or root dataset of a recursive stream) to be\nreceived as an encryption root, specify encryption properties in the same\nmanner as is required for\n.Nm zfs Cm create .\nFor instance:\n.Dl # Nm zfs Cm send Pa tank/test@snap1 | Nm zfs Cm recv Fl o Sy encryption Ns = Ns Sy on Fl o Sy keyformat Ns = Ns Sy passphrase Fl o Sy keylocation Ns = Ns Pa file:///path/to/keyfile\n.Pp\nNote that\n.Fl o Sy keylocation Ns = Ns Sy prompt\nmay not be specified here, since the standard input\nis already being utilized for the send stream.\nOnce the receive has completed, you can use\n.Nm zfs Cm set\nto change this setting after the fact.\nSimilarly, you can receive a dataset as an encrypted child by specifying\n.Fl x Sy encryption\nto force the property to be inherited.\nOverriding encryption properties (except for\n.Sy keylocation )\nis not possible with raw send streams.\n.It Fl s\nIf the receive is interrupted, save the partially received state, rather\nthan deleting it.\nInterruption may be due to premature termination of the stream\n.Po e.g. due to network failure or failure of the remote system\nif the stream is being read over a network connection\n.Pc ,\na checksum error in the stream, termination of the\n.Nm zfs Cm receive\nprocess, or unclean shutdown of the system.\n.Pp\nThe receive can be resumed with a stream generated by\n.Nm zfs Cm send Fl t Ar token ,\nwhere the\n.Ar token\nis the value of the\n.Sy receive_resume_token\nproperty of the filesystem or volume which is received into.\n.Pp\nTo use this flag, the storage pool must have the\n.Sy extensible_dataset\nfeature enabled.\nSee\n.Xr zpool-features 7\nfor details on ZFS feature flags.\n.It Fl u\nFile system that is associated with the received stream is not mounted.\n.It Fl v\nPrint verbose information about the stream and the time required to perform the\nreceive operation.\n.It Fl x Em property\nEnsures that the effective value of the specified property after the\nreceive is unaffected by the value of that property in the send stream (if any),\nas if the property had been excluded from the send stream.\n.Pp\nIf the specified property is not present in the send stream, this option does\nnothing.\n.Pp\nIf a received property needs to be overridden, the effective value will be\nset or inherited, depending on whether the property is inheritable or not.\n.Pp\nIn the case of an incremental update,\n.Fl x\nleaves any existing local setting or explicit inheritance unchanged.\n.Pp\nAll\n.Fl o\nrestrictions (e.g. set-once) apply equally to\n.Fl x .\n.El\n.It Xo\n.Nm zfs\n.Cm receive\n.Fl A\n.Ar filesystem Ns | Ns Ar volume\n.Xc\nAbort an interrupted\n.Nm zfs Cm receive Fl s ,\ndeleting its saved partially received state.\n.It Xo\n.Nm zfs\n.Cm receive\n.Fl c\n.Op Fl vn\n.Ar filesystem Ns | Ns Ar snapshot\n.Xc\nAttempt to repair data corruption in the specified dataset,\nby using the provided stream as the source of healthy data.\nThis method of healing can only heal data blocks present in the stream.\nMetadata can not be healed by corrective receive.\nRunning a scrub is recommended post-healing to ensure all data corruption was\nrepaired.\n.Pp\nIt's important to consider why corruption has happened in the first place.\nIf you have slowly failing hardware - periodically repairing the data\nis not going to save you from data loss later on when the hardware fails\ncompletely.\n.El\n.\n.Sh EXAMPLES\n.\\\" These are, respectively, examples 12, 13 from zfs.8\n.\\\" Make sure to update them bidirectionally\n.Ss Example 1 : No Remotely Replicating ZFS Data\nThe following commands send a full stream and then an incremental stream to a\nremote machine, restoring them into\n.Em poolB/received/fs@a\nand\n.Em poolB/received/fs@b ,\nrespectively.\n.Em poolB\nmust contain the file system\n.Em poolB/received ,\nand must not initially contain\n.Em poolB/received/fs .\n.Bd -literal -compact -offset Ds\n.No # Nm zfs Cm send Ar pool/fs@a |\n.No \"   \" Nm ssh Ar host Nm zfs Cm receive Ar poolB/received/fs Ns @ Ns Ar a\n.No # Nm zfs Cm send Fl i Ar a pool/fs@b |\n.No \"   \" Nm ssh Ar host Nm zfs Cm receive Ar poolB/received/fs\n.Ed\n.\n.Ss Example 2 : No Using the Nm zfs Cm receive Fl d No Option\nThe following command sends a full stream of\n.Ar poolA/fsA/fsB@snap\nto a remote machine, receiving it into\n.Ar poolB/received/fsA/fsB@snap .\nThe\n.Ar fsA/fsB@snap\nportion of the received snapshot's name is determined from the name of the sent\nsnapshot.\n.Ar poolB\nmust contain the file system\n.Ar poolB/received .\nIf\n.Ar poolB/received/fsA\ndoes not exist, it is created as an empty file system.\n.Bd -literal -compact -offset Ds\n.No # Nm zfs Cm send Ar poolA/fsA/fsB@snap |\n.No \"   \" Nm ssh Ar host Nm zfs Cm receive Fl d Ar poolB/received\n.Ed\n.\n.Sh SEE ALSO\n.Xr zfs-send 8 ,\n.Xr zstream 8\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}