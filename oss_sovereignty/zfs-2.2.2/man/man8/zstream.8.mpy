{
  "module_name": "zstream.8",
  "hash_id": "765b6225b84f4c9dcc35982bd2450dbd907aa28697c5053ad94faf5b1a4e322a",
  "original_prompt": "Ingested from zfs-2.2.2/man/man8/zstream.8",
  "human_readable_source": ".\\\"\n.\\\" CDDL HEADER START\n.\\\"\n.\\\" The contents of this file are subject to the terms of the\n.\\\" Common Development and Distribution License (the \"License\").\n.\\\" You may not use this file except in compliance with the License.\n.\\\"\n.\\\" You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE\n.\\\" or https://opensource.org/licenses/CDDL-1.0.\n.\\\" See the License for the specific language governing permissions\n.\\\" and limitations under the License.\n.\\\"\n.\\\" When distributing Covered Code, include this CDDL HEADER in each\n.\\\" file and include the License file at usr/src/OPENSOLARIS.LICENSE.\n.\\\" If applicable, add the following below this CDDL HEADER, with the\n.\\\" fields enclosed by brackets \"[]\" replaced with your own identifying\n.\\\" information: Portions Copyright [yyyy] [name of copyright owner]\n.\\\"\n.\\\" CDDL HEADER END\n.\\\"\n.\\\" Copyright (c) 2020 by Delphix. All rights reserved.\n.\\\"\n.Dd October 4, 2022\n.Dt ZSTREAM 8\n.Os\n.\n.Sh NAME\n.Nm zstream\n.Nd manipulate ZFS send streams\n.Sh SYNOPSIS\n.Nm\n.Cm dump\n.Op Fl Cvd\n.Op Ar file\n.Nm\n.Cm decompress\n.Op Fl v\n.Op Ar object Ns Sy \\&, Ns Ar offset Ns Op Sy \\&, Ns Ar type Ns ...\n.Nm\n.Cm redup\n.Op Fl v\n.Ar file\n.Nm\n.Cm token\n.Ar resume_token\n.Nm\n.Cm recompress\n.Op Fl l Ar level\n.Ar algorithm\n.\n.Sh DESCRIPTION\nThe\n.Sy zstream\nutility manipulates ZFS send streams output by the\n.Sy zfs send\ncommand.\n.Bl -tag -width \"\"\n.It Xo\n.Nm\n.Cm dump\n.Op Fl Cvd\n.Op Ar file\n.Xc\nPrint information about the specified send stream, including headers and\nrecord counts.\nThe send stream may either be in the specified\n.Ar file ,\nor provided on standard input.\n.Bl -tag -width \"-D\"\n.It Fl C\nSuppress the validation of checksums.\n.It Fl v\nVerbose.\nPrint metadata for each record.\n.It Fl d\nDump data contained in each record.\nImplies verbose.\n.El\n.Pp\nThe\n.Nm zstreamdump\nalias is provided for compatibility and is equivalent to running\n.Nm\n.Cm dump .\n.It Xo\n.Nm\n.Cm token\n.Ar resume_token\n.Xc\nDumps zfs resume token information\n.It Xo\n.Nm\n.Cm decompress\n.Op Fl v\n.Op Ar object Ns Sy \\&, Ns Ar offset Ns Op Sy \\&, Ns Ar type Ns ...\n.Xc\nDecompress selected records in a ZFS send stream provided on standard input,\nwhen the compression type recorded in ZFS metadata may be incorrect.\nSpecify the object number and byte offset of each record that you wish to\ndecompress.\nOptionally specify the compression type.\nValid compression types include\n.Sy off ,\n.Sy gzip ,\n.Sy lz4 ,\n.Sy lzjb ,\n.Sy zstd ,\nand\n.Sy zle .\nThe default is\n.Sy lz4 .\nEvery record for that object beginning at that offset will be decompressed, if\npossible.\nIt may not be possible, because the record may be corrupted in some but not\nall of the stream's snapshots.\nSpecifying a compression type of\n.Sy off\nwill change the stream's metadata accordingly, without attempting decompression.\nThis can be useful if the record is already uncompressed but the metadata\ninsists otherwise.\nThe repaired stream will be written to standard output.\n.Bl -tag -width \"-v\"\n.It Fl v\nVerbose.\nPrint summary of decompressed records.\n.El\n.It Xo\n.Nm\n.Cm redup\n.Op Fl v\n.Ar file\n.Xc\nDeduplicated send streams can be generated by using the\n.Nm zfs Cm send Fl D\ncommand.\nThe ability to send deduplicated send streams is deprecated.\nIn the future, the ability to receive a deduplicated send stream with\n.Nm zfs Cm receive\nwill be removed.\nHowever, deduplicated send streams can still be received by utilizing\n.Nm zstream Cm redup .\n.Pp\nThe\n.Nm zstream Cm redup\ncommand is provided a\n.Ar file\ncontaining a deduplicated send stream, and outputs an equivalent\nnon-deduplicated send stream on standard output.\nTherefore, a deduplicated send stream can be received by running:\n.Dl # Nm zstream Cm redup Pa DEDUP_STREAM_FILE | Nm zfs Cm receive No \u2026\n.Bl -tag -width \"-D\"\n.It Fl v\nVerbose.\nPrint summary of converted records.\n.El\n.It Xo\n.Nm\n.Cm recompress\n.Op Fl l Ar level\n.Ar algorithm\n.Xc\nRecompresses a send stream, provided on standard input, using the provided\nalgorithm and optional level, and writes the modified stream to standard output.\nAll WRITE records in the send stream will be recompressed, unless they fail\nto result in size reduction compared to being left uncompressed.\nThe provided algorithm can be any valid value to the\n.Nm compress\nproperty.\nNote that encrypted send streams cannot be recompressed.\n.Bl -tag -width \"-l\"\n.It Fl l Ar level\nSpecifies compression level.\nOnly needed for algorithms where the level is not implied as part of the name\nof the algorithm (e.g. gzip-3 does not require it, while zstd does, if a\nnon-default level is desired).\n.El\n.El\n.\n.Sh EXAMPLES\nHeal a dataset that was corrupted due to OpenZFS bug #12762.\nFirst, determine which records are corrupt.\nThat cannot be done automatically; it requires information beyond ZFS's\nmetadata.\nIf object\n.Sy 128\nis corrupted at offset\n.Sy 0\nand is compressed using\n.Sy lz4 ,\nthen run this command:\n.Bd -literal\n.No # Nm zfs Ar send Fl c Ar \u2026 | Nm zstream decompress Ar 128,0,lz4 | \\\nNm zfs recv Ar \u2026\n.Ed\n.Sh SEE ALSO\n.Xr zfs 8 ,\n.Xr zfs-receive 8 ,\n.Xr zfs-send 8 ,\n.Lk https://github.com/openzfs/zfs/issues/12762\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}