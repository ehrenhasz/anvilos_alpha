{
  "module_name": "ztest.1",
  "hash_id": "fb6dc2666d990ebb0e3ca2f25e4b0955865b6bbe2db49451e8abbcc5f35ee713",
  "original_prompt": "Ingested from zfs-2.2.2/man/man1/ztest.1",
  "human_readable_source": ".\\\"\n.\\\" CDDL HEADER START\n.\\\"\n.\\\" The contents of this file are subject to the terms of the\n.\\\" Common Development and Distribution License (the \"License\").\n.\\\" You may not use this file except in compliance with the License.\n.\\\"\n.\\\" You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE\n.\\\" or https://opensource.org/licenses/CDDL-1.0.\n.\\\" See the License for the specific language governing permissions\n.\\\" and limitations under the License.\n.\\\"\n.\\\" When distributing Covered Code, include this CDDL HEADER in each\n.\\\" file and include the License file at usr/src/OPENSOLARIS.LICENSE.\n.\\\" If applicable, add the following below this CDDL HEADER, with the\n.\\\" fields enclosed by brackets \"[]\" replaced with your own identifying\n.\\\" information: Portions Copyright [yyyy] [name of copyright owner]\n.\\\"\n.\\\" CDDL HEADER END\n.\\\"\n.\\\" Copyright (c) 2009 Oracle and/or its affiliates. All rights reserved.\n.\\\" Copyright (c) 2009 Michael Gebetsroither <michael.geb@gmx.at>. All rights\n.\\\" reserved.\n.\\\" Copyright (c) 2017, Intel Corporation.\n.\\\"\n.Dd May 26, 2021\n.Dt ZTEST 1\n.Os\n.\n.Sh NAME\n.Nm ztest\n.Nd was written by the ZFS Developers as a ZFS unit test\n.Sh SYNOPSIS\n.Nm\n.Op Fl VEG\n.Op Fl v Ar vdevs\n.Op Fl s Ar size_of_each_vdev\n.Op Fl a Ar alignment_shift\n.Op Fl m Ar mirror_copies\n.Op Fl r Ar raidz_disks/draid_disks\n.Op Fl R Ar raid_parity\n.Op Fl K Ar raid_kind\n.Op Fl D Ar draid_data\n.Op Fl S Ar draid_spares\n.Op Fl C Ar vdev_class_state\n.Op Fl d Ar datasets\n.Op Fl t Ar threads\n.Op Fl g Ar gang_block_threshold\n.Op Fl i Ar initialize_pool_i_times\n.Op Fl k Ar kill_percentage\n.Op Fl p Ar pool_name\n.Op Fl T Ar time\n.Op Fl z Ar zil_failure_rate\n.\n.Sh DESCRIPTION\n.Nm\nwas written by the ZFS Developers as a ZFS unit test.\nThe tool was developed in tandem with the ZFS functionality and was\nexecuted nightly as one of the many regression test against the daily build.\nAs features were added to ZFS, unit tests were also added to\n.Nm .\nIn addition, a separate test development team wrote and\nexecuted more functional and stress tests.\n.\n.Pp\nBy default\n.Nm\nruns for ten minutes and uses block files\n(stored in\n.Pa /tmp )\nto create pools rather than using physical disks.\nBlock files afford\n.Nm\nits flexibility to play around with\nzpool components without requiring large hardware configurations.\nHowever, storing the block files in\n.Pa /tmp\nmay not work for you if you\nhave a small tmp directory.\n.\n.Pp\nBy default is non-verbose.\nThis is why entering the command above will result in\n.Nm\nquietly executing for 5 minutes.\nThe\n.Fl V\noption can be used to increase the verbosity of the tool.\nAdding multiple\n.Fl V\noptions is allowed and the more you add the more chatty\n.Nm\nbecomes.\n.\n.Pp\nAfter the\n.Nm\nrun completes, you should notice many\n.Pa ztest.*\nfiles lying around.\nOnce the run completes you can safely remove these files.\nNote that you shouldn't remove these files during a run.\nYou can re-use these files in your next\n.Nm\nrun by using the\n.Fl E\noption.\n.\n.Sh OPTIONS\n.Bl -tag -width \"-v v\"\n.It Fl h , \\&? , -help\nPrint a help summary.\n.It Fl v , -vdevs Ns = (default: Sy 5 )\nNumber of vdevs.\n.It Fl s , -vdev-size Ns = (default: Sy 64M )\nSize of each vdev.\n.It Fl a , -alignment-shift Ns = (default: Sy 9 ) No (use Sy 0 No for random )\nAlignment shift used in test.\n.It Fl m , -mirror-copies Ns = (default: Sy 2 )\nNumber of mirror copies.\n.It Fl r , -raid-disks Ns = (default: Sy 4 No for raidz/ Ns Sy 16 No for draid )\nNumber of raidz/draid disks.\n.It Fl R , -raid-parity Ns = (default: Sy 1 )\nRaid parity (raidz & draid).\n.It Fl K , -raid-kind Ns = Ns Sy raidz Ns | Ns Sy draid Ns | Ns Sy random No (default : Sy random )\nThe kind of RAID config to use.\nWith\n.Sy random\nthe kind alternates between raidz and draid.\n.It Fl D , -draid-data Ns = (default: Sy 4 )\nNumber of data disks in a dRAID redundancy group.\n.It Fl S , -draid-spares Ns = (default: Sy 1 )\nNumber of dRAID distributed spare disks.\n.It Fl d , -datasets Ns = (default: Sy 7 )\nNumber of datasets.\n.It Fl t , -threads Ns = (default: Sy 23 )\nNumber of threads.\n.It Fl g , -gang-block-threshold Ns = (default: Sy 32K )\nGang block threshold.\n.It Fl i , -init-count Ns = (default: Sy 1 )\nNumber of pool initializations.\n.It Fl k , -kill-percentage Ns = (default: Sy 70% )\nKill percentage.\n.It Fl p , -pool-name Ns = (default: Sy ztest )\nPool name.\n.It Fl f , -vdev-file-directory Ns = (default: Pa /tmp )\nFile directory for vdev files.\n.It Fl M , -multi-host\nMulti-host; simulate pool imported on remote host.\n.It Fl E , -use-existing-pool\nUse existing pool (use existing pool instead of creating new one).\n.It Fl T , -run-time Ns = (default: Sy 300 Ns s)\nTotal test run time.\n.It Fl P , -pass-time Ns = (default: Sy 60 Ns s)\nTime per pass.\n.It Fl F , -freeze-loops Ns = (default: Sy 50 )\nMax loops in\n.Fn spa_freeze .\n.It Fl B , -alt-ztest Ns =\nPath to alternate (\"older\")\n.Nm ztest\nto drive, which will be used to initialise the pool, and, a stochastic half the\ntime, to run the tests.\nThe parallel\n.Pa lib\ndirectory is prepended to\n.Ev LD_LIBRARY_PATH ;\ni.e. given\n.Fl B Pa ./chroots/lenny/usr/bin/ Ns Nm ,\n.Pa ./chroots/lenny/usr/lib\nwill be loaded.\n.It Fl C , -vdev-class-state Ns = Ns Sy on Ns | Ns Sy off Ns | Ns Sy random No (default : Sy random  )\nThe vdev allocation class state.\n.It Fl o , -option Ns = Ns Ar variable Ns = Ns Ar value\nSet global\n.Ar variable\nto an unsigned 32-bit integer\n.Ar value\n(little-endian only).\n.It Fl G , -dump-debug\nDump zfs_dbgmsg buffer before exiting due to an error.\n.It Fl V , -verbose\nVerbose (use multiple times for ever more verbosity).\n.El\n.\n.Sh EXAMPLES\nTo override\n.Pa /tmp\nas your location for block files, you can use the\n.Fl f\noption:\n.Dl # ztest -f /\n.Pp\nTo get an idea of what\n.Nm\nis actually testing try this:\n.Dl # ztest -f / -VVV\n.Pp\nMaybe you'd like to run\n.Nm ztest\nfor longer? To do so simply use the\n.Fl T\noption and specify the runlength in seconds like so:\n.Dl # ztest -f / -V -T 120\n.\n.Sh ENVIRONMENT VARIABLES\n.Bl -tag -width \"ZF\"\n.It Ev ZFS_HOSTID Ns = Ns Em id\nUse\n.Em id\ninstead of the SPL hostid to identify this host.\nIntended for use with\n.Nm , but this environment variable will affect any utility which uses\nlibzpool, including\n.Xr zpool 8 .\nSince the kernel is unaware of this setting,\nresults with utilities other than ztest are undefined.\n.It Ev ZFS_STACK_SIZE Ns = Ns Em stacksize\nLimit the default stack size to\n.Em stacksize\nbytes for the purpose of\ndetecting and debugging kernel stack overflows.\nThis value defaults to\n.Em 32K\nwhich is double the default\n.Em 16K\nLinux kernel stack size.\n.Pp\nIn practice, setting the stack size slightly higher is needed because\ndifferences in stack usage between kernel and user space can lead to spurious\nstack overflows (especially when debugging is enabled).\nThe specified value\nwill be rounded up to a floor of PTHREAD_STACK_MIN which is the minimum stack\nrequired for a NULL procedure in user space.\n.Pp\nBy default the stack size is limited to\n.Em 256K .\n.El\n.\n.Sh SEE ALSO\n.Xr zdb 1 ,\n.Xr zfs 1 ,\n.Xr zpool 1 ,\n.Xr spl 4\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}