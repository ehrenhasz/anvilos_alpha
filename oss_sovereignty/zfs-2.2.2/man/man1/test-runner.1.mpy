{
  "module_name": "test-runner.1",
  "hash_id": "a2bb07ba45ee90484f469a55a769e68c8521154447e0395343a2dfd4ba9b6d7b",
  "original_prompt": "Ingested from zfs-2.2.2/man/man1/test-runner.1",
  "human_readable_source": ".\\\"\n.\\\" This file and its contents are supplied under the terms of the\n.\\\" Common Development and Distribution License (\"CDDL\"), version 1.0.\n.\\\" You may only use this file in accordance with the terms of version\n.\\\" 1.0 of the CDDL.\n.\\\"\n.\\\" A full copy of the text of the CDDL should have accompanied this\n.\\\" source.  A copy of the CDDL is also available via the Internet at\n.\\\" http://www.illumos.org/license/CDDL.\n.\\\"\n.\\\" Copyright (c) 2012 by Delphix. All rights reserved.\n.\\\"\n.Dd May 26, 2021\n.Dt RUN 1\n.Os\n.\n.Sh NAME\n.Nm run\n.Nd find, execute, and log the results of tests\n.Sh SYNOPSIS\n.Nm\n.Op Fl dgq\n.Op Fl o Ar outputdir\n.Op Fl pP Ar script\n.Op Fl t seconds\n.Op Fl uxX Ar username\n.Ar pathname Ns No \u2026\n.Pp\n.Nm\n.Fl w Ar runfile\n.Op Fl gq\n.Op Fl o Ar outputdir\n.Op Fl pP Ar script\n.Op Fl t seconds\n.Op Fl uxX Ar username\n.Ar pathname Ns No \u2026\n.Pp\n.Nm\n.Fl c Ar runfile\n.Op Fl dq\n.Pp\n.Nm\n.Op Fl h\n.\n.Sh DESCRIPTION\n.Nm\ncommand has three basic modes of operation.\nWith neither\n.Fl c\nnor\n.Fl w ,\n.Nm\nprocesses the arguments provided on\nthe command line, adding them to the list for this run.\nIf a specified\n.Ar pathname\nis an executable file, it is added as a test.\nIf a specified\n.Ar pathname\nis a directory, the behavior depends upon the presence of\n.Fl g .\nIf\n.Fl g\nis specified, the directory is treated as a test group.\nSee the section on\n.Sy Test Groups\nbelow.\nWithout\n.Fl g ,\n.Nm\nsimply descends into the directory looking for executable files.\nThe tests are then executed, and the results are logged.\n.Pp\nWith\n.Fl w ,\n.Nm\nfinds tests in the manner described above.\nRather than executing the tests and logging the results, the test configuration\nis stored in a\n.Ar runfile ,\nwhich can be used in future invocations, or edited\nto modify which tests are executed and which options are applied.\nOptions included on the command line with\n.Fl w\nbecome defaults in the\n.Ar runfile .\n.Pp\nWith\n.Fl c ,\n.Nm\nparses a\n.Ar runfile ,\nwhich can specify a series of tests and test groups to be executed.\nThe tests are then executed, and the results are logged.\n.\n.Ss Test Groups\nA test group is comprised of a set of executable files, all of which exist in\none directory.\nThe options specified on the command line or in a\n.Ar runfile\napply to individual tests in the group.\nThe exception is options pertaining to pre and post scripts, which act on all\ntests as a group.\nRather than running before and after each test,\nthese scripts are run only once each at the start and end of the test group.\n.Ss Test Execution\nThe specified tests run serially, and are typically assigned results according\nto exit values.\nTests that exit zero and non-zero are marked\n.Sy PASS\nand\n.Sy FAIL ,\nrespectively.\nWhen a pre script fails for a test group, only the post script is executed,\nand the remaining tests are marked\n.Sy SKIPPED .\nAny test that exceeds\nits\n.Ar timeout\nis terminated, and marked\n.Sy KILLED .\n.Pp\nBy default, tests are executed with the credentials of the\n.Nm\nscript.\nExecuting tests with other credentials is done via\n.Xr sudo 1m ,\nwhich must\nbe configured to allow execution without prompting for a password.\nEnvironment variables from the calling shell are available to individual tests.\nDuring test execution, the working directory is changed to\n.Ar outputdir .\n.\n.Ss Output Logging\nBy default,\n.Nm\nwill print one line on standard output at the conclusion\nof each test indicating the test name, result and elapsed time.\nAdditionally, for each invocation of\n.Nm ,\na directory is created using the ISO 8601 date format.\nWithin this directory is a file named\n.Sy log\ncontaining all the\ntest output with timestamps, and a directory for each test.\nWithin the test directories, there is one file each for standard output,\nstandard error and merged output.\nThe default location for the\n.Ar outputdir\nis\n.Pa /var/tmp/test_results .\n.Ss \"Runfiles\"\nThe\n.Ar runfile\nis an INI-style configuration file that describes a test run.\nThe file has one section named\n.Sy DEFAULT ,\nwhich contains configuration option\nnames and their values in\n.Sy name No = Ar value\nformat.\nThe values in this section apply to all the subsequent sections,\nunless they are also specified there, in which case the default is overridden.\nThe remaining section names are the absolute pathnames of files and directories,\ndescribing tests and test groups respectively.\nThe legal option names are:\n.Bl -tag -width \"tests = ['filename', \u2026]\"\n.It Sy outputdir No = Ar pathname\nThe name of the directory that holds test logs.\n.It Sy pre No = Ar script\nRun\n.Ar script\nprior to the test or test group.\n.It Sy pre_user No = Ar username\nExecute the pre script as\n.Ar username .\n.It Sy post No = Ar script\nRun\n.Ar script\nafter the test or test group.\n.It Sy post_user No = Ar username\nExecute the post script as\n.Ar username .\n.It Sy quiet No = Sy True Ns | Ns Sy False\nIf\n.Sy True ,\nonly the results summary is printed to standard out.\n.It Sy tests No = [ Ns Ar 'filename' , No \u2026 ]\nSpecify a list of\n.Ar filenames\nfor this test group.\nOnly the basename of the absolute path is required.\nThis option is only valid for test groups, and each\n.Ar filename\nmust be single quoted.\n.It Sy timeout No = Ar n\nA timeout value of\n.Ar n\nseconds.\n.It Sy user No = Ar username\nExecute the test or test group as\n.Ar username .\n.El\n.\n.Sh OPTIONS\n.Bl -tag -width \"-o outputdir\"\n.It Fl c Ar runfile\nSpecify a\n.Ar runfile\nto be consumed by the run command.\n.It Fl d\nDry run mode.\nExecute no tests, but print a description of each test that would have been run.\n.It Fl m\nEnable kmemleak reporting (Linux only)\n.It Fl g\nCreate test groups from any directories found while searching for tests.\n.It Fl o Ar outputdir\nSpecify the directory in which to write test results.\n.It Fl p Ar script\nRun\n.Ar script\nprior to any test or test group.\n.It Fl P Ar script\nRun\n.Ar script\nafter any test or test group.\n.It Fl q\nPrint only the results summary to the standard output.\n.It Fl s Ar script\nRun\n.Ar script\nas a failsafe after any test is killed.\n.It Fl S Ar username\nExecute the failsafe script as\n.Ar username .\n.It Fl t Ar n\nSpecify a timeout value of\n.Ar n\nseconds per test.\n.It Fl u Ar username\nExecute tests or test groups as\n.Ar username .\n.It Fl w Ar runfile\nSpecify the name of the\n.Ar runfile\nto create.\n.It Fl x Ar username\nExecute the pre script as\n.Ar username .\n.It Fl X Ar username\nExecute the post script as\n.Ar username .\n.El\n.\n.Sh EXAMPLES\n.Bl -tag -width \"-h\"\n.It Sy Example 1 : No Running ad-hoc tests .\nThis example demonstrates the simplest invocation of\n.Nm .\n.Bd -literal\n.No % Nm run Ar my-tests\nTest: /home/jkennedy/my-tests/test-01                    [00:02] [PASS]\nTest: /home/jkennedy/my-tests/test-02                    [00:04] [PASS]\nTest: /home/jkennedy/my-tests/test-03                    [00:01] [PASS]\n\nResults Summary\nPASS       3\n\nRunning Time:   00:00:07\nPercent passed: 100.0%\nLog directory:  /var/tmp/test_results/20120923T180654\n.Ed\n.It Sy Example 2 : No Creating a Ar runfile No for future use .\nThis example demonstrates creating a\n.Ar runfile\nwith non-default options.\n.Bd -literal\n.No % Nm run Fl p Ar setup Fl x Ar root Fl g Fl w Ar new-tests.run Ar new-tests\n.No % Nm cat Pa new-tests.run\n[DEFAULT]\npre = setup\npost_user =\nquiet = False\nuser =\ntimeout = 60\npost =\npre_user = root\noutputdir = /var/tmp/test_results\n\n[/home/jkennedy/new-tests]\ntests = ['test-01', 'test-02', 'test-03']\n.Ed\n.El\n.\n.Sh SEE ALSO\n.Xr sudo 1m\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}