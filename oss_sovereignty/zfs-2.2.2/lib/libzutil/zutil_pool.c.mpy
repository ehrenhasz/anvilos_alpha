{
  "module_name": "zutil_pool.c",
  "hash_id": "ac7eb6ac4ba3ef15f62a25edb4dfec2bc7c8701d0cb3e6c2dc58a6dd48953dd2",
  "original_prompt": "Ingested from zfs-2.2.2/lib/libzutil/zutil_pool.c",
  "human_readable_source": " \n\n \n\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <sys/nvpair.h>\n#include <sys/fs/zfs.h>\n\n#include <libzutil.h>\n\nstatic void\ndump_ddt_stat(const ddt_stat_t *dds, int h)\n{\n\tchar refcnt[6];\n\tchar blocks[6], lsize[6], psize[6], dsize[6];\n\tchar ref_blocks[6], ref_lsize[6], ref_psize[6], ref_dsize[6];\n\n\tif (dds == NULL || dds->dds_blocks == 0)\n\t\treturn;\n\n\tif (h == -1)\n\t\t(void) strcpy(refcnt, \"Total\");\n\telse\n\t\tzfs_nicenum(1ULL << h, refcnt, sizeof (refcnt));\n\n\tzfs_nicenum(dds->dds_blocks, blocks, sizeof (blocks));\n\tzfs_nicebytes(dds->dds_lsize, lsize, sizeof (lsize));\n\tzfs_nicebytes(dds->dds_psize, psize, sizeof (psize));\n\tzfs_nicebytes(dds->dds_dsize, dsize, sizeof (dsize));\n\tzfs_nicenum(dds->dds_ref_blocks, ref_blocks, sizeof (ref_blocks));\n\tzfs_nicebytes(dds->dds_ref_lsize, ref_lsize, sizeof (ref_lsize));\n\tzfs_nicebytes(dds->dds_ref_psize, ref_psize, sizeof (ref_psize));\n\tzfs_nicebytes(dds->dds_ref_dsize, ref_dsize, sizeof (ref_dsize));\n\n\t(void) printf(\"%6s   %6s   %5s   %5s   %5s   %6s   %5s   %5s   %5s\\n\",\n\t    refcnt,\n\t    blocks, lsize, psize, dsize,\n\t    ref_blocks, ref_lsize, ref_psize, ref_dsize);\n}\n\n \nvoid\nzpool_dump_ddt(const ddt_stat_t *dds_total, const ddt_histogram_t *ddh)\n{\n\tint h;\n\n\t(void) printf(\"\\n\");\n\n\t(void) printf(\"bucket   \"\n\t    \"           allocated             \"\n\t    \"          referenced          \\n\");\n\t(void) printf(\"______   \"\n\t    \"______________________________   \"\n\t    \"______________________________\\n\");\n\n\t(void) printf(\"%6s   %6s   %5s   %5s   %5s   %6s   %5s   %5s   %5s\\n\",\n\t    \"refcnt\",\n\t    \"blocks\", \"LSIZE\", \"PSIZE\", \"DSIZE\",\n\t    \"blocks\", \"LSIZE\", \"PSIZE\", \"DSIZE\");\n\n\t(void) printf(\"%6s   %6s   %5s   %5s   %5s   %6s   %5s   %5s   %5s\\n\",\n\t    \"------\",\n\t    \"------\", \"-----\", \"-----\", \"-----\",\n\t    \"------\", \"-----\", \"-----\", \"-----\");\n\n\tfor (h = 0; h < 64; h++)\n\t\tdump_ddt_stat(&ddh->ddh_stat[h], h);\n\n\tdump_ddt_stat(dds_total, -1);\n\n\t(void) printf(\"\\n\");\n}\n\n \nint\nzpool_history_unpack(char *buf, uint64_t bytes_read, uint64_t *leftover,\n    nvlist_t ***records, uint_t *numrecords)\n{\n\tuint64_t reclen;\n\tnvlist_t *nv;\n\tint i;\n\tvoid *tmp;\n\n\twhile (bytes_read > sizeof (reclen)) {\n\n\t\t \n\t\tfor (i = 0, reclen = 0; i < sizeof (reclen); i++)\n\t\t\treclen += (uint64_t)(((uchar_t *)buf)[i]) << (8*i);\n\n\t\tif (bytes_read < sizeof (reclen) + reclen)\n\t\t\tbreak;\n\n\t\t \n\t\tint err = nvlist_unpack(buf + sizeof (reclen), reclen, &nv, 0);\n\t\tif (err != 0)\n\t\t\treturn (err);\n\t\tbytes_read -= sizeof (reclen) + reclen;\n\t\tbuf += sizeof (reclen) + reclen;\n\n\t\t \n\t\t(*numrecords)++;\n\t\tif (ISP2(*numrecords + 1)) {\n\t\t\ttmp = realloc(*records,\n\t\t\t    *numrecords * 2 * sizeof (nvlist_t *));\n\t\t\tif (tmp == NULL) {\n\t\t\t\tnvlist_free(nv);\n\t\t\t\t(*numrecords)--;\n\t\t\t\treturn (ENOMEM);\n\t\t\t}\n\t\t\t*records = tmp;\n\t\t}\n\t\t(*records)[*numrecords - 1] = nv;\n\t}\n\n\t*leftover = bytes_read;\n\treturn (0);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}