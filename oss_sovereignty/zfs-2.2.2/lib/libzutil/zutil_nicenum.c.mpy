{
  "module_name": "zutil_nicenum.c",
  "hash_id": "ca143df1fa98d19e5a6c9444fd4bd4841ee91742cf17386d5fa3bf66c47d07fd",
  "original_prompt": "Ingested from zfs-2.2.2/lib/libzutil/zutil_nicenum.c",
  "human_readable_source": " \n\n \n\n#include <ctype.h>\n#include <math.h>\n#include <stdio.h>\n#include <libzutil.h>\n#include <string.h>\n\n \nboolean_t\nzfs_isnumber(const char *str)\n{\n\tif (!*str)\n\t\treturn (B_FALSE);\n\n\tfor (; *str; str++)\n\t\tif (!(isdigit(*str) || (*str == '.')))\n\t\t\treturn (B_FALSE);\n\n\t \n\tif (str[strlen(str) - 1] == '.') {\n\t\treturn (B_FALSE);\n\t}\n\n\treturn (B_TRUE);\n}\n\n \nvoid\nzfs_nicenum_format(uint64_t num, char *buf, size_t buflen,\n    enum zfs_nicenum_format format)\n{\n\tuint64_t n = num;\n\tint index = 0;\n\tconst char *u;\n\tconst char *units[3][7] = {\n\t    [ZFS_NICENUM_1024] = {\"\", \"K\", \"M\", \"G\", \"T\", \"P\", \"E\"},\n\t    [ZFS_NICENUM_BYTES] = {\"B\", \"K\", \"M\", \"G\", \"T\", \"P\", \"E\"},\n\t    [ZFS_NICENUM_TIME] = {\"ns\", \"us\", \"ms\", \"s\", \"?\", \"?\", \"?\"}\n\t};\n\n\tconst int units_len[] = {[ZFS_NICENUM_1024] = 6,\n\t    [ZFS_NICENUM_BYTES] = 6,\n\t    [ZFS_NICENUM_TIME] = 4};\n\n\tconst int k_unit[] = {\t[ZFS_NICENUM_1024] = 1024,\n\t    [ZFS_NICENUM_BYTES] = 1024,\n\t    [ZFS_NICENUM_TIME] = 1000};\n\n\tdouble val;\n\n\tif (format == ZFS_NICENUM_RAW) {\n\t\tsnprintf(buf, buflen, \"%llu\", (u_longlong_t)num);\n\t\treturn;\n\t} else if (format == ZFS_NICENUM_RAWTIME && num > 0) {\n\t\tsnprintf(buf, buflen, \"%llu\", (u_longlong_t)num);\n\t\treturn;\n\t} else if (format == ZFS_NICENUM_RAWTIME && num == 0) {\n\t\tsnprintf(buf, buflen, \"%s\", \"-\");\n\t\treturn;\n\t}\n\n\twhile (n >= k_unit[format] && index < units_len[format]) {\n\t\tn /= k_unit[format];\n\t\tindex++;\n\t}\n\n\tu = units[format][index];\n\n\t \n\tif ((format == ZFS_NICENUM_TIME) && (num == 0)) {\n\t\t(void) snprintf(buf, buflen, \"-\");\n\t} else if ((index == 0) || ((num %\n\t    (uint64_t)powl(k_unit[format], index)) == 0)) {\n\t\t \n\t\t(void) snprintf(buf, buflen, \"%llu%s\", (u_longlong_t)n, u);\n\n\t} else {\n\t\t \n\t\tint i;\n\t\tfor (i = 2; i >= 0; i--) {\n\t\t\tval = (double)num /\n\t\t\t    (uint64_t)powl(k_unit[format], index);\n\n\t\t\t \n\t\t\tif (format == ZFS_NICENUM_TIME) {\n\t\t\t\tif (snprintf(buf, buflen, \"%d%s\",\n\t\t\t\t    (unsigned int) floor(val), u) <= 5)\n\t\t\t\t\tbreak;\n\n\t\t\t} else {\n\t\t\t\tif (snprintf(buf, buflen, \"%.*f%s\", i,\n\t\t\t\t    val, u) <= 5)\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n}\n\n \nvoid\nzfs_nicenum(uint64_t num, char *buf, size_t buflen)\n{\n\tzfs_nicenum_format(num, buf, buflen, ZFS_NICENUM_1024);\n}\n\n \nvoid\nzfs_nicetime(uint64_t num, char *buf, size_t buflen)\n{\n\tzfs_nicenum_format(num, buf, buflen, ZFS_NICENUM_TIME);\n}\n\n \nvoid\nzfs_niceraw(uint64_t num, char *buf, size_t buflen)\n{\n\tzfs_nicenum_format(num, buf, buflen, ZFS_NICENUM_RAW);\n}\n\n \nvoid\nzfs_nicebytes(uint64_t num, char *buf, size_t buflen)\n{\n\tzfs_nicenum_format(num, buf, buflen, ZFS_NICENUM_BYTES);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}