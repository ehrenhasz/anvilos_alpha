{
  "module_name": "libshare.c",
  "hash_id": "4f3acdac771af5cf826a11878f208c95f2262409dc039b72b28f76792f670d72",
  "original_prompt": "Ingested from zfs-2.2.2/lib/libshare/libshare.c",
  "human_readable_source": " \n\n \n\n#include <stdio.h>\n#include <stdlib.h>\n#include <stddef.h>\n#include <string.h>\n#include <errno.h>\n#include <libintl.h>\n#include <sys/file.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <unistd.h>\n#include <libzfs.h>\n#include <libshare.h>\n#include \"libshare_impl.h\"\n\n#define\tinit_share(zfsname, path, shareopts) \\\n\t{ \\\n\t\t.sa_zfsname = zfsname, \\\n\t\t.sa_mountpoint = path, \\\n\t\t.sa_shareopts = shareopts, \\\n\t}\n\n#define\tVALIDATE_PROTOCOL(proto, ...) \\\n\tif ((proto) < 0 || (proto) >= SA_PROTOCOL_COUNT) \\\n\t\treturn __VA_ARGS__\n\nconst char *const sa_protocol_names[SA_PROTOCOL_COUNT] = {\n\t[SA_PROTOCOL_NFS] = \"nfs\",\n\t[SA_PROTOCOL_SMB] = \"smb\",\n};\n\nstatic const sa_fstype_t *fstypes[SA_PROTOCOL_COUNT] =\n\t{&libshare_nfs_type, &libshare_smb_type};\n\nint\nsa_enable_share(const char *zfsname, const char *mountpoint,\n    const char *shareopts, enum sa_protocol protocol)\n{\n\tVALIDATE_PROTOCOL(protocol, SA_INVALID_PROTOCOL);\n\n\tconst struct sa_share_impl args =\n\t    init_share(zfsname, mountpoint, shareopts);\n\treturn (fstypes[protocol]->enable_share(&args));\n}\n\nint\nsa_disable_share(const char *mountpoint, enum sa_protocol protocol)\n{\n\tVALIDATE_PROTOCOL(protocol, SA_INVALID_PROTOCOL);\n\n\tconst struct sa_share_impl args = init_share(NULL, mountpoint, NULL);\n\treturn (fstypes[protocol]->disable_share(&args));\n}\n\nboolean_t\nsa_is_shared(const char *mountpoint, enum sa_protocol protocol)\n{\n\tVALIDATE_PROTOCOL(protocol, B_FALSE);\n\n\tconst struct sa_share_impl args = init_share(NULL, mountpoint, NULL);\n\treturn (fstypes[protocol]->is_shared(&args));\n}\n\nvoid\nsa_commit_shares(enum sa_protocol protocol)\n{\n\t \n\tVALIDATE_PROTOCOL(protocol, );\n\n\tfstypes[protocol]->commit_shares();\n}\n\nvoid\nsa_truncate_shares(enum sa_protocol protocol)\n{\n\t \n\tVALIDATE_PROTOCOL(protocol, );\n\n\tif (fstypes[protocol]->truncate_shares != NULL)\n\t\tfstypes[protocol]->truncate_shares();\n}\n\nint\nsa_validate_shareopts(const char *options, enum sa_protocol protocol)\n{\n\tVALIDATE_PROTOCOL(protocol, SA_INVALID_PROTOCOL);\n\n\treturn (fstypes[protocol]->validate_shareopts(options));\n}\n\n \nconst char *\nsa_errorstr(int err)\n{\n\tstatic char errstr[32];\n\n\tswitch (err) {\n\tcase SA_OK:\n\t\treturn (dgettext(TEXT_DOMAIN, \"ok\"));\n\tcase SA_NO_SUCH_PATH:\n\t\treturn (dgettext(TEXT_DOMAIN, \"path doesn't exist\"));\n\tcase SA_NO_MEMORY:\n\t\treturn (dgettext(TEXT_DOMAIN, \"no memory\"));\n\tcase SA_DUPLICATE_NAME:\n\t\treturn (dgettext(TEXT_DOMAIN, \"name in use\"));\n\tcase SA_BAD_PATH:\n\t\treturn (dgettext(TEXT_DOMAIN, \"bad path\"));\n\tcase SA_NO_SUCH_GROUP:\n\t\treturn (dgettext(TEXT_DOMAIN, \"no such group\"));\n\tcase SA_CONFIG_ERR:\n\t\treturn (dgettext(TEXT_DOMAIN, \"configuration error\"));\n\tcase SA_SYSTEM_ERR:\n\t\treturn (dgettext(TEXT_DOMAIN, \"system error\"));\n\tcase SA_SYNTAX_ERR:\n\t\treturn (dgettext(TEXT_DOMAIN, \"syntax error\"));\n\tcase SA_NO_PERMISSION:\n\t\treturn (dgettext(TEXT_DOMAIN, \"no permission\"));\n\tcase SA_BUSY:\n\t\treturn (dgettext(TEXT_DOMAIN, \"busy\"));\n\tcase SA_NO_SUCH_PROP:\n\t\treturn (dgettext(TEXT_DOMAIN, \"no such property\"));\n\tcase SA_INVALID_NAME:\n\t\treturn (dgettext(TEXT_DOMAIN, \"invalid name\"));\n\tcase SA_INVALID_PROTOCOL:\n\t\treturn (dgettext(TEXT_DOMAIN, \"invalid protocol\"));\n\tcase SA_NOT_ALLOWED:\n\t\treturn (dgettext(TEXT_DOMAIN, \"operation not allowed\"));\n\tcase SA_BAD_VALUE:\n\t\treturn (dgettext(TEXT_DOMAIN, \"bad property value\"));\n\tcase SA_INVALID_SECURITY:\n\t\treturn (dgettext(TEXT_DOMAIN, \"invalid security type\"));\n\tcase SA_NO_SUCH_SECURITY:\n\t\treturn (dgettext(TEXT_DOMAIN, \"security type not found\"));\n\tcase SA_VALUE_CONFLICT:\n\t\treturn (dgettext(TEXT_DOMAIN, \"property value conflict\"));\n\tcase SA_NOT_IMPLEMENTED:\n\t\treturn (dgettext(TEXT_DOMAIN, \"not implemented\"));\n\tcase SA_INVALID_PATH:\n\t\treturn (dgettext(TEXT_DOMAIN, \"invalid path\"));\n\tcase SA_NOT_SUPPORTED:\n\t\treturn (dgettext(TEXT_DOMAIN, \"operation not supported\"));\n\tcase SA_PROP_SHARE_ONLY:\n\t\treturn (dgettext(TEXT_DOMAIN, \"property not valid for group\"));\n\tcase SA_NOT_SHARED:\n\t\treturn (dgettext(TEXT_DOMAIN, \"not shared\"));\n\tcase SA_NO_SUCH_RESOURCE:\n\t\treturn (dgettext(TEXT_DOMAIN, \"no such resource\"));\n\tcase SA_RESOURCE_REQUIRED:\n\t\treturn (dgettext(TEXT_DOMAIN, \"resource name required\"));\n\tcase SA_MULTIPLE_ERROR:\n\t\treturn (dgettext(TEXT_DOMAIN,\n\t\t    \"errors from multiple protocols\"));\n\tcase SA_PATH_IS_SUBDIR:\n\t\treturn (dgettext(TEXT_DOMAIN, \"path is a subpath of share\"));\n\tcase SA_PATH_IS_PARENTDIR:\n\t\treturn (dgettext(TEXT_DOMAIN, \"path is parent of a share\"));\n\tcase SA_NO_SECTION:\n\t\treturn (dgettext(TEXT_DOMAIN, \"protocol requires a section\"));\n\tcase SA_NO_PROPERTIES:\n\t\treturn (dgettext(TEXT_DOMAIN, \"properties not found\"));\n\tcase SA_NO_SUCH_SECTION:\n\t\treturn (dgettext(TEXT_DOMAIN, \"section not found\"));\n\tcase SA_PASSWORD_ENC:\n\t\treturn (dgettext(TEXT_DOMAIN, \"passwords must be encrypted\"));\n\tcase SA_SHARE_EXISTS:\n\t\treturn (dgettext(TEXT_DOMAIN,\n\t\t    \"path or file is already shared\"));\n\tdefault:\n\t\t(void) snprintf(errstr, sizeof (errstr),\n\t\t    dgettext(TEXT_DOMAIN, \"unknown %d\"), err);\n\t\treturn (errstr);\n\t}\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}