{
  "module_name": "libzfs_zmount.c",
  "hash_id": "81ff7d43ccdd8c14c28a402cd9918cbb18787e640f4922c201583f1f6928da31",
  "original_prompt": "Ingested from zfs-2.2.2/lib/libzfs/os/freebsd/libzfs_zmount.c",
  "human_readable_source": " \n\n \n\n#include <sys/cdefs.h>\n__FBSDID(\"$FreeBSD$\");\n\n#include <sys/param.h>\n#include <sys/mount.h>\n#include <sys/uio.h>\n#include <sys/mntent.h>\n#include <assert.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <sys/mnttab.h>\n#include <sys/errno.h>\n#include <libzfs.h>\n\n#include \"../../libzfs_impl.h\"\n\nstatic void\nbuild_iovec(struct iovec **iov, int *iovlen, const char *name, void *val,\n    size_t len)\n{\n\tint i;\n\n\tif (*iovlen < 0)\n\t\treturn;\n\ti = *iovlen;\n\t*iov = realloc(*iov, sizeof (**iov) * (i + 2));\n\tif (*iov == NULL) {\n\t\t*iovlen = -1;\n\t\treturn;\n\t}\n\t(*iov)[i].iov_base = strdup(name);\n\t(*iov)[i].iov_len = strlen(name) + 1;\n\ti++;\n\t(*iov)[i].iov_base = val;\n\tif (len == (size_t)-1) {\n\t\tif (val != NULL)\n\t\t\tlen = strlen(val) + 1;\n\t\telse\n\t\t\tlen = 0;\n\t}\n\t(*iov)[i].iov_len = (int)len;\n\t*iovlen = ++i;\n}\n\nint\ndo_mount(zfs_handle_t *zhp, const char *mntpt, const char *opts, int flags)\n{\n\tstruct iovec *iov;\n\tchar *optstr, *p, *tofree;\n\tint iovlen, rv;\n\tconst char *spec = zfs_get_name(zhp);\n\n\tassert(spec != NULL);\n\tassert(mntpt != NULL);\n\tassert(opts != NULL);\n\n\ttofree = optstr = strdup(opts);\n\tassert(optstr != NULL);\n\n\tiov = NULL;\n\tiovlen = 0;\n\tif (strstr(optstr, MNTOPT_REMOUNT) != NULL)\n\t\tbuild_iovec(&iov, &iovlen, \"update\", NULL, 0);\n\tif (flags & MS_RDONLY)\n\t\tbuild_iovec(&iov, &iovlen, \"ro\", NULL, 0);\n\tbuild_iovec(&iov, &iovlen, \"fstype\", __DECONST(char *, MNTTYPE_ZFS),\n\t    (size_t)-1);\n\tbuild_iovec(&iov, &iovlen, \"fspath\", __DECONST(char *, mntpt),\n\t    (size_t)-1);\n\tbuild_iovec(&iov, &iovlen, \"from\", __DECONST(char *, spec), (size_t)-1);\n\twhile ((p = strsep(&optstr, \",/\")) != NULL)\n\t\tbuild_iovec(&iov, &iovlen, p, NULL, (size_t)-1);\n\trv = nmount(iov, iovlen, 0);\n\tfree(tofree);\n\tif (rv < 0)\n\t\treturn (errno);\n\treturn (rv);\n\n}\n\nint\ndo_unmount(zfs_handle_t *zhp, const char *mntpt, int flags)\n{\n\t(void) zhp;\n\tif (unmount(mntpt, flags) < 0)\n\t\treturn (errno);\n\treturn (0);\n}\n\nint\nzfs_mount_delegation_check(void)\n{\n\treturn (0);\n}\n\n \nvoid\nzpool_disable_datasets_os(zpool_handle_t *zhp, boolean_t force)\n{\n\t(void) zhp, (void) force;\n}\n\n \nvoid\nzpool_disable_volume_os(const char *name)\n{\n\t(void) name;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}