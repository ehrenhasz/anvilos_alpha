{
  "module_name": "zvol_id.c",
  "hash_id": "353665496bca02e9b2a708f075ed9683864b3422362bc348efaf12a59da3df91",
  "original_prompt": "Ingested from zfs-2.2.2/udev/zvol_id.c",
  "human_readable_source": " \n \n\n#include <ctype.h>\n#include <errno.h>\n#include <fcntl.h>\n#include <stdio.h>\n#include <string.h>\n#include <unistd.h>\n#include <sys/fs/zfs.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n\n#if defined(ZFS_ASAN_ENABLED)\n \nextern const char *__asan_default_options(void);\n\nconst char *__asan_default_options(void) {\n\treturn (\"abort_on_error=true:halt_on_error=true:\"\n\t\t\"allocator_may_return_null=true:disable_coredump=false:\"\n\t\t\"detect_stack_use_after_return=true:detect_leaks=false\");\n}\n#endif\n\nint\nmain(int argc, const char *const *argv)\n{\n\tif (argc != 2) {\n\t\tfprintf(stderr, \"usage: %s /dev/zdX\\n\", argv[0]);\n\t\treturn (1);\n\t}\n\tconst char *dev_name = argv[1];\n\n\tint fd;\n\tstruct stat sb;\n\tif ((fd = open(dev_name, O_RDONLY|O_CLOEXEC)) == -1 ||\n\t    fstat(fd, &sb) != 0) {\n\t\tfprintf(stderr, \"%s: %s\\n\", dev_name, strerror(errno));\n\t\treturn (1);\n\t}\n\n\tchar zvol_name[MAXNAMELEN + strlen(\"-part\") + 10];\n\tif (ioctl(fd, BLKZNAME, zvol_name) == -1) {\n\t\tfprintf(stderr, \"%s: BLKZNAME: %s\\n\",\n\t\t    dev_name, strerror(errno));\n\t\treturn (1);\n\t}\n\n\tunsigned int dev_part = minor(sb.st_rdev) % ZVOL_MINORS;\n\tif (dev_part != 0)\n\t\tsprintf(zvol_name + strlen(zvol_name), \"-part%u\", dev_part);\n\n\tfor (size_t i = 0; i < strlen(zvol_name); ++i)\n\t\tif (isblank(zvol_name[i]))\n\t\t\tzvol_name[i] = '+';\n\n\tputs(zvol_name);\n\n\treturn (0);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}