{
  "module_name": "find_system_library.m4",
  "hash_id": "c1723f4af77cfca069e5b4a3e34a61c591bf71f7e26c32df1dff201fb4d2e3fa",
  "original_prompt": "Ingested from zfs-2.2.2/config/find_system_library.m4",
  "human_readable_source": "# find_system_lib.m4 - Macros to search for a system library.   -*- Autoconf -*-\n\ndnl requires pkg.m4 from pkg-config\ndnl requires ax_save_flags.m4 from autoconf-archive\ndnl requires ax_restore_flags.m4 from autoconf-archive\n\ndnl ZFS_AC_FIND_SYSTEM_LIBRARY(VARIABLE-PREFIX, MODULE, HEADER, HEADER-PREFIXES, LIBRARY, FUNCTIONS, [ACTION-IF-FOUND], [ACTION-IF-NOT-FOUND])\n\nAC_DEFUN([ZFS_AC_FIND_SYSTEM_LIBRARY], [\n    AC_REQUIRE([PKG_PROG_PKG_CONFIG])\n\n    _header_found=\n    _library_found=\n    _pc_found=\n\n    AS_IF([test -n \"$2\"], [PKG_CHECK_MODULES([$1], [$2], [\n\t_header_found=1\n\t_library_found=1\n\t_pc_found=1\n    ], [:])])\n\n    # set _header_found/_library_found if the user passed in CFLAGS/LIBS\n    AS_IF([test \"x$[$1][_CFLAGS]\" != x], [_header_found=1])\n    AS_IF([test \"x$[$1][_LIBS]\" != x], [_library_found=1])\n\n    AX_SAVE_FLAGS\n\n    orig_CFLAGS=\"$CFLAGS\"\n\n    for _prefixdir in /usr /usr/local\n    do\n\tAS_VAR_PUSHDEF([header_cache], [ac_cv_header_$3])\n\tAS_IF([test \"x$_prefixdir\" != \"x/usr\"], [\n\t    [$1][_CFLAGS]=\"-I$lt_sysroot$_prefixdir/include\"\n\t    AS_IF([test \"x$_library_found\" = x], [\n\t\t[$1][_LIBS]=\"-L$lt_sysroot$_prefixdir/lib\"\n\t    ])\n\t])\n\tCFLAGS=\"$orig_CFLAGS $[$1][_CFLAGS]\"\n\tAS_UNSET([header_cache])\n\tAC_CHECK_HEADER([$3], [\n\t    _header_found=1\n\t    break\n\t], [AS_IF([test \"x$_header_found\" = \"x1\"], [\n\t    # if pkg-config or the user set CFLAGS, fail if the header is unusable\n\t    AC_MSG_FAILURE([header [$3] for library [$5] is not usable])\n\t])], [AC_INCLUDES_DEFAULT])\n\t# search for header under HEADER-PREFIXES\n\tm4_foreach_w([prefix], [$4], [\n\t    [$1][_CFLAGS]=[\"-I$lt_sysroot$_prefixdir/include/]prefix[\"]\n\t    CFLAGS=\"$orig_CFLAGS $[$1][_CFLAGS]\"\n\t    AS_UNSET([header_cache])\n\t    AC_CHECK_HEADER([$3], [\n\t\t_header_found=1\n\t\tbreak\n\t    ], [], [AC_INCLUDES_DEFAULT])\n\t])\n\tAS_VAR_POPDEF([header_cache])\n    done\n\n    AS_IF([test \"x$_header_found\" = \"x1\"], [\n\tAS_IF([test \"x$_library_found\" = x], [\n\t    [$1][_LIBS]=\"$[$1]_LIBS -l[$5]\"\n\t])\n\tLDFLAGS=\"$LDFLAGS $[$1][_LIBS]\"\n\n\t_libcheck=1\n\tm4_ifval([$6],\n\t    [m4_foreach_w([func], [$6], [AC_CHECK_LIB([$5], func, [:], [_libcheck=])])],\n\t    [AC_CHECK_LIB([$5], [main], [:], [_libcheck=])])\n\n\tAS_IF([test \"x$_libcheck\" = \"x1\"], [_library_found=1],\n\t    [test \"x$_library_found\" = \"x1\"], [\n\t    # if pkg-config or the user set LIBS, fail if the library is unusable\n\t    AC_MSG_FAILURE([library [$5] is not usable])\n\t])\n    ], [test \"x$_library_found\" = \"x1\"], [\n\t# if the user set LIBS, fail if we didn't find the header\n\tAC_MSG_FAILURE([cannot find header [$3] for library [$5]])\n    ])\n\n    AX_RESTORE_FLAGS\n\n    AS_IF([test \"x$_header_found\" = \"x1\" && test \"x$_library_found\" = \"x1\"], [\n\tAC_SUBST([$1]_CFLAGS)\n\tAC_SUBST([$1]_LIBS)\n\tAS_IF([test \"x$_pc_found\" = \"x1\"], [\n\t    AC_SUBST([$1]_PC, [$2])\n\t])\n\tAC_DEFINE([HAVE_][$1], [1], [Define if you have [$5]])\n\t$7\n    ],[dnl ELSE\n\tAC_SUBST([$1]_CFLAGS, [])\n\tAC_SUBST([$1]_LIBS, [])\n\tAC_MSG_WARN([cannot find [$5] via pkg-config or in the standard locations])\n\t$8\n    ])\n])\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}