{
  "module_name": "kernel-vfs-direct_IO.m4",
  "hash_id": "63301214db970359eb4f8e7895bb49f60862c27910e947a0af176104bfcbfe32",
  "original_prompt": "Ingested from zfs-2.2.2/config/kernel-vfs-direct_IO.m4",
  "human_readable_source": "dnl #\ndnl # Check for direct IO interfaces.\ndnl #\nAC_DEFUN([ZFS_AC_KERNEL_SRC_VFS_DIRECT_IO], [\n\tZFS_LINUX_TEST_SRC([direct_io_iter], [\n\t\t#include <linux/fs.h>\n\n\t\tssize_t test_direct_IO(struct kiocb *kiocb,\n\t\t    struct iov_iter *iter) { return 0; }\n\n\t\tstatic const struct address_space_operations\n\t\t    aops __attribute__ ((unused)) = {\n\t\t\t.direct_IO = test_direct_IO,\n\t\t};\n\t],[])\n\n\tZFS_LINUX_TEST_SRC([direct_io_iter_offset], [\n\t\t#include <linux/fs.h>\n\n\t\tssize_t test_direct_IO(struct kiocb *kiocb,\n\t\t    struct iov_iter *iter, loff_t offset) { return 0; }\n\n\t\tstatic const struct address_space_operations\n\t\t    aops __attribute__ ((unused)) = {\n\t\t\t.direct_IO = test_direct_IO,\n\t\t};\n\t],[])\n\n\tZFS_LINUX_TEST_SRC([direct_io_iter_rw_offset], [\n\t\t#include <linux/fs.h>\n\n\t\tssize_t test_direct_IO(int rw, struct kiocb *kiocb,\n\t\t    struct iov_iter *iter, loff_t offset) { return 0; }\n\n\t\tstatic const struct address_space_operations\n\t\t    aops __attribute__ ((unused)) = {\n\t\t    .direct_IO = test_direct_IO,\n\t\t};\n\t],[])\n\n\tZFS_LINUX_TEST_SRC([direct_io_iovec], [\n\t\t#include <linux/fs.h>\n\n\t\tssize_t test_direct_IO(int rw, struct kiocb *kiocb,\n\t\t    const struct iovec *iov, loff_t offset,\n\t\t    unsigned long nr_segs) { return 0; }\n\n\t\tstatic const struct address_space_operations\n\t\t    aops __attribute__ ((unused)) = {\n\t\t    .direct_IO = test_direct_IO,\n\t\t};\n\t],[])\n])\n\nAC_DEFUN([ZFS_AC_KERNEL_VFS_DIRECT_IO], [\n\tdnl #\n\tdnl # Linux 4.6.x API change\n\tdnl #\n\tAC_MSG_CHECKING([whether aops->direct_IO() uses iov_iter])\n\tZFS_LINUX_TEST_RESULT([direct_io_iter], [\n\t\tAC_MSG_RESULT([yes])\n\t\tAC_DEFINE(HAVE_VFS_DIRECT_IO_ITER, 1,\n\t\t    [aops->direct_IO() uses iov_iter without rw])\n\t],[\n\t\tAC_MSG_RESULT([no])\n\n\t\tdnl #\n\t\tdnl # Linux 4.1.x API change\n\t\tdnl #\n\t\tAC_MSG_CHECKING(\n\t\t    [whether aops->direct_IO() uses offset])\n\t\tZFS_LINUX_TEST_RESULT([direct_io_iter_offset], [\n\t\t\tAC_MSG_RESULT([yes])\n\t\t\tAC_DEFINE(HAVE_VFS_DIRECT_IO_ITER_OFFSET, 1,\n\t\t\t    [aops->direct_IO() uses iov_iter with offset])\n\n\t\t],[\n\t\t\tAC_MSG_RESULT([no])\n\n\t\t\tdnl #\n\t\t\tdnl # Linux 3.16.x API change\n\t\t\tdnl #\n\t\t\tAC_MSG_CHECKING(\n\t\t\t    [whether aops->direct_IO() uses rw and offset])\n\t\t\tZFS_LINUX_TEST_RESULT([direct_io_iter_rw_offset], [\n\t\t\t\tAC_MSG_RESULT([yes])\n\t\t\t\tAC_DEFINE(HAVE_VFS_DIRECT_IO_ITER_RW_OFFSET, 1,\n\t\t\t\t    [aops->direct_IO() uses iov_iter with ]\n\t\t\t\t    [rw and offset])\n\t\t\t],[\n\t\t\t\tAC_MSG_RESULT([no])\n\n\t\t\t\tdnl #\n\t\t\t\tdnl # Ancient Linux API (predates git)\n\t\t\t\tdnl #\n\t\t\t\tAC_MSG_CHECKING(\n\t\t\t\t    [whether aops->direct_IO() uses iovec])\n\t\t\t\tZFS_LINUX_TEST_RESULT([direct_io_iovec], [\n\t\t\t\t\tAC_MSG_RESULT([yes])\n\t\t\t\t\tAC_DEFINE(HAVE_VFS_DIRECT_IO_IOVEC, 1,\n\t\t\t\t\t    [aops->direct_IO() uses iovec])\n\t\t\t\t],[\n\t\t\t\t\tZFS_LINUX_TEST_ERROR([direct IO])\n\t\t\t\t\tAC_MSG_RESULT([no])\n\t\t\t\t])\n\t\t\t])\n\t\t])\n\t])\n])\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}