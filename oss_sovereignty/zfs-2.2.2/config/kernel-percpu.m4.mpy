{
  "module_name": "kernel-percpu.m4",
  "hash_id": "0d302b4bfb07f5d3bce974b6d334f3331235d06120992736de42e46dc6d9830e",
  "original_prompt": "Ingested from zfs-2.2.2/config/kernel-percpu.m4",
  "human_readable_source": "dnl #\ndnl # 3.18 API change,\ndnl # The function percpu_counter_init now must be passed a GFP mask.\ndnl #\nAC_DEFUN([ZFS_AC_KERNEL_SRC_PERCPU_COUNTER_INIT], [\n\tZFS_LINUX_TEST_SRC([percpu_counter_init_with_gfp], [\n\t\t#include <linux/gfp.h>\n\t\t#include <linux/percpu_counter.h>\n\t],[\n\t\tstruct percpu_counter counter;\n\t\tint error;\n\n\t\terror = percpu_counter_init(&counter, 0, GFP_KERNEL);\n\t])\n])\n\nAC_DEFUN([ZFS_AC_KERNEL_PERCPU_COUNTER_INIT], [\n\tAC_MSG_CHECKING([whether percpu_counter_init() wants gfp_t])\n\tZFS_LINUX_TEST_RESULT([percpu_counter_init_with_gfp], [\n\t\tAC_MSG_RESULT(yes)\n\t\tAC_DEFINE(HAVE_PERCPU_COUNTER_INIT_WITH_GFP, 1,\n\t\t    [percpu_counter_init() wants gfp_t])\n\t],[\n\t\tAC_MSG_RESULT(no)\n\t])\n])\n\ndnl #\ndnl # 4.13 API change,\ndnl # __percpu_counter_add() was renamed to percpu_counter_add_batch().\ndnl #\nAC_DEFUN([ZFS_AC_KERNEL_SRC_PERCPU_COUNTER_ADD_BATCH], [\n\tZFS_LINUX_TEST_SRC([percpu_counter_add_batch], [\n\t\t#include <linux/percpu_counter.h>\n\t],[\n\t\tstruct percpu_counter counter;\n\n\t\tpercpu_counter_add_batch(&counter, 1, 1);\n\t])\n])\n\nAC_DEFUN([ZFS_AC_KERNEL_PERCPU_COUNTER_ADD_BATCH], [\n\tAC_MSG_CHECKING([whether percpu_counter_add_batch() is defined])\n\tZFS_LINUX_TEST_RESULT([percpu_counter_add_batch], [\n\t\tAC_MSG_RESULT(yes)\n\t\tAC_DEFINE(HAVE_PERCPU_COUNTER_ADD_BATCH, 1,\n\t\t    [percpu_counter_add_batch() is defined])\n\t],[\n\t\tAC_MSG_RESULT(no)\n\t])\n])\n\ndnl #\ndnl # 5.10 API change,\ndnl # The \"count\" was moved into ref->data, from ref\ndnl #\nAC_DEFUN([ZFS_AC_KERNEL_SRC_PERCPU_REF_COUNT_IN_DATA], [\n\tZFS_LINUX_TEST_SRC([percpu_ref_count_in_data], [\n\t\t#include <linux/percpu-refcount.h>\n\t],[\n\t\tstruct percpu_ref_data d;\n\n\t\tatomic_long_set(&d.count, 1L);\n\t])\n])\n\nAC_DEFUN([ZFS_AC_KERNEL_PERCPU_REF_COUNT_IN_DATA], [\n\tAC_MSG_CHECKING([whether is inside percpu_ref.data])\n\tZFS_LINUX_TEST_RESULT([percpu_ref_count_in_data], [\n\t\tAC_MSG_RESULT(yes)\n\t\tAC_DEFINE(ZFS_PERCPU_REF_COUNT_IN_DATA, 1,\n\t\t    [count is located in percpu_ref.data])\n\t],[\n\t\tAC_MSG_RESULT(no)\n\t])\n])\nAC_DEFUN([ZFS_AC_KERNEL_SRC_PERCPU], [\n\tZFS_AC_KERNEL_SRC_PERCPU_COUNTER_INIT\n\tZFS_AC_KERNEL_SRC_PERCPU_COUNTER_ADD_BATCH\n\tZFS_AC_KERNEL_SRC_PERCPU_REF_COUNT_IN_DATA\n])\n\nAC_DEFUN([ZFS_AC_KERNEL_PERCPU], [\n\tZFS_AC_KERNEL_PERCPU_COUNTER_INIT\n\tZFS_AC_KERNEL_PERCPU_COUNTER_ADD_BATCH\n\tZFS_AC_KERNEL_PERCPU_REF_COUNT_IN_DATA\n])\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}