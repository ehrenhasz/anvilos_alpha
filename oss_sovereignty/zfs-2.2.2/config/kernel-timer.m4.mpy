{
  "module_name": "kernel-timer.m4",
  "hash_id": "b91337bc0b6e305fc289ef823af8b8d56953e7cab39620c68e6fd900be3fef0e",
  "original_prompt": "Ingested from zfs-2.2.2/config/kernel-timer.m4",
  "human_readable_source": "dnl # 4.14-rc3 API change\ndnl # https://lwn.net/Articles/735887/\ndnl #\ndnl # Check if timer_list.func get passed a timer_list or an unsigned long\ndnl # (older kernels).  Also sanity check the from_timer() and timer_setup()\ndnl # macros are available as well, since they will be used in the same newer\ndnl # kernels that support the new timer_list.func signature.\ndnl #\ndnl # Also check for the existence of flags in struct timer_list, they were\ndnl # added in 4.1-rc8 via 0eeda71bc30d.\ndnl #\nAC_DEFUN([ZFS_AC_KERNEL_SRC_TIMER_SETUP], [\n\tZFS_LINUX_TEST_SRC([timer_setup], [\n\t\t#include <linux/timer.h>\n\n\t\tstruct my_task_timer {\n\t\t\tstruct timer_list timer;\n\t\t\tint data;\n\t\t};\n\n\t\tvoid task_expire(struct timer_list *tl)\n\t\t{\n\t\t\tstruct my_task_timer *task_timer =\n\t\t\t    from_timer(task_timer, tl, timer);\n\t\t\ttask_timer->data = 42;\n\t\t}\n\t],[\n\t\tstruct my_task_timer task_timer;\n\t\ttimer_setup(&task_timer.timer, task_expire, 0);\n\t])\n\n\tZFS_LINUX_TEST_SRC([timer_list_function], [\n\t\t#include <linux/timer.h>\n\t\tvoid task_expire(struct timer_list *tl) {}\n\t],[\n\t\tstruct timer_list tl;\n\t\ttl.function = task_expire;\n\t])\n\n\tZFS_LINUX_TEST_SRC([timer_list_flags], [\n\t\t#include <linux/timer.h>\n\t],[\n\t\tstruct timer_list tl;\n\t\ttl.flags = 2;\n\t])\n])\n\nAC_DEFUN([ZFS_AC_KERNEL_TIMER_SETUP], [\n\tAC_MSG_CHECKING([whether timer_setup() is available])\n\tZFS_LINUX_TEST_RESULT([timer_setup], [\n\t\tAC_MSG_RESULT(yes)\n\t\tAC_DEFINE(HAVE_KERNEL_TIMER_SETUP, 1,\n\t\t    [timer_setup() is available])\n\t],[\n\t\tAC_MSG_RESULT(no)\n\t])\n\n\tAC_MSG_CHECKING([whether timer function expects timer_list])\n\tZFS_LINUX_TEST_RESULT([timer_list_function], [\n\t\tAC_MSG_RESULT(yes)\n\t\tAC_DEFINE(HAVE_KERNEL_TIMER_FUNCTION_TIMER_LIST, 1,\n\t\t    [timer_list.function gets a timer_list])\n\t],[\n\t\tAC_MSG_RESULT(no)\n\t])\n\n\tAC_MSG_CHECKING([whether struct timer_list has flags])\n\tZFS_LINUX_TEST_RESULT([timer_list_flags], [\n\t\tAC_MSG_RESULT(yes)\n\t\tAC_DEFINE(HAVE_KERNEL_TIMER_LIST_FLAGS, 1,\n\t\t    [struct timer_list has a flags member])\n\t],[\n\t\tAC_MSG_RESULT(no)\n\t])\n])\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}