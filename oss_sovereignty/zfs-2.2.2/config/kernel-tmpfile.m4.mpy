{
  "module_name": "kernel-tmpfile.m4",
  "hash_id": "a7764cb6e05ddfe61afafa1452580da842175e54b5267b4155f1523e683aefa0",
  "original_prompt": "Ingested from zfs-2.2.2/config/kernel-tmpfile.m4",
  "human_readable_source": "dnl #\ndnl # 3.11 API change\ndnl # Add support for i_op->tmpfile\ndnl #\nAC_DEFUN([ZFS_AC_KERNEL_SRC_TMPFILE], [\n\tdnl #\n\tdnl # 6.3 API change\n\tdnl # The first arg is now struct mnt_idmap * \n\tdnl #\n\tZFS_LINUX_TEST_SRC([inode_operations_tmpfile_mnt_idmap], [\n\t\t#include <linux/fs.h>\n\t\tint tmpfile(struct mnt_idmap *idmap,\n\t\t    struct inode *inode, struct file *file,\n\t\t    umode_t mode) { return 0; }\n\t\tstatic struct inode_operations\n\t\t    iops __attribute__ ((unused)) = {\n\t\t\t.tmpfile = tmpfile,\n\t\t};\n\t],[])\n\tdnl # 6.1 API change\n\tdnl # use struct file instead of struct dentry\n\tdnl #\n\tZFS_LINUX_TEST_SRC([inode_operations_tmpfile], [\n\t\t#include <linux/fs.h>\n\t\tint tmpfile(struct user_namespace *userns,\n\t\t    struct inode *inode, struct file *file,\n\t\t    umode_t mode) { return 0; }\n\t\tstatic struct inode_operations\n\t\t    iops __attribute__ ((unused)) = {\n\t\t\t.tmpfile = tmpfile,\n\t\t};\n\t],[])\n\tdnl #\n\tdnl # 5.11 API change\n\tdnl # add support for userns parameter to tmpfile\n\tdnl #\n\tZFS_LINUX_TEST_SRC([inode_operations_tmpfile_dentry_userns], [\n\t\t#include <linux/fs.h>\n\t\tint tmpfile(struct user_namespace *userns,\n\t\t    struct inode *inode, struct dentry *dentry,\n\t\t    umode_t mode) { return 0; }\n\t\tstatic struct inode_operations\n\t\t    iops __attribute__ ((unused)) = {\n\t\t\t.tmpfile = tmpfile,\n\t\t};\n\t],[])\n\tZFS_LINUX_TEST_SRC([inode_operations_tmpfile_dentry], [\n\t\t\t#include <linux/fs.h>\n\t\t\tint tmpfile(struct inode *inode, struct dentry *dentry,\n\t\t\t    umode_t mode) { return 0; }\n\t\t\tstatic struct inode_operations\n\t\t\t    iops __attribute__ ((unused)) = {\n\t\t\t\t.tmpfile = tmpfile,\n\t\t\t};\n\t],[])\n])\n\nAC_DEFUN([ZFS_AC_KERNEL_TMPFILE], [\n\tAC_MSG_CHECKING([whether i_op->tmpfile() exists])\n\tZFS_LINUX_TEST_RESULT([inode_operations_tmpfile_mnt_idmap], [\n\t\tAC_MSG_RESULT(yes)\n\t\tAC_DEFINE(HAVE_TMPFILE, 1, [i_op->tmpfile() exists])\n\t\tAC_DEFINE(HAVE_TMPFILE_IDMAP, 1, [i_op->tmpfile() has mnt_idmap])\n\t], [\n\t\tZFS_LINUX_TEST_RESULT([inode_operations_tmpfile], [\n\t\t\tAC_MSG_RESULT(yes)\n\t\t\tAC_DEFINE(HAVE_TMPFILE, 1, [i_op->tmpfile() exists])\n\t\t\tAC_DEFINE(HAVE_TMPFILE_USERNS, 1, [i_op->tmpfile() has userns])\n\t\t],[\n\t\t\tZFS_LINUX_TEST_RESULT([inode_operations_tmpfile_dentry_userns], [\n\t\t\t\tAC_MSG_RESULT(yes)\n\t\t\t\tAC_DEFINE(HAVE_TMPFILE, 1, [i_op->tmpfile() exists])\n\t\t\t\tAC_DEFINE(HAVE_TMPFILE_USERNS, 1, [i_op->tmpfile() has userns])\n\t\t\t\tAC_DEFINE(HAVE_TMPFILE_DENTRY, 1, [i_op->tmpfile() uses old dentry signature])\n\t\t\t],[\n\t\t\t\tZFS_LINUX_TEST_RESULT([inode_operations_tmpfile_dentry], [\n\t\t\t\t\tAC_MSG_RESULT(yes)\n\t\t\t\t\tAC_DEFINE(HAVE_TMPFILE, 1, [i_op->tmpfile() exists])\n\t\t\t\t\tAC_DEFINE(HAVE_TMPFILE_DENTRY, 1, [i_op->tmpfile() uses old dentry signature])\n\t\t\t\t],[\n\t\t\t\t\tZFS_LINUX_REQUIRE_API([i_op->tmpfile()], [3.11])\n\t\t\t\t])\n\t\t\t])\n\t\t])\n\t])\n])\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}