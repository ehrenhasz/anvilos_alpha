{
  "module_name": "kernel-vfs-iterate.m4",
  "hash_id": "1c7146e86c098aa116671aad0e49c8114a2c3b1e960ecd0bffbfc90f0d7d059f",
  "original_prompt": "Ingested from zfs-2.2.2/config/kernel-vfs-iterate.m4",
  "human_readable_source": "AC_DEFUN([ZFS_AC_KERNEL_SRC_VFS_ITERATE], [\n\tZFS_LINUX_TEST_SRC([file_operations_iterate_shared], [\n\t\t#include <linux/fs.h>\n\t\tint iterate(struct file *filp, struct dir_context * context)\n\t\t    { return 0; }\n\n\t\tstatic const struct file_operations fops\n\t\t    __attribute__ ((unused)) = {\n\t\t\t.iterate_shared\t = iterate,\n\t\t};\n\t],[])\n\n\tZFS_LINUX_TEST_SRC([file_operations_iterate], [\n\t\t#include <linux/fs.h>\n\t\tint iterate(struct file *filp,\n\t\t    struct dir_context *context) { return 0; }\n\n\t\tstatic const struct file_operations fops\n\t\t    __attribute__ ((unused)) = {\n\t\t\t.iterate\t = iterate,\n\t\t};\n\n\t\t#if defined(FMODE_KABI_ITERATE)\n\t\t#error \"RHEL 7.5, FMODE_KABI_ITERATE interface\"\n\t\t#endif\n\t],[])\n\n\tZFS_LINUX_TEST_SRC([file_operations_readdir], [\n\t\t#include <linux/fs.h>\n\t\tint readdir(struct file *filp, void *entry,\n\t\t    filldir_t func) { return 0; }\n\n\t\tstatic const struct file_operations fops\n\t\t    __attribute__ ((unused)) = {\n\t\t\t.readdir = readdir,\n\t\t};\n\t],[])\n])\n\nAC_DEFUN([ZFS_AC_KERNEL_VFS_ITERATE], [\n\tdnl #\n\tdnl # 4.7 API change\n\tdnl #\n\tAC_MSG_CHECKING([whether fops->iterate_shared() is available])\n\tZFS_LINUX_TEST_RESULT([file_operations_iterate_shared], [\n\t\tAC_MSG_RESULT(yes)\n\t\tAC_DEFINE(HAVE_VFS_ITERATE_SHARED, 1,\n\t\t    [fops->iterate_shared() is available])\n\t],[\n\t\tAC_MSG_RESULT(no)\n\n\t\tdnl #\n\t\tdnl # 3.11 API change\n\t\tdnl #\n\t\tdnl # RHEL 7.5 compatibility; the fops.iterate() method was\n\t\tdnl # added to the file_operations structure but in order to\n\t\tdnl # maintain KABI compatibility all callers must set\n\t\tdnl # FMODE_KABI_ITERATE which is checked in iterate_dir().\n\t\tdnl # When detected ignore this interface and fallback to\n\t\tdnl # to using fops.readdir() to retain KABI compatibility.\n\t\tdnl #\n\t\tAC_MSG_CHECKING([whether fops->iterate() is available])\n\t\tZFS_LINUX_TEST_RESULT([file_operations_iterate], [\n\t\t\tAC_MSG_RESULT(yes)\n\t\t\tAC_DEFINE(HAVE_VFS_ITERATE, 1,\n\t\t\t    [fops->iterate() is available])\n\t\t],[\n\t\t\tAC_MSG_RESULT(no)\n\n\t\t\tdnl #\n\t\t\tdnl # readdir interface introduced\n\t\t\tdnl #\n\t\t\tAC_MSG_CHECKING([whether fops->readdir() is available])\n\t\t\tZFS_LINUX_TEST_RESULT([file_operations_readdir], [\n\t\t\t\tAC_MSG_RESULT(yes)\n\t\t\t\tAC_DEFINE(HAVE_VFS_READDIR, 1,\n\t\t\t\t    [fops->readdir() is available])\n\t\t\t],[\n\t\t\t\tZFS_LINUX_TEST_ERROR([vfs_iterate])\n\t\t\t])\n\t\t])\n\t])\n])\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}