{
  "module_name": "zfs-build.m4",
  "hash_id": "0051bf866ea63f466eea60849b8524b06984546182d76a9327aaa3e068d3d9b8",
  "original_prompt": "Ingested from zfs-2.2.2/config/zfs-build.m4",
  "human_readable_source": "AC_DEFUN([ZFS_AC_LICENSE], [\n\tAC_MSG_CHECKING([zfs author])\n\tAC_MSG_RESULT([$ZFS_META_AUTHOR])\n\n\tAC_MSG_CHECKING([zfs license])\n\tAC_MSG_RESULT([$ZFS_META_LICENSE])\n])\n\nAC_DEFUN([ZFS_AC_DEBUG_ENABLE], [\n\tDEBUG_CFLAGS=\"-Werror\"\n\tDEBUG_CPPFLAGS=\"-DDEBUG -UNDEBUG\"\n\tDEBUG_LDFLAGS=\"\"\n\tDEBUG_ZFS=\"_with_debug\"\n\tWITH_DEBUG=\"true\"\n\tAC_DEFINE(ZFS_DEBUG, 1, [zfs debugging enabled])\n\n\tKERNEL_DEBUG_CFLAGS=\"-Werror\"\n\tKERNEL_DEBUG_CPPFLAGS=\"-DDEBUG -UNDEBUG\"\n])\n\nAC_DEFUN([ZFS_AC_DEBUG_DISABLE], [\n\tDEBUG_CFLAGS=\"\"\n\tDEBUG_CPPFLAGS=\"-UDEBUG -DNDEBUG\"\n\tDEBUG_LDFLAGS=\"\"\n\tDEBUG_ZFS=\"_without_debug\"\n\tWITH_DEBUG=\"\"\n\n\tKERNEL_DEBUG_CFLAGS=\"\"\n\tKERNEL_DEBUG_CPPFLAGS=\"-UDEBUG -DNDEBUG\"\n])\n\ndnl #\ndnl # When debugging is enabled:\ndnl # - Enable all ASSERTs (-DDEBUG)\ndnl # - Promote all compiler warnings to errors (-Werror)\ndnl #\ndnl # (If INVARIANTS is detected, we need to force DEBUG, or strange panics\ndnl # can ensue.)\ndnl #\nAC_DEFUN([ZFS_AC_DEBUG], [\n\tAC_MSG_CHECKING([whether assertion support will be enabled])\n\tAC_ARG_ENABLE([debug],\n\t\t[AS_HELP_STRING([--enable-debug],\n\t\t[Enable compiler and code assertions @<:@default=no@:>@])],\n\t\t[],\n\t\t[enable_debug=no])\n\n\tAS_CASE([\"x$enable_debug\"],\n\t\t[\"xyes\"],\n\t\t[ZFS_AC_DEBUG_ENABLE],\n\t\t[\"xno\"],\n\t\t[ZFS_AC_DEBUG_DISABLE],\n\t\t[AC_MSG_ERROR([Unknown option $enable_debug])])\n\n\tAS_CASE([\"x$enable_invariants\"],\n\t\t[\"xyes\"],\n\t\t[],\n\t\t[\"xno\"],\n\t\t[],\n\t\t[ZFS_AC_DEBUG_INVARIANTS_DETECT])\n\n\tAS_CASE([\"x$enable_invariants\"],\n\t\t[\"xyes\"],\n\t\t[ZFS_AC_DEBUG_ENABLE],\n\t\t[\"xno\"],\n\t\t[],\n\t\t[AC_MSG_ERROR([Unknown option $enable_invariants])])\n\n\tAC_SUBST(DEBUG_CFLAGS)\n\tAC_SUBST(DEBUG_CPPFLAGS)\n\tAC_SUBST(DEBUG_LDFLAGS)\n\tAC_SUBST(DEBUG_ZFS)\n\tAC_SUBST(WITH_DEBUG)\n\n\tAC_SUBST(KERNEL_DEBUG_CFLAGS)\n\tAC_SUBST(KERNEL_DEBUG_CPPFLAGS)\n\n\tAC_MSG_RESULT([$enable_debug])\n])\n\nAC_DEFUN([ZFS_AC_DEBUGINFO_ENABLE], [\n\tDEBUG_CFLAGS=\"$DEBUG_CFLAGS -g -fno-inline $NO_IPA_SRA\"\n\n\tKERNEL_DEBUG_CFLAGS=\"$KERNEL_DEBUG_CFLAGS -fno-inline $KERNEL_NO_IPA_SRA\"\n\tKERNEL_MAKE=\"$KERNEL_MAKE CONFIG_DEBUG_INFO=y\"\n\n\tDEBUGINFO_ZFS=\"_with_debuginfo\"\n])\n\nAC_DEFUN([ZFS_AC_DEBUGINFO_DISABLE], [\n\tDEBUGINFO_ZFS=\"_without_debuginfo\"\n])\n\nAC_DEFUN([ZFS_AC_DEBUGINFO], [\n\tAC_MSG_CHECKING([whether debuginfo support will be forced])\n\tAC_ARG_ENABLE([debuginfo],\n\t\t[AS_HELP_STRING([--enable-debuginfo],\n\t\t[Force generation of debuginfo @<:@default=no@:>@])],\n\t\t[],\n\t\t[enable_debuginfo=no])\n\n\tAS_CASE([\"x$enable_debuginfo\"],\n\t\t[\"xyes\"],\n\t\t[ZFS_AC_DEBUGINFO_ENABLE],\n\t\t[\"xno\"],\n\t\t[ZFS_AC_DEBUGINFO_DISABLE],\n\t\t[AC_MSG_ERROR([Unknown option $enable_debuginfo])])\n\n\tAC_SUBST(DEBUG_CFLAGS)\n\tAC_SUBST(DEBUGINFO_ZFS)\n\n\tAC_SUBST(KERNEL_DEBUG_CFLAGS)\n\tAC_SUBST(KERNEL_MAKE)\n\n\tAC_MSG_RESULT([$enable_debuginfo])\n])\n\ndnl #\ndnl # Disabled by default, provides basic memory tracking.  Track the total\ndnl # number of bytes allocated with kmem_alloc() and freed with kmem_free().\ndnl # Then at module unload time if any bytes were leaked it will be reported\ndnl # on the console.\ndnl #\nAC_DEFUN([ZFS_AC_DEBUG_KMEM], [\n\tAC_MSG_CHECKING([whether basic kmem accounting is enabled])\n\tAC_ARG_ENABLE([debug-kmem],\n\t\t[AS_HELP_STRING([--enable-debug-kmem],\n\t\t[Enable basic kmem accounting @<:@default=no@:>@])],\n\t\t[],\n\t\t[enable_debug_kmem=no])\n\n\tAS_IF([test \"x$enable_debug_kmem\" = xyes], [\n\t\tKERNEL_DEBUG_CPPFLAGS=\"${KERNEL_DEBUG_CPPFLAGS} -DDEBUG_KMEM\"\n\t\tDEBUG_KMEM_ZFS=\"_with_debug_kmem\"\n\t], [\n\t\tDEBUG_KMEM_ZFS=\"_without_debug_kmem\"\n\t])\n\n\tAC_SUBST(KERNEL_DEBUG_CPPFLAGS)\n\tAC_SUBST(DEBUG_KMEM_ZFS)\n\n\tAC_MSG_RESULT([$enable_debug_kmem])\n])\n\ndnl #\ndnl # Disabled by default, provides detailed memory tracking.  This feature\ndnl # also requires --enable-debug-kmem to be set.  When enabled not only will\ndnl # total bytes be tracked but also the location of every kmem_alloc() and\ndnl # kmem_free().  When the module is unloaded a list of all leaked addresses\ndnl # and where they were allocated will be dumped to the console.  Enabling\ndnl # this feature has a significant impact on performance but it makes finding\ndnl # memory leaks straight forward.\ndnl #\nAC_DEFUN([ZFS_AC_DEBUG_KMEM_TRACKING], [\n\tAC_MSG_CHECKING([whether detailed kmem tracking is enabled])\n\tAC_ARG_ENABLE([debug-kmem-tracking],\n\t\t[AS_HELP_STRING([--enable-debug-kmem-tracking],\n\t\t[Enable detailed kmem tracking  @<:@default=no@:>@])],\n\t\t[],\n\t\t[enable_debug_kmem_tracking=no])\n\n\tAS_IF([test \"x$enable_debug_kmem_tracking\" = xyes], [\n\t\tKERNEL_DEBUG_CPPFLAGS=\"${KERNEL_DEBUG_CPPFLAGS} -DDEBUG_KMEM_TRACKING\"\n\t\tDEBUG_KMEM_TRACKING_ZFS=\"_with_debug_kmem_tracking\"\n\t], [\n\t\tDEBUG_KMEM_TRACKING_ZFS=\"_without_debug_kmem_tracking\"\n\t])\n\n\tAC_SUBST(KERNEL_DEBUG_CPPFLAGS)\n\tAC_SUBST(DEBUG_KMEM_TRACKING_ZFS)\n\n\tAC_MSG_RESULT([$enable_debug_kmem_tracking])\n])\n\nAC_DEFUN([ZFS_AC_DEBUG_INVARIANTS_DETECT_FREEBSD], [\n\tAS_IF([sysctl -n kern.conftxt | grep -Fqx $'options\\tINVARIANTS'],\n\t\t[enable_invariants=\"yes\"],\n\t\t[enable_invariants=\"no\"])\n])\n\nAC_DEFUN([ZFS_AC_DEBUG_INVARIANTS_DETECT], [\n\tAM_COND_IF([BUILD_FREEBSD],\n\t\t[ZFS_AC_DEBUG_INVARIANTS_DETECT_FREEBSD],\n\t\t[enable_invariants=\"no\"])\n])\n\ndnl #\ndnl # Detected for the running kernel by default, enables INVARIANTS features\ndnl # in the FreeBSD kernel module.  This feature must be used when building\ndnl # for a FreeBSD kernel with \"options INVARIANTS\" in the KERNCONF and must\ndnl # not be used when the INVARIANTS option is absent.\ndnl #\nAC_DEFUN([ZFS_AC_DEBUG_INVARIANTS], [\n\tAC_MSG_CHECKING([whether FreeBSD kernel INVARIANTS checks are enabled])\n\tAC_ARG_ENABLE([invariants],\n\t\t[AS_HELP_STRING([--enable-invariants],\n\t\t[Enable FreeBSD kernel INVARIANTS checks [[default: detect]]])],\n\t\t[], [ZFS_AC_DEBUG_INVARIANTS_DETECT])\n\n\tAS_IF([test \"x$enable_invariants\" = xyes],\n\t\t[WITH_INVARIANTS=\"true\"],\n\t\t[WITH_INVARIANTS=\"\"])\n\tAC_SUBST(WITH_INVARIANTS)\n\n\tAC_MSG_RESULT([$enable_invariants])\n])\n\nAC_DEFUN([ZFS_AC_CONFIG_ALWAYS], [\n\tAX_COUNT_CPUS([])\n\tAC_SUBST(CPU_COUNT)\n\n\tZFS_AC_CONFIG_ALWAYS_CC_NO_CLOBBERED\n\tZFS_AC_CONFIG_ALWAYS_CC_INFINITE_RECURSION\n\tZFS_AC_CONFIG_ALWAYS_KERNEL_CC_INFINITE_RECURSION\n\tZFS_AC_CONFIG_ALWAYS_CC_IMPLICIT_FALLTHROUGH\n\tZFS_AC_CONFIG_ALWAYS_CC_FRAME_LARGER_THAN\n\tZFS_AC_CONFIG_ALWAYS_CC_NO_FORMAT_TRUNCATION\n\tZFS_AC_CONFIG_ALWAYS_CC_NO_FORMAT_ZERO_LENGTH\n\tZFS_AC_CONFIG_ALWAYS_CC_FORMAT_OVERFLOW\n\tZFS_AC_CONFIG_ALWAYS_CC_NO_OMIT_FRAME_POINTER\n\tZFS_AC_CONFIG_ALWAYS_CC_NO_IPA_SRA\n\tZFS_AC_CONFIG_ALWAYS_KERNEL_CC_NO_IPA_SRA\n\tZFS_AC_CONFIG_ALWAYS_CC_ASAN\n\tZFS_AC_CONFIG_ALWAYS_CC_UBSAN\n\tZFS_AC_CONFIG_ALWAYS_TOOLCHAIN_SIMD\n\tZFS_AC_CONFIG_ALWAYS_SYSTEM\n\tZFS_AC_CONFIG_ALWAYS_ARCH\n\tZFS_AC_CONFIG_ALWAYS_PYTHON\n\tZFS_AC_CONFIG_ALWAYS_PYZFS\n\tZFS_AC_CONFIG_ALWAYS_SED\n\tZFS_AC_CONFIG_ALWAYS_CPPCHECK\n\tZFS_AC_CONFIG_ALWAYS_SHELLCHECK\n\tZFS_AC_CONFIG_ALWAYS_PARALLEL\n])\n\nAC_DEFUN([ZFS_AC_CONFIG], [\n\n        dnl # Remove the previous build test directory.\n        rm -Rf build\n\n\tZFS_CONFIG=all\n\tAC_ARG_WITH([config],\n\t\tAS_HELP_STRING([--with-config=CONFIG],\n\t\t[Config file 'kernel|user|all|srpm']),\n\t\t[ZFS_CONFIG=\"$withval\"])\n\tAC_ARG_ENABLE([linux-builtin],\n\t\t[AS_HELP_STRING([--enable-linux-builtin],\n\t\t[Configure for builtin in-tree kernel modules @<:@default=no@:>@])],\n\t\t[],\n\t\t[enable_linux_builtin=no])\n\n\tAC_MSG_CHECKING([zfs config])\n\tAC_MSG_RESULT([$ZFS_CONFIG]);\n\tAC_SUBST(ZFS_CONFIG)\n\n\tZFS_AC_CONFIG_ALWAYS\n\n\tAM_COND_IF([BUILD_LINUX], [\n\t\tAC_ARG_VAR([TEST_JOBS], [simultaneous jobs during configure])\n\t\tif test \"x$ac_cv_env_TEST_JOBS_set\" != \"xset\"; then\n\t\t\tTEST_JOBS=$CPU_COUNT\n\t\tfi\n\t\tAC_SUBST(TEST_JOBS)\n\t])\n\n\tZFS_INIT_SYSV=\n\tZFS_INIT_SYSTEMD=\n\tZFS_WANT_MODULES_LOAD_D=\n\n\tcase \"$ZFS_CONFIG\" in\n\t\tkernel) ZFS_AC_CONFIG_KERNEL ;;\n\t\tuser)\tZFS_AC_CONFIG_USER   ;;\n\t\tall)    ZFS_AC_CONFIG_USER\n\t\t\tZFS_AC_CONFIG_KERNEL ;;\n\t\tdist)                        ;;\n\t\tsrpm)                        ;;\n\t\t*)\n\t\tAC_MSG_RESULT([Error!])\n\t\tAC_MSG_ERROR([Bad value \"$ZFS_CONFIG\" for --with-config,\n\t\t              user kernel|user|all|srpm]) ;;\n\tesac\n\n\tAM_CONDITIONAL([INIT_SYSV],           [test \"x$ZFS_INIT_SYSV\" = \"xyes\"])\n\tAM_CONDITIONAL([INIT_SYSTEMD],        [test \"x$ZFS_INIT_SYSTEMD\" = \"xyes\"])\n\tAM_CONDITIONAL([WANT_MODULES_LOAD_D], [test \"x$ZFS_WANT_MODULES_LOAD_D\" = \"xyes\"])\n\n\tAM_CONDITIONAL([CONFIG_USER],\n\t    [test \"$ZFS_CONFIG\" = user -o \"$ZFS_CONFIG\" = all])\n\tAM_CONDITIONAL([CONFIG_KERNEL],\n\t    [test \"$ZFS_CONFIG\" = kernel -o \"$ZFS_CONFIG\" = all] &&\n\t    [test \"x$enable_linux_builtin\" != xyes ])\n\tAM_CONDITIONAL([CONFIG_QAT],\n\t    [test \"$ZFS_CONFIG\" = kernel -o \"$ZFS_CONFIG\" = all] &&\n\t    [test \"x$qatsrc\" != x ])\n\tAM_CONDITIONAL([WANT_DEVNAME2DEVID], [test \"x$user_libudev\" = xyes ])\n\tAM_CONDITIONAL([WANT_MMAP_LIBAIO], [test \"x$user_libaio\" = xyes ])\n\tAM_CONDITIONAL([PAM_ZFS_ENABLED], [test \"x$enable_pam\" = xyes])\n])\n\ndnl #\ndnl # Check for rpm+rpmbuild to build RPM packages.  If these tools\ndnl # are missing it is non-fatal but you will not be able to build\ndnl # RPM packages and will be warned if you try too.\ndnl #\ndnl # By default the generic spec file will be used because it requires\ndnl # minimal dependencies.  Distribution specific spec files can be\ndnl # placed under the 'rpm/<distribution>' directory and enabled using\ndnl # the --with-spec=<distribution> configure option.\ndnl #\nAC_DEFUN([ZFS_AC_RPM], [\n\tRPM=rpm\n\tRPMBUILD=rpmbuild\n\n\tAC_MSG_CHECKING([whether $RPM is available])\n\tAS_IF([tmp=$($RPM --version 2>/dev/null)], [\n\t\tRPM_VERSION=$(echo $tmp | $AWK '/RPM/ { print $[3] }')\n\t\tHAVE_RPM=yes\n\t\tAC_MSG_RESULT([$HAVE_RPM ($RPM_VERSION)])\n\t],[\n\t\tHAVE_RPM=no\n\t\tAC_MSG_RESULT([$HAVE_RPM])\n\t])\n\n\tAC_MSG_CHECKING([whether $RPMBUILD is available])\n\tAS_IF([tmp=$($RPMBUILD --version 2>/dev/null)], [\n\t\tRPMBUILD_VERSION=$(echo $tmp | $AWK '/RPM/ { print $[3] }')\n\t\tHAVE_RPMBUILD=yes\n\t\tAC_MSG_RESULT([$HAVE_RPMBUILD ($RPMBUILD_VERSION)])\n\t],[\n\t\tHAVE_RPMBUILD=no\n\t\tAC_MSG_RESULT([$HAVE_RPMBUILD])\n\t])\n\n\tRPM_DEFINE_COMMON='--define \"$(DEBUG_ZFS) 1\"'\n\tRPM_DEFINE_COMMON=${RPM_DEFINE_COMMON}' --define \"$(DEBUGINFO_ZFS) 1\"'\n\tRPM_DEFINE_COMMON=${RPM_DEFINE_COMMON}' --define \"$(DEBUG_KMEM_ZFS) 1\"'\n\tRPM_DEFINE_COMMON=${RPM_DEFINE_COMMON}' --define \"$(DEBUG_KMEM_TRACKING_ZFS) 1\"'\n\tRPM_DEFINE_COMMON=${RPM_DEFINE_COMMON}' --define \"$(ASAN_ZFS) 1\"'\n\tRPM_DEFINE_COMMON=${RPM_DEFINE_COMMON}' --define \"$(UBSAN_ZFS) 1\"'\n\n\tAS_IF([test \"x$enable_debuginfo\" = xyes], [\n\t\tRPM_DEFINE_COMMON=${RPM_DEFINE_COMMON}' --define \"__strip /bin/true\"'\n\t])\n\n\tRPM_DEFINE_UTIL=' --define \"_initconfdir $(initconfdir)\"'\n\n\tdnl # Make the next three RPM_DEFINE_UTIL additions conditional, since\n\tdnl # their values may not be set when running:\n\tdnl #\n\tdnl #\t./configure --with-config=srpm\n\tdnl #\n\tAS_IF([test -n \"$dracutdir\" ], [\n\t\tRPM_DEFINE_UTIL=${RPM_DEFINE_UTIL}' --define \"_dracutdir $(dracutdir)\"'\n\t])\n\tAS_IF([test -n \"$udevdir\" ], [\n\t\tRPM_DEFINE_UTIL=${RPM_DEFINE_UTIL}' --define \"_udevdir $(udevdir)\"'\n\t])\n\tAS_IF([test -n \"$udevruledir\" ], [\n\t\tRPM_DEFINE_UTIL=${RPM_DEFINE_UTIL}' --define \"_udevruledir $(udevruledir)\"'\n\t])\n\tAS_IF([test -n \"$bashcompletiondir\" ], [\n\t\tRPM_DEFINE_UTIL=${RPM_DEFINE_UTIL}' --define \"_bashcompletiondir $(bashcompletiondir)\"'\n\t])\n\tRPM_DEFINE_UTIL=${RPM_DEFINE_UTIL}' $(DEFINE_SYSTEMD)'\n\tRPM_DEFINE_UTIL=${RPM_DEFINE_UTIL}' $(DEFINE_PYZFS)'\n\tRPM_DEFINE_UTIL=${RPM_DEFINE_UTIL}' $(DEFINE_PAM)'\n\tRPM_DEFINE_UTIL=${RPM_DEFINE_UTIL}' $(DEFINE_PYTHON_VERSION)'\n\tRPM_DEFINE_UTIL=${RPM_DEFINE_UTIL}' $(DEFINE_PYTHON_PKG_VERSION)'\n\n\tdnl # Override default lib directory on Debian/Ubuntu systems.  The\n\tdnl # provided /usr/lib/rpm/platform/<arch>/macros files do not\n\tdnl # specify the correct path for multiarch systems as described\n\tdnl # by the packaging guidelines.\n\tdnl #\n\tdnl # https://wiki.ubuntu.com/MultiarchSpec\n\tdnl # https://wiki.debian.org/Multiarch/Implementation\n\tdnl #\n\tAS_IF([test \"$DEFAULT_PACKAGE\" = \"deb\"], [\n\t\tMULTIARCH_LIBDIR=\"lib/$(dpkg-architecture -qDEB_HOST_MULTIARCH)\"\n\t\tRPM_DEFINE_UTIL=${RPM_DEFINE_UTIL}' --define \"_lib $(MULTIARCH_LIBDIR)\"'\n\t\tAC_SUBST(MULTIARCH_LIBDIR)\n\t])\n\n\tdnl # Make RPM_DEFINE_KMOD additions conditional on CONFIG_KERNEL,\n\tdnl # since the values will not be set otherwise. The spec files\n\tdnl # provide defaults for them.\n\tdnl #\n\tRPM_DEFINE_KMOD='--define \"_wrong_version_format_terminate_build 0\"'\n\tAM_COND_IF([CONFIG_KERNEL], [\n\t\tRPM_DEFINE_KMOD=${RPM_DEFINE_KMOD}' --define \"kernels $(LINUX_VERSION)\"'\n\t\tRPM_DEFINE_KMOD=${RPM_DEFINE_KMOD}' --define \"ksrc $(LINUX)\"'\n\t\tRPM_DEFINE_KMOD=${RPM_DEFINE_KMOD}' --define \"kobj $(LINUX_OBJ)\"'\n\t\tRPM_DEFINE_KMOD=${RPM_DEFINE_KMOD}' --define \"kernel_cc KERNEL_CC=$(KERNEL_CC)\"'\n\t\tRPM_DEFINE_KMOD=${RPM_DEFINE_KMOD}' --define \"kernel_ld KERNEL_LD=$(KERNEL_LD)\"'\n\t\tRPM_DEFINE_KMOD=${RPM_DEFINE_KMOD}' --define \"kernel_llvm KERNEL_LLVM=$(KERNEL_LLVM)\"'\n\t])\n\n\tRPM_DEFINE_DKMS=''\n\n\tSRPM_DEFINE_COMMON='--define \"build_src_rpm 1\"'\n\tSRPM_DEFINE_UTIL=\n\tSRPM_DEFINE_KMOD=\n\tSRPM_DEFINE_DKMS=\n\n\tRPM_SPEC_DIR=\"rpm/generic\"\n\tAC_ARG_WITH([spec],\n\t\tAS_HELP_STRING([--with-spec=SPEC],\n\t\t[Spec files 'generic|redhat']),\n\t\t[RPM_SPEC_DIR=\"rpm/$withval\"])\n\n\tAC_MSG_CHECKING([whether spec files are available])\n\tAC_MSG_RESULT([yes ($RPM_SPEC_DIR/*.spec.in)])\n\n\tAC_SUBST(HAVE_RPM)\n\tAC_SUBST(RPM)\n\tAC_SUBST(RPM_VERSION)\n\n\tAC_SUBST(HAVE_RPMBUILD)\n\tAC_SUBST(RPMBUILD)\n\tAC_SUBST(RPMBUILD_VERSION)\n\n\tAC_SUBST(RPM_SPEC_DIR)\n\tAC_SUBST(RPM_DEFINE_UTIL)\n\tAC_SUBST(RPM_DEFINE_KMOD)\n\tAC_SUBST(RPM_DEFINE_DKMS)\n\tAC_SUBST(RPM_DEFINE_COMMON)\n\tAC_SUBST(SRPM_DEFINE_UTIL)\n\tAC_SUBST(SRPM_DEFINE_KMOD)\n\tAC_SUBST(SRPM_DEFINE_DKMS)\n\tAC_SUBST(SRPM_DEFINE_COMMON)\n])\n\ndnl #\ndnl # Check for dpkg+dpkg-buildpackage to build DEB packages.  If these\ndnl # tools are missing it is non-fatal but you will not be able to build\ndnl # DEB packages and will be warned if you try too.\ndnl #\nAC_DEFUN([ZFS_AC_DPKG], [\n\tDPKG=dpkg\n\tDPKGBUILD=dpkg-buildpackage\n\n\tAC_MSG_CHECKING([whether $DPKG is available])\n\tAS_IF([tmp=$($DPKG --version 2>/dev/null)], [\n\t\tDPKG_VERSION=$(echo $tmp | $AWK '/Debian/ { print $[7] }')\n\t\tHAVE_DPKG=yes\n\t\tAC_MSG_RESULT([$HAVE_DPKG ($DPKG_VERSION)])\n\t],[\n\t\tHAVE_DPKG=no\n\t\tAC_MSG_RESULT([$HAVE_DPKG])\n\t])\n\n\tAC_MSG_CHECKING([whether $DPKGBUILD is available])\n\tAS_IF([tmp=$($DPKGBUILD --version 2>/dev/null)], [\n\t\tDPKGBUILD_VERSION=$(echo $tmp | \\\n\t\t    $AWK '/Debian/ { print $[4] }' | cut -f-4 -d'.')\n\t\tHAVE_DPKGBUILD=yes\n\t\tAC_MSG_RESULT([$HAVE_DPKGBUILD ($DPKGBUILD_VERSION)])\n\t],[\n\t\tHAVE_DPKGBUILD=no\n\t\tAC_MSG_RESULT([$HAVE_DPKGBUILD])\n\t])\n\n\tAC_SUBST(HAVE_DPKG)\n\tAC_SUBST(DPKG)\n\tAC_SUBST(DPKG_VERSION)\n\n\tAC_SUBST(HAVE_DPKGBUILD)\n\tAC_SUBST(DPKGBUILD)\n\tAC_SUBST(DPKGBUILD_VERSION)\n\tAC_SUBST([CFGOPTS], [\"$CFGOPTS\"])\n])\n\ndnl #\ndnl # Until native packaging for various different packing systems\ndnl # can be added the least we can do is attempt to use alien to\ndnl # convert the RPM packages to the needed package type.  This is\ndnl # a hack but so far it has worked reasonable well.\ndnl #\nAC_DEFUN([ZFS_AC_ALIEN], [\n\tALIEN=alien\n\n\tAC_MSG_CHECKING([whether $ALIEN is available])\n\tAS_IF([tmp=$($ALIEN --version 2>/dev/null)], [\n\t\tALIEN_VERSION=$(echo $tmp | $AWK '{ print $[3] }')\n\t\tALIEN_MAJOR=$(echo ${ALIEN_VERSION} | $AWK -F'.' '{ print $[1] }')\n\t\tALIEN_MINOR=$(echo ${ALIEN_VERSION} | $AWK -F'.' '{ print $[2] }')\n\t\tALIEN_POINT=$(echo ${ALIEN_VERSION} | $AWK -F'.' '{ print $[3] }')\n\t\tHAVE_ALIEN=yes\n\t\tAC_MSG_RESULT([$HAVE_ALIEN ($ALIEN_VERSION)])\n\t],[\n\t\tHAVE_ALIEN=no\n\t\tAC_MSG_RESULT([$HAVE_ALIEN])\n\t])\n\n\tAC_SUBST(HAVE_ALIEN)\n\tAC_SUBST(ALIEN)\n\tAC_SUBST(ALIEN_VERSION)\n\tAC_SUBST(ALIEN_MAJOR)\n\tAC_SUBST(ALIEN_MINOR)\n\tAC_SUBST(ALIEN_POINT)\n])\n\ndnl #\ndnl # Using the VENDOR tag from config.guess set the default\ndnl # package type for 'make pkg': (rpm | deb | tgz)\ndnl #\nAC_DEFUN([ZFS_AC_DEFAULT_PACKAGE], [\n\tAC_MSG_CHECKING([os distribution])\n\tAC_ARG_WITH([vendor],\n\t\t[AS_HELP_STRING([--with-vendor],\n\t\t\t[Distribution vendor @<:@default=check@:>@])],\n\t\t[with_vendor=$withval],\n\t\t[with_vendor=check])\n\tAS_IF([test \"x$with_vendor\" = \"xcheck\"],[\n\t\tif test -f /etc/toss-release ; then\n\t\t\tVENDOR=toss ;\n\t\telif test -f /etc/fedora-release ; then\n\t\t\tVENDOR=fedora ;\n\t\telif test -f /etc/redhat-release ; then\n\t\t\tVENDOR=redhat ;\n\t\telif test -f /etc/gentoo-release ; then\n\t\t\tVENDOR=gentoo ;\n\t\telif test -f /etc/arch-release ; then\n\t\t\tVENDOR=arch ;\n\t\telif test -f /etc/SuSE-release ; then\n\t\t\tVENDOR=sles ;\n\t\telif test -f /etc/slackware-version ; then\n\t\t\tVENDOR=slackware ;\n\t\telif test -f /etc/lunar.release ; then\n\t\t\tVENDOR=lunar ;\n\t\telif test -f /etc/lsb-release ; then\n\t\t\tVENDOR=ubuntu ;\n\t\telif test -f /etc/debian_version ; then\n\t\t\tVENDOR=debian ;\n\t\telif test -f /etc/alpine-release ; then\n\t\t\tVENDOR=alpine ;\n\t\telif test -f /bin/freebsd-version ; then\n\t\t\tVENDOR=freebsd ;\n\t\telif test -f /etc/openEuler-release ; then\n\t\t\tVENDOR=openeuler ;\n\t\telse\n\t\t\tVENDOR= ;\n\t\tfi],\n\t\t[ test \"x${with_vendor}\" != x],[\n\t\t\tVENDOR=\"$with_vendor\" ],\n\t\t[ VENDOR= ; ]\n\t)\n\tAC_MSG_RESULT([$VENDOR])\n\tAC_SUBST(VENDOR)\n\n\tAC_MSG_CHECKING([default package type])\n\tcase \"$VENDOR\" in\n\t\ttoss)       DEFAULT_PACKAGE=rpm  ;;\n\t\tredhat)     DEFAULT_PACKAGE=rpm  ;;\n\t\tfedora)     DEFAULT_PACKAGE=rpm  ;;\n\t\tgentoo)     DEFAULT_PACKAGE=tgz  ;;\n\t\talpine)     DEFAULT_PACKAGE=tgz  ;;\n\t\tarch)       DEFAULT_PACKAGE=tgz  ;;\n\t\tsles)       DEFAULT_PACKAGE=rpm  ;;\n\t\tslackware)  DEFAULT_PACKAGE=tgz  ;;\n\t\tlunar)      DEFAULT_PACKAGE=tgz  ;;\n\t\tubuntu)     DEFAULT_PACKAGE=deb  ;;\n\t\tdebian)     DEFAULT_PACKAGE=deb  ;;\n\t\tfreebsd)    DEFAULT_PACKAGE=pkg  ;;\n\t\topeneuler)  DEFAULT_PACKAGE=rpm  ;;\n\t\t*)          DEFAULT_PACKAGE=rpm  ;;\n\tesac\n\tAC_MSG_RESULT([$DEFAULT_PACKAGE])\n\tAC_SUBST(DEFAULT_PACKAGE)\n\n\tAC_MSG_CHECKING([default init directory])\n\tcase \"$VENDOR\" in\n\t\tfreebsd)    initdir=$sysconfdir/rc.d  ;;\n\t\t*)          initdir=$sysconfdir/init.d;;\n\tesac\n\tAC_MSG_RESULT([$initdir])\n\tAC_SUBST(initdir)\n\n\tAC_MSG_CHECKING([default shell])\n\tcase \"$VENDOR\" in\n\t\tgentoo)     DEFAULT_INIT_SHELL=\"/sbin/openrc-run\";;\n\t\talpine)     DEFAULT_INIT_SHELL=\"/sbin/openrc-run\";;\n\t\t*)          DEFAULT_INIT_SHELL=\"/bin/sh\"         ;;\n\tesac\n\n\tAC_MSG_RESULT([$DEFAULT_INIT_SHELL])\n\tAC_SUBST(DEFAULT_INIT_SHELL)\n\n\tAC_MSG_CHECKING([default nfs server init script])\n\tAS_IF([test \"$VENDOR\" = \"debian\"],\n\t\t[DEFAULT_INIT_NFS_SERVER=\"nfs-kernel-server\"],\n\t\t[DEFAULT_INIT_NFS_SERVER=\"nfs\"]\n\t)\n\tAC_MSG_RESULT([$DEFAULT_INIT_NFS_SERVER])\n\tAC_SUBST(DEFAULT_INIT_NFS_SERVER)\n\n\tAC_MSG_CHECKING([default init config directory])\n\tcase \"$VENDOR\" in\n\t\talpine)     initconfdir=/etc/conf.d    ;;\n\t\tgentoo)     initconfdir=/etc/conf.d    ;;\n\t\ttoss)       initconfdir=/etc/sysconfig ;;\n\t\tredhat)     initconfdir=/etc/sysconfig ;;\n\t\tfedora)     initconfdir=/etc/sysconfig ;;\n\t\tsles)       initconfdir=/etc/sysconfig ;;\n\t\topeneuler)  initconfdir=/etc/sysconfig ;;\n\t\tubuntu)     initconfdir=/etc/default   ;;\n\t\tdebian)     initconfdir=/etc/default   ;;\n\t\tfreebsd)    initconfdir=$sysconfdir/rc.conf.d;;\n\t\t*)          initconfdir=/etc/default   ;;\n\tesac\n\tAC_MSG_RESULT([$initconfdir])\n\tAC_SUBST(initconfdir)\n\n\tAC_MSG_CHECKING([whether initramfs-tools is available])\n\tif test -d /usr/share/initramfs-tools ; then\n\t\tRPM_DEFINE_INITRAMFS='--define \"_initramfs 1\"'\n\t\tAC_MSG_RESULT([yes])\n\telse\n\t\tRPM_DEFINE_INITRAMFS=''\n\t\tAC_MSG_RESULT([no])\n\tfi\n\tAC_SUBST(RPM_DEFINE_INITRAMFS)\n\n\tAC_MSG_CHECKING([default bash completion directory])\n\tcase \"$VENDOR\" in\n\t\tubuntu)     bashcompletiondir=/usr/share/bash-completion/completions   ;;\n\t\tdebian)     bashcompletiondir=/usr/share/bash-completion/completions   ;;\n\t\tfreebsd)    bashcompletiondir=$sysconfdir/bash_completion.d;;\n\t\tgentoo)     bashcompletiondir=/usr/share/bash-completion/completions   ;;\n\t\t*)          bashcompletiondir=/etc/bash_completion.d   ;;\n\tesac\n\tAC_MSG_RESULT([$bashcompletiondir])\n\tAC_SUBST(bashcompletiondir)\n\n])\n\ndnl #\ndnl # Default ZFS package configuration\ndnl #\nAC_DEFUN([ZFS_AC_PACKAGE], [\n\tZFS_AC_DEFAULT_PACKAGE\n\tAS_IF([test x$VENDOR != xfreebsd], [\n\t\tZFS_AC_RPM\n\t\tZFS_AC_DPKG\n\t\tZFS_AC_ALIEN\n\t])\n])\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}