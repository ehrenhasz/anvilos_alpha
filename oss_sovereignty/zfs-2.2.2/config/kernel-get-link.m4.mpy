{
  "module_name": "kernel-get-link.m4",
  "hash_id": "5de67926e97508d470108ec2ba0b93226511f373566266c9db18ef5359abb6a5",
  "original_prompt": "Ingested from zfs-2.2.2/config/kernel-get-link.m4",
  "human_readable_source": "dnl #\ndnl # Supported get_link() interfaces checked newest to oldest.\ndnl # Note this interface used to be named follow_link.\ndnl #\nAC_DEFUN([ZFS_AC_KERNEL_SRC_GET_LINK], [\n\tZFS_LINUX_TEST_SRC([inode_operations_get_link], [\n\t\t#include <linux/fs.h>\n\t\tconst char *get_link(struct dentry *de, struct inode *ip,\n\t\t    struct delayed_call *done) { return \"symlink\"; }\n\t\tstatic struct inode_operations\n\t\t     iops __attribute__ ((unused)) = {\n\t\t\t.get_link = get_link,\n\t\t};\n\t],[])\n\n\tZFS_LINUX_TEST_SRC([inode_operations_get_link_cookie], [\n\t\t#include <linux/fs.h>\n\t\tconst char *get_link(struct dentry *de, struct\n\t\t    inode *ip, void **cookie) { return \"symlink\"; }\n\t\tstatic struct inode_operations\n\t\t     iops __attribute__ ((unused)) = {\n\t\t\t.get_link = get_link,\n\t\t};\n\t],[])\n\n\tZFS_LINUX_TEST_SRC([inode_operations_follow_link], [\n\t\t#include <linux/fs.h>\n\t\tconst char *follow_link(struct dentry *de,\n\t\t    void **cookie) { return \"symlink\"; }\n\t\tstatic struct inode_operations\n\t\t    iops __attribute__ ((unused)) = {\n\t\t\t.follow_link = follow_link,\n\t\t};\n\t],[])\n\n\tZFS_LINUX_TEST_SRC([inode_operations_follow_link_nameidata], [\n\t\t#include <linux/fs.h>\n\t\tvoid *follow_link(struct dentry *de, struct\n\t\t    nameidata *nd) { return (void *)NULL; }\n\t\tstatic struct inode_operations\n\t\t    iops __attribute__ ((unused)) = {\n\t\t\t.follow_link = follow_link,\n\t\t};\n\t],[])\n])\n\nAC_DEFUN([ZFS_AC_KERNEL_GET_LINK], [\n\tdnl #\n\tdnl # 4.5 API change\n\tdnl # The get_link interface has added a delayed done call and\n\tdnl # used it to retire the put_link() interface.\n\tdnl #\n\tAC_MSG_CHECKING([whether iops->get_link() passes delayed])\n\tZFS_LINUX_TEST_RESULT([inode_operations_get_link], [\n\t\tAC_MSG_RESULT(yes)\n\t\tAC_DEFINE(HAVE_GET_LINK_DELAYED, 1, [iops->get_link() delayed])\n\t],[\n\t\tAC_MSG_RESULT(no)\n\n\t\tdnl #\n\t\tdnl # 4.5 API change\n\t\tdnl # The follow_link() interface has been replaced by\n\t\tdnl # get_link() which behaves the same as before except:\n\t\tdnl # - An inode is passed as a separate argument\n\t\tdnl # - When called in RCU mode a NULL dentry is passed.\n\t\tdnl #\n\t\tAC_MSG_CHECKING([whether iops->get_link() passes cookie])\n\t\tZFS_LINUX_TEST_RESULT([inode_operations_get_link_cookie], [\n\t\t\tAC_MSG_RESULT(yes)\n\t\t\tAC_DEFINE(HAVE_GET_LINK_COOKIE, 1,\n\t\t\t    [iops->get_link() cookie])\n\t\t],[\n\t\t\tAC_MSG_RESULT(no)\n\n\t\t\tdnl #\n\t\t\tdnl # 4.2 API change\n\t\t\tdnl # This kernel retired the nameidata structure.\n\t\t\tdnl #\n\t\t\tAC_MSG_CHECKING(\n\t\t\t    [whether iops->follow_link() passes cookie])\n\t\t\tZFS_LINUX_TEST_RESULT([inode_operations_follow_link], [\n\t\t\t\tAC_MSG_RESULT(yes)\n\t\t\t\tAC_DEFINE(HAVE_FOLLOW_LINK_COOKIE, 1,\n\t\t\t\t    [iops->follow_link() cookie])\n\t\t\t],[\n\t\t\t\tAC_MSG_RESULT(no)\n\n\t\t\t\tdnl #\n\t\t\t\tdnl # 2.6.32 API\n\t\t\t\tdnl #\n\t\t\t\tAC_MSG_CHECKING(\n\t\t\t\t[whether iops->follow_link() passes nameidata])\n\t\t\t\tZFS_LINUX_TEST_RESULT(\n\t\t\t\t    [inode_operations_follow_link_nameidata],[\n\t\t\t\t\tAC_MSG_RESULT(yes)\n\t\t\t\t\tAC_DEFINE(HAVE_FOLLOW_LINK_NAMEIDATA, 1,\n\t\t\t\t\t    [iops->follow_link() nameidata])\n\t\t\t\t],[\n\t\t\t\t\tZFS_LINUX_TEST_ERROR([get_link])\n\t\t\t\t])\n\t\t\t])\n\t\t])\n\t])\n])\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}