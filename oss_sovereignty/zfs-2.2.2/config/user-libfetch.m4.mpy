{
  "module_name": "user-libfetch.m4",
  "hash_id": "1c9238c537f741baa9facfc6441052bca3fd48104ade3f3fd12219f76a412653",
  "original_prompt": "Ingested from zfs-2.2.2/config/user-libfetch.m4",
  "human_readable_source": "dnl #\ndnl # Check for a libfetch - either fetch(3) or libcurl.\ndnl #\ndnl # There are two configuration dimensions:\ndnl #   * fetch(3) vs libcurl\ndnl #   * static vs dynamic\ndnl #\ndnl # fetch(3) is only dynamic.\ndnl # We use sover 6, which first appeared in FreeBSD 8.0-RELEASE.\ndnl #\ndnl # libcurl development packages include curl-config(1) \u2013 we want:\ndnl #   * HTTPS support\ndnl #   * version at least 7.16 (October 2006), for sover 4\ndnl #   * to decide if it's static or not\ndnl #\nAC_DEFUN([ZFS_AC_CONFIG_USER_LIBFETCH], [\n\tAC_MSG_CHECKING([for libfetch])\n\tLIBFETCH_LIBS=\n\tLIBFETCH_IS_FETCH=0\n\tLIBFETCH_IS_LIBCURL=0\n\tLIBFETCH_DYNAMIC=0\n\tLIBFETCH_SONAME=\n\thave_libfetch=\n\n\tsaved_libs=\"$LIBS\"\n\tLIBS=\"$LIBS -lfetch\"\n\tAC_LINK_IFELSE([AC_LANG_PROGRAM([[\n\t\t#include <sys/param.h>\n\t\t#include <stdio.h>\n\t\t#include <fetch.h>\n\t]], [fetchGetURL(\"\", \"\");])], [\n\t\thave_libfetch=1\n\t\tLIBFETCH_IS_FETCH=1\n\t\tLIBFETCH_DYNAMIC=1\n\t\tLIBFETCH_SONAME=\"libfetch.so.6\"\n\t\tLIBFETCH_LIBS=\"-ldl\"\n\t\tAC_MSG_RESULT([fetch(3)])\n\t], [])\n\tLIBS=\"$saved_libs\"\n\n\tif test -z \"$have_libfetch\"; then\n\t\tif curl-config --protocols 2>/dev/null | grep -q HTTPS &&\n\t\t    test \"$(printf \"%u\" \"0x$(curl-config --vernum)\")\" -ge \"$(printf \"%u\" \"0x071000\")\"; then\n\t\t\thave_libfetch=1\n\t\t\tLIBFETCH_IS_LIBCURL=1\n\t\t\tif test \"$(curl-config --built-shared)\" = \"yes\"; then\n\t\t\t\tLIBFETCH_DYNAMIC=1\n\t\t\t\tLIBFETCH_SONAME=\"libcurl.so.4\"\n\t\t\t\tLIBFETCH_LIBS=\"-ldl\"\n\t\t\t\tAC_MSG_RESULT([libcurl])\n\t\t\telse\n\t\t\t\tLIBFETCH_LIBS=\"$(curl-config --libs)\"\n\t\t\t\tAC_MSG_RESULT([libcurl (static)])\n\t\t\tfi\n\n\t\t\tCCFLAGS=\"$CCFLAGS $(curl-config --cflags)\"\n\t\tfi\n\tfi\n\n\tif test -z \"$have_libfetch\"; then\n\t\tAC_MSG_RESULT([none])\n\tfi\n\n\tAC_SUBST([LIBFETCH_LIBS])\n\tAC_SUBST([LIBFETCH_DYNAMIC])\n\tAC_SUBST([LIBFETCH_SONAME])\n\tAC_DEFINE_UNQUOTED([LIBFETCH_IS_FETCH], [$LIBFETCH_IS_FETCH], [libfetch is fetch(3)])\n\tAC_DEFINE_UNQUOTED([LIBFETCH_IS_LIBCURL], [$LIBFETCH_IS_LIBCURL], [libfetch is libcurl])\n\tAC_DEFINE_UNQUOTED([LIBFETCH_DYNAMIC], [$LIBFETCH_DYNAMIC], [whether the chosen libfetch is to be loaded at run-time])\n\tAC_DEFINE_UNQUOTED([LIBFETCH_SONAME], [\"$LIBFETCH_SONAME\"], [soname of chosen libfetch])\n])\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}