{
  "module_name": "kernel-vfs-extended-file_range.m4",
  "hash_id": "384975ccc66db77c941cc3d99ed363e296d426cabb8b1a375de6ebfcbf6cf254",
  "original_prompt": "Ingested from zfs-2.2.2/config/kernel-vfs-extended-file_range.m4",
  "human_readable_source": "dnl #\ndnl # EL7 have backported copy_file_range and clone_file_range and\ndnl # added them to an \"extended\" file_operations struct.\ndnl #\ndnl # We're testing for both functions in one here, because they will only\ndnl # ever appear together and we don't want to match a similar method in\ndnl # some future vendor kernel.\ndnl #\nAC_DEFUN([ZFS_AC_KERNEL_SRC_VFS_FILE_OPERATIONS_EXTEND], [\n\tZFS_LINUX_TEST_SRC([vfs_file_operations_extend], [\n\t\t#include <linux/fs.h>\n\n\t\tstatic ssize_t test_copy_file_range(struct file *src_file,\n\t\t    loff_t src_off, struct file *dst_file, loff_t dst_off,\n\t\t    size_t len, unsigned int flags) {\n\t\t\t(void) src_file; (void) src_off;\n\t\t\t(void) dst_file; (void) dst_off;\n\t\t\t(void) len; (void) flags;\n\t\t\treturn (0);\n\t\t}\n\n\t\tstatic int test_clone_file_range(struct file *src_file,\n\t\t    loff_t src_off, struct file *dst_file, loff_t dst_off,\n\t\t    u64 len) {\n\t\t\t(void) src_file; (void) src_off;\n\t\t\t(void) dst_file; (void) dst_off;\n\t\t\t(void) len;\n\t\t\treturn (0);\n\t\t}\n\n\t\tstatic const struct file_operations_extend\n\t\t    fops __attribute__ ((unused)) = {\n\t\t\t.kabi_fops = {},\n\t\t\t.copy_file_range = test_copy_file_range,\n\t\t\t.clone_file_range = test_clone_file_range,\n\t\t};\n\t],[])\n])\nAC_DEFUN([ZFS_AC_KERNEL_VFS_FILE_OPERATIONS_EXTEND], [\n\tAC_MSG_CHECKING([whether file_operations_extend takes \\\n.copy_file_range() and .clone_file_range()])\n\tZFS_LINUX_TEST_RESULT([vfs_file_operations_extend], [\n\t\tAC_MSG_RESULT([yes])\n\t\tAC_DEFINE(HAVE_VFS_FILE_OPERATIONS_EXTEND, 1,\n\t\t    [file_operations_extend takes .copy_file_range()\n\t\t    and .clone_file_range()])\n\t],[\n\t\tAC_MSG_RESULT([no])\n\t])\n])\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}