{
  "module_name": "kernel-make-request-fn.m4",
  "hash_id": "f0dfbdf06c6e7942b880bbc3ec6d0017c10626e78176c8fb161bfeae7fb8c5b0",
  "original_prompt": "Ingested from zfs-2.2.2/config/kernel-make-request-fn.m4",
  "human_readable_source": "dnl #\ndnl # Check for make_request_fn interface.\ndnl #\nAC_DEFUN([ZFS_AC_KERNEL_SRC_MAKE_REQUEST_FN], [\n\tZFS_LINUX_TEST_SRC([make_request_fn_void], [\n\t\t#include <linux/blkdev.h>\n\t\tvoid make_request(struct request_queue *q,\n\t\t    struct bio *bio) { return; }\n\t],[\n\t\tblk_queue_make_request(NULL, &make_request);\n\t])\n\n\tZFS_LINUX_TEST_SRC([make_request_fn_blk_qc_t], [\n\t\t#include <linux/blkdev.h>\n\t\tblk_qc_t make_request(struct request_queue *q,\n\t\t    struct bio *bio) { return (BLK_QC_T_NONE); }\n\t],[\n\t\tblk_queue_make_request(NULL, &make_request);\n\t])\n\n\tZFS_LINUX_TEST_SRC([blk_alloc_queue_request_fn], [\n\t\t#include <linux/blkdev.h>\n\t\tblk_qc_t make_request(struct request_queue *q,\n\t\t    struct bio *bio) { return (BLK_QC_T_NONE); }\n\t],[\n\t\tstruct request_queue *q __attribute__ ((unused));\n\t\tq = blk_alloc_queue(make_request, NUMA_NO_NODE);\n\t])\n\n\tZFS_LINUX_TEST_SRC([blk_alloc_queue_request_fn_rh], [\n\t\t#include <linux/blkdev.h>\n\t\tblk_qc_t make_request(struct request_queue *q,\n\t\t    struct bio *bio) { return (BLK_QC_T_NONE); }\n\t],[\n\t\tstruct request_queue *q __attribute__ ((unused));\n\t\tq = blk_alloc_queue_rh(make_request, NUMA_NO_NODE);\n\t])\n\n\tZFS_LINUX_TEST_SRC([block_device_operations_submit_bio], [\n\t\t#include <linux/blkdev.h>\n\t],[\n\t\tstruct block_device_operations o;\n\t\to.submit_bio = NULL;\n\t])\n\n\tZFS_LINUX_TEST_SRC([blk_alloc_disk], [\n\t\t#include <linux/blkdev.h>\n\t],[\n\t\tstruct gendisk *disk  __attribute__ ((unused));\n\t\tdisk = blk_alloc_disk(NUMA_NO_NODE);\n\t])\n\n\tZFS_LINUX_TEST_SRC([blk_cleanup_disk], [\n\t\t#include <linux/blkdev.h>\n\t],[\n\t\tstruct gendisk *disk  __attribute__ ((unused));\n\t\tblk_cleanup_disk(disk);\n\t])\n])\n\nAC_DEFUN([ZFS_AC_KERNEL_MAKE_REQUEST_FN], [\n\tdnl # Checked as part of the blk_alloc_queue_request_fn test\n\tdnl #\n\tdnl # Linux 5.9 API Change\n\tdnl # make_request_fn was moved into block_device_operations->submit_bio\n\tdnl #\n\tAC_MSG_CHECKING([whether submit_bio is member of struct block_device_operations])\n\tZFS_LINUX_TEST_RESULT([block_device_operations_submit_bio], [\n\t\tAC_MSG_RESULT(yes)\n\n\t\tAC_DEFINE(HAVE_SUBMIT_BIO_IN_BLOCK_DEVICE_OPERATIONS, 1,\n\t\t    [submit_bio is member of struct block_device_operations])\n\n\t\tdnl #\n\t\tdnl # Linux 5.14 API Change:\n\t\tdnl # blk_alloc_queue() + alloc_disk() combo replaced by\n\t\tdnl # a single call to blk_alloc_disk().\n\t\tdnl #\n\t\tAC_MSG_CHECKING([whether blk_alloc_disk() exists])\n\t\tZFS_LINUX_TEST_RESULT([blk_alloc_disk], [\n\t\t\tAC_MSG_RESULT(yes)\n\t\t\tAC_DEFINE([HAVE_BLK_ALLOC_DISK], 1, [blk_alloc_disk() exists])\n\n\t\t\tdnl #\n\t\t\tdnl # 5.20 API change,\n\t\t\tdnl # Removed blk_cleanup_disk(), put_disk() should be used.\n\t\t\tdnl #\n\t\t\tAC_MSG_CHECKING([whether blk_cleanup_disk() exists])\n\t\t\tZFS_LINUX_TEST_RESULT([blk_cleanup_disk], [\n\t\t\t\tAC_MSG_RESULT(yes)\n\t\t\t\tAC_DEFINE([HAVE_BLK_CLEANUP_DISK], 1,\n\t\t\t\t    [blk_cleanup_disk() exists])\n\t\t\t], [\n\t\t\t\tAC_MSG_RESULT(no)\n\t\t\t])\n\t\t], [\n\t\t\tAC_MSG_RESULT(no)\n\t\t])\n\t],[\n\t\tAC_MSG_RESULT(no)\n\n\t\tdnl # Checked as part of the blk_alloc_queue_request_fn test\n\t\tdnl #\n\t\tdnl # Linux 5.7 API Change\n\t\tdnl # blk_alloc_queue() expects request function.\n\t\tdnl #\n\t\tAC_MSG_CHECKING([whether blk_alloc_queue() expects request function])\n\t\tZFS_LINUX_TEST_RESULT([blk_alloc_queue_request_fn], [\n\t\t\tAC_MSG_RESULT(yes)\n\n\t\t\tdnl # This is currently always the case.\n\t\t\tAC_MSG_CHECKING([whether make_request_fn() returns blk_qc_t])\n\t\t\tAC_MSG_RESULT(yes)\n\n\t\t\tAC_DEFINE(HAVE_BLK_ALLOC_QUEUE_REQUEST_FN, 1,\n\t\t\t    [blk_alloc_queue() expects request function])\n\t\t\tAC_DEFINE(MAKE_REQUEST_FN_RET, blk_qc_t,\n\t\t\t    [make_request_fn() return type])\n\t\t\tAC_DEFINE(HAVE_MAKE_REQUEST_FN_RET_QC, 1,\n\t\t\t    [Noting that make_request_fn() returns blk_qc_t])\n\t\t],[\n\t\t\tdnl #\n\t\t\tdnl # CentOS Stream 4.18.0-257 API Change\n\t\t\tdnl # The Linux 5.7 blk_alloc_queue() change was back-\n\t\t\tdnl # ported and the symbol renamed blk_alloc_queue_rh().\n\t\t\tdnl # As of this kernel version they're not providing\n\t\t\tdnl # any compatibility code in the kernel for this.\n\t\t\tdnl #\n\t\t\tZFS_LINUX_TEST_RESULT([blk_alloc_queue_request_fn_rh], [\n\t\t\t\tAC_MSG_RESULT(yes)\n\n\t\t\t\tdnl # This is currently always the case.\n\t\t\t\tAC_MSG_CHECKING([whether make_request_fn_rh() returns blk_qc_t])\n\t\t\t\tAC_MSG_RESULT(yes)\n\n\t\t\t\tAC_DEFINE(HAVE_BLK_ALLOC_QUEUE_REQUEST_FN_RH, 1,\n\t\t\t\t    [blk_alloc_queue_rh() expects request function])\n\t\t\t\tAC_DEFINE(MAKE_REQUEST_FN_RET, blk_qc_t,\n\t\t\t\t    [make_request_fn() return type])\n\t\t\t\tAC_DEFINE(HAVE_MAKE_REQUEST_FN_RET_QC, 1,\n\t\t\t\t    [Noting that make_request_fn() returns blk_qc_t])\n\t\t\t],[\n\t\t\t\tAC_MSG_RESULT(no)\n\n\t\t\t\tdnl #\n\t\t\t\tdnl # Linux 3.2 API Change\n\t\t\t\tdnl # make_request_fn returns void.\n\t\t\t\tdnl #\n\t\t\t\tAC_MSG_CHECKING(\n\t\t\t\t    [whether make_request_fn() returns void])\n\t\t\t\tZFS_LINUX_TEST_RESULT([make_request_fn_void], [\n\t\t\t\t\tAC_MSG_RESULT(yes)\n\t\t\t\t\tAC_DEFINE(MAKE_REQUEST_FN_RET, void,\n\t\t\t\t\t    [make_request_fn() return type])\n\t\t\t\t\tAC_DEFINE(HAVE_MAKE_REQUEST_FN_RET_VOID, 1,\n\t\t\t\t\t    [Noting that make_request_fn() returns void])\n\t\t\t\t],[\n\t\t\t\t\tAC_MSG_RESULT(no)\n\n\t\t\t\t\tdnl #\n\t\t\t\t\tdnl # Linux 4.4 API Change\n\t\t\t\t\tdnl # make_request_fn returns blk_qc_t.\n\t\t\t\t\tdnl #\n\t\t\t\t\tAC_MSG_CHECKING(\n\t\t\t\t\t    [whether make_request_fn() returns blk_qc_t])\n\t\t\t\t\tZFS_LINUX_TEST_RESULT([make_request_fn_blk_qc_t], [\n\t\t\t\t\t\tAC_MSG_RESULT(yes)\n\t\t\t\t\t\tAC_DEFINE(MAKE_REQUEST_FN_RET, blk_qc_t,\n\t\t\t\t\t\t    [make_request_fn() return type])\n\t\t\t\t\t\tAC_DEFINE(HAVE_MAKE_REQUEST_FN_RET_QC, 1,\n\t\t\t\t\t\t    [Noting that make_request_fn() ]\n\t\t\t\t\t\t    [returns blk_qc_t])\n\t\t\t\t\t],[\n\t\t\t\t\t\tZFS_LINUX_TEST_ERROR([make_request_fn])\n\t\t\t\t\t])\n\t\t\t\t])\n\t\t\t])\n\t\t])\n\t])\n])\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}