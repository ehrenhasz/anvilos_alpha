{
  "module_name": "kernel-fpu.m4",
  "hash_id": "a95f418a3bafcb38236eb8b0900355055200495b6cccf44a5ba72c251adfb230",
  "original_prompt": "Ingested from zfs-2.2.2/config/kernel-fpu.m4",
  "human_readable_source": "dnl #\ndnl # Handle differences in kernel FPU code.\ndnl #\ndnl # Kernel\ndnl # 5.19:\tThe asm/fpu/internal.h header was removed, it has been\ndnl #\t\teffectively empty since the 5.16 kernel.\ndnl #\ndnl # 5.11:\tkernel_fpu_begin() is an inlined function now, so don't check\ndnl #\t\tfor it inside the kernel symbols.\ndnl #\ndnl # 5.0:\tWrappers have been introduced to save/restore the FPU state.\ndnl #\t\tThis change was made to the 4.19.38 and 4.14.120 LTS kernels.\ndnl #\t\tHAVE_KERNEL_FPU_INTERNAL\ndnl #\ndnl # 4.2:\tUse __kernel_fpu_{begin,end}()\ndnl #\t\tHAVE_UNDERSCORE_KERNEL_FPU & KERNEL_EXPORTS_X86_FPU\ndnl #\ndnl # Pre-4.2:\tUse kernel_fpu_{begin,end}()\ndnl #\t\tHAVE_KERNEL_FPU & KERNEL_EXPORTS_X86_FPU\ndnl #\ndnl # N.B. The header check is performed before all other checks since it\ndnl # depends on HAVE_KERNEL_FPU_API_HEADER being set in confdefs.h.\ndnl #\nAC_DEFUN([ZFS_AC_KERNEL_FPU_HEADER], [\n\tAC_MSG_CHECKING([whether fpu headers are available])\n\tZFS_LINUX_TRY_COMPILE([\n\t\t#include <linux/module.h>\n\t\t#include <asm/fpu/api.h>\n\t],[\n\t],[\n\t\tAC_DEFINE(HAVE_KERNEL_FPU_API_HEADER, 1,\n\t\t    [kernel has asm/fpu/api.h])\n\n\t\tZFS_LINUX_TRY_COMPILE([\n\t\t\t#include <linux/module.h>\n\t\t\t#include <asm/fpu/internal.h>\n\t\t],[\n\t\t],[\n\t\t\tAC_DEFINE(HAVE_KERNEL_FPU_INTERNAL_HEADER, 1,\n\t\t\t    [kernel has asm/fpu/internal.h])\n\t\t\tAC_MSG_RESULT([asm/fpu/api.h asm/fpu/internal.h])\n\t\t],[\n\t\t\tAC_MSG_RESULT([asm/fpu/api.h])\n\t\t])\n\t],[\n\t\tAC_MSG_RESULT([i387.h])\n\t])\n\n])\n\nAC_DEFUN([ZFS_AC_KERNEL_SRC_FPU], [\n\tZFS_LINUX_TEST_SRC([kernel_fpu], [\n\t\t#include <linux/types.h>\n\t\t#ifdef HAVE_KERNEL_FPU_API_HEADER\n\t\t#include <asm/fpu/api.h>\n\t\t#ifdef HAVE_KERNEL_FPU_INTERNAL_HEADER\n\t\t#include <asm/fpu/internal.h>\n\t\t#endif\n\t\t#else\n\t\t#include <asm/i387.h>\n\t\t#endif\n\t], [\n\t\tkernel_fpu_begin();\n\t\tkernel_fpu_end();\n\t], [], [ZFS_META_LICENSE])\n\n\tZFS_LINUX_TEST_SRC([__kernel_fpu], [\n\t\t#include <linux/types.h>\n\t\t#ifdef HAVE_KERNEL_FPU_API_HEADER\n\t\t#include <asm/fpu/api.h>\n\t\t#ifdef HAVE_KERNEL_FPU_INTERNAL_HEADER\n\t\t#include <asm/fpu/internal.h>\n\t\t#endif\n\t\t#else\n\t\t#include <asm/i387.h>\n\t\t#endif\n\t], [\n\t\t__kernel_fpu_begin();\n\t\t__kernel_fpu_end();\n\t], [], [ZFS_META_LICENSE])\n\n])\n\nAC_DEFUN([ZFS_AC_KERNEL_FPU], [\n\tdnl #\n\tdnl # Legacy kernel\n\tdnl #\n\tAC_MSG_CHECKING([whether kernel fpu is available])\n\tZFS_LINUX_TEST_RESULT([kernel_fpu_license], [\n\t\tAC_MSG_RESULT(kernel_fpu_*)\n\t\tAC_DEFINE(HAVE_KERNEL_FPU, 1,\n\t\t    [kernel has kernel_fpu_* functions])\n\t\tAC_DEFINE(KERNEL_EXPORTS_X86_FPU, 1,\n\t\t    [kernel exports FPU functions])\n\t],[\n\t\tdnl #\n\t\tdnl # Linux 4.2 kernel\n\t\tdnl #\n\t\tZFS_LINUX_TEST_RESULT_SYMBOL([__kernel_fpu_license],\n\t\t    [__kernel_fpu_begin],\n\t\t    [arch/x86/kernel/fpu/core.c arch/x86/kernel/i387.c], [\n\t\t\tAC_MSG_RESULT(__kernel_fpu_*)\n\t\t\tAC_DEFINE(HAVE_UNDERSCORE_KERNEL_FPU, 1,\n\t\t\t    [kernel has __kernel_fpu_* functions])\n\t\t\tAC_DEFINE(KERNEL_EXPORTS_X86_FPU, 1,\n\t\t\t    [kernel exports FPU functions])\n\t\t],[\n\t\t\tAC_MSG_RESULT(internal)\n\t\t\tAC_DEFINE(HAVE_KERNEL_FPU_INTERNAL, 1,\n\t\t\t    [kernel fpu internal])\n\t\t])\n\t])\n])\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}