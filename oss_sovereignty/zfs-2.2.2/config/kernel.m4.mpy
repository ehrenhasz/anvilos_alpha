{
  "module_name": "kernel.m4",
  "hash_id": "2bd6961a939ec48582c7f2bb4ab4af05dd0daa24d4262bdd18168e2e3d5d12f3",
  "original_prompt": "Ingested from zfs-2.2.2/config/kernel.m4",
  "human_readable_source": "dnl #\ndnl # Default ZFS kernel configuration\ndnl #\nAC_DEFUN([ZFS_AC_CONFIG_KERNEL], [\n\tAM_COND_IF([BUILD_LINUX], [\n\t\tdnl # Setup the kernel build environment.\n\t\tZFS_AC_KERNEL\n\t\tZFS_AC_QAT\n\n\t\tdnl # Sanity checks for module building and CONFIG_* defines\n\t\tZFS_AC_KERNEL_CONFIG_DEFINED\n\t\tZFS_AC_MODULE_SYMVERS\n\n\t\tdnl # Sequential ZFS_LINUX_TRY_COMPILE tests\n\t\tZFS_AC_KERNEL_FPU_HEADER\n\t\tZFS_AC_KERNEL_OBJTOOL_HEADER\n\t\tZFS_AC_KERNEL_WAIT_QUEUE_ENTRY_T\n\t\tZFS_AC_KERNEL_MISC_MINOR\n\t\tZFS_AC_KERNEL_DECLARE_EVENT_CLASS\n\n\t\tdnl # Parallel ZFS_LINUX_TEST_SRC / ZFS_LINUX_TEST_RESULT tests\n\t\tZFS_AC_KERNEL_TEST_SRC\n\t\tZFS_AC_KERNEL_TEST_RESULT\n\n\t\tAS_IF([test \"$LINUX_OBJ\" != \"$LINUX\"], [\n\t\t\tKERNEL_MAKE=\"$KERNEL_MAKE O=$LINUX_OBJ\"\n\t\t])\n\n\t\tAC_SUBST(KERNEL_MAKE)\n\t])\n])\n\ndnl #\ndnl # Generate and compile all of the kernel API test cases to determine\ndnl # which interfaces are available.  By invoking the kernel build system\ndnl # only once the compilation can be done in parallel significantly\ndnl # speeding up the process.\ndnl #\nAC_DEFUN([ZFS_AC_KERNEL_TEST_SRC], [\n\tZFS_AC_KERNEL_SRC_OBJTOOL\n\tZFS_AC_KERNEL_SRC_GLOBAL_PAGE_STATE\n\tZFS_AC_KERNEL_SRC_ACCESS_OK_TYPE\n\tZFS_AC_KERNEL_SRC_PDE_DATA\n\tZFS_AC_KERNEL_SRC_FALLOCATE\n\tZFS_AC_KERNEL_SRC_FADVISE\n\tZFS_AC_KERNEL_SRC_GENERIC_FADVISE\n\tZFS_AC_KERNEL_SRC_2ARGS_ZLIB_DEFLATE_WORKSPACESIZE\n\tZFS_AC_KERNEL_SRC_RWSEM\n\tZFS_AC_KERNEL_SRC_SCHED\n\tZFS_AC_KERNEL_SRC_USLEEP_RANGE\n\tZFS_AC_KERNEL_SRC_KMEM_CACHE\n\tZFS_AC_KERNEL_SRC_KVMALLOC\n\tZFS_AC_KERNEL_SRC_VMALLOC_PAGE_KERNEL\n\tZFS_AC_KERNEL_SRC_WAIT\n\tZFS_AC_KERNEL_SRC_INODE_TIMES\n\tZFS_AC_KERNEL_SRC_INODE_LOCK\n\tZFS_AC_KERNEL_SRC_GROUP_INFO_GID\n\tZFS_AC_KERNEL_SRC_RW\n\tZFS_AC_KERNEL_SRC_TIMER_SETUP\n\tZFS_AC_KERNEL_SRC_SUPER_USER_NS\n\tZFS_AC_KERNEL_SRC_PROC_OPERATIONS\n\tZFS_AC_KERNEL_SRC_BLOCK_DEVICE_OPERATIONS\n\tZFS_AC_KERNEL_SRC_BIO\n\tZFS_AC_KERNEL_SRC_BLKDEV\n\tZFS_AC_KERNEL_SRC_BLK_QUEUE\n\tZFS_AC_KERNEL_SRC_GENHD_FLAGS\n\tZFS_AC_KERNEL_SRC_REVALIDATE_DISK\n\tZFS_AC_KERNEL_SRC_GET_DISK_RO\n\tZFS_AC_KERNEL_SRC_GENERIC_READLINK_GLOBAL\n\tZFS_AC_KERNEL_SRC_DISCARD_GRANULARITY\n\tZFS_AC_KERNEL_SRC_INODE_OWNER_OR_CAPABLE\n\tZFS_AC_KERNEL_SRC_XATTR\n\tZFS_AC_KERNEL_SRC_ACL\n\tZFS_AC_KERNEL_SRC_INODE_SETATTR\n\tZFS_AC_KERNEL_SRC_INODE_GETATTR\n\tZFS_AC_KERNEL_SRC_INODE_SET_FLAGS\n\tZFS_AC_KERNEL_SRC_INODE_SET_IVERSION\n\tZFS_AC_KERNEL_SRC_SHOW_OPTIONS\n\tZFS_AC_KERNEL_SRC_FILE_INODE\n\tZFS_AC_KERNEL_SRC_FILE_DENTRY\n\tZFS_AC_KERNEL_SRC_FSYNC\n\tZFS_AC_KERNEL_SRC_AIO_FSYNC\n\tZFS_AC_KERNEL_SRC_EVICT_INODE\n\tZFS_AC_KERNEL_SRC_DIRTY_INODE\n\tZFS_AC_KERNEL_SRC_SHRINKER\n\tZFS_AC_KERNEL_SRC_MKDIR\n\tZFS_AC_KERNEL_SRC_LOOKUP_FLAGS\n\tZFS_AC_KERNEL_SRC_CREATE\n\tZFS_AC_KERNEL_SRC_PERMISSION\n\tZFS_AC_KERNEL_SRC_GET_LINK\n\tZFS_AC_KERNEL_SRC_PUT_LINK\n\tZFS_AC_KERNEL_SRC_TMPFILE\n\tZFS_AC_KERNEL_SRC_AUTOMOUNT\n\tZFS_AC_KERNEL_SRC_ENCODE_FH_WITH_INODE\n\tZFS_AC_KERNEL_SRC_COMMIT_METADATA\n\tZFS_AC_KERNEL_SRC_CLEAR_INODE\n\tZFS_AC_KERNEL_SRC_SETATTR_PREPARE\n\tZFS_AC_KERNEL_SRC_INSERT_INODE_LOCKED\n\tZFS_AC_KERNEL_SRC_DENTRY\n\tZFS_AC_KERNEL_SRC_DENTRY_ALIAS_D_U\n\tZFS_AC_KERNEL_SRC_TRUNCATE_SETSIZE\n\tZFS_AC_KERNEL_SRC_SECURITY_INODE\n\tZFS_AC_KERNEL_SRC_FST_MOUNT\n\tZFS_AC_KERNEL_SRC_BDI\n\tZFS_AC_KERNEL_SRC_SET_NLINK\n\tZFS_AC_KERNEL_SRC_SGET\n\tZFS_AC_KERNEL_SRC_LSEEK_EXECUTE\n\tZFS_AC_KERNEL_SRC_VFS_FILEMAP_DIRTY_FOLIO\n\tZFS_AC_KERNEL_SRC_VFS_READ_FOLIO\n\tZFS_AC_KERNEL_SRC_VFS_GETATTR\n\tZFS_AC_KERNEL_SRC_VFS_FSYNC_2ARGS\n\tZFS_AC_KERNEL_SRC_VFS_ITERATE\n\tZFS_AC_KERNEL_SRC_VFS_DIRECT_IO\n\tZFS_AC_KERNEL_SRC_VFS_READPAGES\n\tZFS_AC_KERNEL_SRC_VFS_SET_PAGE_DIRTY_NOBUFFERS\n\tZFS_AC_KERNEL_SRC_VFS_RW_ITERATE\n\tZFS_AC_KERNEL_SRC_VFS_GENERIC_WRITE_CHECKS\n\tZFS_AC_KERNEL_SRC_VFS_IOV_ITER\n\tZFS_AC_KERNEL_SRC_VFS_COPY_FILE_RANGE\n\tZFS_AC_KERNEL_SRC_VFS_GENERIC_COPY_FILE_RANGE\n\tZFS_AC_KERNEL_SRC_VFS_REMAP_FILE_RANGE\n\tZFS_AC_KERNEL_SRC_VFS_CLONE_FILE_RANGE\n\tZFS_AC_KERNEL_SRC_VFS_DEDUPE_FILE_RANGE\n\tZFS_AC_KERNEL_SRC_VFS_FILE_OPERATIONS_EXTEND\n\tZFS_AC_KERNEL_SRC_KMAP_ATOMIC_ARGS\n\tZFS_AC_KERNEL_SRC_FOLLOW_DOWN_ONE\n\tZFS_AC_KERNEL_SRC_MAKE_REQUEST_FN\n\tZFS_AC_KERNEL_SRC_GENERIC_IO_ACCT\n\tZFS_AC_KERNEL_SRC_FPU\n\tZFS_AC_KERNEL_SRC_FMODE_T\n\tZFS_AC_KERNEL_SRC_KUIDGID_T\n\tZFS_AC_KERNEL_SRC_KUID_HELPERS\n\tZFS_AC_KERNEL_SRC_RENAME\n\tZFS_AC_KERNEL_SRC_CURRENT_TIME\n\tZFS_AC_KERNEL_SRC_USERNS_CAPABILITIES\n\tZFS_AC_KERNEL_SRC_IN_COMPAT_SYSCALL\n\tZFS_AC_KERNEL_SRC_KTIME\n\tZFS_AC_KERNEL_SRC_TOTALRAM_PAGES_FUNC\n\tZFS_AC_KERNEL_SRC_TOTALHIGH_PAGES\n\tZFS_AC_KERNEL_SRC_KSTRTOUL\n\tZFS_AC_KERNEL_SRC_PERCPU\n\tZFS_AC_KERNEL_SRC_CPU_HOTPLUG\n\tZFS_AC_KERNEL_SRC_GENERIC_FILLATTR\n\tZFS_AC_KERNEL_SRC_MKNOD\n\tZFS_AC_KERNEL_SRC_SYMLINK\n\tZFS_AC_KERNEL_SRC_BIO_MAX_SEGS\n\tZFS_AC_KERNEL_SRC_SIGNAL_STOP\n\tZFS_AC_KERNEL_SRC_SIGINFO\n\tZFS_AC_KERNEL_SRC_SYSFS\n\tZFS_AC_KERNEL_SRC_SET_SPECIAL_STATE\n\tZFS_AC_KERNEL_SRC_STANDALONE_LINUX_STDARG\n\tZFS_AC_KERNEL_SRC_PAGEMAP_FOLIO_WAIT_BIT\n\tZFS_AC_KERNEL_SRC_ADD_DISK\n\tZFS_AC_KERNEL_SRC_KTHREAD\n\tZFS_AC_KERNEL_SRC_ZERO_PAGE\n\tZFS_AC_KERNEL_SRC___COPY_FROM_USER_INATOMIC\n\tZFS_AC_KERNEL_SRC_USER_NS_COMMON_INUM\n\tZFS_AC_KERNEL_SRC_IDMAP_MNT_API\n\tZFS_AC_KERNEL_SRC_IATTR_VFSID\n\tZFS_AC_KERNEL_SRC_FILEMAP\n\tZFS_AC_KERNEL_SRC_WRITEPAGE_T\n\tZFS_AC_KERNEL_SRC_RECLAIMED\n\tZFS_AC_KERNEL_SRC_REGISTER_SYSCTL_TABLE\n\tZFS_AC_KERNEL_SRC_COPY_SPLICE_READ\n\tZFS_AC_KERNEL_SRC_SYNC_BDEV\n\tcase \"$host_cpu\" in\n\t\tpowerpc*)\n\t\t\tZFS_AC_KERNEL_SRC_CPU_HAS_FEATURE\n\t\t\tZFS_AC_KERNEL_SRC_FLUSH_DCACHE_PAGE\n\t\t\t;;\n\tesac\n\n\tAC_MSG_CHECKING([for available kernel interfaces])\n\tZFS_LINUX_TEST_COMPILE_ALL([kabi])\n\tAC_MSG_RESULT([done])\n])\n\ndnl #\ndnl # Check results of kernel interface tests.\ndnl #\nAC_DEFUN([ZFS_AC_KERNEL_TEST_RESULT], [\n\tZFS_AC_KERNEL_ACCESS_OK_TYPE\n\tZFS_AC_KERNEL_GLOBAL_PAGE_STATE\n\tZFS_AC_KERNEL_OBJTOOL\n\tZFS_AC_KERNEL_PDE_DATA\n\tZFS_AC_KERNEL_FALLOCATE\n\tZFS_AC_KERNEL_FADVISE\n\tZFS_AC_KERNEL_GENERIC_FADVISE\n\tZFS_AC_KERNEL_2ARGS_ZLIB_DEFLATE_WORKSPACESIZE\n\tZFS_AC_KERNEL_RWSEM\n\tZFS_AC_KERNEL_SCHED\n\tZFS_AC_KERNEL_USLEEP_RANGE\n\tZFS_AC_KERNEL_KMEM_CACHE\n\tZFS_AC_KERNEL_KVMALLOC\n\tZFS_AC_KERNEL_VMALLOC_PAGE_KERNEL\n\tZFS_AC_KERNEL_WAIT\n\tZFS_AC_KERNEL_INODE_TIMES\n\tZFS_AC_KERNEL_INODE_LOCK\n\tZFS_AC_KERNEL_GROUP_INFO_GID\n\tZFS_AC_KERNEL_RW\n\tZFS_AC_KERNEL_TIMER_SETUP\n\tZFS_AC_KERNEL_SUPER_USER_NS\n\tZFS_AC_KERNEL_PROC_OPERATIONS\n\tZFS_AC_KERNEL_BLOCK_DEVICE_OPERATIONS\n\tZFS_AC_KERNEL_BIO\n\tZFS_AC_KERNEL_BLKDEV\n\tZFS_AC_KERNEL_BLK_QUEUE\n\tZFS_AC_KERNEL_GENHD_FLAGS\n\tZFS_AC_KERNEL_REVALIDATE_DISK\n\tZFS_AC_KERNEL_GET_DISK_RO\n\tZFS_AC_KERNEL_GENERIC_READLINK_GLOBAL\n\tZFS_AC_KERNEL_DISCARD_GRANULARITY\n\tZFS_AC_KERNEL_INODE_OWNER_OR_CAPABLE\n\tZFS_AC_KERNEL_XATTR\n\tZFS_AC_KERNEL_ACL\n\tZFS_AC_KERNEL_INODE_SETATTR\n\tZFS_AC_KERNEL_INODE_GETATTR\n\tZFS_AC_KERNEL_INODE_SET_FLAGS\n\tZFS_AC_KERNEL_INODE_SET_IVERSION\n\tZFS_AC_KERNEL_SHOW_OPTIONS\n\tZFS_AC_KERNEL_FILE_INODE\n\tZFS_AC_KERNEL_FILE_DENTRY\n\tZFS_AC_KERNEL_FSYNC\n\tZFS_AC_KERNEL_AIO_FSYNC\n\tZFS_AC_KERNEL_EVICT_INODE\n\tZFS_AC_KERNEL_DIRTY_INODE\n\tZFS_AC_KERNEL_SHRINKER\n\tZFS_AC_KERNEL_MKDIR\n\tZFS_AC_KERNEL_LOOKUP_FLAGS\n\tZFS_AC_KERNEL_CREATE\n\tZFS_AC_KERNEL_PERMISSION\n\tZFS_AC_KERNEL_GET_LINK\n\tZFS_AC_KERNEL_PUT_LINK\n\tZFS_AC_KERNEL_TMPFILE\n\tZFS_AC_KERNEL_AUTOMOUNT\n\tZFS_AC_KERNEL_ENCODE_FH_WITH_INODE\n\tZFS_AC_KERNEL_COMMIT_METADATA\n\tZFS_AC_KERNEL_CLEAR_INODE\n\tZFS_AC_KERNEL_SETATTR_PREPARE\n\tZFS_AC_KERNEL_INSERT_INODE_LOCKED\n\tZFS_AC_KERNEL_DENTRY\n\tZFS_AC_KERNEL_DENTRY_ALIAS_D_U\n\tZFS_AC_KERNEL_TRUNCATE_SETSIZE\n\tZFS_AC_KERNEL_SECURITY_INODE\n\tZFS_AC_KERNEL_FST_MOUNT\n\tZFS_AC_KERNEL_BDI\n\tZFS_AC_KERNEL_SET_NLINK\n\tZFS_AC_KERNEL_SGET\n\tZFS_AC_KERNEL_LSEEK_EXECUTE\n\tZFS_AC_KERNEL_VFS_FILEMAP_DIRTY_FOLIO\n\tZFS_AC_KERNEL_VFS_READ_FOLIO\n\tZFS_AC_KERNEL_VFS_GETATTR\n\tZFS_AC_KERNEL_VFS_FSYNC_2ARGS\n\tZFS_AC_KERNEL_VFS_ITERATE\n\tZFS_AC_KERNEL_VFS_DIRECT_IO\n\tZFS_AC_KERNEL_VFS_READPAGES\n\tZFS_AC_KERNEL_VFS_SET_PAGE_DIRTY_NOBUFFERS\n\tZFS_AC_KERNEL_VFS_RW_ITERATE\n\tZFS_AC_KERNEL_VFS_GENERIC_WRITE_CHECKS\n\tZFS_AC_KERNEL_VFS_IOV_ITER\n\tZFS_AC_KERNEL_VFS_COPY_FILE_RANGE\n\tZFS_AC_KERNEL_VFS_GENERIC_COPY_FILE_RANGE\n\tZFS_AC_KERNEL_VFS_REMAP_FILE_RANGE\n\tZFS_AC_KERNEL_VFS_CLONE_FILE_RANGE\n\tZFS_AC_KERNEL_VFS_DEDUPE_FILE_RANGE\n\tZFS_AC_KERNEL_VFS_FILE_OPERATIONS_EXTEND\n\tZFS_AC_KERNEL_KMAP_ATOMIC_ARGS\n\tZFS_AC_KERNEL_FOLLOW_DOWN_ONE\n\tZFS_AC_KERNEL_MAKE_REQUEST_FN\n\tZFS_AC_KERNEL_GENERIC_IO_ACCT\n\tZFS_AC_KERNEL_FPU\n\tZFS_AC_KERNEL_FMODE_T\n\tZFS_AC_KERNEL_KUIDGID_T\n\tZFS_AC_KERNEL_KUID_HELPERS\n\tZFS_AC_KERNEL_RENAME\n\tZFS_AC_KERNEL_CURRENT_TIME\n\tZFS_AC_KERNEL_USERNS_CAPABILITIES\n\tZFS_AC_KERNEL_IN_COMPAT_SYSCALL\n\tZFS_AC_KERNEL_KTIME\n\tZFS_AC_KERNEL_TOTALRAM_PAGES_FUNC\n\tZFS_AC_KERNEL_TOTALHIGH_PAGES\n\tZFS_AC_KERNEL_KSTRTOUL\n\tZFS_AC_KERNEL_PERCPU\n\tZFS_AC_KERNEL_CPU_HOTPLUG\n\tZFS_AC_KERNEL_GENERIC_FILLATTR\n\tZFS_AC_KERNEL_MKNOD\n\tZFS_AC_KERNEL_SYMLINK\n\tZFS_AC_KERNEL_BIO_MAX_SEGS\n\tZFS_AC_KERNEL_SIGNAL_STOP\n\tZFS_AC_KERNEL_SIGINFO\n\tZFS_AC_KERNEL_SYSFS\n\tZFS_AC_KERNEL_SET_SPECIAL_STATE\n\tZFS_AC_KERNEL_STANDALONE_LINUX_STDARG\n\tZFS_AC_KERNEL_PAGEMAP_FOLIO_WAIT_BIT\n\tZFS_AC_KERNEL_ADD_DISK\n\tZFS_AC_KERNEL_KTHREAD\n\tZFS_AC_KERNEL_ZERO_PAGE\n\tZFS_AC_KERNEL___COPY_FROM_USER_INATOMIC\n\tZFS_AC_KERNEL_USER_NS_COMMON_INUM\n\tZFS_AC_KERNEL_IDMAP_MNT_API\n\tZFS_AC_KERNEL_IATTR_VFSID\n\tZFS_AC_KERNEL_FILEMAP\n\tZFS_AC_KERNEL_WRITEPAGE_T\n\tZFS_AC_KERNEL_RECLAIMED\n\tZFS_AC_KERNEL_REGISTER_SYSCTL_TABLE\n\tZFS_AC_KERNEL_COPY_SPLICE_READ\n\tZFS_AC_KERNEL_SYNC_BDEV\n\tcase \"$host_cpu\" in\n\t\tpowerpc*)\n\t\t\tZFS_AC_KERNEL_CPU_HAS_FEATURE\n\t\t\tZFS_AC_KERNEL_FLUSH_DCACHE_PAGE\n\t\t\t;;\n\tesac\n])\n\ndnl #\ndnl # Detect name used for Module.symvers file in kernel\ndnl #\nAC_DEFUN([ZFS_AC_MODULE_SYMVERS], [\n\tmodpost=$LINUX/scripts/Makefile.modpost\n\tAC_MSG_CHECKING([kernel file name for module symbols])\n\tAS_IF([test \"x$enable_linux_builtin\" != xyes -a -f \"$modpost\"], [\n\t\tAS_IF([grep -q Modules.symvers $modpost], [\n\t\t\tLINUX_SYMBOLS=Modules.symvers\n\t\t], [\n\t\t\tLINUX_SYMBOLS=Module.symvers\n\t\t])\n\n\t\tAS_IF([test ! -f \"$LINUX_OBJ/$LINUX_SYMBOLS\"], [\n\t\t\tAC_MSG_ERROR([\n\t*** Please make sure the kernel devel package for your distribution\n\t*** is installed.  If you are building with a custom kernel, make sure\n\t*** the kernel is configured, built, and the '--with-linux=PATH'\n\t*** configure option refers to the location of the kernel source.\n\t\t\t])\n\t\t])\n\t], [\n\t\tLINUX_SYMBOLS=NONE\n\t])\n\tAC_MSG_RESULT($LINUX_SYMBOLS)\n\tAC_SUBST(LINUX_SYMBOLS)\n])\n\ndnl #\ndnl # Detect the kernel to be built against\ndnl #\ndnl # Most modern Linux distributions have separate locations for bare\ndnl # source (source) and prebuilt (build) files. Additionally, there are\ndnl # `source` and `build` symlinks in `/lib/modules/$(KERNEL_VERSION)`\ndnl # pointing to them. The directory search order is now:\ndnl # \ndnl # - `configure` command line values if both `--with-linux` and\ndnl #   `--with-linux-obj` were defined\ndnl # \ndnl # - If only `--with-linux` was defined, `--with-linux-obj` is assumed\ndnl #   to have the same value as `--with-linux`\ndnl # \ndnl # - If neither `--with-linux` nor `--with-linux-obj` were defined\ndnl #   autodetection is used:\ndnl # \ndnl #   - `/lib/modules/$(uname -r)/{source,build}` respectively, if exist.\ndnl # \ndnl #   - If only `/lib/modules/$(uname -r)/build` exists, it is assumed\ndnl #     to be both source and build directory.\ndnl # \ndnl #   - The first directory in `/lib/modules` with the highest version\ndnl #     number according to `sort -V` which contains both `source` and\ndnl #     `build` symlinks/directories. If module directory contains only\ndnl #     `build` component, it is assumed to be both source and build\ndnl #     directory.\ndnl # \ndnl #   - Last resort: the first directory matching `/usr/src/kernels/*`\ndnl #     and `/usr/src/linux-*` with the highest version number according\ndnl #     to `sort -V` is assumed to be both source and build directory.\ndnl #\nAC_DEFUN([ZFS_AC_KERNEL], [\n\tAC_ARG_WITH([linux],\n\t\tAS_HELP_STRING([--with-linux=PATH],\n\t\t[Path to kernel source]),\n\t\t[kernelsrc=\"$withval\"])\n\n\tAC_ARG_WITH(linux-obj,\n\t\tAS_HELP_STRING([--with-linux-obj=PATH],\n\t\t[Path to kernel build objects]),\n\t\t[kernelbuild=\"$withval\"])\n\n\tAC_MSG_CHECKING([kernel source and build directories])\n\tAS_IF([test -n \"$kernelsrc\" && test -z \"$kernelbuild\"], [\n\t\tkernelbuild=\"$kernelsrc\"\n\t], [test -z \"$kernelsrc\"], [\n\t\tAS_IF([test -e \"/lib/modules/$(uname -r)/source\" && \\\n\t\t       test -e \"/lib/modules/$(uname -r)/build\"], [\n\t\t\tsrc=\"/lib/modules/$(uname -r)/source\"\n\t\t\tbuild=\"/lib/modules/$(uname -r)/build\"\n\t\t], [test -e \"/lib/modules/$(uname -r)/build\"], [\n\t\t\tbuild=\"/lib/modules/$(uname -r)/build\"\n\t\t\tsrc=\"$build\"\n\t\t], [\n\t\t\tsrc=\n\n\t\t\tfor d in $(ls -1d /lib/modules/* 2>/dev/null | sort -Vr); do\n\t\t\t\tif test -e \"$d/source\" && test -e \"$d/build\"; then\n\t\t\t\t\tsrc=\"$d/source\"\n\t\t\t\t\tbuild=\"$d/build\"\n\t\t\t\t\tbreak\n\t\t\t\tfi\n\n\t\t\t\tif test -e \"$d/build\"; then\n\t\t\t\t\tsrc=\"$d/build\"\n\t\t\t\t\tbuild=\"$d/build\"\n\t\t\t\t\tbreak\n\t\t\t\tfi\n\t\t\tdone\n\n\t\t\t# the least reliable method\n\t\t\tif test -z \"$src\"; then\n\t\t\t\tsrc=$(ls -1d /usr/src/kernels/* /usr/src/linux-* \\\n\t\t\t\t      2>/dev/null | grep -v obj | sort -Vr | head -1)\n\t\t\t\tbuild=\"$src\"\n\t\t\tfi\n\t\t])\n\n\t\tAS_IF([test -n \"$src\" && test -e \"$src\"], [\n\t\t\tkernelsrc=$(readlink -e \"$src\")\n\t\t], [\n\t\t\tkernelsrc=\"[Not found]\"\n\t\t])\n\t\tAS_IF([test -n \"$build\" && test -e \"$build\"], [\n\t\t\tkernelbuild=$(readlink -e \"$build\")\n\t\t], [\n\t\t\tkernelbuild=\"[Not found]\"\n\t\t])\n\t], [\n\t\tAS_IF([test \"$kernelsrc\" = \"NONE\"], [\n\t\t\tkernsrcver=NONE\n\t\t])\n\t\twithlinux=yes\n\t])\n\n\tAC_MSG_RESULT([done])\n\tAC_MSG_CHECKING([kernel source directory])\n\tAC_MSG_RESULT([$kernelsrc])\n\tAC_MSG_CHECKING([kernel build directory])\n\tAC_MSG_RESULT([$kernelbuild])\n\tAS_IF([test ! -d \"$kernelsrc\" || test ! -d \"$kernelbuild\"], [\n\t\tAC_MSG_ERROR([\n\t*** Please make sure the kernel devel package for your distribution\n\t*** is installed and then try again.  If that fails, you can specify the\n\t*** location of the kernel source and build with the '--with-linux=PATH' and\n\t*** '--with-linux-obj=PATH' options respectively.])\n\t])\n\n\tAC_MSG_CHECKING([kernel source version])\n\tutsrelease1=$kernelbuild/include/linux/version.h\n\tutsrelease2=$kernelbuild/include/linux/utsrelease.h\n\tutsrelease3=$kernelbuild/include/generated/utsrelease.h\n\tAS_IF([test -r $utsrelease1 && grep -qF UTS_RELEASE $utsrelease1], [\n\t\tutsrelease=$utsrelease1\n\t], [test -r $utsrelease2 && grep -qF UTS_RELEASE $utsrelease2], [\n\t\tutsrelease=$utsrelease2\n\t], [test -r $utsrelease3 && grep -qF UTS_RELEASE $utsrelease3], [\n\t\tutsrelease=$utsrelease3\n\t])\n\n\tAS_IF([test -n \"$utsrelease\"], [\n\t\tkernsrcver=$($AWK '/UTS_RELEASE/ { gsub(/\"/, \"\", $[3]); print $[3] }' $utsrelease)\n\t\tAS_IF([test -z \"$kernsrcver\"], [\n\t\t\tAC_MSG_RESULT([Not found])\n\t\t\tAC_MSG_ERROR([\n\t*** Cannot determine kernel version.\n\t\t\t])\n\t\t])\n\t], [\n\t\tAC_MSG_RESULT([Not found])\n\t\tif test \"x$enable_linux_builtin\" != xyes; then\n\t\t\tAC_MSG_ERROR([\n\t*** Cannot find UTS_RELEASE definition.\n\t\t\t])\n\t\telse\n\t\t\tAC_MSG_ERROR([\n\t*** Cannot find UTS_RELEASE definition.\n\t*** Please run 'make prepare' inside the kernel source tree.])\n\t\tfi\n\t])\n\n\tAC_MSG_RESULT([$kernsrcver])\n\n\tAS_VERSION_COMPARE([$kernsrcver], [$ZFS_META_KVER_MIN], [\n\t\t AC_MSG_ERROR([\n\t*** Cannot build against kernel version $kernsrcver.\n\t*** The minimum supported kernel version is $ZFS_META_KVER_MIN.\n\t\t])\n\t])\n\n\tLINUX=${kernelsrc}\n\tLINUX_OBJ=${kernelbuild}\n\tLINUX_VERSION=${kernsrcver}\n\n\tAC_SUBST(LINUX)\n\tAC_SUBST(LINUX_OBJ)\n\tAC_SUBST(LINUX_VERSION)\n])\n\ndnl #\ndnl # Detect the QAT module to be built against, QAT provides hardware\ndnl # acceleration for data compression:\ndnl #\ndnl # https://01.org/intel-quickassist-technology\ndnl #\ndnl # 1) Download and install QAT driver from the above link\ndnl # 2) Start QAT driver in your system:\ndnl # \t service qat_service start\ndnl # 3) Enable QAT in ZFS, e.g.:\ndnl # \t ./configure --with-qat=<qat-driver-path>/QAT1.6\ndnl # \t make\ndnl # 4) Set GZIP compression in ZFS dataset:\ndnl # \t zfs set compression = gzip <dataset>\ndnl #\ndnl # Then the data written to this ZFS pool is compressed by QAT accelerator\ndnl # automatically, and de-compressed by QAT when read from the pool.\ndnl #\ndnl # 1) Get QAT hardware statistics with:\ndnl #\t cat /proc/icp_dh895xcc_dev/qat\ndnl # 2) To disable QAT:\ndnl # \t insmod zfs.ko zfs_qat_disable=1\ndnl #\nAC_DEFUN([ZFS_AC_QAT], [\n\tAC_ARG_WITH([qat],\n\t\tAS_HELP_STRING([--with-qat=PATH],\n\t\t[Path to qat source]),\n\t\tAS_IF([test \"$withval\" = \"yes\"],\n\t\t\tAC_MSG_ERROR([--with-qat=PATH requires a PATH]),\n\t\t\t[qatsrc=\"$withval\"]))\n\n\tAC_ARG_WITH([qat-obj],\n\t\tAS_HELP_STRING([--with-qat-obj=PATH],\n\t\t[Path to qat build objects]),\n\t\t[qatbuild=\"$withval\"])\n\n\tAS_IF([test ! -z \"${qatsrc}\"], [\n\t\tAC_MSG_CHECKING([qat source directory])\n\t\tAC_MSG_RESULT([$qatsrc])\n\t\tQAT_SRC=\"${qatsrc}/quickassist\"\n\t\tAS_IF([ test ! -e \"$QAT_SRC/include/cpa.h\"], [\n\t\t\tAC_MSG_ERROR([\n\t*** Please make sure the qat driver package is installed\n\t*** and specify the location of the qat source with the\n\t*** '--with-qat=PATH' option then try again. Failed to\n\t*** find cpa.h in:\n\t${QAT_SRC}/include])\n\t\t])\n\t])\n\n\tAS_IF([test ! -z \"${qatsrc}\"], [\n\t\tAC_MSG_CHECKING([qat build directory])\n\t\tAS_IF([test -z \"$qatbuild\"], [\n\t\t\tqatbuild=\"${qatsrc}/build\"\n\t\t])\n\n\t\tAC_MSG_RESULT([$qatbuild])\n\t\tQAT_OBJ=${qatbuild}\n\t\tAS_IF([ ! test -e \"$QAT_OBJ/icp_qa_al.ko\" && ! test -e \"$QAT_OBJ/qat_api.ko\"], [\n\t\t\tAC_MSG_ERROR([\n\t*** Please make sure the qat driver is installed then try again.\n\t*** Failed to find icp_qa_al.ko or qat_api.ko in:\n\t$QAT_OBJ])\n\t\t])\n\n\t\tAC_SUBST(QAT_SRC)\n\t\tAC_SUBST(QAT_OBJ)\n\n\t\tAC_DEFINE(HAVE_QAT, 1,\n\t\t[qat is enabled and existed])\n\t])\n\n\tdnl #\n\tdnl # Detect the name used for the QAT Module.symvers file.\n\tdnl #\n\tAS_IF([test ! -z \"${qatsrc}\"], [\n\t\tAC_MSG_CHECKING([qat file for module symbols])\n\t\tQAT_SYMBOLS=$QAT_SRC/lookaside/access_layer/src/Module.symvers\n\n\t\tAS_IF([test -r $QAT_SYMBOLS], [\n\t\t\tAC_MSG_RESULT([$QAT_SYMBOLS])\n\t\t\tAC_SUBST(QAT_SYMBOLS)\n\t\t],[\n\t\t\tAC_MSG_ERROR([\n\t*** Please make sure the qat driver is installed then try again.\n\t*** Failed to find Module.symvers in:\n\t$QAT_SYMBOLS\n\t\t\t])\n\t\t])\n\t])\n])\n\ndnl #\ndnl # ZFS_LINUX_CONFTEST_H\ndnl #\nAC_DEFUN([ZFS_LINUX_CONFTEST_H], [\ntest -d build/$2 || mkdir -p build/$2\ncat - <<_ACEOF >build/$2/$2.h\n$1\n_ACEOF\n])\n\ndnl #\ndnl # ZFS_LINUX_CONFTEST_C\ndnl #\nAC_DEFUN([ZFS_LINUX_CONFTEST_C], [\ntest -d build/$2 || mkdir -p build/$2\ncat confdefs.h - <<_ACEOF >build/$2/$2.c\n$1\n_ACEOF\n])\n\ndnl #\ndnl # ZFS_LINUX_CONFTEST_MAKEFILE\ndnl #\ndnl # $1 - test case name\ndnl # $2 - add to top-level Makefile\ndnl # $3 - additional build flags\ndnl #\nAC_DEFUN([ZFS_LINUX_CONFTEST_MAKEFILE], [\n\ttest -d build || mkdir -p build\n\ttest -d build/$1 || mkdir -p build/$1\n\n\tfile=build/$1/Makefile\n\n\tdnl # Example command line to manually build source.\n\tcat - <<_ACEOF >$file\n# Example command line to manually build source\n# make modules -C $LINUX_OBJ $ARCH_UM M=$PWD/build/$1\n\nccflags-y := -Werror $FRAME_LARGER_THAN\n_ACEOF\n\n\tdnl # Additional custom CFLAGS as requested.\n\tm4_ifval($3, [echo \"ccflags-y += $3\" >>$file], [])\n\n\tdnl # Test case source\n\techo \"obj-m := $1.o\" >>$file\n\n\tAS_IF([test \"x$2\" = \"xyes\"], [echo \"obj-m += $1/\" >>build/Makefile], [])\n])\n\ndnl #\ndnl # ZFS_LINUX_TEST_PROGRAM(C)([PROLOGUE], [BODY])\ndnl #\nm4_define([ZFS_LINUX_TEST_PROGRAM], [\n#include <linux/module.h>\n$1\n\nint\nmain (void)\n{\n$2\n\t;\n\treturn 0;\n}\n\nMODULE_DESCRIPTION(\"conftest\");\nMODULE_AUTHOR(ZFS_META_AUTHOR);\nMODULE_VERSION(ZFS_META_VERSION \"-\" ZFS_META_RELEASE);\nMODULE_LICENSE($3);\n])\n\ndnl #\ndnl # ZFS_LINUX_TEST_REMOVE\ndnl #\ndnl # Removes the specified test source and results.\ndnl #\nAC_DEFUN([ZFS_LINUX_TEST_REMOVE], [\n\ttest -d build/$1 && rm -Rf build/$1\n\ttest -f build/Makefile && sed '/$1/d' build/Makefile\n])\n\ndnl #\ndnl # ZFS_LINUX_COMPILE\ndnl #\ndnl # $1 - build dir\ndnl # $2 - test command\ndnl # $3 - pass command\ndnl # $4 - fail command\ndnl # $5 - set KBUILD_MODPOST_NOFINAL='yes'\ndnl # $6 - set KBUILD_MODPOST_WARN='yes'\ndnl #\ndnl # Used internally by ZFS_LINUX_TEST_{COMPILE,MODPOST}\ndnl #\nAC_DEFUN([ZFS_LINUX_COMPILE], [\n\tAC_ARG_VAR([KERNEL_CC], [C compiler for\n\t\tbuilding kernel modules])\n\tAC_ARG_VAR([KERNEL_LD], [Linker for\n\t\tbuilding kernel modules])\n\tAC_ARG_VAR([KERNEL_LLVM], [Binary option to\n\t\tbuild kernel modules with LLVM/CLANG toolchain])\n\tAC_TRY_COMMAND([\n\t    KBUILD_MODPOST_NOFINAL=\"$5\" KBUILD_MODPOST_WARN=\"$6\"\n\t    make modules -k -j$TEST_JOBS ${KERNEL_CC:+CC=$KERNEL_CC}\n\t    ${KERNEL_LD:+LD=$KERNEL_LD} ${KERNEL_LLVM:+LLVM=$KERNEL_LLVM}\n\t    CONFIG_MODULES=y CFLAGS_MODULE=-DCONFIG_MODULES\n\t    -C $LINUX_OBJ $ARCH_UM M=$PWD/$1 >$1/build.log 2>&1])\n\tAS_IF([AC_TRY_COMMAND([$2])], [$3], [$4])\n])\n\ndnl #\ndnl # ZFS_LINUX_TEST_COMPILE\ndnl #\ndnl # Perform a full compile excluding the final modpost phase.\ndnl #\nAC_DEFUN([ZFS_LINUX_TEST_COMPILE], [\n\tZFS_LINUX_COMPILE([$2], [test -f $2/build.log], [\n\t\tmv $2/Makefile $2/Makefile.compile.$1\n\t\tmv $2/build.log $2/build.log.$1\n\t],[\n\t        AC_MSG_ERROR([\n        *** Unable to compile test source to determine kernel interfaces.])\n\t], [yes], [])\n])\n\ndnl #\ndnl # ZFS_LINUX_TEST_MODPOST\ndnl #\ndnl # Perform a full compile including the modpost phase.  This may\ndnl # be an incremental build if the objects have already been built.\ndnl #\nAC_DEFUN([ZFS_LINUX_TEST_MODPOST], [\n\tZFS_LINUX_COMPILE([$2], [test -f $2/build.log], [\n\t\tmv $2/Makefile $2/Makefile.modpost.$1\n\t\tcat $2/build.log >>build/build.log.$1\n\t],[\n\t        AC_MSG_ERROR([\n        *** Unable to modpost test source to determine kernel interfaces.])\n\t], [], [yes])\n])\n\ndnl #\ndnl # Perform the compilation of the test cases in two phases.\ndnl #\ndnl # Phase 1) attempt to build the object files for all of the tests\ndnl #          defined by the ZFS_LINUX_TEST_SRC macro.  But do not\ndnl #          perform the final modpost stage.\ndnl #\ndnl # Phase 2) disable all tests which failed the initial compilation,\ndnl #          then invoke the final modpost step for the remaining tests.\ndnl #\ndnl # This allows us efficiently build the test cases in parallel while\ndnl # remaining resilient to build failures which are expected when\ndnl # detecting the available kernel interfaces.\ndnl #\ndnl # The maximum allowed parallelism can be controlled by setting the\ndnl # TEST_JOBS environment variable.  Otherwise, it default to $(nproc).\ndnl #\nAC_DEFUN([ZFS_LINUX_TEST_COMPILE_ALL], [\n\tdnl # Phase 1 - Compilation only, final linking is skipped.\n\tZFS_LINUX_TEST_COMPILE([$1], [build])\n\n\tdnl #\n\tdnl # Phase 2 - When building external modules disable test cases\n\tdnl # which failed to compile and invoke modpost to verify the\n\tdnl # final linking.\n\tdnl #\n\tdnl # Test names suffixed with '_license' call modpost independently\n\tdnl # to ensure that a single incompatibility does not result in the\n\tdnl # modpost phase exiting early.  This check is not performed on\n\tdnl # every symbol since the majority are compatible and doing so\n\tdnl # would significantly slow down this phase.\n\tdnl #\n\tdnl # When configuring for builtin (--enable-linux-builtin)\n\tdnl # fake the linking step artificially create the expected .ko\n\tdnl # files for tests which did compile.  This is required for\n\tdnl # kernels which do not have loadable module support or have\n\tdnl # not yet been built.\n\tdnl #\n\tAS_IF([test \"x$enable_linux_builtin\" = \"xno\"], [\n\t\tfor dir in $(awk '/^obj-m/ { print [$]3 }' \\\n\t\t    build/Makefile.compile.$1); do\n\t\t\tname=${dir%/}\n\t\t\tAS_IF([test -f build/$name/$name.o], [\n\t\t\t\tAS_IF([test \"${name##*_}\" = \"license\"], [\n\t\t\t\t\tZFS_LINUX_TEST_MODPOST([$1],\n\t\t\t\t\t    [build/$name])\n\t\t\t\t\techo \"obj-n += $dir\" >>build/Makefile\n\t\t\t\t], [\n\t\t\t\t\techo \"obj-m += $dir\" >>build/Makefile\n\t\t\t\t])\n\t\t\t], [\n\t\t\t\techo \"obj-n += $dir\" >>build/Makefile\n\t\t\t])\n\t\tdone\n\n\t\tZFS_LINUX_TEST_MODPOST([$1], [build])\n\t], [\n\t\tfor dir in $(awk '/^obj-m/ { print [$]3 }' \\\n\t\t    build/Makefile.compile.$1); do\n\t\t\tname=${dir%/}\n\t\t\tAS_IF([test -f build/$name/$name.o], [\n\t\t\t\ttouch build/$name/$name.ko\n\t\t\t])\n\t\tdone\n\t])\n])\n\ndnl #\ndnl # ZFS_LINUX_TEST_SRC\ndnl #\ndnl # $1 - name\ndnl # $2 - global\ndnl # $3 - source\ndnl # $4 - extra cflags\ndnl # $5 - check license-compatibility\ndnl #\ndnl # Check if the test source is buildable at all and then if it is\ndnl # license compatible.\ndnl #\ndnl # N.B because all of the test cases are compiled in parallel they\ndnl # must never depend on the results of previous tests.  Each test\ndnl # needs to be entirely independent.\ndnl #\nAC_DEFUN([ZFS_LINUX_TEST_SRC], [\n\tZFS_LINUX_CONFTEST_C([ZFS_LINUX_TEST_PROGRAM([[$2]], [[$3]],\n\t    [[\"Dual BSD/GPL\"]])], [$1])\n\tZFS_LINUX_CONFTEST_MAKEFILE([$1], [yes], [$4])\n\n\tAS_IF([ test -n \"$5\" ], [\n\t\tZFS_LINUX_CONFTEST_C([ZFS_LINUX_TEST_PROGRAM(\n\t\t    [[$2]], [[$3]], [[$5]])], [$1_license])\n\t\tZFS_LINUX_CONFTEST_MAKEFILE([$1_license], [yes], [$4])\n\t])\n])\n\ndnl #\ndnl # ZFS_LINUX_TEST_RESULT\ndnl #\ndnl # $1 - name of a test source (ZFS_LINUX_TEST_SRC)\ndnl # $2 - run on success (valid .ko generated)\ndnl # $3 - run on failure (unable to compile)\ndnl #\nAC_DEFUN([ZFS_LINUX_TEST_RESULT], [\n\tAS_IF([test -d build/$1], [\n\t\tAS_IF([test -f build/$1/$1.ko], [$2], [$3])\n\t], [\n\t\tAC_MSG_ERROR([\n\t*** No matching source for the \"$1\" test, check that\n\t*** both the test source and result macros refer to the same name.\n\t\t])\n\t])\n])\n\ndnl #\ndnl # ZFS_LINUX_TEST_ERROR\ndnl #\ndnl # Generic error message which can be used when none of the expected\ndnl # kernel interfaces were detected.\ndnl #\nAC_DEFUN([ZFS_LINUX_TEST_ERROR], [\n\tAC_MSG_ERROR([\n\t*** None of the expected \"$1\" interfaces were detected.\n\t*** This may be because your kernel version is newer than what is\n\t*** supported, or you are using a patched custom kernel with\n\t*** incompatible modifications.\n\t***\n\t*** ZFS Version: $ZFS_META_ALIAS\n\t*** Compatible Kernels: $ZFS_META_KVER_MIN - $ZFS_META_KVER_MAX\n\t])\n])\n\ndnl #\ndnl # ZFS_LINUX_TEST_RESULT_SYMBOL\ndnl #\ndnl # Like ZFS_LINUX_TEST_RESULT except ZFS_CHECK_SYMBOL_EXPORT is called to\ndnl # verify symbol exports, unless --enable-linux-builtin was provided to\ndnl # configure.\ndnl #\nAC_DEFUN([ZFS_LINUX_TEST_RESULT_SYMBOL], [\n\tAS_IF([ ! test -f build/$1/$1.ko], [\n\t\t$5\n\t], [\n\t\tAS_IF([test \"x$enable_linux_builtin\" != \"xyes\"], [\n\t\t\tZFS_CHECK_SYMBOL_EXPORT([$2], [$3], [$4], [$5])\n\t\t], [\n\t\t\t$4\n\t\t])\n\t])\n])\n\ndnl #\ndnl # ZFS_LINUX_COMPILE_IFELSE\ndnl #\nAC_DEFUN([ZFS_LINUX_COMPILE_IFELSE], [\n\tZFS_LINUX_TEST_REMOVE([conftest])\n\n\tm4_ifvaln([$1], [ZFS_LINUX_CONFTEST_C([$1], [conftest])])\n\tm4_ifvaln([$5], [ZFS_LINUX_CONFTEST_H([$5], [conftest])],\n\t    [ZFS_LINUX_CONFTEST_H([], [conftest])])\n\n\tZFS_LINUX_CONFTEST_MAKEFILE([conftest], [no],\n\t    [m4_ifvaln([$5], [-I$PWD/build/conftest], [])])\n\tZFS_LINUX_COMPILE([build/conftest], [$2], [$3], [$4], [], [])\n])\n\ndnl #\ndnl # ZFS_LINUX_TRY_COMPILE\ndnl #\ndnl # $1 - global\ndnl # $2 - source\ndnl # $3 - run on success (valid .ko generated)\ndnl # $4 - run on failure (unable to compile)\ndnl #\ndnl # When configuring as builtin (--enable-linux-builtin) for kernels\ndnl # without loadable module support (CONFIG_MODULES=n) only the object\ndnl # file is created.  See ZFS_LINUX_TEST_COMPILE_ALL for details.\ndnl #\nAC_DEFUN([ZFS_LINUX_TRY_COMPILE], [\n\tAS_IF([test \"x$enable_linux_builtin\" = \"xyes\"], [\n\t\tZFS_LINUX_COMPILE_IFELSE(\n\t\t    [ZFS_LINUX_TEST_PROGRAM([[$1]], [[$2]],\n\t\t    [[ZFS_META_LICENSE]])],\n\t\t    [test -f build/conftest/conftest.o], [$3], [$4])\n\t], [\n\t\tZFS_LINUX_COMPILE_IFELSE(\n\t\t    [ZFS_LINUX_TEST_PROGRAM([[$1]], [[$2]],\n\t\t    [[ZFS_META_LICENSE]])],\n\t\t    [test -f build/conftest/conftest.ko], [$3], [$4])\n\t])\n])\n\ndnl #\ndnl # ZFS_CHECK_SYMBOL_EXPORT\ndnl #\ndnl # Check if a symbol is exported on not by consulting the symbols\ndnl # file, or optionally the source code.\ndnl #\nAC_DEFUN([ZFS_CHECK_SYMBOL_EXPORT], [\n\tgrep -q -E '[[[:space:]]]$1[[[:space:]]]' \\\n\t\t$LINUX_OBJ/$LINUX_SYMBOLS 2>/dev/null\n\trc=$?\n\tif test $rc -ne 0; then\n\t\texport=0\n\t\tfor file in $2; do\n\t\t\tgrep -q -E \"EXPORT_SYMBOL.*($1)\" \\\n\t\t\t\t\"$LINUX/$file\" 2>/dev/null\n\t\t\trc=$?\n\t\t\tif test $rc -eq 0; then\n\t\t\t\texport=1\n\t\t\t\tbreak;\n\t\t\tfi\n\t\tdone\n\t\tif test $export -eq 0; then :\n\t\t\t$4\n\t\telse :\n\t\t\t$3\n\t\tfi\n\telse :\n\t\t$3\n\tfi\n])\n\ndnl #\ndnl # ZFS_LINUX_TRY_COMPILE_SYMBOL\ndnl #\ndnl # Like ZFS_LINUX_TRY_COMPILER except ZFS_CHECK_SYMBOL_EXPORT is called\ndnl # to verify symbol exports, unless --enable-linux-builtin was provided\ndnl # to configure.\ndnl #\nAC_DEFUN([ZFS_LINUX_TRY_COMPILE_SYMBOL], [\n\tZFS_LINUX_TRY_COMPILE([$1], [$2], [rc=0], [rc=1])\n\tif test $rc -ne 0; then :\n\t\t$6\n\telse\n\t\tif test \"x$enable_linux_builtin\" != xyes; then\n\t\t\tZFS_CHECK_SYMBOL_EXPORT([$3], [$4], [rc=0], [rc=1])\n\t\tfi\n\t\tif test $rc -ne 0; then :\n\t\t\t$6\n\t\telse :\n\t\t\t$5\n\t\tfi\n\tfi\n])\n\ndnl #\ndnl # ZFS_LINUX_TRY_COMPILE_HEADER\ndnl # like ZFS_LINUX_TRY_COMPILE, except the contents conftest.h are\ndnl # provided via the fifth parameter\ndnl #\nAC_DEFUN([ZFS_LINUX_TRY_COMPILE_HEADER], [\n\tAS_IF([test \"x$enable_linux_builtin\" = \"xyes\"], [\n\t\tZFS_LINUX_COMPILE_IFELSE(\n\t\t    [ZFS_LINUX_TEST_PROGRAM([[$1]], [[$2]],\n\t\t    [[ZFS_META_LICENSE]])],\n\t\t    [test -f build/conftest/conftest.o], [$3], [$4], [$5])\n\t], [\n\t\tZFS_LINUX_COMPILE_IFELSE(\n\t\t    [ZFS_LINUX_TEST_PROGRAM([[$1]], [[$2]],\n\t\t    [[ZFS_META_LICENSE]])],\n\t\t    [test -f build/conftest/conftest.ko], [$3], [$4], [$5])\n\t])\n])\n\ndnl #\ndnl # AS_VERSION_COMPARE_LE\ndnl # like AS_VERSION_COMPARE_LE, but runs $3 if (and only if) $1 <= $2\ndnl # AS_VERSION_COMPARE_LE (version-1, version-2, [action-if-less-or-equal], [action-if-greater])\ndnl #\nAC_DEFUN([AS_VERSION_COMPARE_LE], [\n\tAS_VERSION_COMPARE([$1], [$2], [$3], [$3], [$4])\n])\n\ndnl #\ndnl # ZFS_LINUX_REQUIRE_API\ndnl # like ZFS_LINUX_TEST_ERROR, except only fails if the kernel is\ndnl # at least some specified version.\ndnl #\nAC_DEFUN([ZFS_LINUX_REQUIRE_API], [\n\tAS_VERSION_COMPARE_LE([$2], [$kernsrcver], [\n\t\tAC_MSG_ERROR([\n\t\t*** None of the expected \"$1\" interfaces were detected. This\n\t\t*** interface is expected for kernels version \"$2\" and above.\n\t\t*** This may be because your kernel version is newer than what is\n\t\t*** supported, or you are using a patched custom kernel with\n\t\t*** incompatible modifications.  Newer kernels may have incompatible\n\t\t*** APIs.\n\t\t***\n\t\t*** ZFS Version: $ZFS_META_ALIAS\n\t\t*** Compatible Kernels: $ZFS_META_KVER_MIN - $ZFS_META_KVER_MAX\n\t\t])\n\t], [\n\t\tAC_MSG_RESULT(no)\n\t])\n])\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}