{
  "module_name": "kernel-userns-capabilities.m4",
  "hash_id": "ceef412dfa158ed676fa1f231bedcd39df8656aa4067c328876cb44902cad44c",
  "original_prompt": "Ingested from zfs-2.2.2/config/kernel-userns-capabilities.m4",
  "human_readable_source": "dnl #\ndnl # 2.6.38 API change\ndnl # ns_capable() was introduced\ndnl #\nAC_DEFUN([ZFS_AC_KERNEL_SRC_NS_CAPABLE], [\n\tZFS_LINUX_TEST_SRC([ns_capable], [\n\t\t#include <linux/capability.h>\n\t],[\n\t\tns_capable((struct user_namespace *)NULL, CAP_SYS_ADMIN);\n\t])\n])\n\nAC_DEFUN([ZFS_AC_KERNEL_NS_CAPABLE], [\n\tAC_MSG_CHECKING([whether ns_capable exists])\n\tZFS_LINUX_TEST_RESULT([ns_capable], [\n\t\tAC_MSG_RESULT(yes)\n\t],[\n\t\tZFS_LINUX_TEST_ERROR([ns_capable()])\n\t])\n])\n\ndnl #\ndnl # 4.10 API change\ndnl # has_capability() was exported.\ndnl #\nAC_DEFUN([ZFS_AC_KERNEL_SRC_HAS_CAPABILITY], [\n\tZFS_LINUX_TEST_SRC([has_capability], [\n\t\t#include <linux/capability.h>\n\t],[\n\t\tstruct task_struct *task = NULL;\n\t\tint cap = 0;\n\t\tbool result __attribute__ ((unused));\n\n\t\tresult = has_capability(task, cap);\n\t])\n])\n\nAC_DEFUN([ZFS_AC_KERNEL_HAS_CAPABILITY], [\n\tAC_MSG_CHECKING([whether has_capability() is available])\n\tZFS_LINUX_TEST_RESULT_SYMBOL([has_capability],\n\t    [has_capability], [kernel/capability.c], [\n\t\tAC_MSG_RESULT(yes)\n\t\tAC_DEFINE(HAVE_HAS_CAPABILITY, 1, [has_capability() is available])\n\t],[\n\t\tAC_MSG_RESULT(no)\n\t])\n])\n\ndnl #\ndnl # 2.6.39 API change\ndnl # struct user_namespace was added to struct cred_t as cred->user_ns member\ndnl #\nAC_DEFUN([ZFS_AC_KERNEL_SRC_CRED_USER_NS], [\n\tZFS_LINUX_TEST_SRC([cred_user_ns], [\n\t\t#include <linux/cred.h>\n\t],[\n\t\tstruct cred cr;\n\t\tcr.user_ns = (struct user_namespace *)NULL;\n\t])\n])\n\nAC_DEFUN([ZFS_AC_KERNEL_CRED_USER_NS], [\n\tAC_MSG_CHECKING([whether cred_t->user_ns exists])\n\tZFS_LINUX_TEST_RESULT([cred_user_ns], [\n\t\tAC_MSG_RESULT(yes)\n\t],[\n\t\tZFS_LINUX_TEST_ERROR([cred_t->user_ns()])\n\t])\n])\n\ndnl #\ndnl # 3.4 API change\ndnl # kuid_has_mapping() and kgid_has_mapping() were added to distinguish\ndnl # between internal kernel uids/gids and user namespace uids/gids.\ndnl #\nAC_DEFUN([ZFS_AC_KERNEL_SRC_KUID_HAS_MAPPING], [\n\tZFS_LINUX_TEST_SRC([kuid_has_mapping], [\n\t\t#include <linux/uidgid.h>\n\t],[\n\t\tkuid_has_mapping((struct user_namespace *)NULL, KUIDT_INIT(0));\n\t\tkgid_has_mapping((struct user_namespace *)NULL, KGIDT_INIT(0));\n\t])\n])\n\nAC_DEFUN([ZFS_AC_KERNEL_KUID_HAS_MAPPING], [\n\tAC_MSG_CHECKING([whether kuid_has_mapping/kgid_has_mapping exist])\n\tZFS_LINUX_TEST_RESULT([kuid_has_mapping], [\n\t\tAC_MSG_RESULT(yes)\n\t],[\n\t\tZFS_LINUX_TEST_ERROR([kuid_has_mapping()])\n\t])\n])\n\nAC_DEFUN([ZFS_AC_KERNEL_SRC_USERNS_CAPABILITIES], [\n\tZFS_AC_KERNEL_SRC_NS_CAPABLE\n\tZFS_AC_KERNEL_SRC_HAS_CAPABILITY\n\tZFS_AC_KERNEL_SRC_CRED_USER_NS\n\tZFS_AC_KERNEL_SRC_KUID_HAS_MAPPING\n])\n\nAC_DEFUN([ZFS_AC_KERNEL_USERNS_CAPABILITIES], [\n\tZFS_AC_KERNEL_NS_CAPABLE\n\tZFS_AC_KERNEL_HAS_CAPABILITY\n\tZFS_AC_KERNEL_CRED_USER_NS\n\tZFS_AC_KERNEL_KUID_HAS_MAPPING\n])\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}