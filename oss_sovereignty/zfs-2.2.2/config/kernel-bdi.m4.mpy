{
  "module_name": "kernel-bdi.m4",
  "hash_id": "b578f5e3e29ecccc080cc7307f7614cc1ceaac8c359a82f7a3af838dd06a31d0",
  "original_prompt": "Ingested from zfs-2.2.2/config/kernel-bdi.m4",
  "human_readable_source": "dnl #\ndnl # Check available BDI interfaces.\ndnl #\nAC_DEFUN([ZFS_AC_KERNEL_SRC_BDI], [\n\tZFS_LINUX_TEST_SRC([super_setup_bdi_name], [\n\t\t#include <linux/fs.h>\n\t\tstruct super_block sb;\n\t], [\n\t\tchar *name = \"bdi\";\n\t\tatomic_long_t zfs_bdi_seq;\n\t\tint error __attribute__((unused));\n\t\tatomic_long_set(&zfs_bdi_seq, 0);\n\t\terror =\n\t\t    super_setup_bdi_name(&sb, \"%.28s-%ld\", name,\n\t\t    atomic_long_inc_return(&zfs_bdi_seq));\n\t])\n\n\tZFS_LINUX_TEST_SRC([bdi_setup_and_register], [\n\t\t#include <linux/backing-dev.h>\n\t\tstruct backing_dev_info bdi;\n\t], [\n\t\tchar *name = \"bdi\";\n\t\tint error __attribute__((unused)) =\n\t\t    bdi_setup_and_register(&bdi, name);\n\t])\n\n\tZFS_LINUX_TEST_SRC([bdi_setup_and_register_3args], [\n\t\t#include <linux/backing-dev.h>\n\t\tstruct backing_dev_info bdi;\n\t], [\n\t\tchar *name = \"bdi\";\n\t\tunsigned int cap = BDI_CAP_MAP_COPY;\n\t\tint error __attribute__((unused)) =\n\t\t    bdi_setup_and_register(&bdi, name, cap);\n\t])\n])\n\nAC_DEFUN([ZFS_AC_KERNEL_BDI], [\n\tdnl #\n\tdnl # 4.12, super_setup_bdi_name() introduced.\n\tdnl #\n\tAC_MSG_CHECKING([whether super_setup_bdi_name() exists])\n\tZFS_LINUX_TEST_RESULT_SYMBOL([super_setup_bdi_name],\n\t    [super_setup_bdi_name], [fs/super.c], [\n\t\tAC_MSG_RESULT(yes)\n\t\tAC_DEFINE(HAVE_SUPER_SETUP_BDI_NAME, 1,\n                    [super_setup_bdi_name() exits])\n\t], [\n\t\tAC_MSG_RESULT(no)\n\n\t\tdnl #\n\t\tdnl # 4.0 - 4.11, bdi_setup_and_register() takes 2 arguments.\n\t\tdnl #\n\t\tAC_MSG_CHECKING(\n\t\t    [whether bdi_setup_and_register() wants 2 args])\n\t\tZFS_LINUX_TEST_RESULT_SYMBOL([bdi_setup_and_register],\n\t\t    [bdi_setup_and_register], [mm/backing-dev.c], [\n\t\t\tAC_MSG_RESULT(yes)\n\t\t\tAC_DEFINE(HAVE_2ARGS_BDI_SETUP_AND_REGISTER, 1,\n\t\t\t    [bdi_setup_and_register() wants 2 args])\n\t\t], [\n\t\t\tAC_MSG_RESULT(no)\n\n\t\t\tdnl #\n\t\t\tdnl # 2.6.34 - 3.19, bdi_setup_and_register()\n\t\t\tdnl # takes 3 arguments.\n\t\t\tdnl #\n\t\t\tAC_MSG_CHECKING(\n\t\t\t    [whether bdi_setup_and_register() wants 3 args])\n\t\t\tZFS_LINUX_TEST_RESULT_SYMBOL(\n\t\t\t    [bdi_setup_and_register_3args],\n\t\t\t    [bdi_setup_and_register], [mm/backing-dev.c], [\n\t\t\t\tAC_MSG_RESULT(yes)\n\t\t\t\tAC_DEFINE(HAVE_3ARGS_BDI_SETUP_AND_REGISTER, 1,\n\t\t\t\t    [bdi_setup_and_register() wants 3 args])\n\t\t\t], [\n\t\t\t\tZFS_LINUX_TEST_ERROR([bdi_setup])\n\t\t\t])\n\t\t])\n\t])\n])\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}