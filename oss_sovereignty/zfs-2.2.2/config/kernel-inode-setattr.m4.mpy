{
  "module_name": "kernel-inode-setattr.m4",
  "hash_id": "4bb5726a44bfe43282f8a0e487a9e24d05eb0a78d829b4b944b60011b1c4ddf1",
  "original_prompt": "Ingested from zfs-2.2.2/config/kernel-inode-setattr.m4",
  "human_readable_source": "AC_DEFUN([ZFS_AC_KERNEL_SRC_INODE_SETATTR], [\n\tdnl #\n\tdnl # Linux 6.3 API\n\tdnl # The first arg of setattr I/O operations handler type\n\tdnl # is changed to struct mnt_idmap*\n\tdnl #\n\tZFS_LINUX_TEST_SRC([inode_operations_setattr_mnt_idmap], [\n\t\t#include <linux/fs.h>\n\n\t\tint test_setattr(\n\t\t    struct mnt_idmap *idmap,\n\t\t    struct dentry *de, struct iattr *ia)\n\t\t    { return 0; }\n\n\t\tstatic const struct inode_operations\n\t\t    iops __attribute__ ((unused)) = {\n\t\t\t.setattr = test_setattr,\n\t\t};\n\t],[])\n\n\tdnl #\n\tdnl # Linux 5.12 API\n\tdnl # The setattr I/O operations handler type was extended to require\n\tdnl # a struct user_namespace* as its first arg, to support idmapped\n\tdnl # mounts.\n\tdnl #\n\tZFS_LINUX_TEST_SRC([inode_operations_setattr_userns], [\n\t\t#include <linux/fs.h>\n\n\t\tint test_setattr(\n\t\t    struct user_namespace *userns,\n\t\t    struct dentry *de, struct iattr *ia)\n\t\t    { return 0; }\n\n\t\tstatic const struct inode_operations\n\t\t    iops __attribute__ ((unused)) = {\n\t\t\t.setattr = test_setattr,\n\t\t};\n\t],[])\n\n\tZFS_LINUX_TEST_SRC([inode_operations_setattr], [\n\t\t#include <linux/fs.h>\n\n\t\tint test_setattr(\n\t\t    struct dentry *de, struct iattr *ia)\n\t\t    { return 0; }\n\n\t\tstatic const struct inode_operations\n\t\t    iops __attribute__ ((unused)) = {\n\t\t\t.setattr = test_setattr,\n\t\t};\n\t],[])\n])\n\nAC_DEFUN([ZFS_AC_KERNEL_INODE_SETATTR], [\n\tdnl #\n\tdnl # Kernel 6.3 test\n\tdnl #\n\tAC_MSG_CHECKING([whether iops->setattr() takes mnt_idmap])\n\tZFS_LINUX_TEST_RESULT([inode_operations_setattr_mnt_idmap], [\n\t\tAC_MSG_RESULT(yes)\n\t\tAC_DEFINE(HAVE_IDMAP_IOPS_SETATTR, 1,\n\t\t    [iops->setattr() takes struct mnt_idmap*])\n\t],[\n\t\tAC_MSG_RESULT(no)\n\t\tdnl #\n\t\tdnl # Kernel 5.12 test\n\t\tdnl #\n\t\tAC_MSG_CHECKING([whether iops->setattr() takes user_namespace])\n\t\tZFS_LINUX_TEST_RESULT([inode_operations_setattr_userns], [\n\t\t\tAC_MSG_RESULT(yes)\n\t\t\tAC_DEFINE(HAVE_USERNS_IOPS_SETATTR, 1,\n\t\t\t    [iops->setattr() takes struct user_namespace*])\n\t\t],[\n\t\t\tAC_MSG_RESULT(no)\n\n\t\t\tAC_MSG_CHECKING([whether iops->setattr() exists])\n\t\t\tZFS_LINUX_TEST_RESULT([inode_operations_setattr], [\n\t\t\t\tAC_MSG_RESULT(yes)\n\t\t\t\tAC_DEFINE(HAVE_IOPS_SETATTR, 1,\n\t\t\t\t\t[iops->setattr() exists])\n\t\t\t],[\n\t\t\t\tAC_MSG_RESULT(no)\n\t\t\t])\n\t\t])\n\t])\n])\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}