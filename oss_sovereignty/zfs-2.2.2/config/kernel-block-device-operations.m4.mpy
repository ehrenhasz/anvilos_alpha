{
  "module_name": "kernel-block-device-operations.m4",
  "hash_id": "3734f6db18552c1e3d4d2e3c110d58f3aacfe05c77dc3317fa88b1acfdd2f723",
  "original_prompt": "Ingested from zfs-2.2.2/config/kernel-block-device-operations.m4",
  "human_readable_source": "dnl #\ndnl # 2.6.38 API change\ndnl #\nAC_DEFUN([ZFS_AC_KERNEL_SRC_BLOCK_DEVICE_OPERATIONS_CHECK_EVENTS], [\n\tZFS_LINUX_TEST_SRC([block_device_operations_check_events], [\n\t\t#include <linux/blkdev.h>\n\n\t\tunsigned int blk_check_events(struct gendisk *disk,\n\t\t    unsigned int clearing) {\n\t\t\t(void) disk, (void) clearing;\n\t\t\treturn (0);\n\t\t}\n\n\t\tstatic const struct block_device_operations\n\t\t    bops __attribute__ ((unused)) = {\n\t\t\t.check_events\t= blk_check_events,\n\t\t};\n\t], [], [])\n])\n\nAC_DEFUN([ZFS_AC_KERNEL_BLOCK_DEVICE_OPERATIONS_CHECK_EVENTS], [\n\tAC_MSG_CHECKING([whether bops->check_events() exists])\n\tZFS_LINUX_TEST_RESULT([block_device_operations_check_events], [\n\t\tAC_MSG_RESULT(yes)\n\t],[\n\t\tZFS_LINUX_TEST_ERROR([bops->check_events()])\n\t])\n])\n\ndnl #\ndnl # 3.10.x API change\ndnl #\nAC_DEFUN([ZFS_AC_KERNEL_SRC_BLOCK_DEVICE_OPERATIONS_RELEASE_VOID], [\n\tZFS_LINUX_TEST_SRC([block_device_operations_release_void], [\n\t\t#include <linux/blkdev.h>\n\n\t\tvoid blk_release(struct gendisk *g, fmode_t mode) {\n\t\t\t(void) g, (void) mode;\n\t\t\treturn;\n\t\t}\n\n\t\tstatic const struct block_device_operations\n\t\t    bops __attribute__ ((unused)) = {\n\t\t\t.open\t\t= NULL,\n\t\t\t.release\t= blk_release,\n\t\t\t.ioctl\t\t= NULL,\n\t\t\t.compat_ioctl\t= NULL,\n\t\t};\n\t], [], [])\n])\n\ndnl #\ndnl # 5.9.x API change\ndnl #\nAC_DEFUN([ZFS_AC_KERNEL_SRC_BLOCK_DEVICE_OPERATIONS_RELEASE_1ARG], [\n\tZFS_LINUX_TEST_SRC([block_device_operations_release_void_1arg], [\n\t\t#include <linux/blkdev.h>\n\n\t\tvoid blk_release(struct gendisk *g) {\n\t\t\t(void) g;\n\t\t\treturn;\n\t\t}\n\n\t\tstatic const struct block_device_operations\n\t\t    bops __attribute__ ((unused)) = {\n\t\t\t.open\t\t= NULL,\n\t\t\t.release\t= blk_release,\n\t\t\t.ioctl\t\t= NULL,\n\t\t\t.compat_ioctl\t= NULL,\n\t\t};\n\t], [], [])\n])\n\nAC_DEFUN([ZFS_AC_KERNEL_BLOCK_DEVICE_OPERATIONS_RELEASE_VOID], [\n\tAC_MSG_CHECKING([whether bops->release() is void and takes 2 args])\n\tZFS_LINUX_TEST_RESULT([block_device_operations_release_void], [\n\t\tAC_MSG_RESULT(yes)\n\t],[\n\t\tAC_MSG_RESULT(no)\n\t\tAC_MSG_CHECKING([whether bops->release() is void and takes 1 arg])\n\t\tZFS_LINUX_TEST_RESULT([block_device_operations_release_void_1arg], [\n\t\t\tAC_MSG_RESULT(yes)\n\t\t\tAC_DEFINE([HAVE_BLOCK_DEVICE_OPERATIONS_RELEASE_1ARG], [1],\n\t\t\t\t[Define if release() in block_device_operations takes 1 arg])\n\t\t],[\n\t\t\tZFS_LINUX_TEST_ERROR([bops->release()])\n\t\t])\n\t])\n])\n\ndnl #\ndnl # 5.13 API change\ndnl # block_device_operations->revalidate_disk() was removed\ndnl #\nAC_DEFUN([ZFS_AC_KERNEL_SRC_BLOCK_DEVICE_OPERATIONS_REVALIDATE_DISK], [\n\tZFS_LINUX_TEST_SRC([block_device_operations_revalidate_disk], [\n\t\t#include <linux/blkdev.h>\n\n\t\tint blk_revalidate_disk(struct gendisk *disk) {\n\t\t\t(void) disk;\n\t\t\treturn(0);\n\t\t}\n\n\t\tstatic const struct block_device_operations\n\t\t    bops __attribute__ ((unused)) = {\n\t\t\t.revalidate_disk\t= blk_revalidate_disk,\n\t\t};\n\t], [], [])\n])\n\nAC_DEFUN([ZFS_AC_KERNEL_BLOCK_DEVICE_OPERATIONS_REVALIDATE_DISK], [\n\tAC_MSG_CHECKING([whether bops->revalidate_disk() exists])\n\tZFS_LINUX_TEST_RESULT([block_device_operations_revalidate_disk], [\n\t\tAC_DEFINE([HAVE_BLOCK_DEVICE_OPERATIONS_REVALIDATE_DISK], [1],\n\t\t\t[Define if revalidate_disk() in block_device_operations])\n\t\tAC_MSG_RESULT(yes)\n\t],[\n\t\tAC_MSG_RESULT(no)\n\t])\n])\n\nAC_DEFUN([ZFS_AC_KERNEL_SRC_BLOCK_DEVICE_OPERATIONS], [\n\tZFS_AC_KERNEL_SRC_BLOCK_DEVICE_OPERATIONS_CHECK_EVENTS\n\tZFS_AC_KERNEL_SRC_BLOCK_DEVICE_OPERATIONS_RELEASE_VOID\n\tZFS_AC_KERNEL_SRC_BLOCK_DEVICE_OPERATIONS_RELEASE_1ARG\n\tZFS_AC_KERNEL_SRC_BLOCK_DEVICE_OPERATIONS_REVALIDATE_DISK\n])\n\nAC_DEFUN([ZFS_AC_KERNEL_BLOCK_DEVICE_OPERATIONS], [\n\tZFS_AC_KERNEL_BLOCK_DEVICE_OPERATIONS_CHECK_EVENTS\n\tZFS_AC_KERNEL_BLOCK_DEVICE_OPERATIONS_RELEASE_VOID\n\tZFS_AC_KERNEL_BLOCK_DEVICE_OPERATIONS_REVALIDATE_DISK\n])\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}