{
  "module_name": "ax_python_devel.m4",
  "hash_id": "11d6b99899e7cf6afbe2021d219bc04f1c74ec1b84a50f7072baf847fb86a185",
  "original_prompt": "Ingested from zfs-2.2.2/config/ax_python_devel.m4",
  "human_readable_source": "# ===========================================================================\n#     https://www.gnu.org/software/autoconf-archive/ax_python_devel.html\n# ===========================================================================\n#\n# SYNOPSIS\n#\n#   AX_PYTHON_DEVEL([version], [action-if-not-found])\n#\n# DESCRIPTION\n#\n#   Note: Defines as a precious variable \"PYTHON_VERSION\". Don't override it\n#   in your configure.ac.\n#\n#   Note: this is a slightly modified version of the original AX_PYTHON_DEVEL\n#   macro which accepts an additional [action-if-not-found] argument. This\n#   allow to detect if Python development is available without aborting the\n#   configure phase with an hard error in case it is not.\n#\n#   This macro checks for Python and tries to get the include path to\n#   'Python.h'. It provides the $(PYTHON_CPPFLAGS) and $(PYTHON_LIBS) output\n#   variables. It also exports $(PYTHON_EXTRA_LIBS) and\n#   $(PYTHON_EXTRA_LDFLAGS) for embedding Python in your code.\n#\n#   You can search for some particular version of Python by passing a\n#   parameter to this macro, for example \">= '2.3.1'\", or \"== '2.4'\". Please\n#   note that you *have* to pass also an operator along with the version to\n#   match, and pay special attention to the single quotes surrounding the\n#   version number. Don't use \"PYTHON_VERSION\" for this: that environment\n#   variable is declared as precious and thus reserved for the end-user.\n#\n#   This macro should work for all versions of Python >= 2.1.0. As an end\n#   user, you can disable the check for the python version by setting the\n#   PYTHON_NOVERSIONCHECK environment variable to something else than the\n#   empty string.\n#\n#   If you need to use this macro for an older Python version, please\n#   contact the authors. We're always open for feedback.\n#\n# LICENSE\n#\n#   Copyright (c) 2009 Sebastian Huber <sebastian-huber@web.de>\n#   Copyright (c) 2009 Alan W. Irwin\n#   Copyright (c) 2009 Rafael Laboissiere <rafael@laboissiere.net>\n#   Copyright (c) 2009 Andrew Collier\n#   Copyright (c) 2009 Matteo Settenvini <matteo@member.fsf.org>\n#   Copyright (c) 2009 Horst Knorr <hk_classes@knoda.org>\n#   Copyright (c) 2013 Daniel Mullner <muellner@math.stanford.edu>\n#   Copyright (c) 2018 loli10K <ezomori.nozomu@gmail.com>\n#\n#   This program is free software: you can redistribute it and/or modify it\n#   under the terms of the GNU General Public License as published by the\n#   Free Software Foundation, either version 3 of the License, or (at your\n#   option) any later version.\n#\n#   This program is distributed in the hope that it will be useful, but\n#   WITHOUT ANY WARRANTY; without even the implied warranty of\n#   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General\n#   Public License for more details.\n#\n#   You should have received a copy of the GNU General Public License along\n#   with this program. If not, see <https://www.gnu.org/licenses/>.\n#\n#   As a special exception, the respective Autoconf Macro's copyright owner\n#   gives unlimited permission to copy, distribute and modify the configure\n#   scripts that are the output of Autoconf when processing the Macro. You\n#   need not follow the terms of the GNU General Public License when using\n#   or distributing such scripts, even though portions of the text of the\n#   Macro appear in them. The GNU General Public License (GPL) does govern\n#   all other use of the material that constitutes the Autoconf Macro.\n#\n#   This special exception to the GPL applies to versions of the Autoconf\n#   Macro released by the Autoconf Archive. When you make and distribute a\n#   modified version of the Autoconf Macro, you may extend this special\n#   exception to the GPL to apply to your modified version as well.\n\n#serial 21\n\nAU_ALIAS([AC_PYTHON_DEVEL], [AX_PYTHON_DEVEL])\nAC_DEFUN([AX_PYTHON_DEVEL],[\n\t#\n\t# Allow the use of a (user set) custom python version\n\t#\n\tAC_ARG_VAR([PYTHON_VERSION],[The installed Python\n\t\tversion to use, for example '2.3'. This string\n\t\twill be appended to the Python interpreter\n\t\tcanonical name.])\n\n\tAC_PATH_PROG([PYTHON],[python[$PYTHON_VERSION]])\n\tif test -z \"$PYTHON\"; then\n\t\tm4_ifvaln([$2],[$2],[\n\t\t\tAC_MSG_ERROR([Cannot find python$PYTHON_VERSION in your system path])\n\t\t\tPYTHON_VERSION=\"\"\n\t\t])\n\tfi\n\n\t#\n\t# Check for a version of Python >= 2.1.0\n\t#\n\tAC_MSG_CHECKING([for a version of Python >= '2.1.0'])\n\tac_supports_python_ver=`$PYTHON -c \"import sys; \\\n\t\tver = sys.version.split ()[[0]]; \\\n\t\tprint (ver >= '2.1.0')\"`\n\tif test \"$ac_supports_python_ver\" != \"True\"; then\n\t\tif test -z \"$PYTHON_NOVERSIONCHECK\"; then\n\t\t\tAC_MSG_RESULT([no])\n\t\t\tAC_MSG_FAILURE([\nThis version of the AC@&t@_PYTHON_DEVEL macro\ndoesn't work properly with versions of Python before\n2.1.0. You may need to re-run configure, setting the\nvariables PYTHON_CPPFLAGS, PYTHON_LIBS, PYTHON_SITE_PKG,\nPYTHON_EXTRA_LIBS and PYTHON_EXTRA_LDFLAGS by hand.\nMoreover, to disable this check, set PYTHON_NOVERSIONCHECK\nto something else than an empty string.\n])\n\t\telse\n\t\t\tAC_MSG_RESULT([skip at user request])\n\t\tfi\n\telse\n\t\tAC_MSG_RESULT([yes])\n\tfi\n\n\t#\n\t# If the macro parameter ``version'' is set, honour it.\n\t# A Python shim class, VPy, is used to implement correct version comparisons via\n\t# string expressions, since e.g. a naive textual \">= 2.7.3\" won't work for\n\t# Python 2.7.10 (the \".1\" being evaluated as less than \".3\").\n\t#\n\tif test -n \"$1\"; then\n\t\tAC_MSG_CHECKING([for a version of Python $1])\n                cat << EOF > ax_python_devel_vpy.py\nclass VPy:\n    def vtup(self, s):\n        return tuple(map(int, s.strip().replace(\"rc\", \".\").split(\".\")))\n    def __init__(self):\n        import sys\n        self.vpy = tuple(sys.version_info)\n    def __eq__(self, s):\n        return self.vpy == self.vtup(s)\n    def __ne__(self, s):\n        return self.vpy != self.vtup(s)\n    def __lt__(self, s):\n        return self.vpy < self.vtup(s)\n    def __gt__(self, s):\n        return self.vpy > self.vtup(s)\n    def __le__(self, s):\n        return self.vpy <= self.vtup(s)\n    def __ge__(self, s):\n        return self.vpy >= self.vtup(s)\nEOF\n\t\tac_supports_python_ver=`$PYTHON -c \"import ax_python_devel_vpy; \\\n                        ver = ax_python_devel_vpy.VPy(); \\\n\t\t\tprint (ver $1)\"`\n                rm -rf ax_python_devel_vpy*.py* __pycache__/ax_python_devel_vpy*.py*\n\t\tif test \"$ac_supports_python_ver\" = \"True\"; then\n\t\t\tAC_MSG_RESULT([yes])\n\t\telse\n\t\t\tAC_MSG_RESULT([no])\n\t\t\tAC_MSG_ERROR([this package requires Python $1.\nIf you have it installed, but it isn't the default Python\ninterpreter in your system path, please pass the PYTHON_VERSION\nvariable to configure. See ``configure --help'' for reference.\n])\n\t\t\tPYTHON_VERSION=\"\"\n\t\tfi\n\tfi\n\n\t#\n\t# Check for Python include path\n\t#\n\t#\n\tAC_MSG_CHECKING([for Python include path])\n\tif test -z \"$PYTHON_CPPFLAGS\"; then\n\t\tpython_path=`$PYTHON -c \"import sysconfig; \\\n\t\t\tprint (sysconfig.get_path('include'));\"`\n\t\tplat_python_path=`$PYTHON -c \"import sysconfig; \\\n\t\t\tprint (sysconfig.get_path('platinclude'));\"`\n\t\tif test -n \"${python_path}\"; then\n\t\t\tif test \"${plat_python_path}\" != \"${python_path}\"; then\n\t\t\t\tpython_path=\"-I$python_path -I$plat_python_path\"\n\t\t\telse\n\t\t\t\tpython_path=\"-I$python_path\"\n\t\t\tfi\n\t\tfi\n\t\tPYTHON_CPPFLAGS=$python_path\n\tfi\n\tAC_MSG_RESULT([$PYTHON_CPPFLAGS])\n\tAC_SUBST([PYTHON_CPPFLAGS])\n\n\t#\n\t# Check for Python library path\n\t#\n\tAC_MSG_CHECKING([for Python library path])\n\tif test -z \"$PYTHON_LIBS\"; then\n\t\t# (makes two attempts to ensure we've got a version number\n\t\t# from the interpreter)\n\t\tac_python_version=`cat<<EOD | $PYTHON -\n\n# join all versioning strings, on some systems\n# major/minor numbers could be in different list elements\nfrom sysconfig import *\ne = get_config_var('VERSION')\nif e is not None:\n\tprint(e)\nEOD`\n\n\t\tif test -z \"$ac_python_version\"; then\n\t\t\tif test -n \"$PYTHON_VERSION\"; then\n\t\t\t\tac_python_version=$PYTHON_VERSION\n\t\t\telse\n\t\t\t\tac_python_version=`$PYTHON -c \"import sys; \\\n\t\t\t\t\tprint ('.'.join(sys.version.split('.')[[:2]]))\"`\n\t\t\tfi\n\t\tfi\n\n\t\t# Make the versioning information available to the compiler\n\t\tAC_DEFINE_UNQUOTED([HAVE_PYTHON], [\"$ac_python_version\"],\n                                   [If available, contains the Python version number currently in use.])\n\n\t\t# First, the library directory:\n\t\tac_python_libdir=`cat<<EOD | $PYTHON -\n\n# There should be only one\nimport sysconfig\ne = sysconfig.get_config_var('LIBDIR')\nif e is not None:\n\tprint (e)\nEOD`\n\n\t\t# Now, for the library:\n\t\tac_python_library=`cat<<EOD | $PYTHON -\n\nimport sysconfig\nc = sysconfig.get_config_vars()\nif 'LDVERSION' in c:\n\tprint ('python'+c[['LDVERSION']])\nelse:\n\tprint ('python'+c[['VERSION']])\nEOD`\n\n\t\t# This small piece shamelessly adapted from PostgreSQL python macro;\n\t\t# credits goes to momjian, I think. I'd like to put the right name\n\t\t# in the credits, if someone can point me in the right direction... ?\n\t\t#\n\t\tif test -n \"$ac_python_libdir\" -a -n \"$ac_python_library\"\n\t\tthen\n\t\t\t# use the official shared library\n\t\t\tac_python_library=`echo \"$ac_python_library\" | sed \"s/^lib//\"`\n\t\t\tPYTHON_LIBS=\"-L$ac_python_libdir -l$ac_python_library\"\n\t\telse\n\t\t\t# old way: use libpython from python_configdir\n\t\t\tac_python_libdir=`$PYTHON -c \\\n\t\t\t  \"import sysconfig; \\\n\t\t\t  import os; \\\n\t\t\t  print (os.path.join(sysconfig.get_path('platstdlib'), 'config'));\"`\n\t\t\tPYTHON_LIBS=\"-L$ac_python_libdir -lpython$ac_python_version\"\n\t\tfi\n\n\t\tif test -z \"PYTHON_LIBS\"; then\n\t\t\tm4_ifvaln([$2],[$2],[\n\t\t\t\tAC_MSG_ERROR([\n  Cannot determine location of your Python DSO. Please check it was installed with\n  dynamic libraries enabled, or try setting PYTHON_LIBS by hand.\n\t\t\t\t])\n\t\t\t])\n\t\tfi\n\tfi\n\tAC_MSG_RESULT([$PYTHON_LIBS])\n\tAC_SUBST([PYTHON_LIBS])\n\n\t#\n\t# Check for site packages\n\t#\n\tAC_MSG_CHECKING([for Python site-packages path])\n\tif test -z \"$PYTHON_SITE_PKG\"; then\n\t\tPYTHON_SITE_PKG=`$PYTHON -c \"import distutils.sysconfig; \\\n\t\t\tprint (distutils.sysconfig.get_python_lib(0,0));\" 2>/dev/null || \\\n\t\t\t$PYTHON -c \"import sysconfig; \\\n\t\t\tprint (sysconfig.get_path('purelib'));\"`\n\tfi\n\tAC_MSG_RESULT([$PYTHON_SITE_PKG])\n\tAC_SUBST([PYTHON_SITE_PKG])\n\n\t#\n\t# libraries which must be linked in when embedding\n\t#\n\tAC_MSG_CHECKING(python extra libraries)\n\tif test -z \"$PYTHON_EXTRA_LIBS\"; then\n\t   PYTHON_EXTRA_LIBS=`$PYTHON -c \"import sysconfig; \\\n                conf = sysconfig.get_config_var; \\\n                print (conf('LIBS') + ' ' + conf('SYSLIBS'))\"`\n\tfi\n\tAC_MSG_RESULT([$PYTHON_EXTRA_LIBS])\n\tAC_SUBST(PYTHON_EXTRA_LIBS)\n\n\t#\n\t# linking flags needed when embedding\n\t#\n\tAC_MSG_CHECKING(python extra linking flags)\n\tif test -z \"$PYTHON_EXTRA_LDFLAGS\"; then\n\t\tPYTHON_EXTRA_LDFLAGS=`$PYTHON -c \"import sysconfig; \\\n\t\t\tconf = sysconfig.get_config_var; \\\n\t\t\tprint (conf('LINKFORSHARED'))\"`\n\tfi\n\tAC_MSG_RESULT([$PYTHON_EXTRA_LDFLAGS])\n\tAC_SUBST(PYTHON_EXTRA_LDFLAGS)\n\n\t#\n\t# final check to see if everything compiles alright\n\t#\n\tAC_MSG_CHECKING([consistency of all components of python development environment])\n\t# save current global flags\n\tac_save_LIBS=\"$LIBS\"\n\tac_save_LDFLAGS=\"$LDFLAGS\"\n\tac_save_CPPFLAGS=\"$CPPFLAGS\"\n\tLIBS=\"$ac_save_LIBS $PYTHON_LIBS $PYTHON_EXTRA_LIBS $PYTHON_EXTRA_LIBS\"\n\tLDFLAGS=\"$ac_save_LDFLAGS $PYTHON_EXTRA_LDFLAGS\"\n\tCPPFLAGS=\"$ac_save_CPPFLAGS $PYTHON_CPPFLAGS\"\n\tAC_LANG_PUSH([C])\n\tAC_LINK_IFELSE([\n\t\tAC_LANG_PROGRAM([[#include <Python.h>]],\n\t\t\t\t[[Py_Initialize();]])\n\t\t],[pythonexists=yes],[pythonexists=no])\n\tAC_LANG_POP([C])\n\t# turn back to default flags\n\tCPPFLAGS=\"$ac_save_CPPFLAGS\"\n\tLIBS=\"$ac_save_LIBS\"\n\tLDFLAGS=\"$ac_save_LDFLAGS\"\n\n\tAC_MSG_RESULT([$pythonexists])\n\n        if test ! \"x$pythonexists\" = \"xyes\"; then\n\t\tm4_ifvaln([$2],[$2],[\n\t\t\tAC_MSG_FAILURE([\n  Could not link test program to Python. Maybe the main Python library has been\n  installed in some non-standard library path. If so, pass it to configure,\n  via the LIBS environment variable.\n  Example: ./configure LIBS=\"-L/usr/non-standard-path/python/lib\"\n  ============================================================================\n   ERROR!\n   You probably have to install the development version of the Python package\n   for your distribution.  The exact name of this package varies among them.\n  ============================================================================\n\t   ])\n\t\t\tPYTHON_VERSION=\"\"\n\t\t])\n\tfi\n\n\t#\n\t# all done!\n\t#\n])\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}