{
  "module_name": "kernel-setattr-prepare.m4",
  "hash_id": "1dc80a9479e5dd1d31f3c3b9eccf7a69a3b9a3c167d96d548921a3dc45db9851",
  "original_prompt": "Ingested from zfs-2.2.2/config/kernel-setattr-prepare.m4",
  "human_readable_source": "AC_DEFUN([ZFS_AC_KERNEL_SRC_SETATTR_PREPARE], [\n\tdnl #\n\tdnl # 4.9 API change\n\tdnl # The inode_change_ok() function has been renamed setattr_prepare()\n\tdnl # and updated to take a dentry rather than an inode.\n\tdnl #\n\tZFS_LINUX_TEST_SRC([setattr_prepare], [\n\t\t#include <linux/fs.h>\n\t], [\n\t\tstruct dentry *dentry = NULL;\n\t\tstruct iattr *attr = NULL;\n\t\tint error __attribute__ ((unused)) =\n\t\t\tsetattr_prepare(dentry, attr);\n\t])\n\n\tdnl #\n\tdnl # 5.12 API change\n\tdnl # The setattr_prepare() function has been changed to accept a new argument\n\tdnl # for struct user_namespace*\n\tdnl #\n\tZFS_LINUX_TEST_SRC([setattr_prepare_userns], [\n\t\t#include <linux/fs.h>\n\t], [\n\t\tstruct dentry *dentry = NULL;\n\t\tstruct iattr *attr = NULL;\n\t\tstruct user_namespace *userns = NULL;\n\t\tint error __attribute__ ((unused)) =\n\t\t\tsetattr_prepare(userns, dentry, attr);\n\t])\n\n\tdnl #\n\tdnl # 6.3 API change\n\tdnl # The first arg of setattr_prepare() is changed to struct mnt_idmap*\n\tdnl #\n\tZFS_LINUX_TEST_SRC([setattr_prepare_mnt_idmap], [\n\t\t#include <linux/fs.h>\n\t], [\n\t\tstruct dentry *dentry = NULL;\n\t\tstruct iattr *attr = NULL;\n\t\tstruct mnt_idmap *idmap = NULL;\n\t\tint error __attribute__ ((unused)) =\n\t\t\tsetattr_prepare(idmap, dentry, attr);\n\t])\n])\n\nAC_DEFUN([ZFS_AC_KERNEL_SETATTR_PREPARE], [\n\tAC_MSG_CHECKING([whether setattr_prepare() is available and accepts struct mnt_idmap*])\n\tZFS_LINUX_TEST_RESULT_SYMBOL([setattr_prepare_mnt_idmap],\n\t    [setattr_prepare], [fs/attr.c], [\n\t\tAC_MSG_RESULT(yes)\n\t\tAC_DEFINE(HAVE_SETATTR_PREPARE_IDMAP, 1,\n\t\t    [setattr_prepare() accepts mnt_idmap])\n\t], [\n\t\tAC_MSG_CHECKING([whether setattr_prepare() is available and accepts struct user_namespace*])\n\t\tZFS_LINUX_TEST_RESULT_SYMBOL([setattr_prepare_userns],\n\t\t    [setattr_prepare], [fs/attr.c], [\n\t\t\tAC_MSG_RESULT(yes)\n\t\t\tAC_DEFINE(HAVE_SETATTR_PREPARE_USERNS, 1,\n\t\t\t    [setattr_prepare() accepts user_namespace])\n\t\t], [\n\t\t\tAC_MSG_RESULT(no)\n\n\t\t\tAC_MSG_CHECKING([whether setattr_prepare() is available, doesn't accept user_namespace])\n\t\t\tZFS_LINUX_TEST_RESULT_SYMBOL([setattr_prepare],\n\t\t\t\t[setattr_prepare], [fs/attr.c], [\n\t\t\t\tAC_MSG_RESULT(yes)\n\t\t\t\tAC_DEFINE(HAVE_SETATTR_PREPARE_NO_USERNS, 1,\n\t\t\t\t\t[setattr_prepare() is available, doesn't accept user_namespace])\n\t\t\t], [\n\t\t\t\tAC_MSG_RESULT(no)\n\t\t\t])\n\t\t])\n\t])\n])\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}