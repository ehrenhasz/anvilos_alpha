{
  "module_name": "zfs-meta.m4",
  "hash_id": "f10b88bd19bc22dca96c1362c713dbbe784c487d273bfcf30e00ae371bc42bbb",
  "original_prompt": "Ingested from zfs-2.2.2/config/zfs-meta.m4",
  "human_readable_source": "dnl #\ndnl # DESCRIPTION:\ndnl # Read meta data from the META file.  When building from a git repository\ndnl # the ZFS_META_RELEASE field will be overwritten if there is an annotated\ndnl # tag matching the form ZFS_META_NAME-ZFS_META_VERSION-*.  This allows\ndnl # for working builds to be uniquely identified using the git commit hash.\ndnl #\ndnl #    The META file format is as follows:\ndnl #      ^[ ]*KEY:[ \\t]+VALUE$\ndnl #\ndnl #    In other words:\ndnl #    - KEY is separated from VALUE by a colon and one or more spaces/tabs.\ndnl #    - KEY and VALUE are case sensitive.\ndnl #    - Leading spaces are ignored.\ndnl #    - First match wins for duplicate keys.\ndnl #\ndnl #    A line can be commented out by preceding it with a '#' (or technically\ndnl #    any non-space character since that will prevent the regex from\ndnl #    matching).\ndnl #\ndnl # WARNING:\ndnl #   Placing a colon followed by a space or tab (ie, \":[ \\t]+\") within the\ndnl #   VALUE will prematurely terminate the string since that sequence is\ndnl #   used as the awk field separator.\ndnl #\ndnl # KEYS:\ndnl #   The following META keys are recognized:\ndnl #     Name, Version, Release, Date, Author, LT_Current, LT_Revision, LT_Age\ndnl #\ndnl # Written by Chris Dunlap <cdunlap@llnl.gov>.\ndnl # Modified by Brian Behlendorf <behlendorf1@llnl.gov>.\ndnl #\nAC_DEFUN([ZFS_AC_META], [\n\n\tAH_BOTTOM([\n#undef PACKAGE\n#undef PACKAGE_BUGREPORT\n#undef PACKAGE_NAME\n#undef PACKAGE_STRING\n#undef PACKAGE_TARNAME\n#undef PACKAGE_VERSION\n#undef STDC_HEADERS\n#undef VERSION])\n\n\tAC_PROG_AWK\n\tAC_MSG_CHECKING([metadata])\n\n\tMETA=\"$srcdir/META\"\n\t_zfs_ac_meta_type=\"none\"\n\tif test -f \"$META\"; then\n\t\t_zfs_ac_meta_type=\"META file\"\n\n\t\tZFS_META_NAME=_ZFS_AC_META_GETVAL([(Name|Project|Package)]);\n\t\tif test -n \"$ZFS_META_NAME\"; then\n\t\t\tAC_DEFINE_UNQUOTED([ZFS_META_NAME], [\"$ZFS_META_NAME\"],\n\t\t\t\t[Define the project name.]\n\t\t\t)\n\t\t\tAC_SUBST([ZFS_META_NAME])\n\t\tfi\n\n\t\tZFS_META_VERSION=_ZFS_AC_META_GETVAL([Version]);\n\t\tif test -n \"$ZFS_META_VERSION\"; then\n\t\t\tAC_DEFINE_UNQUOTED([ZFS_META_VERSION],\n\t\t\t    [\"$ZFS_META_VERSION\"],\n\t\t\t    [Define the project version.])\n\t\t\tAC_DEFINE_UNQUOTED([SPL_META_VERSION],\n\t\t\t    [ZFS_META_VERSION],\n\t\t\t    [Defined for legacy compatibility.])\n\t\t\tAC_SUBST([ZFS_META_VERSION])\n\t\tfi\n\n\t\tZFS_META_RELEASE=_ZFS_AC_META_GETVAL([Release]);\n\t\tif test ! -f \".nogitrelease\" && git rev-parse --git-dir > /dev/null 2>&1; then\n\t\t\t_match=\"${ZFS_META_NAME}-${ZFS_META_VERSION}\"\n\t\t\t_alias=$(git describe --match=${_match} 2>/dev/null)\n\t\t\t_release=$(echo ${_alias}|sed \"s/${ZFS_META_NAME}//\"|cut -f3- -d'-'|tr - _)\n\t\t\tif test -n \"${_release}\"; then\n\t\t\t\tZFS_META_RELEASE=${_release}\n\t\t\t\t_zfs_ac_meta_type=\"git describe\"\n\t\t\telse\n\t\t\t\t_match=\"${ZFS_META_NAME}-${ZFS_META_VERSION}-${ZFS_META_RELEASE}\"\n\t                        _alias=$(git describe --match=${_match} 2>/dev/null)\n\t\t\t\t_release=$(echo ${_alias}|sed 's/${ZFS_META_NAME}//'|cut -f3- -d'-'|tr - _)\n\t\t\t\tif test -n \"${_release}\"; then\n\t\t\t\t\tZFS_META_RELEASE=${_release}\n\t\t\t\t\t_zfs_ac_meta_type=\"git describe\"\n\t\t\t\tfi\n\t\t\tfi\n\t\tfi\n\n\t\tif test -n \"$ZFS_META_RELEASE\"; then\n\t\t\tAC_DEFINE_UNQUOTED([ZFS_META_RELEASE],\n\t\t\t     [\"$ZFS_META_RELEASE\"],\n\t\t\t     [Define the project release.])\n\t\t\tAC_DEFINE_UNQUOTED([SPL_META_RELEASE],\n\t\t\t    [ZFS_META_RELEASE],\n\t\t\t    [Defined for legacy compatibility.])\n\t\t\tAC_SUBST([ZFS_META_RELEASE])\n\n\t\t\tRELEASE=\"$ZFS_META_RELEASE\"\n\t\t\tAC_SUBST([RELEASE])\n\t\tfi\n\n\t\tZFS_META_LICENSE=_ZFS_AC_META_GETVAL([License]);\n\t\tif test -n \"$ZFS_META_LICENSE\"; then\n\t\t\tAC_DEFINE_UNQUOTED([ZFS_META_LICENSE], [\"$ZFS_META_LICENSE\"],\n\t\t\t\t[Define the project license.]\n\t\t\t)\n\t\t\tAC_SUBST([ZFS_META_LICENSE])\n\t\tfi\n\n\t\tif test -n \"$ZFS_META_NAME\" -a -n \"$ZFS_META_VERSION\"; then\n\t\t\t\tZFS_META_ALIAS=\"$ZFS_META_NAME-$ZFS_META_VERSION\"\n\t\t\t\ttest -n \"$ZFS_META_RELEASE\" && \n\t\t\t\t        ZFS_META_ALIAS=\"$ZFS_META_ALIAS-$ZFS_META_RELEASE\"\n\t\t\t\tAC_DEFINE_UNQUOTED([ZFS_META_ALIAS],\n\t\t\t\t    [\"$ZFS_META_ALIAS\"],\n\t\t\t\t    [Define the project alias string.])\n\t\t\t\tAC_DEFINE_UNQUOTED([SPL_META_ALIAS],\n\t\t\t\t    [ZFS_META_ALIAS],\n\t\t\t\t    [Defined for legacy compatibility.])\n\t\t\t\tAC_SUBST([ZFS_META_ALIAS])\n\t\tfi\n\n\t\tZFS_META_DATA=_ZFS_AC_META_GETVAL([Date]);\n\t\tif test -n \"$ZFS_META_DATA\"; then\n\t\t\tAC_DEFINE_UNQUOTED([ZFS_META_DATA], [\"$ZFS_META_DATA\"],\n\t\t\t\t[Define the project release date.] \n\t\t\t)\n\t\t\tAC_SUBST([ZFS_META_DATA])\n\t\tfi\n\n\t\tZFS_META_AUTHOR=_ZFS_AC_META_GETVAL([Author]);\n\t\tif test -n \"$ZFS_META_AUTHOR\"; then\n\t\t\tAC_DEFINE_UNQUOTED([ZFS_META_AUTHOR], [\"$ZFS_META_AUTHOR\"],\n\t\t\t\t[Define the project author.]\n\t\t\t)\n\t\t\tAC_SUBST([ZFS_META_AUTHOR])\n\t\tfi\n\n\t\tZFS_META_KVER_MIN=_ZFS_AC_META_GETVAL([Linux-Minimum]);\n\t\tif test -n \"$ZFS_META_KVER_MIN\"; then\n\t\t\tAC_DEFINE_UNQUOTED([ZFS_META_KVER_MIN],\n\t\t\t    [\"$ZFS_META_KVER_MIN\"],\n\t\t\t    [Define the minimum compatible kernel version.]\n\t\t\t)\n\t\t\tAC_SUBST([ZFS_META_KVER_MIN])\n\t\tfi\n\n\t\tZFS_META_KVER_MAX=_ZFS_AC_META_GETVAL([Linux-Maximum]);\n\t\tif test -n \"$ZFS_META_KVER_MAX\"; then\n\t\t\tAC_DEFINE_UNQUOTED([ZFS_META_KVER_MAX],\n\t\t\t    [\"$ZFS_META_KVER_MAX\"],\n\t\t\t    [Define the maximum compatible kernel version.]\n\t\t\t)\n\t\t\tAC_SUBST([ZFS_META_KVER_MAX])\n\t\tfi\n\n\t\tm4_pattern_allow([^LT_(CURRENT|REVISION|AGE)$])\n\t\tZFS_META_LT_CURRENT=_ZFS_AC_META_GETVAL([LT_Current]);\n\t\tZFS_META_LT_REVISION=_ZFS_AC_META_GETVAL([LT_Revision]);\n\t\tZFS_META_LT_AGE=_ZFS_AC_META_GETVAL([LT_Age]);\n\t\tif test -n \"$ZFS_META_LT_CURRENT\" \\\n\t\t\t\t -o -n \"$ZFS_META_LT_REVISION\" \\\n\t\t\t\t -o -n \"$ZFS_META_LT_AGE\"; then\n\t\t\ttest -n \"$ZFS_META_LT_CURRENT\" || ZFS_META_LT_CURRENT=\"0\"\n\t\t\ttest -n \"$ZFS_META_LT_REVISION\" || ZFS_META_LT_REVISION=\"0\"\n\t\t\ttest -n \"$ZFS_META_LT_AGE\" || ZFS_META_LT_AGE=\"0\"\n\t\t\tAC_DEFINE_UNQUOTED([ZFS_META_LT_CURRENT],\n\t\t\t\t[\"$ZFS_META_LT_CURRENT\"],\n\t\t\t\t[Define the libtool library 'current'\n\t\t\t\t version information.]\n\t\t\t)\n\t\t\tAC_DEFINE_UNQUOTED([ZFS_META_LT_REVISION],\n\t\t\t\t[\"$ZFS_META_LT_REVISION\"],\n\t\t\t\t[Define the libtool library 'revision'\n\t\t\t\t version information.]\n\t\t\t)\n\t\t\tAC_DEFINE_UNQUOTED([ZFS_META_LT_AGE], [\"$ZFS_META_LT_AGE\"],\n\t\t\t\t[Define the libtool library 'age' \n\t\t\t\t version information.]\n\t\t\t)\n\t\t\tAC_SUBST([ZFS_META_LT_CURRENT])\n\t\t\tAC_SUBST([ZFS_META_LT_REVISION])\n\t\t\tAC_SUBST([ZFS_META_LT_AGE])\n\t\tfi\n\tfi\n\n\tAC_MSG_RESULT([$_zfs_ac_meta_type])\n\t]\n)\n\ndnl # _ZFS_AC_META_GETVAL (KEY_NAME_OR_REGEX)\ndnl #\ndnl # Returns the META VALUE associated with the given KEY_NAME_OR_REGEX expr.\ndnl #\ndnl # Despite their resemblance to line noise,\ndnl #   the \"@<:@\" and \"@:>@\" constructs are quadrigraphs for \"[\" and \"]\".\ndnl #   <www.gnu.org/software/autoconf/manual/autoconf.html#Quadrigraphs>\ndnl #\ndnl # The \"$[]1\" and \"$[]2\" constructs prevent M4 parameter expansion\ndnl #   so a literal $1 and $2 will be passed to the resulting awk script,\ndnl #   whereas the \"$1\" will undergo M4 parameter expansion for the META key.\ndnl #\nAC_DEFUN([_ZFS_AC_META_GETVAL],\n\t[`$AWK -F ':@<:@ \\t@:>@+' '$[]1 ~ /^ *$1$/ { print $[]2; exit }' $META`]dnl\n)\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}