{
  "module_name": "blake3_zfs.c",
  "hash_id": "b184149dd78172b5338f2472c0934246f24aa02a4778adc6b0bd20cb082debb1",
  "original_prompt": "Ingested from zfs-2.2.2/module/zfs/blake3_zfs.c",
  "human_readable_source": " \n\n \n\n#include <sys/zfs_context.h>\n#include <sys/zio_checksum.h>\n#include <sys/blake3.h>\n#include <sys/abd.h>\n\nstatic int\nblake3_incremental(void *buf, size_t size, void *arg)\n{\n\tBLAKE3_CTX *ctx = arg;\n\n\tBlake3_Update(ctx, buf, size);\n\n\treturn (0);\n}\n\n \nvoid\nabd_checksum_blake3_native(abd_t *abd, uint64_t size, const void *ctx_template,\n    zio_cksum_t *zcp)\n{\n\tASSERT(ctx_template != NULL);\n\n#if defined(_KERNEL)\n\tkpreempt_disable();\n\tBLAKE3_CTX *ctx = blake3_per_cpu_ctx[CPU_SEQID];\n#else\n\tBLAKE3_CTX *ctx = kmem_alloc(sizeof (*ctx), KM_SLEEP);\n#endif\n\n\tmemcpy(ctx, ctx_template, sizeof (*ctx));\n\t(void) abd_iterate_func(abd, 0, size, blake3_incremental, ctx);\n\tBlake3_Final(ctx, (uint8_t *)zcp);\n\n#if defined(_KERNEL)\n\tkpreempt_enable();\n#else\n\tmemset(ctx, 0, sizeof (*ctx));\n\tkmem_free(ctx, sizeof (*ctx));\n#endif\n}\n\n \nvoid\nabd_checksum_blake3_byteswap(abd_t *abd, uint64_t size,\n    const void *ctx_template, zio_cksum_t *zcp)\n{\n\tzio_cksum_t tmp;\n\n\tASSERT(ctx_template != NULL);\n\n\tabd_checksum_blake3_native(abd, size, ctx_template, &tmp);\n\tzcp->zc_word[0] = BSWAP_64(tmp.zc_word[0]);\n\tzcp->zc_word[1] = BSWAP_64(tmp.zc_word[1]);\n\tzcp->zc_word[2] = BSWAP_64(tmp.zc_word[2]);\n\tzcp->zc_word[3] = BSWAP_64(tmp.zc_word[3]);\n}\n\n \nvoid *\nabd_checksum_blake3_tmpl_init(const zio_cksum_salt_t *salt)\n{\n\tBLAKE3_CTX *ctx;\n\n\tASSERT(sizeof (salt->zcs_bytes) == 32);\n\n\t \n\tctx = kmem_zalloc(sizeof (*ctx), KM_SLEEP);\n\tBlake3_InitKeyed(ctx, salt->zcs_bytes);\n\n\treturn (ctx);\n}\n\n \nvoid\nabd_checksum_blake3_tmpl_free(void *ctx_template)\n{\n\tBLAKE3_CTX *ctx = ctx_template;\n\n\tmemset(ctx, 0, sizeof (*ctx));\n\tkmem_free(ctx, sizeof (*ctx));\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}