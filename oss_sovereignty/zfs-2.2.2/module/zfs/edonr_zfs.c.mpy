{
  "module_name": "edonr_zfs.c",
  "hash_id": "e0d9990444f1f2e86fd3ec87dd72b3bf010d9027266b828d46186c029a33a721",
  "original_prompt": "Ingested from zfs-2.2.2/module/zfs/edonr_zfs.c",
  "human_readable_source": " \n \n \n#include <sys/zfs_context.h>\n#include <sys/zio.h>\n#include <sys/zio_checksum.h>\n#include <sys/edonr.h>\n#include <sys/abd.h>\n\n#define\tEDONR_MODE\t\t512\n#define\tEDONR_BLOCK_SIZE\tEdonR512_BLOCK_SIZE\n\nstatic int\nedonr_incremental(void *buf, size_t size, void *arg)\n{\n\tEdonRState *ctx = arg;\n\tEdonRUpdate(ctx, buf, size * 8);\n\treturn (0);\n}\n\n \nvoid\nabd_checksum_edonr_native(abd_t *abd, uint64_t size,\n    const void *ctx_template, zio_cksum_t *zcp)\n{\n\tuint8_t\t\tdigest[EDONR_MODE / 8];\n\tEdonRState\tctx;\n\n\tASSERT(ctx_template != NULL);\n\tmemcpy(&ctx, ctx_template, sizeof (ctx));\n\t(void) abd_iterate_func(abd, 0, size, edonr_incremental, &ctx);\n\tEdonRFinal(&ctx, digest);\n\tmemcpy(zcp->zc_word, digest, sizeof (zcp->zc_word));\n}\n\n \nvoid\nabd_checksum_edonr_byteswap(abd_t *abd, uint64_t size,\n    const void *ctx_template, zio_cksum_t *zcp)\n{\n\tzio_cksum_t\ttmp;\n\n\tabd_checksum_edonr_native(abd, size, ctx_template, &tmp);\n\tzcp->zc_word[0] = BSWAP_64(zcp->zc_word[0]);\n\tzcp->zc_word[1] = BSWAP_64(zcp->zc_word[1]);\n\tzcp->zc_word[2] = BSWAP_64(zcp->zc_word[2]);\n\tzcp->zc_word[3] = BSWAP_64(zcp->zc_word[3]);\n}\n\nvoid *\nabd_checksum_edonr_tmpl_init(const zio_cksum_salt_t *salt)\n{\n\tEdonRState\t*ctx;\n\tuint8_t\t\tsalt_block[EDONR_BLOCK_SIZE];\n\n\t \n\t_Static_assert(EDONR_BLOCK_SIZE == 2 * (EDONR_MODE / 8),\n\t    \"Edon-R block size mismatch\");\n\tEdonRHash(salt->zcs_bytes, sizeof (salt->zcs_bytes) * 8, salt_block);\n\tEdonRHash(salt_block, EDONR_MODE, salt_block + EDONR_MODE / 8);\n\n\t \n\tctx = kmem_zalloc(sizeof (*ctx), KM_SLEEP);\n\tEdonRInit(ctx);\n\tEdonRUpdate(ctx, salt_block, sizeof (salt_block) * 8);\n\treturn (ctx);\n}\n\nvoid\nabd_checksum_edonr_tmpl_free(void *ctx_template)\n{\n\tEdonRState *ctx = ctx_template;\n\n\tmemset(ctx, 0, sizeof (*ctx));\n\tkmem_free(ctx, sizeof (*ctx));\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}