{
  "module_name": "zfs_byteswap.c",
  "hash_id": "919196ce090033e428f040f7b3caf8df17fd321ba98b88b4ad7cab394736c862",
  "original_prompt": "Ingested from zfs-2.2.2/module/zfs/zfs_byteswap.c",
  "human_readable_source": " \n \n\n#include <sys/zfs_context.h>\n#include <sys/vfs.h>\n#include <sys/fs/zfs.h>\n#include <sys/zfs_znode.h>\n#include <sys/zfs_sa.h>\n#include <sys/zfs_acl.h>\n\n#ifndef _KERNEL\nstatic\n#endif\nvoid\nzfs_oldace_byteswap(ace_t *ace, int ace_cnt)\n{\n\tfor (int i = 0; i != ace_cnt; i++, ace++) {\n\t\tace->a_who = BSWAP_32(ace->a_who);\n\t\tace->a_access_mask = BSWAP_32(ace->a_access_mask);\n\t\tace->a_flags = BSWAP_16(ace->a_flags);\n\t\tace->a_type = BSWAP_16(ace->a_type);\n\t}\n}\n\n \n#ifndef _KERNEL\nstatic\n#endif\nvoid\nzfs_ace_byteswap(void *buf, size_t size, boolean_t zfs_layout)\n{\n\tcaddr_t end;\n\tcaddr_t ptr;\n\tzfs_ace_t *zacep = NULL;\n\tace_t *acep;\n\tuint16_t entry_type;\n\tsize_t entry_size;\n\tint ace_type;\n\n\tend = (caddr_t)buf + size;\n\tptr = buf;\n\n\twhile (ptr < end) {\n\t\tif (zfs_layout) {\n\t\t\t \n\t\t\tif (ptr + sizeof (zfs_ace_hdr_t) > end) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tzacep = (zfs_ace_t *)ptr;\n\t\t\tzacep->z_hdr.z_access_mask =\n\t\t\t    BSWAP_32(zacep->z_hdr.z_access_mask);\n\t\t\tzacep->z_hdr.z_flags = BSWAP_16(zacep->z_hdr.z_flags);\n\t\t\tace_type = zacep->z_hdr.z_type =\n\t\t\t    BSWAP_16(zacep->z_hdr.z_type);\n\t\t\tentry_type = zacep->z_hdr.z_flags & ACE_TYPE_FLAGS;\n\t\t} else {\n\t\t\t \n\t\t\tif (ptr + sizeof (ace_t) > end) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tacep = (ace_t *)ptr;\n\t\t\tacep->a_access_mask = BSWAP_32(acep->a_access_mask);\n\t\t\tacep->a_flags = BSWAP_16(acep->a_flags);\n\t\t\tace_type = acep->a_type = BSWAP_16(acep->a_type);\n\t\t\tacep->a_who = BSWAP_32(acep->a_who);\n\t\t\tentry_type = acep->a_flags & ACE_TYPE_FLAGS;\n\t\t}\n\t\tswitch (entry_type) {\n\t\tcase ACE_OWNER:\n\t\tcase ACE_EVERYONE:\n\t\tcase (ACE_IDENTIFIER_GROUP | ACE_GROUP):\n\t\t\tentry_size = zfs_layout ?\n\t\t\t    sizeof (zfs_ace_hdr_t) : sizeof (ace_t);\n\t\t\tbreak;\n\t\tcase ACE_IDENTIFIER_GROUP:\n\t\tdefault:\n\t\t\t \n\t\t\tif (zfs_layout) {\n\t\t\t\tif (ptr + sizeof (zfs_ace_t) <= end) {\n\t\t\t\t\tzacep->z_fuid = BSWAP_64(zacep->z_fuid);\n\t\t\t\t} else {\n\t\t\t\t\tentry_size = sizeof (zfs_ace_t);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tswitch (ace_type) {\n\t\t\tcase ACE_ACCESS_ALLOWED_OBJECT_ACE_TYPE:\n\t\t\tcase ACE_ACCESS_DENIED_OBJECT_ACE_TYPE:\n\t\t\tcase ACE_SYSTEM_AUDIT_OBJECT_ACE_TYPE:\n\t\t\tcase ACE_SYSTEM_ALARM_OBJECT_ACE_TYPE:\n\t\t\t\tentry_size = zfs_layout ?\n\t\t\t\t    sizeof (zfs_object_ace_t) :\n\t\t\t\t    sizeof (ace_object_t);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tentry_size = zfs_layout ? sizeof (zfs_ace_t) :\n\t\t\t\t    sizeof (ace_t);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tptr = ptr + entry_size;\n\t}\n}\n\nvoid\nzfs_oldacl_byteswap(void *buf, size_t size)\n{\n\t \n\tzfs_oldace_byteswap((ace_t *)buf, size / sizeof (ace_t));\n}\n\nvoid\nzfs_acl_byteswap(void *buf, size_t size)\n{\n\tzfs_ace_byteswap(buf, size, B_TRUE);\n}\n\nvoid\nzfs_znode_byteswap(void *buf, size_t size)\n{\n\tznode_phys_t *zp = buf;\n\n\tASSERT(size >= sizeof (znode_phys_t));\n\n\tzp->zp_crtime[0] = BSWAP_64(zp->zp_crtime[0]);\n\tzp->zp_crtime[1] = BSWAP_64(zp->zp_crtime[1]);\n\tzp->zp_atime[0] = BSWAP_64(zp->zp_atime[0]);\n\tzp->zp_atime[1] = BSWAP_64(zp->zp_atime[1]);\n\tzp->zp_mtime[0] = BSWAP_64(zp->zp_mtime[0]);\n\tzp->zp_mtime[1] = BSWAP_64(zp->zp_mtime[1]);\n\tzp->zp_ctime[0] = BSWAP_64(zp->zp_ctime[0]);\n\tzp->zp_ctime[1] = BSWAP_64(zp->zp_ctime[1]);\n\tzp->zp_gen = BSWAP_64(zp->zp_gen);\n\tzp->zp_mode = BSWAP_64(zp->zp_mode);\n\tzp->zp_size = BSWAP_64(zp->zp_size);\n\tzp->zp_parent = BSWAP_64(zp->zp_parent);\n\tzp->zp_links = BSWAP_64(zp->zp_links);\n\tzp->zp_xattr = BSWAP_64(zp->zp_xattr);\n\tzp->zp_rdev = BSWAP_64(zp->zp_rdev);\n\tzp->zp_flags = BSWAP_64(zp->zp_flags);\n\tzp->zp_uid = BSWAP_64(zp->zp_uid);\n\tzp->zp_gid = BSWAP_64(zp->zp_gid);\n\tzp->zp_zap = BSWAP_64(zp->zp_zap);\n\tzp->zp_pad[0] = BSWAP_64(zp->zp_pad[0]);\n\tzp->zp_pad[1] = BSWAP_64(zp->zp_pad[1]);\n\tzp->zp_pad[2] = BSWAP_64(zp->zp_pad[2]);\n\n\tzp->zp_acl.z_acl_extern_obj = BSWAP_64(zp->zp_acl.z_acl_extern_obj);\n\tzp->zp_acl.z_acl_size = BSWAP_32(zp->zp_acl.z_acl_size);\n\tzp->zp_acl.z_acl_version = BSWAP_16(zp->zp_acl.z_acl_version);\n\tzp->zp_acl.z_acl_count = BSWAP_16(zp->zp_acl.z_acl_count);\n\tif (zp->zp_acl.z_acl_version == ZFS_ACL_VERSION) {\n\t\tzfs_acl_byteswap((void *)&zp->zp_acl.z_ace_data[0],\n\t\t    ZFS_ACE_SPACE);\n\t} else {\n\t\tzfs_oldace_byteswap((ace_t *)&zp->zp_acl.z_ace_data[0],\n\t\t    ACE_SLOT_CNT);\n\t}\n}\n\n#if defined(_KERNEL)\nEXPORT_SYMBOL(zfs_oldacl_byteswap);\nEXPORT_SYMBOL(zfs_acl_byteswap);\nEXPORT_SYMBOL(zfs_znode_byteswap);\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}