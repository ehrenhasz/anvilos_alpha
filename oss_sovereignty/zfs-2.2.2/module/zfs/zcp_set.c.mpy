{
  "module_name": "zcp_set.c",
  "hash_id": "9090364d69e5d5e427ff002fce4ae798bbf7055d2a5898c2a248530fea23baf0",
  "original_prompt": "Ingested from zfs-2.2.2/module/zfs/zcp_set.c",
  "human_readable_source": " \n\n \n\n#include <sys/lua/lua.h>\n#include <sys/lua/lualib.h>\n#include <sys/lua/lauxlib.h>\n\n#include <sys/dsl_prop.h>\n#include <sys/dsl_dir.h>\n#include <sys/dsl_synctask.h>\n#include <sys/dsl_dataset.h>\n#include <sys/zcp.h>\n#include <sys/zcp_set.h>\n#include <sys/zcp_iter.h>\n#include <sys/zcp_global.h>\n#include <sys/zvol.h>\n\n#include <zfs_prop.h>\n\nstatic void\nzcp_set_user_prop(lua_State *state, dsl_pool_t *dp, const char *dsname,\n    const char *prop_name, const char *prop_val, dmu_tx_t *tx)\n{\n\tdsl_dataset_t *ds = zcp_dataset_hold(state, dp, dsname, FTAG);\n\tif (ds == NULL)\n\t\treturn;  \n\n\tnvlist_t *nvl = fnvlist_alloc();\n\tfnvlist_add_string(nvl, prop_name, prop_val);\n\n\tdsl_props_set_sync_impl(ds, ZPROP_SRC_LOCAL, nvl, tx);\n\n\tfnvlist_free(nvl);\n\tdsl_dataset_rele(ds, FTAG);\n}\n\nint\nzcp_set_prop_check(void *arg, dmu_tx_t *tx)\n{\n\tzcp_set_prop_arg_t *args = arg;\n\tconst char *prop_name = args->prop;\n\tdsl_props_set_arg_t dpsa = {\n\t\t.dpsa_dsname = args->dsname,\n\t\t.dpsa_source = ZPROP_SRC_LOCAL,\n\t};\n\tnvlist_t *nvl = NULL;\n\tint ret = 0;\n\n\t \n\tif (!zfs_prop_user(prop_name)) {\n\t\treturn (EINVAL);\n\t}\n\n\tnvl = fnvlist_alloc();\n\tfnvlist_add_string(nvl, args->prop, args->val);\n\tdpsa.dpsa_props = nvl;\n\n\tret = dsl_props_set_check(&dpsa, tx);\n\tnvlist_free(nvl);\n\n\treturn (ret);\n}\n\nvoid\nzcp_set_prop_sync(void *arg, dmu_tx_t *tx)\n{\n\tzcp_set_prop_arg_t *args = arg;\n\tzcp_run_info_t *ri = zcp_run_info(args->state);\n\tdsl_pool_t *dp = ri->zri_pool;\n\n\tconst char *dsname = args->dsname;\n\tconst char *prop_name = args->prop;\n\tconst char *prop_val = args->val;\n\n\tif (zfs_prop_user(prop_name)) {\n\t\tzcp_set_user_prop(args->state, dp, dsname, prop_name,\n\t\t    prop_val, tx);\n\t}\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}