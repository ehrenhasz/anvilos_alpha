{
  "module_name": "sha2_zfs.c",
  "hash_id": "39895b29e363c32f15196690cc66426d8c8b89426651fb2c0cce9a617b2238be",
  "original_prompt": "Ingested from zfs-2.2.2/module/zfs/sha2_zfs.c",
  "human_readable_source": " \n\n \n\n#include <sys/zfs_context.h>\n#include <sys/zio_checksum.h>\n#include <sys/sha2.h>\n#include <sys/abd.h>\n#include <sys/qat.h>\n\nstatic int\nsha_incremental(void *buf, size_t size, void *arg)\n{\n\tSHA2_CTX *ctx = arg;\n\tSHA2Update(ctx, buf, size);\n\treturn (0);\n}\n\nvoid\nabd_checksum_sha256(abd_t *abd, uint64_t size,\n    const void *ctx_template, zio_cksum_t *zcp)\n{\n\t(void) ctx_template;\n\tint ret;\n\tSHA2_CTX ctx;\n\tzio_cksum_t tmp;\n\n\tif (qat_checksum_use_accel(size)) {\n\t\tuint8_t *buf = abd_borrow_buf_copy(abd, size);\n\t\tret = qat_checksum(ZIO_CHECKSUM_SHA256, buf, size, &tmp);\n\t\tabd_return_buf(abd, buf, size);\n\t\tif (ret == CPA_STATUS_SUCCESS)\n\t\t\tgoto bswap;\n\n\t\t \n\t}\n\n\tSHA2Init(SHA256, &ctx);\n\t(void) abd_iterate_func(abd, 0, size, sha_incremental, &ctx);\n\tSHA2Final(&tmp, &ctx);\n\nbswap:\n\t \n\tzcp->zc_word[0] = BE_64(tmp.zc_word[0]);\n\tzcp->zc_word[1] = BE_64(tmp.zc_word[1]);\n\tzcp->zc_word[2] = BE_64(tmp.zc_word[2]);\n\tzcp->zc_word[3] = BE_64(tmp.zc_word[3]);\n}\n\nvoid\nabd_checksum_sha512_native(abd_t *abd, uint64_t size,\n    const void *ctx_template, zio_cksum_t *zcp)\n{\n\t(void) ctx_template;\n\tSHA2_CTX\tctx;\n\n\tSHA2Init(SHA512_256, &ctx);\n\t(void) abd_iterate_func(abd, 0, size, sha_incremental, &ctx);\n\tSHA2Final(zcp, &ctx);\n}\n\nvoid\nabd_checksum_sha512_byteswap(abd_t *abd, uint64_t size,\n    const void *ctx_template, zio_cksum_t *zcp)\n{\n\tzio_cksum_t\ttmp;\n\n\tabd_checksum_sha512_native(abd, size, ctx_template, &tmp);\n\tzcp->zc_word[0] = BSWAP_64(tmp.zc_word[0]);\n\tzcp->zc_word[1] = BSWAP_64(tmp.zc_word[1]);\n\tzcp->zc_word[2] = BSWAP_64(tmp.zc_word[2]);\n\tzcp->zc_word[3] = BSWAP_64(tmp.zc_word[3]);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}