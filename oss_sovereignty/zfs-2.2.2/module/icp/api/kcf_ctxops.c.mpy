{
  "module_name": "kcf_ctxops.c",
  "hash_id": "b5e3d39da99b10178cbb550975a15d9e0944d406b159f3fde2a7fb701aa3e53d",
  "original_prompt": "Ingested from zfs-2.2.2/module/icp/api/kcf_ctxops.c",
  "human_readable_source": " \n \n\n#include <sys/zfs_context.h>\n#include <sys/crypto/common.h>\n#include <sys/crypto/impl.h>\n#include <sys/crypto/api.h>\n#include <sys/crypto/spi.h>\n#include <sys/crypto/sched_impl.h>\n\n \n\n \nint\ncrypto_create_ctx_template(crypto_mechanism_t *mech, crypto_key_t *key,\n    crypto_ctx_template_t *ptmpl)\n{\n\tint error;\n\tkcf_mech_entry_t *me;\n\tkcf_provider_desc_t *pd;\n\tkcf_ctx_template_t *ctx_tmpl;\n\tcrypto_mechanism_t prov_mech;\n\n\t \n\n\tif (ptmpl == NULL)\n\t\treturn (CRYPTO_ARGUMENTS_BAD);\n\n\tif (mech == NULL)\n\t\treturn (CRYPTO_MECHANISM_INVALID);\n\n\terror = kcf_get_sw_prov(mech->cm_type, &pd, &me, B_TRUE);\n\tif (error != CRYPTO_SUCCESS)\n\t\treturn (error);\n\n\tif ((ctx_tmpl = kmem_alloc(\n\t    sizeof (kcf_ctx_template_t), KM_SLEEP)) == NULL) {\n\t\tKCF_PROV_REFRELE(pd);\n\t\treturn (CRYPTO_HOST_MEMORY);\n\t}\n\n\t \n\tprov_mech.cm_type = KCF_TO_PROV_MECHNUM(pd, mech->cm_type);\n\tprov_mech.cm_param = mech->cm_param;\n\tprov_mech.cm_param_len = mech->cm_param_len;\n\n\terror = KCF_PROV_CREATE_CTX_TEMPLATE(pd, &prov_mech, key,\n\t    &(ctx_tmpl->ct_prov_tmpl), &(ctx_tmpl->ct_size));\n\n\tif (error == CRYPTO_SUCCESS) {\n\t\t*ptmpl = ctx_tmpl;\n\t} else {\n\t\tkmem_free(ctx_tmpl, sizeof (kcf_ctx_template_t));\n\t}\n\tKCF_PROV_REFRELE(pd);\n\n\treturn (error);\n}\n\n \nvoid\ncrypto_destroy_ctx_template(crypto_ctx_template_t tmpl)\n{\n\tkcf_ctx_template_t *ctx_tmpl = (kcf_ctx_template_t *)tmpl;\n\n\tif (ctx_tmpl == NULL)\n\t\treturn;\n\n\tASSERT(ctx_tmpl->ct_prov_tmpl != NULL);\n\n\tmemset(ctx_tmpl->ct_prov_tmpl, 0, ctx_tmpl->ct_size);\n\tkmem_free(ctx_tmpl->ct_prov_tmpl, ctx_tmpl->ct_size);\n\tkmem_free(ctx_tmpl, sizeof (kcf_ctx_template_t));\n}\n\n#if defined(_KERNEL)\nEXPORT_SYMBOL(crypto_create_ctx_template);\nEXPORT_SYMBOL(crypto_destroy_ctx_template);\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}