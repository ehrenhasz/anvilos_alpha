{
  "module_name": "kcf_cipher.c",
  "hash_id": "2be70692268db26cdc0c2b2085d3a53a79f86ae96e6fc876da59f68174109900",
  "original_prompt": "Ingested from zfs-2.2.2/module/icp/api/kcf_cipher.c",
  "human_readable_source": " \n \n\n#include <sys/zfs_context.h>\n#include <sys/crypto/common.h>\n#include <sys/crypto/impl.h>\n#include <sys/crypto/api.h>\n#include <sys/crypto/spi.h>\n#include <sys/crypto/sched_impl.h>\n\n \n\n\n \nint\ncrypto_encrypt(crypto_mechanism_t *mech, crypto_data_t *plaintext,\n    crypto_key_t *key, crypto_ctx_template_t tmpl, crypto_data_t *ciphertext)\n{\n\tint error;\n\tkcf_mech_entry_t *me;\n\tkcf_provider_desc_t *pd;\n\tkcf_ctx_template_t *ctx_tmpl;\n\tcrypto_spi_ctx_template_t spi_ctx_tmpl = NULL;\n\tkcf_prov_tried_t *list = NULL;\n\nretry:\n\t \n\tif ((pd = kcf_get_mech_provider(mech->cm_type, &me, &error,\n\t    list, CRYPTO_FG_ENCRYPT_ATOMIC)) == NULL) {\n\t\tif (list != NULL)\n\t\t\tkcf_free_triedlist(list);\n\t\treturn (error);\n\t}\n\n\tif (((ctx_tmpl = (kcf_ctx_template_t *)tmpl) != NULL))\n\t\tspi_ctx_tmpl = ctx_tmpl->ct_prov_tmpl;\n\n\tcrypto_mechanism_t lmech = *mech;\n\tKCF_SET_PROVIDER_MECHNUM(mech->cm_type, pd, &lmech);\n\terror = KCF_PROV_ENCRYPT_ATOMIC(pd, &lmech, key,\n\t    plaintext, ciphertext, spi_ctx_tmpl);\n\n\tif (error != CRYPTO_SUCCESS && IS_RECOVERABLE(error)) {\n\t\t \n\t\tif (kcf_insert_triedlist(&list, pd, KM_SLEEP) != NULL)\n\t\t\tgoto retry;\n\t}\n\n\tif (list != NULL)\n\t\tkcf_free_triedlist(list);\n\n\tKCF_PROV_REFRELE(pd);\n\treturn (error);\n}\n\n \nint\ncrypto_decrypt(crypto_mechanism_t *mech, crypto_data_t *ciphertext,\n    crypto_key_t *key, crypto_ctx_template_t tmpl, crypto_data_t *plaintext)\n{\n\tint error;\n\tkcf_mech_entry_t *me;\n\tkcf_provider_desc_t *pd;\n\tkcf_ctx_template_t *ctx_tmpl;\n\tcrypto_spi_ctx_template_t spi_ctx_tmpl = NULL;\n\tkcf_prov_tried_t *list = NULL;\n\nretry:\n\t \n\tif ((pd = kcf_get_mech_provider(mech->cm_type, &me, &error,\n\t    list, CRYPTO_FG_DECRYPT_ATOMIC)) == NULL) {\n\t\tif (list != NULL)\n\t\t\tkcf_free_triedlist(list);\n\t\treturn (error);\n\t}\n\n\tif (((ctx_tmpl = (kcf_ctx_template_t *)tmpl) != NULL))\n\t\tspi_ctx_tmpl = ctx_tmpl->ct_prov_tmpl;\n\n\tcrypto_mechanism_t lmech = *mech;\n\tKCF_SET_PROVIDER_MECHNUM(mech->cm_type, pd, &lmech);\n\n\terror = KCF_PROV_DECRYPT_ATOMIC(pd, &lmech, key,\n\t    ciphertext, plaintext, spi_ctx_tmpl);\n\n\tif (error != CRYPTO_SUCCESS && IS_RECOVERABLE(error)) {\n\t\t \n\t\tif (kcf_insert_triedlist(&list, pd, KM_SLEEP) != NULL)\n\t\t\tgoto retry;\n\t}\n\n\tif (list != NULL)\n\t\tkcf_free_triedlist(list);\n\n\tKCF_PROV_REFRELE(pd);\n\treturn (error);\n}\n\n#if defined(_KERNEL)\nEXPORT_SYMBOL(crypto_encrypt);\nEXPORT_SYMBOL(crypto_decrypt);\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}