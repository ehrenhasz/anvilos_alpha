{
  "module_name": "modes.h",
  "hash_id": "0c5b2c4afefe696c55c54cbeedc9670a70b07cede8ec3fd1ec8f51d8481ee6e8",
  "original_prompt": "Ingested from zfs-2.2.2/module/icp/include/modes/modes.h",
  "human_readable_source": " \n \n\n#ifndef\t_COMMON_CRYPTO_MODES_H\n#define\t_COMMON_CRYPTO_MODES_H\n\n#ifdef\t__cplusplus\nextern \"C\" {\n#endif\n\n#include <sys/zfs_context.h>\n#include <sys/crypto/common.h>\n#include <sys/crypto/impl.h>\n\n \n#if defined(__x86_64__) && defined(HAVE_AVX) && \\\n    defined(HAVE_AES) && defined(HAVE_PCLMULQDQ)\n#define\tCAN_USE_GCM_ASM\nextern boolean_t gcm_avx_can_use_movbe;\n#endif\n\n#define\tECB_MODE\t\t\t0x00000002\n#define\tCBC_MODE\t\t\t0x00000004\n#define\tCTR_MODE\t\t\t0x00000008\n#define\tCCM_MODE\t\t\t0x00000010\n#define\tGCM_MODE\t\t\t0x00000020\n#define\tGMAC_MODE\t\t\t0x00000040\n\n \nstruct common_ctx {\n\tvoid *cc_keysched;\n\tsize_t cc_keysched_len;\n\tuint64_t cc_iv[2];\n\tuint64_t cc_remainder[2];\n\tsize_t cc_remainder_len;\n\tuint8_t *cc_lastp;\n\tuint8_t *cc_copy_to;\n\tuint32_t cc_flags;\n};\n\ntypedef struct common_ctx common_ctx_t;\n\ntypedef struct ecb_ctx {\n\tstruct common_ctx ecb_common;\n\tuint64_t ecb_lastblock[2];\n} ecb_ctx_t;\n\n#define\tecb_keysched\t\tecb_common.cc_keysched\n#define\tecb_keysched_len\tecb_common.cc_keysched_len\n#define\tecb_iv\t\t\tecb_common.cc_iv\n#define\tecb_remainder\t\tecb_common.cc_remainder\n#define\tecb_remainder_len\tecb_common.cc_remainder_len\n#define\tecb_lastp\t\tecb_common.cc_lastp\n#define\tecb_copy_to\t\tecb_common.cc_copy_to\n#define\tecb_flags\t\tecb_common.cc_flags\n\ntypedef struct cbc_ctx {\n\tstruct common_ctx cbc_common;\n\tuint64_t cbc_lastblock[2];\n} cbc_ctx_t;\n\n#define\tcbc_keysched\t\tcbc_common.cc_keysched\n#define\tcbc_keysched_len\tcbc_common.cc_keysched_len\n#define\tcbc_iv\t\t\tcbc_common.cc_iv\n#define\tcbc_remainder\t\tcbc_common.cc_remainder\n#define\tcbc_remainder_len\tcbc_common.cc_remainder_len\n#define\tcbc_lastp\t\tcbc_common.cc_lastp\n#define\tcbc_copy_to\t\tcbc_common.cc_copy_to\n#define\tcbc_flags\t\tcbc_common.cc_flags\n\n \ntypedef struct ctr_ctx {\n\tstruct common_ctx ctr_common;\n\tuint64_t ctr_lower_mask;\n\tuint64_t ctr_upper_mask;\n\tuint32_t ctr_tmp[4];\n} ctr_ctx_t;\n\n \n#define\tctr_keysched\t\tctr_common.cc_keysched\n#define\tctr_keysched_len\tctr_common.cc_keysched_len\n#define\tctr_cb\t\t\tctr_common.cc_iv\n#define\tctr_remainder\t\tctr_common.cc_remainder\n#define\tctr_remainder_len\tctr_common.cc_remainder_len\n#define\tctr_lastp\t\tctr_common.cc_lastp\n#define\tctr_copy_to\t\tctr_common.cc_copy_to\n#define\tctr_flags\t\tctr_common.cc_flags\n\n \ntypedef struct ccm_ctx {\n\tstruct common_ctx ccm_common;\n\tuint32_t ccm_tmp[4];\n\tsize_t ccm_mac_len;\n\tuint64_t ccm_mac_buf[2];\n\tsize_t ccm_data_len;\n\tsize_t ccm_processed_data_len;\n\tsize_t ccm_processed_mac_len;\n\tuint8_t *ccm_pt_buf;\n\tuint64_t ccm_mac_input_buf[2];\n\tuint64_t ccm_counter_mask;\n} ccm_ctx_t;\n\n#define\tccm_keysched\t\tccm_common.cc_keysched\n#define\tccm_keysched_len\tccm_common.cc_keysched_len\n#define\tccm_cb\t\t\tccm_common.cc_iv\n#define\tccm_remainder\t\tccm_common.cc_remainder\n#define\tccm_remainder_len\tccm_common.cc_remainder_len\n#define\tccm_lastp\t\tccm_common.cc_lastp\n#define\tccm_copy_to\t\tccm_common.cc_copy_to\n#define\tccm_flags\t\tccm_common.cc_flags\n\n \ntypedef struct gcm_ctx {\n\tstruct common_ctx gcm_common;\n\tsize_t gcm_tag_len;\n\tsize_t gcm_processed_data_len;\n\tsize_t gcm_pt_buf_len;\n\tuint32_t gcm_tmp[4];\n\t \n\tuint64_t gcm_ghash[2];\n\tuint64_t gcm_H[2];\n#ifdef CAN_USE_GCM_ASM\n\tuint64_t *gcm_Htable;\n\tsize_t gcm_htab_len;\n#endif\n\tuint64_t gcm_J0[2];\n\tuint64_t gcm_len_a_len_c[2];\n\tuint8_t *gcm_pt_buf;\n#ifdef CAN_USE_GCM_ASM\n\tboolean_t gcm_use_avx;\n#endif\n} gcm_ctx_t;\n\n#define\tgcm_keysched\t\tgcm_common.cc_keysched\n#define\tgcm_keysched_len\tgcm_common.cc_keysched_len\n#define\tgcm_cb\t\t\tgcm_common.cc_iv\n#define\tgcm_remainder\t\tgcm_common.cc_remainder\n#define\tgcm_remainder_len\tgcm_common.cc_remainder_len\n#define\tgcm_lastp\t\tgcm_common.cc_lastp\n#define\tgcm_copy_to\t\tgcm_common.cc_copy_to\n#define\tgcm_flags\t\tgcm_common.cc_flags\n\n#define\tAES_GMAC_IV_LEN\t\t12\n#define\tAES_GMAC_TAG_BITS\t128\n\nvoid gcm_clear_ctx(gcm_ctx_t *ctx);\n\ntypedef struct aes_ctx {\n\tunion {\n\t\tecb_ctx_t acu_ecb;\n\t\tcbc_ctx_t acu_cbc;\n\t\tctr_ctx_t acu_ctr;\n\t\tccm_ctx_t acu_ccm;\n\t\tgcm_ctx_t acu_gcm;\n\t} acu;\n} aes_ctx_t;\n\n#define\tac_flags\t\tacu.acu_ecb.ecb_common.cc_flags\n#define\tac_remainder_len\tacu.acu_ecb.ecb_common.cc_remainder_len\n#define\tac_keysched\t\tacu.acu_ecb.ecb_common.cc_keysched\n#define\tac_keysched_len\t\tacu.acu_ecb.ecb_common.cc_keysched_len\n#define\tac_iv\t\t\tacu.acu_ecb.ecb_common.cc_iv\n#define\tac_lastp\t\tacu.acu_ecb.ecb_common.cc_lastp\n#define\tac_pt_buf\t\tacu.acu_ccm.ccm_pt_buf\n#define\tac_mac_len\t\tacu.acu_ccm.ccm_mac_len\n#define\tac_data_len\t\tacu.acu_ccm.ccm_data_len\n#define\tac_processed_mac_len\tacu.acu_ccm.ccm_processed_mac_len\n#define\tac_processed_data_len\tacu.acu_ccm.ccm_processed_data_len\n#define\tac_tag_len\t\tacu.acu_gcm.gcm_tag_len\n\ntypedef struct blowfish_ctx {\n\tunion {\n\t\tecb_ctx_t bcu_ecb;\n\t\tcbc_ctx_t bcu_cbc;\n\t} bcu;\n} blowfish_ctx_t;\n\n#define\tbc_flags\t\tbcu.bcu_ecb.ecb_common.cc_flags\n#define\tbc_remainder_len\tbcu.bcu_ecb.ecb_common.cc_remainder_len\n#define\tbc_keysched\t\tbcu.bcu_ecb.ecb_common.cc_keysched\n#define\tbc_keysched_len\t\tbcu.bcu_ecb.ecb_common.cc_keysched_len\n#define\tbc_iv\t\t\tbcu.bcu_ecb.ecb_common.cc_iv\n#define\tbc_lastp\t\tbcu.bcu_ecb.ecb_common.cc_lastp\n\ntypedef struct des_ctx {\n\tunion {\n\t\tecb_ctx_t dcu_ecb;\n\t\tcbc_ctx_t dcu_cbc;\n\t} dcu;\n} des_ctx_t;\n\n#define\tdc_flags\t\tdcu.dcu_ecb.ecb_common.cc_flags\n#define\tdc_remainder_len\tdcu.dcu_ecb.ecb_common.cc_remainder_len\n#define\tdc_keysched\t\tdcu.dcu_ecb.ecb_common.cc_keysched\n#define\tdc_keysched_len\t\tdcu.dcu_ecb.ecb_common.cc_keysched_len\n#define\tdc_iv\t\t\tdcu.dcu_ecb.ecb_common.cc_iv\n#define\tdc_lastp\t\tdcu.dcu_ecb.ecb_common.cc_lastp\n\nextern int ecb_cipher_contiguous_blocks(ecb_ctx_t *, char *, size_t,\n    crypto_data_t *, size_t, int (*cipher)(const void *, const uint8_t *,\n    uint8_t *));\n\nextern int cbc_encrypt_contiguous_blocks(cbc_ctx_t *, char *, size_t,\n    crypto_data_t *, size_t,\n    int (*encrypt)(const void *, const uint8_t *, uint8_t *),\n    void (*copy_block)(uint8_t *, uint8_t *),\n    void (*xor_block)(uint8_t *, uint8_t *));\n\nextern int cbc_decrypt_contiguous_blocks(cbc_ctx_t *, char *, size_t,\n    crypto_data_t *, size_t,\n    int (*decrypt)(const void *, const uint8_t *, uint8_t *),\n    void (*copy_block)(uint8_t *, uint8_t *),\n    void (*xor_block)(uint8_t *, uint8_t *));\n\nextern int ctr_mode_contiguous_blocks(ctr_ctx_t *, char *, size_t,\n    crypto_data_t *, size_t,\n    int (*cipher)(const void *, const uint8_t *, uint8_t *),\n    void (*xor_block)(uint8_t *, uint8_t *));\n\nextern int ccm_mode_encrypt_contiguous_blocks(ccm_ctx_t *, char *, size_t,\n    crypto_data_t *, size_t,\n    int (*encrypt_block)(const void *, const uint8_t *, uint8_t *),\n    void (*copy_block)(uint8_t *, uint8_t *),\n    void (*xor_block)(uint8_t *, uint8_t *));\n\nextern int ccm_mode_decrypt_contiguous_blocks(ccm_ctx_t *, char *, size_t,\n    crypto_data_t *, size_t,\n    int (*encrypt_block)(const void *, const uint8_t *, uint8_t *),\n    void (*copy_block)(uint8_t *, uint8_t *),\n    void (*xor_block)(uint8_t *, uint8_t *));\n\nextern int gcm_mode_encrypt_contiguous_blocks(gcm_ctx_t *, char *, size_t,\n    crypto_data_t *, size_t,\n    int (*encrypt_block)(const void *, const uint8_t *, uint8_t *),\n    void (*copy_block)(uint8_t *, uint8_t *),\n    void (*xor_block)(uint8_t *, uint8_t *));\n\nextern int gcm_mode_decrypt_contiguous_blocks(gcm_ctx_t *, char *, size_t,\n    crypto_data_t *, size_t,\n    int (*encrypt_block)(const void *, const uint8_t *, uint8_t *),\n    void (*copy_block)(uint8_t *, uint8_t *),\n    void (*xor_block)(uint8_t *, uint8_t *));\n\nint ccm_encrypt_final(ccm_ctx_t *, crypto_data_t *, size_t,\n    int (*encrypt_block)(const void *, const uint8_t *, uint8_t *),\n    void (*xor_block)(uint8_t *, uint8_t *));\n\nint gcm_encrypt_final(gcm_ctx_t *, crypto_data_t *, size_t,\n    int (*encrypt_block)(const void *, const uint8_t *, uint8_t *),\n    void (*copy_block)(uint8_t *, uint8_t *),\n    void (*xor_block)(uint8_t *, uint8_t *));\n\nextern int ccm_decrypt_final(ccm_ctx_t *, crypto_data_t *, size_t,\n    int (*encrypt_block)(const void *, const uint8_t *, uint8_t *),\n    void (*copy_block)(uint8_t *, uint8_t *),\n    void (*xor_block)(uint8_t *, uint8_t *));\n\nextern int gcm_decrypt_final(gcm_ctx_t *, crypto_data_t *, size_t,\n    int (*encrypt_block)(const void *, const uint8_t *, uint8_t *),\n    void (*xor_block)(uint8_t *, uint8_t *));\n\nextern int ctr_mode_final(ctr_ctx_t *, crypto_data_t *,\n    int (*encrypt_block)(const void *, const uint8_t *, uint8_t *));\n\nextern int cbc_init_ctx(cbc_ctx_t *, char *, size_t, size_t,\n    void (*copy_block)(uint8_t *, uint64_t *));\n\nextern int ctr_init_ctx(ctr_ctx_t *, ulong_t, uint8_t *,\n    void (*copy_block)(uint8_t *, uint8_t *));\n\nextern int ccm_init_ctx(ccm_ctx_t *, char *, int, boolean_t, size_t,\n    int (*encrypt_block)(const void *, const uint8_t *, uint8_t *),\n    void (*xor_block)(uint8_t *, uint8_t *));\n\nextern int gcm_init_ctx(gcm_ctx_t *, char *, size_t,\n    int (*encrypt_block)(const void *, const uint8_t *, uint8_t *),\n    void (*copy_block)(uint8_t *, uint8_t *),\n    void (*xor_block)(uint8_t *, uint8_t *));\n\nextern int gmac_init_ctx(gcm_ctx_t *, char *, size_t,\n    int (*encrypt_block)(const void *, const uint8_t *, uint8_t *),\n    void (*copy_block)(uint8_t *, uint8_t *),\n    void (*xor_block)(uint8_t *, uint8_t *));\n\nextern void calculate_ccm_mac(ccm_ctx_t *, uint8_t *,\n    int (*encrypt_block)(const void *, const uint8_t *, uint8_t *));\n\nextern void gcm_mul(uint64_t *, uint64_t *, uint64_t *);\n\nextern void crypto_init_ptrs(crypto_data_t *, void **, offset_t *);\nextern void crypto_get_ptrs(crypto_data_t *, void **, offset_t *,\n    uint8_t **, size_t *, uint8_t **, size_t);\n\nextern void *ecb_alloc_ctx(int);\nextern void *cbc_alloc_ctx(int);\nextern void *ctr_alloc_ctx(int);\nextern void *ccm_alloc_ctx(int);\nextern void *gcm_alloc_ctx(int);\nextern void *gmac_alloc_ctx(int);\nextern void crypto_free_mode_ctx(void *);\n\n#ifdef\t__cplusplus\n}\n#endif\n\n#endif\t \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}