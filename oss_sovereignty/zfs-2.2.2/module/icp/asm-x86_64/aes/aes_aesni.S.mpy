{
  "module_name": "aes_aesni.S",
  "hash_id": "ffe7a4b1f6e2eaf12dc8b18ccff24adbd758412cdc2f81b6c60ff14bb814ec3e",
  "original_prompt": "Ingested from zfs-2.2.2/module/icp/asm-x86_64/aes/aes_aesni.S",
  "human_readable_source": " \n\n \n\n \n\n\n#if defined(lint) || defined(__lint)\n\n#include <sys/types.h>\n\nvoid\naes_encrypt_intel(const uint32_t rk[], int Nr, const uint32_t pt[4],\n    uint32_t ct[4]) {\n\t(void) rk, (void) Nr, (void) pt, (void) ct;\n}\nvoid\naes_decrypt_intel(const uint32_t rk[], int Nr, const uint32_t ct[4],\n    uint32_t pt[4]) {\n\t(void) rk, (void) Nr, (void) ct, (void) pt;\n}\nint\nrijndael_key_setup_enc_intel(uint32_t rk[], const uint32_t cipherKey[],\n    uint64_t keyBits) {\n\t(void) rk, (void) cipherKey, (void) keyBits;\n\treturn (0);\n}\nint\nrijndael_key_setup_dec_intel(uint32_t rk[], const uint32_t cipherKey[],\n   uint64_t keyBits) {\n\t(void) rk, (void) cipherKey, (void) keyBits;\n\treturn (0);\n}\n\n\n#elif defined(HAVE_AES)\t \n\n#define _ASM\n#include <sys/asm_linkage.h>\n\n \n\nENTRY_NP2(_key_expansion_128, _key_expansion_256a)\n_key_expansion_128_local:\n_key_expansion_256a_local:\n\tpshufd\t$0b11111111, %xmm1, %xmm1\n\tshufps\t$0b00010000, %xmm0, %xmm4\n\tpxor\t%xmm4, %xmm0\n\tshufps\t$0b10001100, %xmm0, %xmm4\n\tpxor\t%xmm4, %xmm0\n\tpxor\t%xmm1, %xmm0\n\tmovups\t%xmm0, (%rcx)\n\tadd\t$0x10, %rcx\n\tRET\n\tnop\nSET_SIZE(_key_expansion_128)\nSET_SIZE(_key_expansion_256a)\n\n\nENTRY_NP(_key_expansion_192a)\n_key_expansion_192a_local:\n\tpshufd\t$0b01010101, %xmm1, %xmm1\n\tshufps\t$0b00010000, %xmm0, %xmm4\n\tpxor\t%xmm4, %xmm0\n\tshufps\t$0b10001100, %xmm0, %xmm4\n\tpxor\t%xmm4, %xmm0\n\tpxor\t%xmm1, %xmm0\n\n\tmovups\t%xmm2, %xmm5\n\tmovups\t%xmm2, %xmm6\n\tpslldq\t$4, %xmm5\n\tpshufd\t$0b11111111, %xmm0, %xmm3\n\tpxor\t%xmm3, %xmm2\n\tpxor\t%xmm5, %xmm2\n\n\tmovups\t%xmm0, %xmm1\n\tshufps\t$0b01000100, %xmm0, %xmm6\n\tmovups\t%xmm6, (%rcx)\n\tshufps\t$0b01001110, %xmm2, %xmm1\n\tmovups\t%xmm1, 0x10(%rcx)\n\tadd\t$0x20, %rcx\n\tRET\nSET_SIZE(_key_expansion_192a)\n\n\nENTRY_NP(_key_expansion_192b)\n_key_expansion_192b_local:\n\tpshufd\t$0b01010101, %xmm1, %xmm1\n\tshufps\t$0b00010000, %xmm0, %xmm4\n\tpxor\t%xmm4, %xmm0\n\tshufps\t$0b10001100, %xmm0, %xmm4\n\tpxor\t%xmm4, %xmm0\n\tpxor\t%xmm1, %xmm0\n\n\tmovups\t%xmm2, %xmm5\n\tpslldq\t$4, %xmm5\n\tpshufd\t$0b11111111, %xmm0, %xmm3\n\tpxor\t%xmm3, %xmm2\n\tpxor\t%xmm5, %xmm2\n\n\tmovups\t%xmm0, (%rcx)\n\tadd\t$0x10, %rcx\n\tRET\nSET_SIZE(_key_expansion_192b)\n\n\nENTRY_NP(_key_expansion_256b)\n_key_expansion_256b_local:\n\tpshufd\t$0b10101010, %xmm1, %xmm1\n\tshufps\t$0b00010000, %xmm2, %xmm4\n\tpxor\t%xmm4, %xmm2\n\tshufps\t$0b10001100, %xmm2, %xmm4\n\tpxor\t%xmm4, %xmm2\n\tpxor\t%xmm1, %xmm2\n\tmovups\t%xmm2, (%rcx)\n\tadd\t$0x10, %rcx\n\tRET\nSET_SIZE(_key_expansion_256b)\n\n\n \n\n#ifdef\tOPENSSL_INTERFACE\n#define\trijndael_key_setup_enc_intel\tintel_AES_set_encrypt_key\n#define\trijndael_key_setup_dec_intel\tintel_AES_set_decrypt_key\n\n#define\tUSERCIPHERKEY\t\trdi\t \n#define\tKEYSIZE32\t\tesi\t \n#define\tKEYSIZE64\t\trsi\t \n#define\tAESKEY\t\t\trdx\t \n\n#else\t \n#define\tAESKEY\t\t\trdi\t \n#define\tUSERCIPHERKEY\t\trsi\t \n#define\tKEYSIZE32\t\tedx\t \n#define\tKEYSIZE64\t\trdx\t \n#endif\t \n\n#define\tROUNDS32\t\tKEYSIZE32\t \n#define\tROUNDS64\t\tKEYSIZE64\t \n#define\tENDAESKEY\t\tUSERCIPHERKEY\t \n\nENTRY_NP(rijndael_key_setup_enc_intel)\nrijndael_key_setup_enc_intel_local:\n\tFRAME_BEGIN\n\t \n\ttest\t%USERCIPHERKEY, %USERCIPHERKEY\n\tjz\t.Lenc_key_invalid_param\n\ttest\t%AESKEY, %AESKEY\n\tjz\t.Lenc_key_invalid_param\n\n\tmovups\t(%USERCIPHERKEY), %xmm0\t \n\tmovups\t%xmm0, (%AESKEY)\n\tlea\t0x10(%AESKEY), %rcx\t \n\tpxor\t%xmm4, %xmm4\t\t \n\n\tcmp\t$256, %KEYSIZE32\n\tjnz\t.Lenc_key192\n\n\t \n#ifdef OPENSSL_INTERFACE\n\tmov\t$14, %ROUNDS32\n\tmovl\t%ROUNDS32, 240(%AESKEY)\t\t \n#endif\t \n\n\tmovups\t0x10(%USERCIPHERKEY), %xmm2\t \n\tmovups\t%xmm2, (%rcx)\n\tadd\t$0x10, %rcx\n\n\taeskeygenassist $0x1, %xmm2, %xmm1\t \n\tcall\t_key_expansion_256a_local\n\taeskeygenassist $0x1, %xmm0, %xmm1\n\tcall\t_key_expansion_256b_local\n\taeskeygenassist $0x2, %xmm2, %xmm1\t \n\tcall\t_key_expansion_256a_local\n\taeskeygenassist $0x2, %xmm0, %xmm1\n\tcall\t_key_expansion_256b_local\n\taeskeygenassist $0x4, %xmm2, %xmm1\t \n\tcall\t_key_expansion_256a_local\n\taeskeygenassist $0x4, %xmm0, %xmm1\n\tcall\t_key_expansion_256b_local\n\taeskeygenassist $0x8, %xmm2, %xmm1\t \n\tcall\t_key_expansion_256a_local\n\taeskeygenassist $0x8, %xmm0, %xmm1\n\tcall\t_key_expansion_256b_local\n\taeskeygenassist $0x10, %xmm2, %xmm1\t \n\tcall\t_key_expansion_256a_local\n\taeskeygenassist $0x10, %xmm0, %xmm1\n\tcall\t_key_expansion_256b_local\n\taeskeygenassist $0x20, %xmm2, %xmm1\t \n\tcall\t_key_expansion_256a_local\n\taeskeygenassist $0x20, %xmm0, %xmm1\n\tcall\t_key_expansion_256b_local\n\taeskeygenassist $0x40, %xmm2, %xmm1\t \n\tcall\t_key_expansion_256a_local\n\n#ifdef\tOPENSSL_INTERFACE\n\txor\t%rax, %rax\t\t\t \n#else\t \n\tmov\t$14, %rax\t\t\t \n#endif\n\tFRAME_END\n\tRET\n\n.balign 4\n.Lenc_key192:\n\tcmp\t$192, %KEYSIZE32\n\tjnz\t.Lenc_key128\n\n\t \n#ifdef OPENSSL_INTERFACE\n\tmov\t$12, %ROUNDS32\n\tmovl\t%ROUNDS32, 240(%AESKEY)\t \n#endif\t \n\n\tmovq\t0x10(%USERCIPHERKEY), %xmm2\t \n\taeskeygenassist $0x1, %xmm2, %xmm1\t \n\tcall\t_key_expansion_192a_local\n\taeskeygenassist $0x2, %xmm2, %xmm1\t \n\tcall\t_key_expansion_192b_local\n\taeskeygenassist $0x4, %xmm2, %xmm1\t \n\tcall\t_key_expansion_192a_local\n\taeskeygenassist $0x8, %xmm2, %xmm1\t \n\tcall\t_key_expansion_192b_local\n\taeskeygenassist $0x10, %xmm2, %xmm1\t \n\tcall\t_key_expansion_192a_local\n\taeskeygenassist $0x20, %xmm2, %xmm1\t \n\tcall\t_key_expansion_192b_local\n\taeskeygenassist $0x40, %xmm2, %xmm1\t \n\tcall\t_key_expansion_192a_local\n\taeskeygenassist $0x80, %xmm2, %xmm1\t \n\tcall\t_key_expansion_192b_local\n\n#ifdef\tOPENSSL_INTERFACE\n\txor\t%rax, %rax\t\t\t \n#else\t \n\tmov\t$12, %rax\t\t\t \n#endif\n\tFRAME_END\n\tRET\n\n.balign 4\n.Lenc_key128:\n\tcmp $128, %KEYSIZE32\n\tjnz .Lenc_key_invalid_key_bits\n\n\t \n#ifdef OPENSSL_INTERFACE\n\tmov\t$10, %ROUNDS32\n\tmovl\t%ROUNDS32, 240(%AESKEY)\t\t \n#endif\t \n\n\taeskeygenassist $0x1, %xmm0, %xmm1\t \n\tcall\t_key_expansion_128_local\n\taeskeygenassist $0x2, %xmm0, %xmm1\t \n\tcall\t_key_expansion_128_local\n\taeskeygenassist $0x4, %xmm0, %xmm1\t \n\tcall\t_key_expansion_128_local\n\taeskeygenassist $0x8, %xmm0, %xmm1\t \n\tcall\t_key_expansion_128_local\n\taeskeygenassist $0x10, %xmm0, %xmm1\t \n\tcall\t_key_expansion_128_local\n\taeskeygenassist $0x20, %xmm0, %xmm1\t \n\tcall\t_key_expansion_128_local\n\taeskeygenassist $0x40, %xmm0, %xmm1\t \n\tcall\t_key_expansion_128_local\n\taeskeygenassist $0x80, %xmm0, %xmm1\t \n\tcall\t_key_expansion_128_local\n\taeskeygenassist $0x1b, %xmm0, %xmm1\t \n\tcall\t_key_expansion_128_local\n\taeskeygenassist $0x36, %xmm0, %xmm1\t \n\tcall\t_key_expansion_128_local\n\n#ifdef\tOPENSSL_INTERFACE\n\txor\t%rax, %rax\t\t\t \n#else\t \n\tmov\t$10, %rax\t\t\t \n#endif\n\tFRAME_END\n\tRET\n\n.Lenc_key_invalid_param:\n#ifdef\tOPENSSL_INTERFACE\n\tmov\t$-1, %rax\t \n\tFRAME_END\n\tRET\n#else\n\t \n#endif\t \n\n.Lenc_key_invalid_key_bits:\n#ifdef\tOPENSSL_INTERFACE\n\tmov\t$-2, %rax\t \n#else\t \n\txor\t%rax, %rax\t \n#endif\t \n\tFRAME_END\n\tRET\n\tSET_SIZE(rijndael_key_setup_enc_intel)\n\n\n \n\nENTRY_NP(rijndael_key_setup_dec_intel)\nFRAME_BEGIN\n\t \n\tcall\trijndael_key_setup_enc_intel_local\n\ttest\t%rax, %rax\n#ifdef\tOPENSSL_INTERFACE\n\tjnz\t.Ldec_key_exit\t \n#else\t \n\tjz\t.Ldec_key_exit\t \n#endif\t \n\n\t \n#ifndef\tOPENSSL_INTERFACE\t\t \n\tmov\t%rax, %ROUNDS64\t\t \n\t\t\t\t\t \n#endif\n\n\tlea\t0x10(%AESKEY), %rcx\t \n\tshl\t$4, %ROUNDS32\n\tadd\t%AESKEY, %ROUNDS64\n\tmov\t%ROUNDS64, %ENDAESKEY\n\n.balign 4\n.Ldec_key_reorder_loop:\n\tmovups\t(%AESKEY), %xmm0\n\tmovups\t(%ROUNDS64), %xmm1\n\tmovups\t%xmm0, (%ROUNDS64)\n\tmovups\t%xmm1, (%AESKEY)\n\tlea\t0x10(%AESKEY), %AESKEY\n\tlea\t-0x10(%ROUNDS64), %ROUNDS64\n\tcmp\t%AESKEY, %ROUNDS64\n\tja\t.Ldec_key_reorder_loop\n\n.balign 4\n.Ldec_key_inv_loop:\n\tmovups\t(%rcx), %xmm0\n\t \n\t \n\taesimc\t%xmm0, %xmm1\n\tmovups\t%xmm1, (%rcx)\n\tlea\t0x10(%rcx), %rcx\n\tcmp\t%ENDAESKEY, %rcx\n\tjnz\t.Ldec_key_inv_loop\n\n.Ldec_key_exit:\n\t \n\t \n\tFRAME_END\n\tRET\n\tSET_SIZE(rijndael_key_setup_dec_intel)\n\n\n \n\n#ifdef\tOPENSSL_INTERFACE\n#define\taes_encrypt_intel\tintel_AES_encrypt\n#define\taes_decrypt_intel\tintel_AES_decrypt\n\n#define\tINP\t\trdi\t \n#define\tOUTP\t\trsi\t \n#define\tKEYP\t\trdx\t \n\n \n#define\tNROUNDS32\tecx\t \n#define\tNROUNDS\t\tcl\t \n\n#else\t \n#define\tKEYP\t\trdi\t \n#define\tNROUNDS\t\tesi\t \n#define\tINP\t\trdx\t \n#define\tOUTP\t\trcx\t \n#endif\t \n\n#define\tSTATE\t\txmm0\t \n#define\tKEY\t\txmm1\t \n\n\nENTRY_NP(aes_encrypt_intel)\n\n\tmovups\t(%INP), %STATE\t\t\t \n\tmovups\t(%KEYP), %KEY\t\t\t \n#ifdef\tOPENSSL_INTERFACE\n\tmov\t240(%KEYP), %NROUNDS32\t\t \n#else\t \n\t \n#endif\t \n\n\tpxor\t%KEY, %STATE\t\t\t \n\tlea\t0x30(%KEYP), %KEYP\n\tcmp\t$12, %NROUNDS\n\tjb\t.Lenc128\n\tlea\t0x20(%KEYP), %KEYP\n\tje\t.Lenc192\n\n\t \n\tlea\t0x20(%KEYP), %KEYP\n\tmovups\t-0x60(%KEYP), %KEY\n\taesenc\t%KEY, %STATE\n\tmovups\t-0x50(%KEYP), %KEY\n\taesenc\t%KEY, %STATE\n\n.balign 4\n.Lenc192:\n\t \n\tmovups\t-0x40(%KEYP), %KEY\n\taesenc\t%KEY, %STATE\n\tmovups\t-0x30(%KEYP), %KEY\n\taesenc\t%KEY, %STATE\n\n.balign 4\n.Lenc128:\n\t \n\tmovups\t-0x20(%KEYP), %KEY\n\taesenc\t%KEY, %STATE\n\tmovups\t-0x10(%KEYP), %KEY\n\taesenc\t%KEY, %STATE\n\tmovups\t(%KEYP), %KEY\n\taesenc\t%KEY, %STATE\n\tmovups\t0x10(%KEYP), %KEY\n\taesenc\t%KEY, %STATE\n\tmovups\t0x20(%KEYP), %KEY\n\taesenc\t%KEY, %STATE\n\tmovups\t0x30(%KEYP), %KEY\n\taesenc\t%KEY, %STATE\n\tmovups\t0x40(%KEYP), %KEY\n\taesenc\t%KEY, %STATE\n\tmovups\t0x50(%KEYP), %KEY\n\taesenc\t%KEY, %STATE\n\tmovups\t0x60(%KEYP), %KEY\n\taesenc\t%KEY, %STATE\n\tmovups\t0x70(%KEYP), %KEY\n\taesenclast\t %KEY, %STATE\t\t \n\tmovups\t%STATE, (%OUTP)\t\t\t \n\n\tRET\n\tSET_SIZE(aes_encrypt_intel)\n\n\n \nENTRY_NP(aes_decrypt_intel)\n\n\tmovups\t(%INP), %STATE\t\t\t \n\tmovups\t(%KEYP), %KEY\t\t\t \n#ifdef\tOPENSSL_INTERFACE\n\tmov\t240(%KEYP), %NROUNDS32\t\t \n#else\t \n\t \n#endif\t \n\n\tpxor\t%KEY, %STATE\t\t\t \n\tlea\t0x30(%KEYP), %KEYP\n\tcmp\t$12, %NROUNDS\n\tjb\t.Ldec128\n\tlea\t0x20(%KEYP), %KEYP\n\tje\t.Ldec192\n\n\t \n\tlea\t0x20(%KEYP), %KEYP\n\tmovups\t-0x60(%KEYP), %KEY\n\taesdec\t%KEY, %STATE\n\tmovups\t-0x50(%KEYP), %KEY\n\taesdec\t%KEY, %STATE\n\n.balign 4\n.Ldec192:\n\t \n\tmovups\t-0x40(%KEYP), %KEY\n\taesdec\t%KEY, %STATE\n\tmovups\t-0x30(%KEYP), %KEY\n\taesdec\t%KEY, %STATE\n\n.balign 4\n.Ldec128:\n\t \n\tmovups\t-0x20(%KEYP), %KEY\n\taesdec\t%KEY, %STATE\n\tmovups\t-0x10(%KEYP), %KEY\n\taesdec\t%KEY, %STATE\n\tmovups\t(%KEYP), %KEY\n\taesdec\t%KEY, %STATE\n\tmovups\t0x10(%KEYP), %KEY\n\taesdec\t%KEY, %STATE\n\tmovups\t0x20(%KEYP), %KEY\n\taesdec\t%KEY, %STATE\n\tmovups\t0x30(%KEYP), %KEY\n\taesdec\t%KEY, %STATE\n\tmovups\t0x40(%KEYP), %KEY\n\taesdec\t%KEY, %STATE\n\tmovups\t0x50(%KEYP), %KEY\n\taesdec\t%KEY, %STATE\n\tmovups\t0x60(%KEYP), %KEY\n\taesdec\t%KEY, %STATE\n\tmovups\t0x70(%KEYP), %KEY\n\taesdeclast\t%KEY, %STATE\t\t \n\tmovups\t%STATE, (%OUTP)\t\t\t \n\n\tRET\n\tSET_SIZE(aes_decrypt_intel)\n\n#endif\t \n\n#ifdef __ELF__\n.section .note.GNU-stack,\"\",%progbits\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}