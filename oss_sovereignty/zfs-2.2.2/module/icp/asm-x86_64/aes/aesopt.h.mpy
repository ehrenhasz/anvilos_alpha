{
  "module_name": "aesopt.h",
  "hash_id": "940618631b916fbda1819a718175b45244c28c41eaeca2d7f16ab6ccdc886b9d",
  "original_prompt": "Ingested from zfs-2.2.2/module/icp/asm-x86_64/aes/aesopt.h",
  "human_readable_source": " \n\n \n\n#ifndef _AESOPT_H\n#define\t_AESOPT_H\n\n#ifdef\t__cplusplus\nextern \"C\" {\n#endif\n\n#include <sys/zfs_context.h>\n#include <aes/aes_impl.h>\n\n \n#define\tAES_ENCRYPT  \n#define\tAES_DECRYPT  \n\n \n#define\tIS_BIG_ENDIAN\t\t4321  \n#define\tIS_LITTLE_ENDIAN\t1234  \n#define\tPLATFORM_BYTE_ORDER\tIS_LITTLE_ENDIAN\n#define\tAES_REV_DKS  \n\n\n \n\n#define\tENCRYPTION_IN_C\t1\n#define\tDECRYPTION_IN_C\t2\n#define\tENC_KEYING_IN_C\t4\n#define\tDEC_KEYING_IN_C\t8\n\n#define\tNO_TABLES\t0\n#define\tONE_TABLE\t1\n#define\tFOUR_TABLES\t4\n#define\tNONE\t\t0\n#define\tPARTIAL\t\t1\n#define\tFULL\t\t2\n\n \n\n \n\n#if 1\n#define\tALGORITHM_BYTE_ORDER PLATFORM_BYTE_ORDER\n#elif 0\n#define\tALGORITHM_BYTE_ORDER IS_LITTLE_ENDIAN\n#elif 0\n#define\tALGORITHM_BYTE_ORDER IS_BIG_ENDIAN\n#else\n#error The algorithm byte order is not defined\n#endif\n\n \n\n#if defined(__GNUC__) && defined(__i386__) || \\\n\tdefined(_WIN32) && defined(_M_IX86) && \\\n\t!(defined(_WIN64) || defined(_WIN32_WCE) || \\\n\tdefined(_MSC_VER) && (_MSC_VER <= 800))\n#define\tVIA_ACE_POSSIBLE\n#endif\n\n \n\n \n#undef\tVIA_ACE_POSSIBLE\n#undef\tASSUME_VIA_ACE_PRESENT\n\n#if 0 && defined(VIA_ACE_POSSIBLE) && !defined(USE_VIA_ACE_IF_PRESENT)\n#define\tUSE_VIA_ACE_IF_PRESENT\n#endif\n\n#if 0 && defined(VIA_ACE_POSSIBLE) && !defined(ASSUME_VIA_ACE_PRESENT)\n#define\tASSUME_VIA_ACE_PRESENT\n#endif\n\n\n \n\n#if 0 && !defined(ASM_X86_V1C)\n#define\tASM_X86_V1C\n#elif 0 && !defined(ASM_X86_V2)\n#define\tASM_X86_V2\n#elif 0 && !defined(ASM_X86_V2C)\n#define\tASM_X86_V2C\n#elif 1 && !defined(ASM_AMD64_C)\n#define\tASM_AMD64_C\n#endif\n\n#if (defined(ASM_X86_V1C) || defined(ASM_X86_V2) || defined(ASM_X86_V2C)) && \\\n\t!defined(_M_IX86) || defined(ASM_AMD64_C) && !defined(_M_X64) && \\\n\t!defined(__amd64)\n#error Assembler code is only available for x86 and AMD64 systems\n#endif\n\n \n#if 1 && !defined(_MSC_VER)\n#define\tSAFE_IO\n#endif\n\n \n#if 1\n#define\tENC_UNROLL  FULL\n#elif 0\n#define\tENC_UNROLL  PARTIAL\n#else\n#define\tENC_UNROLL  NONE\n#endif\n\n#if 1\n#define\tDEC_UNROLL  FULL\n#elif 0\n#define\tDEC_UNROLL  PARTIAL\n#else\n#define\tDEC_UNROLL  NONE\n#endif\n\n#if 1\n#define\tENC_KS_UNROLL\n#endif\n\n#if 1\n#define\tDEC_KS_UNROLL\n#endif\n\n \n#if 1\n#define\tFF_TABLES\n#endif\n\n \n#if 1\n#define\tARRAYS\n#endif\n\n \n#if 1 && !(defined(_MSC_VER) && (_MSC_VER <= 800))\n#define\tFIXED_TABLES\n#endif\n\n \n#if 0\n#define\tto_byte(x)  ((uint8_t)(x))\n#else\n#define\tto_byte(x)  ((x) & 0xff)\n#endif\n\n \n\n#if 1 && defined(_MSC_VER) && (_MSC_VER >= 1300)\n#define\tTABLE_ALIGN 32\n#endif\n\n \n\n#if 1 && (defined(ASM_X86_V2) || defined(ASM_X86_V2C))\n#define\tREDUCE_CODE_SIZE\n#endif\n\n \n\n#if 1    \n#define\tENC_ROUND   FOUR_TABLES\n#elif 0\n#define\tENC_ROUND   ONE_TABLE\n#else\n#define\tENC_ROUND   NO_TABLES\n#endif\n\n#if 1    \n#define\tLAST_ENC_ROUND  FOUR_TABLES\n#elif 0\n#define\tLAST_ENC_ROUND  ONE_TABLE\n#else\n#define\tLAST_ENC_ROUND  NO_TABLES\n#endif\n\n#if 1    \n#define\tDEC_ROUND   FOUR_TABLES\n#elif 0\n#define\tDEC_ROUND   ONE_TABLE\n#else\n#define\tDEC_ROUND   NO_TABLES\n#endif\n\n#if 1    \n#define\tLAST_DEC_ROUND  FOUR_TABLES\n#elif 0\n#define\tLAST_DEC_ROUND  ONE_TABLE\n#else\n#define\tLAST_DEC_ROUND  NO_TABLES\n#endif\n\n \n#if 1\n#define\tKEY_SCHED   FOUR_TABLES\n#elif 0\n#define\tKEY_SCHED   ONE_TABLE\n#else\n#define\tKEY_SCHED   NO_TABLES\n#endif\n\n \n\n \n\n#if !defined(_MSC_VER) && !defined(__GNUC__)\n#if defined(ASSUME_VIA_ACE_PRESENT)\n#undef ASSUME_VIA_ACE_PRESENT\n#endif\n#if defined(USE_VIA_ACE_IF_PRESENT)\n#undef USE_VIA_ACE_IF_PRESENT\n#endif\n#endif\n\n#if defined(ASSUME_VIA_ACE_PRESENT) && !defined(USE_VIA_ACE_IF_PRESENT)\n#define\tUSE_VIA_ACE_IF_PRESENT\n#endif\n\n#if defined(USE_VIA_ACE_IF_PRESENT) && !defined(AES_REV_DKS)\n#define\tAES_REV_DKS\n#endif\n\n \n\n#if (defined(ASM_X86_V1C) || defined(ASM_X86_V2C) || defined(ASM_AMD64_C)) && \\\n\t(ALGORITHM_BYTE_ORDER != PLATFORM_BYTE_ORDER)\n#undef  ALGORITHM_BYTE_ORDER\n#define\tALGORITHM_BYTE_ORDER PLATFORM_BYTE_ORDER\n#endif\n\n \n\n#if defined(ARRAYS)\n#define\ts(x, c) x[c]\n#else\n#define\ts(x, c) x##c\n#endif\n\n \n\n#if !defined(AES_ENCRYPT)\n#define\tEFUNCS_IN_C   0\n#elif defined(ASSUME_VIA_ACE_PRESENT) || defined(ASM_X86_V1C) || \\\n\tdefined(ASM_X86_V2C) || defined(ASM_AMD64_C)\n#define\tEFUNCS_IN_C   ENC_KEYING_IN_C\n#elif !defined(ASM_X86_V2)\n#define\tEFUNCS_IN_C   (ENCRYPTION_IN_C | ENC_KEYING_IN_C)\n#else\n#define\tEFUNCS_IN_C   0\n#endif\n\n#if !defined(AES_DECRYPT)\n#define\tDFUNCS_IN_C   0\n#elif defined(ASSUME_VIA_ACE_PRESENT) || defined(ASM_X86_V1C) || \\\n\tdefined(ASM_X86_V2C) || defined(ASM_AMD64_C)\n#define\tDFUNCS_IN_C   DEC_KEYING_IN_C\n#elif !defined(ASM_X86_V2)\n#define\tDFUNCS_IN_C   (DECRYPTION_IN_C | DEC_KEYING_IN_C)\n#else\n#define\tDFUNCS_IN_C   0\n#endif\n\n#define\tFUNCS_IN_C  (EFUNCS_IN_C | DFUNCS_IN_C)\n\n \n\n \n\n#if ENC_ROUND == NO_TABLES && LAST_ENC_ROUND != NO_TABLES\n#undef  LAST_ENC_ROUND\n#define\tLAST_ENC_ROUND  NO_TABLES\n#elif ENC_ROUND == ONE_TABLE && LAST_ENC_ROUND == FOUR_TABLES\n#undef  LAST_ENC_ROUND\n#define\tLAST_ENC_ROUND  ONE_TABLE\n#endif\n\n#if ENC_ROUND == NO_TABLES && ENC_UNROLL != NONE\n#undef  ENC_UNROLL\n#define\tENC_UNROLL  NONE\n#endif\n\n#if DEC_ROUND == NO_TABLES && LAST_DEC_ROUND != NO_TABLES\n#undef  LAST_DEC_ROUND\n#define\tLAST_DEC_ROUND  NO_TABLES\n#elif DEC_ROUND == ONE_TABLE && LAST_DEC_ROUND == FOUR_TABLES\n#undef  LAST_DEC_ROUND\n#define\tLAST_DEC_ROUND  ONE_TABLE\n#endif\n\n#if DEC_ROUND == NO_TABLES && DEC_UNROLL != NONE\n#undef  DEC_UNROLL\n#define\tDEC_UNROLL  NONE\n#endif\n\n#if (ALGORITHM_BYTE_ORDER == IS_LITTLE_ENDIAN)\n#define\taes_sw32\thtonl\n#elif defined(bswap32)\n#define\taes_sw32\tbswap32\n#elif defined(bswap_32)\n#define\taes_sw32\tbswap_32\n#else\n#define\tbrot(x, n)  (((uint32_t)(x) << (n)) | ((uint32_t)(x) >> (32 - (n))))\n#define\taes_sw32(x) ((brot((x), 8) & 0x00ff00ff) | (brot((x), 24) & 0xff00ff00))\n#endif\n\n\n \n\n#if (ALGORITHM_BYTE_ORDER == IS_LITTLE_ENDIAN)\n#define\tupr(x, n)\t(((uint32_t)(x) << (8 * (n))) | \\\n\t\t\t((uint32_t)(x) >> (32 - 8 * (n))))\n#define\tups(x, n)\t((uint32_t)(x) << (8 * (n)))\n#define\tbval(x, n)\tto_byte((x) >> (8 * (n)))\n#define\tbytes2word(b0, b1, b2, b3)  \\\n\t\t(((uint32_t)(b3) << 24) | ((uint32_t)(b2) << 16) | \\\n\t\t((uint32_t)(b1) << 8) | (b0))\n#endif\n\n#if (ALGORITHM_BYTE_ORDER == IS_BIG_ENDIAN)\n#define\tupr(x, n)\t(((uint32_t)(x) >> (8 * (n))) | \\\n\t\t\t((uint32_t)(x) << (32 - 8 * (n))))\n#define\tups(x, n)\t((uint32_t)(x) >> (8 * (n)))\n#define\tbval(x, n)\tto_byte((x) >> (24 - 8 * (n)))\n#define\tbytes2word(b0, b1, b2, b3)  \\\n\t\t(((uint32_t)(b0) << 24) | ((uint32_t)(b1) << 16) | \\\n\t\t((uint32_t)(b2) << 8) | (b3))\n#endif\n\n#if defined(SAFE_IO)\n#define\tword_in(x, c)\tbytes2word(((const uint8_t *)(x) + 4 * c)[0], \\\n\t\t\t\t((const uint8_t *)(x) + 4 * c)[1], \\\n\t\t\t\t((const uint8_t *)(x) + 4 * c)[2], \\\n\t\t\t\t((const uint8_t *)(x) + 4 * c)[3])\n#define\tword_out(x, c, v) { ((uint8_t *)(x) + 4 * c)[0] = bval(v, 0); \\\n\t\t\t((uint8_t *)(x) + 4 * c)[1] = bval(v, 1); \\\n\t\t\t((uint8_t *)(x) + 4 * c)[2] = bval(v, 2); \\\n\t\t\t((uint8_t *)(x) + 4 * c)[3] = bval(v, 3); }\n#elif (ALGORITHM_BYTE_ORDER == PLATFORM_BYTE_ORDER)\n#define\tword_in(x, c)\t(*((uint32_t *)(x) + (c)))\n#define\tword_out(x, c, v) (*((uint32_t *)(x) + (c)) = (v))\n#else\n#define\tword_in(x, c)\taes_sw32(*((uint32_t *)(x) + (c)))\n#define\tword_out(x, c, v) (*((uint32_t *)(x) + (c)) = aes_sw32(v))\n#endif\n\n \n\n#define\tWPOLY   0x011b\n#define\tBPOLY\t0x1b\n\n \n\n#define\tm1  0x80808080\n#define\tm2  0x7f7f7f7f\n#define\tgf_mulx(x)  ((((x) & m2) << 1) ^ ((((x) & m1) >> 7) * BPOLY))\n\n \n\n \n\n#if defined(ASM_X86_V1C)\n#if defined(ENC_ROUND)\n#undef  ENC_ROUND\n#endif\n#define\tENC_ROUND   FOUR_TABLES\n#if defined(LAST_ENC_ROUND)\n#undef  LAST_ENC_ROUND\n#endif\n#define\tLAST_ENC_ROUND  FOUR_TABLES\n#if defined(DEC_ROUND)\n#undef  DEC_ROUND\n#endif\n#define\tDEC_ROUND   FOUR_TABLES\n#if defined(LAST_DEC_ROUND)\n#undef  LAST_DEC_ROUND\n#endif\n#define\tLAST_DEC_ROUND  FOUR_TABLES\n#if defined(KEY_SCHED)\n#undef  KEY_SCHED\n#define\tKEY_SCHED   FOUR_TABLES\n#endif\n#endif\n\n#if (FUNCS_IN_C & ENCRYPTION_IN_C) || defined(ASM_X86_V1C)\n#if ENC_ROUND == ONE_TABLE\n#define\tFT1_SET\n#elif ENC_ROUND == FOUR_TABLES\n#define\tFT4_SET\n#else\n#define\tSBX_SET\n#endif\n#if LAST_ENC_ROUND == ONE_TABLE\n#define\tFL1_SET\n#elif LAST_ENC_ROUND == FOUR_TABLES\n#define\tFL4_SET\n#elif !defined(SBX_SET)\n#define\tSBX_SET\n#endif\n#endif\n\n#if (FUNCS_IN_C & DECRYPTION_IN_C) || defined(ASM_X86_V1C)\n#if DEC_ROUND == ONE_TABLE\n#define\tIT1_SET\n#elif DEC_ROUND == FOUR_TABLES\n#define\tIT4_SET\n#else\n#define\tISB_SET\n#endif\n#if LAST_DEC_ROUND == ONE_TABLE\n#define\tIL1_SET\n#elif LAST_DEC_ROUND == FOUR_TABLES\n#define\tIL4_SET\n#elif !defined(ISB_SET)\n#define\tISB_SET\n#endif\n#endif\n\n\n#if !(defined(REDUCE_CODE_SIZE) && (defined(ASM_X86_V2) || \\\n\tdefined(ASM_X86_V2C)))\n#if ((FUNCS_IN_C & ENC_KEYING_IN_C) || (FUNCS_IN_C & DEC_KEYING_IN_C))\n#if KEY_SCHED == ONE_TABLE\n#if !defined(FL1_SET) && !defined(FL4_SET)\n#define\tLS1_SET\n#endif\n#elif KEY_SCHED == FOUR_TABLES\n#if !defined(FL4_SET)\n#define\tLS4_SET\n#endif\n#elif !defined(SBX_SET)\n#define\tSBX_SET\n#endif\n#endif\n#if (FUNCS_IN_C & DEC_KEYING_IN_C)\n#if KEY_SCHED == ONE_TABLE\n#define\tIM1_SET\n#elif KEY_SCHED == FOUR_TABLES\n#define\tIM4_SET\n#elif !defined(SBX_SET)\n#define\tSBX_SET\n#endif\n#endif\n#endif\n\n \n\n#define\tno_table(x, box, vf, rf, c) bytes2word(\\\n\tbox[bval(vf(x, 0, c), rf(0, c))], \\\n\tbox[bval(vf(x, 1, c), rf(1, c))], \\\n\tbox[bval(vf(x, 2, c), rf(2, c))], \\\n\tbox[bval(vf(x, 3, c), rf(3, c))])\n\n#define\tone_table(x, op, tab, vf, rf, c) \\\n\t(tab[bval(vf(x, 0, c), rf(0, c))] \\\n\t^ op(tab[bval(vf(x, 1, c), rf(1, c))], 1) \\\n\t^ op(tab[bval(vf(x, 2, c), rf(2, c))], 2) \\\n\t^ op(tab[bval(vf(x, 3, c), rf(3, c))], 3))\n\n#define\tfour_tables(x, tab, vf, rf, c) \\\n\t(tab[0][bval(vf(x, 0, c), rf(0, c))] \\\n\t^ tab[1][bval(vf(x, 1, c), rf(1, c))] \\\n\t^ tab[2][bval(vf(x, 2, c), rf(2, c))] \\\n\t^ tab[3][bval(vf(x, 3, c), rf(3, c))])\n\n#define\tvf1(x, r, c)\t(x)\n#define\trf1(r, c)\t(r)\n#define\trf2(r, c)\t((8+r-c)&3)\n\n \n\n#if !(defined(REDUCE_CODE_SIZE) && (defined(ASM_X86_V2) || \\\n\tdefined(ASM_X86_V2C)))\n\n#if defined(FM4_SET)\t \n#define\tfwd_mcol(x)\tfour_tables(x, t_use(f, m), vf1, rf1, 0)\n#elif defined(FM1_SET)\t \n#define\tfwd_mcol(x)\tone_table(x, upr, t_use(f, m), vf1, rf1, 0)\n#else\n#define\tdec_fmvars\tuint32_t g2\n#define\tfwd_mcol(x)\t(g2 = gf_mulx(x), g2 ^ upr((x) ^ g2, 3) ^ \\\n\t\t\t\tupr((x), 2) ^ upr((x), 1))\n#endif\n\n#if defined(IM4_SET)\n#define\tinv_mcol(x)\tfour_tables(x, t_use(i, m), vf1, rf1, 0)\n#elif defined(IM1_SET)\n#define\tinv_mcol(x)\tone_table(x, upr, t_use(i, m), vf1, rf1, 0)\n#else\n#define\tdec_imvars\tuint32_t g2, g4, g9\n#define\tinv_mcol(x)\t(g2 = gf_mulx(x), g4 = gf_mulx(g2), g9 = \\\n\t\t\t\t(x) ^ gf_mulx(g4), g4 ^= g9, \\\n\t\t\t\t(x) ^ g2 ^ g4 ^ upr(g2 ^ g9, 3) ^ \\\n\t\t\t\tupr(g4, 2) ^ upr(g9, 1))\n#endif\n\n#if defined(FL4_SET)\n#define\tls_box(x, c)\tfour_tables(x, t_use(f, l), vf1, rf2, c)\n#elif defined(LS4_SET)\n#define\tls_box(x, c)\tfour_tables(x, t_use(l, s), vf1, rf2, c)\n#elif defined(FL1_SET)\n#define\tls_box(x, c)\tone_table(x, upr, t_use(f, l), vf1, rf2, c)\n#elif defined(LS1_SET)\n#define\tls_box(x, c)\tone_table(x, upr, t_use(l, s), vf1, rf2, c)\n#else\n#define\tls_box(x, c)\tno_table(x, t_use(s, box), vf1, rf2, c)\n#endif\n\n#endif\n\n#if defined(ASM_X86_V1C) && defined(AES_DECRYPT) && !defined(ISB_SET)\n#define\tISB_SET\n#endif\n\n#ifdef\t__cplusplus\n}\n#endif\n\n#endif\t \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}