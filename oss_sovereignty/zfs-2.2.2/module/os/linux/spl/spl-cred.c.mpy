{
  "module_name": "spl-cred.c",
  "hash_id": "cb4dafc2847270528cd52ac11b4744ce9e1f3a3317782e00a7f0f2a189222819",
  "original_prompt": "Ingested from zfs-2.2.2/module/os/linux/spl/spl-cred.c",
  "human_readable_source": " \n\n#include <sys/cred.h>\n\nstatic int\ncr_groups_search(const struct group_info *group_info, kgid_t grp)\n{\n\tunsigned int left, right, mid;\n\tint cmp;\n\n\tif (!group_info)\n\t\treturn (0);\n\n\tleft = 0;\n\tright = group_info->ngroups;\n\twhile (left < right) {\n\t\tmid = (left + right) / 2;\n\t\tcmp = KGID_TO_SGID(grp) -\n\t\t    KGID_TO_SGID(GROUP_AT(group_info, mid));\n\n\t\tif (cmp > 0)\n\t\t\tleft = mid + 1;\n\t\telse if (cmp < 0)\n\t\t\tright = mid;\n\t\telse\n\t\t\treturn (1);\n\t}\n\treturn (0);\n}\n\n \nvoid\ncrhold(cred_t *cr)\n{\n\t(void) get_cred((const cred_t *)cr);\n}\n\n \nvoid\ncrfree(cred_t *cr)\n{\n\tput_cred((const cred_t *)cr);\n}\n\n \nint\ncrgetngroups(const cred_t *cr)\n{\n\tstruct group_info *gi;\n\tint rc;\n\n\tgi = cr->group_info;\n\trc = gi->ngroups;\n#ifndef HAVE_GROUP_INFO_GID\n\t \n\tif (rc > NGROUPS_PER_BLOCK) {\n\t\tWARN_ON_ONCE(1);\n\t\trc = NGROUPS_PER_BLOCK;\n\t}\n#endif\n\treturn (rc);\n}\n\n \ngid_t *\ncrgetgroups(const cred_t *cr)\n{\n\tstruct group_info *gi;\n\tgid_t *gids = NULL;\n\n\tgi = cr->group_info;\n#ifdef HAVE_GROUP_INFO_GID\n\tgids = KGIDP_TO_SGIDP(gi->gid);\n#else\n\tif (gi->nblocks > 0)\n\t\tgids = KGIDP_TO_SGIDP(gi->blocks[0]);\n#endif\n\treturn (gids);\n}\n\n \nint\ngroupmember(gid_t gid, const cred_t *cr)\n{\n\tstruct group_info *gi;\n\tint rc;\n\n\tgi = cr->group_info;\n\trc = cr_groups_search(gi, SGID_TO_KGID(gid));\n\n\treturn (rc);\n}\n\n \nuid_t\ncrgetuid(const cred_t *cr)\n{\n\treturn (KUID_TO_SUID(cr->fsuid));\n}\n\n \nuid_t\ncrgetruid(const cred_t *cr)\n{\n\treturn (KUID_TO_SUID(cr->uid));\n}\n\n \ngid_t\ncrgetgid(const cred_t *cr)\n{\n\treturn (KGID_TO_SGID(cr->fsgid));\n}\n\n \nzidmap_t *\nzfs_get_init_idmap(void)\n{\n#ifdef HAVE_IOPS_CREATE_IDMAP\n\treturn ((zidmap_t *)&nop_mnt_idmap);\n#else\n\treturn ((zidmap_t *)&init_user_ns);\n#endif\n}\n\nEXPORT_SYMBOL(zfs_get_init_idmap);\nEXPORT_SYMBOL(crhold);\nEXPORT_SYMBOL(crfree);\nEXPORT_SYMBOL(crgetuid);\nEXPORT_SYMBOL(crgetruid);\nEXPORT_SYMBOL(crgetgid);\nEXPORT_SYMBOL(crgetngroups);\nEXPORT_SYMBOL(crgetgroups);\nEXPORT_SYMBOL(groupmember);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}