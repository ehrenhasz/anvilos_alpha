{
  "module_name": "zfs_ioctl_compat.c",
  "hash_id": "3e894e628981659f7d98db3895f679aad291d6fa8ecc37aae8e6d7e8ee064f7e",
  "original_prompt": "Ingested from zfs-2.2.2/module/os/freebsd/zfs/zfs_ioctl_compat.c",
  "human_readable_source": " \n\n#include <sys/cdefs.h>\n__FBSDID(\"$FreeBSD$\");\n\n#include <sys/types.h>\n#include <sys/param.h>\n#include <sys/conf.h>\n#include <sys/kernel.h>\n#include <sys/lock.h>\n#include <sys/malloc.h>\n#include <sys/mutex.h>\n#include <sys/errno.h>\n#include <sys/cmn_err.h>\n#include <sys/zfs_ioctl_compat.h>\n\n#ifdef ZFS_LEGACY_SUPPORT\nenum zfs_ioc_legacy {\n\tZFS_IOC_LEGACY_NONE =\t-1,\n\tZFS_IOC_LEGACY_FIRST =\t0,\n\tZFS_LEGACY_IOC = ZFS_IOC_LEGACY_FIRST,\n\tZFS_IOC_LEGACY_POOL_CREATE = ZFS_IOC_LEGACY_FIRST,\n\tZFS_IOC_LEGACY_POOL_DESTROY,\n\tZFS_IOC_LEGACY_POOL_IMPORT,\n\tZFS_IOC_LEGACY_POOL_EXPORT,\n\tZFS_IOC_LEGACY_POOL_CONFIGS,\n\tZFS_IOC_LEGACY_POOL_STATS,\n\tZFS_IOC_LEGACY_POOL_TRYIMPORT,\n\tZFS_IOC_LEGACY_POOL_SCAN,\n\tZFS_IOC_LEGACY_POOL_FREEZE,\n\tZFS_IOC_LEGACY_POOL_UPGRADE,\n\tZFS_IOC_LEGACY_POOL_GET_HISTORY,\n\tZFS_IOC_LEGACY_VDEV_ADD,\n\tZFS_IOC_LEGACY_VDEV_REMOVE,\n\tZFS_IOC_LEGACY_VDEV_SET_STATE,\n\tZFS_IOC_LEGACY_VDEV_ATTACH,\n\tZFS_IOC_LEGACY_VDEV_DETACH,\n\tZFS_IOC_LEGACY_VDEV_SETPATH,\n\tZFS_IOC_LEGACY_VDEV_SETFRU,\n\tZFS_IOC_LEGACY_OBJSET_STATS,\n\tZFS_IOC_LEGACY_OBJSET_ZPLPROPS,\n\tZFS_IOC_LEGACY_DATASET_LIST_NEXT,\n\tZFS_IOC_LEGACY_SNAPSHOT_LIST_NEXT,\n\tZFS_IOC_LEGACY_SET_PROP,\n\tZFS_IOC_LEGACY_CREATE,\n\tZFS_IOC_LEGACY_DESTROY,\n\tZFS_IOC_LEGACY_ROLLBACK,\n\tZFS_IOC_LEGACY_RENAME,\n\tZFS_IOC_LEGACY_RECV,\n\tZFS_IOC_LEGACY_SEND,\n\tZFS_IOC_LEGACY_INJECT_FAULT,\n\tZFS_IOC_LEGACY_CLEAR_FAULT,\n\tZFS_IOC_LEGACY_INJECT_LIST_NEXT,\n\tZFS_IOC_LEGACY_ERROR_LOG,\n\tZFS_IOC_LEGACY_CLEAR,\n\tZFS_IOC_LEGACY_PROMOTE,\n\tZFS_IOC_LEGACY_DESTROY_SNAPS,\n\tZFS_IOC_LEGACY_SNAPSHOT,\n\tZFS_IOC_LEGACY_DSOBJ_TO_DSNAME,\n\tZFS_IOC_LEGACY_OBJ_TO_PATH,\n\tZFS_IOC_LEGACY_POOL_SET_PROPS,\n\tZFS_IOC_LEGACY_POOL_GET_PROPS,\n\tZFS_IOC_LEGACY_SET_FSACL,\n\tZFS_IOC_LEGACY_GET_FSACL,\n\tZFS_IOC_LEGACY_SHARE,\n\tZFS_IOC_LEGACY_INHERIT_PROP,\n\tZFS_IOC_LEGACY_SMB_ACL,\n\tZFS_IOC_LEGACY_USERSPACE_ONE,\n\tZFS_IOC_LEGACY_USERSPACE_MANY,\n\tZFS_IOC_LEGACY_USERSPACE_UPGRADE,\n\tZFS_IOC_LEGACY_HOLD,\n\tZFS_IOC_LEGACY_RELEASE,\n\tZFS_IOC_LEGACY_GET_HOLDS,\n\tZFS_IOC_LEGACY_OBJSET_RECVD_PROPS,\n\tZFS_IOC_LEGACY_VDEV_SPLIT,\n\tZFS_IOC_LEGACY_NEXT_OBJ,\n\tZFS_IOC_LEGACY_DIFF,\n\tZFS_IOC_LEGACY_TMP_SNAPSHOT,\n\tZFS_IOC_LEGACY_OBJ_TO_STATS,\n\tZFS_IOC_LEGACY_JAIL,\n\tZFS_IOC_LEGACY_UNJAIL,\n\tZFS_IOC_LEGACY_POOL_REGUID,\n\tZFS_IOC_LEGACY_SPACE_WRITTEN,\n\tZFS_IOC_LEGACY_SPACE_SNAPS,\n\tZFS_IOC_LEGACY_SEND_PROGRESS,\n\tZFS_IOC_LEGACY_POOL_REOPEN,\n\tZFS_IOC_LEGACY_LOG_HISTORY,\n\tZFS_IOC_LEGACY_SEND_NEW,\n\tZFS_IOC_LEGACY_SEND_SPACE,\n\tZFS_IOC_LEGACY_CLONE,\n\tZFS_IOC_LEGACY_BOOKMARK,\n\tZFS_IOC_LEGACY_GET_BOOKMARKS,\n\tZFS_IOC_LEGACY_DESTROY_BOOKMARKS,\n\tZFS_IOC_LEGACY_NEXTBOOT,\n\tZFS_IOC_LEGACY_CHANNEL_PROGRAM,\n\tZFS_IOC_LEGACY_REMAP,\n\tZFS_IOC_LEGACY_POOL_CHECKPOINT,\n\tZFS_IOC_LEGACY_POOL_DISCARD_CHECKPOINT,\n\tZFS_IOC_LEGACY_POOL_INITIALIZE,\n\tZFS_IOC_LEGACY_POOL_SYNC,\n\tZFS_IOC_LEGACY_LAST\n};\n\nstatic unsigned long zfs_ioctl_legacy_to_ozfs_[] = {\n\tZFS_IOC_POOL_CREATE,\t\t\t \n\tZFS_IOC_POOL_DESTROY,\t\t\t \n\tZFS_IOC_POOL_IMPORT,\t\t\t \n\tZFS_IOC_POOL_EXPORT,\t\t\t \n\tZFS_IOC_POOL_CONFIGS,\t\t\t \n\tZFS_IOC_POOL_STATS,\t\t\t \n\tZFS_IOC_POOL_TRYIMPORT,\t\t\t \n\tZFS_IOC_POOL_SCAN,\t\t\t \n\tZFS_IOC_POOL_FREEZE,\t\t\t \n\tZFS_IOC_POOL_UPGRADE,\t\t\t \n\tZFS_IOC_POOL_GET_HISTORY,\t\t \n\tZFS_IOC_VDEV_ADD,\t\t\t \n\tZFS_IOC_VDEV_REMOVE,\t\t\t \n\tZFS_IOC_VDEV_SET_STATE,\t\t\t \n\tZFS_IOC_VDEV_ATTACH,\t\t\t \n\tZFS_IOC_VDEV_DETACH,\t\t\t \n\tZFS_IOC_VDEV_SETPATH,\t\t\t \n\tZFS_IOC_VDEV_SETFRU,\t\t\t \n\tZFS_IOC_OBJSET_STATS,\t\t\t \n\tZFS_IOC_OBJSET_ZPLPROPS,\t\t \n\tZFS_IOC_DATASET_LIST_NEXT,\t\t \n\tZFS_IOC_SNAPSHOT_LIST_NEXT,\t\t \n\tZFS_IOC_SET_PROP,\t\t\t \n\tZFS_IOC_CREATE,\t\t\t\t \n\tZFS_IOC_DESTROY,\t\t\t \n\tZFS_IOC_ROLLBACK,\t\t\t \n\tZFS_IOC_RENAME,\t\t\t\t \n\tZFS_IOC_RECV,\t\t\t\t \n\tZFS_IOC_SEND,\t\t\t\t \n\tZFS_IOC_INJECT_FAULT,\t\t\t \n\tZFS_IOC_CLEAR_FAULT,\t\t\t \n\tZFS_IOC_INJECT_LIST_NEXT,\t\t \n\tZFS_IOC_ERROR_LOG,\t\t\t \n\tZFS_IOC_CLEAR,\t\t\t\t \n\tZFS_IOC_PROMOTE,\t\t\t \n\t \n\n\tZFS_IOC_DESTROY_SNAPS,\t\t\t \n\tZFS_IOC_SNAPSHOT,\t\t\t \n\tZFS_IOC_DSOBJ_TO_DSNAME,\t\t \n\tZFS_IOC_OBJ_TO_PATH,\t\t\t \n\tZFS_IOC_POOL_SET_PROPS,\t\t\t \n\tZFS_IOC_POOL_GET_PROPS,\t\t\t \n\tZFS_IOC_SET_FSACL,\t\t\t \n\tZFS_IOC_GET_FSACL,\t\t\t \n\tZFS_IOC_SHARE,\t\t\t\t \n\tZFS_IOC_INHERIT_PROP,\t\t\t \n\tZFS_IOC_SMB_ACL,\t\t\t \n\tZFS_IOC_USERSPACE_ONE,\t\t\t \n\tZFS_IOC_USERSPACE_MANY,\t\t\t \n\tZFS_IOC_USERSPACE_UPGRADE,\t\t \n\tZFS_IOC_HOLD,\t\t\t\t \n\tZFS_IOC_RELEASE,\t\t\t \n\tZFS_IOC_GET_HOLDS,\t\t\t \n\tZFS_IOC_OBJSET_RECVD_PROPS,\t\t \n\tZFS_IOC_VDEV_SPLIT,\t\t\t \n\tZFS_IOC_NEXT_OBJ,\t\t\t \n\tZFS_IOC_DIFF,\t\t\t\t \n\tZFS_IOC_TMP_SNAPSHOT,\t\t\t \n\tZFS_IOC_OBJ_TO_STATS,\t\t\t \n\tZFS_IOC_JAIL,\t\t\t \n\tZFS_IOC_UNJAIL,\t\t\t \n\tZFS_IOC_POOL_REGUID,\t\t\t \n\tZFS_IOC_SPACE_WRITTEN,\t\t\t \n\tZFS_IOC_SPACE_SNAPS,\t\t\t \n\tZFS_IOC_SEND_PROGRESS,\t\t\t \n\tZFS_IOC_POOL_REOPEN,\t\t\t \n\tZFS_IOC_LOG_HISTORY,\t\t\t \n\tZFS_IOC_SEND_NEW,\t\t\t \n\tZFS_IOC_SEND_SPACE,\t\t\t \n\tZFS_IOC_CLONE,\t\t\t\t \n\tZFS_IOC_BOOKMARK,\t\t\t \n\tZFS_IOC_GET_BOOKMARKS,\t\t\t \n\tZFS_IOC_DESTROY_BOOKMARKS,\t\t \n\tZFS_IOC_NEXTBOOT,\t\t\t \n\tZFS_IOC_CHANNEL_PROGRAM,\t\t \n\tZFS_IOC_REMAP,\t\t\t\t \n\tZFS_IOC_POOL_CHECKPOINT,\t\t \n\tZFS_IOC_POOL_DISCARD_CHECKPOINT,\t \n\tZFS_IOC_POOL_INITIALIZE,\t\t \n};\n\nstatic unsigned long zfs_ioctl_ozfs_to_legacy_common_[] = {\n\tZFS_IOC_POOL_CREATE,\t\t\t \n\tZFS_IOC_POOL_DESTROY,\t\t\t \n\tZFS_IOC_POOL_IMPORT,\t\t\t \n\tZFS_IOC_POOL_EXPORT,\t\t\t \n\tZFS_IOC_POOL_CONFIGS,\t\t\t \n\tZFS_IOC_POOL_STATS,\t\t\t \n\tZFS_IOC_POOL_TRYIMPORT,\t\t\t \n\tZFS_IOC_POOL_SCAN,\t\t\t \n\tZFS_IOC_POOL_FREEZE,\t\t\t \n\tZFS_IOC_POOL_UPGRADE,\t\t\t \n\tZFS_IOC_POOL_GET_HISTORY,\t\t \n\tZFS_IOC_VDEV_ADD,\t\t\t \n\tZFS_IOC_VDEV_REMOVE,\t\t\t \n\tZFS_IOC_VDEV_SET_STATE,\t\t\t \n\tZFS_IOC_VDEV_ATTACH,\t\t\t \n\tZFS_IOC_VDEV_DETACH,\t\t\t \n\tZFS_IOC_VDEV_SETPATH,\t\t\t \n\tZFS_IOC_VDEV_SETFRU,\t\t\t \n\tZFS_IOC_OBJSET_STATS,\t\t\t \n\tZFS_IOC_OBJSET_ZPLPROPS,\t\t \n\tZFS_IOC_DATASET_LIST_NEXT,\t\t \n\tZFS_IOC_SNAPSHOT_LIST_NEXT,\t\t \n\tZFS_IOC_SET_PROP,\t\t\t \n\tZFS_IOC_CREATE,\t\t\t\t \n\tZFS_IOC_DESTROY,\t\t\t \n\tZFS_IOC_ROLLBACK,\t\t\t \n\tZFS_IOC_RENAME,\t\t\t\t \n\tZFS_IOC_RECV,\t\t\t\t \n\tZFS_IOC_SEND,\t\t\t\t \n\tZFS_IOC_INJECT_FAULT,\t\t\t \n\tZFS_IOC_CLEAR_FAULT,\t\t\t \n\tZFS_IOC_INJECT_LIST_NEXT,\t\t \n\tZFS_IOC_ERROR_LOG,\t\t\t \n\tZFS_IOC_CLEAR,\t\t\t\t \n\tZFS_IOC_PROMOTE,\t\t\t \n\t \n\tZFS_IOC_LEGACY_SNAPSHOT,\t\t \n\tZFS_IOC_LEGACY_DSOBJ_TO_DSNAME,\t\t \n\tZFS_IOC_LEGACY_OBJ_TO_PATH,\t\t \n\tZFS_IOC_LEGACY_POOL_SET_PROPS,\t\t \n\tZFS_IOC_LEGACY_POOL_GET_PROPS,\t\t \n\tZFS_IOC_LEGACY_SET_FSACL,\t\t \n\tZFS_IOC_LEGACY_GET_FSACL,\t\t \n\tZFS_IOC_LEGACY_SHARE,\t\t\t \n\tZFS_IOC_LEGACY_INHERIT_PROP,\t\t \n\tZFS_IOC_LEGACY_SMB_ACL,\t\t\t \n\tZFS_IOC_LEGACY_USERSPACE_ONE,\t\t \n\tZFS_IOC_LEGACY_USERSPACE_MANY,\t\t \n\tZFS_IOC_LEGACY_USERSPACE_UPGRADE,\t \n\tZFS_IOC_LEGACY_HOLD,\t\t\t \n\tZFS_IOC_LEGACY_RELEASE,\t\t\t \n\tZFS_IOC_LEGACY_GET_HOLDS,\t\t \n\tZFS_IOC_LEGACY_OBJSET_RECVD_PROPS,\t \n\tZFS_IOC_LEGACY_VDEV_SPLIT,\t\t \n\tZFS_IOC_LEGACY_NEXT_OBJ,\t\t \n\tZFS_IOC_LEGACY_DIFF,\t\t\t \n\tZFS_IOC_LEGACY_TMP_SNAPSHOT,\t\t \n\tZFS_IOC_LEGACY_OBJ_TO_STATS,\t\t \n\tZFS_IOC_LEGACY_SPACE_WRITTEN,\t\t \n\tZFS_IOC_LEGACY_SPACE_SNAPS,\t\t \n\tZFS_IOC_LEGACY_DESTROY_SNAPS,\t\t \n\tZFS_IOC_LEGACY_POOL_REGUID,\t\t \n\tZFS_IOC_LEGACY_POOL_REOPEN,\t\t \n\tZFS_IOC_LEGACY_SEND_PROGRESS,\t\t \n\tZFS_IOC_LEGACY_LOG_HISTORY,\t\t \n\tZFS_IOC_LEGACY_SEND_NEW,\t\t \n\tZFS_IOC_LEGACY_SEND_SPACE,\t\t \n\tZFS_IOC_LEGACY_CLONE,\t\t\t \n\tZFS_IOC_LEGACY_BOOKMARK,\t\t \n\tZFS_IOC_LEGACY_GET_BOOKMARKS,\t\t \n\tZFS_IOC_LEGACY_DESTROY_BOOKMARKS,\t \n\tZFS_IOC_LEGACY_NONE,  \n\tZFS_IOC_LEGACY_POOL_SYNC,\t\t \n\tZFS_IOC_LEGACY_CHANNEL_PROGRAM,\t\t \n\tZFS_IOC_LEGACY_NONE,  \n\tZFS_IOC_LEGACY_NONE,  \n\tZFS_IOC_LEGACY_NONE,  \n\tZFS_IOC_LEGACY_REMAP,\t\t\t \n\tZFS_IOC_LEGACY_POOL_CHECKPOINT,\t\t \n\tZFS_IOC_LEGACY_POOL_DISCARD_CHECKPOINT,\t \n\tZFS_IOC_LEGACY_POOL_INITIALIZE,\t\t \n\tZFS_IOC_LEGACY_NONE,  \n\tZFS_IOC_LEGACY_NONE,  \n\tZFS_IOC_LEGACY_NONE,  \n\tZFS_IOC_LEGACY_NONE,  \n\tZFS_IOC_LEGACY_NONE,  \n};\n\nstatic unsigned long zfs_ioctl_ozfs_to_legacy_platform_[] = {\n\tZFS_IOC_LEGACY_NONE,  \n\tZFS_IOC_LEGACY_NONE,  \n\tZFS_IOC_LEGACY_NONE,  \n\tZFS_IOC_LEGACY_NEXTBOOT,\n\tZFS_IOC_LEGACY_JAIL,\n\tZFS_IOC_LEGACY_UNJAIL,\n\tZFS_IOC_LEGACY_NONE,  \n\tZFS_IOC_LEGACY_NONE,  \n};\n\nint\nzfs_ioctl_legacy_to_ozfs(int request)\n{\n\tif (request >= sizeof (zfs_ioctl_legacy_to_ozfs_)/sizeof (long))\n\t\treturn (-1);\n\treturn (zfs_ioctl_legacy_to_ozfs_[request]);\n}\n\nint\nzfs_ioctl_ozfs_to_legacy(int request)\n{\n\tif (request >= ZFS_IOC_LAST)\n\t\treturn (-1);\n\n\tif (request > ZFS_IOC_PLATFORM) {\n\t\trequest -= ZFS_IOC_PLATFORM + 1;\n\t\treturn (zfs_ioctl_ozfs_to_legacy_platform_[request]);\n\t}\n\tif (request >= sizeof (zfs_ioctl_ozfs_to_legacy_common_)/sizeof (long))\n\t\treturn (-1);\n\treturn (zfs_ioctl_ozfs_to_legacy_common_[request]);\n}\n\nvoid\nzfs_cmd_legacy_to_ozfs(zfs_cmd_legacy_t *src, zfs_cmd_t *dst)\n{\n\tmemcpy(dst, src, offsetof(zfs_cmd_t, zc_objset_stats));\n\t*&dst->zc_objset_stats = *&src->zc_objset_stats;\n\tmemcpy(&dst->zc_begin_record, &src->zc_begin_record,\n\t    offsetof(zfs_cmd_t, zc_sendobj) -\n\t    offsetof(zfs_cmd_t, zc_begin_record));\n\tmemcpy(&dst->zc_sendobj, &src->zc_sendobj,\n\t    sizeof (zfs_cmd_t) - 8 - offsetof(zfs_cmd_t, zc_sendobj));\n\tdst->zc_zoneid = src->zc_jailid;\n}\n\nvoid\nzfs_cmd_ozfs_to_legacy(zfs_cmd_t *src, zfs_cmd_legacy_t *dst)\n{\n\tmemcpy(dst, src, offsetof(zfs_cmd_t, zc_objset_stats));\n\t*&dst->zc_objset_stats = *&src->zc_objset_stats;\n\t*&dst->zc_begin_record.drr_u.drr_begin = *&src->zc_begin_record;\n\tdst->zc_begin_record.drr_payloadlen = 0;\n\tdst->zc_begin_record.drr_type = 0;\n\n\tmemcpy(&dst->zc_inject_record, &src->zc_inject_record,\n\t    offsetof(zfs_cmd_t, zc_sendobj) -\n\t    offsetof(zfs_cmd_t, zc_inject_record));\n\tdst->zc_resumable = B_FALSE;\n\tmemcpy(&dst->zc_sendobj, &src->zc_sendobj,\n\t    sizeof (zfs_cmd_t) - 8 - offsetof(zfs_cmd_t, zc_sendobj));\n\tdst->zc_jailid = src->zc_zoneid;\n}\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}