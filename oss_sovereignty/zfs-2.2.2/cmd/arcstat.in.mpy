{
  "module_name": "arcstat.in",
  "hash_id": "7c28429b8e12e0824ce208d669aa11f49ec0f3b7ce43bdc18ecc4139ca9acd1e",
  "original_prompt": "Ingested from zfs-2.2.2/cmd/arcstat.in",
  "human_readable_source": "#!/usr/bin/env @PYTHON_SHEBANG@\n#\n# Print out ZFS ARC Statistics exported via kstat(1)\n# For a definition of fields, or usage, use arcstat -v\n#\n# This script was originally a fork of the original arcstat.pl (0.1)\n# by Neelakanth Nadgir, originally published on his Sun blog on\n# 09/18/2007\n#     http://blogs.sun.com/realneel/entry/zfs_arc_statistics\n#\n# A new version aimed to improve upon the original by adding features\n# and fixing bugs as needed.  This version was maintained by Mike\n# Harsch and was hosted in a public open source repository:\n#    http://github.com/mharsch/arcstat\n#\n# but has since moved to the illumos-gate repository.\n#\n# This Python port was written by John Hixson for FreeNAS, introduced\n# in commit e2c29f:\n#    https://github.com/freenas/freenas\n#\n# and has been improved by many people since.\n#\n# CDDL HEADER START\n#\n# The contents of this file are subject to the terms of the\n# Common Development and Distribution License, Version 1.0 only\n# (the \"License\").  You may not use this file except in compliance\n# with the License.\n#\n# You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE\n# or https://opensource.org/licenses/CDDL-1.0.\n# See the License for the specific language governing permissions\n# and limitations under the License.\n#\n# When distributing Covered Code, include this CDDL HEADER in each\n# file and include the License file at usr/src/OPENSOLARIS.LICENSE.\n# If applicable, add the following below this CDDL HEADER, with the\n# fields enclosed by brackets \"[]\" replaced with your own identifying\n# information: Portions Copyright [yyyy] [name of copyright owner]\n#\n# CDDL HEADER END\n#\n#\n# Fields have a fixed width. Every interval, we fill the \"v\"\n# hash with its corresponding value (v[field]=value) using calculate().\n# @hdr is the array of fields that needs to be printed, so we\n# just iterate over this array and print the values using our pretty printer.\n#\n# This script must remain compatible with Python 3.6+.\n#\n\nimport sys\nimport time\nimport getopt\nimport re\nimport copy\n\nfrom signal import signal, SIGINT, SIGWINCH, SIG_DFL\n\n\ncols = {\n    # HDR:        [Size, Scale, Description]\n    \"time\":       [8, -1, \"Time\"],\n    \"hits\":       [4, 1000, \"ARC hits per second\"],\n    \"iohs\":       [4, 1000, \"ARC I/O hits per second\"],\n    \"miss\":       [4, 1000, \"ARC misses per second\"],\n    \"read\":       [4, 1000, \"Total ARC accesses per second\"],\n    \"hit%\":       [4, 100, \"ARC hit percentage\"],\n    \"ioh%\":       [4, 100, \"ARC I/O hit percentage\"],\n    \"miss%\":      [5, 100, \"ARC miss percentage\"],\n    \"dhit\":       [4, 1000, \"Demand hits per second\"],\n    \"dioh\":       [4, 1000, \"Demand I/O hits per second\"],\n    \"dmis\":       [4, 1000, \"Demand misses per second\"],\n    \"dh%\":        [3, 100, \"Demand hit percentage\"],\n    \"di%\":        [3, 100, \"Demand I/O hit percentage\"],\n    \"dm%\":        [3, 100, \"Demand miss percentage\"],\n    \"ddhit\":      [5, 1000, \"Demand data hits per second\"],\n    \"ddioh\":      [5, 1000, \"Demand data I/O hits per second\"],\n    \"ddmis\":      [5, 1000, \"Demand data misses per second\"],\n    \"ddh%\":       [4, 100, \"Demand data hit percentage\"],\n    \"ddi%\":       [4, 100, \"Demand data I/O hit percentage\"],\n    \"ddm%\":       [4, 100, \"Demand data miss percentage\"],\n    \"dmhit\":      [5, 1000, \"Demand metadata hits per second\"],\n    \"dmioh\":      [5, 1000, \"Demand metadata I/O hits per second\"],\n    \"dmmis\":      [5, 1000, \"Demand metadata misses per second\"],\n    \"dmh%\":       [4, 100, \"Demand metadata hit percentage\"],\n    \"dmi%\":       [4, 100, \"Demand metadata I/O hit percentage\"],\n    \"dmm%\":       [4, 100, \"Demand metadata miss percentage\"],\n    \"phit\":       [4, 1000, \"Prefetch hits per second\"],\n    \"pioh\":       [4, 1000, \"Prefetch I/O hits per second\"],\n    \"pmis\":       [4, 1000, \"Prefetch misses per second\"],\n    \"ph%\":        [3, 100, \"Prefetch hits percentage\"],\n    \"pi%\":        [3, 100, \"Prefetch I/O hits percentage\"],\n    \"pm%\":        [3, 100, \"Prefetch miss percentage\"],\n    \"pdhit\":      [5, 1000, \"Prefetch data hits per second\"],\n    \"pdioh\":      [5, 1000, \"Prefetch data I/O hits per second\"],\n    \"pdmis\":      [5, 1000, \"Prefetch data misses per second\"],\n    \"pdh%\":       [4, 100, \"Prefetch data hits percentage\"],\n    \"pdi%\":       [4, 100, \"Prefetch data I/O hits percentage\"],\n    \"pdm%\":       [4, 100, \"Prefetch data miss percentage\"],\n    \"pmhit\":      [5, 1000, \"Prefetch metadata hits per second\"],\n    \"pmioh\":      [5, 1000, \"Prefetch metadata I/O hits per second\"],\n    \"pmmis\":      [5, 1000, \"Prefetch metadata misses per second\"],\n    \"pmh%\":       [4, 100, \"Prefetch metadata hits percentage\"],\n    \"pmi%\":       [4, 100, \"Prefetch metadata I/O hits percentage\"],\n    \"pmm%\":       [4, 100, \"Prefetch metadata miss percentage\"],\n    \"mhit\":       [4, 1000, \"Metadata hits per second\"],\n    \"mioh\":       [4, 1000, \"Metadata I/O hits per second\"],\n    \"mmis\":       [4, 1000, \"Metadata misses per second\"],\n    \"mread\":      [5, 1000, \"Metadata accesses per second\"],\n    \"mh%\":        [3, 100, \"Metadata hit percentage\"],\n    \"mi%\":        [3, 100, \"Metadata I/O hit percentage\"],\n    \"mm%\":        [3, 100, \"Metadata miss percentage\"],\n    \"arcsz\":      [5, 1024, \"ARC size\"],\n    \"size\":       [5, 1024, \"ARC size\"],\n    \"c\":          [5, 1024, \"ARC target size\"],\n    \"mfu\":        [4, 1000, \"MFU list hits per second\"],\n    \"mru\":        [4, 1000, \"MRU list hits per second\"],\n    \"mfug\":       [4, 1000, \"MFU ghost list hits per second\"],\n    \"mrug\":       [4, 1000, \"MRU ghost list hits per second\"],\n    \"unc\":        [4, 1000, \"Uncached list hits per second\"],\n    \"eskip\":      [5, 1000, \"evict_skip per second\"],\n    \"el2skip\":    [7, 1000, \"evict skip, due to l2 writes, per second\"],\n    \"el2cach\":    [7, 1024, \"Size of L2 cached evictions per second\"],\n    \"el2el\":      [5, 1024, \"Size of L2 eligible evictions per second\"],\n    \"el2mfu\":     [6, 1024, \"Size of L2 eligible MFU evictions per second\"],\n    \"el2mru\":     [6, 1024, \"Size of L2 eligible MRU evictions per second\"],\n    \"el2inel\":    [7, 1024, \"Size of L2 ineligible evictions per second\"],\n    \"mtxmis\":     [6, 1000, \"mutex_miss per second\"],\n    \"dread\":      [5, 1000, \"Demand accesses per second\"],\n    \"ddread\":     [6, 1000, \"Demand data accesses per second\"],\n    \"dmread\":     [6, 1000, \"Demand metadata accesses per second\"],\n    \"pread\":      [5, 1000, \"Prefetch accesses per second\"],\n    \"pdread\":     [6, 1000, \"Prefetch data accesses per second\"],\n    \"pmread\":     [6, 1000, \"Prefetch metadata accesses per second\"],\n    \"l2hits\":     [6, 1000, \"L2ARC hits per second\"],\n    \"l2miss\":     [6, 1000, \"L2ARC misses per second\"],\n    \"l2read\":     [6, 1000, \"Total L2ARC accesses per second\"],\n    \"l2hit%\":     [6, 100, \"L2ARC access hit percentage\"],\n    \"l2miss%\":    [7, 100, \"L2ARC access miss percentage\"],\n    \"l2pref\":     [6, 1024, \"L2ARC prefetch allocated size\"],\n    \"l2mfu\":      [5, 1024, \"L2ARC MFU allocated size\"],\n    \"l2mru\":      [5, 1024, \"L2ARC MRU allocated size\"],\n    \"l2data\":     [6, 1024, \"L2ARC data allocated size\"],\n    \"l2meta\":     [6, 1024, \"L2ARC metadata allocated size\"],\n    \"l2pref%\":    [7, 100, \"L2ARC prefetch percentage\"],\n    \"l2mfu%\":     [6, 100, \"L2ARC MFU percentage\"],\n    \"l2mru%\":     [6, 100, \"L2ARC MRU percentage\"],\n    \"l2data%\":    [7, 100, \"L2ARC data percentage\"],\n    \"l2meta%\":    [7, 100, \"L2ARC metadata percentage\"],\n    \"l2asize\":    [7, 1024, \"Actual (compressed) size of the L2ARC\"],\n    \"l2size\":     [6, 1024, \"Size of the L2ARC\"],\n    \"l2bytes\":    [7, 1024, \"Bytes read per second from the L2ARC\"],\n    \"grow\":       [4, 1000, \"ARC grow disabled\"],\n    \"need\":       [5, 1024, \"ARC reclaim need\"],\n    \"free\":       [5, 1024, \"ARC free memory\"],\n    \"avail\":      [5, 1024, \"ARC available memory\"],\n    \"waste\":      [5, 1024, \"Wasted memory due to round up to pagesize\"],\n}\n\nv = {}\nhdr = [\"time\", \"read\", \"ddread\", \"ddh%\", \"dmread\", \"dmh%\", \"pread\", \"ph%\",\n       \"size\", \"c\", \"avail\"]\nxhdr = [\"time\", \"mfu\", \"mru\", \"mfug\", \"mrug\", \"unc\", \"eskip\", \"mtxmis\",\n        \"dread\", \"pread\", \"read\"]\nsint = 1               # Default interval is 1 second\ncount = 1              # Default count is 1\nhdr_intr = 20          # Print header every 20 lines of output\nopfile = None\nsep = \"  \"              # Default separator is 2 spaces\nl2exist = False\ncmd = (\"Usage: arcstat [-havxp] [-f fields] [-o file] [-s string] [interval \"\n       \"[count]]\\n\")\ncur = {}\nd = {}\nout = None\nkstat = None\npretty_print = True\n\n\nif sys.platform.startswith('freebsd'):\n    # Requires py-sysctl on FreeBSD\n    import sysctl\n\n    def kstat_update():\n        global kstat\n\n        k = [ctl for ctl in sysctl.filter('kstat.zfs.misc.arcstats')\n             if ctl.type != sysctl.CTLTYPE_NODE]\n\n        if not k:\n            sys.exit(1)\n\n        kstat = {}\n\n        for s in k:\n            if not s:\n                continue\n\n            name, value = s.name, s.value\n            # Trims 'kstat.zfs.misc.arcstats' from the name\n            kstat[name[24:]] = int(value)\n\nelif sys.platform.startswith('linux'):\n    def kstat_update():\n        global kstat\n\n        k = [line.strip() for line in open('/proc/spl/kstat/zfs/arcstats')]\n\n        if not k:\n            sys.exit(1)\n\n        del k[0:2]\n        kstat = {}\n\n        for s in k:\n            if not s:\n                continue\n\n            name, unused, value = s.split()\n            kstat[name] = int(value)\n\n\ndef detailed_usage():\n    sys.stderr.write(\"%s\\n\" % cmd)\n    sys.stderr.write(\"Field definitions are as follows:\\n\")\n    for key in cols:\n        sys.stderr.write(\"%11s : %s\\n\" % (key, cols[key][2]))\n    sys.stderr.write(\"\\n\")\n\n    sys.exit(0)\n\n\ndef usage():\n    sys.stderr.write(\"%s\\n\" % cmd)\n    sys.stderr.write(\"\\t -h : Print this help message\\n\")\n    sys.stderr.write(\"\\t -a : Print all possible stats\\n\")\n    sys.stderr.write(\"\\t -v : List all possible field headers and definitions\"\n                     \"\\n\")\n    sys.stderr.write(\"\\t -x : Print extended stats\\n\")\n    sys.stderr.write(\"\\t -f : Specify specific fields to print (see -v)\\n\")\n    sys.stderr.write(\"\\t -o : Redirect output to the specified file\\n\")\n    sys.stderr.write(\"\\t -s : Override default field separator with custom \"\n                     \"character or string\\n\")\n    sys.stderr.write(\"\\t -p : Disable auto-scaling of numerical fields\\n\")\n    sys.stderr.write(\"\\nExamples:\\n\")\n    sys.stderr.write(\"\\tarcstat -o /tmp/a.log 2 10\\n\")\n    sys.stderr.write(\"\\tarcstat -s \\\",\\\" -o /tmp/a.log 2 10\\n\")\n    sys.stderr.write(\"\\tarcstat -v\\n\")\n    sys.stderr.write(\"\\tarcstat -f time,hit%,dh%,ph%,mh% 1\\n\")\n    sys.stderr.write(\"\\n\")\n\n    sys.exit(1)\n\n\ndef snap_stats():\n    global cur\n    global kstat\n\n    prev = copy.deepcopy(cur)\n    kstat_update()\n\n    cur = kstat\n    for key in cur:\n        if re.match(key, \"class\"):\n            continue\n        if key in prev:\n            d[key] = cur[key] - prev[key]\n        else:\n            d[key] = cur[key]\n\n\ndef prettynum(sz, scale, num=0):\n    suffix = [' ', 'K', 'M', 'G', 'T', 'P', 'E', 'Z']\n    index = 0\n    save = 0\n\n    # Special case for date field\n    if scale == -1:\n        return \"%s\" % num\n\n    # Rounding error, return 0\n    elif 0 < num < 1:\n        num = 0\n\n    while abs(num) > scale and index < 5:\n        save = num\n        num = num / scale\n        index += 1\n\n    if index == 0:\n        return \"%*d\" % (sz, num)\n\n    if abs(save / scale) < 10:\n        return \"%*.1f%s\" % (sz - 1, num, suffix[index])\n    else:\n        return \"%*d%s\" % (sz - 1, num, suffix[index])\n\n\ndef print_values():\n    global hdr\n    global sep\n    global v\n    global pretty_print\n\n    if pretty_print:\n        fmt = lambda col: prettynum(cols[col][0], cols[col][1], v[col])\n    else:\n        fmt = lambda col: str(v[col])\n\n    sys.stdout.write(sep.join(fmt(col) for col in hdr))\n    sys.stdout.write(\"\\n\")\n    sys.stdout.flush()\n\n\ndef print_header():\n    global hdr\n    global sep\n    global pretty_print\n\n    if pretty_print:\n        fmt = lambda col: \"%*s\" % (cols[col][0], col)\n    else:\n        fmt = lambda col: col\n\n    sys.stdout.write(sep.join(fmt(col) for col in hdr))\n    sys.stdout.write(\"\\n\")\n\n\ndef get_terminal_lines():\n    try:\n        import fcntl\n        import termios\n        import struct\n        data = fcntl.ioctl(sys.stdout.fileno(), termios.TIOCGWINSZ, '1234')\n        sz = struct.unpack('hh', data)\n        return sz[0]\n    except Exception:\n        pass\n\n\ndef update_hdr_intr():\n    global hdr_intr\n\n    lines = get_terminal_lines()\n    if lines and lines > 3:\n        hdr_intr = lines - 3\n\n\ndef resize_handler(signum, frame):\n    update_hdr_intr()\n\n\ndef init():\n    global sint\n    global count\n    global hdr\n    global xhdr\n    global opfile\n    global sep\n    global out\n    global l2exist\n    global pretty_print\n\n    desired_cols = None\n    aflag = False\n    xflag = False\n    hflag = False\n    vflag = False\n    i = 1\n\n    try:\n        opts, args = getopt.getopt(\n            sys.argv[1:],\n            \"axo:hvs:f:p\",\n            [\n                \"all\",\n                \"extended\",\n                \"outfile\",\n                \"help\",\n                \"verbose\",\n                \"separator\",\n                \"columns\",\n                \"parsable\"\n            ]\n        )\n    except getopt.error as msg:\n        sys.stderr.write(\"Error: %s\\n\" % str(msg))\n        usage()\n        opts = None\n\n    for opt, arg in opts:\n        if opt in ('-a', '--all'):\n            aflag = True\n        if opt in ('-x', '--extended'):\n            xflag = True\n        if opt in ('-o', '--outfile'):\n            opfile = arg\n            i += 1\n        if opt in ('-h', '--help'):\n            hflag = True\n        if opt in ('-v', '--verbose'):\n            vflag = True\n        if opt in ('-s', '--separator'):\n            sep = arg\n            i += 1\n        if opt in ('-f', '--columns'):\n            desired_cols = arg\n            i += 1\n        if opt in ('-p', '--parsable'):\n            pretty_print = False\n        i += 1\n\n    argv = sys.argv[i:]\n    sint = int(argv[0]) if argv else sint\n    count = int(argv[1]) if len(argv) > 1 else (0 if len(argv) > 0 else 1)\n\n    if hflag or (xflag and desired_cols):\n        usage()\n\n    if vflag:\n        detailed_usage()\n\n    if xflag:\n        hdr = xhdr\n\n    update_hdr_intr()\n\n    # check if L2ARC exists\n    snap_stats()\n    l2_size = cur.get(\"l2_size\")\n    if l2_size:\n        l2exist = True\n\n    if desired_cols:\n        hdr = desired_cols.split(\",\")\n\n        invalid = []\n        incompat = []\n        for ele in hdr:\n            if ele not in cols:\n                invalid.append(ele)\n            elif not l2exist and ele.startswith(\"l2\"):\n                sys.stdout.write(\"No L2ARC Here\\n%s\\n\" % ele)\n                incompat.append(ele)\n\n        if len(invalid) > 0:\n            sys.stderr.write(\"Invalid column definition! -- %s\\n\" % invalid)\n            usage()\n\n        if len(incompat) > 0:\n            sys.stderr.write(\"Incompatible field specified! -- %s\\n\" %\n                             incompat)\n            usage()\n\n    if aflag:\n        if l2exist:\n            hdr = cols.keys()\n        else:\n            hdr = [col for col in cols.keys() if not col.startswith(\"l2\")]\n\n    if opfile:\n        try:\n            out = open(opfile, \"w\")\n            sys.stdout = out\n\n        except IOError:\n            sys.stderr.write(\"Cannot open %s for writing\\n\" % opfile)\n            sys.exit(1)\n\n\ndef calculate():\n    global d\n    global v\n    global l2exist\n\n    v = dict()\n    v[\"time\"] = time.strftime(\"%H:%M:%S\", time.localtime())\n    v[\"hits\"] = d[\"hits\"] // sint\n    v[\"iohs\"] = d[\"iohits\"] // sint\n    v[\"miss\"] = d[\"misses\"] // sint\n    v[\"read\"] = v[\"hits\"] + v[\"iohs\"] + v[\"miss\"]\n    v[\"hit%\"] = 100 * v[\"hits\"] // v[\"read\"] if v[\"read\"] > 0 else 0\n    v[\"ioh%\"] = 100 * v[\"iohs\"] // v[\"read\"] if v[\"read\"] > 0 else 0\n    v[\"miss%\"] = 100 - v[\"hit%\"] - v[\"ioh%\"] if v[\"read\"] > 0 else 0\n\n    v[\"dhit\"] = (d[\"demand_data_hits\"] + d[\"demand_metadata_hits\"]) // sint\n    v[\"dioh\"] = (d[\"demand_data_iohits\"] + d[\"demand_metadata_iohits\"]) // sint\n    v[\"dmis\"] = (d[\"demand_data_misses\"] + d[\"demand_metadata_misses\"]) // sint\n\n    v[\"dread\"] = v[\"dhit\"] + v[\"dioh\"] + v[\"dmis\"]\n    v[\"dh%\"] = 100 * v[\"dhit\"] // v[\"dread\"] if v[\"dread\"] > 0 else 0\n    v[\"di%\"] = 100 * v[\"dioh\"] // v[\"dread\"] if v[\"dread\"] > 0 else 0\n    v[\"dm%\"] = 100 - v[\"dh%\"] - v[\"di%\"] if v[\"dread\"] > 0 else 0\n\n    v[\"ddhit\"] = d[\"demand_data_hits\"] // sint\n    v[\"ddioh\"] = d[\"demand_data_iohits\"] // sint\n    v[\"ddmis\"] = d[\"demand_data_misses\"] // sint\n\n    v[\"ddread\"] = v[\"ddhit\"] + v[\"ddioh\"] + v[\"ddmis\"]\n    v[\"ddh%\"] = 100 * v[\"ddhit\"] // v[\"ddread\"] if v[\"ddread\"] > 0 else 0\n    v[\"ddi%\"] = 100 * v[\"ddioh\"] // v[\"ddread\"] if v[\"ddread\"] > 0 else 0\n    v[\"ddm%\"] = 100 - v[\"ddh%\"] - v[\"ddi%\"] if v[\"ddread\"] > 0 else 0\n\n    v[\"dmhit\"] = d[\"demand_metadata_hits\"] // sint\n    v[\"dmioh\"] = d[\"demand_metadata_iohits\"] // sint\n    v[\"dmmis\"] = d[\"demand_metadata_misses\"] // sint\n\n    v[\"dmread\"] = v[\"dmhit\"] + v[\"dmioh\"] + v[\"dmmis\"]\n    v[\"dmh%\"] = 100 * v[\"dmhit\"] // v[\"dmread\"] if v[\"dmread\"] > 0 else 0\n    v[\"dmi%\"] = 100 * v[\"dmioh\"] // v[\"dmread\"] if v[\"dmread\"] > 0 else 0\n    v[\"dmm%\"] = 100 - v[\"dmh%\"] - v[\"dmi%\"] if v[\"dmread\"] > 0 else 0\n\n    v[\"phit\"] = (d[\"prefetch_data_hits\"] + d[\"prefetch_metadata_hits\"]) // sint\n    v[\"pioh\"] = (d[\"prefetch_data_iohits\"] +\n                 d[\"prefetch_metadata_iohits\"]) // sint\n    v[\"pmis\"] = (d[\"prefetch_data_misses\"] +\n                 d[\"prefetch_metadata_misses\"]) // sint\n\n    v[\"pread\"] = v[\"phit\"] + v[\"pioh\"] + v[\"pmis\"]\n    v[\"ph%\"] = 100 * v[\"phit\"] // v[\"pread\"] if v[\"pread\"] > 0 else 0\n    v[\"pi%\"] = 100 * v[\"pioh\"] // v[\"pread\"] if v[\"pread\"] > 0 else 0\n    v[\"pm%\"] = 100 - v[\"ph%\"] - v[\"pi%\"] if v[\"pread\"] > 0 else 0\n\n    v[\"pdhit\"] = d[\"prefetch_data_hits\"] // sint\n    v[\"pdioh\"] = d[\"prefetch_data_iohits\"] // sint\n    v[\"pdmis\"] = d[\"prefetch_data_misses\"] // sint\n\n    v[\"pdread\"] = v[\"pdhit\"] + v[\"pdioh\"] + v[\"pdmis\"]\n    v[\"pdh%\"] = 100 * v[\"pdhit\"] // v[\"pdread\"] if v[\"pdread\"] > 0 else 0\n    v[\"pdi%\"] = 100 * v[\"pdioh\"] // v[\"pdread\"] if v[\"pdread\"] > 0 else 0\n    v[\"pdm%\"] = 100 - v[\"pdh%\"] - v[\"pdi%\"] if v[\"pdread\"] > 0 else 0\n\n    v[\"pmhit\"] = d[\"prefetch_metadata_hits\"] // sint\n    v[\"pmioh\"] = d[\"prefetch_metadata_iohits\"] // sint\n    v[\"pmmis\"] = d[\"prefetch_metadata_misses\"] // sint\n\n    v[\"pmread\"] = v[\"pmhit\"] + v[\"pmioh\"] + v[\"pmmis\"]\n    v[\"pmh%\"] = 100 * v[\"pmhit\"] // v[\"pmread\"] if v[\"pmread\"] > 0 else 0\n    v[\"pmi%\"] = 100 * v[\"pmioh\"] // v[\"pmread\"] if v[\"pmread\"] > 0 else 0\n    v[\"pmm%\"] = 100 - v[\"pmh%\"] - v[\"pmi%\"] if v[\"pmread\"] > 0 else 0\n\n    v[\"mhit\"] = (d[\"prefetch_metadata_hits\"] +\n                 d[\"demand_metadata_hits\"]) // sint\n    v[\"mioh\"] = (d[\"prefetch_metadata_iohits\"] +\n                 d[\"demand_metadata_iohits\"]) // sint\n    v[\"mmis\"] = (d[\"prefetch_metadata_misses\"] +\n                 d[\"demand_metadata_misses\"]) // sint\n\n    v[\"mread\"] = v[\"mhit\"] + v[\"mioh\"] + v[\"mmis\"]\n    v[\"mh%\"] = 100 * v[\"mhit\"] // v[\"mread\"] if v[\"mread\"] > 0 else 0\n    v[\"mi%\"] = 100 * v[\"mioh\"] // v[\"mread\"] if v[\"mread\"] > 0 else 0\n    v[\"mm%\"] = 100 - v[\"mh%\"] - v[\"mi%\"] if v[\"mread\"] > 0 else 0\n\n    v[\"arcsz\"] = cur[\"size\"]\n    v[\"size\"] = cur[\"size\"]\n    v[\"c\"] = cur[\"c\"]\n    v[\"mfu\"] = d[\"mfu_hits\"] // sint\n    v[\"mru\"] = d[\"mru_hits\"] // sint\n    v[\"mrug\"] = d[\"mru_ghost_hits\"] // sint\n    v[\"mfug\"] = d[\"mfu_ghost_hits\"] // sint\n    v[\"unc\"] = d[\"uncached_hits\"] // sint\n    v[\"eskip\"] = d[\"evict_skip\"] // sint\n    v[\"el2skip\"] = d[\"evict_l2_skip\"] // sint\n    v[\"el2cach\"] = d[\"evict_l2_cached\"] // sint\n    v[\"el2el\"] = d[\"evict_l2_eligible\"] // sint\n    v[\"el2mfu\"] = d[\"evict_l2_eligible_mfu\"] // sint\n    v[\"el2mru\"] = d[\"evict_l2_eligible_mru\"] // sint\n    v[\"el2inel\"] = d[\"evict_l2_ineligible\"] // sint\n    v[\"mtxmis\"] = d[\"mutex_miss\"] // sint\n\n    if l2exist:\n        v[\"l2hits\"] = d[\"l2_hits\"] // sint\n        v[\"l2miss\"] = d[\"l2_misses\"] // sint\n        v[\"l2read\"] = v[\"l2hits\"] + v[\"l2miss\"]\n        v[\"l2hit%\"] = 100 * v[\"l2hits\"] // v[\"l2read\"] if v[\"l2read\"] > 0 else 0\n\n        v[\"l2miss%\"] = 100 - v[\"l2hit%\"] if v[\"l2read\"] > 0 else 0\n        v[\"l2asize\"] = cur[\"l2_asize\"]\n        v[\"l2size\"] = cur[\"l2_size\"]\n        v[\"l2bytes\"] = d[\"l2_read_bytes\"] // sint\n\n        v[\"l2pref\"] = cur[\"l2_prefetch_asize\"]\n        v[\"l2mfu\"] = cur[\"l2_mfu_asize\"]\n        v[\"l2mru\"] = cur[\"l2_mru_asize\"]\n        v[\"l2data\"] = cur[\"l2_bufc_data_asize\"]\n        v[\"l2meta\"] = cur[\"l2_bufc_metadata_asize\"]\n        v[\"l2pref%\"] = 100 * v[\"l2pref\"] // v[\"l2asize\"]\n        v[\"l2mfu%\"] = 100 * v[\"l2mfu\"] // v[\"l2asize\"]\n        v[\"l2mru%\"] = 100 * v[\"l2mru\"] // v[\"l2asize\"]\n        v[\"l2data%\"] = 100 * v[\"l2data\"] // v[\"l2asize\"]\n        v[\"l2meta%\"] = 100 * v[\"l2meta\"] // v[\"l2asize\"]\n\n    v[\"grow\"] = 0 if cur[\"arc_no_grow\"] else 1\n    v[\"need\"] = cur[\"arc_need_free\"]\n    v[\"free\"] = cur[\"memory_free_bytes\"]\n    v[\"avail\"] = cur[\"memory_available_bytes\"]\n    v[\"waste\"] = cur[\"abd_chunk_waste_size\"]\n\n\ndef main():\n    global sint\n    global count\n    global hdr_intr\n\n    i = 0\n    count_flag = 0\n\n    init()\n    if count > 0:\n        count_flag = 1\n\n    signal(SIGINT, SIG_DFL)\n    signal(SIGWINCH, resize_handler)\n    while True:\n        if i == 0:\n            print_header()\n\n        snap_stats()\n        calculate()\n        print_values()\n\n        if count_flag == 1:\n            if count <= 1:\n                break\n            count -= 1\n\n        i = 0 if i >= hdr_intr else i + 1\n        time.sleep(sint)\n\n    if out:\n        out.close()\n\n\nif __name__ == '__main__':\n    main()\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}