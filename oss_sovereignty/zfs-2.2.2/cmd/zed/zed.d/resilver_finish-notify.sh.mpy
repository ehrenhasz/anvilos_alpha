{
  "module_name": "resilver_finish-notify.sh",
  "hash_id": "9489eb48cc53c98dcf9b325e4a85fe92abce6f4625423ccef39fbcdbe57a3eec",
  "original_prompt": "Ingested from zfs-2.2.2/cmd/zed/zed.d/resilver_finish-notify.sh",
  "human_readable_source": "#!/bin/sh\n# shellcheck disable=SC2154\n#\n# Send notification in response to a RESILVER_FINISH or SCRUB_FINISH.\n#\n# By default, \"zpool status\" output will only be included for a scrub_finish\n# zevent if the pool is not healthy; to always include its output, set\n# ZED_NOTIFY_VERBOSE=1.\n#\n# Exit codes:\n#   0: notification sent\n#   1: notification failed\n#   2: notification not configured\n#   3: notification suppressed\n#   9: internal error\n\n[ -f \"${ZED_ZEDLET_DIR}/zed.rc\" ] && . \"${ZED_ZEDLET_DIR}/zed.rc\"\n. \"${ZED_ZEDLET_DIR}/zed-functions.sh\"\n\n[ -n \"${ZEVENT_POOL}\" ] || exit 9\n[ -n \"${ZEVENT_SUBCLASS}\" ] || exit 9\n\nif   [ \"${ZEVENT_SUBCLASS}\" = \"resilver_finish\" ]; then\n    action=\"resilver\"\nelif [ \"${ZEVENT_SUBCLASS}\" = \"scrub_finish\" ]; then\n    action=\"scrub\"\nelse\n    zed_log_err \"unsupported event class \\\"${ZEVENT_SUBCLASS}\\\"\"\n    exit 9\nfi\n\nzed_check_cmd \"${ZPOOL}\" || exit 9\n\n# For scrub, suppress notification if the pool is healthy\n# and verbosity is not enabled.\n#\nif [ \"${ZEVENT_SUBCLASS}\" = \"scrub_finish\" ]; then\n    healthy=\"$(\"${ZPOOL}\" status -x \"${ZEVENT_POOL}\" \\\n        | grep \"'${ZEVENT_POOL}' is healthy\")\"\n    [ -n \"${healthy}\" ] && [ \"${ZED_NOTIFY_VERBOSE}\" -eq 0 ] && exit 3\nfi\n\numask 077\nnote_subject=\"ZFS ${ZEVENT_SUBCLASS} event for ${ZEVENT_POOL} on $(hostname)\"\nnote_pathname=\"$(mktemp)\"\n{\n    echo \"ZFS has finished a ${action}:\"\n    echo\n    echo \"   eid: ${ZEVENT_EID}\"\n    echo \" class: ${ZEVENT_SUBCLASS}\"\n    echo \"  host: $(hostname)\"\n    echo \"  time: ${ZEVENT_TIME_STRING}\"\n\n    \"${ZPOOL}\" status \"${ZEVENT_POOL}\"\n\n} > \"${note_pathname}\"\n\nzed_notify \"${note_subject}\" \"${note_pathname}\"; rv=$?\nrm -f \"${note_pathname}\"\nexit \"${rv}\"\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}