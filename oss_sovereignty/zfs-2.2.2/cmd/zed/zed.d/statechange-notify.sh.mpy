{
  "module_name": "statechange-notify.sh",
  "hash_id": "34741ef2c6ae9c005da480f715f2261cd458fe52ffbb602962e4a6fc45ff2318",
  "original_prompt": "Ingested from zfs-2.2.2/cmd/zed/zed.d/statechange-notify.sh",
  "human_readable_source": "#!/bin/sh\n# shellcheck disable=SC2154\n#\n# CDDL HEADER START\n#\n# The contents of this file are subject to the terms of the\n# Common Development and Distribution License Version 1.0 (CDDL-1.0).\n# You can obtain a copy of the license from the top-level file\n# \"OPENSOLARIS.LICENSE\" or at <http://opensource.org/licenses/CDDL-1.0>.\n# You may not use this file except in compliance with the license.\n#\n# CDDL HEADER END\n#\n\n#\n# Send notification in response to a fault induced statechange\n#\n# ZEVENT_SUBCLASS: 'statechange'\n# ZEVENT_VDEV_STATE_STR: 'DEGRADED', 'FAULTED', 'REMOVED', or 'UNAVAIL'\n#\n# Exit codes:\n#   0: notification sent\n#   1: notification failed\n#   2: notification not configured\n#   3: statechange not relevant\n#   4: statechange string missing (unexpected)\n\n[ -f \"${ZED_ZEDLET_DIR}/zed.rc\" ] && . \"${ZED_ZEDLET_DIR}/zed.rc\"\n. \"${ZED_ZEDLET_DIR}/zed-functions.sh\"\n\n[ -n \"${ZEVENT_VDEV_STATE_STR}\" ] || exit 4\n\nif [ \"${ZEVENT_VDEV_STATE_STR}\" != \"FAULTED\" ] \\\n        && [ \"${ZEVENT_VDEV_STATE_STR}\" != \"DEGRADED\" ] \\\n        && [ \"${ZEVENT_VDEV_STATE_STR}\" != \"REMOVED\" ] \\\n        && [ \"${ZEVENT_VDEV_STATE_STR}\" != \"UNAVAIL\" ]; then\n    exit 3\nfi\n\numask 077\nnote_subject=\"ZFS device fault for pool ${ZEVENT_POOL} on $(hostname)\"\nnote_pathname=\"$(mktemp)\"\n{\n    if [ \"${ZEVENT_VDEV_STATE_STR}\" = \"FAULTED\" ] ; then\n        echo \"The number of I/O errors associated with a ZFS device exceeded\"\n        echo \"acceptable levels. ZFS has marked the device as faulted.\"\n    elif [ \"${ZEVENT_VDEV_STATE_STR}\" = \"DEGRADED\" ] ; then\n        echo \"The number of checksum errors associated with a ZFS device\"\n        echo \"exceeded acceptable levels. ZFS has marked the device as\"\n        echo \"degraded.\"\n    else\n        echo \"ZFS has detected that a device was removed.\"\n    fi\n\n    echo\n    echo \" impact: Fault tolerance of the pool may be compromised.\"\n    echo \"    eid: ${ZEVENT_EID}\"\n    echo \"  class: ${ZEVENT_SUBCLASS}\"\n    echo \"  state: ${ZEVENT_VDEV_STATE_STR}\"\n    echo \"   host: $(hostname)\"\n    echo \"   time: ${ZEVENT_TIME_STRING}\"\n\n    [ -n \"${ZEVENT_VDEV_TYPE}\" ] && echo \"  vtype: ${ZEVENT_VDEV_TYPE}\"\n    [ -n \"${ZEVENT_VDEV_PATH}\" ] && echo \"  vpath: ${ZEVENT_VDEV_PATH}\"\n    [ -n \"${ZEVENT_VDEV_PHYSPATH}\" ] && echo \"  vphys: ${ZEVENT_VDEV_PHYSPATH}\"\n    [ -n \"${ZEVENT_VDEV_GUID}\" ] && echo \"  vguid: ${ZEVENT_VDEV_GUID}\"\n    [ -n \"${ZEVENT_VDEV_DEVID}\" ] && echo \"  devid: ${ZEVENT_VDEV_DEVID}\"\n\n    echo \"   pool: ${ZEVENT_POOL} (${ZEVENT_POOL_GUID})\"\n\n} > \"${note_pathname}\"\n\nzed_notify \"${note_subject}\" \"${note_pathname}\"; rv=$?\n\nrm -f \"${note_pathname}\"\nexit \"${rv}\"\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}