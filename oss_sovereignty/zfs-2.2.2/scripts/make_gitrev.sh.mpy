{
  "module_name": "make_gitrev.sh",
  "hash_id": "57f51c6ad6a523920a5029085f6e7860afffb0755beb9761c297c420664c67d6",
  "original_prompt": "Ingested from zfs-2.2.2/scripts/make_gitrev.sh",
  "human_readable_source": "#!/bin/sh\n\n#\n# CDDL HEADER START\n#\n# This file and its contents are supplied under the terms of the\n# Common Development and Distribution License (\"CDDL\"), version 1.0.\n# You may only use this file in accordance with the terms of version\n# 1.0 of the CDDL.\n#\n# A full copy of the text of the CDDL should have accompanied this\n# source.  A copy of the CDDL is also available via the Internet at\n# http://www.illumos.org/license/CDDL.\n#\n# CDDL HEADER END\n#\n\n# Copyright (c) 2018 by Delphix. All rights reserved.\n# Copyright (c) 2018 by Matthew Thode. All rights reserved.\n\n#\n# Generate zfs_gitrev.h.  Note that we need to do this for every\n# invocation of `make`, including for incremental builds.  Therefore we\n# can't use a zfs_gitrev.h.in file which would be processed only when\n# `configure` is run.\n#\n\nset -eu\n\ndist=no\ndistdir=.\nwhile getopts D: flag\ndo\n\tcase $flag in\n\t\t\\?) echo \"Usage: $0 [-D distdir] [file]\" >&2; exit 1;;\n\t\tD)  dist=yes; distdir=${OPTARG};;\n\t\t*)  ;;\n\tesac\ndone\nshift $((OPTIND - 1))\n\ntop_srcdir=\"$(dirname \"$0\")/..\"\nGITREV=\"${1:-include/zfs_gitrev.h}\"\n\n# GITREV should be a relative path (relative to top_builddir or distdir)\ncase \"${GITREV}\" in\n\t/*) echo \"Error: ${GITREV} should be a relative path\" >&2\n\t    exit 1;;\n\t*) ;;\nesac\n\nZFS_GITREV=$({ cd \"${top_srcdir}\" &&\n\tgit describe --always --long --dirty 2>/dev/null; } || :)\n\nif [ -z \"${ZFS_GITREV}\" ]\nthen\n\t# If the source directory is not a git repository, check if the file\n\t# already exists (in the source)\n\tif [ -f \"${top_srcdir}/${GITREV}\" ]\n\tthen\n\t\tZFS_GITREV=$(sed -n \\\n\t\t\t'1s/^#define[[:blank:]]ZFS_META_GITREV \"\\([^\"]*\\)\"$/\\1/p' \\\n\t\t\t\"${top_srcdir}/${GITREV}\")\n\tfi\nelif [ \"${dist}\" = yes ]\nthen\n\t# Append -dist when creating distributed sources from a git repository\n\tZFS_GITREV=\"${ZFS_GITREV}-dist\"\nfi\nZFS_GITREV=${ZFS_GITREV:-unknown}\n\nGITREVTMP=\"${GITREV}~\"\nprintf '#define\\tZFS_META_GITREV \"%s\"\\n' \"${ZFS_GITREV}\" >\"${GITREVTMP}\"\nGITREV=\"${distdir}/${GITREV}\"\nif cmp -s \"${GITREV}\" \"${GITREVTMP}\"\nthen\n\trm -f \"${GITREVTMP}\"\nelse\n\tmv -f \"${GITREVTMP}\" \"${GITREV}\"\nfi\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}