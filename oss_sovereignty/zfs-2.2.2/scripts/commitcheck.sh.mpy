{
  "module_name": "commitcheck.sh",
  "hash_id": "675e28746d3fc105f1b3e7c7cafb4a9cc9c2535869602c3dc0f4cb712c320d4c",
  "original_prompt": "Ingested from zfs-2.2.2/scripts/commitcheck.sh",
  "human_readable_source": "#!/bin/sh\n\nREF=\"HEAD\"\n\n# test commit body for length\n# lines containing urls are exempt for the length limit.\ntest_commit_bodylength()\n{\n    length=\"72\"\n    body=$(git log --no-show-signature -n 1 --pretty=%b \"$REF\" | grep -Ev \"http(s)*://\" | grep -E -m 1 \".{$((length + 1))}\")\n    if [ -n \"$body\" ]; then\n        echo \"error: commit message body contains line over ${length} characters\"\n        return 1\n    fi\n\n    return 0\n}\n\n# check for a tagged line\ncheck_tagged_line()\n{\n    regex='^[[:space:]]*'\"$1\"':[[:space:]][[:print:]]+[[:space:]]<[[:graph:]]+>$'\n    foundline=$(git log --no-show-signature -n 1 \"$REF\" | grep -E -m 1 \"$regex\")\n    if [ -z \"$foundline\" ]; then\n        echo \"error: missing \\\"$1\\\"\"\n        return 1\n    fi\n\n    return 0\n}\n\n# check commit message for a normal commit\nnew_change_commit()\n{\n    error=0\n\n    # subject is not longer than 72 characters\n    long_subject=$(git log --no-show-signature -n 1 --pretty=%s \"$REF\" | grep -E -m 1 '.{73}')\n    if [ -n \"$long_subject\" ]; then\n        echo \"error: commit subject over 72 characters\"\n        error=1\n    fi\n\n    # need a signed off by\n    if ! check_tagged_line \"Signed-off-by\" ; then\n        error=1\n    fi\n\n    # ensure that no lines in the body of the commit are over 72 characters\n    if ! test_commit_bodylength ; then\n        error=1\n    fi\n\n    return \"$error\"\n}\n\nis_coverity_fix()\n{\n    # subject starts with Fix coverity defects means it's a coverity fix\n    subject=$(git log --no-show-signature -n 1 --pretty=%s \"$REF\" | grep -E -m 1 '^Fix coverity defects')\n    if [ -n \"$subject\" ]; then\n        return 0\n    fi\n\n    return 1\n}\n\ncoverity_fix_commit()\n{\n    error=0\n\n    # subject starts with Fix coverity defects: CID dddd, dddd...\n    subject=$(git log --no-show-signature -n 1 --pretty=%s \"$REF\" |\n        grep -E -m 1 'Fix coverity defects: CID [[:digit:]]+(, [[:digit:]]+)*')\n    if [ -z \"$subject\" ]; then\n        echo \"error: Coverity defect fixes must have a subject line that starts with \\\"Fix coverity defects: CID dddd\\\"\"\n        error=1\n    fi\n\n    # need a signed off by\n    if ! check_tagged_line \"Signed-off-by\" ; then\n        error=1\n    fi\n\n    # test each summary line for the proper format\n    OLDIFS=$IFS\n    IFS='\n'\n    for line in $(git log --no-show-signature -n 1 --pretty=%b \"$REF\" | grep -E '^CID'); do\n        if ! echo \"$line\" | grep -qE '^CID [[:digit:]]+: ([[:graph:]]+|[[:space:]])+ \\(([[:upper:]]|\\_)+\\)'; then\n            echo \"error: commit message has an improperly formatted CID defect line\"\n            error=1\n        fi\n    done\n    IFS=$OLDIFS\n\n    # ensure that no lines in the body of the commit are over 72 characters\n    if ! test_commit_bodylength; then\n        error=1\n    fi\n\n    return \"$error\"\n}\n\nif [ -n \"$1\" ]; then\n    REF=\"$1\"\nfi\n\n# if coverity fix, test against that\nif is_coverity_fix; then\n    if ! coverity_fix_commit; then\n        exit 1\n    else\n        exit 0\n    fi\nfi\n\n# have a normal commit\nif ! new_change_commit ; then\n    exit 1\nfi\n\nexit 0\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}