{
  "module_name": "kmodtool",
  "hash_id": "23c1fc88eec7755ed36af29e2ec8c328a271ca64727da45fe48e0c889f9757e0",
  "original_prompt": "Ingested from zfs-2.2.2/scripts/kmodtool",
  "human_readable_source": "#!/usr/bin/env bash\n# shellcheck disable=SC2086,SC2295\n\n# kmodtool - Helper script for building kernel module RPMs\n# Copyright (c) 2003-2012 Ville Skytt\u00e4 <ville.skytta@iki.fi>,\n#                         Thorsten Leemhuis <fedora@leemhuis.info>\n#                         Nicolas Chauvet <kwizart@gmail.com>\n#\n# Permission is hereby granted, free of charge, to any person obtaining\n# a copy of this software and associated documentation files (the\n# \"Software\"), to deal in the Software without restriction, including\n# without limitation the rights to use, copy, modify, merge, publish,\n# distribute, sublicense, and/or sell copies of the Software, and to\n# permit persons to whom the Software is furnished to do so, subject to\n# the following conditions:\n#\n# The above copyright notice and this permission notice shall be\n# included in all copies or substantial portions of the Software.\n#\n# THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\n# EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n# NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE\n# LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION\n# OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION\n# WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nshopt -s extglob\n\nmyprog=\"kmodtool-${repo}\"\nmyver=\"0.12.1\"\n\nkmodname=\nbuild_kernels=\"current\"\nkernels_known_variants=\nkernel_versions=\nkernel_versions_to_build_for=\nprefix=\nfilterfile=\ntarget=\nbuildroot=\ndashvariant=\n\nerror_out()\n{\n\tlocal errorlevel=${1}\n\tshift\n\techo \"Error: $*\" >&2\n\t# the next line is not multi-line safe -- not needed *yet*\n\techo \"%global kmodtool_check echo \\\"kmodtool error: $*\\\"; exit ${errorlevel};\"\n\texit \"${errorlevel}\"\n}\n\nprint_rpmtemplate_header()\n{\n\techo\n\techo \"%global kmodinstdir_prefix  ${prefix}/lib/modules/\"\n\techo \"%global kmodinstdir_postfix /extra/${kmodname}/\"\n\techo \"%global kernel_versions     ${kernel_versions}\"\n\techo\n}\n\nprint_akmodtemplate ()\n{\n\techo\n\tcat <<EOF\n\n%global akmod_install mkdir -p \\$RPM_BUILD_ROOT/%{_usrsrc}/akmods/; \\\\\\\nLANG=C rpmbuild --define \"_sourcedir %{_sourcedir}\" \\\\\\\n--define \"_srcrpmdir \\$RPM_BUILD_ROOT/%{_usrsrc}/akmods/\" \\\\\\\n-bs --nodeps %{_specdir}/%{name}.spec ; \\\\\\\nln -s \\$(ls \\$RPM_BUILD_ROOT/%{_usrsrc}/akmods/) \\$RPM_BUILD_ROOT/%{_usrsrc}/akmods/${kmodname}-kmod.latest\n\n%package -n akmod-${kmodname}\nSummary:\tAkmod package for ${kmodname} kernel module(s)\nGroup: \t\tSystem Environment/Kernel\nRequires:   kmodtool\nRequires: \takmods\n%{?AkmodsBuildRequires:Requires: %{AkmodsBuildRequires}}\n# same requires and provides as a kmods package would have\nRequires: \t${kmodname}-kmod-common >= %{?epoch:%{epoch}:}%{version}\nProvides: \t${kmodname}-kmod = %{?epoch:%{epoch}:}%{version}-%{release}\nEOF\n\n\tcat <<EOF\n\n%description -n akmod-${kmodname}\nThis package provides the akmod package for the ${kmodname} kernel modules.\n\n%posttrans -n akmod-${kmodname}\nnohup ${prefix}/sbin/akmods --from-akmod-posttrans --akmod ${kmodname} &> /dev/null &\n\n%files -n akmod-${kmodname}\n%defattr(-,root,root,-)\n%{_usrsrc}/akmods/*\n\nEOF\n}\n\nprint_akmodmeta ()\n{\n\t\tcat <<EOF\n%package      -n kmod-${kmodname}\nSummary:         Metapackage which tracks in ${kmodname} kernel module for newest kernel${dashvariant}\nGroup:           System Environment/Kernel\n\nProvides:        ${kmodname}-kmod = %{?epoch:%{epoch}:}%{version}-%{release}\nProvides:        kmod-${kmodname}-xen = %{?epoch:%{epoch}:}%{version}-%{release}\nProvides:        kmod-${kmodname}-smp = %{?epoch:%{epoch}:}%{version}-%{release}\nProvides:        kmod-${kmodname}-PAE = %{?epoch:%{epoch}:}%{version}-%{release}\nRequires:        akmod-${kmodname} = %{?epoch:%{epoch}:}%{version}-%{release}\nEOF\n\ncat <<EOF\n\n%description  -n kmod-${kmodname}${dashvariant}\nThis is a meta-package without payload which sole purpose is to require the\n${kmodname} kernel module(s) for the newest kernel${dashvariant},\nto make sure you get it together with a new kernel.\n\n%files        -n kmod-${kmodname}${dashvariant}\n%defattr(644,root,root,755)\nEOF\n}\n\nprint_rpmtemplate_per_kmodpkg ()\n{\n\tif [[ \"${1}\" = \"--custom\" ]]; then\n\t\tshift\n\t\tlocal customkernel=true\n\telif [[ \"${1}\" = \"--redhat\" ]]; then\n\t\t# this is needed for akmods\n\t\tshift\n\t\tlocal redhatkernel=true\n\tfi\n\n\tlocal kernel_uname_r=${1}\n\tlocal kernel_variant=\"${2:+-${2}}\"\n\n\t# Detect depmod install location\n\tlocal depmod_path=/sbin/depmod\n\tif [[ ! -f \"${depmod_path}\" ]]; then\n\t\tdepmod_path=/usr/sbin/depmod\n\tfi\n\n\t# first part\n\tcat <<EOF\n%package       -n kmod-${kmodname}-${kernel_uname_r}\nSummary:          ${kmodname} kernel module(s) for ${kernel_uname_r}\nGroup:            System Environment/Kernel\nProvides:         kernel-modules-for-kernel = ${kernel_uname_r}\nProvides:         kmod-${kmodname}-uname-r = ${kernel_uname_r}\nProvides:         ${kmodname}-kmod = %{?epoch:%{epoch}:}%{version}-%{release}\nRequires:         ${kmodname}-kmod-common >= %{?epoch:%{epoch}:}%{version}\n\n%if 0%{?rhel} == 6 || 0%{?centos} == 6\nRequires(post):   module-init-tools\nRequires(postun): module-init-tools\n%else\nRequires(post):   kmod\nRequires(postun): kmod\n%endif\nEOF\n\n\t# second part\n\tif [[ -z \"${customkernel}\" ]]; then\n\t     cat <<EOF\nRequires:         kernel-uname-r = ${kernel_uname_r}\nBuildRequires:\t  kernel-devel-uname-r = ${kernel_uname_r}\n%{?KmodsRequires:Requires: %{KmodsRequires}-uname-r = ${kernel_uname_r}}\n%{?KmodsRequires:BuildRequires: %{KmodsRequires}-uname-r = ${kernel_uname_r}}\n%post          -n kmod-${kmodname}-${kernel_uname_r}\nif [[ -f \"/boot/System.map-${kernel_uname_r}\" ]]; then\n\t${prefix}${depmod_path} -aeF /boot/System.map-${kernel_uname_r} ${kernel_uname_r} > /dev/null || :\nelif [[ -f \"/lib/modules/${kernel_uname_r}/System.map\" ]]; then\n\t${prefix}${depmod_path} -aeF /lib/modules/${kernel_uname_r}/System.map ${kernel_uname_r} > /dev/null || :\nelse\n\t${prefix}${depmod_path} -ae ${kernel_uname_r} &> /dev/null || :\nfi\n%postun        -n kmod-${kmodname}-${kernel_uname_r}\nif [[ -f \"/boot/System.map-${kernel_uname_r}\" ]]; then\n\t${prefix}${depmod_path} -aF /boot/System.map-${kernel_uname_r} ${kernel_uname_r} &> /dev/null || :\nelif [[ -f \"/lib/modules/${kernel_uname_r}/System.map\" ]]; then\n\t${prefix}${depmod_path} -aF /lib/modules/${kernel_uname_r}/System.map ${kernel_uname_r} &> /dev/null || :\nelse\n\t${prefix}${depmod_path} -a ${kernel_uname_r} &> /dev/null || :\nfi\n\nEOF\n\telse\n\t  cat <<EOF\n%post          -n kmod-${kmodname}-${kernel_uname_r}\n[ \"\\$(uname -r)\" = \"${kernel_uname_r}\"  ] && ${prefix}${depmod_path} -a > /dev/null || :\n%postun        -n kmod-${kmodname}-${kernel_uname_r}\n[ \"\\$(uname -r)\" = \"${kernel_uname_r}\"  ] && ${prefix}${depmod_path} -a > /dev/null || :\n\nEOF\n\tfi\n\n  # third part\n\tcat <<EOF\n%description  -n kmod-${kmodname}-${kernel_uname_r}\nThis package provides the ${kmodname} kernel modules built for the Linux\nkernel ${kernel_uname_r} for the %{_target_cpu} family of processors.\n%files        -n kmod-${kmodname}-${kernel_uname_r}\n%defattr(644,root,root,755)\n%dir $prefix/lib/modules/${kernel_uname_r}/extra\n${prefix}/lib/modules/${kernel_uname_r}/extra/${kmodname}/\n\n\nEOF\n}\n\nprint_rpmtemplate_kmoddevelpkg ()\n{\n\tif [[ \"${1}\" = \"--custom\" ]]; then\n\t\tshift\n\t\tlocal customkernel=true\n\telif [[ \"${1}\" = \"--redhat\" ]]; then\n\t\tshift\n\t\tlocal redhatkernel=true\n\tfi\n\n\tlocal kernel_uname_r=${1}\n\n\tcat <<EOF\n%package       -n kmod-${kmodname}-devel\nSummary:          ${kmodname} kernel module(s) devel common\nGroup:            System Environment/Kernel\nProvides:         ${kmodname}-devel-kmod = %{?epoch:%{epoch}:}%{version}-%{release}\nEOF\n\n\tif [[ -z \"${customkernel}\" ]] && [[ -z \"${redhatkernel}\" ]]; then\n\t\techo \"Requires:        kmod-${kmodname}-devel-${kernel_uname_r} >= %{?epoch:%{epoch}:}%{version}-%{release}\"\n\tfi\n\n\tcat <<EOF\n%description  -n kmod-${kmodname}-devel\nThis package provides the common header files to build kernel modules\nwhich depend on the ${kmodname} kernel module.  It may optionally require\nthe ${kmodname}-devel-<kernel> objects for the newest kernel.\n\n%files        -n kmod-${kmodname}-devel\n%defattr(644,root,root,755)\n%{_usrsrc}/${kmodname}-%{version}\nEOF\n\n\tfor kernel in ${1}; do\n\t\tlocal kernel_uname_r=${kernel}\n\t\techo \"%exclude %{_usrsrc}/${kmodname}-%{version}/${kernel_uname_r}\"\n\tdone\n\n\techo\n\techo\n}\n\nprint_rpmtemplate_per_kmoddevelpkg ()\n{\n\tif [[ \"${1}\" = \"--custom\" ]]; then\n\t\tshift\n\t\tlocal customkernel=true\n\telif [[ \"${1}\" = \"--redhat\" ]]; then\n\t\t# this is needed for akmods\n\t\tshift\n\t\tlocal redhatkernel=true\n\tfi\n\n\tlocal kernel_uname_r=${1}\n\tlocal kernel_variant=\"${2:+-${2}}\"\n\n\t# first part\n\tcat <<EOF\n%package       -n kmod-${kmodname}-devel-${kernel_uname_r}\nSummary:          ${kmodname} kernel module(s) devel for ${kernel_uname_r}\nGroup:            System Environment/Kernel\nProvides:         kernel-objects-for-kernel = ${kernel_uname_r}\nProvides:         ${kmodname}-devel-kmod = %{?epoch:%{epoch}:}%{version}-%{release}\nProvides:         kmod-${kmodname}-devel-uname-r = ${kernel_uname_r}\nEOF\n\n\t# second part\n\tif [[ -z \"${customkernel}\" ]]; then\n\t\tcat <<EOF\nRequires:         kernel-devel-uname-r = ${kernel_uname_r}\nBuildRequires:    kernel-devel-uname-r = ${kernel_uname_r}\n%{?KmodsDevelRequires:Requires: %{KmodsDevelRequires}-uname-r = ${kernel_uname_r}}\n%{?KmodsDevelRequires:BuildRequires: %{KmodsDevelRequires}-uname-r = ${kernel_uname_r}}\nEOF\n\tfi\n\n\t# third part\n\tcat <<EOF\n%description  -n kmod-${kmodname}-devel-${kernel_uname_r}\nThis package provides objects and symbols required to build kernel modules\nwhich depend on the ${kmodname} kernel modules built for the Linux\nkernel ${kernel_uname_r} for the %{_target_cpu} family of processors.\n%files        -n kmod-${kmodname}-devel-${kernel_uname_r}\n%defattr(644,root,root,755)\n%{_usrsrc}/${kmodname}-%{version}/${kernel_uname_r}\nEOF\n}\n\nprint_rpmtemplate_kmodmetapkg ()\n{\n\t\tlocal kernel_uname_r=${1}\n\t\tlocal kernel_variant=\"${2:+-${2}}\"\n\n\t\tcat <<EOF\n%package      -n kmod-${kmodname}${kernel_variant}\nSummary:         Metapackage which tracks in ${kmodname} kernel module for newest kernel${kernel_variant}\nGroup:           System Environment/Kernel\n\nProvides:        ${kmodname}-kmod = %{?epoch:%{epoch}:}%{version}-%{release}\nRequires:        kmod-${kmodname}-${kernel_uname_r} >= %{?epoch:%{epoch}:}%{version}-%{release}\n%{?KmodsMetaRequires:Requires: %{?KmodsMetaRequires}}\nEOF\n\n\t\tcat <<EOF\n\n%description  -n kmod-${kmodname}${kernel_variant}\nThis is a meta-package without payload which sole purpose is to require the\n${kmodname} kernel module(s) for the newest kernel${kernel_variant}.\nto make sure you get it together with a new kernel.\n\n%files        -n kmod-${kmodname}${kernel_variant}\n%defattr(644,root,root,755)\n\n\nEOF\n}\n\nprint_customrpmtemplate ()\n{\n\tfor kernel in ${1}\n\tdo\n\t\tif [[ -e \"${prefix}/lib/modules/${kernel}/build/Makefile\" ]]; then\n\t\t\t# likely a user-build-kernel with available buildfiles\n\t\t\t# fixme: we should check if uname from Makefile is the same as ${kernel}\n\n\t\t\tkernel_versions=\"${kernel_versions}${kernel}___${prefix}/lib/modules/${kernel}/build/ \"\n\t\t\tprint_rpmtemplate_per_kmodpkg --custom \"${kernel}\"\n\n\t\t\t# create development package\n\t\t\tif [[ -n \"${devel}\" ]]; then\n\t\t\t\t# create devel package including common headers\n\t\t\t\tprint_rpmtemplate_kmoddevelpkg --custom \"${kernel}\"\n\n\t\t\t\t# create devel package\n\t\t\t\tprint_rpmtemplate_per_kmoddevelpkg --custom \"${kernel}\"\n\t\t\tfi\n\t\telif [[ -e \"${buildroot}/usr/src/kernels/${kernel}\" ]]; then\n\t\t\t# this looks like a Fedora/RH kernel -- print a normal template (which includes the proper BR) and be happy :)\n\t\t\tkernel_versions=\"${kernel_versions}${kernel}___${buildroot}%{_usrsrc}/kernels/${kernel} \"\n\n\t\t\t# parse kernel versions string and print template\n\t\t\tlocal kernel_verrelarch=${kernel%%${kernels_known_variants}}\n\t\t\tprint_rpmtemplate_per_kmodpkg --redhat ${kernel} ${kernel##${kernel_verrelarch}}\n\n\t\t\t# create development package\n\t\t\tif [[ -n \"${devel}\" ]]; then\n\t\t\t\t# create devel package including common headers\n\t\t\t\tprint_rpmtemplate_kmoddevelpkg --redhat ${kernel} ${kernel##${kernel_verrelarch}}\n\n\t\t\t\t# create devel package\n\t\t\t\tprint_rpmtemplate_per_kmoddevelpkg --redhat ${kernel} ${kernel##${kernel_verrelarch}}\n\t\t\tfi\n\t\telse\n\t\t\terror_out 2 \"Don't know how to handle ${kernel} -- ${prefix}/lib/modules/${kernel}/build/Makefile not found\"\n\t\tfi\n\tdone\n\n\t# well, it's no header anymore, but who cares ;-)\n\tprint_rpmtemplate_header\n}\n\n\nprint_rpmtemplate ()\n{\n\t# create kernel_versions var\n\tfor kernel_version in ${kernel_versions_to_build_for}\n\tdo\n\t\tkernel_versions=\"${kernel_versions}${kernel_version}___%{_usrsrc}/kernels/${kernel_version} \"\n\tdone\n\n\t# and print it and some other required stuff as macro\n\tprint_rpmtemplate_header\n\n\t# now print the packages\n\tfor kernel in ${kernel_versions_to_build_for} ; do\n\n\t\tlocal kernel_verrelarch=${kernel%%${kernels_known_variants}}\n\n\t\t# create metapackage\n\t\tprint_rpmtemplate_kmodmetapkg \"${kernel}\" \"${kernel##${kernel_verrelarch}}\"\n\n\t\t# create package\n\t\tprint_rpmtemplate_per_kmodpkg \"${kernel}\" \"${kernel##${kernel_verrelarch}}\"\n\n\t\tif [[ -n \"${devel}\" ]]; then\n\t\t\t# create devel package including common headers\n\t\t\tprint_rpmtemplate_kmoddevelpkg \"${kernel}\" \"${kernel##${kernel_verrelarch}}\"\n\n\t\t\t# create devel package\n\t\t\tprint_rpmtemplate_per_kmoddevelpkg \"${kernel}\" \"${kernel##${kernel_verrelarch}}\"\n\t\tfi\n\tdone\n}\n\nmyprog_help ()\n{\n\techo \"Usage: ${0##*/} [OPTIONS]\"\n\techo\n\techo \"Creates a template to be used during kmod building\"\n\techo\n\techo \"Available options:\"\n\techo \" --filterfile <file>  -- filter the results with grep --file <file>\"\n\techo \" --for-kernels <list> -- created templates only for these kernels\"\n\techo \" --kmodname <file>    -- name of the kmod (required)\"\n\techo \" --devel              -- make kmod-devel package\"\n\techo \" --noakmod            -- no akmod package\"\n\techo \" --repo <name>        -- use buildsys-build-<name>-kerneldevpkgs\"\n\techo \" --target <arch>      -- target-arch (required)\"\n\techo \" --buildroot <dir>    -- Build root (place to look for build files)\"\n}\n\nwhile [[ -n \"${1}\" ]] ; do\n\tcase \"${1}\" in\n\t\t--filterfile)\n\t\t\tshift\n\t\t\tif [[ -z \"${1}\" ]] ; then\n\t\t\t\terror_out 2 \"Please provide path to a filter-file together with --filterfile\" >&2\n\t\t\telif [[ ! -e \"${1}\" ]]; then\n\t\t\t\terror_out 2 \"Filterfile ${1} not found\" >&2\n\t\t\tfi\n\t\t\tfilterfile=\"${1}\"\n\t\t\tshift\n\t\t\t;;\n\t\t--kmodname)\n\t\t\tshift\n\t\t\tif [[ -z \"${1}\" ]] ; then\n\t\t\t\terror_out 2 \"Please provide the name of the kmod together with --kmodname\" >&2\n\t \t    fi\n\t\t\t# strip pending -kmod\n\t\t\tkmodname=\"${1%%-kmod}\"\n\t\t\tshift\n\t\t\t;;\n\t\t--devel)\n\t\t\tshift\n\t\t\tdevel=\"true\"\n\t\t\t;;\n\t\t--prefix)\n\t\t\tshift\n\t\t\tif [[ -z \"${1}\" ]] ; then\n\t\t\t\terror_out 2 \"Please provide a prefix with --prefix\" >&2\n\t\t    fi\n\t\t\tprefix=\"${1}\"\n\t\t\tshift\n\t\t\t;;\n\t\t--repo)\n\t\t\tshift\n\t\t\tif [[ -z \"${1}\" ]] ; then\n\t\t\t\terror_out 2 \"Please provide the name of the repo together with --repo\" >&2\n\t \t    fi\n\t\t\trepo=${1}\n\t\t\tshift\n\t\t\t;;\n\t\t--for-kernels)\n\t\t\tshift\n\t\t\tif [[ -z \"${1}\" ]] ; then\n\t\t\t\terror_out 2 \"Please provide the name of the kmod together with --kmodname\" >&2\n\t \t\tfi\n\t\t\tfor_kernels=\"${1}\"\n\t\t\tshift\n\t\t\t;;\n\t\t--noakmod)\n\t\t\tshift\n\t\t\tnoakmod=\"true\"\n\t\t\t;;\n\t\t--target)\n\t\t\tshift\n\t\t\ttarget=\"${1}\"\n\t\t\tshift\n\t\t\t;;\n\t\t--akmod)\n\t\t\tshift\n\t\t\tbuild_kernels=\"akmod\"\n\t\t\t;;\n\t\t--newest)\n\t\t\tshift\n\t\t\tbuild_kernels=\"newest\"\n\t\t\t;;\n\t\t--current)\n\t\t\tshift\n\t\t\tbuild_kernels=\"current\"\n\t\t\t;;\n\t\t--buildroot)\n\t\t\tshift\n\t\t\tbuildroot=\"${1}\"\n\t\t\tshift\n\t\t\t;;\n\t\t--help)\n\t\t\tmyprog_help\n\t\t\texit 0\n\t\t\t;;\n\t\t--version)\n\t\t\techo \"${myprog} ${myver}\"\n\t\t\texit 0\n\t\t\t;;\n\t\t*)\n\t\t\techo \"Error: Unknown option '${1}'.\" >&2\n\t\t\tusage >&2\n\t\t\texit 2\n\t\t\t;;\n\tesac\ndone\n\nif [[ -e ./kmodtool-kernel-variants ]]; then\n\tkernels_known_variants=\"$(cat ./kmodtool-kernel-variants)\"\nelif [[ -e /usr/share/kmodtool/kernel-variants ]] ; then\n\tkernels_known_variants=\"$(cat /usr/share/kmodtool/kernel-variants)\"\nelse\n\tkernels_known_variants=\"@(smp?(-debug)|PAE?(-debug)|debug|kdump|xen|kirkwood|highbank|imx|omap|tegra)\"\nfi\n\n# general sanity checks\nif [[ -z \"${target}\" ]]; then\n\t\terror_out 2 \"please pass target arch with --target\"\nelif [[ -z \"${kmodname}\" ]]; then\n\t\terror_out 2 \"please pass kmodname with --kmodname\"\nelif [[ -z \"${kernels_known_variants}\" ]] ; then\n\t\terror_out 2 \"could not determine known variants\"\nfi\n\n# go\nif [[ -n \"${for_kernels}\" ]]; then\n\t# this is easy:\n\tprint_customrpmtemplate \"${for_kernels}\"\nelif [[ \"${build_kernels}\" = \"akmod\" ]]; then\n\t# do only a akmod package\n\tprint_akmodtemplate\n\tprint_akmodmeta\nelse\n\t# seems we are on out own to decide for which kernels to build\n\n\t# we need more sanity checks in this case\n\tif [[ -z \"${repo}\" ]]; then\n\t\terror_out 2 \"please provide repo name with --repo\"\n\telif ! command -v \"buildsys-build-${repo}-kerneldevpkgs\" > /dev/null 2>&1; then\n\t\terror_out 2 \"buildsys-build-${repo}-kerneldevpkgs not found\"\n\tfi\n\n\t# call buildsys-build-${repo}-kerneldevpkgs to get the list of kernels\n\tcmdoptions=\"--target ${target}\"\n\n\t# filterfile to filter list of kernels?\n\tif [[ -n \"${filterfile}\" ]] ; then\n\t\t cmdoptions=\"${cmdoptions} --filterfile ${filterfile}\"\n\tfi\n\n\tkernel_versions_to_build_for=$(buildsys-build-${repo}-kerneldevpkgs \"--${build_kernels}\" ${cmdoptions}) ||\n\t\terror_out 2 \"buildsys-build-${repo}-kerneldevpkgs failed: ${kernel_versions_to_build_for}\"\n\n\tif [[ \"${build_kernels}\" = \"current\" ]] && [[ -z \"${noakmod}\" ]]; then\n\t\tprint_akmodtemplate\n\tfi\n\n\tprint_rpmtemplate\nfi\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}