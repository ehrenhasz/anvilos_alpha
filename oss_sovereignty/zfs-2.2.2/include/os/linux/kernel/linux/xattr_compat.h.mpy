{
  "module_name": "xattr_compat.h",
  "hash_id": "cb4e0d530bc7f13916cc470099d1a3982e27b6876cb9504cc5bb4e80169c71ca",
  "original_prompt": "Ingested from zfs-2.2.2/include/os/linux/kernel/linux/xattr_compat.h",
  "human_readable_source": " \n\n \n\n#ifndef _ZFS_XATTR_H\n#define\t_ZFS_XATTR_H\n\n#include <linux/posix_acl_xattr.h>\n\n \ntypedef const struct xattr_handler\txattr_handler_t;\n\n \n#if defined(HAVE_XATTR_LIST_SIMPLE)\n#define\tZPL_XATTR_LIST_WRAPPER(fn)\t\t\t\t\t\\\nstatic bool\t\t\t\t\t\t\t\t\\\nfn(struct dentry *dentry)\t\t\t\t\t\t\\\n{\t\t\t\t\t\t\t\t\t\\\n\treturn (!!__ ## fn(dentry->d_inode, NULL, 0, NULL, 0));\t\t\\\n}\n \n#elif defined(HAVE_XATTR_LIST_DENTRY)\n#define\tZPL_XATTR_LIST_WRAPPER(fn)\t\t\t\t\t\\\nstatic size_t\t\t\t\t\t\t\t\t\\\nfn(struct dentry *dentry, char *list, size_t list_size,\t\t\t\\\n    const char *name, size_t name_len, int type)\t\t\t\\\n{\t\t\t\t\t\t\t\t\t\\\n\treturn (__ ## fn(dentry->d_inode,\t\t\t\t\\\n\t    list, list_size, name, name_len));\t\t\t\t\\\n}\n \n#elif defined(HAVE_XATTR_LIST_HANDLER)\n#define\tZPL_XATTR_LIST_WRAPPER(fn)\t\t\t\t\t\\\nstatic size_t\t\t\t\t\t\t\t\t\\\nfn(const struct xattr_handler *handler, struct dentry *dentry,\t\t\\\n    char *list, size_t list_size, const char *name, size_t name_len)\t\\\n{\t\t\t\t\t\t\t\t\t\\\n\treturn (__ ## fn(dentry->d_inode,\t\t\t\t\\\n\t    list, list_size, name, name_len));\t\t\t\t\\\n}\n#else\n#error \"Unsupported kernel\"\n#endif\n\n \n#if defined(HAVE_XATTR_GET_DENTRY_INODE)\n#define\tZPL_XATTR_GET_WRAPPER(fn)\t\t\t\t\t\\\nstatic int\t\t\t\t\t\t\t\t\\\nfn(const struct xattr_handler *handler, struct dentry *dentry,\t\t\\\n    struct inode *inode, const char *name, void *buffer, size_t size)\t\\\n{\t\t\t\t\t\t\t\t\t\\\n\treturn (__ ## fn(inode, name, buffer, size));\t\t\t\\\n}\n \n#elif defined(HAVE_XATTR_GET_HANDLER)\n#define\tZPL_XATTR_GET_WRAPPER(fn)\t\t\t\t\t\\\nstatic int\t\t\t\t\t\t\t\t\\\nfn(const struct xattr_handler *handler, struct dentry *dentry,\t\t\\\n    const char *name, void *buffer, size_t size)\t\t\t\\\n{\t\t\t\t\t\t\t\t\t\\\n\treturn (__ ## fn(dentry->d_inode, name, buffer, size));\t\t\\\n}\n \n#elif defined(HAVE_XATTR_GET_DENTRY)\n#define\tZPL_XATTR_GET_WRAPPER(fn)\t\t\t\t\t\\\nstatic int\t\t\t\t\t\t\t\t\\\nfn(struct dentry *dentry, const char *name, void *buffer, size_t size,\t\\\n    int unused_handler_flags)\t\t\t\t\t\t\\\n{\t\t\t\t\t\t\t\t\t\\\n\treturn (__ ## fn(dentry->d_inode, name, buffer, size));\t\t\\\n}\n \n#elif defined(HAVE_XATTR_GET_DENTRY_INODE_FLAGS)\n#define\tZPL_XATTR_GET_WRAPPER(fn)\t\t\t\t\t\\\nstatic int\t\t\t\t\t\t\t\t\\\nfn(const struct xattr_handler *handler, struct dentry *dentry,\t\t\\\n    struct inode *inode, const char *name, void *buffer,\t\t\\\n    size_t size, int flags)\t\t\t\t\t\t\\\n{\t\t\t\t\t\t\t\t\t\\\n\treturn (__ ## fn(inode, name, buffer, size));\t\t\t\\\n}\n#else\n#error \"Unsupported kernel\"\n#endif\n\n \n#if defined(HAVE_XATTR_SET_IDMAP)\n#define\tZPL_XATTR_SET_WRAPPER(fn)\t\t\t\t\t\\\nstatic int\t\t\t\t\t\t\t\t\\\nfn(const struct xattr_handler *handler, struct mnt_idmap *user_ns,\t\\\n    struct dentry *dentry, struct inode *inode, const char *name,\t\\\n    const void *buffer, size_t size, int flags)\t\\\n{\t\t\t\t\t\t\t\t\t\\\n\treturn (__ ## fn(user_ns, inode, name, buffer, size, flags));\t\\\n}\n \n#elif defined(HAVE_XATTR_SET_USERNS)\n#define\tZPL_XATTR_SET_WRAPPER(fn)\t\t\t\t\t\\\nstatic int\t\t\t\t\t\t\t\t\\\nfn(const struct xattr_handler *handler, struct user_namespace *user_ns, \\\n    struct dentry *dentry, struct inode *inode, const char *name,\t\\\n    const void *buffer, size_t size, int flags)\t\\\n{\t\t\t\t\t\t\t\t\t\\\n\treturn (__ ## fn(user_ns, inode, name, buffer, size, flags));\t\\\n}\n \n#elif defined(HAVE_XATTR_SET_DENTRY_INODE)\n#define\tZPL_XATTR_SET_WRAPPER(fn)\t\t\t\t\t\\\nstatic int\t\t\t\t\t\t\t\t\\\nfn(const struct xattr_handler *handler, struct dentry *dentry,\t\t\\\n    struct inode *inode, const char *name, const void *buffer,\t\t\\\n    size_t size, int flags)\t\t\t\t\t\t\\\n{\t\t\t\t\t\t\t\t\t\\\n\treturn (__ ## fn(kcred->user_ns, inode, name, buffer, size, flags));\\\n}\n \n#elif defined(HAVE_XATTR_SET_HANDLER)\n#define\tZPL_XATTR_SET_WRAPPER(fn)\t\t\t\t\t\\\nstatic int\t\t\t\t\t\t\t\t\\\nfn(const struct xattr_handler *handler, struct dentry *dentry,\t\t\\\n    const char *name, const void *buffer, size_t size, int flags)\t\\\n{\t\t\t\t\t\t\t\t\t\\\n\treturn (__ ## fn(kcred->user_ns, dentry->d_inode, name,\t\\\n\t    buffer, size, flags));\t\t\t\t\t\\\n}\n \n#elif defined(HAVE_XATTR_SET_DENTRY)\n#define\tZPL_XATTR_SET_WRAPPER(fn)\t\t\t\t\t\\\nstatic int\t\t\t\t\t\t\t\t\\\nfn(struct dentry *dentry, const char *name, const void *buffer,\t\t\\\n    size_t size, int flags, int unused_handler_flags)\t\t\t\\\n{\t\t\t\t\t\t\t\t\t\\\n\treturn (__ ## fn(kcred->user_ns, dentry->d_inode, name,\t\\\n\t    buffer, size, flags));\t\t\t\t\t\\\n}\n#else\n#error \"Unsupported kernel\"\n#endif\n\n \nstatic inline struct posix_acl *\nzpl_acl_from_xattr(const void *value, int size)\n{\n\treturn (posix_acl_from_xattr(kcred->user_ns, value, size));\n}\n\nstatic inline int\nzpl_acl_to_xattr(struct posix_acl *acl, void *value, int size)\n{\n\treturn (posix_acl_to_xattr(kcred->user_ns, acl, value, size));\n}\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}