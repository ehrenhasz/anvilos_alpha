{
  "module_name": "uio.h",
  "hash_id": "aa543b7a5af4e31aade3a8bbcff76d57910237848f15b65115df20446f2735bb",
  "original_prompt": "Ingested from zfs-2.2.2/include/os/linux/spl/sys/uio.h",
  "human_readable_source": " \n\n#ifndef _SPL_UIO_H\n#define\t_SPL_UIO_H\n\n#include <sys/debug.h>\n#include <linux/uio.h>\n#include <linux/blkdev.h>\n#include <linux/blkdev_compat.h>\n#include <linux/mm.h>\n#include <linux/bio.h>\n#include <asm/uaccess.h>\n#include <sys/types.h>\n\n#if defined(HAVE_VFS_IOV_ITER) && defined(HAVE_FAULT_IN_IOV_ITER_READABLE)\n#define\tiov_iter_fault_in_readable(a, b)\tfault_in_iov_iter_readable(a, b)\n#endif\n\ntypedef struct iovec iovec_t;\n\ntypedef enum zfs_uio_rw {\n\tUIO_READ =\t\t0,\n\tUIO_WRITE =\t\t1,\n} zfs_uio_rw_t;\n\ntypedef enum zfs_uio_seg {\n\tUIO_USERSPACE =\t\t0,\n\tUIO_SYSSPACE =\t\t1,\n\tUIO_BVEC =\t\t2,\n#if defined(HAVE_VFS_IOV_ITER)\n\tUIO_ITER =\t\t3,\n#endif\n} zfs_uio_seg_t;\n\ntypedef struct zfs_uio {\n\tunion {\n\t\tconst struct iovec\t*uio_iov;\n\t\tconst struct bio_vec\t*uio_bvec;\n#if defined(HAVE_VFS_IOV_ITER)\n\t\tstruct iov_iter\t\t*uio_iter;\n#endif\n\t};\n\tint\t\tuio_iovcnt;\n\toffset_t\tuio_loffset;\n\tzfs_uio_seg_t\tuio_segflg;\n\tboolean_t\tuio_fault_disable;\n\tuint16_t\tuio_fmode;\n\tuint16_t\tuio_extflg;\n\tssize_t\t\tuio_resid;\n\n\tsize_t\t\tuio_skip;\n\n\tstruct request\t*rq;\n} zfs_uio_t;\n\n\n#define\tzfs_uio_segflg(u)\t\t(u)->uio_segflg\n#define\tzfs_uio_offset(u)\t\t(u)->uio_loffset\n#define\tzfs_uio_resid(u)\t\t(u)->uio_resid\n#define\tzfs_uio_iovcnt(u)\t\t(u)->uio_iovcnt\n#define\tzfs_uio_iovlen(u, idx)\t\t(u)->uio_iov[(idx)].iov_len\n#define\tzfs_uio_iovbase(u, idx)\t\t(u)->uio_iov[(idx)].iov_base\n#define\tzfs_uio_fault_disable(u, set)\t(u)->uio_fault_disable = set\n#define\tzfs_uio_rlimit_fsize(z, u)\t(0)\n#define\tzfs_uio_fault_move(p, n, rw, u)\tzfs_uiomove((p), (n), (rw), (u))\n\nextern int zfs_uio_prefaultpages(ssize_t, zfs_uio_t *);\n\nstatic inline void\nzfs_uio_setoffset(zfs_uio_t *uio, offset_t off)\n{\n\tuio->uio_loffset = off;\n}\n\nstatic inline void\nzfs_uio_advance(zfs_uio_t *uio, size_t size)\n{\n\tuio->uio_resid -= size;\n\tuio->uio_loffset += size;\n}\n\nstatic inline void\nzfs_uio_iovec_init(zfs_uio_t *uio, const struct iovec *iov,\n    unsigned long nr_segs, offset_t offset, zfs_uio_seg_t seg, ssize_t resid,\n    size_t skip)\n{\n\tASSERT(seg == UIO_USERSPACE || seg == UIO_SYSSPACE);\n\n\tuio->uio_iov = iov;\n\tuio->uio_iovcnt = nr_segs;\n\tuio->uio_loffset = offset;\n\tuio->uio_segflg = seg;\n\tuio->uio_fault_disable = B_FALSE;\n\tuio->uio_fmode = 0;\n\tuio->uio_extflg = 0;\n\tuio->uio_resid = resid;\n\tuio->uio_skip = skip;\n}\n\nstatic inline void\nzfs_uio_bvec_init(zfs_uio_t *uio, struct bio *bio, struct request *rq)\n{\n\t \n\tASSERT3P(uio, !=, bio);\n\n\tif (bio) {\n\t\tuio->uio_iovcnt = bio->bi_vcnt - BIO_BI_IDX(bio);\n\t\tuio->uio_bvec = &bio->bi_io_vec[BIO_BI_IDX(bio)];\n\t} else {\n\t\tuio->uio_bvec = NULL;\n\t\tuio->uio_iovcnt = 0;\n\t}\n\n\tuio->uio_loffset = io_offset(bio, rq);\n\tuio->uio_segflg = UIO_BVEC;\n\tuio->uio_fault_disable = B_FALSE;\n\tuio->uio_fmode = 0;\n\tuio->uio_extflg = 0;\n\tuio->uio_resid = io_size(bio, rq);\n\tif (bio) {\n\t\tuio->uio_skip = BIO_BI_SKIP(bio);\n\t} else {\n\t\tuio->uio_skip = 0;\n\t}\n\n\tuio->rq = rq;\n}\n\n#if defined(HAVE_VFS_IOV_ITER)\nstatic inline void\nzfs_uio_iov_iter_init(zfs_uio_t *uio, struct iov_iter *iter, offset_t offset,\n    ssize_t resid, size_t skip)\n{\n\tuio->uio_iter = iter;\n\tuio->uio_iovcnt = iter->nr_segs;\n\tuio->uio_loffset = offset;\n\tuio->uio_segflg = UIO_ITER;\n\tuio->uio_fault_disable = B_FALSE;\n\tuio->uio_fmode = 0;\n\tuio->uio_extflg = 0;\n\tuio->uio_resid = resid;\n\tuio->uio_skip = skip;\n}\n#endif\n\n#if defined(HAVE_ITER_IOV)\n#define\tzfs_uio_iter_iov(iter)\titer_iov((iter))\n#else\n#define\tzfs_uio_iter_iov(iter)\t(iter)->iov\n#endif\n\n#if defined(HAVE_IOV_ITER_TYPE)\n#define\tzfs_uio_iov_iter_type(iter)\tiov_iter_type((iter))\n#else\n#define\tzfs_uio_iov_iter_type(iter)\t(iter)->type\n#endif\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}