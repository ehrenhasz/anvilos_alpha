{
  "module_name": "kmem_cache.h",
  "hash_id": "2770f0e634674ae687d4af0cd306d4f31db83df25a25e3d0307feedc0cc490ee",
  "original_prompt": "Ingested from zfs-2.2.2/include/os/linux/spl/sys/kmem_cache.h",
  "human_readable_source": " \n\n#ifndef _SPL_KMEM_CACHE_H\n#define\t_SPL_KMEM_CACHE_H\n\n#include <sys/taskq.h>\n\n \ntypedef enum kmc_bit {\n\tKMC_BIT_NODEBUG\t\t= 1,\t \n\tKMC_BIT_KVMEM\t\t= 7,\t \n\tKMC_BIT_SLAB\t\t= 8,\t \n\tKMC_BIT_DEADLOCKED\t= 14,\t \n\tKMC_BIT_GROWING\t\t= 15,\t \n\tKMC_BIT_REAPING\t\t= 16,\t \n\tKMC_BIT_DESTROY\t\t= 17,\t \n\tKMC_BIT_TOTAL\t\t= 18,\t \n\tKMC_BIT_ALLOC\t\t= 19,\t \n\tKMC_BIT_MAX\t\t= 20,\t \n} kmc_bit_t;\n\n \ntypedef enum kmem_cbrc {\n\tKMEM_CBRC_YES\t\t= 0,\t \n\tKMEM_CBRC_NO\t\t= 1,\t \n\tKMEM_CBRC_LATER\t\t= 2,\t \n\tKMEM_CBRC_DONT_NEED\t= 3,\t \n\tKMEM_CBRC_DONT_KNOW\t= 4,\t \n} kmem_cbrc_t;\n\n#define\tKMC_NODEBUG\t\t(1 << KMC_BIT_NODEBUG)\n#define\tKMC_KVMEM\t\t(1 << KMC_BIT_KVMEM)\n#define\tKMC_SLAB\t\t(1 << KMC_BIT_SLAB)\n#define\tKMC_DEADLOCKED\t\t(1 << KMC_BIT_DEADLOCKED)\n#define\tKMC_GROWING\t\t(1 << KMC_BIT_GROWING)\n#define\tKMC_REAPING\t\t(1 << KMC_BIT_REAPING)\n#define\tKMC_DESTROY\t\t(1 << KMC_BIT_DESTROY)\n#define\tKMC_TOTAL\t\t(1 << KMC_BIT_TOTAL)\n#define\tKMC_ALLOC\t\t(1 << KMC_BIT_ALLOC)\n#define\tKMC_MAX\t\t\t(1 << KMC_BIT_MAX)\n\n#define\tKMC_REAP_CHUNK\t\tINT_MAX\n#define\tKMC_DEFAULT_SEEKS\t1\n\n#define\tKMC_RECLAIM_ONCE\t0x1\t \n\nextern struct list_head spl_kmem_cache_list;\nextern struct rw_semaphore spl_kmem_cache_sem;\n\n#define\tSKM_MAGIC\t\t\t0x2e2e2e2e\n#define\tSKO_MAGIC\t\t\t0x20202020\n#define\tSKS_MAGIC\t\t\t0x22222222\n#define\tSKC_MAGIC\t\t\t0x2c2c2c2c\n\n#define\tSPL_KMEM_CACHE_OBJ_PER_SLAB\t8\t \n#define\tSPL_KMEM_CACHE_ALIGN\t\t8\t \n#ifdef _LP64\n#define\tSPL_KMEM_CACHE_MAX_SIZE\t\t32\t \n#else\n#define\tSPL_KMEM_CACHE_MAX_SIZE\t\t4\t \n#endif\n\n#define\tSPL_MAX_ORDER\t\t\t(MAX_ORDER - 3)\n#define\tSPL_MAX_ORDER_NR_PAGES\t\t(1 << (SPL_MAX_ORDER - 1))\n\n#ifdef CONFIG_SLUB\n#define\tSPL_MAX_KMEM_CACHE_ORDER\tPAGE_ALLOC_COSTLY_ORDER\n#define\tSPL_MAX_KMEM_ORDER_NR_PAGES\t(1 << (SPL_MAX_KMEM_CACHE_ORDER - 1))\n#else\n#define\tSPL_MAX_KMEM_ORDER_NR_PAGES\t(KMALLOC_MAX_SIZE >> PAGE_SHIFT)\n#endif\n\ntypedef int (*spl_kmem_ctor_t)(void *, void *, int);\ntypedef void (*spl_kmem_dtor_t)(void *, void *);\n\ntypedef struct spl_kmem_magazine {\n\tuint32_t\t\tskm_magic;\t \n\tuint32_t\t\tskm_avail;\t \n\tuint32_t\t\tskm_size;\t \n\tuint32_t\t\tskm_refill;\t \n\tstruct spl_kmem_cache\t*skm_cache;\t \n\tunsigned int\t\tskm_cpu;\t \n\tvoid\t\t\t*skm_objs[];\t \n} spl_kmem_magazine_t;\n\ntypedef struct spl_kmem_obj {\n\tuint32_t\t\tsko_magic;\t \n\tvoid\t\t\t*sko_addr;\t \n\tstruct spl_kmem_slab\t*sko_slab;\t \n\tstruct list_head\tsko_list;\t \n} spl_kmem_obj_t;\n\ntypedef struct spl_kmem_slab {\n\tuint32_t\t\tsks_magic;\t \n\tuint32_t\t\tsks_objs;\t \n\tstruct spl_kmem_cache\t*sks_cache;\t \n\tstruct list_head\tsks_list;\t \n\tstruct list_head\tsks_free_list;\t \n\tunsigned long\t\tsks_age;\t \n\tuint32_t\t\tsks_ref;\t \n} spl_kmem_slab_t;\n\ntypedef struct spl_kmem_alloc {\n\tstruct spl_kmem_cache\t*ska_cache;\t \n\tint\t\t\tska_flags;\t \n\ttaskq_ent_t\t\tska_tqe;\t \n} spl_kmem_alloc_t;\n\ntypedef struct spl_kmem_emergency {\n\tstruct rb_node\t\tske_node;\t \n\tunsigned long\t\tske_obj;\t \n} spl_kmem_emergency_t;\n\ntypedef struct spl_kmem_cache {\n\tuint32_t\t\tskc_magic;\t \n\tuint32_t\t\tskc_name_size;\t \n\tchar\t\t\t*skc_name;\t \n\tspl_kmem_magazine_t\t**skc_mag;\t \n\tuint32_t\t\tskc_mag_size;\t \n\tuint32_t\t\tskc_mag_refill;\t \n\tspl_kmem_ctor_t\t\tskc_ctor;\t \n\tspl_kmem_dtor_t\t\tskc_dtor;\t \n\tvoid\t\t\t*skc_private;\t \n\tvoid\t\t\t*skc_vmp;\t \n\tstruct kmem_cache\t*skc_linux_cache;  \n\tunsigned long\t\tskc_flags;\t \n\tuint32_t\t\tskc_obj_size;\t \n\tuint32_t\t\tskc_obj_align;\t \n\tuint32_t\t\tskc_slab_objs;\t \n\tuint32_t\t\tskc_slab_size;\t \n\tatomic_t\t\tskc_ref;\t \n\ttaskqid_t\t\tskc_taskqid;\t \n\tstruct list_head\tskc_list;\t \n\tstruct list_head\tskc_complete_list;  \n\tstruct list_head\tskc_partial_list;   \n\tstruct rb_root\t\tskc_emergency_tree;  \n\tspinlock_t\t\tskc_lock;\t \n\tspl_wait_queue_head_t\tskc_waitq;\t \n\tuint64_t\t\tskc_slab_fail;\t \n\tuint64_t\t\tskc_slab_create;   \n\tuint64_t\t\tskc_slab_destroy;  \n\tuint64_t\t\tskc_slab_total;\t \n\tuint64_t\t\tskc_slab_alloc;\t \n\tuint64_t\t\tskc_slab_max;\t \n\tuint64_t\t\tskc_obj_total;\t \n\tuint64_t\t\tskc_obj_alloc;\t \n\tstruct percpu_counter\tskc_linux_alloc;    \n\tuint64_t\t\tskc_obj_max;\t \n\tuint64_t\t\tskc_obj_deadlock;   \n\tuint64_t\t\tskc_obj_emergency;  \n\tuint64_t\t\tskc_obj_emergency_max;  \n} spl_kmem_cache_t;\n#define\tkmem_cache_t\t\tspl_kmem_cache_t\n\nextern spl_kmem_cache_t *spl_kmem_cache_create(const char *name, size_t size,\n    size_t align, spl_kmem_ctor_t ctor, spl_kmem_dtor_t dtor,\n    void *reclaim, void *priv, void *vmp, int flags);\nextern void spl_kmem_cache_set_move(spl_kmem_cache_t *,\n    kmem_cbrc_t (*)(void *, void *, size_t, void *));\nextern void spl_kmem_cache_destroy(spl_kmem_cache_t *skc);\nextern void *spl_kmem_cache_alloc(spl_kmem_cache_t *skc, int flags);\nextern void spl_kmem_cache_free(spl_kmem_cache_t *skc, void *obj);\nextern void spl_kmem_cache_set_allocflags(spl_kmem_cache_t *skc, gfp_t flags);\nextern void spl_kmem_cache_reap_now(spl_kmem_cache_t *skc);\nextern void spl_kmem_reap(void);\nextern uint64_t spl_kmem_cache_inuse(kmem_cache_t *cache);\nextern uint64_t spl_kmem_cache_entry_size(kmem_cache_t *cache);\n\n#define\tkmem_cache_create(name, size, align, ctor, dtor, rclm, priv, vmp, fl) \\\n    spl_kmem_cache_create(name, size, align, ctor, dtor, rclm, priv, vmp, fl)\n#define\tkmem_cache_set_move(skc, move)\tspl_kmem_cache_set_move(skc, move)\n#define\tkmem_cache_destroy(skc)\t\tspl_kmem_cache_destroy(skc)\n \n#ifdef kmem_cache_alloc\n#undef kmem_cache_alloc\n#endif\n#define\tkmem_cache_alloc(skc, flags)\tspl_kmem_cache_alloc(skc, flags)\n#define\tkmem_cache_free(skc, obj)\tspl_kmem_cache_free(skc, obj)\n#define\tkmem_cache_reap_now(skc)\tspl_kmem_cache_reap_now(skc)\n#define\tkmem_reap()\t\t\tspl_kmem_reap()\n\n \nextern int spl_kmem_cache_init(void);\nextern void spl_kmem_cache_fini(void);\n\n#endif\t \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}