{
  "module_name": "cred.h",
  "hash_id": "277c6177592af413b15d25f2e20e0db47d41387b46f7d0a53c8b0a6869e350c5",
  "original_prompt": "Ingested from zfs-2.2.2/include/os/linux/spl/sys/cred.h",
  "human_readable_source": " \n\n#ifndef _SPL_CRED_H\n#define\t_SPL_CRED_H\n\n#include <linux/module.h>\n#include <linux/cred.h>\n#include <linux/sched.h>\n#include <sys/types.h>\n#include <sys/vfs.h>\n\ntypedef struct cred cred_t;\n\nextern struct task_struct init_task;\n\n#define\tkcred\t\t((cred_t *)(init_task.cred))\n#define\tCRED()\t\t((cred_t *)current_cred())\n\n \n#ifndef GROUP_AT\n#define\tGROUP_AT(gi, i)\t((gi)->gid[i])\n#endif\n\n#define\tKUID_TO_SUID(x)\t\t(__kuid_val(x))\n#define\tKGID_TO_SGID(x)\t\t(__kgid_val(x))\n#define\tSUID_TO_KUID(x)\t\t(KUIDT_INIT(x))\n#define\tSGID_TO_KGID(x)\t\t(KGIDT_INIT(x))\n#define\tKGIDP_TO_SGIDP(x)\t(&(x)->val)\n\nextern zidmap_t *zfs_get_init_idmap(void);\n\n \nstatic inline boolean_t\nzfs_is_init_userns(struct user_namespace *user_ns)\n{\n#if defined(CONFIG_USER_NS)\n\treturn (user_ns == kcred->user_ns);\n#else\n\treturn (B_FALSE);\n#endif\n}\n\nstatic inline struct user_namespace *zfs_i_user_ns(struct inode *inode)\n{\n#ifdef HAVE_SUPER_USER_NS\n\treturn (inode->i_sb->s_user_ns);\n#else\n\treturn (kcred->user_ns);\n#endif\n}\n\nstatic inline boolean_t zfs_no_idmapping(struct user_namespace *mnt_userns,\n    struct user_namespace *fs_userns)\n{\n\treturn (zfs_is_init_userns(mnt_userns) || mnt_userns == fs_userns);\n}\n\nstatic inline uid_t zfs_uid_to_vfsuid(zidmap_t *mnt_userns,\n    struct user_namespace *fs_userns, uid_t uid)\n{\n\tstruct user_namespace *owner = idmap_owner(mnt_userns);\n\tif (zfs_no_idmapping(owner, fs_userns))\n\t\treturn (uid);\n\tif (!zfs_is_init_userns(fs_userns))\n\t\tuid = from_kuid(fs_userns, KUIDT_INIT(uid));\n\tif (uid == (uid_t)-1)\n\t\treturn (uid);\n\treturn (__kuid_val(make_kuid(owner, uid)));\n}\n\nstatic inline gid_t zfs_gid_to_vfsgid(zidmap_t *mnt_userns,\n    struct user_namespace *fs_userns, gid_t gid)\n{\n\tstruct user_namespace *owner = idmap_owner(mnt_userns);\n\tif (zfs_no_idmapping(owner, fs_userns))\n\t\treturn (gid);\n\tif (!zfs_is_init_userns(fs_userns))\n\t\tgid = from_kgid(fs_userns, KGIDT_INIT(gid));\n\tif (gid == (gid_t)-1)\n\t\treturn (gid);\n\treturn (__kgid_val(make_kgid(owner, gid)));\n}\n\nstatic inline uid_t zfs_vfsuid_to_uid(zidmap_t *mnt_userns,\n    struct user_namespace *fs_userns, uid_t uid)\n{\n\tstruct user_namespace *owner = idmap_owner(mnt_userns);\n\tif (zfs_no_idmapping(owner, fs_userns))\n\t\treturn (uid);\n\tuid = from_kuid(owner, KUIDT_INIT(uid));\n\tif (uid == (uid_t)-1)\n\t\treturn (uid);\n\tif (zfs_is_init_userns(fs_userns))\n\t\treturn (uid);\n\treturn (__kuid_val(make_kuid(fs_userns, uid)));\n}\n\nstatic inline gid_t zfs_vfsgid_to_gid(zidmap_t *mnt_userns,\n    struct user_namespace *fs_userns, gid_t gid)\n{\n\tstruct user_namespace *owner = idmap_owner(mnt_userns);\n\tif (zfs_no_idmapping(owner, fs_userns))\n\t\treturn (gid);\n\tgid = from_kgid(owner, KGIDT_INIT(gid));\n\tif (gid == (gid_t)-1)\n\t\treturn (gid);\n\tif (zfs_is_init_userns(fs_userns))\n\t\treturn (gid);\n\treturn (__kgid_val(make_kgid(fs_userns, gid)));\n}\n\nextern void crhold(cred_t *cr);\nextern void crfree(cred_t *cr);\nextern uid_t crgetuid(const cred_t *cr);\nextern uid_t crgetruid(const cred_t *cr);\nextern gid_t crgetgid(const cred_t *cr);\nextern int crgetngroups(const cred_t *cr);\nextern gid_t *crgetgroups(const cred_t *cr);\nextern int groupmember(gid_t gid, const cred_t *cr);\n#endif   \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}