{
  "module_name": "zfs_vfsops_os.h",
  "hash_id": "655f7b29fa2cab2bde86564a552645d4b843eed4b946b20cc9b747e715d28d69",
  "original_prompt": "Ingested from zfs-2.2.2/include/os/freebsd/zfs/sys/zfs_vfsops_os.h",
  "human_readable_source": " \n \n\n#ifndef\t_SYS_FS_ZFS_VFSOPS_H\n#define\t_SYS_FS_ZFS_VFSOPS_H\n\n#if __FreeBSD_version >= 1300125\n#define\tTEARDOWN_RMS\n#endif\n\n#if __FreeBSD_version >= 1300109\n#define\tTEARDOWN_INACTIVE_RMS\n#endif\n\n#include <sys/dataset_kstats.h>\n#include <sys/list.h>\n#include <sys/vfs.h>\n#include <sys/zil.h>\n#include <sys/sa.h>\n#include <sys/rrwlock.h>\n#ifdef TEARDOWN_INACTIVE_RMS\n#include <sys/rmlock.h>\n#endif\n#include <sys/zfs_ioctl.h>\n\n#ifdef\t__cplusplus\nextern \"C\" {\n#endif\n\n#ifdef TEARDOWN_RMS\ntypedef struct rmslock zfs_teardown_lock_t;\n#else\n#define\tzfs_teardown_lock_t\t\trrmlock_t\n#endif\n\n#ifdef TEARDOWN_INACTIVE_RMS\ntypedef struct rmslock zfs_teardown_inactive_lock_t;\n#else\n#define\tzfs_teardown_inactive_lock_t krwlock_t\n#endif\n\ntypedef struct zfsvfs zfsvfs_t;\nstruct znode;\n\nstruct zfsvfs {\n\tvfs_t\t\t*z_vfs;\t\t \n\tzfsvfs_t\t*z_parent;\t \n\tobjset_t\t*z_os;\t\t \n\tuint64_t\tz_flags;\t \n\tuint64_t\tz_root;\t\t \n\tuint64_t\tz_unlinkedobj;\t \n\tuint64_t\tz_max_blksz;\t \n\tuint64_t\tz_fuid_obj;\t \n\tuint64_t\tz_fuid_size;\t \n\tavl_tree_t\tz_fuid_idx;\t \n\tavl_tree_t\tz_fuid_domain;\t \n\tkrwlock_t\tz_fuid_lock;\t \n\tboolean_t\tz_fuid_loaded;\t \n\tboolean_t\tz_fuid_dirty;    \n\tstruct zfs_fuid_info\t*z_fuid_replay;  \n\tzilog_t\t\t*z_log;\t\t \n\tuint_t\t\tz_acl_type;\t \n\tuint_t\t\tz_acl_mode;\t \n\tuint_t\t\tz_acl_inherit;\t \n\tzfs_case_t\tz_case;\t\t \n\tboolean_t\tz_utf8;\t\t \n\tint\t\tz_norm;\t\t \n\tboolean_t\tz_atime;\t \n\tboolean_t\tz_unmounted;\t \n\tzfs_teardown_lock_t z_teardown_lock;\n\tzfs_teardown_inactive_lock_t z_teardown_inactive_lock;\n\tlist_t\t\tz_all_znodes;\t \n\tkmutex_t\tz_znodes_lock;\t \n\tstruct zfsctl_root\t*z_ctldir;\t \n\tboolean_t\tz_show_ctldir;\t \n\tboolean_t\tz_issnap;\t \n\tboolean_t\tz_use_fuids;\t \n\tboolean_t\tz_replay;\t \n\tboolean_t\tz_use_sa;\t \n\tboolean_t\tz_xattr_sa;\t \n\tboolean_t\tz_use_namecache;  \n\tuint8_t\t\tz_xattr;\t \n\tuint64_t\tz_version;\t \n\tuint64_t\tz_shares_dir;\t \n\tdataset_kstats_t\tz_kstat;\t \n\tkmutex_t\tz_lock;\n\tuint64_t\tz_userquota_obj;\n\tuint64_t\tz_groupquota_obj;\n\tuint64_t\tz_userobjquota_obj;\n\tuint64_t\tz_groupobjquota_obj;\n\tuint64_t\tz_projectquota_obj;\n\tuint64_t\tz_projectobjquota_obj;\n\tuint64_t\tz_replay_eof;\t \n\tsa_attr_type_t\t*z_attr_table;\t \n#define\tZFS_OBJ_MTX_SZ\t64\n\tkmutex_t\tz_hold_mtx[ZFS_OBJ_MTX_SZ];\t \n\tstruct task\tz_unlinked_drain_task;\n};\n\n#ifdef TEARDOWN_RMS\n#define\tZFS_TEARDOWN_INIT(zfsvfs)\t\t\\\n\trms_init(&(zfsvfs)->z_teardown_lock, \"zfs teardown\")\n\n#define\tZFS_TEARDOWN_DESTROY(zfsvfs)\t\t\\\n\trms_destroy(&(zfsvfs)->z_teardown_lock)\n\n#define\tZFS_TEARDOWN_ENTER_READ(zfsvfs, tag)\t\\\n\trms_rlock(&(zfsvfs)->z_teardown_lock);\n\n#define\tZFS_TEARDOWN_EXIT_READ(zfsvfs, tag)\t\\\n\trms_runlock(&(zfsvfs)->z_teardown_lock)\n\n#define\tZFS_TEARDOWN_ENTER_WRITE(zfsvfs, tag)\t\\\n\trms_wlock(&(zfsvfs)->z_teardown_lock)\n\n#define\tZFS_TEARDOWN_EXIT_WRITE(zfsvfs)\t\t\\\n\trms_wunlock(&(zfsvfs)->z_teardown_lock)\n\n#define\tZFS_TEARDOWN_EXIT(zfsvfs, tag)\t\t\\\n\trms_unlock(&(zfsvfs)->z_teardown_lock)\n\n#define\tZFS_TEARDOWN_READ_HELD(zfsvfs)\t\t\\\n\trms_rowned(&(zfsvfs)->z_teardown_lock)\n\n#define\tZFS_TEARDOWN_WRITE_HELD(zfsvfs)\t\t\\\n\trms_wowned(&(zfsvfs)->z_teardown_lock)\n\n#define\tZFS_TEARDOWN_HELD(zfsvfs)\t\t\\\n\trms_owned_any(&(zfsvfs)->z_teardown_lock)\n#else\n#define\tZFS_TEARDOWN_INIT(zfsvfs)\t\t\\\n\trrm_init(&(zfsvfs)->z_teardown_lock, B_FALSE)\n\n#define\tZFS_TEARDOWN_DESTROY(zfsvfs)\t\t\\\n\trrm_destroy(&(zfsvfs)->z_teardown_lock)\n\n#define\tZFS_TEARDOWN_ENTER_READ(zfsvfs, tag)\t\\\n\trrm_enter_read(&(zfsvfs)->z_teardown_lock, tag);\n\n#define\tZFS_TEARDOWN_EXIT_READ(zfsvfs, tag)\t\\\n\trrm_exit(&(zfsvfs)->z_teardown_lock, tag)\n\n#define\tZFS_TEARDOWN_ENTER_WRITE(zfsvfs, tag)\t\\\n\trrm_enter(&(zfsvfs)->z_teardown_lock, RW_WRITER, tag)\n\n#define\tZFS_TEARDOWN_EXIT_WRITE(zfsvfs)\t\t\\\n\trrm_exit(&(zfsvfs)->z_teardown_lock, tag)\n\n#define\tZFS_TEARDOWN_EXIT(zfsvfs, tag)\t\t\\\n\trrm_exit(&(zfsvfs)->z_teardown_lock, tag)\n\n#define\tZFS_TEARDOWN_READ_HELD(zfsvfs)\t\t\\\n\tRRM_READ_HELD(&(zfsvfs)->z_teardown_lock)\n\n#define\tZFS_TEARDOWN_WRITE_HELD(zfsvfs)\t\t\\\n\tRRM_WRITE_HELD(&(zfsvfs)->z_teardown_lock)\n\n#define\tZFS_TEARDOWN_HELD(zfsvfs)\t\t\\\n\tRRM_LOCK_HELD(&(zfsvfs)->z_teardown_lock)\n#endif\n\n#ifdef TEARDOWN_INACTIVE_RMS\n#define\tZFS_TEARDOWN_INACTIVE_INIT(zfsvfs)\t\t\\\n\trms_init(&(zfsvfs)->z_teardown_inactive_lock, \"zfs teardown inactive\")\n\n#define\tZFS_TEARDOWN_INACTIVE_DESTROY(zfsvfs)\t\t\\\n\trms_destroy(&(zfsvfs)->z_teardown_inactive_lock)\n\n#define\tZFS_TEARDOWN_INACTIVE_TRY_ENTER_READ(zfsvfs)\t\\\n\trms_try_rlock(&(zfsvfs)->z_teardown_inactive_lock)\n\n#define\tZFS_TEARDOWN_INACTIVE_ENTER_READ(zfsvfs)\t\\\n\trms_rlock(&(zfsvfs)->z_teardown_inactive_lock)\n\n#define\tZFS_TEARDOWN_INACTIVE_EXIT_READ(zfsvfs)\t\t\\\n\trms_runlock(&(zfsvfs)->z_teardown_inactive_lock)\n\n#define\tZFS_TEARDOWN_INACTIVE_ENTER_WRITE(zfsvfs)\t\\\n\trms_wlock(&(zfsvfs)->z_teardown_inactive_lock)\n\n#define\tZFS_TEARDOWN_INACTIVE_EXIT_WRITE(zfsvfs)\t\\\n\trms_wunlock(&(zfsvfs)->z_teardown_inactive_lock)\n\n#define\tZFS_TEARDOWN_INACTIVE_WRITE_HELD(zfsvfs)\t\\\n\trms_wowned(&(zfsvfs)->z_teardown_inactive_lock)\n#else\n#define\tZFS_TEARDOWN_INACTIVE_INIT(zfsvfs)\t\t\\\n\trw_init(&(zfsvfs)->z_teardown_inactive_lock, NULL, RW_DEFAULT, NULL)\n\n#define\tZFS_TEARDOWN_INACTIVE_DESTROY(zfsvfs)\t\t\\\n\trw_destroy(&(zfsvfs)->z_teardown_inactive_lock)\n\n#define\tZFS_TEARDOWN_INACTIVE_TRY_ENTER_READ(zfsvfs)\t\\\n\trw_tryenter(&(zfsvfs)->z_teardown_inactive_lock, RW_READER)\n\n#define\tZFS_TEARDOWN_INACTIVE_ENTER_READ(zfsvfs)\t\\\n\trw_enter(&(zfsvfs)->z_teardown_inactive_lock, RW_READER)\n\n#define\tZFS_TEARDOWN_INACTIVE_EXIT_READ(zfsvfs)\t\t\\\n\trw_exit(&(zfsvfs)->z_teardown_inactive_lock)\n\n#define\tZFS_TEARDOWN_INACTIVE_ENTER_WRITE(zfsvfs)\t\\\n\trw_enter(&(zfsvfs)->z_teardown_inactive_lock, RW_WRITER)\n\n#define\tZFS_TEARDOWN_INACTIVE_EXIT_WRITE(zfsvfs)\t\\\n\trw_exit(&(zfsvfs)->z_teardown_inactive_lock)\n\n#define\tZFS_TEARDOWN_INACTIVE_WRITE_HELD(zfsvfs)\t\\\n\tRW_WRITE_HELD(&(zfsvfs)->z_teardown_inactive_lock)\n#endif\n\n#define\tZSB_XATTR\t0x0001\t\t \n \ntypedef struct zfid_short {\n\tuint16_t\tzf_len;\n\tuint8_t\t\tzf_object[6];\t\t \n\tuint8_t\t\tzf_gen[4];\t\t \n} zfid_short_t;\n\n \ntypedef struct zfid_long {\n\tzfid_short_t\tz_fid;\n\tuint8_t\t\tzf_setid[6];\t\t \n\tuint8_t\t\tzf_setgen[2];\t\t \n} zfid_long_t;\n\n#define\tSHORT_FID_LEN\t(sizeof (zfid_short_t) - sizeof (uint16_t))\n#define\tLONG_FID_LEN\t(sizeof (zfid_long_t) - sizeof (uint16_t))\n\nextern uint_t zfs_fsyncer_key;\nextern int zfs_super_owner;\nextern int zfs_bclone_enabled;\n\nextern void zfs_init(void);\nextern void zfs_fini(void);\n\nextern int zfs_suspend_fs(zfsvfs_t *zfsvfs);\nextern int zfs_resume_fs(zfsvfs_t *zfsvfs, struct dsl_dataset *ds);\nextern int zfs_end_fs(zfsvfs_t *zfsvfs, struct dsl_dataset *ds);\nextern int zfs_set_version(zfsvfs_t *zfsvfs, uint64_t newvers);\nextern int zfsvfs_create(const char *name, boolean_t readonly, zfsvfs_t **zfvp);\nextern int zfsvfs_create_impl(zfsvfs_t **zfvp, zfsvfs_t *zfsvfs, objset_t *os);\nextern void zfsvfs_free(zfsvfs_t *zfsvfs);\nextern int zfs_check_global_label(const char *dsname, const char *hexsl);\nextern boolean_t zfs_is_readonly(zfsvfs_t *zfsvfs);\nextern int zfs_get_temporary_prop(struct dsl_dataset *ds, zfs_prop_t zfs_prop,\n    uint64_t *val, char *setpoint);\nextern int zfs_busy(void);\n\n#ifdef\t__cplusplus\n}\n#endif\n\n#endif\t \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}