{
  "module_name": "rwlock.h",
  "hash_id": "f0c50570f5c7faf0c71d9f88520b017cfd4a2386d69bd15df75e73ecb5048a6f",
  "original_prompt": "Ingested from zfs-2.2.2/include/os/freebsd/spl/sys/rwlock.h",
  "human_readable_source": " \n\n#ifndef _OPENSOLARIS_SYS_RWLOCK_H_\n#define\t_OPENSOLARIS_SYS_RWLOCK_H_\n\n#include <sys/param.h>\n#include <sys/proc.h>\n#include <sys/lock.h>\n#include <sys/sx.h>\n\ntypedef enum {\n\tRW_DEFAULT = 4\t\t \n} krw_type_t;\n\n\ntypedef enum {\n\tRW_NONE\t\t= 0,\n\tRW_WRITER\t= 1,\n\tRW_READER\t= 2\n} krw_t;\n\ntypedef\tstruct sx\tkrwlock_t;\n\n#ifndef OPENSOLARIS_WITNESS\n#define\tRW_FLAGS\t(SX_DUPOK | SX_NEW | SX_NOWITNESS)\n#else\n#define\tRW_FLAGS\t(SX_DUPOK | SX_NEW)\n#endif\n\n#define\tRW_READ_HELD(x)\t\t(rw_read_held((x)))\n#define\tRW_WRITE_HELD(x)\t(rw_write_held((x)))\n#define\tRW_LOCK_HELD(x)\t\t(rw_lock_held((x)))\n#define\tRW_ISWRITER(x)\t\t(rw_iswriter(x))\n#define\trw_init(lock, desc, type, arg)\tdo {\t\t\t\t\\\n\tconst char *_name;\t\t\t\t\t\t\\\n\tASSERT((type) == 0 || (type) == RW_DEFAULT);\t\t\t\\\n\tfor (_name = #lock; *_name != '\\0'; _name++) {\t\t\t\\\n\t\tif (*_name >= 'a' && *_name <= 'z')\t\t\t\\\n\t\t\tbreak;\t\t\t\t\t\t\\\n\t}\t\t\t\t\t\t\t\t\\\n\tif (*_name == '\\0')\t\t\t\t\t\t\\\n\t\t_name = #lock;\t\t\t\t\t\t\\\n\tsx_init_flags((lock), _name, RW_FLAGS);\t\t\t\t\\\n} while (0)\n#define\trw_destroy(lock)\tsx_destroy(lock)\n#define\trw_enter(lock, how)\tdo {\t\t\t\t\t\\\n\tif ((how) == RW_READER)\t\t\t\t\t\t\\\n\t\tsx_slock(lock);\t\t\t\t\t\t\\\n\telse  \t\t\t\t\\\n\t\tsx_xlock(lock);\t\t\t\t\t\t\\\n\t} while (0)\n\n#define\trw_tryenter(lock, how)\t\t\t   \\\n\t((how) == RW_READER ? sx_try_slock(lock) : sx_try_xlock(lock))\n#define\trw_exit(lock)\t\tsx_unlock(lock)\n#define\trw_downgrade(lock)\tsx_downgrade(lock)\n#define\trw_tryupgrade(lock)\tsx_try_upgrade(lock)\n#define\trw_read_held(lock)\t\t\t\t\t  \\\n\t((lock)->sx_lock != SX_LOCK_UNLOCKED &&\t  \\\n\t    ((lock)->sx_lock & SX_LOCK_SHARED))\n#define\trw_write_held(lock)\tsx_xlocked(lock)\n#define\trw_lock_held(lock)\t(rw_read_held(lock) || rw_write_held(lock))\n#define\trw_iswriter(lock)\tsx_xlocked(lock)\n#define\trw_owner(lock)\t\tsx_xholder(lock)\n\n#endif\t \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}