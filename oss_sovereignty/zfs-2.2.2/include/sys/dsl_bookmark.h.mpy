{
  "module_name": "dsl_bookmark.h",
  "hash_id": "780dd256f156b8df24eeb7dfdadb25f5ee5db3cba8ef8b4461c0d3471551ea3c",
  "original_prompt": "Ingested from zfs-2.2.2/include/sys/dsl_bookmark.h",
  "human_readable_source": " \n \n\n#ifndef\t_SYS_DSL_BOOKMARK_H\n#define\t_SYS_DSL_BOOKMARK_H\n\n#include <sys/zfs_context.h>\n#include <sys/zfs_refcount.h>\n#include <sys/dsl_dataset.h>\n#include <sys/dsl_pool.h>\n\n#ifdef\t__cplusplus\nextern \"C\" {\n#endif\n\n \ntypedef struct zfs_bookmark_phys {\n\tuint64_t zbm_guid;\t\t \n\tuint64_t zbm_creation_txg;\t \n\tuint64_t zbm_creation_time;\t \n\n\t \n\tuint64_t zbm_redaction_obj;\t \n\tuint64_t zbm_flags;\t\t \n\n\t \n\tuint64_t zbm_referenced_bytes_refd;\n\tuint64_t zbm_compressed_bytes_refd;\n\tuint64_t zbm_uncompressed_bytes_refd;\n\tuint64_t zbm_referenced_freed_before_next_snap;\n\tuint64_t zbm_compressed_freed_before_next_snap;\n\tuint64_t zbm_uncompressed_freed_before_next_snap;\n\n\t \n\tuint64_t zbm_ivset_guid;\n} zfs_bookmark_phys_t;\n\n\n#define\tBOOKMARK_PHYS_SIZE_V1\t(3 * sizeof (uint64_t))\n#define\tBOOKMARK_PHYS_SIZE_V2\t(12 * sizeof (uint64_t))\n\ntypedef enum zbm_flags {\n\tZBM_FLAG_HAS_FBN = (1 << 0),\n\tZBM_FLAG_SNAPSHOT_EXISTS = (1 << 1),\n} zbm_flags_t;\n\ntypedef struct redaction_list_phys {\n\tuint64_t rlp_last_object;\n\tuint64_t rlp_last_blkid;\n\tuint64_t rlp_num_entries;\n\tuint64_t rlp_num_snaps;\n\tuint64_t rlp_snaps[];  \n} redaction_list_phys_t;\n\ntypedef struct redaction_list {\n\tdmu_buf_user_t\t\trl_dbu;\n\tredaction_list_phys_t\t*rl_phys;\n\tdmu_buf_t\t\t*rl_dbuf;\n\tuint64_t\t\trl_object;\n\tzfs_refcount_t\t\trl_longholds;\n\tobjset_t\t\t*rl_mos;\n} redaction_list_t;\n\n \ntypedef struct dsl_bookmark_node {\n\tchar *dbn_name;  \n\tkmutex_t dbn_lock;  \n\tboolean_t dbn_dirty;  \n\tzfs_bookmark_phys_t dbn_phys;\n\tavl_node_t dbn_node;\n} dsl_bookmark_node_t;\n\ntypedef struct redact_block_phys {\n\tuint64_t\trbp_object;\n\tuint64_t\trbp_blkid;\n\t \n\tuint64_t\trbp_size_count;\n\tuint64_t\trbp_padding;\n} redact_block_phys_t;\n\ntypedef int (*rl_traverse_callback_t)(redact_block_phys_t *, void *);\n\n\ntypedef struct dsl_bookmark_create_arg {\n\tnvlist_t *dbca_bmarks;\n\tnvlist_t *dbca_errors;\n} dsl_bookmark_create_arg_t;\n\ntypedef struct dsl_bookmark_create_redacted_arg {\n\tconst char\t*dbcra_bmark;\n\tconst char\t*dbcra_snap;\n\tredaction_list_t **dbcra_rl;\n\tuint64_t\tdbcra_numsnaps;\n\tuint64_t\t*dbcra_snaps;\n\tconst void\t*dbcra_tag;\n} dsl_bookmark_create_redacted_arg_t;\n\nint dsl_bookmark_create(nvlist_t *, nvlist_t *);\nint dsl_bookmark_create_nvl_validate(nvlist_t *);\nint dsl_bookmark_create_check(void *arg, dmu_tx_t *tx);\nvoid dsl_bookmark_create_sync(void *arg, dmu_tx_t *tx);\nint dsl_bookmark_create_redacted(const char *, const char *, uint64_t,\n    uint64_t *, const void *, redaction_list_t **);\nint dsl_get_bookmarks(const char *, nvlist_t *, nvlist_t *);\nint dsl_get_bookmarks_impl(dsl_dataset_t *, nvlist_t *, nvlist_t *);\nint dsl_get_bookmark_props(const char *, const char *, nvlist_t *);\nint dsl_bookmark_destroy(nvlist_t *, nvlist_t *);\nint dsl_bookmark_lookup(struct dsl_pool *, const char *,\n    struct dsl_dataset *, zfs_bookmark_phys_t *);\nint dsl_bookmark_lookup_impl(dsl_dataset_t *, const char *,\n    zfs_bookmark_phys_t *);\nint dsl_redaction_list_hold_obj(struct dsl_pool *, uint64_t, const void *,\n    redaction_list_t **);\nvoid dsl_redaction_list_rele(redaction_list_t *, const void *);\nvoid dsl_redaction_list_long_hold(struct dsl_pool *, redaction_list_t *,\n    const void *);\nvoid dsl_redaction_list_long_rele(redaction_list_t *, const void *);\nboolean_t dsl_redaction_list_long_held(redaction_list_t *);\nint dsl_bookmark_init_ds(dsl_dataset_t *);\nvoid dsl_bookmark_fini_ds(dsl_dataset_t *);\nboolean_t dsl_bookmark_ds_destroyed(dsl_dataset_t *, dmu_tx_t *);\nvoid dsl_bookmark_snapshotted(dsl_dataset_t *, dmu_tx_t *);\nvoid dsl_bookmark_block_killed(dsl_dataset_t *, const blkptr_t *, dmu_tx_t *);\nvoid dsl_bookmark_sync_done(dsl_dataset_t *, dmu_tx_t *);\nvoid dsl_bookmark_node_add(dsl_dataset_t *, dsl_bookmark_node_t *, dmu_tx_t *);\nuint64_t dsl_bookmark_latest_txg(dsl_dataset_t *);\nint dsl_redaction_list_traverse(redaction_list_t *, zbookmark_phys_t *,\n    rl_traverse_callback_t, void *);\nvoid dsl_bookmark_next_changed(dsl_dataset_t *, dsl_dataset_t *, dmu_tx_t *);\n\n#ifdef\t__cplusplus\n}\n#endif\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}