{
  "module_name": "dmu_objset.h",
  "hash_id": "81f5113fee23592d196659419423e6185ee627fea88bb5d057e1c5a4fd9792b2",
  "original_prompt": "Ingested from zfs-2.2.2/include/sys/dmu_objset.h",
  "human_readable_source": " \n \n\n \n\n#ifndef\t_SYS_DMU_OBJSET_H\n#define\t_SYS_DMU_OBJSET_H\n\n#include <sys/spa.h>\n#include <sys/arc.h>\n#include <sys/txg.h>\n#include <sys/zfs_context.h>\n#include <sys/dnode.h>\n#include <sys/zio.h>\n#include <sys/zil.h>\n#include <sys/sa.h>\n#include <sys/zfs_ioctl.h>\n\n#ifdef\t__cplusplus\nextern \"C\" {\n#endif\n\nextern krwlock_t os_lock;\n\nstruct dsl_pool;\nstruct dsl_dataset;\nstruct dmu_tx;\n\n#define\tOBJSET_PHYS_SIZE_V1\t1024\n#define\tOBJSET_PHYS_SIZE_V2\t2048\n#define\tOBJSET_PHYS_SIZE_V3\t4096\n\n#define\tOBJSET_BUF_HAS_USERUSED(buf) \\\n\t(arc_buf_size(buf) >= OBJSET_PHYS_SIZE_V2)\n#define\tOBJSET_BUF_HAS_PROJECTUSED(buf) \\\n\t(arc_buf_size(buf) >= OBJSET_PHYS_SIZE_V3)\n\n#define\tOBJSET_FLAG_USERACCOUNTING_COMPLETE\t(1ULL << 0)\n#define\tOBJSET_FLAG_USEROBJACCOUNTING_COMPLETE\t(1ULL << 1)\n#define\tOBJSET_FLAG_PROJECTQUOTA_COMPLETE\t(1ULL << 2)\n\n \n#define\tOBJSET_CRYPT_PORTABLE_FLAGS_MASK\t(0)\n\n#if defined(__clang__)\n#pragma clang diagnostic push\n#pragma clang diagnostic ignored \"-Wgnu-variable-sized-type-not-at-end\"\n#endif\ntypedef struct objset_phys {\n\tdnode_phys_t os_meta_dnode;\n\tzil_header_t os_zil_header;\n\tuint64_t os_type;\n\tuint64_t os_flags;\n\tuint8_t os_portable_mac[ZIO_OBJSET_MAC_LEN];\n\tuint8_t os_local_mac[ZIO_OBJSET_MAC_LEN];\n\tchar os_pad0[OBJSET_PHYS_SIZE_V2 - sizeof (dnode_phys_t)*3 -\n\t    sizeof (zil_header_t) - sizeof (uint64_t)*2 -\n\t    2*ZIO_OBJSET_MAC_LEN];\n\tdnode_phys_t os_userused_dnode;\n\tdnode_phys_t os_groupused_dnode;\n\tdnode_phys_t os_projectused_dnode;\n\tchar os_pad1[OBJSET_PHYS_SIZE_V3 - OBJSET_PHYS_SIZE_V2 -\n\t    sizeof (dnode_phys_t)];\n} objset_phys_t;\n#if defined(__clang__)\n#pragma clang diagnostic pop\n#endif\n\ntypedef int (*dmu_objset_upgrade_cb_t)(objset_t *);\n\n#define\tOBJSET_PROP_UNINITIALIZED\t((uint64_t)-1)\nstruct objset {\n\t \n\tstruct dsl_dataset *os_dsl_dataset;\n\tspa_t *os_spa;\n\tarc_buf_t *os_phys_buf;\n\tobjset_phys_t *os_phys;\n\tboolean_t os_encrypted;\n\n\t \n\tdnode_handle_t os_meta_dnode;\n\tdnode_handle_t os_userused_dnode;\n\tdnode_handle_t os_groupused_dnode;\n\tdnode_handle_t os_projectused_dnode;\n\tzilog_t *os_zil;\n\n\tlist_node_t os_evicting_node;\n\n\t \n\tuint64_t os_dnodesize;  \n\tenum zio_checksum os_checksum;\n\tenum zio_compress os_compress;\n\tuint8_t os_complevel;\n\tuint8_t os_copies;\n\tenum zio_checksum os_dedup_checksum;\n\tboolean_t os_dedup_verify;\n\tzfs_logbias_op_t os_logbias;\n\tzfs_cache_type_t os_primary_cache;\n\tzfs_cache_type_t os_secondary_cache;\n\tzfs_sync_type_t os_sync;\n\tzfs_redundant_metadata_type_t os_redundant_metadata;\n\tuint64_t os_recordsize;\n\t \n\tuint64_t os_version;\n\tuint64_t os_normalization;\n\tuint64_t os_utf8only;\n\tuint64_t os_casesensitivity;\n\t \n\tint os_zpl_special_smallblock;\n\n\t \n\tblkptr_t *os_rootbp;\n\n\t \n\tstruct dmu_tx *os_synctx;  \n\tzil_header_t os_zil_header;\n\tmultilist_t os_synced_dnodes;\n\tuint64_t os_flags;\n\tuint64_t os_freed_dnodes;\n\tboolean_t os_rescan_dnodes;\n\tboolean_t os_raw_receive;\n\n\t \n\tboolean_t os_next_write_raw[TXG_SIZE];\n\n\t \n\tkmutex_t os_obj_lock;\n\tuint64_t os_obj_next_chunk;\n\n\t \n\tuint64_t *os_obj_next_percpu;\n\tint os_obj_next_percpu_len;\n\n\t \n\tkmutex_t os_lock;\n\tmultilist_t os_dirty_dnodes[TXG_SIZE];\n\tlist_t os_dnodes;\n\tlist_t os_downgraded_dbufs;\n\n\t \n\tkmutex_t os_userused_lock;\n\n\t \n\tkmutex_t os_user_ptr_lock;\n\tvoid *os_user_ptr;\n\tsa_os_t *os_sa;\n\n\t \n\tkmutex_t os_upgrade_lock;\n\ttaskqid_t os_upgrade_id;\n\tdmu_objset_upgrade_cb_t os_upgrade_cb;\n\tboolean_t os_upgrade_exit;\n\tint os_upgrade_status;\n};\n\n#define\tDMU_META_OBJSET\t\t0\n#define\tDMU_META_DNODE_OBJECT\t0\n#define\tDMU_OBJECT_IS_SPECIAL(obj) ((int64_t)(obj) <= 0)\n#define\tDMU_META_DNODE(os)\t((os)->os_meta_dnode.dnh_dnode)\n#define\tDMU_USERUSED_DNODE(os)\t((os)->os_userused_dnode.dnh_dnode)\n#define\tDMU_GROUPUSED_DNODE(os)\t((os)->os_groupused_dnode.dnh_dnode)\n#define\tDMU_PROJECTUSED_DNODE(os) ((os)->os_projectused_dnode.dnh_dnode)\n\n \nint dmu_objset_hold(const char *name, const void *tag, objset_t **osp);\nint dmu_objset_hold_flags(const char *name, boolean_t decrypt, const void *tag,\n    objset_t **osp);\nint dmu_objset_own(const char *name, dmu_objset_type_t type,\n    boolean_t readonly, boolean_t decrypt, const void *tag, objset_t **osp);\nint dmu_objset_own_obj(struct dsl_pool *dp, uint64_t obj,\n    dmu_objset_type_t type, boolean_t readonly, boolean_t decrypt,\n    const void *tag, objset_t **osp);\nvoid dmu_objset_refresh_ownership(struct dsl_dataset *ds,\n    struct dsl_dataset **newds, boolean_t decrypt, const void *tag);\nvoid dmu_objset_rele(objset_t *os, const void *tag);\nvoid dmu_objset_rele_flags(objset_t *os, boolean_t decrypt, const void *tag);\nvoid dmu_objset_disown(objset_t *os, boolean_t decrypt, const void *tag);\nint dmu_objset_from_ds(struct dsl_dataset *ds, objset_t **osp);\n\nvoid dmu_objset_stats(objset_t *os, nvlist_t *nv);\nvoid dmu_objset_fast_stat(objset_t *os, dmu_objset_stats_t *stat);\nvoid dmu_objset_space(objset_t *os, uint64_t *refdbytesp, uint64_t *availbytesp,\n    uint64_t *usedobjsp, uint64_t *availobjsp);\nuint64_t dmu_objset_fsid_guid(objset_t *os);\nint dmu_objset_find_dp(struct dsl_pool *dp, uint64_t ddobj,\n    int func(struct dsl_pool *, struct dsl_dataset *, void *),\n    void *arg, int flags);\nvoid dmu_objset_evict_dbufs(objset_t *os);\ninode_timespec_t dmu_objset_snap_cmtime(objset_t *os);\n\n \nvoid dmu_objset_sync(objset_t *os, zio_t *zio, dmu_tx_t *tx);\nboolean_t dmu_objset_is_dirty(objset_t *os, uint64_t txg);\nobjset_t *dmu_objset_create_impl_dnstats(spa_t *spa, struct dsl_dataset *ds,\n    blkptr_t *bp, dmu_objset_type_t type, int levels, int blksz, int ibs,\n    dmu_tx_t *tx);\nobjset_t *dmu_objset_create_impl(spa_t *spa, struct dsl_dataset *ds,\n    blkptr_t *bp, dmu_objset_type_t type, dmu_tx_t *tx);\nint dmu_objset_open_impl(spa_t *spa, struct dsl_dataset *ds, blkptr_t *bp,\n    objset_t **osp);\nvoid dmu_objset_evict(objset_t *os);\nvoid dmu_objset_sync_done(objset_t *os, dmu_tx_t *tx);\nvoid dmu_objset_userquota_get_ids(dnode_t *dn, boolean_t before, dmu_tx_t *tx);\nboolean_t dmu_objset_userused_enabled(objset_t *os);\nvoid dmu_objset_userspace_upgrade(objset_t *os);\nboolean_t dmu_objset_userspace_present(objset_t *os);\nboolean_t dmu_objset_userobjused_enabled(objset_t *os);\nboolean_t dmu_objset_userobjspace_upgradable(objset_t *os);\nboolean_t dmu_objset_userobjspace_present(objset_t *os);\nboolean_t dmu_objset_incompatible_encryption_version(objset_t *os);\nboolean_t dmu_objset_projectquota_enabled(objset_t *os);\nboolean_t dmu_objset_projectquota_present(objset_t *os);\nboolean_t dmu_objset_projectquota_upgradable(objset_t *os);\nvoid dmu_objset_id_quota_upgrade(objset_t *os);\nint dmu_get_file_info(objset_t *os, dmu_object_type_t bonustype,\n    const void *data, zfs_file_info_t *zfi);\n\nint dmu_fsname(const char *snapname, char *buf);\n\nvoid dmu_objset_evict_done(objset_t *os);\nvoid dmu_objset_willuse_space(objset_t *os, int64_t space, dmu_tx_t *tx);\n\nvoid dmu_objset_init(void);\nvoid dmu_objset_fini(void);\n\n#ifdef\t__cplusplus\n}\n#endif\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}