{
  "module_name": "zio_crypt.h",
  "hash_id": "bd9da8f5da4f7dc0abfafd880c54a6799a35fbd9f8b323ce2aabdc20d02dc62e",
  "original_prompt": "Ingested from zfs-2.2.2/include/sys/zio_crypt.h",
  "human_readable_source": " \n\n \n\n#ifndef\t_SYS_ZIO_CRYPT_H\n#define\t_SYS_ZIO_CRYPT_H\n\n#include <sys/dmu.h>\n#include <sys/zfs_refcount.h>\n#if defined(__FreeBSD__) && defined(_KERNEL)\n#include <sys/freebsd_crypto.h>\n#else\n#include <sys/crypto/api.h>\n#endif  \n#include <sys/nvpair.h>\n#include <sys/avl.h>\n#include <sys/zio.h>\n\n \nstruct zbookmark_phys;\n\n#define\tWRAPPING_KEY_LEN\t32\n#define\tWRAPPING_IV_LEN\t\tZIO_DATA_IV_LEN\n#define\tWRAPPING_MAC_LEN\tZIO_DATA_MAC_LEN\n#define\tMASTER_KEY_MAX_LEN\t32\n#define\tSHA512_HMAC_KEYLEN\t64\n\n#define\tZIO_CRYPT_KEY_CURRENT_VERSION\t1ULL\n\ntypedef enum zio_crypt_type {\n\tZC_TYPE_NONE = 0,\n\tZC_TYPE_CCM,\n\tZC_TYPE_GCM\n} zio_crypt_type_t;\n\n \ntypedef struct zio_crypt_info {\n\t \n#if defined(__FreeBSD__) && defined(_KERNEL)\n\t \n\tconst char\t*ci_algname;\n#else\n\tcrypto_mech_name_t ci_mechname;\n#endif\n\t \n\tzio_crypt_type_t ci_crypt_type;\n\n\t \n\tsize_t ci_keylen;\n\n\t \n\tconst char *ci_name;\n} zio_crypt_info_t;\n\nextern const zio_crypt_info_t zio_crypt_table[ZIO_CRYPT_FUNCTIONS];\n\n \ntypedef struct zio_crypt_key {\n\t \n\tuint64_t zk_crypt;\n\n\t \n\tuint64_t zk_version;\n\n\t \n\tuint64_t zk_guid;\n\n\t \n\tuint8_t zk_master_keydata[MASTER_KEY_MAX_LEN];\n\n\t \n\tuint8_t zk_hmac_keydata[SHA512_HMAC_KEYLEN];\n\n\t \n\tuint8_t zk_current_keydata[MASTER_KEY_MAX_LEN];\n\n\t \n\tuint8_t zk_salt[ZIO_DATA_SALT_LEN];\n\n\t \n\tuint64_t zk_salt_count;\n\n\t \n\tcrypto_key_t zk_current_key;\n\n#if defined(__FreeBSD__) && defined(_KERNEL)\n\t \n\tfreebsd_crypt_session_t\tzk_session;\n#else\n\t \n\tcrypto_ctx_template_t zk_current_tmpl;\n#endif\n\n\t \n\tcrypto_key_t zk_hmac_key;\n\n\t \n\tcrypto_ctx_template_t zk_hmac_tmpl;\n\n\t \n\tkrwlock_t zk_salt_lock;\n} zio_crypt_key_t;\n\nvoid zio_crypt_key_destroy(zio_crypt_key_t *key);\nint zio_crypt_key_init(uint64_t crypt, zio_crypt_key_t *key);\nint zio_crypt_key_get_salt(zio_crypt_key_t *key, uint8_t *salt_out);\n\nint zio_crypt_key_wrap(crypto_key_t *cwkey, zio_crypt_key_t *key, uint8_t *iv,\n    uint8_t *mac, uint8_t *keydata_out, uint8_t *hmac_keydata_out);\nint zio_crypt_key_unwrap(crypto_key_t *cwkey, uint64_t crypt, uint64_t version,\n    uint64_t guid, uint8_t *keydata, uint8_t *hmac_keydata, uint8_t *iv,\n    uint8_t *mac, zio_crypt_key_t *key);\nint zio_crypt_generate_iv(uint8_t *ivbuf);\nint zio_crypt_generate_iv_salt_dedup(zio_crypt_key_t *key, uint8_t *data,\n    uint_t datalen, uint8_t *ivbuf, uint8_t *salt);\n\nvoid zio_crypt_encode_params_bp(blkptr_t *bp, uint8_t *salt, uint8_t *iv);\nvoid zio_crypt_decode_params_bp(const blkptr_t *bp, uint8_t *salt, uint8_t *iv);\nvoid zio_crypt_encode_mac_bp(blkptr_t *bp, uint8_t *mac);\nvoid zio_crypt_decode_mac_bp(const blkptr_t *bp, uint8_t *mac);\nvoid zio_crypt_encode_mac_zil(void *data, uint8_t *mac);\nvoid zio_crypt_decode_mac_zil(const void *data, uint8_t *mac);\nvoid zio_crypt_copy_dnode_bonus(abd_t *src_abd, uint8_t *dst, uint_t datalen);\n\nint zio_crypt_do_indirect_mac_checksum(boolean_t generate, void *buf,\n    uint_t datalen, boolean_t byteswap, uint8_t *cksum);\nint zio_crypt_do_indirect_mac_checksum_abd(boolean_t generate, abd_t *abd,\n    uint_t datalen, boolean_t byteswap, uint8_t *cksum);\nint zio_crypt_do_hmac(zio_crypt_key_t *key, uint8_t *data, uint_t datalen,\n    uint8_t *digestbuf, uint_t digestlen);\nint zio_crypt_do_objset_hmacs(zio_crypt_key_t *key, void *data, uint_t datalen,\n    boolean_t byteswap, uint8_t *portable_mac, uint8_t *local_mac);\nint zio_do_crypt_data(boolean_t encrypt, zio_crypt_key_t *key,\n    dmu_object_type_t ot, boolean_t byteswap, uint8_t *salt, uint8_t *iv,\n    uint8_t *mac, uint_t datalen, uint8_t *plainbuf, uint8_t *cipherbuf,\n    boolean_t *no_crypt);\nint zio_do_crypt_abd(boolean_t encrypt, zio_crypt_key_t *key,\n    dmu_object_type_t ot, boolean_t byteswap, uint8_t *salt, uint8_t *iv,\n    uint8_t *mac, uint_t datalen, abd_t *pabd, abd_t *cabd,\n    boolean_t *no_crypt);\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}