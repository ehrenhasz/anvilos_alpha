{
  "module_name": "zil.h",
  "hash_id": "e4bdbfe2f2ff6ceb6943a2cadda4bf73126d87ec6ed21e8b5550ab9ff5a220b0",
  "original_prompt": "Ingested from zfs-2.2.2/include/sys/zil.h",
  "human_readable_source": " \n \n\n \n\n#ifndef\t_SYS_ZIL_H\n#define\t_SYS_ZIL_H\n\n#include <sys/types.h>\n#include <sys/spa.h>\n#include <sys/zio.h>\n#include <sys/dmu.h>\n#include <sys/zio_crypt.h>\n#include <sys/wmsum.h>\n\n#ifdef\t__cplusplus\nextern \"C\" {\n#endif\n\nstruct dsl_pool;\nstruct dsl_dataset;\nstruct lwb;\n\n \n\n \ntypedef struct zil_header {\n\tuint64_t zh_claim_txg;\t \n\tuint64_t zh_replay_seq;\t \n\tblkptr_t zh_log;\t \n\tuint64_t zh_claim_blk_seq;  \n\tuint64_t zh_flags;\t \n\tuint64_t zh_claim_lr_seq;  \n\tuint64_t zh_pad[3];\n} zil_header_t;\n\n \n#define\tZIL_REPLAY_NEEDED\t0x1\t \n#define\tZIL_CLAIM_LR_SEQ_VALID\t0x2\t \n\n \ntypedef struct zil_chain {\n\tuint64_t zc_pad;\n\tblkptr_t zc_next_blk;\t \n\tuint64_t zc_nused;\t \n\tzio_eck_t zc_eck;\t \n} zil_chain_t;\n\n#define\tZIL_MIN_BLKSZ\t4096ULL\n\n \n#define\tZILTEST_TXG (UINT64_MAX - TXG_CONCURRENT_STATES)\n\n \n#define\tZIL_ZC_GUID_0\t0\n#define\tZIL_ZC_GUID_1\t1\n#define\tZIL_ZC_OBJSET\t2\n#define\tZIL_ZC_SEQ\t3\n\ntypedef enum zil_create {\n\tZ_FILE,\n\tZ_DIR,\n\tZ_XATTRDIR,\n} zil_create_t;\n\n \n\n#define\tZIL_XVAT_SIZE(mapsize) \\\n\tsizeof (lr_attr_t) + (sizeof (uint32_t) * (mapsize - 1)) + \\\n\t(sizeof (uint64_t) * 7)\n\n \n\n#define\tZIL_ACE_LENGTH(x)\t(roundup(x, sizeof (uint64_t)))\n\n \n#define\tTX_COMMIT\t\t0\t \n#define\tTX_CREATE\t\t1\t \n#define\tTX_MKDIR\t\t2\t \n#define\tTX_MKXATTR\t\t3\t \n#define\tTX_SYMLINK\t\t4\t \n#define\tTX_REMOVE\t\t5\t \n#define\tTX_RMDIR\t\t6\t \n#define\tTX_LINK\t\t\t7\t \n#define\tTX_RENAME\t\t8\t \n#define\tTX_WRITE\t\t9\t \n#define\tTX_TRUNCATE\t\t10\t \n#define\tTX_SETATTR\t\t11\t \n#define\tTX_ACL_V0\t\t12\t \n#define\tTX_ACL\t\t\t13\t \n#define\tTX_CREATE_ACL\t\t14\t \n#define\tTX_CREATE_ATTR\t\t15\t \n#define\tTX_CREATE_ACL_ATTR \t16\t \n#define\tTX_MKDIR_ACL\t\t17\t \n#define\tTX_MKDIR_ATTR\t\t18\t \n#define\tTX_MKDIR_ACL_ATTR\t19\t \n#define\tTX_WRITE2\t\t20\t \n#define\tTX_SETSAXATTR\t\t21\t \n#define\tTX_RENAME_EXCHANGE\t22\t \n#define\tTX_RENAME_WHITEOUT\t23\t \n#define\tTX_CLONE_RANGE\t\t24\t \n#define\tTX_MAX_TYPE\t\t25\t \n\n \n#define\tTX_CI\t((uint64_t)0x1 << 63)  \n\n \n#define\tTX_OOO(txtype)\t\t\t\\\n\t((txtype) == TX_WRITE ||\t\\\n\t(txtype) == TX_TRUNCATE ||\t\\\n\t(txtype) == TX_SETATTR ||\t\\\n\t(txtype) == TX_ACL_V0 ||\t\\\n\t(txtype) == TX_ACL ||\t\t\\\n\t(txtype) == TX_WRITE2 ||\t\\\n\t(txtype) == TX_SETSAXATTR ||\t\\\n\t(txtype) == TX_CLONE_RANGE)\n\n \n#define\tLR_FOID_GET_SLOTS(oid) (BF64_GET((oid), 56, 8) + 1)\n#define\tLR_FOID_SET_SLOTS(oid, x) BF64_SET((oid), 56, 8, (x) - 1)\n#define\tLR_FOID_GET_OBJ(oid) BF64_GET((oid), 0, DN_MAX_OBJECT_SHIFT)\n#define\tLR_FOID_SET_OBJ(oid, x) BF64_SET((oid), 0, DN_MAX_OBJECT_SHIFT, (x))\n\n \ntypedef struct {\t\t\t \n\tuint64_t\tlrc_txtype;\t \n\tuint64_t\tlrc_reclen;\t \n\tuint64_t\tlrc_txg;\t \n\tuint64_t\tlrc_seq;\t \n} lr_t;\n\n \ntypedef struct {\n\tlr_t\t\tlr_common;\t \n\tuint64_t\tlr_foid;\t \n} lr_ooo_t;\n\n \ntypedef struct {\n\tuint64_t\tlr_attr_attrs;\t\t \n\tuint64_t\tlr_attr_crtime[2];\t \n\tuint8_t\t\tlr_attr_scanstamp[32];\n} lr_attr_end_t;\n\n \ntypedef struct {\n\tuint32_t\tlr_attr_masksize;  \n\tuint32_t\tlr_attr_bitmap;  \n\t \n} lr_attr_t;\n\n \ntypedef struct {\n\tlr_t\t\tlr_common;\t \n\tuint64_t\tlr_doid;\t \n\tuint64_t\tlr_foid;\t \n\tuint64_t\tlr_mode;\t \n\tuint64_t\tlr_uid;\t\t \n\tuint64_t\tlr_gid;\t\t \n\tuint64_t\tlr_gen;\t\t \n\tuint64_t\tlr_crtime[2];\t \n\tuint64_t\tlr_rdev;\t \n\t \n\t \n\t \n} lr_create_t;\n\n \n\n \ntypedef struct {\n\tlr_create_t\tlr_create;\t \n\tuint64_t\tlr_aclcnt;\t \n\tuint64_t\tlr_domcnt;\t \n\tuint64_t\tlr_fuidcnt;\t \n\tuint64_t\tlr_acl_bytes;\t \n\tuint64_t\tlr_acl_flags;\t \n} lr_acl_create_t;\n\ntypedef struct {\n\tlr_t\t\tlr_common;\t \n\tuint64_t\tlr_doid;\t \n\t \n} lr_remove_t;\n\ntypedef struct {\n\tlr_t\t\tlr_common;\t \n\tuint64_t\tlr_doid;\t \n\tuint64_t\tlr_link_obj;\t \n\t \n} lr_link_t;\n\ntypedef struct {\n\tlr_t\t\tlr_common;\t \n\tuint64_t\tlr_sdoid;\t \n\tuint64_t\tlr_tdoid;\t \n\t \n} lr_rename_t;\n\ntypedef struct {\n\tlr_rename_t\tlr_rename;\t \n\t \n\tuint64_t\tlr_wfoid;\t \n\tuint64_t\tlr_wmode;\t \n\tuint64_t\tlr_wuid;\t \n\tuint64_t\tlr_wgid;\t \n\tuint64_t\tlr_wgen;\t \n\tuint64_t\tlr_wcrtime[2];\t \n\tuint64_t\tlr_wrdev;\t \n\t \n} lr_rename_whiteout_t;\n\ntypedef struct {\n\tlr_t\t\tlr_common;\t \n\tuint64_t\tlr_foid;\t \n\tuint64_t\tlr_offset;\t \n\tuint64_t\tlr_length;\t \n\tuint64_t\tlr_blkoff;\t \n\tblkptr_t\tlr_blkptr;\t \n\t \n} lr_write_t;\n\ntypedef struct {\n\tlr_t\t\tlr_common;\t \n\tuint64_t\tlr_foid;\t \n\tuint64_t\tlr_offset;\t \n\tuint64_t\tlr_length;\t \n} lr_truncate_t;\n\ntypedef struct {\n\tlr_t\t\tlr_common;\t \n\tuint64_t\tlr_foid;\t \n\tuint64_t\tlr_mask;\t \n\tuint64_t\tlr_mode;\t \n\tuint64_t\tlr_uid;\t\t \n\tuint64_t\tlr_gid;\t\t \n\tuint64_t\tlr_size;\t \n\tuint64_t\tlr_atime[2];\t \n\tuint64_t\tlr_mtime[2];\t \n\t \n} lr_setattr_t;\n\ntypedef struct {\n\tlr_t\t\tlr_common;\t \n\tuint64_t\tlr_foid;\t \n\tuint64_t\tlr_size;\n\t \n} lr_setsaxattr_t;\n\ntypedef struct {\n\tlr_t\t\tlr_common;\t \n\tuint64_t\tlr_foid;\t \n\tuint64_t\tlr_aclcnt;\t \n\t \n} lr_acl_v0_t;\n\ntypedef struct {\n\tlr_t\t\tlr_common;\t \n\tuint64_t\tlr_foid;\t \n\tuint64_t\tlr_aclcnt;\t \n\tuint64_t\tlr_domcnt;\t \n\tuint64_t\tlr_fuidcnt;\t \n\tuint64_t\tlr_acl_bytes;\t \n\tuint64_t\tlr_acl_flags;\t \n\t \n} lr_acl_t;\n\ntypedef struct {\n\tlr_t\t\tlr_common;\t \n\tuint64_t\tlr_foid;\t \n\tuint64_t\tlr_offset;\t \n\tuint64_t\tlr_length;\t \n\tuint64_t\tlr_blksz;\t \n\tuint64_t\tlr_nbps;\t \n\tblkptr_t\tlr_bps[];\n\t \n} lr_clone_range_t;\n\n \n\n \ntypedef enum {\n\tWR_INDIRECT,\t \n\t\t\t \n\tWR_COPIED,\t \n\tWR_NEED_COPY,\t \n\tWR_NUM_STATES\t \n} itx_wr_state_t;\n\ntypedef void (*zil_callback_t)(void *data);\n\ntypedef struct itx {\n\tlist_node_t\titx_node;\t \n\tvoid\t\t*itx_private;\t \n\titx_wr_state_t\titx_wr_state;\t \n\tuint8_t\t\titx_sync;\t \n\tzil_callback_t\titx_callback;    \n\tvoid\t\t*itx_callback_data;  \n\tsize_t\t\titx_size;\t \n\tuint64_t\titx_oid;\t \n\tuint64_t\titx_gen;\t \n\tlr_t\t\titx_lr;\t\t \n\t \n} itx_t;\n\n \ntypedef struct zil_stats {\n\t \n\tkstat_named_t zil_commit_count;\n\n\t \n\tkstat_named_t zil_commit_writer_count;\n\n\t \n\tkstat_named_t zil_itx_count;\n\n\t \n\tkstat_named_t zil_itx_indirect_count;\n\tkstat_named_t zil_itx_indirect_bytes;\n\tkstat_named_t zil_itx_copied_count;\n\tkstat_named_t zil_itx_copied_bytes;\n\tkstat_named_t zil_itx_needcopy_count;\n\tkstat_named_t zil_itx_needcopy_bytes;\n\n\t \n\tkstat_named_t zil_itx_metaslab_normal_count;\n\tkstat_named_t zil_itx_metaslab_normal_bytes;\n\tkstat_named_t zil_itx_metaslab_normal_write;\n\tkstat_named_t zil_itx_metaslab_normal_alloc;\n\n\t \n\tkstat_named_t zil_itx_metaslab_slog_count;\n\tkstat_named_t zil_itx_metaslab_slog_bytes;\n\tkstat_named_t zil_itx_metaslab_slog_write;\n\tkstat_named_t zil_itx_metaslab_slog_alloc;\n} zil_kstat_values_t;\n\ntypedef struct zil_sums {\n\twmsum_t zil_commit_count;\n\twmsum_t zil_commit_writer_count;\n\twmsum_t zil_itx_count;\n\twmsum_t zil_itx_indirect_count;\n\twmsum_t zil_itx_indirect_bytes;\n\twmsum_t zil_itx_copied_count;\n\twmsum_t zil_itx_copied_bytes;\n\twmsum_t zil_itx_needcopy_count;\n\twmsum_t zil_itx_needcopy_bytes;\n\twmsum_t zil_itx_metaslab_normal_count;\n\twmsum_t zil_itx_metaslab_normal_bytes;\n\twmsum_t zil_itx_metaslab_normal_write;\n\twmsum_t zil_itx_metaslab_normal_alloc;\n\twmsum_t zil_itx_metaslab_slog_count;\n\twmsum_t zil_itx_metaslab_slog_bytes;\n\twmsum_t zil_itx_metaslab_slog_write;\n\twmsum_t zil_itx_metaslab_slog_alloc;\n} zil_sums_t;\n\n#define\tZIL_STAT_INCR(zil, stat, val) \\\n\tdo { \\\n\t\tint64_t tmpval = (val); \\\n\t\twmsum_add(&(zil_sums_global.stat), tmpval); \\\n\t\tif ((zil)->zl_sums) \\\n\t\t\twmsum_add(&((zil)->zl_sums->stat), tmpval); \\\n\t} while (0)\n\n#define\tZIL_STAT_BUMP(zil, stat) \\\n    ZIL_STAT_INCR(zil, stat, 1);\n\ntypedef int zil_parse_blk_func_t(zilog_t *zilog, const blkptr_t *bp, void *arg,\n    uint64_t txg);\ntypedef int zil_parse_lr_func_t(zilog_t *zilog, const lr_t *lr, void *arg,\n    uint64_t txg);\ntypedef int zil_replay_func_t(void *arg1, void *arg2, boolean_t byteswap);\ntypedef int zil_get_data_t(void *arg, uint64_t arg2, lr_write_t *lr, char *dbuf,\n    struct lwb *lwb, zio_t *zio);\n\nextern int zil_parse(zilog_t *zilog, zil_parse_blk_func_t *parse_blk_func,\n    zil_parse_lr_func_t *parse_lr_func, void *arg, uint64_t txg,\n    boolean_t decrypt);\n\nextern void\tzil_init(void);\nextern void\tzil_fini(void);\n\nextern zilog_t\t*zil_alloc(objset_t *os, zil_header_t *zh_phys);\nextern void\tzil_free(zilog_t *zilog);\n\nextern zilog_t\t*zil_open(objset_t *os, zil_get_data_t *get_data,\n    zil_sums_t *zil_sums);\nextern void\tzil_close(zilog_t *zilog);\n\nextern boolean_t zil_replay(objset_t *os, void *arg,\n    zil_replay_func_t *const replay_func[TX_MAX_TYPE]);\nextern boolean_t zil_replaying(zilog_t *zilog, dmu_tx_t *tx);\nextern boolean_t zil_destroy(zilog_t *zilog, boolean_t keep_first);\nextern void\tzil_destroy_sync(zilog_t *zilog, dmu_tx_t *tx);\n\nextern itx_t\t*zil_itx_create(uint64_t txtype, size_t lrsize);\nextern void\tzil_itx_destroy(itx_t *itx);\nextern void\tzil_itx_assign(zilog_t *zilog, itx_t *itx, dmu_tx_t *tx);\n\nextern void\tzil_async_to_sync(zilog_t *zilog, uint64_t oid);\nextern void\tzil_commit(zilog_t *zilog, uint64_t oid);\nextern void\tzil_commit_impl(zilog_t *zilog, uint64_t oid);\nextern void\tzil_remove_async(zilog_t *zilog, uint64_t oid);\n\nextern int\tzil_reset(const char *osname, void *txarg);\nextern int\tzil_claim(struct dsl_pool *dp,\n    struct dsl_dataset *ds, void *txarg);\nextern int \tzil_check_log_chain(struct dsl_pool *dp,\n    struct dsl_dataset *ds, void *tx);\nextern void\tzil_sync(zilog_t *zilog, dmu_tx_t *tx);\nextern void\tzil_clean(zilog_t *zilog, uint64_t synced_txg);\n\nextern int\tzil_suspend(const char *osname, void **cookiep);\nextern void\tzil_resume(void *cookie);\n\nextern void\tzil_lwb_add_block(struct lwb *lwb, const blkptr_t *bp);\nextern void\tzil_lwb_add_txg(struct lwb *lwb, uint64_t txg);\nextern int\tzil_bp_tree_add(zilog_t *zilog, const blkptr_t *bp);\n\nextern void\tzil_set_sync(zilog_t *zilog, uint64_t syncval);\n\nextern void\tzil_set_logbias(zilog_t *zilog, uint64_t slogval);\n\nextern uint64_t\tzil_max_copied_data(zilog_t *zilog);\nextern uint64_t\tzil_max_log_data(zilog_t *zilog, size_t hdrsize);\n\nextern void zil_sums_init(zil_sums_t *zs);\nextern void zil_sums_fini(zil_sums_t *zs);\nextern void zil_kstat_values_update(zil_kstat_values_t *zs,\n    zil_sums_t *zil_sums);\n\nextern int zil_replay_disable;\n\n#ifdef\t__cplusplus\n}\n#endif\n\n#endif\t \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}