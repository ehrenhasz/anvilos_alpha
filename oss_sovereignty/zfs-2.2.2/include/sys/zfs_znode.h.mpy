{
  "module_name": "zfs_znode.h",
  "hash_id": "18e736a666f2be2d779422cdc1f74bc376b4db28337d8b577b728e5f8e0d3315",
  "original_prompt": "Ingested from zfs-2.2.2/include/sys/zfs_znode.h",
  "human_readable_source": " \n \n\n#ifndef\t_SYS_FS_ZFS_ZNODE_H\n#define\t_SYS_FS_ZFS_ZNODE_H\n\n#include <sys/zfs_acl.h>\n#include <sys/zil.h>\n#include <sys/zfs_project.h>\n\n#ifdef\t__cplusplus\nextern \"C\" {\n#endif\n\n \n#define\tZFS_READONLY\t\t0x0000000100000000ull\n#define\tZFS_HIDDEN\t\t0x0000000200000000ull\n#define\tZFS_SYSTEM\t\t0x0000000400000000ull\n#define\tZFS_ARCHIVE\t\t0x0000000800000000ull\n#define\tZFS_IMMUTABLE\t\t0x0000001000000000ull\n#define\tZFS_NOUNLINK\t\t0x0000002000000000ull\n#define\tZFS_APPENDONLY\t\t0x0000004000000000ull\n#define\tZFS_NODUMP\t\t0x0000008000000000ull\n#define\tZFS_OPAQUE\t\t0x0000010000000000ull\n#define\tZFS_AV_QUARANTINED\t0x0000020000000000ull\n#define\tZFS_AV_MODIFIED\t\t0x0000040000000000ull\n#define\tZFS_REPARSE\t\t0x0000080000000000ull\n#define\tZFS_OFFLINE\t\t0x0000100000000000ull\n#define\tZFS_SPARSE\t\t0x0000200000000000ull\n\n \n#define\tZFS_PROJINHERIT\t\t0x0000400000000000ull\n\n \n#define\tZFS_PROJID\t\t0x0000800000000000ull\n\n#define\tZFS_ATTR_SET(zp, attr, value, pflags, tx) \\\n{ \\\n\tif (value) \\\n\t\tpflags |= attr; \\\n\telse \\\n\t\tpflags &= ~attr; \\\n\tVERIFY(0 == sa_update(zp->z_sa_hdl, SA_ZPL_FLAGS(ZTOZSB(zp)), \\\n\t    &pflags, sizeof (pflags), tx)); \\\n}\n\n \n#define\tZFS_XATTR\t\t0x1\t\t \n#define\tZFS_INHERIT_ACE\t\t0x2\t\t \n#define\tZFS_ACL_TRIVIAL\t\t0x4\t\t \n#define\tZFS_ACL_OBJ_ACE\t\t0x8\t\t \n#define\tZFS_ACL_PROTECTED\t0x10\t\t \n#define\tZFS_ACL_DEFAULTED\t0x20\t\t \n#define\tZFS_ACL_AUTO_INHERIT\t0x40\t\t \n#define\tZFS_BONUS_SCANSTAMP\t0x80\t\t \n#define\tZFS_NO_EXECS_DENIED\t0x100\t\t \n\n#define\tSA_ZPL_ATIME(z)\t\tz->z_attr_table[ZPL_ATIME]\n#define\tSA_ZPL_MTIME(z)\t\tz->z_attr_table[ZPL_MTIME]\n#define\tSA_ZPL_CTIME(z)\t\tz->z_attr_table[ZPL_CTIME]\n#define\tSA_ZPL_CRTIME(z)\tz->z_attr_table[ZPL_CRTIME]\n#define\tSA_ZPL_GEN(z)\t\tz->z_attr_table[ZPL_GEN]\n#define\tSA_ZPL_DACL_ACES(z)\tz->z_attr_table[ZPL_DACL_ACES]\n#define\tSA_ZPL_XATTR(z)\t\tz->z_attr_table[ZPL_XATTR]\n#define\tSA_ZPL_SYMLINK(z)\tz->z_attr_table[ZPL_SYMLINK]\n#define\tSA_ZPL_RDEV(z)\t\tz->z_attr_table[ZPL_RDEV]\n#define\tSA_ZPL_SCANSTAMP(z)\tz->z_attr_table[ZPL_SCANSTAMP]\n#define\tSA_ZPL_UID(z)\t\tz->z_attr_table[ZPL_UID]\n#define\tSA_ZPL_GID(z)\t\tz->z_attr_table[ZPL_GID]\n#define\tSA_ZPL_PARENT(z)\tz->z_attr_table[ZPL_PARENT]\n#define\tSA_ZPL_LINKS(z)\t\tz->z_attr_table[ZPL_LINKS]\n#define\tSA_ZPL_MODE(z)\t\tz->z_attr_table[ZPL_MODE]\n#define\tSA_ZPL_DACL_COUNT(z)\tz->z_attr_table[ZPL_DACL_COUNT]\n#define\tSA_ZPL_FLAGS(z)\t\tz->z_attr_table[ZPL_FLAGS]\n#define\tSA_ZPL_SIZE(z)\t\tz->z_attr_table[ZPL_SIZE]\n#define\tSA_ZPL_ZNODE_ACL(z)\tz->z_attr_table[ZPL_ZNODE_ACL]\n#define\tSA_ZPL_DXATTR(z)\tz->z_attr_table[ZPL_DXATTR]\n#define\tSA_ZPL_PAD(z)\t\tz->z_attr_table[ZPL_PAD]\n#define\tSA_ZPL_PROJID(z)\tz->z_attr_table[ZPL_PROJID]\n\n \n#define\tIS_EPHEMERAL(x)\t\t(x > MAXUID)\n\n \n#define\tUSE_FUIDS(version, os)\t(version >= ZPL_VERSION_FUID && \\\n    spa_version(dmu_objset_spa(os)) >= SPA_VERSION_FUID)\n#define\tUSE_SA(version, os) (version >= ZPL_VERSION_SA && \\\n    spa_version(dmu_objset_spa(os)) >= SPA_VERSION_SA)\n\n#define\tMASTER_NODE_OBJ\t1\n\n \n#define\tZFS_FSID\t\t\"FSID\"\n#define\tZFS_UNLINKED_SET\t\"DELETE_QUEUE\"\n#define\tZFS_ROOT_OBJ\t\t\"ROOT\"\n#define\tZPL_VERSION_STR\t\t\"VERSION\"\n#define\tZFS_FUID_TABLES\t\t\"FUID\"\n#define\tZFS_SHARES_DIR\t\t\"SHARES\"\n#define\tZFS_SA_ATTRS\t\t\"SA_ATTRS\"\n\n \n#ifndef IFTODT\n#define\tIFTODT(mode) (((mode) & S_IFMT) >> 12)\n#endif\n\n \n#define\tZFS_DIRENT_TYPE(de) BF64_GET(de, 60, 4)\n#define\tZFS_DIRENT_OBJ(de) BF64_GET(de, 0, 48)\n\nextern int zfs_obj_to_path(objset_t *osp, uint64_t obj, char *buf, int len);\nextern int zfs_get_zplprop(objset_t *os, zfs_prop_t prop, uint64_t *value);\n\n#ifdef _KERNEL\n#include <sys/zfs_znode_impl.h>\n\n \ntypedef struct zfs_dirlock {\n\tchar\t\t*dl_name;\t \n\tuint32_t\tdl_sharecnt;\t \n\tuint8_t\t\tdl_namelock;\t \n\tuint16_t\tdl_namesize;\t \n\tkcondvar_t\tdl_cv;\t\t \n\tstruct znode\t*dl_dzp;\t \n\tstruct zfs_dirlock *dl_next;\t \n} zfs_dirlock_t;\n\ntypedef struct znode {\n\tuint64_t\tz_id;\t\t \n\tkmutex_t\tz_lock;\t\t \n\tkrwlock_t\tz_parent_lock;\t \n\tkrwlock_t\tz_name_lock;\t \n\tzfs_dirlock_t\t*z_dirlocks;\t \n\tzfs_rangelock_t\tz_rangelock;\t \n\tboolean_t\tz_unlinked;\t \n\tboolean_t\tz_atime_dirty;\t \n\tboolean_t\tz_zn_prefetch;\t \n\tboolean_t\tz_is_sa;\t \n\tboolean_t\tz_is_ctldir;\t \n\tboolean_t\tz_suspended;\t \n\tuint_t\t\tz_blksz;\t \n\tuint_t\t\tz_seq;\t\t \n\tuint64_t\tz_mapcnt;\t \n\tuint64_t\tz_dnodesize;\t \n\tuint64_t\tz_size;\t\t \n\tuint64_t\tz_pflags;\t \n\tuint32_t\tz_sync_cnt;\t \n\tuint32_t\tz_sync_writes_cnt;  \n\tuint32_t\tz_async_writes_cnt;  \n\tmode_t\t\tz_mode;\t\t \n\tkmutex_t\tz_acl_lock;\t \n\tzfs_acl_t\t*z_acl_cached;\t \n\tkrwlock_t\tz_xattr_lock;\t \n\tnvlist_t\t*z_xattr_cached;  \n\tuint64_t\tz_xattr_parent;\t \n\tuint64_t\tz_projid;\t \n\tlist_node_t\tz_link_node;\t \n\tsa_handle_t\t*z_sa_hdl;\t \n\n\t \n\tZNODE_OS_FIELDS;\n} znode_t;\n\n \nstatic inline int\nzfs_verify_zp(znode_t *zp)\n{\n\tif (unlikely(zp->z_sa_hdl == NULL))\n\t\treturn (SET_ERROR(EIO));\n\treturn (0);\n}\n\n \nstatic inline int\nzfs_enter_verify_zp(zfsvfs_t *zfsvfs, znode_t *zp, const char *tag)\n{\n\tint error;\n\tif ((error = zfs_enter(zfsvfs, tag)) != 0)\n\t\treturn (error);\n\tif ((error = zfs_verify_zp(zp)) != 0) {\n\t\tzfs_exit(zfsvfs, tag);\n\t\treturn (error);\n\t}\n\treturn (0);\n}\n\ntypedef struct znode_hold {\n\tuint64_t\tzh_obj;\t\t \n\tavl_node_t\tzh_node;\t \n\tkmutex_t\tzh_lock;\t \n\tint\t\tzh_refcount;\t \n} znode_hold_t;\n\nstatic inline uint64_t\nzfs_inherit_projid(znode_t *dzp)\n{\n\treturn ((dzp->z_pflags & ZFS_PROJINHERIT) ? dzp->z_projid :\n\t    ZFS_DEFAULT_PROJID);\n}\n\n \n#define\tACCESSED\t\t(ATTR_ATIME)\n#define\tSTATE_CHANGED\t\t(ATTR_CTIME)\n#define\tCONTENT_MODIFIED\t(ATTR_MTIME | ATTR_CTIME)\n\nextern int\tzfs_init_fs(zfsvfs_t *, znode_t **);\nextern void\tzfs_set_dataprop(objset_t *);\nextern void\tzfs_create_fs(objset_t *os, cred_t *cr, nvlist_t *,\n    dmu_tx_t *tx);\nextern void\tzfs_tstamp_update_setup(znode_t *, uint_t, uint64_t [2],\n    uint64_t [2]);\nextern void\tzfs_grow_blocksize(znode_t *, uint64_t, dmu_tx_t *);\nextern int\tzfs_freesp(znode_t *, uint64_t, uint64_t, int, boolean_t);\nextern void\tzfs_znode_init(void);\nextern void\tzfs_znode_fini(void);\nextern int\tzfs_znode_hold_compare(const void *, const void *);\nextern znode_hold_t *zfs_znode_hold_enter(zfsvfs_t *, uint64_t);\nextern void\tzfs_znode_hold_exit(zfsvfs_t *, znode_hold_t *);\nextern int\tzfs_zget(zfsvfs_t *, uint64_t, znode_t **);\nextern int\tzfs_rezget(znode_t *);\nextern void\tzfs_zinactive(znode_t *);\nextern void\tzfs_znode_delete(znode_t *, dmu_tx_t *);\nextern void\tzfs_remove_op_tables(void);\nextern int\tzfs_create_op_tables(void);\nextern dev_t\tzfs_cmpldev(uint64_t);\nextern int\tzfs_get_stats(objset_t *os, nvlist_t *nv);\nextern boolean_t zfs_get_vfs_flag_unmounted(objset_t *os);\nextern void\tzfs_znode_dmu_fini(znode_t *);\n\nextern void zfs_log_create(zilog_t *zilog, dmu_tx_t *tx, uint64_t txtype,\n    znode_t *dzp, znode_t *zp, const char *name, vsecattr_t *,\n    zfs_fuid_info_t *, vattr_t *vap);\nextern int zfs_log_create_txtype(zil_create_t, vsecattr_t *vsecp,\n    vattr_t *vap);\nextern void zfs_log_remove(zilog_t *zilog, dmu_tx_t *tx, uint64_t txtype,\n    znode_t *dzp, const char *name, uint64_t foid, boolean_t unlinked);\n#define\tZFS_NO_OBJECT\t0\t \nextern void zfs_log_link(zilog_t *zilog, dmu_tx_t *tx, uint64_t txtype,\n    znode_t *dzp, znode_t *zp, const char *name);\nextern void zfs_log_symlink(zilog_t *zilog, dmu_tx_t *tx, uint64_t txtype,\n    znode_t *dzp, znode_t *zp, const char *name, const char *link);\nextern void zfs_log_rename(zilog_t *zilog, dmu_tx_t *tx, uint64_t txtype,\n    znode_t *sdzp, const char *sname, znode_t *tdzp, const char *dname,\n    znode_t *szp);\nextern void zfs_log_rename_exchange(zilog_t *zilog, dmu_tx_t *tx,\n    uint64_t txtype, znode_t *sdzp, const char *sname, znode_t *tdzp,\n    const char *dname, znode_t *szp);\nextern void zfs_log_rename_whiteout(zilog_t *zilog, dmu_tx_t *tx,\n    uint64_t txtype, znode_t *sdzp, const char *sname, znode_t *tdzp,\n    const char *dname, znode_t *szp, znode_t *wzp);\nextern void zfs_log_write(zilog_t *zilog, dmu_tx_t *tx, int txtype,\n    znode_t *zp, offset_t off, ssize_t len, int ioflag,\n    zil_callback_t callback, void *callback_data);\nextern void zfs_log_truncate(zilog_t *zilog, dmu_tx_t *tx, int txtype,\n    znode_t *zp, uint64_t off, uint64_t len);\nextern void zfs_log_setattr(zilog_t *zilog, dmu_tx_t *tx, int txtype,\n    znode_t *zp, vattr_t *vap, uint_t mask_applied, zfs_fuid_info_t *fuidp);\nextern void zfs_log_acl(zilog_t *zilog, dmu_tx_t *tx, znode_t *zp,\n    vsecattr_t *vsecp, zfs_fuid_info_t *fuidp);\nextern void zfs_log_clone_range(zilog_t *zilog, dmu_tx_t *tx, int txtype,\n    znode_t *zp, uint64_t offset, uint64_t length, uint64_t blksz,\n    const blkptr_t *bps, size_t nbps);\nextern void zfs_xvattr_set(znode_t *zp, xvattr_t *xvap, dmu_tx_t *tx);\nextern void zfs_upgrade(zfsvfs_t *zfsvfs, dmu_tx_t *tx);\nextern void zfs_log_setsaxattr(zilog_t *zilog, dmu_tx_t *tx, int txtype,\n    znode_t *zp, const char *name, const void *value, size_t size);\n\nextern void zfs_znode_update_vfs(struct znode *);\n\n#endif\n#ifdef\t__cplusplus\n}\n#endif\n\n#endif\t \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}