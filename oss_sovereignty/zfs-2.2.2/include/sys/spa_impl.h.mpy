{
  "module_name": "spa_impl.h",
  "hash_id": "19bcc1ba1f563c49635021f7e0ba17285a16c6768283fb7290ec559038732303",
  "original_prompt": "Ingested from zfs-2.2.2/include/sys/spa_impl.h",
  "human_readable_source": " \n \n\n#ifndef _SYS_SPA_IMPL_H\n#define\t_SYS_SPA_IMPL_H\n\n#include <sys/spa.h>\n#include <sys/spa_checkpoint.h>\n#include <sys/spa_log_spacemap.h>\n#include <sys/vdev.h>\n#include <sys/vdev_rebuild.h>\n#include <sys/vdev_removal.h>\n#include <sys/metaslab.h>\n#include <sys/dmu.h>\n#include <sys/dsl_pool.h>\n#include <sys/uberblock_impl.h>\n#include <sys/zfs_context.h>\n#include <sys/avl.h>\n#include <sys/zfs_refcount.h>\n#include <sys/bplist.h>\n#include <sys/bpobj.h>\n#include <sys/dsl_crypt.h>\n#include <sys/zfeature.h>\n#include <sys/zthr.h>\n#include <sys/dsl_deadlist.h>\n#include <zfeature_common.h>\n\n#ifdef\t__cplusplus\nextern \"C\" {\n#endif\n\ntypedef struct spa_alloc {\n\tkmutex_t\tspaa_lock;\n\tavl_tree_t\tspaa_tree;\n} ____cacheline_aligned spa_alloc_t;\n\ntypedef struct spa_error_entry {\n\tzbookmark_phys_t\tse_bookmark;\n\tchar\t\t\t*se_name;\n\tavl_node_t\t\tse_avl;\n\tzbookmark_err_phys_t\tse_zep;\t\t \n} spa_error_entry_t;\n\ntypedef struct spa_history_phys {\n\tuint64_t sh_pool_create_len;\t \n\tuint64_t sh_phys_max_off;\t \n\tuint64_t sh_bof;\t\t \n\tuint64_t sh_eof;\t\t \n\tuint64_t sh_records_lost;\t \n} spa_history_phys_t;\n\n \ntypedef struct spa_removing_phys {\n\tuint64_t sr_state;  \n\n\t \n\tuint64_t sr_removing_vdev;\n\n\t \n\tuint64_t sr_prev_indirect_vdev;\n\n\tuint64_t sr_start_time;\n\tuint64_t sr_end_time;\n\n\t \n\tuint64_t sr_to_copy;  \n\tuint64_t sr_copied;  \n} spa_removing_phys_t;\n\n \ntypedef struct spa_condensing_indirect_phys {\n\t \n\tuint64_t\tscip_vdev;\n\n\t \n\tuint64_t\tscip_prev_obsolete_sm_object;\n\n\t \n\tuint64_t\tscip_next_mapping_object;\n} spa_condensing_indirect_phys_t;\n\nstruct spa_aux_vdev {\n\tuint64_t\tsav_object;\t\t \n\tnvlist_t\t*sav_config;\t\t \n\tvdev_t\t\t**sav_vdevs;\t\t \n\tint\t\tsav_count;\t\t \n\tboolean_t\tsav_sync;\t\t \n\tnvlist_t\t**sav_pending;\t\t \n\tuint_t\t\tsav_npending;\t\t \n};\n\ntypedef struct spa_config_lock {\n\tkmutex_t\tscl_lock;\n\tkthread_t\t*scl_writer;\n\tint\t\tscl_write_wanted;\n\tint\t\tscl_count;\n\tkcondvar_t\tscl_cv;\n} ____cacheline_aligned spa_config_lock_t;\n\ntypedef struct spa_config_dirent {\n\tlist_node_t\tscd_link;\n\tchar\t\t*scd_path;\n} spa_config_dirent_t;\n\ntypedef enum zio_taskq_type {\n\tZIO_TASKQ_ISSUE = 0,\n\tZIO_TASKQ_ISSUE_HIGH,\n\tZIO_TASKQ_INTERRUPT,\n\tZIO_TASKQ_INTERRUPT_HIGH,\n\tZIO_TASKQ_TYPES\n} zio_taskq_type_t;\n\n \ntypedef enum spa_proc_state {\n\tSPA_PROC_NONE,\t\t \n\tSPA_PROC_CREATED,\t \n\tSPA_PROC_ACTIVE,\t \n\tSPA_PROC_DEACTIVATE,\t \n\tSPA_PROC_GONE\t\t \n} spa_proc_state_t;\n\ntypedef struct spa_taskqs {\n\tuint_t stqs_count;\n\ttaskq_t **stqs_taskq;\n} spa_taskqs_t;\n\ntypedef enum spa_all_vdev_zap_action {\n\tAVZ_ACTION_NONE = 0,\n\tAVZ_ACTION_DESTROY,\t \n\tAVZ_ACTION_REBUILD,\t \n\tAVZ_ACTION_INITIALIZE\n} spa_avz_action_t;\n\ntypedef enum spa_config_source {\n\tSPA_CONFIG_SRC_NONE = 0,\n\tSPA_CONFIG_SRC_SCAN,\t\t \n\tSPA_CONFIG_SRC_CACHEFILE,\t \n\tSPA_CONFIG_SRC_TRYIMPORT,\t \n\tSPA_CONFIG_SRC_SPLIT,\t\t \n\tSPA_CONFIG_SRC_MOS\t\t \n} spa_config_source_t;\n\nstruct spa {\n\t \n\tchar\t\tspa_name[ZFS_MAX_DATASET_NAME_LEN];\t \n\tchar\t\t*spa_comment;\t\t \n\tavl_node_t\tspa_avl;\t\t \n\tnvlist_t\t*spa_config;\t\t \n\tnvlist_t\t*spa_config_syncing;\t \n\tnvlist_t\t*spa_config_splitting;\t \n\tnvlist_t\t*spa_load_info;\t\t \n\tuint64_t\tspa_config_txg;\t\t \n\tuint32_t\tspa_sync_pass;\t\t \n\tpool_state_t\tspa_state;\t\t \n\tint\t\tspa_inject_ref;\t\t \n\tuint8_t\t\tspa_sync_on;\t\t \n\tspa_load_state_t spa_load_state;\t \n\tboolean_t\tspa_indirect_vdevs_loaded;  \n\tboolean_t\tspa_trust_config;\t \n\tboolean_t\tspa_is_splitting;\t \n\tspa_config_source_t spa_config_source;\t \n\tuint64_t\tspa_import_flags;\t \n\tspa_taskqs_t\tspa_zio_taskq[ZIO_TYPES][ZIO_TASKQ_TYPES];\n\tdsl_pool_t\t*spa_dsl_pool;\n\tboolean_t\tspa_is_initializing;\t \n\tboolean_t\tspa_is_exporting;\t \n\tmetaslab_class_t *spa_normal_class;\t \n\tmetaslab_class_t *spa_log_class;\t \n\tmetaslab_class_t *spa_embedded_log_class;  \n\tmetaslab_class_t *spa_special_class;\t \n\tmetaslab_class_t *spa_dedup_class;\t \n\tuint64_t\tspa_first_txg;\t\t \n\tuint64_t\tspa_final_txg;\t\t \n\tuint64_t\tspa_freeze_txg;\t\t \n\tuint64_t\tspa_load_max_txg;\t \n\tuint64_t\tspa_claim_max_txg;\t \n\tinode_timespec_t spa_loaded_ts;\t\t \n\tobjset_t\t*spa_meta_objset;\t \n\tkmutex_t\tspa_evicting_os_lock;\t \n\tlist_t\t\tspa_evicting_os_list;\t \n\tkcondvar_t\tspa_evicting_os_cv;\t \n\ttxg_list_t\tspa_vdev_txg_list;\t \n\tvdev_t\t\t*spa_root_vdev;\t\t \n\tuint64_t\tspa_min_ashift;\t\t \n\tuint64_t\tspa_max_ashift;\t\t \n\tuint64_t\tspa_min_alloc;\t\t \n\tuint64_t\tspa_gcd_alloc;\t\t \n\tuint64_t\tspa_config_guid;\t \n\tuint64_t\tspa_load_guid;\t\t \n\tuint64_t\tspa_last_synced_guid;\t \n\tlist_t\t\tspa_config_dirty_list;\t \n\tlist_t\t\tspa_state_dirty_list;\t \n\t \n\tspa_alloc_t\t*spa_allocs;\n\tint\t\tspa_alloc_count;\n\n\tspa_aux_vdev_t\tspa_spares;\t\t \n\tspa_aux_vdev_t\tspa_l2cache;\t\t \n\tnvlist_t\t*spa_label_features;\t \n\tuint64_t\tspa_config_object;\t \n\tuint64_t\tspa_config_generation;\t \n\tuint64_t\tspa_syncing_txg;\t \n\tbpobj_t\t\tspa_deferred_bpobj;\t \n\tbplist_t\tspa_free_bplist[TXG_SIZE];  \n\tzio_cksum_salt_t spa_cksum_salt;\t \n\t \n\tkmutex_t\tspa_cksum_tmpls_lock;\n\tvoid\t\t*spa_cksum_tmpls[ZIO_CHECKSUM_FUNCTIONS];\n\tuberblock_t\tspa_ubsync;\t\t \n\tuberblock_t\tspa_uberblock;\t\t \n\tboolean_t\tspa_extreme_rewind;\t \n\tkmutex_t\tspa_scrub_lock;\t\t \n\tuint64_t\tspa_scrub_inflight;\t \n\n\t \n\tuint64_t\tspa_load_verify_bytes;\n\tkcondvar_t\tspa_scrub_io_cv;\t \n\tuint8_t\t\tspa_scrub_active;\t \n\tuint8_t\t\tspa_scrub_type;\t\t \n\tuint8_t\t\tspa_scrub_finished;\t \n\tuint8_t\t\tspa_scrub_started;\t \n\tuint8_t\t\tspa_scrub_reopen;\t \n\tuint64_t\tspa_scan_pass_start;\t \n\tuint64_t\tspa_scan_pass_scrub_pause;  \n\tuint64_t\tspa_scan_pass_scrub_spent_paused;  \n\tuint64_t\tspa_scan_pass_exam;\t \n\tuint64_t\tspa_scan_pass_issued;\t \n\n\t \n\tuint64_t\tspa_scan_pass_errorscrub_pause;\n\t \n\tuint64_t\tspa_scan_pass_errorscrub_spent_paused;\n\t \n\tboolean_t\tspa_resilver_deferred;\n\tkmutex_t\tspa_async_lock;\t\t \n\tkthread_t\t*spa_async_thread;\t \n\tint\t\tspa_async_suspended;\t \n\tkcondvar_t\tspa_async_cv;\t\t \n\tuint16_t\tspa_async_tasks;\t \n\tuint64_t\tspa_missing_tvds;\t \n\tuint64_t\tspa_missing_tvds_allowed;  \n\n\tuint64_t\tspa_nonallocating_dspace;\n\tspa_removing_phys_t spa_removing_phys;\n\tspa_vdev_removal_t *spa_vdev_removal;\n\n\tspa_condensing_indirect_phys_t\tspa_condensing_indirect_phys;\n\tspa_condensing_indirect_t\t*spa_condensing_indirect;\n\tzthr_t\t\t*spa_condense_zthr;\t \n\n\tuint64_t\tspa_checkpoint_txg;\t \n\tspa_checkpoint_info_t spa_checkpoint_info;  \n\tzthr_t\t\t*spa_checkpoint_discard_zthr;\n\n\tspace_map_t\t*spa_syncing_log_sm;\t \n\tavl_tree_t\tspa_sm_logs_by_txg;\n\tkmutex_t\tspa_flushed_ms_lock;\t \n\tavl_tree_t\tspa_metaslabs_by_flushed;\n\tspa_unflushed_stats_t\tspa_unflushed_stats;\n\tlist_t\t\tspa_log_summary;\n\tuint64_t\tspa_log_flushall_txg;\n\n\tzthr_t\t\t*spa_livelist_delete_zthr;  \n\tzthr_t\t\t*spa_livelist_condense_zthr;  \n\tuint64_t\tspa_livelists_to_delete;  \n\tlivelist_condense_entry_t\tspa_to_condense;  \n\n\tchar\t\t*spa_root;\t\t \n\tuint64_t\tspa_ena;\t\t \n\tint\t\tspa_last_open_failed;\t \n\tuint64_t\tspa_last_ubsync_txg;\t \n\tuint64_t\tspa_last_ubsync_txg_ts;\t \n\tuint64_t\tspa_load_txg;\t\t \n\tuint64_t\tspa_load_txg_ts;\t \n\tuint64_t\tspa_load_meta_errors;\t \n\tuint64_t\tspa_load_data_errors;\t \n\tuint64_t\tspa_verify_min_txg;\t \n\tkmutex_t\tspa_errlog_lock;\t \n\tuint64_t\tspa_errlog_last;\t \n\tuint64_t\tspa_errlog_scrub;\t \n\tkmutex_t\tspa_errlist_lock;\t \n\tavl_tree_t\tspa_errlist_last;\t \n\tavl_tree_t\tspa_errlist_scrub;\t \n\tavl_tree_t\tspa_errlist_healed;\t \n\tuint64_t\tspa_deflate;\t\t \n\tuint64_t\tspa_history;\t\t \n\tkmutex_t\tspa_history_lock;\t \n\tvdev_t\t\t*spa_pending_vdev;\t \n\tkmutex_t\tspa_props_lock;\t\t \n\tuint64_t\tspa_pool_props_object;\t \n\tuint64_t\tspa_bootfs;\t\t \n\tuint64_t\tspa_failmode;\t\t \n\tuint64_t\tspa_deadman_failmode;\t \n\tuint64_t\tspa_delegation;\t\t \n\tlist_t\t\tspa_config_list;\t \n\t \n\tzio_t\t\t**spa_async_zio_root;\n\tzio_t\t\t*spa_suspend_zio_root;\t \n\tzio_t\t\t*spa_txg_zio[TXG_SIZE];  \n\tkmutex_t\tspa_suspend_lock;\t \n\tkcondvar_t\tspa_suspend_cv;\t\t \n\tzio_suspend_reason_t\tspa_suspended;\t \n\tuint8_t\t\tspa_claiming;\t\t \n\tboolean_t\tspa_is_root;\t\t \n\tint\t\tspa_minref;\t\t \n\tspa_mode_t\tspa_mode;\t\t \n\tboolean_t\tspa_read_spacemaps;\t \n\tspa_log_state_t spa_log_state;\t\t \n\tuint64_t\tspa_autoexpand;\t\t \n\tddt_t\t\t*spa_ddt[ZIO_CHECKSUM_FUNCTIONS];  \n\tuint64_t\tspa_ddt_stat_object;\t \n\tuint64_t\tspa_dedup_dspace;\t \n\tuint64_t\tspa_dedup_checksum;\t \n\tuint64_t\tspa_dspace;\t\t \n\tstruct brt\t*spa_brt;\t\t \n\tkmutex_t\tspa_vdev_top_lock;\t \n\tkmutex_t\tspa_proc_lock;\t\t \n\tkcondvar_t\tspa_proc_cv;\t\t \n\tspa_proc_state_t spa_proc_state;\t \n\tproc_t\t\t*spa_proc;\t\t \n\tuintptr_t\tspa_did;\t\t \n\tboolean_t\tspa_autoreplace;\t \n\tint\t\tspa_vdev_locks;\t\t \n\tuint64_t\tspa_creation_version;\t \n\tuint64_t\tspa_prev_software_version;  \n\tuint64_t\tspa_feat_for_write_obj;\t \n\tuint64_t\tspa_feat_for_read_obj;\t \n\tuint64_t\tspa_feat_desc_obj;\t \n\tuint64_t\tspa_feat_enabled_txg_obj;  \n\tkmutex_t\tspa_feat_stats_lock;\t \n\tnvlist_t\t*spa_feat_stats;\t \n\t \n\tuint64_t\tspa_feat_refcount_cache[SPA_FEATURES];\n\ttaskqid_t\tspa_deadman_tqid;\t \n\tuint64_t\tspa_deadman_calls;\t \n\thrtime_t\tspa_sync_starttime;\t \n\tuint64_t\tspa_deadman_synctime;\t \n\tuint64_t\tspa_deadman_ziotime;\t \n\tuint64_t\tspa_all_vdev_zaps;\t \n\tspa_avz_action_t\tspa_avz_action;\t \n\tuint64_t\tspa_autotrim;\t\t \n\tuint64_t\tspa_errata;\t\t \n\tspa_stats_t\tspa_stats;\t\t \n\tspa_keystore_t\tspa_keystore;\t\t \n\n\t \n\tuint64_t\tspa_lowmem_page_load;\t \n\tuint64_t\tspa_lowmem_last_txg;\t \n\n\thrtime_t\tspa_ccw_fail_time;\t \n\ttaskq_t\t\t*spa_zvol_taskq;\t \n\ttaskq_t\t\t*spa_metaslab_taskq;\t \n\ttaskq_t\t\t*spa_prefetch_taskq;\t \n\ttaskq_t\t\t*spa_upgrade_taskq;\t \n\tuint64_t\tspa_multihost;\t\t \n\tmmp_thread_t\tspa_mmp;\t\t \n\tlist_t\t\tspa_leaf_list;\t\t \n\tuint64_t\tspa_leaf_list_gen;\t \n\tuint32_t\tspa_hostid;\t\t \n\n\t \n\tkmutex_t\tspa_activities_lock;\n\tkcondvar_t\tspa_activities_cv;\n\tkcondvar_t\tspa_waiters_cv;\n\tint\t\tspa_waiters;\t\t \n\tboolean_t\tspa_waiters_cancel;\t \n\n\tchar\t\t*spa_compatibility;\t \n\n\t \n\tspa_config_lock_t spa_config_lock[SCL_LOCKS];  \n\tzfs_refcount_t\tspa_refcount;\t\t \n};\n\nextern char *spa_config_path;\nextern const char *zfs_deadman_failmode;\nextern uint_t spa_slop_shift;\nextern void spa_taskq_dispatch_ent(spa_t *spa, zio_type_t t, zio_taskq_type_t q,\n    task_func_t *func, void *arg, uint_t flags, taskq_ent_t *ent);\nextern void spa_taskq_dispatch_sync(spa_t *, zio_type_t t, zio_taskq_type_t q,\n    task_func_t *func, void *arg, uint_t flags);\nextern void spa_load_spares(spa_t *spa);\nextern void spa_load_l2cache(spa_t *spa);\nextern sysevent_t *spa_event_create(spa_t *spa, vdev_t *vd, nvlist_t *hist_nvl,\n    const char *name);\nextern void spa_event_post(sysevent_t *ev);\nextern int param_set_deadman_failmode_common(const char *val);\nextern void spa_set_deadman_synctime(hrtime_t ns);\nextern void spa_set_deadman_ziotime(hrtime_t ns);\nextern const char *spa_history_zone(void);\n\n#ifdef\t__cplusplus\n}\n#endif\n\n#endif\t \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}