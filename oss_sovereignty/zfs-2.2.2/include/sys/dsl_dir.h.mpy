{
  "module_name": "dsl_dir.h",
  "hash_id": "ae144a3a33eed699ab5d31afc12d35341268fd1275fcb4e3d4cabc5f1cf7a079",
  "original_prompt": "Ingested from zfs-2.2.2/include/sys/dsl_dir.h",
  "human_readable_source": " \n \n\n#ifndef\t_SYS_DSL_DIR_H\n#define\t_SYS_DSL_DIR_H\n\n#include <sys/dmu.h>\n#include <sys/dsl_deadlist.h>\n#include <sys/dsl_pool.h>\n#include <sys/dsl_synctask.h>\n#include <sys/zfs_refcount.h>\n#include <sys/zfs_context.h>\n#include <sys/dsl_crypt.h>\n#include <sys/bplist.h>\n\n#ifdef\t__cplusplus\nextern \"C\" {\n#endif\n\nstruct dsl_dataset;\nstruct zthr;\n \n\n#define\tDD_FIELD_FILESYSTEM_COUNT\t\"com.joyent:filesystem_count\"\n#define\tDD_FIELD_SNAPSHOT_COUNT\t\t\"com.joyent:snapshot_count\"\n#define\tDD_FIELD_CRYPTO_KEY_OBJ\t\t\"com.datto:crypto_key_obj\"\n#define\tDD_FIELD_LIVELIST\t\t\"com.delphix:livelist\"\n#define\tDD_FIELD_SNAPSHOTS_CHANGED\t\"com.ixsystems:snapshots_changed\"\n\ntypedef enum dd_used {\n\tDD_USED_HEAD,\n\tDD_USED_SNAP,\n\tDD_USED_CHILD,\n\tDD_USED_CHILD_RSRV,\n\tDD_USED_REFRSRV,\n\tDD_USED_NUM\n} dd_used_t;\n\n#define\tDD_FLAG_USED_BREAKDOWN (1<<0)\n\ntypedef struct dsl_dir_phys {\n\tuint64_t dd_creation_time;  \n\tuint64_t dd_head_dataset_obj;\n\tuint64_t dd_parent_obj;\n\tuint64_t dd_origin_obj;\n\tuint64_t dd_child_dir_zapobj;\n\t \n\tuint64_t dd_used_bytes;\n\tuint64_t dd_compressed_bytes;\n\tuint64_t dd_uncompressed_bytes;\n\t \n\tuint64_t dd_quota;\n\t \n\tuint64_t dd_reserved;\n\tuint64_t dd_props_zapobj;\n\tuint64_t dd_deleg_zapobj;  \n\tuint64_t dd_flags;\n\tuint64_t dd_used_breakdown[DD_USED_NUM];\n\tuint64_t dd_clones;  \n\tuint64_t dd_pad[13];  \n} dsl_dir_phys_t;\n\nstruct dsl_dir {\n\tdmu_buf_user_t dd_dbu;\n\n\t \n\tuint64_t dd_object;\n\tuint64_t dd_crypto_obj;\n\tdsl_pool_t *dd_pool;\n\n\t \n\tdmu_buf_t *dd_dbuf;\n\n\t \n\ttxg_node_t dd_dirty_link;\n\n\t \n\tdsl_dir_t *dd_parent;\n\n\t \n\tkmutex_t dd_lock;\n\tlist_t dd_props;  \n\tinode_timespec_t dd_snap_cmtime;  \n\tuint64_t dd_origin_txg;\n\n\t \n\tuint64_t dd_tempreserved[TXG_SIZE];\n\t \n\tuint64_t dd_space_towrite[TXG_SIZE];\n\n\tdsl_deadlist_t dd_livelist;\n\tbplist_t dd_pending_frees;\n\tbplist_t dd_pending_allocs;\n\n\tkmutex_t dd_activity_lock;\n\tkcondvar_t dd_activity_cv;\n\tboolean_t dd_activity_cancelled;\n\tuint64_t dd_activity_waiters;\n\n\t \n\tchar dd_myname[ZFS_MAX_DATASET_NAME_LEN];\n};\n\nstatic inline dsl_dir_phys_t *\ndsl_dir_phys(dsl_dir_t *dd)\n{\n\treturn (dd->dd_dbuf->db_data);\n}\n\nvoid dsl_dir_rele(dsl_dir_t *dd, const void *tag);\nvoid dsl_dir_async_rele(dsl_dir_t *dd, const void *tag);\nint dsl_dir_hold(dsl_pool_t *dp, const char *name, const void *tag,\n    dsl_dir_t **, const char **tail);\nint dsl_dir_hold_obj(dsl_pool_t *dp, uint64_t ddobj,\n    const char *tail, const void *tag, dsl_dir_t **);\nvoid dsl_dir_name(dsl_dir_t *dd, char *buf);\nint dsl_dir_namelen(dsl_dir_t *dd);\nuint64_t dsl_dir_create_sync(dsl_pool_t *dp, dsl_dir_t *pds,\n    const char *name, dmu_tx_t *tx);\n\nuint64_t dsl_dir_get_used(dsl_dir_t *dd);\nuint64_t dsl_dir_get_compressed(dsl_dir_t *dd);\nuint64_t dsl_dir_get_quota(dsl_dir_t *dd);\nuint64_t dsl_dir_get_reservation(dsl_dir_t *dd);\nuint64_t dsl_dir_get_compressratio(dsl_dir_t *dd);\nuint64_t dsl_dir_get_logicalused(dsl_dir_t *dd);\nuint64_t dsl_dir_get_usedsnap(dsl_dir_t *dd);\nuint64_t dsl_dir_get_usedds(dsl_dir_t *dd);\nuint64_t dsl_dir_get_usedrefreserv(dsl_dir_t *dd);\nuint64_t dsl_dir_get_usedchild(dsl_dir_t *dd);\nvoid dsl_dir_get_origin(dsl_dir_t *dd, char *buf);\nint dsl_dir_get_filesystem_count(dsl_dir_t *dd, uint64_t *count);\nint dsl_dir_get_snapshot_count(dsl_dir_t *dd, uint64_t *count);\n\nvoid dsl_dir_stats(dsl_dir_t *dd, nvlist_t *nv);\nuint64_t dsl_dir_space_available(dsl_dir_t *dd,\n    dsl_dir_t *ancestor, int64_t delta, int ondiskonly);\nvoid dsl_dir_dirty(dsl_dir_t *dd, dmu_tx_t *tx);\nvoid dsl_dir_sync(dsl_dir_t *dd, dmu_tx_t *tx);\nint dsl_dir_tempreserve_space(dsl_dir_t *dd, uint64_t mem,\n    uint64_t asize, boolean_t netfree, void **tr_cookiep, dmu_tx_t *tx);\nvoid dsl_dir_tempreserve_clear(void *tr_cookie, dmu_tx_t *tx);\nvoid dsl_dir_willuse_space(dsl_dir_t *dd, int64_t space, dmu_tx_t *tx);\nvoid dsl_dir_diduse_space(dsl_dir_t *dd, dd_used_t type,\n    int64_t used, int64_t compressed, int64_t uncompressed, dmu_tx_t *tx);\nvoid dsl_dir_transfer_space(dsl_dir_t *dd, int64_t delta,\n    dd_used_t oldtype, dd_used_t newtype, dmu_tx_t *tx);\nvoid dsl_dir_diduse_transfer_space(dsl_dir_t *dd, int64_t used,\n    int64_t compressed, int64_t uncompressed, int64_t tonew,\n    dd_used_t oldtype, dd_used_t newtype, dmu_tx_t *tx);\nint dsl_dir_set_quota(const char *ddname, zprop_source_t source,\n    uint64_t quota);\nint dsl_dir_set_reservation(const char *ddname, zprop_source_t source,\n    uint64_t reservation);\nint dsl_dir_activate_fs_ss_limit(const char *);\nint dsl_fs_ss_limit_check(dsl_dir_t *, uint64_t, zfs_prop_t, dsl_dir_t *,\n    cred_t *, proc_t *);\nvoid dsl_fs_ss_count_adjust(dsl_dir_t *, int64_t, const char *, dmu_tx_t *);\nint dsl_dir_rename(const char *oldname, const char *newname);\nint dsl_dir_transfer_possible(dsl_dir_t *sdd, dsl_dir_t *tdd,\n    uint64_t fs_cnt, uint64_t ss_cnt, uint64_t space, cred_t *, proc_t *);\nboolean_t dsl_dir_is_clone(dsl_dir_t *dd);\nvoid dsl_dir_new_refreservation(dsl_dir_t *dd, struct dsl_dataset *ds,\n    uint64_t reservation, cred_t *cr, dmu_tx_t *tx);\nvoid dsl_dir_snap_cmtime_update(dsl_dir_t *dd, dmu_tx_t *tx);\ninode_timespec_t dsl_dir_snap_cmtime(dsl_dir_t *dd);\nvoid dsl_dir_set_reservation_sync_impl(dsl_dir_t *dd, uint64_t value,\n    dmu_tx_t *tx);\nvoid dsl_dir_zapify(dsl_dir_t *dd, dmu_tx_t *tx);\nboolean_t dsl_dir_is_zapified(dsl_dir_t *dd);\nvoid dsl_dir_livelist_open(dsl_dir_t *dd, uint64_t obj);\nvoid dsl_dir_livelist_close(dsl_dir_t *dd);\nvoid dsl_dir_remove_livelist(dsl_dir_t *dd, dmu_tx_t *tx, boolean_t total);\nint dsl_dir_wait(dsl_dir_t *dd, dsl_dataset_t *ds, zfs_wait_activity_t activity,\n    boolean_t *waited);\nvoid dsl_dir_cancel_waiters(dsl_dir_t *dd);\n\n \n#define\tMOS_DIR_NAME \"$MOS\"\n#define\tORIGIN_DIR_NAME \"$ORIGIN\"\n#define\tFREE_DIR_NAME \"$FREE\"\n#define\tLEAK_DIR_NAME \"$LEAK\"\n\n#ifdef ZFS_DEBUG\n#define\tdprintf_dd(dd, fmt, ...) do { \\\n\tif (zfs_flags & ZFS_DEBUG_DPRINTF) { \\\n\tchar *__ds_name = kmem_alloc(ZFS_MAX_DATASET_NAME_LEN, KM_SLEEP); \\\n\tdsl_dir_name(dd, __ds_name); \\\n\tdprintf(\"dd=%s \" fmt, __ds_name, __VA_ARGS__); \\\n\tkmem_free(__ds_name, ZFS_MAX_DATASET_NAME_LEN); \\\n\t} \\\n} while (0)\n#else\n#define\tdprintf_dd(dd, fmt, ...)\n#endif\n\n#ifdef\t__cplusplus\n}\n#endif\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}