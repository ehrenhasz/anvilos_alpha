{
  "module_name": "zfs_refcount.h",
  "hash_id": "23a5b7c8844e7f50eff9a3d8cb515fd4749caa99dab8df26c9befdfd5b5e0ec5",
  "original_prompt": "Ingested from zfs-2.2.2/include/sys/zfs_refcount.h",
  "human_readable_source": " \n \n\n#ifndef\t_SYS_ZFS_REFCOUNT_H\n#define\t_SYS_ZFS_REFCOUNT_H\n\n#include <sys/inttypes.h>\n#include <sys/avl.h>\n#include <sys/list.h>\n#include <sys/zfs_context.h>\n\n#ifdef\t__cplusplus\nextern \"C\" {\n#endif\n\n \n#define\tFTAG ((char *)(uintptr_t)__func__)\n\n#ifdef\tZFS_DEBUG\ntypedef struct reference {\n\tunion {\n\t\tavl_node_t a;\n\t\tlist_node_t l;\n\t} ref_link;\n\tconst void *ref_holder;\n\tuint64_t ref_number;\n\tboolean_t ref_search;\n} reference_t;\n\ntypedef struct refcount {\n\tuint64_t rc_count;\n\tkmutex_t rc_mtx;\n\tavl_tree_t rc_tree;\n\tlist_t rc_removed;\n\tuint_t rc_removed_count;\n\tboolean_t rc_tracked;\n} zfs_refcount_t;\n\n \n\nvoid zfs_refcount_create(zfs_refcount_t *);\nvoid zfs_refcount_create_untracked(zfs_refcount_t *);\nvoid zfs_refcount_create_tracked(zfs_refcount_t *);\nvoid zfs_refcount_destroy(zfs_refcount_t *);\nvoid zfs_refcount_destroy_many(zfs_refcount_t *, uint64_t);\nint zfs_refcount_is_zero(zfs_refcount_t *);\nint64_t zfs_refcount_count(zfs_refcount_t *);\nint64_t zfs_refcount_add(zfs_refcount_t *, const void *);\nint64_t zfs_refcount_remove(zfs_refcount_t *, const void *);\n \nvoid zfs_refcount_add_few(zfs_refcount_t *, uint64_t, const void *);\nvoid zfs_refcount_remove_few(zfs_refcount_t *, uint64_t, const void *);\nint64_t zfs_refcount_add_many(zfs_refcount_t *, uint64_t, const void *);\nint64_t zfs_refcount_remove_many(zfs_refcount_t *, uint64_t, const void *);\nvoid zfs_refcount_transfer(zfs_refcount_t *, zfs_refcount_t *);\nvoid zfs_refcount_transfer_ownership(zfs_refcount_t *, const void *,\n    const void *);\nvoid zfs_refcount_transfer_ownership_many(zfs_refcount_t *, uint64_t,\n    const void *, const void *);\nboolean_t zfs_refcount_held(zfs_refcount_t *, const void *);\nboolean_t zfs_refcount_not_held(zfs_refcount_t *, const void *);\n\nvoid zfs_refcount_init(void);\nvoid zfs_refcount_fini(void);\n\n#else\t \n\ntypedef struct refcount {\n\tuint64_t rc_count;\n} zfs_refcount_t;\n\n#define\tzfs_refcount_create(rc) ((rc)->rc_count = 0)\n#define\tzfs_refcount_create_untracked(rc) ((rc)->rc_count = 0)\n#define\tzfs_refcount_create_tracked(rc) ((rc)->rc_count = 0)\n#define\tzfs_refcount_destroy(rc) ((rc)->rc_count = 0)\n#define\tzfs_refcount_destroy_many(rc, number) ((rc)->rc_count = 0)\n#define\tzfs_refcount_is_zero(rc) (zfs_refcount_count(rc) == 0)\n#define\tzfs_refcount_count(rc) atomic_load_64(&(rc)->rc_count)\n#define\tzfs_refcount_add(rc, holder) atomic_inc_64_nv(&(rc)->rc_count)\n#define\tzfs_refcount_remove(rc, holder) atomic_dec_64_nv(&(rc)->rc_count)\n#define\tzfs_refcount_add_few(rc, number, holder) \\\n\tatomic_add_64(&(rc)->rc_count, number)\n#define\tzfs_refcount_remove_few(rc, number, holder) \\\n\tatomic_add_64(&(rc)->rc_count, -number)\n#define\tzfs_refcount_add_many(rc, number, holder) \\\n\tatomic_add_64_nv(&(rc)->rc_count, number)\n#define\tzfs_refcount_remove_many(rc, number, holder) \\\n\tatomic_add_64_nv(&(rc)->rc_count, -number)\n#define\tzfs_refcount_transfer(dst, src) { \\\n\tuint64_t __tmp = zfs_refcount_count(src); \\\n\tatomic_add_64(&(src)->rc_count, -__tmp); \\\n\tatomic_add_64(&(dst)->rc_count, __tmp); \\\n}\n#define\tzfs_refcount_transfer_ownership(rc, ch, nh)\t\t((void)0)\n#define\tzfs_refcount_transfer_ownership_many(rc, nr, ch, nh)\t((void)0)\n#define\tzfs_refcount_held(rc, holder)\t\t(zfs_refcount_count(rc) > 0)\n#define\tzfs_refcount_not_held(rc, holder)\t\t(B_TRUE)\n\n#define\tzfs_refcount_init()\n#define\tzfs_refcount_fini()\n\n#endif\t \n\n#ifdef\t__cplusplus\n}\n#endif\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}