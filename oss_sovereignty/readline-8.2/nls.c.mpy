{
  "module_name": "nls.c",
  "hash_id": "72bdf5d458b75c26ce47f0726a18a95064ce5f437c413a1d026f10cf731c7e19",
  "original_prompt": "Ingested from readline-8.2/nls.c",
  "human_readable_source": " \n\n \n\n#define READLINE_LIBRARY\n\n#if defined (HAVE_CONFIG_H)\n#  include <config.h>\n#endif\n\n#include <sys/types.h>\n\n#include <stdio.h>\n\n#if defined (HAVE_UNISTD_H)\n#  include <unistd.h>\n#endif  \n\n#if defined (HAVE_STDLIB_H)\n#  include <stdlib.h>\n#else\n#  include \"ansi_stdlib.h\"\n#endif  \n\n#if defined (HAVE_LOCALE_H)\n#  include <locale.h>\n#endif\n\n#if defined (HAVE_LANGINFO_CODESET)\n#  include <langinfo.h>\n#endif\n\n#include <ctype.h>\n\n#include \"rldefs.h\"\n#include \"readline.h\"\n#include \"rlshell.h\"\n#include \"rlprivate.h\"\n#include \"xmalloc.h\"\n\nstatic int utf8locale (char *);\n\n#define RL_DEFAULT_LOCALE \"C\"\nstatic char *_rl_current_locale = 0;\n\n#if !defined (HAVE_SETLOCALE)    \n \nstatic char *legal_lang_values[] =\n{\n \"iso88591\",\n \"iso88592\",\n \"iso88593\",\n \"iso88594\",\n \"iso88595\",\n \"iso88596\",\n \"iso88597\",\n \"iso88598\",\n \"iso88599\",\n \"iso885910\",\n \"koi8r\",\n \"utf8\",\n  0\n};\n\nstatic char *normalize_codeset (char *);\n#endif  \n\nstatic char *find_codeset (char *, size_t *);\n\nstatic char *_rl_get_locale_var (const char *);\n\nstatic char *\n_rl_get_locale_var (const char *v)\n{\n  char *lspec;\n\n  lspec = sh_get_env_value (\"LC_ALL\");\n  if (lspec == 0 || *lspec == 0)\n    lspec = sh_get_env_value (v);\n  if (lspec == 0 || *lspec == 0)\n    lspec = sh_get_env_value (\"LANG\");\n\n  return lspec;\n}\n\nstatic int\nutf8locale (char *lspec)\n{\n  char *cp;\n  size_t len;\n\n#if HAVE_LANGINFO_CODESET\n  cp = nl_langinfo (CODESET);\n  return (STREQ (cp, \"UTF-8\") || STREQ (cp, \"utf8\"));\n#else\n  cp = find_codeset (lspec, &len);\n\n  if (cp == 0 || len < 4 || len > 5)\n    return 0;\n  return ((len == 5) ? strncmp (cp, \"UTF-8\", len) == 0 : strncmp (cp, \"utf8\", 4) == 0);\n#endif\n}\n\n \nchar *\n_rl_init_locale (void)\n{\n  char *ret, *lspec;\n\n   \n  lspec = _rl_get_locale_var (\"LC_CTYPE\");\n   \n#if defined (HAVE_SETLOCALE)\n  if (lspec == 0 || *lspec == 0)\n    lspec = setlocale (LC_CTYPE, (char *)NULL);\n  if (lspec == 0)\n    lspec = \"\";\n  ret = setlocale (LC_CTYPE, lspec);\t \n#else\n  ret = (lspec == 0 || *lspec == 0) ? RL_DEFAULT_LOCALE : lspec;\n#endif\n\n  _rl_utf8locale = (ret && *ret) ? utf8locale (ret) : 0;\n\n  _rl_current_locale = savestring (ret);\n  return ret;\n}\n\n \nstatic int\n_rl_set_localevars (char *localestr, int force)\n{\n#if defined (HAVE_SETLOCALE)\n  if (localestr && *localestr && (localestr[0] != 'C' || localestr[1]) && (STREQ (localestr, \"POSIX\") == 0))\n    {\n      _rl_meta_flag = 1;\n      _rl_convert_meta_chars_to_ascii = 0;\n      _rl_output_meta_chars = 1;\n      return (1);\n    }\n  else if (force)\n    {\n       \n      _rl_meta_flag = 0;\n      _rl_convert_meta_chars_to_ascii = 1;\n      _rl_output_meta_chars = 0;\n      return (0);\n    }\n  else\n    return (0);\n\n#else  \n  char *t;\n  int i;\n\n   \n  if (localestr == 0 || (t = normalize_codeset (localestr)) == 0)\n    return (0);\n  for (i = 0; t && legal_lang_values[i]; i++)\n    if (STREQ (t, legal_lang_values[i]))\n      {\n\t_rl_meta_flag = 1;\n\t_rl_convert_meta_chars_to_ascii = 0;\n\t_rl_output_meta_chars = 1;\n\tbreak;\n      }\n\n  if (force && legal_lang_values[i] == 0)\t \n    {\n       \n      _rl_meta_flag = 0;\n      _rl_convert_meta_chars_to_ascii = 1;\n      _rl_output_meta_chars = 0;\n    }\n\n  _rl_utf8locale = *t ? STREQ (t, \"utf8\") : 0;\n\n  xfree (t);\n  return (legal_lang_values[i] ? 1 : 0);\n#endif  \n}\n\n \nint\n_rl_init_eightbit (void)\n{\n  char *t, *ol;\n\n  ol = _rl_current_locale;\n  t = _rl_init_locale ();\t \n  xfree (ol);\n\n  return (_rl_set_localevars (t, 0));\n}\n\n#if !defined (HAVE_SETLOCALE)\nstatic char *\nnormalize_codeset (char *codeset)\n{\n  size_t namelen, i;\n  int len, all_digits;\n  char *wp, *retval;\n\n  codeset = find_codeset (codeset, &namelen);\n\n  if (codeset == 0)\n    return (codeset);\n\n  all_digits = 1;\n  for (len = 0, i = 0; i < namelen; i++)\n    {\n      if (ISALNUM ((unsigned char)codeset[i]))\n\t{\n\t  len++;\n\t  all_digits &= _rl_digit_p (codeset[i]);\n\t}\n    }\n\n  retval = (char *)malloc ((all_digits ? 3 : 0) + len + 1);\n  if (retval == 0)\n    return ((char *)0);\n\n  wp = retval;\n   \n  if (all_digits)\n    {\n      *wp++ = 'i';\n      *wp++ = 's';\n      *wp++ = 'o';\n    }\n\n  for (i = 0; i < namelen; i++)\n    if (ISALPHA ((unsigned char)codeset[i]))\n      *wp++ = _rl_to_lower (codeset[i]);\n    else if (_rl_digit_p (codeset[i]))\n      *wp++ = codeset[i];\n  *wp = '\\0';\n\n  return retval;\n}\n#endif  \n\n \nstatic char *\nfind_codeset (char *name, size_t *lenp)\n{\n  char *cp, *language, *result;\n\n  cp = language = name;\n  result = (char *)0;\n\n  while (*cp && *cp != '_' && *cp != '@' && *cp != '+' && *cp != ',')\n    cp++;\n\n   \n  if (language == cp) \n    {\n      *lenp = strlen (language);\n      result = language;\n    }\n  else\n    {\n       \n      if (*cp == '_')\n\tdo\n\t  ++cp;\n\twhile (*cp && *cp != '.' && *cp != '@' && *cp != '+' && *cp != ',' && *cp != '_');\n\n       \n      result = cp;\n      if (*cp == '.')\n\tdo\n\t  ++cp;\n\twhile (*cp && *cp != '@');\n\n      if (cp - result > 2)\n\t{\n\t  result++;\n\t  *lenp = cp - result;\n\t}\n      else\n\t{\n\t  *lenp = strlen (language);\n\t  result = language;\n\t}\n    }\n\n  return result;\n}\n\nvoid\n_rl_reset_locale (void)\n{\n  char *ol, *nl;\n\n   \n  ol = _rl_current_locale;\n  nl = _rl_init_locale ();\t\t \n\n  if ((ol == 0 && nl) || (ol && nl && (STREQ (ol, nl) == 0)))\n    (void)_rl_set_localevars (nl, 1);\n\n  xfree (ol);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}