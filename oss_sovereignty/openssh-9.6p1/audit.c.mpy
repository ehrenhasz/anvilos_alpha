{
  "module_name": "audit.c",
  "hash_id": "29996db1d2b6541da47855ee8163c73d52c38e0b00f8c2f443ce162b43bdaca8",
  "original_prompt": "Ingested from openssh-9.6p1/audit.c",
  "human_readable_source": " \n\n#include \"includes.h\"\n\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n\n#ifdef SSH_AUDIT_EVENTS\n\n#include \"audit.h\"\n#include \"log.h\"\n#include \"hostfile.h\"\n#include \"auth.h\"\n\n \nextern Authctxt *the_authctxt;\n\n \nssh_audit_event_t\naudit_classify_auth(const char *method)\n{\n\tif (strcmp(method, \"none\") == 0)\n\t\treturn SSH_AUTH_FAIL_NONE;\n\telse if (strcmp(method, \"password\") == 0)\n\t\treturn SSH_AUTH_FAIL_PASSWD;\n\telse if (strcmp(method, \"publickey\") == 0 ||\n\t    strcmp(method, \"rsa\") == 0)\n\t\treturn SSH_AUTH_FAIL_PUBKEY;\n\telse if (strncmp(method, \"keyboard-interactive\", 20) == 0 ||\n\t    strcmp(method, \"challenge-response\") == 0)\n\t\treturn SSH_AUTH_FAIL_KBDINT;\n\telse if (strcmp(method, \"hostbased\") == 0 ||\n\t    strcmp(method, \"rhosts-rsa\") == 0)\n\t\treturn SSH_AUTH_FAIL_HOSTBASED;\n\telse if (strcmp(method, \"gssapi-with-mic\") == 0)\n\t\treturn SSH_AUTH_FAIL_GSSAPI;\n\telse\n\t\treturn SSH_AUDIT_UNKNOWN;\n}\n\n \nconst char *\naudit_username(void)\n{\n\tstatic const char unknownuser[] = \"(unknown user)\";\n\tstatic const char invaliduser[] = \"(invalid user)\";\n\n\tif (the_authctxt == NULL || the_authctxt->user == NULL)\n\t\treturn (unknownuser);\n\tif (!the_authctxt->valid)\n\t\treturn (invaliduser);\n\treturn (the_authctxt->user);\n}\n\nconst char *\naudit_event_lookup(ssh_audit_event_t ev)\n{\n\tint i;\n\tstatic struct event_lookup_struct {\n\t\tssh_audit_event_t event;\n\t\tconst char *name;\n\t} event_lookup[] = {\n\t\t{SSH_LOGIN_EXCEED_MAXTRIES,\t\"LOGIN_EXCEED_MAXTRIES\"},\n\t\t{SSH_LOGIN_ROOT_DENIED,\t\t\"LOGIN_ROOT_DENIED\"},\n\t\t{SSH_AUTH_SUCCESS,\t\t\"AUTH_SUCCESS\"},\n\t\t{SSH_AUTH_FAIL_NONE,\t\t\"AUTH_FAIL_NONE\"},\n\t\t{SSH_AUTH_FAIL_PASSWD,\t\t\"AUTH_FAIL_PASSWD\"},\n\t\t{SSH_AUTH_FAIL_KBDINT,\t\t\"AUTH_FAIL_KBDINT\"},\n\t\t{SSH_AUTH_FAIL_PUBKEY,\t\t\"AUTH_FAIL_PUBKEY\"},\n\t\t{SSH_AUTH_FAIL_HOSTBASED,\t\"AUTH_FAIL_HOSTBASED\"},\n\t\t{SSH_AUTH_FAIL_GSSAPI,\t\t\"AUTH_FAIL_GSSAPI\"},\n\t\t{SSH_INVALID_USER,\t\t\"INVALID_USER\"},\n\t\t{SSH_NOLOGIN,\t\t\t\"NOLOGIN\"},\n\t\t{SSH_CONNECTION_CLOSE,\t\t\"CONNECTION_CLOSE\"},\n\t\t{SSH_CONNECTION_ABANDON,\t\"CONNECTION_ABANDON\"},\n\t\t{SSH_AUDIT_UNKNOWN,\t\t\"AUDIT_UNKNOWN\"}\n\t};\n\n\tfor (i = 0; event_lookup[i].event != SSH_AUDIT_UNKNOWN; i++)\n\t\tif (event_lookup[i].event == ev)\n\t\t\tbreak;\n\treturn(event_lookup[i].name);\n}\n\n# ifndef CUSTOM_SSH_AUDIT_EVENTS\n \n\n \nvoid\naudit_connection_from(const char *host, int port)\n{\n\tdebug(\"audit connection from %s port %d euid %d\", host, port,\n\t    (int)geteuid());\n}\n\n \nvoid\naudit_event(struct ssh *ssh, ssh_audit_event_t event)\n{\n\tdebug(\"audit event euid %d user %s event %d (%s)\", geteuid(),\n\t    audit_username(), event, audit_event_lookup(event));\n}\n\n \nvoid\naudit_session_open(struct logininfo *li)\n{\n\tconst char *t = li->line ? li->line : \"(no tty)\";\n\n\tdebug(\"audit session open euid %d user %s tty name %s\", geteuid(),\n\t    audit_username(), t);\n}\n\n \nvoid\naudit_session_close(struct logininfo *li)\n{\n\tconst char *t = li->line ? li->line : \"(no tty)\";\n\n\tdebug(\"audit session close euid %d user %s tty name %s\", geteuid(),\n\t    audit_username(), t);\n}\n\n \nvoid\naudit_run_command(const char *command)\n{\n\tdebug(\"audit run command euid %d user %s command '%.200s'\", geteuid(),\n\t    audit_username(), command);\n}\n# endif   \n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}