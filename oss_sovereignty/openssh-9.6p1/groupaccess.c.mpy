{
  "module_name": "groupaccess.c",
  "hash_id": "3d696dd2eb4f46d494e02960b71b53b45f9a0e0c0257468c958b404d3197c666",
  "original_prompt": "Ingested from openssh-9.6p1/groupaccess.c",
  "human_readable_source": " \n \n\n#include \"includes.h\"\n\n#include <sys/types.h>\n\n#include <grp.h>\n#include <unistd.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <string.h>\n#include <limits.h>\n\n#include \"xmalloc.h\"\n#include \"groupaccess.h\"\n#include \"match.h\"\n#include \"log.h\"\n\nstatic int ngroups;\nstatic char **groups_byname;\n\n \nint\nga_init(const char *user, gid_t base)\n{\n\tgid_t *groups_bygid;\n\tint i, j, retry = 0;\n\tstruct group *gr;\n\n\tif (ngroups > 0)\n\t\tga_free();\n\n\tngroups = NGROUPS_MAX;\n#if defined(HAVE_SYSCONF) && defined(_SC_NGROUPS_MAX)\n\tngroups = MAX(NGROUPS_MAX, sysconf(_SC_NGROUPS_MAX));\n#endif\n\n\tgroups_bygid = xcalloc(ngroups, sizeof(*groups_bygid));\n\twhile (getgrouplist(user, base, groups_bygid, &ngroups) == -1) {\n\t\tif (retry++ > 0)\n\t\t\tfatal(\"getgrouplist: groups list too small\");\n\t\tgroups_bygid = xreallocarray(groups_bygid, ngroups,\n\t\t    sizeof(*groups_bygid));\n\t}\n\tgroups_byname = xcalloc(ngroups, sizeof(*groups_byname));\n\n\tfor (i = 0, j = 0; i < ngroups; i++)\n\t\tif ((gr = getgrgid(groups_bygid[i])) != NULL)\n\t\t\tgroups_byname[j++] = xstrdup(gr->gr_name);\n\tfree(groups_bygid);\n\treturn (ngroups = j);\n}\n\n \nint\nga_match(char * const *groups, int n)\n{\n\tint i, j;\n\n\tfor (i = 0; i < ngroups; i++)\n\t\tfor (j = 0; j < n; j++)\n\t\t\tif (match_pattern(groups_byname[i], groups[j]))\n\t\t\t\treturn 1;\n\treturn 0;\n}\n\n \nint\nga_match_pattern_list(const char *group_pattern)\n{\n\tint i, found = 0;\n\n\tfor (i = 0; i < ngroups; i++) {\n\t\tswitch (match_usergroup_pattern_list(groups_byname[i],\n\t\t    group_pattern)) {\n\t\tcase -1:\n\t\t\treturn 0;\t \n\t\tcase 0:\n\t\t\tcontinue;\n\t\tcase 1:\n\t\t\tfound = 1;\n\t\t}\n\t}\n\treturn found;\n}\n\n \nvoid\nga_free(void)\n{\n\tint i;\n\n\tif (ngroups > 0) {\n\t\tfor (i = 0; i < ngroups; i++)\n\t\t\tfree(groups_byname[i]);\n\t\tngroups = 0;\n\t\tfree(groups_byname);\n\t\tgroups_byname = NULL;\n\t}\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}