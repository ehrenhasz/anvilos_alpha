{
  "module_name": "dispatch.c",
  "hash_id": "60e2732e783e7ee422b1e0cb3618962383c3ea95b508b3c2705c5f13c20e4057",
  "original_prompt": "Ingested from openssh-9.6p1/dispatch.c",
  "human_readable_source": " \n \n\n#include \"includes.h\"\n\n#include <sys/types.h>\n\n#include <signal.h>\n#include <stdarg.h>\n\n#include \"ssh2.h\"\n#include \"log.h\"\n#include \"dispatch.h\"\n#include \"packet.h\"\n#include \"ssherr.h\"\n\nint\ndispatch_protocol_error(int type, u_int32_t seq, struct ssh *ssh)\n{\n\tint r;\n\n\tlogit(\"dispatch_protocol_error: type %d seq %u\", type, seq);\n\tif ((r = sshpkt_start(ssh, SSH2_MSG_UNIMPLEMENTED)) != 0 ||\n\t    (r = sshpkt_put_u32(ssh, seq)) != 0 ||\n\t    (r = sshpkt_send(ssh)) != 0 ||\n\t    (r = ssh_packet_write_wait(ssh)) != 0)\n\t\tsshpkt_fatal(ssh, r, \"%s\", __func__);\n\treturn 0;\n}\n\nint\ndispatch_protocol_ignore(int type, u_int32_t seq, struct ssh *ssh)\n{\n\tlogit(\"dispatch_protocol_ignore: type %d seq %u\", type, seq);\n\treturn 0;\n}\n\nvoid\nssh_dispatch_init(struct ssh *ssh, dispatch_fn *dflt)\n{\n\tu_int i;\n\tfor (i = 0; i < DISPATCH_MAX; i++)\n\t\tssh->dispatch[i] = dflt;\n}\n\nvoid\nssh_dispatch_range(struct ssh *ssh, u_int from, u_int to, dispatch_fn *fn)\n{\n\tu_int i;\n\n\tfor (i = from; i <= to; i++) {\n\t\tif (i >= DISPATCH_MAX)\n\t\t\tbreak;\n\t\tssh->dispatch[i] = fn;\n\t}\n}\n\nvoid\nssh_dispatch_set(struct ssh *ssh, int type, dispatch_fn *fn)\n{\n\tssh->dispatch[type] = fn;\n}\n\nint\nssh_dispatch_run(struct ssh *ssh, int mode, volatile sig_atomic_t *done)\n{\n\tint r;\n\tu_char type;\n\tu_int32_t seqnr;\n\n\tfor (;;) {\n\t\tif (mode == DISPATCH_BLOCK) {\n\t\t\tr = ssh_packet_read_seqnr(ssh, &type, &seqnr);\n\t\t\tif (r != 0)\n\t\t\t\treturn r;\n\t\t} else {\n\t\t\tr = ssh_packet_read_poll_seqnr(ssh, &type, &seqnr);\n\t\t\tif (r != 0)\n\t\t\t\treturn r;\n\t\t\tif (type == SSH_MSG_NONE)\n\t\t\t\treturn 0;\n\t\t}\n\t\tif (type > 0 && type < DISPATCH_MAX &&\n\t\t    ssh->dispatch[type] != NULL) {\n\t\t\tif (ssh->dispatch_skip_packets) {\n\t\t\t\tdebug2(\"skipped packet (type %u)\", type);\n\t\t\t\tssh->dispatch_skip_packets--;\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tr = (*ssh->dispatch[type])(type, seqnr, ssh);\n\t\t\tif (r != 0)\n\t\t\t\treturn r;\n\t\t} else {\n\t\t\tr = sshpkt_disconnect(ssh,\n\t\t\t    \"protocol error: rcvd type %d\", type);\n\t\t\tif (r != 0)\n\t\t\t\treturn r;\n\t\t\treturn SSH_ERR_DISCONNECTED;\n\t\t}\n\t\tif (done != NULL && *done)\n\t\t\treturn 0;\n\t}\n}\n\nvoid\nssh_dispatch_run_fatal(struct ssh *ssh, int mode, volatile sig_atomic_t *done)\n{\n\tint r;\n\n\tif ((r = ssh_dispatch_run(ssh, mode, done)) != 0)\n\t\tsshpkt_fatal(ssh, r, \"%s\", __func__);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}