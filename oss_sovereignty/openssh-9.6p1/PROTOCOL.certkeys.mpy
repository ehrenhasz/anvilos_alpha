{
  "module_name": "PROTOCOL.certkeys",
  "hash_id": "d3184cfc1cf787bb5eca3bb063ba28005db815163836f934b069804fd863f18b",
  "original_prompt": "Ingested from openssh-9.6p1/PROTOCOL.certkeys",
  "human_readable_source": "This document describes a simple public-key certificate authentication\nsystem for use by SSH.\n\nBackground\n----------\n\nThe SSH protocol currently supports a simple public key authentication\nmechanism. Unlike other public key implementations, SSH eschews the use\nof X.509 certificates and uses raw keys. This approach has some benefits\nrelating to simplicity of configuration and minimisation of attack\nsurface, but it does not support the important use-cases of centrally\nmanaged, passwordless authentication and centrally certified host keys.\n\nThese protocol extensions build on the simple public key authentication\nsystem already in SSH to allow certificate-based authentication. The\ncertificates used are not traditional X.509 certificates, with numerous\noptions and complex encoding rules, but something rather more minimal: a\nkey, some identity information and usage options that have been signed\nwith some other trusted key.\n\nA sshd server may be configured to allow authentication via certified\nkeys, by extending the existing ~/.ssh/authorized_keys mechanism to\nallow specification of certification authority keys in addition to\nraw user keys. The ssh client will support automatic verification of\nacceptance of certified host keys, by adding a similar ability to\nspecify CA keys in ~/.ssh/known_hosts.\n\nAll certificate types include certification information along with the\npublic key that is used to sign challenges. In OpenSSH, ssh-keygen\nperforms the CA signing operation.\n\nCertified keys are represented using new key types:\n\n    ssh-rsa-cert-v01@openssh.com\n    ssh-dss-cert-v01@openssh.com\n    ecdsa-sha2-nistp256-cert-v01@openssh.com\n    ecdsa-sha2-nistp384-cert-v01@openssh.com\n    ecdsa-sha2-nistp521-cert-v01@openssh.com\n    ssh-ed25519-cert-v01@openssh.com\n\nTwo additional types exist for RSA certificates to force use of\nSHA-2 signatures (SHA-256 and SHA-512 respectively):\n\n    rsa-sha2-256-cert-v01@openssh.com\n    rsa-sha2-512-cert-v01@openssh.com\n\nThese RSA/SHA-2 types should not appear in keys at rest or transmitted\non the wire, but do appear in a SSH_MSG_KEXINIT's host-key algorithms\nfield or in the \"public key algorithm name\" field of a \"publickey\"\nSSH_USERAUTH_REQUEST to indicate that the signature will use the\nspecified algorithm.\n\nProtocol extensions\n-------------------\n\nThe SSH wire protocol includes several extensibility mechanisms.\nThese modifications shall take advantage of namespaced public key\nalgorithm names to add support for certificate authentication without\nbreaking the protocol - implementations that do not support the\nextensions will simply ignore them.\n\nAuthentication using the new key formats described below proceeds\nusing the existing SSH \"publickey\" authentication method described\nin RFC4252 section 7.\n\nNew public key formats\n----------------------\n\nThe certificate key types take a similar high-level format (note: data\ntypes and encoding are as per RFC4251 section 5). The serialised wire\nencoding of these certificates is also used for storing them on disk.\n\n#define SSH_CERT_TYPE_USER    1\n#define SSH_CERT_TYPE_HOST    2\n\nRSA certificate\n\n    string    \"ssh-rsa-cert-v01@openssh.com\"\n    string    nonce\n    mpint     e\n    mpint     n\n    uint64    serial\n    uint32    type\n    string    key id\n    string    valid principals\n    uint64    valid after\n    uint64    valid before\n    string    critical options\n    string    extensions\n    string    reserved\n    string    signature key\n    string    signature\n\nDSA certificate\n\n    string    \"ssh-dss-cert-v01@openssh.com\"\n    string    nonce\n    mpint     p\n    mpint     q\n    mpint     g\n    mpint     y\n    uint64    serial\n    uint32    type\n    string    key id\n    string    valid principals\n    uint64    valid after\n    uint64    valid before\n    string    critical options\n    string    extensions\n    string    reserved\n    string    signature key\n    string    signature\n\nECDSA certificate\n\n    string    \"ecdsa-sha2-nistp256-cert-v01@openssh.com\" |\n              \"ecdsa-sha2-nistp384-cert-v01@openssh.com\" |\n              \"ecdsa-sha2-nistp521-cert-v01@openssh.com\"\n    string    nonce\n    string    curve\n    string    public_key\n    uint64    serial\n    uint32    type\n    string    key id\n    string    valid principals\n    uint64    valid after\n    uint64    valid before\n    string    critical options\n    string    extensions\n    string    reserved\n    string    signature key\n    string    signature\n\nED25519 certificate\n\n    string    \"ssh-ed25519-cert-v01@openssh.com\"\n    string    nonce\n    string    pk\n    uint64    serial\n    uint32    type\n    string    key id\n    string    valid principals\n    uint64    valid after\n    uint64    valid before\n    string    critical options\n    string    extensions\n    string    reserved\n    string    signature key\n    string    signature\n\nThe nonce field is a CA-provided random bitstring of arbitrary length\n(but typically 16 or 32 bytes) included to make attacks that depend on\ninducing collisions in the signature hash infeasible.\n\ne and n are the RSA exponent and public modulus respectively.\n\np, q, g, y are the DSA parameters as described in FIPS-186-2.\n\ncurve and public key are respectively the ECDSA \"[identifier]\" and \"Q\"\ndefined in section 3.1 of RFC5656.\n\npk is the encoded Ed25519 public key as defined by RFC8032.\n\nserial is an optional certificate serial number set by the CA to\nprovide an abbreviated way to refer to certificates from that CA.\nIf a CA does not wish to number its certificates, it must set this\nfield to zero.\n\ntype specifies whether this certificate is for identification of a user\nor a host using a SSH_CERT_TYPE_... value.\n\nkey id is a free-form text field that is filled in by the CA at the time\nof signing; the intention is that the contents of this field are used to\nidentify the identity principal in log messages.\n\n\"valid principals\" is a string containing zero or more principals as\nstrings packed inside it. These principals list the names for which this\ncertificate is valid; hostnames for SSH_CERT_TYPE_HOST certificates and\nusernames for SSH_CERT_TYPE_USER certificates. As a special case, a\nzero-length \"valid principals\" field means the certificate is valid for\nany principal of the specified type.\n\n\"valid after\" and \"valid before\" specify a validity period for the\ncertificate. Each represents a time in seconds since 1970-01-01\n00:00:00. A certificate is considered valid if:\n\n    valid after <= current time < valid before\n\ncritical options is a set of zero or more key options encoded as\nbelow. All such options are \"critical\" in the sense that an implementation\nmust refuse to authorise a key that has an unrecognised option.\n\nextensions is a set of zero or more optional extensions. These extensions\nare not critical, and an implementation that encounters one that it does\nnot recognise may safely ignore it.\n\nGenerally, critical options are used to control features that restrict\naccess where extensions are used to enable features that grant access.\nThis ensures that certificates containing unknown restrictions do not\ninadvertently grant access while allowing new protocol features to be\nenabled via extensions without breaking certificates' backwards\ncompatibility.\n\nThe reserved field is currently unused and is ignored in this version of\nthe protocol.\n\nThe signature key field contains the CA key used to sign the\ncertificate. The valid key types for CA keys are ssh-rsa,\nssh-dss, ssh-ed25519 and the ECDSA types ecdsa-sha2-nistp256,\necdsa-sha2-nistp384, ecdsa-sha2-nistp521. \"Chained\" certificates, where\nthe signature key type is a certificate type itself are NOT supported.\nNote that it is possible for a RSA certificate key to be signed by a\nEd25519 or ECDSA CA key and vice-versa.\n\nsignature is computed over all preceding fields from the initial string\nup to, and including the signature key. Signatures are computed and\nencoded according to the rules defined for the CA's public key algorithm\n(RFC4253 section 6.6 for ssh-rsa and ssh-dss, RFC5656 for the ECDSA\ntypes, and RFC8032 for Ed25519).\n\nCritical options\n----------------\n\nThe critical options section of the certificate specifies zero or more\noptions on the certificate's validity. The format of this field\nis a sequence of zero or more tuples:\n\n    string       name\n    string       data\n\nOptions must be lexically ordered by \"name\" if they appear in the\nsequence. Each named option may only appear once in a certificate.\n\nThe name field identifies the option and the data field encodes\noption-specific information (see below). All options are\n\"critical\"; if an implementation does not recognise a option,\nthen the validating party should refuse to accept the certificate.\n\nCustom options should append the originating author or organisation's\ndomain name to the option name, e.g. \"my-option@example.com\".\n\nNo critical options are defined for host certificates at present. The\nsupported user certificate options and the contents and structure of\ntheir data fields are:\n\nName                    Format        Description\n-----------------------------------------------------------------------------\nforce-command           string        Specifies a command that is executed\n                                      (replacing any the user specified on the\n                                      ssh command-line) whenever this key is\n                                      used for authentication.\n\nsource-address          string        Comma-separated list of source addresses\n                                      from which this certificate is accepted\n                                      for authentication. Addresses are\n                                      specified in CIDR format (nn.nn.nn.nn/nn\n                                      or hhhh::hhhh/nn).\n                                      If this option is not present, then\n                                      certificates may be presented from any\n                                      source address.\n\nverify-required         empty         Flag indicating that signatures made\n                                      with this certificate must assert FIDO\n                                      user verification (e.g. PIN or\n                                      biometric). This option only makes sense\n                                      for the U2F/FIDO security key types that\n                                      support this feature in their signature\n                                      formats.\n\nExtensions\n----------\n\nThe extensions section of the certificate specifies zero or more\nnon-critical certificate extensions. The encoding and ordering of\nextensions in this field is identical to that of the critical options,\nas is the requirement that each name appear only once.\n\nIf an implementation does not recognise an extension, then it should\nignore it.\n\nCustom options should append the originating author or organisation's\ndomain name to the option name, e.g. \"my-option@example.com\".\n\nNo extensions are defined for host certificates at present. The\nsupported user certificate extensions and the contents and structure of\ntheir data fields are:\n\nName                    Format        Description\n-----------------------------------------------------------------------------\nno-touch-required       empty         Flag indicating that signatures made\n                                      with this certificate need not assert\n                                      FIDO user presence. This option only\n                                      makes sense for the U2F/FIDO security\n                                      key types that support this feature in\n                                      their signature formats.\n\npermit-X11-forwarding   empty         Flag indicating that X11 forwarding\n                                      should be permitted. X11 forwarding will\n                                      be refused if this option is absent.\n\npermit-agent-forwarding empty         Flag indicating that agent forwarding\n                                      should be allowed. Agent forwarding\n                                      must not be permitted unless this\n                                      option is present.\n\npermit-port-forwarding  empty         Flag indicating that port-forwarding\n                                      should be allowed. If this option is\n                                      not present, then no port forwarding will\n                                      be allowed.\n\npermit-pty              empty         Flag indicating that PTY allocation\n                                      should be permitted. In the absence of\n                                      this option PTY allocation will be\n                                      disabled.\n\npermit-user-rc          empty         Flag indicating that execution of\n                                      ~/.ssh/rc should be permitted. Execution\n                                      of this script will not be permitted if\n                                      this option is not present.\n\n$OpenBSD: PROTOCOL.certkeys,v 1.19 2021/06/05 13:47:00 naddy Exp $\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}