{
  "module_name": "sshbuf-getput-crypto.c",
  "hash_id": "90a3689357b8eee671b32023d14611b2c1522b5fe1127e37f7625addedb8c42c",
  "original_prompt": "Ingested from openssh-9.6p1/sshbuf-getput-crypto.c",
  "human_readable_source": " \n \n\n#define SSHBUF_INTERNAL\n#include \"includes.h\"\n\n#include <sys/types.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <string.h>\n\n#ifdef WITH_OPENSSL\n#include <openssl/bn.h>\n#ifdef OPENSSL_HAS_ECC\n# include <openssl/ec.h>\n#endif  \n\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n\nint\nsshbuf_get_bignum2(struct sshbuf *buf, BIGNUM **valp)\n{\n\tBIGNUM *v;\n\tconst u_char *d;\n\tsize_t len;\n\tint r;\n\n\tif (valp != NULL)\n\t\t*valp = NULL;\n\tif ((r = sshbuf_get_bignum2_bytes_direct(buf, &d, &len)) != 0)\n\t\treturn r;\n\tif (valp != NULL) {\n\t\tif ((v = BN_new()) == NULL ||\n\t\t    BN_bin2bn(d, len, v) == NULL) {\n\t\t\tBN_clear_free(v);\n\t\t\treturn SSH_ERR_ALLOC_FAIL;\n\t\t}\n\t\t*valp = v;\n\t}\n\treturn 0;\n}\n\n#ifdef OPENSSL_HAS_ECC\nstatic int\nget_ec(const u_char *d, size_t len, EC_POINT *v, const EC_GROUP *g)\n{\n\t \n\tif (len == 0 || len > SSHBUF_MAX_ECPOINT)\n\t\treturn SSH_ERR_ECPOINT_TOO_LARGE;\n\t \n\tif (*d != POINT_CONVERSION_UNCOMPRESSED)\n\t\treturn SSH_ERR_INVALID_FORMAT;\n\tif (v != NULL && EC_POINT_oct2point(g, v, d, len, NULL) != 1)\n\t\treturn SSH_ERR_INVALID_FORMAT;  \n\treturn 0;\n}\n\nint\nsshbuf_get_ec(struct sshbuf *buf, EC_POINT *v, const EC_GROUP *g)\n{\n\tconst u_char *d;\n\tsize_t len;\n\tint r;\n\n\tif ((r = sshbuf_peek_string_direct(buf, &d, &len)) < 0)\n\t\treturn r;\n\tif ((r = get_ec(d, len, v, g)) != 0)\n\t\treturn r;\n\t \n\tif (sshbuf_get_string_direct(buf, NULL, NULL) != 0) {\n\t\t \n\t\tSSHBUF_DBG((\"SSH_ERR_INTERNAL_ERROR\"));\n\t\tSSHBUF_ABORT();\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\t}\n\treturn 0;\n}\n\nint\nsshbuf_get_eckey(struct sshbuf *buf, EC_KEY *v)\n{\n\tEC_POINT *pt = EC_POINT_new(EC_KEY_get0_group(v));\n\tint r;\n\tconst u_char *d;\n\tsize_t len;\n\n\tif (pt == NULL) {\n\t\tSSHBUF_DBG((\"SSH_ERR_ALLOC_FAIL\"));\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\t}\n\tif ((r = sshbuf_peek_string_direct(buf, &d, &len)) < 0) {\n\t\tEC_POINT_free(pt);\n\t\treturn r;\n\t}\n\tif ((r = get_ec(d, len, pt, EC_KEY_get0_group(v))) != 0) {\n\t\tEC_POINT_free(pt);\n\t\treturn r;\n\t}\n\tif (EC_KEY_set_public_key(v, pt) != 1) {\n\t\tEC_POINT_free(pt);\n\t\treturn SSH_ERR_ALLOC_FAIL;  \n\t}\n\tEC_POINT_free(pt);\n\t \n\tif (sshbuf_get_string_direct(buf, NULL, NULL) != 0) {\n\t\t \n\t\tSSHBUF_DBG((\"SSH_ERR_INTERNAL_ERROR\"));\n\t\tSSHBUF_ABORT();\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\t}\n\treturn 0;\t\n}\n#endif  \n\nint\nsshbuf_put_bignum2(struct sshbuf *buf, const BIGNUM *v)\n{\n\tu_char d[SSHBUF_MAX_BIGNUM + 1];\n\tint len = BN_num_bytes(v), prepend = 0, r;\n\n\tif (len < 0 || len > SSHBUF_MAX_BIGNUM)\n\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\t*d = '\\0';\n\tif (BN_bn2bin(v, d + 1) != len)\n\t\treturn SSH_ERR_INTERNAL_ERROR;  \n\t \n\tif (len > 0 && (d[1] & 0x80) != 0)\n\t\tprepend = 1;\n\tif ((r = sshbuf_put_string(buf, d + 1 - prepend, len + prepend)) < 0) {\n\t\texplicit_bzero(d, sizeof(d));\n\t\treturn r;\n\t}\n\texplicit_bzero(d, sizeof(d));\n\treturn 0;\n}\n\n#ifdef OPENSSL_HAS_ECC\nint\nsshbuf_put_ec(struct sshbuf *buf, const EC_POINT *v, const EC_GROUP *g)\n{\n\tu_char d[SSHBUF_MAX_ECPOINT];\n\tsize_t len;\n\tint ret;\n\n\tif ((len = EC_POINT_point2oct(g, v, POINT_CONVERSION_UNCOMPRESSED,\n\t    NULL, 0, NULL)) > SSHBUF_MAX_ECPOINT) {\n\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\t}\n\tif (EC_POINT_point2oct(g, v, POINT_CONVERSION_UNCOMPRESSED,\n\t    d, len, NULL) != len) {\n\t\treturn SSH_ERR_INTERNAL_ERROR;  \n\t}\n\tret = sshbuf_put_string(buf, d, len);\n\texplicit_bzero(d, len);\n\treturn ret;\n}\n\nint\nsshbuf_put_eckey(struct sshbuf *buf, const EC_KEY *v)\n{\n\treturn sshbuf_put_ec(buf, EC_KEY_get0_public_key(v),\n\t    EC_KEY_get0_group(v));\n}\n#endif  \n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}