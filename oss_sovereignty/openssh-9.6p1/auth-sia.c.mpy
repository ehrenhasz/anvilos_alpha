{
  "module_name": "auth-sia.c",
  "hash_id": "0301bd15e2d445961d0c6affb2f00c80f58efa796e4cf478cf8fe2f448894b74",
  "original_prompt": "Ingested from openssh-9.6p1/auth-sia.c",
  "human_readable_source": " \n\n#include \"includes.h\"\n\n#ifdef HAVE_OSF_SIA\n#include <sia.h>\n#include <siad.h>\n#include <pwd.h>\n#include <signal.h>\n#include <setjmp.h>\n#include <sys/resource.h>\n#include <unistd.h>\n#include <stdarg.h>\n#include <string.h>\n\n#include \"ssh.h\"\n#include \"ssh_api.h\"\n#include \"hostfile.h\"\n#include \"auth.h\"\n#include \"auth-sia.h\"\n#include \"log.h\"\n#include \"servconf.h\"\n#include \"canohost.h\"\n#include \"uidswap.h\"\n\nextern ServerOptions options;\nextern int saved_argc;\nextern char **saved_argv;\n\nint\nsys_auth_passwd(struct ssh *ssh, const char *pass)\n{\n\tint ret;\n\tSIAENTITY *ent = NULL;\n\tconst char *host;\n\tAuthctxt *authctxt = ssh->authctxt;\n\n\thost = get_canonical_hostname(options.use_dns);\n\n\tif (!authctxt->user || pass == NULL || pass[0] == '\\0')\n\t\treturn (0);\n\n\tif (sia_ses_init(&ent, saved_argc, saved_argv, host, authctxt->user,\n\t    NULL, 0, NULL) != SIASUCCESS)\n\t\treturn (0);\n\n\tif ((ret = sia_ses_authent(NULL, pass, ent)) != SIASUCCESS) {\n\t\terror(\"Couldn't authenticate %s from %s\",\n\t\t    authctxt->user, host);\n\t\tif (ret & SIASTOP)\n\t\t\tsia_ses_release(&ent);\n\n\t\treturn (0);\n\t}\n\n\tsia_ses_release(&ent);\n\n\treturn (1);\n}\n\nvoid\nsession_setup_sia(struct passwd *pw, char *tty)\n{\n\tSIAENTITY *ent = NULL;\n\tconst char *host;\n\n\thost = get_canonical_hostname(options.use_dns);\n\n\tif (sia_ses_init(&ent, saved_argc, saved_argv, host, pw->pw_name,\n\t    tty, 0, NULL) != SIASUCCESS)\n\t\tfatal(\"sia_ses_init failed\");\n\n\tif (sia_make_entity_pwd(pw, ent) != SIASUCCESS) {\n\t\tsia_ses_release(&ent);\n\t\tfatal(\"sia_make_entity_pwd failed\");\n\t}\n\n\tent->authtype = SIA_A_NONE;\n\tif (sia_ses_estab(sia_collect_trm, ent) != SIASUCCESS)\n\t\tfatal(\"Couldn't establish session for %s from %s\",\n\t\t    pw->pw_name, host);\n\n\tif (sia_ses_launch(sia_collect_trm, ent) != SIASUCCESS)\n\t\tfatal(\"Couldn't launch session for %s from %s\",\n\t\t    pw->pw_name, host);\n\n\tsia_ses_release(&ent);\n\n\tsetuid(0);\n\tpermanently_set_uid(pw);\n}\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}