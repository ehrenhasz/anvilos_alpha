{
  "module_name": "vis.c",
  "hash_id": "2809700ae735803eb3a139d3b206daf9a9c8b78b49313ebf15a519fc431e28d8",
  "original_prompt": "Ingested from openssh-9.6p1/openbsd-compat/vis.c",
  "human_readable_source": " \n \n\n \n\n#include \"includes.h\"\n#if !defined(HAVE_STRNVIS) || defined(BROKEN_STRNVIS)\n\n#include <sys/types.h>\n#include <errno.h>\n#include <ctype.h>\n#include <limits.h>\n#include <string.h>\n#include <stdlib.h>\n\n#include \"vis.h\"\n\n#define\tisoctal(c)\t(((u_char)(c)) >= '0' && ((u_char)(c)) <= '7')\n#define\tisvisible(c,flag)\t\t\t\t\t\t\\\n\t(((c) == '\\\\' || (flag & VIS_ALL) == 0) &&\t\t\t\\\n\t(((u_int)(c) <= UCHAR_MAX && isascii((u_char)(c)) &&\t\t\\\n\t(((c) != '*' && (c) != '?' && (c) != '[' && (c) != '#') ||\t\\\n\t\t(flag & VIS_GLOB) == 0) && isgraph((u_char)(c))) ||\t\\\n\t((flag & VIS_SP) == 0 && (c) == ' ') ||\t\t\t\t\\\n\t((flag & VIS_TAB) == 0 && (c) == '\\t') ||\t\t\t\\\n\t((flag & VIS_NL) == 0 && (c) == '\\n') ||\t\t\t\\\n\t((flag & VIS_SAFE) && ((c) == '\\b' ||\t\t\t\t\\\n\t\t(c) == '\\007' || (c) == '\\r' ||\t\t\t\t\\\n\t\tisgraph((u_char)(c))))))\n\n \nchar *\nvis(char *dst, int c, int flag, int nextc)\n{\n\tif (isvisible(c, flag)) {\n\t\tif ((c == '\"' && (flag & VIS_DQ) != 0) ||\n\t\t    (c == '\\\\' && (flag & VIS_NOSLASH) == 0))\n\t\t\t*dst++ = '\\\\';\n\t\t*dst++ = c;\n\t\t*dst = '\\0';\n\t\treturn (dst);\n\t}\n\n\tif (flag & VIS_CSTYLE) {\n\t\tswitch(c) {\n\t\tcase '\\n':\n\t\t\t*dst++ = '\\\\';\n\t\t\t*dst++ = 'n';\n\t\t\tgoto done;\n\t\tcase '\\r':\n\t\t\t*dst++ = '\\\\';\n\t\t\t*dst++ = 'r';\n\t\t\tgoto done;\n\t\tcase '\\b':\n\t\t\t*dst++ = '\\\\';\n\t\t\t*dst++ = 'b';\n\t\t\tgoto done;\n\t\tcase '\\a':\n\t\t\t*dst++ = '\\\\';\n\t\t\t*dst++ = 'a';\n\t\t\tgoto done;\n\t\tcase '\\v':\n\t\t\t*dst++ = '\\\\';\n\t\t\t*dst++ = 'v';\n\t\t\tgoto done;\n\t\tcase '\\t':\n\t\t\t*dst++ = '\\\\';\n\t\t\t*dst++ = 't';\n\t\t\tgoto done;\n\t\tcase '\\f':\n\t\t\t*dst++ = '\\\\';\n\t\t\t*dst++ = 'f';\n\t\t\tgoto done;\n\t\tcase ' ':\n\t\t\t*dst++ = '\\\\';\n\t\t\t*dst++ = 's';\n\t\t\tgoto done;\n\t\tcase '\\0':\n\t\t\t*dst++ = '\\\\';\n\t\t\t*dst++ = '0';\n\t\t\tif (isoctal(nextc)) {\n\t\t\t\t*dst++ = '0';\n\t\t\t\t*dst++ = '0';\n\t\t\t}\n\t\t\tgoto done;\n\t\t}\n\t}\n\tif (((c & 0177) == ' ') || (flag & VIS_OCTAL) ||\n\t    ((flag & VIS_GLOB) && (c == '*' || c == '?' || c == '[' || c == '#'))) {\n\t\t*dst++ = '\\\\';\n\t\t*dst++ = ((u_char)c >> 6 & 07) + '0';\n\t\t*dst++ = ((u_char)c >> 3 & 07) + '0';\n\t\t*dst++ = ((u_char)c & 07) + '0';\n\t\tgoto done;\n\t}\n\tif ((flag & VIS_NOSLASH) == 0)\n\t\t*dst++ = '\\\\';\n\tif (c & 0200) {\n\t\tc &= 0177;\n\t\t*dst++ = 'M';\n\t}\n\tif (iscntrl((u_char)c)) {\n\t\t*dst++ = '^';\n\t\tif (c == 0177)\n\t\t\t*dst++ = '?';\n\t\telse\n\t\t\t*dst++ = c + '@';\n\t} else {\n\t\t*dst++ = '-';\n\t\t*dst++ = c;\n\t}\ndone:\n\t*dst = '\\0';\n\treturn (dst);\n}\nDEF_WEAK(vis);\n\n \nint\nstrvis(char *dst, const char *src, int flag)\n{\n\tchar c;\n\tchar *start;\n\n\tfor (start = dst; (c = *src);)\n\t\tdst = vis(dst, c, flag, *++src);\n\t*dst = '\\0';\n\treturn (dst - start);\n}\nDEF_WEAK(strvis);\n\nint\nstrnvis(char *dst, const char *src, size_t siz, int flag)\n{\n\tchar *start, *end;\n\tchar tbuf[5];\n\tint c, i;\n\n\ti = 0;\n\tfor (start = dst, end = start + siz - 1; (c = *src) && dst < end; ) {\n\t\tif (isvisible(c, flag)) {\n\t\t\tif ((c == '\"' && (flag & VIS_DQ) != 0) ||\n\t\t\t    (c == '\\\\' && (flag & VIS_NOSLASH) == 0)) {\n\t\t\t\t \n\t\t\t\tif (dst + 1 >= end) {\n\t\t\t\t\ti = 2;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\t*dst++ = '\\\\';\n\t\t\t}\n\t\t\ti = 1;\n\t\t\t*dst++ = c;\n\t\t\tsrc++;\n\t\t} else {\n\t\t\ti = vis(tbuf, c, flag, *++src) - tbuf;\n\t\t\tif (dst + i <= end) {\n\t\t\t\tmemcpy(dst, tbuf, i);\n\t\t\t\tdst += i;\n\t\t\t} else {\n\t\t\t\tsrc--;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\tif (siz > 0)\n\t\t*dst = '\\0';\n\tif (dst + i > end) {\n\t\t \n\t\twhile ((c = *src))\n\t\t\tdst += vis(tbuf, c, flag, *++src) - tbuf;\n\t}\n\treturn (dst - start);\n}\n\nint\nstravis(char **outp, const char *src, int flag)\n{\n\tchar *buf;\n\tint len, serrno;\n\n\tbuf = reallocarray(NULL, 4, strlen(src) + 1);\n\tif (buf == NULL)\n\t\treturn -1;\n\tlen = strvis(buf, src, flag);\n\tserrno = errno;\n\t*outp = realloc(buf, len + 1);\n\tif (*outp == NULL) {\n\t\t*outp = buf;\n\t\terrno = serrno;\n\t}\n\treturn (len);\n}\n\nint\nstrvisx(char *dst, const char *src, size_t len, int flag)\n{\n\tchar c;\n\tchar *start;\n\n\tfor (start = dst; len > 1; len--) {\n\t\tc = *src;\n\t\tdst = vis(dst, c, flag, *++src);\n\t}\n\tif (len)\n\t\tdst = vis(dst, *src, flag, '\\0');\n\t*dst = '\\0';\n\treturn (dst - start);\n}\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}