{
  "module_name": "setenv.c",
  "hash_id": "7d9c03a1ce749fc0088197739d55332d5ec325ff093f3da9d459d403ce61c380",
  "original_prompt": "Ingested from openssh-9.6p1/openbsd-compat/setenv.c",
  "human_readable_source": " \n \n\n \n\n#include \"includes.h\"\n\n#if !defined(HAVE_SETENV) || !defined(HAVE_UNSETENV)\n\n#include <errno.h>\n#include <stdlib.h>\n#include <string.h>\n\nextern char **environ;\n#ifndef HAVE_SETENV\nstatic char **lastenv;\t\t\t\t \n#endif\n\n \n \nstatic char *\n__findenv(const char *name, int len, int *offset)\n{\n\textern char **environ;\n\tint i;\n\tconst char *np;\n\tchar **p, *cp;\n\n\tif (name == NULL || environ == NULL)\n\t\treturn (NULL);\n\tfor (p = environ + *offset; (cp = *p) != NULL; ++p) {\n\t\tfor (np = name, i = len; i && *cp; i--)\n\t\t\tif (*cp++ != *np++)\n\t\t\t\tbreak;\n\t\tif (i == 0 && *cp++ == '=') {\n\t\t\t*offset = p - environ;\n\t\t\treturn (cp);\n\t\t}\n\t}\n\treturn (NULL);\n}\n\n#if 0  \n \nint\nputenv(char *str)\n{\n\tchar **P, *cp;\n\tsize_t cnt;\n\tint offset = 0;\n\n\tfor (cp = str; *cp && *cp != '='; ++cp)\n\t\t;\n\tif (*cp != '=') {\n\t\terrno = EINVAL;\n\t\treturn (-1);\t\t\t \n\t}\n\n\tif (__findenv(str, (int)(cp - str), &offset) != NULL) {\n\t\tenviron[offset++] = str;\n\t\t \n\t\twhile (__findenv(str, (int)(cp - str), &offset)) {\n\t\t\tfor (P = &environ[offset];; ++P)\n\t\t\t\tif (!(*P = *(P + 1)))\n\t\t\t\t\tbreak;\n\t\t}\n\t\treturn (0);\n\t}\n\n\t \n\tfor (P = environ; *P != NULL; P++)\n\t\t;\n\tcnt = P - environ;\n\tP = (char **)realloc(lastenv, sizeof(char *) * (cnt + 2));\n\tif (!P)\n\t\treturn (-1);\n\tif (lastenv != environ)\n\t\tmemcpy(P, environ, cnt * sizeof(char *));\n\tlastenv = environ = P;\n\tenviron[cnt] = str;\n\tenviron[cnt + 1] = NULL;\n\treturn (0);\n}\n\n#endif\n\n#ifndef HAVE_SETENV\n \nint\nsetenv(const char *name, const char *value, int rewrite)\n{\n\tchar *C, **P;\n\tconst char *np;\n\tint l_value, offset = 0;\n\n\tfor (np = name; *np && *np != '='; ++np)\n\t\t;\n#ifdef notyet\n\tif (*np) {\n\t\terrno = EINVAL;\n\t\treturn (-1);\t\t\t \n\t}\n#endif\n\n\tl_value = strlen(value);\n\tif ((C = __findenv(name, (int)(np - name), &offset)) != NULL) {\n\t\tint tmpoff = offset + 1;\n\t\tif (!rewrite)\n\t\t\treturn (0);\n#if 0  \n\t\tif (strlen(C) >= l_value) {\t \n\t\t\twhile ((*C++ = *value++))\n\t\t\t\t;\n\t\t\treturn (0);\n\t\t}\n#endif\n\t\t \n\t\twhile (__findenv(name, (int)(np - name), &tmpoff)) {\n\t\t\tfor (P = &environ[tmpoff];; ++P)\n\t\t\t\tif (!(*P = *(P + 1)))\n\t\t\t\t\tbreak;\n\t\t}\n\t} else {\t\t\t\t\t \n\t\tsize_t cnt;\n\n\t\tfor (P = environ; *P != NULL; P++)\n\t\t\t;\n\t\tcnt = P - environ;\n\t\tP = (char **)realloc(lastenv, sizeof(char *) * (cnt + 2));\n\t\tif (!P)\n\t\t\treturn (-1);\n\t\tif (lastenv != environ)\n\t\t\tmemcpy(P, environ, cnt * sizeof(char *));\n\t\tlastenv = environ = P;\n\t\toffset = cnt;\n\t\tenviron[cnt + 1] = NULL;\n\t}\n\tif (!(environ[offset] =\t\t\t \n\t    malloc((size_t)((int)(np - name) + l_value + 2))))\n\t\treturn (-1);\n\tfor (C = environ[offset]; (*C = *name++) && *C != '='; ++C)\n\t\t;\n\tfor (*C++ = '='; (*C++ = *value++); )\n\t\t;\n\treturn (0);\n}\n\n#endif  \n\n#ifndef HAVE_UNSETENV\n \nint\nunsetenv(const char *name)\n{\n\tchar **P;\n\tconst char *np;\n\tint offset = 0;\n\n\tif (!name || !*name) {\n\t\terrno = EINVAL;\n\t\treturn (-1);\n\t}\n\tfor (np = name; *np && *np != '='; ++np)\n\t\t;\n\tif (*np) {\n\t\terrno = EINVAL;\n\t\treturn (-1);\t\t\t \n\t}\n\n\t \n\twhile (__findenv(name, (int)(np - name), &offset)) {\n\t\tfor (P = &environ[offset];; ++P)\n\t\t\tif (!(*P = *(P + 1)))\n\t\t\t\tbreak;\n\t}\n\treturn (0);\n}\n#endif  \n\n#endif  \n\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}