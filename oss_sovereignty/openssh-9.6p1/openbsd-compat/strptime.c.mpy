{
  "module_name": "strptime.c",
  "hash_id": "1678442b9cd4a31c42c8b6087a30c3d737dd8a1d346fac8305eb828563e465f4",
  "original_prompt": "Ingested from openssh-9.6p1/openbsd-compat/strptime.c",
  "human_readable_source": " \n \n\n \n\n \n\n#include \"includes.h\"\n\n#ifndef HAVE_STRPTIME\n\n#define TM_YEAR_BASE 1900\t \n\n#include <ctype.h>\n#include <locale.h>\n#include <string.h>\n#include <time.h>\n\n \n\n \n#define _ALT_E\t\t\t0x01\n#define _ALT_O\t\t\t0x02\n#define\t_LEGAL_ALT(x)\t\t{ if (alt_format & ~(x)) return (0); }\n\n\nstatic\tint _conv_num(const unsigned char **, int *, int, int);\nstatic\tchar *_strptime(const char *, const char *, struct tm *, int);\n\n\nchar *\nstrptime(const char *buf, const char *fmt, struct tm *tm)\n{\n\treturn(_strptime(buf, fmt, tm, 1));\n}\n\nstatic char *\n_strptime(const char *buf, const char *fmt, struct tm *tm, int initialize)\n{\n\tunsigned char c;\n\tconst unsigned char *bp;\n\tsize_t len;\n\tint alt_format, i;\n\tstatic int century, relyear;\n\n\tif (initialize) {\n\t\tcentury = TM_YEAR_BASE;\n\t\trelyear = -1;\n\t}\n\n\tbp = (unsigned char *)buf;\n\twhile ((c = *fmt) != '\\0') {\n\t\t \n\t\talt_format = 0;\n\n\t\t \n\t\tif (isspace(c)) {\n\t\t\twhile (isspace(*bp))\n\t\t\t\tbp++;\n\n\t\t\tfmt++;\n\t\t\tcontinue;\n\t\t}\n\t\t\t\t\n\t\tif ((c = *fmt++) != '%')\n\t\t\tgoto literal;\n\n\nagain:\t\tswitch (c = *fmt++) {\n\t\tcase '%':\t \nliteral:\n\t\tif (c != *bp++)\n\t\t\treturn (NULL);\n\n\t\tbreak;\n\n\t\t \n\t\tcase 'E':\t \n\t\t\t_LEGAL_ALT(0);\n\t\t\talt_format |= _ALT_E;\n\t\t\tgoto again;\n\n\t\tcase 'O':\t \n\t\t\t_LEGAL_ALT(0);\n\t\t\talt_format |= _ALT_O;\n\t\t\tgoto again;\n\t\t\t\n\t\t \n#if 0\n\t\tcase 'c':\t \n\t\t\t_LEGAL_ALT(_ALT_E);\n\t\t\tif (!(bp = _strptime(bp, _ctloc(d_t_fmt), tm, 0)))\n\t\t\t\treturn (NULL);\n\t\t\tbreak;\n#endif\n\t\tcase 'D':\t \n\t\t\t_LEGAL_ALT(0);\n\t\t\tif (!(bp = _strptime(bp, \"%m/%d/%y\", tm, 0)))\n\t\t\t\treturn (NULL);\n\t\t\tbreak;\n\t\n\t\tcase 'R':\t \n\t\t\t_LEGAL_ALT(0);\n\t\t\tif (!(bp = _strptime(bp, \"%H:%M\", tm, 0)))\n\t\t\t\treturn (NULL);\n\t\t\tbreak;\n\n\t\tcase 'r':\t \n\t\t\t_LEGAL_ALT(0);\n\t\t\tif (!(bp = _strptime(bp, \"%I:%M:%S %p\", tm, 0)))\n\t\t\t\treturn (NULL);\n\t\t\tbreak;\n\n\t\tcase 'T':\t \n\t\t\t_LEGAL_ALT(0);\n\t\t\tif (!(bp = _strptime(bp, \"%H:%M:%S\", tm, 0)))\n\t\t\t\treturn (NULL);\n\t\t\tbreak;\n#if 0\n\t\tcase 'X':\t \n\t\t\t_LEGAL_ALT(_ALT_E);\n\t\t\tif (!(bp = _strptime(bp, _ctloc(t_fmt), tm, 0)))\n\t\t\t\treturn (NULL);\n\t\t\tbreak;\n\n\t\tcase 'x':\t \n\t\t\t_LEGAL_ALT(_ALT_E);\n\t\t\tif (!(bp = _strptime(bp, _ctloc(d_fmt), tm, 0)))\n\t\t\t\treturn (NULL);\n\t\t\tbreak;\n#endif\n\t\t \n#if 0\n\t\tcase 'A':\t \n\t\tcase 'a':\n\t\t\t_LEGAL_ALT(0);\n\t\t\tfor (i = 0; i < 7; i++) {\n\t\t\t\t \n\t\t\t\tlen = strlen(_ctloc(day[i]));\n\t\t\t\tif (strncasecmp(_ctloc(day[i]), bp, len) == 0)\n\t\t\t\t\tbreak;\n\n\t\t\t\t \n\t\t\t\tlen = strlen(_ctloc(abday[i]));\n\t\t\t\tif (strncasecmp(_ctloc(abday[i]), bp, len) == 0)\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\t \n\t\t\tif (i == 7)\n\t\t\t\treturn (NULL);\n\n\t\t\ttm->tm_wday = i;\n\t\t\tbp += len;\n\t\t\tbreak;\n\n\t\tcase 'B':\t \n\t\tcase 'b':\n\t\tcase 'h':\n\t\t\t_LEGAL_ALT(0);\n\t\t\tfor (i = 0; i < 12; i++) {\n\t\t\t\t \n\t\t\t\tlen = strlen(_ctloc(mon[i]));\n\t\t\t\tif (strncasecmp(_ctloc(mon[i]), bp, len) == 0)\n\t\t\t\t\tbreak;\n\n\t\t\t\t \n\t\t\t\tlen = strlen(_ctloc(abmon[i]));\n\t\t\t\tif (strncasecmp(_ctloc(abmon[i]), bp, len) == 0)\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\t \n\t\t\tif (i == 12)\n\t\t\t\treturn (NULL);\n\n\t\t\ttm->tm_mon = i;\n\t\t\tbp += len;\n\t\t\tbreak;\n#endif\n\n\t\tcase 'C':\t \n\t\t\t_LEGAL_ALT(_ALT_E);\n\t\t\tif (!(_conv_num(&bp, &i, 0, 99)))\n\t\t\t\treturn (NULL);\n\n\t\t\tcentury = i * 100;\n\t\t\tbreak;\n\n\t\tcase 'd':\t \n\t\tcase 'e':\n\t\t\t_LEGAL_ALT(_ALT_O);\n\t\t\tif (!(_conv_num(&bp, &tm->tm_mday, 1, 31)))\n\t\t\t\treturn (NULL);\n\t\t\tbreak;\n\n\t\tcase 'k':\t \n\t\t\t_LEGAL_ALT(0);\n\t\t\t \n\t\tcase 'H':\n\t\t\t_LEGAL_ALT(_ALT_O);\n\t\t\tif (!(_conv_num(&bp, &tm->tm_hour, 0, 23)))\n\t\t\t\treturn (NULL);\n\t\t\tbreak;\n\n\t\tcase 'l':\t \n\t\t\t_LEGAL_ALT(0);\n\t\t\t \n\t\tcase 'I':\n\t\t\t_LEGAL_ALT(_ALT_O);\n\t\t\tif (!(_conv_num(&bp, &tm->tm_hour, 1, 12)))\n\t\t\t\treturn (NULL);\n\t\t\tbreak;\n\n\t\tcase 'j':\t \n\t\t\t_LEGAL_ALT(0);\n\t\t\tif (!(_conv_num(&bp, &tm->tm_yday, 1, 366)))\n\t\t\t\treturn (NULL);\n\t\t\ttm->tm_yday--;\n\t\t\tbreak;\n\n\t\tcase 'M':\t \n\t\t\t_LEGAL_ALT(_ALT_O);\n\t\t\tif (!(_conv_num(&bp, &tm->tm_min, 0, 59)))\n\t\t\t\treturn (NULL);\n\t\t\tbreak;\n\n\t\tcase 'm':\t \n\t\t\t_LEGAL_ALT(_ALT_O);\n\t\t\tif (!(_conv_num(&bp, &tm->tm_mon, 1, 12)))\n\t\t\t\treturn (NULL);\n\t\t\ttm->tm_mon--;\n\t\t\tbreak;\n\n#if 0\n\t\tcase 'p':\t \n\t\t\t_LEGAL_ALT(0);\n\t\t\t \n\t\t\tlen = strlen(_ctloc(am_pm[0]));\n\t\t\tif (strncasecmp(_ctloc(am_pm[0]), bp, len) == 0) {\n\t\t\t\tif (tm->tm_hour > 12)\t \n\t\t\t\t\treturn (NULL);\n\t\t\t\telse if (tm->tm_hour == 12)\n\t\t\t\t\ttm->tm_hour = 0;\n\n\t\t\t\tbp += len;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\t \n\t\t\tlen = strlen(_ctloc(am_pm[1]));\n\t\t\tif (strncasecmp(_ctloc(am_pm[1]), bp, len) == 0) {\n\t\t\t\tif (tm->tm_hour > 12)\t \n\t\t\t\t\treturn (NULL);\n\t\t\t\telse if (tm->tm_hour < 12)\n\t\t\t\t\ttm->tm_hour += 12;\n\n\t\t\t\tbp += len;\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\t \n\t\t\treturn (NULL);\n#endif\n\t\tcase 'S':\t \n\t\t\t_LEGAL_ALT(_ALT_O);\n\t\t\tif (!(_conv_num(&bp, &tm->tm_sec, 0, 61)))\n\t\t\t\treturn (NULL);\n\t\t\tbreak;\n\n\t\tcase 'U':\t \n\t\tcase 'W':\t \n\t\t\t_LEGAL_ALT(_ALT_O);\n\t\t\t \n\t\t\t if (!(_conv_num(&bp, &i, 0, 53)))\n\t\t\t\treturn (NULL);\n\t\t\t break;\n\n\t\tcase 'w':\t \n\t\t\t_LEGAL_ALT(_ALT_O);\n\t\t\tif (!(_conv_num(&bp, &tm->tm_wday, 0, 6)))\n\t\t\t\treturn (NULL);\n\t\t\tbreak;\n\n\t\tcase 'Y':\t \n\t\t\t_LEGAL_ALT(_ALT_E);\n\t\t\tif (!(_conv_num(&bp, &i, 0, 9999)))\n\t\t\t\treturn (NULL);\n\n\t\t\trelyear = -1;\n\t\t\ttm->tm_year = i - TM_YEAR_BASE;\n\t\t\tbreak;\n\n\t\tcase 'y':\t \n\t\t\t_LEGAL_ALT(_ALT_E | _ALT_O);\n\t\t\tif (!(_conv_num(&bp, &relyear, 0, 99)))\n\t\t\t\treturn (NULL);\n\t\t\tbreak;\n\n\t\t \n\t\tcase 'n':\t \n\t\tcase 't':\n\t\t\t_LEGAL_ALT(0);\n\t\t\twhile (isspace(*bp))\n\t\t\t\tbp++;\n\t\t\tbreak;\n\n\n\t\tdefault:\t \n\t\t\treturn (NULL);\n\t\t}\n\n\n\t}\n\n\t \n\tif (relyear != -1) {\n\t\tif (century == TM_YEAR_BASE) {\n\t\t\tif (relyear <= 68)\n\t\t\t\ttm->tm_year = relyear + 2000 - TM_YEAR_BASE;\n\t\t\telse\n\t\t\t\ttm->tm_year = relyear + 1900 - TM_YEAR_BASE;\n\t\t} else {\n\t\t\ttm->tm_year = relyear + century - TM_YEAR_BASE;\n\t\t}\n\t}\n\n\treturn ((char *)bp);\n}\n\n\nstatic int\n_conv_num(const unsigned char **buf, int *dest, int llim, int ulim)\n{\n\tint result = 0;\n\tint rulim = ulim;\n\n\tif (**buf < '0' || **buf > '9')\n\t\treturn (0);\n\n\t \n\tdo {\n\t\tresult *= 10;\n\t\tresult += *(*buf)++ - '0';\n\t\trulim /= 10;\n\t} while ((result * 10 <= ulim) && rulim && **buf >= '0' && **buf <= '9');\n\n\tif (result < llim || result > ulim)\n\t\treturn (0);\n\n\t*dest = result;\n\treturn (1);\n}\n\n#endif  \n\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}