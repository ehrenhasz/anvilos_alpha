{
  "module_name": "bsd-asprintf.c",
  "hash_id": "a2644e17752ac787dd725eb3d6ea69fe3592309db17f84f62a6fc3c3820618b2",
  "original_prompt": "Ingested from openssh-9.6p1/openbsd-compat/bsd-asprintf.c",
  "human_readable_source": " \n\n#include \"includes.h\"\n\n \n#if defined(BROKEN_SNPRINTF)\n# undef HAVE_VASPRINTF\n# undef HAVE_ASPRINTF\n#endif\n\n#ifndef HAVE_VASPRINTF\n\n#include <errno.h>\n#include <stdarg.h>\n#include <stdio.h>\n#include <stdlib.h>\n\n#define INIT_SZ\t128\n\nint\nvasprintf(char **str, const char *fmt, va_list ap)\n{\n\tint ret = -1;\n\tva_list ap2;\n\tchar *string, *newstr;\n\tsize_t len;\n\n\tVA_COPY(ap2, ap);\n\tif ((string = malloc(INIT_SZ)) == NULL)\n\t\tgoto fail;\n\n\tret = vsnprintf(string, INIT_SZ, fmt, ap2);\n\tif (ret >= 0 && ret < INIT_SZ) {  \n\t\t*str = string;\n\t} else if (ret == INT_MAX || ret < 0) {  \n\t\tfree(string);\n\t\tgoto fail;\n\t} else {\t \n\t\tlen = (size_t)ret + 1;\n\t\tif ((newstr = realloc(string, len)) == NULL) {\n\t\t\tfree(string);\n\t\t\tgoto fail;\n\t\t} else {\n\t\t\tva_end(ap2);\n\t\t\tVA_COPY(ap2, ap);\n\t\t\tret = vsnprintf(newstr, len, fmt, ap2);\n\t\t\tif (ret >= 0 && (size_t)ret < len) {\n\t\t\t\t*str = newstr;\n\t\t\t} else {  \n\t\t\t\tfree(newstr);\n\t\t\t\tgoto fail;\n\t\t\t}\n\t\t}\n\t}\n\tva_end(ap2);\n\treturn (ret);\n\nfail:\n\t*str = NULL;\n\terrno = ENOMEM;\n\tva_end(ap2);\n\treturn (-1);\n}\n#endif\n\n#ifndef HAVE_ASPRINTF\nint asprintf(char **str, const char *fmt, ...)\n{\n\tva_list ap;\n\tint ret;\n\n\t*str = NULL;\n\tva_start(ap, fmt);\n\tret = vasprintf(str, fmt, ap);\n\tva_end(ap);\n\n\treturn ret;\n}\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}