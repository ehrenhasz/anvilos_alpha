{
  "module_name": "bsd-poll.c",
  "hash_id": "d6b376956429e30d8943b5785b79edf21b523adbf476091f37958f1c58206a93",
  "original_prompt": "Ingested from openssh-9.6p1/openbsd-compat/bsd-poll.c",
  "human_readable_source": " \n\n#include \"includes.h\"\n#if !defined(HAVE_PPOLL) || !defined(HAVE_POLL) || defined(BROKEN_POLL)\n\n#include <sys/types.h>\n#include <sys/time.h>\n#ifdef HAVE_SYS_PARAM_H\n# include <sys/param.h>\n#endif\n#ifdef HAVE_SYS_SELECT_H\n# include <sys/select.h>\n#endif\n\n#include <errno.h>\n#include <signal.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include \"bsd-poll.h\"\n\n#if !defined(HAVE_PPOLL) || defined(BROKEN_POLL)\n \n\nint\nppoll(struct pollfd *fds, nfds_t nfds, const struct timespec *tmoutp,\n    const sigset_t *sigmask)\n{\n\tnfds_t i;\n\tint ret, fd, maxfd = 0;\n\tfd_set readfds, writefds, exceptfds;\n\n\tfor (i = 0; i < nfds; i++) {\n\t\tfd = fds[i].fd;\n\t\tif (fd != -1 && fd >= FD_SETSIZE) {\n\t\t\terrno = EINVAL;\n\t\t\treturn -1;\n\t\t}\n\t\tmaxfd = MAX(maxfd, fd);\n\t}\n\n\t \n\tFD_ZERO(&readfds);\n\tFD_ZERO(&writefds);\n\tFD_ZERO(&exceptfds);\n\tfor (i = 0; i < nfds; i++) {\n\t\tfd = fds[i].fd;\n\t\tif (fd == -1)\n\t\t\tcontinue;\n\t\tif (fds[i].events & POLLIN)\n\t\t\tFD_SET(fd, &readfds);\n\t\tif (fds[i].events & POLLOUT)\n\t\t\tFD_SET(fd, &writefds);\n\t\tif (fds[i].events & POLLPRI)\n\t\t\tFD_SET(fd, &exceptfds);\n\t}\n\n\tret = pselect(maxfd + 1, &readfds, &writefds, &exceptfds, tmoutp, sigmask);\n\n\t \n\tfor (i = 0; i < nfds; i++) {\n\t\tfd = fds[i].fd;\n\t\tfds[i].revents = 0;\n\t\tif (fd == -1)\n\t\t\tcontinue;\n\t\tif ((fds[i].events & POLLIN) && FD_ISSET(fd, &readfds))\n\t\t\tfds[i].revents |= POLLIN;\n\t\tif ((fds[i].events & POLLOUT) && FD_ISSET(fd, &writefds))\n\t\t\tfds[i].revents |= POLLOUT;\n\t\tif ((fds[i].events & POLLPRI) && FD_ISSET(fd, &exceptfds))\n\t\t\tfds[i].revents |= POLLPRI;\n\t}\n\n\treturn ret;\n}\n#endif  \n\n#if !defined(HAVE_POLL) || defined(BROKEN_POLL)\nint\npoll(struct pollfd *fds, nfds_t nfds, int timeout)\n{\n\tstruct timespec ts, *tsp = NULL;\n\n\t \n\tif (timeout >= 0) {\n\t\tts.tv_sec = timeout / 1000;\n\t\tts.tv_nsec = (timeout % 1000) * 1000000;\n\t\ttsp = &ts;\n\t}\n\n\treturn ppoll(fds, nfds, tsp, NULL);\n}\n#endif  \n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}