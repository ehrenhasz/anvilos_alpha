{
  "module_name": "setproctitle.c",
  "hash_id": "a7a8d55119732f090e8b5d1168b7f992952c0b428cd5292b8c4652f48992e519",
  "original_prompt": "Ingested from openssh-9.6p1/openbsd-compat/setproctitle.c",
  "human_readable_source": " \n\n \n\n#include \"includes.h\"\n\n#ifndef HAVE_SETPROCTITLE\n\n#include <stdarg.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <unistd.h>\n#ifdef HAVE_SYS_PSTAT_H\n#include <sys/pstat.h>\n#endif\n#include <string.h>\n\n#include <vis.h>\n\n#define SPT_NONE\t0\t \n#define SPT_PSTAT\t1\t \n#define SPT_REUSEARGV\t2\t \n\n#ifndef SPT_TYPE\n# define SPT_TYPE\tSPT_NONE\n#endif\n\n#ifndef SPT_PADCHAR\n# define SPT_PADCHAR\t'\\0'\n#endif\n\n#if SPT_TYPE == SPT_REUSEARGV\nstatic char *argv_start = NULL;\nstatic size_t argv_env_len = 0;\n#endif\n\n#endif  \n\nvoid\ncompat_init_setproctitle(int argc, char *argv[])\n{\n#if !defined(HAVE_SETPROCTITLE) && \\\n    defined(SPT_TYPE) && SPT_TYPE == SPT_REUSEARGV\n\textern char **environ;\n\tchar *lastargv = NULL;\n\tchar **envp = environ;\n\tint i;\n\n\t \n\n\tif (argc == 0 || argv[0] == NULL)\n\t\treturn;\n\n\t \n\tfor (i = 0; envp[i] != NULL; i++)\n\t\t;\n\tif ((environ = calloc(i + 1, sizeof(*environ))) == NULL) {\n\t\tenviron = envp;\t \n\t\treturn;\n\t}\n\n\t \n\tfor (i = 0; i < argc; i++) {\n\t\tif (lastargv == NULL || lastargv + 1 == argv[i])\n\t\t\tlastargv = argv[i] + strlen(argv[i]);\n\t}\n\tfor (i = 0; envp[i] != NULL; i++) {\n\t\tif (lastargv + 1 == envp[i])\n\t\t\tlastargv = envp[i] + strlen(envp[i]);\n\t}\n\n\targv[1] = NULL;\n\targv_start = argv[0];\n\targv_env_len = lastargv - argv[0] - 1;\n\n\t \n\tfor (i = 0; envp[i] != NULL; i++)\n\t\tenviron[i] = strdup(envp[i]);\n\tenviron[i] = NULL;\n#endif  \n}\n\n#ifndef HAVE_SETPROCTITLE\nvoid\nsetproctitle(const char *fmt, ...)\n{\n#if SPT_TYPE != SPT_NONE\n\tva_list ap;\n\tchar buf[1024], ptitle[1024];\n\tsize_t len = 0;\n\tint r;\n\textern char *__progname;\n#if SPT_TYPE == SPT_PSTAT\n\tunion pstun pst;\n#endif\n\n#if SPT_TYPE == SPT_REUSEARGV\n\tif (argv_env_len <= 0)\n\t\treturn;\n#endif\n\n\tstrlcpy(buf, __progname, sizeof(buf));\n\n\tr = -1;\n\tva_start(ap, fmt);\n\tif (fmt != NULL) {\n\t\tlen = strlcat(buf, \": \", sizeof(buf));\n\t\tif (len < sizeof(buf))\n\t\t\tr = vsnprintf(buf + len, sizeof(buf) - len , fmt, ap);\n\t}\n\tva_end(ap);\n\tif (r == -1 || (size_t)r >= sizeof(buf) - len)\n\t\treturn;\n\tstrnvis(ptitle, buf, sizeof(ptitle),\n\t    VIS_CSTYLE|VIS_NL|VIS_TAB|VIS_OCTAL);\n\n#if SPT_TYPE == SPT_PSTAT\n\tpst.pst_command = ptitle;\n\tpstat(PSTAT_SETCMD, pst, strlen(ptitle), 0, 0);\n#elif SPT_TYPE == SPT_REUSEARGV\n \n\tlen = strlcpy(argv_start, ptitle, argv_env_len);\n\tfor(; len < argv_env_len; len++)\n\t\targv_start[len] = SPT_PADCHAR;\n#endif\n\n#endif  \n}\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}