{
  "module_name": "kex.h",
  "hash_id": "088ba4d03d5e4b8a6e91282b0f4634f8d410258915751d99994351a124652bcd",
  "original_prompt": "Ingested from openssh-9.6p1/kex.h",
  "human_readable_source": " \n\n \n#ifndef KEX_H\n#define KEX_H\n\n#include \"mac.h\"\n#include \"crypto_api.h\"\n\n#ifdef WITH_OPENSSL\n# include <openssl/bn.h>\n# include <openssl/dh.h>\n# include <openssl/ecdsa.h>\n# ifdef OPENSSL_HAS_ECC\n#  include <openssl/ec.h>\n# else  \n#  define EC_KEY\tvoid\n#  define EC_GROUP\tvoid\n#  define EC_POINT\tvoid\n# endif  \n#else  \n# define DH\t\tvoid\n# define BIGNUM\t\tvoid\n# define EC_KEY\t\tvoid\n# define EC_GROUP\tvoid\n# define EC_POINT\tvoid\n#endif  \n\n#define KEX_COOKIE_LEN\t16\n\n#define\tKEX_DH1\t\t\t\t\"diffie-hellman-group1-sha1\"\n#define\tKEX_DH14_SHA1\t\t\t\"diffie-hellman-group14-sha1\"\n#define\tKEX_DH14_SHA256\t\t\t\"diffie-hellman-group14-sha256\"\n#define\tKEX_DH16_SHA512\t\t\t\"diffie-hellman-group16-sha512\"\n#define\tKEX_DH18_SHA512\t\t\t\"diffie-hellman-group18-sha512\"\n#define\tKEX_DHGEX_SHA1\t\t\t\"diffie-hellman-group-exchange-sha1\"\n#define\tKEX_DHGEX_SHA256\t\t\"diffie-hellman-group-exchange-sha256\"\n#define\tKEX_ECDH_SHA2_NISTP256\t\t\"ecdh-sha2-nistp256\"\n#define\tKEX_ECDH_SHA2_NISTP384\t\t\"ecdh-sha2-nistp384\"\n#define\tKEX_ECDH_SHA2_NISTP521\t\t\"ecdh-sha2-nistp521\"\n#define\tKEX_CURVE25519_SHA256\t\t\"curve25519-sha256\"\n#define\tKEX_CURVE25519_SHA256_OLD\t\"curve25519-sha256@libssh.org\"\n#define\tKEX_SNTRUP761X25519_SHA512\t\"sntrup761x25519-sha512@openssh.com\"\n\n#define COMP_NONE\t0\n \n#define COMP_ZLIB\t1\n#define COMP_DELAYED\t2\n\n#define CURVE25519_SIZE 32\n\nenum kex_init_proposals {\n\tPROPOSAL_KEX_ALGS,\n\tPROPOSAL_SERVER_HOST_KEY_ALGS,\n\tPROPOSAL_ENC_ALGS_CTOS,\n\tPROPOSAL_ENC_ALGS_STOC,\n\tPROPOSAL_MAC_ALGS_CTOS,\n\tPROPOSAL_MAC_ALGS_STOC,\n\tPROPOSAL_COMP_ALGS_CTOS,\n\tPROPOSAL_COMP_ALGS_STOC,\n\tPROPOSAL_LANG_CTOS,\n\tPROPOSAL_LANG_STOC,\n\tPROPOSAL_MAX\n};\n\nenum kex_modes {\n\tMODE_IN,\n\tMODE_OUT,\n\tMODE_MAX\n};\n\nenum kex_exchange {\n\tKEX_DH_GRP1_SHA1,\n\tKEX_DH_GRP14_SHA1,\n\tKEX_DH_GRP14_SHA256,\n\tKEX_DH_GRP16_SHA512,\n\tKEX_DH_GRP18_SHA512,\n\tKEX_DH_GEX_SHA1,\n\tKEX_DH_GEX_SHA256,\n\tKEX_ECDH_SHA2,\n\tKEX_C25519_SHA256,\n\tKEX_KEM_SNTRUP761X25519_SHA512,\n\tKEX_MAX\n};\n\n \n#define KEX_INIT_SENT\t\t\t0x0001\n#define KEX_INITIAL\t\t\t0x0002\n#define KEX_HAS_PUBKEY_HOSTBOUND\t0x0004\n#define KEX_RSA_SHA2_256_SUPPORTED \t0x0008  \n#define KEX_RSA_SHA2_512_SUPPORTED \t0x0010  \n#define KEX_HAS_PING\t\t \t0x0020\n#define KEX_HAS_EXT_INFO_IN_AUTH \t0x0040\n\nstruct sshenc {\n\tchar\t*name;\n\tconst struct sshcipher *cipher;\n\tint\tenabled;\n\tu_int\tkey_len;\n\tu_int\tiv_len;\n\tu_int\tblock_size;\n\tu_char\t*key;\n\tu_char\t*iv;\n};\nstruct sshcomp {\n\tu_int\ttype;\n\tint\tenabled;\n\tchar\t*name;\n};\nstruct newkeys {\n\tstruct sshenc\tenc;\n\tstruct sshmac\tmac;\n\tstruct sshcomp  comp;\n};\n\nstruct ssh;\nstruct sshbuf;\n\nstruct kex {\n\tstruct newkeys\t*newkeys[MODE_MAX];\n\tu_int\twe_need;\n\tu_int\tdh_need;\n\tint\tserver;\n\tchar\t*name;\n\tchar\t*hostkey_alg;\n\tint\thostkey_type;\n\tint\thostkey_nid;\n\tu_int\tkex_type;\n\tchar\t*server_sig_algs;\n\tint\text_info_c;\n\tint\text_info_s;\n\tint\tkex_strict;\n\tint\text_info_received;\n\tstruct sshbuf *my;\n\tstruct sshbuf *peer;\n\tstruct sshbuf *client_version;\n\tstruct sshbuf *server_version;\n\tstruct sshbuf *session_id;\n\tstruct sshbuf *initial_sig;\n\tstruct sshkey *initial_hostkey;\n\tsig_atomic_t done;\n\tu_int\tflags;\n\tint\thash_alg;\n\tint\tec_nid;\n\tchar\t*failed_choice;\n\tint\t(*verify_host_key)(struct sshkey *, struct ssh *);\n\tstruct sshkey *(*load_host_public_key)(int, int, struct ssh *);\n\tstruct sshkey *(*load_host_private_key)(int, int, struct ssh *);\n\tint\t(*host_key_index)(struct sshkey *, int, struct ssh *);\n\tint\t(*sign)(struct ssh *, struct sshkey *, struct sshkey *,\n\t    u_char **, size_t *, const u_char *, size_t, const char *);\n\tint\t(*kex[KEX_MAX])(struct ssh *);\n\t \n\tDH\t*dh;\t\t\t \n\tu_int\tmin, max, nbits;\t \n\tEC_KEY\t*ec_client_key;\t\t \n\tconst EC_GROUP *ec_group;\t \n\tu_char c25519_client_key[CURVE25519_SIZE];  \n\tu_char c25519_client_pubkey[CURVE25519_SIZE];  \n\tu_char sntrup761_client_key[crypto_kem_sntrup761_SECRETKEYBYTES];  \n\tstruct sshbuf *client_pub;\n};\n\nint\t kex_names_valid(const char *);\nchar\t*kex_alg_list(char);\nchar\t*kex_names_cat(const char *, const char *);\nint\t kex_assemble_names(char **, const char *, const char *);\nvoid\t kex_proposal_populate_entries(struct ssh *, char *prop[PROPOSAL_MAX],\n    const char *, const char *, const char *, const char *, const char *);\nvoid\t kex_proposal_free_entries(char *prop[PROPOSAL_MAX]);\n\nint\t kex_exchange_identification(struct ssh *, int, const char *);\n\nstruct kex *kex_new(void);\nint\t kex_ready(struct ssh *, char *[PROPOSAL_MAX]);\nint\t kex_setup(struct ssh *, char *[PROPOSAL_MAX]);\nvoid\t kex_free_newkeys(struct newkeys *);\nvoid\t kex_free(struct kex *);\n\nint\t kex_buf2prop(struct sshbuf *, int *, char ***);\nint\t kex_prop2buf(struct sshbuf *, char *proposal[PROPOSAL_MAX]);\nvoid\t kex_prop_free(char **);\nint\t kex_load_hostkey(struct ssh *, struct sshkey **, struct sshkey **);\nint\t kex_verify_host_key(struct ssh *, struct sshkey *);\n\nint\t kex_send_kexinit(struct ssh *);\nint\t kex_input_kexinit(int, u_int32_t, struct ssh *);\nint\t kex_input_ext_info(int, u_int32_t, struct ssh *);\nint\t kex_protocol_error(int, u_int32_t, struct ssh *);\nint\t kex_derive_keys(struct ssh *, u_char *, u_int, const struct sshbuf *);\nint\t kex_send_newkeys(struct ssh *);\nint\t kex_start_rekex(struct ssh *);\nint\t kex_server_update_ext_info(struct ssh *);\nvoid\t kex_set_server_sig_algs(struct ssh *, const char *);\n\nint\t kexgex_client(struct ssh *);\nint\t kexgex_server(struct ssh *);\nint\t kex_gen_client(struct ssh *);\nint\t kex_gen_server(struct ssh *);\n\nint\t kex_dh_keypair(struct kex *);\nint\t kex_dh_enc(struct kex *, const struct sshbuf *, struct sshbuf **,\n    struct sshbuf **);\nint\t kex_dh_dec(struct kex *, const struct sshbuf *, struct sshbuf **);\n\nint\t kex_ecdh_keypair(struct kex *);\nint\t kex_ecdh_enc(struct kex *, const struct sshbuf *, struct sshbuf **,\n    struct sshbuf **);\nint\t kex_ecdh_dec(struct kex *, const struct sshbuf *, struct sshbuf **);\n\nint\t kex_c25519_keypair(struct kex *);\nint\t kex_c25519_enc(struct kex *, const struct sshbuf *, struct sshbuf **,\n    struct sshbuf **);\nint\t kex_c25519_dec(struct kex *, const struct sshbuf *, struct sshbuf **);\n\nint\t kex_kem_sntrup761x25519_keypair(struct kex *);\nint\t kex_kem_sntrup761x25519_enc(struct kex *, const struct sshbuf *,\n    struct sshbuf **, struct sshbuf **);\nint\t kex_kem_sntrup761x25519_dec(struct kex *, const struct sshbuf *,\n    struct sshbuf **);\n\nint\t kex_dh_keygen(struct kex *);\nint\t kex_dh_compute_key(struct kex *, BIGNUM *, struct sshbuf *);\n\nint\t kexgex_hash(int, const struct sshbuf *, const struct sshbuf *,\n    const struct sshbuf *, const struct sshbuf *, const struct sshbuf *,\n    int, int, int,\n    const BIGNUM *, const BIGNUM *, const BIGNUM *,\n    const BIGNUM *, const u_char *, size_t,\n    u_char *, size_t *);\n\nvoid\tkexc25519_keygen(u_char key[CURVE25519_SIZE], u_char pub[CURVE25519_SIZE])\n\t__attribute__((__bounded__(__minbytes__, 1, CURVE25519_SIZE)))\n\t__attribute__((__bounded__(__minbytes__, 2, CURVE25519_SIZE)));\nint\tkexc25519_shared_key(const u_char key[CURVE25519_SIZE],\n    const u_char pub[CURVE25519_SIZE], struct sshbuf *out)\n\t__attribute__((__bounded__(__minbytes__, 1, CURVE25519_SIZE)))\n\t__attribute__((__bounded__(__minbytes__, 2, CURVE25519_SIZE)));\nint\tkexc25519_shared_key_ext(const u_char key[CURVE25519_SIZE],\n    const u_char pub[CURVE25519_SIZE], struct sshbuf *out, int)\n\t__attribute__((__bounded__(__minbytes__, 1, CURVE25519_SIZE)))\n\t__attribute__((__bounded__(__minbytes__, 2, CURVE25519_SIZE)));\n\n#if defined(DEBUG_KEX) || defined(DEBUG_KEXDH) || defined(DEBUG_KEXECDH)\nvoid\tdump_digest(const char *, const u_char *, int);\n#endif\n\n#if !defined(WITH_OPENSSL) || !defined(OPENSSL_HAS_ECC)\n# undef EC_KEY\n# undef EC_GROUP\n# undef EC_POINT\n#endif\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}