{
  "module_name": "digest-libc.c",
  "hash_id": "6a0481fc8f44a0ddd662270d40062234c4dfd9f258ce736b8ad0233a86f6ec60",
  "original_prompt": "Ingested from openssh-9.6p1/digest-libc.c",
  "human_readable_source": " \n \n\n#include \"includes.h\"\n\n#ifndef WITH_OPENSSL\n\n#include <sys/types.h>\n#include <limits.h>\n#include <stdlib.h>\n#include <string.h>\n\n#if 0\n#include <md5.h>\n#include <rmd160.h>\n#endif\n#ifdef HAVE_SHA1_H\n#include <sha1.h>\n#endif\n#ifdef HAVE_SHA2_H\n#include <sha2.h>\n#endif\n\n#if !defined(SHA256_BLOCK_LENGTH) && defined(SHA256_HMAC_BLOCK_SIZE)\n#define SHA256_BLOCK_LENGTH SHA256_HMAC_BLOCK_SIZE\n#endif\n#if !defined(SHA384_BLOCK_LENGTH) && defined(SHA512_HMAC_BLOCK_SIZE)\n#define SHA384_BLOCK_LENGTH SHA512_HMAC_BLOCK_SIZE\n#endif\n#if !defined(SHA512_BLOCK_LENGTH) && defined(SHA512_HMAC_BLOCK_SIZE)\n#define SHA512_BLOCK_LENGTH SHA512_HMAC_BLOCK_SIZE\n#endif\n\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"digest.h\"\n\ntypedef void md_init_fn(void *mdctx);\ntypedef void md_update_fn(void *mdctx, const u_int8_t *m, size_t mlen);\ntypedef void md_final_fn(u_int8_t[], void *mdctx);\n\nstruct ssh_digest_ctx {\n\tint alg;\n\tvoid *mdctx;\n};\n\nstruct ssh_digest {\n\tint id;\n\tconst char *name;\n\tsize_t block_len;\n\tsize_t digest_len;\n\tsize_t ctx_len;\n\tmd_init_fn *md_init;\n\tmd_update_fn *md_update;\n\tmd_final_fn *md_final;\n};\n\n \nconst struct ssh_digest digests[SSH_DIGEST_MAX] = {\n\t{\n\t\tSSH_DIGEST_MD5,\n\t\t\"MD5\",\n\t\tMD5_BLOCK_LENGTH,\n\t\tMD5_DIGEST_LENGTH,\n\t\tsizeof(MD5_CTX),\n\t\t(md_init_fn *) MD5Init,\n\t\t(md_update_fn *) MD5Update,\n\t\t(md_final_fn *) MD5Final\n\t},\n\t{\n\t\tSSH_DIGEST_SHA1,\n\t\t\"SHA1\",\n\t\tSHA1_BLOCK_LENGTH,\n\t\tSHA1_DIGEST_LENGTH,\n\t\tsizeof(SHA1_CTX),\n\t\t(md_init_fn *) SHA1Init,\n\t\t(md_update_fn *) SHA1Update,\n\t\t(md_final_fn *) SHA1Final\n\t},\n\t{\n\t\tSSH_DIGEST_SHA256,\n\t\t\"SHA256\",\n\t\tSHA256_BLOCK_LENGTH,\n\t\tSHA256_DIGEST_LENGTH,\n\t\tsizeof(SHA2_CTX),\n\t\t(md_init_fn *) SHA256Init,\n\t\t(md_update_fn *) SHA256Update,\n\t\t(md_final_fn *) SHA256Final\n\t},\n\t{\n\t\tSSH_DIGEST_SHA384,\n\t\t\"SHA384\",\n\t\tSHA384_BLOCK_LENGTH,\n\t\tSHA384_DIGEST_LENGTH,\n\t\tsizeof(SHA2_CTX),\n\t\t(md_init_fn *) SHA384Init,\n\t\t(md_update_fn *) SHA384Update,\n\t\t(md_final_fn *) SHA384Final\n\t},\n\t{\n\t\tSSH_DIGEST_SHA512,\n\t\t\"SHA512\",\n\t\tSHA512_BLOCK_LENGTH,\n\t\tSHA512_DIGEST_LENGTH,\n\t\tsizeof(SHA2_CTX),\n\t\t(md_init_fn *) SHA512Init,\n\t\t(md_update_fn *) SHA512Update,\n\t\t(md_final_fn *) SHA512Final\n\t}\n};\n\nstatic const struct ssh_digest *\nssh_digest_by_alg(int alg)\n{\n\tif (alg < 0 || alg >= SSH_DIGEST_MAX)\n\t\treturn NULL;\n\tif (digests[alg].id != alg)  \n\t\treturn NULL;\n\treturn &(digests[alg]);\n}\n\nint\nssh_digest_alg_by_name(const char *name)\n{\n\tint alg;\n\n\tfor (alg = 0; alg < SSH_DIGEST_MAX; alg++) {\n\t\tif (strcasecmp(name, digests[alg].name) == 0)\n\t\t\treturn digests[alg].id;\n\t}\n\treturn -1;\n}\n\nconst char *\nssh_digest_alg_name(int alg)\n{\n\tconst struct ssh_digest *digest = ssh_digest_by_alg(alg);\n\n\treturn digest == NULL ? NULL : digest->name;\n}\n\nsize_t\nssh_digest_bytes(int alg)\n{\n\tconst struct ssh_digest *digest = ssh_digest_by_alg(alg);\n\n\treturn digest == NULL ? 0 : digest->digest_len;\n}\n\nsize_t\nssh_digest_blocksize(struct ssh_digest_ctx *ctx)\n{\n\tconst struct ssh_digest *digest = ssh_digest_by_alg(ctx->alg);\n\n\treturn digest == NULL ? 0 : digest->block_len;\n}\n\nstruct ssh_digest_ctx *\nssh_digest_start(int alg)\n{\n\tconst struct ssh_digest *digest = ssh_digest_by_alg(alg);\n\tstruct ssh_digest_ctx *ret;\n\n\tif (digest == NULL || (ret = calloc(1, sizeof(*ret))) == NULL)\n\t\treturn NULL;\n\tif ((ret->mdctx = calloc(1, digest->ctx_len)) == NULL) {\n\t\tfree(ret);\n\t\treturn NULL;\n\t}\n\tret->alg = alg;\n\tdigest->md_init(ret->mdctx);\n\treturn ret;\n}\n\nint\nssh_digest_copy_state(struct ssh_digest_ctx *from, struct ssh_digest_ctx *to)\n{\n\tconst struct ssh_digest *digest = ssh_digest_by_alg(from->alg);\n\n\tif (digest == NULL || from->alg != to->alg)\n\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\tmemcpy(to->mdctx, from->mdctx, digest->ctx_len);\n\treturn 0;\n}\n\nint\nssh_digest_update(struct ssh_digest_ctx *ctx, const void *m, size_t mlen)\n{\n\tconst struct ssh_digest *digest = ssh_digest_by_alg(ctx->alg);\n\n\tif (digest == NULL)\n\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\tdigest->md_update(ctx->mdctx, m, mlen);\n\treturn 0;\n}\n\nint\nssh_digest_update_buffer(struct ssh_digest_ctx *ctx, const struct sshbuf *b)\n{\n\treturn ssh_digest_update(ctx, sshbuf_ptr(b), sshbuf_len(b));\n}\n\nint\nssh_digest_final(struct ssh_digest_ctx *ctx, u_char *d, size_t dlen)\n{\n\tconst struct ssh_digest *digest = ssh_digest_by_alg(ctx->alg);\n\n\tif (digest == NULL)\n\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\tif (dlen > UINT_MAX)\n\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\tif (dlen < digest->digest_len)  \n\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\tdigest->md_final(d, ctx->mdctx);\n\treturn 0;\n}\n\nvoid\nssh_digest_free(struct ssh_digest_ctx *ctx)\n{\n\tconst struct ssh_digest *digest;\n\n\tif (ctx != NULL) {\n\t\tdigest = ssh_digest_by_alg(ctx->alg);\n\t\tif (digest) {\n\t\t\texplicit_bzero(ctx->mdctx, digest->ctx_len);\n\t\t\tfree(ctx->mdctx);\n\t\t\tfreezero(ctx, sizeof(*ctx));\n\t\t}\n\t}\n}\n\nint\nssh_digest_memory(int alg, const void *m, size_t mlen, u_char *d, size_t dlen)\n{\n\tstruct ssh_digest_ctx *ctx = ssh_digest_start(alg);\n\n\tif (ctx == NULL)\n\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\tif (ssh_digest_update(ctx, m, mlen) != 0 ||\n\t    ssh_digest_final(ctx, d, dlen) != 0)\n\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\tssh_digest_free(ctx);\n\treturn 0;\n}\n\nint\nssh_digest_buffer(int alg, const struct sshbuf *b, u_char *d, size_t dlen)\n{\n\treturn ssh_digest_memory(alg, sshbuf_ptr(b), sshbuf_len(b), d, dlen);\n}\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}