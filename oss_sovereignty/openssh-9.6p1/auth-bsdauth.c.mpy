{
  "module_name": "auth-bsdauth.c",
  "hash_id": "eff3ce0791e720387fe7d99de9d389dd05195f8048c2c33446a68aeb8953449f",
  "original_prompt": "Ingested from openssh-9.6p1/auth-bsdauth.c",
  "human_readable_source": " \n \n\n#include \"includes.h\"\n\n#include <sys/types.h>\n#include <stdarg.h>\n#include <stdio.h>\n\n#ifdef BSD_AUTH\n#include \"xmalloc.h\"\n#include \"sshkey.h\"\n#include \"sshbuf.h\"\n#include \"hostfile.h\"\n#include \"auth.h\"\n#include \"log.h\"\n#ifdef GSSAPI\n#include \"ssh-gss.h\"\n#endif\n#include \"monitor_wrap.h\"\n\nstatic void *\nbsdauth_init_ctx(Authctxt *authctxt)\n{\n\treturn authctxt;\n}\n\nint\nbsdauth_query(void *ctx, char **name, char **infotxt,\n   u_int *numprompts, char ***prompts, u_int **echo_on)\n{\n\tAuthctxt *authctxt = ctx;\n\tchar *challenge = NULL;\n\n\t*infotxt = NULL;\n\t*numprompts = 0;\n\t*prompts = NULL;\n\t*echo_on = NULL;\n\n\tif (authctxt->as != NULL) {\n\t\tdebug2(\"bsdauth_query: try reuse session\");\n\t\tchallenge = auth_getitem(authctxt->as, AUTHV_CHALLENGE);\n\t\tif (challenge == NULL) {\n\t\t\tauth_close(authctxt->as);\n\t\t\tauthctxt->as = NULL;\n\t\t}\n\t}\n\n\tif (challenge == NULL) {\n\t\tdebug2(\"bsdauth_query: new bsd auth session\");\n\t\tdebug3(\"bsdauth_query: style %s\",\n\t\t    authctxt->style ? authctxt->style : \"<default>\");\n\t\tauthctxt->as = auth_userchallenge(authctxt->user,\n\t\t    authctxt->style, \"auth-ssh\", &challenge);\n\t\tif (authctxt->as == NULL)\n\t\t\tchallenge = NULL;\n\t\tdebug2(\"bsdauth_query: <%s>\", challenge ? challenge : \"empty\");\n\t}\n\n\tif (challenge == NULL)\n\t\treturn -1;\n\n\t*name = xstrdup(\"\");\n\t*infotxt = xstrdup(\"\");\n\t*numprompts = 1;\n\t*prompts = xcalloc(*numprompts, sizeof(char *));\n\t*echo_on = xcalloc(*numprompts, sizeof(u_int));\n\t(*prompts)[0] = xstrdup(challenge);\n\n\treturn 0;\n}\n\nint\nbsdauth_respond(void *ctx, u_int numresponses, char **responses)\n{\n\tAuthctxt *authctxt = ctx;\n\tint authok;\n\n\tif (!authctxt->valid)\n\t\treturn -1;\n\n\tif (authctxt->as == NULL)\n\t\terror(\"bsdauth_respond: no bsd auth session\");\n\n\tif (numresponses != 1)\n\t\treturn -1;\n\n\tauthok = auth_userresponse(authctxt->as, responses[0], 0);\n\tauthctxt->as = NULL;\n\tdebug3(\"bsdauth_respond: <%s> = <%d>\", responses[0], authok);\n\n\treturn (authok == 0) ? -1 : 0;\n}\n\nstatic void\nbsdauth_free_ctx(void *ctx)\n{\n\tAuthctxt *authctxt = ctx;\n\n\tif (authctxt && authctxt->as) {\n\t\tauth_close(authctxt->as);\n\t\tauthctxt->as = NULL;\n\t}\n}\n\nKbdintDevice bsdauth_device = {\n\t\"bsdauth\",\n\tbsdauth_init_ctx,\n\tbsdauth_query,\n\tbsdauth_respond,\n\tbsdauth_free_ctx\n};\n\nKbdintDevice mm_bsdauth_device = {\n\t\"bsdauth\",\n\tbsdauth_init_ctx,\n\tmm_bsdauth_query,\n\tmm_bsdauth_respond,\n\tbsdauth_free_ctx\n};\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}