{
  "module_name": "sandbox-solaris.c",
  "hash_id": "df87f2a8f530a0524fbcd5ab50ba004593622f5f11731651fd4231874d246d61",
  "original_prompt": "Ingested from openssh-9.6p1/sandbox-solaris.c",
  "human_readable_source": " \n\n#include \"includes.h\"\n\n#ifdef SANDBOX_SOLARIS\n#ifndef USE_SOLARIS_PRIVS\n# error \"--with-solaris-privs must be used with the Solaris sandbox\"\n#endif\n\n#include <sys/types.h>\n\n#include <errno.h>\n#include <stdarg.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <unistd.h>\n#ifdef HAVE_PRIV_H\n# include <priv.h>\n#endif\n\n#include \"log.h\"\n#include \"ssh-sandbox.h\"\n#include \"xmalloc.h\"\n\nstruct ssh_sandbox {\n\tpriv_set_t *pset;\n};\n\nstruct ssh_sandbox *\nssh_sandbox_init(struct monitor *monitor)\n{\n\tstruct ssh_sandbox *box = NULL;\n\n\tbox = xcalloc(1, sizeof(*box));\n\n\t \n\tbox->pset = solaris_basic_privset();\n\n\tif (box->pset == NULL) {\n\t\tfree(box);\n\t\treturn NULL;\n\t}\n\n\t \n\tif (priv_delset(box->pset, PRIV_FILE_LINK_ANY) != 0 ||\n#ifdef PRIV_NET_ACCESS\n\t    priv_delset(box->pset, PRIV_NET_ACCESS) != 0 ||\n#endif\n#ifdef PRIV_DAX_ACCESS\n\t    priv_delset(box->pset, PRIV_DAX_ACCESS) != 0 ||\n#endif\n#ifdef PRIV_SYS_IB_INFO\n\t    priv_delset(box->pset, PRIV_SYS_IB_INFO) != 0 ||\n#endif\n\t    priv_delset(box->pset, PRIV_PROC_EXEC) != 0 ||\n\t    priv_delset(box->pset, PRIV_PROC_FORK) != 0 ||\n\t    priv_delset(box->pset, PRIV_PROC_INFO) != 0 ||\n\t    priv_delset(box->pset, PRIV_PROC_SESSION) != 0) {\n\t\tfree(box);\n\t\treturn NULL;\n\t}\n\n\t \n# if defined(PRIV_FILE_READ) && defined(PRIV_FILE_WRITE)\n\tif (priv_delset(box->pset, PRIV_FILE_READ) != 0 ||\n\t    priv_delset(box->pset, PRIV_FILE_WRITE) != 0) {\n\t\tfree(box);\n\t\treturn NULL;\n\t}\n# endif\n\n\treturn box;\n}\n\nvoid\nssh_sandbox_child(struct ssh_sandbox *box)\n{\n\tif (setppriv(PRIV_SET, PRIV_PERMITTED, box->pset) != 0 ||\n\t    setppriv(PRIV_SET, PRIV_LIMIT, box->pset) != 0 ||\n\t    setppriv(PRIV_SET, PRIV_INHERITABLE, box->pset) != 0)\n\t\tfatal(\"setppriv: %s\", strerror(errno));\n}\n\nvoid\nssh_sandbox_parent_finish(struct ssh_sandbox *box)\n{\n\tpriv_freeset(box->pset);\n\tbox->pset = NULL;\n\tfree(box);\n}\n\nvoid\nssh_sandbox_parent_preauth(struct ssh_sandbox *box, pid_t child_pid)\n{\n\t \n}\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}