{
  "module_name": "configure.ac",
  "hash_id": "0d5adbe63637c244e5e7e97089b5144d145cea8b1e4bf9d921e265228eff8285",
  "original_prompt": "Ingested from openssh-9.6p1/configure.ac",
  "human_readable_source": "#\n# Copyright (c) 1999-2004 Damien Miller\n#\n# Permission to use, copy, modify, and distribute this software for any\n# purpose with or without fee is hereby granted, provided that the above\n# copyright notice and this permission notice appear in all copies.\n#\n# THE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES\n# WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF\n# MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR\n# ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES\n# WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN\n# ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF\n# OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.\n\nAC_INIT([OpenSSH], [Portable], [openssh-unix-dev@mindrot.org])\nAC_CONFIG_MACRO_DIR([m4])\nAC_CONFIG_SRCDIR([ssh.c])\n\n# Check for stale configure as early as possible.\nfor i in $srcdir/configure.ac $srcdir/m4/*.m4; do\n\tif test \"$i\" -nt \"$srcdir/configure\"; then\n\t\tAC_MSG_ERROR([$i newer than configure, run autoreconf])\n\tfi\ndone\n\nAC_LANG([C])\n\nAC_CONFIG_HEADERS([config.h])\nAC_PROG_CC([cc gcc clang])\n\n# XXX relax this after reimplementing logit() etc.\nAC_MSG_CHECKING([if $CC supports C99-style variadic macros])\nAC_COMPILE_IFELSE([AC_LANG_PROGRAM([[\nint f(int a, int b, int c) { return a + b + c; }\n#define F(a, ...) f(a, __VA_ARGS__)\n]], [[return F(1, 2, -3);]])],\n\t[ AC_MSG_RESULT([yes]) ],\n\t[ AC_MSG_ERROR([*** OpenSSH requires support for C99-style variadic macros]) ]\n)\n\nAC_CANONICAL_HOST\nAC_C_BIGENDIAN\n\n# Checks for programs.\nAC_PROG_AWK\nAC_PROG_CPP\nAC_PROG_RANLIB\nAC_PROG_INSTALL\nAC_PROG_EGREP\nAC_PROG_MKDIR_P\nAC_CHECK_TOOLS([AR], [ar])\nAC_PATH_PROG([CAT], [cat])\nAC_PATH_PROG([KILL], [kill])\nAC_PATH_PROG([SED], [sed])\nAC_PATH_PROG([TEST_MINUS_S_SH], [bash])\nAC_PATH_PROG([TEST_MINUS_S_SH], [ksh])\nAC_PATH_PROG([TEST_MINUS_S_SH], [sh])\nAC_PATH_PROG([SH], [bash])\nAC_PATH_PROG([SH], [ksh])\nAC_PATH_PROG([SH], [sh])\nAC_PATH_PROG([GROFF], [groff])\nAC_PATH_PROG([NROFF], [nroff awf])\nAC_PATH_PROG([MANDOC], [mandoc])\nAC_PATH_TOOL([PKGCONFIG], [pkg-config], [no])\nAC_SUBST([TEST_SHELL], [sh])\n\ndnl select manpage formatter to be used to build \"cat\" format pages.\nif test \"x$MANDOC\" != \"x\" ; then\n\tMANFMT=\"$MANDOC\"\nelif test \"x$NROFF\" != \"x\" ; then\n\tMANFMT=\"$NROFF -mandoc\"\nelif test \"x$GROFF\" != \"x\" ; then\n\tMANFMT=\"$GROFF -mandoc -Tascii\"\nelse\n\tAC_MSG_WARN([no manpage formatter found])\n\tMANFMT=\"false\"\nfi\nAC_SUBST([MANFMT])\n\ndnl for buildpkg.sh\nAC_PATH_PROG([PATH_GROUPADD_PROG], [groupadd], [groupadd],\n\t[/usr/sbin${PATH_SEPARATOR}/etc])\nAC_PATH_PROG([PATH_USERADD_PROG], [useradd], [useradd],\n\t[/usr/sbin${PATH_SEPARATOR}/etc])\nAC_CHECK_PROG([MAKE_PACKAGE_SUPPORTED], [pkgmk], [yes], [no])\nif test -x /sbin/sh; then\n\tAC_SUBST([STARTUP_SCRIPT_SHELL], [/sbin/sh])\nelse\n\tAC_SUBST([STARTUP_SCRIPT_SHELL], [/bin/sh])\nfi\n\n# System features\nAC_SYS_LARGEFILE\n\nif test -z \"$AR\" ; then\n\tAC_MSG_ERROR([*** 'ar' missing, please install or fix your \\$PATH ***])\nfi\n\nAC_PATH_PROG([PATH_PASSWD_PROG], [passwd])\nif test ! -z \"$PATH_PASSWD_PROG\" ; then\n\tAC_DEFINE_UNQUOTED([_PATH_PASSWD_PROG], [\"$PATH_PASSWD_PROG\"],\n\t\t[Full path of your \"passwd\" program])\nfi\n\ndnl Since autoconf doesn't support it very well,  we no longer allow users to\ndnl override LD, however keeping the hook here for now in case there's a use\ndnl use case we overlooked and someone needs to re-enable it.  Unless a good\ndnl reason is found we'll be removing this in future.\nLD=\"$CC\"\nAC_SUBST([LD])\n\nAC_C_INLINE\n\nAC_CHECK_DECL([LLONG_MAX], [have_llong_max=1], , [#include <limits.h>])\nAC_CHECK_DECL([LONG_LONG_MAX], [have_long_long_max=1], , [#include <limits.h>])\nAC_CHECK_DECL([SYSTR_POLICY_KILL], [have_systr_policy_kill=1], , [\n\t#include <sys/types.h>\n\t#include <sys/param.h>\n\t#include <dev/systrace.h>\n])\nAC_CHECK_DECL([RLIMIT_NPROC],\n    [AC_DEFINE([HAVE_RLIMIT_NPROC], [], [sys/resource.h has RLIMIT_NPROC])], , [\n\t#include <sys/types.h>\n\t#include <sys/resource.h>\n])\nAC_CHECK_DECL([PR_SET_NO_NEW_PRIVS], [have_linux_no_new_privs=1], , [\n\t#include <sys/types.h>\n\t#include <linux/prctl.h>\n])\n\nopenssl=yes\nopenssl_bin=openssl\nAC_ARG_WITH([openssl],\n\t[  --without-openssl       Disable use of OpenSSL; use only limited internal crypto **EXPERIMENTAL** ],\n\t[  if test \"x$withval\" = \"xno\" ; then\n\t\topenssl=no\n\t\topenssl_bin=\"\"\n\t   fi\n\t]\n)\nAC_MSG_CHECKING([whether OpenSSL will be used for cryptography])\nif test \"x$openssl\" = \"xyes\" ; then\n\tAC_MSG_RESULT([yes])\n\tAC_DEFINE_UNQUOTED([WITH_OPENSSL], [1], [use libcrypto for cryptography])\nelse\n\tAC_MSG_RESULT([no])\nfi\n\nuse_stack_protector=1\nuse_toolchain_hardening=1\nAC_ARG_WITH([stackprotect],\n    [  --without-stackprotect  Don't use compiler's stack protection], [\n    if test \"x$withval\" = \"xno\"; then\n\tuse_stack_protector=0\n    fi ])\nAC_ARG_WITH([hardening],\n    [  --without-hardening     Don't use toolchain hardening flags], [\n    if test \"x$withval\" = \"xno\"; then\n\tuse_toolchain_hardening=0\n    fi ])\n\n# We use -Werror for the tests only so that we catch warnings like \"this is\n# on by default\" for things like -fPIE.\nAC_MSG_CHECKING([if $CC supports -Werror])\nsaved_CFLAGS=\"$CFLAGS\"\nCFLAGS=\"$CFLAGS -Werror\"\nAC_COMPILE_IFELSE([AC_LANG_SOURCE([[int main(void) { return 0; }]])],\n\t[ AC_MSG_RESULT([yes])\n\t  WERROR=\"-Werror\"],\n\t[ AC_MSG_RESULT([no])\n\t  WERROR=\"\" ]\n)\nCFLAGS=\"$saved_CFLAGS\"\n\nif test \"$GCC\" = \"yes\" || test \"$GCC\" = \"egcs\"; then\n\tAC_MSG_CHECKING([gcc version])\n\tGCC_VER=`$CC -v 2>&1 | $AWK '/gcc version /{print $3}'`\n\tcase \"$GCC_VER\" in\n\t\t1.*) no_attrib_nonnull=1 ;;\n\t\t2.8* | 2.9*)\n\t\t     no_attrib_nonnull=1\n\t\t     ;;\n\t\t2.*) no_attrib_nonnull=1 ;;\n\t\t*) ;;\n\tesac\n\tAC_MSG_RESULT([$GCC_VER])\n\n\tAC_MSG_CHECKING([clang version])\n\tver=\"`$CC -v 2>&1`\"\n\tif echo \"$ver\" | grep \"Apple\" >/dev/null; then\n\t\tCLANG_VER=apple-`echo \"$ver\" | grep 'clang version' | \\\n\t\t    $SED 's/.*clang version //g' | $AWK '{print $1}'`\n\telse\n\t\tCLANG_VER=`echo \"$ver\" | grep 'clang version' | \\\n\t\t    $SED 's/.*clang version //g' | $AWK '{print $1}'`\n\tfi\n\tAC_MSG_RESULT([$CLANG_VER])\n\n\tOSSH_CHECK_CFLAG_COMPILE([-pipe])\n\tOSSH_CHECK_CFLAG_COMPILE([-Wunknown-warning-option])\n\tOSSH_CHECK_CFLAG_COMPILE([-Wno-error=format-truncation])\n\tOSSH_CHECK_CFLAG_COMPILE([-Qunused-arguments])\n\tOSSH_CHECK_CFLAG_COMPILE([-Wall])\n\tOSSH_CHECK_CFLAG_COMPILE([-Wextra])\n\tOSSH_CHECK_CFLAG_COMPILE([-Wpointer-arith])\n\tOSSH_CHECK_CFLAG_COMPILE([-Wuninitialized])\n\tOSSH_CHECK_CFLAG_COMPILE([-Wsign-compare])\n\tOSSH_CHECK_CFLAG_COMPILE([-Wformat-security])\n\tOSSH_CHECK_CFLAG_COMPILE([-Wsizeof-pointer-memaccess])\n\tOSSH_CHECK_CFLAG_COMPILE([-Wpointer-sign], [-Wno-pointer-sign])\n\tOSSH_CHECK_CFLAG_COMPILE([-Wunused-parameter], [-Wno-unused-parameter])\n\tOSSH_CHECK_CFLAG_COMPILE([-Wunused-result], [-Wno-unused-result])\n\tOSSH_CHECK_CFLAG_COMPILE([-Wimplicit-fallthrough])\n\tOSSH_CHECK_CFLAG_COMPILE([-Wmisleading-indentation])\n\tOSSH_CHECK_CFLAG_COMPILE([-Wbitwise-instead-of-logical])\n\tOSSH_CHECK_CFLAG_COMPILE([-fno-strict-aliasing])\n    if test \"x$use_toolchain_hardening\" = \"x1\"; then\n\tOSSH_CHECK_CFLAG_COMPILE([-mretpoline]) # clang\n\tOSSH_CHECK_LDFLAG_LINK([-Wl,-z,retpolineplt])\n\tOSSH_CHECK_CFLAG_COMPILE([-D_FORTIFY_SOURCE=2])\n\tOSSH_CHECK_LDFLAG_LINK([-Wl,-z,relro])\n\tOSSH_CHECK_LDFLAG_LINK([-Wl,-z,now])\n\tOSSH_CHECK_LDFLAG_LINK([-Wl,-z,noexecstack])\n\t# NB. -ftrapv expects certain support functions to be present in\n\t# the compiler library (libgcc or similar) to detect integer operations\n\t# that can overflow. We must check that the result of enabling it\n\t# actually links. The test program compiled/linked includes a number\n\t# of integer operations that should exercise this.\n\tOSSH_CHECK_CFLAG_LINK([-ftrapv])\n\t# clang 15 seems to have a bug in -fzero-call-used-regs=all.  See\n\t# https://bugzilla.mindrot.org/show_bug.cgi?id=3475 and\n\t# https://github.com/llvm/llvm-project/issues/59242\n\t# clang 17 has a different bug that causes an ICE when using this\n\t# flag at all (https://bugzilla.mindrot.org/show_bug.cgi?id=3629)\n\tcase \"$CLANG_VER\" in\n\tapple-15*) OSSH_CHECK_CFLAG_LINK([-fzero-call-used-regs=used]) ;;\n\t17*)\t;;\n\t*)\tOSSH_CHECK_CFLAG_LINK([-fzero-call-used-regs=used]) ;;\n\tesac\n\tOSSH_CHECK_CFLAG_COMPILE([-ftrivial-auto-var-init=zero])\n    fi\n\n\tAC_MSG_CHECKING([if $CC accepts -fno-builtin-memset])\n\tsaved_CFLAGS=\"$CFLAGS\"\n\tCFLAGS=\"$CFLAGS -fno-builtin-memset\"\n\tAC_LINK_IFELSE([AC_LANG_PROGRAM([[ #include <string.h> ]],\n\t\t\t[[ char b[10]; memset(b, 0, sizeof(b)); ]])],\n\t\t[ AC_MSG_RESULT([yes]) ],\n\t\t[ AC_MSG_RESULT([no])\n\t\t  CFLAGS=\"$saved_CFLAGS\" ]\n\t)\n\n\t# -fstack-protector-all doesn't always work for some GCC versions\n\t# and/or platforms, so we test if we can.  If it's not supported\n\t# on a given platform gcc will emit a warning so we use -Werror.\n\tif test \"x$use_stack_protector\" = \"x1\"; then\n\t    for t in -fstack-protector-strong -fstack-protector-all \\\n\t\t    -fstack-protector; do\n\t\tAC_MSG_CHECKING([if $CC supports $t])\n\t\tsaved_CFLAGS=\"$CFLAGS\"\n\t\tsaved_LDFLAGS=\"$LDFLAGS\"\n\t\tCFLAGS=\"$CFLAGS $t -Werror\"\n\t\tLDFLAGS=\"$LDFLAGS $t -Werror\"\n\t\tAC_LINK_IFELSE(\n\t\t\t[AC_LANG_PROGRAM([[\n\t#include <stdio.h>\n\tint func (int t) {char b[100]; snprintf(b,sizeof b,\"%d\",t); return t;}\n\t\t\t ]],\n\t\t\t[[\n\tchar x[256];\n\tsnprintf(x, sizeof(x), \"XXX%d\", func(1));\n\t\t\t ]])],\n\t\t    [ AC_MSG_RESULT([yes])\n\t\t      CFLAGS=\"$saved_CFLAGS $t\"\n\t\t      LDFLAGS=\"$saved_LDFLAGS $t\"\n\t\t      AC_MSG_CHECKING([if $t works])\n\t\t      AC_RUN_IFELSE(\n\t\t\t[AC_LANG_PROGRAM([[\n\t#include <stdio.h>\n\tint func (int t) {char b[100]; snprintf(b,sizeof b,\"%d\",t); return t;}\n\t\t\t]],\n\t\t\t[[\n\tchar x[256];\n\tsnprintf(x, sizeof(x), \"XXX%d\", func(1));\n\t\t\t]])],\n\t\t\t[ AC_MSG_RESULT([yes])\n\t\t\t  break ],\n\t\t\t[ AC_MSG_RESULT([no]) ],\n\t\t\t[ AC_MSG_WARN([cross compiling: cannot test])\n\t\t\t  break ]\n\t\t      )\n\t\t    ],\n\t\t    [ AC_MSG_RESULT([no]) ]\n\t\t)\n\t\tCFLAGS=\"$saved_CFLAGS\"\n\t\tLDFLAGS=\"$saved_LDFLAGS\"\n\t    done\n\tfi\n\n\tif test -z \"$have_llong_max\"; then\n\t\t# retry LLONG_MAX with -std=gnu99, needed on some Linuxes\n\t\tunset ac_cv_have_decl_LLONG_MAX\n\t\tsaved_CFLAGS=\"$CFLAGS\"\n\t\tCFLAGS=\"$CFLAGS -std=gnu99\"\n\t\tAC_CHECK_DECL([LLONG_MAX],\n\t\t    [have_llong_max=1],\n\t\t    [CFLAGS=\"$saved_CFLAGS\"],\n\t\t    [#include <limits.h>]\n\t\t)\n\tfi\nfi\n\nAC_MSG_CHECKING([if compiler allows __attribute__ on return types])\nAC_COMPILE_IFELSE(\n    [AC_LANG_PROGRAM([[\n#include <stdlib.h>\n__attribute__((__unused__)) static void foo(void){return;}]],\n    [[ exit(0); ]])],\n    [ AC_MSG_RESULT([yes]) ],\n    [ AC_MSG_RESULT([no])\n      AC_DEFINE(NO_ATTRIBUTE_ON_RETURN_TYPE, 1,\n\t [compiler does not accept __attribute__ on return types]) ]\n)\n\nAC_MSG_CHECKING([if compiler allows __attribute__ prototype args])\nAC_COMPILE_IFELSE(\n    [AC_LANG_PROGRAM([[\n#include <stdlib.h>\ntypedef void foo(const char *, ...) __attribute__((format(printf, 1, 2)));]],\n    [[ exit(0); ]])],\n    [ AC_MSG_RESULT([yes]) ],\n    [ AC_MSG_RESULT([no])\n      AC_DEFINE(NO_ATTRIBUTE_ON_PROTOTYPE_ARGS, 1,\n\t [compiler does not accept __attribute__ on prototype args]) ]\n)\n\nAC_MSG_CHECKING([if compiler supports variable length arrays])\nAC_COMPILE_IFELSE(\n    [AC_LANG_PROGRAM([[#include <stdlib.h>]],\n    [[ int i; for (i=0; i<3; i++){int a[i]; a[i-1]=0;} exit(0); ]])],\n    [ AC_MSG_RESULT([yes])\n      AC_DEFINE(VARIABLE_LENGTH_ARRAYS, [1],\n\t [compiler supports variable length arrays]) ],\n    [ AC_MSG_RESULT([no]) ]\n)\n\nAC_MSG_CHECKING([if compiler accepts variable declarations after code])\nAC_COMPILE_IFELSE(\n    [AC_LANG_PROGRAM([[#include <stdlib.h>]],\n    [[ int a; a = 1; int b = 1; exit(a-b); ]])],\n    [ AC_MSG_RESULT([yes])\n      AC_DEFINE(VARIABLE_DECLARATION_AFTER_CODE, [1],\n\t [compiler variable declarations after code]) ],\n    [ AC_MSG_RESULT([no]) ]\n)\n\nif test \"x$no_attrib_nonnull\" != \"x1\" ; then\n\tAC_DEFINE([HAVE_ATTRIBUTE__NONNULL__], [1], [Have attribute nonnull])\nfi\n\nAC_ARG_WITH([rpath],\n\t[  --without-rpath         Disable auto-added -R linker paths],\n\t[\n\t\tif test \"x$withval\" = \"xno\" ; then\n\t\t\trpath_opt=\"\"\n\t\telif test \"x$withval\" = \"xyes\" ; then\n\t\t\trpath_opt=\"-R\"\n\t\telse\n\t\t\trpath_opt=\"$withval\"\n\t\tfi\n\t]\n)\n\n# Allow user to specify flags\nAC_ARG_WITH([cflags],\n\t[  --with-cflags           Specify additional flags to pass to compiler],\n\t[\n\t\tif test -n \"$withval\"  &&  test \"x$withval\" != \"xno\"  &&  \\\n\t\t    test \"x${withval}\" != \"xyes\"; then\n\t\t\tCFLAGS=\"$CFLAGS $withval\"\n\t\tfi\n\t]\n)\n\nAC_ARG_WITH([cflags-after],\n\t[  --with-cflags-after     Specify additional flags to pass to compiler after configure],\n\t[\n\t\tif test -n \"$withval\"  &&  test \"x$withval\" != \"xno\"  &&  \\\n\t\t    test \"x${withval}\" != \"xyes\"; then\n\t\t\tCFLAGS_AFTER=\"$withval\"\n\t\tfi\n\t]\n)\nAC_ARG_WITH([cppflags],\n\t[  --with-cppflags         Specify additional flags to pass to preprocessor] ,\n\t[\n\t\tif test -n \"$withval\"  &&  test \"x$withval\" != \"xno\"  &&  \\\n\t\t    test \"x${withval}\" != \"xyes\"; then\n\t\t\tCPPFLAGS=\"$CPPFLAGS $withval\"\n\t\tfi\n\t]\n)\nAC_ARG_WITH([ldflags],\n\t[  --with-ldflags          Specify additional flags to pass to linker],\n\t[\n\t\tif test -n \"$withval\"  &&  test \"x$withval\" != \"xno\"  &&  \\\n\t\t    test \"x${withval}\" != \"xyes\"; then\n\t\t\tLDFLAGS=\"$LDFLAGS $withval\"\n\t\tfi\n\t]\n)\nAC_ARG_WITH([ldflags-after],\n\t[  --with-ldflags-after    Specify additional flags to pass to linker after configure],\n\t[\n\t\tif test -n \"$withval\"  &&  test \"x$withval\" != \"xno\"  &&  \\\n\t\t    test \"x${withval}\" != \"xyes\"; then\n\t\t\tLDFLAGS_AFTER=\"$withval\"\n\t\tfi\n\t]\n)\nAC_ARG_WITH([libs],\n\t[  --with-libs             Specify additional libraries to link with],\n\t[\n\t\tif test -n \"$withval\"  &&  test \"x$withval\" != \"xno\"  &&  \\\n\t\t    test \"x${withval}\" != \"xyes\"; then\n\t\t\tLIBS=\"$LIBS $withval\"\n\t\tfi\n\t]\n)\nAC_ARG_WITH([Werror],\n\t[  --with-Werror           Build main code with -Werror],\n\t[\n\t\tif test -n \"$withval\"  &&  test \"x$withval\" != \"xno\"; then\n\t\t\twerror_flags=\"-Werror\"\n\t\t\tif test \"x${withval}\" != \"xyes\"; then\n\t\t\t\twerror_flags=\"$withval\"\n\t\t\tfi\n\t\tfi\n\t]\n)\n\ndnl On some old platforms, sys/stat.h requires sys/types.h, but autoconf-2.71's\ndnl AC_CHECK_INCLUDES_DEFAULT checks for them in the opposite order.  If we\ndnl haven't detected it, recheck.\nif test \"x$ac_cv_header_sys_stat_h\" != \"xyes\"; then\n\tunset ac_cv_header_sys_stat_h\n\tAC_CHECK_HEADERS([sys/stat.h])\nfi\n\nAC_CHECK_HEADERS([ \\\n\tblf.h \\\n\tbstring.h \\\n\tcrypt.h \\\n\tcrypto/sha2.h \\\n\tdirent.h \\\n\tendian.h \\\n\telf.h \\\n\terr.h \\\n\tfeatures.h \\\n\tfcntl.h \\\n\tfloatingpoint.h \\\n\tfnmatch.h \\\n\tgetopt.h \\\n\tglob.h \\\n\tia.h \\\n\tiaf.h \\\n\tifaddrs.h \\\n\tinttypes.h \\\n\tlanginfo.h \\\n\tlimits.h \\\n\tlocale.h \\\n\tlogin.h \\\n\tmaillock.h \\\n\tndir.h \\\n\tnet/if_tun.h \\\n\tnetdb.h \\\n\tnetgroup.h \\\n\tpam/pam_appl.h \\\n\tpaths.h \\\n\tpoll.h \\\n\tpty.h \\\n\treadpassphrase.h \\\n\trpc/types.h \\\n\tsecurity/pam_appl.h \\\n\tsha2.h \\\n\tshadow.h \\\n\tstddef.h \\\n\tstdint.h \\\n\tstring.h \\\n\tstrings.h \\\n\tsys/bitypes.h \\\n\tsys/byteorder.h \\\n\tsys/bsdtty.h \\\n\tsys/cdefs.h \\\n\tsys/dir.h \\\n\tsys/file.h \\\n\tsys/mman.h \\\n\tsys/label.h \\\n\tsys/ndir.h \\\n\tsys/param.h \\\n\tsys/poll.h \\\n\tsys/prctl.h \\\n\tsys/procctl.h \\\n\tsys/pstat.h \\\n\tsys/ptrace.h \\\n\tsys/random.h \\\n\tsys/select.h \\\n\tsys/stream.h \\\n\tsys/stropts.h \\\n\tsys/strtio.h \\\n\tsys/statvfs.h \\\n\tsys/sysmacros.h \\\n\tsys/time.h \\\n\tsys/timers.h \\\n\tsys/vfs.h \\\n\ttime.h \\\n\ttmpdir.h \\\n\tttyent.h \\\n\tucred.h \\\n\tunistd.h \\\n\tusersec.h \\\n\tutil.h \\\n\tutime.h \\\n\tutmp.h \\\n\tutmpx.h \\\n\tvis.h \\\n\twchar.h \\\n])\n\n# On some platforms (eg SunOS4) sys/audit.h requires sys/[time|types|label.h]\n# to be included first.\nAC_CHECK_HEADERS([sys/audit.h], [], [], [\n#ifdef HAVE_SYS_TIME_H\n# include <sys/time.h>\n#endif\n#ifdef HAVE_SYS_TYPES_H\n# include <sys/types.h>\n#endif\n#ifdef HAVE_SYS_LABEL_H\n# include <sys/label.h>\n#endif\n])\n\n# sys/capsicum.h requires sys/types.h\nAC_CHECK_HEADERS([sys/capsicum.h capsicum_helpers.h], [], [], [\n#ifdef HAVE_SYS_TYPES_H\n# include <sys/types.h>\n#endif\n])\n\nAC_MSG_CHECKING([for caph_cache_tzdata])\nAC_LINK_IFELSE(\n    [AC_LANG_PROGRAM([[ #include <capsicum_helpers.h> ]],\n\t[[caph_cache_tzdata();]])],\n    [\n\tAC_MSG_RESULT([yes])\n\tAC_DEFINE([HAVE_CAPH_CACHE_TZDATA], [1],\n\t    [Define if you have caph_cache_tzdata])\n    ],\n    [ AC_MSG_RESULT([no]) ]\n)\n\n# net/route.h requires sys/socket.h and sys/types.h.\n# sys/sysctl.h also requires sys/param.h\nAC_CHECK_HEADERS([net/route.h sys/sysctl.h], [], [], [\n#ifdef HAVE_SYS_TYPES_H\n# include <sys/types.h>\n#endif\n#include <sys/param.h>\n#include <sys/socket.h>\n])\n\n# lastlog.h requires sys/time.h to be included first on Solaris\nAC_CHECK_HEADERS([lastlog.h], [], [], [\n#ifdef HAVE_SYS_TIME_H\n# include <sys/time.h>\n#endif\n])\n\n# sys/ptms.h requires sys/stream.h to be included first on Solaris\nAC_CHECK_HEADERS([sys/ptms.h], [], [], [\n#ifdef HAVE_SYS_STREAM_H\n# include <sys/stream.h>\n#endif\n])\n\n# login_cap.h requires sys/types.h on NetBSD\nAC_CHECK_HEADERS([login_cap.h], [], [], [\n#include <sys/types.h>\n])\n\n# older BSDs need sys/param.h before sys/mount.h\nAC_CHECK_HEADERS([sys/mount.h], [], [], [\n#include <sys/param.h>\n])\n\n# Android requires sys/socket.h to be included before sys/un.h\nAC_CHECK_HEADERS([sys/un.h], [], [], [\n#include <sys/types.h>\n#include <sys/socket.h>\n])\n\n# Messages for features tested for in target-specific section\nSIA_MSG=\"no\"\nSPC_MSG=\"no\"\nSP_MSG=\"no\"\nSPP_MSG=\"no\"\n\n# Support for Solaris/Illumos privileges (this test is used by both\n# the --with-solaris-privs option and --with-sandbox=solaris).\nSOLARIS_PRIVS=\"no\"\n\n# Check for some target-specific stuff\ncase \"$host\" in\n*-*-aix*)\n\t# Some versions of VAC won't allow macro redefinitions at\n\t# -qlanglevel=ansi, and autoconf 2.60 sometimes insists on using that\n\t# particularly with older versions of vac or xlc.\n\t# It also throws errors about null macro arguments, but these are\n\t# not fatal.\n\tAC_MSG_CHECKING([if compiler allows macro redefinitions])\n\tAC_COMPILE_IFELSE(\n\t    [AC_LANG_PROGRAM([[\n#define testmacro foo\n#define testmacro bar]],\n\t    [[ exit(0); ]])],\n\t    [ AC_MSG_RESULT([yes]) ],\n\t    [ AC_MSG_RESULT([no])\n\t      CC=\"`echo $CC | sed 's/-qlanglvl\\=ansi//g'`\"\n\t      CFLAGS=\"`echo $CFLAGS | sed 's/-qlanglvl\\=ansi//g'`\"\n\t      CPPFLAGS=\"`echo $CPPFLAGS | sed 's/-qlanglvl\\=ansi//g'`\"\n\t    ]\n\t)\n\n\tAC_MSG_CHECKING([how to specify blibpath for linker ($LD)])\n\tif (test -z \"$blibpath\"); then\n\t\tblibpath=\"/usr/lib:/lib\"\n\tfi\n\tsaved_LDFLAGS=\"$LDFLAGS\"\n\tif test \"$GCC\" = \"yes\"; then\n\t\tflags=\"-Wl,-blibpath: -Wl,-rpath, -blibpath:\"\n\telse\n\t\tflags=\"-blibpath: -Wl,-blibpath: -Wl,-rpath,\"\n\tfi\n\tfor tryflags in $flags ;do\n\t\tif (test -z \"$blibflags\"); then\n\t\t\tLDFLAGS=\"$saved_LDFLAGS $tryflags$blibpath\"\n\t\t\tAC_LINK_IFELSE([AC_LANG_PROGRAM([[]], [[]])],\n\t\t\t[blibflags=$tryflags], [])\n\t\tfi\n\tdone\n\tif (test -z \"$blibflags\"); then\n\t\tAC_MSG_RESULT([not found])\n\t\tAC_MSG_ERROR([*** must be able to specify blibpath on AIX - check config.log])\n\telse\n\t\tAC_MSG_RESULT([$blibflags])\n\tfi\n\tLDFLAGS=\"$saved_LDFLAGS\"\n\tdnl Check for authenticate.  Might be in libs.a on older AIXes\n\tAC_CHECK_FUNC([authenticate], [AC_DEFINE([WITH_AIXAUTHENTICATE], [1],\n\t\t[Define if you want to enable AIX4's authenticate function])],\n\t\t[AC_CHECK_LIB([s], [authenticate],\n\t\t\t[ AC_DEFINE([WITH_AIXAUTHENTICATE])\n\t\t\t\tLIBS=\"$LIBS -ls\"\n\t\t\t])\n\t\t])\n\tdnl Check for various auth function declarations in headers.\n\tAC_CHECK_DECLS([authenticate, loginrestrictions, loginsuccess,\n\t    passwdexpired, setauthdb], , , [#include <usersec.h>])\n\tdnl Check if loginfailed is declared and takes 4 arguments (AIX >= 5.2)\n\tAC_CHECK_DECLS([loginfailed],\n\t    [AC_MSG_CHECKING([if loginfailed takes 4 arguments])\n\t    AC_COMPILE_IFELSE([AC_LANG_PROGRAM([[ #include <usersec.h> ]],\n\t\t[[ (void)loginfailed(\"user\",\"host\",\"tty\",0); ]])],\n\t\t[AC_MSG_RESULT([yes])\n\t\tAC_DEFINE([AIX_LOGINFAILED_4ARG], [1],\n\t\t\t[Define if your AIX loginfailed() function\n\t\t\ttakes 4 arguments (AIX >= 5.2)])], [AC_MSG_RESULT([no])\n\t    ])],\n\t    [],\n\t    [#include <usersec.h>]\n\t)\n\tAC_CHECK_FUNCS([getgrset setauthdb])\n\tAC_CHECK_DECL([F_CLOSEM],\n\t    AC_DEFINE([HAVE_FCNTL_CLOSEM], [1], [Use F_CLOSEM fcntl for closefrom]),\n\t    [],\n\t    [ #include <limits.h>\n\t      #include <fcntl.h> ]\n\t)\n\tcheck_for_aix_broken_getaddrinfo=1\n\tAC_DEFINE([SETEUID_BREAKS_SETUID], [1],\n\t    [Define if your platform breaks doing a seteuid before a setuid])\n\tAC_DEFINE([BROKEN_SETREUID], [1], [Define if your setreuid() is broken])\n\tAC_DEFINE([BROKEN_SETREGID], [1], [Define if your setregid() is broken])\n\tdnl AIX handles lastlog as part of its login message\n\tAC_DEFINE([DISABLE_LASTLOG], [1], [Define if you don't want to use lastlog])\n\tAC_DEFINE([LOGIN_NEEDS_UTMPX], [1],\n\t\t[Some systems need a utmpx entry for /bin/login to work])\n\tAC_DEFINE([SPT_TYPE], [SPT_REUSEARGV],\n\t\t[Define to a Set Process Title type if your system is\n\t\tsupported by bsd-setproctitle.c])\n\tAC_DEFINE([SSHPAM_CHAUTHTOK_NEEDS_RUID], [1],\n\t    [AIX 5.2 and 5.3 (and presumably newer) require this])\n\tAC_DEFINE([PTY_ZEROREAD], [1], [read(1) can return 0 for a non-closed fd])\n\tAC_DEFINE([PLATFORM_SYS_DIR_UID], 2, [System dirs owned by bin (uid 2)])\n\tAC_DEFINE([BROKEN_STRNDUP], 1, [strndup broken, see APAR IY61211])\n\tAC_DEFINE([BROKEN_STRNLEN], 1, [strnlen broken, see APAR IY62551])\n\t;;\n*-*-android*)\n\tAC_DEFINE([DISABLE_UTMP], [1], [Define if you don't want to use utmp])\n\tAC_DEFINE([DISABLE_WTMP], [1], [Define if you don't want to use wtmp])\n\t;;\n*-*-cygwin*)\n\tLIBS=\"$LIBS /usr/lib/textreadmode.o\"\n\tAC_DEFINE([HAVE_CYGWIN], [1], [Define if you are on Cygwin])\n\tAC_DEFINE([USE_PIPES], [1], [Use PIPES instead of a socketpair()])\n\tAC_DEFINE([NO_UID_RESTORATION_TEST], [1],\n\t\t[Define to disable UID restoration test])\n\tAC_DEFINE([DISABLE_SHADOW], [1],\n\t\t[Define if you want to disable shadow passwords])\n\tAC_DEFINE([NO_X11_UNIX_SOCKETS], [1],\n\t\t[Define if X11 doesn't support AF_UNIX sockets on that system])\n\tAC_DEFINE([DISABLE_FD_PASSING], [1],\n\t\t[Define if your platform needs to skip post auth\n\t\tfile descriptor passing])\n\tAC_DEFINE([SSH_IOBUFSZ], [65535], [Windows is sensitive to read buffer size])\n\tAC_DEFINE([FILESYSTEM_NO_BACKSLASH], [1], [File names may not contain backslash characters])\n\t# Cygwin defines optargs, optargs as declspec(dllimport) for historical\n\t# reasons which cause compile warnings, so we disable those warnings.\n\tOSSH_CHECK_CFLAG_COMPILE([-Wno-attributes])\n\t;;\n*-*-dgux*)\n\tAC_DEFINE([IP_TOS_IS_BROKEN], [1],\n\t\t[Define if your system choked on IP TOS setting])\n\tAC_DEFINE([SETEUID_BREAKS_SETUID])\n\tAC_DEFINE([BROKEN_SETREUID])\n\tAC_DEFINE([BROKEN_SETREGID])\n\t;;\n*-*-darwin*)\n\tuse_pie=auto\n\tAC_MSG_CHECKING([if we have working getaddrinfo])\n\tAC_RUN_IFELSE([AC_LANG_SOURCE([[\n#include <mach-o/dyld.h>\n#include <stdlib.h>\nint main(void) { if (NSVersionOfRunTimeLibrary(\"System\") >= (60 << 16))\n\t\texit(0);\n\telse\n\t\texit(1);\n}\n\t\t\t]])],\n\t[AC_MSG_RESULT([working])],\n\t[AC_MSG_RESULT([buggy])\n\tAC_DEFINE([BROKEN_GETADDRINFO], [1],\n\t\t[getaddrinfo is broken (if present)])\n\t],\n\t[AC_MSG_RESULT([assume it is working])])\n\tAC_DEFINE([SETEUID_BREAKS_SETUID])\n\tAC_DEFINE([BROKEN_SETREUID])\n\tAC_DEFINE([BROKEN_SETREGID])\n\tAC_DEFINE([BROKEN_GLOB], [1], [OS X glob does not do what we expect])\n\tAC_DEFINE_UNQUOTED([BIND_8_COMPAT], [1],\n\t\t[Define if your resolver libs need this for getrrsetbyname])\n\tAC_DEFINE([SSH_TUN_FREEBSD], [1], [Open tunnel devices the FreeBSD way])\n\tAC_DEFINE([SSH_TUN_COMPAT_AF], [1],\n\t    [Use tunnel device compatibility to OpenBSD])\n\tAC_DEFINE([SSH_TUN_PREPEND_AF], [1],\n\t    [Prepend the address family to IP tunnel traffic])\n\tm4_pattern_allow([AU_IPv])\n\tAC_CHECK_DECL([AU_IPv4], [],\n\t    AC_DEFINE([AU_IPv4], [0], [System only supports IPv4 audit records])\n\t    [#include <bsm/audit.h>]\n\tAC_DEFINE([LASTLOG_WRITE_PUTUTXLINE], [1],\n\t    [Define if pututxline updates lastlog too])\n\t)\n\tAC_DEFINE([SPT_TYPE], [SPT_REUSEARGV],\n\t\t[Define to a Set Process Title type if your system is\n\t\tsupported by bsd-setproctitle.c])\n\tAC_CHECK_FUNCS([sandbox_init])\n\tAC_CHECK_HEADERS([sandbox.h])\n\tAC_CHECK_LIB([sandbox], [sandbox_apply], [\n\t    SSHDLIBS=\"$SSHDLIBS -lsandbox\"\n\t])\n\t# proc_pidinfo()-based closefrom() replacement.\n\tAC_CHECK_HEADERS([libproc.h])\n\tAC_CHECK_FUNCS([proc_pidinfo])\n\t# poll(2) is broken for character-special devices (at least).\n\t# cf. Apple bug 3710161 (not public, but searchable)\n\tAC_DEFINE([BROKEN_POLL], [1],\n\t    [System poll(2) implementation is broken])\n\t;;\n*-*-dragonfly*)\n\tSSHDLIBS=\"$SSHDLIBS\"\n\tTEST_MALLOC_OPTIONS=\"AFGJPRX\"\n\t;;\n*-*-haiku*)\n\tLIBS=\"$LIBS -lbsd \"\n\tCFLAGS=\"$CFLAGS -D_BSD_SOURCE\"\n\tAC_CHECK_LIB([network], [socket])\n\tAC_DEFINE([HAVE_U_INT64_T])\n\tAC_DEFINE([DISABLE_UTMPX], [1], [no utmpx])\n\tMANTYPE=man\n\t;;\n*-*-hpux*)\n\t# first we define all of the options common to all HP-UX releases\n\tCPPFLAGS=\"$CPPFLAGS -D_HPUX_SOURCE -D_XOPEN_SOURCE -D_XOPEN_SOURCE_EXTENDED=1\"\n\tIPADDR_IN_DISPLAY=yes\n\tAC_DEFINE([USE_PIPES])\n\tAC_DEFINE([LOGIN_NEEDS_UTMPX])\n\tAC_DEFINE([LOCKED_PASSWD_STRING], [\"*\"],\n\t\t[String used in /etc/passwd to denote locked account])\n\tAC_DEFINE([SPT_TYPE], [SPT_PSTAT])\n\tAC_DEFINE([PLATFORM_SYS_DIR_UID], 2, [System dirs owned by bin (uid 2)])\n\tmaildir=\"/var/mail\"\n\tLIBS=\"$LIBS -lsec\"\n\tAC_CHECK_LIB([xnet], [t_error], ,\n\t    [AC_MSG_ERROR([*** -lxnet needed on HP-UX - check config.log ***])])\n\n\t# next, we define all of the options specific to major releases\n\tcase \"$host\" in\n\t*-*-hpux10*)\n\t\tif test -z \"$GCC\"; then\n\t\t\tCFLAGS=\"$CFLAGS -Ae\"\n\t\tfi\n\t\tAC_DEFINE([BROKEN_GETLINE], [1], [getline is not what we expect])\n\t\t;;\n\t*-*-hpux11*)\n\t\tAC_DEFINE([PAM_SUN_CODEBASE], [1],\n\t\t\t[Define if you are using Solaris-derived PAM which\n\t\t\tpasses pam_messages to the conversation function\n\t\t\twith an extra level of indirection])\n\t\tAC_DEFINE([DISABLE_UTMP], [1],\n\t\t\t[Define if you don't want to use utmp])\n\t\tAC_DEFINE([USE_BTMP], [1], [Use btmp to log bad logins])\n\t\tcheck_for_hpux_broken_getaddrinfo=1\n\t\tcheck_for_conflicting_getspnam=1\n\t\t;;\n\tesac\n\n\t# lastly, we define options specific to minor releases\n\tcase \"$host\" in\n\t*-*-hpux10.26)\n\t\tAC_DEFINE([HAVE_SECUREWARE], [1],\n\t\t\t[Define if you have SecureWare-based\n\t\t\tprotected password database])\n\t\tdisable_ptmx_check=yes\n\t\tLIBS=\"$LIBS -lsecpw\"\n\t\t;;\n\tesac\n\t;;\n*-*-irix5*)\n\tPATH=\"$PATH:/usr/etc\"\n\tAC_DEFINE([BROKEN_INET_NTOA], [1],\n\t\t[Define if you system's inet_ntoa is busted\n\t\t(e.g. Irix gcc issue)])\n\tAC_DEFINE([SETEUID_BREAKS_SETUID])\n\tAC_DEFINE([BROKEN_SETREUID])\n\tAC_DEFINE([BROKEN_SETREGID])\n\tAC_DEFINE([WITH_ABBREV_NO_TTY], [1],\n\t\t[Define if you shouldn't strip 'tty' from your\n\t\tttyname in [uw]tmp])\n\tAC_DEFINE([LOCKED_PASSWD_STRING], [\"*LK*\"])\n\t;;\n*-*-irix6*)\n\tPATH=\"$PATH:/usr/etc\"\n\tAC_DEFINE([WITH_IRIX_ARRAY], [1],\n\t\t[Define if you have/want arrays\n\t\t(cluster-wide session management, not C arrays)])\n\tAC_DEFINE([WITH_IRIX_PROJECT], [1],\n\t\t[Define if you want IRIX project management])\n\tAC_DEFINE([WITH_IRIX_AUDIT], [1],\n\t\t[Define if you want IRIX audit trails])\n\tAC_CHECK_FUNC([jlimit_startjob], [AC_DEFINE([WITH_IRIX_JOBS], [1],\n\t\t[Define if you want IRIX kernel jobs])])\n\tAC_DEFINE([BROKEN_INET_NTOA])\n\tAC_DEFINE([SETEUID_BREAKS_SETUID])\n\tAC_DEFINE([BROKEN_SETREUID])\n\tAC_DEFINE([BROKEN_SETREGID])\n\tAC_DEFINE([BROKEN_UPDWTMPX], [1], [updwtmpx is broken (if present)])\n\tAC_DEFINE([WITH_ABBREV_NO_TTY])\n\tAC_DEFINE([LOCKED_PASSWD_STRING], [\"*LK*\"])\n\t;;\n*-*-k*bsd*-gnu | *-*-kopensolaris*-gnu)\n\tAC_DEFINE([PAM_TTY_KLUDGE])\n\tAC_DEFINE([LOCKED_PASSWD_PREFIX], [\"!\"])\n\tAC_DEFINE([SPT_TYPE], [SPT_REUSEARGV])\n\tAC_DEFINE([_PATH_BTMP], [\"/var/log/btmp\"], [log for bad login attempts])\n\tAC_DEFINE([USE_BTMP], [1], [Use btmp to log bad logins])\n\t;;\n*-*-linux*)\n\tno_dev_ptmx=1\n\tuse_pie=auto\n\tcheck_for_openpty_ctty_bug=1\n\tdnl Target SUSv3/POSIX.1-2001 plus BSD specifics.\n\tdnl _DEFAULT_SOURCE is the new name for _BSD_SOURCE\n\tdnl _GNU_SOURCE is needed for setres*id prototypes.\n\tCPPFLAGS=\"$CPPFLAGS -D_XOPEN_SOURCE=600 -D_BSD_SOURCE -D_DEFAULT_SOURCE -D_GNU_SOURCE\"\n\tAC_DEFINE([BROKEN_CLOSEFROM], [1], [broken in chroots on older kernels])\n\tAC_DEFINE([PAM_TTY_KLUDGE], [1],\n\t\t[Work around problematic Linux PAM modules handling of PAM_TTY])\n\tAC_DEFINE([LOCKED_PASSWD_PREFIX], [\"!\"],\n\t\t[String used in /etc/passwd to denote locked account])\n\tAC_DEFINE([SPT_TYPE], [SPT_REUSEARGV])\n\tAC_DEFINE([LINK_OPNOTSUPP_ERRNO], [EPERM],\n\t\t[Define to whatever link() returns for \"not supported\"\n\t\tif it doesn't return EOPNOTSUPP.])\n\tAC_DEFINE([_PATH_BTMP], [\"/var/log/btmp\"], [log for bad login attempts])\n\tAC_DEFINE([USE_BTMP])\n\tAC_DEFINE([LINUX_OOM_ADJUST], [1], [Adjust Linux out-of-memory killer])\n\tinet6_default_4in6=yes\n\tcase `uname -r` in\n\t1.*|2.0.*)\n\t\tAC_DEFINE([BROKEN_CMSG_TYPE], [1],\n\t\t\t[Define if cmsg_type is not passed correctly])\n\t\t;;\n\tesac\n\t# tun(4) forwarding compat code\n\tAC_CHECK_HEADERS([linux/if_tun.h])\n\tif test \"x$ac_cv_header_linux_if_tun_h\" = \"xyes\" ; then\n\t\tAC_DEFINE([SSH_TUN_LINUX], [1],\n\t\t    [Open tunnel devices the Linux tun/tap way])\n\t\tAC_DEFINE([SSH_TUN_COMPAT_AF], [1],\n\t\t    [Use tunnel device compatibility to OpenBSD])\n\t\tAC_DEFINE([SSH_TUN_PREPEND_AF], [1],\n\t\t    [Prepend the address family to IP tunnel traffic])\n\tfi\n\tAC_CHECK_HEADER([linux/if.h],\n\t    AC_DEFINE([SYS_RDOMAIN_LINUX], [1],\n\t\t[Support routing domains using Linux VRF]), [], [\n#ifdef HAVE_SYS_TYPES_H\n# include <sys/types.h>\n#endif\n\t    ])\n\tAC_CHECK_HEADERS([linux/seccomp.h linux/filter.h linux/audit.h], [],\n\t    [], [#include <linux/types.h>])\n\t# Obtain MIPS ABI\n\tcase \"$host\" in\n\tmips*)\n\t\tAC_COMPILE_IFELSE([AC_LANG_PROGRAM([[\n#if _MIPS_SIM != _ABIO32\n#error\n#endif\n\t\t\t]])],[mips_abi=\"o32\"],[AC_COMPILE_IFELSE([AC_LANG_PROGRAM([[\n#if _MIPS_SIM != _ABIN32\n#error\n#endif\n\t\t\t\t]])],[mips_abi=\"n32\"],[AC_COMPILE_IFELSE([AC_LANG_PROGRAM([[\n#if _MIPS_SIM != _ABI64\n#error\n#endif\n\t\t\t\t\t]])],[mips_abi=\"n64\"],[AC_MSG_ERROR([unknown MIPS ABI])\n\t\t\t\t])\n\t\t\t])\n\t\t])\n\t\t;;\n\tesac\n\tAC_MSG_CHECKING([for seccomp architecture])\n\tseccomp_audit_arch=\n\tcase \"$host\" in\n\tx86_64-*)\n\t\tseccomp_audit_arch=AUDIT_ARCH_X86_64\n\t\t;;\n\ti*86-*)\n\t\tseccomp_audit_arch=AUDIT_ARCH_I386\n\t\t;;\n\tarm*-*)\n\t\tseccomp_audit_arch=AUDIT_ARCH_ARM\n\t\t;;\n\taarch64*-*)\n\t\tseccomp_audit_arch=AUDIT_ARCH_AARCH64\n\t\t;;\n\ts390x-*)\n\t\tseccomp_audit_arch=AUDIT_ARCH_S390X\n\t\t;;\n\ts390-*)\n\t\tseccomp_audit_arch=AUDIT_ARCH_S390\n\t\t;;\n\tpowerpc-*)\n\t\tseccomp_audit_arch=AUDIT_ARCH_PPC\n\t\t;;\n\tpowerpc64-*)\n\t\tseccomp_audit_arch=AUDIT_ARCH_PPC64\n\t\t;;\n\tpowerpc64le-*)\n\t\tseccomp_audit_arch=AUDIT_ARCH_PPC64LE\n\t\t;;\n\tmips-*)\n\t\tseccomp_audit_arch=AUDIT_ARCH_MIPS\n\t\t;;\n\tmipsel-*)\n\t\tseccomp_audit_arch=AUDIT_ARCH_MIPSEL\n\t\t;;\n\tmips64-*)\n\t\tcase \"$mips_abi\" in\n\t\t\"n32\")\n\t\t\tseccomp_audit_arch=AUDIT_ARCH_MIPS64N32\n\t\t\t;;\n\t\t\"n64\")\n\t\t\tseccomp_audit_arch=AUDIT_ARCH_MIPS64\n\t\t\t;;\n\t\tesac\n\t\t;;\n\tmips64el-*)\n\t\tcase \"$mips_abi\" in\n\t\t\"n32\")\n\t\t\tseccomp_audit_arch=AUDIT_ARCH_MIPSEL64N32\n\t\t\t;;\n\t\t\"n64\")\n\t\t\tseccomp_audit_arch=AUDIT_ARCH_MIPSEL64\n\t\t\t;;\n\t\tesac\n\t\t;;\n\triscv64-*)\n\t\tseccomp_audit_arch=AUDIT_ARCH_RISCV64\n\t\t;;\n\tesac\n\tif test \"x$seccomp_audit_arch\" != \"x\" ; then\n\t\tAC_MSG_RESULT([\"$seccomp_audit_arch\"])\n\t\tAC_DEFINE_UNQUOTED([SECCOMP_AUDIT_ARCH], [$seccomp_audit_arch],\n\t\t    [Specify the system call convention in use])\n\telse\n\t\tAC_MSG_RESULT([architecture not supported])\n\tfi\n\t;;\n*-*-minix)\n\tAC_DEFINE([SETEUID_BREAKS_SETUID])\n\t# poll(2) seems to choke on /dev/null; \"Bad file descriptor\"\n\tAC_DEFINE([BROKEN_POLL], [1],\n\t    [System poll(2) implementation is broken])\n\t;;\nmips-sony-bsd|mips-sony-newsos4)\n\tAC_DEFINE([NEED_SETPGRP], [1], [Need setpgrp to acquire controlling tty])\n\tSONY=1\n\t;;\n*-*-netbsd*)\n\tif test \"x$withval\" != \"xno\" ; then\n\t\trpath_opt=\"-R\"\n\tfi\n\tCPPFLAGS=\"$CPPFLAGS -D_OPENBSD_SOURCE\"\n\tAC_DEFINE([SSH_TUN_FREEBSD], [1], [Open tunnel devices the FreeBSD way])\n\tAC_CHECK_HEADER([net/if_tap.h], ,\n\t    AC_DEFINE([SSH_TUN_NO_L2], [1], [No layer 2 tunnel support]))\n\tAC_DEFINE([SSH_TUN_PREPEND_AF], [1],\n\t    [Prepend the address family to IP tunnel traffic])\n\tTEST_MALLOC_OPTIONS=\"AJRX\"\n\tAC_DEFINE([BROKEN_READ_COMPARISON], [1],\n\t    [NetBSD read function is sometimes redirected, breaking atomicio comparisons against it])\n\t;;\n*-*-freebsd*)\n\tAC_DEFINE([LOCKED_PASSWD_PREFIX], [\"*LOCKED*\"], [Account locked with pw(1)])\n\tAC_DEFINE([SSH_TUN_FREEBSD], [1], [Open tunnel devices the FreeBSD way])\n\tAC_CHECK_HEADER([net/if_tap.h], ,\n\t    AC_DEFINE([SSH_TUN_NO_L2], [1], [No layer 2 tunnel support]))\n\tAC_DEFINE([BROKEN_GLOB], [1], [FreeBSD glob does not do what we need])\n\tTEST_MALLOC_OPTIONS=\"AJRX\"\n\t# Preauth crypto occasionally uses file descriptors for crypto offload\n\t# and will crash if they cannot be opened.\n\tAC_DEFINE([SANDBOX_SKIP_RLIMIT_NOFILE], [1],\n\t    [define if setrlimit RLIMIT_NOFILE breaks things])\n\tcase \"$host\" in\n\t*-*-freebsd9.*|*-*-freebsd10.*)\n\t\t# Capsicum on 9 and 10 do not allow ppoll() so don't auto-enable.\n\t\tdisable_capsicum=yes\n\tesac\n\t;;\n*-*-bsdi*)\n\tAC_DEFINE([SETEUID_BREAKS_SETUID])\n\tAC_DEFINE([BROKEN_SETREUID])\n\tAC_DEFINE([BROKEN_SETREGID])\n\t;;\n*-next-*)\n\tconf_lastlog_location=\"/usr/adm/lastlog\"\n\tconf_utmp_location=/etc/utmp\n\tconf_wtmp_location=/usr/adm/wtmp\n\tmaildir=/usr/spool/mail\n\tAC_DEFINE([HAVE_NEXT], [1], [Define if you are on NeXT])\n\tAC_DEFINE([USE_PIPES])\n\tAC_DEFINE([BROKEN_SAVED_UIDS], [1], [Needed for NeXT])\n\t;;\n*-*-openbsd*)\n\tuse_pie=auto\n\tAC_DEFINE([HAVE_ATTRIBUTE__SENTINEL__], [1], [OpenBSD's gcc has sentinel])\n\tAC_DEFINE([HAVE_ATTRIBUTE__BOUNDED__], [1], [OpenBSD's gcc has bounded])\n\tAC_DEFINE([SSH_TUN_OPENBSD], [1], [Open tunnel devices the OpenBSD way])\n\tAC_DEFINE([SYSLOG_R_SAFE_IN_SIGHAND], [1],\n\t    [syslog_r function is safe to use in in a signal handler])\n\tTEST_MALLOC_OPTIONS=\"AFGJPRX\"\n\t;;\n*-*-solaris*)\n\tif test \"x$withval\" != \"xno\" ; then\n\t\trpath_opt=\"-R\"\n\tfi\n\tAC_DEFINE([PAM_SUN_CODEBASE])\n\tAC_DEFINE([LOGIN_NEEDS_UTMPX])\n\tAC_DEFINE([PAM_TTY_KLUDGE])\n\tAC_DEFINE([SSHPAM_CHAUTHTOK_NEEDS_RUID], [1],\n\t\t[Define if pam_chauthtok wants real uid set\n\t\tto the unpriv'ed user])\n\tAC_DEFINE([LOCKED_PASSWD_STRING], [\"*LK*\"])\n\t# Pushing STREAMS modules will cause sshd to acquire a controlling tty.\n\tAC_DEFINE([SSHD_ACQUIRES_CTTY], [1],\n\t\t[Define if sshd somehow reacquires a controlling TTY\n\t\tafter setsid()])\n\tAC_DEFINE([PASSWD_NEEDS_USERNAME], [1], [must supply username to passwd\n\t\tin case the name is longer than 8 chars])\n\tAC_DEFINE([BROKEN_TCGETATTR_ICANON], [1], [tcgetattr with ICANON may hang])\n\texternal_path_file=/etc/default/login\n\t# hardwire lastlog location (can't detect it on some versions)\n\tconf_lastlog_location=\"/var/adm/lastlog\"\n\tAC_MSG_CHECKING([for obsolete utmp and wtmp in solaris2.x])\n\tsol2ver=`echo \"$host\"| sed -e 's/.*[[0-9]]\\.//'`\n\tif test \"$sol2ver\" -ge 8; then\n\t\tAC_MSG_RESULT([yes])\n\t\tAC_DEFINE([DISABLE_UTMP])\n\t\tAC_DEFINE([DISABLE_WTMP], [1],\n\t\t\t[Define if you don't want to use wtmp])\n\telse\n\t\tAC_MSG_RESULT([no])\n\tfi\n\tAC_CHECK_FUNCS([setpflags])\n\tAC_CHECK_FUNCS([setppriv])\n\tAC_CHECK_FUNCS([priv_basicset])\n\tAC_CHECK_HEADERS([priv.h])\n\tAC_ARG_WITH([solaris-contracts],\n\t\t[  --with-solaris-contracts Enable Solaris process contracts (experimental)],\n\t\t[\n\t\tAC_CHECK_LIB([contract], [ct_tmpl_activate],\n\t\t\t[ AC_DEFINE([USE_SOLARIS_PROCESS_CONTRACTS], [1],\n\t\t\t\t[Define if you have Solaris process contracts])\n\t\t\t  LIBS=\"$LIBS -lcontract\"\n\t\t\t  SPC_MSG=\"yes\" ], )\n\t\t],\n\t)\n\tAC_ARG_WITH([solaris-projects],\n\t\t[  --with-solaris-projects Enable Solaris projects (experimental)],\n\t\t[\n\t\tAC_CHECK_LIB([project], [setproject],\n\t\t\t[ AC_DEFINE([USE_SOLARIS_PROJECTS], [1],\n\t\t\t\t[Define if you have Solaris projects])\n\t\t\tLIBS=\"$LIBS -lproject\"\n\t\t\tSP_MSG=\"yes\" ], )\n\t\t],\n\t)\n\tAC_ARG_WITH([solaris-privs],\n\t\t[  --with-solaris-privs    Enable Solaris/Illumos privileges (experimental)],\n\t\t[\n\t\tAC_MSG_CHECKING([for Solaris/Illumos privilege support])\n\t\tif test \"x$ac_cv_func_setppriv\" = \"xyes\" -a \\\n\t\t\t\"x$ac_cv_header_priv_h\" = \"xyes\" ; then\n\t\t\tSOLARIS_PRIVS=yes\n\t\t\tAC_MSG_RESULT([found])\n\t\t\tAC_DEFINE([NO_UID_RESTORATION_TEST], [1],\n\t\t\t\t[Define to disable UID restoration test])\n\t\t\tAC_DEFINE([USE_SOLARIS_PRIVS], [1],\n\t\t\t\t[Define if you have Solaris privileges])\n\t\t\tSPP_MSG=\"yes\"\n\t\telse\n\t\t\tAC_MSG_RESULT([not found])\n\t\t\tAC_MSG_ERROR([*** must have support for Solaris privileges to use --with-solaris-privs])\n\t\tfi\n\t\t],\n\t)\n\tTEST_SHELL=$SHELL\t# let configure find us a capable shell\n\t;;\n*-*-sunos4*)\n\tCPPFLAGS=\"$CPPFLAGS -DSUNOS4\"\n\tAC_CHECK_FUNCS([getpwanam])\n\tAC_DEFINE([PAM_SUN_CODEBASE])\n\tconf_utmp_location=/etc/utmp\n\tconf_wtmp_location=/var/adm/wtmp\n\tconf_lastlog_location=/var/adm/lastlog\n\tAC_DEFINE([USE_PIPES])\n\tAC_DEFINE([DISABLE_UTMPX], [1], [no utmpx])\n\t;;\n*-ncr-sysv*)\n\tLIBS=\"$LIBS -lc89\"\n\tAC_DEFINE([USE_PIPES])\n\tAC_DEFINE([SSHD_ACQUIRES_CTTY])\n\tAC_DEFINE([SETEUID_BREAKS_SETUID])\n\tAC_DEFINE([BROKEN_SETREUID])\n\tAC_DEFINE([BROKEN_SETREGID])\n\t;;\n*-sni-sysv*)\n\t# /usr/ucblib MUST NOT be searched on ReliantUNIX\n\tAC_CHECK_LIB([dl], [dlsym], ,)\n\t# -lresolv needs to be at the end of LIBS or DNS lookups break\n\tAC_CHECK_LIB([resolv], [res_query], [ LIBS=\"$LIBS -lresolv\" ])\n\tIPADDR_IN_DISPLAY=yes\n\tAC_DEFINE([USE_PIPES])\n\tAC_DEFINE([IP_TOS_IS_BROKEN])\n\tAC_DEFINE([SETEUID_BREAKS_SETUID])\n\tAC_DEFINE([BROKEN_SETREUID])\n\tAC_DEFINE([BROKEN_SETREGID])\n\tAC_DEFINE([SSHD_ACQUIRES_CTTY])\n\texternal_path_file=/etc/default/login\n\t# /usr/ucblib/libucb.a no longer needed on ReliantUNIX\n\t# Attention: always take care to bind libsocket and libnsl before libc,\n\t# otherwise you will find lots of \"SIOCGPGRP errno 22\" on syslog\n\t;;\n# UnixWare 1.x, UnixWare 2.x, and others based on code from Univel.\n*-*-sysv4.2*)\n\tAC_DEFINE([USE_PIPES])\n\tAC_DEFINE([SETEUID_BREAKS_SETUID])\n\tAC_DEFINE([BROKEN_SETREUID])\n\tAC_DEFINE([BROKEN_SETREGID])\n\tAC_DEFINE([PASSWD_NEEDS_USERNAME], [1], [must supply username to passwd])\n\tAC_DEFINE([LOCKED_PASSWD_STRING], [\"*LK*\"])\n\tTEST_SHELL=$SHELL\t# let configure find us a capable shell\n\t;;\n# UnixWare 7.x, OpenUNIX 8\n*-*-sysv5*)\n\tCPPFLAGS=\"$CPPFLAGS -Dvsnprintf=_xvsnprintf -Dsnprintf=_xsnprintf\"\n\tAC_DEFINE([UNIXWARE_LONG_PASSWORDS], [1], [Support passwords > 8 chars])\n\tAC_DEFINE([USE_PIPES])\n\tAC_DEFINE([SETEUID_BREAKS_SETUID])\n\tAC_DEFINE([BROKEN_GETADDRINFO])\n\tAC_DEFINE([BROKEN_SETREUID])\n\tAC_DEFINE([BROKEN_SETREGID])\n\tAC_DEFINE([PASSWD_NEEDS_USERNAME])\n\tAC_DEFINE([BROKEN_TCGETATTR_ICANON])\n\tTEST_SHELL=$SHELL\t# let configure find us a capable shell\n\tcase \"$host\" in\n\t*-*-sysv5SCO_SV*)\t# SCO OpenServer 6.x\n\t\tmaildir=/var/spool/mail\n\t\tAC_DEFINE([BROKEN_UPDWTMPX])\n\t\tAC_CHECK_LIB([prot], [getluid], [ LIBS=\"$LIBS -lprot\"\n\t\t\tAC_CHECK_FUNCS([getluid setluid], , , [-lprot])\n\t\t\t], , )\n\t\t;;\n\t*)\tAC_DEFINE([LOCKED_PASSWD_STRING], [\"*LK*\"])\n\t\t;;\n\tesac\n\t;;\n*-*-sysv*)\n\t;;\n# SCO UNIX and OEM versions of SCO UNIX\n*-*-sco3.2v4*)\n\tAC_MSG_ERROR(\"This Platform is no longer supported.\")\n\t;;\n# SCO OpenServer 5.x\n*-*-sco3.2v5*)\n\tif test -z \"$GCC\"; then\n\t\tCFLAGS=\"$CFLAGS -belf\"\n\tfi\n\tLIBS=\"$LIBS -lprot -lx -ltinfo -lm\"\n\tno_dev_ptmx=1\n\tAC_DEFINE([USE_PIPES])\n\tAC_DEFINE([HAVE_SECUREWARE])\n\tAC_DEFINE([DISABLE_SHADOW])\n\tAC_DEFINE([DISABLE_FD_PASSING])\n\tAC_DEFINE([SETEUID_BREAKS_SETUID])\n\tAC_DEFINE([BROKEN_GETADDRINFO])\n\tAC_DEFINE([BROKEN_SETREUID])\n\tAC_DEFINE([BROKEN_SETREGID])\n\tAC_DEFINE([WITH_ABBREV_NO_TTY])\n\tAC_DEFINE([BROKEN_UPDWTMPX])\n\tAC_DEFINE([PASSWD_NEEDS_USERNAME])\n\tAC_CHECK_FUNCS([getluid setluid])\n\tMANTYPE=man\n\tTEST_SHELL=$SHELL\t# let configure find us a capable shell\n\tSKIP_DISABLE_LASTLOG_DEFINE=yes\n\t;;\n*-dec-osf*)\n\tAC_MSG_CHECKING([for Digital Unix SIA])\n\tno_osfsia=\"\"\n\tAC_ARG_WITH([osfsia],\n\t\t[  --with-osfsia           Enable Digital Unix SIA],\n\t\t[\n\t\t\tif test \"x$withval\" = \"xno\" ; then\n\t\t\t\tAC_MSG_RESULT([disabled])\n\t\t\t\tno_osfsia=1\n\t\t\tfi\n\t\t],\n\t)\n\tif test -z \"$no_osfsia\" ; then\n\t\tif test -f /etc/sia/matrix.conf; then\n\t\t\tAC_MSG_RESULT([yes])\n\t\t\tAC_DEFINE([HAVE_OSF_SIA], [1],\n\t\t\t\t[Define if you have Digital Unix Security\n\t\t\t\tIntegration Architecture])\n\t\t\tAC_DEFINE([DISABLE_LOGIN], [1],\n\t\t\t\t[Define if you don't want to use your\n\t\t\t\tsystem's login() call])\n\t\t\tAC_DEFINE([DISABLE_FD_PASSING])\n\t\t\tLIBS=\"$LIBS -lsecurity -ldb -lm -laud\"\n\t\t\tSIA_MSG=\"yes\"\n\t\telse\n\t\t\tAC_MSG_RESULT([no])\n\t\t\tAC_DEFINE([LOCKED_PASSWD_SUBSTR], [\"Nologin\"],\n\t\t\t  [String used in /etc/passwd to denote locked account])\n\t\tfi\n\tfi\n\tAC_DEFINE([BROKEN_GETADDRINFO])\n\tAC_DEFINE([SETEUID_BREAKS_SETUID])\n\tAC_DEFINE([BROKEN_SETREUID])\n\tAC_DEFINE([BROKEN_SETREGID])\n\tAC_DEFINE([BROKEN_READV_COMPARISON], [1], [Can't do comparisons on readv])\n\t;;\n\n*-*-nto-qnx*)\n\tAC_DEFINE([USE_PIPES])\n\tAC_DEFINE([NO_X11_UNIX_SOCKETS])\n\tAC_DEFINE([DISABLE_LASTLOG])\n\tAC_DEFINE([SSHD_ACQUIRES_CTTY])\n\tAC_DEFINE([BROKEN_SHADOW_EXPIRE], [1], [QNX shadow support is broken])\n\tenable_etc_default_login=no\t# has incompatible /etc/default/login\n\tcase \"$host\" in\n\t*-*-nto-qnx6*)\n\t\tAC_DEFINE([DISABLE_FD_PASSING])\n\t\t;;\n\tesac\n\t;;\n\n*-*-ultrix*)\n\tAC_DEFINE([BROKEN_GETGROUPS], [1], [getgroups(0,NULL) will return -1])\n\tAC_DEFINE([NEED_SETPGRP], [1], [Need setpgrp to for controlling tty])\n\tAC_DEFINE([HAVE_SYS_SYSLOG_H], [1], [Force use of sys/syslog.h on Ultrix])\n\tAC_DEFINE([DISABLE_UTMPX], [1], [Disable utmpx])\n\t# DISABLE_FD_PASSING so that we call setpgrp as root, otherwise we\n\t# don't get a controlling tty.\n\tAC_DEFINE([DISABLE_FD_PASSING], [1], [Need to call setpgrp as root])\n\t# On Ultrix some headers are not protected against multiple includes,\n\t# so we create wrappers and put it where the compiler will find it.\n\tAC_MSG_WARN([creating compat wrappers for headers])\n\tmkdir -p netinet\n\tfor header in netinet/ip.h netdb.h resolv.h; do\n\t\tname=`echo $header | tr 'a-z/.' 'A-Z__'`\n\t\tcat >$header <<EOD\n#ifndef _SSH_COMPAT_${name}\n#define _SSH_COMPAT_${name}\n#include \"/usr/include/${header}\"\n#endif\nEOD\n\tdone\n\t;;\n\n*-*-lynxos)\n\tCFLAGS=\"$CFLAGS -D__NO_INCLUDE_WARN__\"\n\tAC_DEFINE([BROKEN_SETVBUF], [1],\n\t    [LynxOS has broken setvbuf() implementation])\n\t;;\nesac\n\nAC_MSG_CHECKING([compiler and flags for sanity])\nAC_RUN_IFELSE([AC_LANG_PROGRAM([[ #include <stdlib.h> ]], [[ exit(0); ]])],\n\t[\tAC_MSG_RESULT([yes]) ],\n\t[\n\t\tAC_MSG_RESULT([no])\n\t\tAC_MSG_ERROR([*** compiler cannot create working executables, check config.log ***])\n\t],\n\t[\tAC_MSG_WARN([cross compiling: not checking compiler sanity]) ]\n)\n\ndnl Checks for header files.\n# Checks for libraries.\nAC_CHECK_FUNC([setsockopt], , [AC_CHECK_LIB([socket], [setsockopt])])\n\ndnl IRIX and Solaris 2.5.1 have dirname() in libgen\nAC_CHECK_FUNCS([dirname], [AC_CHECK_HEADERS([libgen.h])] , [\n\tAC_CHECK_LIB([gen], [dirname], [\n\t\tAC_CACHE_CHECK([for broken dirname],\n\t\t\tac_cv_have_broken_dirname, [\n\t\t\tsave_LIBS=\"$LIBS\"\n\t\t\tLIBS=\"$LIBS -lgen\"\n\t\t\tAC_RUN_IFELSE(\n\t\t\t\t[AC_LANG_SOURCE([[\n#include <libgen.h>\n#include <string.h>\n#include <stdlib.h>\n\nint main(int argc, char **argv) {\n    char *s, buf[32];\n\n    strncpy(buf,\"/etc\", 32);\n    s = dirname(buf);\n    if (!s || strncmp(s, \"/\", 32) != 0) {\n\texit(1);\n    } else {\n\texit(0);\n    }\n}\n\t\t\t\t]])],\n\t\t\t\t[ ac_cv_have_broken_dirname=\"no\" ],\n\t\t\t\t[ ac_cv_have_broken_dirname=\"yes\" ],\n\t\t\t\t[ ac_cv_have_broken_dirname=\"no\" ],\n\t\t\t)\n\t\t\tLIBS=\"$save_LIBS\"\n\t\t])\n\t\tif test \"x$ac_cv_have_broken_dirname\" = \"xno\" ; then\n\t\t\tLIBS=\"$LIBS -lgen\"\n\t\t\tAC_DEFINE([HAVE_DIRNAME])\n\t\t\tAC_CHECK_HEADERS([libgen.h])\n\t\tfi\n\t])\n])\n\nAC_CHECK_FUNC([getspnam], ,\n\t[AC_CHECK_LIB([gen], [getspnam], [LIBS=\"$LIBS -lgen\"])])\nAC_SEARCH_LIBS([basename], [gen], [AC_DEFINE([HAVE_BASENAME], [1],\n\t[Define if you have the basename function.])])\n\ndnl zlib defaults to enabled\nzlib=yes\nAC_ARG_WITH([zlib],\n\t[  --with-zlib=PATH        Use zlib in PATH],\n\t[ if test \"x$withval\" = \"xno\" ; then\n\t\tzlib=no\n\t  elif test \"x$withval\" != \"xyes\"; then\n\t\tif test -d \"$withval/lib\"; then\n\t\t\tif test -n \"${rpath_opt}\"; then\n\t\t\t\tLDFLAGS=\"-L${withval}/lib ${rpath_opt}${withval}/lib ${LDFLAGS}\"\n\t\t\telse\n\t\t\t\tLDFLAGS=\"-L${withval}/lib ${LDFLAGS}\"\n\t\t\tfi\n\t\telse\n\t\t\tif test -n \"${rpath_opt}\"; then\n\t\t\t\tLDFLAGS=\"-L${withval} ${rpath_opt}${withval} ${LDFLAGS}\"\n\t\t\telse\n\t\t\t\tLDFLAGS=\"-L${withval} ${LDFLAGS}\"\n\t\t\tfi\n\t\tfi\n\t\tif test -d \"$withval/include\"; then\n\t\t\tCPPFLAGS=\"-I${withval}/include ${CPPFLAGS}\"\n\t\telse\n\t\t\tCPPFLAGS=\"-I${withval} ${CPPFLAGS}\"\n\t\tfi\n\tfi ]\n)\n\n# These libraries are needed for anything that links in the channel code.\nCHANNELLIBS=\"\"\nAC_MSG_CHECKING([for zlib])\nif test \"x${zlib}\" = \"xno\"; then\n\tAC_MSG_RESULT([no])\nelse\n    saved_LIBS=\"$LIBS\"\n    CHANNELLIBS=\"$CHANNELLIBS -lz\"\n    AC_MSG_RESULT([yes])\n    AC_DEFINE([WITH_ZLIB], [1], [Enable zlib])\n    AC_CHECK_HEADER([zlib.h], ,[AC_MSG_ERROR([*** zlib.h missing - please install first or check config.log ***])])\n    AC_CHECK_LIB([z], [deflate], [],\n\t[\n\t\tsaved_CPPFLAGS=\"$CPPFLAGS\"\n\t\tsaved_LDFLAGS=\"$LDFLAGS\"\n\t\tdnl Check default zlib install dir\n\t\tif test -n \"${rpath_opt}\"; then\n\t\t\tLDFLAGS=\"-L/usr/local/lib ${rpath_opt}/usr/local/lib ${saved_LDFLAGS}\"\n\t\telse\n\t\t\tLDFLAGS=\"-L/usr/local/lib ${saved_LDFLAGS}\"\n\t\tfi\n\t\tCPPFLAGS=\"-I/usr/local/include ${saved_CPPFLAGS}\"\n\t\tAC_TRY_LINK_FUNC([deflate], [AC_DEFINE([HAVE_LIBZ])],\n\t\t\t[\n\t\t\t\tAC_MSG_ERROR([*** zlib missing - please install first or check config.log ***])\n\t\t\t]\n\t\t)\n\t]\n    )\n\n    AC_ARG_WITH([zlib-version-check],\n\t[  --without-zlib-version-check Disable zlib version check],\n\t[  if test \"x$withval\" = \"xno\" ; then\n\t\tzlib_check_nonfatal=1\n\t   fi\n\t]\n    )\n\n    AC_MSG_CHECKING([for possibly buggy zlib])\n    AC_RUN_IFELSE([AC_LANG_PROGRAM([[\n#include <stdio.h>\n#include <stdlib.h>\n#include <zlib.h>\n\t]],\n\t[[\n\tint a=0, b=0, c=0, d=0, n, v;\n\tn = sscanf(ZLIB_VERSION, \"%d.%d.%d.%d\", &a, &b, &c, &d);\n\tif (n < 1)\n\t\texit(1);\n\tv = a*1000000 + b*10000 + c*100 + d;\n\tfprintf(stderr, \"found zlib version %s (%d)\\n\", ZLIB_VERSION, v);\n\n\t/* 1.1.4 is OK */\n\tif (a == 1 && b == 1 && c >= 4)\n\t\texit(0);\n\n\t/* 1.2.3 and up are OK */\n\tif (v >= 1020300)\n\t\texit(0);\n\n\texit(2);\n\t]])],\n\tAC_MSG_RESULT([no]),\n\t[ AC_MSG_RESULT([yes])\n\t  if test -z \"$zlib_check_nonfatal\" ; then\n\t\tAC_MSG_ERROR([*** zlib too old - check config.log ***\nYour reported zlib version has known security problems.  It's possible your\nvendor has fixed these problems without changing the version number.  If you\nare sure this is the case, you can disable the check by running\n\"./configure --without-zlib-version-check\".\nIf you are in doubt, upgrade zlib to version 1.2.3 or greater.\nSee http://www.gzip.org/zlib/ for details.])\n\t  else\n\t\tAC_MSG_WARN([zlib version may have security problems])\n\t  fi\n\t],\n\t[\tAC_MSG_WARN([cross compiling: not checking zlib version]) ]\n    )\n    LIBS=\"$saved_LIBS\"\nfi\n\ndnl UnixWare 2.x\nAC_CHECK_FUNC([strcasecmp],\n\t[], [ AC_CHECK_LIB([resolv], [strcasecmp], [LIBS=\"$LIBS -lresolv\"]) ]\n)\nAC_CHECK_FUNCS([utimes],\n\t[], [ AC_CHECK_LIB([c89], [utimes], [AC_DEFINE([HAVE_UTIMES])\n\t\t\t\t\tLIBS=\"$LIBS -lc89\"]) ]\n)\n\ndnl    Checks for libutil functions\nAC_CHECK_HEADERS([bsd/libutil.h libutil.h])\nAC_SEARCH_LIBS([fmt_scaled], [util bsd])\nAC_SEARCH_LIBS([scan_scaled], [util bsd])\nAC_SEARCH_LIBS([login], [util bsd])\nAC_SEARCH_LIBS([logout], [util bsd])\nAC_SEARCH_LIBS([logwtmp], [util bsd])\nAC_SEARCH_LIBS([openpty], [util bsd])\nAC_SEARCH_LIBS([updwtmp], [util bsd])\nAC_CHECK_FUNCS([fmt_scaled scan_scaled login logout openpty updwtmp logwtmp])\n\n# On some platforms, inet_ntop and gethostbyname may be found in libresolv\n# or libnsl.\nAC_SEARCH_LIBS([inet_ntop], [resolv nsl])\nAC_SEARCH_LIBS([gethostbyname], [resolv nsl])\n\n# Some Linux distribtions ship the BSD libc hashing functions in\n# separate libraries.\nAC_SEARCH_LIBS([SHA256Update], [md bsd])\n\n# \"Particular Function Checks\"\n# see https://www.gnu.org/software/autoconf/manual/autoconf-2.69/html_node/Particular-Functions.html\nAC_FUNC_STRFTIME\nAC_FUNC_MALLOC\nAC_FUNC_REALLOC\n# autoconf doesn't have AC_FUNC_CALLOC so fake it if malloc returns NULL;\nAC_MSG_CHECKING([if calloc(0, N) returns non-null])\nAC_RUN_IFELSE(\n\t[AC_LANG_PROGRAM(\n\t\t[[ #include <stdlib.h> ]],\n\t\t[[ void *p = calloc(0, 1); exit(p == NULL); ]]\n\t)],\n\t[ func_calloc_0_nonnull=yes ],\n\t[ func_calloc_0_nonnull=no ],\n\t[ AC_MSG_WARN([cross compiling: assuming same as malloc])\n\t  func_calloc_0_nonnull=\"$ac_cv_func_malloc_0_nonnull\"]\n)\nAC_MSG_RESULT([$func_calloc_0_nonnull])\n\nif test \"x$func_calloc_0_nonnull\" = \"xyes\"; then\n\tAC_DEFINE(HAVE_CALLOC, 1, [calloc(0, x) returns non-null])\nelse\n\tAC_DEFINE(HAVE_CALLOC, 0, [calloc(0, x) returns NULL])\n\tAC_DEFINE(calloc, rpl_calloc,\n\t    [Define to rpl_calloc if the replacement function should be used.])\nfi\n\n# Check for ALTDIRFUNC glob() extension\nAC_MSG_CHECKING([for GLOB_ALTDIRFUNC support])\nAC_EGREP_CPP([FOUNDIT],\n\t[\n\t\t#include <glob.h>\n\t\t#ifdef GLOB_ALTDIRFUNC\n\t\tFOUNDIT\n\t\t#endif\n\t],\n\t[\n\t\tAC_DEFINE([GLOB_HAS_ALTDIRFUNC], [1],\n\t\t\t[Define if your system glob() function has\n\t\t\tthe GLOB_ALTDIRFUNC extension])\n\t\tAC_MSG_RESULT([yes])\n\t],\n\t[\n\t\tAC_MSG_RESULT([no])\n\t]\n)\n\n# Check for g.gl_matchc glob() extension\nAC_MSG_CHECKING([for gl_matchc field in glob_t])\nAC_COMPILE_IFELSE([AC_LANG_PROGRAM([[ #include <glob.h> ]],\n\t[[ glob_t g; g.gl_matchc = 1; ]])],\n\t[\n\t\tAC_DEFINE([GLOB_HAS_GL_MATCHC], [1],\n\t\t\t[Define if your system glob() function has\n\t\t\tgl_matchc options in glob_t])\n\t\tAC_MSG_RESULT([yes])\n\t], [\n\t\tAC_MSG_RESULT([no])\n])\n\n# Check for g.gl_statv glob() extension\nAC_MSG_CHECKING([for gl_statv and GLOB_KEEPSTAT extensions for glob])\nAC_COMPILE_IFELSE([AC_LANG_PROGRAM([[ #include <glob.h> ]], [[\n#ifndef GLOB_KEEPSTAT\n#error \"glob does not support GLOB_KEEPSTAT extension\"\n#endif\nglob_t g;\ng.gl_statv = NULL;\n]])],\n\t[\n\t\tAC_DEFINE([GLOB_HAS_GL_STATV], [1],\n\t\t\t[Define if your system glob() function has\n\t\t\tgl_statv options in glob_t])\n\t\tAC_MSG_RESULT([yes])\n\t], [\n\t\tAC_MSG_RESULT([no])\n\n])\n\nAC_CHECK_DECLS([GLOB_NOMATCH], , , [#include <glob.h>])\n\nAC_CHECK_DECL([VIS_ALL], ,\n    AC_DEFINE(BROKEN_STRNVIS, 1, [missing VIS_ALL]), [#include <vis.h>])\n\nAC_MSG_CHECKING([whether struct dirent allocates space for d_name])\nAC_RUN_IFELSE(\n\t[AC_LANG_PROGRAM([[\n#include <sys/types.h>\n#include <dirent.h>\n#include <stdlib.h>\n\t]],\n\t[[\n\tstruct dirent d;\n\texit(sizeof(d.d_name)<=sizeof(char));\n\t]])],\n\t[AC_MSG_RESULT([yes])],\n\t[\n\t\tAC_MSG_RESULT([no])\n\t\tAC_DEFINE([BROKEN_ONE_BYTE_DIRENT_D_NAME], [1],\n\t\t\t[Define if your struct dirent expects you to\n\t\t\tallocate extra space for d_name])\n\t],\n\t[\n\t\tAC_MSG_WARN([cross compiling: assuming BROKEN_ONE_BYTE_DIRENT_D_NAME])\n\t\tAC_DEFINE([BROKEN_ONE_BYTE_DIRENT_D_NAME])\n\t]\n)\n\nAC_MSG_CHECKING([for /proc/pid/fd directory])\nif test -d \"/proc/$$/fd\" ; then\n\tAC_DEFINE([HAVE_PROC_PID], [1], [Define if you have /proc/$pid/fd])\n\tAC_MSG_RESULT([yes])\nelse\n\tAC_MSG_RESULT([no])\nfi\n\n# Check whether user wants to use ldns\nLDNS_MSG=\"no\"\nAC_ARG_WITH(ldns,\n\t[  --with-ldns[[=PATH]]      Use ldns for DNSSEC support (optionally in PATH)],\n\t[\n\tldns=\"\"\n\tif test \"x$withval\" = \"xyes\" ; then\n\t\tAC_PATH_TOOL([LDNSCONFIG], [ldns-config], [no])\n\t\tif test \"x$LDNSCONFIG\" = \"xno\"; then\n\t\t\tLIBS=\"-lldns $LIBS\"\n\t\t\tldns=yes\n\t\telse\n\t\t\tLIBS=\"$LIBS `$LDNSCONFIG --libs`\"\n\t\t\tCPPFLAGS=\"$CPPFLAGS `$LDNSCONFIG --cflags`\"\n\t\t\tldns=yes\n\t\tfi\n\telif test \"x$withval\" != \"xno\" ; then\n\t\t\tCPPFLAGS=\"$CPPFLAGS -I${withval}/include\"\n\t\t\tLDFLAGS=\"$LDFLAGS -L${withval}/lib\"\n\t\t\tLIBS=\"-lldns $LIBS\"\n\t\t\tldns=yes\n\tfi\n\n\t# Verify that it works.\n\tif test \"x$ldns\" = \"xyes\" ; then\n\t\tAC_DEFINE(HAVE_LDNS, 1, [Define if you want ldns support])\n\t\tLDNS_MSG=\"yes\"\n\t\tAC_MSG_CHECKING([for ldns support])\n\t\tAC_LINK_IFELSE(\n\t\t\t[AC_LANG_SOURCE([[\n#include <stdio.h>\n#include <stdlib.h>\n#ifdef HAVE_STDINT_H\n# include <stdint.h>\n#endif\n#include <ldns/ldns.h>\nint main(void) { ldns_status status = ldns_verify_trusted(NULL, NULL, NULL, NULL); status=LDNS_STATUS_OK; exit(0); }\n\t\t\t]])\n\t\t],\n\t\t\t[AC_MSG_RESULT(yes)],\n\t\t\t\t[\n\t\t\t\t\tAC_MSG_RESULT(no)\n\t\t\t\t\tAC_MSG_ERROR([** Incomplete or missing ldns libraries.])\n\t\t\t\t])\n\tfi\n])\n\n# Check whether user wants libedit support\nLIBEDIT_MSG=\"no\"\nAC_ARG_WITH([libedit],\n\t[  --with-libedit[[=PATH]]   Enable libedit support for sftp],\n\t[ if test \"x$withval\" != \"xno\" ; then\n\t\tif test \"x$withval\" = \"xyes\" ; then\n\t\t\tif test \"x$PKGCONFIG\" != \"xno\"; then\n\t\t\t\tAC_MSG_CHECKING([if $PKGCONFIG knows about libedit])\n\t\t\t\tif \"$PKGCONFIG\" libedit; then\n\t\t\t\t\tAC_MSG_RESULT([yes])\n\t\t\t\t\tuse_pkgconfig_for_libedit=yes\n\t\t\t\telse\n\t\t\t\t\tAC_MSG_RESULT([no])\n\t\t\t\tfi\n\t\t\tfi\n\t\telse\n\t\t\tCPPFLAGS=\"$CPPFLAGS -I${withval}/include\"\n\t\t\tif test -n \"${rpath_opt}\"; then\n\t\t\t\tLDFLAGS=\"-L${withval}/lib ${rpath_opt}${withval}/lib ${LDFLAGS}\"\n\t\t\telse\n\t\t\t\tLDFLAGS=\"-L${withval}/lib ${LDFLAGS}\"\n\t\t\tfi\n\t\tfi\n\t\tif test \"x$use_pkgconfig_for_libedit\" = \"xyes\"; then\n\t\t\tLIBEDIT=`$PKGCONFIG --libs libedit`\n\t\t\tCPPFLAGS=\"$CPPFLAGS `$PKGCONFIG --cflags libedit`\"\n\t\telse\n\t\t\tLIBEDIT=\"-ledit -lcurses\"\n\t\tfi\n\t\tOTHERLIBS=`echo $LIBEDIT | sed 's/-ledit//'`\n\t\tAC_CHECK_LIB([edit], [el_init],\n\t\t\t[ AC_DEFINE([USE_LIBEDIT], [1], [Use libedit for sftp])\n\t\t\t  LIBEDIT_MSG=\"yes\"\n\t\t\t  AC_SUBST([LIBEDIT])\n\t\t\t],\n\t\t\t[ AC_MSG_ERROR([libedit not found]) ],\n\t\t\t[ $OTHERLIBS ]\n\t\t)\n\t\tAC_MSG_CHECKING([if libedit version is compatible])\n\t\tAC_COMPILE_IFELSE(\n\t\t    [AC_LANG_PROGRAM([[\n#include <histedit.h>\n#include <stdlib.h>\n\t\t    ]],\n\t\t    [[\n\tint i = H_SETSIZE;\n\tel_init(\"\", NULL, NULL, NULL);\n\texit(0);\n\t\t    ]])],\n\t\t    [ AC_MSG_RESULT([yes]) ],\n\t\t    [ AC_MSG_RESULT([no])\n\t\t      AC_MSG_ERROR([libedit version is not compatible]) ]\n\t\t)\n\tfi ]\n)\n\nAUDIT_MODULE=none\nAC_ARG_WITH([audit],\n\t[  --with-audit=module     Enable audit support (modules=debug,bsm,linux)],\n\t[\n\t  AC_MSG_CHECKING([for supported audit module])\n\t  case \"$withval\" in\n\t  bsm)\n\t\tAC_MSG_RESULT([bsm])\n\t\tAUDIT_MODULE=bsm\n\t\tdnl    Checks for headers, libs and functions\n\t\tAC_CHECK_HEADERS([bsm/audit.h], [],\n\t\t    [AC_MSG_ERROR([BSM enabled and bsm/audit.h not found])],\n\t\t    [\n#ifdef HAVE_TIME_H\n# include <time.h>\n#endif\n\t\t    ]\n)\n\t\tAC_CHECK_LIB([bsm], [getaudit], [],\n\t\t    [AC_MSG_ERROR([BSM enabled and required library not found])])\n\t\tAC_CHECK_FUNCS([getaudit], [],\n\t\t    [AC_MSG_ERROR([BSM enabled and required function not found])])\n\t\t# These are optional\n\t\tAC_CHECK_FUNCS([getaudit_addr aug_get_machine])\n\t\tAC_DEFINE([USE_BSM_AUDIT], [1], [Use BSM audit module])\n\t\tif test \"$sol2ver\" -ge 11; then\n\t\t\tSSHDLIBS=\"$SSHDLIBS -lscf\"\n\t\t\tAC_DEFINE([BROKEN_BSM_API], [1],\n\t\t\t\t[The system has incomplete BSM API])\n\t\tfi\n\t\t;;\n\t  linux)\n\t\tAC_MSG_RESULT([linux])\n\t\tAUDIT_MODULE=linux\n\t\tdnl    Checks for headers, libs and functions\n\t\tAC_CHECK_HEADERS([libaudit.h])\n\t\tSSHDLIBS=\"$SSHDLIBS -laudit\"\n\t\tAC_DEFINE([USE_LINUX_AUDIT], [1], [Use Linux audit module])\n\t\t;;\n\t  debug)\n\t\tAUDIT_MODULE=debug\n\t\tAC_MSG_RESULT([debug])\n\t\tAC_DEFINE([SSH_AUDIT_EVENTS], [1], [Use audit debugging module])\n\t\t;;\n\t  no)\n\t\tAC_MSG_RESULT([no])\n\t\t;;\n\t  *)\n\t\tAC_MSG_ERROR([Unknown audit module $withval])\n\t\t;;\n\tesac ]\n)\n\nAC_ARG_WITH([pie],\n    [  --with-pie              Build Position Independent Executables if possible], [\n\tif test \"x$withval\" = \"xno\"; then\n\t\tuse_pie=no\n\tfi\n\tif test \"x$withval\" = \"xyes\"; then\n\t\tuse_pie=yes\n\tfi\n    ]\n)\nif test \"x$use_pie\" = \"x\"; then\n\tuse_pie=no\nfi\nif test \"x$use_toolchain_hardening\" != \"x1\" && test \"x$use_pie\" = \"xauto\"; then\n\t# Turn off automatic PIE when toolchain hardening is off.\n\tuse_pie=no\nfi\nif test \"x$use_pie\" = \"xauto\"; then\n\t# Automatic PIE requires gcc >= 4.x\n\tAC_MSG_CHECKING([for gcc >= 4.x])\n\tAC_COMPILE_IFELSE([AC_LANG_SOURCE([[\n#if !defined(__GNUC__) || __GNUC__ < 4\n#error gcc is too old\n#endif\n]])],\n\t[ AC_MSG_RESULT([yes]) ],\n\t[ AC_MSG_RESULT([no])\n\t  use_pie=no ]\n)\nfi\nif test \"x$use_pie\" != \"xno\"; then\n\tSAVED_CFLAGS=\"$CFLAGS\"\n\tSAVED_LDFLAGS=\"$LDFLAGS\"\n\tOSSH_CHECK_CFLAG_COMPILE([-fPIE])\n\tOSSH_CHECK_LDFLAG_LINK([-pie])\n\t# We use both -fPIE and -pie or neither.\n\tAC_MSG_CHECKING([whether both -fPIE and -pie are supported])\n\tif echo \"x $CFLAGS\"  | grep ' -fPIE' >/dev/null 2>&1 && \\\n\t   echo \"x $LDFLAGS\" | grep ' -pie'  >/dev/null 2>&1 ; then\n\t\tAC_MSG_RESULT([yes])\n\telse\n\t\tAC_MSG_RESULT([no])\n\t\tCFLAGS=\"$SAVED_CFLAGS\"\n\t\tLDFLAGS=\"$SAVED_LDFLAGS\"\n\tfi\nfi\n\nAC_MSG_CHECKING([whether -fPIC is accepted])\nSAVED_CFLAGS=\"$CFLAGS\"\nCFLAGS=\"$CFLAGS -fPIC\"\nAC_COMPILE_IFELSE(\n\t[AC_LANG_PROGRAM( [[ #include <stdlib.h> ]], [[ exit(0); ]] )],\n   [AC_MSG_RESULT([yes])\n    PICFLAG=\"-fPIC\"; ],\n   [AC_MSG_RESULT([no])\n    PICFLAG=\"\"; ])\nCFLAGS=\"$SAVED_CFLAGS\"\nAC_SUBST([PICFLAG])\n\ndnl    Checks for library functions. Please keep in alphabetical order\nAC_CHECK_FUNCS([ \\\n\tBlowfish_initstate \\\n\tBlowfish_expandstate \\\n\tBlowfish_expand0state \\\n\tBlowfish_stream2word \\\n\tSHA256Update \\\n\tSHA384Update \\\n\tSHA512Update \\\n\tasprintf \\\n\tb64_ntop \\\n\t__b64_ntop \\\n\tb64_pton \\\n\t__b64_pton \\\n\tbcopy \\\n\tbcrypt_pbkdf \\\n\tbindresvport_sa \\\n\tblf_enc \\\n\tbzero \\\n\tcap_rights_limit \\\n\tclock \\\n\tclosefrom \\\n\tclose_range \\\n\tdirfd \\\n\tendgrent \\\n\terr \\\n\terrx \\\n\texplicit_bzero \\\n\texplicit_memset \\\n\tfchmod \\\n\tfchmodat \\\n\tfchown \\\n\tfchownat \\\n\tflock \\\n\tfnmatch \\\n\tfreeaddrinfo \\\n\tfreezero \\\n\tfstatfs \\\n\tfstatvfs \\\n\tfutimes \\\n\tgetaddrinfo \\\n\tgetcwd \\\n\tgetentropy \\\n\tgetgrouplist \\\n\tgetline \\\n\tgetnameinfo \\\n\tgetopt \\\n\tgetpagesize \\\n\tgetpeereid \\\n\tgetpeerucred \\\n\tgetpgid \\\n\t_getpty \\\n\tgetrlimit \\\n\tgetrandom \\\n\tgetsid \\\n\tgetttyent \\\n\tglob \\\n\tgroup_from_gid \\\n\tinet_aton \\\n\tinet_ntoa \\\n\tinet_ntop \\\n\tinnetgr \\\n\tkillpg \\\n\tllabs \\\n\tlocaltime_r \\\n\tlogin_getcapbool \\\n\tlogin_getpwclass \\\n\tmemmem \\\n\tmemmove \\\n\tmemset_s \\\n\tmkdtemp \\\n\tngetaddrinfo \\\n\tnsleep \\\n\togetaddrinfo \\\n\topenlog_r \\\n\tpledge \\\n\tpoll \\\n\tppoll \\\n\tprctl \\\n\tprocctl \\\n\tpselect \\\n\tpstat \\\n\traise \\\n\treadpassphrase \\\n\treallocarray \\\n\trealpath \\\n\trecvmsg \\\n\trecallocarray \\\n\trresvport_af \\\n\tsendmsg \\\n\tsetdtablesize \\\n\tsetegid \\\n\tsetenv \\\n\tseteuid \\\n\tsetgroupent \\\n\tsetgroups \\\n\tsetlinebuf \\\n\tsetlogin \\\n\tsetpassent\\\n\tsetpcred \\\n\tsetproctitle \\\n\tsetregid \\\n\tsetreuid \\\n\tsetrlimit \\\n\tsetsid \\\n\tsetvbuf \\\n\tsigaction \\\n\tsigvec \\\n\tsnprintf \\\n\tsocketpair \\\n\tstatfs \\\n\tstatvfs \\\n\tstrcasestr \\\n\tstrdup \\\n\tstrerror \\\n\tstrlcat \\\n\tstrlcpy \\\n\tstrmode \\\n\tstrndup \\\n\tstrnlen \\\n\tstrnvis \\\n\tstrptime \\\n\tstrsignal \\\n\tstrtonum \\\n\tstrtoll \\\n\tstrtoul \\\n\tstrtoull \\\n\tswap32 \\\n\tsysconf \\\n\ttcgetpgrp \\\n\ttimegm \\\n\ttimingsafe_bcmp \\\n\ttruncate \\\n\tunsetenv \\\n\tupdwtmpx \\\n\tutimensat \\\n\tuser_from_uid \\\n\tusleep \\\n\tvasprintf \\\n\tvsnprintf \\\n\twaitpid \\\n\twarn \\\n])\n\nAC_CHECK_DECLS([bzero, memmem])\n\ndnl Wide character support.\nAC_CHECK_FUNCS([mblen mbtowc nl_langinfo wcwidth])\n\nTEST_SSH_UTF8=${TEST_SSH_UTF8:=yes}\nAC_MSG_CHECKING([for utf8 locale support])\nAC_RUN_IFELSE(\n\t[AC_LANG_PROGRAM([[\n#include <locale.h>\n#include <stdlib.h>\n\t]], [[\n\tchar *loc = setlocale(LC_CTYPE, \"en_US.UTF-8\");\n\tif (loc != NULL)\n\t\texit(0);\n\texit(1);\n\t]])],\n\tAC_MSG_RESULT(yes),\n\t[AC_MSG_RESULT(no)\n\t TEST_SSH_UTF8=no],\n\tAC_MSG_WARN([cross compiling: assuming yes])\n)\n\nAC_LINK_IFELSE(\n        [AC_LANG_PROGRAM(\n           [[ #include <ctype.h> ]],\n           [[ return (isblank('a')); ]])],\n\t[AC_DEFINE([HAVE_ISBLANK], [1], [Define if you have isblank(3C).])\n])\n\ndisable_pkcs11=\nAC_ARG_ENABLE([pkcs11],\n\t[  --disable-pkcs11        disable PKCS#11 support code [no]],\n\t[\n\t\tif test \"x$enableval\" = \"xno\" ; then\n\t\t\tdisable_pkcs11=1\n\t\tfi\n\t]\n)\n\ndisable_sk=\nAC_ARG_ENABLE([security-key],\n\t[  --disable-security-key  disable U2F/FIDO support code [no]],\n\t[\n\t\tif test \"x$enableval\" = \"xno\" ; then\n\t\t\tdisable_sk=1\n\t\tfi\n\t]\n)\nenable_sk_internal=\nAC_ARG_WITH([security-key-builtin],\n\t[  --with-security-key-builtin include builtin U2F/FIDO support],\n\t[ enable_sk_internal=$withval ]\n)\n\nAC_SEARCH_LIBS([dlopen], [dl])\nAC_CHECK_FUNCS([dlopen])\nAC_CHECK_DECL([RTLD_NOW], [], [], [#include <dlfcn.h>])\n\n# IRIX has a const char return value for gai_strerror()\nAC_CHECK_FUNCS([gai_strerror], [\n\tAC_DEFINE([HAVE_GAI_STRERROR])\n\tAC_COMPILE_IFELSE([AC_LANG_PROGRAM([[\n#include <sys/types.h>\n#include <sys/socket.h>\n#include <netdb.h>\n\nconst char *gai_strerror(int);\n\t\t\t]], [[\n\tchar *str;\n\tstr = gai_strerror(0);\n\t\t\t]])], [\n\t\tAC_DEFINE([HAVE_CONST_GAI_STRERROR_PROTO], [1],\n\t\t[Define if gai_strerror() returns const char *])], [])])\n\nAC_SEARCH_LIBS([nanosleep], [rt posix4], [AC_DEFINE([HAVE_NANOSLEEP], [1],\n\t[Some systems put nanosleep outside of libc])])\n\nAC_SEARCH_LIBS([clock_gettime], [rt],\n\t[AC_DEFINE([HAVE_CLOCK_GETTIME], [1], [Have clock_gettime])])\n\ndnl check if we need -D_REENTRANT for localtime_r declaration.\nAC_CHECK_DECL([localtime_r], [],\n\t[ saved_CPPFLAGS=\"$CPPFLAGS\"\n\t  CPPFLAGS=\"$CPPFLAGS -D_REENTRANT\"\n\t  unset ac_cv_have_decl_localtime_r\n\t  AC_CHECK_DECL([localtime_r], [],\n\t\t[ CPPFLAGS=\"$saved_CPPFLAGS\" ],\n\t\t[ #include <time.h> ]\n\t  )\n\t],\n\t[ #include <time.h> ]\n)\n\ndnl Make sure prototypes are defined for these before using them.\nAC_CHECK_DECL([strsep],\n\t[AC_CHECK_FUNCS([strsep])],\n\t[],\n\t[\n#ifdef HAVE_STRING_H\n# include <string.h>\n#endif\n\t])\n\ndnl tcsendbreak might be a macro\nAC_CHECK_DECL([tcsendbreak],\n\t[AC_DEFINE([HAVE_TCSENDBREAK])],\n\t[AC_CHECK_FUNCS([tcsendbreak])],\n\t[#include <termios.h>]\n)\n\nAC_CHECK_DECLS([h_errno], , ,[#include <netdb.h>])\n\nAC_CHECK_DECLS([SHUT_RD, getpeereid], , ,\n\t[\n#include <sys/types.h>\n#include <sys/socket.h>\n#include <unistd.h>\n\t])\n\nAC_CHECK_DECLS([O_NONBLOCK], , ,\n\t[\n#include <sys/types.h>\n#ifdef HAVE_SYS_STAT_H\n# include <sys/stat.h>\n#endif\n#ifdef HAVE_FCNTL_H\n# include <fcntl.h>\n#endif\n\t])\n\nAC_CHECK_DECLS([ftruncate, getentropy], , ,\n\t[\n#include <sys/types.h>\n#include <unistd.h>\n\t])\n\nAC_CHECK_DECLS([readv, writev], , , [\n#include <sys/types.h>\n#include <sys/uio.h>\n#include <unistd.h>\n\t])\n\nAC_CHECK_DECLS([MAXSYMLINKS], , , [\n#include <sys/param.h>\n\t])\n\nAC_CHECK_DECLS([offsetof], , , [\n#include <stddef.h>\n\t])\n\n# extra bits for select(2)\nAC_CHECK_DECLS([howmany, NFDBITS], [], [], [[\n#include <sys/param.h>\n#include <sys/types.h>\n#ifdef HAVE_SYS_SYSMACROS_H\n#include <sys/sysmacros.h>\n#endif\n#ifdef HAVE_SYS_SELECT_H\n#include <sys/select.h>\n#endif\n#ifdef HAVE_SYS_TIME_H\n#include <sys/time.h>\n#endif\n#ifdef HAVE_UNISTD_H\n#include <unistd.h>\n#endif\n\t]])\nAC_CHECK_TYPES([fd_mask], [], [], [[\n#include <sys/param.h>\n#include <sys/types.h>\n#ifdef HAVE_SYS_SELECT_H\n#include <sys/select.h>\n#endif\n#ifdef HAVE_SYS_TIME_H\n#include <sys/time.h>\n#endif\n#ifdef HAVE_UNISTD_H\n#include <unistd.h>\n#endif\n\t]])\n\nAC_CHECK_FUNCS([setresuid], [\n\tdnl Some platorms have setresuid that isn't implemented, test for this\n\tAC_MSG_CHECKING([if setresuid seems to work])\n\tAC_RUN_IFELSE(\n\t\t[AC_LANG_PROGRAM([[\n#include <errno.h>\n#include <stdlib.h>\n#include <unistd.h>\n\t\t]], [[\n\terrno=0;\n\tsetresuid(0,0,0);\n\tif (errno==ENOSYS)\n\t\texit(1);\n\telse\n\t\texit(0);\n\t\t]])],\n\t\t[AC_MSG_RESULT([yes])],\n\t\t[AC_DEFINE([BROKEN_SETRESUID], [1],\n\t\t\t[Define if your setresuid() is broken])\n\t\t AC_MSG_RESULT([not implemented])],\n\t\t[AC_MSG_WARN([cross compiling: not checking setresuid])]\n\t)\n])\n\nAC_CHECK_FUNCS([setresgid], [\n\tdnl Some platorms have setresgid that isn't implemented, test for this\n\tAC_MSG_CHECKING([if setresgid seems to work])\n\tAC_RUN_IFELSE(\n\t\t[AC_LANG_PROGRAM([[\n#include <errno.h>\n#include <stdlib.h>\n#include <unistd.h>\n\t\t]], [[\n\terrno=0;\n\tsetresgid(0,0,0);\n\tif (errno==ENOSYS)\n\t\texit(1);\n\telse\n\t\texit(0);\n\t\t]])],\n\t\t[AC_MSG_RESULT([yes])],\n\t\t[AC_DEFINE([BROKEN_SETRESGID], [1],\n\t\t\t[Define if your setresgid() is broken])\n\t\t AC_MSG_RESULT([not implemented])],\n\t\t[AC_MSG_WARN([cross compiling: not checking setresuid])]\n\t)\n])\n\nAC_MSG_CHECKING([for working fflush(NULL)])\nAC_RUN_IFELSE(\n\t[AC_LANG_PROGRAM([[\n#include <stdio.h>\n#include <stdlib.h>\n\t]],\n\t[[fflush(NULL); exit(0);]])],\n\tAC_MSG_RESULT([yes]),\n\t[AC_MSG_RESULT([no])\n\t AC_DEFINE([FFLUSH_NULL_BUG], [1],\n\t    [define if fflush(NULL) does not work])],\n\tAC_MSG_WARN([cross compiling: assuming working])\n)\n\ndnl    Checks for time functions\nAC_CHECK_FUNCS([gettimeofday time])\ndnl    Checks for utmp functions\nAC_CHECK_FUNCS([endutent getutent getutid getutline pututline setutent])\nAC_CHECK_FUNCS([utmpname])\ndnl    Checks for utmpx functions\nAC_CHECK_FUNCS([endutxent getutxent getutxid getutxline getutxuser pututxline])\nAC_CHECK_FUNCS([setutxdb setutxent utmpxname])\ndnl    Checks for lastlog functions\nAC_CHECK_FUNCS([getlastlogxbyname])\n\nAC_CHECK_FUNC([daemon],\n\t[AC_DEFINE([HAVE_DAEMON], [1], [Define if your libraries define daemon()])],\n\t[AC_CHECK_LIB([bsd], [daemon],\n\t\t[LIBS=\"$LIBS -lbsd\"; AC_DEFINE([HAVE_DAEMON])])]\n)\n\nAC_CHECK_FUNC([getpagesize],\n\t[AC_DEFINE([HAVE_GETPAGESIZE], [1],\n\t\t[Define if your libraries define getpagesize()])],\n\t[AC_CHECK_LIB([ucb], [getpagesize],\n\t\t[LIBS=\"$LIBS -lucb\"; AC_DEFINE([HAVE_GETPAGESIZE])])]\n)\n\n# Check for broken snprintf\nif test \"x$ac_cv_func_snprintf\" = \"xyes\" ; then\n\tAC_MSG_CHECKING([whether snprintf correctly terminates long strings])\n\tAC_RUN_IFELSE(\n\t\t[AC_LANG_PROGRAM([[\n#include <stdio.h>\n#include <stdlib.h>\n\t\t]],\n\t\t[[\n\tchar b[5];\n\tsnprintf(b,5,\"123456789\");\n\texit(b[4]!='\\0');\n\t\t]])],\n\t\t[AC_MSG_RESULT([yes])],\n\t\t[\n\t\t\tAC_MSG_RESULT([no])\n\t\t\tAC_DEFINE([BROKEN_SNPRINTF], [1],\n\t\t\t\t[Define if your snprintf is busted])\n\t\t\tAC_MSG_WARN([****** Your snprintf() function is broken, complain to your vendor])\n\t\t],\n\t\t[ AC_MSG_WARN([cross compiling: Assuming working snprintf()]) ]\n\t)\nfi\n\nif test \"x$ac_cv_func_snprintf\" = \"xyes\" ; then\n\tAC_MSG_CHECKING([whether snprintf understands %zu])\n\tAC_RUN_IFELSE(\n\t\t[AC_LANG_PROGRAM([[\n#include <sys/types.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n\t\t]],\n\t\t[[\n\tsize_t a = 1, b = 2;\n\tchar z[128];\n\tsnprintf(z, sizeof z, \"%zu%zu\", a, b);\n\texit(strcmp(z, \"12\"));\n\t\t]])],\n\t\t[AC_MSG_RESULT([yes])],\n\t\t[\n\t\t\tAC_MSG_RESULT([no])\n\t\t\tAC_DEFINE([BROKEN_SNPRINTF], [1],\n\t\t\t\t[snprintf does not understand %zu])\n\t\t],\n\t\t[ AC_MSG_WARN([cross compiling: Assuming working snprintf()]) ]\n\t)\nfi\n\n# We depend on vsnprintf returning the right thing on overflow: the\n# number of characters it tried to create (as per SUSv3)\nif test \"x$ac_cv_func_vsnprintf\" = \"xyes\" ; then\n\tAC_MSG_CHECKING([whether vsnprintf returns correct values on overflow])\n\tAC_RUN_IFELSE(\n\t\t[AC_LANG_PROGRAM([[\n#include <sys/types.h>\n#include <stdio.h>\n#include <stdarg.h>\n\nint x_snprintf(char *str, size_t count, const char *fmt, ...)\n{\n\tsize_t ret;\n\tva_list ap;\n\n\tva_start(ap, fmt);\n\tret = vsnprintf(str, count, fmt, ap);\n\tva_end(ap);\n\treturn ret;\n}\n\t\t]], [[\nchar x[1];\nif (x_snprintf(x, 1, \"%s %d\", \"hello\", 12345) != 11)\n\treturn 1;\nif (x_snprintf(NULL, 0, \"%s %d\", \"hello\", 12345) != 11)\n\treturn 1;\nreturn 0;\n\t\t]])],\n\t\t[AC_MSG_RESULT([yes])],\n\t\t[\n\t\t\tAC_MSG_RESULT([no])\n\t\t\tAC_DEFINE([BROKEN_SNPRINTF], [1],\n\t\t\t\t[Define if your snprintf is busted])\n\t\t\tAC_MSG_WARN([****** Your vsnprintf() function is broken, complain to your vendor])\n\t\t],\n\t\t[ AC_MSG_WARN([cross compiling: Assuming working vsnprintf()]) ]\n\t)\nfi\n\n# On systems where [v]snprintf is broken, but is declared in stdio,\n# check that the fmt argument is const char * or just char *.\n# This is only useful for when BROKEN_SNPRINTF\nAC_MSG_CHECKING([whether snprintf can declare const char *fmt])\nAC_COMPILE_IFELSE([AC_LANG_PROGRAM([[\n#include <stdio.h>\nint snprintf(char *a, size_t b, const char *c, ...) { return 0; }\n\t\t]], [[\n\tsnprintf(0, 0, 0);\n\t\t]])],\n   [AC_MSG_RESULT([yes])\n    AC_DEFINE([SNPRINTF_CONST], [const],\n              [Define as const if snprintf() can declare const char *fmt])],\n   [AC_MSG_RESULT([no])\n    AC_DEFINE([SNPRINTF_CONST], [/* not const */])])\n\n# Check for missing getpeereid (or equiv) support\nNO_PEERCHECK=\"\"\nif test \"x$ac_cv_func_getpeereid\" != \"xyes\" -a \"x$ac_cv_func_getpeerucred\" != \"xyes\"; then\n\tAC_MSG_CHECKING([whether system supports SO_PEERCRED getsockopt])\n\tAC_COMPILE_IFELSE([AC_LANG_PROGRAM([[\n#include <sys/types.h>\n#include <sys/socket.h>]], [[int i = SO_PEERCRED;]])],\n\t\t[ AC_MSG_RESULT([yes])\n\t\t  AC_DEFINE([HAVE_SO_PEERCRED], [1], [Have PEERCRED socket option])\n\t\t], [AC_MSG_RESULT([no])\n\t\tNO_PEERCHECK=1\n        ])\nfi\n\ndnl make sure that openpty does not reacquire controlling terminal\nif test ! -z \"$check_for_openpty_ctty_bug\"; then\n\tAC_MSG_CHECKING([if openpty correctly handles controlling tty])\n\tAC_RUN_IFELSE(\n\t\t[AC_LANG_PROGRAM([[\n#include <stdio.h>\n#include <stdlib.h>\n#include <unistd.h>\n#ifdef HAVE_PTY_H\n# include <pty.h>\n#endif\n#include <sys/fcntl.h>\n#include <sys/types.h>\n#include <sys/wait.h>\n\t\t]], [[\n\tpid_t pid;\n\tint fd, ptyfd, ttyfd, status;\n\n\tpid = fork();\n\tif (pid < 0) {\t\t/* failed */\n\t\texit(1);\n\t} else if (pid > 0) {\t/* parent */\n\t\twaitpid(pid, &status, 0);\n\t\tif (WIFEXITED(status))\n\t\t\texit(WEXITSTATUS(status));\n\t\telse\n\t\t\texit(2);\n\t} else {\t\t/* child */\n\t\tclose(0); close(1); close(2);\n\t\tsetsid();\n\t\topenpty(&ptyfd, &ttyfd, NULL, NULL, NULL);\n\t\tfd = open(\"/dev/tty\", O_RDWR | O_NOCTTY);\n\t\tif (fd >= 0)\n\t\t\texit(3);\t/* Acquired ctty: broken */\n\t\telse\n\t\t\texit(0);\t/* Did not acquire ctty: OK */\n\t}\n\t\t]])],\n\t\t[\n\t\t\tAC_MSG_RESULT([yes])\n\t\t],\n\t\t[\n\t\t\tAC_MSG_RESULT([no])\n\t\t\tAC_DEFINE([SSHD_ACQUIRES_CTTY])\n\t\t],\n\t\t[\n\t\t\tAC_MSG_RESULT([cross-compiling, assuming yes])\n\t\t]\n\t)\nfi\n\nif test \"x$ac_cv_func_getaddrinfo\" = \"xyes\" && \\\n    test \"x$check_for_hpux_broken_getaddrinfo\" = \"x1\"; then\n\tAC_MSG_CHECKING([if getaddrinfo seems to work])\n\tAC_RUN_IFELSE(\n\t\t[AC_LANG_PROGRAM([[\n#include <stdio.h>\n#include <stdlib.h>\n#include <sys/socket.h>\n#include <netdb.h>\n#include <errno.h>\n#include <netinet/in.h>\n\n#define TEST_PORT \"2222\"\n\t\t]], [[\n\tint err, sock;\n\tstruct addrinfo *gai_ai, *ai, hints;\n\tchar ntop[NI_MAXHOST], strport[NI_MAXSERV], *name = NULL;\n\n\tmemset(&hints, 0, sizeof(hints));\n\thints.ai_family = PF_UNSPEC;\n\thints.ai_socktype = SOCK_STREAM;\n\thints.ai_flags = AI_PASSIVE;\n\n\terr = getaddrinfo(name, TEST_PORT, &hints, &gai_ai);\n\tif (err != 0) {\n\t\tfprintf(stderr, \"getaddrinfo failed (%s)\", gai_strerror(err));\n\t\texit(1);\n\t}\n\n\tfor (ai = gai_ai; ai != NULL; ai = ai->ai_next) {\n\t\tif (ai->ai_family != AF_INET6)\n\t\t\tcontinue;\n\n\t\terr = getnameinfo(ai->ai_addr, ai->ai_addrlen, ntop,\n\t\t    sizeof(ntop), strport, sizeof(strport),\n\t\t    NI_NUMERICHOST|NI_NUMERICSERV);\n\n\t\tif (err != 0) {\n\t\t\tif (err == EAI_SYSTEM)\n\t\t\t\tperror(\"getnameinfo EAI_SYSTEM\");\n\t\t\telse\n\t\t\t\tfprintf(stderr, \"getnameinfo failed: %s\\n\",\n\t\t\t\t    gai_strerror(err));\n\t\t\texit(2);\n\t\t}\n\n\t\tsock = socket(ai->ai_family, ai->ai_socktype, ai->ai_protocol);\n\t\tif (sock < 0)\n\t\t\tperror(\"socket\");\n\t\tif (bind(sock, ai->ai_addr, ai->ai_addrlen) < 0) {\n\t\t\tif (errno == EBADF)\n\t\t\t\texit(3);\n\t\t}\n\t}\n\texit(0);\n\t\t]])],\n\t\t[\n\t\t\tAC_MSG_RESULT([yes])\n\t\t],\n\t\t[\n\t\t\tAC_MSG_RESULT([no])\n\t\t\tAC_DEFINE([BROKEN_GETADDRINFO])\n\t\t],\n\t\t[\n\t\t\tAC_MSG_RESULT([cross-compiling, assuming yes])\n\t\t]\n\t)\nfi\n\nif test \"x$ac_cv_func_getaddrinfo\" = \"xyes\" && \\\n    test \"x$check_for_aix_broken_getaddrinfo\" = \"x1\"; then\n\tAC_MSG_CHECKING([if getaddrinfo seems to work])\n\tAC_RUN_IFELSE(\n\t\t[AC_LANG_PROGRAM([[\n#include <stdio.h>\n#include <stdlib.h>\n#include <sys/socket.h>\n#include <netdb.h>\n#include <errno.h>\n#include <netinet/in.h>\n\n#define TEST_PORT \"2222\"\n\t\t]], [[\n\tint err, sock;\n\tstruct addrinfo *gai_ai, *ai, hints;\n\tchar ntop[NI_MAXHOST], strport[NI_MAXSERV], *name = NULL;\n\n\tmemset(&hints, 0, sizeof(hints));\n\thints.ai_family = PF_UNSPEC;\n\thints.ai_socktype = SOCK_STREAM;\n\thints.ai_flags = AI_PASSIVE;\n\n\terr = getaddrinfo(name, TEST_PORT, &hints, &gai_ai);\n\tif (err != 0) {\n\t\tfprintf(stderr, \"getaddrinfo failed (%s)\", gai_strerror(err));\n\t\texit(1);\n\t}\n\n\tfor (ai = gai_ai; ai != NULL; ai = ai->ai_next) {\n\t\tif (ai->ai_family != AF_INET && ai->ai_family != AF_INET6)\n\t\t\tcontinue;\n\n\t\terr = getnameinfo(ai->ai_addr, ai->ai_addrlen, ntop,\n\t\t    sizeof(ntop), strport, sizeof(strport),\n\t\t    NI_NUMERICHOST|NI_NUMERICSERV);\n\n\t\tif (ai->ai_family == AF_INET && err != 0) {\n\t\t\tperror(\"getnameinfo\");\n\t\t\texit(2);\n\t\t}\n\t}\n\texit(0);\n\t\t]])],\n\t\t[\n\t\t\tAC_MSG_RESULT([yes])\n\t\t\tAC_DEFINE([AIX_GETNAMEINFO_HACK], [1],\n\t\t\t\t[Define if you have a getaddrinfo that fails\n\t\t\t\tfor the all-zeros IPv6 address])\n\t\t],\n\t\t[\n\t\t\tAC_MSG_RESULT([no])\n\t\t\tAC_DEFINE([BROKEN_GETADDRINFO])\n\t\t],\n\t\t[\n\t\t\tAC_MSG_RESULT([cross-compiling, assuming no])\n\t\t]\n\t)\nfi\n\nif test \"x$ac_cv_func_getaddrinfo\" = \"xyes\"; then\n\tAC_CHECK_DECLS(AI_NUMERICSERV, , ,\n\t    [#include <sys/types.h>\n\t     #include <sys/socket.h>\n\t     #include <netdb.h>])\nfi\n\nif test \"x$check_for_conflicting_getspnam\" = \"x1\"; then\n\tAC_MSG_CHECKING([for conflicting getspnam in shadow.h])\n\tAC_COMPILE_IFELSE([AC_LANG_PROGRAM([[\n#include <shadow.h>\n#include <stdlib.h>\n\t\t]],\n\t\t[[ exit(0); ]])],\n\t\t[\n\t\t\tAC_MSG_RESULT([no])\n\t\t],\n\t\t[\n\t\t\tAC_MSG_RESULT([yes])\n\t\t\tAC_DEFINE([GETSPNAM_CONFLICTING_DEFS], [1],\n\t\t\t    [Conflicting defs for getspnam])\n\t\t]\n\t)\nfi\n\ndnl NetBSD added an strnvis and unfortunately made it incompatible with the\ndnl existing one in OpenBSD and Linux's libbsd (the former having existed\ndnl for over ten years). Despite this incompatibility being reported during\ndnl development (see http://gnats.netbsd.org/44977) they still shipped it.\ndnl Even more unfortunately FreeBSD and later MacOS picked up this incompatible\ndnl implementation.  Try to detect this mess, and assume the only safe option\ndnl if we're cross compiling.\ndnl\ndnl OpenBSD, 2001: strnvis(char *dst, const char *src, size_t dlen, int flag);\ndnl NetBSD: 2012,  strnvis(char *dst, size_t dlen, const char *src, int flag);\nif test \"x$ac_cv_func_strnvis\" = \"xyes\"; then\n\tAC_MSG_CHECKING([for working strnvis])\n\tAC_RUN_IFELSE(\n\t\t[AC_LANG_PROGRAM([[\n#include <signal.h>\n#include <stdlib.h>\n#include <string.h>\n#include <unistd.h>\n#include <vis.h>\nstatic void sighandler(int sig) { _exit(1); }\n\t\t]], [[\n\tchar dst[16];\n\n\tsignal(SIGSEGV, sighandler);\n\tif (strnvis(dst, \"src\", 4, 0) && strcmp(dst, \"src\") == 0)\n\t\texit(0);\n\texit(1)\n\t\t]])],\n\t\t[AC_MSG_RESULT([yes])],\n\t\t[AC_MSG_RESULT([no])\n\t\t AC_DEFINE([BROKEN_STRNVIS], [1], [strnvis detected broken])],\n\t\t[AC_MSG_WARN([cross compiling: assuming broken])\n\t\t AC_DEFINE([BROKEN_STRNVIS], [1], [strnvis assumed broken])]\n\t)\nfi\n\nAC_MSG_CHECKING([if SA_RESTARTed signals interrupt select()])\nAC_RUN_IFELSE(\n\t[AC_LANG_PROGRAM([[\n#ifdef HAVE_SYS_SELECT\n# include <sys/select.h>\n#endif\n#include <sys/types.h>\n#include <sys/time.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <unistd.h>\nstatic void sighandler(int sig) { }\n\t\t]], [[\n\tint r;\n\tpid_t pid;\n\tstruct sigaction sa;\n\n\tsa.sa_handler = sighandler;\n\tsa.sa_flags = SA_RESTART;\n\t(void)sigaction(SIGTERM, &sa, NULL);\n\tif ((pid = fork()) == 0) { /* child */\n\t\tpid = getppid();\n\t\tsleep(1);\n\t\tkill(pid, SIGTERM);\n\t\tsleep(1);\n\t\tif (getppid() == pid) /* if parent did not exit, shoot it */\n\t\t\tkill(pid, SIGKILL);\n\t\texit(0);\n\t} else { /* parent */\n\t\tr = select(0, NULL, NULL, NULL, NULL);\n\t}\n\texit(r == -1 ? 0 : 1);\n\t]])],\n\t[AC_MSG_RESULT([yes])],\n\t[AC_MSG_RESULT([no])\n\t AC_DEFINE([NO_SA_RESTART], [1],\n\t    [SA_RESTARTed signals do no interrupt select])],\n\t[AC_MSG_WARN([cross compiling: assuming yes])]\n)\n\nAC_CHECK_FUNCS([getpgrp],[\n\tAC_MSG_CHECKING([if getpgrp accepts zero args])\n\tAC_COMPILE_IFELSE(\n\t\t[AC_LANG_PROGRAM([[$ac_includes_default]], [[ getpgrp(); ]])],\n\t\t[ AC_MSG_RESULT([yes])\n\t\t  AC_DEFINE([GETPGRP_VOID], [1], [getpgrp takes zero args])],\n\t\t[ AC_MSG_RESULT([no])\n\t\t  AC_DEFINE([GETPGRP_VOID], [0], [getpgrp takes one arg])]\n\t)\n])\n\n# Search for OpenSSL\nsaved_CPPFLAGS=\"$CPPFLAGS\"\nsaved_LDFLAGS=\"$LDFLAGS\"\nopenssl_bin_PATH=\"$PATH\"\nAC_ARG_WITH([ssl-dir],\n\t[  --with-ssl-dir=PATH     Specify path to OpenSSL installation ],\n\t[\n\t\tif test \"x$openssl\" = \"xno\" ; then\n\t\t\tAC_MSG_ERROR([cannot use --with-ssl-dir when OpenSSL disabled])\n\t\tfi\n\t\tif test \"x$withval\" != \"xno\" ; then\n\t\t\tcase \"$withval\" in\n\t\t\t\t# Relative paths\n\t\t\t\t./*|../*)\twithval=\"`pwd`/$withval\"\n\t\t\tesac\n\t\t\tif test -d \"$withval/lib\"; then\n\t\t\t\tlibcrypto_path=\"${withval}/lib\"\n\t\t\telif test -d \"$withval/lib64\"; then\n\t\t\t\tlibcrypto_path=\"$withval/lib64\"\n\t\t\telse\n\t\t\t\t# Built but not installed\n\t\t\t\tlibcrypto_path=\"${withval}\"\n\t\t\tfi\n\t\t\tif test -n \"${rpath_opt}\"; then\n\t\t\t\tLDFLAGS=\"-L${libcrypto_path} ${rpath_opt}${libcrypto_path} ${LDFLAGS}\"\n\t\t\telse\n\t\t\t\tLDFLAGS=\"-L${libcrypto_path} ${LDFLAGS}\"\n\t\t\tfi\n\t\t\tif test -d \"$withval/include\"; then\n\t\t\t\tCPPFLAGS=\"-I${withval}/include ${CPPFLAGS}\"\n\t\t\telse\n\t\t\t\tCPPFLAGS=\"-I${withval} ${CPPFLAGS}\"\n\t\t\tfi\n\t\t\topenssl_bin_PATH=\"${PATH}${PATH_SEPARATOR}${withval}/bin${PATH_SEPARATOR}${withval}/apps\"\n\t\tfi\n\t]\n)\nAC_PATH_PROGS([openssl_bin], openssl, [], [$openssl_bin_PATH])\nAC_SUBST(OPENSSL_BIN, [${openssl_bin}])\n\nAC_ARG_WITH([openssl-header-check],\n\t[  --without-openssl-header-check Disable OpenSSL version consistency check],\n\t[\n\t\tif test \"x$withval\" = \"xno\" ; then\n\t\t\topenssl_check_nonfatal=1\n\t\tfi\n\t]\n)\n\nopenssl_engine=no\nAC_ARG_WITH([ssl-engine],\n\t[  --with-ssl-engine       Enable OpenSSL (hardware) ENGINE support ],\n\t[\n\t\tif test \"x$withval\" != \"xno\" ; then\n\t\t\tif test \"x$openssl\" = \"xno\" ; then\n\t\t\t\tAC_MSG_ERROR([cannot use --with-ssl-engine when OpenSSL disabled])\n\t\t\tfi\n\t\t\topenssl_engine=yes\n\t\tfi\n\t]\n)\n\nnocrypto_saved_LIBS=\"$LIBS\"\nif test \"x$openssl\" = \"xyes\" ; then\n\tLIBS=\"-lcrypto $LIBS\"\n\tCHANNELLIBS=\"-lcrypto $CHANNELLIBS\"\n\tAC_TRY_LINK_FUNC([RAND_add], ,\n\t    [AC_MSG_ERROR([*** working libcrypto not found, check config.log])])\n\tAC_CHECK_HEADER([openssl/opensslv.h], ,\n\t    [AC_MSG_ERROR([*** OpenSSL headers missing - please install first or check config.log ***])])\n\n\t# Determine OpenSSL header version\n\tAC_MSG_CHECKING([OpenSSL header version])\n\tAC_RUN_IFELSE(\n\t\t[AC_LANG_PROGRAM([[\n\t#include <stdlib.h>\n\t#include <stdio.h>\n\t#include <string.h>\n\t#include <openssl/opensslv.h>\n\t#define DATA \"conftest.sslincver\"\n\t\t]], [[\n\t\tFILE *fd;\n\t\tint rc;\n\n\t\tfd = fopen(DATA,\"w\");\n\t\tif(fd == NULL)\n\t\t\texit(1);\n\n\t\tif ((rc = fprintf(fd, \"%08lx (%s)\\n\",\n\t\t    (unsigned long)OPENSSL_VERSION_NUMBER,\n\t\t     OPENSSL_VERSION_TEXT)) < 0)\n\t\t\texit(1);\n\n\t\texit(0);\n\t\t]])],\n\t\t[\n\t\t\tssl_header_ver=`cat conftest.sslincver`\n\t\t\tAC_MSG_RESULT([$ssl_header_ver])\n\t\t],\n\t\t[\n\t\t\tAC_MSG_RESULT([not found])\n\t\t\tAC_MSG_ERROR([OpenSSL version header not found.])\n\t\t],\n\t\t[\n\t\t\tAC_MSG_WARN([cross compiling: not checking])\n\t\t]\n\t)\n\n\t# Determining OpenSSL library version is version dependent.\n\tAC_CHECK_FUNCS([OpenSSL_version OpenSSL_version_num])\n\n\t# Determine OpenSSL library version\n\tAC_MSG_CHECKING([OpenSSL library version])\n\tAC_RUN_IFELSE(\n\t\t[AC_LANG_PROGRAM([[\n\t#include <stdio.h>\n\t#include <stdlib.h>\n\t#include <string.h>\n\t#include <openssl/opensslv.h>\n\t#include <openssl/crypto.h>\n\t#define DATA \"conftest.ssllibver\"\n\t\t]], [[\n\t\tFILE *f;\n\t\t/* We need these legacy bits to warn for old libcrypto */\n\t\t#ifndef OPENSSL_VERSION\n\t\t# define OPENSSL_VERSION SSLEAY_VERSION\n\t\t#endif\n\t\t#ifndef HAVE_OPENSSL_VERSION\n\t\t# define OpenSSL_version       SSLeay_version\n\t\t#endif\n\t\t#ifndef HAVE_OPENSSL_VERSION_NUM\n\t\t# define OpenSSL_version_num   SSLeay\n\t\t#endif\n\t\tif ((f = fopen(DATA, \"w\")) == NULL)\n\t\t\texit(1);\n\t\tif (fprintf(f, \"%08lx (%s)\",\n\t\t    (unsigned long)OpenSSL_version_num(),\n\t\t    OpenSSL_version(OPENSSL_VERSION)) < 0)\n\t\t\texit(1);\n#ifdef LIBRESSL_VERSION_NUMBER\n\t\tif (fprintf(f, \" libressl-%08lx\", LIBRESSL_VERSION_NUMBER) < 0)\n\t\t\texit(1);\n#endif\n\t\tif (fputc('\\n', f) == EOF || fclose(f) == EOF)\n\t\t\texit(1);\n\t\texit(0);\n\t\t]])],\n\t\t[\n\t\t\tsslver=`cat conftest.ssllibver`\n\t\t\tssl_showver=`echo \"$sslver\" | sed 's/ libressl-.*//'`\n\t\t\t# Check version is supported.\n\t\t\tcase \"$sslver\" in\n\t\t\t100*|10100*) # 1.0.x, 1.1.0x\n\t\t\t\tAC_MSG_ERROR([OpenSSL >= 1.1.1 required (have \"$ssl_showver\")])\n\t\t\t\t;;\n\t\t\t101*)   ;; # 1.1.x\n\t\t\t200*)   # LibreSSL\n\t\t\t\tlver=`echo \"$sslver\" | sed 's/.*libressl-//'`\n\t\t\t\tcase \"$lver\" in\n\t\t\t\t2*|300*) # 2.x, 3.0.0\n\t\t\t\t\tAC_MSG_ERROR([LibreSSL >= 3.1.0 required (have \"$ssl_showver\")])\n\t\t\t\t\t;;\n\t\t\t\t*) ;;\t# Assume all other versions are good.\n\t\t\t\tesac\n\t\t\t\t;;\n\t\t\t300*)\n\t\t\t\t# OpenSSL 3; we use the 1.1x API\n\t\t\t\tCPPFLAGS=\"$CPPFLAGS -DOPENSSL_API_COMPAT=0x10100000L\"\n\t\t\t\t;;\n\t\t\t301*|302*|303*)\n\t\t\t\t# OpenSSL development branch; request 1.1x API\n\t\t\t\tCPPFLAGS=\"$CPPFLAGS -DOPENSSL_API_COMPAT=0x10100000L\"\n\t\t\t\t;;\n\t\t        *)\n\t\t\t\tAC_MSG_ERROR([Unknown/unsupported OpenSSL version (\"$ssl_showver\")])\n\t\t                ;;\n\t\t\tesac\n\t\t\tAC_MSG_RESULT([$ssl_showver])\n\t\t],\n\t\t[\n\t\t\tAC_MSG_RESULT([not found])\n\t\t\tAC_MSG_ERROR([OpenSSL library not found.])\n\t\t],\n\t\t[\n\t\t\tAC_MSG_WARN([cross compiling: not checking])\n\t\t]\n\t)\n\n\tcase \"$host\" in\n\tx86_64-*)\n\t\tcase \"$sslver\" in\n\t\t3000004*)\n\t\t\tAC_MSG_ERROR([OpenSSL 3.0.4 has a potential RCE in its RSA implementation (CVE-2022-2274)])\n\t\t\t;;\n\t\tesac\n\tesac\n\n\t# Sanity check OpenSSL headers\n\tAC_MSG_CHECKING([whether OpenSSL's headers match the library])\n\tAC_RUN_IFELSE(\n\t\t[AC_LANG_PROGRAM([[\n\t#include <stdlib.h>\n\t#include <string.h>\n\t#include <openssl/opensslv.h>\n\t#include <openssl/crypto.h>\n\t\t]], [[\n\t\texit(OpenSSL_version_num() == OPENSSL_VERSION_NUMBER ? 0 : 1);\n\t\t]])],\n\t\t[\n\t\t\tAC_MSG_RESULT([yes])\n\t\t],\n\t\t[\n\t\t\tAC_MSG_RESULT([no])\n\t\t\tif test \"x$openssl_check_nonfatal\" = \"x\"; then\n\t\t\t\tAC_MSG_ERROR([Your OpenSSL headers do not match your\n\tlibrary. Check config.log for details.\n\tIf you are sure your installation is consistent, you can disable the check\n\tby running \"./configure --without-openssl-header-check\".\n\tAlso see contrib/findssl.sh for help identifying header/library mismatches.\n\t])\n\t\t\telse\n\t\t\t\tAC_MSG_WARN([Your OpenSSL headers do not match your\n\tlibrary. Check config.log for details.\n\tAlso see contrib/findssl.sh for help identifying header/library mismatches.])\n\t\t\tfi\n\t\t],\n\t\t[\n\t\t\tAC_MSG_WARN([cross compiling: not checking])\n\t\t]\n\t)\n\n\tAC_MSG_CHECKING([if programs using OpenSSL functions will link])\n\tAC_LINK_IFELSE(\n\t\t[AC_LANG_PROGRAM([[ #include <openssl/err.h> ]],\n\t\t[[ ERR_load_crypto_strings(); ]])],\n\t\t[\n\t\t\tAC_MSG_RESULT([yes])\n\t\t],\n\t\t[\n\t\t\tAC_MSG_RESULT([no])\n\t\t\tLIBS=\"$LIBS -ldl\"\n\t\t\tAC_MSG_CHECKING([if programs using OpenSSL need -ldl])\n\t\t\tAC_LINK_IFELSE(\n\t\t\t\t[AC_LANG_PROGRAM([[ #include <openssl/err.h> ]],\n\t\t\t\t[[ ERR_load_crypto_strings(); ]])],\n\t\t\t\t[\n\t\t\t\t\tAC_MSG_RESULT([yes])\n\t\t\t\t\tCHANNELLIBS=\"$CHANNELLIBS -ldl\"\n\t\t\t\t],\n\t\t\t\t[\n\t\t\t\t\tAC_MSG_RESULT([no])\n\t\t\t\t]\n\t\t\t)\n\t\t]\n\t)\n\n\tAC_CHECK_FUNCS([ \\\n\t\tBN_is_prime_ex \\\n\t\tDES_crypt \\\n\t\tDSA_generate_parameters_ex \\\n\t\tEVP_DigestFinal_ex \\\n\t\tEVP_DigestInit_ex \\\n\t\tEVP_MD_CTX_cleanup \\\n\t\tEVP_MD_CTX_copy_ex \\\n\t\tEVP_MD_CTX_init \\\n\t\tHMAC_CTX_init \\\n\t\tRSA_generate_key_ex \\\n\t\tRSA_get_default_method \\\n\t])\n\n\t# OpenSSL_add_all_algorithms may be a macro.\n\tAC_CHECK_FUNC(OpenSSL_add_all_algorithms,\n\t    AC_DEFINE(HAVE_OPENSSL_ADD_ALL_ALGORITHMS, 1, [as a function]),\n\t    AC_CHECK_DECL(OpenSSL_add_all_algorithms,\n\t\tAC_DEFINE(HAVE_OPENSSL_ADD_ALL_ALGORITHMS, 1, [as a macro]), ,\n\t\t[[#include <openssl/evp.h>]]\n\t    )\n\t)\n\n\t# LibreSSL/OpenSSL API differences\n\tAC_CHECK_FUNCS([ \\\n\t\tEVP_CIPHER_CTX_iv \\\n\t\tEVP_CIPHER_CTX_iv_noconst \\\n\t\tEVP_CIPHER_CTX_get_iv \\\n\t\tEVP_CIPHER_CTX_get_updated_iv \\\n\t\tEVP_CIPHER_CTX_set_iv \\\n\t])\n\n\tif test \"x$openssl_engine\" = \"xyes\" ; then\n\t\tAC_MSG_CHECKING([for OpenSSL ENGINE support])\n\t\tAC_COMPILE_IFELSE([AC_LANG_PROGRAM([[\n\t#include <openssl/engine.h>\n\t\t\t]], [[\n\t\t\t\tENGINE_load_builtin_engines();\n\t\t\t\tENGINE_register_all_complete();\n\t\t\t]])],\n\t\t\t[ AC_MSG_RESULT([yes])\n\t\t\t  AC_DEFINE([USE_OPENSSL_ENGINE], [1],\n\t\t\t     [Enable OpenSSL engine support])\n\t\t\t], [ AC_MSG_ERROR([OpenSSL ENGINE support not found])\n\t\t])\n\tfi\n\n\t# Check for OpenSSL without EVP_aes_{192,256}_cbc\n\tAC_MSG_CHECKING([whether OpenSSL has crippled AES support])\n\tAC_LINK_IFELSE(\n\t\t[AC_LANG_PROGRAM([[\n\t#include <stdlib.h>\n\t#include <string.h>\n\t#include <openssl/evp.h>\n\t\t]], [[\n\t\texit(EVP_aes_192_cbc() == NULL || EVP_aes_256_cbc() == NULL);\n\t\t]])],\n\t\t[\n\t\t\tAC_MSG_RESULT([no])\n\t\t],\n\t\t[\n\t\t\tAC_MSG_RESULT([yes])\n\t\t\tAC_DEFINE([OPENSSL_LOBOTOMISED_AES], [1],\n\t\t\t    [libcrypto is missing AES 192 and 256 bit functions])\n\t\t]\n\t)\n\n\tAC_MSG_CHECKING([if EVP_DigestUpdate returns an int])\n\tAC_LINK_IFELSE(\n\t\t[AC_LANG_PROGRAM([[\n\t#include <stdlib.h>\n\t#include <string.h>\n\t#include <openssl/evp.h>\n\t\t]], [[\n\t\tif(EVP_DigestUpdate(NULL, NULL,0))\n\t\t\texit(0);\n\t\t]])],\n\t\t[\n\t\t\tAC_MSG_RESULT([yes])\n\t\t],\n\t\t[\n\t\t\tAC_MSG_RESULT([no])\n\t\t\tAC_DEFINE([OPENSSL_EVP_DIGESTUPDATE_VOID], [1],\n\t\t\t    [Define if EVP_DigestUpdate returns void])\n\t\t]\n\t)\n\n\t# Check for various EVP support in OpenSSL\n\tAC_CHECK_FUNCS([EVP_sha256 EVP_sha384 EVP_sha512 EVP_chacha20])\n\n\t# Check complete ECC support in OpenSSL\n\tAC_MSG_CHECKING([whether OpenSSL has NID_X9_62_prime256v1])\n\tAC_LINK_IFELSE(\n\t\t[AC_LANG_PROGRAM([[\n\t#include <openssl/ec.h>\n\t#include <openssl/ecdh.h>\n\t#include <openssl/ecdsa.h>\n\t#include <openssl/evp.h>\n\t#include <openssl/objects.h>\n\t#include <openssl/opensslv.h>\n\t\t]], [[\n\t\tEC_KEY *e = EC_KEY_new_by_curve_name(NID_X9_62_prime256v1);\n\t\tconst EVP_MD *m = EVP_sha256(); /* We need this too */\n\t\t]])],\n\t\t[ AC_MSG_RESULT([yes])\n\t\t  enable_nistp256=1 ],\n\t\t[ AC_MSG_RESULT([no]) ]\n\t)\n\n\tAC_MSG_CHECKING([whether OpenSSL has NID_secp384r1])\n\tAC_LINK_IFELSE(\n\t\t[AC_LANG_PROGRAM([[\n\t#include <openssl/ec.h>\n\t#include <openssl/ecdh.h>\n\t#include <openssl/ecdsa.h>\n\t#include <openssl/evp.h>\n\t#include <openssl/objects.h>\n\t#include <openssl/opensslv.h>\n\t\t]], [[\n\t\tEC_KEY *e = EC_KEY_new_by_curve_name(NID_secp384r1);\n\t\tconst EVP_MD *m = EVP_sha384(); /* We need this too */\n\t\t]])],\n\t\t[ AC_MSG_RESULT([yes])\n\t\t  enable_nistp384=1 ],\n\t\t[ AC_MSG_RESULT([no]) ]\n\t)\n\n\tAC_MSG_CHECKING([whether OpenSSL has NID_secp521r1])\n\tAC_LINK_IFELSE(\n\t\t[AC_LANG_PROGRAM([[\n\t#include <openssl/ec.h>\n\t#include <openssl/ecdh.h>\n\t#include <openssl/ecdsa.h>\n\t#include <openssl/evp.h>\n\t#include <openssl/objects.h>\n\t#include <openssl/opensslv.h>\n\t\t]], [[\n\t\tEC_KEY *e = EC_KEY_new_by_curve_name(NID_secp521r1);\n\t\tconst EVP_MD *m = EVP_sha512(); /* We need this too */\n\t\t]])],\n\t\t[ AC_MSG_RESULT([yes])\n\t\t  AC_MSG_CHECKING([if OpenSSL's NID_secp521r1 is functional])\n\t\t  AC_RUN_IFELSE(\n\t\t\t[AC_LANG_PROGRAM([[\n\t#include <stdlib.h>\n\t#include <openssl/ec.h>\n\t#include <openssl/ecdh.h>\n\t#include <openssl/ecdsa.h>\n\t#include <openssl/evp.h>\n\t#include <openssl/objects.h>\n\t#include <openssl/opensslv.h>\n\t\t\t]],[[\n\t\t\tEC_KEY *e = EC_KEY_new_by_curve_name(NID_secp521r1);\n\t\t\tconst EVP_MD *m = EVP_sha512(); /* We need this too */\n\t\t\texit(e == NULL || m == NULL);\n\t\t\t]])],\n\t\t\t[ AC_MSG_RESULT([yes])\n\t\t\t  enable_nistp521=1 ],\n\t\t\t[ AC_MSG_RESULT([no]) ],\n\t\t\t[ AC_MSG_WARN([cross-compiling: assuming yes])\n\t\t\t  enable_nistp521=1 ]\n\t\t  )],\n\t\tAC_MSG_RESULT([no])\n\t)\n\n\tif test x$enable_nistp256 = x1 || test x$enable_nistp384 = x1 || \\\n\t    test x$enable_nistp521 = x1; then\n\t\tAC_DEFINE(OPENSSL_HAS_ECC, [1], [OpenSSL has ECC])\n\t\tAC_CHECK_FUNCS([EC_KEY_METHOD_new])\n\t\topenssl_ecc=yes\n\telse\n\t\topenssl_ecc=no\n\tfi\n\tif test x$enable_nistp256 = x1; then\n\t\tAC_DEFINE([OPENSSL_HAS_NISTP256], [1],\n\t\t    [libcrypto has NID_X9_62_prime256v1])\n\telse\n\t\tunsupported_algorithms=\"$unsupported_algorithms \\\n\t\t\tecdsa-sha2-nistp256 \\\n\t\t\tecdh-sha2-nistp256 \\\n\t\t\tecdsa-sha2-nistp256-cert-v01@openssh.com\"\n\tfi\n\tif test x$enable_nistp384 = x1; then\n\t\tAC_DEFINE([OPENSSL_HAS_NISTP384], [1], [libcrypto has NID_secp384r1])\n\telse\n\t\tunsupported_algorithms=\"$unsupported_algorithms \\\n\t\t\tecdsa-sha2-nistp384 \\\n\t\t\tecdh-sha2-nistp384 \\\n\t\t\tecdsa-sha2-nistp384-cert-v01@openssh.com\"\n\tfi\n\tif test x$enable_nistp521 = x1; then\n\t\tAC_DEFINE([OPENSSL_HAS_NISTP521], [1], [libcrypto has NID_secp521r1])\n\telse\n\t\tunsupported_algorithms=\"$unsupported_algorithms \\\n\t\t\tecdh-sha2-nistp521 \\\n\t\t\tecdsa-sha2-nistp521 \\\n\t\t\tecdsa-sha2-nistp521-cert-v01@openssh.com\"\n\tfi\n\n\t# Check libcrypto ED25519 support\n\tAC_CHECK_FUNCS([EVP_PKEY_get_raw_public_key])\n\tAC_CHECK_FUNCS([EVP_PKEY_get_raw_private_key])\n\tAC_MSG_CHECKING([whether OpenSSL has ED25519 support])\n\tAC_LINK_IFELSE(\n\t\t[AC_LANG_PROGRAM([[\n\t#include <string.h>\n\t#include <openssl/evp.h>\n\t\t]], [[\n\t\tunsigned char buf[64];\n\t\tmemset(buf, 0, sizeof(buf));\n\t\texit(EVP_PKEY_new_raw_private_key(EVP_PKEY_ED25519,\n\t\t    buf, sizeof(buf)) == NULL);\n\t\t]])],\n\t\t[\n\t\t\tAC_MSG_RESULT([yes])\n\t\t\tAC_DEFINE([OPENSSL_HAS_ED25519], [1],\n\t\t\t    [libcrypto has ed25519 support])\n\t\t],\n\t\t[\n\t\t\tAC_MSG_RESULT([no])\n\t\t]\n\t)\nfi\n\n# PKCS11/U2F depend on OpenSSL and dlopen().\nenable_pkcs11=yes\nenable_sk=yes\nif test \"x$openssl\" != \"xyes\" ; then\n\tenable_pkcs11=\"disabled; missing libcrypto\"\nfi\nif test \"x$ac_cv_func_dlopen\" != \"xyes\" ; then\n\tenable_pkcs11=\"disabled; missing dlopen(3)\"\n\tenable_sk=\"disabled; missing dlopen(3)\"\nfi\nif test \"x$ac_cv_have_decl_RTLD_NOW\" != \"xyes\" ; then\n\tenable_pkcs11=\"disabled; missing RTLD_NOW\"\n\tenable_sk=\"disabled; missing RTLD_NOW\"\nfi\nif test ! -z \"$disable_pkcs11\" ; then\n\tenable_pkcs11=\"disabled by user\"\nfi\nif test ! -z \"$disable_sk\" ; then\n\tenable_sk=\"disabled by user\"\nfi\n\nAC_MSG_CHECKING([whether to enable PKCS11])\nif test \"x$enable_pkcs11\" = \"xyes\" ; then\n\tAC_DEFINE([ENABLE_PKCS11], [], [Enable for PKCS#11 support])\nfi\nAC_MSG_RESULT([$enable_pkcs11])\n\nAC_MSG_CHECKING([whether to enable U2F])\nif test \"x$enable_sk\" = \"xyes\" ; then\n\tAC_DEFINE([ENABLE_SK], [], [Enable for U2F/FIDO support])\n\tAC_SUBST(SK_DUMMY_LIBRARY, [regress/misc/sk-dummy/sk-dummy.so])\nelse\n\t# Do not try to build sk-dummy library.\n\tAC_SUBST(SK_DUMMY_LIBRARY, [\"\"])\nfi\nAC_MSG_RESULT([$enable_sk])\n\n# Now check for built-in security key support.\nif test \"x$enable_sk\" = \"xyes\" -a \"x$enable_sk_internal\" != \"xno\" ; then\n\tuse_pkgconfig_for_libfido2=\n\tif test \"x$PKGCONFIG\" != \"xno\"; then\n\t\tAC_MSG_CHECKING([if $PKGCONFIG knows about libfido2])\n\t\tif \"$PKGCONFIG\" libfido2; then\n\t\t\tAC_MSG_RESULT([yes])\n\t\t\tuse_pkgconfig_for_libfido2=yes\n\t\telse\n\t\t\tAC_MSG_RESULT([no])\n\t\tfi\n\tfi\n\tif test \"x$use_pkgconfig_for_libfido2\" = \"xyes\"; then\n\t\tLIBFIDO2=`$PKGCONFIG --libs libfido2`\n\t\tCPPFLAGS=\"$CPPFLAGS `$PKGCONFIG --cflags libfido2`\"\n\telse\n\t\tLIBFIDO2=\"-lfido2 -lcbor\"\n\tfi\n\tOTHERLIBS=`echo $LIBFIDO2 | sed 's/-lfido2//'`\n\tfido2_error=\n\tAC_CHECK_LIB([fido2], [fido_init],\n\t\t[ ],\n\t\t[ fido2_error=\"missing/unusable libfido2\" ],\n\t\t[ $OTHERLIBS ]\n\t)\n\tAC_CHECK_HEADER([fido.h], [],\n\t\t[ fido2_error=\"missing fido.h from libfido2\" ])\n\tAC_CHECK_HEADER([fido/credman.h], [],\n\t\t[ fido2_error=\"missing fido/credman.h from libfido2\" ],\n\t\t[ #include <fido.h> ]\n\t)\n\tAC_MSG_CHECKING([for usable libfido2 installation])\n\tif test ! -z \"$fido2_error\" ; then\n\t\tAC_MSG_RESULT([$fido2_error])\n\t\tif test \"x$enable_sk_internal\" = \"xyes\" ; then\n\t\t\tAC_MSG_ERROR([No usable libfido2 library/headers found])\n\t\tfi\n\t\tLIBFIDO2=\"\"\n\telse\n\t\tAC_MSG_RESULT([yes])\n\t\tAC_SUBST([LIBFIDO2])\n\t\tAC_DEFINE([ENABLE_SK_INTERNAL], [],\n\t\t    [Enable for built-in U2F/FIDO support])\n\t\tenable_sk=\"built-in\"\n\t\tsaved_LIBS=\"$LIBS\"\n\t\tLIBS=\"$LIBFIDO2 $LIBS\"\n\t\tAC_CHECK_FUNCS([ \\\n\t\t\tfido_assert_set_clientdata \\\n\t\t\tfido_cred_prot \\\n\t\t\tfido_cred_set_prot \\\n\t\t\tfido_cred_set_clientdata \\\n\t\t\tfido_dev_get_touch_begin \\\n\t\t\tfido_dev_get_touch_status \\\n\t\t\tfido_dev_supports_cred_prot \\\n\t\t\tfido_dev_is_winhello \\\n\t\t])\n\t\tLIBS=\"$saved_LIBS\"\n\tfi\nfi\n\nAC_CHECK_FUNCS([ \\\n\tarc4random \\\n\tarc4random_buf \\\n\tarc4random_stir \\\n\tarc4random_uniform \\\n])\n### Configure cryptographic random number support\n\n# Check whether OpenSSL seeds itself\nif test \"x$openssl\" = \"xyes\" ; then\n\tAC_MSG_CHECKING([whether OpenSSL's PRNG is internally seeded])\n\tAC_RUN_IFELSE(\n\t\t[AC_LANG_PROGRAM([[\n\t#include <stdlib.h>\n\t#include <string.h>\n\t#include <openssl/rand.h>\n\t\t]], [[\n\t\texit(RAND_status() == 1 ? 0 : 1);\n\t\t]])],\n\t\t[\n\t\t\tOPENSSL_SEEDS_ITSELF=yes\n\t\t\tAC_MSG_RESULT([yes])\n\t\t],\n\t\t[\n\t\t\tAC_MSG_RESULT([no])\n\t\t],\n\t\t[\n\t\t\tAC_MSG_WARN([cross compiling: assuming yes])\n\t\t\t# This is safe, since we will fatal() at runtime if\n\t\t\t# OpenSSL is not seeded correctly.\n\t\t\tOPENSSL_SEEDS_ITSELF=yes\n\t\t]\n\t)\nfi\n\n# PRNGD TCP socket\nAC_ARG_WITH([prngd-port],\n\t[  --with-prngd-port=PORT  read entropy from PRNGD/EGD TCP localhost:PORT],\n\t[\n\t\tcase \"$withval\" in\n\t\tno)\n\t\t\twithval=\"\"\n\t\t\t;;\n\t\t[[0-9]]*)\n\t\t\t;;\n\t\t*)\n\t\t\tAC_MSG_ERROR([You must specify a numeric port number for --with-prngd-port])\n\t\t\t;;\n\t\tesac\n\t\tif test ! -z \"$withval\" ; then\n\t\t\tPRNGD_PORT=\"$withval\"\n\t\t\tAC_DEFINE_UNQUOTED([PRNGD_PORT], [$PRNGD_PORT],\n\t\t\t\t[Port number of PRNGD/EGD random number socket])\n\t\tfi\n\t]\n)\n\n# PRNGD Unix domain socket\nAC_ARG_WITH([prngd-socket],\n\t[  --with-prngd-socket=FILE read entropy from PRNGD/EGD socket FILE (default=/var/run/egd-pool)],\n\t[\n\t\tcase \"$withval\" in\n\t\tyes)\n\t\t\twithval=\"/var/run/egd-pool\"\n\t\t\t;;\n\t\tno)\n\t\t\twithval=\"\"\n\t\t\t;;\n\t\t/*)\n\t\t\t;;\n\t\t*)\n\t\t\tAC_MSG_ERROR([You must specify an absolute path to the entropy socket])\n\t\t\t;;\n\t\tesac\n\n\t\tif test ! -z \"$withval\" ; then\n\t\t\tif test ! -z \"$PRNGD_PORT\" ; then\n\t\t\t\tAC_MSG_ERROR([You may not specify both a PRNGD/EGD port and socket])\n\t\t\tfi\n\t\t\tif test ! -r \"$withval\" ; then\n\t\t\t\tAC_MSG_WARN([Entropy socket is not readable])\n\t\t\tfi\n\t\t\tPRNGD_SOCKET=\"$withval\"\n\t\t\tAC_DEFINE_UNQUOTED([PRNGD_SOCKET], [\"$PRNGD_SOCKET\"],\n\t\t\t\t[Location of PRNGD/EGD random number socket])\n\t\tfi\n\t],\n\t[\n\t\t# Check for existing socket only if we don't have a random device already\n\t\tif test \"x$OPENSSL_SEEDS_ITSELF\" != \"xyes\" ; then\n\t\t\tAC_MSG_CHECKING([for PRNGD/EGD socket])\n\t\t\t# Insert other locations here\n\t\t\tfor sock in /var/run/egd-pool /dev/egd-pool /etc/entropy; do\n\t\t\t\tif test -r $sock && $TEST_MINUS_S_SH -c \"test -S $sock -o -p $sock\" ; then\n\t\t\t\t\tPRNGD_SOCKET=\"$sock\"\n\t\t\t\t\tAC_DEFINE_UNQUOTED([PRNGD_SOCKET], [\"$PRNGD_SOCKET\"])\n\t\t\t\t\tbreak;\n\t\t\t\tfi\n\t\t\tdone\n\t\t\tif test ! -z \"$PRNGD_SOCKET\" ; then\n\t\t\t\tAC_MSG_RESULT([$PRNGD_SOCKET])\n\t\t\telse\n\t\t\t\tAC_MSG_RESULT([not found])\n\t\t\tfi\n\t\tfi\n\t]\n)\n\n# Which randomness source do we use?\nif test ! -z \"$PRNGD_PORT\" ; then\n\tRAND_MSG=\"PRNGd port $PRNGD_PORT\"\nelif test ! -z \"$PRNGD_SOCKET\" ; then\n\tRAND_MSG=\"PRNGd socket $PRNGD_SOCKET\"\nelif test ! -z \"$OPENSSL_SEEDS_ITSELF\" ; then\n\tAC_DEFINE([OPENSSL_PRNG_ONLY], [1],\n\t\t[Define if you want the OpenSSL internally seeded PRNG only])\n\tRAND_MSG=\"OpenSSL internal ONLY\"\nelif test \"x$openssl\" = \"xno\" ; then\n\tAC_MSG_WARN([OpenSSH will use /dev/urandom as a source of random numbers. It will fail if this device is not supported or accessible])\nelse\n\tAC_MSG_ERROR([OpenSSH has no source of random numbers. Please configure OpenSSL with an entropy source or re-run configure using one of the --with-prngd-port or --with-prngd-socket options])\nfi\nLIBS=\"$nocrypto_saved_LIBS\"\n\nsaved_LIBS=\"$LIBS\"\nAC_CHECK_LIB([iaf], [ia_openinfo], [\n\tLIBS=\"$LIBS -liaf\"\n\tAC_CHECK_FUNCS([set_id], [SSHDLIBS=\"$SSHDLIBS -liaf\"\n\t\t\t\tAC_DEFINE([HAVE_LIBIAF], [1],\n\t\t\t[Define if system has libiaf that supports set_id])\n\t\t\t\t])\n])\nLIBS=\"$saved_LIBS\"\n\n# Check for crypt() in libcrypt.  If we have it, we only need it for sshd.\nsaved_LIBS=\"$LIBS\"\nAC_CHECK_LIB([crypt], [crypt], [\n\tLIBS=\"-lcrypt $LIBS\"\n\tSSHDLIBS=\"-lcrypt $SSHDLIBS\"\n])\nAC_CHECK_FUNCS([crypt])\nLIBS=\"$saved_LIBS\"\n\n# Check for PAM libs\nPAM_MSG=\"no\"\nAC_ARG_WITH([pam],\n\t[  --with-pam              Enable PAM support ],\n\t[\n\t\tif test \"x$withval\" != \"xno\" ; then\n\t\t\tif test \"x$ac_cv_header_security_pam_appl_h\" != \"xyes\" && \\\n\t\t\t   test \"x$ac_cv_header_pam_pam_appl_h\" != \"xyes\" ; then\n\t\t\t\tAC_MSG_ERROR([PAM headers not found])\n\t\t\tfi\n\n\t\t\tsaved_LIBS=\"$LIBS\"\n\t\t\tAC_CHECK_LIB([dl], [dlopen], , )\n\t\t\tAC_CHECK_LIB([pam], [pam_set_item], , [AC_MSG_ERROR([*** libpam missing])])\n\t\t\tAC_CHECK_FUNCS([pam_getenvlist])\n\t\t\tAC_CHECK_FUNCS([pam_putenv])\n\t\t\tLIBS=\"$saved_LIBS\"\n\n\t\t\tPAM_MSG=\"yes\"\n\n\t\t\tSSHDLIBS=\"$SSHDLIBS -lpam\"\n\t\t\tAC_DEFINE([USE_PAM], [1],\n\t\t\t\t[Define if you want to enable PAM support])\n\n\t\t\tif test $ac_cv_lib_dl_dlopen = yes; then\n\t\t\t\tcase \"$LIBS\" in\n\t\t\t\t*-ldl*)\n\t\t\t\t\t# libdl already in LIBS\n\t\t\t\t\t;;\n\t\t\t\t*)\n\t\t\t\t\tSSHDLIBS=\"$SSHDLIBS -ldl\"\n\t\t\t\t\t;;\n\t\t\t\tesac\n\t\t\tfi\n\t\tfi\n\t]\n)\n\nAC_ARG_WITH([pam-service],\n\t[  --with-pam-service=name Specify PAM service name ],\n\t[\n\t\tif test \"x$withval\" != \"xno\" && \\\n\t\t   test \"x$withval\" != \"xyes\" ; then\n\t\t\tAC_DEFINE_UNQUOTED([SSHD_PAM_SERVICE],\n\t\t\t\t[\"$withval\"], [sshd PAM service name])\n\t\tfi\n\t]\n)\n\n# Check for older PAM\nif test \"x$PAM_MSG\" = \"xyes\" ; then\n\t# Check PAM strerror arguments (old PAM)\n\tAC_MSG_CHECKING([whether pam_strerror takes only one argument])\n\tAC_COMPILE_IFELSE([AC_LANG_PROGRAM([[\n#include <stdlib.h>\n#if defined(HAVE_SECURITY_PAM_APPL_H)\n#include <security/pam_appl.h>\n#elif defined (HAVE_PAM_PAM_APPL_H)\n#include <pam/pam_appl.h>\n#endif\n\t\t]], [[\n(void)pam_strerror((pam_handle_t *)NULL, -1);\n\t\t]])], [AC_MSG_RESULT([no])], [\n\t\t\tAC_DEFINE([HAVE_OLD_PAM], [1],\n\t\t\t\t[Define if you have an old version of PAM\n\t\t\t\twhich takes only one argument to pam_strerror])\n\t\t\tAC_MSG_RESULT([yes])\n\t\t\tPAM_MSG=\"yes (old library)\"\n\n\t])\nfi\n\ncase \"$host\" in\n*-*-cygwin*)\n\tSSH_PRIVSEP_USER=CYGWIN_SSH_PRIVSEP_USER\n\t;;\n*)\n\tSSH_PRIVSEP_USER=sshd\n\t;;\nesac\nAC_ARG_WITH([privsep-user],\n\t[  --with-privsep-user=user Specify non-privileged user for privilege separation],\n\t[\n\t\tif test -n \"$withval\"  &&  test \"x$withval\" != \"xno\"  &&  \\\n\t\t    test \"x${withval}\" != \"xyes\"; then\n\t\t\tSSH_PRIVSEP_USER=$withval\n\t\tfi\n\t]\n)\nif test \"x$SSH_PRIVSEP_USER\" = \"xCYGWIN_SSH_PRIVSEP_USER\" ; then\n\tAC_DEFINE_UNQUOTED([SSH_PRIVSEP_USER], [CYGWIN_SSH_PRIVSEP_USER],\n\t\t[Cygwin function to fetch non-privileged user for privilege separation])\nelse\n\tAC_DEFINE_UNQUOTED([SSH_PRIVSEP_USER], [\"$SSH_PRIVSEP_USER\"],\n\t\t[non-privileged user for privilege separation])\nfi\nAC_SUBST([SSH_PRIVSEP_USER])\n\nif test \"x$have_linux_no_new_privs\" = \"x1\" ; then\nAC_CHECK_DECL([SECCOMP_MODE_FILTER], [have_seccomp_filter=1], , [\n\t#include <sys/types.h>\n\t#include <linux/seccomp.h>\n])\nfi\nif test \"x$have_seccomp_filter\" = \"x1\" ; then\nAC_MSG_CHECKING([kernel for seccomp_filter support])\nAC_LINK_IFELSE([AC_LANG_PROGRAM([[\n\t\t#include <errno.h>\n\t\t#include <elf.h>\n\t\t#include <linux/audit.h>\n\t\t#include <linux/seccomp.h>\n\t\t#include <stdlib.h>\n\t\t#include <sys/prctl.h>\n\t]],\n\t[[ int i = $seccomp_audit_arch;\n\t   errno = 0;\n\t   prctl(PR_SET_SECCOMP, SECCOMP_MODE_FILTER, NULL, 0, 0);\n\t   exit(errno == EFAULT ? 0 : 1); ]])],\n\t[ AC_MSG_RESULT([yes]) ], [\n\t\tAC_MSG_RESULT([no])\n\t\t# Disable seccomp filter as a target\n\t\thave_seccomp_filter=0\n\t]\n)\nfi\n\nAC_CHECK_MEMBERS([struct pollfd.fd], [], [], [[\n#include <sys/types.h>\n#ifdef HAVE_POLL_H\n#include <poll.h>\n#endif\n#ifdef HAVE_SYS_POLL_H\n#include <sys/poll.h>\n#endif\n]])\n\nAC_CHECK_TYPES([nfds_t], , , [\n#include <sys/types.h>\n#ifdef HAVE_POLL_H\n#include <poll.h>\n#endif\n#ifdef HAVE_SYS_POLL_H\n#include <sys/poll.h>\n#endif\n])\n\n# Decide which sandbox style to use\nsandbox_arg=\"\"\nAC_ARG_WITH([sandbox],\n\t[  --with-sandbox=style    Specify privilege separation sandbox (no, capsicum, darwin, rlimit, seccomp_filter, systrace, pledge)],\n\t[\n\t\tif test \"x$withval\" = \"xyes\" ; then\n\t\t\tsandbox_arg=\"\"\n\t\telse\n\t\t\tsandbox_arg=\"$withval\"\n\t\tfi\n\t]\n)\n\nif test \"x$sandbox_arg\" != \"xno\"; then\n# POSIX specifies that poll() \"shall fail with EINVAL if the nfds argument\n# is greater than OPEN_MAX\".  On some platforms that includes implementions\n# of select in userspace on top of poll() so check both work with rlimit\n# NOFILES so check that both work before enabling the rlimit sandbox.\n    AC_MSG_CHECKING([if select and/or poll works with descriptor rlimit])\n    AC_RUN_IFELSE(\n\t[AC_LANG_PROGRAM([[\n#include <sys/types.h>\n#ifdef HAVE_SYS_TIME_H\n# include <sys/time.h>\n#endif\n#include <sys/resource.h>\n#ifdef HAVE_SYS_SELECT_H\n# include <sys/select.h>\n#endif\n#ifdef HAVE_POLL_H\n# include <poll.h>\n#elif HAVE_SYS_POLL_H\n# include <sys/poll.h>\n#endif\n#include <errno.h>\n#include <fcntl.h>\n#include <stdlib.h>\n\t]],[[\n\tstruct rlimit rl_zero;\n\tint fd, r;\n\tfd_set fds;\n\tstruct timeval tv;\n#ifdef HAVE_POLL\n\tstruct pollfd pfd;\n#endif\n\n\tfd = open(\"/dev/null\", O_RDONLY);\n\tFD_ZERO(&fds);\n\tFD_SET(fd, &fds);\n\trl_zero.rlim_cur = rl_zero.rlim_max = 0;\n\tsetrlimit(RLIMIT_FSIZE, &rl_zero);\n\tsetrlimit(RLIMIT_NOFILE, &rl_zero);\n\ttv.tv_sec = 1;\n\ttv.tv_usec = 0;\n\tr = select(fd+1, &fds, NULL, NULL, &tv);\n\tif (r == -1)\n\t\texit(1);\n#ifdef HAVE_POLL\n\tpfd.fd = fd;\n\tpfd.events = POLLIN;\n\tr = poll(&pfd, 1, 1);\n\tif (r == -1)\n\t\texit(2);\n#endif\n\texit(0);\n\t]])],\n\t[AC_MSG_RESULT([yes])\n\t select_works_with_rlimit=yes],\n\t[AC_MSG_RESULT([no])\n\t select_works_with_rlimit=no],\n\t[AC_MSG_WARN([cross compiling: assuming no])\n\t select_works_with_rlimit=no]\n    )\n\n    AC_MSG_CHECKING([if setrlimit(RLIMIT_NOFILE,{0,0}) works])\n    AC_RUN_IFELSE(\n\t[AC_LANG_PROGRAM([[\n#include <sys/types.h>\n#ifdef HAVE_SYS_TIME_H\n# include <sys/time.h>\n#endif\n#include <sys/resource.h>\n#include <errno.h>\n#include <stdlib.h>\n\t]],[[\n\tstruct rlimit rl_zero;\n\tint r;\n\n\trl_zero.rlim_cur = rl_zero.rlim_max = 0;\n\tr = setrlimit(RLIMIT_NOFILE, &rl_zero);\n\texit (r == -1 ? 1 : 0);\n\t]])],\n\t[AC_MSG_RESULT([yes])\n\t rlimit_nofile_zero_works=yes],\n\t[AC_MSG_RESULT([no])\n\t rlimit_nofile_zero_works=no],\n\t[AC_MSG_WARN([cross compiling: assuming yes])\n\t rlimit_nofile_zero_works=yes]\n    )\n\n    AC_MSG_CHECKING([if setrlimit RLIMIT_FSIZE works])\n    AC_RUN_IFELSE(\n\t[AC_LANG_PROGRAM([[\n#include <sys/types.h>\n#include <sys/resource.h>\n#include <stdlib.h>\n\t]],[[\n\t\tstruct rlimit rl_zero;\n\n\t\trl_zero.rlim_cur = rl_zero.rlim_max = 0;\n\t\texit(setrlimit(RLIMIT_FSIZE, &rl_zero) != 0);\n\t]])],\n\t[AC_MSG_RESULT([yes])],\n\t[AC_MSG_RESULT([no])\n\t AC_DEFINE(SANDBOX_SKIP_RLIMIT_FSIZE, 1,\n\t    [setrlimit RLIMIT_FSIZE works])],\n\t[AC_MSG_WARN([cross compiling: assuming yes])]\n    )\nfi\n\nif test \"x$sandbox_arg\" = \"xpledge\" || \\\n   ( test -z \"$sandbox_arg\" && test \"x$ac_cv_func_pledge\" = \"xyes\" ) ; then\n\ttest \"x$ac_cv_func_pledge\" != \"xyes\" && \\\n\t\tAC_MSG_ERROR([pledge sandbox requires pledge(2) support])\n\tSANDBOX_STYLE=\"pledge\"\n\tAC_DEFINE([SANDBOX_PLEDGE], [1], [Sandbox using pledge(2)])\nelif test \"x$sandbox_arg\" = \"xsystrace\" || \\\n   ( test -z \"$sandbox_arg\" && test \"x$have_systr_policy_kill\" = \"x1\" ) ; then\n\ttest \"x$have_systr_policy_kill\" != \"x1\" && \\\n\t\tAC_MSG_ERROR([systrace sandbox requires systrace headers and SYSTR_POLICY_KILL support])\n\tSANDBOX_STYLE=\"systrace\"\n\tAC_DEFINE([SANDBOX_SYSTRACE], [1], [Sandbox using systrace(4)])\nelif test \"x$sandbox_arg\" = \"xdarwin\" || \\\n     ( test -z \"$sandbox_arg\" && test \"x$ac_cv_func_sandbox_init\" = \"xyes\" && \\\n       test \"x$ac_cv_header_sandbox_h\" = \"xyes\") ; then\n\ttest \"x$ac_cv_func_sandbox_init\" != \"xyes\" -o \\\n\t     \"x$ac_cv_header_sandbox_h\" != \"xyes\" && \\\n\t\tAC_MSG_ERROR([Darwin seatbelt sandbox requires sandbox.h and sandbox_init function])\n\tSANDBOX_STYLE=\"darwin\"\n\tAC_DEFINE([SANDBOX_DARWIN], [1], [Sandbox using Darwin sandbox_init(3)])\nelif test \"x$sandbox_arg\" = \"xseccomp_filter\" || \\\n     ( test -z \"$sandbox_arg\" && \\\n       test \"x$have_seccomp_filter\" = \"x1\" && \\\n       test \"x$ac_cv_header_elf_h\" = \"xyes\" && \\\n       test \"x$ac_cv_header_linux_audit_h\" = \"xyes\" && \\\n       test \"x$ac_cv_header_linux_filter_h\" = \"xyes\" && \\\n       test \"x$seccomp_audit_arch\" != \"x\" && \\\n       test \"x$have_linux_no_new_privs\" = \"x1\" && \\\n       test \"x$ac_cv_func_prctl\" = \"xyes\" ) ; then\n\ttest \"x$seccomp_audit_arch\" = \"x\" && \\\n\t\tAC_MSG_ERROR([seccomp_filter sandbox not supported on $host])\n\ttest \"x$have_linux_no_new_privs\" != \"x1\" && \\\n\t\tAC_MSG_ERROR([seccomp_filter sandbox requires PR_SET_NO_NEW_PRIVS])\n\ttest \"x$have_seccomp_filter\" != \"x1\" && \\\n\t\tAC_MSG_ERROR([seccomp_filter sandbox requires seccomp headers])\n\ttest \"x$ac_cv_func_prctl\" != \"xyes\" && \\\n\t\tAC_MSG_ERROR([seccomp_filter sandbox requires prctl function])\n\tSANDBOX_STYLE=\"seccomp_filter\"\n\tAC_DEFINE([SANDBOX_SECCOMP_FILTER], [1], [Sandbox using seccomp filter])\nelif test \"x$sandbox_arg\" = \"xcapsicum\" || \\\n     ( test -z \"$sandbox_arg\" && \\\n       test \"x$disable_capsicum\" != \"xyes\" && \\\n       test \"x$ac_cv_header_sys_capsicum_h\" = \"xyes\" && \\\n       test \"x$ac_cv_func_cap_rights_limit\" = \"xyes\") ; then\n       test \"x$ac_cv_header_sys_capsicum_h\" != \"xyes\" && \\\n\t\tAC_MSG_ERROR([capsicum sandbox requires sys/capsicum.h header])\n       test \"x$ac_cv_func_cap_rights_limit\" != \"xyes\" && \\\n\t\tAC_MSG_ERROR([capsicum sandbox requires cap_rights_limit function])\n       SANDBOX_STYLE=\"capsicum\"\n       AC_DEFINE([SANDBOX_CAPSICUM], [1], [Sandbox using capsicum])\nelif test \"x$sandbox_arg\" = \"xrlimit\" || \\\n     ( test -z \"$sandbox_arg\" && test \"x$ac_cv_func_setrlimit\" = \"xyes\" && \\\n       test \"x$select_works_with_rlimit\" = \"xyes\" && \\\n       test \"x$rlimit_nofile_zero_works\" = \"xyes\" ) ; then\n\ttest \"x$ac_cv_func_setrlimit\" != \"xyes\" && \\\n\t\tAC_MSG_ERROR([rlimit sandbox requires setrlimit function])\n\ttest \"x$select_works_with_rlimit\" != \"xyes\" && \\\n\t\tAC_MSG_ERROR([rlimit sandbox requires select to work with rlimit])\n\tSANDBOX_STYLE=\"rlimit\"\n\tAC_DEFINE([SANDBOX_RLIMIT], [1], [Sandbox using setrlimit(2)])\nelif test \"x$sandbox_arg\" = \"xsolaris\" || \\\n   ( test -z \"$sandbox_arg\" && test \"x$SOLARIS_PRIVS\" = \"xyes\" ) ; then\n\tSANDBOX_STYLE=\"solaris\"\n\tAC_DEFINE([SANDBOX_SOLARIS], [1], [Sandbox using Solaris/Illumos privileges])\nelif test -z \"$sandbox_arg\" || test \"x$sandbox_arg\" = \"xno\" || \\\n     test \"x$sandbox_arg\" = \"xnone\" || test \"x$sandbox_arg\" = \"xnull\" ; then\n\tSANDBOX_STYLE=\"none\"\n\tAC_DEFINE([SANDBOX_NULL], [1], [no privsep sandboxing])\nelse\n\tAC_MSG_ERROR([unsupported --with-sandbox])\nfi\n\n# Cheap hack to ensure NEWS-OS libraries are arranged right.\nif test ! -z \"$SONY\" ; then\n  LIBS=\"$LIBS -liberty\";\nfi\n\n# Check for long long datatypes\nAC_CHECK_TYPES([long long, unsigned long long, long double])\n\n# Check datatype sizes\nAC_CHECK_SIZEOF([short int])\nAC_CHECK_SIZEOF([int])\nAC_CHECK_SIZEOF([long int])\nAC_CHECK_SIZEOF([long long int])\nAC_CHECK_SIZEOF([time_t], [], [[\n    #include <sys/types.h>\n    #ifdef HAVE_SYS_TIME_H\n    # include <sys/time.h>\n    #endif\n    #ifdef HAVE_TIME_H\n    # include <time.h>\n    #endif\n\t]]\n)\n\n# Sanity check long long for some platforms (AIX)\nif test \"x$ac_cv_sizeof_long_long_int\" = \"x4\" ; then\n\tac_cv_sizeof_long_long_int=0\nfi\n\n# compute LLONG_MIN and LLONG_MAX if we don't know them.\nif test -z \"$have_llong_max\" && test -z \"$have_long_long_max\"; then\n\tAC_MSG_CHECKING([for max value of long long])\n\tAC_RUN_IFELSE(\n\t\t[AC_LANG_PROGRAM([[\n#include <stdio.h>\n#include <stdlib.h>\n/* Why is this so damn hard? */\n#ifdef __GNUC__\n# undef __GNUC__\n#endif\n#define __USE_ISOC99\n#include <limits.h>\n#define DATA \"conftest.llminmax\"\n#define my_abs(a) ((a) < 0 ? ((a) * -1) : (a))\n\n/*\n * printf in libc on some platforms (eg old Tru64) does not understand %lld so\n * we do this the hard way.\n */\nstatic int\nfprint_ll(FILE *f, long long n)\n{\n\tunsigned int i;\n\tint l[sizeof(long long) * 8];\n\n\tif (n < 0)\n\t\tif (fprintf(f, \"-\") < 0)\n\t\t\treturn -1;\n\tfor (i = 0; n != 0; i++) {\n\t\tl[i] = my_abs(n % 10);\n\t\tn /= 10;\n\t}\n\tdo {\n\t\tif (fprintf(f, \"%d\", l[--i]) < 0)\n\t\t\treturn -1;\n\t} while (i != 0);\n\tif (fprintf(f, \" \") < 0)\n\t\treturn -1;\n\treturn 0;\n}\n\t\t]], [[\n\tFILE *f;\n\tlong long i, llmin, llmax = 0;\n\n\tif((f = fopen(DATA,\"w\")) == NULL)\n\t\texit(1);\n\n#if defined(LLONG_MIN) && defined(LLONG_MAX)\n\tfprintf(stderr, \"Using system header for LLONG_MIN and LLONG_MAX\\n\");\n\tllmin = LLONG_MIN;\n\tllmax = LLONG_MAX;\n#else\n\tfprintf(stderr, \"Calculating  LLONG_MIN and LLONG_MAX\\n\");\n\t/* This will work on one's complement and two's complement */\n\tfor (i = 1; i > llmax; i <<= 1, i++)\n\t\tllmax = i;\n\tllmin = llmax + 1LL;\t/* wrap */\n#endif\n\n\t/* Sanity check */\n\tif (llmin + 1 < llmin || llmin - 1 < llmin || llmax + 1 > llmax\n\t    || llmax - 1 > llmax || llmin == llmax || llmin == 0\n\t    || llmax == 0 || llmax < LONG_MAX || llmin > LONG_MIN) {\n\t\tfprintf(f, \"unknown unknown\\n\");\n\t\texit(2);\n\t}\n\n\tif (fprint_ll(f, llmin) < 0)\n\t\texit(3);\n\tif (fprint_ll(f, llmax) < 0)\n\t\texit(4);\n\tif (fclose(f) < 0)\n\t\texit(5);\n\texit(0);\n\t\t]])],\n\t\t[\n\t\t\tllong_min=`$AWK '{print $1}' conftest.llminmax`\n\t\t\tllong_max=`$AWK '{print $2}' conftest.llminmax`\n\n\t\t\tAC_MSG_RESULT([$llong_max])\n\t\t\tAC_DEFINE_UNQUOTED([LLONG_MAX], [${llong_max}LL],\n\t\t\t    [max value of long long calculated by configure])\n\t\t\tAC_MSG_CHECKING([for min value of long long])\n\t\t\tAC_MSG_RESULT([$llong_min])\n\t\t\tAC_DEFINE_UNQUOTED([LLONG_MIN], [${llong_min}LL],\n\t\t\t    [min value of long long calculated by configure])\n\t\t],\n\t\t[\n\t\t\tAC_MSG_RESULT([not found])\n\t\t],\n\t\t[\n\t\t\tAC_MSG_WARN([cross compiling: not checking])\n\t\t]\n\t)\nfi\n\nAC_CHECK_DECLS([UINT32_MAX], , , [[\n#ifdef HAVE_SYS_LIMITS_H\n# include <sys/limits.h>\n#endif\n#ifdef HAVE_LIMITS_H\n# include <limits.h>\n#endif\n#ifdef HAVE_STDINT_H\n# include <stdint.h>\n#endif\n]])\n\n# More checks for data types\nAC_CACHE_CHECK([for u_int type], ac_cv_have_u_int, [\n\tAC_COMPILE_IFELSE([AC_LANG_PROGRAM([[ #include <sys/types.h> ]],\n\t[[ u_int a; a = 1;]])],\n\t[ ac_cv_have_u_int=\"yes\" ], [ ac_cv_have_u_int=\"no\"\n\t])\n])\nif test \"x$ac_cv_have_u_int\" = \"xyes\" ; then\n\tAC_DEFINE([HAVE_U_INT], [1], [define if you have u_int data type])\n\thave_u_int=1\nfi\n\nAC_CACHE_CHECK([for intXX_t types], ac_cv_have_intxx_t, [\n\tAC_COMPILE_IFELSE([AC_LANG_PROGRAM([[ #include <sys/types.h> ]],\n\t[[ int8_t a; int16_t b; int32_t c; a = b = c = 1;]])],\n\t[ ac_cv_have_intxx_t=\"yes\" ], [ ac_cv_have_intxx_t=\"no\"\n\t])\n])\nif test \"x$ac_cv_have_intxx_t\" = \"xyes\" ; then\n\tAC_DEFINE([HAVE_INTXX_T], [1], [define if you have intxx_t data type])\n\thave_intxx_t=1\nfi\n\nif (test -z \"$have_intxx_t\" && \\\n\t   test \"x$ac_cv_header_stdint_h\" = \"xyes\")\nthen\n    AC_MSG_CHECKING([for intXX_t types in stdint.h])\n\tAC_COMPILE_IFELSE([AC_LANG_PROGRAM([[ #include <stdint.h> ]],\n\t[[ int8_t a; int16_t b; int32_t c; a = b = c = 1;]])],\n\t\t[\n\t\t\tAC_DEFINE([HAVE_INTXX_T])\n\t\t\tAC_MSG_RESULT([yes])\n\t\t], [ AC_MSG_RESULT([no])\n\t])\nfi\n\nAC_CACHE_CHECK([for int64_t type], ac_cv_have_int64_t, [\n\tAC_COMPILE_IFELSE([AC_LANG_PROGRAM([[\n#include <sys/types.h>\n#ifdef HAVE_STDINT_H\n# include <stdint.h>\n#endif\n#include <sys/socket.h>\n#ifdef HAVE_SYS_BITYPES_H\n# include <sys/bitypes.h>\n#endif\n\t\t]], [[\nint64_t a; a = 1;\n\t\t]])],\n\t[ ac_cv_have_int64_t=\"yes\" ], [ ac_cv_have_int64_t=\"no\"\n\t])\n])\nif test \"x$ac_cv_have_int64_t\" = \"xyes\" ; then\n\tAC_DEFINE([HAVE_INT64_T], [1], [define if you have int64_t data type])\nfi\n\nAC_CACHE_CHECK([for u_intXX_t types], ac_cv_have_u_intxx_t, [\n\tAC_COMPILE_IFELSE([AC_LANG_PROGRAM([[ #include <sys/types.h> ]],\n\t[[ u_int8_t a; u_int16_t b; u_int32_t c; a = b = c = 1;]])],\n\t[ ac_cv_have_u_intxx_t=\"yes\" ], [ ac_cv_have_u_intxx_t=\"no\"\n\t])\n])\nif test \"x$ac_cv_have_u_intxx_t\" = \"xyes\" ; then\n\tAC_DEFINE([HAVE_U_INTXX_T], [1], [define if you have u_intxx_t data type])\n\thave_u_intxx_t=1\nfi\n\nif test -z \"$have_u_intxx_t\" ; then\n    AC_MSG_CHECKING([for u_intXX_t types in sys/socket.h])\n\tAC_COMPILE_IFELSE([AC_LANG_PROGRAM([[ #include <sys/socket.h> ]],\n\t[[ u_int8_t a; u_int16_t b; u_int32_t c; a = b = c = 1;]])],\n\t\t[\n\t\t\tAC_DEFINE([HAVE_U_INTXX_T])\n\t\t\tAC_MSG_RESULT([yes])\n\t\t], [ AC_MSG_RESULT([no])\n\t])\nfi\n\nAC_CACHE_CHECK([for u_int64_t types], ac_cv_have_u_int64_t, [\n\tAC_COMPILE_IFELSE([AC_LANG_PROGRAM([[ #include <sys/types.h> ]],\n\t[[ u_int64_t a; a = 1;]])],\n\t[ ac_cv_have_u_int64_t=\"yes\" ], [ ac_cv_have_u_int64_t=\"no\"\n\t])\n])\nif test \"x$ac_cv_have_u_int64_t\" = \"xyes\" ; then\n\tAC_DEFINE([HAVE_U_INT64_T], [1], [define if you have u_int64_t data type])\n\thave_u_int64_t=1\nfi\n\nif (test -z \"$have_u_int64_t\" && \\\n\t   test \"x$ac_cv_header_sys_bitypes_h\" = \"xyes\")\nthen\n    AC_MSG_CHECKING([for u_int64_t type in sys/bitypes.h])\n\tAC_COMPILE_IFELSE([AC_LANG_PROGRAM([[ #include <sys/bitypes.h> ]],\n\t[[ u_int64_t a; a = 1]])],\n\t\t[\n\t\t\tAC_DEFINE([HAVE_U_INT64_T])\n\t\t\tAC_MSG_RESULT([yes])\n\t\t], [ AC_MSG_RESULT([no])\n\t])\nfi\n\nif test -z \"$have_u_intxx_t\" ; then\n\tAC_CACHE_CHECK([for uintXX_t types], ac_cv_have_uintxx_t, [\n\t\tAC_COMPILE_IFELSE([AC_LANG_PROGRAM([[\n#include <sys/types.h>\n\t\t\t]], [[\n\tuint8_t a;\n\tuint16_t b;\n\tuint32_t c;\n\ta = b = c = 1;\n\t\t\t]])],\n\t\t[ ac_cv_have_uintxx_t=\"yes\" ], [ ac_cv_have_uintxx_t=\"no\"\n\t\t])\n\t])\n\tif test \"x$ac_cv_have_uintxx_t\" = \"xyes\" ; then\n\t\tAC_DEFINE([HAVE_UINTXX_T], [1],\n\t\t\t[define if you have uintxx_t data type])\n\tfi\nfi\n\nif (test -z \"$have_uintxx_t\" && \\\n\t   test \"x$ac_cv_header_stdint_h\" = \"xyes\")\nthen\n    AC_MSG_CHECKING([for uintXX_t types in stdint.h])\n\tAC_COMPILE_IFELSE([AC_LANG_PROGRAM([[ #include <stdint.h> ]],\n\t[[ uint8_t a; uint16_t b; uint32_t c; a = b = c = 1;]])],\n\t\t[\n\t\t\tAC_DEFINE([HAVE_UINTXX_T])\n\t\t\tAC_MSG_RESULT([yes])\n\t\t], [ AC_MSG_RESULT([no])\n\t])\nfi\n\nif (test -z \"$have_uintxx_t\" && \\\n\t   test \"x$ac_cv_header_inttypes_h\" = \"xyes\")\nthen\n    AC_MSG_CHECKING([for uintXX_t types in inttypes.h])\n\tAC_COMPILE_IFELSE([AC_LANG_PROGRAM([[ #include <inttypes.h> ]],\n\t[[ uint8_t a; uint16_t b; uint32_t c; a = b = c = 1;]])],\n\t\t[\n\t\t\tAC_DEFINE([HAVE_UINTXX_T])\n\t\t\tAC_MSG_RESULT([yes])\n\t\t], [ AC_MSG_RESULT([no])\n\t])\nfi\n\nif (test -z \"$have_u_intxx_t\" || test -z \"$have_intxx_t\" && \\\n\t   test \"x$ac_cv_header_sys_bitypes_h\" = \"xyes\")\nthen\n\tAC_MSG_CHECKING([for intXX_t and u_intXX_t types in sys/bitypes.h])\n\tAC_COMPILE_IFELSE([AC_LANG_PROGRAM([[\n#include <sys/bitypes.h>\n\t\t]], [[\n\t\t\tint8_t a; int16_t b; int32_t c;\n\t\t\tu_int8_t e; u_int16_t f; u_int32_t g;\n\t\t\ta = b = c = e = f = g = 1;\n\t\t]])],\n\t\t[\n\t\t\tAC_DEFINE([HAVE_U_INTXX_T])\n\t\t\tAC_DEFINE([HAVE_INTXX_T])\n\t\t\tAC_MSG_RESULT([yes])\n\t\t], [AC_MSG_RESULT([no])\n\t])\nfi\n\n\nAC_CACHE_CHECK([for u_char], ac_cv_have_u_char, [\n\tAC_COMPILE_IFELSE([AC_LANG_PROGRAM([[ #include <sys/types.h> ]],\n\t[[ u_char foo; foo = 125; ]])],\n\t[ ac_cv_have_u_char=\"yes\" ], [ ac_cv_have_u_char=\"no\"\n\t])\n])\nif test \"x$ac_cv_have_u_char\" = \"xyes\" ; then\n\tAC_DEFINE([HAVE_U_CHAR], [1], [define if you have u_char data type])\nfi\n\nAC_CHECK_TYPES([intmax_t, uintmax_t], , , [\n#include <sys/types.h>\n#ifdef HAVE_STDINT_H\n# include <stdint.h>\n#endif\n])\n\nTYPE_SOCKLEN_T\n\nAC_CHECK_TYPES([sig_atomic_t, sighandler_t], , , [#include <signal.h>])\nAC_CHECK_TYPES([fsblkcnt_t, fsfilcnt_t], , , [\n#include <sys/types.h>\n#ifdef HAVE_SYS_BITYPES_H\n#include <sys/bitypes.h>\n#endif\n#ifdef HAVE_SYS_STATFS_H\n#include <sys/statfs.h>\n#endif\n#ifdef HAVE_SYS_STATVFS_H\n#include <sys/statvfs.h>\n#endif\n])\n\nAC_CHECK_MEMBERS([struct statfs.f_files, struct statfs.f_flags], [], [], [[\n#include <sys/param.h>\n#include <sys/types.h>\n#ifdef HAVE_SYS_BITYPES_H\n#include <sys/bitypes.h>\n#endif\n#ifdef HAVE_SYS_STATFS_H\n#include <sys/statfs.h>\n#endif\n#ifdef HAVE_SYS_STATVFS_H\n#include <sys/statvfs.h>\n#endif\n#ifdef HAVE_SYS_VFS_H\n#include <sys/vfs.h>\n#endif\n#ifdef HAVE_SYS_MOUNT_H\n#include <sys/mount.h>\n#endif\n]])\n\n\nAC_CHECK_TYPES([in_addr_t, in_port_t], , ,\n[#include <sys/types.h>\n#include <netinet/in.h>])\n\nAC_CACHE_CHECK([for size_t], ac_cv_have_size_t, [\n\tAC_COMPILE_IFELSE([AC_LANG_PROGRAM([[ #include <sys/types.h> ]],\n\t[[ size_t foo; foo = 1235; ]])],\n\t[ ac_cv_have_size_t=\"yes\" ], [ ac_cv_have_size_t=\"no\"\n\t])\n])\nif test \"x$ac_cv_have_size_t\" = \"xyes\" ; then\n\tAC_DEFINE([HAVE_SIZE_T], [1], [define if you have size_t data type])\nfi\n\nAC_CACHE_CHECK([for ssize_t], ac_cv_have_ssize_t, [\n\tAC_COMPILE_IFELSE([AC_LANG_PROGRAM([[ #include <sys/types.h> ]],\n\t[[ ssize_t foo; foo = 1235; ]])],\n\t[ ac_cv_have_ssize_t=\"yes\" ], [ ac_cv_have_ssize_t=\"no\"\n\t])\n])\nif test \"x$ac_cv_have_ssize_t\" = \"xyes\" ; then\n\tAC_DEFINE([HAVE_SSIZE_T], [1], [define if you have ssize_t data type])\nfi\n\nAC_CACHE_CHECK([for clock_t], ac_cv_have_clock_t, [\n\tAC_COMPILE_IFELSE([AC_LANG_PROGRAM([[ #include <time.h> ]],\n\t[[ clock_t foo; foo = 1235; ]])],\n\t[ ac_cv_have_clock_t=\"yes\" ], [ ac_cv_have_clock_t=\"no\"\n\t])\n])\nif test \"x$ac_cv_have_clock_t\" = \"xyes\" ; then\n\tAC_DEFINE([HAVE_CLOCK_T], [1], [define if you have clock_t data type])\nfi\n\nAC_CACHE_CHECK([for sa_family_t], ac_cv_have_sa_family_t, [\n\tAC_COMPILE_IFELSE([AC_LANG_PROGRAM([[\n#include <sys/types.h>\n#include <sys/socket.h>\n\t\t]], [[ sa_family_t foo; foo = 1235; ]])],\n\t[ ac_cv_have_sa_family_t=\"yes\" ],\n\t[ AC_COMPILE_IFELSE([AC_LANG_PROGRAM([[\n#include <sys/types.h>\n#include <sys/socket.h>\n#include <netinet/in.h>\n\t\t]], [[ sa_family_t foo; foo = 1235; ]])],\n\t\t[ ac_cv_have_sa_family_t=\"yes\" ],\n\t\t[ ac_cv_have_sa_family_t=\"no\" ]\n\t)\n\t])\n])\nif test \"x$ac_cv_have_sa_family_t\" = \"xyes\" ; then\n\tAC_DEFINE([HAVE_SA_FAMILY_T], [1],\n\t\t[define if you have sa_family_t data type])\nfi\n\nAC_CACHE_CHECK([for pid_t], ac_cv_have_pid_t, [\n\tAC_COMPILE_IFELSE([AC_LANG_PROGRAM([[ #include <sys/types.h> ]],\n\t[[ pid_t foo; foo = 1235; ]])],\n\t[ ac_cv_have_pid_t=\"yes\" ], [ ac_cv_have_pid_t=\"no\"\n\t])\n])\nif test \"x$ac_cv_have_pid_t\" = \"xyes\" ; then\n\tAC_DEFINE([HAVE_PID_T], [1], [define if you have pid_t data type])\nfi\n\nAC_CACHE_CHECK([for mode_t], ac_cv_have_mode_t, [\n\tAC_COMPILE_IFELSE([AC_LANG_PROGRAM([[ #include <sys/types.h> ]],\n\t[[ mode_t foo; foo = 1235; ]])],\n\t[ ac_cv_have_mode_t=\"yes\" ], [ ac_cv_have_mode_t=\"no\"\n\t])\n])\nif test \"x$ac_cv_have_mode_t\" = \"xyes\" ; then\n\tAC_DEFINE([HAVE_MODE_T], [1], [define if you have mode_t data type])\nfi\n\n\nAC_CACHE_CHECK([for struct sockaddr_storage], ac_cv_have_struct_sockaddr_storage, [\n\tAC_COMPILE_IFELSE([AC_LANG_PROGRAM([[\n#include <sys/types.h>\n#include <sys/socket.h>\n\t\t]], [[ struct sockaddr_storage s; ]])],\n\t[ ac_cv_have_struct_sockaddr_storage=\"yes\" ],\n\t[ ac_cv_have_struct_sockaddr_storage=\"no\"\n\t])\n])\nif test \"x$ac_cv_have_struct_sockaddr_storage\" = \"xyes\" ; then\n\tAC_DEFINE([HAVE_STRUCT_SOCKADDR_STORAGE], [1],\n\t\t[define if you have struct sockaddr_storage data type])\nfi\n\nAC_CACHE_CHECK([for struct sockaddr_in6], ac_cv_have_struct_sockaddr_in6, [\n\tAC_COMPILE_IFELSE([AC_LANG_PROGRAM([[\n#include <sys/types.h>\n#include <netinet/in.h>\n\t\t]], [[ struct sockaddr_in6 s; s.sin6_family = 0; ]])],\n\t[ ac_cv_have_struct_sockaddr_in6=\"yes\" ],\n\t[ ac_cv_have_struct_sockaddr_in6=\"no\"\n\t])\n])\nif test \"x$ac_cv_have_struct_sockaddr_in6\" = \"xyes\" ; then\n\tAC_DEFINE([HAVE_STRUCT_SOCKADDR_IN6], [1],\n\t\t[define if you have struct sockaddr_in6 data type])\nfi\n\nAC_CACHE_CHECK([for struct in6_addr], ac_cv_have_struct_in6_addr, [\n\tAC_COMPILE_IFELSE([AC_LANG_PROGRAM([[\n#include <sys/types.h>\n#include <netinet/in.h>\n\t\t]], [[ struct in6_addr s; s.s6_addr[0] = 0; ]])],\n\t[ ac_cv_have_struct_in6_addr=\"yes\" ],\n\t[ ac_cv_have_struct_in6_addr=\"no\"\n\t])\n])\nif test \"x$ac_cv_have_struct_in6_addr\" = \"xyes\" ; then\n\tAC_DEFINE([HAVE_STRUCT_IN6_ADDR], [1],\n\t\t[define if you have struct in6_addr data type])\n\ndnl Now check for sin6_scope_id\n\tAC_CHECK_MEMBERS([struct sockaddr_in6.sin6_scope_id], , ,\n\t\t[\n#ifdef HAVE_SYS_TYPES_H\n#include <sys/types.h>\n#endif\n#include <netinet/in.h>\n\t\t])\nfi\n\nAC_CACHE_CHECK([for struct addrinfo], ac_cv_have_struct_addrinfo, [\n\tAC_COMPILE_IFELSE([AC_LANG_PROGRAM([[\n#include <sys/types.h>\n#include <sys/socket.h>\n#include <netdb.h>\n\t\t]], [[ struct addrinfo s; s.ai_flags = AI_PASSIVE; ]])],\n\t[ ac_cv_have_struct_addrinfo=\"yes\" ],\n\t[ ac_cv_have_struct_addrinfo=\"no\"\n\t])\n])\nif test \"x$ac_cv_have_struct_addrinfo\" = \"xyes\" ; then\n\tAC_DEFINE([HAVE_STRUCT_ADDRINFO], [1],\n\t\t[define if you have struct addrinfo data type])\nfi\n\nAC_CACHE_CHECK([for struct timeval], ac_cv_have_struct_timeval, [\n\tAC_COMPILE_IFELSE([AC_LANG_PROGRAM([[ #include <sys/time.h> ]],\n\t[[ struct timeval tv; tv.tv_sec = 1;]])],\n\t[ ac_cv_have_struct_timeval=\"yes\" ],\n\t[ ac_cv_have_struct_timeval=\"no\"\n\t])\n])\nif test \"x$ac_cv_have_struct_timeval\" = \"xyes\" ; then\n\tAC_DEFINE([HAVE_STRUCT_TIMEVAL], [1], [define if you have struct timeval])\n\thave_struct_timeval=1\nfi\n\nAC_CACHE_CHECK([for struct timespec], ac_cv_have_struct_timespec, [\n\tAC_COMPILE_IFELSE([AC_LANG_PROGRAM([[\n    #ifdef HAVE_SYS_TIME_H\n    # include <sys/time.h>\n    #endif\n    #ifdef HAVE_TIME_H\n    # include <time.h>\n    #endif\n\t]],\n\t[[ struct timespec ts; ts.tv_sec = 1;]])],\n\t[ ac_cv_have_struct_timespec=\"yes\" ],\n\t[ ac_cv_have_struct_timespec=\"no\"\n\t])\n])\nif test \"x$ac_cv_have_struct_timespec\" = \"xyes\" ; then\n\tAC_DEFINE([HAVE_STRUCT_TIMESPEC], [1], [define if you have struct timespec])\n\thave_struct_timespec=1\nfi\n\n# We need int64_t or else certain parts of the compile will fail.\nif test \"x$ac_cv_have_int64_t\" = \"xno\" && \\\n\ttest \"x$ac_cv_sizeof_long_int\" != \"x8\" && \\\n\ttest \"x$ac_cv_sizeof_long_long_int\" = \"x0\" ; then\n\techo \"OpenSSH requires int64_t support.  Contact your vendor or install\"\n\techo \"an alternative compiler (I.E., GCC) before continuing.\"\n\techo \"\"\n\texit 1;\nelse\ndnl test snprintf (broken on SCO w/gcc)\n\tAC_RUN_IFELSE(\n\t\t[AC_LANG_SOURCE([[\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#ifdef HAVE_SNPRINTF\nint main(void)\n{\n\tchar buf[50];\n\tchar expected_out[50];\n\tint mazsize = 50 ;\n#if (SIZEOF_LONG_INT == 8)\n\tlong int num = 0x7fffffffffffffff;\n#else\n\tlong long num = 0x7fffffffffffffffll;\n#endif\n\tstrcpy(expected_out, \"9223372036854775807\");\n\tsnprintf(buf, mazsize, \"%lld\", num);\n\tif(strcmp(buf, expected_out) != 0)\n\t\texit(1);\n\texit(0);\n}\n#else\nint main(void) { exit(0); }\n#endif\n\t\t]])], [ true ], [ AC_DEFINE([BROKEN_SNPRINTF]) ],\n\t\tAC_MSG_WARN([cross compiling: Assuming working snprintf()])\n\t)\nfi\n\ndnl Checks for structure members\nOSSH_CHECK_HEADER_FOR_FIELD([ut_host], [utmp.h], [HAVE_HOST_IN_UTMP])\nOSSH_CHECK_HEADER_FOR_FIELD([ut_host], [utmpx.h], [HAVE_HOST_IN_UTMPX])\nOSSH_CHECK_HEADER_FOR_FIELD([syslen], [utmpx.h], [HAVE_SYSLEN_IN_UTMPX])\nOSSH_CHECK_HEADER_FOR_FIELD([ut_pid], [utmp.h], [HAVE_PID_IN_UTMP])\nOSSH_CHECK_HEADER_FOR_FIELD([ut_type], [utmp.h], [HAVE_TYPE_IN_UTMP])\nOSSH_CHECK_HEADER_FOR_FIELD([ut_type], [utmpx.h], [HAVE_TYPE_IN_UTMPX])\nOSSH_CHECK_HEADER_FOR_FIELD([ut_tv], [utmp.h], [HAVE_TV_IN_UTMP])\nOSSH_CHECK_HEADER_FOR_FIELD([ut_id], [utmp.h], [HAVE_ID_IN_UTMP])\nOSSH_CHECK_HEADER_FOR_FIELD([ut_id], [utmpx.h], [HAVE_ID_IN_UTMPX])\nOSSH_CHECK_HEADER_FOR_FIELD([ut_addr], [utmp.h], [HAVE_ADDR_IN_UTMP])\nOSSH_CHECK_HEADER_FOR_FIELD([ut_addr], [utmpx.h], [HAVE_ADDR_IN_UTMPX])\nOSSH_CHECK_HEADER_FOR_FIELD([ut_addr_v6], [utmp.h], [HAVE_ADDR_V6_IN_UTMP])\nOSSH_CHECK_HEADER_FOR_FIELD([ut_addr_v6], [utmpx.h], [HAVE_ADDR_V6_IN_UTMPX])\nOSSH_CHECK_HEADER_FOR_FIELD([ut_exit], [utmp.h], [HAVE_EXIT_IN_UTMP])\nOSSH_CHECK_HEADER_FOR_FIELD([ut_time], [utmp.h], [HAVE_TIME_IN_UTMP])\nOSSH_CHECK_HEADER_FOR_FIELD([ut_time], [utmpx.h], [HAVE_TIME_IN_UTMPX])\nOSSH_CHECK_HEADER_FOR_FIELD([ut_tv], [utmpx.h], [HAVE_TV_IN_UTMPX])\nOSSH_CHECK_HEADER_FOR_FIELD([ut_ss], [utmpx.h], [HAVE_SS_IN_UTMPX])\n\nAC_CHECK_MEMBERS([struct stat.st_blksize])\nAC_CHECK_MEMBERS([struct stat.st_mtim])\nAC_CHECK_MEMBERS([struct stat.st_mtime])\nAC_CHECK_MEMBERS([struct passwd.pw_gecos, struct passwd.pw_class,\nstruct passwd.pw_change, struct passwd.pw_expire],\n[], [], [[\n#include <sys/types.h>\n#include <pwd.h>\n]])\n\nAC_CHECK_MEMBER([struct __res_state.retrans], [], [AC_DEFINE([__res_state], [state],\n\t[Define if we don't have struct __res_state in resolv.h])],\n[[\n#include <stdio.h>\n#if HAVE_SYS_TYPES_H\n# include <sys/types.h>\n#endif\n#include <netinet/in.h>\n#include <arpa/nameser.h>\n#include <resolv.h>\n]])\n\nAC_CHECK_MEMBER([struct sockaddr_in.sin_len],\n    [AC_DEFINE([SOCK_HAS_LEN], [1], [sockaddr_in has sin_len])],\n    [],\n    [AC_LANG_SOURCE([[\n#include <sys/types.h>\n#include <sys/socket.h>\n#include <netinet/in.h>\n    ]])]\n)\n\nAC_CACHE_CHECK([for ss_family field in struct sockaddr_storage],\n\t\tac_cv_have_ss_family_in_struct_ss, [\n\tAC_COMPILE_IFELSE([AC_LANG_PROGRAM([[\n#include <sys/types.h>\n#include <sys/socket.h>\n\t\t]], [[ struct sockaddr_storage s; s.ss_family = 1; ]])],\n\t[ ac_cv_have_ss_family_in_struct_ss=\"yes\" ],\n\t[ ac_cv_have_ss_family_in_struct_ss=\"no\" ])\n])\nif test \"x$ac_cv_have_ss_family_in_struct_ss\" = \"xyes\" ; then\n\tAC_DEFINE([HAVE_SS_FAMILY_IN_SS], [1], [Fields in struct sockaddr_storage])\nfi\n\nAC_CACHE_CHECK([for __ss_family field in struct sockaddr_storage],\n\t\tac_cv_have___ss_family_in_struct_ss, [\n\tAC_COMPILE_IFELSE([AC_LANG_PROGRAM([[\n#include <sys/types.h>\n#include <sys/socket.h>\n\t\t]], [[ struct sockaddr_storage s; s.__ss_family = 1; ]])],\n\t[ ac_cv_have___ss_family_in_struct_ss=\"yes\" ],\n\t[ ac_cv_have___ss_family_in_struct_ss=\"no\"\n\t])\n])\nif test \"x$ac_cv_have___ss_family_in_struct_ss\" = \"xyes\" ; then\n\tAC_DEFINE([HAVE___SS_FAMILY_IN_SS], [1],\n\t\t[Fields in struct sockaddr_storage])\nfi\n\ndnl make sure we're using the real structure members and not defines\nAC_CACHE_CHECK([for msg_accrights field in struct msghdr],\n\t\tac_cv_have_accrights_in_msghdr, [\n\tAC_COMPILE_IFELSE([AC_LANG_PROGRAM([[\n#include <sys/types.h>\n#include <sys/socket.h>\n#include <sys/uio.h>\n#include <stdlib.h>\n\t\t]], [[\n#ifdef msg_accrights\n#error \"msg_accrights is a macro\"\nexit(1);\n#endif\nstruct msghdr m;\nm.msg_accrights = 0;\nexit(0);\n\t\t]])],\n\t\t[ ac_cv_have_accrights_in_msghdr=\"yes\" ],\n\t\t[ ac_cv_have_accrights_in_msghdr=\"no\" ]\n\t)\n])\nif test \"x$ac_cv_have_accrights_in_msghdr\" = \"xyes\" ; then\n\tAC_DEFINE([HAVE_ACCRIGHTS_IN_MSGHDR], [1],\n\t\t[Define if your system uses access rights style\n\t\tfile descriptor passing])\nfi\n\nAC_MSG_CHECKING([if struct statvfs.f_fsid is integral type])\nAC_COMPILE_IFELSE([AC_LANG_PROGRAM([[\n#include <sys/param.h>\n#include <sys/stat.h>\n#ifdef HAVE_SYS_TIME_H\n# include <sys/time.h>\n#endif\n#ifdef HAVE_SYS_MOUNT_H\n#include <sys/mount.h>\n#endif\n#ifdef HAVE_SYS_STATVFS_H\n#include <sys/statvfs.h>\n#endif\n\t]], [[ struct statvfs s; s.f_fsid = 0; ]])],\n\t[ AC_MSG_RESULT([yes]) ],\n\t[ AC_MSG_RESULT([no])\n\n\tAC_MSG_CHECKING([if fsid_t has member val])\n\tAC_COMPILE_IFELSE([AC_LANG_PROGRAM([[\n#include <sys/types.h>\n#include <sys/statvfs.h>\n\t]], [[ fsid_t t; t.val[0] = 0; ]])],\n\t[ AC_MSG_RESULT([yes])\n\t  AC_DEFINE([FSID_HAS_VAL], [1], [fsid_t has member val]) ],\n\t[ AC_MSG_RESULT([no]) ])\n\n\tAC_MSG_CHECKING([if f_fsid has member __val])\n\tAC_COMPILE_IFELSE([AC_LANG_PROGRAM([[\n#include <sys/types.h>\n#include <sys/statvfs.h>\n\t]], [[ fsid_t t; t.__val[0] = 0; ]])],\n\t[ AC_MSG_RESULT([yes])\n\t  AC_DEFINE([FSID_HAS___VAL], [1], [fsid_t has member __val]) ],\n\t[ AC_MSG_RESULT([no]) ])\n])\n\nAC_CACHE_CHECK([for msg_control field in struct msghdr],\n\t\tac_cv_have_control_in_msghdr, [\n\tAC_COMPILE_IFELSE([AC_LANG_PROGRAM([[\n#include <sys/types.h>\n#include <sys/socket.h>\n#include <sys/uio.h>\n#include <stdlib.h>\n\t\t]], [[\n#ifdef msg_control\n#error \"msg_control is a macro\"\nexit(1);\n#endif\nstruct msghdr m;\nm.msg_control = 0;\nexit(0);\n\t\t]])],\n\t\t[ ac_cv_have_control_in_msghdr=\"yes\" ],\n\t\t[ ac_cv_have_control_in_msghdr=\"no\" ]\n\t)\n])\nif test \"x$ac_cv_have_control_in_msghdr\" = \"xyes\" ; then\n\tAC_DEFINE([HAVE_CONTROL_IN_MSGHDR], [1],\n\t\t[Define if your system uses ancillary data style\n\t\tfile descriptor passing])\nfi\n\nAC_CACHE_CHECK([if libc defines __progname], ac_cv_libc_defines___progname, [\n\tAC_LINK_IFELSE([AC_LANG_PROGRAM([[ #include <stdio.h> ]],\n\t\t[[ extern char *__progname; printf(\"%s\", __progname); ]])],\n\t[ ac_cv_libc_defines___progname=\"yes\" ],\n\t[ ac_cv_libc_defines___progname=\"no\"\n\t])\n])\nif test \"x$ac_cv_libc_defines___progname\" = \"xyes\" ; then\n\tAC_DEFINE([HAVE___PROGNAME], [1], [Define if libc defines __progname])\nfi\n\nAC_CACHE_CHECK([whether $CC implements __FUNCTION__], ac_cv_cc_implements___FUNCTION__, [\n\tAC_LINK_IFELSE([AC_LANG_PROGRAM([[ #include <stdio.h> ]],\n\t\t[[ printf(\"%s\", __FUNCTION__); ]])],\n\t[ ac_cv_cc_implements___FUNCTION__=\"yes\" ],\n\t[ ac_cv_cc_implements___FUNCTION__=\"no\"\n\t])\n])\nif test \"x$ac_cv_cc_implements___FUNCTION__\" = \"xyes\" ; then\n\tAC_DEFINE([HAVE___FUNCTION__], [1],\n\t\t[Define if compiler implements __FUNCTION__])\nfi\n\nAC_CACHE_CHECK([whether $CC implements __func__], ac_cv_cc_implements___func__, [\n\tAC_LINK_IFELSE([AC_LANG_PROGRAM([[ #include <stdio.h> ]],\n\t\t[[ printf(\"%s\", __func__); ]])],\n\t[ ac_cv_cc_implements___func__=\"yes\" ],\n\t[ ac_cv_cc_implements___func__=\"no\"\n\t])\n])\nif test \"x$ac_cv_cc_implements___func__\" = \"xyes\" ; then\n\tAC_DEFINE([HAVE___func__], [1], [Define if compiler implements __func__])\nfi\n\nAC_CACHE_CHECK([whether va_copy exists], ac_cv_have_va_copy, [\n\tAC_LINK_IFELSE([AC_LANG_PROGRAM([[\n#include <stdarg.h>\nva_list x,y;\n\t\t]], [[ va_copy(x,y); ]])],\n\t[ ac_cv_have_va_copy=\"yes\" ],\n\t[ ac_cv_have_va_copy=\"no\"\n\t])\n])\nif test \"x$ac_cv_have_va_copy\" = \"xyes\" ; then\n\tAC_DEFINE([HAVE_VA_COPY], [1], [Define if va_copy exists])\nfi\n\nAC_CACHE_CHECK([whether __va_copy exists], ac_cv_have___va_copy, [\n\tAC_LINK_IFELSE([AC_LANG_PROGRAM([[\n#include <stdarg.h>\nva_list x,y;\n\t\t]], [[ __va_copy(x,y); ]])],\n\t[ ac_cv_have___va_copy=\"yes\" ], [ ac_cv_have___va_copy=\"no\"\n\t])\n])\nif test \"x$ac_cv_have___va_copy\" = \"xyes\" ; then\n\tAC_DEFINE([HAVE___VA_COPY], [1], [Define if __va_copy exists])\nfi\n\nAC_CACHE_CHECK([whether getopt has optreset support],\n\t\tac_cv_have_getopt_optreset, [\n\tAC_LINK_IFELSE([AC_LANG_PROGRAM([[ #include <getopt.h> ]],\n\t\t[[ extern int optreset; optreset = 0; ]])],\n\t[ ac_cv_have_getopt_optreset=\"yes\" ],\n\t[ ac_cv_have_getopt_optreset=\"no\"\n\t])\n])\nif test \"x$ac_cv_have_getopt_optreset\" = \"xyes\" ; then\n\tAC_DEFINE([HAVE_GETOPT_OPTRESET], [1],\n\t\t[Define if your getopt(3) defines and uses optreset])\nfi\n\nAC_CACHE_CHECK([if libc defines sys_errlist], ac_cv_libc_defines_sys_errlist, [\n\tAC_LINK_IFELSE([AC_LANG_PROGRAM([[ #include <stdio.h> ]],\n[[ extern const char *const sys_errlist[]; printf(\"%s\", sys_errlist[0]);]])],\n\t[ ac_cv_libc_defines_sys_errlist=\"yes\" ],\n\t[ ac_cv_libc_defines_sys_errlist=\"no\"\n\t])\n])\nif test \"x$ac_cv_libc_defines_sys_errlist\" = \"xyes\" ; then\n\tAC_DEFINE([HAVE_SYS_ERRLIST], [1],\n\t\t[Define if your system defines sys_errlist[]])\nfi\n\n\nAC_CACHE_CHECK([if libc defines sys_nerr], ac_cv_libc_defines_sys_nerr, [\n\tAC_LINK_IFELSE([AC_LANG_PROGRAM([[ #include <stdio.h> ]],\n[[ extern int sys_nerr; printf(\"%i\", sys_nerr);]])],\n\t[ ac_cv_libc_defines_sys_nerr=\"yes\" ],\n\t[ ac_cv_libc_defines_sys_nerr=\"no\"\n\t])\n])\nif test \"x$ac_cv_libc_defines_sys_nerr\" = \"xyes\" ; then\n\tAC_DEFINE([HAVE_SYS_NERR], [1], [Define if your system defines sys_nerr])\nfi\n\n# Check libraries needed by DNS fingerprint support\nAC_SEARCH_LIBS([getrrsetbyname], [resolv],\n\t[AC_DEFINE([HAVE_GETRRSETBYNAME], [1],\n\t\t[Define if getrrsetbyname() exists])],\n\t[\n\t\t# Needed by our getrrsetbyname()\n\t\tAC_SEARCH_LIBS([res_query], [resolv])\n\t\tAC_SEARCH_LIBS([dn_expand], [resolv])\n\t\tAC_MSG_CHECKING([if res_query will link])\n\t\tAC_LINK_IFELSE([AC_LANG_PROGRAM([[\n#include <sys/types.h>\n#include <netinet/in.h>\n#include <arpa/nameser.h>\n#include <netdb.h>\n#include <resolv.h>\n\t\t\t\t]], [[\n\tres_query (0, 0, 0, 0, 0);\n\t\t\t\t]])],\n\t\t    AC_MSG_RESULT([yes]),\n\t\t   [AC_MSG_RESULT([no])\n\t\t    saved_LIBS=\"$LIBS\"\n\t\t    LIBS=\"$LIBS -lresolv\"\n\t\t    AC_MSG_CHECKING([for res_query in -lresolv])\n\t\t    AC_LINK_IFELSE([AC_LANG_PROGRAM([[\n#include <sys/types.h>\n#include <netinet/in.h>\n#include <arpa/nameser.h>\n#include <netdb.h>\n#include <resolv.h>\n\t\t\t\t]], [[\n\tres_query (0, 0, 0, 0, 0);\n\t\t\t\t]])],\n\t\t\t[AC_MSG_RESULT([yes])],\n\t\t\t[LIBS=\"$saved_LIBS\"\n\t\t\t AC_MSG_RESULT([no])])\n\t\t    ])\n\t\tAC_CHECK_FUNCS([_getshort _getlong])\n\t\tAC_CHECK_DECLS([_getshort, _getlong], , ,\n\t\t    [#include <sys/types.h>\n\t\t    #include <arpa/nameser.h>])\n\t\tAC_CHECK_MEMBER([HEADER.ad],\n\t\t\t[AC_DEFINE([HAVE_HEADER_AD], [1],\n\t\t\t    [Define if HEADER.ad exists in arpa/nameser.h])], ,\n\t\t\t[#include <arpa/nameser.h>])\n\t])\n\nAC_MSG_CHECKING([if struct __res_state _res is an extern])\nAC_LINK_IFELSE([AC_LANG_PROGRAM([[\n#include <stdio.h>\n#if HAVE_SYS_TYPES_H\n# include <sys/types.h>\n#endif\n#include <netinet/in.h>\n#include <arpa/nameser.h>\n#include <resolv.h>\nextern struct __res_state _res;\n\t\t]], [[\nstruct __res_state *volatile p = &_res;  /* force resolution of _res */\nreturn 0;\n\t\t]],)],\n\t\t[AC_MSG_RESULT([yes])\n\t\t AC_DEFINE([HAVE__RES_EXTERN], [1],\n\t\t    [Define if you have struct __res_state _res as an extern])\n\t\t],\n\t\t[ AC_MSG_RESULT([no]) ]\n)\n\n# Check whether user wants SELinux support\nSELINUX_MSG=\"no\"\nLIBSELINUX=\"\"\nAC_ARG_WITH([selinux],\n\t[  --with-selinux          Enable SELinux support],\n\t[ if test \"x$withval\" != \"xno\" ; then\n\t\tsave_LIBS=\"$LIBS\"\n\t\tAC_DEFINE([WITH_SELINUX], [1],\n\t\t\t[Define if you want SELinux support.])\n\t\tSELINUX_MSG=\"yes\"\n\t\tAC_CHECK_HEADER([selinux/selinux.h], ,\n\t\t\tAC_MSG_ERROR([SELinux support requires selinux.h header]))\n\t\tAC_CHECK_LIB([selinux], [setexeccon],\n\t\t\t[ LIBSELINUX=\"-lselinux\"\n\t\t\t  LIBS=\"$LIBS -lselinux\"\n\t\t\t],\n\t\t\tAC_MSG_ERROR([SELinux support requires libselinux library]))\n\t\tAC_CHECK_FUNCS([getseuserbyname get_default_context_with_level])\n\t\tLIBS=\"$save_LIBS $LIBSELINUX\"\n\tfi ]\n)\nAC_SUBST([SSHDLIBS])\n\n# Check whether user wants Kerberos 5 support\nKRB5_MSG=\"no\"\nAC_ARG_WITH([kerberos5],\n\t[  --with-kerberos5=PATH   Enable Kerberos 5 support],\n\t[ if test \"x$withval\" != \"xno\" ; then\n\t\tif test \"x$withval\" = \"xyes\" ; then\n\t\t\tKRB5ROOT=\"/usr/local\"\n\t\telse\n\t\t\tKRB5ROOT=${withval}\n\t\tfi\n\n\t\tAC_DEFINE([KRB5], [1], [Define if you want Kerberos 5 support])\n\t\tKRB5_MSG=\"yes\"\n\n\t\tuse_pkgconfig_for_krb5=\n\t\tif test \"x$PKGCONFIG\" != \"xno\"; then\n\t\t\tAC_MSG_CHECKING([if $PKGCONFIG knows about kerberos5])\n\t\t\tif \"$PKGCONFIG\" krb5; then\n\t\t\t\tAC_MSG_RESULT([yes])\n\t\t\t\tuse_pkgconfig_for_krb5=yes\n\t\t\telse\n\t\t\t\tAC_MSG_RESULT([no])\n\t\t\tfi\n\t\tfi\n\t\tif test \"x$use_pkgconfig_for_krb5\" = \"xyes\"; then\n\t\t\tK5CFLAGS=`$PKGCONFIG --cflags krb5`\n\t\t\tK5LIBS=`$PKGCONFIG --libs krb5`\n\t\t\tCPPFLAGS=\"$CPPFLAGS $K5CFLAGS\"\n\n\t\t\tAC_MSG_CHECKING([for gssapi support])\n\t\t\tif \"$PKGCONFIG\" krb5-gssapi; then\n\t\t\t\tAC_MSG_RESULT([yes])\n\t\t\t\tAC_DEFINE([GSSAPI], [1],\n\t\t\t\t\t[Define this if you want GSSAPI\n\t\t\t\t\tsupport in the version 2 protocol])\n\t\t\t\tGSSCFLAGS=\"`$PKGCONFIG --cflags krb5-gssapi`\"\n\t\t\t\tGSSLIBS=\"`$PKGCONFIG --libs krb5-gssapi`\"\n\t\t\t\tCPPFLAGS=\"$CPPFLAGS $GSSCFLAGS\"\n\t\t\telse\n\t\t\t\tAC_MSG_RESULT([no])\n\t\t\tfi\n\t\t\tAC_MSG_CHECKING([whether we are using Heimdal])\n\t\t\tAC_COMPILE_IFELSE([AC_LANG_PROGRAM([[ #include <krb5.h>\n\t\t\t\t]], [[ char *tmp = heimdal_version; ]])],\n\t\t\t\t[ AC_MSG_RESULT([yes])\n\t\t\t\tAC_DEFINE([HEIMDAL], [1],\n\t\t\t\t[Define this if you are using the Heimdal\n\t\t\t\tversion of Kerberos V5]) ],\n\t\t\t\t[AC_MSG_RESULT([no])\n\t\t\t])\n\t\telse\n\t\t\tAC_PATH_TOOL([KRB5CONF], [krb5-config],\n\t\t\t\t     [$KRB5ROOT/bin/krb5-config],\n\t\t\t\t     [$KRB5ROOT/bin:$PATH])\n\t\t\tif test -x $KRB5CONF ; then\n\t\t\t\tK5CFLAGS=\"`$KRB5CONF --cflags`\"\n\t\t\t\tK5LIBS=\"`$KRB5CONF --libs`\"\n\t\t\t\tCPPFLAGS=\"$CPPFLAGS $K5CFLAGS\"\n\n\t\t\t\tAC_MSG_CHECKING([for gssapi support])\n\t\t\t\tif $KRB5CONF | grep gssapi >/dev/null ; then\n\t\t\t\t\tAC_MSG_RESULT([yes])\n\t\t\t\t\tAC_DEFINE([GSSAPI], [1],\n\t\t\t\t\t\t[Define this if you want GSSAPI\n\t\t\t\t\t\tsupport in the version 2 protocol])\n\t\t\t\t\tGSSCFLAGS=\"`$KRB5CONF --cflags gssapi`\"\n\t\t\t\t\tGSSLIBS=\"`$KRB5CONF --libs gssapi`\"\n\t\t\t\t\tCPPFLAGS=\"$CPPFLAGS $GSSCFLAGS\"\n\t\t\t\telse\n\t\t\t\t\tAC_MSG_RESULT([no])\n\t\t\t\tfi\n\t\t\t\tAC_MSG_CHECKING([whether we are using Heimdal])\n\t\t\t\tAC_COMPILE_IFELSE([AC_LANG_PROGRAM([[ #include <krb5.h>\n\t\t\t\t\t]], [[ char *tmp = heimdal_version; ]])],\n\t\t\t\t\t[ AC_MSG_RESULT([yes])\n\t\t\t\t\tAC_DEFINE([HEIMDAL], [1],\n\t\t\t\t\t[Define this if you are using the Heimdal\n\t\t\t\t\tversion of Kerberos V5]) ],\n\t\t\t\t\t[AC_MSG_RESULT([no])\n\t\t\t\t])\n\t\t\telse\n\t\t\t\tCPPFLAGS=\"$CPPFLAGS -I${KRB5ROOT}/include\"\n\t\t\t\tLDFLAGS=\"$LDFLAGS -L${KRB5ROOT}/lib\"\n\t\t\t\tAC_MSG_CHECKING([whether we are using Heimdal])\n\t\t\t\tAC_COMPILE_IFELSE([AC_LANG_PROGRAM([[ #include <krb5.h>\n\t\t\t\t\t]], [[ char *tmp = heimdal_version; ]])],\n\t\t\t\t\t\t[ AC_MSG_RESULT([yes])\n\t\t\t\t\t\t AC_DEFINE([HEIMDAL])\n\t\t\t\t\t\t K5LIBS=\"-lkrb5\"\n\t\t\t\t\t\t K5LIBS=\"$K5LIBS -lcom_err -lasn1\"\n\t\t\t\t\t\t AC_CHECK_LIB([roken], [net_write],\n\t\t\t\t\t\t   [K5LIBS=\"$K5LIBS -lroken\"])\n\t\t\t\t\t\t AC_CHECK_LIB([des], [des_cbc_encrypt],\n\t\t\t\t\t\t   [K5LIBS=\"$K5LIBS -ldes\"])\n\t\t\t\t\t       ], [ AC_MSG_RESULT([no])\n\t\t\t\t\t\t K5LIBS=\"-lkrb5 -lk5crypto -lcom_err\"\n\t\t\t\t])\n\t\t\t\tAC_SEARCH_LIBS([dn_expand], [resolv])\n\n\t\t\t\tAC_CHECK_LIB([gssapi_krb5], [gss_init_sec_context],\n\t\t\t\t\t[ AC_DEFINE([GSSAPI])\n\t\t\t\t\t  GSSLIBS=\"-lgssapi_krb5\" ],\n\t\t\t\t\t[ AC_CHECK_LIB([gssapi], [gss_init_sec_context],\n\t\t\t\t\t\t[ AC_DEFINE([GSSAPI])\n\t\t\t\t\t\t  GSSLIBS=\"-lgssapi\" ],\n\t\t\t\t\t\t[ AC_CHECK_LIB([gss], [gss_init_sec_context],\n\t\t\t\t\t\t\t[ AC_DEFINE([GSSAPI])\n\t\t\t\t\t\t\t  GSSLIBS=\"-lgss\" ],\n\t\t\t\t\t\t\tAC_MSG_WARN([Cannot find any suitable gss-api library - build may fail]))\n\t\t\t\t\t\t])\n\t\t\t\t\t])\n\n\t\t\t\tAC_CHECK_HEADER([gssapi.h], ,\n\t\t\t\t\t[ unset ac_cv_header_gssapi_h\n\t\t\t\t\t  CPPFLAGS=\"$CPPFLAGS -I${KRB5ROOT}/include/gssapi\"\n\t\t\t\t\t  AC_CHECK_HEADERS([gssapi.h], ,\n\t\t\t\t\t\tAC_MSG_WARN([Cannot find any suitable gss-api header - build may fail])\n\t\t\t\t\t  )\n\t\t\t\t\t]\n\t\t\t\t)\n\n\t\t\t\toldCPP=\"$CPPFLAGS\"\n\t\t\t\tCPPFLAGS=\"$CPPFLAGS -I${KRB5ROOT}/include/gssapi\"\n\t\t\t\tAC_CHECK_HEADER([gssapi_krb5.h], ,\n\t\t\t\t\t\t[ CPPFLAGS=\"$oldCPP\" ])\n\n\t\t\tfi\n\t\tfi\n\t\tif test -n \"${rpath_opt}\" ; then\n\t\t\tLDFLAGS=\"$LDFLAGS ${rpath_opt}${KRB5ROOT}/lib\"\n\t\tfi\n\t\tif test ! -z \"$blibpath\" ; then\n\t\t\tblibpath=\"$blibpath:${KRB5ROOT}/lib\"\n\t\tfi\n\n\t\tAC_CHECK_HEADERS([gssapi.h gssapi/gssapi.h])\n\t\tAC_CHECK_HEADERS([gssapi_krb5.h gssapi/gssapi_krb5.h])\n\t\tAC_CHECK_HEADERS([gssapi_generic.h gssapi/gssapi_generic.h])\n\n\t\tAC_SEARCH_LIBS([k_hasafs], [kafs], [AC_DEFINE([USE_AFS], [1],\n\t\t\t[Define this if you want to use libkafs' AFS support])])\n\n\t\tAC_CHECK_DECLS([GSS_C_NT_HOSTBASED_SERVICE], [], [], [[\n#ifdef HAVE_GSSAPI_H\n# include <gssapi.h>\n#elif defined(HAVE_GSSAPI_GSSAPI_H)\n# include <gssapi/gssapi.h>\n#endif\n\n#ifdef HAVE_GSSAPI_GENERIC_H\n# include <gssapi_generic.h>\n#elif defined(HAVE_GSSAPI_GSSAPI_GENERIC_H)\n# include <gssapi/gssapi_generic.h>\n#endif\n\t\t]])\n\t\tsaved_LIBS=\"$LIBS\"\n\t\tLIBS=\"$LIBS $K5LIBS\"\n\t\tAC_CHECK_FUNCS([krb5_cc_new_unique krb5_get_error_message krb5_free_error_message])\n\t\tLIBS=\"$saved_LIBS\"\n\n\tfi\n\t]\n)\nAC_SUBST([GSSLIBS])\nAC_SUBST([K5LIBS])\nAC_SUBST([CHANNELLIBS])\n\n# Looking for programs, paths and files\n\nPRIVSEP_PATH=/var/empty\nAC_ARG_WITH([privsep-path],\n\t[  --with-privsep-path=xxx Path for privilege separation chroot (default=/var/empty)],\n\t[\n\t\tif test -n \"$withval\"  &&  test \"x$withval\" != \"xno\"  &&  \\\n\t\t    test \"x${withval}\" != \"xyes\"; then\n\t\t\tPRIVSEP_PATH=$withval\n\t\tfi\n\t]\n)\nAC_SUBST([PRIVSEP_PATH])\n\nAC_ARG_WITH([xauth],\n\t[  --with-xauth=PATH       Specify path to xauth program ],\n\t[\n\t\tif test -n \"$withval\"  &&  test \"x$withval\" != \"xno\"  &&  \\\n\t\t    test \"x${withval}\" != \"xyes\"; then\n\t\t\txauth_path=$withval\n\t\tfi\n\t],\n\t[\n\t\tTestPath=\"$PATH\"\n\t\tTestPath=\"${TestPath}${PATH_SEPARATOR}/usr/X/bin\"\n\t\tTestPath=\"${TestPath}${PATH_SEPARATOR}/usr/bin/X11\"\n\t\tTestPath=\"${TestPath}${PATH_SEPARATOR}/usr/X11R6/bin\"\n\t\tTestPath=\"${TestPath}${PATH_SEPARATOR}/usr/openwin/bin\"\n\t\tAC_PATH_PROG([xauth_path], [xauth], , [$TestPath])\n\t\tif (test ! -z \"$xauth_path\" && test -x \"/usr/openwin/bin/xauth\") ; then\n\t\t\txauth_path=\"/usr/openwin/bin/xauth\"\n\t\tfi\n\t]\n)\n\nSTRIP_OPT=-s\nAC_ARG_ENABLE([strip],\n\t[  --disable-strip         Disable calling strip(1) on install],\n\t[\n\t\tif test \"x$enableval\" = \"xno\" ; then\n\t\t\tSTRIP_OPT=\n\t\tfi\n\t]\n)\nAC_SUBST([STRIP_OPT])\n\nif test -z \"$xauth_path\" ; then\n\tXAUTH_PATH=\"undefined\"\n\tAC_SUBST([XAUTH_PATH])\nelse\n\tAC_DEFINE_UNQUOTED([XAUTH_PATH], [\"$xauth_path\"],\n\t\t[Define if xauth is found in your path])\n\tXAUTH_PATH=$xauth_path\n\tAC_SUBST([XAUTH_PATH])\nfi\n\ndnl # --with-maildir=/path/to/mail gets top priority.\ndnl # if maildir is set in the platform case statement above we use that.\ndnl # Otherwise we run a program to get the dir from system headers.\ndnl # We first look for _PATH_MAILDIR then MAILDIR then _PATH_MAIL\ndnl # If we find _PATH_MAILDIR we do nothing because that is what\ndnl # session.c expects anyway. Otherwise we set to the value found\ndnl # stripping any trailing slash. If for some strage reason our program\ndnl # does not find what it needs, we default to /var/spool/mail.\n# Check for mail directory\nAC_ARG_WITH([maildir],\n    [  --with-maildir=/path/to/mail    Specify your system mail directory],\n    [\n\tif test \"X$withval\" != X  &&  test \"x$withval\" != xno  &&  \\\n\t    test \"x${withval}\" != xyes; then\n\t\tAC_DEFINE_UNQUOTED([MAIL_DIRECTORY], [\"$withval\"],\n            [Set this to your mail directory if you do not have _PATH_MAILDIR])\n\t    fi\n     ],[\n\tif test \"X$maildir\" != \"X\"; then\n\t    AC_DEFINE_UNQUOTED([MAIL_DIRECTORY], [\"$maildir\"])\n\telse\n\t    AC_MSG_CHECKING([Discovering system mail directory])\n\t    AC_RUN_IFELSE(\n\t\t[AC_LANG_PROGRAM([[\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#ifdef HAVE_PATHS_H\n#include <paths.h>\n#endif\n#ifdef HAVE_MAILLOCK_H\n#include <maillock.h>\n#endif\n#define DATA \"conftest.maildir\"\n\t]], [[\n\tFILE *fd;\n\tint rc;\n\n\tfd = fopen(DATA,\"w\");\n\tif(fd == NULL)\n\t\texit(1);\n\n#if defined (_PATH_MAILDIR)\n\tif ((rc = fprintf(fd ,\"_PATH_MAILDIR:%s\\n\", _PATH_MAILDIR)) <0)\n\t\texit(1);\n#elif defined (MAILDIR)\n\tif ((rc = fprintf(fd ,\"MAILDIR:%s\\n\", MAILDIR)) <0)\n\t\texit(1);\n#elif defined (_PATH_MAIL)\n\tif ((rc = fprintf(fd ,\"_PATH_MAIL:%s\\n\", _PATH_MAIL)) <0)\n\t\texit(1);\n#else\n\texit (2);\n#endif\n\n\texit(0);\n\t\t]])],\n\t\t[\n\t\t    maildir_what=`awk -F: '{print $1}' conftest.maildir`\n\t\t    maildir=`awk -F: '{print $2}' conftest.maildir \\\n\t\t\t| sed 's|/$||'`\n\t\t    AC_MSG_RESULT([Using: $maildir from $maildir_what])\n\t\t    if test \"x$maildir_what\" != \"x_PATH_MAILDIR\"; then\n\t\t\tAC_DEFINE_UNQUOTED([MAIL_DIRECTORY], [\"$maildir\"])\n\t\t    fi\n\t\t],\n\t\t[\n\t\t    if test \"X$ac_status\" = \"X2\";then\n# our test program didn't find it. Default to /var/spool/mail\n\t\t\tAC_MSG_RESULT([Using: default value of /var/spool/mail])\n\t\t\tAC_DEFINE_UNQUOTED([MAIL_DIRECTORY], [\"/var/spool/mail\"])\n\t\t     else\n\t\t\tAC_MSG_RESULT([*** not found ***])\n\t\t     fi\n\t\t],\n\t\t[\n\t\t\tAC_MSG_WARN([cross compiling: use --with-maildir=/path/to/mail])\n\t\t]\n\t    )\n\tfi\n    ]\n) # maildir\n\nif test ! -z \"$cross_compiling\" && test \"x$cross_compiling\" = \"xyes\"; then\n\tAC_MSG_WARN([cross compiling: Disabling /dev/ptmx test])\n\tdisable_ptmx_check=yes\nfi\nif test -z \"$no_dev_ptmx\" ; then\n\tif test \"x$disable_ptmx_check\" != \"xyes\" ; then\n\t\tAC_CHECK_FILE([\"/dev/ptmx\"],\n\t\t\t[\n\t\t\t\tAC_DEFINE_UNQUOTED([HAVE_DEV_PTMX], [1],\n\t\t\t\t\t[Define if you have /dev/ptmx])\n\t\t\t\thave_dev_ptmx=1\n\t\t\t]\n\t\t)\n\tfi\nfi\n\nif test ! -z \"$cross_compiling\" && test \"x$cross_compiling\" != \"xyes\"; then\n\tAC_CHECK_FILE([\"/dev/ptc\"],\n\t\t[\n\t\t\tAC_DEFINE_UNQUOTED([HAVE_DEV_PTS_AND_PTC], [1],\n\t\t\t\t[Define if you have /dev/ptc])\n\t\t\thave_dev_ptc=1\n\t\t]\n\t)\nelse\n\tAC_MSG_WARN([cross compiling: Disabling /dev/ptc test])\nfi\n\n# Options from here on. Some of these are preset by platform above\nAC_ARG_WITH([mantype],\n\t[  --with-mantype=man|cat|doc  Set man page type],\n\t[\n\t\tcase \"$withval\" in\n\t\tman|cat|doc)\n\t\t\tMANTYPE=$withval\n\t\t\t;;\n\t\t*)\n\t\t\tAC_MSG_ERROR([invalid man type: $withval])\n\t\t\t;;\n\t\tesac\n\t]\n)\nif test -z \"$MANTYPE\"; then\n\tif ${MANDOC} ${srcdir}/ssh.1 >/dev/null 2>&1; then\n\t\tMANTYPE=doc\n\telif ${NROFF} -mdoc ${srcdir}/ssh.1 >/dev/null 2>&1; then\n\t\tMANTYPE=doc\n\telif ${NROFF} -man ${srcdir}/ssh.1 >/dev/null 2>&1; then\n\t\tMANTYPE=man\n\telse\n\t\tMANTYPE=cat\n\tfi\nfi\nAC_SUBST([MANTYPE])\nif test \"$MANTYPE\" = \"doc\"; then\n\tmansubdir=man;\nelse\n\tmansubdir=$MANTYPE;\nfi\nAC_SUBST([mansubdir])\n\n# Whether to disable shadow password support\nAC_ARG_WITH([shadow],\n\t[  --without-shadow        Disable shadow password support],\n\t[\n\t\tif test \"x$withval\" = \"xno\" ; then\n\t\t\tAC_DEFINE([DISABLE_SHADOW])\n\t\t\tdisable_shadow=yes\n\t\tfi\n\t]\n)\n\nif test -z \"$disable_shadow\" ; then\n\tAC_MSG_CHECKING([if the systems has expire shadow information])\n\tAC_COMPILE_IFELSE([AC_LANG_PROGRAM([[\n#include <sys/types.h>\n#include <shadow.h>\nstruct spwd sp;\n\t\t]], [[ sp.sp_expire = sp.sp_lstchg = sp.sp_inact = 0; ]])],\n\t\t[ sp_expire_available=yes ], [\n\t])\n\n\tif test \"x$sp_expire_available\" = \"xyes\" ; then\n\t\tAC_MSG_RESULT([yes])\n\t\tAC_DEFINE([HAS_SHADOW_EXPIRE], [1],\n\t\t    [Define if you want to use shadow password expire field])\n\telse\n\t\tAC_MSG_RESULT([no])\n\tfi\nfi\n\n# Use ip address instead of hostname in $DISPLAY\nif test ! -z \"$IPADDR_IN_DISPLAY\" ; then\n\tDISPLAY_HACK_MSG=\"yes\"\n\tAC_DEFINE([IPADDR_IN_DISPLAY], [1],\n\t\t[Define if you need to use IP address\n\t\tinstead of hostname in $DISPLAY])\nelse\n\tDISPLAY_HACK_MSG=\"no\"\n\tAC_ARG_WITH([ipaddr-display],\n\t\t[  --with-ipaddr-display   Use ip address instead of hostname in $DISPLAY],\n\t\t[\n\t\t\tif test \"x$withval\" != \"xno\" ; then\n\t\t\t\tAC_DEFINE([IPADDR_IN_DISPLAY])\n\t\t\t\tDISPLAY_HACK_MSG=\"yes\"\n\t\t\tfi\n\t\t]\n\t)\nfi\n\n# check for /etc/default/login and use it if present.\nAC_ARG_ENABLE([etc-default-login],\n\t[  --disable-etc-default-login Disable using PATH from /etc/default/login [no]],\n\t[ if test \"x$enableval\" = \"xno\"; then\n\t\tAC_MSG_NOTICE([/etc/default/login handling disabled])\n\t\tetc_default_login=no\n\t  else\n\t\tetc_default_login=yes\n\t  fi ],\n\t[ if test ! -z \"$cross_compiling\" && test \"x$cross_compiling\" = \"xyes\";\n\t  then\n\t\tAC_MSG_WARN([cross compiling: not checking /etc/default/login])\n\t\tetc_default_login=no\n\t  else\n\t\tetc_default_login=yes\n\t  fi ]\n)\n\nif test \"x$etc_default_login\" != \"xno\"; then\n\tAC_CHECK_FILE([\"/etc/default/login\"],\n\t    [ external_path_file=/etc/default/login ])\n\tif test \"x$external_path_file\" = \"x/etc/default/login\"; then\n\t\tAC_DEFINE([HAVE_ETC_DEFAULT_LOGIN], [1],\n\t\t\t[Define if your system has /etc/default/login])\n\tfi\nfi\n\ndnl BSD systems use /etc/login.conf so --with-default-path= has no effect\nif test $ac_cv_func_login_getcapbool = \"yes\" && \\\n\ttest $ac_cv_header_login_cap_h = \"yes\" ; then\n\texternal_path_file=/etc/login.conf\nfi\n\n# Whether to mess with the default path\nSERVER_PATH_MSG=\"(default)\"\nAC_ARG_WITH([default-path],\n\t[  --with-default-path=    Specify default $PATH environment for server],\n\t[\n\t\tif test \"x$external_path_file\" = \"x/etc/login.conf\" ; then\n\t\t\tAC_MSG_WARN([\n--with-default-path=PATH has no effect on this system.\nEdit /etc/login.conf instead.])\n\t\telif test \"x$withval\" != \"xno\" ; then\n\t\t\tif test ! -z \"$external_path_file\" ; then\n\t\t\t\tAC_MSG_WARN([\n--with-default-path=PATH will only be used if PATH is not defined in\n$external_path_file .])\n\t\t\tfi\n\t\t\tuser_path=\"$withval\"\n\t\t\tSERVER_PATH_MSG=\"$withval\"\n\t\tfi\n\t],\n\t[ if test \"x$external_path_file\" = \"x/etc/login.conf\" ; then\n\t\tAC_MSG_WARN([Make sure the path to scp is in /etc/login.conf])\n\telse\n\t\tif test ! -z \"$external_path_file\" ; then\n\t\t\tAC_MSG_WARN([\nIf PATH is defined in $external_path_file, ensure the path to scp is included,\notherwise scp will not work.])\n\t\tfi\n\t\tAC_RUN_IFELSE(\n\t\t\t[AC_LANG_PROGRAM([[\n/* find out what STDPATH is */\n#include <stdio.h>\n#include <stdlib.h>\n#ifdef HAVE_PATHS_H\n# include <paths.h>\n#endif\n#ifndef _PATH_STDPATH\n# ifdef _PATH_USERPATH\t/* Irix */\n#  define _PATH_STDPATH _PATH_USERPATH\n# else\n#  define _PATH_STDPATH \"/usr/bin:/bin:/usr/sbin:/sbin\"\n# endif\n#endif\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#define DATA \"conftest.stdpath\"\n\t\t\t]], [[\n\tFILE *fd;\n\tint rc;\n\n\tfd = fopen(DATA,\"w\");\n\tif(fd == NULL)\n\t\texit(1);\n\n\tif ((rc = fprintf(fd,\"%s\", _PATH_STDPATH)) < 0)\n\t\texit(1);\n\n\texit(0);\n\t\t]])],\n\t\t[ user_path=`cat conftest.stdpath` ],\n\t\t[ user_path=\"/usr/bin:/bin:/usr/sbin:/sbin\" ],\n\t\t[ user_path=\"/usr/bin:/bin:/usr/sbin:/sbin\" ]\n\t)\n# make sure $bindir is in USER_PATH so scp will work\n\t\tt_bindir=\"${bindir}\"\n\t\twhile echo \"${t_bindir}\" | egrep '\\$\\{|NONE/' >/dev/null 2>&1; do\n\t\t\tt_bindir=`eval echo ${t_bindir}`\n\t\t\tcase $t_bindir in\n\t\t\t\tNONE/*) t_bindir=`echo $t_bindir | sed \"s~NONE~$prefix~\"` ;;\n\t\t\tesac\n\t\t\tcase $t_bindir in\n\t\t\t\tNONE/*) t_bindir=`echo $t_bindir | sed \"s~NONE~$ac_default_prefix~\"` ;;\n\t\t\tesac\n\t\tdone\n\t\techo $user_path | grep \":$t_bindir\"  > /dev/null 2>&1\n\t\tif test $? -ne 0  ; then\n\t\t\techo $user_path | grep \"^$t_bindir\"  > /dev/null 2>&1\n\t\t\tif test $? -ne 0  ; then\n\t\t\t\tuser_path=$user_path:$t_bindir\n\t\t\t\tAC_MSG_RESULT([Adding $t_bindir to USER_PATH so scp will work])\n\t\t\tfi\n\t\tfi\n\tfi ]\n)\nif test \"x$external_path_file\" != \"x/etc/login.conf\" ; then\n\tAC_DEFINE_UNQUOTED([USER_PATH], [\"$user_path\"], [Specify default $PATH])\n\tAC_SUBST([user_path])\nfi\n\n# Set superuser path separately to user path\nAC_ARG_WITH([superuser-path],\n\t[  --with-superuser-path=  Specify different path for super-user],\n\t[\n\t\tif test -n \"$withval\"  &&  test \"x$withval\" != \"xno\"  &&  \\\n\t\t    test \"x${withval}\" != \"xyes\"; then\n\t\t\tAC_DEFINE_UNQUOTED([SUPERUSER_PATH], [\"$withval\"],\n\t\t\t\t[Define if you want a different $PATH\n\t\t\t\tfor the superuser])\n\t\t\tsuperuser_path=$withval\n\t\tfi\n\t]\n)\n\n\nAC_MSG_CHECKING([if we need to convert IPv4 in IPv6-mapped addresses])\nIPV4_IN6_HACK_MSG=\"no\"\nAC_ARG_WITH(4in6,\n\t[  --with-4in6             Check for and convert IPv4 in IPv6 mapped addresses],\n\t[\n\t\tif test \"x$withval\" != \"xno\" ; then\n\t\t\tAC_MSG_RESULT([yes])\n\t\t\tAC_DEFINE([IPV4_IN_IPV6], [1],\n\t\t\t\t[Detect IPv4 in IPv6 mapped addresses\n\t\t\t\tand treat as IPv4])\n\t\t\tIPV4_IN6_HACK_MSG=\"yes\"\n\t\telse\n\t\t\tAC_MSG_RESULT([no])\n\t\tfi\n\t], [\n\t\tif test \"x$inet6_default_4in6\" = \"xyes\"; then\n\t\t\tAC_MSG_RESULT([yes (default)])\n\t\t\tAC_DEFINE([IPV4_IN_IPV6])\n\t\t\tIPV4_IN6_HACK_MSG=\"yes\"\n\t\telse\n\t\t\tAC_MSG_RESULT([no (default)])\n\t\tfi\n\t]\n)\n\n# Whether to enable BSD auth support\nBSD_AUTH_MSG=no\nAC_ARG_WITH([bsd-auth],\n\t[  --with-bsd-auth         Enable BSD auth support],\n\t[\n\t\tif test \"x$withval\" != \"xno\" ; then\n\t\t\tAC_DEFINE([BSD_AUTH], [1],\n\t\t\t\t[Define if you have BSD auth support])\n\t\t\tBSD_AUTH_MSG=yes\n\t\tfi\n\t]\n)\n\n# Where to place sshd.pid\npiddir=/var/run\n# make sure the directory exists\nif test ! -d $piddir ; then\n\tpiddir=`eval echo ${sysconfdir}`\n\tcase $piddir in\n\t\tNONE/*) piddir=`echo $piddir | sed \"s~NONE~$ac_default_prefix~\"` ;;\n\tesac\nfi\n\nAC_ARG_WITH([pid-dir],\n\t[  --with-pid-dir=PATH     Specify location of sshd.pid file],\n\t[\n\t\tif test -n \"$withval\"  &&  test \"x$withval\" != \"xno\"  &&  \\\n\t\t    test \"x${withval}\" != \"xyes\"; then\n\t\t\tpiddir=$withval\n\t\t\tif test ! -d $piddir ; then\n\t\t\tAC_MSG_WARN([** no $piddir directory on this system **])\n\t\t\tfi\n\t\tfi\n\t]\n)\n\nAC_DEFINE_UNQUOTED([_PATH_SSH_PIDDIR], [\"$piddir\"],\n\t[Specify location of ssh.pid])\nAC_SUBST([piddir])\n\ndnl allow user to disable some login recording features\nAC_ARG_ENABLE([lastlog],\n\t[  --disable-lastlog       disable use of lastlog even if detected [no]],\n\t[\n\t\tif test \"x$enableval\" = \"xno\" ; then\n\t\t\tAC_DEFINE([DISABLE_LASTLOG])\n\t\tfi\n\t]\n)\nAC_ARG_ENABLE([utmp],\n\t[  --disable-utmp          disable use of utmp even if detected [no]],\n\t[\n\t\tif test \"x$enableval\" = \"xno\" ; then\n\t\t\tAC_DEFINE([DISABLE_UTMP])\n\t\tfi\n\t]\n)\nAC_ARG_ENABLE([utmpx],\n\t[  --disable-utmpx         disable use of utmpx even if detected [no]],\n\t[\n\t\tif test \"x$enableval\" = \"xno\" ; then\n\t\t\tAC_DEFINE([DISABLE_UTMPX], [1],\n\t\t\t\t[Define if you don't want to use utmpx])\n\t\tfi\n\t]\n)\nAC_ARG_ENABLE([wtmp],\n\t[  --disable-wtmp          disable use of wtmp even if detected [no]],\n\t[\n\t\tif test \"x$enableval\" = \"xno\" ; then\n\t\t\tAC_DEFINE([DISABLE_WTMP])\n\t\tfi\n\t]\n)\nAC_ARG_ENABLE([wtmpx],\n\t[  --disable-wtmpx         disable use of wtmpx even if detected [no]],\n\t[\n\t\tif test \"x$enableval\" = \"xno\" ; then\n\t\t\tAC_DEFINE([DISABLE_WTMPX], [1],\n\t\t\t\t[Define if you don't want to use wtmpx])\n\t\tfi\n\t]\n)\nAC_ARG_ENABLE([libutil],\n\t[  --disable-libutil       disable use of libutil (login() etc.) [no]],\n\t[\n\t\tif test \"x$enableval\" = \"xno\" ; then\n\t\t\tAC_DEFINE([DISABLE_LOGIN])\n\t\tfi\n\t]\n)\nAC_ARG_ENABLE([pututline],\n\t[  --disable-pututline     disable use of pututline() etc. ([uw]tmp) [no]],\n\t[\n\t\tif test \"x$enableval\" = \"xno\" ; then\n\t\t\tAC_DEFINE([DISABLE_PUTUTLINE], [1],\n\t\t\t\t[Define if you don't want to use pututline()\n\t\t\t\tetc. to write [uw]tmp])\n\t\tfi\n\t]\n)\nAC_ARG_ENABLE([pututxline],\n\t[  --disable-pututxline    disable use of pututxline() etc. ([uw]tmpx) [no]],\n\t[\n\t\tif test \"x$enableval\" = \"xno\" ; then\n\t\t\tAC_DEFINE([DISABLE_PUTUTXLINE], [1],\n\t\t\t\t[Define if you don't want to use pututxline()\n\t\t\t\tetc. to write [uw]tmpx])\n\t\tfi\n\t]\n)\nAC_ARG_WITH([lastlog],\n  [  --with-lastlog=FILE|DIR specify lastlog location [common locations]],\n\t[\n\t\tif test \"x$withval\" = \"xno\" ; then\n\t\t\tAC_DEFINE([DISABLE_LASTLOG])\n\t\telif test -n \"$withval\"  &&  test \"x${withval}\" != \"xyes\"; then\n\t\t\tconf_lastlog_location=$withval\n\t\tfi\n\t]\n)\n\ndnl lastlog, [uw]tmpx? detection\ndnl  NOTE: set the paths in the platform section to avoid the\ndnl   need for command-line parameters\ndnl lastlog and [uw]tmp are subject to a file search if all else fails\n\ndnl lastlog detection\ndnl  NOTE: the code itself will detect if lastlog is a directory\nAC_MSG_CHECKING([if your system defines LASTLOG_FILE])\nAC_COMPILE_IFELSE([AC_LANG_PROGRAM([[\n#include <sys/types.h>\n#include <utmp.h>\n#ifdef HAVE_LASTLOG_H\n#  include <lastlog.h>\n#endif\n#ifdef HAVE_PATHS_H\n#  include <paths.h>\n#endif\n#ifdef HAVE_LOGIN_H\n# include <login.h>\n#endif\n\t]], [[ char *lastlog = LASTLOG_FILE; ]])],\n\t\t[ AC_MSG_RESULT([yes]) ],\n\t\t[\n\t\tAC_MSG_RESULT([no])\n\t\tAC_MSG_CHECKING([if your system defines _PATH_LASTLOG])\n\t\tAC_COMPILE_IFELSE([AC_LANG_PROGRAM([[\n#include <sys/types.h>\n#include <utmp.h>\n#ifdef HAVE_LASTLOG_H\n#  include <lastlog.h>\n#endif\n#ifdef HAVE_PATHS_H\n#  include <paths.h>\n#endif\n\t\t]], [[ char *lastlog = _PATH_LASTLOG; ]])],\n\t\t[ AC_MSG_RESULT([yes]) ],\n\t\t[\n\t\t\tAC_MSG_RESULT([no])\n\t\t\tsystem_lastlog_path=no\n\t\t])\n])\n\nif test -z \"$conf_lastlog_location\"; then\n\tif test x\"$system_lastlog_path\" = x\"no\" ; then\n\t\tfor f in /var/log/lastlog /usr/adm/lastlog /var/adm/lastlog /etc/security/lastlog ; do\n\t\t\t\tif (test -d \"$f\" || test -f \"$f\") ; then\n\t\t\t\t\tconf_lastlog_location=$f\n\t\t\t\tfi\n\t\tdone\n\t\tif test -z \"$conf_lastlog_location\"; then\n\t\t\tAC_MSG_WARN([** Cannot find lastlog **])\n\t\t\tdnl Don't define DISABLE_LASTLOG - that means we don't try wtmp/wtmpx\n\t\tfi\n\tfi\nfi\n\nif test -n \"$conf_lastlog_location\"; then\n\tAC_DEFINE_UNQUOTED([CONF_LASTLOG_FILE], [\"$conf_lastlog_location\"],\n\t\t[Define if you want to specify the path to your lastlog file])\nfi\n\ndnl utmp detection\nAC_MSG_CHECKING([if your system defines UTMP_FILE])\nAC_COMPILE_IFELSE([AC_LANG_PROGRAM([[\n#include <sys/types.h>\n#include <utmp.h>\n#ifdef HAVE_PATHS_H\n#  include <paths.h>\n#endif\n\t]], [[ char *utmp = UTMP_FILE; ]])],\n\t[ AC_MSG_RESULT([yes]) ],\n\t[ AC_MSG_RESULT([no])\n\t  system_utmp_path=no\n])\nif test -z \"$conf_utmp_location\"; then\n\tif test x\"$system_utmp_path\" = x\"no\" ; then\n\t\tfor f in /etc/utmp /usr/adm/utmp /var/run/utmp; do\n\t\t\tif test -f $f ; then\n\t\t\t\tconf_utmp_location=$f\n\t\t\tfi\n\t\tdone\n\t\tif test -z \"$conf_utmp_location\"; then\n\t\t\tAC_DEFINE([DISABLE_UTMP])\n\t\tfi\n\tfi\nfi\nif test -n \"$conf_utmp_location\"; then\n\tAC_DEFINE_UNQUOTED([CONF_UTMP_FILE], [\"$conf_utmp_location\"],\n\t\t[Define if you want to specify the path to your utmp file])\nfi\n\ndnl wtmp detection\nAC_MSG_CHECKING([if your system defines WTMP_FILE])\nAC_COMPILE_IFELSE([AC_LANG_PROGRAM([[\n#include <sys/types.h>\n#include <utmp.h>\n#ifdef HAVE_PATHS_H\n#  include <paths.h>\n#endif\n\t]], [[ char *wtmp = WTMP_FILE; ]])],\n\t[ AC_MSG_RESULT([yes]) ],\n\t[ AC_MSG_RESULT([no])\n\t  system_wtmp_path=no\n])\nif test -z \"$conf_wtmp_location\"; then\n\tif test x\"$system_wtmp_path\" = x\"no\" ; then\n\t\tfor f in /usr/adm/wtmp /var/log/wtmp; do\n\t\t\tif test -f $f ; then\n\t\t\t\tconf_wtmp_location=$f\n\t\t\tfi\n\t\tdone\n\t\tif test -z \"$conf_wtmp_location\"; then\n\t\t\tAC_DEFINE([DISABLE_WTMP])\n\t\tfi\n\tfi\nfi\nif test -n \"$conf_wtmp_location\"; then\n\tAC_DEFINE_UNQUOTED([CONF_WTMP_FILE], [\"$conf_wtmp_location\"],\n\t\t[Define if you want to specify the path to your wtmp file])\nfi\n\ndnl wtmpx detection\nAC_MSG_CHECKING([if your system defines WTMPX_FILE])\nAC_COMPILE_IFELSE([AC_LANG_PROGRAM([[\n#include <sys/types.h>\n#include <utmp.h>\n#ifdef HAVE_UTMPX_H\n#include <utmpx.h>\n#endif\n#ifdef HAVE_PATHS_H\n#  include <paths.h>\n#endif\n\t]], [[ char *wtmpx = WTMPX_FILE; ]])],\n\t[ AC_MSG_RESULT([yes]) ],\n\t[ AC_MSG_RESULT([no])\n\t  system_wtmpx_path=no\n])\nif test -z \"$conf_wtmpx_location\"; then\n\tif test x\"$system_wtmpx_path\" = x\"no\" ; then\n\t\tAC_DEFINE([DISABLE_WTMPX])\n\tfi\nelse\n\tAC_DEFINE_UNQUOTED([CONF_WTMPX_FILE], [\"$conf_wtmpx_location\"],\n\t\t[Define if you want to specify the path to your wtmpx file])\nfi\n\n\nif test ! -z \"$blibpath\" ; then\n\tLDFLAGS=\"$LDFLAGS $blibflags$blibpath\"\n\tAC_MSG_WARN([Please check and edit blibpath in LDFLAGS in Makefile])\nfi\n\nAC_CHECK_MEMBER([struct lastlog.ll_line], [], [\n    if test x$SKIP_DISABLE_LASTLOG_DEFINE != \"xyes\" ; then\n\tAC_DEFINE([DISABLE_LASTLOG])\n    fi\n\t], [\n#ifdef HAVE_SYS_TYPES_H\n#include <sys/types.h>\n#endif\n#ifdef HAVE_UTMP_H\n#include <utmp.h>\n#endif\n#ifdef HAVE_UTMPX_H\n#include <utmpx.h>\n#endif\n#ifdef HAVE_LASTLOG_H\n#include <lastlog.h>\n#endif\n\t])\n\nAC_CHECK_MEMBER([struct utmp.ut_line], [], [\n\tAC_DEFINE([DISABLE_UTMP])\n\tAC_DEFINE([DISABLE_WTMP])\n\t], [\n#ifdef HAVE_SYS_TYPES_H\n#include <sys/types.h>\n#endif\n#ifdef HAVE_UTMP_H\n#include <utmp.h>\n#endif\n#ifdef HAVE_UTMPX_H\n#include <utmpx.h>\n#endif\n#ifdef HAVE_LASTLOG_H\n#include <lastlog.h>\n#endif\n\t])\n\ndnl Adding -Werror to CFLAGS early prevents configure tests from running.\ndnl Add now.\nCFLAGS=\"$CFLAGS $werror_flags\"\n\nif test \"x$ac_cv_func_getaddrinfo\" != \"xyes\" ; then\n\tTEST_SSH_IPV6=no\nelse\n\tTEST_SSH_IPV6=yes\nfi\nAC_CHECK_DECL([BROKEN_GETADDRINFO],  [TEST_SSH_IPV6=no])\nAC_SUBST([TEST_SSH_IPV6], [$TEST_SSH_IPV6])\nAC_SUBST([TEST_SSH_UTF8], [$TEST_SSH_UTF8])\nAC_SUBST([TEST_MALLOC_OPTIONS], [$TEST_MALLOC_OPTIONS])\nAC_SUBST([UNSUPPORTED_ALGORITHMS], [$unsupported_algorithms])\nAC_SUBST([DEPEND], [$(cat $srcdir/.depend)])\n\n# Binaries for interop tests.\nAC_PATH_PROG([PLINK], [plink])\nAC_PATH_PROG([PUTTYGEN], [puttygen])\nAC_PATH_PROG([CONCH], [conch])\nAC_PATH_PROG([DROPBEAR], [dropbear])\nAC_PATH_PROG([DBCLIENT], [dbclient])\nAC_PATH_PROG([DROPBEARKEY], [dropbearkey])\nAC_PATH_PROG([DROPBEARCONVERT], [dropbearconvert])\n\nCFLAGS=\"${CFLAGS} ${CFLAGS_AFTER}\"\nLDFLAGS=\"${LDFLAGS} ${LDFLAGS_AFTER}\"\n\n# Make a copy of CFLAGS/LDFLAGS without PIE options.\nLDFLAGS_NOPIE=`echo \"$LDFLAGS\" | sed 's/ -pie//'`\nCFLAGS_NOPIE=`echo \"$CFLAGS\" | sed 's/ -fPIE//'`\nAC_SUBST([LDFLAGS_NOPIE])\nAC_SUBST([CFLAGS_NOPIE])\n\nAC_EXEEXT\nAC_CONFIG_FILES([Makefile buildpkg.sh opensshd.init openssh.xml \\\n\topenbsd-compat/Makefile openbsd-compat/regress/Makefile \\\n\tsurvey.sh])\nAC_OUTPUT\n\n# Print summary of options\n\n# Someone please show me a better way :)\nA=`eval echo ${prefix}` ; A=`eval echo ${A}`\nB=`eval echo ${bindir}` ; B=`eval echo ${B}`\nC=`eval echo ${sbindir}` ; C=`eval echo ${C}`\nD=`eval echo ${sysconfdir}` ; D=`eval echo ${D}`\nE=`eval echo ${libexecdir}/ssh-askpass` ; E=`eval echo ${E}`\nF=`eval echo ${mandir}/${mansubdir}X` ; F=`eval echo ${F}`\nG=`eval echo ${piddir}` ; G=`eval echo ${G}`\nH=`eval echo ${PRIVSEP_PATH}` ; H=`eval echo ${H}`\nI=`eval echo ${user_path}` ; I=`eval echo ${I}`\nJ=`eval echo ${superuser_path}` ; J=`eval echo ${J}`\n\necho \"\"\necho \"OpenSSH has been configured with the following options:\"\necho \"                     User binaries: $B\"\necho \"                   System binaries: $C\"\necho \"               Configuration files: $D\"\necho \"                   Askpass program: $E\"\necho \"                      Manual pages: $F\"\necho \"                          PID file: $G\"\necho \"  Privilege separation chroot path: $H\"\nif test \"x$external_path_file\" = \"x/etc/login.conf\" ; then\necho \"   At runtime, sshd will use the path defined in $external_path_file\"\necho \"   Make sure the path to scp is present, otherwise scp will not work\"\nelse\necho \"            sshd default user PATH: $I\"\n\tif test ! -z \"$external_path_file\"; then\necho \"   (If PATH is set in $external_path_file it will be used instead. If\"\necho \"   used, ensure the path to scp is present, otherwise scp will not work.)\"\n\tfi\nfi\nif test ! -z \"$superuser_path\" ; then\necho \"          sshd superuser user PATH: $J\"\nfi\necho \"                    Manpage format: $MANTYPE\"\necho \"                       PAM support: $PAM_MSG\"\necho \"                   OSF SIA support: $SIA_MSG\"\necho \"                 KerberosV support: $KRB5_MSG\"\necho \"                   SELinux support: $SELINUX_MSG\"\necho \"                   libedit support: $LIBEDIT_MSG\"\necho \"                   libldns support: $LDNS_MSG\"\necho \"  Solaris process contract support: $SPC_MSG\"\necho \"           Solaris project support: $SP_MSG\"\necho \"         Solaris privilege support: $SPP_MSG\"\necho \"       IP address in \\$DISPLAY hack: $DISPLAY_HACK_MSG\"\necho \"           Translate v4 in v6 hack: $IPV4_IN6_HACK_MSG\"\necho \"                  BSD Auth support: $BSD_AUTH_MSG\"\necho \"              Random number source: $RAND_MSG\"\necho \"             Privsep sandbox style: $SANDBOX_STYLE\"\necho \"                   PKCS#11 support: $enable_pkcs11\"\necho \"                  U2F/FIDO support: $enable_sk\"\n\necho \"\"\n\necho \"              Host: ${host}\"\necho \"          Compiler: ${CC}\"\necho \"    Compiler flags: ${CFLAGS}\"\necho \"Preprocessor flags: ${CPPFLAGS}\"\necho \"      Linker flags: ${LDFLAGS}\"\necho \"         Libraries: ${LIBS}\"\nif test ! -z \"${CHANNELLIBS}\"; then\necho \"     +for channels: ${CHANNELLIBS}\"\nfi\nif test ! -z \"${LIBFIDO2}\"; then\necho \"        +for FIDO2: ${LIBFIDO2}\"\nfi\nif test ! -z \"${SSHDLIBS}\"; then\necho \"         +for sshd: ${SSHDLIBS}\"\nfi\n\necho \"\"\n\nif test \"x$MAKE_PACKAGE_SUPPORTED\" = \"xyes\" ; then\n\techo \"SVR4 style packages are supported with \\\"make package\\\"\"\n\techo \"\"\nfi\n\nif test \"x$PAM_MSG\" = \"xyes\" ; then\n\techo \"PAM is enabled. You may need to install a PAM control file \"\n\techo \"for sshd, otherwise password authentication may fail. \"\n\techo \"Example PAM control files can be found in the contrib/ \"\n\techo \"subdirectory\"\n\techo \"\"\nfi\n\nif test ! -z \"$NO_PEERCHECK\" ; then\n\techo \"WARNING: the operating system that you are using does not\"\n\techo \"appear to support getpeereid(), getpeerucred() or the\"\n\techo \"SO_PEERCRED getsockopt() option. These facilities are used to\"\n\techo \"enforce security checks to prevent unauthorised connections to\"\n\techo \"ssh-agent. Their absence increases the risk that a malicious\"\n\techo \"user can connect to your agent.\"\n\techo \"\"\nfi\n\nif test \"$AUDIT_MODULE\" = \"bsm\" ; then\n\techo \"WARNING: BSM audit support is currently considered EXPERIMENTAL.\"\n\techo \"See the Solaris section in README.platform for details.\"\nfi\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}