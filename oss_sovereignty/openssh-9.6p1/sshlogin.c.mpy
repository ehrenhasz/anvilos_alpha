{
  "module_name": "sshlogin.c",
  "hash_id": "780418206bcb2b6689965134df048d0ab71e1353406b875e7c3cbc1785901dba",
  "original_prompt": "Ingested from openssh-9.6p1/sshlogin.c",
  "human_readable_source": " \n \n\n#include \"includes.h\"\n\n#include <sys/types.h>\n#include <sys/socket.h>\n\n#include <netinet/in.h>\n\n#include <errno.h>\n#include <fcntl.h>\n#include <stdarg.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <time.h>\n#include <unistd.h>\n#include <limits.h>\n\n#include \"sshlogin.h\"\n#include \"ssherr.h\"\n#include \"loginrec.h\"\n#include \"log.h\"\n#include \"sshbuf.h\"\n#include \"misc.h\"\n#include \"servconf.h\"\n\nextern struct sshbuf *loginmsg;\nextern ServerOptions options;\n\n \ntime_t\nget_last_login_time(uid_t uid, const char *logname,\n    char *buf, size_t bufsize)\n{\n\tstruct logininfo li;\n\n\tlogin_get_lastlog(&li, uid);\n\tstrlcpy(buf, li.hostname, bufsize);\n\treturn (time_t)li.tv_sec;\n}\n\n \nstatic void\nstore_lastlog_message(const char *user, uid_t uid)\n{\n#ifndef NO_SSH_LASTLOG\n# ifndef CUSTOM_SYS_AUTH_GET_LASTLOGIN_MSG\n\tchar hostname[HOST_NAME_MAX+1] = \"\";\n\ttime_t last_login_time;\n# endif\n\tchar *time_string;\n\tint r;\n\n\tif (!options.print_lastlog)\n\t\treturn;\n\n# ifdef CUSTOM_SYS_AUTH_GET_LASTLOGIN_MSG\n\ttime_string = sys_auth_get_lastlogin_msg(user, uid);\n\tif (time_string != NULL) {\n\t\tif ((r = sshbuf_put(loginmsg,\n\t\t    time_string, strlen(time_string))) != 0)\n\t\t\tfatal(\"%s: buffer error: %s\", __func__, ssh_err(r));\n\t\tfree(time_string);\n\t}\n# else\n\tlast_login_time = get_last_login_time(uid, user, hostname,\n\t    sizeof(hostname));\n\n\tif (last_login_time != 0) {\n\t\ttime_string = ctime(&last_login_time);\n\t\ttime_string[strcspn(time_string, \"\\n\")] = '\\0';\n\t\tif (strcmp(hostname, \"\") == 0)\n\t\t\tr = sshbuf_putf(loginmsg, \"Last login: %s\\r\\n\",\n\t\t\t    time_string);\n\t\telse\n\t\t\tr = sshbuf_putf(loginmsg, \"Last login: %s from %s\\r\\n\",\n\t\t\t    time_string, hostname);\n\t\tif (r != 0)\n\t\t\tfatal_fr(r, \"sshbuf_putf\");\n\t}\n# endif  \n#endif  \n}\n\n \nvoid\nrecord_login(pid_t pid, const char *tty, const char *user, uid_t uid,\n    const char *host, struct sockaddr *addr, socklen_t addrlen)\n{\n\tstruct logininfo *li;\n\n\t \n\tstore_lastlog_message(user, uid);\n\n\tli = login_alloc_entry(pid, user, host, tty);\n\tlogin_set_addr(li, addr, addrlen);\n\tlogin_login(li);\n\tlogin_free_entry(li);\n}\n\n#ifdef LOGIN_NEEDS_UTMPX\nvoid\nrecord_utmp_only(pid_t pid, const char *ttyname, const char *user,\n\t\t const char *host, struct sockaddr *addr, socklen_t addrlen)\n{\n\tstruct logininfo *li;\n\n\tli = login_alloc_entry(pid, user, host, ttyname);\n\tlogin_set_addr(li, addr, addrlen);\n\tlogin_utmp_only(li);\n\tlogin_free_entry(li);\n}\n#endif\n\n \nvoid\nrecord_logout(pid_t pid, const char *tty, const char *user)\n{\n\tstruct logininfo *li;\n\n\tli = login_alloc_entry(pid, user, NULL, tty);\n\tlogin_logout(li);\n\tlogin_free_entry(li);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}