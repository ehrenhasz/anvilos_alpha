{
  "module_name": "compat.c",
  "hash_id": "2d98071f142c35a5daaec283a2e97c7878b5dd76e3fa99a95d71c7388945b314",
  "original_prompt": "Ingested from openssh-9.6p1/compat.c",
  "human_readable_source": " \n \n\n#include \"includes.h\"\n\n#include <sys/types.h>\n\n#include <stdlib.h>\n#include <string.h>\n#include <stdarg.h>\n\n#include \"xmalloc.h\"\n#include \"packet.h\"\n#include \"compat.h\"\n#include \"log.h\"\n#include \"match.h\"\n\n \nvoid\ncompat_banner(struct ssh *ssh, const char *version)\n{\n\tint i;\n\tstatic struct {\n\t\tchar\t*pat;\n\t\tint\tbugs;\n\t} check[] = {\n\t\t{ \"OpenSSH_2.*,\"\n\t\t  \"OpenSSH_3.0*,\"\n\t\t  \"OpenSSH_3.1*\",\tSSH_BUG_EXTEOF|SSH_OLD_FORWARD_ADDR|\n\t\t\t\t\tSSH_BUG_SIGTYPE},\n\t\t{ \"OpenSSH_3.*\",\tSSH_OLD_FORWARD_ADDR|SSH_BUG_SIGTYPE },\n\t\t{ \"Sun_SSH_1.0*\",\tSSH_BUG_NOREKEY|SSH_BUG_EXTEOF|\n\t\t\t\t\tSSH_BUG_SIGTYPE},\n\t\t{ \"OpenSSH_2*,\"\n\t\t  \"OpenSSH_3*,\"\n\t\t  \"OpenSSH_4*\",\t\tSSH_BUG_SIGTYPE },\n\t\t{ \"OpenSSH_5*\",\t\tSSH_NEW_OPENSSH|SSH_BUG_DYNAMIC_RPORT|\n\t\t\t\t\tSSH_BUG_SIGTYPE},\n\t\t{ \"OpenSSH_6.6.1*\",\tSSH_NEW_OPENSSH|SSH_BUG_SIGTYPE},\n\t\t{ \"OpenSSH_6.5*,\"\n\t\t  \"OpenSSH_6.6*\",\tSSH_NEW_OPENSSH|SSH_BUG_CURVE25519PAD|\n\t\t\t\t\tSSH_BUG_SIGTYPE},\n\t\t{ \"OpenSSH_7.4*\",\tSSH_NEW_OPENSSH|SSH_BUG_SIGTYPE|\n\t\t\t\t\tSSH_BUG_SIGTYPE74},\n\t\t{ \"OpenSSH_7.0*,\"\n\t\t  \"OpenSSH_7.1*,\"\n\t\t  \"OpenSSH_7.2*,\"\n\t\t  \"OpenSSH_7.3*,\"\n\t\t  \"OpenSSH_7.5*,\"\n\t\t  \"OpenSSH_7.6*,\"\n\t\t  \"OpenSSH_7.7*\",\tSSH_NEW_OPENSSH|SSH_BUG_SIGTYPE},\n\t\t{ \"OpenSSH*\",\t\tSSH_NEW_OPENSSH },\n\t\t{ \"*MindTerm*\",\t\t0 },\n\t\t{ \"3.0.*\",\t\tSSH_BUG_DEBUG },\n\t\t{ \"3.0 SecureCRT*\",\tSSH_OLD_SESSIONID },\n\t\t{ \"1.7 SecureFX*\",\tSSH_OLD_SESSIONID },\n\t\t{ \"Cisco-1.*\",\t\tSSH_BUG_DHGEX_LARGE|\n\t\t\t\t\tSSH_BUG_HOSTKEYS },\n\t\t{ \"*SSH_Version_Mapper*\",\n\t\t\t\t\tSSH_BUG_SCANNER },\n\t\t{ \"PuTTY_Local:*,\"\t \n\t\t  \"PuTTY-Release-0.5*,\"  \n\t\t  \"PuTTY_Release_0.5*,\"\t \n\t\t  \"PuTTY_Release_0.60*,\"\n\t\t  \"PuTTY_Release_0.61*,\"\n\t\t  \"PuTTY_Release_0.62*,\"\n\t\t  \"PuTTY_Release_0.63*,\"\n\t\t  \"PuTTY_Release_0.64*\",\n\t\t\t\t\tSSH_OLD_DHGEX },\n\t\t{ \"FuTTY*\",\t\tSSH_OLD_DHGEX },  \n\t\t{ \"Probe-*\",\n\t\t\t\t\tSSH_BUG_PROBE },\n\t\t{ \"TeraTerm SSH*,\"\n\t\t  \"TTSSH/1.5.*,\"\n\t\t  \"TTSSH/2.1*,\"\n\t\t  \"TTSSH/2.2*,\"\n\t\t  \"TTSSH/2.3*,\"\n\t\t  \"TTSSH/2.4*,\"\n\t\t  \"TTSSH/2.5*,\"\n\t\t  \"TTSSH/2.6*,\"\n\t\t  \"TTSSH/2.70*,\"\n\t\t  \"TTSSH/2.71*,\"\n\t\t  \"TTSSH/2.72*\",\tSSH_BUG_HOSTKEYS },\n\t\t{ \"WinSCP_release_4*,\"\n\t\t  \"WinSCP_release_5.0*,\"\n\t\t  \"WinSCP_release_5.1,\"\n\t\t  \"WinSCP_release_5.1.*,\"\n\t\t  \"WinSCP_release_5.5,\"\n\t\t  \"WinSCP_release_5.5.*,\"\n\t\t  \"WinSCP_release_5.6,\"\n\t\t  \"WinSCP_release_5.6.*,\"\n\t\t  \"WinSCP_release_5.7,\"\n\t\t  \"WinSCP_release_5.7.1,\"\n\t\t  \"WinSCP_release_5.7.2,\"\n\t\t  \"WinSCP_release_5.7.3,\"\n\t\t  \"WinSCP_release_5.7.4\",\n\t\t\t\t\tSSH_OLD_DHGEX },\n\t\t{ \"ConfD-*\",\n\t\t\t\t\tSSH_BUG_UTF8TTYMODE },\n\t\t{ \"Twisted_*\",\t\t0 },\n\t\t{ \"Twisted*\",\t\tSSH_BUG_DEBUG },\n\t\t{ NULL,\t\t\t0 }\n\t};\n\n\t \n\tssh->compat = 0;\n\tfor (i = 0; check[i].pat; i++) {\n\t\tif (match_pattern_list(version, check[i].pat, 0) == 1) {\n\t\t\tdebug_f(\"match: %s pat %s compat 0x%08x\",\n\t\t\t    version, check[i].pat, check[i].bugs);\n\t\t\tssh->compat = check[i].bugs;\n\t\t\treturn;\n\t\t}\n\t}\n\tdebug_f(\"no match: %s\", version);\n}\n\n \nchar *\ncompat_kex_proposal(struct ssh *ssh, const char *p)\n{\n\tchar *cp = NULL, *cp2 = NULL;\n\n\tif ((ssh->compat & (SSH_BUG_CURVE25519PAD|SSH_OLD_DHGEX)) == 0)\n\t\treturn xstrdup(p);\n\tdebug2_f(\"original KEX proposal: %s\", p);\n\tif ((ssh->compat & SSH_BUG_CURVE25519PAD) != 0)\n\t\tif ((cp = match_filter_denylist(p,\n\t\t    \"curve25519-sha256@libssh.org\")) == NULL)\n\t\t\tfatal(\"match_filter_denylist failed\");\n\tif ((ssh->compat & SSH_OLD_DHGEX) != 0) {\n\t\tif ((cp2 = match_filter_denylist(cp ? cp : p,\n\t\t    \"diffie-hellman-group-exchange-sha256,\"\n\t\t    \"diffie-hellman-group-exchange-sha1\")) == NULL)\n\t\t\tfatal(\"match_filter_denylist failed\");\n\t\tfree(cp);\n\t\tcp = cp2;\n\t}\n\tif (cp == NULL || *cp == '\\0')\n\t\tfatal(\"No supported key exchange algorithms found\");\n\tdebug2_f(\"compat KEX proposal: %s\", cp);\n\treturn cp;\n}\n\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}