{
  "module_name": "mdoc2man.awk",
  "hash_id": "b3193e3bd93ac44d4e5f344f713d864cf66048fc11ada2f0df95458b604d0226",
  "original_prompt": "Ingested from openssh-9.6p1/mdoc2man.awk",
  "human_readable_source": "#!/usr/bin/awk\n#\n# Version history:\n#  v4+ Adapted for OpenSSH Portable (see cvs Id and history)\n#  v3, I put the program under a proper license\n#      Dan Nelson <dnelson@allantgroup.com> added .An, .Aq and fixed a typo\n#  v2, fixed to work on GNU awk --posix and MacOS X\n#  v1, first attempt, didn't work on MacOS X\n#\n# Copyright (c) 2003 Peter Stuge <stuge-mdoc2man@cdy.org>\n#\n# Permission to use, copy, modify, and distribute this software for any\n# purpose with or without fee is hereby granted, provided that the above\n# copyright notice and this permission notice appear in all copies.\n#\n# THE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES\n# WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF\n# MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR\n# ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES\n# WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN\n# ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF\n# OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.\n\n\nBEGIN {\n  optlist=0\n  oldoptlist=0\n  nospace=0\n  synopsis=0\n  reference=0\n  block=0\n  ext=0\n  extopt=0\n  literal=0\n  prenl=0\n  breakw=0\n  line=\"\"\n}\n\nfunction wtail() {\n  retval=\"\"\n  while(w<nwords) {\n    if(length(retval))\n      retval=retval OFS\n    retval=retval words[++w]\n  }\n  return retval\n}\n\nfunction add(str) {\n  for(;prenl;prenl--)\n    line=line \"\\n\"\n  line=line str\n}\n\n! /^\\./ {\n  for(;prenl;prenl--)\n    print \"\"\n  print\n  if(literal)\n    print \".br\"\n  next\n}\n\n/^\\.\\\\\"/ { next }\n\n{\n  option=0\n  parens=0\n  angles=0\n  sub(\"^\\\\.\",\"\")\n  nwords=split($0,words)\n  for(w=1;w<=nwords;w++) {\n    skip=0\n    if(match(words[w],\"^Li|Pf$\")) {\n      skip=1\n    } else if(match(words[w],\"^Xo$\")) {\n      skip=1\n      ext=1\n      if(length(line)&&!(match(line,\" $\")||prenl))\n\tadd(OFS)\n    } else if(match(words[w],\"^Xc$\")) {\n      skip=1\n      ext=0\n      if(!extopt)\n\tprenl++\n      w=nwords\n    } else if(match(words[w],\"^Bd$\")) {\n      skip=1\n      if(match(words[w+1],\"-literal\")) {\n\tliteral=1\n\tprenl++\n\tw=nwords\n      }\n    } else if(match(words[w],\"^Ed$\")) {\n      skip=1\n      literal=0\n    } else if(match(words[w],\"^Ns$\")) {\n      skip=1\n      if(!nospace)\n\tnospace=1\n      sub(\" $\",\"\",line)\n    } else if(match(words[w],\"^No$\")) {\n      skip=1\n      sub(\" $\",\"\",line)\n      add(words[++w])\n    } else if(match(words[w],\"^Dq$\")) {\n      skip=1\n      add(\"``\")\n      add(words[++w])\n      while(w<nwords&&!match(words[w+1],\"^[\\\\.,]\"))\n\tadd(OFS words[++w])\n      add(\"''\")\n      if(!nospace&&match(words[w+1],\"^[\\\\.,]\"))\n\tnospace=1\n    } else if(match(words[w],\"^Sq|Ql$\")) {\n      skip=1\n      add(\"`\" words[++w] \"'\")\n      if(!nospace&&match(words[w+1],\"^[\\\\.,]\"))\n\tnospace=1\n    } else if(match(words[w],\"^Oo$\")) {\n      skip=1\n      extopt=1\n      if(!nospace)\n\tnospace=1\n      add(\"[\")\n    } else if(match(words[w],\"^Oc$\")) {\n      skip=1\n      extopt=0\n      add(\"]\")\n    }\n    if(!skip) {\n      if(!nospace&&length(line)&&!(match(line,\" $\")||prenl))\n\tadd(OFS)\n      if(nospace==1)\n\tnospace=0\n    }\n    if(match(words[w],\"^Dd$\")) {\n      if(match(words[w+1],\"^\\\\$Mdocdate:\")) {\n        w++;\n        if(match(words[w+4],\"^\\\\$$\")) {\n          words[w+4] = \"\"\n        }\n      }\n      date=wtail()\n      next\n    } else if(match(words[w],\"^Dt$\")) {\n      id=wtail()\n      next\n    } else if(match(words[w],\"^Ux$\")) {\n      add(\"UNIX\")\n      skip=1\n    } else if(match(words[w],\"^Ox$\")) {\n      add(\"OpenBSD\")\n      skip=1\n    } else if(match(words[w],\"^Os$\")) {\n      add(\".TH \" id \" \\\"\" date \"\\\" \\\"\" wtail() \"\\\"\")\n    } else if(match(words[w],\"^Sh$\")) {\n      add(\".SH\")\n      synopsis=match(words[w+1],\"SYNOPSIS\")\n    } else if(match(words[w],\"^Xr$\")) {\n      add(\"\\\\fB\" words[++w] \"\\\\fP(\" words[++w] \")\" words[++w])\n    } else if(match(words[w],\"^Rs$\")) {\n      split(\"\",refauthors)\n      nrefauthors=0\n      reftitle=\"\"\n      refissue=\"\"\n      refdate=\"\"\n      refopt=\"\"\n      refreport=\"\"\n      reference=1\n      next\n    } else if(match(words[w],\"^Re$\")) {\n      prenl++\n      for(i=nrefauthors-1;i>0;i--) {\n\tadd(refauthors[i])\n\tif(i>1)\n\t  add(\", \")\n      }\n      if(nrefauthors>1)\n\tadd(\" and \")\n      if(nrefauthors>0)\n        add(refauthors[0] \", \")\n      add(\"\\\\fI\" reftitle \"\\\\fP\")\n      if(length(refissue))\n\tadd(\", \" refissue)\n      if(length(refreport)) {\n\tadd(\", \" refreport)\n      }\n      if(length(refdate))\n\tadd(\", \" refdate)\n      if(length(refopt))\n\tadd(\", \" refopt)\n      add(\".\")\n      reference=0\n    } else if(reference) {\n      if(match(words[w],\"^%A$\")) { refauthors[nrefauthors++]=wtail() }\n      if(match(words[w],\"^%T$\")) {\n\treftitle=wtail()\n\tsub(\"^\\\"\",\"\",reftitle)\n\tsub(\"\\\"$\",\"\",reftitle)\n      }\n      if(match(words[w],\"^%N$\")) { refissue=wtail() }\n      if(match(words[w],\"^%D$\")) { refdate=wtail() }\n      if(match(words[w],\"^%O$\")) { refopt=wtail() }\n      if(match(words[w],\"^%R$\")) { refreport=wtail() }\n    } else if(match(words[w],\"^Nm$\")) {\n      if(synopsis) {\n\tadd(\".br\")\n\tprenl++\n      }\n      n=words[++w]\n      if(!length(name))\n\tname=n\n      if(!length(n))\n\tn=name\n      add(\"\\\\fB\" n \"\\\\fP\")\n      if(!nospace&&match(words[w+1],\"^[\\\\.,]\"))\n\tnospace=1\n    } else if(match(words[w],\"^Nd$\")) {\n      add(\"\\\\- \" wtail())\n    } else if(match(words[w],\"^Fl$\")) {\n      add(\"\\\\fB\\\\-\" words[++w] \"\\\\fP\")\n      if(!nospace&&match(words[w+1],\"^[\\\\.,]\"))\n\tnospace=1\n    } else if(match(words[w],\"^Ar$\")) {\n      add(\"\\\\fI\")\n      if(w==nwords)\n\tadd(\"file ...\\\\fP\")\n      else {\n\tadd(words[++w] \"\\\\fP\")\n\twhile(match(words[w+1],\"^\\\\|$\"))\n\t  add(OFS words[++w] \" \\\\fI\" words[++w] \"\\\\fP\")\n      }\n      if(!nospace&&match(words[w+1],\"^[\\\\.,]\"))\n\tnospace=1\n    } else if(match(words[w],\"^Cm$\")) {\n      add(\"\\\\fB\" words[++w] \"\\\\fP\")\n      while(w<nwords&&match(words[w+1],\"^[\\\\.,:;)]\"))\n\tadd(words[++w])\n    } else if(match(words[w],\"^Op$\")) {\n      option=1\n      if(!nospace)\n\tnospace=1\n      add(\"[\")\n    } else if(match(words[w],\"^Pp$\")) {\n      prenl++\n    } else if(match(words[w],\"^An$\")) {\n      prenl++\n    } else if(match(words[w],\"^Ss$\")) {\n      add(\".SS\")\n    } else if(match(words[w],\"^Pa$\")&&!option) {\n      add(\"\\\\fI\")\n      w++\n      if(match(words[w],\"^\\\\.\"))\n\tadd(\"\\\\&\")\n      add(words[w] \"\\\\fP\")\n      while(w<nwords&&match(words[w+1],\"^[\\\\.,:;)]\"))\n\tadd(words[++w])\n    } else if(match(words[w],\"^Dv$\")) {\n      add(\".BR\")\n    } else if(match(words[w],\"^Em|Ev$\")) {\n      add(\".IR\")\n    } else if(match(words[w],\"^Pq$\")) {\n      add(\"(\")\n      nospace=1\n      parens=1\n    } else if(match(words[w],\"^Aq$\")) {\n      add(\"<\")\n      nospace=1\n      angles=1\n    } else if(match(words[w],\"^S[xy]$\")) {\n      add(\".B \" wtail())\n    } else if(match(words[w],\"^Ic$\")) {\n      plain=1\n      add(\"\\\\fB\")\n      while(w<nwords) {\n\tw++\n\tif(match(words[w],\"^Op$\")) {\n\t  w++\n\t  add(\"[\")\n\t  words[nwords]=words[nwords] \"]\"\n\t}\n\tif(match(words[w],\"^Ar$\")) {\n\t  add(\"\\\\fI\" words[++w] \"\\\\fP\")\n\t} else if(match(words[w],\"^[\\\\.,]\")) {\n\t  sub(\" $\",\"\",line)\n\t  if(plain) {\n\t    add(\"\\\\fP\")\n\t    plain=0\n\t  }\n\t  add(words[w])\n\t} else {\n\t  if(!plain) {\n\t    add(\"\\\\fB\")\n\t    plain=1\n\t  }\n\t  add(words[w])\n\t}\n\tif(!nospace)\n\t  add(OFS)\n      }\n      sub(\" $\",\"\",line)\n      if(plain)\n\tadd(\"\\\\fP\")\n    } else if(match(words[w],\"^Bl$\")) {\n      oldoptlist=optlist\n      if(match(words[w+1],\"-bullet\"))\n\toptlist=1\n      else if(match(words[w+1],\"-enum\")) {\n\toptlist=2\n\tenum=0\n      } else if(match(words[w+1],\"-tag\"))\n\toptlist=3\n      else if(match(words[w+1],\"-item\"))\n\toptlist=4\n      else if(match(words[w+1],\"-bullet\"))\n\toptlist=1\n      w=nwords\n    } else if(match(words[w],\"^El$\")) {\n      optlist=oldoptlist\n      if(!optlist)\n        add(\".PP\")\n    } else if(match(words[w],\"^Bk$\")) {\n      if(match(words[w+1],\"-words\")) {\n\tw++\n\tbreakw=1\n      }\n    } else if(match(words[w],\"^Ek$\")) {\n      breakw=0\n    } else if(match(words[w],\"^It$\")&&optlist) {\n      if(optlist==1)\n\tadd(\".IP \\\\(bu\")\n      else if(optlist==2)\n\tadd(\".IP \" ++enum \".\")\n      else if(optlist==3) {\n\tadd(\".TP\")\n\tprenl++\n\tif(match(words[w+1],\"^Pa$|^Ev$\")) {\n\t  add(\".B\")\n\t  w++\n\t}\n      } else if(optlist==4)\n\tadd(\".IP\")\n    } else if(match(words[w],\"^Sm$\")) {\n      if(match(words[w+1],\"off\"))\n\tnospace=2\n      else if(match(words[w+1],\"on\"))\n\tnospace=0\n      w++\n    } else if(!skip) {\n      add(words[w])\n    }\n  }\n  if(match(line,\"^\\\\.[^a-zA-Z]\"))\n    sub(\"^\\\\.\",\"\",line)\n  if(parens)\n    add(\")\")\n  if(angles)\n    add(\">\")\n  if(option)\n    add(\"]\")\n  if(ext&&!extopt&&!match(line,\" $\"))\n    add(OFS)\n  if(!ext&&!extopt&&length(line)) {\n    print line\n    prenl=0\n    line=\"\"\n  }\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}