{
  "module_name": "PROTOCOL.agent",
  "hash_id": "7b22fcf38105c562c1795c364b3b668f3c7ef3e9d2b5683af8028805adce4945",
  "original_prompt": "Ingested from openssh-9.6p1/PROTOCOL.agent",
  "human_readable_source": "The SSH agent protocol is described in\nhttps://tools.ietf.org/html/draft-miller-ssh-agent\n\nThis file documents OpenSSH's extensions to the agent protocol.\n\n1. session-bind@openssh.com extension\n\nThis extension allows a ssh client to bind an agent connection to a\nparticular SSH session identifier as derived from the initial key\nexchange (as per RFC4253 section 7.2) and the host key used for that\nexchange. This binding is verifiable at the agent by including the\ninitial KEX signature made by the host key.\n\nThe message format is:\n\n\tbyte\t\tSSH_AGENTC_EXTENSION (0x1b)\n\tstring\t\tsession-bind@openssh.com\n\tstring\t\thostkey\n\tstring\t\tsession identifier\n\tstring\t\tsignature\n\tbool\t\tis_forwarding\n\nWhere 'hostkey' is the encoded server host public key, 'session\nidentifier' is the exchange hash derived from the initial key\nexchange, 'signature' is the server's signature of the session\nidentifier using the private hostkey, as sent in the final\nSSH2_MSG_KEXDH_REPLY/SSH2_MSG_KEXECDH_REPLY message of the initial key\nexchange. 'is_forwarding' is a flag indicating whether this connection\nshould be bound for user authentication or forwarding.\n\nWhen an agent received this message, it will verify the signature and\ncheck the consistency of its contents, including refusing to accept\na duplicate session identifier, or any attempt to bind a connection\npreviously bound for authentication. It will then record the\nbinding for the life of the connection for use later in testing per-key\ndestination constraints.\n\n2. restrict-destination-v00@openssh.com key constraint extension\n\nThe key constraint extension supports destination- and forwarding path-\nrestricted keys. It may be attached as a constraint when keys or\nsmartcard keys are added to an agent.\n\n\tbyte\t\tSSH_AGENT_CONSTRAIN_EXTENSION (0xff)\n\tstring\t\trestrict-destination-v00@openssh.com\n\tconstraint[]\tconstraints\n\nWhere a constraint consists of:\n\n\tstring\t\tfrom_username (must be empty)\n\tstring\t\tfrom_hostname\n\tkeyspec[]\tfrom_hostkeys\n\tstring\t\tto_username\n\tstring\t\tto_hostname\n\tkeyspec[]\tto_hostkeys\n\nAnd a keyspec consists of:\n\n\tstring\t\tkeyblob\n\tbool\t\tis_ca\n\nWhen receiving this message, the agent will ensure that the\n'from_username' field is empty, and that 'to_hostname' and 'to_hostkeys'\nhave been supplied (empty 'from_hostname' and 'from_hostkeys' are valid\nand signify the initial hop from the host running ssh-agent). The agent\nwill then record the constraint against the key.\n\nSubsequent operations on this key including add/remove/request\nidentities and, in particular, signature requests will check the key\nconstraints against the session-bind@openssh.com bindings recorded for\nthe agent connection over which they were received.\n\n3. SSH_AGENT_CONSTRAIN_MAXSIGN key constraint\n\nThis key constraint allows communication to an agent of the maximum\nnumber of signatures that may be made with an XMSS key. The format of\nthe constraint is:\n\n\tbyte\t\tSSH_AGENT_CONSTRAIN_MAXSIGN (0x03)\n\tuint32\t\tmax_signatures\n\nThis option is only valid for XMSS keys.\n\n3. associated-certs-v00@openssh.com key constraint extension\n\nThe key constraint extension allows certificates to be associated\nwith private keys as they are loaded from a PKCS#11 token.\n\n\tbyte\t\tSSH_AGENT_CONSTRAIN_EXTENSION (0xff)\n\tstring\t\tassociated-certs-v00@openssh.com\n\tbool\t\tcerts_only\n\tstring\t\tcertsblob\n\nWhere \"certsblob\" constists of one or more certificates encoded as public\nkey blobs:\n\n\tstring[]\tcertificates\n\nThis extension is only valid for SSH_AGENTC_ADD_SMARTCARD_KEY_CONSTRAINED\nrequests. When an agent receives this extension, it will attempt to match\neach certificate in the request with a corresponding private key loaded\nfrom the requested PKCS#11 token. When a matching key is found, the\nagent will graft the certificate contents to the token-hosted private key\nand store the result for subsequent use by regular agent operations.\n\nIf the \"certs_only\" flag is set, then this extension will cause ONLY\nthe resultant certificates to be loaded to the agent. The default\nbehaviour is to load the PKCS#11-hosted private key as well as the\nresultant certificate.\n\nA SSH_AGENTC_ADD_SMARTCARD_KEY_CONSTRAINED will return SSH_AGENT_SUCCESS\nif any key (plain private or certificate) was successfully loaded, or\nSSH_AGENT_FAILURE if no key was loaded.\n\n$OpenBSD: PROTOCOL.agent,v 1.21 2023/12/18 14:46:56 djm Exp $\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}