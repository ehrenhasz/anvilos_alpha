{
  "module_name": "auth-shadow.c",
  "hash_id": "385ad3718cdf33268e9142068023cca3172156d467efde4056a6f0aea3497675",
  "original_prompt": "Ingested from openssh-9.6p1/auth-shadow.c",
  "human_readable_source": " \n\n#include \"includes.h\"\n\n#if defined(USE_SHADOW) && defined(HAS_SHADOW_EXPIRE)\n#include <shadow.h>\n#include <stdarg.h>\n#include <string.h>\n#include <time.h>\n\n#include \"hostfile.h\"\n#include \"auth.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"log.h\"\n\n#ifdef DAY\n# undef DAY\n#endif\n#define DAY\t(24L * 60 * 60)  \n\nextern struct sshbuf *loginmsg;\n\n \n\n \nint\nauth_shadow_acctexpired(struct spwd *spw)\n{\n\ttime_t today;\n\tlong long daysleft;\n\tint r;\n\n\ttoday = time(NULL) / DAY;\n\tdaysleft = spw->sp_expire - today;\n\tdebug3(\"%s: today %lld sp_expire %lld days left %lld\", __func__,\n\t    (long long)today, (long long)spw->sp_expire, daysleft);\n\n\tif (spw->sp_expire == -1) {\n\t\tdebug3(\"account expiration disabled\");\n\t} else if (daysleft < 0) {\n\t\tlogit(\"Account %.100s has expired\", spw->sp_namp);\n\t\treturn 1;\n\t} else if (daysleft <= spw->sp_warn) {\n\t\tdebug3(\"account will expire in %lld days\", daysleft);\n\t\tif ((r = sshbuf_putf(loginmsg, \n\t\t    \"Your account will expire in %lld day%s.\\n\", daysleft,\n\t\t    daysleft == 1 ? \"\" : \"s\")) != 0)\n\t\t\tfatal(\"%s: buffer error: %s\", __func__, ssh_err(r));\n\t}\n\n\treturn 0;\n}\n\n \nint\nauth_shadow_pwexpired(Authctxt *ctxt)\n{\n\tstruct spwd *spw = NULL;\n\tconst char *user = ctxt->pw->pw_name;\n\ttime_t today;\n\tint r, daysleft, disabled = 0;\n\n\tif ((spw = getspnam((char *)user)) == NULL) {\n\t\terror(\"Could not get shadow information for %.100s\", user);\n\t\treturn 0;\n\t}\n\n\ttoday = time(NULL) / DAY;\n\tdebug3_f(\"today %lld sp_lstchg %lld sp_max %lld\", (long long)today,\n\t    (long long)spw->sp_lstchg, (long long)spw->sp_max);\n\n#if defined(__hpux) && !defined(HAVE_SECUREWARE)\n\tif (iscomsec()) {\n\t\tstruct pr_passwd *pr;\n\n\t\tpr = getprpwnam((char *)user);\n\n\t\t \n\t\tif (pr != NULL && pr->ufld.fd_min == 0 &&\n\t\t    pr->ufld.fd_lifetime == 0 && pr->ufld.fd_expire == 0 &&\n\t\t    pr->ufld.fd_pw_expire_warning == 0 &&\n\t\t    pr->ufld.fd_schange != 0)\n\t\t\tdisabled = 1;\n\t}\n#endif\n\n\t \n\tdaysleft = spw->sp_lstchg + spw->sp_max - today;\n\tif (disabled) {\n\t\tdebug3(\"password expiration disabled\");\n\t} else if (spw->sp_lstchg == 0) {\n\t\tlogit(\"User %.100s password has expired (root forced)\", user);\n\t\treturn 1;\n\t} else if (spw->sp_max == -1) {\n\t\tdebug3(\"password expiration disabled\");\n\t} else if (daysleft < 0) {\n\t\tlogit(\"User %.100s password has expired (password aged)\", user);\n\t\treturn 1;\n\t} else if (daysleft <= spw->sp_warn) {\n\t\tdebug3(\"password will expire in %d days\", daysleft);\n\t\tif ((r = sshbuf_putf(loginmsg, \n\t\t    \"Your password will expire in %d day%s.\\n\", daysleft,\n\t\t    daysleft == 1 ? \"\" : \"s\")) != 0)\n\t\t\tfatal(\"%s: buffer error: %s\", __func__, ssh_err(r));\n\t}\n\n\treturn 0;\n}\n#endif\t \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}