{
  "module_name": "connection-timeout.sh",
  "hash_id": "e576f7a02dd6ca10f7efd57befd10793bbe78683e99eafc73a27a293e248a1e5",
  "original_prompt": "Ingested from openssh-9.6p1/regress/connection-timeout.sh",
  "human_readable_source": "#\t$OpenBSD: connection-timeout.sh,v 1.2 2023/01/17 10:15:10 djm Exp $\n#\tPlaced in the Public Domain.\n\ntid=\"unused connection timeout\"\nif config_defined DISABLE_FD_PASSING ; then\n       skip \"not supported on this platform\"\nfi\n\nCTL=$OBJ/ctl-sock\ncp $OBJ/sshd_proxy $OBJ/sshd_proxy.orig\n\ncheck_ssh() {\n\ttest -S $CTL || return 1\n\tif ! ${REAL_SSH} -qF$OBJ/ssh_proxy -O check \\\n\t     -oControlPath=$CTL somehost >/dev/null 2>&1 ; then\n\t\treturn 1\n\tfi\n\treturn 0\n}\n\nstart_ssh() {\n\ttrace \"start ssh\"\n\t${SSH} -nNfF $OBJ/ssh_proxy \"$@\" -oExitOnForwardFailure=yes \\\n\t    -oControlMaster=yes -oControlPath=$CTL somehost\n\tr=$?\n\ttest $r -eq 0 || fatal \"failed to start ssh $r\"\n\tcheck_ssh || fatal \"ssh process unresponsive\"\n}\n\nstop_ssh() {\n\ttest -S $CTL || return\n\tcheck_ssh || fatal \"ssh process is unresponsive: cannot close\"\n\tif ! ${REAL_SSH} -qF$OBJ/ssh_proxy -O exit \\\n\t     -oControlPath=$CTL >/dev/null somehost >/dev/null ; then\n\t\tfatal \"ssh process did not respond to close\"\n\tfi\n\tn=0\n\twhile [ \"$n\" -lt 20 ] ; do\n\t\ttest -S $CTL || break\n\t\tsleep 1\n\t\tn=`expr $n + 1`\n\tdone\n\tif test -S $CTL ; then\n\t\tfatal \"ssh process did not exit\"\n\tfi\n}\n\ntrap \"stop_ssh\" EXIT\n\nverbose \"no timeout\"\nstart_ssh\nsleep 5\ncheck_ssh || fatal \"ssh unexpectedly missing\"\nstop_ssh\n\n(cat $OBJ/sshd_proxy.orig ; echo \"UnusedConnectionTimeout 2\") > $OBJ/sshd_proxy\n\nverbose \"timeout\"\nstart_ssh\nsleep 8\ncheck_ssh && fail \"ssh unexpectedly present\"\nstop_ssh\n\nverbose \"session inhibits timeout\"\nrm -f $OBJ/copy.1\nstart_ssh\n${REAL_SSH} -qoControlPath=$CTL -oControlMaster=no -Fnone somehost \\\n\t\"sleep 8; touch $OBJ/copy.1\" &\ncheck_ssh || fail \"ssh unexpectedly missing\"\nwait\ntest -f $OBJ/copy.1 || fail \"missing result file\"\n\nverbose \"timeout after session\"\n# Session should still be running from previous\nsleep 8\ncheck_ssh && fail \"ssh unexpectedly present\"\nstop_ssh\n\nLPORT=`expr $PORT + 1`\nRPORT=`expr $LPORT + 1`\nDPORT=`expr $RPORT + 1`\nRDPORT=`expr $DPORT + 1`\nverbose \"timeout with listeners\"\nstart_ssh -L$LPORT:127.0.0.1:$PORT -R$RPORT:127.0.0.1:$PORT -D$DPORT -R$RDPORT\nsleep 8\ncheck_ssh && fail \"ssh unexpectedly present\"\nstop_ssh\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}