{
  "module_name": "channel-timeout.sh",
  "hash_id": "1a3d47177a82698c56628a919bf56968d23c3cd86aacc9d281a5b3f36208c519",
  "original_prompt": "Ingested from openssh-9.6p1/regress/channel-timeout.sh",
  "human_readable_source": "#\t$OpenBSD: channel-timeout.sh,v 1.1 2023/01/06 08:07:39 djm Exp $\n#\tPlaced in the Public Domain.\n\ntid=\"channel timeout\"\n\n# XXX not comprehensive. Still need -R -L agent X11 forwarding + interactive\n\nrm -f $OBJ/sshd_proxy.orig \ncp $OBJ/sshd_proxy $OBJ/sshd_proxy.orig\n\nverbose \"no timeout\"\n${SSH} -F $OBJ/ssh_proxy somehost \"sleep 5 ; exit 23\"\nr=$?\nif [ $r -ne 23 ]; then\n\tfail \"ssh failed\"\nfi\n\nverbose \"command timeout\"\n(cat $OBJ/sshd_proxy.orig ; echo \"ChannelTimeout session:command=1\") \\\n\t> $OBJ/sshd_proxy\n${SSH} -F $OBJ/ssh_proxy somehost \"sleep 5 ; exit 23\"\nr=$?\nif [ $r -ne 255 ]; then\n\tfail \"ssh returned unexpected error code $r\"\nfi\n\nverbose \"command wildcard timeout\"\n(cat $OBJ/sshd_proxy.orig ; echo \"ChannelTimeout session:*=1\") \\\n\t> $OBJ/sshd_proxy\n${SSH} -F $OBJ/ssh_proxy somehost \"sleep 5 ; exit 23\"\nr=$?\nif [ $r -ne 255 ]; then\n\tfail \"ssh returned unexpected error code $r\"\nfi\n\nverbose \"command irrelevant timeout\"\n(cat $OBJ/sshd_proxy.orig ; echo \"ChannelTimeout session:shell=1\") \\\n\t> $OBJ/sshd_proxy\n${SSH} -F $OBJ/ssh_proxy somehost \"sleep 5 ; exit 23\"\nr=$?\nif [ $r -ne 23 ]; then\n\tfail \"ssh failed\"\nfi\n\n# Set up a \"slow sftp server\" that sleeps before executing the real one.\ncat > $OBJ/slow-sftp-server.sh << _EOF\n#!/bin/sh\n\nsleep 5\n$SFTPSERVER\n_EOF\nchmod a+x $OBJ/slow-sftp-server.sh\n\nverbose \"sftp no timeout\"\n(grep -vi subsystem.*sftp $OBJ/sshd_proxy.orig;\n echo \"Subsystem sftp $OBJ/slow-sftp-server.sh\" ) > $OBJ/sshd_proxy\n\nrm -f ${COPY}\n$SFTP -qS $SSH -F $OBJ/ssh_proxy somehost:$DATA $COPY\nr=$?\nif [ $r -ne 0 ]; then\n\tfail \"sftp failed\"\nfi\ncmp $DATA $COPY || fail \"corrupted copy\"\n\nverbose \"sftp timeout\"\n(grep -vi subsystem.*sftp $OBJ/sshd_proxy.orig;\n echo \"ChannelTimeout session:subsystem:sftp=1\" ;\n echo \"Subsystem sftp $OBJ/slow-sftp-server.sh\" ) > $OBJ/sshd_proxy\n\nrm -f ${COPY}\n$SFTP -qS $SSH -F $OBJ/ssh_proxy somehost:$DATA $COPY\nr=$?\nif [ $r -eq 0 ]; then\n\tfail \"sftp succeeded unexpectedly\"\nfi\ntest -f $COPY && cmp $DATA $COPY && fail \"intact copy\"\n\nverbose \"sftp irrelevant timeout\"\n(grep -vi subsystem.*sftp $OBJ/sshd_proxy.orig;\n echo \"ChannelTimeout session:subsystem:command=1\" ;\n echo \"Subsystem sftp $OBJ/slow-sftp-server.sh\" ) > $OBJ/sshd_proxy\n\nrm -f ${COPY}\n$SFTP -qS $SSH -F $OBJ/ssh_proxy somehost:$DATA $COPY\nr=$?\nif [ $r -ne 0 ]; then\n\tfail \"sftp failed\"\nfi\ncmp $DATA $COPY || fail \"corrupted copy\"\n\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}