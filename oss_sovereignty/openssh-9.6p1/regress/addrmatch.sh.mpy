{
  "module_name": "addrmatch.sh",
  "hash_id": "8eaecd0a203c51c3706953fcdf6c9ef4856e71848b3e731801cf267c6fcab242",
  "original_prompt": "Ingested from openssh-9.6p1/regress/addrmatch.sh",
  "human_readable_source": "#\t$OpenBSD: addrmatch.sh,v 1.6 2020/08/28 03:17:13 dtucker Exp $\n#\tPlaced in the Public Domain.\n\ntid=\"address match\"\n\nmv $OBJ/sshd_proxy $OBJ/sshd_proxy_bak\n\nrun_trial()\n{\n\tuser=\"$1\"; addr=\"$2\"; host=\"$3\"; laddr=\"$4\"; lport=\"$5\"\n\texpected=\"$6\"; descr=\"$7\"\n\n\tverbose \"test $descr for $user $addr $host\"\n\tresult=`${SSHD} -f $OBJ/sshd_proxy -T \\\n\t    -C user=${user},addr=${addr},host=${host},laddr=${laddr},lport=${lport} | \\\n\t    awk '/^forcecommand/ {print $2}'`\n\tif [ \"$result\" != \"$expected\" ]; then\n\t\tfail \"failed '$descr' expected $expected got $result\"\n\tfi\n}\n\ncp $OBJ/sshd_proxy_bak $OBJ/sshd_proxy\ncat >>$OBJ/sshd_proxy <<EOD\nForceCommand nomatch\nMatch Address 192.168.0.0/16,!192.168.30.0/24,10.0.0.0/8,host.example.com\n\tForceCommand match1\nMatch Address 1.1.1.1,::1,!::3,2000::/16\n\tForceCommand match2\nMatch LocalAddress 127.0.0.1,::1\n\tForceCommand match3\nMatch LocalPort 5678\n\tForceCommand match4\nEOD\n\nrun_trial user 192.168.0.1 somehost 1.2.3.4 1234 match1 \"first entry\"\nrun_trial user 192.168.30.1 somehost 1.2.3.4 1234 nomatch \"negative match\"\nrun_trial user 19.0.0.1 somehost 1.2.3.4 1234 nomatch \"no match\"\nrun_trial user 10.255.255.254 somehost 1.2.3.4 1234 match1 \"list middle\"\nrun_trial user 192.168.30.1 192.168.0.1 1.2.3.4 1234 nomatch \"faked IP in hostname\"\nrun_trial user 1.1.1.1 somehost.example.com 1.2.3.4 1234 match2 \"bare IP4 address\"\nrun_trial user 19.0.0.1 somehost 127.0.0.1 1234 match3 \"localaddress\"\nrun_trial user 19.0.0.1 somehost 1.2.3.4 5678 match4 \"localport\"\n\nif test \"$TEST_SSH_IPV6\" != \"no\"; then\nrun_trial user ::1 somehost.example.com ::2 1234 match2 \"bare IP6 address\"\nrun_trial user ::2 somehost.example.com ::2 1234 nomatch \"deny IPv6\"\nrun_trial user ::3 somehost ::2 1234 nomatch \"IP6 negated\"\nrun_trial user ::4 somehost ::2 1234 nomatch \"IP6 no match\"\nrun_trial user 2000::1 somehost ::2 1234 match2 \"IP6 network\"\nrun_trial user 2001::1 somehost ::2 1234 nomatch \"IP6 network\"\nrun_trial user ::5 somehost ::1 1234 match3 \"IP6 localaddress\"\nrun_trial user ::5 somehost ::2 5678 match4 \"IP6 localport\"\nfi\n\n#\n# Check that we catch invalid address/mask in Match Address/Localaddress\n#\nfor i in 10.0.1.0/8 10.0.0.1/24 2000:aa:bb:01::/56; do\n    for a in address localaddress; do\n\tverbose \"test invalid Match $a $i\"\n\techo \"Match $a $i\" > $OBJ/sshd_proxy\n\t${SUDO} ${SSHD} -f $OBJ/sshd_proxy -t >/dev/null 2>&1 && \\\n\t    fail \"accepted invalid match $a $i\"\n    done\ndone\n\ncp $OBJ/sshd_proxy_bak $OBJ/sshd_proxy\nrm $OBJ/sshd_proxy_bak\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}