{
  "module_name": "ssh-com.sh",
  "hash_id": "61bd6a6f9bf9c18e0fdec25cf12ba8f56aa413fbe5e0719350674188acfa4cf9",
  "original_prompt": "Ingested from openssh-9.6p1/regress/ssh-com.sh",
  "human_readable_source": "#\t$OpenBSD: ssh-com.sh,v 1.10 2017/05/08 01:52:49 djm Exp $\n#\tPlaced in the Public Domain.\n\ntid=\"connect to ssh.com server\"\n\n#TEST_COMBASE=/path/to/ssh/com/binaries\nif [ \"X${TEST_COMBASE}\" = \"X\" ]; then\n\tfatal '$TEST_COMBASE is not set'\nfi\n\nVERSIONS=\"\n\t2.0.12\n\t2.0.13\n\t2.1.0\n\t2.2.0\n\t2.3.0\n\t2.4.0\n\t3.0.0\n\t3.1.0\n\t3.2.0\n\t3.2.2\n\t3.2.3\n\t3.2.5\n\t3.2.9\n\t3.2.9.1\n\t3.3.0\"\n# 2.0.10 does not support UserConfigDirectory\n# 2.3.1 requires a config in $HOME/.ssh2\n\nSRC=`dirname ${SCRIPT}`\n\n# ssh.com\ncat << EOF > $OBJ/sshd2_config\n#*:\n\t# Port and ListenAddress are not used.\n\tQuietMode\t\t\tyes\n\tPort\t\t\t\t4343\n\tListenAddress\t\t\t127.0.0.1\n\tUserConfigDirectory\t\t${OBJ}/%U\n\tCiphers\t\t\t\tAnyCipher\n\tPubKeyAuthentication\t\tyes\n\t#AllowedAuthentications\t\tpublickey\n\tAuthorizationFile\t\tauthorization\n\tHostKeyFile\t\t\t${SRC}/dsa_ssh2.prv\n\tPublicHostKeyFile\t\t${SRC}/dsa_ssh2.pub\n\tRandomSeedFile\t\t\t${OBJ}/random_seed\n\tMaxConnections\t\t\t0\n\tPermitRootLogin\t\t\tyes\n\tVerboseMode\t\t\tno\n\tCheckMail\t\t\tno\n\tSsh1Compatibility\t\tno\nEOF\n\n# create client config\nsed \"s/HostKeyAlias.*/HostKeyAlias ssh2-localhost-with-alias/\" \\\n\t< $OBJ/ssh_config > $OBJ/ssh_config_com\n\n# we need a DSA key for\nrm -f                             ${OBJ}/dsa ${OBJ}/dsa.pub\n${SSHKEYGEN} -q -N '' -t dsa -f\t  ${OBJ}/dsa\n\n# setup userdir, try rsa first\nmkdir -p ${OBJ}/${USER}\ncp /dev/null ${OBJ}/${USER}/authorization\nfor t in rsa dsa; do\n\t${SSHKEYGEN} -e -f ${OBJ}/$t.pub\t>  ${OBJ}/${USER}/$t.com\n\techo Key $t.com\t\t\t>> ${OBJ}/${USER}/authorization\n\techo IdentityFile ${OBJ}/$t\t>> ${OBJ}/ssh_config_com\ndone\n\n# convert and append DSA hostkey\n(\n\tprintf 'ssh2-localhost-with-alias,127.0.0.1,::1 '\n\t${SSHKEYGEN} -if ${SRC}/dsa_ssh2.pub\n) >> $OBJ/known_hosts\n\n# go for it\nfor v in ${VERSIONS}; do\n\tsshd2=${TEST_COMBASE}/${v}/sshd2\n\tif [ ! -x ${sshd2} ]; then\n\t\tcontinue\n\tfi\n\ttrace \"sshd2 ${v}\"\n\tPROXY=\"proxycommand ${sshd2} -qif ${OBJ}/sshd2_config 2> /dev/null\"\n\t${SSH} -qF ${OBJ}/ssh_config_com -o \"${PROXY}\" dummy exit 0\n        if [ $? -ne 0 ]; then\n                fail \"ssh connect to sshd2 ${v} failed\"\n        fi\n\n\tciphers=\"3des-cbc\"\n\tmacs=\"hmac-md5\"\n\tcase $v in\n\t2.4.*)\n\t\tciphers=\"$ciphers cast128-cbc\"\n\t\tmacs=\"$macs hmac-sha1 hmac-sha1-96 hmac-md5-96\"\n\t\t;;\n\t3.*)\n\t\tciphers=\"$ciphers aes128-cbc cast128-cbc\"\n\t\tmacs=\"$macs hmac-sha1 hmac-sha1-96 hmac-md5-96\"\n\t\t;;\n\tesac\n\t#ciphers=\"3des-cbc\"\n\tfor m in $macs; do\n\tfor c in $ciphers; do\n\t\ttrace \"sshd2 ${v} cipher $c mac $m\"\n\t\tverbose \"test ${tid}: sshd2 ${v} cipher $c mac $m\"\n\t\t${SSH} -c $c -m $m -qF ${OBJ}/ssh_config_com -o \"${PROXY}\" dummy exit 0\n\t\tif [ $? -ne 0 ]; then\n\t\t\tfail \"ssh connect to sshd2 ${v} with $c/$m failed\"\n\t\tfi\n\tdone\n\tdone\ndone\n\nrm -rf ${OBJ}/${USER}\nfor i in sshd_config_proxy ssh_config_proxy random_seed \\\n\tsshd2_config dsa.pub dsa ssh_config_com; do\n\trm -f ${OBJ}/$i\ndone\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}