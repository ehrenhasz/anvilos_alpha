{
  "module_name": "sshfp-connect.sh",
  "hash_id": "ae4b9c2550cd5d93abb5f943a59024a5ca74279b5c8abd7c01dd917869362220",
  "original_prompt": "Ingested from openssh-9.6p1/regress/sshfp-connect.sh",
  "human_readable_source": "#\t$OpenBSD: sshfp-connect.sh,v 1.4 2021/09/01 00:50:27 dtucker Exp $\n#\tPlaced in the Public Domain.\n\n# This test requires external setup and thus is skipped unless\n# TEST_SSH_SSHFP_DOMAIN is set.  It requires:\n# 1) A DNSSEC-enabled domain, which TEST_SSH_SSHFP_DOMAIN points to.\n# 2) A DNSSEC-validating resolver such as unwind(8).\n# 3) The following SSHFP records with fingerprints from rsa_openssh.pub\n#    in that domain that are expected to succeed:\n#      sshtest: valid sha1 and sha256 fingerprints.\n#      sshtest-sha{1,256}, : valid fingerprints for that type only.\n#    and the following records that are expected to fail:\n#      sshtest-bad: invalid sha1 fingerprint and good sha256 fingerprint\n#      sshtest-sha{1,256}-bad: invalid fingerprints for that type only.\n#\n# sshtest IN SSHFP 1 1 99C79CC09F5F81069CC017CDF9552CFC94B3B929\n# sshtest IN SSHFP 1 2 E30D6B9EB7A4DE495324E4D5870B8220577993EA6AF417E8E4A4F1C5 BF01A9B6\n# sshtest-sha1 IN SSHFP 1 1 99C79CC09F5F81069CC017CDF9552CFC94B3B929\n# sshtest-sha256 IN SSHFP 1 2 E30D6B9EB7A4DE495324E4D5870B8220577993EA6AF417E8E4A4F1C5 BF01A9B6\n# sshtest-bad IN SSHFP 1 2 E30D6B9EB7A4DE495324E4D5870B8220577993EA6AF417E8E4A4F1C5 BF01A9B6\n# sshtest-bad IN SSHFP 1 1 99C79CC09F5F81069CC017CDF9552CFC94B3B928\n# sshtest-sha1-bad IN SSHFP 1 1 99D79CC09F5F81069CC017CDF9552CFC94B3B929\n# sshtest-sha256-bad IN SSHFP 1 2 E30D6B9EB7A4DE495324E4D5870B8220577993EA6AF417E8E4A4F1C5 BF01A9B5\n\ntid=\"sshfp connect\"\n\nif ! $SSH -Q key-plain | grep ssh-rsa >/dev/null; then\n\tskip \"RSA keys not supported.\"\nelif [ -z \"${TEST_SSH_SSHFP_DOMAIN}\" ]; then\n\tskip \"TEST_SSH_SSHFP_DOMAIN not set.\"\nelse\n\t# Set RSA host key to match fingerprints above.\n\tmv $OBJ/sshd_proxy $OBJ/sshd_proxy.orig\n\t$SUDO cp $SRC/rsa_openssh.prv $OBJ/host.ssh-rsa\n\t$SUDO chmod 600 $OBJ/host.ssh-rsa\n\tsed -e \"s|$OBJ/ssh-rsa|$OBJ/host.ssh-rsa|\" \\\n\t    $OBJ/sshd_proxy.orig > $OBJ/sshd_proxy\n\n\t# Zero out known hosts and key aliases to force use of SSHFP records.\n\t> $OBJ/known_hosts\n\tmv $OBJ/ssh_proxy $OBJ/ssh_proxy.orig\n\tsed -e \"/HostKeyAlias.*localhost-with-alias/d\" \\\n\t    -e \"/Hostname.*127.0.0.1/d\" \\\n\t    $OBJ/ssh_proxy.orig > $OBJ/ssh_proxy\n\n\tfor n in sshtest sshtest-sha1 sshtest-sha256; do\n\t\ttrace \"sshfp connect $n good fingerprint\"\n\t\thost=\"${n}.dtucker.net\"\n\t\topts=\"-F $OBJ/ssh_proxy -o VerifyHostKeyDNS=yes \"\n\t\topts=\"$opts -o HostKeyAlgorithms=rsa-sha2-512,rsa-sha2-256\"\n\t\thost=\"${n}.${TEST_SSH_SSHFP_DOMAIN}\"\n\t\tSSH_CONNECTION=`${SSH} $opts $host 'echo $SSH_CONNECTION'`\n\t\tif [ $? -ne 0 ]; then\n\t\t\tfail \"ssh sshfp connect failed\"\n\t\tfi\n\t\tif [ \"$SSH_CONNECTION\" != \"UNKNOWN 65535 UNKNOWN 65535\" ]; then\n\t\t\tfail \"bad SSH_CONNECTION: $SSH_CONNECTION\"\n\t\tfi\n\n\t\ttrace \"sshfp connect $n bad fingerprint\"\n\t\thost=\"${n}-bad.${TEST_SSH_SSHFP_DOMAIN}\"\n\t\tif ${SSH} $opts ${host} true; then\n\t\t\tfail \"sshfp-connect succeeded with bad SSHFP record\"\n\t\tfi\n\tdone\nfi\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}