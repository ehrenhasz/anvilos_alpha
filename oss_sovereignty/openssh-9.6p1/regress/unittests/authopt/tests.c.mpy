{
  "module_name": "tests.c",
  "hash_id": "fac1901602ba8949bf4e628be2caacd1acd583e626fa75217d786e9167c73804",
  "original_prompt": "Ingested from openssh-9.6p1/regress/unittests/authopt/tests.c",
  "human_readable_source": " \n\n \n\n#include \"includes.h\"\n\n#include <sys/types.h>\n#include <stdio.h>\n#ifdef HAVE_STDINT_H\n#include <stdint.h>\n#endif\n#include <stdlib.h>\n#include <string.h>\n\n#include \"../test_helper/test_helper.h\"\n\n#include \"sshkey.h\"\n#include \"authfile.h\"\n#include \"auth-options.h\"\n#include \"misc.h\"\n#include \"log.h\"\n\nstatic struct sshkey *\nload_key(const char *name)\n{\n\tstruct sshkey *ret;\n\tint r;\n\n\tr = sshkey_load_public(test_data_file(name), &ret, NULL);\n\tASSERT_INT_EQ(r, 0);\n\tASSERT_PTR_NE(ret, NULL);\n\treturn ret;\n}\n\nstatic struct sshauthopt *\ndefault_authkey_opts(void)\n{\n\tstruct sshauthopt *ret = sshauthopt_new();\n\n\tASSERT_PTR_NE(ret, NULL);\n\tret->permit_port_forwarding_flag = 1;\n\tret->permit_agent_forwarding_flag = 1;\n\tret->permit_x11_forwarding_flag = 1;\n\tret->permit_pty_flag = 1;\n\tret->permit_user_rc = 1;\n\treturn ret;\n}\n\nstatic struct sshauthopt *\ndefault_authkey_restrict_opts(void)\n{\n\tstruct sshauthopt *ret = sshauthopt_new();\n\n\tASSERT_PTR_NE(ret, NULL);\n\tret->permit_port_forwarding_flag = 0;\n\tret->permit_agent_forwarding_flag = 0;\n\tret->permit_x11_forwarding_flag = 0;\n\tret->permit_pty_flag = 0;\n\tret->permit_user_rc = 0;\n\tret->restricted = 1;\n\treturn ret;\n}\n\nstatic char **\ncommasplit(const char *s, size_t *np)\n{\n\tchar *ocp, *cp, *cp2, **ret = NULL;\n\tsize_t n;\n\n\tocp = cp = strdup(s);\n\tASSERT_PTR_NE(cp, NULL);\n\tfor (n = 0; (cp2 = strsep(&cp, \",\")) != NULL;) {\n\t\tret = recallocarray(ret, n, n + 1, sizeof(*ret));\n\t\tASSERT_PTR_NE(ret, NULL);\n\t\tcp2 = strdup(cp2);\n\t\tASSERT_PTR_NE(cp2, NULL);\n\t\tret[n++] = cp2;\n\t}\n\tfree(ocp);\n\t*np = n;\n\treturn ret;\n}\n\nstatic void\ncompare_opts(const struct sshauthopt *opts,\n    const struct sshauthopt *expected)\n{\n\tsize_t i;\n\n\tASSERT_PTR_NE(opts, NULL);\n\tASSERT_PTR_NE(expected, NULL);\n\tASSERT_PTR_NE(expected, opts);  \n\n#define FLAG_EQ(x) ASSERT_INT_EQ(opts->x, expected->x)\n\tFLAG_EQ(permit_port_forwarding_flag);\n\tFLAG_EQ(permit_agent_forwarding_flag);\n\tFLAG_EQ(permit_x11_forwarding_flag);\n\tFLAG_EQ(permit_pty_flag);\n\tFLAG_EQ(permit_user_rc);\n\tFLAG_EQ(restricted);\n\tFLAG_EQ(cert_authority);\n#undef FLAG_EQ\n\n#define STR_EQ(x) \\\n\tdo { \\\n\t\tif (expected->x == NULL) \\\n\t\t\tASSERT_PTR_EQ(opts->x, expected->x); \\\n\t\telse \\\n\t\t\tASSERT_STRING_EQ(opts->x, expected->x); \\\n\t} while (0)\n\tSTR_EQ(cert_principals);\n\tSTR_EQ(force_command);\n\tSTR_EQ(required_from_host_cert);\n\tSTR_EQ(required_from_host_keys);\n#undef STR_EQ\n\n#define ARRAY_EQ(nx, x) \\\n\tdo { \\\n\t\tASSERT_SIZE_T_EQ(opts->nx, expected->nx); \\\n\t\tif (expected->nx == 0) \\\n\t\t\tbreak; \\\n\t\tfor (i = 0; i < expected->nx; i++) \\\n\t\t\tASSERT_STRING_EQ(opts->x[i], expected->x[i]); \\\n\t} while (0)\n\tARRAY_EQ(nenv, env);\n\tARRAY_EQ(npermitopen, permitopen);\n#undef ARRAY_EQ\n}\n\nstatic void\ntest_authkeys_parse(void)\n{\n\tstruct sshauthopt *opts, *expected;\n\tconst char *errstr;\n\n#define FAIL_TEST(label, keywords) \\\n\tdo { \\\n\t\tTEST_START(\"sshauthopt_parse invalid \" label); \\\n\t\topts = sshauthopt_parse(keywords, &errstr); \\\n\t\tASSERT_PTR_EQ(opts, NULL); \\\n\t\tASSERT_PTR_NE(errstr, NULL); \\\n\t\tTEST_DONE(); \\\n\t} while (0) \n#define CHECK_SUCCESS_AND_CLEANUP() \\\n\tdo { \\\n\t\tif (errstr != NULL) \\\n\t\t\tASSERT_STRING_EQ(errstr, \"\"); \\\n\t\tcompare_opts(opts, expected); \\\n\t\tsshauthopt_free(expected); \\\n\t\tsshauthopt_free(opts); \\\n\t} while (0)\n\n\t \n\tTEST_START(\"sshauthopt_parse empty\");\n\texpected = default_authkey_opts();\n\topts = sshauthopt_parse(\"\", &errstr);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tTEST_START(\"sshauthopt_parse trailing whitespace\");\n\texpected = default_authkey_opts();\n\topts = sshauthopt_parse(\" \", &errstr);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tTEST_START(\"sshauthopt_parse restrict\");\n\texpected = default_authkey_restrict_opts();\n\topts = sshauthopt_parse(\"restrict\", &errstr);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\t \n\tFAIL_TEST(\"trailing comma\", \"restrict,\");\n\tFAIL_TEST(\"bare comma\", \",\");\n\tFAIL_TEST(\"unknown option\", \"BLAH\");\n\tFAIL_TEST(\"unknown option with trailing comma\", \"BLAH,\");\n\tFAIL_TEST(\"unknown option with trailing whitespace\", \"BLAH \");\n\n\t \n\tTEST_START(\"sshauthopt_parse tunnel explicit\");\n\texpected = default_authkey_opts();\n\texpected->force_tun_device = 1;\n\topts = sshauthopt_parse(\"tunnel=\\\"1\\\"\", &errstr);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tTEST_START(\"sshauthopt_parse tunnel any\");\n\texpected = default_authkey_opts();\n\texpected->force_tun_device = SSH_TUNID_ANY;\n\topts = sshauthopt_parse(\"tunnel=\\\"any\\\"\", &errstr);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tFAIL_TEST(\"tunnel\", \"tunnel=\\\"blah\\\"\");\n\n\t \n#define FLAG_TEST(keyword, var, val) \\\n\tdo { \\\n\t\tTEST_START(\"sshauthopt_parse \" keyword); \\\n\t\texpected = default_authkey_opts(); \\\n\t\texpected->var = val; \\\n\t\topts = sshauthopt_parse(keyword, &errstr); \\\n\t\tCHECK_SUCCESS_AND_CLEANUP(); \\\n\t\texpected = default_authkey_restrict_opts(); \\\n\t\texpected->var = val; \\\n\t\topts = sshauthopt_parse(\"restrict,\"keyword, &errstr); \\\n\t\tCHECK_SUCCESS_AND_CLEANUP(); \\\n\t\tTEST_DONE(); \\\n\t} while (0)\n\t \n\tFLAG_TEST(\"cert-authority\", cert_authority, 1);\n\tFLAG_TEST(\"port-forwarding\", permit_port_forwarding_flag, 1);\n\tFLAG_TEST(\"agent-forwarding\", permit_agent_forwarding_flag, 1);\n\tFLAG_TEST(\"x11-forwarding\", permit_x11_forwarding_flag, 1);\n\tFLAG_TEST(\"pty\", permit_pty_flag, 1);\n\tFLAG_TEST(\"user-rc\", permit_user_rc, 1);\n\t \n\tFLAG_TEST(\"no-port-forwarding\", permit_port_forwarding_flag, 0);\n\tFLAG_TEST(\"no-agent-forwarding\", permit_agent_forwarding_flag, 0);\n\tFLAG_TEST(\"no-x11-forwarding\", permit_x11_forwarding_flag, 0);\n\tFLAG_TEST(\"no-pty\", permit_pty_flag, 0);\n\tFLAG_TEST(\"no-user-rc\", permit_user_rc, 0);\n#undef FLAG_TEST\n\tFAIL_TEST(\"no-cert-authority\", \"no-cert-authority\");\n\n\t \n#define STRING_TEST(keyword, var, val) \\\n\tdo { \\\n\t\tTEST_START(\"sshauthopt_parse \" keyword); \\\n\t\texpected = default_authkey_opts(); \\\n\t\texpected->var = strdup(val); \\\n\t\tASSERT_PTR_NE(expected->var, NULL); \\\n\t\topts = sshauthopt_parse(keyword \"=\" #val, &errstr); \\\n\t\tCHECK_SUCCESS_AND_CLEANUP(); \\\n\t\texpected = default_authkey_restrict_opts(); \\\n\t\texpected->var = strdup(val); \\\n\t\tASSERT_PTR_NE(expected->var, NULL); \\\n\t\topts = sshauthopt_parse( \\\n\t\t    \"restrict,\" keyword \"=\" #val \",restrict\", &errstr); \\\n\t\tCHECK_SUCCESS_AND_CLEANUP(); \\\n\t\tTEST_DONE(); \\\n\t} while (0)\n\tSTRING_TEST(\"command\", force_command, \"/bin/true\");\n\tSTRING_TEST(\"principals\", cert_principals, \"gregor,josef,K\");\n\tSTRING_TEST(\"from\", required_from_host_keys, \"127.0.0.0/8\");\n#undef STRING_TEST\n\tFAIL_TEST(\"unquoted command\", \"command=oops\");\n\tFAIL_TEST(\"unquoted principals\", \"principals=estragon\");\n\tFAIL_TEST(\"unquoted from\", \"from=127.0.0.1\");\n\n\t \n#define ARRAY_TEST(label, keywords, var, nvar, val) \\\n\tdo { \\\n\t\tTEST_START(\"sshauthopt_parse \" label); \\\n\t\texpected = default_authkey_opts(); \\\n\t\texpected->var = commasplit(val, &expected->nvar); \\\n\t\tASSERT_PTR_NE(expected->var, NULL); \\\n\t\topts = sshauthopt_parse(keywords, &errstr); \\\n\t\tCHECK_SUCCESS_AND_CLEANUP(); \\\n\t\texpected = default_authkey_restrict_opts(); \\\n\t\texpected->var = commasplit(val, &expected->nvar); \\\n\t\tASSERT_PTR_NE(expected->var, NULL); \\\n\t\topts = sshauthopt_parse( \\\n\t\t    \"restrict,\" keywords \",restrict\", &errstr); \\\n\t\tCHECK_SUCCESS_AND_CLEANUP(); \\\n\t\tTEST_DONE(); \\\n\t} while (0)\n\tARRAY_TEST(\"environment\", \"environment=\\\"foo=1\\\",environment=\\\"bar=2\\\"\",\n\t    env, nenv, \"foo=1,bar=2\");\n\tARRAY_TEST(\"environment\", \"environment=\\\"foo=1\\\",environment=\\\"foo=2\\\"\",\n\t    env, nenv, \"foo=1\");\n\tARRAY_TEST(\"permitopen\", \"permitopen=\\\"foo:123\\\",permitopen=\\\"bar:*\\\"\",\n\t    permitopen, npermitopen, \"foo:123,bar:*\");\n#undef ARRAY_TEST\n\tFAIL_TEST(\"environment\", \"environment=\\\",=bah\\\"\");\n\tFAIL_TEST(\"permitopen port\", \"foo:bar\");\n\tFAIL_TEST(\"permitopen missing port\", \"foo:\");\n\tFAIL_TEST(\"permitopen missing port specification\", \"foo\");\n\tFAIL_TEST(\"permitopen invalid host\", \"[:\");\n\n#undef CHECK_SUCCESS_AND_CLEANUP\n#undef FAIL_TEST\n}\n\nstatic void\ntest_cert_parse(void)\n{\n\tstruct sshkey *cert;\n\tstruct sshauthopt *opts, *expected;\n\n#define CHECK_SUCCESS_AND_CLEANUP() \\\n\tdo { \\\n\t\tcompare_opts(opts, expected); \\\n\t\tsshauthopt_free(expected); \\\n\t\tsshauthopt_free(opts); \\\n\t\tsshkey_free(cert); \\\n\t} while (0)\n#define FLAG_TEST(keybase, var) \\\n\tdo { \\\n\t\tTEST_START(\"sshauthopt_from_cert no_\" keybase); \\\n\t\tcert = load_key(\"no_\" keybase \".cert\"); \\\n\t\texpected = default_authkey_opts(); \\\n\t\texpected->var = 0; \\\n\t\topts = sshauthopt_from_cert(cert); \\\n\t\tCHECK_SUCCESS_AND_CLEANUP(); \\\n\t\tTEST_DONE(); \\\n\t\tTEST_START(\"sshauthopt_from_cert only_\" keybase); \\\n\t\tcert = load_key(\"only_\" keybase \".cert\"); \\\n\t\texpected = sshauthopt_new(); \\\n\t\tASSERT_PTR_NE(expected, NULL); \\\n\t\texpected->var = 1; \\\n\t\topts = sshauthopt_from_cert(cert); \\\n\t\tCHECK_SUCCESS_AND_CLEANUP(); \\\n\t\tTEST_DONE(); \\\n\t} while (0)\n\tFLAG_TEST(\"agentfwd\", permit_agent_forwarding_flag);\n\tFLAG_TEST(\"portfwd\", permit_port_forwarding_flag);\n\tFLAG_TEST(\"pty\", permit_pty_flag);\n\tFLAG_TEST(\"user_rc\", permit_user_rc);\n\tFLAG_TEST(\"x11fwd\", permit_x11_forwarding_flag);\n#undef FLAG_TEST\n\n\tTEST_START(\"sshauthopt_from_cert all permitted\");\n\tcert = load_key(\"all_permit.cert\");\n\texpected = default_authkey_opts();\n\topts = sshauthopt_from_cert(cert);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tTEST_START(\"sshauthopt_from_cert nothing permitted\");\n\tcert = load_key(\"no_permit.cert\");\n\texpected = sshauthopt_new();\n\tASSERT_PTR_NE(expected, NULL);\n\topts = sshauthopt_from_cert(cert);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tTEST_START(\"sshauthopt_from_cert force-command\");\n\tcert = load_key(\"force_command.cert\");\n\texpected = default_authkey_opts();\n\texpected->force_command = strdup(\"foo\");\n\tASSERT_PTR_NE(expected->force_command, NULL);\n\topts = sshauthopt_from_cert(cert);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tTEST_START(\"sshauthopt_from_cert source-address\");\n\tcert = load_key(\"sourceaddr.cert\");\n\texpected = default_authkey_opts();\n\texpected->required_from_host_cert = strdup(\"127.0.0.1/32,::1/128\");\n\tASSERT_PTR_NE(expected->required_from_host_cert, NULL);\n\topts = sshauthopt_from_cert(cert);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n#undef CHECK_SUCCESS_AND_CLEANUP\n\n#define FAIL_TEST(keybase) \\\n\tdo { \\\n\t\tTEST_START(\"sshauthopt_from_cert \" keybase); \\\n\t\tcert = load_key(keybase \".cert\"); \\\n\t\topts = sshauthopt_from_cert(cert); \\\n\t\tASSERT_PTR_EQ(opts, NULL); \\\n\t\tsshkey_free(cert); \\\n\t\tTEST_DONE(); \\\n\t} while (0)\n\tFAIL_TEST(\"host\");\n\tFAIL_TEST(\"bad_sourceaddr\");\n\tFAIL_TEST(\"unknown_critical\");\n#undef FAIL_TEST\n}\n\nstatic void\ntest_merge(void)\n{\n\tstruct sshkey *cert;\n\tstruct sshauthopt *key_opts, *cert_opts, *merge_opts, *expected;\n\tconst char *errstr;\n\n\t \n#define PREPARE(label, keyname, keywords) \\\n\tdo { \\\n\t\texpected = NULL; \\\n\t\tTEST_START(\"sshauthopt_merge \" label); \\\n\t\tcert = load_key(keyname \".cert\"); \\\n\t\tcert_opts = sshauthopt_from_cert(cert); \\\n\t\tASSERT_PTR_NE(cert_opts, NULL); \\\n\t\tkey_opts = sshauthopt_parse(keywords, &errstr); \\\n\t\tif (errstr != NULL) \\\n\t\t\tASSERT_STRING_EQ(errstr, \"\"); \\\n\t\tASSERT_PTR_NE(key_opts, NULL); \\\n\t\tmerge_opts = sshauthopt_merge(key_opts, \\\n\t\t    cert_opts, &errstr); \\\n\t} while (0)\n\n\t \n#define CLEANUP() \\\n\tdo { \\\n\t\tsshauthopt_free(expected); \\\n\t\tsshauthopt_free(merge_opts); \\\n\t\tsshauthopt_free(key_opts); \\\n\t\tsshauthopt_free(cert_opts); \\\n\t\tsshkey_free(cert); \\\n\t} while (0)\n\n\t \n#define CHECK_SUCCESS_AND_CLEANUP() \\\n\tdo { \\\n\t\tif (errstr != NULL) \\\n\t\t\tASSERT_STRING_EQ(errstr, \"\"); \\\n\t\tcompare_opts(merge_opts, expected); \\\n\t\tCLEANUP(); \\\n\t} while (0)\n\n\t \n#define FLAG_CASE(keybase, label, keyname, keywords, mostly_off, var, val) \\\n\tdo { \\\n\t\tPREPARE(keybase \" \" label, keyname, keywords); \\\n\t\texpected = mostly_off ? \\\n\t\t    sshauthopt_new() : default_authkey_opts(); \\\n\t\texpected->var = val; \\\n\t\tASSERT_PTR_NE(expected, NULL); \\\n\t\tCHECK_SUCCESS_AND_CLEANUP(); \\\n\t\tTEST_DONE(); \\\n\t} while (0)\n\n\t \n#define FLAG_TEST(keybase, keyword, var) \\\n\tdo { \\\n\t\tFLAG_CASE(keybase, \"keys:default,yes cert:default,no\", \\\n\t\t    \"no_\" keybase, keyword, 0, var, 0); \\\n\t\tFLAG_CASE(keybase,\"keys:-*,yes cert:default,no\", \\\n\t\t    \"no_\" keybase, \"restrict,\" keyword, 1, var, 0); \\\n\t\tFLAG_CASE(keybase, \"keys:default,no cert:default,no\", \\\n\t\t    \"no_\" keybase, \"no-\" keyword, 0, var, 0); \\\n\t\tFLAG_CASE(keybase, \"keys:-*,no cert:default,no\", \\\n\t\t    \"no_\" keybase, \"restrict,no-\" keyword, 1, var, 0); \\\n\t\t\\\n\t\tFLAG_CASE(keybase, \"keys:default,yes cert:-*,yes\", \\\n\t\t    \"only_\" keybase, keyword, 1, var, 1); \\\n\t\tFLAG_CASE(keybase,\"keys:-*,yes cert:-*,yes\", \\\n\t\t    \"only_\" keybase, \"restrict,\" keyword, 1, var, 1); \\\n\t\tFLAG_CASE(keybase, \"keys:default,no cert:-*,yes\", \\\n\t\t    \"only_\" keybase, \"no-\" keyword, 1, var, 0); \\\n\t\tFLAG_CASE(keybase, \"keys:-*,no cert:-*,yes\", \\\n\t\t    \"only_\" keybase, \"restrict,no-\" keyword, 1, var, 0); \\\n\t\t\\\n\t\tFLAG_CASE(keybase, \"keys:default,yes cert:-*\", \\\n\t\t    \"no_permit\", keyword, 1, var, 0); \\\n\t\tFLAG_CASE(keybase,\"keys:-*,yes cert:-*\", \\\n\t\t    \"no_permit\", \"restrict,\" keyword, 1, var, 0); \\\n\t\tFLAG_CASE(keybase, \"keys:default,no cert:-*\", \\\n\t\t    \"no_permit\", \"no-\" keyword, 1, var, 0); \\\n\t\tFLAG_CASE(keybase, \"keys:-*,no cert:-*\", \\\n\t\t    \"no_permit\", \"restrict,no-\" keyword, 1, var, 0); \\\n\t\t\\\n\t\tFLAG_CASE(keybase, \"keys:default,yes cert:*\", \\\n\t\t    \"all_permit\", keyword, 0, var, 1); \\\n\t\tFLAG_CASE(keybase,\"keys:-*,yes cert:*\", \\\n\t\t    \"all_permit\", \"restrict,\" keyword, 1, var, 1); \\\n\t\tFLAG_CASE(keybase, \"keys:default,no cert:*\", \\\n\t\t    \"all_permit\", \"no-\" keyword, 0, var, 0); \\\n\t\tFLAG_CASE(keybase, \"keys:-*,no cert:*\", \\\n\t\t    \"all_permit\", \"restrict,no-\" keyword, 1, var, 0); \\\n\t\t\\\n\t} while (0)\n\tFLAG_TEST(\"portfwd\", \"port-forwarding\", permit_port_forwarding_flag);\n\tFLAG_TEST(\"agentfwd\", \"agent-forwarding\", permit_agent_forwarding_flag);\n\tFLAG_TEST(\"pty\", \"pty\", permit_pty_flag);\n\tFLAG_TEST(\"user_rc\", \"user-rc\", permit_user_rc);\n\tFLAG_TEST(\"x11fwd\", \"x11-forwarding\", permit_x11_forwarding_flag);\n#undef FLAG_TEST\n\n\tPREPARE(\"source-address both\", \"sourceaddr\", \"from=\\\"127.0.0.1\\\"\");\n\texpected = default_authkey_opts();\n\texpected->required_from_host_cert = strdup(\"127.0.0.1/32,::1/128\");\n\tASSERT_PTR_NE(expected->required_from_host_cert, NULL);\n\texpected->required_from_host_keys = strdup(\"127.0.0.1\");\n\tASSERT_PTR_NE(expected->required_from_host_keys, NULL);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tPREPARE(\"source-address none\", \"all_permit\", \"\");\n\texpected = default_authkey_opts();\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tPREPARE(\"source-address keys\", \"all_permit\", \"from=\\\"127.0.0.1\\\"\");\n\texpected = default_authkey_opts();\n\texpected->required_from_host_keys = strdup(\"127.0.0.1\");\n\tASSERT_PTR_NE(expected->required_from_host_keys, NULL);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tPREPARE(\"source-address cert\", \"sourceaddr\", \"\");\n\texpected = default_authkey_opts();\n\texpected->required_from_host_cert = strdup(\"127.0.0.1/32,::1/128\");\n\tASSERT_PTR_NE(expected->required_from_host_cert, NULL);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tPREPARE(\"force-command both\", \"force_command\", \"command=\\\"foo\\\"\");\n\texpected = default_authkey_opts();\n\texpected->force_command = strdup(\"foo\");\n\tASSERT_PTR_NE(expected->force_command, NULL);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tPREPARE(\"force-command none\", \"all_permit\", \"\");\n\texpected = default_authkey_opts();\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tPREPARE(\"force-command keys\", \"all_permit\", \"command=\\\"bar\\\"\");\n\texpected = default_authkey_opts();\n\texpected->force_command = strdup(\"bar\");\n\tASSERT_PTR_NE(expected->force_command, NULL);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tPREPARE(\"force-command cert\", \"force_command\", \"\");\n\texpected = default_authkey_opts();\n\texpected->force_command = strdup(\"foo\");\n\tASSERT_PTR_NE(expected->force_command, NULL);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tPREPARE(\"force-command mismatch\", \"force_command\", \"command=\\\"bar\\\"\");\n\tASSERT_PTR_EQ(merge_opts, NULL);\n\tCLEANUP();\n\tTEST_DONE();\n\n\tPREPARE(\"tunnel\", \"all_permit\", \"tunnel=\\\"6\\\"\");\n\texpected = default_authkey_opts();\n\texpected->force_tun_device = 6;\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tPREPARE(\"permitopen\", \"all_permit\",\n\t    \"permitopen=\\\"127.0.0.1:*\\\",permitopen=\\\"127.0.0.1:123\\\"\");\n\texpected = default_authkey_opts();\n\texpected->permitopen = commasplit(\"127.0.0.1:*,127.0.0.1:123\",\n\t    &expected->npermitopen);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tPREPARE(\"environment\", \"all_permit\",\n\t    \"environment=\\\"foo=a\\\",environment=\\\"bar=b\\\"\");\n\texpected = default_authkey_opts();\n\texpected->env = commasplit(\"foo=a,bar=b\", &expected->nenv);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n}\n\nvoid\ntests(void)\n{\n\textern char *__progname;\n\tLogLevel ll = test_is_verbose() ?\n\t    SYSLOG_LEVEL_DEBUG3 : SYSLOG_LEVEL_QUIET;\n\n\t \n\tlog_init(__progname, ll, SYSLOG_FACILITY_USER, 1);\n\n\ttest_authkeys_parse();\n\ttest_cert_parse();\n\ttest_merge();\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}