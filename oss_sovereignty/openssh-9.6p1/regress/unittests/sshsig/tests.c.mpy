{
  "module_name": "tests.c",
  "hash_id": "2320db65e03424dc4b0f23147554e22561441df5f1925b09296e4751104a348e",
  "original_prompt": "Ingested from openssh-9.6p1/regress/unittests/sshsig/tests.c",
  "human_readable_source": " \n \n\n#include \"includes.h\"\n\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <stdio.h>\n#ifdef HAVE_STDINT_H\n#include <stdint.h>\n#endif\n#include <stdlib.h>\n#include <string.h>\n#include <unistd.h>\n\n#ifdef WITH_OPENSSL\n#include <openssl/evp.h>\n#include <openssl/crypto.h>\n#endif\n\n#include \"ssherr.h\"\n#include \"authfile.h\"\n#include \"sshkey.h\"\n#include \"sshbuf.h\"\n#include \"sshsig.h\"\n#include \"log.h\"\n\n#include \"../test_helper/test_helper.h\"\n\nstatic struct sshbuf *\nload_file(const char *name)\n{\n\tstruct sshbuf *ret = NULL;\n\n\tASSERT_INT_EQ(sshbuf_load_file(test_data_file(name), &ret), 0);\n\tASSERT_PTR_NE(ret, NULL);\n\treturn ret;\n}\n\nstatic struct sshkey *\nload_key(const char *name)\n{\n\tstruct sshkey *ret = NULL;\n\tASSERT_INT_EQ(sshkey_load_public(test_data_file(name), &ret, NULL), 0);\n\tASSERT_PTR_NE(ret, NULL);\n\treturn ret;\n}\n\nstatic void\ncheck_sig(const char *keyname, const char *signame, const struct sshbuf *msg,\n    const char *namespace)\n{\n\tstruct sshkey *k, *sign_key;\n\tstruct sshbuf *sig, *rawsig;\n\tstruct sshkey_sig_details *sig_details;\n\n\tk = load_key(keyname);\n\tsig = load_file(signame);\n\tsign_key = NULL;\n\tsig_details = NULL;\n\trawsig = NULL;\n\tASSERT_INT_EQ(sshsig_dearmor(sig, &rawsig), 0);\n\tASSERT_INT_EQ(sshsig_verifyb(rawsig, msg, namespace,\n\t    &sign_key, &sig_details), 0);\n\tASSERT_INT_EQ(sshkey_equal(k, sign_key), 1);\n\tsshkey_free(k);\n\tsshkey_free(sign_key);\n\tsshkey_sig_details_free(sig_details);\n\tsshbuf_free(sig);\n\tsshbuf_free(rawsig);\n}\n\nvoid\ntests(void)\n{\n\tstruct sshbuf *msg;\n\tchar *namespace;\n\n#if 0\n        log_init(\"test_sshsig\", SYSLOG_LEVEL_DEBUG3, SYSLOG_FACILITY_AUTH, 1);\n#endif\n\n#ifdef WITH_OPENSSL\n\tOpenSSL_add_all_algorithms();\n\tERR_load_crypto_strings();\n#endif\n\n\tTEST_START(\"load data\");\n\tmsg = load_file(\"namespace\");\n\tnamespace = sshbuf_dup_string(msg);\n\tASSERT_PTR_NE(namespace, NULL);\n\tsshbuf_free(msg);\n\tmsg = load_file(\"signed-data\");\n\tTEST_DONE();\n\n#ifdef WITH_OPENSSL\n\tTEST_START(\"check RSA signature\");\n\tcheck_sig(\"rsa.pub\", \"rsa.sig\", msg, namespace);\n\tTEST_DONE();\n\n\tTEST_START(\"check DSA signature\");\n\tcheck_sig(\"dsa.pub\", \"dsa.sig\", msg, namespace);\n\tTEST_DONE();\n\n#ifdef OPENSSL_HAS_ECC\n\tTEST_START(\"check ECDSA signature\");\n\tcheck_sig(\"ecdsa.pub\", \"ecdsa.sig\", msg, namespace);\n\tTEST_DONE();\n#endif\n#endif\n\n\tTEST_START(\"check ED25519 signature\");\n\tcheck_sig(\"ed25519.pub\", \"ed25519.sig\", msg, namespace);\n\tTEST_DONE();\n\n#ifdef ENABLE_SK\n#if defined(WITH_OPENSSL) && defined(OPENSSL_HAS_ECC)\n\tTEST_START(\"check ECDSA-SK signature\");\n\tcheck_sig(\"ecdsa_sk.pub\", \"ecdsa_sk.sig\", msg, namespace);\n\tTEST_DONE();\n#endif\n\n\tTEST_START(\"check ED25519-SK signature\");\n\tcheck_sig(\"ed25519_sk.pub\", \"ed25519_sk.sig\", msg, namespace);\n\tTEST_DONE();\n\n#if defined(WITH_OPENSSL) && defined(OPENSSL_HAS_ECC)\n\tTEST_START(\"check ECDSA-SK webauthn signature\");\n\tcheck_sig(\"ecdsa_sk_webauthn.pub\", \"ecdsa_sk_webauthn.sig\",\n\t    msg, namespace);\n \tTEST_DONE();\n#endif\n#endif  \n\n\tsshbuf_free(msg);\n\tfree(namespace);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}