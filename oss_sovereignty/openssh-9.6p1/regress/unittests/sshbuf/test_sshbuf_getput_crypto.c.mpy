{
  "module_name": "test_sshbuf_getput_crypto.c",
  "hash_id": "c7f98ddb0d9433314d07db6659c9fb00f6d80b370cfc63a0bb4ff181a0493cc9",
  "original_prompt": "Ingested from openssh-9.6p1/regress/unittests/sshbuf/test_sshbuf_getput_crypto.c",
  "human_readable_source": " \n \n\n#include \"includes.h\"\n\n#ifdef WITH_OPENSSL\n\n#include <sys/types.h>\n#include <stdio.h>\n#ifdef HAVE_STDINT_H\n# include <stdint.h>\n#endif\n#include <stdlib.h>\n#include <string.h>\n\n#include <openssl/bn.h>\n#include <openssl/objects.h>\n#ifdef OPENSSL_HAS_NISTP256\n# include <openssl/ec.h>\n#endif\n\n#include \"../test_helper/test_helper.h\"\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n\nvoid sshbuf_getput_crypto_tests(void);\n\nvoid\nsshbuf_getput_crypto_tests(void)\n{\n\tstruct sshbuf *p1;\n\tBIGNUM *bn, *bn2;\n\tconst char *hexbn1 = \"0102030405060708090a0b0c0d0e0f10\";\n\t \n\tconst char *hexbn2 = \"f0e0d0c0b0a0908070605040302010007fff11\";\n\tu_char expbn1[] = {\n\t\t0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08,\n\t\t0x09, 0x0a, 0x0b, 0x0c, 0x0d, 0x0e, 0x0f, 0x10,\n\t};\n\tu_char expbn2[] = {\n\t\t0xf0, 0xe0, 0xd0, 0xc0, 0xb0, 0xa0, 0x90, 0x80,\n\t\t0x70, 0x60, 0x50, 0x40, 0x30, 0x20, 0x10, 0x00,\n\t\t0x7f, 0xff, 0x11\n\t};\n#if defined(OPENSSL_HAS_ECC) && defined(OPENSSL_HAS_NISTP256)\n\tconst u_char *d;\n\tsize_t s;\n\tBIGNUM *bn_x, *bn_y;\n\tint ec256_nid = NID_X9_62_prime256v1;\n\tchar *ec256_x = \"0C828004839D0106AA59575216191357\"\n\t\t        \"34B451459DADB586677EF9DF55784999\";\n\tchar *ec256_y = \"4D196B50F0B4E94B3C73E3A9D4CD9DF2\"\n\t                \"C8F9A35E42BDD047550F69D80EC23CD4\";\n\tu_char expec256[] = {\n\t\t0x04,\n\t\t0x0c, 0x82, 0x80, 0x04, 0x83, 0x9d, 0x01, 0x06,\n\t\t0xaa, 0x59, 0x57, 0x52, 0x16, 0x19, 0x13, 0x57,\n\t\t0x34, 0xb4, 0x51, 0x45, 0x9d, 0xad, 0xb5, 0x86,\n\t\t0x67, 0x7e, 0xf9, 0xdf, 0x55, 0x78, 0x49, 0x99,\n\t\t0x4d, 0x19, 0x6b, 0x50, 0xf0, 0xb4, 0xe9, 0x4b,\n\t\t0x3c, 0x73, 0xe3, 0xa9, 0xd4, 0xcd, 0x9d, 0xf2,\n\t\t0xc8, 0xf9, 0xa3, 0x5e, 0x42, 0xbd, 0xd0, 0x47,\n\t\t0x55, 0x0f, 0x69, 0xd8, 0x0e, 0xc2, 0x3c, 0xd4\n\t};\n\tEC_KEY *eck;\n\tEC_POINT *ecp;\n#endif\n\tint r;\n\n#define MKBN(b, bnn) \\\n\tdo { \\\n\t\tbnn = NULL; \\\n\t\tASSERT_INT_GT(BN_hex2bn(&bnn, b), 0); \\\n\t} while (0)\n\n\tTEST_START(\"sshbuf_put_bignum2\");\n\tMKBN(hexbn1, bn);\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_bignum2(p1, bn), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sizeof(expbn1) + 4);\n\tASSERT_U32_EQ(PEEK_U32(sshbuf_ptr(p1)), (u_int32_t)BN_num_bytes(bn));\n\tASSERT_MEM_EQ(sshbuf_ptr(p1) + 4, expbn1, sizeof(expbn1));\n\tBN_free(bn);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_put_bignum2 limited\");\n\tMKBN(hexbn1, bn);\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_set_max_size(p1, sizeof(expbn1) + 3), 0);\n\tr = sshbuf_put_bignum2(p1, bn);\n\tASSERT_INT_EQ(r, SSH_ERR_NO_BUFFER_SPACE);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 0);\n\tBN_free(bn);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_put_bignum2 bn2\");\n\tMKBN(hexbn2, bn);\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_bignum2(p1, bn), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sizeof(expbn2) + 4 + 1);  \n\tASSERT_U32_EQ(PEEK_U32(sshbuf_ptr(p1)), (u_int32_t)BN_num_bytes(bn) + 1);\n\tASSERT_U8_EQ(*(sshbuf_ptr(p1) + 4), 0x00);\n\tASSERT_MEM_EQ(sshbuf_ptr(p1) + 5, expbn2, sizeof(expbn2));\n\tBN_free(bn);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_put_bignum2 bn2 limited\");\n\tMKBN(hexbn2, bn);\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_set_max_size(p1, sizeof(expbn2) + 3), 0);\n\tr = sshbuf_put_bignum2(p1, bn);\n\tASSERT_INT_EQ(r, SSH_ERR_NO_BUFFER_SPACE);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 0);\n\tBN_free(bn);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_get_bignum2\");\n\tMKBN(hexbn1, bn);\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_u32(p1, BN_num_bytes(bn)), 0);\n\tASSERT_INT_EQ(sshbuf_put(p1, expbn1, sizeof(expbn1)), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 4 + sizeof(expbn1));\n\tASSERT_INT_EQ(sshbuf_put_u16(p1, 0xd00f), 0);\n\tbn2 = NULL;\n\tASSERT_INT_EQ(sshbuf_get_bignum2(p1, &bn2), 0);\n\tASSERT_BIGNUM_EQ(bn, bn2);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 2);\n\tBN_free(bn);\n\tBN_free(bn2);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_get_bignum2 truncated\");\n\tMKBN(hexbn1, bn);\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_u32(p1, BN_num_bytes(bn)), 0);\n\tASSERT_INT_EQ(sshbuf_put(p1, expbn1, sizeof(expbn1) - 1), 0);\n\tbn2 = NULL;\n\tr = sshbuf_get_bignum2(p1, &bn2);\n\tASSERT_INT_EQ(r, SSH_ERR_MESSAGE_INCOMPLETE);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sizeof(expbn1) + 3);\n\tBN_free(bn);\n\tBN_free(bn2);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_get_bignum2 giant\");\n\tMKBN(hexbn1, bn);\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_u32(p1, 65536), 0);\n\tASSERT_INT_EQ(sshbuf_reserve(p1, 65536, NULL), 0);\n\tbn2 = NULL;\n\tr = sshbuf_get_bignum2(p1, &bn2);\n\tASSERT_INT_EQ(r, SSH_ERR_BIGNUM_TOO_LARGE);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 65536 + 4);\n\tBN_free(bn);\n\tBN_free(bn2);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_get_bignum2 bn2\");\n\tMKBN(hexbn2, bn);\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_u32(p1, BN_num_bytes(bn) + 1), 0);  \n\tASSERT_INT_EQ(sshbuf_put_u8(p1, 0x00), 0);\n\tASSERT_INT_EQ(sshbuf_put(p1, expbn2, sizeof(expbn2)), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 4 + 1 + sizeof(expbn2));\n\tASSERT_INT_EQ(sshbuf_put_u16(p1, 0xd00f), 0);\n\tbn2 = NULL;\n\tASSERT_INT_EQ(sshbuf_get_bignum2(p1, &bn2), 0);\n\tASSERT_BIGNUM_EQ(bn, bn2);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 2);\n\tBN_free(bn);\n\tBN_free(bn2);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_get_bignum2 bn2 truncated\");\n\tMKBN(hexbn2, bn);\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_u32(p1, BN_num_bytes(bn) + 1), 0);\n\tASSERT_INT_EQ(sshbuf_put_u8(p1, 0x00), 0);\n\tASSERT_INT_EQ(sshbuf_put(p1, expbn2, sizeof(expbn2) - 1), 0);\n\tbn2 = NULL;\n\tr = sshbuf_get_bignum2(p1, &bn2);\n\tASSERT_INT_EQ(r, SSH_ERR_MESSAGE_INCOMPLETE);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sizeof(expbn2) + 1 + 4 - 1);\n\tBN_free(bn);\n\tBN_free(bn2);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_get_bignum2 bn2 negative\");\n\tMKBN(hexbn2, bn);\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_u32(p1, BN_num_bytes(bn)), 0);\n\tASSERT_INT_EQ(sshbuf_put(p1, expbn2, sizeof(expbn2)), 0);\n\tbn2 = NULL;\n\tr = sshbuf_get_bignum2(p1, &bn2);\n\tASSERT_INT_EQ(r, SSH_ERR_BIGNUM_IS_NEGATIVE);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sizeof(expbn2) + 4);\n\tBN_free(bn);\n\tBN_free(bn2);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n#if defined(OPENSSL_HAS_ECC) && defined(OPENSSL_HAS_NISTP256)\n\tTEST_START(\"sshbuf_put_ec\");\n\teck = EC_KEY_new_by_curve_name(ec256_nid);\n\tASSERT_PTR_NE(eck, NULL);\n\tecp = EC_POINT_new(EC_KEY_get0_group(eck));\n\tASSERT_PTR_NE(ecp, NULL);\n\tMKBN(ec256_x, bn_x);\n\tMKBN(ec256_y, bn_y);\n\tASSERT_INT_EQ(EC_POINT_set_affine_coordinates_GFp(\n\t    EC_KEY_get0_group(eck), ecp, bn_x, bn_y, NULL), 1);\n\tASSERT_INT_EQ(EC_KEY_set_public_key(eck, ecp), 1);\n\tBN_free(bn_x);\n\tBN_free(bn_y);\n\tEC_POINT_free(ecp);\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_eckey(p1, eck), 0);\n\tASSERT_INT_EQ(sshbuf_get_string_direct(p1, &d, &s), 0);\n\tASSERT_SIZE_T_EQ(s, sizeof(expec256));\n\tASSERT_MEM_EQ(d, expec256, sizeof(expec256));\n\tsshbuf_free(p1);\n\tEC_KEY_free(eck);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_get_ec\");\n\teck = EC_KEY_new_by_curve_name(ec256_nid);\n\tASSERT_PTR_NE(eck, NULL);\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_string(p1, expec256, sizeof(expec256)), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sizeof(expec256) + 4);\n\tASSERT_INT_EQ(sshbuf_put_u8(p1, 0x00), 0);\n\tASSERT_INT_EQ(sshbuf_get_eckey(p1, eck), 0);\n\tbn_x = BN_new();\n\tbn_y = BN_new();\n\tASSERT_PTR_NE(bn_x, NULL);\n\tASSERT_PTR_NE(bn_y, NULL);\n\tASSERT_INT_EQ(EC_POINT_get_affine_coordinates_GFp(\n\t    EC_KEY_get0_group(eck), EC_KEY_get0_public_key(eck),\n\t    bn_x, bn_y, NULL), 1);\n\tMKBN(ec256_x, bn);\n\tMKBN(ec256_y, bn2);\n\tASSERT_INT_EQ(BN_cmp(bn_x, bn), 0);\n\tASSERT_INT_EQ(BN_cmp(bn_y, bn2), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 1);\n\tsshbuf_free(p1);\n\tEC_KEY_free(eck);\n\tBN_free(bn_x);\n\tBN_free(bn_y);\n\tBN_free(bn);\n\tBN_free(bn2);\n\tTEST_DONE();\n#endif\n}\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}