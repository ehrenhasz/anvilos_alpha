{
  "module_name": "test_sshbuf_misc.c",
  "hash_id": "375e6c73a994c827ab115fbd42c5aa1fb9256494b49766ccb1c469506505d038",
  "original_prompt": "Ingested from openssh-9.6p1/regress/unittests/sshbuf/test_sshbuf_misc.c",
  "human_readable_source": " \n \n\n#include \"includes.h\"\n\n#include <sys/types.h>\n#include <stdio.h>\n#ifdef HAVE_STDINT_H\n# include <stdint.h>\n#endif\n#include <stdlib.h>\n#include <string.h>\n\n#include \"../test_helper/test_helper.h\"\n\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n\nvoid sshbuf_misc_tests(void);\n\nvoid\nsshbuf_misc_tests(void)\n{\n\tstruct sshbuf *p1;\n\tchar tmp[512], msg[] = \"imploring ping silence ping over\", *p;\n\tFILE *out;\n\tsize_t sz;\n\n\tTEST_START(\"sshbuf_dump\");\n\tout = tmpfile();\n\tASSERT_PTR_NE(out, NULL);\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_u32(p1, 0x12345678), 0);\n\tsshbuf_dump(p1, out);\n\tfflush(out);\n\trewind(out);\n\tsz = fread(tmp, 1, sizeof(tmp), out);\n\tASSERT_INT_EQ(ferror(out), 0);\n\tASSERT_INT_NE(feof(out), 0);\n\tASSERT_SIZE_T_GT(sz, 0);\n\ttmp[sz] = '\\0';\n\tASSERT_PTR_NE(strstr(tmp, \"12 34 56 78\"), NULL);\n\tfclose(out);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_dtob16\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_u32(p1, 0x12345678), 0);\n\tp = sshbuf_dtob16(p1);\n\tASSERT_PTR_NE(p, NULL);\n\tASSERT_STRING_EQ(p, \"12345678\");\n\tfree(p);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_dtob64_string len 1\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_u8(p1, 0x11), 0);\n\tp = sshbuf_dtob64_string(p1, 0);\n\tASSERT_PTR_NE(p, NULL);\n\tASSERT_STRING_EQ(p, \"EQ==\");\n\tfree(p);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_dtob64_string len 2\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_u8(p1, 0x11), 0);\n\tASSERT_INT_EQ(sshbuf_put_u8(p1, 0x22), 0);\n\tp = sshbuf_dtob64_string(p1, 0);\n\tASSERT_PTR_NE(p, NULL);\n\tASSERT_STRING_EQ(p, \"ESI=\");\n\tfree(p);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_dtob64_string len 3\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_u8(p1, 0x11), 0);\n\tASSERT_INT_EQ(sshbuf_put_u8(p1, 0x22), 0);\n\tASSERT_INT_EQ(sshbuf_put_u8(p1, 0x33), 0);\n\tp = sshbuf_dtob64_string(p1, 0);\n\tASSERT_PTR_NE(p, NULL);\n\tASSERT_STRING_EQ(p, \"ESIz\");\n\tfree(p);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_dtob64_string len 8191\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_reserve(p1, 8192, NULL), 0);\n\tbzero(sshbuf_mutable_ptr(p1), 8192);\n\tp = sshbuf_dtob64_string(p1, 0);\n\tASSERT_PTR_NE(p, NULL);\n\tASSERT_SIZE_T_EQ(strlen(p), ((8191 + 2) / 3) * 4);\n\tfree(p);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_b64tod len 1\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_b64tod(p1, \"0A==\"), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 1);\n\tASSERT_U8_EQ(*sshbuf_ptr(p1), 0xd0);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_b64tod len 2\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_b64tod(p1, \"0A8=\"), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 2);\n\tASSERT_U16_EQ(PEEK_U16(sshbuf_ptr(p1)), 0xd00f);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_b64tod len 4\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_b64tod(p1, \"0A/QDw==\"), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 4);\n\tASSERT_U32_EQ(PEEK_U32(sshbuf_ptr(p1)), 0xd00fd00f);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_dup_string\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\t \n\tp = sshbuf_dup_string(p1);\n\tASSERT_PTR_NE(p, NULL);\n\tASSERT_SIZE_T_EQ(strlen(p), 0);\n\tfree(p);\n\t \n\tASSERT_INT_EQ(sshbuf_put(p1, \"quad1\", strlen(\"quad1\")), 0);\n\tp = sshbuf_dup_string(p1);\n\tASSERT_PTR_NE(p, NULL);\n\tASSERT_SIZE_T_EQ(strlen(p), strlen(\"quad1\"));\n\tASSERT_STRING_EQ(p, \"quad1\");\n\tfree(p);\n\t \n\tASSERT_INT_EQ(sshbuf_put(p1, \"\\0\", 1), 0);\n\tp = sshbuf_dup_string(p1);\n\tASSERT_PTR_NE(p, NULL);\n\tASSERT_SIZE_T_EQ(strlen(p), strlen(\"quad1\"));\n\tASSERT_STRING_EQ(p, \"quad1\");\n\tfree(p);\n\t \n\tASSERT_INT_EQ(sshbuf_put(p1, \"quad2\", strlen(\"quad2\")), 0);\n\tp = sshbuf_dup_string(p1);\n\tASSERT_PTR_EQ(p, NULL);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_cmp\");\n\tp1 = sshbuf_from(msg, sizeof(msg) - 1);\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_cmp(p1, 0, \"i\", 1), 0);\n\tASSERT_INT_EQ(sshbuf_cmp(p1, 0, \"j\", 1), SSH_ERR_INVALID_FORMAT);\n\tASSERT_INT_EQ(sshbuf_cmp(p1, 0, \"imploring\", 9), 0);\n\tASSERT_INT_EQ(sshbuf_cmp(p1, 0, \"implored\", 9), SSH_ERR_INVALID_FORMAT);\n\tASSERT_INT_EQ(sshbuf_cmp(p1, 10, \"ping\", 4), 0);\n\tASSERT_INT_EQ(sshbuf_cmp(p1, 10, \"ring\", 4), SSH_ERR_INVALID_FORMAT);\n\tASSERT_INT_EQ(sshbuf_cmp(p1, 28, \"over\", 4), 0);\n\tASSERT_INT_EQ(sshbuf_cmp(p1, 28, \"rove\", 4), SSH_ERR_INVALID_FORMAT);\n\tASSERT_INT_EQ(sshbuf_cmp(p1, 28, \"overt\", 5),\n\t    SSH_ERR_MESSAGE_INCOMPLETE);\n\tASSERT_INT_EQ(sshbuf_cmp(p1, 32, \"ping\", 4),\n\t    SSH_ERR_MESSAGE_INCOMPLETE);\n\tASSERT_INT_EQ(sshbuf_cmp(p1, 1000, \"silence\", 7),\n\t    SSH_ERR_MESSAGE_INCOMPLETE);\n\tASSERT_INT_EQ(sshbuf_cmp(p1, 0, msg, sizeof(msg) - 1), 0);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_find\");\n\tp1 = sshbuf_from(msg, sizeof(msg) - 1);\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_find(p1, 0, \"i\", 1, &sz), 0);\n\tASSERT_SIZE_T_EQ(sz, 0);\n\tASSERT_INT_EQ(sshbuf_find(p1, 0, \"j\", 1, &sz), SSH_ERR_INVALID_FORMAT);\n\tASSERT_INT_EQ(sshbuf_find(p1, 0, \"imploring\", 9, &sz), 0);\n\tASSERT_SIZE_T_EQ(sz, 0);\n\tASSERT_INT_EQ(sshbuf_find(p1, 0, \"implored\", 9, &sz),\n\t    SSH_ERR_INVALID_FORMAT);\n\tASSERT_INT_EQ(sshbuf_find(p1, 3, \"ping\", 4, &sz), 0);\n\tASSERT_SIZE_T_EQ(sz, 10);\n\tASSERT_INT_EQ(sshbuf_find(p1, 11, \"ping\", 4, &sz), 0);\n\tASSERT_SIZE_T_EQ(sz, 23);\n\tASSERT_INT_EQ(sshbuf_find(p1, 20, \"over\", 4, &sz), 0);\n\tASSERT_SIZE_T_EQ(sz, 28);\n\tASSERT_INT_EQ(sshbuf_find(p1, 28, \"over\", 4, &sz), 0);\n\tASSERT_SIZE_T_EQ(sz, 28);\n\tASSERT_INT_EQ(sshbuf_find(p1, 28, \"rove\", 4, &sz),\n\t    SSH_ERR_INVALID_FORMAT);\n\tASSERT_INT_EQ(sshbuf_find(p1, 28, \"overt\", 5, &sz),\n\t    SSH_ERR_MESSAGE_INCOMPLETE);\n\tASSERT_INT_EQ(sshbuf_find(p1, 32, \"ping\", 4, &sz),\n\t    SSH_ERR_MESSAGE_INCOMPLETE);\n\tASSERT_INT_EQ(sshbuf_find(p1, 1000, \"silence\", 7, &sz),\n\t    SSH_ERR_MESSAGE_INCOMPLETE);\n\tASSERT_INT_EQ(sshbuf_find(p1, 0, msg + 1, sizeof(msg) - 2, &sz), 0);\n\tASSERT_SIZE_T_EQ(sz, 1);\n\tTEST_DONE();\n}\n\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}