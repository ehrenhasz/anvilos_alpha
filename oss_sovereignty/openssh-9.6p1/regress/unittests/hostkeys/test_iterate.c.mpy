{
  "module_name": "test_iterate.c",
  "hash_id": "250efbdaca6d8246771ac65149face8cd80bb396764e1daa1a08f4f62e01d14b",
  "original_prompt": "Ingested from openssh-9.6p1/regress/unittests/hostkeys/test_iterate.c",
  "human_readable_source": " \n \n\n#include \"includes.h\"\n\n#include <sys/types.h>\n#include <stdio.h>\n#ifdef HAVE_STDINT_H\n#include <stdint.h>\n#endif\n#include <stdlib.h>\n#include <string.h>\n\n#include \"../test_helper/test_helper.h\"\n\n#include \"sshkey.h\"\n#include \"authfile.h\"\n#include \"hostfile.h\"\n\nstruct expected {\n\tconst char *key_file;\t\t \n\tint no_parse_status;\t\t \n\tint no_parse_keytype;\t\t \n\tint match_host_p;\t\t \n\tint match_host_s;\t\t \n\tint match_ipv4;\t\t\t \n\tint match_ipv6;\t\t\t \n\tint match_flags;\t\t \n\tstruct hostkey_foreach_line l;\t \n};\n\nstruct cbctx {\n\tconst struct expected *expected;\n\tsize_t nexpected;\n\tsize_t i;\n\tint flags;\n\tint match_host_p;\n\tint match_host_s;\n\tint match_ipv4;\n\tint match_ipv6;\n};\n\n \nstatic int\ncheck(struct hostkey_foreach_line *l, void *_ctx)\n{\n\tstruct cbctx *ctx = (struct cbctx *)_ctx;\n\tconst struct expected *expected;\n\tint parse_key = (ctx->flags & HKF_WANT_PARSE_KEY) != 0;\n\tconst int matching = (ctx->flags & HKF_WANT_MATCH) != 0;\n\tu_int expected_status, expected_match;\n\tint expected_keytype, skip = 0;\n\n\ttest_subtest_info(\"entry %zu/%zu, file line %ld\",\n\t    ctx->i + 1, ctx->nexpected, l->linenum);\n\n\tfor (;;) {\n\t\tASSERT_SIZE_T_LT(ctx->i, ctx->nexpected);\n\t\texpected = ctx->expected + ctx->i++;\n\t\t \n\t\tif (!matching)\n\t\t\tbreak;\n\t\tif (ctx->match_host_p && expected->match_host_p)\n\t\t\tbreak;\n\t\tif (ctx->match_host_s && expected->match_host_s)\n\t\t\tbreak;\n\t\tif (ctx->match_ipv4 && expected->match_ipv4)\n\t\t\tbreak;\n\t\tif (ctx->match_ipv6 && expected->match_ipv6)\n\t\t\tbreak;\n\t}\n\texpected_status = (parse_key || expected->no_parse_status < 0) ?\n\t    expected->l.status : (u_int)expected->no_parse_status;\n\texpected_match = expected->l.match;\n#define UPDATE_MATCH_STATUS(x) do { \\\n\t\tif (ctx->x && expected->x) { \\\n\t\t\texpected_match |= expected->x; \\\n\t\t\tif (expected_status == HKF_STATUS_OK) \\\n\t\t\t\texpected_status = HKF_STATUS_MATCHED; \\\n\t\t} \\\n\t} while (0)\n\texpected_keytype = (parse_key || expected->no_parse_keytype < 0) ?\n\t    expected->l.keytype : expected->no_parse_keytype;\n\n#ifndef OPENSSL_HAS_ECC\n\tif (expected->l.keytype == KEY_ECDSA ||\n\t    expected->no_parse_keytype == KEY_ECDSA)\n\t\tskip = 1;\n#endif  \n#ifndef WITH_OPENSSL\n\tif (expected->l.keytype == KEY_DSA ||\n\t    expected->no_parse_keytype == KEY_DSA ||\n\t    expected->l.keytype == KEY_RSA ||\n\t    expected->no_parse_keytype == KEY_RSA ||\n\t    expected->l.keytype == KEY_ECDSA ||\n\t    expected->no_parse_keytype == KEY_ECDSA)\n\t\tskip = 1;\n#endif  \n\tif (skip) {\n\t\texpected_status = HKF_STATUS_INVALID;\n\t\texpected_keytype = KEY_UNSPEC;\n\t\tparse_key = 0;\n\t}\n\tUPDATE_MATCH_STATUS(match_host_p);\n\tUPDATE_MATCH_STATUS(match_host_s);\n\tUPDATE_MATCH_STATUS(match_ipv4);\n\tUPDATE_MATCH_STATUS(match_ipv6);\n\n\tASSERT_PTR_NE(l->path, NULL);  \n\tASSERT_LONG_LONG_EQ(l->linenum, expected->l.linenum);\n\tASSERT_U_INT_EQ(l->status, expected_status);\n\tASSERT_U_INT_EQ(l->match, expected_match);\n\t \n\tif (expected->l.line != NULL)\n\t\tASSERT_STRING_EQ(l->line, expected->l.line);\n\tASSERT_INT_EQ(l->marker, expected->l.marker);\n\t \n\tif (expected->l.hosts != NULL)\n\t\tASSERT_STRING_EQ(l->hosts, expected->l.hosts);\n\t \n\tif (expected->l.rawkey != NULL)\n\t\tASSERT_STRING_EQ(l->rawkey, expected->l.rawkey);\n\t \n\tASSERT_INT_EQ(l->keytype, expected_keytype);\n\tif (parse_key) {\n\t\tif (expected->l.key == NULL)\n\t\t\tASSERT_PTR_EQ(l->key, NULL);\n\t\tif (expected->l.key != NULL) {\n\t\t\tASSERT_PTR_NE(l->key, NULL);\n\t\t\tASSERT_INT_EQ(sshkey_equal(l->key, expected->l.key), 1);\n\t\t}\n\t}\n\tif (parse_key && !(l->comment == NULL && expected->l.comment == NULL))\n\t\tASSERT_STRING_EQ(l->comment, expected->l.comment);\n\treturn 0;\n}\n\n \nstatic void\nprepare_expected(struct expected *expected, size_t n)\n{\n\tsize_t i;\n\n\tfor (i = 0; i < n; i++) {\n\t\tif (expected[i].key_file == NULL)\n\t\t\tcontinue;\n#ifndef OPENSSL_HAS_ECC\n\t\tif (expected[i].l.keytype == KEY_ECDSA)\n\t\t\tcontinue;\n#endif  \n#ifndef WITH_OPENSSL\n\t\tswitch (expected[i].l.keytype) {\n\t\tcase KEY_RSA:\n\t\tcase KEY_DSA:\n\t\tcase KEY_ECDSA:\n\t\t\tcontinue;\n\t\t}\n#endif  \n\t\tASSERT_INT_EQ(sshkey_load_public(\n\t\t    test_data_file(expected[i].key_file), &expected[i].l.key,\n\t\t    NULL), 0);\n\t}\n}\n\nstatic void\ncleanup_expected(struct expected *expected, size_t n)\n{\n\tsize_t i;\n\n\tfor (i = 0; i < n; i++) {\n\t\tsshkey_free(expected[i].l.key);\n\t\texpected[i].l.key = NULL;\n\t}\n}\n\nstruct expected expected_full[] = {\n\t{ NULL, -1, -1, 0, 0, 0, 0, -1, {\n\t\tNULL,\t\t\t\t \n\t\t1,\t\t\t\t \n\t\tHKF_STATUS_COMMENT,\t\t \n\t\t0,\t\t\t\t \n\t\t\"# Plain host keys, plain host names\",  \n\t\tMRK_NONE,\t\t\t \n\t\tNULL,\t\t\t\t \n\t\tNULL,\t\t\t\t \n\t\tKEY_UNSPEC,\t\t\t \n\t\tNULL,\t\t\t\t \n\t\tNULL,\t\t\t\t \n\t\t0,\t\t\t\t \n\t} },\n\t{ \"dsa_1.pub\" , -1, -1, 0, HKF_MATCH_HOST, 0, 0, -1, {\n\t\tNULL,\n\t\t2,\n\t\tHKF_STATUS_OK,\n\t\t0,\n\t\tNULL,\n\t\tMRK_NONE,\n\t\t\"sisyphus.example.com\",\n\t\tNULL,\n\t\tKEY_DSA,\n\t\tNULL,\t \n\t\t\"DSA #1\",\n\t\t0,\n\t} },\n\t{ \"ecdsa_1.pub\" , -1, -1, 0, HKF_MATCH_HOST, 0, 0, -1, {\n\t\tNULL,\n\t\t3,\n\t\tHKF_STATUS_OK,\n\t\t0,\n\t\tNULL,\n\t\tMRK_NONE,\n\t\t\"sisyphus.example.com\",\n\t\tNULL,\n\t\tKEY_ECDSA,\n\t\tNULL,\t \n\t\t\"ECDSA #1\",\n\t\t0,\n\t} },\n\t{ \"ed25519_1.pub\" , -1, -1, 0, HKF_MATCH_HOST, 0, 0, -1, {\n\t\tNULL,\n\t\t4,\n\t\tHKF_STATUS_OK,\n\t\t0,\n\t\tNULL,\n\t\tMRK_NONE,\n\t\t\"sisyphus.example.com\",\n\t\tNULL,\n\t\tKEY_ED25519,\n\t\tNULL,\t \n\t\t\"ED25519 #1\",\n\t\t0,\n\t} },\n\t{ \"rsa_1.pub\" , -1, -1, 0, HKF_MATCH_HOST, 0, 0, -1, {\n\t\tNULL,\n\t\t5,\n\t\tHKF_STATUS_OK,\n\t\t0,\n\t\tNULL,\n\t\tMRK_NONE,\n\t\t\"sisyphus.example.com\",\n\t\tNULL,\n\t\tKEY_RSA,\n\t\tNULL,\t \n\t\t\"RSA #1\",\n\t\t0,\n\t} },\n\t{ NULL, -1, -1, 0, 0, 0, 0, -1, {\n\t\tNULL,\n\t\t6,\n\t\tHKF_STATUS_COMMENT,\n\t\t0,\n\t\t\"\",\n\t\tMRK_NONE,\n\t\tNULL,\n\t\tNULL,\n\t\tKEY_UNSPEC,\n\t\tNULL,\n\t\tNULL,\n\t\t0,\n\t} },\n\t{ NULL, -1, -1, 0, 0, 0, 0, -1, {\n\t\tNULL,\n\t\t7,\n\t\tHKF_STATUS_COMMENT,\n\t\t0,\n\t\t\"# Plain host keys, hostnames + addresses\",\n\t\tMRK_NONE,\n\t\tNULL,\n\t\tNULL,\n\t\tKEY_UNSPEC,\n\t\tNULL,\n\t\tNULL,\n\t\t0,\n\t} },\n\t{ \"dsa_2.pub\" , -1, -1, HKF_MATCH_HOST, 0, HKF_MATCH_IP, HKF_MATCH_IP, -1, {\n\t\tNULL,\n\t\t8,\n\t\tHKF_STATUS_OK,\n\t\t0,\n\t\tNULL,\n\t\tMRK_NONE,\n\t\t\"prometheus.example.com,192.0.2.1,2001:db8::1\",\n\t\tNULL,\n\t\tKEY_DSA,\n\t\tNULL,\t \n\t\t\"DSA #2\",\n\t\t0,\n\t} },\n\t{ \"ecdsa_2.pub\" , -1, -1, HKF_MATCH_HOST, 0, HKF_MATCH_IP, HKF_MATCH_IP, -1, {\n\t\tNULL,\n\t\t9,\n\t\tHKF_STATUS_OK,\n\t\t0,\n\t\tNULL,\n\t\tMRK_NONE,\n\t\t\"prometheus.example.com,192.0.2.1,2001:db8::1\",\n\t\tNULL,\n\t\tKEY_ECDSA,\n\t\tNULL,\t \n\t\t\"ECDSA #2\",\n\t\t0,\n\t} },\n\t{ \"ed25519_2.pub\" , -1, -1, HKF_MATCH_HOST, 0, HKF_MATCH_IP, HKF_MATCH_IP, -1, {\n\t\tNULL,\n\t\t10,\n\t\tHKF_STATUS_OK,\n\t\t0,\n\t\tNULL,\n\t\tMRK_NONE,\n\t\t\"prometheus.example.com,192.0.2.1,2001:db8::1\",\n\t\tNULL,\n\t\tKEY_ED25519,\n\t\tNULL,\t \n\t\t\"ED25519 #2\",\n\t\t0,\n\t} },\n\t{ \"rsa_2.pub\" , -1, -1, HKF_MATCH_HOST, 0, HKF_MATCH_IP, HKF_MATCH_IP, -1, {\n\t\tNULL,\n\t\t11,\n\t\tHKF_STATUS_OK,\n\t\t0,\n\t\tNULL,\n\t\tMRK_NONE,\n\t\t\"prometheus.example.com,192.0.2.1,2001:db8::1\",\n\t\tNULL,\n\t\tKEY_RSA,\n\t\tNULL,\t \n\t\t\"RSA #2\",\n\t\t0,\n\t} },\n\t{ NULL, -1, -1, 0, 0, 0, 0, -1, {\n\t\tNULL,\n\t\t12,\n\t\tHKF_STATUS_COMMENT,\n\t\t0,\n\t\t\"\",\n\t\tMRK_NONE,\n\t\tNULL,\n\t\tNULL,\n\t\tKEY_UNSPEC,\n\t\tNULL,\n\t\tNULL,\n\t\t0,\n\t} },\n\t{ NULL, -1, -1, 0, 0, 0, 0, -1, {\n\t\tNULL,\n\t\t13,\n\t\tHKF_STATUS_COMMENT,\n\t\t0,\n\t\t\"# Some hosts with wildcard names / IPs\",\n\t\tMRK_NONE,\n\t\tNULL,\n\t\tNULL,\n\t\tKEY_UNSPEC,\n\t\tNULL,\n\t\tNULL,\n\t\t0,\n\t} },\n\t{ \"dsa_3.pub\" , -1, -1, HKF_MATCH_HOST, HKF_MATCH_HOST, HKF_MATCH_IP, HKF_MATCH_IP, -1, {\n\t\tNULL,\n\t\t14,\n\t\tHKF_STATUS_OK,\n\t\t0,\n\t\tNULL,\n\t\tMRK_NONE,\n\t\t\"*.example.com,192.0.2.*,2001:*\",\n\t\tNULL,\n\t\tKEY_DSA,\n\t\tNULL,\t \n\t\t\"DSA #3\",\n\t\t0,\n\t} },\n\t{ \"ecdsa_3.pub\" , -1, -1, HKF_MATCH_HOST, HKF_MATCH_HOST, HKF_MATCH_IP, HKF_MATCH_IP, -1, {\n\t\tNULL,\n\t\t15,\n\t\tHKF_STATUS_OK,\n\t\t0,\n\t\tNULL,\n\t\tMRK_NONE,\n\t\t\"*.example.com,192.0.2.*,2001:*\",\n\t\tNULL,\n\t\tKEY_ECDSA,\n\t\tNULL,\t \n\t\t\"ECDSA #3\",\n\t\t0,\n\t} },\n\t{ \"ed25519_3.pub\" , -1, -1, HKF_MATCH_HOST, HKF_MATCH_HOST, HKF_MATCH_IP, HKF_MATCH_IP, -1, {\n\t\tNULL,\n\t\t16,\n\t\tHKF_STATUS_OK,\n\t\t0,\n\t\tNULL,\n\t\tMRK_NONE,\n\t\t\"*.example.com,192.0.2.*,2001:*\",\n\t\tNULL,\n\t\tKEY_ED25519,\n\t\tNULL,\t \n\t\t\"ED25519 #3\",\n\t\t0,\n\t} },\n\t{ \"rsa_3.pub\" , -1, -1, HKF_MATCH_HOST, HKF_MATCH_HOST, HKF_MATCH_IP, HKF_MATCH_IP, -1, {\n\t\tNULL,\n\t\t17,\n\t\tHKF_STATUS_OK,\n\t\t0,\n\t\tNULL,\n\t\tMRK_NONE,\n\t\t\"*.example.com,192.0.2.*,2001:*\",\n\t\tNULL,\n\t\tKEY_RSA,\n\t\tNULL,\t \n\t\t\"RSA #3\",\n\t\t0,\n\t} },\n\t{ NULL, -1, -1, 0, 0, 0, 0, -1, {\n\t\tNULL,\n\t\t18,\n\t\tHKF_STATUS_COMMENT,\n\t\t0,\n\t\t\"\",\n\t\tMRK_NONE,\n\t\tNULL,\n\t\tNULL,\n\t\tKEY_UNSPEC,\n\t\tNULL,\n\t\tNULL,\n\t\t0,\n\t} },\n\t{ NULL, -1, -1, 0, 0, 0, 0, -1, {\n\t\tNULL,\n\t\t19,\n\t\tHKF_STATUS_COMMENT,\n\t\t0,\n\t\t\"# Hashed hostname and address entries\",\n\t\tMRK_NONE,\n\t\tNULL,\n\t\tNULL,\n\t\tKEY_UNSPEC,\n\t\tNULL,\n\t\tNULL,\n\t\t0,\n\t} },\n\t{ \"dsa_5.pub\" , -1, -1, 0, HKF_MATCH_HOST|HKF_MATCH_HOST_HASHED, 0, 0, -1, {\n\t\tNULL,\n\t\t20,\n\t\tHKF_STATUS_OK,\n\t\t0,\n\t\tNULL,\n\t\tMRK_NONE,\n\t\tNULL,\n\t\tNULL,\n\t\tKEY_DSA,\n\t\tNULL,\t \n\t\t\"DSA #5\",\n\t\t0,\n\t} },\n\t{ \"ecdsa_5.pub\" , -1, -1, 0, HKF_MATCH_HOST|HKF_MATCH_HOST_HASHED, 0, 0, -1, {\n\t\tNULL,\n\t\t21,\n\t\tHKF_STATUS_OK,\n\t\t0,\n\t\tNULL,\n\t\tMRK_NONE,\n\t\tNULL,\n\t\tNULL,\n\t\tKEY_ECDSA,\n\t\tNULL,\t \n\t\t\"ECDSA #5\",\n\t\t0,\n\t} },\n\t{ \"ed25519_5.pub\" , -1, -1, 0, HKF_MATCH_HOST|HKF_MATCH_HOST_HASHED, 0, 0, -1, {\n\t\tNULL,\n\t\t22,\n\t\tHKF_STATUS_OK,\n\t\t0,\n\t\tNULL,\n\t\tMRK_NONE,\n\t\tNULL,\n\t\tNULL,\n\t\tKEY_ED25519,\n\t\tNULL,\t \n\t\t\"ED25519 #5\",\n\t\t0,\n\t} },\n\t{ \"rsa_5.pub\" , -1, -1, 0, HKF_MATCH_HOST|HKF_MATCH_HOST_HASHED, 0, 0, -1, {\n\t\tNULL,\n\t\t23,\n\t\tHKF_STATUS_OK,\n\t\t0,\n\t\tNULL,\n\t\tMRK_NONE,\n\t\tNULL,\n\t\tNULL,\n\t\tKEY_RSA,\n\t\tNULL,\t \n\t\t\"RSA #5\",\n\t\t0,\n\t} },\n\t{ NULL, -1, -1, 0, 0, 0, 0, -1, {\n\t\tNULL,\n\t\t24,\n\t\tHKF_STATUS_COMMENT,\n\t\t0,\n\t\t\"\",\n\t\tMRK_NONE,\n\t\tNULL,\n\t\tNULL,\n\t\tKEY_UNSPEC,\n\t\tNULL,\n\t\tNULL,\n\t\t0,\n\t} },\n\t \n\t{ \"dsa_6.pub\" , -1, -1, HKF_MATCH_HOST|HKF_MATCH_HOST_HASHED, 0, 0, 0, -1, {\n\t\tNULL,\n\t\t25,\n\t\tHKF_STATUS_OK,\n\t\t0,\n\t\tNULL,\n\t\tMRK_NONE,\n\t\tNULL,\n\t\tNULL,\n\t\tKEY_DSA,\n\t\tNULL,\t \n\t\t\"DSA #6\",\n\t\t0,\n\t} },\n\t{ \"dsa_6.pub\" , -1, -1, 0, 0, HKF_MATCH_IP|HKF_MATCH_IP_HASHED, 0, -1, {\n\t\tNULL,\n\t\t26,\n\t\tHKF_STATUS_OK,\n\t\t0,\n\t\tNULL,\n\t\tMRK_NONE,\n\t\tNULL,\n\t\tNULL,\n\t\tKEY_DSA,\n\t\tNULL,\t \n\t\t\"DSA #6\",\n\t\t0,\n\t} },\n\t{ \"dsa_6.pub\" , -1, -1, 0, 0, 0, HKF_MATCH_IP|HKF_MATCH_IP_HASHED, -1, {\n\t\tNULL,\n\t\t27,\n\t\tHKF_STATUS_OK,\n\t\t0,\n\t\tNULL,\n\t\tMRK_NONE,\n\t\tNULL,\n\t\tNULL,\n\t\tKEY_DSA,\n\t\tNULL,\t \n\t\t\"DSA #6\",\n\t\t0,\n\t} },\n\t{ \"ecdsa_6.pub\" , -1, -1, HKF_MATCH_HOST|HKF_MATCH_HOST_HASHED, 0, 0, 0, -1, {\n\t\tNULL,\n\t\t28,\n\t\tHKF_STATUS_OK,\n\t\t0,\n\t\tNULL,\n\t\tMRK_NONE,\n\t\tNULL,\n\t\tNULL,\n\t\tKEY_ECDSA,\n\t\tNULL,\t \n\t\t\"ECDSA #6\",\n\t\t0,\n\t} },\n\t{ \"ecdsa_6.pub\" , -1, -1, 0, 0, HKF_MATCH_IP|HKF_MATCH_IP_HASHED, 0, -1, {\n\t\tNULL,\n\t\t29,\n\t\tHKF_STATUS_OK,\n\t\t0,\n\t\tNULL,\n\t\tMRK_NONE,\n\t\tNULL,\n\t\tNULL,\n\t\tKEY_ECDSA,\n\t\tNULL,\t \n\t\t\"ECDSA #6\",\n\t\t0,\n\t} },\n\t{ \"ecdsa_6.pub\" , -1, -1, 0, 0, 0, HKF_MATCH_IP|HKF_MATCH_IP_HASHED, -1, {\n\t\tNULL,\n\t\t30,\n\t\tHKF_STATUS_OK,\n\t\t0,\n\t\tNULL,\n\t\tMRK_NONE,\n\t\tNULL,\n\t\tNULL,\n\t\tKEY_ECDSA,\n\t\tNULL,\t \n\t\t\"ECDSA #6\",\n\t\t0,\n\t} },\n\t{ \"ed25519_6.pub\" , -1, -1, HKF_MATCH_HOST|HKF_MATCH_HOST_HASHED, 0, 0, 0, -1, {\n\t\tNULL,\n\t\t31,\n\t\tHKF_STATUS_OK,\n\t\t0,\n\t\tNULL,\n\t\tMRK_NONE,\n\t\tNULL,\n\t\tNULL,\n\t\tKEY_ED25519,\n\t\tNULL,\t \n\t\t\"ED25519 #6\",\n\t\t0,\n\t} },\n\t{ \"ed25519_6.pub\" , -1, -1, 0, 0, HKF_MATCH_IP|HKF_MATCH_IP_HASHED, 0, -1, {\n\t\tNULL,\n\t\t32,\n\t\tHKF_STATUS_OK,\n\t\t0,\n\t\tNULL,\n\t\tMRK_NONE,\n\t\tNULL,\n\t\tNULL,\n\t\tKEY_ED25519,\n\t\tNULL,\t \n\t\t\"ED25519 #6\",\n\t\t0,\n\t} },\n\t{ \"ed25519_6.pub\" , -1, -1, 0, 0, 0, HKF_MATCH_IP|HKF_MATCH_IP_HASHED, -1, {\n\t\tNULL,\n\t\t33,\n\t\tHKF_STATUS_OK,\n\t\t0,\n\t\tNULL,\n\t\tMRK_NONE,\n\t\tNULL,\n\t\tNULL,\n\t\tKEY_ED25519,\n\t\tNULL,\t \n\t\t\"ED25519 #6\",\n\t\t0,\n\t} },\n\t{ \"rsa_6.pub\" , -1, -1, HKF_MATCH_HOST|HKF_MATCH_HOST_HASHED, 0, 0, 0, -1, {\n\t\tNULL,\n\t\t34,\n\t\tHKF_STATUS_OK,\n\t\t0,\n\t\tNULL,\n\t\tMRK_NONE,\n\t\tNULL,\n\t\tNULL,\n\t\tKEY_RSA,\n\t\tNULL,\t \n\t\t\"RSA #6\",\n\t\t0,\n\t} },\n\t{ \"rsa_6.pub\" , -1, -1, 0, 0, HKF_MATCH_IP|HKF_MATCH_IP_HASHED, 0, -1, {\n\t\tNULL,\n\t\t35,\n\t\tHKF_STATUS_OK,\n\t\t0,\n\t\tNULL,\n\t\tMRK_NONE,\n\t\tNULL,\n\t\tNULL,\n\t\tKEY_RSA,\n\t\tNULL,\t \n\t\t\"RSA #6\",\n\t\t0,\n\t} },\n\t{ \"rsa_6.pub\" , -1, -1, 0, 0, 0, HKF_MATCH_IP|HKF_MATCH_IP_HASHED, -1, {\n\t\tNULL,\n\t\t36,\n\t\tHKF_STATUS_OK,\n\t\t0,\n\t\tNULL,\n\t\tMRK_NONE,\n\t\tNULL,\n\t\tNULL,\n\t\tKEY_RSA,\n\t\tNULL,\t \n\t\t\"RSA #6\",\n\t\t0,\n\t} },\n\t{ NULL, -1, -1, 0, 0, 0, 0, -1, {\n\t\tNULL,\n\t\t37,\n\t\tHKF_STATUS_COMMENT,\n\t\t0,\n\t\t\"\",\n\t\tMRK_NONE,\n\t\tNULL,\n\t\tNULL,\n\t\tKEY_UNSPEC,\n\t\tNULL,\n\t\tNULL,\n\t\t0,\n\t} },\n\t{ NULL, -1, -1, 0, 0, 0, 0, -1, {\n\t\tNULL,\n\t\t38,\n\t\tHKF_STATUS_COMMENT,\n\t\t0,\n\t\t\"\",\n\t\tMRK_NONE,\n\t\tNULL,\n\t\tNULL,\n\t\tKEY_UNSPEC,\n\t\tNULL,\n\t\tNULL,\n\t\t0,\n\t} },\n\t{ NULL, -1, -1, 0, 0, 0, 0, -1, {\n\t\tNULL,\n\t\t39,\n\t\tHKF_STATUS_COMMENT,\n\t\t0,\n\t\t\"# Revoked and CA keys\",\n\t\tMRK_NONE,\n\t\tNULL,\n\t\tNULL,\n\t\tKEY_UNSPEC,\n\t\tNULL,\n\t\tNULL,\n\t\t0,\n\t} },\n\t{ \"ed25519_4.pub\" , -1, -1, 0, HKF_MATCH_HOST, 0, 0, -1, {\n\t\tNULL,\n\t\t40,\n\t\tHKF_STATUS_OK,\n\t\t0,\n\t\tNULL,\n\t\tMRK_REVOKE,\n\t\t\"sisyphus.example.com\",\n\t\tNULL,\n\t\tKEY_ED25519,\n\t\tNULL,\t \n\t\t\"ED25519 #4\",\n\t\t0,\n\t} },\n\t{ \"ecdsa_4.pub\" , -1, -1, HKF_MATCH_HOST, 0, 0, 0, -1, {\n\t\tNULL,\n\t\t41,\n\t\tHKF_STATUS_OK,\n\t\t0,\n\t\tNULL,\n\t\tMRK_CA,\n\t\t\"prometheus.example.com\",\n\t\tNULL,\n\t\tKEY_ECDSA,\n\t\tNULL,\t \n\t\t\"ECDSA #4\",\n\t\t0,\n\t} },\n\t{ \"dsa_4.pub\" , -1, -1, HKF_MATCH_HOST, HKF_MATCH_HOST, 0, 0, -1, {\n\t\tNULL,\n\t\t42,\n\t\tHKF_STATUS_OK,\n\t\t0,\n\t\tNULL,\n\t\tMRK_CA,\n\t\t\"*.example.com\",\n\t\tNULL,\n\t\tKEY_DSA,\n\t\tNULL,\t \n\t\t\"DSA #4\",\n\t\t0,\n\t} },\n\t{ NULL, -1, -1, 0, 0, 0, 0, -1, {\n\t\tNULL,\n\t\t43,\n\t\tHKF_STATUS_COMMENT,\n\t\t0,\n\t\t\"\",\n\t\tMRK_NONE,\n\t\tNULL,\n\t\tNULL,\n\t\tKEY_UNSPEC,\n\t\tNULL,\n\t\tNULL,\n\t\t0,\n\t} },\n\t{ NULL, -1, -1, 0, 0, 0, 0, -1, {\n\t\tNULL,\n\t\t44,\n\t\tHKF_STATUS_COMMENT,\n\t\t0,\n\t\t\"# Some invalid lines\",\n\t\tMRK_NONE,\n\t\tNULL,\n\t\tNULL,\n\t\tKEY_UNSPEC,\n\t\tNULL,\n\t\tNULL,\n\t\t0,\n\t} },\n\t{ NULL, -1, -1, 0, 0, 0, 0, -1, {\n\t\tNULL,\n\t\t45,\n\t\tHKF_STATUS_INVALID,\n\t\t0,\n\t\tNULL,\n\t\tMRK_ERROR,\n\t\tNULL,\n\t\tNULL,\n\t\tKEY_UNSPEC,\n\t\tNULL,\n\t\tNULL,\n\t\t0,\n\t} },\n\t{ NULL, -1, -1, 0, HKF_MATCH_HOST, 0, 0, -1, {\n\t\tNULL,\n\t\t46,\n\t\tHKF_STATUS_INVALID,\n\t\t0,\n\t\tNULL,\n\t\tMRK_NONE,\n\t\t\"sisyphus.example.com\",\n\t\tNULL,\n\t\tKEY_UNSPEC,\n\t\tNULL,\n\t\tNULL,\n\t\t0,\n\t} },\n\t{ NULL, -1, -1, HKF_MATCH_HOST, 0, 0, 0, -1, {\n\t\tNULL,\n\t\t47,\n\t\tHKF_STATUS_INVALID,\n\t\t0,\n\t\tNULL,\n\t\tMRK_NONE,\n\t\t\"prometheus.example.com\",\n\t\tNULL,\n\t\tKEY_UNSPEC,\n\t\tNULL,\n\t\tNULL,\n\t\t0,\n\t} },\n\t{ NULL, -1, -1, 0, HKF_MATCH_HOST, 0, 0, -1, {\n\t\tNULL,\n\t\t48,\n\t\tHKF_STATUS_INVALID,\t \n\t\t0,\n\t\tNULL,\n\t\tMRK_NONE,\n\t\t\"sisyphus.example.com\",\n\t\tNULL,\n\t\tKEY_UNSPEC,\n\t\tNULL,\n\t\tNULL,\n\t\t0,\n\t} },\n\t{ NULL, -1, -1, 0, HKF_MATCH_HOST, 0, 0, -1, {\n\t\tNULL,\n\t\t49,\n\t\tHKF_STATUS_INVALID,\n\t\t0,\n\t\tNULL,\n\t\tMRK_NONE,\n\t\t\"sisyphus.example.com\",\n\t\tNULL,\n\t\tKEY_UNSPEC,\n\t\tNULL,\t \n\t\tNULL,\n\t\t0,\n\t} },\n\t{ NULL, HKF_STATUS_OK, KEY_RSA, HKF_MATCH_HOST, 0, 0, 0, -1, {\n\t\tNULL,\n\t\t50,\n\t\tHKF_STATUS_INVALID,\t \n\t\t0,\n\t\tNULL,\n\t\tMRK_NONE,\n\t\t\"prometheus.example.com\",\n\t\tNULL,\n\t\tKEY_UNSPEC,\n\t\tNULL,\t \n\t\tNULL,\n\t\t0,\n\t} },\n};\n\nvoid test_iterate(void);\n\nvoid\ntest_iterate(void)\n{\n\tstruct cbctx ctx;\n\n\tTEST_START(\"hostkeys_iterate all with key parse\");\n\tmemset(&ctx, 0, sizeof(ctx));\n\tctx.expected = expected_full;\n\tctx.nexpected = sizeof(expected_full)/sizeof(*expected_full);\n\tctx.flags = HKF_WANT_PARSE_KEY;\n\tprepare_expected(expected_full, ctx.nexpected);\n\tASSERT_INT_EQ(hostkeys_foreach(test_data_file(\"known_hosts\"),\n\t    check, &ctx, NULL, NULL, ctx.flags, 0), 0);\n\tcleanup_expected(expected_full, ctx.nexpected);\n\tTEST_DONE();\n\n\tTEST_START(\"hostkeys_iterate all without key parse\");\n\tmemset(&ctx, 0, sizeof(ctx));\n\tctx.expected = expected_full;\n\tctx.nexpected = sizeof(expected_full)/sizeof(*expected_full);\n\tctx.flags = 0;\n\tprepare_expected(expected_full, ctx.nexpected);\n\tASSERT_INT_EQ(hostkeys_foreach(test_data_file(\"known_hosts\"),\n\t    check, &ctx, NULL, NULL, ctx.flags, 0), 0);\n\tcleanup_expected(expected_full, ctx.nexpected);\n\tTEST_DONE();\n\n\tTEST_START(\"hostkeys_iterate specify host 1\");\n\tmemset(&ctx, 0, sizeof(ctx));\n\tctx.expected = expected_full;\n\tctx.nexpected = sizeof(expected_full)/sizeof(*expected_full);\n\tctx.flags = 0;\n\tctx.match_host_p = 1;\n\tprepare_expected(expected_full, ctx.nexpected);\n\tASSERT_INT_EQ(hostkeys_foreach(test_data_file(\"known_hosts\"),\n\t    check, &ctx, \"prometheus.example.com\", NULL, ctx.flags, 0), 0);\n\tcleanup_expected(expected_full, ctx.nexpected);\n\tTEST_DONE();\n\n\tTEST_START(\"hostkeys_iterate specify host 2\");\n\tmemset(&ctx, 0, sizeof(ctx));\n\tctx.expected = expected_full;\n\tctx.nexpected = sizeof(expected_full)/sizeof(*expected_full);\n\tctx.flags = 0;\n\tctx.match_host_s = 1;\n\tprepare_expected(expected_full, ctx.nexpected);\n\tASSERT_INT_EQ(hostkeys_foreach(test_data_file(\"known_hosts\"),\n\t    check, &ctx, \"sisyphus.example.com\", NULL, ctx.flags, 0), 0);\n\tcleanup_expected(expected_full, ctx.nexpected);\n\tTEST_DONE();\n\n\tTEST_START(\"hostkeys_iterate match host 1\");\n\tmemset(&ctx, 0, sizeof(ctx));\n\tctx.expected = expected_full;\n\tctx.nexpected = sizeof(expected_full)/sizeof(*expected_full);\n\tctx.flags = HKF_WANT_MATCH;\n\tctx.match_host_p = 1;\n\tprepare_expected(expected_full, ctx.nexpected);\n\tASSERT_INT_EQ(hostkeys_foreach(test_data_file(\"known_hosts\"),\n\t    check, &ctx, \"prometheus.example.com\", NULL, ctx.flags, 0), 0);\n\tcleanup_expected(expected_full, ctx.nexpected);\n\tTEST_DONE();\n\n\tTEST_START(\"hostkeys_iterate match host 2\");\n\tmemset(&ctx, 0, sizeof(ctx));\n\tctx.expected = expected_full;\n\tctx.nexpected = sizeof(expected_full)/sizeof(*expected_full);\n\tctx.flags = HKF_WANT_MATCH;\n\tctx.match_host_s = 1;\n\tprepare_expected(expected_full, ctx.nexpected);\n\tASSERT_INT_EQ(hostkeys_foreach(test_data_file(\"known_hosts\"),\n\t    check, &ctx, \"sisyphus.example.com\", NULL, ctx.flags, 0), 0);\n\tcleanup_expected(expected_full, ctx.nexpected);\n\tTEST_DONE();\n\n\tTEST_START(\"hostkeys_iterate specify host missing\");\n\tmemset(&ctx, 0, sizeof(ctx));\n\tctx.expected = expected_full;\n\tctx.nexpected = sizeof(expected_full)/sizeof(*expected_full);\n\tctx.flags = 0;\n\tprepare_expected(expected_full, ctx.nexpected);\n\tASSERT_INT_EQ(hostkeys_foreach(test_data_file(\"known_hosts\"),\n\t    check, &ctx, \"actaeon.example.org\", NULL, ctx.flags, 0), 0);\n\tcleanup_expected(expected_full, ctx.nexpected);\n\tTEST_DONE();\n\n\tTEST_START(\"hostkeys_iterate match host missing\");\n\tmemset(&ctx, 0, sizeof(ctx));\n\tctx.expected = expected_full;\n\tctx.nexpected = sizeof(expected_full)/sizeof(*expected_full);\n\tctx.flags = HKF_WANT_MATCH;\n\tprepare_expected(expected_full, ctx.nexpected);\n\tASSERT_INT_EQ(hostkeys_foreach(test_data_file(\"known_hosts\"),\n\t    check, &ctx, \"actaeon.example.org\", NULL, ctx.flags, 0), 0);\n\tcleanup_expected(expected_full, ctx.nexpected);\n\tTEST_DONE();\n\n\tTEST_START(\"hostkeys_iterate specify IPv4\");\n\tmemset(&ctx, 0, sizeof(ctx));\n\tctx.expected = expected_full;\n\tctx.nexpected = sizeof(expected_full)/sizeof(*expected_full);\n\tctx.flags = 0;\n\tctx.match_ipv4 = 1;\n\tprepare_expected(expected_full, ctx.nexpected);\n\tASSERT_INT_EQ(hostkeys_foreach(test_data_file(\"known_hosts\"),\n\t    check, &ctx, \"tiresias.example.org\", \"192.0.2.1\", ctx.flags, 0), 0);\n\tcleanup_expected(expected_full, ctx.nexpected);\n\tTEST_DONE();\n\n\tTEST_START(\"hostkeys_iterate specify IPv6\");\n\tmemset(&ctx, 0, sizeof(ctx));\n\tctx.expected = expected_full;\n\tctx.nexpected = sizeof(expected_full)/sizeof(*expected_full);\n\tctx.flags = 0;\n\tctx.match_ipv6 = 1;\n\tprepare_expected(expected_full, ctx.nexpected);\n\tASSERT_INT_EQ(hostkeys_foreach(test_data_file(\"known_hosts\"),\n\t    check, &ctx, \"tiresias.example.org\", \"2001:db8::1\",\n\t    ctx.flags, 0), 0);\n\tcleanup_expected(expected_full, ctx.nexpected);\n\tTEST_DONE();\n\n\tTEST_START(\"hostkeys_iterate match IPv4\");\n\tmemset(&ctx, 0, sizeof(ctx));\n\tctx.expected = expected_full;\n\tctx.nexpected = sizeof(expected_full)/sizeof(*expected_full);\n\tctx.flags = HKF_WANT_MATCH;\n\tctx.match_ipv4 = 1;\n\tprepare_expected(expected_full, ctx.nexpected);\n\tASSERT_INT_EQ(hostkeys_foreach(test_data_file(\"known_hosts\"),\n\t    check, &ctx, \"tiresias.example.org\", \"192.0.2.1\", ctx.flags, 0), 0);\n\tcleanup_expected(expected_full, ctx.nexpected);\n\tTEST_DONE();\n\n\tTEST_START(\"hostkeys_iterate match IPv6\");\n\tmemset(&ctx, 0, sizeof(ctx));\n\tctx.expected = expected_full;\n\tctx.nexpected = sizeof(expected_full)/sizeof(*expected_full);\n\tctx.flags = HKF_WANT_MATCH;\n\tctx.match_ipv6 = 1;\n\tprepare_expected(expected_full, ctx.nexpected);\n\tASSERT_INT_EQ(hostkeys_foreach(test_data_file(\"known_hosts\"),\n\t    check, &ctx, \"tiresias.example.org\", \"2001:db8::1\",\n\t    ctx.flags, 0), 0);\n\tcleanup_expected(expected_full, ctx.nexpected);\n\tTEST_DONE();\n\n\tTEST_START(\"hostkeys_iterate specify addr missing\");\n\tmemset(&ctx, 0, sizeof(ctx));\n\tctx.expected = expected_full;\n\tctx.nexpected = sizeof(expected_full)/sizeof(*expected_full);\n\tctx.flags = 0;\n\tprepare_expected(expected_full, ctx.nexpected);\n\tASSERT_INT_EQ(hostkeys_foreach(test_data_file(\"known_hosts\"),\n\t    check, &ctx, \"tiresias.example.org\", \"192.168.0.1\",\n\t    ctx.flags, 0), 0);\n\tcleanup_expected(expected_full, ctx.nexpected);\n\tTEST_DONE();\n\n\tTEST_START(\"hostkeys_iterate match addr missing\");\n\tmemset(&ctx, 0, sizeof(ctx));\n\tctx.expected = expected_full;\n\tctx.nexpected = sizeof(expected_full)/sizeof(*expected_full);\n\tctx.flags = HKF_WANT_MATCH;\n\tprepare_expected(expected_full, ctx.nexpected);\n\tASSERT_INT_EQ(hostkeys_foreach(test_data_file(\"known_hosts\"),\n\t    check, &ctx, \"tiresias.example.org\", \"::1\", ctx.flags, 0), 0);\n\tcleanup_expected(expected_full, ctx.nexpected);\n\tTEST_DONE();\n\n\tTEST_START(\"hostkeys_iterate specify host 2 and IPv4\");\n\tmemset(&ctx, 0, sizeof(ctx));\n\tctx.expected = expected_full;\n\tctx.nexpected = sizeof(expected_full)/sizeof(*expected_full);\n\tctx.flags = 0;\n\tctx.match_host_s = 1;\n\tctx.match_ipv4 = 1;\n\tprepare_expected(expected_full, ctx.nexpected);\n\tASSERT_INT_EQ(hostkeys_foreach(test_data_file(\"known_hosts\"),\n\t    check, &ctx, \"sisyphus.example.com\", \"192.0.2.1\", ctx.flags, 0), 0);\n\tcleanup_expected(expected_full, ctx.nexpected);\n\tTEST_DONE();\n\n\tTEST_START(\"hostkeys_iterate match host 1 and IPv6\");\n\tmemset(&ctx, 0, sizeof(ctx));\n\tctx.expected = expected_full;\n\tctx.nexpected = sizeof(expected_full)/sizeof(*expected_full);\n\tctx.flags = HKF_WANT_MATCH;\n\tctx.match_host_p = 1;\n\tctx.match_ipv6 = 1;\n\tprepare_expected(expected_full, ctx.nexpected);\n\tASSERT_INT_EQ(hostkeys_foreach(test_data_file(\"known_hosts\"),\n\t    check, &ctx, \"prometheus.example.com\",\n\t    \"2001:db8::1\", ctx.flags, 0), 0);\n\tcleanup_expected(expected_full, ctx.nexpected);\n\tTEST_DONE();\n\n\tTEST_START(\"hostkeys_iterate specify host 2 and IPv4 w/ key parse\");\n\tmemset(&ctx, 0, sizeof(ctx));\n\tctx.expected = expected_full;\n\tctx.nexpected = sizeof(expected_full)/sizeof(*expected_full);\n\tctx.flags = HKF_WANT_PARSE_KEY;\n\tctx.match_host_s = 1;\n\tctx.match_ipv4 = 1;\n\tprepare_expected(expected_full, ctx.nexpected);\n\tASSERT_INT_EQ(hostkeys_foreach(test_data_file(\"known_hosts\"),\n\t    check, &ctx, \"sisyphus.example.com\", \"192.0.2.1\", ctx.flags, 0), 0);\n\tcleanup_expected(expected_full, ctx.nexpected);\n\tTEST_DONE();\n\n\tTEST_START(\"hostkeys_iterate match host 1 and IPv6 w/ key parse\");\n\tmemset(&ctx, 0, sizeof(ctx));\n\tctx.expected = expected_full;\n\tctx.nexpected = sizeof(expected_full)/sizeof(*expected_full);\n\tctx.flags = HKF_WANT_MATCH|HKF_WANT_PARSE_KEY;\n\tctx.match_host_p = 1;\n\tctx.match_ipv6 = 1;\n\tprepare_expected(expected_full, ctx.nexpected);\n\tASSERT_INT_EQ(hostkeys_foreach(test_data_file(\"known_hosts\"),\n\t    check, &ctx, \"prometheus.example.com\",\n\t    \"2001:db8::1\", ctx.flags, 0), 0);\n\tcleanup_expected(expected_full, ctx.nexpected);\n\tTEST_DONE();\n}\n\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}