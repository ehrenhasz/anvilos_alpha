{
  "module_name": "forcecommand.sh",
  "hash_id": "423c29874a9e96b4f9002b961114e414183a9ea3505b77c6fe7413098f1fd867",
  "original_prompt": "Ingested from openssh-9.6p1/regress/forcecommand.sh",
  "human_readable_source": "#\t$OpenBSD: forcecommand.sh,v 1.7 2023/11/01 02:08:38 dtucker Exp $\n#\tPlaced in the Public Domain.\n\ntid=\"forced command\"\n\ncp $OBJ/sshd_proxy $OBJ/sshd_proxy_bak\n\nauthorized_keys() {\n\tcmd=$1\n\tcp /dev/null $OBJ/authorized_keys_$USER\n\tfor t in ${SSH_KEYTYPES}; do\n\t\ttest -z \"$cmd\" || \\\n\t\t\tprintf \"command=\\\"$cmd\\\" \" >>$OBJ/authorized_keys_$USER\n\t\tcat $OBJ/$t.pub >> $OBJ/authorized_keys_$USER\n\tdone\n}\n\ntrace \"test config with sftp\"\nauthorized_keys\nrm -f $OBJ/ssh_proxy.tmp\necho \"@get $OBJ/ssh_proxy $OBJ/ssh_proxy.tmp\" | \\\n\t${SFTP} -S ${SSH} -b - -qF $OBJ/ssh_proxy somehost 2>/dev/null || \\\n\tfail \"sftp failed\"\ntest -f \"$OBJ/ssh_proxy.tmp\" || fail \"sftp did not download file\"\nrm -f $OBJ/ssh_proxy.tmp\n\ntrace \"forced command in key option\"\nauthorized_keys true\n${SSH} -F $OBJ/ssh_proxy somehost false || fail \"forced command in key option\"\n\nauthorized_keys false\ncp $OBJ/sshd_proxy_bak $OBJ/sshd_proxy\necho \"ForceCommand true\" >> $OBJ/sshd_proxy\n\ntrace \"forced command in sshd_config overrides key option\"\n${SSH} -F $OBJ/ssh_proxy somehost false || fail \"forced command config\"\n\nauthorized_keys\ncp $OBJ/sshd_proxy_bak $OBJ/sshd_proxy\necho \"ForceCommand false\" >> $OBJ/sshd_proxy\n\ntrace \"force command overriding subsystem\"\necho \"@get $OBJ/ssh_proxy $OBJ/ssh_proxy.tmp\" | \\\n\t${SFTP} -S ${SSH} -F $OBJ/ssh_proxy -oLoglevel=quiet somehost && \\\n\tfail \"sftp succeeded\"\n\necho \"Match User $USER\" >> $OBJ/sshd_proxy\necho \"    ForceCommand true\" >> $OBJ/sshd_proxy\n\ntrace \"forced command with match\"\n${SSH} -F $OBJ/ssh_proxy somehost false || fail \"forced command match\"\n\ntrace \"force command in match overriding subsystem\"\necho \"@get $OBJ/ssh_proxy $OBJ/ssh_proxy.tmp\" | \\\n\t${SFTP} -S ${SSH} -F $OBJ/ssh_proxy -oLoglevel=quiet somehost && \\\n\tfail \"sftp succeeded\"\n\ntrace \"force command to sftpserver\"\ngrep -vi subsystem $OBJ/sshd_proxy_bak > $OBJ/sshd_proxy\necho \"Subsystem sftp /bin/false\" >> $OBJ/sshd_proxy\necho \"ForceCommand ${SFTPSERVER}\" >> $OBJ/sshd_proxy\nrm -f $OBJ/ssh_proxy.tmp\necho \"@get $OBJ/ssh_proxy $OBJ/ssh_proxy.tmp\" | \\\n\t${SFTP} -S ${SSH} -b - -qF $OBJ/ssh_proxy somehost 2>/dev/null || \\\n\tfail \"sftp failed\"\ntest -f \"$OBJ/ssh_proxy.tmp\" || fail \"sftp did not download file\"\nrm -f $OBJ/ssh_proxy.tmp\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}