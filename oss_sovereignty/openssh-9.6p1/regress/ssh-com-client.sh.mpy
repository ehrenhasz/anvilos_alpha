{
  "module_name": "ssh-com-client.sh",
  "hash_id": "cf8a186ef5955737b38a83fc4f3529de220975a7fb329a75b3ed5b8a71f2f066",
  "original_prompt": "Ingested from openssh-9.6p1/regress/ssh-com-client.sh",
  "human_readable_source": "#\t$OpenBSD: ssh-com-client.sh,v 1.7 2013/05/17 04:29:14 dtucker Exp $\n#\tPlaced in the Public Domain.\n\ntid=\"connect with ssh.com client\"\n\n#TEST_COMBASE=/path/to/ssh/com/binaries\nif [ \"X${TEST_COMBASE}\" = \"X\" ]; then\n\tfatal '$TEST_COMBASE is not set'\nfi\n\nVERSIONS=\"\n\t2.1.0\n\t2.2.0\n\t2.3.0\n\t2.3.1\n\t2.4.0\n\t3.0.0\n\t3.1.0\n\t3.2.0\n\t3.2.2\n\t3.2.3\n\t3.2.5\n\t3.2.9\n\t3.2.9.1\n\t3.3.0\"\n\n# 2.0.10 2.0.12 2.0.13 don't like the test setup\n\n# setup authorized keys\nSRC=`dirname ${SCRIPT}`\ncp ${SRC}/dsa_ssh2.prv ${OBJ}/id.com\nchmod 600 ${OBJ}/id.com\n${SSHKEYGEN} -i -f ${OBJ}/id.com\t> $OBJ/id.openssh\nchmod 600 ${OBJ}/id.openssh\n${SSHKEYGEN} -y -f ${OBJ}/id.openssh\t> $OBJ/authorized_keys_$USER\n${SSHKEYGEN} -e -f ${OBJ}/id.openssh\t> $OBJ/id.com.pub\necho IdKey ${OBJ}/id.com > ${OBJ}/id.list\n\n# we need a DSA host key\nt=dsa\nrm -f                             ${OBJ}/$t ${OBJ}/$t.pub\n${SSHKEYGEN} -q -N '' -t $t -f\t  ${OBJ}/$t\n$SUDO cp $OBJ/$t $OBJ/host.$t\necho HostKey $OBJ/host.$t >> $OBJ/sshd_config\n\n# add hostkeys to known hosts\nmkdir -p ${OBJ}/${USER}/hostkeys\nHK=${OBJ}/${USER}/hostkeys/key_${PORT}_127.0.0.1\n${SSHKEYGEN} -e -f ${OBJ}/rsa.pub > ${HK}.ssh-rsa.pub\n${SSHKEYGEN} -e -f ${OBJ}/dsa.pub > ${HK}.ssh-dss.pub\n\ncat > ${OBJ}/ssh2_config << EOF\n*:\n\tQuietMode\t\t\tyes\n\tStrictHostKeyChecking\t\tyes\n\tPort\t\t\t\t${PORT}\n\tUser\t\t\t\t${USER}\n\tHost\t\t\t\t127.0.0.1\n\tIdentityFile\t\t\t${OBJ}/id.list\n\tRandomSeedFile\t\t\t${OBJ}/random_seed\n        UserConfigDirectory             ${OBJ}/%U\n\tAuthenticationSuccessMsg\tno\n\tBatchMode\t\t\tyes\n\tForwardX11\t\t\tno\nEOF\n\n# we need a real server (no ProxyConnect option)\nstart_sshd\n\n# go for it\nfor v in ${VERSIONS}; do\n\tssh2=${TEST_COMBASE}/${v}/ssh2\n\tif [ ! -x ${ssh2} ]; then\n\t\tcontinue\n\tfi\n\tverbose \"ssh2 ${v}\"\n\tkey=ssh-dss\n\tskipcat=0\n        case $v in\n        2.1.*|2.3.0)\n                skipcat=1\n                ;;\n        3.0.*)\n                key=ssh-rsa\n                ;;\n        esac\n\tcp ${HK}.$key.pub ${HK}.pub\n\n\t# check exit status\n\t${ssh2} -q -F ${OBJ}/ssh2_config somehost exit 42\n\tr=$?\n        if [ $r -ne 42 ]; then\n                fail \"ssh2 ${v} exit code test failed (got $r, expected 42)\"\n        fi\n\n\t# data transfer\n\trm -f ${COPY}\n\t${ssh2} -F ${OBJ}/ssh2_config somehost cat ${DATA} > ${COPY}\n        if [ $? -ne 0 ]; then\n                fail \"ssh2 ${v} cat test (receive) failed\"\n        fi\n\tcmp ${DATA} ${COPY}\t|| fail \"ssh2 ${v} cat test (receive) data mismatch\"\n\n\t# data transfer, again\n\tif [ $skipcat -eq 0 ]; then\n\t\trm -f ${COPY}\n\t\tcat ${DATA} | \\\n\t\t\t${ssh2} -F ${OBJ}/ssh2_config host \"cat > ${COPY}\"\n\t\tif [ $? -ne 0 ]; then\n\t\t\tfail \"ssh2 ${v} cat test (send) failed\"\n\t\tfi\n\t\tcmp ${DATA} ${COPY}\t|| \\\n\t\t\tfail \"ssh2 ${v} cat test (send) data mismatch\"\n\tfi\n\n\t# no stderr after eof\n\trm -f ${COPY}\n\t${ssh2} -F ${OBJ}/ssh2_config somehost \\\n\t\texec sh -c \\'\"exec > /dev/null; sleep 1; echo bla 1>&2; exit 0\"\\' \\\n\t\t2> /dev/null\n        if [ $? -ne 0 ]; then\n                fail \"ssh2 ${v} stderr test failed\"\n        fi\ndone\n\nrm -rf ${OBJ}/${USER}\nfor i in ssh2_config random_seed dsa.pub dsa host.dsa \\\n    id.list id.com id.com.pub id.openssh; do\n\trm -f ${OBJ}/$i\ndone\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}