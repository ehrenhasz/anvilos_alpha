{
  "module_name": "percent.sh",
  "hash_id": "164b4a3fb6c7f3b52a1c99c3f0ad4015c113a4943348e0f67f9a03762119cc43",
  "original_prompt": "Ingested from openssh-9.6p1/regress/percent.sh",
  "human_readable_source": "#\t$OpenBSD: percent.sh,v 1.17 2023/03/27 03:56:50 dtucker Exp $\n#\tPlaced in the Public Domain.\n\ntid=\"percent expansions\"\n\nif [ -x \"/usr/xpg4/bin/id\" ]; then\n\tPATH=/usr/xpg4/bin:$PATH\n\texport PATH\nfi\n\nUSER=`id -u -n`\nUSERID=`id -u`\nHOST=`hostname | cut -f1 -d.`\nHOSTNAME=`hostname`\nHASH=\"\"\n\n# Localcommand is evaluated after connection because %T is not available\n# until then.  Because of this we use a different method of exercising it,\n# and we can't override the remote user otherwise authentication will fail.\n# We also have to explicitly enable it.\necho \"permitlocalcommand yes\" >> $OBJ/ssh_proxy\n\ntrial()\n{\n\topt=\"$1\"; arg=\"$2\"\n\texpect=`echo \"$3\" | sed 's|^//|/|'` # approximate realpath\n\n\ttrace \"test $opt=$arg $expect\"\n\trm -f $OBJ/actual\n\tgot=\"\"\n\tcase \"$opt\" in\n\tlocalcommand)\n\t\t${SSH} -F $OBJ/ssh_proxy -o $opt=\"echo '$arg' >$OBJ/actual\" \\\n\t\t    somehost true\n\t\tgot=`cat $OBJ/actual`\n\t\t;;\n\tuserknownhostsfile)\n\t\t# Move the userknownhosts file to what the expansion says,\n\t\t# make sure ssh works then put it back.\n\t\tmv \"$OBJ/known_hosts\" \"$OBJ/$expect\"\n\t\t${SSH} -F $OBJ/ssh_proxy -o $opt=\"$OBJ/$arg\" somehost true && \\\n\t\t\tgot=\"$expect\"\n\t\tmv \"$OBJ/$expect\" \"$OBJ/known_hosts\"\n\t\t;;\n\tmatchexec)\n\t\t(cat $OBJ/ssh_proxy && \\\n\t\t echo \"Match Exec \\\"echo '$arg' >$OBJ/actual\\\"\") \\\n\t\t    >$OBJ/ssh_proxy_match\n\t\t${SSH} -F $OBJ/ssh_proxy_match remuser@somehost true || true\n\t\tgot=`cat $OBJ/actual`\n\t\t;;\n\t*forward)\n\t\t# LocalForward and RemoteForward take two args and only\n\t\t# operate on Unix domain socket paths\n\t\tgot=`${SSH} -F $OBJ/ssh_proxy -o $opt=\"/$arg /$arg\" -G \\\n\t\t    remuser@somehost | awk '$1==\"'$opt'\"{print $2\" \"$3}'`\n\t\texpect=\"/$expect /$expect\"\n\t\t;;\n\t*)\n\t\tgot=`${SSH} -F $OBJ/ssh_proxy -o $opt=\"$arg\" -G \\\n\t\t    remuser@somehost | awk '$1==\"'$opt'\"{print $2}'`\n\tesac\n\tif [ \"$got\" != \"$expect\" ]; then\n\t\tfail \"$opt=$arg expect $expect got $got\"\n\tfi\n}\n\nfor i in matchexec localcommand remotecommand controlpath identityagent \\\n    forwardagent localforward remoteforward revokedhostkeys \\\n    userknownhostsfile; do\n\tverbose $tid $i percent\n\tcase \"$i\" in\n\tlocalcommand|userknownhostsfile)\n\t\t# Any test that's going to actually make a connection needs\n\t\t# to use the real username.\n\t\tREMUSER=$USER ;;\n\t*)\n\t\tREMUSER=remuser ;;\n\tesac\n\tif [ \"$i\" = \"$localcommand\" ]; then\n\t\ttrial $i '%T' NONE\n\tfi\n\t# Matches implementation in readconf.c:ssh_connection_hash()\n\tif [ ! -z \"${OPENSSL_BIN}\" ]; then\n\t\tHASH=`printf \"${HOSTNAME}127.0.0.1${PORT}$REMUSER\" |\n\t\t    $OPENSSL_BIN sha1 | cut -f2 -d' '`\n\t\ttrial $i '%C' $HASH\n\tfi\n\ttrial $i '%%' '%'\n\ttrial $i '%i' $USERID\n\ttrial $i '%h' 127.0.0.1\n\ttrial $i '%L' $HOST\n\ttrial $i '%l' $HOSTNAME\n\ttrial $i '%n' somehost\n\ttrial $i '%k' localhost-with-alias\n\ttrial $i '%p' $PORT\n\ttrial $i '%r' $REMUSER\n\ttrial $i '%u' $USER\n\t# We can't specify a full path outside the regress dir, so skip tests\n\t# containing %d for UserKnownHostsFile\n\tif [ \"$i\" != \"userknownhostsfile\" ]; then\n\t\ttrial $i '%d' $HOME\n\t\tin='%%/%i/%h/%d/%L/%l/%n/%p/%r/%u'\n\t\tout=\"%/$USERID/127.0.0.1/$HOME/$HOST/$HOSTNAME/somehost/$PORT/$REMUSER/$USER\"\n\t\tif [ ! -z \"${HASH}\" ]; then\n\t\t\tin=\"$in/%C\"\n\t\t\tout=\"$out/$HASH\"\n\t\tfi\n\t\ttrial $i \"$in\" \"$out\"\n\tfi\ndone\n\n# Subset of above since we don't expand shell-style variables on anything that\n# runs a command because the shell will expand those.\nfor i in controlpath identityagent forwardagent localforward remoteforward \\\n    userknownhostsfile; do\n\tverbose $tid $i dollar\n\tFOO=bar\n\texport FOO\n\ttrial $i '${FOO}' $FOO\ndone\n\n\n# A subset of options support tilde expansion\nfor i in controlpath identityagent forwardagent; do\n\tverbose $tid $i tilde\n\ttrial $i '~' $HOME/\n\ttrial $i '~/.ssh' $HOME/.ssh\ndone\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}