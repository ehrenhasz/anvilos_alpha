{
  "module_name": "forwarding.sh",
  "hash_id": "1c54eab2d3623af4686ae53873855c0d71eaab856621838a5c86b5ccb8a37b83",
  "original_prompt": "Ingested from openssh-9.6p1/regress/forwarding.sh",
  "human_readable_source": "#\t$OpenBSD: forwarding.sh,v 1.24 2021/05/07 09:23:40 dtucker Exp $\n#\tPlaced in the Public Domain.\n\ntid=\"local and remote forwarding\"\n\nDATA=/bin/ls${EXEEXT}\n\nstart_sshd\n\nbase=33\nlast=$PORT\nfwd=\"\"\nmake_tmpdir\nCTL=${SSH_REGRESS_TMP}/ctl-sock\n\nfor j in 0 1 2; do\n\tfor i in 0 1 2; do\n\t\ta=$base$j$i\n\t\tb=`expr $a + 50`\n\t\tc=$last\n\t\t# fwd chain: $a -> $b -> $c\n\t\tfwd=\"$fwd -L$a:127.0.0.1:$b -R$b:127.0.0.1:$c\"\n\t\tlast=$a\n\tdone\ndone\n\ntrace \"start forwarding, fork to background\"\nrm -f $CTL\n${SSH} -S $CTL -N -M -F $OBJ/ssh_config -f $fwd somehost\n\ntrace \"transfer over forwarded channels and check result\"\n${SSH} -F $OBJ/ssh_config -p$last -o 'ConnectionAttempts=10' \\\n\tsomehost cat ${DATA} > ${COPY}\ntest -s ${COPY}\t\t|| fail \"failed copy of ${DATA}\"\ncmp ${DATA} ${COPY}\t|| fail \"corrupted copy of ${DATA}\"\n\n${SSH} -F $OBJ/ssh_config -S $CTL -O exit somehost 2>/dev/null\n\nfor d in L R; do\n\ttrace \"exit on -$d forward failure\"\n\n\t# this one should succeed\n\t${SSH}  -F $OBJ/ssh_config \\\n\t    -$d ${base}01:127.0.0.1:$PORT \\\n\t    -$d ${base}02:127.0.0.1:$PORT \\\n\t    -$d ${base}03:127.0.0.1:$PORT \\\n\t    -$d ${base}04:127.0.0.1:$PORT \\\n\t    -oExitOnForwardFailure=yes somehost true\n\tif [ $? != 0 ]; then\n\t\tfatal \"connection failed, should not\"\n\telse\n\t\t# this one should fail\n\t\t${SSH} -q -F $OBJ/ssh_config \\\n\t\t    -$d ${base}01:127.0.0.1:$PORT \\\n\t\t    -$d ${base}02:127.0.0.1:$PORT \\\n\t\t    -$d ${base}03:127.0.0.1:$PORT \\\n\t\t    -$d ${base}01:localhost:$PORT \\\n\t\t    -$d ${base}04:127.0.0.1:$PORT \\\n\t\t    -oExitOnForwardFailure=yes somehost true\n\t\tr=$?\n\t\tif [ $r != 255 ]; then\n\t\t\tfail \"connection not termintated, but should ($r)\"\n\t\tfi\n\tfi\ndone\n\ntrace \"simple clear forwarding\"\n${SSH} -F $OBJ/ssh_config -oClearAllForwardings=yes somehost true\n\ntrace \"clear local forward\"\nrm -f $CTL\n${SSH} -S $CTL -N -M -f -F $OBJ/ssh_config -L ${base}01:127.0.0.1:$PORT \\\n    -oClearAllForwardings=yes somehost\nif [ $? != 0 ]; then\n\tfail \"connection failed with cleared local forwarding\"\nelse\n\t# this one should fail\n\t${SSH} -F $OBJ/ssh_config -p ${base}01 somehost true \\\n\t     >>$TEST_REGRESS_LOGFILE 2>&1 && \\\n\t\tfail \"local forwarding not cleared\"\nfi\n${SSH} -F $OBJ/ssh_config -S $CTL -O exit somehost 2>/dev/null\n\ntrace \"clear remote forward\"\nrm -f $CTL\n${SSH} -S $CTL -N -M -f -F $OBJ/ssh_config -R ${base}01:127.0.0.1:$PORT \\\n    -oClearAllForwardings=yes somehost\nif [ $? != 0 ]; then\n\tfail \"connection failed with cleared remote forwarding\"\nelse\n\t# this one should fail\n\t${SSH} -F $OBJ/ssh_config -p ${base}01 somehost true \\\n\t     >>$TEST_REGRESS_LOGFILE 2>&1 && \\\n\t\tfail \"remote forwarding not cleared\"\nfi\n${SSH} -F $OBJ/ssh_config -S $CTL -O exit somehost 2>/dev/null\n\ntrace \"stdio forwarding\"\ncmd=\"${SSH} -F $OBJ/ssh_config\"\n$cmd -o \"ProxyCommand $cmd -q -W localhost:$PORT somehost\" somehost true\nif [ $? != 0 ]; then\n\tfail \"stdio forwarding\"\nfi\n\necho \"LocalForward ${base}01 127.0.0.1:$PORT\" >> $OBJ/ssh_config\necho \"RemoteForward ${base}02 127.0.0.1:${base}01\" >> $OBJ/ssh_config\n\ntrace \"config file: start forwarding, fork to background\"\nrm -f $CTL\n${SSH} -S $CTL -N -M -F $OBJ/ssh_config -f somehost\n\ntrace \"config file: transfer over forwarded channels and check result\"\n${SSH} -F $OBJ/ssh_config -p${base}02 -o 'ConnectionAttempts=10' \\\n\tsomehost cat ${DATA} > ${COPY}\ntest -s ${COPY}\t\t|| fail \"failed copy of ${DATA}\"\ncmp ${DATA} ${COPY}\t|| fail \"corrupted copy of ${DATA}\"\n\n${SSH} -F $OBJ/ssh_config -S $CTL -O exit somehost 2>/dev/null\n\ntrace \"transfer over chained unix domain socket forwards and check result\"\nrm -f $OBJ/unix-[123].fwd\nrm -f $CTL $CTL.[123]\n${SSH} -S $CTL -N -M -f -F $OBJ/ssh_config -R${base}01:[$OBJ/unix-1.fwd] somehost\n${SSH} -S $CTL.1 -N -M -f -F $OBJ/ssh_config -L[$OBJ/unix-1.fwd]:[$OBJ/unix-2.fwd] somehost\n${SSH} -S $CTL.2 -N -M -f -F $OBJ/ssh_config -R[$OBJ/unix-2.fwd]:[$OBJ/unix-3.fwd] somehost\n${SSH} -S $CTL.3 -N -M -f -F $OBJ/ssh_config -L[$OBJ/unix-3.fwd]:127.0.0.1:$PORT somehost\n${SSH} -F $OBJ/ssh_config -p${base}01 -o 'ConnectionAttempts=10' \\\n\tsomehost cat ${DATA} > ${COPY}\ntest -s ${COPY}\t\t\t|| fail \"failed copy ${DATA}\"\ncmp ${DATA} ${COPY}\t\t|| fail \"corrupted copy of ${DATA}\"\n\n${SSH} -F $OBJ/ssh_config -S $CTL -O exit somehost 2>/dev/null\n${SSH} -F $OBJ/ssh_config -S $CTL.1 -O exit somehost 2>/dev/null\n${SSH} -F $OBJ/ssh_config -S $CTL.2 -O exit somehost 2>/dev/null\n${SSH} -F $OBJ/ssh_config -S $CTL.3 -O exit somehost 2>/dev/null\n\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}