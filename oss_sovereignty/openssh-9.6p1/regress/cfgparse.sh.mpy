{
  "module_name": "cfgparse.sh",
  "hash_id": "6029bc7f985e89a4b6973e4bf4ec13b8706b1e058dc6afd40323e2f7911d770f",
  "original_prompt": "Ingested from openssh-9.6p1/regress/cfgparse.sh",
  "human_readable_source": "#\t$OpenBSD: cfgparse.sh,v 1.7 2018/05/11 03:51:06 dtucker Exp $\n#\tPlaced in the Public Domain.\n\ntid=\"sshd config parse\"\n\n# This is a reasonable proxy for IPv6 support.\nif ! config_defined HAVE_STRUCT_IN6_ADDR ; then\n\tSKIP_IPV6=yes\nfi\n\n# We need to use the keys generated for the regression test because sshd -T\n# will fail if we're not running with SUDO (no permissions for real keys) or\n# if we are running tests on a system that has never had sshd installed\n# because the keys won't exist.\n\ngrep \"HostKey \" $OBJ/sshd_config > $OBJ/sshd_config_minimal\nSSHD_KEYS=\"`cat $OBJ/sshd_config_minimal`\"\n\nverbose \"reparse minimal config\"\n($SUDO ${SSHD} -T -f $OBJ/sshd_config_minimal >$OBJ/sshd_config.1 &&\n $SUDO ${SSHD} -T -f $OBJ/sshd_config.1 >$OBJ/sshd_config.2 &&\n diff $OBJ/sshd_config.1 $OBJ/sshd_config.2) || fail \"reparse minimal config\"\n\nverbose \"reparse regress config\"\n($SUDO ${SSHD} -T -f $OBJ/sshd_config >$OBJ/sshd_config.1 &&\n $SUDO ${SSHD} -T -f $OBJ/sshd_config.1 >$OBJ/sshd_config.2 &&\n diff $OBJ/sshd_config.1 $OBJ/sshd_config.2) || fail \"reparse regress config\"\n\nverbose \"listenaddress order\"\n# expected output\ncat > $OBJ/sshd_config.0 <<EOD\nlistenaddress 1.2.3.4:1234\nlistenaddress 1.2.3.4:5678\nEOD\n[ X${SKIP_IPV6} = Xyes ] || cat >> $OBJ/sshd_config.0 <<EOD\nlistenaddress [::1]:1234\nlistenaddress [::1]:5678\nEOD\n\n# test input sets.  should all result in the output above.\n# test 1: addressfamily and port first\ncat > $OBJ/sshd_config.1 <<EOD\n${SSHD_KEYS}\naddressfamily any\nport 1234\nport 5678\nlistenaddress 1.2.3.4\nEOD\n[ X${SKIP_IPV6} = Xyes ] || cat >> $OBJ/sshd_config.1 <<EOD\nlistenaddress ::1\nEOD\n\n($SUDO ${SSHD} -T -f $OBJ/sshd_config.1 | \\\n grep 'listenaddress ' >$OBJ/sshd_config.2 &&\n diff $OBJ/sshd_config.0 $OBJ/sshd_config.2) || \\\n fail \"listenaddress order 1\"\n# test 2: listenaddress first\ncat > $OBJ/sshd_config.1 <<EOD\n${SSHD_KEYS}\nlistenaddress 1.2.3.4\nport 1234\nport 5678\naddressfamily any\nEOD\n[ X${SKIP_IPV6} = Xyes ] || cat >> $OBJ/sshd_config.1 <<EOD\nlistenaddress ::1\nEOD\n\n($SUDO ${SSHD} -T -f $OBJ/sshd_config.1 | \\\n grep 'listenaddress ' >$OBJ/sshd_config.2 &&\n diff $OBJ/sshd_config.0 $OBJ/sshd_config.2) || \\\n fail \"listenaddress order 2\"\n\n# cleanup\nrm -f $OBJ/sshd_config.[012]\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}