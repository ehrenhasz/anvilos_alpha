{
  "module_name": "sftp-uri.sh",
  "hash_id": "6e564032e63f586be452fe4994e7c72cab9702131402ed42dc1c56ec017526ad",
  "original_prompt": "Ingested from openssh-9.6p1/regress/sftp-uri.sh",
  "human_readable_source": "#\t$OpenBSD: sftp-uri.sh,v 1.1 2017/10/24 19:33:32 millert Exp $\n#\tPlaced in the Public Domain.\n\ntid=\"sftp-uri\"\n\n#set -x\n\nCOPY2=${OBJ}/copy2\nDIR=${COPY}.dd\nDIR2=${COPY}.dd2\nSRC=`dirname ${SCRIPT}`\n\nsftpclean() {\n\trm -rf ${COPY} ${COPY2} ${DIR} ${DIR2}\n\tmkdir ${DIR} ${DIR2}\n}\n\nstart_sshd -oForceCommand=\"internal-sftp -d /\"\n\n# Remove Port and User from ssh_config, we want to rely on the URI\ncp $OBJ/ssh_config $OBJ/ssh_config.orig\negrep -v '^\t+(Port|User)\t+.*$' $OBJ/ssh_config.orig > $OBJ/ssh_config\n\nverbose \"$tid: non-interactive fetch to local file\"\nsftpclean\n${SFTP} -q -S \"$SSH\" -F $OBJ/ssh_config \"sftp://${USER}@somehost:${PORT}/${DATA}\" ${COPY} || fail \"copy failed\"\ncmp ${DATA} ${COPY} || fail \"corrupted copy\"\n\nverbose \"$tid: non-interactive fetch to local dir\"\nsftpclean\ncp ${DATA} ${COPY}\n${SFTP} -q -S \"$SSH\" -F $OBJ/ssh_config \"sftp://${USER}@somehost:${PORT}/${COPY}\" ${DIR} || fail \"copy failed\"\ncmp ${COPY} ${DIR}/copy || fail \"corrupted copy\"\n\nverbose \"$tid: put to remote directory (trailing slash)\"\nsftpclean\n${SFTP} -q -S \"$SSH\" -F $OBJ/ssh_config -b - \\\n    \"sftp://${USER}@somehost:${PORT}/${DIR}/\" > /dev/null 2>&1 << EOF\n\tversion\n\tput ${DATA} copy\nEOF\nr=$?\nif [ $r -ne 0 ]; then\n\tfail \"sftp failed with $r\"\nelse\n\tcmp ${DATA} ${DIR}/copy || fail \"corrupted copy\"\nfi\n\nverbose \"$tid: put to remote directory (no slash)\"\nsftpclean\n${SFTP} -q -S \"$SSH\" -F $OBJ/ssh_config -b - \\\n    \"sftp://${USER}@somehost:${PORT}/${DIR}\" > /dev/null 2>&1 << EOF\n\tversion\n\tput ${DATA} copy\nEOF\nr=$?\nif [ $r -ne 0 ]; then\n\tfail \"sftp failed with $r\"\nelse\n\tcmp ${DATA} ${DIR}/copy || fail \"corrupted copy\"\nfi\n\nsftpclean\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}