{
  "module_name": "match-subsystem.sh",
  "hash_id": "405972b0bf293536cde83028e26d5ccac35bfa4183c54226127e2376dc7cbec0",
  "original_prompt": "Ingested from openssh-9.6p1/regress/match-subsystem.sh",
  "human_readable_source": "#\t$OpenBSD: match-subsystem.sh,v 1.1 2023/09/06 23:36:09 djm Exp $\n#\tPlaced in the Public Domain.\n\ntid=\"sshd_config match subsystem\"\n\ncp $OBJ/sshd_proxy $OBJ/sshd_proxy_bak\n\ntry_subsystem() {\n\t_id=$1\n\t_subsystem=$2\n\t_expect=$3\n\t${SSHD} -tf $OBJ/sshd_proxy || fatal \"$_id: bad config\"\n\t${SSH} -sF $OBJ/ssh_proxy somehost $_subsystem\n\t_exit=$?\n\ttrace \"$_id subsystem $_subsystem\"\n\tif [ $_exit -ne $_expect ] ; then\n\t\tfail \"$_id: subsystem $_subsystem exit $_exit expected $_expect\"\n\tfi\n\treturn $?\n}\n\n# Simple case: subsystem in main config.\ncp $OBJ/sshd_proxy_bak $OBJ/sshd_proxy\ncat >> $OBJ/sshd_proxy << _EOF\nSubsystem xxx /bin/sh -c \"exit 23\"\n_EOF\ntry_subsystem \"main config\" xxx 23\n\n# No clobber in main config.\ncp $OBJ/sshd_proxy_bak $OBJ/sshd_proxy\ncat >> $OBJ/sshd_proxy << _EOF\nSubsystem xxx /bin/sh -c \"exit 23\"\nSubsystem xxx /bin/sh -c \"exit 24\"\n_EOF\ntry_subsystem \"main config no clobber\" xxx 23\n\n# Subsystem in match all block\ncp $OBJ/sshd_proxy_bak $OBJ/sshd_proxy\ncat >> $OBJ/sshd_proxy << _EOF\nMatch all\nSubsystem xxx /bin/sh -c \"exit 21\"\n_EOF\ntry_subsystem \"match all\" xxx 21\n\n# No clobber in match all block\ncp $OBJ/sshd_proxy_bak $OBJ/sshd_proxy\ncat >> $OBJ/sshd_proxy << _EOF\nMatch all\nSubsystem xxx /bin/sh -c \"exit 21\"\nSubsystem xxx /bin/sh -c \"exit 24\"\n_EOF\ntry_subsystem \"match all no clobber\" xxx 21\n\n# Subsystem in match user block\ncp $OBJ/sshd_proxy_bak $OBJ/sshd_proxy\ncat >> $OBJ/sshd_proxy << _EOF\nMatch user *\nSubsystem xxx /bin/sh -c \"exit 20\"\n_EOF\ntry_subsystem \"match user\" xxx 20\n\n# No clobber in match user block\ncp $OBJ/sshd_proxy_bak $OBJ/sshd_proxy\ncat >> $OBJ/sshd_proxy << _EOF\nMatch user *\nSubsystem xxx /bin/sh -c \"exit 20\"\nSubsystem xxx /bin/sh -c \"exit 24\"\nMatch all\nSubsystem xxx /bin/sh -c \"exit 24\"\n_EOF\ntry_subsystem \"match user no clobber\" xxx 20\n\n# Override main with match all\ncp $OBJ/sshd_proxy_bak $OBJ/sshd_proxy\ncat >> $OBJ/sshd_proxy << _EOF\nSubsystem xxx /bin/sh -c \"exit 23\"\nMatch all\nSubsystem xxx /bin/sh -c \"exit 19\"\n_EOF\ntry_subsystem \"match all override\" xxx 19\n\n# Override main with match user\ncp $OBJ/sshd_proxy_bak $OBJ/sshd_proxy\ncat >> $OBJ/sshd_proxy << _EOF\nSubsystem xxx /bin/sh -c \"exit 23\"\nMatch user *\nSubsystem xxx /bin/sh -c \"exit 18\"\n_EOF\ntry_subsystem \"match user override\" xxx 18\n\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}