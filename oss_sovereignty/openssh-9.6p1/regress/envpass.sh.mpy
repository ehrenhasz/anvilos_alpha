{
  "module_name": "envpass.sh",
  "hash_id": "238bd9902c05da4df463eca4152491ff75fbfc553100088fc31e72a7b067585d",
  "original_prompt": "Ingested from openssh-9.6p1/regress/envpass.sh",
  "human_readable_source": "#\t$OpenBSD: envpass.sh,v 1.5 2022/06/03 04:31:54 djm Exp $\n#\tPlaced in the Public Domain.\n\ntid=\"environment passing\"\n\n# NB accepted env vars are in test-exec.sh (_XXX_TEST_* and _XXX_TEST)\n\n# Prepare a custom config to test for a configuration parsing bug fixed in 4.0\ncat << EOF > $OBJ/ssh_proxy_envpass\nHost test-sendenv-confparse-bug\n\tSendEnv *\nEOF\ncat $OBJ/ssh_proxy >> $OBJ/ssh_proxy_envpass\ncp $OBJ/sshd_proxy $OBJ/sshd_proxy_bak\n\ntrace \"pass env, don't accept\"\nverbose \"test $tid: pass env, don't accept\"\n_TEST_ENV=blah ${SSH} -oSendEnv=\"*\" -F $OBJ/ssh_proxy_envpass otherhost \\\n\tsh << 'EOF'\n\ttest -z \"$_TEST_ENV\"\nEOF\nr=$?\nif [ $r -ne 0 ]; then\n\tfail \"environment found\"\nfi\n\ntrace \"setenv, don't accept\"\nverbose \"test $tid: setenv, don't accept\"\n${SSH} -oSendEnv=\"*\" -F $OBJ/ssh_proxy_envpass -oSetEnv=\"_TEST_ENV=blah\" \\\n    otherhost \\\n\tsh << 'EOF'\n\ttest -z \"$_TEST_ENV\"\nEOF\nr=$?\nif [ $r -ne 0 ]; then\n\tfail \"environment found\"\nfi\n\ntrace \"don't pass env, accept\"\nverbose \"test $tid: don't pass env, accept\"\n_XXX_TEST_A=1 _XXX_TEST_B=2 ${SSH} -F $OBJ/ssh_proxy_envpass otherhost \\\n\tsh << 'EOF'\n\ttest -z \"$_XXX_TEST_A\" && test -z \"$_XXX_TEST_B\"\nEOF\nr=$?\nif [ $r -ne 0 ]; then\n\tfail \"environment found\"\nfi\n\ntrace \"pass single env, accept single env\"\nverbose \"test $tid: pass single env, accept single env\"\n_XXX_TEST=blah ${SSH} -oSendEnv=\"_XXX_TEST\" -F $OBJ/ssh_proxy_envpass \\\n    otherhost sh << 'EOF'\n\ttest X\"$_XXX_TEST\" = X\"blah\"\nEOF\nr=$?\nif [ $r -ne 0 ]; then\n\tfail \"environment not found\"\nfi\n\ntrace \"pass multiple env, accept multiple env\"\nverbose \"test $tid: pass multiple env, accept multiple env\"\n_XXX_TEST_A=1 _XXX_TEST_B=2 ${SSH} -oSendEnv=\"_XXX_TEST_*\" \\\n    -F $OBJ/ssh_proxy_envpass otherhost \\\n\tsh << 'EOF'\n\ttest X\"$_XXX_TEST_A\" = X\"1\" -a X\"$_XXX_TEST_B\" = X\"2\"\nEOF\nr=$?\nif [ $r -ne 0 ]; then\n\tfail \"environment not found\"\nfi\n\ntrace \"setenv, accept\"\nverbose \"test $tid: setenv, accept\"\n${SSH} -F $OBJ/ssh_proxy_envpass \\\n    -oSetEnv=\"_XXX_TEST_A=1 _XXX_TEST_B=2\" otherhost \\\n\tsh << 'EOF'\n\ttest X\"$_XXX_TEST_A\" = X\"1\" -a X\"$_XXX_TEST_B\" = X\"2\"\nEOF\nr=$?\nif [ $r -ne 0 ]; then\n\tfail \"environment not found\"\nfi\ntrace \"setenv, first match wins\"\nverbose \"test $tid: setenv, first match wins\"\n${SSH} -F $OBJ/ssh_proxy_envpass \\\n    -oSetEnv=\"_XXX_TEST_A=1 _XXX_TEST_A=11 _XXX_TEST_B=2\" otherhost \\\n\tsh << 'EOF'\n\ttest X\"$_XXX_TEST_A\" = X\"1\" -a X\"$_XXX_TEST_B\" = X\"2\"\nEOF\nr=$?\nif [ $r -ne 0 ]; then\n\tfail \"environment not found\"\nfi\n\ntrace \"server setenv wins\"\nverbose \"test $tid: server setenv wins\"\ncp $OBJ/sshd_proxy_bak $OBJ/sshd_proxy\necho \"SetEnv _XXX_TEST_A=23\" >> $OBJ/sshd_proxy\n${SSH} -F $OBJ/ssh_proxy_envpass \\\n    -oSetEnv=\"_XXX_TEST_A=1 _XXX_TEST_B=2\" otherhost \\\n\tsh << 'EOF'\n\ttest X\"$_XXX_TEST_A\" = X\"23\" -a X\"$_XXX_TEST_B\" = X\"2\"\nEOF\nr=$?\nif [ $r -ne 0 ]; then\n\tfail \"environment not found\"\nfi\n\ntrace \"server setenv first match wins\"\nverbose \"test $tid: server setenv wins\"\ncp $OBJ/sshd_proxy_bak $OBJ/sshd_proxy\necho \"SetEnv _XXX_TEST_A=23 _XXX_TEST_A=42\" >> $OBJ/sshd_proxy\n${SSH} -F $OBJ/ssh_proxy_envpass \\\n    -oSetEnv=\"_XXX_TEST_A=1 _XXX_TEST_B=2\" otherhost \\\n\tsh << 'EOF'\n\ttest X\"$_XXX_TEST_A\" = X\"23\" -a X\"$_XXX_TEST_B\" = X\"2\"\nEOF\nr=$?\nif [ $r -ne 0 ]; then\n\tfail \"environment not found\"\nfi\n\n\nrm -f $OBJ/ssh_proxy_envpass\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}