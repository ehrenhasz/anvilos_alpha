{
  "module_name": "hostbased.sh",
  "hash_id": "f27d21ac712c040e240b95671d83c86801dc953663822e21e3ffa9624512b304",
  "original_prompt": "Ingested from openssh-9.6p1/regress/hostbased.sh",
  "human_readable_source": "#\t$OpenBSD: hostbased.sh,v 1.4 2022/12/07 11:45:43 dtucker Exp $\n#\tPlaced in the Public Domain.\n\n# This test requires external setup and thus is skipped unless\n# TEST_SSH_HOSTBASED_AUTH and SUDO are set to \"yes\".\n# Since ssh-keysign has key paths hard coded, unlike the other tests it\n# needs to use the real host keys. It requires:\n# - ssh-keysign must be installed and setuid.\n# - \"EnableSSHKeysign yes\" must be in the system ssh_config.\n# - the system's own real FQDN the system-wide shosts.equiv.\n# - the system's real public key fingerprints must be in global ssh_known_hosts.\n#\ntid=\"hostbased\"\n\nif [ -z \"${TEST_SSH_HOSTBASED_AUTH}\" ]; then\n\tskip \"TEST_SSH_HOSTBASED_AUTH not set.\"\nelif [ -z \"${SUDO}\" ]; then\n\tskip \"SUDO not set\"\nfi\n\n# Enable all supported hostkey algos (but no others)\nhostkeyalgos=`${SSH} -Q HostKeyAlgorithms | tr '\\n' , | sed 's/,$//'`\n\ncat >>$OBJ/sshd_proxy <<EOD\nHostbasedAuthentication yes\nHostbasedAcceptedAlgorithms $hostkeyalgos\nHostbasedUsesNameFromPacketOnly yes\nHostKeyAlgorithms $hostkeyalgos\nEOD\n\ncat >>$OBJ/ssh_proxy <<EOD\nHostbasedAuthentication yes\nHostKeyAlgorithms $hostkeyalgos\nHostbasedAcceptedAlgorithms $hostkeyalgos\nPreferredAuthentications hostbased\nEOD\n\nalgos=\"\"\nfor key in `${SUDO} ${SSHD} -T | awk '$1==\"hostkey\"{print $2}'`; do\n\tcase \"`$SSHKEYGEN -l -f ${key}.pub`\" in\n\t256*ECDSA*)\talgos=\"$algos ecdsa-sha2-nistp256\" ;;\n\t384*ECDSA*)\talgos=\"$algos ecdsa-sha2-nistp384\" ;;\n\t521*ECDSA*)\talgos=\"$algos ecdsa-sha2-nistp521\" ;;\n\t*RSA*)\t\talgos=\"$algos ssh-rsa rsa-sha2-256 rsa-sha2-512\" ;;\n\t*ED25519*)\talgos=\"$algos ssh-ed25519\" ;;\n\t*DSA*)\t\talgos=\"$algos ssh-dss\" ;;\n\t*) verbose \"unknown host key type $key\" ;;\n\tesac\ndone\n\nfor algo in $algos; do\n\ttrace \"hostbased algo $algo\"\n\topts=\"-F $OBJ/ssh_proxy\"\n\tif [ \"x$algo\" != \"xdefault\" ]; then\n\t\topts=\"$opts -oHostbasedAcceptedAlgorithms=$algo\"\n\tfi\n\tSSH_CONNECTION=`${SSH} $opts localhost 'echo $SSH_CONNECTION'`\n\tif [ $? -ne 0 ]; then\n\t\tfail \"connect failed, hostbased algo $algo\"\n\telif [ \"$SSH_CONNECTION\" != \"UNKNOWN 65535 UNKNOWN 65535\" ]; then\n\t\tfail \"hostbased algo $algo bad SSH_CONNECTION\" \\\n\t\t    \"$SSH_CONNECTION\"\n\telse\n\t\tverbose \"ok hostbased algo $algo\"\n\tfi\ndone\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}