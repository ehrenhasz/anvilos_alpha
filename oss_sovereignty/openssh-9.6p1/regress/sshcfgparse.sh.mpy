{
  "module_name": "sshcfgparse.sh",
  "hash_id": "abdb249048c98939514b075bf4c9077f48eade95c517faca9e76044944df7798",
  "original_prompt": "Ingested from openssh-9.6p1/regress/sshcfgparse.sh",
  "human_readable_source": "#\t$OpenBSD: sshcfgparse.sh,v 1.9 2021/06/08 07:05:27 dtucker Exp $\n#\tPlaced in the Public Domain.\n\ntid=\"ssh config parse\"\n\ndsa=0\nfor t in $SSH_KEYTYPES; do\n\tcase \"$t\" in\n\t\tssh-dss)\tdsa=1 ;;\n\tesac\ndone\n\nexpect_result_present() {\n\t_str=\"$1\" ; shift\n\tfor _expect in \"$@\" ; do\n\t\techo \"$f\" | tr ',' '\\n' | grep \"^$_expect\\$\" >/dev/null\n\t\tif test $? -ne 0 ; then\n\t\t\tfail \"missing expected \\\"$_expect\\\" from \\\"$_str\\\"\"\n\t\tfi\n\tdone\n}\nexpect_result_absent() {\n\t_str=\"$1\" ; shift\n\tfor _expect in \"$@\" ; do\n\t\techo \"$f\" | tr ',' '\\n' | grep \"^$_expect\\$\" >/dev/null\n\t\tif test $? -eq 0 ; then\n\t\t\tfail \"unexpected \\\"$_expect\\\" present in \\\"$_str\\\"\"\n\t\tfi\n\tdone\n}\n\nverbose \"reparse minimal config\"\n(${SSH} -G -F $OBJ/ssh_config somehost >$OBJ/ssh_config.1 &&\n ${SSH} -G -F $OBJ/ssh_config.1 somehost >$OBJ/ssh_config.2 &&\n diff $OBJ/ssh_config.1 $OBJ/ssh_config.2) || fail \"failed to reparse minimal\"\n\nverbose \"ssh -W opts\"\nf=`${SSH} -GF $OBJ/ssh_config host | awk '/exitonforwardfailure/{print $2}'`\ntest \"$f\" = \"no\" || fail \"exitonforwardfailure default\"\nf=`${SSH} -GF $OBJ/ssh_config -W a:1 h | awk '/exitonforwardfailure/{print $2}'`\ntest \"$f\" = \"yes\" || fail \"exitonforwardfailure enable\"\nf=`${SSH} -GF $OBJ/ssh_config -W a:1 -o exitonforwardfailure=no h | \\\n    awk '/exitonforwardfailure/{print $2}'`\ntest \"$f\" = \"no\" || fail \"exitonforwardfailure override\"\n\nf=`${SSH} -GF $OBJ/ssh_config host | awk '/clearallforwardings/{print $2}'`\ntest \"$f\" = \"no\" || fail \"clearallforwardings default\"\nf=`${SSH} -GF $OBJ/ssh_config -W a:1 h | awk '/clearallforwardings/{print $2}'`\ntest \"$f\" = \"yes\" || fail \"clearallforwardings enable\"\nf=`${SSH} -GF $OBJ/ssh_config -W a:1 -o clearallforwardings=no h | \\\n    awk '/clearallforwardings/{print $2}'`\ntest \"$f\" = \"no\" || fail \"clearallforwardings override\"\n\nverbose \"user first match\"\nuser=`awk '$1==\"User\" {print $2}' $OBJ/ssh_config`\nf=`${SSH} -GF $OBJ/ssh_config host | awk '/^user /{print $2}'`\ntest \"$f\" = \"$user\" || fail \"user from config, expected '$user' got '$f'\"\nf=`${SSH} -GF $OBJ/ssh_config -o user=foo -l bar baz@host | awk '/^user /{print $2}'`\ntest \"$f\" = \"foo\" || fail \"user first match -oUser, expected 'foo' got '$f' \"\nf=`${SSH} -GF $OBJ/ssh_config -lbar baz@host user=foo baz@host | awk '/^user /{print $2}'`\ntest \"$f\" = \"bar\" || fail \"user first match -l, expected 'bar' got '$f'\"\nf=`${SSH} -GF $OBJ/ssh_config baz@host -o user=foo -l bar baz@host | awk '/^user /{print $2}'`\ntest \"$f\" = \"baz\" || fail \"user first match user@host, expected 'baz' got '$f'\"\n\nverbose \"pubkeyacceptedalgorithms\"\n# Default set\nf=`${SSH} -GF none host | awk '/^pubkeyacceptedalgorithms /{print $2}'`\nexpect_result_present \"$f\" \"ssh-ed25519\" \"ssh-ed25519-cert-v01.*\"\nexpect_result_absent \"$f\" \"ssh-dss\"\n# Explicit override\nf=`${SSH} -GF none -opubkeyacceptedalgorithms=ssh-ed25519 host | \\\n    awk '/^pubkeyacceptedalgorithms /{print $2}'`\nexpect_result_present \"$f\" \"ssh-ed25519\"\nexpect_result_absent \"$f\" \"ssh-ed25519-cert-v01.*\" \"ssh-dss\"\n# Removal from default set\nf=`${SSH} -GF none -opubkeyacceptedalgorithms=-ssh-ed25519-cert* host | \\\n    awk '/^pubkeyacceptedalgorithms /{print $2}'`\nexpect_result_present \"$f\" \"ssh-ed25519\"\nexpect_result_absent \"$f\" \"ssh-ed25519-cert-v01.*\" \"ssh-dss\"\nf=`${SSH} -GF none -opubkeyacceptedalgorithms=-ssh-ed25519 host | \\\n    awk '/^pubkeyacceptedalgorithms /{print $2}'`\nexpect_result_present \"$f\" \"ssh-ed25519-cert-v01.*\"\nexpect_result_absent \"$f\" \"ssh-ed25519\" \"ssh-dss\"\n# Append to default set.\n# This is not tested when built !WITH_OPENSSL\nif [ \"$dsa\" = \"1\" ]; then\n\tf=`${SSH} -GF none -opubkeyacceptedalgorithms=+ssh-dss-cert* host | \\\n\t    awk '/^pubkeyacceptedalgorithms /{print $2}'`\n\texpect_result_present \"$f\" \"ssh-ed25519\" \"ssh-dss-cert-v01.*\"\n\texpect_result_absent \"$f\" \"ssh-dss\"\n\tf=`${SSH} -GF none -opubkeyacceptedalgorithms=+ssh-dss host | \\\n\t    awk '/^pubkeyacceptedalgorithms /{print $2}'`\n\texpect_result_present \"$f\" \"ssh-ed25519\" \"ssh-ed25519-cert-v01.*\" \"ssh-dss\"\n\texpect_result_absent \"$f\" \"ssh-dss-cert-v01.*\"\nfi\n\nverbose \"agentforwarding\"\nf=`${SSH} -GF none host | awk '/^forwardagent /{print$2}'`\nexpect_result_present \"$f\" \"no\"\nf=`${SSH} -GF none -oforwardagent=no host | awk '/^forwardagent /{print$2}'`\nexpect_result_present \"$f\" \"no\"\nf=`${SSH} -GF none -oforwardagent=yes host | awk '/^forwardagent /{print$2}'`\nexpect_result_present \"$f\" \"yes\"\nf=`${SSH} -GF none '-oforwardagent=SSH_AUTH_SOCK.forward' host | awk '/^forwardagent /{print$2}'`\nexpect_result_present \"$f\" \"SSH_AUTH_SOCK.forward\"\n\nverbose \"command line override\"\ncat >$OBJ/ssh_config.0 <<EOD\nHost *\n    IPQoS af21 cs1\n    TunnelDevice 1:2\nEOD\nf=`${SSH} -GF $OBJ/ssh_config.0 -oipqos=cs1 host | awk '/^ipqos /{print$2}'`\nexpect_result_present \"$f\" \"cs1\"\nf=`${SSH} -GF $OBJ/ssh_config.0 -otunneldevice=3:4 host | awk '/^tunneldevice /{print$2}'`\nexpect_result_present \"$f\" \"3:4\"\n\n# cleanup\nrm -f $OBJ/ssh_config.[012]\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}