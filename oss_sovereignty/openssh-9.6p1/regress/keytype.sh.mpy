{
  "module_name": "keytype.sh",
  "hash_id": "cd6e017153ffcb27d38d3aed6525c545a870e344a5aa28bb0da12d3469667d80",
  "original_prompt": "Ingested from openssh-9.6p1/regress/keytype.sh",
  "human_readable_source": "#\t$OpenBSD: keytype.sh,v 1.11 2021/02/25 03:27:34 djm Exp $\n#\tPlaced in the Public Domain.\n\ntid=\"login with different key types\"\n\ncp $OBJ/sshd_proxy $OBJ/sshd_proxy_bak\ncp $OBJ/ssh_proxy $OBJ/ssh_proxy_bak\n\n# Construct list of key types based on what the built binaries support.\nktypes=\"\"\nfor i in ${SSH_KEYTYPES}; do\n\tcase \"$i\" in\n\t\tssh-dss)\t\tktypes=\"$ktypes dsa-1024\" ;;\n\t\tssh-rsa)\t\tktypes=\"$ktypes rsa-2048 rsa-3072\" ;;\n\t\tssh-ed25519)\t\tktypes=\"$ktypes ed25519-512\" ;;\n\t\tecdsa-sha2-nistp256)\tktypes=\"$ktypes ecdsa-256\" ;;\n\t\tecdsa-sha2-nistp384)\tktypes=\"$ktypes ecdsa-384\" ;;\n\t\tecdsa-sha2-nistp521)\tktypes=\"$ktypes ecdsa-521\" ;;\n\t\tsk-ssh-ed25519*)\tktypes=\"$ktypes ed25519-sk\" ;;\n\t\tsk-ecdsa-sha2-nistp256*) ktypes=\"$ktypes ecdsa-sk\" ;;\n\tesac\ndone\n\nfor kt in $ktypes; do\n\trm -f $OBJ/key.$kt\n\txbits=`echo ${kt} | awk -F- '{print $2}'`\n\txtype=`echo ${kt}  | awk -F- '{print $1}'`\n\tcase \"$kt\" in\n\t*sk)\ttype=\"$kt\"; bits=\"n/a\"; bits_arg=\"\";;\n\t*)\ttype=$xtype; bits=$xbits; bits_arg=\"-b $bits\";;\n\tesac\n\tverbose \"keygen $type, $bits bits\"\n\t${SSHKEYGEN} $bits_arg -q -N '' -t $type  -f $OBJ/key.$kt || \\\n\t\tfail \"ssh-keygen for type $type, $bits bits failed\"\ndone\n\nkname_to_ktype() {\n\tcase $1 in\n\tdsa-1024)\techo ssh-dss;;\n\tecdsa-256)\techo ecdsa-sha2-nistp256;;\n\tecdsa-384)\techo ecdsa-sha2-nistp384;;\n\tecdsa-521)\techo ecdsa-sha2-nistp521;;\n\ted25519-512)\techo ssh-ed25519;;\n\trsa-*)\t\techo rsa-sha2-512,rsa-sha2-256,ssh-rsa;;\n\ted25519-sk)\techo sk-ssh-ed25519@openssh.com;;\n\tecdsa-sk)\techo sk-ecdsa-sha2-nistp256@openssh.com;;\n\tesac\n}\n\ntries=\"1 2 3\"\nfor ut in $ktypes; do\n\tuser_type=`kname_to_ktype \"$ut\"`\n\thtypes=\"$ut\"\n\t#htypes=$ktypes\n\tfor ht in $htypes; do\n\t\thost_type=`kname_to_ktype \"$ht\"`\n\t\ttrace \"ssh connect, userkey $ut, hostkey $ht\"\n\t\t(\n\t\t\tgrep -v HostKey $OBJ/sshd_proxy_bak\n\t\t\techo HostKey $OBJ/key.$ht\n\t\t\techo PubkeyAcceptedAlgorithms $user_type\n\t\t\techo HostKeyAlgorithms $host_type\n\t\t) > $OBJ/sshd_proxy\n\t\t(\n\t\t\tgrep -v IdentityFile $OBJ/ssh_proxy_bak\n\t\t\techo IdentityFile $OBJ/key.$ut\n\t\t\techo PubkeyAcceptedAlgorithms $user_type\n\t\t\techo HostKeyAlgorithms $host_type\n\t\t) > $OBJ/ssh_proxy\n\t\t(\n\t\t\tprintf 'localhost-with-alias,127.0.0.1,::1 '\n\t\t\tcat $OBJ/key.$ht.pub\n\t\t) > $OBJ/known_hosts\n\t\tcat $OBJ/key.$ut.pub > $OBJ/authorized_keys_$USER\n\t\tfor i in $tries; do\n\t\t\tverbose \"userkey $ut, hostkey ${ht}\"\n\t\t\t${SSH} -F $OBJ/ssh_proxy 999.999.999.999 true\n\t\t\tif [ $? -ne 0 ]; then\n\t\t\t\tfail \"ssh userkey $ut, hostkey $ht failed\"\n\t\t\tfi\n\t\tdone\n\tdone\ndone\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}