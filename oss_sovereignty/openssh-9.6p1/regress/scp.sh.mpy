{
  "module_name": "scp.sh",
  "hash_id": "3d12fd0a8e7df94aadda2e4f723cd036e16ed598923c377cae8e79d27e900c36",
  "original_prompt": "Ingested from openssh-9.6p1/regress/scp.sh",
  "human_readable_source": "#\t$OpenBSD: scp.sh,v 1.19 2023/09/08 05:50:57 djm Exp $\n#\tPlaced in the Public Domain.\n\ntid=\"scp\"\n\n#set -x\n\nCOPY2=${OBJ}/copy2\nDIR=${COPY}.dd\nDIR2=${COPY}.dd2\nCOPY3=${OBJ}/copy.glob[123]\nDIR3=${COPY}.dd.glob[456]\nDIFFOPT=\"-rN\"\n\n# Figure out if diff does not understand \"-N\"\nif ! diff -N ${SRC}/scp.sh ${SRC}/scp.sh 2>/dev/null; then\n\tDIFFOPT=\"-r\"\nfi\n\nmaybe_add_scp_path_to_sshd\n\nSRC=`dirname ${SCRIPT}`\ncp ${SRC}/scp-ssh-wrapper.sh ${OBJ}/scp-ssh-wrapper.scp\nchmod 755 ${OBJ}/scp-ssh-wrapper.scp\nexport SCP # used in scp-ssh-wrapper.scp\n\nscpclean() {\n\trm -rf ${COPY} ${COPY2} ${DIR} ${DIR2} ${COPY3} ${DIR3}\n\tmkdir ${DIR} ${DIR2} ${DIR3}\n\tchmod 755 ${DIR} ${DIR2} ${DIR3}\n}\n\n# Create directory structure for recursive copy tests.\nforest() {\n\tscpclean\n\trm -rf ${DIR2}\n\tcp ${DATA} ${DIR}/copy\n\tln -s ${DIR}/copy ${DIR}/copy-sym\n\tmkdir ${DIR}/subdir\n\tcp ${DATA} ${DIR}/subdir/copy\n\tln -s ${DIR}/subdir ${DIR}/subdir-sym\n}\n\nfor mode in scp sftp ; do\n\ttag=\"$tid: $mode mode\"\n\tif test $mode = scp ; then\n\t\tscpopts=\"-O -q -S ${OBJ}/scp-ssh-wrapper.scp\"\n\telse\n\t\tscpopts=\"-qs -D ${SFTPSERVER}\"\n\tfi\n\n\tverbose \"$tag: simple copy local file to local file\"\n\tscpclean\n\t$SCP $scpopts ${DATA} ${COPY} || fail \"copy failed\"\n\tcmp ${DATA} ${COPY} || fail \"corrupted copy\"\n\n\tverbose \"$tag: simple copy local file to remote file\"\n\tscpclean\n\t$SCP $scpopts ${DATA} somehost:${COPY} || fail \"copy failed\"\n\tcmp ${DATA} ${COPY} || fail \"corrupted copy\"\n\n\tverbose \"$tag: simple copy remote file to local file\"\n\tscpclean\n\t$SCP $scpopts somehost:${DATA} ${COPY} || fail \"copy failed\"\n\tcmp ${DATA} ${COPY} || fail \"corrupted copy\"\n\n\tverbose \"$tag: copy local file to remote file in place\"\n\tscpclean\n\tcp ${DATA} ${COPY}\n\t$SCP $scpopts ${COPY} somehost:${COPY} || fail \"copy failed\"\n\tcmp ${DATA} ${COPY} || fail \"corrupted copy\"\n\n\tverbose \"$tag: copy remote file to local file in place\"\n\tscpclean\n\tcp ${DATA} ${COPY}\n\t$SCP $scpopts somehost:${COPY} ${COPY} || fail \"copy failed\"\n\tcmp ${DATA} ${COPY} || fail \"corrupted copy\"\n\n\tverbose \"$tag: copy local file to remote file clobber\"\n\tscpclean\n\tcat ${DATA} ${DATA} > ${COPY}\n\t$SCP $scpopts ${DATA} somehost:${COPY} || fail \"copy failed\"\n\tls -l $DATA $COPY\n\tcmp ${DATA} ${COPY} || fail \"corrupted copy\"\n\n\tverbose \"$tag: copy remote file to local file clobber\"\n\tscpclean\n\tcat ${DATA} ${DATA} > ${COPY}\n\t$SCP $scpopts somehost:${DATA} ${COPY} || fail \"copy failed\"\n\tcmp ${DATA} ${COPY} || fail \"corrupted copy\"\n\n\tverbose \"$tag: simple copy local file to remote dir\"\n\tscpclean\n\tcp ${DATA} ${COPY}\n\t$SCP $scpopts ${COPY} somehost:${DIR} || fail \"copy failed\"\n\tcmp ${COPY} ${DIR}/copy || fail \"corrupted copy\"\n\n\tverbose \"$tag: simple copy local file to local dir\"\n\tscpclean\n\tcp ${DATA} ${COPY}\n\t$SCP $scpopts ${COPY} ${DIR} || fail \"copy failed\"\n\tcmp ${COPY} ${DIR}/copy || fail \"corrupted copy\"\n\n\tverbose \"$tag: simple copy remote file to local dir\"\n\tscpclean\n\tcp ${DATA} ${COPY}\n\t$SCP $scpopts somehost:${COPY} ${DIR} || fail \"copy failed\"\n\tcmp ${COPY} ${DIR}/copy || fail \"corrupted copy\"\n\n\tverbose \"$tag: recursive local dir to remote dir\"\n\tforest\n\t$SCP $scpopts -r ${DIR} somehost:${DIR2} || fail \"copy failed\"\n\tdiff ${DIFFOPT} ${DIR} ${DIR2} || fail \"corrupted copy\"\n\n\tverbose \"$tag: recursive local dir to local dir\"\n\tforest\n\trm -rf ${DIR2}\n\tcp ${DATA} ${DIR}/copy\n\t$SCP $scpopts -r ${DIR} ${DIR2} || fail \"copy failed\"\n\tdiff ${DIFFOPT} ${DIR} ${DIR2} || fail \"corrupted copy\"\n\n\tverbose \"$tag: recursive remote dir to local dir\"\n\tforest\n\trm -rf ${DIR2}\n\tcp ${DATA} ${DIR}/copy\n\t$SCP $scpopts -r somehost:${DIR} ${DIR2} || fail \"copy failed\"\n\tdiff ${DIFFOPT} ${DIR} ${DIR2} || fail \"corrupted copy\"\n\n\tverbose \"$tag: unmatched glob file local->remote\"\n\tscpclean\n\t$SCP $scpopts ${DATA} somehost:${COPY3} || fail \"copy failed\"\n\tcmp ${DATA} ${COPY3} || fail \"corrupted copy\"\n\n\tverbose \"$tag: unmatched glob file remote->local\"\n\t# NB. no clean\n\t$SCP $scpopts somehost:${COPY3} ${COPY2} || fail \"copy failed\"\n\tcmp ${DATA} ${COPY2} || fail \"corrupted copy\"\n\n\tverbose \"$tag: unmatched glob dir recursive local->remote\"\n\tscpclean\n\trm -rf ${DIR3}\n\tcp ${DATA} ${DIR}/copy\n\tcp ${DATA} ${DIR}/copy.glob[1234]\n\t$SCP $scpopts -r ${DIR} somehost:${DIR3} || fail \"copy failed\"\n\tdiff ${DIFFOPT} ${DIR} ${DIR3} || fail \"corrupted copy\"\n\n\tverbose \"$tag: unmatched glob dir recursive remote->local\"\n\t# NB. no clean\n\trm -rf ${DIR2}\n\t$SCP $scpopts -r somehost:${DIR3} ${DIR2} || fail \"copy failed\"\n\tdiff ${DIFFOPT} ${DIR} ${DIR2} || fail \"corrupted copy\"\n\n\tverbose \"$tag: shell metacharacters\"\n\tscpclean\n\t(cd ${DIR} && \\\n\t touch '`touch metachartest`' && \\\n\t $SCP $scpopts *metachar* ${DIR2} 2>/dev/null; \\\n\t [ ! -f metachartest ] ) || fail \"shell metacharacters\"\n\n\tif [ ! -z \"$SUDO\" ]; then\n\t\tverbose \"$tag: skipped file after scp -p with failed chown+utimes\"\n\t\tscpclean\n\t\tcp -p ${DATA} ${DIR}/copy\n\t\tcp -p ${DATA} ${DIR}/copy2\n\t\tcp ${DATA} ${DIR2}/copy\n\t\tchmod 660 ${DIR2}/copy\n\t\t$SUDO chown root ${DIR2}/copy\n\t\t$SCP -p $scpopts somehost:${DIR}/\\* ${DIR2} >/dev/null 2>&1\n\t\t$SUDO diff ${DIFFOPT} ${DIR} ${DIR2} || fail \"corrupted copy\"\n\t\t$SUDO rm ${DIR2}/copy\n\tfi\n\n\tfor i in 0 1 2 3 4 5 6 7; do\n\t\tverbose \"$tag: disallow bad server #$i\"\n\t\tSCPTESTMODE=badserver_$i\n\t\texport DIR SCPTESTMODE\n\t\tscpclean\n\t\t$SCP $scpopts somehost:${DATA} ${DIR} >/dev/null 2>/dev/null\n\t\t[ -d {$DIR}/rootpathdir ] && fail \"allows dir relative to root dir\"\n\t\t[ -d ${DIR}/dotpathdir ] && fail \"allows dir creation in non-recursive mode\"\n\n\t\tscpclean\n\t\t$SCP -r $scpopts somehost:${DATA} ${DIR2} >/dev/null 2>/dev/null\n\t\t[ -d ${DIR}/dotpathdir ] && fail \"allows dir creation outside of subdir\"\n\n\t\tscpclean\n\t\t$SCP -pr $scpopts somehost:${DATA} ${DIR2} >/dev/null 2>/dev/null\n\t\t[ ! -w ${DIR2} ] && fail \"allows target root attribute change\"\n\n\t\tscpclean\n\t\t$SCP $scpopts somehost:${DATA} ${DIR2} >/dev/null 2>/dev/null\n\t\t[ -e ${DIR2}/extrafile ] && fail \"allows unauth object creation\"\n\t\trm -f ${DIR2}/extrafile\n\tdone\n\n\tverbose \"$tag: detect non-directory target\"\n\tscpclean\n\techo a > ${COPY}\n\techo b > ${COPY2}\n\t$SCP $scpopts ${DATA} ${COPY} ${COPY2}\n\tcmp ${COPY} ${COPY2} >/dev/null && fail \"corrupt target\"\ndone\n\nscpclean\nrm -f ${OBJ}/scp-ssh-wrapper.scp\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}