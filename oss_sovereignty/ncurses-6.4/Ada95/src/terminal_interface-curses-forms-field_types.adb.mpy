{
  "module_name": "terminal_interface-curses-forms-field_types.adb",
  "hash_id": "304322bb816a0428c561c7a37b62a4059afe55bc0581bc96bc8133057a82c481",
  "original_prompt": "Ingested from ncurses-6.4/Ada95/src/terminal_interface-curses-forms-field_types.adb",
  "human_readable_source": "------------------------------------------------------------------------------\n--                                                                          --\n--                           GNAT ncurses Binding                           --\n--                                                                          --\n--                 Terminal_Interface.Curses.Forms.Field_Types              --\n--                                                                          --\n--                                 B O D Y                                  --\n--                                                                          --\n------------------------------------------------------------------------------\n-- Copyright 2020 Thomas E. Dickey                                          --\n-- Copyright 1999-2011,2014 Free Software Foundation, Inc.                  --\n--                                                                          --\n-- Permission is hereby granted, free of charge, to any person obtaining a  --\n-- copy of this software and associated documentation files (the            --\n-- \"Software\"), to deal in the Software without restriction, including      --\n-- without limitation the rights to use, copy, modify, merge, publish,      --\n-- distribute, distribute with modifications, sublicense, and/or sell       --\n-- copies of the Software, and to permit persons to whom the Software is    --\n-- furnished to do so, subject to the following conditions:                 --\n--                                                                          --\n-- The above copyright notice and this permission notice shall be included  --\n-- in all copies or substantial portions of the Software.                   --\n--                                                                          --\n-- THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS  --\n-- OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF               --\n-- MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.   --\n-- IN NO EVENT SHALL THE ABOVE COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,   --\n-- DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR    --\n-- OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR    --\n-- THE USE OR OTHER DEALINGS IN THE SOFTWARE.                               --\n--                                                                          --\n-- Except as contained in this notice, the name(s) of the above copyright   --\n-- holders shall not be used in advertising or otherwise to promote the     --\n-- sale, use or other dealings in this Software without prior written       --\n-- authorization.                                                           --\n------------------------------------------------------------------------------\n--  Author:  Juergen Pfeifer, 1996\n--  Version Control:\n--  $Revision: 1.29 $\n--  $Date: 2020/02/02 23:34:34 $\n--  Binding Version 01.00\n------------------------------------------------------------------------------\nwith Terminal_Interface.Curses.Aux; use Terminal_Interface.Curses.Aux;\nwith Ada.Unchecked_Deallocation;\nwith System.Address_To_Access_Conversions;\n\n--  |\n--  |=====================================================================\n--  | man page form_fieldtype.3x\n--  |=====================================================================\n--  |\npackage body Terminal_Interface.Curses.Forms.Field_Types is\n\n   use type System.Address;\n\n   package Argument_Conversions is\n      new System.Address_To_Access_Conversions (Argument);\n\n   function Get_Fieldtype (F : Field) return C_Field_Type;\n   pragma Import (C, Get_Fieldtype, \"field_type\");\n\n   function Get_Arg (F : Field) return System.Address;\n   pragma Import (C, Get_Arg, \"field_arg\");\n   --  |\n   --  |=====================================================================\n   --  | man page form_field_validation.3x\n   --  |=====================================================================\n   --  |\n   --  |\n   --  |\n   function Get_Type (Fld : Field) return Field_Type_Access\n   is\n      Low_Level : constant C_Field_Type := Get_Fieldtype (Fld);\n      Arg : Argument_Access;\n   begin\n      if Low_Level = Null_Field_Type then\n         return null;\n      else\n         if Low_Level = M_Builtin_Router or else\n            Low_Level = M_Generic_Type or else\n            Low_Level = M_Choice_Router or else\n            Low_Level = M_Generic_Choice\n         then\n            Arg := Argument_Access\n         (Argument_Conversions.To_Pointer (Get_Arg (Fld)));\n            if Arg = null then\n               raise Form_Exception;\n            else\n               return Arg.all.Typ;\n            end if;\n         else\n            raise Form_Exception;\n         end if;\n      end if;\n   end Get_Type;\n\n   function Copy_Arg (Usr : System.Address) return System.Address\n   is\n   begin\n      return Usr;\n   end Copy_Arg;\n\n   procedure Free_Arg (Usr : System.Address)\n   is\n      procedure Free_Type is new Ada.Unchecked_Deallocation\n        (Field_Type'Class, Field_Type_Access);\n      procedure Freeargs is new Ada.Unchecked_Deallocation\n        (Argument, Argument_Access);\n\n      To_Be_Free : Argument_Access\n   := Argument_Access (Argument_Conversions.To_Pointer (Usr));\n      Low_Level  : C_Field_Type;\n   begin\n      if To_Be_Free /= null then\n         if To_Be_Free.all.Usr /= System.Null_Address then\n            Low_Level := To_Be_Free.all.Cft;\n            if Low_Level.all.Freearg /= null then\n               Low_Level.all.Freearg (To_Be_Free.all.Usr);\n            end if;\n         end if;\n         if To_Be_Free.all.Typ /= null then\n            Free_Type (To_Be_Free.all.Typ);\n         end if;\n         Freeargs (To_Be_Free);\n      end if;\n   end Free_Arg;\n\n   procedure Wrap_Builtin (Fld : Field;\n                           Typ : Field_Type'Class;\n                           Cft : C_Field_Type := C_Builtin_Router)\n   is\n      Usr_Arg   : constant System.Address := Get_Arg (Fld);\n      Low_Level : constant C_Field_Type := Get_Fieldtype (Fld);\n      Arg : Argument_Access;\n      function Set_Fld_Type (F    : Field := Fld;\n                             Cf   : C_Field_Type := Cft;\n                             Arg1 : Argument_Access) return Eti_Error;\n      pragma Import (C, Set_Fld_Type, \"set_field_type_user\");\n\n   begin\n      pragma Assert (Low_Level /= Null_Field_Type);\n      if Cft /= C_Builtin_Router and then Cft /= C_Choice_Router then\n         raise Form_Exception;\n      else\n         Arg := new Argument'(Usr => System.Null_Address,\n                              Typ => new Field_Type'Class'(Typ),\n                              Cft => Get_Fieldtype (Fld));\n         if Usr_Arg /= System.Null_Address then\n            if Low_Level.all.Copyarg /= null then\n               Arg.all.Usr := Low_Level.all.Copyarg (Usr_Arg);\n            else\n               Arg.all.Usr := Usr_Arg;\n            end if;\n         end if;\n\n         Eti_Exception (Set_Fld_Type (Arg1 => Arg));\n      end if;\n   end Wrap_Builtin;\n\n   function Field_Check_Router (Fld : Field;\n                                Usr : System.Address) return Curses_Bool\n   is\n      Arg  : constant Argument_Access\n   := Argument_Access (Argument_Conversions.To_Pointer (Usr));\n   begin\n      pragma Assert (Arg /= null and then Arg.all.Cft /= Null_Field_Type\n                     and then Arg.all.Typ /= null);\n      if Arg.all.Cft.all.Fcheck /= null then\n         return Arg.all.Cft.all.Fcheck (Fld, Arg.all.Usr);\n      else\n         return 1;\n      end if;\n   end Field_Check_Router;\n\n   function Char_Check_Router (Ch  : C_Int;\n                               Usr : System.Address) return Curses_Bool\n   is\n      Arg  : constant Argument_Access\n   := Argument_Access (Argument_Conversions.To_Pointer (Usr));\n   begin\n      pragma Assert (Arg /= null and then Arg.all.Cft /= Null_Field_Type\n                     and then Arg.all.Typ /= null);\n      if Arg.all.Cft.all.Ccheck /= null then\n         return Arg.all.Cft.all.Ccheck (Ch, Arg.all.Usr);\n      else\n         return 1;\n      end if;\n   end Char_Check_Router;\n\n   function Next_Router (Fld : Field;\n                         Usr : System.Address) return Curses_Bool\n   is\n      Arg  : constant Argument_Access\n   := Argument_Access (Argument_Conversions.To_Pointer (Usr));\n   begin\n      pragma Assert (Arg /= null and then Arg.all.Cft /= Null_Field_Type\n                     and then Arg.all.Typ /= null);\n      if Arg.all.Cft.all.Next /= null then\n         return Arg.all.Cft.all.Next (Fld, Arg.all.Usr);\n      else\n         return 1;\n      end if;\n   end Next_Router;\n\n   function Prev_Router (Fld : Field;\n                         Usr : System.Address) return Curses_Bool\n   is\n      Arg  : constant Argument_Access :=\n               Argument_Access (Argument_Conversions.To_Pointer (Usr));\n   begin\n      pragma Assert (Arg /= null and then Arg.all.Cft /= Null_Field_Type\n                     and then Arg.all.Typ /= null);\n      if Arg.all.Cft.all.Prev /= null then\n         return Arg.all.Cft.all.Prev (Fld, Arg.all.Usr);\n      else\n         return 1;\n      end if;\n   end Prev_Router;\n\n   --  -----------------------------------------------------------------------\n   --\n   function C_Builtin_Router return C_Field_Type\n   is\n      T   : C_Field_Type;\n   begin\n      if M_Builtin_Router = Null_Field_Type then\n         T := New_Fieldtype (Field_Check_Router'Access,\n                             Char_Check_Router'Access);\n         if T = Null_Field_Type then\n            raise Form_Exception;\n         else\n            Eti_Exception (Set_Fieldtype_Arg (T,\n                                              Make_Arg'Access,\n                                              Copy_Arg'Access,\n                                              Free_Arg'Access));\n         end if;\n         M_Builtin_Router := T;\n      end if;\n      pragma Assert (M_Builtin_Router /= Null_Field_Type);\n      return M_Builtin_Router;\n   end C_Builtin_Router;\n\n   --  -----------------------------------------------------------------------\n   --\n   function C_Choice_Router return C_Field_Type\n   is\n      T   : C_Field_Type;\n   begin\n      if M_Choice_Router = Null_Field_Type then\n         T := New_Fieldtype (Field_Check_Router'Access,\n                             Char_Check_Router'Access);\n         if T = Null_Field_Type then\n            raise Form_Exception;\n         else\n            Eti_Exception (Set_Fieldtype_Arg (T,\n                                              Make_Arg'Access,\n                                              Copy_Arg'Access,\n                                              Free_Arg'Access));\n\n            Eti_Exception (Set_Fieldtype_Choice (T,\n                                                 Next_Router'Access,\n                                                 Prev_Router'Access));\n         end if;\n         M_Choice_Router := T;\n      end if;\n      pragma Assert (M_Choice_Router /= Null_Field_Type);\n      return M_Choice_Router;\n   end C_Choice_Router;\n\nend Terminal_Interface.Curses.Forms.Field_Types;\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}