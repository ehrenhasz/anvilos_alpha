{
  "module_name": "make-tar.sh",
  "hash_id": "5d6af6ebc7388ce054740e8237acddd0d2d123feff1fe404b1335e67c205470e",
  "original_prompt": "Ingested from ncurses-6.4/Ada95/make-tar.sh",
  "human_readable_source": "#!/bin/sh\n# $Id: make-tar.sh,v 1.23 2022/11/05 20:29:41 tom Exp $\n##############################################################################\n# Copyright 2019-2021,2022 Thomas E. Dickey                                  #\n# Copyright 2010-2015,2017 Free Software Foundation, Inc.                    #\n#                                                                            #\n# Permission is hereby granted, free of charge, to any person obtaining a    #\n# copy of this software and associated documentation files (the \"Software\"), #\n# to deal in the Software without restriction, including without limitation  #\n# the rights to use, copy, modify, merge, publish, distribute, distribute    #\n# with modifications, sublicense, and/or sell copies of the Software, and to #\n# permit persons to whom the Software is furnished to do so, subject to the  #\n# following conditions:                                                      #\n#                                                                            #\n# The above copyright notice and this permission notice shall be included in #\n# all copies or substantial portions of the Software.                        #\n#                                                                            #\n# THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR #\n# IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,   #\n# FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL    #\n# THE ABOVE COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER      #\n# LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING    #\n# FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER        #\n# DEALINGS IN THE SOFTWARE.                                                  #\n#                                                                            #\n# Except as contained in this notice, the name(s) of the above copyright     #\n# holders shall not be used in advertising or otherwise to promote the sale, #\n# use or other dealings in this Software without prior written               #\n# authorization.                                                             #\n##############################################################################\n# Construct a tar-file containing only the Ada95 tree as well as its associated\n# documentation.  The reason for doing that is to simplify distributing the\n# ada binding as a separate package.\n\nCDPATH=:\nexport CDPATH\n\nTARGET=`pwd`\n\n: \"${ROOTNAME:=ncurses-Ada95}\"\n: \"${PKG_NAME:=AdaCurses}\"\n: \"${DESTDIR:=$TARGET}\"\n: \"${TMPDIR:=/tmp}\"\n\n# make timestamps of generated files predictable\nsame_timestamp() {\n\ttouch -r ../NEWS \"$1\"\n}\n\ngrep_assign() {\n\tgrep_assign=`grep -E \"^$2\\>\" \"$1\" | sed -e \"s/^$2[ \t]*=[ \t]*//\" -e 's/\"//g'`\n\teval \"$2\"=\\\"\"$grep_assign\"\\\"\n}\n\ngrep_patchdate() {\n\tgrep_assign ../dist.mk NCURSES_MAJOR\n\tgrep_assign ../dist.mk NCURSES_MINOR\n\tgrep_assign ../dist.mk NCURSES_PATCH\n}\n\n# The rpm spec-file in the ncurses tree is a template.  Fill in the version\n# information from dist.mk\nedit_specfile() {\n\tsed \\\n\t\t-e \"s/\\\\<MAJOR\\\\>/$NCURSES_MAJOR/g\" \\\n\t\t-e \"s/\\\\<MINOR\\\\>/$NCURSES_MINOR/g\" \\\n\t\t-e \"s/\\\\<YYYYMMDD\\\\>/$NCURSES_PATCH/g\" \"$1\" >\"$1.new\"\n\tchmod u+w \"$1\"\n\tmv \"$1.new\" \"$1\"\n\tsame_timestamp \"$1\"\n}\n\nmake_changelog() {\n\t[ -f \"$1\" ] && chmod u+w \"$1\"\n\tcat >\"$1\" <<EOF\n`echo $PKG_NAME|tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz'` ($NCURSES_MAJOR.$NCURSES_MINOR+$NCURSES_PATCH) unstable; urgency=low\n\n  * snapshot of ncurses subpackage for $PKG_NAME.\n\n -- `head -n 1 \"$HOME\"/.signature`  `date -R`\nEOF\n\tsame_timestamp \"$1\"\n}\n\n# This can be run from either the subdirectory, or from the top-level\n# source directory.  We will put the tar file in the original directory.\nif [ -d ./Ada95 ]\nthen\n\tcd ./Ada95 || exit\nfi\nSOURCE=`cd ..;pwd`\n\nBUILD=$TMPDIR/make-tar$$\ntrap \"cd /; rm -rf $BUILD; exit 1\" 1 2 3 15\ntrap \"cd /; rm -rf $BUILD\" 0\n\numask 077\nif ! ( mkdir $BUILD )\nthen\n\techo \"? cannot make build directory $BUILD\"\nfi\n\numask 022\nmkdir $BUILD/$ROOTNAME\n\ncp -p -r ./* $BUILD/$ROOTNAME/ || exit\n\n# Add the config.* utility scripts from the top-level directory.\nfor i in . ..\ndo\n\tfor j in COPYING config.guess config.sub install-sh tar-copy.sh\n\tdo\n\t\t[ -f $i/$j ] && cp -p $i/$j $BUILD/$ROOTNAME/\n\tdone\ndone\n\n# Make rpm and dpkg scripts for test-builds\ngrep_patchdate\nfor spec in \"$BUILD/$ROOTNAME\"/package/*.spec\ndo\n\tedit_specfile \"$spec\"\ndone\nfor spec in \"$BUILD/$ROOTNAME\"/package/debian*\ndo\n\tmake_changelog \"$spec\"/changelog\ndone\n\ncp -p ../man/MKada_config.in $BUILD/$ROOTNAME/doc/\nif [ -z \"$NO_HTML_DOCS\" ]\nthen\n\t# Add the ada documentation.\n\tcd ../doc/html || exit\n\n\tcp -p -r Ada* $BUILD/$ROOTNAME/doc/\n\tcp -p -r ada $BUILD/$ROOTNAME/doc/\n\n\tcd ../../Ada95 || exit\nfi\n\ncp -p \"$SOURCE/NEWS\" $BUILD/$ROOTNAME\n\n# cleanup empty directories (an artifact of ncurses source archives)\n\ntouch $BUILD/$ROOTNAME/MANIFEST\n( cd $BUILD/$ROOTNAME && find . -type f -print | \"$SOURCE/misc/csort\" >MANIFEST )\nsame_timestamp $BUILD/$ROOTNAME/MANIFEST\n\ncd $BUILD || exit\n\n# Remove build-artifacts.\nfind . -name RCS -exec rm -rf {} \\;\nfind $BUILD/$ROOTNAME -type d -exec rmdir {} \\; 2>/dev/null\nfind $BUILD/$ROOTNAME -type d -exec rmdir {} \\; 2>/dev/null\nfind $BUILD/$ROOTNAME -type d -exec rmdir {} \\; 2>/dev/null\n\n# There is no need for this script in the tar file.\nrm -f $ROOTNAME/make-tar.sh\n\n# Remove build-artifacts.\nfind . -name \"*.gz\" -exec rm -rf {} \\;\n\n# Make the files writable...\nchmod -R u+w .\n\n# Cleanup timestamps\n[ -n \"$TOUCH_DIRS\" ] && \"$TOUCH_DIRS\" \"$ROOTNAME\"\n\ntar cf - $TAR_OPTIONS $ROOTNAME | gzip >\"$DESTDIR/$ROOTNAME.tar.gz\"\ncd \"$DESTDIR\" || exit\n\npwd\nls -l $ROOTNAME.tar.gz\n\n# vi:ts=4 sw=4\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}