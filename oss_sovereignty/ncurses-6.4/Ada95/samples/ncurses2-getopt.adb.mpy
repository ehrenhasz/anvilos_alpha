{
  "module_name": "ncurses2-getopt.adb",
  "hash_id": "82e1a4b3cc87b6df787b1c5b9e96cafbc8f5aa689de92da0ae946cddef72fabd",
  "original_prompt": "Ingested from ncurses-6.4/Ada95/samples/ncurses2-getopt.adb",
  "human_readable_source": "------------------------------------------------------------------------------\n--                                                                          --\n--                       GNAT ncurses Binding Samples                       --\n--                                                                          --\n--                                 ncurses                                  --\n--                                                                          --\n--                                 B O D Y                                  --\n--                                                                          --\n------------------------------------------------------------------------------\n-- Copyright 2020 Thomas E. Dickey                                          --\n-- Copyright 2000-2008,2011 Free Software Foundation, Inc.                  --\n--                                                                          --\n-- Permission is hereby granted, free of charge, to any person obtaining a  --\n-- copy of this software and associated documentation files (the            --\n-- \"Software\"), to deal in the Software without restriction, including      --\n-- without limitation the rights to use, copy, modify, merge, publish,      --\n-- distribute, distribute with modifications, sublicense, and/or sell       --\n-- copies of the Software, and to permit persons to whom the Software is    --\n-- furnished to do so, subject to the following conditions:                 --\n--                                                                          --\n-- The above copyright notice and this permission notice shall be included  --\n-- in all copies or substantial portions of the Software.                   --\n--                                                                          --\n-- THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS  --\n-- OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF               --\n-- MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.   --\n-- IN NO EVENT SHALL THE ABOVE COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,   --\n-- DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR    --\n-- OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR    --\n-- THE USE OR OTHER DEALINGS IN THE SOFTWARE.                               --\n--                                                                          --\n-- Except as contained in this notice, the name(s) of the above copyright   --\n-- holders shall not be used in advertising or otherwise to promote the     --\n-- sale, use or other dealings in this Software without prior written       --\n-- authorization.                                                           --\n------------------------------------------------------------------------------\n--  Author: Eugene V. Melaragno <aldomel@ix.netcom.com> 2000\n--  Version Control\n--  $Revision: 1.9 $\n--  $Date: 2020/02/02 23:34:34 $\n--  Binding Version 01.00\n------------------------------------------------------------------------------\n--  A simplified version of the  GNU getopt function\n--  copyright Free Software Foundtion\n\nwith Ada.Strings.Fixed;\nwith Ada.Strings.Bounded;\nwith Ada.Text_IO; use Ada.Text_IO;\n\npackage body ncurses2.getopt is\n\n   nextchar : Natural := 0;\n\n   --  Ncurses doesn't use the non option elements so we are spared\n   --  the job of computing those.\n\n   --  also the user is not allowed to modify argv or argc\n   --  Doing so is Erroneous execution.\n\n   --  long options are not handled.\n\n   procedure Qgetopt (retval : out Integer;\n                      argc : Integer;\n                      argv : stringfunc;\n                        --  argv will be the Argument function.\n                      optstring : String;\n                      optind : in out Integer;\n                        --  ignored for ncurses, must be initialized to 1 by\n                        --  the caller\n                      Optarg : out stringa\n                        --  a garbage collector would be useful here.\n                     ) is\n\n      package BS is new Ada.Strings.Bounded.Generic_Bounded_Length (200);\n      use BS;\n      optargx : Bounded_String;\n   begin\n\n      if argc < optind then\n         retval := -1;\n         return;\n      end if;\n\n      optargx := To_Bounded_String (\"\");\n\n      if nextchar = 0 then\n\n         if argv (optind) = \"--\" then\n                           --  the rest are non-options, we ignore them\n            retval := -1;\n            return;\n         end if;\n\n         if argv (optind)(1) /= '-' or argv (optind)'Length = 1 then\n            optind := optind + 1;\n            Optarg := new String'(argv (optind));\n            retval := 1;\n            return;\n         end if;\n\n         nextchar := 2; -- skip the one hyphen.\n      end if;\n\n      --  Look at and handle the next short option-character.\n      declare\n         c : Character := argv (optind) (nextchar);\n         temp : constant Natural :=\n           Ada.Strings.Fixed.Index (optstring, String'(1 => c));\n      begin\n         if temp = 0 or c = ':' then\n            Put_Line (Standard_Error,\n                      argv (optind) & \": invalid option -- \" & c);\n            c := '?';\n            return;\n         end if;\n\n         if optstring (temp + 1) = ':' then\n            if optstring (temp + 2) = ':' then\n               --  This is an option that accepts an argument optionally.\n               if nextchar /= argv (optind)'Length then\n                  optargx := To_Bounded_String\n                    (argv (optind) (nextchar .. argv (optind)'Length));\n               else\n                  Optarg := null;\n               end if;\n            else\n               --  This is an option that requires an argument.\n               if nextchar /= argv (optind)'Length then\n                  optargx := To_Bounded_String\n                    (argv (optind) (nextchar .. argv (optind)'Length));\n                  optind := optind + 1;\n               elsif optind = argc then\n                  Put_Line (Standard_Error,\n                            argv (optind) &\n                            \": option requires an argument -- \" & c);\n                  if optstring (optstring'First) = ':'  then\n                     c := ':';\n                  else\n                     c := '?';\n                  end if;\n               else\n                  --  increment it again when taking next ARGV-elt as argument.\n                  optind := optind + 1;\n                  optargx := To_Bounded_String (argv (optind));\n                  optind := optind + 1;\n               end if;\n            end if;\n            nextchar := 0;\n         else -- no argument for the option\n            if nextchar = argv (optind)'Length then\n               optind := optind + 1;\n               nextchar := 0;\n            else\n               nextchar := nextchar + 1;\n            end if;\n         end if;\n\n         retval := Character'Pos (c);\n         Optarg := new String'(To_String (optargx));\n         return;\n      end;\n   end Qgetopt;\n\nend ncurses2.getopt;\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}