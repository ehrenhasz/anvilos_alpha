{
  "module_name": "ncurses2-m.adb",
  "hash_id": "d5360ae28c92090f9082e37c4c96ae7de035f2e5f6b13b35ee77f8d1608b7521",
  "original_prompt": "Ingested from ncurses-6.4/Ada95/samples/ncurses2-m.adb",
  "human_readable_source": "------------------------------------------------------------------------------\n--                                                                          --\n--                       GNAT ncurses Binding Samples                       --\n--                                                                          --\n--                                 ncurses                                  --\n--                                                                          --\n--                                 B O D Y                                  --\n--                                                                          --\n------------------------------------------------------------------------------\n-- Copyright 2018,2020 Thomas E. Dickey                                     --\n-- Copyright 2000-2007,2008 Free Software Foundation, Inc.                  --\n--                                                                          --\n-- Permission is hereby granted, free of charge, to any person obtaining a  --\n-- copy of this software and associated documentation files (the            --\n-- \"Software\"), to deal in the Software without restriction, including      --\n-- without limitation the rights to use, copy, modify, merge, publish,      --\n-- distribute, distribute with modifications, sublicense, and/or sell       --\n-- copies of the Software, and to permit persons to whom the Software is    --\n-- furnished to do so, subject to the following conditions:                 --\n--                                                                          --\n-- The above copyright notice and this permission notice shall be included  --\n-- in all copies or substantial portions of the Software.                   --\n--                                                                          --\n-- THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS  --\n-- OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF               --\n-- MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.   --\n-- IN NO EVENT SHALL THE ABOVE COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,   --\n-- DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR    --\n-- OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR    --\n-- THE USE OR OTHER DEALINGS IN THE SOFTWARE.                               --\n--                                                                          --\n-- Except as contained in this notice, the name(s) of the above copyright   --\n-- holders shall not be used in advertising or otherwise to promote the     --\n-- sale, use or other dealings in this Software without prior written       --\n-- authorization.                                                           --\n------------------------------------------------------------------------------\n--  Author: Eugene V. Melaragno <aldomel@ix.netcom.com> 2000\n--  Version Control\n--  $Revision: 1.11 $\n--  $Date: 2020/02/02 23:34:34 $\n--  Binding Version 01.00\n------------------------------------------------------------------------------\n--  TODO use Default_Character where appropriate\n\n--  This is an Ada version of ncurses\n--  I translated this because it tests the most features.\n\nwith Terminal_Interface.Curses; use Terminal_Interface.Curses;\nwith Terminal_Interface.Curses.Trace; use Terminal_Interface.Curses.Trace;\n\nwith Ada.Text_IO; use Ada.Text_IO;\n\nwith Ada.Characters.Latin_1;\n\nwith Ada.Command_Line; use Ada.Command_Line;\n\nwith Ada.Strings.Unbounded;\n\nwith ncurses2.util; use ncurses2.util;\nwith ncurses2.getch_test;\nwith ncurses2.attr_test;\nwith ncurses2.color_test;\nwith ncurses2.demo_panels;\nwith ncurses2.color_edit;\nwith ncurses2.slk_test;\nwith ncurses2.acs_display;\nwith ncurses2.acs_and_scroll;\nwith ncurses2.flushinp_test;\nwith ncurses2.test_sgr_attributes;\nwith ncurses2.menu_test;\nwith ncurses2.demo_pad;\nwith ncurses2.demo_forms;\nwith ncurses2.overlap_test;\nwith ncurses2.trace_set;\n\nwith ncurses2.getopt; use ncurses2.getopt;\n\npackage body ncurses2.m is\n\n   function To_trace (n : Integer) return Trace_Attribute_Set;\n   procedure usage;\n   procedure Set_Terminal_Modes;\n   function Do_Single_Test (c : Character) return Boolean;\n\n   function To_trace (n : Integer) return Trace_Attribute_Set is\n      a : Trace_Attribute_Set := (others => False);\n      m : Integer;\n      rest : Integer;\n   begin\n      m := n  mod 2;\n      if 1 = m then\n         a.Times := True;\n      end if;\n      rest := n / 2;\n\n      m := rest mod 2;\n      if 1 = m then\n         a.Tputs := True;\n      end if;\n      rest := rest / 2;\n      m := rest mod 2;\n      if 1 = m then\n         a.Update := True;\n      end if;\n      rest := rest / 2;\n      m := rest mod 2;\n      if 1 = m then\n         a.Cursor_Move := True;\n      end if;\n      rest := rest / 2;\n      m := rest mod 2;\n      if 1 = m then\n         a.Character_Output := True;\n      end if;\n      rest := rest / 2;\n      m := rest mod 2;\n      if 1 = m then\n         a.Calls := True;\n      end if;\n      rest := rest / 2;\n      m := rest mod 2;\n      if 1 = m then\n         a.Virtual_Puts := True;\n      end if;\n      rest := rest / 2;\n      m := rest mod 2;\n      if 1 = m then\n         a.Input_Events := True;\n      end if;\n      rest := rest / 2;\n      m := rest mod 2;\n      if 1 = m then\n         a.TTY_State := True;\n      end if;\n      rest := rest / 2;\n      m := rest mod 2;\n      if 1 = m then\n         a.Internal_Calls := True;\n      end if;\n      rest := rest / 2;\n      m := rest mod 2;\n      if 1 = m then\n         a.Character_Calls := True;\n      end if;\n      rest := rest / 2;\n      m := rest mod 2;\n      if 1 = m then\n         a.Termcap_TermInfo := True;\n      end if;\n\n      return a;\n   end To_trace;\n\n   --   these are type Stdscr_Init_Proc;\n\n   function rip_footer (\n                        Win : Window;\n                        Columns : Column_Count) return Integer;\n   pragma Convention (C, rip_footer);\n\n   function rip_footer (\n                        Win : Window;\n                        Columns : Column_Count) return Integer is\n   begin\n      Set_Background (Win, (Ch => ' ',\n                            Attr => (Reverse_Video => True, others => False),\n                            Color => 0));\n      Erase (Win);\n      Move_Cursor (Win, 0, 0);\n      Add (Win, \"footer:\"  & Columns'Img & \" columns\");\n      Refresh_Without_Update (Win);\n      return 0; -- Curses_OK;\n   end rip_footer;\n\n   function rip_header (\n                        Win : Window;\n                        Columns : Column_Count) return Integer;\n   pragma Convention (C, rip_header);\n\n   function rip_header (\n                        Win : Window;\n                        Columns : Column_Count) return Integer is\n   begin\n      Set_Background (Win, (Ch => ' ',\n                            Attr => (Reverse_Video => True, others => False),\n                            Color => 0));\n      Erase (Win);\n      Move_Cursor (Win, 0, 0);\n      Add (Win, \"header:\"  & Columns'Img & \" columns\");\n      --  'Img is a GNAT extension\n      Refresh_Without_Update (Win);\n      return 0; -- Curses_OK;\n   end rip_header;\n\n   procedure usage is\n      --  type Stringa is access String;\n      use Ada.Strings.Unbounded;\n      --  tbl : constant array (Positive range <>) of Stringa := (\n      tbl : constant array (Positive range <>) of Unbounded_String\n        := (\n            To_Unbounded_String (\"Usage: ncurses [options]\"),\n            To_Unbounded_String (\"\"),\n            To_Unbounded_String (\"Options:\"),\n            To_Unbounded_String (\"  -a f,b   set default-colors \" &\n                                 \"(assumed white-on-black)\"),\n            To_Unbounded_String (\"  -d       use default-colors if terminal \" &\n                                 \"supports them\"),\n            To_Unbounded_String (\"  -e fmt   specify format for soft-keys \" &\n                                 \"test (e)\"),\n            To_Unbounded_String (\"  -f       rip-off footer line \" &\n                                 \"(can repeat)\"),\n            To_Unbounded_String (\"  -h       rip-off header line \" &\n                                 \"(can repeat)\"),\n            To_Unbounded_String (\"  -s msec  specify nominal time for \" &\n                                 \"panel-demo (default: 1, to hold)\"),\n            To_Unbounded_String (\"  -t mask  specify default trace-level \" &\n                                 \"(may toggle with ^T)\")\n            );\n   begin\n      for n in tbl'Range loop\n         Put_Line (Standard_Error, To_String (tbl (n)));\n      end loop;\n      --     exit(EXIT_FAILURE);\n      --  TODO should we use Set_Exit_Status and throw and exception?\n   end usage;\n\n   procedure Set_Terminal_Modes is begin\n      Set_Raw_Mode (SwitchOn => False);\n      Set_Cbreak_Mode (SwitchOn => True);\n      Set_Echo_Mode (SwitchOn => False);\n      Allow_Scrolling (Mode => True);\n      Use_Insert_Delete_Line (Do_Idl => True);\n      Set_KeyPad_Mode (SwitchOn => True);\n   end Set_Terminal_Modes;\n\n   nap_msec : Integer := 1;\n\n   function Do_Single_Test (c : Character) return Boolean is\n   begin\n      case c is\n         when 'a' =>\n            getch_test;\n         when 'b' =>\n            attr_test;\n         when 'c' =>\n            if not Has_Colors then\n               Cannot (\"does not support color.\");\n            else\n               color_test;\n            end if;\n         when 'd' =>\n            if not Has_Colors then\n               Cannot (\"does not support color.\");\n            elsif not Can_Change_Color then\n               Cannot (\"has hardwired color values.\");\n            else\n               color_edit;\n            end if;\n         when 'e' =>\n            slk_test;\n         when 'f' =>\n            acs_display;\n         when 'o' =>\n            demo_panels (nap_msec);\n         when 'g' =>\n            acs_and_scroll;\n         when 'i' =>\n            flushinp_test (Standard_Window);\n         when 'k' =>\n            test_sgr_attributes;\n         when 'm' =>\n            menu_test;\n         when 'p' =>\n            demo_pad;\n         when 'r' =>\n            demo_forms;\n         when 's' =>\n            overlap_test;\n         when 't' =>\n            trace_set;\n         when '?' =>\n            null;\n         when others => return False;\n      end case;\n      return True;\n   end Do_Single_Test;\n\n   command : Character;\n   my_e_param : Soft_Label_Key_Format := Four_Four;\n   assumed_colors : Boolean := False;\n   default_colors : Boolean := False;\n   default_fg : Color_Number := White;\n   default_bg : Color_Number := Black;\n   --  nap_msec was an unsigned long integer in the C version,\n   --  yet napms only takes an int!\n\n   c : Integer;\n   c2 : Character;\n   optind : Integer := 1; -- must be initialized to one.\n   optarg : getopt.stringa;\n\n   length : Integer;\n   tmpi : Integer;\n\n   package myio is new Ada.Text_IO.Integer_IO (Integer);\n\n   save_trace : Integer := 0;\n   save_trace_set : Trace_Attribute_Set;\n\n   function main return Integer is\n   begin\n      loop\n         Qgetopt (c, Argument_Count, Argument'Access,\n                  \"a:de:fhs:t:\", optind, optarg);\n         exit when c = -1;\n         c2 := Character'Val (c);\n         case c2 is\n            when 'a' =>\n               --  Ada doesn't have scanf, it doesn't even have a\n               --  regular expression library.\n               assumed_colors := True;\n               myio.Get (optarg.all, Integer (default_fg), length);\n               myio.Get (optarg.all (length + 2 .. optarg.all'Length),\n                         Integer (default_bg), length);\n            when 'd' =>\n               default_colors := True;\n            when 'e' =>\n               myio.Get (optarg.all, tmpi, length);\n               if tmpi > 3 then\n                  usage;\n                  return 1;\n               end if;\n               my_e_param := Soft_Label_Key_Format'Val (tmpi);\n            when 'f' =>\n               Rip_Off_Lines (-1, rip_footer'Access);\n            when 'h' =>\n               Rip_Off_Lines (1, rip_header'Access);\n            when 's' =>\n               myio.Get (optarg.all, nap_msec, length);\n            when 't' =>\n               myio.Get (optarg.all, save_trace, length);\n            when others =>\n               usage;\n               return 1;\n         end case;\n      end loop;\n\n      --  the C version had a bunch of macros here.\n\n      --   if (!isatty(fileno(stdin)))\n      --   isatty is not available in the standard Ada so skip it.\n      save_trace_set := To_trace (save_trace);\n      Trace_On (save_trace_set);\n\n      Init_Soft_Label_Keys (my_e_param);\n\n      Init_Screen;\n      Set_Background (Ch => (Ch    => Blank,\n                             Attr  => Normal_Video,\n                             Color => Color_Pair'First));\n\n      if Has_Colors then\n         Start_Color;\n         if default_colors then\n            Use_Default_Colors;\n         elsif assumed_colors then\n            Assume_Default_Colors (default_fg, default_bg);\n         end if;\n      end if;\n\n      Set_Terminal_Modes;\n      Save_Curses_Mode (Curses);\n\n      End_Windows;\n\n      --  TODO add macro #if blocks.\n      Put_Line (\"Welcome to \" & Curses_Version & \".  Press ? for help.\");\n\n      loop\n         Put_Line (\"This is the ncurses main menu\");\n         Put_Line (\"a = keyboard and mouse input test\");\n         Put_Line (\"b = character attribute test\");\n         Put_Line (\"c = color test pattern\");\n         Put_Line (\"d = edit RGB color values\");\n         Put_Line (\"e = exercise soft keys\");\n         Put_Line (\"f = display ACS characters\");\n         Put_Line (\"g = display windows and scrolling\");\n         Put_Line (\"i = test of flushinp()\");\n         Put_Line (\"k = display character attributes\");\n         Put_Line (\"m = menu code test\");\n         Put_Line (\"o = exercise panels library\");\n         Put_Line (\"p = exercise pad features\");\n         Put_Line (\"q = quit\");\n         Put_Line (\"r = exercise forms code\");\n         Put_Line (\"s = overlapping-refresh test\");\n         Put_Line (\"t = set trace level\");\n         Put_Line (\"? = repeat this command summary\");\n\n         Put (\"> \");\n         Flush;\n\n         command := Ada.Characters.Latin_1.NUL;\n         --              get_input:\n         --              loop\n         declare\n            Ch : Character;\n         begin\n            Get (Ch);\n            --  TODO if read(ch) <= 0\n            --  TODO ada doesn't have an Is_Space function\n            command := Ch;\n            --  TODO if ch = '\\n' or '\\r' are these in Ada?\n         end;\n         --              end loop get_input;\n\n         declare\n         begin\n            if Do_Single_Test (command) then\n               Flush_Input;\n               Set_Terminal_Modes;\n               Reset_Curses_Mode (Curses);\n               Clear;\n               Refresh;\n               End_Windows;\n               if command = '?' then\n                  Put_Line (\"This is the ncurses capability tester.\");\n                  Put_Line (\"You may select a test from the main menu by \" &\n                            \"typing the\");\n                  Put_Line (\"key letter of the choice (the letter to left \" &\n                            \"of the =)\");\n                  Put_Line (\"at the > prompt.  The commands `x' or `q' will \" &\n                            \"exit.\");\n               end if;\n               --  continue; --why continue in the C version?\n            end if;\n         exception\n            when Curses_Exception => End_Windows;\n         end;\n\n         exit when command = 'q';\n      end loop;\n      Curses_Free_All;\n      return 0; -- TODO ExitProgram(EXIT_SUCCESS);\n   end main;\n\nend ncurses2.m;\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}