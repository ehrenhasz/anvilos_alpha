{
  "module_name": "sample-menu_demo.adb",
  "hash_id": "841e72eb54f48497c647a6461eb7766151f40b1d589e5530bbb7462b2430185a",
  "original_prompt": "Ingested from ncurses-6.4/Ada95/samples/sample-menu_demo.adb",
  "human_readable_source": "------------------------------------------------------------------------------\n--                                                                          --\n--                       GNAT ncurses Binding Samples                       --\n--                                                                          --\n--                              Sample.Menu_Demo                            --\n--                                                                          --\n--                                 B O D Y                                  --\n--                                                                          --\n------------------------------------------------------------------------------\n-- Copyright 2020 Thomas E. Dickey                                          --\n-- Copyright 1998-2008,2011 Free Software Foundation, Inc.                  --\n--                                                                          --\n-- Permission is hereby granted, free of charge, to any person obtaining a  --\n-- copy of this software and associated documentation files (the            --\n-- \"Software\"), to deal in the Software without restriction, including      --\n-- without limitation the rights to use, copy, modify, merge, publish,      --\n-- distribute, distribute with modifications, sublicense, and/or sell       --\n-- copies of the Software, and to permit persons to whom the Software is    --\n-- furnished to do so, subject to the following conditions:                 --\n--                                                                          --\n-- The above copyright notice and this permission notice shall be included  --\n-- in all copies or substantial portions of the Software.                   --\n--                                                                          --\n-- THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS  --\n-- OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF               --\n-- MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.   --\n-- IN NO EVENT SHALL THE ABOVE COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,   --\n-- DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR    --\n-- OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR    --\n-- THE USE OR OTHER DEALINGS IN THE SOFTWARE.                               --\n--                                                                          --\n-- Except as contained in this notice, the name(s) of the above copyright   --\n-- holders shall not be used in advertising or otherwise to promote the     --\n-- sale, use or other dealings in this Software without prior written       --\n-- authorization.                                                           --\n------------------------------------------------------------------------------\n--  Author:  Juergen Pfeifer, 1996\n--  Version Control\n--  $Revision: 1.20 $\n--  $Date: 2020/02/02 23:34:34 $\n--  Binding Version 01.00\n------------------------------------------------------------------------------\nwith Terminal_Interface.Curses; use Terminal_Interface.Curses;\nwith Terminal_Interface.Curses.Panels; use Terminal_Interface.Curses.Panels;\nwith Terminal_Interface.Curses.Menus; use Terminal_Interface.Curses.Menus;\nwith Terminal_Interface.Curses.Menus.Menu_User_Data;\nwith Terminal_Interface.Curses.Menus.Item_User_Data;\n\nwith Sample.Manifest; use Sample.Manifest;\nwith Sample.Function_Key_Setting; use Sample.Function_Key_Setting;\nwith Sample.Menu_Demo.Handler;\nwith Sample.Helpers; use Sample.Helpers;\nwith Sample.Explanation; use Sample.Explanation;\n\npackage body Sample.Menu_Demo is\n\n   package Spacing_Demo is\n      procedure Spacing_Test;\n   end Spacing_Demo;\n\n   package body Spacing_Demo is\n\n      procedure Spacing_Test\n      is\n         function My_Driver (M : Menu;\n                             K : Key_Code;\n                             P : Panel) return Boolean;\n\n         procedure Set_Option_Key;\n         procedure Set_Select_Key;\n         procedure Set_Description_Key;\n         procedure Set_Hide_Key;\n\n         package Mh is new Sample.Menu_Demo.Handler (My_Driver);\n\n         I : Item_Array_Access := new Item_Array'\n           (New_Item (\"January\",   \"31 Days\"),\n            New_Item (\"February\",  \"28/29 Days\"),\n            New_Item (\"March\",     \"31 Days\"),\n            New_Item (\"April\",     \"30 Days\"),\n            New_Item (\"May\",       \"31 Days\"),\n            New_Item (\"June\",      \"30 Days\"),\n            New_Item (\"July\",      \"31 Days\"),\n            New_Item (\"August\",    \"31 Days\"),\n            New_Item (\"September\", \"30 Days\"),\n            New_Item (\"October\",   \"31 Days\"),\n            New_Item (\"November\",  \"30 Days\"),\n            New_Item (\"December\",  \"31 Days\"),\n            Null_Item);\n\n         M : Menu   := New_Menu (I);\n         Flip_State : Boolean := True;\n         Hide_Long  : Boolean := False;\n\n         type Format_Code is (Four_By_1, Four_By_2, Four_By_3);\n         type Operations  is (Flip, Reorder, Reformat, Reselect, Describe);\n\n         type Change is array (Operations) of Boolean;\n         pragma Pack (Change);\n         No_Change : constant Change := Change'(others => False);\n\n         Current_Format : Format_Code := Four_By_1;\n         To_Change : Change := No_Change;\n\n         function My_Driver (M : Menu;\n                             K : Key_Code;\n                             P : Panel) return Boolean\n         is\n         begin\n            if M = Null_Menu then\n               raise Menu_Exception;\n            end if;\n            if P = Null_Panel then\n               raise Panel_Exception;\n            end if;\n            To_Change := No_Change;\n            if K in User_Key_Code'Range then\n               if K = QUIT then\n                  return True;\n               end if;\n            end if;\n            if K in Special_Key_Code'Range then\n               case K is\n                  when Key_F4 =>\n                     To_Change (Flip) := True;\n                     return True;\n                  when Key_F5 =>\n                     To_Change (Reformat)  := True;\n                     Current_Format := Four_By_1;\n                     return True;\n                  when Key_F6 =>\n                     To_Change (Reformat)  := True;\n                     Current_Format := Four_By_2;\n                     return True;\n                  when Key_F7 =>\n                     To_Change (Reformat)  := True;\n                     Current_Format := Four_By_3;\n                     return True;\n                  when Key_F8 =>\n                     To_Change (Reorder) := True;\n                     return True;\n                  when Key_F9 =>\n                     To_Change (Reselect) := True;\n                     return True;\n                  when Key_F10 =>\n                     if Current_Format /= Four_By_3 then\n                        To_Change (Describe) := True;\n                        return True;\n                     else\n                        return False;\n                     end if;\n                  when Key_F11 =>\n                     Hide_Long := not Hide_Long;\n                     declare\n                        O : Item_Option_Set;\n                     begin\n                        for J in I'Range loop\n                           Get_Options (I.all (J), O);\n                           O.Selectable := True;\n                           if Hide_Long then\n                              case J is\n                                 when 1 | 3 | 5 | 7 | 8 | 10 | 12 =>\n                                    O.Selectable := False;\n                                 when others => null;\n                              end case;\n                           end if;\n                           Set_Options (I.all (J), O);\n                        end loop;\n                     end;\n                     return False;\n                  when others => null;\n               end case;\n            end if;\n            return False;\n         end My_Driver;\n\n         procedure Set_Option_Key\n         is\n            O : Menu_Option_Set;\n         begin\n            if Current_Format = Four_By_1 then\n               Set_Soft_Label_Key (8, \"\");\n            else\n               Get_Options (M, O);\n               if O.Row_Major_Order then\n                  Set_Soft_Label_Key (8, \"O-Col\");\n               else\n                  Set_Soft_Label_Key (8, \"O-Row\");\n               end if;\n            end if;\n            Refresh_Soft_Label_Keys_Without_Update;\n         end Set_Option_Key;\n\n         procedure Set_Select_Key\n         is\n            O : Menu_Option_Set;\n         begin\n            Get_Options (M, O);\n            if O.One_Valued then\n               Set_Soft_Label_Key (9, \"Multi\");\n            else\n               Set_Soft_Label_Key (9, \"Singl\");\n            end if;\n            Refresh_Soft_Label_Keys_Without_Update;\n         end Set_Select_Key;\n\n         procedure Set_Description_Key\n         is\n            O : Menu_Option_Set;\n         begin\n            if Current_Format = Four_By_3 then\n               Set_Soft_Label_Key (10, \"\");\n            else\n               Get_Options (M, O);\n               if O.Show_Descriptions then\n                  Set_Soft_Label_Key (10, \"-Desc\");\n               else\n                  Set_Soft_Label_Key (10, \"+Desc\");\n               end if;\n            end if;\n            Refresh_Soft_Label_Keys_Without_Update;\n         end Set_Description_Key;\n\n         procedure Set_Hide_Key\n         is\n         begin\n            if Hide_Long then\n               Set_Soft_Label_Key (11, \"Enab\");\n            else\n               Set_Soft_Label_Key (11, \"Disab\");\n            end if;\n            Refresh_Soft_Label_Keys_Without_Update;\n         end Set_Hide_Key;\n\n      begin\n         Push_Environment (\"MENU01\");\n         Notepad (\"MENU-PAD01\");\n         Default_Labels;\n         Set_Soft_Label_Key (4, \"Flip\");\n         Set_Soft_Label_Key (5, \"4x1\");\n         Set_Soft_Label_Key (6, \"4x2\");\n         Set_Soft_Label_Key (7, \"4x3\");\n         Set_Option_Key;\n         Set_Select_Key;\n         Set_Description_Key;\n         Set_Hide_Key;\n\n         Set_Format (M, 4, 1);\n         loop\n            Mh.Drive_Me (M);\n            exit when To_Change = No_Change;\n            if To_Change (Flip) then\n               if Flip_State then\n                  Flip_State := False;\n                  Set_Spacing (M, 3, 2, 0);\n               else\n                  Flip_State := True;\n                  Set_Spacing (M);\n               end if;\n            elsif To_Change (Reformat) then\n               case Current_Format is\n                  when Four_By_1 => Set_Format (M, 4, 1);\n                  when Four_By_2 => Set_Format (M, 4, 2);\n                  when Four_By_3 =>\n                     declare\n                        O : Menu_Option_Set;\n                     begin\n                        Get_Options (M, O);\n                        O.Show_Descriptions := False;\n                        Set_Options (M, O);\n                        Set_Format (M, 4, 3);\n                     end;\n               end case;\n               Set_Option_Key;\n               Set_Description_Key;\n            elsif To_Change (Reorder) then\n               declare\n                  O : Menu_Option_Set;\n               begin\n                  Get_Options (M, O);\n                  O.Row_Major_Order := not O.Row_Major_Order;\n                  Set_Options (M, O);\n                  Set_Option_Key;\n               end;\n            elsif To_Change (Reselect) then\n               declare\n                  O : Menu_Option_Set;\n               begin\n                  Get_Options (M, O);\n                  O.One_Valued := not O.One_Valued;\n                  Set_Options (M, O);\n                  Set_Select_Key;\n               end;\n            elsif To_Change (Describe) then\n               declare\n                  O : Menu_Option_Set;\n               begin\n                  Get_Options (M, O);\n                  O.Show_Descriptions := not O.Show_Descriptions;\n                  Set_Options (M, O);\n                  Set_Description_Key;\n               end;\n            else\n               null;\n            end if;\n         end loop;\n         Set_Spacing (M);\n\n         Pop_Environment;\n         pragma Assert (Get_Index (Items (M, 1)) = Get_Index (I (1)));\n         Delete (M);\n         Free (I, True);\n      end Spacing_Test;\n   end Spacing_Demo;\n\n   procedure Demo\n   is\n      --  We use this datatype only to test the instantiation of\n      --  the Menu_User_Data generic package. No functionality\n      --  behind it.\n      type User_Data is new Integer;\n      type User_Data_Access is access User_Data;\n\n      --  Those packages are only instantiated to test the usability.\n      --  No real functionality is shown in the demo.\n      package MUD is new Menu_User_Data (User_Data, User_Data_Access);\n      package IUD is new Item_User_Data (User_Data, User_Data_Access);\n\n      function My_Driver (M : Menu;\n                          K : Key_Code;\n                          P : Panel) return Boolean;\n\n      package Mh is new Sample.Menu_Demo.Handler (My_Driver);\n\n      Itm : Item_Array_Access := new Item_Array'\n        (New_Item (\"Menu Layout Options\"),\n         New_Item (\"Demo of Hook functions\"),\n         Null_Item);\n      M : Menu := New_Menu (Itm);\n\n      U1 : constant User_Data_Access := new User_Data'(4711);\n      U2 : User_Data_Access;\n      U3 : constant User_Data_Access := new User_Data'(4712);\n      U4 : User_Data_Access;\n\n      function My_Driver (M : Menu;\n                          K : Key_Code;\n                          P : Panel) return Boolean\n      is\n         Idx   : constant Positive := Get_Index (Current (M));\n      begin\n         if K in User_Key_Code'Range then\n            if K = QUIT then\n               return True;\n            elsif K = SELECT_ITEM then\n               if Idx in Itm'Range then\n                  Hide (P);\n                  Update_Panels;\n               end if;\n               case Idx is\n                  when 1 => Spacing_Demo.Spacing_Test;\n                  when others => Not_Implemented;\n               end case;\n               if Idx in Itm'Range then\n                  Top (P);\n                  Show (P);\n                  Update_Panels;\n                  Update_Screen;\n               end if;\n            end if;\n         end if;\n         return False;\n      end My_Driver;\n   begin\n      Push_Environment (\"MENU00\");\n      Notepad (\"MENU-PAD00\");\n      Default_Labels;\n      Refresh_Soft_Label_Keys_Without_Update;\n      Set_Pad_Character (M, '|');\n\n      MUD.Set_User_Data (M, U1);\n      IUD.Set_User_Data (Itm.all (1), U3);\n\n      Mh.Drive_Me (M);\n\n      MUD.Get_User_Data (M, U2);\n      pragma Assert (U1 = U2 and U1.all = 4711);\n\n      IUD.Get_User_Data (Itm.all (1), U4);\n      pragma Assert (U3 = U4 and U3.all = 4712);\n\n      Pop_Environment;\n      Delete (M);\n      Free (Itm, True);\n   end Demo;\n\nend Sample.Menu_Demo;\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}