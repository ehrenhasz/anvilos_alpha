{
  "module_name": "ncurses2-attr_test.adb",
  "hash_id": "85b795010338a33c90361ddfc5d05ac2a136909f4cfd1fc015faafe85c9c219d",
  "original_prompt": "Ingested from ncurses-6.4/Ada95/samples/ncurses2-attr_test.adb",
  "human_readable_source": "------------------------------------------------------------------------------\n--                                                                          --\n--                       GNAT ncurses Binding Samples                       --\n--                                                                          --\n--                                 ncurses                                  --\n--                                                                          --\n--                                 B O D Y                                  --\n--                                                                          --\n------------------------------------------------------------------------------\n-- Copyright 2020 Thomas E. Dickey                                          --\n-- Copyright 2000-2007,2008 Free Software Foundation, Inc.                  --\n--                                                                          --\n-- Permission is hereby granted, free of charge, to any person obtaining a  --\n-- copy of this software and associated documentation files (the            --\n-- \"Software\"), to deal in the Software without restriction, including      --\n-- without limitation the rights to use, copy, modify, merge, publish,      --\n-- distribute, distribute with modifications, sublicense, and/or sell       --\n-- copies of the Software, and to permit persons to whom the Software is    --\n-- furnished to do so, subject to the following conditions:                 --\n--                                                                          --\n-- The above copyright notice and this permission notice shall be included  --\n-- in all copies or substantial portions of the Software.                   --\n--                                                                          --\n-- THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS  --\n-- OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF               --\n-- MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.   --\n-- IN NO EVENT SHALL THE ABOVE COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,   --\n-- DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR    --\n-- OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR    --\n-- THE USE OR OTHER DEALINGS IN THE SOFTWARE.                               --\n--                                                                          --\n-- Except as contained in this notice, the name(s) of the above copyright   --\n-- holders shall not be used in advertising or otherwise to promote the     --\n-- sale, use or other dealings in this Software without prior written       --\n-- authorization.                                                           --\n------------------------------------------------------------------------------\n--  Author: Eugene V. Melaragno <aldomel@ix.netcom.com> 2000\n--  Version Control\n--  $Revision: 1.10 $\n--  $Date: 2020/02/02 23:34:34 $\n--  Binding Version 01.00\n------------------------------------------------------------------------------\nwith ncurses2.util; use ncurses2.util;\nwith Terminal_Interface.Curses; use Terminal_Interface.Curses;\nwith Terminal_Interface.Curses.Terminfo;\nuse Terminal_Interface.Curses.Terminfo;\nwith Ada.Characters.Handling;\nwith Ada.Strings.Fixed;\n\nprocedure ncurses2.attr_test is\n\n   function  subset (super, sub : Character_Attribute_Set) return Boolean;\n   function  intersect (b, a : Character_Attribute_Set) return Boolean;\n   function  has_A_COLOR (attr : Attributed_Character) return Boolean;\n   function  show_attr (row  : Line_Position;\n                        skip : Natural;\n                        attr : Character_Attribute_Set;\n                        name : String;\n                        once : Boolean) return Line_Position;\n   procedure attr_getc (skip : in out Integer;\n                        fg, bg : in out Color_Number;\n                        result : out Boolean);\n\n   function subset (super, sub : Character_Attribute_Set) return Boolean is\n   begin\n      if\n        (super.Stand_Out or not sub.Stand_Out) and\n        (super.Under_Line or not sub.Under_Line) and\n        (super.Reverse_Video or not sub.Reverse_Video) and\n        (super.Blink or not sub.Blink) and\n        (super.Dim_Character or not sub.Dim_Character) and\n        (super.Bold_Character or not sub.Bold_Character) and\n        (super.Alternate_Character_Set or not sub.Alternate_Character_Set) and\n        (super.Invisible_Character or not sub.Invisible_Character) -- and\n--      (super.Protected_Character or not sub.Protected_Character) and\n--      (super.Horizontal or not sub.Horizontal) and\n--      (super.Left or not sub.Left) and\n--      (super.Low or not sub.Low) and\n--      (super.Right or not sub.Right) and\n--      (super.Top or not sub.Top) and\n--      (super.Vertical or not sub.Vertical)\n      then\n         return True;\n      else\n         return False;\n      end if;\n   end subset;\n\n   function intersect (b, a : Character_Attribute_Set) return Boolean is\n   begin\n      if\n        (a.Stand_Out and b.Stand_Out) or\n        (a.Under_Line and b.Under_Line) or\n        (a.Reverse_Video and b.Reverse_Video) or\n        (a.Blink and b.Blink) or\n        (a.Dim_Character and b.Dim_Character) or\n        (a.Bold_Character and b.Bold_Character) or\n        (a.Alternate_Character_Set and b.Alternate_Character_Set) or\n        (a.Invisible_Character and b.Invisible_Character) -- or\n--      (a.Protected_Character and b.Protected_Character) or\n--      (a.Horizontal and b.Horizontal) or\n--      (a.Left and b.Left) or\n--      (a.Low and b.Low) or\n--      (a.Right and b.Right) or\n--      (a.Top and b.Top) or\n--      (a.Vertical and b.Vertical)\n      then\n         return True;\n      else\n         return False;\n      end if;\n   end intersect;\n\n   function has_A_COLOR (attr : Attributed_Character) return Boolean is\n   begin\n      if attr.Color /= Color_Pair (0) then\n         return True;\n      else\n         return False;\n      end if;\n   end has_A_COLOR;\n\n   --  Print some text with attributes.\n   function show_attr (row  : Line_Position;\n                       skip : Natural;\n                       attr : Character_Attribute_Set;\n                       name : String;\n                       once : Boolean) return Line_Position is\n\n      function make_record (n : Integer) return Character_Attribute_Set;\n      function make_record (n : Integer) return Character_Attribute_Set is\n         --  unsupported means true\n         a : Character_Attribute_Set := (others => False);\n         m : Integer;\n         rest : Integer;\n      begin\n         --  ncv is a bitmap with these fields\n         --              A_STANDOUT,\n         --              A_UNDERLINE,\n         --              A_REVERSE,\n         --              A_BLINK,\n         --              A_DIM,\n         --              A_BOLD,\n         --              A_INVIS,\n         --              A_PROTECT,\n         --              A_ALTCHARSET\n         --  It means no_color_video,\n         --  video attributes that can't be used with colors\n         --  see man terminfo.5\n         m := n mod 2;\n         rest := n / 2;\n         if 1 = m then\n            a.Stand_Out := True;\n         end if;\n         m := rest mod 2;\n         rest := rest / 2;\n         if 1 = m then\n            a.Under_Line := True;\n         end if;\n         m := rest mod 2;\n         rest := rest / 2;\n         if 1 = m then\n            a.Reverse_Video := True;\n         end if;\n         m := rest mod 2;\n         rest := rest / 2;\n         if 1 = m then\n            a.Blink := True;\n         end if;\n         m := rest mod 2;\n         rest := rest / 2;\n         if 1 = m then\n            a.Bold_Character := True;\n         end if;\n         m := rest mod 2;\n         rest := rest / 2;\n         if 1 = m then\n            a.Invisible_Character := True;\n         end if;\n         m := rest mod 2;\n         rest := rest / 2;\n         if 1 = m then\n            a.Protected_Character := True;\n         end if;\n         m := rest mod 2;\n         rest := rest / 2;\n         if 1 = m then\n            a.Alternate_Character_Set := True;\n         end if;\n\n         return a;\n      end make_record;\n\n      ncv : constant Integer := Get_Number (\"ncv\");\n\n   begin\n      Move_Cursor (Line => row, Column => 8);\n      Add (Str => name & \" mode:\");\n      Move_Cursor (Line => row, Column => 24);\n      Add (Ch => '|');\n      if skip /= 0 then\n         --  printw(\"%*s\", skip, \" \")\n         Add (Str => Ada.Strings.Fixed.\"*\" (skip, ' '));\n      end if;\n      if once then\n         Switch_Character_Attribute (Attr => attr);\n      else\n         Set_Character_Attributes (Attr => attr);\n      end if;\n      Add (Str => \"abcde fghij klmno pqrst uvwxy z\");\n      if once then\n         Switch_Character_Attribute (Attr => attr, On => False);\n      end if;\n      if skip /= 0 then\n         Add (Str => Ada.Strings.Fixed.\"*\" (skip, ' '));\n      end if;\n      Add (Ch => '|');\n      if attr /= Normal_Video then\n         declare begin\n            if not subset (super => Supported_Attributes, sub => attr) then\n               Add (Str => \" (N/A)\");\n            elsif ncv > 0 and has_A_COLOR (Get_Background) then\n               declare\n                  Color_Supported_Attributes :\n                    constant Character_Attribute_Set := make_record (ncv);\n               begin\n                  if intersect (Color_Supported_Attributes, attr) then\n                     Add (Str => \" (NCV) \");\n                  end if;\n               end;\n            end if;\n         end;\n      end if;\n      return row + 2;\n   end show_attr;\n\n   procedure attr_getc (skip : in out Integer;\n                        fg, bg : in out Color_Number;\n                        result : out Boolean) is\n      ch : constant Key_Code := Getchar;\n      nc : constant Color_Number := Color_Number (Number_Of_Colors);\n   begin\n      result := True;\n      if Ada.Characters.Handling.Is_Digit (Character'Val (ch)) then\n         skip := ctoi (Code_To_Char (ch));\n      elsif ch = CTRL ('L') then\n         Touch;\n         Touch (Current_Window);\n         Refresh;\n      elsif Has_Colors then\n         case ch is\n            --  Note the mathematical elegance compared to the C version.\n            when Character'Pos ('f') => fg := (fg + 1) mod nc;\n            when Character'Pos ('F') => fg := (fg - 1) mod nc;\n            when Character'Pos ('b') => bg := (bg + 1) mod nc;\n            when Character'Pos ('B') => bg := (bg - 1) mod nc;\n            when others =>\n               result := False;\n         end case;\n      else\n         result := False;\n      end if;\n   end attr_getc;\n\n   --      pairs could be defined as array ( Color_Number(0) .. colors - 1) of\n   --      array (Color_Number(0).. colors - 1) of Boolean;\n   pairs : array (Color_Pair'Range) of Boolean := (others => False);\n   fg, bg : Color_Number := Black; -- = 0;\n   xmc : constant Integer := Get_Number (\"xmc\");\n   skip : Integer := xmc;\n   n : Integer;\n\n   use Int_IO;\n\nbegin\n   pairs (0) := True;\n\n   if skip < 0 then\n      skip := 0;\n   end if;\n   n := skip;\n\n   loop\n      declare\n         row : Line_Position := 2;\n         normal : Attributed_Character := Blank2;\n         --  ???\n      begin\n         --  row := 2; -- weird, row is set to 0 without this.\n         --  TODO delete the above line, it was a gdb quirk that confused me\n         if Has_Colors then\n            declare pair : constant Color_Pair :=\n              Color_Pair (fg * Color_Number (Number_Of_Colors) + bg);\n            begin\n               --  Go though each color pair. Assume that the number of\n               --  Redefinable_Color_Pairs is 8*8 with predefined Colors 0..7\n               if not pairs (pair) then\n                  Init_Pair (pair, fg, bg);\n                  pairs (pair) := True;\n               end if;\n               normal.Color := pair;\n            end;\n         end if;\n         Set_Background (Ch => normal);\n         Erase;\n\n         Add (Line => 0, Column => 20,\n              Str => \"Character attribute test display\");\n\n         row := show_attr (row, n, (Stand_Out => True, others => False),\n                           \"STANDOUT\", True);\n         row := show_attr (row, n, (Reverse_Video => True, others => False),\n                           \"REVERSE\", True);\n         row := show_attr (row, n, (Bold_Character => True, others => False),\n                           \"BOLD\", True);\n         row := show_attr (row, n, (Under_Line => True, others => False),\n                           \"UNDERLINE\", True);\n         row := show_attr (row, n, (Dim_Character => True, others => False),\n                           \"DIM\", True);\n         row := show_attr (row, n, (Blink => True, others => False),\n                           \"BLINK\", True);\n--       row := show_attr (row, n, (Protected_Character => True,\n--                                  others => False), \"PROTECT\", True);\n         row := show_attr (row, n, (Invisible_Character => True,\n                                    others => False), \"INVISIBLE\", True);\n         row := show_attr (row, n, Normal_Video, \"NORMAL\", False);\n\n         Move_Cursor (Line => row, Column => 8);\n         if xmc > -1 then\n            Add (Str => \"This terminal does have the magic-cookie glitch\");\n         else\n            Add (Str => \"This terminal does not have the magic-cookie glitch\");\n         end if;\n         Move_Cursor (Line => row + 1, Column => 8);\n         Add (Str => \"Enter a digit to set gaps on each side of \" &\n              \"displayed attributes\");\n         Move_Cursor (Line => row + 2, Column => 8);\n         Add (Str => \"^L = repaint\");\n         if Has_Colors then\n            declare tmp1 : String (1 .. 1);\n            begin\n               Add (Str => \".  f/F/b/F toggle colors (\");\n               Put (tmp1, Integer (fg));\n               Add (Str => tmp1);\n               Add (Ch => '/');\n               Put (tmp1, Integer (bg));\n               Add (Str => tmp1);\n               Add (Ch => ')');\n            end;\n         end if;\n         Refresh;\n      end;\n\n      declare result : Boolean; begin\n         attr_getc (n, fg, bg, result);\n         exit when not result;\n      end;\n   end loop;\n\n   Set_Background (Ch => Blank2);\n   Erase;\n   End_Windows;\nend ncurses2.attr_test;\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}