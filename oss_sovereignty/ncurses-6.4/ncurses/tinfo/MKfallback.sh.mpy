{
  "module_name": "MKfallback.sh",
  "hash_id": "20e99efc23e19fb720f26ee70e7e92478f744c2e73a0266f420f1727269f7a30",
  "original_prompt": "Ingested from ncurses-6.4/ncurses/tinfo/MKfallback.sh",
  "human_readable_source": "#!/bin/sh\n##############################################################################\n# Copyright 2020 Thomas E. Dickey                                            #\n# Copyright 1998-2019,2020 Free Software Foundation, Inc.                    #\n#                                                                            #\n# Permission is hereby granted, free of charge, to any person obtaining a    #\n# copy of this software and associated documentation files (the \"Software\"), #\n# to deal in the Software without restriction, including without limitation  #\n# the rights to use, copy, modify, merge, publish, distribute, distribute    #\n# with modifications, sublicense, and/or sell copies of the Software, and to #\n# permit persons to whom the Software is furnished to do so, subject to the  #\n# following conditions:                                                      #\n#                                                                            #\n# The above copyright notice and this permission notice shall be included in #\n# all copies or substantial portions of the Software.                        #\n#                                                                            #\n# THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR #\n# IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,   #\n# FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL    #\n# THE ABOVE COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER      #\n# LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING    #\n# FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER        #\n# DEALINGS IN THE SOFTWARE.                                                  #\n#                                                                            #\n# Except as contained in this notice, the name(s) of the above copyright     #\n# holders shall not be used in advertising or otherwise to promote the sale, #\n# use or other dealings in this Software without prior written               #\n# authorization.                                                             #\n##############################################################################\n# $Id: MKfallback.sh,v 1.25 2020/08/16 15:58:44 tom Exp $\n#\n# MKfallback.sh -- create fallback table for entry reads\n#\n# This script generates source code for a custom version of read_entry.c\n# that (instead of reading capabilities for an argument terminal type\n# from an on-disk terminfo tree) tries to match the type with one of a\n# specified list of types generated in.\n#\n\nterminfo_dir=$1\nshift\n\nterminfo_src=$1\nshift\n\ntic_path=$1\ntest -z \"$tic_path\" && tic_path=tic\nshift\n\ninfocmp_path=$1\ntest -z \"$infocmp_path\" && infocmp_path=infocmp\nshift\n\ncase \"$tic_path\" in #(vi\n/*)\n\ttic_head=`echo \"$tic_path\" | sed -e 's,/[^/]*$,,'`\n\tPATH=$tic_head:$PATH\n\texport PATH\n\t;;\nesac\n\nif test $# != 0 ; then\n\ttmp_info=tmp_info\n\techo creating temporary terminfo directory... >&2\n\n\tTERMINFO=`pwd`/$tmp_info\n\texport TERMINFO\n\n\tTERMINFO_DIRS=$TERMINFO:$terminfo_dir\n\texport TERMINFO_DIRS\n\n\t\"$tic_path\" -x \"$terminfo_src\" >&2\nelse\n\ttmp_info=\nfi\n\ncat <<EOF\n/* This file was generated by $0 */\n\n/*\n * DO NOT EDIT THIS FILE BY HAND!\n */\n\n#include <curses.priv.h>\n\nEOF\n\nif [ \"$*\" ]\nthen\n\tcat <<EOF\n#include <tic.h>\n\n/* fallback entries for: $* */\nEOF\n\tfor x in \"$@\"\n\tdo\n\t\techo \"/* $x */\"\n\t\t\"$infocmp_path\" -E \"$x\" | sed -e 's/\\<short\\>/NCURSES_INT2/g'\n\tdone\n\n\tcat <<EOF\nstatic const TERMTYPE2 fallbacks[$#] =\n{\nEOF\n\tcomma=\"\"\n\tfor x in \"$@\"\n\tdo\n\t\techo \"$comma /* $x */\"\n\t\t\"$infocmp_path\" -e \"$x\"\n\t\tcomma=\",\"\n\tdone\n\n\tcat <<EOF\n};\n\nEOF\nfi\n\ncat <<EOF\nNCURSES_EXPORT(const TERMTYPE2 *)\n_nc_fallback2 (const char *name GCC_UNUSED)\n{\nEOF\n\nif [ \"$*\" ]\nthen\n\tcat <<EOF\n    const TERMTYPE2\t*tp;\n\n    for (tp = fallbacks;\n\t tp < fallbacks + sizeof(fallbacks)/sizeof(TERMTYPE2);\n\t tp++) {\n\tif (_nc_name_match(tp->term_names, name, \"|\")) {\n\t    return(tp);\n\t}\n    }\nEOF\nelse\n\techo \"\t/* the fallback list is empty */\";\nfi\n\ncat <<EOF\n    return((const TERMTYPE2 *)0);\n}\n\n#if NCURSES_EXT_NUMBERS\n#undef _nc_fallback\n\n/*\n * This entrypoint is used by tack 1.07\n */\nNCURSES_EXPORT(const TERMTYPE *)\n_nc_fallback (const char *name)\n{\n    const TERMTYPE2 *tp = _nc_fallback2(name);\n    const TERMTYPE *result = 0;\n    if (tp != 0) {\n\tstatic TERMTYPE temp;\n\t_nc_export_termtype2(&temp, tp);\n\tresult = &temp;\n    }\n    return result;\n}\n#endif\nEOF\n\nif test -n \"$tmp_info\" ; then\n\techo removing temporary terminfo directory... >&2\n\trm -rf $tmp_info\nfi\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}