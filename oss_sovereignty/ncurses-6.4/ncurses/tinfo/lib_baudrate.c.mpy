{
  "module_name": "lib_baudrate.c",
  "hash_id": "97afc6e33ab768f45684f15ce52a3108158477c5fbd140947ba61521c0481c7c",
  "original_prompt": "Ingested from ncurses-6.4/ncurses/tinfo/lib_baudrate.c",
  "human_readable_source": " \n\n \n\n \n\n#include <curses.priv.h>\n#include <termcap.h>\t\t \n#if defined(__FreeBSD__) || defined(__OpenBSD__)\n#include <sys/param.h>\n#endif\n\n \n#if NCURSES_OSPEED_COMPAT && \\\n \t((defined(__FreeBSD__) && (__FreeBSD_version < 700000)) || \\\n\tdefined(__NetBSD__) || \\\n\t((defined(__OpenBSD__) && OpenBSD < 201510)) || \\\n\tdefined(__APPLE__))\n#undef B0\n#undef B50\n#undef B75\n#undef B110\n#undef B134\n#undef B150\n#undef B200\n#undef B300\n#undef B600\n#undef B1200\n#undef B1800\n#undef B2400\n#undef B4800\n#undef B9600\n#undef B19200\n#undef EXTA\n#undef B38400\n#undef EXTB\n#undef B57600\n#undef B115200\n#undef B230400\n#undef B460800\n#undef B921600\n#define USE_OLD_TTY\n#include <sys/ttydev.h>\n#else\n#undef USE_OLD_TTY\n#endif  \n\nMODULE_ID(\"$Id: lib_baudrate.c,v 1.45 2020/09/05 21:15:32 tom Exp $\")\n\n \n\nstruct speed {\n    int given_speed;\t\t \n    int actual_speed;\t\t \n};\n\n#if !defined(EXP_WIN32_DRIVER)\n#define DATA(number) { B##number, number }\n\nstatic struct speed const speeds[] =\n{\n    DATA(0),\n    DATA(50),\n    DATA(75),\n    DATA(110),\n    DATA(134),\n    DATA(150),\n    DATA(200),\n    DATA(300),\n    DATA(600),\n    DATA(1200),\n    DATA(1800),\n    DATA(2400),\n    DATA(4800),\n    DATA(9600),\n#ifdef B19200\n    DATA(19200),\n#elif defined(EXTA)\n    {EXTA, 19200},\n#endif\n#ifdef B28800\n    DATA(28800),\n#endif\n#ifdef B38400\n    DATA(38400),\n#elif defined(EXTB)\n    {EXTB, 38400},\n#endif\n#ifdef B57600\n    DATA(57600),\n#endif\n     \n#if !(NCURSES_OSPEED_COMPAT && defined(__FreeBSD__) && (__FreeBSD_version > 700000))\n#ifdef B76800\n    DATA(76800),\n#endif\n#ifdef B115200\n    DATA(115200),\n#endif\n#ifdef B153600\n    DATA(153600),\n#endif\n#ifdef B230400\n    DATA(230400),\n#endif\n#ifdef B307200\n    DATA(307200),\n#endif\n#ifdef B460800\n    DATA(460800),\n#endif\n#ifdef B500000\n    DATA(500000),\n#endif\n#ifdef B576000\n    DATA(576000),\n#endif\n#ifdef B921600\n    DATA(921600),\n#endif\n#ifdef B1000000\n    DATA(1000000),\n#endif\n#ifdef B1152000\n    DATA(1152000),\n#endif\n#ifdef B1500000\n    DATA(1500000),\n#endif\n#ifdef B2000000\n    DATA(2000000),\n#endif\n#ifdef B2500000\n    DATA(2500000),\n#endif\n#ifdef B3000000\n    DATA(3000000),\n#endif\n#ifdef B3500000\n    DATA(3500000),\n#endif\n#ifdef B4000000\n    DATA(4000000),\n#endif\n#endif\n};\n#endif  \n\nNCURSES_EXPORT(int)\n_nc_baudrate(int OSpeed)\n{\n#if defined(EXP_WIN32_DRIVER)\n     \n    (void) OSpeed;\n    return (OK);\n#else\n#if !USE_REENTRANT\n    static int last_OSpeed;\n    static int last_baudrate;\n#endif\n\n    int result = ERR;\n\n    if (OSpeed < 0)\n\tOSpeed = (NCURSES_OSPEED) OSpeed;\n    if (OSpeed < 0)\n\tOSpeed = (unsigned short) OSpeed;\n#if !USE_REENTRANT\n    if (OSpeed == last_OSpeed) {\n\tresult = last_baudrate;\n    }\n#endif\n    if (result == ERR) {\n\tif (OSpeed >= 0) {\n\t    unsigned i;\n\n\t    for (i = 0; i < SIZEOF(speeds); i++) {\n\t\tif (speeds[i].given_speed > OSpeed) {\n\t\t    break;\n\t\t}\n\t\tif (speeds[i].given_speed == OSpeed) {\n\t\t    result = speeds[i].actual_speed;\n\t\t    break;\n\t\t}\n\t    }\n\t}\n#if !USE_REENTRANT\n\tif (OSpeed != last_OSpeed) {\n\t    last_OSpeed = OSpeed;\n\t    last_baudrate = result;\n\t}\n#endif\n    }\n    return (result);\n#endif  \n}\n\nNCURSES_EXPORT(int)\n_nc_ospeed(int BaudRate)\n{\n    int result = 1;\n#if defined(EXP_WIN32_DRIVER)\n    (void) BaudRate;\n#else\n    if (BaudRate >= 0) {\n\tunsigned i;\n\n\tfor (i = 0; i < SIZEOF(speeds); i++) {\n\t    if (speeds[i].actual_speed == BaudRate) {\n\t\tresult = speeds[i].given_speed;\n\t\tbreak;\n\t    }\n\t}\n    }\n#endif\n    return (result);\n}\n\nNCURSES_EXPORT(int)\nNCURSES_SP_NAME(baudrate) (NCURSES_SP_DCL0)\n{\n    int result;\n\n    T((T_CALLED(\"baudrate(%p)\"), (void *) SP_PARM));\n\n#if defined(EXP_WIN32_DRIVER)\n    result = OK;\n#else\n     \n#ifdef TRACE\n    if (IsValidTIScreen(SP_PARM)\n\t&& !NC_ISATTY(fileno((SP_PARM && SP_PARM->_ofp) ? SP_PARM->_ofp : stdout))\n\t&& getenv(\"BAUDRATE\") != 0) {\n\tint ret;\n\tif ((ret = _nc_getenv_num(\"BAUDRATE\")) <= 0)\n\t    ret = 9600;\n\tospeed = (NCURSES_OSPEED) _nc_ospeed(ret);\n\treturnCode(ret);\n    }\n#endif\n\n    if (IsValidTIScreen(SP_PARM)) {\n#ifdef USE_OLD_TTY\n\tresult = (int) cfgetospeed(&(TerminalOf(SP_PARM)->Nttyb));\n\tospeed = (NCURSES_OSPEED) _nc_ospeed(result);\n#else  \n#ifdef TERMIOS\n\tospeed = (NCURSES_OSPEED) cfgetospeed(&(TerminalOf(SP_PARM)->Nttyb));\n#else\n\tospeed = (NCURSES_OSPEED) TerminalOf(SP_PARM)->Nttyb.sg_ospeed;\n#endif\n\tresult = _nc_baudrate(ospeed);\n#endif\n\tTerminalOf(SP_PARM)->_baudrate = result;\n    } else {\n\tresult = ERR;\n    }\n#endif  \n    returnCode(result);\n}\n\n#if NCURSES_SP_FUNCS\nNCURSES_EXPORT(int)\nbaudrate(void)\n{\n    return NCURSES_SP_NAME(baudrate) (CURRENT_SCREEN);\n}\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}