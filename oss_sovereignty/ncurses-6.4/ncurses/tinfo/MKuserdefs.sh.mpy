{
  "module_name": "MKuserdefs.sh",
  "hash_id": "8a4fa8d7d83091d1f2b9d7d03dee52c3361a9afc259c208fe2f48d8e98b4e44b",
  "original_prompt": "Ingested from ncurses-6.4/ncurses/tinfo/MKuserdefs.sh",
  "human_readable_source": "#!/bin/sh\n##############################################################################\n# Copyright 2019,2020 Thomas E. Dickey                                       #\n#                                                                            #\n# Permission is hereby granted, free of charge, to any person obtaining a    #\n# copy of this software and associated documentation files (the \"Software\"), #\n# to deal in the Software without restriction, including without limitation  #\n# the rights to use, copy, modify, merge, publish, distribute, distribute    #\n# with modifications, sublicense, and/or sell copies of the Software, and to #\n# permit persons to whom the Software is furnished to do so, subject to the  #\n# following conditions:                                                      #\n#                                                                            #\n# The above copyright notice and this permission notice shall be included in #\n# all copies or substantial portions of the Software.                        #\n#                                                                            #\n# THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR #\n# IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,   #\n# FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL    #\n# THE ABOVE COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER      #\n# LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING    #\n# FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER        #\n# DEALINGS IN THE SOFTWARE.                                                  #\n#                                                                            #\n# Except as contained in this notice, the name(s) of the above copyright     #\n# holders shall not be used in advertising or otherwise to promote the sale, #\n# use or other dealings in this Software without prior written               #\n# authorization.                                                             #\n##############################################################################\n# $Id: MKuserdefs.sh,v 1.10 2020/02/02 23:34:34 tom Exp $\nAWK=${1-awk}; shift 1\nOPT1=${1-0}; shift 1\n\ncat <<EOF\n/*\n * generated by $0\n */\n\nEOF\n\ncat <<'EOF'\n/*\n *    comp_userdefs.c -- The names of widely used user-defined capabilities\n *                       indexed via a hash table for the compiler.\n *\n */\n\n#include <curses.priv.h>\n#include <tic.h>\n#include <hashsize.h>\n\n#if NCURSES_XNAMES\nEOF\n\ncat \"$@\" | ./make_hash 1 user $OPT1\n\ncat <<EOF\n\n#define USERTABSIZE SIZEOF(user_names_data)\n\n#if $OPT1\nstatic void\nnext_string(const char *strings, unsigned *offset)\n{\n    *offset += (unsigned) strlen(strings + *offset) + 1;\n}\n\nstatic const struct user_table_entry *\n_nc_build_names(struct user_table_entry **actual,\n\t\tconst user_table_data *source,\n\t\tconst char *strings)\n{\n    if (*actual == 0) {\n\t*actual = typeCalloc(struct user_table_entry, USERTABSIZE);\n\tif (*actual != 0) {\n\t    unsigned n;\n\t    unsigned len = 0;\n\t    for (n = 0; n < USERTABSIZE; ++n) {\n\t\t(*actual)[n].ute_name = strings + len;\n\t\t(*actual)[n].ute_type = (int) source[n].ute_type;\n\t\t(*actual)[n].ute_argc = source[n].ute_argc;\n\t\t(*actual)[n].ute_args = source[n].ute_args;\n\t\t(*actual)[n].ute_index = source[n].ute_index;\n\t\t(*actual)[n].ute_link = source[n].ute_link;\n\t\tnext_string(strings, &len);\n\t    }\n\t}\n    }\n    return *actual;\n}\n\n#define build_names(root) _nc_build_names(&_nc_##root##_table, \\\\\n\t\t\t\t\t  root##_names_data, \\\\\n\t\t\t\t\t  root##_names_text)\n#else\n#define build_names(root) _nc_ ## root ## _table\n#endif\n\nNCURSES_EXPORT(const struct user_table_entry *) _nc_get_userdefs_table (void)\n{\n    return build_names(user) ;\n}\n\nstatic HashValue\ninfo_hash(const char *string)\n{\n    long sum = 0;\n\n    DEBUG(9, (\"hashing %s\", string));\n    while (*string) {\n\tsum += (long) (*string + (*(string + 1) << 8));\n\tstring++;\n    }\n\n    DEBUG(9, (\"sum is %ld\", sum));\n    return (HashValue) (sum % HASHTABSIZE);\n}\n\nstatic int\ncompare_info_names(const char *a, const char *b)\n{\n    return !strcmp(a, b);\n}\n\nstatic const HashData hash_data[] = {\n    { HASHTABSIZE, _nc_user_hash_table, info_hash, compare_info_names }\n};\n\nNCURSES_EXPORT(const HashData *) _nc_get_hash_user (void)\n{\n    return hash_data;\n}\n\n#if NO_LEAKS\nNCURSES_EXPORT(void) _nc_comp_userdefs_leaks(void)\n{\n#if $OPT1\n    FreeIfNeeded(_nc_user_table);\n#endif\n}\n#endif /* NO_LEAKS */\n\n#else /*! NCURSES_XNAMES */\nNCURSES_EXPORT(void) _nc_comp_userdefs(void);\nNCURSES_EXPORT(void) _nc_comp_userdefs(void) { }\n#endif /* NCURSES_XNAMES */\nEOF\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}