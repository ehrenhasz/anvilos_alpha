{
  "module_name": "MKcodes.awk",
  "hash_id": "a0c4528cde9934ef3769d0d30af97a8bd4750d598e44a3821822f8eb4a4d0995",
  "original_prompt": "Ingested from ncurses-6.4/ncurses/tinfo/MKcodes.awk",
  "human_readable_source": "##############################################################################\n# Copyright 2019,2020 Thomas E. Dickey                                       #\n# Copyright 2007-2009,2010 Free Software Foundation, Inc.                    #\n#                                                                            #\n# Permission is hereby granted, free of charge, to any person obtaining a    #\n# copy of this software and associated documentation files (the \"Software\"), #\n# to deal in the Software without restriction, including without limitation  #\n# the rights to use, copy, modify, merge, publish, distribute, distribute    #\n# with modifications, sublicense, and/or sell copies of the Software, and to #\n# permit persons to whom the Software is furnished to do so, subject to the  #\n# following conditions:                                                      #\n#                                                                            #\n# The above copyright notice and this permission notice shall be included in #\n# all copies or substantial portions of the Software.                        #\n#                                                                            #\n# THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR #\n# IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,   #\n# FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL    #\n# THE ABOVE COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER      #\n# LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING    #\n# FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER        #\n# DEALINGS IN THE SOFTWARE.                                                  #\n#                                                                            #\n# Except as contained in this notice, the name(s) of the above copyright     #\n# holders shall not be used in advertising or otherwise to promote the sale, #\n# use or other dealings in this Software without prior written               #\n# authorization.                                                             #\n##############################################################################\n# $Id: MKcodes.awk,v 1.11 2020/02/02 23:34:34 tom Exp $\nfunction large_item(value) {\n\tresult = sprintf(\"%d,\", offset);\n\toffset = offset + length(value) + 1;\n\toffcol = offcol + length(result) + 2;\n\tif (offcol > 70) {\n\t\tresult = result \"\\n\";\n\t\toffcol = 0;\n\t} else {\n\t\tresult = result \" \";\n\t}\n\tbigstr = bigstr sprintf(\"\\\"%s\\\\0\\\" \", value);\n\tbigcol = bigcol + length(value) + 5;\n\tif (bigcol > 70) {\n\t\tbigstr = bigstr \"\\\\\\n\";\n\t\tbigcol = 0;\n\t}\n\treturn result;\n}\n\nfunction small_item(value) {\n\treturn sprintf(\"\\t\\t\\\"%s\\\",\\n\", value);\n}\n\nfunction print_strings(name,value) {\n\tprintf  \"DCL(%s) = {\\n\", name\n\tprint  value\n\tprint  \"\\t\\t(NCURSES_CONST char *)0,\"\n\tprint  \"};\"\n\tprint  \"\"\n}\n\nfunction print_offsets(name,value) {\n\tprintf  \"static const short _nc_offset_%s[] = {\\n\", name\n\tprintf \"%s\",  value\n\tprint  \"};\"\n\tprint  \"\"\n\tprintf \"static NCURSES_CONST char ** ptr_%s = 0;\\n\", name\n\tprint  \"\"\n}\n\nBEGIN\t{\n\t\tprint  \"/* This file was generated by MKcodes.awk */\"\n\t\tprint  \"\"\n\t\tprint  \"#include <curses.priv.h>\"\n\t\tprint  \"\"\n\t\tprint  \"#define IT NCURSES_CONST char * const\"\n\t\tprint  \"\"\n\t\toffset = 0;\n\t\toffcol = 0;\n\t\tbigcol = 0;\n\t}\n\n$1 ~ /^#/\t\t{next;}\n$1 ~ /^(cap|info)alias/\t{next;}\n\n$1 == \"userdef\"\t\t{next;}\n$1 == \"SKIPWARN\"\t{next;}\n\n$3 == \"bool\"\t{\n\t\t\tsmall_boolcodes = small_boolcodes small_item($4);\n\t\t\tlarge_boolcodes = large_boolcodes large_item($4);\n\t\t}\n\n$3 == \"num\"\t{\n\t\t\tsmall_numcodes = small_numcodes small_item($4);\n\t\t\tlarge_numcodes = large_numcodes large_item($4);\n\t\t}\n\n$3 == \"str\"\t{\n\t\t\tsmall_strcodes = small_strcodes small_item($4);\n\t\t\tlarge_strcodes = large_strcodes large_item($4);\n\t\t}\n\nEND\t{\n\t\tprint  \"\"\n\t\tprint  \"#if BROKEN_LINKER || USE_REENTRANT\"\n\t\tprint  \"\"\n\t\tif (bigstrings) {\n\t\t\tprintf \"static const char _nc_code_blob[] = \\n\"\n\t\t\tprintf \"%s;\\n\", bigstr;\n\t\t\tprint_offsets(\"boolcodes\", large_boolcodes);\n\t\t\tprint_offsets(\"numcodes\", large_numcodes);\n\t\t\tprint_offsets(\"strcodes\", large_strcodes);\n\t\t\tprint  \"\"\n\t\t\tprint  \"static IT *\"\n\t\t\tprint  \"alloc_array(NCURSES_CONST char ***value, const short *offsets, unsigned size)\"\n\t\t\tprint  \"{\"\n\t\t\tprint  \"\tif (*value == 0) {\"\n\t\t\tprint  \"\t\tif ((*value = typeCalloc(NCURSES_CONST char *, size + 1)) != 0) {\"\n\t\t\tprint  \"\t\t\tunsigned n;\"\n\t\t\tprint  \"\t\t\tfor (n = 0; n < size; ++n) {\"\n\t\t\tprint  \"\t\t\t\t(*value)[n] = (NCURSES_CONST char *) _nc_code_blob + offsets[n];\"\n\t\t\tprint  \"\t\t\t}\"\n\t\t\tprint  \"\t\t}\"\n\t\t\tprint  \"\t}\"\n\t\t\tprint  \"\treturn *value;\"\n\t\t\tprint  \"}\"\n\t\t\tprint  \"\"\n\t\t\tprint  \"#define FIX(it) NCURSES_IMPEXP IT * NCURSES_API NCURSES_PUBLIC_VAR(it)(void) { return alloc_array(&ptr_##it, _nc_offset_##it, SIZEOF(_nc_offset_##it)); }\"\n\t\t} else {\n\t\t\tprint  \"#define DCL(it) static IT data##it[]\"\n\t\t\tprint  \"\"\n\t\t\tprint_strings(\"boolcodes\", small_boolcodes);\n\t\t\tprint_strings(\"numcodes\", small_numcodes);\n\t\t\tprint_strings(\"strcodes\", small_strcodes);\n\t\t\tprint  \"#define FIX(it) NCURSES_IMPEXP IT * NCURSES_API NCURSES_PUBLIC_VAR(it)(void) { return data##it; }\"\n\t\t}\n\t\tprint  \"\"\n\t\tprint  \"/* remove public definition which conflicts with FIX() */\"\n\t\tprint  \"#undef boolcodes\"\n\t\tprint  \"#undef numcodes\"\n\t\tprint  \"#undef strcodes\"\n\t\tprint  \"\"\n\t\tprint  \"/* add local definition */\"\n\t\tprint  \"FIX(boolcodes)\"\n\t\tprint  \"FIX(numcodes)\"\n\t\tprint  \"FIX(strcodes)\"\n\t\tprint  \"\"\n\t\tprint  \"/* restore the public definition */\"\n\t\tprint  \"\"\n\t\tprint  \"#define FREE_FIX(it) if (ptr_##it) { FreeAndNull(ptr_##it); }\"\n\t\tprint  \"#define boolcodes  NCURSES_PUBLIC_VAR(boolcodes())\"\n\t\tprint  \"#define numcodes   NCURSES_PUBLIC_VAR(numcodes())\"\n\t\tprint  \"#define strcodes   NCURSES_PUBLIC_VAR(strcodes())\"\n\t\tprint  \"\"\n\t\tprint  \"#if NO_LEAKS\"\n\t\tprint  \"NCURSES_EXPORT(void)\"\n\t\tprint  \"_nc_codes_leaks(void)\"\n\t\tprint  \"{\"\n\t\tif (bigstrings) {\n\t\tprint  \"FREE_FIX(boolcodes)\"\n\t\tprint  \"FREE_FIX(numcodes)\"\n\t\tprint  \"FREE_FIX(strcodes)\"\n\t\t}\n\t\tprint  \"}\"\n\t\tprint  \"#endif\"\n\t\tprint  \"\"\n\t\tprint  \"#else\"\n\t\tprint  \"\"\n\t\tprint  \"#define DCL(it) NCURSES_EXPORT_VAR(IT) it[]\"\n\t\tprint  \"\"\n\t\tprint_strings(\"boolcodes\", small_boolcodes);\n\t\tprint_strings(\"numcodes\", small_numcodes);\n\t\tprint_strings(\"strcodes\", small_strcodes);\n\t\tprint  \"\"\n\t\tprint  \"#endif /* BROKEN_LINKER */\"\n\t}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}