{
  "module_name": "lib_cur_term.c",
  "hash_id": "5970a2800ff6372ca8c16e349cd802192285fa1b9fa1eab1a2cba3643c8dfb37",
  "original_prompt": "Ingested from ncurses-6.4/ncurses/tinfo/lib_cur_term.c",
  "human_readable_source": " \n\n \n \n\n#include <curses.priv.h>\n#include <termcap.h>\t\t \n#include <tic.h>\t\t \n\nMODULE_ID(\"$Id: lib_cur_term.c,v 1.49 2022/05/28 17:56:55 tom Exp $\")\n\n#undef CUR\n#define CUR TerminalType(termp).\n\n#if USE_REENTRANT\n\nNCURSES_EXPORT(TERMINAL *)\nNCURSES_SP_NAME(_nc_get_cur_term) (NCURSES_SP_DCL0)\n{\n    return ((0 != TerminalOf(SP_PARM)) ? TerminalOf(SP_PARM) : CurTerm);\n}\n\n#if NCURSES_SP_FUNCS\n\nNCURSES_EXPORT(TERMINAL *)\n_nc_get_cur_term(void)\n{\n    return NCURSES_SP_NAME(_nc_get_cur_term) (CURRENT_SCREEN);\n}\n#endif\n\nNCURSES_EXPORT(TERMINAL *)\nNCURSES_PUBLIC_VAR(cur_term) (void)\n{\n#if NCURSES_SP_FUNCS\n    return NCURSES_SP_NAME(_nc_get_cur_term) (CURRENT_SCREEN);\n#else\n    return NCURSES_SP_NAME(_nc_get_cur_term) (NCURSES_SP_ARG);\n#endif\n}\n\n#else\nNCURSES_EXPORT_VAR(TERMINAL *) cur_term = 0;\n#endif\n\nNCURSES_EXPORT(TERMINAL *)\nNCURSES_SP_NAME(set_curterm) (NCURSES_SP_DCLx TERMINAL *termp)\n{\n    TERMINAL *oldterm;\n\n    T((T_CALLED(\"set_curterm(%p)\"), (void *) termp));\n\n    _nc_lock_global(curses);\n    oldterm = cur_term;\n    if (SP_PARM)\n\tSP_PARM->_term = termp;\n#if USE_REENTRANT\n    CurTerm = termp;\n#else\n    cur_term = termp;\n#endif\n    if (termp != 0) {\n#ifdef USE_TERM_DRIVER\n\tTERMINAL_CONTROL_BLOCK *TCB = (TERMINAL_CONTROL_BLOCK *) termp;\n\tospeed = (NCURSES_OSPEED) _nc_ospeed(termp->_baudrate);\n\tif (TCB->drv &&\n\t    TCB->drv->isTerminfo &&\n\t    TerminalType(termp).Strings) {\n\t    PC = (char) (VALID_STRING(pad_char) ? pad_char[0] : 0);\n\t}\n\tTCB->csp = SP_PARM;\n#else\n\tospeed = (NCURSES_OSPEED) _nc_ospeed(termp->_baudrate);\n\tif (TerminalType(termp).Strings) {\n\t    PC = (char) (VALID_STRING(pad_char) ? pad_char[0] : 0);\n\t}\n#endif\n#if !USE_REENTRANT\n\tsave_ttytype(termp);\n#endif\n    }\n    _nc_unlock_global(curses);\n\n    T((T_RETURN(\"%p\"), (void *) oldterm));\n    return (oldterm);\n}\n\n#if NCURSES_SP_FUNCS\nNCURSES_EXPORT(TERMINAL *)\nset_curterm(TERMINAL *termp)\n{\n    return NCURSES_SP_NAME(set_curterm) (CURRENT_SCREEN, termp);\n}\n#endif\n\nNCURSES_EXPORT(int)\nNCURSES_SP_NAME(del_curterm) (NCURSES_SP_DCLx TERMINAL *termp)\n{\n    int rc = ERR;\n\n    T((T_CALLED(\"del_curterm(%p, %p)\"), (void *) SP_PARM, (void *) termp));\n\n    if (termp != 0) {\n#ifdef USE_TERM_DRIVER\n\tTERMINAL_CONTROL_BLOCK *TCB = (TERMINAL_CONTROL_BLOCK *) termp;\n#endif\n\tTERMINAL *cur = (\n#if USE_REENTRANT\n\t\t\t    NCURSES_SP_NAME(_nc_get_cur_term) (NCURSES_SP_ARG)\n#else\n\t\t\t    cur_term\n#endif\n\t);\n\n#if NCURSES_EXT_NUMBERS\n#if NCURSES_EXT_COLORS\n\t_nc_free_termtype1(&termp->type);\n#else\n\t_nc_free_termtype2(&termp->type);\n#endif\n#endif\n\t_nc_free_termtype2(&TerminalType(termp));\n\tif (termp == cur)\n\t    NCURSES_SP_NAME(set_curterm) (NCURSES_SP_ARGx 0);\n\n\tFreeIfNeeded(termp->_termname);\n#if USE_HOME_TERMINFO\n\tif (_nc_globals.home_terminfo != 0) {\n\t    FreeAndNull(_nc_globals.home_terminfo);\n\t}\n#endif\n#ifdef USE_TERM_DRIVER\n\tif (TCB->drv)\n\t    TCB->drv->td_release(TCB);\n#endif\n#if NO_LEAKS\n\t \n\t_nc_tgetent_leak(termp);\n#endif\n\tif (--_nc_globals.terminal_count == 0) {\n\t    _nc_free_tparm(termp);\n\t}\n\n\tfree(termp->tparm_state.fmt_buff);\n\tfree(termp->tparm_state.out_buff);\n\tfree(termp);\n\n\trc = OK;\n    }\n\n    returnCode(rc);\n}\n\n#if NCURSES_SP_FUNCS\nNCURSES_EXPORT(int)\ndel_curterm(TERMINAL *termp)\n{\n    int rc;\n\n    _nc_lock_global(curses);\n    rc = NCURSES_SP_NAME(del_curterm) (CURRENT_SCREEN, termp);\n    _nc_unlock_global(curses);\n\n    return (rc);\n}\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}