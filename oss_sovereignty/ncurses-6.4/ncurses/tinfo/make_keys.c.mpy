{
  "module_name": "make_keys.c",
  "hash_id": "d55d5b605daaffc682dc31daa5e7e372187426c687d0c2351b3495dc64fe1748",
  "original_prompt": "Ingested from ncurses-6.4/ncurses/tinfo/make_keys.c",
  "human_readable_source": " \n\n \n\n \n\n#define USE_TERMLIB 1\n#include <build.priv.h>\n\nMODULE_ID(\"$Id: make_keys.c,v 1.23 2021/08/18 20:55:25 tom Exp $\")\n\n#include <names.c>\n\nstatic unsigned\nunknown(void)\n{\n    static unsigned result = 0;\n\n    if (result == 0) {\n\tunsigned n;\n\tfor (n = 0; strnames[n] != 0; n++) {\n\t    ++result;\n\t}\n\tfor (n = 0; strfnames[n] != 0; n++) {\n\t    ++result;\n\t}\n    }\n    return result;\n}\n\nstatic unsigned\nlookup(const char *name)\n{\n    unsigned n;\n    bool found = FALSE;\n    for (n = 0; strnames[n] != 0; n++) {\n\tif (!strcmp(name, strnames[n])) {\n\t    found = TRUE;\n\t    break;\n\t}\n    }\n    if (!found) {\n\tfor (n = 0; strfnames[n] != 0; n++) {\n\t    if (!strcmp(name, strfnames[n])) {\n\t\tfound = TRUE;\n\t\tbreak;\n\t    }\n\t}\n    }\n    return found ? n : unknown();\n}\n\nstatic void\nmake_keys(FILE *ifp, FILE *ofp)\n{\n    char buffer[BUFSIZ];\n    char from[256];\n    char to[256];\n    unsigned ignore = unknown();\n    unsigned maxlen = 16;\n    int scanned;\n\n    while (fgets(buffer, (int) sizeof(buffer), ifp) != 0) {\n\tif (*buffer == '#')\n\t    continue;\n\n\tto[sizeof(to) - 1] = '\\0';\n\tfrom[sizeof(from) - 1] = '\\0';\n\n\tscanned = sscanf(buffer, \"%255s %255s\", to, from);\n\tif (scanned == 2) {\n\t    unsigned code = lookup(from);\n\t    if (code == ignore)\n\t\tcontinue;\n\t    if (strlen(from) > maxlen)\n\t\tmaxlen = (unsigned) strlen(from);\n\t    fprintf(ofp, \"\\t{ %4u, %-*.*s },\\t/* %s */\\n\",\n\t\t    code,\n\t\t    (int) maxlen, (int) maxlen,\n\t\t    to,\n\t\t    from);\n\t}\n    }\n}\n\nstatic void\nwrite_list(FILE *ofp, const char **list)\n{\n    while (*list != 0)\n\tfprintf(ofp, \"%s\\n\", *list++);\n}\n\nint\nmain(int argc, char *argv[])\n{\n    static const char *prefix[] =\n    {\n\t\"#ifndef _INIT_KEYTRY_H\",\n\t\"#define _INIT_KEYTRY_H 1\",\n\t\"\",\n\t\"/* This file was generated by MAKE_KEYS */\",\n\t\"\",\n\t\"#include <tic.h>\",\n\t\"\",\n\t\"#if BROKEN_LINKER\",\n\t\"static\",\n\t\"#endif\",\n\t\"const struct tinfo_fkeys _nc_tinfo_fkeys[] = {\",\n\t0\n    };\n    static const char *suffix[] =\n    {\n\t\"\\t{ 0, 0} };\",\n\t\"\",\n\t\"#endif /* _INIT_KEYTRY_H */\",\n\t0\n    };\n\n    write_list(stdout, prefix);\n    if (argc > 1) {\n\tint n;\n\tfor (n = 1; n < argc; n++) {\n\t    FILE *fp = fopen(argv[n], \"r\");\n\t    if (fp != 0) {\n\t\tmake_keys(fp, stdout);\n\t\tfclose(fp);\n\t    }\n\t}\n    } else {\n\tmake_keys(stdin, stdout);\n    }\n    write_list(stdout, suffix);\n    return EXIT_SUCCESS;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}