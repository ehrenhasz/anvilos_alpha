{
  "module_name": "lib_win32util.c",
  "hash_id": "8aba7def309b614c2656a262cc5a48c5b73e7fc33809fd9b21ad50f1188993c4",
  "original_prompt": "Ingested from ncurses-6.4/ncurses/tinfo/lib_win32util.c",
  "human_readable_source": " \n\n \n\n#include <curses.priv.h>\n\nMODULE_ID(\"$Id: lib_win32util.c,v 1.2 2021/09/04 10:54:35 tom Exp $\")\n\n#ifdef _NC_WINDOWS\n#include <io.h>\n\n#ifdef _NC_CHECK_MINTTY\n#define PSAPI_VERSION 2\n#include <psapi.h>\n#include <tchar.h>\n\n#define array_length(a) (sizeof(a)/sizeof(a[0]))\n\n \nNCURSES_EXPORT(int)\n_nc_console_checkmintty(int fd, LPHANDLE pMinTTY)\n{\n    HANDLE handle = _nc_console_handle(fd);\n    DWORD dw;\n    int code = 0;\n\n    T((T_CALLED(\"lib_winhelper::_nc_console_checkmintty(%d, %p)\"), fd, pMinTTY));\n\n    if (handle != INVALID_HANDLE_VALUE) {\n        dw = GetFileType(handle);\n\tif (dw == FILE_TYPE_PIPE) {\n\t    if (GetNamedPipeInfo(handle, 0, 0, 0, 0)) {\n\t        ULONG pPid;\n\t\t \n\t\tif (GetNamedPipeServerProcessId(handle, &pPid)) {\n\t\t    TCHAR buf[MAX_PATH];\n\t\t    DWORD len = 0;\n\t\t     \n\t\t    HANDLE pHandle = OpenProcess(\n\t\t\t\t\t\t PROCESS_CREATE_THREAD\n\t\t\t\t\t\t | PROCESS_QUERY_INFORMATION\n\t\t\t\t\t\t | PROCESS_VM_OPERATION\n\t\t\t\t\t\t | PROCESS_VM_WRITE\n\t\t\t\t\t\t | PROCESS_VM_READ,\n\t\t\t\t\t\t FALSE,\n\t\t\t\t\t\t pPid);\n\t\t    if (pMinTTY)\n\t\t        *pMinTTY = INVALID_HANDLE_VALUE;\n\t\t    if (pHandle != INVALID_HANDLE_VALUE) {\n\t\t        if ((len = GetProcessImageFileName(\n\t\t\t\t\t\t\t   pHandle,\n\t\t\t\t\t\t\t   buf,\n\t\t\t\t\t\t\t   (DWORD)\n\t\t\t\t\t\t\t   array_length(buf)))) {\n\t\t\t    TCHAR *pos = _tcsrchr(buf, _T('\\\\'));\n\t\t\t    if (pos) {\n\t\t\t        pos++;\n\t\t\t\tif (_tcsnicmp(pos, _TEXT(\"mintty.exe\"), 10)\n\t\t\t\t    == 0) {\n\t\t\t\t    if (pMinTTY)\n\t\t\t\t        *pMinTTY = pHandle;\n\t\t\t\t    code = 1;\n\t\t\t\t}\n\t\t\t    }\n\t\t\t}\n\t\t    }\n\t\t}\n\t    }\n\t}\n    }\n    returnCode(code);\n}\n#endif  \n\f\n#define JAN1970 116444736000000000LL\t \n\nNCURSES_EXPORT(int)\n_nc_gettimeofday(struct timeval *tv, void *tz GCC_UNUSED)\n{\n    union {\n\tFILETIME ft;\n\tlong long since1601;\t \n    } data;\n\n    GetSystemTimeAsFileTime(&data.ft);\n    tv->tv_usec = (long) ((data.since1601 / 10LL) % 1000000LL);\n    tv->tv_sec = (long) ((data.since1601 - JAN1970) / 10000000LL);\n    return (0);\n}\n\n#endif \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}