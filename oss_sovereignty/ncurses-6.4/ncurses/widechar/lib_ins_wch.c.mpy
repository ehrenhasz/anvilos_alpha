{
  "module_name": "lib_ins_wch.c",
  "hash_id": "77d10919fdf8c58e9accfff985b1761b33404c36e28218c89362f1638584e411",
  "original_prompt": "Ingested from ncurses-6.4/ncurses/widechar/lib_ins_wch.c",
  "human_readable_source": " \n\n \n\n \n\n#include <curses.priv.h>\n\nMODULE_ID(\"$Id: lib_ins_wch.c,v 1.25 2020/12/05 20:04:59 tom Exp $\")\n\n \nNCURSES_EXPORT(int)\n_nc_insert_wch(WINDOW *win, const cchar_t *wch)\n{\n    int cells = _nc_wacs_width(CharOf(CHDEREF(wch)));\n    int code = OK;\n\n    if (cells < 0) {\n\tcode = winsch(win, (chtype) CharOf(CHDEREF(wch)));\n    } else {\n\tif (cells == 0)\n\t    cells = 1;\n\n\tif (win->_curx <= win->_maxx) {\n\t    int cell;\n\t    struct ldat *line = &(win->_line[win->_cury]);\n\t    NCURSES_CH_T *end = &(line->text[win->_curx]);\n\t    NCURSES_CH_T *temp1 = &(line->text[win->_maxx]);\n\t    NCURSES_CH_T *temp2 = temp1 - cells;\n\n\t    CHANGED_TO_EOL(line, win->_curx, win->_maxx);\n\t    while (temp1 > end)\n\t\t*temp1-- = *temp2--;\n\n\t    *temp1 = _nc_render(win, *wch);\n\t    for (cell = 1; cell < cells; ++cell) {\n\t\tSetWidecExt(temp1[cell], cell);\n\t    }\n\n\t    win->_curx = (NCURSES_SIZE_T) (win->_curx + cells);\n\t}\n    }\n    return code;\n}\n\nNCURSES_EXPORT(int)\nwins_wch(WINDOW *win, const cchar_t *wch)\n{\n    int code = ERR;\n\n    T((T_CALLED(\"wins_wch(%p, %s)\"), (void *) win, _tracecchar_t(wch)));\n\n    if (win != 0) {\n\tNCURSES_SIZE_T oy = win->_cury;\n\tNCURSES_SIZE_T ox = win->_curx;\n\n\tcode = _nc_insert_wch(win, wch);\n\n\twin->_curx = ox;\n\twin->_cury = oy;\n\t_nc_synchook(win);\n    }\n    returnCode(code);\n}\n\nNCURSES_EXPORT(int)\nwins_nwstr(WINDOW *win, const wchar_t *wstr, int n)\n{\n    int code = ERR;\n\n    T((T_CALLED(\"wins_nwstr(%p,%s,%d)\"),\n       (void *) win, _nc_viswbufn(wstr, n), n));\n\n    if (win != 0\n\t&& wstr != 0) {\n\tif (n < 1)\n\t    n = INT_MAX;\n\tcode = OK;\n\n\tif (n > 0) {\n\t    const wchar_t *cp;\n\t    SCREEN *sp = _nc_screen_of(win);\n\t    NCURSES_SIZE_T oy = win->_cury;\n\t    NCURSES_SIZE_T ox = win->_curx;\n\n\t    for (cp = wstr; (*cp != L'\\0') && ((cp - wstr) < n); cp++) {\n\t\tint len = _nc_wacs_width(*cp);\n\n\t\tif ((len >= 0 && len != 1) || !is7bits(*cp)) {\n\t\t    cchar_t tmp_cchar;\n\t\t    wchar_t tmp_wchar = *cp;\n\t\t    memset(&tmp_cchar, 0, sizeof(tmp_cchar));\n\t\t    (void) setcchar(&tmp_cchar,\n\t\t\t\t    &tmp_wchar,\n\t\t\t\t    WA_NORMAL,\n\t\t\t\t    (short) 0,\n\t\t\t\t    (void *) 0);\n\t\t    code = _nc_insert_wch(win, &tmp_cchar);\n\t\t} else {\n\t\t     \n\t\t    code = _nc_insert_ch(sp, win, (chtype) (*cp));\n\t\t}\n\t\tif (code != OK)\n\t\t    break;\n\t    }\n\n\t    win->_curx = ox;\n\t    win->_cury = oy;\n\t    _nc_synchook(win);\n\t}\n    }\n    returnCode(code);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}