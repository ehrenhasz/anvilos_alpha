{
  "module_name": "widechars.c",
  "hash_id": "fd24afa9268ba60b24e98faf93d3ede3892403c52dc6819bec882d6c832254e0",
  "original_prompt": "Ingested from ncurses-6.4/ncurses/widechar/widechars.c",
  "human_readable_source": " \n\n#include <curses.priv.h>\n\n#if USE_WIDEC_SUPPORT\n\nMODULE_ID(\"$Id: widechars.c,v 1.9 2020/08/29 16:22:03 juergen Exp $\")\n\n#if (defined(_NC_WINDOWS)) && !defined(_NC_MSC)\n \n\nint\n_nc_mbtowc(wchar_t *pwc, const char *s, size_t n)\n{\n    int result;\n    int count;\n    int try;\n\n    if (s != 0 && n != 0) {\n\t \n\tcount = 0;\n\tfor (try = 1; try <= (int) n; ++try) {\n\t    count = MultiByteToWideChar(CP_UTF8,\n\t\t\t\t\tMB_ERR_INVALID_CHARS,\n\t\t\t\t\ts,\n\t\t\t\t\ttry,\n\t\t\t\t\tpwc,\n\t\t\t\t\t0);\n\t    TR(TRACE_BITS, (\"...try %d:%d\", try, count));\n\t    if (count > 0) {\n\t\tbreak;\n\t    }\n\t}\n\tif (count < 1 || count > 2) {\n\t    result = -1;\n\t} else {\n\t    wchar_t actual[2];\n\t    memset(&actual, 0, sizeof(actual));\n\t    count = MultiByteToWideChar(CP_UTF8,\n\t\t\t\t\tMB_ERR_INVALID_CHARS,\n\t\t\t\t\ts,\n\t\t\t\t\ttry,\n\t\t\t\t\tactual,\n\t\t\t\t\t2);\n\t    TR(TRACE_BITS, (\"\\twin32 ->%#x, %#x\", actual[0], actual[1]));\n\t    *pwc = actual[0];\n\t    if (actual[1] != 0)\n\t\tresult = -1;\n\t    else\n\t\tresult = try;\n\t}\n    } else {\n\tresult = 0;\n    }\n\n    return result;\n}\n\nint\n_nc_mblen(const char *s, size_t n)\n{\n    int result = -1;\n    int count;\n    wchar_t temp;\n\n    if (s != 0 && n != 0) {\n\tcount = _nc_mbtowc(&temp, s, n);\n\tif (count == 1) {\n\t    int check = WideCharToMultiByte(CP_UTF8,\n\t\t\t\t\t    0,\n\t\t\t\t\t    &temp,\n\t\t\t\t\t    1,\n\t\t\t\t\t    NULL,\n\t\t\t\t\t    0,\t \n\t\t\t\t\t    NULL,\n\t\t\t\t\t    NULL);\n\t    TR(TRACE_BITS, (\"\\tcheck ->%d\\n\", check));\n\t    if (check > 0 && (size_t) check <= n) {\n\t\tresult = check;\n\t    }\n\t}\n    } else {\n\tresult = 0;\n    }\n\n    return result;\n}\n\nint __MINGW_NOTHROW\n_nc_wctomb(char *s, wchar_t wc)\n{\n    int result;\n    int check;\n\n    check = WideCharToMultiByte(CP_UTF8,\n\t\t\t\t0,\n\t\t\t\t&wc,\n\t\t\t\t1,\n\t\t\t\tNULL,\n\t\t\t\t0,\t \n\t\t\t\tNULL,\n\t\t\t\tNULL);\n    if (check > 0) {\n\tresult = WideCharToMultiByte(CP_UTF8,\n\t\t\t\t     0,\n\t\t\t\t     &wc,\n\t\t\t\t     1,\n\t\t\t\t     s,\n\t\t\t\t     check + 1,\n\t\t\t\t     NULL,\n\t\t\t\t     NULL);\n    } else {\n\tresult = -1;\n    }\n    return result;\n}\n\n#endif  \n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}