{
  "module_name": "varargs.c",
  "hash_id": "e0d831e67485af05d9babe0619cb8c767bf012ae89f5b329f19ea5a41d8946e4",
  "original_prompt": "Ingested from ncurses-6.4/ncurses/trace/varargs.c",
  "human_readable_source": " \n\n \n\n#include <curses.priv.h>\n\n#include <ctype.h>\n\nMODULE_ID(\"$Id: varargs.c,v 1.12 2020/02/02 23:34:34 tom Exp $\")\n\n#ifdef TRACE\n\n#define MAX_PARMS 10\n\ntypedef enum {\n    atUnknown = 0, atInteger, atFloat, atPoint, atString\n} ARGTYPE;\n\n#define VA_INT(type) ival = (int) va_arg(ap, type)\n#define VA_FLT(type) fval = va_arg(ap, type)\n#define VA_PTR(type) pval = (char *)va_arg(ap, type)\n#define VA_STR(type) sval = va_arg(ap, type)\n\n#define MyBuffer _nc_globals.tracearg_buf\n#define MyLength _nc_globals.tracearg_used\n\n \nNCURSES_EXPORT(char *)\n_nc_varargs(const char *fmt, va_list ap)\n{\n    static char dummy[] = \"\";\n\n    char buffer[BUFSIZ];\n    const char *param;\n    int n;\n\n    if (fmt == 0 || *fmt == '\\0')\n\treturn dummy;\n    if (MyLength == 0)\n\tMyBuffer = typeMalloc(char, MyLength = BUFSIZ);\n    if (MyBuffer == 0)\n\treturn dummy;\n    *MyBuffer = '\\0';\n\n    while (*fmt != '\\0') {\n\tif (*fmt == '%') {\n\t    char *pval = 0;\t \n\t    const char *sval = \"\";\n\t    double fval = 0.0;\n\t    int done = FALSE;\n\t    int ival = 0;\n\t    int type = 0;\n\t    ARGTYPE parm[MAX_PARMS];\n\t    int parms = 0;\n\t    ARGTYPE used = atUnknown;\n\n\t    while (*++fmt != '\\0' && !done) {\n\n\t\tif (*fmt == '*') {\n\t\t    VA_INT(int);\n\t\t    if (parms < MAX_PARMS)\n\t\t\tparm[parms++] = atInteger;\n\t\t} else if (isalpha(UChar(*fmt))) {\n\t\t    done = TRUE;\n\t\t    switch (*fmt) {\n\t\t    case 'Z':\t \n\t\t    case 'h':\t \n\t\t    case 'l':\t \n\t\t\tdone = FALSE;\n\t\t\ttype = *fmt;\n\t\t\tbreak;\n\t\t    case 'i':\t \n\t\t    case 'd':\t \n\t\t    case 'u':\t \n\t\t    case 'x':\t \n\t\t    case 'X':\t \n\t\t\tif (type == 'l')\n\t\t\t    VA_INT(long);\n\t\t\telse if (type == 'Z')\n\t\t\t    VA_INT(size_t);\n\t\t\telse\n\t\t\t    VA_INT(int);\n\t\t\tused = atInteger;\n\t\t\tbreak;\n\t\t    case 'f':\t \n\t\t    case 'e':\t \n\t\t    case 'E':\t \n\t\t    case 'g':\t \n\t\t    case 'G':\t \n\t\t\tVA_FLT(double);\n\t\t\tused = atFloat;\n\t\t\tbreak;\n\t\t    case 'c':\n\t\t\tVA_INT(int);\n\t\t\tused = atInteger;\n\t\t\tbreak;\n\t\t    case 's':\n\t\t\tVA_STR(const char *);\n\t\t\tused = atString;\n\t\t\tbreak;\n\t\t    case 'p':\n\t\t\tVA_PTR(void *);\n\t\t\tused = atPoint;\n\t\t\tbreak;\n\t\t    case 'n':\n\t\t\tVA_PTR(int *);\n\t\t\tused = atPoint;\n\t\t\tbreak;\n\t\t    default:\n\t\t\tbreak;\n\t\t    }\n\t\t} else if (*fmt == '%') {\n\t\t    done = TRUE;\n\t\t}\n\t\tif (used != atUnknown && parms < MAX_PARMS) {\n\t\t    parm[parms++] = used;\n\t\t    for (n = 0; n < parms; ++n) {\n\t\t\tused = parm[n];\n\t\t\tparam = buffer;\n\t\t\tswitch (used) {\n\t\t\tcase atInteger:\n\t\t\t    _nc_SPRINTF(buffer, _nc_SLIMIT(sizeof(buffer))\n\t\t\t\t\t\"%d\", ival);\n\t\t\t    break;\n\t\t\tcase atFloat:\n\t\t\t    _nc_SPRINTF(buffer, _nc_SLIMIT(sizeof(buffer))\n\t\t\t\t\t\"%f\", fval);\n\t\t\t    break;\n\t\t\tcase atPoint:\n\t\t\t    _nc_SPRINTF(buffer, _nc_SLIMIT(sizeof(buffer))\n\t\t\t\t\t\"%p\", pval);\n\t\t\t    break;\n\t\t\tcase atString:\n\t\t\t    param = _nc_visbuf2(1, sval);\n\t\t\t    break;\n\t\t\tcase atUnknown:\n\t\t\tdefault:\n\t\t\t    _nc_STRCPY(buffer, \"?\", sizeof(buffer));\n\t\t\t    break;\n\t\t\t}\n\t\t\tMyLength += strlen(param) + 2;\n\t\t\tMyBuffer = typeRealloc(char, MyLength, MyBuffer);\n\t\t\tif (MyBuffer != 0) {\n\t\t\t    _nc_SPRINTF(MyBuffer + strlen(MyBuffer),\n\t\t\t\t\t_nc_SLIMIT(MyLength - strlen(MyBuffer))\n\t\t\t\t\t\", %s\", param);\n\t\t\t}\n\t\t    }\n\t\t}\n\t\tused = atUnknown;\n\t    }\n\t} else {\n\t    fmt++;\n\t}\n    }\n\n    return (MyBuffer ? MyBuffer : dummy);\n}\n#else\nEMPTY_MODULE(_nc_varargs)\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}