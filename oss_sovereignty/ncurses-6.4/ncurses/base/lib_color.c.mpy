{
  "module_name": "lib_color.c",
  "hash_id": "3148955f32cbecb699a4e4e37914bab85bd8b673c3081e87c82702d0f12df456",
  "original_prompt": "Ingested from ncurses-6.4/ncurses/base/lib_color.c",
  "human_readable_source": " \n\n \n\n \n\n#define NEW_PAIR_INTERNAL 1\n\n#include <curses.priv.h>\n#include <new_pair.h>\n#include <tic.h>\n\n#ifndef CUR\n#define CUR SP_TERMTYPE\n#endif\n\nMODULE_ID(\"$Id: lib_color.c,v 1.149 2022/04/30 18:36:54 tom Exp $\")\n\n#ifdef USE_TERM_DRIVER\n#define CanChange      InfoOf(SP_PARM).canchange\n#define DefaultPalette InfoOf(SP_PARM).defaultPalette\n#define HasColor       InfoOf(SP_PARM).hascolor\n#define InitColor      InfoOf(SP_PARM).initcolor\n#define MaxColors      InfoOf(SP_PARM).maxcolors\n#define MaxPairs       InfoOf(SP_PARM).maxpairs\n#define UseHlsPalette  (DefaultPalette == _nc_hls_palette)\n#else\n#define CanChange      can_change\n#define DefaultPalette (hue_lightness_saturation ? hls_palette : cga_palette)\n#define HasColor       has_color\n#define InitColor      initialize_color\n#define MaxColors      max_colors\n#define MaxPairs       max_pairs\n#define UseHlsPalette  (hue_lightness_saturation)\n#endif\n\n#ifndef USE_TERM_DRIVER\n \n#if USE_REENTRANT\nNCURSES_EXPORT(int)\nNCURSES_PUBLIC_VAR(COLOR_PAIRS) (void)\n{\n    return SP ? SP->_pair_count : -1;\n}\nNCURSES_EXPORT(int)\nNCURSES_PUBLIC_VAR(COLORS) (void)\n{\n    return SP ? SP->_color_count : -1;\n}\n#else\nNCURSES_EXPORT_VAR(int) COLOR_PAIRS = 0;\nNCURSES_EXPORT_VAR(int) COLORS = 0;\n#endif\n#endif  \n\n#define DATA(r,g,b) {r,g,b, 0,0,0, 0}\n\n#define MAX_PALETTE\t8\n\n#define OkColorHi(n)\t(((n) < COLORS) && ((n) < maxcolors))\n#define InPalette(n)\t((n) >= 0 && (n) < MAX_PALETTE)\n\n \n#define RGB_ON  680\n#define RGB_OFF 0\n \nstatic const color_t cga_palette[] =\n{\n     \n    DATA(RGB_OFF,\tRGB_OFF,\tRGB_OFF),\t \n    DATA(RGB_ON,\tRGB_OFF,\tRGB_OFF),\t \n    DATA(RGB_OFF,\tRGB_ON,\t\tRGB_OFF),\t \n    DATA(RGB_ON,\tRGB_ON,\t\tRGB_OFF),\t \n    DATA(RGB_OFF,\tRGB_OFF,\tRGB_ON),\t \n    DATA(RGB_ON,\tRGB_OFF,\tRGB_ON),\t \n    DATA(RGB_OFF,\tRGB_ON,\t\tRGB_ON),\t \n    DATA(RGB_ON,\tRGB_ON,\t\tRGB_ON),\t \n};\n\nstatic const color_t hls_palette[] =\n{\n     \n    DATA(\t0,\t0,\t0),\t\t \n    DATA(\t120,\t50,\t100),\t\t \n    DATA(\t240,\t50,\t100),\t\t \n    DATA(\t180,\t50,\t100),\t\t \n    DATA(\t330,\t50,\t100),\t\t \n    DATA(\t60,\t50,\t100),\t\t \n    DATA(\t300,\t50,\t100),\t\t \n    DATA(\t0,\t50,\t100),\t\t \n};\n\n#ifdef USE_TERM_DRIVER\nNCURSES_EXPORT_VAR(const color_t*) _nc_cga_palette = cga_palette;\nNCURSES_EXPORT_VAR(const color_t*) _nc_hls_palette = hls_palette;\n#endif\n\n \n#if NCURSES_EXT_FUNCS\n \nstatic int\ndefault_fg(NCURSES_SP_DCL0)\n{\n    return (SP_PARM != 0) ? SP_PARM->_default_fg : COLOR_WHITE;\n}\n\nstatic int\ndefault_bg(NCURSES_SP_DCL0)\n{\n    return SP_PARM != 0 ? SP_PARM->_default_bg : COLOR_BLACK;\n}\n#else\n#define default_fg(sp) COLOR_WHITE\n#define default_bg(sp) COLOR_BLACK\n#endif\n\n#ifndef USE_TERM_DRIVER\n \nstatic int\ntoggled_colors(int c)\n{\n    if (c < 16) {\n\tstatic const int table[] =\n\t{0, 4, 2, 6, 1, 5, 3, 7,\n\t 8, 12, 10, 14, 9, 13, 11, 15};\n\tc = table[c];\n    }\n    return c;\n}\n#endif\n\nstatic void\nset_background_color(NCURSES_SP_DCLx int bg, NCURSES_SP_OUTC outc)\n{\n#ifdef USE_TERM_DRIVER\n    CallDriver_3(SP_PARM, td_color, FALSE, bg, outc);\n#else\n    if (set_a_background) {\n\tTPUTS_TRACE(\"set_a_background\");\n\tNCURSES_SP_NAME(tputs) (NCURSES_SP_ARGx\n\t\t\t\tTIPARM_1(set_a_background, bg),\n\t\t\t\t1, outc);\n    } else {\n\tTPUTS_TRACE(\"set_background\");\n\tNCURSES_SP_NAME(tputs) (NCURSES_SP_ARGx\n\t\t\t\tTIPARM_1(set_background, toggled_colors(bg)),\n\t\t\t\t1, outc);\n    }\n#endif\n}\n\nstatic void\nset_foreground_color(NCURSES_SP_DCLx int fg, NCURSES_SP_OUTC outc)\n{\n#ifdef USE_TERM_DRIVER\n    CallDriver_3(SP_PARM, td_color, TRUE, fg, outc);\n#else\n    if (set_a_foreground) {\n\tTPUTS_TRACE(\"set_a_foreground\");\n\tNCURSES_SP_NAME(tputs) (NCURSES_SP_ARGx\n\t\t\t\tTIPARM_1(set_a_foreground, fg),\n\t\t\t\t1, outc);\n    } else {\n\tTPUTS_TRACE(\"set_foreground\");\n\tNCURSES_SP_NAME(tputs) (NCURSES_SP_ARGx\n\t\t\t\tTIPARM_1(set_foreground, toggled_colors(fg)),\n\t\t\t\t1, outc);\n    }\n#endif\n}\n\nstatic void\ninit_color_table(NCURSES_SP_DCL0)\n{\n    const color_t *tp = DefaultPalette;\n    int n;\n\n    assert(tp != 0);\n\n    for (n = 0; n < COLORS; n++) {\n\tif (InPalette(n)) {\n\t    SP_PARM->_color_table[n] = tp[n];\n\t} else {\n\t    SP_PARM->_color_table[n] = tp[n % MAX_PALETTE];\n\t    if (UseHlsPalette) {\n\t\tSP_PARM->_color_table[n].green = 100;\n\t    } else {\n\t\tif (SP_PARM->_color_table[n].red)\n\t\t    SP_PARM->_color_table[n].red = 1000;\n\t\tif (SP_PARM->_color_table[n].green)\n\t\t    SP_PARM->_color_table[n].green = 1000;\n\t\tif (SP_PARM->_color_table[n].blue)\n\t\t    SP_PARM->_color_table[n].blue = 1000;\n\t    }\n\t}\n    }\n}\n\nstatic bool\ninit_direct_colors(NCURSES_SP_DCL0)\n{\n    static NCURSES_CONST char name[] = \"RGB\";\n\n    rgb_bits_t *result = &(SP_PARM->_direct_color);\n\n    result->value = 0;\n\n    if (COLORS >= 8) {\n\tint n;\n\tconst char *s;\n\tint width;\n\n\t \n\tfor (width = 0; (1 << width) - 1 < (COLORS - 1); ++width) {\n\t    ;\n\t}\n\n\tif (tigetflag(name) > 0) {\n\t    n = (width + 2) / 3;\n\t    result->bits.red = UChar(n);\n\t    result->bits.green = UChar(n);\n\t    result->bits.blue = UChar(width - (2 * n));\n\t} else if ((n = tigetnum(name)) > 0) {\n\t    result->bits.red = UChar(n);\n\t    result->bits.green = UChar(n);\n\t    result->bits.blue = UChar(n);\n\t} else if ((s = tigetstr(name)) != 0 && VALID_STRING(s)) {\n\t    int red = n;\n\t    int green = n;\n\t    int blue = width - (2 * n);\n\n\t    switch (sscanf(s, \"%d/%d/%d\", &red, &green, &blue)) {\n\t    default:\n\t\tblue = width - (2 * n);\n\t\t \n\t    case 1:\n\t\tgreen = n;\n\t\t \n\t    case 2:\n\t\tred = n;\n\t\t \n\t    case 3:\n\t\t \n\t\tbreak;\n\t    }\n\t    result->bits.red = UChar(red);\n\t    result->bits.green = UChar(green);\n\t    result->bits.blue = UChar(blue);\n\t}\n    }\n    return (result->value != 0);\n}\n\n \nstatic bool\nreset_color_pair(NCURSES_SP_DCL0)\n{\n#ifdef USE_TERM_DRIVER\n    return CallDriver(SP_PARM, td_rescol);\n#else\n    bool result = FALSE;\n\n    (void) SP_PARM;\n    if (orig_pair != 0) {\n\t(void) NCURSES_PUTP2(\"orig_pair\", orig_pair);\n\tresult = TRUE;\n    }\n    return result;\n#endif\n}\n\n \nNCURSES_EXPORT(bool)\nNCURSES_SP_NAME(_nc_reset_colors) (NCURSES_SP_DCL0)\n{\n    int result = FALSE;\n\n    T((T_CALLED(\"_nc_reset_colors(%p)\"), (void *) SP_PARM));\n    if (SP_PARM->_color_defs > 0)\n\tSP_PARM->_color_defs = -(SP_PARM->_color_defs);\n    if (reset_color_pair(NCURSES_SP_ARG))\n\tresult = TRUE;\n\n#ifdef USE_TERM_DRIVER\n    result = CallDriver(SP_PARM, td_rescolors);\n#else\n    if (orig_colors != 0) {\n\tNCURSES_PUTP2(\"orig_colors\", orig_colors);\n\tresult = TRUE;\n    }\n#endif\n    returnBool(result);\n}\n\n#if NCURSES_SP_FUNCS\nNCURSES_EXPORT(bool)\n_nc_reset_colors(void)\n{\n    return NCURSES_SP_NAME(_nc_reset_colors) (CURRENT_SCREEN);\n}\n#endif\n\nNCURSES_EXPORT(int)\nNCURSES_SP_NAME(start_color) (NCURSES_SP_DCL0)\n{\n    int result = ERR;\n\n    T((T_CALLED(\"start_color(%p)\"), (void *) SP_PARM));\n\n    if (SP_PARM == 0) {\n\tresult = ERR;\n    } else if (SP_PARM->_coloron) {\n\tresult = OK;\n    } else {\n\tint maxpairs = MaxPairs;\n\tint maxcolors = MaxColors;\n\tif (reset_color_pair(NCURSES_SP_ARG) != TRUE) {\n\t    set_foreground_color(NCURSES_SP_ARGx\n\t\t\t\t default_fg(NCURSES_SP_ARG),\n\t\t\t\t NCURSES_SP_NAME(_nc_outch));\n\t    set_background_color(NCURSES_SP_ARGx\n\t\t\t\t default_bg(NCURSES_SP_ARG),\n\t\t\t\t NCURSES_SP_NAME(_nc_outch));\n\t}\n#if !NCURSES_EXT_COLORS\n\t \n\tif (maxpairs > 256)\n\t    maxpairs = 256;\n#endif\n\n\tif (maxpairs > 0 && maxcolors > 0) {\n\t    SP_PARM->_pair_limit = maxpairs;\n\n#if NCURSES_EXT_FUNCS\n\t     \n\t    SP_PARM->_pair_limit += (1 + (2 * maxcolors));\n#if !NCURSES_EXT_COLORS\n\t    SP_PARM->_pair_limit = limit_PAIRS(SP_PARM->_pair_limit);\n#endif\n#endif  \n\t    SP_PARM->_pair_count = maxpairs;\n\t    SP_PARM->_color_count = maxcolors;\n#if !USE_REENTRANT\n\t    COLOR_PAIRS = maxpairs;\n\t    COLORS = maxcolors;\n#endif\n\n\t    ReservePairs(SP_PARM, 16);\n\t    if (SP_PARM->_color_pairs != 0) {\n\t\tif (init_direct_colors(NCURSES_SP_ARG)) {\n\t\t    result = OK;\n\t\t} else {\n\t\t    TYPE_CALLOC(color_t, maxcolors, SP_PARM->_color_table);\n\t\t    if (SP_PARM->_color_table != 0) {\n\t\t\tMakeColorPair(SP_PARM->_color_pairs[0],\n\t\t\t\t      default_fg(NCURSES_SP_ARG),\n\t\t\t\t      default_bg(NCURSES_SP_ARG));\n\t\t\tinit_color_table(NCURSES_SP_ARG);\n\n\t\t\tresult = OK;\n\t\t    }\n\t\t}\n\t\tif (result == OK) {\n\t\t    T((\"started color: COLORS = %d, COLOR_PAIRS = %d\",\n\t\t       COLORS, COLOR_PAIRS));\n\n\t\t    SP_PARM->_coloron = 1;\n\t\t} else if (SP_PARM->_color_pairs != 0) {\n\t\t    FreeAndNull(SP_PARM->_color_pairs);\n\t\t}\n\t    }\n\t} else {\n\t    result = OK;\n\t}\n    }\n    returnCode(result);\n}\n\n#if NCURSES_SP_FUNCS\nNCURSES_EXPORT(int)\nstart_color(void)\n{\n    return NCURSES_SP_NAME(start_color) (CURRENT_SCREEN);\n}\n#endif\n\n \nstatic void\nrgb2hls(int r, int g, int b, int *h, int *l, int *s)\n \n{\n    int min, max, t;\n\n    if ((min = g < r ? g : r) > b)\n\tmin = b;\n    if ((max = g > r ? g : r) < b)\n\tmax = b;\n\n     \n    *l = ((min + max) / 20);\n\n    if (min == max) {\t\t \n\t*h = 0;\n\t*s = 0;\n\treturn;\n    }\n\n     \n    if (*l < 50)\n\t*s = (((max - min) * 100) / (max + min));\n    else\n\t*s = (((max - min) * 100) / (2000 - max - min));\n\n     \n    if (r == max)\n\tt = (120 + ((g - b) * 60) / (max - min));\n    else if (g == max)\n\tt = (240 + ((b - r) * 60) / (max - min));\n    else\n\tt = (360 + ((r - g) * 60) / (max - min));\n\n    *h = (t % 360);\n}\n\n \nNCURSES_EXPORT(void)\n_nc_change_pair(SCREEN *sp, int pair)\n{\n    int y, x;\n\n    if (CurScreen(sp)->_clear)\n\treturn;\n#if NO_LEAKS\n    if (_nc_globals.leak_checking)\n\treturn;\n#endif\n\n    for (y = 0; y <= CurScreen(sp)->_maxy; y++) {\n\tstruct ldat *ptr = &(CurScreen(sp)->_line[y]);\n\tbool changed = FALSE;\n\tfor (x = 0; x <= CurScreen(sp)->_maxx; x++) {\n\t    if (GetPair(ptr->text[x]) == pair) {\n\t\t \n\t\tSetChar(ptr->text[x], 0, 0);\n\t\tCHANGED_CELL(ptr, x);\n\t\tchanged = TRUE;\n\t    }\n\t}\n\tif (changed)\n\t    NCURSES_SP_NAME(_nc_make_oldhash) (NCURSES_SP_ARGx y);\n    }\n}\n\nNCURSES_EXPORT(void)\n_nc_reserve_pairs(SCREEN *sp, int want)\n{\n    int have = sp->_pair_alloc;\n\n    if (have == 0)\n\thave = 1;\n    while (have <= want)\n\thave *= 2;\n    if (have > sp->_pair_limit)\n\thave = sp->_pair_limit;\n\n    if (sp->_color_pairs == 0) {\n\tTYPE_CALLOC(colorpair_t, have, sp->_color_pairs);\n    } else if (have > sp->_pair_alloc) {\n#if NCURSES_EXT_COLORS\n\tcolorpair_t *next;\n\n\tif ((next = typeCalloc(colorpair_t, have)) == 0)\n\t    _nc_err_abort(MSG_NO_MEMORY);\n\tmemcpy(next, sp->_color_pairs, (size_t) sp->_pair_alloc * sizeof(*next));\n\t_nc_copy_pairs(sp, next, sp->_color_pairs, sp->_pair_alloc);\n\tfree(sp->_color_pairs);\n\tsp->_color_pairs = next;\n#else\n\tTYPE_REALLOC(colorpair_t, have, sp->_color_pairs);\n\tif (sp->_color_pairs != 0) {\n\t    memset(sp->_color_pairs + sp->_pair_alloc, 0,\n\t\t   sizeof(colorpair_t) * (size_t) (have - sp->_pair_alloc));\n\t}\n#endif\n    }\n    if (sp->_color_pairs != 0) {\n\tsp->_pair_alloc = have;\n    }\n}\n\n \nNCURSES_EXPORT(int)\n_nc_init_pair(SCREEN *sp, int pair, int f, int b)\n{\n    static colorpair_t null_pair;\n    colorpair_t result = null_pair;\n    colorpair_t previous;\n    int maxcolors;\n\n    T((T_CALLED(\"init_pair(%p,%d,%d,%d)\"), (void *) sp, pair, f, b));\n\n    if (!ValidPair(sp, pair))\n\treturnCode(ERR);\n\n    maxcolors = MaxColors;\n\n    ReservePairs(sp, pair);\n    previous = sp->_color_pairs[pair];\n#if NCURSES_EXT_FUNCS\n    if (sp->_default_color || sp->_assumed_color) {\n\tbool isDefault = FALSE;\n\tbool wasDefault = FALSE;\n\tint default_pairs = sp->_default_pairs;\n\n\t \n\tif (isDefaultColor(f)) {\n\t    f = COLOR_DEFAULT;\n\t    isDefault = TRUE;\n\t} else if (!OkColorHi(f)) {\n\t    returnCode(ERR);\n\t}\n\n\tif (isDefaultColor(b)) {\n\t    b = COLOR_DEFAULT;\n\t    isDefault = TRUE;\n\t} else if (!OkColorHi(b)) {\n\t    returnCode(ERR);\n\t}\n\n\t \n\tif (isDefaultColor(FORE_OF(previous))\n\t    || isDefaultColor(BACK_OF(previous)))\n\t    wasDefault = TRUE;\n\n\t \n\tif (isDefault && !wasDefault) {\n\t    ++default_pairs;\n\t} else if (wasDefault && !isDefault) {\n\t    --default_pairs;\n\t}\n\n\t \n\tif (pair > (sp->_pair_count + default_pairs)) {\n\t    returnCode(ERR);\n\t}\n\tsp->_default_pairs = default_pairs;\n    } else\n#endif\n    {\n\tif ((f < 0) || !OkColorHi(f)\n\t    || (b < 0) || !OkColorHi(b)\n\t    || (pair < 1)) {\n\t    returnCode(ERR);\n\t}\n    }\n\n     \n    MakeColorPair(result, f, b);\n    if ((FORE_OF(previous) != 0\n\t || BACK_OF(previous) != 0)\n\t&& !isSamePair(previous, result)) {\n\t_nc_change_pair(sp, pair);\n    }\n\n    _nc_reset_color_pair(sp, pair, &result);\n    sp->_color_pairs[pair] = result;\n    _nc_set_color_pair(sp, pair, cpINIT);\n\n    if (GET_SCREEN_PAIR(sp) == pair)\n\tSET_SCREEN_PAIR(sp, (int) (~0));\t \n\n#ifdef USE_TERM_DRIVER\n    CallDriver_3(sp, td_initpair, pair, f, b);\n#else\n    if (initialize_pair && InPalette(f) && InPalette(b)) {\n\tconst color_t *tp = DefaultPalette;\n\n\tTR(TRACE_ATTRS,\n\t   (\"initializing pair: pair = %d, fg=(%d,%d,%d), bg=(%d,%d,%d)\",\n\t    (int) pair,\n\t    (int) tp[f].red, (int) tp[f].green, (int) tp[f].blue,\n\t    (int) tp[b].red, (int) tp[b].green, (int) tp[b].blue));\n\n\tNCURSES_PUTP2(\"initialize_pair\",\n\t\t      TIPARM_7(initialize_pair,\n\t\t\t       pair,\n\t\t\t       (int) tp[f].red,\n\t\t\t       (int) tp[f].green,\n\t\t\t       (int) tp[f].blue,\n\t\t\t       (int) tp[b].red,\n\t\t\t       (int) tp[b].green,\n\t\t\t       (int) tp[b].blue));\n    }\n#endif\n\n    returnCode(OK);\n}\n\nNCURSES_EXPORT(int)\nNCURSES_SP_NAME(init_pair) (NCURSES_SP_DCLx\n\t\t\t    NCURSES_PAIRS_T pair,\n\t\t\t    NCURSES_COLOR_T f,\n\t\t\t    NCURSES_COLOR_T b)\n{\n    return _nc_init_pair(SP_PARM, pair, f, b);\n}\n\n#if NCURSES_SP_FUNCS\nNCURSES_EXPORT(int)\ninit_pair(NCURSES_COLOR_T pair, NCURSES_COLOR_T f, NCURSES_COLOR_T b)\n{\n    return NCURSES_SP_NAME(init_pair) (CURRENT_SCREEN, pair, f, b);\n}\n#endif\n\n#define okRGB(n) ((n) >= 0 && (n) <= 1000)\n\nNCURSES_EXPORT(int)\n_nc_init_color(SCREEN *sp, int color, int r, int g, int b)\n{\n    int result = ERR;\n    int maxcolors;\n\n    T((T_CALLED(\"init_color(%p,%d,%d,%d,%d)\"),\n       (void *) sp,\n       color,\n       r, g, b));\n\n    if (sp == 0 || sp->_direct_color.value)\n\treturnCode(result);\n\n    maxcolors = MaxColors;\n\n    if (InitColor\n\t&& sp->_coloron\n\t&& (color >= 0 && OkColorHi(color))\n\t&& (okRGB(r) && okRGB(g) && okRGB(b))) {\n\n\tsp->_color_table[color].init = 1;\n\tsp->_color_table[color].r = r;\n\tsp->_color_table[color].g = g;\n\tsp->_color_table[color].b = b;\n\n\tif (UseHlsPalette) {\n\t    rgb2hls(r, g, b,\n\t\t    &sp->_color_table[color].red,\n\t\t    &sp->_color_table[color].green,\n\t\t    &sp->_color_table[color].blue);\n\t} else {\n\t    sp->_color_table[color].red = r;\n\t    sp->_color_table[color].green = g;\n\t    sp->_color_table[color].blue = b;\n\t}\n\n#ifdef USE_TERM_DRIVER\n\tCallDriver_4(sp, td_initcolor, color, r, g, b);\n#else\n\tNCURSES_PUTP2(\"initialize_color\",\n\t\t      TIPARM_4(initialize_color, color, r, g, b));\n#endif\n\tsp->_color_defs = max(color + 1, sp->_color_defs);\n\n\tresult = OK;\n    }\n    returnCode(result);\n}\n\nNCURSES_EXPORT(int)\nNCURSES_SP_NAME(init_color) (NCURSES_SP_DCLx\n\t\t\t     NCURSES_COLOR_T color,\n\t\t\t     NCURSES_COLOR_T r,\n\t\t\t     NCURSES_COLOR_T g,\n\t\t\t     NCURSES_COLOR_T b)\n{\n    return _nc_init_color(SP_PARM, color, r, g, b);\n}\n\n#if NCURSES_SP_FUNCS\nNCURSES_EXPORT(int)\ninit_color(NCURSES_COLOR_T color,\n\t   NCURSES_COLOR_T r,\n\t   NCURSES_COLOR_T g,\n\t   NCURSES_COLOR_T b)\n{\n    return NCURSES_SP_NAME(init_color) (CURRENT_SCREEN, color, r, g, b);\n}\n#endif\n\nNCURSES_EXPORT(bool)\nNCURSES_SP_NAME(can_change_color) (NCURSES_SP_DCL)\n{\n    int result = FALSE;\n\n    T((T_CALLED(\"can_change_color(%p)\"), (void *) SP_PARM));\n\n    if (HasTerminal(SP_PARM) && (CanChange != 0)) {\n\tresult = TRUE;\n    }\n\n    returnCode(result);\n}\n\n#if NCURSES_SP_FUNCS\nNCURSES_EXPORT(bool)\ncan_change_color(void)\n{\n    return NCURSES_SP_NAME(can_change_color) (CURRENT_SCREEN);\n}\n#endif\n\nNCURSES_EXPORT(bool)\nNCURSES_SP_NAME(has_colors) (NCURSES_SP_DCL0)\n{\n    int code = FALSE;\n\n    (void) SP_PARM;\n    T((T_CALLED(\"has_colors(%p)\"), (void *) SP_PARM));\n    if (HasTerminal(SP_PARM)) {\n#ifdef USE_TERM_DRIVER\n\tcode = HasColor;\n#else\n\tcode = ((VALID_NUMERIC(max_colors) && VALID_NUMERIC(max_pairs)\n\t\t && (((set_foreground != NULL)\n\t\t      && (set_background != NULL))\n\t\t     || ((set_a_foreground != NULL)\n\t\t\t && (set_a_background != NULL))\n\t\t     || set_color_pair)) ? TRUE : FALSE);\n#endif\n    }\n    returnCode(code);\n}\n\n#if NCURSES_SP_FUNCS\nNCURSES_EXPORT(bool)\nhas_colors(void)\n{\n    return NCURSES_SP_NAME(has_colors) (CURRENT_SCREEN);\n}\n#endif\n\nstatic int\n_nc_color_content(SCREEN *sp, int color, int *r, int *g, int *b)\n{\n    int result = ERR;\n\n    T((T_CALLED(\"color_content(%p,%d,%p,%p,%p)\"),\n       (void *) sp,\n       color,\n       (void *) r,\n       (void *) g,\n       (void *) b));\n\n    if (sp != 0) {\n\tint maxcolors = MaxColors;\n\n\tif (color >= 0 && OkColorHi(color) && sp->_coloron) {\n\t    int c_r, c_g, c_b;\n\n\t    if (sp->_direct_color.value) {\n\t\trgb_bits_t *work = &(sp->_direct_color);\n\n#define max_direct_color(name)\t((1 << work->bits.name) - 1)\n#define value_direct_color(max) (1000 * ((color >> bitoff) & max)) / max\n\n\t\tint max_r = max_direct_color(red);\n\t\tint max_g = max_direct_color(green);\n\t\tint max_b = max_direct_color(blue);\n\n\t\tint bitoff = 0;\n\n\t\tc_b = value_direct_color(max_b);\n\t\tbitoff += work->bits.blue;\n\n\t\tc_g = value_direct_color(max_g);\n\t\tbitoff += work->bits.green;\n\n\t\tc_r = value_direct_color(max_r);\n\n\t    } else {\n\t\tc_r = sp->_color_table[color].red;\n\t\tc_g = sp->_color_table[color].green;\n\t\tc_b = sp->_color_table[color].blue;\n\t    }\n\n\t    if (r)\n\t\t*r = c_r;\n\t    if (g)\n\t\t*g = c_g;\n\t    if (b)\n\t\t*b = c_b;\n\n\t    TR(TRACE_ATTRS, (\"...color_content(%d,%d,%d,%d)\",\n\t\t\t     color, c_r, c_g, c_b));\n\t    result = OK;\n\t}\n    }\n    if (result != OK) {\n\tif (r)\n\t    *r = 0;\n\tif (g)\n\t    *g = 0;\n\tif (b)\n\t    *b = 0;\n    }\n    returnCode(result);\n}\n\nNCURSES_EXPORT(int)\nNCURSES_SP_NAME(color_content) (NCURSES_SP_DCLx\n\t\t\t\tNCURSES_COLOR_T color,\n\t\t\t\tNCURSES_COLOR_T *r,\n\t\t\t\tNCURSES_COLOR_T *g,\n\t\t\t\tNCURSES_COLOR_T *b)\n{\n    int my_r, my_g, my_b;\n    int rc = _nc_color_content(SP_PARM, color, &my_r, &my_g, &my_b);\n    if (rc == OK) {\n\t*r = limit_COLOR(my_r);\n\t*g = limit_COLOR(my_g);\n\t*b = limit_COLOR(my_b);\n    }\n    return rc;\n}\n\n#if NCURSES_SP_FUNCS\nNCURSES_EXPORT(int)\ncolor_content(NCURSES_COLOR_T color,\n\t      NCURSES_COLOR_T *r,\n\t      NCURSES_COLOR_T *g,\n\t      NCURSES_COLOR_T *b)\n{\n    return NCURSES_SP_NAME(color_content) (CURRENT_SCREEN, color, r, g, b);\n}\n#endif\n\nNCURSES_EXPORT(int)\n_nc_pair_content(SCREEN *sp, int pair, int *f, int *b)\n{\n    int result;\n\n    T((T_CALLED(\"pair_content(%p,%d,%p,%p)\"),\n       (void *) sp,\n       (int) pair,\n       (void *) f,\n       (void *) b));\n\n    if (!ValidPair(sp, pair)) {\n\tresult = ERR;\n    } else {\n\tint fg;\n\tint bg;\n\n\tReservePairs(sp, pair);\n\tfg = FORE_OF(sp->_color_pairs[pair]);\n\tbg = BACK_OF(sp->_color_pairs[pair]);\n#if NCURSES_EXT_FUNCS\n\tif (isDefaultColor(fg))\n\t    fg = -1;\n\tif (isDefaultColor(bg))\n\t    bg = -1;\n#endif\n\n\tif (f)\n\t    *f = fg;\n\tif (b)\n\t    *b = bg;\n\n\tTR(TRACE_ATTRS, (\"...pair_content(%p,%d,%d,%d)\",\n\t\t\t (void *) sp,\n\t\t\t (int) pair,\n\t\t\t (int) fg, (int) bg));\n\tresult = OK;\n    }\n    returnCode(result);\n}\n\nNCURSES_EXPORT(int)\nNCURSES_SP_NAME(pair_content) (NCURSES_SP_DCLx\n\t\t\t       NCURSES_PAIRS_T pair,\n\t\t\t       NCURSES_COLOR_T *f,\n\t\t\t       NCURSES_COLOR_T *b)\n{\n    int my_f, my_b;\n    int rc = _nc_pair_content(SP_PARM, pair, &my_f, &my_b);\n    if (rc == OK) {\n\t*f = limit_COLOR(my_f);\n\t*b = limit_COLOR(my_b);\n    }\n    return rc;\n}\n\n#if NCURSES_SP_FUNCS\nNCURSES_EXPORT(int)\npair_content(NCURSES_COLOR_T pair, NCURSES_COLOR_T *f, NCURSES_COLOR_T *b)\n{\n    return NCURSES_SP_NAME(pair_content) (CURRENT_SCREEN, pair, f, b);\n}\n#endif\n\nNCURSES_EXPORT(void)\nNCURSES_SP_NAME(_nc_do_color) (NCURSES_SP_DCLx\n\t\t\t       int old_pair,\n\t\t\t       int pair,\n\t\t\t       int reverse,\n\t\t\t       NCURSES_SP_OUTC outc)\n{\n#ifdef USE_TERM_DRIVER\n    CallDriver_4(SP_PARM, td_docolor, old_pair, pair, reverse, outc);\n#else\n    int fg = COLOR_DEFAULT;\n    int bg = COLOR_DEFAULT;\n    int old_fg = -1;\n    int old_bg = -1;\n\n    if (!ValidPair(SP_PARM, pair)) {\n\treturn;\n    } else if (pair != 0) {\n\tif (set_color_pair) {\n\t    TPUTS_TRACE(\"set_color_pair\");\n\t    NCURSES_SP_NAME(tputs) (NCURSES_SP_ARGx\n\t\t\t\t    TIPARM_1(set_color_pair, pair),\n\t\t\t\t    1, outc);\n\t    return;\n\t} else if (SP_PARM != 0) {\n\t    if (_nc_pair_content(SP_PARM, pair, &fg, &bg) == ERR)\n\t\treturn;\n\t}\n    }\n\n    if (old_pair >= 0\n\t&& SP_PARM != 0\n\t&& _nc_pair_content(SP_PARM, old_pair, &old_fg, &old_bg) != ERR) {\n\tif ((isDefaultColor(fg) && !isDefaultColor(old_fg))\n\t    || (isDefaultColor(bg) && !isDefaultColor(old_bg))) {\n#if NCURSES_EXT_FUNCS\n\t     \n\t    if (SP_PARM->_has_sgr_39_49\n\t\t&& isDefaultColor(old_bg)\n\t\t&& !isDefaultColor(old_fg)) {\n\t\tNCURSES_SP_NAME(tputs) (NCURSES_SP_ARGx \"\\033[39m\", 1, outc);\n\t    } else if (SP_PARM->_has_sgr_39_49\n\t\t       && isDefaultColor(old_fg)\n\t\t       && !isDefaultColor(old_bg)) {\n\t\tNCURSES_SP_NAME(tputs) (NCURSES_SP_ARGx \"\\033[49m\", 1, outc);\n\t    } else\n#endif\n\t\treset_color_pair(NCURSES_SP_ARG);\n\t}\n    } else {\n\treset_color_pair(NCURSES_SP_ARG);\n\tif (old_pair < 0 && pair <= 0)\n\t    return;\n    }\n\n#if NCURSES_EXT_FUNCS\n    if (isDefaultColor(fg))\n\tfg = default_fg(NCURSES_SP_ARG);\n    if (isDefaultColor(bg))\n\tbg = default_bg(NCURSES_SP_ARG);\n#endif\n\n    if (reverse) {\n\tint xx = fg;\n\tfg = bg;\n\tbg = xx;\n    }\n\n    TR(TRACE_ATTRS, (\"setting colors: pair = %d, fg = %d, bg = %d\", pair,\n\t\t     fg, bg));\n\n    if (!isDefaultColor(fg)) {\n\tset_foreground_color(NCURSES_SP_ARGx fg, outc);\n    }\n    if (!isDefaultColor(bg)) {\n\tset_background_color(NCURSES_SP_ARGx bg, outc);\n    }\n#endif\n}\n\n#if NCURSES_SP_FUNCS\nNCURSES_EXPORT(void)\n_nc_do_color(int old_pair, int pair, int reverse, NCURSES_OUTC outc)\n{\n    SetSafeOutcWrapper(outc);\n    NCURSES_SP_NAME(_nc_do_color) (CURRENT_SCREEN,\n\t\t\t\t   old_pair,\n\t\t\t\t   pair,\n\t\t\t\t   reverse,\n\t\t\t\t   _nc_outc_wrapper);\n}\n#endif\n\n#if NCURSES_EXT_COLORS\nNCURSES_EXPORT(int)\nNCURSES_SP_NAME(init_extended_pair) (NCURSES_SP_DCLx int pair, int f, int b)\n{\n    return _nc_init_pair(SP_PARM, pair, f, b);\n}\n\nNCURSES_EXPORT(int)\nNCURSES_SP_NAME(init_extended_color) (NCURSES_SP_DCLx\n\t\t\t\t      int color,\n\t\t\t\t      int r, int g, int b)\n{\n    return _nc_init_color(SP_PARM, color, r, g, b);\n}\n\nNCURSES_EXPORT(int)\nNCURSES_SP_NAME(extended_color_content) (NCURSES_SP_DCLx\n\t\t\t\t\t int color,\n\t\t\t\t\t int *r, int *g, int *b)\n{\n    return _nc_color_content(SP_PARM, color, r, g, b);\n}\n\nNCURSES_EXPORT(int)\nNCURSES_SP_NAME(extended_pair_content) (NCURSES_SP_DCLx\n\t\t\t\t\tint pair,\n\t\t\t\t\tint *f, int *b)\n{\n    return _nc_pair_content(SP_PARM, pair, f, b);\n}\n\nNCURSES_EXPORT(void)\nNCURSES_SP_NAME(reset_color_pairs) (NCURSES_SP_DCL0)\n{\n    if (SP_PARM != 0) {\n\tif (SP_PARM->_color_pairs) {\n\t    _nc_free_ordered_pairs(SP_PARM);\n\t    free(SP_PARM->_color_pairs);\n\t    SP_PARM->_color_pairs = 0;\n\t    SP_PARM->_pair_alloc = 0;\n\t    ReservePairs(SP_PARM, 16);\n\t    clearok(CurScreen(SP_PARM), TRUE);\n\t    touchwin(StdScreen(SP_PARM));\n\t}\n    }\n}\n\n#if NCURSES_SP_FUNCS\nNCURSES_EXPORT(int)\ninit_extended_pair(int pair, int f, int b)\n{\n    return NCURSES_SP_NAME(init_extended_pair) (CURRENT_SCREEN, pair, f, b);\n}\n\nNCURSES_EXPORT(int)\ninit_extended_color(int color, int r, int g, int b)\n{\n    return NCURSES_SP_NAME(init_extended_color) (CURRENT_SCREEN,\n\t\t\t\t\t\t color,\n\t\t\t\t\t\t r, g, b);\n}\n\nNCURSES_EXPORT(int)\nextended_color_content(int color, int *r, int *g, int *b)\n{\n    return NCURSES_SP_NAME(extended_color_content) (CURRENT_SCREEN,\n\t\t\t\t\t\t    color,\n\t\t\t\t\t\t    r, g, b);\n}\n\nNCURSES_EXPORT(int)\nextended_pair_content(int pair, int *f, int *b)\n{\n    return NCURSES_SP_NAME(extended_pair_content) (CURRENT_SCREEN, pair, f, b);\n}\n\nNCURSES_EXPORT(void)\nreset_color_pairs(void)\n{\n    NCURSES_SP_NAME(reset_color_pairs) (CURRENT_SCREEN);\n}\n#endif  \n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}