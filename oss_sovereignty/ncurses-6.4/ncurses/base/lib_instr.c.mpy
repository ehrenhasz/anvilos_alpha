{
  "module_name": "lib_instr.c",
  "hash_id": "d1dbb63bc5950907f8939488d4f3b939ba22d2171a9b9d1632d2b36de0f169f5",
  "original_prompt": "Ingested from ncurses-6.4/ncurses/base/lib_instr.c",
  "human_readable_source": " \n\n \n\n \n\n#include <curses.priv.h>\n\nMODULE_ID(\"$Id: lib_instr.c,v 1.25 2021/04/03 22:24:18 tom Exp $\")\n\nNCURSES_EXPORT(int)\nwinnstr(WINDOW *win, char *str, int n)\n{\n    int i = 0;\n\n    T((T_CALLED(\"winnstr(%p,%p,%d)\"), (void *) win, str, n));\n\n    if (!win || !str) {\n\ti = ERR;\n    } else {\n\tint row = win->_cury;\n\tint col = win->_curx;\n\tNCURSES_CH_T *text = win->_line[row].text;\n\n\tif (n < 0)\n\t    n = win->_maxx - col + 1;\n\n\tfor (; i < n;) {\n#if USE_WIDEC_SUPPORT\n\t    cchar_t *cell = &(text[col]);\n\t    attr_t attrs;\n\t    NCURSES_PAIRS_T pair;\n\t    char *tmp;\n\n\t    if (!isWidecExt(*cell)) {\n\t\twchar_t *wch;\n\t\tint n2;\n\n\t\tn2 = getcchar(cell, 0, 0, 0, 0);\n\t\tif (n2 > 0\n\t\t    && (wch = typeCalloc(wchar_t, (unsigned) n2 + 1)) != 0) {\n\t\t    bool done = FALSE;\n\n\t\t    if (getcchar(cell, wch, &attrs, &pair, 0) == OK) {\n\t\t\tmbstate_t state;\n\t\t\tsize_t n3;\n\n\t\t\tinit_mb(state);\n\t\t\tn3 = wcstombs(0, wch, (size_t) 0);\n\t\t\tif (!isEILSEQ(n3) && (n3 != 0)) {\n\t\t\t    size_t need = n3 + 10 + (size_t) i;\n\t\t\t    int have = (int) n3 + i;\n\n\t\t\t     \n\t\t\t    if (have > n || (int) need <= 0) {\n\t\t\t\tdone = TRUE;\n\t\t\t    } else if ((tmp = typeCalloc(char, need)) == 0) {\n\t\t\t\tdone = TRUE;\n\t\t\t    } else {\n\t\t\t\tsize_t i3;\n\n\t\t\t\tinit_mb(state);\n\t\t\t\twcstombs(tmp, wch, n3);\n\t\t\t\tfor (i3 = 0; i3 < n3; ++i3)\n\t\t\t\t    str[i++] = tmp[i3];\n\t\t\t\tfree(tmp);\n\t\t\t    }\n\t\t\t}\n\t\t    }\n\t\t    free(wch);\n\t\t    if (done)\n\t\t\tbreak;\n\t\t}\n\t    }\n#else\n\t    str[i++] = (char) CharOf(text[col]);\n#endif\n\t    if (++col > win->_maxx) {\n\t\tbreak;\n\t    }\n\t}\n\tstr[i] = '\\0';\t\t \n    }\n    T((\"winnstr returns %s\", _nc_visbuf(str)));\n    returnCode(i);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}