{
  "module_name": "lib_refresh.c",
  "hash_id": "421ac62f2707b8a2fe560e867c1f1e5651c93b0924c13c108ff6b2553a0dc5b3",
  "original_prompt": "Ingested from ncurses-6.4/ncurses/base/lib_refresh.c",
  "human_readable_source": " \n\n \n\n \n\n#include <curses.priv.h>\n\nMODULE_ID(\"$Id: lib_refresh.c,v 1.47 2021/11/06 22:22:03 tom Exp $\")\n\nNCURSES_EXPORT(int)\nwrefresh(WINDOW *win)\n{\n    int code;\n#if NCURSES_SP_FUNCS\n    SCREEN *SP_PARM = _nc_screen_of(win);\n#endif\n\n    T((T_CALLED(\"wrefresh(%p)\"), (void *) win));\n\n    if (win == 0) {\n\tcode = ERR;\n    } else if (win == CurScreen(SP_PARM)) {\n\tCurScreen(SP_PARM)->_clear = TRUE;\n\tcode = NCURSES_SP_NAME(doupdate) (NCURSES_SP_ARG);\n    } else if ((code = wnoutrefresh(win)) == OK) {\n\tif (win->_clear)\n\t    NewScreen(SP_PARM)->_clear = TRUE;\n\tcode = NCURSES_SP_NAME(doupdate) (NCURSES_SP_ARG);\n\t \n\twin->_clear = FALSE;\n    }\n    returnCode(code);\n}\n\nNCURSES_EXPORT(int)\nwnoutrefresh(WINDOW *win)\n{\n    int limit_x;\n    int src_row, src_col;\n    int begx;\n    int begy;\n    int dst_row, dst_col;\n#if USE_SCROLL_HINTS\n    bool wide;\n#endif\n#if NCURSES_SP_FUNCS\n    SCREEN *SP_PARM = _nc_screen_of(win);\n#endif\n\n    T((T_CALLED(\"wnoutrefresh(%p)\"), (void *) win));\n\n    if (win == NULL)\n\treturnCode(ERR);\n\n     \n    if (IS_PAD(win)) {\n\treturnCode(pnoutrefresh(win,\n\t\t\t\twin->_pad._pad_y,\n\t\t\t\twin->_pad._pad_x,\n\t\t\t\twin->_pad._pad_top,\n\t\t\t\twin->_pad._pad_left,\n\t\t\t\twin->_pad._pad_bottom,\n\t\t\t\twin->_pad._pad_right));\n    }\n#ifdef TRACE\n    if (USE_TRACEF(TRACE_UPDATE)) {\n\t_tracedump(\"...win\", win);\n\t_nc_unlock_global(tracef);\n    }\n#endif  \n\n     \n    begx = win->_begx;\n    begy = win->_begy;\n\n    NewScreen(SP_PARM)->_nc_bkgd = win->_nc_bkgd;\n    WINDOW_ATTRS(NewScreen(SP_PARM)) = WINDOW_ATTRS(win);\n\n     \n    wsyncdown(win);\n\n#if USE_SCROLL_HINTS\n     \n    wide = (begx <= 1 && win->_maxx >= (NewScreen(SP_PARM)->_maxx - 1));\n#endif\n\n    win->_flags &= ~_HASMOVED;\n\n     \n\n     \n    limit_x = win->_maxx;\n     \n    if (limit_x > NewScreen(SP_PARM)->_maxx - begx)\n\tlimit_x = NewScreen(SP_PARM)->_maxx - begx;\n\n    for (src_row = 0, dst_row = begy + win->_yoffset;\n\t src_row <= win->_maxy && dst_row <= NewScreen(SP_PARM)->_maxy;\n\t src_row++, dst_row++) {\n\tstruct ldat *nline = &(NewScreen(SP_PARM)->_line[dst_row]);\n\tstruct ldat *oline = &win->_line[src_row];\n\n\tif (oline->firstchar != _NOCHANGE) {\n\t    int last_src = oline->lastchar;\n\n\t    if (last_src > limit_x)\n\t\tlast_src = limit_x;\n\n\t    src_col = oline->firstchar;\n\t    dst_col = src_col + begx;\n\n\t    if_WIDEC({\n\t\tint j;\n\n\t\t \n\t\tif (isWidecExt(oline->text[src_col])) {\n\t\t    j = 1 + dst_col - WidecExt(oline->text[src_col]);\n\t\t    if (j < 0)\n\t\t\tj = 0;\n\t\t    if (dst_col > j) {\n\t\t\tsrc_col -= (dst_col - j);\n\t\t\tdst_col = j;\n\t\t    }\n\t\t}\n\n\t\t \n\t\tj = last_src;\n\t\tif (WidecExt(oline->text[j])) {\n\t\t    ++j;\n\t\t    while (j <= limit_x) {\n\t\t\tif (isWidecBase(oline->text[j])) {\n\t\t\t    break;\n\t\t\t} else {\n\t\t\t    last_src = j;\n\t\t\t}\n\t\t\t++j;\n\t\t    }\n\t\t}\n\t    });\n\n\t    if_WIDEC({\n\t\tstatic cchar_t blank = BLANK;\n\t\tint last_dst = begx + ((last_src < win->_maxx)\n\t\t\t\t       ? last_src\n\t\t\t\t       : win->_maxx);\n\t\tint fix_left = dst_col;\n\t\tint fix_right = last_dst;\n\t\tint j;\n\n\t\t \n\t\tj = dst_col;\n\t\tif (isWidecExt(nline->text[j])) {\n\t\t     \n\t\t    fix_left = 1 + j - WidecExt(nline->text[j]);\n\t\t    if (fix_left < 0)\n\t\t\tfix_left = 0;\t \n\t\t}\n\n\t\tj = last_dst;\n\t\tif (WidecExt(nline->text[j]) != 0) {\n\t\t     \n\t\t    ++j;\n\t\t    while (j <= NewScreen(SP_PARM)->_maxx &&\n\t\t\t   isWidecExt(nline->text[j])) {\n\t\t\tfix_right = j++;\n\t\t    }\n\t\t}\n\n\t\t \n\t\tif (fix_left < dst_col || fix_right > last_dst) {\n\t\t    for (j = fix_left; j <= fix_right; ++j) {\n\t\t\tnline->text[j] = blank;\n\t\t\tCHANGED_CELL(nline, j);\n\t\t    }\n\t\t}\n\t    });\n\n\t     \n\t    for (; src_col <= last_src; src_col++, dst_col++) {\n\t\tif (!CharEq(oline->text[src_col], nline->text[dst_col])) {\n\t\t    nline->text[dst_col] = oline->text[src_col];\n\t\t    CHANGED_CELL(nline, dst_col);\n\t\t}\n\t    }\n\n\t}\n#if USE_SCROLL_HINTS\n\tif (wide) {\n\t    int oind = oline->oldindex;\n\n\t    nline->oldindex = ((oind == _NEWINDEX)\n\t\t\t       ? _NEWINDEX\n\t\t\t       : (begy + oind + win->_yoffset));\n\t}\n#endif  \n\n\toline->firstchar = oline->lastchar = _NOCHANGE;\n\tif_USE_SCROLL_HINTS(oline->oldindex = src_row);\n    }\n\n    if (win->_clear) {\n\twin->_clear = FALSE;\n\tNewScreen(SP_PARM)->_clear = TRUE;\n    }\n\n    if (!win->_leaveok) {\n\tNewScreen(SP_PARM)->_cury = (NCURSES_SIZE_T) (win->_cury +\n\t\t\t\t\t\t      win->_begy + win->_yoffset);\n\tNewScreen(SP_PARM)->_curx = (NCURSES_SIZE_T) (win->_curx + win->_begx);\n    }\n    NewScreen(SP_PARM)->_leaveok = win->_leaveok;\n\n#ifdef TRACE\n    if (USE_TRACEF(TRACE_UPDATE)) {\n\t_tracedump(\"newscr\", NewScreen(SP_PARM));\n\t_nc_unlock_global(tracef);\n    }\n#endif  \n    returnCode(OK);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}