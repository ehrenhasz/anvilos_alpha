{
  "module_name": "cmpdef.cmd",
  "hash_id": "3e31041debd555f20d6b5aad738fce6a339bb87cad108f64bc37f53610cb47e5",
  "original_prompt": "Ingested from ncurses-6.4/misc/cmpdef.cmd",
  "human_readable_source": "/****************************************************************************\n * Copyright 2020 Thomas E. Dickey                                          *\n * Copyright 1998,2006 Free Software Foundation, Inc.                       *\n *                                                                          *\n * Permission is hereby granted, free of charge, to any person obtaining a  *\n * copy of this software and associated documentation files (the            *\n * \"Software\"), to deal in the Software without restriction, including      *\n * without limitation the rights to use, copy, modify, merge, publish,      *\n * distribute, distribute with modifications, sublicense, and/or sell       *\n * copies of the Software, and to permit persons to whom the Software is    *\n * furnished to do so, subject to the following conditions:                 *\n *                                                                          *\n * The above copyright notice and this permission notice shall be included  *\n * in all copies or substantial portions of the Software.                   *\n *                                                                          *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS  *\n * OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF               *\n * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.   *\n * IN NO EVENT SHALL THE ABOVE COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,   *\n * DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR    *\n * OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR    *\n * THE USE OR OTHER DEALINGS IN THE SOFTWARE.                               *\n *                                                                          *\n * Except as contained in this notice, the name(s) of the above copyright   *\n * holders shall not be used in advertising or otherwise to promote the     *\n * sale, use or other dealings in this Software without prior written       *\n * authorization.                                                           *\n ****************************************************************************/\n\n/*\n * $Id: cmpdef.cmd,v 1.4 2020/02/02 23:34:34 tom Exp $\n *\n * Author:  Juan Jose Garcia Ripoll <worm@arrakis.es>.\n * Webpage: http://www.arrakis.es/~worm/\n *\n * cmpdef.cmd - compares two .def files, checking whether they have\n *\t\tthe same entries with the same export codes.\n *\n * returns 0 if there are no conflicts between the files -- that is,\n * the newer one can replace the older one.\n *\n * returns 1 when either of the files is not properly formatted and\n * when there are conflicts: two symbols having the same export code.\n *\n * the standard output shows a list with newly added symbols, plus\n * replaced symbols and conflicts.\n */\nparse arg def_file1 def_file2\n\ndef_file1 = translate(def_file1,'\\','/')\ndef_file2 = translate(def_file2,'\\','/')\n\ncall CleanQueue\n\n/*\n * `cmp' is zero when the last file is valid and upward compatible\n * `numbers' is the stem where symbols are stored\n */\ncmp      = 0\nnames.   = ''\nnumbers. = 0\n\n/*\n * This sed expression cleans empty lines, comments and special .DEF\n * commands, such as LIBRARY..., EXPORTS..., etc\n */\ntidy_up  = '\"s/[ \t][ \t]*/ /g;s/;.*//g;/^[ ]*$/d;/^[a-zA-Z]/d;\"'\n\n/*\n * First we find all public symbols from the original DLL. All this\n * information is pushed into a REXX private list with the RXQUEUE\n * utility program.\n */\n'@echo off'\n'type' def_file1 '| sed' tidy_up '| sort | rxqueue'\n\ndo while queued() > 0\n   /*\n    * We retrieve the symbol name (NAME) and its number (NUMBER)\n    */\n   parse pull '\"' name '\"' '@'number rest\n   if number = '' || name = '' then\n      do\n      say 'Corrupted file' def_file1\n      say 'Symbol' name 'has no number'\n      exit 1\n      end\n   else\n      do\n      numbers.name = number\n      names.number = name\n      end\nend\n\n/*\n * Now we find all public symbols from the new DLL, and compare.\n */\n'type' def_file2 '| sed' tidy_up '| sort | rxqueue'\n\ndo while queued() > 0\n   parse pull '\"' name '\"' '@'number rest\n   if name = '' | number = '' then\n      do\n      say 'Corrupted file' def_file2\n      say 'Symbol' name 'has no number'\n      exit 1\n      end\n   if numbers.name = 0 then\n      do\n      cmp = 1\n      if names.number = '' then\n         say 'New symbol' name 'with code @'number\n      else\n         say 'Conflict old =' names.number ', new =' name 'at @'number\n      end\n   else if numbers.name \\= number then\n      do\n      cmp = 1\n      say name 'Symbol' name 'changed from @'numbers.name 'to @'number\n      end\nend /* do */\n\nexit cmp\n\n/*\n * Cleans the REXX queue by pulling and forgetting every line.\n * This is needed, at least, when `cmpdef.cmd' starts, because an aborted\n * REXX program might have left some rubbish in.\n */\nCleanQueue: procedure\n   do while queued() > 0\n      parse pull foo\n   end\nreturn\n\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}